# FreeIPA рдкреЗрдВрдЯреЗрд╕реНрдЯрд┐рдВрдЧ

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>тШБя╕П HackTricks Cloud тШБя╕П</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ЁЯРж Twitter ЁЯРж</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ЁЯОЩя╕П Twitch ЁЯОЩя╕П</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ЁЯОе Youtube ЁЯОе</strong></a></summary>

* рдХреНрдпрд╛ рдЖрдк рдХрд┐рд╕реА **рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХрдВрдкрдиреА** рдореЗрдВ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ? рдХреНрдпрд╛ рдЖрдк рдЕрдкрдиреА рдХрдВрдкрдиреА рдХреЛ **HackTricks** рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ? рдпрд╛ рдХреНрдпрд╛ рдЖрдк **PEASS рдХреЗ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб** рдХрд░рдиреЗ рдХреА рд╕реБрд╡рд┐рдзрд╛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ? [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ!
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╕рдВрдЧреНрд░рд╣ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family)
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks swag**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** [**ЁЯТм**](https://emojipedia.org/speech-balloon/) [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ рдпрд╛ рдореБрдЭреЗ **Twitter** рдкрд░ **рдлрд╝реЙрд▓реЛ** рдХрд░реЗрдВ [**ЁЯРж**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **рдФрд░** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **рдХреЛред**

</details>

рдпрд╣ рдЬрд╛рдирдХрд╛рд░реА рдкреЛрд╕реНрдЯ рд╕реЗ рд▓реА рдЧрдИ рд╣реИ:

* [https://posts.specterops.io/attacking-freeipa-part-i-authentication-77e73d837d6a](https://posts.specterops.io/attacking-freeipa-part-i-authentication-77e73d837d6a)
* [https://posts.specterops.io/attacking-freeipa-part-ii-enumeration-ad27224371e1](https://posts.specterops.io/attacking-freeipa-part-ii-enumeration-ad27224371e1)
* [https://www.youtube.com/watch?v=9dOu-7BTwPQ\&feature=youtu.be](https://www.youtube.com/watch?v=9dOu-7BTwPQ\&feature=youtu.be)

## рдореВрд▓рднреВрдд рдЬрд╛рдирдХрд╛рд░реА

рдпрд╣ Microsoft Windows **Active** **Directory** рдХреЗ рд▓рд┐рдП рдПрдХ рдЦреБрд▓рд╛ рд╕реНрд░реЛрдд **рд╡рд┐рдХрд▓реНрдк** рд╣реИ, рдореБрдЦреНрдп рд░реВрдк рд╕реЗ **Unix** рдкрд░реНрдпрд╛рд╡рд░рдгреЛрдВ рдХреЗ рд▓рд┐рдП рдПрдХ рдПрдХреАрдХреГрдд рдкреНрд░рдмрдВрдзрди рд╕рдорд╛рдзрд╛рди рдХреЗ рд░реВрдк рдореЗрдВ рдЙрдкрдпреЛрдЧ рд╣реЛрддрд╛ рд╣реИред Active Directory рдХреА рддрд░рд╣, FreeIPA рдПрдХ рдкреВрд░реНрдг **LDAP рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛** рдврд╛рдВрдЪрд╛ рдХрд╛ рдЕрдорд▓ рдХрд░рддрд╛ рд╣реИ рдЬрд┐рд╕реЗ MIT **Kerberos** Key Distribution Center рджреНрд╡рд╛рд░рд╛ рд╕рдорд░реНрдерд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдпрд╣ CA & RA рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдкреНрд░рдмрдВрдзрди рдХреЗ рд▓рд┐рдП Dogtag **Certificate System** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ, рдЬрд┐рд╕рдХреЗ рдХрд╛рд░рдг рдЗрд╕реЗ рд╕реНрдорд╛рд░реНрдЯрдХрд╛рд░реНрдб рд╕рд╣рд┐рдд **рдмрд╣реБ-рдХрд╛рд░рдХ** рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХрд╛ рд╕рдВрдЪрд╛рд▓рди рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рд╣реЛрддреА рд╣реИред SSSD рдХрд╛ рдЙрдкрдпреЛрдЧ FreeIPA рдХреЛ рдорд╛рдирдХ Unix рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рдПрдХреАрдХреГрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

## рдлрд┐рдВрдЧрд░рдкреНрд░рд┐рдВрдЯ

### рдлрд╝рд╛рдЗрд▓реЗрдВ рдФрд░ рдПрдирд╡рд╛рдпрд░рдирдореЗрдВрдЯ рд╡рд╛рд░реНрд╕

* **`/etc/krb5.conf`:** `krb5.conf` рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рд╡рд╣ Kerberos рдХреНрд▓рд╛рдЗрдВрдЯ рдЬрд╛рдирдХрд╛рд░реА рд╣реЛрддреА рд╣реИ рдЬреЛ рдбреЛрдореЗрди рдореЗрдВ **рдирд╛рдорд╛рдВрдХрд┐рдд рд╣реЛрдиреЗ** рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рд╣реЛрддреА рд╣реИред рдЗрд╕рдореЗрдВ рд░реБрдЪрд┐ рдХреЗ Kerberos рд╡реАрд▓реЛрдВ рдХреЗ рд▓рд┐рдП KDCs рдФрд░ рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рд╕рд░реНрд╡рд░реЛрдВ рдХреА **рд╕реНрдерд╛рди** рдХреЛ, рд╡рд░реНрддрдорд╛рди рд╡реАрд▓ рдФрд░ Kerberos рдЕрдиреБрдкреНрд░рдпреЛрдЧреЛрдВ рдХреЗ рд▓рд┐рдП рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдХреЛ, рдФрд░ рд╣реЛрд╕реНрдЯрдирд╛рдо рдХреЛ Kerberos рд╡реАрд▓реЛрдВ рдкрд░ рдореИрдк рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдирдХреНрд╢рд╛рдПрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрддреА рд╣реИрдВред
* **`/etc/ipa/default.conf`:** рдпрд╣ IPA рд╕рд░реНрд╡рд░реЛрдВ рдХреЗ рд▓рд┐рдП **рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓** рд╣реИ, рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ IPA рдХреНрд▓рд╛рдЗрдВрдЯ рдФрд░ рд╕рд░реНрд╡рд░ рдЪрд▓рд╛рдиреЗ рдХреЗ рд╕рдордп рд▓рд╛рдЧреВ рд╣реЛрдиреЗ рд╡рд╛рд▓реА рд╕рд┐рд╕реНрдЯрдо-рд╡реНрдпрд╛рдкреА рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд╕реЗрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред
* **`/etc/krb5.keytab`:** `krb5.keytab` рдлрд╝рд╛рдЗрд▓ **рдбреЛрдореЗрди** рдХреЗ рд╕рднреА рд╣реЛрд╕реНрдЯ рдкрд░ рдЖрд╡рд╢реНрдпрдХ рд╣реЛрддреА рд╣реИред рдпрд╣ KDC рдХреЗ рдкреНрд░рддрд┐ **рдкреНрд░рдорд╛рдгреАрдХрд░рдг** рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ рдХреЗ рд░реВрдк рдореЗрдВ рдЖрд╡рд╢реНрдпрдХ рд╣реЛрддреА рд╣реИред
* **`KRB5CCNAME`:** рдпрджрд┐ рд╕реЗрдЯ рд╣реИ, рддреЛ рдпрд╣ рдЪрд░ рд╡рд┐рд╢реЗрд╖рддрд╛ **рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рд╣реЛрдиреЗ рд╡рд╛рд▓реЗ CCACHE рдЯрд┐рдХрдЯ** рдХреА рд╕реНрдерд╛рди рдХреА рдУрд░ рдкрд╣реБрдБрдЪ рдХрд░рддреА рд╣реИред
* **`KRB5_KTNAME`:** рдпрджрд┐ рд╕реЗрдЯ рд╣реИ, рддреЛ рдпрд╣ рдЪрд░ рд╡рд┐рд╢реЗрд╖рддрд╛ **рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рд╣реЛрдиреЗ рд╡рд╛рд▓реА Keytab рдлрд╝рд╛рдЗрд▓** рдХреА рд╕реНрдерд╛рди рдХреА рдУрд░ рдкрд╣реБрдБрдЪ рдХрд░рддреА рд╣реИред
* **`KRB5_CONFIG`:** рдпрджрд┐ рд╕реЗрдЯ рд╣реИ, рддреЛ рдпрд╣ рдЪрд░ рд╡рд┐рд╢реЗрд╖рддрд╛ **Kerberos рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди** рдлрд╝рд╛рдЗрд▓ рдХреА рд╕реНрдерд╛рди рдХреА рдУрд░ рдкрд╣реБрдБрдЪ рдХрд░рддреА рд╣реИред
* **`KRB5_KDC_PROFILE`:** рдпрджрд┐ рд╕реЗрдЯ рд╣реИ
### рдиреЗрдЯрд╡рд░реНрдХ

рдпрд╣рд╛рдБ рдПрдХ FreeIPA рд╕рд░реНрд╡рд░ рдХрд╛ рджрд┐рдЦрдиреЗ рдХрд╛ рддрд░реАрдХрд╛ рд╣реИ:

<figure><img src="../.gitbook/assets/image (197).png" alt=""><figcaption></figcaption></figure>

## рдкреНрд░рдорд╛рдгреАрдХрд░рдг

рдХреНрдпреЛрдВрдХрд┐ FreeIPA **рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЗ рд▓рд┐рдП Kerberos рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ**, рдЗрд╕ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ **Active Directory** рдореЗрдВ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЗ рд╕рд╛рде рдмрд╣реБрдд рд╕рдорд╛рди рд╣реИред рдбреЛрдореЗрди рдкрд░ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП, рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдЙрд╕ рд╕рдВрд╕рд╛рдзрди рдХреЗ рд▓рд┐рдП рдПрдХ **рдорд╛рдиреНрдп Kerberos рдЯрд┐рдХрдЯ** рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред рдЗрди рдЯрд┐рдХрдЯ рдХреЛ FreeIPA рдбреЛрдореЗрди рдХреЗ рд╡рд┐рдиреНрдпрд╛рд╕ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдХрдИ рдЕрд▓рдЧ-рдЕрд▓рдЧ рд╕реНрдерд╛рдиреЛрдВ рдкрд░ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

### **CCACHE рдЯрд┐рдХрдЯ рдлрд╝рд╛рдЗрд▓реЗрдВ**

рдЬрдм рдЯрд┐рдХрдЯ рдХреЛ **рдбрд┐рд╕реНрдХ рдкрд░ рдлрд╝рд╛рдЗрд▓** рдХреЗ рд░реВрдк рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдорд╛рдирдХ рдкреНрд░рд╛рд░реВрдк рдФрд░ рдкреНрд░рдХрд╛рд░ рдПрдХ **CCACHE** рдлрд╝рд╛рдЗрд▓ рд╣реЛрддреА рд╣реИред рдпрд╣ Kerberos рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рд╕рдВрдЧреНрд░рд╣ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╕рд░рд▓ рдмрд╛рдЗрдирд░реА рдлрд╝рд╛рдЗрд▓ рдкреНрд░рд╛рд░реВрдк рд╣реИред рдпреЗ рдлрд╝рд╛рдЗрд▓реЗрдВ рд╕рд╛рдорд╛рдиреНрдпрддрдГ **`/tmp`** рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рдХреА рдЬрд╛рддреА рд╣реИрдВ рдФрд░ **600** рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЗ рд╕рд╛рде рд╕реНрдХреЛрдк рдХреА рдЬрд╛рддреА рд╣реИрдВред рд╣рдорд╛рд░реЗ рд╣рдорд▓рд╛рд╡рд░ рдХреЗ рджреГрд╖реНрдЯрд┐рдХреЛрдг рд╕реЗ рдпрд╣ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ рдХреНрдпреЛрдВрдХрд┐:

1. рдорд╛рдиреНрдп рдЯрд┐рдХрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдмрд┐рдирд╛ рд╕рдВрдмрдВрдзрд┐рдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд╕рд╛рджрд╛ **рдкрд╛рд╕рд╡рд░реНрдб** рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдХреЗред
2. **CCACHE** рдЯрд┐рдХрдЯ рдЕрддреНрдпрдВрдд **рдкреЛрд░реНрдЯреЗрдмрд▓** рд╣реЛрддреЗ рд╣реИрдВред рдЗрдиреНрд╣реЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд┐рдпрд╛ рдФрд░ рджреВрд╕рд░реЗ рд╣реЛрд╕реНрдЯ рдкрд░ рд▓реЛрдб рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдмрд┐рдирд╛ рдЯрд┐рдХрдЯ рдХреЛ рдирд╡реАрдиреАрдХреГрдд рдпрд╛ рдорд╛рдиреНрдпрддрд╛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдХреЗред

CCACHE рдЯрд┐рдХрдЯ рдХреЛ рдкрд╛рд░реНрд╕ рдХрд░рдирд╛ рдХрдИ рдЕрд▓рдЧ-рдЕрд▓рдЧ рддрд░реАрдХреЛрдВ рд╕реЗ рдЖрд╕рд╛рдиреА рд╕реЗ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рд╕рдмрд╕реЗ рд╕рд░рд▓ рддрд░реАрдХрд╛ рдЗрд╕реЗ klist рдмрд╛рдЗрдирд░реА рдХреЗ рд╕рд╛рде рдкрд╛рд░реНрд╕ рдХрд░рдирд╛ рд╣реИред
```
klist /tmp/krb5cc_0
```
<figure><img src="../.gitbook/assets/image (70).png" alt=""><figcaption></figcaption></figure>

рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдХреЗ рд▓рд┐рдП рдПрдХ CCACHE рдЯрд┐рдХрдЯ рдХрд╛ рдкреБрдирдГ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдмрд╣реБрдд рдЖрд╕рд╛рди рд╣реИред рдПрдХ рдорд╛рдиреНрдп CCACHE рдЯрд┐рдХрдЯ рдХрд╛ рдкреБрдирдГ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, **KRB5CCNAME** рдХреЛ рдорд╛рдиреНрдп рдЯрд┐рдХрдЯ рдлрд╝рд╛рдЗрд▓ рдХреЗ **рдкрде** рдкрд░ **рдирд┐рд░реНрдпрд╛рдд** рдХрд░реЗрдВред рд╕рд┐рд╕реНрдЯрдо рдХреЛ рдпрд╣ рдкрд░реНрдпрд╛рд╡рд░рдг рдЪрд░ рдХреЛ рдорд╛рдиреНрдпрддрд╛ рджреЗрдиреА рдЪрд╛рд╣рд┐рдП рдФрд░ рдЬрдм рдбреЛрдореЗрди рдХреЗ рд╕рд╛рде рдЗрдВрдЯрд░реИрдХреНрдЯ рдХрд░рддреЗ рд╕рдордп рдЙрд╕ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рд╕рд╛рдордЧреНрд░реА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдЧрд╛ред
```bash
export KRB5CCNAME=/tmp/krb5cc_0
klist
```
<figure><img src="../.gitbook/assets/image (175).png" alt=""><figcaption></figcaption></figure>

### **Unix Keyring**

CCACHE Tickets \*\*\*\* рдХреЛ рднреА **Linux keyring** рдореЗрдВ **рд╕рдВрдЧреНрд░рд╣реАрдд** рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред Keyring **kernel** рдХреЗ рдЕрдВрджрд░ рд╣реЛрддрд╛ рд╣реИ, рдФрд░ рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХреЛрдВ рдХреЛ **рд╕рдВрдЧреНрд░рд╣реАрдд рдЯрд┐рдХрдЯ рдХреЗ рдкреНрд░рд╛рдкреНрддрд┐ рдФрд░ рдЙрдкрдпреЛрдЧ рдкрд░ рдЕрдзрд┐рдХ рдирд┐рдпрдВрддреНрд░рдг** рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред рдЯрд┐рдХрдЯ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рддрд░реАрдХреЛрдВ рд╕реЗ рд╕реНрдХреЛрдк рдХрд┐рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВ:

* **`KEYRING:name`:** рдЯрд┐рдХрдЯ рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдирд╛рдорд┐рдд Keyring рдХреЗ рд╕реНрдХреЛрдк рдореЗрдВ рд╣реЛрддреЗ рд╣реИрдВред
* **`KEYRING:process:name`:** рдЯрд┐рдХрдЯ рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдкреНрд░рдХреНрд░рд┐рдпрд╛ id рдХреЗ рд╕реНрдХреЛрдк рдореЗрдВ рд╣реЛрддреЗ рд╣реИрдВред
* **`KEYRING:thread:name`:** рдЯрд┐рдХрдЯ рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдереНрд░реЗрдб рдХреЗ рд╕реНрдХреЛрдк рдореЗрдВ рд╣реЛрддреЗ рд╣реИрдВред
* **`KEYRING:session:name`:** рдЯрд┐рдХрдЯ рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕рддреНрд░ рдХреЗ рд╕реНрдХреЛрдк рдореЗрдВ рд╣реЛрддреЗ рд╣реИрдВред
* **`KEYRING:persistent:uidnumber`:** рдЯрд┐рдХрдЯ рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд╕реНрдХреЛрдк рдореЗрдВ рд╣реЛрддреЗ рд╣реИрдВ, рд╕рддреНрд░ рдХреЗ рдмрд╛рд╡рдЬреВрдж (рдбрд┐рдлрд╝реЙрд▓реНрдЯ)ред

Unix keyring рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рдЯрд┐рдХрдЯ рдХреЛ рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рдиреЗ рдХреИрд╕реЗ рд╕реНрдХреЛрдк рдХрд┐рдпрд╛ рд╣реИ, рдЗрд╕рдХрд╛ рдкрд╛рд░реНрд╕рд┐рдВрдЧ рдХрд░рдирд╛ рдХрдард┐рди рд╣реЛ рд╕рдХрддрд╛ рд╣реИред рд╣рд╛рд▓рд╛рдВрдХрд┐, CCACHE Tickets рдХреЗ рд▓рд┐рдП Unix keyring рдореЗрдВ **рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд╕реНрдХреЛрдк** рд╣реИ **`KEYRING:persistent:uidnumber`**ред рднрд╛рдЧреНрдпрд╢рд╛рд▓реА рддрд░реАрдХреЗ рд╕реЗ, рдпрджрд┐ рдЖрдк **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛** рдХреЗ **рд╕рдВрджрд░реНрдн** рдореЗрдВ рд╣реИрдВ, `klist` рд╣рдорд╛рд░реЗ рд▓рд┐рдП рдЗрд╕ рдЬрд╛рдирдХрд╛рд░реА рдХреЛ **рдкрд╛рд░реНрд╕** рдХрд░ рд╕рдХрддрд╛ рд╣реИред

<figure><img src="../.gitbook/assets/image (3) (1) (4).png" alt=""><figcaption></figcaption></figure>

рд╣рдорд▓рд╛рд╡рд░ рдХреЗ рд░реВрдк рдореЗрдВ, Unix **keyring** рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рдПрдХ CCACHE Ticket рдХрд╛ рдкреБрдирдГ **рдЙрдкрдпреЛрдЧ** рдХрд░рдирд╛ рдХрд╛рдлреА **рдХрдард┐рди** рд╣реЛ рд╕рдХрддрд╛ рд╣реИ, рдпрд╣ рдЯрд┐рдХрдЯ рдХреИрд╕реЗ рд╕реНрдХреЛрдк рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рдЗрд╕ рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддрд╛ рд╣реИред рднрд╛рдЧреНрдпрд╢рд╛рд▓реА рддрд░реАрдХреЗ рд╕реЗ [@Zer1t0](https://github.com/Zer1t0) рдиреЗ [@Tarlogic](https://twitter.com/Tarlogic) рд╕реЗ рдПрдХ рдЙрдкрдХрд░рдг рдмрдирд╛рдпрд╛ рд╣реИ рдЬреЛ Unix keyring рд╕реЗ Kerberos рдЯрд┐рдХрдЯ рдирд┐рдХрд╛рд▓ рд╕рдХрддрд╛ рд╣реИред рдЗрд╕ рдЙрдкрдХрд░рдг рдХрд╛ рдирд╛рдо рд╣реИ **Tickey** рдФрд░ рдЗрд╕реЗ [**рдпрд╣рд╛рдВ**](https://github.com/TarlogicSecurity/tickey) рдорд┐рд▓реЗрдЧрд╛ред

<figure><img src="../.gitbook/assets/image (185).png" alt=""><figcaption></figcaption></figure>

### Keytab <a href="#ff38" id="ff38"></a>

{% hint style="warning" %}
рдЖрдорддреМрд░ рдкрд░, рдкреНрд░рддреНрдпреЗрдХ рд╣реЛрд╕реНрдЯ рдХреЛ рдЙрд╕ рд╣реЛрд╕реНрдЯ рдХреЗ рд▓рд┐рдП рдПрдХ рдХреБрдВрдЬреАрдмрдВрдз рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдХреЗ рд╕рд╛рде рдбрд┐рдкреНрд▓реЙрдп рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рд╣реЛрд╕реНрдЯ рдЦреБрдж рдХреЗ рд▓рд┐рдП рдПрдХ рдорд╛рдиреНрдп Credential Cache(CCACHE) Ticket Granting Ticket(TGT) рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред
{% endhint %}

рдЗрд╕рдореЗрдВ **Kerberos principals рдФрд░ encrypted keys** рдХреЗ рдЬреЛрдбрд╝реЗ рд╣реЛрддреЗ рд╣реИрдВ рдЬреЛ рдкреНрд░рд┐рдВрд╕рд┐рдкрд▓ рдХреЗ рд╕рд╛рде рдЬреБрдбрд╝реЗ Kerberos рдкрд╛рд╕рд╡рд░реНрдб рд╕реЗ рдкреНрд░рд╛рдкреНрдд рд╣реЛрддреЗ рд╣реИрдВред рдХреНрдпреЛрдВрдХрд┐ рдпреЗ рдХреБрдВрдЬреА рдкреНрд░рд┐рдВрд╕рд┐рдкрд▓ рдХреЗ рдкрд╛рд╕рд╡рд░реНрдб рд╕реЗ рдкреНрд░рд╛рдкреНрдд рд╣реЛрддреА рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рдЕрдЧрд░ рд╡рд╣ рдкрд╛рд╕рд╡рд░реНрдб рдмрджрд▓ рдЬрд╛рддрд╛ рд╣реИ рддреЛ рдХреБрдВрдЬреАрдмрдВрдз рдЕрдорд╛рдиреНрдп рд╣реЛ рдЬрд╛рдПрдЧреАред

Keytab рдлрд╝рд╛рдЗрд▓реЗрдВ **рдорд╛рдиреНрдп рдЯрд┐рдХрдЯ рдЧреНрд░рд╛рдВрдЯрд┐рдВрдЧ рдЯрд┐рдХрдЯ** (TGT) рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИрдВ, рдЬрд┐рд╕рдХреЗ рд▓рд┐рдП рдпрд╣ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдкреНрд░рдХреНрд░рд┐рдпрд╛ **рдкрд╛рд╕рд╡рд░реНрдб рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реЛрддреА**, рдХреНрдпреЛрдВрдХрд┐ рдЗрд╕рдореЗрдВ рдкрд╛рд╕рд╡рд░реНрдб рд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХреА рдЧрдИ рдХреБрдВрдЬреА рд╣реЛрддреА рд╣реИред

Keytab рдлрд╝рд╛рдЗрд▓ рдХреЛ рдкрд╛рд░реНрд╕ рдХрд░рдирд╛ рдмрд╣реБрдд рдЖрд╕рд╛рди рд╣реИ, рдФрд░ рдЗрд╕реЗ рдХреБрдЫ рддрд░реАрдХреЛрдВ рд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред Keytab рдлрд╝рд╛рдЗрд▓ рдХреЛ рдкрд╛рд░реНрд╕ рдХрд░рдиреЗ рдХрд╛ рд╕рдмрд╕реЗ рдЖрд╕рд╛рди рддрд░реАрдХрд╛ **klist** рдХреЗ рд╕рд╛рде рд╣реИред рджреВрд╕рд░рд╛ рддрд░реАрдХрд╛ рдПрдХ рдорд╣рд╛рди python рдЙрдкрдпреЛрдЧрд┐рддрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ рдЬрд┐рд╕реЗ [Cody Thomas](https://medium.com/u/645ffcef8682?source=post\_page-----77e73d837d6a--------------------------------) рдиреЗ рдмрдирд╛рдпрд╛ рд╣реИред рдЙрдирдХрд╛ [**KeytabParser**](https://github.com/its-a-feature/KeytabParser) рдкрд░рд┐рдпреЛрдЬрдирд╛ рдкреНрд░рд┐рдВрд╕рд┐рдкрд▓ рдФрд░ рдЙрд╕рдХреА рд╕рдВрдмрдВрдзрд┐рдд encrypted keys рдХреЛ рдкрд╛рд░реНрд╕ рдХрд░реЗрдЧреАред

<figure><img src="../.gitbook/assets/image (200).png" alt=""><figcaption></figcaption></figure>

рд╣рдорд▓рд╛рд╡рд░ рдХреБрдВрдЬреАрдмрдВрдз рдлрд╝рд╛рдЗрд▓реЛрдВ рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдХрд╛ рдкреБрдирдГ **рдЙрдкрдпреЛрдЧ** рдХрд░рдХреЗ CCACHE Ticket рдЙрддреНрдкрдиреНрди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, kinit рдмрд╛рдЗрдирд░реА рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗред
```powershell
# Parse keytab
klist -k /rtc/krb5.keytab

# Get TGT
kinit -kt /etc/krb5.keytab host/bastion.westeros.local@WESTEROS.LOCAL
```
<figure><img src="../.gitbook/assets/image (205).png" alt=""><figcaption></figcaption></figure>

### рдЪреАрдЯрд╢реАрдЯ

рдЖрдк рд▓рд┐рдирдХреНрд╕ рдореЗрдВ рдЯрд┐рдХрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХреИрд╕реЗ рдХрд░реЗрдВ рдЗрд╕рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд▓рд┐рдВрдХ рдореЗрдВ рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ:

{% content-ref url="privilege-escalation/linux-active-directory.md" %}
[linux-active-directory.md](privilege-escalation/linux-active-directory.md)
{% endcontent-ref %}

## рдЬрд╛рдВрдЪ

{% hint style="warning" %}
рдЖрдк **ldap** рдФрд░ рдЕрдиреНрдп **рдмрд╛рдЗрдирд░реА** рдЙрдкрдХрд░рдгреЛрдВ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ **рдЬрд╛рдВрдЪ** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдпрд╛ **FreeIPA рд╕рд░реНрд╡рд░ рдХреЗ рдкреЛрд░реНрдЯ 443 рдореЗрдВ рд╡реЗрдм рдкреЗрдЬ рд╕реЗ рдХрдиреЗрдХреНрдЯ рдХрд░рдХреЗ** рднреА рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
{% endhint %}

<figure><img src="../.gitbook/assets/image (184).png" alt=""><figcaption></figcaption></figure>

### рд╣реЛрд╕реНрдЯ, рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдФрд░ рд╕рдореВрд╣ <a href="#4b3b" id="4b3b"></a>

**рд╣реЛрд╕реНрдЯ**, **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛** рдФрд░ **рд╕рдореВрд╣** рдмрдирд╛рдирд╛ рд╕рдВрднрд╡ рд╣реИред рд╣реЛрд╕реНрдЯ рдФрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ "рд╣реЛрд╕реНрдЯ рд╕рдореВрд╣" рдФрд░ "рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕рдореВрд╣" рдХрд╣рд▓рд╛рддреЗ рд╣реИрдВред рдпреЗ **рд╕рдВрдЧрдардирд╛рддреНрдордХ рдЗрдХрд╛рдЗрдпреЛрдВ** (OU) рдХреЗ рд╕рдорд╛рди рд╣реИрдВред

рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ FreeIPA рдореЗрдВ, LDAP рд╕рд░реНрд╡рд░ **рдЕрдирд╛рдордд рдмрд╛рдЗрдВрдб** рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, рдФрд░ рдПрдХ рдмрдбрд╝реА рд╕рдВрдЦреНрдпрд╛ рдореЗрдВ рдбреЗрдЯрд╛ **рдЕрдкреНрд░рдорд╛рдгрд┐рдд** рдЬрд╛рдВрдЪ рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИред рдпрд╣ рдЕрдкреНрд░рдорд╛рдгрд┐рдд рд░реВрдк рд╕реЗ рдЙрдкрд▓рдмреНрдз рд╕рднреА рдбреЗрдЯрд╛ рдХреА рдЬрд╛рдВрдЪ рдХрд░ рд╕рдХрддрд╛ рд╣реИ:
```
ldapsearch -x
```
рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ рдПрдХ **рдкреНрд░рдорд╛рдгрд┐рдд** рд╕рддреНрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ (рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдЕрдиреБрднрд╛рдЧ рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ рддрд╛рдХрд┐ рдЖрдк рдХреИрд╕реЗ рдПрдХ рдкреНрд░рдорд╛рдгрд┐рдд рд╕рддреНрд░ рдХреА рддреИрдпрд╛рд░реА рдХрд░ рд╕рдХреЗрдВред)
```bash
# Get all users of domain
ldapsearch -Y gssapi -b "cn=users,cn=compat,dc=domain_name,dc=local"

# Get users groups
ldapsearch -Y gssapi -b "cn=groups,cn=accounts,dc=domain_name,dc=local"

# Get all the hosts
ldapsearch -Y gssapi -b "cn=computers,cn=accounts,dc=domain_name,dc=local"

# Get hosts groups
ldapsearch -Y gssapi -b "cn=hostgroups,cn=accounts,dc=domain_name,dc=local"
```
рдПрдХ рдбреЛрдореЗрди рдЬреНрд╡рд╛рдЗрди рдХрд┐рдП рдЧрдП рдорд╢реАрди рд╕реЗ рдЖрдк **рд╕реНрдерд╛рдкрд┐рдд рдмрд╛рдЗрдирд░реА** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдбреЛрдореЗрди рдХреА рдЬрд╛рдВрдЪ рдХрд░ рд╕рдХреЗрдВрдЧреЗ:
```bash
ipa user-find
ipa usergroup-find
ipa host-find
ipa host-group-find

-------------------

ipa user-show <username> --all
ipa usergroup-show <user group> --all
ipa host-find <host> --all
ipa hostgroup-show <host group> --all
```
{% hint style="info" %}
**FreeIPA** рдХрд╛ **admin** рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ **AD** рдХреЗ **domain admins** рдХреЗ рд╕рдордХрдХреНрд╖ рд╣реИред
{% endhint %}

### рд╣реИрд╢ <a href="#482b" id="482b"></a>

**IPA рд╕рд░реНрд╡рд░** рдХреЗ **рд░реВрдЯ** рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдкрд╛рд╕рд╡рд░реНрдб **рд╣реИрд╢** рддрдХ рдкрд╣реБрдВрдЪ рд╣реЛрддреА рд╣реИред

* рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХрд╛ рдкрд╛рд╕рд╡рд░реНрдб рд╣реИрд╢ "userPassword" **рд╡рд┐рд╢реЗрд╖рддрд╛** рдореЗрдВ **base64** рдХреЗ рд░реВрдк рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реЛрддрд╛ рд╣реИред рдпрд╣ рд╣реИрд╢ **SSHA512** (рдкреБрд░рд╛рдиреЗ рд╕рдВрд╕реНрдХрд░рдгреЛрдВ рдХреЗ рд▓рд┐рдП FreeIPA) рдпрд╛ **PBKDF2\_SHA256** рд╣реЛ рд╕рдХрддрд╛ рд╣реИред
* рдкрд╛рд╕рд╡рд░реНрдб рдХрд╛ **Nthash** "ipaNTHash" рдореЗрдВ **base64** рдХреЗ рд░реВрдк рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реЛрддрд╛ рд╣реИ рдЕрдЧрд░ рд╕рд┐рд╕реНрдЯрдо рдореЗрдВ **AD** рдХреЗ рд╕рд╛рде **рдПрдХреАрдХрд░рдг** рд╣реИред

рдЗрди рд╣реИрд╢реЛрдВ рдХреЛ рдХреНрд░реИрдХ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП:

тАв рдпрджрд┐ FreeIPA AD рдХреЗ рд╕рд╛рде рдПрдХреАрдХреГрдд рд╣реИ, рддреЛ **ipaNTHash** рдХреЛ рдХреНрд░реИрдХ рдХрд░рдирд╛ рдЖрд╕рд╛рди рд╣реИ: рдЖрдкрдХреЛ **base64** рдХреЛ **рдбрд┐рдХреЛрдб** рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП -> рдЗрд╕реЗ **ASCII** рд╣реЗрдХреНрд╕ рдХреЗ рд░реВрдк рдореЗрдВ рдкреБрдирдГ рдПрдирдХреЛрдб рдХрд░реЗрдВ -> John The Ripper рдпрд╛ **hashcat** рдЖрдкрдХреА рдорджрдж рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЗрд╕реЗ рддреЗрдЬреА рд╕реЗ рдХреНрд░реИрдХ рдХрд░рдиреЗ рдореЗрдВ

тАв рдпрджрд┐ рдкреБрд░рд╛рдиреЗ рд╕рдВрд╕реНрдХрд░рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ **SSHA512** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ: рдЖрдкрдХреЛ **base64** рдХреЛ **рдбрд┐рдХреЛрдб** рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП -> SSHA512 **рд╣реИрд╢** рдвреВрдВрдвреЗрдВ -> John The Ripper рдпрд╛ **hashcat** рдЖрдкрдХреА рдорджрдж рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЗрд╕реЗ рдХреНрд░реИрдХ рдХрд░рдиреЗ рдореЗрдВ

тАв рдпрджрд┐ рдирдпрд╛ рд╕рдВрд╕реНрдХрд░рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ **PBKDF2\_SHA256** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ: рдЖрдкрдХреЛ **base64** рдХреЛ **рдбрд┐рдХреЛрдб** рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП -> PBKDF2\_SHA256 рдвреВрдВрдвреЗрдВ -> рдЗрд╕рдХреА **рд▓рдВрдмрд╛рдИ** 256 рдмрд╛рдЗрдЯ рд╣реЛрддреА рд╣реИред John 256 рдмрд┐рдЯ (32 рдмрд╛рдЗрдЯ) рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░ рд╕рдХрддрд╛ рд╣реИ -> SHA-265 рдХреЛ рдкреНрд╕реЗрдбреЛ-рд░реИрдВрдбрдо рдлрд╝рдВрдХреНрд╢рди рдХреЗ рд░реВрдк рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдмреНрд▓реЙрдХ рд╕рд╛рдЗрдЬрд╝ 32 рдмрд╛рдЗрдЯ рд╣реЛрддреА рд╣реИ -> рдЖрдкрдХреЛ рд╣рдорд╛рд░реЗ PBKDF2\_SHA256 рд╣реИрд╢ рдХреЗ рдкрд╣рд▓реЗ 256 рдмрд┐рдЯ рдХрд╛ рд╣реА рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ -> John The Ripper рдпрд╛ hashcat рдЖрдкрдХреА рдорджрдж рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЗрд╕реЗ рдХреНрд░реИрдХ рдХрд░рдиреЗ рдореЗрдВ

<figure><img src="../.gitbook/assets/image (33).png" alt=""><figcaption></figcaption></figure>

рд╣реИрд╢ рдирд┐рдХрд╛рд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ **FreeIPA рд╕рд░реНрд╡рд░ рдореЗрдВ рд░реВрдЯ** рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП, рд╡рд╣рд╛рдВ рдЖрдк рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЙрдкрдХрд░рдг **`dbscan`** рдЗрдиреНрд╣реЗрдВ рдирд┐рдХрд╛рд▓рдиреЗ рдХреЗ рд▓рд┐рдП:

<figure><img src="../.gitbook/assets/image (196).png" alt=""><figcaption></figcaption></figure>

### HBAC-рдирд┐рдпрдо <a href="#482b" id="482b"></a>

рдпреЗ рдирд┐рдпрдо рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдпрд╛ рд╣реЛрд╕реНрдЯреЛрдВ рдХреЛ рд╕рдВрд╕рд╛рдзрдиреЛрдВ (рд╣реЛрд╕реНрдЯ, рд╕реЗрд╡рд╛рдПрдВ, рд╕реЗрд╡рд╛ рд╕рдореВрд╣...) рдкрд░ рд╡рд┐рд╢реЗрд╖ рдЕрдиреБрдорддрд┐рдпрд╛рдБ рдкреНрд░рджрд╛рди рдХрд░рддреЗ рд╣реИрдВред
```bash
# Enumerate using ldap
ldapsearch -Y gssapi -b "cn=hbac,dc=domain_name,dc=local"
# Using ipa
ipa hbacrule-find
# Show info of rule
ipa hbacrule-show <hbacrule> --all
```
#### рд╕реБрдбреЛ-рдирд┐рдпрдо

FreeIPA рд╕реБрдбреЛ-рдирд┐рдпрдо рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдПрдХ рд╕реЗрдВрдЯреНрд░рд▓рд╛рдЗрдЬрд╝реНрдб рд╕реНрд░реЛрдд рд╕реЗ рд╕реБрдбреЛ рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХрд╛ рдкреНрд░рдмрдВрдзрди рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред рдпреЗ рдирд┐рдпрдорд╕рдВрдЧреНрд░рд╣ рдбреЛрдореЗрди рдореЗрдВ рдирд╛рдорд╛рдВрдХрд┐рдд рд╣реЛрд╕реНрдЯ рдкрд░ рд╕реБрдбреЛ рдХреЗ рд░реВрдк рдореЗрдВ рдХрдорд╛рдВрдбреНрд╕ рдХреЛ рдирд┐рд╖реЗрдзрд┐рдд рдпрд╛ рдЕрдзрд┐рдХрд╛рд░ рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВред рд╣рдо рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдХреЗ рд░реВрдк рдореЗрдВ рдпрд╣ рдЬрд╛рдВрдЪ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдпреЗ рдирд┐рдпрдорд╕рдВрдЧреНрд░рд╣ рдХрд┐рд╕ рд╣реЛрд╕реНрдЯ рдФрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдкрд░ рд▓рд╛рдЧреВ рд╣реЛрддреЗ рд╣реИрдВ, рдФрд░ рдХреМрди рд╕реЗ рдХрдорд╛рдВрдбреНрд╕ рдирд┐рдпрдорд╕рдВрдЧреНрд░рд╣ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЕрдиреБрдорддрд┐ рдкреНрд░рд╛рдкреНрдд рдХрд░рддреЗ рд╣реИрдВред
```bash
# Enumerate using ldap
ldapsearch -Y gssapi -b "cn=sudorules,cn=sudo,dc=domain_name,dc=local"
# Using ipa
ipa sudorule-find
# Show info of rule
ipa sudorule-show <sudorule> --all
```
### рднреВрдорд┐рдХрд╛-рдЖрдзрд╛рд░рд┐рдд рдкрд╣реБрдВрдЪ рдирд┐рдпрдВрддреНрд░рдг

рдкреНрд░рддреНрдпреЗрдХ **рднреВрдорд┐рдХрд╛** рдореЗрдВ рдХрдИ **рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░** рд╣реЛрддреЗ рд╣реИрдВ, рдФрд░ рдЙрди рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдореЗрдВ рдХрдИ **рдЕрдиреБрдорддрд┐рдпрд╛рдБ** рд╣реЛрддреА рд╣реИрдВред рднреВрдорд┐рдХрд╛рдПрдБ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ**, рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ **рд╕рдореВрд╣реЛрдВ**, **рд╣реЛрд╕реНрдЯреЛрдВ**, рд╣реЛрд╕реНрдЯ рд╕рдореВрд╣реЛрдВ рдФрд░ рд╕реЗрд╡рд╛рдУрдВ рдкрд░ рд▓рд╛рдЧреВ рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИрдВред рдЗрд╕ рд╕рдВрдХреЗрдд рдореЗрдВ рдЖрдЗрдП рдлреНрд░реАрдЖрдИрдкреАрдП рдореЗрдВ рдбрд┐рдлрд╝реЙрд▓реНрдЯ "рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреНрд░рд╢рд╛рд╕рдХ" рднреВрдорд┐рдХрд╛ рдХреА рдЪрд░реНрдЪрд╛ рдХрд░реЗрдВред

<figure><img src="../.gitbook/assets/image (161).png" alt=""><figcaption></figcaption></figure>

рдЬреИрд╕рд╛ рдХрд┐ рдКрдкрд░ рдХреА рд╕реНрдХреНрд░реАрдирд╢реЙрдЯ рдореЗрдВ рджрд┐рдЦрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ, "рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреНрд░рд╢рд╛рд╕рдХ" рднреВрдорд┐рдХрд╛ рдореЗрдВ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╣реЛрддреЗ рд╣реИрдВ:

* **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреНрд░рд╢рд╛рд╕рдХ**
* **рд╕рдореВрд╣ рдкреНрд░рд╢рд╛рд╕рдХ**
* **рд╕реНрдЯреЗрдЬ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреНрд░рд╢рд╛рд╕рдХ**

рд╣рдо рдФрд░ рднреА рд╡рд┐рд╕реНрддрд╛рд░ рд╕реЗ рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдкреНрд░рддреНрдпреЗрдХ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдХреЛ рд╕реМрдВрджрд░реНрдп рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП рджрд┐рдП рдЧрдП **рдЕрдиреБрдорддрд┐рдпреЛрдВ** рдХреА рдЧрдгрдирд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

<figure><img src="../.gitbook/assets/image (189).png" alt=""><figcaption></figcaption></figure>

рдЬреИрд╕рд╛ рдХрд┐ рд╣рдо рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ, "рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреНрд░рд╢рд╛рд╕рдХ" рднреВрдорд┐рдХрд╛ рдореЗрдВ рдкрд░реНрдпрд╛рдкреНрдд **рд╕рдВрдмрдВрдзрд┐рдд рдЕрдиреБрдорддрд┐рдпрд╛рдБ** рд╣реЛрддреА рд╣реИрдВред рднреВрдорд┐рдХрд╛рдУрдВ, рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдФрд░ рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреА рд╕рд╛рдорд╛рдиреНрдп рдЕрд╡рдзрд╛рд░рдгрд╛ рдФрд░ рд╕рдВрд░рдЪрдирд╛ рдХреЛ рд╕рдордЭрдирд╛, рдПрдХ рдкрд░реНрдпрд╛рд╡рд░рдг рдореЗрдВ рд╣рдорд▓реЗ рдХреЗ рдорд╛рд░реНрдЧреЛрдВ рдХреА рдкрд╣рдЪрд╛рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реЛ рд╕рдХрддрд╛ рд╣реИред
```bash
# Using ldap
ldapsearch -Y gssapi -b "cn=roles,cn=accounts,dc=westeros,dc=local"
# Using ipa binary
ipa role-find
ipa role-show <role> --all
ipa privilege-find
ipa privilege-show <privilege> --all
ipa permission-find
ipa permission-show <permission> --all
```
### рд╣рдорд▓рд╛ рдкрд░рд┐рджреГрд╢реНрдп рдЙрджрд╛рд╣рд░рдг

[https://posts.specterops.io/attacking-freeipa-part-iii-finding-a-path-677405b5b95e](https://posts.specterops.io/attacking-freeipa-part-iii-finding-a-path-677405b5b95e) рдореЗрдВ рдЖрдк рдПрдХ рд╕рд░рд▓ рдЙрджрд╛рд╣рд░рдг рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдХреИрд╕реЗ рдХреБрдЫ рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ рдбреЛрдореЗрди рдХреЛ рдХрдВрдкреНрд░рдорд╛рдЗрдЬрд╝ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

### Linikatz

[https://github.com/CiscoCXSecurity/linikatz](https://github.com/CiscoCXSecurity/linikatz)

## Privesc

### ~~рд░реВрдЯ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд┐рд░реНрдорд╛рдг~~

{% hint style="warning" %}
рдпрджрд┐ рдЖрдк **рдирд╛рдо `root` рд╡рд╛рд▓реЗ рдирдП рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ**, рддреЛ рдЖрдк рдЙрд╕рдХреА рдЕрдиреБрдХрд░рдг рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЖрдк **рд░реВрдЯ рдХреЗ рд░реВрдк рдореЗрдВ рдХрд┐рд╕реА рднреА рдорд╢реАрди рдореЗрдВ SSH рдХрд░ рд╕рдХреЗрдВрдЧреЗ**ред

**рдпрд╣ рдкреИрдЪ рдХрд░ рджрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред**
{% endhint %}

"**рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреНрд░рд╢рд╛рд╕рдХ**" рдЕрдзрд┐рдХрд╛рд░, рдмрд╣реБрдд рд╢рдХреНрддрд┐рд╢рд╛рд▓реА рд╣реЛрддрд╛ рд╣реИ (рдЬреИрд╕рд╛ рдХрд┐ рдЗрд╕рдХрд╛ рдирд╛рдо рдЗрд╕рдХреА рдкреНрд░рдХрдЯ рдХрд░рддрд╛ рд╣реИ):

<figure><img src="../.gitbook/assets/image (182).png" alt=""><figcaption></figcaption></figure>

рдЗрд╕ рдЕрдзрд┐рдХрд╛рд░ рдХреЗ рд╕рд╛рде, рдкрд░реНрдпрд╛рдкреНрдд рд╕рдВрдЦреНрдпрд╛ рдореЗрдВ рд╡рд┐рднрд┐рдиреНрди рд╢рдХреНрддрд┐рдпрд╛рдВ рд╣реЛрддреА рд╣реИрдВ рдЬреЛ рдкрд░реНрдпрд╛рд╡рд░рдг рдХреЗ рднреАрддрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рдкреНрд░рднрд╛рд╡рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣реЛрддреА рд╣реИрдВред рдЗрд╕ рдЕрдзрд┐рдХрд╛рд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╣рдо **FreeIPA рдбреЛрдореЗрди рдореЗрдВ рдПрдХ рдирдпрд╛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдорд┐рдд \_root_** рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВред

<figure><img src="../.gitbook/assets/image (158).png" alt=""><figcaption></figcaption></figure>

рдЬрдм рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдбреЛрдореЗрди рдореЗрдВ рдмрдирд╛ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рд╣рдо **\_kinit**\_ рдХреЗ рд╕рд╛рде рдЦрд╛рддреЗ рдХреЗ рд▓рд┐рдП рдЯрд┐рдХрдЯ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

<figure><img src="../.gitbook/assets/image (178).png" alt=""><figcaption></figcaption></figure>

рдЕрдм рд╣рдо рдирд╡рдирд┐рд░реНрдорд┐рдд рд░реВрдЯ рдбреЛрдореЗрди рдЦрд╛рддрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ **SSH** рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

<figure><img src="../.gitbook/assets/image (176).png" alt=""><figcaption></figcaption></figure>

рдЬреИрд╕рд╛ рдХрд┐ рджрд┐рдЦрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдпрд╣ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рд╕реНрдерд╛рдиреАрдп рд░реВрдЯ рдЦрд╛рддреЗ рдореЗрдВ рдбреНрд░реЙрдк рдХрд░рддрд╛ рд╣реИ**! рдЗрд╕рд▓рд┐рдП, рдПрдХ рдбреЛрдореЗрди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рд╕реНрдерд╛рдиреАрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд▓рд┐рдП рдмрдирд╛рдХрд░ рд╣рдордиреЗ _root@WESTEROS.LOCAL_ рдЦрд╛рддреЗ рдХрд╛ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХрд┐рдпрд╛ рдФрд░ **рд╕реНрдерд╛рдиреАрдп рд░реВрдЯ рдЦрд╛рддреЗ рдХреЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕рдВрджрд░реНрдн** рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ред

_рдЗрд╕ рдЦреЛрдЬ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рд╡рд┐рд╡рд░рдг рдХреЗ рд▓рд┐рдП_ [_https://posts.specterops.io/attacking-freeipa-part-iv-cve-2020-10747-7c373a1bf66b_](https://posts.specterops.io/attacking-freeipa-part-iv-cve-2020-10747-7c373a1bf66b) _рджреЗрдЦреЗрдВред_\\

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>тШБя╕П HackTricks Cloud тШБя╕П</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ЁЯРж Twitter ЁЯРж</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ЁЯОЩя╕П Twitch ЁЯОЩя╕П</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ЁЯОе Youtube ЁЯОе</strong></a></summary>

* рдХреНрдпрд╛ рдЖрдк **рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХрдВрдкрдиреА рдореЗрдВ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ**? рдХреНрдпрд╛ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХреЛ HackTricks рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ**? рдпрд╛ рдХреНрдпрд╛ рдЖрдкрдХреЛ **PEASS рдХреЗ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдЪрд╛рд╣рд┐рдП**? [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ!
* рдЦреЛрдЬреЗрдВ [**The PEASS Family**](https://opensea.io/collection/the-peass-family), рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFT**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣ред
* рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks swag**](https://peass.creator-spring.com)
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** [**ЁЯТм**](https://emojipedia.org/speech-balloon/) [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рдореБрдЭреЗ **рдЯреНрд╡рд┐рдЯрд░** рдкрд░ **рдлрд╝реЙрд▓реЛ** рдХрд░реЗрдВ [**ЁЯРж**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **рдФрд░** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **рдХреЛ рдлреЙрд▓реЛ рдХрд░рдХреЗред**

</details>
