# FreeIPA рдкреЗрдВрдЯреЗрд╕реНрдЯрд┐рдВрдЧ

<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдЕрдЧрд░ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рдХрд▓реЗрдХреНрд╢рди, [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@hacktricks_live**](https://twitter.com/hacktricks_live)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ рдФрд░** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВ PR рдЬрдорд╛ рдХрд░рдХреЗред

</details>

## рдореВрд▓рднреВрдд рдЬрд╛рдирдХрд╛рд░реА

FreeIPA рдХреЛ Microsoft Windows **Active** **Directory** рдХрд╛ рдПрдХ рдЦреБрд▓рд╛ рд╕реНрд░реЛрдд **рд╡рд┐рдХрд▓реНрдк** рдХреЗ рд░реВрдк рдореЗрдВ рдкреНрд░рд╕реНрддреБрдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рдФрд░ рдпрд╣ рдореБрдЦреНрдп рд░реВрдк рд╕реЗ **Unix** рдкрд░рд┐рд╡реЗрд╢реЛрдВ рдореЗрдВ рдПрдХреАрдХреГрдд рдкреНрд░рдмрдВрдзрди рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдЗрд╕рдореЗрдВ рдПрдХ рдкреВрд░реНрдг **LDAP рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛** рд╢рд╛рдорд┐рд▓ рд╣реИ рдЬрд┐рд╕реЗ MIT **Kerberos** Key Distribution Center рджреНрд╡рд╛рд░рд╛ рд╕рдорд░реНрдерд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдЬреЛ Active Directory рдХреЗ рд╕рдорд╛рди рд╣реИред CA рдФрд░ RA рдкреНрд░рдорд╛рдгрдкрддреНрд░реЛрдВ рдХрд╛ рдкреНрд░рдмрдВрдзрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП Dogtag **Certificate System** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬреЛ рд╕реНрдорд╛рд░реНрдЯрдХрд╛рд░реНрдб рд╕рд╣рд┐рдд **рдмрд╣реБ-рдХрд╛рд░рдХ** рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреНрд╖рдорддрд╛рдУрдВ рдХреЛ рд╕рдХреНрд╖рдо рдХрд░рддрд╛ рд╣реИред Unix рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рдПрдХреАрдХреГрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП SSSD рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

## рдлрд┐рдВрдЧрд░рдкреНрд░рд┐рдВрдЯ

### рдлрд╝рд╛рдЗрд▓реЗрдВ рдФрд░ рдкрд░реНрдпрд╛рд╡рд░рдг рдЪрд░

- `/etc/krb5.conf` рдкрд░ рдлрд╝рд╛рдЗрд▓, рдЬрд┐рд╕рдореЗрдВ рдбреЛрдореЗрди рдореЗрдВ рдкрдВрдЬреАрдХрд░рдг рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ Kerberos рдХреНрд▓рд╛рдЗрдВрдЯ рдЬрд╛рдирдХрд╛рд░реА рд╕рдВрдЧреНрд░рд╣рд┐рдд рд╣реИред рдЗрд╕рдореЗрдВ KDCs рдФрд░ рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рд╕рд░реНрд╡рд░ рдХреЗ рд╕реНрдерд╛рди, рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд╕реЗрдЯрд┐рдВрдЧреНрд╕, рдФрд░ рдореИрдкрд┐рдВрдЧ рд╢рд╛рдорд┐рд▓ рд╣реИрдВред
- `/etc/ipa/default.conf` рдкрд░ рд╕реНрдерд┐рдд рдлрд╝рд╛рдЗрд▓ рдореЗрдВ IPA clients рдФрд░ servers рдХреЗ рд▓рд┐рдП рд╕рд┐рд╕реНрдЯрдо-рд╡реНрдпрд╛рдкреА рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рд╕реЗрдЯ рдХрд┐рдП рдЧрдП рд╣реИрдВред
- рдбреЛрдореЗрди рдХреЗ рднреАрддрд░ рд╣реЛрд╕реНрдЯ рдХреЛ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЗ рд▓рд┐рдП `/etc/krb5.keytab` рдкрд░ `krb5.keytab` рдлрд╝рд╛рдЗрд▓ рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдПред
- рд╡рд┐рднрд┐рдиреНрди рдкрд░реНрдпрд╛рд╡рд░рдг рдЪрд░ (`KRB5CCNAME`, `KRB5_KTNAME`, `KRB5_CONFIG`, `KRB5_KDC_PROFILE`, `KRB5RCACHETYPE`, `KRB5RCACHEDIR`, `KRB5_TRACE`, `KRB5_CLIENT_KTNAME`, `KPROP_PORT`) рдХрд╛ рдЙрдкрдпреЛрдЧ Kerberos рдкреНрд░рдорд╛рдгреАрдХрд░рдг рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рд╡рд┐рд╢рд┐рд╖реНрдЯ рдлрд╝рд╛рдЗрд▓реЛрдВ рдФрд░ рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдХреЛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

### рдмрд╛рдЗрдирд░реА

`ipa`, `kdestroy`, `kinit`, `klist`, `kpasswd`, `ksu`, `kswitch`, рдФрд░ `kvno` рдЬреИрд╕реЗ рдЙрдкрдХрд░рдг FreeIPA рдбреЛрдореЗрди рдХрд╛ рдкреНрд░рдмрдВрдзрди рдХрд░рдиреЗ, Kerberos рдЯрд┐рдХрдЯ рдХрд╛ рд╣реИрдВрдбрд▓рд┐рдВрдЧ, рдкрд╛рд╕рд╡рд░реНрдб рдмрджрд▓рдиреЗ, рдФрд░ рд╕реЗрд╡рд╛ рдЯрд┐рдХрдЯ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдореЗрдВ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИрдВред

### рдиреЗрдЯрд╡рд░реНрдХ

рдПрдХ рдЪрд┐рддреНрд░рдг рдкреНрд░рджрд╛рди рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рдЬреЛ рдПрдХ рд╕рд╛рдзрд╛рд░рдг FreeIPA рд╕рд░реНрд╡рд░ рд╕реЗрдЯрдЕрдк рдХреЛ рджрд░реНрд╢рд╛рддрд╛ рд╣реИред

## рдкреНрд░рдорд╛рдгреАрдХрд░рдг

FreeIPA рдореЗрдВ **Kerberos** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкреНрд░рдорд╛рдгреАрдХрд░рдг, **Active Directory** рдореЗрдВ рдЙрд╕реА рддрд░рд╣ рд╣реИред рдбреЛрдореЗрди рд╕рдВрд╕рд╛рдзрдиреЛрдВ рддрдХ рдкрд╣реБрдВрдЪ рдХреЗ рд▓рд┐рдП рдПрдХ рдорд╛рдиреНрдп Kerberos рдЯрд┐рдХрдЯ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ, рдЬреЛ FreeIPA рдбреЛрдореЗрди рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рд╡рд┐рднрд┐рдиреНрди рд╕реНрдерд╛рдиреЛрдВ рдкрд░ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

### **CCACHE рдЯрд┐рдХрдЯ рдлрд╝рд╛рдЗрд▓реЗрдВ**

CCACHE рдлрд╝рд╛рдЗрд▓реЗрдВ, рдЬреЛ рд╕рд╛рдорд╛рдиреНрдпрдд: **`/tmp`** рдореЗрдВ **600** рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЗ рд╕рд╛рде рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реЛрддреА рд╣реИрдВ, Kerberos рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рд╕рдВрдЧреНрд░рд╣рдг рдХреЗ рд▓рд┐рдП рдмрд╛рдЗрдирд░реА рдкреНрд░рд╛рд░реВрдк рд╣реЛрддреА рд╣реИрдВ, рдЬреЛ рдкреЛрд░реНрдЯреЗрдмрд┐рд▓рд┐рдЯреА рдХреЗ рдХрд╛рд░рдг рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдкреНрд▓реЗрдирдЯреЗрдХреНрд╕реНрдЯ рдкрд╛рд╕рд╡рд░реНрдб рдХреЗ рдмрд┐рдирд╛ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЗ рд▓рд┐рдП рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИрдВред CCACHE рдЯрд┐рдХрдЯ рдХреЛ рдкрд╛рд░реНрд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП `klist` рдХрдорд╛рдВрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдФрд░ рдПрдХ рдорд╛рдиреНрдп CCACHE рдЯрд┐рдХрдЯ рдХреЛ рдкреБрдирдГ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП `KRB5CCNAME` рдХреЛ рдЯрд┐рдХрдЯ рдлрд╝рд╛рдЗрд▓ рдХреЗ рдкрде рдкрд░ рдирд┐рд░реНрдпрд╛рдд рдХрд░рдирд╛ рд╢рд╛рдорд┐рд▓ рд╣реИред

### **Unix Keyring**

рд╡реИрдХрд▓реНрдкрд┐рдХ рд░реВрдк рд╕реЗ, CCACHE рдЯрд┐рдХрдЯ рдХреЛ рд▓рд┐рдирдХреНрд╕ рдХреА рдХреАрд░рд┐рдВрдЧ рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЬреЛ рдЯрд┐рдХрдЯ рдкреНрд░рдмрдВрдзрди рдкрд░ рдЕрдзрд┐рдХ рдирд┐рдпрдВрддреНрд░рдг рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред рдЯрд┐рдХрдЯ рд╕рдВрдЧреНрд░рд╣рдг рдХрд╛ рджрд╛рдпрд░рд╛ рднрд┐рдиреНрди рд╣реЛрддрд╛ рд╣реИ (`KEYRING:name`, `KEYRING:process:name`, `KEYRING:thread:name`, `KEYRING:session:name`, `KEYRING:persistent:uidnumber`), рдЬрд┐рд╕реЗ `klist` рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд▓рд┐рдП рдЗрд╕ рд╕реВрдЪрдирд╛ рдХреЛ рдкрд╛рд░реНрд╕ рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реИред рд╣рд╛рд▓рд╛рдВрдХрд┐, Unix keyring рд╕реЗ CCACHE рдЯрд┐рдХрдЯ рдХреЛ рдкреБрдирдГ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдЪреБрдиреМрддрд┐рдпреЛрдВ рдХрд╛ рд╕рд╛рдордирд╛ рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ **Tickey** рдЬреИрд╕реЗ рдЙрдкрдХрд░рдг рдЙрдкрд▓рдмреНрдз рд╣реИрдВ рдЬреЛ Kerberos рдЯрд┐рдХрдЯ рдирд┐рдХрд╛рд▓рдиреЗ рдХреЗ рд▓рд┐рдП рд╣реИрдВред

### Keytab

Keytab рдлрд╝рд╛рдЗрд▓реЗрдВ, рдЬрд┐рдирдореЗрдВ Kerberos рдкреНрд░рд┐рдВрд╕рд┐рдкрд▓реНрд╕ рдФрд░ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯреЗрдб рдХреБрдВрдЬреА рд╣реЛрддреА рд╣реИрдВ, рдорд╛рдиреНрдп рдЯрд┐рдХрдЯ рдЧреНрд░рд╛рдВрдЯрд┐рдВрдЧ рдЯрд┐рдХрдЯреНрд╕ (TGT) рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИрдВ рдмрд┐рдирд╛ рдкреНрд░рд┐рдВрд╕рд┐рдкрд▓ рдХреЗ рдкрд╛рд╕рд╡рд░реНрдб рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдХреЗ рдмрд┐рдирд╛ред Keytab рдлрд╝рд╛рдЗрд▓реЛрдВ рд╕реЗ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреЛ рдкрд╛рд░реНрд╕ рдФрд░ рдкреБрдирдГ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдЖрд╕рд╛рдиреА рд╕реЗ `klist` рдФрд░ **KeytabParser** рдЬреИрд╕реЗ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЗ рд╕рд╛рде рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

### рдЪреАрдЯрд╢реАрдЯ

рдЖрдк рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд▓рд┐рдВрдХ рдореЗрдВ рд▓рд┐рдирдХреНрд╕ рдореЗрдВ рдЯрд┐рдХрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХреИрд╕реЗ рдХрд░реЗрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ:

{% content-ref url="privilege-escalation/linux-active-directory.md" %}
[linux-active-directory.md](privilege-escalation/linux-active-directory.md)
{% endcontent-ref %}

## рдЧрдгрдирд╛

{% hint style="warning" %}
рдЖрдк **рд▓рдбрдк** рдФрд░ рдЕрдиреНрдп **рдмрд╛рдЗрдирд░реА** рдЙрдкрдХрд░рдгреЛрдВ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ **рдЧрдгрдирд╛** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдпрд╛ **FreeIPA рд╕рд░реНрд╡рд░ рдХреЗ рдкреЛрд░реНрдЯ 443 рдореЗрдВ рд╡реЗрдм рдкреЗрдЬ рд╕реЗ рдХрдиреЗрдХреНрдЯ** рдХрд░рдХреЗ рднреА рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
{% endhint %}

### рд╣реЛрд╕реНрдЯ, рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛, рдФрд░ рд╕рдореВрд╣ <a href="#4b3b" id="4b3b"></a>

**рд╣реЛрд╕реНрдЯ**, **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛**, рдФрд░ **рд╕рдореВрд╣** рдмрдирд╛рдирд╛ рд╕рдВрднрд╡ рд╣реИред рд╣реЛрд╕реНрдЯ рдФрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ "рд╣реЛрд╕реНрдЯ рд╕рдореВрд╣" рдФрд░ "рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕рдореВрд╣" рдХрд╣рд▓рд╛рдиреЗ рд╡рд╛рд▓реЗ рдХрдВрдЯреЗрдирд░ рдореЗрдВ рд╡рд░реНрдЧреАрдХреГрдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдпреЗ **рд╕рдВрдЧрдардирд╛рддреНрдордХ рдЗрдХрд╛рдЗрдпреЛрдВ** (OU) рдХреЗ рд╕рдорд╛рди рд╣реИрдВред

FreeIPA рдореЗрдВ, LDAP рд╕рд░реНрд╡рд░ рдЕрдирд╛рдордд рдкреНрд░рд┐рд╖реНрдарди рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, рдФрд░ рдПрдХ рдмрдбрд╝рд╛ рдбреЗрдЯрд╛ рд╕реЗрдЯ **рдЕрдирдзрд┐рдХреГрдд** рд░реВрдк рд╕реЗ рдЧрдгрдиреАрдп рд╣реИред рдпрд╣ рд╕рднреА рдбреЗрдЯрд╛ рдЕрдирдзрд┐рдХреГрдд рдЙрдкрд▓рдмреНрдз рд╣реИ:
```
ldapsearch -x
```
рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ **рдкреНрд░рдорд╛рдгреАрдХреГрдд** рд╕рддреНрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ (рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдЕрдиреБрднрд╛рдЧ рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ рдЬрд┐рд╕рдореЗрдВ рдкреНрд░рдорд╛рдгреАрдХреГрдд рд╕рддреНрд░ рдХреИрд╕реЗ рддреИрдпрд╛рд░ рдХрд░реЗрдВ рдЗрд╕рдХреА рдЬрд╛рдирдХрд╛рд░реА рд╣реИ)ред
```bash
# Get all users of domain
ldapsearch -Y gssapi -b "cn=users,cn=compat,dc=domain_name,dc=local"

# Get users groups
ldapsearch -Y gssapi -b "cn=groups,cn=accounts,dc=domain_name,dc=local"

# Get all the hosts
ldapsearch -Y gssapi -b "cn=computers,cn=accounts,dc=domain_name,dc=local"

# Get hosts groups
ldapsearch -Y gssapi -b "cn=hostgroups,cn=accounts,dc=domain_name,dc=local"
```
рдПрдХ рдбреЛрдореЗрди рдЬреНрд╡рд╛рдЗрди рдорд╢реАрди рд╕реЗ рдЖрдкрдХреЛ **рд╕реНрдерд╛рдкрд┐рдд рдмрд╛рдЗрдирд░реА** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдбреЛрдореЗрди рдХреЛ рдЬрд╛рдВрдЪрдиреЗ рдХреА рд╕реБрд╡рд┐рдзрд╛ рд╣реЛрдЧреА:
```bash
ipa user-find
ipa usergroup-find
ipa host-find
ipa host-group-find

-------------------

ipa user-show <username> --all
ipa usergroup-show <user group> --all
ipa host-find <host> --all
ipa hostgroup-show <host group> --all
```
{% hint style="info" %}
**FreeIPA** рдХрд╛ **рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ** рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ **AD** рд╕реЗ **рдбреЛрдореЗрди рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХреЛрдВ** рдХреЗ рд╕рдордХрдХреНрд╖ рд╣реИред
{% endhint %}

### рд╣реИрд╢ <a href="#482b" id="482b"></a>

**IPA рд╕рд░реНрд╡рд░** рдХрд╛ **рд░реВрдЯ** рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ **рдкрд╛рд╕рд╡рд░реНрдб рд╣реИрд╢** рддрдХ рдкрд╣реБрдВрдЪ рд░рдЦрддрд╛ рд╣реИред

* рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХрд╛ рдкрд╛рд╕рд╡рд░реНрдб рд╣реИрд╢ тАЬ**userPassword**тАЭ **рд╡рд┐рд╢реЗрд╖рддрд╛** рдореЗрдВ **base64** рдХреЗ рд░реВрдк рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реЛрддрд╛ рд╣реИред рдпрд╣ рд╣реИрд╢ **SSHA512** (рдкреБрд░рд╛рдиреЗ рд╕рдВрд╕реНрдХрд░рдгреЛрдВ рдХреЗ рд▓рд┐рдП FreeIPA) рдпрд╛ **PBKDF2\_SHA256** рд╣реЛ рд╕рдХрддрд╛ рд╣реИред
* рдкрд╛рд╕рд╡рд░реНрдб рдХрд╛ **Nthash** тАЬ**ipaNTHash**тАЭ рдореЗрдВ **base64** рдХреЗ рд░реВрдк рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реЛрддрд╛ рд╣реИ рдЕрдЧрд░ рд╕рд┐рд╕реНрдЯрдо рдореЗрдВ **AD** рдХреЗ рд╕рд╛рде **рдПрдХреАрдХрд░рдг** рд╣реИред

рдЗрди рд╣реИрд╢реЛрдВ рдХреЛ рдХреНрд░реИрдХ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП:

тАв рдпрджрд┐ FreeIPA AD рдХреЗ рд╕рд╛рде рдПрдХреАрдХреГрдд рд╣реИ, рддреЛ **ipaNTHash** рдХреЛ рдХреНрд░реИрдХ рдХрд░рдирд╛ рдЖрд╕рд╛рди рд╣реИ: рдЖрдкрдХреЛ **base64** рдХреЛ рдбреАрдХреЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП -> рдЗрд╕реЗ **ASCII** рд╣реЗрдХреНрд╕ рдХреЗ рд░реВрдк рдореЗрдВ рдкреБрдирдГ рдПрдирдХреЛрдб рдХрд░реЗрдВ -> John The Ripper рдпрд╛ **hashcat** рдЖрдкрдХреЛ рдЗрд╕реЗ рддреЗрдЬреА рд╕реЗ рдХреНрд░реИрдХ рдХрд░рдиреЗ рдореЗрдВ рдорджрдж рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ

тАв рдпрджрд┐ рдкреБрд░рд╛рдирд╛ рд╕рдВрд╕реНрдХрд░рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рддреЛ **SSHA512** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ: рдЖрдкрдХреЛ **base64** рдХреЛ рдбреАрдХреЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП -> SSHA512 **рд╣реИрд╢** рдЦреЛрдЬреЗрдВ -> John The Ripper рдпрд╛ **hashcat** рдЖрдкрдХреЛ рдЗрд╕реЗ рдХреНрд░реИрдХ рдХрд░рдиреЗ рдореЗрдВ рдорджрдж рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ

тАв рдпрджрд┐ рдирдпрд╛ рд╕рдВрд╕реНрдХрд░рдг рдХрд╛ FreeIPA рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рддреЛ **PBKDF2\_SHA256** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ: рдЖрдкрдХреЛ **base64** рдХреЛ рдбреАрдХреЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП -> PBKDF2\_SHA256 рдЦреЛрдЬреЗрдВ -> рдЗрд╕рдХреА **рд▓рдВрдмрд╛рдИ** 256 рдмрд╛рдЗрдЯ рд╣реИред John 256 рдмрд┐рдЯ (32 рдмрд╛рдЗрдЯ) рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░ рд╕рдХрддрд╛ рд╣реИ -> SHA-265 рдХреЛ рдкреНрд╕реЗрдбреЛ-рд░реИрдВрдбрдо рдлрд╝рдВрдХреНрд╢рди рдХреЗ рд░реВрдк рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдмреНрд▓реЙрдХ рдХрд╛ рдЖрдХрд╛рд░ 32 рдмрд╛рдЗрдЯ рд╣реИ -> рдЖрдкрдХреЛ рдХреЗрд╡рд▓ PBKDF2\_SHA256 рд╣реИрд╢ рдХреЗ рдкрд╣рд▓реЗ 256 рдмрд┐рдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╣реИ -> John The Ripper рдпрд╛ hashcat рдЖрдкрдХреЛ рдЗрд╕реЗ рдХреНрд░реИрдХ рдХрд░рдиреЗ рдореЗрдВ рдорджрдж рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ

<figure><img src="../.gitbook/assets/image (33).png" alt=""><figcaption></figcaption></figure>

рд╣реИрд╢реЛрдВ рдХреЛ рдирд┐рдХрд╛рд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ **FreeIPA рд╕рд░реНрд╡рд░** рдореЗрдВ **рд░реВрдЯ** рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП, рд╡рд╣рд╛рдВ рдЖрдк рдЙрдиреНрд╣реЗрдВ рдирд┐рдХрд╛рд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдХрд░рдг **`dbscan`** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

<figure><img src="../.gitbook/assets/image (196).png" alt=""><figcaption></figcaption></figure>

### HBAC-рдирд┐рдпрдо <a href="#482b" id="482b"></a>

рдпреЗ рдирд┐рдпрдо рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдпрд╛ рд╣реЛрд╕реНрдЯреЛрдВ рдХреЛ рд╕рдВрд╕рд╛рдзрдиреЛрдВ (рд╣реЛрд╕реНрдЯ, рд╕реЗрд╡рд╛рдПрдВ, рд╕реЗрд╡рд╛ рд╕рдореВрд╣...) рдкрд░ рд╡рд┐рд╢реЗрд╖ рдЕрдиреБрдорддрд┐рдпрд╛рдБ рдкреНрд░рджрд╛рди рдХрд░рддреЗ рд╣реИрдВред
```bash
# Enumerate using ldap
ldapsearch -Y gssapi -b "cn=hbac,dc=domain_name,dc=local"
# Using ipa
ipa hbacrule-find
# Show info of rule
ipa hbacrule-show <hbacrule> --all
```
#### рд╕реБрдбреЛ-рдирд┐рдпрдо

FreeIPA рд╕реБрдбреЛ-рдирд┐рдпрдо рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ **рд╕реБрдбреЛ рдЕрдиреБрдорддрд┐рдпреЛрдВ** рдкрд░ рдХреЗрдВрджреНрд░реАрдХреГрдд рдирд┐рдпрдВрддреНрд░рдг рд╕рдХреНрд╖рдо рдХрд░рддрд╛ рд╣реИред рдпреЗ рдирд┐рдпрдо рдбреЛрдореЗрди рдХреЗ рд╣реЛрд╕реНрдЯ рдкрд░ рд╕реБрдбреЛ рдХреЗ рд╕рд╛рде рдХрдорд╛рдВрдб рдХрд╛ рдирд┐рд╖реЗрдз рдпрд╛ рдЕрдиреБрдорддрд┐ рджреЗрддреЗ рд╣реИрдВред рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рд╕рдВрднрд╛рд╡рд┐рдд рд░реВрдк рд╕реЗ рдЗрди рдирд┐рдпрдорд╕рдореВрд╣реЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░рдХреЗ рд▓рд╛рдЧреВ рд╣реЛрдиреЗ рд╡рд╛рд▓реЗ рд╣реЛрд╕реНрдЯ, рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛, рдФрд░ рдЕрдиреБрдордд рдХрдорд╛рдВрдбреНрд╕ рдХреА рдкрд╣рдЪрд╛рди рдХрд░ рд╕рдХрддрд╛ рд╣реИред
```bash
# Enumerate using ldap
ldapsearch -Y gssapi -b "cn=sudorules,cn=sudo,dc=domain_name,dc=local"
# Using ipa
ipa sudorule-find
# Show info of rule
ipa sudorule-show <sudorule> --all
```
### рднреВрдорд┐рдХрд╛-рдЖрдзрд╛рд░рд┐рдд рдкрд╣реБрдВрдЪ рдирд┐рдпрдВрддреНрд░рдг

рдПрдХ **рднреВрдорд┐рдХрд╛** рд╡рд┐рднрд┐рдиреНрди **рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ** рд╕реЗ рдмрдиреА рд╣реЛрддреА рд╣реИ, рдкреНрд░рддреНрдпреЗрдХ рдореЗрдВ рдХрдИ **рдЕрдиреБрдорддрд┐рдпрд╛рдБ** рд╢рд╛рдорд┐рд▓ рд╣реЛрддреА рд╣реИрдВред рдпреЗ рднреВрдорд┐рдХрд╛рдПрдБ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ, рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ **рд╕рдореВрд╣реЛрдВ**, **рд╣реЛрд╕реНрдЯ**, рд╣реЛрд╕реНрдЯ рд╕рдореВрд╣реЛрдВ, рдФрд░ рд╕реЗрд╡рд╛рдУрдВ рдХреЛ рд╕реМрдВрдкреА рдЬрд╛ рд╕рдХрддреА рд╣реИрдВред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЗрд╕ рд╕рдВрд░рдЪрдирд╛ рдХреЛ рджрд┐рдЦрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдлреНрд░реАрдЖрдИрдкреАрдП рдореЗрдВ рдбрд┐рдлрд╝реЙрд▓реНрдЯ "рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреНрд░рд╢рд╛рд╕рдХ" рднреВрдорд┐рдХрд╛ рдХреЛ рдзреНрдпрд╛рди рдореЗрдВ рд░рдЦреЗрдВред

рднреВрдорд┐рдХрд╛ `рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреНрд░рд╢рд╛рд╕рдХ` рдХреЗ рдпреЗ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╣реИрдВ:

* **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреНрд░рд╢рд╛рд╕рдХ**
* **рд╕рдореВрд╣ рдкреНрд░рд╢рд╛рд╕рдХ**
* **рд╕реНрдЯреЗрдЬ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреНрд░рд╢рд╛рд╕рдХ**

рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрдорд╛рдВрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рднреВрдорд┐рдХрд╛рдПрдБ, рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдФрд░ рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЛ рдЧрдгрдирд╛ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:
```bash
# Using ldap
ldapsearch -Y gssapi -b "cn=roles,cn=accounts,dc=westeros,dc=local"
# Using ipa binary
ipa role-find
ipa role-show <role> --all
ipa privilege-find
ipa privilege-show <privilege> --all
ipa permission-find
ipa permission-show <permission> --all
```
### рд╣рдорд▓рд╛ рдкрд░рд┐рджреГрд╢реНрдп рдЙрджрд╛рд╣рд░рдг

[https://posts.specterops.io/attacking-freeipa-part-iii-finding-a-path-677405b5b95e](https://posts.specterops.io/attacking-freeipa-part-iii-finding-a-path-677405b5b95e) рдореЗрдВ рдЖрдкрдХреЛ рдХреБрдЫ рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХрд╛ рдПрдХ рд╕рд░рд▓ рдЙрджрд╛рд╣рд░рдг рдорд┐рд▓реЗрдЧрд╛ рдЬрд┐рд╕рд╕реЗ рдбреЛрдореЗрди рдХреЛ рдХрдВрдкреНрд░рдорд╛рдЗрдЬ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

### Linikatz/LinikatzV2

* [https://github.com/Orange-Cyberdefense/LinikatzV2](https://github.com/Orange-Cyberdefense/LinikatzV2)
* [https://github.com/CiscoCXSecurity/linikatz](https://github.com/CiscoCXSecurity/linikatz)

## Privesc

### ~~рд░реВрдЯ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд┐рд░реНрдорд╛рдг~~

{% hint style="warning" %}
рдпрджрд┐ рдЖрдк **рдирд╛рдо `root` рд╡рд╛рд▓реЗ рдирдП рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ**, рддреЛ рдЖрдк рдЙрд╕рдХреА рдЕрдиреБрдХрд░рдг рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЖрдк **рдХрд┐рд╕реА рднреА рдорд╢реАрди рдореЗрдВ рд░реВрдЯ рдХреЗ рд░реВрдк рдореЗрдВ SSH рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред**

**рдпрд╣ рд╕реБрдзрд╛рд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред**
{% endhint %}

рдЖрдк [https://posts.specterops.io/attacking-freeipa-part-iv-cve-2020-10747-7c373a1bf66b](https://posts.specterops.io/attacking-freeipa-part-iv-cve-2020-10747-7c373a1bf66b) рдореЗрдВ рдПрдХ рд╡рд┐рд╕реНрддреГрдд рд╡реНрдпрд╛рдЦреНрдпрд╛ рдХреА рдЬрд╛рдВрдЪ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

# рд╕рдВрджрд░реНрдн
* [https://posts.specterops.io/attacking-freeipa-part-iv-cve-2020-10747-7c373a1bf66b](https://posts.specterops.io/attacking-freeipa-part-iv-cve-2020-10747-7c373a1bf66b)
* [https://posts.specterops.io/attacking-freeipa-part-i-authentication-77e73d837d6a](https://posts.specterops.io/attacking-freeipa-part-i-authentication-77e73d837d6a)
* [https://posts.specterops.io/attacking-freeipa-part-ii-enumeration-ad27224371e1](https://posts.specterops.io/attacking-freeipa-part-ii-enumeration-ad27224371e1)
* [https://www.youtube.com/watch?v=9dOu-7BTwPQ](https://www.youtube.com/watch?v=9dOu-7BTwPQ)

<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА HackTricks рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд рд╣реЛ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рдХрд▓реЗрдХреНрд╢рди [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдЦреЛрдЬреЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@hacktricks_live**](https://twitter.com/hacktricks_live)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ** рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдФрд░ рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдХреНрд▓рд╛рдЙрдб рдЧрд┐рдЯрд╣рдм рд░реЗрдкреЛ рдореЗрдВ рдкреАрдЖрд░ рдЬрдорд╛ рдХрд░рдХреЗред

</details>
