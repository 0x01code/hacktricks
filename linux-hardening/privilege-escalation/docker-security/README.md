# Docker рд╕реБрд░рдХреНрд╖рд╛

<details>

<summary><strong>AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рд╢реВрдиреНрдп рд╕реЗ рд▓реЗрдХрд░ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ**, рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ [**telegram group**](https://t.me/peass) рдореЗрдВ рдпрд╛ **Twitter** рдкрд░ ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm) рдХреЛ **рдлреЙрд▓реЛ рдХрд░реЗрдВ**.
* **рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, HackTricks** рдХреЗ [**github repos**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ.

</details>

<figure><img src="../../../.gitbook/assets/image (3) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
[**Trickest**](https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЖрд╕рд╛рдиреА рд╕реЗ **рд╡рд░реНрдХрдлреНрд▓реЛрдЬрд╝ рдХреЛ рдмрд┐рд▓реНрдб рдФрд░ рдСрдЯреЛрдореЗрдЯ** рдХрд░реЗрдВ рдЬреЛ рджреБрдирд┐рдпрд╛ рдХреЗ **рд╕рдмрд╕реЗ рдЙрдиреНрдирдд** рд╕рдореБрджрд╛рдп рдЯреВрд▓реНрд╕ рджреНрд╡рд╛рд░рд╛ рд╕рдВрдЪрд╛рд▓рд┐рдд рд╣реЛрддреЗ рд╣реИрдВ.\
рдЖрдЬ рд╣реА рдПрдХреНрд╕реЗрд╕ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## **рдмреЗрд╕рд┐рдХ Docker Engine рд╕реБрд░рдХреНрд╖рд╛**

Docker engine рдХрдВрдЯреЗрдирд░реНрд╕ рдХреЛ рдЪрд▓рд╛рдиреЗ рдФрд░ рдкреНрд░рдмрдВрдзрд┐рдд рдХрд░рдиреЗ рдХрд╛ рдореБрдЦреНрдп рдХрд╛рд░реНрдп рдХрд░рддрд╛ рд╣реИ. Docker engine Linux kernel рдХреА рд╡рд┐рд╢реЗрд╖рддрд╛рдУрдВ рдЬреИрд╕реЗ рдХрд┐ **Namespaces** рдФрд░ **Cgroups** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ рддрд╛рдХрд┐ рдХрдВрдЯреЗрдирд░реНрд╕ рдХреЗ рдмреАрдЪ рдмреБрдирд┐рдпрд╛рджреА **рдЕрд▓рдЧрд╛рд╡** рдкреНрд░рджрд╛рди рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗ. рдпрд╣ **Capabilities dropping**, **Seccomp**, **SELinux/AppArmor рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдмреЗрд╣рддрд░ рдЕрд▓рдЧрд╛рд╡** рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рднреА рдХрд░рддрд╛ рд╣реИ.

рдЕрдВрдд рдореЗрдВ, рдПрдХ **auth plugin** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рджреНрд╡рд╛рд░рд╛ рдХрд┐рдП рдЬрд╛ рд╕рдХрдиреЗ рд╡рд╛рд▓реЗ рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЛ **рд╕реАрдорд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ**.

![](<../../../.gitbook/assets/image (625) (1) (1).png>)

### **Docker engine рд╕реБрд░рдХреНрд╖рд┐рдд рдкрд╣реБрдБрдЪ**

Docker client Docker engine рддрдХ **рд╕реНрдерд╛рдиреАрдп рд░реВрдк рд╕реЗ Unix socket рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдпрд╛ рджреВрд░рд╕реНрде рд░реВрдк рд╕реЗ http** рдорд╛рдзреНрдпрдо рд╕реЗ рдкрд╣реБрдБрдЪ рд╕рдХрддрд╛ рд╣реИ. рдЗрд╕реЗ рджреВрд░рд╕реНрде рд░реВрдк рд╕реЗ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, https рдФрд░ **TLS** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдЖрд╡рд╢реНрдпрдХ рд╣реИ рддрд╛рдХрд┐ рдЧреЛрдкрдиреАрдпрддрд╛, рдЕрдЦрдВрдбрддрд╛ рдФрд░ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗ.

рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ Unix socket `unix:///var/`\
`run/docker.sock` рдкрд░ рд╕реБрдирддрд╛ рд╣реИ рдФрд░ Ubuntu рд╡рд┐рддрд░рдгреЛрдВ рдореЗрдВ, Docker рд╕реНрдЯрд╛рд░реНрдЯ рд╡рд┐рдХрд▓реНрдк `/etc/default/docker` рдореЗрдВ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ. Docker API рдФрд░ рдХреНрд▓рд╛рдЗрдВрдЯ рдХреЛ Docker engine рддрдХ рджреВрд░рд╕реНрде рд░реВрдк рд╕реЗ рдкрд╣реБрдБрдЪрдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ **Docker daemon рдХреЛ http socket рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЙрдЬрд╛рдЧрд░ рдХрд░рдирд╛ рд╣реЛрдЧрд╛**. рдпрд╣ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:
```bash
DOCKER_OPTS="-D -H unix:///var/run/docker.sock -H
tcp://192.168.56.101:2376" -> add this to /etc/default/docker
Sudo service docker restart -> Restart Docker daemon
```
```
Docker daemon рдХреЛ http рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЙрдЬрд╛рдЧрд░ рдХрд░рдирд╛ рдЕрдЪреНрдЫреА рдкреНрд░рдерд╛ рдирд╣реАрдВ рд╣реИ рдФрд░ рдЗрд╕реЗ https рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХрдиреЗрдХреНрд╢рди рдХреЛ рд╕реБрд░рдХреНрд╖рд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред рджреЛ рд╡рд┐рдХрд▓реНрдк рд╣реИрдВ: рдкрд╣рд▓рд╛ рд╡рд┐рдХрд▓реНрдк **client рджреНрд╡рд╛рд░рд╛ server рдХреА рдкрд╣рдЪрд╛рди рдХреА рдкреБрд╖реНрдЯрд┐** рдХреЗ рд▓рд┐рдП рд╣реИ рдФрд░ рджреВрд╕рд░реЗ рд╡рд┐рдХрд▓реНрдк рдореЗрдВ **client рдФрд░ server рджреЛрдиреЛрдВ рдПрдХ рджреВрд╕рд░реЗ рдХреА рдкрд╣рдЪрд╛рди рдХреА рдкреБрд╖реНрдЯрд┐ рдХрд░рддреЗ рд╣реИрдВ**ред рдкреНрд░рдорд╛рдгрдкрддреНрд░ server рдХреА рдкрд╣рдЪрд╛рди рд╕реНрдерд╛рдкрд┐рдд рдХрд░рддреЗ рд╣реИрдВред рджреЛрдиреЛрдВ рд╡рд┐рдХрд▓реНрдкреЛрдВ рдХрд╛ рдЙрджрд╛рд╣рд░рдг рджреЗрдЦрдиреЗ рдХреЗ рд▓рд┐рдП [**рдЗрд╕ рдкреГрд╖реНрда рдХреЛ рджреЗрдЦреЗрдВ**](https://sreeninet.wordpress.com/2016/03/06/docker-security-part-3engine-access/).

### **Container image рд╕реБрд░рдХреНрд╖рд╛**

Container images рдпрд╛ рддреЛ private repository рдпрд╛ public repository рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рдХреА рдЬрд╛рддреА рд╣реИрдВред Docker рджреНрд╡рд╛рд░рд╛ Container images рдХреЛ рд╕рдВрдЧреНрд░рд╣рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╡рд┐рдХрд▓реНрдк рдкреНрд░рджрд╛рди рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ:

* [Docker hub](https://hub.docker.com) тАУ рдпрд╣ Docker рджреНрд╡рд╛рд░рд╛ рдкреНрд░рджрд╛рди рдХреА рдЧрдИ рдПрдХ public registry рд╕реЗрд╡рд╛ рд╣реИ
* [Docker registry](https://github.com/%20docker/distribution) тАУ рдпрд╣ рдПрдХ open source рдкрд░рд┐рдпреЛрдЬрдирд╛ рд╣реИ рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ users рдЕрдкрдиреА registry рд╣реЛрд╕реНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
* [Docker trusted registry](https://www.docker.com/docker-trusted-registry) тАУ рдпрд╣ Docker рдХрд╛ commercial implementation рд╣реИ Docker registry рдХрд╛ рдФрд░ рдпрд╣ LDAP directory service integration рдХреЗ рд╕рд╛рде role based user authentication рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред

### Image Scanning

Containers рдореЗрдВ **security vulnerabilities** рд╣реЛ рд╕рдХрддреА рд╣реИрдВ рдпрд╛ рддреЛ base image рдХреЗ рдХрд╛рд░рдг рдпрд╛ рдлрд┐рд░ base image рдХреЗ рдКрдкрд░ рд╕реНрдерд╛рдкрд┐рдд рд╕реЙрдлреНрдЯрд╡реЗрдпрд░ рдХреЗ рдХрд╛рд░рдгред Docker рдПрдХ рдкрд░рд┐рдпреЛрдЬрдирд╛ рдкрд░ рдХрд╛рдо рдХрд░ рд░рд╣рд╛ рд╣реИ рдЬрд┐рд╕реЗ **Nautilus** рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬреЛ Containers рдХреА security scan рдХрд░рддрд╛ рд╣реИ рдФрд░ vulnerabilities рдХреА рд╕реВрдЪреА рдмрдирд╛рддрд╛ рд╣реИред Nautilus vulnerability repository рдХреЗ рд╕рд╛рде рдкреНрд░рддреНрдпреЗрдХ Container image layer рдХреА рддреБрд▓рдирд╛ рдХрд░рдХреЗ security holes рдХреА рдкрд╣рдЪрд╛рди рдХрд░рддрд╛ рд╣реИред

рдЕрдзрд┐рдХ [**рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рдпрд╣ рдкрдврд╝реЗрдВ**](https://docs.docker.com/engine/scan/).

* **`docker scan`**

**`docker scan`** command рдЖрдкрдХреЛ рдореМрдЬреВрджрд╛ Docker images рдХреЛ image name рдпрд╛ ID рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ scan рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, hello-world image рдХреЛ scan рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд command рдЪрд▓рд╛рдПрдВ:
```
```bash
docker scan hello-world

Testing hello-world...

Organization:      docker-desktop-test
Package manager:   linux
Project name:      docker-image|hello-world
Docker image:      hello-world
Licenses:          enabled

тЬУ Tested 0 dependencies for known issues, no vulnerable paths found.

Note that we do not currently have vulnerability data for your image.
```
* [**`trivy`**](https://github.com/aquasecurity/trivy)
```bash
trivy -q -f json <ontainer_name>:<tag>
```
* [**`snyk`**](https://docs.snyk.io/snyk-cli/getting-started-with-the-cli)
```bash
snyk container test <image> --json-file-output=<output file> --severity-threshold=high
```
* [**`clair-scanner`**](https://github.com/arminc/clair-scanner)
```bash
clair-scanner -w example-alpine.yaml --ip YOUR_LOCAL_IP alpine:3.5
```
### Docker рдЗрдореЗрдЬ рд╕рд╛рдЗрдирд┐рдВрдЧ

Docker Container рдЗрдореЗрдЬреЗрдЬ рдХреЛ рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдпрд╛ рдирд┐рдЬреА рд░рдЬрд┐рд╕реНрдЯреНрд░реА рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред Container рдЗрдореЗрдЬреЗрдЬ рдХреЛ рд╕рд╛рдЗрди рдХрд░рдирд╛ рдЖрд╡рд╢реНрдпрдХ рд╣реИ рддрд╛рдХрд┐ рдпрд╣ рдкреБрд╖реНрдЯрд┐ рдХреА рдЬрд╛ рд╕рдХреЗ рдХрд┐ рдЗрдореЗрдЬреЗрдЬ рдореЗрдВ рдЫреЗрдбрд╝рдЫрд╛рдбрд╝ рдирд╣реАрдВ рдХреА рдЧрдИ рд╣реИред рд╕рд╛рдордЧреНрд░реА рдкреНрд░рдХрд╛рд╢рдХ Container рдЗрдореЗрдЬ рдХреЛ рд╕рд╛рдЗрди рдХрд░рдиреЗ рдФрд░ рдЙрд╕реЗ рд░рдЬрд┐рд╕реНрдЯреНрд░реА рдореЗрдВ рдзрдХреЗрд▓рдиреЗ рдХрд╛ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИред\
рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд Docker рд╕рд╛рдордЧреНрд░реА рд╡рд┐рд╢реНрд╡рд╛рд╕ рдкрд░ рдХреБрдЫ рд╡рд┐рд╡рд░рдг рд╣реИрдВ:

* Docker рд╕рд╛рдордЧреНрд░реА рд╡рд┐рд╢реНрд╡рд╛рд╕ [Notary open source project](https://github.com/docker/notary) рдХрд╛ рдПрдХ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рд╣реИред Notary open source project [The Update Framework (TUF) project](https://theupdateframework.github.io) рдкрд░ рдЖрдзрд╛рд░рд┐рдд рд╣реИред
* Docker рд╕рд╛рдордЧреНрд░реА рд╡рд┐рд╢реНрд╡рд╛рд╕ рдХреЛ `export DOCKER_CONTENT_TRUST=1` рдХреЗ рд╕рд╛рде рд╕рдХреНрд╖рдо рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред Docker рд╕рдВрд╕реНрдХрд░рдг 1.10 рдХреЗ рдЕрдиреБрд╕рд╛рд░, рд╕рд╛рдордЧреНрд░реА рд╡рд┐рд╢реНрд╡рд╛рд╕ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рд╕рдХреНрд╖рдо **рдирд╣реАрдВ** рд╣реИред
* **рдЬрдм** рд╕рд╛рдордЧреНрд░реА рд╡рд┐рд╢реНрд╡рд╛рд╕ **рд╕рдХреНрд╖рдо рд╣реЛрддрд╛ рд╣реИ**, рд╣рдо рдХреЗрд╡рд▓ рд╕рд╛рдЗрди рдХреА рдЧрдИ рдЗрдореЗрдЬреЗрдЬ рд╣реА **рдЦреАрдВрдЪ рд╕рдХрддреЗ рд╣реИрдВ**ред рдЬрдм рдЗрдореЗрдЬ рдХреЛ рдзрдХреЗрд▓рд╛ рдЬрд╛рддрд╛ рд╣реИ, рд╣рдореЗрдВ рдЯреИрдЧрд┐рдВрдЧ рдХреБрдВрдЬреА рджрд░реНрдЬ рдХрд░рдиреА рд╣реЛрддреА рд╣реИред
* рдЬрдм рдкреНрд░рдХрд╛рд╢рдХ рдкрд╣рд▓реА **рдмрд╛рд░** docker push рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЗрдореЗрдЬ рдХреЛ **рдзрдХреЗрд▓рддрд╛ рд╣реИ**, рддрдм **рд░реВрдЯ рдХреБрдВрдЬреА рдФрд░ рдЯреИрдЧрд┐рдВрдЧ рдХреБрдВрдЬреА** рдХреЗ рд▓рд┐рдП рдПрдХ **рдкрд╛рд╕рдлреНрд░реЗрдЬ** рджрд░реНрдЬ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред рдЕрдиреНрдп рдХреБрдВрдЬрд┐рдпрд╛рдБ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдЙрддреНрдкрдиреНрди рдХреА рдЬрд╛рддреА рд╣реИрдВред
* Docker рдиреЗ Yubikey рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╣рд╛рд░реНрдбрд╡реЗрдпрд░ рдХреБрдВрдЬрд┐рдпреЛрдВ рдХреЗ рд▓рд┐рдП рднреА рд╕рдорд░реНрдерди рдЬреЛрдбрд╝рд╛ рд╣реИ рдФрд░ рд╡рд┐рд╡рд░рдг [рдпрд╣рд╛рдБ](https://blog.docker.com/2015/11/docker-content-trust-yubikey/) рдЙрдкрд▓рдмреНрдз рд╣реИрдВред

рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╡рд╣ **рддреНрд░реБрдЯрд┐** рд╣реИ рдЬреЛ рд╣рдореЗрдВ рдорд┐рд▓рддреА рд╣реИ рдЬрдм **рд╕рд╛рдордЧреНрд░реА рд╡рд┐рд╢реНрд╡рд╛рд╕ рд╕рдХреНрд╖рдо рд╣реЛрддрд╛ рд╣реИ рдФрд░ рдЗрдореЗрдЬ рд╕рд╛рдЗрди рдирд╣реАрдВ рдХреА рдЧрдИ рд╣реЛрддреА рд╣реИ**ред
```shell-session
$ docker pull smakam/mybusybox
Using default tag: latest
No trust data for latest
```
рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЖрдЙрдЯрдкреБрдЯ рдореЗрдВ **Docker hub рдкрд░ image рдХреЛ signing рд╕рдХреНрд╖рдо рдХреЗ рд╕рд╛рде push рдХрд┐рдпрд╛ рдЬрд╛ рд░рд╣рд╛ рд╣реИ** рджрд┐рдЦрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИред рдЪреВрдВрдХрд┐ рдпрд╣ рдкрд╣рд▓реА рдмрд╛рд░ рдирд╣реАрдВ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕реЗ рдХреЗрд╡рд▓ repository key рдХреЗ рд▓рд┐рдП passphrase рджрд░реНрдЬ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд╣рд╛ рдЬрд╛ рд░рд╣рд╛ рд╣реИред
```shell-session
$ docker push smakam/mybusybox:v2
The push refers to a repository [docker.io/smakam/mybusybox]
a7022f99b0cc: Layer already exists
5f70bf18a086: Layer already exists
9508eff2c687: Layer already exists
v2: digest: sha256:8509fa814029e1c1baf7696b36f0b273492b87f59554a33589e1bd6283557fc9 size: 2205
Signing and pushing trust metadata
Enter passphrase for repository key with ID 001986b (docker.io/smakam/mybusybox):
```
```markdown
рд░реВрдЯ рдХреА, рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдХреА рдФрд░ рдкрд╛рд╕рдлреНрд░реЗрдЬ рдХреЛ рд╕реБрд░рдХреНрд╖рд┐рдд рд╕реНрдерд╛рди рдкрд░ рд╕рдВрдЧреНрд░рд╣рд┐рдд рдХрд░рдирд╛ рдЖрд╡рд╢реНрдпрдХ рд╣реИред рдирд┐рдЬреА рдХреБрдВрдЬрд┐рдпреЛрдВ рдХрд╛ рдмреИрдХрдЕрдк рд▓реЗрдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрдорд╛рдВрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:
```
```bash
tar -zcvf private_keys_backup.tar.gz ~/.docker/trust/private
```
рдЬрдм рдореИрдВрдиреЗ Docker рд╣реЛрд╕реНрдЯ рдмрджрд▓рд╛, рддреЛ рдореБрдЭреЗ рдирдП рд╣реЛрд╕реНрдЯ рд╕реЗ рд╕рдВрдЪрд╛рд▓рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд░реВрдЯ рдХреАрдЬрд╝ рдФрд░ рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдХреАрдЬрд╝ рдХреЛ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рдирд╛ рдкрдбрд╝рд╛ред

***

<figure><img src="../../../.gitbook/assets/image (3) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
[**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЖрд╕рд╛рдиреА рд╕реЗ **рд╡рд░реНрдХрдлреНрд▓реЛрдЬрд╝ рдХреЛ рдмрдирд╛рдПрдВ рдФрд░ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдХрд░реЗрдВ** рдЬреЛ рджреБрдирд┐рдпрд╛ рдХреЗ **рд╕рдмрд╕реЗ рдЙрдиреНрдирдд** рд╕рдореБрджрд╛рдп рдЯреВрд▓реНрд╕ рджреНрд╡рд╛рд░рд╛ рд╕рдВрдЪрд╛рд▓рд┐рдд рд╣реЛрддреЗ рд╣реИрдВред\
рдЖрдЬ рд╣реА рдкрд╣реБрдВрдЪ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## рдХрдВрдЯреЗрдирд░ рд╕реБрд░рдХреНрд╖рд╛ рд╡рд┐рд╢реЗрд╖рддрд╛рдПрдВ

<details>

<summary>рдХрдВрдЯреЗрдирд░ рд╕реБрд░рдХреНрд╖рд╛ рд╡рд┐рд╢реЗрд╖рддрд╛рдУрдВ рдХрд╛ рд╕рд╛рд░рд╛рдВрд╢</summary>

**Namespaces**

Namespaces рдПрдХ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдХреЛ рджреВрд╕рд░реЗ рд╕реЗ рдЕрд▓рдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА рд╣реЛрддреЗ рд╣реИрдВ, рдкреНрд░реЛрд╕реЗрд╕ рд╕рдВрдЪрд╛рд░, рдиреЗрдЯрд╡рд░реНрдХ, рдорд╛рдЙрдВрдЯреНрд╕ рдХреЛ рдЕрд▓рдЧ рдХрд░рддреЗ рд╣реИрдВ... рдпрд╣ Docker рдкреНрд░реЛрд╕реЗрд╕ рдХреЛ рдЕрдиреНрдп рдкреНрд░реЛрд╕реЗрд╕реЗрд╕ рд╕реЗ рдЕрд▓рдЧ рдХрд░рдиреЗ рдореЗрдВ рд╕рд╣рд╛рдпрдХ рд╣реЛрддрд╛ рд╣реИ (рдФрд░ рдпрд╣рд╛рдВ рддрдХ рдХрд┐ /proc рдлреЛрд▓реНрдбрд░ рд╕реЗ рднреА) рддрд╛рдХрд┐ рдпрд╣ рдЕрдиреНрдп рдкреНрд░реЛрд╕реЗрд╕реЗрд╕ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ рдмрд╛рд╣рд░ рди рдирд┐рдХрд▓ рд╕рдХреЗред

рдпрд╣ рд╕рдВрднрд╡ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ "рдмрдЪ рдирд┐рдХрд▓рдирд╛" рдпрд╛ рдЕрдзрд┐рдХ рд╕рдЯреАрдХ рд░реВрдк рд╕реЗ **рдирдП namespaces рдмрдирд╛рдирд╛** рдмрд╛рдЗрдирд░реА **`unshare`** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ (рдЬреЛ **`unshare`** syscall рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ)ред Docker рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдЗрд╕реЗ рд░реЛрдХрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди kubernetes рдирд╣реАрдВ рдХрд░рддрд╛ (рдЗрд╕ рд▓реЗрдЦрди рдХреЗ рд╕рдордп)ред\
рд╡реИрд╕реЗ рднреА, рдпрд╣ рдирдП namespaces рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рд╣рд╛рдпрдХ рд╣реИ, рд▓реЗрдХрд┐рди **рд╣реЛрд╕реНрдЯ рдХреЗ рдбрд┐рдлрд╝реЙрд▓реНрдЯ namespaces рдореЗрдВ рд╡рд╛рдкрд╕ рдЬрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдирд╣реАрдВ** (рдЬрдм рддрдХ рдЖрдкрдХреЗ рдкрд╛рд╕ рд╣реЛрд╕реНрдЯ namespaces рдХреЗ рдЕрдВрджрд░ рдХреБрдЫ `/proc` рддрдХ рдкрд╣реБрдВрдЪ рди рд╣реЛ, рдЬрд╣рд╛рдВ рдЖрдк **`nsenter`** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╣реЛрд╕реНрдЯ namespaces рдореЗрдВ рдкреНрд░рд╡реЗрд╢ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред)

**CGroups**

рдпрд╣ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреЛ рд╕реАрдорд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ рдФрд░ рдкреНрд░реЛрд╕реЗрд╕ рдХреЗ рдЕрд▓рдЧрд╛рд╡ рдХреА рд╕реБрд░рдХреНрд╖рд╛ рдХреЛ рдкреНрд░рднрд╛рд╡рд┐рдд рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИ (рдЫреЛрдбрд╝рдХрд░ `release_agent` рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдмрдЪ рдирд┐рдХрд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ)ред

**Capabilities Drop**

рдореБрдЭреЗ рдпрд╣ рдкреНрд░реЛрд╕реЗрд╕ рдЕрд▓рдЧрд╛рд╡ рд╕реБрд░рдХреНрд╖рд╛ рдХреЗ рд╕рдВрдмрдВрдз рдореЗрдВ **рд╕рдмрд╕реЗ рдорд╣рддреНрд╡рдкреВрд░реНрдг** рд╡рд┐рд╢реЗрд╖рддрд╛рдУрдВ рдореЗрдВ рд╕реЗ рдПрдХ рд▓рдЧрддрд╛ рд╣реИред рдпрд╣ рдЗрд╕рд▓рд┐рдП рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдмрд┐рдирд╛ capabilities рдХреЗ, рдпрд╣рд╛рдВ рддрдХ рдХрд┐ рдЕрдЧрд░ рдкреНрд░реЛрд╕реЗрд╕ рд░реВрдЯ рдХреЗ рд░реВрдк рдореЗрдВ рдЪрд▓ рд░рд╣рд╛ рд╣реИ **рдЖрдк рдХреБрдЫ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдкреНрд░рд╛рдкреНрдд рдХреНрд░рд┐рдпрд╛рдПрдВ рдирд╣реАрдВ рдХрд░ рдкрд╛рдПрдВрдЧреЗ** (рдХреНрдпреЛрдВрдХрд┐ рдХреЙрд▓ рдХрд┐рдпрд╛ рдЧрдпрд╛ **`syscall`** рдЕрдиреБрдорддрд┐ рддреНрд░реБрдЯрд┐ рд╡рд╛рдкрд╕ рдХрд░ рджреЗрдЧрд╛ рдХреНрдпреЛрдВрдХрд┐ рдкреНрд░реЛрд╕реЗрд╕ рдХреЗ рдкрд╛рд╕ рдЖрд╡рд╢реНрдпрдХ capabilities рдирд╣реАрдВ рд╣реИрдВ)ред

рдпреЗ рд╡реЗ **рд╢реЗрд╖ capabilities** рд╣реИрдВ рдЬреЛ рдкреНрд░реЛрд╕реЗрд╕ рджреВрд╕рд░реЛрдВ рдХреЛ рдЫреЛрдбрд╝рдиреЗ рдХреЗ рдмрд╛рдж рд░рд╣рддреА рд╣реИрдВ:

{% code overflow="wrap" %}
```
Current: cap_chown,cap_dac_override,cap_fowner,cap_fsetid,cap_kill,cap_setgid,cap_setuid,cap_setpcap,cap_net_bind_service,cap_net_raw,cap_sys_chroot,cap_mknod,cap_audit_write,cap_setfcap=ep
```
{% endcode %}

**Seccomp**

рдпрд╣ Docker рдореЗрдВ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рд╕рдХреНрд╖рдо рд╣реЛрддрд╛ рд╣реИред рдпрд╣ **рдкреНрд░реЛрд╕реЗрд╕ рджреНрд╡рд╛рд░рд╛ рдХреЙрд▓ рдХрд┐рдП рдЬрд╛ рд╕рдХрдиреЗ рд╡рд╛рд▓реЗ syscalls рдХреЛ рдФрд░ рднреА рд╕реАрдорд┐рдд рдХрд░рдиреЗ рдореЗрдВ рдорджрдж рдХрд░рддрд╛ рд╣реИ**ред\
**рдбрд┐рдлрд╝реЙрд▓реНрдЯ Docker Seccomp рдкреНрд░реЛрдлрд╝рд╛рдЗрд▓** рдпрд╣рд╛рдБ рдкрд╛рдИ рдЬрд╛ рд╕рдХрддреА рд╣реИ: [https://github.com/moby/moby/blob/master/profiles/seccomp/default.json](https://github.com/moby/moby/blob/master/profiles/seccomp/default.json)

**AppArmor**

Docker рдореЗрдВ рдПрдХ рдЯреЗрдореНрдкрд▓реЗрдЯ рд╣реИ рдЬрд┐рд╕реЗ рдЖрдк рд╕рдХреНрд░рд┐рдп рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ: [https://github.com/moby/moby/tree/master/profiles/apparmor](https://github.com/moby/moby/tree/master/profiles/apparmor)

рдЗрд╕рд╕реЗ рдХреНрд╖рдорддрд╛рдУрдВ, syscalls, рдлрд╝рд╛рдЗрд▓реЛрдВ рдФрд░ рдлрд╝реЛрд▓реНрдбрд░реЛрдВ рддрдХ рдкрд╣реБрдБрдЪ рдХреЛ рдХрдо рдХрд░рдиреЗ рдореЗрдВ рдорджрдж рдорд┐рд▓реЗрдЧреА...

</details>

### Namespaces

**Namespaces** рд▓рд┐рдирдХреНрд╕ рдХрд░реНрдиреЗрд▓ рдХреА рдПрдХ рд╡рд┐рд╢реЗрд╖рддрд╛ рд╣реИ рдЬреЛ **рдХрд░реНрдиреЗрд▓ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреЛ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд░рддреА рд╣реИ** рддрд╛рдХрд┐ рдПрдХ рд╕рдореВрд╣ рдХреЗ **рдкреНрд░реЛрд╕реЗрд╕** рдПрдХ рд╕рдореВрд╣ рдХреЗ **рд╕рдВрд╕рд╛рдзрдиреЛрдВ** рдХреЛ **рджреЗрдЦ** рд╕рдХреЗрдВ рдЬрдмрдХрд┐ **рджреВрд╕рд░реЗ** рд╕рдореВрд╣ рдХреЗ **рдкреНрд░реЛрд╕реЗрд╕** рдПрдХ **рдЕрд▓рдЧ** рд╕рдореВрд╣ рдХреЗ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреЛ рджреЗрдЦреЗрдВред рдпрд╣ рд╡рд┐рд╢реЗрд╖рддрд╛ рдПрдХ рд╣реА рдирд╛рдорд╕реНрдерд╛рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдФрд░ рдкреНрд░реЛрд╕реЗрд╕реЛрдВ рдХреЗ рдПрдХ рд╕рдореВрд╣ рдХреЗ рд▓рд┐рдП рдХрд╛рдо рдХрд░рддреА рд╣реИ, рд▓реЗрдХрд┐рди рд╡реЗ рдирд╛рдорд╕реНрдерд╛рди рд╡рд┐рд╢рд┐рд╖реНрдЯ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреЛ рд╕рдВрджрд░реНрднрд┐рдд рдХрд░рддреЗ рд╣реИрдВред рд╕рдВрд╕рд╛рдзрди рдХрдИ рд╕реНрдерд╛рдиреЛрдВ рдореЗрдВ рдореМрдЬреВрдж рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред

Docker рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд▓рд┐рдирдХреНрд╕ рдХрд░реНрдиреЗрд▓ Namespaces рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХрдВрдЯреЗрдирд░ рдЕрд▓рдЧрд╛рд╡ рдкреНрд░рд╛рдкреНрдд рдХрд░рддрд╛ рд╣реИ:

* pid namespace
* mount namespace
* network namespace
* ipc namespace
* UTS namespace

**Namespaces рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП** рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреГрд╖реНрда рджреЗрдЦреЗрдВ:

{% content-ref url="namespaces/" %}
[namespaces](namespaces/)
{% endcontent-ref %}

### cgroups

рд▓рд┐рдирдХреНрд╕ рдХрд░реНрдиреЗрд▓ рд╡рд┐рд╢реЗрд╖рддрд╛ **cgroups** рдкреНрд░реЛрд╕реЗрд╕реЛрдВ рдХреЗ рдПрдХ рд╕рдореВрд╣ рдХреЗ рдмреАрдЪ cpu, memory, io, network bandwidth рдЬреИрд╕реЗ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреЛ **рдкреНрд░рддрд┐рдмрдВрдзрд┐рдд рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рдкреНрд░рджрд╛рди рдХрд░рддреА рд╣реИ**ред Docker cgroup рд╡рд┐рд╢реЗрд╖рддрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХрдВрдЯреЗрдирд░ рдмрдирд╛рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ рдЬреЛ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдХрдВрдЯреЗрдирд░ рдХреЗ рд▓рд┐рдП рд╕рдВрд╕рд╛рдзрди рдирд┐рдпрдВрддреНрд░рдг рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред\
рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдПрдХ рдХрдВрдЯреЗрдирд░ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕реНрдерд╛рди рдХреА рдореЗрдореЛрд░реА 500m рддрдХ рд╕реАрдорд┐рдд рд╣реИ, рдХрд░реНрдиреЗрд▓ рдореЗрдореЛрд░реА 50m рддрдХ рд╕реАрдорд┐рдд рд╣реИ, cpu рд╢реЗрдпрд░ 512 рд╣реИ, blkioweight 400 рд╣реИред CPU рд╢реЗрдпрд░ рдПрдХ рдЕрдиреБрдкрд╛рдд рд╣реИ рдЬреЛ рдХрдВрдЯреЗрдирд░ рдХреЗ CPU рдЙрдкрдпреЛрдЧ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рддрд╛ рд╣реИред рдЗрд╕рдХрд╛ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдорд╛рди 1024 рд╣реИ рдФрд░ рдпрд╣ 0 рд╕реЗ 1024 рдХреЗ рдмреАрдЪ рд╣реЛрддрд╛ рд╣реИред рдпрджрд┐ рддреАрди рдХрдВрдЯреЗрдирд░реЛрдВ рдХрд╛ CPU рд╢реЗрдпрд░ рд╕рдорд╛рди 1024 рд╣реИ, рддреЛ CPU рд╕рдВрд╕рд╛рдзрди рд╕рдВрдШрд░реНрд╖ рдХреА рд╕реНрдерд┐рддрд┐ рдореЗрдВ рдкреНрд░рддреНрдпреЗрдХ рдХрдВрдЯреЗрдирд░ CPU рдХрд╛ 33% рддрдХ рд▓реЗ рд╕рдХрддрд╛ рд╣реИред blkio-weight рдПрдХ рдЕрдиреБрдкрд╛рдд рд╣реИ рдЬреЛ рдХрдВрдЯреЗрдирд░ рдХреЗ IO рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рддрд╛ рд╣реИред рдЗрд╕рдХрд╛ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдорд╛рди 500 рд╣реИ рдФрд░ рдпрд╣ 10 рд╕реЗ 1000 рдХреЗ рдмреАрдЪ рд╣реЛрддрд╛ рд╣реИред
```
docker run -it -m 500M --kernel-memory 50M --cpu-shares 512 --blkio-weight 400 --name ubuntu1 ubuntu bash
```
рдХрд┐рд╕реА рдХрдВрдЯреЗрдирд░ рдХрд╛ cgroup рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдк рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
docker run -dt --rm denial sleep 1234 #Run a large sleep inside a Debian container
ps -ef | grep 1234 #Get info about the sleep process
ls -l /proc/<PID>/ns #Get the Group and the namespaces (some may be uniq to the hosts and some may be shred with it)
```
рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рджреЗрдЦреЗрдВ:

{% content-ref url="cgroups.md" %}
[cgroups.md](cgroups.md)
{% endcontent-ref %}

### рдХреНрд╖рдорддрд╛рдПрдБ (Capabilities)

рдХреНрд╖рдорддрд╛рдПрдБ рд░реВрдЯ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд▓рд┐рдП **рдЕрдзрд┐рдХ рд╕реВрдХреНрд╖реНрдо рдирд┐рдпрдВрддреНрд░рдг рдкреНрд░рджрд╛рди рдХрд░рддреА рд╣реИрдВ** рдЬреЛ рдХреНрд╖рдорддрд╛рдПрдБ рдЕрдиреБрдорддрд┐ рджреА рдЬрд╛ рд╕рдХрддреА рд╣реИрдВред Docker рд▓рд┐рдирдХреНрд╕ рдХрд░реНрдиреЗрд▓ рдХреНрд╖рдорддрд╛ рд╕реБрд╡рд┐рдзрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ рддрд╛рдХрд┐ **рдХрдВрдЯреЗрдирд░ рдХреЗ рдЕрдВрджрд░ рдХрд┐рдП рдЬрд╛ рд╕рдХрдиреЗ рд╡рд╛рд▓реЗ рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рд╕реАрдорд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗ** рдЪрд╛рд╣реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХрд╛ рдкреНрд░рдХрд╛рд░ рдХреБрдЫ рднреА рд╣реЛред

рдЬрдм рдПрдХ рдбреЙрдХрд░ рдХрдВрдЯреЗрдирд░ рдЪрд▓рд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ **рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдХреНрд╖рдорддрд╛рдПрдБ рдЫреЛрдбрд╝ рджреЗрддреА рд╣реИ рдЬрд┐рдирдХрд╛ рдЙрдкрдпреЛрдЧ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдЕрд▓рдЧрд╛рд╡ рд╕реЗ рдмрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░ рд╕рдХрддреА рд╣реИ**ред рдЗрд╕рд╕реЗ рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдХрд┐ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рдЕрдВрдЬрд╛рдо рдирд╣реАрдВ рджреЗ рдкрд╛рдПрдЧреА рдФрд░ рдмрдЪ рдирд╣реАрдВ рдкрд╛рдПрдЧреА:

{% content-ref url="../linux-capabilities.md" %}
[linux-capabilities.md](../linux-capabilities.md)
{% endcontent-ref %}

### Docker рдореЗрдВ Seccomp

рдпрд╣ рдПрдХ рд╕реБрд░рдХреНрд╖рд╛ рд╕реБрд╡рд┐рдзрд╛ рд╣реИ рдЬреЛ Docker рдХреЛ **рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓реНрд╕ рдХреЛ рд╕реАрдорд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИ** рдЬреЛ рдХрдВрдЯреЗрдирд░ рдХреЗ рдЕрдВрджрд░ рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИрдВ:

{% content-ref url="seccomp.md" %}
[seccomp.md](seccomp.md)
{% endcontent-ref %}

### Docker рдореЗрдВ AppArmor

**AppArmor** рдПрдХ рдХрд░реНрдиреЗрд▓ рд╕реБрдзрд╛рд░ рд╣реИ рдЬреЛ **рдХрдВрдЯреЗрдирд░реЛрдВ** рдХреЛ **рд╕реАрдорд┐рдд** рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреЗ рд╕рд╛рде **рдкреНрд░рддрд┐-рдкреНрд░реЛрдЧреНрд░рд╛рдо рдкреНрд░реЛрдлрд╛рдЗрд▓** рдХреЗ рдЕрдиреБрд╕рд╛рд░ рд╕рдВрдпрдорд┐рдд рдХрд░рддрд╛ рд╣реИред:

{% content-ref url="apparmor.md" %}
[apparmor.md](apparmor.md)
{% endcontent-ref %}

### Docker рдореЗрдВ SELinux

[SELinux](https://www.redhat.com/en/blog/latest-container-exploit-runc-can-be-blocked-selinux) рдПрдХ **рд▓реЗрдмрд▓рд┐рдВрдЧ** **рд╕рд┐рд╕реНрдЯрдо** рд╣реИред рд╣рд░ **рдкреНрд░рдХреНрд░рд┐рдпрд╛** рдФрд░ рд╣рд░ **рдлрд╛рдЗрд▓ рд╕рд┐рд╕реНрдЯрдо рдСрдмреНрдЬреЗрдХреНрдЯ** рдХрд╛ рдПрдХ **рд▓реЗрдмрд▓** рд╣реЛрддрд╛ рд╣реИред SELinux рдиреАрддрд┐рдпрд╛рдБ рдирд┐рдпрдо рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рддреА рд╣реИрдВ рдХрд┐ рдПрдХ **рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд▓реЗрдмрд▓ рдХреНрдпрд╛ рдХрд░ рд╕рдХрддреА рд╣реИ рд╕рд┐рд╕реНрдЯрдо рдкрд░ рдЕрдиреНрдп рд╕рднреА рд▓реЗрдмрд▓реЛрдВ рдХреЗ рд╕рд╛рде**ред

рдХрдВрдЯреЗрдирд░ рдЗрдВрдЬрди **рдХрдВрдЯреЗрдирд░ рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЛ рдПрдХ рдПрдХрд▓ рд╕рдВрдпрдорд┐рдд SELinux рд▓реЗрдмрд▓ рдХреЗ рд╕рд╛рде рд▓реЙрдиреНрдЪ рдХрд░рддреЗ рд╣реИрдВ**, рдЖрдорддреМрд░ рдкрд░ `container_t`, рдФрд░ рдлрд┐рд░ рдХрдВрдЯреЗрдирд░ рдХреЗ рдЕрдВрджрд░ рдХреЗ рдХрдВрдЯреЗрдирд░ рдХреЛ рд▓реЗрдмрд▓ `container_file_t` рдХреЗ рд░реВрдк рдореЗрдВ рд╕реЗрдЯ рдХрд░рддреЗ рд╣реИрдВред SELinux рдиреАрддрд┐ рдирд┐рдпрдо рдореВрд▓ рд░реВрдк рд╕реЗ рдХрд╣рддреЗ рд╣реИрдВ рдХрд┐ **`container_t` рдкреНрд░рдХреНрд░рд┐рдпрд╛рдПрдБ рдХреЗрд╡рд▓ `container_file_t` рд▓реЗрдмрд▓ рд╡рд╛рд▓реА рдлрд╛рдЗрд▓реЛрдВ рдХреЛ рдкрдврд╝/рд▓рд┐рдЦ/рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░ рд╕рдХрддреА рд╣реИрдВ**ред

{% content-ref url="../selinux.md" %}
[selinux.md](../selinux.md)
{% endcontent-ref %}

### AuthZ & AuthN

рдПрдХ рдкреНрд░рд╛рдзрд┐рдХрд░рдг рдкреНрд▓рдЧрдЗрди **рдЕрдиреБрдореЛрджрд┐рдд** рдпрд╛ **рдЕрд╕реНрд╡реАрдХрд╛рд░** рдХрд░рддрд╛ рд╣реИ **рдЕрдиреБрд░реЛрдзреЛрдВ** рдХреЛ Docker **рдбреЗрдорди** рдХреЗ рд▓рд┐рдП рдЖрдзрд╛рд░рд┐рдд рд╣реЛрддрд╛ рд╣реИ рд╡рд░реНрддрдорд╛рди **рдкреНрд░рдорд╛рдгреАрдХрд░рдг** рд╕рдВрджрд░реНрдн рдФрд░ **рдХрдорд╛рдВрдб** **рд╕рдВрджрд░реНрдн** рдкрд░ред **рдкреНрд░рдорд╛рдгреАрдХрд░рдг** **рд╕рдВрджрд░реНрдн** рдореЗрдВ рд╕рднреА **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╡рд┐рд╡рд░рдг** рдФрд░ **рдкреНрд░рдорд╛рдгреАрдХрд░рдг** **рд╡рд┐рдзрд┐** рд╢рд╛рдорд┐рд▓ рд╣реЛрддреА рд╣реИред **рдХрдорд╛рдВрдб рд╕рдВрджрд░реНрдн** рдореЗрдВ рд╕рднреА **рдкреНрд░рд╛рд╕рдВрдЧрд┐рдХ** **рдЕрдиреБрд░реЛрдз** рдбреЗрдЯрд╛ рд╢рд╛рдорд┐рд▓ рд╣реЛрддрд╛ рд╣реИред

{% content-ref url="authz-and-authn-docker-access-authorization-plugin.md" %}
[authz-and-authn-docker-access-authorization-plugin.md](authz-and-authn-docker-access-authorization-plugin.md)
{% endcontent-ref %}

## рдХрдВрдЯреЗрдирд░ рд╕реЗ DoS

рдпрджрд┐ рдЖрдк рдЙрдЪрд┐рдд рд░реВрдк рд╕реЗ рд╕реАрдорд┐рдд рдирд╣реАрдВ рдХрд░ рд░рд╣реЗ рд╣реИрдВ рдХрд┐ рдПрдХ рдХрдВрдЯреЗрдирд░ рдХрд┐рддрдиреЗ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рддреЛ рдПрдХ рд╕рдордЭреМрддрд╛ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдХрдВрдЯреЗрдирд░ рдЬрд┐рд╕ рдкрд░ рд╡рд╣ рдЪрд▓ рд░рд╣рд╛ рд╣реИ рдЙрд╕ рд╣реЛрд╕реНрдЯ рдХреЛ DoS рдХрд░ рд╕рдХрддрд╛ рд╣реИред

* CPU DoS
```bash
# stress-ng
sudo apt-get install -y stress-ng && stress-ng --vm 1 --vm-bytes 1G --verify -t 5m

# While loop
docker run -d --name malicious-container -c 512 busybox sh -c 'while true; do :; done'
```
* рдмреИрдВрдбрд╡рд┐рдбреНрде DoS
```bash
nc -lvp 4444 >/dev/null & while true; do cat /dev/urandom | nc <target IP> 4444; done
```
## рджрд┐рд▓рдЪрд╕реНрдк Docker рдлреНрд▓реИрдЧреНрд╕

### --privileged рдлреНрд▓реИрдЧ

рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреГрд╖реНрда рдкрд░ рдЖрдк рд╕реАрдЦ рд╕рдХрддреЗ рд╣реИрдВ **`--privileged` рдлреНрд▓реИрдЧ рдХрд╛ рдХреНрдпрд╛ рдЕрд░реНрде рд╣реИ**:

{% content-ref url="docker-privileged.md" %}
[docker-privileged.md](docker-privileged.md)
{% endcontent-ref %}

### --security-opt

#### no-new-privileges

рдпрджрд┐ рдЖрдк рдПрдХ рдХрдВрдЯреЗрдирд░ рдЪрд▓рд╛ рд░рд╣реЗ рд╣реИрдВ рдЬрд╣рд╛рдВ рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдХрдо рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╡рд╛рд▓реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд░реВрдк рдореЗрдВ рдкрд╣реБрдБрдЪ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд▓реЗрддрд╛ рд╣реИред рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдПрдХ **рдЧрд▓рдд-рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рд╕реБрдЗрдб рдмрд╛рдЗрдирд░реА** рд╣реИ, рддреЛ рд╣рдорд▓рд╛рд╡рд░ рдЗрд╕рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдФрд░ **рдХрдВрдЯреЗрдирд░ рдХреЗ рдЕрдВрджрд░ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдмрдврд╝рд╛ рд╕рдХрддрд╛ рд╣реИ**ред рдЬреЛ, рдЙрд╕реЗ рдЗрд╕рд╕реЗ рдмрд╛рд╣рд░ рдирд┐рдХрд▓рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗ рд╕рдХрддрд╛ рд╣реИред

рдХрдВрдЯреЗрдирд░ рдХреЛ **`no-new-privileges`** рд╡рд┐рдХрд▓реНрдк рд╕рдХреНрд╖рдо рдХреЗ рд╕рд╛рде рдЪрд▓рд╛рдиреЗ рд╕реЗ **рдЗрд╕ рдкреНрд░рдХрд╛рд░ рдХреЗ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╡реГрджреНрдзрд┐ рдХреЛ рд░реЛрдХрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ**ред
```
docker run -it --security-opt=no-new-privileges:true nonewpriv
```
#### рдЕрдиреНрдп
```bash
#You can manually add/drop capabilities with
--cap-add
--cap-drop

# You can manually disable seccomp in docker with
--security-opt seccomp=unconfined

# You can manually disable seccomp in docker with
--security-opt apparmor=unconfined

# You can manually disable selinux in docker with
--security-opt label:disable
```
рдЕрдзрд┐рдХ **`--security-opt`** рд╡рд┐рдХрд▓реНрдкреЛрдВ рдХреЗ рд▓рд┐рдП рджреЗрдЦреЗрдВ: [https://docs.docker.com/engine/reference/run/#security-configuration](https://docs.docker.com/engine/reference/run/#security-configuration)

## рдЕрдиреНрдп рд╕реБрд░рдХреНрд╖рд╛ рд╡рд┐рдЪрд╛рд░

### рд╕реАрдХреНрд░реЗрдЯреНрд╕ рдХрд╛ рдкреНрд░рдмрдВрдзрди

рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, **рдЙрдиреНрд╣реЗрдВ рдЕрдкрдиреА рдЗрдореЗрдЬ рдХреЗ рдЕрдВрджрд░ рди рд░рдЦреЗрдВ!**

рд╕рд╛рде рд╣реА, **рдкрд░реНрдпрд╛рд╡рд░рдг рдЪрд░реЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдЕрдкрдиреА рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рди рдХрд░реЗрдВ**ред рдХреЛрдИ рднреА **рдЬреЛ `docker inspect` рдпрд╛ `exec` рдХрдВрдЯреЗрдирд░ рдореЗрдВ рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рд╡рд╣ рдЖрдкрдХреЗ рд╕реАрдХреНрд░реЗрдЯ рдХреЛ рдвреВрдВрдв рд╕рдХрддрд╛ рд╣реИ**ред

Docker volumes рдмреЗрд╣рддрд░ рд╣реИрдВред рд╡реЗ Docker рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рдореЗрдВ рдЖрдкрдХреА рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдЬрд╛рдирдХрд╛рд░реА рддрдХ рдкрд╣реБрдБрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рд╕реБрдЭрд╛рдП рдЧрдП рддрд░реАрдХреЗ рд╣реИрдВред рдЖрдк **рдПрдХ volume рдХрд╛ рдЙрдкрдпреЛрдЧ рд╕реНрдореГрддрд┐ рдореЗрдВ рдЕрд╕реНрдерд╛рдпреА рдлрд╝рд╛рдЗрд▓ рд╕рд┐рд╕реНрдЯрдо рдХреЗ рд░реВрдк рдореЗрдВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**ред Volumes `docker inspect` рдФрд░ рд▓реЙрдЧрд┐рдВрдЧ рдЬреЛрдЦрд┐рдо рдХреЛ рд╣рдЯрд╛ рджреЗрддреЗ рд╣реИрдВред рд╣рд╛рд▓рд╛рдВрдХрд┐, **рд░реВрдЯ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЕрднреА рднреА рд╕реАрдХреНрд░реЗрдЯ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ, рдЬреИрд╕реЗ рдХреЛрдИ рднреА рдЬреЛ рдХрдВрдЯреЗрдирд░ рдореЗрдВ `exec` рдХрд░ рд╕рдХрддрд╛ рд╣реИ**ред

Volumes рд╕реЗ рднреА **рдмреЗрд╣рддрд░, Docker secrets рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ**ред

рдпрджрд┐ рдЖрдкрдХреЛ рдХреЗрд╡рд▓ **рдЕрдкрдиреА рдЗрдореЗрдЬ рдореЗрдВ рд╕реАрдХреНрд░реЗрдЯ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ**, рддреЛ рдЖрдк **BuildKit** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред BuildKit рдирд┐рд░реНрдорд╛рдг рд╕рдордп рдХреЛ рдХрд╛рдлреА рдХрдо рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЕрдиреНрдп рдЕрдЪреНрдЫреА рд╡рд┐рд╢реЗрд╖рддрд╛рдПрдВ рднреА рд╣реИрдВ, рдЬрд┐рд╕рдореЗрдВ **рдирд┐рд░реНрдорд╛рдг-рд╕рдордп рд╕реАрдХреНрд░реЗрдЯреНрд╕ рд╕рдорд░реНрдерди** рд╢рд╛рдорд┐рд▓ рд╣реИред

BuildKit рдмреИрдХрдПрдВрдб рдХреЛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдиреЗ рдХреЗ рддреАрди рддрд░реАрдХреЗ рд╣реИрдВ рддрд╛рдХрд┐ рдЖрдк рдЗрд╕рдХреА рд╡рд┐рд╢реЗрд╖рддрд╛рдУрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдЕрдм рдХрд░ рд╕рдХреЗрдВ:

1. рдЗрд╕реЗ рдПрдХ рдкрд░реНрдпрд╛рд╡рд░рдг рдЪрд░ рдХреЗ рд░реВрдк рдореЗрдВ рд╕реЗрдЯ рдХрд░реЗрдВ `export DOCKER_BUILDKIT=1` рдХреЗ рд╕рд╛рдеред
2. рдЕрдкрдиреЗ `build` рдпрд╛ `run` рдХрдорд╛рдВрдб рдХреЛ `DOCKER_BUILDKIT=1` рдХреЗ рд╕рд╛рде рд╢реБрд░реВ рдХрд░реЗрдВред
3. BuildKit рдХреЛ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рд╕рдХреНрд╖рдо рдХрд░реЗрдВред /_etc/docker/daemon.json_ рдореЗрдВ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рд╕реЗрдЯ рдХрд░реЗрдВ _true_ рдХреЗ рд╕рд╛рде: `{ "features": { "buildkit": true } }`ред рдлрд┐рд░ Docker рдХреЛ рдкреБрдирдГ рдЖрд░рдВрдн рдХрд░реЗрдВред
4. рдлрд┐рд░ рдЖрдк рдирд┐рд░реНрдорд╛рдг рд╕рдордп рдкрд░ `--secret` рдзреНрд╡рдЬ рдХреЗ рд╕рд╛рде рд╕реАрдХреНрд░реЗрдЯреНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЗрд╕ рддрд░рд╣:
```bash
docker build --secret my_key=my_value ,src=path/to/my_secret_file .
```
рдЬрд╣рд╛рдВ рдЖрдкрдХреА рдлрд╝рд╛рдЗрд▓ рдЖрдкрдХреЗ рд░рд╣рд╕реНрдпреЛрдВ рдХреЛ key-value рдЬреЛрдбрд╝реА рдХреЗ рд░реВрдк рдореЗрдВ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рддреА рд╣реИред

рдпреЗ рд░рд╣рд╕реНрдп рдЗрдореЗрдЬ рдмрд┐рд▓реНрдб рдХреИрд╢ рд╕реЗ рдФрд░ рдЕрдВрддрд┐рдо рдЗрдореЗрдЬ рд╕реЗ рдмрд╛рд╣рд░ рд░рдЦреЗ рдЬрд╛рддреЗ рд╣реИрдВред

рдпрджрд┐ рдЖрдкрдХреЛ рдЕрдкрдиреЗ рдЗрдореЗрдЬ рдХреЛ рдмрд┐рд▓реНрдб рдХрд░рддреЗ рд╕рдордп рдирд╣реАрдВ рдмрд▓реНрдХрд┐ рдЕрдкрдиреЗ **рдЪрд▓ рд░рд╣реЗ рдХрдВрдЯреЗрдирд░ рдореЗрдВ рд░рд╣рд╕реНрдп рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ**, рддреЛ **Docker Compose рдпрд╛ Kubernetes** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред

Docker Compose рдХреЗ рд╕рд╛рде, рдПрдХ рд╕реЗрд╡рд╛ рдореЗрдВ secrets key-value рдЬреЛрдбрд╝реА рдХреЛ рдЬреЛрдбрд╝реЗрдВ рдФрд░ рд░рд╣рд╕реНрдп рдлрд╝рд╛рдЗрд▓ рдХреЛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░реЗрдВред [Stack Exchange рдЙрддреНрддрд░](https://serverfault.com/a/936262/535325) рдХреЗ рд▓рд┐рдП рдзрдиреНрдпрд╡рд╛рдж рдЬрд┐рд╕ рдкрд░ рдиреАрдЪреЗ рджрд┐рдпрд╛ рдЧрдпрд╛ рдЙрджрд╛рд╣рд░рдг рдЖрдзрд╛рд░рд┐рдд рд╣реИред

рд░рд╣рд╕реНрдпреЛрдВ рдХреЗ рд╕рд╛рде `docker-compose.yml` рдХрд╛ рдЙрджрд╛рд╣рд░рдг:
```yaml
version: "3.7"

services:

my_service:
image: centos:7
entrypoint: "cat /run/secrets/my_secret"
secrets:
- my_secret

secrets:
my_secret:
file: ./my_secret_file.txt
```
```
рдлрд┐рд░ рд╕рд╛рдорд╛рдиреНрдп рд░реВрдк рд╕реЗ Compose рдХреЛ `docker-compose up --build my_service` рдХреЗ рд╕рд╛рде рд╢реБрд░реВ рдХрд░реЗрдВред

рдпрджрд┐ рдЖрдк [Kubernetes](https://kubernetes.io/docs/concepts/configuration/secret/) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣реЗ рд╣реИрдВ, рддреЛ рдЗрд╕рдореЗрдВ secrets рдХреЗ рд▓рд┐рдП рд╕рдорд░реНрдерди рд╣реИред [Helm-Secrets](https://github.com/futuresimple/helm-secrets) K8s рдореЗрдВ secrets рдкреНрд░рдмрдВрдзрди рдХреЛ рдЖрд╕рд╛рди рдмрдирд╛ рд╕рдХрддрд╛ рд╣реИред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, K8s рдореЗрдВ Role Based Access Controls (RBAC) рд╣реИ - рдЬреИрд╕рд╛ рдХрд┐ Docker Enterprise рдореЗрдВ рднреА рд╣реИред RBAC teams рдХреЗ рд▓рд┐рдП Secrets рдкреНрд░рдмрдВрдзрди рдХреЛ рдЕрдзрд┐рдХ рдкреНрд░рдмрдВрдзрдиреАрдп рдФрд░ рд╕реБрд░рдХреНрд╖рд┐рдд рдмрдирд╛рддрд╛ рд╣реИред

### gVisor

**gVisor** рдПрдХ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХрд░реНрдиреЗрд▓ рд╣реИ, рдЬреЛ Go рдореЗрдВ рд▓рд┐рдЦрд╛ рдЧрдпрд╛ рд╣реИ, рдЬреЛ Linux рд╕рд┐рд╕реНрдЯрдо рд╕рд░рдлреЗрд╕ рдХрд╛ рдПрдХ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣рд┐рд╕реНрд╕рд╛ рд▓рд╛рдЧреВ рдХрд░рддрд╛ рд╣реИред рдЗрд╕рдореЗрдВ рдПрдХ [Open Container Initiative (OCI)](https://www.opencontainers.org) рд░рдирдЯрд╛рдЗрдо `runsc` рд╢рд╛рдорд┐рд▓ рд╣реИ рдЬреЛ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдФрд░ рд╣реЛрд╕реНрдЯ рдХрд░реНрдиреЗрд▓ рдХреЗ рдмреАрдЪ рдПрдХ **рдЕрд▓рдЧрд╛рд╡ рд╕реАрдорд╛ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ**ред `runsc` рд░рдирдЯрд╛рдЗрдо Docker рдФрд░ Kubernetes рдХреЗ рд╕рд╛рде рдПрдХреАрдХреГрдд рд╣реЛрддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рд╕реИрдВрдбрдмреЙрдХреНрд╕реНрдб рдХрдВрдЯреЗрдирд░реНрд╕ рдХреЛ рдЪрд▓рд╛рдирд╛ рд╕рд░рд▓ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИред

{% embed url="https://github.com/google/gvisor" %}

### Kata Containers

**Kata Containers** рдПрдХ рдУрдкрди рд╕реЛрд░реНрд╕ рд╕рдореБрджрд╛рдп рд╣реИ рдЬреЛ рдПрдХ рд╕реБрд░рдХреНрд╖рд┐рдд рдХрдВрдЯреЗрдирд░ рд░рдирдЯрд╛рдЗрдо рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд╛рдо рдХрд░ рд░рд╣рд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рд╣рд▓реНрдХреЗ рд╡рд░реНрдЪреБрдЕрд▓ рдорд╢реАрдиреЗрдВ рд╣реЛрддреА рд╣реИрдВ рдЬреЛ рдХрдВрдЯреЗрдирд░реНрд╕ рдХреА рддрд░рд╣ рдорд╣рд╕реВрд╕ рдХрд░рддреА рд╣реИрдВ рдФрд░ рдкреНрд░рджрд░реНрд╢рди рдХрд░рддреА рд╣реИрдВ, рд▓реЗрдХрд┐рди рд╣рд╛рд░реНрдбрд╡реЗрдпрд░ рд╡рд░реНрдЪреБрдЕрд▓рд╛рдЗрдЬреЗрд╢рди рддрдХрдиреАрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рджреВрд╕рд░реА рдкрд░рдд рдХреЗ рд░реВрдк рдореЗрдВ **рдордЬрдмреВрдд рдХрд╛рд░реНрдпрднрд╛рд░ рдЕрд▓рдЧрд╛рд╡ рдкреНрд░рджрд╛рди рдХрд░рддреА рд╣реИрдВ**ред

{% embed url="https://katacontainers.io/" %}

### Summary Tips

* **`--privileged` рдлреНрд▓реИрдЧ рдХрд╛ рдЙрдкрдпреЛрдЧ рди рдХрд░реЗрдВ рдпрд╛ рдХрдВрдЯреЗрдирд░ рдХреЗ рдЕрдВрджрд░** [**Docker socket рдХреЛ рдорд╛рдЙрдВрдЯ рди рдХрд░реЗрдВ**](https://raesene.github.io/blog/2016/03/06/The-Dangers-Of-Docker.sock/)**ред** Docker socket рдХрдВрдЯреЗрдирд░реНрд╕ рдХреЛ рд╕реНрдкреЙрди рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдпрд╣ рд╣реЛрд╕реНрдЯ рдХрд╛ рдкреВрд░реНрдг рдирд┐рдпрдВрддреНрд░рдг рд▓реЗрдиреЗ рдХрд╛ рдПрдХ рдЖрд╕рд╛рди рддрд░реАрдХрд╛ рд╣реИ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, `--privileged` рдлреНрд▓реИрдЧ рдХреЗ рд╕рд╛рде рджреВрд╕рд░рд╛ рдХрдВрдЯреЗрдирд░ рдЪрд▓рд╛рдХрд░ред
* рдХрдВрдЯреЗрдирд░ рдХреЗ рдЕрдВрджрд░ **root рдХреЗ рд░реВрдк рдореЗрдВ рди рдЪрд▓рд╛рдПрдВред рдПрдХ** [**рдЕрд▓рдЧ рдпреВрдЬрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ**](https://docs.docker.com/develop/develop-images/dockerfile\_best-practices/#user) **рдФрд░** [**user namespaces**](https://docs.docker.com/engine/security/userns-remap/)**ред** рдХрдВрдЯреЗрдирд░ рдореЗрдВ root рд╣реЛрд╕реНрдЯ рдкрд░ рд╡рд╣реА рд╣реЛрддрд╛ рд╣реИ рдЬрдм рддрдХ рдХрд┐ user namespaces рдХреЗ рд╕рд╛рде рд░реАрдореИрдк рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ред рдпрд╣ рдореБрдЦреНрдп рд░реВрдк рд╕реЗ Linux namespaces, capabilities, рдФрд░ cgroups рджреНрд╡рд╛рд░рд╛ рд╣рд▓реНрдХреЗ рд░реВрдк рд╕реЗ рдкреНрд░рддрд┐рдмрдВрдзрд┐рдд рд╣реЛрддрд╛ рд╣реИред
* [**рд╕рднреА capabilities рдХреЛ рдбреНрд░реЙрдк рдХрд░реЗрдВ**](https://docs.docker.com/engine/reference/run/#runtime-privilege-and-linux-capabilities) **(`--cap-drop=all`) рдФрд░ рдХреЗрд╡рд▓ рдЙрдиреНрд╣реАрдВ рдХреЛ рд╕рдХреНрд╖рдо рдХрд░реЗрдВ рдЬреЛ рдЖрд╡рд╢реНрдпрдХ рд╣реИрдВ** (`--cap-add=...`). рдмрд╣реБрдд рд╕реЗ рдХрд╛рд░реНрдпрднрд╛рд░реЛрдВ рдХреЛ рдХрд┐рд╕реА рднреА capabilities рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реЛрддреА рдФрд░ рдЙрдиреНрд╣реЗрдВ рдЬреЛрдбрд╝рдиреЗ рд╕реЗ рд╕рдВрднрд╛рд╡рд┐рдд рд╣рдорд▓реЗ рдХреА рдЧреБрдВрдЬрд╛рдЗрд╢ рдмрдврд╝ рдЬрд╛рддреА рд╣реИред
* [**тАЬno-new-privilegesтАЭ рд╕реБрд░рдХреНрд╖рд╛ рд╡рд┐рдХрд▓реНрдк рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ**](https://raesene.github.io/blog/2019/06/01/docker-capabilities-and-no-new-privs/) рддрд╛рдХрд┐ рдкреНрд░рдХреНрд░рд┐рдпрд╛рдПрдВ рдЕрдзрд┐рдХ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдкреНрд░рд╛рдкреНрдд рди рдХрд░ рд╕рдХреЗрдВ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП suid binaries рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗред
* [**рдХрдВрдЯреЗрдирд░ рдХреЗ рд▓рд┐рдП рдЙрдкрд▓рдмреНрдз рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреЛ рд╕реАрдорд┐рдд рдХрд░реЗрдВ**](https://docs.docker.com/engine/reference/run/#runtime-constraints-on-resources)**ред** рд╕рдВрд╕рд╛рдзрди рд╕реАрдорд╛рдПрдВ рдорд╢реАрди рдХреЛ рд╕реЗрд╡рд╛ рдЕрд╕реНрд╡реАрдХреГрддрд┐ рд╣рдорд▓реЛрдВ рд╕реЗ рдмрдЪрд╛ рд╕рдХрддреА рд╣реИрдВред
* **рд╕рдорд╛рдпреЛрдЬрд┐рдд рдХрд░реЗрдВ** [**seccomp**](https://docs.docker.com/engine/security/seccomp/)**,** [**AppArmor**](https://docs.docker.com/engine/security/apparmor/) **(рдпрд╛ SELinux)** рдкреНрд░реЛрдлрд╛рдЗрд▓ рдХреЛ рдХрдВрдЯреЗрдирд░ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рдиреНрдпреВрдирддрдо рдХрд╛рд░реНрдпреЛрдВ рдФрд░ syscalls рддрдХ рд╕реАрдорд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдПред
* **рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ** [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ docker рдЗрдореЗрдЬреЗрд╕**](https://docs.docker.com/docker-hub/official\_images/) **рдФрд░ рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рдХреА рдорд╛рдВрдЧ рдХрд░реЗрдВ** рдпрд╛ рдЙрдирдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдЕрдкрдиреА рдЦреБрдж рдХреА рдмрдирд╛рдПрдВред [backdoored](https://arstechnica.com/information-technology/2018/06/backdoored-images-downloaded-5-million-times-finally-removed-from-docker-hub/) рдЗрдореЗрдЬреЗрд╕ рдХреЛ рд╡рд┐рд░рд╛рд╕рдд рдореЗрдВ рди рд▓реЗрдВ рдпрд╛ рдЙрдкрдпреЛрдЧ рди рдХрд░реЗрдВред рд╕рд╛рде рд╣реА root keys, passphrase рдХреЛ рд╕реБрд░рдХреНрд╖рд┐рдд рд╕реНрдерд╛рди рдкрд░ рд░рдЦреЗрдВред Docker рдХреА UCP рдХреЗ рд╕рд╛рде keys рдХреЛ рдкреНрд░рдмрдВрдзрд┐рдд рдХрд░рдиреЗ рдХреА рдпреЛрдЬрдирд╛ рд╣реИред
* **рдирд┐рдпрдорд┐рдд рд░реВрдк рд╕реЗ** рдЕрдкрдиреА рдЗрдореЗрдЬреЗрд╕ рдХреЛ **рдкреБрдирдГ рдмрдирд╛рдПрдВ рддрд╛рдХрд┐ рд╣реЛрд╕реНрдЯ рдФрд░ рдЗрдореЗрдЬреЗрд╕ рдореЗрдВ рд╕реБрд░рдХреНрд╖рд╛ рдкреИрдЪ рд▓рд╛рдЧреВ рдХрд┐рдП рдЬрд╛ рд╕рдХреЗрдВред**
* рдЕрдкрдиреЗ **secrets рдХреЛ рдмреБрджреНрдзрд┐рдорд╛рдиреА рд╕реЗ рдкреНрд░рдмрдВрдзрд┐рдд рдХрд░реЗрдВ** рддрд╛рдХрд┐ рд╣рдорд▓рд╛рд╡рд░ рдХреЗ рд▓рд┐рдП рдЙрди рддрдХ рдкрд╣реБрдВрдЪрдирд╛ рдХрдард┐рди рд╣реЛред
* рдпрджрд┐ рдЖрдк **docker daemon рдХреЛ рдЙрдЬрд╛рдЧрд░ рдХрд░рддреЗ рд╣реИрдВ рддреЛ HTTPS рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ** рдХреНрд▓рд╛рдЗрдВрдЯ рдФрд░ рд╕рд░реНрд╡рд░ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЗ рд╕рд╛рдеред
* рдЕрдкрдиреА Dockerfile рдореЗрдВ, **ADD рдХреЗ рдмрдЬрд╛рдп COPY рдХреЛ рдкреНрд░рд╛рдердорд┐рдХрддрд╛ рджреЗрдВ**ред ADD рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдЬрд╝рд┐рдк рдлрд╛рдЗрд▓реЛрдВ рдХреЛ рдирд┐рдХрд╛рд▓рддрд╛ рд╣реИ рдФрд░ URL рд╕реЗ рдлрд╛рдЗрд▓реЛрдВ рдХреА рдкреНрд░рддрд┐рд▓рд┐рдкрд┐ рдмрдирд╛ рд╕рдХрддрд╛ рд╣реИред COPY рдХреЗ рдпреЗ рдХреНрд╖рдорддрд╛рдПрдВ рдирд╣реАрдВ рд╣реИрдВред рдЬрдм рднреА рд╕рдВрднрд╡ рд╣реЛ, ADD рдХрд╛ рдЙрдкрдпреЛрдЧ рди рдХрд░реЗрдВ рддрд╛рдХрд┐ рдЖрдк рд░рд┐рдореЛрдЯ URLs рдФрд░ Zip рдлрд╛рдЗрд▓реЛрдВ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╣рдорд▓реЛрдВ рдХреЗ рдкреНрд░рддрд┐ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рди рд╣реЛрдВред
* рдкреНрд░рддреНрдпреЗрдХ рдорд╛рдЗрдХреНрд░реЛ-рд╕рд░реНрд╡рд┐рд╕ рдХреЗ рд▓рд┐рдП **рдЕрд▓рдЧ рдХрдВрдЯреЗрдирд░реНрд╕ рд░рдЦреЗрдВ**
* рдХрдВрдЯреЗрдирд░ рдХреЗ рдЕрдВрджрд░ **ssh рди рдбрд╛рд▓реЗрдВ**, тАЬdocker execтАЭ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХрдВрдЯреЗрдирд░ рдореЗрдВ ssh рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред
* **рдЫреЛрдЯреА** рдХрдВрдЯреЗрдирд░ **рдЗрдореЗрдЬреЗрд╕ рд░рдЦреЗрдВ**

## Docker Breakout / Privilege Escalation

рдпрджрд┐ рдЖрдк **рдПрдХ docker рдХрдВрдЯреЗрдирд░ рдХреЗ рдЕрдВрджрд░ рд╣реИрдВ** рдпрд╛ рдЖрдкрдХреЗ рдкрд╛рд╕ **docker рд╕рдореВрд╣ рдореЗрдВ рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреА рдкрд╣реБрдВрдЪ рд╣реИ**, рддреЛ рдЖрдк **рдмрдЪ рдирд┐рдХрд▓рдиреЗ рдФрд░ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдмрдврд╝рд╛рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**:

{% content-ref url="docker-breakout-privilege-escalation/" %}
[docker-breakout-privilege-escalation](docker-breakout-privilege-escalation/)
{% endcontent-ref %}

## Docker Authentication Plugin Bypass

рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ docker socket рддрдХ рдкрд╣реБрдВрдЪ рд╣реИ рдпрд╛ рдЖрдкрдХреЗ рдкрд╛рд╕ **docker рд╕рдореВрд╣ рдореЗрдВ рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреА рдкрд╣реБрдВрдЪ рд╣реИ рд▓реЗрдХрд┐рди рдЖрдкрдХреА рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЛ docker auth plugin рджреНрд╡рд╛рд░рд╛ рд╕реАрдорд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд░рд╣рд╛ рд╣реИ**, рддреЛ рдЬрд╛рдВрдЪреЗрдВ рдХрд┐ рдХреНрдпрд╛ рдЖрдк **рдЗрд╕реЗ рдмрд╛рдпрдкрд╛рд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:**

{% content-ref url="authz-and-authn-docker-access-authorization-plugin.md" %}
[authz-and-authn-docker-access-authorization-plugin.md](authz-and-authn-docker-access-authorization-plugin.md)
{% endcontent-ref %}

## Hardening Docker

* рдЙрдкрдХрд░рдг [**docker-bench-security**](https://github.com/docker/docker-bench-security) рдПрдХ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рд╣реИ рдЬреЛ рдкреНрд░реЛрдбрдХреНрд╢рди рдореЗрдВ Docker рдХрдВрдЯреЗрдирд░реНрд╕ рдХреЛ рддреИрдирд╛рдд рдХрд░рдиреЗ рдХреЗ рдЖрд╕рдкрд╛рд╕ рдХреА рджрд░реНрдЬрдиреЛрдВ рд╕рд╛рдорд╛рдиреНрдп рдмреЗрд╕реНрдЯ-рдкреНрд░реИрдХреНрдЯрд┐рд╕реЗрдЬ рдХреА рдЬрд╛рдВрдЪ рдХрд░рддреА рд╣реИред рдЯреЗрд╕реНрдЯ рд╕рднреА рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд╣реИрдВ, рдФрд░ [CIS Docker Benchmark v1.3.1](https://www.cisecurity.org/benchmark/docker/) рдкрд░ рдЖрдзрд╛рд░рд┐рдд рд╣реИрдВред\
рдЖрдкрдХреЛ рдЗрд╕ рдЙрдкрдХрд░рдг рдХреЛ docker рдЪрд▓рд╛ рд░рд╣реЗ рд╣реЛрд╕реНрдЯ рд╕реЗ рдпрд╛ рдкрд░реНрдпрд╛рдкреНрдд рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рд╡рд╛рд▓реЗ рдХрдВрдЯреЗрдирд░ рд╕реЗ рдЪрд▓рд╛рдирд╛ рд╣реЛрдЧрд╛ред **рдХреИрд╕реЗ рдЪрд▓рд╛рдирд╛ рд╣реИ рдЗрд╕рдХреЗ рд▓рд┐рдП README рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА рдкрд╛рдПрдВ:** [**https://github.com/docker/docker-bench-security**](https://github.com/docker/docker-bench-security).

## References

* [https://blog.trailofbits.com/2019/07/19/understanding-docker-container-escapes/](https://blog.trailofbits.com/2019/07/19/understanding-docker-container-escapes/)
* [https://twitter.com/\_fel1x/status/1151487051986087936](https://twitter.com/\_fel1x/status/1151487051986087936)
* [https://ajxchapman.github.io/containers/2020/11/19/privileged-container-escape.html](https://ajxchapman.github.io/containers/2020/11/19/privileged-container-escape.html)
* [https://sreeninet.wordpress.com/2016/03/06/docker-security-part-1overview/](https://sreeninet.wordpress.com/2016/03/06/docker-security-part-1overview/)
* [https://sreeninet.wordpress.com/2016/03/06/docker-security-part-2docker-engine/](https://sreeninet.wordpress.com/2016/03/06/docker-security-part-2docker-engine/)
* [https://sreeninet.wordpress.com/2016/03/06/docker-security-part-3engine-access/](https://sreeninet.wordpress.com/2016/03/06/docker-security-part-3engine-access/)
* [https://sreeninet.wordpress.com/2016/03/06/docker-security-part-4container-image/](https://sreeninet.wordpress.com/2016/03/06/docker-security-part-4container-image/)
* [https://en.wikipedia.org/wiki/Linux\_namespaces](https://en.wikipedia.org/wiki/Linux\_namespaces)
* [https://t
