# AppArmor

{% hint style="success" %}
рд╕реАрдЦреЗрдВ рдФрд░ рдкреНрд░реИрдХреНрдЯрд┐рд╕ рдХрд░реЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ: <img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks рдкреНрд░рд╢рд┐рдХреНрд╖рдг AWS рд░реЗрдб рдЯреАрдо рдПрдХреНрд╕рдкрд░реНрдЯ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
рд╕реАрдЦреЗрдВ рдФрд░ рдкреНрд░реИрдХреНрдЯрд┐рд╕ рдХрд░реЗрдВ GCP рд╣реИрдХрд┐рдВрдЧ: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks рдкреНрд░рд╢рд┐рдХреНрд╖рдг GCP рд░реЗрдб рдЯреАрдо рдПрдХреНрд╕рдкрд░реНрдЯ (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ</summary>

* [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ!
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдФрд░ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** рдХреЛ** **рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕**](https://github.com/carlospolop/hacktricks) **рдФрд░ рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдХреНрд▓рд╛рдЙрдб**](https://github.com/carlospolop/hacktricks-cloud) **github рд░реЗрдкреЛ рдореЗрдВ рдкреАрдЖрд░ рдЬрдорд╛ рдХрд░рдХреЗред

</details>
{% endhint %}

### [WhiteIntel](https://whiteintel.io)

<figure><img src="../../../.gitbook/assets/image (1227).png" alt=""><figcaption></figcaption></figure>

[**WhiteIntel**](https://whiteintel.io) рдПрдХ **рдбрд╛рд░реНрдХ-рд╡реЗрдм** рдкрд░ рдЖрдзрд╛рд░рд┐рдд рдЦреЛрдЬ рдЗрдВрдЬрди рд╣реИ рдЬреЛ **рдореБрдлреНрдд** рд╕реБрд╡рд┐рдзрд╛рдПрдВ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ рддрд╛рдХрд┐ рдпрд╣ рдЬрд╛рдВрдЪ рд╕рдХреЗ рдХрд┐ рдХреЛрдИ рдХрдВрдкрдиреА рдпрд╛ рдЙрд╕рдХреЗ рдЧреНрд░рд╛рд╣рдХреЛрдВ рдХреЛ **рд╕реНрдЯреАрд▓рд░ рдореИрд▓рд╡реЗрдпрд░реНрд╕** рджреНрд╡рд╛рд░рд╛ **рдХрдВрдкреНрд░реЛрдорд╛рдЗрдЬ** рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рдпрд╛ рдирд╣реАрдВред

рд╡реНрд╣рд╛рдЗрдЯрдЗрдВрдЯреЗрд▓ рдХрд╛ рдореБрдЦреНрдп рдЙрджреНрджреЗрд╢реНрдп рдЦрд╛рддрд╛ рд╣рд╛рд╕рд┐рд▓ рдХрд░рдиреЗ рдФрд░ рд░реИрдВрд╕рдорд╡реЗрдпрд░ рд╣рдорд▓реЛрдВ рдХрд╛ рдореБрдХрд╛рдмрд▓рд╛ рдХрд░рдирд╛ рд╣реИ рдЬреЛ рдЬрд╛рдирдХрд╛рд░реА рдЪреЛрд░реА рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдореИрд▓рд╡реЗрдпрд░ рд╕реЗ рд╣реЛрддреЗ рд╣реИрдВред

рдЖрдк рдЙрдирдХреА рд╡реЗрдмрд╕рд╛рдЗрдЯ рдЪреЗрдХ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ **рдореБрдлреНрдд** рдореЗрдВ рдЙрдирдХрд╛ рдЗрдВрдЬрди рдЖрдЬрдорд╛ рд╕рдХрддреЗ рд╣реИрдВ:

{% embed url="https://whiteintel.io" %}

***

## рдореВрд▓ рдЬрд╛рдирдХрд╛рд░реА

AppArmor рдПрдХ **рдХрд░реНрдиреЗрд▓ рдПрдиреНрд╣рд╛рдВрд╕рдореЗрдВрдЯ** рд╣реИ рдЬреЛ рдХрд╛рд░реНрдпрдХреНрд░рдореЛрдВ рдХреЗ рд▓рд┐рдП рдкреНрд░реЛрдлрд╛рдЗрд▓ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЙрдкрд▓рдмреНрдз рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреЛ рдкреНрд░рддрд┐рдмрдВрдзрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдбрд┐рдЬрд╝рд╛рдЗрди рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдЕрдирд┐рд╡рд╛рд░реНрдп рдПрдХреНрд╕реЗрд╕ рдирд┐рдпрдВрддреНрд░рдг (MAC) рдХреЛ рдкреНрд░рднрд╛рд╡реА рд░реВрдк рд╕реЗ рд▓рд╛рдЧреВ рдХрд░рдХреЗ рдПрдХреНрд╕реЗрд╕ рдирд┐рдпрдВрддреНрд░рдг рдЧреБрдгреЛрдВ рдХреЛ рд╕реАрдзреЗ рдкреНрд░реЛрдЧреНрд░рд╛рдореЛрдВ рд╕реЗ рдпреБрдХреНрдд рдХрд░рдиреЗ рдХреЗ рджреНрд╡рд╛рд░рд╛ред рдпрд╣ рд╕рд┐рд╕реНрдЯрдо **рдХрд░реНрдиреЗрд▓ рдореЗрдВ рдкреНрд░реЛрдлрд╛рдЗрд▓ рд▓реЛрдб рдХрд░рдХреЗ** рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ, рд╕рд╛рдорд╛рдиреНрдпрдд: рдмреВрдЯ рдХреЗ рджреМрд░рд╛рди, рдФрд░ рдпреЗ рдкреНрд░реЛрдлрд╛рдЗрд▓ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рддреЗ рд╣реИрдВ рдХрд┐ рдХреЛрдИ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдХрд┐рд╕ рд╕рдВрд╕рд╛рдзрди рддрдХ рдкрд╣реБрдВрдЪ рд╕рдХрддрд╛ рд╣реИ, рдЬреИрд╕реЗ рдиреЗрдЯрд╡рд░реНрдХ рдХрдиреЗрдХреНрд╢рди, рд░реЙ рд╕реЙрдХреЗрдЯ рдПрдХреНрд╕реЗрд╕, рдФрд░ рдлрд╝рд╛рдЗрд▓ рдЕрдиреБрдорддрд┐рдпрд╛рдБред

AppArmor рдкреНрд░реЛрдлрд╛рдЗрд▓ рдХреЗ рд▓рд┐рдП рджреЛ рдкреНрд░рдЪрд▓рд┐рдд рдореЛрдб рд╣реИрдВ:

* **рдирд┐рд╖реЗрдз рдореЛрдб**: рдпрд╣ рдореЛрдб рдкреНрд░реЛрдлрд╛рдЗрд▓ рдореЗрдВ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдиреАрддрд┐рдпреЛрдВ рдХреЛ рд╕рдХреНрд░рд┐рдп рд░реВрдк рд╕реЗ рд▓рд╛рдЧреВ рдХрд░рддрд╛ рд╣реИ, рдЬреЛ рдЗрди рдиреАрддрд┐рдпреЛрдВ рдХрд╛ рдЙрд▓реНрд▓рдВрдШрди рдХрд░рдиреЗ рд╡рд╛рд▓реА рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЛ рд░реЛрдХрддрд╛ рд╣реИ рдФрд░ syslog рдпрд╛ auditd рдЬреИрд╕реЗ рд╕рд┐рд╕реНрдЯрдо рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЗрдиреНрд╣реЗрдВ рдЙрд▓реНрд▓рдВрдШрди рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢реЛрдВ рдХреЛ рд▓реЙрдЧ рдХрд░рддрд╛ рд╣реИред
* **рд╢рд┐рдХрд╛рдпрдд рдореЛрдб**: рдирд┐рд╖реЗрдз рдореЛрдб рдХреА рддрд░рд╣, рд╢рд┐рдХрд╛рдпрдд рдореЛрдб рдЙрди рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЛ рдирд╣реАрдВ рд░реЛрдХрддрд╛ рдЬреЛ рдкреНрд░реЛрдлрд╛рдЗрд▓ рдХреА рдиреАрддрд┐рдпреЛрдВ рдХреЗ рдЦрд┐рд▓рд╛рдл рдЬрд╛рддреА рд╣реИрдВред рдЗрд╕рдХреЗ рдмрдЬрд╛рдп, рдпрд╣ рдЗрди рдкреНрд░рдпрд╛рд╕реЛрдВ рдХреЛ рдиреАрддрд┐рдпреЛрдВ рдХреЗ рдЙрд▓реНрд▓рдВрдШрди рдХреЗ рд░реВрдк рдореЗрдВ рд▓реЙрдЧ рдХрд░рддрд╛ рд╣реИ рдмрд┐рдирд╛ рдкреНрд░рддрд┐рдмрдВрдзреЛрдВ рдХреЛ рд▓рд╛рдЧреВ рдХрд░рдиреЗред

### AppArmor рдХреЗ рдШрдЯрдХ

* **рдХрд░реНрдиреЗрд▓ рдореЙрдбреНрдпреВрд▓**: рдиреАрддрд┐рдпреЛрдВ рдХреЗ рдкреНрд░рд╡рд░реНрддрди рдХреЗ рд▓рд┐рдП рдЬрд┐рдореНрдореЗрджрд╛рд░ред
* **рдиреАрддрд┐рдпрд╛рдБ**: рдХрд╛рд░реНрдпрдХреНрд░рдо рд╡реНрдпрд╡рд╣рд╛рд░ рдФрд░ рд╕рдВрд╕рд╛рдзрди рдПрдХреНрд╕реЗрд╕ рдХреЗ рд▓рд┐рдП рдирд┐рдпрдо рдФрд░ рдкреНрд░рддрд┐рдмрдВрдз рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рддреА рд╣реИрдВред
* **рдкрд╛рд░реНрд╕рд░**: рдиреАрддрд┐рдпреЛрдВ рдХреЛ рдХрд░реНрдиреЗрд▓ рдореЗрдВ рдкреНрд░рд╡рд░реНрддрди рдпрд╛ рд░рд┐рдкреЛрд░реНрдЯрд┐рдВрдЧ рдХреЗ рд▓рд┐рдП рд▓реЛрдб рдХрд░рддрд╛ рд╣реИред
* **рдЙрдкрдпреЛрдЧрд┐рддрд╛рдПрдВ**: рдпреЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдореЛрдб рдкреНрд░реЛрдЧреНрд░рд╛рдореНрд╕ рдХреЗ рд╕рд╛рде рдмрд╛рддрдЪреАрдд рдХрд░рдиреЗ рдФрд░ AppArmor рдХрд╛ рдкреНрд░рдмрдВрдзрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдЗрдВрдЯрд░рдлреЗрд╕ рдкреНрд░рджрд╛рди рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдкреНрд░реЛрдЧреНрд░рд╛рдо рд╣реИрдВред

### рдкреНрд░реЛрдлрд╛рдЗрд▓ рдкрде

Apparmor рдкреНрд░реЛрдлрд╛рдЗрд▓ рдЖрдо рддреМрд░ рдкрд░ _**/etc/apparmor.d/**_ рдореЗрдВ рд╕рд╣реЗрдЬреЗ рдЬрд╛рддреЗ рд╣реИрдВред\
`sudo aa-status` рдХреЗ рд╕рд╛рде рдЖрдк рдЙрди рдмрд╛рдЗрдирд░реА рдХреЛ рд╕реВрдЪреАрдмрджреНрдз рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд┐рдиреНрд╣реЗрдВ рдХрд┐рд╕реА рдкреНрд░реЛрдлрд╛рдЗрд▓ рджреНрд╡рд╛рд░рд╛ рдкреНрд░рддрд┐рдмрдВрдзрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред рдпрджрд┐ рдЖрдк рдкреНрд░рддреНрдпреЗрдХ рд╕реВрдЪреАрдмрджреНрдз рдмрд╛рдЗрдирд░реА рдХреЗ рдкрде рдХрд╛ рдЪрд╛рд░ "/" рдХреЛ рдЙрд╕рдХреЗ рдирд╛рдо рдореЗрдВ рдбреЙрдЯ рдореЗрдВ рдмрджрд▓ рд╕рдХрддреЗ рд╣реИрдВ рддреЛ рдЖрдкрдХреЛ рдЙрд▓реНрд▓рд┐рдЦрд┐рдд рдлрд╝реЛрд▓реНрдбрд░ рдХреЗ рдЕрдВрджрд░ рдПрдкрд╛рд░реНрдорд░ рдкреНрд░реЛрдлрд╛рдЗрд▓ рдХрд╛ рдирд╛рдо рдкреНрд░рд╛рдкреНрдд рд╣реЛрдЧрд╛ред

рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, _/usr/bin/man_ рдХреЗ рд▓рд┐рдП рдПрдХ **apparmor** рдкреНрд░реЛрдлрд╛рдЗрд▓ _/etc/apparmor.d/usr.bin.man_ рдореЗрдВ рд╕реНрдерд┐рдд рд╣реЛрдЧрд╛ред

### рдХрдорд╛рдВрдбреНрд╕
```bash
aa-status     #check the current status
aa-enforce    #set profile to enforce mode (from disable or complain)
aa-complain   #set profile to complain mode (from diable or enforcement)
apparmor_parser #to load/reload an altered policy
aa-genprof    #generate a new profile
aa-logprof    #used to change the policy when the binary/program is changed
aa-mergeprof  #used to merge the policies
```
## рдкреНрд░реЛрдлрд╝рд╛рдЗрд▓ рдмрдирд╛рдирд╛

* рдкреНрд░рднрд╛рд╡рд┐рдд рдПрдХреНрдЬреАрдХреНрдпреВрдЯреЗрдмрд▓ рдХреЛ рджрд░реНрд╢рд╛рдиреЗ рдХреЗ рд▓рд┐рдП, **рдкреВрд░реНрдг рдорд╛рд░реНрдЧ рдФрд░ рд╡рд╛рдЗрд▓реНрдбрдХрд╛рд░реНрдб** (рдлрд╝рд╛рдЗрд▓ рдЧреНрд▓реЙрдмрд┐рдВрдЧ рдХреЗ рд▓рд┐рдП) рдХреА рдЕрдиреБрдорддрд┐ рд╣реИред
* **рдлрд╝рд╛рдЗрд▓реЛрдВ** рдкрд░ рдПрдХреНрд╕реЗрд╕ рдирд┐рдпрдВрддреНрд░рдг рдХреЛ рджрд░реНрд╢рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд **рдПрдХреНрд╕реЗрд╕ рдирд┐рдпрдВрддреНрд░рдг** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:
* **r** (рдкрдврд╝рдирд╛)
* **w** (рд▓рд┐рдЦрдирд╛)
* **m** (рдореЗрдореЛрд░реА рдореИрдк рдХреЗ рд░реВрдк рдореЗрдВ рдПрдХреНрдЬреАрдХреНрдпреВрдЯреЗрдмрд▓)
* **k** (рдлрд╝рд╛рдЗрд▓ рд▓реЙрдХрд┐рдВрдЧ)
* **l** (рд╣рд╛рд░реНрдб рд▓рд┐рдВрдХреНрд╕ рдмрдирд╛рдирд╛)
* **ix** (рдирдП рдкреНрд░реЛрдЧреНрд░рд╛рдо рдХреЛ рдиреАрддрд┐ рд╡рд┐рд░рд╛рд╕рдд рдореЗрдВ рдПрдХреНрдЬреАрдХреНрдпреВрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП)
* **Px** (рдкрд░реНрдпрд╛рд╡рд░рдг рдХреЛ рд╕рд╛рдл рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж рдПрдХ рдЕрдиреНрдп рдкреНрд░реЛрдлрд╝рд╛рдЗрд▓ рдХреЗ рддрд╣рдд рдПрдХреНрдЬреАрдХреНрдпреВрдЯ рдХрд░реЗрдВ)
* **Cx** (рдкрд░реНрдпрд╛рд╡рд░рдг рдХреЛ рд╕рд╛рдл рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж рдПрдХ рдмрдЪреНрдЪрд╛ рдкреНрд░реЛрдлрд╝рд╛рдЗрд▓ рдХреЗ рддрд╣рдд рдПрдХреНрдЬреАрдХреНрдпреВрдЯ рдХрд░реЗрдВ)
* **Ux** (рдкрд░реНрдпрд╛рд╡рд░рдг рдХреЛ рд╕рд╛рдл рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж рдЕрдирд┐рдпрдВрддреНрд░рд┐рдд рдПрдХреНрдЬреАрдХреНрдпреВрдЯ рдХрд░реЗрдВ)
* **рдкреНрд░реЛрдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдЪрд░** рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд┐рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдкреНрд░реЛрдлрд╝рд╛рдЗрд▓ рдХреЗ рдмрд╛рд╣рд░ рд╕реЗ рдЙрдиреНрд╣реЗрдВ рдкрд░рд┐рд╡рд░реНрддрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП: @{PROC} рдФрд░ @{HOME} (рдкреНрд░реЛрдлрд╝рд╛рдЗрд▓ рдлрд╝рд╛рдЗрд▓ рдореЗрдВ #include \<tunables/global> рдЬреЛрдбрд╝реЗрдВ)
* **рдЕрдиреБрдорддрд┐ рдирд┐рдпрдореЛрдВ рдХреЛ рдЕрдзрд┐рд▓реЗрдЦрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рд╖реЗрдз рдирд┐рдпрдо рд╕рдорд░реНрдерд┐рдд рд╣реИрдВ**ред

### aa-genprof

рдПрдХ рдкреНрд░реЛрдлрд╝рд╛рдЗрд▓ рдмрдирд╛рдирд╛ рд╢реБрд░реВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреА рдорджрдж рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП apparmor рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред **рдПрдХреНрд╢рдиреНрд╕ рдХреЛ рдЬрд╛рдБрдЪрдиреЗ рдХреЗ рд▓рд┐рдП apparmor рдХреА рд╕рд╣рд╛рдпрддрд╛ рд▓реЗрдХрд░ рдПрдХ рдПрдХреНрдЬреАрдХреНрдпреВрдЯреЗрдмрд▓ рджреНрд╡рд╛рд░рд╛ рдХрд┐рдП рдЧрдП рдХрд╛рд░реНрд░рд╡рд╛рдИрдпреЛрдВ рдХреЛ рдЬрд╛рдБрдЪрдиреЗ рдХреЗ рдмрд╛рдж рдЖрдкрдХреЛ рдпрд╣ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рдиреЗ рджреЗрдиреЗ рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рд╣реИ рдХрд┐ рдЖрдк рдХрд┐рд╕ рдХрд╛рд░реНрд░рд╡рд╛рдИ рдХреЛ рдЕрдиреБрдорддрд┐ рджреЗрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдпрд╛ рдирд┐рд╖реЗрдз рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ**ред\
рдЖрдкрдХреЛ рдмрд╕ рдпрд╣ рд░рди рдХрд░рдирд╛ рд╣реИ:
```bash
sudo aa-genprof /path/to/binary
```
рдлрд┐рд░, рдПрдХ рд╡рд┐рднрд┐рдиреНрди рдХрдВрд╕реЛрд▓ рдореЗрдВ рд╡рд╣ рд╕рднреА рдХреНрд░рд┐рдпрд╛рдПрдБ рдХрд░реЗрдВ рдЬреЛ рдмрд╛рдЗрдирд░реА рд╕рд╛рдорд╛рдиреНрдп рд░реВрдк рд╕реЗ рдХрд░реЗрдЧрд╛:
```bash
/path/to/binary -a dosomething
```
рддреЛ, рдкрд╣рд▓реА рдХрдВрд╕реЛрд▓ рдореЗрдВ "**s**" рджрдмрд╛рдПрдВ рдФрд░ рдлрд┐рд░ рд░рд┐рдХреЙрд░реНрдбреЗрдб рдХреНрд░рд┐рдпрд╛рдУрдВ рдореЗрдВ рдЗрдВрдбрд┐рдХреЗрдЯ рдХрд░реЗрдВ рдХрд┐ рдЖрдк рдХреНрдпрд╛ рдЕрдирджреЗрдЦрд╛ рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рдЕрдиреБрдорддрд┐ рджреЗрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рдпрд╛ рдХреБрдЫ рдФрд░ред рдЬрдм рдЖрдк рд╕рдорд╛рдкреНрдд рд╣реЛ рдЬрд╛рдПрдВ рддреЛ "**f**" рджрдмрд╛рдПрдВ рдФрд░ рдирдпрд╛ рдкреНрд░реЛрдлрд╝рд╛рдЗрд▓ _/etc/apparmor.d/path.to.binary_ рдореЗрдВ рдмрдирд╛рдпрд╛ рдЬрд╛рдПрдЧрд╛

{% hint style="info" %}
рдПрд░реЛ рдХреБрдВрдЬреА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЖрдк рдЪреБрди рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдЖрдк рдХреНрдпрд╛ рдЕрдиреБрдорддрд┐ рджреЗрдирд╛/рдЗрдирдХрд╛рд░/рдХреБрдЫ рдФрд░ рдЪрд╛рд╣рддреЗ рд╣реИрдВ
{% endhint %}

### aa-easyprof

рдЖрдк рдПрдХ рдмрд╛рдЗрдирд░реА рдХреЗ рдПрдХ apparmor рдкреНрд░реЛрдлрд╝рд╛рдЗрд▓ рдХрд╛ рдЯреЗрдореНрдкреНрд▓реЗрдЯ рднреА рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
sudo aa-easyprof /path/to/binary
# vim:syntax=apparmor
# AppArmor policy for binary
# ###AUTHOR###
# ###COPYRIGHT###
# ###COMMENT###

#include <tunables/global>

# No template variables specified

"/path/to/binary" {
#include <abstractions/base>

# No abstractions specified

# No policy groups specified

# No read paths specified

# No write paths specified
}
```
{% hint style="info" %}
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдПрдХ рдмрдирд╛рдП рдЧрдП рдкреНрд░реЛрдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдХреБрдЫ рднреА рдЕрдиреБрдорддрд┐ рдирд╣реАрдВ рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╕рдм рдХреБрдЫ рдирд┐рд╖реЗрдзрд┐рдд рд╣реИред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП рдмрд╛рдЗрдирд░реА рдХреЛ `/etc/passwd r,` рдкрдврд╝рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ рд▓рд╛рдЗрди рдЬреЛрдбрд╝рдиреА рд╣реЛрдЧреАред
{% endhint %}

рдЖрдк рдлрд┐рд░ рдирдП рдкреНрд░реЛрдлрд╝рд╛рдЗрд▓ рдХреЛ **рд▓рд╛рдЧреВ** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ
```bash
sudo apparmor_parser -a /etc/apparmor.d/path.to.binary
```
### рд▓реЙрдЧ рд╕реЗ рдкреНрд░реЛрдлрд╝рд╛рдЗрд▓ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдирд╛

рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЯреВрд▓ рд▓реЙрдЧ рдкрдврд╝реЗрдЧрд╛ рдФрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕реЗ рдкреВрдЫреЗрдЧрд╛ рдХрд┐ рдХреНрдпрд╛ рд╡рд╣ рдХреБрдЫ рдкреНрд░рддрд┐рдмрдВрдзрд┐рдд рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдирд╛ рдЪрд╛рд╣рддрд╛ рд╣реИ:
```bash
sudo aa-logprof
```
{% hint style="info" %}
рдПрд░реЛ рдХреБрдВрдЬреА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЖрдк рдЪреБрди рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдЖрдк рдХреНрдпрд╛ рдЕрдиреБрдорддрд┐ рджреЗрдирд╛/рд╡рд┐рд░реЛрдз/рдпрд╛ рдХреБрдЫ рднреА рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВред
{% endhint %}

### рдкреНрд░реЛрдлрд╝рд╛рдЗрд▓ рдкреНрд░рдмрдВрдзрди
```bash
#Main profile management commands
apparmor_parser -a /etc/apparmor.d/profile.name #Load a new profile in enforce mode
apparmor_parser -C /etc/apparmor.d/profile.name #Load a new profile in complain mode
apparmor_parser -r /etc/apparmor.d/profile.name #Replace existing profile
apparmor_parser -R /etc/apparmor.d/profile.name #Remove profile
```
## рд▓реЙрдЧ

**AUDIT** рдФрд░ **DENIED** рд▓реЙрдЧ рдХрд╛ рдЙрджрд╛рд╣рд░рдг _/var/log/audit/audit.log_ рд╕реЗ рдПрдХреНрдЬреАрдХреНрдпреВрдЯреЗрдмрд▓ **`service_bin`** рдХрд╛:
```bash
type=AVC msg=audit(1610061880.392:286): apparmor="AUDIT" operation="getattr" profile="/bin/rcat" name="/dev/pts/1" pid=954 comm="service_bin" requested_mask="r" fsuid=1000 ouid=1000
type=AVC msg=audit(1610061880.392:287): apparmor="DENIED" operation="open" profile="/bin/rcat" name="/etc/hosts" pid=954 comm="service_bin" requested_mask="r" denied_mask="r" fsuid=1000 ouid=0
```
рдЖрдк рдЗрд╕ рдЬрд╛рдирдХрд╛рд░реА рдХреЛ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рднреА рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
sudo aa-notify -s 1 -v
Profile: /bin/service_bin
Operation: open
Name: /etc/passwd
Denied: r
Logfile: /var/log/audit/audit.log

Profile: /bin/service_bin
Operation: open
Name: /etc/hosts
Denied: r
Logfile: /var/log/audit/audit.log

AppArmor denials: 2 (since Wed Jan  6 23:51:08 2021)
For more information, please see: https://wiki.ubuntu.com/DebuggingApparmor
```
## рдбреЙрдХрд░ рдореЗрдВ Apparmor

рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдбреЙрдХрд░ рдХрд╛ рдкреНрд░реЛрдлрд╝рд╛рдЗрд▓ **docker-profile** рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рд▓реЛрдб рд╣реЛрддрд╛ рд╣реИ:
```bash
sudo aa-status
apparmor module is loaded.
50 profiles are loaded.
13 profiles are in enforce mode.
/sbin/dhclient
/usr/bin/lxc-start
/usr/lib/NetworkManager/nm-dhcp-client.action
/usr/lib/NetworkManager/nm-dhcp-helper
/usr/lib/chromium-browser/chromium-browser//browser_java
/usr/lib/chromium-browser/chromium-browser//browser_openjdk
/usr/lib/chromium-browser/chromium-browser//sanitized_helper
/usr/lib/connman/scripts/dhclient-script
docker-default
```
By default **Apparmor docker-default profile** is generated from [https://github.com/moby/moby/tree/master/profiles/apparmor](https://github.com/moby/moby/tree/master/profiles/apparmor)

**docker-default profile Summary**:

* **рд╕рднреА рдиреЗрдЯрд╡рд░реНрдХрд┐рдВрдЧ** рддрдХ **рдкрд╣реБрдВрдЪ**
* **рдХреЛрдИ рдХреНрд╖рдорддрд╛** рдкрд░рд┐рднрд╛рд╖рд┐рдд рдирд╣реАрдВ рд╣реИ (рд╣рд╛рд▓рд╛рдВрдХрд┐, рдХреБрдЫ рдХреНрд╖рдорддрд╛рдПрдБ рдореВрд▓ рдмреЗрд╕ рдирд┐рдпрдо рд╢рд╛рдорд┐рд▓ рдХрд░рдиреЗ рд╕реЗ рдЖрдПрдЧреА рдЬреИрд╕реЗ #include \<abstractions/base> )
* рдХрд┐рд╕реА рднреА **/proc** рдлрд╝рд╛рдЗрд▓ рдореЗрдВ **рд▓реЗрдЦрди** рдХреА **рдЕрдиреБрдорддрд┐ рдирд╣реАрдВ** рд╣реИ
* **рдЕрдиреНрдп рдЙрдкрдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛рдПрдБ**/**рдлрд╝рд╛рдЗрд▓реЗрдВ** /**proc** рдФрд░ /**sys** рдХреА **рдкрдврд╝рдиреЗ/рд▓рд┐рдЦрдиреЗ/рд▓реЙрдХ/рд▓рд┐рдВрдХ/рдХреНрд░рд┐рдпрд╛рдиреНрд╡рдпрди рдкрд╣реБрдВрдЪ** рдХреЛ **рдЗрдирдХрд╛рд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ**
* **рдорд╛рдЙрдВрдЯ** рдХреА **рдЕрдиреБрдорддрд┐ рдирд╣реАрдВ** рд╣реИ
* **Ptrace** рдХреЗрд╡рд▓ рдЙрд╕ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдкрд░ рдЪрд▓рд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ **рдПрдХ рд╣реА apparmor рдкреНрд░реЛрдлрд╝рд╛рдЗрд▓ рджреНрд╡рд╛рд░рд╛ рд╕реАрдорд┐рдд** рд╣реИ

рдПрдХ рдмрд╛рд░ рдЬрдм рдЖрдк **рдПрдХ рдбреЙрдХрд░ рдХрдВрдЯреЗрдирд░ рдЪрд▓рд╛рддреЗ рд╣реИрдВ** рддреЛ рдЖрдкрдХреЛ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЖрдЙрдЯрдкреБрдЯ рджрд┐рдЦрд╛рдИ рджреЗрдирд╛ рдЪрд╛рд╣рд┐рдП:
```bash
1 processes are in enforce mode.
docker-default (825)
```
рдиреЛрдЯ рдХрд░реЗрдВ рдХрд┐ **рдПрдкрд╛рд░реНрдорд░** рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдХрдВрдЯреЗрдирд░ рдХреЛ рджреА рдЧрдИ **рдХреНрд╖рдорддрд╛рдПрдБ рднреА рд░реЛрдХ рджреЗрдЧрд╛**ред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдпрд╣ **/proc рдХреЗ рдЕрдВрджрд░ рд▓рд┐рдЦрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдХреЛ рд░реЛрдХ рд╕рдХрддрд╛ рд╣реИ рднрд▓реЗ рд╣реА SYS\_ADMIN рдХреНрд╖рдорддрд╛ рджреА рдЧрдИ рд╣реЛ** рдХреНрдпреЛрдВрдХрд┐ рдбреЙрдХрд░ рдПрдкрд╛рд░реНрдорд░ рдкреНрд░реЛрдлрд╝рд╛рдЗрд▓ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдЗрд╕ рдкрд╣реБрдВрдЪ рдХреЛ рдЗрдирдХрд╛рд░ рдХрд░рддрд╛ рд╣реИ:
```bash
docker run -it --cap-add SYS_ADMIN --security-opt seccomp=unconfined ubuntu /bin/bash
echo "" > /proc/stat
sh: 1: cannot create /proc/stat: Permission denied
```
рдЖрдкрдХреЛ **apparmor рдХреЛ рдЕрдХреНрд╖рдо** рдХрд░рдирд╛ рд╣реЛрдЧрд╛ рддрд╛рдХрд┐ рдЗрд╕рдХреА рдкреНрд░рддрд┐рдмрдВрдзрд┐рддрд╛рдУрдВ рдХреЛ рдЕрдирджреЗрдЦрд╛ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗ:
```bash
docker run -it --cap-add SYS_ADMIN --security-opt seccomp=unconfined --security-opt apparmor=unconfined ubuntu /bin/bash
```
рдиреЛрдЯ рдХрд░реЗрдВ рдХрд┐ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ **AppArmor** рднреА **рдХрдВрдЯреЗрдирд░ рдХреЛ рдорд╛рдЙрдВрдЯ рдХрд░рдиреЗ рд╕реЗ рд░реЛрдХреЗрдЧрд╛** рдЕрдВрджрд░ рд╕реЗ рднреА SYS\_ADMIN рдХреНрд╖рдорддрд╛ рдХреЗ рд╕рд╛рдеред

рдиреЛрдЯ рдХрд░реЗрдВ рдХрд┐ рдЖрдк **рдХреНрд╖рдорддрд╛рдПрдБ рдЬреЛрдбрд╝ рд╕рдХрддреЗ/рд╣рдЯрд╛ рд╕рдХрддреЗ рд╣реИрдВ** рдбреЙрдХрд░ рдХрдВрдЯреЗрдирд░ рдореЗрдВ (рдпрд╣ рдЕрдм рднреА **AppArmor** рдФрд░ **Seccomp** рдЬреИрд╕реА рд╕реБрд░рдХреНрд╖рд╛ рд╡рд┐рдзрд┐рдпреЛрдВ рджреНрд╡рд╛рд░рд╛ рдкреНрд░рддрд┐рдмрдВрдзрд┐рдд рд░рд╣реЗрдЧрд╛):

* `--cap-add=SYS_ADMIN` `SYS_ADMIN` рдХреНрд╖рдорддрд╛ рджреЗрдВ
* `--cap-add=ALL` рд╕рднреА рдХреНрд╖рдорддрд╛рдПрдБ рджреЗрдВ
* `--cap-drop=ALL --cap-add=SYS_PTRACE` рд╕рднреА рдХреНрд╖рдорддрд╛рдПрдБ рд╣рдЯрд╛рдПрдВ рдФрд░ рдХреЗрд╡рд▓ `SYS_PTRACE` рджреЗрдВ

{% hint style="info" %}
рд╕рд╛рдорд╛рдиреНрдпрдд: рдЬрдм рдЖрдкрдХреЛ рдкрд╛рддрд╛ рдЪрд▓рддрд╛ рд╣реИ рдХрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдПрдХ **рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдХреНрд╖рдорддрд╛** рдЙрдкрд▓рдмреНрдз рд╣реИ **рдХрдВрдЯреЗрдирд░ рдХреЗ рдЕрдВрджрд░** **рд▓реЗрдХрд┐рди** рдХреБрдЫ рд╣рд┐рд╕реНрд╕рд╛ **рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рдХрд╛рдо рдирд╣реАрдВ рдХрд░ рд░рд╣рд╛ рд╣реИ**, рддреЛ рдпрд╣ рдЗрд╕рд▓рд┐рдП рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рдХрд┐ рдбреЙрдХрд░ **AppArmor рдЗрд╕реЗ рд░реЛрдХ рд░рд╣рд╛ рд╣реЛрдЧрд╛**ред
{% endhint %}

### рдЙрджрд╛рд╣рд░рдг

(рдЙрджрд╛рд╣рд░рдг [**рдпрд╣рд╛рдБ рд╕реЗ**](https://sreeninet.wordpress.com/2016/03/06/docker-security-part-2docker-engine/) рд╕реЗ)

AppArmor рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рдХреЛ рд╡рд┐рд╕реНрддрд╛рд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдореИрдВрдиреЗ рдПрдХ рдирдпрд╛ рдбреЙрдХрд░ рдкреНрд░реЛрдлрд╝рд╛рдЗрд▓ "mydocker" рдмрдирд╛рдпрд╛ рдЬрд┐рд╕рдореЗрдВ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкрдВрдХреНрддрд┐ рдЬреЛрдбрд╝реА рдЧрдИ:
```
deny /etc/* w,   # deny write for all files directly in /etc (not in a subdir)
```
рдЗрд╕ рдкреНрд░реЛрдлрд╝рд╛рдЗрд▓ рдХреЛ рд╕рдХреНрд░рд┐рдп рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрд╛рд░реНрд░рд╡рд╛рдИ рдХрд░рдиреА рд╣реЛрдЧреА:
```
sudo apparmor_parser -r -W mydocker
```
рдЕрджреНрдпрддрди рдХрд┐рдП рдЧрдП AppArmor рдкреНрд░реЛрдлрд╝рд╛рдЗрд▓ рдХреЛ рд╕реВрдЪреАрдмрджреНрдз рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрдорд╛рдВрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдиреАрдЪреЗ рджрд┐рдП рдЧрдП рдХрдорд╛рдВрдб рдореЗрд░реЗ рдирдП AppArmor рдкреНрд░реЛрдлрд╝рд╛рдЗрд▓ рдХреЛ рд╕реВрдЪреАрдмрджреНрдз рдХрд░ рд░рд╣рд╛ рд╣реИред
```
$ sudo apparmor_status  | grep mydocker
mydocker
```
рдЬреИрд╕рд╛ рдиреАрдЪреЗ рджрд┐рдЦрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ, рд╣рдореЗрдВ " /etc/ " рдмрджрд▓рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рдиреЗ рдкрд░ рддреНрд░реБрдЯрд┐ рдорд┐рд▓рддреА рд╣реИ рдХреНрдпреЛрдВрдХрд┐ AppArmor рдкреНрд░реЛрдлрд╝рд╛рдЗрд▓ " /etc/ " рдореЗрдВ рд▓реЗрдЦрди рдкрд╣реБрдВрдЪрдиреЗ рд╕реЗ рд░реЛрдХ рд░рд╣рд╛ рд╣реИред
```
$ docker run --rm -it --security-opt apparmor:mydocker -v ~/haproxy:/localhost busybox chmod 400 /etc/hostname
chmod: /etc/hostname: Permission denied
```
### AppArmor рдбреЙрдХрд░ рдмрд╛рдпрдкрд╛рд╕1

рдЖрдк рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ **рдкрддрд╛ рд▓рдЧрд╛ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдХреМрди рд╕рд╛ **apparmor рдкреНрд░реЛрдлрд╝рд╛рдЗрд▓** рдПрдХ рдХрдВрдЯреЗрдирд░ рдЪрд▓рд╛ рд░рд╣рд╛ рд╣реИ**:
```bash
docker inspect 9d622d73a614 | grep lowpriv
"AppArmorProfile": "lowpriv",
"apparmor=lowpriv"
```
рдлрд┐рд░, рдЖрдк рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкрдВрдХреНрддрд┐ рдХреЛ рдЪрд▓рд╛ рд╕рдХрддреЗ рд╣реИрдВ **рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд░рд╣рд╛ рд╕рдЯреАрдХ рдкреНрд░реЛрдлрд╝рд╛рдЗрд▓ рдЦреЛрдЬрдиреЗ рдХреЗ рд▓рд┐рдП**:
```bash
find /etc/apparmor.d/ -name "*lowpriv*" -maxdepth 1 2>/dev/null
```
### AppArmor Docker Bypass2

**AppArmor рдХрд╛ рдорд╛рд░реНрдЧ-рдЖрдзрд╛рд░рд┐рдд рд╣реИ**, рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдпрджрд┐ рдпрд╣ **рдлрд╝рд╛рдЗрд▓реЗрдВ рд╕реБрд░рдХреНрд╖рд┐рдд рдХрд░ рд░рд╣рд╛ рд╣реИ** рддреЛ рднреА рдПрдХ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХреЗ рднреАрддрд░ рдлрд╝рд╛рдЗрд▓реЗрдВ рдЬреИрд╕реЗ **`/proc`** рдЕрдЧрд░ рдЖрдк **рдХреЙрдиреНрдЯреЗрдирд░ рдХреЛ рдХреИрд╕реЗ рдЪрд▓рд╛рдпрд╛ рдЬрд╛рдПрдЧрд╛ рд╡рд╣ рд╡рд┐рдиреНрдпрд╛рд╕рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**, рддреЛ рдЖрдк **рдорд╛рдЙрдВрдЯ** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рд╣реЛрд╕реНрдЯ рдХреЗ proc рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХреЛ **`/host/proc`** рдФрд░ рдпрд╣ **рдЕрдм AppArmor рджреНрд╡рд╛рд░рд╛ рд╕реБрд░рдХреНрд╖рд┐рдд рдирд╣реАрдВ рд╣реЛрдЧрд╛**ред

### AppArmor Shebang Bypass

[**рдЗрд╕ рдмрдЧ**](https://bugs.launchpad.net/apparmor/+bug/1911431) рдореЗрдВ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ **рдпрджрд┐ рдЖрдк рдХрд┐рд╕реА рд╡рд┐рд╢реЗрд╖ рд╕рдВрд╕рд╛рдзрди рдХреЗ рд╕рд╛рде рдкрд░реНрд▓ рдХреЛ рдЪрд▓рд╛рдиреЗ рд╕реЗ рд░реЛрдХ рд░рд╣реЗ рд╣реИрдВ**, рддреЛ рднреА рдпрджрд┐ рдЖрдк рдХреЗрд╡рд▓ рдкрд╣рд▓реА рдкрдВрдХреНрддрд┐ рдореЗрдВ **`#!/usr/bin/perl`** рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдЖрдк **рдлрд╝рд╛рдЗрд▓ рдХреЛ рд╕реАрдзреЗ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рддреЗ рд╣реИрдВ**, рддреЛ рдЖрдк рдЪрд╛рд╣реЗрдВ рдЬреЛ рднреА рдЪрд╛рд╣реЗрдВ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдЙрджрд╛:
```perl
echo '#!/usr/bin/perl
use POSIX qw(strftime);
use POSIX qw(setuid);
POSIX::setuid(0);
exec "/bin/sh"' > /tmp/test.pl
chmod +x /tmp/test.pl
/tmp/test.pl
```
### [WhiteIntel](https://whiteintel.io)

<figure><img src="../../../.gitbook/assets/image (1227).png" alt=""><figcaption></figcaption></figure>

[**WhiteIntel**](https://whiteintel.io) рдПрдХ **рдбрд╛рд░реНрдХ-рд╡реЗрдм** рдкреНрд░реЗрд░рд┐рдд рдЦреЛрдЬ рдЗрдВрдЬрди рд╣реИ рдЬреЛ **рдореБрдлреНрдд** рд╕реБрд╡рд┐рдзрд╛рдПрдВ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ рддрд╛рдХрд┐ рдЬрд╛рдВрдЪ рд╕рдХреЗрдВ рдХрд┐ рдХреЛрдИ рдХрдВрдкрдиреА рдпрд╛ рдЙрд╕рдХреЗ рдЧреНрд░рд╛рд╣рдХреЛрдВ рдХреЛ **рд╕реНрдЯреАрд▓рд░ рдореИрд▓рд╡реЗрдпрд░реНрд╕** рджреНрд╡рд╛рд░рд╛ **рдХреНрд╖рддрд┐** рдкрд╣реБрдВрдЪрд╛рдИ рдЧрдИ рд╣реИ рдпрд╛ рдирд╣реАрдВред

WhiteIntel рдХрд╛ рдореБрдЦреНрдп рдЙрджреНрджреЗрд╢реНрдп рдЦрд╛рддрд╛ рд╣рд╛рд╕рд┐рд▓ рдХрд░рдиреЗ рдФрд░ рдЬрд╛рдирдХрд╛рд░реА рдЪреБрд░рд╛рдиреЗ рд╡рд╛рд▓реЗ рдореИрд▓рд╡реЗрдпрд░ рд╕реЗ рд╣реЛрдиреЗ рд╡рд╛рд▓реЗ рд░реИрдВрд╕рдорд╡реЗрдпрд░ рд╣рдорд▓реЛрдВ рдХрд╛ рдореБрдХрд╛рдмрд▓рд╛ рдХрд░рдирд╛ рд╣реИред

рдЖрдк рдЙрдирдХреА рд╡реЗрдмрд╕рд╛рдЗрдЯ рдЪреЗрдХ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ **рдореБрдлреНрдд** рдореЗрдВ рдЙрдирдХрд╛ рдЗрдВрдЬрди рдкреНрд░рдпрд╛рд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

{% embed url="https://whiteintel.io" %}

{% hint style="success" %}
AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks рдкреНрд░рд╢рд┐рдХреНрд╖рдг AWS рд░реЗрдб рдЯреАрдо рдПрдХреНрд╕рдкрд░реНрдЯ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks рдкреНрд░рд╢рд┐рдХреНрд╖рдг GCP рд░реЗрдб рдЯреАрдо рдПрдХреНрд╕рдкрд░реНрдЯ (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ</summary>

* [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ!
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж рдкрд░ **рдлреЙрд▓реЛ** рдХрд░реЗрдВ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github рд░реЗрдкреЛ рдореЗрдВред

</details>
{% endhint %}
