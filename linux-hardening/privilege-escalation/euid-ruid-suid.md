# euid, ruid, suid

<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

* рдХреНрдпрд╛ рдЖрдк **рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХрдВрдкрдиреА** рдореЗрдВ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ? рдХреНрдпрд╛ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХреЛ HackTricks рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ**? рдпрд╛ рдХреНрдпрд╛ рдЖрдкрдХреЛ **PEASS рдХреЗ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рдХрд╛ рдПрдХреНрд╕реЗрд╕ рдЪрд╛рд╣рд┐рдП**? [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ!
* рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣, [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** [**ЁЯТм**](https://emojipedia.org/speech-balloon/) [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ **рдореЗрд░рд╛** **Twitter** ЁЯРж[**@carlospolopm**](https://twitter.com/hacktricks_live)** рдХрд╛ рдкрд╛рд▓рди рдХрд░реЗрдВ**.
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, [hacktricks рд░реЗрдкреЛ](https://github.com/carlospolop/hacktricks) рдФрд░ [hacktricks-cloud рд░реЗрдкреЛ](https://github.com/carlospolop/hacktricks-cloud) рдкрд░ PR рдЬрдорд╛ рдХрд░рдХреЗ**ред

</details>

### рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкрд╣рдЪрд╛рди рдЪрд░рдг

- **`ruid`**: **рд░рд┐рдпрд▓ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЖрдИрдбреА** рдЙрд╕ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рджрд░реНрд╢рд╛рддрд╛ рд╣реИ рдЬрд┐рд╕рдиреЗ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдкреНрд░рд╛рд░рдВрдн рдХреА рд╣реИред
- **`euid`**: **рдкреНрд░рднрд╛рд╡реА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЖрдИрдбреА** рдХреЗ рд░реВрдк рдореЗрдВ рдЬрд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИ, рдпрд╣ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкрд╣рдЪрд╛рди рдХреЛ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рд┐рд╕реНрдЯрдо рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рд╕рд╛рдорд╛рдиреНрдпрдд: `euid` `ruid` рдХрд╛ рдкреНрд░рддрд┐рдмрд┐рдореНрдм рдХрд░рддрд╛ рд╣реИ, рд╕рд┐рд╡рд╛рдп рдЙрджрд╛рд╣рд░рдгреЛрдВ рдХреЗ рдЬреИрд╕реЗ рдХрд┐ SetUID рдмрд╛рдЗрдирд░реА рдХреНрд░рд┐рдпрд╛рдиреНрд╡рдпрди, рдЬрд╣рд╛рдВ `euid` рдлрд╝рд╛рдЗрд▓ рдХреЗ рдорд╛рд▓рд┐рдХ рдХреА рдкрд╣рдЪрд╛рди рд▓реЗрддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╡рд┐рд╢реЗрд╖ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдЕрдиреБрдорддрд┐рдпрд╛рдБ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред
- **`suid`**: рдпрд╣ **рд╕рд╣реЗрдЬреА рдЧрдИ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЖрдИрдбреА** рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ рдЬрдм рдПрдХ рдЙрдЪреНрдЪ-рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдкреНрд░рдХреНрд░рд┐рдпрд╛ (рд╕рд╛рдорд╛рдиреНрдпрдд: рдЬрдбрд╝) рдХреЛ рдХреБрдЫ рдХрд╛рд░реНрдп рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрд╕реНрдерд╛рдпреА рд░реВрдк рд╕реЗ рдЕрдкрдиреЗ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рд╕реЗ рд╡рдВрдЪрд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ, рдХреЗрд╡рд▓ рдЗрд╕рдХреЗ рдмрд╛рдж рдЕрдкрдиреА рдкреНрд░рд╛рд░рдВрднрд┐рдХ рдЙрдЪреНрдЪ рд╕реНрдерд┐рддрд┐ рдХреЛ рдкреБрдирдГ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдПред

#### рдорд╣рддреНрд╡рдкреВрд░реНрдг рдиреЛрдЯ
рдПрдХ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдЬреЛ рд░реВрдЯ рдХреЗ рддрд╣рдд рдХрд╛рдо рдирд╣реАрдВ рдХрд░ рд░рд╣реА рд╣реИ, рдХреЗрд╡рд▓ рдЕрдкрдирд╛ `euid` рдореМрдЬреВрджрд╛ `ruid`, `euid`, рдпрд╛ `suid` рдХреЗ рд╕рдорд╛рди рдмрдирд╛ рд╕рдХрддреА рд╣реИред

### set*uid рдлрд╝рдВрдХреНрд╢рдиреЛрдВ рдХреА рд╕рдордЭ

- **`setuid`**: рдкреНрд░рд╛рдердорд┐рдХ рдзрд╛рд░рдгрд╛рдУрдВ рдХреЗ рд╡рд┐рдкрд░реАрдд, `setuid` рдореБрдЦреНрдп рд░реВрдк рд╕реЗ `ruid` рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рддрд╛ рд╣реИ рдмрд▓реНрдХрд┐ `euid`ред рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реА рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЗ рд▓рд┐рдП, рдпрд╣ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд╕рд╛рде `ruid`, `euid`, рдФрд░ `suid` рдХреЛ рд╕рдорд╛рди рдХрд░рддрд╛ рд╣реИ, рдЕрдХреНрд╕рд░ рд░реВрдЯ, рдЗрди IDs рдХреЛ рдордЬрдмреВрдд рдмрдирд╛рдиреЗ рдХреЗ рдХрд╛рд░рдгред рд╡рд┐рд╕реНрддреГрдд рдЕрдиреБрд╢рд╛рд╕рди рдорд┐рд▓ рд╕рдХрддрд╛ рд╣реИ [setuid man page](https://man7.org/linux/man-pages/man2/setuid.2.html) рдореЗрдВред
- **`setreuid`** рдФрд░ **`setresuid`**: рдпреЗ рдлрд╝рдВрдХреНрд╢рди `ruid`, `euid`, рдФрд░ `suid` рдХреЛ рд╕реВрдХреНрд╖реНрдо рд░реВрдк рд╕реЗ рд╕рдорд╛рдпреЛрдЬрд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреЗ рд╣реИрдВред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЙрдирдХреА рдХреНрд╖рдорддрд╛рдПрдБ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╕реНрддрд░ рдкрд░ рдирд┐рд░реНрднрд░ рд╣реИрдВред рдЧреИрд░-рд░реВрдЯ рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЗ рд▓рд┐рдП, рд╕рдВрд╢реЛрдзрди рдореМрдЬреВрджрд╛ рдореВрд▓реНрдпреЛрдВ рдХреА рд╕реАрдорд┐рдд рд╣реЛрддреА рд╣реИ `ruid`, `euid`, рдФрд░ `suid` рдХреАред рд╡рд┐рдкрд░реАрдд, рд░реВрдЯ рдкреНрд░рдХреНрд░рд┐рдпрд╛рдПрдБ рдпрд╛ рдЙрдирдХреЗ рдкрд╛рд╕ `CAP_SETUID` рдХреНрд╖рдорддрд╛ рд╣реЛ рд╕рдХрддреА рд╣реИрдВ рдЗрди IDs рдХреЛ рдЗрд╕рдХреЗ рдорд╛рди рдХреЛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░ рд╕рдХрддреА рд╣реИрдВред рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдкреНрд░рд╛рдкреНрдд рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИ [setresuid man page](https://man7.org/linux/man-pages/man2/setresuid.2.html) рдФрд░ [setreuid man page](https://man7.org/linux/man-pages/man2/setreuid.2.html) рд╕реЗред

рдпреЗ рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛рдПрдБ рд╕реБрд░рдХреНрд╖рд╛ рдЙрдкрд╛рдп рдХреЗ рд░реВрдк рдореЗрдВ рдирд╣реАрдВ рдбрд┐рдЬрд╝рд╛рдЗрди рдХреА рдЧрдИ рд╣реИрдВ рдмрд▓реНрдХрд┐ рдЗрдЪреНрдЫрд┐рдд рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдлреНрд▓реЛ рдХреЛ рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП, рдЬреИрд╕реЗ рдЬрдм рдПрдХ рдХрд╛рд░реНрдпрдХреНрд░рдо рдЕрдкрдиреЗ рдкреНрд░рднрд╛рд╡реА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЖрдИрдбреА рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдХреЗ рдХрд┐рд╕реА рдЕрдиреНрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреА рдкрд╣рдЪрд╛рди рдЕрдкрдирд╛рддрд╛ рд╣реИред

рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ, рдЬрдм `setuid` рд░реВрдЯ рдХреЗ рд▓рд┐рдП рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдЙрдиреНрдирдпрди рдХреЗ рд▓рд┐рдП рдПрдХ рд╕рд╛рдорд╛рдиреНрдп рд╡рд┐рдХрд▓реНрдк рд╣реЛ рд╕рдХрддрд╛ рд╣реИ (рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рд╕рднреА IDs рдХреЛ рд░реВрдЯ рдХреЗ рд╕рд╛рде рд╕рдорд╛рди рдХрд░рддрд╛ рд╣реИ), рддреЛ рдЗрди рдлрд╝рдВрдХреНрд╢рдиреЛрдВ рдХреЗ рдмреАрдЪ рднрд┐рдиреНрдирддрд╛ рдХреЛ рд╕рдордЭрдиреЗ рдФрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЖрдИрдбреА рдХреЗ рд╡реНрдпрд╡рд╣рд╛рд░ рдХреЛ рд╡рд┐рднрд┐рдиреНрди рдкрд░рд┐рд╕реНрдерд┐рддрд┐рдпреЛрдВ рдореЗрдВ рдХреИрд╕реЗ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдП, рдпрд╣ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИред

### рд▓рд┐рдирдХреНрд╕ рдореЗрдВ рдХрд╛рд░реНрдпрдХреНрд░рдо рдирд┐рд╖реНрдкрд╛рджрди рддрдВрддреНрд░

#### **`execve` рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓**
- **рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛**: `execve` рдкрд╣рд▓реЗ рддрд░реНрдХ рджреНрд╡рд╛рд░рд╛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдПрдХ рдХрд╛рд░реНрдпрдХреНрд░рдо рдкреНрд░рд╛рд░рдВрдн рдХрд░рддрд╛ рд╣реИред рдпрд╣ рджреЛ рд╕рд░рдгрд┐рдпреЛрдВ, `argv` рдХреЗ рд▓рд┐рдП рддрд░реНрдХ рдФрд░ `envp` рдХреЗ рд▓рд┐рдП рдкрд░реНрдпрд╛рд╡рд░рдг, рд▓реЗрддрд╛ рд╣реИред
- **рд╡реНрдпрд╡рд╣рд╛рд░**: рдпрд╣ рдХреЙрд▓рд░ рдХреА рдореЗрдореЛрд░реА рд╕реНрдерд╛рди рдХреЛ рдмрдирд╛рдП рд░рдЦрддрд╛ рд╣реИ рд▓реЗрдХрд┐рди рд╕реНрдЯреИрдХ, рд╣реАрдк, рдФрд░ рдбреЗрдЯрд╛ рд╕реЗрдЧрдореЗрдВрдЯ рдХреЛ рддрд╛рдЬрдЧреА рджреЗрддрд╛ рд╣реИред рдХрд╛рд░реНрдпрдХреНрд░рдо рдХреЛрдб рдирдП рдХрд╛рд░реНрдпрдХреНрд░рдо рджреНрд╡рд╛рд░рд╛ рдмрджрд▓ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред
- **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЖрдИрдбреА рд╕рдВрд░рдХреНрд╖рдг**:
- `ruid`, `euid`, рдФрд░ рд╕рд╣рд╛рдпрдХ рд╕рдореВрд╣ рдЖрдИрдбреА рдЕрдкрд░рд┐рд╡рд░реНрддрд┐рдд рд░рд╣рддреЗ рд╣реИрдВред
- рдЕрдЧрд░ рдирдпрд╛ рдХрд╛рд░реНрдпрдХреНрд░рдо SetUID рдмрд┐рдЯ рд╕реЗрдЯ рд╣реИ рддреЛ `euid` рдореЗрдВ рд╕реВрдХреНрд╖реНрдо рдкрд░рд┐рд╡рд░реНрддрди рд╣реЛ рд╕рдХрддрд╛ рд╣реИред
- `suid` рдХреЛ `euid` рд╕реЗ рдЕрдкрдбреЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ `execve` рдХреЗ рдкрд╢реНрдЪрд╛рддред
- **рджрд╕реНрддрд╛рд╡реЗрдЬрд╝реАрдХрд░рдг**: рд╡рд┐рд╕реНрддреГрдд рдЬрд╛рдирдХрд╛рд░реА [`execve` man page](https://man7.org/linux/man-pages/man2/execve.2.html) рдкрд░ рдЙрдкрд▓рдмреНрдз рд╣реИред

#### **`system` рдлрд╝рдВрдХреНрд╢рди**
- **рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛**: `execve` рдХреА рд╡рд┐рдкрд░реАрдд, `system` `fork` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ рдмрдЪреНрдЪрд╛ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдмрдирд╛рддрд╛ рд╣реИ рдФрд░ рдЙрд╕ рдмрдЪреНрдЪрд╛ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ `execl` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ рдХрдорд╛рдВрдб рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рддрд╛ рд╣реИред
- **рдХрдорд╛рдВрдб рдирд┐рд╖реНрдкрд╛рджрди**: `execl("/bin/sh", "sh", "-c", command, (char *) NULL);` рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ `sh` рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдХрдорд╛рдВрдб рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рддрд╛ рд╣реИред
- **рд╡реНрдпрд╡рд╣рд╛рд░**: `execl` `execve` рдХрд╛ рдПрдХ рд░реВрдк рд╣реЛрдиреЗ рдХреЗ рдмрд╛рд╡рдЬреВрдж, рдпрд╣ рдПрдХ рдирдП рдмрдЪреНрдЪрд╛ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рд╕рдВрджрд░реНрдн рдореЗрдВ рд╕рдорд╛рди рд░реВрдк рд╕реЗ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИред
- **рджрд╕реНрддрд╛рд╡реЗрдЬрд╝реАрдХрд░рдг**: рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА [`system` man page](https://man7.org/linux/man-pages/man3/system.3.html) рд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИред

#### **`bash` рдФрд░ `sh` рдХрд╛ SUID рдХреЗ рд╕рд╛рде рд╡реНрдпрд╡рд╣рд╛рд░**
- **`bash`**:
- `-p` рд╡рд┐рдХрд▓реНрдк рд╣реИ рдЬреЛ `euid` рдФрд░ `ruid` рдХреЛ рдХреИрд╕реЗ рд╡реНрдпрд╡рд╣рд╛рд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЗрд╕ рдкрд░ рдкреНрд░рднрд╛рд╡ рдкрдбрд╝рддрд╛ рд╣реИред
- `-p` рдХреЗ рдмрд┐рдирд╛, рдЕрдЧрд░ рд╡реЗ рдкрд╣рд▓реЗ рд╕реЗ рднрд┐рдиреНрди рд╣реИрдВ, рддреЛ `bash` `euid` рдХреЛ `ruid` рд╕реЗрдЯ рдХрд░рддрд╛ рд╣реИред
- `-p` рдХреЗ рд╕рд╛рде, рдкреНрд░рд╛рд░рдВрднрд┐рдХ `euid` рд╕рдВрд░рдХреНрд╖рд┐рдд рд░рд╣рддрд╛ рд╣реИред
- рдЕрдзрд┐рдХ рд╡рд┐рд╡рд░рдг [`bash` man page](https://linux.die.net/man/1/bash) рдкрд░ рдЙрдкрд▓рдмреНрдз рд╣реИред
- **`sh`**:
- `bash` рдореЗрдВ `-p` рдХреЗ рд╕рдорд╛рди рдПрдХ рддрдВрддреНрд░ рдирд╣реАрдВ рд╣реИред
- рдЙрдкрдпреЛрдЧрдХрд░
```c
#define _GNU_SOURCE
#include <stdlib.h>
#include <unistd.h>

int main(void) {
setuid(1000);
system("id");
return 0;
}
```
**рд╕рдВрдХрд▓рди рдФрд░ рдЕрдиреБрдорддрд┐рдпрд╛рдБ:**
```bash
oxdf@hacky$ gcc a.c -o /mnt/nfsshare/a;
oxdf@hacky$ chmod 4755 /mnt/nfsshare/a
```

```bash
bash-4.2$ $ ./a
uid=99(nobody) gid=99(nobody) groups=99(nobody) context=system_u:system_r:unconfined_service_t:s0
```
**рд╡рд┐рд╢реНрд▓реЗрд╖рдг:**

* `ruid` рдФрд░ `euid` рдкрд╣рд▓реЗ 99 (рдХреЛрдИ рдирд╣реАрдВ) рдФрд░ 1000 (рдлреНрд░реИрдВрдХ) рдХреЗ рд░реВрдк рдореЗрдВ рд╢реБрд░реВ рд╣реЛрддреЗ рд╣реИрдВред
* `setuid` рджреЛрдиреЛрдВ рдХреЛ 1000 рдХреЗ рд▓рд┐рдП рд╕рдВрд░реЗрдЦрд┐рдд рдХрд░рддрд╛ рд╣реИред
* `system` `/bin/bash -c id` рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рддрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ sh рд╕реЗ bash рддрдХ рдХрд╛ рд╕рд┐рдорд▓рд┐рдВрдХ рд╣реИред
* `-p` рдХреЗ рдмрд┐рдирд╛ `bash` `euid` рдХреЛ `ruid` рдХреЗ рд╕рдорд╛рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдорд╛рдпреЛрдЬрд┐рдд рдХрд░рддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рджреЛрдиреЛрдВ 99 (рдХреЛрдИ рдирд╣реАрдВ) рд╣реЛрддреЗ рд╣реИрдВред

#### рдорд╛рдорд▓рд╛ 2: рд╕рд┐рд╕реНрдЯрдо рдХреЗ рд╕рд╛рде setreuid рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛

**рд╕реА рдХреЛрдб**:
```c
#define _GNU_SOURCE
#include <stdlib.h>
#include <unistd.h>

int main(void) {
setreuid(1000, 1000);
system("id");
return 0;
}
```
**рд╕рдВрдХрд▓рди рдФрд░ рдЕрдиреБрдорддрд┐рдпрд╛рдБ:**
```bash
oxdf@hacky$ gcc b.c -o /mnt/nfsshare/b; chmod 4755 /mnt/nfsshare/b
```
**рд╡реНрдпрд╛рд╡рд╣рд╛рд░рд┐рдХрд░рдг рдФрд░ рдкрд░рд┐рдгрд╛рдо:**
```bash
bash-4.2$ $ ./b
uid=1000(frank) gid=99(nobody) groups=99(nobody) context=system_u:system_r:unconfined_service_t:s0
```
**рд╡рд┐рд╢реНрд▓реЗрд╖рдг:**

* `setreuid` рджреЛрдиреЛрдВ ruid рдФрд░ euid рдХреЛ 1000 рдкрд░ рд╕реЗрдЯ рдХрд░рддрд╛ рд╣реИред
* `system` рдмреИрд╢ рдХреЛ рдЖрдордВрддреНрд░рд┐рдд рдХрд░рддрд╛ рд╣реИ, рдЬреЛ рдЙрдирдХреЗ рд╕рдорд╛рдирддрд╛ рдХреЗ рдХрд╛рд░рдг рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЖрдИрдбреА рдХреЛ рдмрдирд╛рдП рд░рдЦрддрд╛ рд╣реИ, рдЕрд╕рд▓ рдореЗрдВ frank рдХреЗ рд░реВрдк рдореЗрдВ рдХрд╛рд░реНрдп рдХрд░рддрд╛ рд╣реИред

#### рдорд╛рдорд▓рд╛ 3: execve рдХреЗ рд╕рд╛рде setuid рдХрд╛ рдЙрдкрдпреЛрдЧ
рд▓рдХреНрд╖реНрдп: setuid рдФрд░ execve рдХреЗ рдмреАрдЪ рдмрд╛рддрдЪреАрдд рдХрд╛ рдЕрдиреНрд╡реЗрд╖рдгред
```bash
#define _GNU_SOURCE
#include <stdlib.h>
#include <unistd.h>

int main(void) {
setuid(1000);
execve("/usr/bin/id", NULL, NULL);
return 0;
}
```
**рд╡реНрдпрд╛рд╡рд╣рд╛рд░рд┐рдХ рдФрд░ рдкрд░рд┐рдгрд╛рдо:**
```bash
bash-4.2$ $ ./c
uid=99(nobody) gid=99(nobody) euid=1000(frank) groups=99(nobody) context=system_u:system_r:unconfined_service_t:s0
```
**рд╡рд┐рд╢реНрд▓реЗрд╖рдг:**

* `ruid` 99 рд░рд╣рддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди euid 1000 рдкрд░ рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, setuid рдХреЗ рдкреНрд░рднрд╛рд╡ рдХреЗ рд╕рд╛рдеред

**рд╕реА рдХреЛрдб рдЙрджрд╛рд╣рд░рдг 2 (рдмреИрд╢ рдХреЛ рдХреЙрд▓ рдХрд░рдирд╛):**
```bash
#define _GNU_SOURCE
#include <stdlib.h>
#include <unistd.h>

int main(void) {
setuid(1000);
execve("/bin/bash", NULL, NULL);
return 0;
}
```
**рд╡реНрдпрд╛рд╡рд╣рд╛рд░рд┐рдХрд░рдг рдФрд░ рдкрд░рд┐рдгрд╛рдо:**
```bash
bash-4.2$ $ ./d
bash-4.2$ $ id
uid=99(nobody) gid=99(nobody) groups=99(nobody) context=system_u:system_r:unconfined_service_t:s0
```
**рд╡рд┐рд╢реНрд▓реЗрд╖рдг:**

* рдпрджреНрдпрдкрд┐ `setuid` рджреНрд╡рд╛рд░рд╛ `euid` рдХреЛ 1000 рдкрд░ рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди `-p` рдХреА рдЕрдиреБрдкрд╕реНрдерд┐рддрд┐ рдХреЗ рдХрд╛рд░рдг `bash` `ruid` (99) рдкрд░ euid рдХреЛ рд░реАрд╕реЗрдЯ рдХрд░ рджреЗрддрд╛ рд╣реИред

**рд╕реА рд╕рдВрдХреЗрдд рдЙрджрд╛рд╣рд░рдг 3 (bash -p рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ):**
```bash
#define _GNU_SOURCE
#include <stdlib.h>
#include <unistd.h>

int main(void) {
char *const paramList[10] = {"/bin/bash", "-p", NULL};
setuid(1000);
execve(paramList[0], paramList, NULL);
return 0;
}
```
**рд╡реНрдпрд╛рд╡рд╣рд╛рд░рд┐рдХрд░рдг рдФрд░ рдкрд░рд┐рдгрд╛рдо:**
```bash
bash-4.2$ $ ./e
bash-4.2$ $ id
uid=99(nobody) gid=99(nobody) euid=100
```
## рд╕рдВрджрд░реНрдн
* [https://0xdf.gitlab.io/2022/05/31/setuid-rabbithole.html#testing-on-jail](https://0xdf.gitlab.io/2022/05/31/setuid-rabbithole.html#testing-on-jail)


<details>

<summary><strong>рдЬреАрд░реЛ рд╕реЗ рд╣реАрд░реЛ рддрдХ AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* рдХреНрдпрд╛ рдЖрдк **рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХрдВрдкрдиреА** рдореЗрдВ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ? рдХреНрдпрд╛ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХреЛ рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд** рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ? рдпрд╛ рдХреНрдпрд╛ рдЖрдкрдХреЛ **PEASS рдХреЗ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдпрд╛ рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдХреЛ рдкреАрдбреАрдПрдл рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб** рдХрд░рдиреЗ рдХрд╛ рдПрдХреНрд╕реЗрд╕ рдЪрд╛рд╣рд┐рдП? [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ!
* [**рджреА рдкреАрдПрд╕ рдлреИрдорд┐рд▓реА**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**рдПрдирдПрдлрдЯреА**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣ред
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВред
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** [**ЁЯТм**](https://emojipedia.org/speech-balloon/) [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рдореБрдЭреЗ **рдЯреНрд╡рд┐рдЯрд░** рдкрд░ рдлреЙрд▓реЛ рдХрд░реЗрдВ ЁЯРж[**@carlospolopm**](https://twitter.com/hacktricks_live)**ред**
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, [рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рд░реЗрдкреЛ](https://github.com/carlospolop/hacktricks) рдФрд░ [рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕-рдХреНрд▓рд╛рдЙрдб рд░реЗрдкреЛ](https://github.com/carlospolop/hacktricks-cloud) рдореЗрдВ рдкреАрдЖрд░ рдЬрдорд╛ рдХрд░рдХреЗ**ред

</details>
