# euid, ruid, suid

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>тШБя╕П HackTricks Cloud тШБя╕П</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ЁЯРж Twitter ЁЯРж</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ЁЯОЩя╕П Twitch ЁЯОЩя╕П</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ЁЯОе Youtube ЁЯОе</strong></a></summary>

* рдХреНрдпрд╛ рдЖрдк рдХрд┐рд╕реА **рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХрдВрдкрдиреА** рдореЗрдВ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ? рдХреНрдпрд╛ рдЖрдк рдЕрдкрдиреА рдХрдВрдкрдиреА рдХреЛ **HackTricks рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд** рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ? рдпрд╛ рдХреНрдпрд╛ рдЖрдкрдХреЛ **PEASS рдХреА рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рдХрд╛ рдЙрдкрдпреЛрдЧ** рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ? [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ!
* рдЦреЛрдЬреЗрдВ [**The PEASS Family**](https://opensea.io/collection/the-peass-family), рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ рд╕рдВрдЧреНрд░рд╣ [**NFTs**](https://opensea.io/collection/the-peass-family)
* рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks swag**](https://peass.creator-spring.com)
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** [**ЁЯТм**](https://emojipedia.org/speech-balloon/) [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ рдпрд╛ рдореБрдЭреЗ **Twitter** [**ЁЯРж**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)** рдХрд╛** **рдЕрдиреБрд╕рд░рдг** рдХрд░реЗрдВред**
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рдХреЛ [hacktricks рд░реЗрдкреЛ](https://github.com/carlospolop/hacktricks) рдФрд░ [hacktricks-cloud рд░реЗрдкреЛ](https://github.com/carlospolop/hacktricks-cloud) рдореЗрдВ рдкреАрдЖрд░ рдЬрдорд╛ рдХрд░рдХреЗ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВред**

</details>

**рдпрд╣ рдкреЛрд╕реНрдЯ** [**https://0xdf.gitlab.io/2022/05/31/setuid-rabbithole.html#testing-on-jail**](https://0xdf.gitlab.io/2022/05/31/setuid-rabbithole.html#testing-on-jail) **рд╕реЗ рдХреЙрдкреА рдХреА рдЧрдИ рд╣реИ**

## **`*uid`**

* **`ruid`**: рдпрд╣ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХрд╛ **рд╡рд╛рд╕реНрддрд╡рд┐рдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЖрдИрдбреА** рд╣реИ рдЬреЛ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рд╢реБрд░реВ рдХрд░рддрд╛ рд╣реИред
* **`euid`**: рдпрд╣ **рдкреНрд░рднрд╛рд╡реА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЖрдИрдбреА** рд╣реИ, рдЬрд┐рд╕реЗ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ **рдкреНрд░рд┐рд╡рд┐рд▓реЗрдЬ рдХрд╛ рдирд┐рд░реНрдзрд╛рд░рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рд┐рд╕реНрдЯрдо рджреЗрдЦрддрд╛ рд╣реИ**ред рдЕрдзрд┐рдХрд╛рдВрд╢ рдорд╛рдорд▓реЛрдВ рдореЗрдВ, `euid` `ruid` рдХреЗ рд╕рдорд╛рди рд╣реЛрдЧрд╛, рд▓реЗрдХрд┐рди SetUID рдмрд╛рдЗрдирд░реА рдЗрд╕рдХрд╛ рдЙрджрд╛рд╣рд░рдг рд╣реИ рдЬрд╣рд╛рдВ рд╡реЗ рдЕрд▓рдЧ рд╣реЛрддреЗ рд╣реИрдВред рдЬрдм рдПрдХ **SetUID** рдмрд╛рдЗрдирд░реА рд╢реБрд░реВ рд╣реЛрддрд╛ рд╣реИ, рддреЛ **`euid` рдлрд╝рд╛рдЗрд▓ рдХреЗ рдорд╛рд▓рд┐рдХ рдХреЗ рд▓рд┐рдП рд╕реЗрдЯ рд╣реЛрддрд╛ рд╣реИ**, рдЬрд┐рд╕рд╕реЗ рдЗрди рдмрд╛рдЗрдирд░реА рдХреЛ рдХрд╛рд░реНрдп рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдорд┐рд▓рддреА рд╣реИред
* `suid`: рдпрд╣ **рд╕рд╣реЗрдЬреА рдЧрдИ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЖрдИрдбреА** рд╣реИ, рдЬрдм рдПрдХ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реА рдкреНрд░рдХреНрд░рд┐рдпрд╛ (рдЕрдзрд┐рдХрд╛рдВрд╢ рдорд╛рдорд▓реЛрдВ рдореЗрдВ рд░реВрдЯ рдХреЗ рд░реВрдк рдореЗрдВ рдЪрд▓ рд░рд╣реА рд╣реЛрддреА рд╣реИ) рдХреЛ **рдкреНрд░рд┐рд╡рд┐рд▓реЗрдЬ рдХреЛ рдХрдо рдХрд░рдиреЗ** рдХреЗ рд▓рд┐рдП рдЪрд╛рд╣рд┐рдП, рд▓реЗрдХрд┐рди рдлрд┐рд░ **рдкреНрд░рд┐рд╡рд┐рд▓реЗрдЬ рд╕реНрдерд┐рддрд┐ рдореЗрдВ рд╡рд╛рдкрд╕ рдЖрдиреЗ** рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред

{% hint style="info" %}
рдЕрдЧрд░ рдПрдХ **рдЧреИрд░-рд░реВрдЯ рдкреНрд░рдХреНрд░рд┐рдпрд╛** рдЕрдкрдирд╛ **`euid` рдмрджрд▓рдирд╛ рдЪрд╛рд╣рддреА рд╣реИ**, рддреЛ рд╡рд╣ рдХреЗрд╡рд▓ рдЗрд╕реЗ **рд╡рд░реНрддрдорд╛рди рдорд╛рдиреЛрдВ** рдХреЗ рд░реВрдк рдореЗрдВ **`ruid`**, **`euid`**, рдпрд╛ **`suid`** рдореЗрдВ **рд╕реЗрдЯ** рдХрд░ рд╕рдХрддреА рд╣реИред
{% endhint %}

## set\*uid

рдкрд╣рд▓реА рдирдЬрд░ рдореЗрдВ, рдпрд╣ рдЖрд╕рд╛рди рд╣реИ рдХрд┐ рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓ **`setuid`** `ruid` рдХреЛ рд╕реЗрдЯ рдХрд░реЗрдЧрд╛ред рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рдПрдХ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рд▓рд┐рдП, рдпрд╣ рдХрд░рддрд╛ рд╣реИред рд▓реЗрдХрд┐рди рд╕рд╛рдорд╛рдиреНрдп рдорд╛рдорд▓реЗ рдореЗрдВ, рдпрд╣ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ **`euid` рдХреЛ рд╕реЗрдЯ рдХрд░рддрд╛ рд╣реИ**ред [рдореИрди рдкреЗрдЬ](https://man7.org/linux/man-pages/man2/setuid.2.html) рд╕реЗ:

> setuid() **рдХреЙрд▓ рдХрд░рдиреЗ рд╡рд╛рд▓реА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреА рдкреНрд░рднрд╛рд╡реА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЖрдИрдбреА рд╕реЗрдЯ рдХрд░рддрд╛ рд╣реИ**ред рдпрджрд┐ рдХреЙрд▓ рдХрд░рдиреЗ рд╡рд╛рд▓реА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реА рд╣реИ (рдЕрдзрд┐рдХ рдирд┐рд╢реНрдЪрд┐рдд рд░реВрдк рд╕реЗ: рдпрджрд┐ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ CAP\_SETUID рдХреНрд╖рдорддрд╛ рд╣реИ рдЙрд╕рдХреЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдиреЗрдорд╕реНрдкреЗрд╕ рдореЗрдВ), рддреЛ рд╡рд╛рд╕реНрддрд╡рд┐рдХ UID рдФрд░ рд╕рд╣реЗрдЬреА рдЧрдИ рд╕реЗрдЯ-рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛-рдЖрдИрдбреА рднреА рд╕реЗрдЯ рд╣реЛ рдЬрд╛рддреА рд╣реИрдВред

рдЗрд╕рд▓рд┐рдП, рдЬрдм рдЖрдк `setuid(0)` рдХреЗ рд░реВрдк рдореЗрдВ рд░реВрдЯ рдХреЗ рд░реВрдк рдореЗрдВ рдЪрд▓ рд░рд╣реЗ рд╣реЛрддреЗ рд╣реИрдВ, рддреЛ рдпрд╣ рд╕рднреА рдЖрдИрдбреА рдХреЛ рд░реВрдЯ рдореЗрдВ рд╕реЗрдЯ рдХрд░рддрд╛ рд╣реИ, рдФрд░
### **рд╕рд┐рд╕реНрдЯрдо**

`рд╕рд┐рд╕реНрдЯрдо` рдПрдХ [рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдЕрд▓рдЧ рддрд░реАрдХреЗ](https://man7.org/linux/man-pages/man3/system.3.html) рд╕реЗ рдПрдХ рдирдпрд╛ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд╢реБрд░реВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣реИред рдЬрд╣рд╛рдВ `execve` рдПрдХ рд╣реА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рд╕реНрддрд░ рдкрд░ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ, **`рд╕рд┐рд╕реНрдЯрдо` `fork` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ рдмрдЪреНрдЪрд╛ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдмрдирд╛рддрд╛ рд╣реИ** рдФрд░ рдлрд┐рд░ рдЙрд╕ рдмрдЪреНрдЪрд╛ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ `execl` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рддрд╛ рд╣реИ:

> ```
> execl("/bin/sh", "sh", "-c", command, (char *) NULL);
> ```

`execl` рдХреЗрд╡рд▓ `execve` рдХреЗ рдЪрд╛рд░реЛрдВ рдУрд░ рдПрдХ рд▓рдкреЗрдЯ рд╣реИ рдЬреЛ рд╕реНрдЯреНрд░рд┐рдВрдЧ рддрд░реНрдХреЛрдВ рдХреЛ `argv` рдПрд░реЗ рдореЗрдВ рд░реВрдкрд╛рдВрддрд░рд┐рдд рдХрд░рддрд╛ рд╣реИ рдФрд░ `execve` рдХреЛ рдмреБрд▓рд╛рддрд╛ рд╣реИред рдпрд╣ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ рдХрд┐ **`рд╕рд┐рд╕реНрдЯрдо` рдХрдорд╛рдВрдб рдХреЛ рдмреБрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП `рд╢` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ**ред

### sh рдФрд░ bash SUID <a href="#sh-and-bash-suid" id="sh-and-bash-suid"></a>

**`рдмреИрд╢`** рдореЗрдВ рдПрдХ **`-p рд╡рд┐рдХрд▓реНрдк`** рд╣реЛрддрд╛ рд╣реИ, рдЬрд┐рд╕реЗ [рдореИрди рдкреЗрдЬ](https://linux.die.net/man/1/bash) рдЗрд╕ рддрд░рд╣ рд╕реЗ рд╡рд░реНрдгрд┐рдд рдХрд░рддрд╛ рд╣реИ:

> _рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░рд┐рдд_ рдореЛрдб рдХреЛ рд╕рдХреНрд╖рдо рдХрд░реЗрдВред рдЗрд╕ рдореЛрдб рдореЗрдВ, **$ENV** рдФрд░ **$BASH\_ENV** рдлрд╝рд╛рдЗрд▓реЗрдВ рдкреНрд░реЛрд╕реЗрд╕ рдХреА рд╕реНрдерд┐рддрд┐ рдореЗрдВ рдирд╣реАрдВ рд╣реЛрддреА рд╣реИрдВ, рд╢реЗрд▓ рдлрд╝рдВрдХреНрд╢рди рд╡рд╛рддрд╛рдиреБрдХреВрд▓рди рд╕реЗ рдкреНрд░рд╛рдкреНрдд рдирд╣реАрдВ рд╣реЛрддреА рд╣реИрдВ, рдФрд░ рдпрджрд┐ рд╡реЗ рдкрд░реНрдпрд╛рдкреНрддрддрд╛ рдореЗрдВ рд╣реЛрдВ, рддреЛ **SHELLOPTS**, **BASHOPTS**, **CDPATH**, рдФрд░ **GLOBIGNORE** рдЪрд░рд┐рддреНрд░рд┐рдд рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдЪрд░рд┐рддреНрд░реЛрдВ рдХреЛ рдЕрдирджреЗрдЦрд╛ рдХрд░ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдпрджрд┐ рд╢реЗрд▓ рд╡рд╛рд╕реНрддрд╡рд┐рдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ (рд╕рдореВрд╣) рдЖрдИрдбреА рдХреЗ рд╕рдорд╛рди рдирд╣реАрдВ рд╣реЛрддреА рд╣реИ рдФрд░ **-p рд╡рд┐рдХрд▓реНрдк рдирд╣реАрдВ рджрд┐рдпрд╛ рдЧрдпрд╛ рд╣реЛ**, рддреЛ рдпреЗ рдХрд╛рд░реНрд░рд╡рд╛рдИ рд▓реА рдЬрд╛рддреА рд╣реИ рдФрд░ **рдкреНрд░рднрд╛рд╡реА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЖрдИрдбреА рдХреЛ рд╡рд╛рд╕реНрддрд╡рд┐рдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЖрдИрдбреА рдкрд░ рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ**ред рдпрджрд┐ **-p** рд╡рд┐рдХрд▓реНрдк **рдкреНрд░рд╛рд░рдВрдн рдореЗрдВ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ**, рддреЛ **рдкреНрд░рднрд╛рд╡реА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЖрдИрдбреА рд░реАрд╕реЗрдЯ рдирд╣реАрдВ рд╣реЛрддреА рд╣реИ**ред рдЗрд╕ рд╡рд┐рдХрд▓реНрдк рдХреЛ рдмрдВрдж рдХрд░рдиреЗ рд╕реЗ рдкреНрд░рднрд╛рд╡реА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдФрд░ рд╕рдореВрд╣ рдЖрдИрдбреА рд╡рд╛рд╕реНрддрд╡рд┐рдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдФрд░ рд╕рдореВрд╣ рдЖрдИрдбреА рдкрд░ рд╕реЗрдЯ рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВред

рд╕рдВрдХреНрд╖реЗрдк рдореЗрдВ, `-p` рдХреЗ рдмрд┐рдирд╛, рдЬрдм рдмреИрд╢ рдЪрд▓рд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ `euid` рдХреЛ `ruid` рдкрд░ рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред **`-p` рдЗрд╕реЗ рд░реЛрдХрддрд╛ рд╣реИ**ред

**`рд╢`** рд╢реЗрд▓ **рдЗрд╕ рддрд░рд╣ рдХреА рдХреЛрдИ рд╕реБрд╡рд┐рдзрд╛ рдирд╣реАрдВ рд╣реИ**ред [рдореИрди рдкреЗрдЬ](https://man7.org/linux/man-pages/man1/sh.1p.html) рдореЗрдВ "рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЖрдИрдбреА" рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЙрд▓реНрд▓реЗрдЦ рдирд╣реАрдВ рд╣реИ, рдХреЗрд╡рд▓ `-i` рд╡рд┐рдХрд▓реНрдк рдХреЗ рд╕рд╛рде, рдЬреЛ рдХрд╣рддрд╛ рд╣реИ:

> \-i рдпрд╣ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░реЗрдВ рдХрд┐ рд╢реЗрд▓ рдЗрдВрдЯрд░реИрдХреНрдЯрд┐рд╡ рд╣реИ; рдиреАрдЪреЗ рджреЗрдЦреЗрдВред рдпрджрд┐ рд╡рд╛рд╕реНрддрд╡рд┐рдХ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреА рд╡рд╛рд╕реНрддрд╡рд┐рдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЖрдИрдбреА рд╡рд╛рд╕реНрддрд╡рд┐рдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЖрдИрдбреА рдХреЗ рдмрд░рд╛рдмрд░ рдирд╣реАрдВ рд╣реЛрддреА рд╣реИ рдпрд╛ рдпрджрд┐ рд╡рд╛рд╕реНрддрд╡рд┐рдХ рд╕рдореВрд╣ рдЖрдИрдбреА рд╡рд╛рд╕реНрддрд╡рд┐рдХ рд╕рдореВрд╣ рдЖрдИрдбреА рдХреЗ рдмрд░рд╛рдмрд░ рдирд╣реАрдВ рд╣реЛрддреА рд╣реИ, рддреЛ рдХреЙрд▓ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рд▓рд┐рдП -i рд╡рд┐рдХрд▓реНрдк рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдиреЗ рдХреЛ рдПрдХ рддреНрд░реБрдЯрд┐ рдорд╛рди рд╕рдХрддрд╛ рд╣реИред

## рдкрд░реАрдХреНрд╖рдг

### setuid / system <a href="#setuid--system" id="setuid--system"></a>

рдЗрд╕ рдкреГрд╖реНрдарднреВрдорд┐ рдХреЗ рд╕рд╛рде, рдореИрдВ рдЗрд╕ рдХреЛрдб рдХреЛ рд▓реЗ рдФрд░ рдЬреЗрд▓ (HTB) рдкрд░ рдХреНрдпрд╛ рд╣реЛрддрд╛ рд╣реИ, рдЙрд╕реЗ рд╡рд┐рд╡рд░рдг рдореЗрдВ рджреЗрдЦреВрдВрдЧрд╛:
```c
#define _GNU_SOURCE
#include <stdlib.h>
#include <unistd.h>

int main(void) {
setuid(1000);
system("id");
return 0;
}
```
рдпрд╣ рдкреНрд░реЛрдЧреНрд░рд╛рдо NFS рдкрд░ рдЬреЗрд▓ рдореЗрдВ рдХрдВрдкрд╛рдЗрд▓ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рдФрд░ SetUID рдХреЗ рд░реВрдк рдореЗрдВ рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ:
```bash
oxdf@hacky$ gcc a.c -o /mnt/nfsshare/a;
...[snip]...
oxdf@hacky$ chmod 4755 /mnt/nfsshare/a
```
рдЬрдм рд░реВрдЯ рдХреЗ рд░реВрдк рдореЗрдВ, рдореИрдВ рдЗрд╕ рдлрд╝рд╛рдЗрд▓ рдХреЛ рджреЗрдЦ рд╕рдХрддрд╛ рд╣реВрдБ:
```
[root@localhost nfsshare]# ls -l a
-rwsr-xr-x. 1 frank frank 16736 May 30 04:58 a
```
рдЬрдм рдореИрдВ рдЗрд╕реЗ nobody рдХреЗ рд░реВрдк рдореЗрдВ рдЪрд▓рд╛рддрд╛ рд╣реВрдБ, `id` nobody рдХреЗ рд░реВрдк рдореЗрдВ рдЪрд▓рддрд╛ рд╣реИ:
```bash
bash-4.2$ $ ./a
uid=99(nobody) gid=99(nobody) groups=99(nobody) context=system_u:system_r:unconfined_service_t:s0
```
рдпрд╣ рдкреНрд░реЛрдЧреНрд░рд╛рдо `ruid` рдХреЗ рд╕рд╛рде рд╢реБрд░реВ рд╣реЛрддрд╛ рд╣реИ рдЬрд┐рд╕рдХрд╛ рдорд╛рди 99 (рдХреЛрдИ рдирд╣реАрдВ) рд╣реИ рдФрд░ `euid` рдХреЗ рд╕рд╛рде рдЬрд┐рд╕рдХрд╛ рдорд╛рди 1000 (рдлреНрд░реИрдВрдХ) рд╣реИред рдЬрдм рдпрд╣ `setuid` рдХреЙрд▓ рддрдХ рдкрд╣реБрдВрдЪрддрд╛ рд╣реИ, рддреЛ рдЙрдиреА рд╣реА рдорд╛рдиреЛрдВ рдХреЛ рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

рдлрд┐рд░ `system` рдХреЙрд▓ рд╣реЛрддрд╛ рд╣реИ, рдФрд░ рдореИрдВ 99 рдХреЗ `uid` рдХреЛ рджреЗрдЦрдиреЗ рдХреА рдЙрдореНрдореАрдж рдХрд░реВрдВрдЧрд╛, рд▓реЗрдХрд┐рди рдПрдХ `euid` рдХреЗ рд╕рд╛рде рднреА 1000 рдХреЛ рджреЗрдЦрдиреЗ рдХреА рдЙрдореНрдореАрдж рд╣реЛрдЧреАред рдлрд┐рд░ рдПрдХ рдирд╣реАрдВ рд╣реЛрддрд╛ рд╣реИ? рд╕рдорд╕реНрдпрд╛ рдпрд╣ рд╣реИ рдХрд┐ рдЗрд╕ рд╡рд┐рддрд░рдг рдореЗрдВ **`sh` рдХреЛ `bash` рд╕реЗ рд╕рдВрдХреЗрддрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ**:
```
$ ls -l /bin/sh
lrwxrwxrwx. 1 root root 4 Jun 25  2017 /bin/sh -> bash
```
рдЗрд╕рд▓рд┐рдП `system` `/bin/sh sh -c id` рдХреЛ рдХреЙрд▓ рдХрд░рддрд╛ рд╣реИ, рдЬреЛ рдХрд┐ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ `/bin/bash bash -c id` рд╣реИред рдЬрдм `bash` рдХреЛ рдмрд┐рдирд╛ `-p` рдХреЗ рдХреЙрд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдпрд╣ 99 рдХрд╛ `ruid` рдФрд░ 1000 рдХрд╛ `euid` рджреЗрдЦрддрд╛ рд╣реИ, рдФрд░ `euid` рдХреЛ 99 рдкрд░ рд╕реЗрдЯ рдХрд░ рджреЗрддрд╛ рд╣реИред

### setreuid / system <a href="#setreuid--system" id="setreuid--system"></a>

рдЗрд╕ рд╕рд┐рджреНрдзрд╛рдВрдд рдХреЛ рдкрд░реАрдХреНрд╖рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдореИрдВ `setuid` рдХреЛ `setreuid` рд╕реЗ рдмрджрд▓рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реВрдВрдЧрд╛:
```c
#define _GNU_SOURCE
#include <stdlib.h>
#include <unistd.h>

int main(void) {
setreuid(1000, 1000);
system("id");
return 0;
}
```
рдХрдВрдкрд╛рдЗрд▓ рдФрд░ рдЕрдиреБрдорддрд┐рдпрд╛рдБ:
```
oxdf@hacky$ gcc b.c -o /mnt/nfsshare/b; chmod 4755 /mnt/nfsshare/b
```
рдЕрдм рдЬреЗрд▓ рдореЗрдВ, рдЕрдм `id` 1000 рдХрд╛ uid рд▓реМрдЯрд╛рддрд╛ рд╣реИ:
```
bash-4.2$ $ ./b
uid=1000(frank) gid=99(nobody) groups=99(nobody) context=system_u:system_r:unconfined_service_t:s0
```
`setreuid` рдХреЙрд▓ `ruid` рдФрд░ `euid` рджреЛрдиреЛрдВ рдХреЛ 1000 рдкрд░ рд╕реЗрдЯ рдХрд░рддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЬрдм `system` рдиреЗ `bash` рдХреЛ рдХреЙрд▓ рдХрд┐рдпрд╛, рд╡реЗ рдорд┐рд▓ рдЧрдП рдФрд░ рдЪреАрдЬреЗрдВ рдлреНрд░реИрдВрдХ рдХреЗ рд░реВрдк рдореЗрдВ рдЬрд╛рд░реА рд░рд╣реАрдВред

### setuid / execve <a href="#setuid--execve" id="setuid--execve"></a>

рдпрджрд┐ рдореЗрд░рд╛ рдЙрдкрд░реЛрдХреНрдд рд╕рдордЭ рд╕рд╣реА рд╣реИ, рддреЛ рдореБрдЭреЗ uids рдХреЛ рдЧрд▓рдд рдХрд░рдиреЗ рдХреА рдЪрд┐рдВрддрд╛ рдирд╣реАрдВ рдХрд░рдиреА рдЪрд╛рд╣рд┐рдП, рдмрд▓реНрдХрд┐ `execve` рдХреЛ рдХреЙрд▓ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП, рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рдореМрдЬреВрджрд╛ IDs рдХреЛ рд▓реЗ рдЬрд╛рдПрдЧрд╛ред рдпрд╣ рдХрд╛рдо рдХрд░реЗрдЧрд╛, рд▓реЗрдХрд┐рди рдпрд╣рд╛рдВ рдЫрд╛рдк рд╣реИрдВред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рд╕рд╛рдорд╛рдиреНрдп рдХреЛрдб рдЗрд╕ рддрд░рд╣ рджрд┐рдЦ рд╕рдХрддрд╛ рд╣реИ:
```c
#define _GNU_SOURCE
#include <stdlib.h>
#include <unistd.h>

int main(void) {
setuid(1000);
execve("/usr/bin/id", NULL, NULL);
return 0;
}
```
рдпрджрд┐ рдореИрдВ рдкрд░реНрдпрд╛рд╡рд░рдг рдХреЛ рдЫреЛрдбрд╝ рджреВрдБ (рд╕рд░рд▓рддрд╛ рдХреЗ рд▓рд┐рдП рдореИрдВ NULL рдкрд╛рд╕ рдХрд░ рд░рд╣рд╛ рд╣реВрдБ), рддреЛ рдореБрдЭреЗ `id` рдкрд░ рдкреВрд░рд╛ рдкрде рдЪрд╛рд╣рд┐рдП рд╣реЛрдЧрд╛ред рдпрд╣ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ, рдФрд░ рдореБрдЭреЗ рд╡рд╣реА рдорд┐рд▓рддрд╛ рд╣реИ рдЬреЛ рдореИрдВ рдЙрдореНрдореАрдж рдХрд░ рд░рд╣рд╛ рд╣реВрдБ:
```
bash-4.2$ $ ./c
uid=99(nobody) gid=99(nobody) euid=1000(frank) groups=99(nobody) context=system_u:system_r:unconfined_service_t:s0
```
`[r]uid` 99 рд╣реИ, рд▓реЗрдХрд┐рди `euid` 1000 рд╣реИред

рдЗрд╕рд╕реЗ рд╢реЗрд▓ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рдиреЗ рдкрд░, рдореБрдЭреЗ рд╕рддрд░реНрдХ рд░рд╣рдирд╛ рд╣реЛрдЧрд╛ред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдмрд╕ `bash` рдХреЛ рдХреЙрд▓ рдХрд░рдирд╛:
```c
#define _GNU_SOURCE
#include <stdlib.h>
#include <unistd.h>

int main(void) {
setuid(1000);
execve("/bin/bash", NULL, NULL);
return 0;
}
```
рдореИрдВ рдЙрд╕реЗ рдХрдВрдкрд╛рдЗрд▓ рдХрд░реВрдВрдЧрд╛ рдФрд░ рдЗрд╕реЗ SetUID рдХреЗ рд░реВрдк рдореЗрдВ рд╕реЗрдЯ рдХрд░ рджреВрдВрдЧрд╛:
```
oxdf@hacky$ gcc d.c -o /mnt/nfsshare/d
oxdf@hacky$ chmod 4755 /mnt/nfsshare/d
```
рдлрд┐рд░ рднреА, рдпрд╣ рд╕рднреА рдХреЛ рд╡рд╛рдкрд╕ рдиреЛрдмреЙрдбреА рдХреЗ рд░реВрдк рдореЗрдВ рд▓реМрдЯрд╛рдПрдЧрд╛:
```
bash-4.2$ $ ./d
bash-4.2$ $ id
uid=99(nobody) gid=99(nobody) groups=99(nobody) context=system_u:system_r:unconfined_service_t:s0
```
рдпрджрд┐ рдпрд╣ `setuid(0)` рд╣реЛрддрд╛, рддреЛ рдпрд╣ рдареАрдХ рдХрд╛рдо рдХрд░рддрд╛ (рдорд╛рди рд▓реЗрдВ рдХрд┐ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдЙрд╕реЗ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд╣реЛрддреА рд╣реИ), рдХреНрдпреЛрдВрдХрд┐ рдлрд┐рд░ рдпрд╣ рддреАрдиреЛрдВ рдЖрдИрдбреА рдХреЛ 0 рдкрд░ рдмрджрд▓ рджреЗрддрд╛ рд╣реИред рд▓реЗрдХрд┐рди рдПрдХ рдЧреИрд░-рд░реВрдЯ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд░реВрдк рдореЗрдВ, рдпрд╣ рдХреЗрд╡рд▓ `euid` рдХреЛ 1000 (рдЬреЛ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдерд╛) рд╕реЗрдЯ рдХрд░рддрд╛ рд╣реИ, рдФрд░ рдлрд┐рд░ `sh` рдХреЛ рдХреЙрд▓ рдХрд░рддрд╛ рд╣реИред рд▓реЗрдХрд┐рди рдЬреЗрд▓ рдкрд░ `bash` `sh` рд╣реЛрддрд╛ рд╣реИред рдФрд░ рдЬрдм `bash` `ruid` 99 рдФрд░ `euid` 1000 рдХреЗ рд╕рд╛рде рд╢реБрд░реВ рд╣реЛрддрд╛ рд╣реИ, рддреЛ рдпрд╣ `euid` рдХреЛ рдлрд┐рд░ рд╕реЗ 99 рдкрд░ рдЫреЛрдбрд╝ рджреЗрдЧрд╛ред

рдЗрд╕реЗ рдареАрдХ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдореИрдВ `bash -p` рдХреЙрд▓ рдХрд░реВрдВрдЧрд╛:
```c
#define _GNU_SOURCE
#include <stdlib.h>
#include <unistd.h>

int main(void) {
char *const paramList[10] = {"/bin/bash", "-p", NULL};
setuid(1000);
execve(paramList[0], paramList, NULL);
return 0;
}
```
рдЗрд╕ рдмрд╛рд░ `euid` рдореМрдЬреВрдж рд╣реИ:
```
bash-4.2$ $ ./e
bash-4.2$ $ id
uid=99(nobody) gid=99(nobody) euid=1000(frank) groups=99(nobody) context=system_u:system_r:unconfined_service_t:s0
```
рдпрд╛ рдореИрдВ `setuid` рдХреЗ рдмрдЬрд╛рдп `setreuid` рдпрд╛ `setresuid` рдХреЛ рдХреЙрд▓ рдХрд░ рд╕рдХрддрд╛ рд╣реВрдБред

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>тШБя╕П HackTricks Cloud тШБя╕П</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ЁЯРж Twitter ЁЯРж</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ЁЯОЩя╕П Twitch ЁЯОЩя╕П</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ЁЯОе Youtube ЁЯОе</strong></a></summary>

* рдХреНрдпрд╛ рдЖрдк рдХрд┐рд╕реА **рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХрдВрдкрдиреА** рдореЗрдВ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ? рдХреНрдпрд╛ рдЖрдк рдЕрдкрдиреА рдХрдВрдкрдиреА рдХреЛ **HackTricks рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд** рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ? рдпрд╛ рдХреНрдпрд╛ рдЖрдкрдХреЛ **PEASS рдХреА рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рдХрд╛ рдЙрдкрдпреЛрдЧ** рдХрд░рдиреЗ рдХреА рдЗрдЪреНрдЫрд╛ рд╣реИ? [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ!
* рдЦреЛрдЬреЗрдВ [**The PEASS Family**](https://opensea.io/collection/the-peass-family), рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFT**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣ред
* рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks swag**](https://peass.creator-spring.com)
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** [**ЁЯТм**](https://emojipedia.org/speech-balloon/) [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рдореБрдЭреЗ **рдЯреНрд╡рд┐рдЯрд░** рдкрд░ **рдлрд╝реЙрд▓реЛ** рдХрд░реЗрдВ [**ЁЯРж**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, [hacktricks рд░реЗрдкреЛ](https://github.com/carlospolop/hacktricks) рдФрд░ [hacktricks-cloud рд░реЗрдкреЛ](https://github.com/carlospolop/hacktricks-cloud) рдореЗрдВ рдкреАрдЖрд░ рдЬрдорд╛ рдХрд░рдХреЗред**

</details>
