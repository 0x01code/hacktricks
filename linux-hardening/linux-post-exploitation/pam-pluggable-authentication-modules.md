<details>

<summary><strong>Apprenez le hacking AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**merchandising officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de hacking en soumettant des PR aux d√©p√¥ts github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>


PAM est une collection de modules qui forment essentiellement une barri√®re entre un service sur votre syst√®me et l'utilisateur du service. Les modules peuvent avoir des objectifs tr√®s vari√©s, allant de l'interdiction de connexion aux utilisateurs d'un groupe UNIX particulier \(ou netgroup, ou sous-r√©seau‚Ä¶\), √† la mise en ≈ìuvre de limites de ressources afin que votre groupe de ‚Äòrecherche‚Äô ne puisse pas accaparer les ressources du syst√®me.

# Fichiers de configuration

Solaris et d'autres syst√®mes UNIX commerciaux ont un mod√®le de configuration l√©g√®rement diff√©rent, centr√© autour d'un seul fichier, **`/etc/pam.conf`**. Sur la plupart des syst√®mes Linux, ces fichiers de configuration se trouvent dans **`/etc/pam.d`**, et sont nomm√©s d'apr√®s le service ‚Äì par exemple, le fichier de configuration de ‚Äòlogin‚Äô s'appelle **`/etc/pam.d/login`**. Jetons un coup d'≈ìil rapide √† une version de ce fichier :
```text
auth required /lib/security/pam_securetty.so
auth required /lib/security/pam_nologin.so
auth sufficient /lib/security/pam_ldap.so
auth required /lib/security/pam_unix_auth.so try_first_pass
account sufficient /lib/security/pam_ldap.so
account required /lib/security/pam_unix_acct.so
password required /lib/security/pam_cracklib.so
password required /lib/security/pam_ldap.so
password required /lib/security/pam_pwdb.so use_first_pass
session required /lib/security/pam_unix_session.so
```
## **Domaines de gestion PAM**

La colonne la plus √† gauche peut contenir quatre mots uniques, qui repr√©sentent quatre domaines de gestion PAM : **auth**, **account**, **password** et **session**. Bien qu'il existe de nombreux modules qui prennent en charge plus d'un de ces domaines \(en effet, pam\_unix les prend tous en charge\), d'autres, comme pam\_cracklib par exemple, ne conviennent que pour un seul \(la fonctionnalit√© ‚Äòpassword‚Äô dans le cas de pam\_cracklib\).

* **auth** : Le domaine ‚Äòauth‚Äô \(je l'appelle un domaine ‚Äì les documents le d√©signent comme un ‚Äògroupe de gestion‚Äô ou une ‚Äòfonctionnalit√©‚Äô\) est responsable de v√©rifier que l'utilisateur est bien celui qu'il pr√©tend √™tre. Les modules qui peuvent √™tre list√©s dans cette zone prennent **g√©n√©ralement** en charge la **demande de mot de passe**.
* **account** : Cette zone est responsable d'un large √©ventail de fonctionnalit√©s possibles de **v√©rification de compte**. Il existe de nombreux modules disponibles pour cette fonctionnalit√©. Les contraintes d'utilisation d'un service bas√©es sur la **v√©rification de l'appartenance √† un groupe**, l'heure de la journ√©e, si un compte utilisateur est local ou distant, etc., sont g√©n√©ralement appliqu√©es par des modules qui prennent en charge cette fonctionnalit√©.
* **password** : Les modules de cette zone sont responsables de toute fonctionnalit√© n√©cessaire dans le cadre de la **mise √† jour des mots de passe** pour un service donn√©. La plupart du temps, cette section est assez banale, appelant simplement un module qui **demandera le mot de passe actuel**, et, en supposant que cela r√©ussisse, vous invitera √† en entrer un nouveau. D'autres modules pourraient √™tre ajout√©s pour effectuer des v√©rifications de **complexit√© de mot de passe** ou de dictionnaire √©galement, comme celles effectu√©es par les modules pam\_cracklib et pam\_pwcheck.
* **session** : Les modules de cette zone effectuent un certain nombre de choses qui se produisent soit **pendant la configuration ou le nettoyage d'un service** pour un utilisateur donn√©. Cela peut inclure un certain nombre de choses ; lancer un script d'initialisation syst√®me, effectuer une journalisation sp√©ciale, **monter le r√©pertoire personnel de l'utilisateur**, ou d√©finir des limites de ressources.

## **Contr√¥les des modules PAM**

La **colonne du milieu** contient un mot-cl√© qui d√©termine essentiellement ce que PAM doit faire si le module **r√©ussit ou √©choue**. Ces mots-cl√©s sont appel√©s ‚Äò**contr√¥les**‚Äô dans le jargon PAM. Dans 90 % des cas, vous pouvez utiliser l'un des mots-cl√©s courants \(**requisite**, **required**, **sufficient** ou **optional**\). Cependant, ce n'est que la pointe de l'iceberg en termes de lib√©ration de la flexibilit√© et de la puissance de PAM.

* **required** : Si un module ‚Äòrequired‚Äô renvoie un statut qui n'est **pas ‚Äòsuccess‚Äô**, l'**op√©ration √©chouera TOUJOURS**, mais seulement apr√®s que les **modules situ√©s en dessous soient invoqu√©s**. Cela peut sembler insens√© √† premi√®re vue, mais cela a pour but de **toujours agir de la m√™me mani√®re du point de vue de l'utilisateur** essayant d'utiliser le service. L'effet net est qu'il devient **impossible** pour un √©ventuel pirate de **d√©terminer** **quel** **module** a caus√© l'**√©chec**.
* **requisite** : Si un module ‚Äòrequisite‚Äô √©choue, l'**op√©ration** non seulement **√©choue**, mais l'op√©ration est **imm√©diatement** **termin√©e** avec un √©chec sans invoquer d'autres modules.
* **sufficient** : Si un module **sufficient** **r√©ussit**, cela suffit pour satisfaire les exigences des modules suffisants dans ce domaine pour l'utilisation du service, et **les modules situ√©s en dessous qui sont √©galement list√©s comme ‚Äòsufficient‚Äô ne sont pas invoqu√©s**. **S'il √©choue, l'op√©ration √©choue √† moins qu'un module invoqu√© apr√®s lui ne r√©ussisse**.
* **optional** : Un module ''optional‚Äô, selon la page de manuel pam\(8\), **ne fera √©chouer une op√©ration que s'il est le seul module dans la pile pour cette fonctionnalit√©**.

## Exemple

Dans notre fichier d'exemple, nous avons quatre modules empil√©s pour le domaine auth :
```text
auth       required     /lib/security/pam_securetty.so
auth       required     /lib/security/pam_env.so
auth       sufficient   /lib/security/pam_ldap.so
auth       required     /lib/security/pam_unix.so try_first_pass
```
Comme les modules sont invoqu√©s dans l'ordre, voici ce qui se passera :

1. Le module '**pam\_securetty**' v√©rifiera son fichier de configuration, **`/etc/securetty`**, et verra si le terminal utilis√© pour cette connexion est r√©pertori√© dans le fichier. Si **ce n'est pas le cas, les connexions root ne seront pas autoris√©es**. Si vous essayez de vous connecter en tant que root sur un 'mauvais' terminal, ce module √©chouera. Puisqu'il est 'requis', il invoquera quand m√™me tous les modules de la pile. Cependant, m√™me si chacun d'eux r√©ussit, la connexion √©chouera. Il est int√©ressant de noter que si le module √©tait list√© comme 'requis', l'op√©ration se terminerait imm√©diatement par un √©chec, sans invoquer aucun des autres modules, quel que soit leur statut.
2. Le module '**pam\_env**' **d√©finira les variables d'environnement** en fonction de ce que l'administrateur a configur√© dans /etc/security/pam\_env.conf. Sur une configuration par d√©faut de Redhat 9, Fedora Core 1 et Mandrake 9.2, le fichier de configuration de ce module ne d√©finit en fait aucune variable. Une bonne utilisation de ceci pourrait √™tre de d√©finir automatiquement une variable d'environnement DISPLAY pour un utilisateur se connectant via SSH afin qu'il n'ait pas √† la d√©finir lui-m√™me s'il veut renvoyer un 'xterm' vers son bureau √† distance (bien que cela puisse √™tre pris en charge automatiquement par OpenSSH).
3. Le module '**pam\_ldap**' **invitera** l'utilisateur √† saisir un **mot de passe**, puis v√©rifiera l'annuaire ldap indiqu√© dans **`/etc/ldap.conf`** pour authentifier l'utilisateur. Si cela √©choue, l'op√©ration peut toujours r√©ussir si 'pam\_unix' r√©ussit √† authentifier l'utilisateur. Si pam\_ldap r√©ussit, 'pam\_unix' ne sera pas invoqu√©.
4. Le module '**pam\_unix**', dans ce cas, **ne demandera pas √† l'utilisateur de saisir un mot de passe**. L'argument 'try\_first\_pass' indiquera au module **d'utiliser le mot de passe qui lui a √©t√© donn√© par le module pr√©c√©dent** (dans ce cas, pam\_ldap). Il essaiera d'authentifier l'utilisateur en utilisant les appels syst√®me getpw\* standards. Si pam\_unix √©choue, et que pam\_ldap a √©chou√©, l'op√©ration √©chouera. Si pam\_ldap √©choue, mais que pam\_unix r√©ussit, l'op√©ration r√©ussira (ceci est extr√™mement utile dans les cas o√π root n'est pas dans l'annuaire ldap, mais est toujours dans le fichier local /etc/passwd !).

<details>

<summary><strong>Apprenez le hacking AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF** Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**merchandising officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de hacking en soumettant des PR aux repos github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
