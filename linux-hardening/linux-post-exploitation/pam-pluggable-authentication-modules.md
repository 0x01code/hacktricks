<details>

<summary><strong>Aprende hacking en AWS desde cero hasta experto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** Consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Obt√©n la [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠guenos** en **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Comparte tus trucos de hacking enviando PRs a los** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repositorios de github.

</details>


PAM es una colecci√≥n de m√≥dulos que esencialmente forman una barrera entre un servicio en tu sistema y el usuario del servicio. Los m√≥dulos pueden tener prop√≥sitos muy variados, desde prohibir el inicio de sesi√≥n a usuarios de un grupo UNIX en particular \(o netgroup, o subred...\), hasta implementar l√≠mites de recursos para que tu grupo de 'investigaci√≥n' no pueda acaparar los recursos del sistema.

# Archivos de Configuraci√≥n

Solaris y otros sistemas UNIX comerciales tienen un modelo de configuraci√≥n ligeramente diferente, centrado en un √∫nico archivo, **`/etc/pam.conf`**. En la mayor√≠a de los sistemas Linux, estos archivos de configuraci√≥n residen en **`/etc/pam.d`**, y llevan el nombre del servicio, por ejemplo, el archivo de configuraci√≥n de 'login' se llama **`/etc/pam.d/login`**. Echemos un vistazo r√°pido a una versi√≥n de ese archivo:
```text
auth required /lib/security/pam_securetty.so
auth required /lib/security/pam_nologin.so
auth sufficient /lib/security/pam_ldap.so
auth required /lib/security/pam_unix_auth.so try_first_pass
account sufficient /lib/security/pam_ldap.so
account required /lib/security/pam_unix_acct.so
password required /lib/security/pam_cracklib.so
password required /lib/security/pam_ldap.so
password required /lib/security/pam_pwdb.so use_first_pass
session required /lib/security/pam_unix_session.so
```
## **Reinos de Gesti√≥n de PAM**

La columna m√°s a la izquierda contiene cuatro palabras √∫nicas, que representan cuatro reinos de gesti√≥n de PAM: **auth**, **account**, **password** y **session**. Mientras hay muchos m√≥dulos que admiten m√°s de uno de estos reinos \(de hecho, pam\_unix los admite todos\), otros, como pam\_cracklib por ejemplo, solo son adecuados para uno \(en el caso de pam\_cracklib, la funcionalidad de ‚Äòpassword‚Äô\).

* **auth**: El reino de ‚Äòauth‚Äô \(lo llamo reino, la documentaci√≥n se refiere a √©l como un ‚Äògrupo de gesti√≥n‚Äô o ‚Äòfacilidad‚Äô\) es responsable de verificar que el usuario es quien dice ser. Los m√≥dulos que se pueden listar en esta √°rea **generalmente** admiten **solicitar una contrase√±a**.
* **account**: Esta √°rea es responsable de una amplia gama de posibles funcionalidades de **verificaci√≥n de cuenta**. Hay muchos m√≥dulos disponibles para esta facilidad. Las restricciones para el uso de un servicio basadas en **verificar la pertenencia a un grupo**, la hora del d√≠a, si una cuenta de usuario es local o remota, etc., generalmente son aplicadas por m√≥dulos que admiten esta facilidad.
* **password**: Los m√≥dulos en esta √°rea son responsables de cualquier funcionalidad necesaria en el proceso de **actualizaci√≥n de contrase√±as** para un servicio dado. La mayor√≠a de las veces, esta secci√≥n es bastante com√∫n, simplemente llamando a un m√≥dulo que **solicitar√° una contrase√±a actual**, y, suponiendo que sea exitosa, solicitar√° una nueva. Otros m√≥dulos podr√≠an agregarse para realizar **comprobaciones de complejidad de contrase√±as** o de diccionario, como las realizadas por los m√≥dulos pam\_cracklib y pam\_pwcheck.
* **session**: Los m√≥dulos en esta √°rea realizan cualquier cantidad de cosas que suceden ya sea **durante la configuraci√≥n o limpieza de un servicio** para un usuario dado. Esto puede incluir cualquier cantidad de cosas; iniciar un script de inicializaci√≥n en todo el sistema, realizar un registro especial, **montar el directorio de inicio del usuario**, o establecer l√≠mites de recursos.

## **Controles de M√≥dulos PAM**

La **columna central** contiene una palabra clave que determina esencialmente **qu√© debe hacer PAM si el m√≥dulo tiene √©xito o falla**. Estas palabras clave se llaman ‚Äò**controles**‚Äô en el lenguaje de PAM. En el 90% de los casos, se puede usar una de las palabras clave comunes \(**requisite**, **required**, **sufficient** u **optional**\). Sin embargo, esto es solo la punta del iceberg en t√©rminos de desatar la flexibilidad y el poder de PAM.

* **required**: Si un m√≥dulo ‚Äòrequired‚Äô devuelve un estado que **no es ‚Äò√©xito‚Äô**, la **operaci√≥n siempre fallar√°**, pero solo despu√©s de que se invoquen los **m√≥dulos debajo de √©l**. Esto parece sin sentido a primera vista, supongo, pero sirve al prop√≥sito de **actuar siempre de la misma manera desde el punto de vista del usuario** que intenta utilizar el servicio. El efecto neto es que se vuelve **imposible** para un posible intruso **determinar** **qu√©** **m√≥dulo** caus√≥ el **fallo**.
* **requisite**: Si un m√≥dulo ‚Äòrequisite‚Äô falla, la **operaci√≥n** no solo **falla**, sino que la operaci√≥n se **termina inmediatamente** con un fallo sin invocar ning√∫n otro m√≥dulo.
* **sufficient**: Si un m√≥dulo **sufficient** **tiene √©xito**, es suficiente para satisfacer los requisitos de los m√≥dulos suficientes en ese reino para el uso del servicio, y **los m√≥dulos debajo de √©l que tambi√©n se enumeran como ‚Äòsufficient‚Äô no son invocados**. **Si falla, la operaci√≥n falla a menos que un m√≥dulo invocado despu√©s de √©l tenga √©xito**.
* **optional**: Un m√≥dulo ‚Äòoptional‚Äô, seg√∫n la p√°gina del manual pam\(8\), **solo har√° que una operaci√≥n falle si es el √∫nico m√≥dulo en la pila para esa facilidad**.

## Ejemplo

En nuestro archivo de ejemplo, tenemos cuatro m√≥dulos apilados para el reino de auth:
```text
auth       required     /lib/security/pam_securetty.so
auth       required     /lib/security/pam_env.so
auth       sufficient   /lib/security/pam_ldap.so
auth       required     /lib/security/pam_unix.so try_first_pass
```
1. El m√≥dulo '**pam\_securetty**' verificar√° su archivo de configuraci√≥n, **`/etc/securetty`**, y ver√° si el terminal utilizado para este inicio de sesi√≥n est√° en la lista del archivo. Si **no lo est√°, no se permitir√°n los inicios de sesi√≥n de root**. Si intentas iniciar sesi√≥n como root en un terminal 'malo', este m√≥dulo fallar√°. Dado que es 'requerido', seguir√° invocando todos los m√≥dulos en la pila. Sin embargo, incluso si todos tienen √©xito, el inicio de sesi√≥n fallar√°. Es interesante notar que si el m√≥dulo se listara como 'requisito', la operaci√≥n terminar√≠a con un fallo inmediatamente, sin invocar ninguno de los otros m√≥dulos, sin importar cu√°l sea su estado.
2. El m√≥dulo '**pam\_env**' **establecer√° variables de entorno** basadas en lo que el administrador haya configurado en /etc/security/pam\_env.conf. En una configuraci√≥n predeterminada de Redhat 9, Fedora Core 1 y Mandrake 9.2, el archivo de configuraci√≥n para este m√≥dulo en realidad no establece ninguna variable. Un buen uso para esto podr√≠a ser establecer autom√°ticamente una variable de entorno DISPLAY para un usuario que inicia sesi√≥n a trav√©s de SSH para que no tengan que configurarla ellos mismos si desean enviar un 'xterm' de vuelta a su escritorio remoto \(aunque esto puede ser manejado autom√°ticamente por OpenSSH\).
3. El m√≥dulo '**pam\_ldap**' **solicitar√°** al usuario una **contrase√±a**, y luego verificar√° el directorio ldap indicado en **`/etc/ldap.conf`** para autenticar al usuario. Si esto falla, la operaci√≥n a√∫n puede tener √©xito si 'pam\_unix' tiene √©xito en autenticar al usuario. Si pam\_ldap tiene √©xito, 'pam\_unix' no ser√° invocado.
4. El m√≥dulo '**pam\_unix**', en este caso, **no solicitar√° al usuario una contrase√±a**. El argumento 'try\_first\_pass' le indicar√° al m√≥dulo que **utilice la contrase√±a proporcionada por el m√≥dulo anterior** \(en este caso, pam\_ldap\). Intentar√° autenticar al usuario utilizando las llamadas al sistema est√°ndar getpw\*. Si pam\_unix falla, y pam\_ldap ha fallado, la operaci√≥n fallar√°. Si pam\_ldap falla, pero pam\_unix tiene √©xito, la operaci√≥n tendr√° √©xito \(¬°esto es extremadamente √∫til en casos donde root no est√° en el directorio ldap, pero sigue estando en el archivo local /etc/passwd!\).
