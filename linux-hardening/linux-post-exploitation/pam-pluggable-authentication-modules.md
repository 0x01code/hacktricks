<details>

<summary><strong>Aprenda hacking AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras maneiras de apoiar o HackTricks:

* Se voc√™ quiser ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF** Verifique os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**swag oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-nos** no **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para os** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) reposit√≥rios do github.

</details>


PAM √© uma cole√ß√£o de m√≥dulos que essencialmente formam uma barreira entre um servi√ßo em seu sistema e o usu√°rio do servi√ßo. Os m√≥dulos podem ter prop√≥sitos amplamente variados, desde impedir o login de usu√°rios de um determinado grupo UNIX \(ou netgroup, ou subnet‚Ä¶\), at√© implementar limites de recursos para que seu grupo de ‚Äòpesquisa‚Äô n√£o possa monopolizar os recursos do sistema.

# Arquivos de Configura√ß√£o

Solaris e outros sistemas UNIX comerciais t√™m um modelo de configura√ß√£o ligeiramente diferente, centrado em torno de um √∫nico arquivo, **`/etc/pam.conf`**. Na maioria dos sistemas Linux, esses arquivos de configura√ß√£o ficam em **`/etc/pam.d`**, e s√£o nomeados de acordo com o servi√ßo - por exemplo, o arquivo de configura√ß√£o de 'login' √© chamado **`/etc/pam.d/login`**. Vamos dar uma olhada r√°pida em uma vers√£o desse arquivo:
```text
auth required /lib/security/pam_securetty.so
auth required /lib/security/pam_nologin.so
auth sufficient /lib/security/pam_ldap.so
auth required /lib/security/pam_unix_auth.so try_first_pass
account sufficient /lib/security/pam_ldap.so
account required /lib/security/pam_unix_acct.so
password required /lib/security/pam_cracklib.so
password required /lib/security/pam_ldap.so
password required /lib/security/pam_pwdb.so use_first_pass
session required /lib/security/pam_unix_session.so
```
## **Reinos de Gerenciamento do PAM**

A coluna mais √† esquerda pode conter quatro palavras √∫nicas, que representam quatro reinos de gerenciamento do PAM: **auth**, **account**, **password** e **session**. Embora existam muitos m√≥dulos que suportam mais de um desses reinos \(de fato, o pam\_unix suporta todos eles\), outros, como o pam\_cracklib, por exemplo, s√£o adequados apenas para um \(no caso do pam\_cracklib, a funcionalidade de ‚Äòpassword‚Äô\).

* **auth**: O reino ‚Äòauth‚Äô \(eu o chamo de reino - a documenta√ß√£o se refere a ele como um ‚Äògrupo de gerenciamento‚Äô ou ‚Äòfacilidade‚Äô\) √© respons√°vel por verificar se o usu√°rio √© quem diz ser. Os m√≥dulos que podem ser listados nesta √°rea **geralmente** suportam **solicita√ß√£o de senha**.
* **account**: Esta √°rea √© respons√°vel por uma ampla gama de poss√≠veis funcionalidades de **verifica√ß√£o de conta**. Existem muitos m√≥dulos dispon√≠veis para esta facilidade. Restri√ß√µes ao uso de um servi√ßo com base na **verifica√ß√£o de pertencimento a um grupo**, hor√°rio do dia, se uma conta de usu√°rio √© local ou remota, etc., s√£o geralmente aplicadas por m√≥dulos que suportam esta facilidade.
* **password**: Os m√≥dulos nesta √°rea s√£o respons√°veis por qualquer funcionalidade necess√°ria no processo de **atualiza√ß√£o de senhas** para um determinado servi√ßo. Na maioria das vezes, esta se√ß√£o √© bastante comum, simplesmente chamando um m√≥dulo que **solicitar√° uma senha atual**, e, assumindo que seja bem-sucedido, solicitar√° uma nova. Outros m√≥dulos podem ser adicionados para realizar **verifica√ß√£o de complexidade de senha** ou de dicion√°rio, como a realizada pelos m√≥dulos pam\_cracklib e pam\_pwcheck.
* **session**: Os m√≥dulos nesta √°rea realizam qualquer n√∫mero de coisas que acontecem **durante a configura√ß√£o ou limpeza de um servi√ßo** para um determinado usu√°rio. Isso pode incluir qualquer n√∫mero de coisas; iniciar um script de inicializa√ß√£o em todo o sistema, realizar log especial, **montar o diret√≥rio home do usu√°rio**, ou definir limites de recursos.

## **Controles de M√≥dulo do PAM**

A **coluna do meio** cont√©m uma palavra-chave que basicamente determina **o que o PAM deve fazer se o m√≥dulo tiver sucesso ou falhar**. Essas palavras-chave s√£o chamadas de ‚Äò**controles**‚Äô no jarg√£o do PAM. Em 90% dos casos, voc√™ pode usar uma das palavras-chave comuns \(**requisite**, **required**, **sufficient** ou **optional**\). No entanto, isso √© apenas a ponta do iceberg em termos de liberar a flexibilidade e o poder do PAM.

* **required**: Se um m√≥dulo ‚Äòrequired‚Äô retornar um status que n√£o √© ‚Äòsucesso‚Äô, a **opera√ß√£o sempre falhar√°**, mas somente ap√≥s os **m√≥dulos abaixo dele serem invocados**. Isso parece sem sentido √† primeira vista, suponho, mas serve ao prop√≥sito de **sempre agir da mesma maneira do ponto de vista do usu√°rio** que tenta utilizar o servi√ßo. O efeito l√≠quido √© que se torna **imposs√≠vel** para um poss√≠vel invasor **determinar** **qual** **m√≥dulo** causou a **falha**.
* **requisite**: Se um m√≥dulo ‚Äòrequisite‚Äô falhar, a **opera√ß√£o** n√£o apenas **falha**, mas a opera√ß√£o √© **imediatamente** **encerrada** com uma falha sem invocar outros m√≥dulos.
* **sufficient**: Se um m√≥dulo **sufficient** **tiver sucesso**, √© suficiente para satisfazer os requisitos de m√≥dulos suficientes nesse reino para o uso do servi√ßo, e **os m√≥dulos abaixo dele que tamb√©m s√£o listados como ‚Äòsufficient‚Äô n√£o s√£o invocados**. **Se falhar, a opera√ß√£o falha a menos que um m√≥dulo invocado ap√≥s ele tenha sucesso**.
* **optional**: Um m√≥dulo ‚Äòoptional‚Äô, de acordo com a p√°gina do manual pam\(8\), **s√≥ far√° uma opera√ß√£o falhar se for o √∫nico m√≥dulo na pilha para essa facilidade**.

## Exemplo

Em nosso arquivo de exemplo, temos quatro m√≥dulos empilhados para o reino auth:
```text
auth       required     /lib/security/pam_securetty.so
auth       required     /lib/security/pam_env.so
auth       sufficient   /lib/security/pam_ldap.so
auth       required     /lib/security/pam_unix.so try_first_pass
```
1. O m√≥dulo '**pam\_securetty**' verificar√° seu arquivo de configura√ß√£o, **`/etc/securetty`**, e ver√° se o terminal usado para este login est√° listado no arquivo. Se **n√£o estiver, os logins de root n√£o ser√£o permitidos**. Se voc√™ tentar fazer login como root em um terminal 'ruim', este m√≥dulo falhar√°. Como √© 'required', ainda invocar√° todos os m√≥dulos na pilha. No entanto, mesmo que todos eles tenham sucesso, o login falhar√°. Interessante notar que se o m√≥dulo fosse listado como 'requisite', a opera√ß√£o terminaria com uma falha imediatamente, sem invocar nenhum dos outros m√≥dulos, n√£o importando qual seja o status deles.
2. O m√≥dulo '**pam\_env**' ir√° **definir vari√°veis de ambiente** com base no que o administrador configurou em /etc/security/pam\_env.conf. Em uma configura√ß√£o padr√£o do Redhat 9, Fedora Core 1 e Mandrake 9.2, o arquivo de configura√ß√£o para este m√≥dulo na verdade n√£o define nenhuma vari√°vel. Um bom uso para isso pode ser definir automaticamente uma vari√°vel de ambiente DISPLAY para um usu√°rio que faz login via SSH para que eles n√£o precisem definir isso se quiserem enviar um 'xterm' de volta para sua √°rea de trabalho remota \(embora isso possa ser feito automaticamente pelo OpenSSH\).
3. O m√≥dulo '**pam\_ldap**' ir√° **solicitar** a senha do usu√°rio e ent√£o verificar o diret√≥rio ldap indicado em **`/etc/ldap.conf`** para autenticar o usu√°rio. Se isso falhar, a opera√ß√£o ainda pode ter sucesso se 'pam\_unix' conseguir autenticar o usu√°rio. Se pam\_ldap tiver sucesso, 'pam\_unix' n√£o ser√° invocado.
4. O m√≥dulo '**pam\_unix**', neste caso, **n√£o solicitar√° a senha do usu√°rio**. O argumento 'try\_first\_pass' dir√° ao m√≥dulo para **usar a senha fornecida pelo m√≥dulo anterior** \(neste caso, pam\_ldap\). Ele tentar√° autenticar o usu√°rio usando as chamadas de sistema padr√£o getpw\*. Se pam\_unix falhar e pam\_ldap tamb√©m falhar, a opera√ß√£o falhar√°. Se pam\_ldap falhar, mas pam\_unix tiver sucesso, a opera√ß√£o ter√° sucesso \(isso √© extremamente √∫til em casos em que root n√£o est√° no diret√≥rio ldap, mas ainda est√° no arquivo local /etc/passwd!\).
