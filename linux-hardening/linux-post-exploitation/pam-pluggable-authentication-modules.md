<details>

<summary><strong>Aprende hacking en AWS de cero a h√©roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF**, consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Consigue el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **sigue** a **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de github** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>


PAM es una colecci√≥n de m√≥dulos que esencialmente forman una barrera entre un servicio en tu sistema y el usuario del servicio. Los m√≥dulos pueden tener prop√≥sitos muy variados, desde prohibir el inicio de sesi√≥n a usuarios de un grupo UNIX particular \(o netgroup, o subred‚Ä¶\), hasta implementar l√≠mites de recursos para que tu grupo de ‚Äòinvestigaci√≥n‚Äô no acapare los recursos del sistema.

# Archivos de Configuraci√≥n

Solaris y otros sistemas UNIX comerciales tienen un modelo de configuraci√≥n ligeramente diferente, centrado en torno a un √∫nico archivo, **`/etc/pam.conf`**. En la mayor√≠a de los sistemas Linux, estos archivos de configuraci√≥n se encuentran en **`/etc/pam.d`**, y est√°n nombrados seg√∫n el servicio ‚Äì por ejemplo, el archivo de configuraci√≥n de ‚Äòlogin‚Äô se llama **`/etc/pam.d/login`**. Echemos un vistazo r√°pido a una versi√≥n de ese archivo:
```text
auth required /lib/security/pam_securetty.so
auth required /lib/security/pam_nologin.so
auth sufficient /lib/security/pam_ldap.so
auth required /lib/security/pam_unix_auth.so try_first_pass
account sufficient /lib/security/pam_ldap.so
account required /lib/security/pam_unix_acct.so
password required /lib/security/pam_cracklib.so
password required /lib/security/pam_ldap.so
password required /lib/security/pam_pwdb.so use_first_pass
session required /lib/security/pam_unix_session.so
```
## **√Åmbitos de Gesti√≥n de PAM**

La columna m√°s a la izquierda puede contener cuatro palabras √∫nicas, que representan cuatro √°mbitos de gesti√≥n de PAM: **auth**, **account**, **password** y **session**. Aunque hay muchos m√≥dulos que admiten m√°s de uno de estos √°mbitos (de hecho, pam_unix los admite todos), otros, como pam_cracklib, solo son adecuados para uno (la instalaci√≥n de ‚Äòpassword‚Äô en el caso de pam_cracklib).

* **auth**: El √°mbito 'auth' (lo llamo √°mbito, los documentos se refieren a √©l como 'grupo de gesti√≥n' o 'instalaci√≥n') es responsable de verificar que el usuario sea quien dice ser. Los m√≥dulos que se pueden listar en esta √°rea **generalmente** admiten **solicitar una contrase√±a**.
* **account**: Esta √°rea es responsable de una amplia gama de posibles **funcionalidades de verificaci√≥n de cuenta**. Hay muchos m√≥dulos disponibles para esta instalaci√≥n. Las restricciones al uso de un servicio basadas en **verificar la pertenencia a un grupo**, la hora del d√≠a, si una cuenta de usuario es local o remota, etc., generalmente son impuestas por m√≥dulos que admiten esta instalaci√≥n.
* **password**: Los m√≥dulos en esta √°rea son responsables de cualquier funcionalidad necesaria en el curso de **actualizar contrase√±as** para un servicio dado. La mayor√≠a de las veces, esta secci√≥n es bastante rutinaria, simplemente llamando a un m√≥dulo que **solicitar√° una contrase√±a actual**, y, asumiendo que eso sea exitoso, te pedir√° una nueva. Otros m√≥dulos podr√≠an agregarse para realizar **complejidad de contrase√±a** o verificaci√≥n de diccionario tambi√©n, como la realizada por los m√≥dulos pam_cracklib y pam_pwcheck.
* **session**: Los m√≥dulos en esta √°rea realizan cualquier n√∫mero de cosas que suceden ya sea **durante la configuraci√≥n o limpieza de un servicio** para un usuario dado. Esto puede incluir cualquier n√∫mero de cosas; lanzar un script de inicializaci√≥n del sistema, realizar un registro especial, **montar el directorio personal del usuario**, o establecer l√≠mites de recursos.

## **Controles de M√≥dulos PAM**

La **columna del medio** contiene una palabra clave que determina esencialmente **qu√© debe hacer PAM si el m√≥dulo tiene √©xito o falla**. Estas palabras clave se llaman 'controles' en el lenguaje de PAM. En el 90% de los casos, puedes usar una de las palabras clave comunes (**requisite**, **required**, **sufficient** o **optional**). Sin embargo, esto es solo la punta del iceberg en t√©rminos de desatar la flexibilidad y el poder de PAM.

* **required**: Si un m√≥dulo 'required' devuelve un estado que **no es 'success'**, la **operaci√≥n finalmente fallar√° SIEMPRE**, pero solo despu√©s de que se **invoquen los m√≥dulos debajo de √©l**. Esto parece sin sentido a primera vista, supongo, pero sirve para **actuar siempre de la misma manera desde el punto de vista del usuario** que intenta utilizar el servicio. El efecto neto es que se vuelve **imposible** para un posible cracker **determinar** **cu√°l** **m√≥dulo** caus√≥ el **fallo**.
* **requisite**: Si un m√≥dulo 'requisite' falla, la **operaci√≥n** no solo **falla**, sino que la operaci√≥n se **termina inmediatamente** con un fallo sin invocar ning√∫n otro m√≥dulo.
* **sufficient**: Si un m√≥dulo **sufficient** **tiene √©xito**, es suficiente para satisfacer los requisitos de los m√≥dulos suficientes en ese √°mbito para el uso del servicio, y **no se invocan los m√≥dulos debajo de √©l que tambi√©n est√©n listados como 'sufficient'**. **Si falla, la operaci√≥n falla a menos que un m√≥dulo invocado despu√©s de √©l tenga √©xito**.
* **optional**: Un m√≥dulo ''optional', seg√∫n la p√°gina del manual pam(8), **solo causar√° que una operaci√≥n falle si es el √∫nico m√≥dulo en la pila para esa instalaci√≥n**.

## Ejemplo

En nuestro archivo de ejemplo, tenemos cuatro m√≥dulos apilados para el √°mbito auth:
```text
auth       required     /lib/security/pam_securetty.so
auth       required     /lib/security/pam_env.so
auth       sufficient   /lib/security/pam_ldap.so
auth       required     /lib/security/pam_unix.so try_first_pass
```
A medida que se invocan los m√≥dulos, esto es lo que suceder√°:

1. El m√≥dulo '**pam_securetty**' verificar√° su archivo de configuraci√≥n, **`/etc/securetty`**, y comprobar√° si el terminal utilizado para este inicio de sesi√≥n est√° listado en el archivo. Si **no lo est√°, no se permitir√°n inicios de sesi√≥n como root**. Si intentas iniciar sesi√≥n como root en un terminal 'malo', este m√≥dulo fallar√°. Dado que es 'requerido', a√∫n invocar√° todos los m√≥dulos en la pila. Sin embargo, incluso si todos ellos tienen √©xito, el inicio de sesi√≥n fallar√°. Es interesante notar que si el m√≥dulo estuviera listado como 'requisito', la operaci√≥n terminar√≠a con un fallo inmediatamente, sin invocar a ninguno de los otros m√≥dulos, sin importar su estado.
2. El m√≥dulo '**pam_env**' **establecer√° variables de entorno** basadas en lo que el administrador haya configurado en /etc/security/pam_env.conf. En una configuraci√≥n predeterminada de Redhat 9, Fedora Core 1 y Mandrake 9.2, el archivo de configuraci√≥n para este m√≥dulo en realidad no establece ninguna variable. Un buen uso para esto podr√≠a ser establecer autom√°ticamente una variable de entorno DISPLAY para un usuario que inicia sesi√≥n a trav√©s de SSH para que no tenga que configurarla ellos mismos si quieren enviar un 'xterm' de vuelta a su escritorio remoto (aunque esto puede ser manejado autom√°ticamente por OpenSSH).
3. El m√≥dulo '**pam_ldap**' **solicitar√°** al usuario una **contrase√±a**, y luego verificar√° el directorio ldap indicado en **`/etc/ldap.conf`** para autenticar al usuario. Si esto falla, la operaci√≥n a√∫n puede tener √©xito si 'pam_unix' tiene √©xito en autenticar al usuario. Si pam_ldap tiene √©xito, 'pam_unix' no ser√° invocado.
4. El m√≥dulo '**pam_unix**', en este caso, **no solicitar√° al usuario una contrase√±a**. El argumento 'try_first_pass' le dir√° al m√≥dulo que **use la contrase√±a proporcionada por el m√≥dulo precedente** (en este caso, pam_ldap). Intentar√° autenticar al usuario utilizando las llamadas al sistema getpw\* est√°ndar. Si pam_unix falla, y pam_ldap ha fallado, la operaci√≥n fallar√°. Si pam_ldap falla, pero pam_unix tiene √©xito, la operaci√≥n tendr√° √©xito (¬°esto es extremadamente √∫til en casos donde root no est√° en el directorio ldap, pero a√∫n est√° en el archivo local /etc/passwd!).

<details>

<summary><strong>Aprende hacking en AWS de cero a h√©roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver a tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** Consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Consigue el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠gueme** en **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de github de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
