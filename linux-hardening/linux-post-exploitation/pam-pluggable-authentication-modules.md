<details>

<summary><strong>Aprenda hacking no AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ quer ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**material oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **Participe do** üí¨ [**grupo no Discord**](https://discord.gg/hRep4RUj7f) ou do [**grupo no telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) no github.

</details>


PAM √© uma cole√ß√£o de m√≥dulos que essencialmente formam uma barreira entre um servi√ßo no seu sistema e o usu√°rio do servi√ßo. Os m√≥dulos podem ter prop√≥sitos bastante variados, desde proibir o login de usu√°rios de um determinado grupo UNIX \(ou netgroup, ou sub-rede...\), at√© implementar limites de recursos para que seu grupo de ‚Äòpesquisa‚Äô n√£o monopolize os recursos do sistema.

# Arquivos de Configura√ß√£o

Solaris e outros sistemas UNIX comerciais t√™m um modelo de configura√ß√£o um pouco diferente, centrado em torno de um √∫nico arquivo, **`/etc/pam.conf`**. Na maioria dos sistemas Linux, esses arquivos de configura√ß√£o est√£o localizados em **`/etc/pam.d`**, e s√£o nomeados de acordo com o servi√ßo ‚Äì por exemplo, o arquivo de configura√ß√£o de ‚Äòlogin‚Äô √© chamado **`/etc/pam.d/login`**. Vamos dar uma r√°pida olhada em uma vers√£o desse arquivo:
```text
auth required /lib/security/pam_securetty.so
auth required /lib/security/pam_nologin.so
auth sufficient /lib/security/pam_ldap.so
auth required /lib/security/pam_unix_auth.so try_first_pass
account sufficient /lib/security/pam_ldap.so
account required /lib/security/pam_unix_acct.so
password required /lib/security/pam_cracklib.so
password required /lib/security/pam_ldap.so
password required /lib/security/pam_pwdb.so use_first_pass
session required /lib/security/pam_unix_session.so
```
## **Dom√≠nios de Gerenciamento do PAM**

A coluna mais √† esquerda pode conter quatro palavras √∫nicas, que representam quatro dom√≠nios de gerenciamento do PAM: **auth**, **account**, **password** e **session**. Embora existam muitos m√≥dulos que suportam mais de um desses dom√≠nios \(de fato, pam\_unix suporta todos eles\), outros, como pam\_cracklib, por exemplo, s√£o adequados apenas para um \(a funcionalidade ‚Äòpassword‚Äô no caso do pam\_cracklib\).

* **auth**: O dom√≠nio 'auth' \(eu o chamo de dom√≠nio ‚Äì a documenta√ß√£o se refere a ele como 'grupo de gerenciamento' ou 'facilidade'\) √© respons√°vel por verificar se o usu√°rio √© quem diz ser. Os m√≥dulos que podem ser listados nesta √°rea **geralmente** suportam **solicita√ß√£o de senha**.
* **account**: Esta √°rea √© respons√°vel por uma ampla gama de poss√≠veis funcionalidades de **verifica√ß√£o de conta**. Existem muitos m√≥dulos dispon√≠veis para esta facilidade. Restri√ß√µes ao uso de um servi√ßo baseadas na **verifica√ß√£o de pertencimento a grupos**, hora do dia, se uma conta de usu√°rio √© local ou remota, etc., s√£o geralmente aplicadas por m√≥dulos que suportam esta facilidade.
* **password**: Os m√≥dulos nesta √°rea s√£o respons√°veis por qualquer funcionalidade necess√°ria no curso de **atualiza√ß√£o de senhas** para um determinado servi√ßo. Na maioria das vezes, esta se√ß√£o √© bastante simples, simplesmente chamando um m√≥dulo que **solicitar√° uma senha atual**, e, assumindo que isso seja bem-sucedido, solicitar√° uma nova. Outros m√≥dulos podem ser adicionados para realizar **complexidade de senha** ou verifica√ß√£o de dicion√°rio tamb√©m, como o realizado pelos m√≥dulos pam\_cracklib e pam\_pwcheck.
* **session**: M√≥dulos nesta √°rea realizam uma s√©rie de coisas que acontecem **durante a configura√ß√£o ou limpeza de um servi√ßo** para um determinado usu√°rio. Isso pode incluir v√°rias coisas; lan√ßar um script de inicializa√ß√£o do sistema, realizar registros especiais, **montar o diret√≥rio home do usu√°rio** ou definir limites de recursos.

## **Controles de M√≥dulo do PAM**

A **coluna do meio** cont√©m uma palavra-chave que determina essencialmente o que o PAM deve fazer se o m√≥dulo **tiver sucesso ou falhar**. Essas palavras-chave s√£o chamadas de '**controles**' no jarg√£o do PAM. Em 90% dos casos, voc√™ pode usar uma das palavras-chave comuns \(**requisite**, **required**, **sufficient** ou **optional**\). No entanto, isso √© apenas a ponta do iceberg em termos de liberar a flexibilidade e o poder do PAM.

* **required**: Se um m√≥dulo 'required' retornar um status que **n√£o seja 'sucesso'**, a **opera√ß√£o falhar√° SEMPRE**, mas somente ap√≥s os **m√≥dulos abaixo dele serem invocados**. Isso pode parecer sem sentido √† primeira vista, mas serve ao prop√≥sito de **agir sempre da mesma maneira do ponto de vista do usu√°rio** que tenta utilizar o servi√ßo. O efeito l√≠quido √© que se torna **imposs√≠vel** para um poss√≠vel cracker **determinar** **qual** **m√≥dulo** causou a **falha**.
* **requisite**: Se um m√≥dulo 'requisite' falhar, a **opera√ß√£o** n√£o apenas **falha**, mas a opera√ß√£o √© **imediatamente** **terminada** com uma falha sem invocar quaisquer outros m√≥dulos.
* **sufficient**: Se um m√≥dulo **sufficient** **tiver sucesso**, √© o suficiente para satisfazer os requisitos dos m√≥dulos sufficient naquele dom√≠nio para o uso do servi√ßo, e **m√≥dulos abaixo dele que tamb√©m s√£o listados como 'sufficient' n√£o s√£o invocados**. **Se falhar, a opera√ß√£o falha a menos que um m√≥dulo invocado ap√≥s ele tenha sucesso**.
* **optional**: Um m√≥dulo 'optional', de acordo com a p√°gina de manual pam\(8\), **s√≥ causar√° falha na opera√ß√£o se for o √∫nico m√≥dulo na pilha para aquela facilidade**.

## Exemplo

Em nosso arquivo de exemplo, temos quatro m√≥dulos empilhados para o dom√≠nio auth:
```text
auth       required     /lib/security/pam_securetty.so
auth       required     /lib/security/pam_env.so
auth       sufficient   /lib/security/pam_ldap.so
auth       required     /lib/security/pam_unix.so try_first_pass
```
√Ä medida que os m√≥dulos s√£o invocados em ordem, eis o que acontecer√°:

1. O m√≥dulo '**pam\_securetty**' verificar√° seu arquivo de configura√ß√£o, **`/etc/securetty`**, e ver√° se o terminal usado para este login est√° listado no arquivo. Se **n√£o estiver, logins como root n√£o ser√£o permitidos**. Se voc√™ tentar fazer login como root em um terminal 'ruim', este m√≥dulo falhar√°. Como √© 'required', ainda invocar√° todos os m√≥dulos na pilha. No entanto, mesmo que todos eles tenham sucesso, o login falhar√°. √â interessante notar que se o m√≥dulo fosse listado como 'requisite', a opera√ß√£o terminaria com uma falha imediatamente, sem invocar nenhum dos outros m√≥dulos, independentemente do status deles.
2. O m√≥dulo '**pam\_env**' **definir√° vari√°veis de ambiente** com base no que o administrador configurou em /etc/security/pam\_env.conf. Em uma configura√ß√£o padr√£o do Redhat 9, Fedora Core 1 e Mandrake 9.2, o arquivo de configura√ß√£o para este m√≥dulo na verdade n√£o define nenhuma vari√°vel. Um bom uso para isso pode ser definir automaticamente uma vari√°vel de ambiente DISPLAY para um usu√°rio que faz login via SSH para que ele n√£o precise defini-la se quiser enviar um 'xterm' de volta para sua √°rea de trabalho remota (embora isso possa ser cuidado pelo OpenSSH automaticamente).
3. O m√≥dulo '**pam\_ldap**' **solicitar√°** ao usu√°rio uma **senha** e, em seguida, verificar√° o diret√≥rio ldap indicado em **`/etc/ldap.conf`** para autenticar o usu√°rio. Se isso falhar, a opera√ß√£o ainda pode ter sucesso se 'pam\_unix' tiver sucesso na autentica√ß√£o do usu√°rio. Se pam\_ldap tiver sucesso, 'pam\_unix' n√£o ser√° invocado.
4. O m√≥dulo '**pam\_unix**', neste caso, **n√£o solicitar√° ao usu√°rio uma senha**. O argumento 'try\_first\_pass' dir√° ao m√≥dulo para **usar a senha fornecida pelo m√≥dulo anterior** (neste caso, pam\_ldap). Ele tentar√° autenticar o usu√°rio usando as chamadas de sistema getpw\* padr√£o. Se pam\_unix falhar e pam\_ldap tamb√©m tiver falhado, a opera√ß√£o falhar√°. Se pam\_ldap falhar, mas pam\_unix tiver sucesso, a opera√ß√£o ter√° sucesso (isso √© extremamente √∫til em casos onde root n√£o est√° no diret√≥rio ldap, mas ainda est√° no arquivo local /etc/passwd!).



<details>

<summary><strong>Aprenda hacking no AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ quiser ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF** Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**material oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **Junte-se ao grupo** üí¨ [**Discord**](https://discord.gg/hRep4RUj7f) ou ao grupo [**telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios github** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
