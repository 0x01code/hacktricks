<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

- Voc√™ trabalha em uma **empresa de seguran√ßa cibern√©tica**? Voc√™ quer ver sua **empresa anunciada no HackTricks**? ou voc√™ quer ter acesso √† **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**? Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!

- Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)

- Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)

- **Junte-se ao** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**

- **Compartilhe suas t√©cnicas de hacking enviando PRs para o [reposit√≥rio hacktricks](https://github.com/carlospolop/hacktricks) e [hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)**.

</details>


PAM √© uma cole√ß√£o de m√≥dulos que essencialmente formam uma barreira entre um servi√ßo em seu sistema e o usu√°rio do servi√ßo. Os m√≥dulos podem ter prop√≥sitos amplamente variados, desde impedir o login de usu√°rios de um determinado grupo UNIX \(ou netgroup, ou subnet‚Ä¶\), at√© implementar limites de recursos para que seu grupo de "pesquisa" n√£o possa monopolizar os recursos do sistema.

# Arquivos de Configura√ß√£o

Solaris e outros sistemas UNIX comerciais t√™m um modelo de configura√ß√£o ligeiramente diferente, centrado em um √∫nico arquivo, **`/etc/pam.conf`**. Na maioria dos sistemas Linux, esses arquivos de configura√ß√£o ficam em **`/etc/pam.d`**, e s√£o nomeados de acordo com o servi√ßo - por exemplo, o arquivo de configura√ß√£o "login" √© chamado **`/etc/pam.d/login`**. Vamos dar uma olhada r√°pida em uma vers√£o desse arquivo:
```text
auth required /lib/security/pam_securetty.so
auth required /lib/security/pam_nologin.so
auth sufficient /lib/security/pam_ldap.so
auth required /lib/security/pam_unix_auth.so try_first_pass
account sufficient /lib/security/pam_ldap.so
account required /lib/security/pam_unix_acct.so
password required /lib/security/pam_cracklib.so
password required /lib/security/pam_ldap.so
password required /lib/security/pam_pwdb.so use_first_pass
session required /lib/security/pam_unix_session.so
```
## **Realms de Gerenciamento PAM**

A coluna mais √† esquerda cont√©m quatro palavras √∫nicas, que representam quatro realms de gerenciamento PAM: **auth**, **account**, **password** e **session**. Embora muitos m√≥dulos suportem mais de um desses realms \(de fato, pam\_unix suporta todos eles\), outros, como pam\_cracklib, por exemplo, s√£o adequados apenas para um \(no caso do pam\_cracklib, a facilidade 'password'\).

* **auth**: O realm 'auth' \(eu o chamo de realm - a documenta√ß√£o se refere a ele como um 'grupo de gerenciamento' ou 'facilidade'\) √© respons√°vel por verificar se o usu√°rio √© quem ele diz ser. Os m√≥dulos que podem ser listados nesta √°rea **geralmente** suportam **solicita√ß√£o de senha**.
* **account**: Esta √°rea √© respons√°vel por uma ampla variedade de poss√≠veis **funcionalidades de verifica√ß√£o de conta**. Existem muitos m√≥dulos dispon√≠veis para esta facilidade. Restri√ß√µes ao uso de um servi√ßo com base em **verifica√ß√£o de associa√ß√£o de grupo**, hora do dia, se uma conta de usu√°rio √© local ou remota, etc., geralmente s√£o aplicadas por m√≥dulos que suportam esta facilidade.
* **password**: Os m√≥dulos nesta √°rea s√£o respons√°veis por qualquer funcionalidade necess√°ria no curso de **atualiza√ß√£o de senhas** para um determinado servi√ßo. Na maioria das vezes, esta se√ß√£o √© bastante 'comum', simplesmente chamando um m√≥dulo que **solicitar√° uma senha atual**, e, assumindo que isso seja bem-sucedido, solicitar√° uma nova. Outros m√≥dulos podem ser adicionados para realizar **complexidade de senha** ou verifica√ß√£o de dicion√°rio tamb√©m, como o realizado pelos m√≥dulos pam\_cracklib e pam\_pwcheck.
* **session**: M√≥dulos nesta √°rea realizam qualquer n√∫mero de coisas que acontecem durante a **configura√ß√£o ou limpeza de um servi√ßo** para um determinado usu√°rio. Isso pode incluir qualquer n√∫mero de coisas; lan√ßando um script de inicializa√ß√£o em todo o sistema, realizando log especial, **montando o diret√≥rio home do usu√°rio**, ou definindo limites de recursos.

## **Controles de M√≥dulo PAM**

A **coluna do meio** cont√©m uma palavra-chave que essencialmente determina **o que o PAM deve fazer se o m√≥dulo tiver sucesso ou falhar**. Essas palavras-chave s√£o chamadas de '**controles**' no PAM-speak. Em 90% dos casos, voc√™ pode usar uma das palavras-chave comuns \(**requisite**, **required**, **sufficient** ou **optional**\). No entanto, isso √© apenas a ponta do iceberg em termos de liberar a flexibilidade e o poder do PAM.

* **required**: Se um m√≥dulo 'required' retorna um status que **n√£o √© 'success'**, a **opera√ß√£o sempre falhar√°**, mas somente depois que os **m√≥dulos abaixo dele forem invocados**. Isso parece sem sentido √† primeira vista, suponho, mas serve ao prop√≥sito de **sempre agir da mesma maneira do ponto de vista do usu√°rio** que tenta utilizar o servi√ßo. O efeito l√≠quido √© que se torna **imposs√≠vel** para um poss√≠vel invasor **determinar qual m√≥dulo** causou a **falha**.
* **requisite**: Se um m√≥dulo 'requisite' falhar, a **opera√ß√£o n√£o apenas falha**, mas a opera√ß√£o √© **imediatamente encerrada** com uma falha sem invocar nenhum outro m√≥dulo.
* **sufficient**: Se um m√≥dulo **sufficient** **tiver sucesso**, √© suficiente para satisfazer os requisitos de m√≥dulos suficientes nesse realm para uso do servi√ßo, e **os m√≥dulos abaixo dele que tamb√©m s√£o listados como 'sufficient' n√£o s√£o invocados**. **Se falhar, a opera√ß√£o falha, a menos que um m√≥dulo invocado ap√≥s ele tenha sucesso**.
* **optional**: Um m√≥dulo 'opcional', de acordo com a p√°gina do manual pam\(8\), **s√≥ causar√° uma opera√ß√£o falhar se for o √∫nico m√≥dulo na pilha para essa facilidade**.

## Exemplo

Em nosso arquivo de exemplo, temos quatro m√≥dulos empilhados para o realm auth:
```text
auth       required     /lib/security/pam_securetty.so
auth       required     /lib/security/pam_env.so
auth       sufficient   /lib/security/pam_ldap.so
auth       required     /lib/security/pam_unix.so try_first_pass
```
Como os m√≥dulos s√£o invocados em ordem, aqui est√° o que acontecer√°:

1. O m√≥dulo '**pam_securetty**' verificar√° seu arquivo de configura√ß√£o, **`/etc/securetty`**, e ver√° se o terminal usado para este login est√° listado no arquivo. Se **n√£o estiver, logins de root n√£o ser√£o permitidos**. Se voc√™ tentar fazer login como root em um terminal 'ruim', este m√≥dulo falhar√°. Como √© 'obrigat√≥rio', ainda invocar√° todos os m√≥dulos na pilha. No entanto, mesmo que todos eles tenham sucesso, o login falhar√°. Interessante notar que se o m√≥dulo fosse listado como 'requisito', a opera√ß√£o terminaria com uma falha imediatamente, sem invocar nenhum dos outros m√≥dulos, n√£o importando o status deles.
2. O m√≥dulo '**pam_env**' ir√° **definir vari√°veis de ambiente** com base no que o administrador configurou em /etc/security/pam_env.conf. Em uma configura√ß√£o padr√£o do Redhat 9, Fedora Core 1 e Mandrake 9.2, o arquivo de configura√ß√£o para este m√≥dulo na verdade n√£o define nenhuma vari√°vel. Um bom uso para isso pode ser definir automaticamente uma vari√°vel de ambiente DISPLAY para um usu√°rio que faz login via SSH para que eles n√£o precisem definir isso manualmente se quiserem enviar um 'xterm' de volta para sua √°rea de trabalho remota (embora isso possa ser resolvido automaticamente pelo OpenSSH).
3. O m√≥dulo '**pam_ldap**' ir√° **solicitar** a senha do usu√°rio e, em seguida, verificar o diret√≥rio ldap indicado em **`/etc/ldap.conf`** para autenticar o usu√°rio. Se isso falhar, a opera√ß√£o ainda pode ter sucesso se 'pam_unix' conseguir autenticar o usu√°rio. Se pam_ldap tiver sucesso, 'pam_unix' n√£o ser√° invocado.
4. O m√≥dulo '**pam_unix**', neste caso, **n√£o solicitar√° a senha do usu√°rio**. O argumento 'try_first_pass' dir√° ao m√≥dulo para **usar a senha fornecida pelo m√≥dulo anterior** (neste caso, pam_ldap). Ele tentar√° autenticar o usu√°rio usando as chamadas do sistema padr√£o getpw\*. Se pam_unix falhar e pam_ldap falhar, a opera√ß√£o falhar√°. Se pam_ldap falhar, mas pam_unix tiver sucesso, a opera√ß√£o ter√° sucesso (isso √© extremamente √∫til em casos em que root n√£o est√° no diret√≥rio ldap, mas ainda est√° no arquivo local /etc/passwd!).
