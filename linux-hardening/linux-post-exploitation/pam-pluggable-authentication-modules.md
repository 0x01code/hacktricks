<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Expert en √©quipe rouge AWS de HackTricks)</strong></a><strong>!</strong></summary>

Autres fa√ßons de soutenir HackTricks:

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts GitHub.

</details>


PAM est une collection de modules qui forment essentiellement une barri√®re entre un service sur votre syst√®me et l'utilisateur du service. Les modules peuvent avoir des objectifs tr√®s vari√©s, allant de l'interdiction de connexion aux utilisateurs d'un groupe UNIX particulier \(ou netgroup, ou sous-r√©seau‚Ä¶\), √† la mise en place de limites de ressources pour que votre groupe de "recherche" ne puisse pas monopoliser les ressources syst√®me.

# Fichiers de configuration

Solaris et d'autres syst√®mes UNIX commerciaux ont un mod√®le de configuration l√©g√®rement diff√©rent, centr√© autour d'un seul fichier, **`/etc/pam.conf`**. Sur la plupart des syst√®mes Linux, ces fichiers de configuration se trouvent dans **`/etc/pam.d`**, et sont nomm√©s d'apr√®s le service - par exemple, le fichier de configuration "login" s'appelle **`/etc/pam.d/login`**. Jetons un coup d'≈ìil rapide √† une version de ce fichier:
```text
auth required /lib/security/pam_securetty.so
auth required /lib/security/pam_nologin.so
auth sufficient /lib/security/pam_ldap.so
auth required /lib/security/pam_unix_auth.so try_first_pass
account sufficient /lib/security/pam_ldap.so
account required /lib/security/pam_unix_acct.so
password required /lib/security/pam_cracklib.so
password required /lib/security/pam_ldap.so
password required /lib/security/pam_pwdb.so use_first_pass
session required /lib/security/pam_unix_session.so
```
## **Royaumes de gestion PAM**

La colonne de gauche peut contenir quatre mots uniques, qui repr√©sentent quatre royaumes de gestion PAM : **auth**, **account**, **password** et **session**. Alors qu'il existe de nombreux modules qui prennent en charge plus d'un de ces royaumes \(en effet, pam\_unix prend en charge tous\), d'autres, comme pam\_cracklib par exemple, conviennent uniquement √† un seul \(dans le cas de la fonctionnalit√© ‚Äòpassword‚Äô de pam\_cracklib\).

* **auth** : Le royaume ‚Äòauth‚Äô \(je l'appelle un royaume - la documentation le d√©signe comme un ‚Äògroupe de gestion‚Äô ou une ‚Äòfacilit√©‚Äô\) est responsable de v√©rifier que l'utilisateur est bien celui qu'il pr√©tend √™tre. Les modules pouvant √™tre r√©pertori√©s dans cette zone **supportent g√©n√©ralement** la **demande de mot de passe**.
* **account** : Cette zone est responsable d'une large gamme de fonctionnalit√©s de **v√©rification de compte** possibles. De nombreux modules sont disponibles pour cette facilit√©. Les contraintes d'utilisation d'un service bas√©es sur la **v√©rification de l'appartenance √† un groupe**, l'heure de la journ√©e, que le compte utilisateur soit local ou distant, etc., sont g√©n√©ralement appliqu√©es par les modules qui prennent en charge cette facilit√©.
* **password** : Les modules de cette zone sont responsables de toute fonctionnalit√© n√©cessaire lors de la **mise √† jour des mots de passe** pour un service donn√©. La plupart du temps, cette section est assez banale, appelant simplement un module qui **demandera un mot de passe actuel**, et, en supposant que cela r√©ussisse, vous demandera d'en saisir un nouveau. D'autres modules pourraient √™tre ajout√©s pour effectuer une **complexit√© de mot de passe** ou une v√©rification de dictionnaire, comme celle effectu√©e par les modules pam\_cracklib et pam\_pwcheck.
* **session** : Les modules de cette zone effectuent un certain nombre d'actions qui se produisent soit **pendant la configuration ou la suppression d'un service** pour un utilisateur donn√©. Cela peut inclure un certain nombre de choses ; lancer un script d'initialisation √† l'√©chelle du syst√®me, effectuer une journalisation sp√©ciale, **monter le r√©pertoire personnel de l'utilisateur**, ou d√©finir des limites de ressources.

## **Contr√¥les de module PAM**

La **colonne du milieu** contient un mot-cl√© qui d√©termine essentiellement **ce que PAM doit faire si le module r√©ussit ou √©choue**. Ces mots-cl√©s sont appel√©s ‚Äò**contr√¥les**‚Äô en langage PAM. Dans 90% des cas, vous pouvez utiliser l'un des mots-cl√©s courants \(**requis**, **obligatoire**, **suffisant** ou **optionnel**\). Cependant, ce n'est que la partie √©merg√©e de l'iceberg en termes de lib√©rer la flexibilit√© et la puissance de PAM.

* **requis** : Si un module ‚Äòrequis‚Äô renvoie un statut qui n'est pas ‚Äòsucc√®s‚Äô, l'**op√©ration √©chouera toujours**, mais seulement apr√®s que les **modules en dessous de lui sont invoqu√©s**. Cela semble absurde √† premi√®re vue, je suppose, mais cela sert √† **agir toujours de la m√™me mani√®re du point de vue de l'utilisateur** essayant d'utiliser le service. L'effet net est qu'il devient **impossible** pour un √©ventuel pirate informatique de **d√©terminer** **quel** **module** a caus√© l'**√©chec**.
* **requis** : Si un module ‚Äòrequis‚Äô √©choue, l'**op√©ration** √©choue non seulement, mais l'op√©ration est **imm√©diatement** **interrompue** avec un √©chec sans invoquer d'autres modules.
* **suffisant** : Si un module **suffisant** **r√©ussit**, il suffit de satisfaire les exigences des modules suffisants dans ce royaume pour l'utilisation du service, et **les modules en dessous de lui qui sont √©galement r√©pertori√©s comme ‚Äòsuffisants‚Äô ne sont pas invoqu√©s**. **S'il √©choue, l'op√©ration √©choue √† moins qu'un module invoqu√© apr√®s lui ne r√©ussisse**.
* **optionnel** : Un module ‚Äòoptionnel‚Äô, selon la page de manuel pam\(8\), **ne provoquera un √©chec de l'op√©ration que s'il est le seul module dans la pile pour cette facilit√©**.

## Exemple

Dans notre fichier d'exemple, nous avons quatre modules empil√©s pour le royaume auth :
```text
auth       required     /lib/security/pam_securetty.so
auth       required     /lib/security/pam_env.so
auth       sufficient   /lib/security/pam_ldap.so
auth       required     /lib/security/pam_unix.so try_first_pass
```
1. Le module '**pam\_securetty**' v√©rifiera son fichier de configuration, **`/etc/securetty`**, et v√©rifiera si le terminal utilis√© pour cette connexion est r√©pertori√© dans le fichier. Si **ce n'est pas le cas, les connexions root ne seront pas autoris√©es**. Si vous essayez de vous connecter en tant que root sur un terminal 'mauvais', ce module √©chouera. Comme il est 'required', il invoquera toujours tous les modules de la pile. Cependant, m√™me si chacun d'eux r√©ussit, la connexion √©chouera. Il est int√©ressant de noter que si le module √©tait r√©pertori√© comme 'requisite', l'op√©ration se terminerait imm√©diatement par un √©chec, sans invoquer aucun des autres modules, quel que soit leur statut.
2. Le module '**pam\_env**' **d√©finira des variables d'environnement** en fonction de ce que l'administrateur a configur√© dans /etc/security/pam\_env.conf. Sur une configuration par d√©faut de Redhat 9, Fedora Core 1 et Mandrake 9.2, le fichier de configuration de ce module ne d√©finit pas r√©ellement de variables. Une bonne utilisation de cela pourrait √™tre de d√©finir automatiquement une variable d'environnement DISPLAY pour un utilisateur se connectant via SSH afin qu'ils n'aient pas √† le d√©finir eux-m√™mes s'ils veulent renvoyer un 'xterm' √† leur bureau √† distance \(bien que cela puisse √™tre pris en charge automatiquement par OpenSSH\).
3. Le module '**pam\_ldap**' **demandera** √† l'utilisateur un **mot de passe**, puis v√©rifiera le r√©pertoire ldap indiqu√© dans **`/etc/ldap.conf`** pour authentifier l'utilisateur. Si cela √©choue, l'op√©ration peut quand m√™me r√©ussir si 'pam\_unix' r√©ussit √† authentifier l'utilisateur. Si pam\_ldap r√©ussit, 'pam\_unix' ne sera pas invoqu√©.
4. Le module '**pam\_unix**', dans ce cas, ne **demandera pas √† l'utilisateur un mot de passe**. L'argument 'try\_first\_pass' indiquera au module d'**utiliser le mot de passe donn√© par le module pr√©c√©dent** \(dans ce cas, pam\_ldap\). Il essaiera d'authentifier l'utilisateur en utilisant les appels syst√®me standard getpw\*. Si pam\_unix √©choue, et pam\_ldap a √©chou√©, l'op√©ration √©chouera. Si pam\_ldap √©choue, mais pam\_unix r√©ussit, l'op√©ration r√©ussira \(ceci est extr√™mement utile dans les cas o√π root n'est pas dans le r√©pertoire ldap, mais est toujours dans le fichier local /etc/passwd!\).
