<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

- ¬øTrabajas en una **empresa de ciberseguridad**? ¬øQuieres ver tu **empresa anunciada en HackTricks**? ¬øO quieres tener acceso a la **√∫ltima versi√≥n de PEASS o descargar HackTricks en PDF**? ¬°Consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!

- Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)

- Obt√©n la [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)

- **√önete al** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠gueme** en **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**

- **Comparte tus trucos de hacking enviando PRs al [repositorio de hacktricks](https://github.com/carlospolop/hacktricks) y al [repositorio de hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>


PAM es una colecci√≥n de m√≥dulos que esencialmente forman una barrera entre un servicio en tu sistema y el usuario del servicio. Los m√≥dulos pueden tener prop√≥sitos muy variados, desde prohibir el inicio de sesi√≥n a usuarios de un grupo UNIX en particular \(o netgroup, o subnet‚Ä¶\), hasta implementar l√≠mites de recursos para que tu grupo de "investigaci√≥n" no pueda acaparar los recursos del sistema.

# Archivos de configuraci√≥n

Solaris y otros sistemas UNIX comerciales tienen un modelo de configuraci√≥n ligeramente diferente, centrado en un √∫nico archivo, **`/etc/pam.conf`**. En la mayor√≠a de los sistemas Linux, estos archivos de configuraci√≥n se encuentran en **`/etc/pam.d`**, y se nombran seg√∫n el servicio - por ejemplo, el archivo de configuraci√≥n de "login" se llama **`/etc/pam.d/login`**. Echemos un vistazo r√°pido a una versi√≥n de ese archivo:
```text
auth required /lib/security/pam_securetty.so
auth required /lib/security/pam_nologin.so
auth sufficient /lib/security/pam_ldap.so
auth required /lib/security/pam_unix_auth.so try_first_pass
account sufficient /lib/security/pam_ldap.so
account required /lib/security/pam_unix_acct.so
password required /lib/security/pam_cracklib.so
password required /lib/security/pam_ldap.so
password required /lib/security/pam_pwdb.so use_first_pass
session required /lib/security/pam_unix_session.so
```
## **Reinos de gesti√≥n de PAM**

La columna m√°s a la izquierda contiene cuatro palabras √∫nicas, que representan cuatro reinos de gesti√≥n de PAM: **auth**, **account**, **password** y **session**. Aunque hay muchos m√≥dulos que admiten m√°s de uno de estos reinos \(de hecho, pam\_unix los admite todos\), otros, como pam\_cracklib, por ejemplo, solo son adecuados para uno \(en el caso de pam\_cracklib, la facilidad de 'password'\).

* **auth**: El reino 'auth' \(lo llamo reino - los documentos se refieren a √©l como un 'grupo de gesti√≥n' o 'facilidad'\) es responsable de verificar que el usuario es quien dice ser. Los m√≥dulos que se pueden listar en esta √°rea **generalmente** admiten **solicitar una contrase√±a**.
* **account**: Esta √°rea es responsable de una amplia variedad de posibles funcionalidades de **verificaci√≥n de cuenta**. Hay muchos m√≥dulos disponibles para esta facilidad. Las restricciones para el uso de un servicio basado en **verificar la pertenencia a un grupo**, la hora del d√≠a, si una cuenta de usuario es local o remota, etc., generalmente se hacen cumplir mediante m√≥dulos que admiten esta facilidad.
* **password**: Los m√≥dulos en esta √°rea son responsables de cualquier funcionalidad necesaria en el curso de **actualizar contrase√±as** para un servicio determinado. La mayor√≠a de las veces, esta secci√≥n es bastante "normal", simplemente llamando a un m√≥dulo que **solicitar√° una contrase√±a actual**, y, suponiendo que eso sea exitoso, le pedir√° una nueva. Tambi√©n se pueden agregar otros m√≥dulos para realizar **comprobaciones de complejidad de contrase√±as** o de diccionario, como los realizados por los m√≥dulos pam\_cracklib y pam\_pwcheck.
* **session**: Los m√≥dulos en esta √°rea realizan cualquier cantidad de cosas que suceden **durante la configuraci√≥n o limpieza de un servicio** para un usuario determinado. Esto puede incluir cualquier cantidad de cosas; lanzar un script de inicializaci√≥n en todo el sistema, realizar un registro especial, **montar el directorio de inicio del usuario**, o establecer l√≠mites de recursos.

## **Controles de m√≥dulo PAM**

La **columna central** contiene una palabra clave que esencialmente determina **qu√© debe hacer PAM si el m√≥dulo tiene √©xito o falla**. Estas palabras clave se llaman 'controles' en el lenguaje de PAM. En el 90% de los casos, se puede usar una de las palabras clave comunes \(**requisite**, **required**, **sufficient** u **optional**\). Sin embargo, esto es solo la punta del iceberg en t√©rminos de liberar la flexibilidad y el poder de PAM.

* **required**: Si un m√≥dulo 'required' devuelve un estado que **no es '√©xito'**, la **operaci√≥n siempre fallar√°**, pero solo despu√©s de que se invoquen los **m√≥dulos debajo de √©l**. Esto parece sin sentido a primera vista, supongo, pero sirve para **actuar siempre de la misma manera desde el punto de vista del usuario** que intenta utilizar el servicio. El efecto neto es que se vuelve **imposible** para un posible atacante **determinar qu√© m√≥dulo caus√≥ el fallo**.
* **requisite**: Si un m√≥dulo 'requisite' falla, la **operaci√≥n no solo falla**, sino que la operaci√≥n se **termina inmediatamente** con un fallo sin invocar ning√∫n otro m√≥dulo.
* **sufficient**: Si un m√≥dulo **suficiente tiene √©xito**, es suficiente para satisfacer los requisitos de los m√≥dulos suficientes en ese reino para el uso del servicio, y **los m√≥dulos debajo de √©l que tambi√©n se enumeran como 'suficientes' no se invocan**. **Si falla, la operaci√≥n falla a menos que un m√≥dulo invocado despu√©s de que tenga √©xito**.
* **optional**: Un m√≥dulo 'opcional', seg√∫n la p√°gina del manual pam\(8\), **solo har√° que una operaci√≥n falle si es el √∫nico m√≥dulo en la pila para esa facilidad**.

## Ejemplo

En nuestro archivo de ejemplo, tenemos cuatro m√≥dulos apilados para el reino auth:
```text
auth       required     /lib/security/pam_securetty.so
auth       required     /lib/security/pam_env.so
auth       sufficient   /lib/security/pam_ldap.so
auth       required     /lib/security/pam_unix.so try_first_pass
```
Como los m√≥dulos se invocan en orden, esto es lo que suceder√°:

1. El m√≥dulo '**pam_securetty**' verificar√° su archivo de configuraci√≥n, **`/etc/securetty`**, y ver√° si el terminal que se est√° utilizando para este inicio de sesi√≥n est√° en la lista del archivo. Si **no lo est√°, no se permitir√°n los inicios de sesi√≥n de root**. Si intentas iniciar sesi√≥n como root en un terminal 'malo', este m√≥dulo fallar√°. Como es 'requerido', a√∫n invocar√° todos los m√≥dulos en la pila. Sin embargo, incluso si todos ellos tienen √©xito, el inicio de sesi√≥n fallar√°. Es interesante destacar que si el m√≥dulo se enumerara como 'requisito', la operaci√≥n terminar√≠a con un fallo inmediatamente, sin invocar ninguno de los otros m√≥dulos, sin importar cu√°l sea su estado.
2. El m√≥dulo '**pam_env**' **establecer√° variables de entorno** en funci√≥n de lo que el administrador haya configurado en /etc/security/pam_env.conf. En una configuraci√≥n predeterminada de Redhat 9, Fedora Core 1 y Mandrake 9.2, el archivo de configuraci√≥n para este m√≥dulo en realidad no establece ninguna variable. Un buen uso para esto podr√≠a ser establecer autom√°ticamente una variable de entorno DISPLAY para un usuario que inicie sesi√≥n a trav√©s de SSH para que no tenga que establecerla √©l mismo si desea enviar un 'xterm' de vuelta a su escritorio remoto (aunque esto puede ser manejado autom√°ticamente por OpenSSH).
3. El m√≥dulo '**pam_ldap**' **solicitar√°** al usuario una **contrase√±a** y luego verificar√° el directorio ldap indicado en **`/etc/ldap.conf`** para autenticar al usuario. Si esto falla, la operaci√≥n a√∫n puede tener √©xito si 'pam_unix' tiene √©xito en autenticar al usuario. Si pam_ldap tiene √©xito, 'pam_unix' no se invocar√°.
4. El m√≥dulo '**pam_unix**', en este caso, **no solicitar√° al usuario una contrase√±a**. El argumento 'try_first_pass' le indicar√° al m√≥dulo que **use la contrase√±a que le dio el m√≥dulo anterior** (en este caso, pam_ldap). Intentar√° autenticar al usuario utilizando las llamadas al sistema est√°ndar getpw\*. Si pam_unix falla y pam_ldap ha fallado, la operaci√≥n fallar√°. Si pam_ldap falla pero pam_unix tiene √©xito, la operaci√≥n tendr√° √©xito (¬°esto es extremadamente √∫til en casos en los que root no est√° en el directorio ldap, pero a√∫n est√° en el archivo local /etc/passwd!).
