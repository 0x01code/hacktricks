# Linux Sonrası Sızma

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sıfırdan kahraman olmak için AWS hackleme öğrenin<strong>!</strong></summary>

HackTricks'i desteklemenin diğer yolları:

* Şirketinizi HackTricks'te **reklamınızı görmek** veya **HackTricks'i PDF olarak indirmek** için [**ABONELİK PLANLARI**](https://github.com/sponsors/carlospolop)'na göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) keşfedin, özel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın** veya **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)'ı **takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına **PR göndererek paylaşın**.

</details>

## PAM ile Oturum Açma Parolalarını Yakalamak

Her kullanıcının giriş yaparken kullandığı her parolayı kaydetmek için bir PAM modülü yapılandıralım. PAM nedir bilmiyorsanız:

{% content-ref url="pam-pluggable-authentication-modules.md" %}
[pam-pluggable-authentication-modules.md](pam-pluggable-authentication-modules.md)
{% endcontent-ref %}

**Daha fazla ayrıntı için [orijinal yayına](https://embracethered.com/blog/posts/2022/post-exploit-pam-ssh-password-grabbing/) bakın**. İşte sadece bir özet:

**Teknik Genel Bakış:**
Pluggable Authentication Modules (PAM), Unix tabanlı sistemlerde kimlik doğrulama yönetiminde esneklik sunar. Giriş süreçlerini özelleştirerek güvenliği artırabilirler, ancak yanlış kullanılırsa risk oluşturabilirler. Bu özet, PAM kullanarak giriş kimlik bilgilerini yakalamak için bir teknik ve azaltma stratejilerini açıklar.

**Kimlik Bilgilerini Yakalama:**
- `toomanysecrets.sh` adında bir bash betiği, giriş denemelerini kaydetmek için oluşturulur ve tarih, kullanıcı adı (`$PAM_USER`), parola (stdin aracılığıyla) ve uzak ana bilgisayar IP'si (`$PAM_RHOST`) bilgilerini `/var/log/toomanysecrets.log` dosyasına kaydeder.
- Betik çalıştırılabilir hale getirilir ve `pam_exec.so` modülü kullanılarak PAM yapılandırmasına (`common-auth`) entegre edilir. Betiğe sessizce çalıştırma ve kimlik doğrulama belirtecinin betiğe açık olmasını sağlayan seçenekler eklenir.
- Bu yaklaşım, bir Linux ana bilgisayarın nasıl istismar edilerek kimlik bilgilerinin gizlice kaydedilebileceğini gösterir.
```bash
#!/bin/sh
echo " $(date) $PAM_USER, $(cat -), From: $PAM_RHOST" >> /var/log/toomanysecrets.log
sudo touch /var/log/toomanysecrets.sh
sudo chmod 770 /var/log/toomanysecrets.sh
sudo nano /etc/pam.d/common-auth
# Add: auth optional pam_exec.so quiet expose_authtok /usr/local/bin/toomanysecrets.sh
sudo chmod 700 /usr/local/bin/toomanysecrets.sh
```
### PAM'e Arka Kapı Ekleme

**Daha fazla ayrıntı için [orijinal yazıya](https://infosecwriteups.com/creating-a-backdoor-in-pam-in-5-line-of-code-e23e99579cd9) bakın**. İşte sadece bir özet:

Pluggable Authentication Module (PAM), Linux altında kullanıcı kimlik doğrulaması için kullanılan bir sistemdir. Üç temel kavram üzerinde çalışır: **kullanıcı adı**, **parola** ve **hizmet**. Her hizmet için yapılandırma dosyaları `/etc/pam.d/` dizininde bulunur ve kimlik doğrulamasını paylaşılan kütüphaneler yönetir.

**Amaç**: PAM'ı değiştirerek, gerçek kullanıcı parolasını atlayarak belirli bir parola ile kimlik doğrulamasına izin vermek. Bu özellikle, neredeyse tüm hizmetler için parola doğrulaması için kullanılan `common-auth` dosyası tarafından dahil edilen `pam_unix.so` paylaşılan kütüphanesine odaklanır.

### `pam_unix.so`'yu Değiştirme Adımları:

1. `common-auth` dosyasında **Kimlik Doğrulama Yönergesini** bulun:
- Kullanıcının parolasını kontrol eden satır `pam_unix.so`'yu çağırır.
2. **Kaynak Kodunu Değiştirin**:
- `pam_unix_auth.c` kaynak dosyasına, önceden tanımlanmış bir parola kullanılıyorsa erişimi sağlayan bir koşullu ifade ekleyin, aksi takdirde normal kimlik doğrulama sürecine devam eder.
3. Değiştirilmiş `pam_unix.so` kütüphanesini uygun dizine **yeniden derleyin ve değiştirin**.
4. **Test Etme**:
- Önceden tanımlanmış parola ile çeşitli hizmetlere (giriş, ssh, sudo, su, ekran koruyucu) erişim sağlanırken, normal kimlik doğrulama süreçleri etkilenmez.

{% hint style="info" %}
Bu süreci [https://github.com/zephrax/linux-pam-backdoor](https://github.com/zephrax/linux-pam-backdoor) ile otomatikleştirebilirsiniz.
{% endhint %}

<details>

<summary><strong>AWS hacklemeyi sıfırdan kahraman olmak için</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>'ı öğrenin!</strong></summary>

HackTricks'i desteklemenin diğer yolları:

* Şirketinizi HackTricks'te **reklamınızı görmek** veya HackTricks'i **PDF olarak indirmek** için [**ABONELİK PLANLARINA**](https://github.com/sponsors/carlospolop) göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* Özel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluşan koleksiyonumuz [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'yi keşfedin
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın** veya bizi **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**'ı takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına **PR göndererek paylaşın**.

</details>
