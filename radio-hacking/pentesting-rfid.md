# RFIDのペンテスト

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks Cloud ☁️</strong></a> - <a href="https://twitter.com/hacktricks_live"><strong>🐦 Twitter 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 Youtube 🎥</strong></a></summary>

* **サイバーセキュリティ企業**で働いていますか？ **HackTricksで企業を宣伝**したいですか？または、**PEASSの最新バージョンを入手**したいですか？または、HackTricksをPDFでダウンロードしたいですか？[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[NFTs](https://opensea.io/collection/the-peass-family)のコレクションを入手しましょう
* [**公式PEASS＆HackTricksのグッズ**](https://peass.creator-spring.com)を手に入れましょう
* **[💬](https://emojipedia.org/speech-balloon/) Discordグループ**に参加するか、[**telegramグループ**](https://t.me/peass)に参加するか、**Twitter** **🐦**[**@carlospolopm**](https://twitter.com/hacktricks_live)**をフォロー**してください。
* **ハッキングトリックを共有するには、**[**hacktricksリポジトリ**](https://github.com/carlospolop/hacktricks) **と** [**hacktricks-cloudリポジトリ**](https://github.com/carlospolop/hacktricks-cloud) **にPRを提出**してください。

</details>

## はじめに

**無線周波数識別（RFID）**は最も一般的な短距離無線ソリューションです。通常、エンティティを識別する情報を格納および送信するために使用されます。

RFIDタグは、**独自の電源（アクティブ）**（埋め込みバッテリーなど）に依存するか、受信アンテナからの電流を使用して受信した無線波から**誘導された電流（パッシブ）**を受け取ることができます。

### クラス

EPCglobalはRFIDタグを6つのカテゴリに分類しています。各カテゴリのタグには、前のカテゴリにリストされているすべての機能が備わっており、後方互換性があります。

* **クラス0**タグは、**UHF**バンドで動作する**パッシブ**タグです。ベンダーは製造工場で事前にプログラムします。そのため、メモリに格納された情報を**変更できません**。
* **クラス1**タグは**HF**バンドでも動作できます。さらに、製造後に**1回だけ書き込む**ことができます。多くのクラス1タグは、受信したコマンドの**巡回冗長検査（CRC）**を処理できます。CRCは、エラー検出のためにコマンドの末尾にいくつかの追加バイトが含まれます。
* **クラス2**タグは**複数回書き込む**ことができます。
* **クラス3**タグには、現在の温度やタグの動きなどの環境パラメータを記録できる**埋め込みセンサ**が含まれることがあります。これらのタグは**半パッシブ**であり、組み込み**バッテリー**などの埋め込み電源を持っているため、他のタグやリーダーと**ワイヤレス通信を開始**することはできません。
* **クラス4**タグは、同じクラスの他のタグと通信を開始できるため、**アクティブタグ**です。
* **クラス5**タグは、他のすべての前のタグクラスと通信し、**RFIDリーダー**として機能することができます。

### RFIDタグに格納される情報

RFIDタグのメモリには通常、次の4種類のデータが格納されます：**エンティティ**を識別する**識別データ**（このデータには銀行口座などのユーザー定義フィールドが含まれる）；**エンティティに関する詳細**を提供する**補足データ**；タグの内部**構成**に使用される**制御データ**；およびタグの**製造業者データ**で、タグの**一意の識別子（UID）**と製造、タイプ、ベンダーに関する詳細が含まれます。最初の2種類のデータはすべての商用タグに見られ、最後の2種類はタグのベンダーに基づいて異なる場合があります。

ISO標準は、タグが属する**オブジェクトの種類**を示すコードである**アプリケーションファミリー識別子（AFI）**値を指定しています。 ISOによって指定されたもう1つの重要なレジスタは、**ユーザーデータの論理的な組織**を定義する**データストレージフォーマット識別子（DSFID）**です。

ほとんどのRFID **セキュリティコントロール**には、各ユーザーメモリブロックとAFIおよびDSFID値を含む特別なレジスタへの**読み取り**または**書き込み**操作を**制限**するメカニズムがあります。これらの**ロック**メカニズムは、制御メモリに格納されたデータを使用し、ベンダーによって事前に設定された**デフォルトパスワード**を使用しますが、タグ所有者が**カスタムパスワードを設定**できるようにします。

### 低周波数タグと高周波数タグの比較

<figure><img src="../.gitbook/assets/image (27).png" alt=""><figcaption></figcaption></figure>

## 低周波数RFIDタグ（125kHz）

**低周波数タグ**は、高いセキュリティが必要とされないシステムでよく使用されます：建物へのアクセス、インターコムキー、ジムの会員カードなど。より長い範囲を持つため、有料の駐車場での使用に便利です：ドライバーはカードをリーダーに近づける必要がなく、遠くからトリガーされます。同時に、低周波数タグは非常に原始的であり、データ転送速度が低いです。そのため、残高管理や暗号化などの複雑な双方向データ転送を実装することは不可能です。低周波数タグは認証手段を持たず、短いIDのみを送信します。

これらのデバイスは**パッシブRFID**技術に依存し、**30 kHzから300 kHz**の範囲で動作しますが、**125 kHzから134 kHz**を使用することがより一般的です：

* **長距離** — 低い周波数は長い距離に翻訳されます。1メートルまでの距離から動作するEM-MarinやHIDリーダーがあります。これらはよく駐車場で使用されます。
* **原始的なプロトコル** — 低いデータ転送速度のため、これらのタグは短いIDのみを送信できます。ほとんどの場合、データは認証されず、保護されていません。カードがリーダーの範囲内にあるとすぐにIDの送信が開始されます。
* **低いセキュリティ** — これらのカードは簡単にコピーでき、プロトコルの原始性のため、他の人のポケットから読み取ることさえ可能です。

**人気のある125 kHzプロトコル：**

* **EM-Marin** — EM4100、EM4102。CISで最も人気のあるプロトコル。シンプルさと安定性のため、約1メートルから読み取ることができます。
* **HID Prox II** — HID Globalが導入した低周波数プロトコル。このプロトコルは西洋諸国でより人気があります。比較的高価なカードやリーダーがあります。
* **Indala** — Motorolaが導入し、後にHIDが取得した非常に古い低周波数プロトコル。前述の2つと比較して、野生で遭遇する可能性は低いです。

実際には、他にも多くの低周波数プロトコルがあります。しかし、これらはすべて物理層で同じ変調を使用し、上記にリストされたもののいずれかの変形と見なすことができます。

### 攻撃

**Flipper Zero**を使用してこれらのタグを**攻撃**することができます：

{% content-ref url="../todo/radio-hacking/flipper-zero/fz-125khz-rfid.md" %}
[fz-125khz-rfid.md](../todo/radio-hacking/flipper-zero/fz-125khz-rfid.md)
{% endcontent-ref %}

## 高周波数RFIDタグ（13.56 MHz）

**高周波数タグ**は、暗号化、大規模な双方向データ転送、認証などが必要な複雑なリーダータグの相互作用に使用されます。\
銀行カード、公共交通機関、その他のセキュアパスで見つけることができます。

**高周波数13.56 MHzタグは、標準とプロトコルのセット**です。通常、これらは[NFC](https://nfc-forum.org/what-is-nfc/about-the-technology/)と呼ばれますが、それが常に正しいとは限りません。物理的および論理的レベルで使用される基本プロトコルセットはISO 14443です。高レベルのプロトコルやISO 19092などの代替標準は、これに基づいています。多くの人々は、この技術を**近距離通信（NFC）**と呼びますが、これは13.56 MHz周波数で動作するデバイスのための用語です。

<figure><img src="../.gitbook/assets/image (22).png" alt=""><figcaption></figcaption></figure>

簡単に言うと、NFCのアーキテクチャは次のように機能します：カードを製造する会社が送信プロトコルを選択し、ISO 14443に基づいて実装します。たとえば、NXPはMifareと呼ばれる独自の高レベル送信プロトコルを発明しました。ただし、MifareカードはISO 14443-A標準に基づいています。

Flipperは、低レベルのISO 14443プロトコル、Mifare Ultralightデータ転送プロトコル、および銀行カードで使用されるEMVのサポートを追加する作業を行っています。Mifare ClassicとNFC NDEFのサポートを追加する予定です。NFCを構成するプロトコルと標準についての詳細な説明は、後日別の記事で紹介する予定です。

ISO 14443-A標準に基づくすべての高周波数カードにはユニークなチップIDがあります。これは、ネットワークカードのMACアドレスのようにカードのシリアル番号として機能します。**通常、UIDは4または7バイト**ですが、**最大で10バイト**になることもあります。UIDは秘密ではなく、**カード自体に印刷されていることさえあります**。

UIDを使用して**認証してアクセスを許可**するアクセス制御システムが多数あります。時には、これはRFIDタグが**暗号化**をサポートしている場合でも発生します。このような**誤用**により、セキュリティの点で125 kHzカードと同じレベルに引き下げられます。仮想カード（Apple Payなど）は、電話所有者が支払いアプリでドアを開けることがないように、動的UIDを使用します。

* **短い範囲** — 高周波数カードはリーダーに近づける必要があるように設計されています。これにより、不正な操作からカードを保護するのに役立ちます。私たちが達成した最大の読み取り範囲は約15 cmで、これはカスタム製の長距離リーダーを使用した場合です。
* **高度なプロトコル** — 最大424 kbpsのデータ転送速度により、完全な双方向データ転送を備えた複雑なプロトコ
