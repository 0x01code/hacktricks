# Pentesting RFID

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* ¬øTrabajas en una **empresa de ciberseguridad**? ¬øQuieres ver tu **empresa anunciada en HackTricks**? ¬øO quieres tener acceso a la **√∫ltima versi√≥n de PEASS o descargar HackTricks en PDF**? ¬°Consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obt√©n la [**ropa oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* **√önete al** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠gueme** en **Twitter** **üê¶**[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Comparte tus trucos de hacking enviando PRs al** [**repositorio de hacktricks**](https://github.com/carlospolop/hacktricks) **y** [**repositorio de hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Introducci√≥n

**Identificaci√≥n por Radiofrecuencia (RFID)** es la soluci√≥n de radio de corto alcance m√°s popular. Se utiliza generalmente para almacenar y transmitir informaci√≥n que identifica una entidad.

Una etiqueta RFID puede depender de **su propia fuente de energ√≠a (activa)**, como una bater√≠a integrada, o recibir su energ√≠a de la antena de lectura utilizando la corriente **inducida por las ondas de radio recibidas** (**pasiva**).

### Clases

EPCglobal divide las etiquetas RFID en seis categor√≠as. Una etiqueta en cada categor√≠a tiene todas las capacidades enumeradas en la categor√≠a anterior, lo que la hace compatible con versiones anteriores.

* Las etiquetas de **Clase 0** son etiquetas **pasivas** que operan en bandas de **UHF**. El proveedor las **preprograma** en la f√°brica de producci√≥n. Como resultado, **no puedes cambiar** la informaci√≥n almacenada en su memoria.
* Las etiquetas de **Clase 1** tambi√©n pueden operar en bandas **HF**. Adem√°s, solo se pueden **escribir una vez** despu√©s de la producci√≥n. Muchas etiquetas de Clase 1 tambi√©n pueden procesar **comprobaciones de redundancia c√≠clica** (CRC) de los comandos que reciben. Los CRC son unos bytes adicionales al final de los comandos para la detecci√≥n de errores.
* Las etiquetas de **Clase 2** se pueden **escribir varias veces**.
* Las etiquetas de **Clase 3** pueden contener **sensores integrados** que pueden registrar par√°metros ambientales, como la temperatura actual o el movimiento de la etiqueta. Estas etiquetas son **semipasivas**, porque aunque **tienen** una fuente de energ√≠a integrada, como una **bater√≠a**, **no pueden iniciar** la **comunicaci√≥n** inal√°mbrica con otras etiquetas o lectores.
* Las etiquetas de **Clase 4** pueden iniciar la comunicaci√≥n con otras etiquetas de la misma clase, lo que las convierte en etiquetas **activas**.
* Las etiquetas de **Clase 5** pueden proporcionar **energ√≠a a otras etiquetas y comunicarse con todas las clases de etiquetas anteriores**. Las etiquetas de Clase 5 pueden actuar como **lectores RFID**.

### Informaci√≥n Almacenada en Etiquetas RFID

La memoria de una etiqueta RFID generalmente almacena cuatro tipos de datos: los **datos de identificaci√≥n**, que **identifican** la **entidad** a la que est√° adjunta la etiqueta (estos datos incluyen campos definidos por el usuario, como cuentas bancarias); los **datos complementarios**, que proporcionan **m√°s detalles** sobre la entidad; los **datos de control**, utilizados para la **configuraci√≥n** interna de la etiqueta; y los **datos del fabricante de la etiqueta**, que contienen un Identificador √önico de la etiqueta (**UID**) y detalles sobre la **producci√≥n**, **tipo** y **proveedor** de la etiqueta. Encontrar√°s los dos primeros tipos de datos en todas las etiquetas comerciales; los dos √∫ltimos pueden diferir seg√∫n el proveedor de la etiqueta.

El est√°ndar ISO especifica el valor del Identificador de Familia de Aplicaci√≥n (**AFI**), un c√≥digo que indica el **tipo de objeto** al que pertenece la etiqueta. Otro registro importante, tambi√©n especificado por ISO, es el Identificador de Formato de Almacenamiento de Datos (**DSFID**), que define la **organizaci√≥n l√≥gica de los datos de usuario**.

La mayor√≠a de los **controles de seguridad** de RFID tienen mecanismos que **restringen** las operaciones de **lectura** o **escritura** en cada bloque de memoria de usuario y en los registros especiales que contienen los valores AFI y DSFID. Estos **mecanismos de bloqueo** utilizan datos almacenados en la memoria de control y tienen **contrase√±as predeterminadas** preconfiguradas por el proveedor pero permiten a los propietarios de las etiquetas **configurar contrase√±as personalizadas**.

### Comparaci√≥n de etiquetas de baja y alta frecuencia

<figure><img src="../.gitbook/assets/image (27).png" alt=""><figcaption></figcaption></figure>

## Etiquetas RFID de Baja Frecuencia (125kHz)

Las **etiquetas de baja frecuencia** se utilizan a menudo en sistemas que **no requieren alta seguridad**: acceso a edificios, llaves de intercomunicador, tarjetas de membres√≠a de gimnasios, etc. Debido a su mayor alcance, son convenientes para su uso en estacionamientos de pago: el conductor no necesita acercar la tarjeta al lector, ya que se activa desde m√°s lejos. Al mismo tiempo, las etiquetas de baja frecuencia son muy primitivas, tienen una baja tasa de transferencia de datos. Por esa raz√≥n, es imposible implementar una transferencia de datos bidireccional compleja para cosas como mantener un saldo y criptograf√≠a. Las etiquetas de baja frecuencia solo transmiten su ID corto sin ning√∫n medio de autenticaci√≥n.

Estos dispositivos se basan en la tecnolog√≠a **RFID** **pasiva** y operan en un **rango de 30 kHz a 300 kHz**, aunque es m√°s com√∫n usar 125 kHz a 134 kHz:

* **Largo alcance** ‚Äî una frecuencia m√°s baja se traduce en un mayor alcance. Hay algunos lectores EM-Marin y HID, que funcionan desde una distancia de hasta un metro. A menudo se utilizan en estacionamientos de autom√≥viles.
* **Protocolo primitivo** ‚Äî debido a la baja tasa de transferencia de datos, estas etiquetas solo pueden transmitir su ID corto. En la mayor√≠a de los casos, los datos no est√°n autenticados y no est√°n protegidos de ninguna manera. Tan pronto como la tarjeta est√° dentro del alcance del lector, comienza a transmitir su ID.
* **Baja seguridad** ‚Äî Estas tarjetas pueden ser f√°cilmente copiadas, o incluso le√≠das desde el bolsillo de otra persona debido a la primitividad del protocolo.

**Protocolos populares de 125 kHz:**

* **EM-Marin** ‚Äî EM4100, EM4102. El protocolo m√°s popular en la CEI. Puede leerse desde aproximadamente un metro debido a su simplicidad y estabilidad.
* **HID Prox II** ‚Äî protocolo de baja frecuencia introducido por HID Global. Este protocolo es m√°s popular en los pa√≠ses occidentales. Es m√°s complejo y las tarjetas y lectores para este protocolo son relativamente caros.
* **Indala** ‚Äî protocolo de baja frecuencia muy antiguo que fue introducido por Motorola, y luego adquirido por HID. Es menos probable que te encuentres con √©l en la naturaleza en comparaci√≥n con los dos anteriores porque est√° cayendo en desuso.

En realidad, hay muchos m√°s protocolos de baja frecuencia. Pero todos utilizan la misma modulaci√≥n en la capa f√≠sica y pueden considerarse, de una forma u otra, una variaci√≥n de los mencionados anteriormente.

### Ataque

Puedes **atacar estas etiquetas con el Flipper Zero**:

{% content-ref url="../todo/radio-hacking/flipper-zero/fz-125khz-rfid.md" %}
[fz-125khz-rfid.md](../todo/radio-hacking/flipper-zero/fz-125khz-rfid.md)
{% endcontent-ref %}

## Etiquetas RFID de Alta Frecuencia (13.56 MHz)

Las **etiquetas de alta frecuencia** se utilizan para una interacci√≥n m√°s compleja entre lector y etiqueta cuando se necesita criptograf√≠a, una gran transferencia de datos bidireccional, autenticaci√≥n, etc.\
Generalmente se encuentran en tarjetas bancarias, transporte p√∫blico y otros pases seguros.

**Las etiquetas de alta frecuencia de 13.56 MHz son un conjunto de est√°ndares y protocolos**. Por lo general, se les llama [NFC](https://nfc-forum.org/what-is-nfc/about-the-technology/), pero eso no siempre es correcto. El conjunto b√°sico de protocolos utilizado en los niveles f√≠sico y l√≥gico es ISO 14443. Los protocolos de alto nivel, as√≠ como los est√°ndares alternativos (como ISO 19092), se basan en √©l. Muchas personas se refieren a esta tecnolog√≠a como **Near Field Communication (NFC)**, un t√©rmino para dispositivos que operan sobre la frecuencia de 13.56 MHz.

<figure><img src="../.gitbook/assets/image (22).png" alt=""><figcaption></figcaption></figure>

Para simplificar, la arquitectura de NFC funciona de la siguiente manera: el protocolo de transmisi√≥n es elegido por la empresa que fabrica las tarjetas e implementado en base al est√°ndar de transmisi√≥n de bajo nivel ISO 14443. Por ejemplo, NXP invent√≥ su propio protocolo de transmisi√≥n de alto nivel llamado Mifare. Pero en un nivel inferior, las tarjetas Mifare se basan en el est√°ndar ISO 14443-A.

Flipper puede interactuar tanto con el protocolo de transmisi√≥n ISO 14443 de bajo nivel, como con el protocolo de transferencia de datos Mifare Ultralight y EMV utilizado en tarjetas bancarias. Estamos trabajando en agregar soporte para Mifare Classic y NFC NDEF. Una mirada detallada a los protocolos y est√°ndares que componen NFC vale la pena en un art√≠culo separado que planeamos publicar m√°s adelante.

Todas las tarjetas de alta frecuencia basadas en el est√°ndar ISO 14443-A tienen un ID de chip √∫nico. Act√∫a como el n√∫mero de serie de la tarjeta, como la direcci√≥n MAC de una tarjeta de red. **Por lo general, el UID tiene una longitud de 4 o 7 bytes**, pero rara vez puede llegar **hasta 10**. Los UIDs no son un secreto y se pueden leer f√°cilmente, **a veces incluso impresos en la tarjeta misma**.

Hay muchos sistemas de control de acceso que dependen del UID para **autenticar y otorgar acceso**. A veces esto sucede **incluso** cuando las etiquetas RFID **soportan criptograf√≠a**. Este **mal uso** las reduce al nivel de las tarjetas **125 kHz** tontas en t√©rminos de **seguridad**. Las tarjetas virtuales (como Apple Pay) utilizan un UID din√°mico para que los propietarios de tel√©fonos no abran puertas con su aplicaci√≥n de pago.

* **Corto alcance** ‚Äî las tarjetas de alta frecuencia est√°n dise√±adas espec√≠ficamente para que deban colocarse cerca del lector. Esto tambi√©n ayuda a proteger la tarjeta de interacciones no autorizadas. El alcance m√°ximo de lectura que logramos fue de aproximadamente 15 cm, y eso fue con lectores de largo alcance hechos a medida.
* **Protocolos avanzados** ‚Äî velocidades de transferencia de datos de hasta 424 kbps permiten protocolos complejos con transferencia de datos bidireccional completa. Lo que a su vez **permite la criptograf√≠a**, transferencia de datos, etc.
* **Alta seguridad** ‚Äî las tarjetas sin contacto de alta frecuencia no son inferiores en absoluto a las tarjetas inteligentes. Hay tarjetas que admiten algoritmos criptogr√°ficos fuertes como AES e implementan criptograf√≠a asim√©trica.

### Ataque

Puedes **atacar estas etiquetas con el Flipper Zero**:

{% content-ref url="../todo/radio-hacking/flipper-zero/fz-nfc.md" %}
[fz-nfc.md](../todo/radio-hacking/flipper-zero/fz-nfc.md)
{% endcontent-ref %}

O utilizando el **proxmark**:

{% content-ref url="../todo/radio-hacking/proxmark-3.md" %}
[proxmark-3.md](../todo/radio-hacking/proxmark-3.md)
{% endcontent-ref %}

## Referencias

* [https://blog.flipperzero.one/rfid/](https://blog.flipperzero.one/rfid/)

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* ¬øTrabajas en una **empresa de ciberseguridad**? ¬øQuieres ver tu **empresa anunciada en HackTricks**? ¬øO quieres tener acceso a la **√∫ltima versi√≥n de PEASS o descargar HackTricks en PDF**? ¬°Consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obt√©n la [**ropa oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* **√önete al** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠gueme** en **Twitter** **üê¶**[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Comparte tus trucos de hacking enviando PRs al** [**repositorio de hacktricks**](https://github.com/carlospolop/hacktricks) **y** [**repositorio de hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
