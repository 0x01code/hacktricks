<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks Cloud ☁️</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>🐦 Twitter 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 Youtube 🎥</strong></a></summary>

- **サイバーセキュリティ企業**で働いていますか？ **HackTricksで会社を宣伝**したいですか？または、**PEASSの最新バージョンにアクセスしたり、HackTricksをPDFでダウンロード**したいですか？[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！

- [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見しましょう。独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクションです。

- [**公式のPEASS＆HackTricksのグッズ**](https://peass.creator-spring.com)を手に入れましょう。

- [**💬**](https://emojipedia.org/speech-balloon/) [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**telegramグループ**](https://t.me/peass)に**参加**するか、**Twitter**で**フォロー**してください[**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**。**

- **ハッキングのトリックを共有するには、[hacktricksリポジトリ](https://github.com/carlospolop/hacktricks)と[hacktricks-cloudリポジトリ](https://github.com/carlospolop/hacktricks-cloud)にPRを提出してください。**

</details>


# はじめに

Bluetooth 4.0の仕様から利用可能なBLEは、2400〜2483.5 MHzの範囲で40チャンネルのみを使用します。一方、従来のBluetoothは同じ範囲で79チャンネルを使用します。

BLEデバイスは、**広告パケット**（**ビーコン**）を送信することで、他の近くのデバイスにBLEデバイスの存在を伝えます。これらのビーコンは、時には**データを送信**することもあります。

リスニングデバイス（またはセントラルデバイス）は、広告パケットに対して**スキャンリクエスト**を送信することで、広告デバイスに特定のスキャンを行うことができます。そのスキャンへの**応答**は、初期の広告リクエストに収まらなかった追加情報を含む、同じ構造の**広告**パケットを使用します。追加情報には、デバイスの完全なデバイス名などが含まれます。

![](<../.gitbook/assets/image (201) (2) (1) (1).png>)

プリアンブルバイトは周波数を同期させ、4バイトのアクセスアドレスは複数のデバイスが同じチャンネルで接続を確立しようとするシナリオで使用される**接続識別子**です。次に、プロトコルデータユニット（**PDU**）には**広告データ**が含まれます。いくつかの種類のPDUがありますが、最も一般的に使用されるのはADV\_NONCONN\_INDとADV\_INDです。デバイスは、**接続を受け入れない**場合は**ADV\_NONCONN\_IND** PDUタイプを使用し、データを広告パケットのみで送信します。デバイスは、**接続を許可**し、**接続**が**確立**されると**広告**パケットの送信を停止する場合は**ADV\_IND**を使用します。

## GATT

**Generic Attribute Profile**（GATT）は、**デバイスがデータをどのようにフォーマットし、転送するか**を定義します。BLEデバイスの攻撃対象を分析する際には、GATT（またはGATTs）に注目することが多いです。なぜなら、デバイスの機能がトリガーされ、データが格納、グループ化、変更される方法がGATTによって決まるからです。GATTは、デバイスの特性、ディスクリプタ、およびサービスを16ビットまたは32ビットの値として表すテーブルとしてリストアップされます。**特性**は、セントラルデバイスとペリフェラル間で**送信**される**データ値**です。これらの特性には、**それに関する追加情報を提供するディスクリプタ**があります。**特性**は、特定のアクションを実行するために関連している場合、**サービス**に**グループ化**されることがよくあります。

# 列挙化
```bash
hciconfig #Check config, check if UP or DOWN
# If DOWN try:
sudo modprobe -c bluetooth
sudo hciconfig hci0 down && sudo hciconfig hci0 up

# Spoof MAC
spooftooph -i hci0 -a 11:22:33:44:55:66
```
## GATTool

**GATTool**は、他のデバイスとの**接続**を**確立**し、そのデバイスの**特性**をリストし、属性の読み書きを行うことができます。\
GATTToolは、`-I`オプションを使用して対話型シェルを起動することができます。
```bash
gatttool -i hci0 -I
[ ][LE]> connect 24:62:AB:B1:A8:3E Attempting to connect to A4:CF:12:6C:B3:76 Connection successful
[A4:CF:12:6C:B3:76][LE]> characteristics
handle: 0x0002, char properties: 0x20, char value handle:
0x0003, uuid: 00002a05-0000-1000-8000-00805f9b34fb
handle: 0x0015, char properties: 0x02, char value handle:
0x0016, uuid: 00002a00-0000-1000-8000-00805f9b34fb
[...]

# Write data
gatttool -i <Bluetooth adapter interface> -b <MAC address of device> --char-write-req <characteristic handle> -n <value>
gatttool -b a4:cf:12:6c:b3:76 --char-write-req -a 0x002e -n $(echo -n "04dc54d9053b4307680a"|xxd -ps)

# Read data
gatttool -i <Bluetooth adapter interface> -b <MAC address of device> --char-read -a 0x16

# Read connecting with an authenticated encrypted connection
gatttool --sec-level=high -b a4:cf:12:6c:b3:76 --char-read -a 0x002c
```
## Bettercap

Bettercapは、Bluetooth Low Energy（BLE）デバイスのペネトレーションテストに使用される強力なツールです。このツールは、BLEデバイスのスキャン、スニッフィング、スプーフィング、およびMITM（Man-in-the-Middle）攻撃など、さまざまな攻撃手法をサポートしています。

Bettercapを使用すると、BLEデバイスのセキュリティに関する脆弱性を特定し、悪用することができます。例えば、デバイスのMACアドレスをスプーフィングして、デバイスとの通信を傍受したり、改ざんしたりすることができます。

Bettercapは、コマンドラインインターフェース（CLI）を提供しており、シンプルで使いやすい操作性を備えています。さらに、プラグインシステムを使用して、機能を拡張することもできます。

Bettercapは、BLEデバイスのセキュリティ評価やペネトレーションテストにおいて、非常に有用なツールです。その強力な機能と柔軟性により、セキュリティ専門家やハッカーは、BLEデバイスの脆弱性を特定し、適切な対策を講じることができます。
```bash
# Start listening for beacons
sudo bettercap --eval "ble.recon on"
# Wait some time
>> ble.show # Show discovered devices
>> ble.enum <mac addr> # This will show the service, characteristics and properties supported

# Write data in a characteristic
>> ble.write <MAC ADDR> <UUID> <HEX DATA>
>> ble.write <mac address of device> ff06 68656c6c6f # Write "hello" in ff06
```
<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks Cloud ☁️</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>🐦 Twitter 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 Youtube 🎥</strong></a></summary>

- **サイバーセキュリティ会社**で働いていますか？ **HackTricksで会社を宣伝**したいですか？または、**PEASSの最新バージョンにアクセスしたり、HackTricksをPDFでダウンロード**したいですか？[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！

- [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を見つけてください。独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクションです。

- [**公式のPEASS＆HackTricksのグッズ**](https://peass.creator-spring.com)を手に入れましょう。

- [**💬**](https://emojipedia.org/speech-balloon/) [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**telegramグループ**](https://t.me/peass)に**参加**するか、**Twitter**で私を**フォロー**してください[**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**

- **ハッキングのトリックを共有するには、[hacktricksリポジトリ](https://github.com/carlospolop/hacktricks)と[hacktricks-cloudリポジトリ](https://github.com/carlospolop/hacktricks-cloud)**にPRを提出してください。

</details>
