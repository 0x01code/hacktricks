<details>

<summary><strong>AWSハッキングをゼロからヒーローまで学ぶ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>！</strong></summary>

HackTricksをサポートする他の方法:

* **HackTricksにあなたの会社を広告したい**、または**HackTricksをPDFでダウンロードしたい**場合は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS & HackTricksグッズ**](https://peass.creator-spring.com)を入手する
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクションをチェックする
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)に**参加する**か、[**テレグラムグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)を**フォローする**。
* **HackTricks**の[**GitHubリポジトリ**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)にPRを提出して、あなたのハッキングテクニックを共有する。

</details>


# はじめに

Bluetooth 4.0仕様から利用可能なBLEは、2400から2483.5 MHzの範囲をカバーする40チャンネルのみを使用します。これに対し、従来のBluetoothは同じ範囲で79チャンネルを使用します。

BLEデバイスが通信する方法は、**アドバタイジングパケット**（**ビーコン**）を送信することです。これらのパケットは、BLEデバイスの存在を近くの他のデバイスにブロードキャストします。これらのビーコンは時々**データを送信**します。

リスニングデバイス、またはセントラルデバイスとも呼ばれるデバイスは、アドバタイジングデバイスに特定して送られる**SCANリクエスト**でアドバタイジングパケットに応答することができます。そのスキャンへの**レスポンス**は、初期のアドバタイジングリクエストに収まらなかった追加情報、例えば完全なデバイス名などを含む、**アドバタイジング**パケットと同じ構造を使用します。

![](<../.gitbook/assets/image (201) (2) (1) (1).png>)

プリアンブルバイトは周波数を同期させ、4バイトのアクセスアドレスは**接続識別子**であり、複数のデバイスが同じチャンネル上で接続を確立しようとしているシナリオで使用されます。次に、プロトコルデータユニット（**PDU**）には**アドバタイジングデータ**が含まれます。PDUにはいくつかのタイプがありますが、最も一般的に使用されるのはADV\_NONCONN\_INDとADV\_INDです。デバイスは、接続を**受け付けない**場合に**ADV\_NONCONN\_IND** PDUタイプを使用し、アドバタイジングパケット内のみでデータを送信します。デバイスは、接続を**許可する**場合に**ADV\_IND**を使用し、**接続が確立されるとアドバタイジングパケットの送信を停止**します。

## GATT

**Generic Attribute Profile**（GATT）は、**デバイスがデータをどのようにフォーマットして転送するか**を定義します。BLEデバイスの攻撃面を分析するとき、しばしばGATT（またはGATTs）に注目します。なぜなら、それが**デバイス機能がトリガーされる方法**であり、データがどのように保存、グループ化、変更されるかを決定するからです。GATTは、デバイスの特性、記述子、およびサービスを16ビットまたは32ビットの値として表にリストします。**特性**は、セントラルデバイスとペリフェラル間で**送信されるデータ**値です。これらの特性には、それらについて**追加情報を提供する記述子**があります。**特性**は、特定のアクションを実行するために関連している場合、しばしば**サービス**内で**グループ化**されます。

# 列挙
```bash
hciconfig #Check config, check if UP or DOWN
# If DOWN try:
sudo modprobe -c bluetooth
sudo hciconfig hci0 down && sudo hciconfig hci0 up

# Spoof MAC
spooftooph -i hci0 -a 11:22:33:44:55:66
```
## GATTool

**GATTool** は他のデバイスとの**接続**を**確立**し、そのデバイスの**特性**をリストし、属性を読み取り書き込むことができます。\
GATTToolは `-I` オプションでインタラクティブシェルを起動できます：
```bash
gatttool -i hci0 -I
[ ][LE]> connect 24:62:AB:B1:A8:3E Attempting to connect to A4:CF:12:6C:B3:76 Connection successful
[A4:CF:12:6C:B3:76][LE]> characteristics
handle: 0x0002, char properties: 0x20, char value handle:
0x0003, uuid: 00002a05-0000-1000-8000-00805f9b34fb
handle: 0x0015, char properties: 0x02, char value handle:
0x0016, uuid: 00002a00-0000-1000-8000-00805f9b34fb
[...]

# Write data
gatttool -i <Bluetooth adapter interface> -b <MAC address of device> --char-write-req <characteristic handle> -n <value>
gatttool -b a4:cf:12:6c:b3:76 --char-write-req -a 0x002e -n $(echo -n "04dc54d9053b4307680a"|xxd -ps)

# Read data
gatttool -i <Bluetooth adapter interface> -b <MAC address of device> --char-read -a 0x16

# Read connecting with an authenticated encrypted connection
gatttool --sec-level=high -b a4:cf:12:6c:b3:76 --char-read -a 0x002c
```
## Bettercap
```bash
# Start listening for beacons
sudo bettercap --eval "ble.recon on"
# Wait some time
>> ble.show # Show discovered devices
>> ble.enum <mac addr> # This will show the service, characteristics and properties supported

# Write data in a characteristic
>> ble.write <MAC ADDR> <UUID> <HEX DATA>
>> ble.write <mac address of device> ff06 68656c6c6f # Write "hello" in ff06
```
<details>

<summary><strong>AWSハッキングをゼロからヒーローまで学ぶ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>！</strong></summary>

HackTricksをサポートする他の方法:

* **HackTricksにあなたの会社を広告したい場合**、または**HackTricksをPDFでダウンロードしたい場合**は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS & HackTricksグッズ**](https://peass.creator-spring.com)を入手する
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクションをチェックする
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)に**参加する**か、[**telegramグループ**](https://t.me/peass)に参加する、または**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)を**フォローする**。
* [**HackTricks**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のgithubリポジトリにPRを提出して、あなたのハッキングのコツを**共有する**。

</details>
