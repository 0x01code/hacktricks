<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>тШБя╕П HackTricks рдХреНрд▓рд╛рдЙрдб тШБя╕П</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ЁЯРж рдЯреНрд╡рд┐рдЯрд░ ЁЯРж</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ЁЯОЩя╕П рдЯреНрд╡рд┐рдЪ ЁЯОЩя╕П</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ЁЯОе рдпреВрдЯреНрдпреВрдм ЁЯОе</strong></a></summary>

- рдХреНрдпрд╛ рдЖрдк **рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХрдВрдкрдиреА** рдореЗрдВ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ? рдХреНрдпрд╛ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХреЛ HackTricks рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд** рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ? рдпрд╛ рдХреНрдпрд╛ рдЖрдкрдХреЛ **PEASS рдХреА рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рдХрд╛ рдЙрдкрдпреЛрдЧ** рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ? [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ!

- рдЦреЛрдЬреЗрдВ [**The PEASS рдкрд░рд┐рд╡рд╛рд░**](https://opensea.io/collection/the-peass-family), рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ рд╕рдВрдЧреНрд░рд╣ [**NFTs**](https://opensea.io/collection/the-peass-family)

- рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks swag**](https://peass.creator-spring.com)

- **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** [**ЁЯТм**](https://emojipedia.org/speech-balloon/) [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ рдпрд╛ рдореБрдЭреЗ **рдЯреНрд╡рд┐рдЯрд░** рдкрд░ **рдлрд╝реЙрд▓реЛ** рдХрд░реЗрдВ [**ЁЯРж**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**

- **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рдХреЛ [hacktricks рд░реЗрдкреЛ](https://github.com/carlospolop/hacktricks) рдФрд░ [hacktricks-cloud рд░реЗрдкреЛ](https://github.com/carlospolop/hacktricks-cloud) рдореЗрдВ рдкреАрдЖрд░ рдЬрдорд╛ рдХрд░рдХреЗ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВред**

</details>


рдЗрдВрдЯрд░рдиреЗрдЯ рдкрд░ рдХрдИ рдмреНрд▓реЙрдЧ рд╣реИрдВ рдЬреЛ **LDAP рдХреЗ рд╕рд╛рде рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдП рдЧрдП рдкреНрд░рд┐рдВрдЯрд░реЛрдВ рдХреЛ рдЫреЛрдбрд╝рдиреЗ рдХреЗ рдЦрддрд░реЛрдВ рдХреЛ рд╣рд╛рдЗрд▓рд╛рдЗрдЯ рдХрд░рддреЗ рд╣реИрдВ**ред
рдЗрд╕рдХрд╛ рдХрд╛рд░рдг рд╣реИ рдХрд┐ рдПрдХ рд╣рдорд▓рд╛рд╡рд░ **рдкреНрд░рд┐рдВрдЯрд░ рдХреЛ рдзреЛрдЦрд╛ рджреЗ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдПрдХ рд░реВрдЧ LDAP рд╕рд░реНрд╡рд░ рдХреЗ рдЦрд┐рд▓рд╛рдл рдкреНрд░рдорд╛рдгрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП** (рдЖрдорддреМрд░ рдкрд░ `nc -vv -l -p 444` рдкрд░реНрдпрд╛рдкреНрдд рд╣реЛрддрд╛ рд╣реИ) рдФрд░ рдкреНрд░рд┐рдВрдЯрд░ **рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЛ рд╕рд╛рдл-рдкрд╛рда рдореЗрдВ рдХреИрдкреНрдЪрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкреНрд░рдорд╛рдгрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП**ред

рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдХрдИ рдкреНрд░рд┐рдВрдЯрд░ рдореЗрдВ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдореЛрдВ рдХреЗ рд╕рд╛рде рд▓реЙрдЧ** рд╣реЛрддреЗ рд╣реИрдВ рдпрд╛ рд╡реЗ рдбреЛрдореЗрди рдХрдВрдЯреНрд░реЛрд▓рд░ рд╕реЗ **рд╕рднреА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдореЛрдВ рдХреЛ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдХреНрд╖рдо** рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред

рдЗрд╕ **рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдЬрд╛рдирдХрд╛рд░реА** рдФрд░ рд╕рд╛рдорд╛рдиреНрдп **рд╕реБрд░рдХреНрд╖рд╛ рдХреА рдХрдореА** рдХреЗ рдХрд╛рд░рдг рд╣рдорд▓рд╛рд╡рд░реЛрдВ рдХреЗ рд▓рд┐рдП рдкреНрд░рд┐рдВрдЯрд░ рдмрд╣реБрдд рд░реЛрдЪрдХ рд╣реЛрддреЗ рд╣реИрдВред

рдЗрд╕ рд╡рд┐рд╖рдп рдкрд░ рдХреБрдЫ рдмреНрд▓реЙрдЧ:

* [https://www.ceos3c.com/hacking/obtaining-domain-credentials-printer-netcat/](https://www.ceos3c.com/hacking/obtaining-domain-credentials-printer-netcat/)
* [https://medium.com/@nickvangilder/exploiting-multifunction-printers-during-a-penetration-test-engagement-28d3840d8856](https://medium.com/@nickvangilder/exploiting-multifunction-printers-during-a-penetration-test-engagement-28d3840d8856)

**рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЬрд╛рдирдХрд╛рд░реА** [**https://grimhacker.com/2018/03/09/just-a-printer/**](https://grimhacker.com/2018/03/09/just-a-printer/) рд╕реЗ рдХреЙрдкреА рдХреА рдЧрдИ рдереА

# LDAP рд╕реЗрдЯрд┐рдВрдЧреНрд╕

Konica Minolta рдкреНрд░рд┐рдВрдЯрд░реЛрдВ рдкрд░ рдПрдХ LDAP рд╕рд░реНрд╡рд░ рдХреЛ рдХрдиреЗрдХреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИ, рд╕рд╛рде рд╣реА рдкреНрд░рдорд╛рдгрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ред рдЗрди рдЙрдкрдХрд░рдгреЛрдВ рдХреЗ рдлрд░реНрдорд╡реЗрдпрд░ рдХреЗ рдкрд╣рд▓реЗ рд╕рдВрд╕реНрдХрд░рдгреЛрдВ рдореЗрдВ рдореИрдВрдиреЗ рд╕реБрдирд╛ рд╣реИ рдХрд┐ рдкреГрд╖реНрда рдХреЗ HTML рд╕реНрд░реЛрдд рдХреЛ рдкрдврд╝рдХрд░ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреЛ рдкреБрдирд░реНрдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЕрдм рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдореЗрдВ рд╡рд╛рдкрд╕ рдирд╣реАрдВ рд▓реМрдЯрддреЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рд╣рдореЗрдВ рдереЛрдбрд╝рд╛ рдЕрдзрд┐рдХ рдореЗрд╣рдирдд рдХрд░рдиреА рд╣реЛрдЧреАред

LDAP рд╕рд░реНрд╡рд░реЛрдВ рдХреА рд╕реВрдЪреА рдиреЗрдЯрд╡рд░реНрдХ > LDAP рд╕реЗрдЯрд┐рдВрдЧ > LDAP рд╕реЗрдЯрд┐рдВрдЧ рд╕реЗрдЯрд┐рдВрдЧ рдХреЗ рддрд╣рдд рд╣реИ

рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдХреЛ LDAP рд╕рд░реНрд╡рд░ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд╣реИ рдмрд┐рдирд╛ рдкреБрдирдГ рдкреНрд░рд╡реЗрд╢ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рджрд░реНрдЬ рдХрд┐рдП рдЬрд╛рдПрдВрдЧреЗ рдЬреЛ рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд┐рдП рдЬрд╛рдПрдВрдЧреЗред рдореБрдЭреЗ рдпрд╣ рд╕рдордЭрдирд╛ рд╣реИ рдХрд┐ рдпрд╣ рдПрдХ рд╕рд░рд▓ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЕрдиреБрднрд╡ рдХреЗ рд▓рд┐рдП рд╣реИ, рд▓реЗрдХрд┐рди рдЗрд╕рд╕реЗ рд╣рдорд▓рд╛рд╡рд░ рдХреЛ рдкреНрд░рд┐рдВрдЯрд░ рдХреЗ рдорд╛рд╕реНрдЯрд░ рд╕реЗ рдбреЛрдореЗрди рдкрд░ рдПрдХ рдЯреЛ рд╣реЛрд▓реНрдб рдХрд░рдиреЗ рдХрд╛ рдПрдХ рдЕрд╡рд╕рд░ рдорд┐рд▓рддрд╛ рд╣реИред

рд╣рдо рдПрдХ рдорд╢реАрди рдХреЛ рдирд┐рдпрдВрддреНрд░рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП LDAP рд╕рд░реНрд╡рд░ рдкрддрд╛ рд╕реЗрдЯрд┐рдВрдЧ рдХреЛ рдкреБрдирд░реНрдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдФрд░ рд╕рд╣рд╛рдпрдХ "рдкрд░реАрдХреНрд╖рдг рдХрдиреЗрдХреНрд╢рди" рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рдХреЗ рд╕рд╛рде рдПрдХ рдХрдиреЗрдХреНрд╢рди рдХреЛ рдЯреНрд░рд┐рдЧрд░ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

# рдЕрдЪреНрдЫреА рдЪреАрдЬреЛрдВ рдХреЗ рд▓рд┐рдП рд╕реБрдирдирд╛

## рдиреЗрдЯрдХреИрдЯ

рдпрджрд┐ рдореЗрд░реА рддреБрд▓рдирд╛ рдореЗрдВ рдЖрдкрдХреЛ рдЕрдЪреНрдЫреА рднрд╛рдЧреНрдп рд╣реЛрддрд╛ рд╣реИ, рддреЛ рдЖрдк рдПрдХ рд╕рд░рд▓ рдиреЗрдЯрдХреИрдЯ рд╕реБрдирдиреЗ рдХреЗ рд╕рд╛рде рдмрдЪ рд╕рдХрддреЗ рд╣реИрдВ:
```
sudo nc -k -v -l -p 386
```
рдореБрдЭреЗ [@\_castleinthesky](https://twitter.com/\_castleinthesky) рджреНрд╡рд╛рд░рд╛ рдпрд╣ рдЖрд╢реНрд╡рд╛рд╕рди рджрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рдХрд┐ рдпрд╣ рдЕрдзрд┐рдХрд╛рдВрд╢ рд╕рдордп рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ, рд╣рд╛рд▓рд╛рдВрдХрд┐ рдореБрдЭреЗ рдЕрднреА рддрдХ рдЗрддрдиреА рдЖрд╕рд╛рдиреА рд╕реЗ рдЫреБрдЯрдХрд╛рд░рд╛ рдирд╣реАрдВ рдорд┐рд▓рд╛ рд╣реИред

## Slapd

рдореБрдЭреЗ рдкрддрд╛ рдЪрд▓рд╛ рд╣реИ рдХрд┐ рдкреНрд░рд┐рдВрдЯрд░ рдХреЛ рдкрд╣рд▓реЗ рдПрдХ рдкреВрд░реНрдг LDAP рд╕рд░реНрд╡рд░ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ, рдЬрд╣рд╛рдВ рдкреНрд░рд┐рдВрдЯрд░ рдкрд╣рд▓реЗ рдПрдХ рдирд▓ рдмрд╛рдЗрдВрдб рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рддрд╛ рд╣реИ рдФрд░ рдлрд┐рд░ рдЙрдкрд▓рдмреНрдз рдЬрд╛рдирдХрд╛рд░реА рдХрд╛ рдкреНрд░рд╢реНрди рдХрд░рддрд╛ рд╣реИ, рдХреЗрд╡рд▓ рдпрджрд┐ рдпреЗ рдХрд╛рд░реНрд░рд╡рд╛рдИ рд╕рдлрд▓ рд╣реЛрддреА рд╣реИ рддреЛ рд╡рд╣ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЗ рд╕рд╛рде рдмрд╛рдЗрдВрдб рдХрд░рддрд╛ рд╣реИред

рдореИрдВрдиреЗ рдПрдХ рд╕рд░рд▓ LDAP рд╕рд░реНрд╡рд░ рдЦреЛрдЬрд╛ рдЬреЛ рдЖрд╡рд╢реНрдпрдХрддрд╛рдУрдВ рдХреЛ рдкреВрд░рд╛ рдХрд░рддрд╛ рд╣реИ, рд╣рд╛рд▓рд╛рдВрдХрд┐ рд╡рд╣рд╛рдВ рд╕реАрдорд┐рдд рд╡рд┐рдХрд▓реНрдк рдереЗред рдЕрдВрдд рдореЗрдВ рдореИрдВрдиреЗ рдПрдХ рдЦреБрд▓рд╛ LDAP рд╕рд░реНрд╡рд░ рд╕реЗрдЯрдЕрдк рдХрд░рдиреЗ рдХрд╛ рд╡рд┐рдХрд▓реНрдк рдЪреБрдирд╛ рдФрд░ рд╕реНрд▓реИрдкрдбреА рдбреАрдмрдЧ рд╕рд░реНрд╡рд░ рд╕реЗрд╡рд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХрдиреЗрдХреНрд╢рди рд╕реНрд╡реАрдХрд╛рд░ рдХрд░рдиреЗ рдФрд░ рдкреНрд░рд┐рдВрдЯрд░ рд╕реЗ рд╕рдВрджреЗрд╢ рдкреНрд░рд┐рдВрдЯ рдХрд░рдиреЗ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ред (рдпрджрд┐ рдЖрдкрдХреЛ рдХреЛрдИ рдЖрд╕рд╛рди рд╡рд┐рдХрд▓реНрдк рдкрддрд╛ рд╣реЛ, рддреЛ рдореБрдЭреЗ рдЦреБрд╢реА рд╣реЛрдЧреА рдЙрд╕рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╕реБрдирдиреЗ рдХреА)

### рд╕реНрдерд╛рдкрдирд╛

(рдиреЛрдЯ: рдЗрд╕ рдЦрдВрдб рдХреЛ рдпрд╣рд╛рдВ [https://www.server-world.info/en/note?os=Fedora\_26\&p=openldap](https://www.server-world.info/en/note?os=Fedora\_26\&p=openldap) рдХреЗ рдЧрд╛рдЗрдб рдХрд╛ рд╣рд▓реНрдХрд╛ рд╕рдВрд╢реЛрдзрд┐рдд рд╕рдВрд╕реНрдХрд░рдг рд╣реИ)

рд░реВрдЯ рдЯрд░реНрдорд┐рдирд▓ рд╕реЗ:

**OpenLDAP рд╕реНрдерд╛рдкрд┐рдд рдХрд░реЗрдВ,**
```
#> dnf install -y install openldap-servers openldap-clients

#> cp /usr/share/openldap-servers/DB_CONFIG.example /var/lib/ldap/DB_CONFIG

#> chown ldap. /var/lib/ldap/DB_CONFIG
```
**рдПрдХ OpenLDAP рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рдкрд╛рд╕рд╡рд░реНрдб рд╕реЗрдЯ рдХрд░реЗрдВ (рдЖрдкрдХреЛ рдЗрд╕реЗ рд╢реАрдШреНрд░ рд╣реА рдлрд┐рд░ рд╕реЗ рдЖрд╡рд╢реНрдпрдХ рд╣реЛрдЧрд╛)**
```
#> slappasswd
New password:
Re-enter new password:
{SSHA}xxxxxxxxxxxxxxxxxxxxxxxx
```

```
#> vim chrootpw.ldif
# specify the password generated above for "olcRootPW" section
dn: olcDatabase={0}config,cn=config
changetype: modify
add: olcRootPW
olcRootPW: {SSHA}xxxxxxxxxxxxxxxxxxxxxxxx
```

```
#> ldapadd -Y EXTERNAL -H ldapi:/// -f chrootpw.ldif
SASL/EXTERNAL authentication started
SASL username: gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth
SASL SSF: 0
modifying entry "olcDatabase={0}config,cn=config"
```
**рдореВрд▓ рд╕реНрдХреАрдорд╛ рдЖрдпрд╛рдд рдХрд░реЗрдВ**
```
#> ldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/cosine.ldif
SASL/EXTERNAL authentication started
SASL username: gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth
SASL SSF: 0
adding new entry "cn=cosine,cn=schema,cn=config"

#> ldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/nis.ldif
SASL/EXTERNAL authentication started
SASL username: gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth
SASL SSF: 0
adding new entry "cn=nis,cn=schema,cn=config"

#> ldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/inetorgperson.ldif
SASL/EXTERNAL authentication started
SASL username: gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth
SASL SSF: 0
adding new entry "cn=inetorgperson,cn=schema,cn=config"
```
**LDAP рдбреАрдмреА рдкрд░ рдЕрдкрдиреЗ рдбреЛрдореЗрди рдирд╛рдо рд╕реЗрдЯ рдХрд░реЗрдВред**
```
# generate directory manager's password
#> slappasswd
New password:
Re-enter new password:
{SSHA}xxxxxxxxxxxxxxxxxxxxxxxx

#> vim chdomain.ldif
# specify the password generated above for "olcRootPW" section
dn: olcDatabase={1}monitor,cn=config
changetype: modify
replace: olcAccess
olcAccess: {0}to * by dn.base="gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth"
read by dn.base="cn=Manager,dc=foo,dc=bar" read by * none

dn: olcDatabase={2}mdb,cn=config
changetype: modify
replace: olcSuffix
olcSuffix: dc=foo,dc=bar

dn: olcDatabase={2}mdb,cn=config
changetype: modify
replace: olcRootDN
olcRootDN: cn=Manager,dc=foo,dc=bar

dn: olcDatabase={2}mdb,cn=config
changetype: modify
add: olcRootPW
olcRootPW: {SSHA}xxxxxxxxxxxxxxxxxxxxxxxx

dn: olcDatabase={2}mdb,cn=config
changetype: modify
add: olcAccess
olcAccess: {0}to attrs=userPassword,shadowLastChange by
dn="cn=Manager,dc=foo,dc=bar" write by anonymous auth by self write by * none
olcAccess: {1}to dn.base="" by * read
olcAccess: {2}to * by dn="cn=Manager,dc=foo,dc=bar" write by * read

#> ldapmodify -Y EXTERNAL -H ldapi:/// -f chdomain.ldif
SASL/EXTERNAL authentication started
SASL username: gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth
SASL SSF: 0
modifying entry "olcDatabase={1}monitor,cn=config"

modifying entry "olcDatabase={2}mdb,cn=config"

modifying entry "olcDatabase={2}mdb,cn=config"

modifying entry "olcDatabase={2}mdb,cn=config"

modifying entry "olcDatabase={2}mdb,cn=config"

#> vim basedomain.ldif
dn: dc=foo,dc=bar
objectClass: top
objectClass: dcObject
objectclass: organization
o: Foo Bar
dc: DC1

dn: cn=Manager,dc=foo,dc=bar
objectClass: organizationalRole
cn: Manager
description: Directory Manager

dn: ou=People,dc=foo,dc=bar
objectClass: organizationalUnit
ou: People

dn: ou=Group,dc=foo,dc=bar
objectClass: organizationalUnit
ou: Group

#> ldapadd -x -D cn=Manager,dc=foo,dc=bar -W -f basedomain.ldif
Enter LDAP Password: # directory manager's password
adding new entry "dc=foo,dc=bar"

adding new entry "cn=Manager,dc=foo,dc=bar"

adding new entry "ou=People,dc=foo,dc=bar"

adding new entry "ou=Group,dc=foo,dc=bar"
```
**LDAP TLS рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░реЗрдВ**

**рдПрд╕рдПрд╕рдПрд▓ рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдмрдирд╛рдПрдВ**
```
#> cd /etc/pki/tls/certs
#> make server.key
umask 77 ; \
/usr/bin/openssl genrsa -aes128 2048 > server.key
Generating RSA private key, 2048 bit long modulus
...
...
e is 65537 (0x10001)
Enter pass phrase: # set passphrase
Verifying - Enter pass phrase: # confirm

# remove passphrase from private key
#> openssl rsa -in server.key -out server.key
Enter pass phrase for server.key: # input passphrase
writing RSA key

#> make server.csr
umask 77 ; \
/usr/bin/openssl req -utf8 -new -key server.key -out server.csr
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter '.', the field will be left blank.
-----
Country Name (2 letter code) [XX]: # country
State or Province Name (full name) []: # state
Locality Name (eg, city) [Default City]: # city
Organization Name (eg, company) [Default Company Ltd]: # company
Organizational Unit Name (eg, section) []:Foo Bar # department
Common Name (eg, your name or your server's hostname) []:www.foo.bar # server's FQDN
Email Address []:xxx@foo.bar # admin email
Please enter the following 'extra' attributes
to be sent with your certificate request
A challenge password []: # Enter
An optional company name []: # Enter

#> openssl x509 -in server.csr -out server.crt -req -signkey server.key -days 3650
Signature ok
subject=/C=/ST=/L=/O=/OU=Foo Bar/CN=dlp.foo.bar/emailAddress=xxx@roo.bar
Getting Private key
```
**SSL /TLS рдХреЗ рд▓рд┐рдП Slapd рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░реЗрдВ**

To configure Slapd for SSL/TLS, follow the steps below:

1. Generate a self-signed certificate or obtain a valid SSL/TLS certificate from a trusted certificate authority (CA).

2. Copy the certificate and private key files to the appropriate directory on the server. The default directory is usually `/etc/ldap/ssl/`.

3. Set the correct permissions for the certificate and private key files to ensure only the LDAP server can access them. Use the following commands:

   ```bash
   chmod 600 /etc/ldap/ssl/cert.pem
   chmod 600 /etc/ldap/ssl/key.pem
   ```

4. Edit the Slapd configuration file, usually located at `/etc/ldap/slapd.conf`, and add the following lines:

   ```bash
   TLSCACertificateFile /etc/ldap/ssl/cert.pem
   TLSCertificateFile /etc/ldap/ssl/cert.pem
   TLSCertificateKeyFile /etc/ldap/ssl/key.pem
   ```

   Make sure to replace `/etc/ldap/ssl/cert.pem` and `/etc/ldap/ssl/key.pem` with the actual paths to your certificate and private key files.

5. Restart the Slapd service to apply the changes:

   ```bash
   systemctl restart slapd
   ```

6. Verify that Slapd is now using SSL/TLS by connecting to the LDAP server using the `ldapsearch` command with the `-ZZ` option:

   ```bash
   ldapsearch -x -H ldap://localhost -ZZ -b "dc=example,dc=com" -D "cn=admin,dc=example,dc=com" -W
   ```

   If the connection is successful, it means that Slapd is now configured to use SSL/TLS.

By following these steps, you can configure Slapd to use SSL/TLS for secure communication.
```
#> cp /etc/pki/tls/certs/server.key \
/etc/pki/tls/certs/server.crt \
/etc/pki/tls/certs/ca-bundle.crt \
/etc/openldap/certs/

#> chown ldap. /etc/openldap/certs/server.key \
/etc/openldap/certs/server.crt \
/etc/openldap/certs/ca-bundle.crt

#> vim mod_ssl.ldif
# create new
dn: cn=config
changetype: modify
add: olcTLSCACertificateFile
olcTLSCACertificateFile: /etc/openldap/certs/ca-bundle.crt
-
replace: olcTLSCertificateFile
olcTLSCertificateFile: /etc/openldap/certs/server.crt
-
replace: olcTLSCertificateKeyFile
olcTLSCertificateKeyFile: /etc/openldap/certs/server.key

#> ldapmodify -Y EXTERNAL -H ldapi:/// -f mod_ssl.ldif
SASL/EXTERNAL authentication started
SASL username: gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth
SASL SSF: 0
modifying entry "cn=config"
```
**рд▓реЛрдХрд▓ рдлрд╝рд╛рдпрд░рд╡реЙрд▓ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ LDAP рдХреЛ рдЕрдиреБрдорддрд┐ рджреЗрдВ**
```
firewall-cmd --add-service={ldap,ldaps}
```
## рднреБрдЧрддрд╛рди

рдПрдХ рдмрд╛рд░ рдЬрдм рдЖрдкрдиреЗ рдЕрдкрдиреА LDAP рд╕реЗрд╡рд╛ рдХреЛ рд╕реНрдерд╛рдкрд┐рдд рдФрд░ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░ рд▓рд┐рдпрд╛ рд╣реИ, рддреЛ рдЖрдк рдЗрд╕реЗ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрдорд╛рдВрдб рдХреЗ рд╕рд╛рде рдЪрд▓рд╛ рд╕рдХрддреЗ рд╣реИрдВ:

> ```
> slapd -d 2
> ```

рдиреАрдЪреЗ рджрд┐рдП рдЧрдП рд╕реНрдХреНрд░реАрдирд╢реЙрдЯ рдореЗрдВ рдПрдХ рдЙрджрд╛рд╣рд░рдг рджрд┐рдЦрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ рдЬрдм рд╣рдо рдкреНрд░рд┐рдВрдЯрд░ рдкрд░ рдХрдиреЗрдХреНрд╢рди рдЯреЗрд╕реНрдЯ рдЪрд▓рд╛рддреЗ рд╣реИрдВред рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ, рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо рдФрд░ рдкрд╛рд╕рд╡рд░реНрдб LDAP рдХреНрд▓рд╛рдЗрдВрдЯ рд╕реЗ рд╕рд░реНрд╡рд░ рдХреЛ рдкрд╛рд╕ рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВред

![slapd рдЯрд░реНрдорд┐рдирд▓ рдЖрдЙрдЯрдкреБрдЯ рдЬрд┐рд╕рдореЗрдВ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо "MyUser" рдФрд░ рдкрд╛рд╕рд╡рд░реНрдб "MyPassword" рд╣реИрдВ](https://i1.wp.com/grimhacker.com/wp-content/uploads/2018/03/slapd\_output.png?resize=474%2C163\&ssl=1)

# рдпрд╣ рдХрд┐рддрдирд╛ рдЦрд░рд╛рдм рд╣реЛ рд╕рдХрддрд╛ рд╣реИ?

рдпрд╣ рдмрд╣реБрдд рдЕрдзрд┐рдХ рдЙрди рдкреНрд░рдорд╛рдгрд┐рдд рдХреЛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рддрд╛ рд╣реИ рдЬреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдП рдЧрдП рд╣реИрдВред

рдпрджрд┐ рдиреНрдпреВрдирддрдо рдЕрдзрд┐рдХрд╛рд░ рдХреЗ рд╕рд┐рджреНрдзрд╛рдВрдд рдХрд╛ рдкрд╛рд▓рди рдХрд┐рдпрд╛ рдЬрд╛ рд░рд╣рд╛ рд╣реИ, рддреЛ рдЖрдкрдХреЛ рд╕рдВрдЧрдарди рдХреЗ рдХреБрдЫ рддрддреНрд╡реЛрдВ рдХреЗ рд▓рд┐рдП рдХреЗрд╡рд▓ рдкрдардиреАрдп рдкрд╣реБрдВрдЪ рдорд┐рд▓ рд╕рдХрддреА рд╣реИред рдпрд╣ рдЕрдХреНрд╕рд░ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реЛрддрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдЖрдк рдЙрд╕ рдЬрд╛рдирдХрд╛рд░реА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдФрд░ рдЕрдзрд┐рдХ рд╕рдЯреАрдХ рд╣рдорд▓реЛрдВ рдХреЛ рддреИрдпрд╛рд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

рд╕рд╛рдорд╛рдиреНрдпрддрдГ рдЖрдкрдХреЛ рдбреЛрдореЗрди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕рдореВрд╣ рдореЗрдВ рдПрдХ рдЦрд╛рддрд╛ рдорд┐рд▓реЗрдЧрд╛ рдЬрд┐рд╕рд╕реЗ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдЬрд╛рдирдХрд╛рд░реА рддрдХ рдкрд╣реБрдВрдЪ рдорд┐рд▓ рд╕рдХрддреА рд╣реИ рдпрд╛ рдЕрдиреНрдп рд╣рдорд▓реЛрдВ рдХреЗ рд▓рд┐рдП рдкреВрд░реНрд╡рд╛рдкреЗрдХреНрд╖рд┐рдд рдкреНрд░рдорд╛рдгреАрдХрд░рдг рджрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

рдпрд╛, рдореЗрд░реА рддрд░рд╣, рдЖрдкрдХреЛ рдПрдХ LDAP рд╕рд░реНрд╡рд░ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкреБрд░рд╕реНрдХреГрдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдЖрдкрдХреЛ рдПрдХ рдбреЛрдореЗрди рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рдЦрд╛рддрд╛ рд╕реНрд╡рд░реНрдг рдкреНрд▓реЗрдЯрд░ рдкрд░ рд╣рд╛рде рдореЗрдВ рджрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред


<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>тШБя╕П HackTricks Cloud тШБя╕П</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ЁЯРж Twitter ЁЯРж</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ЁЯОЩя╕П Twitch ЁЯОЩя╕П</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ЁЯОе Youtube ЁЯОе</strong></a></summary>

- рдХреНрдпрд╛ рдЖрдк рдПрдХ **рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХрдВрдкрдиреА** рдореЗрдВ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ? рдХреНрдпрд╛ рдЖрдк рдЕрдкрдиреА рдХрдВрдкрдиреА рдХреЛ **HackTricks рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд** рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ? рдпрд╛ рдХреНрдпрд╛ рдЖрдк **PEASS рдХреЗ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ**? [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ!

- рдЦреЛрдЬреЗрдВ [**The PEASS Family**](https://opensea.io/collection/the-peass-family), рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFT**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣

- рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks swag**](https://peass.creator-spring.com)

- **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** [**ЁЯТм**](https://emojipedia.org/speech-balloon/) [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рдореБрдЭреЗ **рдЯреНрд╡рд┐рдЯрд░** рдкрд░ **рдлрд╝реЙрд▓реЛ** рдХрд░реЗрдВ [**ЁЯРж**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**

- **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рдХреЛ [hacktricks рд░реЗрдкреЛ](https://github.com/carlospolop/hacktricks) рдФрд░ [hacktricks-cloud рд░реЗрдкреЛ](https://github.com/carlospolop/hacktricks-cloud) рдореЗрдВ рдкреАрдЖрд░ рдЬрдорд╛ рдХрд░рдХреЗ рдЕрдкрдирд╛ рдпреЛрдЧрджрд╛рди рджреЗрдВред**

</details>
