# рдХреЗрд░рдмреЗрд░реЛрд╕ рдбрдмрд▓ рд╣реЙрдк рд╕рдорд╕реНрдпрд╛

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>тШБя╕П HackTricks Cloud тШБя╕П</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ЁЯРж Twitter ЁЯРж</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ЁЯОЩя╕П Twitch ЁЯОЩя╕П</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ЁЯОе Youtube ЁЯОе</strong></a></summary>

* рдХреНрдпрд╛ рдЖрдк рдХрд┐рд╕реА **рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХрдВрдкрдиреА** рдореЗрдВ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ? рдХреНрдпрд╛ рдЖрдк рдЕрдкрдиреА рдХрдВрдкрдиреА рдХреЛ **HackTricks рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд** рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ? рдпрд╛ рдХреНрдпрд╛ рдЖрдкрдХреЛ **PEASS рдХреА рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рдХрд╛ рдЙрдкрдпреЛрдЧ** рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ? [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ!
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ рд╕рдВрдЧреНрд░рд╣ [**NFTs**](https://opensea.io/collection/the-peass-family)
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks swag**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**ЁЯТм**](https://emojipedia.org/speech-balloon/) [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ **рд╢рд╛рдорд┐рд▓** рд╣реЛрдВ рдпрд╛ рдореБрдЭреЗ **Twitter** [**ЁЯРж**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)** рдХрд╛ рдкрд╛рд▓рди рдХрд░реЗрдВ**.
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рдХреЛ** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **рдФрд░** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **рдореЗрдВ PR рдЬрдорд╛ рдХрд░рдХреЗ рдЕрдкрдирд╛ рдпреЛрдЧрджрд╛рди рджреЗрдВред**

</details>

## рдкрд░рд┐рдЪрдп

рдХреЗрд░рдмреЗрд░реЛрд╕ "рдбрдмрд▓ рд╣реЙрдк" рд╕рдорд╕реНрдпрд╛ рдЙрддреНрдкрдиреНрди рд╣реЛрддреА рд╣реИ рдЬрдм рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдХреЛ рджреЛ **рд╣реЙрдк** рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдХреЗрд░рдмреЗрд░реЛрд╕ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рддрд╛ рд╣реИ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП **PowerShell**/**WinRM** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗред

рдЬрдм рдХреЗрд░рдмреЗрд░реЛрд╕ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ **рдкреНрд░рдорд╛рдгреАрдХрд░рдг** рд╣реЛрддрд╛ рд╣реИ, рддреЛ **рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕** рдХреЛ **рдореЗрдореЛрд░реА рдореЗрдВ рдХреИрд╢ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред** рдЗрд╕рд▓рд┐рдП, рдпрджрд┐ рдЖрдк mimikatz рдЪрд▓рд╛рддреЗ рд╣реИрдВ рддреЛ рдЖрдкрдХреЛ рдорд╢реАрди рдореЗрдВ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдирд╣реАрдВ рдорд┐рд▓реЗрдВрдЧреЗ, рднрд▓реЗ рд╣реА рд╡рд╣ рдкреНрд░рдХреНрд░рд┐рдпрд╛рдПрдБ рдЪрд▓рд╛ рд░рд╣рд╛ рд╣реЛред

рдпрд╣ рдЗрд╕рд▓рд┐рдП рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдХреЗрд░рдмреЗрд░реЛрд╕ рдХреЗ рд╕рд╛рде рдХрдиреЗрдХреНрдЯ рдХрд░рддреЗ рд╕рдордп рдпреЗ рдХрджрдо рд╣реЛрддреЗ рд╣реИрдВ:

1. рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ 1 рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ рдФрд░ **рдбреЛрдореЗрди рдХрдВрдЯреНрд░реЛрд▓рд░** рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ 1 рдХреЛ рдХреЗрд░рдмреЗрд░реЛрд╕ **TGT** рд╡рд╛рдкрд╕ рдХрд░рддрд╛ рд╣реИред
2. рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ 1 **TGT** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ **рд╕рд░реНрд╡рд┐рд╕ рдЯрд┐рдХрдЯ** рдХрд╛ рдЕрдиреБрд░реЛрдз рдХрд░рддрд╛ рд╣реИ **рд╕рд░реНрд╡рд░ 1** рд╕реЗ рдХрдиреЗрдХреНрдЯ рд╣реЛрдиреЗ рдХреЗ рд▓рд┐рдПред
3. рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ 1 **рд╕рд░реНрд╡рд░ 1** рд╕реЗ рдХрдиреЗрдХреНрдЯ рд╣реЛрддрд╛ рд╣реИ рдФрд░ **рд╕рд░реНрд╡рд┐рд╕ рдЯрд┐рдХрдЯ** рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред
4. **рд╕рд░реНрд╡рд░ 1** рдореЗрдВ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ 1 рдХреЗ **рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕** рдпрд╛ **TGT** рдирд╣реАрдВ рд╣реЛрддреЗ рд╣реИрдВред рдЗрд╕рд▓рд┐рдП, рдЬрдм рд╕рд░реНрд╡рд░ 1 рд╕реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ 1 рджреВрд╕рд░реЗ рд╕рд░реНрд╡рд░ рдореЗрдВ рд▓реЙрдЧрд┐рди рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рддрд╛ рд╣реИ, рд╡рд╣ **рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рдирд╣реАрдВ рд╣реЛрддрд╛ рд╣реИ**ред

### рдЕрд╕реАрдорд┐рдд рдбрд┐рд▓реАрдЧреЗрд╢рди

рдпрджрд┐ PC рдореЗрдВ **рдЕрд╕реАрдорд┐рдд рдбрд┐рд▓реАрдЧреЗрд╢рди** рд╕рдХреНрд╖рдо рд╣реИ, рддреЛ рдРрд╕рд╛ рдирд╣реАрдВ рд╣реЛрдЧрд╛ рдХреНрдпреЛрдВрдХрд┐ **рд╕рд░реНрд╡рд░** рдХреЛ рдЙрд╕реЗ рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ **TGT** рдорд┐рд▓реЗрдЧрд╛ рдЬреЛ рдЙрд╕реЗ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣рд╛ рд╣реИред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдпрджрд┐ рдЕрд╕реАрдорд┐рдд рдбрд┐рд▓реАрдЧреЗрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдЖрдк рд╢рд╛рдпрдж рдЗрд╕рд╕реЗ **рдбреЛрдореЗрди рдХрдВрдЯреНрд░реЛрд▓рд░ рдХреЛ рд╕рдВрдХреНрд░рдорд┐рдд** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред\
[**рдЕрд╕реАрдорд┐рдд рдбрд┐рд▓реАрдЧреЗрд╢рди рдкреГрд╖реНрда рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА**](unconstrained-delegation.md).

### CredSSP

рдЗрд╕ рд╕рдорд╕реНрдпрд╛ рд╕реЗ рдмрдЪрдиреЗ рдХреЗ рд▓рд┐рдП **рд╕рд┐рд╕реНрдЯрдо рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХреЛрдВ** рдХреЗ рд▓рд┐рдП рдПрдХ рдФрд░ рд╕реБрдЭрд╛рд╡ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬреЛ [**рдЕрддреНрдпрдВрдд рдЕрд╕реБрд░рдХреНрд╖рд┐рдд**](https://docs.microsoft.com/en-us/powershell/module/microsoft.wsman.management/enable-wsmancredssp?view=powershell-7) рд╣реИ, рд╡рд╣ рд╣реИ **Credential Security Support Provider (CredSSP)**ред CredSSP рдХреЛ рд╕рдХреНрд╖рдо рдХрд░рдиреЗ рдХрд╛ рд╕рдорд╛рдзрд╛рди рд╡рд┐рднрд┐рдиреНрди рдлреЛрд░рдореЛрдВ рдкрд░ рд╡рд░реНрд╖реЛрдВ рд╕реЗ рдЙрд▓реНрд▓реЗрдЦрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред рдорд╛рдЗрдХреНрд░реЛрд╕реЙрдлреНрдЯ рдХреЗ рдЕрдиреБрд╕рд╛рд░:

_"CredSSP рдкреНрд░рдорд╛рдгреАрдХрд░рдг рд╕реНрдерд╛рдиреАрдп рдХрдВрдкреНрдпреВрдЯрд░ рд╕реЗ рджреВрд╕рд░реЗ рдХрдВрдкреНрдпреВрдЯрд░ рдХреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдЕрдиреБрдкреНрд░реЗрд╖рд┐рдд рдХрд░рддрд╛ рд╣реИред рдЗрд╕ рдЕрднреНрдпрд╛рд╕ рд╕реЗ рджреВрд░рд╕реНрде рдХрдВрдкреНрдпреВрдЯрд░ рдХреА рд╕реБрд░рдХреНрд╖рд╛ рдЬреЛрдЦрд┐рдо рдмрдврд╝ рдЬрд╛рддрд╛ рд╣реИред рдпрджрд┐ рджреВрд░рд╕реНрде рдХрдВрдкреНрдпреВрдЯрд░ рдкреНрд░рднрд╛рд╡рд┐рдд рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдЬрдм рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдЙрд╕реЗ рдкрд╛рд╕ рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ, рддреЛ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдиреЗрдЯрд╡рд░реНрдХ рд╕рддреНрд░ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред"_

рдпрджрд┐ рдЖрдк рдкреНрд░реЛрдбрдХреНрд╢рди рд╕рд┐рд╕реНрдЯрдореЛрдВ, рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдиреЗрдЯрд╡рд░реНрдХреЛрдВ рдЖрджрд┐ рдкрд░ **CredSSP рд╕рдХреНрд╖рдо** рдкрд╛рддреЗ рд╣реИрдВ, рддреЛ рдЙрдиреНрд╣реЗрдВ рдЕрдХреНрд╖рдо рдХрд░рдирд╛ рд╕рд┐рдлрд╛рд░рд┐рд╢ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред CredSSP рд╕реНрдерд┐рддрд┐ рдХреА рдЬрд╛рдВрдЪ рдХрд░рдиреЗ рдХрд╛ рдПрдХ рддреНрд╡рд░рд┐рдд рддрд░реАрдХрд╛ рд╣реИ `Get-WSManCredSSP` рдЪрд▓рд╛рдирд╛ред рдЬреЛ рджреВрд░рд╕реНрдерддрд╛ рдореЗрдВ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдпрджрд┐ WinRM рд╕рдХреНрд╖рдо рд╣реИред
```powershell
Invoke-Command -ComputerName bizintel -Credential ta\redsuit -ScriptBlock {
Get-WSManCredSSP
}
```
## рдЙрдкрд╛рдп

### Invoke Command <a href="#invoke-command" id="invoke-command"></a>

рдпрд╣ рд╡рд┐рдзрд┐ рджреЛрд╣рд░реА рд╣реЙрдк рд╕рдорд╕реНрдпрд╛ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдиреЗ рдХреА рддрд░рд╣ рд╣реИ, рди рдХрд┐ рдЗрд╕реЗ рд╣рд▓ рдХрд░рдиреЗ рдХреА рддрд░рд╣ред рдЗрд╕рдореЗрдВ рдХреЛрдИ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реЛрддреА рд╣реИ, рдФрд░ рдЖрдк рдЗрд╕реЗ рдЖрд╕рд╛рдиреА рд╕реЗ рдЕрдкрдиреЗ рд╣рдорд▓рд╛рд╡рд░ рдмреЙрдХреНрд╕ рд╕реЗ рдЪрд▓рд╛ рд╕рдХрддреЗ рд╣реИрдВред рдпрд╣ рдореВрд▓ рд░реВрдк рд╕реЗ рдПрдХ **рдиреЗрд╕реНрдЯреЗрдб `Invoke-Command`** рд╣реИред

рдпрд╣ **рджреВрд╕рд░реЗ рд╕рд░реНрд╡рд░ рдкрд░ `hostname` рдЪрд▓рд╛рдПрдЧрд╛:**
```powershell
$cred = Get-Credential ta\redsuit
Invoke-Command -ComputerName bizintel -Credential $cred -ScriptBlock {
Invoke-Command -ComputerName secdev -Credential $cred -ScriptBlock {hostname}
}
```
рдЖрдкрдХреЗ рдкрд╛рд╕ рдкрд╣рд▓реЗ рд╕рд░реНрд╡рд░ рдХреЗ рд╕рд╛рде рдПрдХ **PS-Session** рд╕реНрдерд╛рдкрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдмрд╕ рд╡рд╣рд╛рдВ рд╕реЗ `$cred` рдХреЗ рд╕рд╛рде **`Invoke-Command`** рдЪрд▓рд╛ рд╕рдХрддреЗ рд╣реИрдВ рдЗрд╕реЗ рдиреЗрд╕реНрдЯ рдХрд░рдиреЗ рдХреА рдмрдЬрд╛рдпред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЗрд╕реЗ рдЕрдкрдиреЗ рд╣рдорд▓рд╛рд╡рд░ рдмреЙрдХреНрд╕ рд╕реЗ рдЪрд▓рд╛рдиреЗ рд╕реЗ рдХрд╛рд░реНрдп рдХреЗрдВрджреНрд░реАрдХреГрдд рд╣реЛрддрд╛ рд╣реИ:
```powershell
# From the WinRM connection
$pwd = ConvertTo-SecureString 'uiefgyvef$/E3' -AsPlainText -Force
$cred = New-Object System.Management.Automation.PSCredential('DOMAIN\username', $pwd)
# Use "-Credential $cred" option in Powerview commands
```
### рдкреАрдПрд╕рд╕реЗрд╢рди рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдкрдВрдЬреАрдХреГрдд рдХрд░реЗрдВ

рдпрджрд┐ рдЖрдк **`evil-winrm`** рдХреА рдмрдЬрд╛рдп **`Enter-PSSession`** рдХрдорд╛рдВрдбрд▓реЗрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рддреЛ рдЖрдк рдлрд┐рд░ рд╕реЗ рдЬреБрдбрд╝рдХрд░ рдбрдмрд▓ рд╣реЙрдк рд╕рдорд╕реНрдпрд╛ рдХреЛ рдЯрд╛рд▓ рд╕рдХрддреЗ рд╣реИрдВред рдЗрд╕рдХреЗ рд▓рд┐рдП **`Register-PSSessionConfiguration`** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ:
```powershell
# Register a new PS Session configuration
Register-PSSessionConfiguration -Name doublehopsess -RunAsCredential domain_name\username
# Restar WinRM
Restart-Service WinRM
# Get a PSSession
Enter-PSSession -ConfigurationName doublehopsess -ComputerName <pc_name> -Credential domain_name\username
# Check that in this case the TGT was sent and is in memory of the PSSession
klist
# In this session you won't have the double hop problem anymore
```
### рдкреЛрд░реНрдЯ рдлрд╝реЙрд░рд╡рд░реНрдбрд┐рдВрдЧ <a href="#portproxy" id="portproxy"></a>

рдЪреВрдВрдХрд┐ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдЗрдВрдЯрд░рдореАрдбрд┐рдПрдЯ рдЯрд╛рд░рдЧреЗрдЯ **bizintel: 10.35.8.17** рдкрд░ рд╕реНрдерд╛рдиреАрдп рдкреНрд░рд╢рд╛рд╕рдХ рд╣реИ, рдЖрдк рдПрдХ рдкреЛрд░реНрдЯ рдлрд╝реЙрд░рд╡рд░реНрдбрд┐рдВрдЧ рдирд┐рдпрдо рдЬреЛрдбрд╝рдХрд░ рдЕрдкрдиреЗ рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ рдЕрдВрддрд┐рдо/рддреАрд╕рд░реЗ рд╕рд░реНрд╡рд░ **secdev: 10.35.8.23** рдкрд░ рднреЗрдЬ рд╕рдХрддреЗ рд╣реИрдВред

рдЖрдк рдПрдХ рд╡рди-рд▓рд╛рдЗрдирд░ рдирд┐рдХрд╛рд▓рдиреЗ рдФрд░ рдирд┐рдпрдо рдЬреЛрдбрд╝рдиреЗ рдХреЗ рд▓рд┐рдП рддреНрд╡рд░рд┐рдд рд░реВрдк рд╕реЗ **netsh** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
```bash
netsh interface portproxy add v4tov4 listenport=5446 listenaddress=10.35.8.17 connectport=5985 connectaddress=10.35.8.23
```
рддреЛ **рдкрд╣рд▓реА рд╕рд░реНрд╡рд░** рдкреЛрд░реНрдЯ 5446 рдкрд░ рд╕реБрди рд░рд╣реА рд╣реИ рдФрд░ 5446 рдкрд░ рдЖрдиреЗ рд╡рд╛рд▓реЗ рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ **рджреВрд╕рд░реЗ рд╕рд░реНрд╡рд░** рдкреЛрд░реНрдЯ 5985 (рдпрд╛рдиреА WinRM) рдкрд░ рдЖрдЧреЗ рднреЗрдЬреЗрдЧреАред

рдлрд┐рд░ Windows рдлрд╝рд╛рдпрд░рд╡реЙрд▓ рдореЗрдВ рдПрдХ рдЫреЗрдж рдмрдирд╛рдПрдВ, рдЬрд┐рд╕реЗ рдПрдХ рддреЗрдЬрд╝ netsh one-liner рдХреЗ рд╕рд╛рде рднреА рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред
```bash
netsh advfirewall firewall add rule name=fwd dir=in action=allow protocol=TCP localport=5446
```
рдЕрдм рд╕рддреНрд░ рд╕реНрдерд╛рдкрд┐рдд рдХрд░реЗрдВ, рдЬреЛ рд╣рдореЗрдВ **рдкрд╣рд▓реЗ рд╕рд░реНрд╡рд░** рдХреЗ рдкрд╛рд╕ рдЖрдЧреЗ рднреЗрдЬреЗрдЧрд╛ред

<figure><img src="../../.gitbook/assets/image (3) (5) (1).png" alt=""><figcaption></figcaption></figure>

#### winrs.exe <a href="#winrsexe" id="winrsexe"></a>

**Portforwarding WinRM** рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ рднреА **`winrs.exe`** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХрд╛рдо рдХрд░рдиреЗ рд▓рдЧрддрд╛ рд╣реИред рдпрджрд┐ рдЖрдкрдХреЛ рдпрд╣ рдЬреНрдЮрд╛рдд рд╣реИ рдХрд┐ PowerShell рдХрд╛ рдЕрдиреБрдЧрдорди рдХрд┐рдпрд╛ рдЬрд╛ рд░рд╣рд╛ рд╣реИ, рддреЛ рдпрд╣ рдПрдХ рдмреЗрд╣рддрд░ рд╡рд┐рдХрд▓реНрдк рд╣реЛ рд╕рдХрддрд╛ рд╣реИред рдиреАрдЪреЗ рджрд┐рдП рдЧрдП рдХрдорд╛рдВрдб рдореЗрдВ `hostname` рдХреЗ рд░реВрдк рдореЗрдВ "secdev" рдХреЛ рдкрд░рд┐рдгрд╛рдо рдХреЗ рд░реВрдк рдореЗрдВ рд▓рд╛рддрд╛ рд╣реИред
```bash
winrs -r:http://bizintel:5446 -u:ta\redsuit -p:2600leet hostname
```
рдЗрд╕рдХреА рддрд░рд╣, рдпрд╣ рдЖрдХреНрд░рдордгрдХрд╛рд░реА рд╕рд┐рд╕реНрдЯрдо рдХрдорд╛рдВрдб рдХреЛ рдПрдХ рддрд░реНрдХ рдХреЗ рд░реВрдк рдореЗрдВ рдЬрд╛рд░реА рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рдЬреИрд╕реЗ `Invoke-Command`ред рдПрдХ рд╕рд╛рдорд╛рдиреНрдп рдмреИрдЪ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдЙрджрд╛рд╣рд░рдг _winrm.bat_:

<figure><img src="../../.gitbook/assets/image (2) (6) (2).png" alt=""><figcaption></figcaption></figure>

### OpenSSH <a href="#openssh" id="openssh"></a>

рдЗрд╕ рддрд░реАрдХреЗ рдХреЗ рд▓рд┐рдП рдкрд╣рд▓реЗ рд╕рд░реНрд╡рд░ рдмреЙрдХреНрд╕ рдкрд░ [OpenSSH рдЗрдВрд╕реНрдЯреЙрд▓ рдХрд░рдирд╛](https://github.com/PowerShell/Win32-OpenSSH/wiki/Install-Win32-OpenSSH) рдЖрд╡рд╢реНрдпрдХ рд╣реЛрддрд╛ рд╣реИред рд╡рд┐рдВрдбреЛрдЬ рдХреЗ рд▓рд┐рдП OpenSSH рдЗрдВрд╕реНрдЯреЙрд▓ рдХрд░рдирд╛ **рдкреВрд░реА рддрд░рд╣ рд╕реЗ CLI рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ** рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдпрд╣ рдмрд╣реБрдд рдХрдо рд╕рдордп рд▓реЗрддрд╛ рд╣реИ - рдФрд░ рдпрд╣ рдореИрд▓рд╡реЗрдпрд░ рдХреЗ рд░реВрдк рдореЗрдВ рдирд╣реАрдВ рдлреНрд▓реИрдЧ рд╣реЛрддрд╛ рд╣реИ!

рдмреЗрд╢рдХ рдХреБрдЫ рдкрд░рд┐рд╕реНрдерд┐рддрд┐рдпреЛрдВ рдореЗрдВ рдпрд╣ рд╕рдВрднрд╡ рдирд╣реАрдВ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ, рдпрд╣ рдЬреНрдпрд╛рджрд╛ рдмреЛрдЭрд┐рд▓ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рдпрд╛ рдпрд╣ рдПрдХ рд╕рд╛рдорд╛рдиреНрдп рдСрдкрд╕реЗрдХ рдЬреЛрдЦрд┐рдо рд╣реЛ рд╕рдХрддрд╛ рд╣реИред

рдпрд╣ рддрд░реАрдХрд╛ рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рдПрдХ рдЬрдВрдк рдмреЙрдХреНрд╕ рд╕реЗрдЯрдЕрдк рдкрд░ рдЙрдкрдпреЛрдЧреА рд╣реЛ рд╕рдХрддрд╛ рд╣реИ - рдЬрд╣рд╛рдВ рдПрдХ рдЕрдиреБрдкреНрд░рдпреЛрдЧреА рдиреЗрдЯрд╡рд░реНрдХ рддрдХ рдкрд╣реБрдВрдЪ рд╣реЛрддреА рд╣реИред рдПрдХ рдмрд╛рд░ SSH рдХрдиреЗрдХреНрд╢рди рд╕реНрдерд╛рдкрд┐рдд рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ, рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛/рдЖрдХреНрд░рдордгрдХрд╛рд░реА рдЕрдиреБрд░реЛрдз рдХреЗ рд░реВрдк рдореЗрдВ рдЬрд┐рддрдиреЗ рднреА `New-PSSession` рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ, рдЙрдиреНрд╣реЗрдВ рдбрдмрд▓-рд╣реЙрдк рд╕рдорд╕реНрдпрд╛ рдореЗрдВ рдзрдорд╛рдХрд╛ рдирд╣реАрдВ рдХрд░рдирд╛ рдкрдбрд╝рддрд╛ рд╣реИред

OpenSSH рдореЗрдВ **рдкрд╛рд╕рд╡рд░реНрдб рдкреНрд░рдорд╛рдгреАрдХрд░рдг** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдкрд░ (рдХреБрдВрдЬреА рдпрд╛ рдХреЗрд░рдмреЗрд░реЛрд╕ рдирд╣реАрдВ), **рд▓реЙрдЧрдСрди рдкреНрд░рдХрд╛рд░ 8** рдпрд╛рдиреА _рдиреЗрдЯрд╡рд░реНрдХ рдХреНрд▓рд┐рдпрд░ рдкрд╛рда рд▓реЙрдЧрдСрди_ рд╣реЛрддрд╛ рд╣реИред рдЗрд╕рдХрд╛ рдЕрд░реНрде рдпрд╣ рдирд╣реАрдВ рд╣реИ рдХрд┐ рдЖрдкрдХрд╛ рдкрд╛рд╕рд╡рд░реНрдб рд╕рд╛рдлрд╝ рд░реВрдк рдореЗрдВ рднреЗрдЬрд╛ рдЬрд╛рддрд╛ рд╣реИ - рдпрд╣ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ SSH рджреНрд╡рд╛рд░рд╛ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдЖрдкрдХреЗ рд╕рддреНрд░ рдХреЗ рд▓рд┐рдП рдЗрд╕рдХреЗ [рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдкреИрдХреЗрдЬ](https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-logonusera?redirectedfrom=MSDN) рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдпрд╣ рд╕реНрдкрд╖реНрдЯ рдкрд╛рда рдореЗрдВ рдЕрдирдмрдиреНрдзрд┐рдд рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ рддрд╛рдХрд┐ рдЖрдкрдХреА рд╕рддреНрд░ рдФрд░ рдЕрдзрд┐рдХ рддрд╛рдЬрдЧреА рд╕реЗ рднрд░реЗ рдЧрдП TGT рдХрд╛ рдЕрдиреБрд░реЛрдз рдХрд░ рд╕рдХреЗрдВ!

рдЗрд╕рд╕реЗ рдЖрдкрдХреЛ рдмреАрдЪрдХрд╛рд░реА рд╕рд░реНрд╡рд░ рдХреЛ рдЖрдкрдХреА рдУрд░ рд╕реЗ TGT рдХрд╛ рдЕрдиреБрд░реЛрдз рдХрд░рдиреЗ рдФрд░ рдкреНрд░рд╛рдердорд┐рдХ рд╕рд░реНрд╡рд░ рдкрд░ рд╕реНрдерд╛рдиреАрдп рд░реВрдк рд╕реЗ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдорд┐рд▓рддреА рд╣реИред рдЖрдкрдХреА рд╕рддреНрд░ рдЗрд╕ TGT рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЕрддрд┐рд░рд┐рдХреНрдд рд╕рд░реНрд╡рд░реЛрдВ рдХреЗ рдкреНрд░рддрд┐рджреНрд╡рдВрджреНрд╡реАрдХрд░рдг (PS рд░рд┐рдореЛрдЯ) рдХреЗ рд▓рд┐рдП рдкреНрд░рдорд╛рдгрд┐рдд рдХрд░ рд╕рдХрддреА рд╣реИред

#### OpenSSH рдЗрдВрд╕реНрдЯреЙрд▓ рд╕реНрдерд┐рддрд┐

рдЕрдкрдиреЗ рдЖрдХреНрд░рдордгрдХрд╛рд░реА рдмреЙрдХреНрд╕ рдкрд░ рд╕рдмрд╕реЗ рдирд╡реАрдирддрдо [OpenSSH рд░рд┐рд▓реАрдЬрд╝ рдЬрд╝рд┐рдк рдлрд╝рд╛рдЗрд▓](https://github.com/PowerShell/Win32-OpenSSH/releases) рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ рдФрд░ рдЗрд╕реЗ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░реЗрдВ (рдпрд╛ рдЗрд╕реЗ рд╕реАрдзреЗ рдЬрдВрдк рдмреЙрдХреНрд╕ рдкрд░ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ)ред

рдЬрд╣рд╛рдВ рдЪрд╛рд╣реЗрдВ рд╡рд╣рд╛рдВ рдЬрд╝рд┐рдк рдлрд╝рд╛рдЗрд▓ рдХреЛ рдЕрдирдмрдиреНрдз рдХрд░реЗрдВред рдлрд┐рд░, рдЗрдВрд╕реНрдЯреЙрд▓ рд╕реНрдХреНрд░рд┐рдкреНрдЯ - `Install-sshd.ps1` рдЪрд▓рд╛рдПрдВ

<figure><img src="../../.gitbook/assets/image (2) (1) (3).png" alt=""><figcaption></figcaption></figure>

рдЕрдВрдд рдореЗрдВ, **рдкреЛрд░реНрдЯ 22 рдЦреЛрд▓рдиреЗ** рдХреЗ рд▓рд┐рдП рдПрдХ рдлрд╝рд╛рдпрд░рд╡реЙрд▓ рдирд┐рдпрдо рдЬреЛрдбрд╝реЗрдВред SSH рд╕реЗрд╡рд╛рдПрдВ рд╕реНрдерд╛рдкрд┐рдд рд╣реЛрдиреЗ рдХреА рдкреБрд╖реНрдЯрд┐ рдХрд░реЗрдВ рдФрд░ рдЙрдиреНрд╣реЗрдВ рд╢реБрд░реВ рдХрд░реЗрдВред рдЗрди рджреЛрдиреЛрдВ рд╕реЗрд╡рд╛рдУрдВ рдХреЛ рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП SSH рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреАред

<figure><img src="../../.gitbook/assets/image (1) (7).png" alt=""><figcaption></figcaption></figure>

рдпрджрд┐ рдЖрдкрдХреЛ `Connection reset` рддреНрд░реБрдЯрд┐ рдорд┐рд▓рддреА рд╣реИ, рддреЛ рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЛ рдЕрджреНрдпрддрди рдХрд░реЗрдВ рддрд╛рдХрд┐ **рд╕рднреА: рдкрдврд╝реЗрдВ рдФрд░ рдХреНрд░рд┐рдпрд╛рдиреНрд╡рдп рдХрд░реЗрдВ** рд░реВрдЯ OpenSSH рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдкрд░ рдЕрдиреБрдорддрд┐ рд╣реЛред
```bash
icacls.exe "C:\Users\redsuit\Documents\ssh\OpenSSH-Win64" /grant Everyone:RX /T
```
## рд╕рдВрджрд░реНрдн

* [https://techcommunity.microsoft.com/t5/ask-the-directory-services-team/understanding-kerberos-double-hop/ba-p/395463?lightbox-message-images-395463=102145i720503211E78AC20](https://techcommunity.microsoft.com/t5/ask-the-directory-services-team/understanding-kerberos-double-hop/ba-p/395463?lightbox-message-images-395463=102145i720503211E78AC20)
* [https://posts.slayerlabs.com/double-hop/](https://posts.slayerlabs.com/double-hop/)
* [https://learn.microsoft.com/en-gb/archive/blogs/sergey\_babkins\_blog/another-solution-to-multi-hop-powershell-remoting](https://learn.microsoft.com/en-gb/archive/blogs/sergey\_babkins\_blog/another-solution-to-multi-hop-powershell-remoting)
* [https://4sysops.com/archives/solve-the-powershell-multi-hop-problem-without-using-credssp/](https://4sysops.com/archives/solve-the-powershell-multi-hop-problem-without-using-credssp/)

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>тШБя╕П HackTricks Cloud тШБя╕П</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ЁЯРж Twitter ЁЯРж</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ЁЯОЩя╕П Twitch ЁЯОЩя╕П</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ЁЯОе Youtube ЁЯОе</strong></a></summary>

* рдХреНрдпрд╛ рдЖрдк **рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХрдВрдкрдиреА** рдореЗрдВ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ? рдХреНрдпрд╛ рдЖрдк рдЕрдкрдиреА рдХрдВрдкрдиреА рдХреЛ **рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд** рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ? рдпрд╛ рдХреНрдпрд╛ рдЖрдк **PEASS рдХреЗ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ**? [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ!
* рдЦреЛрдЬреЗрдВ [**The PEASS Family**](https://opensea.io/collection/the-peass-family), рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ рд╕рдВрдЧреНрд░рд╣ [**NFTs**](https://opensea.io/collection/the-peass-family)
* рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks swag**](https://peass.creator-spring.com)
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** [**ЁЯТм**](https://emojipedia.org/speech-balloon/) [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рдореБрдЭреЗ **рдЯреНрд╡рд┐рдЯрд░** рдкрд░ **рдлрд╝реЙрд▓реЛ** рдХрд░реЗрдВ [**ЁЯРж**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ рджреНрд╡рд╛рд░рд╛ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **рдФрд░** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **рдХреЛред**

</details>
