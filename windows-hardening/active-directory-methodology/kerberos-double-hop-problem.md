# рдХреЗрд░рдмреЗрд░реЛрд╕ рдбрдмрд▓ рд╣реЙрдк рд╕рдорд╕реНрдпрд╛

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>тШБя╕П рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдХреНрд▓рд╛рдЙрдб тШБя╕П</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ЁЯРж рдЯреНрд╡рд┐рдЯрд░ ЁЯРж</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ЁЯОЩя╕П рдЯреНрд╡рд┐рдЪ ЁЯОЩя╕П</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ЁЯОе рдпреВрдЯреНрдпреВрдм ЁЯОе</strong></a></summary>

* рдХреНрдпрд╛ рдЖрдк **рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХрдВрдкрдиреА** рдореЗрдВ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ? рдХреНрдпрд╛ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдореЗрдВ** рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ? рдпрд╛ рдХреНрдпрд╛ рдЖрдк **PEASS рдХреЗ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдпрд╛ рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдХреЛ рдкреАрдбреАрдПрдл рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб** рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ? [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ!
* [**рдж рдкреАрдПрд╕ рдлреИрдорд┐рд▓реА**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**рдПрдирдПрдлрдЯреА**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣ рджреЗрдЦреЗрдВ
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ рдкреАрдПрд╕ рдФрд░ рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** [**ЁЯТм**](https://emojipedia.org/speech-balloon/) [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ **рдореЗрд░рд╛** **рдЯреНрд╡рд┐рдЯрд░** **ЁЯРж**[**@carlospolopm**](https://twitter.com/hacktricks_live)** рдХрд╛** **рдкрд╛рд▓рди** рдХрд░реЗрдВред
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ рджреНрд╡рд╛рд░рд╛ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ** [**рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рд░реЗрдкреЛ**](https://github.com/carlospolop/hacktricks) **рдФрд░** [**hacktricks-cloud рд░реЗрдкреЛ**](https://github.com/carlospolop/hacktricks-cloud)ред

</details>

## рдкрд░рд┐рдЪрдп

рдХреЗрд░рдмреЗрд░реЛрд╕ "рдбрдмрд▓ рд╣реЙрдк" рд╕рдорд╕реНрдпрд╛ рдЙрддреНрдкрдиреНрди рд╣реЛрддреА рд╣реИ рдЬрдм рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рджреЛ **рд╣реЙрдк** рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ **рдХреЗрд░рдмреЗрд░реЛрд╕ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХрд╛ рдЙрдкрдпреЛрдЧ** рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рддрд╛ рд╣реИ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП **PowerShell**/**WinRM** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗред

рдЬрдм **рдХреЗрд░рдмреЗрд░реЛрд╕** рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ **рдкреНрд░рдорд╛рдгреАрдХрд░рдг** рд╣реЛрддрд╛ рд╣реИ, **рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓** **рдореЗрдореЛрд░реА рдореЗрдВ рдХреИрд╢ рдирд╣реАрдВ** рд╣реЛрддреА рд╣реИрдВред рдЗрд╕рд▓рд┐рдП, рдпрджрд┐ рдЖрдк mimikatz рдЪрд▓рд╛рддреЗ рд╣реИрдВ рддреЛ рдЖрдкрдХреЛ рдкреНрд░рдпреЛрдХреНрддрд╛ рдХреЗ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдорд╢реАрди рдореЗрдВ рдирд╣реАрдВ рдорд┐рд▓реЗрдВрдЧреЗ рднрд▓реЗ рд╣реА рд╡рд╣ рдкреНрд░рдХреНрд░рд┐рдпрд╛рдПрдБ рдЪрд▓рд╛ рд░рд╣рд╛ рд╣реЛред

рдпрд╣ рдЗрд╕рд▓рд┐рдП рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдХреЗрд░рдмреЗрд░реЛрд╕ рдХреЗ рд╕рд╛рде рдХрдиреЗрдХреНрдЯ рдХрд░рддреЗ рд╕рдордп рдпреЗ рдХрджрдо рд╣реЛрддреЗ рд╣реИрдВ:

1. рдкреНрд░рдпреЛрдХреНрддрд╛1 рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ рдФрд░ **рдбреЛрдореЗрди рдХрдВрдЯреНрд░реЛрд▓рд░** рдкреНрд░рдпреЛрдХреНрддрд╛1 рдХреЛ рдПрдХ рдХреЗрд░рдмреЗрд░реЛрд╕ **TGT** рд▓реМрдЯрд╛рддрд╛ рд╣реИред
2. рдкреНрд░рдпреЛрдХреНрддрд╛1 **TGT** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ **рд╕реЗрд╡рд╛ рдЯрд┐рдХрдЯ** рдХрд╛ рдЕрдиреБрд░реЛрдз рдХрд░рддрд╛ рд╣реИ **рд╕рд░реНрд╡рд░1** рд╕реЗ **рдХрдиреЗрдХреНрдЯ** рд╣реЛрдиреЗ рдХреЗ рд▓рд┐рдПред
3. рдкреНрд░рдпреЛрдХреНрддрд╛1 **рд╕рд░реНрд╡рд░1** рд╕реЗ **рдХрдиреЗрдХреНрдЯ** рдХрд░рддрд╛ рд╣реИ рдФрд░ **рд╕реЗрд╡рд╛ рдЯрд┐рдХрдЯ** рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред
4. **рд╕рд░реНрд╡рд░1** рдореЗрдВ рдкреНрд░рдпреЛрдХреНрддрд╛1 рдХреЗ **рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓** рдпрд╛ **TGT** рдирд╣реАрдВ рд╣реЛрддреЗ рд╣реИрдВред рдЗрд╕рд▓рд┐рдП, рдЬрдм рдкреНрд░рдпреЛрдХреНрддрд╛1 рд╕рд░реНрд╡рд░1 рд╕реЗ рджреВрд╕рд░реЗ рд╕рд░реНрд╡рд░ рдореЗрдВ рд▓реЙрдЧрд┐рди рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рддрд╛ рд╣реИ, рд╡рд╣ **рдкреНрд░рдорд╛рдгреАрдХрд░рдг** рдирд╣реАрдВ рдХрд░ рдкрд╛рддрд╛ рд╣реИред

### рдЕрд╕реАрдорд┐рдд рдЕрдиреБрдмрдВрдзрди

рдпрджрд┐ PC рдореЗрдВ **рдЕрд╕реАрдорд┐рдд рдЕрдиреБрдмрдВрдзрди** рд╕рдХреНрд╖рдо рд╣реИ, рддреЛ рдпрд╣ рдирд╣реАрдВ рд╣реЛрдЧрд╛ рдХреНрдпреЛрдВрдХрд┐ **рд╕рд░реНрд╡рд░** рдХреЛ рдЙрд╕реЗ рдПрдХ рднреА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХрд╛ **TGT** рдорд┐рд▓реЗрдЧрд╛ рдЬреЛ рдЗрд╕реЗ рдПрдХреНрд╕реЗрд╕ рдХрд░ рд░рд╣рд╛ рд╣реИред рдЗрд╕рдХреЗ рдЕрддрд┐рд░рд┐рдХреНрдд, рдпрджрд┐ рдЕрд╕реАрдорд┐рдд рдЕрдиреБрдмрдВрдзрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рддреЛ рдЖрдк рд╢рд╛рдпрдж рдЗрд╕рд╕реЗ **рдбреЛрдореЗрди рдХрдВрдЯреНрд░реЛрд▓рд░** рдХреЛ **рдХрдВрдкреНрд░реЛрдорд╛рдЗрдЬ** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред\
[**рдЕрд╕реАрдорд┐рдд рдЕрдиреБрдмрдВрдзрди рдкреГрд╖реНрда рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА**](unconstrained-delegation.md)ред

### CredSSP

рдЗрд╕ рд╕рдорд╕реНрдпрд╛ рд╕реЗ рдмрдЪрдиреЗ рдХреЗ рд▓рд┐рдП **рд╕рд┐рд╕реНрдЯрдо рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХреЛрдВ** рдХреЗ рд▓рд┐рдП рдПрдХ рдФрд░ рд╕реБрдЭрд╛рд╡ рдЬреЛ [**рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рдЕрд╕реБрд░рдХреНрд╖рд┐рдд рд╣реИ**](https://docs.microsoft.com/en-us/powershell/module/microsoft.wsman.management/enable-wsmancredssp?view=powershell-7) рд╣реИ **рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рд╕реБрд░рдХреНрд╖рд╛ рд╕рдорд░реНрдерди рдкреНрд░рджрд╛рддрд╛**ред CredSSP рдХреЛ рд╕рдХреНрд╖рдо рдХрд░рдирд╛ рд╡рд░реНрд╖реЛрдВ рд╕реЗ рд╡рд┐рднрд┐рдиреНрди рдлреЛрд░рдореЛрдВ рдореЗрдВ рдЙрд▓реНрд▓реЗрдЦрд┐рдд рд╕рдорд╛рдзрд╛рди рд░рд╣рд╛ рд╣реИред рдорд╛рдЗрдХреНрд░реЛрд╕реЙрдлреНрдЯ рд╕реЗ:

_тАЬCredSSP рдкреНрд░рдорд╛рдгреАрдХрд░рдг рд╕реНрдерд╛рдиреАрдп рдХрдВрдкреНрдпреВрдЯрд░ рд╕реЗ рджреВрд░рд╕реНрде рдХрдВрдкреНрдпреВрдЯрд░ рдХреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдЕрдиреБрдкреНрд░реЗрд╖рд┐рдд рдХрд░рддрд╛ рд╣реИред рдпрд╣ рдЕрднреНрдпрд╛рд╕ рджреВрд░рд╕реНрде рд╕рдВрдЪрд╛рд▓рди рдХрд╛ рд╕реБрд░рдХреНрд╖рд╛ рдЬреЛрдЦрд┐рдо рдмрдврд╝рд╛рддрд╛ рд╣реИред рдпрджрд┐ рджреВрд░рд╕реНрде рдХрдВрдкреНрдпреВрдЯрд░ рдХреЛ рдХрдВрдкреНрд░реЛрдорд╛рдЗрдЬрд╝ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬрдм рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдЙрд╕реЗ рдкрд╛рд░рд┐рдд рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ, рддреЛ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдиреЗрдЯрд╡рд░реНрдХ рд╕рддреНрд░ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИредтАЭ_

рдпрджрд┐ рдЙрддреНрдкрд╛рджрди рд╕рд┐рд╕реНрдЯрдореЛрдВ, рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдиреЗрдЯрд╡рд░реНрдХ рдЖрджрд┐ рдкрд░ **CredSSP рд╕рдХреНрд╖рдо** рдкрд╛рдП рдЬрд╛рддреЗ рд╣реИрдВ, рддреЛ рд╕реБрдЭрд╛рд╡ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдХрд┐ рдЙрдиреНрд╣реЗрдВ рдЕрдХреНрд╖рдо рдХрд┐рдпрд╛ рдЬрд╛рдПред CredSSP рд╕реНрдерд┐рддрд┐ рдХреА рдЬрд╛рдВрдЪ рдХрд░рдиреЗ рдХрд╛ рдПрдХ рддреНрд╡рд░рд┐рдд рддрд░реАрдХрд╛ рд╣реИ `Get-WSManCredSSP` рдЪрд▓рд╛рдХрд░ред рдЬреЛ рджреВрд░рд╕реНрде рд╕реЗ рдирд┐рд╖реНрдХреНрд░рд┐рдп рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдпрджрд┐ WinRM рд╕рдХреНрд╖рдо рд╣реИред
```powershell
Invoke-Command -ComputerName bizintel -Credential ta\redsuit -ScriptBlock {
Get-WSManCredSSP
}
```
## рдХрд╛рд░реНрдпрд╛рд░реВрдкрдг

### рдЖрд╡рд╛рдЬрд╝ рдХрдорд╛рдВрдб <a href="#invoke-command" id="invoke-command"></a>

рдпрд╣ рд╡рд┐рдзрд┐ рджреЛрд╣рд░реА рд╣реЙрдк рд╕рдорд╕реНрдпрд╛ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдиреЗ рдХреА рддрд░рд╣ рд╣реИ, рдЬрд┐рд╕реЗ рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИред рдЗрд╕рдореЗрдВ рдХреЛрдИ рд╡рд┐рдиреНрдпрд╛рд╕ рдирд╣реАрдВ рд╣реИ, рдФрд░ рдЖрдк рдЗрд╕реЗ рдЖрд╕рд╛рдиреА рд╕реЗ рдЕрдкрдиреЗ рд╣рдорд▓реЗ рд╡рд╛рд▓реЗ рдмреЙрдХреНрд╕ рд╕реЗ рдЪрд▓рд╛ рд╕рдХрддреЗ рд╣реИрдВред рдпрд╣ рдореВрд▓ рд░реВрдк рд╕реЗ рдПрдХ **рдиреЗрд╕реНрдЯреЗрдб `Invoke-Command`** рд╣реИред

рдпрд╣ **рджреВрд╕рд░реЗ рд╕рд░реНрд╡рд░ рдкрд░ `hostname`** рдЪрд▓рд╛рдПрдЧрд╛:
```powershell
$cred = Get-Credential ta\redsuit
Invoke-Command -ComputerName bizintel -Credential $cred -ScriptBlock {
Invoke-Command -ComputerName secdev -Credential $cred -ScriptBlock {hostname}
}
```
рдЖрдк рдПрдХ **PS-Session** рдХреЛ **рдкрд╣рд▓реЗ рд╕рд░реНрд╡рд░** рдХреЗ рд╕рд╛рде рд╕реНрдерд╛рдкрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдмрд╕ рд╡рд╣рд╛рдВ рд╕реЗ **`Invoke-Command`** рдХреЛ `$cred` рдХреЗ рд╕рд╛рде **рдЪрд▓рд╛** рд╕рдХрддреЗ рд╣реИрдВ рдЗрд╕реЗ рдиреЗрд╕реНрдЯ рдХрд░рдиреЗ рдХреА рдмрдЬрд╛рдпред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЕрдкрдиреЗ рд╣рдорд▓рд╛рд╡рд╛рд░ рдмреЙрдХреНрд╕ рд╕реЗ рдЗрд╕реЗ рдЪрд▓рд╛рдирд╛ рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рдХреЛ рдХреЗрдВрджреНрд░реАрдХреГрдд рдХрд░рддрд╛ рд╣реИ:
```powershell
# From the WinRM connection
$pwd = ConvertTo-SecureString 'uiefgyvef$/E3' -AsPlainText -Force
$cred = New-Object System.Management.Automation.PSCredential('DOMAIN\username', $pwd)
# Use "-Credential $cred" option in Powerview commands
```
### рд░рдЬрд┐рд╕реНрдЯрд░ PSSession Configuration

рдпрджрд┐ **`evil-winrm`** рдХрд╛ рдЙрдкрдпреЛрдЧ рди рдХрд░рдХреЗ рдЖрдк **`Enter-PSSession`** cmdlet рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рддреЛ рдЖрдк рдлрд┐рд░ **`Register-PSSessionConfiguration`** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдбрдмрд▓ рд╣реЙрдк рд╕рдорд╕реНрдпрд╛ рдХреЛ рдЕрдирджреЗрдЦрд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкреБрдирдГ рдХрдиреЗрдХреНрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```powershell
# Register a new PS Session configuration
Register-PSSessionConfiguration -Name doublehopsess -RunAsCredential domain_name\username
# Restar WinRM
Restart-Service WinRM
# Get a PSSession
Enter-PSSession -ConfigurationName doublehopsess -ComputerName <pc_name> -Credential domain_name\username
# Check that in this case the TGT was sent and is in memory of the PSSession
klist
# In this session you won't have the double hop problem anymore
```
### рдкреЛрд░реНрдЯ рдлреЙрд░рд╡рд░реНрдбрд┐рдВрдЧ <a href="#portproxy" id="portproxy"></a>

рдХреНрдпреЛрдВрдХрд┐ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдЗрдВрдЯрд░рдореАрдбрд┐рдПрдЯ рдЯрд╛рд░рдЧреЗрдЯ **bizintel: 10.35.8.17** рдкрд░ рд╕реНрдерд╛рдиреАрдп рдкреНрд░рд╢рд╛рд╕рдХ рд╣реИ, рдЖрдк рдПрдХ рдкреЛрд░реНрдЯ рдлреЙрд░рд╡рд░реНрдбрд┐рдВрдЧ рдирд┐рдпрдо рдЬреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рдЖрдкрдХреЗ рдЕрдиреБрд░реЛрдз рдЕрдВрддрд┐рдо/рддреАрд╕рд░реЗ рд╕рд░реНрд╡рд░ **secdev: 10.35.8.23** рдкрд░ рднреЗрдЬреЗ рдЬрд╛ рд╕рдХреЗрдВред

**netsh** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЖрдк рдПрдХ рд╡рди-рд▓рд╛рдЗрдирд░ рдирд┐рдХрд╛рд▓рдХрд░ рдирд┐рдпрдо рдЬреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВред
```bash
netsh interface portproxy add v4tov4 listenport=5446 listenaddress=10.35.8.17 connectport=5985 connectaddress=10.35.8.23
```
рдЗрд╕рд▓рд┐рдП **рдкрд╣рд▓рд╛ рд╕рд░реНрд╡рд░** рдкреЛрд░реНрдЯ 5446 рдкрд░ рд╕реБрди рд░рд╣рд╛ рд╣реИ рдФрд░ 5446 рдкрд░ рдкрд╣реБрдВрдЪрдиреЗ рд╡рд╛рд▓реЗ рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ **рджреВрд╕рд░реЗ рд╕рд░реНрд╡рд░** рдкреЛрд░реНрдЯ 5985 (рдпрд╛рдиреА WinRM) рдкрд░ рдлреЙрд░рд╡рд░реНрдб рдХрд░реЗрдЧрд╛ред

рдлрд┐рд░ Windows рдлрд╝рд╛рдпрд░рд╡реЙрд▓ рдореЗрдВ рдПрдХ рд╣реЛрд▓ рдмрдирд╛рдПрдВ, рдЬрд┐рд╕реЗ рдПрдХ рддреЗрдЬ netsh one-liner рдХреЗ рд╕рд╛рде рднреА рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред
```bash
netsh advfirewall firewall add rule name=fwd dir=in action=allow protocol=TCP localport=5446
```
рдЕрдм рд╕рддреНрд░ рд╕реНрдерд╛рдкрд┐рдд рдХрд░реЗрдВ, рдЬреЛ рд╣рдореЗрдВ **рдкрд╣рд▓реЗ рд╕рд░реНрд╡рд░** рдХреА рдУрд░ рдЕрдЧреНрд░реЗрд╖рд┐рдд рдХрд░реЗрдЧрд╛ред

<figure><img src="../../.gitbook/assets/image (3) (5) (1).png" alt=""><figcaption></figcaption></figure>

#### winrs.exe <a href="#winrsexe" id="winrsexe"></a>

**Portforwarding WinRM** рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ рднреА рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рдпрд╣ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ рдЬрдм **`winrs.exe`** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдпрджрд┐ рдЖрдкрдХреЛ рдпрд╣ рдкрддрд╛ рд╣реИ рдХрд┐ PowerShell рдХреЛ рдореЙрдирд┐рдЯрд░ рдХрд┐рдпрд╛ рдЬрд╛ рд░рд╣рд╛ рд╣реИ, рддреЛ рдпрд╣ рдПрдХ рдмреЗрд╣рддрд░ рд╡рд┐рдХрд▓реНрдк рд╣реЛ рд╕рдХрддрд╛ рд╣реИред рдиреАрдЪреЗ рджрд┐рдП рдЧрдП рдХрдорд╛рдВрдб рд╕реЗ `hostname` рдХреЗ рд░реВрдк рдореЗрдВ тАЬ**secdev**тАЭ рд▓реМрдЯрд╛рддрд╛ рд╣реИред
```bash
winrs -r:http://bizintel:5446 -u:ta\redsuit -p:2600leet hostname
```
### OpenSSH <a href="#openssh" id="openssh"></a>

рдЗрд╕ рддрдХрдиреАрдХ рдХреЗ рд▓рд┐рдП [OpenSSH рдЗрдВрд╕реНрдЯреЙрд▓ рдХрд░рдирд╛ рдЖрд╡рд╢реНрдпрдХ рд╣реИ](https://github.com/PowerShell/Win32-OpenSSH/wiki/Install-Win32-OpenSSH) рдкрд╣рд▓реЗ рд╕рд░реНрд╡рд░ рдмреЙрдХреНрд╕ рдкрд░ред Windows рдХреЗ рд▓рд┐рдП OpenSSH рдЗрдВрд╕реНрдЯреЙрд▓ рдХрд░рдирд╛ **рдкреВрд░реА рддрд░рд╣ рд╕реЗ CLI рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ** рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдпрд╣ рдмрд╣реБрдд рдХрдо рд╕рдордп рд▓реЗрддрд╛ рд╣реИ - рдФрд░ рдпрд╣ рдореИрд▓рд╡реЗрдпрд░ рдХреЗ рд░реВрдк рдореЗрдВ рдлреНрд▓реИрдЧ рдирд╣реАрдВ рдХрд░рддрд╛!

рдпрд╣ рд╕реНрдерд┐рддрд┐рдпреЛрдВ рдореЗрдВ рд╕рдВрднрд╛рд╡рдирд╛ рд╣реИ рдХрд┐ рдпрд╣ рд╕рдВрднрд╡ рдирд╣реАрдВ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ, рдмрд╣реБрдд рдЬреНрдпрд╛рджрд╛ рдХрдард┐рди рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рдпрд╛ рд╕рд╛рдорд╛рдиреНрдп OpSec рдЬреЛрдЦрд┐рдо рд╣реЛ рд╕рдХрддрд╛ рд╣реИред

рдпрд╣ рддрдХрдиреАрдХ рдПрдХ рдЬрдВрдк рдмреЙрдХреНрд╕ рд╕реЗрдЯрдЕрдк рдкрд░ рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рдЙрдкрдпреЛрдЧреА рд╣реЛ рд╕рдХрддреА рд╣реИ - рдЬрд┐рд╕рдореЗрдВ рдПрдХ рдЕрдиреНрдпрдерд╛ рдкрд╣реБрдВрдЪ рдпреЛрдЧреНрдп рдиреЗрдЯрд╡рд░реНрдХ рддрдХ рдкрд╣реБрдВрдЪ рд╣реЛред рдПрдХ рдмрд╛рд░ SSH рдХрдиреЗрдХреНрд╢рди рд╕реНрдерд╛рдкрд┐рдд рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ, рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛/рд╣рдорд▓рд╛рд╡рд░ рдбрдмрд▓-рд╣реЙрдк рд╕рдорд╕реНрдпрд╛ рдореЗрдВ рдмрд┐рдирд╛ рдзрдорд╛рдХреЗ рдХреЗ рд╕реЗрдЧрдореЗрдВрдЯреЗрдб рдиреЗрдЯрд╡рд░реНрдХ рдХреЗ рдЦрд┐рд▓рд╛рдл рдЬрд┐рддрдиреЗ рднреА `New-PSSession` рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛ, рдЙрдиреНрд╣реЗрдВ рдЖрдЧ рд▓рдЧрд╛ рд╕рдХрддрд╛ рд╣реИред

рдЬрдм OpenSSH рдореЗрдВ **рдкрд╛рд╕рд╡рд░реНрдб рдкреНрд░рдорд╛рдгреАрдХрд░рдг** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ (рдХреБрдВрдЬрд┐рдпреЛрдВ рдпрд╛ рдХрд░реНрдмреЗрд░реЛрд╕ рдирд╣реАрдВ), рддреЛ **рд▓реЙрдЧрдСрди рдкреНрд░рдХрд╛рд░ 8** рдпрд╛рдиреА _рдиреЗрдЯрд╡рд░реНрдХ рдХреНрд▓рд┐рдпрд░ рдкрд╛рда рд▓реЙрдЧрдСрди_ рд╣реЛрддрд╛ рд╣реИред рдпрд╣ рдпрд╣ рдирд╣реАрдВ рдорд╛рдирдирд╛ рдЪрд╛рд╣рд┐рдП рдХрд┐ рдЖрдкрдХрд╛ рдкрд╛рд╕рд╡рд░реНрдб рд╕рд╛рдлрд╝ рдкрд╛рда рдореЗрдВ рднреЗрдЬрд╛ рдЬрд╛рддрд╛ рд╣реИ - рдпрд╣ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ SSH рджреНрд╡рд╛рд░рд╛ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдЖрдкрдХреЗ рд╕рддреНрд░ рдХреЗ рд▓рд┐рдП рдпрд╣ рдЖрдЧрдорди рдХреЗ рд╕рдордп рдЕрдкрдиреЗ [рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдкреИрдХреЗрдЬ](https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-logonusera?redirectedfrom=MSDN) рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╕реНрдкрд╖реНрдЯ рдкрд╛рда рдореЗрдВ рдЕрдирдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ рддрд╛рдХрд┐ рдЖрдкрдХрд╛ рд╕рддреНрд░ рдФрд░ рдЕрдзрд┐рдХ рд╕рд░реНрд╡рд░реЛрдВ рдХреЗ рд▓рд┐рдП рдЬреВрд╕реА TGT рдХрд╛ рдЕрдиреБрд░реЛрдз рдХрд░ рд╕рдХреЗ!

рдЗрд╕рд╕реЗ рдЕрдВрддрд░рд╡рд░реНрддреА рд╕рд░реНрд╡рд░ рдЖрдкрдХреЗ рдкрдХреНрд╖ рдореЗрдВ рдПрдХ TGT рдХрд╛ рдЕрдиреБрд░реЛрдз рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рд╕реНрдерд╛рдиреАрдп рд░реВрдк рд╕реЗ рдЗрд╕реЗ рд╕реНрдЯреЛрд░ рдХрд░ рд╕рдХрддрд╛ рд╣реИред рдЖрдкрдХрд╛ рд╕рддреНрд░ рдлрд┐рд░ рдЗрд╕ TGT рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдЕрдзрд┐рдХ рд╕рд░реНрд╡рд░реЛрдВ рдХреЗ рдкреНрд░рдорд╛рдгреАрдХрд░рдг(PS рд░рд┐рдореЛрдЯ) рдХреЗ рд▓рд┐рдПред

#### OpenSSH рдЗрдВрд╕реНрдЯреЙрд▓ рд╕реНрдерд┐рддрд┐

рдирд╡реАрдирддрдо [OpenSSH рд░рд┐рд▓реАрдЬрд╝ рдЬрд╝рд┐рдк рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ github рд╕реЗ](https://github.com/PowerShell/Win32-OpenSSH/releases) рдФрд░ рдЗрд╕реЗ рдЕрдкрдиреЗ рд╣рдорд▓рд╛рд╡рд░ рдмреЙрдХреНрд╕ рдкрд░ рд▓реЗ рдЬрд╛рдПрдВ рдФрд░ рдЗрд╕реЗ рд╡рд╣рд╛рдБ рд▓реЗ рдЬрд╛рдПрдВ (рдпрд╛ рд╕реАрдзреЗ рдЬрдВрдк рдмреЙрдХреНрд╕ рдкрд░ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ)ред

рдЬрд╣рд╛рдБ рдЪрд╛рд╣реЗрдВ рд╡рд╣рд╛рдБ рдЬрд╝рд┐рдк рдХреЛ рдЕрдирдЬрд╝рд┐рдк рдХрд░реЗрдВред рдлрд┐рд░, рдЗрдВрд╕реНрдЯреЙрд▓ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдЪрд▓рд╛рдПрдВ - `Install-sshd.ps1`

рдЕрдВрддрддрдГ, рдмрд╕ рдлрд╛рдпрд░рд╡реЙрд▓ рдирд┐рдпрдо рдЬреЛрдбрд╝реЗрдВ **рдкреЛрд░реНрдЯ 22 рдЦреЛрд▓рдиреЗ** рдХреЗ рд▓рд┐рдПред рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░реЗрдВ рдХрд┐ SSH рд╕реЗрд╡рд╛рдПрдВ рдЗрдВрд╕реНрдЯреЙрд▓ рдХреА рдЧрдИ рд╣реИрдВ, рдФрд░ рдЙрдиреНрд╣реЗрдВ рд╢реБрд░реВ рдХрд░реЗрдВред рдпреЗ рджреЛрдиреЛрдВ рд╕реЗрд╡рд╛рдПрдВ SSH рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЪрд╛рд▓реВ рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдПред

рдпрджрд┐ рдЖрдкрдХреЛ `Connection reset` рддреНрд░реБрдЯрд┐ рдорд┐рд▓рддреА рд╣реИ, рддреЛ рдЕрдиреБрдорддрд┐рдпрд╛рдБ рдЕрдкрдбреЗрдЯ рдХрд░реЗрдВ рддрд╛рдХрд┐ **рд╕рднреА: рдкрдврд╝реЗрдВ рдФрд░ рдХреНрд░рд┐рдпрд╛рдиреНрд╡рд┐рдд рдХрд░реЗрдВ** рд░реВрдЯ OpenSSH рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдкрд░ред
```bash
icacls.exe "C:\Users\redsuit\Documents\ssh\OpenSSH-Win64" /grant Everyone:RX /T
```
## рд╕рдВрджрд░реНрдн

* [https://techcommunity.microsoft.com/t5/ask-the-directory-services-team/understanding-kerberos-double-hop/ba-p/395463?lightbox-message-images-395463=102145i720503211E78AC20](https://techcommunity.microsoft.com/t5/ask-the-directory-services-team/understanding-kerberos-double-hop/ba-p/395463?lightbox-message-images-395463=102145i720503211E78AC20)
* [https://posts.slayerlabs.com/double-hop/](https://posts.slayerlabs.com/double-hop/)
* [https://learn.microsoft.com/en-gb/archive/blogs/sergey\_babkins\_blog/another-solution-to-multi-hop-powershell-remoting](https://learn.microsoft.com/en-gb/archive/blogs/sergey\_babkins\_blog/another-solution-to-multi-hop-powershell-remoting)
* [https://4sysops.com/archives/solve-the-powershell-multi-hop-problem-without-using-credssp/](https://4sysops.com/archives/solve-the-powershell-multi-hop-problem-without-using-credssp/)

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>тШБя╕П HackTricks Cloud тШБя╕П</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ЁЯРж Twitter ЁЯРж</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ЁЯОЩя╕П Twitch ЁЯОЩя╕П</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ЁЯОе Youtube ЁЯОе</strong></a></summary>

* рдХреНрдпрд╛ рдЖрдк **рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХрдВрдкрдиреА** рдореЗрдВ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ? рдХреНрдпрд╛ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХрд╛ рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрди рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ**? рдпрд╛ рдХреНрдпрд╛ рдЖрдк **PEASS рдХреЗ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдпрд╛ рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдХреЛ рдкреАрдбреАрдПрдл рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ**? [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рди**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ!
* рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣ **The PEASS Family** рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** [**ЁЯТм**](https://emojipedia.org/speech-balloon/) [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рдореБрдЭреЗ **рдЯреНрд╡рд┐рдЯрд░** рдкрд░ **ЁЯРж**[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ** [**рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рд░реЗрдкреЛ**](https://github.com/carlospolop/hacktricks) **рдФрд░** [**рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕-рдХреНрд▓рд╛рдЙрдб рд░реЗрдкреЛ**](https://github.com/carlospolop/hacktricks-cloud) **рдХреЛ PR рдЬрдорд╛ рдХрд░рдХреЗред**

</details>
