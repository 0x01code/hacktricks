# Active Directory рдкрджреНрдзрддрд┐

<details>

<summary><strong>AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рд╢реВрдиреНрдп рд╕реЗ рдирд╛рдпрдХ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рдХрд╛ рд╕рдВрдЧреНрд░рд╣
* ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ [**telegram group**](https://t.me/peass) рдореЗрдВ рдпрд╛ **Twitter** ЁЯРж рдкрд░ рдореБрдЭреЗ **рдлреЙрд▓реЛ** рдХрд░реЗрдВ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **HackTricks** рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВред

</details>

## рдореВрд▓ рдЕрд╡рд▓реЛрдХрди

Active Directory рдиреЗрдЯрд╡рд░реНрдХ рдкреНрд░рд╢рд╛рд╕рдХреЛрдВ рдХреЛ рдбреЛрдореЗрди, рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдФрд░ рдиреЗрдЯрд╡рд░реНрдХ рдХреЗ рднреАрддрд░ рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рдмрдирд╛рдиреЗ рдФрд░ рдкреНрд░рдмрдВрдзрд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдПрдХ рдкреНрд░рд╢рд╛рд╕рдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХрд╛ рдПрдХ рд╕рдореВрд╣ рдмрдирд╛ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдЙрдиреНрд╣реЗрдВ рд╕рд░реНрд╡рд░ рдкрд░ рдХреБрдЫ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛рдУрдВ рддрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдкрд╣реБрдВрдЪ рдЕрдзрд┐рдХрд╛рд░ рджреЗ рд╕рдХрддрд╛ рд╣реИред рдЬреИрд╕реЗ-рдЬреИрд╕реЗ рдиреЗрдЯрд╡рд░реНрдХ рдмрдврд╝рддрд╛ рд╣реИ, Active Directory рдмрдбрд╝реА рд╕рдВрдЦреНрдпрд╛ рдореЗрдВ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рддрд╛рд░реНрдХрд┐рдХ рд╕рдореВрд╣реЛрдВ рдФрд░ рдЙрдкрд╕рдореВрд╣реЛрдВ рдореЗрдВ рд╡реНрдпрд╡рд╕реНрдерд┐рдд рдХрд░рдиреЗ рдФрд░ рдкреНрд░рддреНрдпреЗрдХ рд╕реНрддрд░ рдкрд░ рдкрд╣реБрдВрдЪ рдирд┐рдпрдВрддреНрд░рдг рдкреНрд░рджрд╛рди рдХрд░рдиреЗ рдХрд╛ рдПрдХ рддрд░реАрдХрд╛ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред

Active Directory рд╕рдВрд░рдЪрдирд╛ рдореЗрдВ рддреАрди рдореБрдЦреНрдп рд╕реНрддрд░ рд╢рд╛рдорд┐рд▓ рд╣реИрдВ: 1) рдбреЛрдореЗрди, 2) рд╡реГрдХреНрд╖, рдФрд░ 3) рд╡рдиред рдХрдИ рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ (рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдпрд╛ рдЙрдкрдХрд░рдг) рдЬреЛ рдПрдХ рд╣реА рдбреЗрдЯрд╛рдмреЗрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ, рдПрдХ рд╣реА рдбреЛрдореЗрди рдореЗрдВ рд╕рдореВрд╣рд┐рдд рдХрд┐рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВред рдХрдИ рдбреЛрдореЗрди рдХреЛ рдПрдХ рд╣реА рд╕рдореВрд╣ рдореЗрдВ рдЬреЛрдбрд╝рд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдЬрд┐рд╕реЗ рд╡реГрдХреНрд╖ рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИред рдХрдИ рд╡реГрдХреНрд╖реЛрдВ рдХреЛ рдПрдХ рд╕рдВрдЧреНрд░рд╣ рдореЗрдВ рд╕рдореВрд╣рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдЬрд┐рд╕реЗ рд╡рди рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИред рдЗрди рд╕реНрддрд░реЛрдВ рдореЗрдВ рд╕реЗ рдкреНрд░рддреНрдпреЗрдХ рдХреЛ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдкрд╣реБрдВрдЪ рдЕрдзрд┐рдХрд╛рд░ рдФрд░ рд╕рдВрдЪрд╛рд░ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рджрд┐рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВред

Active Directory рдХреА рдореБрдЦреНрдп рдЕрд╡рдзрд╛рд░рдгрд╛рдПрдБ:

1. **рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛** тАУ Active directory рдХреЗ рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рдХреА рд╕рднреА рдЬрд╛рдирдХрд╛рд░реА рд╢рд╛рдорд┐рд▓ рд╣реЛрддреА рд╣реИ
2. **рдСрдмреНрдЬреЗрдХреНрдЯ** тАУ рдПрдХ рдСрдмреНрдЬреЗрдХреНрдЯ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХреЗ рднреАрддрд░ рд▓рдЧрднрдЧ рдХрд┐рд╕реА рднреА рдЪреАрдЬ рдХреЛ рд╕рдВрджрд░реНрднрд┐рдд рдХрд░рддрд╛ рд╣реИ (рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛, рд╕рдореВрд╣, рд╕рд╛рдЭрд╛ рдлрд╝реЛрд▓реНрдбрд░...)
3. **рдбреЛрдореЗрди** тАУ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХреЗ рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рдбреЛрдореЗрди рдХреЗ рднреАрддрд░ рд╕рдорд╛рд╣рд┐рдд рд╣реЛрддреЗ рд╣реИрдВред "рд╡рди" рдХреЗ рднреАрддрд░ рдПрдХ рд╕реЗ рдЕрдзрд┐рдХ рдбреЛрдореЗрди рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдкреНрд░рддреНрдпреЗрдХ рдХреЗ рдЕрдкрдиреЗ рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рд╕рдВрдЧреНрд░рд╣ рд╣реЛрдВрдЧреЗред
4. **рд╡реГрдХреНрд╖** тАУ рдПрдХ рд╣реА рдореВрд▓ рдХреЗ рд╕рд╛рде рдбреЛрдореЗрди рдХрд╛ рд╕рдореВрд╣ред рдЙрджрд╛рд╣рд░рдг: _dom.local, email.dom.local, www.dom.local_
5. **рд╡рди** тАУ рд╡рди рд╕рдВрдЧрдарди рдкрджрд╛рдиреБрдХреНрд░рдо рдХрд╛ рд╕рдмрд╕реЗ рдКрдВрдЪрд╛ рд╕реНрддрд░ рд╣реИ рдФрд░ рдпрд╣ рд╡реГрдХреНрд╖реЛрдВ рдХреЗ рд╕рдореВрд╣ рд╕реЗ рдмрдирд╛ рд╣реЛрддрд╛ рд╣реИред рд╡реГрдХреНрд╖ рд╡рд┐рд╢реНрд╡рд╛рд╕ рд╕рдВрдмрдВрдзреЛрдВ рджреНрд╡рд╛рд░рд╛ рдЬреБрдбрд╝реЗ рд╣реЛрддреЗ рд╣реИрдВред

Active Directory рдХрдИ рдЕрд▓рдЧ-рдЕрд▓рдЧ рд╕реЗрд╡рд╛рдПрдБ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ, рдЬреЛ "Active Directory рдбреЛрдореЗрди рд╕реЗрд╡рд╛рдУрдВ" рдпрд╛ AD DS рдХреЗ рдЫрддреНрд░ рдХреЗ рдиреАрдЪреЗ рдЖрддреА рд╣реИрдВред рдЗрди рд╕реЗрд╡рд╛рдУрдВ рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реИрдВ:

1. **рдбреЛрдореЗрди рд╕реЗрд╡рд╛рдПрдБ** тАУ рдХреЗрдВрджреНрд░реАрдХреГрдд рдбреЗрдЯрд╛ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдФрд░ рдбреЛрдореЗрди рдХреЗ рдмреАрдЪ рд╕рдВрдЪрд╛рд░ рдХрд╛ рдкреНрд░рдмрдВрдзрди рдХрд░рддрд╛ рд╣реИ; рд▓реЙрдЧрд┐рди рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдФрд░ рдЦреЛрдЬ рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рд╢рд╛рдорд┐рд▓ рд╣реИ
2. **рдкреНрд░рдорд╛рдгрдкрддреНрд░ рд╕реЗрд╡рд╛рдПрдБ** тАУ рд╕реБрд░рдХреНрд╖рд┐рдд рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдмрдирд╛рддрд╛ рд╣реИ, рд╡рд┐рддрд░рд┐рдд рдХрд░рддрд╛ рд╣реИ рдФрд░ рдкреНрд░рдмрдВрдзрд┐рдд рдХрд░рддрд╛ рд╣реИ
3. **рд▓рд╛рдЗрдЯрд╡реЗрдЯ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рд╕реЗрд╡рд╛рдПрдБ** тАУ рдЦреБрд▓реЗ (LDAP) рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛-рд╕рдХреНрд╖рдо рдЕрдиреБрдкреНрд░рдпреЛрдЧреЛрдВ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИ
4. **рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдлреЗрдбрд░реЗрд╢рди рд╕реЗрд╡рд╛рдПрдБ** тАУ рдПрдХрд▓ рд╕рддреНрд░ рдореЗрдВ рдХрдИ рд╡реЗрдм рдЕрдиреБрдкреНрд░рдпреЛрдЧреЛрдВ рдореЗрдВ рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдкреНрд░рдорд╛рдгрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рд┐рдВрдЧрд▓-рд╕рд╛рдЗрди-рдСрди (SSO) рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ
5. **рдЕрдзрд┐рдХрд╛рд░ рдкреНрд░рдмрдВрдзрди** тАУ рдбрд┐рдЬрд┐рдЯрд▓ рд╕рд╛рдордЧреНрд░реА рдХреЗ рдЕрдирдзрд┐рдХреГрдд рдЙрдкрдпреЛрдЧ рдФрд░ рд╡рд┐рддрд░рдг рд╕реЗ рдмрдЪрд╛рдХрд░ рдХреЙрдкреАрд░рд╛рдЗрдЯ рд╕реВрдЪрдирд╛ рдХреА рд╕реБрд░рдХреНрд╖рд╛ рдХрд░рддрд╛ рд╣реИ
6. **DNS рд╕реЗрд╡рд╛** тАУ рдбреЛрдореЗрди рдирд╛рдореЛрдВ рдХреЛ рд╣рд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛рддреА рд╣реИред

AD DS Windows Server (Windows Server 10 рд╕рд╣рд┐рдд) рдХреЗ рд╕рд╛рде рд╢рд╛рдорд┐рд▓ рд╣реИ рдФрд░ рдХреНрд▓рд╛рдЗрдВрдЯ рд╕рд┐рд╕реНрдЯрдо рдХрд╛ рдкреНрд░рдмрдВрдзрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдбрд┐рдЬрд╛рдЗрди рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред рдЬрдмрдХрд┐ рдирд┐рдпрдорд┐рдд рд╕рдВрд╕реНрдХрд░рдг рдХреЗ Windows рдЪрд▓рд╛рдиреЗ рд╡рд╛рд▓реЗ рд╕рд┐рд╕реНрдЯрдореЛрдВ рдореЗрдВ AD DS рдХреА рдкреНрд░рд╢рд╛рд╕рдирд┐рдХ рд╡рд┐рд╢реЗрд╖рддрд╛рдПрдБ рдирд╣реАрдВ рд╣реЛрддреА рд╣реИрдВ, рд╡реЗ Active Directory рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддреЗ рд╣реИрдВред рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдХреЛрдИ рднреА Windows рдХрдВрдкреНрдпреВрдЯрд░ рдПрдХ Windows рдХрд╛рд░реНрдп рд╕рдореВрд╣ рд╕реЗ рдЬреБрдбрд╝ рд╕рдХрддрд╛ рд╣реИ, рдмрд╢рд░реНрддреЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдкрд╛рд╕ рд╕рд╣реА рд▓реЙрдЧрд┐рди рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рд╣реЛрдВред\
**рд╕реЗ:** [**https://techterms.com/definition/active\_directory**](https://techterms.com/definition/active\_directory)

### **Kerberos рдкреНрд░рдорд╛рдгреАрдХрд░рдг**

AD рдкрд░ **рд╣рдорд▓рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП** рдЖрдкрдХреЛ **Kerberos рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдкреНрд░рдХреНрд░рд┐рдпрд╛** рдХреЛ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдЕрдЪреНрдЫреА рддрд░рд╣ рд╕реЗ **рд╕рдордЭрдирд╛** рд╣реЛрдЧрд╛ред\
[**рдпрд╣ рдкреГрд╖реНрда рдкрдврд╝реЗрдВ рдпрджрд┐ рдЖрдк рдЕрднреА рднреА рдирд╣реАрдВ рдЬрд╛рдирддреЗ рдХрд┐ рдпрд╣ рдХреИрд╕реЗ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИред**](kerberos-authentication.md)

## рдЪреАрдЯ рд╢реАрдЯ

рдЖрдк [https://wadcoms.github.io/](https://wadcoms.github.io) рдкрд░ рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рдЖрдк рдЬрд▓реНрджреА рд╕реЗ рджреЗрдЦ рд╕рдХреЗрдВ рдХрд┐ рдЖрдк AD рдХреЛ рд╕реВрдЪреАрдмрджреНрдз рдХрд░рдиреЗ/рд╢реЛрд╖рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреМрди рд╕реЗ рдХрдорд╛рдВрдб рдЪрд▓рд╛ рд╕рдХрддреЗ рд╣реИрдВред

## Recon Active Directory (рдХреЛрдИ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓/рд╕рддреНрд░ рдирд╣реАрдВ)

рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ AD рд╡рд╛рддрд╛рд╡рд░рдг рддрдХ рдкрд╣реБрдБрдЪ рд╣реИ рд▓реЗрдХрд┐рди рдХреЛрдИ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓/рд╕рддреНрд░ рдирд╣реАрдВ рд╣реИ, рддреЛ рдЖрдк рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

* **рдиреЗрдЯрд╡рд░реНрдХ рдХрд╛ рдкреЗрдВрдЯреЗрд╕реНрдЯ рдХрд░реЗрдВ:**
* рдиреЗрдЯрд╡рд░реНрдХ рдХреЛ рд╕реНрдХреИрди рдХрд░реЗрдВ, рдорд╢реАрдиреЗрдВ рдФрд░ рдЦреБрд▓реЗ рдкреЛрд░реНрдЯреНрд╕ рдвреВрдБрдвреЗрдВ рдФрд░ рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдВ рдХрд┐ **рдХрдордЬреЛрд░рд┐рдпреЛрдВ рдХрд╛ рд╢реЛрд╖рдг рдХрд░реЗрдВ** рдпрд╛ **рдЙрдирд╕реЗ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдирд┐рдХрд╛рд▓реЗрдВ** (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, [рдкреНрд░рд┐рдВрдЯрд░реНрд╕ рдмрд╣реБрдд рджрд┐рд▓рдЪрд╕реНрдк рд▓рдХреНрд╖реНрдп рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ](ad-information-in-printers.md)).
* DNS рдХрд╛ рд╕реВрдЪреАрдмрджреНрдз рдХрд░рдирд╛ рдбреЛрдореЗрди рдХреЗ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╕рд░реНрд╡рд░реЛрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА рджреЗ рд╕рдХрддрд╛ рд╣реИ рдЬреИрд╕реЗ рд╡реЗрдм, рдкреНрд░рд┐рдВрдЯрд░реНрд╕, рд╢реЗрдпрд░реНрд╕, рд╡реАрдкреАрдПрди, рдореАрдбрд┐рдпрд╛, рдЖрджрд┐ред
* `gobuster dns -d domain.local -t 25 -w /opt/Seclist/Discovery/DNS/subdomain-top2000.txt`
* рдЗрд╕реЗ рдХреИрд╕реЗ рдХрд░рдиреЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рд╕рд╛рдорд╛рдиреНрдп [**рдкреЗрдВрдЯреЗрд╕реНрдЯрд┐рдВрдЧ рдкрджреНрдзрддрд┐**](../../generic-methodologies-and-resources/pentesting-methodology.md) рджреЗрдЦреЗрдВред
* **smb рд╕реЗрд╡рд╛рдУрдВ рдкрд░ рдирд▓ рдФрд░ рдЕрддрд┐рдерд┐ рдкрд╣реБрдБрдЪ рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ** (рдпрд╣ рдЖрдзреБрдирд┐рдХ Windows рд╕рдВрд╕реНрдХрд░рдгреЛрдВ рдкрд░ рдХрд╛рдо рдирд╣реАрдВ рдХрд░реЗрдЧрд╛):
* `enum4linux -a -u "" -p "" <DC IP> && enum4linux -a -u "guest" -p "" <DC IP>`
* `smbmap -
```bash
./kerbrute_linux_amd64 userenum -d lab.ropnop.com --dc 10.10.10.10 usernames.txt #From https://github.com/ropnop/kerbrute/releases

nmap -p 88 --script=krb5-enum-users --script-args="krb5-enum-users.realm='DOMAIN'" <IP>
Nmap -p 88 --script=krb5-enum-users --script-args krb5-enum-users.realm='<domain>',userdb=/root/Desktop/usernames.txt <IP>

msf> use auxiliary/gather/kerberos_enumusers

crackmapexec smb dominio.es  -u '' -p '' --users | awk '{print $4}' | uniq
```
* **OWA (Outlook Web Access) рд╕рд░реНрд╡рд░**

рдпрджрд┐ рдЖрдкрдХреЛ рдиреЗрдЯрд╡рд░реНрдХ рдореЗрдВ рдЗрдирдореЗрдВ рд╕реЗ рдХреЛрдИ рд╕рд░реНрд╡рд░ рдорд┐рд▓рддрд╛ рд╣реИ, рддреЛ рдЖрдк **рдЗрд╕рдХреЗ рдЦрд┐рд▓рд╛рдл рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕реВрдЪреАрдХрд░рдг (user enumeration) рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**ред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЖрдк [**MailSniper**](https://github.com/dafthack/MailSniper) рдЯреВрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
ipmo C:\Tools\MailSniper\MailSniper.ps1
# Get info about the domain
Invoke-DomainHarvestOWA -ExchHostname [ip]
# Enumerate valid users from a list of potential usernames
Invoke-UsernameHarvestOWA -ExchHostname [ip] -Domain [domain] -UserList .\possible-usernames.txt -OutFile valid.txt
# Password spraying
Invoke-PasswordSprayOWA -ExchHostname [ip] -UserList .\valid.txt -Password Summer2021
# Get addresses list from the compromised mail
Get-GlobalAddressList -ExchHostname [ip] -UserName [domain]\[username] -Password Summer2021 -OutFile gal.txt
```
{% hint style="warning" %}
рдЖрдк рдЗрд╕ GitHub рд░реЗрдкреЛ рдореЗрдВ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдореЛрдВ рдХреА рд╕реВрдЪрд┐рдпрд╛рдБ рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ [**this github repo**](https://github.com/danielmiessler/SecLists/tree/master/Usernames/Names) \*\*\*\* рдФрд░ рдЗрд╕рдореЗрдВ рднреА ([**statistically-likely-usernames**](https://github.com/insidetrust/statistically-likely-usernames))ред

рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЖрдкрдХреЗ рдкрд╛рд╕ рдХрдВрдкрдиреА рдореЗрдВ рдХрд╛рдо рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рд▓реЛрдЧреЛрдВ рдХреЗ **рдирд╛рдо** рдкрд╣рд▓реЗ рд╕реЗ рд╣реЛрдиреЗ рдЪрд╛рд╣рд┐рдП рдЬреЛ рдЖрдкрдиреЗ рдЗрд╕рд╕реЗ рдкрд╣рд▓реЗ рдХреЗ рдЪрд░рдг рдореЗрдВ рдкрддрд╛ рд▓рдЧрд╛рдП рд╣реЛрдВрдЧреЗред рдирд╛рдо рдФрд░ рдЙрдкрдирд╛рдо рдХреЗ рд╕рд╛рде рдЖрдк рд╕реНрдХреНрд░рд┐рдкреНрдЯ [**namemash.py**](https://gist.github.com/superkojiman/11076951) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдВрднрд╛рд╡рд┐рдд рдорд╛рдиреНрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо рдЙрддреНрдкрдиреНрди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
{% endhint %}

### рдПрдХ рдпрд╛ рдЕрдзрд┐рдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо рдЬрд╛рдирдирд╛

рдареАрдХ рд╣реИ, рддреЛ рдЖрдк рдЬрд╛рдирддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдПрдХ рдорд╛рдиреНрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо рд╣реИ рд▓реЗрдХрд┐рди рдХреЛрдИ рдкрд╛рд╕рд╡рд░реНрдб рдирд╣реАрдВ... рддреЛ рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдВ:

* [**ASREPRoast**](asreproast.md): рдпрджрд┐ рдХрд┐рд╕реА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдкрд╛рд╕ _DONT_REQ_PREAUTH_ рд╡рд┐рд╢реЗрд╖рддрд╛ **рдирд╣реАрдВ рд╣реИ**, рддреЛ рдЖрдк рдЙрд╕ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд▓рд┐рдП **AS_REP рд╕рдВрджреЗрд╢ рдХрд╛ рдЕрдиреБрд░реЛрдз рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ** рдЬрд┐рд╕рдореЗрдВ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдкрд╛рд╕рд╡рд░реНрдб рдХреЗ рд╡реНрдпреБрддреНрдкрдиреНрди рд╕реЗ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдХреБрдЫ рдбреЗрдЯрд╛ рд╣реЛрдЧрд╛ред
* [**Password Spraying**](password-spraying.md): рдЖрдЗрдП рд╕рдмрд╕реЗ **рдЖрдо рдкрд╛рд╕рд╡рд░реНрдб** рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдВ рдкреНрд░рддреНрдпреЗрдХ рдЦреЛрдЬреЗ рдЧрдП рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рд╕рд╛рде, рд╢рд╛рдпрдж рдХреБрдЫ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдПрдХ рдЦрд░рд╛рдм рдкрд╛рд╕рд╡рд░реНрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣реЗ рд╣реЛрдВ (рдкрд╛рд╕рд╡рд░реНрдб рдиреАрддрд┐ рдХреЛ рдзреНрдпрд╛рди рдореЗрдВ рд░рдЦреЗрдВ!)ред
* рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдЖрдк **OWA рд╕рд░реНрд╡рд░реЛрдВ рдкрд░ рднреА рд╕реНрдкреНрд░реЗ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ** рддрд╛рдХрд┐ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рдореЗрд▓ рд╕рд░реНрд╡рд░реЛрдВ рддрдХ рдкрд╣реБрдБрдЪ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХреЗрдВред

{% content-ref url="password-spraying.md" %}
[password-spraying.md](password-spraying.md)
{% endcontent-ref %}

### LLMNR/NBT-NS Poisoning

рдЖрдк **рдиреЗрдЯрд╡рд░реНрдХ** рдХреЗ рдХреБрдЫ рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдХреЛ **poisoning** рдХрд░рдХреЗ рдХреБрдЫ рдЪреИрд▓реЗрдВрдЬ **рд╣реИрд╢реЗрд╕** рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ:

{% content-ref url="../../generic-methodologies-and-resources/pentesting-network/spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md" %}
[spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md](../../generic-methodologies-and-resources/pentesting-network/spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md)
{% endcontent-ref %}

### NTML Relay

рдпрджрд┐ рдЖрдкрдиреЗ рд╕рдХреНрд░рд┐рдп рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХрд╛ рдЕрдиреБрдХреНрд░рдордг рдХрд┐рдпрд╛ рд╣реИ, рддреЛ рдЖрдкрдХреЗ рдкрд╛рд╕ **рдЕрдзрд┐рдХ рдИрдореЗрд▓ рдФрд░ рдиреЗрдЯрд╡рд░реНрдХ рдХреА рдмреЗрд╣рддрд░ рд╕рдордЭ** рд╣реЛрдЧреАред рдЖрдк NTML [**relay attacks**](../../generic-methodologies-and-resources/pentesting-network/spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md#relay-attack) рдХреЛ рдордЬрдмреВрд░ рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ рддрд╛рдХрд┐ AD рдкрд░реНрдпрд╛рд╡рд░рдг рддрдХ рдкрд╣реБрдБрдЪ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХреЗрдВред

### Steal NTLM Creds

рдпрджрд┐ рдЖрдк **null рдпрд╛ guest рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛** рдХреЗ рд╕рд╛рде рдЕрдиреНрдп рдкреАрд╕реА рдпрд╛ рд╢реЗрдпрд░реЛрдВ рддрдХ **рдкрд╣реБрдБрдЪ рд╕рдХрддреЗ рд╣реИрдВ**, рддреЛ рдЖрдк **рдлрд╛рдЗрд▓реЗрдВ рд░рдЦ рд╕рдХрддреЗ рд╣реИрдВ** (рдЬреИрд╕реЗ рдХрд┐ SCF рдлрд╛рдЗрд▓) рдЬреЛ рдпрджрд┐ рдХрд┐рд╕реА рддрд░рд╣ рд╕реЗ рдПрдХреНрд╕реЗрд╕ рдХреА рдЬрд╛рддреА рд╣реИрдВ рддреЛ рд╡реЗ **рдЖрдкрдХреЗ рдЦрд┐рд▓рд╛рдл NTML рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдЯреНрд░рд┐рдЧрд░ рдХрд░реЗрдВрдЧреА** рддрд╛рдХрд┐ рдЖрдк **NTLM рдЪреИрд▓реЗрдВрдЬ рдХреЛ рдЪреБрд░рд╛ рд╕рдХреЗрдВ** рдФрд░ рдЙрд╕реЗ рдХреНрд░реИрдХ рдХрд░ рд╕рдХреЗрдВ:

{% content-ref url="../ntlm/places-to-steal-ntlm-creds.md" %}
[places-to-steal-ntlm-creds.md](../ntlm/places-to-steal-ntlm-creds.md)
{% endcontent-ref %}

## рд╕рд╛рдЦреЛрдВ/рд╕рддреНрд░ рдХреЗ рд╕рд╛рде рд╕рдХреНрд░рд┐рдп рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХрд╛ рдЕрдиреБрдХреНрд░рдордг

рдЗрд╕ рдЪрд░рдг рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЗ рдкрд╛рд╕ рдПрдХ рдорд╛рдиреНрдп рдбреЛрдореЗрди рдЦрд╛рддреЗ рдХреА **рд╕рд╛рдЦреЗрдВ рдпрд╛ рд╕рддреНрд░ рд╕рдордЭреМрддрд╛ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред** рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдХреБрдЫ рдорд╛рдиреНрдп рд╕рд╛рдЦреЗрдВ рд╣реИрдВ рдпрд╛ рдЖрдк рдПрдХ рдбреЛрдореЗрди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд░реВрдк рдореЗрдВ рдПрдХ рд╢реЗрд▓ рд╣реИрдВ, рддреЛ рдЖрдкрдХреЛ рдпрд╛рдж рд░рдЦрдирд╛ рдЪрд╛рд╣рд┐рдП рдХрд┐ рдЕрдиреНрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рд╕рдордЭреМрддрд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкрд╣рд▓реЗ рджрд┐рдП рдЧрдП рд╡рд┐рдХрд▓реНрдк рдЕрднреА рднреА рд╡рд┐рдХрд▓реНрдк рд╣реИрдВред

рдкреНрд░рдорд╛рдгрд┐рдд рдЕрдиреБрдХреНрд░рдордг рд╢реБрд░реВ рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдЖрдкрдХреЛ рдкрддрд╛ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП рдХрд┐ **Kerberos double hop problem** рдХреНрдпрд╛ рд╣реИред

{% content-ref url="kerberos-double-hop-problem.md" %}
[kerberos-double-hop-problem.md](kerberos-double-hop-problem.md)
{% endcontent-ref %}

### рдЕрдиреБрдХреНрд░рдордг

рдПрдХ рдЦрд╛рддреЗ рдХреЛ рд╕рдордЭреМрддрд╛ рдХрд░рдирд╛ рдкреВрд░реЗ рдбреЛрдореЗрди рдХреЛ рд╕рдордЭреМрддрд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП **рдПрдХ рдмрдбрд╝рд╛ рдХрджрдо рд╣реИ**, рдХреНрдпреЛрдВрдХрд┐ рдЖрдк **рд╕рдХреНрд░рд┐рдп рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдЕрдиреБрдХреНрд░рдордг** рд╢реБрд░реВ рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛрдВрдЧреЗ:

[**ASREPRoast**](asreproast.md) рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдм рдЖрдк рд╣рд░ рд╕рдВрднрд╛рд╡рд┐рдд рдХрдордЬреЛрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдвреВрдВрдв рд╕рдХрддреЗ рд╣реИрдВ, рдФрд░ [**Password Spraying**](password-spraying.md) рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЖрдк рд╕рднреА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдореЛрдВ рдХреА **рд╕реВрдЪреА рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ** рдФрд░ рд╕рдордЭреМрддрд╛ рдХрд┐рдП рдЧрдП рдЦрд╛рддреЗ рдХрд╛ рдкрд╛рд╕рд╡рд░реНрдб, рдЦрд╛рд▓реА рдкрд╛рд╕рд╡рд░реНрдб рдФрд░ рдирдП рдЖрд╢рд╛рдЬрдирдХ рдкрд╛рд╕рд╡рд░реНрдб рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

* рдЖрдк [**CMD рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ рдмреБрдирд┐рдпрд╛рджреА рд░реЗрдХреЙрди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**](../basic-cmd-for-pentesters.md#domain-info)
* рдЖрдк [**рдкрд╛рд╡рд░рд╢реЗрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд░реЗрдХреЙрди рдХреЗ рд▓рд┐рдП**](../basic-powershell-for-pentesters/) рднреА рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рдЕрдзрд┐рдХ рдЪреБрдкрдХреЗ рд╣реЛрдЧрд╛
* рдЖрдк [**рдкрд╛рд╡рд░рд╡реНрдпреВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ**](../basic-powershell-for-pentesters/powerview.md) рдЕрдзрд┐рдХ рд╡рд┐рд╕реНрддреГрдд рдЬрд╛рдирдХрд╛рд░реА рдирд┐рдХрд╛рд▓ рд╕рдХрддреЗ рд╣реИрдВ
* рд╕рдХреНрд░рд┐рдп рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдореЗрдВ рд░реЗрдХреЙрди рдХреЗ рд▓рд┐рдП рдПрдХ рдФрд░ рдЕрджреНрднреБрдд рдЙрдкрдХрд░рдг [**BloodHound**](bloodhound.md) рд╣реИред рдпрд╣ **рдмрд╣реБрдд рдЪреБрдкрдХреЗ рдирд╣реАрдВ рд╣реИ** (рдЖрдк рдЬреЛ рд╕рдВрдЧреНрд░рд╣ рд╡рд┐рдзрд┐рдпрд╛рдВ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ рдЙрд╕рдХреЗ рдЖрдзрд╛рд░ рдкрд░), рд▓реЗрдХрд┐рди **рдпрджрд┐ рдЖрдкрдХреЛ рдкрд░рд╡рд╛рд╣ рдирд╣реАрдВ рд╣реИ** рддреЛ рдЖрдкрдХреЛ рдЗрд╕реЗ рдЬрд░реВрд░ рдЖрдЬрдорд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред рдЬрд╛рдирд┐рдП рдХрд╣рд╛рдБ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ RDP рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЕрдиреНрдп рд╕рдореВрд╣реЛрдВ рдХреЗ рд▓рд┐рдП рдкрде рдвреВрдВрдвреЗрдВ, рдЖрджрд┐ред
* **рдЕрдиреНрдп рд╕реНрд╡рдЪрд╛рд▓рд┐рдд AD рдЕрдиреБрдХреНрд░рдордг рдЙрдкрдХрд░рдг рд╣реИрдВ:** [**AD Explorer**](bloodhound.md#ad-explorer)**,** [**ADRecon**](bloodhound.md#adrecon)**,** [**Group3r**](bloodhound.md#group3r)**,** [**PingCastle**](bloodhound.md#pingcastle)**.**
* [**AD рдХреЗ DNS рд░рд┐рдХреЙрд░реНрдб**](ad-dns-records.md) рдХреНрдпреЛрдВрдХрд┐ рд╡реЗ рджрд┐рд▓рдЪрд╕реНрдк рдЬрд╛рдирдХрд╛рд░реА рд╢рд╛рдорд┐рд▓ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
* рдПрдХ **GUI рдХреЗ рд╕рд╛рде рдЙрдкрдХрд░рдг** рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдЖрдк рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХрд╛ рдЕрдиреБрдХреНрд░рдордг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рд╡рд╣ рд╣реИ **AdExplorer.exe** **SysInternal** рд╕реБрдЗрдЯ рд╕реЗред
* рдЖрдк **ldapsearch** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ LDAP рдбреЗрдЯрд╛рдмреЗрд╕ рдореЗрдВ рднреА рдЦреЛрдЬ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рддрд╛рдХрд┐ _userPassword_ рдФрд░ _unixUserPassword_ рдлрд╝реАрд▓реНрдбреНрд╕ рдореЗрдВ, рдпрд╛ рдпрд╣рд╛рдВ рддрдХ рдХрд┐ _Description_ рдореЗрдВ рд╕рд╛рдЦреЛрдВ рдХреА рддрд▓рд╛рд╢ рдХрд░ рд╕рдХреЗрдВред cf. [PayloadsAllTheThings рдкрд░ AD рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЯрд┐рдкреНрдкрдгреА рдореЗрдВ рдкрд╛рд╕рд╡рд░реНрдб](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Active%20Directory%20Attack.md#password-in-ad-user-comment) рдЕрдиреНрдп рд╡рд┐рдзрд┐рдпреЛрдВ рдХреЗ рд▓рд┐рдПред
* рдпрджрд┐ рдЖрдк **рд▓рд┐рдирдХреНрд╕** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣реЗ рд╣реИрдВ, рддреЛ рдЖрдк [**pywerview**](https://github.com/the-useless-one/pywerview) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдбреЛрдореЗрди рдХрд╛ рдЕрдиреБрдХреНрд░рдордг рднреА рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
* рдЖрдк рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдЙрдкрдХрд░рдгреЛрдВ рдХреА рднреА рдХреЛрд╢рд┐рд╢ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬреИрд╕реЗ:
* [**tomcarver16/ADSearch**](https://github.com/tomcarver16/ADSearch)
* [**61106960/adPEAS**](https://github.com/61106960/adPEAS)
*   **рд╕рднреА рдбреЛрдореЗрди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рдирд┐рдХрд╛рд▓рдирд╛**

рд╡рд┐рдВрдбреЛрдЬ рд╕реЗ рд╕рднреА рдбреЛрдореЗрди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рдмрд╣реБрдд рдЖрд╕рд╛рди рд╣реИ (`net user /domain`, `Get-DomainUser` рдпрд╛ `wmic useraccount get name,sid`)ред рд▓рд┐рдирдХреНрд╕ рдореЗрдВ, рдЖрдк рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ: `GetADUsers.py -all -dc-ip 10.10.10.110 domain.com/username` рдпрд╛ `enum4linux -a -u "user" -p "password" <DC IP>`

> рднрд▓реЗ рд╣реА рдпрд╣ рдЕрдиреБрдХреНрд░рдордг рдЕрдиреБрднрд╛рдЧ рдЫреЛрдЯрд╛ рд▓рдЧрддрд╛ рд╣реИ, рдпрд╣ рд╕рдмрд╕реЗ рдорд╣рддреНрд╡рдкреВрд░реНрдг
```bash
## List all tickets (if not admin, only current user tickets)
.\Rubeus.exe triage
## Dump the interesting one by luid
.\Rubeus.exe dump /service:krbtgt /luid:<luid> /nowrap
[IO.File]::WriteAllBytes("ticket.kirbi", [Convert]::FromBase64String("<BASE64_TICKET>"))
```
### NTML Relay

рдпрджрд┐ рдЖрдкрдиреЗ рд╕рдХреНрд░рд┐рдп рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХрд╛ рд╕рдВрдЪрдпрди рдХрд░ рд▓рд┐рдпрд╛ рд╣реИ рддреЛ рдЖрдкрдХреЗ рдкрд╛рд╕ **рдЕрдзрд┐рдХ рдИрдореЗрд▓ рдФрд░ рдиреЗрдЯрд╡рд░реНрдХ рдХреА рдмреЗрд╣рддрд░ рд╕рдордЭ** рд╣реЛрдЧреАред рдЖрдк NTML [**рд░рд┐рд▓реЗ рд╣рдорд▓реЛрдВ**](../../generic-methodologies-and-resources/pentesting-network/spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md#relay-attack) рдХреЛ рдордЬрдмреВрд░ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

### **рдХрдВрдкреНрдпреВрдЯрд░ рд╢реЗрдпрд░реНрд╕ рдореЗрдВ рдХреНрд░реЗрдбреНрд╕ рдЦреЛрдЬреЗрдВ**

рдЕрдм рдЬрдм рдЖрдкрдХреЗ рдкрд╛рд╕ рдХреБрдЫ рдореВрд▓рднреВрдд рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рд╣реИрдВ, рддреЛ рдЖрдкрдХреЛ рдЪреЗрдХ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП рдХрд┐ рдХреНрдпрд╛ рдЖрдк **AD рдХреЗ рдЕрдВрджрд░ рд╕рд╛рдЭрд╛ рдХреА рдЬрд╛ рд░рд╣реА рдХреЛрдИ рджрд┐рд▓рдЪрд╕реНрдк рдлрд╛рдЗрд▓реЗрдВ рдкрд╛** рд╕рдХрддреЗ рд╣реИрдВред рдЖрдк рдпрд╣ рдореИрдиреНрдпреБрдЕрд▓реА рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рд▓реЗрдХрд┐рди рдпрд╣ рдПрдХ рдмрд╣реБрдд рд╣реА рдЙрдмрд╛рдК рдФрд░ рджреЛрд╣рд░рд╛рд╡ рд╡рд╛рд▓рд╛ рдХрд╛рд░реНрдп рд╣реИ (рдФрд░ рдФрд░ рднреА рдЕрдЧрд░ рдЖрдкрдХреЛ рд╕реИрдХрдбрд╝реЛрдВ рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рдЪреЗрдХ рдХрд░рдиреЗ рдХреА рдЬрд░реВрд░рдд рд╣реЛ)ред

[**рдЗрд╕ рд▓рд┐рдВрдХ рдХрд╛ рдЕрдиреБрд╕рд░рдг рдХрд░реЗрдВ рдФрд░ рдЬрд╛рдиреЗрдВ рдХрд┐ рдЖрдк рдХреМрди рд╕реЗ рдЙрдкрдХрд░рдг рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред**](../../network-services-pentesting/pentesting-smb.md#domain-shared-folders-search)

### Steal NTLM Creds

рдпрджрд┐ рдЖрдк **рдЕрдиреНрдп рдкреАрд╕реА рдпрд╛ рд╢реЗрдпрд░реНрд╕ рддрдХ рдкрд╣реБрдБрдЪ** рд╕рдХрддреЗ рд╣реИрдВ рддреЛ рдЖрдк **рдлрд╛рдЗрд▓реЗрдВ рд░рдЦ** рд╕рдХрддреЗ рд╣реИрдВ (рдЬреИрд╕реЗ рдХрд┐ SCF рдлрд╛рдЗрд▓) рдЬрд┐рд╕реЗ рдЕрдЧрд░ рдХрд┐рд╕реА рддрд░рд╣ рд╕реЗ рдПрдХреНрд╕реЗрд╕ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рддреЛ рдпрд╣ **рдЖрдкрдХреЗ рдЦрд┐рд▓рд╛рдл NTML рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЛ рдЯреНрд░рд┐рдЧрд░** рдХрд░реЗрдЧрд╛ рддрд╛рдХрд┐ рдЖрдк **NTLM рдЪреИрд▓реЗрдВрдЬ рдХреЛ рдЪреБрд░рд╛** рд╕рдХреЗрдВ рдФрд░ рдЙрд╕реЗ рдХреНрд░реИрдХ рдХрд░ рд╕рдХреЗрдВ:

{% content-ref url="../ntlm/places-to-steal-ntlm-creds.md" %}
[places-to-steal-ntlm-creds.md](../ntlm/places-to-steal-ntlm-creds.md)
{% endcontent-ref %}

### CVE-2021-1675/CVE-2021-34527 PrintNightmare

рдЗрд╕ рдХрдордЬреЛрд░реА рдиреЗ рдХрд┐рд╕реА рднреА рдкреНрд░рдорд╛рдгрд┐рдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ **рдбреЛрдореЗрди рдХрдВрдЯреНрд░реЛрд▓рд░ рдХреЛ рд╕рдордЭреМрддрд╛** рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреА рдереАред

{% content-ref url="printnightmare.md" %}
[printnightmare.md](printnightmare.md)
{% endcontent-ref %}

## Privilege escalation on Active Directory WITH privileged credentials/session

**рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рддрдХрдиреАрдХреЛрдВ рдХреЗ рд▓рд┐рдП рдПрдХ рд╕рд╛рдорд╛рдиреНрдп рдбреЛрдореЗрди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкрд░реНрдпрд╛рдкреНрдд рдирд╣реАрдВ рд╣реИ, рдЖрдкрдХреЛ рдЗрди рд╣рдорд▓реЛрдВ рдХреЛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреБрдЫ рд╡рд┐рд╢реЗрд╖ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░/рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред**

### Hash extraction

рдЖрд╢рд╛ рд╣реИ рдХрд┐ рдЖрдкрдиреЗ [AsRepRoast](asreproast.md), [Password Spraying](password-spraying.md), [Kerberoast](kerberoast.md), [Responder](../../generic-methodologies-and-resources/pentesting-network/spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md) рд╕рд╣рд┐рдд рд░рд┐рд▓реЗрдЗрдВрдЧ, [EvilSSDP](../../generic-methodologies-and-resources/pentesting-network/spoofing-ssdp-and-upnp-devices.md), [рд╕реНрдерд╛рдиреАрдп рд░реВрдк рд╕реЗ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдмрдврд╝рд╛рдирд╛](../windows-local-privilege-escalation/) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХрд┐рд╕реА рд╕реНрдерд╛рдиреАрдп рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рдЦрд╛рддреЗ рдХреЛ **рд╕рдордЭреМрддрд╛** рдХрд░ рд▓рд┐рдпрд╛ рд╣реИред\
рддрдм, рдпрд╣ рд╕рдордп рд╣реИ рд╕рднреА рд╣реИрд╢реЗрдЬ рдХреЛ рдореЗрдореЛрд░реА рдФрд░ рд╕реНрдерд╛рдиреАрдп рд░реВрдк рд╕реЗ рдбрдВрдк рдХрд░рдиреЗ рдХрд╛ред\
[**рдЗрд╕ рдкреГрд╖реНрда рдХреЛ рдкрдврд╝реЗрдВ рдФрд░ рд╡рд┐рднрд┐рдиреНрди рддрд░реАрдХреЛрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдиреЗрдВ рдЬрд┐рдирд╕реЗ рд╣реИрд╢реЗрдЬ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВред**](broken-reference/)

### Pass the Hash

**рдПрдХ рдмрд╛рд░ рдЬрдм рдЖрдкрдХреЗ рдкрд╛рд╕ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХрд╛ рд╣реИрд╢ рд╣реЛ**, рдЖрдк рдЙрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЙрд╕реЗ **рдЕрдиреБрдХрд░рдг** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред\
рдЖрдкрдХреЛ рдХрд┐рд╕реА **рдЙрдкрдХрд░рдг** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ рдЬреЛ рдЙрд╕ **рд╣реИрд╢ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ NTLM рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХрд░реЗрдЧрд╛**, **рдпрд╛** рдЖрдк рдПрдХ рдирдпрд╛ **sessionlogon рдмрдирд╛** рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЙрд╕ **рд╣реИрд╢ рдХреЛ LSASS рдХреЗ рдЕрдВрджрд░ рдЗрдВрдЬреЗрдХреНрдЯ** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рддрд╛рдХрд┐ рдЬрдм рднреА рдХреЛрдИ **NTLM рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ**, рд╡рд╣ **рд╣реИрд╢ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред** рдЖрдЦрд┐рд░реА рд╡рд┐рдХрд▓реНрдк рд╡рд╣ рд╣реИ рдЬреЛ mimikatz рдХрд░рддрд╛ рд╣реИред\
[**рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рдЗрд╕ рдкреГрд╖реНрда рдХреЛ рдкрдврд╝реЗрдВред**](../ntlm/#pass-the-hash)

### Over Pass the Hash/Pass the Key

рдпрд╣ рд╣рдорд▓рд╛ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ NTLM рд╣реИрд╢ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ Kerberos рдЯрд┐рдХрдЯ рдХрд╛ рдЕрдиреБрд░реЛрдз рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП** рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, NTLM рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдХреЗ рдКрдкрд░ Pass The Hash рдХреЗ рд╕рд╛рдорд╛рдиреНрдп рд╡рд┐рдХрд▓реНрдк рдХреЗ рд░реВрдк рдореЗрдВред рдЗрд╕рд▓рд┐рдП, рдпрд╣ рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ **рдиреЗрдЯрд╡рд░реНрдХ рдореЗрдВ рдЙрдкрдпреЛрдЧреА рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рдЬрд╣рд╛рдВ NTLM рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдЕрдХреНрд╖рдо рд╣реИ** рдФрд░ рдХреЗрд╡рд▓ **Kerberos рдХреЛ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдХреЗ рд░реВрдк рдореЗрдВ рдЕрдиреБрдорддрд┐ рд╣реИ**ред

{% content-ref url="over-pass-the-hash-pass-the-key.md" %}
[over-pass-the-hash-pass-the-key.md](over-pass-the-hash-pass-the-key.md)
{% endcontent-ref %}

### Pass the Ticket

рдпрд╣ рд╣рдорд▓рд╛ Pass the Key рдХреЗ рд╕рдорд╛рди рд╣реИ, рд▓реЗрдХрд┐рди рдЯрд┐рдХрдЯ рдХрд╛ рдЕрдиреБрд░реЛрдз рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣реИрд╢реЗрдЬ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рдмрдЬрд╛рдп, **рдЯрд┐рдХрдЯ рд╕реНрд╡рдпрдВ рдЪреБрд░рд╛рдИ рдЬрд╛рддреА рд╣реИ** рдФрд░ рдЙрд╕рдХреЗ рдорд╛рд▓рд┐рдХ рдХреЗ рд░реВрдк рдореЗрдВ рдкреНрд░рдорд╛рдгрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛рддреА рд╣реИред

{% content-ref url="pass-the-ticket.md" %}
[pass-the-ticket.md](pass-the-ticket.md)
{% endcontent-ref %}

### Credentials Reuse

рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ **рд╣реИрд╢** рдпрд╛ **рдкрд╛рд╕рд╡рд░реНрдб** рдХрд┐рд╕реА **рд╕реНрдерд╛рдиреАрдп рдкреНрд░рд╢рд╛рд╕рдХ** рдХрд╛ рд╣реИ рддреЛ рдЖрдкрдХреЛ рдЕрдиреНрдп **рдкреАрд╕реА** рдкрд░ **рд╕реНрдерд╛рдиреАрдп рд░реВрдк рд╕реЗ рд▓реЙрдЧрд┐рди** рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред
```bash
# Local Auth Spray (once you found some local admin pass or hash)
## --local-auth flag indicate to only try 1 time per machine
crackmapexec smb --local-auth 10.10.10.10/23 -u administrator -H 10298e182387f9cab376ecd08491764a0 | grep +
```
{% hint style="warning" %}
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдпрд╣ рдХрд╛рдлреА **noisy** рд╣реИ рдФрд░ **LAPS** рдЗрд╕реЗ **mitigate** рдХрд░реЗрдЧрд╛ред
{% endhint %}

### MSSQL Abuse & Trusted Links

рдпрджрд┐ рдХрд┐рд╕реА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ **MSSQL instances рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреА рдЕрдиреБрдорддрд┐** рд╣реИ, рддреЛ рд╡рд╣ рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ MSSQL рд╣реЛрд╕реНрдЯ рдореЗрдВ **commands execute** рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░ рд╕рдХрддрд╛ рд╣реИ (рдпрджрд┐ SA рдХреЗ рд░реВрдк рдореЗрдВ рдЪрд▓ рд░рд╣рд╛ рд╣реЛ), **NetNTLM hash рдЪреБрд░рд╛** рд╕рдХрддрд╛ рд╣реИ рдпрд╛ рдпрд╣рд╛рдВ рддрдХ рдХрд┐ **relay attack** рднреА рдХрд░ рд╕рдХрддрд╛ рд╣реИред\
рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдпрджрд┐ рдХреЛрдИ MSSQL instance рд╡рд┐рд╢реНрд╡рд╛рд╕рдкрд╛рддреНрд░ (database link) рд╣реИ рдЬрд┐рд╕реЗ рдПрдХ рдЕрд▓рдЧ MSSQL instance рджреНрд╡рд╛рд░рд╛ рд╡рд┐рд╢реНрд╡рд╛рд╕ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдпрджрд┐ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рд╡рд┐рд╢реНрд╡рд╛рд╕рдкрд╛рддреНрд░ рдбреЗрдЯрд╛рдмреЗрд╕ рдкрд░ рдЕрдзрд┐рдХрд╛рд░ рд╣реИрдВ, рддреЛ рд╡рд╣ **рд╡рд┐рд╢реНрд╡рд╛рд╕ рд╕рдВрдмрдВрдз рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рджреВрд╕рд░реЗ instance рдореЗрдВ рднреА queries execute рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛрдЧрд╛**ред рдпреЗ рд╡рд┐рд╢реНрд╡рд╛рд╕ рд╢реНрд░реГрдВрдЦрд▓рд╛рдмрджреНрдз рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдХрд┐рд╕реА рдмрд┐рдВрджреБ рдкрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдПрдХ рдЧрд▓рдд рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдбреЗрдЯрд╛рдмреЗрд╕ рдорд┐рд▓ рд╕рдХрддрд╛ рд╣реИ рдЬрд╣рд╛рдВ рд╡рд╣ commands execute рдХрд░ рд╕рдХрддрд╛ рд╣реИред\
**рдбреЗрдЯрд╛рдмреЗрд╕ рдХреЗ рдмреАрдЪ рдХреЗ рд▓рд┐рдВрдХ forest trusts рдХреЗ рдкрд╛рд░ рднреА рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВред**

{% content-ref url="abusing-ad-mssql.md" %}
[abusing-ad-mssql.md](abusing-ad-mssql.md)
{% endcontent-ref %}

### Unconstrained Delegation

рдпрджрд┐ рдЖрдкрдХреЛ рдХреЛрдИ Computer object [ADS\_UF\_TRUSTED\_FOR\_DELEGATION](https://msdn.microsoft.com/en-us/library/aa772300\(v=vs.85\).aspx) рд╡рд┐рд╢реЗрд╖рддрд╛ рдХреЗ рд╕рд╛рде рдорд┐рд▓рддреА рд╣реИ рдФрд░ рдЖрдкрдХреЗ рдкрд╛рд╕ рдХрдВрдкреНрдпреВрдЯрд░ рдореЗрдВ рдбреЛрдореЗрди рдЕрдзрд┐рдХрд╛рд░ рд╣реИрдВ, рддреЛ рдЖрдк рд╣рд░ рдЙрд╕ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ TGTs рдХреЛ рдореЗрдореЛрд░реА рд╕реЗ dump рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛрдВрдЧреЗ рдЬреЛ рдХрдВрдкреНрдпреВрдЯрд░ рдкрд░ рд▓реЙрдЧрд┐рди рдХрд░рддрд╛ рд╣реИред\
рдЗрд╕рд▓рд┐рдП, рдпрджрд┐ рдХреЛрдИ **Domain Admin рдХрдВрдкреНрдпреВрдЯрд░ рдкрд░ рд▓реЙрдЧрд┐рди рдХрд░рддрд╛ рд╣реИ**, рддреЛ рдЖрдк рдЙрд╕рдХреЗ TGT рдХреЛ dump рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ [Pass the Ticket](pass-the-ticket.md) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЙрд╕рдХрд╛ рдЕрдиреБрдХрд░рдг рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред\
Constrained delegation рдХреА рдорджрдж рд╕реЗ рдЖрдк **automatically Print Server рдХреЛ compromise** рднреА рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ (рдЖрд╢рд╛ рд╣реИ рдХрд┐ рдпрд╣ рдПрдХ DC рд╣реЛрдЧрд╛)ред

{% content-ref url="unconstrained-delegation.md" %}
[unconstrained-delegation.md](unconstrained-delegation.md)
{% endcontent-ref %}

### Constrained Delegation

рдпрджрд┐ рдХрд┐рд╕реА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдпрд╛ рдХрдВрдкреНрдпреВрдЯрд░ рдХреЛ "Constrained Delegation" рдХреА рдЕрдиреБрдорддрд┐ рд╣реИ, рддреЛ рд╡рд╣ рдХрд┐рд╕реА рдХрдВрдкреНрдпреВрдЯрд░ рдореЗрдВ рдХреБрдЫ рд╕реЗрд╡рд╛рдУрдВ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП **рдХрд┐рд╕реА рднреА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХрд╛ рдЕрдиреБрдХрд░рдг рдХрд░ рд╕рдХрддрд╛ рд╣реИ**ред\
рдлрд┐рд░, рдпрджрд┐ рдЖрдк рдЗрд╕ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛/рдХрдВрдкреНрдпреВрдЯрд░ рдХрд╛ **hash compromise** рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдЖрдк рдХреБрдЫ рд╕реЗрд╡рд╛рдУрдВ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП **рдХрд┐рд╕реА рднреА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХрд╛ рдЕрдиреБрдХрд░рдг рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ** (рдпрд╣рд╛рдВ рддрдХ рдХрд┐ domain admins рдХрд╛ рднреА)ред

{% content-ref url="constrained-delegation.md" %}
[constrained-delegation.md](constrained-delegation.md)
{% endcontent-ref %}

### Resourced-based Constrain Delegation

рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдХрд┐рд╕реА рд░рд┐рдореЛрдЯ рдХрдВрдкреНрдпреВрдЯрд░ рдХреЗ AD object рдкрд░ WRITE рдЕрдзрд┐рдХрд╛рд░ рд╣реИрдВ, рддреЛ рдЖрдк **elevated privileges рдХреЗ рд╕рд╛рде рдХреЛрдб execution рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**ред

{% content-ref url="resource-based-constrained-delegation.md" %}
[resource-based-constrained-delegation.md](resource-based-constrained-delegation.md)
{% endcontent-ref %}

### ACLs Abuse

рд╕рдордЭреМрддрд╛ рдХрд┐рдП рдЧрдП рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдкрд╛рд╕ рдХреБрдЫ рдбреЛрдореЗрди рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рдкрд░ **рд░реЛрдЪрдХ рдЕрдзрд┐рдХрд╛рд░** рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рдЖрдкрдХреЛ **рд▓реЗрдЯрд░рд▓ рдореВрд╡**/**рдЕрдзрд┐рдХрд╛рд░ рдмрдврд╝рд╛рдиреЗ** рдореЗрдВ рдорджрдж рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

{% content-ref url="acl-persistence-abuse/" %}
[acl-persistence-abuse](acl-persistence-abuse/)
{% endcontent-ref %}

### Printer Spooler service abuse

рдпрджрд┐ рдЖрдк рдХрд┐рд╕реА рднреА **Spool service рдХреЛ рд╕реБрдирддреЗ рд╣реБрдП** рдбреЛрдореЗрди рдХреЗ рдЕрдВрджрд░ рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ, рддреЛ рдЖрдк рдЗрд╕рдХрд╛ **рджреБрд░реБрдкрдпреЛрдЧ** рдХрд░рдХреЗ **рдирдИ credentials рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ** рдФрд░ **рдЕрдзрд┐рдХрд╛рд░ рдмрдврд╝рд╛ рд╕рдХрддреЗ рд╣реИрдВ**ред\
[**Spooler services рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХреИрд╕реЗ рдХрд░реЗрдВ рдЗрд╕рдХреА рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдпрд╣рд╛рдВ рд╣реИред**](printers-spooler-service-abuse.md)

### Third party sessions abuse

рдпрджрд┐ **рдЕрдиреНрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛** **access** рдХрд░рддреЗ рд╣реИрдВ **compromised** рдорд╢реАрди рдХреЛ, рддреЛ рд╕рдВрднрд╡ рд╣реИ рдХрд┐ **рдореЗрдореЛрд░реА рд╕реЗ credentials рдПрдХрддреНрд░ рдХрд░реЗрдВ** рдФрд░ рдпрд╣рд╛рдВ рддрдХ рдХрд┐ **рдЙрдирдХреА рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдореЗрдВ beacons inject рдХрд░реЗрдВ** рдЙрдирдХрд╛ рдЕрдиреБрдХрд░рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдПред\
рдЖрдорддреМрд░ рдкрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ RDP рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╕рд┐рд╕реНрдЯрдо рддрдХ рдкрд╣реБрдВрдЪреЗрдВрдЧреЗ, рдЗрд╕рд▓рд┐рдП рдпрд╣рд╛рдВ рдЖрдкрдХреЗ рдкрд╛рд╕ third party RDP sessions рдкрд░ рд╣рдорд▓рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреБрдЫ рддрд░реАрдХреЗ рд╣реИрдВ:

{% content-ref url="rdp-sessions-abuse.md" %}
[rdp-sessions-abuse.md](rdp-sessions-abuse.md)
{% endcontent-ref %}

### LAPS

**LAPS** рдЖрдкрдХреЛ **local Administrator password рдХрд╛ рдкреНрд░рдмрдВрдзрди рдХрд░рдиреЗ** рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ (рдЬреЛ **randomised**, рдЕрджреНрд╡рд┐рддреАрдп рд╣реИ, рдФрд░ **рдирд┐рдпрдорд┐рдд рд░реВрдк рд╕реЗ рдмрджрд▓рд╛ рдЬрд╛рддрд╛ рд╣реИ**) рдбреЛрдореЗрди-рдЬреБрдбрд╝реЗ рдХрдВрдкреНрдпреВрдЯрд░реЛрдВ рдкрд░ред рдпреЗ рдкрд╛рд╕рд╡рд░реНрдб Active Directory рдореЗрдВ рдХреЗрдВрджреНрд░реАрдп рд░реВрдк рд╕реЗ рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реЛрддреЗ рд╣реИрдВ рдФрд░ ACLs рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЕрдзрд┐рдХреГрдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рддрдХ рд╕реАрдорд┐рдд рд╣реЛрддреЗ рд╣реИрдВред рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ **рдЗрди рдкрд╛рд╕рд╡рд░реНрдбреЛрдВ рдХреЛ рдкрдврд╝рдиреЗ рдХреЗ рд▓рд┐рдП рдкрд░реНрдпрд╛рдкреНрдд рдЕрдиреБрдорддрд┐ рд╣реИ рддреЛ рдЖрдк рдЕрдиреНрдп рдХрдВрдкреНрдпреВрдЯрд░реЛрдВ рдкрд░ рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВ**ред

{% content-ref url="laps.md" %}
[laps.md](laps.md)
{% endcontent-ref %}

### Certificate Theft

рд╕рдордЭреМрддрд╛ рдХрд┐рдП рдЧрдП рдорд╢реАрди рд╕реЗ рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдПрдХрддреНрд░ рдХрд░рдирд╛ рд╡рд╛рддрд╛рд╡рд░рдг рдХреЗ рдЕрдВрджрд░ рдЕрдзрд┐рдХрд╛рд░ рдмрдврд╝рд╛рдиреЗ рдХрд╛ рдПрдХ рддрд░реАрдХрд╛ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ:

{% content-ref url="ad-certificates/certificate-theft.md" %}
[certificate-theft.md](ad-certificates/certificate-theft.md)
{% endcontent-ref %}

### Certificate Templates Abuse

рдпрджрд┐ рдХрдордЬреЛрд░ рдЯреЗрдореНрдкрд▓реЗрдЯреНрд╕ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдП рдЧрдП рд╣реИрдВ рддреЛ рдЙрдирдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЕрдзрд┐рдХрд╛рд░ рдмрдврд╝рд╛рдирд╛ рд╕рдВрднрд╡ рд╣реИ:

{% content-ref url="ad-certificates/domain-escalation.md" %}
[domain-escalation.md](ad-certificates/domain-escalation.md)
{% endcontent-ref %}

## Post-exploitation with high privilege account

### Dumping Domain Credentials

рдПрдХ рдмрд╛рд░ рдЬрдм рдЖрдк **Domain Admin** рдпрд╛ рдФрд░ рднреА рдмреЗрд╣рддрд░ **Enterprise Admin** рдЕрдзрд┐рдХрд╛рд░ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд▓реЗрддреЗ рд╣реИрдВ, рддреЛ рдЖрдк **domain database**: _ntds.dit_ рдХреЛ **dump** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

[**DCSync attack рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдпрд╣рд╛рдВ рдорд┐рд▓ рд╕рдХрддреА рд╣реИ**](dcsync.md).

[**NTDS.dit рдХреИрд╕реЗ рдЪреБрд░рд╛рдПрдВ рдЗрд╕рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдпрд╣рд╛рдВ рдорд┐рд▓ рд╕рдХрддреА рд╣реИ**](broken-reference/)

### Privesc as Persistence

рдкрд╣рд▓реЗ рдЪрд░реНрдЪрд╛ рдХреА рдЧрдИ рдХреБрдЫ рддрдХрдиреАрдХреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ persistence рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред\
рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП рдЖрдк рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

*   [**Kerberoast**](kerberoast.md) рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдмрдирд╛рдПрдВ

```powershell
Set-DomainObject -Identity <username> -Set @{serviceprincipalname="fake/NOTHING"}r
```
*   [**ASREPRoast**](asreproast.md) рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдмрдирд╛рдПрдВ

```powershell
Set-DomainObject -Identity <username> -XOR @{UserAccountControl=4194304}
```
*   рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ [**DCSync**](./#dcsync) рдЕрдзрд┐рдХрд╛рд░ рджреЗрдВ

```powershell
Add-DomainObjectAcl -TargetIdentity "DC=SUB,DC=DOMAIN,DC=LOCAL" -PrincipalIdentity bfarmer -Rights DCSync
```

### Silver Ticket

Silver ticket attack **рдПрдХ рд╡реИрдз TGS рдХреЛ рддреИрдпрд╛рд░ рдХрд░рдиреЗ рдкрд░ рдЖрдзрд╛рд░рд┐рдд рд╣реИ рдПрдХ рдмрд╛рд░ рдЬрдм рд╕реЗрд╡рд╛ рдХрд╛ NTLM hash рдЕрдкрдиреЗ рдкрд╛рд╕ рд╣реЛ** (рдЬреИрд╕реЗ рдХрд┐ **PC account hash**). рдЗрд╕ рдкреНрд░рдХрд╛рд░, рдпрд╣ рд╕рдВрднрд╡ рд╣реИ рдХрд┐ **рдЙрд╕ рд╕реЗрд╡рд╛ рддрдХ рдкрд╣реБрдВрдЪ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ** рдПрдХ рдХрд╕реНрдЯрдо TGS **рдХрд┐рд╕реА рднреА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд░реВрдк рдореЗрдВ** рдмрдирд╛рдХрд░ (рдЬреИрд╕реЗ рдХрд┐ рдХрдВрдкреНрдпреВрдЯрд░ рдкрд░ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛)ред

{% content-ref url="silver-ticket.md" %}
[silver-ticket.md](silver-ticket.md)
{% endcontent-ref %}

### Golden Ticket

рдПрдХ рд╡реИрдз **TGT рдХрд┐рд╕реА рднреА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд░реВрдк рдореЗрдВ** рдмрдирд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ **krbtgt AD account рдХреЗ NTLM hash рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ**ред TGS рдХреЗ рдмрдЬрд╛рдп TGT рдмрдирд╛рдиреЗ рдХрд╛ рд▓рд╛рдн рдпрд╣ рд╣реИ рдХрд┐ рдЖрдк **рдХрд┐рд╕реА рднреА рд╕реЗрд╡рд╛ рддрдХ рдкрд╣реБрдВрдЪ рд╕рдХрддреЗ рд╣реИрдВ** (рдпрд╛ рдорд╢реАрди) рдбреЛрдореЗрди рдореЗрдВ рдЕрдиреБрдХрд░рдг рдХрд┐рдП рдЧрдП рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд░реВрдк рдореЗрдВред

{% content-ref url="golden-ticket.md" %}
[golden-ticket.md](golden-ticket.md)
{% endcontent-ref %}

### Diamond Ticket

рдпреЗ golden tickets рдХреА рддрд░рд╣ рд╣реЛрддреЗ рд╣реИрдВ рдЬреЛ рдПрдХ рддрд░реАрдХреЗ рд╕реЗ рдмрдирд╛рдП рдЬрд╛рддреЗ рд╣реИрдВ рдЬреЛ **common golden tickets detection mechanisms рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рддреЗ рд╣реИрдВред**

{% content-ref
```
Get-DomainTrust

SourceName      : sub.domain.local    --> current domain
TargetName      : domain.local        --> foreign domain
TrustType       : WINDOWS_ACTIVE_DIRECTORY
TrustAttributes : WITHIN_FOREST       --> WITHIN_FOREST: Both in the same forest
TrustDirection  : Bidirectional       --> Trust direction (2ways in this case)
WhenCreated     : 2/19/2021 1:28:00 PM
WhenChanged     : 2/19/2021 1:28:00 PM
```
{% hint style="warning" %}
рдпрд╣рд╛рдБ **2 рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рдХреБрдВрдЬрд┐рдпрд╛рдБ** рд╣реИрдВ, рдПрдХ _Child --> Parent_ рдХреЗ рд▓рд┐рдП рдФрд░ рджреВрд╕рд░реА _Parent_ --> _Child_ рдХреЗ рд▓рд┐рдПред\
рдЖрдк рд╡рд░реНрддрдорд╛рди рдбреЛрдореЗрди рджреНрд╡рд╛рд░рд╛ рдкреНрд░рдпреБрдХреНрдд рдХреБрдВрдЬреА рдХреЛ рдЗрд╕рдХреЗ рд╕рд╛рде рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
Invoke-Mimikatz -Command '"lsadump::trust /patch"' -ComputerName dc.my.domain.local
Invoke-Mimikatz -Command '"lsadump::dcsync /user:dcorp\mcorp$"'
```
#### SID-History Injection

рдПрдВрдЯрд░рдкреНрд░рд╛рдЗрдЬ рдПрдбрдорд┐рди рдХреЗ рд░реВрдк рдореЗрдВ рдПрд╕реНрдХрд▓реЗрдЯ рдХрд░реЗрдВ рдФрд░ рдЪрд╛рдЗрд▓реНрдб/рдкреЗрд░реЗрдВрдЯ рдбреЛрдореЗрди рдореЗрдВ рдЯреНрд░рд╕реНрдЯ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ SID-History рдЗрдВрдЬреЗрдХреНрд╢рди рдХреЗ рд╕рд╛рде:

{% content-ref url="sid-history-injection.md" %}
[sid-history-injection.md](sid-history-injection.md)
{% endcontent-ref %}

#### рд▓рд┐рдЦрдиреЗ рдпреЛрдЧреНрдп Configuration NC рдХрд╛ рд╢реЛрд╖рдг

Configuration NC рдПрдХ рдлреЙрд░реЗрд╕реНрдЯ рдХреЗ рд▓рд┐рдП рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдЬрд╛рдирдХрд╛рд░реА рдХрд╛ рдкреНрд░рд╛рдердорд┐рдХ рднрдВрдбрд╛рд░ рд╣реИ рдФрд░ рдЗрд╕реЗ рдлреЙрд░реЗрд╕реНрдЯ рдХреЗ рд╣рд░ DC рдореЗрдВ рд░реЗрдкреНрд▓рд┐рдХреЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдлреЙрд░реЗрд╕реНрдЯ рдХреЗ рд╣рд░ рд▓рд┐рдЦрдиреЗ рдпреЛрдЧреНрдп DC (рд░реАрдб-рдУрдирд▓реА DCs рдирд╣реАрдВ) рдореЗрдВ Configuration NC рдХреА рдПрдХ рд▓рд┐рдЦрдиреЗ рдпреЛрдЧреНрдп рдкреНрд░рддрд┐ рд╣реЛрддреА рд╣реИред рдЗрд╕рдХрд╛ рд╢реЛрд╖рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП (рдЪрд╛рдЗрд▓реНрдб) DC рдкрд░ SYSTEM рдХреЗ рд░реВрдк рдореЗрдВ рдЪрд▓рд╛рдирд╛ рдЖрд╡рд╢реНрдпрдХ рд╣реИред

рд░реВрдЯ рдбреЛрдореЗрди рдХреЛ рд╡рд┐рднрд┐рдиреНрди рддрд░реАрдХреЛрдВ рд╕реЗ рд╕рдордЭреМрддрд╛ рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИ рдЬреЛ рдиреАрдЪреЗ рджрд┐рдП рдЧрдП рд╣реИрдВред

**рд░реВрдЯ DC рд╕рд╛рдЗрдЯ рдкрд░ GPO рд▓рд┐рдВрдХ рдХрд░реЗрдВ**

Configuration NC рдореЗрдВ Sites рдХрдВрдЯреЗрдирд░ рдореЗрдВ AD рдлреЙрд░реЗрд╕реНрдЯ рдореЗрдВ рдбреЛрдореЗрди-рдЬреБрдбрд╝реЗ рдХрдВрдкреНрдпреВрдЯрд░реЛрдВ рдХреА рд╕рднреА рд╕рд╛рдЗрдЯреНрд╕ рд╣реЛрддреА рд╣реИрдВред рдЬрдм рдлреЙрд░реЗрд╕реНрдЯ рдХреЗ рдХрд┐рд╕реА рднреА DC рдкрд░ SYSTEM рдХреЗ рд░реВрдк рдореЗрдВ рдЪрд▓ рд░рд╣рд╛ рд╣реЛ, рддреЛ рд╕рд╛рдЗрдЯреНрд╕ рдкрд░ GPOs рд▓рд┐рдВрдХ рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рдлреЙрд░реЗрд╕реНрдЯ рд░реВрдЯ DCs рдХреА рд╕рд╛рдЗрдЯреНрд╕ рднреА рд╢рд╛рдорд┐рд▓ рд╣реИрдВ, рдФрд░ рдЗрд╕ рдкреНрд░рдХрд╛рд░ рдЗрдиреНрд╣реЗрдВ рд╕рдордЭреМрддрд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдпрд╣рд╛рдБ рдкрдврд╝реА рдЬрд╛ рд╕рдХрддреА рд╣реИ [Bypass SID filtering research](https://improsec.com/tech-blog/sid-filter-as-security-boundary-between-domains-part-4-bypass-sid-filtering-research)ред

**рдлреЙрд░реЗрд╕реНрдЯ рдореЗрдВ рдХрд┐рд╕реА рднреА gMSA рдХреЛ рд╕рдордЭреМрддрд╛ рдХрд░реЗрдВ**

рдпрд╣ рд╣рдорд▓рд╛ рд▓рдХреНрд╖рд┐рдд рдбреЛрдореЗрди рдореЗрдВ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдкреНрд░рд╛рдкреНрдд gMSAs рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддрд╛ рд╣реИред

KDS Root key, рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдлреЙрд░реЗрд╕реНрдЯ рдореЗрдВ gMSAs рдХреЗ рдкрд╛рд╕рд╡рд░реНрдб рдХреА рдЧрдгрдирд╛ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, Configuration NC рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реЛрддрд╛ рд╣реИред рдЬрдм рдлреЙрд░реЗрд╕реНрдЯ рдХреЗ рдХрд┐рд╕реА рднреА DC рдкрд░ SYSTEM рдХреЗ рд░реВрдк рдореЗрдВ рдЪрд▓ рд░рд╣рд╛ рд╣реЛ, рддреЛ рдХреЛрдИ KDS Root key рдХреЛ рдкрдврд╝ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдлреЙрд░реЗрд╕реНрдЯ рдореЗрдВ рдХрд┐рд╕реА рднреА gMSA рдХрд╛ рдкрд╛рд╕рд╡рд░реНрдб рдХреА рдЧрдгрдирд╛ рдХрд░ рд╕рдХрддрд╛ рд╣реИред

рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдпрд╣рд╛рдБ рдкрдврд╝реА рдЬрд╛ рд╕рдХрддреА рд╣реИ: [Golden gMSA trust attack from child to parent](https://improsec.com/tech-blog/sid-filter-as-security-boundary-between-domains-part-5-golden-gmsa-trust-attack-from-child-to-parent)ред

**Schema change attack**

рдЗрд╕ рд╣рдорд▓реЗ рдХреЗ рд▓рд┐рдП рд╣рдорд▓рд╛рд╡рд░ рдХреЛ рдирдП рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдкреНрд░рд╛рдкреНрдд AD рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рдХреЗ рдмрдирд╛рдП рдЬрд╛рдиреЗ рдХрд╛ рдЗрдВрддрдЬрд╛рд░ рдХрд░рдирд╛ рдкрдбрд╝рддрд╛ рд╣реИред

рдЬрдм рдлреЙрд░реЗрд╕реНрдЯ рдХреЗ рдХрд┐рд╕реА рднреА DC рдкрд░ SYSTEM рдХреЗ рд░реВрдк рдореЗрдВ рдЪрд▓ рд░рд╣рд╛ рд╣реЛ, рддреЛ рдХреЛрдИ рднреА рдпреВрдЬрд░ рдХреЛ AD Schema рдореЗрдВ рд╕рднреА рдХреНрд▓рд╛рд╕реЗрд╕ рдкрд░ рдкреВрд░реНрдг рдирд┐рдпрдВрддреНрд░рдг рдкреНрд░рджрд╛рди рдХрд░ рд╕рдХрддрд╛ рд╣реИред рдЗрд╕ рдирд┐рдпрдВрддреНрд░рдг рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд┐рд╕реА рднреА AD рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЗ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд╕рд┐рдХреНрдпреЛрд░рд┐рдЯреА рдбрд┐рд╕реНрдХреНрд░рд┐рдкреНрдЯрд░ рдореЗрдВ рдПрдХ ACE рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ рд╕рдордЭреМрддрд╛ рдХрд┐рдП рдЧрдП рдкреНрд░рд┐рдВрд╕рд┐рдкрд▓ рдХреЛ рдкреВрд░реНрдг рдирд┐рдпрдВрддреНрд░рдг рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред рд╕рдВрд╢реЛрдзрд┐рдд AD рдСрдмреНрдЬреЗрдХреНрдЯ рдкреНрд░рдХрд╛рд░реЛрдВ рдХреЗ рд╕рднреА рдирдП рдЙрджрд╛рд╣рд░рдгреЛрдВ рдореЗрдВ рдпрд╣ ACE рд╣реЛрдЧрд╛ред

рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдпрд╣рд╛рдБ рдкрдврд╝реА рдЬрд╛ рд╕рдХрддреА рд╣реИ: [Schema change trust attack from child to parent](https://improsec.com/tech-blog/sid-filter-as-security-boundary-between-domains-part-6-schema-change-trust-attack-from-child-to-parent)ред

**ADCS ESC5 рдХреЗ рд╕рд╛рде DA рд╕реЗ EA рддрдХ**

ADCS ESC5 (Vulnerable PKI Object Access Control) рд╣рдорд▓реЗ PKI рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рдкрд░ рдирд┐рдпрдВрддреНрд░рдг рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рдПрдХ рднреЗрджреНрдп рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдЯреЗрдореНрдкрд▓реЗрдЯ рдмрдирд╛рдпрд╛ рдЬрд╛ рд╕рдХреЗ рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдлреЙрд░реЗрд╕реНрдЯ рдореЗрдВ рдХрд┐рд╕реА рднреА рдпреВрдЬрд░ рдХреЗ рд░реВрдк рдореЗрдВ рдкреНрд░рдорд╛рдгрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдЪреВрдВрдХрд┐ рд╕рднреА PKI рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ Configuration NC рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реЛрддреЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рдпрджрд┐ рдХрд┐рд╕реА рдиреЗ рдлреЙрд░реЗрд╕реНрдЯ рдореЗрдВ рдХрд┐рд╕реА рднреА рд▓рд┐рдЦрдиреЗ рдпреЛрдЧреНрдп (рдЪрд╛рдЗрд▓реНрдб) DC рдХреЛ рд╕рдордЭреМрддрд╛ рдХрд┐рдпрд╛ рд╣реИ, рддреЛ рд╡реЗ ESC5 рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдпрд╣рд╛рдБ рдкрдврд╝реА рдЬрд╛ рд╕рдХрддреА рд╣реИ: [From DA to EA with ESC5](https://posts.specterops.io/from-da-to-ea-with-esc5-f9f045aa105c)

рдпрджрд┐ AD рдлреЙрд░реЗрд╕реНрдЯ рдореЗрдВ ADCS рдирд╣реАрдВ рд╣реИ, рддреЛ рд╣рдорд▓рд╛рд╡рд░ рдпрд╣рд╛рдБ рд╡рд░реНрдгрд┐рдд рдХреЗ рдЕрдиреБрд╕рд╛рд░ рдЖрд╡рд╢реНрдпрдХ рдШрдЯрдХ рдмрдирд╛ рд╕рдХрддрд╛ рд╣реИ: [Escalating from child domainтАЩs admins to enterprise admins in 5 minutes by abusing AD CS, a follow up](https://www.pkisolutions.com/escalating-from-child-domains-admins-to-enterprise-admins-in-5-minutes-by-abusing-ad-cs-a-follow-up/).

### рдмрд╛рд╣рд░реА рдлреЙрд░реЗрд╕реНрдЯ рдбреЛрдореЗрди - рдПрдХ-рддрд░рдлрд╛ (рдЗрдирдмрд╛рдЙрдВрдб) рдпрд╛ рджреНрд╡рд┐рджрд┐рд╢ (bidirectional)
```powershell
Get-DomainTrust
SourceName      : a.domain.local   --> Current domain
TargetName      : domain.external  --> Destination domain
TrustType       : WINDOWS-ACTIVE_DIRECTORY
TrustAttributes :
TrustDirection  : Inbound          --> Inboud trust
WhenCreated     : 2/19/2021 10:50:56 PM
WhenChanged     : 2/19/2021 10:50:56 PM
```
рдЗрд╕ рдкрд░рд┐рджреГрд╢реНрдп рдореЗрдВ **рдЖрдкрдХреЗ рдбреЛрдореЗрди рдкрд░ рд╡рд┐рд╢реНрд╡рд╛рд╕ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ** рдПрдХ рдмрд╛рд╣рд░реА рдбреЛрдореЗрди рджреНрд╡рд╛рд░рд╛ рдЬреЛ рдЖрдкрдХреЛ **рдЕрдирд┐рд░реНрдзрд╛рд░рд┐рдд рдЕрдиреБрдорддрд┐рдпрд╛рдБ** рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред рдЖрдкрдХреЛ рдпрд╣ рдкрддрд╛ рд▓рдЧрд╛рдирд╛ рд╣реЛрдЧрд╛ рдХрд┐ **рдЖрдкрдХреЗ рдбреЛрдореЗрди рдХреЗ рдХреМрди рд╕реЗ рд╕рд┐рджреНрдзрд╛рдВрддрдХрд╛рд░ рдмрд╛рд╣рд░реА рдбреЛрдореЗрди рдкрд░ рдХрд┐рд╕ рдкреНрд░рдХрд╛рд░ рдХреА рдкрд╣реБрдБрдЪ рд░рдЦрддреЗ рд╣реИрдВ** рдФрд░ рдлрд┐рд░ рдЗрд╕рдХрд╛ рджреЛрд╣рди рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдВ:

{% content-ref url="external-forest-domain-oneway-inbound.md" %}
[external-forest-domain-oneway-inbound.md](external-forest-domain-oneway-inbound.md)
{% endcontent-ref %}

### рдмрд╛рд╣рд░реА рд╡рди рдбреЛрдореЗрди - рдПрдХ-рддрд░рдлрд╛ (рдЖрдЙрдЯрдмрд╛рдЙрдВрдб)
```powershell
Get-DomainTrust -Domain current.local

SourceName      : current.local   --> Current domain
TargetName      : external.local  --> Destination domain
TrustType       : WINDOWS_ACTIVE_DIRECTORY
TrustAttributes : FOREST_TRANSITIVE
TrustDirection  : Outbound        --> Outbound trust
WhenCreated     : 2/19/2021 10:15:24 PM
WhenChanged     : 2/19/2021 10:15:24 PM
```
```markdown
рдЗрд╕ рдкрд░рд┐рджреГрд╢реНрдп рдореЗрдВ **рдЖрдкрдХрд╛ рдбреЛрдореЗрди** рдХреБрдЫ **рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░** **рдЕрд▓рдЧ рдбреЛрдореЗрди** рд╕реЗ рдЖрдП рдкреНрд░рд┐рдВрд╕рд┐рдкрд▓ рдХреЛ **рд╡рд┐рд╢реНрд╡рд╛рд╕** рдХрд░ рд░рд╣рд╛ рд╣реИред

рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЬрдм рдПрдХ **рдбреЛрдореЗрди рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рд╣реЛрддрд╛ рд╣реИ** рддреЛ рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рдбреЛрдореЗрди рдПрдХ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдмрдирд╛рддрд╛ рд╣реИ** рдЬрд┐рд╕рдХрд╛ рдирд╛рдо **рдЕрдиреБрдорд╛рдирд┐рдд рд╣реЛрддрд╛ рд╣реИ** рдФрд░ рдЬреЛ **рдкрд╛рд╕рд╡рд░реНрдб рдХреЗ рд░реВрдк рдореЗрдВ рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рдкрд╛рд╕рд╡рд░реНрдб** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рдбреЛрдореЗрди рдХреЗ рдЕрдВрджрд░ рдЬрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рд╡рд┐рд╢реНрд╡рд╛рд╕ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдбреЛрдореЗрди рдХреЗ рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ **рдкрд╣реБрдВрдЪ рд╕рдВрднрд╡ рд╣реИ** рддрд╛рдХрд┐ рдЙрд╕реЗ рдЧрд┐рдирд╛ рдЬрд╛ рд╕рдХреЗ рдФрд░ рдЕрдзрд┐рдХ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЛ рдмрдврд╝рд╛рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХреА рдЬрд╛ рд╕рдХреЗ:

{% content-ref url="external-forest-domain-one-way-outbound.md" %}
[external-forest-domain-one-way-outbound.md](external-forest-domain-one-way-outbound.md)
{% endcontent-ref %}

рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рдбреЛрдореЗрди рдХреЛ рд╕рдордЭреМрддрд╛ рдХрд░рдиреЗ рдХрд╛ рдПрдХ рдФрд░ рддрд░реАрдХрд╛ рд╣реИ [**SQL рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рд▓рд┐рдВрдХ**](abusing-ad-mssql.md#mssql-trusted-links) рдХреЛ рдвреВрдВрдврдирд╛ рдЬреЛ рдбреЛрдореЗрди рд╡рд┐рд╢реНрд╡рд╛рд╕ рдХреА **рд╡рд┐рдкрд░реАрдд рджрд┐рд╢рд╛** рдореЗрдВ рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ (рдЬреЛ рдмрд╣реБрдд рдЖрдо рдирд╣реАрдВ рд╣реИ)ред

рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рдбреЛрдореЗрди рдХреЛ рд╕рдордЭреМрддрд╛ рдХрд░рдиреЗ рдХрд╛ рдПрдХ рдФрд░ рддрд░реАрдХрд╛ рд╣реИ рдЙрд╕ рдорд╢реАрди рдореЗрдВ рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд░рдирд╛ рдЬрд╣рд╛рдВ рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рдбреЛрдореЗрди рдХрд╛ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкрд╣реБрдВрдЪ рд╕рдХрддрд╛ рд╣реИ** **RDP** рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд▓реЙрдЧрд┐рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдПред рдлрд┐рд░, рд╣рдорд▓рд╛рд╡рд░ RDP рд╕рддреНрд░ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рдХреЛрдб рдЗрдВрдЬреЗрдХреНрдЯ рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдФрд░ **рдкреАрдбрд╝рд┐рдд рдХреЗ рдореВрд▓ рдбреЛрдореЗрди рддрдХ рдкрд╣реБрдВрдЪ рд╕рдХрддрд╛ рд╣реИ**ред\
рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЕрдЧрд░ **рдкреАрдбрд╝рд┐рдд рдиреЗ рдЕрдкрдиреА рд╣рд╛рд░реНрдб рдбреНрд░рд╛рдЗрд╡ рдорд╛рдЙрдВрдЯ рдХреА рд╣реИ**, рддреЛ **RDP рд╕рддреНрд░** рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд╕реЗ рд╣рдорд▓рд╛рд╡рд░ рд╣рд╛рд░реНрдб рдбреНрд░рд╛рдЗрд╡ рдХреЗ **рд╕реНрдЯрд╛рд░реНрдЯрдЕрдк рдлреЛрд▓реНрдбрд░ рдореЗрдВ рдмреИрдХрдбреЛрд░реНрд╕** рд╕реНрдЯреЛрд░ рдХрд░ рд╕рдХрддрд╛ рд╣реИред рдЗрд╕ рддрдХрдиреАрдХ рдХреЛ **RDPInception** рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИред

{% content-ref url="rdp-sessions-abuse.md" %}
[rdp-sessions-abuse.md](rdp-sessions-abuse.md)
{% endcontent-ref %}

### рдбреЛрдореЗрди рд╡рд┐рд╢реНрд╡рд╛рд╕ рдХреЗ рджреБрд░реБрдкрдпреЛрдЧ рдХреА рд░реЛрдХрдерд╛рдо

**SID рдлрд┐рд▓реНрдЯрд░рд┐рдВрдЧ:**

* рд╡рди рд╡рд┐рд╢реНрд╡рд╛рд╕ рдХреЗ рдкрд╛рд░ SID рдЗрддрд┐рд╣рд╛рд╕ рд╡рд┐рд╢реЗрд╖рддрд╛ рдХреЗ рджреБрд░реБрдкрдпреЛрдЧ рд╕реЗ рдмрдЪреЗрдВред
* рд╕рднреА рдЕрдВрддрд░-рд╡рди рд╡рд┐рд╢реНрд╡рд╛рд╕реЛрдВ рдкрд░ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рд╕рдХреНрд╖рдоред рдЗрдВрдЯреНрд░рд╛-рдлрд╝реЙрд░реЗрд╕реНрдЯ рд╡рд┐рд╢реНрд╡рд╛рд╕реЛрдВ рдХреЛ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рд╕реБрд░рдХреНрд╖рд┐рдд рдорд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИ (MS рд╡рди рдХреЛ рдбреЛрдореЗрди рдХреЗ рдмрдЬрд╛рдп рд╕реБрд░рдХреНрд╖рд╛ рд╕реАрдорд╛ рдорд╛рдирддрд╛ рд╣реИ)ред
* рд▓реЗрдХрд┐рди, рдЪреВрдВрдХрд┐ SID рдлрд┐рд▓реНрдЯрд░рд┐рдВрдЧ рд╕реЗ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдФрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкрд╣реБрдВрдЪ рдХреЛ рдЯреВрдЯрдиреЗ рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рд╣реЛрддреА рд╣реИ, рдЗрд╕реЗ рдЕрдХреНрд╕рд░ рдЕрдХреНрд╖рдо рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред
* рдЪрдпрдирд╛рддреНрдордХ рдкреНрд░рдорд╛рдгреАрдХрд░рдг
* рдПрдХ рдЕрдВрддрд░-рд╡рди рд╡рд┐рд╢реНрд╡рд╛рд╕ рдореЗрдВ, рдпрджрд┐ рдЪрдпрдирд╛рддреНрдордХ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рддреЛ рд╡рд┐рд╢реНрд╡рд╛рд╕реЛрдВ рдХреЗ рдмреАрдЪ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдкреНрд░рдорд╛рдгрд┐рдд рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред рд╡рд┐рд╢реНрд╡рд╛рд╕ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдбреЛрдореЗрди/рд╡рди рдореЗрдВ рдбреЛрдореЗрди рдФрд░ рд╕рд░реНрд╡рд░реЛрдВ рддрдХ рд╡реНрдпрдХреНрддрд┐рдЧрдд рдкрд╣реБрдВрдЪ рджреА рдЬрд╛рдиреА рдЪрд╛рд╣рд┐рдПред
* рд▓рд┐рдЦрдиреЗ рдпреЛрдЧреНрдп Configration NC рд╢реЛрд╖рдг рдФрд░ рд╡рд┐рд╢реНрд╡рд╛рд╕ рдЦрд╛рддрд╛ рд╣рдорд▓реЗ рдХреЛ рд░реЛрдХрддрд╛ рдирд╣реАрдВ рд╣реИред

[**рдбреЛрдореЗрди рд╡рд┐рд╢реНрд╡рд╛рд╕реЛрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА ired.team рдореЗрдВред**](https://ired.team/offensive-security-experiments/active-directory-kerberos-abuse/child-domain-da-to-ea-in-parent-domain)

## AD -> рдХреНрд▓рд╛рдЙрдб & рдХреНрд▓рд╛рдЙрдб -> AD

{% embed url="https://cloud.hacktricks.xyz/pentesting-cloud/azure-security/az-lateral-movements/azure-ad-connect-hybrid-identity" %}

## рдХреБрдЫ рд╕рд╛рдорд╛рдиреНрдп рд░рдХреНрд╖рд╛

[**рдпрд╣рд╛рдВ рдЬрд╛рдиреЗрдВ рдХрд┐ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреА рд╕реБрд░рдХреНрд╖рд╛ рдХреИрд╕реЗ рдХрд░реЗрдВред**](../stealing-credentials/credentials-protections.md)\
**рдХреГрдкрдпрд╛, рдкреНрд░рддреНрдпреЗрдХ рддрдХрдиреАрдХ рдХреЗ рд╡рд┐рд╡рд░рдг рдореЗрдВ рдХреБрдЫ рдорд╛рдЗрдЧреНрд░реЗрд╢рди рдЦреЛрдЬреЗрдВред**

* рдбреЛрдореЗрди рдПрдбрдорд┐рдиреНрд╕ рдХреЛ рдбреЛрдореЗрди рдХрдВрдЯреНрд░реЛрд▓рд░реНрд╕ рдХреЗ рдЕрд▓рд╛рд╡рд╛ рдХрд┐рд╕реА рдЕрдиреНрдп рд╣реЛрд╕реНрдЯ рдкрд░ рд▓реЙрдЧрд┐рди рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рди рджреЗрдВ
* рдХрднреА рднреА DA рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЗ рд╕рд╛рде рд╕реЗрд╡рд╛ рди рдЪрд▓рд╛рдПрдВ
* рдпрджрд┐ рдЖрдкрдХреЛ рдбреЛрдореЗрди рдПрдбрдорд┐рди рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рддреЛ рд╕рдордп рд╕реАрдорд┐рдд рдХрд░реЗрдВ: `Add-ADGroupMember -Identity тАШDomain AdminsтАЩ -Members newDA -MemberTimeToLive (New-TimeSpan -Minutes 20)`

### рдЫрд▓

* рдкрд╛рд╕рд╡рд░реНрдб рдХрднреА рд╕рдорд╛рдкреНрдд рдирд╣реАрдВ рд╣реЛрддрд╛
* рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ рдХреЗ рд▓рд┐рдП рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп
* SPN рдХреЗ рд╕рд╛рде рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛
* рд╡рд┐рд╡рд░рдг рдореЗрдВ рдкрд╛рд╕рд╡рд░реНрдб
* рдЙрдЪреНрдЪ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╕рдореВрд╣реЛрдВ рдХреЗ рд╕рджрд╕реНрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛
* рдЕрдиреНрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ, рд╕рдореВрд╣реЛрдВ рдпрд╛ рдХрдВрдЯреЗрдирд░реЛрдВ рдкрд░ ACL рдЕрдзрд┐рдХрд╛рд░реЛрдВ рд╡рд╛рд▓реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛
* рдХрдВрдкреНрдпреВрдЯрд░ рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕
* ...
* [https://github.com/samratashok/Deploy-Deception](https://github.com/samratashok/Deploy-Deception)
* `Create-DecoyUser -UserFirstName user -UserLastName manager-uncommon -Password Pass@123 | DeployUserDeception -UserFlag PasswordNeverExpires -GUID d07da11f-8a3d-42b6-b0aa-76c962be719a -Verbose`

## рдЫрд▓ рдХреА рдкрд╣рдЪрд╛рди рдХреИрд╕реЗ рдХрд░реЗрдВ

**рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рдХреЗ рд▓рд┐рдП:**

* ObjectSID (рдбреЛрдореЗрди рд╕реЗ рдЕрд▓рдЧ)
* lastLogon, lastlogontimestamp
* Logoncount (рдмрд╣реБрдд рдХрдо рд╕рдВрдЦреНрдпрд╛ рд╕рдВрджрд┐рдЧреНрдз рд╣реИ)
* whenCreated
* Badpwdcount (рдмрд╣реБрдд рдХрдо рд╕рдВрдЦреНрдпрд╛ рд╕рдВрджрд┐рдЧреНрдз рд╣реИ)

**рд╕рд╛рдорд╛рдиреНрдп:**

* рдХреБрдЫ рд╕рдорд╛рдзрд╛рди рд╕рднреА рд╕рдВрднрд╛рд╡рд┐рдд рд╡рд┐рд╢реЗрд╖рддрд╛рдУрдВ рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА рднрд░рддреЗ рд╣реИрдВред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, DC рдЬреИрд╕реЗ 100% рд╡рд╛рд╕реНрддрд╡рд┐рдХ рдХрдВрдкреНрдпреВрдЯрд░ рдСрдмреНрдЬреЗрдХреНрдЯ рдХреА рд╡рд┐рд╢реЗрд╖рддрд╛рдУрдВ рдХреА рддреБрд▓рдирд╛ рдХрд░реЗрдВред рдпрд╛ RID 500 (рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдПрдбрдорд┐рди) рдХреЗ рдЦрд┐рд▓рд╛рдл рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреАред
* рдЬрд╛рдВрдЪреЗрдВ рдХрд┐ рдХреБрдЫ рдмрд╣реБрдд рдЕрдЪреНрдЫрд╛ рд╣реИ рддреЛ рд╕рдЪ рд╣реЛрдиреЗ рдХреЗ рд▓рд┐рдП
* [https://github.com/JavelinNetworks/HoneypotBuster](https://github.com/JavelinNetworks/HoneypotBuster)

### Microsoft ATA рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдирд╛

#### рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕реВрдЪреАрдХрд░рдг

ATA рдХреЗрд╡рд▓ рддрдм рд╢рд┐рдХрд╛рдпрдд рдХрд░рддрд╛ рд╣реИ рдЬрдм рдЖрдк DC рдореЗрдВ рд╕рддреНрд░реЛрдВ рдХреЛ рд╕реВрдЪреАрдмрджреНрдз рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рддреЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рдпрджрд┐ рдЖрдк DC рдореЗрдВ рд╕рддреНрд░реЛрдВ рдХреА рддрд▓рд╛рд╢ рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВ рд▓реЗрдХрд┐рди рдмрд╛рдХреА рд╣реЛрд╕реНрдЯреЛрдВ рдореЗрдВ, рддреЛ рдЖрдкрдХреЛ рд╢рд╛рдпрдж рдкрддрд╛ рдирд╣реАрдВ рдЪрд▓реЗрдЧрд╛ред

#### рдЯрд┐рдХрдЯ рдЕрдиреБрдХрд░рдг рдирд┐рд░реНрдорд╛рдг (Over pass the hash, golden ticket...)

рд╣рдореЗрд╢рд╛ рдЯрд┐рдХрдЯреЛрдВ рдХреЛ **aes** рдХреБрдВрдЬрд┐рдпреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдмрдирд╛рдПрдВ рдХреНрдпреЛрдВрдХрд┐ ATA рдЬреЛ рдорд╛рд▓рд┐рдХрд╛рдирд╛ рд╣реИ рд╡рд╣ NTLM рдХрд╛ рдЕрд╡рдореВрд▓реНрдпрди рд╣реИред

#### DCSync

рдпрджрд┐ рдЖрдк рдЗрд╕реЗ рдбреЛрдореЗрди рдХрдВрдЯреНрд░реЛрд▓рд░ рд╕реЗ рдирд╣реАрдВ рдЪрд▓рд╛рддреЗ рд╣реИрдВ, рддреЛ ATA рдЖрдкрдХреЛ рдкрдХрдбрд╝ рд▓реЗрдЧрд╛, рдХреНрд╖рдорд╛ рдХрд░реЗрдВред

## рдФрд░ рдЙрдкрдХрд░рдг

* [Powershell рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдбреЛрдореЗрди рдСрдбрд┐рдЯрд┐рдВрдЧ рдСрдЯреЛрдореЗрд╢рди рдХреЗ рд▓рд┐рдП](https://github.com/phillips321/adaudit)
* [Python рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдПрдХреНрдЯрд┐рд╡ рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА рдХреЛ рд╕реВрдЪреАрдмрджреНрдз рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП](https://github.com/ropnop/windapsearch)
* [Python рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдПрдХреНрдЯрд┐рд╡ рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА рдХреЛ рд╕реВрдЪреАрдмрджреНрдз рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП](https://github.com/CroweCybersecurity/ad-ldap-enum)

## рд╕рдВрджрд░реНрдн

* [http://www.harmj0y.net/blog/redteaming/a-guide-to-attacking-domain-trusts/](http://www.harmj0y.net/blog/redteaming/a-guide-to-attacking-domain-trusts/)

<details>

<summary><strong>AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рд╢реВрдиреНрдп рд╕реЗ рдирд╛рдпрдХ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХреЛ HackTricks рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд** рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб** рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рддреЛ [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░
