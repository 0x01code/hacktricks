# рдПрдХреНрдЯрд┐рд╡ рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА рдореЗрдердбреЛрд▓реЙрдЬреА

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>тШБя╕П HackTricks Cloud тШБя╕П</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ЁЯРж Twitter ЁЯРж</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ЁЯОЩя╕П Twitch ЁЯОЩя╕П</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ЁЯОе Youtube ЁЯОе</strong></a></summary>

* рдХреНрдпрд╛ рдЖрдк рдПрдХ **рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХрдВрдкрдиреА** рдореЗрдВ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ? рдХреНрдпрд╛ рдЖрдк рдЕрдкрдиреА рдХрдВрдкрдиреА рдХреЛ **рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд** рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ? рдпрд╛ рдХреНрдпрд╛ рдЖрдкрдХреЛ **PEASS рдХреА рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рдХрд╛ рдЙрдкрдпреЛрдЧ** рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ? [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ!
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рдПрдХрд▓ [**NFT**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣ред
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks swag**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**ЁЯТм**](https://emojipedia.org/speech-balloon/) [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ рдореБрдЭреЗ **Twitter** [**ЁЯРж**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)** рдХрд╛** рдЕрдиреБрд╕рд░рдг рдХрд░реЗрдВред**
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рдХреЛ** [**hacktricks рд░реЗрдкреЛ**](https://github.com/carlospolop/hacktricks) **рдФрд░** [**hacktricks-cloud рд░реЗрдкреЛ**](https://github.com/carlospolop/hacktricks-cloud) **рдореЗрдВ рдкреАрдЖрд░ рдЬрдорд╛ рдХрд░рдХреЗ** рдЕрдкрдирд╛ рдпреЛрдЧрджрд╛рди рджреЗрдВред

</details>

## рдореВрд▓ рдЕрд╡рд▓реЛрдХрди

рдПрдХреНрдЯрд┐рд╡ рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА рдиреЗрдЯрд╡рд░реНрдХ рдкреНрд░рд╢рд╛рд╕рдХреЛрдВ рдХреЛ рдиреЗрдЯрд╡рд░реНрдХ рдХреЗ рднреАрддрд░ рдбреЛрдореЗрди, рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдФрд░ рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рдмрдирд╛рдиреЗ рдФрд░ рдкреНрд░рдмрдВрдзрд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдПрдХ рдПрдбрдорд┐рди рдПрдХ рд╕рдореВрд╣ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рдмрдирд╛ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдЙрдиреНрд╣реЗрдВ рд╕рд░реНрд╡рд░ рдкрд░ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рд╡рд┐рд╢реЗрд╖ рдкрд╣реБрдВрдЪ рдЕрдзрд┐рдХрд╛рд░ рдкреНрд░рджрд╛рди рдХрд░ рд╕рдХрддрд╛ рд╣реИред рдЬрдм рдиреЗрдЯрд╡рд░реНрдХ рдмрдврд╝рддрд╛ рд╣реИ, рдПрдХреНрдЯрд┐рд╡ рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА рдПрдХ рддрд░реАрдХрд╛ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ рдЬрд┐рд╕рд╕реЗ рдПрдХ рдмрдбрд╝реА рд╕рдВрдЦреНрдпрд╛ рдХреЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рддрд╛рд░реНрдХрд┐рдХ рд╕рдореВрд╣реЛрдВ рдФрд░ рдЙрдк-рд╕рдореВрд╣реЛрдВ рдореЗрдВ рд╡реНрдпрд╡рд╕реНрдерд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЬрдмрдХрд┐ рдкреНрд░рддреНрдпреЗрдХ рд╕реНрддрд░ рдкрд░ рдкрд╣реБрдВрдЪ рдирд┐рдпрдВрддреНрд░рдг рдкреНрд░рджрд╛рди рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

рдПрдХреНрдЯрд┐рд╡ рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА рд╕рдВрд░рдЪрдирд╛ рдореЗрдВ рддреАрди рдореБрдЦреНрдп рд╕реНрддрд░ рд╢рд╛рдорд┐рд▓ рд╣реЛрддреЗ рд╣реИрдВ: 1) рдбреЛрдореЗрди, 2) рдЯреНрд░реАрдЬрд╝, рдФрд░ 3) рдлрд╝реЙрд░реЗрд╕реНрдЯред рдПрдХ рд╣реА рдбреЗрдЯрд╛рдмреЗрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдХрдИ рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ (рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдпрд╛ рдЙрдкрдХрд░рдг) рдПрдХ рд╣реА рдбреЛрдореЗрди рдореЗрдВ рд╕рдореВрд╣рд┐рдд рдХрд┐рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВред рдХрдИ рдбреЛрдореЗрдиреЛрдВ рдХреЛ рдПрдХ рд╣реА рд╕рдореВрд╣ рдореЗрдВ рдЬреЛрдбрд╝рд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдЬрд┐рд╕реЗ рдЯреНрд░реА рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИред рдХрдИ рдЯреНрд░реАрдЬрд╝ рдХреЛ рдПрдХ рд╕рдВрдЧреНрд░рд╣ рдореЗрдВ рдЬреЛрдбрд╝рд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдЬрд┐рд╕реЗ рдлрд╝реЙрд░реЗрд╕реНрдЯ рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИред рдЗрди рд╕рднреА рд╕реНрддрд░реЛрдВ рдореЗрдВ рд╡рд┐рд╢реЗрд╖ рдкрд╣реБрдВрдЪ рдЕрдзрд┐рдХрд╛рд░ рдФрд░ рд╕рдВрдЪрд╛рд░ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЛ рд╕реМрдВрдкрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

рдПрдХреНрдЯрд┐рд╡ рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА рдХрдИ рд╡рд┐рднрд┐рдиреНрди рд╕реЗрд╡рд╛рдПрдВ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ, рдЬреЛ "рдПрдХреНрдЯрд┐рд╡ рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА рдбреЛрдореЗрди рд╕реЗрд╡рд╛рдПрдВ" рдпрд╛ AD DS рдХреЗ рддрд╣рдд рдЖрддреА рд╣реИрдВред рдЗрди рд╕реЗрд╡рд╛рдУрдВ рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реИрдВ:

1. **рдбреЛрдореЗрди рд╕реЗрд╡рд╛рдПрдВ** - рдХреЗрдВрджреНрд░реАрдпрдХреГрдд рдбреЗрдЯрд╛ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рддреА рд╣реИрдВ рдФрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдФрд░ рдбреЛрдореЗрдиреЛрдВ рдХреЗ рдмреАрдЪ рд╕рдВрдЪрд╛рд░ рдХрд╛ рдкреНрд░рдмрдВрдзрди рдХрд░рддреА рд╣реИрдВ; рд▓реЙрдЧрд┐рди рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдФрд░ рдЦреЛрдЬ рдХреНрд╖рдорддрд╛ рд╢рд╛рдорд┐рд▓ рд╣реЛрддреА рд╣реИрдВ
2. **рд╕рд░реНрдЯрд┐рдлрд┐рдХреЗрдЯ рд╕реЗрд╡рд╛рдПрдВ** - рд╕реБрд░рдХреНрд╖рд┐рдд рдкреНрд░рдорд╛рдгрдкрддреНрд░реЛрдВ рдХреЛ рдмрдирд╛рддреА, рд╡рд┐рддрд░рд┐рдд рдХрд░рддреА рдФрд░ рдкреНрд░рдмрдВрдзрд┐рдд рдХрд░рддреА рд╣реИрдВ
3. **рд▓рд╛рдЗрдЯрд╡реЗрдЯ рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА рд╕реЗрд╡рд╛рдПрдВ** - рдЦреБрд▓реЗ (LDAP) рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛-рд╕рдХ
* [**рдЕрднрд┐рдпрд╛рдВрддреНрд░рд┐рдХреА рдЖрдХреНрд░рдордг**](../../generic-methodologies-and-resources/pentesting-network/spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md#relay-attack) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╣реЛрд╕реНрдЯ рддрдХ рдкрд╣реБрдВрдЪреЗрдВ
* [**рдЦреБрд▓рд╛рд╕рд╛ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ**](../../generic-methodologies-and-resources/pentesting-network/spoofing-ssdp-and-upnp-devices.md) [**рдЦреЛрдЦрд▓реА UPnP рд╕реЗрд╡рд╛рдУрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ evil-S**](https://medium.com/@nickvangilder/exploiting-multifunction-printers-during-a-penetration-test-engagement-28d3840d8856)
* [**OSINT**](https://book.hacktricks.xyz/external-recon-methodology):
* рдЖрдВрддрд░рд┐рдХ рджрд╕реНрддрд╛рд╡реЗрдЬрд╝реЛрдВ, рд╕рд╛рдорд╛рдЬрд┐рдХ рдореАрдбрд┐рдпрд╛, рд╕реЗрд╡рд╛рдУрдВ (рдореБрдЦреНрдп рд░реВрдк рд╕реЗ рд╡реЗрдм) рдХреЗ рдЕрдВрджрд░ рдбреЛрдореЗрди рд╡рд╛рддрд╛рд╡рд░рдг рдФрд░ рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рд░реВрдк рд╕реЗ рдЙрдкрд▓рдмреНрдз рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рд╕реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо / рдирд╛рдо рдирд┐рдХрд╛рд▓реЗрдВред
* рдпрджрд┐ рдЖрдк рдХрдВрдкрдиреА рдХреЗ рдХрд░реНрдордЪрд╛рд░рд┐рдпреЛрдВ рдХреЗ рдкреВрд░реЗ рдирд╛рдо рдкрд╛рддреЗ рд╣реИрдВ, рддреЛ рдЖрдк рд╡рд┐рднрд┐рдиреНрди AD **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдордирд┐рд░реНрдзрд╛рд░рдгреЛрдВ** рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ (**[рдпрд╣ рдкрдврд╝реЗрдВ](https://activedirectorypro.com/active-directory-user-naming-convention/)**)ред рд╕рдмрд╕реЗ рд╕рд╛рдорд╛рдиреНрдп рдирд┐рдпрдорд╛рдВрдХрди рд╣реИрдВ: _рдирд╛рдордЙрдкрдирд╛рдо_, _рдирд╛рдо.рдЙрдкрдирд╛рдо_, _рдирд╛рдордЙрдк_, _рдирд╛рдо.рдЙрдкрдирд╛рдо_, _рдЙрдкрдирд╛рдордирд╛рдо_, _рдЙрдкрдирд╛рдо.рдирд╛рдо_, _рдЙрдкрдирд╛рдорди_, _рдЙрдкрдирд╛рдо.рдирд╛рдо_, _рдЙрдкрдирд╛рдорди_, _рдЙрдкрдирд╛рдо.рдирд╛рдо_, 3 _рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рдЕрдХреНрд╖рд░ рдФрд░ 3 рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рд╕рдВрдЦреНрдпрд╛рдПрдВ_ (abc123)ред
* рдЙрдкрдХрд░рдг:
* [w0Tx/generate-ad-username](https://github.com/w0Tx/generate-ad-username)
* [urbanadventurer/username-anarchy](https://github.com/urbanadventurer/username-anarchy)

### рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЧрдгрдирд╛

* **рдЕрдирд╛рдо рд╕рдВрдм/рдПрд▓рдбреАрдПрдкреА рдЧрдгрдирд╛:** [**рдкреЗрдВрдЯреЗрд╕реНрдЯрд┐рдВрдЧ SMB**](../../network-services-pentesting/pentesting-smb.md) рдФрд░ [**рдкреЗрдВрдЯреЗрд╕реНрдЯрд┐рдВрдЧ LDAP**](../../network-services-pentesting/pentesting-ldap.md) рдкреГрд╖реНрдареЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВред
* **Kerbrute рдЧрдгрдирд╛**: рдЬрдм рдПрдХ **рдЕрдорд╛рдиреНрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо рдЕрдиреБрд░реЛрдз** рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рд╕рд░реНрд╡рд░ **Kerberos рддреНрд░реБрдЯрд┐** рдХреЛрдб _KRB5KDC\_ERR\_C\_PRINCIPAL\_UNKNOWN_ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдХрд░реЗрдЧрд╛, рдЬрд┐рд╕рд╕реЗ рд╣рдореЗрдВ рдкрддрд╛ рдЪрд▓реЗрдЧрд╛ рдХрд┐ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо рдЕрдорд╛рдиреНрдп рдерд╛ред **рдорд╛рдиреНрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо** рдПрдХ AS-REP рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдореЗрдВ TGT рдЙрддреНрдкрдиреНрди рдХрд░реЗрдВрдЧреЗ рдпрд╛ рддреНрд░реБрдЯрд┐ _KRB5KDC\_ERR\_PREAUTH\_REQUIRED_ рдХреЛ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рджреЗрдВрдЧреЗ, рдЬрд┐рд╕рд╕реЗ рдкреНрд░рдпреЛрдХреНрддрд╛ рдХреЛ рдкреВрд░реНрд╡-рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред
```bash
./kerbrute_linux_amd64 userenum -d lab.ropnop.com --dc 10.10.10.10 usernames.txt #From https://github.com/ropnop/kerbrute/releases

nmap -p 88 --script=krb5-enum-users --script-args="krb5-enum-users.realm='DOMAIN'" <IP>
Nmap -p 88 --script=krb5-enum-users --script-args krb5-enum-users.realm='<domain>',userdb=/root/Desktop/usernames.txt <IP>

msf> use auxiliary/gather/kerberos_enumusers

crackmapexec smb dominio.es  -u '' -p '' --users | awk '{print $4}' | uniq
```
* **OWA (Outlook Web Access) рд╕рд░реНрд╡рд░**

рдпрджрд┐ рдЖрдк рдиреЗрдЯрд╡рд░реНрдХ рдореЗрдВ рдЗрдирдореЗрдВ рд╕реЗ рдХрд┐рд╕реА рднреА рд╕рд░реНрд╡рд░ рдХреЛ рдЦреЛрдЬрддреЗ рд╣реИрдВ, рддреЛ рдЖрдк рдЗрд╕рдХреЗ рдЦрд┐рд▓рд╛рдл **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЧрдгрдирд╛** рднреА рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЖрдк [**MailSniper**](https://github.com/dafthack/MailSniper) рдЯреВрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
ipmo C:\Tools\MailSniper\MailSniper.ps1
# Get info about the domain
Invoke-DomainHarvestOWA -ExchHostname [ip]
# Enumerate valid users from a list of potential usernames
Invoke-UsernameHarvestOWA -ExchHostname [ip] -Domain [domain] -UserList .\possible-usernames.txt -OutFile valid.txt
# Password spraying
Invoke-PasswordSprayOWA -ExchHostname [ip] -UserList .\valid.txt -Password Summer2021
# Get addresses list from the compromised mail
Get-GlobalAddressList -ExchHostname [ip] -UserName [domain]\[username] -Password Summer2021 -OutFile gal.txt
```
{% hint style="warning" %}
рдЖрдк [**рдЗрд╕ github рд░реЗрдкреЛ**](https://github.com/danielmiessler/SecLists/tree/master/Usernames/Names) рдФрд░ рдЗрд╕ рдПрдХ ([**statistically-likely-usernames**](https://github.com/insidetrust/statistically-likely-usernames)) рдореЗрдВ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреА рд╕реВрдЪреА рдвреВрдВрдв рд╕рдХрддреЗ рд╣реИрдВред

рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЖрдкрдХреЛ **рдХрдВрдкрдиреА рдореЗрдВ рдХрд╛рдо рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рд▓реЛрдЧреЛрдВ рдХреЗ рдирд╛рдо** рдХреА рдЬрд╛рдирдХрд╛рд░реА рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдП, рдЬреЛ рдЖрдкрдиреЗ рдкрд╣рд▓реЗ рдХреЗ рд░рд┐рдХреЙрди рд╕реНрдЯреЗрдк рдореЗрдВ рдХрд┐рдпрд╛ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред рдирд╛рдо рдФрд░ рдЙрдкрдирд╛рдо рдХреЗ рд╕рд╛рде рдЖрдк [**namemash.py**](https://gist.github.com/superkojiman/11076951) рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╕рдВрднрд╛рд╡рд┐рдд рдорд╛рдиреНрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВред
{% endhint %}

### рдПрдХ рдпрд╛ рдХрдИ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдореЛрдВ рдХреЛ рдЬрд╛рдирдирд╛

рдареАрдХ рд╣реИ, рддреЛ рдЖрдкрдХреЛ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдПрдХ рдорд╛рдиреНрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо рд╣реЛрддрд╛ рд╣реИ рд▓реЗрдХрд┐рди рдХреЛрдИ рдкрд╛рд╕рд╡рд░реНрдб рдирд╣реАрдВ рд╣реИ... рддреЛ рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдВ:

* [**ASREPRoast**](asreproast.md): рдпрджрд┐ рдХрд┐рд╕реА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдкрд╛рд╕ рд╡рд┐рд╢реЗрд╖рддрд╛ _DONT\_REQ\_PREAUTH_ рдирд╣реАрдВ рд╣реИ, рддреЛ рдЖрдк рдЙрд╕ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд▓рд┐рдП рдПрдХ AS\_REP рд╕рдВрджреЗрд╢ рдХрд╛ рдЕрдиреБрд░реЛрдз рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдкрд╛рд╕рд╡рд░реНрдб рдХреЗ рдПрдХ рдЙрддреНрдкрд╛рджрди рджреНрд╡рд╛рд░рд╛ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд┐рдП рдЧрдП рдХреБрдЫ рдбреЗрдЯрд╛ рдХреЛ рд╕рдореЗрдЯреЗрдЧрд╛ред
* [**рдкрд╛рд╕рд╡рд░реНрдб рд╕реНрдкреНрд░реЗ**](password-spraying.md): рдкрд╛рдП рдЧрдП рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рд╕рд╛рде рд╕рдмрд╕реЗ **рд╕рд╛рдорд╛рдиреНрдп рдкрд╛рд╕рд╡рд░реНрдб** рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВ, рд╢рд╛рдпрдж рдХреЛрдИ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдПрдХ рдЦрд░рд╛рдм рдкрд╛рд╕рд╡рд░реНрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣рд╛ рд╣реЛ (рдкрд╛рд╕рд╡рд░реНрдб рдиреАрддрд┐ рдХреЛ рдзреНрдпрд╛рди рдореЗрдВ рд░рдЦреЗрдВ!)ред
* рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдЖрдк рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рдореЗрд▓ рд╕рд░реНрд╡рд░ рдореЗрдВ рдкрд╣реБрдВрдЪ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП **OWA рд╕рд░реНрд╡рд░реЛрдВ рдХреЛ рд╕реНрдкреНрд░реЗ** рднреА рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

{% content-ref url="password-spraying.md" %}
[password-spraying.md](password-spraying.md)
{% endcontent-ref %}

### LLMNR/NBT-NS Poisoning

рдЖрдк **рдиреЗрдЯрд╡рд░реНрдХ** рдХреЗ рдХреБрдЫ рдкреНрд░реЛрдЯреЛрдХреЙрд▓реЛрдВ рдХреЛ **рдкреЙрдЗрдЬрди рдХрд░рдХреЗ** рдХреБрдЫ рдЪреБрдиреМрддреА **рд╣реИрд╢** рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

{% content-ref url="../../generic-methodologies-and-resources/pentesting-network/spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md" %}
[spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md](../../generic-methodologies-and-resources/pentesting-network/spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md)
{% endcontent-ref %}

### NTML Relay

рдпрджрд┐ рдЖрдкрдиреЗ рд╕рдХреНрд░рд┐рдп рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХреЛ рдЬрд╛рдВрдЪрдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд┐рдпрд╛ рд╣реИ, рддреЛ рдЖрдкрдХреЗ рдкрд╛рд╕ **рдЕрдзрд┐рдХ рдИрдореЗрд▓ рдФрд░ рдиреЗрдЯрд╡рд░реНрдХ рдХреА рдмреЗрд╣рддрд░ рд╕рдордЭ** рд╣реЛрдЧреАред рдЖрдк AD env рдореЗрдВ рдкрд╣реБрдВрдЪ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП NTML [**рд░рд┐рд▓реЗ рд╣рдорд▓реЗ**](../../generic-methodologies-and-resources/pentesting-network/spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md#relay-attack) рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

### NTLM Creds рдЪреБрд░рд╛рдПрдВ

рдпрджрд┐ рдЖрдк **рдЕрдиреНрдп PC рдпрд╛ рд╕рд╛рдЭрд╛** рдореЗрдВ **null рдпрд╛ guest рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛** рдХреЗ рд╕рд╛рде рдкрд╣реБрдВрдЪ рд╕рдХрддреЗ рд╣реИрдВ, рддреЛ рдЖрдк **рдлрд╝рд╛рдЗрд▓реЗрдВ рд░рдЦ рд╕рдХрддреЗ рд╣реИрдВ** (рдЬреИрд╕реЗ SCF рдлрд╝рд╛рдЗрд▓), рдЬреЛ рдпрджрд┐ рдХрд┐рд╕реА рддрд░рд╣ рд╕реЗ рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛рдПрдЧреА, рддреЛ рд╡рд╣ рдЖрдкрдХреЗ рдЦрд┐рд▓рд╛рдл NTML рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЛ рдЯреНрд░рд┐рдЧрд░ рдХрд░реЗрдЧреА, рддрд╛рдХрд┐ рдЖрдк рдЗрд╕реЗ рдХреНрд░реИрдХ рдХрд░ рд╕рдХреЗрдВ:

{% content-ref url="../ntlm/places-to-steal-ntlm-creds.md" %}
[places-to-steal-ntlm-creds.md](../ntlm/places-to-steal-ntlm-creds.md)
{% endcontent-ref %}

## рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЗ рд╕рд╛рде рд╕рдХреНрд░рд┐рдп рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХрд╛ рдЬрд╛рдВрдЪрдирд╛

рдЗрд╕ рдЪрд░рдг рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ **рдорд╛рдиреНрдп рдбреЛрдореЗрди рдЦрд╛рддреЗ рдХреЗ рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдпрд╛ рд╕рддреНрд░** рдХреЛ рд╕рдВрдХреНрд╖реЗрдк рдореЗрдВ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдХреБрдЫ рдорд╛рдиреНрдп рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдпрд╛ рдбреЛрдореЗрди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд░реВрдк рдореЗрдВ рд╢реИрд▓ рдорд┐рд▓ рдЧрдпрд╛ рд╣реИ, **рддреЛ рдЖрдкрдХреЛ рдпрд╛рдж рд░рдЦрдирд╛ рдЪрд╛рд╣рд┐рдП рдХрд┐ рдкрд╣рд▓реЗ рджрд┐рдП рдЧрдП рд╡рд┐рдХрд▓реНрдк рдЕрдиреНрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рд╕рдВрдХреНрд░рдорд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╡рд┐рдХрд▓реНрдк рд╣реИрдВ**ред

рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЗ рдкрд╣рд▓реЗ рдЖрдкрдХреЛ рдЬрд╛рдирдирд╛ рдЪрд╛рд╣рд┐рдП рдХрд┐ **Kerberos рдбрдмрд▓ рд╣реЙрдк рд╕рдорд╕реНрдпрд╛ рдХреНрдпрд╛ рд╣реИред**

{% content-ref url="kerberos-double-hop-problem.md" %}
[kerberos-double-hop-problem.md](kerberos-double-hop-problem.md)
{% endcontent-ref %}

### рдЬрд╛рдВрдЪрдирд╛

рдПрдХ рдЦрд╛рддреЗ рдХреЛ рд╕рдВрдХреНрд░рдорд┐рдд рдХрд░рдирд╛ **рдбреЛрдореЗрди рдХреЛ рдкреВрд░реА рддрд░рд╣ рд╕рдВрдХреНрд░рдорд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдмрдбрд╝рд╛ рдХрджрдо рд╣реИ**, рдХреНрдпреЛрдВрдХрд┐ рдЖрдк **рд╕рдХреНрд░рд┐рдп рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдЬрд╛рдВрдЪрдирд╛ рд╢реБрд░реВ рдХрд░ рд╕рдХреЗрдВрдЧреЗ**:

[**ASREPRoast**](asreproast.md) рдХреЗ рд╕рдВрдмрдВрдз рдореЗрдВ рдЕрдм рдЖрдк рд╣рд░ рд╕рдВрднрд╛рд╡рд┐рдд рд╡рд┐рдХрд▓реНрдкрд╢реАрд▓ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ, рдФрд░ [**рдкрд╛рд╕рд╡рд░реНрдб рд╕реНрдкреНрд░реЗ**](password-spraying.md) рдХреЗ рд╕рдВрдмрдВрдз рдореЗрдВ рдЖрдк **
### рдХреЗрд░рдмреЗрд░реЛрд╕реНрдЯ

рдХреЗрд░рдмреЗрд░реЛрд╕реНрдЯ рдХрд╛ рдЙрджреНрджреЗрд╢реНрдп рд╣реИ **рдбреЛрдореЗрди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЦрд╛рддреЛрдВ рдХреЗ рдирд╛рдо рдкрд░ рдЪрд▓рдиреЗ рд╡рд╛рд▓реА рд╕реЗрд╡рд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдЯреАрдЬреАрдПрд╕ рдЯрд┐рдХрдЯ рд╣рд╛рд░реНрд╡реЗрд╕реНрдЯ рдХрд░рдирд╛**ред рдЗрди рдЯреАрдЬреАрдПрд╕ рдЯрд┐рдХрдЯ рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ рд╣реИрдВ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкрд╛рд╕рд╡рд░реНрдб рд╕реЗ рдирд┐рд░реНрдорд┐рдд рдХреБрдВрдЬреА рд╕реЗ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ**ред рдЗрд╕рдХреЗ рдкрд░рд┐рдгрд╛рдорд╕реНрд╡рд░реВрдк, рдЙрдирдХреЗ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреЛ **рдСрдлрд▓рд╛рдЗрди рдореЗрдВ рдХреНрд░реИрдХ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ**ред\
рдЗрд╕рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП:

{% content-ref url="kerberoast.md" %}
[kerberoast.md](kerberoast.md)
{% endcontent-ref %}

### рд░рд┐рдореЛрдЯ рдХрдиреЗрдХреНрд╢рди (RDP, SSH, FTP, Win-RM, рдЖрджрд┐)

рдЬрдм рдЖрдкрдХреЗ рдкрд╛рд╕ рдХреБрдЫ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рд╣реЛ рдЬрд╛рдПрдВ, рддреЛ рдЖрдк рдпрд╣ рдЬрд╛рдВрдЪ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдХреНрдпрд╛ рдЖрдкрдХреЗ рдкрд╛рд╕ рдХрд┐рд╕реА **рдорд╢реАрди** рддрдХ рдкрд╣реБрдВрдЪ рд╣реИред рдЗрд╕рдХреЗ рд▓рд┐рдП, рдЖрдк **CrackMapExec** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рд╡рд┐рднрд┐рдиреНрди рдкреНрд░реЛрдЯреЛрдХреЙрд▓реЛрдВ рдХреЗ рд╕рд╛рде рдХрдИ рд╕рд░реНрд╡рд░реЛрдВ рдкрд░ рдХрдиреЗрдХреНрдЯ рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЕрдкрдиреЗ рдкреЛрд░реНрдЯ рд╕реНрдХреИрди рдХреЗ рдЕрдиреБрд╕рд╛рд░ред

### рд╕реНрдерд╛рдиреАрдп рдкреНрд░рд┐рд╡рд┐рд▓реЗрдЬ рдЙрдиреНрдирдпрди

рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдХрдВрдкреНрд░реЛрдорд╛рдЗрдЬрд╝ рдХрд┐рдП рдЧрдП рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдпрд╛ рдПрдХ рд╕рд╛рдзрд╛рд░рдг рдбреЛрдореЗрди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд░реВрдк рдореЗрдВ рдПрдХ рд╕рддреНрд░ рд╣реИ рдФрд░ рдЖрдкрдХреЗ рдкрд╛рд╕ рдЗрд╕ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд╕рд╛рде рдХрд┐рд╕реА рднреА рдорд╢реАрди рддрдХ рдкрд╣реБрдВрдЪ рд╣реИ, рддреЛ рдЖрдкрдХреЛ **рд╕реНрдерд╛рдиреАрдп рд░реВрдк рд╕реЗ рдкреНрд░рд┐рд╡рд┐рд▓реЗрдЬ рдЙрдиреНрдирдпрди рдХрд░рдиреЗ рдФрд░ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреА рд▓реВрдЯ рдХрд░рдиреЗ** рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред рдЗрд╕рд▓рд┐рдП рдХреЗрд╡рд▓ рд╕реНрдерд╛рдиреАрдп рдкреНрд░рд╢рд╛рд╕рдХ рдЕрдзрд┐рдХрд╛рд░реЛрдВ рдХреЗ рд╕рд╛рде рдЖрдкрдХреЛ рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реЛрдЧрд╛ рдХрд┐ рдЖрдк рдореЗрдореЛрд░реА (LSASS) рдФрд░ рд╕реНрдерд╛рдиреАрдп рд░реВрдк рд╕реЗ (SAM) рдЕрдиреНрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рд╣реИрд╢ рдбрдВрдк рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

рдЗрд╕ рдкреБрд╕реНрддрдХ рдореЗрдВ [**Windows рдореЗрдВ рд╕реНрдерд╛рдиреАрдп рдкреНрд░рд┐рд╡рд┐рд▓реЗрдЬ рдЙрдиреНрдирдпрди**](../windows-local-privilege-escalation/) рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдПрдХ рдкреВрд░реНрдг рдкреГрд╖реНрда рд╣реИ рдФрд░ рдПрдХ [**рдЪреЗрдХрд▓рд┐рд╕реНрдЯ**](../checklist-windows-privilege-escalation.md) рднреА рд╣реИред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, [**WinPEAS**](https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рди рднреВрд▓реЗрдВред

### рдореМрдЬреВрджрд╛ рд╕рддреНрд░ рдЯрд┐рдХрдЯ

рдпрд╣ рдмрд╣реБрдд **рдЕрд╕рдВрднрд╛рд╡рд┐рдд рд╣реИ** рдХрд┐ рдЖрдкрдХреЛ рдореМрдЬреВрджрд╛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдореЗрдВ рдХреЛрдИ **рдЯрд┐рдХрдЯ** рдорд┐рд▓реЗрдЧрд╛ рдЬреЛ рдЖрдкрдХреЛ рдЕрдкреНрд░рддреНрдпрд╛рд╢рд┐рдд рд╕рдВрд╕рд╛рдзрдиреЛрдВ рддрдХ рдкрд╣реБрдВрдЪ рджреЗрдЧрд╛, рд▓реЗрдХрд┐рди рдЖрдк рдЬрд╛рдВрдЪ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
## List all tickets (if not admin, only current user tickets)
.\Rubeus.exe triage
## Dump the interesting one by luid
.\Rubeus.exe dump /service:krbtgt /luid:<luid> /nowrap
[IO.File]::WriteAllBytes("ticket.kirbi", [Convert]::FromBase64String("<BASE64_TICKET>"))
```
### NTML рд░рд┐рд▓реЗ

рдпрджрд┐ рдЖрдкрдиреЗ рд╕рдХреНрд░рд┐рдп рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХреА рдЬрд╛рдВрдЪ рдХрд░рдиреЗ рдореЗрдВ рд╕рдлрд▓рддрд╛ рдкреНрд░рд╛рдкреНрдд рдХреА рд╣реИ, рддреЛ рдЖрдкрдХреЗ рдкрд╛рд╕ **рдЕрдзрд┐рдХ рдИрдореЗрд▓ рдФрд░ рдиреЗрдЯрд╡рд░реНрдХ рдХреА рдмреЗрд╣рддрд░ рд╕рдордЭ** рд╣реЛрдЧреАред рдЖрдк NTML [**рд░рд┐рд▓реЗ рд╣рдорд▓реЛрдВ**](../../generic-methodologies-and-resources/pentesting-network/spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md#relay-attack) рдХреЛ рдмрд▓рд╡рд╛рдиреНрддрд░рд┐рдд рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

### рдХрдВрдкреНрдпреВрдЯрд░ рд╢реЗрдпрд░ рдореЗрдВ Creds рдЦреЛрдЬреЗрдВ

рдЕрдм рдЬрдм рдЖрдкрдХреЗ рдкрд╛рд╕ рдХреБрдЫ рдореВрд▓рднреВрдд рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рд╣реИрдВ, рддреЛ рдЖрдкрдХреЛ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рд┐рдП рдХрд┐ рдХреНрдпрд╛ рдЖрдк **AD рдХреЗ рдЕрдВрджрд░ рд╕рд╛рдЭрд╛ рдХреА рдЬрд╛ рд░рд╣реА рдХрд┐рд╕реА рджрд┐рд▓рдЪрд╕реНрдк рдлрд╝рд╛рдЗрд▓ рдХреЛ рдЦреЛрдЬ рд╕рдХрддреЗ рд╣реИрдВ**ред рдЖрдк рдЗрд╕реЗ рдореИрдиреНрдпреБрдЕрд▓ рд░реВрдк рд╕реЗ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдпрд╣ рдПрдХ рдмрд╣реБрдд рд╣реА рдЙрдмрд╛рдК рдФрд░ рджреЛрд╣рд░рд╛рд╡рд╛рд░ рдХрд╛рд░реНрдп рд╣реИ (рдФрд░ рдЕрдЧрд░ рдЖрдк рд╕реИрдВрдбреНрд░реЗрдбреЛрдВ рдХреЛ рдЪреЗрдХ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕реИрдВрдбреНрд░реЗрдбреЛрдВ рдХреЛ рдвреВрдВрдврддреЗ рд╣реИрдВ рддреЛ рдФрд░ рднреА рдЬреНрдпрд╛рджрд╛)ред

[**рдЗрд╕ рд▓рд┐рдВрдХ рдкрд░ рдЬрд╛рдХрд░ рдЖрдк рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЙрдкрдХрд░рдгреЛрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдиреЗ рдХреЗ рд▓рд┐рдПред**](../../network-services-pentesting/pentesting-smb.md#domain-shared-folders-search)

### NTLM Creds рдЪреБрд░рд╛рдПрдВ

рдпрджрд┐ рдЖрдк **рдЕрдиреНрдп PC рдпрд╛ рд╢реЗрдпрд░ рддрдХ рдкрд╣реБрдВрдЪ рд╕рдХрддреЗ рд╣реИрдВ**, рддреЛ рдЖрдк **рдлрд╝рд╛рдЗрд▓реЗрдВ рд░рдЦ рд╕рдХрддреЗ рд╣реИрдВ** (рдЬреИрд╕реЗ SCF рдлрд╝рд╛рдЗрд▓), рдЬреЛ рдпрджрд┐ рдХрд┐рд╕реА рддрд░рд╣ рд╕реЗ рдПрдХреНрд╕реЗрд╕ рд╣реЛрддреА рд╣реИ, рддреЛ рд╡рд╣ рдЖрдкрдХреЗ рдЦрд┐рд▓рд╛рдл **NTML рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЛ рдЯреНрд░рд┐рдЧрд░ рдХрд░реЗрдЧреА**, рддрд╛рдХрд┐ рдЖрдк рдЗрд╕реЗ **рдЪреБрд░рд╛ рд╕рдХреЗрдВ** рдФрд░ рдЗрд╕реЗ рдХреНрд░реИрдХ рдХрд░ рд╕рдХреЗрдВ:

{% content-ref url="../ntlm/places-to-steal-ntlm-creds.md" %}
[places-to-steal-ntlm-creds.md](../ntlm/places-to-steal-ntlm-creds.md)
{% endcontent-ref %}

### CVE-2021-1675/CVE-2021-34527 PrintNightmare

рдпрд╣ рд╕реБрд░рдХреНрд╖рд╛ рджреБрд░реНрдмрд▓рддрд╛ рдХрд┐рд╕реА рднреА рдкреНрд░рдорд╛рдгрд┐рдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдбреЛрдореЗрди рдирд┐рдпрдВрддреНрд░рдХ рдХреЛ рдХрдВрдкреНрд░рдорд╛рдЗрдЬрд╝ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рдереАред

{% content-ref url="printnightmare.md" %}
[printnightmare.md](printnightmare.md)
{% endcontent-ref %}

## рдЙрдЪреНрдЪрд╛рдзрд┐рдХрд╛рд░ рд╕рдХреНрд░рд┐рдп рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдкрд░рд┐рдпреЛрдЬрдирд╛ рдореЗрдВ рдЙрдЪреНрдЪрд╛рдзрд┐рдХрд╛рд░ рд╕рдХреНрд░рд┐рдп рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдкрд░рд┐рдпреЛрдЬрдирд╛ рдореЗрдВ

**рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рддрдХрдиреАрдХреЛрдВ рдХреЗ рд▓рд┐рдП рдПрдХ рд╕рд╛рдзрд╛рд░рдг рдбреЛрдореЗрди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкрд░реНрдпрд╛рдкреНрдд рдирд╣реАрдВ рд╣реИ, рдЖрдкрдХреЛ рдХреБрдЫ рд╡рд┐рд╢реЗрд╖ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ / рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдЪрд╛рд╣рд┐рдП рд╣реЛрдВрдЧреЗ рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдЗрди рд╣рдорд▓реЛрдВ рдХреЛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред**

### рд╣реИрд╢ рдирд┐рд╖реНрдХрд░реНрд╖рдг

рдЖрд╢рд╛ рд╣реИ рдХрд┐ рдЖрдкрдиреЗ [AsRepRoast](asreproast.md), [Password Spraying](password-spraying.md), [Kerberoast](kerberoast.md), [Responder](../../generic-methodologies-and-resources/pentesting-network/spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md) рдЬреИрд╕реЗ рдЙрдкрдХрд░рдгреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХреБрдЫ рд╕реНрдерд╛рдиреАрдп рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рдЦрд╛рддрд╛ рдХрдВрдкреНрд░рдорд╛рдЗрдЬрд╝ рдХрд░ рд▓рд┐рдпрд╛ рд╣реИ, [EvilSSDP](../../generic-methodologies-and-resources/pentesting-network/spoofing-ssdp-and-upnp-devices.md), [рдЗрд╕реНрдХреЗрд▓реЗрдЯрд┐рдВрдЧ рдкреНрд░рд┐рд╡рд┐рд▓реЗрдЬреЗрдЬрд╝ рд▓реЛрдХрд▓реА](../windows-local-privilege-escalation/) рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдПред\
рдлрд┐рд░, рдЕрдм рдЖрдкрдХреЛ рд╕рднреА рд╣реИрд╢ рдХреЛ рдореЗрдореЛрд░реА рдФрд░ рд╕реНрдерд╛рдиреАрдпрддрд╛ рдореЗрдВ рдбрдВрдк рдХрд░рдиреЗ рдХрд╛ рд╕рдордп рд╣реИред\
[**рдЗрд╕ рдкреГрд╖реНрда рдХреЛ рдкрдврд╝реЗрдВ рдЬрд╣рд╛рдВ рдЖрдкрдХреЛ рд╣реИрд╢ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд╡рд┐рднрд┐рдиреНрди рддрд░реАрдХреЛрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА рдорд┐рд▓реЗрдЧреАред**](broken-reference)

### рд╣реИрд╢ рдкрд╛рд░ рдХрд░реЗрдВ

**рдЬрдм рдЖрдкрдХреЗ рдкрд╛рд╕ рдХрд┐рд╕реА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХрд╛ рд╣реИрд╢ рд╣реЛрддрд╛ рд╣реИ**, рддреЛ рдЖрдк рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдЙрд╕рдХреА рдЕрдиреБрдХрд░рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред\
рдЖрдкрдХреЛ рдХреБрдЫ **рдЙрдкрдХрд░рдг** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ рдЬреЛ рдЗрд╕ **рд╣реИрд╢** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ **NTLM рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХрд╛ рдХрд╛рд░реНрдп** рдХрд░реЗрдЧрд╛, **рдпрд╛** рдЖрдк рдПрдХ рдирдпрд╛ **рд╕рддреНрд░рд▓реЙрдЧрди** рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЙрд╕ **рд╣реИрд╢** рдХреЛ **LSASS** рдХреЗ рдЕрдВрджрд░ **рдЗрдВрдЬреЗрдХреНрдЯ** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рддрд╛рдХрд┐ рдЬрдм рдХреЛрдИ **NTLM рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХрд╛рд░реНрдп** рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдЙрд╕ **рд╣реИрд╢** рдХрд╛ рдЙрдкрдпреЛрдЧ рд╣реЛрдЧрд╛ред рдЖрдЦрд┐рд░реА рд╡рд┐рдХрд▓реНрдк рд╣реИ рд╡рд╣ рдХрд╛рд░реНрдп рдЬреЛ mimikatz рдХрд░рддрд╛ рд╣реИред\
[**рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рдЗрд╕ рдкреГрд╖реНрда рдХреЛ рдкрдврд╝реЗрдВред**](../ntlm/#pass-the-hash)

### рд╣реИрд╢ рдкрд╛рд░ рдХрд░реЗрдВ / рдХреБрдВрдЬреА рдкрд╛рд░ рдХрд░реЗрдВ

рдпрд╣ рд╣рдорд▓рд╛ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ NTLM рд╣реИрд╢ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ Kerberos рдЯрд┐рдХрдЯреЗрдВ рдЕрдиреБрд░реЛрдзрд┐рдд рдХрд░рдиреЗ** рдХрд╛ рдЙрджреНрджреЗрд╢реНрдп рд░рдЦрддрд╛ рд╣реИ, рд╕рд╛рдорд╛рдиреНрдп Pass The Hash over NTLM рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдХреЗ рд╡рд┐рдХрд▓реНрдк рдХреЗ рд░реВрдк рдореЗрдВред рдЗрд╕рд▓рд┐рдП, рдпрд╣ рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ **рдЙрдкрдпреЛрдЧреА рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рдЬрд╣рд╛рдВ NTLM рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдЕрдХреНрд╖рдо рд╣реИ** рдФрд░ рдХреЗрд╡рд▓ **Kerberos рдХреЛ рд╣реА рдЕрдиреБрдорддрд┐ рд╣реИ** рдЬреИрд╕реЗ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдкреНрд░реЛрдЯреЛрдХреЙрд▓ред

{% content-ref url="over-pass-the-hash-pass-the-key.md" %}
[over-pass-the-hash-pass-the-key.md](over-pass-the-hash-pass-the-key.md)
{% endcontent-ref %}

### рдЯрд┐рдХрдЯ рдкрд╛рд░ рдХрд░реЗрдВ

рдпрд╣ рд╣рдорд▓рд╛ Pass the Key рдХреЗ рд╕рдорд╛рди рд╣реИ, рд▓реЗрдХрд┐рди рдпрд╣рд╛рдВ рд╣реИрд╢ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЯрд┐рдХрдЯ рдХрд╛ рдЪреЛрд░реА рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдЗрд╕рдХреЗ рдорд╛рд▓рд┐рдХ рдХреЗ рд░реВрдк рдореЗрдВ рдкреНрд░рдорд╛рдгрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

{% content-ref url="pass-the-ticket.md" %}
[pass-the-ticket.md](pass-the-ticket.md)
{% endcontent-ref %}

### рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдкреБрдирдГрдЙрдкрдпреЛрдЧ

рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдХрд┐рд╕реА рд╕реНрдерд╛рдиреАрдп рдкреНрд░рд╢рд╛рд╕рдХ рдХрд╛ **рд╣реИрд╢** рдпрд╛ **рдкрд╛рд╕рд╡рд░реНрдб** рд╣реИ, рддреЛ рдЖрдкрдХреЛ рдЙрд╕рдХреЗ рд╕рд╛рде рдЕрдиреНрдп **PCs** рдореЗрдВ рд╕реНрдерд╛рдиреАрдп рд░реВрдк рд╕реЗ **рд▓реЙрдЧрд┐рди рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢** рдХрд░рдиреА рдЪрд╛рд╣рд┐рдПред
```bash
# Local Auth Spray (once you found some local admin pass or hash)
## --local-auth flag indicate to only try 1 time per machine
crackmapexec smb --local-auth 10.10.10.10/23 -u administrator -H 10298e182387f9cab376ecd08491764a0 | grep +
```
{% hint style="warning" %}
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдпрд╣ рдХрд╛рдлреА **рд╢реЛрд░рдЧреБрд▓** рд╣реИ рдФрд░ **LAPS** рдЗрд╕реЗ **рдХрдо рдХрд░ рд╕рдХрддрд╛ рд╣реИ**ред
{% endhint %}

### MSSQL рджреБрд░реБрдкрдпреЛрдЧ рдФрд░ рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рд▓рд┐рдВрдХ

рдпрджрд┐ рдХрд┐рд╕реА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ **MSSQL рдЗрдВрд╕реНрдЯреЗрдВрд╕реЗрд╕ рддрдХ рдкрд╣реБрдВрдЪ рдХреА рдЕрдиреБрдорддрд┐** рд╣реЛрддреА рд╣реИ, рддреЛ рд╡рд╣ рдЗрд╕реЗ **рдХрдорд╛рдВрдб рдирд┐рд╖реНрдкрд╛рджрд┐рдд** рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддрд╛ рд╣реИ (рдпрджрд┐ SA рдХреЗ рд░реВрдк рдореЗрдВ рдЪрд▓ рд░рд╣рд╛ рд╣реИ), NetNTLM **рд╣реИрд╢ рдЪреБрд░рд╛ рд╕рдХрддрд╛ рд╣реИ** рдпрд╛ рдпрд╣рд╛рдВ рддрдХ рдХрд┐ рдПрдХ **рд░рд┐рд▓реЗ рд╣рдорд▓рд╛** рднреА рдХрд░ рд╕рдХрддрд╛ рд╣реИред\
рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдпрджрд┐ рдПрдХ MSSQL рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдПрдХ рдЕрд▓рдЧ MSSQL рдЗрдВрд╕реНрдЯреЗрдВрд╕ рджреНрд╡рд╛рд░рд╛ рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп (рдбреЗрдЯрд╛рдмреЗрд╕ рд▓рд┐рдВрдХ) рдорд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИред рдпрджрд┐ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рдбреЗрдЯрд╛рдмреЗрд╕ рдкрд░ рдЕрдзрд┐рдХрд╛рд░ рд╣реЛрддреЗ рд╣реИрдВ, рддреЛ рд╡рд╣ рджреВрд╕рд░реЗ рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдореЗрдВ рднреА рдХреНрд╡реЗрд░реА рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рд╕рдВрдмрдВрдз рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддрд╛ рд╣реИред рдЗрди рд╡рд┐рд╢реНрд╡рд╕рдиреАрдпрддрд╛рдУрдВ рдХреЛ рдЪреЗрди рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдХрд┐рд╕реА рдмрд┐рдВрджреБ рдкрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдРрд╕рд╛ рдбреЗрдЯрд╛рдмреЗрд╕ рдорд┐рд▓ рд╕рдХрддрд╛ рд╣реИ рдЬрд╣рд╛рдВ рдЙрд╕реЗ рдХрдорд╛рдВрдб рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИред\
**рдбреЗрдЯрд╛рдмреЗрд╕реЛрдВ рдХреЗ рдмреАрдЪ рдХреЗ рд▓рд┐рдВрдХ рд╡рди рд╡рди рд╡рди рд╡рд┐рд╢реНрд╡рд╕рдиреАрдпрддрд╛рдУрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВред**

{% content-ref url="abusing-ad-mssql.md" %}
[abusing-ad-mssql.md](abusing-ad-mssql.md)
{% endcontent-ref %}

### рдЕрд╕реАрдорд┐рдд рдбрд┐рд▓реАрдЧреЗрд╢рди

рдпрджрд┐ рдЖрдкрдХреЛ рдХрд┐рд╕реА рдХрдВрдкреНрдпреВрдЯрд░ рдСрдмреНрдЬреЗрдХреНрдЯ рдореЗрдВ [ADS\_UF\_TRUSTED\_FOR\_DELEGATION](https://msdn.microsoft.com/en-us/library/aa772300\(v=vs.85\).aspx) рд╡рд┐рд╢реЗрд╖рддрд╛ рдорд┐рд▓рддреА рд╣реИ рдФрд░ рдЖрдкрдХреЗ рдкрд╛рд╕ рдХрдВрдкреНрдпреВрдЯрд░ рдореЗрдВ рдбреЛрдореЗрди рдЕрдзрд┐рдХрд╛рд░ рд╣реИрдВ, рддреЛ рдЖрдк рдХрдВрдкреНрдпреВрдЯрд░ рдкрд░ рд▓реЙрдЧрд┐рди рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рд╣рд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ TGT рдХреЛ рдореЗрдореЛрд░реА рд╕реЗ рдбрдВрдк рдХрд░ рд╕рдХреЗрдВрдЧреЗред\
рдЗрд╕рд▓рд┐рдП, рдпрджрд┐ **рдбреЛрдореЗрди рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рдХрдВрдкреНрдпреВрдЯрд░ рдкрд░ рд▓реЙрдЧрд┐рди рдХрд░рддрд╛ рд╣реИ**, рддреЛ рдЖрдк рдЙрд╕рдХреЗ TGT рдХреЛ рдбрдВрдк рдХрд░ рд╕рдХреЗрдВрдЧреЗ рдФрд░ [рдкрд╛рд╕ рдж рдЯрд┐рдХрдЯ](pass-the-ticket.md) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЙрд╕рдХреА рдЕрдиреБрдХрд░рдг рдХрд░ рд╕рдХреЗрдВрдЧреЗред\
рд╕реАрдорд┐рдд рдбрд┐рд▓реАрдЧреЗрд╢рди рдХреЗ рдХрд╛рд░рдг рдЖрдк рдПрдХ рдкреНрд░рд┐рдВрдЯ рд╕рд░реНрд╡рд░ рдХреЛ рднреА **рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рд╕рдВрдХреНрд░рдорд┐рдд** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ (рдЖрд╢рд╛ рд╣реИ рдХрд┐ рдпрд╣ рдПрдХ DC рд╣реЛрдЧрд╛)ред

{% content-ref url="unconstrained-delegation.md" %}
[unconstrained-delegation.md](unconstrained-delegation.md)
{% endcontent-ref %}

### рд╕реАрдорд┐рдд рдбрд┐рд▓реАрдЧреЗрд╢рди

рдпрджрд┐ рдХрд┐рд╕реА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдпрд╛ рдХрдВрдкреНрдпреВрдЯрд░ рдХреЛ "рд╕реАрдорд┐рдд рдбрд┐рд▓реАрдЧреЗрд╢рди" рдХреА рдЕрдиреБрдорддрд┐ рд╣реИ, рддреЛ рд╡рд╣ рдХрдВрдкреНрдпреВрдЯрд░ рдореЗрдВ рдХреБрдЫ рд╕реЗрд╡рд╛рдУрдВ рддрдХ рдкрд╣реБрдВрдЪ рдХреЗ рд▓рд┐рдП **рдХрд┐рд╕реА рднреА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреА рдЕрдиреБрдХрд░рдг рдХрд░ рд╕рдХреЗрдЧрд╛**ред\
рдлрд┐рд░, рдпрджрд┐ рдЖрдк рдЗрд╕ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛/рдХрдВрдкреНрдпреВрдЯрд░ рдХреЗ рд╣реИрд╢ рдХреЛ **рд╕рдВрдХреНрд░рдорд┐рдд** рдХрд░ рд▓реЗрддреЗ рд╣реИрдВ, рддреЛ рдЖрдк рдХрд┐рд╕реА рднреА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ (рдпрд╣рд╛рдВ рддрдХ рдХрд┐ рдбреЛрдореЗрди рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ) рдХреА рдЕрдиреБрдХрд░рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдХреНрд╖рдо рд╣реЛрдВрдЧреЗред

{% content-ref url="constrained-delegation.md" %}
[constrained-delegation.md](constrained-delegation.md)
{% endcontent-ref %}

### рд╕рдВрд╕рд╛рдзрди-рдЖрдзрд╛рд░рд┐рдд рд╕реАрдорд┐рдд рдбрд┐рд▓реАрдЧреЗрд╢рди

рдпрджрд┐ рдЖрдкрдХреЛ рдЙрд╕ рдХрдВрдкреНрдпреВрдЯрд░ рдХреЗ AD рдСрдмреНрдЬреЗрдХреНрдЯ рдкрд░ WRITE рдЕрдиреБрдорддрд┐ рд╣реИ, рддреЛ рдЖрдк рдЙрд╕ рджреВрд░рд╕реНрде рдХрдВрдкреНрдпреВрдЯрд░ рдкрд░ **рдЙрдЪреНрдЪ рдЕрдзрд┐рдХрд╛рд░реЛрдВ рд╡рд╛рд▓реЗ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдореЗрдВ рдХреЛрдб рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд╕рд╛рде рд╕рдВрдмрдВрдзрд┐рдд рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЗ рд╕рд╛рде рдХреЛрдб рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**ред

{% content-ref url="resource-based-constrained-delegation.md" %}
[resource-based-constrained-delegation.md](resource-based-constrained-delegation.md)
{% endcontent-ref %}

### ACL рджреБрд░реБрдкрдпреЛрдЧ

рд╕рдВрдХреНрд░рдорд┐рдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдХреБрдЫ **рджреЛрдореЗрди рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рдкрд░ рджрд┐рд▓рдЪрд╕реНрдк рдЕрдзрд┐рдХрд╛рд░** рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рдЖрдкрдХреЛ рдмрд╛рдж рдореЗрдВ **рд╕рд╛рдЗрдбрд╡реЗрдЬрд┐рдХрд▓реА рд▓реЗ рдЬрд╛рдиреЗ** рдпрд╛ **рдЕрдзрд┐рдХрд╛рд░реЛрдВ рдХреЛ рдЙрдиреНрдирдд рдХрд░рдиреЗ** рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреЗ рд╣реИрдВред

{% content-ref url="acl-persistence-abuse/" %}
[acl-persistence-abuse](acl-persistence-abuse/)
{% endcontent-ref %}

### рдкреНрд░рд┐рдВрдЯрд░ рд╕реНрдкреВрд▓рд░ рд╕реЗрд╡рд╛ рджреБрд░реБрдкрдпреЛрдЧ

рдпрджрд┐ рдЖрдк рдбреЛрдореЗрди рдореЗрдВ рдХрд┐рд╕реА **рд╕реНрдкреВрд▓ рд╕реЗрд╡рд╛ рдХреЛ рд╕реБрди рд░рд╣рд╛** рд╣реИ, рддреЛ рдЖрдк рдЗрд╕реЗ **рджреБрд░реБрдкрдпреЛрдЧ** рдХрд░рдХреЗ **рдирдП рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдкреНрд░рд╛рдкреНрдд** рдХрд░рдиреЗ рдФрд░ **рдЕрдзрд┐рдХрд╛рд░реЛрдВ рдХреЛ рдЙрдиреНрдирдд рдХрд░рдиреЗ** рдХреЗ рд▓рд┐рдП рд╕рдХреНрд╖рдо рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред\
[**рдпрд╣рд╛рдВ рд╕реНрдкреВрд▓рд░ рд╕реЗрд╡рд╛рдУрдВ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХреИрд╕реЗ рдХрд░реЗрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реАред**](printers-spooler-service-abuse.md)

### рддреГрддреАрдп рдкрдХреНрд╖ рд╕рддреНрд░ рджреБрд░реБрдкрдпреЛрдЧ

рдпрджрд┐ **рдЕрдиреНрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛** **рд╕рдВрдХреНрд░рдорд┐рдд** рдорд╢реАрди рдХрд╛ **рдЙрдкрдпреЛрдЧ** рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдЖрдк рдореЗрдореЛрд░реА рд╕реЗ **рдХреНрд░реЗрдбреЗрдВ
### рдЧреЛрд▓реНрдбрди рдЯрд┐рдХрдЯ

рдПрдХ рдорд╛рдиреНрдп **TGT рдХреЗ рд░реВрдк рдореЗрдВ рдХрд┐рд╕реА рднреА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛** рдХреЛ рдмрдирд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ **krbtgt AD рдЦрд╛рддреЗ** рдХреЗ NTLM рд╣реИрд╢ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗред TGS рдХреА рддреБрд▓рдирд╛ рдореЗрдВ TGT рдХрд╛ рдЬрд╛рд▓ рдмреБрдирдиреЗ рдХрд╛ рд▓рд╛рдн рдпрд╣ рд╣реИ рдХрд┐ рдпрд╣ **рдХрд┐рд╕реА рднреА рд╕реЗрд╡рд╛** (рдпрд╛ рдорд╢реАрди) рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛрддрд╛ рд╣реИ рдФрд░ рдЙрд╕реЗ рдЖрдкрддреНрддрд┐рдЬрдирдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд░реВрдк рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддрд╛ рд╣реИред

{% content-ref url="golden-ticket.md" %}
[golden-ticket.md](golden-ticket.md)
{% endcontent-ref %}

### рдбрд╛рдпрдордВрдб рдЯрд┐рдХрдЯ

рдпреЗ рдЧреЛрд▓реНрдбрди рдЯрд┐рдХрдЯ рдХреЗ рд╕рд╛рдорд╛рди рд╣реЛрддреЗ рд╣реИрдВ, рдЬрд┐рдиреНрд╣реЗрдВ рдПрдХ рдРрд╕реЗ рддрд░реАрдХреЗ рд╕реЗ рдмрдирд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬреЛ **рд╕рд╛рдорд╛рдиреНрдп рдЧреЛрд▓реНрдбрди рдЯрд┐рдХрдЯ рдХреЗ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдХреЗ рддрдВрддреНрд░реЛрдВ рдХреЛ рдЫреЛрдбрд╝ рджреЗрддрд╛ рд╣реИред**

{% content-ref url="diamond-ticket.md" %}
[diamond-ticket.md](diamond-ticket.md)
{% endcontent-ref %}

### **рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдЦрд╛рддрд╛ рд╕реНрдерд┐рд░рддрд╛**

**рдХрд┐рд╕реА рдЦрд╛рддреЗ рдХреЗ рдкреНрд░рдорд╛рдгрдкрддреНрд░ рд╣реЛрдирд╛ рдпрд╛ рдЙрдиреНрд╣реЗрдВ рдЕрдиреБрд░реЛрдз рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛** рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдЦрд╛рддреЗ рдореЗрдВ рд╕реНрдерд┐рд░ рд░рд╣рдиреЗ рдХрд╛ рдПрдХ рдмрд╣реБрдд рдЕрдЪреНрдЫрд╛ рддрд░реАрдХрд╛ рд╣реИ (рдпрджрд┐ рдЙрд╕рдиреЗ рдкрд╛рд╕рд╡рд░реНрдб рдмрджрд▓ рджрд┐рдпрд╛ рд╣реЛ):

{% content-ref url="ad-certificates/account-persistence.md" %}
[account-persistence.md](ad-certificates/account-persistence.md)
{% endcontent-ref %}

### **рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдбреЛрдореЗрди рд╕реНрдерд┐рд░рддрд╛**

**рдкреНрд░рдорд╛рдгрдкрддреНрд░реЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЙрдЪреНрдЪ рдЕрдзрд┐рдХрд╛рд░реЛрдВ рдХреЗ рд╕рд╛рде рдбреЛрдореЗрди рдореЗрдВ рд╕реНрдерд┐рд░ рд░рд╣рдирд╛ рднреА рд╕рдВрднрд╡ рд╣реИ:**

{% content-ref url="ad-certificates/domain-persistence.md" %}
[domain-persistence.md](ad-certificates/domain-persistence.md)
{% endcontent-ref %}

### AdminSDHolder рд╕рдореВрд╣

**AdminSDHolder** рдСрдмреНрдЬреЗрдХреНрдЯ рдХреА **рдкрд╣реБрдВрдЪ рдирд┐рдпрдВрддреНрд░рдг рд╕реВрдЪреА (ACL)** рдХреЛ рдПрдХ рдЯреЗрдореНрдкрд▓реЗрдЯ рдХреЗ рд░реВрдк рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рддрд╛рдХрд┐ рдЗрд╕реЗ **рд╕рдХреНрд░рд┐рдп рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА** рдореЗрдВ рд╕рднреА "рд╕рдВрд░рдХреНрд╖рд┐рдд рд╕рдореВрд╣реЛрдВ" рдФрд░ рдЙрдирдХреЗ рд╕рджрд╕реНрдпреЛрдВ рдореЗрдВ **рдЕрдиреБрдорддрд┐рдпреЛрдВ** рдХреА **рдкреНрд░рддрд┐рд▓рд┐рдкрд┐** рдХрд░ рд╕рдХреЗрдВред рд╕рдВрд░рдХреНрд╖рд┐рдд рд╕рдореВрд╣реЛрдВ рдореЗрдВ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реА рд╕рдореВрд╣ рд╢рд╛рдорд┐рд▓ рд╣реЛрддреЗ рд╣реИрдВ рдЬреИрд╕реЗ рдбреЛрдореЗрди рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ, рдкреНрд░рд╢рд╛рд╕рдХ, рдПрдВрдЯрд░рдкреНрд░рд╛рдЗрдЬ рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рдФрд░ рд╕реНрдХреАрдорд╛ рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ, рдмреИрдХрдЕрдк рдСрдкрд░реЗрдЯрд░реНрд╕ рдФрд░ krbtgtред
рдЗрд╕ рд╕рдореВрд╣ рдХреА рдбрд┐рдлрд╝реЙрд▓реНрдЯ ACL рд╕рднреА "рд╕рдВрд░рдХреНрд╖рд┐рдд рд╕рдореВрд╣реЛрдВ" рдореЗрдВ рдХреЙрдкреА рдХреА рдЬрд╛рддреА рд╣реИред рдЗрд╕рдХрд╛ рдЙрджреНрджреЗрд╢реНрдп рдпрд╣ рд╣реИ рдХрд┐ рдЗрди рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╕рдореВрд╣реЛрдВ рдореЗрдВ рдЗрдЪреНрдЫрд┐рдд рдпрд╛ рдЕрдХрд╕реНрдорд╛рдд рдмрджрд▓рд╛рд╡реЛрдВ рд╕реЗ рдмрдЪрд╛ рдЬрд╛ рд╕рдХреЗред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдпрджрд┐ рдХреЛрдИ рд╣рдорд▓рд╛рд╡рд░ рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП рд╕рдореВрд╣ **AdminSDHolder** рдХреА ACL рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрди рдХрд░рддрд╛ рд╣реИ, рдирд┐рдпрдорд┐рдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдкреВрд░реА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, рддреЛ рдЗрд╕ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рд╕рдВрд░рдХреНрд╖рд┐рдд рд╕рдореВрд╣ рдХреЗ рдЕрдВрджрд░ рдХреЗ рд╕рднреА рд╕рдореВрд╣реЛрдВ рдкрд░ рдкреВрд░реА рдЕрдиреБрдорддрд┐ рд╣реЛрдЧреА (рдПрдХ рдШрдВрдЯреЗ рдореЗрдВ)ред
рдФрд░ рдпрджрд┐ рдХреЛрдИ рдЗрд╕ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдбреЛрдореЗрди рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХреЛрдВ рд╕реЗ рд╣рдЯрд╛рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рддрд╛ рд╣реИ (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП) рдПрдХ рдШрдВрдЯреЗ рдпрд╛ рдЙрд╕рд╕реЗ рдХрдо рд╕рдордп рдореЗрдВ, рддреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕рдореВрд╣ рдореЗрдВ рд╡рд╛рдкрд╕ рдЖ рдЬрд╛рдПрдЧрд╛ред
[**рдпрд╣рд╛рдВ AdminDSHolder рд╕рдореВрд╣ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реАред**](privileged-groups-and-token-privileges.md#adminsdholder-group)

### DSRM рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕

рдкреНрд░рддреНрдпреЗрдХ **DC** рдореЗрдВ рдПрдХ **рд╕реНрдерд╛рдиреАрдп рдкреНрд░рд╢рд╛рд╕рдХ** рдЦрд╛рддрд╛ рд╣реЛрддрд╛ рд╣реИред рдЗрд╕ рдорд╢реАрди рдореЗрдВ рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рдЕрдзрд┐рдХрд╛рд░ рд╣реЛрдиреЗ рдкрд░, рдЖрдк рдорд┐рдореАрдХреЗрдЯреНрдЬ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ **рд╕реНрдерд╛рдиреАрдп рдкреНрд░рд╢рд╛рд╕рдХ рд╣реИрд╢ рдХреЛ рдбрдВрдк** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдлрд┐рд░, рдЗрд╕ рдкрд╛рд╕рд╡рд░реНрдб рдХреЛ **рд╕рдХреНрд░рд┐рдп рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд░рдЬрд┐рд╕реНрдЯреНрд░реА рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд** рдХрд░рдХреЗ рдЖрдк рдЗрд╕ рд╕реНрдерд╛рдиреАрдп рдкреНрд░рд╢рд╛рд╕рдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд▓рд┐рдП рд░рд┐рдореЛрдЯ рд░реВрдк рд╕реЗ рдкрд╣реБрдВрдЪ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

{% content-ref url="dsrm-credentials.md" %}
[dsrm-credentials.md](dsrm-credentials.md)
{% endcontent-ref %}

### ACL рд╕реНрдерд┐рд░рддрд╛

рдЖрдк рдХрд┐рд╕реА рд╡рд┐рд╢реЗрд╖ рдбреЛрдореЗрди рдСрдмреНрдЬреЗрдХреНрдЯ рдкрд░ рдХреБрдЫ **рд╡рд┐рд╢реЗрд╖ рдЕрдиреБрдорддрд┐рдпрд╛рдБ** рджреЗ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рднрд╡рд┐рд╖реНрдп рдореЗрдВ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ **рдЕрдзрд┐рдХрд╛рд░реЛрдВ рдХрд╛ рдЙрдиреНрдирдпрди** рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдВрдЧреАред

{% content-ref url="acl-persistence-abuse/" %}
[acl-persistence-abuse](acl-persistence-abuse/)
{% endcontent-ref %}

### рд╕реБрд░рдХреНрд╖рд╛ рд╡рд┐рд╡рд░рдг

**рд╕реБрд░рдХреНрд╖рд╛ рд╡рд┐рд╡рд░рдг** рдХрд╛ рдЙрдкрдпреЛрдЧ рдПрдХ рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЗ рдКрдкрд░ рдЙрд╕рдХреЗ **рдЕрдиреБрдорддрд┐рдпреЛрдВ** рдХреЛ **рд╕рдВрдЧреНрд░рд╣рд┐рдд** рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдпрджрд┐ рдЖрдк рдХреЗрд╡рд▓ рдПрдХ рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЗ **рд╕реБрд░рдХреНрд╖рд╛ рд╡рд┐рд╡рд░рдг** рдореЗрдВ рдереЛрдбрд╝рд╛ рд╕рд╛ рдмрджрд▓рд╛рд╡ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рддреЛ рдЖрдк рдЙрд╕ рдСрдмреНрдЬреЗрдХреНрдЯ рдкрд░ рдм
### рд╡рд┐рднрд┐рдиреНрди рд╡рд┐рд╢реНрд╡рд╛рд╕

рдпрд╣ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ рдХрд┐ **рдПрдХ рд╡рд┐рд╢реНрд╡рд╛рд╕ рдПрдХрддрд░рдлрд╛ рдпрд╛ рджреЛрддрд░рдлрд╛ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ**ред рджреЛрддрд░рдлрд╛ рд╡рд┐рдХрд▓реНрдк рдореЗрдВ, рджреЛрдиреЛрдВ рдбреЛрдореЗрди рдПрдХ-рджреВрд╕рд░реЗ рдкрд░ рд╡рд┐рд╢реНрд╡рд╛рд╕ рдХрд░реЗрдВрдЧреЗ, рд▓реЗрдХрд┐рди **рдПрдХрддрд░рдлрд╛** рд╡рд┐рд╢реНрд╡рд╛рд╕ рд╕рдВрдмрдВрдз рдореЗрдВ рдПрдХ рдбреЛрдореЗрди рд╡рд┐рд╢реНрд╡рд╛рд╕рд┐рдд рдФрд░ рджреВрд╕рд░рд╛ рд╡рд┐рд╢реНрд╡рд╛рд╕ рдХрд░рдиреЗ рд╡рд╛рд▓рд╛ рдбреЛрдореЗрди рд╣реЛрдЧрд╛ред рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, **рдЖрдк рдХреЗрд╡рд▓ рд╡рд┐рд╢реНрд╡рд╛рд╕рд┐рдд рдбреЛрдореЗрди рд╕реЗ рд╡рд┐рд╢реНрд╡рд╛рд╕ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдбреЛрдореЗрди рдХреЗ рднреАрддрд░ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рддрдХ рдкрд╣реБрдВрдЪ рдХрд░ рд╕рдХреЗрдВрдЧреЗ**ред

рдпрджрд┐ рдбреЛрдореЗрди A рдбреЛрдореЗрди B рдкрд░ рд╡рд┐рд╢реНрд╡рд╛рд╕ рдХрд░рддрд╛ рд╣реИ, рддреЛ A рд╡рд┐рд╢реНрд╡рд╛рд╕ рдХрд░рдиреЗ рд╡рд╛рд▓рд╛ рдбреЛрдореЗрди рд╣реИ рдФрд░ B рд╡рд┐рд╢реНрд╡рд╛рд╕рд┐рдд рдбреЛрдореЗрди рд╣реИред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, **рдбреЛрдореЗрди A** рдореЗрдВ рдпрд╣ рдПрдХ **рдЖрдЙрдЯрдмрд╛рдЙрдВрдб рд╡рд┐рд╢реНрд╡рд╛рд╕** рд╣реЛрдЧрд╛; рдФрд░ **рдбреЛрдореЗрди B** рдореЗрдВ рдпрд╣ рдПрдХ **рдЗрдирдмрд╛рдЙрдВрдб рд╡рд┐рд╢реНрд╡рд╛рд╕** рд╣реЛрдЧрд╛ред

**рд╡рд┐рднрд┐рдиреНрди рд╡рд┐рд╢реНрд╡рд╛рд╕ рд╕рдВрдмрдВрдз**

* **рдкреИрд░реЗрдВрдЯ-рдЪрд╛рдЗрд▓реНрдб** - рдПрдХ рд╣реА рд╡рдирд╕реНрдкрддрд┐ рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ - рдПрдХ рдмрд╛рд▓ рдбреЛрдореЗрди рдЕрдкрдиреЗ рдорд╛рддрд╛-рдкрд┐рддрд╛ рдХреЗ рд╕рд╛рде рдПрдХ рджреНрд╡рд┐рдкрдХреНрд╖реАрдп рдкреНрд░рд╡рд╛рд╣рд┐рдд рд╡рд┐рд╢реНрд╡рд╛рд╕ рд░рдЦрддрд╛ рд╣реИред рдпрд╣ рд╢рд╛рдпрдж рд╡рд╣ рд╕рдмрд╕реЗ рд╕рд╛рдорд╛рдиреНрдп рдкреНрд░рдХрд╛рд░ рдХрд╛ рд╡рд┐рд╢реНрд╡рд╛рд╕ рд╣реЛрдЧрд╛ рдЬрд┐рд╕рд╕реЗ рдЖрдк рдкрд░ рд╕рдВрдкрд░реНрдХ рдХрд░реЗрдВрдЧреЗред
* **рдХреНрд░реЙрд╕-рд▓рд┐рдВрдХ** - рдмрдЪреНрдЪрд╛ рдбреЛрдореЗрди рдХреЗ рдмреАрдЪ рдПрдХ "рд╢реЙрд░реНрдЯрдХрдЯ рд╡рд┐рд╢реНрд╡рд╛рд╕" рдХреЗ рд░реВрдк рдореЗрдВ - рд╕рдВрджрд░реНрдн рд╕рдордпреЛрдВ рдХреЛ рд╕реБрдзрд╛рд░рдиреЗ рдХреЗ рд▓рд┐рдПред рд╕рд╛рдорд╛рдиреНрдпрддрдГ рдПрдХ рдЬрдЯрд┐рд▓ рд╡рдирд╕реНрдкрддрд┐ рдореЗрдВ рд╕рдВрджрд░реНрднреЛрдВ рдХреЛ рд╡рдирд╕реНрдкрддрд┐ рд░реВрдЯ рддрдХ рдлрд╝рд┐рд▓реНрдЯрд░ рдХрд░рдирд╛ рд╣реЛрддрд╛ рд╣реИ рдФрд░ рдлрд┐рд░ рд▓рдХреНрд╖рд┐рдд рдбреЛрдореЗрди рддрдХ рд╡рд╛рдкрд╕ рдЖрдирд╛ рд╣реЛрддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рднреВрдЧреЛрд▓рд┐рдХ рд░реВрдк рд╕реЗ рдлреИрд▓реЗ рд╣реБрдП рд╕реНрдерд┐рддрд┐ рдХреЗ рд▓рд┐рдП, рдХреНрд░реЙрд╕-рд▓рд┐рдВрдХ рд╕рдордп рдХреЛ рдХрдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдВрднрд╡ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред
* **рдмрд╛рд╣реНрдп** - рдЕрд▓рдЧ-рдерд▓рдЧ рдбреЛрдореЗрди рдХреЗ рдмреАрдЪ рд╕реНрд╡рддрдГ рд╣реА рдЧреИрд░-рдкреНрд░рд╡рд╛рд╣рд┐рдд рд╡рд┐рд╢реНрд╡рд╛рд╕ред "[рдмрд╛рд╣реНрдп рд╡рд┐рд╢реНрд╡рд╛рд╕ рд╡рдирд╕реНрдкрддрд┐ рдХреЗ рдмрд╛рд╣рд░реА рд╕рдВрд╕рд╛рдзрдиреЛрдВ рддрдХ рдкрд╣реБрдВрдЪ рдкреНрд░рджрд╛рди рдХрд░рддреЗ рд╣реИрдВ рдЬреЛ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рд╡рдирд╕реНрдкрддрд┐ рд╡рд┐рд╢реНрд╡рд╛рд╕ рджреНрд╡рд╛рд░рд╛ рдЬреБрдбрд╝рд╛ рдирд╣реАрдВ рд╣реИред](https://technet.microsoft.com/en-us/library/cc773178\(v=ws.10\).aspx)" рдмрд╛рд╣реНрдп рд╡рд┐рд╢реНрд╡рд╛рд╕ рдПрд╕рдЖрдИрдбреА рдлрд╝рд┐рд▓реНрдЯрд░рд┐рдВрдЧ рдХреЛ рдкреНрд░рдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ, рдЬреЛ рдЗрд╕ рдкреЛрд╕реНрдЯ рдХреЗ рдмрд╛рдж рдореЗрдВ рдЪрд░реНрдЪрд┐рдд рд╕реБрд░рдХреНрд╖рд╛ рд╕рдВрд░рдХреНрд╖рдг рд╣реИред
* **рдЯреНрд░реА-рд░реВрдЯ** - рд╡рдирд╕реНрдкрддрд┐ рд░реВрдЯ рдбреЛрдореЗрди рдФрд░ рдЖрдк рдЬреЛ рдирдИ рдЯреНрд░реА рд░реВрдЯ рдЬреЛрдбрд╝ рд░рд╣реЗ рд╣реИрдВ рдХреЗ рдмреАрдЪ рдПрдХ рд╕реНрд╡рддрдГ рд╣реА рджреНрд╡рд┐рдкрдХреНрд╖реАрдп рдкреНрд░рд╡рд╛рд╣рд┐рдд рд╡рд┐рд╢реНрд╡рд╛рд╕ред рдореИрдВрдиреЗ рдЯреНрд░реА-рд░реВрдЯ рд╡рд┐рд╢реНрд╡рд╛рд╕ рдХреЛ рдмрд╣реБрдд рдмрд╛рд░ рдирд╣реАрдВ рджреЗрдЦрд╛ рд╣реИ, рд▓реЗрдХрд┐рди [Microsoft рджрд╕реНрддрд╛рд╡реЗрдЬрд╝реАрдХрд░рдг](https://technet.microsoft.com/en-us/library/cc773178\(v=ws.10\).aspx) рд╕реЗ, рдпрд╣ рдЬрдм рдЖрдк рдПрдХ рдирдИ рд╡рдирд╕реНрдкрддрд┐ рд╡реГрдХреНрд╖ рд╡рдирд╕реНрдкрддрд┐ рдореЗрдВ рдмрдирд╛рддреЗ рд╣реИрдВ рддреЛ рдмрдирд╛рдП рдЬрд╛рддреЗ рд╣реИрдВред рдпреЗ рд╡рди-рд╡рдирд╕реНрдкрддрд┐ рд╡рд┐рд╢реНрд╡рд╛рд╕ рд╣реИрдВ, рдФрд░ рд╡реЗ [рджреНрд╡рд┐рдкрдХреНрд╖реАрдп рдкреНрд░рд╡рд╛рд╣рд┐рддрддрд╛ рдХреЛ рд╕рдВрд░рдХреНрд╖рд┐рдд рд░рдЦрддреЗ рд╣реИрдВ](https://technet.microsoft.com/en-us/library/cc757352\(v=ws.10\).aspx) рдЬрдмрдХрд┐ рд╡реГрдХреНрд╖ рдХреЛ рдПрдХ рдЕрд▓рдЧ рдбреЛрдореЗрди рдирд╛рдо (рдмрдЪреНрдЪрд╛.рдорд╛рддрд╛.com рдХреЗ рдмрдЬрд╛рдп) рд╣реЛрдиреЗ рджреЗрддреЗ рд╣реИрдВред
* **рд╡рдирд╕реНрдкрддрд┐** - рджреЛ рд╡рдирд╕реНрдкрддрд┐ рд░реВрдЯ рдбреЛрдореЗрди рдХреЗ рдмреАрдЪ рдПрдХ рдкреНрд░рд╡рд╛рд╣рд┐рдд рд╡рд┐рд╢реНрд╡рд╛рд╕ред рд╡рдирд╕реНрдкрддрд┐ рд╡рд┐рд╢реНрд╡рд╛рд╕ рднреА рдПрд╕рдЖрдИрдбреА рдлрд╝рд┐рд▓реНрдЯрд░рд┐рдВрдЧ рдХреЛ рдкреНрд░рдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред
* **MIT** - рдПрдХ рдЧреИрд░-рд╡рд┐рдВрдбреЛрдЬ [RFC4120-рд╕рдВрдЧрдд](https://tools.ietf.org/html/rfc4120) рдХреЗрд░рдмреЗрд░реЛрд╕ рдбреЛрдореЗрди рдХреЗ рд╕рд╛рде рдПрдХ рд╡рд┐рд╢реНрд╡рд╛рд╕ред рдореИрдВ рднрд╡рд┐рд╖реНрдп рдореЗрдВ MIT рд╡рд┐рд╢реНрд╡рд╛рд╕ рдореЗрдВ рдФрд░ рдЧрд╣рд░рд╛рдИ рд╕реЗ рдЬрд╛рдиреЗ рдХреА рдЙрдореНрдореАрдж рдХрд░рддрд╛ рд╣реВрдБред

#### **рд╡рд┐рд╢реНрд╡рд╛рд╕ рд╕рдВрдмрдВрдзреЛрдВ** рдореЗрдВ рдЕрдиреНрдп рдЕрдВрддрд░

* рдПрдХ рд╡рд┐рд╢реНрд╡рд╛рд╕ рд╕рдВрдмрдВрдз рднреА **рдкреНрд░рд╡рд╛рд╣рд┐рдд** (A рд╡рд┐рд╢реНрд╡рд╛рд╕ B, B рд╡рд┐рд╢реНрд╡рд╛рд╕ C, рддреЛ A рд╡рд┐рд╢реНрд╡рд╛рд╕ C) рдпрд╛ **рдЧреИрд░-рдкреНрд░рд╡рд╛рд╣рд┐рдд** рд╣реЛ рд╕рдХрддрд╛ рд╣реИред
* рдПрдХ рд╡рд┐рд╢реНрд╡рд╛рд╕ рд╕рдВрдмрдВрдз рдХреЛ **рджреНрд╡рд┐рдкрдХреНрд╖реАрдп рд╡рд┐рд╢реНрд╡рд╛рд╕** (рджреЛрдиреЛрдВ рдПрдХ-рджреВрд╕рд░реЗ рдкрд░ рд╡рд┐рд╢реНрд╡рд╛рд╕ рдХрд░рддреЗ рд╣реИрдВ) рдпрд╛ **рдПрдХрддрд░рдлрд╛ рд╡рд┐рд╢реНрд╡рд╛рд╕** (рдХреЗрд╡рд▓ рдПрдХ рд╡рд┐рд╢реНрд╡рд╛рд╕ рдХрд░рддрд╛ рд╣реИ) рдХреЗ рд░реВрдк рдореЗрдВ рд╕реЗрдЯ рдЕрдк рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

### рд╣рдорд▓рд╛ рдорд╛рд░реНрдЧ

1. рд╡рд┐рд╢реНрд╡рд╛рд╕ рд╕рдВрдмрдВрдзреЛрдВ рдХреА **рдЬрд╛рдВрдЪ** рдХрд░реЗрдВ
2. рдЬрд╛рдВрдЪреЗрдВ рдХрд┐ рдХреНрдпрд╛ рдХреЛрдИ **рд╕реБрд░рдХреНрд╖рд╛ рдореБрдЦреНрдп** (рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛/рд╕рдореВрд╣/рдХрдВрдкреНрдпреВрдЯрд░) **рджреВрд╕рд░реЗ рдбреЛрдореЗрди** рдХреЗ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХрд╛ **рдкрд╣реБрдВрдЪ** рд░рдЦрддрд╛ рд╣реИ, рд╢рд╛рдпрдж ACE рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐рдпреЛрдВ рджреНрд╡рд╛рд░рд╛ рдпрд╛ рджреВрд╕рд░реЗ рдбреЛрдореЗрди рдХреЗ рд╕рдореВрд╣реЛрдВ рдореЗрдВ рд╣реЛрдиреЗ рдХреЗ рдХрд╛рд░рдгред **рдбреЛрдореЗрдиреЛрдВ рдХреЗ рдмреАрдЪ рд╕рдВрдмрдВрдзреЛрдВ** рдХреА рддрд▓рд╛рд╢ рдХрд░реЗрдВ (рд╡рд┐рд╢реНрд╡рд╛рд╕ рдЗрд╕рдХреЗ рд▓рд┐рдП рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рд╣реЛрдЧрд╛ рд╢рд╛рдпрдж)ред
1. рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ kerberoast рдПрдХ рдФрд░ рд╡рд┐рдХрд▓реНрдк рд╣реЛ рд╕рдХрддрд╛ рд╣реИред
3. рд╡рд┐рд╢реНрд╡рд╛рд╕ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдЦрд╛рддреЛрдВ рдХреЛ **рдЕрдзрд┐рдХрд╛рд░** рджреЗрдВ рдЬреЛ рдбреЛрдореЗрди рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ **рдкрд┐рд╡рдЯ** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

рдПрдХ рдбреЛрдореЗрди рд╕реЗ рджреВрд╕рд░реЗ рд╡рд┐рджреЗрд╢реА/рд╡рд┐рд╢реНрд╡рд╛рд╕ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдбреЛрдореЗрди рдореЗрдВ рд╕реБрд░рдХреНрд╖рд╛ рдореБрдЦреНрдп (рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛/рд╕рдореВрд╣/рдХрдВрдкреНрдпреВрдЯрд░) рдХреЗ рддреАрди **рдореБрдЦреНрдп** рддрд░реАрдХреЗ рд╣реИрдВ рдЬрд┐рдирд╕реЗ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдореЗрдВ рдкрд╣реБрдВрдЪ рд╣реЛ рд╕рдХрддреА рд╣реИ:

* рд╡реЗ рд╡реНрдпрдХреНрддрд┐рдЧрдд рдорд╢реАрдиреЛрдВ рдкрд░ **рд╕реНрдерд╛рдиреАрдп рд╕рдореВрд╣реЛрдВ** рдореЗрдВ рдЬреЛрдбрд╝реЗ рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВ, рдЬреИрд╕реЗ рдХрд┐ рд╕рд░реНрд╡рд░ рдкрд░ рд╕реНрде
```
Get-DomainTrust

SourceName      : sub.domain.local    --> current domain
TargetName      : domain.local        --> foreign domain
TrustType       : WINDOWS_ACTIVE_DIRECTORY
TrustAttributes : WITHIN_FOREST       --> WITHIN_FOREST: Both in the same forest
TrustDirection  : Bidirectional       --> Trust direction (2ways in this case)
WhenCreated     : 2/19/2021 1:28:00 PM
WhenChanged     : 2/19/2021 1:28:00 PM
```
{% hint style="warning" %}
рдпрд╣рд╛рдБ **2 рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рдХреБрдВрдЬреА** рд╣реИрдВ, рдПрдХ _рдмрд╛рд▓ --> рдорд╛рддрд╛-рдкрд┐рддрд╛_ рдХреЗ рд▓рд┐рдП рдФрд░ рджреВрд╕рд░реА _рдорд╛рддрд╛-рдкрд┐рддрд╛_ --> _рдмрд╛рд▓_ рдХреЗ рд▓рд┐рдПред\
рдЖрдк рдореМрдЬреВрджрд╛ рдбреЛрдореЗрди рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛рдиреЗ рд╡рд╛рд▓реА рдХреБрдВрдЬреА рдХреЛ рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
Invoke-Mimikatz -Command '"lsadump::trust /patch"' -ComputerName dc.my.domain.local
Invoke-Mimikatz -Command '"lsadump::dcsync /user:dcorp\mcorp$"'
```
{% endhint %}

#### SID-History Injection

рдЯреНрд░рд╕реНрдЯ рдХреЗ рд╕рд╛рде рдмрдЪреНрдЪрд╛ / рдорд╛рддрд╛-рдкрд┐рддрд╛ рдбреЛрдореЗрди рдХреЛ рдПрдВрдЯрд░рдкреНрд░рд╛рдЗрдЬ рдПрдбрдорд┐рди рдХреЗ рд░реВрдк рдореЗрдВ рдЙрдиреНрдирдд рдХрд░реЗрдВ, SID-History рдЗрдВрдЬреЗрдХреНрд╢рди рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ:

{% content-ref url="sid-history-injection.md" %}
[sid-history-injection.md](sid-history-injection.md)
{% endcontent-ref %}

#### Exploit writeable Configuration NC

Configuration NC рдПрдХ рд╡рдирд╕реНрдкрддрд┐ рдХреЗ рд▓рд┐рдП рд╡рд┐рдиреНрдпрд╛рд╕ рд╕реВрдЪрдирд╛ рдХрд╛ рдкреНрд░рд╛рдердорд┐рдХ рд╕рдВрдЧреНрд░рд╣ рд╣реИ рдФрд░ рдЗрд╕реЗ рд╡рдирд╕реНрдкрддрд┐ рдореЗрдВ рд╣рд░ DC рдореЗрдВ рдкреНрд░рддрд┐рд▓рд┐рдкрд┐ рдХреА рдЬрд╛рддреА рд╣реИред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рд╡рдирд╕реНрдкрддрд┐ рдореЗрдВ рд╣рд░ рд▓рд┐рдЦрдиреЗ рдпреЛрдЧреНрдп DC (рд╡рд╛рдкрд╕реА рдирд╣реАрдВ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ DCs) рд╡рдирд╕реНрдкрддрд┐ рдХреЗ рдПрдХ рд▓рд┐рдЦрдиреЗ рдпреЛрдЧреНрдп рдкреНрд░рддрд┐рд▓рд┐рдкрд┐ рдХреЛ рд░рдЦрддрд╛ рд╣реИред рдЗрд╕реЗ рдЙрддреНрдкрдиреНрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП (рдмрдЪреНрдЪрд╛) DC рдкрд░ рд╕рд┐рд╕реНрдЯрдо рдХреЗ рд░реВрдк рдореЗрдВ рдЪрд▓рд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред

рдпрд╣ рд╕рдВрднрд╡ рд╣реИ рдХрд┐ рд╡рд┐рднрд┐рдиреНрди рддрд░реАрдХреЛрдВ рд╕реЗ рдореВрд▓ рдбреЛрдореЗрди рдХреЛ рдкреНрд░рднрд╛рд╡рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЬреЛ рдиреАрдЪреЗ рдЪрд░реНрдЪрд┐рдд рд╣реИрдВред

##### рд░реВрдЯ DC рд╕рд╛рдЗрдЯ рдХреЛ GPO рд╕реЗ рд▓рд┐рдВрдХ рдХрд░реЗрдВ
Configuration NC рдореЗрдВ рд╕рд╛рдЗрдЯреНрд╕ рдХрдВрдЯреЗрдирд░ рдПрдбреА рд╡рдирд╕реНрдкрддрд┐ рдореЗрдВ рд╢рд╛рдорд┐рд▓ рдХрдВрдкреНрдпреВрдЯрд░реЛрдВ рдХреА рд╕рднреА рд╕рд╛рдЗрдЯреНрд╕ рдХреЛ рд╕рдВрдЧрдард┐рдд рдХрд░рддрд╛ рд╣реИред рд╕рдВрдЧрдарди рдореЗрдВ рдХрд┐рд╕реА рднреА DC рдХреЗ рд░реВрдк рдореЗрдВ рд╕рд┐рд╕реНрдЯрдо рдХреЗ рд░реВрдк рдореЗрдВ рдЪрд▓рд╛рддреЗ рд╕рдордп, рдЗрд╕рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реИрдВ рд╡рдирд╕реНрдкрддрд┐ рдХреЗ рд░реВрдЯ DCs рдХреА рд╕рд╛рдЗрдЯ (рдФрд░ рдЗрд╕рд▓рд┐рдП рдЗрдиреНрд╣реЗрдВ рдкреНрд░рднрд╛рд╡рд┐рдд рдХрд░реЗрдВ) рдХреЛ GPO рд╕реЗ рд▓рд┐рдВрдХ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

рдЕрдзрд┐рдХ рд╡рд┐рд╡рд░рдг рдпрд╣рд╛рдВ рдкрдврд╝реЗрдВ: [Bypass SID filtering research](https://improsec.com/tech-blog/sid-filter-as-security-boundary-between-domains-part-4-bypass-sid-filtering-research).

##### рд╡рдирд╕реНрдкрддрд┐ рдореЗрдВ рдХрд┐рд╕реА рднреА gMSA рдХреЛ рдкреНрд░рднрд╛рд╡рд┐рдд рдХрд░реЗрдВ
рд╣рдорд▓рд╛ рд▓рдХреНрд╖рд┐рдд рдбреЛрдореЗрди рдореЗрдВ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реА gMSAs рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддрд╛ рд╣реИред

рд╡рдирд╕реНрдкрддрд┐ рдореЗрдВ gMSAs рдХреЗ рдкрд╛рд╕рд╡рд░реНрдб рдХреА рдЧрдгрдирд╛ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ KDS рд░реВрдЯ рдХреБрдВрдЬреА рдХреЛ Configuration NC рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рд╡рдирд╕реНрдкрддрд┐ рдореЗрдВ рдХрд┐рд╕реА рднреА DC рдХреЗ рд░реВрдк рдореЗрдВ рд╕рд┐рд╕реНрдЯрдо рдХреЗ рд░реВрдк рдореЗрдВ рдЪрд▓рд╛рддреЗ рд╕рдордп, рдПрдХ рд╡реНрдпрдХреНрддрд┐ KDS рд░реВрдЯ рдХреБрдВрдЬреА рдХреЛ рдкрдврд╝ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рд╡рдирд╕реНрдкрддрд┐ рдореЗрдВ рдХрд┐рд╕реА рднреА gMSA рдХрд╛ рдкрд╛рд╕рд╡рд░реНрдб рдЧрдгрдирд╛ рдХрд░ рд╕рдХрддрд╛ рд╣реИред

рдЕрдзрд┐рдХ рд╡рд┐рд╡рд░рдг рдпрд╣рд╛рдВ рдкрдврд╝реЗрдВ: [Golden gMSA trust attack from child to parent](https://improsec.com/tech-blog/sid-filter-as-security-boundary-between-domains-part-5-golden-gmsa-trust-attack-from-child-to-parent).

##### рд╕реНрдХреАрдорд╛ рдмрджрд▓рдиреЗ рдХрд╛ рд╣рдорд▓рд╛
рд╣рдорд▓рд╛рд╡рд░ рдХреЛ рдирдП рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реА AD рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рдХреЗ рдирд┐рд░реНрдорд╛рдг рдХреЗ рд▓рд┐рдП рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред

рд╡рдирд╕реНрдкрддрд┐ рдореЗрдВ рдХрд┐рд╕реА рднреА DC рдХреЗ рд░реВрдк рдореЗрдВ рд╕рд┐рд╕реНрдЯрдо рдХреЗ рд░реВрдк рдореЗрдВ рдЪрд▓рд╛рддреЗ рд╕рдордп, рдПрдХ рд╡реНрдпрдХреНрддрд┐ рд╕рднреА рдХрдХреНрд╖рд╛рдУрдВ рдкрд░ рдХрд┐рд╕реА рднреА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдкреВрд░реНрдг рдирд┐рдпрдВрддреНрд░рдг рдкреНрд░рджрд╛рди рдХрд░ рд╕рдХрддрд╛ рд╣реИред рдпрд╣ рдирд┐рдпрдВрддреНрд░рдг рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ ACE рдмрдирд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ рдХрд┐рд╕реА рднреА рд╕рдВрдХрдЯрдЧреНрд░рд╕реНрдд рдкреНрд░рдореБрдЦрд▓рдЧреНрдирдХ рдХреЛ рдкреВрд░реНрдг рдирд┐рдпрдВрддреНрд░рдг рдкреНрд░рджрд╛рди рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рд╕рдВрдХрдЯрдЧреНрд░рд╕реНрдд рдкреНрд░рдореБрдЦрд▓рдЧреНрдирдХ рдХреЗ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд╕реБрд░рдХреНрд╖рд╛ рд╡рд┐рд╡рд░рдг рдореЗрдВ рдмрдирд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рд╕рдВрд╢реЛрдзрд┐рдд AD рдСрдмреНрдЬреЗрдХреНрдЯ рдкреНрд░рдХрд╛рд░ рдХреЗ рд╕рднреА рдирдП рдЙрджрд╛рд╣рд░рдгреЛрдВ рдореЗрдВ рдЗрд╕ ACE рд╣реЛрдЧрд╛ред

рдЕрдзрд┐рдХ рд╡рд┐рд╡рд░рдг рдпрд╣рд╛рдВ рдкрдврд╝реЗрдВ: [Schema change trust attack from child to parent](https://improsec.com/tech-blog/sid-filter-as-security-boundary-between-domains-part-6-schema-change-trust-attack-from-child-to-parent).

##### DA рд╕реЗ EA рддрдХ ADCS ESC5 рдХреЗ рд╕рд╛рде
ADCS ESC5 (рд╡рд┐рдХрд▓реНрдкрдиреАрдп PKI рдСрдмреНрдЬреЗрдХреНрдЯ рдкрд╣реБрдВрдЪ рдирд┐рдпрдВрддреНрд░рдг) рд╣рдорд▓реЗ PKI рдСрдмреНрдЬреЗрдХреНрдЯ рдкрд░ рдирд┐рдпрдВрддреНрд░рдг рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рдПрдХ рдРрд╕рд╛ рд╡рд┐рдХрд▓реНрдкрдиреАрдп рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдмрдирд╛рдпрд╛ рдЬрд╛ рд╕рдХреЗ рдЬрд┐рд╕рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рд╡рдирд╕реНрдкрддрд┐ рдореЗрдВ рдХрд┐рд╕реА рднреА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд░реВрдк рдореЗрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред рдХреНрдпреЛрдВрдХрд┐ рд╕рднреА PKI рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ Configuration NC рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реЛрддреЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рдпрджрд┐ рдХрд┐рд╕реА рднреА рд▓рд┐рдЦрдиреЗ рдпреЛрдЧреНрдп (рдмрдЪреНрдЪрд╛) DC рдореЗрдВ рд╣рдорд▓рд╛рд╡рд░ рдиреЗ рдкреНрд░рднрд╛рд╡рд┐рдд рдХрд┐рдпрд╛ рд╣реИ, рддреЛ рд╡рд╣ ESC5 рдХреЛ рдХреНрд░рд┐рдпрд╛рдиреНрд╡рд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИред

рдЕрдзрд┐рдХ рд╡рд┐рд╡рд░рдг рдпрд╣рд╛рдВ рдкрдврд╝реЗрдВ: [From DA to EA with ESC5](https://posts.specterops.io/from-da-to-ea-with-esc5-f9f045aa105c)

рдпрджрд┐ AD рд╡рдирд╕реНрдкрддрд┐ рдореЗрдВ ADCS рдирд╣реАрдВ рд╣реИ, рддреЛ рд╣рдорд▓рд╛рд╡рд░ рдЖрд╡рд╢реНрдпрдХ рдШрдЯрдХ рдмрдирд╛ рд╕рдХрддрд╛ рд╣реИ рдЬреИрд╕рд╛ рдХрд┐ рдпрд╣рд╛рдВ рд╡рд░реНрдгрд┐рдд рд╣реИ: [Escalating from child domainтАЩs admins to enterprise admins in 5 minutes by abusing AD CS, a follow up](https://www.pkisolutions.com/escalating-from-child-domains-admins-to-enterprise-admins-in-5-minutes-by-abusing-ad-cs-a-follow-up/).

### рдмрд╛рд╣рд░реА рд╡рдирд╕реНрдкрддрд┐ рдбреЛрдореЗрди - рдПрдХрддрд░рдлрд╛ (рдЗрдирдмрд╛рдЙрдВрдб) рдпрд╛ рджреНрд╡рд┐рджрд┐рд╢реАрдп
```powershell
Get-DomainTrust
SourceName      : a.domain.local   --> Current domain
TargetName      : domain.external  --> Destination domain
TrustType       : WINDOWS-ACTIVE_DIRECTORY
TrustAttributes :
TrustDirection  : Inbound          --> Inboud trust
WhenCreated     : 2/19/2021 10:50:56 PM
WhenChanged     : 2/19/2021 10:50:56 PM
```
рдЗрд╕ рдкрд░рд┐рджреГрд╢реНрдп рдореЗрдВ **рдЖрдкрдХреЗ рдбреЛрдореЗрди рдХреЛ рдПрдХ рдмрд╛рд╣рд░реА рдбреЛрдореЗрди рджреНрд╡рд╛рд░рд╛ рд╡рд┐рд╢реНрд╡рд╕рдиреАрдпрддрд╛ рдкреНрд░рд╛рдкреНрдд рд╣реИ** рдЬрд┐рд╕рд╕реЗ рдЖрдкрдХреЛ рдЗрд╕ рдкрд░ рдЕрдирд┐рд░реНрдзрд╛рд░рд┐рдд рдЕрдиреБрдорддрд┐рдпрд╛рдБ рдорд┐рд▓рддреА рд╣реИрдВред рдЖрдкрдХреЛ **рдвреВрдВрдврд╝рдирд╛ рд╣реЛрдЧрд╛ рдХрд┐ рдЖрдкрдХреЗ рдбреЛрдореЗрди рдХреЗ рдХреМрди рд╕реЗ рдкреНрд░рдореБрдЦ рдмрд╛рд╣рд░реА рдбреЛрдореЗрди рдкрд░ рдХреМрди рд╕реА рдкрд╣реБрдВрдЪ рд░рдЦрддреЗ рд╣реИрдВ** рдФрд░ рдлрд┐рд░ рдЗрд╕реЗ рдЙрддреНрдкрдиреНрди рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВ:

{% content-ref url="external-forest-domain-oneway-inbound.md" %}
[external-forest-domain-oneway-inbound.md](external-forest-domain-oneway-inbound.md)
{% endcontent-ref %}

### рдмрд╛рд╣рд░реА рд╡рди рдбреЛрдореЗрди - рдПрдХ-рддрд░рдлрд╛ (рдЖрдЙрдЯрдмрд╛рдЙрдВрдб)
```powershell
Get-DomainTrust -Domain current.local

SourceName      : current.local   --> Current domain
TargetName      : external.local  --> Destination domain
TrustType       : WINDOWS_ACTIVE_DIRECTORY
TrustAttributes : FOREST_TRANSITIVE
TrustDirection  : Outbound        --> Outbound trust
WhenCreated     : 2/19/2021 10:15:24 PM
WhenChanged     : 2/19/2021 10:15:24 PM
```
рдЗрд╕ рд╕реНрдерд┐рддрд┐ рдореЗрдВ **рдЖрдкрдХрд╛ рдбреЛрдореЗрди** рдХрд┐рд╕реА **рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░** рдХреЛ рдХрд┐рд╕реА **рдЕрд▓рдЧ рдбреЛрдореЗрди** рдХреЗ рдкреНрд░рд┐рдВрд╕рд┐рдкрд▓ рдХреЛ **рд╡рд┐рд╢реНрд╡рд╛рд╕ рдХрд░ рд░рд╣рд╛ рд╣реИ**ред

рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЬрдм рдПрдХ **рдбреЛрдореЗрди рд╡рд┐рд╢реНрд╡рд╛рд╕ рдХрд░рддрд╛ рд╣реИ** рд╡рд┐рд╢реНрд╡рд╛рд╕ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдбреЛрдореЗрди рджреНрд╡рд╛рд░рд╛, рд╡рд┐рд╢реНрд╡рд╛рд╕рд┐рдд рдбреЛрдореЗрди **рдПрдХ рдкреНрд░рдпреЛрдЧрдХрд░реНрддрд╛ рдмрдирд╛рддрд╛ рд╣реИ** рдЬрд┐рд╕рдХрд╛ рдирд╛рдо **рдкреВрд░реНрд╡рд╛рдиреБрдорд╛рдирд┐рдд рд╣реЛрддрд╛ рд╣реИ** рдФрд░ рдЬрд┐рд╕рдХрд╛ **рдкрд╛рд╕рд╡рд░реНрдб рд╡рд┐рд╢реНрд╡рд╛рд╕рд┐рдд рдкрд╛рд╕рд╡рд░реНрдб рдХреЗ рд░реВрдк рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ**ред рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдпрд╣ рд╕рдВрднрд╡ рд╣реИ рдХрд┐ рдЖрдк **рд╡рд┐рд╢реНрд╡рд╛рд╕ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдбреЛрдореЗрди рдореЗрдВ рдкреНрд░рд╡реЗрд╢ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╡рд┐рд╢реНрд╡рд╛рд╕ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдбреЛрдореЗрди рд╕реЗ рдПрдХ рдкреНрд░рдпреЛрдЧрдХрд░реНрддрд╛ рддрдХ рдкрд╣реБрдВрдЪ рд╕рдХрддреЗ рд╣реИрдВ** рдФрд░ рдЗрд╕реЗ рдЬрд╛рдВрдЪрдиреЗ рдФрд░ рдЕрдзрд┐рдХ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдХреЛ рдЙрдиреНрдирдд рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

{% content-ref url="external-forest-domain-one-way-outbound.md" %}
[external-forest-domain-one-way-outbound.md](external-forest-domain-one-way-outbound.md)
{% endcontent-ref %}

рд╡рд┐рд╢реНрд╡рд╛рд╕рд┐рдд рдбреЛрдореЗрди рдХреЛ рд╕рдВрдХрдЯ рдореЗрдВ рдбрд╛рд▓рдиреЗ рдХрд╛ рдПрдХ рдФрд░ рддрд░реАрдХрд╛ рд╣реИ **рдПрдХ [SQL рд╡рд┐рд╢реНрд╡рд╛рд╕рд┐рдд рд▓рд┐рдВрдХ](abusing-ad-mssql.md#mssql-trusted-links) рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдирд╛** рдЬреЛ рдбреЛрдореЗрди рд╡рд┐рд╢реНрд╡рд╛рд╕ рдХреЗ **рдЙрд▓рдЯ рджрд┐рд╢рд╛** рдореЗрдВ рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ (рдЬреЛ рдмрд╣реБрдд рдЖрдо рдирд╣реАрдВ рд╣реИ)ред

рд╡рд┐рд╢реНрд╡рд╛рд╕рд┐рдд рдбреЛрдореЗрди рдХреЛ рд╕рдВрдХрдЯ рдореЗрдВ рдбрд╛рд▓рдиреЗ рдХрд╛ рдПрдХ рдФрд░ рддрд░реАрдХрд╛ рд╣реИ рдХрд┐ рдПрдХ рдорд╢реАрди рдореЗрдВ рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд░реЗрдВ рдЬрд╣рд╛рдВ рд╕реЗ рд╡рд┐рд╢реНрд╡рд╛рд╕рд┐рдд рдбреЛрдореЗрди рдХрд╛ рдПрдХ рдкреНрд░рдпреЛрдЧрдХрд░реНрддрд╛ рдкрд╣реБрдВрдЪ рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдФрд░ **RDP** рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд▓реЙрдЧрд┐рди рдХрд░ рд╕рдХрддрд╛ рд╣реИред рдлрд┐рд░, рд╣рдорд▓рд╛рд╡рд░ RDP рд╕рддреНрд░ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рдХреЛрдб рдЗрдВрдЬреЗрдХреНрд╢рди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рд╡рд╣рд╛рдВ рд╕реЗ рдкреАрдбрд╝рд┐рдд рдХрд╛ рдореВрд▓ рдбреЛрдореЗрди **рддрдХ рдкрд╣реБрдВрдЪ рд╕рдХрддреЗ рд╣реИрдВ**ред
рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдпрджрд┐ **рдкреАрдбрд╝рд┐рдд рдиреЗ рдЕрдкрдиреА рд╣рд╛рд░реНрдб рдбреНрд░рд╛рдЗрд╡ рдорд╛рдЙрдВрдЯ рдХреА рд╣реИ**, рддреЛ рд╣рдорд▓рд╛рд╡рд░ RDP рд╕рддреНрд░ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд╕реЗ рдЖрдХреНрд░рдордгрдХрд╛рд░реА **рд╣рд╛рд░реНрдб рдбреНрд░рд╛рдЗрд╡ рдХреЗ рд╕реНрдЯрд╛рд░реНрдЯрдЕрдк рдлрд╝реЛрд▓реНрдбрд░ рдореЗрдВ рдмреИрдХрдбреЛрд░реНрд╕** рд╕рдВрдЧреНрд░рд╣рд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИред рдЗрд╕ рддрдХрдиреАрдХ рдХреЛ **RDPInception** рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИред

{% content-ref url="rdp-sessions-abuse.md" %}
[rdp-sessions-abuse.md](rdp-sessions-abuse.md)
{% endcontent-ref %}

### рдбреЛрдореЗрди рд╡рд┐рд╢реНрд╡рд╛рд╕ рджреБрд░реБрдкрдпреЛрдЧ рдирд┐рд╡рд╛рд░рдг

**SID рдлрд╝рд┐рд▓реНрдЯрд░рд┐рдВрдЧ:**

* рд╡рди рд╡рди рд╡рд┐рд╢реНрд╡рд╛рд╕ рдореЗрдВ SID рдЗрддрд┐рд╣рд╛рд╕ рд╡рд┐рд╢реНрд╡рд╛рд╕ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рд╣рдорд▓реЛрдВ рд╕реЗ рдмрдЪреЗрдВред
* рд╕рднреА рдЗрдВрдЯрд░-рд╡рди рд╡рд┐рд╢реНрд╡рд╛рд╕реЛрдВ рдкрд░ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рд╕рдХреНрд╖рдо рд╣реИред рдЗрдВрдЯреНрд░рд╛-рд╡рди рд╡рд┐рд╢реНрд╡рд╛рд╕реЛрдВ рдХреЛ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рд╕реБрд░рдХреНрд╖рд┐рдд рдорд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИ (MS рдХреЛ рд╡рди рдирд╣реАрдВ рдбреЛрдореЗрди рдХреЛ рд╕реБрд░рдХреНрд╖рд╛ рд╕реАрдорд╛ рдорд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИ)ред
* рд▓реЗрдХрд┐рди, SID рдлрд╝рд┐рд▓реНрдЯрд░рд┐рдВрдЧ рдХреЛ рдЕрдиреБрдкреНрд░рдпреЛрдЧреЛрдВ рдФрд░ рдкреНрд░рдпреЛрдЧрдХрд░реНрддрд╛ рдкрд╣реБрдВрдЪ рдХреЛ рддреЛрдбрд╝рдиреЗ рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рд╣реЛрддреА рд╣реИ, рдЗрд╕рд▓рд┐рдП рдпрд╣ рдЕрдХреНрд╕рд░ рдЕрдХреНрд╖рдо рд╣реЛ рдЬрд╛рддрд╛ рд╣реИред
* рдЪрдпрдирд╛рддреНрдордХ рдкреНрд░рдорд╛рдгреАрдХрд░рдг
* рдЗрдВрдЯрд░-рд╡рди рд╡рд┐рд╢реНрд╡рд╛рд╕ рдореЗрдВ, рдпрджрд┐ рдЪрдпрдирд╛рддреНрдордХ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рддреЛ рд╡рд┐рд╢реНрд╡рд╛рд╕ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдбреЛрдореЗрди / рд╡рди рдореЗрдВ рдбреЛрдореЗрди рдФрд░ рд╕рд░реНрд╡рд░реЛрдВ рдХреЗ рдмреАрдЪ рдХреЗ рдкреНрд░рдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдкреНрд░рдорд╛рдгрд┐рдд рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред рд╡рд┐рд╢реНрд╡рд╛рд╕ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдбреЛрдореЗрди / рд╡рди рдореЗрдВ рдбреЛрдореЗрди рдФрд░ рд╕рд░реНрд╡рд░реЛрдВ рдХреЗ рд▓рд┐рдП рд╡реНрдпрдХреНрддрд┐рдЧрдд рдкрд╣реБрдВрдЪ рджреА рдЬрд╛рдиреА рдЪрд╛рд╣рд┐рдПред
* рд▓рд┐рдЦрдиреЗ рдпреЛрдЧреНрдп рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди NC рд╢реЛрд╖рдг рдФрд░ рд╡рд┐рд╢реНрд╡рд╛рд╕ рдЦрд╛рддрд╛ рд╣рдорд▓рд╛ рд░реЛрдХрддрд╛ рд╣реИред

[**ired.team рдореЗрдВ рдбреЛрдореЗрди рд╡рд┐рд╢реНрд╡рд╛рд╕ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реАред**](https://ired.team/offensive-security-experiments/active-directory-kerberos-abuse/child-domain-da-to-ea-in-parent-domain)

## AD -> Cloud & Cloud -> AD

{% embed url="https://cloud.hacktricks.xyz/pentesting-cloud/azure-security/az-lateral-movements/azure-ad-connect-hybrid-identity" %}

## рдХреБрдЫ рд╕рд╛рдорд╛рдиреНрдп рд╕реБрд░рдХреНрд╖рд╛ рдЙрдкрд╛рдп

[**рдпрд╣рд╛рдВ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдХреА рд╕реБрд░рдХреНрд╖рд╛ рдХреИрд╕реЗ рдХрд░реЗрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдиреЗрдВред**](../stealing-credentials/credentials-protections.md)\
**рдХреГрдкрдпрд╛, рддрдХрдиреАрдХ рдХреА
