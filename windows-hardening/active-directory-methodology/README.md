# Active Directory Methodology

<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a> <strong>рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдЕрдЧрд░ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА HackTricks рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд рд╣реЛ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕ рджреЗрдЦреЗрдВ**](https://github.com/sponsors/carlospolop)!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣ред
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@carlospolopm**](https://twitter.com/hacktricks\_live)\*\* рдкрд░ рдлреЙрд▓реЛ\*\* рдХрд░реЗрдВред
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВред

</details>

## рдореМрд▓рд┐рдХ рдЕрд╡рд▓реЛрдХрди

**рдПрдХреНрдЯрд┐рд╡ рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА** рдПрдХ рдореМрд▓рд┐рдХ рдкреНрд░реМрджреНрдпреЛрдЧрд┐рдХреА рдХреЗ рд░реВрдк рдореЗрдВ рдХрд╛рдо рдХрд░рддреА рд╣реИ, рдЬрд┐рд╕рд╕реЗ **рдиреЗрдЯрд╡рд░реНрдХ рдкреНрд░рд╢рд╛рд╕рдХ** рдиреЗрдЯрд╡рд░реНрдХ рдореЗрдВ **рдбреЛрдореЗрди**, **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛**, рдФрд░ \*\*рдСрдмреНрдЬ

```bash
./kerbrute_linux_amd64 userenum -d lab.ropnop.com --dc 10.10.10.10 usernames.txt #From https://github.com/ropnop/kerbrute/releases

nmap -p 88 --script=krb5-enum-users --script-args="krb5-enum-users.realm='DOMAIN'" <IP>
Nmap -p 88 --script=krb5-enum-users --script-args krb5-enum-users.realm='<domain>',userdb=/root/Desktop/usernames.txt <IP>

msf> use auxiliary/gather/kerberos_enumusers

crackmapexec smb dominio.es  -u '' -p '' --users | awk '{print $4}' | uniq
```

* **OWA (Outlook Web Access) рд╕рд░реНрд╡рд░**

рдЕрдЧрд░ рдЖрдк рдиреЗрдЯрд╡рд░реНрдХ рдореЗрдВ рдЗрди рд╕рд░реНрд╡рд░реЛрдВ рдореЗрдВ рд╕реЗ рдПрдХ рдкрд╛рддреЗ рд╣реИрдВ рддреЛ рдЖрдк рдЗрд╕рдХреЗ рдЦрд┐рд▓рд╛рдл **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЧрдгрдирд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**ред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЖрдк [**MailSniper**](https://github.com/dafthack/MailSniper) рдЯреВрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

```bash
ipmo C:\Tools\MailSniper\MailSniper.ps1
# Get info about the domain
Invoke-DomainHarvestOWA -ExchHostname [ip]
# Enumerate valid users from a list of potential usernames
Invoke-UsernameHarvestOWA -ExchHostname [ip] -Domain [domain] -UserList .\possible-usernames.txt -OutFile valid.txt
# Password spraying
Invoke-PasswordSprayOWA -ExchHostname [ip] -UserList .\valid.txt -Password Summer2021
# Get addresses list from the compromised mail
Get-GlobalAddressList -ExchHostname [ip] -UserName [domain]\[username] -Password Summer2021 -OutFile gal.txt
```

{% hint style="warning" %}
рдЖрдк [**рдЗрд╕ github рд░реЗрдкреЛ**](https://github.com/danielmiessler/SecLists/tree/master/Usernames/Names) рдФрд░ рдЗрд╕ рдПрдХ ([**рдЖрдВрдХрдбрд╝реЗ рдХреЗ рдЕрдиреБрд╕рд╛рд░ рд╕рдВрднрд╛рд╡рд┐рдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо**](https://github.com/insidetrust/statistically-likely-usernames)) рдореЗрдВ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдореЛрдВ рдХреА рд╕реВрдЪрд┐рдпрд╛рдБ рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВред

рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЖрдкрдХреЛ **рдХрдВрдкрдиреА рдореЗрдВ рдХрд╛рдо рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рд▓реЛрдЧреЛрдВ рдХреЗ рдирд╛рдо** рдХрд╛ рдкрддрд╛ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП рдЬреЛ рдЖрдкрдиреЗ рдЗрд╕рд╕реЗ рдкрд╣рд▓реЗ рдХрд┐рдпрд╛ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред рдирд╛рдо рдФрд░ рдЙрдкрдирд╛рдо рдХреЗ рд╕рд╛рде рдЖрдк [**namemash.py**](https://gist.github.com/superkojiman/11076951) рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╕рдВрднрд╛рд╡рд┐рдд рдорд╛рдиреНрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо рдЙрддреНрдкрдиреНрди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
{% endhint %}

### рдПрдХ рдпрд╛ рдХрдИ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдореЛрдВ рдХреЛ рдЬрд╛рдирдирд╛

рдареАрдХ рд╣реИ, рддреЛ рдЖрдкрдХреЛ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдПрдХ рдорд╛рдиреНрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо рдкрддрд╛ рд╣реИ рд▓реЗрдХрд┐рди рдХреЛрдИ рдкрд╛рд╕рд╡рд░реНрдб рдирд╣реАрдВ рд╣реИ... рддреЛ рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдВ:

* [**ASREPRoast**](asreproast.md): рдпрджрд┐ рдХрд┐рд╕реА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдкрд╛рд╕ рд╡рд┐рд╢реЗрд╖рддрд╛ _DONT\_REQ\_PREAUTH_ рдирд╣реАрдВ рд╣реИ, рддреЛ рдЖрдк рдЙрд╕ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд▓рд┐рдП рдПрдХ AS\_REP рд╕рдВрджреЗрд╢ рдХрд╛ рдЕрдиреБрд░реЛрдз рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рдЙрд╕ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдкрд╛рд╕рд╡рд░реНрдб рдХреЗ рдПрдХ рд╡рд┐рдХрд▓реНрдк рд╕реЗ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд┐рдП рдЧрдП рдХреБрдЫ рдбреЗрдЯрд╛ рд╢рд╛рдорд┐рд▓ рдХрд░реЗрдЧрд╛ред
* [**рдкрд╛рд╕рд╡рд░реНрдб рд╕реНрдкреНрд░реЗрдЗрдВрдЧ**](password-spraying.md): рд╕рдмрд╕реЗ **рд╕рд╛рдорд╛рдиреНрдп рдкрд╛рд╕рд╡рд░реНрдб** рдХреЛ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВ рдкреНрд░рддреНрдпреЗрдХ рдЦреЛрдЬреЗ рдЧрдП рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рд╕рд╛рде, рд╢рд╛рдпрдж рдХреЛрдИ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдПрдХ рдмреБрд░рд╛ рдкрд╛рд╕рд╡рд░реНрдб рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣рд╛ рд╣реЛ (рдзреНрдпрд╛рди рд░рдЦреЗрдВ рдкрд╛рд╕рд╡рд░реНрдб рдиреАрддрд┐ рдХреЛ!)ред
* рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдЖрдк рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рдореЗрд▓ рд╕рд░реНрд╡рд░ рдореЗрдВ рдкрд╣реБрдВрдЪрдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рднреА **OWA рд╕рд░реНрд╡рд░реЛрдВ рдХреЛ рд╕реНрдкреНрд░реЗ** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

{% content-ref url="password-spraying.md" %}
[password-spraying.md](password-spraying.md)
{% endcontent-ref %}

### LLMNR/NBT-NS Poisoning

рдЖрдк **рдиреЗрдЯрд╡рд░реНрдХ** рдХреЗ рдХреБрдЫ рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдХреЛ **рдкреЙрдЗрдЬрди рдХрд░рдХреЗ** рдХреБрдЫ рдЪреБрдиреМрддреА **рд╣реИрд╢** рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд┐рдиреНрд╣реЗрдВ рдХреНрд░реИрдХ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП:

{% content-ref url="../../generic-methodologies-and-resources/pentesting-network/spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md" %}
[spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md](../../generic-methodologies-and-resources/pentesting-network/spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md)
{% endcontent-ref %}

### NTML Relay

рдпрджрд┐ рдЖрдкрдиреЗ рд╕рдХреНрд░рд┐рдп рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХреА рдЬрд╛рдВрдЪ рдХрд░рдиреЗ рдореЗрдВ рд╕рдлрд▓рддрд╛ рдкреНрд░рд╛рдкреНрдд рдХреА рд╣реИ рддреЛ рдЖрдкрдХреЗ рдкрд╛рд╕ **рдЕрдзрд┐рдХ рдИрдореЗрд▓ рдФрд░ рдиреЗрдЯрд╡рд░реНрдХ рдХреА рдмреЗрд╣рддрд░ рд╕рдордЭ** рд╣реЛрдЧреАред рдЖрдк \*\*NTML [**рд░рд┐рд▓реЗ рд╣рдорд▓реЗ**](../../generic-methodologies-and-resources/pentesting-network/spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md#relay-attack) рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдХреНрд╖рдо рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рдЖрдк AD рдПрдирд╡рд╛рдпрд░рдирдореЗрдВ рдкрд╣реБрдВрдЪ рд╕рдХреЗрдВред

### NTLM Creds рдЪреБрд░рд╛рдирд╛

рдпрджрд┐ рдЖрдк **рдЕрдиреНрдп рдкреАрд╕реА рдпрд╛ рд╢реЗрдпрд░** рддрдХ рдкрд╣реБрдВрдЪ рд╕рдХрддреЗ рд╣реИрдВ **рд╢реВрдиреНрдп рдпрд╛ рдореЗрд╣рдорд╛рди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛** рдХреЗ рд╕рд╛рде, рддреЛ рдЖрдк рдлрд╝рд╛рдЗрд▓реЗрдВ рдбрд╛рд▓ рд╕рдХрддреЗ рд╣реИрдВ (рдЬреИрд╕реЗ рдПрдХ SCF рдлрд╝рд╛рдЗрд▓) рдЬреЛ рдпрджрд┐ рдХрд┐рд╕реА рдкреНрд░рдХрд╛рд░ рд╕реЗ рдПрдХреНрд╕реЗрд╕ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рддреЛ рд╡рд╣ рдЖрдкрдХреЗ рдЦрд┐рд▓рд╛рдл рдПрдХ NTML рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЛ **рдЯреНрд░рд┐рдЧрд░** рдХрд░реЗрдЧрд╛ рддрд╛рдХрд┐ рдЖрдк рдЙрд╕реЗ **рдЪреБрд░рд╛** рд╕рдХреЗрдВ рдФрд░ **NTLM рдЪреБрдиреМрддреА** рдХреЛ рдХреНрд░реИрдХ рдХрд░ рд╕рдХреЗрдВ:

{% content-ref url="../ntlm/places-to-steal-ntlm-creds.md" %}
[places-to-steal-ntlm-creds.md](../ntlm/places-to-steal-ntlm-creds.md)
{% endcontent-ref %}

## рд╕рдХреНрд░рд┐рдп рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХреА рдЧрдгрдирд╛ рд╕рд╣ рд╕рд╛рдХреНрд╖рд╛рддреНрдХрд╛рд░/рд╕рддреНрд░

рдЗрд╕ рдЪрд░рдг рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ **рдорд╛рдиреНрдп рдбреЛрдореЗрди рдЦрд╛рддреЗ рдХреЗ рдкреНрд░рдорд╛рдг рдкрддреНрд░ рдпрд╛ рд╕рддреНрд░ рдХрд╛ рд╕рдВрдХреНрд╖рд┐рдкреНрдд рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред** рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдХреБрдЫ рдорд╛рдиреНрдп рдкреНрд░рдорд╛рдг рдкрддреНрд░ рд╣реИрдВ рдпрд╛ рдПрдХ рдбреЛрдореЗрди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд░реВрдк рдореЗрдВ рдПрдХ рд╢реИрд▓реА рд╣реИ, **рддреЛ рдЖрдкрдХреЛ рдпрд╛рдж рд░рдЦрдирд╛ рдЪрд╛рд╣рд┐рдП рдХрд┐ рдкрд╣рд▓реЗ рджрд┐рдП рдЧрдП рд╡рд┐рдХрд▓реНрдк рдЕрдм рднреА рдЕрдиреНрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рд╕рдВрдХреНрд░рдорд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╡рд┐рдХрд▓реНрдк рд╣реИрдВ**ред

рдкреНрд░рдорд╛рдгреАрдХреГрдд рдЧрдгрдирд╛ рд╢реБрд░реВ рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдЖрдкрдХреЛ рдпрд╣ рдЬрд╛рдирдирд╛ рдЪрд╛рд╣рд┐рдП рдХрд┐ **рдХрд░реНрдмреЗрд░реЛрд╕ рдбрдмрд▓ рд╣реЙрдк рд╕рдорд╕реНрдпрд╛ рдХреНрдпрд╛ рд╣реИред**

{% content-ref url="kerberos-double-hop-problem.md" %}
[kerberos-double-hop-problem.md](kerberos-double-hop-problem.md)
{% endcontent-ref %}

### рдЧрдгрдирд╛

рдПрдХ рдЦрд╛рддреЗ рдХреЛ рд╕рдВрдХреНрд░рдорд┐рдд рдХрд░рдирд╛ рдПрдХ **рдмрдбрд╝рд╛ рдХрджрдо рд╣реИ рдкреВрд░реЗ рдбреЛрдореЗрди рдХреЛ рд╕рдВрдХреНрд░рдорд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП**, рдХреНрдпреЛрдВрдХрд┐ рдЖрдк **рд╕рдХреНрд░рд┐рдп рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдЧрдгрдирд╛ рд╢реБрд░реВ рдХрд░ рд╕рдХреЗрдВрдЧреЗ:**

[**ASREPRoast**](asreproast.md) рдХреЗ рд╕рдВрджрд░реНрдн рдореЗрдВ рдЕрдм рдЖрдк рд╣рд░ рд╕рдВрднрд╛рд╡рд┐рдд рд╡рдВрд╢рд╛рд╡рд▓реА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ, рдФрд░ [**рдкрд╛рд╕рд╡рд░реНрдб рд╕реНрдкреНрд░реЗрдЗрдВрдЧ**](password-spraying.md) рдХреЗ рд╕рдВрджрд░реНрдн рдореЗрдВ рдЖрдк **рд╕рднреА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдореЛрдВ рдХреА рд╕реВрдЪреА** рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рд╕рдВрдХреНрд░рдорд┐рдд рдЦрд╛рддреЗ рдХрд╛ рдкрд╛рд╕рд╡рд░реНрдб, рдЦрд╛рд▓реА рдкрд╛рд╕рд╡рд░реНрдб рдФрд░ рдирдП рдЙрдореНрдореАрджрд╡рд╛рд░ рдкрд╛рд╕рд╡рд░реНрдб рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

* рдЖрдк [**рдмреБрдирд┐рдпрд╛рджреА рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП CMD рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**](../basic-cmd-for-pentesters.md#domain-info)
* рдЖрдк [**рдкрд╛рд╡рд░рд╢реЗрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд╛рдВрдЪ рдХреЗ рд▓рд┐рдП**](../basic-powershell-for-pentesters/) рдЬреЛ рдЧреБрдкреНрддрдЪрд░ рд╣реЛрдЧрд╛
* рдЖрдк [**рдкрд╛рд╡рд░рд╡реНрдпреВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**](../basic-powershell-for-pentesters/powerview.md) рдЕрдзрд┐рдХ рд╡рд┐рд╕реНрддреГрдд рдЬрд╛рдирдХрд╛рд░реА рдирд┐рдХрд╛рд▓рдиреЗ рдХреЗ рд▓рд┐рдП
* рдПрдХ рдФрд░ рдЕрджреНрднреБрдд рдЙрдкрдХрд░рдг рд╕рдХреНрд░рд┐рдп рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдореЗрдВ рдЬрд╛рдВрдЪ рдХреЗ рд▓рд┐рдП рд╣реИ [**BloodHound**](bloodhound.md)ред рдпрд╣ **рдмрд╣реБрдд рдЧреБрдкреНрддрдЪрд░ рдирд╣реАрдВ рд╣реИ** (рдЖрдкрдХреЗ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЧрдП рд╕рдВрдЧреНрд░рд╣рдг рд╡рд┐рдзрд┐рдпреЛрдВ рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддрд╛ рд╣реИ), рд▓реЗрдХрд┐рди **рдпрджрд┐ рдЖрдкрдХреЛ рдкрд░рд╡рд╛рд╣ рдирд╣реАрдВ рд╣реИ** рддреЛ рдЖрдкрдХреЛ рдЗрд╕реЗ рдПрдХ рдмрд╛рд░ рдЬрд░реВрд░ рджреЗрдирд╛ рдЪрд╛рд╣рд┐рдПред рдпрд╣рд╛рдБ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХрд╣рд╛рдВ RDP рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЕрдиреНрдп рд╕рдореВрд╣реЛрдВ рдХреЗ рд▓рд┐рдП рдкрде рдЦреЛрдЬреЗрдВ, рдЖрджрд┐ред
* **рдЕрдиреНрдп рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдПрдбреА рдЧрдгрдирд╛ рдЙрдкрдХрд░рдг рд╣реИрдВ:** [**AD Explorer**](bloodhound.md#ad-explorer)**,** [**ADRecon**](bloodhound.md#adrecon)**,** [**Group3r**](bloodhound.md#group3r)**,** [**PingCastle**](bloodhound.md#pingcastle)**.**
* [**AD рдХреЗ DNS рд░рд┐рдХреЙрд░реНрдб**](ad-dns-records.md) рдХреНрдпреЛрдВрдХрд┐ рд╡реЗ рджрд┐рд▓рдЪрд╕реНрдк рдЬрд╛рдирдХрд╛рд░реА рд╢рд╛рдорд┐рд▓ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
* рдПрдХ **GUI рдЙрдкрдХрд░рдг** рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдЖрдк рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХреА рдЧрдгрдирд╛ рдХреЗ рд▓рд┐рдП рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ **AdExplorer.exe** рд╕реЗ **SysInternal** рд╕реБрдЗрдЯ рд╕реЗред
* рдЖрдк рдлрд╝реАрд▓реНрдб _userPassword_ рдФрд░ _unixUserPassword_ рдореЗрдВ рдкреНрд░рдорд╛рдг рдкрддреНрд░ рдЦреЛрдЬрдиреЗ рдХреЗ рд▓рд┐рдП **ldapsearch** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдпрд╛ рдпрд╣рд╛рдБ рддрдХ рдХрд┐ _Description_ рдХреЗ рд▓рд┐рдПред cf. [PayloadsAllTheThings рдкрд░ AD рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЯрд┐рдкреНрдкрдгреА рдореЗрдВ рдкрд╛рд╕рд╡рд░реНрдб](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Active%20Directory%20Attack.md#password-in-ad-user-comment) рдЕрдиреНрдп рд╡рд┐рдзрд┐рдпреЛрдВ рдХреЗ рд▓рд┐рдПред
* рдпрджрд┐ рдЖрдк **Linux** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣реЗ рд╣реИрдВ, рддреЛ рдЖрдк [**pywerview**](https://github.com/the-useless-one/pywerview) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдбреЛрдореЗрди рдХреА рдЧрдгрдирд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
* рдЖрдк рдСрдЯреЛрдореЗрдЯреЗрдб рдЙрдкрдХрд░рдгреЛрдВ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬреИрд╕реЗ:
* [**tomcarver16/ADSearch**](https://github.com/tomcarver16/ADSearch)
* [**61106960/adPEAS**](https://github.com/61106960/adPEAS)
* **рд╕рднреА рдбреЛрдореЗрди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рдирд┐рдХрд╛рд▓рдирд╛**

Windows рд╕реЗ рд╕рднреА рдбреЛрдореЗрди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо рдЖрд╕рд╛рди рд╣реИ (`net user /domain`, `Get-DomainUser` рдпрд╛ `wmic useraccount get name,sid`)ред Linux рдореЗрдВ, рдЖрдк рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ: `GetADUsers.py -all -dc-ip 10.10.10.110 domain.com/username` рдпрд╛ `enum4linux -a -u "user" -p "password" <DC IP>`

> рдпрджрд┐ рдпрд╣ рдЧрдгрдирд╛ рдЦрдВрдб рдЫреЛрдЯрд╛ рд▓рдЧ рд░рд╣рд╛ рд╣реИ рддреЛ рдпрд╣ рд╕рднреА рдХрд╛ рд╕рдмрд╕реЗ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣рд┐рд╕реНрд╕рд╛ рд╣реИред рд▓рд┐рдВрдХ

```bash
## List all tickets (if not admin, only current user tickets)
.\Rubeus.exe triage
## Dump the interesting one by luid
.\Rubeus.exe dump /service:krbtgt /luid:<luid> /nowrap
[IO.File]::WriteAllBytes("ticket.kirbi", [Convert]::FromBase64String("<BASE64_TICKET>"))
```

### NTML Relay

рдпрджрд┐ рдЖрдкрдиреЗ рд╕рдХреНрд░рд┐рдп рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХреА рдЬрд╛рдВрдЪ рдХрд░рдиреЗ рдореЗрдВ рд╕рдлрд▓рддрд╛ рдкреНрд░рд╛рдкреНрдд рдХреА рд╣реИ, рддреЛ рдЖрдкрдХреЗ рдкрд╛рд╕ **рдЕрдзрд┐рдХ рдИрдореЗрд▓ рдФрд░ рдиреЗрдЯрд╡рд░реНрдХ рдХреА рдмреЗрд╣рддрд░ рд╕рдордЭ** рд╣реЛрдЧреАред рдЖрдк **NTML рд░рд┐рд▓реЗ рд╣рдорд▓реЗ** рдХреЛ рдмрд▓рдкреВрд░реНрд╡рдХ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

### **рдХрдВрдкреНрдпреВрдЯрд░ рд╢реЗрдпрд░ рдореЗрдВ Creds рдЦреЛрдЬреЗрдВ**

рдЕрдм рдЬрдм рдЖрдкрдХреЗ рдкрд╛рд╕ рдХреБрдЫ рдореМрд▓рд┐рдХ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рд╣реИрдВ, рддреЛ рдЖрдкрдХреЛ рдпрд╣ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рд┐рдП рдХрд┐ рдХреНрдпрд╛ рдЖрдк **рдПрдХреНрдЯрд┐рд╡ рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА рдХреЗ рдЕрдВрджрд░ рд╕рд╛рдЭрд╛ рдХрд┐рдП рдЧрдП рдХрд┐рд╕реА рднреА рджрд┐рд▓рдЪрд╕реНрдк рдлрд╝рд╛рдЗрд▓реНрд╕** рдХреЛ рдЦреЛрдЬ рд╕рдХрддреЗ рд╣реИрдВред рдЖрдк рдЗрд╕реЗ рдореИрдиреНрдпреБрдЕрд▓ рд░реВрдк рд╕реЗ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдпрд╣ рдПрдХ рдмрд╣реБрдд рд╣реА рдЙрдХреНрддрд┐рд╢реАрд▓ рдФрд░ рджреЛрд╣рд░рд╛рд╡рдкреВрд░реНрдг рдХрд╛рд░реНрдп рд╣реИ (рдФрд░ рдЕрдЧрд░ рдЖрдк рд╕реИрдХрдбрд╝реЛрдВ рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рдкрд╛рддреЗ рд╣реИрдВ рддреЛ рдЖрдкрдХреЛ рдЬрд╛рдВрдЪрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ)ред

[**рдЗрд╕ рд▓рд┐рдВрдХ рдкрд░ рдЬрд╛рдПрдВ рдФрд░ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдЙрдкрдХрд░рдгреЛрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдиреЗрдВред**](../../network-services-pentesting/pentesting-smb/#domain-shared-folders-search)

### NTLM Creds рдЪреБрд░рд╛рдПрдВ

рдпрджрд┐ рдЖрдк **рдЕрдиреНрдп рдкреАрд╕реА рдпрд╛ рд╢реЗрдпрд░ рддрдХ рдкрд╣реБрдВрдЪ рд╕рдХрддреЗ рд╣реИрдВ**, рддреЛ рдЖрдк **рдлрд╝рд╛рдЗрд▓реЗрдВ рд░рдЦ рд╕рдХрддреЗ рд╣реИрдВ** (рдЬреИрд╕реЗ рдПрдХ SCF рдлрд╝рд╛рдЗрд▓) рдЬреЛ рдпрджрд┐ рдХрд┐рд╕реА рдкреНрд░рдХрд╛рд░ рд╕реЗ рдПрдХреНрд╕реЗрд╕ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ рддреЛ рд╡рд╣ рдЖрдкрдХреЗ рдЦрд┐рд▓рд╛рдл **NTML рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЛ рдЯреНрд░рд┐рдЧрд░** рдХрд░реЗрдЧрд╛ рддрд╛рдХрд┐ рдЖрдк рдЗрд╕реЗ **рдЪреБрд░рд╛** рд╕рдХреЗрдВ рдФрд░ рдЗрд╕реЗ рдХреНрд░реИрдХ рдХрд░ рд╕рдХреЗрдВ:

{% content-ref url="../ntlm/places-to-steal-ntlm-creds.md" %}
[places-to-steal-ntlm-creds.md](../ntlm/places-to-steal-ntlm-creds.md)
{% endcontent-ref %}

### CVE-2021-1675/CVE-2021-34527 PrintNightmare

рдЗрд╕ рд╕реБрд░рдХреНрд╖рд╛ рдЧрдбрд╝рдмрдбрд╝реА рдиреЗ рдХрд┐рд╕реА рднреА рдкреНрд░рдорд╛рдгрд┐рдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ **рдбреЛрдореЗрди рдирд┐рдпрдВрддреНрд░рдХ рдХреЛ рдХрдВрдкреНрд░рдорд╛рдЗрдЬ** рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреАред

{% content-ref url="printnightmare.md" %}
[printnightmare.md](printnightmare.md)
{% endcontent-ref %}

## рдПрдХреНрдЯрд┐рд╡ рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА рдкрд░ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдЙрдиреНрдирддрд┐ рд╕реЗ рдЙрдиреНрдирддрд┐

**рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рддрдХрдиреАрдХреЛрдВ рдХреЗ рд▓рд┐рдП рдПрдХ рд╕рд╛рдзрд╛рд░рдг рдбреЛрдореЗрди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкрд░реНрдпрд╛рдкреНрдд рдирд╣реАрдВ рд╣реИ, рдЖрдкрдХреЛ рдЗрди рд╣рдорд▓реЛрдВ рдХреЛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреБрдЫ рд╡рд┐рд╢реЗрд╖ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░/рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред**

### рд╣реИрд╢ рдирд┐рдХрд╛рд▓рдирд╛

рдЖрд╢рд╛ рд╣реИ рдХрд┐ рдЖрдкрдиреЗ рдХреБрдЫ рд╕реНрдерд╛рдиреАрдп рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рдЦрд╛рддреЗ рдХреЛ **рдХрдВрдкреНрд░рдорд╛рдЗрдЬ** рдХрд░рдиреЗ рдореЗрдВ рд╕рдлрд▓рддрд╛ рдкреНрд░рд╛рдкреНрдд рдХреА рд╣реИ [AsRepRoast](asreproast.md), [Password Spraying](password-spraying.md), [Kerberoast](kerberoast.md), [Responder](../../generic-methodologies-and-resources/pentesting-network/spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md) рдЬрд┐рд╕рдореЗрдВ рд░рд┐рд▓реЗ рд╣реЛрддрд╛ рд╣реИ, [EvilSSDP](../../generic-methodologies-and-resources/pentesting-network/spoofing-ssdp-and-upnp-devices.md), [рд╕реНрдерд╛рдиреАрдп рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЛ рдЙрдиреНрдирдд рдХрд░рдирд╛](../windows-local-privilege-escalation/)ред\
рдлрд┐рд░, рдпрд╣ рд╕рдордп рд╣реИ рдХрд┐ рдЖрдк рд╕рднреА рд╣реИрд╢реЛрдВ рдХреЛ рдореЗрдореЛрд░реА рдФрд░ рд╕реНрдерд╛рдиреАрдп рд░реВрдк рд╕реЗ рдбрдВрдк рдХрд░реЗрдВред\
[**рдЗрди рд╣реИрд╢ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд╡рд┐рднрд┐рдиреНрди рддрд░реАрдХреЛрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЗрд╕ рдкреГрд╖реНрда рдХреЛ рдкрдврд╝реЗрдВред**](https://github.com/carlospolop/hacktricks/blob/in/windows-hardening/active-directory-methodology/broken-reference/README.md)

### рд╣реИрд╢ рдкрд╛рд╕ рдХрд░реЗрдВ

**рдЬрдм рдЖрдкрдХреЗ рдкрд╛рд╕ рдХрд┐рд╕реА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХрд╛ рд╣реИрд╢ рд╣реЛрддрд╛ рд╣реИ**, рддреЛ рдЖрдк рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдЙрд╕рдХреА **рдЕрдиреБрдХрд░рдг** рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред\
рдЖрдкрдХреЛ рдХрд┐рд╕реА **рдЙрдкрдХрд░рдг** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ рдЬреЛ рдЙрд╕ **рд╣реИрд╢** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ **NTLM рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХрд░реЗрдЧрд╛**, **рдпрд╛** рдЖрдк рдПрдХ рдирдпрд╛ **рд╕рддреНрд░рд▓реЙрдЧрдСрди** рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЙрд╕ **рд╣реИрд╢** рдХреЛ **LSASS** рдХреЗ рдЕрдВрджрд░ рдЗрдВрдЬреЗрдХреНрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рддрд╛рдХрд┐ рдЬрдм рдХреЛрдИ **NTLM рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ**, рддреЛ рдЙрд╕ **рд╣реИрд╢** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред рдЖрдЦрд┐рд░реА рд╡рд┐рдХрд▓реНрдк рд╣реИ рдЬрд┐рд╕реЗ mimikatz рдХрд░рддрд╛ рд╣реИред\
[**рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рдЗрд╕ рдкреГрд╖реНрда рдХреЛ рдкрдврд╝реЗрдВред**](../ntlm/#pass-the-hash)

### рд╣реИрд╢ рдкрд╛рд╕ рдХрд░рдиреЗ рдХреЗ рдКрдкрд░/рдХреБрдВрдЬреА рдкрд╛рд╕ рдХрд░рдирд╛

рдпрд╣ рд╣рдорд▓рд╛ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ NTLM рд╣реИрд╢ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХрд░реНрдмреЗрд░реЛрд╕ рдЯрд┐рдХрдЯреЗрдВ рдЕрдиреБрд░реЛрдз рдХрд░рдиреЗ рдХрд╛ рдЙрджреНрджреЗрд╢реНрдп рд░рдЦрддрд╛ рд╣реИ**, рд╕рд╛рдорд╛рдиреНрдп Pass The Hash рдХреЗ рдКрдкрд░ NTLM рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдореЗрдВред рдЗрд╕рд▓рд┐рдП, рдпрд╣ рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ **рдЙрдкрдпреЛрдЧреА рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рдЬрд╣рд╛рдВ NTLM рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдирд┐рд╖реЗрдзрд┐рдд рд╣реИ** рдФрд░ рдХреЗрд╡рд▓ **рдХрд░реНрдмреЗрд░реЛрд╕ рдХреЛ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдХреЗ рд░реВрдк рдореЗрдВ рдЕрдиреБрдорддрд┐ рд╣реИ**ред

{% content-ref url="over-pass-the-hash-pass-the-key.md" %}
[over-pass-the-hash-pass-the-key.md](over-pass-the-hash-pass-the-key.md)
{% endcontent-ref %}

### рдЯрд┐рдХрдЯ рдкрд╛рд╕ рдХрд░реЗрдВ

**рдкрд╛рд╕ рдж рдЯрд┐рдХрдЯ (PTT)** рд╣рдорд▓рд╛ рд╡рд┐рдзрд┐ рдореЗрдВ, рд╣рдорд▓рд╛рд╡рд░ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХрд╛ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдЯрд┐рдХрдЯ рдЪреБрд░рд╛рддреЗ рд╣реИрдВ** рдЙрдирдХреЗ рдкрд╛рд╕рд╡рд░реНрдб рдпрд╛ рд╣реИрд╢ рдорд╛рдиреЛрдВ рдХреЗ рдмрдЬрд╛рдпред рдпрд╣ рдЪреЛрд░реА рдЧрдИ рдЯрд┐рдХрдЯ рдлрд┐рд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХрд╛ рдЕрдиреБрдХрд░рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдиреЗрдЯрд╡рд░реНрдХ рдХреЗ рднреАрддрд░ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдФрд░ рд╕реЗрд╡рд╛рдУрдВ рддрдХ рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ рдкреНрд░рд╛рдкреНрдд рд╣реЛрддреА рд╣реИред

{% content-ref url="pass-the-ticket.md" %}
[pass-the-ticket.md](pass-the-ticket.md)
{% endcontent-ref %}

### рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдкреБрдирдГ рдЙрдкрдпреЛрдЧ

рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ **рд╣реИрд╢** рдпрд╛ **рд╕реНрдерд╛рдиреАрдп рдкреНрд░рд╢рд╛рд╕рдХ** рдХрд╛ **рдкрд╛рд╕рд╡рд░реНрдб** рд╣реИ, рддреЛ рдЖрдкрдХреЛ рдЗрд╕рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП рдХрд┐ рдЖрдк рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЕрдиреНрдп **рдкреАрд╕реА** рдореЗрдВ рд╕реНрдерд╛рдиреАрдп рд░реВрдк рд╕реЗ **рд▓реЙрдЧрд┐рди** рдХрд░реЗрдВред

```bash
# Local Auth Spray (once you found some local admin pass or hash)
## --local-auth flag indicate to only try 1 time per machine
crackmapexec smb --local-auth 10.10.10.10/23 -u administrator -H 10298e182387f9cab376ecd08491764a0 | grep +
```

{% hint style="warning" %}
рдХреГрдкрдпрд╛ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдпрд╣ рдХрд╛рдлреА **рд╢реЛрд░** рдХрд░рдиреЗ рд╡рд╛рд▓рд╛ рд╣реИ рдФрд░ **LAPS** рдЗрд╕реЗ **рдХрдо** рдХрд░ рд╕рдХрддрд╛ рд╣реИред
{% endhint %}

### MSSQL рджреБрд░реБрдкрдпреЛрдЧ рдФрд░ рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рд▓рд┐рдВрдХ

рдпрджрд┐ рдХрд┐рд╕реА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ **MSSQL рдЗрдВрд╕реНрдЯреЗрдВрд╕реЗрд╕ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ** рдХреА рдЕрдиреБрдорддрд┐ рд╣реИ, рддреЛ рдЙрд╕реЗ рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ MSSQL рд╣реЛрд╕реНрдЯ рдореЗрдВ (рдпрджрд┐ SA рдХреЗ рд░реВрдк рдореЗрдВ рдЪрд▓ рд░рд╣рд╛ рд╣реИ) **рдХрдорд╛рдВрдбреНрд╕ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд** рдХрд░рдиреЗ, NetNTLM **рд╣реИрд╢** рдЪреБрд░рд╛ рд▓реЗрдиреЗ рдпрд╛ рдпрд╣рд╛рдВ рддрдХ рдХрд┐ рдПрдХ **рд░рд┐рд▓реЗ** **рд╣рдорд▓рд╛** рднреА рдХрд░ рд╕рдХрддрд╛ рд╣реИред\
рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдпрджрд┐ рдПрдХ MSSQL рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдПрдХ рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рд╣реИ (рдбреЗрдЯрд╛рдмреЗрд╕ рд▓рд┐рдВрдХ) рдПрдХ рд╡рд┐рднрд┐рдиреНрди MSSQL рдЗрдВрд╕реНрдЯреЗрдВрд╕ рджреНрд╡рд╛рд░рд╛ред рдпрджрд┐ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рдбреЗрдЯрд╛рдмреЗрд╕ рдкрд░ рдЕрдзрд┐рдХрд╛рд░ рд╣реИ, рддреЛ рдЙрд╕реЗ рджреВрд╕рд░реЗ рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдореЗрдВ рднреА рдХреНрд╡реЗрд░реА рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд╣реЛрдЧреАред рдпреЗ рд╡рд┐рд╢реНрд╡рд╛рд╕ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреЗ рд╣реИрдВ рдФрд░ рдХрд┐рд╕реА рдмрд┐рдЧрдбрд╝реА рд╣реБрдИ рдбреЗрдЯрд╛рдмреЗрд╕ рдХреЛ рдвреВрдВрдврдиреЗ рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рд╣реИ рдЬрд╣рд╛рдВ рдЙрд╕реЗ рдХрдорд╛рдВрдбреНрд╕ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд╣реЛ рд╕рдХрддреА рд╣реИред\
\*\*рдбреЗрдЯрд╛рдм

```
Get-DomainTrust

SourceName      : sub.domain.local    --> current domain
TargetName      : domain.local        --> foreign domain
TrustType       : WINDOWS_ACTIVE_DIRECTORY
TrustAttributes : WITHIN_FOREST       --> WITHIN_FOREST: Both in the same forest
TrustDirection  : Bidirectional       --> Trust direction (2ways in this case)
WhenCreated     : 2/19/2021 1:28:00 PM
WhenChanged     : 2/19/2021 1:28:00 PM
```

{% hint style="warning" %}
рдпрд╣рд╛рдБ **2 рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рдХреБрдВрдЬреА** рд╣реИрдВ, рдПрдХ _Child --> Parent_ рдХреЗ рд▓рд┐рдП рдФрд░ рдПрдХ рджреВрд╕рд░рд╛ _Parent_ --> _Child_ рдХреЗ рд▓рд┐рдПред\
рдЖрдк рд╡рд░реНрддрдорд╛рди рдбреЛрдореЗрди рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХреА рдЧрдИ рдПрдХ рдХреБрдВрдЬреА рдХреЛ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреЗ рд╕рд╛рде рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ:

```bash
Invoke-Mimikatz -Command '"lsadump::trust /patch"' -ComputerName dc.my.domain.local
Invoke-Mimikatz -Command '"lsadump::dcsync /user:dcorp\mcorp$"'
```
{% endhint %}

#### SID-History Injection

рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╡рд┐рд╢реНрд╡рд╛рд╕ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП рдмрдЪреНрдЪрд╛/рдорд╛рддрд╛ рдбреЛрдореЗрди рдХреЛ рдЙрдЪреНрдЪ рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рдХреЗ рд░реВрдк рдореЗрдВ рдЙрдиреНрдирдд рдХрд░реЗрдВ SID-History рдЗрдВрдЬреЗрдХреНрд╢рди:

{% content-ref url="sid-history-injection.md" %}
[sid-history-injection.md](sid-history-injection.md)
{% endcontent-ref %}

#### Exploit writeable Configuration NC

рдХреИрд╕реЗ Configuration Naming Context (NC) рдХрд╛ рд╢реЛрд╖рдг рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЗрд╕реЗ рд╕рдордЭрдирд╛ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИред Configuration NC рдПрдХ рдХреЗрдВрджреНрд░реАрдп рднрдВрдбрд╛рд░ рдХреЗ рд░реВрдк рдореЗрдВ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ рдЬреЛ рдПрдХ рдПрдХреНрдЯрд┐рд╡ рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА (AD) рд╡рд╛рддрд╛рдиреБрдХреВрд▓рди рдореЗрдВ рдПрдХ рд╡рдиреНрдп рд╡рдиреНрдп рдореЗрдВ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдбреЗрдЯрд╛ рдХреЗ рд▓рд┐рдП рд╕реЗрд╡рд╛ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред рдпрд╣ рдбреЗрдЯрд╛ рд╡рдиреНрдп рдореЗрдВ рд╣рд░ рдбреЛрдореЗрди рдХрдВрдЯреНрд░реЛрд▓рд░ (DC) рдХреЛ рдкреБрдирд░реНрд▓реЗрдЦрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рд▓рд┐рдЦрдиреЗ рдпреЛрдЧреНрдп DCs рдПрдХ рд▓рд┐рдЦрдиреЗ рдпреЛрдЧреНрдп рдкреНрд░рддрд┐рд▓рд┐рдкрд┐ рдХреЛ рдмрдирд╛рдП рд░рдЦрддреЗ рд╣реИрдВред рдЗрд╕реЗ рд╢реЛрд╖рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдХрд┐рд╕реА DC рдкрд░ **SYSTEM рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░** рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП, рдмреЗрд╣рддрд░ рд╣реИ рдПрдХ рдмрдЪреНрдЪрд╛ DCред

**рд░реВрдЯ DC рд╕рд╛рдЗрдЯ рдХреЛ GPO рд╕реЗ рд▓рд┐рдВрдХ рдХрд░реЗрдВ**

Configuration NC рдХреЗ рд╕рд╛рдЗрдЯ рдХрдВрдЯреЗрдирд░ рдореЗрдВ рдПрдбреА рдлреЙрд░реЗрд╕реНрдЯ рдХреЗ рд╕рднреА рдбреЛрдореЗрди-рдЬреНрд╡рд╛рдЗрдВрдб рдХрдВрдкреНрдпреВрдЯрд░реНрд╕ рдХреЗ рд╕рд╛рдЗрдЯреНрд╕ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА рд╢рд╛рдорд┐рд▓ рд╣реИред рдХрд┐рд╕реА рднреА DC рдкрд░ SYSTEM рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рддреЗ рд╣реБрдП, рд╣рдорд▓рд╛рд╡рд░ рд░реВрдЯ DC рд╕рд╛рдЗрдЯреНрд╕ рдХреЛ GPO рд╕реЗ рд▓рд┐рдВрдХ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдпрд╣ рдХрд╛рд░реНрд░рд╡рд╛рдИ рд░реВрдЯ рдбреЛрдореЗрди рдХреЛ рдЦрддрд░реЗ рдореЗрдВ рдбрд╛рд▓ рд╕рдХрддреА рд╣реИ рдЬрд┐рд╕реЗ рдЗрди рд╕рд╛рдЗрдЯреНрд╕ рдкрд░ рд▓рд╛рдЧреВ рдиреАрддрд┐рдпреЛрдВ рдХреЛ рд╣рд╛рде рдореЗрдВ рд▓реЗрдХрд░ред

рд╡рд┐рд╕реНрддреГрдд рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП, [Bypassing SID Filtering](https://improsec.com/tech-blog/sid-filter-as-security-boundary-between-domains-part-4-bypass-sid-filtering-research) рдкрд░ рдЕрдиреБрд╕рдВрдзрд╛рди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

**рд╡рдиреНрдп рдореЗрдВ рдХрд┐рд╕реА рднреА gMSA рдХреЛ рдХрдордмрдЦреНрдд рдХрд░реЗрдВ**

рдПрдХ рд╣рдорд▓рд╛ рд╡реЗрдХреНрдЯрд░ рдбреЛрдореЗрди рдХреЗ рднреАрддрд░ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХреГрдд gMSAs рдХреЛ рд▓рдХреНрд╖рд┐рдд рдХрд░рдиреЗ рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реИред KDS рд░реВрдЯ рдХреБрдВрдЬреА, gMSAs рдХреЗ рдкрд╛рд╕рд╡рд░реНрдб рдХреА рдЧрдгрдирд╛ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рд╣реИ, Configuration NC рдХреЗ рдЕрдВрджрд░ рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реИред рдХрд┐рд╕реА рднреА DC рдкрд░ SYSTEM рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╣реЛрдиреЗ рдкрд░, KDS рд░реВрдЯ рдХреБрдВрдЬреА рддрдХ рдкрд╣реБрдВрдЪрдирд╛ рдФрд░ рд╡рдиреНрдп рдореЗрдВ рдХрд┐рд╕реА рднреА gMSA рдХреЗ рдкрд╛рд╕рд╡рд░реНрдб рдХреА рдЧрдгрдирд╛ рд╕рдВрднрд╡ рд╣реИред

рд╡рд┐рд╕реНрддреГрдд рд╡рд┐рд╢реНрд▓реЗрд╖рдг [Golden gMSA Trust Attacks](https://improsec.com/tech-blog/sid-filter-as-security-boundary-between-domains-part-5-golden-gmsa-trust-attack-from-child-to-parent) рдкрд░ рдкрд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

**рд╕реНрдХреАрдорд╛ рдкрд░рд┐рд╡рд░реНрддрди рд╣рдорд▓рд╛**

рдЗрд╕ рд╡рд┐рдзрд┐ рдХреЗ рд▓рд┐рдП рдзреИрд░реНрдп рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рдирдП рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХреГрдд AD рд╡рд╕реНрддреБрдУрдВ рдХреЗ рдирд┐рд░реНрдорд╛рдг рдХрд╛ рдЗрдВрддрдЬрд╛рд░ рдХрд░рдирд╛ред SYSTEM рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЗ рд╕рд╛рде, рд╣рдорд▓рд╛рд╡рд░ рдПрдбреА рд╕реНрдХреАрдорд╛ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ рддрд╛рдХрд┐ рдХрд┐рд╕реА рднреА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рд╕рднреА рд╡рд░реНрдЧреЛрдВ рдкрд░ рдкреВрд░реНрдг рдирд┐рдпрдВрддреНрд░рдг рдкреНрд░рджрд╛рди рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред рдпрд╣ рдирдП рдмрдирд╛рдП рдЧрдП рдПрдбреА рд╡рд╕реНрддреБрдУрдВ рдкрд░ рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ рдФрд░ рдирд┐рдпрдВрддреНрд░рдг рдХрд░рдиреЗ рдХреА рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ рдФрд░ рдирд┐рдпрдВрддреНрд░рдг рдХрд░рдиреЗ рдХреА рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ рдФрд░ рдирд┐рдпрдВрддреНрд░рдг рдХрд░рдиреЗ рдХреА рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ рдФрд░ рдирд┐рдпрдВрддреНрд░рдг рдХрд░рдиреЗ рдХреА рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ рдФрд░ рдирд┐рдпрдВрддреНрд░рдг рдХрд░рдиреЗ рдХреА рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ рдФрд░ рдирд┐рдпрдВрддреНрд░рдг рдХрд░рдиреЗ рдХреА рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ рдФрд░ рдирд┐рдпрдВрддреНрд░рдг рдХрд░рдиреЗ рдХреА рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ рдФрд░ рдирд┐рдпрдВрддреНрд░рдг рдХрд░рдиреЗ рдХреА рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ рдФрд░ рдирд┐рдпрдВрддреНрд░рдг рдХрд░рдиреЗ рдХреА рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ рдФрд░ рдирд┐рдпрдВрддреНрд░рдг рдХрд░рдиреЗ рдХреА рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ рдФрд░ рдирд┐рдпрдВрддреНрд░рдг рдХрд░рдиреЗ рдХреА рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ рдФрд░ рдирд┐рдпрдВрддреНрд░рдг рдХрд░рдиреЗ рдХреА рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ рдФрд░ рдирд┐рдпрдВрддреНрд░рдг рдХрд░рдиреЗ рдХреА рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ рдФрд░ рдирд┐рдпрдВрддреНрд░рдг рдХрд░рдиреЗ рдХреА рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ рдФрд░ рдирд┐рдпрдВрддреНрд░рдг рдХрд░рдиреЗ рдХреА рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ рдФрд░ рдирд┐рдпрдВрддреНрд░рдг рдХрд░рдиреЗ рдХреА рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ рдФрд░ рдирд┐рдпрдВрддреНрд░рдг рдХрд░рдиреЗ рдХреА рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ рдФрд░ рдирд┐рдпрдВрддреНрд░рдг рдХрд░рдиреЗ рдХреА рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ рдФрд░ рдирд┐рдпрдВрддреНрд░рдг рдХрд░рдиреЗ рдХреА рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ рдФрд░ рдирд┐рдпрдВрддреНрд░рдг рдХрд░рдиреЗ рдХреА рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ рдФрд░ рдирд┐рдпрдВрддреНрд░рдг рдХрд░рдиреЗ рдХреА рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ рдФрд░ рдирд┐рдпрдВрддреНрд░рдг рдХрд░рдиреЗ рдХреА рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ рдФрд░ рдирд┐рдпрдВрддреНрд░рдг рдХрд░рдиреЗ рдХреА рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ рдФрд░ рдирд┐рдпрдВрддреНрд░рдг рдХрд░рдиреЗ рдХреА рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ рдФрд░ рдирд┐рдпрдВрддреНрд░рдг рдХрд░рдиреЗ рдХреА рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ рдФрд░ рдирд┐рдпрдВрддреНрд░рдг рдХрд░рдиреЗ рдХреА рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ рдФрд░ рдирд┐рдпрдВрддреНрд░рдг рдХрд░рдиреЗ рдХреА рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ рдФрд░ рдирд┐рдпрдВрддреНрд░рдг рдХрд░рдиреЗ рдХреА рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ рдФрд░ рдирд┐рдпрдВрддреНрд░рдг рдХрд░рдиреЗ рдХреА рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ рдФрд░ рдирд┐рдпрдВрддреНрд░рдг рдХрд░рдиреЗ рдХреА рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ рдФрд░ рдирд┐рдпрдВрддреНрд░рдг рдХрд░рдиреЗ рдХреА рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ рдФрд░ рдирд┐рдпрдВрддреНрд░рдг рдХрд░рдиреЗ рдХреА рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ рдФрд░ рдирд┐рдпрдВрддреНрд░рдг рдХрд░рдиреЗ рдХреА рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ рдФрд░ рдирд┐рдпрдВрддреНрд░рдг рдХрд░рдиреЗ рдХреА рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ рдФрд░ рдирд┐рдпрдВрддреНрд░рдг рдХрд░рдиреЗ рдХреА рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ рдФрд░ рдирд┐рдпрдВрддреНрд░рдг рдХрд░рдиреЗ рдХреА рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ рдФрд░ рдирд┐рдпрдВрддреНрд░рдг рдХрд░рдиреЗ рдХреА рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ рдФрд░ рдирд┐рдпрдВрддреНрд░рдг рдХрд░рдиреЗ рдХреА рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ рдФрд░ рдирд┐рдпрдВрддреНрд░рдг рдХрд░рдиреЗ рдХреА рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ рдФрд░ рдирд┐рдпрдВрддреНрд░рдг рдХрд░рдиреЗ рдХреА рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ рдФрд░ рдирд┐рдпрдВрддреНрд░рдг рдХрд░рдиреЗ рдХреА рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ рдФрд░ рдирд┐рдпрдВрддреНрд░рдг рдХрд░рдиреЗ рдХреА рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ рдФрд░ рдирд┐рдпрдВрддреНрд░рдг рдХрд░рдиреЗ рдХреА рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ рдФрд░ рдирд┐рдпрдВрддреНрд░рдг рдХрд░рдиреЗ рдХреА рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ рдФрд░ рдирд┐рдпрдВрддреНрд░рдг рдХрд░рдиреЗ рдХреА рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ рдФрд░ рдирд┐рдпрдВрддреНрд░рдг рдХрд░рдиреЗ рдХреА рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ рдФрд░ рдирд┐рдпрдВрддреНрд░рдг рдХрд░рдиреЗ рдХреА рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ рдФрд░ рдирд┐рдпрдВрддреНрд░рдг рдХрд░рдиреЗ рдХреА рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ рдФрд░ рдирд┐рдпрдВрддреНрд░рдг рдХрд░рдиреЗ рдХреА рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ рдФрд░ рдирд┐рдпрдВрддреНрд░рдг рдХрд░рдиреЗ рдХреА рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ рдФрд░ рдирд┐рдпрдВрддреНрд░рдг рдХрд░рдиреЗ рдХреА рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ рдФрд░ рдирд┐рдпрдВрддреНрд░рдг рдХрд░рдиреЗ рдХреА рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ рдФрд░ рдирд┐рдпрдВрддреНрд░рдг рдХрд░рдиреЗ рдХреА рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ рдФрд░ рдирд┐рдпрдВрддреНрд░рдг рдХрд░рдиреЗ рдХреА рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ рдФрд░ рдирд┐рдпрдВрддреНрд░рдг рдХрд░рдиреЗ рдХреА рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ рдФрд░ рдирд┐рдпрдВрддреНрд░рдг рдХрд░рдиреЗ рдХреА рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ рдФрд░ рдирд┐рдпрдВрддреНрд░рдг рдХрд░рдиреЗ рдХреА рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ рдФрд░ рдирд┐рдпрдВрддреНрд░рдг рдХрд░рдиреЗ рдХреА рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ рдФрд░ рдирд┐рдпрдВрддреНрд░рдг рдХрд░рдиреЗ рдХреА рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ рдФрд░ рдирд┐рдпрдВрддреНрд░рдг рдХрд░рдиреЗ рдХреА рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ рдФрд░ рдирд┐рдпрдВрддреНрд░рдг рдХрд░рдиреЗ рдХреА рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ рдФрд░ рдирд┐рдпрдВрддреНрд░рдг рдХрд░рдиреЗ рдХреА рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ рдФрд░ рдирд┐рдпрдВрддреНрд░рдг рдХрд░рдиреЗ рдХреА рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ рдФрд░ рдирд┐рдпрдВрддреНрд░рдг рдХрд░рдиреЗ рдХреА рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ рдФрд░ рдирд┐рдпрдВрддреНрд░рдг рдХрд░рдиреЗ рдХреА рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ рдФрд░ рдирд┐рдпрдВрддреНрд░рдг рдХрд░рдиреЗ рдХреА рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ рдФрд░ рдирд┐рдпрдВрддреНрд░рдг рдХрд░рдиреЗ рдХреА рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ рдФрд░ рдирд┐рдпрдВрддреНрд░рдг рдХрд░рдиреЗ рдХреА рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ рдФрд░ рдирд┐рдпрдВрддреНрд░рдг рдХрд░рдиреЗ рдХреА рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ рдФрд░ рдирд┐рдпрдВрддреНрд░рдг рдХрд░рдиреЗ рдХреА рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ рдФрд░ рдирд┐рдпрдВрддреНрд░рдг рдХрд░рдиреЗ рдХреА рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ рдФрд░ рдирд┐рдпрдВрддреНрд░рдг рдХрд░рдиреЗ рдХреА рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ рдФрд░ рдирд┐рдпрдВрддреНрд░рдг рдХрд░рдиреЗ рдХреА рдЕ

```powershell
Get-DomainTrust
SourceName      : a.domain.local   --> Current domain
TargetName      : domain.external  --> Destination domain
TrustType       : WINDOWS-ACTIVE_DIRECTORY
TrustAttributes :
TrustDirection  : Inbound          --> Inboud trust
WhenCreated     : 2/19/2021 10:50:56 PM
WhenChanged     : 2/19/2021 10:50:56 PM
```

рдЗрд╕ рд╕реНрдерд┐рддрд┐ рдореЗрдВ **рдЖрдкрдХреЗ рдбреЛрдореЗрди рдкрд░ рд╡рд┐рд╢реНрд╡рд╕реНрддрддрд╛ рд╣реИ** рдЬрд┐рд╕реЗ рдПрдХ рдмрд╛рд╣реНрдп рдбреЛрдореЗрди рдиреЗ рджреА рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдЖрдкрдХреЛ **рдЕрдирд┐рд░реНрдзрд╛рд░рд┐рдд рдЕрдиреБрдорддрд┐рдпрд╛рдБ** рд╣реИрдВред рдЖрдкрдХреЛ рдвреВрдВрдврд╝рдирд╛ рд╣реЛрдЧрд╛ **рдХрд┐ рдЖрдкрдХреЗ рдбреЛрдореЗрди рдХреЗ рдХреМрди-рдХреМрди рд╕реЗ рдореБрдЦреНрдп рд╕рд┐рджреНрдзрд╛рдВрдд рд╣реИрдВ рдЬреЛ рдмрд╛рд╣реНрдп рдбреЛрдореЗрди рдкрд░ рдХрд┐рд╕ рдкреНрд░рдХрд╛рд░ рдХреА рдкрд╣реБрдВрдЪ рд╣реИ** рдФрд░ рдлрд┐рд░ рдЗрд╕реЗ рдЙрддреНрдкреАрдбрд╝рд┐рдд рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рдирд╛ рд╣реЛрдЧрд╛:

{% content-ref url="external-forest-domain-oneway-inbound.md" %}
[external-forest-domain-oneway-inbound.md](external-forest-domain-oneway-inbound.md)
{% endcontent-ref %}

### рдмрд╛рд╣реНрдп рд╡рди рд╡рди рдбреЛрдореЗрди - рдПрдХ-рддрд░рдлрд╛ (рдЖрдЙрдЯрдмрд╛рдЙрдВрдб)

```powershell
Get-DomainTrust -Domain current.local

SourceName      : current.local   --> Current domain
TargetName      : external.local  --> Destination domain
TrustType       : WINDOWS_ACTIVE_DIRECTORY
TrustAttributes : FOREST_TRANSITIVE
TrustDirection  : Outbound        --> Outbound trust
WhenCreated     : 2/19/2021 10:15:24 PM
WhenChanged     : 2/19/2021 10:15:24 PM
```

рдЗрд╕ рд╕реНрдерд┐рддрд┐ рдореЗрдВ **рдЖрдкрдХрд╛ рдбреЛрдореЗрди** рдХрд┐рд╕реА **рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░** рдХреЛ **рдПрдХ рд╡рд┐рднрд┐рдиреНрди рдбреЛрдореЗрди** рд╕реЗ рдПрдХ рдкреНрд░рд┐рдВрд╕рд┐рдкрд▓ рдХреЛ **рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рдмрдирд╛рддрд╛ рд╣реИ**ред

рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЬрдм рдПрдХ **рдбреЛрдореЗрди рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рд╣реЛрддрд╛ рд╣реИ** рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рдбреЛрдореЗрди рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдмрдирд╛рддрд╛ рд╣реИ рдЬрд┐рд╕рдХрд╛ **рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдирд╛рдо** рд╣реЛрддрд╛ рд╣реИ рдЬреЛ **рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рдкрд╛рд╕рд╡рд░реНрдб** рдХреЗ рд░реВрдк рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдЬрд┐рд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдпрд╣ рд╕рдВрднрд╡ рд╣реИ рдХрд┐ **рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рдбреЛрдореЗрди рдореЗрдВ рдкреНрд░рд╡реЗрд╢ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рдбреЛрдореЗрди рд╕реЗ рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рддрдХ рдкрд╣реБрдВрдЪрдирд╛**:

{% content-ref url="external-forest-domain-one-way-outbound.md" %}
[external-forest-domain-one-way-outbound.md](external-forest-domain-one-way-outbound.md)
{% endcontent-ref %}

рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рдбреЛрдореЗрди рдХреЛ рдХрдВрдкреНрд░рдорд╛рдЗрдЬ рдХрд░рдиреЗ рдХрд╛ рдПрдХ рдФрд░ рддрд░реАрдХрд╛ рд╣реИ [**SQL trusted link**](abusing-ad-mssql.md#mssql-trusted-links) рдЦреЛрдЬрдирд╛ рдЬреЛ рдбреЛрдореЗрди рд╡рд┐рд╢реНрд╡рд╛рд╕ рдХреЗ рд╡рд┐рдкрд░реАрдд рджрд┐рд╢рд╛ рдореЗрдВ рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ (рдЬреЛ рдмрд╣реБрдд рд╕рд╛рдорд╛рдиреНрдп рдирд╣реАрдВ рд╣реИ)ред

рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рдбреЛрдореЗрди рдХреЛ рдХрдВрдкреНрд░рдорд╛рдЗрдЬ рдХрд░рдиреЗ рдХрд╛ рдПрдХ рдФрд░ рддрд░реАрдХрд╛ рд╣реИ рдЬрдм рдПрдХ **рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рдбреЛрдореЗрди рд╕реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдПрдХреНрд╕реЗрд╕ рдХрд░ рд╕рдХрддрд╛ рд╣реИ** рдПрдХ рдорд╢реАрди рдореЗрдВ рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд░рдирд╛ рдЬрд╣рд╛рдВ рд╕реЗ **RDP** рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд▓реЙрдЧрд┐рди рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдлрд┐рд░, рд╣рдорд▓рд╛рд╡рд░ RDP рд╕рддреНрд░ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рдХреЛрдб рдЗрдВрдЬреЗрдХреНрдЯ рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдФрд░ **рдкреАрдбрд╝рд┐рдд рдХреЗ рдореВрд▓ рдбреЛрдореЗрди рддрдХ рдкрд╣реБрдВрдЪ рд╕рдХрддрд╛ рд╣реИ**ред рдЗрд╕рдХреЗ рдЕрддрд┐рд░рд┐рдХреНрдд, рдпрджрд┐ **рдкреАрдбрд╝рд┐рдд рдиреЗ рдЕрдкрдиреА рд╣рд╛рд░реНрдб рдбреНрд░рд╛рдЗрд╡ рдорд╛рдЙрдВрдЯ рдХреА рд╣реИ**, рддреЛ RDP рд╕рддреНрд░ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд╕реЗ рд╣рдорд▓рд╛рд╡рд░ **рд╣рд╛рд░реНрдб рдбреНрд░рд╛рдЗрд╡ рдХреЗ рд╕реНрдЯрд╛рд░реНрдЯрдЕрдк рдлрд╝реЛрд▓реНрдбрд░ рдореЗрдВ рдмреИрдХрдбреЛрд░реНрд╕** рд╕реНрдЯреЛрд░ рдХрд░ рд╕рдХрддрд╛ рд╣реИред рдЗрд╕ рддрдХрдиреАрдХ рдХреЛ **RDPInception** рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИред

{% content-ref url="rdp-sessions-abuse.md" %}
[rdp-sessions-abuse.md](rdp-sessions-abuse.md)
{% endcontent-ref %}

### рдбреЛрдореЗрди рд╡рд┐рд╢реНрд╡рд╛рд╕ рджреБрд░реБрдкрдпреЛрдЧ рд╕рдВрд╢реЛрдзрди

### **SID рдлрд╝рд┐рд▓реНрдЯрд░рд┐рдВрдЧ:**

* рд╡рди рдлрд╝реЙрд░реЗрд╕реНрдЯ рдЯреНрд░рд╕реНрдЯ рдХреЗ рдмреАрдЪ SID рдЗрддрд┐рд╣рд╛рд╕ рд╡рд┐рд╢реНрд╡рд╛рд╕ рдкрд░ рдЖрдХреНрд░рдордг рдХрд╛ рдЬреЛрдЦрд┐рдо SID рдлрд╝рд┐рд▓реНрдЯрд░рд┐рдВрдЧ рджреНрд╡рд╛рд░рд╛ рдХрдо рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬреЛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд╣реИ рд╕рднреА рдЗрдВрдЯрд░-рдлрд╝реЙрд░реЗрд╕реНрдЯ рдЯреНрд░рд╕реНрдЯ рдкрд░ред рдЗрд╕рдХрд╛ рдЖрдзрд╛рд░ рдорд╛рдЗрдХреНрд░реЛрд╕реЙрдлреНрдЯ рдХреЗ рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХреЗ рдЕрдиреБрд╕рд╛рд░ рд╡рди рдлрд╝реЙрд░реЗрд╕реНрдЯ рд╡рд┐рд╢реНрд╡рд╛рд╕ рдХреЛ рд╕реБрд░рдХреНрд╖рд┐рдд рдорд╛рдирддреЗ рд╣реБрдП рд╣реИред
* рд╣рд╛рд▓рд╛рдВрдХрд┐, рдПрдХ рдЪреАрдЬ рд╣реИ: SID рдлрд╝рд┐рд▓реНрдЯрд░рд┐рдВрдЧ рдЕрдиреБрдкреНрд░рдпреЛрдЧреЛрдВ рдФрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдПрдХреНрд╕реЗрд╕ рдХреЛ рд╡рд┐рдШрдЯрд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдЗрд╕рдХрд╛ рдХрднреА-рдХрднреА рдирд┐рд╖реЗрдз рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

### **рдЪрдпрдирд╛рддреНрдордХ рдкреНрд░рдорд╛рдгреАрдХрд░рдг:**

* рдЗрдВрдЯрд░-рдлрд╝реЙрд░реЗрд╕реНрдЯ рдЯреНрд░рд╕реНрдЯ рдХреЗ рд▓рд┐рдП, рдЪрдпрдирд╛рддреНрдордХ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ рджреЛ рд╡рдиреЛрдВ рдХреЗ рдЙрдкрд╡рдиреЛрдВ рд╕реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдкреНрд░рдорд╛рдгрд┐рдд рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдмрдЬрд╛рдп рдЗрд╕рдХреЗ, рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рдбреЛрдореЗрди рдпрд╛ рд╡рди рдХреЗ рднреАрддрд░ рдбреЛрдореЗрди рдФрд░ рд╕рд░реНрд╡рд░реЛрдВ рддрдХ рдкрд╣реБрдВрдЪ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рд╕реНрдкрд╖реНрдЯ рдЕрдиреБрдорддрд┐рдпрд╛рдБ рдЖрд╡рд╢реНрдпрдХ рд╣реЛрддреА рд╣реИрдВред
* рдпрд╣ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ рдХрд┐ рдпреЗ рдЙрдкрд╛рдп рд▓рд┐рдЦрдиреЗ рд╡рд╛рд▓реЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдиреЗрдорд┐рдВрдЧ рд╕рдВрджрд░реНрдн (NC) рдпрд╛ рд╡рд┐рд╢реНрд╡рд╛рд╕ рдЦрд╛рддреЗ рдкрд░ рд╣рдорд▓реЛрдВ рдХреЗ рдЦрд┐рд▓рд╛рдл рд╕реБрд░рдХреНрд╖рд┐рдд рдирд╣реАрдВ рд░рдЦрддреЗред

[**ired.team рдореЗрдВ рдбреЛрдореЗрди рд╡рд┐рд╢реНрд╡рд╛рд╕ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реАред**](https://ired.team/offensive-security-experiments/active-directory-kerberos-abuse/child-domain-da-to-ea-in-parent-domain)
