# BloodHound & Outras Ferramentas de Enumera√ß√£o do AD

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Voc√™ trabalha em uma **empresa de ciberseguran√ßa**? Quer ver sua **empresa anunciada no HackTricks**? ou quer ter acesso √† **vers√£o mais recente do PEASS ou baixar o HackTricks em PDF**? Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* Adquira o [**material oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* **Junte-se ao** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para o [reposit√≥rio hacktricks](https://github.com/carlospolop/hacktricks) e [reposit√≥rio hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>

## AD Explorer

[AD Explorer](https://docs.microsoft.com/en-us/sysinternals/downloads/adexplorer) faz parte do Sysinternal Suite:

> Um visualizador e editor avan√ßado do Active Directory (AD). Voc√™ pode usar o AD Explorer para navegar facilmente por um banco de dados do AD, definir locais favoritos, visualizar propriedades e atributos de objetos sem abrir caixas de di√°logo, editar permiss√µes, visualizar o esquema de um objeto e executar buscas sofisticadas que voc√™ pode salvar e reexecutar.

### Snapshots

O AD Explorer pode criar snapshots de um AD para que voc√™ possa verific√°-lo offline.\
Pode ser usado para descobrir vulnerabilidades offline ou para comparar diferentes estados do banco de dados do AD ao longo do tempo.

Ser√° necess√°rio o nome de usu√°rio, senha e dire√ß√£o para conectar (qualquer usu√°rio do AD √© necess√°rio).

Para tirar um snapshot do AD, v√° em `File` --> `Create Snapshot` e insira um nome para o snapshot.

## ADRecon

****[**ADRecon**](https://github.com/adrecon/ADRecon) √© uma ferramenta que extrai e combina v√°rios artefatos de um ambiente AD. As informa√ß√µes podem ser apresentadas em um **relat√≥rio** do Microsoft Excel **especialmente formatado** que inclui vis√µes resumidas com m√©tricas para facilitar a an√°lise e fornecer um quadro hol√≠stico do estado atual do ambiente AD alvo.
```bash
# Run it
.\ADRecon.ps1
```
## BloodHound

> BloodHound √© uma aplica√ß√£o web monol√≠tica composta por um frontend embutido em React com [Sigma.js](https://www.sigmajs.org/) e uma API REST backend baseada em [Go](https://go.dev/). √â implantado com um banco de dados de aplica√ß√£o [Postgresql](https://www.postgresql.org/) e um banco de dados gr√°fico [Neo4j](https://neo4j.com), e √© alimentado pelos coletores de dados [SharpHound](https://github.com/BloodHoundAD/SharpHound) e [AzureHound](https://github.com/BloodHoundAD/AzureHound).
>
>BloodHound utiliza a teoria dos grafos para revelar as rela√ß√µes ocultas e muitas vezes n√£o intencionais dentro de um ambiente Active Directory ou Azure. Atacantes podem usar o BloodHound para identificar facilmente caminhos de ataque altamente complexos que de outra forma seriam imposs√≠veis de identificar rapidamente. Defensores podem usar o BloodHound para identificar e eliminar esses mesmos caminhos de ataque. Tanto equipes azuis quanto vermelhas podem usar o BloodHound para obter um entendimento mais profundo das rela√ß√µes de privil√©gio em um ambiente Active Directory ou Azure.
>
>BloodHound CE √© criado e mantido pela [Equipe BloodHound Enterprise](https://bloodhoundenterprise.io). O BloodHound original foi criado por [@\_wald0](https://www.twitter.com/\_wald0), [@CptJesus](https://twitter.com/CptJesus), e [@harmj0y](https://twitter.com/harmj0y).
>
>De [https://github.com/SpecterOps/BloodHound](https://github.com/SpecterOps/BloodHound)

Ent√£o, [Bloodhound](https://github.com/SpecterOps/BloodHound) √© uma ferramenta incr√≠vel que pode enumerar um dom√≠nio automaticamente, salvar todas as informa√ß√µes, encontrar poss√≠veis caminhos de escalonamento de privil√©gios e mostrar todas as informa√ß√µes usando gr√°ficos.

Booldhound √© composto por 2 partes principais: **ingestores** e a **aplica√ß√£o de visualiza√ß√£o**.

Os **ingestores** s√£o usados para **enumerar o dom√≠nio e extrair todas as informa√ß√µes** em um formato que a aplica√ß√£o de visualiza√ß√£o entender√°.

A **aplica√ß√£o de visualiza√ß√£o usa neo4j** para mostrar como todas as informa√ß√µes est√£o relacionadas e para mostrar diferentes maneiras de escalar privil√©gios no dom√≠nio.

### Instala√ß√£o
Ap√≥s a cria√ß√£o do BloodHound CE, todo o projeto foi atualizado para facilitar o uso com o Docker. A maneira mais f√°cil de come√ßar √© usar sua configura√ß√£o pr√©-configurada do Docker Compose.

1. Instale o Docker Compose. Isso deve estar inclu√≠do na instala√ß√£o do [Docker Desktop](https://www.docker.com/products/docker-desktop/).
2. Execute:
```
curl -L https://ghst.ly/getbhce | docker compose -f - up
```
3. Localize a senha gerada aleatoriamente na sa√≠da do terminal do Docker Compose.
4. Em um navegador, acesse http://localhost:8080/ui/login. Fa√ßa login com um nome de usu√°rio admin e a senha gerada aleatoriamente a partir dos logs.

Ap√≥s isso, voc√™ precisar√° alterar a senha gerada aleatoriamente e ter√° a nova interface pronta, da qual voc√™ pode baixar diretamente os ingestores.

### SharpHound

Eles t√™m v√°rias op√ß√µes, mas se voc√™ quiser executar o SharpHound de um PC que esteja no dom√≠nio, usando seu usu√°rio atual e extrair todas as informa√ß√µes, voc√™ pode fazer:
```
./SharpHound.exe --CollectionMethods All
Invoke-BloodHound -CollectionMethod All
```
> Voc√™ pode ler mais sobre **CollectionMethod** e sess√£o de loop [aqui](https://support.bloodhoundenterprise.io/hc/en-us/articles/17481375424795-All-SharpHound-Community-Edition-Flags-Explained)

Se desejar executar o SharpHound usando credenciais diferentes, voc√™ pode criar uma sess√£o CMD netonly e executar o SharpHound a partir da√≠:
```
runas /netonly /user:domain\user "powershell.exe -exec bypass"
```
[**Saiba mais sobre Bloodhound em ired.team.**](https://ired.team/offensive-security-experiments/active-directory-kerberos-abuse/abusing-active-directory-with-bloodhound-on-kali-linux)

## Bloodhound Legado
### Instala√ß√£o

1. Bloodhound

Para instalar o aplicativo de visualiza√ß√£o, voc√™ precisar√° instalar o **neo4j** e o **aplicativo bloodhound**.\
A maneira mais f√°cil de fazer isso √© simplesmente:
```
apt-get install bloodhound
```
Voc√™ pode **baixar a vers√£o comunit√°ria do neo4j** [aqui](https://neo4j.com/download-center/#community).

1. Ingestores

Voc√™ pode baixar os Ingestores de:

* https://github.com/BloodHoundAD/SharpHound/releases
* https://github.com/BloodHoundAD/BloodHound/releases
* https://github.com/fox-it/BloodHound.py

1. Aprenda o caminho a partir do gr√°fico

Bloodhound vem com v√°rias consultas para destacar caminhos sens√≠veis de comprometimento. √â poss√≠vel adicionar consultas personalizadas para aprimorar a busca e correla√ß√£o entre objetos e mais!

Este reposit√≥rio tem uma boa cole√ß√£o de consultas: https://github.com/CompassSecurity/BloodHoundQueries

Processo de instala√ß√£o:
```
$ curl -o "~/.config/bloodhound/customqueries.json" "https://raw.githubusercontent.com/CompassSecurity/BloodHoundQueries/master/BloodHound_Custom_Queries/customqueries.json"
```
### Execu√ß√£o do aplicativo de visualiza√ß√£o

Ap√≥s baixar/instalar os aplicativos necess√°rios, vamos inici√°-los.\
Primeiramente voc√™ precisa **iniciar o banco de dados neo4j**:
```bash
./bin/neo4j start
#or
service neo4j start
```
A primeira vez que voc√™ iniciar este banco de dados, precisar√° acessar [http://localhost:7474/browser/](http://localhost:7474/browser/). Ser√° solicitado as credenciais padr√£o (neo4j:neo4j) e voc√™ ser√° **obrigado a alterar a senha**, ent√£o mude-a e n√£o a esque√ßa.

Agora, inicie o **aplicativo bloodhound**:
```bash
./BloodHound-linux-x64
#or
bloodhound
```
Voc√™ ser√° solicitado a inserir as credenciais do banco de dados: **neo4j:<Sua nova senha>**

E o bloodhound estar√° pronto para receber dados.

![](<../../.gitbook/assets/image (171) (1).png>)

### **Python bloodhound**

Se voc√™ possui credenciais de dom√≠nio, pode executar um **ingestor bloodhound python de qualquer plataforma**, assim voc√™ n√£o precisa depender do Windows.\
Baixe-o de [https://github.com/fox-it/BloodHound.py](https://github.com/fox-it/BloodHound.py) ou fazendo `pip3 install bloodhound`
```bash
bloodhound-python -u support -p '#00^BlackKnight' -ns 10.10.10.192 -d blackfield.local -c all
```
Se voc√™ estiver executando atrav√©s do proxychains, adicione `--dns-tcp` para que a resolu√ß√£o DNS funcione atrav√©s do proxy.
```bash
proxychains bloodhound-python -u support -p '#00^BlackKnight' -ns 10.10.10.192 -d blackfield.local -c all --dns-tcp
```
### Python SilentHound

Este script ir√° **enumerar silenciosamente um Dom√≠nio do Active Directory via LDAP** analisando usu√°rios, administradores, grupos, etc.

Confira no [**github do SilentHound**](https://github.com/layer8secure/SilentHound).

### RustHound

BloodHound em Rust, [**confira aqui**](https://github.com/OPENCYBER-FR/RustHound).

## Group3r

[**Group3r**](https://github.com/Group3r/Group3r) √© uma ferramenta para encontrar **vulnerabilidades** associadas √† **Pol√≠tica de Grupo** do Active Directory. \
Voc√™ precisa **executar o group3r** de um host dentro do dom√≠nio usando **qualquer usu√°rio do dom√≠nio**.
```bash
group3r.exe -f <filepath-name.log>
# -s sends results to stdin
# -f send results to file
```
## PingCastle

**[**PingCastle**](https://www.pingcastle.com/documentation/)** avalia a postura de seguran√ßa de um ambiente AD e fornece um **relat√≥rio** detalhado com gr√°ficos.

Para execut√°-lo, pode-se rodar o bin√°rio `PingCastle.exe` e ele iniciar√° uma **sess√£o interativa** apresentando um menu de op√ß√µes. A op√ß√£o padr√£o a ser usada √© **`healthcheck`**, que estabelecer√° uma vis√£o geral **b√°sica** do **dom√≠nio**, e encontrar√° **m√°s configura√ß√µes** e **vulnerabilidades**.

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Voc√™ trabalha em uma **empresa de ciberseguran√ßa**? Quer ver sua **empresa anunciada no HackTricks**? ou quer ter acesso √† **vers√£o mais recente do PEASS ou baixar o HackTricks em PDF**? Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Descubra [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* Adquira o [**material oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* **Junte-se ao** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para o [reposit√≥rio hacktricks](https://github.com/carlospolop/hacktricks) e [reposit√≥rio hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>
