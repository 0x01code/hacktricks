# –ü—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫—É

<details>

<summary><strong>–í–∏–≤—á–∞–π—Ç–µ —Ö–∞–∫—ñ–Ω–≥ AWS –≤—ñ–¥ –Ω—É–ª—è –¥–æ –≥–µ—Ä–æ—è –∑</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

–Ü–Ω—à—ñ —Å–ø–æ—Å–æ–±–∏ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ HackTricks:

* –Ø–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ —Å–≤–æ—é **–∫–æ–º–ø–∞–Ω—ñ—é –≤ —Ä–µ–∫–ª–∞–º—ñ –Ω–∞ HackTricks** –∞–±–æ **–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ HackTricks —É —Ñ–æ—Ä–º–∞—Ç—ñ PDF**, –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ü–õ–ê–ù–ò –ü–Ü–î–ü–ò–°–ö–ò**](https://github.com/sponsors/carlospolop)!
* –û—Ç—Ä–∏–º–∞–π—Ç–µ [**–æ—Ñ—ñ—Ü—ñ–π–Ω–∏–π PEASS & HackTricks –º–µ—Ä—á**](https://peass.creator-spring.com)
* –í—ñ–¥–∫—Ä–∏–π—Ç–µ –¥–ª—è —Å–µ–±–µ [**–°—ñ–º'—é PEASS**](https://opensea.io/collection/the-peass-family), –Ω–∞—à—É –∫–æ–ª–µ–∫—Ü—ñ—é –µ–∫—Å–∫–ª—é–∑–∏–≤–Ω–∏—Ö [**NFT**](https://opensea.io/collection/the-peass-family)
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –Ω–∞–º–∏ –Ω–∞ **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **–ü–æ–¥—ñ–ª—ñ—Ç—å—Å—è —Å–≤–æ—ó–º–∏ —Ö–∞–∫–µ—Ä—Å—å–∫–∏–º–∏ —Ç—Ä—é–∫–∞–º–∏, –Ω–∞–¥—Å–∏–ª–∞–π—Ç–µ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) **—ñ** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤ –Ω–∞ GitHub**.

</details>

<figure><img src="../../.gitbook/assets/i3.png" alt=""><figcaption></figcaption></figure>

**–ü—ñ–¥–∫–∞–∑–∫–∞ —â–æ–¥–æ –±–∞–≥—ñ–≤ —É –ø—Ä–æ–≥—Ä–∞–º—ñ –¥–ª—è –≤–∏–Ω–∞–≥–æ—Ä–æ–¥–∏**: **–∑–∞—Ä–µ—î—Å—Ç—Ä—É–π—Ç–µ—Å—è** –Ω–∞ **Intigriti**, –ø—Ä–µ–º—ñ–∞–ª—å–Ω—ñ–π **–ø–ª–∞—Ç—Ñ–æ—Ä–º—ñ –¥–ª—è –ø–æ—à—É–∫—É –±–∞–≥—ñ–≤, —Å—Ç–≤–æ—Ä–µ–Ω—ñ–π —Ö–∞–∫–µ—Ä–∞–º–∏ –¥–ª—è —Ö–∞–∫–µ—Ä—ñ–≤**! –ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ –Ω–∞—Å –Ω–∞ [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) —Å—å–æ–≥–æ–¥–Ω—ñ, —ñ –ø–æ—á–Ω—ñ—Ç—å –∑–∞—Ä–æ–±–ª—è—Ç–∏ –≤–∏–Ω–∞–≥–æ—Ä–æ–¥–∏ –¥–æ **$100,000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

## WMIC

**Wmic** –º–æ–∂–µ –±—É—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–∏–π –¥–ª—è –∑–∞–ø—É—Å–∫—É –ø—Ä–æ–≥—Ä–∞–º –ø—Ä–∏ **–∑–∞–ø—É—Å–∫—É**. –ü–µ—Ä–µ–≥–ª—è–Ω—å—Ç–µ, —è–∫—ñ –≤–∏–∫–æ–Ω—É–≤–∞–Ω—ñ —Ñ–∞–π–ª–∏ –∑–∞–ø–ª–∞–Ω–æ–≤–∞–Ω—ñ –¥–ª—è –∑–∞–ø—É—Å–∫—É –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é:
```bash
wmic startup get caption,command 2>nul & ^
Get-CimInstance Win32_StartupCommand | select Name, command, Location, User | fl
```
## –ó–∞–ø–ª–∞–Ω–æ–≤–∞–Ω—ñ –∑–∞–≤–¥–∞–Ω–Ω—è

**–ó–∞–≤–¥–∞–Ω–Ω—è** –º–æ–∂—É—Ç—å –±—É—Ç–∏ –∑–∞–ø–ª–∞–Ω–æ–≤–∞–Ω—ñ –¥–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∑ **–ø–µ–≤–Ω–æ—é —á–∞—Å—Ç–æ—Ç–æ—é**. –ü–µ—Ä–µ–≥–ª—è–Ω—å—Ç–µ, —è–∫—ñ –≤–∏–∫–æ–Ω—É–≤–∞–Ω—ñ —Ñ–∞–π–ª–∏ –∑–∞–ø–ª–∞–Ω–æ–≤–∞–Ω—ñ –¥–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è:
```bash
schtasks /query /fo TABLE /nh | findstr /v /i "disable deshab"
schtasks /query /fo LIST 2>nul | findstr TaskName
schtasks /query /fo LIST /v > schtasks.txt; cat schtask.txt | grep "SYSTEM\|Task To Run" | grep -B 1 SYSTEM
Get-ScheduledTask | where {$_.TaskPath -notlike "\Microsoft*"} | ft TaskName,TaskPath,State

#Schtask to give admin access
#You can also write that content on a bat file that is being executed by a scheduled task
schtasks /Create /RU "SYSTEM" /SC ONLOGON /TN "SchedPE" /TR "cmd /c net localgroup administrators user /add"
```
## –ü–∞–ø–∫–∏

–£—Å—ñ –≤–∏–∫–æ–Ω—É–≤–∞–Ω—ñ —Ñ–∞–π–ª–∏, —Ä–æ–∑—Ç–∞—à–æ–≤–∞–Ω—ñ –≤ **–ø–∞–ø–∫–∞—Ö –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫—É, –±—É–¥—É—Ç—å –≤–∏–∫–æ–Ω–∞–Ω—ñ –ø—Ä–∏ –∑–∞–ø—É—Å–∫—É**. –ó–∞–≥–∞–ª—å–Ω—ñ –ø–∞–ø–∫–∏ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫—É –ø–µ—Ä–µ—Ä–∞—Ö–æ–≤–∞–Ω—ñ –Ω–∏–∂—á–µ, –∞–ª–µ –ø–∞–ø–∫–∞ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫—É –≤–∫–∞–∑–∞–Ω–∞ –≤ —Ä–µ—î—Å—Ç—Ä—ñ. [–ü—Ä–æ—á–∏—Ç–∞–π—Ç–µ —Ü–µ, —â–æ–± –¥—ñ–∑–Ω–∞—Ç–∏—Å—è –¥–µ.](privilege-escalation-with-autorun-binaries.md#startup-path)
```bash
dir /b "C:\Documents and Settings\All Users\Start Menu\Programs\Startup" 2>nul
dir /b "C:\Documents and Settings\%username%\Start Menu\Programs\Startup" 2>nul
dir /b "%programdata%\Microsoft\Windows\Start Menu\Programs\Startup" 2>nul
dir /b "%appdata%\Microsoft\Windows\Start Menu\Programs\Startup" 2>nul
Get-ChildItem "C:\Users\All Users\Start Menu\Programs\Startup"
Get-ChildItem "C:\Users\$env:USERNAME\Start Menu\Programs\Startup"
```
## –†–µ—î—Å—Ç—Ä

{% hint style="info" %}
[–ü—Ä–∏–º—ñ—Ç–∫–∞ –∑–≤—ñ–¥—Å–∏](https://answers.microsoft.com/en-us/windows/forum/all/delete-registry-key/d425ae37-9dcc-4867-b49c-723dcd15147f): –ó–∞–ø–∏—Å —Ä–µ—î—Å—Ç—Ä—É **Wow6432Node** –≤–∫–∞–∑—É—î –Ω–∞ —Ç–µ, —â–æ –≤–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç–µ 64-–±—ñ—Ç–Ω—É –≤–µ—Ä—Å—ñ—é Windows. –û–ø–µ—Ä–∞—Ü—ñ–π–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î —Ü–µ–π –∫–ª—é—á –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –æ–∫—Ä–µ–º–æ–≥–æ –≤–∏–¥—É HKEY_LOCAL_MACHINE\SOFTWARE –¥–ª—è 32-–±—ñ—Ç–Ω–∏—Ö –ø—Ä–æ–≥—Ä–∞–º, —è–∫—ñ –ø—Ä–∞—Ü—é—é—Ç—å –Ω–∞ 64-–±—ñ—Ç–Ω–∏—Ö –≤–µ—Ä—Å—ñ—è—Ö Windows.
{% endhint %}

### –ó–∞–ø—É—Å–∫–∏

**–ó–∞–≥–∞–ª—å–Ω–æ–≤—ñ–¥–æ–º—ñ** –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∏ –≤ —Ä–µ—î—Å—Ç—Ä—ñ:

* `HKLM\Software\Microsoft\Windows\CurrentVersion\Run`
* `HKLM\Software\Microsoft\Windows\CurrentVersion\RunOnce`
* `HKLM\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\Run`
* `HKLM\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\RunOnce`
* `HKCU\Software\Microsoft\Windows\CurrentVersion\Run`
* `HKCU\Software\Microsoft\Windows\CurrentVersion\RunOnce`
* `HKCU\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\Run`
* `HKCU\Software\Wow6432Npde\Microsoft\Windows\CurrentVersion\RunOnce`
* `HKLM\Software\Microsoft\Windows NT\CurrentVersion\Terminal Server\Install\Software\Microsoft\Windows\CurrentVersion\Run`
* `HKLM\Software\Microsoft\Windows NT\CurrentVersion\Terminal Server\Install\Software\Microsoft\Windows\CurrentVersion\Runonce`
* `HKLM\Software\Microsoft\Windows NT\CurrentVersion\Terminal Server\Install\Software\Microsoft\Windows\CurrentVersion\RunonceEx`

–í—ñ–¥–æ–º—ñ —è–∫ **Run** —Ç–∞ **RunOnce** —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ–π–Ω—ñ –∫–ª—é—á—ñ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω—ñ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –ø—Ä–æ–≥—Ä–∞–º –∫–æ–∂–Ω–æ–≥–æ —Ä–∞–∑—É –ø—Ä–∏ –≤—Ö–æ–¥—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –≤ —Å–∏—Å—Ç–µ–º—É. –ö–æ–º–∞–Ω–¥–Ω–∏–π —Ä—è–¥–æ–∫, –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–∏–π —è–∫ –∑–Ω–∞—á–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö –∫–ª—é—á–∞, –æ–±–º–µ–∂–µ–Ω–∏–π 260 —Å–∏–º–≤–æ–ª–∞–º–∏ –∞–±–æ –º–µ–Ω—à–µ.

**–ó–∞–ø—É—Å–∫–∏ —Å–ª—É–∂–±** (–º–æ–∂—É—Ç—å –∫–æ–Ω—Ç—Ä–æ–ª—é–≤–∞—Ç–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π –∑–∞–ø—É—Å–∫ —Å–ª—É–∂–± –ø—ñ–¥ —á–∞—Å –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è):

* `HKLM\Software\Microsoft\Windows\CurrentVersion\RunServicesOnce`
* `HKCU\Software\Microsoft\Windows\CurrentVersion\RunServicesOnce`
* `HKLM\Software\Microsoft\Windows\CurrentVersion\RunServices`
* `HKCU\Software\Microsoft\Windows\CurrentVersion\RunServices`
* `HKLM\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\RunServicesOnce`
* `HKCU\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\RunServicesOnce`
* `HKLM\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\RunServices`
* `HKCU\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\RunServices`

**RunOnceEx:**

* `HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\RunOnceEx`
* `HKEY_LOCAL_MACHINE\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\RunOnceEx`

–ù–∞ Windows Vista —Ç–∞ –ø—ñ–∑–Ω—ñ—à–∏—Ö –≤–µ—Ä—Å—ñ—è—Ö –∫–ª—é—á—ñ —Ä–µ—î—Å—Ç—Ä—É **Run** —Ç–∞ **RunOnce** –Ω–µ –≥–µ–Ω–µ—Ä—É—é—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ. –ó–∞–ø–∏—Å–∏ –≤ —Ü–∏—Ö –∫–ª—é—á–∞—Ö –º–æ–∂—É—Ç—å –∞–±–æ –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ –∑–∞–ø—É—Å–∫–∞—Ç–∏ –ø—Ä–æ–≥—Ä–∞–º–∏, –∞–±–æ –≤–∫–∞–∑—É–≤–∞—Ç–∏ —ó—Ö —è–∫ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ. –ù–∞–ø—Ä–∏–∫–ª–∞–¥, –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—É DLL –ø—Ä–∏ –≤—Ö–æ–¥—ñ –≤ —Å–∏—Å—Ç–µ–º—É –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –∫–ª—é—á —Ä–µ—î—Å—Ç—Ä—É **RunOnceEx** —Ä–∞–∑–æ–º —ñ–∑ –∫–ª—é—á–µ–º "Depend". –¶–µ –¥–µ–º–æ–Ω—Å—Ç—Ä—É—î—Ç—å—Å—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è–º –∑–∞–ø–∏—Å—É –≤ —Ä–µ—î—Å—Ç—Ä –¥–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è "C:\temp\evil.dll" –ø—ñ–¥ —á–∞—Å –∑–∞–ø—É—Å–∫—É —Å–∏—Å—Ç–µ–º–∏:
```
reg add HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\RunOnceEx\\0001\\Depend /v 1 /d "C:\\temp\\evil.dll"
```
{% hint style="info" %}
**–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è 1**: –Ø–∫—â–æ –≤–∏ –º–æ–∂–µ—Ç–µ –∑–∞–ø–∏—Å—É–≤–∞—Ç–∏ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –±—É–¥—å-—è–∫–æ–≥–æ –∑ –≤–∫–∞–∑–∞–Ω–∏—Ö —Ä–µ—î—Å—Ç—Ä—ñ–≤ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ **HKLM**, –≤–∏ –º–æ–∂–µ—Ç–µ –ø—ñ–¥–≤–∏—â–∏—Ç–∏ –ø—Ä–∏–≤—ñ–ª–µ—ó, –∫–æ–ª–∏ —É–≤—ñ–π–¥–µ —ñ–Ω—à–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á.
{% endhint %}

{% hint style="info" %}
**–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è 2**: –Ø–∫—â–æ –≤–∏ –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç–∏ –±—É–¥—å-—è–∫–∏–π –∑ –≤–∫–∞–∑–∞–Ω–∏—Ö –≤ —Ä–µ—î—Å—Ç—Ä—ñ –±—ñ–Ω–∞—Ä–Ω–∏—Ö —Ñ–∞–π–ª—ñ–≤ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ **HKLM**, –≤–∏ –º–æ–∂–µ—Ç–µ –∑–º—ñ–Ω–∏—Ç–∏ —Ü–µ–π –±—ñ–Ω–∞—Ä–Ω–∏–π —Ñ–∞–π–ª –∑ –∑–∞–¥–Ω—ñ–º –ø—Ä–æ—Ö—ñ–¥–Ω–∏–º –æ—Ç–≤–æ—Ä–æ–º, –∫–æ–ª–∏ —É–≤—ñ–π–¥–µ —ñ–Ω—à–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á —Ç–∞ –ø—ñ–¥–≤–∏—â–∏—Ç–∏ –ø—Ä–∏–≤—ñ–ª–µ—ó.
{% endhint %}
```bash
#CMD
reg query HKLM\Software\Microsoft\Windows\CurrentVersion\Run
reg query HKLM\Software\Microsoft\Windows\CurrentVersion\RunOnce
reg query HKLM\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\Run
reg query HKLM\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\RunOnce
reg query HKCU\Software\Microsoft\Windows\CurrentVersion\Run
reg query HKCU\Software\Microsoft\Windows\CurrentVersion\RunOnce
reg query HKCU\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\Run
reg query HKCU\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\RunOnce
reg query HKLM\Software\Microsoft\Windows NT\CurrentVersion\Terminal Server\Install\Software\Microsoft\Windows\CurrentVersion\Run
reg query HKLM\Software\Microsoft\Windows NT\CurrentVersion\Terminal Server\Install\Software\Microsoft\Windows\CurrentVersion\RunOnce
reg query HKLM\Software\Microsoft\Windows NT\CurrentVersion\Terminal Server\Install\Software\Microsoft\Windows\CurrentVersion\RunE

reg query HKLM\Software\Microsoft\Windows\CurrentVersion\RunServicesOnce
reg query HKCU\Software\Microsoft\Windows\CurrentVersion\RunServicesOnce
reg query HKLM\Software\Microsoft\Windows\CurrentVersion\RunServices
reg query HKCU\Software\Microsoft\Windows\CurrentVersion\RunServices
reg query HKLM\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\RunServicesOnce
reg query HKCU\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\RunServicesOnce
reg query HKLM\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\RunServices
reg query HKCU\Software\Wow5432Node\Microsoft\Windows\CurrentVersion\RunServices

reg query HKLM\Software\Microsoft\Windows\RunOnceEx
reg query HKLM\Software\Wow6432Node\Microsoft\Windows\RunOnceEx
reg query HKCU\Software\Microsoft\Windows\RunOnceEx
reg query HKCU\Software\Wow6432Node\Microsoft\Windows\RunOnceEx

#PowerShell
Get-ItemProperty -Path 'Registry::HKLM\Software\Microsoft\Windows\CurrentVersion\Run'
Get-ItemProperty -Path 'Registry::HKLM\Software\Microsoft\Windows\CurrentVersion\RunOnce'
Get-ItemProperty -Path 'Registry::HKLM\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\Run'
Get-ItemProperty -Path 'Registry::HKLM\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\RunOnce'
Get-ItemProperty -Path 'Registry::HKCU\Software\Microsoft\Windows\CurrentVersion\Run'
Get-ItemProperty -Path 'Registry::HKCU\Software\Microsoft\Windows\CurrentVersion\RunOnce'
Get-ItemProperty -Path 'Registry::HKCU\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\Run'
Get-ItemProperty -Path 'Registry::HKCU\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\RunOnce'
Get-ItemProperty -Path 'Registry::HKLM\Software\Microsoft\Windows NT\CurrentVersion\Terminal Server\Install\Software\Microsoft\Windows\CurrentVersion\Run'
Get-ItemProperty -Path 'Registry::HKLM\Software\Microsoft\Windows NT\CurrentVersion\Terminal Server\Install\Software\Microsoft\Windows\CurrentVersion\RunOnce'
Get-ItemProperty -Path 'Registry::HKLM\Software\Microsoft\Windows NT\CurrentVersion\Terminal Server\Install\Software\Microsoft\Windows\CurrentVersion\RunE'

Get-ItemProperty -Path 'Registry::HKLM\Software\Microsoft\Windows\CurrentVersion\RunServicesOnce'
Get-ItemProperty -Path 'Registry::HKCU\Software\Microsoft\Windows\CurrentVersion\RunServicesOnce'
Get-ItemProperty -Path 'Registry::HKLM\Software\Microsoft\Windows\CurrentVersion\RunServices'
Get-ItemProperty -Path 'Registry::HKCU\Software\Microsoft\Windows\CurrentVersion\RunServices'
Get-ItemProperty -Path 'Registry::HKLM\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\RunServicesOnce'
Get-ItemProperty -Path 'Registry::HKCU\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\RunServicesOnce'
Get-ItemProperty -Path 'Registry::HKLM\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\RunServices'
Get-ItemProperty -Path 'Registry::HKCU\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\RunServices'

Get-ItemProperty -Path 'Registry::HKLM\Software\Microsoft\Windows\RunOnceEx'
Get-ItemProperty -Path 'Registry::HKLM\Software\Wow6432Node\Microsoft\Windows\RunOnceEx'
Get-ItemProperty -Path 'Registry::HKCU\Software\Microsoft\Windows\RunOnceEx'
Get-ItemProperty -Path 'Registry::HKCU\Software\Wow6432Node\Microsoft\Windows\RunOnceEx'
```
### –®–ª—è—Ö –∑–∞–ø—É—Å–∫—É

* `HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\User Shell Folders`
* `HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\Shell Folders`
* `HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Shell Folders`
* `HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\User Shell Folders`

–Ø—Ä–ª–∏–∫–∏, —Ä–æ–∑–º—ñ—â–µ–Ω—ñ –≤ –ø–∞–ø—Ü—ñ **Startup**, –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç–∏–º—É—Ç—å —Å–ª—É–∂–±–∏ –∞–±–æ –ø—Ä–æ–≥—Ä–∞–º–∏ –ø—ñ–¥ —á–∞—Å –≤—Ö–æ–¥—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∞–±–æ –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å–∏—Å—Ç–µ–º–∏. –ú—ñ—Å—Ü–µ —Ä–æ–∑—Ç–∞—à—É–≤–∞–Ω–Ω—è –ø–∞–ø–∫–∏ **Startup** –≤–∏–∑–Ω–∞—á–µ–Ω–æ –≤ —Ä–µ—î—Å—Ç—Ä—ñ —è–∫ –¥–ª—è **Local Machine**, —Ç–∞–∫ —ñ –¥–ª—è **Current User**. –¶–µ –æ–∑–Ω–∞—á–∞—î, —â–æ –±—É–¥—å-—è–∫–∏–π —è—Ä–ª–∏–∫, –¥–æ–¥–∞–Ω–∏–π –¥–æ —Ü–∏—Ö –≤–∫–∞–∑–∞–Ω–∏—Ö –º—ñ—Å—Ü—å **Startup**, –∑–∞–±–µ–∑–ø–µ—á–∏—Ç—å –∑–∞–ø—É—Å–∫ –∑–≤'—è–∑–∞–Ω–æ—ó —Å–ª—É–∂–±–∏ –∞–±–æ –ø—Ä–æ–≥—Ä–∞–º–∏ –ø—ñ—Å–ª—è –ø—Ä–æ—Ü–µ—Å—É –≤—Ö–æ–¥—É –∞–±–æ –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è, –∑—Ä–æ–±–∏–≤—à–∏ —Ü–µ –ø—Ä–æ—Å—Ç–∏–º –º–µ—Ç–æ–¥–æ–º –¥–ª—è –ø–ª–∞–Ω—É–≤–∞–Ω–Ω—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫—É –ø—Ä–æ–≥—Ä–∞–º.

{% hint style="info" %}
–Ø–∫—â–æ –≤–∏ –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç–∏ –±—É–¥—å-—è–∫—É –ø–∞–ø–∫—É \[User] Shell –ø—ñ–¥ **HKLM**, –≤–∏ –∑–º–æ–∂–µ—Ç–µ —Å–ø—Ä—è–º—É–≤–∞—Ç–∏ —ó—ó –Ω–∞ –ø–∞–ø–∫—É, –∫–æ—Ç—Ä–æ—é –∫–µ—Ä—É—î—Ç–µ –≤–∏, —ñ —Ä–æ–∑–º—ñ—Å—Ç–∏—Ç–∏ –∑–∞–¥–Ω—ñ–π –ø—Ä–æ—Ö—ñ–¥, —è–∫–∏–π –±—É–¥–µ –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏—Å—è –∫–æ–∂–Ω–æ–≥–æ —Ä–∞–∑—É, –∫–æ–ª–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á —É–≤—ñ–π–¥–µ –≤ —Å–∏—Å—Ç–µ–º—É, –ø—ñ–¥–≤–∏—â—É—é—á–∏ –ø—Ä–∏–≤—ñ–ª–µ—ó.
{% endhint %}
```bash
reg query "HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\User Shell Folders" /v "Common Startup"
reg query "HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\Shell Folders" /v "Common Startup"
reg query "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Shell Folders" /v "Common Startup"
reg query "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\User Shell Folders" /v "Common Startup"

Get-ItemProperty -Path 'Registry::HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\User Shell Folders' -Name "Common Startup"
Get-ItemProperty -Path 'Registry::HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\Shell Folders' -Name "Common Startup"
Get-ItemProperty -Path 'Registry::HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Shell Folders' -Name "Common Startup"
Get-ItemProperty -Path 'Registry::HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\User Shell Folders' -Name "Common Startup"
```
### –ö–ª—é—á—ñ Winlogon

`HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon`

–ó–∞–∑–≤–∏—á–∞–π –∫–ª—é—á **Userinit** –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–π –Ω–∞ **userinit.exe**. –û–¥–Ω–∞–∫, —è–∫—â–æ —Ü–µ–π –∫–ª—é—á –∑–º—ñ–Ω–µ–Ω–æ, –≤–∫–∞–∑–∞–Ω–∏–π –≤–∏–∫–æ–Ω—É–≤–∞–Ω–∏–π —Ñ–∞–π–ª —Ç–∞–∫–æ–∂ –±—É–¥–µ –∑–∞–ø—É—â–µ–Ω–∏–π **Winlogon** –ø—ñ–¥ —á–∞—Å –≤—Ö–æ–¥—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞. –ê–Ω–∞–ª–æ–≥—ñ—á–Ω–æ, –∫–ª—é—á **Shell** –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–∏–π –≤–∫–∞–∑—É–≤–∞—Ç–∏ –Ω–∞ **explorer.exe**, —è–∫–∏–π —î —Ç–∏–ø–æ–≤–æ—é –æ–±–æ–ª–æ–Ω–∫–æ—é –¥–ª—è Windows.
```bash
reg query "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon" /v "Userinit"
reg query "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon" /v "Shell"
Get-ItemProperty -Path 'Registry::HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon' -Name "Userinit"
Get-ItemProperty -Path 'Registry::HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon' -Name "Shell"
```
{% hint style="info" %}
–Ø–∫—â–æ –≤–∏ –∑–º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç–∏ –∑–Ω–∞—á–µ–Ω–Ω—è —Ä–µ—î—Å—Ç—Ä—É –∞–±–æ –±—ñ–Ω–∞—Ä–Ω–∏–π —Ñ–∞–π–ª, –≤–∏ –∑–º–æ–∂–µ—Ç–µ –ø—ñ–¥–≤–∏—â–∏—Ç–∏ –ø—Ä–∏–≤—ñ–ª–µ—ó.
{% endhint %}

### –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø–æ–ª—ñ—Ç–∏–∫–∏

* `HKLM\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer`
* `HKCU\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer`

–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∫–ª—é—á **Run**.
```bash
reg query "HKLM\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer" /v "Run"
reg query "HKCU\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer" /v "Run"
Get-ItemProperty -Path 'Registry::HKLM\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer' -Name "Run"
Get-ItemProperty -Path 'Registry::HKCU\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer' -Name "Run"
```
### AlternateShell

### –ó–º—ñ–Ω–∞ –∫–æ–º–∞–Ω–¥–Ω–æ–≥–æ —Ä—è–¥–∫–∞ –±–µ–∑–ø–µ—á–Ω–æ–≥–æ —Ä–µ–∂–∏–º—É

–£ —Ä–µ—î—Å—Ç—Ä—ñ Windows –ø—ñ–¥ `HKLM\SYSTEM\CurrentControlSet\Control\SafeBoot` –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º —î –∑–Ω–∞—á–µ–Ω–Ω—è **`AlternateShell`**, –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–µ –Ω–∞ `cmd.exe`. –¶–µ –æ–∑–Ω–∞—á–∞—î, —â–æ –ø—Ä–∏ –≤–∏–±–æ—Ä—ñ "–ë–µ–∑–ø–µ—á–Ω–∏–π —Ä–µ–∂–∏–º –∑ –∫–æ–º–∞–Ω–¥–Ω–∏–º —Ä—è–¥–∫–æ–º" –ø—ñ–¥ —á–∞—Å –∑–∞–ø—É—Å–∫—É (–Ω–∞—Ç–∏—Å–∫–∞—é—á–∏ F8), –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è `cmd.exe`. –ê–ª–µ –º–æ–∂–Ω–∞ –Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ –∫–æ–º–ø'—é—Ç–µ—Ä —Ç–∞–∫–∏–º —á–∏–Ω–æ–º, —â–æ–± –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç–∏—Å—è –≤ —Ü—å–æ–º—É —Ä–µ–∂–∏–º—ñ –±–µ–∑ –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ—Å—Ç—ñ –Ω–∞—Ç–∏—Å–∫–∞—Ç–∏ F8 —Ç–∞ –≤—Ä—É—á–Ω—É –≤–∏–±–∏—Ä–∞—Ç–∏ –π–æ–≥–æ.

–ö—Ä–æ–∫–∏ –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫—É –≤ "–ë–µ–∑–ø–µ—á–Ω–æ–º—É —Ä–µ–∂–∏–º—ñ –∑ –∫–æ–º–∞–Ω–¥–Ω–∏–º —Ä—è–¥–∫–æ–º":

1. –ó–º—ñ–Ω—ñ—Ç—å –∞—Ç—Ä–∏–±—É—Ç–∏ —Ñ–∞–π–ª—É `boot.ini`, —â–æ–± –≤–∏–¥–∞–ª–∏—Ç–∏ –ø—Ä–∞–ø–æ—Ä—Ü—ñ "—Ç—ñ–ª—å–∫–∏ –¥–ª—è —á–∏—Ç–∞–Ω–Ω—è", "—Å–∏—Å—Ç–µ–º–Ω–∏–π" —Ç–∞ "–ø—Ä–∏—Ö–æ–≤–∞–Ω–∏–π": `attrib c:\boot.ini -r -s -h`
2. –í—ñ–¥–∫—Ä–∏–π—Ç–µ `boot.ini` –¥–ª—è —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è.
3. –í—Å—Ç–∞–≤—Ç–µ —Ä—è–¥–æ–∫, –ø–æ–¥—ñ–±–Ω–∏–π –¥–æ: `multi(0)disk(0)rdisk(0)partition(1)\WINDOWS="Microsoft Windows XP Professional" /fastdetect /SAFEBOOT:MINIMAL(ALTERNATESHELL)`
4. –ó–±–µ—Ä–µ–∂—ñ—Ç—å –∑–º—ñ–Ω–∏ –≤ `boot.ini`.
5. –ü–æ–≤—Ç–æ—Ä–Ω–æ –∑–∞—Å—Ç–æ—Å—É–π—Ç–µ –ø–æ—á–∞—Ç–∫–æ–≤—ñ –∞—Ç—Ä–∏–±—É—Ç–∏ —Ñ–∞–π–ª—É: `attrib c:\boot.ini +r +s +h`

* **–ï–∫—Å–ø–ª–æ–π—Ç 1:** –ó–º—ñ–Ω–∞ –∫–ª—é—á–∞ —Ä–µ—î—Å—Ç—Ä—É **AlternateShell** –¥–æ–∑–≤–æ–ª—è—î –Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ –≤–ª–∞—Å–Ω–∏–π –∫–æ–º–∞–Ω–¥–Ω–∏–π —Ä—è–¥–æ–∫, —â–æ –ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω–æ –º–æ–∂–µ –±—É—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–∏–π –¥–ª—è –Ω–µ—Å–∞–Ω–∫—Ü—ñ–æ–Ω–æ–≤–∞–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø—É.
* **–ï–∫—Å–ø–ª–æ–π—Ç 2 (–î–æ–∑–≤–æ–ª–∏ –Ω–∞ –∑–∞–ø–∏—Å –¥–æ —à–ª—è—Ö—É PATH):** –ú–∞—Ç–∏ –¥–æ–∑–≤—ñ–ª –Ω–∞ –∑–∞–ø–∏—Å –¥–æ –±—É–¥—å-—è–∫–æ—ó —á–∞—Å—Ç–∏–Ω–∏ –∑–º—ñ–Ω–Ω–æ—ó —Å–∏—Å—Ç–µ–º–∏ **PATH**, –æ—Å–æ–±–ª–∏–≤–æ –ø–µ—Ä–µ–¥ `C:\Windows\system32`, –¥–æ–∑–≤–æ–ª—è—î –≤–∏–∫–æ–Ω–∞—Ç–∏ –≤–ª–∞—Å–Ω–∏–π `cmd.exe`, —è–∫–∏–π –º–æ–∂–µ –±—É—Ç–∏ –∑–∞–¥–Ω—ñ–º –≤—Ö–æ–¥–æ–º, —è–∫—â–æ —Å–∏—Å—Ç–µ–º–∞ –∑–∞–ø—É—Å–∫–∞—î—Ç—å—Å—è –≤ –±–µ–∑–ø–µ—á–Ω–æ–º—É —Ä–µ–∂–∏–º—ñ.
* **–ï–∫—Å–ø–ª–æ–π—Ç 3 (–î–æ–∑–≤–æ–ª–∏ –Ω–∞ –∑–∞–ø–∏—Å –¥–æ —à–ª—è—Ö—É PATH —Ç–∞ boot.ini):** –î–æ—Å—Ç—É–ø –Ω–∞ –∑–∞–ø–∏—Å –¥–æ `boot.ini` –¥–æ–∑–≤–æ–ª—è—î –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π –∑–∞–ø—É—Å–∫ —É –±–µ–∑–ø–µ—á–Ω–æ–º—É —Ä–µ–∂–∏–º—ñ, —Å–ø—Ä–∏—è—é—á–∏ –Ω–µ—Å–∞–Ω–∫—Ü—ñ–æ–Ω–æ–≤–∞–Ω–æ–º—É –¥–æ—Å—Ç—É–ø—É –ø—Ä–∏ –Ω–∞—Å—Ç—É–ø–Ω–æ–º—É –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ.

–î–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –ø–æ—Ç–æ—á–Ω–æ–≥–æ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è **AlternateShell** –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ —Ü—ñ –∫–æ–º–∞–Ω–¥–∏:
```bash
reg query HKLM\SYSTEM\CurrentControlSet\Control\SafeBoot /v AlternateShell
Get-ItemProperty -Path 'Registry::HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\SafeBoot' -Name 'AlternateShell'
```
### –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç

Active Setup - —Ü–µ —Ñ—É–Ω–∫—Ü—ñ—è –≤ Windows, —è–∫–∞ **—ñ–Ω—ñ—Ü—ñ—é—î—Ç—å—Å—è –¥–æ –ø–æ–≤–Ω–æ–≥–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ä–æ–±–æ—á–æ–≥–æ —Å—Ç–æ–ª—É**. –í–æ–Ω–∞ –Ω–∞–¥–∞—î –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç –≤–∏–∫–æ–Ω–∞–Ω–Ω—é –ø–µ–≤–Ω–∏—Ö –∫–æ–º–∞–Ω–¥, —è–∫—ñ –ø–æ–≤–∏–Ω–Ω—ñ –∑–∞–≤–µ—Ä—à–∏—Ç–∏—Å—è –¥–æ –ø—Ä–æ–¥–æ–≤–∂–µ–Ω–Ω—è –≤—Ö–æ–¥—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞. –¶–µ–π –ø—Ä–æ—Ü–µ—Å –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è –Ω–∞–≤—ñ—Ç—å –¥–æ –∑–∞–ø—É—Å–∫—É —ñ–Ω—à–∏—Ö –∑–∞–ø–∏—Å—ñ–≤ –∑–∞–ø—É—Å–∫—É, —Ç–∞–∫–∏—Ö —è–∫ —Ç—ñ, —â–æ –º—ñ—Å—Ç—è—Ç—å—Å—è –≤ —Ä–æ–∑–¥—ñ–ª–∞—Ö —Ä–µ—î—Å—Ç—Ä—É Run –∞–±–æ RunOnce.

Active Setup –∫–µ—Ä—É—î—Ç—å—Å—è —á–µ—Ä–µ–∑ –Ω–∞—Å—Ç—É–ø–Ω—ñ –∫–ª—é—á—ñ —Ä–µ—î—Å—Ç—Ä—É:

* `HKLM\SOFTWARE\Microsoft\Active Setup\Installed Components`
* `HKLM\SOFTWARE\Wow6432Node\Microsoft\Active Setup\Installed Components`
* `HKCU\SOFTWARE\Microsoft\Active Setup\Installed Components`
* `HKCU\SOFTWARE\Wow6432Node\Microsoft\Active Setup\Installed Components`

–£ —Ü–∏—Ö –∫–ª—é—á–∞—Ö —ñ—Å–Ω—É—é—Ç—å —Ä—ñ–∑–Ω—ñ –ø—ñ–¥–∫–ª—é—á—ñ, –∫–æ–∂–µ–Ω –∑ —è–∫–∏—Ö –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—É. –ó–Ω–∞—á–µ–Ω–Ω—è –∫–ª—é—á—ñ–≤, —è–∫—ñ –≤–∞—Ä—Ç–æ –≤—ñ–¥–∑–Ω–∞—á–∏—Ç–∏, –≤–∫–ª—é—á–∞—é—Ç—å:

* **IsInstalled:**
  * `0` –≤–∫–∞–∑—É—î –Ω–∞ —Ç–µ, —â–æ –∫–æ–º–∞–Ω–¥–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –Ω–µ –±—É–¥–µ –≤–∏–∫–æ–Ω–∞–Ω–∞.
  * `1` –æ–∑–Ω–∞—á–∞—î, —â–æ –∫–æ–º–∞–Ω–¥–∞ –±—É–¥–µ –≤–∏–∫–æ–Ω–∞–Ω–∞ –æ–¥–∏–Ω —Ä–∞–∑ –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞, —â–æ —î —Ç–∏–ø–æ–≤–æ—é –ø–æ–≤–µ–¥—ñ–Ω–∫–æ—é, —è–∫—â–æ –∑–Ω–∞—á–µ–Ω–Ω—è `IsInstalled` –≤—ñ–¥—Å—É—Ç–Ω—î.
* **StubPath:** –í–∏–∑–Ω–∞—á–∞—î –∫–æ–º–∞–Ω–¥—É, —è–∫—É –≤–∏–∫–æ–Ω–∞—î Active Setup. –¶–µ –º–æ–∂–µ –±—É—Ç–∏ –±—É–¥—å-—è–∫–∞ –¥—ñ–π—Å–Ω–∞ –∫–æ–º–∞–Ω–¥–Ω–∞ —Å—Ç—Ä—ñ—á–∫–∞, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –∑–∞–ø—É—Å–∫ `notepad`.

**–í–∏—Å–Ω–æ–≤–∫–∏ –∑ –±–µ–∑–ø–µ–∫–∏:**

* –ó–º—ñ–Ω–∞ –∞–±–æ –∑–∞–ø–∏—Å –¥–æ –∫–ª—é—á–∞, –¥–µ **`IsInstalled`** –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –Ω–∞ `"1"` –∑ –ø–µ–≤–Ω–∏–º **`StubPath`**, –º–æ–∂–µ –ø—Ä–∏–∑–≤–µ—Å—Ç–∏ –¥–æ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –Ω–µ—Å–∞–Ω–∫—Ü—ñ–æ–Ω–æ–≤–∞–Ω–æ—ó –∫–æ–º–∞–Ω–¥–∏, —â–æ –ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω–æ –º–æ–∂–µ –ø—Ä–∏–∑–≤–µ—Å—Ç–∏ –¥–æ –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤.
* –ó–º—ñ–Ω–∞ –±—ñ–Ω–∞—Ä–Ω–æ–≥–æ —Ñ–∞–π–ª—É, –Ω–∞ —è–∫–∏–π –ø–æ—Å–∏–ª–∞—î—Ç—å—Å—è –±—É–¥—å-—è–∫–µ –∑–Ω–∞—á–µ–Ω–Ω—è **`StubPath`**, —Ç–∞–∫–æ–∂ –º–æ–∂–µ –ø—Ä–∏–∑–≤–µ—Å—Ç–∏ –¥–æ –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤ –∑–∞ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–∏—Ö –¥–æ–∑–≤–æ–ª—ñ–≤.

–î–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π **`StubPath`** —É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö Active Setup –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Ç–∞–∫—ñ –∫–æ–º–∞–Ω–¥–∏:
```bash
reg query "HKLM\SOFTWARE\Microsoft\Active Setup\Installed Components" /s /v StubPath
reg query "HKCU\SOFTWARE\Microsoft\Active Setup\Installed Components" /s /v StubPath
reg query "HKLM\SOFTWARE\Wow6432Node\Microsoft\Active Setup\Installed Components" /s /v StubPath
reg query "HKCU\SOFTWARE\Wow6432Node\Microsoft\Active Setup\Installed Components" /s /v StubPath
```
### –û–±'—î–∫—Ç–∏ –¥–æ–ø–æ–º—ñ–∂–Ω–∏–∫–∞ –±—Ä–∞—É–∑–µ—Ä–∞

### –û–≥–ª—è–¥ –æ–±'—î–∫—Ç—ñ–≤ –¥–æ–ø–æ–º—ñ–∂–Ω–∏–∫–∞ –±—Ä–∞—É–∑–µ—Ä–∞ (BHO)

–û–±'—î–∫—Ç–∏ –¥–æ–ø–æ–º—ñ–∂–Ω–∏–∫–∞ –±—Ä–∞—É–∑–µ—Ä–∞ (BHO) - —Ü–µ –º–æ–¥—É–ª—ñ DLL, —è–∫—ñ –¥–æ–¥–∞—é—Ç—å –¥–æ–¥–∞—Ç–∫–æ–≤—ñ —Ñ—É–Ω–∫—Ü—ñ—ó –¥–æ Internet Explorer –≤—ñ–¥ Microsoft. –í–æ–Ω–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—é—Ç—å—Å—è –≤ Internet Explorer —Ç–∞ –ü—Ä–æ–≤—ñ–¥–Ω–∏–∫ Windows –ø—Ä–∏ –∫–æ–∂–Ω–æ–º—É –∑–∞–ø—É—Å–∫—É. –û–¥–Ω–∞–∫ —ó—Ö –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –º–æ–∂–Ω–∞ –∑–∞–±–ª–æ–∫—É–≤–∞—Ç–∏, –≤—Å—Ç–∞–Ω–æ–≤–∏–≤—à–∏ –∫–ª—é—á **NoExplorer** –Ω–∞ 1, —â–æ –∑–∞–ø–æ–±—ñ–≥–∞—î —ó—Ö –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—é —Ä–∞–∑–æ–º —ñ–∑ –µ–∫–∑–µ–º–ø–ª—è—Ä–∞–º–∏ –ü—Ä–æ–≤—ñ–¥–Ω–∏–∫–∞ Windows.

BHO —Å—É–º—ñ—Å–Ω—ñ –∑ Windows 10 —á–µ—Ä–µ–∑ Internet Explorer 11, –∞–ª–µ –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—é—Ç—å—Å—è –≤ Microsoft Edge, –±—Ä–∞—É–∑–µ—Ä—ñ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º —É –Ω–æ–≤—ñ—à–∏—Ö –≤–µ—Ä—Å—ñ—è—Ö Windows.

–î–ª—è –¥–æ—Å–ª—ñ–¥–∂–µ–Ω–Ω—è BHO, –∑–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω–∏—Ö —É —Å–∏—Å—Ç–µ–º—ñ, –≤–∏ –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –Ω–∞—Å—Ç—É–ø–Ω—ñ –∫–ª—é—á—ñ —Ä–µ—î—Å—Ç—Ä—É:

* `HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Browser Helper Objects`
* `HKLM\SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\Explorer\Browser Helper Objects`

–ö–æ–∂–µ–Ω BHO –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π —Å–≤–æ—ó–º **CLSID** –≤ —Ä–µ—î—Å—Ç—Ä—ñ, —è–∫–∏–π —Å–ª—É–∂–∏—Ç—å —É–Ω—ñ–∫–∞–ª—å–Ω–∏–º —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä–æ–º. –î–µ—Ç–∞–ª—å–Ω—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –∫–æ–∂–µ–Ω CLSID –º–æ–∂–Ω–∞ –∑–Ω–∞–π—Ç–∏ –≤ `HKLM\SOFTWARE\Classes\CLSID\{<CLSID>}`.

–î–ª—è –∑–∞–ø–∏—Ç—É BHO –≤ —Ä–µ—î—Å—Ç—Ä—ñ –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Ç–∞–∫—ñ –∫–æ–º–∞–Ω–¥–∏:
```bash
reg query "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Browser Helper Objects" /s
reg query "HKLM\SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\Explorer\Browser Helper Objects" /s
```
### –†–æ–∑—à–∏—Ä–µ–Ω–Ω—è –¥–ª—è Internet Explorer

* `HKLM\Software\Microsoft\Internet Explorer\Extensions`
* `HKLM\Software\Wow6432Node\Microsoft\Internet Explorer\Extensions`

–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ –≤ —Ä–µ—î—Å—Ç—Ä—ñ –±—É–¥–µ –º—ñ—Å—Ç–∏—Ç–∏—Å—è 1 –Ω–æ–≤–∏–π —Ä–µ—î—Å—Ç—Ä –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ dll, —è–∫–∏–π –±—É–¥–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π **CLSID**. –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ CLSID –º–æ–∂–Ω–∞ –∑–Ω–∞–π—Ç–∏ –≤ `HKLM\SOFTWARE\Classes\CLSID\{<CLSID>}`

### –î—Ä–∞–π–≤–µ—Ä–∏ —à—Ä–∏—Ñ—Ç—ñ–≤

* `HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Font Drivers`
* `HKLM\SOFTWARE\WOW6432Node\Microsoft\Windows NT\CurrentVersion\Font Drivers`
```bash
reg query "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Font Drivers"
reg query "HKLM\SOFTWARE\Wow6432Node\Microsoft\Windows NT\CurrentVersion\Font Drivers"
Get-ItemProperty -Path 'Registry::HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Font Drivers'
Get-ItemProperty -Path 'Registry::HKLM\SOFTWARE\Wow6432Node\Microsoft\Windows NT\CurrentVersion\Font Drivers'
```
### –í—ñ–¥–∫—Ä–∏—Ç–∏ –∫–æ–º–∞–Ω–¥—É

* `HKLM\SOFTWARE\Classes\htmlfile\shell\open\command`
* `HKLM\SOFTWARE\Wow6432Node\Classes\htmlfile\shell\open\command`
```bash
reg query "HKLM\SOFTWARE\Classes\htmlfile\shell\open\command" /v ""
reg query "HKLM\SOFTWARE\Wow6432Node\Classes\htmlfile\shell\open\command" /v ""
Get-ItemProperty -Path 'Registry::HKLM\SOFTWARE\Classes\htmlfile\shell\open\command' -Name ""
Get-ItemProperty -Path 'Registry::HKLM\SOFTWARE\Wow6432Node\Classes\htmlfile\shell\open\command' -Name ""
```
### –û–ø—Ü—ñ—ó –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤ –∑–æ–±—Ä–∞–∂–µ–Ω—å
```
HKLM\Software\Microsoft\Windows NT\CurrentVersion\Image File Execution Options
HKLM\Software\Microsoft\Wow6432Node\Windows NT\CurrentVersion\Image File Execution Options
```
## SysInternals

–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ –≤—Å—ñ —Å–∞–π—Ç–∏, –¥–µ –º–æ–∂–Ω–∞ –∑–Ω–∞–π—Ç–∏ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫, **–≤–∂–µ –±—É–ª–∏ –ø—Ä–æ—Å–∫–∞–Ω–æ–≤–∞–Ω—ñ** [**winpeas.exe**](https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/winPEAS/winPEASexe). –û–¥–Ω–∞–∫, –¥–ª—è **–±—ñ–ª—å—à –ø–æ–≤–Ω–æ–≥–æ —Å–ø–∏—Å–∫—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–∫–æ–Ω—É–≤–∞–Ω–∏—Ö** —Ñ–∞–π–ª—ñ–≤ –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ [autoruns](https://docs.microsoft.com/en-us/sysinternals/downloads/autoruns) –≤—ñ–¥ SysInternals:
```
autorunsc.exe -m -nobanner -a * -ct /accepteula
```
## –î–æ–¥–∞—Ç–∫–æ–≤–æ

**–ó–Ω–∞–π–¥—ñ—Ç—å –±—ñ–ª—å—à–µ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫—ñ–≤, –ø–æ–¥—ñ–±–Ω–∏—Ö —Ä–µ—î—Å—Ç—Ä–∞–º, –∑–∞ –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º** [**https://www.microsoftpressstore.com/articles/article.aspx?p=2762082\&seqNum=2**](https://www.microsoftpressstore.com/articles/article.aspx?p=2762082\&seqNum=2)

## –ü–æ—Å–∏–ª–∞–Ω–Ω—è

* [https://resources.infosecinstitute.com/common-malware-persistence-mechanisms/#gref](https://resources.infosecinstitute.com/common-malware-persistence-mechanisms/#gref)
* [https://attack.mitre.org/techniques/T1547/001/](https://attack.mitre.org/techniques/T1547/001/)
* [https://www.microsoftpressstore.com/articles/article.aspx?p=2762082\&seqNum=2](https://www.microsoftpressstore.com/articles/article.aspx?p=2762082\&seqNum=2)
* [https://www.itprotoday.com/cloud-computing/how-can-i-add-boot-option-starts-alternate-shell](https://www.itprotoday.com/cloud-computing/how-can-i-add-boot-option-starts-alternate-shell)

<figure><img src="../../.gitbook/assets/i3.png" alt=""><figcaption></figcaption></figure>

**–ü—ñ–¥–∫–∞–∑–∫–∞ —â–æ–¥–æ –±–∞–≥—ñ–≤**: **–∑–∞—Ä–µ—î—Å—Ç—Ä—É–π—Ç–µ—Å—è** –Ω–∞ **Intigriti**, –ø—Ä–µ–º—ñ–∞–ª—å–Ω—ñ–π **–ø–ª–∞—Ç—Ñ–æ—Ä–º—ñ –¥–ª—è –ø–æ—à—É–∫—É –±–∞–≥—ñ–≤, —Å—Ç–≤–æ—Ä–µ–Ω—ñ–π —Ö–∞–∫–µ—Ä–∞–º–∏ –¥–ª—è —Ö–∞–∫–µ—Ä—ñ–≤**! –ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ –Ω–∞—Å –Ω–∞ [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) —Å—å–æ–≥–æ–¥–Ω—ñ, —ñ –ø–æ—á–Ω—ñ—Ç—å –∑–∞—Ä–æ–±–ª—è—Ç–∏ –≤–∏–Ω–∞–≥–æ—Ä–æ–¥–∏ –¥–æ **$100,000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

<details>

<summary><strong>–í–∏–≤—á–∞–π—Ç–µ —Ö–∞–∫—ñ–Ω–≥ AWS –≤—ñ–¥ –Ω—É–ª—è –¥–æ –≥–µ—Ä–æ—è –∑</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

–Ü–Ω—à—ñ —Å–ø–æ—Å–æ–±–∏ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ HackTricks:

* –Ø–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ —Å–≤–æ—é **–∫–æ–º–ø–∞–Ω—ñ—é —Ä–µ–∫–ª–∞–º–æ–≤–∞–Ω—É –≤ HackTricks** –∞–±–æ **–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ HackTricks —É —Ñ–æ—Ä–º–∞—Ç—ñ PDF**, –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ü–õ–ê–ù–ò –ü–Ü–î–ü–ò–°–ö–ò**](https://github.com/sponsors/carlospolop)!
* –û—Ç—Ä–∏–º–∞–π—Ç–µ [**–æ—Ñ—ñ—Ü—ñ–π–Ω–∏–π PEASS & HackTricks –º–µ—Ä—á**](https://peass.creator-spring.com)
* –í—ñ–¥–∫—Ä–∏–π—Ç–µ –¥–ª—è —Å–µ–±–µ [**–°—ñ–º'—é PEASS**](https://opensea.io/collection/the-peass-family), –Ω–∞—à—É –∫–æ–ª–µ–∫—Ü—ñ—é –µ–∫—Å–∫–ª—é–∑–∏–≤–Ω–∏—Ö [**NFT**](https://opensea.io/collection/the-peass-family)
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ Telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –Ω–∞–º–∏ –Ω–∞ **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **–ü–æ–¥—ñ–ª—ñ—Ç—å—Å—è —Å–≤–æ—ó–º–∏ —Ö–∞–∫–µ—Ä—Å—å–∫–∏–º–∏ —Ç—Ä—é–∫–∞–º–∏, –Ω–∞–¥—Å–∏–ª–∞–π—Ç–µ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) **—ñ** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤ –Ω–∞ GitHub**.

</details>
