# ACLs - DACLs/SACLs/ACEs

<figure><img src="../../.gitbook/assets/image (3) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
[**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks)を使用して、世界で最も高度なコミュニティツールによって強化された**ワークフローを簡単に構築**し**自動化**します。\
今すぐアクセスを取得:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><strong>**htARTE（HackTricks AWS Red Team Expert）**で**ゼロからヒーローまでのAWSハッキング**を学びましょう！</summary>

HackTricksをサポートする他の方法:

* **HackTricksで企業を宣伝**したい場合や**HackTricksをPDFでダウンロード**したい場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS＆HackTricksグッズ**](https://peass.creator-spring.com)を入手
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクションを見る
* **💬 [Discordグループ](https://discord.gg/hRep4RUj7f)**に参加するか、[**telegramグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)をフォローする。
* **HackTricks**と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のGitHubリポジトリにPRを提出して、**ハッキングトリックを共有**します。

</details>

## **アクセス制御リスト（ACL）**

アクセス制御リスト（ACL）は、オブジェクトとそのプロパティの保護を指示する一連の順序付けられたアクセス制御エントリ（ACE）から構成されます。基本的に、ACLは、どのセキュリティプリンシパル（ユーザーまたはグループ）が特定のオブジェクトで許可または拒否されるアクションを定義します。

ACLには2種類あります：

- **自由なアクセス制御リスト（DACL）：** オブジェクトへのアクセス権を持つユーザーとグループを指定します。
- **システムアクセス制御リスト（SACL）：** オブジェクトへのアクセス試行の監査を管理します。

ファイルへのアクセスプロセスは、オブジェクトのセキュリティ記述子をユーザーのアクセストークンと照合して、ACEに基づいてアクセスが許可されるかどうか、およびそのアクセスの範囲を決定することによって行われます。

### **主要コンポーネント**

- **DACL：** オブジェクトへのユーザーとグループのアクセス許可を付与または拒否するACEを含みます。基本的に、アクセス権を指示する主要なACLです。

- **SACL：** オブジェクトへのアクセスの監査に使用され、ACEはセキュリティイベントログに記録されるべきアクセスの種類を定義します。これは、未承認のアクセス試行を検出したり、アクセスの問題をトラブルシューティングするのに役立ちます。

### **ACLとのシステムの相互作用**

各ユーザーセッションは、そのセッションに関連するセキュリティ情報（ユーザー、グループのアイデンティティ、特権など）を含むアクセストークンに関連付けられます。このトークンには、セッションを一意に識別するログオンSIDも含まれます。

ローカルセキュリティ機関（LSASS）は、アクセスを試みるセキュリティプリンシパルがアクセスを試みるオブジェクトのDACLを調べ、関連するACEが見つからない場合は即座にアクセスを許可します。それ以外の場合、LSASSはACEをアクセストークン内のセキュリティプリンシパルのSIDと比較してアクセスの適格性を決定します。

### **要約されたプロセス**

- **ACL：** DACLを介してアクセス権を定義し、SACLを介して監査ルールを定義します。
- **アクセストークン：** セッションのユーザー、グループ、特権情報を含む。
- **アクセス決定：** DACL ACEをアクセストークンと比較してアクセスの適格性を決定します。監査のためにSACLが使用されます。


### ACEs

**アクセス制御エントリ（ACE）**には**3つの主要なタイプ**があります：

- **アクセス拒否ACE**：指定されたユーザーやグループに対してオブジェクトへのアクセスを明示的に拒否します（DACL内）。
- **アクセス許可ACE**：指定されたユーザーやグループに対してオブジェクトへのアクセスを明示的に許可します（DACL内）。
- **システム監査ACE**：システムアクセス制御リスト（SACL）内に配置され、このACEはユーザーやグループによるオブジェクトへのアクセス試行時に監査ログを生成します。アクセスが許可されたか拒否されたか、およびアクセスの性質を文書化します。

各ACEには、次の**4つの重要なコンポーネント**があります：

1. ユーザーまたはグループの**セキュリティ識別子（SID）**（またはグラフィカル表現での主要名）。
2. ACEタイプ（アクセス拒否、許可、またはシステム監査を識別する）の**フラグ**。
3. 子オブジェクトが親からACEを継承できるかを決定する**継承フラグ**。
4. オブジェクトの付与された権利を指定する**[アクセスマスク](https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-dtyp/7a53f60e-e730-4dfe-bbe9-b21b62eb790b?redirectedfrom=MSDN)**、オブジェクトの権利を指定する32ビット値。

アクセス決定は、要求された権利がアクセストークン内の信託者に明示的に拒否される**アクセス拒否ACE**、アクセストークン内の信託者に明示的にすべての要求された権利が付与される**アクセス許可ACE**、すべてのACEをチェックした後、要求された権利が**明示的に許可されていない**場合、アクセスが暗黙的に**拒否**されるまで、順次各ACEを調べることによって行われます。


### ACEの順序

**ACEs**（誰が何にアクセスできるかを示すルール）がリストで配置される方法は非常に重要です。これは、システムがこれらのルールに基づいてアクセスを許可または拒否した後、残りを見なくなるためです。

これらのACEを整理する最良の方法があり、それは**"正準順序"**と呼ばれています。この方法は、すべてがスムーズにかつ公平に機能するようにするのに役立ちます。以下は、**Windows 2000**および**Windows Server 2003**などのシステムに適用される方法です：

- まず、**このアイテムに特に作成されたすべてのルール**を、親フォルダーなどの他の場所から来たものよりも前に配置します。
- これらの特定のルールには、**"いいえ"（拒否）**と**"はい"（許可）**を示すルールを前に配置します。
- 他の場所から来たルールについては、親などの**最も近いソース**から始め、そこから戻ります。再び、**"いいえ"**を**"はい"**の前に配置します。

この設定には2つの大きな利点があります：

* 特定の**"いいえ"**がある場合、他の**"はい"**ルールがあっても、それが尊重されることを確認します。
* ファイルまたはフォルダーの所有者が、親フォルダーやさらに後ろからのルールが適用される前に、誰が入るかについて**最終的な決定権**を持つことができます。

この方法で作業することで、ファイルまたはフォルダーの所有者は、アクセス権を非常に正確に制御し、正しい人が入れるようにし、間違った人が入れないようにします。

![](https://www.ntfs.com/images/screenshots/ACEs.gif)

したがって、**"正準順序"**は、アクセスルールが明確でうまく機能し、特定のルールを最初に配置し、すべてをスマートに整理することに関するものです。


<figure><img src="../../.gitbook/assets/image (3) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
[**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks)を使用して、世界で最も高度なコミュニティツールによって強化された**ワークフローを簡単に構築**し**自動化**します。\
今すぐアクセスを取得:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

### GUIの例

**[ここからの例](https://secureidentity.se/acl-dacl-sacl-and-the-ace/)**

これは、ACL、DACL、およびACEを示すフォルダーのクラシックなセキュリティタブです：

![http://secureidentity.se/wp-content/uploads/2014/04/classicsectab.jpg](../../.gitbook/assets/classicsectab.jpg)

**詳細ボタン**をクリックすると、継承などの追加オプションが表示されます：

![http://secureidentity.se/wp-content/uploads/2014/04/aceinheritance.jpg](../../.gitbook/assets/aceinheritance.jpg)

そして、セキュリティプリンシパルを追加または編集する場合：

![http://secureidentity.se/wp-content/uploads/2014/04/editseprincipalpointers1.jpg](../../.gitbook/assets/editseprincipalpointers1.jpg)

最後に、監査タブのSACLがあります：

![http://secureidentity.se/wp-content/uploads/2014/04/audit-tab.jpg](../../.gitbook/assets/audit-tab.jpg)

### 簡略化された方法でアクセス制御を説明する

フォルダーなどのリソースへのアクセスを管理する際、アクセス制御リスト（ACL）とアクセス制御エントリ（ACE）として知られるリストとルールを使用します。これらは特定のデータに誰がアクセスできるかを定義します。

#### 特定のグループへのアクセスを拒否する

Costという名前のフォルダーがあると想像してください。マーケティングチームを除いて誰もアクセスできるようにしたい場合、ルールを正しく設定することで、マーケティングチームがアクセスを明示的に拒否し、他の全員にアクセスを許可できます。これは、マーケティングチームにアクセスを拒否するルールを、他の全員にアクセスを許可するルールの前に配置することで行います。

#### 拒否されたグループの特定メンバーへのアクセスを許可する

たとえば、マーケティングディレクターであるBobが、通常はマーケティングチームがアクセス権を持つべきではないCostフォルダーにアクセスする必要がある場合、Bobにアクセス権を付与する特定のルール（ACE）を追加し、マーケティングチームにアクセスを拒否するルールの前に配置します。これにより、Bobはチーム全体に一般的に制限があるにもかかわらずアクセス権を取得できます。

#### アクセス制御エントリの説明

ACEはACL内の個々のルールです。ユーザーまたはグループを識別し、許可または拒否されるアクセスを指定し、これらのルールがサブアイテムにどのように適用されるか（継承）を決定します。主要な2つのACEタイプがあります：

- **一般的なACE**：これらは広く適用され、すべてのオブジェクトに影響を与えるか、コンテナ（フォルダなど）と非コンテナ（ファイルなど
