# рдЯреЛрдХрди рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>тШБя╕П рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдХреНрд▓рд╛рдЙрдб тШБя╕П</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ЁЯРж рдЯреНрд╡рд┐рдЯрд░ ЁЯРж</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ЁЯОЩя╕П рдЯреНрд╡рд┐рдЪ ЁЯОЩя╕П</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ЁЯОе рдпреВрдЯреНрдпреВрдм ЁЯОе</strong></a></summary>

* рдХреНрдпрд╛ рдЖрдк **рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХрдВрдкрдиреА** рдореЗрдВ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ? рдХреНрдпрд╛ рдЖрдк рдЕрдкрдиреА рдХрдВрдкрдиреА рдХреЛ **рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд** рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ? рдпрд╛ рдХреНрдпрд╛ рдЖрдкрдХреЛ **PEASS рдХреА рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рдХрд╛ рдЙрдкрдпреЛрдЧ** рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ? [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ!
* [**рдж рдкреАрдПрд╕ рдлреИрдорд┐рд▓реА**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFT рд╕рдВрдЧреНрд░рд╣**](https://opensea.io/collection/the-peass-family)
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**ЁЯТм**](https://emojipedia.org/speech-balloon/) [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ рдореБрдЭреЗ **рдЯреНрд╡рд┐рдЯрд░** рдкрд░ **рдлрд╝реЙрд▓реЛ** рдХрд░реЗрдВ [**ЁЯРж**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ рдФрд░ PRs рд╕рдмрдорд┐рдЯ рдХрд░реЗрдВ [hacktricks рд░реЗрдкреЛ](https://github.com/carlospolop/hacktricks) рдФрд░ [hacktricks-cloud рд░реЗрдкреЛ](https://github.com/carlospolop/hacktricks-cloud) рдореЗрдВред**

</details>

## рдЯреЛрдХрди

рдпрджрд┐ рдЖрдкрдХреЛ **рдкрддрд╛ рдирд╣реАрдВ рд╣реИ рдХрд┐ Windows рдПрдХреНрд╕реЗрд╕ рдЯреЛрдХрдиреНрд╕ рдХреНрдпрд╛ рд╣реЛрддреЗ рд╣реИрдВ**, рддреЛ рдЖрдЧреЗ рдмрдврд╝рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдЗрд╕ рдкреЗрдЬ рдХреЛ рдкрдврд╝реЗрдВ:

{% content-ref url="../access-tokens.md" %}
[access-tokens.md](../access-tokens.md)
{% endcontent-ref %}

**рд╢рд╛рдпрдж рдЖрдк рдЙрди рдЯреЛрдХрдиреНрд╕ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЛ рдмрдврд╝рд╛ рд╕рдХрддреЗ рд╣реЛ**

### SeImpersonatePrivilege (3.1.1)

рдЗрд╕ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдХреЛ рд░рдЦрдиреЗ рд╡рд╛рд▓реА рдХреЛрдИ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХрд┐рд╕реА рднреА **рдЯреЛрдХрди** рдХреЛ **рдЕрдиреБрдХрд░рдг** рдХрд░ рд╕рдХрддреА рд╣реИ (рд▓реЗрдХрд┐рди рдирдпрд╛ рдЯреЛрдХрди рдирд╣реАрдВ рдмрдирд╛ рд╕рдХрддреА рд╣реИ) рдЬрд┐рд╕рдХреЗ рд▓рд┐рдП рд╡рд╣ рд╕рдВрдмрдВрдзрд┐рдд рд╣реИрдВрдбрд▓ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреА рд╣реИред рдЖрдк рдПрдХ **рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реА рдЯреЛрдХрди** рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдПрдХ **Windows рд╕реЗрд╡рд╛** (DCOM) рд╕реЗ (рдПрдирдЯреАрдПрд▓рдПрдо рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ) рдЬрдм рд╡рд╣ рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рдХреЗ рдЦрд┐рд▓рд╛рдл рдПрдХ **NTLM рдкреНрд░рдорд╛рдгреАрдХрд░рдг** рдХрд░рддреА рд╣реИ, рдлрд┐рд░ **SYSTEM** рдХреЗ рд░реВрдк рдореЗрдВ рдПрдХ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рддреА рд╣реИред [juicy-potato](https://github.com/ohpe/juicy-potato), [RogueWinRM ](https://github.com/antonioCoco/RogueWinRM)(winrm рдЕрдХреНрд╖рдо рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП), [SweetPotato](https://github.com/CCob/SweetPotato), [PrintSpoofer](https://github.com/itm4n/PrintSpoofer) рдХреЗ рд╕рд╛рде рдЗрд╕реЗ рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рдХрд░реЗрдВ:

{% content-ref url="../roguepotato-and-printspoofer.md" %}
[roguepotato-and-printspoofer.md](../roguepotato-and-printspoofer.md)
{% endcontent-ref %}

{% content-ref url="../juicypotato.md" %}
[juicypotato.md](../juicypotato.md)
{% endcontent-ref %}

### SeAssignPrimaryPrivilege (3.1.2)

рдпрд╣ **SeImpersonatePrivilege** рдХреЗ рдмрд╣реБрдд рд╣реА рд╕рдорд╛рди рд╣реИ, рдпрд╣ рдПрдХреАрдХреГрдд рдЯреЛрдХрди рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП **рдПрдХреАрдХреГрдд рд╡рд┐рдзрд┐** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдЧрд╛ред
рдлрд┐рд░, рдпрд╣ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдПрдХ рдирдП/рд╕рд╕реНрдкреЗрдВрдб рдХрд┐рдП рдЧрдП рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ **рдкреНрд░рд╛рдердорд┐рдХ рдЯреЛрдХрди рд╕реМрдВрдкрдиреЗ** рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реА рдЕрдиреБрдХрд░рдг рдЯреЛрдХрди рдХреЗ рд╕рд╛рде рдЖрдк рдПрдХ рдкреНрд░рд╛рдердорд┐рдХ рдЯреЛрдХрди (DuplicateTokenEx) рдЙрддреНрдкрдиреНрди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
рдЯреЛрдХрди рдХреЗ рд╕рд╛рде, рдЖрдк 'CreateProcessAsUser' рдХреЗ рд╕рд╛рде рдПрдХ **рдирдИ рдкреНрд░рдХреНрд░рд┐рдпрд╛** рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ рдпрд╛ рдПрдХ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд╕рд╕реНрдкреЗрдВрдб рдХрд░рдХреЗ рдЯреЛрдХрди рд╕реЗрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ (рд╕рд╛рдорд╛рдиреНрдпрддрдГ, рдЪрд▓ рд░рд╣реА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рдкреНрд░рд╛рдердорд┐рдХ рдЯреЛрдХрди рдХреЛ рдЖрдк рд╕рдВрд╢реЛрдзрд┐рдд рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ)ред

### SeTcbPrivilege (3.1.3)

рдпрджрд┐ рдЖрдкрдиреЗ рдЗрд╕ рдЯреЛрдХрди рдХреЛ рд╕рдХреНрд╖рдо рдХрд┐рдпрд╛ рд╣реИ рддреЛ рдЖрдк **KERB\_S4U\_LOGON** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХрд┐рд╕реА рднреА рдЕрдиреНрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд▓рд┐рдП **рдЕрдиреБрдХрд░рдг рдЯреЛрдХрди** рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬрдмрдХрд┐ рдкреНрд░рдорд╛рдг-рдкрддреНрд░ рдХреЛ рдирд╣реАрдВ рдЬрд╛рдирддреЗ рд╣реИрдВ, рдЯреЛрдХрди рдореЗрдВ рдПрдХ **рд╡рд┐рдЪрд┐рддреНрд░ рд╕рдореВрд╣** (рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ) рдЬреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВ, рдЯреЛрдХрди рдХреЗ **рдЕрдЦрдВрдбрддрд╛ рд╕реНрддрд░** рдХреЛ "**рдордзреНрдпрдо**" рдореЗрдВ рд╕реЗрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдФрд░ рдЗрд╕ рдЯреЛрдХрди рдХреЛ **рд╡рд░реНрддрдорд╛рди рдзрд╛рдЧреЗ** (SetThreadToken) рдХреЛ рд╕реМрдВрдк рд╕рдХрддреЗ рд╣реИрдВред

### SeBackupPrivilege (3.1.4)

рдпрд╣ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╕рд┐рд╕реНрдЯрдо рдХреЛ рдХрд┐рд╕реА рднреА рдлрд╝рд╛рдЗрд▓ рдХреЗ рд▓рд┐рдП **рд╕рднреА рдкрдврд╝рдиреЗ рдХреА** рдЕрдиреБрдорддрд┐ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рддрд╛ рд╣реИ (рдХреЗрд╡рд▓ рдкрдврд╝рдиреЗ рдХреЗ рд▓
### SeRestorePrivilege (3.1.5)

**рд▓рд┐рдЦрдиреЗ рдХреА рдкрд╣реБрдВрдЪ** рд╕рд┐рд╕реНрдЯрдо рдкрд░ рдХрд┐рд╕реА рднреА рдлрд╝рд╛рдЗрд▓ рдХреЛ, рдлрд╝рд╛рдЗрд▓ рдХреА ACL рдХреЗ рдмрд╛рд╡рдЬреВрдж, рд╣реЛрддреА рд╣реИред\
рдЖрдк **рд╕реЗрд╡рд╛рдУрдВ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**, DLL Hijacking рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, **рдбреАрдмрдЧрд░** рд╕реЗрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ (Image File Execution Options)... рдЗрд╕рдореЗрдВ рдмрдврд╝рдиреЗ рдХреЗ рд▓рд┐рдП рдХрдИ рд╡рд┐рдХрд▓реНрдк рд╣реИрдВред

### SeCreateTokenPrivilege (3.1.6)

рдпрд╣ рдЯреЛрдХрди **рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ** EoP рд╡рд┐рдзрд┐ рдХреЗ рд░реВрдк рдореЗрдВ **рдХреЗрд╡рд▓** рддрднреА рдЬрдм рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ **рдЯреЛрдХрди рдХрд╛ рдЕрдиреБрдХрд░рдг рдХрд░ рд╕рдХрддрд╛ рд╣реИ** (рдпрд╣рд╛рдВ рддрдХ рдХрд┐ SeImpersonatePrivilege рдХреЗ рдмрд┐рдирд╛ рднреА)ред\
рдПрдХ рд╕рдВрднрд╛рд╡рд┐рдд рдкрд░рд┐рджреГрд╢реНрдп рдореЗрдВ, рдпрджрд┐ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЯреЛрдХрди рдХрд╛ рдЕрдиреБрдХрд░рдг рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдпрд╣ рд╡рд╣реА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд▓рд┐рдП рд╣реИ рдФрд░ рдЕрд╡рд╢реНрдпрдХрддрд╛ рд╕реНрддрд░ рд╡рд░реНрддрдорд╛рди рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рд╕реНрддрд░ рд╕реЗ рдХрдо рдпрд╛ рдмрд░рд╛рдмрд░ рд╣реИред\
рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ **рдПрдХ рдЕрдиреБрдХрд░рдг рдЯреЛрдХрди рдмрдирд╛ рд╕рдХрддрд╛ рд╣реИ** рдФрд░ рдЗрд╕рдореЗрдВ рдПрдХ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реА рд╕рдореВрд╣ SID рдЬреЛрдбрд╝ рд╕рдХрддрд╛ рд╣реИред

### SeLoadDriverPrivilege (3.1.7)

**рдбрд┐рд╡рд╛рдЗрд╕ рдбреНрд░рд╛рдЗрд╡рд░ рд▓реЛрдб рдФрд░ рдЕрдирд▓реЛрдб рдХрд░реЗрдВред**\
рдЖрдкрдХреЛ ImagePath рдФрд░ Type рдХреЗ рд▓рд┐рдП рд░рдЬрд┐рд╕реНрдЯреНрд░реА рдореЗрдВ рдПрдХ рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐ рдмрдирд╛рдиреА рд╣реЛрдЧреАред\
рдЖрдкрдХреЛ HKLM рдореЗрдВ рд▓рд┐рдЦрдиреЗ рдХреА рдкрд╣реБрдВрдЪ рдирд╣реАрдВ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЖрдкрдХреЛ **HKCU рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╣реЛрдЧрд╛**ред рд▓реЗрдХрд┐рди HKCU рдХрд░реНрдирд▓ рдХреЗ рд▓рд┐рдП рдХреБрдЫ рдирд╣реАрдВ рд╣реЛрддрд╛ рд╣реИ, рдпрд╣рд╛рдВ рдХрд░реНрдирд▓ рдХреЛ рдирд┐рд░реНрджреЗрд╢рд┐рдд рдХрд░рдиреЗ рдФрд░ рдбреНрд░рд╛рдЗрд╡рд░ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХреЗ рд▓рд┐рдП рдЕрдкреЗрдХреНрд╖рд┐рдд рдкрде рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХрд╛ рддрд░реАрдХрд╛ рд╣реИ: "\Registry\User\S-1-5-21-582075628-3447520101-2530640108-1003\System\CurrentControlSet\Services\DriverName" (рд╡рд░реНрддрдорд╛рди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХрд╛ **RID** рд╣реИ)ред\
рдЗрд╕рд▓рд┐рдП, рдЖрдкрдХреЛ **HKCU рдореЗрдВ рдЙрд╕ рдкреВрд░реЗ рдкрде рдХреЛ рдмрдирд╛рдирд╛ рд╣реЛрдЧрд╛ рдФрд░ ImagePath** (рдмрд╛рдЗрдирд░реА рдХрд╛ рдкрде рдЬреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрдиреЗ рдЬрд╛ рд░рд╣рд╛ рд╣реИ) **рдФрд░ Type** (SERVICE\_KERNEL\_DRIVER 0x00000001) рд╕реЗрдЯ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред

{% content-ref url="abuse-seloaddriverprivilege.md" %}
[abuse-seloaddriverprivilege.md](abuse-seloaddriverprivilege.md)
{% endcontent-ref %}

### SeTakeOwnershipPrivilege (3.1.8)

рдпрд╣ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдмрд╣реБрдд рд╕рдорд╛рди **SeRestorePrivilege** рдХреЗ рд╕рд╛рде рд╣реИред\
рдпрд╣ рдПрдХ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ "рд╡рд┐рдЪрд╛рд░рдзреАрди рдкрд╣реБрдВрдЪ рдХреЗ рдмрд┐рдирд╛ рдПрдХ рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЗ рд╕реНрд╡рд╛рдорд┐рддреНрд╡ рдХреЛ рд▓реЗ рд╕рдХрдиреЗ" рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдХрд░ WRITE\_OWNER рдкрд╣реБрдВрдЪ рдЕрдзрд┐рдХрд╛рд░ рдХреЛ рдкреНрд░рджрд╛рди рдХрд░рдХреЗ рд╣реЛрддрд╛ рд╣реИред\
рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рдЖрдкрдХреЛ рд░рдЬрд┐рд╕реНрдЯреНрд░реА рдХреБрдВрдЬреА рдХрд╛ рд╕реНрд╡рд╛рдорд┐рддреНрд╡ **рд▓реЗ рд▓реЗрдирд╛ рд╣реЛрдЧрд╛** рдЬрд┐рд╕ рдкрд░ рдЖрдк рд▓рд┐рдЦрдиреЗ рдЬрд╛ рд░рд╣реЗ рд╣реИрдВ рдФрд░ рдЗрд╕реЗ **DACL рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд** рдХрд░рдирд╛ рд╣реЛрдЧрд╛ рддрд╛рдХрд┐ рдЖрдк рдЗрд╕ рдкрд░ рд▓рд┐рдЦ рд╕рдХреЗрдВред
```bash
takeown /f 'C:\some\file.txt' #Now the file is owned by you
icacls 'C:\some\file.txt' /grant <your_username>:F #Now you have full access
# Use this with files that might contain credentials such as
%WINDIR%\repair\sam
%WINDIR%\repair\system
%WINDIR%\repair\software
%WINDIR%\repair\security
%WINDIR%\system32\config\security.sav
%WINDIR%\system32\config\software.sav
%WINDIR%\system32\config\system.sav
%WINDIR%\system32\config\SecEvent.Evt
%WINDIR%\system32\config\default.sav
c:\inetpub\wwwwroot\web.config
```
### SeDebugPrivilege (3.1.9)

рдЗрд╕реЗ рдзрд╛рд░рдХ рдХреЛ рджреВрд╕рд░реЗ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ **рдбреАрдмрдЧ рдХрд░рдиреЗ** рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рдЗрд╕ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреА рдореЗрдореЛрд░реА рдореЗрдВ **рдкрдврд╝рдиреЗ рдФрд░ рд▓рд┐рдЦрдиреЗ** рдХреА рд╢рд╛рдорд┐рд▓ рд╣реЛрддреА рд╣реИред\
рдЗрд╕ рдЕрдиреБрдорддрд┐ рдХреЗ рд╕рд╛рде рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рд╡рд┐рднрд┐рдиреНрди **рдореЗрдореЛрд░реА рдЗрдВрдЬреЗрдХреНрд╢рди** рд░рдгрдиреАрддрд┐рдпрд╛рдБ рд╣реИрдВ рдЬреЛ рдЕрдзрд┐рдХрд╛рдВрд╢ AV/HIPS рд╕рдорд╛рдзрд╛рдиреЛрдВ рдХреЛ рдЯрд╛рд▓ рд╕рдХрддреА рд╣реИрдВред

#### рдореЗрдореЛрд░реА рдбрдВрдк

рдЗрд╕ рдЕрдиреБрдорддрд┐ рдХреЗ **рджреБрд░реБрдкрдпреЛрдЧ** рдХрд╛ рдПрдХ рдЙрджрд╛рд╣рд░рдг рд╣реИ [ProcDump](https://docs.microsoft.com/en-us/sysinternals/downloads/procdump) рдХреЛ [SysInternals](https://docs.microsoft.com/en-us/sysinternals/downloads/sysinternals-suite) рд╕реЗ рдЪрд▓рд╛рдирд╛ рдФрд░ рдПрдХ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреА рдореЗрдореЛрд░реА рдХреЛ **рдбрдВрдк рдХрд░рдирд╛**ред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, **рд╕реНрдерд╛рдиреАрдп рд╕реБрд░рдХреНрд╖рд╛ рдкреНрд░рд╛рдзрд┐рдХрд░рдг рдЙрдкрд╕реНрдерд┐рддрд┐ рдЙрдкрд╕реНрдерд╛рдкрди рд╕реЗрд╡рд╛ (**[**LSASS**](https://en.wikipedia.org/wiki/Local\_Security\_Authority\_Subsystem\_Service)**)** рдкреНрд░рдХреНрд░рд┐рдпрд╛, рдЬреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╢реНрд░реЗрдгреАрдкрддреНрд░реЛрдВ рдХреЛ рдПрдХ рдкреНрд░рдгрд╛рд▓реА рдореЗрдВ рд▓реЙрдЧ рдСрди рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рддреА рд╣реИред

рдлрд┐рд░ рдЖрдк рдорд┐рдореАрдХреЗрдЯреНрдЬрд╝ рдореЗрдВ рдЗрд╕ рдбрдВрдк рдХреЛ рд▓реЛрдб рдХрд░рдХреЗ рдкрд╛рд╕рд╡рд░реНрдб рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```
mimikatz.exe
mimikatz # log
mimikatz # sekurlsa::minidump lsass.dmp
mimikatz # sekurlsa::logonpasswords
```
#### RCE

рдпрджрд┐ рдЖрдк `NT SYSTEM` рд╢реЗрд▓ рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рддреЛ рдЖрдк рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

* ****[**SeDebugPrivilegePoC**](https://github.com/daem0nc0re/PrivFu/tree/main/PrivilegedOperations/SeDebugPrivilegePoC)****
* ****[**psgetsys.ps1**](https://raw.githubusercontent.com/decoder-it/psgetsystem/master/psgetsys.ps1)****
```powershell
# Get the PID of a process running as NT SYSTEM
import-module psgetsys.ps1; [MyProcess]::CreateProcessFromParent(<system_pid>,<command_to_execute>)
```
## рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ

To check the privileges of a user, you can use the following methods:

### 1. Using the `whoami` command

The `whoami` command displays the username of the current user. By default, it also shows the group memberships and privileges associated with the user.

```plaintext
whoami /priv
```

### 2. Using the `net user` command

The `net user` command provides detailed information about a user account, including the group memberships and privileges.

```plaintext
net user <username>
```

### 3. Using the `whoami /all` command

The `whoami /all` command displays detailed information about the current user, including the security privileges and group memberships.

```plaintext
whoami /all
```

### 4. Using the `secpol.msc` GUI

You can also use the `secpol.msc` GUI to check the privileges of a user. Follow these steps:

1. Open the "Local Security Policy" by searching for `secpol.msc` in the Start menu.
2. In the left pane, navigate to "Security Settings" > "Local Policies" > "User Rights Assignment".
3. In the right pane, you will find a list of user rights and the users or groups assigned to them.

By checking the privileges of a user, you can identify any potential vulnerabilities or opportunities for privilege escalation.
```
whoami /priv
```
рд╡реЗ **рдЯреЛрдХрди рдЬреЛ рдЕрдХреНрд╖рдо рджрд┐рдЦрд╛рдИ рджреЗрддреЗ рд╣реИрдВ** рдХреЛ рд╕рдХреНрд╖рдо рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЖрдк рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ _рд╕рдХреНрд╖рдо_ рдФрд░ _рдЕрдХреНрд╖рдо_ рдЯреЛрдХрди рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

### рд╕рднреА рдЯреЛрдХрдиреЛрдВ рдХреЛ рд╕рдХреНрд╖рдо рдХрд░реЗрдВ

рдЖрдк [**EnableAllTokenPrivs.ps1**](https://raw.githubusercontent.com/fashionproof/EnableAllTokenPrivs/master/EnableAllTokenPrivs.ps1) рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╕рднреА рдЯреЛрдХрдиреЛрдВ рдХреЛ рд╕рдХреНрд╖рдо рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```powershell
.\EnableAllTokenPrivs.ps1
whoami /priv
```
рдпрд╛ рдЗрд╕ [рдкреЛрд╕реНрдЯ](https://www.leeholmes.com/adjusting-token-privileges-in-powershell/) рдореЗрдВ рдПрдореНрдмреЗрдб рдХрд┐рдпрд╛ рдЧрдпрд╛ **рд╕реНрдХреНрд░рд┐рдкреНрдЯ**ред

## рддрд╛рд▓рд┐рдХрд╛

рдкреВрд░реНрдг рдЯреЛрдХрди рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдЪреАрдЯрд╢реАрдЯ [https://github.com/gtworek/Priv2Admin](https://github.com/gtworek/Priv2Admin) рдкрд░ рдЙрдкрд▓рдмреНрдз рд╣реИ, рдиреАрдЪреЗ рд╕рд╛рд░рд╛рдВрд╢ рдореЗрдВ рдХреЗрд╡рд▓ рдкреНрд░рд╢рд╛рд╕рдХ рд╕рддреНрд░ рдпрд╛ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ рдкрдврд╝рдиреЗ рдХреЗ рд▓рд┐рдП рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд╕реАрдзреЗ рддрд░реАрдХреЛрдВ рдХреА рд╕реВрдЪреА рджреА рдЧрдИ рд╣реИред

| рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░                | рдкреНрд░рднрд╛рд╡       | рдЙрдкрдХрд░рдг                   | рдирд┐рд╖реНрдкрд╛рджрди рдкрде                                                                                                                                                                                                                                                                                                                                     | рдЯрд┐рдкреНрдкрдгрд┐рдпрд╛рдБ                                                                                                                                                                                                                                                                                                                    |
| -------------------------- | ----------- | ----------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **`SeAssignPrimaryToken`** | _**рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ**_ | рддреГрддреАрдп рдкрдХреНрд╖ рдЙрдкрдХрд░рдг          | _"рдЗрд╕рд╕реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЯреЛрдХрди рдХреА рдЕрдиреБрдХрд░рдг рдХрд░рдиреЗ рдФрд░ рдЙрдкрдХрд░рдгреЛрдВ рдЬреИрд╕реЗ potato.exe, rottenpotato.exe рдФрд░ juicypotato.exe рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ nt рд╕рд┐рд╕реНрдЯрдо рдореЗрдВ рдкреНрд░рд╡реЗрд╢ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд╣реЛрдЧреА"_                                                                                                                                                                                                      | рдЕрджреНрдпрддрди рдХреЗ рд▓рд┐рдП рдзрдиреНрдпрд╡рд╛рдж [Aur├йlien Chalot](https://twitter.com/Defte_)ред рдореИрдВ рдЬрд▓реНрдж рд╣реА рдЗрд╕реЗ рдХреБрдЫ рдФрд░ рд░реЗрд╕рд┐рдкреА рдЬреИрд╕рд╛ рдмрдирд╛рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реВрдВрдЧрд╛ред                                                                                                                                                                                        |
| **`SeBackup`**             | **рдЦрддрд░рд╛**    | _**рдЕрдВрддрд░реНрдирд┐рд╣рд┐рдд рдЖрджреЗрд╢**_ | `robocopy /b` рдХреЗ рд╕рд╛рде рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдлрд╝рд╛рдЗрд▓реЗрдВ рдкрдврд╝реЗрдВ                                                                                                                                                                                                                                                                                                             | <p>- рдпрджрд┐ рдЖрдк %WINDIR%\MEMORY.DMP рдкрдврд╝ рд╕рдХрддреЗ рд╣реИрдВ рддреЛ рдпрд╣ рдФрд░ рднреА рд░реЛрдЪрдХ рд╣реЛ рд╕рдХрддрд╛ рд╣реИред<br><br>- <code>SeBackupPrivilege</code> (рдФрд░ robocopy) рдлрд╝рд╛рдЗрд▓реЗрдВ рдЦреЛрд▓рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рд╣рд╛рдпрдХ рдирд╣реАрдВ рд╣реИрдВред<br><br>- robocopy рдХреЛ /b рдкреИрд░рд╛рдореАрдЯрд░ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рджреЛрдиреЛрдВ SeBackup рдФрд░ SeRestore рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред</p>                                                                      |
| **`SeCreateToken`**        | _**рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ**_ | рддреГрддреАрдп рдкрдХреНрд╖ рдЙрдкрдХрд░рдг          | `NtCreateToken` рдХреЗ рд╕рд╛рде рд╕реНрдерд╛рдиреАрдп рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рдЕрдзрд┐рдХрд╛рд░реЛрдВ рдХреЗ рд╕рд╛рде рд╡рд┐рднрд┐рдиреНрди рдЯреЛрдХрди рдмрдирд╛рдПрдВред                                                                                                                                                                                                                                                                          |                                                                                                                                                                                                                                                                                                                                |
| **`SeDebug`**              | _**рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ**_ | **PowerShell**          | `lsass.exe` рдЯреЛрдХрди рдХреА рдирдХрд▓ рдХрд░реЗрдВред                                                                                                                                                                                                                                                                                                                   | [FuzzySecurity](https://github.com/FuzzySecurity/PowerShell-Suite/blob/master/Conjure-LSASS.ps1) рдкрд░ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рджреЗрдЦреЗрдВ                                                                                                                                                                                                         |
| **`SeLoadDriver`**         | _**рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ**_ | рддреГрддреАрдп рдкрдХреНрд╖ рдЙрдкрдХрд░рдг          | <p>1. рдРрд╕рд╛ рдмрдЧреАрд▓рд╛ рдХрд░реНрдирд▓ рдбреНрд░рд╛рдЗрд╡рд░ рд▓реЛрдб рдХрд░реЗрдВ рдЬреИрд╕реЗ <code>szkg64.sys</code><br>2. рдбреНрд░рд╛рдЗрд╡рд░ рдХреА рдХрдордЬреЛрд░реА рдХрд╛ рд╢реЛрд╖рдг рдХрд░реЗрдВ<br><br>рд╡реИрдХрд▓реНрдкрд┐рдХ рд░реВрдк рд╕реЗ, рдЗрд╕ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рд╕реБрд░рдХреНрд╖рд╛ рд╕рдВрдмрдВрдзрд┐рдд рдбреНрд░рд╛рдЗрд╡рд░реЛрдВ рдХреЛ <code>ftlMC</code> рдЗрдирдмрд┐рд▓реНрдЯ рдЖрджреЗрд╢ рдХреЗ рд╕рд╛рде рдЕрдирд▓реЛрдб рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдЙрджрд╛ред: <code>fltMC sysmondrv</code></p>                                                                           | <p>1. <code>szkg64</code> рдХрдордЬреЛрд░реА [CVE-2018-15732](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-15732) рдХреЗ рд░реВрдк рдореЗрдВ рд╕реВрдЪреАрдмрджреНрдз рд╣реИ<br>2. <code>szkg64</code> [рд╢реЛрд╖рдг рдХреЛрдб](https://www.greyhathacker.net/?p=1025) рдХреЛ [Parvez Anwar](https://twitter.com/parvezghh) рдиреЗ рдмрдирд╛рдпрд╛ рд╣реИ</p> |
| **`SeRestore`**            | _**рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ**_ | **PowerShell**          | <p>1. SeRestore рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдХреЗ рд╕рд╛рде PowerShell/ISE рд▓реЙрдиреНрдЪ рдХрд░реЗрдВред<br>2. [Enable-SeRestorePrivilege](https://github.com/gtworek/PSBits/blob/master/Misc/EnableSeRestorePrivilege.ps1) рдХреЗ рд╕рд╛рде рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╕рдХреНрд╖рдо рдХрд░реЗрдВред<br>3. utilman.exe рдХреЛ utilman.old рдореЗрдВ рдирд╛рдорд╛рдВрдХрд┐рдд рдХрд░реЗрдВ<br>4. cmd.exe рдХреЛ utilman.exe рдореЗрдВ рдирд╛рдорд╛рдВрдХрд┐рдд рдХрд░реЗрдВ<br>5. рдХрдВрд╕реЛрд▓ рд▓реЙрдХ рдХрд░реЗрдВ рдФрд░ Win+U рджрдмрд╛рдПрдВ</p> | рдХреБрдЫ AV рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ рджреНрд╡рд╛рд░рд╛ рд╣рдорд▓рд╛ рдкрд╣рдЪрд╛рдирд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред<p>рд╡реИрдХрд▓реНрдкрд┐рдХ рддрд░реАрдХрд╛ рдЙрд╕реА рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ "рдкреНрд░реЛрдЧреНрд░рд╛рдо рдлрд╝рд╛рдЗрд▓" рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рд╕реЗрд╡рд╛ рдмрд╛рдЗрдирд░реА рдХреЛ рдмрджрд▓рдХрд░ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рд╣реЛ рд╕рдХрддрд╛ рд╣реИ</p>                                                                                                                                                            |
| **`SeTakeOwnership`**      | _**рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ**_ | _**рдЕрдВрддрд░реНрдирд┐рд╣рд┐рдд рдЖрджреЗрд╢**_ | <p>1. <code>takeown.exe /f "%windir%\system32"</code><br>2. <code>icalcs.exe "%windir%\system32" /grant "%username%":F</code><br>3. cmd.exe рдХреЛ utilman.exe рдореЗрдВ рдирд╛рдорд╛рдВрдХрд┐рдд рдХрд░реЗрдВ<br>4. рдХрдВрд╕реЛрд▓ рд▓реЙрдХ рдХрд░реЗрдВ рдФрд░ Win+U рджрдмрд╛рдПрдВ</p>                                                                                                                                       | рдХреБрдЫ AV рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ рджреНрд╡рд╛рд░рд╛ рд╣рдорд▓рд╛ рдкрд╣рдЪрд╛рдирд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред<p>рд╡реИрдХрд▓реНрдкрд┐рдХ рддрд░реАрдХрд╛ рдЙрд╕реА рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ "рдкреНрд░реЛрдЧреНрд░рд╛рдо рдлрд╝рд╛рдЗрд▓" рдо
