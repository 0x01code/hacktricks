# Windows Credentials Protections

## Credentials Protections

<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

рджреВрд╕рд░реЗ рддрд░реАрдХреЗ HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП:

* рдЕрдЧрд░ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рдХрд▓реЗрдХреНрд╢рди, [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдЦреЛрдЬреЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ **рдореБрдЭреЗ** **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдХреЛ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗред

</details>

## WDigest

[WDigest](https://technet.microsoft.com/pt-pt/library/cc778868(v=ws.10).aspx?f=255&MSPPError=-2147217396) рдкреНрд░реЛрдЯреЛрдХреЙрд▓, рдЬреЛ Windows XP рдХреЗ рд╕рд╛рде рдкреЗрд╢ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛, HTTP рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЗ рд▓рд┐рдП рдбрд┐рдЬрд╝рд╛рдЗрди рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рдФрд░ **Windows XP рд╕реЗ Windows 8.0 рдФрд░ Windows Server 2003 рд╕реЗ Windows Server 2012 рддрдХ** рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рд╕рдХреНрд╖рдо рд╣реИред рдЗрд╕ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд╕реЗрдЯрд┐рдВрдЧ рд╕реЗ **LSASS рдореЗрдВ рдкреНрд▓реЗрди-рдЯреЗрдХреНрд╕реНрдЯ рдкрд╛рд╕рд╡рд░реНрдб рд╕реНрдЯреЛрд░реЗрдЬ** рд╣реЛрддреА рд╣реИред рд╣рдорд▓рд╛рд╡рд░ Mimikatz рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ **рдЗрди рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреЛ рдирд┐рдХрд╛рд▓ рд╕рдХрддрд╛ рд╣реИ** рдЬреЛ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдХреЗ:
```bash
sekurlsa::wdigest
```
рдЗрд╕ рд╕реБрд╡рд┐рдзрд╛ рдХреЛ рдмрдВрдж рдпрд╛ рдЪрд╛рд▓реВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, _**HKEY\_LOCAL\_MACHINE\System\CurrentControlSet\Control\SecurityProviders\WDigest**_ рдХреЗ рднреАрддрд░ _**UseLogonCredential**_ рдФрд░ _**Negotiate**_ рд░рдЬрд┐рд╕реНрдЯреНрд░реА рдХреБрдВрдЬреА рдХреЛ "1" рдкрд░ рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред рдпрджрд┐ рдпреЗ рдХреБрдВрдЬреА **рдЕрдиреБрдкрд╕реНрдерд┐рдд рд╣реИ рдпрд╛ "0" рдкрд░ рд╕реЗрдЯ рд╣реИ**, рддреЛ WDigest **рдЕрдХреНрд╖рдо рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ**:
```bash
reg query HKLM\SYSTEM\CurrentControlSet\Control\SecurityProviders\WDigest /v UseLogonCredential
```
## LSA рд╕реБрд░рдХреНрд╖рд╛

**Windows 8.1** рд╕реЗ рд╢реБрд░реВ рдХрд░рдХреЗ, Microsoft рдиреЗ LSA рдХреА рд╕реБрд░рдХреНрд╖рд╛ рдХреЛ **рдЕрд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рджреНрд╡рд╛рд░рд╛ рдЕрдирдзрд┐рдХреГрдд рдореЗрдореЛрд░реА рдкрдарди рдпрд╛ рдХреЛрдб рдЗрдВрдЬреЗрдХреНрд╢рди рдХреЛ рдмреНрд▓реЙрдХ рдХрд░рдиреЗ** рдореЗрдВ рд╕реБрд░рдХреНрд╖рд╛ рдХреЛ рдмрдврд╝рд╛ рджрд┐рдпрд╛ред рдпрд╣ рдЙрди рдЖрджреЗрд╢реЛрдВ рдХреЗ рд╕рд╛рдорд╛рдиреНрдп рдХрд╛рд░реНрдп рдХреЛ рд░реЛрдХрддрд╛ рд╣реИ рдЬреИрд╕реЗ `mimikatz.exe sekurlsa:logonpasswords`ред рдЗрд╕ **рдмрдврд╝реА рд╣реБрдИ рд╕реБрд░рдХреНрд╖рд╛ рдХреЛ рд╕рдХреНрд╖рдо рдХрд░рдиреЗ** рдХреЗ рд▓рд┐рдП, _**HKEY\_LOCAL\_MACHINE\SYSTEM\CurrentControlSet\Control\LSA**_ рдореЗрдВ _**RunAsPPL**_ рдорд╛рди рдХреЛ 1 рдкрд░ рд╕рдорд╛рдпреЛрдЬрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП:
```
reg query HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\LSA /v RunAsPPL
```
### рдмрд╛рдпрдкрд╛рд╕

рдЗрд╕ рд╕реБрд░рдХреНрд╖рд╛ рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИ рдЬрд┐рд╕рдХреЗ рд▓рд┐рдП Mimikatz рдбреНрд░рд╛рдЗрд╡рд░ mimidrv.sys рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:

![](../../.gitbook/assets/mimidrv.png)

## рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдЧрд╛рд░реНрдб

**рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдЧрд╛рд░реНрдб**, рдПрдХ рд╡рд┐рд╢реЗрд╖рддрд╛ рдЬреЛ рдХреЗрд╡рд▓ **Windows 10 (рдПрдВрдЯрд░рдкреНрд░рд╛рдЗрдЬ рдФрд░ рдПрдЬреБрдХреЗрд╢рди рд╕рдВрд╕реНрдХрд░рдг)** рдХреЗ рд▓рд┐рдП рд╣реИ, **рд╡рд░реНрдЪреБрдЕрд▓ рд╕реБрд░рдХреНрд╖рд┐рдд рдореЛрдб (VSM)** рдФрд░ **рд╡рд░реНрдЪреБрдЕрд▓рд╛рдЗрдЬреЗрд╢рди рдмреЗрд╕реНрдб рд╕рд┐рдХреНрдпреЛрд░рд┐рдЯреА (VBS)** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдорд╢реАрди рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдХреА рд╕реБрд░рдХреНрд╖рд╛ рдХреЛ рдмрдврд╝рд╛рддрд╛ рд╣реИред рдпрд╣ CPU рд╡рд░реНрдЪреБрдЕрд▓рд╛рдЗрдЬреЗрд╢рди рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ рддрд╛рдХрд┐ рдореБрдЦреНрдп рдСрдкрд░реЗрдЯрд┐рдВрдЧ рд╕рд┐рд╕реНрдЯрдо рдХреА рдкрд╣реБрдВрдЪ рд╕реЗ рджреВрд░, рд╕реБрд░рдХреНрд╖рд┐рдд рдореЗрдореЛрд░реА рд╕реНрдерд╛рди рдореЗрдВ рдХреБрдВрдЬреАрдп рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЛ рдЕрд▓рдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред рдпрд╣ рдЕрд▓рдЧрд╛рд╡ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдХрд░реНрдиреЗрд▓ рднреА VSM рдореЗрдореЛрд░реА рддрдХ рдкрд╣реБрдВрдЪ рдирд╣реАрдВ рдкрд╛ рд╕рдХрддрд╛, рдЬрд┐рд╕рд╕реЗ **рдкрд╛рд╕-рдж-рд╣реИрд╢** рдЬреИрд╕реЗ рд╣рдорд▓реЛрдВ рд╕реЗ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рд╕реБрд░рдХреНрд╖рд┐рдд рд░рд╣рддреЗ рд╣реИрдВред **рд▓реЛрдХрд▓ рд╕реБрд░рдХреНрд╖рд╛ рдкреНрд░рд╛рдзрд┐рдХрд░рдг (LSA)** рдЗрд╕ рд╕реБрд░рдХреНрд╖рд┐рдд рд╡рд╛рддрд╛рд╡рд░рдг рдореЗрдВ рдПрдХ рдЯреНрд░рд╕реНрдЯрд▓реЗрдЯ рдХреЗ рд░реВрдк рдореЗрдВ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ, рдЬрдмрдХрд┐ рдореБрдЦреНрдп рдСрдкрд░реЗрдЯрд┐рдВрдЧ рд╕рд┐рд╕реНрдЯрдо рдореЗрдВ **LSASS** рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗрд╡рд▓ VSM рдХреЗ LSA рдХреЗ рд╕рд╛рде рд╕рдВрд╡рд╛рдж рдХрд░рддреА рд╣реИред

рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ, **рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдЧрд╛рд░реНрдб** рд╕рдХреНрд░рд┐рдп рдирд╣реАрдВ рд╣реИ рдФрд░ рд╕рдВрдЧрдарди рдореЗрдВ рдореИрдиреНрдпреБрдЕрд▓ рд╕рдХреНрд░рд┐рдпрдг рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред рдпрд╣ **Mimikatz** рдЬреИрд╕реЗ рдЙрдкрдХрд░рдгреЛрдВ рдХреЗ рдЦрд┐рд▓рд╛рдл рд╕реБрд░рдХреНрд╖рд╛ рдХреЛ рдмрдврд╝рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ, рдЬреЛ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдирд┐рдХрд╛рд▓рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рдореЗрдВ рдмрд╛рдзрд┐рдд рд╣реЛрддреЗ рд╣реИрдВред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдХрд╕реНрдЯрдо **рд╕реБрд░рдХреНрд╖рд╛ рд╕рдорд░реНрдерди рдкреНрд░рджрд╛рддрд╛рдУрдВ (SSP)** рдХреЛ рдЬреЛрдбрд╝рдХрд░ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдХреЛ рд╕реНрдкрд╖реНрдЯ рдкрд╛рда рдореЗрдВ рдкрдХрдбрд╝рдиреЗ рдХреЗ рд▓рд┐рдП рд╡рд┐рдХрд▓реНрдкреЛрдВ рдХрд╛ рд╢реЛрдз рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

**рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдЧрд╛рд░реНрдб** рдХреЗ рд╕рдХреНрд░рд┐рдпрдг рд╕реНрдерд┐рддрд┐ рдХреА рд╕рддреНрдпрд╛рдкрди рдХреЗ рд▓рд┐рдП, рд░рдЬрд┐рд╕реНрдЯреНрд░реА рдХреБрдВрдЬреА **_HKLM\System\CurrentControlSet\Control\LSA_** рдХреЗ рддрд╣рдд **_LsaCfgFlags_** рдХреЛ рдЬрд╛рдВрдЪрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред "**1**" рдХрд╛ рдорд╛рди рд╕рдХреНрд░рд┐рдпрдг рдХреЛ **UEFI рд▓реЙрдХ** рдХреЗ рд╕рд╛рде рджрд░реНрд╢рд╛рддрд╛ рд╣реИ, "**2**" рд▓реЙрдХ рдХреЗ рдмрд┐рдирд╛, рдФрд░ "**0**" рдЗрд╕реЗ рд╕рдХреНрд░рд┐рдп рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИред рдпрд╣ рд░рдЬрд┐рд╕реНрдЯреНрд░реА рдЬрд╛рдВрдЪ, рдЬреЛ рдПрдХ рдордЬрдмреВрдд рд╕рдВрдХреЗрддрдХ рд╣реИ, рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдЧрд╛рд░реНрдб рдХреЛ рд╕рдХреНрд░рд┐рдп рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХрдорд╛рддреНрд░ рдХрджрдо рдирд╣реАрдВ рд╣реИред рдЗрд╕ рд╕реБрд╡рд┐рдзрд╛ рдХреЛ рд╕рдХреНрд░рд┐рдп рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╡рд┐рд╕реНрддреГрдд рдорд╛рд░реНрдЧрджрд░реНрд╢рди рдФрд░ рдПрдХ PowerShell рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдСрдирд▓рд╛рдЗрди рдЙрдкрд▓рдмреНрдз рд╣реИрдВред
```powershell
reg query HKLM\System\CurrentControlSet\Control\LSA /v LsaCfgFlags
```
рд╡рд┐рд╕реНрддреГрдд рд╕рдордЭ рдФрд░ рдирд┐рд░реНрджреЗрд╢реЛрдВ рдХреЗ рд▓рд┐рдП **Windows 10** рдореЗрдВ **Credential Guard** рдХреЛ рд╕рдХреНрд╖рдо рдХрд░рдиреЗ рдФрд░ **Windows 11 Enterprise рдФрд░ Education (рд╕рдВрд╕реНрдХрд░рдг 22H2)** рдХреЗ рд╕рдВрдЧрдд рд╕рд┐рд╕реНрдЯрдо рдореЗрдВ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП [Microsoft рдХреА рджрд╕реНрддрд╛рд╡реЗрдЬрд╝реА](https://docs.microsoft.com/en-us/windows/security/identity-protection/credential-guard/credential-guard-manage) рдкрд░ рдЬрд╛рдПрдВред

Credential рдХреИрдкреНрдЪрд░ рдХреЗ рд▓рд┐рдП рдХрд╕реНрдЯрдо SSPs рдХреЛ рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХреЗ рд╡рд┐рд╡рд░рдг [рдЗрд╕ рдЧрд╛рдЗрдб](../active-directory-methodology/custom-ssp.md) рдореЗрдВ рджрд┐рдП рдЧрдП рд╣реИрдВред

## RDP RestrictedAdmin Mode

**Windows 8.1 рдФрд░ Windows Server 2012 R2** рдиреЗ рдХрдИ рдирдП рд╕реБрд░рдХреНрд╖рд╛ рд╕реБрд╡рд┐рдзрд╛рдПрдБ рдкреЗрд╢ рдХреА, рдЬрд┐рд╕рдореЗрдВ рд╕реЗ рдПрдХ рд╣реИ **_RDP рдХреЗ рд▓рд┐рдП Restricted Admin mode_**ред рдпрд╣ рдореЛрдб **[рдкрд╛рд╕ рдж рд╣реИрд╢](https://blog.ahasayen.com/pass-the-hash/)** рд╣рдорд▓реЛрдВ рд╕реЗ рдЬреБрдбрд╝реА рдЬреЛрдЦрд┐рдореЛрдВ рдХреЛ рдХрдо рдХрд░рдХреЗ рд╕реБрд░рдХреНрд╖рд╛ рдХреЛ рдмрдврд╝рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдбрд┐рдЬрд╝рд╛рдЗрди рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред

рдкрд╛рд░рдВрдкрд░рд┐рдХ рд░реВрдк рд╕реЗ, RDP рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рджреВрд░рд╕реНрде рдХрдВрдкреНрдпреВрдЯрд░ рд╕реЗ рдХрдиреЗрдХреНрдЯ рдХрд░рддреЗ рд╕рдордп, рдЖрдкрдХреЗ credentials рд▓рдХреНрд╖рд┐рдд рдорд╢реАрди рдкрд░ рд╕реНрдЯреЛрд░ рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВред рдпрд╣ рдЦрд╛рд╕рддреМрд░ рдкрд░ рдЙрдЪреНрдЪ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рд╡рд╛рд▓реЗ рдЦрд╛рддреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╕рдордп рдПрдХ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╕реБрд░рдХреНрд╖рд╛ рдЬреЛрдЦрд┐рдо рдкреИрджрд╛ рдХрд░рддрд╛ рд╣реИред рд╣рд╛рд▓рд╛рдВрдХрд┐, **Restricted Admin mode** рдХреЗ рдкрд░рд┐рдЪрдп рдХреЗ рд╕рд╛рде, рдпрд╣ рдЬреЛрдЦрд┐рдо рдХрд╛рдлреА рдХрдо рд╣реЛ рдЬрд╛рддрд╛ рд╣реИред

**Restricted Admin mode** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ RDP рдХрдиреЗрдХреНрд╢рди рдкреНрд░рд╛рд░рдВрдн рдХрд░рддреЗ рд╕рдордп, рдЖрдкрдХреЗ credentials рдХреЛ рд╕реНрдЯреЛрд░ рдХ
```bash
reg query "HKEY_LOCAL_MACHINE\SOFTWARE\MICROSOFT\WINDOWS NT\CURRENTVERSION\WINLOGON" /v CACHEDLOGONSCOUNT
```
рдЗрди рдХреИрд╢ рдХрд┐рдП рдЧрдП рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рддрдХ рдкрд╣реБрдВрдЪ рдХреЛ рдХрдбрд╝реА рд╕реЗ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдХреЗрд╡рд▓ **SYSTEM** рдЦрд╛рддреЗ рдХреЛ рдЗрдиреНрд╣реЗрдВ рджреЗрдЦрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХ рдЕрдиреБрдорддрд┐рдпрд╛рдБ рд╣реИрдВред рдЗрд╕ рдЬрд╛рдирдХрд╛рд░реА рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдиреЗ рдкрд░ рдкреНрд░рд╢рд╛рд╕рдХреЛрдВ рдХреЛ SYSTEM рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЗ рд╕рд╛рде рдЗрд╕реЗ рджреЗрдЦрдирд╛ рд╣реЛрдЧрд╛ред рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рд╕реНрдЯреЛрд░ рдХрд┐рдП рдЧрдП рд╣реИрдВ: `HKEY_LOCAL_MACHINE\SECURITY\Cache`

**Mimikatz** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрдорд╛рдВрдб `lsadump::cache` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЗрди рдХреИрд╢ рдХрд┐рдП рдЧрдП рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреЛ рдирд┐рдХрд╛рд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП, рдореВрд▓ [рд╕реНрд░реЛрдд](http://juggernaut.wikidot.com/cached-credentials) рд╡реНрдпрд╛рдкрдХ рдЬрд╛рдирдХрд╛рд░реА рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред

## рд╕реБрд░рдХреНрд╖рд┐рдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛

**рд╕реБрд░рдХреНрд╖рд┐рдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕рдореВрд╣** рдореЗрдВ рд╕рджрд╕реНрдпрддрд╛ рдХрдИ рд╕реБрд░рдХреНрд╖рд╛ рд╡реГрджреНрдзрд┐ рд▓рд╛рддрд╛ рд╣реИ, рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рдЦрд┐рд▓рд╛рдл рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдЪреЛрд░реА рдФрд░ рджреБрд░реБрдкрдпреЛрдЧ рдХреЗ рдЦрд┐рд▓рд╛рдл рдЙрдЪреНрдЪ рд╕реНрддрд░ рдХреА рд╕реБрд░рдХреНрд╖рд╛ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддрд╛ рд╣реИ:

- **рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдбреЗрд▓реАрдЧреЗрд╢рди (CredSSP)**: рдпрджрд┐ **рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдбреЗрд▓реАрдЧреЗрд╢рди рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдиреЗ рд╡рд╛рд▓реА** рд╕рдореВрд╣ рдиреАрддрд┐ рд╕реЗрдЯрд┐рдВрдЧ рд╕рдХреНрд╖рдо рд╣реИ, рддреЛ рд╕реБрд░рдХреНрд╖рд┐рдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рд╕рд╛рджрд░ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдХреИрд╢ рдирд╣реАрдВ рдХрд┐рдП рдЬрд╛рдПрдВрдЧреЗред
- **Windows Digest**: **Windows 8.1 рдФрд░ Windows Server 2012 R2** рд╕реЗ рд╢реБрд░реВ рдХрд░рдХреЗ, рд╕рд┐рд╕реНрдЯрдо рд╕реБрд░рдХреНрд╖рд┐рдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рд╕рд╛рджрд░ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдХреИрд╢ рдирд╣реАрдВ рдХрд░реЗрдЧрд╛, рдЪрд╛рд╣реЗ Windows Digest рд╕реНрдерд┐рддрд┐ рд╣реЛ рдпрд╛ рди рд╣реЛред
- **NTLM**: рд╕рд┐рд╕реНрдЯрдо рд╕реБрд░рдХреНрд╖рд┐рдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рд╕рд╛рджрд░ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдпрд╛ NT рдПрдХ-рддрд░рдлрд╛ рдХрд╛рд░реНрдпреЛрдВ (NTOWF) рдХреИрд╢ рдирд╣реАрдВ рдХрд░реЗрдЧрд╛ред
- **Kerberos**: рд╕реБрд░рдХреНрд╖рд┐рдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рд▓рд┐рдП, Kerberos рдкреНрд░рдорд╛рдгреАрдХрд░рдг **DES** рдпрд╛ **RC4 рдХреБрдВрдЬрд┐рдпрд╛рдБ** рдирд╣реАрдВ рдЙрддреНрдкрдиреНрди рдХрд░реЗрдЧрд╛, рди рд╣реА рд╕рд╛рджрд░ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдпрд╛ рджреАрд░реНрдШрдХрд╛рд▓рд┐рдХ рдХреБрдВрдЬрд┐рдпрд╛рдБ рдЯрд┐рдХрдЯ-рдкреНрд░рджрд╛рди рдЯрд┐рдХрдЯ (TGT) рдкреНрд░рд╛рдкреНрддрд┐ рдХреЗ рдмрд╛рдж рд╕реЗ рдЕрдзрд┐рдХ рдХреИрд╢ рдХрд░реЗрдЧрд╛ред
- **рдСрдлрд▓рд╛рдЗрди рд╕рд╛рдЗрди-рдЗрди**: рд╕реБрд░рдХреНрд╖рд┐рдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рд╕рд╛рдЗрди-рдЗрди рдпрд╛ рдЕрдирд▓реЙрдХ рдкрд░ рдПрдХ рдХреИрд╢ рдирд┐рд░реНрдорд╛рддрд╛ рдирд╣реАрдВ рдмрдирд╛рдпрд╛ рдЬрд╛рдПрдЧрд╛, рдЬрд┐рд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдЗрди рдЦрд╛рддреЛрдВ рдХреЗ рд▓рд┐рдП рдСрдлрд▓рд╛рдЗрди рд╕рд╛рдЗрди-рдЗрди рдХрд╛ рд╕рдорд░реНрдерди рдирд╣реАрдВ рд╣реИред

рдпреЗ рд╕реБрд░рдХреНрд╖рд╛ рдЙрдкрд╛рдп рддрддреНрдХрд╛рд▓рд┐рдХ рд░реВрдк рд╕реЗ рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛, рдЬреЛ **рд╕реБрд░рдХреНрд╖рд┐рдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕рдореВрд╣** рдХрд╛ рд╕рджрд╕реНрдп рд╣реИ, рдЙрдкрдХрд░рдг рдореЗрдВ рд╕рд╛рдЗрди рдЗрди рдХрд░рддрд╛ рд╣реИ, рддреЛ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддреЗ рд╣реИрдВ рдХрд┐ рд╡рд┐рднрд┐рдиреНрди рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдХрдореНрдкреНрд░реЛрдорд╛рдЗрдЬ рдХреЗ рд╡рд┐рднрд┐рдиреНрди рддрд░реАрдХреЛрдВ рдХреЗ рдЦрд┐рд▓рд╛рдл рд╕реБрд░рдХреНрд╖рд╛ рдЙрдкрд╛рдп рд╕реНрдерд╛рдкрд┐рдд рд╣реИрдВред

рдЕрдзрд┐рдХ рд╡рд┐рд╕реНрддреГрдд рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП, рдЖрдзрд┐рдХрд╛рд░рд┐рдХ [рджрд╕реНрддрд╛рд╡реЗрдЬрд╝](https://docs.microsoft.com/en-us/windows-server/security/credentials-protection-and-management/protected-users-security-group) рдкрд░ рд╕рдВрдкрд░реНрдХ рдХрд░реЗрдВред
