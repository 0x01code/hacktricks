# CET & Shadow Stack

{% hint style="success" %}
Lernen Sie & √ºben Sie AWS-Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Lernen Sie & √ºben Sie GCP-Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtzen Sie HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositorys senden.

</details>
{% endhint %}

## Control Flow Enforcement Technology (CET)

**CET** ist eine Sicherheitsfunktion, die auf Hardwareebene implementiert ist und darauf abzielt, h√§ufige Angriffe auf die Kontrollflussmanipulation wie **Return-Oriented Programming (ROP)** und **Jump-Oriented Programming (JOP)** zu vereiteln. Diese Arten von Angriffen manipulieren den Ausf√ºhrungsfluss eines Programms, um b√∂sartigen Code auszuf√ºhren oder harmlose Codefragmente so zu verketten, dass sie eine b√∂sartige Aktion ausf√ºhren.

CET f√ºhrt zwei Hauptfunktionen ein: **Indirect Branch Tracking (IBT)** und **Shadow Stack**.

* **IBT** stellt sicher, dass indirekte Spr√ºnge und Aufrufe zu g√ºltigen Zielen erfolgen, die explizit als legale Ziele f√ºr indirekte Branches markiert sind. Dies wird durch die Verwendung eines neuen Befehlssatzes erreicht, der g√ºltige Ziele markiert und somit verhindert, dass Angreifer den Kontrollfluss zu beliebigen Positionen umleiten.
* **Shadow Stack** ist ein Mechanismus, der die Integrit√§t von R√ºckgabeadressen gew√§hrleistet. Er h√§lt eine gesicherte, versteckte Kopie von R√ºckgabeadressen getrennt vom regul√§ren Aufrufstapel. Wenn eine Funktion zur√ºckkehrt, wird die R√ºckgabeadresse gegen den Shadow Stack validiert, wodurch verhindert wird, dass Angreifer R√ºckgabeadressen auf dem Stapel √ºberschreiben, um den Kontrollfluss zu √ºbernehmen.

## Shadow Stack

Der **Shadow Stack** ist ein **dedizierter Stapel, der ausschlie√ülich zum Speichern von R√ºckgabeadressen verwendet wird**. Er arbeitet neben dem regul√§ren Stapel, ist jedoch gesch√ºtzt und vor normalem Programmablauf verborgen, was es f√ºr Angreifer schwierig macht, damit zu manipulieren. Das Hauptziel des Shadow Stacks besteht darin sicherzustellen, dass √Ñnderungen an R√ºckgabeadressen auf dem herk√∂mmlichen Stapel erkannt werden, bevor sie verwendet werden k√∂nnen, um ROP-Angriffe effektiv zu verhindern.

## Wie CET und Shadow Stack Angriffe verhindern

**ROP- und JOP-Angriffe** beruhen auf der F√§higkeit, den Kontrollfluss einer Anwendung zu √ºbernehmen, indem sie Schwachstellen ausnutzen, die es ihnen erm√∂glichen, Zeiger oder R√ºckgabeadressen auf dem Stapel zu √ºberschreiben. Indem sie den Fluss zu Sequenzen von vorhandenen Code-Gadgets oder Return-Oriented Programming-Gadgets lenken, k√∂nnen Angreifer beliebigen Code ausf√ºhren.

* Die Funktion **IBT von CET** erschwert diese Angriffe erheblich, indem sichergestellt wird, dass indirekte Branches nur zu Adressen springen k√∂nnen, die explizit als g√ºltige Ziele markiert wurden. Dies macht es unm√∂glich, dass Angreifer beliebige Gadgets im Bin√§rformat ausf√ºhren.
* Der **Shadow Stack** hingegen stellt sicher, dass selbst wenn ein Angreifer eine R√ºckgabeadresse auf dem normalen Stapel √ºberschreiben kann, die **Diskrepanz erkannt wird**, wenn die korrupte Adresse beim Zur√ºckkehren aus einer Funktion mit der sicheren Kopie im Shadow Stack verglichen wird. Wenn die Adressen nicht √ºbereinstimmen, kann das Programm beendet oder andere Sicherheitsma√ünahmen ergriffen werden, um zu verhindern, dass der Angriff erfolgreich ist.

{% hint style="success" %}
Lernen Sie & √ºben Sie AWS-Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Lernen Sie & √ºben Sie GCP-Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtzen Sie HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositorys senden.

</details>
{% endhint %}
