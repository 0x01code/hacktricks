# CET & Shadow Stack

<details>

<summary><strong>ゼロからヒーローまでのAWSハッキングを学ぶ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE（HackTricks AWS Red Team Expert）</strong></a><strong>！</strong></summary>

HackTricksをサポートする他の方法：

* **HackTricksで企業を宣伝したい**または**HackTricksをPDFでダウンロードしたい**場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS＆HackTricksスウェグ**](https://peass.creator-spring.com)を入手する
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクションを見つける
* **💬 [Discordグループ](https://discord.gg/hRep4RUj7f)**に参加するか、[telegramグループ](https://t.me/peass)に参加するか、**Twitter** 🐦 **@hacktricks\_live**](https://twitter.com/hacktricks\_live)**をフォローする。
* **ハッキングトリックを共有するには、[HackTricks](https://github.com/carlospolop/hacktricks)と[HackTricks Cloud](https://github.com/carlospolop/hacktricks-cloud)のGitHubリポジトリにPRを提出してください。**

</details>

## Control Flow Enforcement Technology (CET)

**CET**はハードウェアレベルで実装されたセキュリティ機能であり、**Return-Oriented Programming (ROP)**や**Jump-Oriented Programming (JOP)**などの一般的な制御フローのハイジャック攻撃を防ぐよう設計されています。これらの攻撃タイプは、プログラムの実行フローを操作して悪意のあるコードを実行したり、善意のコードの断片を連結して悪意のあるアクションを実行したりします。

CETには**Indirect Branch Tracking (IBT)**と**Shadow Stack**という2つの主要な機能が導入されています。

* **IBT**は、間接的なジャンプやコールが有効なターゲットに行われることを保証します。これは、新しい命令セットを使用して有効なターゲットを明示的にマークすることによって達成され、攻撃者が制御フローを任意の場所に逸らすのを防ぎます。
* **Shadow Stack**は、リターンアドレスの整合性を提供するメカニズムです。通常の呼び出しスタックとは別に、リターンアドレスのセキュアで隠されたコピーを保持します。関数がリターンするとき、リターンアドレスはシャドウスタックと照合され、攻撃者が制御フローをハイジャックするためにスタック上のリターンアドレスを上書きするのを防ぎます。

## Shadow Stack

**シャドウスタック**は、**リターンアドレスを保存するためだけに使用される専用スタック**です。通常のスタックと一緒に動作しますが、通常のプログラムの実行から保護され、隠されているため、攻撃者が不正に干渉するのは困難です。シャドウスタックの主な目的は、通常のスタック上のリターンアドレスに対する変更が使用される前に検出されることを確認し、効果的にROP攻撃を緩和することです。

## CETおよびShadow Stackが攻撃を防ぐ方法

**ROPおよびJOP攻撃**は、アプリケーションの制御フローをハイジャックする能力に依存しています。これは、スタック上のポインタやリターンアドレスを上書きすることを可能にする脆弱性を利用しています。既存のコードガジェットやリターン指向プログラミングガジェットのシーケンスにフローを誘導することで、攻撃者は任意のコードを実行できます。

* **CETのIBT**機能により、これらの攻撃は著しく困難になります。間接的なブランチは、明示的に有効なターゲットとしてマークされたアドレスにのみジャンプできるようになります。これにより、攻撃者がバイナリ全体にわたって任意のガジェットを実行することが不可能になります。
* 一方、**シャドウスタック**は、攻撃者が通常のスタック上のリターンアドレスを上書きできたとしても、関数から戻る際にシャドウスタックに格納されたセキュアコピーと照合することで**不整合が検出されます**。アドレスが一致しない場合、プログラムは終了したり他のセキュリティ対策を取ったりして、攻撃が成功しないようにします。 

<details>

<summary><strong>ゼロからヒーローまでのAWSハッキングを学ぶ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE（HackTricks AWS Red Team Expert）</strong></a><strong>！</strong></summary>

HackTricksをサポートする他の方法：

* **HackTricksで企業を宣伝したい**または**HackTricksをPDFでダウンロードしたい**場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS＆HackTricksスウェグ**](https://peass.creator-spring.com)を入手する
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクションを見つける
* **💬 [Discordグループ](https://discord.gg/hRep4RUj7f)**に参加するか、[telegramグループ](https://t.me/peass)に参加するか、**Twitter** 🐦 **@hacktricks\_live**](https://twitter.com/hacktricks\_live)**をフォローする。
* **ハッキングトリックを共有するには、[HackTricks](https://github.com/carlospolop/hacktricks)と[HackTricks Cloud](https://github.com/carlospolop/hacktricks-cloud)のGitHubリポジトリにPRを提出してください。**

</details>
