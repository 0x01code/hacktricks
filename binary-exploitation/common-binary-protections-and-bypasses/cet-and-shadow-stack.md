# CET & Shadow Stack

<details>

<summary><strong>Aprenda hacking AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras maneiras de apoiar o HackTricks:

* Se voc√™ deseja ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF** Verifique os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Obtenha o [**swag oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-nos** no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para os** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) reposit√≥rios do github.

</details>

## Tecnologia de Execu√ß√£o de Fluxo de Controle (CET)

**CET** √© um recurso de seguran√ßa implementado no n√≠vel de hardware, projetado para frustrar ataques comuns de sequestro de fluxo de controle, como **Return-Oriented Programming (ROP)** e **Jump-Oriented Programming (JOP)**. Esses tipos de ataques manipulam o fluxo de execu√ß√£o de um programa para executar c√≥digo malicioso ou encadear peda√ßos de c√≥digo benigno de forma a realizar uma a√ß√£o maliciosa.

CET introduz duas caracter√≠sticas principais: **Indirect Branch Tracking (IBT)** e **Shadow Stack**.

* **IBT** garante que saltos e chamadas indiretas sejam feitos para destinos v√°lidos, que s√£o marcados explicitamente como destinos legais para ramos indiretos. Isso √© alcan√ßado por meio de um novo conjunto de instru√ß√µes que marca os destinos v√°lidos, impedindo assim que os atacantes desviem o fluxo de controle para locais arbitr√°rios.
* **Shadow Stack** √© um mecanismo que fornece integridade para endere√ßos de retorno. Ele mant√©m uma c√≥pia segura e oculta dos endere√ßos de retorno separada da pilha de chamadas regular. Quando uma fun√ß√£o retorna, o endere√ßo de retorno √© validado em rela√ß√£o ao shadow stack, impedindo que os atacantes sobrescrevam os endere√ßos de retorno na pilha para sequestrar o fluxo de controle.

## Shadow Stack

O **shadow stack** √© uma **pilha dedicada usada exclusivamente para armazenar endere√ßos de retorno**. Ele funciona ao lado da pilha regular, mas √© protegido e oculto da execu√ß√£o normal do programa, tornando dif√≠cil para os atacantes interferir. O principal objetivo do shadow stack √© garantir que quaisquer modifica√ß√µes nos endere√ßos de retorno na pilha convencional sejam detectadas antes que possam ser usadas, mitigando efetivamente os ataques ROP.

## Como CET e Shadow Stack Previnem Ataques

Os ataques **ROP e JOP** dependem da capacidade de sequestrar o fluxo de controle de um aplicativo aproveitando vulnerabilidades que permitem sobrescrever ponteiros ou endere√ßos de retorno na pilha. Direcionando o fluxo para sequ√™ncias de gadgets de c√≥digo existentes ou gadgets de programa√ß√£o orientada a retorno, os atacantes podem executar c√≥digo arbitr√°rio.

* A caracter√≠stica **IBT do CET** torna esses ataques significativamente mais dif√≠ceis, garantindo que os ramos indiretos possam saltar apenas para endere√ßos que foram explicitamente marcados como destinos v√°lidos. Isso torna imposs√≠vel para os atacantes executar gadgets arbitr√°rios espalhados pelo bin√°rio.
* O **shadow stack**, por outro lado, garante que mesmo que um atacante consiga sobrescrever um endere√ßo de retorno na pilha normal, a **discrep√¢ncia ser√° detectada** ao comparar o endere√ßo corrompido com a c√≥pia segura armazenada no shadow stack ao retornar de uma fun√ß√£o. Se os endere√ßos n√£o corresponderem, o programa pode ser encerrado ou tomar outras medidas de seguran√ßa, impedindo que o ataque tenha sucesso.

<details>

<summary><strong>Aprenda hacking AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras maneiras de apoiar o HackTricks:

* Se voc√™ deseja ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF** Verifique os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Obtenha o [**swag oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-nos** no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para os** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) reposit√≥rios do github.

</details>
