# CET & Shadow Stack

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Expert en √©quipe rouge AWS de HackTricks)</strong></a><strong>!</strong></summary>

Autres fa√ßons de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFT**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts GitHub.

</details>

## Technologie d'application du flux de contr√¥le (CET)

**CET** est une fonctionnalit√© de s√©curit√© impl√©ment√©e au niveau mat√©riel, con√ßue pour contrer les attaques courantes de d√©tournement de flux de contr√¥le telles que la **programmation orient√©e retour (ROP)** et la **programmation orient√©e saut (JOP)**. Ces types d'attaques manipulent le flux d'ex√©cution d'un programme pour ex√©cuter un code malveillant ou pour encha√Æner des morceaux de code b√©nin de mani√®re √† effectuer une action malveillante.

CET introduit deux fonctionnalit√©s principales : le **Suivi des branches indirectes (IBT)** et le **Shadow Stack**.

* **IBT** garantit que les sauts et appels indirects sont effectu√©s vers des cibles valides, qui sont explicitement marqu√©es comme destinations l√©gales pour les branches indirectes. Cela est r√©alis√© gr√¢ce √† l'utilisation d'un nouvel ensemble d'instructions qui marquent les cibles valides, emp√™chant ainsi les attaquants de d√©tourner le flux de contr√¥le vers des emplacements arbitraires.
* Le **Shadow Stack** est un m√©canisme qui assure l'int√©grit√© des adresses de retour. Il conserve une copie s√©curis√©e et cach√©e des adresses de retour s√©par√©e de la pile d'appels r√©guli√®re. Lorsqu'une fonction retourne, l'adresse de retour est valid√©e par rapport au shadow stack, emp√™chant les attaquants de remplacer les adresses de retour sur la pile pour d√©tourner le flux de contr√¥le.

## Shadow Stack

Le **shadow stack** est une **pile d√©di√©e utilis√©e uniquement pour stocker les adresses de retour**. Il fonctionne aux c√¥t√©s de la pile r√©guli√®re mais est prot√©g√© et cach√© de l'ex√©cution normale du programme, ce qui rend difficile la manipulation par les attaquants. L'objectif principal du shadow stack est de garantir que toute modification des adresses de retour sur la pile conventionnelle est d√©tect√©e avant qu'elles ne puissent √™tre utilis√©es, att√©nuant efficacement les attaques ROP.

## Comment CET et Shadow Stack Pr√©viennent les Attaques

Les attaques **ROP et JOP** reposent sur la capacit√© de d√©tourner le flux de contr√¥le d'une application en exploitant des vuln√©rabilit√©s qui leur permettent de remplacer des pointeurs ou des adresses de retour sur la pile. En dirigeant le flux vers des s√©quences de gadgets de code existants ou de gadgets de programmation orient√©e retour, les attaquants peuvent ex√©cuter un code arbitraire.

* La fonctionnalit√© **IBT de CET** rend ces attaques consid√©rablement plus difficiles en garantissant que les branches indirectes ne peuvent sauter que vers des adresses explicitement marqu√©es comme cibles valides. Cela rend impossible pour les attaquants d'ex√©cuter des gadgets arbitraires r√©partis dans le binaire.
* Le **shadow stack**, quant √† lui, garantit que m√™me si un attaquant peut remplacer une adresse de retour sur la pile normale, la **disparit√© sera d√©tect√©e** lors de la comparaison de l'adresse corrompue avec la copie s√©curis√©e stock√©e dans le shadow stack lors du retour d'une fonction. Si les adresses ne correspondent pas, le programme peut se terminer ou prendre d'autres mesures de s√©curit√©, emp√™chant l'attaque de r√©ussir.

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Expert en √©quipe rouge AWS de HackTricks)</strong></a><strong>!</strong></summary>

Autres fa√ßons de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFT**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts GitHub.

</details>
