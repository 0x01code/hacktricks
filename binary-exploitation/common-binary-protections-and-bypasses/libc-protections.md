# рд▓рд┐рдмреНрд╕реА рд╕реБрд░рдХреНрд╖рд╛

<details>

<summary><strong>рдЬреАрд░реЛ рд╕реЗ рд╣реАрд░реЛ рддрдХ AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдЕрдЧрд░ рдЖрдк рдЕрдкрдиреА рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди **HackTricks рдореЗрдВ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕ рджреЗрдЦреЗрдВ**](https://github.com/sponsors/carlospolop)!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╡рд╛рд▓реЗ [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ рджреНрд╡рд╛рд░рд╛ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВред

</details>

## рдЪрдВрдХ рд╕рдВрд░реЗрдЦрдг рдкреНрд░рд╡рд░реНрддрди

**рдореИрд▓реЛрдХ** рдореЗрдореЛрд░реА рдХреЛ **8-рдмрд╛рдЗрдЯ (32-рдмрд┐рдЯ) рдпрд╛ 16-рдмрд╛рдЗрдЯ (64-рдмрд┐рдЯ) рд╕рдореВрд╣реЛрдВ** рдореЗрдВ рдЖрд╡рдВрдЯрд┐рдд рдХрд░рддрд╛ рд╣реИред рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ 32-рдмрд┐рдЯ рд╕рд┐рд╕реНрдЯрдо рдореЗрдВ рдЪрдВрдХ рдХрд╛ рдЕрдВрдд **0x8** рдХреЗ рд╕рд╛рде рд╕рдВрд░реЗрдЦрд┐рдд рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП, рдФрд░ 64-рдмрд┐рдЯ рд╕рд┐рд╕реНрдЯрдо рдореЗрдВ **0x0** рдХреЗ рд╕рд╛рдеред рд╕реБрд░рдХреНрд╖рд╛ рд╕реБрд╡рд┐рдзрд╛ рдпрд╣ рдЬрд╛рдВрдЪрддреА рд╣реИ рдХрд┐ рдкреНрд░рддреНрдпреЗрдХ рдЪрдВрдХ **рдмрд┐рди рд╕реЗ рдПрдХ рдкреЙрдЗрдВрдЯрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдЗрди рд╡рд┐рд╢реЗрд╖ рд╕реНрдерд╛рдиреЛрдВ рдкрд░ рд╕рд╣реА рд░реВрдк рд╕реЗ рд╕рдВрд░реЗрдЦрд┐рдд рд╣реЛрддрд╛ рд╣реИ**ред

### рд╕реБрд░рдХреНрд╖рд╛ рд▓рд╛рдн

64-рдмрд┐рдЯ рд╕рд┐рд╕реНрдЯрдо рдореЗрдВ рдЪрдВрдХ рд╕рдВрд░реЗрдЦрдг рдХрд╛ рдкреНрд░рд╡рд░реНрддрди Malloc рдХреА рд╕реБрд░рдХреНрд╖рд╛ рдХреЛ **рдмрдврд╝рд╛рддрд╛ рд╣реИ** рдЬрд┐рд╕рд╕реЗ **рдирдХрд▓реА рдЪрдВрдХ рдХреЛ рдХреЗрд╡рд▓ 16 рдкрддреЗ рдореЗрдВ рд╕реЗ рдХреЗрд╡рд▓ 1 рдкрддреЗ рдкрд░ рд╕реАрдорд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ**ред рдпрд╣ рдЙрддреНрдкреАрдбрд╝рди рдкреНрд░рдпрд╛рд╕реЛрдВ рдХреЛ рдЬрдЯрд┐рд▓ рдмрдирд╛рддрд╛ рд╣реИ, рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рдЙрди рдкрд░рд┐рд╕реНрдерд┐рддрд┐рдпреЛрдВ рдореЗрдВ рдЬрд╣рд╛рдВ рдЙрдкрдпреЛрдХреНрддрд╛ рдХреЛ рдЗрдирдкреБрдЯ рдорд╛рдиреЛрдВ рдкрд░ рдкреНрд░рддрд┐рдмрдВрдз рд╣реИ, рд╣рдорд▓реЛрдВ рдХреЛ рдЕрдзрд┐рдХ рдЬрдЯрд┐рд▓ рдФрд░ рд╕рдлрд▓рддрд╛рдкреВрд░реНрд╡рдХ рдХреНрд░рд┐рдпрд╛рдиреНрд╡рд┐рдд рдХрд░рдирд╛ рдХрдард┐рди рдмрдирд╛рддрд╛ рд╣реИред

* **\_\_malloc\_hook рдкрд░ рдлрд╛рд╕реНрдЯрдмрд┐рди рд╣рдорд▓рд╛**

Malloc рдореЗрдВ рдирдП рд╕рдВрд░реЗрдЦрдг рдирд┐рдпрдо рднреА `__malloc_hook` рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рдПрдХ рдХреНрд▓рд╛рд╕рд┐рдХ рд╣рдорд▓реЗ рдХреЛ рд░реЛрдХрддреЗ рд╣реИрдВред рдкрд╣рд▓реЗ рд╣рдорд▓рд╡рд╛рд░ рдЪрдВрдХ рдХреЗ рдЖрдХрд╛рд░ рдХреЛ **рдЗрд╕ рдлрд╝рдВрдХреНрд╢рди рдкреЙрдЗрдВрдЯрд░ рдХреЛ рдЕрдзрд┐рд▓реЗрдЦрд┐рдд рдХрд░рдиреЗ** рдФрд░ **рдХреЛрдб рдХреНрд░рд┐рдпрд╛рдиреНрд╡рд┐рдд рдХрд░рдиреЗ** рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреЗ рдереЗред рдЕрдм, рд╕рдЦреНрдд рд╕рдВрд░реЗрдЦрдг рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддреА рд╣реИ рдХрд┐ рдРрд╕реА рдорд╛рдирд┐рдкреБрд▓реЗрд╢рди рдЕрдм рд╕рдВрднрд╡ рдирд╣реАрдВ рд╣реИ, рдПрдХ рд╕рд╛рдорд╛рдиреНрдп рдЙрддреНрдкреАрдбрд╝рди рдорд╛рд░реНрдЧ рдХреЛ рдмрдВрдж рдХрд░рддреА рд╣реИ рдФрд░ рд╕рдордЧреНрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХреЛ рдмрдврд╝рд╛рддреА рд╣реИред

## рдлрд╛рд╕реНрдЯрдмрд┐рдиреНрд╕ рдФрд░ рдЯреАрдХреИрд╢ рдореЗрдВ рдкреЙрдЗрдВрдЯрд░ рдореИрдВрдЧрд▓рд┐рдВрдЧ

**рдкреЙрдЗрдВрдЯрд░ рдореИрдВрдЧрд▓рд┐рдВрдЧ** рдПрдХ рд╕реБрд░рдХреНрд╖рд╛ рд╡реГрджреНрдзрд┐ рд╣реИ рдЬреЛ рдореЗрдореЛрд░реА рдкреНрд░рдмрдВрдзрди рдХрд╛рд░реНрдпреЛрдВ рдореЗрдВ **рдлрд╛рд╕реНрдЯрдмрд┐рди рдФрд░ рдЯреАрдХреИрд╢ Fd рдкреЙрдЗрдВрдЯрд░** рдХреА рд╕реБрд░рдХреНрд╖рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛рддреА рд╣реИред рдпрд╣ рддрдХрдиреАрдХ рд╡рд┐рд╢реЗрд╖ рдкреНрд░рдХрд╛рд░ рдХреЗ рдореЗрдореЛрд░реА рдЙрддреНрдкреАрдбрд╝рди рдпреБрдХреНрддрд┐рдпреЛрдВ рд╕реЗ рдмрдЪрд╛рдиреЗ рдореЗрдВ рдорджрдж рдХрд░рддреА рд╣реИ, рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рдЙрди рдпреБрдХреНрддрд┐рдпреЛрдВ рдХреЛ рдЬреЛ рд▓реАрдХ рдХреА рдЧрдИ рдореЗрдореЛрд░реА рд╕реВрдЪрдирд╛ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ рдпрд╛ рдЬреЛ рд╕реАрдзреЗ рдЬреНрдЮрд╛рдд рд╕реНрдерд╛рдиреЛрдВ рдХреЗ рд╕рд╛рде рдореЗрдореЛрд░реА рд╕реНрдерд╛рдиреЛрдВ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рддреА рд╣реИрдВ (рд╕рд╛рдкреЗрдХреНрд╖рд┐рдХ **рдУрд╡рд░рд░рд╛рдЗрдЯреНрд╕**).

рдЗрд╕ рддрдХрдиреАрдХ рдХрд╛ рдореВрд▓ рд╣реИ рдПрдХ рдЕрд╕реНрдкрд╖реНрдЯрддрд╛ рд╕реВрддреНрд░:

**`рдиреНрдпреВ_рдкреАрдЯреАрдЖрд░ = (рдПрд▓ >> 12) XOR рдкреА`**

* **рдПрд▓** рдкреЙрдЗрдВрдЯрд░ рдХрд╛ **рд╕реНрдЯреЛрд░реЗрдЬ рд╕реНрдерд╛рди** рд╣реИред
* **рдкреА** рд╡рд╛рд╕реНрддрд╡рд┐рдХ **рдлрд╛рд╕реНрдЯрдмрд┐рди/рдЯреАрдХреИрд╢ Fd рдкреЙрдЗрдВрдЯрд░** рд╣реИред

рдпрд╣рд╛рдБ рдкрд░рд┐рд╡рд░реНрддрди рдХрд╛ рдмрд┐рдЯрд╡рд╛рдЗрдЬ рд╢рд┐рдлреНрдЯ (L) 12 рдмрд┐рдЯ рджрд╛рдПрдВ рджреНрд╡рд╛рд░рд╛ рдкреАрдЫреЗ рдХрд░рдиреЗ рдХрд╛ рдХрд╛рд░рдг рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИред рдпрд╣ рдорд╛рдирд┐рдкреБрд░рдг рдЙрд╕ рдирд┐рд╢реНрдЪрд┐рддрддрд╛ рдореЗрдВ рд╕реЗ рдПрдХ рднреЗрджреНрдпрддрд╛ рдкрддрд╛ рд▓рдЧрд╛рддрд╛ рд╣реИ рдЬреЛ рдореЗрдореЛрд░реА рдкрддреЛрдВ рдХреЗ рд╕рдмрд╕реЗ рдЕрдзрд┐рдХ рдорд╣рддреНрд╡рдкреВрд░реНрдг 12 рдмрд┐рдЯ рдореЗрдВ рд╣реЛрддреА рд╣реИ, рдЬреЛ рд╕рд╛рдорд╛рдиреНрдпрдд: рдкреНрд░рдгрд╛рд▓реА рдХреА рд╕реАрдорд╛рдУрдВ рдХреЗ рдХрд╛рд░рдг рдкреВрд░реНрд╡рд╛рдиреБрдорд╛рдирдиреАрдп рд╣реЛрддреА рд╣реИред рдмрд┐рдЯреНрд╕ рдХреЛ рд╢рд┐рдлреНрдЯ рдХрд░рдХреЗ, рдкреВрд░реНрд╡рд╛рдиреБрдорд╛рдирдиреАрдп рднрд╛рдЧ рдХреЛ рд╕рдореАрдХрд░рдг рд╕реЗ рдмрд╛рд╣рд░ рд▓реЗ рдЬрд╛рддрд╛ рд╣реИ, рдирдП, рдореИрдВрдЧрд▓ рдкреЙрдЗрдВрдЯрд░ рдХреА рдпрд╛рджреГрдЪреНрдЫрд┐рдХрддрд╛ рдХреЛ рдмрдврд╝рд╛рддрд╛ рд╣реИ рдФрд░ рдЗрд╕рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЙрд╕ рдирд┐рд╢реНрдЪрд┐рддрддрд╛ рдХреЗ рдмрд┐рдЯреНрд╕ рдХреЗ рдЦрд┐рд▓рд╛рдл рд╕реБрд░рдХреНрд╖рд╛ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддрд╛ рд╣реИ рдЬрд┐рд╕ рдкрд░ рдпреЗ рдпреБрдХреНрддрд┐рдпрд╛рдБ рдирд┐рд░реНрднрд░ рдХрд░рддреА рд╣реИрдВред

рдпрд╣ рдореИрдВрдЧрд▓ рдкреЙрдЗрдВрдЯрд░ **рдкрддрд╛ рдЕрдВрддрд░рд┐рдХреНрд╖ рд▓реЗрдЖрдЙрдЯ рд░реИрдВрдбрдорд╛рдЗрдЬреЗрд╢рди (ASLR)** рджреНрд╡рд╛рд░рд╛ рдкреНрд░рджрд╛рди рдХреА рдЧрдИ рдореМрдЬреВрджрд╛ рдпрд╛рджреГрдЪреНрдЫрд┐рдХрддрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ, рдЬреЛ рдХрд╛рд░реНрдпреЛрдВ рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рдкрддреЛрдВ рдХреЛ рдЕрдиреБрдорд╛рдирд┐рдд рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдХрдард┐рди рдмрдирд╛рддрд╛ рд╣реИ рддрд╛рдХрд┐ рд╣рдорд▓рд╡рд╛рд░реЛрдВ рдХреЛ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреА рдореЗрдореЛрд░реА рдЦрд╛рдХрд╛ рдкреВрд░реНрд╡рд╛рдиреБрдорд╛рдирд┐рдд рдХрд░рдиреЗ рдореЗрдВ рдХрдард┐рдирд╛рдИ рд╣реЛред

**рдкреЙрдЗрдВрдЯрд░ рдбреАрдореИрдВрдЧрд▓рд┐рдВрдЧ** рдореВрд▓ рдкрддрд╛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЗрд╕реА XOR рдСрдкрд░реЗрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред рдпрд╣рд╛рдБ, рдореИрдВрдЧрд▓ рдкреЙрдЗрдВрдЯрд░ рдХреЛ P рдХреЗ рд░реВрдк рдореЗрдВ рд╡рд┐рдЪрд╛рд░ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдФрд░ рдЬрдм рдпрд╣ рдмрд┐рдирд╛ рдкрд░рд┐рд╡рд░реНрддрди рдХреЗ рд╕реНрдЯреЛрд░реЗрдЬ рд╕реНрдерд╛рди (L) рдХреЗ рд╕рд╛рде XOR рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдореВрд▓ рдкреЙрдЗрдВрдЯрд░ рдкреНрд░рдХрдЯ рд╣реЛрддрд╛ рд╣реИред рдЗрд╕ рдореИрдВрдЧрд▓рд┐рдВрдЧ рдФрд░ рдбреАрдореИрдВрдЧрд▓рд┐рдВрдЧ рдореЗрдВ рд╕рдордорд┐рддрд┐ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддреА рд╣реИ рдХрд┐ рдкреНрд░рдгрд╛рд▓реА рдореЗрдореЛрд░реА рдкреЙрдЗрдВрдЯрд░ рдХреЛ рдХреЛрдбрд┐рдВрдЧ рдФрд░ рдбреАрдХреЛрдбрд┐рдВрдЧ рдХрд░ рд╕рдХрддреА рд╣реИ рдмрд┐рдирд╛ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдУрд╡рд░рд╣реЗрдб рдХреЗ, рдЬрдмрдХрд┐ рд╣рдорд▓реЛрдВ рдХреЗ рдЦрд┐рд▓рд╛рдл рд╕реБрд░рдХреНрд╖рд╛ рдХреЛ рдмрд╣реБрдд рдЕрдзрд┐рдХ рдмрдврд╝рд╛рддреА рд╣реИ рдЬреЛ рдореЗрдореЛрд░реА рдкреЙрдЗрдВрдЯрд░ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рддреЗ рд╣реИрдВред

### рд╕реБрд░рдХреНрд╖рд╛ рд▓рд╛рдн

рдкреЙрдЗрдВрдЯрд░ рдореИрдВрдЧрд▓рд┐рдВрдЧ рдХрд╛ рдЙрджреНрджреЗрд╢реНрдп рд╣реИ **рд╣реАрдк рдореЗрдВ рднрд╛рдЧреАрджрд╛рд░реА рдФрд░ рдкреВрд░реНрдг рдкреЙрдЗрдВрдЯрд░ рдУрд╡рд░рд░рд╛рдЗрдЯреНрд╕ рдХреЛ рд░реЛрдХрдирд╛**, рд╕реБрд░рдХреНрд╖рд╛ рдореЗрдВ рдПрдХ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╡реГрджреНрдзрд┐ред рдпрд╣ рд╕реБрд╡рд┐рдзрд╛ рд╡рд┐рднрд┐рдиреНрди рддрд░реАрдХреЛрдВ рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛рдиреЗ рд╡рд╛рд▓реА рд╣рдорд▓рд╛ рддрдХрдирд┐рдХрд╛рдУрдВ рдкрд░ рдкреНрд░рднрд╛рд╡ рдбрд╛рд▓рддреА рд╣реИ:

1. **рдмрд╛рдИрдЯ рдмрд╛рдИрдЯ рд╕рд╛рдкреЗрдХреНрд╖рд┐рдХ рдУрд╡рд░рд░рд╛рдЗрдЯреНрд╕ рдХреА рд░реЛрдХрдерд╛рдо**: рдкрд╣рд▓реЗ рд╣рдорд▓рд╡рд╛рд░ рдмрд┐рдирд╛ рд╕рдЯреАрдХ рдкрддреЛрдВ рдХреЛ рдЬрд╛рдирддреЗ рд╣реБрдП рд╣реАрдк рдЪрдВрдХ рдХреЛ рд╡рд┐рднрд┐рдиреНрди рд╕реНрдерд╛рдиреЛрдВ рдкрд░ рдЕрдиреБрдкреНрд░реЗрд╖рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рднрд╛рдЧ рдХреЛ рдмрджрд▓ рд╕рдХрддреЗ рдереЗ, рдЬреИрд╕рд╛ рдХрд┐ рд▓реАрдХрд▓реЗрд╕ **рд╣рд╛рдЙрд╕ рдСрдл рд░реЛрдорди** рд╣рдорд▓реЗ рдореЗрдВ рд╕реНрдкрд╖реНрдЯ рд╣реИред рдкреЙрдЗрдВрдЯрд░ рдореИрдВрдЧрд▓рд┐рдВрдЧ рдХреЗ рд╕рд╛рде, рдРрд╕реЗ рд╕рд╛рдкреЗрдХреНрд╖рд┐рдХ рдУрд╡рд░рд░рд╛рдЗрдЯреНрд╕ **рдмрд┐рдирд╛ рд╣реАрдк рд▓реАрдХ рдХреЗ рдЕрдм рдмреНрд░реВрдЯ рдлреЛрд░реНрд╕рд┐рдВрдЧ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ**, рдЙрдирдХреА рд╕рдлрд▓рддрд╛ рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рдХреЛ рдмрд╣реБрдд рдХрдо рдХрд░ рджреЗрддреА рд╣реИред
2. **рдЯреАрдХреИрд╢ рдмрд┐рди/рдлрд╛рд╕реНрдЯрдмрд┐рди рд╣рдорд▓реЛрдВ рдХреА рдХрдард┐рдирд╛рдИ рдореЗрдВ рд╡реГрджреНрдзрд┐**: рдлрд╛рд╕реНрдЯрдмрд┐рди рдпрд╛ рдЯреАрдХреИрд╢ рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐рдпреЛрдВ рдХреЛ рдорд╛рдирд┐рдкреБрд▓реЗрдЯ рдХрд░рдХреЗ рдлрд╝рдВрдХреНрд╢рди рдкреЙрдЗрдВрдЯрд░реНрд╕ (рдЬреИрд╕реЗ `__malloc_hook`)
## рдкреЙрдЗрдВрдЯрд░ рдЧрд╛рд░реНрдб

рдкреЙрдЗрдВрдЯрд░ рдЧрд╛рд░реНрдб рдПрдХ рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рдорд┐рдЯрд┐рдЧреЗрд╢рди рддрдХрдиреАрдХ рд╣реИ рдЬреЛ glibc рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛рддреА рд╣реИ рддрд╛рдХрд┐ рд╕реНрдЯреЛрд░ рдХрд┐рдП рдЧрдП рдлрд╝рдВрдХреНрд╢рди рдкреЙрдЗрдВрдЯрд░реНрд╕ рдХреЛ рд╕реБрд░рдХреНрд╖рд┐рдд рд░рдЦрд╛ рдЬрд╛ рд╕рдХреЗ, рдЦрд╛рд╕рдХрд░ рдЙрди рдкреЙрдЗрдВрдЯрд░реНрд╕ рдХреЛ рдЬреЛ рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдХреЙрд▓реНрд╕ рдЬреИрд╕реЗ `atexit()` рджреНрд╡рд╛рд░рд╛ рдкрдВрдЬреАрдХреГрдд рдХрд┐рдП рдЧрдП рд╣реЛрддреЗ рд╣реИрдВред рдпрд╣ рд╕реБрд░рдХреНрд╖рд╛ рдкреЙрдЗрдВрдЯрд░реНрд╕ рдХреЛ рдПрдХ рдЧреБрдкреНрдд рд╕реАрдХреНрд░реЗрдЯ рдХреЗ рд╕рд╛рде XOR рдХрд░рдХреЗ рдЙрдиреНрд╣реЗрдВ рдЙрд▓рдЯрд╛ рджреЗрдиреЗ рдФрд░ рдмрд┐рдЯрд╡рд╛рдЗрдЬрд╝ рд░реЛрдЯреЗрд╢рди рд▓рд╛рдЧреВ рдХрд░рдХреЗ рдХрд░рддреА рд╣реИред рдпрд╣ рддрдВрддреНрд░ рд╣рдорд▓рд╛рд╡рд░реЛрдВ рдХреЛ рдлрд╝рдВрдХреНрд╢рди рдкреЙрдЗрдВрдЯрд░реНрд╕ рдХреЛ рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд░рдХреЗ рдирд┐рдпрдВрддреНрд░рдг рдлреНрд▓реЛ рдХреЛ рд╣рд╛рдЗрдЬреИрдХ рдХрд░рдиреЗ рд╕реЗ рд░реЛрдХрдиреЗ рдХрд╛ рдЙрджреНрджреЗрд╢реНрдп рд░рдЦрддрд╛ рд╣реИред

### **рд▓реАрдХ рдХреЗ рд╕рд╛рде рдкреЙрдЗрдВрдЯрд░ рдЧрд╛рд░реНрдб рдХреЛ рдЙрд▓рдЯрдирд╛**

1. **рдкреЙрдЗрдВрдЯрд░ рдЧрд╛рд░реНрдб рдСрдкрд░реЗрд╢рди рдХреА рд╕рдордЭ:** рдкреЙрдЗрдВрдЯрд░реНрд╕ рдХрд╛ рдорд┐рдерд╛рди (рдореИрдВрдЧреНрд▓рд┐рдВрдЧ) `PTR_MANGLE` рдореИрдХреНрд░реЛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬреЛ рдкреЙрдЗрдВрдЯрд░ рдХреЛ рдПрдХ 64-рдмрд┐рдЯ рдЧреБрдкреНрдд рд╕реЗ XOR рдХрд░рддрд╛ рд╣реИ рдФрд░ рдлрд┐рд░ 0x11 рдмрд┐рдЯ рдХрд╛ рдмрд╛рдПрдВ рдШреВрдорд╛рдирд╛ рдХрд░рддрд╛ рд╣реИред рдореВрд▓ рдкреЙрдЗрдВрдЯрд░ рдХреЛ рдкреБрдирд░реНрдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрд▓рдЯреА рдСрдкрд░реЗрд╢рди `PTR_DEMANGLE` рджреНрд╡рд╛рд░рд╛ рд╕рдВрднрд╛рд▓рд╛ рдЬрд╛рддрд╛ рд╣реИред
2. **рд╣рдорд▓рд╛ рд░рдгрдиреАрддрд┐:** рд╣рдорд▓рд╛ рдПрдХ рдЬрд╛рдирд╛-рдорд╛рдирд╛ рдкреНрд▓реЗрдирдЯреЗрдХреНрд╕реНрдЯ рджреГрд╖реНрдЯрд┐рдХреЛрдг рдкрд░ рдЖрдзрд╛рд░рд┐рдд рд╣реИ, рдЬрд╣рд╛рдВ рд╣рдорд▓рд╛рд╡рд░ рдХреЛ рдореИрдВрдЧрд▓рд┐рдВрдЧ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЧрдП рдкреЙрдЗрдВрдЯрд░ рдХреЗ рдореВрд▓ рдФрд░ рдореИрдВрдЧрд▓ рд╡рд░реНрд╢рди рджреЛрдиреЛрдВ рдХреЛ рдЬрд╛рдирдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ рддрд╛рдХрд┐ рдореИрдВрдЧрд▓рд┐рдВрдЧ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЧрдП рдЧреБрдкреНрдд рдХреЛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред
3. **рдЬреНрдЮрд╛рдд рдкреНрд▓реЗрдирдЯреЗрдХреНрд╕реНрдЯ рдХрд╛ рд╢реЛрдз:**
* **рдирд┐рд╢реНрдЪрд┐рдд рдлрд┐рдХреНрд╕реНрдб рдлрд╝рдВрдХреНрд╢рди рдкреЙрдЗрдВрдЯрд░реНрд╕ рдХреА рдкрд╣рдЪрд╛рди:** glibc рд╕реНрд░реЛрдд рдХреЛрдб рдпрд╛ рдкреНрд░рд╛рд░рдВрднрд┐рдХ рдлрд╝рдВрдХреНрд╢рди рдкреЙрдЗрдВрдЯрд░ рддрд╛рд▓рд┐рдХрд╛рдУрдВ (рдЬреИрд╕реЗ `__libc_pthread_functions`) рдХреА рдЬрд╛рдВрдЪ рдХрд░рдХреЗ, рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдкреВрд░реНрд╡рд╛рдиреБрдорд╛рдирдиреАрдп рдлрд╝рдВрдХреНрд╢рди рдкреЙрдЗрдВрдЯрд░реНрд╕ рдХреЛ рдЦреЛрдЬ рд╕рдХрддрд╛ рд╣реИред
* **рдЧреБрдкреНрдд рдХреА рдЧрдгрдирд╛:** рдПрдХ рдЬреНрдЮрд╛рдд рдлрд╝рдВрдХреНрд╢рди рдкреЙрдЗрдВрдЯрд░ рдЬреИрд╕реЗ `__pthread_attr_destroy` рдФрд░ рдЙрд╕рдХрд╛ рдореИрдВрдЧрд▓ рд╡рд░реНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ, рдЧреБрдкреНрдд рдХреЛ рдкреБрдирд░реНрдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдореИрдВрдЧрд▓ рдкреЙрдЗрдВрдЯрд░ рдХреЛ рдЙрд▓рдЯрд╛ рджреЗрдиреЗ рдХреЗ рдмрд╛рдж рдЙрд╕реЗ рдлрд┐рд░ рд╕реЗ рдШреВрдорд╛рдирд╛ (рджрд╛рдПрдВ рдШреВрдорд╛рдирд╛) рдФрд░ рдлрд┐рд░ рдлрд╝рдВрдХреНрд╢рди рдХреЗ рдкрддреЗ рдХреЗ рд╕рд╛рде XOR рдХрд░рдХреЗ рдЧрдгрдирд╛ рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИред
4. **рд╡реИрдХрд▓реНрдкрд┐рдХ рдкреНрд▓реЗрдирдЯреЗрдХреНрд╕реНрдЯ:** рд╣рдорд▓рд╛рд╡рд░ рдпрд╣ рднреА рдкреНрд░рдпреЛрдЧ рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдХрд┐ рд╡рд╣ рдЬреНрдЮрд╛рдд рдорд╛рдиреЛрдВ рдХреЗ рд╕рд╛рде рдкреЙрдЗрдВрдЯрд░реНрд╕ рдХреЛ рдореИрдВрдЧрд▓ рдХрд░реЗ рдЬреИрд╕реЗ 0 рдпрд╛ -1 рддрд╛рдХрд┐ рджреЗрдЦ рд╕рдХреЗ рдХрд┐ рдХреНрдпрд╛ рдпреЗ рдореЗрдореЛрд░реА рдореЗрдВ рдкрд╣рдЪрд╛рдиреЗ рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рдкреИрдЯрд░реНрди рдЙрддреНрдкрдиреНрди рдХрд░рддреЗ рд╣реИрдВ, рдЬрдм рдпреЗ рдкреИрдЯрд░реНрди рдореЗрдореЛрд░реА рдбрдВрдк рдореЗрдВ рдкрд╛рдП рдЬрд╛рддреЗ рд╣реИрдВ рддреЛ рдЧреБрдкреНрдд рдХреЛ рдкреНрд░рдХрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
5. **рд╡реНрдпрд╛рд╡рд╣рд╛рд░рд┐рдХ рдЕрдиреБрдкреНрд░рдпреЛрдЧ:** рдЧреБрдкреНрдд рдХреА рдЧрдгрдирд╛ рдХреЗ рдмрд╛рдж, рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдирд┐рдпрдВрддреНрд░рд┐рдд рддрд░реАрдХреЗ рд╕реЗ рдкреЙрдЗрдВрдЯрд░реНрд╕ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рдореБрдЦреНрдп рд░реВрдк рд╕реЗ Pointer Guard рд╕реБрд░рдХреНрд╖рд╛ рдХреЛ рдЫрд▓рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдПрдХ рдорд▓реНрдЯреАрдереНрд░реЗрдбреЗрдб рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд╕рд╛рде libc рдмреЗрд╕ рдкрддреЗ рдФрд░ рд╡рд┐рдЪрд╛рд░рд╢реАрд▓ рдореЗрдореЛрд░реА рд╕реНрдерд╛рдиреЛрдВ рдХреЛ рдкрдврд╝рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рдХреЗ рд╕рд╛рдеред

## рд╕рдВрджрд░реНрдн

* [https://maxwelldulin.com/BlogPost?post=5445977088](https://maxwelldulin.com/BlogPost?post=5445977088)
* [https://blog.infosectcbr.com.au/2020/04/bypassing-pointer-guard-in-linuxs-glibc.html?m=1](https://blog.infosectcbr.com.au/2020/04/bypassing-pointer-guard-in-linuxs-glibc.html?m=1)
