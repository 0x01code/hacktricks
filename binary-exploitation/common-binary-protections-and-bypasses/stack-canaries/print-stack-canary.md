# スタックキャナリの表示

<details>

<summary><strong>htARTE（HackTricks AWS Red Team Expert）</strong>を通じて**ゼロからヒーローまでAWSハッキングを学ぶ**！</summary>

HackTricksをサポートする他の方法：

- **HackTricksで企業を宣伝**したい場合や**HackTricksをPDFでダウンロード**したい場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
- [**公式PEASS＆HackTricksスワッグ**](https://peass.creator-spring.com)を入手する
- [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクションを見る
- 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)に参加するか、[**telegramグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)で**フォロー**する。
- **ハッキングトリックを共有する**には、[**HackTricks**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のGitHubリポジトリにPRを提出してください。

</details>

## スタックの拡大表示

スタックオーバーフローに脆弱な**プログラム**が、**puts**関数を**スタックオーバーフローの一部を指すように実行**できる状況を想像してみてください。攻撃者は、**キャナリの最初のバイトがヌルバイト**（`\x00`）であり、残りのキャナリが**ランダムなバイト**であることを知っています。その後、攻撃者は、**キャナリの最初のバイトだけが残るまでスタックを上書きするオーバーフロー**を作成する可能性があります。

その後、攻撃者は、ペイロードの中間で**puts機能を呼び出し**、キャナリの**すべてを表示**します（最初のヌルバイトを除く）。

この情報を使用して、攻撃者は（同じプログラムセッション内で）キャナリを知っている新しい攻撃を**作成**して**送信**できます。

明らかに、この戦術は非常に**制限されて**おり、攻撃者は**ペイロードの内容を表示**して**キャナリを外部に漏洩**し、その後、新しいペイロードを作成して（**同じプログラムセッション**内で）**実際のバッファオーバーフローを送信**できる必要があります。

**CTFの例：**

- [**https://guyinatuxedo.github.io/08-bof\_dynamic/csawquals17\_svc/index.html**](https://guyinatuxedo.github.io/08-bof\_dynamic/csawquals17\_svc/index.html)
- 64ビット、ASLR有効、PIEなし、キャナリのバイト0x00までオーバーフローを埋めてからputsを呼び出して漏洩させます。キャナリを使用して、GOTからputsのアドレスを漏洩させるためのROPガジェットが作成され、`system('/bin/sh')`を呼び出すためのROPガジェットが作成されます。
- [**https://guyinatuxedo.github.io/14-ret\_2\_system/hxp18\_poorCanary/index.html**](https://guyinatuxedo.github.io/14-ret\_2\_system/hxp18\_poorCanary/index.html)
- 32ビット、ARM、relroなし、キャナリ、nx、PIEなし。putsを呼び出してキャナリを漏洩させ、ROPチェーンで`system`を呼び出すret2libを使用します。r0（arg `/bin/sh`）とpc（systemのアドレス）をポップするROPガジェット

## 任意の読み取り

フォーマット**文字列**によって提供されるような**任意の読み取り**を使用すると、キャナリを漏洩させることが可能になるかもしれません。この例をチェックしてください：[**https://ir0nstone.gitbook.io/notes/types/stack/canaries**](https://ir0nstone.gitbook.io/notes/types/stack/canaries) 、および以下のリンクで任意のメモリアドレスを読み取るためにフォーマット文字列を悪用する方法について読むことができます：

{% content-ref url="../../format-strings/" %}
[format-strings](../../format-strings/)
{% endcontent-ref %}

- [https://guyinatuxedo.github.io/14-ret\_2\_system/asis17\_marymorton/index.html](https://guyinatuxedo.github.io/14-ret\_2\_system/asis17\_marymorton/index.html)
- このチャレンジは、フォーマット文字列を非常に単純な方法で悪用して、スタックからキャナリを読み取ります

<details>

<summary><strong>htARTE（HackTricks AWS Red Team Expert）</strong>を通じて**ゼロからヒーローまでAWSハッキングを学ぶ**！</summary>

HackTricksをサポートする他の方法：

- **HackTricksで企業を宣伝**したい場合や**HackTricksをPDFでダウンロード**したい場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
- [**公式PEASS＆HackTricksスワッグ**](https://peass.creator-spring.com)を入手する
- [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクションを見る
- 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)に参加するか、[**telegramグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)で**フォロー**する。
- **ハッキングトリックを共有する**には、[**HackTricks**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のGitHubリポジトリにPRを提出してください。

</details>
