# Ret2ret & Ret2pop

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>에서 **제로부터 히어로까지 AWS 해킹 배우기**!</summary>

다른 방법으로 HackTricks를 지원하는 방법:

- **회사가 HackTricks에 광고되길 원하거나** **HackTricks를 PDF로 다운로드**하려면 [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)를 확인하세요!
- [**공식 PEASS & HackTricks 스왜그**](https://peass.creator-spring.com)를 구입하세요
- [**The PEASS Family**](https://opensea.io/collection/the-peass-family)를 발견하세요, 당사의 독점 [**NFTs**](https://opensea.io/collection/the-peass-family) 컬렉션
- **💬 [Discord 그룹](https://discord.gg/hRep4RUj7f)** 또는 [**텔레그램 그룹**](https://t.me/peass)에 가입하거나 **트위터** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**를 팔로우하세요.**
- **HackTricks** 및 **HackTricks Cloud** github 저장소에 PR을 제출하여 해킹 트릭을 공유하세요.

</details>

## Ret2ret

이 기술의 주요 **목표**는 **스택 내에 있는 기존 포인터를 악용하여 ASLR을 우회하는 것**입니다.

기본적으로 스택 오버플로우는 보통 문자열에 의해 발생하며, **문자열은 메모리의 끝에 널 바이트로 끝납니다**. 이를 통해 스택에 이미 존재하는 포인터가 가리키는 위치를 줄일 수 있습니다. 따라서 스택에 `0xbfffffdd`가 포함되어 있다면, 이 오버플로우는 `0xbfffff00`으로 변환될 수 있습니다 (마지막으로 0으로 된 바이트에 주목).

만약 해당 주소가 스택 내의 셸코드를 가리킨다면, **`ret` 명령어에 주소를 추가**하여 이 명령이 도달할 때까지 흐름을 해당 주소로 이동시킬 수 있습니다.

따라서 공격은 다음과 같을 것입니다:

- NOP 슬레드
- 셸코드
- 스택을 EIP에서 **`ret` 주소로 덮어쓰기** (RET 슬레드)
- 스트링에 의해 추가된 0x00이 스택의 주소를 수정하여 NOP 슬레드를 가리키도록 만듭니다.

[**이 링크**](https://github.com/florianhofhammer/stack-buffer-overflow-internship/blob/master/ASLR%20Smack%20and%20Laugh%20reference%20-%20Tilo%20Mueller/ret2ret.c)에서 취약한 이진 파일의 예제를 볼 수 있으며, [**이 링크**](https://github.com/florianhofhammer/stack-buffer-overflow-internship/blob/master/ASLR%20Smack%20and%20Laugh%20reference%20-%20Tilo%20Mueller/ret2retexploit.c)에서 exploit을 확인할 수 있습니다.

## Ret2pop

스택 내에서 **수정하고 싶지 않은 완벽한 포인터를 찾을 수 있다면** (`ret2ret`에서는 최종 최하위 바이트를 `0x00`으로 변경했습니다), **같은 `ret2ret` 공격을 수행할 수 있지만 RET 슬레드의 길이를 1만큼 줄여야** 합니다 (따라서 최종 `0x00`이 완벽한 포인터 바로 이전 데이터를 덮어씁니다), 그리고 **RET 슬레드의 마지막 주소는 `pop <reg>; ret`를 가리켜야** 합니다.\
이렇게 하면 **완벽한 포인터 앞의 데이터가 스택에서 제거**됩니다 (`0x00`에 영향을 받는 데이터) 그리고 **최종 `ret`가 어떠한 변경도 없이 스택 내의 완벽한 주소를 가리키게** 됩니다.

[**이 링크**](https://github.com/florianhofhammer/stack-buffer-overflow-internship/blob/master/ASLR%20Smack%20and%20Laugh%20reference%20-%20Tilo%20Mueller/ret2pop.c)에서 취약한 이진 파일의 예제를 볼 수 있으며, [**이 링크**](https://github.com/florianhofhammer/stack-buffer-overflow-internship/blob/master/ASLR%20Smack%20and%20Laugh%20reference%20-%20Tilo%20Mueller/ret2popexploit.c)에서 exploit을 확인할 수 있습니다.

## References

* [https://github.com/florianhofhammer/stack-buffer-overflow-internship/blob/master/NOTES.md](https://github.com/florianhofhammer/stack-buffer-overflow-internship/blob/master/NOTES.md)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>에서 **제로부터 히어로까지 AWS 해킹 배우기**!</summary>

다른 방법으로 HackTricks를 지원하는 방법:

- **회사가 HackTricks에 광고되길 원하거나** **HackTricks를 PDF로 다운로드**하려면 [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)를 확인하세요!
- [**공식 PEASS & HackTricks 스왜그**](https://peass.creator-spring.com)를 구입하세요
- [**The PEASS Family**](https://opensea.io/collection/the-peass-family)를 발견하세요, 당사의 독점 [**NFTs**](https://opensea.io/collection/the-peass-family) 컬렉션
- **💬 [Discord 그룹](https://discord.gg/hRep4RUj7f)** 또는 [**텔레그램 그룹**](https://t.me/peass)에 가입하거나 **트위터** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**를 팔로우하세요.**
- **HackTricks** 및 **HackTricks Cloud** github 저장소에 PR을 제출하여 해킹 트릭을 공유하세요.

</details>
