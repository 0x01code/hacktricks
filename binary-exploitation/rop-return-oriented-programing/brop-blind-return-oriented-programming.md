# BROP - рдмреНрд▓рд╛рдЗрдВрдб рд░рд┐рдЯрд░реНрди рдУрд░рд┐рдПрдВрдЯреЗрдб рдкреНрд░реЛрдЧреНрд░рд╛рдорд┐рдВрдЧ

<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдЕрдЧрд░ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рди**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рдХрд▓реЗрдХреНрд╢рди, [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдЦреЛрдЬреЗрдВ
* **рдЬреБрдбрд╝реЗрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рд╕реЗ рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ** рджреНрд╡рд╛рд░рд╛ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВред

</details>

## рдореВрд▓ рдЬрд╛рдирдХрд╛рд░реА

рдЗрд╕ рд╣рдорд▓реЗ рдХрд╛ рдЙрджреНрджреЗрд╢реНрдп рд╣реИ рдХрд┐ **рдПрдХ ROP рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗ рдмрд┐рдирд╛ рдХрд┐рд╕реА рднреА рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рдХрд┐ рдХрдордЬреЛрд░ рдмрд╛рдЗрдирд░реА рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ**ред\
рдпрд╣ рд╣рдорд▓рд╛ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╕реНрдерд┐рддрд┐ рдкрд░ рдЖрдзрд╛рд░рд┐рдд рд╣реИ:

* рдПрдХ рд╕реНрдЯреИрдХ рдХрдордЬреЛрд░реА рдФрд░ рдЙрд╕реЗ рдЯреНрд░рд┐рдЧрд░ рдХрд░рдиреЗ рдХреЗ рддрд░реАрдХреЗ рдХреА рдЬрд╛рдирдХрд╛рд░реАред
* рдПрдХ рд╕рд░реНрд╡рд░ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдЬреЛ рдПрдХ рдХреНрд░реИрд╢ рдХреЗ рдмрд╛рдж рдкреБрдирд░рд╛рд░рдВрдн рд╣реЛрддрд╛ рд╣реИред

## рд╣рдорд▓рд╛

### **1. рдХрдордЬреЛрд░ рдСрдлрд╕реЗрдЯ рдЦреЛрдЬреЗрдВ** рд╕рд░реНрд╡рд░ рдХреЗ рдХрд┐рд╕реА рднреА рдЦрд░рд╛рдмреА рдХреА рдкрд╣рдЪрд╛рди рдХрд░рдиреЗ рддрдХ рдПрдХ рдЕрдзрд┐рдХ рд╡рд░реНрдгрдХреНрд░рдо рднреЗрдЬреЗрдВ

### **2. рдХреИрдирд░реА рдХреЛ рдмреНрд░реВрдЯ-рдлреЛрд░реНрд╕ рдХрд░реЗрдВ** рдЗрд╕реЗ рд▓реАрдХ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП&#x20;

### **3. рд╕реНрдЯреЛрд░реНрдб RBP рдФрд░ RIP рдХреЛ рдмреНрд░реВрдЯ-рдлреЛрд░реНрд╕ рдХрд░реЗрдВ** рд╕реНрдЯреИрдХ рдореЗрдВ рдЗрдиреНрд╣реЗрдВ рд▓реАрдХ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП

рдЖрдк рдЗрди рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА [рдпрд╣рд╛рдБ (BF Forked & Threaded Stack Canaries)](../common-binary-protections-and-bypasses/stack-canaries/bf-forked-stack-canaries.md) рдФрд░ [рдпрд╣рд╛рдБ (BF Addresses in the Stack)](../common-binary-protections-and-bypasses/pie/bypassing-canary-and-pie.md) рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВред

### **4. рд╕реНрдЯреЙрдк рдЧреИрдЬреЗрдЯ рдЦреЛрдЬреЗрдВ**

рдпрд╣ рдЧреИрдЬреЗрдЯ рдореБрдЦреНрдп рд░реВрдк рд╕реЗ рдпрд╣ рд╕рд╛рдмрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣реИ рдХрд┐ рдХреБрдЫ рджрд┐рд▓рдЪрд╕реНрдк рдЪреАрдЬрд╝ ROP рдЧреИрдЬреЗрдЯ рджреНрд╡рд╛рд░рд╛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реБрдЖ рдХреНрдпреЛрдВрдХрд┐ рдирд┐рд╖реНрдкрд╛рджрди рдХреНрд░реИрд╢ рдирд╣реАрдВ рд╣реБрдЖред рд╕рд╛рдорд╛рдиреНрдпрдд: рдпрд╣ рдЧреИрдЬреЗрдЯ рдХреБрдЫ рд╣реЛрдЧрд╛ рдЬреЛ **рдирд┐рд╖реНрдкрд╛рджрди рдХреЛ рд░реЛрдХреЗрдЧрд╛** рдФрд░ рдпрд╣ ROP рдЧреИрдЬреЗрдЯ рдХреА рдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП ROP рдЧреИрдЬреЗрдЯ рдХреА рдЦреЛрдЬ рдХреЗ рджреМрд░рд╛рди ROP рд╢реНрд░реГрдВрдЦрд▓рд╛ рдХреЗ рдЕрдВрдд рдореЗрдВ рд╕реНрдерд┐рдд рд╣реЛрдЧрд╛ред

### **5. BROP рдЧреИрдЬреЗрдЯ рдЦреЛрдЬреЗрдВ**

рдпрд╣ рддрдХрдиреАрдХ [**ret2csu**](ret2csu.md) рдЧреИрдЬреЗрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреА рд╣реИред рдФрд░ рдпрд╣ рдЗрд╕рд▓рд┐рдП рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдпрджрд┐ рдЖрдк рдХрд┐рд╕реА рднреА рдирд┐рд░реНрджреЗрд╢реЛрдВ рдХреЗ рдмреАрдЪ рдореЗрдВ рдЗрд╕ рдЧреИрдЬреЗрдЯ рддрдХ рдкрд╣реБрдВрдЪрддреЗ рд╣реИрдВ рддреЛ рдЖрдкрдХреЛ рдирд┐рдпрдВрддреНрд░рдг рдорд┐рд▓рддрд╛ рд╣реИ **`rsi`** рдФрд░ **`rdi`** рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП:

<figure><img src="../../.gitbook/assets/image (1).png" alt="" width="278"><figcaption><p><a href="https://www.scs.stanford.edu/brop/bittau-brop.pdf">https://www.scs.stanford.edu/brop/bittau-brop.pdf</a></p></figcaption></figure>

рдпреЗ рдЧреИрдЬреЗрдЯ рд╣реЛрдВрдЧреЗ:

* `pop rsi; pop r15; ret`
* `pop rdi; ret`

рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдЗрди рдЧреИрдЬреЗрдЯреНрд╕ рдХреЗ рд╕рд╛рде рджреЛ рддрд░реНрдХреЛрдВ рдХреЛ **рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рдирд╛ рд╕рдВрднрд╡** рд╣реИред

рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ ret2csu рдЧреИрдЬреЗрдЯ рдХрд╛ **рдПрдХ рдмрд╣реБрдд рд╣реА рдЕрджреНрд╡рд┐рддреАрдп рд╣рд╕реНрддрд╛рдХреНрд╖рд░** рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рд╕реНрдЯреИрдХ рд╕реЗ 6 рд░рдЬрд┐рд╕реНрдЯрд░реНрд╕ рдХреЛ рдкреЙрдк рдХрд░реЗрдЧрд╛ред рдЗрд╕рд▓рд┐рдП, рдПрдХ рд╢реНрд░реГрдВрдЦрд▓рд╛ рднреЗрдЬрдиреЗ рдкрд░:

`'A' * offset + canary + rbp + ADDR + 0xdead * 6 + STOP`

рдпрджрд┐ **STOP рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрддрд╛ рд╣реИ**, рддреЛ рдпрд╣ рдореБрдЦреНрдп рд░реВрдк рд╕реЗ рдпрд╣ рдЕрд░реНрде рд╣реИ рдХрд┐ рд╕реНрдЯреИрдХ рд╕реЗ 6 рд░рдЬрд┐рд╕реНрдЯрд░реНрд╕ рдкреЙрдк рдХрд┐рдП рдЧрдП рдПрдХ рдкрддрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред рдпрд╛ рдпрд╣ рдХрд┐ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдкрддрд╛ рднреА рдПрдХ рд╕реНрдЯреЙрдк рдкрддрд╛ рдерд╛ред

рдЗрд╕ **рдЕрдВрддрд┐рдо рд╡рд┐рдХрд▓реНрдк рдХреЛ рд╣рдЯрд╛рдиреЗ** рдХреЗ рд▓рд┐рдП рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдПрдХ рдирдИ рд╢реНрд░реГрдВрдЦрд▓рд╛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХреА рдЬрд╛рддреА рд╣реИ рдФрд░ рдпрд╣реЗ рдкрд┐рдЫрд▓реЗ рд╡рд╛рд▓реЗ рдиреЗ 6 рд░рдЬрд┐рд╕реНрдЯрд░реНрд╕ рдкреЙрдк рдХрд┐рдП рдереЗ рдХреА рдкреБрд╖реНрдЯрд┐ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдпрд╣реЗ STOP рдЧреИрдЬреЗрдЯ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдирд╣реАрдВ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП:

`'A' * offset + canary + rbp + ADDR`

ret2csu рдЧреИрдЬреЗрдЯ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдХреЗ рдмрд╛рдж, рдпрд╣ рд╕рдВрднрд╡ рд╣реИ рдХрд┐ **`rsi` рдФрд░ `rdi` рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЧреИрдЬреЗрдЯреЛрдВ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдпрд╛ рдЬрд╛ рд╕рдХреЗ**ред

### 6. PLT рдЦреЛрдЬреЗрдВ

PLT рддрд╛рд▓рд┐рдХрд╛ 0x400000 рд╕реЗ рдпрд╛ рд╕реНрдЯреИрдХ рд╕реЗ рд▓реАрдХ RIP рдкрддреЗ рд╕реЗ (рдпрджрд┐ **PIE** рдХрд╛ рдЙрдкрдпреЛрдЧ рд╣реЛ рд░рд╣рд╛ рд╣реИ) рдЦреЛрдЬрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рддрд╛рд▓рд┐рдХрд╛ рдХреЗ **рдПрдВрдЯреНрд░рд┐рдпрд╛рдВ** 16B (0x10B) рд╕реЗ рдЕрд▓рдЧ рд╣реЛрддреА рд╣реИрдВ, рдФрд░ рдЬрдм рдПрдХ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдХреЙрд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рддреЛ рд╕рд░реНрд╡рд░ рдХреНрд░реИрд╢ рдирд╣реАрдВ рд╣реЛрддрд╛ рд╣реИ рднрд▓реЗ рд╣реА рддрд╛рд░реНрдЧрд┐рдХ рдЧрд▓рдд рд╣реЛрдВред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, **PLT + 6B рдореЗрдВ рдПрдВрдЯреНрд░реА рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдирд╛ рднреА рдХреНрд░реИрд╢ рдирд╣реАрдВ рдХрд░рддрд╛** рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рдкрд╣рд▓рд╛ рдХреЛрдб рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрддрд╛ рд╣реИред

рдЗрд╕рд▓рд┐рдП, рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╡реНрдпрд╡рд╣рд╛рд░реЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░рдХреЗ PLT рддрд╛рд▓рд┐рдХрд╛ рдкрд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:

* `'A' * offset + canary + rbp + ADDR + STOP` -> рдХреЛрдИ рдХреНрд░реИрд╢ рдирд╣реАрдВ
* `'A' * offset + canary + rbp + (ADDR + 0x6) + STOP` -> рдХреЛрдИ рдХреНрд░реИрд╢ рдирд╣реАрдВ
* `'A' * offset + canary + rbp + (ADDR + 0x10) + STOP` -> рдХреЛрдИ рдХреНрд░реИрд╢ рдирд╣реАрдВ

### 7. strcmp рдЦреЛрдЬрдирд╛

**`strcmp`** рдлрд╝рдВрдХреНрд╢рди рд░рдЬрд┐рд╕реНрдЯрд░ **`rdx`** рдХреЛ рддреБрд▓рдирд╛ рдХреА рдЬрд╛ рд░рд╣реА рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХреА рд▓рдВрдмрд╛рдИ рдкрд░ рд╕реЗрдЯ рдХрд░рддрд╛ рд╣реИред рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ **`rdx`** рддреАрд╕рд░рд╛ рддрд░реНрдХ рд╣реИ рдФрд░ рд╣рдореЗрдВ рдЗрд╕реЗ **0 рд╕реЗ рдЕрдзрд┐рдХ** рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП рддрд╛рдХрд┐ рдмрд╛рдж рдореЗрдВ `write` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдХреЛ рд▓реАрдХ рдХрд░ рд╕рдХреЗрдВред

рдпрд╣ рд╕рдВрднрд╡ рд╣реИ рдХрд┐ **`strcmp`** рдХреА рд╕реНрдерд╛рди рдкрд░ PLT рдореЗрдВ рдкрд╛рдпрд╛ рдЬрд╛ рд╕рдХреЗ рдЙрд╕рдХреЗ рд╡реНрдпрд╡рд╣рд╛рд░ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдЬрд┐рд╕рдореЗрдВ рд╣рдо рдЕрдм рдлрд╝рдВрдХреНрд╢рдиреЛрдВ рдХреЗ рдкрд╣рд▓реЗ 2 рддрд░реНрдХреЛрдВ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

* strcmp(\<non read addr>, \<non read addr>) -> рдХреНрд░реИрд╢
* strcmp(\<non read addr>, \<read addr>) -> рдХреНрд░реИрд╢
* strcmp(\<read addr>, \<non read addr>) -> рдХреНрд░реИрд╢
* strcmp(\<read addr>, \<read addr>) -> рдХреЛрдИ рдХреНрд░реИрд╢ рдирд╣реАрдВ

рдЗрд╕реЗ рдЬрд╛рдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП PLT рддрд╛рд▓рд┐рдХрд╛ рдХреЗ рдкреНрд░рддреНрдпреЗрдХ рдПрдВрдЯреНрд░реА рдХреЛ рдХреЙрд▓ рдХрд░рдХреЗ рдпрд╛ **PLT рд╕реНрд▓реЛ рдкрде** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдореБрдЦреНрдп рд░реВрдк рд╕реЗ **PLT рддрд╛рд▓рд┐рдХрд╛ рдореЗрдВ рдПрдВрдЯреНрд░реА рдХреЛ рдХреЙрд▓ рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж + 0xb** (рдЬреЛ **`dlresolve`** рдХреЛ рдХреЙрд▓ рдХрд░рддрд╛ рд╣реИ) рдЖрддрд╛ рд╣реИ рдЬрд┐рд╕рдХреЗ рдмрд╛рдж рд╕реНрдЯреИрдХ рдореЗрдВ **рдПрдВрдЯреНрд░реА рдирдВрдмрд░** (рдЬреЛ рд╢реВрдиреНрдп рд╕реЗ рд╢реБрд░реВ рд╣реЛрддрд╛ рд╣реИ) рдЖрддрд╛ рд╣реИ рддрд╛рдХрд┐ рдкрд╣рд▓реЗ рд╕реЗ рд╕рднреА PLT рдПрдВрдЯреНрд░рд┐рдпреЛрдВ рдХреЛ рд╕реНрдХреИрди рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗ:

* strcmp(\<non read addr>, \<read addr>) -> рдХреНрд░реИрд╢
* `b'A' * offset + canary + rbp + (BROP + 0x9) + RIP + (BROP + 0x7) + p64(0x300) + p64(0x0) + (PLT + 0xb ) + p64(ENTRY) + STOP` -> рдХреНрд░реИрд╢ рд╣реЛрдЧрд╛
* strcmp(\<read addr>, \<non read addr>) -> рдХреНрд░реИрд╢
* `b'A' * offset + canary + rbp + (BROP + 0x9) + p64(0x300) + (BROP + 0x7) + RIP + p64(0x0) + (PLT + 0xb ) + p64(ENTRY) + STOP`&#x20;
* strcmp(\<read addr>, \<read addr>) -> рдХреЛрдИ рдХреНрд░реИрд╢ рдирд╣реАрдВ
* `b'A' * offset + canary + rbp + (BROP + 0x9) + RIP + (BROP + 0x
### 8. рд▓реЗрдЦрди рдпрд╛ рд╕рдордХрдХреНрд╖ рдЦреЛрдЬрдирд╛

рдЕрдВрдд рдореЗрдВ, рдбреЗрдЯрд╛ рдирд┐рдХрд╛рд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдЧреИрдЬреЗрдЯ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рддрд╛рдХрд┐ рдмрд╛рдЗрдирд░реА рдХреЛ рдирд┐рдХрд╛рд▓рд╛ рдЬрд╛ рд╕рдХреЗред рдФрд░ рдЗрд╕ рд╕рдордп **2 рддрд░реНрдХреЛрдВ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рдирд╛ рдФрд░ `rdx` рдХреЛ 0 рд╕реЗ рдЕрдзрд┐рдХ рд╕реЗрдЯ рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИред**

рдЗрд╕рдХреЗ рд▓рд┐рдП 3 рд╕рд╛рдорд╛рдиреНрдп рдлрд╝рдВрдХреНрд╢рди рд╣реИрдВ рдЬрд┐рдирдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:

* `puts(data)`
* `dprintf(fd, data)`
* `write(fd, data, len(data)`

рд╣рд╛рд▓рд╛рдВрдХрд┐, рдореВрд▓ рдкреЗрдкрд░ рдореЗрдВ рдХреЗрд╡рд▓ **`write`** рдХрд╛ рдЙрд▓реНрд▓реЗрдЦ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЗрд╕рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЪрд░реНрдЪрд╛ рдХрд░реЗрдВ:

рд╡рд░реНрддрдорд╛рди рд╕рдорд╕реНрдпрд╛ рдпрд╣ рд╣реИ рдХрд┐ рд╣рдореЗрдВ рдкрддрд╛ рдирд╣реАрдВ рд╣реИ **PLT рдХреЗ рдЕрдВрджрд░ рд▓реЗрдЦрди рдХрд╛рд░реНрдп рдХрд╣рд╛рдБ рд╣реИ** рдФрд░ рд╣рдореЗрдВ **рдЕрдкрдиреЗ рд╕реЙрдХреЗрдЯ рдХреЛ рдбреЗрдЯрд╛ рднреЗрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ fd рдирдВрдмрд░ рдкрддрд╛ рдирд╣реАрдВ рд╣реИ**ред

рд╣рд╛рд▓рд╛рдВрдХрд┐, рд╣рдореЗрдВ **PLT рддрд╛рд▓рд┐рдХрд╛ рдХрд╣рд╛рдБ рд╣реИ рдпрд╣ рдкрддрд╛ рд╣реИ** рдФрд░ рдЗрд╕рдХреЗ **рд╡реНрдпрд╡рд╣рд╛рд░** рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рд▓реЗрдЦрди рдХреЛ рдЦреЛрдЬрдирд╛ рд╕рдВрднрд╡ рд╣реИред рдФрд░ рд╣рдо рд╕рд░реНрд╡рд░ рдХреЗ рд╕рд╛рде **рдХрдИ рдХрдиреЗрдХреНрд╢рди** рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ **рдПрдХ рдЙрдЪреНрдЪ FD** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЙрдореНрдореАрдж рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдпрд╣ рд╣рдорд╛рд░реЗ рдХрдиреЗрдХреНрд╢рдиреЛрдВ рдореЗрдВ рд╕реЗ рдХрд┐рд╕реА рд╕реЗ рдореЗрд▓ рдЦрд╛рддрд╛ рд╣реИред

рдЙрди рдлрд╝рдВрдХреНрд╢рдиреЛрдВ рдХреЛ рдЦреЛрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рд╡реНрдпрд╡рд╣рд╛рд░ рд╣рд╕реНрддрд╛рдХреНрд╖рд░:

* `'A' * offset + canary + rbp + (BROP + 0x9) + RIP + (BROP + 0x7) + p64(0) + p64(0) + (PLT + 0xb) + p64(ENTRY) + STOP`  -> рдпрджрд┐ рдбреЗрдЯрд╛ рдкреНрд░рд┐рдВрдЯ рд╣реЛрддрд╛ рд╣реИ, рддреЛ puts рдорд┐рд▓ рдЧрдпрд╛ рдерд╛
* `'A' * offset + canary + rbp + (BROP + 0x9) + FD + (BROP + 0x7) + RIP + p64(0x0) + (PLT + 0xb) + p64(ENTRY) + STOP`  -> рдпрджрд┐ рдбреЗрдЯрд╛ рдкреНрд░рд┐рдВрдЯ рд╣реЛрддрд╛ рд╣реИ, рддреЛ dprintf рдорд┐рд▓ рдЧрдпрд╛ рдерд╛
* `'A' * offset + canary + rbp + (BROP + 0x9) + RIP + (BROP + 0x7) + (RIP + 0x1) + p64(0x0) + (PLT + 0xb ) + p64(STRCMP ENTRY) + (BROP + 0x9) + FD + (BROP + 0x7) + RIP + p64(0x0) + (PLT + 0xb) + p64(ENTRY) + STOP`  -> рдпрджрд┐ рдбреЗрдЯрд╛ рдкреНрд░рд┐рдВрдЯ рд╣реЛрддрд╛ рд╣реИ, рддреЛ write рдорд┐рд▓ рдЧрдпрд╛ рдерд╛

## рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдЙрддреНрдкреАрдбрд╝рди

* [https://github.com/Hakumarachi/Bropper](https://github.com/Hakumarachi/Bropper)

## рд╕рдВрджрд░реНрдн

* рдореВрд▓ рдкреЗрдкрд░: [https://www.scs.stanford.edu/brop/bittau-brop.pdf](https://www.scs.stanford.edu/brop/bittau-brop.pdf)
* [https://www.ctfrecipes.com/pwn/stack-exploitation/arbitrary-code-execution/code-reuse-attack/blind-return-oriented-programming-brop](https://www.ctfrecipes.com/pwn/stack-exploitation/arbitrary-code-execution/code-reuse-attack/blind-return-oriented-programming-brop)
