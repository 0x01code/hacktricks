# First Fit

<details>

<summary><strong>Aprenda hacking AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras maneiras de apoiar o HackTricks:

* Se voc√™ quiser ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF** Verifique os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**swag oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-nos** no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para os** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) reposit√≥rios do github.

</details>

## **First Fit**

Quando voc√™ libera mem√≥ria em um programa usando glibc, diferentes "bins" s√£o usados para gerenciar os peda√ßos de mem√≥ria. Aqui est√° uma explica√ß√£o simplificada de dois cen√°rios comuns: bins n√£o ordenados e fastbins.

### Bins N√£o Ordenados

Quando voc√™ libera um peda√ßo de mem√≥ria que n√£o √© um peda√ßo r√°pido, ele vai para o bin n√£o ordenado. Este bin age como uma lista onde novos peda√ßos liberados s√£o adicionados √† frente (a "cabe√ßa"). Quando voc√™ solicita um novo peda√ßo de mem√≥ria, o alocador olha para o bin n√£o ordenado de tr√°s (a "cauda") para encontrar um peda√ßo grande o suficiente. Se um peda√ßo do bin n√£o ordenado for maior do que o que voc√™ precisa, ele √© dividido, com a parte da frente sendo retornada e a parte restante permanecendo no bin.

Exemplo:

* Voc√™ aloca 300 bytes (`a`), ent√£o 250 bytes (`b`), libera `a` e solicita novamente 250 bytes (`c`).
* Quando voc√™ libera `a`, ele vai para o bin n√£o ordenado.
* Se ent√£o voc√™ solicitar 250 bytes novamente, o alocador encontra `a` na cauda e o divide, retornando a parte que se encaixa em sua solicita√ß√£o e mantendo o restante no bin.
* `c` estar√° apontando para o `a` anterior e preenchido com os `a's`.
```c
char *a = malloc(300);
char *b = malloc(250);
free(a);
char *c = malloc(250);
```
### Fastbins

Fastbins s√£o usados para pequenos peda√ßos de mem√≥ria. Ao contr√°rio dos bins n√£o ordenados, os fastbins adicionam novos peda√ßos √† cabe√ßa, criando um comportamento de √∫ltimo a entrar, primeiro a sair (LIFO). Se voc√™ solicitar um pequeno peda√ßo de mem√≥ria, o alocador ir√° retirar da cabe√ßa do fastbin.

Exemplo:

* Voc√™ aloca quatro peda√ßos de 20 bytes cada (`a`, `b`, `c`, `d`).
* Quando voc√™ os libera em qualquer ordem, os peda√ßos liberados s√£o adicionados √† cabe√ßa do fastbin.
* Se voc√™ ent√£o solicitar um peda√ßo de 20 bytes, o alocador ir√° retornar o peda√ßo mais recentemente liberado da cabe√ßa do fastbin.
```c
char *a = malloc(20);
char *b = malloc(20);
char *c = malloc(20);
char *d = malloc(20);
free(a);
free(b);
free(c);
free(d);
a = malloc(20);   // d
b = malloc(20);   // c
c = malloc(20);   // b
d = malloc(20);   // a
```
## Outras Refer√™ncias e Exemplos

* [https://heap-exploitation.dhavalkapil.com/attacks/first\_fit](https://heap-exploitation.dhavalkapil.com/attacks/first\_fit)
* [https://8ksec.io/arm64-reversing-and-exploitation-part-2-use-after-free/](https://8ksec.io/arm64-reversing-and-exploitation-part-2-use-after-free/)
* ARM64. Use after free: Gerar um objeto de usu√°rio, liber√°-lo, gerar um objeto que obt√©m o bloco liberado e permite escrever nele, **sobrescrevendo a posi√ß√£o da senha do usu√°rio** da anterior. Reutilizar o usu√°rio para **burlar a verifica√ß√£o da senha**
