# First Fit

<details>

<summary><strong>Jifunze AWS hacking kutoka sifuri hadi shujaa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Mtaalam wa Timu Nyekundu ya AWS ya HackTricks)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako ikitangazwa kwenye HackTricks** au **kupakua HackTricks kwa PDF** Angalia [**MIPANGO YA USAJILI**](https://github.com/sponsors/carlospolop)!
* Pata [**swag rasmi ya PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**Familia ya PEASS**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa [**NFTs**](https://opensea.io/collection/the-peass-family) ya kipekee
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au kikundi cha [**telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Shiriki mbinu zako za kuhack kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos za github.

</details>

## **First Fit**

Wakati unafuta kumbukumbu katika programu ukitumia glibc, "bins" tofauti hutumiwa kusimamia vipande vya kumbukumbu. Hapa kuna maelezo rahisi ya hali mbili za kawaida: unsorted bins na fastbins.

### Unsorted Bins

Unapofuta kipande cha kumbukumbu ambacho sio kipande cha haraka, kinaenda kwenye bin isiyopangwa. Bin hii inafanya kazi kama orodha ambapo vipande vipya vilivyofutwa huongezwa mbele (kwenye "kichwa"). Unapoomba kipande kipya cha kumbukumbu, mpangishaji huangalia bin isiyopangwa kutoka nyuma (kwenye "mkia") ili kupata kipande kikubwa cha kutosha. Ikiwa kipande kutoka kwenye bin isiyopangwa ni kikubwa kuliko unachohitaji, kinagawanywa, sehemu ya mbele ikirudishwa na sehemu iliyobaki ikibaki kwenye bin.

Mfano:

* Unatenga bayti 300 (`a`), kisha bayti 250 (`b`), kisha unafuta `a` na kuomba tena bayti 250 (`c`).
* Unapofuta `a`, inaenda kwenye bin isiyopangwa.
* Ikiwa kisha unaomba tena bayti 250, mpangishaji anapata `a` kwenye mkia na kugawanya, kurudisha sehemu inayofaa ombi lako na kuiweka iliyobaki kwenye bin.
* `c` itakuwa inaelekeza kwa `a` ya awali na kujazwa na `a's`.
```c
char *a = malloc(300);
char *b = malloc(250);
free(a);
char *c = malloc(250);
```
### Fastbins

Fastbins hutumiwa kwa vipande vidogo vya kumbukumbu. Tofauti na vyungu visivyopangwa, fastbins huongeza vipande vipya kichwani, ikiumba tabia ya mwisho-mwanzo (LIFO). Ikiwa unahitaji kipande kidogo cha kumbukumbu, mpangishaji atachukua kutoka kichwani mwa fastbin.

Mfano:

* Unagawa vipande vinne vya baiti 20 kila kimoja (`a`, `b`, `c`, `d`).
* Unapovifuta kwa mpangilio wowote, vipande vilivyofutwa vinaongezwa kichwani mwa fastbin.
* Ikiwa baadaye unahitaji kipande cha baiti 20, mpangishaji atarudisha kipande kilichofutwa hivi karibuni zaidi kutoka kichwani mwa fastbin.
```c
char *a = malloc(20);
char *b = malloc(20);
char *c = malloc(20);
char *d = malloc(20);
free(a);
free(b);
free(c);
free(d);
a = malloc(20);   // d
b = malloc(20);   // c
c = malloc(20);   // b
d = malloc(20);   // a
```
## Marejeo Mengine & Mifano

* [https://heap-exploitation.dhavalkapil.com/attacks/first\_fit](https://heap-exploitation.dhavalkapil.com/attacks/first\_fit)
* [https://8ksec.io/arm64-reversing-and-exploitation-part-2-use-after-free/](https://8ksec.io/arm64-reversing-and-exploitation-part-2-use-after-free/)
* ARM64. Matumizi baada ya kuachiliwa: Unda kitu cha mtumiaji, kiachie, unda kitu ambacho kinapata kipande kilichoachiliwa na kuruhusu kuandika kwake, **kubadilisha nafasi ya nenosiri la mtumiaji** kutoka kwa ile ya awali. Tumia mtumiaji tena ili **kipuuze ukaguzi wa nenosiri**
