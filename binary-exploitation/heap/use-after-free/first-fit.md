# First Fit

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Expert en √©quipe rouge AWS de HackTricks)</strong></a><strong>!</strong></summary>

Autres fa√ßons de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## **First Fit**

Lorsque vous lib√©rez de la m√©moire dans un programme utilisant glibc, diff√©rents "bacs" sont utilis√©s pour g√©rer les morceaux de m√©moire. Voici une explication simplifi√©e de deux sc√©narios courants : les bacs non tri√©s et les fastbins.

### Bacs non tri√©s

Lorsque vous lib√©rez un morceau de m√©moire qui n'est pas un morceau rapide, il va dans le bac non tri√©. Ce bac agit comme une liste o√π les nouveaux morceaux lib√©r√©s sont ajout√©s √† l'avant (la "t√™te"). Lorsque vous demandez un nouveau morceau de m√©moire, l'allocateur regarde le bac non tri√© depuis l'arri√®re (la "queue") pour trouver un morceau suffisamment grand. Si un morceau du bac non tri√© est plus grand que ce dont vous avez besoin, il est divis√©, la partie avant √©tant renvoy√©e et le reste restant dans le bac.

Exemple :

* Vous allouez 300 octets (`a`), puis 250 octets (`b`), lib√©rez `a` et demandez √† nouveau 250 octets (`c`).
* Lorsque vous lib√©rez `a`, il va dans le bac non tri√©.
* Si vous demandez ensuite √† nouveau 250 octets, l'allocateur trouve `a` √† la queue et le divise, renvoyant la partie qui correspond √† votre demande et conservant le reste dans le bac.
* `c` pointera vers le `a` pr√©c√©dent et sera rempli avec les `a`.
```c
char *a = malloc(300);
char *b = malloc(250);
free(a);
char *c = malloc(250);
```
### Fastbins

Les fastbins sont utilis√©s pour de petits morceaux de m√©moire. Contrairement aux bacs non tri√©s, les fastbins ajoutent de nouveaux morceaux √† la t√™te, cr√©ant un comportement de dernier entr√©, premier sorti (LIFO). Si vous demandez un petit morceau de m√©moire, l'allocateur le prendra √† partir de la t√™te du fastbin.

Exemple :

* Vous allouez quatre morceaux de 20 octets chacun (`a`, `b`, `c`, `d`).
* Lorsque vous les lib√©rez dans n'importe quel ordre, les morceaux lib√©r√©s sont ajout√©s √† la t√™te du fastbin.
* Si vous demandez ensuite un morceau de 20 octets, l'allocateur renverra le morceau lib√©r√© le plus r√©cemment √† partir de la t√™te du fastbin.
```c
char *a = malloc(20);
char *b = malloc(20);
char *c = malloc(20);
char *d = malloc(20);
free(a);
free(b);
free(c);
free(d);
a = malloc(20);   // d
b = malloc(20);   // c
c = malloc(20);   // b
d = malloc(20);   // a
```
## Autres R√©f√©rences & Exemples

* [https://heap-exploitation.dhavalkapil.com/attacks/first\_fit](https://heap-exploitation.dhavalkapil.com/attacks/first\_fit)
* [https://8ksec.io/arm64-reversing-and-exploitation-part-2-use-after-free/](https://8ksec.io/arm64-reversing-and-exploitation-part-2-use-after-free/)
* ARM64. Utilisation apr√®s lib√©ration : G√©n√©rer un objet utilisateur, le lib√©rer, g√©n√©rer un objet qui r√©cup√®re le morceau lib√©r√© et permet d'√©crire dedans, **√©crasant la position du mot de passe de l'utilisateur** du pr√©c√©dent. R√©utiliser l'utilisateur pour **contourner la v√©rification du mot de passe**
