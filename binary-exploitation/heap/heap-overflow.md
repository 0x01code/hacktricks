# D√©bordement de tas

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Expert en √©quipe rouge AWS de HackTricks)</strong></a><strong>!</strong></summary>

Autres fa√ßons de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts GitHub.

</details>

## Informations de base

Un d√©bordement de tas est comme un [**d√©bordement de pile**](../stack-overflow/) mais dans le tas. Fondamentalement, cela signifie qu'un espace a √©t√© r√©serv√© dans le tas pour stocker des donn√©es et que **les donn√©es stock√©es √©taient plus grandes que l'espace r√©serv√©**.

Dans les d√©bordements de pile, nous savons que certains registres comme le pointeur d'instruction ou le cadre de pile vont √™tre restaur√©s √† partir de la pile et il pourrait √™tre possible d'en abuser. En cas de d√©bordement de tas, il **n'y a aucune information sensible stock√©e par d√©faut** dans le fragment de tas qui peut √™tre d√©bord√©. Cependant, il pourrait s'agir d'informations sensibles ou de pointeurs, donc la **criticit√©** de cette vuln√©rabilit√© **d√©pend** de **quelles donn√©es pourraient √™tre √©cras√©es** et comment un attaquant pourrait en abuser.

{% hint style="success" %}
Pour trouver les d√©calages de d√©bordement, vous pouvez utiliser les m√™mes mod√®les que pour les [**d√©bordements de pile**](../stack-overflow/#finding-stack-overflows-offsets).
{% endhint %}

### D√©bordements de pile vs D√©bordements de tas

Dans les d√©bordements de pile, l'agencement et les donn√©es qui vont √™tre pr√©sentes dans la pile au moment o√π la vuln√©rabilit√© peut √™tre d√©clench√©e sont assez fiables. Cela est d√ª au fait que la pile est lin√©aire, augmentant toujours dans la m√©moire en collision, dans **des endroits sp√©cifiques de l'ex√©cution du programme, la m√©moire de pile stocke g√©n√©ralement un type de donn√©es similaire** et elle a une structure sp√©cifique avec des pointeurs √† la fin de la partie de pile utilis√©e par chaque fonction.

Cependant, dans le cas d'un d√©bordement de tas, parce que la m√©moire utilis√©e n'est pas lin√©aire mais **les fragments allou√©s sont g√©n√©ralement √† des positions s√©par√©es de la m√©moire** (pas les uns √† c√¥t√© des autres) en raison des **bacs et des zones** s√©parant les allocations par taille et parce que **la m√©moire pr√©c√©demment lib√©r√©e est utilis√©e** avant d'allouer de nouveaux fragments. Il est **compliqu√© de savoir quel objet va entrer en collision avec celui vuln√©rable** √† un d√©bordement de tas. Ainsi, lorsqu'un d√©bordement de tas est trouv√©, il est n√©cessaire de trouver un **moyen fiable de faire en sorte que l'objet d√©sir√© soit le suivant en m√©moire** √† partir de celui qui peut √™tre d√©bord√©.

Une des techniques utilis√©es pour cela est le **d√©poussi√©rage de tas** qui est utilis√© par exemple [**dans ce post**](https://azeria-labs.com/grooming-the-ios-kernel-heap/). Dans le post, il est expliqu√© comment dans le noyau iOS, lorsqu'une zone manque de m√©moire pour stocker des fragments de m√©moire, elle l'agrandit d'une page de noyau, et cette page est divis√©e en fragments des tailles attendues qui seraient utilis√©es dans l'ordre (jusqu'√† la version iOS 9.2, puis ces fragments sont utilis√©s de mani√®re al√©atoire pour compliquer l'exploitation de ces attaques).

Par cons√©quent, dans le post pr√©c√©dent o√π un d√©bordement de tas se produit, pour forcer l'objet d√©bord√© √† entrer en collision avec un ordre victime, plusieurs **`kallocs` sont forc√©s par plusieurs threads pour essayer de s'assurer que tous les fragments libres sont remplis et qu'une nouvelle page est cr√©√©e**.

Pour forcer ce remplissage avec des objets d'une taille sp√©cifique, l'**allocation hors ligne associ√©e √† un port mach iOS** est un candidat id√©al. En ajustant la taille du message, il est possible de sp√©cifier exactement la taille de l'allocation `kalloc` et lorsque le port mach correspondant est d√©truit, l'allocation correspondante sera imm√©diatement lib√©r√©e √† `kfree`.

Ensuite, certains de ces espaces r√©serv√©s peuvent √™tre **lib√©r√©s**. La liste de lib√©ration **`kalloc.4096` lib√®re les √©l√©ments dans un ordre dernier entr√©, premier sorti**, ce qui signifie essentiellement que si certains espaces r√©serv√©s sont lib√©r√©s et que l'exploit essaie d'allouer plusieurs objets victimes tout en essayant d'allouer l'objet vuln√©rable au d√©bordement, il est probable que cet objet sera suivi par un objet victime.

## Exemple ARM64

Sur la page [https://8ksec.io/arm64-reversing-and-exploitation-part-1-arm-instruction-set-simple-heap-overflow/](https://8ksec.io/arm64-reversing-and-exploitation-part-1-arm-instruction-set-simple-heap-overflow/), vous pouvez trouver un exemple de d√©bordement de tas o√π une commande qui va √™tre ex√©cut√©e est stock√©e dans le fragment suivant du fragment d√©bord√©. Ainsi, il est possible de modifier la commande ex√©cut√©e en l'√©crasant avec un exploit simple tel que :
```bash
python3 -c 'print("/"*0x400+"/bin/ls\x00")' > hax.txt
```
<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Expert de l'√©quipe rouge AWS de HackTricks)</strong></a><strong>!</strong></summary>

D'autres fa√ßons de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
