# Casa de Einherjar

<details>

<summary><strong>Aprende hacking en AWS de cero a héroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Experto en Equipos Rojos de AWS de HackTricks)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** Consulta los [**PLANES DE SUSCRIPCIÓN**](https://github.com/sponsors/carlospolop)!
* Obtén el [**swag oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colección de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **Únete al** 💬 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **síguenos** en **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Información Básica

### Código

* Revisa el ejemplo en [https://github.com/shellphish/how2heap/blob/master/glibc\_2.35/house\_of\_einherjar.c](https://github.com/shellphish/how2heap/blob/master/glibc\_2.35/house\_of\_einherjar.c)

### Objetivo

* El objetivo es asignar memoria en casi cualquier dirección específica.

### Requisitos

* Desbordamiento por uno sobre la cabecera del siguiente fragmento para modificar el previo en uso
* Ser capaz de modificar los datos `prev_size`, que forman parte del fragmento actual (al final)
* Fuga de heap

### Ataque

* Se crea un fragmento falso dentro de un fragmento controlado por el atacante apuntando con `fd` y `bk` al fragmento original para evadir protecciones
* Se crean otros 2 fragmentos (`B` y `C`).
* Aprovechando el desbordamiento por uno en el fragmento `B`, se limpia el bit `prev in use` y se sobrescribe los datos `prev_size` con la diferencia entre el lugar donde se asigna el fragmento `C` y el fragmento falso `A` generado antes.
* Este `prev_size` y el tamaño del fragmento falso `A` deben ser iguales para evadir las comprobaciones.
* Luego, se llena la Tcache
* Luego, se libera `C` para que se consolide con el fragmento falso `A`
* Luego, se crea un nuevo fragmento `D` que comenzará en el fragmento falso `A` y cubrirá el fragmento `B`
* Luego, se libera `B` y se sobrescribe su `fd` con la dirección objetivo haciendo que apunte a la dirección objetivo aprovechando el fragmento `D` que lo contiene.
* Luego, se realizan 2 mallocs porque el segundo contendrá la dirección objetivo

## Referencias

* [https://github.com/shellphish/how2heap/blob/master/glibc\_2.35/house\_of\_einherjar.c](https://github.com/shellphish/how2heap/blob/master/glibc\_2.35/house\_of\_einherjar.c)

<details>

<summary><strong>Aprende hacking en AWS de cero a héroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Experto en Equipos Rojos de AWS de HackTricks)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** Consulta los [**PLANES DE SUSCRIPCIÓN**](https://github.com/sponsors/carlospolop)!
* Obtén el [**swag oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colección de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **Únete al** 💬 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **síguenos** en **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
