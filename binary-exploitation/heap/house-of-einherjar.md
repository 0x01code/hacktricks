# Casa de Einherjar

<details>

<summary><strong>Aprenda hacking AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras maneiras de apoiar o HackTricks:

* Se voc√™ quiser ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF** Verifique os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Obtenha o [**swag oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-nos** no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para os** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) reposit√≥rios do github.

</details>

## Informa√ß√µes B√°sicas

### C√≥digo

* Verifique o exemplo em [https://github.com/shellphish/how2heap/blob/master/glibc\_2.35/house\_of\_einherjar.c](https://github.com/shellphish/how2heap/blob/master/glibc\_2.35/house\_of\_einherjar.c)

### Objetivo

* O objetivo √© alocar mem√≥ria em quase qualquer endere√ßo espec√≠fico.

### Requisitos

* Off by one sobre o cabe√ßalho do pr√≥ximo chunk para modificar o prev em uso
* Ser capaz de modificar os dados `prev_size`, que faz parte do chunk atual (no final)
* Vazamento de heap

### Ataque

* Um chunk falso `A` √© criado dentro de um chunk controlado pelo atacante apontando com `fd` e `bk` para o chunk original para contornar prote√ß√µes
* 2 outros chunks (`B` e `C`) s√£o criados.
* Abusando do off by one no `B`, o bit `prev in use` √© limpo e os dados `prev_size` s√£o sobrescritos com a diferen√ßa entre o local onde o chunk `C` √© alocado e o chunk falso `A` gerado anteriormente.
* Este `prev_size` e o tamanho do chunk falso `A` devem ser iguais para contornar verifica√ß√µes.
* Em seguida, o Tcache √© preenchido
* Em seguida, `C` √© liberado para que ele se consolide com o chunk falso `A`
* Em seguida, um novo chunk `D` √© criado que come√ßar√° no chunk falso `A` e cobrir√° o chunk `B`
* Em seguida, `B` √© liberado e seu `fd` √© sobrescrito para o endere√ßo alvo fazendo-o apontar para o endere√ßo alvo abusando do chunk `D` que o cont√©m.
* Em seguida, s√£o feitos 2 mallocs porque o segundo conter√° o endere√ßo alvo

## Refer√™ncias

* [https://github.com/shellphish/how2heap/blob/master/glibc\_2.35/house\_of\_einherjar.c](https://github.com/shellphish/how2heap/blob/master/glibc\_2.35/house\_of\_einherjar.c)

<details>

<summary><strong>Aprenda hacking AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras maneiras de apoiar o HackTricks:

* Se voc√™ quiser ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF** Verifique os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Obtenha o [**swag oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-nos** no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para os** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) reposit√≥rios do github.

</details>
