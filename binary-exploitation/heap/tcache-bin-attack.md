# Shambulizi la Tcache Bin

<details>

<summary><strong>Jifunze kuhusu kudukua AWS kutoka sifuri hadi shujaa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Mtaalam wa Timu Nyekundu ya AWS ya HackTricks)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako ikionekana kwenye HackTricks** au **kupakua HackTricks kwa PDF** Angalia [**MIPANGO YA KUJIUNGA**](https://github.com/sponsors/carlospolop)!
* Pata [**bidhaa rasmi za PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**Familia ya PEASS**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa kipekee wa [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au kikundi cha [**telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Shiriki mbinu zako za kudukua kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos za github.

</details>

## Taarifa Msingi

Kwa habari zaidi kuhusu ni nini tcache bin angalia ukurasa huu:

{% content-ref url="bins-and-memory-allocations.md" %}
[bins-and-memory-allocations.md](bins-and-memory-allocations.md)
{% endcontent-ref %}

Kwanza kabisa, kumbuka kuwa Tcache iliingizwa katika toleo la glibc 2.26.

Shambulizi la **Tcache** lililopendekezwa katika [**ukurasa wa guyinatuxido**](https://guyinatuxedo.github.io/29-tcache/tcache\_explanation/index.html) ni sawa sana na shambulizi la fast bin ambapo lengo ni kubadilisha pointer kwenda kwa kipande kinachofuata kwenye bin ndani ya kipande kilichofutwa kwenda kwa anwani isiyojulikana ili baadaye iwezekane **kuweka anwani hiyo maalum na labda kubadilisha pointes**.

Hata hivyo, siku hizi, ukikimbia nambari iliyotajwa utapata kosa: **`malloc(): unaligned tcache chunk detected`**. Kwa hivyo, ni muhimu kuandika anwani iliyolingana katika pointer mpya (au kutekeleza mara za kutosha nambari ili anwani iliyoandikwa iwe kweli imeunganishwa).

### Shambulizi la vitambulisho vya Tcache

Kawaida inawezekana kupata mwanzoni mwa kipande cha heap kikichukua **idadi ya vipande kwa kila kielelezo** ndani ya tcache na anwani ya **kielelezo cha kichwa cha kila kielelezo cha tcache**. Ikiwa kwa sababu fulani inawezekana kubadilisha habari hii, ingewezekana **kuweka kielelezo cha kichwa cha kielelezo fulani kuelekea kwa anwani inayotakiwa** (kama kitanzi cha malloc) kisha kuweka kipande cha ukubwa wa kielelezo na kubadilisha maudhui ya kitanzi cha malloc katika kesi hii.

## Mifano

* CTF [https://guyinatuxedo.github.io/29-tcache/dcquals19\_babyheap/index.html](https://guyinatuxedo.github.io/29-tcache/dcquals19\_babyheap/index.html)
* **Uvuaji wa habari ya Libc**: Inawezekana kujaza tcaches, kuongeza kipande kwenye orodha isiyopangwa, kufuta tcache na **kuweka upya kipande kutoka kwenye bin isiyopangwa** ikibadilisha tu 8B za kwanza, ikiiacha **anwani ya pili ya libc kutoka kwa kipande ikiwa bado tunaweza kuisoma**.
* **Shambulizi la Tcache**: Programu ina mapungufu ya 1B ya kujaa kwa kipande cha heap. Hii itatumika kubadilisha **kichwa cha ukubwa** cha kipande kilichopewa kufanya iwe kubwa zaidi. Kisha, kipande hiki kitafutwa, kikiwekwa kwenye tcache ya vipande vya ukubwa wa bandia. Kisha, tutapata kipande na ukubwa wa bandia, na kipande kilichopita kitajulikana kuwa **kidogo kweli** na hii itatoa fursa ya **kubadilisha kipande kinachofuata kwenye kumbukumbu**.\
Tutatumia hii kubadilisha **kielekezo cha FD cha kipande kinachofuata** kuelekea **`malloc_hook`**, kisha ni rahisi kuweka alama 2: kwanza kielekezo halali tulichobadilisha, na kisha alokesheni ya pili itarudisha kipande kwenye **`malloc_hook`** ambayo inawezekana kutumia kudukua kuandika **gadget moja**.
* CTF [https://guyinatuxedo.github.io/29-tcache/plaid19\_cpp/index.html](https://guyinatuxedo.github.io/29-tcache/plaid19\_cpp/index.html)
* **Uvuaji wa habari ya Libc**: Kuna matumizi baada ya kufuta na kufuta mara mbili. Katika mwongozo huu mwandishi alivuja anwani ya libc kwa kusoma anwani ya kipande kilichowekwa kwenye bin ndogo (kama kuvuja kutoka kwa bin isiyopangwa lakini kutoka kwa ile ndogo)
* **Shambulizi la Tcache**: Tcache inafanywa kupitia **kufuta mara mbili**. Kipande kimoja kinafutwa mara mbili, kwa hivyo ndani ya Tcache kipande kitaelekeza kwake yenyewe. Kisha, kinafanyiwa alokesheni, kielekezo chake cha FD kinabadilishwa kuelekea kwa **kitanzi cha bure** na kisha alokesheni inafanywa tena ili kipande kinachofuata kwenye orodha iwe kwenye kitanzi cha bure. Kisha, hii pia inafanyiwa alokesheni na inawezekana kuandika anwani ya `system` hapa ili wakati alokesheni inayotumia `"/bin/sh"` inafutwa tunapata kibao.
* CTF [https://guyinatuxedo.github.io/44-more\_tcache/csaw19\_popping\_caps0/index.html](https://guyinatuxedo.github.io/44-more\_tcache/csaw19\_popping\_caps0/index.html)
* **Shambulizi la vitambulisho vya Tcache**: Inawezekana alokesheni na kufuta kipande cha ukubwa ambao ukihifadhiwa ndani ya habari ya tcache itazalisha **nafasi ikiwa na thamani 0x100** (kwa sababu hiyo ni bayti inayoonyesha ni vipande vingapi katika kielelezo hicho vinahifadhiwa). Kisha, kwa kutumia thamani hii inawezekana kufuta anwani hii kwani inaonekana kama ni kipande cha ukubwa wa 0x100. Hii itaongeza anwani hiyo kwenye kielelezo cha vipande vya ukubwa wa 0x100 katika tcache.\
Kisha, kwa kutoa kipande cha ukubwa wa 0x100, inawezekana kubadilisha anwani ya kipande cha mwanzo cha vitambulisho vingine vya tcache. Kwa mfano kuweka anwani ya kitanzi cha malloc katika moja yao na alokesheni ya kipande cha ukubwa wa kielelezo hicho itatoa kipande katika kitanzi cha calloc, ambayo inaruhusu kuandika kibao kimoja kupata alokesheni ya s shell.

<details>

<summary><strong>Jifunze kuhusu kudukua AWS kutoka sifuri hadi shujaa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Mtaalam wa Timu Nyekundu ya AWS ya HackTricks)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako ikionekana kwenye HackTricks** au **kupakua HackTricks kwa PDF** Angalia [**MIPANGO YA KUJIUNGA**](https://github.com/sponsors/carlospolop)!
* Pata [**bidhaa rasmi za PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**Familia ya PEASS**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa kipekee wa [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au kikundi cha [**telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Shiriki mbinu zako za kudukua kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos za github.

</details>
