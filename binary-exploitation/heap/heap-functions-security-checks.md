# √úberpr√ºfungen der Heap-Funktionen-Sicherheit

<details>

<summary><strong>Erlernen Sie AWS-Hacking von Null auf Held mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks beworben sehen m√∂chten** oder **HackTricks als PDF herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merch**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositorys einreichen.

</details>

## unlink

Diese Funktion entfernt einen Chunk aus einer doppelt verketteten Liste. √úbliche √úberpr√ºfungen stellen sicher, dass die Struktur der verketteten Liste beim Entfernen von Chunks konsistent bleibt.

* **Konsistenz√ºberpr√ºfungen**:
* √úberpr√ºfen, ob `P->fd->bk == P` und `P->bk->fd == P`.
* Fehlermeldung: `corrupted double-linked list`

## \_int\_malloc

Diese Funktion ist f√ºr die Zuweisung von Speicher aus dem Heap verantwortlich. √úberpr√ºfungen hier stellen sicher, dass der Speicher w√§hrend der Zuweisung nicht besch√§digt wird.

* **Fastbin-Gr√∂√üen√ºberpr√ºfung**:
* Beim Entfernen eines Chunks aus einem Fastbin sicherstellen, dass die Gr√∂√üe des Chunks im Bereich des Fastbins liegt.
* Fehlermeldung: `malloc(): memory corruption (fast)`
* **Konsistenz√ºberpr√ºfung des Smallbins**:
* Beim Entfernen eines Chunks aus einem Smallbin sicherstellen, dass die vorherigen und n√§chsten Verkn√ºpfungen in der doppelt verketteten Liste konsistent sind.
* Fehlermeldung: `malloc(): smallbin double linked list corrupted`
* **√úberpr√ºfung des Speicherbereichs des unsortierten Bins**:
* Stellen Sie sicher, dass die Gr√∂√üe der Chunks im unsortierten Bin innerhalb der minimalen und maximalen Grenzen liegt.
* Fehlermeldung: `malloc(): memory corruption`
* **Konsistenz√ºberpr√ºfung des unsortierten Bins (erstes Szenario)**:
* Beim Einf√ºgen eines Restchunks in den unsortierten Bin √ºberpr√ºfen, ob `unsorted_chunks(av)->fd->bk == unsorted_chunks(av)`.
* Fehlermeldung: `malloc(): corrupted unsorted chunks`
* **Konsistenz√ºberpr√ºfung des unsortierten Bins (zweites Szenario)**:
* Wie die vorherige √úberpr√ºfung, aber ausgel√∂st beim Einf√ºgen nach dem Aufteilen eines Fast- oder Small-Chunks.
* Fehlermeldung: `malloc(): corrupted unsorted chunks 2`

## \_int\_free

Diese Funktion gibt zuvor zugewiesenen Speicher frei. Die √úberpr√ºfungen hier helfen, eine ordnungsgem√§√üe Speicherfreigabe sicherzustellen und Speicherbesch√§digungen zu verhindern.

* **√úberpr√ºfung der Zeigergrenze**:
* Stellen Sie sicher, dass der freigegebene Zeiger nicht um den Speicher herum verl√§uft.
* Fehlermeldung: `free(): invalid pointer`
* **Gr√∂√üen√ºberpr√ºfung**:
* Stellen Sie sicher, dass die Gr√∂√üe des freigegebenen Chunks mindestens `MINSIZE` oder ein Vielfaches von `MALLOC_ALIGNMENT` ist.
* Fehlermeldung: `free(): invalid size`
* **Fastbin-Gr√∂√üen√ºberpr√ºfung**:
* F√ºr Fastbin-Chunks sicherstellen, dass die Gr√∂√üe des n√§chsten Chunks innerhalb der minimalen und maximalen Grenzen liegt.
* Fehlermeldung: `free(): invalid next size (fast)`
* **√úberpr√ºfung der doppelten Freigabe von Fastbin**:
* Beim Einf√ºgen eines Chunks in einen Fastbin sicherstellen, dass der Chunk am Anfang nicht derselbe ist wie der einzuf√ºgende.
* Fehlermeldung: `double free or corruption (fasttop)`
* **Konsistenz√ºberpr√ºfung des Fastbins**:
* Beim Einf√ºgen in einen Fastbin sicherstellen, dass die Gr√∂√üen des Kopfchunks und des einzuf√ºgenden Chunks gleich sind.
* Fehlermeldung: `invalid fastbin entry (free)`
* **Konsistenz√ºberpr√ºfung des Top-Chunks**:
* F√ºr Nicht-Fastbin-Chunks sicherstellen, dass der Chunk nicht derselbe ist wie der Top-Chunk.
* Fehlermeldung: `double free or corruption (top)`
* **√úberpr√ºfung der Speichergrenzen**:
* Stellen Sie sicher, dass der n√§chste Chunk im Speicher innerhalb der Grenzen der Arena liegt.
* Fehlermeldung: `double free or corruption (out)`
* **√úberpr√ºfung des Prev\_inuse-Bits**:
* Stellen Sie sicher, dass das vorher-in-Benutzung-Bit im n√§chsten Chunk markiert ist.
* Fehlermeldung: `double free or corruption (!prev)`
* **Normale Gr√∂√üen√ºberpr√ºfung**:
* Stellen Sie sicher, dass die Gr√∂√üe des n√§chsten Chunks innerhalb g√ºltiger Bereiche liegt.
* Fehlermeldung: `free(): invalid next size (normal)`
* **Konsistenz√ºberpr√ºfung des unsortierten Bins**:
* Beim Einf√ºgen eines zusammengef√ºhrten Chunks in den unsortierten Bin √ºberpr√ºfen, ob `unsorted_chunks(av)->fd->bk == unsorted_chunks(av)`.
* Fehlermeldung: `free(): corrupted unsorted chunks`

<details>

<summary><strong>Erlernen Sie AWS-Hacking von Null auf Held mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks beworben sehen m√∂chten** oder **HackTricks als PDF herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merch**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositorys einreichen.

</details>
