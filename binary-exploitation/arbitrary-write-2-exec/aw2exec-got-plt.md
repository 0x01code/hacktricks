# WWW2Exec - GOT/PLT

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres fa√ßons de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts GitHub.

</details>

## **Informations de base**

### **GOT : Global Offset Table**

La **Table des d√©calages globaux (GOT)** est un m√©canisme utilis√© dans les binaires li√©s de mani√®re dynamique pour g√©rer les **adresses des fonctions externes**. Comme ces **adresses ne sont pas connues avant l'ex√©cution** (en raison du lien dynamique), la GOT fournit un moyen de **mettre √† jour dynamiquement les adresses de ces symboles externes** une fois qu'elles sont r√©solues.

Chaque entr√©e dans la GOT correspond √† un symbole dans les biblioth√®ques externes que le binaire peut appeler. Lorsqu'une **fonction est appel√©e pour la premi√®re fois, son adresse r√©elle est r√©solue par le lien dynamique et stock√©e dans la GOT**. Les appels ult√©rieurs √† la m√™me fonction utilisent l'adresse stock√©e dans la GOT, √©vitant ainsi les frais g√©n√©raux de r√©solution de l'adresse √† nouveau.

### **PLT : Procedure Linkage Table**

La **Table de liaison de proc√©dures (PLT)** fonctionne en √©troite collaboration avec la GOT et sert de trampoline pour g√©rer les appels aux fonctions externes. Lorsqu'un binaire **appelle une fonction externe pour la premi√®re fois, le contr√¥le est pass√© √† une entr√©e dans la PLT associ√©e √† cette fonction**. Cette entr√©e PLT est responsable d'invocation du lien dynamique pour r√©soudre l'adresse de la fonction si elle n'a pas d√©j√† √©t√© r√©solue. Apr√®s la r√©solution de l'adresse, elle est stock√©e dans la **GOT**.

**Par cons√©quent,** les entr√©es de la GOT sont utilis√©es directement une fois que l'adresse d'une fonction ou d'une variable externe est r√©solue. Les entr√©es de la PLT sont utilis√©es pour faciliter la r√©solution initiale de ces adresses via le lien dynamique.

## Obtenir l'ex√©cution

### V√©rifier la GOT

Obtenez l'adresse de la table GOT avec : **`objdump -s -j .got ./exec`**

![](<../../.gitbook/assets/image (121).png>)

Observez comment apr√®s le **chargement** de l'**ex√©cutable** dans GEF, vous pouvez **voir** les **fonctions** qui sont dans la **GOT** : `gef‚û§ x/20x 0xDIR_GOT`

![](<../../.gitbook/assets/image (620) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (2) (2) (2).png>)

En utilisant GEF, vous pouvez **d√©marrer** une **session de d√©bogage** et ex√©cuter **`got`** pour voir la table got :

![](<../../.gitbook/assets/image (496).png>)

### GOT2Exec

Dans un binaire, la GOT contient les **adresses des fonctions ou** de la section **PLT** qui chargera l'adresse de la fonction. Le but de cette √©criture arbitraire est de **remplacer une entr√©e de la GOT** d'une fonction qui sera ex√©cut√©e plus tard **avec** l'**adresse** du PLT de la fonction **`system`** par exemple.

Id√©alement, vous **remplacerez** la **GOT** d'une **fonction** qui va √™tre appel√©e avec des param√®tres contr√¥l√©s par vous (vous pourrez ainsi contr√¥ler les param√®tres envoy√©s √† la fonction syst√®me).

Si **`system`** n'est **pas utilis√©** par le script, la fonction syst√®me **n'aura pas d'entr√©e dans le PLT**. Dans ce sc√©nario, vous devrez **d'abord divulguer l'adresse** de la fonction `system` puis √©craser la GOT pour pointer vers cette adresse.

Vous pouvez voir les adresses PLT avec **`objdump -j .plt -d ./vuln_binary`**

## Entr√©es GOT de libc

La **GOT de libc** est g√©n√©ralement compil√©e avec **partial RELRO**, en en faisant une cible int√©ressante en supposant qu'il est possible de d√©terminer son adresse ([**ASLR**](../common-binary-protections-and-bypasses/aslr/)).

Les fonctions courantes de la libc vont appeler **d'autres fonctions internes** dont la GOT pourrait √™tre √©cras√©e pour obtenir une ex√©cution de code.

Trouvez [**plus d'informations sur cette technique ici**](https://github.com/nobodyisnobody/docs/blob/main/code.execution.on.last.libc/README.md#1---targetting-libc-got-entries).

## **Free2system**

Dans les CTF d'exploitation de tas, il est courant de pouvoir contr√¥ler le contenu des chunks et √† un moment donn√© m√™me d'√©craser la table GOT. Un simple astuce pour obtenir une RCE si les gadgets one ne sont pas disponibles est de remplacer l'adresse GOT de `free` pour pointer vers `system` et d'√©crire √† l'int√©rieur d'un chunk `"/bin/sh"`. Ainsi, lorsque ce chunk est lib√©r√©, il ex√©cutera `system("/bin/sh")`.

## **One Gadget**

{% content-ref url="../rop-return-oriented-programing/ret2lib/one-gadget.md" %}
[one-gadget.md](../rop-return-oriented-programing/ret2lib/one-gadget.md)
{% endcontent-ref %}

## **Abuser de la GOT depuis le tas**

Une fa√ßon courante d'obtenir une RCE √† partir d'une vuln√©rabilit√© de tas est d'abuser d'un fastbin pour qu'il soit possible d'ajouter la partie de la table GOT dans le fast bin, de sorte que chaque fois que ce chunk est allou√©, il sera possible de **√©craser le pointeur d'une fonction, g√©n√©ralement `free`**.\
Ensuite, en pointant `free` vers `system` et en lib√©rant un chunk o√π a √©t√© √©crit `/bin/sh\x00`, une shell sera ex√©cut√©e.

Il est possible de trouver un [**exemple ici**](https://ctf-wiki.mahaloz.re/pwn/linux/glibc-heap/chunk\_extend\_overlapping/#hitcon-trainging-lab13)**.**

## **Protections**

La protection **Full RELRO** est destin√©e √† prot√©ger contre ce type de technique en r√©solvant toutes les adresses des fonctions lorsque le binaire est d√©marr√© et en rendant la **table GOT en lecture seule** apr√®s cela :

{% content-ref url="../common-binary-protections-and-bypasses/relro.md" %}
[relro.md](../common-binary-protections-and-bypasses/relro.md)
{% endcontent-ref %}
## R√©f√©rences

* [https://ir0nstone.gitbook.io/notes/types/stack/got-overwrite/exploiting-a-got-overwrite](https://ir0nstone.gitbook.io/notes/types/stack/got-overwrite/exploiting-a-got-overwrite)
* [https://ir0nstone.gitbook.io/notes/types/stack/one-gadgets-and-malloc-hook](https://ir0nstone.gitbook.io/notes/types/stack/one-gadgets-and-malloc-hook)

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Expert de l'√©quipe rouge AWS de HackTricks)</strong></a><strong>!</strong></summary>

Autres fa√ßons de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
