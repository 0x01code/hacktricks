# WWW2Exec - GOT/PLT

<details>

<summary><strong>Aprenda hacking AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras maneiras de apoiar o HackTricks:

* Se voc√™ quiser ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF** Verifique os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**swag oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-nos** no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## **Informa√ß√µes B√°sicas**

### **GOT: Tabela de Deslocamento Global**

A **Tabela de Deslocamento Global (GOT)** √© um mecanismo usado em bin√°rios com liga√ß√£o din√¢mica para gerenciar os **endere√ßos de fun√ß√µes externas**. Como esses **endere√ßos n√£o s√£o conhecidos at√© o tempo de execu√ß√£o** (devido √† liga√ß√£o din√¢mica), a GOT fornece uma maneira de **atualizar dinamicamente os endere√ßos desses s√≠mbolos externos** uma vez que s√£o resolvidos.

Cada entrada na GOT corresponde a um s√≠mbolo nas bibliotecas externas que o bin√°rio pode chamar. Quando uma **fun√ß√£o √© chamada pela primeira vez, seu endere√ßo real √© resolvido pelo vinculador din√¢mico e armazenado na GOT**. Chamadas subsequentes para a mesma fun√ß√£o usam o endere√ßo armazenado na GOT, evitando assim o custo de resolver o endere√ßo novamente.

### **PLT: Tabela de V√≠nculo de Procedimento**

A **Tabela de V√≠nculo de Procedimento (PLT)** trabalha em conjunto com a GOT e serve como um trampolim para lidar com chamadas a fun√ß√µes externas. Quando um bin√°rio **chama uma fun√ß√£o externa pela primeira vez, o controle √© passado para uma entrada na PLT associada a essa fun√ß√£o**. Essa entrada da PLT √© respons√°vel por invocar o vinculador din√¢mico para resolver o endere√ßo da fun√ß√£o se ainda n√£o tiver sido resolvido. Ap√≥s a resolu√ß√£o do endere√ßo, ele √© armazenado na **GOT**.

**Portanto,** as entradas da GOT s√£o usadas diretamente uma vez que o endere√ßo de uma fun√ß√£o ou vari√°vel externa √© resolvido. **As entradas da PLT s√£o usadas para facilitar a resolu√ß√£o inicial** desses endere√ßos via o vinculador din√¢mico.

## Obter Execu√ß√£o

### Verificar a GOT

Obtenha o endere√ßo da tabela GOT com: **`objdump -s -j .got ./exec`**

![](<../../.gitbook/assets/image (121).png>)

Observe como ap√≥s **carregar** o **execut√°vel** no GEF voc√™ pode **ver** as **fun√ß√µes** que est√£o na **GOT**: `gef‚û§ x/20x 0xDIR_GOT`

![](<../../.gitbook/assets/image (620) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (2) (2) (2).png>)

Usando o GEF voc√™ pode **iniciar** uma **sess√£o de depura√ß√£o** e executar **`got`** para ver a tabela got:

![](<../../.gitbook/assets/image (496).png>)

### GOT2Exec

Em um bin√°rio a GOT tem os **endere√ßos das fun√ß√µes ou** da se√ß√£o **PLT** que carregar√° o endere√ßo da fun√ß√£o. O objetivo desta escrita arbitr√°ria √© **substituir uma entrada da GOT** de uma fun√ß√£o que ser√° executada posteriormente **com** o **endere√ßo** do PLT da **fun√ß√£o `system`** por exemplo.

Idealmente, voc√™ ir√° **substituir** a **GOT** de uma **fun√ß√£o** que est√° **sendo chamada com par√¢metros controlados por voc√™** (assim voc√™ poder√° controlar os par√¢metros enviados para a fun√ß√£o system).

Se **`system`** **n√£o for usado** pelo script, a fun√ß√£o system **n√£o** ter√° uma entrada na PLT. Nesse cen√°rio, voc√™ precisar√° **vazar primeiro o endere√ßo** da fun√ß√£o `system` e ent√£o sobrescrever a GOT para apontar para este endere√ßo.

Voc√™ pode ver os endere√ßos da PLT com **`objdump -j .plt -d ./vuln_binary`**

## Entradas GOT da libc

A **GOT da libc** geralmente √© compilada com **RELRO parcial**, tornando-a um bom alvo para isso, supondo que seja poss√≠vel descobrir seu endere√ßo ([**ASLR**](../common-binary-protections-and-bypasses/aslr/)).

Fun√ß√µes comuns da libc v√£o chamar **outras fun√ß√µes internas** cuja GOT poderia ser sobrescrita para obter execu√ß√£o de c√≥digo.

Encontre [**mais informa√ß√µes sobre essa t√©cnica aqui**](https://github.com/nobodyisnobody/docs/blob/main/code.execution.on.last.libc/README.md#1---targetting-libc-got-entries).

## **Free2system**

Em CTFs de explora√ß√£o de heap, √© comum poder controlar o conte√∫do dos blocos e, em algum momento, at√© mesmo sobrescrever a tabela GOT. Um truque simples para obter RCE se um gadget n√£o estiver dispon√≠vel √© sobrescrever o endere√ßo GOT do `free` para apontar para `system` e escrever dentro de um bloco `"/bin/sh"`. Dessa forma, quando esse bloco for liberado, ele executar√° `system("/bin/sh")`.

## **One Gadget**

{% content-ref url="../rop-return-oriented-programing/ret2lib/one-gadget.md" %}
[one-gadget.md](../rop-return-oriented-programing/ret2lib/one-gadget.md)
{% endcontent-ref %}

## **Abusando da GOT do Heap**

Uma maneira comum de obter RCE a partir de uma vulnerabilidade de heap √© abusar de um fastbin para ser poss√≠vel adicionar parte da tabela GOT ao fast bin, para que sempre que esse bloco for alocado seja poss√≠vel **sobrescrever o ponteiro de uma fun√ß√£o, geralmente `free`**.\
Ent√£o, apontando `free` para `system` e liberando um bloco onde foi escrito `/bin/sh\x00` executar√° um shell.

√â poss√≠vel encontrar um [**exemplo aqui**](https://ctf-wiki.mahaloz.re/pwn/linux/glibc-heap/chunk\_extend\_overlapping/#hitcon-trainging-lab13)**.**

## **Prote√ß√µes**

A prote√ß√£o **Full RELRO** visa proteger contra esse tipo de t√©cnica resolvendo todos os endere√ßos das fun√ß√µes quando o bin√°rio √© iniciado e tornando a **tabela GOT somente leitura** depois disso:

{% content-ref url="../common-binary-protections-and-bypasses/relro.md" %}
[relro.md](../common-binary-protections-and-bypasses/relro.md)
{% endcontent-ref %}
## Refer√™ncias

* [https://ir0nstone.gitbook.io/notes/types/stack/got-overwrite/exploiting-a-got-overwrite](https://ir0nstone.gitbook.io/notes/types/stack/got-overwrite/exploiting-a-got-overwrite)
* [https://ir0nstone.gitbook.io/notes/types/stack/one-gadgets-and-malloc-hook](https://ir0nstone.gitbook.io/notes/types/stack/one-gadgets-and-malloc-hook)

<details>

<summary><strong>Aprenda hacking na AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras maneiras de apoiar o HackTricks:

* Se voc√™ deseja ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF** Verifique os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-nos** no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para os reposit√≥rios** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
