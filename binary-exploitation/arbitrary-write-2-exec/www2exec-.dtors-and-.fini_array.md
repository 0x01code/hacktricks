# WWW2Exec - .dtors & .fini\_array

<details>

<summary><strong>AWSハッキングをゼロからヒーローまで学ぶ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE（HackTricks AWS Red Team Expert）</strong></a><strong>！</strong></summary>

HackTricksをサポートする他の方法：

* **HackTricksで企業を宣伝したい**または**HackTricksをPDFでダウンロードしたい**場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS＆HackTricksスワッグ**](https://peass.creator-spring.com)を入手する
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)コレクションを見つける
* **💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**telegramグループ**](https://t.me/peass)に**参加**するか、**Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)で**フォロー**する。
* **ハッキングトリックを共有するためにPRを** [**HackTricks**](https://github.com/carlospolop/hacktricks) **と** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **のGitHubリポジトリに提出してください。**

</details>

## .dtors

{% hint style="danger" %}
現在、.dtorsセクションを持つバイナリを見つけるのは非常に**珍しいです！**
{% endhint %}

デストラクタは、**プログラムが終了する前に実行される関数**です（`main`関数が返された後）。\
これらの関数へのアドレスは、バイナリの**`.dtors`**セクションに格納されているため、もし**`__DTOR_END__`**に**シェルコード**の**アドレス**を**書き込む**ことができれば、それはプログラムが終了する前に**実行**されます。

このセクションのアドレスを取得するには：
```bash
objdump -s -j .dtors /exec
rabin -s /exec | grep “__DTOR”
```
通常、**DTOR** マーカーは値 `ffffffff` と `00000000` の間にあります。したがって、これらの値だけを見ると、**登録された関数がない**ことを意味します。したがって、**`00000000`** を **シェルコードのアドレス** で上書きして実行します。

{% hint style="warning" %}
もちろん、後で呼び出すために **シェルコードを保存する場所を見つける** 必要があります。
{% endhint %}

## **.fini\_array**

基本的に、これはプログラムが終了する前に呼び出される**関数の集まり**であり、**`.dtors`** のようなものです。これは、**アドレスにジャンプしてシェルコードを呼び出す**ことができる場合や、**脆弱性を2回目に悪用するために再び `main` に戻る**必要がある場合に興味深いです。
```bash
objdump -s -j .fini_array ./greeting

./greeting:     file format elf32-i386

Contents of section .fini_array:
8049934 a0850408

#Put your address in 0x8049934
```
#### エターナルループ

**`.fini_array`** からの関数が実行されると、次の関数に移動するため、複数回実行されることはありません（無限ループを防ぎます）。ただし、ここに配置された**関数の実行**は1回だけ行われます。

**`.fini_array`** のエントリは**逆順**で呼び出されるため、おそらく最後のエントリから書き始めたいと思うでしょう。

{% hint style="danger" %}
[**Full RELRO**](../common-binary-protections-and-bypasses/relro.md)****を使用すると、**`.fini_array`** セクションは**読み取り専用**になります。
新しいバージョンでは、[**Partial RELRO**] を使用しても、**`.fini_array`** セクションは**読み取り専用**になります。
{% endhint %}
