# Grundlegende Methodik der Bin√§rausnutzung

{% hint style="success" %}
Lernen und √ºben Sie AWS-Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Lernen und √ºben Sie GCP-Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtzen Sie HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegramm-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositorys einreichen.

</details>
{% endhint %}

## ELF Grundlegende Informationen

Bevor Sie etwas ausnutzen, ist es interessant, einen Teil der Struktur einer **ELF-Bin√§rdatei** zu verstehen:

{% content-ref url="elf-tricks.md" %}
[elf-tricks.md](elf-tricks.md)
{% endcontent-ref %}

## Ausnutzungswerkzeuge

{% content-ref url="tools/" %}
[tools](tools/)
{% endcontent-ref %}

## Stapel√ºberlauf-Methodik

Bei so vielen Techniken ist es gut, ein Schema zu haben, wann jede Technik n√ºtzlich sein wird. Beachten Sie, dass die gleichen Schutzma√ünahmen verschiedene Techniken beeinflussen werden. Sie k√∂nnen M√∂glichkeiten finden, die Schutzma√ünahmen in jedem Schutzabschnitt zu umgehen, aber nicht in dieser Methodik.

## Steuerung des Flusses

Es gibt verschiedene M√∂glichkeiten, wie Sie den Fluss eines Programms steuern k√∂nnen:

* [**Stapel√ºberl√§ufe**](../stack-overflow/), indem Sie den R√ºckgabepointer vom Stapel oder den EBP -> ESP -> EIP √ºberschreiben.
* M√∂glicherweise m√ºssen Sie einen [**Integer-√úberlauf**](../integer-overflow.md) missbrauchen, um den √úberlauf zu verursachen.
* Oder √ºber **beliebige Schreibvorg√§nge + Schreiben von Was Wo zur Ausf√ºhrung**
* [**Formatzeichenfolgen**](../format-strings/)**:** Missbrauchen Sie `printf`, um beliebige Inhalte an beliebige Adressen zu schreiben.
* [**Array-Indizierung**](../array-indexing.md): Missbrauchen Sie eine schlecht gestaltete Indizierung, um einige Arrays zu steuern und einen beliebigen Schreibvorgang zu erhalten.
* M√∂glicherweise m√ºssen Sie einen [**Integer-√úberlauf**](../integer-overflow.md) missbrauchen, um den √úberlauf zu verursachen.
* **bof zu WWW √ºber ROP**: Missbrauchen Sie einen Puffer√ºberlauf, um einen ROP zu konstruieren und ein WWW zu erhalten.

Sie finden die Techniken f√ºr **Schreiben von Was Wo zur Ausf√ºhrung** in:

{% content-ref url="../arbitrary-write-2-exec/" %}
[arbitrary-write-2-exec](../arbitrary-write-2-exec/)
{% endcontent-ref %}

## Ewige Schleifen

Etwas zu beachten ist, dass in der Regel **nur eine Ausnutzung einer Schwachstelle m√∂glicherweise nicht ausreicht**, um einen erfolgreichen Exploit auszuf√ºhren, insbesondere wenn einige Schutzma√ünahmen umgangen werden m√ºssen. Daher ist es interessant, einige Optionen zu diskutieren, um **eine einzelne Schwachstelle mehrmals in derselben Ausf√ºhrung der Bin√§rdatei ausnutzbar zu machen**:

* Schreiben Sie in einer **ROP-Kette die Adresse der **`main`-Funktion** oder an die Adresse, an der die **Schwachstelle** auftritt.
* Durch Steuern einer ordnungsgem√§√üen ROP-Kette k√∂nnen Sie alle Aktionen in dieser Kette ausf√ºhren.
* Schreiben Sie die **`exit`-Adresse in GOT** (oder eine andere Funktion, die von der Bin√§rdatei vor dem Beenden verwendet wird) die Adresse, um **zur√ºck zur Schwachstelle zu gelangen**.
* Wie in [**.fini\_array**](../arbitrary-write-2-exec/www2exec-.dtors-and-.fini\_array.md#eternal-loop)** erkl√§rt, speichern Sie hier 2 Funktionen, eine zum erneuten Aufruf der Schwachstelle und eine andere zum Aufruf von**`__libc_csu_fini`**, die die Funktion aus `.fini_array` erneut aufrufen wird.

## Ausnutzungsziele

### Ziel: Aufruf einer vorhandenen Funktion

* [**ret2win**](./#ret2win): Es gibt eine Funktion im Code, die Sie aufrufen m√ºssen (vielleicht mit bestimmten Parametern), um die Flagge zu erhalten.
* In einem **regul√§ren bof ohne** [**PIE**](../common-binary-protections-and-bypasses/pie/) **und** [**canary**](../common-binary-protections-and-bypasses/stack-canaries/) m√ºssen Sie nur die Adresse im R√ºckgabeadressspeicher im Stapel schreiben.
* In einem bof mit [**PIE**](../common-binary-protections-and-bypasses/pie/) m√ºssen Sie es umgehen
* In einem bof mit [**canary**](../common-binary-protections-and-bypasses/stack-canaries/) m√ºssen Sie es umgehen
* Wenn Sie mehrere Parameter richtig setzen m√ºssen, um die **ret2win**-Funktion korrekt aufzurufen, k√∂nnen Sie verwenden:
* Eine [**ROP**](./#rop-and-ret2...-techniques) **Kette, wenn gen√ºgend Gadgets vorhanden sind**, um alle Parameter vorzubereiten
* [**SROP**](../rop-return-oriented-programing/srop-sigreturn-oriented-programming/) (falls Sie diesen Systemaufruf aufrufen k√∂nnen), um viele Register zu steuern
* Gadgets von [**ret2csu**](../rop-return-oriented-programing/ret2csu.md) und [**ret2vdso**](../rop-return-oriented-programing/ret2vdso.md), um mehrere Register zu steuern
* √úber ein [**Schreiben von Was Wo**](../arbitrary-write-2-exec/) k√∂nnten Sie andere Schwachstellen (nicht bof) missbrauchen, um die **`win`**-Funktion aufzurufen.
* [**Pointer-Umleitung**](../stack-overflow/pointer-redirecting.md): Falls der Stapel Zeiger auf eine Funktion enth√§lt, die aufgerufen wird, oder auf einen String, der von einer interessanten Funktion verwendet wird (system oder printf), ist es m√∂glich, diese Adresse zu √ºberschreiben.
* [**ASLR**](../common-binary-protections-and-bypasses/aslr/) oder [**PIE**](../common-binary-protections-and-bypasses/pie/) k√∂nnten die Adressen beeinflussen.
* [**Nicht initialisierte Variablen**](../stack-overflow/uninitialized-variables.md): Man wei√ü nie.

### Ziel: RCE

#### √úber Shellcode, wenn nx deaktiviert ist oder Shellcode mit ROP gemischt:

* [**(Stack) Shellcode**](./#stack-shellcode): Dies ist n√ºtzlich, um einen Shellcode im Stapel zu speichern, bevor oder nachdem der R√ºckgabepointer √ºberschrieben wurde, und dann **darauf zu springen**, um ihn auszuf√ºhren:
* **In jedem Fall, wenn es ein** [**canary**](../common-binary-protections-and-bypasses/stack-canaries/)** gibt, m√ºssen Sie in einem regul√§ren bof es umgehen (leaken)**
* **Ohne** [**ASLR**](../common-binary-protections-and-bypasses/aslr/) **und** [**nx**](../common-binary-protections-and-bypasses/no-exec-nx.md) ist es m√∂glich, zur Adresse des Stapels zu springen, da sie sich nie √§ndert
* **Mit** [**ASLR**](../common-binary-protections-and-bypasses/aslr/) ben√∂tigen Sie Techniken wie [**ret2esp/ret2reg**](../rop-return-oriented-programing/ret2esp-ret2reg.md), um dorthin zu springen
* **Mit** [**nx**](../common-binary-protections-and-bypasses/no-exec-nx.md) m√ºssen Sie einige [**ROP**](../rop-return-oriented-programing/) verwenden, um `memprotect` aufzurufen und eine Seite `rwx` zu machen, um dann den Shellcode dort zu speichern (zum Beispiel read aufrufen) und dann dorthin zu springen.
* Dies wird Shellcode mit einer ROP-Kette mischen.
#### √úber Syscalls

* [**Ret2syscall**](../rop-return-oriented-programing/rop-syscall-execv/): N√ºtzlich, um `execve` aufzurufen und beliebige Befehle auszuf√ºhren. Sie m√ºssen in der Lage sein, die **Gadgets zu finden, um den spezifischen Syscall mit den Parametern aufzurufen**.
* Wenn [**ASLR**](../common-binary-protections-and-bypasses/aslr/) oder [**PIE**](../common-binary-protections-and-bypasses/pie/) aktiviert sind, m√ºssen Sie sie **besiegen, um ROP-Gadgets** aus der Bin√§rdatei oder den Bibliotheken zu verwenden.
* [**SROP**](../rop-return-oriented-programing/srop-sigreturn-oriented-programming/) kann n√ºtzlich sein, um das **ret2execve** vorzubereiten.
* Gadgets aus [**ret2csu**](../rop-return-oriented-programing/ret2csu.md) und [**ret2vdso**](../rop-return-oriented-programing/ret2vdso.md), um mehrere Register zu kontrollieren

#### √úber libc

* [**Ret2lib**](../rop-return-oriented-programing/ret2lib/): N√ºtzlich, um eine Funktion aus einer Bibliothek (normalerweise aus **`libc`**) wie **`system`** mit einigen vorbereiteten Argumenten (z. B. `'/bin/sh'`) aufzurufen. Sie ben√∂tigen die Bin√§rdatei, um die Bibliothek mit der Funktion, die Sie aufrufen m√∂chten (normalerweise libc), zu **laden**.
* Wenn **statisch kompiliert und kein** [**PIE**](../common-binary-protections-and-bypasses/pie/), √§ndert sich die **Adresse** von `system` und `/bin/sh` nicht, sodass es m√∂glich ist, sie statisch zu verwenden.
* **Ohne** [**ASLR**](../common-binary-protections-and-bypasses/aslr/) **und Kenntnis der geladenen libc-Version**, √§ndert sich die **Adresse** von `system` und `/bin/sh` nicht, sodass es m√∂glich ist, sie statisch zu verwenden.
* Mit [**ASLR**](../common-binary-protections-and-bypasses/aslr/) **aber ohne** [**PIE**](../common-binary-protections-and-bypasses/pie/), Kenntnis der libc und mit der Bin√§rdatei, die die `system`-Funktion verwendet, ist es m√∂glich, zum Adressbereich von system im GOT zu **`ret`** mit der Adresse von `'/bin/sh'` in den Parametern zu springen (Sie m√ºssen dies herausfinden).
* Mit [ASLR](../common-binary-protections-and-bypasses/aslr/) aber ohne [PIE](../common-binary-protections-and-bypasses/pie/), Kenntnis der libc und **ohne die Bin√§rdatei, die die `system` verwendet**:
* Verwenden Sie [**`ret2dlresolve`**](../rop-return-oriented-programing/ret2dlresolve.md), um die Adresse von `system` aufzul√∂sen und sie aufzurufen&#x20;
* **Umgehen** Sie [**ASLR**](../common-binary-protections-and-bypasses/aslr/) und berechnen Sie die Adresse von `system` und `'/bin/sh'` im Speicher.
* **Mit** [**ASLR**](../common-binary-protections-and-bypasses/aslr/) **und** [**PIE**](../common-binary-protections-and-bypasses/pie/) **und ohne Kenntnis der libc**: Sie m√ºssen:
* [**PIE**](../common-binary-protections-and-bypasses/pie/) umgehen
* Die verwendete **`libc`-Version** finden (ein paar Funktionsadressen leaken)
* √úberpr√ºfen Sie die **vorherigen Szenarien mit ASLR**, um fortzufahren.

#### √úber EBP/RBP

* [**Stack Pivoting / EBP2Ret / EBP Chaining**](../stack-overflow/stack-pivoting-ebp2ret-ebp-chaining.md): Kontrollieren Sie den ESP, um RET √ºber den gespeicherten EBP im Stack zu steuern.
* N√ºtzlich f√ºr **off-by-one** Stack-√úberl√§ufe
* N√ºtzlich als alternative M√∂glichkeit, EIP zu kontrollieren, w√§hrend EIP missbraucht wird, um die Nutzlast im Speicher zu konstruieren und dann √ºber EBP darauf zu springen

#### Verschiedenes

* [**Pointer-Umleitung**](../stack-overflow/pointer-redirecting.md): Falls der Stack Zeiger auf eine Funktion enth√§lt, die aufgerufen wird, oder auf einen String, der von einer interessanten Funktion verwendet wird (system oder printf), ist es m√∂glich, diese Adresse zu √ºberschreiben.
* [**ASLR**](../common-binary-protections-and-bypasses/aslr/) oder [**PIE**](../common-binary-protections-and-bypasses/pie/) k√∂nnten die Adressen beeinflussen.
* [**Nicht initialisierte Variablen**](../stack-overflow/uninitialized-variables.md): Man wei√ü nie

{% hint style="success" %}
Lernen Sie & √ºben Sie AWS-Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Lernen Sie & √ºben Sie GCP-Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtzen Sie HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositories einreichen.

</details>
{% endhint %}
