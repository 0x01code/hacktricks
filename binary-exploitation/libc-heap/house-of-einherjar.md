# Haus von Einherjar

{% hint style="success" %}
Lernen und √ºben Sie AWS-Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Lernen und √ºben Sie GCP-Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtzen Sie HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegramm-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) Github-Repositorys senden.

</details>
{% endhint %}

## Grundlegende Informationen

### Code

* √úberpr√ºfen Sie das Beispiel unter [https://github.com/shellphish/how2heap/blob/master/glibc\_2.35/house\_of\_einherjar.c](https://github.com/shellphish/how2heap/blob/master/glibc\_2.35/house\_of\_einherjar.c)
* Oder das unter [https://guyinatuxedo.github.io/42-house\_of\_einherjar/house\_einherjar\_exp/index.html#house-of-einherjar-explanation](https://guyinatuxedo.github.io/42-house\_of\_einherjar/house\_einherjar\_exp/index.html#house-of-einherjar-explanation) (m√∂glicherweise m√ºssen Sie den Tcache f√ºllen)

### Ziel

* Das Ziel ist es, Speicher fast an einer bestimmten Adresse zuzuweisen.

### Anforderungen

* Erstellen Sie einen gef√§lschten Chunk, wenn wir einen Chunk zuweisen m√∂chten:
* Setzen Sie Zeiger so, dass sie auf sich selbst zeigen, um die Integrit√§tspr√ºfungen zu umgehen
* Ein-Byte-√úberlauf mit einem Nullbyte von einem Chunk zum n√§chsten, um das `PREV_INUSE`-Flag zu √§ndern.
* Geben Sie im `prev_size` des missbrauchten Off-by-Null-Chunks den Unterschied zwischen ihm selbst und dem gef√§lschten Chunk an
* Die Gr√∂√üe des gef√§lschten Chunks muss ebenfalls auf die gleiche Gr√∂√üe gesetzt worden sein, um die Integrit√§tspr√ºfungen zu umgehen
* F√ºr den Aufbau dieser Chunks ben√∂tigen Sie ein Heap-Leak.

### Angriff

* Es wird ein gef√§lschter Chunk innerhalb eines vom Angreifer kontrollierten Chunks erstellt, der mit `fd` und `bk` auf den Original-Chunk zeigt, um Schutzmechanismen zu umgehen
* 2 weitere Chunks (`B` und `C`) werden allokiert
* Durch den Missbrauch des Off-by-One im `B` wird das `prev in use`-Bit gel√∂scht und die `prev_size`-Daten mit dem Unterschied zwischen dem Ort, an dem der `C`-Chunk allokiert ist, und dem zuvor generierten gef√§lschten `A`-Chunk √ºberschrieben
* Diese `prev_size` und die Gr√∂√üe im gef√§lschten Chunk `A` m√ºssen gleich sein, um die Pr√ºfungen zu umgehen.
* Dann wird der Tcache gef√ºllt
* Dann wird `C` freigegeben, damit es sich mit dem gef√§lschten Chunk `A` konsolidiert
* Dann wird ein neuer Chunk `D` erstellt, der im gef√§lschten `A`-Chunk beginnt und den `B`-Chunk abdeckt
* Das Haus von Einherjar endet hier
* Dies kann mit einem Fast-Bin-Angriff oder Tcache-Vergiftung fortgesetzt werden:
* Geben Sie `B` frei, um es dem Fast-Bin / Tcache hinzuzuf√ºgen
* Das `fd` von `B` wird √ºberschrieben, sodass es auf die Zieladresse zeigt und den `D`-Chunk missbraucht (da er `B` enth√§lt)&#x20;
* Dann werden 2 mallocs durchgef√ºhrt und der zweite wird die **Zuweisung der Zieladresse** sein

## Referenzen und weitere Beispiele

* [https://github.com/shellphish/how2heap/blob/master/glibc\_2.35/house\_of\_einherjar.c](https://github.com/shellphish/how2heap/blob/master/glibc\_2.35/house\_of\_einherjar.c)
* **CTF** [**https://ctf-wiki.mahaloz.re/pwn/linux/glibc-heap/house\_of\_einherjar/#2016-seccon-tinypad**](https://ctf-wiki.mahaloz.re/pwn/linux/glibc-heap/house\_of\_einherjar/#2016-seccon-tinypad)
* Nach dem Freigeben von Zeigern werden sie nicht nullifiziert, sodass es immer noch m√∂glich ist, auf ihre Daten zuzugreifen. Daher wird ein Chunk in den unsortierten Bin platziert und die darin enthaltenen Zeiger geleakt (libc leak) und dann wird ein neuer Heap im unsortierten Bin platziert und eine Heap-Adresse aus dem Zeiger geleakt.
* [**baby-talk. DiceCTF 2024**](https://7rocky.github.io/en/ctf/other/dicectf/baby-talk/)
* Null-Byte-√úberlauf-Bug in `strtok`.
* Verwenden Sie das House of Einherjar, um eine Situation mit √ºberlappenden Chunks zu erhalten, und beenden Sie sie mit Tcache-Vergiftung, um ein beliebiges Schreib-Primitive zu erhalten.

{% hint style="success" %}
Lernen und √ºben Sie AWS-Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Lernen und √ºben Sie GCP-Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtzen Sie HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegramm-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) Github-Repositorys senden.

</details>
{% endhint %}
