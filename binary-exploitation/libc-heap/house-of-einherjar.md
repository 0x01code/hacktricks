# Huis van Einherjar

<details>

<summary><strong>Leer AWS-hacking vanaf nul tot held met</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Ander maniere om HackTricks te ondersteun:

* As jy jou **maatskappy geadverteer wil sien in HackTricks** of **HackTricks in PDF wil aflaai** Kyk na die [**INSKRYWINGSPLANNE**](https://github.com/sponsors/carlospolop)!
* Kry die [**amptelike PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ontdek [**Die PEASS Familie**](https://opensea.io/collection/the-peass-family), ons versameling van eksklusiewe [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Deel jou haktruuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-opslag.

</details>

## Basiese Inligting

### Kode

* Kyk na die voorbeeld van [https://github.com/shellphish/how2heap/blob/master/glibc\_2.35/house\_of\_einherjar.c](https://github.com/shellphish/how2heap/blob/master/glibc\_2.35/house\_of\_einherjar.c)
* Of di√© van [https://guyinatuxedo.github.io/42-house\_of\_einherjar/house\_einherjar\_exp/index.html#house-of-einherjar-explanation](https://guyinatuxedo.github.io/42-house\_of\_einherjar/house\_einherjar\_exp/index.html#house-of-einherjar-explanation) (jy mag die tcache moet vul)

### Doel

* Die doel is om geheue by amper enige spesifieke adres toe te ken.

### Vereistes

* Skep 'n vals stuk wanneer ons 'n stuk wil toeken:
* Stel aanwysers in om na homself te wys om sinnigheidskontroles te omseil
* Een-byte oorvloei met 'n nulbyte van een stuk na die volgende om die `PREV_INUSE`-vlag te wysig.
* Dui in die `prev_size` van die off-by-null misbruikte stuk die verskil tussen homself en die vals stuk aan
* Die grootte van die vals stuk moet ook dieselfde grootte gehad het om sinnigheidskontroles te omseil
* Vir die konstruksie van hierdie stukke, sal jy 'n hooplek nodig h√™.

### Aanval

* `n Valse stuk word binne 'n stuk wat deur die aanvaller beheer word, geskep wat met `fd` en `bk` na die oorspronklike stuk wys om beskermings te omseil
* 2 ander stukke (`B` en `C`) word toegewys
* Deur die off by one in die `B` een te misbruik, word die `prev in use`-bit skoongemaak en die `prev_size`-data word oorskryf met die verskil tussen die plek waar die `C`-stuk toegewys is, na die vals `A`-stuk wat voorheen gegenereer is
* Hierdie `prev_size` en die grootte in die vals stuk `A` moet dieselfde wees om kontroles te omseil.
* Dan word die tcache gevul
* Dan word `C` vrygelaat sodat dit konsolideer met die vals stuk `A`
* Dan word 'n nuwe stuk `D` geskep wat in die vals `A`-stuk begin en die `B`-stuk dek
* Die huis van Einherjar eindig hier
* Dit kan voortgesit word met 'n vinnige bin-aanval of Tcache-vergiftiging:
* Vry `B` om dit by die vinnige bin / Tcache te voeg
* `B` se `fd` word oorskryf sodat dit na die teikenadres wys deur die `D`-stuk te misbruik (omdat dit `B` binne bevat)&#x20;
* Dan word 2 mallocs gedoen en die tweede een gaan die **teikenadres toeken**

## Verwysings en ander voorbeelde

* [https://github.com/shellphish/how2heap/blob/master/glibc\_2.35/house\_of\_einherjar.c](https://github.com/shellphish/how2heap/blob/master/glibc\_2.35/house\_of\_einherjar.c)
* **CTF** [**https://ctf-wiki.mahaloz.re/pwn/linux/glibc-heap/house\_of\_einherjar/#2016-seccon-tinypad**](https://ctf-wiki.mahaloz.re/pwn/linux/glibc-heap/house\_of\_einherjar/#2016-seccon-tinypad)
* Nadat aanwysers vrygelaat is, word hulle nie genullifiseer nie, dus is dit steeds moontlik om by hul data te kom. Daarom word 'n stuk in die ongesorteerde bin geplaas en die aanwysers wat dit bevat, gelek (libc-lek) en dan word 'n nuwe hoop op die ongesorteerde bin geplaas en 'n hoopadres gelek van die aanwyser wat dit kry.
* [**baby-talk. DiceCTF 2024**](https://7rocky.github.io/en/ctf/other/dicectf/baby-talk/)
* Nul-byte oorvloei-fout in `strtok`.
* Gebruik House of Einherjar om 'n situasie met oorvleuelende stukke te kry en eindig met Tcache-vergiftiging om 'n arbitr√™re skryfprimitief te kry.
