# Nyumba ya Einherjar

<details>

<summary><strong>Jifunze kuhusu kudukua AWS kutoka sifuri hadi shujaa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Mtaalam wa Timu Nyekundu ya AWS ya HackTricks)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako ikionekana kwenye HackTricks** au **kupakua HackTricks kwa PDF** Angalia [**MIPANGO YA USAJILI**](https://github.com/sponsors/carlospolop)!
* Pata [**bidhaa rasmi za PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**Familia ya PEASS**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa kipekee wa [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au kikundi cha [**telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Shiriki mbinu zako za kudukua kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos za github.

</details>

## Taarifa Msingi

### Kanuni

* Angalia mfano kutoka [https://github.com/shellphish/how2heap/blob/master/glibc\_2.35/house\_of\_einherjar.c](https://github.com/shellphish/how2heap/blob/master/glibc\_2.35/house\_of\_einherjar.c)
* Au kutoka [https://guyinatuxedo.github.io/42-house\_of\_einherjar/house\_einherjar\_exp/index.html#house-of-einherjar-explanation](https://guyinatuxedo.github.io/42-house\_of\_einherjar/house\_einherjar\_exp/index.html#house-of-einherjar-explanation) (inaweza kuhitaji kujaza tcache)

### Lengo

* Lengo ni kutenga kumbukumbu katika anwani karibu yoyote maalum.

### Mahitaji

* Unda kikundi bandia tunapotaka kutenga kikundi:
* Weka pointers kuelekeza kwake ili kuepuka ukaguzi wa usalama
* Mwaga kwa byte moja na byte tupu kutoka kikundi kimoja hadi kingine kurekebisha bendera ya `PREV_INUSE`.
* Eleza katika `prev_size` ya kikundi kilichotumiwa kwa njia ya null tofauti kati yake na kikundi bandia
* Ukubwa wa kikundi bandia lazima pia uwe umewekwa ukubwa sawa kuepuka ukaguzi wa usalama
* Kwa kujenga vikundi hivi, utahitaji uvujaji wa kumbukumbu ya kitalu.

### Shambulio

* Kikundi bandia `A` kinajengwa ndani ya kikundi kinachodhibitiwa na mshambuliaji kwa kuelekeza na `fd` na `bk` kwenye kikundi cha asili kuepuka ulinzi
* Vikundi vingine 2 (`B` na `C`) vinatengwa
* Kwa kutumia mbali moja katika `B` moja, biti ya `prev in use` inasafishwa na data ya `prev_size` inabadilishwa na tofauti kati ya mahali ambapo kikundi cha `C` kinatengwa, na kikundi bandia cha `A` kilichozalishwa awali
* `prev_size` hii na ukubwa katika kikundi bandia `A` lazima iwe sawa kuepuka ukaguzi.
* Kisha, tcache inajazwa
* Kisha, `C` inaachiliwa ili iungane na kikundi bandia `A`
* Kisha, kikundi kipya `D` kinajengwa ambacho kitakuwa kuanzia kwenye kikundi cha bandia cha `A` na kufunika kikundi cha `B`
* Nyumba ya Einherjar inamalizika hapa
* Hii inaweza kuendelea na shambulio la taka bin au sumu ya Tcache:
* Fungua `B` kuiongeza kwenye taka bin / Tcache
* `fd` ya `B` inabadilishwa ikifanya ielekee kwenye anwani ya lengo ikidukua kikundi cha `D` (kwani ina `B` ndani)&#x20;
* Kisha, malloc 2 zinafanywa na ya pili itakuwa **kutenga anwani ya lengo**

## Marejeo na mifano mingine

* [https://github.com/shellphish/how2heap/blob/master/glibc\_2.35/house\_of\_einherjar.c](https://github.com/shellphish/how2heap/blob/master/glibc\_2.35/house\_of\_einherjar.c)
* **CTF** [**https://ctf-wiki.mahaloz.re/pwn/linux/glibc-heap/house\_of\_einherjar/#2016-seccon-tinypad**](https://ctf-wiki.mahaloz.re/pwn/linux/glibc-heap/house\_of\_einherjar/#2016-seccon-tinypad)
* Baada ya kuachilia pointers hawajafutwa, kwa hivyo bado inawezekana kufikia data zao. Kwa hivyo kikundi kinawekwa kwenye taka bin na kuvuja pointers inayojumuisha (uvujaji wa libc) na kisha kitalu kipya kinawekwa kwenye taka bin na kuvuja anwani ya kitalu kutoka kwa pointer inayopata.
* [**baby-talk. DiceCTF 2024**](https://7rocky.github.io/en/ctf/other/dicectf/baby-talk/)
* Kosa la kumwaga byte tupu katika `strtok`.
* Tumia Nyumba ya Einherjar kupata hali ya vikundi vinavyolingana na kumaliza na sumu ya Tcache kupata msingi wa kuandika wa kiholela.
