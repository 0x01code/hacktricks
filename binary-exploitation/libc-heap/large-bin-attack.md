# рдмрдбрд╝реЗ рдмрд┐рди рд╣рдорд▓рд╛

<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks swag**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рдХрд▓реЗрдХреНрд╢рди, [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдЦреЛрдЬреЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, HackTricks** рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗред

</details>

## рдореМрд▓рд┐рдХ рдЬрд╛рдирдХрд╛рд░реА

рдмрдбрд╝реЗ рдмрд┐рди рдХреНрдпрд╛ рд╣реИ рдЗрд╕рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рдЗрд╕ рдкреГрд╖реНрда рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ:

{% content-ref url="bins-and-memory-allocations.md" %}
[bins-and-memory-allocations.md](bins-and-memory-allocations.md)
{% endcontent-ref %}

рдПрдХ рд╢рд╛рдирджрд╛рд░ рдЙрджрд╛рд╣рд░рдг рдорд┐рд▓ рд╕рдХрддрд╛ рд╣реИ [**how2heap - large bin attack**](https://github.com/shellphish/how2heap/blob/master/glibc\_2.35/large\_bin\_attack.c) рдореЗрдВред

рдореБрдЦреНрдп рд░реВрдк рд╕реЗ рдпрд╣рд╛рдБ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐, рдирд╡реАрдирддрдо "рд╡рд░реНрддрдорд╛рди" рд╕рдВрд╕реНрдХрд░рдг рдЬреАрд▓рд┐рдмреАрд╕реА (2.35) рдореЗрдВ рдпрд╣ рдирд╣реАрдВ рдЬрд╛рдВрдЪрд╛ рдЧрдпрд╛ рд╣реИ: **`P->bk_nextsize`** рдЬрд┐рд╕рд╕реЗ рдХрд┐ рдпрджрд┐ рдХреБрдЫ рд╢рд░реНрддреЗрдВ рдкреВрд░реА рд╣реЛрддреА рд╣реИрдВ рддреЛ рдПрдХ рдмрдбрд╝реЗ рдмрд┐рди рдЪрдВрдХ рдХреЗ рдорд╛рди рдХреЗ рд╕рд╛рде рдХрд┐рд╕реА рднреА рдкрддрд╛ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд╣реИред

рдЙрд╕ рдЙрджрд╛рд╣рд░рдг рдореЗрдВ рдЖрдк рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╢рд░реНрддреЗрдВ рдкрд╛рдПрдВрдЧреЗ:

* рдПрдХ рдмрдбрд╝рд╛ рдЪрдВрдХ рдЖрд╡рдВрдЯрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ
* рдкрд╣рд▓реЗ рдЪрдВрдХ рд╕реЗ рдЫреЛрдЯрд╛ рдПрдХ рдмрдбрд╝рд╛ рдЪрдВрдХ рдЙрд╕реА рд╕реВрдЪреА рдореЗрдВ рдЖрд╡рдВрдЯрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ
* рдЗрд╕реЗ рдЗрд╕рд▓рд┐рдП рдЫреЛрдЯрд╛ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рд╕реВрдЪреА рдореЗрдВ рдкрд╣рд▓реЗ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП
* (рд╢реАрд░реНрд╖ рдЪрдВрдХ рдХреЗ рд╕рд╛рде рдорд┐рд▓рд╛рди рдХреЛ рд░реЛрдХрдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдЪрдВрдХ рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ)
* рдлрд┐рд░, рдкрд╣рд▓рд╛ рдмрдбрд╝рд╛ рдЪрдВрдХ рдореБрдХреНрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдПрдХ рдирдпрд╛ рдЪрдВрдХ рдЙрд╕рд╕реЗ рдмрдбрд╝рд╛ рдЖрд╡рдВрдЯрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ -> рдЪрдВрдХ1 рдмрдбрд╝реЗ рдмрд┐рди рдореЗрдВ рдЬрд╛рддрд╛ рд╣реИ
* рдлрд┐рд░, рджреВрд╕рд░рд╛ рдмрдбрд╝рд╛ рдЪрдВрдХ рдореБрдХреНрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ
* рдЕрдм, рд╕реБрд░рдХреНрд╖рд╛ рдЧрдбрд╝рдмрдбрд╝реА: рд╣рдорд▓рд╛рд╡рд░ `chunk1->bk_nextsize` рдХреЛ `[рд▓рдХреНрд╖реНрдп-0x20]` рдкрд░ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ
* рдлрд┐рд░, рдЪрдВрдХ 2 рд╕реЗ рдЕрдзрд┐рдХ рдмрдбрд╝рд╛ рдЪрдВрдХ рдЖрд╡рдВрдЯрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЪрдВрдХ2 рдмрдбрд╝реЗ рдмрд┐рди рдореЗрдВ рдбрд╛рд▓рд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдкрддрд╛ `chunk1->bk_nextsize->fd_nextsize` рдХреЛ рдЪрдВрдХ2 рдХреЗ рдкрддреЗ рд╕реЗ рдЕрдзрд┐рд▓реЗрдЦрд┐рдд рдХрд░ рджреЗрддрд╛ рд╣реИ

{% hint style="success" %}
рдЕрдиреНрдп рд╕рдВрднрд╛рд╡рд┐рдд рдкрд░рд┐рджреГрд╢реНрдп рд╣реИрдВ, рдпрд╣ рдмрдбрд╝реЗ рдмрд┐рди рдореЗрдВ рдПрдХ рдЪрдВрдХ рдЬреЛ рдХрд┐рд╕реА рдореМрдЬреВрджрд╛ X рдЪрдВрдХ рд╕реЗ **рдЫреЛрдЯрд╛** рд╣реИ рдЬреЛ рдХрд┐ рдЙрд╕рд╕реЗ рдкрд╣рд▓реЗ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП, рдЗрд╕рд▓рд┐рдП рдпрд╣ рдмрд┐рди рдореЗрдВ рдЙрд╕рдХреЗ рд╕рд╛рдордиреЗ рдбрд╛рд▓рд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП, рдФрд░ рд╣рдореЗрдВ X рдХрд╛ **`bk_nextsize`** рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдП рдХреНрдпреЛрдВрдХрд┐ рд╡рд╣рд╛рдБ рдЫреЛрдЯреЗ рдЪрдВрдХ рдХрд╛ рдкрддрд╛ рд▓рд┐рдЦрд╛ рдЬрд╛рдПрдЧрд╛ред
{% endhint %}

рдпрд╣ рдореЙрд▓реЛрдХ рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рдХреЛрдб рд╣реИред рдмреЗрд╣рддрд░ рд╕рдордЭрдиреЗ рдХреЗ рд▓рд┐рдП рдЯрд┐рдкреНрдкрдгрд┐рдпрд╛рдБ рдЬреЛрдбрд╝реА рдЧрдИ рд╣реИрдВ:

{% code overflow="wrap" %}
```c
/* if smaller than smallest, bypass loop below */
assert (chunk_main_arena (bck->bk));
if ((unsigned long) (size) < (unsigned long) chunksize_nomask (bck->bk))
{
fwd = bck; // fwd = p1
bck = bck->bk; // bck = p1->bk

victim->fd_nextsize = fwd->fd; // p2->fd_nextsize = p1->fd (Note that p1->fd is p1 as it's the only chunk)
victim->bk_nextsize = fwd->fd->bk_nextsize; // p2->bk_nextsize = p1->fd->bk_nextsize
fwd->fd->bk_nextsize = victim->bk_nextsize->fd_nextsize = victim; // p1->fd->bk_nextsize->fd_nextsize = p2
}
```
{% endcode %}

рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ **libc рдХреЗ `global_max_fast` рдЧреНрд▓реЛрдмрд▓ рд╡реЗрд░рд┐рдПрдмрд▓** рдХреЛ рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдФрд░ рдлрд┐рд░ рдмрдбрд╝реЗ рдЪрдВрдХреНрд╕ рдХреЗ рд╕рд╛рде рдПрдХ рдлрд╛рд╕реНрдЯ рдмрд┐рди рд╣рдорд▓рд╛ рдХрд╛ рд╢рд┐рдХрд╛рд░ рдмрдирдиреЗ рдХреЗ рд▓рд┐рдПред

рдЖрдк рдЗрд╕ рд╣рдорд▓реЗ рдХреА рдПрдХ рдФрд░ рд╢рд╛рдирджрд╛рд░ рд╡реНрдпрд╛рдЦреНрдпрд╛ рдХреЛ [**guyinatuxedo**](https://guyinatuxedo.github.io/32-largebin\_attack/largebin\_explanation0/index.html) рдореЗрдВ рднреА рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВред

### рдЕрдиреНрдп рдЙрджрд╛рд╣рд░рдг

* [**La casa de papel. HackOn CTF 2024**](https://7rocky.github.io/en/ctf/other/hackon-ctf/la-casa-de-papel/)
* рдПрдХ рд╣реА рд╕реНрдерд┐рддрд┐ рдореЗрдВ рдмрдбрд╝реЗ рдмрд┐рди рд╣рдорд▓рд╛ рдЬреИрд╕рд╛ рджрд┐рдЦрд╛рдИ рджреЗрддрд╛ рд╣реИ [**how2heap**](https://github.com/shellphish/how2heap/blob/master/glibc\_2.35/large\_bin\_attack.c) рдореЗрдВред
* рд▓реЗрдЦрди рдкреНрд░рд╛рдердорд┐рдХрддрд╛ рдЕрдзрд┐рдХ рдЬрдЯрд┐рд▓ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдпрд╣рд╛рдБ `global_max_fast` рдЕрдиреБрдкрдпреЛрдЧреА рд╣реИред
* рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рд╕рдорд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП FSOP рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред
