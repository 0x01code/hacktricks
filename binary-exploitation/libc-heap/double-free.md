# рдбрдмрд▓ рдлреНрд░реА

<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕ рджреЗрдЦреЗрдВ**](https://github.com/sponsors/carlospolop)!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рдХрд▓реЗрдХреНрд╢рди, [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдЦреЛрдЬреЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** рдкрд░ **рдлреЙрд▓реЛ** рдХрд░реЗрдВ ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, HackTricks** рдХреЗ рд▓рд┐рдП PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВред

</details>

## рдореВрд▓ рдЬрд╛рдирдХрд╛рд░реА

рдпрджрд┐ рдЖрдк рдХрд┐рд╕реА рдмреНрд▓реЙрдХ рдХреА рдпрд╛рджрд╛рд╕реНрдд рдЕрдзрд┐рдХ рдмрд╛рд░ рдореБрдХреНрдд рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдпрд╣ рдЖрд▓реЛрдХрдХрд╛рд░ рдХреЗ рдбреЗрдЯрд╛ рдХреЛ рдЧрдбрд╝рдмрдбрд╝ рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рд╣рдорд▓реЛрдВ рдХреЗ рджрд░рд╡рд╛рдЬреЗ рдХреЛ рдЦреЛрд▓ рд╕рдХрддрд╛ рд╣реИред рдпрд╣рд╛рдВ рдпрд╣ рдХреИрд╕реЗ рд╣реЛрддрд╛ рд╣реИ: рдЬрдм рдЖрдк рдХрд┐рд╕реА рдмреНрд▓реЙрдХ рдХреА рдпрд╛рджрд╛рд╕реНрдд рдореБрдХреНрдд рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдпрд╣ рдореБрдХреНрдд рдЯреБрдХрдбрд╝реЛрдВ рдХреА рд╕реВрдЪреА рдореЗрдВ рдЬрд╛рддрд╛ рд╣реИ (рдЬреИрд╕реЗ "рдлрд╛рд╕реНрдЯ рдмрд┐рди")ред рдпрджрд┐ рдЖрдк рдПрдХ рд╣реА рдмреНрд▓реЙрдХ рдХреЛ рджреЛ рдмрд╛рд░ рд░реЛрдХрддреЗ рд╣реИрдВ, рддреЛ рдЖрд▓реЛрдХрдХрд╛рд░ рдЗрд╕реЗ рдкрд╣рдЪрд╛рдирддрд╛ рд╣реИ рдФрд░ рддреНрд░реБрдЯрд┐ рдлреЗрдВрдХрддрд╛ рд╣реИред рд▓реЗрдХрд┐рди рдпрджрд┐ рдЖрдк **рджреЛ рдмрд╛рд░ рдореБрдХреНрдд рдХрд░рдиреЗ рдХреА рдЬрд╛рдВрдЪ рдХреЗ рдмреАрдЪ рдПрдХ рдФрд░ рдЯреБрдХрдбрд╝рд╛ рдореБрдХреНрдд рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдбрдмрд▓-рдлреНрд░реА рдЬрд╛рдВрдЪ рдХреЛ рдЫрд▓рдирд╛** рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдХреНрд╖рддрд┐ рд╣реЛрддреА рд╣реИред

рдЕрдм, рдЬрдм рдЖрдк рдирдИ рдпрд╛рджрд╛рд╕реНрдд рдХреЗ рд▓рд┐рдП рдкреВрдЫрддреЗ рд╣реИрдВ (`malloc` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ), рддреЛ рдЖрд▓реЛрдХрдХрд╛рд░ рдЖрдкрдХреЛ рдПрдХ **рдмреНрд▓реЙрдХ рджреЗ рд╕рдХрддрд╛ рд╣реИ рдЬрд┐рд╕реЗ рджреЛ рдмрд╛рд░ рдореБрдХреНрдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ**ред рдпрд╣ рджреЛ рд╡рд┐рднрд┐рдиреНрди рдкреНрд╡рд╛рдЗрдВрдЯрд░реНрд╕ рдХреЛ рдПрдХ рд╣реА рдпрд╛рджрд╛рд╕реНрдд рд╕реНрдерд╛рди рдкрд░ рдкреНрд╡рд╛рдЗрдВрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд▓реЗ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдпрджрд┐ рдХреЛрдИ рд╣рдорд▓рд╛рд╡рд░ рдЙрди рдкреНрд╡рд╛рдЗрдВрдЯрд░реНрд╕ рдореЗрдВ рд╕реЗ рдПрдХ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рддрд╛ рд╣реИ, рддреЛ рд╡реЗ рдЙрд╕ рдпрд╛рджрд╛рд╕реНрдд рдХреА рд╕рд╛рдордЧреНрд░реА рдХреЛ рдмрджрд▓ рд╕рдХрддреЗ рд╣реИрдВ, рдЬрд┐рд╕рд╕реЗ рд╕реБрд░рдХреНрд╖рд╛ рд╕рдорд╕реНрдпрд╛рдПрдБ рдЙрддреНрдкрдиреНрди рд╣реЛ рд╕рдХрддреА рд╣реИрдВ рдпрд╛ рдЙрдиреНрд╣реЗрдВ рдХреЛрдб рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдорд┐рд▓ рд╕рдХрддреА рд╣реИред

рдЙрджрд╛рд╣рд░рдг:
```c
#include <stdio.h>
#include <stdlib.h>

int main() {
// Allocate memory for three chunks
char *a = (char *)malloc(10);
char *b = (char *)malloc(10);
char *c = (char *)malloc(10);
char *d = (char *)malloc(10);
char *e = (char *)malloc(10);
char *f = (char *)malloc(10);
char *g = (char *)malloc(10);
char *h = (char *)malloc(10);
char *i = (char *)malloc(10);

// Print initial memory addresses
printf("Initial allocations:\n");
printf("a: %p\n", (void *)a);
printf("b: %p\n", (void *)b);
printf("c: %p\n", (void *)c);
printf("d: %p\n", (void *)d);
printf("e: %p\n", (void *)e);
printf("f: %p\n", (void *)f);
printf("g: %p\n", (void *)g);
printf("h: %p\n", (void *)h);
printf("i: %p\n", (void *)i);

// Fill tcache
free(a);
free(b);
free(c);
free(d);
free(e);
free(f);
free(g);

// Introduce double-free vulnerability in fast bin
free(h);
free(i);
free(h);


// Reallocate memory and print the addresses
char *a1 = (char *)malloc(10);
char *b1 = (char *)malloc(10);
char *c1 = (char *)malloc(10);
char *d1 = (char *)malloc(10);
char *e1 = (char *)malloc(10);
char *f1 = (char *)malloc(10);
char *g1 = (char *)malloc(10);
char *h1 = (char *)malloc(10);
char *i1 = (char *)malloc(10);
char *i2 = (char *)malloc(10);

// Print initial memory addresses
printf("After reallocations:\n");
printf("a1: %p\n", (void *)a1);
printf("b1: %p\n", (void *)b1);
printf("c1: %p\n", (void *)c1);
printf("d1: %p\n", (void *)d1);
printf("e1: %p\n", (void *)e1);
printf("f1: %p\n", (void *)f1);
printf("g1: %p\n", (void *)g1);
printf("h1: %p\n", (void *)h1);
printf("i1: %p\n", (void *)i1);
printf("i2: %p\n", (void *)i1);

return 0;
}
```
рдЗрд╕ рдЙрджрд╛рд╣рд░рдг рдореЗрдВ, tcache рдХреЛ рдХрдИ рдореБрдХреНрдд рдЪрдВрдХреЛрдВ (7) рд╕реЗ рднрд░рдиреЗ рдХреЗ рдмрд╛рдж, рдХреЛрдб **рдЪрдВрдХ `h` рдХреЛ рдореБрдХреНрдд рдХрд░рддрд╛ рд╣реИ, рдлрд┐рд░ рдЪрдВрдХ `i` рдХреЛ, рдФрд░ рдлрд┐рд░ `h` рдХреЛ рдлрд┐рд░ рд╕реЗ, рдЬрд┐рд╕рд╕реЗ рдбрдмрд▓ рдлреНрд░реА рд╣реЛрддрд╛ рд╣реИ** (рдЬрд┐рд╕реЗ Fast Bin dup рднреА рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ)ред рдпрд╣ reallocating рдХрд░рддреЗ рд╕рдордп рдУрд╡рд░рд▓реИрдкрд┐рдВрдЧ рдореЗрдореЛрд░реА рдкрддреЗ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рдЦреЛрд▓рддрд╛ рд╣реИ, рдЬрд┐рд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рджреЛ рдпрд╛ рджреЛ рд╕реЗ рдЕрдзрд┐рдХ рдкреЙрдЗрдВрдЯрд░ рдПрдХ рд╣реА рдореЗрдореЛрд░реА рд╕реНрдерд╛рди рдХреЛ рдкреЙрдЗрдВрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдПрдХ рдкреЙрдЗрдВрдЯрд░ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдбреЗрдЯрд╛ рдХреЛ рдореЛрдбрд╝рдирд╛ рдлрд┐рд░ рджреВрд╕рд░реЗ рдкрд░ рдкреНрд░рднрд╛рд╡ рдбрд╛рд▓ рд╕рдХрддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдПрдХ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╕реБрд░рдХреНрд╖рд╛ рдЬреЛрдЦрд┐рдо рдФрд░ рдЙрддреНрдкреАрдбрд╝рди рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рдмрдирддреА рд╣реИред

рдЗрд╕реЗ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рддреЗ рд╕рдордп, рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ **`i1` рдФрд░ `i2` рдХреЛ рдПрдХ рд╣реА рдкрддрд╛ рдорд┐рд▓рд╛**:

<pre><code>рдкреНрд░рд╛рд░рдВрднрд┐рдХ рдЖрд╡рдВрдЯрди:
a: 0xaaab0f0c22a0
b: 0xaaab0f0c22c0
c: 0xaaab0f0c22e0
d: 0xaaab0f0c2300
e: 0xaaab0f0c2320
f: 0xaaab0f0c2340
g: 0xaaab0f0c2360
h: 0xaaab0f0c2380
i: 0xaaab0f0c23a0
рдкреБрдирд░реНрдЖрд╡рдВрдЯрди рдХреЗ рдмрд╛рдж:
a1: 0xaaab0f0c2360
b1: 0xaaab0f0c2340
c1: 0xaaab0f0c2320
d1: 0xaaab0f0c2300
e1: 0xaaab0f0c22e0
f1: 0xaaab0f0c22c0
g1: 0xaaab0f0c22a0
h1: 0xaaab0f0c2380
<strong>i1: 0xaaab0f0c23a0
</strong><strong>i2: 0xaaab0f0c23a0
</strong></code></pre>

## рдЙрджрд╛рд╣рд░рдг

* [**Dragon Army. Hack The Box**](https://7rocky.github.io/en/ctf/htb-challenges/pwn/dragon-army/)
* рд╣рдо рдХреЗрд╡рд▓ Fast-Bin рдЖрдХрд╛рд░ рдХреЗ рдЪрдВрдХреНрд╕ рдЖрд╡рдВрдЯрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рд╕рд╛рдЗрдЬ `0x70` рдХреЛ рдЫреЛрдбрд╝рдХрд░, рдЬреЛ рд╕рд╛рдорд╛рдиреНрдп `__malloc_hook` рдУрд╡рд░рд░рд╛рдЗрдЯ рдХреЛ рд░реЛрдХрддрд╛ рд╣реИред
* рдЗрд╕рдХреЗ рдмрдЬрд╛рдп, рд╣рдо PIE рдкрддреЗ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ рдЬреЛ `0x56` рд╕реЗ рд╢реБрд░реВ рд╣реЛрддреЗ рд╣реИрдВ, Fast Bin dup рдХреЗ рд▓рд┐рдП рд▓рдХреНрд╖реНрдп рдХреЗ рд░реВрдк рдореЗрдВред
* PIE рдкрддреЛрдВ рдХреЛ рд╕рдВрдЧреНрд░рд╣рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ `main_arena` рдореЗрдВ, рдЬреЛ Glibc рдХреЗ рдЕрдВрджрд░ рд╣реИ рдФрд░ `__malloc_hook` рдХреЗ рдкрд╛рд╕ рд╣реИ
* рд╣рдо `main_arena` рдХреЗ рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдСрдлрд╕реЗрдЯ рдХрд╛ рд▓рдХреНрд╖реНрдп рдмрдирд╛рддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рд╡рд╣рд╛рдВ рдПрдХ рдЪрдВрдХ рдЖрд╡рдВрдЯрд┐рдд рдХрд░ рд╕рдХреЗрдВ рдФрд░ `__malloc_hook` рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рддрдХ рдЪрдВрдХреНрд╕ рдЖрд╡рдВрдЯрд┐рдд рдХрд░рддреЗ рд░рд╣реЗрдВ рддрд╛рдХрд┐ рдХреЛрдб рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛ рд╕рдХреЗред
* [**zero_to_hero. PicoCTF**](https://7rocky.github.io/en/ctf/picoctf/binary-exploitation/zero_to_hero/)
* Tcache рдмрд┐рдиреНрд╕ рдФрд░ рдПрдХ рдирд▓-рдмрд╛рдЗрдЯ рдУрд╡рд░рдлреНрд▓реЛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╣рдо рдПрдХ рдбрдмрд▓-рдлреНрд░реА рд╕реНрдерд┐рддрд┐ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
* рд╣рдо рд╕рд╛рдЗрдЬ `0x110` рдХреЗ рддреАрди рдЪрдВрдХреНрд╕ рдЖрд╡рдВрдЯрд┐рдд рдХрд░рддреЗ рд╣реИрдВ (`A`, `B`, `C`)
* рд╣рдо `B` рдХреЛ рдореБрдХреНрдд рдХрд░рддреЗ рд╣реИрдВ
* рд╣рдо `A` рдХреЛ рдореБрдХреНрдд рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдлрд┐рд░ рд╕реЗ рдЖрд╡рдВрдЯрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдирд▓-рдмрд╛рдЗрдЯ рдУрд╡рд░рдлреНрд▓реЛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ
* рдЕрдм `B` рдХрд╛ рд╕рд╛рдЗрдЬ рдлрд╝реАрд▓реНрдб `0x100` рд╣реИ, `0x111` рдХреА рдмрдЬрд╛рдп, рдЗрд╕рд▓рд┐рдП рд╣рдо рдЗрд╕реЗ рдлрд┐рд░ рд╕реЗ рдореБрдХреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ
* рд╣рдореЗрдВ рдПрдХ Tcache-bin рд╣реИ рд╕рд╛рдЗрдЬ `0x110` рдФрд░ рдПрдХ рд╣реИ рд╕рд╛рдЗрдЬ `0x100` рдЬреЛ рдПрдХ рд╣реА рдкрддреЗ рдкрд░ рдкреЙрдЗрдВрдЯ рдХрд░рддреЗ рд╣реИрдВред рдЗрд╕рд▓рд┐рдП рд╣рдореЗрдВ рдПрдХ рдбрдмрд▓ рдлреНрд░реА рд╣реИред
* рд╣рдо [Tcache poisoning](tcache-bin-attack.md) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдбрдмрд▓ рдлреНрд░реА рдХрд╛ рд▓рд╛рдн рдЙрдард╛рддреЗ рд╣реИрдВ

## рд╕рдВрджрд░реНрдн

* [https://heap-exploitation.dhavalkapil.com/attacks/double\_free](https://heap-exploitation.dhavalkapil.com/attacks/double\_free)

<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ** рджрд┐рдЦрд╛рдпрд╛ рдЬрд╛рдП рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб** рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рдХрд▓реЗрдХреНрд╢рди [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** рдкрд░ **рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ** рд╣реИрдХрд┐рдВрдЧ рдФрд░ [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github рд░реЗрдкреЛ рдореЗрдВ PR рдЬрдорд╛ рдХрд░рдХреЗред

</details>
