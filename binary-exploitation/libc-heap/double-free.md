# –ü–æ–¥–≤—ñ–π–Ω–µ –≤–∏–≤—ñ–ª—å–Ω–µ–Ω–Ω—è

{% hint style="success" %}
–í–∏–≤—á–∞–π—Ç–µ —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ —Ö–∞–∫—ñ–Ω–≥ AWS: <img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**–ù–∞–≤—á–∞–Ω–Ω—è AWS Red Team Expert (ARTE) –≤—ñ–¥ HackTricks**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
–í–∏–≤—á–∞–π—Ç–µ —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ —Ö–∞–∫—ñ–Ω–≥ GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**–ù–∞–≤—á–∞–Ω–Ω—è GCP Red Team Expert (GRTE) –≤—ñ–¥ HackTricks**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>–ü—ñ–¥—Ç—Ä–∏–º–∞–π—Ç–µ HackTricks</summary>

* –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ø–ª–∞–Ω–∏ –ø—ñ–¥–ø–∏—Å–∫–∏**](https://github.com/sponsors/carlospolop)!
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ Telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –Ω–∞–º–∏ –Ω–∞ **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **–ü–æ—à–∏—Ä—é–π—Ç–µ —Ö–∞–∫–µ—Ä—Å—å–∫—ñ —Ç—Ä—é–∫–∏, –Ω–∞–¥—Å–∏–ª–∞—é—á–∏ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) —Ç–∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤ –Ω–∞ GitHub.

</details>
{% endhint %}

## –û—Å–Ω–æ–≤–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è

–Ø–∫—â–æ –≤–∏ –≤–∏–≤—ñ–ª—å–Ω—è—î—Ç–µ –±–ª–æ–∫ –ø–∞–º'—è—Ç—ñ –±—ñ–ª—å—à–µ –æ–¥–Ω–æ–≥–æ —Ä–∞–∑—É, —Ü–µ –º–æ–∂–µ —Å–ø—Ä–∏—á–∏–Ω–∏—Ç–∏ –ø—Ä–æ–±–ª–µ–º–∏ –∑ –¥–∞–Ω–∏–º–∏ –∞–ª–æ–∫–∞—Ç–æ—Ä–∞ —Ç–∞ –≤—ñ–¥–∫—Ä–∏—Ç–∏ –¥–≤–µ—Ä—ñ –¥–ª—è –∞—Ç–∞–∫. –û—Å—å —è–∫ —Ü–µ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è: –∫–æ–ª–∏ –≤–∏ –≤–∏–≤—ñ–ª—å–Ω—è—î—Ç–µ –±–ª–æ–∫ –ø–∞–º'—è—Ç—ñ, –≤—ñ–Ω –ø–æ–≤–µ—Ä—Ç–∞—î—Ç—å—Å—è –¥–æ —Å–ø–∏—Å–∫—É –≤—ñ–ª—å–Ω–∏—Ö —á–∞—Å—Ç–∏–Ω (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, "—à–≤–∏–¥–∫–∏–π –±—ñ–Ω"). –Ø–∫—â–æ –≤–∏ –≤–∏–≤—ñ–ª—å–Ω—é—î—Ç–µ —Ç–æ–π —Å–∞–º–∏–π –±–ª–æ–∫ –¥–≤—ñ—á—ñ –ø–æ—Å–ø—ñ–ª—å, –∞–ª–æ–∫–∞—Ç–æ—Ä –≤–∏—è–≤–ª—è—î —Ü–µ —ñ –≤–∏–¥–∞—î –ø–æ–º–∏–ª–∫—É. –ê–ª–µ —è–∫—â–æ **–≤–∏–≤—ñ–ª—å–Ω–∏—Ç–∏ —ñ–Ω—à–∏–π –±–ª–æ–∫ –º—ñ–∂ –Ω–∏–º–∏, –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø–æ–¥–≤—ñ–π–Ω–æ–≥–æ –≤–∏–≤—ñ–ª—å–Ω–µ–Ω–Ω—è –æ–±—Ö–æ–¥–∏—Ç—å—Å—è**, —â–æ –ø—Ä–∏–∑–≤–æ–¥–∏—Ç—å –¥–æ –ø–æ—Ä—É—à–µ–Ω—å.

–¢–µ–ø–µ—Ä, –∫–æ–ª–∏ –≤–∏ –ø—Ä–æ—Å–∏—Ç–µ –Ω–æ–≤—É –ø–∞–º'—è—Ç—å (–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ `malloc`), –∞–ª–æ–∫–∞—Ç–æ—Ä –º–æ–∂–µ –¥–∞—Ç–∏ –≤–∞–º **–±–ª–æ–∫, —è–∫–∏–π –±—É–≤ –≤–∏–≤—ñ–ª—å–Ω–µ–Ω–∏–π –¥–≤—ñ—á—ñ**. –¶–µ –º–æ–∂–µ –ø—Ä–∏–∑–≤–µ—Å—Ç–∏ –¥–æ —Ç–æ–≥–æ, —â–æ –¥–≤–∞ —Ä—ñ–∑–Ω—ñ –≤–∫–∞–∑—ñ–≤–Ω–∏–∫–∏ –≤–∫–∞–∑—É—é—Ç—å –Ω–∞ —Ç—É —Å–∞–º—É –æ–±–ª–∞—Å—Ç—å –ø–∞–º'—è—Ç—ñ. –Ø–∫—â–æ –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫ –∫–æ–Ω—Ç—Ä–æ–ª—é—î –æ–¥–∏–Ω –∑ —Ü–∏—Ö –≤–∫–∞–∑—ñ–≤–Ω–∏–∫—ñ–≤, –≤—ñ–Ω –º–æ–∂–µ –∑–º—ñ–Ω–∏—Ç–∏ –≤–º—ñ—Å—Ç —Ü—ñ—î—ó –ø–∞–º'—è—Ç—ñ, —â–æ –º–æ–∂–µ –ø—Ä–∏–∑–≤–µ—Å—Ç–∏ –¥–æ –ø—Ä–æ–±–ª–µ–º –∑ –±–µ–∑–ø–µ–∫–æ—é –∞–±–æ –Ω–∞–≤—ñ—Ç—å –¥–æ–∑–≤–æ–ª–∏—Ç–∏ –≤–∏–∫–æ–Ω–∞—Ç–∏ –∫–æ–¥.

–ü—Ä–∏–∫–ª–∞–¥:
```c
#include <stdio.h>
#include <stdlib.h>

int main() {
// Allocate memory for three chunks
char *a = (char *)malloc(10);
char *b = (char *)malloc(10);
char *c = (char *)malloc(10);
char *d = (char *)malloc(10);
char *e = (char *)malloc(10);
char *f = (char *)malloc(10);
char *g = (char *)malloc(10);
char *h = (char *)malloc(10);
char *i = (char *)malloc(10);

// Print initial memory addresses
printf("Initial allocations:\n");
printf("a: %p\n", (void *)a);
printf("b: %p\n", (void *)b);
printf("c: %p\n", (void *)c);
printf("d: %p\n", (void *)d);
printf("e: %p\n", (void *)e);
printf("f: %p\n", (void *)f);
printf("g: %p\n", (void *)g);
printf("h: %p\n", (void *)h);
printf("i: %p\n", (void *)i);

// Fill tcache
free(a);
free(b);
free(c);
free(d);
free(e);
free(f);
free(g);

// Introduce double-free vulnerability in fast bin
free(h);
free(i);
free(h);


// Reallocate memory and print the addresses
char *a1 = (char *)malloc(10);
char *b1 = (char *)malloc(10);
char *c1 = (char *)malloc(10);
char *d1 = (char *)malloc(10);
char *e1 = (char *)malloc(10);
char *f1 = (char *)malloc(10);
char *g1 = (char *)malloc(10);
char *h1 = (char *)malloc(10);
char *i1 = (char *)malloc(10);
char *i2 = (char *)malloc(10);

// Print initial memory addresses
printf("After reallocations:\n");
printf("a1: %p\n", (void *)a1);
printf("b1: %p\n", (void *)b1);
printf("c1: %p\n", (void *)c1);
printf("d1: %p\n", (void *)d1);
printf("e1: %p\n", (void *)e1);
printf("f1: %p\n", (void *)f1);
printf("g1: %p\n", (void *)g1);
printf("h1: %p\n", (void *)h1);
printf("i1: %p\n", (void *)i1);
printf("i2: %p\n", (void *)i1);

return 0;
}
```
–£ —Ü—å–æ–º—É –ø—Ä–∏–∫–ª–∞–¥—ñ, –ø—ñ—Å–ª—è –Ω–∞–ø–æ–≤–Ω–µ–Ω–Ω—è tcache –∫—ñ–ª—å–∫–æ–º–∞ –≤–∏–≤—ñ–ª—å–Ω–µ–Ω–∏–º–∏ —á–∞—Å—Ç–∏–Ω–∞–º–∏ (7), –∫–æ–¥ **–≤–∏–≤—ñ–ª—å–Ω—è—î —á–∞—Å—Ç–∏–Ω—É `h`, –ø–æ—Ç—ñ–º —á–∞—Å—Ç–∏–Ω—É `i`, –∞ –ø–æ—Ç—ñ–º –∑–Ω–æ–≤—É `h`, —â–æ –ø—Ä–∏–∑–≤–æ–¥–∏—Ç—å –¥–æ –ø–æ–¥–≤—ñ–π–Ω–æ–≥–æ –≤–∏–≤—ñ–ª—å–Ω–µ–Ω–Ω—è** (—Ç–∞–∫–æ–∂ –≤—ñ–¥–æ–º–æ–≥–æ —è–∫ Fast Bin dup). –¶–µ –≤—ñ–¥–∫—Ä–∏–≤–∞—î –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –Ω–∞–∫–ª–∞–¥–∞—é—á–∏—Ö—Å—è –∞–¥—Ä–µ—Å –ø–∞–º'—è—Ç—ñ –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º—É –≤–∏–¥—ñ–ª–µ–Ω–Ω—ñ, —â–æ –æ–∑–Ω–∞—á–∞—î, —â–æ –¥–≤–∞ –∞–±–æ –±—ñ–ª—å—à–µ –≤–∫–∞–∑—ñ–≤–Ω–∏–∫–∏ –º–æ–∂—É—Ç—å –≤–∫–∞–∑—É–≤–∞—Ç–∏ –Ω–∞ —Ç—É —Å–∞–º—É –æ–±–ª–∞—Å—Ç—å –ø–∞–º'—è—Ç—ñ. –ú–∞–Ω—ñ–ø—É–ª—é—é—á–∏ –¥–∞–Ω–∏–º–∏ —á–µ—Ä–µ–∑ –æ–¥–∏–Ω –≤–∫–∞–∑—ñ–≤–Ω–∏–∫, –º–æ–∂–Ω–∞ –≤–ø–ª–∏–Ω—É—Ç–∏ –Ω–∞ —ñ–Ω—à–∏–π, —Å—Ç–≤–æ—Ä—é—é—á–∏ –∫—Ä–∏—Ç–∏—á–Ω–∏–π —Ä–∏–∑–∏–∫ –±–µ–∑–ø–µ–∫–∏ —Ç–∞ –ø–æ—Ç–µ–Ω—Ü—ñ–∞–ª –¥–ª—è –µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—ó.

–í–∏–∫–æ–Ω–∞–≤—à–∏ —Ü–µ, –∑–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —è–∫ **`i1` —Ç–∞ `i2` –æ—Ç—Ä–∏–º–∞–ª–∏ –æ–¥–Ω–∞–∫–æ–≤—É –∞–¥—Ä–µ—Å—É**:

<pre><code>–ü–æ—á–∞—Ç–∫–æ–≤—ñ –≤–∏–¥—ñ–ª–µ–Ω–Ω—è:
a: 0xaaab0f0c22a0
b: 0xaaab0f0c22c0
c: 0xaaab0f0c22e0
d: 0xaaab0f0c2300
e: 0xaaab0f0c2320
f: 0xaaab0f0c2340
g: 0xaaab0f0c2360
h: 0xaaab0f0c2380
i: 0xaaab0f0c23a0
–ü—ñ—Å–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤–∏–¥—ñ–ª–µ–Ω–Ω—è:
a1: 0xaaab0f0c2360
b1: 0xaaab0f0c2340
c1: 0xaaab0f0c2320
d1: 0xaaab0f0c2300
e1: 0xaaab0f0c22e0
f1: 0xaaab0f0c22c0
g1: 0xaaab0f0c22a0
h1: 0xaaab0f0c2380
<strong>i1: 0xaaab0f0c23a0
</strong><strong>i2: 0xaaab0f0c23a0
</strong></code></pre>

## –ü—Ä–∏–∫–ª–∞–¥–∏

* [**Dragon Army. Hack The Box**](https://7rocky.github.io/en/ctf/htb-challenges/pwn/dragon-army/)
* –ú–∏ –º–æ–∂–µ–º–æ –≤–∏–¥—ñ–ª—è—Ç–∏ –ª–∏—à–µ —á–∞—Å—Ç–∏–Ω–∏ —Ä–æ–∑–º—ñ—Ä–æ–º Fast-Bin, –∑–∞ –≤–∏–Ω—è—Ç–∫–æ–º —Ä–æ–∑–º—ñ—Ä—É `0x70`, —â–æ –∑–∞–ø–æ–±—ñ–≥–∞—î –∑–≤–∏—á–∞–π–Ω–æ–º—É –ø–µ—Ä–µ–∑–∞–ø–∏—Å—É `__malloc_hook`.
* –ó–∞–º—ñ—Å—Ç—å —Ü—å–æ–≥–æ –º–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –∞–¥—Ä–µ—Å–∏ PIE, —è–∫—ñ –ø–æ—á–∏–Ω–∞—é—Ç—å—Å—è –∑ `0x56`, —è–∫ —Ü—ñ–ª—å –¥–ª—è Fast Bin dup (1/2 —à–∞–Ω—Å).
* –û–¥–Ω–µ –º—ñ—Å—Ü–µ, –¥–µ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –∞–¥—Ä–µ—Å–∏ PIE, —Ü–µ `main_arena`, —è–∫–∞ –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ Glibc —Ç–∞ –ø–æ—Ä—É—á –∑ `__malloc_hook`.
* –ú–∏ —Å–ø—Ä—è–º–æ–≤—É—î–º–æ—Å—è –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏–π –∑—Å—É–≤ `main_arena`, —â–æ–± –≤–∏–¥—ñ–ª–∏—Ç–∏ —Ç—É–¥–∏ —á–∞—Å—Ç–∏–Ω—É —Ç–∞ –ø—Ä–æ–¥–æ–≤–∂—É—î–º–æ –≤–∏–¥—ñ–ª—è—Ç–∏ —á–∞—Å—Ç–∏–Ω–∏ –¥–æ –¥–æ—Å—è–≥–Ω–µ–Ω–Ω—è `__malloc_hook` –¥–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∫–æ–¥—É.
* [**zero_to_hero. PicoCTF**](https://7rocky.github.io/en/ctf/picoctf/binary-exploitation/zero_to_hero/)
* –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –±—ñ–Ω–∏ Tcache —Ç–∞ –ø–µ—Ä–µ–ø–æ–≤–Ω–µ–Ω–Ω—è –Ω—É–ª—å–æ–≤–∏–º –±–∞–π—Ç–æ–º, –º–∏ –º–æ–∂–µ–º–æ –¥–æ—Å—è–≥—Ç–∏ —Å–∏—Ç—É–∞—Ü—ñ—ó –ø–æ–¥–≤—ñ–π–Ω–æ–≥–æ –≤–∏–≤—ñ–ª—å–Ω–µ–Ω–Ω—è:
* –ú–∏ –≤–∏–¥—ñ–ª—è—î–º–æ —Ç—Ä–∏ —á–∞—Å—Ç–∏–Ω–∏ —Ä–æ–∑–º—ñ—Ä–æ–º `0x110` (`A`, `B`, `C`).
* –ú–∏ –≤–∏–≤—ñ–ª—å–Ω—è—î–º–æ `B`.
* –ú–∏ –≤–∏–≤—ñ–ª—å–Ω—è—î–º–æ `A` —Ç–∞ –≤–∏–¥—ñ–ª—è—î–º–æ –∑–Ω–æ–≤—É, —â–æ–± –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ –ø–µ—Ä–µ–ø–æ–≤–Ω–µ–Ω–Ω—è –Ω—É–ª—å–æ–≤–∏–º –±–∞–π—Ç–æ–º.
* –¢–µ–ø–µ—Ä —Ä–æ–∑–º—ñ—Ä –ø–æ–ª—è `B` - `0x100`, –∞ –Ω–µ `0x111`, —Ç–æ–º—É –º–∏ –º–æ–∂–µ–º–æ –∑–Ω–æ–≤—É –π–æ–≥–æ –≤–∏–≤—ñ–ª—å–Ω–∏—Ç–∏.
* –£ –Ω–∞—Å —î –æ–¥–∏–Ω –±—ñ–Ω Tcache —Ä–æ–∑–º—ñ—Ä–æ–º `0x110` —Ç–∞ –æ–¥–∏–Ω —Ä–æ–∑–º—ñ—Ä–æ–º `0x100`, —è–∫—ñ –≤–∫–∞–∑—É—é—Ç—å –Ω–∞ —Ç—É —Å–∞–º—É –∞–¥—Ä–µ—Å—É. –¢–∞–∫–∏–º —á–∏–Ω–æ–º, –º–∏ –º–∞—î–º–æ –ø–æ–¥–≤—ñ–π–Ω–µ –≤–∏–≤—ñ–ª—å–Ω–µ–Ω–Ω—è.
* –ú–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –ø–æ–¥–≤—ñ–π–Ω–µ –≤–∏–≤—ñ–ª—å–Ω–µ–Ω–Ω—è –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é [–∑–∞–±—Ä—É–¥–Ω–µ–Ω–Ω—è Tcache](tcache-bin-attack.md)

## –ü–æ—Å–∏–ª–∞–Ω–Ω—è

* [https://heap-exploitation.dhavalkapil.com/attacks/double\_free](https://heap-exploitation.dhavalkapil.com/attacks/double\_free)

{% hint style="success" %}
–í–∏–≤—á–∞–π—Ç–µ —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ –≤–∑–ª–æ–º AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**–ù–∞–≤—á–∞–Ω–Ω—è HackTricks AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
–í–∏–≤—á–∞–π—Ç–µ —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ –≤–∑–ª–æ–º GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**–ù–∞–≤—á–∞–Ω–Ω—è HackTricks GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>–ü—ñ–¥—Ç—Ä–∏–º–∞–π—Ç–µ HackTricks</summary>

* –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ø–ª–∞–Ω–∏ –ø—ñ–¥–ø–∏—Å–∫–∏**](https://github.com/sponsors/carlospolop)!
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ –≥—Ä—É–ø–∏ [**telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –Ω–∞–º–∏ –Ω–∞ **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **–ü–æ—à–∏—Ä—é–π—Ç–µ —Ö–∞–∫–µ—Ä—Å—å–∫—ñ —Ç—Ä—é–∫–∏, –Ω–∞–¥—Å–∏–ª–∞—é—á–∏ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) —Ç–∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤ –Ω–∞ GitHub.

</details>
{% endhint %}
