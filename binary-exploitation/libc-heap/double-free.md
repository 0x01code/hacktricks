# –î–≤–æ—Å—Ç—Ä—É–∫–æ –û—Å–ª–æ–±–∞—í–∞—ö–µ

<details>

<summary><strong>–ù–∞—É—á–∏—Ç–µ —Ö–∞–∫–æ–≤–∞—ö–µ AWS-–∞ –æ–¥ –Ω—É–ª–µ –¥–æ –≥–µ—Ä–æ—ò–∞ —Å–∞</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

–î—Ä—É–≥–∏ –Ω–∞—á–∏–Ω–∏ –¥–∞ –ø–æ–¥—Ä–∂–∏—Ç–µ HackTricks:

* –ê–∫–æ –∂–µ–ª–∏—Ç–µ –¥–∞ –≤–∏–¥–∏—Ç–µ –≤–∞—à—É **–∫–æ–º–ø–∞–Ω–∏—ò—É —Ä–µ–∫–ª–∞–º–∏—Ä–∞–Ω—É –Ω–∞ HackTricks** –∏–ª–∏ **–ø—Ä–µ—É–∑–º–µ—Ç–µ HackTricks —É PDF —Ñ–æ—Ä–º–∞—Ç—É** –ø—Ä–æ–≤–µ—Ä–∏—Ç–µ [**–ü–õ–ê–ù–û–í–ï –ü–†–ï–¢–ü–õ–ê–¢–ï**](https://github.com/sponsors/carlospolop)!
* –ù–∞–±–∞–≤–∏—Ç–µ [**–∑–≤–∞–Ω–∏—á–Ω–∏ PEASS & HackTricks —Å—É–≤–µ–Ω–∏—Ä**](https://peass.creator-spring.com)
* –û—Ç–∫—Ä–∏—ò—Ç–µ [**Porodicu PEASS**](https://opensea.io/collection/the-peass-family), –Ω–∞—à—É –∫–æ–ª–µ–∫—Ü–∏—ò—É –µ–∫—Å–∫–ª—É–∑–∏–≤–Ω–∏—Ö [**NFT-–æ–≤–∞**](https://opensea.io/collection/the-peass-family)
* **–ü—Ä–∏–¥—Ä—É–∂–∏—Ç–µ —Å–µ** üí¨ [**Discord –≥—Ä—É–ø–∏**](https://discord.gg/hRep4RUj7f) –∏–ª–∏ [**telegram –≥—Ä—É–ø–∏**](https://t.me/peass) –∏–ª–∏ **–ø—Ä–∞—Ç–∏—Ç–µ** –Ω–∞—Å –Ω–∞ **Twitter-u** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **–ü–æ–¥–µ–ª–∏—Ç–µ —Å–≤–æ—ò–µ —Ö–∞–∫–µ—Ä—Å–∫–µ —Ç—Ä–∏–∫–æ–≤–µ –ø–æ–¥–Ω–æ—à–µ—ö–µ–º PR-–æ–≤–∞ –Ω–∞** [**HackTricks**](https://github.com/carlospolop/hacktricks) –∏ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—ò—É–º–∏–º–∞.

</details>

## –û—Å–Ω–æ–≤–Ω–µ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—ò–µ

–ê–∫–æ –æ—Å–ª–æ–±–æ–¥–∏—Ç–µ –±–ª–æ–∫ –º–µ–º–æ—Ä–∏—ò–µ –≤–∏—à–µ –ø—É—Ç–∞, –º–æ–∂–µ –¥–∞ —Å–µ –ø–æ–º–µ—Ç–µ –ø–æ–¥–∞—Ç–∫–µ –∞–ª–æ–∫–∞—Ç–æ—Ä–∞ –∏ –æ—Ç–≤–æ—Ä–∏ –≤—Ä–∞—Ç–∏ –Ω–∞–ø–∞–¥–∏–º–∞. –ï–≤–æ –∫–∞–∫–æ —Å–µ –¥–µ—à–∞–≤–∞: –∫–∞–¥–∞ –æ—Å–ª–æ–±–æ–¥–∏—Ç–µ –±–ª–æ–∫ –º–µ–º–æ—Ä–∏—ò–µ, –æ–Ω —Å–µ –≤—Ä–∞—õ–∞ —É –ª–∏—Å—Ç—É —Å–ª–æ–±–æ–¥–Ω–∏—Ö —á–∞–Ω–∫–æ–≤–∞ (–Ω–ø—Ä. "–±—Ä–∑–∏ –±–∏–Ω"). –ê–∫–æ –æ—Å–ª–æ–±–æ–¥–∏—Ç–µ –∏—Å—Ç–∏ –±–ª–æ–∫ –¥–≤–∞–ø—É—Ç –∑–∞ —Ä–µ–¥–æ–º, –∞–ª–æ–∫–∞—Ç–æ—Ä —Ç–æ –æ—Ç–∫—Ä–∏–≤–∞ –∏ –±–∞—Ü–∞ –≥—Ä–µ—à–∫—É. –ê–ª–∏, –∞–∫–æ **–æ—Å–ª–æ–±–æ–¥–∏—Ç–µ –¥—Ä—É–≥–∏ —á–∞–Ω–∫ –∏–∑–º–µ—í—É, –¥–≤–æ—Å—Ç—Ä—É–∫–æ-–æ—Å–ª–æ–±–∞—í–∞—ö–µ —Å–µ –ø—Ä–µ—Å–∫–∞—á–µ**, –∏–∑–∞–∑–∏–≤–∞—ò—É—õ–∏ –∫–æ—Ä—É–ø—Ü–∏—ò—É.

–°–∞–¥–∞, –∫–∞–¥–∞ –∑–∞—Ö—Ç–µ–≤–∞—Ç–µ –Ω–æ–≤—É –º–µ–º–æ—Ä–∏—ò—É (–∫–æ—Ä–∏—Å—Ç–µ—õ–∏ `malloc`), –∞–ª–æ–∫–∞—Ç–æ—Ä –≤–∞–º –º–æ–∂–µ –¥–∞—Ç–∏ **–±–ª–æ–∫ –∫–æ—ò–∏ —ò–µ –¥–≤–∞–ø—É—Ç –æ—Å–ª–æ–±–æ—í–µ–Ω**. –û–≤–æ –º–æ–∂–µ –¥–æ–≤–µ—Å—Ç–∏ –¥–æ –¥–≤–∞ —Ä–∞–∑–ª–∏—á–∏—Ç–∞ –ø–æ–∫–∞–∑–∏–≤–∞—á–∞ –∫–æ—ò–∏ –ø–æ–∫–∞–∑—É—ò—É –Ω–∞ –∏—Å—Ç—É –ª–æ–∫–∞—Ü–∏—ò—É –º–µ–º–æ—Ä–∏—ò–µ. –ê–∫–æ –Ω–∞–ø–∞–¥–∞—á –∫–æ–Ω—Ç—Ä–æ–ª–∏—à–µ —ò–µ–¥–∞–Ω –æ–¥ —Ç–∏—Ö –ø–æ–∫–∞–∑–∏–≤–∞—á–∞, –º–æ–∂–µ –ø—Ä–æ–º–µ–Ω–∏—Ç–∏ —Å–∞–¥—Ä–∂–∞—ò —Ç–µ –º–µ–º–æ—Ä–∏—ò–µ, —à—Ç–æ –º–æ–∂–µ –∏–∑–∞–∑–≤–∞—Ç–∏ –±–µ–∑–±–µ–¥–Ω–æ—Å–Ω–µ –ø—Ä–æ–±–ª–µ–º–µ –∏–ª–∏ –∏–º –¥–æ–∑–≤–æ–ª–∏—Ç–∏ –¥–∞ –∏–∑–≤—Ä—à–µ –∫–æ–¥.

–ü—Ä–∏–º–µ—Ä:
```c
#include <stdio.h>
#include <stdlib.h>

int main() {
// Allocate memory for three chunks
char *a = (char *)malloc(10);
char *b = (char *)malloc(10);
char *c = (char *)malloc(10);
char *d = (char *)malloc(10);
char *e = (char *)malloc(10);
char *f = (char *)malloc(10);
char *g = (char *)malloc(10);
char *h = (char *)malloc(10);
char *i = (char *)malloc(10);

// Print initial memory addresses
printf("Initial allocations:\n");
printf("a: %p\n", (void *)a);
printf("b: %p\n", (void *)b);
printf("c: %p\n", (void *)c);
printf("d: %p\n", (void *)d);
printf("e: %p\n", (void *)e);
printf("f: %p\n", (void *)f);
printf("g: %p\n", (void *)g);
printf("h: %p\n", (void *)h);
printf("i: %p\n", (void *)i);

// Fill tcache
free(a);
free(b);
free(c);
free(d);
free(e);
free(f);
free(g);

// Introduce double-free vulnerability in fast bin
free(h);
free(i);
free(h);


// Reallocate memory and print the addresses
char *a1 = (char *)malloc(10);
char *b1 = (char *)malloc(10);
char *c1 = (char *)malloc(10);
char *d1 = (char *)malloc(10);
char *e1 = (char *)malloc(10);
char *f1 = (char *)malloc(10);
char *g1 = (char *)malloc(10);
char *h1 = (char *)malloc(10);
char *i1 = (char *)malloc(10);
char *i2 = (char *)malloc(10);

// Print initial memory addresses
printf("After reallocations:\n");
printf("a1: %p\n", (void *)a1);
printf("b1: %p\n", (void *)b1);
printf("c1: %p\n", (void *)c1);
printf("d1: %p\n", (void *)d1);
printf("e1: %p\n", (void *)e1);
printf("f1: %p\n", (void *)f1);
printf("g1: %p\n", (void *)g1);
printf("h1: %p\n", (void *)h1);
printf("i1: %p\n", (void *)i1);
printf("i2: %p\n", (void *)i1);

return 0;
}
```
U ovom primeru, nakon ≈°to se tcache popuni sa nekoliko osloboƒëenih blokova (7), kod **oslobaƒëa blok `h`, zatim blok `i`, a zatim ponovo `h`, uzrokujuƒái dvostruko osloboƒëavanje** (poznato i kao Fast Bin duplikat). Ovo otvara moguƒánost dobijanja preklapajuƒáih memorijskih adresa prilikom realokacije, ≈°to znaƒçi da dva ili vi≈°e pokazivaƒça mogu pokazivati na istu memorijsku lokaciju. Manipulisanje podacima putem jednog pokazivaƒça mo≈æe zatim uticati na drugi, stvarajuƒái kritiƒçan sigurnosni rizik i potencijal za eksploataciju.

Izvr≈°avajuƒái to, primetite kako su **`i1` i `i2` dobili istu adresu**:

<pre><code>Poƒçetne alokacije:
a: 0xaaab0f0c22a0
b: 0xaaab0f0c22c0
c: 0xaaab0f0c22e0
d: 0xaaab0f0c2300
e: 0xaaab0f0c2320
f: 0xaaab0f0c2340
g: 0xaaab0f0c2360
h: 0xaaab0f0c2380
i: 0xaaab0f0c23a0
Nakon realokacija:
a1: 0xaaab0f0c2360
b1: 0xaaab0f0c2340
c1: 0xaaab0f0c2320
d1: 0xaaab0f0c2300
e1: 0xaaab0f0c22e0
f1: 0xaaab0f0c22c0
g1: 0xaaab0f0c22a0
h1: 0xaaab0f0c2380
<strong>i1: 0xaaab0f0c23a0
</strong><strong>i2: 0xaaab0f0c23a0
</strong></code></pre>

## Primeri

* [**Dragon Army. Hack The Box**](https://7rocky.github.io/en/ctf/htb-challenges/pwn/dragon-army/)
* Mo≈æemo alocirati samo blokove veliƒçine Fast-Bin, osim za veliƒçinu `0x70`, ≈°to spreƒçava uobiƒçajeno prepisivanje `__malloc_hook`.
* Umesto toga, koristimo PIE adrese koje poƒçinju sa `0x56` kao cilj za Fast Bin duplikat (1/2 ≈°anse).
* Jedno mesto gde se ƒçuvaju PIE adrese je u `main_arena`, koja je unutar Glibc-a i blizu `__malloc_hook`.
* Ciljamo odreƒëeni offset `main_arena`-e da alociramo blok tamo i nastavljamo sa alociranjem blokova dok ne stignemo do `__malloc_hook`-a kako bismo dobili izvr≈°enje koda.
* [**zero_to_hero. PicoCTF**](https://7rocky.github.io/en/ctf/picoctf/binary-exploitation/zero_to_hero/)
* Koristeƒái Tcache binove i prelivanje nulama, mo≈æemo postiƒái situaciju dvostrukog osloboƒëavanja:
* Alociramo tri bloka veliƒçine `0x110` (`A`, `B`, `C`)
* Oslobaƒëamo `B`
* Oslobaƒëamo `A` i ponovo alociramo da bismo iskoristili prelivanje nulama
* Sada je veliƒçina polja `B` `0x100`, umesto `0x111`, tako da ga mo≈æemo ponovo osloboditi
* Imamo jedan Tcache-bin veliƒçine `0x110` i jedan veliƒçine `0x100` koji pokazuju na istu adresu. Dakle, imamo dvostruko osloboƒëavanje.
* Iskori≈°ƒáavamo dvostruko osloboƒëavanje koristeƒái [Tcache trovanje](tcache-bin-attack.md)

## Reference

* [https://heap-exploitation.dhavalkapil.com/attacks/double\_free](https://heap-exploitation.dhavalkapil.com/attacks/double\_free)

<details>

<summary><strong>Nauƒçite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naƒçini podr≈°ke HackTricks-u:

* Ako ≈æelite da vidite **va≈°u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**PLANOVE ZA PRIJAVU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniƒçni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), na≈°u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridru≈æite se** üí¨ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili **telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
