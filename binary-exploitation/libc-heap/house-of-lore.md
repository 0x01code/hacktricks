# House of Lore | Small bin Attack

<details>

<summary><strong>제로부터 히어로가 되는 방법으로 AWS 해킹 배우기</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team 전문가)</strong></a><strong>!</strong></summary>

HackTricks를 지원하는 다른 방법:

* **회사가 HackTricks에 광고되길 원하거나** **HackTricks를 PDF로 다운로드**하려면 [**구독 요금제**](https://github.com/sponsors/carlospolop)를 확인하세요!
* [**공식 PEASS & HackTricks 스왜그**](https://peass.creator-spring.com)를 구매하세요
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)를 발견하세요, 당사의 독점 [**NFTs**](https://opensea.io/collection/the-peass-family) 컬렉션
* **💬 [**Discord 그룹**](https://discord.gg/hRep4RUj7f)에 가입하거나 [**텔레그램 그룹**](https://t.me/peass)에 가입하거나** **트위터** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**를 팔로우하세요.**
* **해킹 요령을 공유하려면** [**HackTricks**](https://github.com/carlospolop/hacktricks) 및 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github 저장소로 PR을 제출하세요.

</details>

## 기본 정보

### 코드

* [https://ctf-wiki.mahaloz.re/pwn/linux/glibc-heap/house\_of\_lore/](https://ctf-wiki.mahaloz.re/pwn/linux/glibc-heap/house\_of\_lore/)에서 확인
* 작동하지 않음
* 또는: [https://github.com/shellphish/how2heap/blob/master/glibc\_2.39/house\_of\_lore.c](https://github.com/shellphish/how2heap/blob/master/glibc\_2.39/house\_of\_lore.c)
* 이것도 작동하지 않음. 오류가 발생함: `malloc(): unaligned tcache chunk detected`
* 이 예제는 여전히 작동 중: [**https://guyinatuxedo.github.io/40-house\_of\_lore/house\_lore\_exp/index.html**](https://guyinatuxedo.github.io/40-house\_of\_lore/house\_lore\_exp/index.html)&#x20;

### 목표

* **작은 bin에 가짜 small chunk를 삽입하여 할당할 수 있도록** 함.\
작성된 small chunk는 공격자가 만든 가짜이며 임의 위치에 있는 가짜가 아님에 유의하십시오.

### 요구 사항

* 2개의 가짜 chunk를 생성하고 연결하고 작은 bin의 합법적인 chunk와 함께 연결:
* `fake0.bk` -> `fake1`
* `fake1.fd` -> `fake0`
* `fake0.fd` -> `legit` (다른 취약점을 통해 해제된 small bin chunk의 포인터를 수정해야 함)
* `legit.bk` -> `fake0`

그럼 `fake0`를 할당할 수 있게 됩니다.

### 공격

* 작은 chunk(`legit`)가 할당되고, 다른 chunk가 최상위 chunk와 병합되는 것을 방지하기 위해 또 다른 chunk가 할당됩니다. 그런 다음, `legit`이 해제되어(unsorted bin 목록으로 이동) 더 큰 chunk가 할당되어 **`legit`이 small bin으로 이동됩니다.**
* 공격자는 몇 개의 가짜 small chunk를 생성하고 필요한 링크를 만들어 정상성 검사를 우회합니다:
* `fake0.bk` -> `fake1`
* `fake1.fd` -> `fake0`
* `fake0.fd` -> `legit` (다른 취약점을 통해 해제된 small bin chunk의 포인터를 수정해야 함)
* `legit.bk` -> `fake0`
* 작은 chunk가 할당되어 legit을 얻고, **`fake0`**이 small bin의 최상위 목록으로 이동됩니다.
* 다른 작은 chunk가 할당되어 `fake0`이 chunk로 얻어져, 내부의 포인터를 읽거나 쓸 수 있게 됩니다.

## 참고 자료

* [https://ctf-wiki.mahaloz.re/pwn/linux/glibc-heap/house\_of\_lore/](https://ctf-wiki.mahaloz.re/pwn/linux/glibc-heap/house\_of\_lore/)
* [https://heap-exploitation.dhavalkapil.com/attacks/house\_of\_lore](https://heap-exploitation.dhavalkapil.com/attacks/house\_of\_lore)
* [https://guyinatuxedo.github.io/40-house\_of\_lore/house\_lore\_exp/index.html](https://guyinatuxedo.github.io/40-house\_of\_lore/house\_lore\_exp/index.html)

<details>

<summary><strong>제로부터 히어로가 되는 방법으로 AWS 해킹 배우기</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team 전문가)</strong></a><strong>!</strong></summary>

HackTricks를 지원하는 다른 방법:

* **회사가 HackTricks에 광고되길 원하거나** **HackTricks를 PDF로 다운로드**하려면 [**구독 요금제**](https://github.com/sponsors/carlospolop)를 확인하세요!
* [**공식 PEASS & HackTricks 스왜그**](https://peass.creator-spring.com)를 구매하세요
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)를 발견하세요, 당사의 독점 [**NFTs**](https://opensea.io/collection/the-peass-family) 컬렉션
* **💬 [**Discord 그룹**](https://discord.gg/hRep4RUj7f)에 가입하거나 [**텔레그램 그룹**](https://t.me/peass)에 가입하거나** **트위터** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**를 팔로우하세요.**
* **해킹 요령을 공유하려면** [**HackTricks**](https://github.com/carlospolop/hacktricks) 및 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github 저장소로 PR을 제출하세요.

</details>
