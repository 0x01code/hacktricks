# рдЕрдирд▓рд┐рдВрдХ

<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

рджреВрд╕рд░реЗ рддрд░реАрдХреЗ HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП:

* рдЕрдЧрд░ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рдХрд▓реЗрдХреНрд╢рди, [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдЦреЛрдЬреЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВред

</details>

### рдХреЛрдб
```c
// From https://github.com/bminor/glibc/blob/master/malloc/malloc.c

/* Take a chunk off a bin list.  */
static void
unlink_chunk (mstate av, mchunkptr p)
{
if (chunksize (p) != prev_size (next_chunk (p)))
malloc_printerr ("corrupted size vs. prev_size");

mchunkptr fd = p->fd;
mchunkptr bk = p->bk;

if (__builtin_expect (fd->bk != p || bk->fd != p, 0))
malloc_printerr ("corrupted double-linked list");

fd->bk = bk;
bk->fd = fd;
if (!in_smallbin_range (chunksize_nomask (p)) && p->fd_nextsize != NULL)
{
if (p->fd_nextsize->bk_nextsize != p
|| p->bk_nextsize->fd_nextsize != p)
malloc_printerr ("corrupted double-linked list (not small)");

// Added: If the FD is not in the nextsize list
if (fd->fd_nextsize == NULL)
{

if (p->fd_nextsize == p)
fd->fd_nextsize = fd->bk_nextsize = fd;
else
// Link the nexsize list in when removing the new chunk
{
fd->fd_nextsize = p->fd_nextsize;
fd->bk_nextsize = p->bk_nextsize;
p->fd_nextsize->bk_nextsize = fd;
p->bk_nextsize->fd_nextsize = fd;
}
}
else
{
p->fd_nextsize->bk_nextsize = p->bk_nextsize;
p->bk_nextsize->fd_nextsize = p->fd_nextsize;
}
}
}
```
### рдЪрд┐рддреНрд░рд┐рдд рд╕реНрдкрд╖реНрдЯреАрдХрд░рдг

рдЬрд╛рдВрдЪреЗрдВ рдЗрд╕ unlink рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рд╢рд╛рдирджрд╛рд░ рдЪрд┐рддреНрд░рд┐рдд рд╕реНрдкрд╖реНрдЯреАрдХрд░рдг рдХреЛ:

<figure><img src="../../../.gitbook/assets/image (3).png" alt=""><figcaption><p><a href="https://ctf-wiki.mahaloz.re/pwn/linux/glibc-heap/implementation/figure/unlink_smallbin_intro.png">https://ctf-wiki.mahaloz.re/pwn/linux/glibc-heap/implementation/figure/unlink_smallbin_intro.png</a></p></figcaption></figure>

### рд╕реБрд░рдХреНрд╖рд╛ рдЬрд╛рдВрдЪ

* рдЬрд╛рдВрдЪреЗрдВ рдХрд┐ рдЯреБрдХрдбрд╝реЗ рдХрд╛ рд╕рдВрдХреЗрддрд┐рдд рдЖрдХрд╛рд░ рдЕрдЧрд▓реЗ рдЯреБрдХрдбрд╝реЗ рдореЗрдВ рд╕рдВрдХреЗрддрд┐рдд рдкрд┐рдЫрд▓реЗ_рдЖрдХрд╛рд░ рдХреЗ рд╕рдорд╛рди рд╣реИ
* рдпрд╣ рднреА рдЬрд╛рдВрдЪреЗрдВ рдХрд┐ `P->fd->bk == P` рдФрд░ `P->bk->fw == P`
* рдЕрдЧрд░ рдЯреБрдХрдбрд╝рд╛ рдЫреЛрдЯрд╛ рдирд╣реАрдВ рд╣реИ, рддреЛ рдЬрд╛рдВрдЪреЗрдВ рдХрд┐ `P->fd_nextsize->bk_nextsize == P` рдФрд░ `P->bk_nextsize->fd_nextsize == P`

### рд▓реАрдХреНрд╕

рдПрдХ рдЕрдирд▓рд┐рдВрдХ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдЯреБрдХрдбрд╝рд╛ рдЖрд╡рдВрдЯрд┐рдд рдкрддреЛрдВ рдХреЛ рд╕рд╛рдл рдирд╣реАрдВ рдХрд░ рд░рд╣рд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЙрд╕реЗ рдкрдврд╝рдиреЗ рдХреА рдкрд╣реБрдВрдЪ рд╣реЛрдиреЗ рдкрд░ рдХреБрдЫ рджрд┐рд▓рдЪрд╕реНрдк рдкрддреЛрдВ рдХреЛ рд▓реАрдХ рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИ:

Libc рд▓реАрдХреНрд╕:

* рдЕрдЧрд░ P рдбрдмрд▓реА рд▓рд┐рдВрдХреНрдб рд╕реВрдЪреА рдХреЗ рд╢реАрд░реНрд╖ рдореЗрдВ рд╕реНрдерд┐рдд рд╣реИ, рддреЛ `bk` `libc` рдореЗрдВ `malloc_state` рдХреЛ рдкреЙрдЗрдВрдЯ рдХрд░реЗрдЧрд╛
* рдЕрдЧрд░ P рдбрдмрд▓реА рд▓рд┐рдВрдХреНрдб рд╕реВрдЪреА рдХреЗ рдЕрдВрдд рдореЗрдВ рд╕реНрдерд┐рдд рд╣реИ, рддреЛ `fd` `libc` рдореЗрдВ `malloc_state` рдХреЛ рдкреЙрдЗрдВрдЯ рдХрд░реЗрдЧрд╛
* рдЬрдм рдбрдмрд▓реА рд▓рд┐рдВрдХреНрдб рд╕реВрдЪреА рдореЗрдВ рдХреЗрд╡рд▓ рдПрдХ рдлреНрд░реА рдЯреБрдХрдбрд╝рд╛ рд╣реЛрддрд╛ рд╣реИ, P рдбрдмрд▓реА рд▓рд┐рдВрдХреНрдб рд╕реВрдЪреА рдореЗрдВ рд╣реЛрддрд╛ рд╣реИ, рдФрд░ рджреЛрдиреЛрдВ `fd` рдФрд░ `bk` `malloc_state` рдХреЗ рдЕрдВрджрд░ рдкрддреЗ рдХреЛ рд▓реАрдХ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

рд╣реАрдк рд▓реАрдХреНрд╕:

* рдЕрдЧрд░ P рдбрдмрд▓реА рд▓рд┐рдВрдХреНрдб рд╕реВрдЪреА рдХреЗ рд╢реАрд░реНрд╖ рдореЗрдВ рд╕реНрдерд┐рдд рд╣реИ, рддреЛ `fd` рд╣реАрдк рдореЗрдВ рдПрдХ рдЙрдкрд▓рдмреНрдз рдЯреБрдХрдбрд╝реЗ рдХреЛ рдкреЙрдЗрдВрдЯ рдХрд░реЗрдЧрд╛
* рдЕрдЧрд░ P рдбрдмрд▓реА рд▓рд┐рдВрдХреНрдб рд╕реВрдЪреА рдХреЗ рдЕрдВрдд рдореЗрдВ рд╕реНрдерд┐рдд рд╣реИ, рддреЛ `bk` рд╣реАрдк рдореЗрдВ рдПрдХ рдЙрдкрд▓рдмреНрдз рдЯреБрдХрдбрд╝реЗ рдХреЛ рдкреЙрдЗрдВрдЯ рдХрд░реЗрдЧрд╛
* рдЕрдЧрд░ P рдбрдмрд▓реА рд▓рд┐рдВрдХреНрдб рд╕реВрдЪреА рдореЗрдВ рд╣реИ, рддреЛ рджреЛрдиреЛрдВ `fd` рдФрд░ `bk` рд╣реАрдк рдореЗрдВ рдПрдХ рдЙрдкрд▓рдмреНрдз рдЯреБрдХрдбрд╝реЗ рдХреЛ рдкреЙрдЗрдВрдЯ рдХрд░реЗрдВрдЧреЗ
