# Provere bezbednosti funkcija hipa

<details>

<summary><strong>Naučite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi načini podrške HackTricks-u:

* Ako želite da vidite svoju **kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**PLANOVE ZA PRIJAVU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvanični PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**Porodicu PEASS**](https://opensea.io/collection/the-peass-family), našu kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridružite se** 💬 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

## unlink

Za više informacija pogledajte:

{% content-ref url="unlink.md" %}
[unlink.md](unlink.md)
{% endcontent-ref %}

Ovo je sažetak izvršenih provera:

* Proverite da li je naznačena veličina bloka ista kao `prev_size` naznačena u sledećem bloku
* Poruka greške: `corrupted size vs. prev_size`
* Proverite takođe da li `P->fd->bk == P` i `P->bk->fw == P`
* Poruka greške: `corrupted double-linked list`
* Ako blok nije mali, proverite da li `P->fd_nextsize->bk_nextsize == P` i `P->bk_nextsize->fd_nextsize == P`
* Poruka greške: `corrupted double-linked list (not small)`

## \_int\_malloc

Za više informacija pogledajte:

{% content-ref url="malloc-and-sysmalloc.md" %}
[malloc-and-sysmalloc.md](malloc-and-sysmalloc.md)
{% endcontent-ref %}

* **Provere tokom pretrage brzih binova:**
* Ako je blok neusklađen:
* Poruka greške: `malloc(): unaligned fastbin chunk detected 2`
* Ako je sledeći blok neusklađen:
* Poruka greške: `malloc(): unaligned fastbin chunk detected`
* Ako vraćeni blok ima veličinu koja nije ispravna zbog njegovog indeksa u brzom binu:
* Poruka greške: `malloc(): memory corruption (fast)`
* Ako je bilo koji blok korišćen za popunjavanje tcache-a neusklađen:
* Poruka greške: `malloc(): unaligned fastbin chunk detected 3`
* **Provere tokom pretrage malih binova:**
* Ako `victim->bk->fd != victim`:
* Poruka greške: `malloc(): smallbin double linked list corrupted`
* **Provere tokom konsolidacije** izvršene za svaki brzi bin blok:&#x20;
* Ako je blok neusklađen pokreni:
* Poruka greške: `malloc_consolidate(): unaligned fastbin chunk detected`
* Ako blok ima drugačiju veličinu od one koju bi trebalo zbog indeksa u kojem se nalazi:
* Poruka greške: `malloc_consolidate(): invalid chunk size`
* Ako prethodni blok nije u upotrebi i prethodni blok ima veličinu različitu od one naznačene od strane prev\_chunk:
* Poruka greške: `corrupted size vs. prev_size in fastbins`
* **Provere tokom pretrage nesortiranih binova**:
* Ako je veličina bloka čudna (previše mala ili previše velika):&#x20;
* Poruka greške: `malloc(): invalid size (unsorted)`
* Ako je veličina sledećeg bloka čudna (previše mala ili previše velika):
* Poruka greške: `malloc(): invalid next size (unsorted)`
* Ako veličina prethodnog bloka naznačena od strane sledećeg bloka se razlikuje od veličine bloka:
* Poruka greške: `malloc(): mismatching next->prev_size (unsorted)`
* Ako nije `victim->bck->fd == victim` ili nije `victim->fd == av (arena)`:
* Poruka greške: `malloc(): unsorted double linked list corrupted`
* Pošto uvek proveravamo poslednji, njegov fd bi uvek trebalo da pokazuje na strukturu arene.
* Ako sledeći blok ne pokazuje da je prethodni u upotrebi:
* Poruka greške: `malloc(): invalid next->prev_inuse (unsorted)`
* Ako `fwd->bk_nextsize->fd_nextsize != fwd`:
* Poruka greške: `malloc(): largebin double linked list corrupted (nextsize)`
* Ako `fwd->bk->fd != fwd`:
* Poruka greške: `malloc(): largebin double linked list corrupted (bk)`
* **Provere tokom pretrage velikih binova (po indeksu):**
* `bck->fd-> bk != bck`:
* Poruka greške: `malloc(): corrupted unsorted chunks`
* **Provere tokom pretrage velikih binova (sledeći veći):**
* `bck->fd-> bk != bck`:
* Poruka greške: `malloc(): corrupted unsorted chunks2`
* **Provere tokom korišćenja vrhunskog bloka:**
* `chunksize(av->top) > av->system_mem`:
* Poruka greške: `malloc(): corrupted top size`

## `tcache_get_n`

* **Provere u `tcache_get_n`:**
* Ako je blok neusklađen:
* Poruka greške: `malloc(): unaligned tcache chunk detected`

## `tcache_thread_shutdown`

* **Provere u `tcache_thread_shutdown`:**
* Ako je blok neusklađen:
* Poruka greške: `tcache_thread_shutdown(): unaligned tcache chunk detected`

## `__libc_realloc`

* **Provere u `__libc_realloc`:**
* Ako je stari pokazivač neusklađen ili je veličina bila netačna:
* Poruka greške: `realloc(): invalid pointer`

## `_int_free`

Za više informacija pogledajte:

{% content-ref url="free.md" %}
[free.md](free.md)
{% endcontent-ref %}

* **Provere tokom početka `_int_free`:**
* Pokazivač je usklađen:
* Poruka greške: `free(): invalid pointer`
* Veličina veća od `MINSIZE` i takođe usklađena:
* Poruka greške: `free(): invalid size`
* **Provere u `_int_free` tcache-u:**
* Ako ima više unosa od `mp_.tcache_count`:
* Poruka greške: `free(): too many chunks detected in tcache`
* Ako unos nije usklađen:
* Poruka greške: `free(): unaligned chunk detected in tcache 2`
* Ako je oslobođeni blok već bio oslobođen i prisutan je kao blok u tcache-u:
* Poruka greške: `free(): double free detected in tcache 2`
* **Provere u `_int_free` brzom binu:**
* Ako je veličina bloka neispravna (previše velika ili mala) pokreni:
* Poruka greške: `free(): invalid next size (fast)`
* Ako je dodati blok već bio na vrhu brzog bina:
* Poruka greške: `double free or corruption (fasttop)`
* Ako veličina bloka na vrhu ima drugačiju veličinu od bloka koji dodajemo:
* Poruka greške: `invalid fastbin entry (free)`
## **`_int_free_merge_chunk`**

* **Provere u `_int_free_merge_chunk`:**
* Ako je chunk vrhunski chunk:
* Poruka o grešci: `double free or corruption (top)`
* Ako je sledeći chunk van granica arene:
* Poruka o grešci: `double free or corruption (out)`
* Ako chunk nije označen kao korišćen (u prev\_inuse od sledećeg chunk-a):
* Poruka o grešci: `double free or corruption (!prev)`
* Ako sledeći chunk ima previše malu ili previše veliku veličinu:
* Poruka o grešci: `free(): invalid next size (normal)`
* Ako prethodni chunk nije u upotrebi, pokušaće da konsoliduje. Ali, ako se `prev_size` razlikuje od veličine navedene u prethodnom chunk-u:
* Poruka o grešci: `corrupted size vs. prev_size while consolidating`

## **`_int_free_create_chunk`**

* **Provere u `_int_free_create_chunk`:**
* Dodavanje chunk-a u nesortirani bin, provera da li je `unsorted_chunks(av)->fd->bk == unsorted_chunks(av)`:
* Poruka o grešci: `free(): corrupted unsorted chunks`

## `do_check_malloc_state`

* **Provere u `do_check_malloc_state`:**
* Ako je fast bin chunk nepravilno poravnat:
* Poruka o grešci: `do_check_malloc_state(): unaligned fastbin chunk detected`

## `malloc_consolidate`

* **Provere u `malloc_consolidate`:**
* Ako je fast bin chunk nepravilno poravnat:
* Poruka o grešci: `malloc_consolidate(): unaligned fastbin chunk detected`
* Ako je nepravilna veličina fast bin chunk-a:
* Poruka o grešci: `malloc_consolidate(): invalid chunk size`

## `_int_realloc`

* **Provere u `_int_realloc`:**
* Veličina je previše velika ili previše mala:
* Poruka o grešci: `realloc(): invalid old size`
* Veličina sledećeg chunk-a je previše velika ili previše mala:
* Poruka o grešci: `realloc(): invalid next size`

<details>

<summary><strong>Naučite hakovanje AWS-a od početka do naprednog nivoa sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi načini podrške HackTricks-u:

* Ako želite da vidite **vašu kompaniju reklamiranu na HackTricks-u** ili da **preuzmete HackTricks u PDF formatu** Proverite [**PLANOVE ZA PRETPLATU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvanični PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), našu kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridružite se** 💬 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili **telegram grupi** ili nas **pratite** na **Twitter-u** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
