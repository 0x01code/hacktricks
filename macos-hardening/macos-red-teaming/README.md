# macOS рд░реЗрдб рдЯреАрдорд┐рдВрдЧ

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>тШБя╕П HackTricks Cloud тШБя╕П</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ЁЯРж Twitter ЁЯРж</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ЁЯОЩя╕П Twitch ЁЯОЩя╕П</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ЁЯОе Youtube ЁЯОе</strong></a></summary>

* рдХреНрдпрд╛ рдЖрдк рдХрд┐рд╕реА **рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХрдВрдкрдиреА** рдореЗрдВ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ? рдХреНрдпрд╛ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХреЛ HackTricks рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд** рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ? рдпрд╛ рдХреНрдпрд╛ рдЖрдкрдХреЛ **PEASS рдХреЗ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рдХрд╛ рдЙрдкрдпреЛрдЧ** рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ? [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ!
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рдПрдХрд▓ [**NFT**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks swag**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**ЁЯТм**](https://emojipedia.org/speech-balloon/) [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ рдореБрдЭреЗ **Twitter** [**ЁЯРж**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)** рдХрд╛** **рдЕрдиреБрд╕рд░рдг** рдХрд░реЗрдВред**
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рдХреЛ** [**hacktricks рд░реЗрдкреЛ**](https://github.com/carlospolop/hacktricks) **рдФрд░** [**hacktricks-cloud рд░реЗрдкреЛ**](https://github.com/carlospolop/hacktricks-cloud) **рдореЗрдВ рдкреАрдЖрд░ рдЬрдорд╛ рдХрд░рдХреЗ рдЕрдкрдирд╛ рдпреЛрдЧрджрд╛рди рджреЗрдВред**

</details>

## MDM рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ

* JAMF Pro: `jamf checkJSSConnection`
* Kandji

рдпрджрд┐ рдЖрдк **рд╡реНрдпрд╡рд╕реНрдерд╛рдкрди рдкреНрд▓реЗрдЯрдлрд╝реЙрд░реНрдо рддрдХ рдкреНрд░рд╢рд╛рд╕рдирд┐рдХ рдкреНрд░рдорд╛рдгрд┐рдХрд╛** рдХреЛ рд╕рдВрдХреНрд░рдорд┐рдд рдХрд░рдиреЗ рдореЗрдВ рд╕рдлрд▓ рд╣реЛрддреЗ рд╣реИрдВ, рддреЛ рдЖрдк **рд╕рдВрднрд╛рд╡рд┐рдд рд░реВрдк рд╕реЗ рд╕рднреА рдХрдВрдкреНрдпреВрдЯрд░реЛрдВ рдХреЛ рд╕рдВрдХреНрд░рдорд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ** рдЕрдкрдиреЗ рдореИрд▓рд╡реЗрдпрд░ рдХреЛ рдорд╢реАрдиреЛрдВ рдореЗрдВ рд╡рд┐рддрд░рд┐рдд рдХрд░рдХреЗред

MacOS рдкрд░ рд░реЗрдб рдЯреАрдорд┐рдВрдЧ рдХреЗ рд▓рд┐рдП MDM рдХреЗ рдХрд╛рдо рдХрд░рдиреЗ рдХреА рдХреБрдЫ рд╕рдордЭ рд╣реЛрдирд╛ рдЕрддреНрдпрдВрдд рдЕрдиреБрд╢рдВрд╕рд┐рдд рд╣реИ:

{% content-ref url="macos-mdm/" %}
[macos-mdm](macos-mdm/)
{% endcontent-ref %}

### MDM рдХрд╛ рдЙрдкрдпреЛрдЧ C2 рдХреЗ рд░реВрдк рдореЗрдВ

MDM рдХреЛ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд╣реЛрдЧреА, рдкреНрд░реЛрдлрд╝рд╛рдЗрд▓ рд╕реНрдерд╛рдкрд┐рдд, рдкреНрд░рд╢реНрди рдХрд░реЗрдВ рдпрд╛ рд╣рдЯрд╛рдПрдВ, рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд╕реНрдерд╛рдкрд┐рдд рдХрд░реЗрдВ, рд╕реНрдерд╛рдиреАрдп рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рдЦрд╛рддреЗ рдмрдирд╛рдПрдВ, рдлрд░реНрдорд╡реЗрдпрд░реНрдЯ рдкрд╛рд╕рд╡рд░реНрдб рд╕реЗрдЯ рдХрд░реЗрдВ, рдлрд╝рд╛рдЗрд▓рд╡реЙрд▓реНрдЯ рдХреБрдВрдЬреА рдмрджрд▓реЗрдВ...

рдЕрдкрдиреЗ рдЦреБрдж рдХреЗ MDM рдХреЛ рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ рдПрдХ рд╡рд┐рдХреНрд░реЗрддрд╛ рджреНрд╡рд╛рд░рд╛ **рдЖрдкрдХреЗ рд╕реАрдПрд╕рдЖрд░ рдХреЛ рд╕рд╛рдЗрди рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреА** рдЬрд┐рд╕реЗ рдЖрдк [**https://mdmcert.download/**](https://mdmcert.download/) рд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдФрд░ Apple рдЙрдкрдХрд░рдгреЛрдВ рдХреЗ рд▓рд┐рдП рдЕрдкрдиреЗ рдЦреБрдж рдХреЗ MDM рдХреЛ рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдк [**MicroMDM**](https://github.com/micromdm/micromdm) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

рд╣рд╛рд▓рд╛рдВрдХрд┐, рдПрдХ рдирд╛рдорд┐рдд рдЦрд╛рддреЗ рджреНрд╡рд╛рд░рд╛ рд╣рд╕реНрддрд╛рдХреНрд╖рд░рд┐рдд рдПрдХ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ рдЕрднреА рднреА рдЗрд╕рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ... рд╣рд╛рд▓рд╛рдВрдХрд┐, MDM рдирд╛рдорд╛рдВрдХрди рдХреЗ рдмрд╛рдж, **рдЙрдкрдХрд░рдг MDM рдХрд╛ SSL рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдПрдХ рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рд╕реАрдП рд░реВрдк рдореЗрдВ рдЬреЛрдбрд╝рддрд╛ рд╣реИ**, рдЗрд╕рд▓рд┐рдП рдЕрдм рдЖрдк рдХреБрдЫ рднреА рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

рдПрдХ MDM рдореЗрдВ рдЙрдкрдХрд░рдг рдХреЛ рдирд╛рдорд╛рдВрдХрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ рдПрдХ **`mobileconfig`** рдлрд╝рд╛рдЗрд▓ рдХреЛ рд░реВрдЯ рдХреЗ рд░реВрдк рдореЗрдВ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ, рдЬрд┐рд╕реЗ рдПрдХ **pkg** рдлрд╝рд╛рдЗрд▓ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╡рд┐рддрд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ (рдЖрдк рдЗрд╕реЗ zip рдореЗрдВ рд╕рдВрдкреАрдбрд╝рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЬрдм рдЖрдк рд╕рдлрд╛рд░реА рд╕реЗ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рддреЗ рд╣реИрдВ рддреЛ рдпрд╣ рдЕрдирдкреНрд░реЗрд╕ рд╣реЛ рдЬрд╛рдПрдЧрд╛)ред

**Mythic рдПрдЬреЗрдВрдЯ Orthrus** рдЗрд╕ рддрдХрдиреАрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред

### JAMF PRO рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ

JAMF рдХрд╕реНрдЯрдо рд╕реНрдХреНрд░рд┐рдкреНрдЯ (рд╕рд┐рд╕реНрдЯрдо рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рджреНрд╡рд╛рд░рд╛ рд╡рд┐рдХрд╕рд┐рдд рд╕реНрдХреНрд░рд┐рдкреНрдЯ), рдиреЗрдЯрд┐рд╡ рдкреЗрд▓реЛрдб (рд╕реНрдерд╛рдиреАрдп рдЦрд╛рддрд╛ рдмрдирд╛рдирд╛, EFI рдкрд╛рд╕рд╡рд░реНрдб рд╕реЗрдЯ рдХрд░рдирд╛, рдлрд╝рд╛рдЗрд▓/рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЙрдирд┐рдЯрд░рд┐рдВрдЧ...) рдФрд░ MDM (рдЙрдкрдХрд░рдг рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди, рдЙрдкрдХрд░рдг рдкреНрд░рдорд╛рдгрдкрддреНрд░...) рдЪрд▓рд╛ рд╕рдХрддрд╛ рд╣реИред

#### JAMF рд╕реНрд╡рдпрдВ-рдирд╛рдорд╛рдВрдХрди

рдпрджрд┐ рдЙрдирдореЗрдВ **рд╕реНрд╡рдпрдВ-рдирд╛рдорд╛рдВрдХрди рд╕рдХреНрд╖рдо рд╣реИ**, рддреЛ `https://<company-name>.jamfcloud.com/enroll/` рдЬреИрд╕реА рдкреЗрдЬ рдкрд░ рдЬрд╛рдПрдВ рдФрд░ рджреЗрдЦреЗрдВ рдХрд┐ рдХреНрдпрд╛ рдЙрдирдореЗрдВ **рдкреНрд░рдорд╛рдгрд┐рдХрд╛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкреНрд░рдорд╛рдгреЛрдВ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ**ред

рдЖрдк [**JamfSniper.py**](https://github.com/WithSecureLabs/Jamf-Attack-Toolkit/blob/master/JamfSniper.py) рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкрд╛рд╕рд╡рд░реНрдб рд╕реНрдкреНрд░реЗ рдХрд░рдиреЗ рдХреА рд╣рдорд▓рд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЙрдЪрд┐рдд рдкреНрд░рдорд╛рдгрд┐рдХрд╛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж рдЖрдк рдЕрдиреНрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдореЛрдВ рдХреЛ рдмреНрд░реВрдЯ-рдлрд╝реЛрд░
```bash
plutil -convert xml1 -o - /Library/Preferences/com.jamfsoftware.jamf.plist

[...]
<key>is_virtual_machine</key>
<false/>
<key>jss_url</key>
<string>https://halbornasd.jamfcloud.com/</string>
<key>last_management_framework_change_id</key>
<integer>4</integer>
[...]
```
{% endcode %}

рддреЛ, рдПрдХ рд╣рдорд▓рд╛рд╡рд░реНрдзреА рдпрд╣ рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдХреА рд╡рд╣ рдПрдХ рджреБрд╖реНрдкреНрд░рднрд╛рд╡реА рдкреИрдХреЗрдЬ (`pkg`) рдбреНрд░реЙрдк рдХрд░реЗ рдЬреЛ рдЗрдВрд╕реНрдЯреЙрд▓ рд╣реЛрддреЗ рд╕рдордп рдЗрд╕ рдлрд╝рд╛рдЗрд▓ рдХреЛ **рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд░ рджреЗрддрд╛ рд╣реИ** рдФрд░ рдЕрдм JAMF рдХреЛ C2 рдХреЗ рд░реВрдк рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ Mythic C2 рд╕реБрдирдиреЗ рд╡рд╛рд▓реЗ Typhon рдПрдЬреЗрдВрдЯ рдХреЗ URL рдХреЛ рд╕реЗрдЯ рдХрд░ рд╕рдХрддрд╛ рд╣реИред

{% code overflow="wrap" %}
```bash
# After changing the URL you could wait for it to be reloaded or execute:
sudo jamf policy -id 0

# TODO: There is an ID, maybe it's possible to have the real jamf connection and another one to the C2
```
{% endcode %}

#### JAMF рдЕрдиреБрдХрд░рдг

рдПрдХ рдЙрдкрдХрд░рдг рдФрд░ JMF рдХреЗ рдмреАрдЪ **рд╕рдВрдЪрд╛рд░ рдХрд╛ рдЕрдиреБрдХрд░рдг** рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЪреАрдЬреЗрдВ рдЪрд╛рд╣рд┐рдП:

* рдЙрдкрдХрд░рдг рдХрд╛ **UUID**: `ioreg -d2 -c IOPlatformExpertDevice | awk -F" '/IOPlatformUUID/{print $(NF-1)}'`
* **JAMF keychain**: `/Library/Application\ Support/Jamf/JAMF.keychain` рдЬрд┐рд╕рдореЗрдВ рдЙрдкрдХрд░рдг рдкреНрд░рдорд╛рдгрдкрддреНрд░ рд╣реЛрддрд╛ рд╣реИ

рдЗрд╕ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд╕рд╛рде, **рдЪреЛрд░реА рдХреА рдЧрдИ** рд╣рд╛рд░реНрдбрд╡реЗрдпрд░ **UUID** рдФрд░ **SIP рдЕрдХреНрд╖рдо** рдХреЗ рд╕рд╛рде рдПрдХ VM **рдмрдирд╛рдПрдВ**, **JAMF keychain** рдХреЛ **рдЫреЛрдбрд╝реЗрдВ**, Jamf **рдПрдЬреЗрдВрдЯ** рдХреЛ **рд╣реБрдХ** рдХрд░реЗрдВ рдФрд░ рдЗрд╕рдХреА рдЬрд╛рдирдХрд╛рд░реА рдЪреБрд░рд╛ рд▓реЗрдВред

#### рд░рд╣рд╕реНрдпреЛрдВ рдХреА рдЪреЛрд░реА

<figure><img src="../../.gitbook/assets/image (11).png" alt=""><figcaption><p>a</p></figcaption></figure>

рдЖрдк рдпрд╣ рднреА рдореЙрдирд┐рдЯрд░ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ `/Library/Application Support/Jamf/tmp/` рдХреЛ рдЬрд╣рд╛рдВ **рдХрд╕реНрдЯрдо рд╕реНрдХреНрд░рд┐рдкреНрдЯ** рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рдЬрдореНрдл рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рдХреНрдпреЛрдВрдХрд┐ рд╡реЗ рдпрд╣рд╛рдВ **рд░рдЦреЗ рдЬрд╛рддреЗ рд╣реИрдВ, рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ рдФрд░ рд╣рдЯрд╛ рджрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ**ред рдЗрди рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдореЗрдВ **рдкреНрд░рдорд╛рдгрдкрддреНрд░** рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред

рд╣рд╛рд▓рд╛рдВрдХрд┐, **рдкреНрд░рдорд╛рдгрдкрддреНрд░** рдЗрди рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЗ **рдкреИрд░рд╛рдореАрдЯрд░** рдХреЗ рд░реВрдк рдореЗрдВ рдкрд╛рд╕ рдХрд┐рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рдЖрдкрдХреЛ `ps aux | grep -i jamf` (рдмрд┐рдирд╛ рд░реВрдЯ рд╣реЛрдиреЗ рдХреЗ рднреА) рдореЙрдирд┐рдЯрд░ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреАред

рд╕реНрдХреНрд░рд┐рдкреНрдЯ [**JamfExplorer.py**](https://github.com/WithSecureLabs/Jamf-Attack-Toolkit/blob/master/JamfExplorer.py) рдирдП рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЗ рдЬреЛрдбрд╝реЗ рдЬрд╛рдиреЗ рдФрд░ рдирдП рдкреНрд░рдХреНрд░рд┐рдпрд╛ рддрд░реНрдХреЛрдВ рдХреЗ рд▓рд┐рдП рд╕реБрди рд╕рдХрддрд╛ рд╣реИред

### macOS рджреВрд░рд╕реНрде рдкрд╣реБрдБрдЪ

рдФрд░ рднреА **MacOS** "рд╡рд┐рд╢реЗрд╖" **рдиреЗрдЯрд╡рд░реНрдХ** **рдкреНрд░реЛрдЯреЛрдХреЙрд▓** рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ:

{% content-ref url="../macos-security-and-privilege-escalation/macos-protocols.md" %}
[macos-protocols.md](../macos-security-and-privilege-escalation/macos-protocols.md)
{% endcontent-ref %}

## рд╕рдХреНрд░рд┐рдп рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛

рдХреБрдЫ рдореМрдХреЛрдВ рдкрд░ рдЖрдкрдХреЛ рдкрддрд╛ рдЪрд▓реЗрдЧрд╛ рдХрд┐ **MacOS рдХрдВрдкреНрдпреВрдЯрд░ рдПрдХ AD рд╕реЗ рдЬреБрдбрд╝рд╛ рд╣реБрдЖ рд╣реИ**ред рдЗрд╕ рд╕реНрдерд┐рддрд┐ рдореЗрдВ рдЖрдкрдХреЛ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХреЛ рдЬрд╛рдВрдЪрдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рдиреА рдЪрд╛рд╣рд┐рдП рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рдЗрд╕реЗ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣реЗ рд╣реИрдВред рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреГрд╖реНрдареЛрдВ рдореЗрдВ рдХреБрдЫ **рдорджрдж** рдорд┐рд▓реЗрдЧреА:

{% content-ref url="../../network-services-pentesting/pentesting-ldap.md" %}
[pentesting-ldap.md](../../network-services-pentesting/pentesting-ldap.md)
{% endcontent-ref %}

{% content-ref url="../../windows-hardening/active-directory-methodology/" %}
[active-directory-methodology](../../windows-hardening/active-directory-methodology/)
{% endcontent-ref %}

{% content-ref url="../../network-services-pentesting/pentesting-kerberos-88/" %}
[pentesting-kerberos-88](../../network-services-pentesting/pentesting-kerberos-88/)
{% endcontent-ref %}

рдХреБрдЫ **рд╕реНрдерд╛рдиреАрдп MacOS рдЯреВрд▓** рдЬреЛ рдЖрдкрдХреА рдорджрдж рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рд╣реИ `dscl`:
```bash
dscl "/Active Directory/[Domain]/All Domains" ls /
```
рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, MacOS рдХреЗ рд▓рд┐рдП рдХреБрдЫ рдЯреВрд▓ рддреИрдпрд╛рд░ рдХрд┐рдП рдЧрдП рд╣реИрдВ рдЬреЛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ AD рдХреА рдЬрд╛рдВрдЪ рдХрд░рддреЗ рд╣реИрдВ рдФрд░ kerberos рдХреЗ рд╕рд╛рде рдЦреЗрд▓рддреЗ рд╣реИрдВ:

* [**Machound**](https://github.com/XMCyber/MacHound): MacHound рдПрдХ Bloodhound рдСрдбрд┐рдЯрд┐рдВрдЧ рдЯреВрд▓ рдХрд╛ рдПрдХ рд╡рд┐рд╕реНрддрд╛рд░ рд╣реИ рдЬреЛ MacOS рд╣реЛрд╕реНрдЯ рдкрд░ Active Directory рд╕рдВрдмрдВрдзреЛрдВ рдХреЛ рд╕рдВрдЧреНрд░рд╣реАрдд рдФрд░ рдЕрд╡рд╢реЛрд╖рд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред
* [**Bifrost**](https://github.com/its-a-feature/bifrost): Bifrost рдПрдХ Objective-C рдкрд░рд┐рдпреЛрдЬрдирд╛ рд╣реИ рдЬреЛ macOS рдкрд░ Heimdal krb5 APIs рдХреЗ рд╕рд╛рде рд╕рдВрд╡рд╛рдж рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдбрд┐рдЬрд╝рд╛рдЗрди рдХреА рдЧрдИ рд╣реИред рдкрд░рд┐рдпреЛрдЬрдирд╛ рдХрд╛ рдЙрджреНрджреЗрд╢реНрдп, рд▓рдХреНрд╖реНрдп рдХреЛ рдкреВрд░рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣реИ, рдЬреЛ macOS рдЙрдкрдХрд░рдгреЛрдВ рдкрд░ Kerberos рдХреЗ рдЖрд╕рдиреА рд╕реЗ рд╕реБрд░рдХреНрд╖рд╛ рдкрд░реАрдХреНрд╖рдг рдХреЛ рд╕рдХреНрд╖рдо рдХрд░рддрд╛ рд╣реИ, рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдореЗрдВ рдХрд┐рд╕реА рдЕрдиреНрдп рдлреНрд░реЗрдорд╡рд░реНрдХ рдпрд╛ рдкреИрдХреЗрдЬ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реЛрддреА рд╣реИред
* [**Orchard**](https://github.com/its-a-feature/Orchard): Active Directory рдЬрд╛рдБрдЪ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП JavaScript for Automation (JXA) рдЯреВрд▓ред

### рдбреЛрдореЗрди рдЬрд╛рдирдХрд╛рд░реА
```bash
echo show com.apple.opendirectoryd.ActiveDirectory | scutil
```
### рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛

MacOS рдХреЗ рддреАрди рдкреНрд░рдХрд╛рд░ рдХреЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╣реЛрддреЗ рд╣реИрдВ:

* **рд╕реНрдерд╛рдиреАрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛** - рд╕реНрдерд╛рдиреАрдп рдУрдкрди рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА рд╕реЗрд╡рд╛ рджреНрд╡рд╛рд░рд╛ рдкреНрд░рдмрдВрдзрд┐рдд рд╣реЛрддреЗ рд╣реИрдВ, рд╡реЗ рдХрд┐рд╕реА рднреА рддрд░реАрдХреЗ рд╕реЗ рд╕рдХреНрд░рд┐рдп рдирд╣реАрдВ рд╣реЛрддреЗ рд╣реИрдВред
* **рдиреЗрдЯрд╡рд░реНрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛** - рд╕рдХреНрд░рд┐рдп рдирд┐рд░рдВрддрд░ рдиреЗрдЯрд╡рд░реНрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЬреЛ рдкреНрд░рдорд╛рдгрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП DC рд╕рд░реНрд╡рд░ рд╕реЗ рдХрдиреЗрдХреНрдЯ рд╣реЛрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред
* **рдореЛрдмрд╛рдЗрд▓ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛** - рд╕реНрдерд╛рдиреАрдп рдмреИрдХрдЕрдк рдХреЗ рд╕рд╛рде рд╕рдХреНрд░рд┐рдп рдирд┐рд░рдВрддрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЬрд┐рдирдХреЗ рдкрд╛рд╕ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдФрд░ рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЗ рд▓рд┐рдП рд╕реНрдерд╛рдиреАрдп рдмреИрдХрдЕрдк рд╣реЛрддрд╛ рд╣реИред

рд╕реНрдерд╛рдиреАрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдФрд░ рд╕рдореВрд╣реЛрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╕реНрдерд╛рдиреАрдп рдЬрд╛рдирдХрд╛рд░реА _/var/db/dslocal/nodes/Default_ рдлрд╝реЛрд▓реНрдбрд░ рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реЛрддреА рд╣реИред
рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, _mark_ рдирд╛рдордХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреА рдЬрд╛рдирдХрд╛рд░реА _/var/db/dslocal/nodes/Default/users/mark.plist_ рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реЛрддреА рд╣реИ рдФрд░ _admin_ рд╕рдореВрд╣ рдХреА рдЬрд╛рдирдХрд╛рд░реА _/var/db/dslocal/nodes/Default/groups/admin.plist_ рдореЗрдВ рд╣реЛрддреА рд╣реИред

**MacHound** рдмреНрд▓рдбрд╣рд╛рдЙрдВрдб рдбреЗрдЯрд╛рдмреЗрд╕ рдореЗрдВ рддреАрди рдирдП рдПрдЬреЗрдЬ рдЬреЛрдбрд╝рддрд╛ рд╣реИ:

* **CanSSH** - рд╣реЛрд╕реНрдЯ рдкрд░ SSH рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдиреЗ рд╡рд╛рд▓рд╛ рдПрдВрдЯрд┐рдЯреА
* **CanVNC** - рд╣реЛрд╕реНрдЯ рдкрд░ VNC рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдиреЗ рд╡рд╛рд▓рд╛ рдПрдВрдЯрд┐рдЯреА
* **CanAE** - рд╣реЛрд╕реНрдЯ рдкрд░ AppleEvent рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдиреЗ рд╡рд╛рд▓рд╛ рдПрдВрдЯрд┐рдЯреА
```bash
#User enumeration
dscl . ls /Users
dscl . read /Users/[username]
dscl "/Active Directory/TEST/All Domains" ls /Users
dscl "/Active Directory/TEST/All Domains" read /Users/[username]
dscacheutil -q user

#Computer enumeration
dscl "/Active Directory/TEST/All Domains" ls /Computers
dscl "/Active Directory/TEST/All Domains" read "/Computers/[compname]$"

#Group enumeration
dscl . ls /Groups
dscl . read "/Groups/[groupname]"
dscl "/Active Directory/TEST/All Domains" ls /Groups
dscl "/Active Directory/TEST/All Domains" read "/Groups/[groupname]"

#Domain Information
dsconfigad -show
```
рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП [https://its-a-feature.github.io/posts/2018/01/Active-Directory-Discovery-with-a-Mac/](https://its-a-feature.github.io/posts/2018/01/Active-Directory-Discovery-with-a-Mac/) рдкрд░ рдЬрд╛рдПрдВред

## рдХреАрдЪреЗрди рддрдХ рдкрд╣реБрдВрдЪрдирд╛

рдХреАрдЪреЗрди рдореЗрдВ рд╕рдВрднрд╛рд╡рд┐рдд рд░реВрдк рд╕реЗ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдЬрд╛рдирдХрд╛рд░реА рд╣реЛрддреА рд╣реИ рдЬрд┐рд╕реЗ рдмрд┐рдирд╛ рдХрд┐рд╕реА рдкреНрд░реЙрдореНрдкреНрдЯ рдХреЛ рдЙрддреНрдкрдиреНрди рдХрд┐рдП рддрдХрдиреАрдХреА рд░реВрдк рд╕реЗ рдкрд╣реБрдВрдЪрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЬреЛ рдПрдХ рд▓рд╛рд▓ рдЯреАрдо рдЕрднреНрдпрд╛рд╕ рдореЗрдВ рдЖрдЧреЗ рдмрдврд╝рдиреЗ рдореЗрдВ рдорджрдж рдХрд░ рд╕рдХрддрд╛ рд╣реИ:

{% content-ref url="macos-keychain.md" %}
[macos-keychain.md](macos-keychain.md)
{% endcontent-ref %}

## рдмрд╛рд╣рд░реА рд╕реЗрд╡рд╛рдПрдВ

MacOS рд░реЗрдб рдЯреАрдорд┐рдВрдЧ рдПрдХ рд╕рд╛рдорд╛рдиреНрдп Windows рд░реЗрдб рдЯреАрдорд┐рдВрдЧ рд╕реЗ рдЕрд▓рдЧ рд╣реЛрддреА рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдЖрдорддреМрд░ рдкрд░ **MacOS рдХрдИ рдмрд╛рд╣рд░реА рдкреНрд▓реЗрдЯрдлреЙрд░реНрдореЛрдВ рдХреЗ рд╕рд╛рде рд╕реАрдзреЗ рдПрдХреАрдХреГрдд рд╣реЛрддрд╛ рд╣реИ**ред MacOS рдХрд╛ рдПрдХ рд╕рд╛рдорд╛рдиреНрдп рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХрдВрдкреНрдпреВрдЯрд░ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП **OneLogin рд╕рд┐рдВрдХреНрд░рдирд╛рдЗрдЬрд╝рдб рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╣реИ, рдФрд░ OneLogin рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдХрдИ рдмрд╛рд╣рд░реА рд╕реЗрд╡рд╛рдУрдВ** (рдЬреИрд╕реЗ github, aws...) рддрдХ рдкрд╣реБрдВрдЪрдирд╛ рд╣реИ:

![](<../../.gitbook/assets/image (563).png>)

## рд╡рд┐рд╡рд┐рдз рд░реЗрдб рдЯреАрдо рддрдХрдиреАрдХ

### рд╕рдлрд╛рд░реА

рдЬрдм рд╕рдлрд╛рд░реА рдореЗрдВ рдПрдХ рдлрд╝рд╛рдЗрд▓ рдбрд╛рдЙрдирд▓реЛрдб рдХреА рдЬрд╛рддреА рд╣реИ, рддреЛ рдпрджрд┐ рдпрд╣ рдПрдХ "рд╕реБрд░рдХреНрд╖рд┐рдд" рдлрд╝рд╛рдЗрд▓ рд╣реИ, рддреЛ рдпрд╣ **рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдЦреЛрд▓ рджреА рдЬрд╛рдПрдЧреА**ред рдЗрд╕рд▓рд┐рдП рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдпрджрд┐ рдЖрдк **рдПрдХ zip рдлрд╝рд╛рдЗрд▓ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рддреЗ рд╣реИрдВ**, рддреЛ рдпрд╣ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдбреАрдХрдВрдкреНрд░реЗрд╕ рд╣реЛ рдЬрд╛рдПрдЧреА:

<figure><img src="../../.gitbook/assets/image (12) (3).png" alt=""><figcaption></figcaption></figure>

## рд╕рдВрджрд░реНрдн

* [**https://www.youtube.com/watch?v=IiMladUbL6E**](https://www.youtube.com/watch?v=IiMladUbL6E)
* [**https://medium.com/xm-cyber/introducing-machound-a-solution-to-macos-active-directory-based-attacks-2a425f0a22b6**](https://medium.com/xm-cyber/introducing-machound-a-solution-to-macos-active-directory-based-attacks-2a425f0a22b6)
* [**https://gist.github.com/its-a-feature/1a34f597fb30985a2742bb16116e74e0**](https://gist.github.com/its-a-feature/1a34f597fb30985a2742bb16116e74e0)
* [**Come to the Dark Side, We Have Apples: Turning macOS Management Evil**](https://www.youtube.com/watch?v=pOQOh07eMxY)
* [**OBTS v3.0: "An Attackers Perspective on Jamf Configurations" - Luke Roberts / Calum Hall**](https://www.youtube.com/watch?v=ju1IYWUv4ZA)

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>тШБя╕П HackTricks Cloud тШБя╕П</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ЁЯРж Twitter ЁЯРж</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ЁЯОЩя╕П Twitch ЁЯОЩя╕П</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ЁЯОе Youtube ЁЯОе</strong></a></summary>

* рдХреНрдпрд╛ рдЖрдк рдХрд┐рд╕реА **рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХрдВрдкрдиреА** рдореЗрдВ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ? рдХреНрдпрд╛ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА HackTricks рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд рд╣реЛ**? рдпрд╛ рдХреНрдпрд╛ рдЖрдк **PEASS рдХреЗ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб** рдХрд░рдиреЗ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ? [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ!
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рдХрд▓реЗрдХреНрд╢рди рдХреАред
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks swag**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* **[ЁЯТм](https://emojipedia.org/speech-balloon/) [Discord рд╕рдореВрд╣](https://discord.gg/hRep4RUj7f) рдпрд╛ [telegram рд╕рдореВрд╣](https://t.me/peass) рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ рдореБрдЭреЗ **Twitter** [**ЁЯРж**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)** рдХрд╛** рдЕрдиреБрд╕рд░рдг рдХрд░реЗрдВред
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, PRs рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **рдФрд░** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **рдХреЛ рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ**ред

</details>
