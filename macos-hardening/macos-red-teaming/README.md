# macOS Red Teaming

<details>

<summary><strong>AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рд╢реВрдиреНрдп рд╕реЗ рд▓реЗрдХрд░ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ**, рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ [**telegram group**](https://t.me/peass) рдореЗрдВ рдпрд╛ **Twitter** ЁЯРж рдкрд░ рдореБрдЭреЗ **рдлреЙрд▓реЛ** рдХрд░реЗрдВ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ.

</details>

## MDMs рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ

* JAMF Pro: `jamf checkJSSConnection`
* Kandji

рдпрджрд┐ рдЖрдк рдкреНрд░рдмрдВрдзрди рдкреНрд▓реЗрдЯрдлреЙрд░реНрдо рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП **admin credentials рдХреЛ рд╕рдордЭреМрддрд╛ рдХрд░рдиреЗ рдореЗрдВ рд╕рдлрд▓ рд╣реЛрддреЗ рд╣реИрдВ**, рддреЛ рдЖрдк **рд╕рднреА рдХрдВрдкреНрдпреВрдЯрд░реЛрдВ рдХреЛ рд╕рдВрднрд╛рд╡рд┐рдд рд░реВрдк рд╕реЗ рд╕рдордЭреМрддрд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ** рдЕрдкрдиреЗ рдореИрд▓рд╡реЗрдпрд░ рдХреЛ рдорд╢реАрдиреЛрдВ рдореЗрдВ рд╡рд┐рддрд░рд┐рдд рдХрд░рдХреЗред

MacOS рд╡рд╛рддрд╛рд╡рд░рдгреЛрдВ рдореЗрдВ рд░реЗрдб рдЯреАрдорд┐рдВрдЧ рдХреЗ рд▓рд┐рдП MDMs рдХреЗ рдХрд╛рдордХрд╛рдЬ рдХреА рдХреБрдЫ рд╕рдордЭ рд╣реЛрдирд╛ рдЕрддреНрдпрдзрд┐рдХ рдЕрдиреБрд╢рдВрд╕рд┐рдд рд╣реИ:

{% content-ref url="macos-mdm/" %}
[macos-mdm](macos-mdm/)
{% endcontent-ref %}

### MDM рдХрд╛ C2 рдХреЗ рд░реВрдк рдореЗрдВ рдЙрдкрдпреЛрдЧ

рдПрдХ MDM рдХреЛ рдкреНрд░реЛрдлрд╛рдЗрд▓реНрд╕ рдХреЛ рдЗрдВрд╕реНрдЯреЙрд▓ рдХрд░рдиреЗ, рдХреНрд╡реЗрд░реА рдХрд░рдиреЗ рдпрд╛ рд╣рдЯрд╛рдиреЗ, рдПрдкреНрд▓рд┐рдХреЗрд╢рдиреНрд╕ рдХреЛ рдЗрдВрд╕реНрдЯреЙрд▓ рдХрд░рдиреЗ, рд▓реЛрдХрд▓ рдПрдбрдорд┐рди рдЕрдХрд╛рдЙрдВрдЯреНрд╕ рдмрдирд╛рдиреЗ, рдлрд░реНрдорд╡реЗрдпрд░ рдкрд╛рд╕рд╡рд░реНрдб рд╕реЗрдЯ рдХрд░рдиреЗ, FileVault рдХреА рдХреЛ рдмрджрд▓рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд╣реЛрдЧреА...

рдЕрдкрдирд╛ рдЦреБрдж рдХрд╛ MDM рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ рдПрдХ **vendor рджреНрд╡рд╛рд░рд╛ рдЖрдкрдХреЗ CSR рдХреЛ рд╕рд╛рдЗрди рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП** рдЬрд┐рд╕реЗ рдЖрдк [**https://mdmcert.download/**](https://mdmcert.download/) рдХреЗ рд╕рд╛рде рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдФрд░ Apple рдбрд┐рд╡рд╛рдЗрд╕реЗрд╕ рдХреЗ рд▓рд┐рдП рдЕрдкрдирд╛ рдЦреБрдж рдХрд╛ MDM рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдк [**MicroMDM**](https://github.com/micromdm/micromdm) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

рд╣рд╛рд▓рд╛рдВрдХрд┐, рдПрдХ enrolled рдбрд┐рд╡рд╛рдЗрд╕ рдореЗрдВ рдПрдХ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдЗрдВрд╕реНрдЯреЙрд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рдЕрднреА рднреА рдЗрд╕реЗ рдПрдХ рдбреЗрд╡рд▓рдкрд░ рдЕрдХрд╛рдЙрдВрдЯ рджреНрд╡рд╛рд░рд╛ рд╕рд╛рдЗрди рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП... рд╣рд╛рд▓рд╛рдВрдХрд┐, MDM рдореЗрдВ рдирд╛рдорд╛рдВрдХрди рдХреЗ рдмрд╛рдж **рдбрд┐рд╡рд╛рдЗрд╕ MDM рдХреЗ SSL рд╕рд░реНрдЯрд┐рдлрд┐рдХреЗрдЯ рдХреЛ рдПрдХ рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп CA рдХреЗ рд░реВрдк рдореЗрдВ рдЬреЛрдбрд╝рддрд╛ рд╣реИ**, рдЗрд╕рд▓рд┐рдП рдЕрдм рдЖрдк рдХреБрдЫ рднреА рд╕рд╛рдЗрди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

рдбрд┐рд╡рд╛рдЗрд╕ рдХреЛ MDM рдореЗрдВ рдирд╛рдорд╛рдВрдХрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ рдПрдХ **`mobileconfig`** рдлрд╛рдЗрд▓ рдХреЛ рд░реВрдЯ рдХреЗ рд░реВрдк рдореЗрдВ рдЗрдВрд╕реНрдЯреЙрд▓ рдХрд░рдирд╛ рд╣реЛрдЧрд╛, рдЬрд┐рд╕реЗ рдПрдХ **pkg** рдлрд╛рдЗрд▓ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╡рд┐рддрд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ (рдЖрдк рдЗрд╕реЗ рдЬрд╝рд┐рдк рдореЗрдВ рд╕рдВрдкреАрдбрд╝рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рд╕рдлрд╛рд░реА рд╕реЗ рдбрд╛рдЙрдирд▓реЛрдб рдХрд┐рдП рдЬрд╛рдиреЗ рдкрд░ рдпрд╣ рдбрд┐рдХрдВрдкреНрд░реЗрд╕ рд╣реЛ рдЬрд╛рдПрдЧрд╛)ред

**Mythic agent Orthrus** рдЗрд╕ рддрдХрдиреАрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред

### JAMF PRO рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ

JAMF **рдХрд╕реНрдЯрдо рд╕реНрдХреНрд░рд┐рдкреНрдЯреНрд╕** (рд╕рд┐рд╕реНрдЯрдо рдПрдбрдорд┐рди рджреНрд╡рд╛рд░рд╛ рд╡рд┐рдХрд╕рд┐рдд рд╕реНрдХреНрд░рд┐рдкреНрдЯреНрд╕), **рдиреЗрдЯрд┐рд╡ рдкреЗрд▓реЛрдбреНрд╕** (рд▓реЛрдХрд▓ рдЕрдХрд╛рдЙрдВрдЯ рдХреНрд░рд┐рдПрд╢рди, EFI рдкрд╛рд╕рд╡рд░реНрдб рд╕реЗрдЯ рдХрд░рдирд╛, рдлрд╛рдЗрд▓/рдкреНрд░реЛрд╕реЗрд╕ рдореЙрдирд┐рдЯрд░рд┐рдВрдЧ...) рдФрд░ **MDM** (рдбрд┐рд╡рд╛рдЗрд╕ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди, рдбрд┐рд╡рд╛рдЗрд╕ рд╕рд░реНрдЯрд┐рдлрд┐рдХреЗрдЯреНрд╕...) рдЪрд▓рд╛ рд╕рдХрддрд╛ рд╣реИред

#### JAMF рд╕реНрд╡-рдирд╛рдорд╛рдВрдХрди

рдРрд╕реЗ рдкреЗрдЬ рдкрд░ рдЬрд╛рдПрдВ рдЬреИрд╕реЗ рдХрд┐ `https://<company-name>.jamfcloud.com/enroll/` рдпрд╣ рджреЗрдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ рдХреНрдпрд╛ рдЙрдиреНрд╣реЛрдВрдиреЗ **рд╕реНрд╡-рдирд╛рдорд╛рдВрдХрди рд╕рдХреНрд╖рдо рдХрд┐рдпрд╛ рд╣реИ**ред рдпрджрд┐ рдЙрдиреНрд╣реЛрдВрдиреЗ рдЗрд╕реЗ рд╕рдХреНрд╖рдо рдХрд┐рдпрд╛ рд╣реИ рддреЛ рдпрд╣ **рдкрд╣реБрдВрдЪ рдХреЗ рд▓рд┐рдП рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдорд╛рдВрдЧ рд╕рдХрддрд╛ рд╣реИ**ред

рдЖрдк рдкрд╛рд╕рд╡рд░реНрдб рд╕реНрдкреНрд░реЗрдЗрдВрдЧ рдЕрдЯреИрдХ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП [**JamfSniper.py**](https://github.com/WithSecureLabs/Jamf-Attack-Toolkit/blob/master/JamfSniper.py) рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЙрдЪрд┐рдд рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдкрд╛рдиреЗ рдХреЗ рдмрд╛рдж рдЖрдк рдЕрдЧрд▓реЗ рдлреЙрд░реНрдо рдХреЗ рд╕рд╛рде рдЕрдиреНрдп рдпреВрдЬрд░рдиреЗрдореНрд╕ рдХреЛ рдмреНрд░реВрдЯ-рдлреЛрд░реНрд╕ рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ:

![](<../../.gitbook/assets/image (7) (1) (1).png>)

#### JAMF рдбрд┐рд╡рд╛рдЗрд╕ рдкреНрд░рдорд╛рдгреАрдХрд░рдг

<figure><img src="../../.gitbook/assets/image (2) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

**`jamf`** рдмрд╛рдЗрдирд░реА рдореЗрдВ рд╡рд╣ рд╕реАрдХреНрд░реЗрдЯ рд╢рд╛рдорд┐рд▓ рдерд╛ рдЬреЛ рдЦреЛрдЬ рдХреЗ рд╕рдордп рд╕рднреА рдХреЗ рдмреАрдЪ **рд╕рд╛рдЭрд╛** рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ рдФрд░ рд╡рд╣ рдерд╛: **`jk23ucnq91jfu9aj`**.\
рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, jamf **`/Library/LaunchAgents/com.jamf.management.agent.plist`** рдореЗрдВ рдПрдХ **LaunchDaemon** рдХреЗ рд░реВрдк рдореЗрдВ **рдмрдирд╛ рд░рд╣рддрд╛ рд╣реИ**ред

#### JAMF рдбрд┐рд╡рд╛рдЗрд╕ рдЯреЗрдХрдУрд╡рд░

**JSS** (Jamf Software Server) **URL** рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ **`jamf`** рдХрд░реЗрдЧрд╛ рд╡рд╣ рд╕реНрдерд┐рдд рд╣реИ **`/Library/Preferences/com.jamfsoftware.jamf.plist`** рдореЗрдВред \
рдпрд╣ рдлрд╛рдЗрд▓ рдореВрд▓ рд░реВрдк рд╕реЗ URL рд╢рд╛рдорд┐рд▓ рдХрд░рддреА рд╣реИ:

{% code overflow="wrap" %}
```bash
plutil -convert xml1 -o - /Library/Preferences/com.jamfsoftware.jamf.plist

[...]
<key>is_virtual_machine</key>
<false/>
<key>jss_url</key>
<string>https://halbornasd.jamfcloud.com/</string>
<key>last_management_framework_change_id</key>
<integer>4</integer>
[...]
```
{% endcode %}

рдЗрд╕рд▓рд┐рдП, рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдПрдХ рд╣рд╛рдирд┐рдХрд╛рд░рдХ рдкреИрдХреЗрдЬ (`pkg`) рдбрд╛рд▓ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ **рдЗрд╕ рдлрд╛рдЗрд▓ рдХреЛ рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд░рддрд╛ рд╣реИ** рдЬрдм рдЗрдВрд╕реНрдЯреЙрд▓ рд╣реЛрддрд╛ рд╣реИ рдФрд░ **URL рдХреЛ рдПрдХ Mythic C2 рд▓рд┐рд╕рдирд░ рдкрд░ рд╕реЗрдЯ рдХрд░рддрд╛ рд╣реИ рдЬреЛ Typhon рдПрдЬреЗрдВрдЯ рд╕реЗ рдЖрддрд╛ рд╣реИ** рддрд╛рдХрд┐ рдЕрдм JAMF рдХрд╛ рдЙрдкрдпреЛрдЧ C2 рдХреЗ рд░реВрдк рдореЗрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред

{% code overflow="wrap" %}
```bash
# After changing the URL you could wait for it to be reloaded or execute:
sudo jamf policy -id 0

# TODO: There is an ID, maybe it's possible to have the real jamf connection and another one to the C2
```
#### JAMF рдЕрдиреБрдХрд░рдг

рдбрд┐рд╡рд╛рдЗрд╕ рдФрд░ JMF рдХреЗ рдмреАрдЪ рд╕рдВрдЪрд╛рд░ рдХрд╛ **рдЕрдиреБрдХрд░рдг рдХрд░рдиреЗ** рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ рдЪрд╛рд╣рд┐рдП:

* рдбрд┐рд╡рд╛рдЗрд╕ рдХрд╛ **UUID**: `ioreg -d2 -c IOPlatformExpertDevice | awk -F" '/IOPlatformUUID/{print $(NF-1)}'`
* **JAMF рдХреАрдЪреЗрди** рдЬреЛ рдпрд╣рд╛рдБ рд╕реЗ рдорд┐рд▓реЗрдЧрд╛: `/Library/Application\ Support/Jamf/JAMF.keychain` рдЬрд┐рд╕рдореЗрдВ рдбрд┐рд╡рд╛рдЗрд╕ рдкреНрд░рдорд╛рдгрдкрддреНрд░ рд╣реЛрддрд╛ рд╣реИ

рдЗрд╕ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд╕рд╛рде, **рдПрдХ VM рдмрдирд╛рдПрдВ** рдЬрд┐рд╕рдореЗрдВ **рдЪреБрд░рд╛рдпрд╛ рдЧрдпрд╛** рд╣рд╛рд░реНрдбрд╡реЗрдпрд░ **UUID** рд╣реЛ рдФрд░ **SIP рдЕрдХреНрд╖рдо** рд╣реЛ, **JAMF рдХреАрдЪреЗрди рдбрд╛рд▓реЗрдВ,** Jamf **рдПрдЬреЗрдВрдЯ** рдХреЛ **рд╣реБрдХ** рдХрд░реЗрдВ рдФрд░ рдЙрд╕рдХреА рдЬрд╛рдирдХрд╛рд░реА рдЪреБрд░рд╛рдПрдВред

#### рдЧреЛрдкрдиреАрдп рдЬрд╛рдирдХрд╛рд░реА рдЪреЛрд░реА

<figure><img src="../../.gitbook/assets/image (11).png" alt=""><figcaption><p>a</p></figcaption></figure>

рдЖрдк `/Library/Application Support/Jamf/tmp/` рд╕реНрдерд╛рди рдХреА рдирд┐рдЧрд░рд╛рдиреА рднреА рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд╣рд╛рдБ **рдХрд╕реНрдЯрдо рд╕реНрдХреНрд░рд┐рдкреНрдЯреНрд╕** рдХреЛ рдЬрдорд╛ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬрд┐рдиреНрд╣реЗрдВ рдПрдбрдорд┐рдиреНрд╕ Jamf рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХреНрдпреЛрдВрдХрд┐ рд╡реЗ **рдпрд╣рд╛рдБ рд░рдЦреЗ рдЬрд╛рддреЗ рд╣реИрдВ, рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ рдФрд░ рд╣рдЯрд╛ рджрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ**ред рдЗрди рд╕реНрдХреНрд░рд┐рдкреНрдЯреНрд╕ рдореЗрдВ **рдкреНрд░рдорд╛рдгреАрдХрд░рдг рд╕рд╛рдордЧреНрд░реА рд╣реЛ рд╕рдХрддреА рд╣реИ**ред

рд╣рд╛рд▓рд╛рдВрдХрд┐, **рдкреНрд░рдорд╛рдгреАрдХрд░рдг рд╕рд╛рдордЧреНрд░реА** рдЗрди рд╕реНрдХреНрд░рд┐рдкреНрдЯреНрд╕ рдореЗрдВ **рдкреИрд░рд╛рдореАрдЯрд░реНрд╕** рдХреЗ рд░реВрдк рдореЗрдВ рднреА рджреА рдЬрд╛ рд╕рдХрддреА рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЖрдкрдХреЛ `ps aux | grep -i jamf` рдХреА рдирд┐рдЧрд░рд╛рдиреА рдХрд░рдиреА рд╣реЛрдЧреА (рдмрд┐рдирд╛ рд░реВрдЯ рд╣реЛрдиреЗ рдХреЗ рднреА)ред

рд╕реНрдХреНрд░рд┐рдкреНрдЯ [**JamfExplorer.py**](https://github.com/WithSecureLabs/Jamf-Attack-Toolkit/blob/master/JamfExplorer.py) рдирдИ рдлрд╛рдЗрд▓реЛрдВ рдХреЗ рдЬреЛрдбрд╝реЗ рдЬрд╛рдиреЗ рдФрд░ рдирдП рдкреНрд░реЛрд╕реЗрд╕ рдЖрд░реНрдЧреНрдпреБрдореЗрдВрдЯреНрд╕ рдХреА рдирд┐рдЧрд░рд╛рдиреА рдХрд░ рд╕рдХрддреА рд╣реИред

### macOS рд░рд┐рдореЛрдЯ рдПрдХреНрд╕реЗрд╕

рдФрд░ **MacOS** рдХреЗ "рд╡рд┐рд╢реЗрд╖" **рдиреЗрдЯрд╡рд░реНрдХ** **рдкреНрд░реЛрдЯреЛрдХреЙрд▓реНрд╕** рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рднреА:

{% content-ref url="../macos-security-and-privilege-escalation/macos-protocols.md" %}
[macos-protocols.md](../macos-security-and-privilege-escalation/macos-protocols.md)
{% endcontent-ref %}

## рдПрдХреНрдЯрд┐рд╡ рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА

рдХреБрдЫ рдореМрдХреЛрдВ рдкрд░ рдЖрдк рдкрд╛рдПрдВрдЧреЗ рдХрд┐ **MacOS рдХрдВрдкреНрдпреВрдЯрд░ AD рд╕реЗ рдЬреБрдбрд╝рд╛ рд╣реБрдЖ рд╣реИ**ред рдЗрд╕ рдкрд░рд┐рджреГрд╢реНрдп рдореЗрдВ рдЖрдкрдХреЛ рдПрдХреНрдЯрд┐рд╡ рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА рдХрд╛ **рдЧрдгрдирд╛ рдХрд░рдиреЗ** рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рдиреА рдЪрд╛рд╣рд┐рдП рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд░рддреЗ рд╣реИрдВред рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреГрд╖реНрдареЛрдВ рдореЗрдВ рдХреБрдЫ **рд╕рд╣рд╛рдпрддрд╛** рдорд┐рд▓ рд╕рдХрддреА рд╣реИ:

{% content-ref url="../../network-services-pentesting/pentesting-ldap.md" %}
[pentesting-ldap.md](../../network-services-pentesting/pentesting-ldap.md)
{% endcontent-ref %}

{% content-ref url="../../windows-hardening/active-directory-methodology/" %}
[active-directory-methodology](../../windows-hardening/active-directory-methodology/)
{% endcontent-ref %}

{% content-ref url="../../network-services-pentesting/pentesting-kerberos-88/" %}
[pentesting-kerberos-88](../../network-services-pentesting/pentesting-kerberos-88/)
{% endcontent-ref %}

рдХреБрдЫ **рд╕реНрдерд╛рдиреАрдп MacOS рдЯреВрд▓** рдЬреЛ рдЖрдкрдХреА рд╕рд╣рд╛рдпрддрд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рд╡рд╣ рд╣реИ `dscl`:
```bash
dscl "/Active Directory/[Domain]/All Domains" ls /
```
рдореИрдХрдУрдПрд╕ рдХреЗ рд▓рд┐рдП рдХреБрдЫ рдЯреВрд▓реНрд╕ рддреИрдпрд╛рд░ рдХрд┐рдП рдЧрдП рд╣реИрдВ рдЬреЛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ AD рдХрд╛ рдкрд░рд┐рдЧрдгрдирд╛ рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдХреЗрд░реНрдмрд░реЛрд╕ рдХреЗ рд╕рд╛рде рдЦреЗрд▓рддреЗ рд╣реИрдВ:

* [**Machound**](https://github.com/XMCyber/MacHound): MacHound рдмреНрд▓рдбрд╣рд╛рдЙрдВрдб рдСрдбрд┐рдЯрд┐рдВрдЧ рдЯреВрд▓ рдХрд╛ рдПрдХ рд╡рд┐рд╕реНрддрд╛рд░ рд╣реИ рдЬреЛ рдореИрдХрдУрдПрд╕ рд╣реЛрд╕реНрдЯреНрд╕ рдкрд░ рдПрдХреНрдЯрд┐рд╡ рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА рд╕рдВрдмрдВрдзреЛрдВ рдХреЛ рдПрдХрддреНрд░рд┐рдд рдХрд░рдиреЗ рдФрд░ рдЙрдиреНрд╣реЗрдВ рдЗрдВрдЬреЗрд╕реНрдЯ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред
* [**Bifrost**](https://github.com/its-a-feature/bifrost): Bifrost рдПрдХ Objective-C рдкреНрд░реЛрдЬреЗрдХреНрдЯ рд╣реИ рдЬрд┐рд╕реЗ рдореИрдХрдУрдПрд╕ рдкрд░ Heimdal krb5 APIs рдХреЗ рд╕рд╛рде рдЗрдВрдЯрд░реИрдХреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдбрд┐рдЬрд╛рдЗрди рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред рдЗрд╕ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдХрд╛ рд▓рдХреНрд╖реНрдп рдореИрдХрдУрдПрд╕ рдбрд┐рд╡рд╛рдЗрд╕реЗрдЬ рдкрд░ рдХреЗрд░реНрдмрд░реЛрд╕ рдХреЗ рдЖрд╕рдкрд╛рд╕ рдмреЗрд╣рддрд░ рд╕реБрд░рдХреНрд╖рд╛ рдкрд░реАрдХреНрд╖рдг рдХреЛ рд╕рдХреНрд╖рдо рдХрд░рдирд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рдиреЗрдЯрд┐рд╡ APIs рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдмрд┐рдирд╛ рдХрд┐рд╕реА рдЕрдиреНрдп рдлреНрд░реЗрдорд╡рд░реНрдХ рдпрд╛ рдкреИрдХреЗрдЬ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдХреЗ рд▓рдХреНрд╖реНрдп рдкрд░ред
* [**Orchard**](https://github.com/its-a-feature/Orchard): рдПрдХреНрдЯрд┐рд╡ рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА рдкрд░рд┐рдЧрдгрдирд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП JavaScript for Automation (JXA) рдЯреВрд▓ред

### рдбреЛрдореЗрди рдЬрд╛рдирдХрд╛рд░реА
```bash
echo show com.apple.opendirectoryd.ActiveDirectory | scutil
```
### рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛

MacOS рдХреЗ рддреАрди рдкреНрд░рдХрд╛рд░ рдХреЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╣реЛрддреЗ рд╣реИрдВ:

* **рд╕реНрдерд╛рдиреАрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛** тАФ рд╕реНрдерд╛рдиреАрдп OpenDirectory рд╕реЗрд╡рд╛ рджреНрд╡рд╛рд░рд╛ рдкреНрд░рдмрдВрдзрд┐рдд, рдпреЗ Active Directory рд╕реЗ рдХрд┐рд╕реА рднреА рдкреНрд░рдХрд╛рд░ рд╕реЗ рдЬреБрдбрд╝реЗ рдирд╣реАрдВ рд╣реЛрддреЗ рд╣реИрдВред
* **рдиреЗрдЯрд╡рд░реНрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛** тАФ рдЕрд╕реНрдерд╛рдпреА Active Directory рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЬрд┐рдиреНрд╣реЗрдВ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЗ рд▓рд┐рдП DC рд╕рд░реНрд╡рд░ рд╕реЗ рдХрдиреЗрдХреНрд╢рди рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред
* **рдореЛрдмрд╛рдЗрд▓ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛** тАФ Active Directory рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЬрд┐рдирдХреЗ рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдФрд░ рдлрд╛рдЗрд▓реЛрдВ рдХрд╛ рд╕реНрдерд╛рдиреАрдп рдмреИрдХрдЕрдк рд╣реЛрддрд╛ рд╣реИред

рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдФрд░ рд╕рдореВрд╣реЛрдВ рдХреЗ рд╕реНрдерд╛рдиреАрдп рдЬрд╛рдирдХрд╛рд░реА _/var/db/dslocal/nodes/Default_ рдлреЛрд▓реНрдбрд░ рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рдХреА рдЬрд╛рддреА рд╣реИред\
рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, _mark_ рдирд╛рдордХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреА рдЬрд╛рдирдХрд╛рд░реА _/var/db/dslocal/nodes/Default/users/mark.plist_ рдореЗрдВ рдФрд░ _admin_ рд╕рдореВрд╣ рдХреА рдЬрд╛рдирдХрд╛рд░реА _/var/db/dslocal/nodes/Default/groups/admin.plist_ рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реИред

HasSession рдФрд░ AdminTo edges рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рдЕрд▓рд╛рд╡рд╛, **MacHound рддреАрди рдирдП edges рдХреЛ Bloodhound рдбреЗрдЯрд╛рдмреЗрд╕ рдореЗрдВ рдЬреЛрдбрд╝рддрд╛ рд╣реИ**:

* **CanSSH** - рдЙрд╕ рд╣реЛрд╕реНрдЯ рдкрд░ SSH рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд╡рд╛рд▓рд╛ рдЗрдХрд╛рдИ
* **CanVNC** - рдЙрд╕ рд╣реЛрд╕реНрдЯ рдкрд░ VNC рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд╡рд╛рд▓рд╛ рдЗрдХрд╛рдИ
* **CanAE** - рдЙрд╕ рд╣реЛрд╕реНрдЯ рдкрд░ AppleEvent рд╕реНрдХреНрд░рд┐рдкреНрдЯреНрд╕ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд╡рд╛рд▓рд╛ рдЗрдХрд╛рдИ
```bash
#User enumeration
dscl . ls /Users
dscl . read /Users/[username]
dscl "/Active Directory/TEST/All Domains" ls /Users
dscl "/Active Directory/TEST/All Domains" read /Users/[username]
dscacheutil -q user

#Computer enumeration
dscl "/Active Directory/TEST/All Domains" ls /Computers
dscl "/Active Directory/TEST/All Domains" read "/Computers/[compname]$"

#Group enumeration
dscl . ls /Groups
dscl . read "/Groups/[groupname]"
dscl "/Active Directory/TEST/All Domains" ls /Groups
dscl "/Active Directory/TEST/All Domains" read "/Groups/[groupname]"

#Domain Information
dsconfigad -show
```
рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП [https://its-a-feature.github.io/posts/2018/01/Active-Directory-Discovery-with-a-Mac/](https://its-a-feature.github.io/posts/2018/01/Active-Directory-Discovery-with-a-Mac/)

## рдХреАрдЪреЗрди рддрдХ рдкрд╣реБрдБрдЪ

рдХреАрдЪреЗрди рдореЗрдВ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдЬрд╛рдирдХрд╛рд░реА рд╣реЛ рд╕рдХрддреА рд╣реИ рдЬрд┐рд╕реЗ рдмрд┐рдирд╛ рдкреНрд░реЙрдореНрдкреНрдЯ рдЙрддреНрдкрдиреНрди рдХрд┐рдП рдкрд╣реБрдБрдЪрдиреЗ рд╕реЗ рд░реЗрдб рдЯреАрдо рдЕрднреНрдпрд╛рд╕ рдХреЛ рдЖрдЧреЗ рдмрдврд╝рд╛рдиреЗ рдореЗрдВ рдорджрдж рдорд┐рд▓ рд╕рдХрддреА рд╣реИ:

{% content-ref url="macos-keychain.md" %}
[macos-keychain.md](macos-keychain.md)
{% endcontent-ref %}

## рдмрд╛рд╣рд░реА рд╕реЗрд╡рд╛рдПрдБ

MacOS рд░реЗрдб рдЯреАрдорд┐рдВрдЧ рдПрдХ рд╕рд╛рдорд╛рдиреНрдп Windows рд░реЗрдб рдЯреАрдорд┐рдВрдЧ рд╕реЗ рдЕрд▓рдЧ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдЖрдорддреМрд░ рдкрд░ **MacOS рдХрдИ рдмрд╛рд╣рд░реА рдкреНрд▓реЗрдЯрдлреЙрд░реНрдореЛрдВ рдХреЗ рд╕рд╛рде рд╕реАрдзреЗ рдПрдХреАрдХреГрдд рд╣реЛрддрд╛ рд╣реИ**ред MacOS рдХрд╛ рдПрдХ рд╕рд╛рдорд╛рдиреНрдп рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди **OneLogin рд╕рд┐рдВрдХреНрд░рдирд╛рдЗрдЬрд╝реНрдб рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХрдВрдкреНрдпреВрдЯрд░ рддрдХ рдкрд╣реБрдБрдЪрдирд╛ рд╣реИ, рдФрд░ рдХрдИ рдмрд╛рд╣рд░реА рд╕реЗрд╡рд╛рдУрдВ рддрдХ рдкрд╣реБрдБрдЪрдирд╛ рд╣реИ** (рдЬреИрд╕реЗ github, aws...) OneLogin рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ:

![](<../../.gitbook/assets/image (563).png>)

## рд╡рд┐рд╡рд┐рдз рд░реЗрдб рдЯреАрдо рддрдХрдиреАрдХреЗрдВ

### рд╕рдлрд╛рд░реА

рдЬрдм рд╕рдлрд╛рд░реА рдореЗрдВ рдХреЛрдИ рдлрд╝рд╛рдЗрд▓ рдбрд╛рдЙрдирд▓реЛрдб рдХреА рдЬрд╛рддреА рд╣реИ, рдЕрдЧрд░ рд╡рд╣ рдПрдХ "рд╕реБрд░рдХреНрд╖рд┐рдд" рдлрд╝рд╛рдЗрд▓ рд╣реИ, рддреЛ рд╡рд╣ **рд╕реНрд╡рддрдГ рдЦреБрд▓ рдЬрд╛рдПрдЧреА**ред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЕрдЧрд░ рдЖрдк **рдПрдХ рдЬрд╝рд┐рдк рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рддреЗ рд╣реИрдВ**, рддреЛ рд╡рд╣ рд╕реНрд╡рддрдГ рдбрд┐рдХрдВрдкреНрд░реЗрд╕ рд╣реЛ рдЬрд╛рдПрдЧреА:

<figure><img src="../../.gitbook/assets/image (12) (3).png" alt=""><figcaption></figcaption></figure>

## рд╕рдВрджрд░реНрдн

* [**https://www.youtube.com/watch?v=IiMladUbL6E**](https://www.youtube.com/watch?v=IiMladUbL6E)
* [**https://medium.com/xm-cyber/introducing-machound-a-solution-to-macos-active-directory-based-attacks-2a425f0a22b6**](https://medium.com/xm-cyber/introducing-machound-a-solution-to-macos-active-directory-based-attacks-2a425f0a22b6)
* [**https://gist.github.com/its-a-feature/1a34f597fb30985a2742bb16116e74e0**](https://gist.github.com/its-a-feature/1a34f597fb30985a2742bb16116e74e0)
* [**Come to the Dark Side, We Have Apples: Turning macOS Management Evil**](https://www.youtube.com/watch?v=pOQOh07eMxY)
* [**OBTS v3.0: "An Attackers Perspective on Jamf Configurations" - Luke Roberts / Calum Hall**](https://www.youtube.com/watch?v=ju1IYWUv4ZA)

<details>

<summary><strong>AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рд╢реВрдиреНрдп рд╕реЗ рдирд╛рдпрдХ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS рд░реЗрдб рдЯреАрдо рдПрдХреНрд╕рдкрд░реНрдЯ)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдЕрдЧрд░ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ**](https://peass.creator-spring.com)
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рдПрдХреНрд╕рдХреНрд▓реВрд╕рд┐рд╡ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* ЁЯТм [**Discord рд╕рдореВрд╣ рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**telegram рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ **Twitter** рдкрд░ рдореБрдЭреЗ ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm) **рдХрд╛ рдкрд╛рд▓рди рдХрд░реЗрдВ**ред
* **HackTricks** рдХреЛ рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░рдХреЗ PRs рдЬрдорд╛ рдХрд░реЗрдВ [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВред

</details>
