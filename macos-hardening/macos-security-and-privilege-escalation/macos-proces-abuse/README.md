# macOS Process рджреБрд░реБрдкрдпреЛрдЧ

<details>

<summary><strong>рдЬреАрд░реЛ рд╕реЗ рд╣реАрд░реЛ рддрдХ AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдЕрдЧрд░ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рдХрд▓реЗрдХреНрд╢рди **The PEASS Family** рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@carlospolopm**](https://twitter.com/hacktricks\_live)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ** рджреНрд╡рд╛рд░рд╛ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВред

</details>

## рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреА рдореМрд▓рд┐рдХ рдЬрд╛рдирдХрд╛рд░реА

рдПрдХ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдПрдХ рдЪрд▓ рд░рд╣реЗ executable рдХрд╛ рдПрдХ рдЙрджрд╛рд╣рд░рдг рд╣реИ, рд╣рд╛рд▓рд╛рдВрдХрд┐ рдкреНрд░рдХреНрд░рд┐рдпрд╛рдПрдБ рдХреЛрдб рдирд╣реАрдВ рдЪрд▓рд╛рддреА рд╣реИрдВ, рдпреЗ threads рд╣реЛрддреА рд╣реИрдВред рдЗрд╕рд▓рд┐рдП **рдкреНрд░рдХреНрд░рд┐рдпрд╛рдПрдБ рдмрд╕ рдЪрд▓ рд░рд╣реЗ threads рдХреЗ рд▓рд┐рдП рдбрд┐рдмреНрдмреЗ** рд╣реЛрддреА рд╣реИрдВ рдЬреЛ рдореЗрдореЛрд░реА, рдбрд┐рд╕реНрдХреНрд░рд┐рдкреНрдЯрд░, рдкреЛрд░реНрдЯреНрд╕, рдЕрдиреБрдорддрд┐рдпрд╛рдБ рдкреНрд░рджрд╛рди рдХрд░рддреА рд╣реИрдВред

рдкрд╛рд░рдВрдкрд░рд┐рдХ рд░реВрдк рд╕реЗ, рдкреНрд░рдХреНрд░рд┐рдпрд╛рдПрдБ рдЕрдиреНрдп рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЗ рднреАрддрд░ рд╢реБрд░реВ рдХреА рдЬрд╛рддреА рдереАрдВ (PID 1 рдХреЛ рдЫреЛрдбрд╝рдХрд░) **`fork`** рдХреЛ рдХреЙрд▓ рдХрд░рдХреЗ рдЬреЛ рд╡рд░реНрддрдорд╛рди рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреА рдПрдХ рд╕рдЯреАрдХ рдкреНрд░рддрд┐рд▓рд┐рдкрд┐ рдмрдирд╛рддрд╛ рдерд╛ рдФрд░ рдлрд┐рд░ **рдмрдЪреНрдЪрд╛ рдкреНрд░рдХреНрд░рд┐рдпрд╛** рд╕рд╛рдорд╛рдиреНрдпрдд: **`execve`** рдХреЛ рдХреЙрд▓ рдХрд░рдХреЗ рдирдпрд╛ executable рд▓реЛрдб рдХрд░рддреА рдФрд░ рдЪрд▓рд╛рддреА рдереАред рдлрд┐рд░, **`vfork`** рдХреЛ рд╢реАрдШреНрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкреЗрд╢ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ рдмрд┐рдирд╛ рдХрд┐рд╕реА рдореЗрдореЛрд░реА рдХреА рдХреЙрдкреА рдХрд┐рдПред\
рдлрд┐рд░ **`posix_spawn`** рдХреЛ рдкреЗрд╢ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдЬреЛ рдПрдХ рдХреЙрд▓ рдореЗрдВ **`vfork`** рдФрд░ **`execve`** рдХреЛ рдорд┐рд▓рд╛рддрд╛ рдерд╛ рдФрд░ рдлреНрд▓реИрдЧреНрд╕ рд╕реНрд╡реАрдХрд╛рд░ рдХрд░рддрд╛ рдерд╛:

* `POSIX_SPAWN_RESETIDS`: рдкреНрд░рднрд╛рд╡реА рдЖрдИрдбреА рдХреЛ рд╡рд╛рд╕реНрддрд╡рд┐рдХ рдЖрдИрдбреА рдореЗрдВ рд░реАрд╕реЗрдЯ рдХрд░реЗрдВ
* `POSIX_SPAWN_SETPGROUP`: рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд╕рдореВрд╣ рд╕рдВрдмрдВрдз рд╕реЗрдЯ рдХрд░реЗрдВ
* `POSUX_SPAWN_SETSIGDEF`: рд╕рд┐рдЧреНрдирд▓ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд╡реНрдпрд╡рд╣рд╛рд░ рд╕реЗрдЯ рдХрд░реЗрдВ
* `POSIX_SPAWN_SETSIGMASK`: рд╕рд┐рдЧреНрдирд▓ рдорд╛рд╕реНрдХ рд╕реЗрдЯ рдХрд░реЗрдВ
* `POSIX_SPAWN_SETEXEC`: рдПрдХ рд╣реА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рдПрдХреНрдЬрд╝реЗрдХреНрдпреВрдЯ (рдЕрдзрд┐рдХ рд╡рд┐рдХрд▓реНрдкреЛрдВ рдХреЗ рд╕рд╛рде `execve` рдХреА рддрд░рд╣)
* `POSIX_SPAWN_START_SUSPENDED`: рд╕рд╕реНрдкреЗрдВрдб рдХрд░рдХреЗ рд╢реБрд░реВ рдХрд░реЗрдВ
* `_POSIX_SPAWN_DISABLE_ASLR`: ASLR рдХреЗ рдмрд┐рдирд╛ рд╢реБрд░реВ рдХрд░реЗрдВ
* `_POSIX_SPAWN_NANO_ALLOCATOR:` libmalloc рдХрд╛ рдиреИрдиреЛ рдЖрд╡рдВрдЯрдХрд░рдгрдХрд░реНрддрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ
* `_POSIX_SPAWN_ALLOW_DATA_EXEC:` рдбреЗрдЯрд╛ рд╕реЗрдЧрдореЗрдВрдЯ рдкрд░ `rwx` рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдВ
* `POSIX_SPAWN_CLOEXEC_DEFAULT`: рдПрдХреНрдЬрд╝реЗрдХреНрдпреВрдЯ(2) рдкрд░ рд╕рднреА рдлрд╝рд╛рдЗрд▓ рд╡рд┐рд╡рд░рдг рдбрд┐рд╕реНрдХрдиреЗрдХреНрдЯ рдХрд░реЗрдВ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ
* `_POSIX_SPAWN_HIGH_BITS_ASLR:` ASLR рд╕реНрд▓рд╛рдЗрдб рдХреЗ рдЙрдЪреНрдЪ рдмрд┐рдЯ рдХреЛ рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рдмрдирд╛рдПрдВ

рдЗрд╕рдХреЗ рдЕрддрд┐рд░рд┐рдХреНрдд, `posix_spawn` рдПрдХ **`posix_spawnattr`** рдХрд╛ рдПрдХ рдЕрд░реНрд░реЗрдп рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ рдЬреЛ рдЙрддреНрдкрдиреНрди рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рдХреБрдЫ рдкрд╣рд▓реБрдУрдВ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рддрд╛ рд╣реИ, рдФрд░ рдбрд┐рд╕реНрдХреНрд░рд┐рдкреНрдЯрд░ рдХреА рд╕реНрдерд┐рддрд┐ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП **`posix_spawn_file_actions`**ред

рдЬрдм рдПрдХ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдорд░ рдЬрд╛рддреА рд╣реИ рддреЛ рд╡рд╣ **рдорд╛рддрд╛ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рд╡рд╛рдкрд╕реА рдХреЛрдб** рднреЗрдЬрддреА рд╣реИ (рдЕрдЧрд░ рдорд╛рддрд╛ рдорд░ рдЧрдИ, рддреЛ рдирдпрд╛ рдорд╛рддрд╛ PID 1 рд╣реИ) рд╕рд┐рдЧреНрдирд▓ `SIGCHLD` рдХреЗ рд╕рд╛рдеред рдорд╛рддрд╛ рдХреЛ рдЗрд╕ рдорд╛рди рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ `wait4()` рдпрд╛ `waitid()` рдХреЛ рдХреЙрд▓ рдХрд░рдХреЗ рдФрд░ рдЬрдм рддрдХ рдпрд╣ рд╣реЛрддрд╛ рд╣реИ рддрдм рддрдХ рдмрдЪреНрдЪрд╛ рдПрдХ рдЬрд╝реЙрдореНрдмреА рд╕реНрдерд┐рддрд┐ рдореЗрдВ рд░рд╣рддрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рд╡рд╣ рдЕрднреА рднреА рд╕реВрдЪреАрдмрджреНрдз рд╣реИ рд▓реЗрдХрд┐рди рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХрд╛ рдЙрдкрднреЛрдЧ рдирд╣реАрдВ рдХрд░рддреАред

### PIDs

PIDs, рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдкрд╣рдЪрд╛рдирдХрд░реНрддрд╛, рдПрдХ рдЕрджреНрд╡рд┐рддреАрдп рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреА рдкрд╣рдЪрд╛рди рдХрд░рддрд╛ рд╣реИред XNU рдореЗрдВ **PIDs** **64 рдмрд┐рдЯ** рдХреЗ рд╣реЛрддреЗ рд╣реИрдВ рдЬреЛ рд╕реАрдзреЗ рдмрдврд╝рддреЗ рд╣реИрдВ рдФрд░ **рдХрднреА рдирд╣реАрдВ рд▓рдкреЗрдЯрддреЗ** рд╣реИрдВ (рджреБрд░реБрдкрдпреЛрдЧ рд╕реЗ рдмрдЪрдиреЗ рдХреЗ рд▓рд┐рдП)ред

### рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд╕рдореВрд╣, рд╕рддреНрд░ рдФрд░ рд╕рдВрдШрдЯрдирд╛рдПрдВ

**рдкреНрд░рдХреНрд░рд┐рдпрд╛рдПрдБ** рдХреЛ **рд╕рдореВрд╣реЛрдВ** рдореЗрдВ рдбрд╛рд▓рд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рддрд╛рдХрд┐ рдЙрдиреНрд╣реЗрдВ рд╕рдВрднрд╛рд▓рдирд╛ рдЖрд╕рд╛рди рд╣реЛред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рд╢реИрд▓ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдореЗрдВ рдЖрджреЗрд╢ рдПрдХ рд╣реА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд╕рдореВрд╣ рдореЗрдВ рд╣реЛрдВрдЧреЗ рддрд╛рдХрд┐ рдХрд┐рд▓ рдЬреИрд╕реЗ рдЙрдкрдХрд░рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ **рдЙрдиреНрд╣реЗрдВ рд╕рд╛рде рд╕рдВрдХреЗрддрд┐рдд** рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред\
рдпрд╣ рд╕рдВрднрд╛рд╡рдирд╛ рд╣реИ рдХрд┐ **рдкреНрд░рдХреНрд░рд┐рдпрд╛рдПрдБ рд╕рддреНрд░реЛрдВ рдореЗрдВ рд╕рдореВрд╣рд┐рдд** рдХреА рдЬрд╛рдПрдВред рдЬрдм рдПрдХ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдПрдХ рд╕рддреНрд░ рд╢реБрд░реВ рдХрд░рддреА рд╣реИ (`setsid(2)`), рддреЛ рдмрдЪреНрдЪреЗ рдкреНрд░рдХреНрд░рд┐рдпрд╛рдПрдБ рд╕рддреНрд░ рдХреЗ рдЕрдВрджрд░ рд╕реЗрдЯ рдХреА рдЬрд╛рддреА рд╣реИрдВ, рдЬрдм рддрдХ рд╡реЗ рдЕрдкрдирд╛ рдЦреБрдж рдХрд╛ рд╕рддреНрд░ рд╢реБрд░реВ рди рдХрд░реЗрдВред

рд╕рдВрдШрдЯрди рдПрдХ рдФрд░ рддрд░реАрдХрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ Darwin рдореЗрдВ рдкреНрд░рдХреНрд░рд┐рдпрд╛рдПрдБ рд╕рдореВрд╣рд┐рдд рдХреА рдЬрд╛рддреА рд╣реИрдВред рдПрдХ рд╕рдВрдШрдЯрди рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрдиреЗ рд╕реЗ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдкреВрд▓ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд╣реЛрддреА рд╣реИ, рдПрдХ рд▓реЗрдЬрд░ рд╕рд╛рдЭрд╛ рдХрд░рдирд╛ рдпрд╛ рдЬреЗрдЯреНрд╕рдо рдХрд╛ рд╕рд╛рдордирд╛ рдХрд░рдирд╛ред рд╕рдВрдШрдЯрдиреЛрдВ рдХреЗ рд╡рд┐рднрд┐рдиреНрди рднреВрдорд┐рдХрд╛рдПрдБ рд╣реЛрддреА рд╣реИрдВ: рдиреЗрддрд╛, XPC рд╕реЗрд╡рд╛, рдПрдХреНрд╕рдЯреЗрдВрд╢рдиред

### рдкрд░рд┐рдЪрдп рдФрд░ рд╡реНрдпрдХреНрддрд┐рддреНрд╡

рдкреНрд░рддреНрдпреЗрдХ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ **рдкрд░рд┐рдЪрдп** рд╣реЛрддрд╛ рд╣реИ рдЬреЛ **рд╕рд┐рд╕реНрдЯрдо рдореЗрдВ рдЙрд╕рдХреА рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреА рдкрд╣рдЪрд╛рди рдХрд░рддрд╛ рд╣реИ**ред рдкреНрд░рддреНрдпреЗрдХ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХрд╛ рдПрдХ рдореБрдЦреНрдп `uid` рдФрд░ рдПрдХ рдореБрдЦреНрдп `gid` рд╣реЛрдЧрд╛ (рд╣рд╛рд▓рд╛рдВрдХрд┐ рдХрдИ рд╕рдореВрд╣реЛрдВ рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ)ред\
рдпрджрд┐ рдмрд╛рдЗрдирд░реА рдореЗрдВ `setuid/setgid` рдмрд┐рдЯ рд╣реИ рддреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдФрд░ рд╕рдореВрд╣ рдЖрдИрдбреА рдХреЛ рдмрджрд▓рдирд╛ рд╕рдВрднрд╡ рд╣реИред\
рдирдП uids/gids рд╕реЗрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрдИ рдлрд╝рдВрдХреНрд╢рди рд╣реИрдВред

рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓ **`persona`** рдПрдХ **рд╡реИрдХрд▓реНрдкрд┐рдХ** рд╕реЗрдЯ рдХрд╛ **рдкрд░рд┐рдЪрдп** рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред рдПрдХ рдкрд░рд┐рдЪрдп рдХреЛ рдЕрдкрдирд╛рдиреЗ рд╕реЗ рдЙрд╕рдХрд╛ uid, gid рдФрд░ рд╕рдореВрд╣ рд╕рджрд╕реНрдпрддрд╛ **рдПрдХ рд╕рд╛рде** рдорд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИред [**рд╕реНрд░реЛрдд рдХреЛрдб**](https://github.com/apple/darwin-xnu/blob/main/bsd/sys/persona.h) рдореЗрдВ рд╕рдВрд░рдЪрдирд╛ рдкрд╛рдИ рдЬрд╛ рд╕рдХрддреА рд╣реИред
```c
struct kpersona_info { uint32_t persona_info_version;
uid_t    persona_id; /* overlaps with UID */
int      persona_type;
gid_t    persona_gid;
uint32_t persona_ngroups;
gid_t    persona_groups[NGROUPS];
uid_t    persona_gmuid;
char     persona_name[MAXLOGNAME + 1];

/* TODO: MAC policies?! */
}
```
## рдзрд╛рдЧреЛрдВ рдХреА рдореМрд▓рд┐рдХ рдЬрд╛рдирдХрд╛рд░реА

1. **POSIX рдзрд╛рдЧреЗ (pthreads):** macOS POSIX рдзрд╛рдЧреЛрдВ (`pthreads`) рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИ, рдЬреЛ C/C++ рдХреЗ рд▓рд┐рдП рдПрдХ рдорд╛рдирдХ рдзрд╛рдЧрд╛ API рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ рд╣реИред macOS рдореЗрдВ pthreads рдХрд╛ рдЕрдВрдорд▓ `/usr/lib/system/libsystem_pthread.dylib` рдореЗрдВ рдкрд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬреЛ рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рд░реВрдк рд╕реЗ рдЙрдкрд▓рдмреНрдз `libpthread` рдкрд░рд┐рдпреЛрдЬрдирд╛ рд╕реЗ рдЖрддрд╛ рд╣реИред рдпрд╣ рдкреБрд╕реНрддрдХрд╛рд▓рдп рдзрд╛рдЧреЗ рдмрдирд╛рдиреЗ рдФрд░ рдкреНрд░рдмрдВрдзрд┐рдд рдХрд░рдиреЗ рдХреЗ рдЖрд╡рд╢реНрдпрдХ рдХрд╛рд░реНрдп рд╕реБрдкреВрд░реНрдд рдХрд░рддреА рд╣реИред
2. **рдзрд╛рдЧреЗ рдмрдирд╛рдирд╛:** `pthread_create()` рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдирдП рдзрд╛рдЧреЗ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдЖрдВрддрд░рд┐рдХ рд░реВрдк рд╕реЗ, рдпрд╣ рдлрд╝рдВрдХреНрд╢рди `bsdthread_create()` рдХреЛ рдмреБрд▓рд╛рддрд╛ рд╣реИ, рдЬреЛ XNU рдХрд░реНрдиреЗрд▓ рдХреЗ рд▓рд┐рдП рд╡рд┐рд╢реЗрд╖ рд╣реИ (macOS рдкрд░ рдЖрдзрд╛рд░рд┐рдд рдХрд░реНрдиреЗрд▓)ред рдпрд╣ рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓ `pthread_attr` (рдЧреБрдг) рд╕реЗ рдкреНрд░рд╛рдкреНрдд рд╡рд┐рднрд┐рдиреНрди рдЭрдВрдбреЗ рд▓реЗрддрд╛ рд╣реИ рдЬреЛ рдзрд╛рдЧ рдХреЗ рд╡реНрдпрд╡рд╣рд╛рд░ рдХреЛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рддреЗ рд╣реИрдВ, рд╕рдореЗрдд рдЕрдиреБрд╕реВрдЪрдирд╛ рдиреАрддрд┐рдпреЛрдВ рдФрд░ рд╕реНрдЯреИрдХ рдХрд╛ рдЖрдХрд╛рд░ред
* **рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд╕реНрдЯреИрдХ рдХрд╛ рдЖрдХрд╛рд░:** рдирдП рдзрд╛рдЧреЛрдВ рдХреЗ рд▓рд┐рдП рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд╕реНрдЯреИрдХ рдХрд╛ рдЖрдХрд╛рд░ 512 KB рд╣реИ, рдЬреЛ рд╕рд╛рдорд╛рдиреНрдп рдХрд╛рд░реНрд░рд╡рд╛рдИ рдХреЗ рд▓рд┐рдП рдкрд░реНрдпрд╛рдкреНрдд рд╣реИ рд▓реЗрдХрд┐рди рдпрджрд┐ рдЕрдзрд┐рдХ рдпрд╛ рдХрдо рд╕реНрдерд╛рди рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛ рддреЛ рдзрд╛рдЧ рдЧреБрдгреЛрдВ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╕рдорд╛рдпреЛрдЬрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред
3. **рдзрд╛рдЧ рдкреНрд░рд╛рд░рдВрднреАрдХрд░рдг:** `__pthread_init()` рдлрд╝рдВрдХреНрд╢рди рдзрд╛рдЧ рд╕реЗрдЯрдЕрдк рдХреЗ рджреМрд░рд╛рди рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ, `env[]` рддрд░реНрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП рдкрд░реНрдпрд╛рд╡рд░рдг рдЪрд░реЛрдВ рдХреЛ рд╡рд┐рд╢реНрд▓реЗрд╖рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЬреЛ рд╕реНрдЯреИрдХ рдХреЗ рд╕реНрдерд╛рди рдФрд░ рдЖрдХрд╛рд░ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╡рд┐рд╡рд░рдг рд╢рд╛рдорд┐рд▓ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

#### macOS рдореЗрдВ рдзрд╛рдЧ рд╕рдорд╛рдкреНрддрд┐

1. **рдзрд╛рдЧреЛрдВ рдХреЛ рд╕рдорд╛рдкреНрдд рдХрд░рдирд╛:** рдзрд╛рдЧреЛрдВ рдХреЛ рд╕рд╛рдорд╛рдиреНрдпрдд: `pthread_exit()` рдмреБрд▓рд╛рдХрд░ рд╕рдорд╛рдкреНрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдпрд╣ рдлрд╝рдВрдХреНрд╢рди рдПрдХ рдзрд╛рдЧ рдХреЛ рд╕реНрд╡рдЪреНрдЫ рд░реВрдк рд╕реЗ рдмрд╛рд╣рд░ рдирд┐рдХрд▓рдиреЗ рджреЗрддрд╛ рд╣реИ, рдЖрд╡рд╢реНрдпрдХ рд╕рдлрд╛рдИ рдХрд░рддрд╛ рд╣реИ рдФрд░ рдзрд╛рдЧ рдХреЛ рдХрд┐рд╕реА рднреА joiners рдХреЛ рдПрдХ рд╡рд╛рдкрд╕реА рдореВрд▓реНрдп рднреЗрдЬрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред
2. **рдзрд╛рдЧ рд╕рдлрд╛рдИ:** `pthread_exit()` рдмреБрд▓рд╛рдиреЗ рдкрд░, `pthread_terminate()` рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдЖрдордВрддреНрд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬреЛ рд╕рднреА рд╕рдВрдмрдВрдзрд┐рдд рдзрд╛рдЧ рд╕рдВрд░рдЪрдирд╛рдУрдВ рдХреЛ рд╣рдЯрд╛рдиреЗ рдХрд╛ рд╕рдВрдмреЛрдзрди рдХрд░рддрд╛ рд╣реИред рдпрд╣ Mach рдзрд╛рдЧ рдкреЛрд░реНрдЯ (Mach XNU рдХрд░реНрдиреЗрд▓ рдореЗрдВ рд╕рдВрдЪрд╛рд░ рдЙрдкрдкреНрд░рдгрд╛рд▓реА рд╣реИ) рдХреЛ рдореБрдХреНрдд рдХрд░рддрд╛ рд╣реИ рдФрд░ `bsdthread_terminate` рдХреЛ рдмреБрд▓рд╛рддрд╛ рд╣реИ, рдПрдХ рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓ рдЬреЛ рдзрд╛рдЧ рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рдХрд░реНрдиреЗрд▓ рд╕реНрддрд░реАрдп рд╕рдВрд░рдЪрдирд╛рдУрдВ рдХреЛ рд╣рдЯрд╛рддрд╛ рд╣реИред

#### рд╕рдордХреНрд░рдордг рдпрд╛рдВрддреНрд░рд┐рдХрд┐рдпрд╛рдБ

рд╕рд╛рдЭреА рд╕рдВрд╕рд╛рдзрдиреЛрдВ рддрдХ рдкрд╣реБрдВрдЪ рдХреЛ рдкреНрд░рдмрдВрдзрд┐рдд рдХрд░рдиреЗ рдФрд░ рд░реЗрд╕ рд╢рд░реНрддреЛрдВ рд╕реЗ рдмрдЪрдиреЗ рдХреЗ рд▓рд┐рдП, macOS рдХрдИ рд╕рдордХреНрд░рдордг рдЖрдзрд╛рд░ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред рдпреЗ рдмрд╣реБ-рдзрд╛рдЧреАрдп рдкрд░рд┐рд╡реЗрд╢реЛрдВ рдореЗрдВ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИрдВ рддрд╛рдХрд┐ рдбреЗрдЯрд╛ рдЕрдЦрдВрдбрддрд╛ рдФрд░ рд╕рд┐рд╕реНрдЯрдо рд╕реНрдерд┐рд░рддрд╛ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХреА рдЬрд╛ рд╕рдХреЗ:

1. **рдореНрдпреВрдЯреЗрдХреНрд╕:**
* **рд╕рд╛рдорд╛рдиреНрдп рдореНрдпреВрдЯреЗрдХреНрд╕ (рд╣рд╕реНрддрд╛рдХреНрд╖рд░: 0x4D555458):** 60 рдмрд╛рдЗрдЯ рдХрд╛ рдорд╛рдирдХ рдореНрдпреВрдЯреЗрдХреНрд╕ (56 рдмрд╛рдЗрдЯ рдореНрдпреВрдЯреЗрдХреНрд╕ рдФрд░ 4 рдмрд╛рдЗрдЯ рд╣рд╕реНрддрд╛рдХреНрд╖рд░)ред
* **рдлрд╛рд╕реНрдЯ рдореНрдпреВрдЯреЗрдХреНрд╕ (рд╣рд╕реНрддрд╛рдХреНрд╖рд░: 0x4d55545A):** рд╕рд╛рдорд╛рдиреНрдп рдореНрдпреВрдЯреЗрдХреНрд╕ рдХреЗ рд╕рдорд╛рди рд╣реИ рд▓реЗрдХрд┐рди рддреЗрдЬ рдСрдкрд░реЗрд╢рди рдХреЗ рд▓рд┐рдП рдЕрдиреБрдХреВрд▓рд┐рдд рд╣реИ, рднреА 60 рдмрд╛рдЗрдЯ рдХрд╛ рдЖрдХрд╛рд░ред
2. **рд╕реНрдерд┐рддрд┐ рд╕рдВрджрд░реНрдн:**
* рдХрд┐рд╕реА рд╡рд┐рд╢реЗрд╖ рд╕реНрдерд┐рддрд┐ рдХреЗ рд╣реЛрдиреЗ рдХрд╛ рдЗрдВрддрдЬрд╛рд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, 44 рдмрд╛рдЗрдЯ рдХрд╛ рдЖрдХрд╛рд░ рд╣реИ (40 рдмрд╛рдЗрдЯ рдкреНрд▓рд╕ 4 рдмрд╛рдЗрдЯ рд╣рд╕реНрддрд╛рдХреНрд╖рд░)ред
* **рд╕реНрдерд┐рддрд┐ рд╕рдВрджрд░реНрдн рдЧреБрдг (рд╣рд╕реНрддрд╛рдХреНрд╖рд░: 0x434e4441):** рд╕реНрдерд┐рддрд┐ рд╕рдВрджрд░реНрдн рдХреЗ рд▓рд┐рдП рд╡рд┐рдиреНрдпрд╛рд╕ рдЧреБрдг, 12 рдмрд╛рдЗрдЯ рдХрд╛ рдЖрдХрд╛рд░ рд╣реИред
3. **рдПрдХ рдмрд╛рд░ рдЪрд░ (рд╣рд╕реНрддрд╛рдХреНрд╖рд░: 0x4f4e4345):**
* рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдкреНрд░рд╛рд░рдВрднреАрдХрд░рдг рдХреЛрдб рдХреЗрд╡рд▓ рдПрдХ рдмрд╛рд░ рд╣реА рдЪрд▓рд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдЗрд╕рдХрд╛ рдЖрдХрд╛рд░ 12 рдмрд╛рдЗрдЯ рд╣реИред
4. **рдкрдарди-рд▓реЗрдЦрди рддрд╛рд▓рд┐рдХрд╛:**
* рдПрдХ рд╕рдордп рдореЗрдВ рдХрдИ рдкрд╛рдардХ рдпрд╛ рдПрдХ рд▓реЗрдЦрдХ рдХреЛ рдПрдХ рд╕рд╛рде рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, рд╕рд╛рдЭрд╛ рдбреЗрдЯрд╛ рддрдХ рдкрд╣реБрдВрдЪ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреБрд╢рд▓рддрд╛рдкреВрд░реНрд╡рдХред
* **рдкрдарди-рд▓реЗрдЦрди рддрд╛рд▓рд┐рдХрд╛ (рд╣рд╕реНрддрд╛рдХреНрд╖рд░: 0x52574c4b):** 196 рдмрд╛рдЗрдЯ рдХрд╛ рдЖрдХрд╛рд░ рд╣реИред
* **рдкрдарди-рд▓реЗрдЦрди рддрд╛рд▓рд┐рдХрд╛ рдЧреБрдг (рд╣рд╕реНрддрд╛рдХреНрд╖рд░: 0x52574c41):** рдкрдарди-рд▓реЗрдЦрди рддрд╛рд▓рд┐рдХреЛрдВ рдХреЗ рд▓рд┐рдП рдЧреБрдг, 20 рдмрд╛рдЗрдЯ рдХрд╛ рдЖрдХрд╛рд░ рд╣реИред

{% hint style="success" %}
рдЙрди рд╡рд╕реНрддреБрдУрдВ рдХреЗ рдЕрдВрддрд┐рдо 4 рдмрд╛рдЗрдЯ рдУрд╡рд░рдлреНрд▓реЛ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВред
{% endhint %}

### рдзрд╛рдЧ рд╕реНрдерд╛рдирд┐рдХ рдЪрд░

**рдзрд╛рдЧ рд╕реНрдерд╛рдирд┐рдХ рдЪрд░ (TLV)** Mach-O рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЗ рд╕рдВрджрд░реНрдн рдореЗрдВ (macOS рдореЗрдВ рдПрдХреНрдЬреАрдХреНрдпреВрдЯреЗрдмрд▓реНрд╕ рдХреЗ рд▓рд┐рдП рдкреНрд░рд╛рд░реВрдк) рдкреНрд░рддреНрдпреЗрдХ рдзрд╛рдЧ рдореЗрдВ рд╡рд┐рд╢реЗрд╖ рдЪрд░ рдХреА рдШреЛрд╖рдгрд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВред рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдкреНрд░рддреНрдпреЗрдХ рдзрд╛рдЧ рдХреЗ рдкрд╛рд╕ рдПрдХ рдЕрд▓рдЧ рдЪрд░ рдХреА рдПрдХ рдЕрд▓рдЧ рдЙрджрд╛рд╣рд░рдг рд╣реИ, рдПрдХ рдЪрд░ рдХреЗ рд╕рдВрдШрд░реНрд╖ рдХреЛ рдЯрд╛рд▓рдиреЗ рдФрд░ рдорд╛рдирдХ рдпреЛрдЧреНрдпрддрд╛ рдмрдирд╛рдП рд░рдЦрдиреЗ рдХрд╛ рдПрдХ рддрд░реАрдХрд╛ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ рдмрд┐рдирд╛ рдореНрдпреВрдЯреЗрдХреНрд╕ рдЬреИрд╕реЗ рд╕рдордХреНрд░рдордг рдпрдВрддреНрд░рд┐рдпреЛрдВ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдХреЗ рдмрд┐рдирд╛ред

C рдФрд░ рд╕рдВрдмрдВрдзрд┐рдд рднрд╛рд╖рд╛рдУрдВ рдореЗрдВ, рдЖрдк **`__thread`** рдХреАрд╡рд░реНрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ рдзрд╛рдЧ рд╕реНрдерд╛рдирд┐рдХ рдЪрд░ рдХреА рдШреЛрд╖рдгрд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдпрд╣рд╛рдБ рдЖрдкрдХреЗ рдЙрджрд╛рд╣рд░рдг рдореЗрдВ рдпрд╣ рдХреИрд╕реЗ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ:
```c
cCopy code__thread int tlv_var;

void main (int argc, char **argv){
tlv_var = 10;
}
```
рдпрд╣ рд╕реНрдирд┐рдкреЗрдЯ `tlv_var` рдХреЛ рдПрдХ рдереНрд░реЗрдб-рд╕реНрдерд╛рдирд┐рдХ рдЪрд░ рдХреЗ рд░реВрдк рдореЗрдВ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рддрд╛ рд╣реИред рдЗрд╕ рдХреЛрдб рдХреЛ рдЪрд▓рд╛рдиреЗ рд╡рд╛рд▓реА рдкреНрд░рддреНрдпреЗрдХ рдереНрд░реЗрдб рдХреЗ рдкрд╛рд╕ рдЕрдкрдирд╛ рдЦреБрдж рдХрд╛ `tlv_var` рд╣реЛрдЧрд╛, рдФрд░ рдПрдХ рдереНрд░реЗрдб рдЬреЛ `tlv_var` рдореЗрдВ рдХреЛрдИ рдкрд░рд┐рд╡рд░реНрддрди рдХрд░рддрд╛ рд╣реИ, рд╡рд╣ рджреВрд╕рд░реЗ рдереНрд░реЗрдб рдореЗрдВ `tlv_var` рдХреЛ рдкреНрд░рднрд╛рд╡рд┐рдд рдирд╣реАрдВ рдХрд░реЗрдЧрд╛ред

Mach-O рдмрд╛рдЗрдирд░реА рдореЗрдВ, рдереНрд░реЗрдб рд╕реНрдерд╛рдирд┐рдХ рдЪрд░ рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рдбреЗрдЯрд╛ рдХреЛ рд╡рд┐рд╢реЗрд╖ рдЦрдВрдбреЛрдВ рдореЗрдВ рд╡реНрдпрд╡рд╕реНрдерд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ:

* **`__DATA.__thread_vars`**: рдЗрд╕ рдЦрдВрдб рдореЗрдВ рдереНрд░реЗрдб-рд╕реНрдерд╛рдирд┐рдХ рдЪрд░реЛрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдореЗрдЯрд╛рдбреЗрдЯрд╛ рд╣реЛрддрд╛ рд╣реИ, рдЬреИрд╕реЗ рдЙрдирдХреЗ рдкреНрд░рдХрд╛рд░ рдФрд░ рдкреНрд░рд╛рд░рдВрднреАрдХрд░рдг рд╕реНрдерд┐рддрд┐ред
* **`__DATA.__thread_bss`**: рдпрд╣ рдЦрдВрдб рдЙрди рдереНрд░реЗрдб-рд╕реНрдерд╛рдирд┐рдХ рдЪрд░реЛрдВ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬрд┐рдиреНрд╣реЗрдВ рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рдкреНрд░рд╛рд░рдВрднрд┐рдд рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред рдпрд╣ рдПрдХ рднрд╛рдЧ рд╣реИ рдЬреЛ рд╢реВрдиреНрдп-рдкреНрд░рд╛рд░рдВрднрд┐рдд рдбреЗрдЯрд╛ рдХреЗ рд▓рд┐рдП рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред

Mach-O рдПрдХ рд╡рд┐рд╢реЗрд╖ API рднреА рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ рдЬрд┐рд╕реЗ **`tlv_atexit`** рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ рдереНрд░реЗрдб-рд╕реНрдерд╛рдирд┐рдХ рдЪрд░реЛрдВ рдХреЛ рдкреНрд░рдмрдВрдзрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЬрдм рдПрдХ рдереНрд░реЗрдб рд╕рдорд╛рдкреНрдд рд╣реЛрддрд╛ рд╣реИред рдпрд╣ API рдЖрдкрдХреЛ **рдбрд┐рд╕реНрдЯреНрд░рдХреНрдЯрд░реЛрдВ рдХреЛ рд░рдЬрд┐рд╕реНрдЯрд░** рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИтАФрд╡рд┐рд╢реЗрд╖ рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рд╕рд╛рдл рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдлрд╝рдВрдХреНрд╢рди рдЬрдм рдПрдХ рдереНрд░реЗрдб рд╕рдорд╛рдкреНрдд рд╣реЛрддрд╛ рд╣реИред
### Python Injection

рдпрджрд┐ рдкрд░реНрдпрд╛рд╡рд░рдг рдЪрд░ **`PYTHONINSPECT`** рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рддреЛ рдкрд╛рдпрдерди рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдПрдХ рдкрд╛рдпрдерди cli рдореЗрдВ рдбреНрд░реЙрдк рдХрд░ рджреЗрдЧреА рдЬрдм рд╡рд╣ рд╕рдорд╛рдкреНрдд рд╣реЛ рдЬрд╛рдПрдЧреАред рдПрдХ рдЗрдВрдЯрд░реИрдХреНрдЯрд┐рд╡ рд╕рддреНрд░ рдХреА рд╢реБрд░реБрдЖрдд рдореЗрдВ рдПрдХ рдкрд╛рдпрдерди рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП **`PYTHONSTARTUP`** рдХрд╛ рдЙрдкрдпреЛрдЧ рднреА рд╕рдВрднрд╡ рд╣реИред\
рд╣рд╛рд▓рд╛рдВрдХрд┐, рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ **`PYTHONINSPECT`** рдЗрдВрдЯрд░реИрдХреНрдЯрд┐рд╡ рд╕рддреНрд░ рдмрдирд╛рддреЗ рд╕рдордп **`PYTHONSTARTUP`** рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдирд╣реАрдВ рдХрд░реЗрдЧрд╛ред

**`PYTHONPATH`** рдФрд░ **`PYTHONHOME`** рдЬреИрд╕реЗ рдЕрдиреНрдп рдПрдирд╡реА рдЪрд░ рднреА рдПрдХ рдкрд╛рдпрдерди рдХрдорд╛рдВрдб рдХреЛ рд╡рд┐рдЪрд╛рд░рд╢реАрд▓ рдХреЛрдб рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред

рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ **`pyinstaller`** рдХреЗ рд╕рд╛рде рдХреЙрдореНрдкрд╛рдЗрд▓ рдХрд┐рдП рдЧрдП рдПрдХреНрдЬреАрдХреНрдпреВрдЯреЗрдмрд▓реНрд╕ рдЗрди рдкрд░реНрдпрд╛рд╡рд░рдг рдЪрд░реЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░реЗрдВрдЧреЗ, рднрд▓реЗ рд╣реА рд╡реЗ рдПрдХ рдПрдореНрдмреЗрдбреЗрдб рдкрд╛рдпрдерди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЪрд▓ рд░рд╣реЗ рд╣реЛрдВред

{% hint style="danger" %}
рд╕рдордЧреНрд░ рдореИрдВрдиреЗ рдХрд┐рд╕реА рднреА рддрд░реАрдХреЗ рд╕реЗ рдирд╣реАрдВ рдкрд╛рдпрд╛ рдХрд┐ рдкрд╛рдпрдерди рдХреЛ рдкрд░реНрдпрд╛рд╡рд░рдг рдЪрд░реЛрдВ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╡рд┐рдЪрд╛рд░рд╢реАрд▓ рдХреЛрдб рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХрд╛ рдХреЛрдИ рддрд░реАрдХрд╛ рд╣реИред\
рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЕрдзрд┐рдХрд╛рдВрд╢ рд▓реЛрдЧ **Hombrew** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкрд╛рдпрдерди рдХреЛ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рддреЗ рд╣реИрдВ, рдЬреЛ рдПрдХ **рд▓рд┐рдЦрдиреЗ рдпреЛрдЧреНрдп рд╕реНрдерд╛рди** рдореЗрдВ рдкрд╛рдпрдерди рд╕реНрдерд╛рдкрд┐рдд рдХрд░реЗрдЧрд╛ред рдЖрдк рдЗрд╕реЗ рдХреБрдЫ рдЗрд╕ рдкреНрд░рдХрд╛рд░ рд╕реЗ рд╣рд╛рдЗрдЬреИрдХ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
mv /opt/homebrew/bin/python3 /opt/homebrew/bin/python3.old
cat > /opt/homebrew/bin/python3 <<EOF
#!/bin/bash
# Extra hijack code
/opt/homebrew/bin/python3.old "$@"
EOF
chmod +x /opt/homebrew/bin/python3
```
рдпрд╣ рдХреЛрдб рдЪрд▓рд╛рдиреЗ рдкрд░ **root** рднреА рдЗрд╕ рдХреЛрдб рдХреЛ рдЪрд▓рд╛рдПрдЧрд╛ рдЬрдм python рдЪрд▓рд╛рдпрд╛ рдЬрд╛рдПрдЧрд╛ред
{% endhint %}

## рдкрддрд╛ рд▓рдЧрд╛рдирд╛

### рдврд╛рд▓

[**рдврд╛рд▓**](https://theevilbit.github.io/shield/) ([**Github**](https://github.com/theevilbit/Shield)) рдПрдХ рдУрдкрди рд╕реЛрд░реНрд╕ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд╣реИ рдЬреЛ **рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдЗрдВрдЬреЗрдХреНрд╢рди рдХреА рдкрд╣рдЪрд╛рди рдФрд░ рдмреНрд▓реЙрдХ** рдХрд░ рд╕рдХрддрд╛ рд╣реИ:

* **рдкрд░реНрдпрд╛рд╡рд░рдгреАрдп рдЪрд░** рдХрд╛ рдЙрдкрдпреЛрдЧ: рдпрд╣ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкрд░реНрдпрд╛рд╡рд░рдгреАрдп рдЪрд░реЛрдВ рдХреА рдореМрдЬреВрджрдЧреА рдХрд╛ рдореЙрдирд┐рдЯрд░ рдХрд░реЗрдЧрд╛: **`DYLD_INSERT_LIBRARIES`**, **`CFNETWORK_LIBRARY_PATH`**, **`RAWCAMERA_BUNDLE_PATH`** рдФрд░ **`ELECTRON_RUN_AS_NODE`**
* **`task_for_pid`** рдХреЙрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ: рдПрдХ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рджреВрд╕рд░реЗ рдХреА **рдХрд╛рд░реНрдп рдкреЛрд░реНрдЯ** рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рдЪрд╛рд╣рддреА рд╣реИ рдЬрд┐рд╕рд╕реЗ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рдХреЛрдб рдЗрдВрдЬреЗрдХреНрдЯ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред
* **Electron рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдкреИрд░рд╛рдореАрдЯрд░**: рдХреЛрдИ **`--inspect`**, **`--inspect-brk`** рдФрд░ **`--remote-debugging-port`** рдХрдорд╛рдВрдб рд▓рд╛рдЗрди рддрд░реНрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдПрдХ Electron рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рдбреАрдмрдЧрд┐рдВрдЧ рдореЛрдб рдореЗрдВ рд╢реБрд░реВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдФрд░ рдЗрд╕реЗ рдЗрдВрдЬреЗрдХреНрдЯ рдХрд░ рд╕рдХрддрд╛ рд╣реИред
* **рд╕рд┐рдорд▓рд┐рдВрдХреНрд╕** рдпрд╛ **рд╣рд╛рд░реНрдбрд▓рд┐рдВрдХреНрд╕** рдХрд╛ рдЙрдкрдпреЛрдЧ: рд╕рд╛рдорд╛рдиреНрдпрдд: рд╕рдмрд╕реЗ рдЖрдо рджреБрд░реБрдкрдпреЛрдЧ рд╣реИ рдХрд┐ **рд╣рдорд╛рд░реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЗ рд╕рд╛рде рдПрдХ рд▓рд┐рдВрдХ рд░рдЦреЗрдВ**, рдФрд░ рдЙрд╕реЗ рдЙрдЪреНрдЪ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╕реНрдерд╛рди рдкрд░ рдкреЙрдЗрдВрдЯ рдХрд░реЗрдВред рд╣рд╛рд░реНрдбрд▓рд┐рдВрдХ рдФрд░ рд╕рд┐рдорд▓рд┐рдВрдХреНрд╕ рдХреЗ рд▓рд┐рдП рдкрд╣рдЪрд╛рди рдмрд╣реБрдд рд╕рд░рд▓ рд╣реИред рдпрджрд┐ рд▓рд┐рдВрдХ рдмрдирд╛рдиреЗ рд╡рд╛рд▓реА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХрд╛ **рд╡рд┐рднрд┐рдиреНрди рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╕реНрддрд░** рд╣реИ рддреЛ рд╣рдо рдПрдХ **рдЕрд▓рд░реНрдЯ** рдмрдирд╛рддреЗ рд╣реИрдВред рджреБрд░реНрднрд╛рдЧреНрдпрд╡рд╢: рд╕рд┐рдорд▓рд┐рдВрдХреНрд╕ рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ рдмреНрд▓реЙрдХрд┐рдВрдЧ рд╕рдВрднрд╡ рдирд╣реАрдВ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рд╣рдореЗрдВ рд▓рд┐рдВрдХ рдХреЗ рдЧрдВрддрд╡реНрдп рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА рдкрд╣рд▓реЗ рд╕реЗ рдирд╣реАрдВ рд╣реИред рдпрд╣ Apple рдХреЗ EndpointSecuriy framework рдХреА рдПрдХ рд╕реАрдорд╛ рд╣реИред

### рдЕрдиреНрдп рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рджреНрд╡рд╛рд░рд╛ рдХреА рдЧрдИ рдХреЙрд▓

[**рдЗрд╕ рдмреНрд▓реЙрдЧ рдкреЛрд╕реНрдЯ**](https://knight.sc/reverse%20engineering/2019/04/15/detecting-task-modifications.html) рдореЗрдВ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдХреИрд╕реЗ рдлрд╝рдВрдХреНрд╢рди **`task_name_for_pid`** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рдХреЛрдб рдЗрдВрдЬреЗрдХреНрдЯ рдХрд░рдиреЗ рд╡рд╛рд▓реА рдЕрдиреНрдп **рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА рдкреНрд░рд╛рдкреНрдд** рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИ рдФрд░ рдлрд┐рд░ рдЙрд╕ рдЕрдиреНрдп рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА рдкреНрд░рд╛рдкреНрдд рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИред

рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдЙрд╕ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдХреЙрд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдЪрд▓рд╛рдиреЗ рд╡рд╛рд▓реЗ рд╡реНрдпрдХреНрддрд┐ рдХреЗ **рдПрдХ рд╣реА uid** рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП рдпрд╛ **root** (рдФрд░ рдпрд╣ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА рджреЗрддрд╛ рд╣реИ, рдХреЛрдб рдЗрдВрдЬреЗрдХреНрдЯ рдХрд░рдиреЗ рдХрд╛ рдПрдХ рддрд░реАрдХрд╛ рдирд╣реАрдВ)ред

## рд╕рдВрджрд░реНрдн

* [https://theevilbit.github.io/shield/](https://theevilbit.github.io/shield/)
* [https://medium.com/@metnew/why-electron-apps-cant-store-your-secrets-confidentially-inspect-option-a49950d6d51f](https://medium.com/@metnew/why-electron-apps-cant-store-your-secrets-confidentially-inspect-option-a49950d6d51f)

<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди **HackTricks** рдореЗрдВ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб** рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рдХрд▓реЗрдХреНрд╢рди [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдЦреЛрдЬреЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@carlospolopm**](https://twitter.com/hacktricks\_live)** рдкрд░ **рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ** рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рдХреЛ **HackTricks** рдФрд░ **HackTricks Cloud** github repos рдкрд░ PR рдЬрдорд╛ рдХрд░рдХреЗред

</details>
