# macOS рдРрдкреНрд╕ - рдирд┐рд░реАрдХреНрд╖рдг, рдбрд┐рдмрдЧрд┐рдВрдЧ рдФрд░ рдлрдЬрд╝рд┐рдВрдЧ

<details>

<summary><strong>AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рд╢реВрдиреНрдп рд╕реЗ рд▓реЗрдХрд░ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS рд░реЗрдб рдЯреАрдо рдПрдХреНрд╕рдкрд░реНрдЯ)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ**, рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* ЁЯТм [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ [**telegram рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ рдпрд╛ **Twitter** ЁЯРж рдкрд░ рдореБрдЭреЗ **рдлреЙрд▓реЛ** рдХрд░реЗрдВ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **HackTricks** рдХреЗ [**github рд░реЗрдкреЛрдЬрд╝**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ.

</details>

## рд╕реНрдЯреИрдЯрд┐рдХ рд╡рд┐рд╢реНрд▓реЗрд╖рдг

### otool
```bash
otool -L /bin/ls #List dynamically linked libraries
otool -tv /bin/ps #Decompile application
```
### objdump

{% code overflow="wrap" %}
```bash
objdump -m --dylibs-used /bin/ls #List dynamically linked libraries
objdump -m -h /bin/ls # Get headers information
objdump -m --syms /bin/ls # Check if the symbol table exists to get function names
objdump -m --full-contents /bin/ls # Dump every section
objdump -d /bin/ls # Dissasemble the binary
objdump --disassemble-symbols=_hello --x86-asm-syntax=intel toolsdemo #Disassemble a function using intel flavour
```
{% endcode %}

### jtool2

рдпрд╣ рдЯреВрд▓ **codesign**, **otool**, рдФрд░ **objdump** рдХреЗ рд▓рд┐рдП рдПрдХ **рдкреНрд░рддрд┐рд╕реНрдерд╛рдкрди** рдХреЗ рд░реВрдк рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдФрд░ рдХреБрдЫ рдЕрддрд┐рд░рд┐рдХреНрдд рд╕реБрд╡рд┐рдзрд╛рдПрдБ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред [**рдпрд╣рд╛рдБ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ**](http://www.newosxbook.com/tools/jtool.html) рдпрд╛ `brew` рдХреЗ рд╕рд╛рде рдЗрдВрд╕реНрдЯреЙрд▓ рдХрд░реЗрдВред
```bash
# Install
brew install --cask jtool2

jtool2 -l /bin/ls # Get commands (headers)
jtool2 -L /bin/ls # Get libraries
jtool2 -S /bin/ls # Get symbol info
jtool2 -d /bin/ls # Dump binary
jtool2 -D /bin/ls # Decompile binary

# Get signature information
ARCH=x86_64 jtool2 --sig /System/Applications/Automator.app/Contents/MacOS/Automator

# Get MIG information
jtool2 -d __DATA.__const myipc_server | grep MIG
```
### Codesign / ldid

{% hint style="danger" %}
**`Codesign`** рдХрд╛ рдЙрдкрдпреЛрдЧ **macOS** рдореЗрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдЬрдмрдХрд┐ **`ldid`** рдХрд╛ рдЙрдкрдпреЛрдЧ **iOS** рдореЗрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред
{% endhint %}
```bash
# Get signer
codesign -vv -d /bin/ls 2>&1 | grep -E "Authority|TeamIdentifier"

# Check if the appтАЩs contents have been modified
codesign --verify --verbose /Applications/Safari.app

# Get entitlements from the binary
codesign -d --entitlements :- /System/Applications/Automator.app # Check the TCC perms

# Check if the signature is valid
spctl --assess --verbose /Applications/Safari.app

# Sign a binary
codesign -s <cert-name-keychain> toolsdemo

# Get signature info
ldid -h <binary>

# Get entitlements
ldid -e <binary>

# Change entilements
## /tmp/entl.xml is a XML file with the new entitlements to add
ldid -S/tmp/entl.xml <binary>
```
### SuspiciousPackage

[**SuspiciousPackage**](https://mothersruin.com/software/SuspiciousPackage/get.html) рдПрдХ рдЙрдкрдХрд░рдг рд╣реИ рдЬреЛ **.pkg** рдлрд╛рдЗрд▓реЛрдВ (рдЗрдВрд╕реНрдЯреЙрд▓рд░реНрд╕) рдХрд╛ рдирд┐рд░реАрдХреНрд╖рдг рдХрд░рдиреЗ рдореЗрдВ рд╕рд╣рд╛рдпрдХ рд╣реИ рдФрд░ рдЗрд╕реЗ рдЗрдВрд╕реНрдЯреЙрд▓ рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдЕрдВрджрд░ рдХреНрдпрд╛ рд╣реИред\
рдЗрди рдЗрдВрд╕реНрдЯреЙрд▓рд░реНрд╕ рдореЗрдВ `preinstall` рдФрд░ `postinstall` рдмреИрд╢ рд╕реНрдХреНрд░рд┐рдкреНрдЯреНрд╕ рд╣реЛрддреА рд╣реИрдВ рдЬрд┐рдирдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдореИрд▓рд╡реЗрдпрд░ рд▓реЗрдЦрдХ рдЖрдорддреМрд░ рдкрд░ **рдореИрд▓рд╡реЗрдпрд░** рдХреЛ **рдмрдирд╛рдП** **рд░рдЦрдиреЗ** рдХреЗ рд▓рд┐рдП рдХрд░рддреЗ рд╣реИрдВред

### hdiutil

рдпрд╣ рдЙрдкрдХрд░рдг Apple рдбрд┐рд╕реНрдХ рдЗрдореЗрдЬреЗрдЬ (**.dmg**) рдлрд╛рдЗрд▓реЛрдВ рдХреЛ **рдорд╛рдЙрдВрдЯ** рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ рддрд╛рдХрд┐ рдЙрдиреНрд╣реЗрдВ рдХреБрдЫ рднреА рдЪрд▓рд╛рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдирд┐рд░реАрдХреНрд╖рдг рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗ:
```bash
hdiutil attach ~/Downloads/Firefox\ 58.0.2.dmg
```
рдпрд╣ `/Volumes` рдореЗрдВ рдорд╛рдЙрдВрдЯ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛

### Objective-C

#### рдореЗрдЯрд╛рдбреЗрдЯрд╛

{% hint style="danger" %}
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ Objective-C рдореЗрдВ рд▓рд┐рдЦреЗ рдЧрдП рдкреНрд░реЛрдЧреНрд░рд╛рдо [Mach-O binaries](../macos-files-folders-and-binaries/universal-binaries-and-mach-o-format.md) рдореЗрдВ **рд╕рдВрдХрд▓рд┐рдд** рд╣реЛрдиреЗ рдкрд░ рднреА рдЕрдкрдиреЗ рдХреНрд▓рд╛рд╕ рдШреЛрд╖рдгрд╛рдУрдВ рдХреЛ **рдмрдирд╛рдП** **рд░рдЦрддреЗ** рд╣реИрдВред рдРрд╕реА рдХреНрд▓рд╛рд╕ рдШреЛрд╖рдгрд╛рдПрдБ **рд╢рд╛рдорд┐рд▓** рдХрд░рддреА рд╣реИрдВ:
{% endhint %}

* рдХреНрд▓рд╛рд╕ рдХрд╛ рдирд╛рдо
* рдХреНрд▓рд╛рд╕ рдХреЗ рддрд░реАрдХреЗ
* рдХреНрд▓рд╛рд╕ рдХреЗ рдЗрдВрд╕реНрдЯреЗрдВрд╕ рд╡реЗрд░рд┐рдПрдмрд▓реНрд╕

рдЖрдк рдЗрд╕ рдЬрд╛рдирдХрд╛рд░реА рдХреЛ [**class-dump**](https://github.com/nygard/class-dump) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
class-dump Kindle.app
```
#### рдлрдВрдХреНрд╢рди рдХреЙрд▓рд┐рдВрдЧ

рдЬрдм рдПрдХ рдлрдВрдХреНрд╢рди рдХреЛ рдПрдХ рдмрд╛рдЗрдирд░реА рдореЗрдВ рдХреЙрд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬреЛ рдСрдмреНрдЬреЗрдХреНрдЯрд┐рд╡-рд╕реА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ, рддреЛ рд╕рдВрдХрд▓рд┐рдд рдХреЛрдб рдЙрд╕ рдлрдВрдХреНрд╢рди рдХреЛ рдХреЙрд▓ рдХрд░рдиреЗ рдХреЗ рдмрдЬрд╛рдп, рдпрд╣ **`objc_msgSend`** рдХреЛ рдХреЙрд▓ рдХрд░реЗрдЧрд╛ред рдЬреЛ рдЕрдВрддрд┐рдо рдлрдВрдХреНрд╢рди рдХреЛ рдХреЙрд▓ рдХрд░реЗрдЧрд╛:

![](<../../../.gitbook/assets/image (560).png>)

рдЗрд╕ рдлрдВрдХреНрд╢рди рдХреА рдЕрдкреЗрдХреНрд╖рд┐рдд рдкреИрд░рд╛рдореАрдЯрд░реНрд╕ рдпреЗ рд╣реИрдВ:

* рдкрд╣рд▓рд╛ рдкреИрд░рд╛рдореАрдЯрд░ (**self**) "рдПрдХ рдкреЙрдЗрдВрдЯрд░ рд╣реИ рдЬреЛ **рдХреНрд▓рд╛рд╕ рдХреЗ рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдХреЛ рдЗрдВрдЧрд┐рдд рдХрд░рддрд╛ рд╣реИ рдЬрд┐рд╕реЗ рдореИрд╕реЗрдЬ рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рд╣реИ**"ред рдпрд╛ рдЕрдзрд┐рдХ рд╕рд░рд▓ рд╢рдмреНрджреЛрдВ рдореЗрдВ, рдпрд╣ рд╡рд╣ рдСрдмреНрдЬреЗрдХреНрдЯ рд╣реИ рдЬрд┐рд╕ рдкрд░ рдореЗрдердб рдХреЛ рдЗрдиреНрд╡реЛрдХ рдХрд┐рдпрд╛ рдЬрд╛ рд░рд╣рд╛ рд╣реИред рдЕрдЧрд░ рдореЗрдердб рдПрдХ рдХреНрд▓рд╛рд╕ рдореЗрдердб рд╣реИ, рддреЛ рдпрд╣ рдХреНрд▓рд╛рд╕ рдСрдмреНрдЬреЗрдХреНрдЯ рдХрд╛ рдПрдХ рдЗрдВрд╕реНрдЯреЗрдВрд╕ рд╣реЛрдЧрд╛ (рдкреВрд░реЗ рдХреЗ рд░реВрдк рдореЗрдВ), рдЬрдмрдХрд┐ рдПрдХ рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдореЗрдердб рдХреЗ рд▓рд┐рдП, self рдПрдХ рдЗрдВрд╕реНрдЯреЗрдВрд╢рд┐рдПрдЯреЗрдб рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдХреЛ рдЗрдВрдЧрд┐рдд рдХрд░реЗрдЧрд╛ред
* рджреВрд╕рд░рд╛ рдкреИрд░рд╛рдореАрдЯрд░, (**op**), "рд╡рд╣ рд╕реЗрд▓реЗрдХреНрдЯрд░ рд╣реИ рдЬреЛ рдореИрд╕реЗрдЬ рдХреЛ рд╣реИрдВрдбрд▓ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдореЗрдердб рдХрд╛ рд╣реИ"ред рдлрд┐рд░ рд╕реЗ, рдЕрдзрд┐рдХ рд╕рд░рд▓ рд╢рдмреНрджреЛрдВ рдореЗрдВ, рдпрд╣ рд╕рд┐рд░реНрдл **рдореЗрдердб рдХрд╛ рдирд╛рдо рд╣реИред**
* рд╢реЗрд╖ рдкреИрд░рд╛рдореАрдЯрд░реНрд╕ рд╡реЗ **рдорд╛рди рд╣реИрдВ рдЬреЛ рдореЗрдердб рджреНрд╡рд╛рд░рд╛ рдЖрд╡рд╢реНрдпрдХ рд╣реИрдВ** (op)ред

| **рдЖрд░реНрдЧреНрдпреБрдореЗрдВрдЯ**      | **рд░рдЬрд┐рд╕реНрдЯрд░**                                                    | **(рдХреЗ рд▓рд┐рдП) objc\_msgSend**                                |
| ----------------- | --------------------------------------------------------------- | ------------------------------------------------------ |
| **рдкрд╣рд▓рд╛ рдЖрд░реНрдЧреНрдпреБрдореЗрдВрдЯ**  | **rdi**                                                         | **self: рдСрдмреНрдЬреЗрдХреНрдЯ рдЬрд┐рд╕ рдкрд░ рдореЗрдердб рдХреЛ рдЗрдиреНрд╡реЛрдХ рдХрд┐рдпрд╛ рдЬрд╛ рд░рд╣рд╛ рд╣реИ** |
| **рджреВрд╕рд░рд╛ рдЖрд░реНрдЧреНрдпреБрдореЗрдВрдЯ**  | **rsi**                                                         | **op: рдореЗрдердб рдХрд╛ рдирд╛рдо**                                     |
| **рддреАрд╕рд░рд╛ рдЖрд░реНрдЧреНрдпреБрдореЗрдВрдЯ**  | **rdx**                                                         | **рдореЗрдердб рдХрд╛ рдкрд╣рд▓рд╛ рдЖрд░реНрдЧреНрдпреБрдореЗрдВрдЯ**                           |
| **рдЪреМрдерд╛ рдЖрд░реНрдЧреНрдпреБрдореЗрдВрдЯ**  | **rcx**                                                         | **рдореЗрдердб рдХрд╛ рджреВрд╕рд░рд╛ рдЖрд░реНрдЧреНрдпреБрдореЗрдВрдЯ**                           |
| **рдкрд╛рдВрдЪрд╡рд╛рдВ рдЖрд░реНрдЧреНрдпреБрдореЗрдВрдЯ**  | **r8**                                                          | **рдореЗрдердб рдХрд╛ рддреАрд╕рд░рд╛ рдЖрд░реНрдЧреНрдпреБрдореЗрдВрдЯ**                           |
| **рдЫрдард╛ рдЖрд░реНрдЧреНрдпреБрдореЗрдВрдЯ**  | **r9**                                                          | **рдореЗрдердб рдХрд╛ рдЪреМрдерд╛ рдЖрд░реНрдЧреНрдпреБрдореЗрдВрдЯ**                           |
| **рд╕рд╛рддрд╡рд╛рдВ+ рдЖрд░реНрдЧреНрдпреБрдореЗрдВрдЯ** | <p><strong>rsp+</strong><br><strong>(рд╕реНрдЯреИрдХ рдкрд░)</strong></p> | **рдореЗрдердб рдХрд╛ рдкрд╛рдВрдЪрд╡рд╛рдВ+ рдЖрд░реНрдЧреНрдпреБрдореЗрдВрдЯ**                        |

### Swift

Swift рдмрд╛рдЗрдирд░реАрдЬ рдХреЗ рд╕рд╛рде, рдЪреВрдВрдХрд┐ рдСрдмреНрдЬреЗрдХреНрдЯрд┐рд╡-рд╕реА рд╕рдВрдЧрддрддрд╛ рд╣реИ, рдХрднреА-рдХрднреА рдЖрдк [class-dump](https://github.com/nygard/class-dump/) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдбрд┐рдХреНрд▓реЗрд░реЗрд╢рдиреНрд╕ рдирд┐рдХрд╛рд▓ рд╕рдХрддреЗ рд╣реИрдВ рд▓реЗрдХрд┐рди рд╣рдореЗрд╢рд╛ рдирд╣реАрдВред

**`jtool -l`** рдпрд╛ **`otool -l`** рдХрдорд╛рдВрдб рд▓рд╛рдЗрдиреНрд╕ рдХреЗ рд╕рд╛рде рдпрд╣ рд╕рдВрднрд╡ рд╣реИ рдХрд┐ рдХрдИ рд╕реЗрдХреНрд╢рдиреНрд╕ рдорд┐рд▓ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ **`__swift5`** рдкреНрд░реАрдлрд┐рдХреНрд╕ рд╕реЗ рд╢реБрд░реВ рд╣реЛрддреЗ рд╣реИрдВ:
```bash
jtool2 -l /Applications/Stocks.app/Contents/MacOS/Stocks
LC 00: LC_SEGMENT_64              Mem: 0x000000000-0x100000000    __PAGEZERO
LC 01: LC_SEGMENT_64              Mem: 0x100000000-0x100028000    __TEXT
[...]
Mem: 0x100026630-0x100026d54        __TEXT.__swift5_typeref
Mem: 0x100026d60-0x100027061        __TEXT.__swift5_reflstr
Mem: 0x100027064-0x1000274cc        __TEXT.__swift5_fieldmd
Mem: 0x1000274cc-0x100027608        __TEXT.__swift5_capture
[...]
```
рдЗрди рдЦрдВрдбреЛрдВ рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЖрдк [**рдЗрд╕ рдмреНрд▓реЙрдЧ рдкреЛрд╕реНрдЯ рдореЗрдВ рдФрд░ рдЬрд╛рдирдХрд╛рд░реА рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ**](https://knight.sc/reverse%20engineering/2019/07/17/swift-metadata.html).

рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, **Swift рдмрд╛рдЗрдирд░реАрдЬ рдореЗрдВ рд╕рд┐рдВрдмрд▓реНрд╕ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ** (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП рд▓рд╛рдЗрдмреНрд░реЗрд░реАрдЬ рдХреЛ рдЕрдкрдиреЗ рдлрдВрдХреНрд╢рдиреНрд╕ рдХреЛ рдХреЙрд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рд┐рдВрдмрд▓реНрд╕ рд╕реНрдЯреЛрд░ рдХрд░рдиреЗ рдХреА рдЬрд░реВрд░рдд рд╣реЛрддреА рд╣реИ). **рд╕рд┐рдВрдмрд▓реНрд╕ рдЖрдорддреМрд░ рдкрд░ рдлрдВрдХреНрд╢рди рдирд╛рдо рдХреА рдЬрд╛рдирдХрд╛рд░реА рдФрд░ рдЕрдЯреНрд░рд┐рдмреНрдпреВрдЯ рдХреЛ рдПрдХ рдмрджрд╕реВрд░рдд рддрд░реАрдХреЗ рд╕реЗ рд░рдЦрддреЗ рд╣реИрдВ**, рдЗрд╕рд▓рд┐рдП рд╡реЗ рдмрд╣реБрдд рдЙрдкрдпреЛрдЧреА рд╣реЛрддреЗ рд╣реИрдВ рдФрд░ "**рдбрд┐рдореИрдВрдЧрд▓рд░реНрд╕**" рд╣реЛрддреЗ рд╣реИрдВ рдЬреЛ рдореВрд▓ рдирд╛рдо рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
# Ghidra plugin
https://github.com/ghidraninja/ghidra_scripts/blob/master/swift_demangler.py

# Swift cli
swift demangle
```
### рдкреИрдХреНрдб рдмрд╛рдЗрдирд░реАрдЬрд╝

* рдЙрдЪреНрдЪ рдПрдВрдЯреНрд░реЛрдкреА рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ
* рд╕реНрдЯреНрд░рд┐рдВрдЧреНрд╕ рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ (рдпрджрд┐ рд╕рдордЭрдиреЗ рдпреЛрдЧреНрдп рд╕реНрдЯреНрд░рд┐рдВрдЧреНрд╕ рд▓рдЧрднрдЧ рдирд╣реАрдВ рд╣реИрдВ, рдкреИрдХреНрдб)
* MacOS рдХреЗ рд▓рд┐рдП UPX рдкреИрдХрд░ рдПрдХ рд╕реЗрдХреНрд╢рди рдЙрддреНрдкрдиреНрди рдХрд░рддрд╛ рд╣реИ рдЬрд┐рд╕реЗ "\_\_XHDR" рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ

## рдбрд╛рдпрдирд╛рдорд┐рдХ рд╡рд┐рд╢реНрд▓реЗрд╖рдг

{% hint style="warning" %}
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдмрд╛рдЗрдирд░реАрдЬрд╝ рдХреЛ рдбреАрдмрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, **SIP рдХреЛ рдЕрдХреНрд╖рдо рдХрд░рдирд╛ рд╣реЛрдЧрд╛** (`csrutil disable` рдпрд╛ `csrutil enable --without debug`) рдпрд╛ рдмрд╛рдЗрдирд░реАрдЬрд╝ рдХреЛ рдПрдХ рдЕрд╕реНрдерд╛рдпреА рдлреЛрд▓реНрдбрд░ рдореЗрдВ рдХреЙрдкреА рдХрд░реЗрдВ рдФрд░ **рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рдХреЛ рд╣рдЯрд╛рдПрдВ** `codesign --remove-signature <binary-path>` рдпрд╛ рдмрд╛рдЗрдирд░реА рдХреА рдбреАрдмрдЧрд┐рдВрдЧ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдВ (рдЖрдк [рдпрд╣ рд╕реНрдХреНрд░рд┐рдкреНрдЯ](https://gist.github.com/carlospolop/a66b8d72bb8f43913c4b5ae45672578b) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ)
{% endhint %}

{% hint style="warning" %}
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ **рд╕рд┐рд╕реНрдЯрдо рдмрд╛рдЗрдирд░реАрдЬрд╝ рдХреЛ рдЗрдВрд╕реНрдЯреНрд░реВрдореЗрдВрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП**, (рдЬреИрд╕реЗ рдХрд┐ `cloudconfigurationd`) macOS рдкрд░, **SIP рдХреЛ рдЕрдХреНрд╖рдо рдХрд░рдирд╛ рд╣реЛрдЧрд╛** (рдХреЗрд╡рд▓ рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рдХреЛ рд╣рдЯрд╛рдирд╛ рдХрд╛рдо рдирд╣реАрдВ рдХрд░реЗрдЧрд╛)ред
{% endhint %}

### рдпреВрдирд┐рдлрд╛рдЗрдб рд▓реЙрдЧреНрд╕

MacOS рдмрд╣реБрдд рд╕рд╛рд░реЗ рд▓реЙрдЧреНрд╕ рдЙрддреНрдкрдиреНрди рдХрд░рддрд╛ рд╣реИ рдЬреЛ рдПрдХ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдЪрд▓рд╛рддреЗ рд╕рдордп **рдпрд╣ рд╕рдордЭрдиреЗ рдореЗрдВ** рдмрд╣реБрдд рдЙрдкрдпреЛрдЧреА рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ **рдХрд┐ рд╡рд╣ рдХреНрдпрд╛ рдХрд░ рд░рд╣рд╛ рд╣реИ**ред

рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдХреБрдЫ рд▓реЙрдЧреНрд╕ рдореЗрдВ `<private>` рдЯреИрдЧ рд╣реЛрддрд╛ рд╣реИ рдЬреЛ рдХреБрдЫ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛** рдпрд╛ **рдХрдВрдкреНрдпреВрдЯрд░** **рдкрд╣рдЪрд╛рди рдпреЛрдЧреНрдп** рдЬрд╛рдирдХрд╛рд░реА рдХреЛ **рдЫрд┐рдкрд╛рдиреЗ** рдХреЗ рд▓рд┐рдП рд╣реЛрддрд╛ рд╣реИред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЗрд╕ рдЬрд╛рдирдХрд╛рд░реА рдХреЛ рдкреНрд░рдХрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП **рдПрдХ рдкреНрд░рдорд╛рдгрдкрддреНрд░ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИ**ред [**рдпрд╣рд╛рдВ**](https://superuser.com/questions/1532031/how-to-show-private-data-in-macos-unified-log) рд╕реЗ рд╡реНрдпрд╛рдЦреНрдпрд╛рдУрдВ рдХрд╛ рдкрд╛рд▓рди рдХрд░реЗрдВред

### Hopper

#### рдмрд╛рдПрдБ рдкреИрдирд▓

Hopper рдХреЗ рдмрд╛рдПрдБ рдкреИрдирд▓ рдореЗрдВ рдмрд╛рдЗрдирд░реА рдХреЗ рдкреНрд░рддреАрдХреЛрдВ (**Labels**), рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдФрд░ рдлрдВрдХреНрд╢рдиреЛрдВ рдХреА рд╕реВрдЪреА (**Proc**) рдФрд░ рд╕реНрдЯреНрд░рд┐рдВрдЧреНрд╕ (**Str**) рджреЗрдЦреА рдЬрд╛ рд╕рдХрддреА рд╣реИрдВред рдпреЗ рд╕рднреА рд╕реНрдЯреНрд░рд┐рдВрдЧреНрд╕ рдирд╣реАрдВ рд╣реИрдВ рд▓реЗрдХрд┐рди Mac-O рдлрд╛рдЗрд▓ рдХреЗ рдХрдИ рд╣рд┐рд╕реНрд╕реЛрдВ рдореЗрдВ рдкрд░рд┐рднрд╛рд╖рд┐рдд рд╡реЗ рд╣реИрдВ (рдЬреИрд╕реЗ _cstring рдпрд╛_ `objc_methname`)ред

#### рдордзреНрдп рдкреИрдирд▓

рдордзреНрдп рдкреИрдирд▓ рдореЗрдВ рдЖрдк **рдбрд┐рд╕рд╛рд╕реЗрдВрдмрд▓реНрдб рдХреЛрдб** рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВред рдФрд░ рдЖрдк рдЗрд╕реЗ **рдХрдЪреНрдЪреЗ** рдбрд┐рд╕рд╛рд╕реЗрдВрдмрд▓, **рдЧреНрд░рд╛рдл** рдХреЗ рд░реВрдк рдореЗрдВ, **рдбреАрдХрдВрдкрд╛рдЗрд▓реНрдб** рдФрд░ **рдмрд╛рдЗрдирд░реА** рдХреЗ рд░реВрдк рдореЗрдВ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ, рд╕рдВрдмрдВрдзрд┐рдд рдЖрдЗрдХрди рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░рдХреЗ:

<figure><img src="../../../.gitbook/assets/image (2) (6).png" alt=""><figcaption></figcaption></figure>

рдХреЛрдб рдСрдмреНрдЬреЗрдХреНрдЯ рдкрд░ рд░рд╛рдЗрдЯ рдХреНрд▓рд┐рдХ рдХрд░рдХреЗ рдЖрдк рдЙрд╕ рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЗ **рд╕рдВрджрд░реНрднреЛрдВ рдХреЛ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ** рдпрд╛ рдЙрд╕рдХрд╛ рдирд╛рдо рдмрджрд▓ рд╕рдХрддреЗ рд╣реИрдВ (рдпрд╣ рдбреАрдХрдВрдкрд╛рдЗрд▓реНрдб рдкреНрд╕реНрдпреВрдбреЛрдХреЛрдб рдореЗрдВ рдХрд╛рдо рдирд╣реАрдВ рдХрд░рддрд╛):

<figure><img src="../../../.gitbook/assets/image (1) (1) (2).png" alt=""><figcaption></figcaption></figure>

рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, **рдордзреНрдп рдиреАрдЪреЗ рдЖрдк рдкрд╛рдпрдерди рдХрдорд╛рдВрдбреНрд╕ рд▓рд┐рдЦ рд╕рдХрддреЗ рд╣реИрдВ**ред

#### рджрд╛рдПрдБ рдкреИрдирд▓

рджрд╛рдПрдБ рдкреИрдирд▓ рдореЗрдВ рдЖрдк рдЬреИрд╕реЗ **рдиреЗрд╡рд┐рдЧреЗрд╢рди рд╣рд┐рд╕реНрдЯреНрд░реА** (рддрд╛рдХрд┐ рдЖрдк рдЬрд╛рди рд╕рдХреЗрдВ рдХрд┐ рдЖрдк рд╡рд░реНрддрдорд╛рди рд╕реНрдерд┐рддрд┐ рдореЗрдВ рдХреИрд╕реЗ рдкрд╣реБрдВрдЪреЗ), **рдХреЙрд▓ рдЧреНрд░рд╛рдл** рдЬрд╣рд╛рдВ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рд╕рднреА **рдлрдВрдХреНрд╢рдиреНрд╕ рдЬреЛ рдЗрд╕ рдлрдВрдХреНрд╢рди рдХреЛ рдХреЙрд▓ рдХрд░рддреЗ рд╣реИрдВ** рдФрд░ рд╕рднреА рдлрдВрдХреНрд╢рдиреНрд╕ рдЬреЛ **рдЗрд╕ рдлрдВрдХреНрд╢рди рдХреЛ рдХреЙрд▓ рдХрд░рддреЗ рд╣реИрдВ**, рдФрд░ **рд▓реЛрдХрд▓ рд╡реЗрд░рд┐рдПрдмрд▓реНрд╕** рдХреА рдЬрд╛рдирдХрд╛рд░реА рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВред

### dtrace

рдпрд╣ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рдПрдкреНрд▓рд┐рдХреЗрд╢рдиреНрд╕ рддрдХ рдПрдХ рдЕрддреНрдпрдВрдд **рдирд┐рдореНрди рд╕реНрддрд░** рдкрд░ рдкрд╣реБрдВрдЪ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ **рдкреНрд░реЛрдЧреНрд░рд╛рдореНрд╕** рдХреЛ **рдЯреНрд░реЗрд╕** рдХрд░рдиреЗ рдФрд░ рдпрд╣рд╛рдВ рддрдХ рдХрд┐ рдЙрдирдХреЗ рдирд┐рд╖реНрдкрд╛рджрди рдкреНрд░рд╡рд╛рд╣ рдХреЛ рдмрджрд▓рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред Dtrace **рдкреНрд░реЛрдмреНрд╕** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ рдЬреЛ **рдХрд░реНрдиреЗрд▓ рдХреЗ рдЪрд╛рд░реЛрдВ рдУрд░ рд░рдЦреЗ рдЬрд╛рддреЗ рд╣реИрдВ** рдФрд░ рд╕реНрдерд╛рдиреЛрдВ рдкрд░ рд╣реЛрддреЗ рд╣реИрдВ рдЬреИрд╕реЗ рдХрд┐ рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓реНрд╕ рдХреА рд╢реБрд░реБрдЖрдд рдФрд░ рдЕрдВрддред

DTrace **`dtrace_probe_create`** рдлрдВрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкреНрд░рддреНрдпреЗрдХ рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓ рдХреЗ рд▓рд┐рдП рдПрдХ рдкреНрд░реЛрдм рдмрдирд╛рддрд╛ рд╣реИред рдпреЗ рдкреНрд░реЛрдмреНрд╕ рдкреНрд░рддреНрдпреЗрдХ рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓ рдХреЗ **рдкреНрд░рд╡реЗрд╢ рдФрд░ рдирд┐рдХрд╛рд╕ рдмрд┐рдВрджреБ рдкрд░** рдЪрд╛рд▓реВ рдХрд┐рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВред DTrace рдХреЗ рд╕рд╛рде рдЗрдВрдЯрд░реИрдХреНрд╢рди /dev/dtrace рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╣реЛрддрд╛ рд╣реИ рдЬреЛ рдХреЗрд╡рд▓ рд░реВрдЯ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд▓рд┐рдП рдЙрдкрд▓рдмреНрдз рд╣реИред

{% hint style="success" %}
SIP рд╕реБрд░рдХреНрд╖рд╛ рдХреЛ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдЕрдХреНрд╖рдо рдХрд┐рдП рдмрд┐рдирд╛ Dtrace рдХреЛ рд╕рдХреНрд╖рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдк рд░рд┐рдХрд╡рд░реА рдореЛрдб рдкрд░ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрдорд╛рдВрдб рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ: `csrutil enable --without dtrace`

рдЖрдк **`dtrace`** рдпрд╛ **`dtruss`** рдмрд╛рдЗрдирд░реАрдЬрд╝ рднреА рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ **рдЖрдкрдиреЗ рдХрдВрдкрд╛рдЗрд▓ рдХреА рд╣реИрдВ**ред
{% endhint %}

dtrace рдХреЗ рдЙрдкрд▓рдмреНрдз рдкреНрд░реЛрдмреНрд╕ рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:
```bash
dtrace -l | head
ID   PROVIDER            MODULE                          FUNCTION NAME
1     dtrace                                                     BEGIN
2     dtrace                                                     END
3     dtrace                                                     ERROR
43    profile                                                     profile-97
44    profile                                                     profile-199
```
рдкреНрд░реЛрдм рдирд╛рдо рдореЗрдВ рдЪрд╛рд░ рднрд╛рдЧ рд╣реЛрддреЗ рд╣реИрдВ: рдкреНрд░реЛрд╡рд╛рдЗрдбрд░, рдореЙрдбреНрдпреВрд▓, рдлрдВрдХреНрд╢рди, рдФрд░ рдирд╛рдо (`fbt:mach_kernel:ptrace:entry`). рдпрджрд┐ рдЖрдк рдХрд┐рд╕реА рднрд╛рдЧ рдХрд╛ рдирд╛рдо рдирд╣реАрдВ рдмрддрд╛рддреЗ рд╣реИрдВ, рддреЛ Dtrace рдЙрд╕ рднрд╛рдЧ рдХреЛ рд╡рд╛рдЗрд▓реНрдбрдХрд╛рд░реНрдб рдХреЗ рд░реВрдк рдореЗрдВ рд▓рд╛рдЧреВ рдХрд░реЗрдЧрд╛ред

DTrace рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкреНрд░реЛрдмреНрд╕ рдХреЛ рд╕рдХреНрд░рд┐рдп рдХрд░рдиреЗ рдФрд░ рдЙрдирдХреЗ рдЯреНрд░рд┐рдЧрд░ рд╣реЛрдиреЗ рдкрд░ рдХреНрдпрд╛ рдХреНрд░рд┐рдпрд╛рдПрдВ рдХрд░рдиреА рд╣реИрдВ, рдЗрд╕реЗ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣рдореЗрдВ D рднрд╛рд╖рд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред

рдЕрдзрд┐рдХ рд╡рд┐рд╕реНрддреГрдд рд╡реНрдпрд╛рдЦреНрдпрд╛ рдФрд░ рдЕрдзрд┐рдХ рдЙрджрд╛рд╣рд░рдг [https://illumos.org/books/dtrace/chp-intro.html](https://illumos.org/books/dtrace/chp-intro.html) рдкрд░ рдкрд╛рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВред

#### рдЙрджрд╛рд╣рд░рдг

**DTrace рд╕реНрдХреНрд░рд┐рдкреНрдЯреНрд╕ рдЙрдкрд▓рдмреНрдз** рд╣реЛрдиреЗ рдХреА рд╕реВрдЪреА рдХреЗ рд▓рд┐рдП `man -k dtrace` рдЪрд▓рд╛рдПрдВред рдЙрджрд╛рд╣рд░рдг: `sudo dtruss -n binary`

* рдкрдВрдХреНрддрд┐
```bash
#Count the number of syscalls of each running process
sudo dtrace -n 'syscall:::entry {@[execname] = count()}'
```
* рд╕реНрдХреНрд░рд┐рдкреНрдЯ
```bash
syscall:::entry
/pid == $1/
{
}

#Log every syscall of a PID
sudo dtrace -s script.d 1234
```

```bash
syscall::open:entry
{
printf("%s(%s)", probefunc, copyinstr(arg0));
}
syscall::close:entry
{
printf("%s(%d)\n", probefunc, arg0);
}

#Log files opened and closed by a process
sudo dtrace -s b.d -c "cat /etc/hosts"
```

```bash
syscall:::entry
{
;
}
syscall:::return
{
printf("=%d\n", arg1);
}

#Log sys calls with values
sudo dtrace -s syscalls_info.d -c "cat /etc/hosts"
```
### dtruss
```bash
dtruss -c ls #Get syscalls of ls
dtruss -c -p 1000 #get syscalls of PID 1000
```
### ktrace

рдЖрдк рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ **SIP рд╕рдХреНрд░рд┐рдп** рд╣реЛрдиреЗ рдХреЗ рд╕рд╛рде рднреА рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ
```bash
ktrace trace -s -S -t c -c ls | grep "ls("
```
### ProcessMonitor

[**ProcessMonitor**](https://objective-see.com/products/utilities.html#ProcessMonitor) рдПрдХ рдмрд╣реБрдд рдЙрдкрдпреЛрдЧреА рдЙрдкрдХрд░рдг рд╣реИ рдЬреЛ рдЬрд╛рдВрдЪ рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдХреЛрдИ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреМрди рд╕реЗ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд╕рдВрдмрдВрдзрд┐рдд рдХреНрд░рд┐рдпрд╛рдПрдВ рдХрд░ рд░рд╣реА рд╣реИ (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдпрд╣ рдореЙрдирд┐рдЯрд░ рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдХреЛрдИ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреМрди рд╕реЗ рдирдП рдкреНрд░рдХреНрд░рд┐рдпрд╛рдПрдВ рдмрдирд╛ рд░рд╣реА рд╣реИ)ред

### SpriteTree

[**SpriteTree**](https://themittenmac.com/tools/) рдПрдХ рдЙрдкрдХрд░рдг рд╣реИ рдЬреЛ рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЗ рдмреАрдЪ рд╕рдВрдмрдВрдзреЛрдВ рдХреЛ рдкреНрд░рд┐рдВрдЯ рдХрд░рддрд╛ рд╣реИред\
рдЖрдкрдХреЛ рдЕрдкрдиреЗ рдореИрдХ рдХреЛ **`sudo eslogger fork exec rename create > cap.json`** рдЬреИрд╕реЗ рдХрдорд╛рдВрдб рд╕реЗ рдореЙрдирд┐рдЯрд░ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ (рдЗрд╕реЗ рдЪрд▓рд╛рдиреЗ рд╡рд╛рд▓реЗ рдЯрд░реНрдорд┐рдирд▓ рдХреЛ FDA рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ)ред рдФрд░ рдлрд┐рд░ рдЖрдк рдЗрд╕ рдЙрдкрдХрд░рдг рдореЗрдВ json рд▓реЛрдб рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рд╕рднреА рд╕рдВрдмрдВрдзреЛрдВ рдХреЛ рджреЗрдЦ рд╕рдХреЗрдВ:

<figure><img src="../../../.gitbook/assets/image (710).png" alt="" width="375"><figcaption></figcaption></figure>

### FileMonitor

[**FileMonitor**](https://objective-see.com/products/utilities.html#FileMonitor) рдлрд╛рдЗрд▓ рдЗрд╡реЗрдВрдЯреНрд╕ (рдЬреИрд╕реЗ рдХрд┐ рдирд┐рд░реНрдорд╛рдг, рд╕рдВрд╢реЛрдзрди, рдФрд░ рд╣рдЯрд╛рдиреЗ) рдХреЛ рдореЙрдирд┐рдЯрд░ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, рдФрд░ рдРрд╕реА рдШрдЯрдирд╛рдУрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╡рд┐рд╕реНрддреГрдд рдЬрд╛рдирдХрд╛рд░реА рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред

### Crescendo

[**Crescendo**](https://github.com/SuprHackerSteve/Crescendo) рдПрдХ GUI рдЙрдкрдХрд░рдг рд╣реИ рдЬрд┐рд╕рдХрд╛ рд░реВрдк рдФрд░ рдЕрдиреБрднрд╡ Windows рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ Microsoft Sysinternal рдХреЗ _Procmon_ рд╕реЗ рдкрд░рд┐рдЪрд┐рдд рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред рдпрд╣ рдЖрдкрдХреЛ рд╕рднреА рдкреНрд░рдХрд╛рд░ рдХреА рдШрдЯрдирд╛рдУрдВ рдХреА рд░рд┐рдХреЙрд░реНрдбрд┐рдВрдЧ рд╢реБрд░реВ рдФрд░ рд░реЛрдХрдиреЗ, рдЙрдиреНрд╣реЗрдВ рд╢реНрд░реЗрдгрд┐рдпреЛрдВ (рдлрд╛рдЗрд▓, рдкреНрд░рдХреНрд░рд┐рдпрд╛, рдиреЗрдЯрд╡рд░реНрдХ, рдЖрджрд┐) рджреНрд╡рд╛рд░рд╛ рдлрд╝рд┐рд▓реНрдЯрд░ рдХрд░рдиреЗ рдФрд░ рд░рд┐рдХреЙрд░реНрдб рдХреА рдЧрдИ рдШрдЯрдирд╛рдУрдВ рдХреЛ json рдлрд╛рдЗрд▓ рдХреЗ рд░реВрдк рдореЗрдВ рд╕рд╣реЗрдЬрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред

### Apple Instruments

[**Apple Instruments**](https://developer.apple.com/library/archive/documentation/Performance/Conceptual/CellularBestPractices/Appendix/Appendix.html) Xcode рдХреЗ рдбреЗрд╡рд▓рдкрд░ рдЯреВрд▓реНрд╕ рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ рд╣реИрдВ тАУ рдЗрдирдХрд╛ рдЙрдкрдпреЛрдЧ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдкреНрд░рджрд░реНрд╢рди рдХреА рдирд┐рдЧрд░рд╛рдиреА, рдореЗрдореЛрд░реА рд▓реАрдХ рдХреА рдкрд╣рдЪрд╛рди, рдФрд░ рдлрд╛рдЗрд▓рд╕рд┐рд╕реНрдЯрдо рдЧрддрд┐рд╡рд┐рдзрд┐ рдХреЛ рдЯреНрд░реИрдХ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

![](<../../../.gitbook/assets/image (15).png>)

### fs\_usage

рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рджреНрд╡рд╛рд░рд╛ рдХрд┐рдП рдЧрдП рдХреНрд░рд┐рдпрд╛рдУрдВ рдХрд╛ рдЕрдиреБрд╕рд░рдг рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ:
```bash
fs_usage -w -f filesys ls #This tracks filesystem actions of proccess names containing ls
fs_usage -w -f network curl #This tracks network actions
```
### TaskExplorer

[**Taskexplorer**](https://objective-see.com/products/taskexplorer.html) рдмрд╛рдЗрдирд░реА рджреНрд╡рд╛рд░рд╛ рдкреНрд░рдпреБрдХреНрдд **рд▓рд╛рдЗрдмреНрд░реЗрд░реАрдЬ**, рдЙрдкрдпреЛрдЧ рдореЗрдВ рдЖрдиреЗ рд╡рд╛рд▓реА **рдлрд╛рдЗрд▓реНрд╕** рдФрд░ **рдиреЗрдЯрд╡рд░реНрдХ** рдХрдиреЗрдХреНрд╢рдиреНрд╕ рдХреЛ рджреЗрдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА рд╣реИред\
рдпрд╣ рдмрд╛рдЗрдирд░реА рдкреНрд░реЛрд╕реЗрд╕реЗрд╕ рдХреЛ **virustotal** рдХреЗ рдЦрд┐рд▓рд╛рдл рдЬрд╛рдВрдЪрддрд╛ рд╣реИ рдФрд░ рдмрд╛рдЗрдирд░реА рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА рджрд┐рдЦрд╛рддрд╛ рд╣реИред

## PT\_DENY\_ATTACH <a href="#page-title" id="page-title"></a>

[**рдЗрд╕ рдмреНрд▓реЙрдЧ рдкреЛрд╕реНрдЯ**](https://knight.sc/debugging/2019/06/03/debugging-apple-binaries-that-use-pt-deny-attach.html) рдореЗрдВ рдЖрдк рдПрдХ рдЙрджрд╛рд╣рд░рдг рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдХреИрд╕реЗ **рдЪрд▓ рд░рд╣реЗ рдбреЗрдорди** рдХреЛ **рдбреАрдмрдЧ** рдХрд░рдирд╛ рд╣реИ рдЬрд┐рд╕рдиреЗ **`PT_DENY_ATTACH`** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рд╣реИ рддрд╛рдХрд┐ рдбреАрдмрдЧрд┐рдВрдЧ рдХреЛ рд░реЛрдХрд╛ рдЬрд╛ рд╕рдХреЗ рднрд▓реЗ рд╣реА SIP рдЕрдХреНрд╖рдо рд╣реЛред

### lldb

**lldb** **macOS** рдмрд╛рдЗрдирд░реА **рдбреАрдмрдЧрд┐рдВрдЧ** рдХреЗ рд▓рд┐рдП рдорд╛рдирдХ рдЙрдкрдХрд░рдг рд╣реИред
```bash
lldb ./malware.bin
lldb -p 1122
lldb -n malware.bin
lldb -n malware.bin --waitfor
```
рдЖрдк **`.lldbinit`** рдирд╛рдордХ рдлрд╛рдЗрд▓ рдмрдирд╛рдХрд░ рдЕрдкрдиреЗ рд╣реЛрдо рдлреЛрд▓реНрдбрд░ рдореЗрдВ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкрдВрдХреНрддрд┐ рдХреЗ рд╕рд╛рде lldb рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╕рдордп intel flavour рд╕реЗрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
settings set target.x86-disassembly-flavor intel
```
{% hint style="warning" %}
lldb рдХреЗ рдЕрдВрджрд░, рдкреНрд░реЛрд╕реЗрд╕ рдХреЛ `process save-core` рдХреЗ рд╕рд╛рде рдбрдВрдк рдХрд░реЗрдВред
{% endhint %}

<table data-header-hidden><thead><tr><th width="225"></th><th></th></tr></thead><tbody><tr><td><strong>(lldb) рдХрдорд╛рдВрдб</strong></td><td><strong>рд╡рд┐рд╡рд░рдг</strong></td></tr><tr><td><strong>run (r)</strong></td><td>рдирд┐рд╖реНрдкрд╛рджрди рд╢реБрд░реВ рдХрд░рдирд╛, рдЬреЛ рдПрдХ рдмреНрд░реЗрдХрдкреЙрдЗрдВрдЯ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдпрд╛ рдкреНрд░реЛрд╕реЗрд╕ рд╕рдорд╛рдкреНрдд рд╣реЛрдиреЗ рддрдХ рдЕрдирд╡рд░рдд рдЬрд╛рд░реА рд░рд╣реЗрдЧрд╛ред</td></tr><tr><td><strong>continue (c)</strong></td><td>рдбреАрдмрдЧ рдХрд┐рдП рдЧрдП рдкреНрд░реЛрд╕реЗрд╕ рдХрд╛ рдирд┐рд╖реНрдкрд╛рджрди рдЬрд╛рд░реА рд░рдЦреЗрдВред</td></tr><tr><td><strong>nexti (n / ni)</strong></td><td>рдЕрдЧрд▓рд╛ рдирд┐рд░реНрджреЗрд╢ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдВред рдпрд╣ рдХрдорд╛рдВрдб рдлрдВрдХреНрд╢рди рдХреЙрд▓реНрд╕ рдХреЛ рдЫреЛрдбрд╝ рджреЗрдЧрд╛ред</td></tr><tr><td><strong>stepi (s / si)</strong></td><td>рдЕрдЧрд▓рд╛ рдирд┐рд░реНрджреЗрд╢ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдВред nexti рдХрдорд╛рдВрдб рдХреЗ рд╡рд┐рдкрд░реАрдд, рдпрд╣ рдХрдорд╛рдВрдб рдлрдВрдХреНрд╢рди рдХреЙрд▓реНрд╕ рдореЗрдВ рдХрджрдо рд░рдЦреЗрдЧрд╛ред</td></tr><tr><td><strong>finish (f)</strong></td><td>рд╡рд░реНрддрдорд╛рди рдлрдВрдХреНрд╢рди ("рдлреНрд░реЗрдо") рдореЗрдВ рд╢реЗрд╖ рдирд┐рд░реНрджреЗрд╢реЛрдВ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдВ рдФрд░ рд░реБрдХреЗрдВред</td></tr><tr><td><strong>control + c</strong></td><td>рдирд┐рд╖реНрдкрд╛рджрди рд░реЛрдХреЗрдВред рдпрджрд┐ рдкреНрд░реЛрд╕реЗрд╕ рдХреЛ run (r) рдпрд╛ continue (c) рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рддреЛ рдпрд╣ рдкреНрд░реЛрд╕реЗрд╕ рдХреЛ рд╡рд░реНрддрдорд╛рди рдореЗрдВ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛ рд░рд╣реЗ рд╕реНрдерд╛рди рдкрд░ рд░реЛрдХ рджреЗрдЧрд╛ред</td></tr><tr><td><strong>breakpoint (b)</strong></td><td><p>b main #рдХреЛрдИ рднреА рдлрдВрдХреНрд╢рди рдЬрд┐рд╕рдХрд╛ рдирд╛рдо main рд╣реЛ</p><p>b &#x3C;binname>`main #рдмрд┐рди рдХрд╛ рдореБрдЦреНрдп рдлрдВрдХреНрд╢рди</p><p>b set -n main --shlib &#x3C;lib_name> #рдЗрдВрдЧрд┐рдд рдХрд┐рдП рдЧрдП рдмрд┐рди рдХрд╛ рдореБрдЦреНрдп рдлрдВрдХреНрд╢рди</p><p>b -[NSDictionary objectForKey:]</p><p>b -a 0x0000000100004bd9</p><p>br l #рдмреНрд░реЗрдХрдкреЙрдЗрдВрдЯ рд╕реВрдЪреА</p><p>br e/dis &#x3C;num> #рдмреНрд░реЗрдХрдкреЙрдЗрдВрдЯ рд╕рдХреНрд╖рдо/рдЕрдХреНрд╖рдо рдХрд░реЗрдВ</p><p>breakpoint delete &#x3C;num></p></td></tr><tr><td><strong>help</strong></td><td><p>help breakpoint #breakpoint рдХрдорд╛рдВрдб рдХреА рдорджрдж рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ</p><p>help memory write #рдореЗрдореЛрд░реА рдореЗрдВ рд▓рд┐рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдорджрдж рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ</p></td></tr><tr><td><strong>reg</strong></td><td><p>reg read</p><p>reg read $rax</p><p>reg read $rax --format &#x3C;<a href="https://lldb.llvm.org/use/variable.html#type-format">format</a>></p><p>reg write $rip 0x100035cc0</p></td></tr><tr><td><strong>x/s &#x3C;reg/memory address></strong></td><td>рдореЗрдореЛрд░реА рдХреЛ рдПрдХ рдирд▓-рдЯрд░реНрдорд┐рдиреЗрдЯреЗрдб рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХреЗ рд░реВрдк рдореЗрдВ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░реЗрдВред</td></tr><tr><td><strong>x/i &#x3C;reg/memory address></strong></td><td>рдореЗрдореЛрд░реА рдХреЛ рдЕрд╕реЗрдВрдмрд▓реА рдирд┐рд░реНрджреЗрд╢ рдХреЗ рд░реВрдк рдореЗрдВ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░реЗрдВред</td></tr><tr><td><strong>x/b &#x3C;reg/memory address></strong></td><td>рдореЗрдореЛрд░реА рдХреЛ рдмрд╛рдЗрдЯ рдХреЗ рд░реВрдк рдореЗрдВ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░реЗрдВред</td></tr><tr><td><strong>print object (po)</strong></td><td><p>рдпрд╣ рдкреИрд░рд╛рдореАрдЯрд░ рджреНрд╡рд╛рд░рд╛ рд╕рдВрджрд░реНрднрд┐рдд рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЛ рдкреНрд░рд┐рдВрдЯ рдХрд░реЗрдЧрд╛</p><p>po $raw</p><p><code>{</code></p><p><code>dnsChanger = {</code></p><p><code>"affiliate" = "";</code></p><p><code>"blacklist_dns" = ();</code></p><p>рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ Apple рдХреЗ рдЕрдзрд┐рдХрд╛рдВрд╢ Objective-C APIs рдпрд╛ рдореЗрдердбреНрд╕ рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рд▓реМрдЯрд╛рддреЗ рд╣реИрдВ, рдФрд░ рдЗрд╕рд▓рд┐рдП рдЙрдиреНрд╣реЗрдВ "print object" (po) рдХрдорд╛рдВрдб рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред рдпрджрд┐ po рд╕рд╛рд░реНрдердХ рдЖрдЙрдЯрдкреБрдЯ рдирд╣реАрдВ рджреЗрддрд╛ рд╣реИ рддреЛ <code>x/b</code> рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ</p></td></tr><tr><td><strong>memory</strong></td><td>memory read 0x000....<br>memory read $x0+0xf2a<br>memory write 0x100600000 -s 4 0x41414141 #рдЙрд╕ рдкрддреЗ рдореЗрдВ AAAA рд▓рд┐рдЦреЗрдВ<br>memory write -f s $rip+0x11f+7 "AAAA" #рдкрддреЗ рдореЗрдВ AAAA рд▓рд┐рдЦреЗрдВ</td></tr><tr><td><strong>disassembly</strong></td><td><p>dis #рд╡рд░реНрддрдорд╛рди рдлрдВрдХреНрд╢рди рдХреЛ рдбрд┐рд╕рд╛рд╕реЗрдВрдмрд▓ рдХрд░реЗрдВ</p><p>dis -n &#x3C;funcname> #рдлрдВрдХреНрд╢рди рдХреЛ рдбрд┐рд╕рд╛рд╕реЗрдВрдмрд▓ рдХрд░реЗрдВ</p><p>dis -n &#x3C;funcname> -b &#x3C;basename> #рдлрдВрдХреНрд╢рди рдХреЛ рдбрд┐рд╕рд╛рд╕реЗрдВрдмрд▓ рдХрд░реЗрдВ<br>dis -c 6 #6 рд▓рд╛рдЗрдиреЛрдВ рдХреЛ рдбрд┐рд╕рд╛рд╕реЗрдВрдмрд▓ рдХрд░реЗрдВ<br>dis -c 0x100003764 -e 0x100003768 # рдПрдХ рдкрддреЗ рд╕реЗ рджреВрд╕рд░реЗ рдкрддреЗ рддрдХ<br>dis -p -c 4 # рд╡рд░реНрддрдорд╛рди рдкрддреЗ рд╕реЗ рдбрд┐рд╕рд╛рд╕реЗрдВрдмрд▓рд┐рдВрдЧ рд╢реБрд░реВ рдХрд░реЗрдВ</p></td></tr><tr><td><strong>parray</strong></td><td>parray 3 (char **)$x1 # x1 рд░рдЬрд┐рд╕реНрдЯрд░ рдореЗрдВ 3 рдШрдЯрдХреЛрдВ рдХреА рдПрд░реЗ рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ</td></tr></tbody></table>

{% hint style="info" %}
**`objc_sendMsg`** рдлрдВрдХреНрд╢рди рдХреЛ рдХреЙрд▓ рдХрд░рддреЗ рд╕рдордп, **rsi** рд░рдЬрд┐рд╕реНрдЯрд░ **рдореЗрдердб рдХреЗ рдирд╛рдо** рдХреЛ рдПрдХ рдирд▓-рдЯрд░реНрдорд┐рдиреЗрдЯреЗрдб ("C") рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХреЗ рд░реВрдк рдореЗрдВ рд░рдЦрддрд╛ рд╣реИред рдирд╛рдо рдХреЛ lldb рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдкреНрд░рд┐рдВрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░реЗрдВ:

`(lldb) x/s $rsi: 0x1000f1576: "startMiningWithPort:password:coreCount:slowMemory:currency:"`

`(lldb) print (char*)$rsi:`\
`(char *) $1 = 0x00000001000f1576 "startMiningWithPort:password:coreCount:slowMemory:currency:"`

`(lldb) reg read $rsi: rsi = 0x00000001000f1576 "startMiningWithPort:password:coreCount:slowMemory:currency:"`
{% endhint %}

### рдПрдВрдЯреА-рдбрд╛рдпрдирд╛рдорд┐рдХ рд╡рд┐рд╢реНрд▓реЗрд╖рдг

#### VM рдкрддрд╛ рд▓рдЧрд╛рдирд╛

* рдХрдорд╛рдВрдб **`sysctl hw.model`** "Mac" рд▓реМрдЯрд╛рддрд╛ рд╣реИ рдЬрдм **рд╣реЛрд╕реНрдЯ MacOS рд╣реЛрддрд╛ рд╣реИ** рд▓реЗрдХрд┐рди VM рд╣реЛрдиреЗ рдкрд░ рдХреБрдЫ рдЕрд▓рдЧ рд▓реМрдЯрд╛рддрд╛ рд╣реИред
* **`hw.logicalcpu`** рдФрд░ **`hw.physicalcpu`** рдХреЗ рдорд╛рдиреЛрдВ рдХреЗ рд╕рд╛рде рдЦреЗрд▓рдХрд░ рдХреБрдЫ рдореИрд▓рд╡реЗрдпрд░ VM рд╣реЛрдиреЗ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рддреЗ рд╣реИрдВред
* рдХреБрдЫ рдореИрд▓рд╡реЗрдпрд░ MAC рдкрддреЗ (00:50:56) рдХреЗ рдЖрдзрд╛рд░ рдкрд░ **VMware** рд╣реЛрдиреЗ рдХрд╛ рднреА **рдкрддрд╛ рд▓рдЧрд╛** рд╕рдХрддреЗ рд╣реИрдВред
* рдпрд╣ рднреА рд╕рдВрднрд╡ рд╣реИ рдХрд┐ рдПрдХ рд╕рд╛рдзрд╛рд░рдг рдХреЛрдб рдХреЗ рд╕рд╛рде **рдкреНрд░реЛрд╕реЗрд╕ рдХреЗ рдбреАрдмрдЧ рд╣реЛрдиреЗ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдпрд╛ рдЬрд╛ рд╕рдХреЗ**:
* `if(P_TRACED == (info.kp_proc.p_flag & P_TRACED)){ //рдкреНрд░реЛрд╕реЗрд╕ рдбреАрдмрдЧ рд╣реЛ рд░рд╣рд╛ рд╣реИ }`
* рдпрд╣ **`ptrace`** рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓ рдХреЛ рднреА **`PT_DENY_ATTACH`** рдлреНрд▓реИрдЧ рдХреЗ рд╕рд╛рде рдЖрдордВрддреНрд░рд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИред рдпрд╣ рдПрдХ рдбреАрдмрдЧрд░ рдХреЛ рдЬреБрдбрд╝рдиреЗ рдФрд░ рдЯреНрд░реЗрд╕рд┐рдВрдЧ рд╕реЗ **рд░реЛрдХрддрд╛** рд╣реИред
* рдЖрдк рдЬрд╛рдВрдЪ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдХреНрдпрд╛ **`sysctl`** рдпрд╛ **`ptrace`** рдлрдВрдХреНрд╢рди рдХреЛ **рдЖрдпрд╛рдд** рдХрд┐рдпрд╛ рдЬрд╛ рд░рд╣рд╛ рд╣реИ (рд▓реЗрдХрд┐рди рдореИрд▓рд╡реЗрдпрд░ рдЗрд╕реЗ рдЧрддрд┐рд╢реАрд▓ рд░реВрдк рд╕реЗ рдЖрдпрд╛рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ)
* рдЗрд╕ рд▓реЗрдЦ рдореЗрдВ рдЬреИрд╕рд╛ рдХрд┐ рдиреЛрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, тАЬ[Defeating Anti-Debug Techniques: macOS ptrace variants](https://alexomara.com/blog/defeating-anti-debug-techniques-macos-ptrace-variants/)тАЭ :\
тАЬ_рд╕рдВрджреЗрд╢ Process # exited with **status = 45 (0x0000002d)** рдЖрдорддреМрд░ рдкрд░ рдпрд╣ рд╕рдВрдХреЗрдд рджреЗрддрд╛ рд╣реИ рдХрд┐ рдбреАрдмрдЧ рд▓рдХреНрд╖реНрдп **PT\_DENY\_ATTACH** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣рд╛ рд╣реИ_тАЭ

## рдлрдЬрд╝рд┐рдВрдЧ

### [ReportCrash](https://ss64.com/osx/reportcrash.html)

ReportCrash **рдХреНрд░реИрд╢ рд╣реЛ рд░рд╣реЗ рдкреНрд░реЛрд╕реЗрд╕реЛрдВ рдХрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд░рддрд╛ рд╣реИ рдФрд░ рдПрдХ рдХреНрд░реИрд╢ рд░рд┐рдкреЛрд░реНрдЯ рдХреЛ рдбрд┐рд╕реНрдХ рдкрд░ рд╕рд╣реЗрдЬрддрд╛ рд╣реИ**ред рдПрдХ рдХреНрд░реИрд╢ рд░рд┐рдкреЛрд░реНрдЯ рдореЗрдВ рдРрд╕реА рдЬрд╛рдирдХрд╛рд░реА рд╣реЛрддреА рд╣реИ рдЬреЛ рдПрдХ рдбреЗрд╡рд▓рдкрд░ рдХреЛ рдХреНрд░реИрд╢ рдХреЗ рдХрд╛рд░рдг рдХрд╛ рдирд┐рджрд╛рди рдХрд░рдиреЗ рдореЗрдВ **рдорджрдж рдХрд░ рд╕рдХрддреА рд╣реИ**ред\
рдПрдкреНрд▓рд┐рдХреЗрд╢рдиреЛрдВ рдФрд░ рдЕрдиреНрдп рдкреНрд░реЛрд╕реЗрд╕реЛрдВ рдХреЗ рд▓рд┐рдП рдЬреЛ рдкреНрд░рддрд┐-рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ launchd рд╕рдВрджрд░реНрдн рдореЗрдВ рдЪрд▓ рд░рд╣реЗ рд╣реИрдВ, ReportCrash рдПрдХ LaunchAgent рдХреЗ рд░реВрдк рдореЗрдВ рдЪрд▓рддрд╛ рд╣реИ рдФрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ `~/Library/Logs/DiagnosticReports/` рдореЗрдВ рдХреНрд░реИрд╢ рд░рд┐рдкреЛрд░реНрдЯ рд╕рд╣реЗрдЬрддрд╛ рд╣реИред\
рдбреЗрдордиреНрд╕, рдЕрдиреНрдп рдкреНрд░реЛрд╕реЗрд╕ рдЬреЛ рд╕рд┐рд╕реНрдЯрдо launchd рд╕рдВрджрд░реНрдн рдореЗрдВ рдЪрд▓ рд░рд╣реЗ рд╣реИрдВ рдФрд░ рдЕрдиреНрдп рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдкреНрд░рд╛рдкреНрдд рдкреНрд░реЛрд╕реЗрд╕реЛрдВ рдХреЗ рд▓рд┐рдП, ReportCrash рдПрдХ LaunchDaemon рдХреЗ рд░реВрдк рдореЗрдВ рдЪрд▓рддрд╛ рд╣реИ рдФрд░ рд╕рд┐рд╕реНрдЯрдо рдХреЗ `/Library/Logs/DiagnosticReports` рдореЗрдВ рдХреНрд░реИрд╢ рд░рд┐рдкреЛрд░реНрдЯ рд╕рд╣реЗрдЬрддрд╛ рд╣реИред

рдпрджрд┐ рдЖрдк рдХреНрд░реИрд╢ рд░рд┐рдкреЛрд░реНрдЯреНрд╕ рдХреЗ Apple рдХреЛ рднреЗрдЬреЗ рдЬрд╛рдиреЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЪрд┐рдВрддрд┐рдд рд╣реИрдВ рддреЛ рдЖрдк рдЙрдиреНрд╣реЗрдВ рдЕрдХреНрд╖рдо рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдпрджрд┐ рдирд╣реАрдВ, рддреЛ рдХреНрд░реИрд╢ рд░рд┐рдкреЛрд░реНрдЯреНрд╕ рдпрд╣ **рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдореЗрдВ рдЙрдкрдпреЛрдЧреА рд╣реЛ рд╕рдХрддреА рд╣реИрдВ рдХрд┐ рдПрдХ рд╕рд░реНрд╡рд░ рдХреИрд╕реЗ рдХреНрд░реИрд╢ рд╣реБрдЖ**ред
```bash
#To disable crash reporting:
launchctl unload -w /System/Library/LaunchAgents/com.apple.ReportCrash.plist
sudo launchctl unload -w /System/Library/LaunchDaemons/com.apple.ReportCrash.Root.plist

#To re-enable crash reporting:
launchctl load -w /System/Library/LaunchAgents/com.apple.ReportCrash.plist
sudo launchctl load -w /System/Library/LaunchDaemons/com.apple.ReportCrash.Root.plist
```
### рд╕реНрд▓реАрдк

MacOS рдореЗрдВ fuzzing рдХрд░рддреЗ рд╕рдордп рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдирд╛ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ рдХрд┐ Mac рд╕реНрд▓реАрдк рдореЛрдб рдореЗрдВ рди рдЬрд╛рдП:

* systemsetup -setsleep Never
* pmset, System Preferences
* [KeepingYouAwake](https://github.com/newmarcel/KeepingYouAwake)

#### SSH рдбрд┐рд╕реНрдХрдиреЗрдХреНрдЯ

рдпрджрд┐ рдЖрдк SSH рдХрдиреЗрдХреНрд╢рди рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ fuzzing рдХрд░ рд░рд╣реЗ рд╣реИрдВ, рддреЛ рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдирд╛ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ рдХрд┐ рд╕реЗрд╢рди рдбрд┐рд╕реНрдХрдиреЗрдХреНрдЯ рди рд╣реЛред рдЗрд╕рд▓рд┐рдП sshd_config рдлрд╛рдЗрд▓ рдХреЛ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреЗ рд╕рд╛рде рдмрджрд▓реЗрдВ:

* TCPKeepAlive Yes
* ClientAliveInterval 0
* ClientAliveCountMax 0
```bash
sudo launchctl unload /System/Library/LaunchDaemons/ssh.plist
sudo launchctl load -w /System/Library/LaunchDaemons/ssh.plist
```
### рдЖрдВрддрд░рд┐рдХ рд╣реИрдВрдбрд▓рд░реНрд╕

**рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреГрд╖реНрда рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ** рдпрд╣ рдЬрд╛рдирдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ рдЖрдк рдХреИрд╕реЗ рдкрддрд╛ рд▓рдЧрд╛ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдХреМрди рд╕рд╛ рдРрдк рдирд┐рд░реНрджрд┐рд╖реНрдЯ рд╕реНрдХреАрдо рдпрд╛ рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдХреЛ **рд╕рдВрднрд╛рд▓рдиреЗ рдХрд╛ рдЬрд┐рдореНрдореЗрджрд╛рд░ рд╣реИ:**

{% content-ref url="../macos-file-extension-apps.md" %}
[macos-file-extension-apps.md](../macos-file-extension-apps.md)
{% endcontent-ref %}

### рдиреЗрдЯрд╡рд░реНрдХ рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХрд╛ рдЧрдгрдирд╛

рдпрд╣ рдЬрд╛рдирдирд╛ рджрд┐рд▓рдЪрд╕реНрдк рд╣реИ рдХрд┐ рдХреМрди рд╕реА рдкреНрд░рдХреНрд░рд┐рдпрд╛рдПрдВ рдиреЗрдЯрд╡рд░реНрдХ рдбреЗрдЯрд╛ рдХрд╛ рдкреНрд░рдмрдВрдзрди рдХрд░ рд░рд╣реА рд╣реИрдВ:
```bash
dtrace -n 'syscall::recv*:entry { printf("-> %s (pid=%d)", execname, pid); }' >> recv.log
#wait some time
sort -u recv.log > procs.txt
cat procs.txt
```
рдпрд╛ `netstat` рдпрд╛ `lsof` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ

### Libgmalloc

<figure><img src="../../../.gitbook/assets/Pasted Graphic 14.png" alt=""><figcaption></figcaption></figure>

{% code overflow="wrap" %}
```bash
lldb -o "target create `which some-binary`" -o "settings set target.env-vars DYLD_INSERT_LIBRARIES=/usr/lib/libgmalloc.dylib" -o "run arg1 arg2" -o "bt" -o "reg read" -o "dis -s \$pc-32 -c 24 -m -F intel" -o "quit"
```
### рдлрдЬрд╝рд░реНрд╕

#### [AFL++](https://github.com/AFLplusplus/AFLplusplus)

CLI рдЯреВрд▓реНрд╕ рдХреЗ рд▓рд┐рдП рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ

#### [Litefuzz](https://github.com/sec-tools/litefuzz)

рдпрд╣ macOS GUI рдЯреВрд▓реНрд╕ рдХреЗ рд╕рд╛рде "**рдмрд╕ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ**". рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдХреБрдЫ macOS рдРрдкреНрд╕ рдореЗрдВ рдХреБрдЫ рд╡рд┐рд╢реЗрд╖ рдЖрд╡рд╢реНрдпрдХрддрд╛рдПрдБ рд╣реЛрддреА рд╣реИрдВ рдЬреИрд╕реЗ рдХрд┐ рдЕрджреНрд╡рд┐рддреАрдп рдлрд╝рд╛рдЗрд▓ рдирд╛рдо, рд╕рд╣реА рдПрдХреНрд╕рдЯреЗрдВрд╢рди, рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ рд╕реИрдВрдбрдмреЙрдХреНрд╕ рд╕реЗ рдкрдврд╝рдиреЗ рдХреА рдЬрд╝рд░реВрд░рдд (`~/Library/Containers/com.apple.Safari/Data`)...

рдХреБрдЫ рдЙрджрд╛рд╣рд░рдг:

{% code overflow="wrap" %}
```bash
# iBooks
litefuzz -l -c "/System/Applications/Books.app/Contents/MacOS/Books FUZZ" -i files/epub -o crashes/ibooks -t /Users/test/Library/Containers/com.apple.iBooksX/Data/tmp -x 10 -n 100000 -ez

# -l : Local
# -c : cmdline with FUZZ word (if not stdin is used)
# -i : input directory or file
# -o : Dir to output crashes
# -t : Dir to output runtime fuzzing artifacts
# -x : Tmeout for the run (default is 1)
# -n : Num of fuzzing iterations (default is 1)
# -e : enable second round fuzzing where any crashes found are reused as inputs
# -z : enable malloc debug helpers

# Font Book
litefuzz -l -c "/System/Applications/Font Book.app/Contents/MacOS/Font Book FUZZ" -i input/fonts -o crashes/font-book -x 2 -n 500000 -ez

# smbutil (using pcap capture)
litefuzz -lk -c "smbutil view smb://localhost:4455" -a tcp://localhost:4455 -i input/mac-smb-resp -p -n 100000 -z

# screensharingd (using pcap capture)
litefuzz -s -a tcp://localhost:5900 -i input/screenshared-session --reportcrash screensharingd -p -n 100000
```
### рдФрд░ MacOS Fuzzing рдХреА рдЬрд╛рдирдХрд╛рд░реА

* [https://www.youtube.com/watch?v=T5xfL9tEg44](https://www.youtube.com/watch?v=T5xfL9tEg44)
* [https://github.com/bnagy/slides/blob/master/OSXScale.pdf](https://github.com/bnagy/slides/blob/master/OSXScale.pdf)
* [https://github.com/bnagy/francis/tree/master/exploitaben](https://github.com/bnagy/francis/tree/master/exploitaben)
* [https://github.com/ant4g0nist/crashwrangler](https://github.com/ant4g0nist/crashwrangler)

## рд╕рдВрджрд░реНрдн

* [**OS X Incident Response: Scripting and Analysis**](https://www.amazon.com/OS-Incident-Response-Scripting-Analysis-ebook/dp/B01FHOHHVS)
* [**https://www.youtube.com/watch?v=T5xfL9tEg44**](https://www.youtube.com/watch?v=T5xfL9tEg44)
* [**https://taomm.org/vol1/analysis.html**](https://taomm.org/vol1/analysis.html)

<details>

<summary><strong>AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рд╢реВрдиреНрдп рд╕реЗ рд▓реЗрдХрд░ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ**](https://peass.creator-spring.com)
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рдПрдХреНрд╕рдХреНрд▓реВрд╕рд┐рд╡ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ рдпрд╛ [**telegram group**](https://t.me/peass) рдпрд╛ **Twitter** ЁЯРж рдкрд░ **рдореБрдЭреЗ рдлреЙрд▓реЛ** рдХрд░реЗрдВ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **HackTricks** рдХреЗ [**github repos**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ.

</details>
