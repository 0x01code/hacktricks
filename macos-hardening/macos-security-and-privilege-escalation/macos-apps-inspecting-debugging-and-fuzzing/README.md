# macOS Apps - –Ü–Ω—Å–ø–µ–∫—Ç—É–≤–∞–Ω–Ω—è, –Ω–∞–ª–∞–≥–æ–¥–∂–µ–Ω–Ω—è —Ç–∞ Fuzzing

{% hint style="success" %}
–í–∏–≤—á–∞–π—Ç–µ —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ —Ö–∞–∫—ñ–Ω–≥ AWS: <img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**–®–∫–æ–ª–∞ —Ö–∞–∫—ñ–Ω–≥—É HackTricks AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
–í–∏–≤—á–∞–π—Ç–µ —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ —Ö–∞–∫—ñ–Ω–≥ GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**–®–∫–æ–ª–∞ —Ö–∞–∫—ñ–Ω–≥—É HackTricks GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>–ü—ñ–¥—Ç—Ä–∏–º–∞–π—Ç–µ HackTricks</summary>

* –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ø–ª–∞–Ω–∏ –ø—ñ–¥–ø–∏—Å–∫–∏**](https://github.com/sponsors/carlospolop)!
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ Telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –Ω–∞–º–∏ –Ω–∞ **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **–ü–æ—à–∏—Ä—é–π—Ç–µ —Ö–∞–∫—ñ–Ω–≥-–ø—Ä–∏–π–æ–º–∏, –Ω–∞–¥—Å–∏–ª–∞–π—Ç–µ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) —Ç–∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) —É GitHub.

</details>
{% endhint %}

### [WhiteIntel](https://whiteintel.io)

<figure><img src="../../../.gitbook/assets/image (1227).png" alt=""><figcaption></figcaption></figure>

[**WhiteIntel**](https://whiteintel.io) - —Ü–µ –ø–æ—à—É–∫–æ–≤–∏–∫, —è–∫–∏–π –ø—Ä–∞—Ü—é—î –Ω–∞ **—Ç–µ–º–Ω–æ–º—É –≤–µ–±-—Å–∞–π—Ç—ñ** —Ç–∞ –ø—Ä–æ–ø–æ–Ω—É—î **–±–µ–∑–∫–æ—à—Ç–æ–≤–Ω—ñ** —Ñ—É–Ω–∫—Ü—ñ—ó –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏, —á–∏ –±—É–ª–∏ **–∫–æ–º–ø–∞–Ω—ñ—è –∞–±–æ —ó—ó –∫–ª—ñ—î–Ω—Ç–∏** **–∫–æ–º–ø—Ä–æ–º–µ—Ç–æ–≤–∞–Ω—ñ** **—à–∫—ñ–¥–ª–∏–≤–∏–º–∏ –ø—Ä–æ–≥—Ä–∞–º–∞–º–∏-–≤–∏–∫—Ä–∞–¥–∞—á–∞–º–∏**.

–û—Å–Ω–æ–≤–Ω–æ—é –º–µ—Ç–æ—é WhiteIntel —î –±–æ—Ä–æ—Ç—å–±–∞ –∑ –∑–∞—Ö–æ–ø–ª–µ–Ω–Ω—è–º –æ–±–ª—ñ–∫–æ–≤–∏—Ö –∑–∞–ø–∏—Å—ñ–≤ —Ç–∞ –∞—Ç–∞–∫–∞–º–∏ –≤–∏–º–∞–≥–∞–Ω–Ω—è –≤–∏–∫—É–ø—É, —â–æ –≤–∏–Ω–∏–∫–∞—é—Ç—å –≤–Ω–∞—Å–ª—ñ–¥–æ–∫ —à–∫—ñ–¥–ª–∏–≤–∏—Ö –ø—Ä–æ–≥—Ä–∞–º, —è–∫—ñ –∫—Ä–∞–¥—É—Ç—å —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é.

–í–∏ –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —ó—Ö –≤–µ–±-—Å–∞–π—Ç —Ç–∞ —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ —ó—Ö–Ω—ñ–π –¥–≤–∏–≥—É–Ω **–±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–æ** –∑–∞ –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º:

{% embed url="https://whiteintel.io" %}

***

## –°—Ç–∞—Ç–∏—á–Ω–∏–π –∞–Ω–∞–ª—ñ–∑

### otool & objdump & nm
```bash
otool -L /bin/ls #List dynamically linked libraries
otool -tv /bin/ps #Decompile application
```
{% code overflow="wrap" %}
```bash
objdump -m --dylibs-used /bin/ls #List dynamically linked libraries
objdump -m -h /bin/ls # Get headers information
objdump -m --syms /bin/ls # Check if the symbol table exists to get function names
objdump -m --full-contents /bin/ls # Dump every section
objdump -d /bin/ls # Dissasemble the binary
objdump --disassemble-symbols=_hello --x86-asm-syntax=intel toolsdemo #Disassemble a function using intel flavour
```
{% endcode %}
```bash
nm -m ./tccd # List of symbols
```
### jtool2 & Disarm

–í–∏ –º–æ–∂–µ—Ç–µ [**–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ disarm –∑–≤—ñ–¥—Å–∏**](https://newosxbook.com/tools/disarm.html).
```bash
ARCH=arm64e disarm -c -i -I --signature /path/bin # Get bin info and signature
ARCH=arm64e disarm -c -l /path/bin # Get binary sections
ARCH=arm64e disarm -c -L /path/bin # Get binary commands (dependencies included)
ARCH=arm64e disarm -c -S /path/bin # Get symbols (func names, strings...)
ARCH=arm64e disarm -c -d /path/bin # Get disasembled
jtool2 -d __DATA.__const myipc_server | grep MIG # Get MIG info
```
–í–∏ –º–æ–∂–µ—Ç–µ [**–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ jtool2 —Ç—É—Ç**](http://www.newosxbook.com/tools/jtool.html) –∞–±–æ –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –π–æ–≥–æ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `brew`.
```bash
# Install
brew install --cask jtool2

jtool2 -l /bin/ls # Get commands (headers)
jtool2 -L /bin/ls # Get libraries
jtool2 -S /bin/ls # Get symbol info
jtool2 -d /bin/ls # Dump binary
jtool2 -D /bin/ls # Decompile binary

# Get signature information
ARCH=x86_64 jtool2 --sig /System/Applications/Automator.app/Contents/MacOS/Automator

# Get MIG information
jtool2 -d __DATA.__const myipc_server | grep MIG
```
{% hint style="danger" %}
**jtool –∑–∞—Å—Ç–∞—Ä—ñ–≤ –Ω–∞ –∫–æ—Ä–∏—Å—Ç—å disarm**
{% endhint %}

### Codesign / ldid

{% hint style="success" %}
**`Codesign`** –º–æ–∂–Ω–∞ –∑–Ω–∞–π—Ç–∏ –≤ **macOS**, —Ç–æ–¥—ñ —è–∫ **`ldid`** –º–æ–∂–Ω–∞ –∑–Ω–∞–π—Ç–∏ –≤ **iOS**
{% endhint %}
```bash
# Get signer
codesign -vv -d /bin/ls 2>&1 | grep -E "Authority|TeamIdentifier"

# Check if the app‚Äôs contents have been modified
codesign --verify --verbose /Applications/Safari.app

# Get entitlements from the binary
codesign -d --entitlements :- /System/Applications/Automator.app # Check the TCC perms

# Check if the signature is valid
spctl --assess --verbose /Applications/Safari.app

# Sign a binary
codesign -s <cert-name-keychain> toolsdemo

# Get signature info
ldid -h <binary>

# Get entitlements
ldid -e <binary>

# Change entilements
## /tmp/entl.xml is a XML file with the new entitlements to add
ldid -S/tmp/entl.xml <binary>
```
### SuspiciousPackage

[**SuspiciousPackage**](https://mothersruin.com/software/SuspiciousPackage/get.html) - —Ü–µ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, –∫–æ—Ä–∏—Å–Ω–∏–π –¥–ª—è —ñ–Ω—Å–ø–µ–∫—Ç—É–≤–∞–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤ **.pkg** (—ñ–Ω—Å—Ç–∞–ª—è—Ç–æ—Ä—ñ–≤) —Ç–∞ –ø–µ—Ä–µ–≥–ª—è–¥—É —ó—Ö –≤–º—ñ—Å—Ç—É –ø–µ—Ä–µ–¥ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è–º.\
–¶—ñ —ñ–Ω—Å—Ç–∞–ª—è—Ç–æ—Ä–∏ –º–∞—é—Ç—å —Å—Ü–µ–Ω–∞—Ä—ñ—ó `preinstall` —Ç–∞ `postinstall` bash, —è–∫—ñ –∑–ª–æ–≤–∂–∏–≤–∞—é—Ç—å –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫–∏ –¥–ª—è **–ø–æ—Å—Ç—ñ–π–Ω–æ–≥–æ** **—Ä–æ–∑–ø–æ–≤—Å—é–¥–∂–µ–Ω–Ω—è** **–∑–ª–æ–≤–º–∏—Å–Ω–æ–≥–æ** **–ø—Ä–æ–≥—Ä–∞–º–Ω–æ–≥–æ** **–∑–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è**.

### hdiutil

–¶–µ–π —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–æ–∑–≤–æ–ª—è—î **–º–æ–Ω—Ç—É–≤–∞—Ç–∏** –æ–±—Ä–∞–∑–∏ –¥–∏—Å–∫—ñ–≤ Apple (**.dmg**) –¥–ª—è —ó—Ö —ñ–Ω—Å–ø–µ–∫—Ç—É–≤–∞–Ω–Ω—è –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º —á–æ–≥–æ-–Ω–µ–±—É–¥—å:
```bash
hdiutil attach ~/Downloads/Firefox\ 58.0.2.dmg
```
–¶–µ –±—É–¥–µ –∑–º–æ–Ω—Ç–æ–≤–∞–Ω–æ –≤ `/Volumes`

### –£–ø–∞–∫–æ–≤–∞–Ω—ñ –±—ñ–Ω–∞—Ä–Ω—ñ —Ñ–∞–π–ª–∏

* –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤–∏—Å–æ–∫–æ—ó –µ–Ω—Ç—Ä–æ–ø—ñ—ó
* –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ä—è–¥–∫—ñ–≤ (—á–∏ —î –º–∞–π–∂–µ –Ω–µ–∑—Ä–æ–∑—É–º—ñ–ª–∏–π —Ä—è–¥–æ–∫, —É–ø–∞–∫–æ–≤–∞–Ω–∏–π)
* –£–ø–∞–∫–æ–≤—É–≤–∞—á UPX –¥–ª—è MacOS –≥–µ–Ω–µ—Ä—É—î —Ä–æ–∑–¥—ñ–ª –ø—ñ–¥ –Ω–∞–∑–≤–æ—é "\_\_XHDR"

## –°—Ç–∞—Ç–∏—á–Ω–∏–π –∞–Ω–∞–ª—ñ–∑ Objective-C

### –ú–µ—Ç–∞–¥–∞–Ω—ñ

{% hint style="danger" %}
–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ –ø—Ä–æ–≥—Ä–∞–º–∏, –Ω–∞–ø–∏—Å–∞–Ω—ñ –Ω–∞ Objective-C, **–∑–±–µ—Ä—ñ–≥–∞—é—Ç—å** —Å–≤–æ—ó –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è –∫–ª–∞—Å—ñ–≤ **–ø—ñ–¥ —á–∞—Å** **–∫–æ–º–ø—ñ–ª—è—Ü—ñ—ó** —É [–±—ñ–Ω–∞—Ä–Ω–∏—Ö —Ñ–∞–π–ª–∞—Ö Mach-O](../macos-files-folders-and-binaries/universal-binaries-and-mach-o-format.md). –¢–∞–∫—ñ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è –∫–ª–∞—Å—ñ–≤ **–≤–∫–ª—é—á–∞—é—Ç—å** —ñ–º'—è —Ç–∞ —Ç–∏–ø:
{% endhint %}

* –í–∏–∑–Ω–∞—á–µ–Ω—ñ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∏
* –ú–µ—Ç–æ–¥–∏ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É
* –ó–º—ñ–Ω–Ω—ñ –µ–∫–∑–µ–º–ø–ª—è—Ä–∞ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É
* –í–∏–∑–Ω–∞—á–µ–Ω—ñ –ø—Ä–æ—Ç–æ–∫–æ–ª–∏

–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ —Ü—ñ —ñ–º–µ–Ω–∞ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –∑–∞—Ç–µ–º–Ω–µ–Ω—ñ, —â–æ–± —É—Å–∫–ª–∞–¥–Ω–∏—Ç–∏ —Ä–æ–∑–±—ñ—Ä –±—ñ–Ω–∞—Ä–Ω–æ–≥–æ –∫–æ–¥—É.

### –í–∏–∫–ª–∏–∫ —Ñ—É–Ω–∫—Ü—ñ–π

–ö–æ–ª–∏ —Ñ—É–Ω–∫—Ü—ñ—è –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è –≤ –±—ñ–Ω–∞—Ä–Ω–æ–º—É —Ñ–∞–π–ª—ñ, —è–∫–∏–π –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î Objective-C, —Å–∫–æ–º–ø—ñ–ª—å–æ–≤–∞–Ω–∏–π –∫–æ–¥ –∑–∞–º—ñ—Å—Ç—å –≤–∏–∫–ª–∏–∫—É —Ü—ñ—î—ó —Ñ—É–Ω–∫—Ü—ñ—ó –±—É–¥–µ –≤–∏–∫–ª–∏–∫–∞—Ç–∏ **`objc_msgSend`**. –¶–µ –≤–∏–∫–ª–∏—á–µ –æ—Å—Ç–∞—Ç–æ—á–Ω—É —Ñ—É–Ω–∫—Ü—ñ—é:

![](<../../../.gitbook/assets/image (305).png>)

–ü–∞—Ä–∞–º–µ—Ç—Ä–∏, —è–∫—ñ –æ—á—ñ–∫—É—î —Ü—è —Ñ—É–Ω–∫—Ü—ñ—è, —Ü–µ:

* –ü–µ—Ä—à–∏–π –ø–∞—Ä–∞–º–µ—Ç—Ä (**self**) - "–≤–∫–∞–∑—ñ–≤–Ω–∏–∫, —è–∫–∏–π –≤–∫–∞–∑—É—î –Ω–∞ **–µ–∫–∑–µ–º–ø–ª—è—Ä –∫–ª–∞—Å—É, —è–∫–∏–π –º–∞—î –æ—Ç—Ä–∏–º–∞—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è**". –Ü–Ω—à–∏–º–∏ —Å–ª–æ–≤–∞–º–∏, —Ü–µ –æ–±'—î–∫—Ç, –Ω–∞ —è–∫–æ–º—É –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è –º–µ—Ç–æ–¥. –Ø–∫—â–æ –º–µ—Ç–æ–¥ —î –º–µ—Ç–æ–¥–æ–º –∫–ª–∞—Å—É, —Ü–µ –±—É–¥–µ –µ–∫–∑–µ–º–ø–ª—è—Ä –æ–±'—î–∫—Ç–∞ –∫–ª–∞—Å—É (–≤ —Ü—ñ–ª–æ–º—É), —Ç–æ–¥—ñ —è–∫ –¥–ª—è –º–µ—Ç–æ–¥—É –µ–∫–∑–µ–º–ø–ª—è—Ä–∞ self –≤–∫–∞–∑—É–≤–∞—Ç–∏–º–µ –Ω–∞ —Å—Ç–≤–æ—Ä–µ–Ω–∏–π –µ–∫–∑–µ–º–ø–ª—è—Ä –∫–ª–∞—Å—É —è–∫ –æ–±'—î–∫—Ç.
* –î—Ä—É–≥–∏–π –ø–∞—Ä–∞–º–µ—Ç—Ä (**op**) - "—Å–µ–ª–µ–∫—Ç–æ—Ä –º–µ—Ç–æ–¥—É, —è–∫–∏–π –æ–±—Ä–æ–±–ª—è—î –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è". –¶–µ –ø—Ä–æ—Å—Ç–æ **—ñ–º'—è –º–µ—Ç–æ–¥—É**.
* –†–µ—à—Ç–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤ - –±—É–¥—å-—è–∫—ñ **–∑–Ω–∞—á–µ–Ω–Ω—è, —è–∫—ñ –ø–æ—Ç—Ä—ñ–±–Ω—ñ –¥–ª—è –º–µ—Ç–æ–¥—É** (op).

–î–∏–≤—ñ—Ç—å—Å—è, —è–∫ **–ª–µ–≥–∫–æ –æ—Ç—Ä–∏–º–∞—Ç–∏ —Ü—é —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `lldb` –≤ ARM64** –Ω–∞ —Ü—ñ–π —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ:

{% content-ref url="arm64-basic-assembly.md" %}
[arm64-basic-assembly.md](arm64-basic-assembly.md)
{% endcontent-ref %}

x64:

| **–ê—Ä–≥—É–º–µ–Ω—Ç**      | **–†–µ–≥—ñ—Å—Ç—Ä**                                                    | **(–¥–ª—è) objc\_msgSend**                                |
| ----------------- | --------------------------------------------------------------- | ------------------------------------------------------ |
| **1-–π –∞—Ä–≥—É–º–µ–Ω—Ç**  | **rdi**                                                         | **self: –æ–±'—î–∫—Ç, –Ω–∞ —è–∫–æ–º—É –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è –º–µ—Ç–æ–¥**         |
| **2-–π –∞—Ä–≥—É–º–µ–Ω—Ç**  | **rsi**                                                         | **op: —ñ–º'—è –º–µ—Ç–æ–¥—É**                                   |
| **3-–π –∞—Ä–≥—É–º–µ–Ω—Ç**  | **rdx**                                                         | **1-–π –∞—Ä–≥—É–º–µ–Ω—Ç –º–µ—Ç–æ–¥—É**                               |
| **4-–π –∞—Ä–≥—É–º–µ–Ω—Ç**  | **rcx**                                                         | **2-–π –∞—Ä–≥—É–º–µ–Ω—Ç –º–µ—Ç–æ–¥—É**                               |
| **5-–π –∞—Ä–≥—É–º–µ–Ω—Ç**  | **r8**                                                          | **3-–π –∞—Ä–≥—É–º–µ–Ω—Ç –º–µ—Ç–æ–¥—É**                               |
| **6-–π –∞—Ä–≥—É–º–µ–Ω—Ç**  | **r9**                                                          | **4-–π –∞—Ä–≥—É–º–µ–Ω—Ç –º–µ—Ç–æ–¥—É**                               |
| **7+ –∞—Ä–≥—É–º–µ–Ω—Ç**   | <p><strong>rsp+</strong><br><strong>(–Ω–∞ —Å—Ç–µ–∫—É)</strong></p>   | **5+ –∞—Ä–≥—É–º–µ–Ω—Ç –º–µ—Ç–æ–¥—É**                                |

### –í–∏–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –º–µ—Ç–∞–¥–∞–Ω–∏—Ö ObjectiveC

### Dynadump

[**Dynadump**](https://github.com/DerekSelander/dynadump) - —Ü–µ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è —Ä–æ–∑–±–æ—Ä—É –∫–ª–∞—Å—ñ–≤ –±—ñ–Ω–∞—Ä–Ω–∏—Ö —Ñ–∞–π–ª—ñ–≤ Objective-C. –£ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó GitHub –∑–∞–∑–Ω–∞—á–µ–Ω–æ dylibs, –∞–ª–µ —Ü–µ —Ç–∞–∫–æ–∂ –ø—Ä–∞—Ü—é—î –∑ –≤–∏–∫–æ–Ω—É–≤–∞–Ω–∏–º–∏ —Ñ–∞–π–ª–∞–º–∏.
```bash
./dynadump dump /path/to/bin
```
–ù–∞ –º–æ–º–µ–Ω—Ç –Ω–∞–ø–∏—Å–∞–Ω–Ω—è, —Ü–µ **–∑–∞—Ä–∞–∑ –ø—Ä–∞—Ü—é—î –∫—Ä–∞—â–µ –∑–∞ –≤—Å–µ**.

#### –ó–≤–∏—á–∞–π–Ω—ñ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏
```bash
nm --dyldinfo-only /path/to/bin
otool -ov /path/to/bin
objdump --macho --objc-meta-data /path/to/bin
```
#### class-dump

[**class-dump**](https://github.com/nygard/class-dump/) - —Ü–µ –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–∏–π —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –¥–µ–∫–ª–∞—Ä–∞—Ü—ñ–π –¥–ª—è –∫–ª–∞—Å—ñ–≤, –∫–∞—Ç–µ–≥–æ—Ä—ñ–π —Ç–∞ –ø—Ä–æ—Ç–æ–∫–æ–ª—ñ–≤ —É —Ñ–æ—Ä–º–∞—Ç–æ–≤–∞–Ω–æ–º—É –∫–æ–¥—ñ ObjetiveC.

–¶–µ —Å—Ç–∞—Ä–∏–π —ñ –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É–≤–∞–Ω–∏–π —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, —Ç–æ–º—É –π–º–æ–≤—ñ—Ä–Ω–æ, —â–æ –≤—ñ–Ω –Ω–µ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏–º–µ –Ω–∞–ª–µ–∂–Ω–∏–º —á–∏–Ω–æ–º.

#### ICDump

[**iCDump**](https://github.com/romainthomas/iCDump) - —Ü–µ —Å—É—á–∞—Å–Ω–∏–π —Ç–∞ –∫—Ä–æ—Å-–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–∏–π –¥–∞–º–ø –∫–ª–∞—Å—ñ–≤ Objective-C. –ü–æ—Ä—ñ–≤–Ω—è–Ω–æ –∑ —ñ—Å–Ω—É—é—á–∏–º–∏ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏, iCDump –º–æ–∂–µ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –Ω–µ–∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ –µ–∫–æ—Å–∏—Å—Ç–µ–º–∏ Apple —Ç–∞ –Ω–∞–¥–∞—î –∑–≤'—è–∑–∫–∏ –∑ Python.
```python
import icdump
metadata = icdump.objc.parse("/path/to/bin")

print(metadata.to_decl())
```
## –°—Ç–∞—Ç–∏—á–Ω–∏–π –∞–Ω–∞–ª—ñ–∑ Swift

–ó Swift –±—ñ–Ω–∞—Ä–Ω–∏–º–∏ —Ñ–∞–π–ª–∞–º–∏, –æ—Å–∫—ñ–ª—å–∫–∏ —î —Å—É–º—ñ—Å–Ω—ñ—Å—Ç—å –∑ Objective-C, —ñ–Ω–æ–¥—ñ –º–æ–∂–Ω–∞ –≤–∏–¥–æ–±—É—Ç–∏ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ [class-dump](https://github.com/nygard/class-dump/), –∞–ª–µ –Ω–µ –∑–∞–≤–∂–¥–∏.

–ó–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –∫–æ–º–∞–Ω–¥–Ω–∏—Ö —Ä—è–¥–∫—ñ–≤ **`jtool -l`** –∞–±–æ **`otool -l`** –º–æ–∂–Ω–∞ –∑–Ω–∞–π—Ç–∏ –∫—ñ–ª—å–∫–∞ —Ä–æ–∑–¥—ñ–ª—ñ–≤, —è–∫—ñ –ø–æ—á–∏–Ω–∞—é—Ç—å—Å—è –∑ –ø—Ä–µ—Ñ—ñ–∫—Å–∞ **`__swift5`**:
```bash
jtool2 -l /Applications/Stocks.app/Contents/MacOS/Stocks
LC 00: LC_SEGMENT_64              Mem: 0x000000000-0x100000000    __PAGEZERO
LC 01: LC_SEGMENT_64              Mem: 0x100000000-0x100028000    __TEXT
[...]
Mem: 0x100026630-0x100026d54        __TEXT.__swift5_typeref
Mem: 0x100026d60-0x100027061        __TEXT.__swift5_reflstr
Mem: 0x100027064-0x1000274cc        __TEXT.__swift5_fieldmd
Mem: 0x1000274cc-0x100027608        __TEXT.__swift5_capture
[...]
```
–í–∏ –º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ –¥–æ–¥–∞—Ç–∫–æ–≤—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ **—ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é, –∑–±–µ—Ä–µ–∂–µ–Ω—É –≤ —Ü–∏—Ö —Ä–æ–∑–¥—ñ–ª–∞—Ö, —É —Ü—å–æ–º—É –¥–æ–ø–∏—Å—ñ –±–ª–æ–≥—É**. 

–ë—ñ–ª—å—à–µ —Ç–æ–≥–æ, **–±—ñ–Ω–∞—Ä–Ω—ñ —Ñ–∞–π–ª–∏ Swift –º–æ–∂—É—Ç—å –º—ñ—Å—Ç–∏—Ç–∏ —Å–∏–º–≤–æ–ª–∏** (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏ –ø–æ–≤–∏–Ω–Ω—ñ –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ —Å–∏–º–≤–æ–ª–∏, —â–æ–± —ó—Ö —Ñ—É–Ω–∫—Ü—ñ—ó –º–æ–∂–Ω–∞ –±—É–ª–æ –≤–∏–∫–ª–∏–∫–∞—Ç–∏). **–°–∏–º–≤–æ–ª–∏ –∑–∞–∑–≤–∏—á–∞–π –º—ñ—Å—Ç—è—Ç—å —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –Ω–∞–∑–≤—É —Ñ—É–Ω–∫—Ü—ñ—ó** —Ç–∞ –∞—Ç—Ä–∏–±—É—Ç–∏ —É –Ω–µ–∫—Ä–∞—Å–∏–≤–æ–º—É –≤–∏–≥–ª—è–¥—ñ, —Ç–æ–º—É –≤–æ–Ω–∏ –¥—É–∂–µ –∫–æ—Ä–∏—Å–Ω—ñ, —ñ —î "**–¥–µ–º–∞–Ω–≥–ª–µ—Ä–∏"**, —è–∫—ñ –º–æ–∂—É—Ç—å –æ—Ç—Ä–∏–º–∞—Ç–∏ –ø–æ—á–∞—Ç–∫–æ–≤—É –Ω–∞–∑–≤—É:
```bash
# Ghidra plugin
https://github.com/ghidraninja/ghidra_scripts/blob/master/swift_demangler.py

# Swift cli
swift demangle
```
## –î–∏–Ω–∞–º—ñ—á–Ω–∏–π –∞–Ω–∞–ª—ñ–∑

{% hint style="warning" %}
–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ –¥–ª—è –Ω–∞–ª–∞–≥–æ–¥–∂–µ–Ω–Ω—è –±—ñ–Ω–∞—Ä–Ω–∏—Ö —Ñ–∞–π–ª—ñ–≤ **SIP –ø–æ–≤–∏–Ω–µ–Ω –±—É—Ç–∏ –≤–∏–º–∫–Ω–µ–Ω–∏–π** (`csrutil disable` –∞–±–æ `csrutil enable --without debug`) –∞–±–æ —Å–∫–æ–ø—ñ—é–≤–∞—Ç–∏ –±—ñ–Ω–∞—Ä–Ω—ñ —Ñ–∞–π–ª–∏ –≤ —Ç–∏–º—á–∞—Å–æ–≤—É —Ç–µ–∫—É —Ç–∞ **–≤–∏–¥–∞–ª–∏—Ç–∏ –ø—ñ–¥–ø–∏—Å** –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `codesign --remove-signature <—à–ª—è—Ö-–¥–æ-–±—ñ–Ω–∞—Ä–Ω–æ–≥–æ-—Ñ–∞–π–ª—É>` –∞–±–æ –¥–æ–∑–≤–æ–ª–∏—Ç–∏ –Ω–∞–ª–∞–≥–æ–¥–∂–µ–Ω–Ω—è –±—ñ–Ω–∞—Ä–Ω–æ–≥–æ —Ñ–∞–π–ª—É (–º–æ–∂–Ω–∞ —Å–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏—Å—è [—Ü–∏–º —Å–∫—Ä–∏–ø—Ç–æ–º](https://gist.github.com/carlospolop/a66b8d72bb8f43913c4b5ae45672578b))
{% endhint %}

{% hint style="warning" %}
–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ –¥–ª—è **—ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—É–≤–∞–Ω–Ω—è —Å–∏—Å—Ç–µ–º–Ω–∏—Ö –±—ñ–Ω–∞—Ä–Ω–∏—Ö —Ñ–∞–π–ª—ñ–≤** (—Ç–∞–∫–∏—Ö —è–∫ `cloudconfigurationd`) –Ω–∞ macOS, **SIP –ø–æ–≤–∏–Ω–µ–Ω –±—É—Ç–∏ –≤–∏–º–∫–Ω–µ–Ω–∏–π** (–ø—Ä–æ—Å—Ç–æ –≤–∏–¥–∞–ª–µ–Ω–Ω—è –ø—ñ–¥–ø–∏—Å—É –Ω–µ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏–º–µ).
{% endhint %}

### APIs

macOS –Ω–∞–¥–∞—î –¥–µ—è–∫—ñ —Ü—ñ–∫–∞–≤—ñ API, —è–∫—ñ –Ω–∞–¥–∞—é—Ç—å —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –ø—Ä–æ—Ü–µ—Å–∏:

* `proc_info`: –¶–µ –æ—Å–Ω–æ–≤–Ω–∏–π, —â–æ –Ω–∞–¥–∞—î –±–∞–≥–∞—Ç–æ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ –∫–æ–∂–µ–Ω –ø—Ä–æ—Ü–µ—Å. –í–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –º–∞—Ç–∏ –ø—Ä–∞–≤–∞ root, —â–æ–± –æ—Ç—Ä–∏–º–∞—Ç–∏ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ —ñ–Ω—à—ñ –ø—Ä–æ—Ü–µ—Å–∏, –∞–ª–µ –≤–∞–º –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω—ñ —Å–ø–µ—Ü—ñ–∞–ª—å–Ω—ñ –¥–æ–∑–≤–æ–ª–∏ –∞–±–æ –ø–æ—Ä—Ç–∏ mach.
* `libsysmon.dylib`: –¶–µ –¥–æ–∑–≤–æ–ª—è—î –æ—Ç—Ä–∏–º—É–≤–∞—Ç–∏ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –ø—Ä–æ—Ü–µ—Å–∏ —á–µ—Ä–µ–∑ –≤–∏–∫–ª–∞–¥–µ–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó XPC, –æ–¥–Ω–∞–∫ –¥–ª—è —Ü—å–æ–≥–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ –º–∞—Ç–∏ –¥–æ–∑–≤—ñ–ª `com.apple.sysmond.client`.

### Stackshot —Ç–∞ microstackshots

**Stackshotting** - —Ü–µ —Ç–µ—Ö–Ω—ñ–∫–∞, —è–∫–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –∑–∞—Ö–æ–ø–ª–µ–Ω–Ω—è —Å—Ç–∞–Ω—É –ø—Ä–æ—Ü–µ—Å—ñ–≤, –≤–∫–ª—é—á–∞—é—á–∏ —Å—Ç–µ–∫–∏ –≤–∏–∫–ª–∏–∫—ñ–≤ —É—Å—ñ—Ö –∑–∞–ø—É—â–µ–Ω–∏—Ö –ø–æ—Ç–æ–∫—ñ–≤. –¶–µ –æ—Å–æ–±–ª–∏–≤–æ –∫–æ—Ä–∏—Å–Ω–æ –¥–ª—è –Ω–∞–ª–∞–≥–æ–¥–∂–µ–Ω–Ω—è, –∞–Ω–∞–ª—ñ–∑—É –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ —Ç–∞ —Ä–æ–∑—É–º—ñ–Ω–Ω—è –ø–æ–≤–µ–¥—ñ–Ω–∫–∏ —Å–∏—Å—Ç–µ–º–∏ –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏–π –º–æ–º–µ–Ω—Ç —á–∞—Å—É. –ù–∞ iOS —Ç–∞ macOS stackshotting –º–æ–∂–Ω–∞ –≤–∏–∫–æ–Ω–∞—Ç–∏ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –∫—ñ–ª—å–∫–æ—Ö —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤ —Ç–∞ –º–µ—Ç–æ–¥—ñ–≤, —Ç–∞–∫–∏—Ö —è–∫ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏ **`sample`** —Ç–∞ **`spindump`**.

### Sysdiagnose

–¶–µ–π —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç (`/usr/bini/ysdiagnose`) –≤ –æ—Å–Ω–æ–≤–Ω–æ–º—É –∑–±–∏—Ä–∞—î –±–∞–≥–∞—Ç–æ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –∑ –≤–∞—à–æ–≥–æ –∫–æ–º–ø'—é—Ç–µ—Ä–∞, –≤–∏–∫–æ–Ω—É—é—á–∏ –¥–µ—Å—è—Ç–∫–∏ —Ä—ñ–∑–Ω–∏—Ö –∫–æ–º–∞–Ω–¥, —Ç–∞–∫–∏—Ö —è–∫ `ps`, `zprint`...

–í—ñ–Ω –ø–æ–≤–∏–Ω–µ–Ω –±—É—Ç–∏ –∑–∞–ø—É—â–µ–Ω–∏–π —è–∫ **root**, –∞ –¥–µ–º–æ–Ω `/usr/libexec/sysdiagnosed` –º–∞—î –¥—É–∂–µ —Ü—ñ–∫–∞–≤—ñ –¥–æ–∑–≤–æ–ª–∏, —Ç–∞–∫—ñ —è–∫ `com.apple.system-task-ports` —Ç–∞ `get-task-allow`.

–ô–æ–≥–æ plist —Ä–æ–∑—Ç–∞—à–æ–≤–∞–Ω–∏–π –≤ `/System/Library/LaunchDaemons/com.apple.sysdiagnose.plist`, —è–∫–∏–π –æ–≥–æ–ª–æ—à—É—î 3 MachServices:

* `com.apple.sysdiagnose.CacheDelete`: –í–∏–¥–∞–ª—è—î —Å—Ç–∞—Ä—ñ –∞—Ä—Ö—ñ–≤–∏ –≤ /var/rmp
* `com.apple.sysdiagnose.kernel.ipc`: –°–ø–µ—Ü—ñ–∞–ª—å–Ω–∏–π –ø–æ—Ä—Ç 23 (—è–¥—Ä–æ)
* `com.apple.sysdiagnose.service.xpc`: –Ü–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Ä–µ–∂–∏–º—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —á–µ—Ä–µ–∑ –∫–ª–∞—Å `Libsysdiagnose` Obj-C. –¢—Ä–∏ –∞—Ä–≥—É–º–µ–Ω—Ç–∏ –≤ —Å–ª–æ–≤–Ω–∏–∫—É –º–æ–∂—É—Ç—å –±—É—Ç–∏ –ø–µ—Ä–µ–¥–∞–Ω—ñ (`compress`, `display`, `run`)

### –û–±'—î–¥–Ω–∞–Ω—ñ –∂—É—Ä–Ω–∞–ª–∏

macOS –≥–µ–Ω–µ—Ä—É—î –±–∞–≥–∞—Ç–æ –∂—É—Ä–Ω–∞–ª—ñ–≤, —è–∫—ñ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –¥—É–∂–µ –∫–æ—Ä–∏—Å–Ω–∏–º–∏ –ø—Ä–∏ –∑–∞–ø—É—Å–∫—É –¥–æ–¥–∞—Ç–∫–∞ –¥–ª—è —Ä–æ–∑—É–º—ñ–Ω–Ω—è **—â–æ –≤—ñ–Ω —Ä–æ–±–∏—Ç—å**.

–ë—ñ–ª—å—à–µ —Ç–æ–≥–æ, —î –¥–µ—è–∫—ñ –∂—É—Ä–Ω–∞–ª–∏, —è–∫—ñ –º—ñ—Å—Ç–∏—Ç–∏–º—É—Ç—å —Ç–µ–≥ `<private>`, —â–æ–± **–ø—Ä–∏—Ö–æ–≤–∞—Ç–∏** –¥–µ—è–∫—É **—ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–æ–≤–∞–Ω—É** —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ **–∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞** –∞–±–æ **–∫–æ–º–ø'—é—Ç–µ—Ä**. –û–¥–Ω–∞–∫ –º–æ–∂–Ω–∞ **–≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç –¥–ª—è —Ä–æ–∑–∫—Ä–∏—Ç—Ç—è —Ü—ñ—î—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó**. –î–æ—Ç—Ä–∏–º—É–π—Ç–µ—Å—å –ø–æ—è—Å–Ω–µ–Ω—å –∑ [**—Ç—É—Ç**](https://superuser.com/questions/1532031/how-to-show-private-data-in-macos-unified-log).

### Hopper

#### –õ—ñ–≤–∞ –ø–∞–Ω–µ–ª—å

–£ –ª—ñ–≤—ñ–π –ø–∞–Ω–µ–ª—ñ hopper –º–æ–∂–Ω–∞ –ø–æ–±–∞—á–∏—Ç–∏ —Å–∏–º–≤–æ–ª–∏ (**–ú—ñ—Ç–∫–∏**) –±—ñ–Ω–∞—Ä–Ω–æ–≥–æ —Ñ–∞–π–ª—É, —Å–ø–∏—Å–æ–∫ –ø—Ä–æ—Ü–µ–¥—É—Ä —Ç–∞ —Ñ—É–Ω–∫—Ü—ñ–π (**Proc**) —Ç–∞ —Ä—è–¥–∫–∏ (**Str**). –¶–µ –Ω–µ –≤—Å—ñ —Ä—è–¥–∫–∏, –∞–ª–µ —Ç—ñ, —â–æ –≤–∏–∑–Ω–∞—á–µ–Ω—ñ –≤ –∫—ñ–ª—å–∫–æ—Ö —á–∞—Å—Ç–∏–Ω–∞—Ö —Ñ–∞–π–ª—É Mac-O (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥ _cstring –∞–±–æ_ `objc_methname`).

#### –°–µ—Ä–µ–¥–Ω—è –ø–∞–Ω–µ–ª—å

–£ —Å–µ—Ä–µ–¥–Ω—ñ–π –ø–∞–Ω–µ–ª—ñ –≤–∏ –º–æ–∂–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ **—Ä–æ–∑—ñ–±—Ä–∞–Ω–∏–π –∫–æ–¥**. –Ü –≤–∏ –º–æ–∂–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ –π–æ–≥–æ —É **—Å–∏—Ä–æ–º—É** —Ä–æ–∑—ñ–±—Ä–∞–Ω–Ω—ñ, —è–∫ **–≥—Ä–∞—Ñ**, —è–∫ **–¥–µ–∫–æ–º–ø—ñ–ª—å–æ–≤–∞–Ω–∏–π** —Ç–∞ —è–∫ **–±—ñ–Ω–∞—Ä–Ω–∏–π**, –Ω–∞—Ç–∏—Å–Ω—É–≤—à–∏ –Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–∏–π –∑–Ω–∞—á–æ–∫:

<figure><img src="../../../.gitbook/assets/image (343).png" alt=""><figcaption></figcaption></figure>

–ö–ª–∞—Ü–Ω—É–≤—à–∏ –ø—Ä–∞–≤–æ—é –∫–Ω–æ–ø–∫–æ—é –º–∏—à—ñ –Ω–∞ –æ–±'—î–∫—Ç—ñ –∫–æ–¥—É, –≤–∏ –º–æ–∂–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ **–ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞/–≤—ñ–¥ —Ü—å–æ–≥–æ –æ–±'—î–∫—Ç—É** –∞–±–æ –Ω–∞–≤—ñ—Ç—å –∑–º—ñ–Ω–∏—Ç–∏ –π–æ–≥–æ —ñ–º'—è (—Ü–µ –Ω–µ –ø—Ä–∞—Ü—é—î –≤ –¥–µ–∫–æ–º–ø—ñ–ª—å–æ–≤–∞–Ω–æ–º—É –ø—Å–µ–≤–¥–æ–∫–æ–¥—ñ):

<figure><img src="../../../.gitbook/assets/image (1117).png" alt=""><figcaption></figcaption></figure>

–ë—ñ–ª—å—à–µ —Ç–æ–≥–æ, —É **—Å–µ—Ä–µ–¥–Ω—ñ–π –Ω–∏–∂–Ω—ñ–π —á–∞—Å—Ç–∏–Ω—ñ –≤–∏ –º–æ–∂–µ—Ç–µ –≤–≤–æ–¥–∏—Ç–∏ –∫–æ–º–∞–Ω–¥–∏ python**.

#### –ü—Ä–∞–≤–∞ –ø–∞–Ω–µ–ª—å

–£ –ø—Ä–∞–≤—ñ–π –ø–∞–Ω–µ–ª—ñ –≤–∏ –º–æ–∂–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ —Ü—ñ–∫–∞–≤—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é, —Ç–∞–∫—É —è–∫ **—ñ—Å—Ç–æ—Ä—ñ—é –Ω–∞–≤—ñ–≥–∞—Ü—ñ—ó** (—â–æ–± –∑–Ω–∞—Ç–∏, —è–∫ –≤–∏ –ø–æ—Ç—Ä–∞–ø–∏–ª–∏ –≤ –ø–æ—Ç–æ—á–Ω—É —Å–∏—Ç—É–∞—Ü—ñ—é), **–≥—Ä–∞—Ñ –≤–∏–∫–ª–∏–∫—ñ–≤**, –¥–µ –≤–∏ –º–æ–∂–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ –≤—Å—ñ **—Ñ—É–Ω–∫—Ü—ñ—ó, —è–∫—ñ –≤–∏–∫–ª–∏–∫–∞—é—Ç—å —Ü—é —Ñ—É–Ω–∫—Ü—ñ—é**, —ñ –≤—Å—ñ —Ñ—É–Ω–∫—Ü—ñ—ó, —è–∫—ñ **—Ü—è —Ñ—É–Ω–∫—Ü—ñ—è –≤–∏–∫–ª–∏–∫–∞—î**, —Ç–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ **–ª–æ–∫–∞–ª—å–Ω—ñ –∑–º—ñ–Ω–Ω—ñ**.

### dtrace

–¶–µ –¥–æ–∑–≤–æ–ª—è—î –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ –¥–æ–¥–∞—Ç–∫—ñ–≤ –Ω–∞ –¥—É–∂–µ **–Ω–∏–∑—å–∫–æ–º—É —Ä—ñ–≤–Ω—ñ** —Ç–∞ –Ω–∞–¥–∞—î —Å–ø–æ—Å—ñ–± –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º **—Å–ª—ñ–¥–∫—É–≤–∞—Ç–∏** –∑–∞ **–ø—Ä–æ–≥—Ä–∞–º–∞–º–∏** —Ç–∞ –Ω–∞–≤—ñ—Ç—å –∑–º—ñ–Ω—é–≤–∞—Ç–∏ —ó—Ö–Ω—ñ–π —Ö—ñ–¥ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è. Dtrace –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î **–ø—Ä–æ–±–∏**, —è–∫—ñ —Ä–æ–∑–º—ñ—â–µ–Ω—ñ –ø–æ –≤—Å—å–æ–º—É —è–¥—Ä—É —ñ –∑–Ω–∞—Ö–æ–¥—è—Ç—å—Å—è –≤ —Ç–∞–∫–∏—Ö –º—ñ—Å—Ü—è—Ö, —è–∫ –ø–æ—á–∞—Ç–æ–∫ —Ç–∞ –∫—ñ–Ω–µ—Ü—å —Å–∏—Å—Ç–µ–º–Ω–∏—Ö –≤–∏–∫–ª–∏–∫—ñ–≤.

DTrace –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î —Ñ—É–Ω–∫—Ü—ñ—é **`dtrace_probe_create`** –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø—Ä–æ–±–∏ –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –≤–∏–∫–ª–∏–∫—É. –¶—ñ –ø—Ä–æ–±–∏ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –≤–∏–∫–ª–∏–∫–∞–Ω—ñ –≤ **—Ç–æ—á—Ü—ñ –≤—Ö–æ–¥—É —Ç–∞ –≤–∏—Ö–æ–¥—É –∫–æ–∂–Ω–æ–≥–æ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –≤–∏–∫–ª–∏–∫—É**. –í–∑–∞—î–º–æ–¥—ñ—è –∑ DTrace –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è —á–µ—Ä–µ–∑ /dev/dtrace, —è–∫–∏–π –¥–æ—Å—Ç—É–ø–Ω–∏–π –ª–∏—à–µ –¥–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ root.

{% hint style="success" %}
–©–æ–± —É–≤—ñ–º–∫–Ω—É—Ç–∏ Dtrace –±–µ–∑ –ø–æ–≤–Ω–æ–≥–æ –≤–∏–º–∫–Ω–µ–Ω–Ω—è –∑–∞—Ö–∏—Å—Ç—É SIP, –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ–Ω–∞—Ç–∏ —É —Ä–µ–∂–∏–º—ñ –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è: `csrutil enable --without dtrace`

–í–∏ —Ç–∞–∫–æ–∂ –º–æ–∂–µ—Ç–µ **`dtrace`** –∞–±–æ **`dtruss`** –±—ñ–Ω–∞—Ä–Ω—ñ —Ñ–∞–π–ª–∏, **—è–∫—ñ –≤–∏ —Å–∫–æ–º–ø—ñ–ª—é–≤–∞–ª–∏**.
{% endhint %}

–î–æ—Å—Ç—É–ø–Ω—ñ –ø—Ä–æ–±–∏ dtrace –º–æ–∂–Ω–∞ –æ—Ç—Ä–∏–º–∞—Ç–∏ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é:
```bash
dtrace -l | head
ID   PROVIDER            MODULE                          FUNCTION NAME
1     dtrace                                                     BEGIN
2     dtrace                                                     END
3     dtrace                                                     ERROR
43    profile                                                     profile-97
44    profile                                                     profile-199
```
–ù–∞–∑–≤–∞ –∑–æ–Ω–¥—É —Å–∫–ª–∞–¥–∞—î—Ç—å—Å—è –∑ —á–æ—Ç–∏—Ä—å–æ—Ö —á–∞—Å—Ç–∏–Ω: –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫, –º–æ–¥—É–ª—å, —Ñ—É–Ω–∫—Ü—ñ—è —Ç–∞ –Ω–∞–∑–≤–∞ (`fbt:mach_kernel:ptrace:entry`). –Ø–∫—â–æ –≤–∏ –Ω–µ –≤–∫–∞–∑—É—î—Ç–µ –¥–µ—è–∫—É —á–∞—Å—Ç–∏–Ω—É –Ω–∞–∑–≤–∏, Dtrace –∑–∞—Å—Ç–æ—Å—É—î —Ü—é —á–∞—Å—Ç–∏–Ω—É —è–∫ —à–∞–±–ª–æ–Ω.

–î–ª—è –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è DTrace –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü—ñ—ó –∑–æ–Ω–¥—ñ–≤ —Ç–∞ –≤–∫–∞–∑—ñ–≤–∫–∏ –¥—ñ–π, —è–∫—ñ —Å–ª—ñ–¥ –≤–∏–∫–æ–Ω–∞—Ç–∏ –ø—Ä–∏ —ó—Ö —Å–ø—Ä–∞—Ü—é–≤–∞–Ω–Ω—ñ, –Ω–∞–º –∑–Ω–∞–¥–æ–±–∏—Ç—å—Å—è –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –º–æ–≤—É D.

–î–æ–∫–ª–∞–¥–Ω—ñ—à–µ –ø–æ—è—Å–Ω–µ–Ω–Ω—è —Ç–∞ –±—ñ–ª—å—à–µ –ø—Ä–∏–∫–ª–∞–¥—ñ–≤ –º–æ–∂–Ω–∞ –∑–Ω–∞–π—Ç–∏ –∑–∞ –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º [https://illumos.org/books/dtrace/chp-intro.html](https://illumos.org/books/dtrace/chp-intro.html)

#### –ü—Ä–∏–∫–ª–∞–¥–∏

–ó–∞–ø—É—Å—Ç—ñ—Ç—å `man -k dtrace`, —â–æ–± –ø–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ **–¥–æ—Å—Ç—É–ø–Ω—ñ —Å—Ü–µ–Ω–∞—Ä—ñ—ó DTrace**. –ü—Ä–∏–∫–ª–∞–¥: `sudo dtruss -n binary`

* –£ —Ä—è–¥–∫—É
```bash
#Count the number of syscalls of each running process
sudo dtrace -n 'syscall:::entry {@[execname] = count()}'
```
* —Å—Ü–µ–Ω–∞—Ä—ñ–π
```bash
syscall:::entry
/pid == $1/
{
}

#Log every syscall of a PID
sudo dtrace -s script.d 1234
```

```bash
syscall::open:entry
{
printf("%s(%s)", probefunc, copyinstr(arg0));
}
syscall::close:entry
{
printf("%s(%d)\n", probefunc, arg0);
}

#Log files opened and closed by a process
sudo dtrace -s b.d -c "cat /etc/hosts"
```

```bash
syscall:::entry
{
;
}
syscall:::return
{
printf("=%d\n", arg1);
}

#Log sys calls with values
sudo dtrace -s syscalls_info.d -c "cat /etc/hosts"
```
### dtruss
```bash
dtruss -c ls #Get syscalls of ls
dtruss -c -p 1000 #get syscalls of PID 1000
```
### kdebug

–¶–µ –∑–∞—Å—ñ–± –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è —è–¥—Ä–∞. –î–æ–∫—É–º–µ–Ω—Ç–æ–≤–∞–Ω—ñ –∫–æ–¥–∏ –º–æ–∂–Ω–∞ –∑–Ω–∞–π—Ç–∏ –≤ **`/usr/share/misc/trace.codes`**.

–Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏, —Ç–∞–∫—ñ —è–∫ `latency`, `sc_usage`, `fs_usage` —Ç–∞ `trace`, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å –π–æ–≥–æ –≤–Ω—É—Ç—Ä—ñ—à–Ω—å–æ.

–î–ª—è –≤–∑–∞—î–º–æ–¥—ñ—ó –∑ `kdebug` –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è `sysctl` —á–µ—Ä–µ–∑ –ø—Ä–æ—Å—Ç—ñ—Ä —ñ–º–µ–Ω `kern.kdebug`, –∞ MIB-–æ–±'—î–∫—Ç–∏ –¥–ª—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –º–æ–∂–Ω–∞ –∑–Ω–∞–π—Ç–∏ –≤ `sys/sysctl.h`, –¥–µ —Ñ—É–Ω–∫—Ü—ñ—ó —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω—ñ –≤ `bsd/kern/kdebug.c`.

–î–ª—è –≤–∑–∞—î–º–æ–¥—ñ—ó –∑ kdebug –∑ –≤–ª–∞—Å–Ω–∏–º –∫–ª—ñ—î–Ω—Ç–æ–º –∑–∞–∑–≤–∏—á–∞–π –≤–∏–∫–æ–Ω—É—é—Ç—å—Å—è —Ç–∞–∫—ñ –∫—Ä–æ–∫–∏:

* –í–∏–¥–∞–ª–∏—Ç–∏ —ñ—Å–Ω—É—é—á—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é KERN\_KDSETREMOVE
* –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ —Å–ª—ñ–¥–∫—É–≤–∞–Ω–Ω—è –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é KERN\_KDSETBUF —Ç–∞ KERN\_KDSETUP
* –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ KERN\_KDGETBUF, —â–æ–± –æ—Ç—Ä–∏–º–∞—Ç–∏ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∑–∞–ø–∏—Å—ñ–≤ —É –±—É—Ñ–µ—Ä—ñ
* –û—Ç—Ä–∏–º–∞–π—Ç–µ –≤–ª–∞—Å–Ω–æ–≥–æ –∫–ª—ñ—î–Ω—Ç–∞ –∑—ñ —Å–ª—ñ–¥–∫—É–≤–∞–Ω–Ω—è –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é KERN\_KDPINDEX
* –£–≤—ñ–º–∫–Ω—ñ—Ç—å —Å–ª—ñ–¥–∫—É–≤–∞–Ω–Ω—è –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é KERN\_KDENABLE
* –ü—Ä–æ—á–∏—Ç–∞–π—Ç–µ –±—É—Ñ–µ—Ä, –≤–∏–∫–ª–∏–∫–∞—é—á–∏ KERN\_KDREADTR
* –î–ª—è –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ—Å—Ç—ñ –∫–æ–∂–Ω–æ–≥–æ –ø–æ—Ç–æ–∫—É –π–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—É –≤–∏–∫–ª–∏—á—Ç–µ KERN\_KDTHRMAP.

–î–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —Ü—ñ—î—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç Apple **`trace`** –∞–±–æ –≤–ª–∞—Å–Ω–∏–π —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç [kDebugView (kdv)](https://newosxbook.com/tools/kdv.html)**.**

**–ó–∞—É–≤–∞–∂—Ç–µ, —â–æ Kdebug –¥–æ—Å—Ç—É–ø–Ω–∏–π –ª–∏—à–µ –¥–ª—è 1 –∫–ª—ñ—î–Ω—Ç–∞ –æ–¥–Ω–æ—á–∞—Å–Ω–æ.** –¢–∞–∫–∏–º —á–∏–Ω–æ–º, –æ–¥–Ω–æ—á–∞—Å–Ω–æ –º–æ–∂–µ –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏—Å—è –ª–∏—à–µ –æ–¥–∏–Ω —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, —è–∫–∏–π –ø—Ä–∞—Ü—é—î –Ω–∞ –æ—Å–Ω–æ–≤—ñ k-debug.

### ktrace

API `ktrace_*` –ø–æ—Ö–æ–¥—è—Ç—å –∑ `libktrace.dylib`, —è–∫–∞ –æ–±–≥–æ—Ä—Ç–∞—î —Ç—ñ, —â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è –≤ `Kdebug`. –ü—ñ—Å–ª—è —Ü—å–æ–≥–æ –∫–ª—ñ—î–Ω—Ç –º–æ–∂–µ –ø—Ä–æ—Å—Ç–æ –≤–∏–∫–ª–∏–∫–∞—Ç–∏ `ktrace_session_create` —Ç–∞ `ktrace_events_[single/class]`, —â–æ–± –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –∑–≤–æ—Ä–æ—Ç–Ω—ñ –≤–∏–∫–ª–∏–∫–∏ –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ñ –∫–æ–¥–∏, –∞ –ø–æ—Ç—ñ–º –∑–∞–ø—É—Å—Ç–∏—Ç–∏ –π–æ–≥–æ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `ktrace_start`.

–í–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Ü–µ –Ω–∞–≤—ñ—Ç—å –∑ **SIP –∞–∫—Ç–∏–≤–æ–≤–∞–Ω–∏–º**

–í–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —è–∫ –∫–ª—ñ—î–Ω—Ç–∏ —É—Ç–∏–ª—ñ—Ç—É `ktrace`:
```bash
ktrace trace -s -S -t c -c ls | grep "ls("
```
–ê–±–æ `tailspin`.

### kperf

–¶–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –ø—Ä–æ—Ñ—ñ–ª—é–≤–∞–Ω–Ω—è –Ω–∞ —Ä—ñ–≤–Ω—ñ —è–¥—Ä–∞ —ñ –ø–æ–±—É–¥–æ–≤–∞–Ω–µ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –≤–∏–∫–ª–∏–∫—ñ–≤ `Kdebug`.

–û—Å–Ω–æ–≤–Ω–∞ –∑–º—ñ–Ω–Ω–∞ `kernel_debug_active` –ø–µ—Ä–µ–≤—ñ—Ä—è—î—Ç—å—Å—è, —ñ —è–∫—â–æ –≤–æ–Ω–∞ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞, –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è `kperf_kdebug_handler` –∑ –∫–æ–¥–æ–º `Kdebug` —Ç–∞ –∞–¥—Ä–µ—Å–æ—é –≤–∏–∫–ª–∏–∫—É —è–¥—Ä–∞. –Ø–∫—â–æ –∫–æ–¥ `Kdebug` –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –≤–∏–±—Ä–∞–Ω–æ–º—É, –æ—Ç—Ä–∏–º—É—î "–¥—ñ—ó", –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω—ñ —è–∫ –±—ñ—Ç–æ–≤–∞ –∫–∞—Ä—Ç–∞ (–ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ `osfmk/kperf/action.h` –¥–ª—è –≤–∞—Ä—ñ–∞–Ω—Ç—ñ–≤).

–£ Kperf —Ç–∞–∫–æ–∂ —î —Ç–∞–±–ª–∏—Ü—è MIB sysctl: (—è–∫ root) `sysctl kperf`. –¶–µ–π –∫–æ–¥ –º–æ–∂–Ω–∞ –∑–Ω–∞–π—Ç–∏ –≤ `osfmk/kperf/kperfbsd.c`.

–ö—Ä—ñ–º —Ç–æ–≥–æ, –ø—ñ–¥–º–Ω–æ–∂–∏–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—É Kperf –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤ `kpc`, —è–∫–∞ –Ω–∞–¥–∞—î —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –ª—ñ—á–∏–ª—å–Ω–∏–∫–∏ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ –º–∞—à–∏–Ω–∏.

### ProcessMonitor

[**ProcessMonitor**](https://objective-see.com/products/utilities.html#ProcessMonitor) - —Ü–µ –¥—É–∂–µ –∫–æ—Ä–∏—Å–Ω–∏–π —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –¥—ñ–π, –ø–æ–≤'—è–∑–∞–Ω–∏—Ö –∑ –ø—Ä–æ—Ü–µ—Å–∞–º–∏, —è–∫—ñ –≤–∏–∫–æ–Ω—É—î –ø—Ä–æ—Ü–µ—Å (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –Ω–æ–≤–∏—Ö –ø—Ä–æ—Ü–µ—Å—ñ–≤, —è–∫—ñ —Å—Ç–≤–æ—Ä—é—î –ø—Ä–æ—Ü–µ—Å).

### SpriteTree

[**SpriteTree**](https://themittenmac.com/tools/) - —Ü–µ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –≤–∑–∞—î–º–æ–∑–≤'—è–∑–∫—ñ–≤ –º—ñ–∂ –ø—Ä–æ—Ü–µ—Å–∞–º–∏.\
–í–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤—ñ–¥—Å—Ç–µ–∂—É–≤–∞—Ç–∏ —Å–≤—ñ–π Mac –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –∫–æ–º–∞–Ω–¥–∏, –ø–æ–¥—ñ–±–Ω–æ—ó **`sudo eslogger fork exec rename create > cap.json`** (—Ç–µ—Ä–º—ñ–Ω–∞–ª, —â–æ –∑–∞–ø—É—Å–∫–∞—î —Ü–µ, –ø–æ—Ç—Ä–µ–±—É—î FDA). –ü–æ—Ç—ñ–º –≤–∏ –º–æ–∂–µ—Ç–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ json —É —Ü–µ–π —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, —â–æ–± –ø–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –≤—Å—ñ –≤–∑–∞—î–º–æ–∑–≤'—è–∑–∫–∏:

<figure><img src="../../../.gitbook/assets/image (1182).png" alt="" width="375"><figcaption></figcaption></figure>

### FileMonitor

[**FileMonitor**](https://objective-see.com/products/utilities.html#FileMonitor) –¥–æ–∑–≤–æ–ª—è—î –≤—ñ–¥—Å—Ç–µ–∂—É–≤–∞—Ç–∏ –ø–æ–¥—ñ—ó —Ñ–∞–π–ª—ñ–≤ (—Ç–∞–∫—ñ —è–∫ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è, –∑–º—ñ–Ω–∏ —Ç–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è), –Ω–∞–¥–∞—é—á–∏ –¥–æ–∫–ª–∞–¥–Ω—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ —Ç–∞–∫—ñ –ø–æ–¥—ñ—ó.

### Crescendo

[**Crescendo**](https://github.com/SuprHackerSteve/Crescendo) - —Ü–µ –≥—Ä–∞—Ñ—ñ—á–Ω–∏–π —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –∑ –≤–∏–≥–ª—è–¥–æ–º, —è–∫–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ Windows –º–æ–∂—É—Ç—å –∑–Ω–∞—Ç–∏ –∑ _Procmon_ –≤—ñ–¥ Microsoft Sysinternal. –¶–µ–π —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–æ–∑–≤–æ–ª—è—î –ø–æ—á–∞—Ç–∏ —Ç–∞ –∑—É–ø–∏–Ω–∏—Ç–∏ –∑–∞–ø–∏—Å —Ä—ñ–∑–Ω–∏—Ö —Ç–∏–ø—ñ–≤ –ø–æ–¥—ñ–π, —Ñ—ñ–ª—å—Ç—Ä—É–≤–∞—Ç–∏ —Ü—ñ –ø–æ–¥—ñ—ó –∑–∞ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è–º–∏, —Ç–∞–∫–∏–º–∏ —è–∫ —Ñ–∞–π–ª, –ø—Ä–æ—Ü–µ—Å, –º–µ—Ä–µ–∂–∞ —ñ —Ç. –¥., —ñ –Ω–∞–¥–∞—î —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –∑–∞–ø–∏—Å–∞–Ω–∏—Ö –ø–æ–¥—ñ–π —É —Ñ–æ—Ä–º–∞—Ç—ñ json.

### Apple Instruments

[**Apple Instruments**](https://developer.apple.com/library/archive/documentation/Performance/Conceptual/CellularBestPractices/Appendix/Appendix.html) —î —á–∞—Å—Ç–∏–Ω–æ—é —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤ —Ä–æ–∑—Ä–æ–±–Ω–∏–∫–∞ Xcode, —è–∫—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è –¥–ª—è –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ –¥–æ–¥–∞—Ç–∫—ñ–≤, –≤–∏—è–≤–ª–µ–Ω–Ω—è –≤–∏—Ç–æ–∫—ñ–≤ –ø–∞–º'—è—Ç—ñ —Ç–∞ –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ —Ñ–∞–π–ª–æ–≤–æ—ó —Å–∏—Å—Ç–µ–º–∏.

![](<../../../.gitbook/assets/image (1138).png>)

### fs\_usage

–î–æ–∑–≤–æ–ª—è—î –≤—ñ–¥—Å—Ç–µ–∂—É–≤–∞—Ç–∏ –¥—ñ—ó, –≤–∏–∫–æ–Ω–∞–Ω—ñ –ø—Ä–æ—Ü–µ—Å–∞–º–∏:
```bash
fs_usage -w -f filesys ls #This tracks filesystem actions of proccess names containing ls
fs_usage -w -f network curl #This tracks network actions
```
### TaskExplorer

[**Taskexplorer**](https://objective-see.com/products/taskexplorer.html) –∫–æ—Ä–∏—Å–Ω–∏–π –¥–ª—è –ø–µ—Ä–µ–≥–ª—è–¥—É **–±—ñ–±–ª—ñ–æ—Ç–µ–∫**, —è–∫—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –±—ñ–Ω–∞—Ä–Ω–∏–π —Ñ–∞–π–ª, **—Ñ–∞–π–ª—ñ–≤**, —è–∫—ñ –≤—ñ–Ω –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î, —Ç–∞ **–º–µ—Ä–µ–∂–µ–≤–∏—Ö** –∑'—î–¥–Ω–∞–Ω—å.\
–¢–∞–∫–æ–∂ –ø–µ—Ä–µ–≤—ñ—Ä—è—î –ø—Ä–æ—Ü–µ—Å–∏ –±—ñ–Ω–∞—Ä–Ω–æ–≥–æ —Ñ–∞–π–ª—É –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç **virustotal** —Ç–∞ –ø–æ–∫–∞–∑—É—î —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –±—ñ–Ω–∞—Ä–Ω–∏–π —Ñ–∞–π–ª.

## PT\_DENY\_ATTACH <a href="#page-title" id="page-title"></a>

–£ [**—Ü—å–æ–º—É –¥–æ–ø–∏—Å—ñ –±–ª–æ–≥—É**](https://knight.sc/debugging/2019/06/03/debugging-apple-binaries-that-use-pt-deny-attach.html) –≤–∏ –º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ –ø—Ä–∏–∫–ª–∞–¥ —Ç–æ–≥–æ, —è–∫ **–Ω–∞–ª–∞–≥–æ–¥–∏—Ç–∏ –ø—Ä–∞—Ü—é—é—á–∏–π –¥–µ–º–æ–Ω**, —è–∫–∏–π –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞–≤ **`PT_DENY_ATTACH`** –¥–ª—è –∑–∞–ø–æ–±—ñ–≥–∞–Ω–Ω—è –Ω–∞–ª–∞–≥–æ–¥–∂–µ–Ω–Ω—é –Ω–∞–≤—ñ—Ç—å —è–∫—â–æ SIP –±—É–≤ –≤–∏–º–∫–Ω–µ–Ω–∏–π.

### lldb

**lldb** - —Ü–µ —Ñ–∞–∫—Ç–∏—á–Ω–∏–π —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è **–Ω–∞–ª–∞–≥–æ–¥–∂–µ–Ω–Ω—è** –±—ñ–Ω–∞—Ä–Ω–∏—Ö —Ñ–∞–π–ª—ñ–≤ **macOS**.
```bash
lldb ./malware.bin
lldb -p 1122
lldb -n malware.bin
lldb -n malware.bin --waitfor
```
–í–∏ –º–æ–∂–µ—Ç–µ –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ intel flavour –ø—Ä–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—ñ lldb, —Å—Ç–≤–æ—Ä–∏–≤—à–∏ —Ñ–∞–π–ª –ø—ñ–¥ –Ω–∞–∑–≤–æ—é **`.lldbinit`** —É –≤–∞—à—ñ–π –¥–æ–º–∞—à–Ω—ñ–π –ø–∞–ø—Ü—ñ –∑ –Ω–∞—Å—Ç—É–ø–Ω–∏–º —Ä—è–¥–∫–æ–º:
```bash
settings set target.x86-disassembly-flavor intel
```
{% hint style="warning" %}
–£—Å–µ—Ä–µ–¥–∏–Ω—ñ lldb –≤–∏–≤–µ–¥—ñ—Ç—å –ø—Ä–æ—Ü–µ—Å –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `process save-core`
{% endhint %}

<table data-header-hidden><thead><tr><th width="225"></th><th></th></tr></thead><tbody><tr><td><strong>(lldb) –ö–æ–º–∞–Ω–¥–∞</strong></td><td><strong>–û–ø–∏—Å</strong></td></tr><tr><td><strong>run (r)</strong></td><td>–ü–æ—á–∞—Ç–æ–∫ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è, —è–∫–µ —Ç—Ä–∏–≤–∞—Ç–∏–º–µ –±–µ–∑–ø–µ—Ä–µ—Ä–≤–Ω–æ –¥–æ —Ç–æ–≥–æ, —è–∫ –±—É–¥–µ –¥–æ—Å—è–≥–Ω—É—Ç–æ —Ç–æ—á–∫—É –∑—É–ø–∏–Ω–∫–∏ –∞–±–æ –ø—Ä–æ—Ü–µ—Å –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è.</td></tr><tr><td><strong>continue (c)</strong></td><td>–ü—Ä–æ–¥–æ–≤–∂–∏—Ç–∏ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –ø—Ä–æ—Ü–µ—Å—É, —è–∫–∏–π –≤—ñ–¥–ª–∞–≥–æ–¥–∂—É—î—Ç—å—Å—è.</td></tr><tr><td><strong>nexti (n / ni)</strong></td><td>–í–∏–∫–æ–Ω–∞—Ç–∏ –Ω–∞—Å—Ç—É–ø–Ω—É —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—é. –¶—è –∫–æ–º–∞–Ω–¥–∞ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –≤–∏–∫–ª–∏–∫–∏ —Ñ—É–Ω–∫—Ü—ñ–π.</td></tr><tr><td><strong>stepi (s / si)</strong></td><td>–í–∏–∫–æ–Ω–∞—Ç–∏ –Ω–∞—Å—Ç—É–ø–Ω—É —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—é. –ù–∞ –≤—ñ–¥–º—ñ–Ω—É –≤—ñ–¥ –∫–æ–º–∞–Ω–¥–∏ nexti, —Ü—è –∫–æ–º–∞–Ω–¥–∞ —É–≤—ñ–π–¥–µ –≤ –≤–∏–∫–ª–∏–∫–∏ —Ñ—É–Ω–∫—Ü—ñ–π.</td></tr><tr><td><strong>finish (f)</strong></td><td>–í–∏–∫–æ–Ω–∞—Ç–∏ —Ä–µ—à—Ç—É —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ–π —É –ø–æ—Ç–æ—á–Ω—ñ–π —Ñ—É–Ω–∫—Ü—ñ—ó ("—Ñ—Ä–µ–π–º") —Ç–∞ –∑—É–ø–∏–Ω–∏—Ç–∏ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è.</td></tr><tr><td><strong>control + c</strong></td><td>–ü—Ä–∏–∑—É–ø–∏–Ω–∏—Ç–∏ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è. –Ø–∫—â–æ –ø—Ä–æ—Ü–µ—Å –±—É–≤ –∑–∞–ø—É—â–µ–Ω–∏–π (r) –∞–±–æ –ø—Ä–æ–¥–æ–≤–∂–µ–Ω–∏–π (c), —Ü–µ –ø—Ä–∏–∑–≤–µ–¥–µ –¥–æ –∑—É–ø–∏–Ω–∫–∏ –ø—Ä–æ—Ü–µ—Å—É ... –¥–µ –± –≤—ñ–Ω –∑–∞—Ä–∞–∑ –≤–∏–∫–æ–Ω—É–≤–∞–≤—Å—è.</td></tr><tr><td><strong>breakpoint (b)</strong></td><td><p>b main #–ë—É–¥—å-—è–∫–∞ —Ñ—É–Ω–∫—Ü—ñ—è –∑ —ñ–º'—è–º main</p><p>b &#x3C;binname>`main #–ì–æ–ª–æ–≤–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è –±—ñ–Ω–∞—Ä–Ω–æ–≥–æ —Ñ–∞–π–ª—É</p><p>b set -n main --shlib &#x3C;lib_name> #–ì–æ–ª–æ–≤–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è –≤–∫–∞–∑–∞–Ω–æ–≥–æ –±—ñ–Ω–∞—Ä–Ω–æ–≥–æ —Ñ–∞–π–ª—É</p><p>b -[NSDictionary objectForKey:]</p><p>b -a 0x0000000100004bd9</p><p>br l #–°–ø–∏—Å–æ–∫ —Ç–æ—á–æ–∫ –∑—É–ø–∏–Ω–∫–∏</p><p>br e/dis &#x3C;num> #–£–≤—ñ–º–∫–Ω—É—Ç–∏/–≤–∏–º–∫–Ω—É—Ç–∏ —Ç–æ—á–∫—É –∑—É–ø–∏–Ω–∫–∏</p><p>breakpoint delete &#x3C;num></p></td></tr><tr><td><strong>help</strong></td><td><p>help breakpoint #–û—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ–≤—ñ–¥–∫—É –ø—Ä–æ –∫–æ–º–∞–Ω–¥—É —Ç–æ—á–∫–∏ –∑—É–ø–∏–Ω–∫–∏</p><p>help memory write #–û—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ–≤—ñ–¥–∫—É —â–æ–¥–æ –∑–∞–ø–∏—Å—É –≤ –ø–∞–º'—è—Ç—å</p></td></tr><tr><td><strong>reg</strong></td><td><p>reg read</p><p>reg read $rax</p><p>reg read $rax --format &#x3C;<a href="https://lldb.llvm.org/use/variable.html#type-format">format</a>></p><p>reg write $rip 0x100035cc0</p></td></tr><tr><td><strong>x/s &#x3C;reg/memory address</strong></td><td>–ü–æ–∫–∞–∑–∞—Ç–∏ –ø–∞–º'—è—Ç—å —è–∫ —Ä—è–¥–æ–∫ –∑ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è–º –Ω—É–ª—å–æ–≤–æ–≥–æ —Å–∏–º–≤–æ–ª—É.</td></tr><tr><td><strong>x/i &#x3C;reg/memory address</strong></td><td>–ü–æ–∫–∞–∑–∞—Ç–∏ –ø–∞–º'—è—Ç—å —è–∫ –º–∞—à–∏–Ω–Ω—É —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—é.</td></tr><tr><td><strong>x/b &#x3C;reg/memory address</strong></td><td>–ü–æ–∫–∞–∑–∞—Ç–∏ –ø–∞–º'—è—Ç—å —è–∫ –±–∞–π—Ç.</td></tr><tr><td><strong>print object (po)</strong></td><td><p>–¶–µ –≤–∏–≤–µ–¥–µ –æ–±'—î–∫—Ç, –Ω–∞ —è–∫–∏–π –ø–æ—Å–∏–ª–∞—î—Ç—å—Å—è –ø–∞—Ä–∞–º–µ—Ç—Ä</p><p>po $raw</p><p><code>{</code></p><p><code>dnsChanger = {</code></p><p><code>"affiliate" = "";</code></p><p><code>"blacklist_dns" = ();</code></p><p>–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ –±—ñ–ª—å—à—ñ—Å—Ç—å API-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ñ–≤ –∞–±–æ –º–µ—Ç–æ–¥—ñ–≤ Objective-C –≤—ñ–¥ Apple –ø–æ–≤–µ—Ä—Ç–∞—é—Ç—å –æ–±'—î–∫—Ç–∏, —Ç–æ–º—É —ó—Ö —Å–ª—ñ–¥ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—Ç–∏ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –∫–æ–º–∞–Ω–¥–∏ "print object" (po). –Ø–∫—â–æ po –Ω–µ –≤–∏–≤–æ–¥–∏—Ç—å –∑–º—ñ—Å—Ç–æ–≤–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ <code>x/b</code></p></td></tr><tr><td><strong>memory</strong></td><td>memory read 0x000....<br>memory read $x0+0xf2a<br>memory write 0x100600000 -s 4 0x41414141 #–ó–∞–ø–∏—Å–∞—Ç–∏ AAAA –∑–∞ —Ü—ñ—î—é –∞–¥—Ä–µ—Å–æ—é<br>memory write -f s $rip+0x11f+7 "AAAA" #–ó–∞–ø–∏—Å–∞—Ç–∏ AAAA –∑–∞ –∞–¥—Ä–µ—Å–æ—é</td></tr><tr><td><strong>disassembly</strong></td><td><p>dis #–†–æ–∑—ñ–±—Ä–∞—Ç–∏ –ø–æ—Ç–æ—á–Ω—É —Ñ—É–Ω–∫—Ü—ñ—é</p><p>dis -n &#x3C;funcname> #–†–æ–∑—ñ–±—Ä–∞—Ç–∏ —Ñ—É–Ω–∫—Ü—ñ—é</p><p>dis -n &#x3C;funcname> -b &#x3C;basename> #–†–æ–∑—ñ–±—Ä–∞—Ç–∏ —Ñ—É–Ω–∫—Ü—ñ—é<br>dis -c 6 #–†–æ–∑—ñ–±—Ä–∞—Ç–∏ 6 —Ä—è–¥–∫—ñ–≤<br>dis -c 0x100003764 -e 0x100003768 # –í—ñ–¥ –æ–¥–Ω—ñ—î—ó –∞–¥—Ä–µ—Å–∏ –¥–æ —ñ–Ω—à–æ—ó<br>dis -p -c 4 # –ü–æ—á–∞—Ç–∏ —Ä–æ–∑—ñ–±—Ä–∞—Ç–∏ –∑ –ø–æ—Ç–æ—á–Ω–æ—ó –∞–¥—Ä–µ—Å–∏</p></td></tr><tr><td><strong>parray</strong></td><td>parray 3 (char **)$x1 # –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –º–∞—Å–∏–≤ –∑ 3 –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏ –≤ —Ä–µ–≥—ñ—Å—Ç—Ä—ñ x1</td></tr></tbody></table>

{% hint style="info" %}
–ü—Ä–∏ –≤–∏–∫–ª–∏–∫—É —Ñ—É–Ω–∫—Ü—ñ—ó **`objc_sendMsg`**, —Ä–µ–≥—ñ—Å—Ç—Ä **rsi** –º—ñ—Å—Ç–∏—Ç—å **—ñ–º'—è –º–µ—Ç–æ–¥—É** —è–∫ —Ä—è–¥–æ–∫ –∑ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è–º –Ω—É–ª—å–æ–≤–æ–≥–æ —Å–∏–º–≤–æ–ª—É ("C"). –©–æ–± –≤–∏–≤–µ—Å—Ç–∏ —ñ–º'—è —á–µ—Ä–µ–∑ lldb, –≤–∏–∫–æ–Ω–∞–π—Ç–µ:

`(lldb) x/s $rsi: 0x1000f1576: "startMiningWithPort:password:coreCount:slowMemory:currency:"`

`(lldb) print (char*)$rsi:`\
`(char *) $1 = 0x00000001000f1576 "startMiningWithPort:password:coreCount:slowMemory:currency:"`

`(lldb) reg read $rsi: rsi = 0x00000001000f1576 "startMiningWithPort:password:coreCount:slowMemory:currency:"`
{% endhint %}

### –ü—Ä–æ—Ç–∏–¥—ñ—è –¥–∏–Ω–∞–º—ñ—á–Ω–æ–º—É –∞–Ω–∞–ª—ñ–∑—É

#### –í–∏—è–≤–ª–µ–Ω–Ω—è –≤—ñ—Ä—Ç—É–∞–ª—å–Ω–∏—Ö –º–∞—à–∏–Ω

* –ö–æ–º–∞–Ω–¥–∞ **`sysctl hw.model`** –ø–æ–≤–µ—Ä—Ç–∞—î "Mac", –∫–æ–ª–∏ **—Ö–æ—Å—Ç - MacOS**, –∞–ª–µ —â–æ—Å—å —ñ–Ω—à–µ, –∫–æ–ª–∏ —Ü–µ –≤—ñ—Ä—Ç—É–∞–ª—å–Ω–∞ –º–∞—à–∏–Ω–∞.
* –ì—Ä–∞—é—á–∏ –∑—ñ –∑–Ω–∞—á–µ–Ω–Ω—è–º–∏ **`hw.logicalcpu`** —Ç–∞ **`hw.physicalcpu`**, –¥–µ—è–∫—ñ —à–∫—ñ–¥–ª–∏–≤—ñ –ø—Ä–æ–≥—Ä–∞–º–∏ –Ω–∞–º–∞–≥–∞—é—Ç—å—Å—è –≤–∏—è–≤–∏—Ç–∏, —á–∏ —Ü–µ –≤—ñ—Ä—Ç—É–∞–ª—å–Ω–∞ –º–∞—à–∏–Ω–∞.
* –î–µ—è–∫—ñ —à–∫—ñ–¥–ª–∏–≤—ñ –ø—Ä–æ–≥—Ä–∞–º–∏ —Ç–∞–∫–æ–∂ –º–æ–∂—É—Ç—å **–≤–∏—è–≤–∏—Ç–∏**, —á–∏ –º–∞—à–∏–Ω–∞ –±–∞–∑—É—î—Ç—å—Å—è –Ω–∞ **VMware** –∑–∞ MAC-–∞–¥—Ä–µ—Å–æ—é (00:50:56).
* –¢–∞–∫–æ–∂ –º–æ–∂–Ω–∞ –≤–∏—è–≤–∏—Ç–∏, —á–∏ –ø—Ä–æ—Ü–µ—Å **–≤—ñ–¥–ª–∞–≥–æ–¥–∂—É—î—Ç—å—Å—è** –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –ø—Ä–æ—Å—Ç–æ–≥–æ –∫–æ–¥—É, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥:
* `if(P_TRACED == (info.kp_proc.p_flag & P_TRACED)){ //–ø—Ä–æ—Ü–µ—Å –≤—ñ–¥–ª–∞–≥–æ–¥–∂—É—î—Ç—å—Å—è }`
* –¢–∞–∫–æ–∂ –º–æ–∂–Ω–∞ –≤–∏–∫–ª–∏–∫–∞—Ç–∏ —Å–∏—Å—Ç–µ–º–Ω–∏–π –≤–∏–∫–ª–∏–∫ **`ptrace`** –∑ –ø—Ä–∞–ø–æ—Ä—Ü–µ–º **`PT_DENY_ATTACH`**. –¶–µ **–∑–∞–ø–æ–±—ñ–≥–∞—î** –ø—Ä–∏—î–¥–Ω–∞–Ω–Ω—é —Ç–∞ –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—é –≤—ñ–¥–ª–∞–≥–æ–¥–∂—É–≤–∞—á–∞.
* –ú–æ–∂–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, —á–∏ —Ñ—É–Ω–∫—Ü—ñ—è **`sysctl`** –∞–±–æ **`ptrace`** —ñ–º–ø–æ—Ä—Ç—É—î—Ç—å—Å—è (–∞–ª–µ —à–∫—ñ–¥–ª–∏–≤–∞ –ø—Ä–æ–≥—Ä–∞–º–∞ –º–æ–∂–µ —ñ–º–ø–æ—Ä—Ç—É–≤–∞—Ç–∏ —ó—ó –¥–∏–Ω–∞–º—ñ—á–Ω–æ)
* –Ø–∫ –≤–∫–∞–∑–∞–Ω–æ –≤ —Ü—å–æ–º—É –æ–≥–ª—è–¥—ñ, ‚Äú[–ü–µ—Ä–µ–º–æ–≥–∞ –Ω–∞–¥ –∞–Ω—Ç–∏-–≤—ñ–¥–ª–∞–≥–æ–¥–∂—É–≤–∞–ª—å–Ω–∏–º–∏ —Ç–µ—Ö–Ω—ñ–∫–∞–º–∏: –≤–∞—Ä—ñ–∞–Ω—Ç–∏ macOS ptrace](https://alexomara.com/blog/defeating-anti-debug-techniques-macos-ptrace-variants/)‚Äù :\
‚Äú_–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ü—Ä–æ—Ü–µ—Å # –∑–∞–≤–µ—Ä—à–∏–≤—Å—è –∑ **—Å—Ç–∞—Ç—É—Å–æ–º = 45 (0x0000002d)** –∑–∞–∑–≤–∏—á–∞–π —î –≤–∫–∞–∑—ñ–≤–∫–æ—é –Ω–∞ —Ç–µ, —â–æ —Ü—ñ–ª—å –≤—ñ–¥–ª–∞–≥–æ–¥–∂—É–≤–∞–Ω–Ω—è –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î **PT\_DENY\_ATTACH**_‚Äù
## –Ø–¥–µ—Ä–Ω—ñ –¥–∞–º–ø–∏

–Ø–¥–µ—Ä–Ω—ñ –¥–∞–º–ø–∏ —Å—Ç–≤–æ—Ä—é—é—Ç—å—Å—è, —è–∫—â–æ:

- `kern.coredump` sysctl –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –Ω–∞ 1 (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º)
- –Ø–∫—â–æ –ø—Ä–æ—Ü–µ—Å –Ω–µ –±—É–≤ suid/sgid –∞–±–æ `kern.sugid_coredump` –¥–æ—Ä—ñ–≤–Ω—é—î 1 (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º 0)
- –õ—ñ–º—ñ—Ç `AS_CORE` –¥–æ–∑–≤–æ–ª—è—î –æ–ø–µ—Ä–∞—Ü—ñ—é. –ú–æ–∂–ª–∏–≤–æ –ø—Ä–∏–≥–ª—É—à–∏—Ç–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —è–¥–µ—Ä–Ω–∏—Ö –¥–∞–º–ø—ñ–≤, –≤–∏–∫–ª–∏–∫–∞–≤—à–∏ `ulimit -c 0`, —ñ –∑–Ω–æ–≤—É —ó—Ö —É–≤—ñ–º–∫–Ω—É—Ç–∏ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `ulimit -c unlimited`.

–£ —Ü–∏—Ö –≤–∏–ø–∞–¥–∫–∞—Ö —è–¥–µ—Ä–Ω—ñ –¥–∞–º–ø–∏ –≥–µ–Ω–µ—Ä—É—é—Ç—å—Å—è –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ –¥–æ `kern.corefile` sysctl —ñ –∑–∞–∑–≤–∏—á–∞–π –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –≤ `/cores/core/.%P`.

## Fuzzing

### [ReportCrash](https://ss64.com/osx/reportcrash.html)

ReportCrash **–∞–Ω–∞–ª—ñ–∑—É—î –ø—Ä–æ—Ü–µ—Å–∏, —â–æ –ø—Ä–∏–∑–≤–æ–¥—è—Ç—å –¥–æ –∑–±–æ—ó–≤, —ñ –∑–±–µ—Ä—ñ–≥–∞—î –∑–≤—ñ—Ç –ø—Ä–æ –∑–±—ñ–π –Ω–∞ –¥–∏—Å–∫**. –ó–≤—ñ—Ç –ø—Ä–æ –∑–±—ñ–π –º—ñ—Å—Ç–∏—Ç—å —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é, —è–∫–∞ –º–æ–∂–µ **–¥–æ–ø–æ–º–æ–≥—Ç–∏ —Ä–æ–∑—Ä–æ–±–Ω–∏–∫—É –¥—ñ–∞–≥–Ω–æ—Å—Ç—É–≤–∞—Ç–∏** –ø—Ä–∏—á–∏–Ω—É –∑–±–æ—é.\
–î–ª—è –¥–æ–¥–∞—Ç–∫—ñ–≤ —Ç–∞ —ñ–Ω—à–∏—Ö –ø—Ä–æ—Ü–µ—Å—ñ–≤, —â–æ **–ø—Ä–∞—Ü—é—é—Ç—å –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç—ñ –∑–∞–ø—É—Å–∫—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞**, ReportCrash –ø—Ä–∞—Ü—é—î —è–∫ LaunchAgent —ñ –∑–±–µ—Ä—ñ–≥–∞—î –∑–≤—ñ—Ç–∏ –ø—Ä–æ –∑–±–æ—ó –≤ `~/Library/Logs/DiagnosticReports/` –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞\
–î–ª—è –¥–µ–º–æ–Ω—ñ–≤, —ñ–Ω—à–∏—Ö –ø—Ä–æ—Ü–µ—Å—ñ–≤, —â–æ **–ø—Ä–∞—Ü—é—é—Ç—å –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç—ñ –∑–∞–ø—É—Å–∫—É —Å–∏—Å—Ç–µ–º–∏** —Ç–∞ —ñ–Ω—à–∏—Ö –ø—Ä–∏–≤—ñ–ª–µ–π–æ–≤–∞–Ω–∏—Ö –ø—Ä–æ—Ü–µ—Å—ñ–≤, ReportCrash –ø—Ä–∞—Ü—é—î —è–∫ LaunchDaemon —ñ –∑–±–µ—Ä—ñ–≥–∞—î –∑–≤—ñ—Ç–∏ –ø—Ä–æ –∑–±–æ—ó –≤ `/Library/Logs/DiagnosticReports`

–Ø–∫—â–æ –≤–∞—Å —Ç—É—Ä–±—É—é—Ç—å –∑–≤—ñ—Ç–∏ –ø—Ä–æ –∑–±–æ—ó, **—è–∫—ñ –Ω–∞–¥—Å–∏–ª–∞—é—Ç—å—Å—è –≤ Apple**, –≤–∏ –º–æ–∂–µ—Ç–µ —ó—Ö –≤–∏–º–∫–Ω—É—Ç–∏. –Ø–∫—â–æ –Ω—ñ, –∑–≤—ñ—Ç–∏ –ø—Ä–æ –∑–±–æ—ó –º–æ–∂—É—Ç—å –±—É—Ç–∏ –∫–æ—Ä–∏—Å–Ω–∏–º–∏ –¥–ª—è **–≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è –ø—Ä–∏—á–∏–Ω–∏ –∑–±–æ—é —Å–µ—Ä–≤–µ—Ä–∞**.
```bash
#To disable crash reporting:
launchctl unload -w /System/Library/LaunchAgents/com.apple.ReportCrash.plist
sudo launchctl unload -w /System/Library/LaunchDaemons/com.apple.ReportCrash.Root.plist

#To re-enable crash reporting:
launchctl load -w /System/Library/LaunchAgents/com.apple.ReportCrash.plist
sudo launchctl load -w /System/Library/LaunchDaemons/com.apple.ReportCrash.Root.plist
```
### –°–æ–Ω

–ü—ñ–¥ —á–∞—Å —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è –≤ MacOS –≤–∞–∂–ª–∏–≤–æ –Ω–µ –¥–æ–∑–≤–æ–ª—è—Ç–∏ Mac —Å–ø–∞—Ç–∏:

* systemsetup -setsleep Never
* pmset, System Preferences
* [KeepingYouAwake](https://github.com/newmarcel/KeepingYouAwake)

#### –í—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è SSH

–Ø–∫—â–æ –≤–∏ —Ä–æ–∑–≥–æ—Ä—Ç–∞—î—Ç–µ —á–µ—Ä–µ–∑ SSH-–∑'—î–¥–Ω–∞–Ω–Ω—è, –≤–∞–∂–ª–∏–≤–æ –ø–µ—Ä–µ–∫–æ–Ω–∞—Ç–∏—Å—è, —â–æ —Å–µ–∞–Ω—Å –Ω–µ –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è. –¢–æ–º—É –∑–º—ñ–Ω—ñ—Ç—å —Ñ–∞–π–ª sshd\_config –Ω–∞—Å—Ç—É–ø–Ω–∏–º —á–∏–Ω–æ–º:

* TCPKeepAlive Yes
* ClientAliveInterval 0
* ClientAliveCountMax 0
```bash
sudo launchctl unload /System/Library/LaunchDaemons/ssh.plist
sudo launchctl load -w /System/Library/LaunchDaemons/ssh.plist
```
### –í–Ω—É—Ç—Ä—ñ—à–Ω—ñ –æ–±—Ä–æ–±–Ω–∏–∫–∏

**–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –Ω–∞—Å—Ç—É–ø–Ω—É —Å—Ç–æ—Ä—ñ–Ω–∫—É**, —â–æ–± –¥—ñ–∑–Ω–∞—Ç–∏—Å—è, —è–∫–∞ –ø—Ä–æ–≥—Ä–∞–º–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –∑–∞ **–æ–±—Ä–æ–±–∫—É –≤–∫–∞–∑–∞–Ω–æ—ó —Å—Ö–µ–º–∏ –∞–±–æ –ø—Ä–æ—Ç–æ–∫–æ–ª—É:**

{% content-ref url="../macos-file-extension-apps.md" %}
[macos-file-extension-apps.md](../macos-file-extension-apps.md)
{% endcontent-ref %}

### –ü–µ—Ä–µ–ª—ñ–∫ –º–µ—Ä–µ–∂–µ–≤–∏—Ö –ø—Ä–æ—Ü–µ—Å—ñ–≤

–¶–µ —Ü—ñ–∫–∞–≤–æ –≤–∏—è–≤–∏—Ç–∏ –ø—Ä–æ—Ü–µ—Å–∏, —è–∫—ñ –∫–µ—Ä—É—é—Ç—å –º–µ—Ä–µ–∂–µ–≤–∏–º–∏ –¥–∞–Ω–∏–º–∏:
```bash
dtrace -n 'syscall::recv*:entry { printf("-> %s (pid=%d)", execname, pid); }' >> recv.log
#wait some time
sort -u recv.log > procs.txt
cat procs.txt
```
–ê–±–æ —Å–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ—Å—è `netstat` –∞–±–æ `lsof`

### Libgmalloc

<figure><img src="../../../.gitbook/assets/Pasted Graphic 14.png" alt=""><figcaption></figcaption></figure>

{% code overflow="wrap" %}
```bash
lldb -o "target create `which some-binary`" -o "settings set target.env-vars DYLD_INSERT_LIBRARIES=/usr/lib/libgmalloc.dylib" -o "run arg1 arg2" -o "bt" -o "reg read" -o "dis -s \$pc-32 -c 24 -m -F intel" -o "quit"
```
{% endcode %}

### Fuzzers

#### [AFL++](https://github.com/AFLplusplus/AFLplusplus)

–ü—Ä–∞—Ü—é—î –¥–ª—è —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤ –∫–æ–º–∞–Ω–¥–Ω–æ–≥–æ —Ä—è–¥–∫–∞

#### [Litefuzz](https://github.com/sec-tools/litefuzz)

–í—ñ–Ω "**–ø—Ä–æ—Å—Ç–æ –ø—Ä–∞—Ü—é—î"** –∑ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏ GUI macOS. –ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ –¥–µ—è–∫—ñ –¥–æ–¥–∞—Ç–∫–∏ macOS –º–∞—é—Ç—å –ø–µ–≤–Ω—ñ –≤–∏–º–æ–≥–∏, —Ç–∞–∫—ñ —è–∫ —É–Ω—ñ–∫–∞–ª—å–Ω—ñ —ñ–º–µ–Ω–∞ —Ñ–∞–π–ª—ñ–≤, –ø—Ä–∞–≤–∏–ª—å–Ω–µ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è, –ø–æ—Ç—Ä—ñ–±–Ω–æ —á–∏—Ç–∞—Ç–∏ —Ñ–∞–π–ª–∏ –∑ –ø—ñ—Å–æ—á–Ω–∏—Ü—ñ (`~/Library/Containers/com.apple.Safari/Data`)...

–î–µ—è–∫—ñ –ø—Ä–∏–∫–ª–∞–¥–∏:
```bash
# iBooks
litefuzz -l -c "/System/Applications/Books.app/Contents/MacOS/Books FUZZ" -i files/epub -o crashes/ibooks -t /Users/test/Library/Containers/com.apple.iBooksX/Data/tmp -x 10 -n 100000 -ez

# -l : Local
# -c : cmdline with FUZZ word (if not stdin is used)
# -i : input directory or file
# -o : Dir to output crashes
# -t : Dir to output runtime fuzzing artifacts
# -x : Tmeout for the run (default is 1)
# -n : Num of fuzzing iterations (default is 1)
# -e : enable second round fuzzing where any crashes found are reused as inputs
# -z : enable malloc debug helpers

# Font Book
litefuzz -l -c "/System/Applications/Font Book.app/Contents/MacOS/Font Book FUZZ" -i input/fonts -o crashes/font-book -x 2 -n 500000 -ez

# smbutil (using pcap capture)
litefuzz -lk -c "smbutil view smb://localhost:4455" -a tcp://localhost:4455 -i input/mac-smb-resp -p -n 100000 -z

# screensharingd (using pcap capture)
litefuzz -s -a tcp://localhost:5900 -i input/screenshared-session --reportcrash screensharingd -p -n 100000
```
{% endcode %}

### –î–æ–¥–∞—Ç–∫–æ–≤–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ Fuzzing MacOS

* [https://www.youtube.com/watch?v=T5xfL9tEg44](https://www.youtube.com/watch?v=T5xfL9tEg44)
* [https://github.com/bnagy/slides/blob/master/OSXScale.pdf](https://github.com/bnagy/slides/blob/master/OSXScale.pdf)
* [https://github.com/bnagy/francis/tree/master/exploitaben](https://github.com/bnagy/francis/tree/master/exploitaben)
* [https://github.com/ant4g0nist/crashwrangler](https://github.com/ant4g0nist/crashwrangler)

## –ü–æ—Å–∏–ª–∞–Ω–Ω—è

* [**OS X Incident Response: Scripting and Analysis**](https://www.amazon.com/OS-Incident-Response-Scripting-Analysis-ebook/dp/B01FHOHHVS)
* [**https://www.youtube.com/watch?v=T5xfL9tEg44**](https://www.youtube.com/watch?v=T5xfL9tEg44)
* [**https://taomm.org/vol1/analysis.html**](https://taomm.org/vol1/analysis.html)
* [**The Art of Mac Malware: The Guide to Analyzing Malicious Software**](https://taomm.org/)

### [WhiteIntel](https://whiteintel.io)

<figure><img src="../../../.gitbook/assets/image (1227).png" alt=""><figcaption></figcaption></figure>

[**WhiteIntel**](https://whiteintel.io) - —Ü–µ –ø–æ—à—É–∫–æ–≤–∏–π –¥–≤–∏–≥—É–Ω, —è–∫–∏–π –ø—Ä–∞—Ü—é—î –Ω–∞ **—Ç–µ–º–Ω–æ–º—É –≤–µ–±-—Å–∞–π—Ç—ñ** —ñ –Ω–∞–¥–∞—î **–±–µ–∑–∫–æ—à—Ç–æ–≤–Ω—ñ** —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏, —á–∏ –±—É–ª–∏ **–∫–æ–º–ø–∞–Ω—ñ—è –∞–±–æ —ó—ó –∫–ª—ñ—î–Ω—Ç–∏** **–ø–æ—à–∫–æ–¥–∂–µ–Ω—ñ** **—à–∫—ñ–¥–ª–∏–≤–∏–º–∏ –ø—Ä–æ–≥—Ä–∞–º–∞–º–∏ –¥–ª—è –∫—Ä–∞–¥—ñ–∂–∫–∏ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó**.

–û—Å–Ω–æ–≤–Ω–æ—é –º–µ—Ç–æ—é WhiteIntel —î –±–æ—Ä–æ—Ç—å–±–∞ –∑ –∑–∞—Ö–æ–ø–ª–µ–Ω–Ω—è–º –æ–±–ª—ñ–∫–æ–≤–∏—Ö –∑–∞–ø–∏—Å—ñ–≤ —Ç–∞ –∞—Ç–∞–∫–∞–º–∏ –≤–∏–º–∞–≥–∞–Ω–Ω—è –≤–∏–∫—É–ø—É, —â–æ –≤–∏–Ω–∏–∫–∞—é—Ç—å –≤–Ω–∞—Å–ª—ñ–¥–æ–∫ —à–∫—ñ–¥–ª–∏–≤–∏—Ö –ø—Ä–æ–≥—Ä–∞–º –¥–ª—è –∫—Ä–∞–¥—ñ–∂–∫–∏ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó.

–í–∏ –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —ó—Ö –≤–µ–±-—Å–∞–π—Ç —Ç–∞ —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ —ó—Ö –¥–≤–∏–≥—É–Ω **–±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–æ** –∑–∞ –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º:

{% embed url="https://whiteintel.io" %}

{% hint style="success" %}
–í–∏–≤—á–∞–π—Ç–µ —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ –≤–∑–ª–æ–º AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**–ù–∞–≤—á–∞–Ω–Ω—è HackTricks AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
–í–∏–≤—á–∞–π—Ç–µ —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ –≤–∑–ª–æ–º GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**–ù–∞–≤—á–∞–Ω–Ω—è HackTricks GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>–ü—ñ–¥—Ç—Ä–∏–º–∞–π—Ç–µ HackTricks</summary>

* –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ø–ª–∞–Ω–∏ –ø—ñ–¥–ø–∏—Å–∫–∏**](https://github.com/sponsors/carlospolop)!
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ Telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –Ω–∞–º–∏ –≤ **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **–ü–æ—à–∏—Ä—é–π—Ç–µ —Ö–∞–∫–µ—Ä—Å—å–∫—ñ —Ç—Ä—é–∫–∏, –Ω–∞–¥—Å–∏–ª–∞—é—á–∏ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) —Ç–∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤ –Ω–∞ GitHub.

</details>
{% endhint %}
