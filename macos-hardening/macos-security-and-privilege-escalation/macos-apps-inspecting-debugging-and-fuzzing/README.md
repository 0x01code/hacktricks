# –î–æ–¥–∞—Ç–∫–∏ macOS - –Ü–Ω—Å–ø–µ–∫—Ç—É–≤–∞–Ω–Ω—è, –Ω–∞–ª–∞–≥–æ–¥–∂–µ–Ω–Ω—è —Ç–∞ Fuzzing

<details>

<summary><strong>–í–∏–≤—á–∞–π—Ç–µ —Ö–∞–∫—ñ–Ω–≥ AWS –≤—ñ–¥ –Ω—É–ª—è –¥–æ –≥–µ—Ä–æ—è –∑</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

–Ü–Ω—à—ñ —Å–ø–æ—Å–æ–±–∏ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ HackTricks:

* –Ø–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ –≤–∞—à—É **–∫–æ–º–ø–∞–Ω—ñ—é —Ä–µ–∫–ª–∞–º–æ–≤–∞–Ω—É –Ω–∞ HackTricks** –∞–±–æ **–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ HackTricks —É —Ñ–æ—Ä–º–∞—Ç—ñ PDF**, –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ü–õ–ê–ù–ò –ü–Ü–î–ü–ò–°–ö–ò**](https://github.com/sponsors/carlospolop)!
* –û—Ç—Ä–∏–º–∞–π—Ç–µ [**–æ—Ñ—ñ—Ü—ñ–π–Ω–∏–π PEASS & HackTricks –º–µ—Ä—á**](https://peass.creator-spring.com)
* –í—ñ–¥–∫—Ä–∏–π—Ç–µ –¥–ª—è —Å–µ–±–µ [**–°—ñ–º'—é PEASS**](https://opensea.io/collection/the-peass-family), –Ω–∞—à—É –∫–æ–ª–µ–∫—Ü—ñ—é –µ–∫—Å–∫–ª—é–∑–∏–≤–Ω–∏—Ö [**NFT**](https://opensea.io/collection/the-peass-family)
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –Ω–∞–º–∏ –Ω–∞ **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **–ü–æ–¥—ñ–ª—ñ—Ç—å—Å—è —Å–≤–æ—ó–º–∏ —Ö–∞–∫–µ—Ä—Å—å–∫–∏–º–∏ —Ç—Ä—é–∫–∞–º–∏, –Ω–∞–¥—Å–∏–ª–∞–π—Ç–µ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) **—Ç–∞** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤ GitHub**.

</details>

## –°—Ç–∞—Ç–∏—á–Ω–∏–π –∞–Ω–∞–ª—ñ–∑

### otool
```bash
otool -L /bin/ls #List dynamically linked libraries
otool -tv /bin/ps #Decompile application
```
### objdump

{% code overflow="wrap" %}
```bash
objdump -m --dylibs-used /bin/ls #List dynamically linked libraries
objdump -m -h /bin/ls # Get headers information
objdump -m --syms /bin/ls # Check if the symbol table exists to get function names
objdump -m --full-contents /bin/ls # Dump every section
objdump -d /bin/ls # Dissasemble the binary
objdump --disassemble-symbols=_hello --x86-asm-syntax=intel toolsdemo #Disassemble a function using intel flavour
```
{% endcode %}

### jtool2

–¶–µ–π —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –º–æ–∂–µ –±—É—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–∏–π —è–∫ **–∑–∞–º—ñ–Ω–∞** –¥–ª—è **codesign**, **otool** —Ç–∞ **objdump**, —ñ –Ω–∞–¥–∞—î –∫—ñ–ª—å–∫–∞ –¥–æ–¥–∞—Ç–∫–æ–≤–∏—Ö —Ñ—É–Ω–∫—Ü—ñ–π. [**–ó–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ –π–æ–≥–æ —Ç—É—Ç**](http://www.newosxbook.com/tools/jtool.html) –∞–±–æ –≤—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `brew`.
```bash
# Install
brew install --cask jtool2

jtool2 -l /bin/ls # Get commands (headers)
jtool2 -L /bin/ls # Get libraries
jtool2 -S /bin/ls # Get symbol info
jtool2 -d /bin/ls # Dump binary
jtool2 -D /bin/ls # Decompile binary

# Get signature information
ARCH=x86_64 jtool2 --sig /System/Applications/Automator.app/Contents/MacOS/Automator

# Get MIG information
jtool2 -d __DATA.__const myipc_server | grep MIG
```
### Codesign / ldid

{% hint style="danger" %}
**`Codesign`** –º–æ–∂–Ω–∞ –∑–Ω–∞–π—Ç–∏ –≤ **macOS**, —Ç–æ–¥—ñ —è–∫ **`ldid`** –º–æ–∂–Ω–∞ –∑–Ω–∞–π—Ç–∏ –≤ **iOS**
{% endhint %}
```bash
# Get signer
codesign -vv -d /bin/ls 2>&1 | grep -E "Authority|TeamIdentifier"

# Check if the app‚Äôs contents have been modified
codesign --verify --verbose /Applications/Safari.app

# Get entitlements from the binary
codesign -d --entitlements :- /System/Applications/Automator.app # Check the TCC perms

# Check if the signature is valid
spctl --assess --verbose /Applications/Safari.app

# Sign a binary
codesign -s <cert-name-keychain> toolsdemo

# Get signature info
ldid -h <binary>

# Get entitlements
ldid -e <binary>

# Change entilements
## /tmp/entl.xml is a XML file with the new entitlements to add
ldid -S/tmp/entl.xml <binary>
```
### SuspiciousPackage

[**SuspiciousPackage**](https://mothersruin.com/software/SuspiciousPackage/get.html) - —Ü–µ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, –∫–æ—Ä–∏—Å–Ω–∏–π –¥–ª—è —ñ–Ω—Å–ø–µ–∫—Ç—É–≤–∞–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤ **.pkg** (—ñ–Ω—Å—Ç–∞–ª—è—Ç–æ—Ä—ñ–≤) —Ç–∞ –ø–µ—Ä–µ–≥–ª—è–¥—É —ó—Ö –≤–º—ñ—Å—Ç—É –ø–µ—Ä–µ–¥ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è–º.\
–¶—ñ —ñ–Ω—Å—Ç–∞–ª—è—Ç–æ—Ä–∏ –º–∞—é—Ç—å —Å—Ü–µ–Ω–∞—Ä—ñ—ó bash `preinstall` —Ç–∞ `postinstall`, —è–∫—ñ –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫–∏ –∑–∞–∑–≤–∏—á–∞–π –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å –¥–ª—è **–ø–æ—Å—Ç—ñ–π–Ω–æ–≥–æ** **—Ä–æ–∑–ø–æ–≤—Å—é–¥–∂–µ–Ω–Ω—è** **—à–∫—ñ–¥–ª–∏–≤–æ–≥–æ** **–ø—Ä–æ–≥—Ä–∞–º–Ω–æ–≥–æ** **–∑–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è**.

### hdiutil

–¶–µ–π —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–æ–∑–≤–æ–ª—è—î **–º–æ–Ω—Ç—É–≤–∞—Ç–∏** –æ–±—Ä–∞–∑–∏ –¥–∏—Å–∫—ñ–≤ Apple (**.dmg**) –¥–ª—è —ó—Ö —ñ–Ω—Å–ø–µ–∫—Ç—É–≤–∞–Ω–Ω—è –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º —á–æ–≥–æ-–Ω–µ–±—É–¥—å:
```bash
hdiutil attach ~/Downloads/Firefox\ 58.0.2.dmg
```
–¶–µ –±—É–¥–µ –∑–º–æ–Ω—Ç–æ–≤–∞–Ω–æ –≤ `/Volumes`

### Objective-C

#### –ú–µ—Ç–∞–¥–∞–Ω—ñ

{% hint style="danger" %}
–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ –ø—Ä–æ–≥—Ä–∞–º–∏, –Ω–∞–ø–∏—Å–∞–Ω—ñ –Ω–∞ Objective-C, **–∑–±–µ—Ä—ñ–≥–∞—é—Ç—å** —Å–≤–æ—ó –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è –∫–ª–∞—Å—ñ–≤ **–ø—ñ–¥ —á–∞—Å** **–∫–æ–º–ø—ñ–ª—è—Ü—ñ—ó** —É [–±—ñ–Ω–∞—Ä–Ω—ñ —Ñ–∞–π–ª–∏ Mach-O](../macos-files-folders-and-binaries/universal-binaries-and-mach-o-format.md). –¢–∞–∫—ñ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è –∫–ª–∞—Å—ñ–≤ **–≤–∫–ª—é—á–∞—é—Ç—å** —ñ–º'—è —Ç–∞ —Ç–∏–ø:
{% endhint %}

* –ö–ª–∞—Å
* –ú–µ—Ç–æ–¥–∏ –∫–ª–∞—Å—É
* –ó–º—ñ–Ω–Ω—ñ –µ–∫–∑–µ–º–ø–ª—è—Ä–∞ –∫–ª–∞—Å—É

–í–∏ –º–æ–∂–µ—Ç–µ –æ—Ç—Ä–∏–º–∞—Ç–∏ —Ü—é —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ [**class-dump**](https://github.com/nygard/class-dump):
```bash
class-dump Kindle.app
```
#### –í–∏–∫–ª–∏–∫ —Ñ—É–Ω–∫—Ü—ñ—ó

–ö–æ–ª–∏ —Ñ—É–Ω–∫—Ü—ñ—è –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è –≤ –±—ñ–Ω–∞—Ä–Ω–æ–º—É —Ñ–∞–π–ª—ñ, —è–∫–∏–π –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î Objective-C, —Å–∫–æ–º–ø—ñ–ª—å–æ–≤–∞–Ω–∏–π –∫–æ–¥ –∑–∞–º—ñ—Å—Ç—å –≤–∏–∫–ª–∏–∫—É —Ü—ñ—î—ó —Ñ—É–Ω–∫—Ü—ñ—ó –±—É–¥–µ –≤–∏–∫–ª–∏–∫–∞—Ç–∏ **`objc_msgSend`**. –¶–µ –≤–∏–∫–ª–∏—á–µ –æ—Å—Ç–∞–Ω–Ω—é —Ñ—É–Ω–∫—Ü—ñ—é:

![](<../../../.gitbook/assets/image (560).png>)

–ü–∞—Ä–∞–º–µ—Ç—Ä–∏, —è–∫—ñ –æ—á—ñ–∫—É—î —Ü—è —Ñ—É–Ω–∫—Ü—ñ—è, —Ç–∞–∫—ñ:

* –ü–µ—Ä—à–∏–π –ø–∞—Ä–∞–º–µ—Ç—Ä (**self**) - "–≤–∫–∞–∑—ñ–≤–Ω–∏–∫, —è–∫–∏–π –≤–∫–∞–∑—É—î –Ω–∞ **–µ–∫–∑–µ–º–ø–ª—è—Ä –∫–ª–∞—Å—É, —è–∫–∏–π –º–∞—î –æ—Ç—Ä–∏–º–∞—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è**". –Ü–Ω—à–∏–º–∏ —Å–ª–æ–≤–∞–º–∏, —Ü–µ –æ–±'—î–∫—Ç, –Ω–∞ —è–∫–æ–º—É –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è –º–µ—Ç–æ–¥. –Ø–∫—â–æ –º–µ—Ç–æ–¥ —î –º–µ—Ç–æ–¥–æ–º –∫–ª–∞—Å—É, —Ü–µ –±—É–¥–µ –µ–∫–∑–µ–º–ø–ª—è—Ä –æ–±'—î–∫—Ç–∞ –∫–ª–∞—Å—É (–≤ —Ü—ñ–ª–æ–º—É), —Ç–æ–¥—ñ —è–∫ –¥–ª—è –º–µ—Ç–æ–¥—É –µ–∫–∑–µ–º–ø–ª—è—Ä—É self –±—É–¥–µ –≤–∫–∞–∑—É–≤–∞—Ç–∏ –Ω–∞ —Å—Ç–≤–æ—Ä–µ–Ω–∏–π –µ–∫–∑–µ–º–ø–ª—è—Ä –∫–ª–∞—Å—É —è–∫ –Ω–∞ –æ–±'—î–∫—Ç.
* –î—Ä—É–≥–∏–π –ø–∞—Ä–∞–º–µ—Ç—Ä (**op**) - "—Å–µ–ª–µ–∫—Ç–æ—Ä –º–µ—Ç–æ–¥—É, —è–∫–∏–π –æ–±—Ä–æ–±–ª—è—î –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è". –¶–µ –ø—Ä–æ—Å—Ç–æ **—ñ–º'—è –º–µ—Ç–æ–¥—É**.
* –†–µ—à—Ç–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤ - –±—É–¥—å-—è–∫—ñ **–∑–Ω–∞—á–µ–Ω–Ω—è, —è–∫—ñ –ø–æ—Ç—Ä—ñ–±–Ω—ñ –º–µ—Ç–æ–¥—É** (op).

–î–∏–≤—ñ—Ç—å—Å—è, —è–∫ **–ª–µ–≥–∫–æ –æ—Ç—Ä–∏–º–∞—Ç–∏ —Ü—é —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `lldb` –≤ ARM64** –Ω–∞ —Ü—ñ–π —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ:

{% content-ref url="arm64-basic-assembly.md" %}
[arm64-basic-assembly.md](arm64-basic-assembly.md)
{% endcontent-ref %}

x64:

| **–ê—Ä–≥—É–º–µ–Ω—Ç**      | **–†–µ–≥—ñ—Å—Ç—Ä**                                                    | **(–¥–ª—è) objc\_msgSend**                                |
| ----------------- | --------------------------------------------------------------- | ------------------------------------------------------ |
| **1-–π –∞—Ä–≥—É–º–µ–Ω—Ç**  | **rdi**                                                         | **self: –æ–±'—î–∫—Ç, –Ω–∞ —è–∫–æ–º—É –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è –º–µ—Ç–æ–¥**        |
| **2-–π –∞—Ä–≥—É–º–µ–Ω—Ç**  | **rsi**                                                         | **op: —ñ–º'—è –º–µ—Ç–æ–¥—É**                                   |
| **3-–π –∞—Ä–≥—É–º–µ–Ω—Ç**  | **rdx**                                                         | **1-–π –∞—Ä–≥—É–º–µ–Ω—Ç –º–µ—Ç–æ–¥—É**                               |
| **4-–π –∞—Ä–≥—É–º–µ–Ω—Ç**  | **rcx**                                                         | **2-–π –∞—Ä–≥—É–º–µ–Ω—Ç –º–µ—Ç–æ–¥—É**                               |
| **5-–π –∞—Ä–≥—É–º–µ–Ω—Ç**  | **r8**                                                          | **3-–π –∞—Ä–≥—É–º–µ–Ω—Ç –º–µ—Ç–æ–¥—É**                               |
| **6-–π –∞—Ä–≥—É–º–µ–Ω—Ç**  | **r9**                                                          | **4-–π –∞—Ä–≥—É–º–µ–Ω—Ç –º–µ—Ç–æ–¥—É**                               |
| **7-–π+ –∞—Ä–≥—É–º–µ–Ω—Ç** | <p><strong>rsp+</strong><br><strong>(–Ω–∞ —Å—Ç–µ–∫—É)</strong></p>   | **5-–π+ –∞—Ä–≥—É–º–µ–Ω—Ç –º–µ—Ç–æ–¥—É**                              |

### Swift

–£ –±—ñ–Ω–∞—Ä–Ω–∏—Ö —Ñ–∞–π–ª–∞—Ö Swift, –æ—Å–∫—ñ–ª—å–∫–∏ —î —Å—É–º—ñ—Å–Ω—ñ—Å—Ç—å –∑ Objective-C, —ñ–Ω–æ–¥—ñ –º–æ–∂–Ω–∞ –≤–∏–¥–æ–±—É—Ç–∏ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é [class-dump](https://github.com/nygard/class-dump/), –∞–ª–µ –Ω–µ –∑–∞–≤–∂–¥–∏.

–ó–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –∫–æ–º–∞–Ω–¥–Ω–∏—Ö —Ä—è–¥–∫—ñ–≤ **`jtool -l`** –∞–±–æ **`otool -l`** –º–æ–∂–Ω–∞ –∑–Ω–∞–π—Ç–∏ –∫—ñ–ª—å–∫–∞ —Ä–æ–∑–¥—ñ–ª—ñ–≤, —è–∫—ñ –ø–æ—á–∏–Ω–∞—é—Ç—å—Å—è –∑ –ø—Ä–µ—Ñ—ñ–∫—Å–∞ **`__swift5`**:
```bash
jtool2 -l /Applications/Stocks.app/Contents/MacOS/Stocks
LC 00: LC_SEGMENT_64              Mem: 0x000000000-0x100000000    __PAGEZERO
LC 01: LC_SEGMENT_64              Mem: 0x100000000-0x100028000    __TEXT
[...]
Mem: 0x100026630-0x100026d54        __TEXT.__swift5_typeref
Mem: 0x100026d60-0x100027061        __TEXT.__swift5_reflstr
Mem: 0x100027064-0x1000274cc        __TEXT.__swift5_fieldmd
Mem: 0x1000274cc-0x100027608        __TEXT.__swift5_capture
[...]
```
–í–∏ –º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ –¥–æ–¥–∞—Ç–∫–æ–≤—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ **—ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é, –∑–±–µ—Ä–µ–∂–µ–Ω—É –≤ —Ü–∏—Ö —Ä–æ–∑–¥—ñ–ª–∞—Ö, —É —Ü—å–æ–º—É –¥–æ–ø–∏—Å—ñ –≤ –±–ª–æ–∑—ñ**.

–ë—ñ–ª—å—à–µ —Ç–æ–≥–æ, **–±—ñ–Ω–∞—Ä–Ω—ñ —Ñ–∞–π–ª–∏ Swift –º–æ–∂—É—Ç—å –º—ñ—Å—Ç–∏—Ç–∏ —Å–∏–º–≤–æ–ª–∏** (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏ –ø–æ–≤–∏–Ω–Ω—ñ –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ —Å–∏–º–≤–æ–ª–∏, —â–æ–± —ó—Ö —Ñ—É–Ω–∫—Ü—ñ—ó –º–æ–∂–Ω–∞ –±—É–ª–æ –≤–∏–∫–ª–∏–∫–∞—Ç–∏). **–°–∏–º–≤–æ–ª–∏ –∑–∞–∑–≤–∏—á–∞–π –º—ñ—Å—Ç—è—Ç—å —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –Ω–∞–∑–≤—É —Ñ—É–Ω–∫—Ü—ñ—ó** —Ç–∞ –∞—Ç—Ä–∏–±—É—Ç–∏ —É –≤–∏–≥–ª—è–¥—ñ –Ω–µ–∫—Ä–∞—Å–∏–≤–æ–≥–æ —Ç–µ–∫—Å—Ç—É, —Ç–æ–º—É –≤–æ–Ω–∏ —î –¥—É–∂–µ –∫–æ—Ä–∏—Å–Ω–∏–º–∏, —ñ —î "**–¥–µ–º–∞–Ω–≥–ª–µ—Ä–∏"**, —è–∫—ñ –º–æ–∂—É—Ç—å –æ—Ç—Ä–∏–º–∞—Ç–∏ –ø–æ—á–∞—Ç–∫–æ–≤—É –Ω–∞–∑–≤—É:
```bash
# Ghidra plugin
https://github.com/ghidraninja/ghidra_scripts/blob/master/swift_demangler.py

# Swift cli
swift demangle
```
### –£–ø–∞–∫–æ–≤–∞–Ω—ñ –±—ñ–Ω–∞—Ä–Ω—ñ —Ñ–∞–π–ª–∏

* –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –≤–∏—Å–æ–∫—É –µ–Ω—Ç—Ä–æ–ø—ñ—é
* –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Ä—è–¥–∫–∏ (—è–∫—â–æ —Ç–∞–º –º–∞–π–∂–µ –Ω–µ–º–∞—î –∑—Ä–æ–∑—É–º—ñ–ª–∏—Ö —Ä—è–¥–∫—ñ–≤, —Ç–æ —Ñ–∞–π–ª —É–ø–∞–∫–æ–≤–∞–Ω–∏–π)
* –£–ø–∞–∫–æ–≤—É–≤–∞—á UPX –¥–ª—è MacOS –≥–µ–Ω–µ—Ä—É—î —Ä–æ–∑–¥—ñ–ª –ø—ñ–¥ –Ω–∞–∑–≤–æ—é "\_\_XHDR"

## –î–∏–Ω–∞–º—ñ—á–Ω–∏–π –∞–Ω–∞–ª—ñ–∑

{% hint style="warning" %}
–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ –¥–ª—è –Ω–∞–ª–∞–≥–æ–¥–∂–µ–Ω–Ω—è –±—ñ–Ω–∞—Ä–Ω–∏—Ö —Ñ–∞–π–ª—ñ–≤ **SIP –ø–æ–≤–∏–Ω–µ–Ω –±—É—Ç–∏ –≤–∏–º–∫–Ω–µ–Ω–∏–π** (`csrutil disable` –∞–±–æ `csrutil enable --without debug`) –∞–±–æ —Å–∫–æ–ø—ñ—é–≤–∞—Ç–∏ —Ñ–∞–π–ª–∏ –≤ —Ç–∏–º—á–∞—Å–æ–≤—É –ø–∞–ø–∫—É —Ç–∞ **–≤–∏–¥–∞–ª–∏—Ç–∏ –ø—ñ–¥–ø–∏—Å** –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `codesign --remove-signature <—à–ª—è—Ö-–¥–æ-–±—ñ–Ω–∞—Ä–Ω–æ–≥–æ-—Ñ–∞–π–ª—É>` –∞–±–æ –¥–æ–∑–≤–æ–ª–∏—Ç–∏ –Ω–∞–ª–∞–≥–æ–¥–∂–µ–Ω–Ω—è –±—ñ–Ω–∞—Ä–Ω–æ–≥–æ —Ñ–∞–π–ª—É (–º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ [—Ü–µ–π —Å–∫—Ä–∏–ø—Ç](https://gist.github.com/carlospolop/a66b8d72bb8f43913c4b5ae45672578b))
{% endhint %}

{% hint style="warning" %}
–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ –¥–ª—è **—ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—É–≤–∞–Ω–Ω—è —Å–∏—Å—Ç–µ–º–Ω–∏—Ö –±—ñ–Ω–∞—Ä–Ω–∏—Ö —Ñ–∞–π–ª—ñ–≤** (—Ç–∞–∫–∏—Ö —è–∫ `cloudconfigurationd`) –Ω–∞ macOS, **SIP –ø–æ–≤–∏–Ω–µ–Ω –±—É—Ç–∏ –≤–∏–º–∫–Ω–µ–Ω–∏–π** (–ø—Ä–æ—Å—Ç–æ –≤–∏–¥–∞–ª–µ–Ω–Ω—è –ø—ñ–¥–ø–∏—Å—É –Ω–µ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏–º–µ).
{% endhint %}

### –û–±'—î–¥–Ω–∞–Ω—ñ –∂—É—Ä–Ω–∞–ª–∏

MacOS –≥–µ–Ω–µ—Ä—É—î –±–∞–≥–∞—Ç–æ –∂—É—Ä–Ω–∞–ª—ñ–≤, —è–∫—ñ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –¥—É–∂–µ –∫–æ—Ä–∏—Å–Ω–∏–º–∏ –ø—Ä–∏ –∑–∞–ø—É—Å–∫—É –¥–æ–¥–∞—Ç–∫–∞ –¥–ª—è —Ä–æ–∑—É–º—ñ–Ω–Ω—è **—â–æ –≤—ñ–Ω —Ä–æ–±–∏—Ç—å**.

–ë—ñ–ª—å—à–µ —Ç–æ–≥–æ, —î –¥–µ—è–∫—ñ –∂—É—Ä–Ω–∞–ª–∏, —è–∫—ñ –º—ñ—Å—Ç–∏—Ç–∏–º—É—Ç—å —Ç–µ–≥ `<private>`, —â–æ–± **–ø—Ä–∏—Ö–æ–≤–∞—Ç–∏** –¥–µ—è–∫—É **—ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞** –∞–±–æ **–∫–æ–º–ø'—é—Ç–µ—Ä**. –û–¥–Ω–∞–∫ –º–æ–∂–Ω–∞ **–≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç –¥–ª—è —Ä–æ–∑–∫—Ä–∏—Ç—Ç—è —Ü—ñ—î—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó**. –î–æ—Ç—Ä–∏–º—É–π—Ç–µ—Å—å –ø–æ—è—Å–Ω–µ–Ω—å [**—Ç—É—Ç**](https://superuser.com/questions/1532031/how-to-show-private-data-in-macos-unified-log).

### Hopper

#### –õ—ñ–≤–∞ –ø–∞–Ω–µ–ª—å

–£ –ª—ñ–≤—ñ–π –ø–∞–Ω–µ–ª—ñ hopper –º–æ–∂–Ω–∞ –ø–æ–±–∞—á–∏—Ç–∏ —Å–∏–º–≤–æ–ª–∏ (**–ú—ñ—Ç–∫–∏**) –±—ñ–Ω–∞—Ä–Ω–æ–≥–æ —Ñ–∞–π–ª—É, —Å–ø–∏—Å–æ–∫ –ø—Ä–æ—Ü–µ–¥—É—Ä —Ç–∞ —Ñ—É–Ω–∫—Ü—ñ–π (**Proc**) —Ç–∞ —Ä—è–¥–∫–∏ (**Str**). –¶–µ –Ω–µ –≤—Å—ñ —Ä—è–¥–∫–∏, –∞–ª–µ —Ç—ñ, —â–æ –≤–∏–∑–Ω–∞—á–µ–Ω—ñ –≤ –∫—ñ–ª—å–∫–æ—Ö —á–∞—Å—Ç–∏–Ω–∞—Ö —Ñ–∞–π–ª—É Mac-O (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, _cstring –∞–±–æ `objc_methname`).

#### –°–µ—Ä–µ–¥–Ω—è –ø–∞–Ω–µ–ª—å

–£ —Å–µ—Ä–µ–¥–Ω—ñ–π –ø–∞–Ω–µ–ª—ñ –≤–∏ –º–æ–∂–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ **—Ä–æ–∑—ñ–±—Ä–∞–Ω–∏–π –∫–æ–¥**. –Ü –≤–∏ –º–æ–∂–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ –π–æ–≥–æ —É –≤–∏–≥–ª—è–¥—ñ **—Å–∏—Ä–æ–≥–æ** —Ä–æ–∑—ñ–±—Ä–∞–Ω–Ω—è, —É –≤–∏–≥–ª—è–¥—ñ **–≥—Ä–∞—Ñ–∞**, —É –≤–∏–≥–ª—è–¥—ñ **–¥–µ–∫–æ–º–ø—ñ–ª—å–æ–≤–∞–Ω–æ–≥–æ** —Ç–∞ —É –≤–∏–≥–ª—è–¥—ñ **–±—ñ–Ω–∞—Ä–Ω–æ–≥–æ** —Ñ–∞–π–ª—É, –Ω–∞—Ç–∏—Å–Ω—É–≤—à–∏ –Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–∏–π –∑–Ω–∞—á–æ–∫:

<figure><img src="../../../.gitbook/assets/image (2) (6).png" alt=""><figcaption></figcaption></figure>

–ö–ª–∞—Ü–Ω—É–≤—à–∏ –ø—Ä–∞–≤–æ—é –∫–Ω–æ–ø–∫–æ—é –º–∏—à—ñ –Ω–∞ –æ–±'—î–∫—Ç—ñ –∫–æ–¥—É, –≤–∏ –º–æ–∂–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ **–ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞/–∑ —Ü—å–æ–≥–æ –æ–±'—î–∫—Ç—É** –∞–±–æ –Ω–∞–≤—ñ—Ç—å –∑–º—ñ–Ω–∏—Ç–∏ –π–æ–≥–æ –Ω–∞–∑–≤—É (—Ü–µ –Ω–µ –ø—Ä–∞—Ü—é—î –≤ –¥–µ–∫–æ–º–ø—ñ–ª—å–æ–≤–∞–Ω–æ–º—É –ø—Å–µ–≤–¥–æ–∫–æ–¥—ñ):

<figure><img src="../../../.gitbook/assets/image (1) (1) (2).png" alt=""><figcaption></figcaption></figure>

–ë—ñ–ª—å—à–µ —Ç–æ–≥–æ, —É **—Å–µ—Ä–µ–¥–Ω—ñ–π —á–∞—Å—Ç–∏–Ω—ñ –≤–∏ –º–æ–∂–µ—Ç–µ –≤–≤–æ–¥–∏—Ç–∏ –∫–æ–º–∞–Ω–¥–∏ Python**.

#### –ü—Ä–∞–≤–∞ –ø–∞–Ω–µ–ª—å

–£ –ø—Ä–∞–≤—ñ–π –ø–∞–Ω–µ–ª—ñ –≤–∏ –º–æ–∂–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ —Ü—ñ–∫–∞–≤—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é, —Ç–∞–∫—É —è–∫ **—ñ—Å—Ç–æ—Ä—ñ—é –Ω–∞–≤—ñ–≥–∞—Ü—ñ—ó** (—â–æ–± –∑–Ω–∞—Ç–∏, —è–∫ –≤–∏ –ø–æ—Ç—Ä–∞–ø–∏–ª–∏ –≤ –ø–æ—Ç–æ—á–Ω—É —Å–∏—Ç—É–∞—Ü—ñ—é), **–≥—Ä–∞—Ñ –≤–∏–∫–ª–∏–∫—ñ–≤**, –¥–µ –≤–∏ –º–æ–∂–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ –≤—Å—ñ **—Ñ—É–Ω–∫—Ü—ñ—ó, —è–∫—ñ –≤–∏–∫–ª–∏–∫–∞—é—Ç—å —Ü—é —Ñ—É–Ω–∫—Ü—ñ—é**, —ñ –≤—Å—ñ —Ñ—É–Ω–∫—Ü—ñ—ó, —è–∫—ñ **—Ü—è —Ñ—É–Ω–∫—Ü—ñ—è –≤–∏–∫–ª–∏–∫–∞—î**, —Ç–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ **–ª–æ–∫–∞–ª—å–Ω—ñ –∑–º—ñ–Ω–Ω—ñ**.

### dtrace

–¶–µ –¥–æ–∑–≤–æ–ª—è—î –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ –¥–æ–¥–∞—Ç–∫—ñ–≤ –Ω–∞ –¥—É–∂–µ **–Ω–∏–∑—å–∫–æ–º—É —Ä—ñ–≤–Ω—ñ** —ñ –Ω–∞–¥–∞—î –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º **–≤—ñ–¥—Å—Ç–µ–∂—É–≤–∞—Ç–∏ –ø—Ä–æ–≥—Ä–∞–º–∏** —Ç–∞ –Ω–∞–≤—ñ—Ç—å –∑–º—ñ–Ω—é–≤–∞—Ç–∏ —ó—Ö–Ω—ñ–π —Ö—ñ–¥ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è. Dtrace –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î **–ø—Ä–æ–±–∏**, —è–∫—ñ —Ä–æ–∑–º—ñ—â–µ–Ω—ñ –ø–æ –≤—Å—å–æ–º—É —è–¥—Ä—É —ñ –∑–Ω–∞—Ö–æ–¥—è—Ç—å—Å—è –≤ —Ç–∞–∫–∏—Ö –º—ñ—Å—Ü—è—Ö, —è–∫ –ø–æ—á–∞—Ç–æ–∫ —Ç–∞ –∫—ñ–Ω–µ—Ü—å —Å–∏—Å—Ç–µ–º–Ω–∏—Ö –≤–∏–∫–ª–∏–∫—ñ–≤.

DTrace –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î —Ñ—É–Ω–∫—Ü—ñ—é **`dtrace_probe_create`** –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø—Ä–æ–±–∏ –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –≤–∏–∫–ª–∏–∫—É. –¶—ñ –ø—Ä–æ–±–∏ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –≤–∏–∫–ª–∏–∫–∞–Ω—ñ –≤ **—Ç–æ—á—Ü—ñ –≤—Ö–æ–¥—É —Ç–∞ –≤–∏—Ö–æ–¥—É –∫–æ–∂–Ω–æ–≥–æ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –≤–∏–∫–ª–∏–∫—É**. –í–∑–∞—î–º–æ–¥—ñ—è –∑ DTrace –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è —á–µ—Ä–µ–∑ /dev/dtrace, —è–∫–∏–π –¥–æ—Å—Ç—É–ø–Ω–∏–π –ª–∏—à–µ –¥–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ root.

{% hint style="success" %}
–©–æ–± —É–≤—ñ–º–∫–Ω—É—Ç–∏ Dtrace –±–µ–∑ –ø–æ–≤–Ω–æ–≥–æ –≤–∏–º–∫–Ω–µ–Ω–Ω—è –∑–∞—Ö–∏—Å—Ç—É SIP, –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ–Ω–∞—Ç–∏ —É —Ä–µ–∂–∏–º—ñ –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è: `csrutil enable --without dtrace`

–í–∏ —Ç–∞–∫–æ–∂ –º–æ–∂–µ—Ç–µ **`dtrace`** –∞–±–æ **`dtruss`** –±—ñ–Ω–∞—Ä–Ω—ñ —Ñ–∞–π–ª–∏, **—è–∫—ñ –≤–∏ —Å–∫–æ–º–ø—ñ–ª—é–≤–∞–ª–∏**.
{% endhint %}

–î–æ—Å—Ç—É–ø–Ω—ñ –ø—Ä–æ–±–∏ dtrace –º–æ–∂–Ω–∞ –æ—Ç—Ä–∏–º–∞—Ç–∏ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é:
```bash
dtrace -l | head
ID   PROVIDER            MODULE                          FUNCTION NAME
1     dtrace                                                     BEGIN
2     dtrace                                                     END
3     dtrace                                                     ERROR
43    profile                                                     profile-97
44    profile                                                     profile-199
```
–Ü–º'—è –∑–æ–Ω–¥—É —Å–∫–ª–∞–¥–∞—î—Ç—å—Å—è –∑ —á–æ—Ç–∏—Ä—å–æ—Ö —á–∞—Å—Ç–∏–Ω: –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫, –º–æ–¥—É–ª—å, —Ñ—É–Ω–∫—Ü—ñ—è —Ç–∞ –Ω–∞–∑–≤–∞ (`fbt:mach_kernel:ptrace:entry`). –Ø–∫—â–æ –≤–∏ –Ω–µ –≤–∫–∞–∑—É—î—Ç–µ –¥–µ—è–∫—É —á–∞—Å—Ç–∏–Ω—É —ñ–º–µ–Ω—ñ, Dtrace –∑–∞—Å—Ç–æ—Å—É—î —Ü—é —á–∞—Å—Ç–∏–Ω—É —è–∫ —à–∞–±–ª–æ–Ω.

–î–ª—è –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è DTrace –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü—ñ—ó –∑–æ–Ω–¥—ñ–≤ —Ç–∞ –≤–∫–∞–∑—ñ–≤–∫–∏ –¥—ñ–π, —è–∫—ñ —Å–ª—ñ–¥ –≤–∏–∫–æ–Ω–∞—Ç–∏ –ø—Ä–∏ —ó—Ö —Å–ø—Ä–∞—Ü—é–≤–∞–Ω–Ω—ñ, –Ω–∞–º –∑–Ω–∞–¥–æ–±–∏—Ç—å—Å—è –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –º–æ–≤—É D.

–î–æ–∫–ª–∞–¥–Ω—ñ—à–µ –ø–æ—è—Å–Ω–µ–Ω–Ω—è —Ç–∞ –±—ñ–ª—å—à–µ –ø—Ä–∏–∫–ª–∞–¥—ñ–≤ –º–æ–∂–Ω–∞ –∑–Ω–∞–π—Ç–∏ –∑–∞ –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º [https://illumos.org/books/dtrace/chp-intro.html](https://illumos.org/books/dtrace/chp-intro.html)

#### –ü—Ä–∏–∫–ª–∞–¥–∏

–ó–∞–ø—É—Å—Ç—ñ—Ç—å `man -k dtrace`, —â–æ–± –ø–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ **–¥–æ—Å—Ç—É–ø–Ω—ñ —Å—Ü–µ–Ω–∞—Ä—ñ—ó DTrace**. –ü—Ä–∏–∫–ª–∞–¥: `sudo dtruss -n binary`

* –£ —Ä—è–¥–∫—É
```bash
#Count the number of syscalls of each running process
sudo dtrace -n 'syscall:::entry {@[execname] = count()}'
```
* —Å—Ü–µ–Ω–∞—Ä—ñ–π
```bash
syscall:::entry
/pid == $1/
{
}

#Log every syscall of a PID
sudo dtrace -s script.d 1234
```

```bash
syscall::open:entry
{
printf("%s(%s)", probefunc, copyinstr(arg0));
}
syscall::close:entry
{
printf("%s(%d)\n", probefunc, arg0);
}

#Log files opened and closed by a process
sudo dtrace -s b.d -c "cat /etc/hosts"
```

```bash
syscall:::entry
{
;
}
syscall:::return
{
printf("=%d\n", arg1);
}

#Log sys calls with values
sudo dtrace -s syscalls_info.d -c "cat /etc/hosts"
```
### dtruss
```bash
dtruss -c ls #Get syscalls of ls
dtruss -c -p 1000 #get syscalls of PID 1000
```
### ktrace

–í–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Ü–µ–π –Ω–∞–≤—ñ—Ç—å –∑ **–∞–∫—Ç–∏–≤–æ–≤–∞–Ω–∏–º SIP**
```bash
ktrace trace -s -S -t c -c ls | grep "ls("
```
### ProcessMonitor

[**ProcessMonitor**](https://objective-see.com/products/utilities.html#ProcessMonitor) - –¥—É–∂–µ –∫–æ—Ä–∏—Å–Ω–∏–π —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –¥—ñ–π, –ø–æ–≤'—è–∑–∞–Ω–∏—Ö –∑ –ø—Ä–æ—Ü–µ—Å–æ–º, —è–∫—ñ –≤–∏–∫–æ–Ω—É—î –ø—Ä–æ—Ü–µ—Å (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –Ω–æ–≤–∏—Ö –ø—Ä–æ—Ü–µ—Å—ñ–≤, —è–∫—ñ —Å—Ç–≤–æ—Ä—é—î –ø—Ä–æ—Ü–µ—Å).

### SpriteTree

[**SpriteTree**](https://themittenmac.com/tools/) - —Ü–µ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∑–≤'—è–∑–∫—ñ–≤ –º—ñ–∂ –ø—Ä–æ—Ü–µ—Å–∞–º–∏.\
–í–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤—ñ–¥—Å—Ç–µ–∂—É–≤–∞—Ç–∏ –≤–∞—à Mac –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –∫–æ–º–∞–Ω–¥–∏, –ø–æ–¥—ñ–±–Ω–æ—ó **`sudo eslogger fork exec rename create > cap.json`** (–¥–ª—è –∑–∞–ø—É—Å–∫—É —Ü—ñ—î—ó –∫–æ–º–∞–Ω–¥–∏ –ø–æ—Ç—Ä—ñ–±–Ω—ñ FDA). –ü—ñ—Å–ª—è —Ü—å–æ–≥–æ –≤–∏ –º–æ–∂–µ—Ç–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ json —É —Ü–µ–π —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, —â–æ–± –ø–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –≤—Å—ñ –∑–≤'—è–∑–∫–∏:

<figure><img src="../../../.gitbook/assets/image (710).png" alt="" width="375"><figcaption></figcaption></figure>

### FileMonitor

[**FileMonitor**](https://objective-see.com/products/utilities.html#FileMonitor) –¥–æ–∑–≤–æ–ª—è—î –≤—ñ–¥—Å—Ç–µ–∂—É–≤–∞—Ç–∏ –ø–æ–¥—ñ—ó —Ñ–∞–π–ª—ñ–≤ (—Ç–∞–∫—ñ —è–∫ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è, –∑–º—ñ–Ω–∏ —Ç–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è), –Ω–∞–¥–∞—é—á–∏ –¥–æ–∫–ª–∞–¥–Ω—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ —Ç–∞–∫—ñ –ø–æ–¥—ñ—ó.

### Crescendo

[**Crescendo**](https://github.com/SuprHackerSteve/Crescendo) - —Ü–µ GUI-—ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –∑ –≤–∏–≥–ª—è–¥–æ–º, —è–∫–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ Windows –º–æ–∂—É—Ç—å –∑–Ω–∞—Ç–∏ –∑ _Procmon_ –≤—ñ–¥ Microsoft Sysinternal. –¶–µ–π —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–æ–∑–≤–æ–ª—è—î –ø–æ—á–∏–Ω–∞—Ç–∏ —Ç–∞ –∑—É–ø–∏–Ω—è—Ç–∏ –∑–∞–ø–∏—Å —Ä—ñ–∑–Ω–∏—Ö —Ç–∏–ø—ñ–≤ –ø–æ–¥—ñ–π, —Ñ—ñ–ª—å—Ç—Ä—É–≤–∞—Ç–∏ —Ü—ñ –ø–æ–¥—ñ—ó –∑–∞ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è–º–∏, —Ç–∞–∫–∏–º–∏ —è–∫ —Ñ–∞–π–ª, –ø—Ä–æ—Ü–µ—Å, –º–µ—Ä–µ–∂–∞ —ñ —Ç. –¥., —ñ –Ω–∞–¥–∞—î —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –∑–∞–ø–∏—Å–∞–Ω–∏—Ö –ø–æ–¥—ñ–π —É —Ñ–æ—Ä–º–∞—Ç—ñ json.

### Apple Instruments

[**Apple Instruments**](https://developer.apple.com/library/archive/documentation/Performance/Conceptual/CellularBestPractices/Appendix/Appendix.html) —î —á–∞—Å—Ç–∏–Ω–æ—é —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤ —Ä–æ–∑—Ä–æ–±–Ω–∏–∫–∞ Xcode, —è–∫—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è –¥–ª—è –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ –¥–æ–¥–∞—Ç–∫—ñ–≤, –≤–∏—è–≤–ª–µ–Ω–Ω—è –≤–∏—Ç–æ–∫—ñ–≤ –ø–∞–º'—è—Ç—ñ —Ç–∞ –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ —Ñ–∞–π–ª–æ–≤–æ—ó —Å–∏—Å—Ç–µ–º–∏.

![](<../../../.gitbook/assets/image (15).png>)

### fs\_usage

–î–æ–∑–≤–æ–ª—è—î –≤—ñ–¥—Å—Ç–µ–∂—É–≤–∞—Ç–∏ –¥—ñ—ó, –≤–∏–∫–æ–Ω–∞–Ω—ñ –ø—Ä–æ—Ü–µ—Å–∞–º–∏:
```bash
fs_usage -w -f filesys ls #This tracks filesystem actions of proccess names containing ls
fs_usage -w -f network curl #This tracks network actions
```
### TaskExplorer

[**Taskexplorer**](https://objective-see.com/products/taskexplorer.html) –∫–æ—Ä–∏—Å–Ω–∏–π –¥–ª—è –ø–µ—Ä–µ–≥–ª—è–¥—É **–±—ñ–±–ª—ñ–æ—Ç–µ–∫**, —è–∫—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –±—ñ–Ω–∞—Ä–Ω–∏–π —Ñ–∞–π–ª, **—Ñ–∞–π–ª—ñ–≤**, —è–∫—ñ –≤—ñ–Ω –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î, —Ç–∞ **–º–µ—Ä–µ–∂–µ–≤–∏—Ö** –ø—ñ–¥–∫–ª—é—á–µ–Ω—å.\
–¢–∞–∫–æ–∂ –ø–µ—Ä–µ–≤—ñ—Ä—è—î –ø—Ä–æ—Ü–µ—Å–∏ –±—ñ–Ω–∞—Ä–Ω–æ–≥–æ —Ñ–∞–π–ª—É –Ω–∞ **virustotal** —Ç–∞ –ø–æ–∫–∞–∑—É—î —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –±—ñ–Ω–∞—Ä–Ω–∏–π —Ñ–∞–π–ª.

## PT\_DENY\_ATTACH <a href="#page-title" id="page-title"></a>

–£ [**—Ü—å–æ–º—É –¥–æ–ø–∏—Å—ñ –±–ª–æ–≥—É**](https://knight.sc/debugging/2019/06/03/debugging-apple-binaries-that-use-pt-deny-attach.html) –≤–∏ –º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ –ø—Ä–∏–∫–ª–∞–¥ —Ç–æ–≥–æ, —è–∫ **–Ω–∞–ª–∞–≥–æ–¥–∏—Ç–∏ –ø—Ä–∞—Ü—é—é—á–∏–π –¥–µ–º–æ–Ω**, —è–∫–∏–π –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞–≤ **`PT_DENY_ATTACH`** –¥–ª—è –∑–∞–ø–æ–±—ñ–≥–∞–Ω–Ω—è –Ω–∞–ª–∞–≥–æ–¥–∂–µ–Ω–Ω—é –Ω–∞–≤—ñ—Ç—å —è–∫—â–æ SIP –±—É–≤ –≤–∏–º–∫–Ω–µ–Ω–∏–π.

### lldb

**lldb** - —Ü–µ —Ñ–∞–∫—Ç–∏—á–Ω–∏–π —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è **–Ω–∞–ª–∞–≥–æ–¥–∂–µ–Ω–Ω—è** –±—ñ–Ω–∞—Ä–Ω–∏—Ö —Ñ–∞–π–ª—ñ–≤ **macOS**.
```bash
lldb ./malware.bin
lldb -p 1122
lldb -n malware.bin
lldb -n malware.bin --waitfor
```
–í–∏ –º–æ–∂–µ—Ç–µ –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ intel flavour –ø—Ä–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—ñ lldb, —Å—Ç–≤–æ—Ä–∏–≤—à–∏ —Ñ–∞–π–ª –∑ –Ω–∞–∑–≤–æ—é **`.lldbinit`** —É –≤–∞—à—ñ–π –¥–æ–º–∞—à–Ω—ñ–π –ø–∞–ø—Ü—ñ –∑ –Ω–∞—Å—Ç—É–ø–Ω–∏–º —Ä—è–¥–∫–æ–º:
```bash
settings set target.x86-disassembly-flavor intel
```
{% hint style="warning" %}
–£ –ª–ª–¥–± –≤–∏–≤–µ–¥—ñ—Ç—å –ø—Ä–æ—Ü–µ—Å –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `process save-core`
{% endhint %}

<table data-header-hidden><thead><tr><th width="225"></th><th></th></tr></thead><tbody><tr><td><strong>(lldb) –ö–æ–º–∞–Ω–¥–∞</strong></td><td><strong>–û–ø–∏—Å</strong></td></tr><tr><td><strong>run (r)</strong></td><td>–ü–æ—á–∞—Ç–æ–∫ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è, —è–∫–µ —Ç—Ä–∏–≤–∞—Ç–∏–º–µ –±–µ–∑–ø–µ—Ä–µ—Ä–≤–Ω–æ –¥–æ —Ç–æ–≥–æ, —è–∫ –±—É–¥–µ –¥–æ—Å—è–≥–Ω—É—Ç–æ —Ç–æ—á–∫—É –∑—É–ø–∏–Ω–∫–∏ –∞–±–æ –ø—Ä–æ—Ü–µ—Å –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è.</td></tr><tr><td><strong>continue (c)</strong></td><td>–ü—Ä–æ–¥–æ–≤–∂–∏—Ç–∏ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –≤—ñ–¥–ª–∞–≥–æ–¥–∂—É–≤–∞–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—É.</td></tr><tr><td><strong>nexti (n / ni)</strong></td><td>–í–∏–∫–æ–Ω–∞—Ç–∏ –Ω–∞—Å—Ç—É–ø–Ω—É —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—é. –¶—è –∫–æ–º–∞–Ω–¥–∞ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –≤–∏–∫–ª–∏–∫–∏ —Ñ—É–Ω–∫—Ü—ñ–π.</td></tr><tr><td><strong>stepi (s / si)</strong></td><td>–í–∏–∫–æ–Ω–∞—Ç–∏ –Ω–∞—Å—Ç—É–ø–Ω—É —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—é. –ù–∞ –≤—ñ–¥–º—ñ–Ω—É –≤—ñ–¥ –∫–æ–º–∞–Ω–¥–∏ nexti, —Ü—è –∫–æ–º–∞–Ω–¥–∞ —É–≤—ñ–π–¥–µ –≤ –≤–∏–∫–ª–∏–∫–∏ —Ñ—É–Ω–∫—Ü—ñ–π.</td></tr><tr><td><strong>finish (f)</strong></td><td>–í–∏–∫–æ–Ω–∞—Ç–∏ —Ä–µ—à—Ç—É —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ–π —É –ø–æ—Ç–æ—á–Ω—ñ–π —Ñ—É–Ω–∫—Ü—ñ—ó ("—Ñ—Ä–µ–π–º") –ø–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—è —ñ –∑—É–ø–∏–Ω–∏—Ç–∏—Å—è.</td></tr><tr><td><strong>control + c</strong></td><td>–ü—Ä–∏–∑—É–ø–∏–Ω–∏—Ç–∏ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è. –Ø–∫—â–æ –ø—Ä–æ—Ü–µ—Å –±—É–≤ –∑–∞–ø—É—â–µ–Ω–∏–π (r) –∞–±–æ –ø—Ä–æ–¥–æ–≤–∂–µ–Ω–∏–π (c), —Ü–µ –ø—Ä–∏–∑–≤–µ–¥–µ –¥–æ –∑—É–ø–∏–Ω–∫–∏ –ø—Ä–æ—Ü–µ—Å—É ...–¥–µ –≤—ñ–Ω –≤ –¥–∞–Ω–∏–π –º–æ–º–µ–Ω—Ç –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è.</td></tr><tr><td><strong>breakpoint (b)</strong></td><td><p>b main #–ë—É–¥—å-—è–∫–∞ —Ñ—É–Ω–∫—Ü—ñ—è –∑ —ñ–º'—è–º main</p><p>b &#x3C;binname>`main #–û—Å–Ω–æ–≤–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è –±—ñ–Ω–∞—Ä–Ω–æ–≥–æ —Ñ–∞–π–ª—É</p><p>b set -n main --shlib &#x3C;lib_name> #–û—Å–Ω–æ–≤–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è –≤–∫–∞–∑–∞–Ω–æ–≥–æ –±—ñ–Ω–∞—Ä–Ω–æ–≥–æ —Ñ–∞–π–ª—É</p><p>b -[NSDictionary objectForKey:]</p><p>b -a 0x0000000100004bd9</p><p>br l #–°–ø–∏—Å–æ–∫ —Ç–æ—á–æ–∫ –∑—É–ø–∏–Ω–∫–∏</p><p>br e/dis &#x3C;num> #–£–≤—ñ–º–∫–Ω—É—Ç–∏/–≤–∏–º–∫–Ω—É—Ç–∏ —Ç–æ—á–∫—É –∑—É–ø–∏–Ω–∫–∏</p><p>breakpoint delete &#x3C;num></p></td></tr><tr><td><strong>help</strong></td><td><p>help breakpoint #–û—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ–≤—ñ–¥–∫—É –ø—Ä–æ –∫–æ–º–∞–Ω–¥—É —Ç–æ—á–∫–∏ –∑—É–ø–∏–Ω–∫–∏</p><p>help memory write #–û—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ–≤—ñ–¥–∫—É —â–æ–¥–æ –∑–∞–ø–∏—Å—É –≤ –ø–∞–º'—è—Ç—å</p></td></tr><tr><td><strong>reg</strong></td><td><p>reg read</p><p>reg read $rax</p><p>reg read $rax --format &#x3C;<a href="https://lldb.llvm.org/use/variable.html#type-format">format</a>></p><p>reg write $rip 0x100035cc0</p></td></tr><tr><td><strong>x/s &#x3C;reg/memory address</strong></td><td>–ü–æ–∫–∞–∑–∞—Ç–∏ –ø–∞–º'—è—Ç—å —è–∫ —Ä—è–¥–æ–∫ –∑ –Ω—É–ª—å–æ–≤–∏–º –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è–º.</td></tr><tr><td><strong>x/i &#x3C;reg/memory address</strong></td><td>–ü–æ–∫–∞–∑–∞—Ç–∏ –ø–∞–º'—è—Ç—å —è–∫ –º–∞—à–∏–Ω–Ω—É —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—é.</td></tr><tr><td><strong>x/b &#x3C;reg/memory address</strong></td><td>–ü–æ–∫–∞–∑–∞—Ç–∏ –ø–∞–º'—è—Ç—å —è–∫ –±–∞–π—Ç.</td></tr><tr><td><strong>print object (po)</strong></td><td><p>–¶–µ –≤–∏–≤–µ–¥–µ –æ–±'—î–∫—Ç, –Ω–∞ —è–∫–∏–π –ø–æ—Å–∏–ª–∞—î—Ç—å—Å—è –ø–∞—Ä–∞–º–µ—Ç—Ä</p><p>po $raw</p><p><code>{</code></p><p><code>dnsChanger = {</code></p><p><code>"affiliate" = "";</code></p><p><code>"blacklist_dns" = ();</code></p><p>–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ –±—ñ–ª—å—à—ñ—Å—Ç—å API –∞–±–æ –º–µ—Ç–æ–¥—ñ–≤ Objective-C Apple –ø–æ–≤–µ—Ä—Ç–∞—é—Ç—å –æ–±'—î–∫—Ç–∏, —Ç–æ–º—É —ó—Ö —Å–ª—ñ–¥ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—Ç–∏ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –∫–æ–º–∞–Ω–¥–∏ "print object" (po). –Ø–∫—â–æ po –Ω–µ –≤–∏–≤–æ–¥–∏—Ç—å –∑–º—ñ—Å—Ç–æ–≤–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ <code>x/b</code></p></td></tr><tr><td><strong>memory</strong></td><td>memory read 0x000....<br>memory read $x0+0xf2a<br>memory write 0x100600000 -s 4 0x41414141 #–ó–∞–ø–∏—Å–∞—Ç–∏ AAAA –∑–∞ —Ü—ñ—î—é –∞–¥—Ä–µ—Å–æ—é<br>memory write -f s $rip+0x11f+7 "AAAA" #–ó–∞–ø–∏—Å–∞—Ç–∏ AAAA –∑–∞ –∞–¥—Ä–µ—Å–æ—é</td></tr><tr><td><strong>disassembly</strong></td><td><p>dis #–†–æ–∑—ñ–±—Ä–∞—Ç–∏ –ø–æ—Ç–æ—á–Ω—É —Ñ—É–Ω–∫—Ü—ñ—é</p><p>dis -n &#x3C;funcname> #–†–æ–∑—ñ–±—Ä–∞—Ç–∏ —Ñ—É–Ω–∫—Ü—ñ—é</p><p>dis -n &#x3C;funcname> -b &#x3C;basename> #–†–æ–∑—ñ–±—Ä–∞—Ç–∏ —Ñ—É–Ω–∫—Ü—ñ—é<br>dis -c 6 #–†–æ–∑—ñ–±—Ä–∞—Ç–∏ 6 —Ä—è–¥–∫—ñ–≤<br>dis -c 0x100003764 -e 0x100003768 # –í—ñ–¥ –æ–¥–Ω—ñ—î—ó –∞–¥—Ä–µ—Å–∏ –¥–æ —ñ–Ω—à–æ—ó<br>dis -p -c 4 # –ü–æ—á–∞—Ç–∏ —Ä–æ–∑—ñ–±—Ä–∞—Ç–∏ –∑ –ø–æ—Ç–æ—á–Ω–æ—ó –∞–¥—Ä–µ—Å–∏</p></td></tr><tr><td><strong>parray</strong></td><td>parray 3 (char **)$x1 # –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –º–∞—Å–∏–≤ –∑ 3 –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏ –≤ —Ä–µ–≥—ñ—Å—Ç—Ä—ñ x1</td></tr></tbody></table>

{% hint style="info" %}
–ü—Ä–∏ –≤–∏–∫–ª–∏–∫—É —Ñ—É–Ω–∫—Ü—ñ—ó **`objc_sendMsg`**, —Ä–µ–≥—ñ—Å—Ç—Ä **rsi** –º—ñ—Å—Ç–∏—Ç—å **—ñ–º'—è –º–µ—Ç–æ–¥—É** —è–∫ —Ä—è–¥–æ–∫ –∑ –Ω—É–ª—å–æ–≤–∏–º –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è–º ("C"). –©–æ–± –≤–∏–≤–µ—Å—Ç–∏ —ñ–º'—è —á–µ—Ä–µ–∑ lldb, –≤–∏–∫–æ–Ω–∞–π—Ç–µ:

`(lldb) x/s $rsi: 0x1000f1576: "startMiningWithPort:password:coreCount:slowMemory:currency:"`

`(lldb) print (char*)$rsi:`\
`(char *) $1 = 0x00000001000f1576 "startMiningWithPort:password:coreCount:slowMemory:currency:"`

`(lldb) reg read $rsi: rsi = 0x00000001000f1576 "startMiningWithPort:password:coreCount:slowMemory:currency:"`
{% endhint %}

### –ü—Ä–æ—Ç–∏–¥—ñ—è –¥–∏–Ω–∞–º—ñ—á–Ω–æ–º—É –∞–Ω–∞–ª—ñ–∑—É

#### –í–∏—è–≤–ª–µ–Ω–Ω—è –≤—ñ—Ä—Ç—É–∞–ª—å–Ω–∏—Ö –º–∞—à–∏–Ω

* –ö–æ–º–∞–Ω–¥–∞ **`sysctl hw.model`** –ø–æ–≤–µ—Ä—Ç–∞—î "Mac", –∫–æ–ª–∏ **—Ö–æ—Å—Ç - MacOS**, –∞–ª–µ —â–æ—Å—å —ñ–Ω—à–µ, –∫–æ–ª–∏ —Ü–µ –≤—ñ—Ä—Ç—É–∞–ª—å–Ω–∞ –º–∞—à–∏–Ω–∞.
* –ì—Ä–∞—é—á–∏ –∑—ñ –∑–Ω–∞—á–µ–Ω–Ω—è–º–∏ **`hw.logicalcpu`** —Ç–∞ **`hw.physicalcpu`**, –¥–µ—è–∫—ñ —à–∫—ñ–¥–ª–∏–≤—ñ –ø—Ä–æ–≥—Ä–∞–º–∏ –Ω–∞–º–∞–≥–∞—é—Ç—å—Å—è –≤–∏—è–≤–∏—Ç–∏, —á–∏ —Ü–µ –≤—ñ—Ä—Ç—É–∞–ª—å–Ω–∞ –º–∞—à–∏–Ω–∞.
* –î–µ—è–∫—ñ —à–∫—ñ–¥–ª–∏–≤—ñ –ø—Ä–æ–≥—Ä–∞–º–∏ —Ç–∞–∫–æ–∂ –º–æ–∂—É—Ç—å **–≤–∏—è–≤–∏—Ç–∏**, —á–∏ –º–∞—à–∏–Ω–∞ –±–∞–∑—É—î—Ç—å—Å—è –Ω–∞ **VMware** –∑–∞ MAC-–∞–¥—Ä–µ—Å–æ—é (00:50:56).
* –¢–∞–∫–æ–∂ –º–æ–∂–Ω–∞ –≤–∏—è–≤–∏—Ç–∏, —á–∏ –ø—Ä–æ—Ü–µ—Å **–≤—ñ–¥–ª–∞–≥–æ–¥–∂—É—î—Ç—å—Å—è** –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –ø—Ä–æ—Å—Ç–æ–≥–æ –∫–æ–¥—É, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥:
* `if(P_TRACED == (info.kp_proc.p_flag & P_TRACED)){ //–ø—Ä–æ—Ü–µ—Å –≤—ñ–¥–ª–∞–≥–æ–¥–∂—É—î—Ç—å—Å—è }`
* –¢–∞–∫–æ–∂ –º–æ–∂–Ω–∞ –≤–∏–∫–ª–∏–∫–∞—Ç–∏ —Å–∏—Å—Ç–µ–º–Ω–∏–π –≤–∏–∫–ª–∏–∫ **`ptrace`** –∑ –ø—Ä–∞–ø–æ—Ä—Ü–µ–º **`PT_DENY_ATTACH`**. –¶–µ **–∑–∞–ø–æ–±—ñ–≥–∞—î** –ø—Ä–∏—î–¥–Ω–∞–Ω–Ω—é —Ç–∞ –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—é –≤—ñ–¥–ª–∞–≥–æ–¥–∂—É–≤–∞—á–∞.
* –ú–æ–∂–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, —á–∏ **—ñ–º–ø–æ—Ä—Ç—É—î—Ç—å—Å—è** —Ñ—É–Ω–∫—Ü—ñ—è **`sysctl`** –∞–±–æ **`ptrace`** (–∞–ª–µ —à–∫—ñ–¥–ª–∏–≤–∞ –ø—Ä–æ–≥—Ä–∞–º–∞ –º–æ–∂–µ —ñ–º–ø–æ—Ä—Ç—É–≤–∞—Ç–∏ —ó—ó –¥–∏–Ω–∞–º—ñ—á–Ω–æ)
* –Ø–∫ –≤–∫–∞–∑–∞–Ω–æ –≤ —Ü—å–æ–º—É –æ–≥–ª—è–¥—ñ, ‚Äú[–ü–µ—Ä–µ–º–æ–≥–∞ –Ω–∞–¥ –∞–Ω—Ç–∏-–≤—ñ–¥–ª–∞–≥–æ–¥–∂—É–≤–∞–ª—å–Ω–∏–º–∏ —Ç–µ—Ö–Ω—ñ–∫–∞–º–∏: –≤–∞—Ä—ñ–∞–Ω—Ç–∏ macOS ptrace](https://alexomara.com/blog/defeating-anti-debug-techniques-macos-ptrace-variants/)‚Äù :\
‚Äú_–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ü—Ä–æ—Ü–µ—Å # –∑–∞–≤–µ—Ä—à–∏–≤—Å—è –∑ **—Å—Ç–∞—Ç—É—Å–æ–º = 45 (0x0000002d)** –∑–∞–∑–≤–∏—á–∞–π —î –≤–∫–∞–∑—ñ–≤–∫–æ—é –Ω–∞ —Ç–µ, —â–æ —Ü—ñ–ª—å –≤—ñ–¥–ª–∞–≥–æ–¥–∂—É–≤–∞–Ω–Ω—è –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î **PT\_DENY\_ATTACH**_‚Äù
## Fuzzing

### [ReportCrash](https://ss64.com/osx/reportcrash.html)

ReportCrash **–∞–Ω–∞–ª—ñ–∑—É—î –ø—Ä–æ—Ü–µ—Å–∏, —è–∫—ñ –≤–∏—Ö–æ–¥—è—Ç—å –∑ –ª–∞–¥—É, —Ç–∞ –∑–±–µ—Ä—ñ–≥–∞—î –∑–≤—ñ—Ç –ø—Ä–æ –∑–±—ñ–π –Ω–∞ –¥–∏—Å–∫**. –ó–≤—ñ—Ç –ø—Ä–æ –∑–±—ñ–π –º—ñ—Å—Ç–∏—Ç—å —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é, —è–∫–∞ –º–æ–∂–µ **–¥–æ–ø–æ–º–æ–≥—Ç–∏ —Ä–æ–∑—Ä–æ–±–Ω–∏–∫—É –¥—ñ–∞–≥–Ω–æ—Å—Ç—É–≤–∞—Ç–∏** –ø—Ä–∏—á–∏–Ω—É –∑–±–æ—é.\
–î–ª—è –¥–æ–¥–∞—Ç–∫—ñ–≤ —Ç–∞ —ñ–Ω—à–∏—Ö –ø—Ä–æ—Ü–µ—Å—ñ–≤, —è–∫—ñ **–ø—Ä–∞—Ü—é—é—Ç—å –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç—ñ –∑–∞–ø—É—Å–∫—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞**, ReportCrash –ø—Ä–∞—Ü—é—î —è–∫ LaunchAgent —Ç–∞ –∑–±–µ—Ä—ñ–≥–∞—î –∑–≤—ñ—Ç–∏ –ø—Ä–æ –∑–±–æ—ó –≤ `~/Library/Logs/DiagnosticReports/` –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞\
–î–ª—è –¥–µ–º–æ–Ω—ñ–≤, —ñ–Ω—à–∏—Ö –ø—Ä–æ—Ü–µ—Å—ñ–≤, —è–∫—ñ **–ø—Ä–∞—Ü—é—é—Ç—å –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç—ñ –∑–∞–ø—É—Å–∫—É —Å–∏—Å—Ç–µ–º–∏** —Ç–∞ —ñ–Ω—à–∏—Ö –ø—Ä–∏–≤—ñ–ª–µ–π–æ–≤–∞–Ω–∏—Ö –ø—Ä–æ—Ü–µ—Å—ñ–≤, ReportCrash –ø—Ä–∞—Ü—é—î —è–∫ LaunchDaemon —Ç–∞ –∑–±–µ—Ä—ñ–≥–∞—î –∑–≤—ñ—Ç–∏ –ø—Ä–æ –∑–±–æ—ó –≤ `/Library/Logs/DiagnosticReports`

–Ø–∫—â–æ –≤–∞—Å —Ç—É—Ä–±—É—é—Ç—å –∑–≤—ñ—Ç–∏ –ø—Ä–æ –∑–±–æ—ó, **—è–∫—ñ –Ω–∞–¥—Å–∏–ª–∞—é—Ç—å—Å—è –≤ Apple**, –≤–∏ –º–æ–∂–µ—Ç–µ —ó—Ö –≤–∏–º–∫–Ω—É—Ç–∏. –Ø–∫—â–æ –Ω—ñ, –∑–≤—ñ—Ç–∏ –ø—Ä–æ –∑–±–æ—ó –º–æ–∂—É—Ç—å –±—É—Ç–∏ –∫–æ—Ä–∏—Å–Ω–∏–º–∏ –¥–ª—è **–≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è –ø—Ä–∏—á–∏–Ω–∏ –∑–±–æ—é —Å–µ—Ä–≤–µ—Ä–∞**.
```bash
#To disable crash reporting:
launchctl unload -w /System/Library/LaunchAgents/com.apple.ReportCrash.plist
sudo launchctl unload -w /System/Library/LaunchDaemons/com.apple.ReportCrash.Root.plist

#To re-enable crash reporting:
launchctl load -w /System/Library/LaunchAgents/com.apple.ReportCrash.plist
sudo launchctl load -w /System/Library/LaunchDaemons/com.apple.ReportCrash.Root.plist
```
### –°–æ–Ω

–ü—ñ–¥ —á–∞—Å —Ñ–∞–∑–∑–∏–Ω–≥—É –≤ MacOS –≤–∞–∂–ª–∏–≤–æ –Ω–µ –¥–æ–∑–≤–æ–ª—è—Ç–∏ Mac —Å–ø–∞—Ç–∏:

* systemsetup -setsleep Never
* pmset, System Preferences
* [KeepingYouAwake](https://github.com/newmarcel/KeepingYouAwake)

#### –í—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è SSH

–Ø–∫—â–æ –≤–∏ —Ñ–∞–∑–∑—É—î—Ç–µ —á–µ—Ä–µ–∑ SSH-–∑'—î–¥–Ω–∞–Ω–Ω—è, –≤–∞–∂–ª–∏–≤–æ –ø–µ—Ä–µ–∫–æ–Ω–∞—Ç–∏—Å—è, —â–æ —Å–µ–∞–Ω—Å –Ω–µ –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è. –¢–æ–º—É –∑–º—ñ–Ω—ñ—Ç—å —Ñ–∞–π–ª sshd\_config –Ω–∞—Å—Ç—É–ø–Ω–∏–º —á–∏–Ω–æ–º:

* TCPKeepAlive Yes
* ClientAliveInterval 0
* ClientAliveCountMax 0
```bash
sudo launchctl unload /System/Library/LaunchDaemons/ssh.plist
sudo launchctl load -w /System/Library/LaunchDaemons/ssh.plist
```
### –í–Ω—É—Ç—Ä—ñ—à–Ω—ñ –æ–±—Ä–æ–±–Ω–∏–∫–∏

**–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –Ω–∞—Å—Ç—É–ø–Ω—É —Å—Ç–æ—Ä—ñ–Ω–∫—É**, —â–æ–± –¥—ñ–∑–Ω–∞—Ç–∏—Å—è, —è–∫–∞ –ø—Ä–æ–≥—Ä–∞–º–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –∑–∞ **–æ–±—Ä–æ–±–∫—É –≤–∫–∞–∑–∞–Ω–æ—ó —Å—Ö–µ–º–∏ –∞–±–æ –ø—Ä–æ—Ç–æ–∫–æ–ª—É:**

{% content-ref url="../macos-file-extension-apps.md" %}
[macos-file-extension-apps.md](../macos-file-extension-apps.md)
{% endcontent-ref %}

### –ü–µ—Ä–µ–ª—ñ–∫ –º–µ—Ä–µ–∂–µ–≤–∏—Ö –ø—Ä–æ—Ü–µ—Å—ñ–≤

–¶–µ —Ü—ñ–∫–∞–≤–æ –≤–∏—è–≤–∏—Ç–∏ –ø—Ä–æ—Ü–µ—Å–∏, —è–∫—ñ –∫–µ—Ä—É—é—Ç—å –º–µ—Ä–µ–∂–µ–≤–∏–º–∏ –¥–∞–Ω–∏–º–∏:
```bash
dtrace -n 'syscall::recv*:entry { printf("-> %s (pid=%d)", execname, pid); }' >> recv.log
#wait some time
sort -u recv.log > procs.txt
cat procs.txt
```
–ê–±–æ —Å–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ—Å—è `netstat` –∞–±–æ `lsof`

### Libgmalloc

<figure><img src="../../../.gitbook/assets/Pasted Graphic 14.png" alt=""><figcaption></figcaption></figure>

{% code overflow="wrap" %}
```bash
lldb -o "target create `which some-binary`" -o "settings set target.env-vars DYLD_INSERT_LIBRARIES=/usr/lib/libgmalloc.dylib" -o "run arg1 arg2" -o "bt" -o "reg read" -o "dis -s \$pc-32 -c 24 -m -F intel" -o "quit"
```
{% endcode %}

### Fuzzers

#### [AFL++](https://github.com/AFLplusplus/AFLplusplus)

–ü—Ä–∞—Ü—é—î –¥–ª—è —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤ –∫–æ–º–∞–Ω–¥–Ω–æ–≥–æ —Ä—è–¥–∫–∞

#### [Litefuzz](https://github.com/sec-tools/litefuzz)

–í—ñ–Ω "**–ø—Ä–æ—Å—Ç–æ –ø—Ä–∞—Ü—é—î"** –∑ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏ GUI macOS. –ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ –¥–µ—è–∫—ñ –ø—Ä–æ–≥—Ä–∞–º–∏ macOS –º–∞—é—Ç—å –ø–µ–≤–Ω—ñ –≤–∏–º–æ–≥–∏, —Ç–∞–∫—ñ —è–∫ —É–Ω—ñ–∫–∞–ª—å–Ω—ñ —ñ–º–µ–Ω–∞ —Ñ–∞–π–ª—ñ–≤, –ø—Ä–∞–≤–∏–ª—å–Ω–µ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è, –ø–æ—Ç—Ä—ñ–±–Ω–æ —á–∏—Ç–∞—Ç–∏ —Ñ–∞–π–ª–∏ –∑ –ø—ñ—Å–æ—á–Ω–∏—Ü—ñ (`~/Library/Containers/com.apple.Safari/Data`)...

–î–µ—è–∫—ñ –ø—Ä–∏–∫–ª–∞–¥–∏:

{% code overflow="wrap" %}
```bash
# iBooks
litefuzz -l -c "/System/Applications/Books.app/Contents/MacOS/Books FUZZ" -i files/epub -o crashes/ibooks -t /Users/test/Library/Containers/com.apple.iBooksX/Data/tmp -x 10 -n 100000 -ez

# -l : Local
# -c : cmdline with FUZZ word (if not stdin is used)
# -i : input directory or file
# -o : Dir to output crashes
# -t : Dir to output runtime fuzzing artifacts
# -x : Tmeout for the run (default is 1)
# -n : Num of fuzzing iterations (default is 1)
# -e : enable second round fuzzing where any crashes found are reused as inputs
# -z : enable malloc debug helpers

# Font Book
litefuzz -l -c "/System/Applications/Font Book.app/Contents/MacOS/Font Book FUZZ" -i input/fonts -o crashes/font-book -x 2 -n 500000 -ez

# smbutil (using pcap capture)
litefuzz -lk -c "smbutil view smb://localhost:4455" -a tcp://localhost:4455 -i input/mac-smb-resp -p -n 100000 -z

# screensharingd (using pcap capture)
litefuzz -s -a tcp://localhost:5900 -i input/screenshared-session --reportcrash screensharingd -p -n 100000
```
{% endcode %}

### –î–æ–¥–∞—Ç–∫–æ–≤–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ Fuzzing MacOS

* [https://www.youtube.com/watch?v=T5xfL9tEg44](https://www.youtube.com/watch?v=T5xfL9tEg44)
* [https://github.com/bnagy/slides/blob/master/OSXScale.pdf](https://github.com/bnagy/slides/blob/master/OSXScale.pdf)
* [https://github.com/bnagy/francis/tree/master/exploitaben](https://github.com/bnagy/francis/tree/master/exploitaben)
* [https://github.com/ant4g0nist/crashwrangler](https://github.com/ant4g0nist/crashwrangler)

## –ü–æ—Å–∏–ª–∞–Ω–Ω—è

* [**OS X Incident Response: Scripting and Analysis**](https://www.amazon.com/OS-Incident-Response-Scripting-Analysis-ebook/dp/B01FHOHHVS)
* [**https://www.youtube.com/watch?v=T5xfL9tEg44**](https://www.youtube.com/watch?v=T5xfL9tEg44)
* [**https://taomm.org/vol1/analysis.html**](https://taomm.org/vol1/analysis.html)
* [**The Art of Mac Malware: The Guide to Analyzing Malicious Software**](https://taomm.org/)

<details>

<summary><strong>–í–∏–≤—á–∞–π—Ç–µ —Ö–∞–∫—ñ–Ω–≥ AWS –≤—ñ–¥ –Ω—É–ª—è –¥–æ –≥–µ—Ä–æ—è –∑</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

–Ü–Ω—à—ñ —Å–ø–æ—Å–æ–±–∏ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ HackTricks:

* –Ø–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ **—Ä–µ–∫–ª–∞–º—É –≤–∞—à–æ—ó –∫–æ–º–ø–∞–Ω—ñ—ó –Ω–∞ HackTricks** –∞–±–æ **–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ HackTricks —É —Ñ–æ—Ä–º–∞—Ç—ñ PDF**, –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ü–õ–ê–ù–ò –ü–Ü–î–ü–ò–°–ö–ò**](https://github.com/sponsors/carlospolop)!
* –û—Ç—Ä–∏–º–∞–π—Ç–µ [**–æ—Ñ—ñ—Ü—ñ–π–Ω–∏–π –º–µ—Ä—á PEASS & HackTricks**](https://peass.creator-spring.com)
* –í—ñ–¥–∫—Ä–∏–π—Ç–µ –¥–ª—è —Å–µ–±–µ [**–°—ñ–º'—é PEASS**](https://opensea.io/collection/the-peass-family), –Ω–∞—à—É –∫–æ–ª–µ–∫—Ü—ñ—é –µ–∫—Å–∫–ª—é–∑–∏–≤–Ω–∏—Ö [**NFT**](https://opensea.io/collection/the-peass-family)
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ Telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –Ω–∞–º–∏ –Ω–∞ **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **–ü–æ–¥—ñ–ª—ñ—Ç—å—Å—è —Å–≤–æ—ó–º–∏ —Ö–∞–∫–µ—Ä—Å—å–∫–∏–º–∏ —Ç—Ä—é–∫–∞–º–∏, –Ω–∞–¥—Å–∏–ª–∞–π—Ç–µ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) —Ç–∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤ –Ω–∞ GitHub.

</details>
