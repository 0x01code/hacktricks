# macOS AppleFS

<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдЕрдЧрд░ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА HackTricks рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд рд╣реЛ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕ рджреЗрдЦреЗрдВ**](https://github.com/sponsors/carlospolop)!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рдХрд▓реЗрдХреНрд╢рди, [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ **рдореБрдЭреЗ** **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ** рджреНрд╡рд╛рд░рд╛ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВред

</details>

## Apple Propietary File System (APFS)

**Apple File System (APFS)** рдПрдХ рдЖрдзреБрдирд┐рдХ рдлрд╝рд╛рдЗрд▓ рд╕рд┐рд╕реНрдЯрдо рд╣реИ рдЬреЛ Hierarchical File System Plus (HFS+) рдХреЛ рдмрджрд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдбрд┐рдЬрд╝рд╛рдЗрди рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред рдЗрд╕рдХрд╛ рд╡рд┐рдХрд╛рд╕ **рдмреЗрд╣рддрд░ рдкреНрд░рджрд░реНрд╢рди, рд╕реБрд░рдХреНрд╖рд╛, рдФрд░ рдХреБрд╢рд▓рддрд╛** рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╕реЗ рд╣реБрдЖ рдерд╛ред

APFS рдХреА рдХреБрдЫ рдкреНрд░рдореБрдЦ рд╡рд┐рд╢реЗрд╖рддрд╛рдПрдБ рд╢рд╛рдорд┐рд▓ рд╣реИрдВ:

1. **Space Sharing**: APFS рдПрдХ рд╣реА рдлрд┐рдЬрд┐рдХрд▓ рдЙрдкрдХрд░рдг рдкрд░ рдореМрдЬреВрдж рдирд┐:рд╢реБрд▓реНрдХ рд╕реНрдЯреЛрд░реЗрдЬ рдХреЛ **рдПрдХ рд╣реА рднреВрддрдХрд╛рд▓рд┐рдХ рд╡реЙрд▓реНрдпреВрдо рдХреЗ рд╕рд╛рде рд╕рд╛рдЭрд╛ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ**ред рдпрд╣ рд╡реЙрд▓реНрдпреВрдо рдбрд╛рдпрдирд╛рдорд┐рдХ рд░реВрдк рд╕реЗ рдмрдврд╝ рдФрд░ рдШрдЯ рд╕рдХрддреЗ рд╣реИрдВ рдмрд┐рдирд╛ рдореИрдиреБрдЕрд▓ рдЖрдХрд╛рд░ рдмрджрд▓рд╛рд╡ рдпрд╛ рдкреБрдирд░реНрд╡рд┐рднрд╛рдЬрди рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдХреЗред
1. рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ, рддреБрд▓рдирд╛рддреНрдордХ рд░реВрдк рд╕реЗ **рдХрд┐ APFS рдореЗрдВ рд╡рд┐рднрд┐рдиреНрди рд╡рд┐рднрд╛рдЬрди (рд╡реЙрд▓реНрдпреВрдо) рд╕рднреА рдбрд┐рд╕реНрдХ рд╕реНрдерд╛рди рдХреЛ рд╕рд╛рдЭрд╛ рдХрд░рддреЗ рд╣реИрдВ**, рдЬрдмрдХрд┐ рдПрдХ рд╕рд╛рдзрд╛рд░рдг рд╡рд┐рднрд╛рдЬрди рдореЗрдВ рд╕рд╛рдорд╛рдиреНрдпрдд: рдПрдХ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдЖрдХрд╛рд░ рд╣реЛрддрд╛ рдерд╛ред
2. **Snapshots**: APFS **рд╕реНрдиреИрдкрд╢реЙрдЯ рдмрдирд╛рдиреЗ** рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИ, рдЬреЛ рдлрд╝рд╛рдЗрд▓ рд╕рд┐рд╕реНрдЯрдо рдХреЗ рд╕рдордп-рд╕реАрдорд╛ рдореЗрдВ **рдХреЗрд╡рд▓ рдкрдврд╝рдиреЗ рдпреЛрдЧреНрдп** рдЙрджрд╛рд╣рд░рдг рд╣реЛрддреЗ рд╣реИрдВред рд╕реНрдиреИрдкрд╢реЙрдЯ рдПрдХреНрд╕рдкрд░реНрдЯ рдмреИрдХрдЕрдк рдФрд░ рдЖрд╕рд╛рди рд╕рд┐рд╕реНрдЯрдо рд░реЛрд▓рдмреИрдХ рдХреЛ рд╕рдВрднрд╡ рдмрдирд╛рддреЗ рд╣реИрдВ, рдХреНрдпреЛрдВрдХрд┐ рд╡реЗ рдХрдо рдЕрддрд┐рд░рд┐рдХреНрдд рд╕реНрдЯреЛрд░реЗрдЬ рдХрд╛ рдЙрдкрднреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рддреНрд╡рд░рд┐рдд рд░реВрдк рд╕реЗ рдмрдирд╛рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВ рдпрд╛ рдкреБрдирд░реНрд╡рд░реНрддрд┐рдд рдХрд┐рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВред
3. **Clones**: APFS **рдлрд╝рд╛рдЗрд▓ рдпрд╛ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХреНрд▓реЛрди рдмрдирд╛ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ рдореВрд▓ рдХреЗ рд╕рд╛рде рд╕рдорд╛рди рд╕реНрдЯреЛрд░реЗрдЬ рдХреЛ рд╕рд╛рдЭрд╛ рдХрд░рддреЗ рд╣реИрдВ** рдЬрдм рддрдХ рдпрд╛ рддреЛ рдХреНрд▓реЛрди рдпрд╛ рдореВрд▓ рдлрд╝рд╛рдЗрд▓ рд╕рдВрд╢реЛрдзрд┐рдд рдирд╣реАрдВ рд╣реЛрддреАред рдпрд╣ рд╕реБрд╡рд┐рдзрд╛ рдлрд╝рд╛рдЗрд▓ рдпрд╛ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛рдУрдВ рдХреА рдкреНрд░рддрд┐рд▓рд┐рдкрд┐ рдмрдирд╛рдиреЗ рдХрд╛ рдПрдХ рдХреБрд╢рд▓ рддрд░реАрдХрд╛ рдкреНрд░рджрд╛рди рдХрд░рддреА рд╣реИ рдмрд┐рдирд╛ рд╕реНрдЯреЛрд░реЗрдЬ рд╕реНрдерд╛рди рдХреЛ рджреЛрд╣рд░рд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдХреЗред
4. **Encryption**: APFS **рдкреВрд░реЗ-рдбрд┐рд╕реНрдХ рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди** рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИ рд╕рд╛рде рд╣реА рдкреНрд░рддрд┐-рдлрд╝рд╛рдЗрд▓ рдФрд░ рдкреНрд░рддрд┐-рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди, рд╡рд┐рднрд┐рдиреНрди рдЙрдкрдпреЛрдЧ рдорд╛рдорд▓реЛрдВ рдореЗрдВ рдбреЗрдЯрд╛ рд╕реБрд░рдХреНрд╖рд╛ рдХреЛ рдмрдврд╝рд╛рд╡рд╛ рджреЗрддрд╛ рд╣реИред
5. **Crash Protection**: APFS рдПрдХ **рдХреЙрдкреА-рдСрди-рд░рд╛рдЗрдЯ рдореЗрдЯрд╛рдбреЗрдЯрд╛ рдпреЛрдЬрдирд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ рдЬреЛ рдлрд╝рд╛рдЗрд▓ рд╕рд┐рд╕реНрдЯрдо рд╕рдВрд░рдЪрдирд╛ рдХреА рд╕рдВрд░рдЪрдирд╛ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддреА рд╣реИ** рдпрд╣рд╛рдБ рддрдХ рдХрд┐ рдЕрдЪрд╛рдирдХ рдмрд┐рдЬрд▓реА рдХреА рдЪреЛрдЯ рдпрд╛ рд╕рд┐рд╕реНрдЯрдо рдХреНрд░реИрд╢ рдХреЗ рдорд╛рдорд▓реЛрдВ рдореЗрдВ рднреА, рдбреЗрдЯрд╛ рдХрд░рдкреНрд╢рди рдХреЗ рдЬреЛрдЦрд┐рдо рдХреЛ рдХрдо рдХрд░рддреЗ рд╣реИрдВред

рд╕рдореНрдЧреНрд░, APFS Apple рдЙрдкрдХрд░рдгреЛрдВ рдХреЗ рд▓рд┐рдП рдПрдХ рдФрд░ рдЖрдзреБрдирд┐рдХ, рд▓рдЪреАрд▓рд╛, рдФрд░ рдХреБрд╢рд▓ рдлрд╝рд╛рдЗрд▓ рд╕рд┐рд╕реНрдЯрдо рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ, рдЬрд┐рд╕рдХрд╛ рдореБрдЦреНрдп рдзреНрдпрд╛рди рдкреНрд░рджрд░реНрд╢рди, рд╡рд┐рд╢реНрд╡рд╕рдиреАрдпрддрд╛, рдФрд░ рд╕реБрд░рдХреНрд╖рд╛ рдкрд░ рд╣реИред
```bash
diskutil list # Get overview of the APFS volumes
```
## Firmlinks

`Data` рд╡реЙрд▓реНрдпреВрдо **`/System/Volumes/Data`** рдореЗрдВ рдорд╛рдЙрдВрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ (рдЖрдк `diskutil apfs list` рдХреЗ рд╕рд╛рде рдЗрд╕реЗ рдЪреЗрдХ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ).

рдлрд░реНрдорд▓рд┐рдВрдХреНрд╕ рдХреА рд╕реВрдЪреА **`/usr/share/firmlinks`** рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдорд┐рд▓ рд╕рдХрддреА рд╣реИред
```bash
cat /usr/share/firmlinks
/AppleInternal	AppleInternal
/Applications	Applications
/Library	Library
[...]
```
**рдмрд╛рдПрдВ** рдореЗрдВ, **рд╕рд┐рд╕реНрдЯрдо рд╡реЙрд▓реНрдпреВрдо** рдкрд░ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдкрде рд╣реИ, рдФрд░ **рджрд╛рдПрдВ** рдореЗрдВ, рдЙрд╕ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдкрде рдХреЛ рджрд┐рдЦрд╛рддрд╛ рд╣реИ рдЬрд╣рд╛рдВ рдпрд╣ **рдбреЗрдЯрд╛ рд╡реЙрд▓реНрдпреВрдо** рдкрд░ рдореИрдк рд╣реЛрддрд╛ рд╣реИред рддреЛ, `/library` --> `/system/Volumes/data/library`
