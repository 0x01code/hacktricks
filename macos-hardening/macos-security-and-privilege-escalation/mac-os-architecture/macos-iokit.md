# macOS IOKit

<details>

<summary><strong>‡§ú‡§æ‡§®‡•á‡§Ç AWS ‡§π‡•à‡§ï‡§ø‡§Ç‡§ó ‡§ï‡•ã ‡§∂‡•Ç‡§®‡•ç‡§Ø ‡§∏‡•á ‡§π‡•Ä‡§∞‡•ã ‡§§‡§ï</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* ‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ **‡§∏‡§æ‡§á‡§¨‡§∞ ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§æ ‡§ï‡§Ç‡§™‡§®‡•Ä** ‡§Æ‡•á‡§Ç ‡§ï‡§æ‡§Æ ‡§ï‡§∞ ‡§∞‡§π‡•á ‡§π‡•à‡§Ç? ‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ ‡§Ö‡§™‡§®‡•Ä **‡§ï‡§Ç‡§™‡§®‡•Ä ‡§ï‡•ã ‡§π‡•à‡§ï‡§ü‡•ç‡§∞‡§ø‡§ï‡•ç‡§∏ ‡§Æ‡•á‡§Ç ‡§µ‡§ø‡§ú‡•ç‡§û‡§æ‡§™‡§ø‡§§** ‡§¶‡•á‡§ñ‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç? ‡§Ø‡§æ ‡§Ü‡§™ **PEASS ‡§ï‡•Ä ‡§®‡§µ‡•Ä‡§®‡§§‡§Æ ‡§∏‡§Ç‡§∏‡•ç‡§ï‡§∞‡§£ ‡§¶‡•á‡§ñ‡§®‡§æ ‡§Ø‡§æ HackTricks ‡§ï‡•ã PDF ‡§Æ‡•á‡§Ç ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° ‡§ï‡§∞‡§®‡§æ** ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç? [**‡§∏‡§¶‡§∏‡•ç‡§Ø‡§§‡§æ ‡§ï‡•Ä ‡§Ø‡•ã‡§ú‡§®‡§æ‡§è‡§Ç ‡§¶‡•á‡§ñ‡•á‡§Ç**](https://github.com/sponsors/carlospolop)!
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) ‡§ï‡•Ä ‡§ñ‡§æ‡§∏ NFT ‡§∏‡§Ç‡§ó‡•ç‡§∞‡§π ‡§ï‡•ã ‡§ñ‡•ã‡§ú‡•á‡§Ç
* [**PEASS ‡§î‡§∞ HackTricks ‡§ï‡•Ä ‡§Ü‡§ß‡§ø‡§ï‡§æ‡§∞‡§ø‡§ï ‡§∏‡•ç‡§µ‡•à‡§ó**](https://peass.creator-spring.com) ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞‡•á‡§Ç
* **‡§°‡§ø‡§∏‡•ç‡§ï‡•â‡§∞‡•ç‡§° ‡§∏‡§Æ‡•Ç‡§π** ‡§Æ‡•á‡§Ç **‡§∂‡§æ‡§Æ‡§ø‡§≤ ‡§π‡•ã‡§Ç** ‡§Ø‡§æ [**‡§ü‡•á‡§≤‡•Ä‡§ó‡•ç‡§∞‡§æ‡§Æ ‡§∏‡§Æ‡•Ç‡§π**](https://t.me/peass) ‡§Æ‡•á‡§Ç ‡§Ø‡§æ **‡§Æ‡•Å‡§ù‡•á** **‡§ü‡•ç‡§µ‡§ø‡§ü‡§∞** üê¶[**@carlospolopm**](https://twitter.com/hacktricks\_live) **‡§™‡§∞ ‡§´‡•â‡§≤‡•ã** ‡§ï‡§∞‡•á‡§Ç‡•§
* **‡§π‡•à‡§ï‡§ø‡§Ç‡§ó ‡§ü‡•ç‡§∞‡§ø‡§ï‡•ç‡§∏ ‡§ï‡•ã ‡§∏‡§æ‡§ù‡§æ ‡§ï‡§∞‡•á‡§Ç** [**hacktricks ‡§∞‡•á‡§™‡•ã**](https://github.com/carlospolop/hacktricks) **‡§î‡§∞** [**hacktricks-cloud ‡§∞‡•á‡§™‡•ã**](https://github.com/carlospolop/hacktricks-cloud) **‡§ï‡•ã PR ‡§≠‡•á‡§ú‡§ï‡§∞**‡•§

</details>

## ‡§Æ‡•Ç‡§≤ ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä

I/O Kit ‡§è‡§ï ‡§ì‡§™‡§®-‡§∏‡•ã‡§∞‡•ç‡§∏, ‡§ë‡§¨‡•ç‡§ú
```bash
# Get demangled symbols
nm -C com.apple.driver.AppleJPEGDriver

# Demangled symbols from stdin
c++filt
__ZN16IOUserClient202222dispatchExternalMethodEjP31IOExternalMethodArgumentsOpaquePK28IOExternalMethodDispatch2022mP8OSObjectPv
IOUserClient2022::dispatchExternalMethod(unsigned int, IOExternalMethodArgumentsOpaque*, IOExternalMethodDispatch2022 const*, unsigned long, OSObject*, void*)
```
{% hint style="danger" %}
IOKit **‡§â‡§ú‡§æ‡§ó‡§∞ ‡§ï‡§æ‡§∞‡•ç‡§Ø** ‡§ú‡§¨ ‡§ï‡•ã‡§à ‡§ï‡•ç‡§≤‡§æ‡§á‡§Ç‡§ü ‡§ï‡§ø‡§∏‡•Ä ‡§ï‡§æ‡§∞‡•ç‡§Ø ‡§ï‡•ã ‡§ï‡•â‡§≤ ‡§ï‡§∞‡§®‡•á ‡§ï‡•Ä ‡§ï‡•ã‡§∂‡§ø‡§∂ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à, ‡§§‡•ã **‡§Ö‡§§‡§ø‡§∞‡§ø‡§ï‡•ç‡§§ ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§æ ‡§ú‡§æ‡§Ç‡§ö‡•á‡§Ç** ‡§ï‡§∞ ‡§∏‡§ï‡§§‡§æ ‡§π‡•à, ‡§≤‡•á‡§ï‡§ø‡§® ‡§ß‡•ç‡§Ø‡§æ‡§® ‡§¶‡•á‡§Ç ‡§ï‡§ø ‡§è‡§™‡•ç‡§∏ ‡§∏‡§æ‡§Æ‡§æ‡§®‡•ç‡§Ø‡§§: **‡§∏‡•à‡§Ç‡§°‡§¨‡•â‡§ï‡•ç‡§∏** ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ **‡§∏‡•Ä‡§Æ‡§ø‡§§** ‡§π‡•ã‡§§‡•á ‡§π‡•à‡§Ç ‡§ú‡§ø‡§®‡§ï‡•á ‡§∏‡§æ‡§• IOKit ‡§ï‡§æ‡§∞‡•ç‡§Ø‡•ã‡§Ç ‡§ï‡§æ ‡§â‡§®‡•ç‡§π‡•á‡§Ç ‡§™‡•ç‡§∞‡§≠‡§æ‡§µ‡§ø‡§§ ‡§ï‡§∞‡§®‡•á ‡§ï‡•Ä ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§π‡•ã‡§§‡•Ä ‡§π‡•à‡•§
{% endhint %}

## ‡§°‡•ç‡§∞‡§æ‡§á‡§µ‡§∞

macOS ‡§Æ‡•á‡§Ç ‡§µ‡•á ‡§Ø‡§π‡§æ‡§Å ‡§∏‡•ç‡§•‡§ø‡§§ ‡§π‡•à‡§Ç:

* **`/System/Library/Extensions`**
* ‡§ì‡§è‡§∏ ‡§è‡§ï‡•ç‡§∏ ‡§ë‡§™‡§∞‡•á‡§ü‡§ø‡§Ç‡§ó ‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ ‡§Æ‡•á‡§Ç ‡§¨‡§ø‡§≤‡•ç‡§ü ‡§á‡§® KEXT ‡§´‡§º‡§æ‡§á‡§≤‡•á‡§Ç‡•§
* **`/Library/Extensions`**
* 3rd ‡§™‡§æ‡§∞‡•ç‡§ü‡•Ä ‡§∏‡•â‡§´‡•ç‡§ü‡§µ‡•á‡§Ø‡§∞ ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ ‡§∏‡•ç‡§•‡§æ‡§™‡§ø‡§§ KEXT ‡§´‡§º‡§æ‡§á‡§≤‡•á‡§Ç

iOS ‡§Æ‡•á‡§Ç ‡§µ‡•á ‡§Ø‡§π‡§æ‡§Å ‡§∏‡•ç‡§•‡§ø‡§§ ‡§π‡•à‡§Ç:

* **`/System/Library/Extensions`**
```bash
#Use kextstat to print the loaded drivers
kextstat
Executing: /usr/bin/kmutil showloaded
No variant specified, falling back to release
Index Refs Address            Size       Wired      Name (Version) UUID <Linked Against>
1  142 0                  0          0          com.apple.kpi.bsd (20.5.0) 52A1E876-863E-38E3-AC80-09BBAB13B752 <>
2   11 0                  0          0          com.apple.kpi.dsep (20.5.0) 52A1E876-863E-38E3-AC80-09BBAB13B752 <>
3  170 0                  0          0          com.apple.kpi.iokit (20.5.0) 52A1E876-863E-38E3-AC80-09BBAB13B752 <>
4    0 0                  0          0          com.apple.kpi.kasan (20.5.0) 52A1E876-863E-38E3-AC80-09BBAB13B752 <>
5  175 0                  0          0          com.apple.kpi.libkern (20.5.0) 52A1E876-863E-38E3-AC80-09BBAB13B752 <>
6  154 0                  0          0          com.apple.kpi.mach (20.5.0) 52A1E876-863E-38E3-AC80-09BBAB13B752 <>
7   88 0                  0          0          com.apple.kpi.private (20.5.0) 52A1E876-863E-38E3-AC80-09BBAB13B752 <>
8  106 0                  0          0          com.apple.kpi.unsupported (20.5.0) 52A1E876-863E-38E3-AC80-09BBAB13B752 <>
9    2 0xffffff8003317000 0xe000     0xe000     com.apple.kec.Libm (1) 6C1342CC-1D74-3D0F-BC43-97D5AD38200A <5>
10   12 0xffffff8003544000 0x92000    0x92000    com.apple.kec.corecrypto (11.1) F5F1255F-6552-3CF4-A9DB-D60EFDEB4A9A <8 7 6 5 3 1>
```
‡§ú‡§¨ ‡§§‡§ï ‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ 9 ‡§§‡§ï ‡§∏‡•Ç‡§ö‡•Ä‡§¨‡§¶‡•ç‡§ß ‡§°‡•ç‡§∞‡§æ‡§á‡§µ‡§∞ **‡§™‡§§‡§æ 0 ‡§Æ‡•á‡§Ç ‡§≤‡•ã‡§° ‡§ï‡§ø‡§è ‡§ó‡§è** ‡§π‡•à‡§Ç‡•§ ‡§á‡§∏‡§ï‡§æ ‡§Æ‡§§‡§≤‡§¨ ‡§π‡•à ‡§ï‡§ø ‡§Ø‡•á ‡§µ‡§æ‡§∏‡•ç‡§§‡§µ‡§ø‡§ï ‡§°‡•ç‡§∞‡§æ‡§á‡§µ‡§∞ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡§Ç ‡§¨‡§≤‡•ç‡§ï‡§ø **‡§ï‡§∞‡•ç‡§®‡•á‡§≤ ‡§ï‡§æ ‡§π‡§ø‡§∏‡•ç‡§∏‡§æ ‡§π‡•à‡§Ç ‡§î‡§∞ ‡§â‡§®‡•ç‡§π‡•á‡§Ç ‡§Ö‡§®‡§≤‡•ã‡§° ‡§®‡§π‡•Ä‡§Ç ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ ‡§∏‡§ï‡§§‡§æ**‡•§

‡§µ‡§ø‡§∂‡§ø‡§∑‡•ç‡§ü ‡§è‡§ï‡•ç‡§∏‡§ü‡•á‡§Ç‡§∂‡§®‡•ç‡§∏ ‡§ñ‡•ã‡§ú‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ü‡§™ ‡§®‡§ø‡§Æ‡•ç‡§®‡§≤‡§ø‡§ñ‡§ø‡§§ ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç:
```bash
kextfind -bundle-id com.apple.iokit.IOReportFamily #Search by full bundle-id
kextfind -bundle-id -substring IOR #Search by substring in bundle-id
```
‡§ï‡§∞‡•ç‡§®‡•á‡§≤ ‡§è‡§ï‡•ç‡§∏‡§ü‡•á‡§Ç‡§∂‡§® ‡§ï‡•ã ‡§≤‡•ã‡§° ‡§î‡§∞ ‡§Ö‡§®‡§≤‡•ã‡§° ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡§∞‡•á‡§Ç:
```bash
kextload com.apple.iokit.IOReportFamily
kextunload com.apple.iokit.IOReportFamily
```
## IORegistry

**IORegistry** ‡§Æ‡•à‡§ï‡§ì‡§è‡§∏ ‡§î‡§∞ ‡§Ü‡§à‡§ì‡§è‡§∏ ‡§Æ‡•á‡§Ç IOKit framework ‡§ï‡§æ ‡§è‡§ï ‡§Æ‡§π‡§§‡•ç‡§µ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§π‡§ø‡§∏‡•ç‡§∏‡§æ ‡§π‡•à ‡§ú‡•ã ‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ ‡§ï‡•Ä ‡§π‡§æ‡§∞‡•ç‡§°‡§µ‡•á‡§Ø‡§∞ ‡§ï‡•â‡§®‡•ç‡§´‡§º‡§ø‡§ó‡§∞‡•á‡§∂‡§® ‡§î‡§∞ ‡§∏‡•ç‡§•‡§ø‡§§‡§ø ‡§ï‡•ã ‡§™‡•ç‡§∞‡§§‡§ø‡§®‡§ø‡§ß‡§ø‡§§‡•ç‡§µ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§è‡§ï ‡§°‡•á‡§ü‡§æ‡§¨‡•á‡§∏ ‡§ï‡§æ ‡§ï‡§æ‡§∞‡•ç‡§Ø ‡§ï‡§∞‡§§‡§æ ‡§π‡•à‡•§ ‡§Ø‡§π ‡§è‡§ï **‡§µ‡§ø‡§≠‡§æ‡§ú‡§®‡§æ‡§§‡•ç‡§Æ‡§ï ‡§∏‡§Ç‡§ó‡•ç‡§∞‡§π ‡§π‡•à ‡§ú‡•ã ‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ ‡§™‡§∞ ‡§≤‡•ã‡§° ‡§ï‡•Ä ‡§ó‡§à ‡§∏‡§≠‡•Ä ‡§π‡§æ‡§∞‡•ç‡§°‡§µ‡•á‡§Ø‡§∞ ‡§î‡§∞ ‡§°‡•ç‡§∞‡§æ‡§á‡§µ‡§∞‡•ç‡§∏** ‡§ï‡•ã ‡§™‡•ç‡§∞‡§§‡§ø‡§®‡§ø‡§ß‡§ø‡§§‡•ç‡§µ ‡§ï‡§∞‡§®‡•á ‡§µ‡§æ‡§≤‡•á ‡§ë‡§¨‡•ç‡§ú‡•á‡§ï‡•ç‡§ü‡•ç‡§∏ ‡§ï‡§æ ‡§∏‡§Ç‡§ó‡•ç‡§∞‡§π ‡§π‡•à, ‡§î‡§∞ ‡§â‡§®‡§ï‡•á ‡§Ü‡§™‡§∏‡•Ä ‡§∏‡§Ç‡§¨‡§Ç‡§ß‡•ã‡§Ç ‡§ï‡•ã‡•§&#x20;

‡§Ü‡§™ **`ioreg`** ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§ï‡•á IORegistry ‡§ï‡•ã ‡§ï‡§Ç‡§∏‡•ã‡§≤ ‡§∏‡•á ‡§ú‡§æ‡§Ç‡§ö ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç (‡§µ‡§ø‡§∂‡•á‡§∑ ‡§∞‡•Ç‡§™ ‡§∏‡•á ‡§Ü‡§à‡§ì‡§è‡§∏ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§â‡§™‡§Ø‡•Å‡§ï‡•ç‡§§)‡•§
```bash
ioreg -l #List all
ioreg -w 0 #Not cut lines
ioreg -p <plane> #Check other plane
```
‡§Ü‡§™ **`IORegistryExplorer`** ‡§ï‡•ã [**https://developer.apple.com/download/all/**](https://developer.apple.com/download/all/) ‡§∏‡•á **Xcode Additional Tools** ‡§∏‡•á ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç ‡§î‡§∞ **macOS IORegistry** ‡§ï‡•Ä **‡§ó‡•ç‡§∞‡§æ‡§´‡§ø‡§ï‡§≤** ‡§á‡§Ç‡§ü‡§∞‡§´‡•á‡§∏ ‡§ï‡•á ‡§Æ‡§æ‡§ß‡•ç‡§Ø‡§Æ ‡§∏‡•á ‡§ú‡§æ‡§Ç‡§ö ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§

<figure><img src="../../../.gitbook/assets/image (695).png" alt="" width="563"><figcaption></figcaption></figure>

IORegistryExplorer ‡§Æ‡•á‡§Ç, "planes" ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§µ‡§ø‡§≠‡§ø‡§®‡•ç‡§® ‡§ë‡§¨‡•ç‡§ú‡•á‡§ï‡•ç‡§ü‡•ç‡§∏ ‡§ï‡•á ‡§¨‡•Ä‡§ö ‡§∏‡§Ç‡§¨‡§Ç‡§ß‡•ã‡§Ç ‡§ï‡•ã ‡§∏‡§Ç‡§ó‡§†‡§ø‡§§ ‡§î‡§∞ ‡§™‡•ç‡§∞‡§¶‡§∞‡•ç‡§∂‡§ø‡§§ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à‡•§ ‡§™‡•ç‡§∞‡§§‡•ç‡§Ø‡•á‡§ï plane ‡§è‡§ï ‡§µ‡§ø‡§∂‡§ø‡§∑‡•ç‡§ü ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞ ‡§ï‡•á ‡§∏‡§Ç‡§¨‡§Ç‡§ß ‡§ï‡•ã ‡§™‡•ç‡§∞‡§§‡§ø‡§®‡§ø‡§ß‡§ø‡§§‡•ç‡§µ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à ‡§Ø‡§æ ‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ ‡§ï‡•á ‡§π‡§æ‡§∞‡•ç‡§°‡§µ‡•á‡§Ø‡§∞ ‡§î‡§∞ ‡§°‡•ç‡§∞‡§æ‡§á‡§µ‡§∞ ‡§ï‡•â‡§®‡•ç‡§´‡§º‡§ø‡§ó‡§∞‡•á‡§∂‡§® ‡§ï‡§æ ‡§µ‡§ø‡§∂‡•á‡§∑ ‡§¶‡•É‡§∂‡•ç‡§Ø ‡§™‡•ç‡§∞‡§¶‡§∞‡•ç‡§∂‡§ø‡§§ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à‡•§ ‡§Ø‡§π‡§æ‡§Ç ‡§ï‡•Å‡§õ ‡§∏‡§æ‡§Æ‡§æ‡§®‡•ç‡§Ø planes ‡§π‡•à‡§Ç ‡§ú‡•ã ‡§Ü‡§™ IORegistryExplorer ‡§Æ‡•á‡§Ç ‡§¶‡•á‡§ñ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç:

1. **IOService Plane**: ‡§Ø‡§π ‡§∏‡§¨‡§∏‡•á ‡§∏‡§æ‡§Æ‡§æ‡§®‡•ç‡§Ø plane ‡§π‡•à, ‡§ú‡•ã ‡§°‡•ç‡§∞‡§æ‡§á‡§µ‡§∞‡•ç‡§∏ ‡§î‡§∞ nubs ‡§ï‡•ã ‡§™‡•ç‡§∞‡§§‡§ø‡§®‡§ø‡§ß‡§ø‡§§ ‡§ï‡§∞‡§®‡•á ‡§µ‡§æ‡§≤‡•á ‡§∏‡•á‡§µ‡§æ ‡§ë‡§¨‡•ç‡§ú
```objectivec
#import <Foundation/Foundation.h>
#import <IOKit/IOKitLib.h>

int main(int argc, const char * argv[]) {
@autoreleasepool {
// Get a reference to the service using its name
CFMutableDictionaryRef matchingDict = IOServiceMatching("YourServiceNameHere");
if (matchingDict == NULL) {
NSLog(@"Failed to create matching dictionary");
return -1;
}

// Obtain an iterator over all matching services
io_iterator_t iter;
kern_return_t kr = IOServiceGetMatchingServices(kIOMasterPortDefault, matchingDict, &iter);
if (kr != KERN_SUCCESS) {
NSLog(@"Failed to get matching services");
return -1;
}

// Get a reference to the first service (assuming it exists)
io_service_t service = IOIteratorNext(iter);
if (!service) {
NSLog(@"No matching service found");
IOObjectRelease(iter);
return -1;
}

// Open a connection to the service
io_connect_t connect;
kr = IOServiceOpen(service, mach_task_self(), 0, &connect);
if (kr != KERN_SUCCESS) {
NSLog(@"Failed to open service");
IOObjectRelease(service);
IOObjectRelease(iter);
return -1;
}

// Call a method on the service
// Assume the method has a selector of 0, and takes no arguments
kr = IOConnectCallScalarMethod(connect, 0, NULL, 0, NULL, NULL);
if (kr != KERN_SUCCESS) {
NSLog(@"Failed to call method");
}

// Cleanup
IOServiceClose(connect);
IOObjectRelease(service);
IOObjectRelease(iter);
}
return 0;
}
```
‡§á‡§∏‡§ï‡•á ‡§Ö‡§≤‡§æ‡§µ‡§æ **`IOConnectCallScalarMethod`** ‡§ú‡•à‡§∏‡•á IOKit ‡§´‡§º‡§Ç‡§ï‡•ç‡§∂‡§® ‡§ï‡•ã ‡§ï‡•â‡§≤ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è **`IOConnectCallMethod`**, **`IOConnectCallStructMethod`** ‡§ú‡•à‡§∏‡•á **‡§Ö‡§®‡•ç‡§Ø** ‡§´‡§º‡§Ç‡§ï‡•ç‡§∂‡§® ‡§π‡•ã ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§

## ‡§°‡•ç‡§∞‡§æ‡§á‡§µ‡§∞ ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä‡§™‡•â‡§á‡§Ç‡§ü ‡§ï‡§æ ‡§∞‡§ø‡§µ‡§∞‡•ç‡§∏‡§ø‡§Ç‡§ó

‡§Ü‡§™ ‡§á‡§®‡•ç‡§π‡•á‡§Ç ‡§â‡§¶‡§æ‡§π‡§∞‡§£ ‡§ï‡•á ‡§∞‡•Ç‡§™ ‡§Æ‡•á‡§Ç [**‡§´‡§∞‡•ç‡§Æ‡§µ‡•á‡§Ø‡§∞ ‡§á‡§Æ‡•á‡§ú (ipsw)**](./#ipsw) ‡§∏‡•á ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§ ‡§´‡§ø‡§∞, ‡§á‡§∏‡•á ‡§Ö‡§™‡§®‡•á ‡§™‡§∏‡§Ç‡§¶‡•Ä‡§¶‡§æ ‡§°‡•Ä‡§ï‡§Ç‡§™‡§æ‡§á‡§≤‡§∞ ‡§Æ‡•á‡§Ç ‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç‡•§

‡§Ü‡§™ **`externalMethod`** ‡§´‡§º‡§Ç‡§ï‡•ç‡§∂‡§® ‡§ï‡§æ ‡§°‡•Ä‡§ï‡§Ç‡§™‡§æ‡§á‡§≤‡§ø‡§Ç‡§ó ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç ‡§ï‡•ç‡§Ø‡•ã‡§Ç‡§ï‡§ø ‡§Ø‡§π ‡§°‡•ç‡§∞‡§æ‡§á‡§µ‡§∞ ‡§´‡§º‡§Ç‡§ï‡•ç‡§∂‡§® ‡§π‡•à ‡§ú‡•ã ‡§ï‡•â‡§≤ ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞‡•á‡§ó‡§æ ‡§î‡§∞ ‡§∏‡§π‡•Ä ‡§´‡§º‡§Ç‡§ï‡•ç‡§∂‡§® ‡§ï‡•ã ‡§ï‡•â‡§≤ ‡§ï‡§∞‡•á‡§ó‡§æ:
```cpp
IOUserClient2022::dispatchExternalMethod(unsigned int, IOExternalMethodArgumentsOpaque*, IOExternalMethodDispatch2022 const*, unsigned long, OSObject*, void*)
```
{% endcode %}

‡§™‡§ø‡§õ‡§≤‡•á ‡§™‡§∞‡§ø‡§≠‡§æ‡§∑‡§£ ‡§Æ‡•á‡§Ç ‡§ß‡•ç‡§Ø‡§æ‡§® ‡§¶‡•á‡§Ç ‡§ï‡§ø **`self`** ‡§™‡•à‡§∞‡§æ‡§Æ‡•Ä‡§ü‡§∞ ‡§õ‡•Ç‡§ü ‡§ó‡§Ø‡§æ ‡§π‡•à, ‡§Ö‡§ö‡•ç‡§õ‡•Ä ‡§™‡§∞‡§ø‡§≠‡§æ‡§∑‡§£ ‡§®‡§ø‡§Æ‡•ç‡§®‡§≤‡§ø‡§ñ‡§ø‡§§ ‡§π‡•ã‡§ó‡•Ä:

{% code overflow="wrap" %}
```cpp
IOUserClient2022::dispatchExternalMethod(self, unsigned int, IOExternalMethodArgumentsOpaque*, IOExternalMethodDispatch2022 const*, unsigned long, OSObject*, void*)
```
{% endcode %}

‡§µ‡§æ‡§∏‡•ç‡§§‡§µ ‡§Æ‡•á‡§Ç, ‡§Ü‡§™ ‡§µ‡§æ‡§∏‡•ç‡§§‡§µ‡§ø‡§ï ‡§™‡§∞‡§ø‡§≠‡§æ‡§∑‡§æ [https://github.com/apple-oss-distributions/xnu/blob/1031c584a5e37aff177559b9f69dbd3c8c3fd30a/iokit/Kernel/IOUserClient.cpp#L6388](https://github.com/apple-oss-distributions/xnu/blob/1031c584a5e37aff177559b9f69dbd3c8c3fd30a/iokit/Kernel/IOUserClient.cpp#L6388) ‡§Æ‡•á‡§Ç ‡§™‡§æ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç:
```cpp
IOUserClient2022::dispatchExternalMethod(uint32_t selector, IOExternalMethodArgumentsOpaque *arguments,
const IOExternalMethodDispatch2022 dispatchArray[], size_t dispatchArrayCount,
OSObject * target, void * reference)
```
‡§á‡§∏ ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§ï‡•á ‡§∏‡§æ‡§• ‡§Ü‡§™ Ctrl+Right -> `‡§∏‡§Ç‡§™‡§æ‡§¶‡§® ‡§ï‡§æ‡§∞‡•ç‡§Ø ‡§∏‡§ø‡§ó‡•ç‡§®‡•á‡§ö‡§∞` ‡§ï‡•ã ‡§™‡•Å‡§®‡§É ‡§≤‡§ø‡§ñ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç ‡§î‡§∞ ‡§ú‡§æ‡§®‡•á ‡§ó‡§è ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞‡•ã‡§Ç ‡§ï‡•ã ‡§∏‡•á‡§ü ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç:

<figure><img src="../../../.gitbook/assets/image (702).png" alt=""><figcaption></figcaption></figure>

‡§®‡§Ø‡§æ ‡§°‡•Ä‡§ï‡§Ç‡§™‡§æ‡§á‡§≤ ‡§ï‡•ã‡§° ‡§á‡§∏ ‡§§‡§∞‡§π ‡§¶‡§ø‡§ñ‡•á‡§ó‡§æ:

<figure><img src="../../../.gitbook/assets/image (703).png" alt=""><figcaption></figcaption></figure>

‡§Ö‡§ó‡§≤‡•á ‡§ï‡§¶‡§Æ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§π‡§Æ‡•á‡§Ç **`IOExternalMethodDispatch2022`** ‡§∏‡•ç‡§ü‡•ç‡§∞‡§ï‡•ç‡§ü‡§∞ ‡§ï‡•ã ‡§™‡§∞‡§ø‡§≠‡§æ‡§∑‡§ø‡§§ ‡§ï‡§∞‡§®‡§æ ‡§π‡•ã‡§ó‡§æ‡•§ ‡§Ø‡§π [https://github.com/apple-oss-distributions/xnu/blob/1031c584a5e37aff177559b9f69dbd3c8c3fd30a/iokit/IOKit/IOUserClient.h#L168-L176](https://github.com/apple-oss-distributions/xnu/blob/1031c584a5e37aff177559b9f69dbd3c8c3fd30a/iokit/IOKit/IOUserClient.h#L168-L176) ‡§Æ‡•á‡§Ç ‡§ì‡§™‡§®‡§∏‡•ã‡§∞‡•ç‡§∏ ‡§π‡•à, ‡§Ü‡§™ ‡§á‡§∏‡•á ‡§™‡§∞‡§ø‡§≠‡§æ‡§∑‡§ø‡§§ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç:

<figure><img src="../../../.gitbook/assets/image (698).png" alt=""><figcaption></figcaption></figure>

‡§Ö‡§¨, `(IOExternalMethodDispatch2022 *)&sIOExternalMethodArray` ‡§ï‡§æ ‡§™‡§æ‡§≤‡§® ‡§ï‡§∞‡§§‡•á ‡§π‡•Å‡§è ‡§Ü‡§™ ‡§¨‡§π‡•Å‡§§ ‡§∏‡§æ‡§∞‡•á ‡§°‡•á‡§ü‡§æ ‡§¶‡•á‡§ñ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç:

<figure><img src="../../../.gitbook/assets/image (704).png" alt="" width="563"><figcaption></figcaption></figure>

‡§°‡•á‡§ü‡§æ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞ ‡§ï‡•ã **`IOExternalMethodDispatch2022:`** ‡§Æ‡•á‡§Ç ‡§¨‡§¶‡§≤‡•á‡§Ç:

<figure><img src="../../../.gitbook/assets/image (705).png" alt="" width="375"><figcaption></figcaption></figure>

‡§¨‡§¶‡§≤‡§æ‡§µ ‡§ï‡•á ‡§¨‡§æ‡§¶:

<figure><img src="../../../.gitbook/assets/image (707).png" alt="" width="563"><figcaption></figcaption></figure>

‡§î‡§∞ ‡§ú‡•à‡§∏‡§æ ‡§ï‡§ø ‡§π‡§Æ ‡§Ö‡§¨ ‡§µ‡§π‡§æ‡§Å ‡§π‡•à‡§Ç, ‡§π‡§Æ‡§æ‡§∞‡•á ‡§™‡§æ‡§∏ **7 ‡§§‡§§‡•ç‡§µ‡•ã‡§Ç ‡§ï‡§æ ‡§è‡§ï ‡§∏‡§∞‡§£‡•Ä** ‡§π‡•à (‡§Ö‡§Ç‡§§‡§ø‡§Æ ‡§°‡•Ä‡§ï‡§Ç‡§™‡§æ‡§á‡§≤ ‡§ï‡•ã‡§° ‡§ï‡•Ä ‡§ú‡§æ‡§Ç‡§ö ‡§ï‡§∞‡•á‡§Ç), 7 ‡§§‡§§‡•ç‡§µ‡•ã‡§Ç ‡§ï‡•Ä ‡§è‡§ï ‡§∏‡§∞‡§£‡•Ä ‡§¨‡§®‡§æ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç:

<figure><img src="../../../.gitbook/assets/image (708).png" alt="" width="563"><figcaption></figcaption></figure>

‡§∏‡§∞‡§£‡•Ä ‡§¨‡§®‡§æ‡§à ‡§ú‡§æ‡§®‡•á ‡§ï‡•á ‡§¨‡§æ‡§¶ ‡§Ü‡§™ ‡§∏‡§≠‡•Ä ‡§®‡§ø‡§∞‡•ç‡§Ø‡§æ‡§§ ‡§ï‡§ø‡§è ‡§ó‡§è ‡§ï‡§æ‡§∞‡•ç‡§Ø‡•ã‡§Ç ‡§ï‡•ã ‡§¶‡•á‡§ñ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç:

<figure><img src="../../../.gitbook/assets/image (709).png" alt=""><figcaption></figcaption></figure>

{% hint style="success" %}
‡§Ö‡§ó‡§∞ ‡§Ü‡§™ ‡§Ø‡§æ‡§¶ ‡§ï‡§∞‡§§‡•á ‡§π‡•à‡§Ç, ‡§§‡•ã **‡§è‡§ï** **‡§®‡§ø‡§∞‡•ç‡§Ø‡§æ‡§§ ‡§ï‡§ø‡§è ‡§ó‡§è** ‡§ï‡§æ‡§∞‡•ç‡§Ø ‡§ï‡•ã ‡§Ø‡•Ç‡§ú‡§∞ ‡§∏‡•ç‡§™‡•á‡§∏ ‡§∏‡•á **‡§ï‡•â‡§≤** ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§π‡§Æ‡•á‡§Ç ‡§ï‡§æ‡§∞‡•ç‡§Ø ‡§ï‡•á ‡§®‡§æ‡§Æ ‡§ï‡•ã ‡§®‡§π‡•Ä‡§Ç, ‡§¨‡§≤‡•ç‡§ï‡§ø **‡§∏‡•á‡§≤‡•á‡§ï‡•ç‡§ü‡§∞ ‡§®‡§Ç‡§¨‡§∞** ‡§ï‡•ã ‡§ï‡•â‡§≤ ‡§ï‡§∞‡§®‡•á ‡§ï‡•Ä ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï‡§§‡§æ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§ ‡§Ø‡§π‡§æ‡§Å ‡§Ü‡§™ ‡§¶‡•á‡§ñ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç ‡§ï‡§ø ‡§∏‡•á‡§≤‡•á‡§ï‡•ç‡§ü‡§∞ **0** ‡§ï‡§æ‡§∞‡•ç‡§Ø **`initializeDecoder`** ‡§π‡•à, ‡§∏‡•á‡§≤‡•á‡§ï‡•ç‡§ü‡§∞ **1** **`startDecoder`** ‡§π‡•à, ‡§∏‡•á‡§≤‡•á‡§ï‡•ç‡§ü‡§∞ **2** **`initializeEncoder`** ‡§π‡•à...
{% endhint %}
