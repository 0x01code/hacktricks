# macOS рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рд╕реНрдерд╛рди

<details>

<summary><strong>Learn AWS hacking from zero to hero with</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ**, рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ [**telegram group**](https://t.me/peass) рдореЗрдВ рдпрд╛ **Twitter** ЁЯРж рдкрд░ рдореБрдЭреЗ **рдлреЙрд▓реЛ** рдХрд░реЗрдВ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВред

</details>

## рдкрд╛рд╕рд╡рд░реНрдб

### рд╢реИрдбреЛ рдкрд╛рд╕рд╡рд░реНрдб

рд╢реИрдбреЛ рдкрд╛рд╕рд╡рд░реНрдб **`/var/db/dslocal/nodes/Default/users/`** рдореЗрдВ рд╕реНрдерд┐рдд plists рдореЗрдВ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХреЗ рд╕рд╛рде рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реЛрддрд╛ рд╣реИред\
рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд oneliner рдХрд╛ рдЙрдкрдпреЛрдЧ **рд╕рднреА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА** (рд╣реИрд╢ рдЬрд╛рдирдХрд╛рд░реА рд╕рд╣рд┐рдд) рдбрдВрдк рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:

{% code overflow="wrap" %}
```bash
for l in /var/db/dslocal/nodes/Default/users/*; do if [ -r "$l" ];then echo "$l"; defaults read "$l"; fi; done
```
```bash
dscl . list /Users | grep -v '^_' | while read user; do echo -n "$user:"; dscl . -read /Users/$user dsAttrTypeNative:ShadowHashData | tr -d ' ' | cut -d '[' -f2 | cut -d ']' -f1 | xxd -r -p | base64; echo; done
```
{% endcode %}

[**рдЗрд╕ рддрд░рд╣ рдХреА рд╕реНрдХреНрд░рд┐рдкреНрдЯреНрд╕**](https://gist.github.com/teddziuba/3ff08bdda120d1f7822f3baf52e606c2) рдпрд╛ [**рдпрд╣ рд╡рд╛рд▓реА**](https://github.com/octomagon/davegrohl.git) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╣реИрд╢ рдХреЛ **hashcat** **рдкреНрд░рд╛рд░реВрдк** рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

рд╕рднреА рдЧреИрд░-рд╕реЗрд╡рд╛ рдЦрд╛рддреЛрдВ рдХреЗ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреЛ hashcat рдкреНрд░рд╛рд░реВрдк `-m 7100` (macOS PBKDF2-SHA512) рдореЗрдВ рдбрдВрдк рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╡реИрдХрд▓реНрдкрд┐рдХ рд╡рди-рд▓рд╛рдЗрдирд░:

{% code overflow="wrap" %}
```bash
sudo bash -c 'for i in $(find /var/db/dslocal/nodes/Default/users -type f -regex "[^_]*"); do plutil -extract name.0 raw $i | awk "{printf \$0\":\$ml\$\"}"; for j in {iterations,salt,entropy}; do l=$(k=$(plutil -extract ShadowHashData.0 raw $i) && base64 -d <<< $k | plutil -extract SALTED-SHA512-PBKDF2.$j raw -); if [[ $j == iterations ]]; then echo -n $l; else base64 -d <<< $l | xxd -p -c 0 | awk "{printf \"$\"\$0}"; fi; done; echo ""; done'
```
{% endcode %}

### Keychain Dump

рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ security рдмрд╛рдЗрдирд░реА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╕рдордп **рдкрд╛рд╕рд╡рд░реНрдбреНрд╕ рдХреЛ рдбрд┐рдХреНрд░рд┐рдкреНрдЯреЗрдб рдХрд░рдХреЗ рдбрдВрдк рдХрд░рдиреЗ** рдХреЗ рд▓рд┐рдП, рдХрдИ рдкреНрд░реЙрдореНрдкреНрдЯреНрд╕ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕реЗ рдЗрд╕ рдСрдкрд░реЗрд╢рди рдХреА рдЕрдиреБрдорддрд┐ рдорд╛рдВрдЧреЗрдВрдЧреЗред
```bash
#security
secuirty dump-trust-settings [-s] [-d] #List certificates
security list-keychains #List keychain dbs
security list-smartcards #List smartcards
security dump-keychain | grep -A 5 "keychain" | grep -v "version" #List keychains entries
security dump-keychain -d #Dump all the info, included secrets (the user will be asked for his password, even if root)
```
### [Keychaindump](https://github.com/juuso/keychaindump)

{% hint style="danger" %}
рдЗрд╕ рдЯрд┐рдкреНрдкрдгреА рдХреЗ рдЖрдзрд╛рд░ рдкрд░ [juuso/keychaindump#10 (рдЯрд┐рдкреНрдкрдгреА)](https://github.com/juuso/keychaindump/issues/10#issuecomment-751218760) рдРрд╕рд╛ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рдпреЗ рдЙрдкрдХрд░рдг Big Sur рдореЗрдВ рдЕрдм рдХрд╛рдо рдирд╣реАрдВ рдХрд░ рд░рд╣реЗ рд╣реИрдВред
{% endhint %}

рд╣рдорд▓рд╛рд╡рд░ рдХреЛ рдЕрднреА рднреА рд╕рд┐рд╕реНрдЯрдо рддрдХ рдкрд╣реБрдБрдЪрдиреЗ рдХреА рдЬрд░реВрд░рдд рд╣реИ рдФрд░ **keychaindump** рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП **root** рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рддрдХ рдмрдврд╝рд╛рдирд╛ рд╣реЛрдЧрд╛ред рдЗрд╕ рджреГрд╖реНрдЯрд┐рдХреЛрдг рдореЗрдВ рдЕрдкрдиреА рд╢рд░реНрддреЗрдВ рд╣реИрдВред рдЬреИрд╕рд╛ рдХрд┐ рдкрд╣рд▓реЗ рдЙрд▓реНрд▓реЗрдЦ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, **рд▓реЙрдЧрд┐рди рдкрд░ рдЖрдкрдХрд╛ рдХреАрдЪреЗрди рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдЕрдирд▓реЙрдХ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ** рдФрд░ рдЬрдм рдЖрдк рдЕрдкрдиреЗ рд╕рд┐рд╕реНрдЯрдо рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ рддреЛ рдЕрдирд▓реЙрдХ рд░рд╣рддрд╛ рд╣реИред рдпрд╣ рд╕реБрд╡рд┐рдзрд╛ рдХреЗ рд▓рд┐рдП рд╣реИ рддрд╛рдХрд┐ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рд╣рд░ рдмрд╛рд░ рдЬрдм рдПрдХ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреАрдЪреЗрди рддрдХ рдкрд╣реБрдБрдЪрдирд╛ рдЪрд╛рд╣рддрд╛ рд╣реИ рддреЛ рдЙрд╕реЗ рдЕрдкрдирд╛ рдкрд╛рд╕рд╡рд░реНрдб рджрд░реНрдЬ рдирд╣реАрдВ рдХрд░рдирд╛ рдкрдбрд╝реЗред рдЕрдЧрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдиреЗ рдЗрд╕ рд╕реЗрдЯрд┐рдВрдЧ рдХреЛ рдмрджрд▓ рджрд┐рдпрд╛ рд╣реИ рдФрд░ рд╣рд░ рдЙрдкрдпреЛрдЧ рдХреЗ рдмрд╛рдж рдХреАрдЪреЗрди рдХреЛ рд▓реЙрдХ рдХрд░рдиреЗ рдХрд╛ рдЪреБрдирд╛рд╡ рдХрд┐рдпрд╛ рд╣реИ, рддреЛ keychaindump рдЕрдм рдХрд╛рдо рдирд╣реАрдВ рдХрд░реЗрдЧрд╛; рдпрд╣ рдПрдХ рдЕрдирд▓реЙрдХ рдХреАрдЪреЗрди рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддрд╛ рд╣реИ рддрд╛рдХрд┐ рдХрд╛рдо рдХрд░ рд╕рдХреЗред

Keychaindump рдХреИрд╕реЗ рдкрд╛рд╕рд╡рд░реНрдб рдХреЛ рдореЗрдореЛрд░реА рд╕реЗ рдирд┐рдХрд╛рд▓рддрд╛ рд╣реИ рдпрд╣ рд╕рдордЭрдирд╛ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИред рдЗрд╕ рд▓реЗрди-рджреЗрди рдореЗрдВ рд╕рдмрд╕реЗ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдкреНрд░рдХреНрд░рд┐рдпрд╛ тАЭ**securityd**тАЬ **рдкреНрд░рдХреНрд░рд┐рдпрд╛** рд╣реИред Apple рдЗрд╕ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ **рдкреНрд░рд╛рдзрд┐рдХрд░рдг рдФрд░ рдХреНрд░рд┐рдкреНрдЯреЛрдЧреНрд░рд╛рдлрд┐рдХ рдСрдкрд░реЗрд╢рдиреЛрдВ рдХреЗ рд▓рд┐рдП рдПрдХ рд╕реБрд░рдХреНрд╖рд╛ рд╕рдВрджрд░реНрдн рдбреЗрдорди** рдХреЗ рд░реВрдк рдореЗрдВ рд╕рдВрджрд░реНрднрд┐рдд рдХрд░рддрд╛ рд╣реИред Apple рдбреЗрд╡рд▓рдкрд░ рд▓рд╛рдЗрдмреНрд░реЗрд░реАрдЬрд╝ рдЗрд╕рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдмрд╣реБрдд рдХреБрдЫ рдирд╣реАрдВ рдмрддрд╛рддреА рд╣реИрдВ; рд╣рд╛рд▓рд╛рдВрдХрд┐, рд╡реЗ рд╣рдореЗрдВ рдмрддрд╛рддреЗ рд╣реИрдВ рдХрд┐ securityd рдХреАрдЪреЗрди рддрдХ рдкрд╣реБрдБрдЪ рдХреЛ рд╕рдВрднрд╛рд▓рддрд╛ рд╣реИред рдЕрдкрдиреЗ рд╢реЛрдз рдореЗрдВ, Juuso рдХреАрдЪреЗрди рдХреЛ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЬрд░реВрд░реА рдХреБрдВрдЬреА рдХреЛ тАЭThe Master KeyтАЬ рдХреЗ рд░реВрдк рдореЗрдВ рд╕рдВрджрд░реНрднрд┐рдд рдХрд░рддрд╛ рд╣реИред рдЗрд╕ рдХреБрдВрдЬреА рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрдИ рдХрджрдо рдЙрдард╛рдиреЗ рдХреА рдЬрд░реВрд░рдд рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ OS X рд▓реЙрдЧрд┐рди рдкрд╛рд╕рд╡рд░реНрдб рд╕реЗ рдирд┐рдХрд╛рд▓рд╛ рдЬрд╛рддрд╛ рд╣реИред рдЕрдЧрд░ рдЖрдк рдХреАрдЪреЗрди рдлрд╛рдЗрд▓ рдХреЛ рдкрдврд╝рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рддреЛ рдЖрдкрдХреЗ рдкрд╛рд╕ рдпрд╣ рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬреА рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдПред рдЗрд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрджрдо рдХрд┐рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВред **securityd рдХреЗ рд╣реАрдк рдХрд╛ рд╕реНрдХреИрди рдХрд░реЗрдВ (keychaindump рдпрд╣ vmmap рдХрдорд╛рдВрдб рдХреЗ рд╕рд╛рде рдХрд░рддрд╛ рд╣реИ)**ред рд╕рдВрднрд╛рд╡рд┐рдд рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬрд┐рдпрд╛рдБ MALLOC\_TINY рдХреЗ рд░реВрдк рдореЗрдВ рдЪрд┐рд╣реНрдирд┐рдд рдХреНрд╖реЗрддреНрд░ рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реЛрддреА рд╣реИрдВред рдЖрдк рдЗрди рд╣реАрдкреНрд╕ рдХреЗ рд╕реНрдерд╛рдиреЛрдВ рдХреЛ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрдорд╛рдВрдб рдХреЗ рд╕рд╛рде рд╕реНрд╡рдпрдВ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
sudo vmmap <securityd PID> | grep MALLOC_TINY
```
**Keychaindump** рддрдм рд╡рд╛рдкрд╕ рдЖрдП рд╣реАрдкреНрд╕ рдореЗрдВ 0x0000000000000018 рдХреА рдШрдЯрдирд╛рдУрдВ рдХреА рдЦреЛрдЬ рдХрд░реЗрдЧрд╛ред рдЕрдЧрд░ рдЕрдЧрд▓рд╛ 8-рдмрд╛рдЗрдЯ рдорд╛рди рд╡рд░реНрддрдорд╛рди рд╣реАрдк рдХреА рдУрд░ рдЗрд╢рд╛рд░рд╛ рдХрд░рддрд╛ рд╣реИ, рддреЛ рд╣рдордиреЗ рдПрдХ рд╕рдВрднрд╛рд╡рд┐рдд рдорд╛рд╕реНрдЯрд░ рдХреА рдкрд╛рдИ рд╣реИред рдпрд╣рд╛рдБ рд╕реЗ рдереЛрдбрд╝рд╛ рдбрд┐рдУрдмреНрдлрд╕реНрдХреЗрд╢рди рдЕрднреА рднреА рд╣реЛрдирд╛ рдЖрд╡рд╢реНрдпрдХ рд╣реИ рдЬреЛ рд╕реЛрд░реНрд╕ рдХреЛрдб рдореЗрдВ рджреЗрдЦрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдПрдХ рд╡рд┐рд╢реНрд▓реЗрд╖рдХ рдХреЗ рд░реВрдк рдореЗрдВ рд╕рдмрд╕реЗ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдмрд╛рдд рдпрд╣ рд╣реИ рдХрд┐ рдЗрд╕ рдЬрд╛рдирдХрд╛рд░реА рдХреЛ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рдбреЗрдЯрд╛ securityd рдХреА рдкреНрд░реЛрд╕реЗрд╕ рдореЗрдореЛрд░реА рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реЛрддрд╛ рд╣реИред рдпрд╣рд╛рдБ keychain dump рдЖрдЙрдЯрдкреБрдЯ рдХрд╛ рдПрдХ рдЙрджрд╛рд╣рд░рдг рд╣реИред
```bash
sudo ./keychaindump
```
### chainbreaker

[**Chainbreaker**](https://github.com/n0fate/chainbreaker) рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреНрд░рдХрд╛рд░ рдХреА рдЬрд╛рдирдХрд╛рд░реА рдХреЛ OSX keychain рд╕реЗ рдлреЛрд░реЗрдВрд╕рд┐рдХ рд░реВрдк рд╕реЗ рд╕рд╣реА рддрд░реАрдХреЗ рд╕реЗ рдирд┐рдХрд╛рд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:

* рд╣реИрд╢реНрдб Keychain рдкрд╛рд╕рд╡рд░реНрдб, [hashcat](https://hashcat.net/hashcat/) рдпрд╛ [John the Ripper](https://www.openwall.com/john/) рдХреЗ рд╕рд╛рде рдХреНрд░реИрдХрд┐рдВрдЧ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреБрдХреНрдд
* рдЗрдВрдЯрд░рдиреЗрдЯ рдкрд╛рд╕рд╡рд░реНрдб
* рдЬреЗрдиреЗрд░рд┐рдХ рдкрд╛рд╕рд╡рд░реНрдб
* рдкреНрд░рд╛рдЗрд╡реЗрдЯ рдХреАрдЬрд╝
* рдкрдмреНрд▓рд┐рдХ рдХреАрдЬрд╝
* X509 рд╕рд░реНрдЯрд┐рдлрд┐рдХреЗрдЯреНрд╕
* рд╕рд┐рдХреНрдпреЛрд░ рдиреЛрдЯреНрд╕
* Appleshare рдкрд╛рд╕рд╡рд░реНрдб

Keychain рдЕрдирд▓реЙрдХ рдкрд╛рд╕рд╡рд░реНрдб, [volafox](https://github.com/n0fate/volafox) рдпрд╛ [volatility](https://github.com/volatilityfoundation/volatility) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкреНрд░рд╛рдкреНрдд рдорд╛рд╕реНрдЯрд░ рдХреА, рдпрд╛ SystemKey рдЬреИрд╕реА рдЕрдирд▓реЙрдХ рдлрд╛рдЗрд▓ рджреА рдЧрдИ рд╣реЛ, рддреЛ Chainbreaker рдкреНрд▓реЗрдирдЯреЗрдХреНрд╕реНрдЯ рдкрд╛рд╕рд╡рд░реНрдб рднреА рдкреНрд░рджрд╛рди рдХрд░реЗрдЧрд╛ред

рдЗрдирдореЗрдВ рд╕реЗ рдХрд┐рд╕реА рднреА рддрд░реАрдХреЗ рд╕реЗ Keychain рдХреЛ рдЕрдирд▓реЙрдХ рдХрд┐рдП рдмрд┐рдирд╛, Chainbreaker рд╕рднреА рдЕрдиреНрдп рдЙрдкрд▓рдмреНрдз рдЬрд╛рдирдХрд╛рд░реА рджрд┐рдЦрд╛рдПрдЧрд╛ред

### **Dump keychain keys**
```bash
#Dump all keys of the keychain (without the passwords)
python2.7 chainbreaker.py --dump-all /Library/Keychains/System.keychain
```
### **SystemKey рдХреЗ рд╕рд╛рде keychain рдХреБрдВрдЬрд┐рдпреЛрдВ (рдкрд╛рд╕рд╡рд░реНрдб рдХреЗ рд╕рд╛рде) рдХрд╛ рдбрдВрдк**
```bash
# First, get the keychain decryption key
# To get this decryption key you need to be root and SIP must be disabled
hexdump -s 8 -n 24 -e '1/1 "%.2x"' /var/db/SystemKey && echo
## Use the previous key to decrypt the passwords
python2.7 chainbreaker.py --dump-all --key 0293847570022761234562947e0bcd5bc04d196ad2345697 /Library/Keychains/System.keychain
```
### **рдХреАрдЪреЗрди рдХреБрдВрдЬрд┐рдпреЛрдВ рдХреЛ рдбрдВрдк рдХрд░рдирд╛ (рдкрд╛рд╕рд╡рд░реНрдб рдХреЗ рд╕рд╛рде) рд╣реИрд╢ рдХреЛ рдХреНрд░реИрдХ рдХрд░рдирд╛**
```bash
# Get the keychain hash
python2.7 chainbreaker.py --dump-keychain-password-hash /Library/Keychains/System.keychain
# Crack it with hashcat
hashcat.exe -m 23100 --keep-guessing hashes.txt dictionary.txt
# Use the key to decrypt the passwords
python2.7 chainbreaker.py --dump-all --key 0293847570022761234562947e0bcd5bc04d196ad2345697 /Library/Keychains/System.keychain
```
### **рдореЗрдореЛрд░реА рдбрдВрдк рдХреЗ рд╕рд╛рде keychain рдХреБрдВрдЬрд┐рдпреЛрдВ (рдкрд╛рд╕рд╡рд░реНрдб рдХреЗ рд╕рд╛рде) рдХреЛ рдбрдВрдк рдХрд░реЗрдВ**

[рдЗрди рдЪрд░рдгреЛрдВ рдХрд╛ рдкрд╛рд▓рди рдХрд░реЗрдВ](..#dumping-memory-with-osxpmem) **рдореЗрдореЛрд░реА рдбрдВрдк** рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП
```bash
#Use volafox (https://github.com/n0fate/volafox) to extract possible keychain passwords
# Unformtunately volafox isn't working with the latest versions of MacOS
python vol.py -i ~/Desktop/show/macosxml.mem -o keychaindump

#Try to extract the passwords using the extracted keychain passwords
python2.7 chainbreaker.py --dump-all --key 0293847570022761234562947e0bcd5bc04d196ad2345697 /Library/Keychains/System.keychain
```
### **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдкрд╛рд╕рд╡рд░реНрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ keychain рдХреБрдВрдЬрд┐рдпреЛрдВ рдХреЛ рдбрдВрдк рдХрд░реЗрдВ (рдкрд╛рд╕рд╡рд░реНрдб рдХреЗ рд╕рд╛рде)**

рдпрджрд┐ рдЖрдк рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХрд╛ рдкрд╛рд╕рд╡рд░реНрдб рдЬрд╛рдирддреЗ рд╣реИрдВ рддреЛ рдЖрдк рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд╕рдВрдмрдВрдзрд┐рдд keychain рдХреЛ рдбрдВрдк рдХрд░рдиреЗ рдФрд░ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ** рдХреЗ рд▓рд┐рдП рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
```bash
#Prompt to ask for the password
python2.7 chainbreaker.py --dump-all --password-prompt /Users/<username>/Library/Keychains/login.keychain-db
```
### kcpassword

**kcpassword** рдлрд╝рд╛рдЗрд▓ рдПрдХ рдРрд╕реА рдлрд╝рд╛рдЗрд▓ рд╣реИ рдЬрд┐рд╕рдореЗрдВ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХрд╛ рд▓реЙрдЧрд┐рди рдкрд╛рд╕рд╡рд░реНрдб** рд╣реЛрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдХреЗрд╡рд▓ рддрдм рдЬрдм рд╕рд┐рд╕реНрдЯрдо рдХреЗ рдорд╛рд▓рд┐рдХ рдиреЗ **рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд▓реЙрдЧрд┐рди рд╕рдХреНрд╖рдо** рдХрд┐рдпрд╛ рд╣реЛред рдЗрд╕рд▓рд┐рдП, рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдмрд┐рдирд╛ рдкрд╛рд╕рд╡рд░реНрдб рдорд╛рдВрдЧреЗ рд╕реНрд╡рддрдГ рд╣реА рд▓реЙрдЧ рдЗрди рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ (рдЬреЛ рдХрд┐ рдмрд╣реБрдд рд╕реБрд░рдХреНрд╖рд┐рдд рдирд╣реАрдВ рд╣реИ)ред

рдкрд╛рд╕рд╡рд░реНрдб рдлрд╝рд╛рдЗрд▓ **`/etc/kcpassword`** рдореЗрдВ рдХреА **`0x7D 0x89 0x52 0x23 0xD2 0xBC 0xDD 0xEA 0xA3 0xB9 0x1F`** рдХреЗ рд╕рд╛рде xored рд╣реЛрддрд╛ рд╣реИред рдЕрдЧрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХрд╛ рдкрд╛рд╕рд╡рд░реНрдб рдХреА рд╕реЗ рд▓рдВрдмрд╛ рд╣реЛрддрд╛ рд╣реИ, рддреЛ рдХреА рдХрд╛ рдкреБрди: рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред\
рдЗрд╕рд╕реЗ рдкрд╛рд╕рд╡рд░реНрдб рдХреЛ рдкреБрдирдГ рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рдХрд╛рдлреА рдЖрд╕рд╛рди рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП [**рдЗрд╕ рд╕реНрдХреНрд░рд┐рдкреНрдЯ**](https://gist.github.com/opshope/32f65875d45215c3677d) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗред

## рдбреЗрдЯрд╛рдмреЗрд╕ рдореЗрдВ рд░реЛрдЪрдХ рдЬрд╛рдирдХрд╛рд░реА

### Messages
```bash
sqlite3 $HOME/Library/Messages/chat.db .tables
sqlite3 $HOME/Library/Messages/chat.db 'select * from message'
sqlite3 $HOME/Library/Messages/chat.db 'select * from attachment'
sqlite3 $HOME/Library/Messages/chat.db 'select * from deleted_messages'
sqlite3 $HOME/Suggestions/snippets.db 'select * from emailSnippets'
```
### рд╕реВрдЪрдирд╛рдПрдВ

рдЖрдк рд╕реВрдЪрдирд╛рдУрдВ рдХрд╛ рдбреЗрдЯрд╛ `$(getconf DARWIN_USER_DIR)/com.apple.notificationcenter/` рдореЗрдВ рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВред

рдЕрдзрд┐рдХрд╛рдВрд╢ рд░реЛрдЪрдХ рдЬрд╛рдирдХрд╛рд░реА **blob** рдореЗрдВ рд╣реЛрдЧреАред рдЗрд╕рд▓рд┐рдП рдЖрдкрдХреЛ рдЙрд╕ рд╕рд╛рдордЧреНрд░реА рдХреЛ **рдирд┐рдХрд╛рд▓рдирд╛** рд╣реЛрдЧрд╛ рдФрд░ рдЙрд╕реЗ **рдорд╛рдирд╡** **рдкрдардиреАрдп** рд░реВрдк рдореЗрдВ **рдкрд░рд┐рд╡рд░реНрддрд┐рдд** рдХрд░рдирд╛ рд╣реЛрдЧрд╛ рдпрд╛ **`strings`** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред рдЗрд╕реЗ рдПрдХреНрд╕реЗрд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдк рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

{% code overflow="wrap" %}
```bash
cd $(getconf DARWIN_USER_DIR)/com.apple.notificationcenter/
strings $(getconf DARWIN_USER_DIR)/com.apple.notificationcenter/db2/db | grep -i -A4 slack
```
### рдиреЛрдЯреНрд╕

рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ **рдиреЛрдЯреНрд╕** `~/Library/Group Containers/group.com.apple.notes/NoteStore.sqlite` рдореЗрдВ рдкрд╛рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВред

{% code overflow="wrap" %}
```bash
sqlite3 ~/Library/Group\ Containers/group.com.apple.notes/NoteStore.sqlite .tables

#To dump it in a readable format:
for i in $(sqlite3 ~/Library/Group\ Containers/group.com.apple.notes/NoteStore.sqlite "select Z_PK from ZICNOTEDATA;"); do sqlite3 ~/Library/Group\ Containers/group.com.apple.notes/NoteStore.sqlite "select writefile('body1.gz.z', ZDATA) from ZICNOTEDATA where Z_PK = '$i';"; zcat body1.gz.Z ; done
```
<details>

<summary><strong>рд╢реВрдиреНрдп рд╕реЗ рдирд╛рдпрдХ рддрдХ AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ**, рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* ЁЯТм [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ [**telegram рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ рдпрд╛ **Twitter** ЁЯРж рдкрд░ рдореБрдЭреЗ **рдлреЙрд▓реЛ** рдХрд░реЗрдВ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github рд░реЗрдкреЛрдЬрд╝ рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВред

</details>
