# macOS Office рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдмрд╛рдпрдкрд╛рд╕

<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди **HackTricks рдореЗрдВ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб** рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* рд╣рдорд╛рд░рд╛ рд╕рдВрдЧреНрд░рд╣ [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдЦреЛрдЬреЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** рдкрд░ **рдлреЙрд▓реЛ** рдХрд░реЗрдВ ЁЯРж [**@carlospolopm**](https://twitter.com/hacktricks_live)**ред**
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ** рджреНрд╡рд╛рд░рд╛ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

### рд╢рдмреНрдж рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдмрд╛рдпрдкрд╛рд╕ Launch Agents рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ

рдПрдкреНрд▓рд┐рдХреЗрд╢рди **рдХрд╕реНрдЯрдо рд╕реИрдВрдбрдмреЙрдХреНрд╕** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ **`com.apple.security.temporary-exception.sbpl`** рдЗрдВрдЯрд╛рдЗрдЯрд▓рдореЗрдВрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдпрд╣ рдХрд╕реНрдЯрдо рд╕реИрдВрдбрдмреЙрдХреНрд╕ `~$` рд╕реЗ рд╢реБрд░реВ рд╣реЛрдиреЗ рд╡рд╛рд▓реЗ рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ рд▓рд┐рдЦрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ: `(require-any (require-all (vnode-type REGULAR-FILE) (regex #"(^|/)~$[^/]+$")))`

рдЗрд╕рд▓рд┐рдП, рдмрд╛рд╣рд░ рдирд┐рдХрд▓рдирд╛ **`plist`** LaunchAgent рдореЗрдВ рд▓рд┐рдЦрдирд╛ рдЗрддрдирд╛ рдЖрд╕рд╛рди рдерд╛: `~/Library/LaunchAgents/~$escape.plist`ред

[**рдореВрд▓ рд░рд┐рдкреЛрд░реНрдЯ рдпрд╣рд╛рдБ рджреЗрдЦреЗрдВ**](https://www.mdsec.co.uk/2018/08/escaping-the-sandbox-microsoft-office-on-macos/).

### рд╢рдмреНрдж рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдмрд╛рдпрдкрд╛рд╕ Login Items рдФрд░ zip рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ

рдкрд╣рд▓реЗ рдмрд╛рдпрдкрд╛рд╕ рд╕реЗ рдпрд╛рдж рд░рдЦреЗрдВ, Word рдХрд┐рд╕реА рднреА рдлрд╝рд╛рдЗрд▓ рдХреЛ рд▓рд┐рдЦ рд╕рдХрддрд╛ рд╣реИ рдЬрд┐рд╕рдХрд╛ рдирд╛рдо `~$` рд╕реЗ рд╢реБрд░реВ рд╣реЛрддрд╛ рд╣реИ рд╣рд╛рд▓рд╛рдВрдХрд┐ рдкрд┐рдЫрд▓реЗ vuln рдХреЗ рдкреИрдЪ рдХреЗ рдмрд╛рдж `/Library/Application Scripts` рдпрд╛ `/Library/LaunchAgents` рдореЗрдВ рд▓рд┐рдЦрдирд╛ рд╕рдВрднрд╡ рдирд╣реАрдВ рдерд╛ред

рд╕рд╛рдмрд┐рдд рд╣реБрдЖ рдХрд┐ рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдХреЗ рдЕрдВрджрд░ рд╕реЗ рдПрдХ **рд▓реЙрдЧрд┐рди рдЖрдЗрдЯрдо** (рдПрдкреНрд╕ рдЬреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд▓реЙрдЧ рдЗрди рдХрд░рддреЗ рд╕рдордп рдЪрд▓рд╛рдП рдЬрд╛рдПрдВрдЧреЗ) рдмрдирд╛рдирд╛ рд╕рдВрднрд╡ рд╣реИред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдпреЗ рдПрдкреНрд╕ **рдХреЗрд╡рд▓ рддрднреА рдЪрд▓реЗрдВрдЧреЗ рдЬрдм** рд╡реЗ **рдиреЛрдЯрд░рд╛рдЗрдЬрд╝реНрдб** рд╣реЛрдВрдЧреЗ рдФрд░ **рдПрд░реНрдЧреНрд╕ рдЬреЛрдбрд╝рдирд╛ рд╕рдВрднрд╡ рдирд╣реАрдВ** рд╣реИ (рддреЛ рдЖрдк **`bash`** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдмрд╕ рдПрдХ рд░рд┐рд╡рд░реНрд╕ рд╢реИрд▓ рдирд╣реАрдВ рдЪрд▓рд╛ рд╕рдХрддреЗ рд╣реИрдВ)ред

рдкрд┐рдЫрд▓реЗ рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдмрд╛рдпрдкрд╛рд╕ рд╕реЗ, Microsoft рдиреЗ `~/Library/LaunchAgents` рдореЗрдВ рдлрд╝рд╛рдЗрд▓реЗрдВ рд▓рд┐рдЦрдиреЗ рдХрд╛ рд╡рд┐рдХрд▓реНрдк рдЕрдХреНрд╖рдо рдХрд░ рджрд┐рдпрд╛ рдерд╛ред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдкрд╛рдпрд╛ рдЧрдпрд╛ рдХрд┐ рдЕрдЧрд░ рдЖрдк рдПрдХ **zip рдлрд╝рд╛рдЗрд▓ рдХреЛ рд▓реЙрдЧрд┐рди рдЖрдЗрдЯрдо рдХреЗ рд░реВрдк рдореЗрдВ рдбрд╛рд▓рддреЗ рд╣реИрдВ** рддреЛ `Archive Utility` рдЙрд╕реЗ рдЕрдкрдиреЗ рд╡рд░реНрддрдорд╛рди рд╕реНрдерд╛рди рдкрд░ **рдЕрдирдЬрд╝рд┐рдк** рдХрд░ рджреЗрдЧрд╛ред рдЗрд╕рд▓рд┐рдП, рдХреНрдпреЛрдВрдХрд┐ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ `~/Library` рдХреЗ `LaunchAgents` рдлрд╝реЛрд▓реНрдбрд░ рдирд╣реАрдВ рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдЗрд╕реЗ рд╕рдВрдзрд╛рд░рд┐рдд рд╕реНрдерд╛рди рддрдХ рдкрд╣реБрдВрдЪрд╛рдиреЗ рдХреЗ рд▓рд┐рдП **`LaunchAgents/~$escape.plist` рдореЗрдВ рдПрдХ plist рдЬрд╝рд┐рдк рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рдерд╛** рдФрд░ **`~/Library`** рдореЗрдВ рдЬрд╝рд┐рдк рдлрд╝рд╛рдЗрд▓ рд░рдЦ рджреА рдЬрд╛ рд╕рдХрддреА рдереА рддрд╛рдХрд┐ рдЬрдм рдЗрд╕реЗ рдбреАрдХрдВрдкреНрд░реЗрд╕ рдХрд┐рдпрд╛ рдЬрд╛рдП, рд╡рд╣ рд╕реНрдерд╛рдпрд┐рддрд┐ рдЧрдВрддрд╡реНрдп рддрдХ рдкрд╣реБрдВрдЪреЗрдЧрд╛ред

[**рдореВрд▓ рд░рд┐рдкреЛрд░реНрдЯ рдпрд╣рд╛рдБ рджреЗрдЦреЗрдВ**](https://objective-see.org/blog/blog\_0x4B.html).

### рд╢рдмреНрдж рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдмрд╛рдпрдкрд╛рд╕ Login Items рдФрд░ .zshenv рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ

(рдкрд╣рд▓реЗ рдмрд╛рдпрдкрд╛рд╕ рд╕реЗ рдпрд╛рдж рд░рдЦреЗрдВ, Word рдХрд┐рд╕реА рднреА рдлрд╝рд╛рдЗрд▓ рдХреЛ рд▓рд┐рдЦ рд╕рдХрддрд╛ рд╣реИ рдЬрд┐рд╕рдХрд╛ рдирд╛рдо `~$` рд╕реЗ рд╢реБрд░реВ рд╣реЛрддрд╛ рд╣реИ)ред

рд╣рд╛рд▓рд╛рдВрдХрд┐, рдкрд┐рдЫрд▓реА рддрдХрдиреАрдХ рдХреА рдПрдХ рд╕реАрдорд╛ рдереА, рдпрджрд┐ рдлрд╝реЛрд▓реНрдбрд░ **`~/Library/LaunchAgents`** рдореМрдЬреВрдж рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдХреБрдЫ рдЕрдиреНрдп рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ рдиреЗ рдЗрд╕реЗ рдмрдирд╛рдпрд╛ рд╣реИ, рддреЛ рдпрд╣ рд╡рд┐рдлрд▓ рд╣реЛ рдЬрд╛рдПрдЧрд╛ред рдЗрд╕рдХреЗ рд▓рд┐рдП рдЗрд╕рдХреЗ рд▓рд┐рдП рдПрдХ рд╡рд┐рднрд┐рдиреНрди рд▓реЙрдЧрд┐рди рдЖрдЗрдЯрдо рд╢реНрд░реГрдВрдЦрд▓рд╛ рдЗрд╕рдХреЗ рд▓рд┐рдП рдЦреЛрдЬреА рдЧрдИ рдереАред

рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдлрд╝рд╛рдЗрд▓реЗрдВ рдмрдирд╛ рд╕рдХрддрд╛ рдерд╛ **`.bash_profile`** рдФрд░ **`.zshenv`** рдЬрд┐рд╕рдореЗрдВ рдкреЗрд▓реЛрдб рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдФрд░ рдлрд┐рд░ рдЙрдиреНрд╣реЗрдВ рдЬрд╝рд┐рдк рдХрд░рдХреЗ рдФрд░ **рдЬрд╝рд┐рдк рдлрд╝рд╛рдЗрд▓ рдХреЛ рдкреАрдбрд╝рд┐рддреЛрдВ** рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдлрд╝реЛрд▓реНрдбрд░ рдореЗрдВ рд▓рд┐рдЦрдиреЗ рдХреЗ рд▓рд┐рдП: **`~/~$escape.zip`**ред

рдлрд┐рд░, рдЬрд╝рд┐рдк рдлрд╝рд╛рдЗрд▓ рдХреЛ **рд▓реЙрдЧрд┐рди рдЖрдЗрдЯрдо** рдореЗрдВ рдЬреЛрдбрд╝реЗрдВ рдФрд░ рдлрд┐рд░ **`Terminal`** рдПрдкреНрд▓рд┐рдХреЗрд╢рдиред рдЬрдм рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдлрд┐рд░ рд╕реЗ рд▓реЙрдЧ рдЗрди рдХрд░рддрд╛ рд╣реИ, рддреЛ рдЬрд╝рд┐рдк рдлрд╝рд╛рдЗрд▓ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдЕрдирдХрдВрдкреНрд░реЗрд╕ рд╣реЛ рдЬрд╛рдПрдЧрд╛, **`.bash_profile`** рдФрд░ **`.zshenv`** рдХреЛ рдЕрдзрд┐рд▓реЗрдЦрд┐рдд рдХрд░рдХреЗ рдФрд░ рдЗрд╕рд▓рд┐рдП, рдЯрд░реНрдорд┐рдирд▓ рдПрдХ рдЗрдирдореЗрдВ рд╕реЗ рдПрдХ рдлрд╝рд╛рдЗрд▓ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдЧрд╛ (рдпрд╣ рдмрд╛рд╢ рдпрд╛ zsh рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ рдЗрд╕ рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддрд╛ рд╣реИ)ред

[**рдореВрд▓ рд░рд┐рдкреЛрд░реНрдЯ рдпрд╣рд╛рдБ рджреЗрдЦреЗрдВ**](https://desi-jarvis.medium.com/office365-macos-sandbox-escape-fcce4fa4123c).

### Open рдФрд░ env variables рдХреЗ рд╕рд╛рде рд╢рдмреНрдж рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдмрд╛рдпрдкрд╛рд╕

рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рд╕реЗ рдЕрдиреНрдп рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЛ **`open`** рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЖрдордВрддреНрд░рд┐рдд рдХрд░рдирд╛ рднреА рд╕рдВрднрд╡ рд╣реИред рдЗрд╕рдХреЗ рдЕрддрд┐рд░рд┐рдХреНрдд, рдпреЗ рдкреНрд░рдХреНрд░рд┐рдпрд╛рдПрдБ **рдЕрдкрдиреЗ рдЦреБрдж рдХреЗ рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдХреЗ рдЕрдВрджрд░ рдЪрд▓реЗрдВрдЧреА**ред

рдкрд╛рдпрд╛ рдЧрдпрд╛ рдХрд┐ open рдпреВрдЯрд┐рд▓рд┐рдЯреА рдореЗрдВ **`--env`** рд╡рд┐рдХрд▓реНрдк рд╣реИ рдПрдХ рдРрдк рдХреЛ **рдирд┐рд╢реНрдЪрд┐рдд env** рд╡реЗрд░рд┐рдПрдмрд▓реНрд╕ рдХреЗ рд╕рд╛рде рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдПред рдЗрд╕рд▓рд┐рдП, рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдХреЗ рдЕрдВрджрд░ рдПрдХ рдлрд╝реЛрд▓реНрдбрд░ рдХреЗ рднреАрддрд░ **`.zshenv` рдлрд╝рд╛рдЗрд▓** рдмрдирд╛рдирд╛ рд╕рдВрднрд╡ рдерд╛ рдФрд░ `open` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ `--env` рдХреЗ рд╕реЗрдЯрд┐рдВрдЧ рдХреЗ рд╕рд╛рде `HOME` рд╡реЗрд░рд┐рдПрдмрд▓ рдХреЛ рдЙрд╕ рдлрд╝реЛрд▓реНрдбрд░ рдореЗрдВ рд╕реЗрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░рдирд╛ рдерд╛ рдЬрд┐рд╕рд╕реЗ рд╡рд╣ `Terminal` рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдЦреЛрд▓реЗрдЧрд╛, рдЬреЛ `.zshenv` рдлрд╝рд╛рдЗрд▓ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдЧрд╛ (рдХреБрдЫ рдХрд╛рд░рдгреЛрдВ рд╕реЗ рдЗрд╕реЗ рд╡рд░реНрдЪреБрдЕрд▓ `__OSINSTALL_ENVIROMENT` рднреА рд╕реЗрдЯ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдереА)ред

[**рдореВрд▓ рд░рд┐рдкреЛрд░реНрдЯ рдпрд╣рд╛рдБ рджреЗрдЦреЗрдВ**](https://perception-point.io/blog/technical-analysis-of-cve-2021-30864/).

### Open рдФрд░ stdin рдХреЗ рд╕рд╛рде рд╢рдмреНрдж рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдмрд╛рдпрдкрд╛рд╕

**`open`** рдпреВрдЯрд┐рд▓рд┐рдЯреА рдиреЗ рднреА **`--stdin`** рдкреИрд░рд╛рдореАрдЯрд░ рдХрд╛ рд╕рдорд░реНрдерди рдХрд┐рдпрд╛ (рдФрд░ рдкрд┐рдЫрд▓реЗ рдмрд╛рдпрдкрд╛рд╕ рдХреЗ рдмрд╛рдж `--env` рдХрд╛ рдЙрдкрдпреЛрдЧ рд╕рдВрднрд╡ рдирд╣реАрдВ рдерд╛)ред

рдмрд╛рдд рдпрд╣ рд╣реИ рдХрд┐ рдпрджрд┐ **`python`** рдХреЛ Apple рджреНрд╡рд╛рд░рд╛ рд╕рд╛рдЗрди рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛, рддреЛ рдпрд╣ **`quarantine`** рдЧреБрдгрдзрд░реНрдо рдХреЗ рд╕рд╛рде рдПрдХ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЛ рдирд╣реАрдВ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдЧрд╛ред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЗрд╕реЗ stdin рд╕реЗ рдПрдХ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдкрд╛рд╕ рдХрд░рдирд╛ рд╕рдВрднрд╡ рдерд╛ рддрд╛рдХрд┐ рдпрд╣ рдпрд╣ рдЬрд╛рдВрдЪ рди рдХрд░реЗ рдХрд┐ рдпрд╣ рдХреНрд╡рд╛рд░рдВрдЯрд╛рдЗрди рд╣реИ рдпрд╛ рдирд╣реАрдВ:&#x20;

1. рдПрдХ **`~$exploit.py`** рдлрд╝рд╛рдЗрд▓ рдбреНрд░реЙрдк рдХрд░реЗрдВ рдЬрд┐рд╕рдореЗрдВ рд╡рд┐рдЪрд┐рдд Python рдХрдорд╛рдВрдб рд╣реЛрдВред
2. рдЪрд▓рд╛рдПрдВ _open_ **`тАУstdin='~$exploit.py' -a Python`**, рдЬреЛ рд╣рдорд╛рд░реА рдбреНрд░реЙрдк рдХреА рдЧрдИ рдлрд╝рд╛рдЗрд▓ рдХреЗ рд╕рд╛рде рдкрд╛рдЗрдерди рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рдЪрд▓рд╛рддрд╛ рд╣реИ рдЬреЛ рдЗрд╕рдХреЗ рдорд╛рдирдХ рдЗрдирдкреБрдЯ рдХреЗ рд░реВрдк рдореЗрдВ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИред рдкрд╛рдЗрдерди рдЦреБрд╢реА рд╕реЗ рд╣рдорд╛рд░рд╛ рдХреЛрдб рдЪрд▓рд╛рддрд╛ рд╣реИ,
