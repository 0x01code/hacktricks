# macOS Office Sandbox Bypasses

<details>

<summary><strong>AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рд╢реВрдиреНрдп рд╕реЗ рд▓реЗрдХрд░ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ**, рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рдХрд╛ рд╕рдВрдЧреНрд░рд╣
* ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ [**telegram group**](https://t.me/peass) рдореЗрдВ рдпрд╛ **Twitter** ЁЯРж рдкрд░ рдореБрдЭреЗ **рдлреЙрд▓реЛ** рдХрд░реЗрдВ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **HackTricks** рдХреЗ [**github repos**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВред

</details>

### Word Sandbox рдХреЛ Launch Agents рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдирд╛

рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдПрдХ **рдХрд╕реНрдЯрдо Sandbox** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ **`com.apple.security.temporary-exception.sbpl`** рдПрдВрдЯрд╛рдЗрдЯрд▓рдореЗрдВрдЯ рд╣реЛрддрд╛ рд╣реИ рдФрд░ рдпрд╣ рдХрд╕реНрдЯрдо рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдлрд╛рдЗрд▓реЛрдВ рдХреЛ рдХрд╣реАрдВ рднреА рд▓рд┐рдЦрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ рдмрд╢рд░реНрддреЗ рдлрд╛рдЗрд▓рдирд╛рдо `~$` рд╕реЗ рд╢реБрд░реВ рд╣реЛ: `(require-any (require-all (vnode-type REGULAR-FILE) (regex #"(^|/)~$[^/]+$")))`

рдЗрд╕рд▓рд┐рдП, рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдирд╛ рдЙрддрдирд╛ рд╣реА рдЖрд╕рд╛рди рдерд╛ рдЬрд┐рддрдирд╛ рдХрд┐ **`plist` LaunchAgent** рдХреЛ `~/Library/LaunchAgents/~$escape.plist` рдореЗрдВ **рд▓рд┐рдЦрдирд╛**ред

[**рдореВрд▓ рд░рд┐рдкреЛрд░реНрдЯ рдпрд╣рд╛рдБ рджреЗрдЦреЗрдВ**](https://www.mdsec.co.uk/2018/08/escaping-the-sandbox-microsoft-office-on-macos/).

### Word Sandbox рдХреЛ Login Items рдФрд░ zip рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдирд╛

рдпрд╛рдж рд░рдЦреЗрдВ рдХрд┐ рдкрд╣рд▓реЗ рдПрд╕реНрдХреЗрдк рд╕реЗ, Word рдРрд╕реА рдордирдорд╛рдиреА рдлрд╛рдЗрд▓реЗрдВ рд▓рд┐рдЦ рд╕рдХрддрд╛ рд╣реИ рдЬрд┐рдирдХрд╛ рдирд╛рдо `~$` рд╕реЗ рд╢реБрд░реВ рд╣реЛрддрд╛ рд╣реИ рд╣рд╛рд▓рд╛рдВрдХрд┐ рдкрд┐рдЫрд▓реЗ рд╡рд▓реНрди рдХреЗ рдкреИрдЪ рдХреЗ рдмрд╛рдж `/Library/Application Scripts` рдпрд╛ `/Library/LaunchAgents` рдореЗрдВ рд▓рд┐рдЦрдирд╛ рд╕рдВрднрд╡ рдирд╣реАрдВ рдерд╛ред

рдпрд╣ рдкрддрд╛ рдЪрд▓рд╛ рдХрд┐ рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдХреЗ рднреАрддрд░ рд╕реЗ **Login Item** рдмрдирд╛рдирд╛ рд╕рдВрднрд╡ рд╣реИ (рдРрдкреНрд╕ рдЬреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд▓реЙрдЧ рдЗрди рдХрд░рдиреЗ рдкрд░ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрдВрдЧреЗ)ред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдпреЗ рдРрдкреНрд╕ **рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдирд╣реАрдВ рд╣реЛрдВрдЧреЗ рдЬрдм рддрдХ** рд╡реЗ **notarized рдирд╣реАрдВ рд╣реЛрддреЗ** рдФрд░ **args рдЬреЛрдбрд╝рдирд╛ рд╕рдВрднрд╡ рдирд╣реАрдВ рд╣реИ** (рдЗрд╕рд▓рд┐рдП рдЖрдк рд╕рд┐рд░реНрдл **`bash`** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд░рд┐рд╡рд░реНрд╕ рд╢реЗрд▓ рдирд╣реАрдВ рдЪрд▓рд╛ рд╕рдХрддреЗ)ред

рдкрд┐рдЫрд▓реЗ Sandbox рдмрд╛рдпрдкрд╛рд╕ рд╕реЗ, Microsoft рдиреЗ `~/Library/LaunchAgents` рдореЗрдВ рдлрд╛рдЗрд▓реЗрдВ рд▓рд┐рдЦрдиреЗ рдХрд╛ рд╡рд┐рдХрд▓реНрдк рдЕрдХреНрд╖рдо рдХрд░ рджрд┐рдпрд╛ рдерд╛ред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдпрд╣ рдкрддрд╛ рдЪрд▓рд╛ рдХрд┐ рдпрджрд┐ рдЖрдк **Login Item рдХреЗ рд░реВрдк рдореЗрдВ рдПрдХ zip рдлрд╛рдЗрд▓** рдбрд╛рд▓рддреЗ рд╣реИрдВ рддреЛ `Archive Utility` рдмрд╕ рдЙрд╕реЗ рдЙрд╕рдХреЗ рд╡рд░реНрддрдорд╛рди рд╕реНрдерд╛рди рдкрд░ **unzip** рдХрд░ рджреЗрдЧрд╛ред рдЗрд╕рд▓рд┐рдП, рдЪреВрдВрдХрд┐ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ `~/Library` рд╕реЗ `LaunchAgents` рдлреЛрд▓реНрдбрд░ рдирд╣реАрдВ рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП **`LaunchAgents/~$escape.plist` рдореЗрдВ рдПрдХ plist рдХреЛ zip рдХрд░рдирд╛** рдФрд░ **`~/Library` рдореЗрдВ zip рдлрд╛рдЗрд▓ рдХреЛ рд░рдЦрдирд╛** рд╕рдВрднрд╡ рдерд╛ рддрд╛рдХрд┐ рдЬрдм рдбрд┐рдХрдВрдкреНрд░реЗрд╕ рдХрд┐рдпрд╛ рдЬрд╛рдП рддреЛ рдпрд╣ рдкрд░реНрд╕рд┐рд╕реНрдЯреЗрдВрд╕ рдбреЗрд╕реНрдЯрд┐рдиреЗрд╢рди рддрдХ рдкрд╣реБрдБрдЪ рдЬрд╛рдПред

[**рдореВрд▓ рд░рд┐рдкреЛрд░реНрдЯ рдпрд╣рд╛рдБ рджреЗрдЦреЗрдВ**](https://objective-see.org/blog/blog\_0x4B.html).

### Word Sandbox рдХреЛ Login Items рдФрд░ .zshenv рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдирд╛

(рдпрд╛рдж рд░рдЦреЗрдВ рдХрд┐ рдкрд╣рд▓реЗ рдПрд╕реНрдХреЗрдк рд╕реЗ, Word рдордирдорд╛рдиреА рдлрд╛рдЗрд▓реЗрдВ рд▓рд┐рдЦ рд╕рдХрддрд╛ рд╣реИ рдЬрд┐рдирдХрд╛ рдирд╛рдо `~$` рд╕реЗ рд╢реБрд░реВ рд╣реЛрддрд╛ рд╣реИ)ред

рд╣рд╛рд▓рд╛рдВрдХрд┐, рдкрд┐рдЫрд▓реА рддрдХрдиреАрдХ рдореЗрдВ рдПрдХ рд╕реАрдорд╛ рдереА, рдЕрдЧрд░ рдлреЛрд▓реНрдбрд░ **`~/Library/LaunchAgents`** рдореМрдЬреВрдж рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдХрд┐рд╕реА рдЕрдиреНрдп рд╕реЙрдлреНрдЯрд╡реЗрдпрд░ рдиреЗ рдЗрд╕реЗ рдмрдирд╛рдпрд╛ рд╣реИ, рддреЛ рдпрд╣ рд╡рд┐рдлрд▓ рд╣реЛ рдЬрд╛рдПрдЧрд╛ред рдЗрд╕рдХреЗ рд▓рд┐рдП рдПрдХ рдЕрд▓рдЧ Login Items рдЪреЗрди рдХреА рдЦреЛрдЬ рдХреА рдЧрдИ рдереАред

рдПрдХ рд╣рдорд▓рд╛рд╡рд░ **`.bash_profile`** рдФрд░ **`.zshenv`** рдлрд╛рдЗрд▓реЗрдВ рдмрдирд╛ рд╕рдХрддрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдкреЗрд▓реЛрдб рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣реЛрддрд╛ рд╣реИ рдФрд░ рдлрд┐рд░ рдЙрдиреНрд╣реЗрдВ рдЬрд╝рд┐рдк рдХрд░рдХреЗ рдФрд░ **рдкреАрдбрд╝рд┐рдд рдХреЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдлреЛрд▓реНрдбрд░ рдореЗрдВ рдЬрд╝рд┐рдк рд▓рд┐рдЦ рд╕рдХрддрд╛ рд╣реИ**: **`~/~$escape.zip`**ред

рдлрд┐рд░, **Login Items** рдореЗрдВ рдЬрд╝рд┐рдк рдлрд╛рдЗрд▓ рдЬреЛрдбрд╝реЗрдВ рдФрд░ рдлрд┐рд░ **`Terminal`** рдРрдкред рдЬрдм рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдлрд┐рд░ рд╕реЗ рд▓реЙрдЧрд┐рди рдХрд░рддрд╛ рд╣реИ, рдЬрд╝рд┐рдк рдлрд╛рдЗрд▓ рдХреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреА рдлрд╛рдЗрд▓ рдореЗрдВ рдЕрдирдЬрд╝рд┐рдк рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛, **`.bash_profile`** рдФрд░ **`.zshenv`** рдХреЛ рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд░ рджреЗрдЧрд╛ рдФрд░ рдЗрд╕рд▓рд┐рдП, рдЯрд░реНрдорд┐рдирд▓ рдЗрдирдореЗрдВ рд╕реЗ рдПрдХ рдлрд╛рдЗрд▓ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдЧрд╛ (рдпрд╣ рдирд┐рд░реНрднрд░ рдХрд░рддрд╛ рд╣реИ рдХрд┐ bash рдпрд╛ zsh рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд░рд╣рд╛ рд╣реИ)ред

[**рдореВрд▓ рд░рд┐рдкреЛрд░реНрдЯ рдпрд╣рд╛рдБ рджреЗрдЦреЗрдВ**](https://desi-jarvis.medium.com/office365-macos-sandbox-escape-fcce4fa4123c).

### Word Sandbox Bypass with Open and env variables

Sandboxed рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рд╕реЗ рдЕрднреА рднреА рдЕрдиреНрдп рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЛ **`open`** рдЙрдкрдпреЛрдЧрд┐рддрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЖрдордВрддреНрд░рд┐рдд рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдпреЗ рдкреНрд░рдХреНрд░рд┐рдпрд╛рдПрдВ **рдЕрдкрдиреЗ рд╕реНрд╡рдпрдВ рдХреЗ рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдХреЗ рднреАрддрд░ рдЪрд▓реЗрдВрдЧреА**ред

рдпрд╣ рдкрддрд╛ рдЪрд▓рд╛ рдХрд┐ open рдЙрдкрдпреЛрдЧрд┐рддрд╛ рдореЗрдВ **`--env`** рд╡рд┐рдХрд▓реНрдк рд╣реЛрддрд╛ рд╣реИ рдЬреЛ рдПрдХ рдРрдк рдХреЛ **рд╡рд┐рд╢рд┐рд╖реНрдЯ env** рд╡реЗрд░рд┐рдПрдмрд▓реНрд╕ рдХреЗ рд╕рд╛рде рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рд╣реЛрддрд╛ рд╣реИред рдЗрд╕рд▓рд┐рдП, рдпрд╣ рд╕рдВрднрд╡ рдерд╛ рдХрд┐ **`.zshenv` рдлрд╛рдЗрд▓** рдХреЛ рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдХреЗ **рдЕрдВрджрд░** рдПрдХ рдлреЛрд▓реНрдбрд░ рдореЗрдВ рдмрдирд╛рдпрд╛ рдЬрд╛рдП рдФрд░ рдлрд┐рд░ `open` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ `--env` рдХреЗ рд╕рд╛рде **`HOME` рд╡реЗрд░рд┐рдПрдмрд▓** рдХреЛ рдЙрд╕ рдлреЛрд▓реНрдбрд░ рдХреЗ рд▓рд┐рдП рд╕реЗрдЯ рдХрд░реЗрдВ рдЬрд┐рд╕рд╕реЗ `Terminal` рдРрдк рдЦреБрд▓реЗрдЧрд╛, рдЬреЛ `.zshenv` рдлрд╛рдЗрд▓ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдЧрд╛ (рдХрд┐рд╕реА рдХрд╛рд░рдг рд╕реЗ рд╡реЗрд░рд┐рдПрдмрд▓ `__OSINSTALL_ENVIROMENT` рдХреЛ рднреА рд╕реЗрдЯ рдХрд░рдирд╛ рдЖрд╡рд╢реНрдпрдХ рдерд╛)ред

[**рдореВрд▓ рд░рд┐рдкреЛрд░реНрдЯ рдпрд╣рд╛рдБ рджреЗрдЦреЗрдВ**](https://perception-point.io/blog/technical-analysis-of-cve-2021-30864/).

### Word Sandbox Bypass with Open and stdin

**`open`** рдЙрдкрдпреЛрдЧрд┐рддрд╛ рдиреЗ **`--stdin`** рдкреИрд░рд╛рдореАрдЯрд░ рдХрд╛ рднреА рд╕рдорд░реНрдерди рдХрд┐рдпрд╛ (рдФрд░ рдкрд┐рдЫрд▓реЗ рдмрд╛рдпрдкрд╛рд╕ рдХреЗ рдмрд╛рдж `--env` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╕рдВрднрд╡ рдирд╣реАрдВ рдерд╛)ред

рдмрд╛рдд рдпрд╣ рд╣реИ рдХрд┐ рднрд▓реЗ рд╣реА **`python`** рдХреЛ Apple рджреНрд╡рд╛рд░рд╛ рд╕рд╛рдЗрди рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛, рдпрд╣ **рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдирд╣реАрдВ рд╣реЛрдЧрд╛** рдПрдХ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЛ рдЬрд┐рд╕рдореЗрдВ **`quarantine`** рдПрдЯреНрд░рд┐рдмреНрдпреВрдЯ рд╣реЛред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдпрд╣ рд╕рдВрднрд╡ рдерд╛ рдХрд┐ рдЙрд╕реЗ stdin рд╕реЗ рдПрдХ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдкрд╛рд╕ рдХреА рдЬрд╛рдП рддрд╛рдХрд┐ рдпрд╣ рдЬрд╛рдВрдЪ рди рдХрд░реЗ рдХрд┐ рдпрд╣ рдХреНрд╡рд╛рд░рдВрдЯреАрди рд╣реИ рдпрд╛ рдирд╣реАрдВ:&#x20;

1. рдПрдХ **`~$exploit.py`** рдлрд╛рдЗрд▓ рдбреНрд░реЙрдк рдХрд░реЗрдВ рдЬрд┐рд╕рдореЗрдВ рдордирдорд╛рдиреЗ Python рдХрдорд╛рдВрдб рд╣реЛрдВред
2. _open_ рдЪрд▓рд╛рдПрдВ **`тАУstdin='~$exploit.py' -a Python`**, рдЬреЛ Python рдРрдк рдХреЛ рд╣рдорд╛рд░реА рдбреНрд░реЙрдк рдХреА рдЧрдИ рдлрд╛рдЗрд▓ рдХреЗ рд╕рд╛рде рдЪрд▓рд╛рдПрдЧрд╛ рдЬреЛ рдЗрд╕рдХреЗ рд╕реНрдЯреИрдВрдбрд░реНрдб рдЗрдирдкреБрдЯ рдХреЗ рд░реВрдк рдореЗрдВ рдХрд╛рдо рдХрд░реЗрдЧреАред Python рд╣рдорд╛рд░реЗ рдХреЛрдб рдХреЛ рдЦреБрд╢реА-рдЦреБрд╢реА рдЪрд▓рд╛рддрд╛ рд╣реИ, рдФрд░ рдЪреВрдВрдХрд┐ рдпрд╣ _launchd_ рдХреА рдЪрд╛рдЗрд▓реНрдб рдкреНрд░реЛрд╕реЗрд╕ рд╣реИ, рдпрд╣ Word рдХреЗ рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдирд┐рдпрдореЛрдВ рд╕реЗ рдмрдВрдзрд╛ рдирд╣реАрдВ рд╣реИред

<details>

<summary><strong>AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рд╢реВрдиреНрдп рд╕реЗ рд▓реЗрдХрд░ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ**, рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рдж
