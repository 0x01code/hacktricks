# macOS Gatekeeper / Quarantine / XProtect

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>тШБя╕П HackTricks Cloud тШБя╕П</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ЁЯРж Twitter ЁЯРж</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ЁЯОЩя╕П Twitch ЁЯОЩя╕П</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ЁЯОе Youtube ЁЯОе</strong></a></summary>

* рдХреНрдпрд╛ рдЖрдк рдПрдХ **рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХрдВрдкрдиреА** рдореЗрдВ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ? рдХреНрдпрд╛ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХреЛ HackTricks рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд** рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ? рдпрд╛ рдХреНрдпрд╛ рдЖрдкрдХреЛ **PEASS рдХреА рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐** рдЪрд╛рд╣рд┐рдП? [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ!
* рдЦреЛрдЬреЗрдВ [**The PEASS Family**](https://opensea.io/collection/the-peass-family), рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ рд╕рдВрдЧреНрд░рд╣ [**NFTs**](https://opensea.io/collection/the-peass-family)
* рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks swag**](https://peass.creator-spring.com)
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** [**ЁЯТм**](https://emojipedia.org/speech-balloon/) [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рдореБрдЭреЗ **Twitter** [**ЁЯРж**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)** рдХрд╛** **рдЕрдиреБрд╕рд░рдг** рдХрд░реЗрдВред**
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ рджреНрд╡рд╛рд░рд╛ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **рдФрд░** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud)
*
* .

</details>

## Gatekeeper

**Gatekeeper** рдПрдХ рд╕реБрд░рдХреНрд╖рд╛ рд╕реБрд╡рд┐рдзрд╛ рд╣реИ рдЬреЛ рдореИрдХ рдСрдкрд░реЗрдЯрд┐рдВрдЧ рд╕рд┐рд╕реНрдЯрдо рдХреЗ рд▓рд┐рдП рд╡рд┐рдХрд╕рд┐рдд рдХреА рдЧрдИ рд╣реИ, рдЬрд┐рд╕рдХрд╛ рдЙрджреНрджреЗрд╢реНрдп рд╣реИ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдирд╛ рдХрд┐ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЙрдирдХреЗ рд╕рд┐рд╕реНрдЯрдо рдкрд░ рдХреЗрд╡рд▓ **рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ рдЪрд▓рд╛рдПрдВ**ред рдпрд╣ рдХрд╛рд░реНрдп рдХрд░рддрд╛ рд╣реИ **рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ рдХреА рдкреНрд░рдорд╛рдгрд┐рдд** рдХрд░рдХреЗ рдЬреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЦреЛрд▓рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рддрд╛ рд╣реИ **рдРрдк рд╕реНрдЯреЛрд░ рдХреЗ рдмрд╛рд╣рд░ рд╕реНрд░реЛрддреЛрдВ** рд╕реЗ, рдЬреИрд╕реЗ рдПрдХ рдРрдк, рдПрдХ рдкреНрд▓рдЧрдЗрди рдпрд╛ рдПрдХ рд╕реНрдерд╛рдкрдирд╛ рдкреИрдХреЗрдЬред

Gatekeeper рдХреА рдореБрдЦреНрдп рдпрд╛рдВрддреНрд░рд┐рдХреА рдЙрд╕рдХреА **рд╕рддреНрдпрд╛рдкрди** рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рд╣реЛрддреА рд╣реИред рдпрд╣ рдЬрд╛рдВрдЪрддрд╛ рд╣реИ рдХрд┐ рдбрд╛рдЙрдирд▓реЛрдб рдХреА рдЧрдИ рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ **рдкрд╣рдЪрд╛рдиреЗ рдЧрдП рдбреЗрд╡рд▓рдкрд░ рджреНрд╡рд╛рд░рд╛ рд╕рд╛рдЗрди рдХреА рдЧрдИ рд╣реИ**, рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддреЗ рд╣реБрдП рдХрд┐ рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ рдХреА рдкреНрд░рд╛рдорд╛рдгрд┐рдХрддрд╛ рд╣реИред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдпрд╣ рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ **Apple рджреНрд╡рд╛рд░рд╛ рдиреЛрдЯрд░рд╛рдЗрдЬрд╝ рдирд╣реАрдВ рдХреА рдЧрдИ рд╣реИ**, рдЬрд┐рд╕рд╕реЗ рдкрддрд╛ рдЪрд▓рддрд╛ рд╣реИ рдХрд┐ рдЗрд╕рдореЗрдВ рдЬреНрдЮрд╛рдд рдЦрддрд░рдирд╛рдХ рд╕рд╛рдордЧреНрд░реА рдирд╣реАрдВ рд╣реИ рдФрд░ рдиреЛрдЯрд░рд╛рдЗрдЬрд╝ рдХреЗ рдмрд╛рдж рд╕рдВрд╢реЛрдзрд┐рдд рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред

рдЗрд╕рдХреЗ рдЕрддрд┐рд░рд┐рдХреНрдд, Gatekeeper рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд┐рдпрдВрддреНрд░рдг рдФрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХреЛ рдордЬрдмреВрдд рдХрд░рддрд╛ рд╣реИ рджреНрд╡рд╛рд░рд╛ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рдордВрдЬреВрд░реА рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП рдкреНрд░реЛрддреНрд╕рд╛рд╣рд┐рдд рдХрд░рдиреЗ** рдХреЗ рджреНрд╡рд╛рд░рд╛ рдбрд╛рдЙрдирд▓реЛрдб рдХреА рдЧрдИ рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ рдХреЛ рдкрд╣рд▓реА рдмрд╛рд░ рдЦреЛрд▓рдиреЗ рдХреЗ рд▓рд┐рдПред рдпрд╣ рд╕реБрд░рдХреНрд╖рд╛ рдЙрдкрд╛рдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рдЕрдирдЬрд╛рдиреЗ рдореЗрдВ рд╣рд╛рдирд┐рдХрд╛рд░рдХ рдПрдХреНрдЬреАрдХреНрдпреВрдЯреЗрдмрд▓ рдХреЛрдб рдХреЛ рдЪрд▓рд╛рдиреЗ рд╕реЗ рд░реЛрдХрдиреЗ рдореЗрдВ рдорджрдж рдХрд░рддреА рд╣реИ, рдЬрд┐рд╕реЗ рд╡реЗ рдПрдХ рдЕрд╣рд╛рдирд┐рдХрд╛рд░рдХ рдбреЗрдЯрд╛ рдлрд╝рд╛рдЗрд▓ рдХреЗ рд░реВрдк рдореЗрдВ рдЧрд▓рддреА рд╕реЗ рд╕рдордЭ рд╕рдХрддреЗ рд╣реИрдВред

### рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд╣рд╕реНрддрд╛рдХреНрд╖рд░

рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд╣рд╕реНрддрд╛рдХреНрд╖рд░, рдЬрд┐рд╕реЗ рдХреЛрдб рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рднреА рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ, Apple рдХреА рд╕реБрд░рдХреНрд╖рд╛ рдмреБрдирд┐рдпрд╛рдж рдХрд╛ рдПрдХ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдШрдЯрдХ рд╣реИред рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ рд▓реЗрдЦрдХ (рдбреЗрд╡рд▓рдкрд░) рдХреА рдкрд╣рдЪрд╛рди **рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░рдиреЗ** рдФрд░ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдХрд┐ рдХреЛрдб рдХреЛ рдЕрдВрддрд┐рдо рдмрд╛рд░ рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рдХрд┐рдП рдЬрд╛рдиреЗ рдХреЗ рдмрд╛рдж рд╕рдВрд╢реЛрдзрд┐рдд рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред

рдпрд╣рд╛рдВ рдЗрд╕рдХрд╛ рдХрд╛рдо рдХреИрд╕реЗ рдХрд░рддрд╛ рд╣реИ:

1. **рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рдХрд░рдирд╛:** рдЬрдм рдПрдХ рдбреЗрд╡рд▓рдкрд░ рдЕрдкрдирд╛ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд╡рд┐рддрд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рддреИрдпрд╛рд░ рд╣реЛрддрд╛ рд╣реИ, рд╡рд╣ рдПрдХ рдирд┐рдЬреА рдХреБрдВрдЬреА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ **рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рдХрд░рддрд╛ рд╣реИ**ред рдпрд╣ рдирд┐рдЬреА рдХреБрдВрдЬреА рдЙрд╕ рдкреНрд░рдорд╛рдг рдкрддреНрд░ рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рд╣реЛрддреА рд╣реИ рдЬрд┐рд╕реЗ Apple рдбреЗрд╡рд▓рдкрд░ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдореЗрдВ рдбреЗрд╡рд▓рдкрд░ рдХреЛ рдЬрд╛рд░реА рдХрд░рддрд╛ рд╣реИред рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ, рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЗ рд╕рднреА рд╣рд┐рд╕реНрд╕реЛрдВ рдХрд╛ рдПрдХ рдХреНрд░рд┐рдкреНрдЯреЛрдЧреНрд░рд╛рдлрд┐рдХ рд╣реИрд╢ рдмрдирд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдЗрд╕ рд╣реИрд╢ рдХреЛ рдбреЗрд╡рд▓рдкрд░ рдХреА рдирд┐рдЬреА рдХреБрдВрдЬреА рдХреЗ рд╕рд╛рде рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред
2. **рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХрд╛ рд╡рд┐рддрд░рдг:** рд╣рд╕реНрддрд╛рдХреНрд╖рд░рд┐рдд рдПрдкреНрд▓рд┐рдХреЗрд╢рди рддрдм рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рд╕рд╛рде рд╡рд┐рддрд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬреЛ рдбреЗрд╡рд▓рдкрд░ рдХреЗ рдкреНрд░рдорд╛рдг рдкрддреНрд░ рдХреЗ рд╕рд╛рде рдЖрддрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рд╕рдВрдмрдВрдзрд┐рдд рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдХреБрдВрдЬреА рд╣реЛрддреА рд╣реИред
3. **рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреА рд╕рддреНрдпрд╛рдкрдирд╛:** рдЬрдм рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░
```bash
# Get signer
codesign -vv -d /bin/ls 2>&1 | grep -E "Authority|TeamIdentifier"

# Check if the appтАЩs contents have been modified
codesign --verify --verbose /Applications/Safari.app

# Get entitlements from the binary
codesign -d --entitlements :- /System/Applications/Automator.app # Check the TCC perms

# Check if the signature is valid
spctl --assess --verbose /Applications/Safari.app

# Sign a binary
codesign -s <cert-name-keychain> toolsdemo
```
### рдиреЛрдЯрд░рд╛рдЗрдЬрд╝реЗрд╢рди

рдПрдкреНрдкрд▓ рдХреА рдиреЛрдЯрд░рд╛рдЗрдЬрд╝реЗрд╢рди рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рд╕рдВрднрд╛рд╡рд┐рдд рдиреБрдХрд╕рд╛рдирджрд╛рдпрдХ рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ рд╕реЗ рд╕реБрд░рдХреНрд╖рд┐рдд рд░рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдЕрддрд┐рд░рд┐рдХреНрдд рд╕реБрд░рдХреНрд╖рд╛ рдкреНрд░рдгрд╛рд▓реА рдХреЗ рд░реВрдк рдореЗрдВ рдХрд╛рдо рдХрд░рддреА рд╣реИред рдЗрд╕рдореЗрдВ, **рдбреЗрд╡рд▓рдкрд░ рдЕрдкрдиреЗ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рдПрдкреНрдкрд▓ рдХреА рдиреЛрдЯрд░реА рд╕реЗрд╡рд╛ рдХреЗ рджреНрд╡рд╛рд░рд╛ рдЬрд╛рдВрдЪ рдХреЗ рд▓рд┐рдП рд╕рдмрдорд┐рдЯ рдХрд░рддрд╛ рд╣реИ**, рдЬрд┐рд╕реЗ рдПрдк рд░рд┐рд╡реНрдпреВ рд╕реЗ рдЧрд▓рддреА рд╕реЗ рди рдорд┐рд▓рд╛ рдЬрд╛рдПред рдпрд╣ рд╕реЗрд╡рд╛ рдПрдХ **рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдкреНрд░рдгрд╛рд▓реА** рд╣реИ рдЬреЛ рд╕рдмрдорд┐рдЯ рдХрд┐рдП рдЧрдП рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ рдХреЛ **рдЦрддрд░рдирд╛рдХ рд╕рд╛рдордЧреНрд░реА** рдФрд░ рдХреЛрдб-рд╕рд╛рдЗрдирд┐рдВрдЧ рдХреЗ рд╕рдВрдмрдВрдз рдореЗрдВ рдХрд┐рд╕реА рднреА рд╕рдВрднрд╛рд╡рд┐рдд рд╕рдорд╕реНрдпрд╛ рдХреА рдЬрд╛рдВрдЪ рдХрд░рддреА рд╣реИред

рдпрджрд┐ рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ рдЗрд╕ рдЬрд╛рдВрдЪ рдХреЛ **рд╕рдлрд▓рддрд╛рдкреВрд░реНрд╡рдХ рдкрд╛рд░рд┐рдд** рдХрд░рддрд╛ рд╣реИ рдФрд░ рдХреЛрдИ рдЪрд┐рдВрддрд╛ рдирд╣реАрдВ рдЙрдард╛рддрд╛ рд╣реИ, рддреЛ рдиреЛрдЯрд░реА рд╕реЗрд╡рд╛ рдПрдХ рдиреЛрдЯрд░рд╛рдЗрдЬрд╝реЗрд╢рди рдЯрд┐рдХрдЯ рдЙрддреНрдкрдиреНрди рдХрд░рддреА рд╣реИред рдбреЗрд╡рд▓рдкрд░ рдХреЛ рдлрд┐рд░ рд╕реЗ рдЕрдкрдиреЗ рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ рдХреЗ рд╕рд╛рде рдЗрд╕ рдЯрд┐рдХрдЯ рдХреЛ **рдЬреЛрдбрд╝рдирд╛ рдЖрд╡рд╢реНрдпрдХ рд╣реЛрддрд╛ рд╣реИ**, рдЬрд┐рд╕реЗ 'рд╕реНрдЯреИрдкрд▓рд┐рдВрдЧ' рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдиреЛрдЯрд░рд╛рдЗрдЬрд╝реЗрд╢рди рдЯрд┐рдХрдЯ рднреА рдСрдирд▓рд╛рдЗрди рдкреНрд░рдХрд╛рд╢рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬрд╣рд╛рдВ рдЧреЗрдЯрдХреАрдкрд░, рдПрдкреНрдкрд▓ рдХреА рд╕реБрд░рдХреНрд╖рд╛ рдкреНрд░реМрджреНрдпреЛрдЧрд┐рдХреА, рдЗрд╕реЗ рдПрдХреНрд╕реЗрд╕ рдХрд░ рд╕рдХрддрд╛ рд╣реИред

рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдкрд╣рд▓реЗ рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ рдХреЗ рд╕реНрдерд╛рдкрдирд╛ рдпрд╛ рдирд┐рд╖реНрдкрд╛рджрди рдкрд░, рдиреЛрдЯрд░рд╛рдЗрдЬрд╝реЗрд╢рди рдЯрд┐рдХрдЯ рдХреА рдореМрдЬреВрджрдЧреА - рдЪрд╛рд╣реЗ рдПрдХреНрдЬреАрдХреНрдпреВрдЯреЗрдмрд▓ рдХреЗ рд╕рд╛рде рд╕реНрдЯреИрдкрд▓ рдХреА рдЧрдИ рд╣реЛ рдпрд╛ рдСрдирд▓рд╛рдЗрди рдорд┐рд▓реА рд╣реЛ - рдЧреЗрдЯрдХреАрдкрд░ рдХреЛ рд╕реВрдЪрд┐рдд рдХрд░рддреА рд╣реИ рдХрд┐ рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ рдХреЛ рдПрдкреНрдкрд▓ рджреНрд╡рд╛рд░рд╛ рдиреЛрдЯрд░рд╛рдЗрдЬрд╝ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред рдЗрд╕ рдкрд░рд┐рдгрд╛рдорд╕реНрд╡рд░реВрдк, рдЧреЗрдЯрдХреАрдкрд░ рдкреНрд░рд╛рд░рдВрднрд┐рдХ рд▓реЙрдиреНрдЪ рдбрд╛рдпрд▓реЙрдЧ рдореЗрдВ рдПрдХ рд╡рд░реНрдгрдирд╛рддреНрдордХ рд╕рдВрджреЗрд╢ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рддрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рдмрддрд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдХрд┐ рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ рдХреЛ рдПрдкреНрдкрд▓ рджреНрд╡рд╛рд░рд╛ рдЦрддрд░рдирд╛рдХ рд╕рд╛рдордЧреНрд░реА рдХреА рдЬрд╛рдВрдЪ рдХреА рдЧрдИ рд╣реИред рдЗрд╕ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд╕реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЕрдкрдиреЗ рд╕рд┐рд╕реНрдЯрдо рдкрд░ рд╕реНрдерд╛рдкрд┐рдд рдпрд╛ рдЪрд▓рд╛рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ рдХреА рд╕реБрд░рдХреНрд╖рд╛ рдореЗрдВ рдЕрдзрд┐рдХ рд╡рд┐рд╢реНрд╡рд╛рд╕ рд░рдЦрддреЗ рд╣реИрдВред

### рдЧреЗрдЯрдХреАрдкрд░ рдХреА рдЧрдгрдирд╛ рдХрд░рдирд╛

рдЧреЗрдЯрдХреАрдкрд░ рдПрдХ рд╕реБрд░рдХреНрд╖рд╛ рдШрдЯрдХ рд╣реИ рдЬреЛ рдЕрд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рдРрдкреНрд╕ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрдиреЗ рд╕реЗ рд░реЛрдХрддрд╛ рд╣реИ рдФрд░ рдЗрд╕рдХреЗ рд╕рд╛рде рд╣реА рдпрд╣ рдХрдИ рд╕реБрд░рдХреНрд╖рд╛ рдШрдЯрдХреЛрдВ рдХреЛ рднреА рд╣реИред

рдЧреЗрдЯрдХреАрдкрд░ рдХреА **рд╕реНрдерд┐рддрд┐** рдХреЛ рджреЗрдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рдореНрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:
```bash
# Check the status
spctl --status
```
{% hint style="danger" %}
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ GateKeeper рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рдЬрд╛рдВрдЪ рдХреЗрд╡рд▓ **рдХреНрд╡рд╛рд░рдВрдЯреАрди рд╡рд┐рд╢реЗрд╖рддрд╛ рд╡рд╛рд▓реЗ рдлрд╝рд╛рдЗрд▓реЛрдВ** рдХреЗ рд▓рд┐рдП рд╣реЛрддреА рд╣реИ, рд╣рд░ рдлрд╝рд╛рдЗрд▓ рдХреЗ рд▓рд┐рдП рдирд╣реАрдВред
{% endhint %}

GateKeeper рдпрд╣ рдЬрд╛рдВрдЪреЗрдЧрд╛ рдХрд┐ рдХреНрдпрд╛ рдПрдХ рдмрд╛рдЗрдирд░реА рдХреЛ **рдкреНрд░рд╛рдердорд┐рдХрддрд╛рдПрдВ рдФрд░ рд╣рд╕реНрддрд╛рдХреНрд╖рд░** рдХреЗ рдЕрдиреБрд╕рд╛рд░ рдЪрд▓рд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:

<figure><img src="../../../.gitbook/assets/image (678).png" alt=""><figcaption></figcaption></figure>

рдЗрд╕ рд╕рдорд╛рдХреГрддрд┐ рдХреЛ рд░рдЦрдиреЗ рд╡рд╛рд▓рд╛ рдбреЗрдЯрд╛рдмреЗрд╕ **`/var/db/SystemPolicy`** рдореЗрдВ рд╕реНрдерд┐рдд рд╣реИред рдЖрдк рдЗрд╕ рдбреЗрдЯрд╛рдмреЗрд╕ рдХреА рдЬрд╛рдВрдЪ рд░реВрдЯ рдХреЗ рд░реВрдк рдореЗрдВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
# Open database
sqlite3 /var/db/SystemPolicy

# Get allowed rules
SELECT requirement,allow,disabled,label from authority where label != 'GKE' and disabled=0;
requirement|allow|disabled|label
anchor apple generic and certificate 1[subject.CN] = "Apple Software Update Certification Authority"|1|0|Apple Installer
anchor apple|1|0|Apple System
anchor apple generic and certificate leaf[field.1.2.840.113635.100.6.1.9] exists|1|0|Mac App Store
anchor apple generic and certificate 1[field.1.2.840.113635.100.6.2.6] exists and (certificate leaf[field.1.2.840.113635.100.6.1.14] or certificate leaf[field.1.2.840.113635.100.6.1.13]) and notarized|1|0|Notarized Developer ID
[...]
```
рдиреЛрдЯ рдХрд░реЗрдВ рдХрд┐ рдкрд╣рд▓рд╛ рдирд┐рдпрдо "**рдРрдк рд╕реНрдЯреЛрд░**" рдореЗрдВ рд╕рдорд╛рдкреНрдд рд╣реБрдЖ рдерд╛ рдФрд░ рджреВрд╕рд░рд╛ рдирд┐рдпрдо "**рдбреЗрд╡рд▓рдкрд░ рдЖрдИрдбреА**" рдореЗрдВ рд╕рдорд╛рдкреНрдд рд╣реБрдЖ рдерд╛ рдФрд░ рдкрд┐рдЫрд▓реЗ рдЗрдореЗрдЬ рдореЗрдВ рдпрд╣ **рдРрдк рд╕реНрдЯреЛрд░ рдФрд░ рдкрд╣рдЪрд╛рдиреЗ рдЧрдП рдбреЗрд╡рд▓рдкрд░реЛрдВ рд╕реЗ рдРрдкреНрд╕ рдХреЛ рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдХреНрд╖рдо рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛**ред
рдпрджрд┐ рдЖрдк рдЙрд╕ рд╕реЗрдЯрд┐рдВрдЧ рдХреЛ рдРрдк рд╕реНрдЯреЛрд░ рдкрд░ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рддреЗ рд╣реИрдВ, рддреЛ "**рдиреЛрдЯрд░рд╛рдЗрдЬреНрдб рдбреЗрд╡рд▓рдкрд░ рдЖрдИрдбреА" рдирд┐рдпрдо рдЧрд╛рдпрдм рд╣реЛ рдЬрд╛рдПрдВрдЧреЗ**ред

рдпрд╣рд╛рдВ **GKE** рдкреНрд░рдХрд╛рд░ рдХреЗ рд╣рдЬрд╛рд░реЛрдВ рдирд┐рдпрдо рднреА рд╣реИрдВ:
```bash
SELECT requirement,allow,disabled,label from authority where label = 'GKE' limit 5;
cdhash H"b40281d347dc574ae0850682f0fd1173aa2d0a39"|1|0|GKE
cdhash H"5fd63f5342ac0c7c0774ebcbecaf8787367c480f"|1|0|GKE
cdhash H"4317047eefac8125ce4d44cab0eb7b1dff29d19a"|1|0|GKE
cdhash H"0a71962e7a32f0c2b41ddb1fb8403f3420e1d861"|1|0|GKE
cdhash H"8d0d90ff23c3071211646c4c9c607cdb601cb18f"|1|0|GKE
```
рдпреЗ рд╣реИрд╢ **`/var/db/SystemPolicyConfiguration/gke.bundle/Contents/Resources/gke.auth`, `/var/db/gke.bundle/Contents/Resources/gk.db`** рдФрд░ **`/var/db/gkopaque.bundle/Contents/Resources/gkopaque.db`** рд╕реЗ рдЖрддреЗ рд╣реИрдВред

**`spctl`** рдХреЗ рд╡рд┐рдХрд▓реНрдк **`--master-disable`** рдФрд░ **`--global-disable`** рдЗрди рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рдЬрд╛рдВрдЪреЛрдВ рдХреЛ рдкреВрд░реА рддрд░рд╣ рд╕реЗ **рдЕрдХреНрд╖рдо** рдХрд░ рджреЗрдВрдЧреЗ:
```bash
# Disable GateKeeper
spctl --global-disable
spctl --master-disable

# Enable it
spctl --global-enable
spctl --master-enable
```
рдкреВрд░реА рддрд░рд╣ рд╕реЗ рд╕рдХреНрд╖рдо рдХрд░рдиреЗ рдкрд░, рдПрдХ рдирдпрд╛ рд╡рд┐рдХрд▓реНрдк рджрд┐рдЦрд╛рдИ рджреЗрдЧрд╛:

<figure><img src="../../../.gitbook/assets/image (679).png" alt=""><figcaption></figcaption></figure>

рдпрд╣ **рдЬрд╛рдВрдЪрдирд╛ рд╕рдВрднрд╡ рд╣реИ рдХрд┐ рдХреНрдпрд╛ рдЧреЗрдЯрдХреАрдкрд░ рджреНрд╡рд╛рд░рд╛ рдПрдХ рдРрдк рдХреЛ рдЕрдиреБрдорддрд┐ рджреА рдЬрд╛рдПрдЧреА** рдХреЗ рд╕рд╛рде:
```bash
spctl --assess -v /Applications/App.app
```
рдЧреЗрдЯрдХреАрдкрд░ рдореЗрдВ рдирдП рдирд┐рдпрдо рдЬреЛрдбрд╝рдирд╛ рд╕рдВрднрд╡ рд╣реИ рддрд╛рдХрд┐ рдХреБрдЫ рдРрдкреНрд╕ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗ:
```bash
# Check if allowed - nop
spctl --assess -v /Applications/App.app
/Applications/App.app: rejected
source=no usable signature

# Add a label and allow this label in GateKeeper
sudo spctl --add --label "whitelist" /Applications/App.app
sudo spctl --enable --label "whitelist"

# Check again - yep
spctl --assess -v /Applications/App.app
/Applications/App.app: accepted
```
### рдХреНрд╡рд╛рд░рдВрдЯрд╛рдЗрди рдлрд╝рд╛рдЗрд▓реЗрдВ

рдПрдХ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдпрд╛ рдлрд╝рд╛рдЗрд▓ рдХреЛ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, macOS рдХреЗ рд╡рд┐рд╢реЗрд╖ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдЬреИрд╕реЗ рд╡реЗрдм рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдпрд╛ рдИрдореЗрд▓ рдХреНрд▓рд╛рдЗрдВрдЯ рдбрд╛рдЙрдирд▓реЛрдб рдХреА рдЧрдИ рдлрд╝рд╛рдЗрд▓ рдХреЗ рд▓рд┐рдП рдПрдХ рд╡рд┐рд╕реНрддрд╛рд░рд┐рдд рдлрд╝рд╛рдЗрд▓ рдЧреБрдгрд╛рдВрдХ рдЬреЛ рдХрд┐ "рдХреНрд╡рд╛рд░рдВрдЯрд╛рдЗрди рдЭрдВрдбрд╛" рдХреЗ рд░реВрдк рдореЗрдВ рдЬрд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬреЛрдбрд╝рддреЗ рд╣реИрдВред рдпрд╣ рдЧреБрдгрд╛рдВрдХ рдлрд╝рд╛рдЗрд▓ рдХреЛ рдПрдХ рдЕрд╕реБрд░рдХреНрд╖рд┐рдд рд╕реНрд░реЛрдд (рдЗрдВрдЯрд░рдиреЗрдЯ) рд╕реЗ рдЖрдиреЗ рд╡рд╛рд▓рд╛ рдФрд░ рд╕рдВрднрд╛рд╡рд┐рдд рдЬреЛрдЦрд┐рдо рд▓реЗ рдЬрд╛рдиреЗ рд╡рд╛рд▓рд╛ рдЪрд┐рд╣реНрдирд┐рдд рдХрд░рдиреЗ рдХреЗ рд░реВрдк рдореЗрдВ рд╕реБрд░рдХреНрд╖рд╛ рдЙрдкрд╛рдп рдХреЗ рд░реВрдк рдореЗрдВ рдХрд╛рд░реНрдп рдХрд░рддрд╛ рд╣реИред рд╣рд╛рд▓рд╛рдВрдХрд┐, рд╕рднреА рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдЗрд╕ рдЧреБрдгрд╛рдВрдХ рдХреЛ рдЬреЛрдбрд╝рддреЗ рдирд╣реАрдВ рд╣реИрдВ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рд╕рд╛рдорд╛рдиреНрдп рдмрд┐рдЯрдЯреЛрд░реЗрдВрдЯ рдХреНрд▓рд╛рдЗрдВрдЯ рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ рдЖрдорддреМрд░ рдкрд░ рдЗрд╕ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдЫреЛрдбрд╝ рджреЗрддрд╛ рд╣реИред

**рдХреНрд╡рд╛рд░рдВрдЯрд╛рдЗрди рдЭрдВрдбрд╛ рдореМрдЬреВрдж рд╣реЛрдиреЗ рдкрд░, рдЬрдм рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдлрд╝рд╛рдЗрд▓ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рддрд╛ рд╣реИ, macOS рдХреЗ рдЧреЗрдЯрдХреАрдкрд░ рд╕реБрд░рдХреНрд╖рд╛ рд╕реБрд╡рд┐рдзрд╛ рдХреЛ рд╕рдВрдХреЗрдд рдорд┐рд▓рддрд╛ рд╣реИред**

рдЬрдм **рдХреНрд╡рд╛рд░рдВрдЯрд╛рдЗрди рдЭрдВрдбрд╛ рдореМрдЬреВрдж рдирд╣реАрдВ рд╣реЛрддрд╛ рд╣реИ** (рдмрд┐рдЯрдЯреЛрд░реЗрдВрдЯ рдХреНрд▓рд╛рдЗрдВрдЯ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдбрд╛рдЙрдирд▓реЛрдб рдХреА рдЧрдИ рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЗ рд╕рд╛рде), рдЧреЗрдЯрдХреАрдкрд░ рдХреА **рдЬрд╛рдВрдЪреЗрдВ рдирд╣реАрдВ рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИрдВ**ред рдЗрд╕рд▓рд┐рдП, рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рдЕрд╕реБрд░рдХреНрд╖рд┐рдд рдпрд╛ рдЕрдЬреНрдЮрд╛рдд рд╕реНрд░реЛрддреЛрдВ рд╕реЗ рдбрд╛рдЙрдирд▓реЛрдб рдХреА рдЧрдИ рдлрд╝рд╛рдЗрд▓реЗрдВ рдЦреЛрд▓рдиреЗ рдкрд░ рд╕рддрд░реНрдХ рд░рд╣рдирд╛ рдЪрд╛рд╣рд┐рдПред

{% hint style="info" %}
рдХреЛрдб рд╣рд╕реНрддрд╛рдХреНрд╖рд░реЛрдВ рдХреА рдорд╛рдиреНрдпрддрд╛ рдХреА **рдЬрд╛рдВрдЪ** рдПрдХ **рд╕рдВрд╕рд╛рдзрди-рдкреНрд░рд╡рд░реНрдзрдирд╛рддреНрдордХ** рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдХреЛрдб рдФрд░ рдЙрд╕рдХреЗ рд╕рднреА рдмрдВрдбрд▓ рд░рд┐рд╕реЛрд░реНрд╕реЗрдЬрд╝ рдХреЗ рдХреНрд░рд┐рдкреНрдЯреЛрдЧреНрд░рд╛рдлрд╝рд┐рдХ рд╣реИрд╢ рдЙрддреНрдкрдиреНрди рдХрд░рдиреЗ рд╢рд╛рдорд┐рд▓ рд╣реЛрддреЗ рд╣реИрдВред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдХреА рдорд╛рдиреНрдпрддрд╛ рдХреА рдЬрд╛рдВрдЪ рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрддрд╛ рд╣реИ рдХрд┐ рдЗрд╕реЗ рдЬрд╛рд░реА рдХрд┐рдП рдЬрд╛рдиреЗ рдХреЗ рдмрд╛рдж рд░рджреНрдж рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рдпрд╛ рдирд╣реАрдВ, рдЬрд┐рд╕рдХреЗ рд▓рд┐рдП рдСрдирд▓рд╛рдЗрди рдЬрд╛рдВрдЪ рдХреА рдЬрд╛рддреА рд╣реИред рдЗрди рдХрд╛рд░рдгреЛрдВ рд╕реЗ, рдкреВрд░реНрдг рдХреЛрдб рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рдФрд░ рдиреЛрдЯрд░рд╛рдЗрдЬрд╝реЗрд╢рди рдЬрд╛рдВрдЪ рдХреЛ **рд╣рд░ рдмрд╛рд░ рдЬрдм рдПрдХ рдРрдк рд▓реЙрдиреНрдЪ рд╣реЛрддрд╛ рд╣реИ, рдЪрд▓рд╛рдирд╛ рдЕрд╕рдВрднрд╡ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ**ред

рдЗрд╕рд▓рд┐рдП, рдпреЗ рдЬрд╛рдВрдЪреЗрдВ **рдХреЗрд╡рд▓ рдХреНрд╡рд╛рд░рдВрдЯрд╛рдЗрди рдЧреБрдгрд╛рдВрдХ рд╡рд╛рд▓реЗ рдРрдкреНрд╕ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рддреЗ рд╕рдордп рд╣реА рдЪрд▓рд╛рдИ рдЬрд╛рддреА рд╣реИрдВ**ред
{% endhint %}

{% hint style="warning" %}
рдпрд╣ рдЧреБрдгрд╛рдВрдХ рдлрд╝рд╛рдЗрд▓ рдХреЛ рдмрдирд╛рдиреЗ / рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рджреНрд╡рд╛рд░рд╛ **рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП**ред

рд╣рд╛рд▓рд╛рдВрдХрд┐, рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдХрд┐рдП рдЧрдП рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЗ рд▓рд┐рдП рдЗрд╕ рдЧреБрдгрд╛рдВрдХ рдХреЛ рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред рдФрд░ рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдирд╣реАрдВ рдХрд┐рдП рдЧрдП рдРрдкреНрд╕ рдЗрд╕реЗ рдЦреБрдж рд╣реА рд╕реЗрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдпрд╛ **Info.plist** рдореЗрдВ [**LSFileQuarantineEnabled**](https://developer.apple.com/documentation/bundleresources/information\_property\_list/lsfilequarantineenabled?language=objc) рдХреБрдВрдЬреА рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд┐рд╕рд╕реЗ рд╕рд┐рд╕реНрдЯрдо рдирд┐рд░реНрдорд┐рдд рдлрд╝рд╛рдЗрд▓реЛрдВ рдкрд░ `com.apple.quarantine` рд╡рд┐рд╕реНрддрд╛рд░рд┐рдд рдЧреБрдгрд╛рдВрдХ рд╕реЗрдЯ рдХрд░рддрд╛ рд╣реИ,
{% endhint %}

рдЗрд╕рдХреА рд╕реНрдерд┐рддрд┐ рдХреА **рдЬрд╛рдВрдЪ рдФрд░ рд╕рдХреНрд╖рдо / рдЕрдХреНрд╖рдо** (рд░реВрдЯ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ) рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИ:
```bash
spctl --status
assessments enabled

spctl --enable
spctl --disable
#You can also allow nee identifies to execute code using the binary "spctl"
```
рдЖрдк рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреЗ рд╕рд╛рде рднреА **рдЬрд╛рдВрдЪ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдХреНрдпрд╛ рдПрдХ рдлрд╝рд╛рдЗрд▓ рдореЗрдВ quarantine рд╡рд┐рд╕реНрддрд╛рд░рд┐рдд рдЧреБрдгрдзрд░реНрдо рд╣реИ**:
```bash
xattr file.png
com.apple.macl
com.apple.quarantine
```
рд╡рд┐рд╕реНрддрд╛рд░рд┐рдд рдЧреБрдгреЛрдВ рдХреА рдорд╛рди рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ рдФрд░ рдЗрд╕рдХреЗ рд╕рд╛рде рдЙрд╕ рдРрдк рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдПрдВ рдЬрд┐рд╕рдиреЗ рдХреНрд╡рд╛рд░рдВрдЯреАрди рдЧреБрдг рд▓рд┐рдЦрд╛ рд╣реИ:
```bash
xattr -l portada.png
com.apple.macl:
00000000  03 00 53 DA 55 1B AE 4C 4E 88 9D CA B7 5C 50 F3  |..S.U..LN.....P.|
00000010  16 94 03 00 27 63 64 97 98 FB 4F 02 84 F3 D0 DB  |....'cd...O.....|
00000020  89 53 C3 FC 03 00 27 63 64 97 98 FB 4F 02 84 F3  |.S....'cd...O...|
00000030  D0 DB 89 53 C3 FC 00 00 00 00 00 00 00 00 00 00  |...S............|
00000040  00 00 00 00 00 00 00 00                          |........|
00000048
com.apple.quarantine: 00C1;607842eb;Brave;F643CD5F-6071-46AB-83AB-390BA944DEC5
# 00c1 -- It has been allowed to eexcute this file
# 607842eb -- Timestamp
# Brave -- App
# F643CD5F-6071-46AB-83AB-390BA944DEC5 -- UID assigned to the file downloaded
```
рдФрд░ рдЙрд╕ рдЧреБрдг рдХреЛ рдЗрд╕ рдкреНрд░рдХрд╛рд░ рд╕реЗ **рд╣рдЯрд╛рдПрдВ**:
```bash
xattr -d com.apple.quarantine portada.png
#You can also remove this attribute from every file with
find . -iname '*' -print0 | xargs -0 xattr -d com.apple.quarantine
```
рдФрд░ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреЗ рд╕рд╛рде рд╕рднреА рдХреНрд╡рд╛рд░рдВрдЯрд╛рдЗрди рдлрд╝рд╛рдЗрд▓реЗрдВ рдвреВрдВрдврд╝реЗрдВ:

{% code overflow="wrap" %}
```bash
find / -exec ls -ld {} \; 2>/dev/null | grep -E "[x\-]@ " | awk '{printf $9; printf "\n"}' | xargs -I {} xattr -lv {} | grep "com.apple.quarantine"
```
{% endcode %}

рдХреНрд╡рд╛рд░рдВрдЯрд╛рдЗрди рдЬрд╛рдирдХрд╛рд░реА рднреА рдПрдХ рдХреЗрдВрджреНрд░реАрдп рдбреЗрдЯрд╛рдмреЗрд╕ рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реЛрддреА рд╣реИ рдЬрд┐рд╕реЗ рд▓реЙрдиреНрдЪрд╕рд░реНрд╡рд┐рд╕реЗрдЬрд╝ рджреНрд╡рд╛рд░рд╛ рдкреНрд░рдмрдВрдзрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ **`~/Library/Preferences/com.apple.LaunchServices.QuarantineEventsV2`**.

### XProtect

XProtect рдореИрдХрдУрдПрд╕ рдореЗрдВ рдПрдХ рдЕрдВрддрд░рд╡рд┐рд╖рдп-рдореИрд▓рд╡реЗрдпрд░ рд╕реБрд░рдХреНрд╖рд╛ рд╕реБрд╡рд┐рдзрд╛ рд╣реИред XProtect **рдЬрд╛рдиреЗ рдорд╛рдиреЗ рдореИрд▓рд╡реЗрдпрд░ рдФрд░ рдЕрд╕реБрд░рдХреНрд╖рд┐рдд рдлрд╝рд╛рдЗрд▓ рдкреНрд░рдХрд╛рд░реЛрдВ рдХреЗ рдЦрд╝рд┐рд▓рд╛рдлрд╝ рдЬрдм рднреА рдХреЛрдИ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдкрд╣рд▓реА рдмрд╛рд░ рдЪрд╛рд▓реВ рдХреА рдЬрд╛рддреА рд╣реИ рдпрд╛ рд╕рдВрд╢реЛрдзрд┐рдд рдХреА рдЬрд╛рддреА рд╣реИ, рддреЛ рдЙрд╕реЗ рдЕрдкрдиреЗ рдбреЗрдЯрд╛рдмреЗрд╕ рдХреЗ рдЦрд╝рд┐рд▓рд╛рдлрд╝ рдЬрд╛рдВрдЪрддрд╛ рд╣реИ**ред рдЬрдм рдЖрдк рдХреБрдЫ рдРрдкреНрд╕ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдлрд╝рд╛рдЗрд▓ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рддреЗ рд╣реИрдВ, рдЬреИрд╕реЗ Safari, Mail рдпрд╛ Messages, XProtect рдлрд╝рд╛рдЗрд▓ рдХреА рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдЬрд╛рдВрдЪ рдХрд░рддрд╛ рд╣реИред рдпрджрд┐ рдЗрд╕рдХреЗ рдбреЗрдЯрд╛рдмреЗрд╕ рдореЗрдВ рдХрд┐рд╕реА рдЬрд╛рдиреЗ рдорд╛рдиреЗ рдореИрд▓рд╡реЗрдпрд░ рдХреЗ рд╕рд╛рде рдореЗрд▓ рдЦрд╝рд╛рддрд╛ рд╣реИ, рддреЛ XProtect рдлрд╝рд╛рдЗрд▓ рдХреЛ **рдЪрд▓рд╛рдиреЗ рд╕реЗ рд░реЛрдХреЗрдЧрд╛** рдФрд░ рдЖрдкрдХреЛ рдЦрд╝рддрд░реЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╕реВрдЪрд┐рдд рдХрд░реЗрдЧрд╛ред

XProtect рдбреЗрдЯрд╛рдмреЗрд╕ рдХреЛ Apple рджреНрд╡рд╛рд░рд╛ рдирдИ рдореИрд▓рд╡реЗрдпрд░ рдкрд░рд┐рднрд╛рд╖рд╛рдУрдВ рдХреЗ рд╕рд╛рде **рдирд┐рдпрдорд┐рдд рд░реВрдк рд╕реЗ рдЕрдкрдбреЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ**, рдФрд░ рдпреЗ рдЕрдкрдбреЗрдЯ рдЖрдкрдХреЗ рдореИрдХ рдкрд░ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдбрд╛рдЙрдирд▓реЛрдб рдФрд░ рд╕реНрдерд╛рдкрд┐рдд рд╣реЛрддреЗ рд╣реИрдВред рдЗрд╕рд╕реЗ рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рд╣реЛрддрд╛ рд╣реИ рдХрд┐ XProtect рд╣рдореЗрд╢рд╛ рдирд╡реАрдирддрдо рдЬреНрдЮрд╛рдд рдЦрд╝рддрд░реЛрдВ рдХреЗ рд╕рд╛рде рдЕрджреНрдпрддрд┐рдд рд░рд╣рддрд╛ рд╣реИред

рд╣рд╛рд▓рд╛рдВрдХрд┐, рдпрд╣ рдзреНрдпрд╛рди рджреЗрдиреЗ рдпреЛрдЧреНрдп рд╣реИ рдХрд┐ **XProtect рдПрдХ рдкреВрд░реНрдг рд╕реБрд╡рд┐рдзрд╛ рд╡рд╛рд▓рд╛ рдПрдВрдЯреАрд╡рд╛рдпрд░рд╕ рд╕рдорд╛рдзрд╛рди рдирд╣реАрдВ рд╣реИ**ред рдпрд╣ рдХреЗрд╡рд▓ рдПрдХ рдирд┐рд╢реНрдЪрд┐рдд рд╕реВрдЪреА рдХреЗ рдЬреНрдЮрд╛рдд рдЦрд╝рддрд░реЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЕрдзрд┐рдХрд╛рдВрд╢ рдПрдВрдЯреАрд╡рд╛рдпрд░рд╕ рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ рдХреА рддрд░рд╣ рдСрди-рдПрдХреНрд╕реЗрд╕ рд╕реНрдХреИрдирд┐рдВрдЧ рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИред

рдЖрдк рдирд╡реАрдирддрдо XProtect рдЕрдкрдбреЗрдЯ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

{% code overflow="wrap" %}
```bash
system_profiler SPInstallHistoryDataType 2>/dev/null | grep -A 4 "XProtectPlistConfigData" | tail -n 5
```
{% endcode %}

XProtect рд╕реНрдерд┐рдд рд╣реИред SIP рд╕реБрд░рдХреНрд╖рд┐рдд рд╕реНрдерд╛рди рдкрд░ **/Library/Apple/System/Library/CoreServices/XProtect.bundle** рдФрд░ рдмрдВрдбрд▓ рдХреЗ рдЕрдВрджрд░ рдЖрдк XProtect рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЬрд╛рдирдХрд╛рд░реА рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ:

* **`XProtect.bundle/Contents/Resources/LegacyEntitlementAllowlist.plist`**: рдЗрди cdhashes рдХреЗ рд╕рд╛рде рдХреЛрдб рдХреЛ рдкреБрд░рд╛рдиреА рдЕрдзрд┐рдХрд╛рд░рд┐рддрд╛рдУрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рджреЗрддрд╛ рд╣реИред
* **`XProtect.bundle/Contents/Resources/XProtect.meta.plist`**: BundleID рдФрд░ TeamID рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд▓реЛрдб рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрд╕реНрд╡реАрдХреГрдд рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рдкреНрд▓рдЧрдЗрди рдФрд░ рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреА рд╕реВрдЪреА рдпрд╛ рдиреНрдпреВрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдХреА рд╕рдВрдХреЗрдд рдХрд░рддрд╛ рд╣реИред
* **`XProtect.bundle/Contents/Resources/XProtect.yara`**: рдореИрд▓рд╡реЗрдпрд░ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдХреЗ рд▓рд┐рдП Yara рдирд┐рдпрдоред
* **`XProtect.bundle/Contents/Resources/gk.db`**: рдЕрд╡рд░реБрджреНрдз рдЕрдиреБрдкреНрд░рдпреЛрдЧреЛрдВ рдФрд░ TeamID рдХреЗ рд╣реИрд╢ рдХреЗ рд╕рд╛рде SQLite3 рдбреЗрдЯрд╛рдмреЗрд╕ред

рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ XProtect рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рдПрдХ рдФрд░ рдРрдк рд╣реИ **`/Library/Apple/System/Library/CoreServices/XProtect.app`** рдЬреЛ Gatekeeper рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рд╕рд╛рде рд╕рдВрд▓рдЧреНрди рдирд╣реАрдВ рд╣реИред

## Gatekeeper Bypasses

Gatekeeper рдХреЛ рдмрд╛рдЗрдкрд╛рд╕ рдХрд░рдиреЗ рдХрд╛ рдХреЛрдИ рднреА рддрд░реАрдХрд╛ (рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдХреБрдЫ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рдФрд░ рдЧреЗрдЯрдХреАрдкрд░ рджреНрд╡рд╛рд░рд╛ рдЗрд╕реЗ рдЕрдиреБрдорддрд┐ рдирд╣реАрдВ рджреЗрдиреЗ рдкрд░ рдЗрд╕реЗ рдХреНрд░рд┐рдпрд╛рдиреНрд╡рд┐рдд рдХрд░рдиреЗ рдореЗрдВ рд╕рдлрд▓ рд╣реЛрдирд╛) macOS рдореЗрдВ рдПрдХ рд╕реБрд░рдХреНрд╖рд╛ рджреБрд░реНрдмрд▓рддрд╛ рдХреЗ рд░реВрдк рдореЗрдВ рдорд╛рдиреА рдЬрд╛рддреА рд╣реИред рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреБрдЫ CVEs рддрдХ рджреНрд╡рд╛рд░рд╛ рдмрд╛рдЗрдкрд╛рд╕ рдХрд░рдиреЗ рдХреА рддрдХрдиреАрдХреЛрдВ рдХреЛ рдЕрдиреБрдорддрд┐ рджреА рдЧрдИ рдереА:

### [CVE-2021-1810](https://labs.withsecure.com/publications/the-discovery-of-cve-2021-1810)

**Archive Utility** рджреНрд╡рд╛рд░рд╛ рдирд┐рдХрд╛рд▓реЗ рдЬрд╛рдиреЗ рдкрд░, **886** рд╡рд░реНрдгреЛрдВ рд╕реЗ рд▓рдВрдмреЗ рдлрд╝рд╛рдЗрд▓ **рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдореЗрдВ рд╡рд┐рдлрд▓ рд░рд╣реЗрдВрдЧреА** рдЬреЛ com.apple.quarantine рд╡рд┐рд╕реНрддрд╛рд░рд┐рдд рдЧреБрдгрдзрд░реНрдо рдХреЛ рдЕрдиреБрдЧреНрд░рд╣рд┐рдд рдирд╣реАрдВ рдХрд░реЗрдЧреА, рдЬрд┐рд╕рд╕реЗ рдЗрди рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ **рдЧреЗрдЯрдХреАрдкрд░ рдХреЛ рдмрд╛рдЗрдкрд╛рд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП** рд╕рдВрднрд╡ рд╣реЛрдЧрд╛ред

рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП [**рдореВрд▓ рд░рд┐рдкреЛрд░реНрдЯ**](https://labs.withsecure.com/publications/the-discovery-of-cve-2021-1810) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВред

### [CVE-2021-30990](https://ronmasas.com/posts/bypass-macos-gatekeeper)

рдЬрдм рдПрдХ рдПрдкреНрд▓рд┐рдХреЗрд╢рди **Automator** рдХреЗ рд╕рд╛рде рдмрдирд╛рдИ рдЬрд╛рддреА рд╣реИ, рдЗрд╕рдХреЗ рдХреНрд░рд┐рдпрд╛рдиреНрд╡рдпрди рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА `application.app/Contents/document.wflow` рдореЗрдВ рд╣реЛрддреА рд╣реИ рди рдХрд┐ рдХреНрд░рд┐рдпрд╛рдиреНрд╡рдпрдХред рдХреНрд░рд┐рдпрд╛рдиреНрд╡рдпрдХ рдХреЗрд╡рд▓ рдПрдХ рд╕рд╛рдзрд╛рд░рдг Automator рдмрд╛рдЗрдирд░реА рд╣реИ рдЬрд┐рд╕реЗ **Automator Application Stub** рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИред

рдЗрд╕рд▓рд┐рдП, рдЖрдк `application.app/Contents/MacOS/Automator\ Application\ Stub` рдХреЛ **рдПрдХ рдкреНрд░рддреАрдХрд╛рддреНрдордХ рд▓рд┐рдВрдХ рдХреЗ рд╕рд╛рде рджреВрд╕рд░реЗ рд╕рд┐рд╕реНрдЯрдо рдХреЗ Automator Application Stub рдХреА рдУрд░ рдкрд╣реБрдВрдЪрд╛ рд╕рдХрддреЗ рд╣реИрдВ** рдФрд░ рдпрд╣ `document.wflow` (рдЖрдкрдХрд╛ рд╕реНрдХреНрд░рд┐рдкреНрдЯ) рдХреЗ рдЕрдВрджрд░ рд╣реИ рдХреНрд░рд┐рдпрд╛рдиреНрд╡рд┐рдд рдХрд░реЗрдЧрд╛ **рдЧреЗрдЯрдХреАрдкрд░ рдХреЛ рдЯреНрд░рд┐рдЧрд░ рдирд╣реАрдВ рдХрд░рддрд╛** рдХреНрдпреЛрдВрдХрд┐ рд╡рд╛рд╕реНрддрд╡рд┐рдХ рдХреНрд░рд┐рдпрд╛рдиреНрд╡рдпрдХ рдХреЗ рдкрд╛рд╕ рдЕрд╡рд░реЛрдз рдПрдХреНрд╕рдЯреНрд░рд┐рдмреНрдпреВрдЯ рдирд╣реАрдВ рд╣реИред

рдЙрдореНрдореАрджрд┐рдд рд╕реНрдерд╛рди рдХрд╛ рдЙрджрд╛рд╣рд░рдг: `/System/Library/CoreServices/Automator\ Application\ Stub.app/Contents/MacOS/Automator\ Application\ Stub`

рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП [**рдореВрд▓ рд░рд┐рдкреЛрд░реНрдЯ**](https://ronmasas.com/posts/bypass-macos-gatekeeper) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВред

### [CVE-2022-22616](https://www.jamf.com/blog/jamf-threat-labs-safari-vuln-gatekeeper-bypass/)

рдЗрд╕ рдмрд╛рдЗрдкрд╛рд╕ рдореЗрдВ рдПрдХ рдЬрд╝рд┐рдк рдлрд╝рд╛рдЗрд▓ рдПрдХ рдРрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЗ рд╕рд╛рде рдмрдирд╛рдИ рдЧрдИ рдереА рдЬреЛ `application.app/Contents` рд╕реЗ рд╢реБрд░реВ рд╣реЛрдХрд░ рд╕рдВрдкреАрдбрд╝рд┐рдд рд╣реЛрдиреЗ рд▓рдЧреА рдереА рдмрдЬрд╛рдп `application.app` рд╕реЗред рдЗрд╕рд▓рд┐рдП, **рдЕрд╡рд░реЛрдз рдЧреБрдгрдзрд░реНрдо** `application.app/Contents` рдХреЗ рд╕рднреА **рдлрд╝рд╛рдЗрд▓реЛрдВ рдкрд░ рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛** рд▓реЗрдХрд┐рди **`application.app` рдкрд░ рдирд╣реАрдВ**, рдЬрд┐рд╕реЗ рдЧреЗрдЯрдХреАрдкрд░ рдЬрд╛рдВрдЪ рд░рд╣рд╛ рдерд╛, рдЗрд╕рд▓рд┐рдП рдЧреЗрдЯрдХреАрдкрд░ рдХреЛ рдмрд╛рдЗрдкрд╛рд╕ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдХреНрдпреЛрдВрдХрд┐ `application.app` рдЯреНрд░рд┐рдЧрд░ рд╣реЛрдиреЗ рдкрд░ рдЙрд╕рдореЗрдВ **рдЕрд╡рд░реЛрдз рдЧреБрдгрдзрд░реНрдо рдирд╣реАрдВ рдерд╛**ред

рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП [**рдореВрд▓ рд░рд┐рдкреЛрд░реНрдЯ**](https://www.jamf.com/blog/jamf-threat-labs-safari-vuln-gatekeeper-bypass/) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВред
```bash
zip -r test.app/Contents test.zip
```
рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП [**рдореВрд▓ рд░рд┐рдкреЛрд░реНрдЯ**](https://www.jamf.com/blog/jamf-threat-labs-safari-vuln-gatekeeper-bypass/) рджреЗрдЦреЗрдВред

### [CVE-2022-32910](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-32910)

рд╣рд╛рд▓рд╛рдВрдХрд┐ рддрддреНрд╡ рдЕрд▓рдЧ рд╣реЛрдВ, рдЗрд╕ рдХрдордЬреЛрд░реА рдХрд╛ рд╢реЛрдзрд╛рд░реНрдереАрдХрд░рдг рдкрд┐рдЫрд▓реЗ рд╡рд╛рд▓реЗ рдХреЗ рдмрд╣реБрдд рд╕рдорд╛рди рд╣реИред рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ рд╣рдо **`application.app/Contents`** рд╕реЗ рдПрдХ Apple Archive рдЙрддреНрдкрдиреНрди рдХрд░реЗрдВрдЧреЗ, рддрд╛рдХрд┐ **`application.app` рдХреЛ quarantine рдПрдЯреНрд░рд┐рдмреНрдпреВрдЯ рди рдорд┐рд▓реЗ** рдЬрдм **Archive Utility** рджреНрд╡рд╛рд░рд╛ рдЕрдирдмрдВрдзрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПред
```bash
aa archive -d test.app/Contents -o test.app.aar
```
рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП [**рдореВрд▓ рд░рд┐рдкреЛрд░реНрдЯ**](https://www.jamf.com/blog/jamf-threat-labs-macos-archive-utility-vulnerability/) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВред

### [CVE-2022-42821](https://www.microsoft.com/en-us/security/blog/2022/12/19/gatekeepers-achilles-heel-unearthing-a-macos-vulnerability/)

ACL **`writeextattr`** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХрд┐рд╕реА рднреА рд╡реНрдпрдХреНрддрд┐ рдХреЛ рдПрдХ рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдПрдХ рдЧреБрдг рд▓рд┐рдЦрдиреЗ рд╕реЗ рд░реЛрдХрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:
```bash
touch /tmp/no-attr
chmod +a "everyone deny writeextattr" /tmp/no-attr
xattr -w attrname vale /tmp/no-attr
xattr: [Errno 13] Permission denied: '/tmp/no-attr'
```
рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, **AppleDouble** рдлрд╝рд╛рдЗрд▓ рдкреНрд░рд╛рд░реВрдк рдПрдХ рдлрд╝рд╛рдЗрд▓ рдХреА ACEs рдХреЗ рд╕рд╛рде рдПрдХ рдлрд╝рд╛рдЗрд▓ рдХреА рдкреНрд░рддрд┐рд▓рд┐рдкрд┐ рдмрдирд╛рддрд╛ рд╣реИред

[**рд╕реНрд░реЛрдд рдХреЛрдб**](https://opensource.apple.com/source/Libc/Libc-391/darwin/copyfile.c.auto.html) рдореЗрдВ рджреЗрдЦрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдХрд┐ **`com.apple.acl.text`** рдирд╛рдордХ xattr рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд ACL рдкрд╛рда рдкреНрд░рддрд┐рд╖реНрдард╛рди рдХреЗ рд░реВрдк рдореЗрдВ рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред рдЗрд╕рд▓рд┐рдП, рдпрджрд┐ рдЖрдкрдиреЗ рдПрдХ рдРрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рдПрдХ zip рдлрд╝рд╛рдЗрд▓ рдореЗрдВ **AppleDouble** рдлрд╝рд╛рдЗрд▓ рдкреНрд░рд╛рд░реВрдк рдХреЗ рд╕рд╛рде рд╕рдВрдХреНрд╖рд┐рдкреНрдд рдХрд┐рдпрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдПрдХ ACL рд╣реИ рдЬреЛ рдЗрд╕реЗ рдЕрдиреНрдп xattr рдХреЛ рд▓рд┐рдЦрдиреЗ рд╕реЗ рд░реЛрдХрддрд╛ рд╣реИ... рддреЛ quarantine xattr рдХреЛ рдРрдкреНрд▓рд┐рдХреЗрд╢рди рдореЗрдВ рд╕реЗрдЯ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛:
```bash
chmod +a "everyone deny write,writeattr,writeextattr" /tmp/test
ditto -c -k test test.zip
python3 -m http.server
# Download the zip from the browser and decompress it, the file shuold be without a wuarantine xattr
```
рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП [**рдореВрд▓ рд░рд┐рдкреЛрд░реНрдЯ**](https://www.microsoft.com/en-us/security/blog/2022/12/19/gatekeepers-achilles-heel-unearthing-a-macos-vulnerability/) рджреЗрдЦреЗрдВред

### [CVE-2023-27943](https://blog.f-secure.com/discovery-of-gatekeeper-bypass-cve-2023-27943/)

рдпрд╣ рдкрд╛рдпрд╛ рдЧрдпрд╛ рдХрд┐ **Google Chrome рдбрд╛рдЙрдирд▓реЛрдб рдХреА рдЧрдИ рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ quarantine рд╡рд┐рд╢реЗрд╖рддрд╛ рд╕реЗрдЯ рдирд╣реАрдВ рдХрд░ рд░рд╣рд╛ рдерд╛** рдХреНрдпреЛрдВрдХрд┐ рдХреБрдЫ macOS рдЖрдВрддрд░рд┐рдХ рд╕рдорд╕реНрдпрд╛рдУрдВ рдХреЗ рдХрд╛рд░рдгред

### [CVE-2023-27951](https://redcanary.com/blog/gatekeeper-bypass-vulnerabilities/)

AppleDouble рдлрд╝рд╛рдЗрд▓ рдкреНрд░рд╛рд░реВрдк рдПрдХ рдЕрд▓рдЧ рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдлрд╝рд╛рдЗрд▓ рдХреА рд╡рд┐рд╢реЗрд╖рддрд╛рдУрдВ рдХреЛ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рддреЗ рд╣реИрдВ, рдЬреЛ `._` рд╕реЗ рд╢реБрд░реВ рд╣реЛрддреА рд╣реИ, рдпрд╣ рдорджрдж рдХрд░рддрд╛ рд╣реИ **macOS рдорд╢реАрдиреЛрдВ рдХреЗ рдмреАрдЪ рдлрд╝рд╛рдЗрд▓ рд╡рд┐рд╢реЗрд╖рддрд╛рдУрдВ рдХреА рдкреНрд░рддрд┐рд▓рд┐рдкрд┐ рдмрдирд╛рдиреЗ рдореЗрдВ**ред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдзреНрдпрд╛рди рджрд┐рдпрд╛ рдЧрдпрд╛ рдХрд┐ AppleDouble рдлрд╝рд╛рдЗрд▓ рдХреЛ рдбреАрдХрдВрдкреНрд░реЗрд╕ рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, `._` рд╕реЗ рд╢реБрд░реВ рд╣реЛрдиреЗ рд╡рд╛рд▓реА рдлрд╝рд╛рдЗрд▓ рдХреЛ **quarantine рд╡рд┐рд╢реЗрд╖рддрд╛ рдирд╣реАрдВ рджреА рдЧрдИ рдереА**ред

{% code overflow="wrap" %}
```bash
mkdir test
echo a > test/a
echo b > test/b
echo ._a > test/._a
aa archive -d test/ -o test.aar

# If you downloaded the resulting test.aar and decompress it, the file test/._a won't have a quarantitne attribute
```
{% endcode %}

рдЧреЗрдЯрдХреАрдкрд░ рдХреЛ рдЕрдирджреЗрдЦрд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдРрд╕рд╛ рдлрд╝рд╛рдЗрд▓ рдмрдирд╛рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рд╣реЛрдиреЗ рдХреЗ рдХрд╛рд░рдг, рдпрд╣ **рд╕рдВрднрд╡ рдерд╛ред** рдпрд╣ рдЪрд╛рд▓ рдереА рдХрд┐ рдПрдХ **DMG рдлрд╝рд╛рдЗрд▓ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдмрдирд╛рдПрдВ** рдЬреЛ AppleDouble рдирд╛рдо рд╕рдВрд╡рд┐рдзрд╛рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ (рдЗрд╕реЗ `._` рд╕реЗ рд╢реБрд░реВ рдХрд░реЗрдВ) рдФрд░ рдЗрд╕ рдЫрд┐рдкреЗ рд╣реБрдП рдлрд╝рд╛рдЗрд▓ рдХреЗ рдмрд┐рдирд╛ рдХрд┐рд╕реА **рджрд┐рдЦрд╛рдИ рджреЗрдиреЗ рд╡рд╛рд▓реА рдлрд╝рд╛рдЗрд▓ рдХреЛ рд╕рдВрдХреЗрдд рд░реВрдк рдореЗрдВ рдмрдирд╛рдПрдВ** рдЬрд┐рд╕рдореЗрдВ рдХреЛрдИ рдХреНрд╡рд╛рд░рдВрдЯрд╛рдЗрди рдЧреБрдг рдирд╣реАрдВ рд╣реИред\
рдЬрдм **dmg рдлрд╝рд╛рдЗрд▓ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ**, рдХреНрдпреЛрдВрдХрд┐ рдЗрд╕рдореЗрдВ рдХреЛрдИ рдХреНрд╡рд╛рд░рдВрдЯрд╛рдЗрди рдЧреБрдг рдирд╣реАрдВ рд╣реЛрддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдпрд╣ **рдЧреЗрдЯрдХреАрдкрд░ рдХреЛ рдЕрдирджреЗрдЦрд╛ рдХрд░реЗрдЧрд╛**ред
```bash
# Create an app bundle with the backdoor an call it app.app

echo "[+] creating disk image with app"
hdiutil create -srcfolder app.app app.dmg

echo "[+] creating directory and files"
mkdir
mkdir -p s/app
cp app.dmg s/app/._app.dmg
ln -s ._app.dmg s/app/app.dmg

echo "[+] compressing files"
aa archive -d s/ -o app.aar
```
<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>тШБя╕П HackTricks Cloud тШБя╕П</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ЁЯРж Twitter ЁЯРж</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ЁЯОЩя╕П Twitch ЁЯОЩя╕П</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ЁЯОе Youtube ЁЯОе</strong></a></summary>

* рдХреНрдпрд╛ рдЖрдк **рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХрдВрдкрдиреА** рдореЗрдВ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ? рдХреНрдпрд╛ рдЖрдк рдЕрдкрдиреА рдХрдВрдкрдиреА рдХреЛ **рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд рдХрд░рдирд╛** рдЪрд╛рд╣рддреЗ рд╣реИрдВ? рдпрд╛ рдХреНрдпрд╛ рдЖрдкрдХреЛ **PEASS рдХреА рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рдХрд╛ рдЙрдкрдпреЛрдЧ** рдХрд░рдиреЗ рдХреА рдЗрдЪреНрдЫрд╛ рд╣реИ? [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ!
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFT рд╕рдВрдЧреНрд░рд╣**](https://opensea.io/collection/the-peass-family)
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks swag**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** [**ЁЯТм**](https://emojipedia.org/speech-balloon/) [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ рдпрд╛ рдореБрдЭреЗ **Twitter** рдкрд░ **рдлрд╝реЙрд▓реЛ** рдХрд░реЗрдВ [**ЁЯРж**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ,** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **рдФрд░** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **рдореЗрдВ PR рдЬрдорд╛ рдХрд░рдХреЗред**

</details>
