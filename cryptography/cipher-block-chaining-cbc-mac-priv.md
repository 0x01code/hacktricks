<details>

<summary><strong>AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рд╢реВрдиреНрдп рд╕реЗ рдирд╛рдпрдХ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ [**telegram group**](https://t.me/peass) рдореЗрдВ рдпрд╛ **Twitter** ЁЯРж рдкрд░ рдореБрдЭреЗ **рдлреЙрд▓реЛ** рдХрд░реЗрдВ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВред

</details>


# CBC

рдпрджрд┐ **cookie** **рдХреЗрд╡рд▓** **username** рд╣реИ (рдпрд╛ cookie рдХрд╛ рдкрд╣рд▓рд╛ рднрд╛рдЧ username рд╣реИ) рдФрд░ рдЖрдк "**admin**" username рдХрд╛ рдЕрдиреБрдХрд░рдг рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВред рддрдм, рдЖрдк username **"bdmin"** рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ cookie рдХреЗ **рдкрд╣рд▓реЗ рдмрд╛рдЗрдЯ** рдХрд╛ **bruteforce** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

# CBC-MAC

рдХреНрд░рд┐рдкреНрдЯреЛрдЧреНрд░рд╛рдлреА рдореЗрдВ, **cipher block chaining message authentication code** (**CBC-MAC**) рдПрдХ рдмреНрд▓реЙрдХ рд╕рд┐рдлрд░ рд╕реЗ рдореИрд╕реЗрдЬ рдСрдереЗрдВрдЯрд┐рдХреЗрд╢рди рдХреЛрдб рдмрдирд╛рдиреЗ рдХреА рддрдХрдиреАрдХ рд╣реИред рдореИрд╕реЗрдЬ рдХреЛ рдХрд┐рд╕реА рдмреНрд▓реЙрдХ рд╕рд┐рдлрд░ рдПрд▓реНрдЧреЛрд░рд┐рдердо рдореЗрдВ CBC рдореЛрдб рдореЗрдВ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рддрд╛рдХрд┐ **рдмреНрд▓реЙрдХреНрд╕ рдХреА рдПрдХ рд╢реНрд░реГрдВрдЦрд▓рд╛ рдмрдиреЗ рдЬрд┐рд╕рдореЗрдВ рдкреНрд░рддреНрдпреЗрдХ рдмреНрд▓реЙрдХ рдкрд┐рдЫрд▓реЗ рдмреНрд▓реЙрдХ рдХреЗ рд╕рд╣реА рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддрд╛ рд╣реИ**ред рдпрд╣ рдЖрдкрд╕реА рдирд┐рд░реНрднрд░рддрд╛ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддреА рд╣реИ рдХрд┐ рдкреНрд▓реЗрдирдЯреЗрдХреНрд╕реНрдЯ рдХреЗ **рдХрд┐рд╕реА рднреА** **рдмрд┐рдЯреНрд╕** рдореЗрдВ **рдкрд░рд┐рд╡рд░реНрддрди** рд╕реЗ **рдЕрдВрддрд┐рдо рдПрдиреНрдХреНрд░рд┐рдкреНрдЯреЗрдб рдмреНрд▓реЙрдХ** рдореЗрдВ рдРрд╕рд╛ **рдкрд░рд┐рд╡рд░реНрддрди** рд╣реЛрдЧрд╛ рдЬрд┐рд╕реЗ рдмреНрд▓реЙрдХ рд╕рд┐рдлрд░ рдХреА рдХреБрдВрдЬреА рдЬрд╛рдиреЗ рдмрд┐рдирд╛ рдкреВрд░реНрд╡рд╛рдиреБрдорд╛рдирд┐рдд рдпрд╛ рдкреНрд░рддрд┐рдХрд╛рд░ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ред

рдореИрд╕реЗрдЬ m рдХрд╛ CBC-MAC рдХреА рдЧрдгрдирд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, m рдХреЛ CBC рдореЛрдб рдореЗрдВ рд╢реВрдиреНрдп рдкреНрд░рд╛рд░рдВрднрд┐рдХ рд╡реЗрдХреНрдЯрд░ рдХреЗ рд╕рд╛рде рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдЕрдВрддрд┐рдо рдмреНрд▓реЙрдХ рдХреЛ рд░рдЦрд╛ рдЬрд╛рддрд╛ рд╣реИред рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЪрд┐рддреНрд░ рдЧреБрдкреНрдд рдХреБрдВрдЬреА k рдФрд░ рдмреНрд▓реЙрдХ рд╕рд┐рдлрд░ E рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдмреНрд▓реЙрдХреНрд╕![m\_{1}\\|m\_{2}\\|\cdots \\|m\_{x}](https://wikimedia.org/api/rest\_v1/media/math/render/svg/bbafe7330a5e40a04f01cc776c9d94fe914b17f5) рдХреА рдПрдХ рдореИрд╕реЗрдЬ рдХрд╛ CBC-MAC рдХреА рдЧрдгрдирд╛ рдХрд░рддрд╛ рд╣реИ:

![CBC-MAC structure (en).svg](https://upload.wikimedia.org/wikipedia/commons/thumb/b/bf/CBC-MAC\_structure\_\(en\).svg/570px-CBC-MAC\_structure\_\(en\).svg.png)

# Vulnerability

CBC-MAC рдореЗрдВ рдЖрдорддреМрд░ рдкрд░ **рдкреНрд░рдпреБрдХреНрдд IV 0 рд╣реЛрддрд╛ рд╣реИ**ред\
рдпрд╣ рдПрдХ рд╕рдорд╕реНрдпрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ 2 рдЬреНрдЮрд╛рдд рдореИрд╕реЗрдЬ (`m1` рдФрд░ `m2`) рд╕реНрд╡рддрдВрддреНрд░ рд░реВрдк рд╕реЗ 2 рд╣рд╕реНрддрд╛рдХреНрд╖рд░ (`s1` рдФрд░ `s2`) рдЙрддреНрдкрдиреНрди рдХрд░реЗрдВрдЧреЗред рдЗрд╕рд▓рд┐рдП:

* `E(m1 XOR 0) = s1`
* `E(m2 XOR 0) = s2`

рддрдм m1 рдФрд░ m2 рдХреЛ рдЬреЛрдбрд╝рдХрд░ рдмрдирд╛рдП рдЧрдП рдореИрд╕реЗрдЬ (m3) рд╕реЗ 2 рд╣рд╕реНрддрд╛рдХреНрд╖рд░ (s31 рдФрд░ s32) рдЙрддреНрдкрдиреНрди рд╣реЛрдВрдЧреЗ:

* `E(m1 XOR 0) = s31 = s1`
* `E(m2 XOR s1) = s32`

**рдЬрд┐рд╕реЗ рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдХреА рдХреБрдВрдЬреА рдЬрд╛рдиреЗ рдмрд┐рдирд╛ рдЧрдгрдирд╛ рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИред**

рдХрд▓реНрдкрдирд╛ рдХреАрдЬрд┐рдП рдХрд┐ рдЖрдк **8bytes** рдмреНрд▓реЙрдХреНрд╕ рдореЗрдВ рдирд╛рдо **Administrator** рдХреЛ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд░ рд░рд╣реЗ рд╣реИрдВ:

* `Administ`
* `rator\00\00\00`

рдЖрдк **Administ** (m1) рдирд╛рдо рдХрд╛ рдПрдХ username рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рд╣рд╕реНрддрд╛рдХреНрд╖рд░ (s1) рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред\
рдлрд┐рд░, рдЖрдк `rator\00\00\00 XOR s1` рдХреЗ рдкрд░рд┐рдгрд╛рдо рдХрд╛ рдПрдХ username рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВред рдпрд╣ `E(m2 XOR s1 XOR 0)` рдЙрддреНрдкрдиреНрди рдХрд░реЗрдЧрд╛ рдЬреЛ s32 рд╣реИред\
рдЕрдм, рдЖрдк s32 рдХрд╛ рдЙрдкрдпреЛрдЧ рдкреВрд░реЗ рдирд╛рдо **Administrator** рдХреЗ рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рдХреЗ рд░реВрдк рдореЗрдВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

### рд╕рд╛рд░рд╛рдВрд╢

1. username **Administ** (m1) рдХрд╛ рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ рдЬреЛ s1 рд╣реИ
2. username **rator\x00\x00\x00 XOR s1 XOR 0** рдХрд╛ рд╣рд╕реНрддрд╛рдХреНрд╖рд░ s32 рд╣реИред
3. cookie рдХреЛ s32 рдкрд░ рд╕реЗрдЯ рдХрд░реЗрдВ рдФрд░ рдпрд╣ user **Administrator** рдХреЗ рд▓рд┐рдП рдПрдХ рд╡реИрдз cookie рд╣реЛрдЧреАред

# IV рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рдХреЗ рд╣рдорд▓рд╛

рдпрджрд┐ рдЖрдк рдкреНрд░рдпреБрдХреНрдд IV рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рддреЛ рд╣рдорд▓рд╛ рдмрд╣реБрдд рдЖрд╕рд╛рди рд╣реЛ рд╕рдХрддрд╛ рд╣реИред\
рдпрджрд┐ cookies рдХреЗрд╡рд▓ username рдХреЛ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рддреЛ user "**administrator**" рдХрд╛ рдЕрдиреБрдХрд░рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдк user "**Administrator**" рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЖрдкрдХреЛ рдЗрд╕рдХреА cookie рдорд┐рд▓ рдЬрд╛рдПрдЧреАред\
рдЕрдм, рдпрджрд┐ рдЖрдк IV рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рддреЛ рдЖрдк IV рдХреЗ рдкрд╣рд▓реЗ рдмрд╛рдЗрдЯ рдХреЛ рдмрджрд▓ рд╕рдХрддреЗ рд╣реИрдВ рддрд╛рдХрд┐ **IV\[0] XOR "A" == IV'\[0] XOR "a"** рд╣реЛ рдФрд░ user **Administrator** рдХреЗ рд▓рд┐рдП cookie рдХреЛ рдлрд┐рд░ рд╕реЗ рдЙрддреНрдкрдиреНрди рдХрд░реЗрдВред рдпрд╣ cookie user **administrator** рдХрд╛ рдЕрдиреБрдХрд░рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкреНрд░рд╛рд░рдВрднрд┐рдХ **IV** рдХреЗ рд╕рд╛рде рд╡реИрдз рд╣реЛрдЧреАред

# рд╕рдВрджрд░реНрдн

рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП [https://en.wikipedia.org/wiki/CBC-MAC](https://en.wikipedia.org/wiki/CBC-MAC) рдкрд░ рдЬрд╛рдПрдВред


<details>

<summary><strong>AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рд╢реВрдиреНрдп рд╕реЗ рдирд╛рдпрдХ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ [**telegram group**](https://t.me/peass) рдореЗрдВ рдпрд╛ **Twitter** ЁЯРж рдкрд░ рдореБрдЭреЗ **рдлреЙрд▓реЛ** рдХрд░реЗрдВ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВред

</details>
