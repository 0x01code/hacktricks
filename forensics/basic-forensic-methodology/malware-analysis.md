# Analyse de Malware

<details>

<summary><strong>Apprenez le hacking AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**merchandising officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de hacking en soumettant des PR aux d√©p√¥ts github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## CheatSheets de Forensics

[https://www.jaiminton.com/cheatsheet/DFIR/#](https://www.jaiminton.com/cheatsheet/DFIR/)

## Services en Ligne

* [VirusTotal](https://www.virustotal.com/gui/home/upload)
* [HybridAnalysis](https://www.hybrid-analysis.com)
* [Koodous](https://koodous.com)
* [Intezer](https://analyze.intezer.com)
* [Any.Run](https://any.run/)

## Antivirus et Outils de D√©tection Hors Ligne

### Yara

#### Installation
```bash
sudo apt-get install -y yara
```
#### Pr√©parer les r√®gles

Utilisez ce script pour t√©l√©charger et fusionner toutes les r√®gles yara de malware depuis github : [https://gist.github.com/andreafortuna/29c6ea48adf3d45a979a78763cdc7ce9](https://gist.github.com/andreafortuna/29c6ea48adf3d45a979a78763cdc7ce9)\
Cr√©ez le r√©pertoire _**rules**_ et ex√©cutez-le. Cela cr√©era un fichier appel√© _**malware\_rules.yar**_ qui contient toutes les r√®gles yara pour les malwares.
```bash
wget https://gist.githubusercontent.com/andreafortuna/29c6ea48adf3d45a979a78763cdc7ce9/raw/4ec711d37f1b428b63bed1f786b26a0654aa2f31/malware_yara_rules.py
mkdir rules
python malware_yara_rules.py
```
#### Analyse Antivirus
```bash
yara -w malware_rules.yar image  #Scan 1 file
yara -w malware_rules.yar folder #Scan the whole folder
```
#### YaraGen : V√©rifier la pr√©sence de malware et Cr√©er des r√®gles

Vous pouvez utiliser l'outil [**YaraGen**](https://github.com/Neo23x0/yarGen) pour g√©n√©rer des r√®gles yara √† partir d'un binaire. Consultez ces tutoriels : [**Partie 1**](https://www.nextron-systems.com/2015/02/16/write-simple-sound-yara-rules/), [**Partie 2**](https://www.nextron-systems.com/2015/10/17/how-to-write-simple-but-sound-yara-rules-part-2/), [**Partie 3**](https://www.nextron-systems.com/2016/04/15/how-to-write-simple-but-sound-yara-rules-part-3/)
```bash
python3 yarGen.py --update
python3.exe yarGen.py --excludegood -m  ../../mals/
```
### ClamAV

#### Installation
```
sudo apt-get install -y clamav
```
#### Analyse Antivirus
```bash
sudo freshclam      #Update rules
clamscan filepath   #Scan 1 file
clamscan folderpath #Scan the whole folder
```
### [Capa](https://github.com/mandiant/capa)

**Capa** d√©tecte les **capacit√©s** potentiellement malveillantes dans les ex√©cutables : PE, ELF, .NET. Il trouve donc des √©l√©ments tels que les tactiques Att\&ck, ou des capacit√©s suspectes telles que :

* v√©rifier l'erreur OutputDebugString
* s'ex√©cuter en tant que service
* cr√©er un processus

Obtenez-le dans le [**d√©p√¥t Github**](https://github.com/mandiant/capa).

### IOCs

IOC signifie Indicateur de Compromission. Un IOC est un ensemble de **conditions qui identifient** un logiciel potentiellement ind√©sirable ou un **malware** confirm√©. Les √©quipes Blue utilisent ce type de d√©finition pour **rechercher ce genre de fichiers malveillants** dans leurs **syst√®mes** et **r√©seaux**.\
Partager ces d√©finitions est tr√®s utile car lorsqu'un malware est identifi√© sur un ordinateur et qu'un IOC pour ce malware est cr√©√©, d'autres √©quipes Blue peuvent l'utiliser pour identifier le malware plus rapidement.

Un outil pour cr√©er ou modifier des IOCs est [**IOC Editor**](https://www.fireeye.com/services/freeware/ioc-editor.html)**.**\
Vous pouvez utiliser des outils tels que [**Redline**](https://www.fireeye.com/services/freeware/redline.html) pour **rechercher des IOCs d√©finis dans un appareil**.

### Loki

[**Loki**](https://github.com/Neo23x0/Loki) est un scanner pour les Indicateurs Simples de Compromission.\
La d√©tection est bas√©e sur quatre m√©thodes de d√©tection :
```
1. File Name IOC
Regex match on full file path/name

2. Yara Rule Check
Yara signature matches on file data and process memory

3. Hash Check
Compares known malicious hashes (MD5, SHA1, SHA256) with scanned files

4. C2 Back Connect Check
Compares process connection endpoints with C2 IOCs (new since version v.10)
```
### Linux Malware Detect

[**Linux Malware Detect (LMD)**](https://www.rfxn.com/projects/linux-malware-detect/) est un scanner de malware pour Linux publi√© sous la licence GNU GPLv2, con√ßu pour les menaces rencontr√©es dans les environnements d'h√©bergement partag√©. Il utilise les donn√©es de menaces issues des syst√®mes de d√©tection d'intrusion en p√©riph√©rie de r√©seau pour extraire les malwares activement utilis√©s dans les attaques et g√©n√®re des signatures pour la d√©tection. De plus, les donn√©es de menaces proviennent √©galement des soumissions des utilisateurs avec la fonctionnalit√© de v√©rification LMD et des ressources de la communaut√© de malwares.

### rkhunter

Des outils comme [**rkhunter**](http://rkhunter.sourceforge.net) peuvent √™tre utilis√©s pour v√©rifier le syst√®me de fichiers √† la recherche de **rootkits** et de malwares potentiels.
```bash
sudo ./rkhunter --check -r / -l /tmp/rkhunter.log [--report-warnings-only] [--skip-keypress]
```
### FLOSS

[**FLOSS**](https://github.com/mandiant/flare-floss) est un outil qui tente de trouver des cha√Ænes de caract√®res obfusqu√©es dans les ex√©cutables en utilisant diff√©rentes techniques.

### PEpper

[PEpper](https://github.com/Th3Hurrican3/PEpper) v√©rifie certaines informations de base dans l'ex√©cutable (donn√©es binaires, entropie, URLs et IPs, quelques r√®gles yara).

### PEstudio

[PEstudio](https://www.winitor.com/download) est un outil qui permet d'obtenir des informations sur les ex√©cutables Windows telles que les imports, exports, en-t√™tes, mais v√©rifie √©galement virus total et trouve des techniques potentielles Att&ck.

### Detect It Easy(DiE)

[**DiE**](https://github.com/horsicq/Detect-It-Easy/) est un outil pour d√©tecter si un fichier est **chiffr√©** et √©galement trouver des **packers**.

### NeoPI

[**NeoPI**](https://github.com/CiscoCXSecurity/NeoPI) est un script Python qui utilise une vari√©t√© de **m√©thodes statistiques** pour d√©tecter le contenu **obfusqu√©** et **chiffr√©** dans les fichiers de texte/scripts. L'objectif de NeoPI est d'aider √† la **d√©tection de code de web shell cach√©**.

### **php-malware-finder**

[**PHP-malware-finder**](https://github.com/nbs-system/php-malware-finder) fait de son mieux pour d√©tecter le code **obfusqu√©**/**douteux** ainsi que les fichiers utilisant des fonctions **PHP** souvent utilis√©es dans les **malwares**/webshells.

### Signatures Binaires Apple

Lors de l'analyse d'un **√©chantillon de malware**, vous devriez toujours **v√©rifier la signature** du binaire car le **d√©veloppeur** qui l'a sign√© peut d√©j√† √™tre **associ√©** √† des **malwares**.
```bash
#Get signer
codesign -vv -d /bin/ls 2>&1 | grep -E "Authority|TeamIdentifier"

#Check if the app‚Äôs contents have been modified
codesign --verify --verbose /Applications/Safari.app

#Check if the signature is valid
spctl --assess --verbose /Applications/Safari.app
```
## Techniques de d√©tection

### Empilement de fichiers

Si vous savez qu'un dossier contenant les **fichiers** d'un serveur web a √©t√© **mis √† jour pour la derni√®re fois √† une certaine date**. **V√©rifiez** la **date** √† laquelle tous les **fichiers** du **serveur web ont √©t√© cr√©√©s et modifi√©s** et si une date est **suspecte**, examinez ce fichier.

### Lignes de base

Si les fichiers d'un dossier **n'auraient pas d√ª √™tre modifi√©s**, vous pouvez calculer le **hash** des **fichiers originaux** du dossier et les **comparer** avec les **actuels**. Tout ce qui a √©t√© modifi√© sera **suspect**.

### Analyse statistique

Lorsque les informations sont enregistr√©es dans des logs, vous pouvez **v√©rifier des statistiques telles que le nombre de fois que chaque fichier d'un serveur web a √©t√© acc√©d√©, car un web shell pourrait √™tre l'un des plus**.

<details>

<summary><strong>Apprenez le hacking AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**merchandising officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez**-moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de hacking en soumettant des PR aux d√©p√¥ts github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
