# рджрд┐рд▓рдЪрд╕реНрдк Windows рд░рдЬрд┐рд╕реНрдЯреНрд░реА рдХреБрдВрдЬрд┐рдпрд╛рдБ

## рджрд┐рд▓рдЪрд╕реНрдк Windows рд░рдЬрд┐рд╕реНрдЯреНрд░реА рдХреБрдВрдЬрд┐рдпрд╛рдБ

<details>

<summary><strong>Learn AWS hacking from zero to hero with</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* ЁЯТм [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ [**telegram рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ рдпрд╛ **Twitter** ЁЯРж рдкрд░ рдореБрдЭреЗ **рдлреЙрд▓реЛ** рдХрд░реЗрдВ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, HackTricks** рдХреЗ [**github repos**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗред

</details>

## **Windows рд╕рд┐рд╕реНрдЯрдо рдЬрд╛рдирдХрд╛рд░реА**

### рд╕рдВрд╕реНрдХрд░рдг

* **`Software\Microsoft\Windows NT\CurrentVersion`**: Windows рд╕рдВрд╕реНрдХрд░рдг, рд╕рд░реНрд╡рд┐рд╕ рдкреИрдХ, рд╕реНрдерд╛рдкрдирд╛ рд╕рдордп рдФрд░ рдкрдВрдЬреАрдХреГрдд рдорд╛рд▓рд┐рдХ

### рд╣реЛрд╕реНрдЯрдирд╛рдо

* **`System\ControlSet001\Control\ComputerName\ComputerName`**: рд╣реЛрд╕реНрдЯрдирд╛рдо

### рд╕рдордп рдХреНрд╖реЗрддреНрд░

* **`System\ControlSet001\Control\TimeZoneInformation`**: рд╕рдордп рдХреНрд╖реЗрддреНрд░

### рдЕрдВрддрд┐рдо рдкрд╣реБрдБрдЪ рд╕рдордп

* **`System\ControlSet001\Control\Filesystem`**: рдЕрдВрддрд┐рдо рдкрд╣реБрдБрдЪ рд╕рдордп (рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдпрд╣ `NtfsDisableLastAccessUpdate=1` рдХреЗ рд╕рд╛рде рдЕрдХреНрд╖рдо рд╣реИ, рдпрджрд┐ `0`, рддреЛ, рдпрд╣ рд╕рдХреНрд╖рдо рд╣реИ)ред
* рдЗрд╕реЗ рд╕рдХреНрд╖рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП: `fsutil behavior set disablelastaccess 0`

### рд╢рдЯрдбрд╛рдЙрди рд╕рдордп

* `System\ControlSet001\Control\Windows`: рд╢рдЯрдбрд╛рдЙрди рд╕рдордп
* `System\ControlSet001\Control\Watchdog\Display`: рд╢рдЯрдбрд╛рдЙрди рдЧрдгрдирд╛ (рдХреЗрд╡рд▓ XP)

### рдиреЗрдЯрд╡рд░реНрдХ рдЬрд╛рдирдХрд╛рд░реА

* **`System\ControlSet001\Services\Tcpip\Parameters\Interfaces{GUID_INTERFACE}`**: рдиреЗрдЯрд╡рд░реНрдХ рдЗрдВрдЯрд░рдлреЗрд╕
* **`Software\Microsoft\Windows NT\CurrentVersion\NetworkList\Signatures\Unmanaged` & `Software\Microsoft\Windows NT\CurrentVersion\NetworkList\Signatures\Managed` & `Software\Microsoft\Windows NT\CurrentVersion\NetworkList\Nla\Cache`**: рдиреЗрдЯрд╡рд░реНрдХ рдХрдиреЗрдХреНрд╢рди рдХрд╛ рдкрд╣рд▓рд╛ рдФрд░ рдЕрдВрддрд┐рдо рд╕рдордп рдФрд░ VPN рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдХрдиреЗрдХреНрд╢рди
* **`Software\Microsoft\WZCSVC\Parameters\Interfaces{GUID}` (XP рдХреЗ рд▓рд┐рдП) & `Software\Microsoft\Windows NT\CurrentVersion\NetworkList\Profiles`**: рдиреЗрдЯрд╡рд░реНрдХ рдкреНрд░рдХрд╛рд░ (0x47-рд╡рд╛рдпрд░рд▓реЗрд╕, 0x06-рдХреЗрдмрд▓, 0x17-3G) рдФрд░ рд╢реНрд░реЗрдгреА (0-рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ, 1-рдирд┐рдЬреА/рдШрд░, 2-рдбреЛрдореЗрди/рдХрд╛рдо) рдФрд░ рдЕрдВрддрд┐рдо рдХрдиреЗрдХреНрд╢рди

### рд╕рд╛рдЭрд╛ рдлрд╝реЛрд▓реНрдбрд░

* **`System\ControlSet001\Services\lanmanserver\Shares\`**: рд╕рд╛рдЭрд╛ рдлрд╝реЛрд▓реНрдбрд░ рдФрд░ рдЙрдирдХреА рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рдиред рдпрджрд┐ **Client Side Caching** (CSCFLAGS) рд╕рдХреНрд╖рдо рд╣реИ, рддреЛ, рд╕рд╛рдЭрд╛ рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреА рдПрдХ рдкреНрд░рддрд┐ рдХреНрд▓рд╛рдЗрдВрдЯреНрд╕ рдФрд░ рд╕рд░реНрд╡рд░ рдореЗрдВ `C:\Windows\CSC` рдореЗрдВ рд╕рд╣реЗрдЬреА рдЬрд╛рдПрдЧреА
* CSCFlag=0 -> рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдЙрди рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ рдЗрдВрдЧрд┐рдд рдХрд░рдирд╛ рд╣реЛрддрд╛ рд╣реИ рдЬрд┐рдиреНрд╣реЗрдВ рд╡рд╣ рдХреИрд╢ рдХрд░рдирд╛ рдЪрд╛рд╣рддрд╛ рд╣реИ
* CSCFlag=16 -> рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдХреИрд╢рд┐рдВрдЧ рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ред "рд╕рднреА рдлрд╝рд╛рдЗрд▓реЗрдВ рдФрд░ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдЬреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕рд╛рдЭрд╛ рдлрд╝реЛрд▓реНрдбрд░ рд╕реЗ рдЦреЛрд▓рддреЗ рд╣реИрдВ рд╡реЗ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдСрдлрд╝рд▓рд╛рдЗрди рдЙрдкрд▓рдмреНрдз рд╣реЛрддреЗ рд╣реИрдВ" "рдкреНрд░рджрд░реНрд╢рди рдХреЗ рд▓рд┐рдП рдЕрдиреБрдХреВрд▓рд┐рдд" рдЕрдирдЪреЗрдХ рдХреЗ рд╕рд╛рдеред
* CSCFlag=32 -> рдкрд┐рдЫрд▓реЗ рд╡рд┐рдХрд▓реНрдкреЛрдВ рдХреА рддрд░рд╣ "рдкреНрд░рджрд░реНрд╢рди рдХреЗ рд▓рд┐рдП рдЕрдиреБрдХреВрд▓рд┐рдд" рдЯрд┐рдХ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ
* CSCFlag=48 -> рдХреИрд╢ рдЕрдХреНрд╖рдо рд╣реИред
* CSCFlag=2048: рдпрд╣ рд╕реЗрдЯрд┐рдВрдЧ рдХреЗрд╡рд▓ Win 7 & 8 рдкрд░ рд╣реИ рдФрд░ рдпрд╣ "рд╕рд░рд▓ рдлрд╝рд╛рдЗрд▓ рд╕рд╛рдЭрд╛рдХрд░рдг" рдХреЛ рдЕрдХреНрд╖рдо рдХрд░рдиреЗ рдпрд╛ "рдЙрдиреНрдирдд" рд╕рд╛рдЭрд╛рдХрд░рдг рд╡рд┐рдХрд▓реНрдк рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рддрдХ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд╕реЗрдЯрд┐рдВрдЧ рд╣реИред рдпрд╣ "Homegroup" рдХреЗ рд▓рд┐рдП рднреА рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд╕реЗрдЯрд┐рдВрдЧ рдкреНрд░рддреАрдд рд╣реЛрддреА рд╣реИ
* CSCFlag=768 -> рдпрд╣ рд╕реЗрдЯрд┐рдВрдЧ рдХреЗрд╡рд▓ рд╕рд╛рдЭрд╛ рдкреНрд░рд┐рдВрдЯ рдЙрдкрдХрд░рдгреЛрдВ рдкрд░ рджреЗрдЦреА рдЧрдИ рдереАред

### рдСрдЯреЛрд╕реНрдЯрд╛рд░реНрдЯ рдкреНрд░реЛрдЧреНрд░рд╛рдо

* `NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Run`
* `NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\RunOnce`
* `Software\Microsoft\Windows\CurrentVersion\Runonce`
* `Software\Microsoft\Windows\CurrentVersion\Policies\Explorer\Run`
* `Software\Microsoft\Windows\CurrentVersion\Run`

### рдПрдХреНрд╕рдкреНрд▓реЛрд░рд░ рдЦреЛрдЬреЗрдВ

* `NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Explorer\WordwheelQuery`: рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдиреЗ рдПрдХреНрд╕рдкреНрд▓реЛрд░рд░/рд╕рд╣рд╛рдпрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХреНрдпрд╛ рдЦреЛрдЬрд╛ред `MRU=0` рд╡рд╛рд▓реА рд╡рд╕реНрддреБ рдЕрдВрддрд┐рдо рд╣реИред

### рдЯрд╛рдЗрдк рдХрд┐рдП рдЧрдП рдкрде

* `NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Explorer\TypedPaths`: рдПрдХреНрд╕рдкреНрд▓реЛрд░рд░ рдореЗрдВ рдЯрд╛рдЗрдк рдХрд┐рдП рдЧрдП рдкрде (рдХреЗрд╡рд▓ W10)

### рд╣рд╛рд▓ рдХреЗ рджрд╕реНрддрд╛рд╡реЗрдЬрд╝

* `NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Explorer\RecentDocs`: рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рджреНрд╡рд╛рд░рд╛ рдЦреЛрд▓реЗ рдЧрдП рд╣рд╛рд▓ рдХреЗ рджрд╕реНрддрд╛рд╡реЗрдЬрд╝
* `NTUSER.DAT\Software\Microsoft\Office{Version}{Excel|Word}\FileMRU`:рд╣рд╛рд▓ рдХреЗ рдСрдлрд┐рд╕ рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ред рд╕рдВрд╕реНрдХрд░рдг:
* 14.0 Office 2010
* 12.0 Office 2007
* 11.0 Office 2003
* 10.0 Office X
* `NTUSER.DAT\Software\Microsoft\Office{Version}{Excel|Word} UserMRU\LiveID_###\FileMRU`: рд╣рд╛рд▓ рдХреЗ рдСрдлрд┐рд╕ рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ред рд╕рдВрд╕реНрдХрд░рдг:
* 15.0 office 2013
* 16.0 Office 2016

### MRUs

* `NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Explorer\ComDlg32\LastVisitedMRU`
* `NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Explorer\ComDlg32\LasVisitedPidlMRU`

рдпрд╣ рдЗрдВрдЧрд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдХрд┐рд╕ рдкрде рд╕реЗ рдирд┐рд╖реНрдкрд╛рджрди рдпреЛрдЧреНрдп рдЪрд▓рд╛рдпрд╛ рдЧрдпрд╛ рдерд╛

* `NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Explorer\ComDlg32\Op enSaveMRU` (XP)
* `NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Explorer\ComDlg32\Op enSavePidlMRU`

рдпрд╣ рдЗрдВрдЧрд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдЦреБрд▓реА рд╡рд┐рдВрдбреЛ рдХреЗ рдЕрдВрджрд░ рдХреМрди рд╕реА рдлрд╝рд╛рдЗрд▓реЗрдВ рдЦреЛрд▓реА рдЧрдИрдВ

### рдЕрдВрддрд┐рдо рдЪрд▓рд╛рдП рдЧрдП рдХрдорд╛рдВрдб

* `NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Explorer\RunMRU`
* `NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Explorer\Policies\RunMR`

### рдпреВрдЬрд░ рдЕрд╕рд┐рд╕реНрдЯрдХреА

* `NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Explorer\UserAssist\{GUID}\Count`

GUID рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреА рдЖрдИрдбреА рд╣реИред рд╕рд╣реЗрдЬреА рдЧрдИ рдбреЗрдЯрд╛:

* рдЕрдВрддрд┐рдо рдЪрд▓рд╛рдиреЗ рдХрд╛ рд╕рдордп
* рдЪрд▓рд╛рдиреЗ рдХреА рдЧрд┐рдирддреА
* GUI рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХрд╛ рдирд╛рдо (рдЗрд╕рдореЗрдВ рдЕрдмреНрд╕ рдкрде рдФрд░ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рд╣реЛрддреА рд╣реИ)
* рдлреЛрдХрд╕ рд╕рдордп рдФрд░ рдлреЛрдХрд╕ рдирд╛рдо

## Shellbags

рдЬрдм рдЖрдк рдПрдХ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдЦреЛрд▓рддреЗ рд╣реИрдВ, Windows рд░рдЬрд┐рд╕реНрдЯреНрд░реА рдореЗрдВ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХреЛ рджреЗрдЦрдиреЗ рдХреЗ рддрд░реАрдХреЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдбреЗрдЯрд╛ рд╕рд╣реЗрдЬрддрд╛ рд╣реИред рдпреЗ рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐рдпрд╛рдБ Shellbags рдХреЗ рд░реВрдк рдореЗрдВ рдЬрд╛рдиреА рдЬрд╛рддреА рд╣реИрдВред

рдПрдХреНрд╕рдкреНрд▓реЛрд░рд░ рдкрд╣реБрдБрдЪ:

* `USRCLASS.DAT\Local Settings\Software\Microsoft\Windows\Shell\Bags`
* `USRCLASS.DAT\Local Settings\Software\Microsoft\Windows\Shell\BagMRU`

рдбреЗрд╕реНрдХрдЯреЙрдк рдкрд╣реБрдБрдЪ:

* `NTUSER.DAT\Software\Microsoft\Windows\Shell\BagMRU`
* `NTUSER.DAT\Software\Microsoft\Windows\Shell\Bags`

Shellbags рдХрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдк [**Shellbag Explorer**](https://ericzimmerman.github.io/#!index.md) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЖрдк рдлрд╝реЛрд▓реНрдбрд░ рдХреЗ **MAC рд╕рдордп** рдФрд░ рд╢реЗрд▓рдмреИрдЧ рдХреА рдирд┐рд░реНрдорд╛рдг рддрд┐рдерд┐ рдФрд░ рд╕рдВрд╢реЛрдзрд┐рдд рддрд┐рдерд┐ рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рдлрд╝реЛрд▓реНрдбрд░ рдХреА **рдкрд╣рд▓реА рдмрд╛рд░ рдФрд░ рдЕрдВрддрд┐рдо рдмрд╛рд░** рдкрд╣реБрдБрдЪ рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рд╣реИрдВред

рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЫрд╡рд┐ рд╕реЗ рджреЛ рдмрд╛рддреЗрдВ рдиреЛрдЯ рдХрд░реЗрдВ:

1. рд╣рдореЗрдВ **USB рдХреЗ рдлрд╝реЛрд▓реНрдбрд░реЛрдВ рдХреЗ рдирд╛рдо** рдХрд╛ рдкрддрд╛ рдЪрд▓рддрд╛ рд╣реИ рдЬреЛ **E:** рдореЗрдВ рдбрд╛рд▓рд╛ рдЧрдпрд╛ рдерд╛
2. рд╣рдореЗрдВ рдкрддрд╛ рдЪрд▓рддрд╛ рд╣реИ рдХрд┐ **рд╢реЗрд▓рдмреИрдЧ рдХрдм рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рдФрд░ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛** рдФрд░ рдлрд╝реЛрд▓реНрдбрд░ рдХрдм рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рдФрд░ рдкрд╣реБрдБрдЪрд╛ рдЧрдпрд╛

![](<../../../.gitbook/assets/image (475).png>)

## USB рдЬрд╛рдирдХрд╛рд░реА

### рдбрд┐рд╡рд╛рдЗрд╕ рдЬрд╛рдирдХрд╛рд░реА

рд░рдЬрд┐рд╕реНрдЯреНрд░реА `HKLM\SYSTEM\ControlSet001\Enum\USBSTOR` рдкреАрд╕реА рд╕реЗ рдЬреБрдбрд╝реЗ рд╣рд░ USB рдбрд┐рд╡рд╛рдЗрд╕ рдХреА рдирд┐рдЧрд░рд╛рдиреА рдХрд░рддреА рд╣реИред\
рдЗрд╕ рд░рдЬрд┐рд╕реНрдЯреНрд░реА рдореЗрдВ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкрд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:

* рдирд┐рд░реНрдорд╛рддрд╛ рдХрд╛ рдирд╛рдо
* рдЙрдд
