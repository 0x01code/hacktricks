# рджрд┐рд▓рдЪрд╕реНрдк Windows рд░рдЬрд┐рд╕реНрдЯреНрд░реА рдХреБрдВрдЬреА

## рджрд┐рд▓рдЪрд╕реНрдк Windows рд░рдЬрд┐рд╕реНрдЯреНрд░реА рдХреБрдВрдЬреА

<details>

<summary><strong>рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рддреЛ [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж рдкрд░ **рдлреЙрд▓реЛ** рдХрд░реЗрдВ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ рджреНрд╡рд╛рд░рд╛ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## **Windows рд╕рд┐рд╕реНрдЯрдо рдЬрд╛рдирдХрд╛рд░реА**

### рд╕рдВрд╕реНрдХрд░рдг

* **`Software\Microsoft\Windows NT\CurrentVersion`**: Windows рд╕рдВрд╕реНрдХрд░рдг, рд╕реЗрд╡рд╛ рдкреИрдХ, рд╕реНрдерд╛рдкрдирд╛ рд╕рдордп рдФрд░ рдкрдВрдЬреАрдХреГрдд рдорд╛рд▓рд┐рдХ

### рд╣реЛрд╕реНрдЯрдирд╛рдо

* **`System\ControlSet001\Control\ComputerName\ComputerName`**: рд╣реЛрд╕реНрдЯрдирд╛рдо

### рд╕рдордп рдХреНрд╖реЗрддреНрд░

* **`System\ControlSet001\Control\TimeZoneInformation`**: рд╕рдордп рдХреНрд╖реЗрддреНрд░

### рдЕрдВрддрд┐рдо рдкрд╣реБрдВрдЪ рд╕рдордп

* **`System\ControlSet001\Control\Filesystem`**: рдЕрдВрддрд┐рдо рдкрд╣реБрдВрдЪ рд╕рдордп (рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ `NtfsDisableLastAccessUpdate=1` рдХреЗ рд╕рд╛рде рдЕрдХреНрд╖рдо рд╣реИ, рдпрджрд┐ `0`, рддреЛ рдпрд╣ рд╕рдХреНрд╖рдо рд╣реИ)ред
* рдЗрд╕реЗ рд╕рдХреНрд╖рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП: `fsutil behavior set disablelastaccess 0`

### рд╢рдЯрдбрд╛рдЙрди рд╕рдордп

* `System\ControlSet001\Control\Windows`: рд╢рдЯрдбрд╛рдЙрди рд╕рдордп
* `System\ControlSet001\Control\Watchdog\Display`: рд╢рдЯрдбрд╛рдЙрди рдЧрд┐рдирддреА (рдХреЗрд╡рд▓ XP)

### рдиреЗрдЯрд╡рд░реНрдХ рд╕реВрдЪрдирд╛

* **`System\ControlSet001\Services\Tcpip\Parameters\Interfaces{GUID_INTERFACE}`**: рдиреЗрдЯрд╡рд░реНрдХ рдЗрдВрдЯрд░рдлреЗрд╕реЗрд╕
* **`Software\Microsoft\Windows NT\CurrentVersion\NetworkList\Signatures\Unmanaged` & `Software\Microsoft\Windows NT\CurrentVersion\NetworkList\Signatures\Managed` & `Software\Microsoft\Windows NT\CurrentVersion\NetworkList\Nla\Cache`**: рдкрд╣рд▓реА рдФрд░ рдЖрдЦрд┐рд░реА рдмрд╛рд░ рдиреЗрдЯрд╡рд░реНрдХ рдХрдиреЗрдХреНрд╢рди рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ рдФрд░ VPN рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдХрдиреЗрдХреНрд╢рди
* **`Software\Microsoft\WZCSVC\Parameters\Interfaces{GUID}` (XP рдХреЗ рд▓рд┐рдП) & `Software\Microsoft\Windows NT\CurrentVersion\NetworkList\Profiles`**: рдиреЗрдЯрд╡рд░реНрдХ рдкреНрд░рдХрд╛рд░ (0x47-рд╡рд╛рдпрд░рд▓реЗрд╕, 0x06-рдХреЗрдмрд▓, 0x17-3G) рдФрд░ рд╢реНрд░реЗрдгреА (0-рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ, 1-рдирд┐рдЬреА/рдШрд░, 2-рдбреЛрдореЗрди/рдХрд╛рдо) рдФрд░ рдЕрдВрддрд┐рдо рдХрдиреЗрдХреНрд╢рди

### рд╕рд╛рдЭрд╛ рдлреЛрд▓реНрдбрд░

* **`System\ControlSet001\Services\lanmanserver\Shares\`**: рд╢реЗрдпрд░ рдлреЛрд▓реНрдбрд░ рдФрд░ рдЙрдирдХреА рд╡рд┐рдиреНрдпрд╛рд╕ред рдпрджрд┐ **рдХреНрд▓рд╛рдЗрдВрдЯ рд╕рд╛рдЗрдб рдХреИрд╢рд┐рдВрдЧ** (CSCFLAGS) рд╕рдХреНрд╖рдо рд╣реИ, рддреЛ, рд╕рд╛рдЭрд╛ рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреА рдПрдХ рдкреНрд░рддрд┐рд▓рд┐рдкрд┐ рдХреНрд▓рд╛рдЗрдВрдЯреНрд╕ рдФрд░ рд╕рд░реНрд╡рд░ рдореЗрдВ `C:\Windows\CSC` рдореЗрдВ рд╕рд╣реЗрдЬреА рдЬрд╛рдПрдЧреА
* CSCFlag=0 -> рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдЗрд╕рдХрд╛ рд╕рдВрдХреЗрдд рджреЗрдирд╛ рд╣реЛрдЧрд╛ рдЬрд┐рди рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ рд╡рд╣ рдХреИрд╢ рдХрд░рдирд╛ рдЪрд╛рд╣рддрд╛ рд╣реИ
* CSCFlag=16 -> рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдХреИрд╢рд┐рдВрдЧ рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ред "рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рджреНрд╡рд╛рд░рд╛ рд╕рд╛рдЭрд╛ рдлрд╝реЛрд▓реНрдбрд░ рд╕реЗ рдЦреЛрд▓реА рдЧрдИ рд╕рднреА рдлрд╝рд╛рдЗрд▓реЗрдВ рдСрдлрд╝рд▓рд╛рдЗрди рдЙрдкрд▓рдмреНрдз рд╣реЛрддреА рд╣реИрдВ" рдЬрд┐рд╕рдореЗрдВ "рдкреНрд░рджрд░реНрд╢рди рдХреЗ рд▓рд┐рдП рдЕрдиреБрдХреВрд▓рд┐рдд рдХрд░реЗрдВ" рдЕрдЪрд┐рдиреНрд╣рд┐рдд рд╣реИред
* CSCFlag=32 -> рдкрд┐рдЫрд▓реЗ рд╡рд┐рдХрд▓реНрдкреЛрдВ рдХреА рддрд░рд╣ "рдкреНрд░рджрд░реНрд╢рди рдХреЗ рд▓рд┐рдП рдЕрдиреБрдХреВрд▓рд┐рдд рдХрд░реЗрдВ" рдЯрд┐рдХрд╛ рд╣реИ
* CSCFlag=48 -> рдХреИрд╢ рдЕрдХреНрд╖рдо рд╣реИред
* CSCFlag=2048: рдпрд╣ рд╕реЗрдЯрд┐рдВрдЧ рдХреЗрд╡рд▓ рд╡рд┐рдВрдбреЛрдЬ 7 рдФрд░ 8 рдкрд░ рд╣реИ рдФрд░ рдЬрдм рддрдХ рдЖрдк "рд╕рд┐рдореНрдкрд▓ рдлрд╝рд╛рдЗрд▓ рд╕реЗрдпрд░рд┐рдВрдЧ" рдХреЛ рдЕрдХреНрд╖рдо рдирд╣реАрдВ рдХрд░рддреЗ рдпрд╛ "рдЙрдиреНрдирдд" рд╕рд╛рдЭрд╛ рдХрд░рдиреЗ рдХрд╛ рд╡рд┐рдХрд▓реНрдк рдирд╣реАрдВ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ, рддрдм рддрдХ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд╕реЗрдЯрд┐рдВрдЧ рд╣реИред рдпрд╣ "рд╣реЛрдордЧреНрд░реБрдк" рдХреЗ рд▓рд┐рдП рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд╕реЗрдЯрд┐рдВрдЧ рднреА рд▓рдЧрддрд╛ рд╣реИред
* CSCFlag=768 -> рдпрд╣ рд╕реЗрдЯрд┐рдВрдЧ рдХреЗрд╡рд▓ рд╕рд╛рдЭрд╛ рдкреНрд░рд┐рдВрдЯ рдЙрдкрдХрд░рдгреЛрдВ рдкрд░ рджреЗрдЦрд╛ рдЧрдпрд╛ рдерд╛ред

### рдСрдЯреЛрд╕реНрдЯрд╛рд░реНрдЯ рдкреНрд░реЛрдЧреНрд░рд╛рдо

* `NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Run`
* `NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\RunOnce`
* `Software\Microsoft\Windows\CurrentVersion\Runonce`
* `Software\Microsoft\Windows\CurrentVersion\Policies\Explorer\Run`
* `Software\Microsoft\Windows\CurrentVersion\Run`

### рдПрдХреНрд╕рдкреНрд▓реЛрд░рд░ рдЦреЛрдЬреЗрдВ

* `NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Explorer\WordwheelQuery`: рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рджреНрд╡рд╛рд░рд╛ рдПрдХреНрд╕рдкреНрд▓реЛрд░рд░/рд╣реЗрд▓реНрдкрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЦреЛрдЬрд╛ рдЧрдпрд╛ рдХреНрдпрд╛ рд╣реИред `MRU=0` рд╡рд╛рд▓рд╛ рдЖрдЗрдЯрдо рдЖрдЦрд┐рд░реА рд╣реИред

### рдЯрд╛рдЗрдк рдХрд┐рдП рдЧрдП рдкрде

* `NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Explorer\TypedPaths`: рдПрдХреНрд╕рдкреНрд▓реЛрд░рд░ рдореЗрдВ рдЯрд╛рдЗрдк рдХрд┐рдП рдЧрдП рдкрде (рдХреЗрд╡рд▓ W10)

### рд╣рд╛рд▓ рдХреЗ рджрд╕реНрддрд╛рд╡реЗрдЬрд╝

* `NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Explorer\RecentDocs`: рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рджреНрд╡рд╛рд░рд╛ рдЦреЛрд▓реЗ рдЧрдП рд╣рд╛рд▓ рдХреЗ рджрд╕реНрддрд╛рд╡реЗрдЬрд╝
* `NTUSER.DAT\Software\Microsoft\Office{Version}{Excel|Word}\FileMRU`: рд╣рд╛рд▓ рдХреЗ рдСрдлрд┐рд╕ рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ред рд╕рдВрд╕реНрдХрд░рдг:
* 14.0 рдСрдлрд┐рд╕ 2010
* 12.0 рдСрдлрд┐рд╕ 2007
* 11.0 рдСрдлрд┐рд╕ 2003
* 10.0 рдСрдлрд┐рд╕ X
* `NTUSER.DAT\Software\Microsoft\Office{Version}{Excel|Word} UserMRU\LiveID_###\FileMRU`: рд╣рд╛рд▓ рдХреЗ рдСрдлрд┐рд╕ рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ред рд╕рдВрд╕реНрдХрд░рдг:
* 15.0 рдСрдлрд┐рд╕ 2013
* 16.0 рдСрдлрд┐рд╕ 2016

### MRUs

* `NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Explorer\ComDlg32\LastVisitedMRU`
* `NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Explorer\ComDlg32\LasVisitedPidlMRU`

рдХреЛрдб рдХреЗ рдкрде рдХреЛ рджрд░реНрд╢рд╛рддрд╛ рд╣реИ рдЬрд╣рд╛рдВ рд╕реЗ рдХрд╛рд░реНрдпрдХреНрд░рдо рдЪрд▓рд╛рдпрд╛ рдЧрдпрд╛ рдерд╛

* `NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Explorer\ComDlg32\Op enSaveMRU` (XP)
* `NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Explorer\ComDlg32\Op enSavePidlMRU`

рдЦрд┐рдбрд╝рдХреА рдХреЗ рдЕрдВрджрд░ рдЦреЛрд▓реА рдЧрдИ рдлрд╝рд╛рдЗрд▓реЗрдВ рджрд░реНрд╢рд╛рддрд╛ рд╣реИ

### рдЕрдВрддрд┐рдо рд░рди рдХрдорд╛рдВрдбреНрд╕

* `NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Explorer\RunMRU`
* `NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Explorer\Policies\RunMR`

### рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕рд╣рд╛рдпрдХреА

* `NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Explorer\UserAssist\{GUID}\Count`

GUID рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреА рдкрд╣рдЪрд╛рди рд╣реИред рдбреЗрдЯрд╛ рд╕рд╣реЗрдЬрд╛ рдЧрдпрд╛ рд╣реИ:

* рдЕрдВрддрд┐рдо рд░рди рд╕рдордп
* рд░рди рдЧрд┐рдирддреА
* GUI рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдирд╛рдо (рдЗрд╕рдореЗрдВ рдЕрдмреНрд╕ рдкрде рдФрд░ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рд╢рд╛рдорд┐рд▓ рд╣реИ)
* рдлреЛрдХрд╕ рд╕рдордп рдФрд░ рдлреЛрдХрд╕ рдирд╛рдо

## рд╢реЗрд▓рдмреИрдЧреНрд╕

рдЬрдм рдЖрдк рдПрдХ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдЦреЛрд▓рддреЗ рд╣реИрдВ, рддреЛ Windows рд░рдЬрд┐рд╕реНрдЯреНрд░реА рдореЗрдВ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХреЛ рдХреИрд╕реЗ рджрд┐рдЦрд╛рдирд╛ рд╣реИ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдбреЗрдЯрд╛ рд╕рд╣реЗрдЬрддрд╛ рд╣реИред рдЗрди рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐рдпреЛрдВ рдХреЛ рд╢реЗрд▓рдмреИрдЧреНрд╕ рдХреЗ рд░реВрдк рдореЗрдВ рдЬрд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИред

рдПрдХреНрд╕рдкреНрд▓реЛрд░рд░ рдкрд╣реБрдВрдЪ:

* `USRCLASS.DAT\Local Settings\Software\Microsoft\Windows\Shell\Bags`
* `USRCLASS.DAT\Local Settings\Software\Microsoft\Windows\Shell\BagMRU`

рдбреЗрд╕реНрдХрдЯреЙрдк рдкрд╣реБрдВрдЪ:

* `NTUSER.DAT\Software\Microsoft\Windows\Shell\BagMRU`
* `NTUSER.DAT\Software\Microsoft\Windows\Shell\Bags`

рд╢реЗрд▓рдмреИрдЧреНрд╕ рдХрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдк [**Shellbag Explorer**](https://ericzimmerman.github.io/#!index.md) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЖрдкрдХреЛ рдлреЛрд▓реНрдбрд░ рдХреЗ **MAC рд╕рдордп** рдФрд░ рд╢реЗрд▓рдмреИрдЧ рдХреЗ **рдирд┐рд░реНрдорд╛рдг рддрд┐рдерд┐ рдФрд░ рд╕рдВрд╢реЛрдзрди рддрд┐рдерд┐** рднреА рдорд┐рд▓реЗрдЧреА рдЬреЛ рдкрд╣рд▓реА рдмрд╛рд░ рдФрд░ рдЖрдЦрд┐рд░реА рдмрд╛рд░ рдлрд╝реЛрд▓реНрдбрд░ рддрдХ рдкрд╣реБрдВрдЪрд╛ рдЧрдпрд╛ рдерд╛ рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рд╣реИрдВред

рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЫрд╡рд┐ рд╕реЗ 2 рдмрд╛рддреЗрдВ рдзреНрдпрд╛рди рджреЗрдВ:

1. рд╣рдореЗрдВ рдкрддрд╛ рд╣реИ рдХрд┐ **E: рдореЗрдВ рдбрд╛рд▓реА рдЧрдИ USB** рдХреЗ **рдлреЛрд▓реНрдбрд░реЛрдВ рдХрд╛ рдирд╛рдо** рдХреНрдпрд╛ рдерд╛
2. рд╣рдореЗрдВ рдкрддрд╛ рд╣реИ рдХрд┐ **рд╢реЗрд▓рдмреИрдЧ рдХрдм рдмрдирд╛рдпрд╛ рдФрд░ рд╕рдВрд╢реЛрдзрд┐рдд** рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ рдФрд░ рдлреЛрд▓реНрдбрд░ рдХрдм рдмрдирд╛рдпрд╛ рдФрд░ рдкрд╣реБрдВрдЪрд╛ рдЧрдпрд╛ рдерд╛

![](<../../../.gitbook/assets/image (475).png>)

## USB рдЬрд╛рдирдХрд╛рд░реА

### рдбрд┐рд╡рд╛рдЗрд╕ рдЬрд╛рдирдХрд╛рд░реА

рд░рдЬрд┐рд╕реНрдЯреНрд░реА `HKLM\SYSTEM\ControlSet001\Enum\USBSTOR` рдкреАрд╕реА рд╕
