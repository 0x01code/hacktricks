# Docker рдлреЛрд░реЗрдВрд╕рд┐рдХреНрд╕

<details>

<summary><strong>AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рд╢реВрдиреНрдп рд╕реЗ рд▓реЗрдХрд░ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ**, рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рдПрдХреНрд╕рдХреНрд▓реВрд╕рд┐рд╡ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ [**telegram group**](https://t.me/peass) рдпрд╛ **Twitter** рдкрд░ ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm) рдХреЛ **рдлреЙрд▓реЛ рдХрд░реЗрдВ**.
* [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╢реЗрдпрд░ рдХрд░реЗрдВред

</details>

## рдХрдВрдЯреЗрдирд░ рд╕рдВрд╢реЛрдзрди

рд╢рдХ рд╣реИ рдХрд┐ рдХреБрдЫ docker рдХрдВрдЯреЗрдирд░ рд╕рдордЭреМрддрд╛ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛:
```bash
docker ps
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES
cc03e43a052a        lamp-wordpress      "./run.sh"          2 minutes ago       Up 2 minutes        80/tcp              wordpress
```
рдЖрдк рдЖрд╕рд╛рдиреА рд╕реЗ **рдЗрд╕ рдХрдВрдЯреЗрдирд░ рдореЗрдВ рдХрд┐рдП рдЧрдП рд╕рдВрд╢реЛрдзрдиреЛрдВ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рдЗрдореЗрдЬ рдХреЗ рд╕рдВрджрд░реНрдн рдореЗрдВ рд╣реИрдВ** рдЗрд╕рдХреЗ рд╕рд╛рде:
```bash
docker diff wordpress
C /var
C /var/lib
C /var/lib/mysql
A /var/lib/mysql/ib_logfile0
A /var/lib/mysql/ib_logfile1
A /var/lib/mysql/ibdata1
A /var/lib/mysql/mysql
A /var/lib/mysql/mysql/time_zone_leap_second.MYI
A /var/lib/mysql/mysql/general_log.CSV
...
```
рдкрд┐рдЫрд▓реЗ рдХрдорд╛рдВрдб рдореЗрдВ **C** рдХрд╛ рдорддрд▓рдм **Changed** рдФрд░ **A,** рдХрд╛ рдорддрд▓рдм **Added** рд╣реИред\
рдпрджрд┐ рдЖрдк рдкрд╛рддреЗ рд╣реИрдВ рдХрд┐ `/etc/shadow` рдЬреИрд╕реА рдХреЛрдИ рд░реЛрдЪрдХ рдлрд╛рдЗрд▓ рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрди рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рддреЛ рдЖрдк рдЙрд╕реЗ рдХрдВрдЯреЗрдирд░ рд╕реЗ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рджреБрд░реНрднрд╛рд╡рдирд╛рдкреВрд░реНрдг рдЧрддрд┐рд╡рд┐рдзрд┐ рдХреА рдЬрд╛рдВрдЪ рдХреЗ рд▓рд┐рдП рдЗрд╕реЗ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
docker cp wordpress:/etc/shadow.
```
рдЖрдк рдЗрд╕рдХреА рддреБрд▓рдирд╛ **рдореВрд▓ рдлрд╝рд╛рдЗрд▓ рдХреЗ рд╕рд╛рде рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ** рдПрдХ рдирдпрд╛ рдХрдВрдЯреЗрдирд░ рдЪрд▓рд╛рдХрд░ рдФрд░ рдЙрд╕рд╕реЗ рдлрд╝рд╛рдЗрд▓ рдирд┐рдХрд╛рд▓рдХрд░:
```bash
docker run -d lamp-wordpress
docker cp b5d53e8b468e:/etc/shadow original_shadow #Get the file from the newly created container
diff original_shadow shadow
```
рдпрджрд┐ рдЖрдк рдкрд╛рддреЗ рд╣реИрдВ рдХрд┐ **рдХреБрдЫ рд╕рдВрджрд┐рдЧреНрдз рдлрд╛рдЗрд▓ рдЬреЛрдбрд╝реА рдЧрдИ рдереА** рддреЛ рдЖрдк рдХрдВрдЯреЗрдирд░ рддрдХ рдкрд╣реБрдБрдЪ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЗрд╕реЗ рдЬрд╛рдВрдЪ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
docker exec -it wordpress bash
```
## рдЗрдореЗрдЬ рдореЙрдбрд┐рдлрд┐рдХреЗрд╢рдиреНрд╕

рдЬрдм рдЖрдкрдХреЛ рдПрдХреНрд╕рдкреЛрд░реНрдЯреЗрдб рдбреЙрдХрд░ рдЗрдореЗрдЬ (рд╕рдВрднрд╡рддрдГ `.tar` рдлреЙрд░реНрдореЗрдЯ рдореЗрдВ) рджреА рдЬрд╛рддреА рд╣реИ, рддреЛ рдЖрдк [**container-diff**](https://github.com/GoogleContainerTools/container-diff/releases) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ **рдореЙрдбрд┐рдлрд┐рдХреЗрд╢рдиреНрд╕ рдХрд╛ рд╕рд╛рд░рд╛рдВрд╢ рдирд┐рдХрд╛рд▓ рд╕рдХрддреЗ рд╣реИрдВ**:
```bash
docker save <image> > image.tar #Export the image to a .tar file
container-diff analyze -t sizelayer image.tar
container-diff analyze -t history image.tar
container-diff analyze -t metadata image.tar
```
рддрдм, рдЖрдк рдЗрдореЗрдЬ рдХреЛ **decompress** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ **blobs рддрдХ рдкрд╣реБрдБрдЪ** рд╕рдХрддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рдЖрдк рдкрд░рд┐рд╡рд░реНрддрдиреЛрдВ рдХреЗ рдЗрддрд┐рд╣рд╛рд╕ рдореЗрдВ рдкрд╛рдП рдЧрдП рд╕рдВрджрд┐рдЧреНрдз рдлрд╛рдЗрд▓реЛрдВ рдХреА рдЦреЛрдЬ рдХрд░ рд╕рдХреЗрдВ:
```bash
tar -xf image.tar
```
### рдореВрд▓ рд╡рд┐рд╢реНрд▓реЗрд╖рдг

рдЖрдк рдЪрд┐рддреНрд░ рд╕реЗ **рдореВрд▓ рдЬрд╛рдирдХрд╛рд░реА** рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЗрд╕реЗ рдЪрд▓рд╛рдХрд░:
```bash
docker inspect <image>
```
рдЖрдк **рдкрд░рд┐рд╡рд░реНрддрдиреЛрдВ рдХрд╛ рд╕рдВрдХреНрд╖рд┐рдкреНрдд рдЗрддрд┐рд╣рд╛рд╕** рднреА рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
docker history --no-trunc <image>
```
рдЖрдк **dockerfile рдХреЛ рдПрдХ рдЗрдореЗрдЬ рд╕реЗ** рдЗрд╕рдХреЗ рд╕рд╛рде рдЬрдирд░реЗрдЯ рднреА рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
alias dfimage="docker run -v /var/run/docker.sock:/var/run/docker.sock --rm alpine/dfimage"
dfimage -sV=1.36 madhuakula/k8s-goat-hidden-in-layers>
```
### Dive

рдбреЙрдХрд░ рдЗрдореЗрдЬреЗрд╕ рдореЗрдВ рдЬреЛрдбрд╝реЗ рдЧрдП/рд╕рдВрд╢реЛрдзрд┐рдд рдлрд╛рдЗрд▓реЛрдВ рдХреЛ рдвреВрдВрдврдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдк [**dive**](https://github.com/wagoodman/dive) (рдЗрд╕реЗ [**releases**](https://github.com/wagoodman/dive/releases/tag/v0.10.0) рд╕реЗ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ) рдЙрдкрдпреЛрдЧрд┐рддрд╛ рдХрд╛ рднреА рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
#First you need to load the image in your docker repo
sudo docker load < image.tar                                                                                                                                                                                                         1 тип
Loaded image: flask:latest

#And then open it with dive:
sudo dive flask:latest
```
рдпрд╣ рдЖрдкрдХреЛ **рдбреЙрдХрд░ рдЗрдореЗрдЬреЗрдЬ рдХреЗ рд╡рд┐рднрд┐рдиреНрди рдмреНрд▓реЙрдмреНрд╕ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдиреЗрд╡рд┐рдЧреЗрдЯ рдХрд░рдиреЗ** рдФрд░ рдЬрд╛рдВрдЪрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ рдХрд┐ рдХреМрди рд╕реА рдлрд╛рдЗрд▓реЗрдВ рд╕рдВрд╢реЛрдзрд┐рдд/рдЬреЛрдбрд╝реА рдЧрдИрдВред **рд▓рд╛рд▓** рдХрд╛ рдорддрд▓рдм рдЬреЛрдбрд╝рд╛ рдЧрдпрд╛ рд╣реИ рдФрд░ **рдкреАрд▓рд╛** рдХрд╛ рдорддрд▓рдм рд╕рдВрд╢реЛрдзрд┐рдд рд╣реИред рджреВрд╕рд░реЗ рджреГрд╢реНрдп рдореЗрдВ рдЬрд╛рдиреЗ рдХреЗ рд▓рд┐рдП **рдЯреИрдм** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ рдФрд░ рдлреЛрд▓реНрдбрд░реНрд╕ рдХреЛ рд╕рдВрдХреБрдЪрд┐рдд/рдЦреЛрд▓рдиреЗ рдХреЗ рд▓рд┐рдП **рд╕реНрдкреЗрд╕** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред

die рдХреЗ рд╕рд╛рде рдЖрдк рдЗрдореЗрдЬ рдХреЗ рд╡рд┐рднрд┐рдиреНрди рдЪрд░рдгреЛрдВ рдХреА рд╕рд╛рдордЧреНрд░реА рддрдХ рдкрд╣реБрдБрдЪрдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рдирд╣реАрдВ рд╣реЛрдВрдЧреЗред рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ рдкреНрд░рддреНрдпреЗрдХ рдкрд░рдд рдХреЛ **рдбрд┐рдХрдВрдкреНрд░реЗрд╕ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ рдФрд░ рдЙрд╕ рддрдХ рдкрд╣реБрдБрдЪрдирд╛ рд╣реЛрдЧрд╛**ред\
рдЖрдк рдЗрдореЗрдЬ рдХреА рд╕рднреА рдкрд░рддреЛрдВ рдХреЛ рдЙрд╕ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рд╕реЗ рдбрд┐рдХрдВрдкреНрд░реЗрд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд╣рд╛рдБ рдЗрдореЗрдЬ рдХреЛ рдбрд┐рдХрдВрдкреНрд░реЗрд╕ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛, рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрдорд╛рдВрдб рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдХреЗ:
```bash
tar -xf image.tar
for d in `find * -maxdepth 0 -type d`; do cd $d; tar -xf ./layer.tar; cd ..; done
```
## рдореЗрдореЛрд░реА рд╕реЗ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕

рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдЬрдм рдЖрдк рдПрдХ рд╣реЛрд╕реНрдЯ рдХреЗ рдЕрдВрджрд░ рдПрдХ docker рдХрдВрдЯреЗрдирд░ рдЪрд▓рд╛рддреЗ рд╣реИрдВ **рддреЛ рдЖрдк рд╣реЛрд╕реНрдЯ рд╕реЗ рдХрдВрдЯреЗрдирд░ рдкрд░ рдЪрд▓ рд░рд╣реА рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЛ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ** рдмрд╕ `ps -ef` рдЪрд▓рд╛рдХрд░ред

рдЗрд╕рд▓рд┐рдП (рд░реВрдЯ рдХреЗ рд░реВрдк рдореЗрдВ) рдЖрдк **рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреА рдореЗрдореЛрд░реА рдХреЛ рдбрдВрдк рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ** рд╣реЛрд╕реНрдЯ рд╕реЗ рдФрд░ **рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреЗ рд▓рд┐рдП рдЦреЛрдЬ** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдмрд╕ [**рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЙрджрд╛рд╣рд░рдг рдХреА рддрд░рд╣**](../../linux-hardening/privilege-escalation/#process-memory)ред

<details>

<summary><strong>AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рд╢реВрдиреНрдп рд╕реЗ рд▓реЗрдХрд░ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВред
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рдПрдХреНрд╕рдХреНрд▓реВрд╕рд┐рд╡ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣ред
* ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ [**telegram group**](https://t.me/peass) рдореЗрдВ рдпрд╛ **Twitter** рдкрд░ ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm) рдХреЛ **рдлреЙрд▓реЛ рдХрд░реЗрдВ**ред
* **рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВред

</details>
