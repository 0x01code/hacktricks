# Διαμερίσματα/Συστήματα Αρχείων/Ανάκτηση

## Διαμερίσματα/Συστήματα Αρχείων/Ανάκτηση

<details>

<summary><strong>Μάθετε το χάκινγκ του AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι για να υποστηρίξετε το HackTricks:

* Εάν θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**The PEASS Family**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε στη** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στη [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Μοιραστείτε τα χάκινγκ κόλπα σας υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>

## Διαμερίσματα

Ένας σκληρός δίσκος ή ένας **δίσκος SSD μπορεί να περιέχει διάφορα διαμερίσματα** με σκοπό τη φυσική διαχωρισμό των δεδομένων.\
Η **ελάχιστη** μονάδα ενός δίσκου είναι το **τομέας** (συνήθως αποτελείται από 512B). Έτσι, ο μέγεθος κάθε διαμερίσματος πρέπει να είναι πολλαπλάσιο του μεγέθους αυτού.

### MBR (master Boot Record)

Ανατίθεται στο **πρώτο τομέα του δίσκου μετά τα 446B του κώδικα εκκίνησης**. Αυτός ο τομέας είναι απαραίτητος για να υποδείξει στον υπολογιστή ποιο και από πού θα πρέπει να τοποθετηθεί ένα διαμέρισμα.\
Επιτρέπει έως και **4 διαμερίσματα** (το πολύ **1** μπορεί να είναι ενεργό/**εκκινήσιμο**). Ωστόσο, εάν χρειάζεστε περισσότερα διαμερίσματα, μπορείτε να χρησιμοποιήσετε **επεκτεινόμενα διαμερίσματα**. Το **τελευταίο byte** αυτού του πρώτου τομέα είναι η υπογραφή του εγγραφής εκκίνησης **0x55AA**. Μόνο ένα διαμέρισμα μπορεί να επισημανθεί ως ενεργό.\
Το MBR επιτρέπει **έως 2,2TB**.

![](<../../../.gitbook/assets/image (489).png>)

![](<../../../.gitbook/assets/image (490).png>)

Από τα **bytes 440 έως 443** του MBR μπορείτε να βρείτε τη **Σφραγίδα Δίσκου των Windows** (εάν χρησιμοποιείται το Windows). Το λογικό γράμμα οδήγησης του σκληρού δίσκου εξαρτάται από τη Σφραγίδα Δίσκου των Windows. Η αλλαγή αυτής της σφραγίδας μπορεί να εμποδίσει την εκκίνηση των Windows (εργαλείο: [**Active Disk Editor**](https://www.disk-editor.org/index.html)**)**.

![](<../../../.gitbook/assets/image (493).png>)

**Μορφή**

| Offset      | Μήκος      | Στοιχείο             |
| ----------- | ---------- | ------------------- |
| 0 (0x00)    | 446(0x1BE) | Κώδικας εκκίνησης           |
| 446 (0x1BE) | 16 (0x10)  | Πρώτο Διαμέρισμα     |
| 462 (0x1CE) | 16 (0x10)  | Δεύτερο Διαμέρισμα    |
| 478 (0x1DE) | 16 (0x10)  | Τρίτο Διαμέρισμα     |
| 494 (0x1EE) | 16 (0x10)  | Τέταρτο Διαμέρισμα    |
| 510 (0x1FE) | 2 (0x2)    | Υπογραφή 0x55 0xAA |

**Μορφή Εγγραφής Διαμερίσματος**

| Offset    | Μήκος   | Στοιχείο                                                   |
| --------- | -------- | ------------------------------------------------------ |
| 0 (0x00)  | 1 (0x01) | Σημαία ενεργού (0x80 = εκκινήσιμο)                          |
| 1 (0x01)  | 1 (0x01) | Έναρξη κεφαλής                                             |
| 2 (0x02)  | 1 (0x01) | Έναρξη τομέα (bits 0-5); υψηλότερα bits του κυλίνδρου (6- 7) |
| 3 (0x03)  | 1 (0x01) | Χαμηλότερα 8 bits του κυλίνδρου έναρξης                           |
| 4 (0x04)  | 1 (0x01) | Κωδικός τύπου διαμέρισματος (0x83 = Linux)                     |
| 5 (0x05)  | 1 (0x01) | Τελική κεφαλή                                               |
| 6 (0x06)  | 1 (0x01) | Τελικός τομέας (bits 0-5); υψηλότερα bits του κυλίνδρου (6- 7)   |
| 7 (0x07)  | 1 (0x01) | Χαμηλότερα 8 bits του κυλίνδρου τέλους                             |
| 8 (0x08)  | 4 (0x04) | Τομείς πριν από το διαμέρισμα (little endian)            |
| 12 (0x0C) | 4 (0x04) | Τομείς στο διαμέρισμα                                   |

Για να τοποθετήσετε ένα MBR σε Linux, πρ
```bash
#Mount MBR in Linux
mount -o ro,loop,offset=<Bytes>
#63x512 = 32256Bytes
mount -o ro,loop,offset=32256,noatime /path/to/image.dd /media/part/
```
**LBA (Λογική διεύθυνση μπλοκ)**

Η Λογική διεύθυνση μπλοκ (**LBA**) είναι ένα κοινό σχήμα που χρησιμοποιείται για τον καθορισμό της τοποθεσίας των μπλοκ δεδομένων που αποθηκεύονται σε συσκευές αποθήκευσης υπολογιστών, κυρίως συστήματα αποθήκευσης δευτερεύουσας μνήμης, όπως οι σκληροί δίσκοι. Η LBA είναι ένα ιδιαίτερα απλό γραμμικό σχήμα διευθυνσιοδότησης. Τα μπλοκ εντοπίζονται με έναν ακέραιο δείκτη, με το πρώτο μπλοκ να είναι LBA 0, το δεύτερο LBA 1 και ούτω καθεξής.

### GPT (Πίνακας Οδηγιών Κατατμήσεων)

Ο πίνακας οδηγιών κατατμήσεων GUID, γνωστός ως GPT, προτιμάται για τις βελτιωμένες δυνατότητές του σε σύγκριση με το MBR (Master Boot Record). Χαρακτηριστικό του είναι ο **παγκοσμίως μοναδικός αναγνωριστικός κωδικός** για τις κατατμήσεις, ο GPT ξεχωρίζει με πολλούς τρόπους:

- **Τοποθεσία και Μέγεθος**: Τόσο ο GPT όσο και ο MBR ξεκινούν από τον τομέα 0. Ωστόσο, ο GPT λειτουργεί με **64 bits**, αντίθετα με τα 32 bits του MBR.
- **Όρια Κατατμήσεων**: Ο GPT υποστηρίζει έως και **128 κατατμήσεις** σε συστήματα Windows και μπορεί να φιλοξενήσει έως και **9,4ZB** δεδομένων.
- **Ονόματα Κατατμήσεων**: Προσφέρει τη δυνατότητα να ονομάζει κατατμήσεις με έως και 36 χαρακτήρες Unicode.

**Ανθεκτικότητα Δεδομένων και Ανάκτηση**:

- **Αντιγραφή**: Αντίθετα από το MBR, ο GPT δεν περιορίζει την κατατμητοποίηση και τα δεδομένα εκκίνησης σε ένα μόνο σημείο. Αντιγράφει αυτά τα δεδομένα σε όλο το δίσκο, βελτιώνοντας την ακεραιότητα και την ανθεκτικότητα των δεδομένων.
- **Έλεγχος Κυκλικής Περιττότητας (CRC)**: Ο GPT χρησιμοποιεί το CRC για να εξασφαλίσει την ακεραιότητα των δεδομένων. Παρακολουθεί ενεργά τη διάβρωση των δεδομένων και, όταν ανιχνεύεται, ο GPT προσπαθεί να ανακτήσει τα κατεστραμμένα δεδομένα από άλλη θέση του δίσκου.

**Προστατευτικό MBR (LBA0)**:

- Ο GPT διατηρεί την αναστρεφόμενη συμβατότητα μέσω ενός προστατευτικού MBR. Αυτή η λειτουργία βρίσκεται στον χώρο του παλαιού MBR, αλλά σχεδιάστηκε για να αποτρέπει τις παλαιές εργαλειοθήκες που βασίζονται στο MBR να αντικαταστήσουν κατά λάθος τους δίσκους GPT, προστατεύοντας έτσι την ακεραιότητα των δεδομένων στους δίσκους με μορφή GPT.

![https://upload.wikimedia.org/wikipedia/commons/thumb/0/07/GUID_Partition_Table_Scheme.svg/800px-GUID_Partition_Table_Scheme.svg.png](<../../../.gitbook/assets/image (491).png>)

**Υβριδικό MBR (LBA 0 + GPT)**

[Από τη Wikipedia](https://en.wikipedia.org/wiki/GUID_Partition_Table)

Σε λειτουργικά συστήματα που υποστηρίζουν την εκκίνηση βασισμένη σε GPT μέσω των υπηρεσιών BIOS αντί για EFI, ο πρώτος τομέας μπορεί επίσης να χρησιμοποιηθεί για την αποθήκευση του πρώτου σταδίου του κώδικα του **εκκινητή**, αλλά **τροποποιημένος** για να αναγνωρίζει τις **κατατμήσεις GPT**. Ο εκκινητής στο MBR δεν πρέπει να υποθέτει μέγεθος τομέα 512 bytes.

**Κεφαλίδα πίνακα κατατμήσεων (LBA 1)**

[Από τη Wikipedia](https://en.wikipedia.org/wiki/GUID_Partition_Table)

Η κεφαλίδα του πίνακα κατατμήσεων καθορίζει τα χρήσιμα μπλοκ στο δίσκο. Καθορίζει επίσης τον αριθμό και το μέγεθος των καταχωρήσεων κατατμήσεων που αποτελ
## Συστήματα Αρχείων

### Λίστα συστημάτων αρχείων των Windows

* **FAT12/16**: MSDOS, WIN95/98/NT/200
* **FAT32**: 95/2000/XP/2003/VISTA/7/8/10
* **ExFAT**: 2008/2012/2016/VISTA/7/8/10
* **NTFS**: XP/2003/2008/2012/VISTA/7/8/10
* **ReFS**: 2012/2016

### FAT

Το σύστημα αρχείων **FAT (File Allocation Table)** σχεδιάστηκε γύρω από τον πυρήνα του, τον πίνακα εκχώρησης αρχείων, που βρίσκεται στην αρχή του όγκου. Αυτό το σύστημα προστατεύει τα δεδομένα διατηρώντας **δύο αντίγραφα** του πίνακα, εξασφαλίζοντας την ακεραιότητα των δεδομένων ακόμη και αν ένα από αυτά καταστραφεί. Ο πίνακας, μαζί με τον ριζικό φάκελο, πρέπει να βρίσκονται σε μια **σταθερή θέση**, κρίσιμη για τη διαδικασία εκκίνησης του συστήματος.

Η βασική μονάδα αποθήκευσης του συστήματος αρχείων είναι ένα **cluster, συνήθως 512B**, που αποτελείται από πολλούς τομείς. Το FAT έχει εξελιχθεί μέσω των εκδόσεων:

- **FAT12**, υποστηρίζοντας διευθύνσεις cluster 12-bit και διαχειριζόμενος έως 4078 clusters (4084 με UNIX).
- **FAT16**, προχωρώντας σε 16-bit διευθύνσεις, επιτρέποντας έως 65.517 clusters.
- **FAT32**, προχωρώντας περαιτέρω με 32-bit διευθύνσεις, επιτρέποντας εντυπωσιακά 268.435.456 clusters ανά όγκο.

Ένας σημαντικός περιορισμός σε όλες τις εκδόσεις του FAT είναι το **μέγιστο μέγεθος αρχείου 4GB**, που επιβάλλεται από το πεδίο 32-bit που χρησιμοποιείται για την αποθήκευση του μεγέθους του αρχείου.

Κύρια στοιχεία του ριζικού φακέλου, ιδιαίτερα για τα FAT12 και FAT16, περιλαμβάνουν:

- **Όνομα Αρχείου/Φακέλου** (έως 8 χαρακτήρες)
- **Χαρακτηριστικά**
- **Ημερομηνίες Δημιουργίας, Τροποποίησης και Τελευταίας Πρόσβασης**
- **Διεύθυνση Πίνακα FAT** (που υποδεικνύει τον αρχικό cluster του αρχείου)
- **Μέγεθος Αρχείου**

### EXT

Το **Ext2** είναι το πιο κοινό σύστημα αρχείων για **μη-καταγραφή** διαμερίσματα (**διαμερίσματα που δεν αλλάζουν πολύ**) όπως το διαμέρισμα εκκίνησης. Τα **Ext3/4** είναι **καταγραφής** και χρησιμοποιούνται συνήθως για τα **υπόλοιπα διαμερίσματα**.

## **Μεταδεδομένα**

Ορισμένα αρχεία περιέχουν μεταδεδομένα. Αυτές οι πληροφορίες αφορούν το περιεχόμενο του αρχείου, το οποίο μπορεί να είναι ενδιαφέρον για έναν αναλυτή, καθώς ανάλογα με τον τύπο του αρχείου, μπορεί να περιέχει πληροφορίες όπως:

* Τίτλος
* Έκδοση MS Office που χρησιμοποιήθηκε
* Συγγραφέας
* Ημερομηνίες δημιουργίας και τελευταίας τροποποίησης
* Μοντέλο της κάμερας
* Γεωγραφικές συντεταγμένες GPS
* Πληροφορίες εικόνας

Μπορείτε να χρησιμοποιήσετε εργαλεία όπως το [**exiftool**](https://exiftool.org) και το [**Metadiver**](https://www.easymetadata.com/metadiver-2/) για να λάβετε τα μεταδεδομένα ενός αρχείου.

## **Ανάκτηση Διαγραμμένων Αρχείων**

### Καταγεγραμμένα Διαγραμμένα Αρχεία

Όπως είδαμε προηγουμένως, υπάρχουν αρκετά μέρη όπου το αρχείο εξακολουθεί να αποθηκεύεται αφού έχει "διαγραφεί". Αυτό συμβαίνει επειδή συνήθως η διαγραφή ενός αρχείου από ένα σύστημα αρχείων απλώς το σημαίνει ως διαγραμμένο, αλλά τα δεδομένα δεν αγγίζονται. Έπειτα, είναι δυνατόν να επιθεω
