<details>

<summary><strong>Aprenda hacking no AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ quer ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**material oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **Junte-se ao grupo** üí¨ [**Discord**](https://discord.gg/hRep4RUj7f) ou ao grupo [**telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios github** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>


No Linux, **os tickets s√£o armazenados em caches de credenciais ou ccaches**. Existem 3 tipos principais, que indicam onde **os tickets podem ser encontrados:**

* **Arquivos**, por padr√£o na pasta **/tmp**, no formato **krb5cc\_%{uid}.**
* **Keyrings do Kernel**, um espa√ßo especial no kernel do Linux fornecido para armazenar chaves.
* **Mem√≥ria do processo**, usado quando apenas um processo precisa usar os tickets.

Para verificar qual tipo de armazenamento √© usado em uma m√°quina espec√≠fica, a vari√°vel _**default\_ccache\_name**_ deve ser verificada no arquivo **/etc/krb5.conf**, que por padr√£o tem permiss√£o de leitura para qualquer usu√°rio. Caso este par√¢metro esteja ausente, seu valor padr√£o √© _FILE:/tmp/krb5cc\_%{uid}_.

Para extrair **tickets das outras 2 fontes** (keyrings e processos), um excelente artigo, [**Kerberos Credential Thievery (GNU/Linux)**](https://www.delaat.net/rp/2016-2017/p97/report.pdf), publicado em 2017, explica maneiras de recuperar os tickets deles.

### Keyring - Do artigo

> O **kernel do Linux** possui um recurso chamado **keyrings**. Esta √© uma **√°rea de mem√≥ria residindo** dentro do kernel que √© usada para **gerenciar e reter chaves**.
>
> A chamada de sistema **keyctl** foi introduzida na vers√£o do kernel 2.6.10 5 . Isso fornece **aplica√ß√µes do espa√ßo do usu√°rio uma API** que pode ser usada para interagir com os keyrings do kernel.

> O **nome do keyring** em uso pode ser analisado a partir do **arquivo de configura√ß√£o do Kerberos /etc/krb5.conf** que tem permiss√£o de leitura habilitada para qualquer pessoa (octal 644) por padr√£o. Um atacante pode ent√£o aproveitar essa informa√ß√£o para **procurar por keyrings contendo tickets** e extrair os tickets. Um script de prova de conceito que implementa essa funcionalidade pode ser visto na Se√ß√£o A.2 **(hercules.sh)**. Em um keyring, o ccache √© armazenado como componentes. Como visto na Figura 2, um ccache de arquivo √© composto por 3 componentes distintos: cabe√ßalho, principal padr√£o e uma sequ√™ncia de credenciais. Um **keyring cont√©m o principal padr√£o e as credenciais**. Este script ir√° despejar esses componentes em arquivos separados. Em seguida, usando um **cabe√ßalho sintetizado pelo atacante**, essas pe√ßas s√£o combinadas na ordem correta para **reconstruir um ccache de arquivo**. Este arquivo reconstru√≠do pode ent√£o ser exfiltrado para uma m√°quina do atacante e usado para se passar por um usu√°rio do Kerberos. Um programa simples para gerar um cabe√ßalho de ccache v√°lido pode ser visto na Se√ß√£o A.3.

Baseado no **script heracles.sh** (do artigo), uma ferramenta em C que voc√™ pode usar (criada pelo autor do post completo) √© [**tickey**](https://github.com/TarlogicSecurity/tickey)**, e ela extrai tickets de keyrings:**
```
/tmp/tickey -i
```
**Esta informa√ß√£o foi retirada de:** [**https://www.tarlogic.com/en/blog/how-to-attack-kerberos/**](https://www.tarlogic.com/en/blog/how-to-attack-kerberos/)

<details>

<summary><strong>Aprenda hacking no AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ quer ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**material oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **Junte-se ao grupo** üí¨ [**Discord**](https://discord.gg/hRep4RUj7f) ou ao grupo [**telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios do GitHub** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
