<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks云 ☁️</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>🐦 推特 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 Youtube 🎥</strong></a></summary>

- 你在**网络安全公司**工作吗？你想在HackTricks中看到你的**公司广告**吗？或者你想获得**PEASS的最新版本或下载PDF格式的HackTricks**吗？请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！

- 发现我们的独家[**NFTs**](https://opensea.io/collection/the-peass-family)收藏品- [**The PEASS Family**](https://opensea.io/collection/the-peass-family)

- 获取[**官方PEASS和HackTricks周边产品**](https://peass.creator-spring.com)

- **加入** [**💬**](https://emojipedia.org/speech-balloon/) [**Discord群组**](https://discord.gg/hRep4RUj7f) 或 [**Telegram群组**](https://t.me/peass) 或 **关注**我在**Twitter**上的[**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**。**

- **通过向[hacktricks repo](https://github.com/carlospolop/hacktricks)和[hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)提交PR来分享你的黑客技巧**。

</details>


在Linux上，**票据存储在凭证缓存或ccache中**。有三种主要类型，用于指示**票据的存储位置**：

* **文件**，默认情况下存储在**/tmp**目录下，格式为**krb5cc\_%{uid}**。
* **内核密钥环**，Linux内核提供的用于存储密钥的特殊空间。
* **进程内存**，仅当一个进程需要使用票据时使用。

要验证特定机器上使用的存储类型，必须检查**/etc/krb5.conf**文件中的变量_**default\_ccache\_name**_** **，默认情况下该文件对任何用户都具有读取权限。如果缺少此参数，则其默认值为_FILE:/tmp/krb5cc\_%{uid}_。

为了从其他两个来源（密钥环和进程）提取**票据**，在2017年发布的一篇重要论文[**Kerberos Credential Thievery (GNU/Linux)**](https://www.delaat.net/rp/2016-2017/p97/report.pdf)中详细解释了从中恢复票据的方法。

### 密钥环 - 来自论文

> **Linux内核**有一个名为**密钥环**的功能。这是内核中的**一块内存区域**，用于**管理和保存密钥**。
>
> **keyctl系统调用**在内核版本2.6.10 5中引入。这为**用户空间应用程序提供了一个API**，可用于与内核密钥环进行交互。

> 正在使用的**密钥环的名称**可以从具有默认情况下任何用户的读取权限（八进制644）的**Kerberos配置文件/etc/krb5.conf**中解析出来。攻击者可以利用这些信息来**搜索包含密钥环和提取票据** 11。在一个密钥环中，ccache被存储为组件。如图2所示，文件ccache由3个不同的组件组成：头部、默认主体和一系列凭证。**密钥环保存默认主体和凭证**。该脚本将这些组件转储到单独的文件中。然后使用**攻击者合成的头部**以正确的顺序组合这些部分，以**重建文件ccache**。然后可以将这个重建的文件转移到攻击者的机器上，然后用于冒充Kerberos用户。生成有效ccache头部的简单程序可以在附录A.3中看到。

基于论文中的**heracles.sh脚本**，你可以使用一个由完整文章的作者创建的C工具[**tickey**](https://github.com/TarlogicSecurity/tickey)**，从密钥环中提取票据**：
```
/tmp/tickey -i
```
**这些信息来自：**[**https://www.tarlogic.com/en/blog/how-to-attack-kerberos/**](https://www.tarlogic.com/en/blog/how-to-attack-kerberos/)


<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks Cloud ☁️</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>🐦 Twitter 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 Youtube 🎥</strong></a></summary>

- 你在一家**网络安全公司**工作吗？想要在HackTricks中看到你的**公司广告**吗？或者你想要**获取PEASS的最新版本或下载PDF格式的HackTricks**吗？请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！

- 发现我们的独家[**NFTs**](https://opensea.io/collection/the-peass-family)收藏品——[**The PEASS Family**](https://opensea.io/collection/the-peass-family)

- 获取[**官方PEASS和HackTricks周边产品**](https://peass.creator-spring.com)

- **加入**[**💬**](https://emojipedia.org/speech-balloon/) [**Discord群组**](https://discord.gg/hRep4RUj7f)或[**电报群组**](https://t.me/peass)，或者**关注**我在**Twitter**上的[**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**。**

- **通过向[hacktricks repo](https://github.com/carlospolop/hacktricks)和[hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)提交PR来分享你的黑客技巧。**

</details>
