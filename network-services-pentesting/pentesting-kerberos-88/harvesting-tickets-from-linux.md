<details>

<summary><strong>Aprende hacking en AWS de cero a h√©roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver a tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF**, consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Consigue el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠gueme** en **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de github de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>


En Linux, **los tickets se almacenan en cach√©s de credenciales o ccaches**. Hay 3 tipos principales, que indican d√≥nde **se pueden encontrar los tickets:**

* **Archivos**, por defecto bajo el directorio **/tmp**, en la forma de **krb5cc\_%{uid}.**
* **Keyrings del Kernel**, un espacio especial en el kernel de Linux provisto para almacenar claves.
* **Memoria del proceso**, utilizada cuando solo un proceso necesita usar los tickets.

Para verificar qu√© tipo de almacenamiento se utiliza en una m√°quina espec√≠fica, se debe revisar la variable _**default\_ccache\_name**_ en el archivo **/etc/krb5.conf**, que por defecto tiene permiso de lectura para cualquier usuario. En caso de que falte este par√°metro, su valor predeterminado es _FILE:/tmp/krb5cc\_%{uid}_.

Para extraer **tickets de las otras 2 fuentes** (keyrings y procesos), un excelente art√≠culo, [**Kerberos Credential Thievery (GNU/Linux)**](https://www.delaat.net/rp/2016-2017/p97/report.pdf), publicado en 2017, explica formas de recuperar los tickets de ellos.

### Keyring - Del art√≠culo

> El **kernel de Linux** tiene una caracter√≠stica llamada **keyrings**. Esta es un **√°rea de memoria dentro** del kernel que se utiliza para **gestionar y retener claves**.
>
> La llamada al sistema **keyctl** se introdujo en la versi√≥n del kernel 2.6.10 5 . Esto proporciona a las **aplicaciones de espacio de usuario una API** que se puede utilizar para interactuar con los keyrings del kernel.

> El **nombre del keyring** en uso se puede analizar desde el **archivo de configuraci√≥n de Kerberos /etc/krb5.conf** que tiene habilitado el permiso de lectura para cualquiera (octal 644) por defecto. Un atacante puede entonces aprovechar esta informaci√≥n para **buscar keyrings que contengan tickets** y extraer los tickets. Un script de prueba de concepto que implementa esta funcionalidad se puede ver en la Secci√≥n A.2 **(hercules.sh)**. En un keyring, el ccache se almacena como componentes. Como se ve en la Figura 2, un ccache de archivo se compone de 3 componentes distintos: encabezado, principal por defecto y una secuencia de credenciales. Un **keyring contiene el principal por defecto y las credenciales**. Este script volcar√° estos componentes a archivos separados. Luego, utilizando un **encabezado sintetizado por el atacante**, estas piezas se combinan en el orden correcto para **reconstruir un ccache de archivo**. Este archivo reconstruido puede ser exfiltrado a una m√°quina atacante y luego utilizado para suplantar a un usuario de Kerberos. Un programa simple para generar un encabezado de ccache v√°lido se puede ver en la Secci√≥n A.3.

Basado en el **script heracles.sh** (del art√≠culo) una herramienta en C que puedes usar (creada por el autor del post completo) es [**tickey**](https://github.com/TarlogicSecurity/tickey)**, y extrae tickets de keyrings:**
```
/tmp/tickey -i
```
**Esta informaci√≥n fue tomada de:** [**https://www.tarlogic.com/en/blog/how-to-attack-kerberos/**](https://www.tarlogic.com/en/blog/how-to-attack-kerberos/)


<details>

<summary><strong>Aprende hacking en AWS de cero a h√©roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver a tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Consigue el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠gueme** en **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de GitHub** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
