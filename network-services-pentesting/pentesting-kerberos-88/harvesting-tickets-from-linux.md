<details>

<summary><strong>零基础学习 AWS 黑客技术直至成为专家</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS 红队专家)</strong></a><strong>！</strong></summary>

支持 HackTricks 的其他方式：

* 如果您希望在 HackTricks 中看到您的**公司广告**或**下载 HackTricks 的 PDF 版本**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取 [**官方 PEASS & HackTricks 商品**](https://peass.creator-spring.com)
* 发现 [**PEASS 家族**](https://opensea.io/collection/the-peass-family)，我们独家的 [**NFT 集合**](https://opensea.io/collection/the-peass-family)
* **加入** 💬 [**Discord 群组**](https://discord.gg/hRep4RUj7f) 或 [**telegram 群组**](https://t.me/peass) 或在 **Twitter** 🐦 上**关注**我 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github 仓库提交 PR 来分享您的黑客技巧。

</details>


在 Linux 上，**票据存储在凭证缓存或 ccaches 中**。有 3 种主要类型，指示**可以在哪里找到票据：**

* **文件**，默认位于 **/tmp** 目录下，形式为 **krb5cc\_%{uid}**。
* **内核密钥环**，Linux 内核中提供的用于存储密钥的特殊空间。
* **进程内存**，当只有一个进程需要使用票据时使用。

要验证特定机器中使用的存储类型，必须在 **/etc/krb5.conf** 文件中检查变量 _**default\_ccache\_name**_，该文件默认对任何用户都有读权限。如果缺少此参数，其默认值为 _FILE:/tmp/krb5cc\_%{uid}_。

为了从其他两个来源（密钥环和进程）提取**票据**，2017 年发布的一篇很好的论文 [**Kerberos Credential Thievery (GNU/Linux)**](https://www.delaat.net/rp/2016-2017/p97/report.pdf)，解释了从它们中恢复票据的方法。

### 密钥环 - 来自论文

> **Linux 内核**具有一个称为**密钥环**的功能。这是一个位于内核内的**内存区域**，用于**管理和保留密钥**。
>
> **keyctl 系统调用**在内核版本 2.6.10 中引入。这为**用户空间应用程序提供了一个 API**，可以用来与内核密钥环交互。

> 正在使用的**密钥环的名称**可以从**Kerberos 配置文件 /etc/krb5.conf**中解析出来，该文件默认对任何人都启用了读权限（八进制 644）。攻击者可以利用这些信息来**搜索包含票据**的密钥环并提取票据。在第 A.2 节中可以看到实现此功能的概念验证脚本 **(hercules.sh)**。在密钥环中，ccache 以组件形式存储。如图 2 所示，文件 ccache 由 3 个不同的组件组成：头部、默认主体和一系列凭证。**密钥环保存默认主体和凭证**。此脚本将这些组件转储到单独的文件中。然后使用**攻击者合成的头部**，这些部分按正确的顺序组合起来，**重建文件 ccache**。然后可以将重建的文件传送到攻击者的机器上，然后用来冒充 Kerberos 用户。在第 A.3 节中可以看到生成有效 ccache 头部的简单程序。

基于论文中的 **heracles.sh 脚本**，你可以使用的一个 C 工具（由完整帖子的作者创建）是 [**tickey**](https://github.com/TarlogicSecurity/tickey)**，它可以从密钥环中提取票据：**
```
/tmp/tickey -i
```
**以下信息摘自：** [**https://www.tarlogic.com/en/blog/how-to-attack-kerberos/**](https://www.tarlogic.com/en/blog/how-to-attack-kerberos/)


<details>

<summary><strong>通过</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>从零开始学习AWS黑客攻击！</strong></summary>

支持HackTricks的其他方式：

* 如果您希望在**HackTricks中看到您的公司广告**或**下载HackTricks的PDF**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取[**官方PEASS & HackTricks商品**](https://peass.creator-spring.com)
* 发现[**PEASS家族**](https://opensea.io/collection/the-peass-family)，我们独家的[**NFTs系列**](https://opensea.io/collection/the-peass-family)
* **加入** 💬 [**Discord群组**](https://discord.gg/hRep4RUj7f) 或 [**telegram群组**](https://t.me/peass) 或在 **Twitter** 🐦 上**关注**我 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github仓库提交PR来分享您的黑客技巧。

</details>
