# 111/TCP/UDP - Test d'intrusion Portmapper

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Expert en √©quipe rouge AWS de HackTricks)</strong></a><strong>!</strong></summary>

Autres fa√ßons de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts GitHub.

</details>

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

## Informations de base

**Portmapper** est un service utilis√© pour mapper les ports de services r√©seau aux num√©ros de programme **RPC** (Remote Procedure Call). Il agit comme un composant critique dans les **syst√®mes bas√©s sur Unix**, facilitant l'√©change d'informations entre ces syst√®mes. Le **port** associ√© √† **Portmapper** est fr√©quemment scann√© par les attaquants car il peut r√©v√©ler des informations pr√©cieuses. Ces informations incluent le type de **syst√®me d'exploitation Unix (OS)** en cours d'ex√©cution et des d√©tails sur les services disponibles sur le syst√®me. De plus, **Portmapper** est couramment utilis√© en conjonction avec **NFS (Network File System)**, **NIS (Network Information Service)** et d'autres **services bas√©s sur RPC** pour g√©rer efficacement les services r√©seau.

**Port par d√©faut :** 111/TCP/UDP, 32771 dans Oracle Solaris
```
PORT    STATE SERVICE
111/tcp open  rpcbind
```
## √ânum√©ration
```
rpcinfo irked.htb
nmap -sSUC -p111 192.168.10.1
```
Parfois, il ne vous donne aucune information, dans d'autres cas, vous obtiendrez quelque chose comme ceci :

![](<../.gitbook/assets/image (553).png>)

### Shodan

* `port:111 portmap`

## RPCBind + NFS

Si vous trouvez le service NFS, alors probablement vous pourrez lister et t√©l√©charger (et peut-√™tre t√©l√©verser) des fichiers :

![](<../.gitbook/assets/image (872).png>)

Consultez [2049 - Test d'intrusion du service NFS](nfs-service-pentesting.md) pour en savoir plus sur la fa√ßon de tester ce protocole.

## NIS

Explorer les vuln√©rabilit√©s de **NIS** implique un processus en deux √©tapes, commen√ßant par l'identification du service `ypbind`. La pierre angulaire de cette exploration est la d√©couverte du **nom de domaine NIS**, sans lequel le progr√®s est stopp√©.

![](<../.gitbook/assets/image (859).png>)

Le voyage d'exploration commence par l'installation des paquets n√©cessaires (`apt-get install nis`). L'√©tape suivante consiste √† utiliser `ypwhich` pour confirmer la pr√©sence du serveur NIS en le pingant avec le nom de domaine et l'IP du serveur, en veillant √† ce que ces √©l√©ments soient anonymis√©s pour des raisons de s√©curit√©.

La derni√®re √©tape cruciale implique la commande `ypcat` pour extraire des donn√©es sensibles, en particulier les mots de passe d'utilisateurs chiffr√©s. Ces hachages, une fois craqu√©s √† l'aide d'outils comme **John the Ripper**, r√©v√®lent des informations sur l'acc√®s au syst√®me et les privil√®ges.
```bash
# Install NIS tools
apt-get install nis
# Ping the NIS server to confirm its presence
ypwhich -d <domain-name> <server-ip>
# Extract user credentials
ypcat ‚Äìd <domain-name> ‚Äìh <server-ip> passwd.byname
```
### Fichiers NIF

| **Fichier principal** | **Carte(s)**                 | **Remarques**                           |
| --------------------- | ---------------------------- | --------------------------------------- |
| /etc/hosts            | hosts.byname, hosts.byaddr   | Contient les noms d'h√¥tes et les d√©tails IP |
| /etc/passwd           | passwd.byname, passwd.byuid  | Fichier de mots de passe utilisateur NIS |
| /etc/group            | group.byname, group.bygid    | Fichier de groupe NIS                   |
| /usr/lib/aliases      | mail.aliases                | D√©tails des alias de messagerie         |

## Utilisateurs RPC

Si vous trouvez le service **rusersd** r√©pertori√© de cette mani√®re :

![](<../.gitbook/assets/image (1041).png>)

Vous pourriez √©num√©rer les utilisateurs de la machine. Pour apprendre comment faire, consultez [1026 - Pentesting Rsusersd](1026-pentesting-rusersd.md).

## Contourner le port Portmapper filtr√©

Lors de la r√©alisation d'un **scan nmap** et de la d√©couverte de ports NFS ouverts avec le port 111 filtr√©, l'exploitation directe de ces ports n'est pas r√©alisable. Cependant, en **simulant un service portmapper localement et en cr√©ant un tunnel depuis votre machine** vers la cible, l'exploitation devient possible en utilisant des outils standard. Cette technique permet de contourner l'√©tat filtr√© du port 111, permettant ainsi l'acc√®s aux services NFS. Pour des instructions d√©taill√©es sur cette m√©thode, consultez l'article disponible √† [ce lien](https://medium.com/@sebnemK/how-to-bypass-filtered-portmapper-port-111-27cee52416bc).

## Shodan

* `Portmap`

## Laboratoires pour s'entra√Æner

* Pratiquez ces techniques sur la [**machine HTB Irked**](https://app.hackthebox.com/machines/Irked).

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

## Commandes automatiques HackTricks
```
Protocol_Name: Portmapper    #Protocol Abbreviation if there is one.
Port_Number:  43     #Comma separated if there is more than one.
Protocol_Description: PM or RPCBind        #Protocol Abbreviation Spelled out

Entry_1:
Name: Notes
Description: Notes for PortMapper
Note: |
Portmapper is a service that is utilized for mapping network service ports to RPC (Remote Procedure Call) program numbers. It acts as a critical component in Unix-based systems, facilitating the exchange of information between these systems. The port associated with Portmapper is frequently scanned by attackers as it can reveal valuable information. This information includes the type of Unix Operating System (OS) running and details about the services that are available on the system. Additionally, Portmapper is commonly used in conjunction with NFS (Network File System), NIS (Network Information Service), and other RPC-based services to manage network services effectively.

https://book.hacktricks.xyz/pentesting/pentesting-rpcbind

Entry_2:
Name: rpc info
Description: May give netstat-type info
Command: whois -h {IP} -p 43 {Domain_Name} && echo {Domain_Name} | nc -vn {IP} 43

Entry_3:
Name: nmap
Description: May give netstat-type info
Command: nmap -sSUC -p 111 {IP}
```
<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Expert de l'√©quipe rouge AWS de HackTricks)</strong></a><strong>!</strong></summary>

Autres fa√ßons de soutenir HackTricks:

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts github.

</details>
