# 111/TCP/UDP - ペンテスト ポートマッパー

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks Cloud ☁️</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>🐦 Twitter 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 Youtube 🎥</strong></a></summary>

* **サイバーセキュリティ企業**で働いていますか？ **HackTricksで会社を宣伝**したいですか？または、**PEASSの最新バージョンにアクセスしたり、HackTricksをPDFでダウンロード**したいですか？[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見しましょう。独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクションです。
* [**公式のPEASS＆HackTricksのグッズ**](https://peass.creator-spring.com)を手に入れましょう。
* [**💬**](https://emojipedia.org/speech-balloon/) [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**telegramグループ**](https://t.me/peass)に**参加**するか、**Twitter**で**フォロー**してください[**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**。**
* **ハッキングのトリックを共有するには、PRを** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **と** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **に提出してください。**

</details>

## 基本情報

Unixベースのシステム間で情報を提供します。このポートは頻繁にプローブされ、Nix OSの指紋を取得したり、利用可能なサービスに関する情報を取得するために使用されることがあります。このポートはNFS、NIS、または任意のRPCベースのサービスと共に使用されます。

**デフォルトポート:** 111/TCP/UDP、Oracle Solarisでは32771です。
```
PORT    STATE SERVICE
111/tcp open  rpcbind
```
## 列挙

RPCbindは、ネットワーク上のサービスを特定するために使用されるプロトコルです。RPCbindは、ポート111でリッスンし、RPC（Remote Procedure Call）サービスのポート番号をクライアントに提供します。

### RPCbindの列挙方法

1. **rpcinfoコマンド**を使用して、RPCbindサービスが実行されているホストを特定します。

   ```bash
   rpcinfo -p <target_ip>
   ```

   このコマンドは、指定したIPアドレスのホスト上で実行されているRPCサービスのリストを表示します。

2. **nmapスクリプト**を使用して、RPCbindサービスを特定します。

   ```bash
   nmap -p 111 --script rpcinfo <target_ip>
   ```

   このコマンドは、指定したIPアドレスのホスト上で実行されているRPCサービスのリストを表示します。

3. **rpcbindコマンド**を使用して、RPCbindサービスが提供するポート番号を特定します。

   ```bash
   rpcbind -p
   ```

   このコマンドは、ローカルホスト上で実行されているRPCサービスのポート番号を表示します。

### RPCbindの列挙結果の解釈

RPCbindの列挙結果には、ホスト上で実行されているRPCサービスのリストが含まれます。各サービスには、プログラム番号、バージョン番号、ポート番号、およびプロトコルが表示されます。

これらの情報を使用して、攻撃者は特定のサービスに対して攻撃を実行するための情報を収集することができます。また、特定のサービスが脆弱性を持っているかどうかを判断するための手がかりも得ることができます。
```
rpcinfo irked.htb
nmap -sSUC -p111 192.168.10.1
```
時には情報が得られないこともありますが、他の場合には次のような情報が得られることがあります：

![](<../.gitbook/assets/image (230).png>)

### Shodan

* `port:111 portmap`

## RPCBind + NFS

サービスNFSを見つけた場合、おそらくファイルの一覧表示やダウンロード（およびアップロード）ができるでしょう：

![](<../.gitbook/assets/image (232).png>)

このプロトコルをテストする方法については、[2049 - Pentesting NFS service](nfs-service-pentesting.md)を読んでください。

## NIS

サービス`ypbind`が実行されている場合：

![](<../.gitbook/assets/image (233).png>)

それを悪用することができます。ただし、まずはマシンのNISの「ドメイン名」を**推測する必要があります**（NISがインストールされると「ドメイン名」が設定されます）。「ドメイン名」を知らないと何もできません。

環境のNISドメイン名（この場合はexample.org）を取得したら、ypwhichコマンドを使用してNISサーバーにpingを送信し、ypcatを使用して機密情報を取得します。暗号化されたパスワードハッシュをJohn the Ripperに入力し、解読されたら、システムへのアクセスと特権を評価するために使用できます。
```bash
root@kali:~# apt-get install nis
root@kali:~# ypwhich -d example.org 192.168.10.1
potatohead.example.org
root@kali:~# ypcat –d example.org –h 192.168.10.1 passwd.byname
tiff:noR7Bk6FdgcZg:218:101::/export/home/tiff:/bin/bash
katykat:d.K5tGUWCJfQM:2099:102::/export/home/katykat:/bin/bash
james:i0na7pfgtxi42:332:100::/export/home/james:/bin/tcsh
florent:nUNzkxYF0Hbmk:199:100::/export/home/florent:/bin/csh
dave:pzg1026SzQlwc:182:100::/export/home/dave:/bin/bash
yumi:ZEadZ3ZaW4v9.:1377:160::/export/home/yumi:/bin/bash
```
| **マスターファイル** | **マップ**                   | **ノート**                           |
| ---------------- | --------------------------- | --------------------------------- |
| /etc/hosts       | hosts.byname, hosts.byaddr  | ホスト名とIPの詳細が含まれています |
| /etc/passwd      | passwd.byname, passwd.byuid | NISユーザーパスワードファイル         |
| /etc/group       | group.byname, group.bygid   | NISグループファイル                 |
| /usr/lib/aliases | mail.aliases                | メールエイリアスの詳細               |

## RPCユーザー

次のように**rusersd**サービスがリストされている場合：

![](<../.gitbook/assets/image (231).png>)

ボックスのユーザーを列挙することができます。詳細は[1026 - Pentesting Rsusersd](1026-pentesting-rusersd.md)を参照してください。

## フィルタリングされたポートマッパーポートのバイパス

nmapスキャン中にNFSなどのオープンポートが表示されるが、ポート111がフィルタリングされている場合、これらのポートを悪用することはできません。\
しかし、ローカルでポートマッパーサービスをシミュレートし、自分のマシンから被害者のマシンにNFSポートをトンネリングすることができれば、通常のツールを使用してこれらのサービスを悪用することができます。\
詳細は[https://medium.com/@sebnemK/how-to-bypass-filtered-portmapper-port-111-27cee52416bc](https://medium.com/@sebnemK/how-to-bypass-filtered-portmapper-port-111-27cee52416bc)を参照してください。

## Shodan

* `Portmap`

## 練習用のラボ

* これらの技術を[**Irked HTBマシン**](https://app.hackthebox.com/machines/Irked)で練習してください。

## HackTricks自動コマンド
```
Protocol_Name: Portmapper    #Protocol Abbreviation if there is one.
Port_Number:  43     #Comma separated if there is more than one.
Protocol_Description: PM or RPCBind        #Protocol Abbreviation Spelled out

Entry_1:
Name: Notes
Description: Notes for PortMapper
Note: |
Provides information between Unix based systems. Port is often probed, it can be used to fingerprint the Nix OS, and to obtain information about available services. Port used with NFS, NIS, or any rpc-based service.

https://book.hacktricks.xyz/pentesting/pentesting-rpcbind

Entry_2:
Name: rpc info
Description: May give netstat-type info
Command: whois -h {IP} -p 43 {Domain_Name} && echo {Domain_Name} | nc -vn {IP} 43

Entry_3:
Name: nmap
Description: May give netstat-type info
Command: nmap -sSUC -p 111 {IP}
```
<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks Cloud ☁️</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>🐦 Twitter 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 Youtube 🎥</strong></a></summary>

* **サイバーセキュリティ会社**で働いていますか？ **HackTricksで会社を宣伝**したいですか？または、**最新バージョンのPEASSを入手したり、HackTricksをPDFでダウンロード**したいですか？[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を見つけてください。独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクションです。
* [**公式のPEASS＆HackTricksのグッズ**](https://peass.creator-spring.com)を手に入れましょう。
* [**💬**](https://emojipedia.org/speech-balloon/) [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**telegramグループ**](https://t.me/peass)に**参加**するか、**Twitter**で**フォロー**してください[**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **ハッキングのトリックを共有するには、PRを** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **と** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **に提出してください。**

</details>
