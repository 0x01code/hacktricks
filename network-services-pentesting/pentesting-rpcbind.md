# 111/TCP/UDP - ペンテスティング ポートマッパー

<details>

<summary><strong>htARTE（HackTricks AWS Red Team Expert）</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>でAWSハッキングをゼロからヒーローまで学ぶ</strong></a><strong>！</strong></summary>

HackTricks をサポートする他の方法:

* **HackTricks で企業を宣伝したい** または **HackTricks をPDFでダウンロードしたい** 場合は [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop) をチェックしてください！
* [**公式PEASS＆HackTricksスワッグ**](https://peass.creator-spring.com)を入手する
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) を発見し、独占的な [**NFTs**](https://opensea.io/collection/the-peass-family) のコレクションを見つける
* **💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f) に参加するか、[**telegramグループ**](https://t.me/peass) に参加するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live) をフォローする**
* **ハッキングトリックを共有するには、** [**HackTricks**](https://github.com/carlospolop/hacktricks) と [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) のGitHubリポジトリにPRを提出してください。

</details>

## 基本情報

**ポートマッパー**は、ネットワークサービスポートを **RPC**（Remote Procedure Call）プログラム番号にマッピングするために使用されるサービスです。これは、**Unixベースのシステム**において情報のやり取りを容易にするための重要なコンポーネントとして機能します。**ポートマッパー**に関連付けられた**ポート**は、攻撃者によって頻繁にスキャンされます。なぜなら、貴重な情報を明らかにする可能性があるからです。この情報には、実行中の**Unixオペレーティングシステム（OS）**の種類やシステムで利用可能なサービスの詳細が含まれます。さらに、**ポートマッパー**は、**NFS（Network File System）**、**NIS（Network Information Service）**、および他の**RPCベースのサービス**と共に使用され、ネットワークサービスを効果的に管理します。

**デフォルトポート:** 111/TCP/UDP、Oracle Solaris では 32771
```
PORT    STATE SERVICE
111/tcp open  rpcbind
```
## 列挙
```
rpcinfo irked.htb
nmap -sSUC -p111 192.168.10.1
```
### Shodan

* `port:111 portmap`

## RPCBind + NFS

サービスNFSを見つけた場合、おそらくファイルのリスト表示やダウンロード（おそらくアップロードも）が可能になります：

![](<../.gitbook/assets/image (232).png>)

[2049 - Pentesting NFS service](nfs-service-pentesting.md)を読んで、このプロトコルをテストする方法について詳しく学びましょう。

## NIS

**NIS**の脆弱性を探るには、`ypbind`サービスの特定から始める2段階のプロセスが必要です。この探索の中心は**NISドメイン名**の発見であり、これがなければ進捗が停滞します。

![](<../.gitbook/assets/image (233).png>)

探索の旅は、必要なパッケージをインストールすること（`apt-get install nis`）から始まります。次のステップでは、`ypwhich`を使用してNISサーバーの存在を確認し、ドメイン名とサーバーIPに対してピンクを行い、これらの要素がセキュリティのために匿名化されていることを確認する必要があります。

最後で重要なステップは、`ypcat`コマンドを使用して、特に暗号化されたユーザーパスワードなどの機密データを抽出することです。これらのハッシュは、**John the Ripper**などのツールを使用して解読されると、システムアクセスと特権に関する洞察が明らかになります。
```bash
# Install NIS tools
apt-get install nis
# Ping the NIS server to confirm its presence
ypwhich -d <domain-name> <server-ip>
# Extract user credentials
ypcat –d <domain-name> –h <server-ip> passwd.byname
```
### NIF ファイル

| **マスターファイル** | **マップ**                  | **ノート**                         |
| ---------------- | --------------------------- | --------------------------------- |
| /etc/hosts       | hosts.byname, hosts.byaddr  | ホスト名とIPの詳細を含む         |
| /etc/passwd      | passwd.byname, passwd.byuid | NISユーザーパスワードファイル     |
| /etc/group       | group.byname, group.bygid   | NISグループファイル               |
| /usr/lib/aliases | mail.aliases                | メールエイリアスの詳細           |

## RPC ユーザー

もし、**rusersd** サービスが以下のようにリストされている場合:

![](<../.gitbook/assets/image (231).png>)

ボックスのユーザーを列挙することができます。詳細は[1026 - Pentesting Rsusersd](1026-pentesting-rusersd.md)を参照してください。

## フィルタリングされた Portmapper ポートのバイパス

**nmapスキャン**を実行し、ポート111がフィルタリングされているオープンなNFSポートを発見した場合、これらのポートの直接的な攻撃は実行できません。しかし、**ローカルでポートマッパーサービスをシミュレートし、自分のマシンからターゲットへのトンネルを作成**することで、標準ツールを使用して攻撃が可能になります。このテクニックにより、ポート111のフィルタリングされた状態をバイパスし、NFSサービスへのアクセスが可能になります。この方法の詳細なガイダンスについては、[このリンク](https://medium.com/@sebnemK/how-to-bypass-filtered-portmapper-port-111-27cee52416bc)で提供されている記事を参照してください。

## Shodan

* `Portmap`

## 練習用のラボ

* これらのテクニックを[**Irked HTB マシン**](https://app.hackthebox.com/machines/Irked)で練習してください。

## HackTricks Automatic Commands
```
Protocol_Name: Portmapper    #Protocol Abbreviation if there is one.
Port_Number:  43     #Comma separated if there is more than one.
Protocol_Description: PM or RPCBind        #Protocol Abbreviation Spelled out

Entry_1:
Name: Notes
Description: Notes for PortMapper
Note: |
Portmapper is a service that is utilized for mapping network service ports to RPC (Remote Procedure Call) program numbers. It acts as a critical component in Unix-based systems, facilitating the exchange of information between these systems. The port associated with Portmapper is frequently scanned by attackers as it can reveal valuable information. This information includes the type of Unix Operating System (OS) running and details about the services that are available on the system. Additionally, Portmapper is commonly used in conjunction with NFS (Network File System), NIS (Network Information Service), and other RPC-based services to manage network services effectively.

https://book.hacktricks.xyz/pentesting/pentesting-rpcbind

Entry_2:
Name: rpc info
Description: May give netstat-type info
Command: whois -h {IP} -p 43 {Domain_Name} && echo {Domain_Name} | nc -vn {IP} 43

Entry_3:
Name: nmap
Description: May give netstat-type info
Command: nmap -sSUC -p 111 {IP}
```
<details>

<summary><strong>AWSハッキングをゼロからヒーローまで学ぶ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE（HackTricks AWS Red Team Expert）</strong></a><strong>！</strong></summary>

HackTricksをサポートする他の方法:

* **HackTricksで企業を宣伝したい**または**HackTricksをPDFでダウンロードしたい**場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS＆HackTricksスワッグ**](https://peass.creator-spring.com)を入手する
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)コレクションを見つける
* **💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**telegramグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)で**フォロー**する。
* **ハッキングトリックを共有するために、[**HackTricks**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のgithubリポジトリにPRを提出してください。

</details>
