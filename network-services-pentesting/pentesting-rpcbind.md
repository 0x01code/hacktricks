# 111/TCP/UDP - Testowanie penetracyjne Portmappera

<details>

<summary><strong>Naucz się hakować AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeśli chcesz zobaczyć swoją **firmę reklamowaną w HackTricks** lub **pobrać HackTricks w formacie PDF**, sprawdź [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Zdobądź [**oficjalne gadżety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzinę PEASS**](https://opensea.io/collection/the-peass-family), naszą kolekcję ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Dołącz do** 💬 [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **śledź** nas na **Twitterze** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel się swoimi sztuczkami hakerskimi, przesyłając PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## Podstawowe informacje

**Portmapper** to usługa, która służy do mapowania portów usług sieciowych na numery programów **RPC** (Remote Procedure Call). Jest ona kluczowym komponentem w systemach opartych na **Unix**, ułatwiającym wymianę informacji między tymi systemami. **Port** związany z **Portmapperem** jest często skanowany przez atakujących, ponieważ może ujawnić cenne informacje. Informacje te obejmują rodzaj działającego systemu operacyjnego **Unix** oraz szczegóły dotyczące usług dostępnych w systemie. Ponadto, **Portmapper** jest często używany w połączeniu z **NFS (Network File System)**, **NIS (Network Information Service)** i innymi usługami opartymi na **RPC**, aby efektywnie zarządzać usługami sieciowymi.

**Domyślny port:** 111/TCP/UDP, 32771 w Oracle Solaris
```
PORT    STATE SERVICE
111/tcp open  rpcbind
```
## Wyliczanie

### rpcinfo

`rpcinfo` jest narzędziem, które służy do wyliczania informacji o usługach RPC (Remote Procedure Call) dostępnych na zdalnym hoście. Można go użyć do uzyskania listy usług RPC, które są uruchomione na danym hoście, wraz z informacjami o numerach portów i protokołach, które są używane.

Aby użyć `rpcinfo`, wykonaj polecenie:

```plaintext
rpcinfo -p <adres_hosta>
```

### showmount

`showmount` jest narzędziem, które służy do wyliczania informacji o eksportowanych systemach plików NFS (Network File System) na zdalnym hoście. Można go użyć do uzyskania listy eksportowanych systemów plików NFS, wraz z informacjami o ścieżkach i dostępnych uprawnieniach.

Aby użyć `showmount`, wykonaj polecenie:

```plaintext
showmount -e <adres_hosta>
```

### enum4linux

`enum4linux` jest narzędziem, które służy do wyliczania informacji o usługach SMB/CIFS (Server Message Block/Common Internet File System) dostępnych na zdalnym hoście. Można go użyć do uzyskania listy udostępnionych zasobów, kont użytkowników, grup, polityk bezpieczeństwa i innych informacji związanych z usługą SMB/CIFS.

Aby użyć `enum4linux`, wykonaj polecenie:

```plaintext
enum4linux <adres_hosta>
```

### nmap

`nmap` jest popularnym narzędziem do skanowania sieci, które można również użyć do wyliczania informacji o usługach dostępnych na zdalnym hoście. Można go skonfigurować do skanowania konkretnych portów lub wykrywania usług automatycznie.

Aby użyć `nmap` do wyliczania usług, wykonaj polecenie:

```plaintext
nmap -p- <adres_hosta>
```

### Metasploit

Metasploit to framework do testowania penetracyjnego, który zawiera wiele modułów do wyliczania informacji o usługach dostępnych na zdalnym hoście. Można go użyć do automatycznego skanowania i wyliczania informacji o usługach, w tym portach, protokołach, wersjach oprogramowania i innych szczegółach.

Aby użyć Metasploita do wyliczania usług, wykonaj polecenie:

```plaintext
use auxiliary/scanner/portscan/tcp
set RHOSTS <adres_hosta>
run
```

### Inne narzędzia

Oprócz wymienionych narzędzi istnieje wiele innych narzędzi, które można użyć do wyliczania informacji o usługach dostępnych na zdalnym hoście. Niektóre z tych narzędzi to:

- `nbtscan`: Skanuje sieć w poszukiwaniu hostów SMB/CIFS i wylicza informacje o nich.
- `smbclient`: Pozwala na interakcję z usługą SMB/CIFS i uzyskanie informacji o dostępnych zasobach.
- `ldapsearch`: Wykonuje zapytania LDAP (Lightweight Directory Access Protocol) do zdalnego serwera i wylicza informacje o katalogu.
- `snmpwalk`: Wykonuje zapytania SNMP (Simple Network Management Protocol) do zdalnego hosta i wylicza informacje o urządzeniu.

W zależności od celu i środowiska, różne narzędzia mogą być bardziej lub mniej skuteczne w wyliczaniu informacji o usługach dostępnych na zdalnym hoście. Warto eksperymentować z różnymi narzędziami i technikami, aby uzyskać jak najwięcej informacji.
```
rpcinfo irked.htb
nmap -sSUC -p111 192.168.10.1
```
Czasami nie dostajesz żadnych informacji, innym razem otrzymasz coś takiego:

![](<../.gitbook/assets/image (230).png>)

### Shodan

* `port:111 portmap`

## RPCBind + NFS

Jeśli znajdziesz usługę NFS, prawdopodobnie będziesz mógł wyświetlać i pobierać (a może nawet przesyłać) pliki:

![](<../.gitbook/assets/image (232).png>)

Przeczytaj [2049 - Testowanie penetracyjne usługi NFS](nfs-service-pentesting.md), aby dowiedzieć się więcej na temat testowania tego protokołu.

## NIS

Badanie podatności **NIS** obejmuje dwuetapowy proces, rozpoczynający się od identyfikacji usługi `ypbind`. Kamieniem węgielnym tego badania jest odkrycie **nazwy domeny NIS**, bez której postęp zostaje zatrzymany.

![](<../.gitbook/assets/image (233).png>)

Podróż badawcza rozpoczyna się od instalacji niezbędnych pakietów (`apt-get install nis`). Kolejnym krokiem jest użycie polecenia `ypwhich`, aby potwierdzić obecność serwera NIS, pingując go za pomocą nazwy domeny i adresu IP serwera, przy czym te elementy są anonimizowane w celu zapewnienia bezpieczeństwa.

Ostatnim i kluczowym krokiem jest użycie polecenia `ypcat`, aby wydobyć wrażliwe dane, zwłaszcza zaszyfrowane hasła użytkowników. Te skróty, po złamaniu ich za pomocą narzędzi takich jak **John the Ripper**, ujawniają informacje o dostępie do systemu i uprawnieniach.
```bash
# Install NIS tools
apt-get install nis
# Ping the NIS server to confirm its presence
ypwhich -d <domain-name> <server-ip>
# Extract user credentials
ypcat –d <domain-name> –h <server-ip> passwd.byname
```
### Pliki NIF

| **Plik główny** | **Mapy**                    | **Notatki**                           |
| --------------- | --------------------------- | ------------------------------------- |
| /etc/hosts      | hosts.byname, hosts.byaddr  | Zawiera nazwy hostów i szczegóły IP   |
| /etc/passwd     | passwd.byname, passwd.byuid | Plik hasła użytkownika NIS             |
| /etc/group      | group.byname, group.bygid   | Plik grupy NIS                         |
| /usr/lib/aliases| mail.aliases                | Szczegóły aliasów poczty elektronicznej|

## Użytkownicy RPC

Jeśli znajdziesz usługę **rusersd** wymienioną w ten sposób:

![](<../.gitbook/assets/image (231).png>)

Możesz wyliczyć użytkowników na maszynie. Aby dowiedzieć się jak to zrobić, przeczytaj [1026 - Pentesting Rsusersd](1026-pentesting-rusersd.md).

## Ominięcie zablokowanego portu Portmapper

Podczas przeprowadzania skanu **nmap** i odkrywania otwartych portów NFS, gdzie port 111 jest zablokowany, bezpośrednie wykorzystanie tych portów jest niemożliwe. Jednak poprzez **symulację lokalnej usługi portmappera i utworzenie tunelu z Twojego komputera** do celu, możliwe staje się wykorzystanie narzędzi standardowych. Ta technika umożliwia ominięcie zablokowanego stanu portu 111, umożliwiając dostęp do usług NFS. Szczegółowe wskazówki dotyczące tej metody znajdują się w artykule dostępnym pod [tym linkiem](https://medium.com/@sebnemK/how-to-bypass-filtered-portmapper-port-111-27cee52416bc).

## Shodan

* `Portmap`

## Laboratoria do praktyki

* Wypróbuj te techniki na maszynie [**Irked HTB**](https://app.hackthebox.com/machines/Irked).

## Automatyczne polecenia HackTricks
```
Protocol_Name: Portmapper    #Protocol Abbreviation if there is one.
Port_Number:  43     #Comma separated if there is more than one.
Protocol_Description: PM or RPCBind        #Protocol Abbreviation Spelled out

Entry_1:
Name: Notes
Description: Notes for PortMapper
Note: |
Portmapper is a service that is utilized for mapping network service ports to RPC (Remote Procedure Call) program numbers. It acts as a critical component in Unix-based systems, facilitating the exchange of information between these systems. The port associated with Portmapper is frequently scanned by attackers as it can reveal valuable information. This information includes the type of Unix Operating System (OS) running and details about the services that are available on the system. Additionally, Portmapper is commonly used in conjunction with NFS (Network File System), NIS (Network Information Service), and other RPC-based services to manage network services effectively.

https://book.hacktricks.xyz/pentesting/pentesting-rpcbind

Entry_2:
Name: rpc info
Description: May give netstat-type info
Command: whois -h {IP} -p 43 {Domain_Name} && echo {Domain_Name} | nc -vn {IP} 43

Entry_3:
Name: nmap
Description: May give netstat-type info
Command: nmap -sSUC -p 111 {IP}
```
<details>

<summary><strong>Naucz się hakować AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeśli chcesz zobaczyć swoją **firmę reklamowaną w HackTricks** lub **pobrać HackTricks w formacie PDF**, sprawdź [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Zdobądź [**oficjalne gadżety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzinę PEASS**](https://opensea.io/collection/the-peass-family), naszą kolekcję ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Dołącz do** 💬 [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **śledź** nas na **Twitterze** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel się swoimi sztuczkami hakerskimi, przesyłając PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytoriów github.

</details>
