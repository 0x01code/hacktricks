# 111/TCP/UDP - ペンテスティング ポートマッパー

<details>

<summary><strong>ゼロからヒーローまでAWSハッキングを学ぶ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE（HackTricks AWS Red Team Expert）</strong></a><strong>！</strong></summary>

HackTricks をサポートする他の方法:

* **HackTricks で企業を宣伝したい** または **HackTricks をPDFでダウンロードしたい** 場合は [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop) をチェック！
* [**公式PEASS＆HackTricksグッズ**](https://peass.creator-spring.com)を入手
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)、当社の独占的な [**NFTs**](https://opensea.io/collection/the-peass-family) コレクションを発見
* **💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f) または [**telegramグループ**](https://t.me/peass) に参加するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks\_live) をフォローしてください。**
* **ハッキングトリックを共有するには、** [**HackTricks**](https://github.com/carlospolop/hacktricks) と [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) のGitHubリポジトリにPRを提出してください。

</details>

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

## 基本情報

**ポートマッパー**は、ネットワークサービスポートを**RPC**（Remote Procedure Call）プログラム番号にマッピングするために使用されるサービスです。これは、**Unixベースのシステム**において情報のやり取りを容易にするための重要なコンポーネントとして機能します。**ポートマッパー**に関連付けられた**ポート**は、攻撃者によって頻繁にスキャンされることがあり、貴重な情報を明らかにする可能性があります。この情報には、実行中の**Unixオペレーティングシステム（OS）**の種類やシステムで利用可能なサービスの詳細が含まれます。さらに、**ポートマッパー**は、ネットワークサービスを効果的に管理するために**NFS（Network File System）**、**NIS（Network Information Service）**、および他の**RPCベースのサービス**と共に一般的に使用されます。

**デフォルトポート:** 111/TCP/UDP、Oracle Solaris では 32771
```
PORT    STATE SERVICE
111/tcp open  rpcbind
```
## 列挙
```
rpcinfo irked.htb
nmap -sSUC -p111 192.168.10.1
```
### Shodan

* `port:111 portmap`

## RPCBind + NFS

サービスNFSを見つけた場合、おそらくファイルの一覧表示やダウンロード（おそらくアップロードも）ができるでしょう：

![](<../.gitbook/assets/image (869).png>)

[2049 - Pentesting NFS service](nfs-service-pentesting.md)を読んで、このプロトコルをテストする方法について詳しく学んでください。

## NIS

**NIS**の脆弱性を調査するには、`ypbind`サービスの特定から始める2段階のプロセスが必要です。この調査の中心は**NISドメイン名**の発見であり、これがなければ進捗は停滞します。

![](<../.gitbook/assets/image (856).png>)

調査の旅は、必要なパッケージをインストールすること（`apt-get install nis`）から始まります。次のステップでは、`ypwhich`を使用してNISサーバーの存在を確認し、ドメイン名とサーバーIPに対してピンクを行い、これらの要素がセキュリティのために匿名化されていることを確認する必要があります。

最後で重要なステップは、`ypcat`コマンドを使用して、特に暗号化されたユーザーパスワードなどの機密データを抽出することです。これらのハッシュは、**John the Ripper**などのツールを使用して解読されると、システムアクセスと特権に関する洞察が明らかになります。
```bash
# Install NIS tools
apt-get install nis
# Ping the NIS server to confirm its presence
ypwhich -d <domain-name> <server-ip>
# Extract user credentials
ypcat –d <domain-name> –h <server-ip> passwd.byname
```
### NIF ファイル

| **マスターファイル** | **マップ**                  | **ノート**                         |
| ---------------- | --------------------------- | --------------------------------- |
| /etc/hosts       | hosts.byname, hosts.byaddr  | ホスト名とIPの詳細を含む         |
| /etc/passwd      | passwd.byname, passwd.byuid | NISユーザーパスワードファイル     |
| /etc/group       | group.byname, group.bygid   | NISグループファイル               |
| /usr/lib/aliases | mail.aliases                | メールエイリアスの詳細           |

## RPC ユーザー

もし以下のように **rusersd** サービスがリストされている場合:

![](<../.gitbook/assets/image (1038).png>)

ボックスのユーザーを列挙できます。詳細は[1026 - Pentesting Rsusersd](1026-pentesting-rusersd.md)を参照してください。

## フィルタリングされた Portmapper ポートのバイパス

**nmap スキャン**を実行し、ポート 111 がフィルタリングされているオープンな NFS ポートを発見した場合、これらのポートの直接的な攻撃は実行できません。しかし、**ローカルでポートマッパーサービスをシミュレートし、自分のマシンからターゲットへのトンネルを作成する**ことで、標準ツールを使用して攻撃が可能になります。このテクニックにより、ポート 111 のフィルタリング状態をバイパスして NFS サービスへのアクセスが可能になります。この方法の詳細なガイダンスについては、[このリンク](https://medium.com/@sebnemK/how-to-bypass-filtered-portmapper-port-111-27cee52416bc)で提供されている記事を参照してください。

## Shodan

* `Portmap`

## 練習用ラボ

* これらのテクニックを[**Irked HTB マシン**](https://app.hackthebox.com/machines/Irked)で練習してください。

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

## HackTricks Automatic Commands
```
Protocol_Name: Portmapper    #Protocol Abbreviation if there is one.
Port_Number:  43     #Comma separated if there is more than one.
Protocol_Description: PM or RPCBind        #Protocol Abbreviation Spelled out

Entry_1:
Name: Notes
Description: Notes for PortMapper
Note: |
Portmapper is a service that is utilized for mapping network service ports to RPC (Remote Procedure Call) program numbers. It acts as a critical component in Unix-based systems, facilitating the exchange of information between these systems. The port associated with Portmapper is frequently scanned by attackers as it can reveal valuable information. This information includes the type of Unix Operating System (OS) running and details about the services that are available on the system. Additionally, Portmapper is commonly used in conjunction with NFS (Network File System), NIS (Network Information Service), and other RPC-based services to manage network services effectively.

https://book.hacktricks.xyz/pentesting/pentesting-rpcbind

Entry_2:
Name: rpc info
Description: May give netstat-type info
Command: whois -h {IP} -p 43 {Domain_Name} && echo {Domain_Name} | nc -vn {IP} 43

Entry_3:
Name: nmap
Description: May give netstat-type info
Command: nmap -sSUC -p 111 {IP}
```
<details>

<summary><strong>AWSハッキングをゼロからヒーローまで学ぶ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE（HackTricks AWS Red Team Expert）</strong></a><strong>！</strong></summary>

HackTricksをサポートする他の方法:

* **HackTricksで企業を宣伝したい**または**HackTricksをPDFでダウンロードしたい**場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS＆HackTricksグッズ**](https://peass.creator-spring.com)を入手する
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)、当社の独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)コレクションを発見する
* **💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)に参加するか、[**telegramグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks\_live)**をフォローする。**
* **ハッキングトリックを共有するためにPRを** [**HackTricks**](https://github.com/carlospolop/hacktricks) **および** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **のGitHubリポジトリに提出する。**

</details>
