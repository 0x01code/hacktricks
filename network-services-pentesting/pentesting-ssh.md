# 22 - Ελεγχος ασφάλειας SSH/SFTP

<details>

<summary><strong>Μάθετε το χάκινγκ του AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι για να υποστηρίξετε το HackTricks:

* Αν θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**την Οικογένεια PEASS**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε στη** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στη [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Μοιραστείτε τα χάκινγκ κόλπα σας υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>

<img src="../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt="" data-size="original">

Αν ενδιαφέρεστε για μια **καριέρα στο χάκινγκ** και να χακεύετε το αχακέυτο - **προσλαμβάνουμε!** (_απαιτείται άπταιστη γραπτή και προφορική γνώση της πολωνικής γλώσσας_).

{% embed url="https://www.stmcyber.com/careers" %}

## Βασικές Πληροφορίες

Το **SSH (Secure Shell ή Secure Socket Shell)** είναι ένα πρωτόκολλο δικτύου που επιτρέπει μια ασφαλή σύνδεση με έναν υπολογιστή μέσω ενός μη ασφαλούς δικτύου. Είναι απαραίτητο για τη διατήρηση της εμπιστευτικότητας και ακεραιότητας των δεδομένων κατά την πρόσβαση σε απομακρυσμένα συστήματα.

**Προεπιλεγμένη θύρα:** 22
```
22/tcp open  ssh     syn-ack
```
**Διακομιστές SSH:**

* [openSSH](http://www.openssh.org) - OpenBSD SSH, παρέχεται σε διανομές BSD, Linux και Windows από την έκδοση Windows 10
* [Dropbear](https://matt.ucc.asn.au/dropbear/dropbear.html) - Υλοποίηση SSH για περιβάλλοντα με χαμηλή μνήμη και επεξεργαστικούς πόρους, παρέχεται στο OpenWrt
* [PuTTY](https://www.chiark.greenend.org.uk/\~sgtatham/putty/) - Υλοποίηση SSH για τα Windows, ο πελάτης χρησιμοποιείται συχνά, αλλά η χρήση του διακομιστή είναι πιο σπάνια
* [CopSSH](https://www.itefix.net/copssh) - Υλοποίηση του OpenSSH για τα Windows

**Βιβλιοθήκες SSH (υλοποίηση στην πλευρά του διακομιστή):**

* [libssh](https://www.libssh.org) - Πολυπλατφορμική βιβλιοθήκη C που υλοποιεί το πρωτόκολλο SSHv2 με δεσμεύσεις σε [Python](https://github.com/ParallelSSH/ssh-python), [Perl](https://github.com/garnier-quentin/perl-libssh/) και [R](https://github.com/ropensci/ssh); χρησιμοποιείται από το KDE για sftp και από το GitHub για την υποδομή git SSH
* [wolfSSH](https://www.wolfssl.com/products/wolfssh/) - Βιβλιοθήκη διακομιστή SSHv2 γραμμένη σε ANSI C και σχεδιασμένη για ενσωματωμένα, RTOS και περιβάλλοντα με περιορισμένους πόρους
* [Apache MINA SSHD](https://mina.apache.org/sshd-project/index.html) - Η βιβλιοθήκη Apache SSHD βασίζεται στην Java Apache MINA
* [paramiko](https://github.com/paramiko/paramiko) - Βιβλιοθήκη πρωτοκόλλου SSHv2 για τη γλώσσα προγραμματισμού Python

## Απαρίθμηση

### Ανάκτηση Μπάνερ
```bash
nc -vn <IP> 22
```
### Αυτοματοποιημένο ssh-audit

Το ssh-audit είναι ένα εργαλείο για τον έλεγχο της διαμόρφωσης του ssh server και του client.

Το [https://github.com/jtesta/ssh-audit](https://github.com/jtesta/ssh-audit) είναι ένα ενημερωμένο fork από το [https://github.com/arthepsy/ssh-audit/](https://github.com/arthepsy/ssh-audit/)

**Χαρακτηριστικά:**

* Υποστήριξη για το πρωτόκολλο SSH1 και SSH2;
* Ανάλυση της διαμόρφωσης του SSH client;
* Ανάκτηση banner, αναγνώριση συσκευής ή λογισμικού και λειτουργικού συστήματος, ανίχνευση συμπίεσης;
* Συλλογή αλγορίθμων key-exchange, host-key, κρυπτογράφησης και αυθεντικοποίησης μηνυμάτων;
* Παροχή πληροφοριών για τους αλγορίθμους (διαθέσιμοι από, αφαιρέθηκαν/απενεργοποιήθηκαν, μη ασφαλείς/αδύναμοι/παλαιοί, κλπ);
* Παροχή συστάσεων για τους αλγορίθμους (προσθήκη ή αφαίρεση βάσει της αναγνωρισμένης έκδοσης του λογισμικού);
* Παροχή πληροφοριών ασφαλείας (σχετικά θέματα, αντιστοιχία με τη λίστα CVE, κλπ);
* Ανάλυση συμβατότητας της έκδοσης του SSH βάσει των πληροφοριών των αλγορίθμων;
* Ιστορικές πληροφορίες από το OpenSSH, το Dropbear SSH και το libssh;
* Λειτουργεί σε Linux και Windows;
* Δεν απαιτεί εξαρτήσεις.
```bash
usage: ssh-audit.py [-1246pbcnjvlt] <host>

-1,  --ssh1             force ssh version 1 only
-2,  --ssh2             force ssh version 2 only
-4,  --ipv4             enable IPv4 (order of precedence)
-6,  --ipv6             enable IPv6 (order of precedence)
-p,  --port=<port>      port to connect
-b,  --batch            batch output
-c,  --client-audit     starts a server on port 2222 to audit client
software config (use -p to change port;
use -t to change timeout)
-n,  --no-colors        disable colors
-j,  --json             JSON output
-v,  --verbose          verbose output
-l,  --level=<level>    minimum output level (info|warn|fail)
-t,  --timeout=<secs>   timeout (in seconds) for connection and reading
(default: 5)
$ python3 ssh-audit <IP>
```
### Δημόσιο κλειδί SSH του διακομιστή

```plaintext
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDZz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz
```bash
ssh-keyscan -t rsa <IP> -p <PORT>
```
### Αδύναμοι αλγόριθμοι κρυπτογράφησης

Αυτό ανακαλύπτεται από προεπιλογή από το **nmap**. Ωστόσο, μπορείτε επίσης να χρησιμοποιήσετε το **sslscan** ή το **sslyze**.

### Σενάρια Nmap
```bash
nmap -p22 <ip> -sC # Send default nmap scripts for SSH
nmap -p22 <ip> -sV # Retrieve version
nmap -p22 <ip> --script ssh2-enum-algos # Retrieve supported algorythms
nmap -p22 <ip> --script ssh-hostkey --script-args ssh_hostkey=full # Retrieve weak keys
nmap -p22 <ip> --script ssh-auth-methods --script-args="ssh.user=root" # Check authentication methods
```
### Shodan

* `ssh`

## Επίθεση με βίαιη δύναμη σε ονόματα χρηστών, κωδικούς πρόσβασης και ιδιωτικά κλειδιά

### Απαρίθμηση ονομάτων χρηστών

Σε ορισμένες εκδόσεις του OpenSSH μπορείτε να κάνετε μια επίθεση χρονισμού για να απαριθμήσετε τους χρήστες. Μπορείτε να χρησιμοποιήσετε ένα εργαλείο του metasploit για να εκμεταλλευτείτε αυτό:
```
msf> use scanner/ssh/ssh_enumusers
```
### [Βίαιη επίθεση](../generic-methodologies-and-resources/brute-force.md#ssh)

Ορισμένα κοινά διαπιστευτήρια ssh [εδώ](https://github.com/danielmiessler/SecLists/blob/master/Passwords/Default-Credentials/ssh-betterdefaultpasslist.txt) και [εδώ](https://github.com/danielmiessler/SecLists/blob/master/Passwords/Common-Credentials/top-20-common-SSH-passwords.txt) και παρακάτω.

### Βίαιη επίθεση με Ιδιωτικό Κλειδί

Εάν γνωρίζετε κάποια ιδιωτικά κλειδιά ssh που μπορούν να χρησιμοποιηθούν... ας το δοκιμάσουμε. Μπορείτε να χρησιμοποιήσετε το nmap script:
```
https://nmap.org/nsedoc/scripts/ssh-publickey-acceptance.html
```
Ή το επιπλέον ενότητα MSF auxiliary:
```
msf> use scanner/ssh/ssh_identify_pubkeys
```
Ή χρησιμοποιήστε το `ssh-keybrute.py` (native python3, ελαφρύ και έχει ενεργοποιημένους παλαιούς αλγόριθμους): [snowdroppe/ssh-keybrute](https://github.com/snowdroppe/ssh-keybrute).

#### Γνωστά κακά κλειδιά μπορούν να βρεθούν εδώ:

{% embed url="https://github.com/rapid7/ssh-badkeys/tree/master/authorized" %}

#### Αδύναμα κλειδιά SSH / Debian προβλέψιμο PRNG

Ορισμένα συστήματα έχουν γνωστά ελαττώματα στον τυχαίο σπόρο που χρησιμοποιείται για τη δημιουργία κρυπτογραφικού υλικού. Αυτό μπορεί να οδηγήσει σε μείωση του χώρου των κλειδιών που μπορεί να υποστεί bruteforce. Προ-δημιουργημένα σύνολα κλειδιών που δημιουργήθηκαν σε συστήματα Debian που επηρεάζονται από αδύναμο PRNG είναι διαθέσιμα εδώ: [g0tmi1k/debian-ssh](https://github.com/g0tmi1k/debian-ssh).

Θα πρέπει να κοιτάξετε εδώ για να αναζητήσετε έγκυρα κλειδιά για το μηχάνημα θύμα.

### Kerberos

**crackmapexec** χρησιμοποιώντας το πρωτόκολλο `ssh` μπορεί να χρησιμοποιήσει την επιλογή `--kerberos` για να **πιστοποιηθεί μέσω kerberos**.\
Για περισσότερες πληροφορίες εκτελέστε `crackmapexec ssh --help`.

## Προεπιλεγμένα διαπιστευτήρια

| **Προμηθευτής** | **Ονόματα χρηστών**                                                                                         | **Κωδικοί πρόσβασης**                                                                                                                                                                                      |
| -------------- | ----------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| APC            | apc, device                                                                                                 | apc                                                                                                                                                                                                        |
| Brocade        | admin                                                                                                       | admin123, password, brocade, fibranne                                                                                                                                                                      |
| Cisco          | admin, cisco, enable, hsa, pix, pnadmin, ripeop, root, shelladmin                                           | admin, Admin123, default, password, secur4u, cisco, Cisco, \_Cisco, cisco123, C1sco!23, Cisco123, Cisco1234, TANDBERG, change\_it, 12345, ipics, pnadmin, diamond, hsadb, c, cc, attack, blender, changeme |
| Citrix         | root, nsroot, nsmaint, vdiadmin, kvm, cli, admin                                                            | C1trix321, nsroot, nsmaint, kaviza, kaviza123, freebsd, public, rootadmin, wanscaler                                                                                                                       |
| D-Link         | admin, user                                                                                                 | private, admin, user                                                                                                                                                                                       |
| Dell           | root, user1, admin, vkernel, cli                                                                            | calvin, 123456, password, vkernel, Stor@ge!, admin                                                                                                                                                         |
| EMC            | admin, root, sysadmin                                                                                       | EMCPMAdm7n, Password#1, Password123#, sysadmin, changeme, emc                                                                                                                                              |
| HP/3Com        | admin, root, vcx, app, spvar, manage, hpsupport, opc\_op                                                    | admin, password, hpinvent, iMC123, pvadmin, passw0rd, besgroup, vcx, nice, access, config, 3V@rpar, 3V#rpar, procurve, badg3r5, OpC\_op, !manage, !admin                                                   |
| Huawei         | admin, root                                                                                                 | 123456, admin, root, Admin123, Admin@storage, Huawei12#$, HwDec@01, hwosta2.0, HuaWei123, fsp200@HW, huawei123                                                                                             |
| IBM            | USERID, admin, manager, mqm, db2inst1, db2fenc1, dausr1, db2admin, iadmin, system, device, ufmcli, customer | PASSW0RD, passw0rd, admin, password, Passw8rd, iadmin, apc, 123456, cust0mer                                                                                                                               |
| Juniper        | netscreen                                                                                                   | netscreen                                                                                                                                                                                                  |
| NetApp         | admin                                                                                                       | netapp123                                                                                                                                                                                                  |
| Oracle         | root, oracle, oravis, applvis, ilom-admin, ilom-operator, nm2user                                           | changeme, ilom-admin, ilom-operator, welcome1, oracle                                                                                                                                                      |
| VMware         | vi-admin, root, hqadmin, vmware, admin                                                                      | vmware, vmw@re, hqadmin, default                                                                                                                                                                           |

## SSH-MitM

Εάν βρίσκεστε στο τοπικό δίκτυο ως θύμα που θα συνδεθεί στον διακομιστή SSH χρησιμοποιώντας όνομα χρήστη και κωδικό πρόσβασης, μπορείτε να προσπαθήσετε να **πραγματοποιήσετε μια επίθεση MitM για να κλέψετε αυτά τα διαπιστευτήρια:**

**Διαδρομή επίθεσης:**

* **Ανακατεύθυνση κίνησης:** Ο επιτιθέμενος **ανακατευθύνει** την κίνηση του θύματος στη μηχανή του, αποκτώντας έτσι τη σύνδεση με τον διακομιστή SSH.
* **Παρεμβολή και καταγραφή:** Η μηχανή του επιτιθέμενου λειτουργεί ως **διαμεσολαβητής**, **καταγράφοντας** τα στοιχεία σύνδεσης του χρήστη προσποιούμενη ότι είναι ο νόμιμος διακομιστής SSH.
* **Εκτέλεση εντολών και ανακοίνωση:** Τέλος, ο διακομιστής του επιτιθέμενου **καταγράφει τα διαπιστευτήρια του χρήστη**, **προωθεί τις εντολές** στον πραγματικό διακομιστή SSH, **τις εκτελεί** και **στέλνει τα αποτελέσματα πίσω** στον χρήστη, καθιστώντας τη διαδικασία εμφανώς ομαλή και νόμιμη.

[**SSH MITM**](https://github.com/jtesta/ssh-mitm) κάνει ακριβ
```bash
ssh -v noraj@192.168.1.94 id
...
Password:
debug1: Authentication succeeded (keyboard-interactive).
Authenticated to 192.168.1.94 ([192.168.1.94]:22).
debug1: channel 0: new [client-session]
debug1: Requesting no-more-sessions@openssh.com
debug1: Entering interactive session.
debug1: pledge: network
debug1: client_input_global_request: rtype hostkeys-00@openssh.com want_reply 0
debug1: Sending command: id
debug1: client_input_channel_req: channel 0 rtype exit-status reply 0
debug1: client_input_channel_req: channel 0 rtype eow@openssh.com reply 0
uid=1000(noraj) gid=100(users) groups=100(users)
debug1: channel 0: free: client-session, nchannels 1
Transferred: sent 2412, received 2480 bytes, in 0.1 seconds
Bytes per second: sent 43133.4, received 44349.5
debug1: Exit status 0

$ ssh noraj@192.168.1.94 /bin/bash
```
Παρακάτω είναι ένα παράδειγμα ασφαλούς ρύθμισης SFTP (`/etc/ssh/sshd_config` - openSSH) για τον χρήστη `noraj`:

```plaintext
# Απενεργοποίηση πρόσβασης μέσω πρωτοκόλλου SSH
Port 22
Protocol 2

# Απενεργοποίηση εισερχόμενων συνδέσεων root
PermitRootLogin no

# Απενεργοποίηση εισερχόμενων συνδέσεων με κενό κωδικό πρόσβασης
PermitEmptyPasswords no

# Απενεργοποίηση εισερχόμενων συνδέσεων με χρήση κωδικού πρόσβασης
PasswordAuthentication no

# Ενεργοποίηση εισερχόμενων συνδέσεων με χρήση κλειδιού
PubkeyAuthentication yes

# Καθορισμός διαδρομής για τα κλειδιά των χρηστών
AuthorizedKeysFile	.ssh/authorized_keys

# Απενεργοποίηση εισερχόμενων συνδέσεων με χρήση κλειδιού που δεν είναι RSA
HostKey /etc/ssh/ssh_host_rsa_key

# Απενεργοποίηση εισερχόμενων συνδέσεων με χρήση κλειδιού που δεν είναι DSA
HostKey /etc/ssh/ssh_host_dsa_key

# Απενεργοποίηση εισερχόμενων συνδέσεων με χρήση κλειδιού που δεν είναι ECDSA
HostKey /etc/ssh/ssh_host_ecdsa_key

# Απενεργοποίηση εισερχόμενων συνδέσεων με χρήση κλειδιού που δεν είναι ED25519
HostKey /etc/ssh/ssh_host_ed25519_key

# Απενεργοποίηση εισερχόμενων συνδέσεων με χρήση κλειδιού που δεν είναι X25519
HostKey /etc/ssh/ssh_host_x25519_key

# Απενεργοποίηση εισερχόμενων συνδέσεων με χρήση κλειδιού που δεν είναι RSA
HostKey /etc/ssh/ssh_host_rsa_key

# Απενεργοποίηση εισερχόμενων συνδέσεων με χρήση κλειδιού που δεν είναι DSA
HostKey /etc/ssh/ssh_host_dsa_key

# Απενεργοποίηση εισερχόμενων συνδέσεων με χρήση κλειδιού που δεν είναι ECDSA
HostKey /etc/ssh/ssh_host_ecdsa_key

# Απενεργοποίηση εισερχόμενων συνδέσεων με χρήση κλειδιού που δεν είναι ED25519
HostKey /etc/ssh/ssh_host_ed25519_key

# Απενεργοποίηση εισερχόμενων συνδέσεων με χρήση κλειδιού που δεν είναι X25519
HostKey /etc/ssh/ssh_host_x25519_key

# Απενεργοποίηση εισερχόμενων συνδέσεων με χρήση κλειδιού που δεν είναι RSA
HostKey /etc/ssh/ssh_host_rsa_key

# Απενεργοποίηση εισερχόμενων συνδέσεων με χρήση κλειδιού που δεν είναι DSA
HostKey /etc/ssh/ssh_host_dsa_key

# Απενεργοποίηση εισερχόμενων συνδέσεων με χρήση κλειδιού που δεν είναι ECDSA
HostKey /etc/ssh/ssh_host_ecdsa_key

# Απενεργοποίηση εισερχόμενων συνδέσεων με χρήση κλειδιού που δεν είναι ED25519
HostKey /etc/ssh/ssh_host_ed25519_key

# Απενεργοποίηση εισερχόμενων συνδέσεων με χρήση κλειδιού που δεν είναι X25519
HostKey /etc/ssh/ssh_host_x25519_key

# Απενεργοποίηση εισερχόμενων συνδέσεων με χρήση κλειδιού που δεν είναι RSA
HostKey /etc/ssh/ssh_host_rsa_key

# Απενεργοποίηση εισερχόμενων συνδέσεων με χρήση κλειδιού που δεν είναι DSA
HostKey /etc/ssh/ssh_host_dsa_key

# Απενεργοποίηση εισερχόμενων συνδέσεων με χρήση κλειδιού που δεν είναι ECDSA
HostKey /etc/ssh/ssh_host_ecdsa_key

# Απενεργοποίηση εισερχόμενων συνδέσεων με χρήση κλειδιού που δεν είναι ED25519
HostKey /etc/ssh/ssh_host_ed25519_key

# Απενεργοποίηση εισερχόμενων συνδέσεων με χρήση κλειδιού που δεν είναι X25519
HostKey /etc/ssh/ssh_host_x25519_key

# Απενεργοποίηση εισερχόμενων συνδέσεων με χρήση κλειδιού που δεν είναι RSA
HostKey /etc/ssh/ssh_host_rsa_key

# Απενεργοποίηση εισερχόμενων συνδέσεων με χρήση κλειδιού που δεν είναι DSA
HostKey /etc/ssh/ssh_host_dsa_key

# Απενεργοποίηση εισερχόμενων συνδέσεων με χρήση κλειδιού που δεν είναι ECDSA
HostKey /etc/ssh/ssh_host_ecdsa_key

# Απενεργοποίηση εισερχόμενων συνδέσεων με χρήση κλειδιού που δεν είναι ED25519
HostKey /etc/ssh/ssh_host_ed25519_key

# Απενεργοποίηση εισερχόμενων συνδέσεων με χρήση κλειδιού που δεν είναι X25519
HostKey /etc/ssh/ssh_host_x25519_key

# Απενεργοποίηση εισερχόμενων συνδέσεων με χρήση κλειδιού που δεν είναι RSA
HostKey /etc/ssh/ssh_host_rsa_key

# Απενεργοποίηση εισερχόμενων συνδέσεων με χρήση κλειδιού που δεν είναι DSA
HostKey /etc/ssh/ssh_host_dsa_key

# Απενεργοποίηση εισερχόμενων συνδέσεων με χρήση κλειδιού που δεν είναι ECDSA
HostKey /etc/ssh/ssh_host_ecdsa_key

# Απενεργοποίηση εισερχόμενων συνδέσεων με χρήση κλειδιού που δεν είναι ED25519
HostKey /etc/ssh/ssh_host_ed25519_key

# Απενεργοποίηση εισερχόμενων συνδέσεων με χρήση κλειδιού που δεν είναι X25519
HostKey /etc/ssh/ssh_host_x25519_key

# Απενεργοποίηση εισερχόμενων συνδέσεων με χρήση κλειδιού που δεν είναι RSA
HostKey /etc/ssh/ssh_host_rsa_key

# Απενεργοποίηση εισερχόμενων συνδέσεων με χρήση κλειδιού που δεν είναι DSA
HostKey /etc/ssh/ssh_host_dsa_key

# Απενεργοποίηση εισερχόμενων συνδέσεων με χρήση κλειδιού που δεν είναι ECDSA
HostKey /etc/ssh/ssh_host_ecdsa_key

# Απενεργοποίηση εισερχόμενων συνδέσεων με χρήση κλειδιού που δεν είναι ED25519
HostKey /etc/ssh/ssh_host_ed25519_key

# Απενεργοποίηση εισερχόμενων συνδέσεων με χρήση κλειδιού που δεν είναι X25519
HostKey /etc/ssh/ssh_host_x25519_key

# Απενεργοποίηση εισερχόμενων συνδέσεων με χρήση κλειδιού που δεν είναι RSA
HostKey /etc/ssh/ssh_host_rsa_key

# Απενεργοποίηση εισερχόμενων συνδέσεων με χρήση κλειδιού που δεν είναι DSA
HostKey /etc/ssh/ssh_host_dsa_key

# Απενεργοποίηση εισερχόμενων συνδέσεων με χρήση κλειδιού που δεν είναι ECDSA
HostKey /etc/ssh/ssh_host_ecdsa_key

# Απενεργοποίηση εισερχόμενων συνδέσεων με χρήση κλειδιού που δεν είναι ED25519
HostKey /etc/ssh/ssh_host_ed25519_key

# Απενεργοποίηση εισερχόμενων συνδέσεων με χρήση κλειδιού που δεν είναι X25519
HostKey /etc/ssh/ssh_host_x25519_key

# Απενεργοποίηση εισερχόμενων συνδέσεων με χρήση κλειδιού που δεν είναι RSA
HostKey /etc/ssh/ssh_host_rsa_key

# Απενεργοποίηση εισερχόμενων συνδέσεων με χρήση κλειδιού που δεν είναι DSA
HostKey /etc/ssh/ssh_host_dsa_key

# Απενεργοποίηση εισερχόμενων συνδέσεων με χρήση κλειδιού που δεν είναι ECDSA
HostKey /etc/ssh/ssh_host_ecdsa_key

# Απενεργοποίηση εισερχόμενων συνδέσεων με χρήση κλειδιού που δεν είναι ED25519
HostKey /etc/ssh/ssh_host_ed25519
```
Match User noraj
ChrootDirectory %h
ForceCommand internal-sftp
AllowTcpForwarding no
PermitTunnel no
X11Forwarding no
PermitTTY no
```
Αυτή η διαμόρφωση θα επιτρέπει μόνο το SFTP: απενεργοποιώντας την πρόσβαση στο κέλυφος με την επιβολή της εντολής εκκίνησης και απενεργοποιώντας την πρόσβαση TTY, αλλά επίσης απενεργοποιώντας όλους τους τύπους προώθησης θυρών ή τούνελ.

### Προώθηση SFTP

Εάν έχετε πρόσβαση σε έναν διακομιστή SFTP, μπορείτε επίσης να προωθήσετε την κίνησή σας μέσω αυτού, για παράδειγμα χρησιμοποιώντας την κοινή προώθηση θυρών.
```bash
sudo ssh -L <local_port>:<remote_host>:<remote_port> -N -f <username>@<ip_compromised>
```
### SFTP Symlink

Το **sftp** έχει την εντολή "**symlink**". Επομένως, αν έχετε **δικαιώματα εγγραφής** σε έναν φάκελο, μπορείτε να δημιουργήσετε **symlinks** άλλων φακέλων/αρχείων. Εφόσον είστε πιθανότατα **παγιδευμένοι** μέσα σε ένα chroot, αυτό δεν θα είναι ιδιαίτερα χρήσιμο για εσάς, αλλά αν μπορείτε να **έχετε πρόσβαση** στο δημιουργημένο **symlink** από ένα **υπηρεσία χωρίς chroot** (για παράδειγμα, αν μπορείτε να έχετε πρόσβαση στο symlink από τον ιστό), μπορείτε να **ανοίξετε τα αρχεία που έχουν symlink μέσω του ιστού**.

Για παράδειγμα, για να δημιουργήσετε ένα **symlink** από ένα νέο αρχείο με όνομα **"**_**froot**_**"** προς τον φάκελο "**_**/**_**"**:
```bash
sftp> symlink / froot
```
Εάν μπορείτε να αποκτήσετε πρόσβαση στο αρχείο "_froot_" μέσω του διαδικτύου, θα μπορείτε να εμφανίσετε τον φάκελο ρίζας ("/") του συστήματος.

### Μέθοδοι πιστοποίησης

Σε περιβάλλον υψηλής ασφάλειας, είναι συνηθισμένο να ενεργοποιείται μόνο η πιστοποίηση βασισμένη σε κλειδιά ή διπλού παράγοντα αυθεντικοποίησης αντί για την απλή πιστοποίηση βασισμένη σε κωδικό πρόσβασης. Ωστόσο, συχνά οι ισχυρότερες μέθοδοι πιστοποίησης ενεργοποιούνται χωρίς να απενεργοποιούνται οι αδύναμες. Ένα συχνό παράδειγμα είναι η ενεργοποίηση της `publickey` στη διαμόρφωση του openSSH και η ορισμός της ως προεπιλεγμένης μεθόδου, αλλά χωρίς να απενεργοποιείται η `password`. Έτσι, χρησιμοποιώντας τη λεπτομερή λειτουργία του πελάτη SSH, ένας επιτιθέμενος μπορεί να δει ότι μια αδύναμη μέθοδος είναι ενεργοποιημένη:
```bash
ssh -v 192.168.1.94
OpenSSH_8.1p1, OpenSSL 1.1.1d  10 Sep 2019
...
debug1: Authentications that can continue: publickey,password,keyboard-interactive
```
Για παράδειγμα, αν έχει οριστεί ένα όριο αποτυχίας πιστοποίησης και δεν έχετε ποτέ την ευκαιρία να φτάσετε στη μέθοδο κωδικού πρόσβασης, μπορείτε να χρησιμοποιήσετε την επιλογή `PreferredAuthentications` για να εξαναγκάσετε τη χρήση αυτής της μεθόδου.
```bash
ssh -v 192.168.1.94 -o PreferredAuthentications=password
...
debug1: Next authentication method: password
```
Είναι απαραίτητο να ελεγχθεί η διαμόρφωση του διακομιστή SSH για να επιβεβαιωθεί ότι επιτρέπονται μόνο οι αναμενόμενες μέθοδοι. Η χρήση της λειτουργίας verbose στον πελάτη μπορεί να βοηθήσει στο να δούμε την αποτελεσματικότητα της διαμόρφωσης.

### Αρχεία διαμόρφωσης
```bash
ssh_config
sshd_config
authorized_keys
ssh_known_hosts
known_hosts
id_rsa
```
## Fuzzing

* [https://packetstormsecurity.com/files/download/71252/sshfuzz.txt](https://packetstormsecurity.com/files/download/71252/sshfuzz.txt)
* [https://www.rapid7.com/db/modules/auxiliary/fuzzers/ssh/ssh\_version\_2](https://www.rapid7.com/db/modules/auxiliary/fuzzers/ssh/ssh\_version\_2)

## Αναφορές

* Μπορείτε να βρείτε ενδιαφέρουσες οδηγίες για το πώς να ενισχύσετε το SSH στο [https://www.ssh-audit.com/hardening\_guides.html](https://www.ssh-audit.com/hardening\_guides.html)
* [https://community.turgensec.com/ssh-hacking-guide](https://community.turgensec.com/ssh-hacking-guide)

<img src="../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt="" data-size="original">

Εάν ενδιαφέρεστε για μια **καριέρα στο χάκινγκ** και θέλετε να χακεύετε αυτό που δεν μπορεί να χακευτεί - **προσλαμβάνουμε!** (_απαιτείται άριστη γραπτή και προφορική γνώση της πολωνικής γλώσσας_).

{% embed url="https://www.stmcyber.com/careers" %}

## Αυτόματες Εντολές HackTricks
```
Protocol_Name: SSH
Port_Number: 22
Protocol_Description: Secure Shell Hardening

Entry_1:
Name: Hydra Brute Force
Description: Need Username
Command: hydra -v -V -u -l {Username} -P {Big_Passwordlist} -t 1 {IP} ssh

Entry_2:
Name: consolesless mfs enumeration
Description: SSH enumeration without the need to run msfconsole
Note: sourced from https://github.com/carlospolop/legion
Command: msfconsole -q -x 'use auxiliary/scanner/ssh/ssh_version; set RHOSTS {IP}; set RPORT 22; run; exit' && msfconsole -q -x 'use scanner/ssh/ssh_enumusers; set RHOSTS {IP}; set RPORT 22; run; exit' && msfconsole -q -x 'use auxiliary/scanner/ssh/juniper_backdoor; set RHOSTS {IP}; set RPORT 22; run; exit'

```
<details>

<summary><strong>Μάθετε το χάκινγκ του AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι για να υποστηρίξετε το HackTricks:

* Εάν θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**την Οικογένεια PEASS**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε στη** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στη [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Μοιραστείτε τα χάκινγκ κόλπα σας υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>
