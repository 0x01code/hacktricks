# 22 - Pentesting SSH/SFTP

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Travaillez-vous dans une **entreprise de cybers√©curit√©** ? Voulez-vous voir votre **entreprise annonc√©e dans HackTricks** ? Ou voulez-vous avoir acc√®s √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFT**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**üí¨**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR au** [**repo hacktricks**](https://github.com/carlospolop/hacktricks) **et au** [**repo hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

<img src="../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt="" data-size="original">

Si vous √™tes int√©ress√© par une **carri√®re en piratage** et souhaitez pirater l'impossible - **nous recrutons !** (_ma√Ætrise du polonais √©crit et parl√© requise_).

{% embed url="https://www.stmcyber.com/careers" %}

## Informations de base

**SSH ou Secure Shell ou Secure Socket Shell,** est un protocole r√©seau qui offre aux utilisateurs un **moyen s√©curis√© d'acc√©der √† un ordinateur via un r√©seau non s√©curis√©.**

**Port par d√©faut :** 22
```
22/tcp open  ssh     syn-ack
```
**Serveurs SSH :**

* [openSSH](http://www.openssh.org) - OpenBSD SSH, inclus dans les distributions BSD, Linux et Windows depuis Windows 10
* [Dropbear](https://matt.ucc.asn.au/dropbear/dropbear.html) - Impl√©mentation SSH pour les environnements avec des ressources m√©moire et processeur limit√©es, inclus dans OpenWrt
* [PuTTY](https://www.chiark.greenend.org.uk/\~sgtatham/putty/) - Impl√©mentation SSH pour Windows, le client est couramment utilis√© mais l'utilisation du serveur est plus rare
* [CopSSH](https://www.itefix.net/copssh) - Impl√©mentation d'OpenSSH pour Windows

**Biblioth√®ques SSH (impl√©mentation c√¥t√© serveur) :**

* [libssh](https://www.libssh.org) - Biblioth√®que C multiplateforme impl√©mentant le protocole SSHv2 avec des liens en [Python](https://github.com/ParallelSSH/ssh-python), [Perl](https://github.com/garnier-quentin/perl-libssh/) et [R](https://github.com/ropensci/ssh) ; elle est utilis√©e par KDE pour sftp et par GitHub pour l'infrastructure SSH git
* [wolfSSH](https://www.wolfssl.com/products/wolfssh/) - Biblioth√®que serveur SSHv2 √©crite en C ANSI et destin√©e aux environnements embarqu√©s, temps r√©el et aux ressources limit√©es
* [Apache MINA SSHD](https://mina.apache.org/sshd-project/index.html) - La biblioth√®que Java Apache SSHD est bas√©e sur Apache MINA
* [paramiko](https://github.com/paramiko/paramiko) - Biblioth√®que Python pour le protocole SSHv2

## √ânum√©ration

### Capture de banni√®re
```bash
nc -vn <IP> 22
```
### Audit automatis√© de ssh-audit

ssh-audit est un outil d'audit de configuration des serveurs et clients SSH.

[https://github.com/jtesta/ssh-audit](https://github.com/jtesta/ssh-audit) est un fork mis √† jour de [https://github.com/arthepsy/ssh-audit/](https://github.com/arthepsy/ssh-audit/)

**Fonctionnalit√©s:**

* Prise en charge des serveurs SSH1 et SSH2;
* Analyse de la configuration du client SSH;
* R√©cup√©ration de la banni√®re, reconnaissance du p√©riph√©rique ou du logiciel et du syst√®me d'exploitation, d√©tection de la compression;
* Collecte des algorithmes d'√©change de cl√©s, de cl√©s d'h√¥te, de chiffrement et de code d'authentification des messages;
* Affichage des informations sur les algorithmes (disponibles depuis, supprim√©s/d√©sactiv√©s, non s√©curis√©s/faibles/obsol√®tes, etc.);
* Recommandations sur les algorithmes (ajout ou suppression en fonction de la version du logiciel reconnu);
* Affichage des informations de s√©curit√© (probl√®mes connexes, liste des CVE attribu√©s, etc.);
* Analyse de la compatibilit√© des versions SSH en fonction des informations sur les algorithmes;
* Informations historiques provenant d'OpenSSH, Dropbear SSH et libssh;
* Fonctionne sur Linux et Windows;
* Aucune d√©pendance.
```bash
usage: ssh-audit.py [-1246pbcnjvlt] <host>

-1,  --ssh1             force ssh version 1 only
-2,  --ssh2             force ssh version 2 only
-4,  --ipv4             enable IPv4 (order of precedence)
-6,  --ipv6             enable IPv6 (order of precedence)
-p,  --port=<port>      port to connect
-b,  --batch            batch output
-c,  --client-audit     starts a server on port 2222 to audit client
software config (use -p to change port;
use -t to change timeout)
-n,  --no-colors        disable colors
-j,  --json             JSON output
-v,  --verbose          verbose output
-l,  --level=<level>    minimum output level (info|warn|fail)
-t,  --timeout=<secs>   timeout (in seconds) for connection and reading
(default: 5)
$ python3 ssh-audit <IP>
```
### Cl√© SSH publique du serveur

```plaintext
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDZz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz
```bash
ssh-keyscan -t rsa <IP> -p <PORT>
```
### Algorithmes de chiffrement faibles

Cela est d√©couvert par d√©faut par **nmap**. Mais vous pouvez √©galement utiliser **sslcan** ou **sslyze**.

### Scripts Nmap
```bash
nmap -p22 <ip> -sC # Send default nmap scripts for SSH
nmap -p22 <ip> -sV # Retrieve version
nmap -p22 <ip> --script ssh2-enum-algos # Retrieve supported algorythms
nmap -p22 <ip> --script ssh-hostkey --script-args ssh_hostkey=full # Retrieve weak keys
nmap -p22 <ip> --script ssh-auth-methods --script-args="ssh.user=root" # Check authentication methods
```
### Shodan

* `ssh`

## Brute force des noms d'utilisateur, des mots de passe et des cl√©s priv√©es

### √ânum√©ration des noms d'utilisateur

Dans certaines versions d'OpenSSH, vous pouvez effectuer une attaque temporelle pour √©num√©rer les utilisateurs. Vous pouvez utiliser un module Metasploit pour exploiter cela :
```
msf> use scanner/ssh/ssh_enumusers
```
### [Brute force](../generic-methodologies-and-resources/brute-force.md#ssh)

Quelques identifiants ssh courants [ici](https://github.com/danielmiessler/SecLists/blob/master/Passwords/Default-Credentials/ssh-betterdefaultpasslist.txt) et [ici](https://github.com/danielmiessler/SecLists/blob/master/Passwords/Common-Credentials/top-20-common-SSH-passwords.txt) et ci-dessous.

### Brute Force de Cl√© Priv√©e

Si vous connaissez certaines cl√©s priv√©es ssh qui pourraient √™tre utilis√©es... essayons. Vous pouvez utiliser le script nmap :
```
https://nmap.org/nsedoc/scripts/ssh-publickey-acceptance.html
```
Ou le module auxiliaire MSF :
```
msf> use scanner/ssh/ssh_identify_pubkeys
```
Ou utilisez `ssh-keybrute.py` (python3 natif, l√©ger et avec des algorithmes h√©rit√©s activ√©s) : [snowdroppe/ssh-keybrute](https://github.com/snowdroppe/ssh-keybrute).

#### Les cl√©s connues comme √©tant mauvaises peuvent √™tre trouv√©es ici :

{% embed url="https://github.com/rapid7/ssh-badkeys/tree/master/authorized" %}

#### Cl√©s SSH faibles / PRNG pr√©visible de Debian

Certains syst√®mes pr√©sentent des failles connues dans la graine al√©atoire utilis√©e pour g√©n√©rer du mat√©riel cryptographique. Cela peut entra√Æner une r√©duction drastique de l'espace des cl√©s, qui peut √™tre brute-forc√©. Des ensembles de cl√©s pr√©-g√©n√©r√©es g√©n√©r√©es sur des syst√®mes Debian affect√©s par un PRNG faible sont disponibles ici : [g0tmi1k/debian-ssh](https://github.com/g0tmi1k/debian-ssh).

Vous devriez chercher ici pour rechercher des cl√©s valides pour la machine cible.

### Kerberos

**crackmapexec** utilisant le protocole `ssh` peut utiliser l'option `--kerberos` pour **s'authentifier via Kerberos**.\
Pour plus d'informations, ex√©cutez `crackmapexec ssh --help`.

## Identifiants par d√©faut

| **Fournisseur** | **Noms d'utilisateur**                                                                                      | **Mots de passe**                                                                                                                                                                                          |
| --------------- | ----------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| APC             | apc, device                                                                                                 | apc                                                                                                                                                                                                        |
| Brocade         | admin                                                                                                       | admin123, password, brocade, fibranne                                                                                                                                                                      |
| Cisco           | admin, cisco, enable, hsa, pix, pnadmin, ripeop, root, shelladmin                                           | admin, Admin123, default, password, secur4u, cisco, Cisco, \_Cisco, cisco123, C1sco!23, Cisco123, Cisco1234, TANDBERG, change\_it, 12345, ipics, pnadmin, diamond, hsadb, c, cc, attack, blender, changeme |
| Citrix          | root, nsroot, nsmaint, vdiadmin, kvm, cli, admin                                                            | C1trix321, nsroot, nsmaint, kaviza, kaviza123, freebsd, public, rootadmin, wanscaler                                                                                                                       |
| D-Link          | admin, user                                                                                                 | private, admin, user                                                                                                                                                                                       |
| Dell            | root, user1, admin, vkernel, cli                                                                            | calvin, 123456, password, vkernel, Stor@ge!, admin                                                                                                                                                         |
| EMC             | admin, root, sysadmin                                                                                       | EMCPMAdm7n, Password#1, Password123#, sysadmin, changeme, emc                                                                                                                                              |
| HP/3Com         | admin, root, vcx, app, spvar, manage, hpsupport, opc\_op                                                    | admin, password, hpinvent, iMC123, pvadmin, passw0rd, besgroup, vcx, nice, access, config, 3V@rpar, 3V#rpar, procurve, badg3r5, OpC\_op, !manage, !admin                                                   |
| Huawei          | admin, root                                                                                                 | 123456, admin, root, Admin123, Admin@storage, Huawei12#$, HwDec@01, hwosta2.0, HuaWei123, fsp200@HW, huawei123                                                                                             |
| IBM             | USERID, admin, manager, mqm, db2inst1, db2fenc1, dausr1, db2admin, iadmin, system, device, ufmcli, customer | PASSW0RD, passw0rd, admin, password, Passw8rd, iadmin, apc, 123456, cust0mer                                                                                                                               |
| Juniper         | netscreen                                                                                                   | netscreen                                                                                                                                                                                                  |
| NetApp          | admin                                                                                                       | netapp123                                                                                                                                                                                                  |
| Oracle          | root, oracle, oravis, applvis, ilom-admin, ilom-operator, nm2user                                           | changeme, ilom-admin, ilom-operator, welcome1, oracle                                                                                                                                                      |
| VMware          | vi-admin, root, hqadmin, vmware, admin                                                                      | vmware, vmw@re, hqadmin, default                                                                                                                                                                           |

## SSH-MitM

Si vous √™tes sur le r√©seau local de la victime qui va se connecter au serveur SSH en utilisant un nom d'utilisateur et un mot de passe, vous pouvez essayer de **r√©aliser une attaque MitM pour voler ces informations d'identification** :

**Chemin de l'attaque :**

- le trafic de l'utilisateur est redirig√© vers la machine attaquante
- l'attaquant surveille les tentatives de connexion au serveur SSH et les redirige vers son propre serveur SSH
- le serveur SSH de l'attaquant est configur√©, premi√®rement, pour enregistrer toutes les donn√©es saisies, y compris le mot de passe de l'utilisateur, et deuxi√®mement, pour envoyer des commandes au serveur SSH l√©gitime auquel l'utilisateur souhaite se connecter, pour les ex√©cuter, puis renvoyer les r√©sultats √† l'utilisateur l√©gitime

\*\*\*\*[**SSH MITM**](https://github.com/jtesta/ssh-mitm) \*\*\*\* fait exactement ce qui est d√©crit ci-dessus.

Pour capturer et effectuer le v√©ritable MitM, vous pouvez utiliser des techniques telles que l'usurpation ARP, l'usurpation DNS ou d'autres d√©crites dans les [**attaques d'usurpation de r√©seau**](../generic-methodologies-and-resources/pentesting-network/#spoofing).

## Mauvaises configurations de la configuration

### Connexion en tant que root

Par d√©faut, la plupart des impl√©mentations de serveur SSH autoriseront la connexion en tant que root. Il est conseill√© de la d√©sactiver car si les informations d'identification de ce compte sont divulgu√©es, les attaquants obtiendront directement des privil√®ges administratifs, ce qui leur permettra √©galement de mener des attaques de force brute sur ce compte.

**Comment d√©sactiver la connexion en tant que root pour openSSH :**

1. Modifier la configuration du serveur SSH `sudoedit /etc/ssh/sshd_config`
2. Changer `#PermitRootLogin yes` en `PermitRootLogin no`
3. Prendre en compte les modifications de configuration : `sudo systemctl daemon-reload`
4. Red√©marrer le serveur SSH `sudo systemctl restart sshd`

### Ex√©cution de commandes SFTP

Une autre mauvaise configuration courante de SSH est souvent observ√©e dans la configuration SFTP. La plupart du temps, lors de la cr√©ation d'un serveur SFTP, l'administrateur souhaite que les utilisateurs aient un acc√®s SFTP pour partager des fichiers, mais pas un acc√®s shell distant sur la machine. Ils pensent donc qu'en cr√©ant un utilisateur, en lui attribuant un shell fictif (comme `/usr/bin/nologin` ou `/usr/bin/false`) et en le chrootant dans une prison, cela suffit pour √©viter un acc√®s shell ou des abus sur l'ensemble du syst√®me de fichiers. Mais ils se trompent, **un utilisateur peut demander √† ex√©cuter une commande juste apr√®s l'authentification avant que sa commande ou son shell par d√©faut ne soit ex√©cut√©**. Ainsi, pour contourner le shell fictif qui refusera l'acc√®s shell, il suffit de demander √† ex√©cuter une commande (par exemple `/bin/bash`) avant, simplement en faisant :
```
$ ssh -v noraj@192.168.1.94 id
...
Password:
debug1: Authentication succeeded (keyboard-interactive).
Authenticated to 192.168.1.94 ([192.168.1.94]:22).
debug1: channel 0: new [client-session]
debug1: Requesting no-more-sessions@openssh.com
debug1: Entering interactive session.
debug1: pledge: network
debug1: client_input_global_request: rtype hostkeys-00@openssh.com want_reply 0
debug1: Sending command: id
debug1: client_input_channel_req: channel 0 rtype exit-status reply 0
debug1: client_input_channel_req: channel 0 rtype eow@openssh.com reply 0
uid=1000(noraj) gid=100(users) groups=100(users)
debug1: channel 0: free: client-session, nchannels 1
Transferred: sent 2412, received 2480 bytes, in 0.1 seconds
Bytes per second: sent 43133.4, received 44349.5
debug1: Exit status 0

$ ssh noraj@192.168.1.94 /bin/bash
```
Voici un exemple de configuration s√©curis√©e SFTP (`/etc/ssh/sshd_config` - openSSH) pour l'utilisateur `noraj` :

```plaintext
# Configuration for SFTP
Subsystem sftp internal-sftp

Match User noraj
    ChrootDirectory /home/noraj
    ForceCommand internal-sftp
    AllowTcpForwarding no
    X11Forwarding no
    PasswordAuthentication yes
    PermitTunnel no
    PermitTTY no
    PermitUserEnvironment no
    AllowAgentForwarding no
    AllowStreamLocalForwarding no
    ClientAliveInterval 300
    ClientAliveCountMax 2
    UsePAM yes
```

Cette configuration restreint l'utilisateur `noraj` √† son r√©pertoire personnel (`/home/noraj`) et lui permet uniquement d'utiliser le protocole SFTP pour transf√©rer des fichiers. Les options `AllowTcpForwarding` et `X11Forwarding` sont d√©sactiv√©es pour emp√™cher toute redirection de port ou transfert X11. L'authentification par mot de passe est autoris√©e, mais les tunnels, les TTY et les environnements utilisateur ne sont pas permis. Les options `AllowAgentForwarding` et `AllowStreamLocalForwarding` sont √©galement d√©sactiv√©es pour des raisons de s√©curit√©. Le serveur envoie un message de v√©rification toutes les 300 secondes pour v√©rifier si le client est toujours actif, et si le client ne r√©pond pas apr√®s deux tentatives, la connexion est ferm√©e. Enfin, l'option `UsePAM` est activ√©e pour utiliser le module PAM pour l'authentification.
```
Match User noraj
ChrootDirectory %h
ForceCommand internal-sftp
AllowTcpForwarding no
PermitTunnel no
X11Forwarding no
PermitTTY no
```
Cette configuration permettra uniquement le SFTP : en d√©sactivant l'acc√®s au shell en for√ßant la commande de d√©marrage et en d√©sactivant l'acc√®s TTY, mais √©galement en d√©sactivant toutes sortes de redirection de port ou de tunneling.

### Tunneling SFTP

Si vous avez acc√®s √† un serveur SFTP, vous pouvez √©galement faire transiter votre trafic par celui-ci, par exemple en utilisant la redirection de port courante :
```
sudo ssh -L <local_port>:<remote_host>:<remote_port> -N -f <username>@<ip_compromised>
```
### SFTP Symlink

Le **sftp** dispose de la commande "**symlink**". Par cons√©quent, si vous avez des **droits d'√©criture** dans un dossier, vous pouvez cr√©er des **liens symboliques** vers d'autres dossiers/fichiers. Comme vous √™tes probablement **pi√©g√©** √† l'int√©rieur d'un chroot, cela ne sera pas particuli√®rement utile pour vous. Cependant, si vous pouvez **acc√©der** au **lien symbolique** cr√©√© √† partir d'un **service sans chroot** (par exemple, si vous pouvez y acc√©der depuis le web), vous pourriez **ouvrir les fichiers li√©s par le lien symbolique via le web**.

Par exemple, pour cr√©er un **lien symbolique** √† partir d'un nouveau fichier "**_**froot**_**" vers "**_**/**_**"**:
```
sftp> symlink / froot
```
Si vous pouvez acc√©der au fichier "_froot_" via le web, vous pourrez lister le dossier racine ("/") du syst√®me.

### M√©thodes d'authentification

Dans les environnements √† haute s√©curit√©, il est courant d'activer uniquement l'authentification bas√©e sur une cl√© ou √† deux facteurs plut√¥t que l'authentification bas√©e sur un mot de passe simple. Cependant, il arrive souvent que les m√©thodes d'authentification plus solides soient activ√©es sans d√©sactiver les plus faibles. Un cas fr√©quent est d'activer `publickey` dans la configuration openSSH et de le d√©finir comme m√©thode par d√©faut, mais sans d√©sactiver `password`. Ainsi, en utilisant le mode verbeux du client SSH, un attaquant peut voir qu'une m√©thode plus faible est activ√©e :
```
$ ssh -v 192.168.1.94
OpenSSH_8.1p1, OpenSSL 1.1.1d  10 Sep 2019
...
debug1: Authentications that can continue: publickey,password,keyboard-interactive
```
Par exemple, si une limite d'√©chec d'authentification est d√©finie et que vous n'avez jamais la possibilit√© d'atteindre la m√©thode de mot de passe, vous pouvez utiliser l'option `PreferredAuthentications` pour forcer l'utilisation de cette m√©thode.
```
$ ssh -v 192.168.1.94 -o PreferredAuthentications=password
...
debug1: Next authentication method: password
```
Il est n√©cessaire de v√©rifier la configuration du serveur SSH pour s'assurer que seules les m√©thodes attendues sont autoris√©es. L'utilisation du mode verbeux sur le client peut aider √† voir l'efficacit√© de la configuration.

### Fichiers de configuration
```
ssh_config
sshd_config
authorized_keys
ssh_known_hosts
known_hosts
id_rsa
```
## Fuzzing

* [https://packetstormsecurity.com/files/download/71252/sshfuzz.txt](https://packetstormsecurity.com/files/download/71252/sshfuzz.txt)
* [https://www.rapid7.com/db/modules/auxiliary/fuzzers/ssh/ssh\_version\_2](https://www.rapid7.com/db/modules/auxiliary/fuzzers/ssh/ssh\_version\_2)

## R√©f√©rences

* Vous pouvez trouver des guides int√©ressants sur la fa√ßon de renforcer SSH dans [https://www.ssh-audit.com/hardening\_guides.html](https://www.ssh-audit.com/hardening\_guides.html)
* [https://community.turgensec.com/ssh-hacking-guide](https://community.turgensec.com/ssh-hacking-guide)

<img src="../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt="" data-size="original">

Si vous √™tes int√©ress√© par une **carri√®re de hacking** et souhaitez pirater l'impossible - **nous recrutons !** (_ma√Ætrise du polonais √©crit et parl√© requise_).

{% embed url="https://www.stmcyber.com/careers" %}

## Commandes automatiques HackTricks
```
Protocol_Name: SSH
Port_Number: 22
Protocol_Description: Secure Shell Hardening

Entry_1:
Name: Hydra Brute Force
Description: Need Username
Command: hydra -v -V -u -l {Username} -P {Big_Passwordlist} -t 1 {IP} ssh

Entry_2:
Name: consolesless mfs enumeration
Description: SSH enumeration without the need to run msfconsole
Note: sourced from https://github.com/carlospolop/legion
Command: msfconsole -q -x 'use auxiliary/scanner/ssh/ssh_version; set RHOSTS {IP}; set RPORT 22; run; exit' && msfconsole -q -x 'use scanner/ssh/ssh_enumusers; set RHOSTS {IP}; set RPORT 22; run; exit' && msfconsole -q -x 'use auxiliary/scanner/ssh/juniper_backdoor; set RHOSTS {IP}; set RPORT 22; run; exit'

```
<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Travaillez-vous dans une **entreprise de cybers√©curit√©** ? Voulez-vous voir votre **entreprise annonc√©e dans HackTricks** ? Ou voulez-vous avoir acc√®s √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFT**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**üí¨**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR au** [**repo hacktricks**](https://github.com/carlospolop/hacktricks) **et au** [**repo hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
