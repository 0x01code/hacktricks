# 161,162,10161,10162/udp - Pentesting SNMP

<details>

<summary><strong>Aprende hacking en AWS desde cero hasta experto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** 춰Consulta los [**PLANES DE SUSCRIPCI칍N**](https://github.com/sponsors/carlospolop)!
* Obt칠n el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci칩n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s칤gueme** en **Twitter** 游냕 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

<img src="../../.gitbook/assets/i3.png" alt="" data-size="original">\
**Consejo de recompensa por errores**: **Reg칤strate** en **Intigriti**, una plataforma premium de **recompensas por errores creada por hackers, para hackers**. 춰칔nete a nosotros en [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) hoy, y comienza a ganar recompensas de hasta **$100,000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

## Informaci칩n B치sica

**SNMP - Protocolo Simple de Administraci칩n de Redes** es un protocolo utilizado para monitorear diferentes dispositivos en la red (como routers, switches, impresoras, IoTs...).
```
PORT    STATE SERVICE REASON                 VERSION
161/udp open  snmp    udp-response ttl 244   ciscoSystems SNMPv3 server (public)
```
{% hint style="info" %}
SNMP tambi칠n utiliza el puerto **162/UDP** para **traps**. Estos son **paquetes de datos enviados desde el servidor SNMP al cliente sin ser solicitados expl칤citamente**.
{% endhint %}

### MIB

Para garantizar que el acceso SNMP funcione entre fabricantes y con diferentes combinaciones cliente-servidor, se cre칩 la **Base de Informaci칩n de Gesti칩n (MIB)**. MIB es un **formato independiente para almacenar informaci칩n del dispositivo**. Un MIB es un archivo **de texto** en el que se enumeran todos los **objetos SNMP** consultables de un dispositivo en una jerarqu칤a de 치rbol **estandarizada**. Contiene al menos un `Identificador de Objeto` (`OID`), que, adem치s de la **direcci칩n 칰nica necesaria** y un **nombre**, tambi칠n proporciona informaci칩n sobre el tipo, derechos de acceso y una descripci칩n del objeto respectivo.\
Los archivos MIB est치n escritos en el formato de texto ASCII basado en `Notaci칩n de Sintaxis Abstracta Uno` (`ASN.1`). Los **MIB no contienen datos**, pero explican **d칩nde encontrar qu칠 informaci칩n** y c칩mo es, qu칠 valores devuelve para el OID espec칤fico, o qu칠 tipo de datos se utiliza.

### OIDs

Los **Identificadores de Objeto (OIDs)** juegan un papel crucial. Estos identificadores 칰nicos est치n dise침ados para gestionar objetos dentro de una **Base de Informaci칩n de Gesti칩n (MIB)**.

Los niveles m치s altos de los IDs de objetos MIB, o OIDs, se asignan a diversas organizaciones de establecimiento de est치ndares. Es dentro de estos niveles superiores donde se establece el marco para las pr치cticas y est치ndares de gesti칩n globales.

Adem치s, a los proveedores se les concede la libertad de establecer ramas privadas. Dentro de estas ramas, tienen la **autonom칤a para incluir objetos gestionados pertinentes a sus propias l칤neas de productos**. Este sistema garantiza que haya un m칠todo estructurado y organizado para identificar y gestionar una amplia variedad de objetos entre diferentes proveedores y est치ndares.

![](../../.gitbook/assets/snmp_oid_mib_tree.png)

Puedes **navegar** a trav칠s de un **치rbol OID** desde la web aqu칤: [http://www.oid-info.com/cgi-bin/display?tree=#focus](http://www.oid-info.com/cgi-bin/display?tree=#focus) o **ver qu칠 significa un OID** (como `1.3.6.1.2.1.1`) accediendo a [http://oid-info.com/get/1.3.6.1.2.1.1](http://oid-info.com/get/1.3.6.1.2.1.1).\
Existen algunos **OIDs conocidos** como los que se encuentran dentro de [1.3.6.1.2.1](http://oid-info.com/get/1.3.6.1.2.1) que hacen referencia a variables SNMP definidas por MIB-2. Y a partir de los **OIDs pendientes de este** se pueden obtener algunos datos de host interesantes (datos del sistema, de red, de procesos...)

### **Ejemplo de OID**

[**Ejemplo desde aqu칤**](https://www.netadmintools.com/snmp-mib-and-oids/):

**`1 . 3 . 6 . 1 . 4 . 1 . 1452 . 1 . 2 . 5 . 1 . 3. 21 . 1 . 4 . 7`**

Aqu칤 hay un desglose de esta direcci칩n.

* 1: se llama ISO y establece que este es un OID. Por eso todos los OIDs comienzan con "1"
* 3: se llama ORG y se utiliza para especificar la organizaci칩n que construy칩 el dispositivo.
* 6: es el dod o el Departamento de Defensa que es la organizaci칩n que estableci칩 primero Internet.
* 1: es el valor de Internet para denotar que todas las comunicaciones ocurrir치n a trav칠s de Internet.
* 4: este valor determina que este dispositivo es fabricado por una organizaci칩n privada y no gubernamental.
* 1: este valor denota que el dispositivo es fabricado por una empresa o entidad comercial.

Estos primeros seis valores tienden a ser los mismos para todos los dispositivos y le brindan informaci칩n b치sica sobre ellos. Esta secuencia de n칰meros ser치 la misma para todos los OIDs, excepto cuando el dispositivo es fabricado por el gobierno.

Pasando a la siguiente serie de n칰meros.

* 1452: da el nombre de la organizaci칩n que fabric칩 este dispositivo.
* 1: explica el tipo de dispositivo. En este caso, es un despertador.
* 2: determina que este dispositivo es una unidad terminal remota.

El resto de los valores proporcionan informaci칩n espec칤fica sobre el dispositivo.

* 5: denota un punto de alarma discreto.
* 1: punto espec칤fico en el dispositivo
* 3: puerto
* 21: direcci칩n del puerto
* 1: pantalla para el puerto
* 4: n칰mero de punto
* 7: estado del punto

### Versiones de SNMP

Hay 2 versiones importantes de SNMP:

* **SNMPv1**: Principal, sigue siendo la m치s frecuente, la **autenticaci칩n se basa en una cadena** (cadena de comunidad) que viaja en **texto plano** (toda la informaci칩n viaja en texto plano). **La versi칩n 2 y 2c** env칤an el **tr치fico en texto plano** y utilizan una **cadena de comunidad como autenticaci칩n**.
* **SNMPv3**: Utiliza una mejor **forma de autenticaci칩n** y la informaci칩n viaja **encriptada** (se podr칤a realizar un **ataque de diccionario** pero ser칤a mucho m치s dif칤cil encontrar las credenciales correctas que en SNMPv1 y v2).

### Cadenas de Comunidad

Como se mencion칩 anteriormente, **para acceder a la informaci칩n almacenada en el MIB necesitas conocer la cadena de comunidad en las versiones 1 y 2/2c y las credenciales en la versi칩n 3.**\
Existen **2 tipos de cadenas de comunidad**:

* **`public`** principalmente funciones de **solo lectura**
* **`private`** **Lectura/Escritura** en general

Ten en cuenta que **la capacidad de escritura de un OID depende de la cadena de comunidad utilizada**, por lo que **incluso** si descubres que se est치 utilizando "**public**", podr칤as ser capaz de **escribir algunos valores**. Adem치s, **pueden** existir objetos que son **siempre "Solo Lectura"**.\
Si intentas **escribir** un objeto, se recibe un error de **`noSuchName` o `readOnly`**.

En las versiones 1 y 2/2c, si utilizas una **cadena de comunidad incorrecta**, el servidor no **responder치**. Por lo tanto, si responde, se utiliz칩 una **cadena de comunidad v치lida**.

## Puertos

[Desde Wikipedia](https://en.wikipedia.org/wiki/Simple_Network_Management_Protocol#:~:text=All%20SNMP%20messages%20are%20transported,port%20161%20in%20the%20agent.):

* El agente SNMP recibe solicitudes en el puerto UDP **161**.
* El administrador recibe notificaciones ([Traps](https://en.wikipedia.org/wiki/Simple\_Network\_Management\_Protocol#Trap) e [InformRequests](https://en.wikipedia.org/wiki/Simple\_Network\_Management\_Protocol#InformRequest)) en el puerto **162**.
* Cuando se utiliza [Seguridad de la Capa de Transporte](https://en.wikipedia.org/wiki/Transport\_Layer\_Security) o [Seguridad de la Capa de Transporte de Datagramas](https://en.wikipedia.org/wiki/Datagram\_Transport\_Layer\_Security), las solicitudes se reciben en el puerto **10161** y las notificaciones se env칤an al puerto **10162**.

## Ataque de Fuerza Bruta a la Cadena de Comunidad (v1 y v2c)

Para **adivinar la cadena de comunidad** podr칤as realizar un ataque de diccionario. Consulta [aqu칤 diferentes formas de realizar un ataque de fuerza bruta contra SNMP](../../generic-methodologies-and-resources/brute-force.md#snmp). Una cadena de comunidad frecuentemente utilizada es `public`.

## Enumeraci칩n de SNMP

Se recomienda instalar lo siguiente para ver qu칠 significa **cada OID recopilado** del dispositivo:
```bash
apt-get install snmp-mibs-downloader
download-mibs
# Finally comment the line saying "mibs :" in /etc/snmp/snmp.conf
sudo vi /etc/snmp/snmp.conf
```
Si conoces una cadena de comunidad v치lida, puedes acceder a los datos utilizando **SNMPWalk** o **SNMP-Check**:
```bash
snmpbulkwalk -c [COMM_STRING] -v [VERSION] [IP] . #Don't forget the final dot
snmpbulkwalk -c public -v2c 10.10.11.136 .

snmpwalk -v [VERSION_SNMP] -c [COMM_STRING] [DIR_IP]
snmpwalk -v [VERSION_SNMP] -c [COMM_STRING] [DIR_IP] 1.3.6.1.2.1.4.34.1.3 #Get IPv6, needed dec2hex
snmpwalk -v [VERSION_SNMP] -c [COMM_STRING] [DIR_IP] NET-SNMP-EXTEND-MIB::nsExtendObjects #get extended
snmpwalk -v [VERSION_SNMP] -c [COMM_STRING] [DIR_IP] .1 #Enum all

snmp-check [DIR_IP] -p [PORT] -c [COMM_STRING]

nmap --script "snmp* and not snmp-brute" <target>

braa <community string>@<IP>:.1.3.6.* #Bruteforce specific OID
```
Gracias a las consultas extendidas (download-mibs), es posible enumerar a칰n m치s sobre el sistema con el siguiente comando:
```bash
snmpwalk -v X -c public <IP> NET-SNMP-EXTEND-MIB::nsExtendOutputFull
```
**SNMP** tiene mucha informaci칩n sobre el host y cosas que pueden resultarte interesantes son: **Interfaces de red** (direcciones IPv4 e **IPv6**), Nombres de usuario, Tiempo de actividad, Versi칩n del servidor/SO, y **procesos** en ejecuci칩n (pueden contener contrase침as)....

### **Configuraciones Peligrosas**

En el 치mbito de la gesti칩n de redes, ciertas configuraciones y par치metros son clave para garantizar un monitoreo y control exhaustivos.

### Configuraciones de Acceso

Dos configuraciones principales permiten el acceso al **치rbol OID completo**, que es un componente crucial en la gesti칩n de redes:

1. **`rwuser noauth`** se establece para permitir acceso completo al 치rbol OID sin necesidad de autenticaci칩n. Esta configuraci칩n es directa y permite acceso irrestricto.

2. Para un control m치s espec칤fico, se puede otorgar acceso utilizando:
- **`rwcommunity`** para direcciones **IPv4**, y
- **`rwcommunity6`** para direcciones **IPv6**.

Ambos comandos requieren una **cadena de comunidad** y la direcci칩n IP relevante, ofreciendo acceso completo independientemente del origen de la solicitud.

### Par치metros SNMP para Microsoft Windows

Una serie de valores de **Base de Informaci칩n de Gesti칩n (MIB)** se utilizan para monitorear varios aspectos de un sistema Windows a trav칠s de SNMP:

- **Procesos del Sistema**: Accedido a trav칠s de `1.3.6.1.2.1.25.1.6.0`, este par치metro permite monitorear procesos activos dentro del sistema.
- **Programas en Ejecuci칩n**: El valor `1.3.6.1.2.1.25.4.2.1.2` est치 designado para rastrear programas en ejecuci칩n actualmente.
- **Ruta de Procesos**: Para determinar desde d칩nde se est치 ejecutando un proceso, se utiliza el valor MIB `1.3.6.1.2.1.25.4.2.1.4`.
- **Unidades de Almacenamiento**: El monitoreo de unidades de almacenamiento se facilita mediante `1.3.6.1.2.1.25.2.3.1.4`.
- **Nombre de Software**: Para identificar el software instalado en un sistema, se emplea `1.3.6.1.2.1.25.6.3.1.2`.
- **Cuentas de Usuario**: El valor `1.3.6.1.4.1.77.1.2.25` permite el seguimiento de cuentas de usuario.
- **Puertos Locales TCP**: Finalmente, `1.3.6.1.2.1.6.13.1.3` est치 designado para monitorear puertos locales TCP, proporcionando informaci칩n sobre conexiones de red activas.

### Cisco

Echa un vistazo a esta p치gina si tienes equipos Cisco:

{% content-ref url="cisco-snmp.md" %}
[cisco-snmp.md](cisco-snmp.md)
{% endcontent-ref %}

## De SNMP a RCE

Si tienes la **cadena** que te permite **escribir valores** dentro del servicio SNMP, es posible que puedas abusar de ella para **ejecutar comandos**:

{% content-ref url="snmp-rce.md" %}
[snmp-rce.md](snmp-rce.md)
{% endcontent-ref %}

## **SNMP Masivo**

[Braa ](https://github.com/mteg/braa)es un esc치ner SNMP masivo. El uso previsto de esta herramienta es, por supuesto, realizar consultas SNMP, pero a diferencia de snmpwalk de net-snmp, es capaz de consultar docenas o cientos de hosts simult치neamente, y en un solo proceso. Por lo tanto, consume muy pocos recursos del sistema y realiza el escaneo MUY r치pido.

Braa implementa su PROPIA pila SNMP, por lo que NO necesita bibliotecas SNMP como net-snmp.

**Sintaxis:** braa \[Cadena de comunidad]@\[IP del servidor SNMP]:\[ID iso]
```bash
braa ignite123@192.168.1.125:.1.3.6.*
```
Esto puede extraer mucha informaci칩n en MB que no se puede procesar manualmente.


Entonces, busquemos la informaci칩n m치s interesante (de [https://blog.rapid7.com/2016/05/05/snmp-data-harvesting-during-penetration-testing/](https://blog.rapid7.com/2016/05/05/snmp-data-harvesting-during-penetration-testing/)):


### **Dispositivos**

El proceso comienza con la extracci칩n de datos de **sysDesc MIB** (1.3.6.1.2.1.1.1.0) de cada archivo para identificar los dispositivos. Esto se logra a trav칠s del uso de un **comando grep**:
```bash
grep ".1.3.6.1.2.1.1.1.0" *.snmp
```
### **Identificar Cadena Privada**

Un paso crucial implica identificar la **cadena de comunidad privada** utilizada por las organizaciones, especialmente en enrutadores Cisco IOS. Esta cadena permite la extracci칩n de **configuraciones en ejecuci칩n** de los enrutadores. La identificaci칩n a menudo se basa en analizar los datos de **trampas SNMP** en busca de la palabra "trap" con un comando **grep**:
```bash
grep -i "trap" *.snmp
```
### **Nombres de usuario/Contrase침as**

Los registros almacenados dentro de las tablas MIB se examinan en busca de **intentos fallidos de inicio de sesi칩n**, que podr칤an incluir accidentalmente contrase침as ingresadas como nombres de usuario. Se buscan palabras clave como _fail_, _failed_ o _login_ para encontrar datos valiosos:
```bash
grep -i "login\|fail" *.snmp
```
### **Correos electr칩nicos**

Finalmente, para extraer **direcciones de correo electr칩nico** de los datos, se utiliza un comando **grep** con una expresi칩n regular, enfoc치ndose en patrones que coincidan con formatos de correo electr칩nico:
```bash
grep -E -o "\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,6}\b" *.snmp
```
## Modificaci칩n de valores SNMP

Puedes usar _**NetScanTools**_ para **modificar valores**. Necesitar치s conocer la **cadena privada** para poder hacerlo.

## Spoofing

Si hay una ACL que solo permite a algunas IPs consultar el servicio SMNP, puedes falsificar una de estas direcciones dentro del paquete UDP y espiar el tr치fico.

## Examinar archivos de configuraci칩n SNMP

* snmp.conf
* snmpd.conf
* snmp-config.xml

## Comandos Autom치ticos de HackTricks
```
Protocol_Name: SNMP    #Protocol Abbreviation if there is one.
Port_Number:  161     #Comma separated if there is more than one.
Protocol_Description: Simple Network Managment Protocol         #Protocol Abbreviation Spelled out

Entry_1:
Name: Notes
Description: Notes for SNMP
Note: |
SNMP - Simple Network Management Protocol is a protocol used to monitor different devices in the network (like routers, switches, printers, IoTs...).

https://book.hacktricks.xyz/pentesting/pentesting-snmp

Entry_2:
Name: SNMP Check
Description: Enumerate SNMP
Command: snmp-check {IP}

Entry_3:
Name: OneSixtyOne
Description: Crack SNMP passwords
Command: onesixtyone -c /usr/share/seclists/Discovery/SNMP/common-snmp-community-strings-onesixtyone.txt {IP} -w 100

Entry_4:
Name: Nmap
Description: Nmap snmp (no brute)
Command: nmap --script "snmp* and not snmp-brute" {IP}

Entry_5:
Name: Hydra Brute Force
Description: Need Nothing
Command: hydra -P {Big_Passwordlist} -v {IP} snmp
```
<img src="../../.gitbook/assets/i3.png" alt="" data-size="original">\
**Consejo de recompensa por errores**: 춰**Reg칤strate** en **Intigriti**, una plataforma premium de **recompensas por errores creada por hackers, para hackers**! 칔nete a nosotros en [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) hoy mismo y comienza a ganar recompensas de hasta **$100,000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

<details>

<summary><strong>Aprende a hackear AWS de cero a h칠roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Experto en Equipos Rojos de AWS de HackTricks)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si deseas ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** 춰Consulta los [**PLANES DE SUSCRIPCI칍N**](https://github.com/sponsors/carlospolop)!
* Obt칠n el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci칩n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s칤gueme** en **Twitter** 游냕 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
