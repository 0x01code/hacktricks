# 161,162,10161,10162/udp - Pentesting SNMP

<details>

<summary><strong>Jifunze AWS hacking kutoka sifuri hadi shujaa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Mtaalam wa Timu Nyekundu ya AWS ya HackTricks)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako ikitangazwa kwenye HackTricks** au **kupakua HackTricks kwa PDF** Angalia [**MIPANGO YA KUJIUNGA**](https://github.com/sponsors/carlospolop)!
* Pata [**bidhaa rasmi za PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**Familia ya PEASS**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa [**NFTs**](https://opensea.io/collection/the-peass-family) ya kipekee
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au kikundi cha [**telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Shiriki mbinu zako za udukuzi kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos za github.

</details>

<figure><img src="../../.gitbook/assets/image (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

Ikiwa una nia ya **kazi ya udukuzi** na kudukua yasiyodukuzika - **tunakupa kazi!** (_inahitajika uwezo wa kuzungumza na kuandika Kipolishi kwa ufasaha_).

{% embed url="https://www.stmcyber.com/careers" %}

## Taarifa Msingi

**SNMP - Itifaki Rahisi ya Usimamizi wa Mtandao** ni itifaki inayotumika kufuatilia vifaa tofauti kwenye mtandao (kama vile rutuba, swichi, wachapishaji, IoTs...).
```
PORT    STATE SERVICE REASON                 VERSION
161/udp open  snmp    udp-response ttl 244   ciscoSystems SNMPv3 server (public)
```
{% hint style="info" %}
SNMP pia hutumia bandari **162/UDP** kwa **traps**. Hizi ni **pakiti za data zinazotumwa kutoka kwa seva ya SNMP kwenda kwa mteja bila kuombwa wazi**.
{% endhint %}

### MIB

Ili kuhakikisha kwamba ufikiaji wa SNMP unafanya kazi kati ya watengenezaji tofauti na mchanganyiko tofauti wa mteja-seva, **Management Information Base (MIB)** ilianzishwa. MIB ni **muundo huru wa kuhifadhi habari za kifaa**. MIB ni **faili ya maandishi** ambapo vitu vyote vinavyoweza kuulizwa vya **SNMP** vya kifaa vimeorodheshwa katika **hiraki ya mti iliyostandadishwa**. Ina **angalau `Object Identifier` (`OID`)** moja, ambayo, pamoja na **anwani ya kipekee** na **jina**, pia hutoa habari kuhusu aina, haki za ufikiaji, na maelezo ya kila kipengee husika.\
Faili za MIB huandikwa katika muundo wa maandishi wa ASCII uliojengwa kwenye `Abstract Syntax Notation One` (`ASN.1`). **MIB hazina data**, lakini zinaeleza **wapi kupata habari gani** na inaonekanaje, ambayo hurejea thamani kwa OID maalum, au aina gani ya data inayotumiwa.

### OIDs

**Identifiers za Vitu (OIDs)** zina jukumu muhimu. Identifiers hizi za kipekee zimedhamiriwa kusimamia vitu ndani ya **Management Information Base (MIB)**.

Viwango vya juu vya IDs za vitu vya MIB, au OIDs, vinatengwa kwa mashirika tofauti yanayoweka viwango. Ni katika viwango hivi vya juu ambapo mfumo wa mazoea ya usimamizi wa ulimwengu na viwango unawekwa.

Zaidi ya hayo, wauzaji wanaruhusiwa kuanzisha matawi binafsi. Ndani ya matawi haya, wana **uhuru wa kujumuisha vitu vinavyosimamiwa vinavyohusiana na mistari yao ya bidhaa wenyewe**. Mfumo huu unahakikisha kuwa kuna njia iliyopangwa na iliyoandaliwa ya kutambua na kusimamia anuwai ya vitu kati ya wauzaji tofauti na viwango.

![](<../../.gitbook/assets/SNMP\_OID\_MIB\_Tree (1).png>)

Unaweza **kuvinjari** kupitia **mti wa OID** kutoka kwenye wavuti hapa: [http://www.oid-info.com/cgi-bin/display?tree=#focus](http://www.oid-info.com/cgi-bin/display?tree=#focus) au **kuona maana ya OID** (kama vile `1.3.6.1.2.1.1`) kwa kufikia [http://oid-info.com/get/1.3.6.1.2.1.1](http://oid-info.com/get/1.3.6.1.2.1.1).\
Kuna **OIDs maarufu** kama zile ndani ya [1.3.6.1.2.1](http://oid-info.com/get/1.3.6.1.2.1) ambazo zinahusiana na MIB-2 iliyoelezewa Simple Network Management Protocol (SNMP) variables. Na kutoka kwa **OIDs zinazotarajiwa kutoka hii** unaweza kupata data muhimu ya mwenyeji (data ya mfumo, data ya mtandao, data ya michakato...)

### **Mfano wa OID**

[**Mfano kutoka hapa**](https://www.netadmintools.com/snmp-mib-and-oids/):

**`1 . 3 . 6 . 1 . 4 . 1 . 1452 . 1 . 2 . 5 . 1 . 3. 21 . 1 . 4 . 7`**

Hapa kuna maelezo ya anwani hii.

* 1 - hii inaitwa ISO na inathibitisha kuwa hii ni OID. Ndio sababu OIDs zote huanza na "1"
* 3 - hii inaitwa ORG na hutumiwa kutaja shirika lililojenga kifaa.
* 6 - hii ni dod au Idara ya Ulinzi ambayo ni shirika lililoanzisha Mtandao kwanza.
* 1 - hii ni thamani ya mtandao kumaanisha kuwa mawasiliano yote yatafanyika kupitia Mtandao.
* 4 - thamani hii inaamua kuwa kifaa hiki kimeundwa na shirika la kibinafsi na sio la serikali.
* 1 - thamani hii inaashiria kuwa kifaa kimeundwa na shirika la biashara au kampuni.

Thamani hizi sita za kwanza huwa sawa kwa vifaa vyote na hukupa habari msingi kuhusu vifaa hivyo. Mfululizo huu wa nambari utakuwa sawa kwa OIDs zote, isipokuwa wakati kifaa kimeundwa na serikali.

Kuelekea kwa seti inayofuata ya nambari.

* 1452 - inatoa jina la shirika lililotengeneza kifaa hiki.
* 1 - inaeleza aina ya kifaa. Katika kesi hii, ni saa ya kuamsha.
* 2 - inadhibitisha kuwa kifaa hiki ni kitengo cha terminali cha mbali.

Thamani zilizobaki hutoa habari maalum kuhusu kifaa.

* 5 - inaashiria alama ya tahadhari ya kipekee.
* 1 - alama maalum kwenye kifaa
* 3 - bandari
* 21 - anwani ya bandari
* 1 - kuonyesha kwa bandari
* 4 - nambari ya alama
* 7 - hali ya alama

### Matoleo ya SNMP

Kuna matoleo 2 muhimu ya SNMP:

* **SNMPv1**: Kuu, bado ni ya kawaida zaidi, **uthibitisho unategemea herufi** (herufi ya jamii) ambayo inasafiri kwa **maandishi wazi** (habari yote inasafiri kwa maandishi wazi). **Toleo 2 na 2c** hutuma **trafiki kwa maandishi wazi** pia na hutumia **herufi ya jamii kama uthibitisho**.
* **SNMPv3**: Hutumia **mfumo bora wa uthibitisho** na habari inasafiri **imefichwa** (shambulio la kamusi linaweza kufanywa lakini itakuwa ngumu zaidi kupata uthibitisho sahihi kuliko katika SNMPv1 na v2).

### Herufi za Jamii

Kama ilivyotajwa hapo awali, **ili kupata habari iliyohifadhiwa kwenye MIB unahitaji kujua herufi ya jamii kwenye matoleo 1 na 2/2c na sifa kwenye toleo 3.**\
Kuna **aina 2 za herufi za jamii**:

* **`public`** hasa **kazi za kusoma tu**
* **`private`** **Kusoma/Andika** kwa ujumla

Tambua kwamba **uandishi wa OID unategemea herufi ya jamii iliyotumiwa**, hivyo **hata** ikiwa unagundua kwamba "**public**" inatumika, unaweza kuwa na uwezo wa **kuandika baadhi ya thamani.** Pia, **inaweza** kuwepo vitu ambavyo ni **"Kusoma tu daima".**\
Ikiwa unajaribu **kuandika** kipengee, utapokea **kosa la `noSuchName` au `readOnly`**\*\*.\*\*

Katika matoleo 1 na 2/2c ikiwa unatumia **herufi mbaya ya jamii** seva haitajibu. Kwa hivyo, ikiwa inajibu, **herufi sahihi ya jamii ilitumiwa**.

## Bandari

[Kutoka Wikipedia](https://en.wikipedia.org/wiki/Simple\_Network\_Management\_Protocol):

* Mnajimu wa SNMP hupokea maombi kwenye bandari ya UDP **161**.
* Meneja hupokea arifa ([Traps](https://en.wikipedia.org/wiki/Simple\_Network\_Management\_Protocol#Trap) na [InformRequests](https://en.wikipedia.org/wiki/Simple\_Network\_Management\_Protocol#InformRequest)) kwenye bandari **162**.
* Inapotumiwa na [Usalama wa Tabaka la Usafirishaji](https://en.wikipedia.org/wiki/Transport\_Layer\_Security) au [Usalama wa Tabaka la Usafirishaji wa Datagram](https://en.wikipedia.org/wiki/Datagram\_Transport\_Layer\_Security), maombi hupokelewa kwenye bandari **10161** na arifa hutumwa kwenye bandari **10162**.

## Kuvunja Nguvu ya Herufi ya Jamii (v1 na v2c)

Kutoka **kufikiria herufi ya jamii** unaweza kufanya shambulio la kamusi. Angalia [hapa njia tofauti za kufanya shambulio la nguvu dhidi ya SNMP](../../generic-methodologies-and-resources/brute-force.md#snmp). Herufi ya jamii inayotumiwa mara kwa mara ni `public`.

## Kuhesabu SNMP

Inapendekezwa kufunga yafuatayo kuona maana ya **kila OID iliyokusanywa** kutoka kwa kifaa:
```bash
apt-get install snmp-mibs-downloader
download-mibs
# Finally comment the line saying "mibs :" in /etc/snmp/snmp.conf
sudo vi /etc/snmp/snmp.conf
```
Ikiwa unajua kamba ya jamii halali, unaweza kupata data kwa kutumia **SNMPWalk** au **SNMP-Check**:
```bash
snmpbulkwalk -c [COMM_STRING] -v [VERSION] [IP] . #Don't forget the final dot
snmpbulkwalk -c public -v2c 10.10.11.136 .

snmpwalk -v [VERSION_SNMP] -c [COMM_STRING] [DIR_IP]
snmpwalk -v [VERSION_SNMP] -c [COMM_STRING] [DIR_IP] 1.3.6.1.2.1.4.34.1.3 #Get IPv6, needed dec2hex
snmpwalk -v [VERSION_SNMP] -c [COMM_STRING] [DIR_IP] NET-SNMP-EXTEND-MIB::nsExtendObjects #get extended
snmpwalk -v [VERSION_SNMP] -c [COMM_STRING] [DIR_IP] .1 #Enum all

snmp-check [DIR_IP] -p [PORT] -c [COMM_STRING]

nmap --script "snmp* and not snmp-brute" <target>

braa <community string>@<IP>:.1.3.6.* #Bruteforce specific OID
```
Kutokana na mizunguko iliyozidishwa (download-mibs), inawezekana kuchunguza zaidi kuhusu mfumo kwa kutumia amri ifuatayo:
```bash
snmpwalk -v X -c public <IP> NET-SNMP-EXTEND-MIB::nsExtendOutputFull
```
**SNMP** ina habari nyingi kuhusu mwenyeji na vitu ambavyo unaweza kupata kuvutia ni: **Vifaa vya Mtandao** (anwani za IPv4 na **IPv6**), Majina ya Watumiaji, Uptime, Seva/Toleo la OS, na **mchakato**

**unaendesha** (inaweza kuwa na nywila)....

### **Vipimo Hatari**

Katika uwanja wa usimamizi wa mtandao, mipangilio na vigezo fulani ni muhimu kuhakikisha ufuatiliaji na udhibiti kamili.

### Vipimo vya Kufikia

Mipangilio miwili kuu inawezesha ufikiaji wa **mti kamili wa OID**, ambao ni sehemu muhimu katika usimamizi wa mtandao:

1. **`rwuser noauth`** imewekwa kuruhusu ufikiaji kamili wa mti wa OID bila haja ya uwakiki. Mipangilio hii ni rahisi na inaruhusu ufikiaji usiozuiliwa.
2. Kwa udhibiti maalum zaidi, ufikiaji unaweza kuruhusiwa kwa kutumia:
* **`rwcommunity`** kwa anwani za **IPv4**, na
* **`rwcommunity6`** kwa anwani za **IPv6**.

Amri zote mbili zinahitaji **herufi za jamii** na anwani sahihi ya IP, zikitoa ufikiaji kamili bila kujali asili ya ombi.

### Vigezo vya SNMP kwa Microsoft Windows

Mfululizo wa **Theluji ya Taarifa ya Usimamizi (MIB) thamani** hutumiwa kufuatilia sehemu mbalimbali za mfumo wa Windows kupitia SNMP:

* **Mchakato wa Mfumo**: Kupitia `1.3.6.1.2.1.25.1.6.0`, kipimo hiki kuruhusu ufuatiliaji wa michakato inayoendelea ndani ya mfumo.
* **Programu Zinazoendeshwa**: Thamani ya `1.3.6.1.2.1.25.4.2.1.2` imetengwa kufuatilia programu zinazoendeshwa kwa sasa.
* **Njia za Michakato**: Ili kubaini mahali ambapo mchakato unatekelezwa kutoka, thamani ya MIB ya `1.3.6.1.2.1.25.4.2.1.4` hutumiwa.
* **Vifaa vya Uhifadhi**: Ufuatiliaji wa vifaa vya uhifadhi unarahisishwa na `1.3.6.1.2.1.25.2.3.1.4`.
* **Jina la Programu**: Ili kutambua programu iliyosakinishwa kwenye mfumo, `1.3.6.1.2.1.25.6.3.1.2` hutumiwa.
* **Akaunti za Mtumiaji**: Thamani ya `1.3.6.1.4.1.77.1.2.25` inaruhusu ufuatiliaji wa akaunti za mtumiaji.
* **Bandari za TCP za Mitaa**: Hatimaye, `1.3.6.1.2.1.6.13.1.3` imetengwa kwa ajili ya kufuatilia bandari za TCP za mitaa, ikitoa ufahamu kuhusu uhusiano wa mtandao unaofanya kazi.

### Cisco

Tazama ukurasa huu ikiwa una vifaa vya Cisco:

{% content-ref url="cisco-snmp.md" %}
[cisco-snmp.md](cisco-snmp.md)
{% endcontent-ref %}

## Kutoka SNMP hadi RCE

Ikiwa una **herufi** inayokuwezesha **kuandika thamani** ndani ya huduma ya SNMP, unaweza kutumia vibaya kutekeleza amri:

{% content-ref url="snmp-rce.md" %}
[snmp-rce.md](snmp-rce.md)
{% endcontent-ref %}

## **SNMP Kubwa**

[Braa ](https://github.com/mteg/braa)ni skana kubwa ya SNMP. Matumizi yanayokusudiwa ya zana kama hiyo ni, bila shaka, kufanya uchunguzi wa SNMP - lakini tofauti na snmpwalk kutoka net-snmp, inaweza kuuliza makumi au mamia ya mwenyeji kwa wakati mmoja, na katika mchakato mmoja. Hivyo, inatumia rasilimali za mfumo kidogo sana na kufanya uchunguzi KWA haraka SANA.

Braa inatekeleza stack yake YA snmp, hivyo HAIHITAJI maktaba yoyote ya SNMP kama net-snmp.

**Syntax:** braa \[Herufi-ya-Jamii]@\[IP ya seva ya SNMP]:\[iso id]
```bash
braa ignite123@192.168.1.125:.1.3.6.*
```
Hii inaweza kutoa taarifa nyingi za MB ambazo huwezi kusindika kwa mkono.

Kwa hivyo, tafadhali angalia taarifa muhimu zaidi (kutoka [https://blog.rapid7.com/2016/05/05/snmp-data-harvesting-during-penetration-testing/](https://blog.rapid7.com/2016/05/05/snmp-data-harvesting-during-penetration-testing/)):

### **Vifaa**

Mchakato huanza na uchimbaji wa data ya **sysDesc MIB** (1.3.6.1.2.1.1.1.0) kutoka kwa kila faili ili kutambua vifaa. Hii hufanywa kupitia matumizi ya amri ya **grep**:
```bash
grep ".1.3.6.1.2.1.1.1.0" *.snmp
```
### **Tambua String ya Binafsi**

Hatua muhimu inahusisha kutambua **string ya jamii binafsi** inayotumiwa na mashirika, hasa kwenye rutba za Cisco IOS. String hii inawezesha upatikanaji wa **mipangilio inayotumika** kutoka kwenye rutba. Kutambua mara nyingi kunategemea uchambuzi wa data ya **SNMP Trap** kwa neno "trap" kwa kutumia amri ya **grep**:
```bash
grep -i "trap" *.snmp
```
### **Jina la mtumiaji/Nywila**

Kumbukumbu zilizohifadhiwa ndani ya meza za MIB huchunguzwa kwa **jaribio lililoshindwa la kuingia**, ambalo linaweza kujumuisha kimakosa nywila zilizoingizwa kama majina ya mtumiaji. Maneno muhimu kama _fail_, _failed_, au _login_ hutafutwa ili kupata data muhimu:
```bash
grep -i "login\|fail" *.snmp
```
### **Barua pepe**

Hatimaye, ili kutoa **anwani za barua pepe** kutoka kwenye data, amri ya **grep** na mshono wa kawaida hutumiwa, ikilenga mifano inayolingana na muundo wa barua pepe:
```bash
grep -E -o "\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,6}\b" *.snmp
```
## Kubadilisha thamani za SNMP

Unaweza kutumia _**NetScanTools**_ kubadilisha **thamani**. Utahitaji kujua **neno la siri** ili kufanya hivyo.

## Kudanganya

Ikiwa kuna ACL inayoruhusu anwani fulani za IP kuuliza huduma ya SMNP, unaweza kudanganya moja ya anwani hizi ndani ya pakiti ya UDP na kunusa trafiki.

## Angalia faili za Usanidi wa SNMP

* snmp.conf
* snmpd.conf
* snmp-config.xml

<figure><img src="../../.gitbook/assets/image (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

Ikiwa una nia ya **kazi ya udukuzi** na kudukua yasiyodukuzika - **tunakupa kazi!** (_ujuzi wa Kipolishi ulioandikwa na kuzungumzwa unahitajika_).

{% embed url="https://www.stmcyber.com/careers" %}

## Amri za Kiotomatiki za HackTricks
```
Protocol_Name: SNMP    #Protocol Abbreviation if there is one.
Port_Number:  161     #Comma separated if there is more than one.
Protocol_Description: Simple Network Managment Protocol         #Protocol Abbreviation Spelled out

Entry_1:
Name: Notes
Description: Notes for SNMP
Note: |
SNMP - Simple Network Management Protocol is a protocol used to monitor different devices in the network (like routers, switches, printers, IoTs...).

https://book.hacktricks.xyz/pentesting/pentesting-snmp

Entry_2:
Name: SNMP Check
Description: Enumerate SNMP
Command: snmp-check {IP}

Entry_3:
Name: OneSixtyOne
Description: Crack SNMP passwords
Command: onesixtyone -c /usr/share/seclists/Discovery/SNMP/common-snmp-community-strings-onesixtyone.txt {IP} -w 100

Entry_4:
Name: Nmap
Description: Nmap snmp (no brute)
Command: nmap --script "snmp* and not snmp-brute" {IP}

Entry_5:
Name: Hydra Brute Force
Description: Need Nothing
Command: hydra -P {Big_Passwordlist} -v {IP} snmp


```
<details>

<summary><strong>Jifunze AWS hacking kutoka sifuri hadi shujaa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Mtaalam wa Timu Nyekundu ya AWS ya HackTricks)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako ikitangazwa kwenye HackTricks** au **kupakua HackTricks kwa PDF** Angalia [**MIPANGO YA KUJIUNGA**](https://github.com/sponsors/carlospolop)!
* Pata [**bidhaa rasmi za PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**Familia ya PEASS**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa [**NFTs**](https://opensea.io/collection/the-peass-family) ya kipekee
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au kikundi cha [**telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Shiriki mbinu zako za kuhack kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos za github.

</details>
