# 161,162,10161,10162/udp - Pentesting SNMP

<details>

<summary><strong>Jifunze kuhusu kuhack AWS kutoka mwanzo hadi kuwa bingwa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako ikionekana kwenye HackTricks** au **kupakua HackTricks kwa muundo wa PDF** Angalia [**MPANGO WA KUJIUNGA**](https://github.com/sponsors/carlospolop)!
* Pata [**swag rasmi wa PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**The PEASS Family**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa [**NFTs**](https://opensea.io/collection/the-peass-family) za kipekee
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au [**kikundi cha telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Shiriki mbinu zako za kuhack kwa kuwasilisha PRs kwenye** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

<img src="../../.gitbook/assets/i3.png" alt="" data-size="original">\
**Mshauri wa tuzo za mdudu**: **Jisajili** kwa **Intigriti**, jukwaa la tuzo za mdudu la malipo la juu lililoanzishwa na wadukuzi, kwa wadukuzi! Jiunge nasi kwenye [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) leo, na anza kupata tuzo hadi **$100,000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

## Taarifa Msingi

**SNMP - Simple Network Management Protocol** ni itifaki inayotumika kufuatilia vifaa tofauti kwenye mtandao (kama vile router, switch, printer, IoTs...).
```
PORT    STATE SERVICE REASON                 VERSION
161/udp open  snmp    udp-response ttl 244   ciscoSystems SNMPv3 server (public)
```
{% hint style="info" %}
SNMP pia hutumia bandari **162/UDP** kwa **traps**. Hizi ni **pakiti za data zinazotumwa kutoka kwa seva ya SNMP kwenda kwa mteja bila kuombwa kwa uwazi**.
{% endhint %}

### MIB

Ili kuhakikisha kuwa ufikiaji wa SNMP unafanya kazi kwa wazalishaji tofauti na mchanganyiko tofauti wa mteja-seva, **Management Information Base (MIB)** ilianzishwa. MIB ni **muundo huru wa kuhifadhi habari za kifaa**. MIB ni faili ya **maandishi** ambapo vitu vyote vinavyoweza kuulizwa vya SNMP vya kifaa vimeorodheshwa katika muundo wa mti **uliofanyiwa kiwango**. Ina angalau **kitambulisho cha kitu (`OID`) kimoja**, ambacho, pamoja na anwani ya kipekee inayohitajika na jina, pia hutoa habari juu ya aina, haki za ufikiaji, na maelezo ya kitu husika.\
Faili za MIB zimeandikwa katika muundo wa maandishi ya ASCII uliopangwa kwa kutumia `Abstract Syntax Notation One` (`ASN.1`). **MIB hazina data**, lakini zinaelezea **wapi kupata habari gani** na inaonekanaje, ambayo inarudisha thamani za kipekee kwa OID maalum, au aina gani ya data inayotumiwa.

### OIDs

**Kitambulisho cha Kitu (OIDs)** kina jukumu muhimu. Vitambulisho hivi vya kipekee vimeundwa kusimamia vitu ndani ya **Management Information Base (MIB)**.

Viwango vya juu zaidi vya vitambulisho vya vitu vya MIB, au OIDs, vimepewa mashirika tofauti ya kuweka viwango. Ni ndani ya viwango hivi vya juu ambapo mfumo wa mazoea na viwango vya usimamizi wa ulimwengu unawekwa.

Zaidi ya hayo, wazalishaji wanapewa uhuru wa kuanzisha matawi binafsi. Ndani ya matawi haya, wana **uhuru wa kujumuisha vitu vilivyosimamiwa vinavyohusiana na safu zao za bidhaa**. Mfumo huu unahakikisha kuwa kuna njia iliyopangwa na iliyoandaliwa ya kutambua na kusimamia anuwai ya vitu kati ya wazalishaji na viwango tofauti.

![](../../.gitbook/assets/snmp\_oid\_mib\_tree.png)

Unaweza **kuvinjari** kupitia **mti wa OID** kutoka wavuti hapa: [http://www.oid-info.com/cgi-bin/display?tree=#focus](http://www.oid-info.com/cgi-bin/display?tree=#focus) au **angalia maana ya OID** (kama `1.3.6.1.2.1.1`) kwa kufikia [http://oid-info.com/get/1.3.6.1.2.1.1](http://oid-info.com/get/1.3.6.1.2.1.1).\
Kuna **OIDs maarufu** kama zile ndani ya [1.3.6.1.2.1](http://oid-info.com/get/1.3.6.1.2.1) ambayo inahusisha MIB-2 iliyofafanuliwa kwa Simple Network Management Protocol (SNMP) variables. Na kutoka kwa **OIDs zinazosubiri kutoka kwa hii** unaweza kupata data muhimu ya mwenyeji (data ya mfumo, data ya mtandao, data ya michakato...)

### **Mfano wa OID**

[**Mfano kutoka hapa**](https://www.netadmintools.com/snmp-mib-and-oids/):

**`1 . 3 . 6 . 1 . 4 . 1 . 1452 . 1 . 2 . 5 . 1 . 3. 21 . 1 . 4 . 7`**

Hapa kuna maelezo ya anwani hii.

* 1 - hii inaitwa ISO na inathibitisha kuwa hii ni OID. Ndio sababu vitambulisho vyote vya OID vinaanza na "1"
* 3 - hii inaitwa ORG na hutumiwa kuonyesha shirika lililojenga kifaa.
* 6 - hii ni dod au Idara ya Ulinzi ambayo ni shirika lililoanzisha Mtandao kwanza.
* 1 - hii ni thamani ya mtandao kuonyesha kuwa mawasiliano yote yatafanyika kupitia Mtandao.
* 4 - thamani hii inaamua kuwa kifaa hiki kimeundwa na shirika binafsi na sio serikali.
* 1 - thamani hii inaonyesha kuwa kifaa kimeundwa na kampuni au kifaa cha biashara.

Thamani hizi sita za kwanza huwa sawa kwa vifaa vyote na hukupa habari ya msingi juu yao. Mfululizo huu wa nambari utakuwa sawa kwa vitambulisho vyote, isipokuwa wakati kifaa kimeundwa na serikali.

Tukielekea kwa seti inayofuata ya nambari.

* 1452 - inatoa jina la shirika lililounda kifaa hiki.
* 1 - inaelezea aina ya kifaa. Katika kesi hii, ni saa ya kuamsha.
* 2 - inadhibitisha kuwa kifaa hiki ni kitengo cha terminal cha mbali.

Sehemu iliyobaki ya thamani hutoa habari maalum juu ya kifaa.

* 5 - inaonyesha hatua ya tahadhari ya kipekee.
* 1 - hatua maalum katika kifaa
* 3 - bandari
* 21 - anwani ya bandari
* 1 - kuonyesha kwa bandari
* 4 - nambari ya hatua
* 7 - hali ya hatua

### Toleo za SNMP

Kuna toleo 2 muhimu za SNMP:

* **SNMPv1**: Kuu, bado ni ya kawaida zaidi, **uthibitisho unategemea herufi** (herufi ya jamii) ambayo inasafiri kwa **maandishi wazi** (habari yote inasafiri kwa maandishi wazi). **Toleo 2 na 2c** hupitisha **trafiki kwa maandishi wazi** pia na hutumia **herufi ya jamii kama uthibitisho**.
* **SNMPv3**: Hutumia **mfumo bora wa uthibitisho** na habari inasafiri **imefichwa** (shambulio la kamusi linaweza kufanywa lakini itakuwa ngumu zaidi kupata uthibitisho sahihi kuliko katika SNMPv1 na v2).

### Herufi za Jamii

Kama ilivyotajwa hapo awali, **ili kupata habari iliyohifadhiwa kwenye MIB unahitaji kujua herufi ya jamii kwenye toleo 1 na 2/2c na uthibitisho kwenye toleo 3.**\
Kuna **aina 2 za herufi za jamii**:

* **`public`** kwa kawaida kazi za **soma tu**
* **`private`** **Soma/Andika** kwa ujumla

Tafadhali kumbuka kuwa **uandishi wa OID unategemea herufi ya jamii iliyotumiwa**, kwa hivyo **hata** ikiwa unagundua kuwa "**public**" inatumika, unaweza kuwa na uwezo wa **kuandika baadhi ya thamani**. Pia, **inaweza** kuwepo vitu ambavyo ni **"Soma tu" daima**.\
Ikiwa unajaribu **kuandika** kitu, utapokea **kosa la "noSuchName" au "readOnly"**.

Katika toleo 1 na 2/2c ikiwa unatumia herufi ya jamii **mbaya**, seva haitajibu. Kwa hivyo, ikiwa inajibu, **herufi ya jamii halali ilitumiwa**.

## Bandari

[Kutoka Wikipedia](https://en.wikipedia.org/wiki/Simple_Network_Management_Protocol#:~:text=All%20SNMP%20messages%20are%20transported,port%20161%20in%20the%20agent.):

* Wakala wa SNMP hupokea maombi kwenye bandari ya UDP **161**.
* Meneja hupokea arifa ([Traps](https://en.wikipedia.org/wiki/Simple\_Network\_Management\_Protocol#Trap) na [InformRequests](https://en.wikipedia.org/wiki/Simple\_Network\_Management\_Protocol#InformRequest)) kwenye bandari **162**.
* Inapotumiwa na [Usalama wa Tabaka la Usafirishaji](https://en.wikipedia.org/wiki/Transport\_Layer\_Security)
## Kuchunguza SNMP

Inapendekezwa kusakinisha yafuatayo ili kuona maana ya kila **OID iliyokusanywa** kutoka kifaa:
```bash
apt-get install snmp-mibs-downloader
download-mibs
# Finally comment the line saying "mibs :" in /etc/snmp/snmp.conf
sudo vi /etc/snmp/snmp.conf
```
Ikiwa unajua kamba ya jamii halali, unaweza kupata data kwa kutumia **SNMPWalk** au **SNMP-Check**:
```bash
snmpbulkwalk -c [COMM_STRING] -v [VERSION] [IP] . #Don't forget the final dot
snmpbulkwalk -c public -v2c 10.10.11.136 .

snmpwalk -v [VERSION_SNMP] -c [COMM_STRING] [DIR_IP]
snmpwalk -v [VERSION_SNMP] -c [COMM_STRING] [DIR_IP] 1.3.6.1.2.1.4.34.1.3 #Get IPv6, needed dec2hex
snmpwalk -v [VERSION_SNMP] -c [COMM_STRING] [DIR_IP] NET-SNMP-EXTEND-MIB::nsExtendObjects #get extended
snmpwalk -v [VERSION_SNMP] -c [COMM_STRING] [DIR_IP] .1 #Enum all

snmp-check [DIR_IP] -p [PORT] -c [COMM_STRING]

nmap --script "snmp* and not snmp-brute" <target>

braa <community string>@<IP>:.1.3.6.* #Bruteforce specific OID
```
Asante kwa maswali marefu (download-mibs), inawezekana kutambua hata zaidi kuhusu mfumo kwa kutumia amri ifuatayo:
```bash
snmpwalk -v X -c public <IP> NET-SNMP-EXTEND-MIB::nsExtendOutputFull
```
**SNMP** ina habari nyingi kuhusu mwenyeji na vitu ambavyo unaweza kuona kuwa vya kuvutia ni: **Vifaa vya mtandao** (anwani za IPv4 na **IPv6**), Majina ya watumiaji, Uptime, Toleo la Seva/MFumo wa Uendeshaji, na **mchakato**

**unaofanya kazi** (inaweza kuwa na nywila)....

### **Mipangilio Hatari**

Katika uwanja wa usimamizi wa mtandao, mipangilio na vigezo fulani ni muhimu kuhakikisha ufuatiliaji na udhibiti kamili.

### Mipangilio ya Upatikanaji

Mipangilio miwili kuu inawezesha upatikanaji wa **mti kamili wa OID**, ambao ni sehemu muhimu katika usimamizi wa mtandao:

1. **`rwuser noauth`** imewekwa kuruhusu upatikanaji kamili wa mti wa OID bila haja ya uwakiki. Mipangilio hii ni rahisi na inaruhusu upatikanaji usiozuiliwa.

2. Kwa udhibiti maalum zaidi, upatikanaji unaweza kuruhusiwa kwa kutumia:
- **`rwcommunity`** kwa anwani za **IPv4**, na
- **`rwcommunity6`** kwa anwani za **IPv6**.

Amri zote mbili zinahitaji **herufi za jamii** na anwani sahihi ya IP, zikitoa upatikanaji kamili bila kujali asili ya ombi.

### Vigezo vya SNMP kwa Microsoft Windows

Mfululizo wa **Thamani za Msingi za Habari za Usimamizi (MIB)** hutumiwa kufuatilia sehemu mbalimbali za mfumo wa Windows kupitia SNMP:

- **Mchakato wa Mfumo**: Kupitia `1.3.6.1.2.1.25.1.6.0`, kigezo hiki kuruhusu ufuatiliaji wa michakato inayofanya kazi katika mfumo.
- **Programu Zinazoendesha**: Thamani ya `1.3.6.1.2.1.25.4.2.1.2` imetengwa kwa ajili ya kufuatilia programu zinazoendesha kwa sasa.
- **Njia za Mchakato**: Ili kujua mahali ambapo mchakato unafanya kazi, thamani ya MIB `1.3.6.1.2.1.25.4.2.1.4` hutumiwa.
- **Vifaa vya Uhifadhi**: Ufuatiliaji wa vifaa vya uhifadhi unawezeshwa na `1.3.6.1.2.1.25.2.3.1.4`.
- **Jina la Programu**: Kwa kutambua programu iliyosakinishwa kwenye mfumo, `1.3.6.1.2.1.25.6.3.1.2` hutumiwa.
- **Akaunti za Mtumiaji**: Thamani ya `1.3.6.1.4.1.77.1.2.25` inaruhusu ufuatiliaji wa akaunti za mtumiaji.
- **Bandari za TCP za Mitaa**: Hatimaye, `1.3.6.1.2.1.6.13.1.3` imetengwa kwa ajili ya ufuatiliaji wa bandari za TCP za mitaa, ikitoa ufahamu kuhusu uunganisho wa mtandao unaofanya kazi.

### Cisco

Angalia ukurasa huu ikiwa una vifaa vya Cisco:

{% content-ref url="cisco-snmp.md" %}
[cisco-snmp.md](cisco-snmp.md)
{% endcontent-ref %}

## Kutoka SNMP hadi RCE

Ikiwa una **herufi** inayokuwezesha **kuandika thamani** ndani ya huduma ya SNMP, huenda ukaibuka kutumia hiyo kutekeleza amri:

{% content-ref url="snmp-rce.md" %}
[snmp-rce.md](snmp-rce.md)
{% endcontent-ref %}

## **SNMP Kubwa**

[Braa ](https://github.com/mteg/braa)ni skana kubwa ya SNMP. Matumizi yanayokusudiwa ya zana kama hiyo ni, bila shaka, kufanya uchunguzi wa SNMP - lakini tofauti na snmpwalk kutoka net-snmp, inaweza kuuliza mamia au maelfu ya wenyewe kwa wakati mmoja, na kwa mchakato mmoja. Hivyo, inatumia rasilimali ndogo sana za mfumo na kufanya uchunguzi KWA HARAKA SANA.

Braa inatekeleza stack yake YA SNM, hivyo HAIHITAJI maktaba yoyote ya SNMP kama vile net-snmp.

**Syntax:** braa \[Herufi ya Jamii]@\[IP ya seva ya SNMP]:\[iso id]
```bash
braa ignite123@192.168.1.125:.1.3.6.*
```
Hii inaweza kutoa kiasi kikubwa cha habari ambazo huwezi kuziprocess kwa mkono.

Basi, tutaangalia habari muhimu zaidi (kutoka [https://blog.rapid7.com/2016/05/05/snmp-data-harvesting-during-penetration-testing/](https://blog.rapid7.com/2016/05/05/snmp-data-harvesting-during-penetration-testing/)):

### **Vifaa**

Mchakato unaanza na uchimbaji wa data ya **sysDesc MIB** (1.3.6.1.2.1.1.1.0) kutoka kwa kila faili ili kutambua vifaa. Hii inafanywa kupitia matumizi ya amri ya **grep**:
```bash
grep ".1.3.6.1.2.1.1.1.0" *.snmp
```
### **Tambua String ya Binafsi**

Hatua muhimu inahusisha kutambua **string ya jamii binafsi** inayotumiwa na mashirika, haswa kwenye rutuba za Cisco IOS. Kamba hii inawezesha uchimbaji wa **mipangilio inayotumika** kutoka kwenye rutuba. Utambuzi mara nyingi unategemea uchambuzi wa data ya Mtego wa SNMP kwa neno "mtego" na **amri ya grep**:
```bash
grep -i "trap" *.snmp
```
### **Watumiaji/Nywila**

Vichapo vilivyohifadhiwa ndani ya meza za MIB vinachunguzwa kwa ajili ya **jaribio la kuingia lililoshindwa**, ambalo linaweza kujumuisha nywila zilizoingizwa kama majina ya watumiaji. Maneno kama _fail_, _failed_, au _login_ hutafutwa ili kupata data muhimu:
```bash
grep -i "login\|fail" *.snmp
```
### **Barua pepe**

Hatimaye, ili kuchambua **anwani za barua pepe** kutoka kwenye data, tumia amri ya **grep** na mzunguko wa kawaida unazingatia mifano inayolingana na muundo wa barua pepe:
```bash
grep -E -o "\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,6}\b" *.snmp
```
## Kubadilisha thamani za SNMP

Unaweza kutumia _**NetScanTools**_ kubadilisha thamani. Utahitaji kujua **private string** ili kufanya hivyo.

## Kudanganya

Ikiwa kuna ACL ambayo inaruhusu tu baadhi ya IP kuuliza huduma ya SMNP, unaweza kudanganya moja ya anwani hizi ndani ya pakiti ya UDP na kusikiliza trafiki.

## Angalia faili za Configuration za SNMP

* snmp.conf
* snmpd.conf
* snmp-config.xml

## Amri za Kiotomatiki za HackTricks
```
Protocol_Name: SNMP    #Protocol Abbreviation if there is one.
Port_Number:  161     #Comma separated if there is more than one.
Protocol_Description: Simple Network Managment Protocol         #Protocol Abbreviation Spelled out

Entry_1:
Name: Notes
Description: Notes for SNMP
Note: |
SNMP - Simple Network Management Protocol is a protocol used to monitor different devices in the network (like routers, switches, printers, IoTs...).

https://book.hacktricks.xyz/pentesting/pentesting-snmp

Entry_2:
Name: SNMP Check
Description: Enumerate SNMP
Command: snmp-check {IP}

Entry_3:
Name: OneSixtyOne
Description: Crack SNMP passwords
Command: onesixtyone -c /usr/share/seclists/Discovery/SNMP/common-snmp-community-strings-onesixtyone.txt {IP} -w 100

Entry_4:
Name: Nmap
Description: Nmap snmp (no brute)
Command: nmap --script "snmp* and not snmp-brute" {IP}

Entry_5:
Name: Hydra Brute Force
Description: Need Nothing
Command: hydra -P {Big_Passwordlist} -v {IP} snmp
```
<img src="../../.gitbook/assets/i3.png" alt="" data-size="original">\
**Mwongozo wa tuzo ya mdudu**: **Jisajili** kwa **Intigriti**, jukwaa la tuzo ya mdudu la malipo lililoanzishwa na wadukuzi, kwa wadukuzi! Jiunge nasi kwenye [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) leo, na anza kupata tuzo hadi **$100,000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

<details>

<summary><strong>Jifunze kuhusu kudukua AWS kutoka sifuri hadi shujaa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Mtaalam wa Timu Nyekundu ya AWS ya HackTricks)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako inatangazwa kwenye HackTricks** au **kupakua HackTricks kwa muundo wa PDF** Angalia [**MPANGO WA KUJIUNGA**](https://github.com/sponsors/carlospolop)!
* Pata [**swag rasmi ya PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**The PEASS Family**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa [**NFTs**](https://opensea.io/collection/the-peass-family) ya kipekee
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au [**kikundi cha telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Shiriki mbinu zako za kudukua kwa kuwasilisha PRs kwenye** [**HackTricks**](https://github.com/carlospolop/hacktricks) **na** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **repos za github.**

</details>
