# 161,162,10161,10162/udp - SNMP 펜테스팅

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>를 통해 AWS 해킹을 처음부터 전문가까지 배워보세요<strong>!</strong></summary>

HackTricks를 지원하는 다른 방법:

* **회사를 HackTricks에서 광고하거나 HackTricks를 PDF로 다운로드**하려면 [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)를 확인하세요!
* [**공식 PEASS & HackTricks 스웨그**](https://peass.creator-spring.com)를 얻으세요.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)를 발견하세요. 독점적인 [**NFTs**](https://opensea.io/collection/the-peass-family) 컬렉션입니다.
* 💬 [**Discord 그룹**](https://discord.gg/hRep4RUj7f) 또는 [**텔레그램 그룹**](https://t.me/peass)에 **참여**하거나 **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)**를** **팔로우**하세요.
* **Hacking 트릭을 공유하려면** [**HackTricks**](https://github.com/carlospolop/hacktricks) 및 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github 저장소에 PR을 제출하세요.

</details>

<img src="../../.gitbook/assets/i3.png" alt="" data-size="original">\
**버그 바운티 팁**: 해커들이 만든 프리미엄 버그 바운티 플랫폼인 **Intigriti에 가입**하세요! 오늘 [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks)에서 참여하여 최대 **$100,000**의 바운티를 받으세요!

{% embed url="https://go.intigriti.com/hacktricks" %}

## 기본 정보

**SNMP - Simple Network Management Protocol**은 네트워크의 다양한 장치(라우터, 스위치, 프린터, IoT 등)를 모니터링하는 데 사용되는 프로토콜입니다.
```
PORT    STATE SERVICE REASON                 VERSION
161/udp open  snmp    udp-response ttl 244   ciscoSystems SNMPv3 server (public)
```
{% hint style="info" %}
SNMP는 또한 **trap**을 위해 **162/UDP** 포트를 사용합니다. 이는 명시적으로 요청하지 않고 SNMP 서버에서 클라이언트로 보내지는 데이터 **패킷**입니다.
{% endhint %}

### MIB

SNMP 액세스가 제조업체 간 및 다른 클라이언트-서버 조합과 작동하도록 보장하기 위해 **Management Information Base (MIB)**가 생성되었습니다. MIB는 **장치 정보를 저장하기 위한 독립적인 형식**입니다. MIB는 **표준화된** 트리 계층 구조에서 장치의 모든 **질의 가능한 SNMP 개체**가 나열된 **텍스트** 파일입니다. 적어도 하나의 `Object Identifier (OID)`를 포함하며, 필요한 **고유 주소**와 **이름** 외에도 해당 개체의 유형, 액세스 권한 및 설명에 대한 정보를 제공합니다.\
MIB 파일은 `Abstract Syntax Notation One (ASN.1)` 기반 ASCII 텍스트 형식으로 작성됩니다. **MIB에는 데이터가 포함되어 있지 않지만** 어떤 정보를 **어디에서 찾을 수 있는지** 및 어떤 모습인지 설명하며, 특정 OID에 대한 반환 값 또는 사용되는 데이터 유형도 설명합니다.

### OID

**Object Identifiers (OIDs)**는 중요한 역할을 합니다. 이러한 고유 식별자는 **Management Information Base (MIB)** 내의 개체를 관리하기 위해 설계되었습니다.

MIB 개체 ID 또는 OID의 가장 높은 수준은 다양한 표준 설정 기관에 할당됩니다. 이러한 최상위 수준에서는 전역 관리 관행 및 표준의 프레임워크가 설정됩니다.

또한, 공급업체는 개인 브랜치를 설정할 수 있는 권한을 부여받습니다. 이러한 브랜치 내에서는 **제품 라인과 관련된 관리 대상 개체를 포함하는 자율성**을 갖습니다. 이 시스템은 다양한 공급업체 및 표준 간에 다양한 개체를 식별하고 관리하기 위한 구조화된 방법을 보장합니다.

![](../../.gitbook/assets/snmp_oid_mib_tree.png)

웹에서 **OID 트리**를 **탐색**할 수 있습니다: [http://www.oid-info.com/cgi-bin/display?tree=#focus](http://www.oid-info.com/cgi-bin/display?tree=#focus) 또는 [http://oid-info.com/get/1.3.6.1.2.1.1](http://oid-info.com/get/1.3.6.1.2.1.1)에 액세스하여 OID의 의미를 확인할 수 있습니다(예: `1.3.6.1.2.1.1`).\
[1.3.6.1.2.1](http://oid-info.com/get/1.3.6.1.2.1) 내부에 있는 것과 같은 **잘 알려진 OID**가 있습니다. 이는 MIB-2에서 정의된 Simple Network Management Protocol (SNMP) 변수를 참조합니다. 이 OID로부터 얻을 수 있는 일부 흥미로운 호스트 데이터(시스템 데이터, 네트워크 데이터, 프로세스 데이터 등)를 얻을 수 있습니다.

### **OID 예시**

[**여기에서 가져온 예시**](https://www.netadmintools.com/snmp-mib-and-oids/):

**`1 . 3 . 6 . 1 . 4 . 1 . 1452 . 1 . 2 . 5 . 1 . 3. 21 . 1 . 4 . 7`**

이 주소를 분석해 보겠습니다.

* 1 - 이것은 ISO라고 불리며, 이것이 OID임을 나타냅니다. 이것이 모든 OID가 "1"로 시작하는 이유입니다.
* 3 - 이것은 ORG라고 불리며, 장치를 구축한 조직을 지정하는 데 사용됩니다.
* 6 - 이것은 dod 또는 Department of Defense로, 인터넷을 처음으로 설립한 조직입니다.
* 1 - 이것은 모든 통신이 인터넷을 통해 이루어짐을 나타내는 인터넷의 값입니다.
* 4 - 이 값은 이 장치가 정부 기관이 아닌 사설 기관에서 제작되었음을 나타냅니다.
* 1 - 이 값은 장치가 기업 또는 비즈니스 엔티티에서 제작되었음을 나타냅니다.

이 처음 6개의 값은 모든 장치에 대해 동일하며, 기본 정보를 제공합니다. 이 숫자 시퀀스는 정부에서 제작한 장치가 아닌 경우를 제외하고는 모든 OID에 대해 동일합니다.

다음 번호 세트로 넘어갑니다.

* 1452 - 이 장치를 제조한 조직의 이름을 제공합니다.
* 1 - 장치의 유형을 설명합니다. 이 경우 알람 시계입니다.
* 2 - 이 장치가 원격 단말 장치임을 나타냅니다.

나머지 값은 장치에 대한 구체적인 정보를 제공합니다.

* 5 - 이산 알람 포인트를 나타냅니다.
* 1 - 장치 내의 특정 포인트
* 3 - 포트
* 21 - 포트의 주소
* 1 - 포트의 디스플레이
* 4 - 포인트 번호
* 7 - 포인트의 상태

### SNMP 버전

SNMP에는 2가지 중요한 버전이 있습니다:

* **SNMPv1**: 주요 버전으로, 여전히 가장 빈번하게 사용되며, **인증은 문자열** (커뮤니티 문자열)을 기반으로 합니다(모든 정보가 평문으로 전송됨). **버전 2 및 2c**는 **트래픽을 평문으로 전송**하며 인증으로 **커뮤니티 문자열을 사용**합니다.
* **SNMPv3**: 더 나은 **인증** 형식을 사용하며 정보는 **암호화**되어 전송됩니다(SNMPv1 및 v2보다 올바른 자격 증명을 찾는 것이 훨씬 어려울 수 있는 **사전 공격**이 수행될 수 있음).

### 커뮤니티 문자열

앞에서 언급했듯이, MIB에 저장된 정보에 액세스하려면 버전 1 및 2/2c에서는 커뮤니티 문자열을, 버전 3에서는 자격 증명을 알아야 합니다.\
커뮤니티 문자열에는 **2 종류**가 있습니다:

* **`public`**: 주로 **읽기 전용** 기능
* **`private`**: 일반적으로 **읽기/쓰기** 기능

OID의 쓰기 가능성은 사용된 커뮤니티 문자열에 따라 다르므로 "**public**"이 사용되는 것을 발견하더라도 일부 값을 **쓸 수 있을 수 있습니다**. 또한, **항상 "읽기 전용"**인 개체가 존재할 수 있습니다.\
객체를 **쓰려고** 하면 **`noSuchName` 또는 `readOnly` 오류**가 발생합니다.

버전 1 및 2/2c에서 잘못된 커뮤니티 문자열을 사용하면 서버가 **응답하지 않습니다**. 따라서 응답이 있으면 **유효한 커뮤니티 문자열**이 사용된 것입니다.

## 포트

[Wikipedia에서](https://en.wikipedia.org/wiki/Simple_Network_Management_Protocol#:~:text=All%20SNMP%20messages%20are%20transported,port%20161%20in%20the%20agent.):

* SNMP 에이전트는 UDP 포트 **161**에서 요청을 수신합니다.
* 관리자는 포트 **162**에서 알림(Trap 및 InformRequest)을 수신합니다.
* [Transport Layer Security](https://en.wikipedia.org/wiki/Transport_L
## SNMP 열거

각 장치에서 수집된 OID가 무엇을 의미하는지 확인하기 위해 다음을 설치하는 것이 권장됩니다:
```bash
apt-get install snmp-mibs-downloader
download-mibs
# Finally comment the line saying "mibs :" in /etc/snmp/snmp.conf
sudo vi /etc/snmp/snmp.conf
```
유효한 커뮤니티 문자열을 알고 있다면, **SNMPWalk** 또는 **SNMP-Check**를 사용하여 데이터에 액세스할 수 있습니다:
```bash
snmpbulkwalk -c [COMM_STRING] -v [VERSION] [IP] . #Don't forget the final dot
snmpbulkwalk -c public -v2c 10.10.11.136 .

snmpwalk -v [VERSION_SNMP] -c [COMM_STRING] [DIR_IP]
snmpwalk -v [VERSION_SNMP] -c [COMM_STRING] [DIR_IP] 1.3.6.1.2.1.4.34.1.3 #Get IPv6, needed dec2hex
snmpwalk -v [VERSION_SNMP] -c [COMM_STRING] [DIR_IP] NET-SNMP-EXTEND-MIB::nsExtendObjects #get extended
snmpwalk -v [VERSION_SNMP] -c [COMM_STRING] [DIR_IP] .1 #Enum all

snmp-check [DIR_IP] -p [PORT] -c [COMM_STRING]

nmap --script "snmp* and not snmp-brute" <target>

braa <community string>@<IP>:.1.3.6.* #Bruteforce specific OID
```
확장된 쿼리(download-mibs)를 통해 다음 명령을 사용하여 시스템에 대해 더 많은 정보를 열거할 수 있습니다:
```bash
snmpwalk -v X -c public <IP> NET-SNMP-EXTEND-MIB::nsExtendOutputFull
```
**SNMP**에는 호스트에 대한 많은 정보가 있으며, 흥미로운 정보로는 **네트워크 인터페이스** (IPv4 및 **IPv6** 주소), 사용자 이름, 가동 시간, 서버/OS 버전 및 **실행 중인** **프로세스** (비밀번호 포함 가능) 등이 있습니다.

### **위험한 설정**

네트워크 관리 영역에서는 특정 구성 및 매개변수가 포괄적인 모니터링 및 제어를 보장하기 위해 필수적입니다.

### 액세스 설정

네트워크 관리에서 중요한 구성 요소인 **전체 OID 트리**에 액세스할 수 있도록 두 가지 주요 설정이 가능합니다:

1. **`rwuser noauth`**는 인증 없이 OID 트리에 대한 완전한 액세스를 허용하기 위해 설정됩니다. 이 설정은 직관적이며 제한 없는 액세스를 허용합니다.

2. 더 구체적인 제어를 위해 다음을 사용하여 액세스를 허용할 수 있습니다:
- **IPv4** 주소에 대한 **`rwcommunity`** 및
- **IPv6** 주소에 대한 **`rwcommunity6`**.

두 명령 모두 관련된 IP 주소와 **커뮤니티 문자열**을 필요로 하며, 요청의 원본과 관계없이 완전한 액세스를 제공합니다.

### Microsoft Windows용 SNMP 매개변수

SNMP를 통해 Windows 시스템의 다양한 측면을 모니터링하기 위해 일련의 **관리 정보 베이스 (MIB) 값**을 사용합니다:

- **시스템 프로세스**: `1.3.6.1.2.1.25.1.6.0`을 통해 액세스되며, 이 매개변수를 사용하여 시스템 내에서 활성 프로세스를 모니터링할 수 있습니다.
- **실행 중인 프로그램**: `1.3.6.1.2.1.25.4.2.1.2` 값은 현재 실행 중인 프로그램을 추적하기 위해 지정됩니다.
- **프로세스 경로**: 프로세스가 실행 중인 위치를 확인하기 위해 `1.3.6.1.2.1.25.4.2.1.4` MIB 값이 사용됩니다.
- **저장 장치**: `1.3.6.1.2.1.25.2.3.1.4`를 통해 저장 장치의 모니터링이 용이합니다.
- **소프트웨어 이름**: 시스템에 설치된 소프트웨어를 식별하기 위해 `1.3.6.1.2.1.25.6.3.1.2`가 사용됩니다.
- **사용자 계정**: `1.3.6.1.4.1.77.1.2.25` 값은 사용자 계정을 추적하기 위해 사용됩니다.
- **TCP 로컬 포트**: 마지막으로, `1.3.6.1.2.1.6.13.1.3`은 TCP 로컬 포트를 모니터링하기 위해 지정되며, 활성 네트워크 연결에 대한 통찰력을 제공합니다.

### Cisco

Cisco 장비를 사용하는 경우 다음 페이지를 참조하십시오:

{% content-ref url="cisco-snmp.md" %}
[cisco-snmp.md](cisco-snmp.md)
{% endcontent-ref %}

## SNMP에서 RCE로

SNMP 서비스 내에서 **값을 쓸 수 있는 문자열**을 가지고 있다면, 이를 남용하여 **명령을 실행**할 수 있을 수도 있습니다:

{% content-ref url="snmp-rce.md" %}
[snmp-rce.md](snmp-rce.md)
{% endcontent-ref %}

## **대규모 SNMP**

[Braa](https://github.com/mteg/braa)는 대규모 SNMP 스캐너입니다. 이 도구의 의도된 사용은 물론 SNMP 쿼리를 수행하는 것입니다. 그러나 net-snmp의 snmpwalk과 달리, 수십 개 또는 수백 개의 호스트를 동시에 하나의 프로세스에서 쿼리할 수 있으며, 시스템 리소스를 매우 적게 소비하고 스캔을 매우 빠르게 수행합니다.

Braa는 자체 SNMP 스택을 구현하므로 net-snmp와 같은 SNMP 라이브러리가 필요하지 않습니다.

**구문:** braa \[커뮤니티 문자열]@\[SNMP 서버의 IP]:\[iso id]
```bash
braa ignite123@192.168.1.125:.1.3.6.*
```
이는 수동으로 처리할 수 없는 많은 양의 정보를 추출할 수 있습니다.


그러니 가장 흥미로운 정보를 찾아봅시다 ([https://blog.rapid7.com/2016/05/05/snmp-data-harvesting-during-penetration-testing/](https://blog.rapid7.com/2016/05/05/snmp-data-harvesting-during-penetration-testing/)에서):


### **장치**

각 파일에서 **sysDesc MIB 데이터** (1.3.6.1.2.1.1.1.0)를 추출하여 장치를 식별하는 과정으로 시작됩니다. 이는 **grep 명령어**를 사용하여 수행됩니다:
```bash
grep ".1.3.6.1.2.1.1.1.0" *.snmp
```
### **개인 문자열 식별**

중요한 단계는 주로 Cisco IOS 라우터에서 사용되는 조직의 **개인 커뮤니티 문자열**을 식별하는 것입니다. 이 문자열은 라우터에서 **실행 중인 구성**을 추출하는 데 사용됩니다. 식별은 종종 "trap"이라는 단어를 포함하는 SNMP Trap 데이터를 분석하여 **grep 명령어**를 사용하여 수행됩니다:
```bash
grep -i "trap" *.snmp
```
### **사용자명/비밀번호**

MIB 테이블에 저장된 로그는 **로그인 실패 시도**를 확인하기 위해 검토됩니다. 이는 실수로 사용자명으로 입력된 비밀번호를 포함할 수 있습니다. _fail_, _failed_, 또는 _login_과 같은 키워드를 검색하여 가치 있는 데이터를 찾습니다:
```bash
grep -i "login\|fail" *.snmp
```
### **이메일**

마지막으로, 데이터에서 **이메일 주소**를 추출하기 위해 정규 표현식을 사용한 **grep 명령어**를 사용합니다. 이때 이메일 형식과 일치하는 패턴에 초점을 맞춥니다:
```bash
grep -E -o "\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,6}\b" *.snmp
```
## SNMP 값 수정하기

_**NetScanTools**_를 사용하여 **값을 수정**할 수 있습니다. 이를 위해 **개인 문자열**을 알아야 합니다.

## 스푸핑

SNMP 서비스에 일부 IP만 쿼리할 수 있는 ACL이 있는 경우, UDP 패킷 내에서 해당 주소 중 하나를 스푸핑하여 트래픽을 스니핑할 수 있습니다.

## SNMP 구성 파일 검사

* snmp.conf
* snmpd.conf
* snmp-config.xml

## HackTricks 자동 명령어
```
Protocol_Name: SNMP    #Protocol Abbreviation if there is one.
Port_Number:  161     #Comma separated if there is more than one.
Protocol_Description: Simple Network Managment Protocol         #Protocol Abbreviation Spelled out

Entry_1:
Name: Notes
Description: Notes for SNMP
Note: |
SNMP - Simple Network Management Protocol is a protocol used to monitor different devices in the network (like routers, switches, printers, IoTs...).

https://book.hacktricks.xyz/pentesting/pentesting-snmp

Entry_2:
Name: SNMP Check
Description: Enumerate SNMP
Command: snmp-check {IP}

Entry_3:
Name: OneSixtyOne
Description: Crack SNMP passwords
Command: onesixtyone -c /usr/share/seclists/Discovery/SNMP/common-snmp-community-strings-onesixtyone.txt {IP} -w 100

Entry_4:
Name: Nmap
Description: Nmap snmp (no brute)
Command: nmap --script "snmp* and not snmp-brute" {IP}

Entry_5:
Name: Hydra Brute Force
Description: Need Nothing
Command: hydra -P {Big_Passwordlist} -v {IP} snmp
```
<img src="../../.gitbook/assets/i3.png" alt="" data-size="original">\
**버그 바운티 팁**: **Intigriti**에 가입하여 해커들이 만든 프리미엄 버그 바운티 플랫폼에 참여하세요! 오늘 [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks)에서 가입하고 최대 **$100,000**의 보상을 받으세요!

{% embed url="https://go.intigriti.com/hacktricks" %}

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>를 통해 AWS 해킹을 처음부터 전문가까지 배워보세요<strong>!</strong></summary>

HackTricks를 지원하는 다른 방법:

* **회사를 HackTricks에서 광고하거나 HackTricks를 PDF로 다운로드**하려면 [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)를 확인하세요!
* [**공식 PEASS & HackTricks 스웨그**](https://peass.creator-spring.com)를 얻으세요.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)를 발견하세요. 독점적인 [**NFTs**](https://opensea.io/collection/the-peass-family) 컬렉션입니다.
* 💬 [**Discord 그룹**](https://discord.gg/hRep4RUj7f) 또는 [**텔레그램 그룹**](https://t.me/peass)에 **참여**하거나 **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)**를 팔로우**하세요.
* **HackTricks**와 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github 저장소에 PR을 제출하여 여러분의 해킹 기법을 공유하세요.

</details>
