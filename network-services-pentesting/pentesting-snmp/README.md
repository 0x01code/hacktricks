# 161,162,10161,10162/udp - Pentesting SNMP

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**merchandising officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux d√©p√¥ts github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

<img src="../../.gitbook/assets/i3.png" alt="" data-size="original">\
**Conseil pour les bug bounties** : **inscrivez-vous** sur **Intigriti**, une plateforme de bug bounties premium cr√©√©e par des hackers, pour des hackers ! Rejoignez-nous sur [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) d√®s aujourd'hui et commencez √† gagner des bounties jusqu'√† **100 000 $** !

{% embed url="https://go.intigriti.com/hacktricks" %}

## Informations de base

**SNMP - Simple Network Management Protocol** est un protocole utilis√© pour surveiller diff√©rents appareils dans le r√©seau (comme les routeurs, les commutateurs, les imprimantes, les IoTs...).
```
PORT    STATE SERVICE REASON                 VERSION
161/udp open  snmp    udp-response ttl 244   ciscoSystems SNMPv3 server (public)
```
{% hint style="info" %}
SNMP utilise √©galement le port **162/UDP** pour les **traps**. Ce sont des **paquets de donn√©es envoy√©s du serveur SNMP au client sans √™tre explicitement demand√©s**.
{% endhint %}

### MIB

Pour garantir que l'acc√®s SNMP fonctionne entre les fabricants et avec diff√©rentes combinaisons client-serveur, la **Base d'Informations de Gestion (MIB)** a √©t√© cr√©√©e. MIB est un **format ind√©pendant pour stocker les informations des appareils**. Un MIB est un fichier **texte** dans lequel tous les **objets SNMP interrogeables** d'un appareil sont list√©s dans une hi√©rarchie arborescente **standardis√©e**. Il contient au **moins un `Identifiant d'Objet` (`OID`)**, qui, en plus de l'adresse **unique** n√©cessaire et d'un **nom**, fournit √©galement des informations sur le type, les droits d'acc√®s et une description de l'objet respectif.
Les fichiers MIB sont √©crits dans le format de texte ASCII bas√© sur la `Notation Syntaxique Abstraite Un` (`ASN.1`). Les **MIB ne contiennent pas de donn√©es**, mais ils expliquent **o√π trouver quelle information** et √† quoi elle ressemble, quelles valeurs de retour pour l'OID sp√©cifique, ou quel type de donn√©es est utilis√©.

### OIDs

**OIDs** signifie **Identifiants d'Objets**. **Les OIDs identifient de mani√®re unique les objets g√©r√©s dans une hi√©rarchie MIB**. Cela peut √™tre repr√©sent√© comme un arbre, dont les niveaux sont attribu√©s par diff√©rentes organisations. Les identifiants d'objets MIB de niveau sup√©rieur (OIDs) appartiennent √† diff√©rentes organisations standard.
**Les fournisseurs d√©finissent des branches priv√©es comprenant des objets g√©r√©s pour leurs propres produits.**

![](../../.gitbook/assets/snmp\_oid\_mib\_tree.png)

Vous pouvez **naviguer** √† travers un **arbre OID** depuis le web ici : [http://www.oid-info.com/cgi-bin/display?tree=#focus](http://www.oid-info.com/cgi-bin/display?tree=#focus) ou **voir ce qu'un OID signifie** (comme `1.3.6.1.2.1.1`) en acc√©dant √† [http://oid-info.com/get/1.3.6.1.2.1.1](http://oid-info.com/get/1.3.6.1.2.1.1).
Il existe certains **OIDs bien connus** comme ceux √† l'int√©rieur de [1.3.6.1.2.1](http://oid-info.com/get/1.3.6.1.2.1) qui r√©f√©rencent les variables du protocole de gestion de r√©seau simple (SNMP) d√©finies par MIB-2. Et √† partir des **OIDs d√©pendant de celui-ci**, vous pouvez obtenir des donn√©es int√©ressantes sur l'h√¥te (donn√©es syst√®me, donn√©es r√©seau, donn√©es de processus...)

### **Exemple d'OID**

**`1 . 3 . 6 . 1 . 4 . 1 . 1452 . 1 . 2 . 5 . 1 . 3 . 21 . 1 . 4 . 7`**

Voici une d√©composition de cette adresse.

* 1 ‚Äì cela s'appelle l'ISO et cela √©tablit qu'il s'agit d'un OID. C'est pourquoi tous les OIDs commencent par "1"
* 3 ‚Äì cela s'appelle ORG et il est utilis√© pour sp√©cifier l'organisation qui a construit l'appareil.
* 6 ‚Äì c'est le dod ou le D√©partement de la D√©fense qui est l'organisation qui a √©tabli Internet en premier.
* 1 ‚Äì c'est la valeur de l'internet pour d√©noter que toutes les communications se feront via Internet.
* 4 ‚Äì cette valeur d√©termine que cet appareil est fabriqu√© par une organisation priv√©e et non gouvernementale.
* 1 ‚Äì cette valeur indique que l'appareil est fabriqu√© par une entreprise ou une entit√© commerciale.

Ces six premi√®res valeurs ont tendance √† √™tre les m√™mes pour tous les appareils et elles vous donnent les informations de base √† leur sujet. Cette s√©quence de chiffres sera la m√™me pour tous les OIDs, sauf lorsque l'appareil est fabriqu√© par le gouvernement.

Passons √† la s√©rie suivante de chiffres.

* 1452 ‚Äì donne le nom de l'organisation qui a fabriqu√© cet appareil.
* 1 ‚Äì explique le type d'appareil. Dans ce cas, il s'agit d'un r√©veil.
* 2 ‚Äì d√©termine que cet appareil est une unit√© terminale √† distance.

Le reste des valeurs donne des informations sp√©cifiques sur l'appareil.

* 5 ‚Äì d√©signe un point d'alarme discret.
* 1 ‚Äì point sp√©cifique dans l'appareil
* 3 ‚Äì port
* 21 ‚Äì adresse du port
* 1 ‚Äì affichage pour le port
* 4 ‚Äì num√©ro de point
* 7 ‚Äì √©tat du point

_**(Exemple pris de**_ [_**ici**_](https://www.netadmintools.com/snmp-mib-and-oids)_**)**_

### Versions SNMP

Il existe 2 versions importantes de SNMP :

* **SNMPv1** : La principale, elle est encore la plus fr√©quente, l'**authentification est bas√©e sur une cha√Æne** (cha√Æne de communaut√©) qui circule en **texte clair** (toutes les informations circulent en texte clair). Les **versions 2 et 2c** envoient √©galement le **trafic en texte clair** et utilisent une **cha√Æne de communaut√© comme authentification**.
* **SNMPv3** : Utilise une meilleure forme d'**authentification** et les informations circulent **chiffr√©es** en utilisant (**une attaque par dictionnaire** pourrait √™tre effectu√©e mais il serait beaucoup plus difficile de trouver les identifiants corrects que dans SNMPv1 et v2).

### Cha√Ænes de Communaut√©

Comme mentionn√© pr√©c√©demment, **afin d'acc√©der aux informations enregistr√©es sur le MIB, vous devez conna√Ætre la cha√Æne de communaut√© dans les versions 1 et 2/2c et les identifiants dans la version 3.**\
Il existe **2 types de cha√Ænes de communaut√©** :

* **`public`** principalement des fonctions **en lecture seule**
* **`private`** **Lecture/√âcriture** en g√©n√©ral

Notez que **la possibilit√© d'√©crire sur un OID d√©pend de la cha√Æne de communaut√© utilis√©e**, donc **m√™me** si vous trouvez que "**public**" est utilis√©, vous pourriez √™tre capable d'**√©crire certaines valeurs**. De plus, il **peut** exister des objets qui sont **toujours "Lecture Seule"**.\
Si vous essayez d'**√©crire** sur un objet, une erreur **`noSuchName` ou `readOnly`** est re√ßue**.**

Dans les versions 1 et 2/2c, si vous utilisez une **mauvaise** cha√Æne de communaut√©, le serveur ne **r√©pondra** pas. Donc, s'il r√©pond, une **cha√Æne de communaut√© valide a √©t√© utilis√©e**.

## Ports

* L'agent SNMP re√ßoit les requ√™tes sur le port UDP **161**.
* Le gestionnaire re√ßoit les notifications ([Traps](https://en.wikipedia.org/wiki/Simple\_Network\_Management\_Protocol#Trap) et [InformRequests](https://en.wikipedia.org/wiki/Simple\_Network\_Management\_Protocol#InformRequest)) sur le port **162**.
* Lorsqu'il est utilis√© avec [Transport Layer Security](https://en.wikipedia.org/wiki/Transport\_Layer\_Security) ou [Datagram Transport Layer Security](https://en.wikipedia.org/wiki/Datagram\_Transport\_Layer\_Security), les requ√™tes sont re√ßues sur le port **10161** et les notifications sont envoy√©es au port **10162**.

## Forcer Brutalement la Cha√Æne de Communaut√© (v1 et v2c)

Pour **deviner la cha√Æne de communaut√©**, vous pourriez effectuer une attaque par dictionnaire. Consultez [ici diff√©rentes mani√®res de r√©aliser une attaque par force brute contre SNMP](../../generic-methodologies-and-resources/brute-force.md#snmp). Une cha√Æne de communaut√© fr√©quemment utilis√©e est `public`.

## √ânum√©ration SNMP

Il est recommand√© d'installer ce qui suit pour voir ce que signifie **chaque OID recueilli** de l'appareil :
```bash
apt-get install snmp-mibs-downloader
download-mibs
# Finally comment the line saying "mibs :" in /etc/snmp/snmp.conf
sudo vi /etc/snmp/snmp.conf
```
Si vous connaissez une cha√Æne de communaut√© valide, vous pouvez acc√©der aux donn√©es en utilisant **SNMPWalk** ou **SNMP-Check** :
```bash
snmpbulkwalk -c [COMM_STRING] -v [VERSION] [IP] . #Don't forget the final dot
snmpbulkwalk -c public -v2c 10.10.11.136 .

snmpwalk -v [VERSION_SNMP] -c [COMM_STRING] [DIR_IP]
snmpwalk -v [VERSION_SNMP] -c [COMM_STRING] [DIR_IP] 1.3.6.1.2.1.4.34.1.3 #Get IPv6, needed dec2hex
snmpwalk -v [VERSION_SNMP] -c [COMM_STRING] [DIR_IP] NET-SNMP-EXTEND-MIB::nsExtendObjects #get extended
snmpwalk -v [VERSION_SNMP] -c [COMM_STRING] [DIR_IP] .1 #Enum all

snmp-check [DIR_IP] -p [PORT] -c [COMM_STRING]

nmap --script "snmp* and not snmp-brute" <target>

braa <community string>@<IP>:.1.3.6.* #Bruteforce specific OID
```
Gr√¢ce aux requ√™tes √©tendues (download-mibs), il est possible d'√©num√©rer encore plus d'informations sur le syst√®me avec la commande suivante :
```bash
snmpwalk -v X -c public <IP> NET-SNMP-EXTEND-MIB::nsExtendOutputFull
```
**SNMP** contient beaucoup d'informations sur l'h√¥te et vous pourriez trouver int√©ressants : **Interfaces r√©seau** (adresse IPv4 et **IPv6**), Noms d'utilisateur, Temps de fonctionnement, Version du serveur/OS, et **processus**

**en cours** (peut contenir des mots de passe)....

### **Param√®tres dangereux**

**Depuis** [**https://academy.hackthebox.com/module/112/section/1075**](https://academy.hackthebox.com/module/112/section/1075)\*\*\*\*

| **Param√®tres**                                    | **Description**                                                                       |
| ------------------------------------------------- | ------------------------------------------------------------------------------------- |
| `rwuser noauth`                                   | Donne acc√®s √† l'arbre OID complet sans authentification.                              |
| `rwcommunity <cha√Æne de communaut√©> <adresse IPv4>` | Donne acc√®s √† l'arbre OID complet ind√©pendamment de l'origine des requ√™tes.           |
| `rwcommunity6 <cha√Æne de communaut√©> <adresse IPv6>` | M√™me acc√®s qu'avec `rwcommunity` avec la diff√©rence de l'utilisation d'IPv6.          |

### Param√®tres SNMP de Microsoft Windows

| **Valeur MIB**                                   | **Description**                                                                       |
| ------------------------------------------------ | ------------------------------------------------------------------------------------- |
| `1.3.6.1.2.1.25.1.6.0`                           | Processus Syst√®me.                                                                    |
| `1.3.6.1.2.1.25.4.2.1.2`                         | Programmes en cours d'ex√©cution.                                                      |
| `1.3.6.1.2.1.25.4.2.1.4`                         | Chemin des processus.                                                                 |
| `1.3.6.1.2.1.25.2.3.1.4`                         | Unit√©s de stockage.                                                                   |
| `1.3.6.1.2.1.25.6.3.1.2`                         | Nom du logiciel.                                                                      |
| `1.3.6.1.4.1.77.1.2.25`                          | Comptes d'utilisateurs.                                                               |
| `1.3.6.1.2.1.6.13.1.3`                           | Ports locaux TCP.                                                                     |

### Cisco

Consultez cette page si vous utilisez du mat√©riel Cisco :

{% content-ref url="cisco-snmp.md" %}
[cisco-snmp.md](cisco-snmp.md)
{% endcontent-ref %}

## De SNMP √† RCE

Si vous avez la **cha√Æne** qui vous permet d'**√©crire des valeurs** dans le service SNMP, vous pourriez l'exploiter pour **ex√©cuter des commandes** :

{% content-ref url="snmp-rce.md" %}
[snmp-rce.md](snmp-rce.md)
{% endcontent-ref %}

## **SNMP massif**

[Braa](https://github.com/mteg/braa) est un scanner SNMP de masse. L'utilisation pr√©vue d'un tel outil est, bien s√ªr, de faire des requ√™tes SNMP ‚Äì mais contrairement √† snmpwalk de net-snmp, il est capable de requ√™ter des dizaines ou des centaines d'h√¥tes simultan√©ment, et dans un seul processus. Ainsi, il consomme tr√®s peu de ressources syst√®me et effectue le balayage TR√àS rapidement.

Braa impl√©mente sa PROPRE pile snmp, donc il n'a pas besoin de biblioth√®ques SNMP comme net-snmp.

**Syntaxe :** braa \[Cha√Æne de communaut√©]@\[IP du serveur SNMP]:\[id iso]
```
braa ignite123@192.168.1.125:.1.3.6.*
```
Cela peut extraire beaucoup de Mo d'informations que vous ne pouvez pas traiter manuellement.

Alors, cherchons les informations les plus int√©ressantes (de [https://blog.rapid7.com/2016/05/05/snmp-data-harvesting-during-penetration-testing/](https://blog.rapid7.com/2016/05/05/snmp-data-harvesting-during-penetration-testing/)) :

### Appareils

L'une des premi√®res choses que je fais est d'extraire les donn√©es MIB sysDesc .1.3.6.1.2.1.1.1.0 de chaque fichier pour d√©terminer de quels appareils j'ai r√©colt√© des informations. Cela peut facilement √™tre fait en utilisant la commande grep suivante :
```
grep ".1.3.6.1.2.1.1.1.0" *.snmp
```
### Identifier la cha√Æne priv√©e

Par exemple, si je parviens √† identifier la cha√Æne de communaut√© priv√©e utilis√©e par une organisation sur leurs routeurs Cisco IOS, je pourrais alors utiliser cette cha√Æne pour extraire les configurations en cours de ces routeurs. La meilleure m√©thode pour trouver de telles donn√©es a souvent √©t√© li√©e aux donn√©es de pi√®ge SNMP. Donc, encore une fois, en utilisant le grep suivant, nous pouvons parcourir rapidement beaucoup de donn√©es MIB √† la recherche du mot-cl√© ¬´ trap ¬ª :
```bash
grep -i "trap" *.snmp
```
### Noms d'utilisateur/mots de passe

Un autre domaine d'int√©r√™t est les journaux, j'ai d√©couvert qu'il y a des appareils qui conservent des journaux dans les tables MIB. Ces journaux peuvent √©galement contenir des tentatives de connexion √©chou√©es. Pensez √† la derni√®re fois que vous vous √™tes connect√© √† un appareil via Telnet ou SSH et que vous avez involontairement entr√© votre mot de passe comme nom d'utilisateur. Je recherche g√©n√©ralement des mots-cl√©s tels que _√©chec_, _√©chou√©_ ou _connexion_ et j'examine ces donn√©es pour voir s'il y a quelque chose de valeur.
```bash
grep -i "login\|fail" *.snmp
```
### Courriels
```bash
grep -E -o "\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,6}\b" *.snmp
```
## Modification des valeurs SNMP

Vous pouvez utiliser _**NetScanTools**_ pour **modifier des valeurs**. Vous devrez conna√Ætre la **cha√Æne priv√©e** pour pouvoir le faire.

## Spoofing

S'il existe une ACL qui n'autorise que certaines adresses IP √† interroger le service SMNP, vous pouvez usurper l'une de ces adresses dans le paquet UDP et renifler le trafic.

## Examiner les fichiers de configuration SNMP

* snmp.conf
* snmpd.conf
* snmp-config.xml

## Commandes automatiques HackTricks
```
Protocol_Name: SNMP    #Protocol Abbreviation if there is one.
Port_Number:  161     #Comma separated if there is more than one.
Protocol_Description: Simple Network Managment Protocol         #Protocol Abbreviation Spelled out

Entry_1:
Name: Notes
Description: Notes for SNMP
Note: |
SNMP - Simple Network Management Protocol is a protocol used to monitor different devices in the network (like routers, switches, printers, IoTs...).

https://book.hacktricks.xyz/pentesting/pentesting-snmp

Entry_2:
Name: SNMP Check
Description: Enumerate SNMP
Command: snmp-check {IP}

Entry_3:
Name: OneSixtyOne
Description: Crack SNMP passwords
Command: onesixtyone -c /usr/share/seclists/Discovery/SNMP/common-snmp-community-strings-onesixtyone.txt {IP} -w 100

Entry_4:
Name: Nmap
Description: Nmap snmp (no brute)
Command: nmap --script "snmp* and not snmp-brute" {IP}

Entry_5:
Name: Hydra Brute Force
Description: Need Nothing
Command: hydra -P {Big_Passwordlist} -v {IP} snmp
```
```markdown
<img src="../../.gitbook/assets/i3.png" alt="" data-size="original">
**Conseil pour les bug bounties** : **inscrivez-vous** sur **Intigriti**, une plateforme de bug bounties premium **cr√©√©e par des hackers, pour des hackers** ! Rejoignez-nous sur [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) d√®s aujourd'hui et commencez √† gagner des primes allant jusqu'√† **100 000 $** !

{% embed url="https://go.intigriti.com/hacktricks" %}

<details>

<summary><strong>Apprenez le hacking AWS du d√©butant √† l'expert avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> !</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**merchandising officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez-moi** sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de hacking en soumettant des PR aux d√©p√¥ts github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
```
