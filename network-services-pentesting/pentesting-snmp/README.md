# 161,162,10161,10162/udp - Pentesting SNMP

<details>

<summary><strong>Lernen Sie das Hacken von AWS von Null auf Heldenniveau mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks bewerben m√∂chten** oder **HackTricks als PDF herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merchandise**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **GitHub-Repositories** senden.

</details>

<img src="../../.gitbook/assets/i3.png" alt="" data-size="original">\
**Bug-Bounty-Tipp**: **Registrieren** Sie sich f√ºr **Intigriti**, eine Premium-**Bug-Bounty-Plattform, die von Hackern f√ºr Hacker** entwickelt wurde! Treten Sie uns noch heute unter [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) bei und verdienen Sie Pr√§mien von bis zu **100.000 $**!

{% embed url="https://go.intigriti.com/hacktricks" %}

## Grundlegende Informationen

**SNMP - Simple Network Management Protocol** ist ein Protokoll, das zur √úberwachung verschiedener Ger√§te im Netzwerk verwendet wird (wie Router, Switches, Drucker, IoT-Ger√§te...).
```
PORT    STATE SERVICE REASON                 VERSION
161/udp open  snmp    udp-response ttl 244   ciscoSystems SNMPv3 server (public)
```
{% hint style="info" %}
SNMP verwendet auch den Port **162/UDP** f√ºr **Traps**. Dabei handelt es sich um Daten **Pakete, die vom SNMP-Server an den Client gesendet werden, ohne explizit angefordert zu werden**.
{% endhint %}

### MIB

Um sicherzustellen, dass der SNMP-Zugriff √ºber verschiedene Hersteller und mit unterschiedlichen Client-Server-Kombinationen funktioniert, wurde die **Management Information Base (MIB)** erstellt. MIB ist ein **unabh√§ngiges Format zur Speicherung von Ger√§teinformationen**. Eine MIB ist eine **Textdatei**, in der alle abfragbaren **SNMP-Objekte** eines Ger√§ts in einer **standardisierten** Baumhierarchie aufgelistet sind. Sie enth√§lt mindestens eine `Object Identifier` (`OID`), die neben der erforderlichen **eindeutigen Adresse** und einem **Namen** auch Informationen √ºber den Typ, die Zugriffsrechte und eine Beschreibung des jeweiligen Objekts liefert.\
MIB-Dateien sind im ASCII-Textformat basierend auf der `Abstract Syntax Notation One` (`ASN.1`) geschrieben. Die **MIBs enthalten keine Daten**, sondern erkl√§ren **wo welche Informationen zu finden sind** und wie sie aussehen, welche R√ºckgabewerte f√ºr die spezifische OID zur√ºckgegeben werden oder welcher Datentyp verwendet wird.

### OIDs

**Object Identifiers (OIDs)** spielen eine entscheidende Rolle. Diese eindeutigen Bezeichner sind dazu bestimmt, Objekte innerhalb einer **Management Information Base (MIB)** zu verwalten.

Die h√∂chsten Ebenen der MIB-Objekt-IDs oder OIDs werden verschiedenen Standardisierungsorganisationen zugewiesen. In diesen obersten Ebenen wird der Rahmen f√ºr globale Managementpraktiken und -standards festgelegt.

Dar√ºber hinaus haben Hersteller die Freiheit, private Zweige zu erstellen. Innerhalb dieser Zweige haben sie die **Autonomie, verwaltete Objekte einzuschlie√üen, die f√ºr ihre eigenen Produktlinien relevant sind**. Dieses System stellt sicher, dass es eine strukturierte und organisierte Methode zur Identifizierung und Verwaltung einer Vielzahl von Objekten √ºber verschiedene Hersteller und Standards hinweg gibt.

![](../../.gitbook/assets/snmp\_oid\_mib\_tree.png)

Sie k√∂nnen durch einen **OID-Baum** hier navigieren: [http://www.oid-info.com/cgi-bin/display?tree=#focus](http://www.oid-info.com/cgi-bin/display?tree=#focus) oder **sehen, was eine OID bedeutet** (wie `1.3.6.1.2.1.1`) indem Sie [http://oid-info.com/get/1.3.6.1.2.1.1](http://oid-info.com/get/1.3.6.1.2.1.1) aufrufen.\
Es gibt einige **bekannte OIDs** wie diejenigen innerhalb von [1.3.6.1.2.1](http://oid-info.com/get/1.3.6.1.2.1), die auf von MIB-2 definierte Simple Network Management Protocol (SNMP) Variablen verweisen. Und von den **von dieser abh√§ngigen OIDs** k√∂nnen Sie einige interessante Host-Daten abrufen (Systemdaten, Netzwerkdaten, Prozessdaten...).

### **OID-Beispiel**

[**Beispiel von hier**](https://www.netadmintools.com/snmp-mib-and-oids/):

**`1 . 3 . 6 . 1 . 4 . 1 . 1452 . 1 . 2 . 5 . 1 . 3. 21 . 1 . 4 . 7`**

Hier ist eine Aufschl√ºsselung dieser Adresse.

* 1 - dies wird als ISO bezeichnet und zeigt an, dass es sich um eine OID handelt. Deshalb beginnen alle OIDs mit "1".
* 3 - dies wird als ORG bezeichnet und wird verwendet, um die Organisation anzugeben, die das Ger√§t gebaut hat.
* 6 - dies ist das dod oder das Department of Defense, die Organisation, die das Internet zuerst etabliert hat.
* 1 - dies ist der Wert des Internets, um anzuzeigen, dass alle Kommunikation √ºber das Internet erfolgen wird.
* 4 - dieser Wert bestimmt, dass dieses Ger√§t von einer privaten Organisation und nicht von einer Regierungsorganisation hergestellt wird.
* 1 - dieser Wert zeigt an, dass das Ger√§t von einem Unternehmen oder einer Gesch√§ftseinheit hergestellt wird.

Diese ersten sechs Werte sind f√ºr alle Ger√§te tendenziell gleich und geben grundlegende Informationen √ºber sie. Diese Zahlenfolge ist bei allen OIDs gleich, au√üer wenn das Ger√§t von der Regierung hergestellt wird.

Gehen wir zu den n√§chsten Zahlen √ºber.

* 1452 - gibt den Namen der Organisation an, die dieses Ger√§t hergestellt hat.
* 1 - erkl√§rt den Ger√§tetyp. In diesem Fall handelt es sich um einen Wecker.
* 2 - bestimmt, dass dieses Ger√§t eine Remote-Terminal-Einheit ist.

Die restlichen Werte geben spezifische Informationen √ºber das Ger√§t.

* 5 - kennzeichnet einen diskreten Alarmpunkt.
* 1 - spezifischer Punkt im Ger√§t
* 3 - Port
* 21 - Adresse des Ports
* 1 - Anzeige f√ºr den Port
* 4 - Punktnummer
* 7 - Zustand des Punktes

### SNMP-Versionen

Es gibt 2 wichtige Versionen von SNMP:

* **SNMPv1**: Die Hauptversion, sie ist immer noch die h√§ufigste, die **Authentifizierung basiert auf einem String** (Community-String), der im **Klartext** √ºbertragen wird (alle Informationen werden im Klartext √ºbertragen). **Version 2 und 2c** senden den **Datenverkehr ebenfalls im Klartext** und verwenden einen **Community-String zur Authentifizierung**.
* **SNMPv3**: Verwendet eine bessere **Authentifizierungsform** und die Informationen werden **verschl√ºsselt** √ºbertragen (ein **W√∂rterbuchangriff** k√∂nnte durchgef√ºhrt werden, aber es w√§re viel schwieriger, die richtigen Anmeldeinformationen zu finden als bei SNMPv1 und v2).

### Community-Strings

Wie bereits erw√§hnt, **m√ºssen Sie f√ºr den Zugriff auf die in der MIB gespeicherten Informationen den Community-String in den Versionen 1 und 2/2c und die Anmeldeinformationen in Version 3 kennen.**\
Es gibt **2 Arten von Community-Strings**:

* **`public`** haupts√§chlich **nur-Lese-Funktionen**
* **`private`** **Lese-/Schreibzugriff** im Allgemeinen

Beachten Sie, dass **die Schreibbarkeit einer OID vom verwendeten Community-String abh√§ngt**, sodass Sie m√∂glicherweise auch bei Verwendung von "**public**" einige Werte schreiben k√∂nnen. Es k√∂nnen auch Objekte vorhanden sein, die immer "nur-Lesen" sind.\
Wenn Sie versuchen, ein Objekt zu schreiben, wird ein **`noSuchName`- oder `readOnly`-Fehler** empfangen.

In den Versionen 1 und 2/2c antwortet der Server nicht, wenn ein **falscher** Community-String verwendet wird. Wenn also eine Antwort erfolgt, wurde ein **g√ºltiger Community-String verwendet**.

## Ports

[Aus Wikipedia](https://en.wikipedia.org/wiki/Simple_Network_Management_Protocol#:~:text=All%20SNMP%20messages%20are%20transported,port%20161%20in%20the%20agent.):

* Der SNMP-Agent empf√§ngt Anfragen auf UDP-Port **161**.
* Der Manager empf√§ngt Benachrichtigungen ([Traps](https://en.wikipedia.org/wiki/Simple\_Network\_Management\_Protocol#Trap) und [InformRequests](https://en.wikipedia.org/wiki/Simple\_Network\_Management\_Protocol#InformRequest)) auf Port **162**.
* Bei Verwendung von [Transport Layer Security](https://en.wikipedia.org/wiki/Transport\_Layer\_Security) oder [Datagram Transport Layer Security](https://en.wikipedia.org/wiki/Datagram\_Transport\_Layer\_Security) werden Anfragen auf Port **10161** empfangen und Benachrichtigungen an Port **10162** gesendet.

## Brute-Force Community-String (v1 und v2c)

Um den Community-String zu **erraten**, k√∂nnen Sie einen W√∂rterbuchangriff durchf√ºhren. √úberpr√ºfen Sie [hier verschiedene M√∂glichkeiten, einen Brute-Force-Angriff gegen SNMP durchzuf√ºhren](../../generic-methodologies-and-resources/brute-force.md#snmp). Ein h√§ufig verwendeter Community-String ist `public`.
## SNMP-Aufz√§hlung

Es wird empfohlen, die folgenden Tools zu installieren, um zu sehen, was jede gesammelte OID vom Ger√§t bedeutet:
```bash
apt-get install snmp-mibs-downloader
download-mibs
# Finally comment the line saying "mibs :" in /etc/snmp/snmp.conf
sudo vi /etc/snmp/snmp.conf
```
Wenn Sie einen g√ºltigen Community-String kennen, k√∂nnen Sie auf die Daten mit **SNMPWalk** oder **SNMP-Check** zugreifen:
```bash
snmpbulkwalk -c [COMM_STRING] -v [VERSION] [IP] . #Don't forget the final dot
snmpbulkwalk -c public -v2c 10.10.11.136 .

snmpwalk -v [VERSION_SNMP] -c [COMM_STRING] [DIR_IP]
snmpwalk -v [VERSION_SNMP] -c [COMM_STRING] [DIR_IP] 1.3.6.1.2.1.4.34.1.3 #Get IPv6, needed dec2hex
snmpwalk -v [VERSION_SNMP] -c [COMM_STRING] [DIR_IP] NET-SNMP-EXTEND-MIB::nsExtendObjects #get extended
snmpwalk -v [VERSION_SNMP] -c [COMM_STRING] [DIR_IP] .1 #Enum all

snmp-check [DIR_IP] -p [PORT] -c [COMM_STRING]

nmap --script "snmp* and not snmp-brute" <target>

braa <community string>@<IP>:.1.3.6.* #Bruteforce specific OID
```
Dank erweiterter Abfragen (download-mibs) ist es m√∂glich, noch mehr Informationen √ºber das System mit dem folgenden Befehl aufzulisten:
```bash
snmpwalk -v X -c public <IP> NET-SNMP-EXTEND-MIB::nsExtendOutputFull
```
**SNMP** enth√§lt viele Informationen √ºber den Host, und interessante Dinge, die Sie finden k√∂nnten, sind: **Netzwerkschnittstellen** (IPv4- und **IPv6**-Adressen), Benutzernamen, Betriebszeit, Server/OS-Version und **laufende** Prozesse (k√∂nnen Passw√∂rter enthalten)....

### **Gef√§hrliche Einstellungen**

Im Bereich des Netzwerkmanagements sind bestimmte Konfigurationen und Parameter entscheidend f√ºr eine umfassende √úberwachung und Kontrolle.

### Zugriffseinstellungen

Zwei Hauptkonfigurationen erm√∂glichen den Zugriff auf den **vollen OID-Baum**, der ein wesentlicher Bestandteil des Netzwerkmanagements ist:

1. **`rwuser noauth`** ist so eingestellt, dass vollst√§ndiger Zugriff auf den OID-Baum ohne Authentifizierung m√∂glich ist. Diese Einstellung erm√∂glicht uneingeschr√§nkten Zugriff.

2. F√ºr eine spezifischere Kontrolle kann der Zugriff gew√§hrt werden mit:
- **`rwcommunity`** f√ºr **IPv4**-Adressen und
- **`rwcommunity6`** f√ºr **IPv6**-Adressen.

Beide Befehle erfordern eine **Community-String** und die entsprechende IP-Adresse und bieten uneingeschr√§nkten Zugriff unabh√§ngig von der Herkunft der Anfrage.

### SNMP-Parameter f√ºr Microsoft Windows

Eine Reihe von **Management Information Base (MIB)-Werten** wird verwendet, um verschiedene Aspekte eines Windows-Systems √ºber SNMP zu √ºberwachen:

- **Systemprozesse**: √úber den Wert `1.3.6.1.2.1.25.1.6.0` k√∂nnen aktive Prozesse im System √ºberwacht werden.
- **Laufende Programme**: Der Wert `1.3.6.1.2.1.25.4.2.1.2` ist f√ºr die Verfolgung der aktuell laufenden Programme vorgesehen.
- **Prozesspfad**: Um festzustellen, von wo aus ein Prozess ausgef√ºhrt wird, wird der MIB-Wert `1.3.6.1.2.1.25.4.2.1.4` verwendet.
- **Speichereinheiten**: Die √úberwachung von Speichereinheiten wird durch `1.3.6.1.2.1.25.2.3.1.4` erm√∂glicht.
- **Softwarename**: Zur Identifizierung der auf einem System installierten Software wird `1.3.6.1.2.1.25.6.3.1.2` verwendet.
- **Benutzerkonten**: Der Wert `1.3.6.1.4.1.77.1.2.25` erm√∂glicht die Verfolgung von Benutzerkonten.
- **TCP-Local-Ports**: Schlie√ülich ist `1.3.6.1.2.1.6.13.1.3` f√ºr die √úberwachung von TCP-Local-Ports vorgesehen und bietet Einblick in aktive Netzwerkverbindungen.

### Cisco

Werfen Sie einen Blick auf diese Seite, wenn Sie Cisco-Ger√§te haben:

{% content-ref url="cisco-snmp.md" %}
[cisco-snmp.md](cisco-snmp.md)
{% endcontent-ref %}

## Von SNMP zu RCE

Wenn Sie den **String** haben, der es Ihnen erm√∂glicht, Werte im SNMP-Dienst zu **schreiben**, k√∂nnen Sie ihn m√∂glicherweise missbrauchen, um **Befehle auszuf√ºhren**:

{% content-ref url="snmp-rce.md" %}
[snmp-rce.md](snmp-rce.md)
{% endcontent-ref %}

## **Massive SNMP**

[Braa](https://github.com/mteg/braa) ist ein massiver SNMP-Scanner. Die beabsichtigte Verwendung eines solchen Tools besteht nat√ºrlich darin, SNMP-Abfragen durchzuf√ºhren. Im Gegensatz zu snmpwalk von net-snmp kann es jedoch Dutzende oder Hunderte von Hosts gleichzeitig und in einem einzigen Prozess abfragen. Dadurch verbraucht es sehr wenig Systemressourcen und f√ºhrt das Scannen SEHR schnell durch.

Braa implementiert seinen EIGENEN SNMP-Stack und ben√∂tigt daher keine SNMP-Bibliotheken wie net-snmp.

**Syntax:** braa \[Community-String]@\[IP des SNMP-Servers]:\[iso id]
```bash
braa ignite123@192.168.1.125:.1.3.6.*
```
Dies kann eine gro√üe Menge an Informationen extrahieren, die Sie manuell nicht verarbeiten k√∂nnen.


Also, lassen Sie uns nach den interessantesten Informationen suchen (von [https://blog.rapid7.com/2016/05/05/snmp-data-harvesting-during-penetration-testing/](https://blog.rapid7.com/2016/05/05/snmp-data-harvesting-during-penetration-testing/)):


### **Ger√§te**

Der Prozess beginnt mit der Extraktion der **sysDesc MIB-Daten** (1.3.6.1.2.1.1.1.0) aus jeder Datei, um die Ger√§te zu identifizieren. Dies wird durch die Verwendung eines **grep-Befehls** erreicht:
```bash
grep ".1.3.6.1.2.1.1.1.0" *.snmp
```
### **Identifizieren des privaten Strings**

Ein entscheidender Schritt besteht darin, den von Organisationen verwendeten **privaten Community-String** zu identifizieren, insbesondere bei Cisco IOS-Routern. Dieser String erm√∂glicht die Extraktion von **laufenden Konfigurationen** von Routern. Die Identifizierung erfolgt oft durch Analyse von SNMP-Trap-Daten nach dem Wort "trap" mit einem **grep-Befehl**:
```bash
grep -i "trap" *.snmp
```
### **Benutzernamen/Passw√∂rter**

Protokolle, die in MIB-Tabellen gespeichert sind, werden auf **fehlgeschlagene Anmeldeversuche** untersucht, die versehentlich Passw√∂rter enthalten k√∂nnen, die als Benutzernamen eingegeben wurden. Es werden Schl√ºsselw√∂rter wie _fail_, _failed_ oder _login_ gesucht, um wertvolle Daten zu finden:
```bash
grep -i "login\|fail" *.snmp
```
### **E-Mails**

Schlie√ülich werden zur Extraktion von **E-Mail-Adressen** aus den Daten ein **grep-Befehl** mit einem regul√§ren Ausdruck verwendet, der sich auf Muster konzentriert, die E-Mail-Formate entsprechen:
```bash
grep -E -o "\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,6}\b" *.snmp
```
## √Ñndern von SNMP-Werten

Sie k√∂nnen _**NetScanTools**_ verwenden, um Werte zu **√§ndern**. Sie m√ºssen den **privaten String** kennen, um dies zu tun.

## Spoofing

Wenn es eine ACL gibt, die nur bestimmten IPs das Abfragen des SNMP-Dienstes erlaubt, k√∂nnen Sie eine dieser Adressen in das UDP-Paket f√§lschen und den Datenverkehr abh√∂ren.

## Untersuchung von SNMP-Konfigurationsdateien

* snmp.conf
* snmpd.conf
* snmp-config.xml

## HackTricks Automatische Befehle
```
Protocol_Name: SNMP    #Protocol Abbreviation if there is one.
Port_Number:  161     #Comma separated if there is more than one.
Protocol_Description: Simple Network Managment Protocol         #Protocol Abbreviation Spelled out

Entry_1:
Name: Notes
Description: Notes for SNMP
Note: |
SNMP - Simple Network Management Protocol is a protocol used to monitor different devices in the network (like routers, switches, printers, IoTs...).

https://book.hacktricks.xyz/pentesting/pentesting-snmp

Entry_2:
Name: SNMP Check
Description: Enumerate SNMP
Command: snmp-check {IP}

Entry_3:
Name: OneSixtyOne
Description: Crack SNMP passwords
Command: onesixtyone -c /usr/share/seclists/Discovery/SNMP/common-snmp-community-strings-onesixtyone.txt {IP} -w 100

Entry_4:
Name: Nmap
Description: Nmap snmp (no brute)
Command: nmap --script "snmp* and not snmp-brute" {IP}

Entry_5:
Name: Hydra Brute Force
Description: Need Nothing
Command: hydra -P {Big_Passwordlist} -v {IP} snmp
```
<img src="../../.gitbook/assets/i3.png" alt="" data-size="original">\
**Bug-Bounty-Tipp**: **Registrieren Sie sich** bei **Intigriti**, einer Premium-**Bug-Bounty-Plattform, die von Hackern f√ºr Hacker entwickelt wurde**! Treten Sie uns noch heute unter [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) bei und verdienen Sie Pr√§mien von bis zu **100.000 $**!

{% embed url="https://go.intigriti.com/hacktricks" %}

<details>

<summary><strong>Lernen Sie AWS-Hacking von Null auf Held mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks bewerben m√∂chten** oder **HackTricks als PDF herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merchandise**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositories senden.

</details>
