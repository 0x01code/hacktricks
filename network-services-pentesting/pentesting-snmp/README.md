# 161,162,10161,10162/udp - Pentesting SNMP

<details>

<summary><strong>Lernen Sie AWS-Hacking von Null auf Held mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks beworben sehen m√∂chten** oder **HackTricks im PDF-Format herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merch**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github Repositories einreichen.

</details>

<figure><img src="../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

Wenn Sie an einer **Hacking-Karriere** interessiert sind und das Unhackbare hacken m√∂chten - **wir stellen ein!** (_flie√üendes Polnisch in Wort und Schrift erforderlich_).

{% embed url="https://www.stmcyber.com/careers" %}

## Grundlegende Informationen

**SNMP - Simple Network Management Protocol** ist ein Protokoll, das verwendet wird, um verschiedene Ger√§te im Netzwerk zu √ºberwachen (wie Router, Switches, Drucker, IoT-Ger√§te...).
```
PORT    STATE SERVICE REASON                 VERSION
161/udp open  snmp    udp-response ttl 244   ciscoSystems SNMPv3 server (public)
```
{% hint style="info" %}
SNMP verwendet auch den Port **162/UDP** f√ºr **Traps**. Dabei handelt es sich um Daten **Pakete, die vom SNMP-Server an den Client gesendet werden, ohne explizit angefordert zu werden**.
{% endhint %}

### MIB

Um sicherzustellen, dass der SNMP-Zugriff √ºber verschiedene Hersteller und mit verschiedenen Client-Server-Kombinationen funktioniert, wurde die **Management Information Base (MIB)** erstellt. MIB ist ein **unabh√§ngiges Format zur Speicherung von Ger√§teinformationen**. Eine MIB ist eine **Textdatei**, in der alle abfragbaren **SNMP-Objekte eines Ger√§ts** in einer **standardisierten** Baumhierarchie aufgef√ºhrt sind. Sie enth√§lt mindestens eine `Object Identifier` (`OID`), die neben der erforderlichen **eindeutigen Adresse und einem Namen** auch Informationen √ºber den Typ, die Zugriffsrechte und eine Beschreibung des jeweiligen Objekts bereitstellt.\
MIB-Dateien sind im auf ASCII-Text basierenden Format `Abstract Syntax Notation One` (`ASN.1`) verfasst. Die **MIBs enthalten keine Daten**, sondern erkl√§ren **wo welche Informationen zu finden sind** und wie sie aussehen, welche R√ºckgabewerte f√ºr die spezifische OID gelten oder welcher Datentyp verwendet wird.

### OIDs

**Object Identifiers (OIDs)** spielen eine entscheidende Rolle. Diese eindeutigen Bezeichner sind dazu bestimmt, Objekte innerhalb einer **Management Information Base (MIB)** zu verwalten.

Die h√∂chsten Ebenen der MIB-Objekt-IDs oder OIDs werden verschiedenen Standardisierungsorganisationen zugewiesen. Innerhalb dieser obersten Ebenen wird der Rahmen f√ºr globale Managementpraktiken und -standards festgelegt.

Dar√ºber hinaus haben Anbieter die Freiheit, private Zweige zu erstellen. Innerhalb dieser Zweige haben sie die **Autonomie, verwaltete Objekte einzuschlie√üen, die f√ºr ihre eigenen Produktlinien relevant sind**. Dieses System gew√§hrleistet, dass es eine strukturierte und organisierte Methode zur Identifizierung und Verwaltung einer Vielzahl von Objekten √ºber verschiedene Anbieter und Standards hinweg gibt.

![](../../.gitbook/assets/snmp_oid_mib_tree.png)

Sie k√∂nnen sich durch einen **OID-Baum** im Web navigieren: [http://www.oid-info.com/cgi-bin/display?tree=#focus](http://www.oid-info.com/cgi-bin/display?tree=#focus) oder **sehen, was ein OID bedeutet** (wie `1.3.6.1.2.1.1`) unter [http://oid-info.com/get/1.3.6.1.2.1.1](http://oid-info.com/get/1.3.6.1.2.1.1).\
Es gibt einige **bekannte OIDs** wie diejenigen innerhalb von [1.3.6.1.2.1](http://oid-info.com/get/1.3.6.1.2.1), die auf von MIB-2 definierte Simple Network Management Protocol (SNMP) Variablen verweisen. Und von den **von diesem abh√§ngigen OIDs** k√∂nnen Sie einige interessante Host-Daten abrufen (Systemdaten, Netzwerkdaten, Prozessdaten...)

### **OID-Beispiel**

[**Beispiel von hier**](https://www.netadmintools.com/snmp-mib-and-oids/):

**`1 . 3 . 6 . 1 . 4 . 1 . 1452 . 1 . 2 . 5 . 1 . 3. 21 . 1 . 4 . 7`**

Hier ist eine Aufschl√ºsselung dieser Adresse.

* 1 ‚Äì dies wird als ISO bezeichnet und zeigt an, dass es sich um eine OID handelt. Deshalb beginnen alle OIDs mit "1"
* 3 ‚Äì dies wird als ORG bezeichnet und wird verwendet, um die Organisation anzugeben, die das Ger√§t gebaut hat.
* 6 ‚Äì dies ist das dod oder das Verteidigungsministerium, das die Internetverbindung als erstes etabliert hat.
* 1 ‚Äì dies ist der Wert des Internets, um anzugeben, dass alle Kommunikationen √ºber das Internet erfolgen.
* 4 ‚Äì dieser Wert bestimmt, dass dieses Ger√§t von einer privaten Organisation und nicht von einer Regierungsorganisation hergestellt wurde.
* 1 ‚Äì dieser Wert zeigt an, dass das Ger√§t von einem Unternehmen oder einer Gesch√§ftseinheit hergestellt wurde.

Diese ersten sechs Werte sind f√ºr alle Ger√§te tendenziell gleich und geben grundlegende Informationen √ºber sie. Diese Zahlenfolge wird f√ºr alle OIDs gleich sein, au√üer wenn das Ger√§t von der Regierung hergestellt wurde.

√úbergehen zu den n√§chsten Zahlen.

* 1452 ‚Äì gibt den Namen der Organisation an, die dieses Ger√§t hergestellt hat.
* 1 ‚Äì erl√§utert den Ger√§tetyp. In diesem Fall handelt es sich um einen Wecker.
* 2 ‚Äì bestimmt, dass dieses Ger√§t eine Fernmeldeeinheit ist.

Die restlichen Werte geben spezifische Informationen √ºber das Ger√§t.

* 5 ‚Äì kennzeichnet einen diskreten Alarm-Punkt.
* 1 ‚Äì spezifischer Punkt im Ger√§t
* 3 ‚Äì Port
* 21 ‚Äì Portadresse
* 1 ‚Äì Anzeige f√ºr den Port
* 4 ‚Äì Punktnummer
* 7 ‚Äì Zustand des Punktes

### SNMP-Versionen

Es gibt 2 wichtige Versionen von SNMP:

* **SNMPv1**: Die Hauptversion, sie ist immer noch die h√§ufigste, die **Authentifizierung basiert auf einem String** (Community-String), der im **Klartext √ºbertragen wird** (alle Informationen werden im Klartext √ºbertragen). **Version 2 und 2c** senden den **Datenverkehr ebenfalls im Klartext** und verwenden einen **Community-String zur Authentifizierung**.
* **SNMPv3**: Verwendet eine bessere **Authentifizierungsform** und die Informationen werden **verschl√ºsselt √ºbertragen** (ein **W√∂rterbuchangriff** k√∂nnte durchgef√ºhrt werden, w√§re jedoch viel schwieriger, die richtigen Anmeldeinformationen zu finden als bei SNMPv1 und v2).

### Community-Strings

Wie bereits erw√§hnt, **um auf die im MIB gespeicherten Informationen zuzugreifen, m√ºssen Sie den Community-String in den Versionen 1 und 2/2c kennen und die Anmeldeinformationen in Version 3**.\
Es gibt **2 Arten von Community-Strings**:

* **`public`** haupts√§chlich **nur-Lese-Funktionen**
* **`private`** **Lese-/Schreibzugriff** im Allgemeinen

Beachten Sie, dass **die Schreibbarkeit einer OID vom verwendeten Community-String abh√§ngt**, sodass **selbst** wenn festgestellt wird, dass "**public**" verwendet wird, Sie m√∂glicherweise in der Lage sind, **einige Werte zu schreiben**. Es **k√∂nnen auch Objekte existieren, die immer "Nur Lesen" sind**.\
Wenn Sie versuchen, ein Objekt zu **schreiben**, wird ein **`noSuchName`- oder `readOnly`-Fehler** empfangen\*\*.\*\*

In den Versionen 1 und 2/2c, wenn Sie einen **falschen** Community-String verwenden, antwortet der Server nicht. Wenn er antwortet, wurde ein **g√ºltiger Community-String verwendet**.

## Ports

[Aus Wikipedia](https://en.wikipedia.org/wiki/Simple\_Network\_Management\_Protocol):

* Der SNMP-Agent empf√§ngt Anfragen auf UDP-Port **161**.
* Der Manager empf√§ngt Benachrichtigungen ([Traps](https://en.wikipedia.org/wiki/Simple\_Network\_Management\_Protocol#Trap) und [InformRequests](https://en.wikipedia.org/wiki/Simple\_Network\_Management\_Protocol#InformRequest)) auf Port **162**.
* Bei Verwendung von [Transport Layer Security](https://en.wikipedia.org/wiki/Transport\_Layer\_Security) oder [Datagram Transport Layer Security](https://en.wikipedia.org/wiki/Datagram\_Transport\_Layer\_Security) werden Anfragen auf Port **10161** empfangen und Benachrichtigungen werden an Port **10162** gesendet.

## Brute-Force Community-String (v1 und v2c)

Um den Community-String zu **erraten**, k√∂nnten Sie einen W√∂rterbuchangriff durchf√ºhren. √úberpr√ºfen Sie [hier verschiedene M√∂glichkeiten, einen Brute-Force-Angriff gegen SNMP durchzuf√ºhren](../../generic-methodologies-and-resources/brute-force.md#snmp). Ein h√§ufig verwendeter Community-String ist `public`.

## SNMP aufz√§hlen

Es wird empfohlen, die folgenden zu installieren, um zu sehen, was **jede gesammelte OID** vom Ger√§t bedeutet:
```bash
apt-get install snmp-mibs-downloader
download-mibs
# Finally comment the line saying "mibs :" in /etc/snmp/snmp.conf
sudo vi /etc/snmp/snmp.conf
```
Wenn Sie √ºber eine g√ºltige Community-String verf√ºgen, k√∂nnen Sie auf die Daten mit **SNMPWalk** oder **SNMP-Check** zugreifen:
```bash
snmpbulkwalk -c [COMM_STRING] -v [VERSION] [IP] . #Don't forget the final dot
snmpbulkwalk -c public -v2c 10.10.11.136 .

snmpwalk -v [VERSION_SNMP] -c [COMM_STRING] [DIR_IP]
snmpwalk -v [VERSION_SNMP] -c [COMM_STRING] [DIR_IP] 1.3.6.1.2.1.4.34.1.3 #Get IPv6, needed dec2hex
snmpwalk -v [VERSION_SNMP] -c [COMM_STRING] [DIR_IP] NET-SNMP-EXTEND-MIB::nsExtendObjects #get extended
snmpwalk -v [VERSION_SNMP] -c [COMM_STRING] [DIR_IP] .1 #Enum all

snmp-check [DIR_IP] -p [PORT] -c [COMM_STRING]

nmap --script "snmp* and not snmp-brute" <target>

braa <community string>@<IP>:.1.3.6.* #Bruteforce specific OID
```
Dank erweiterter Abfragen (download-mibs) ist es m√∂glich, noch mehr √ºber das System mit dem folgenden Befehl aufzulisten:
```bash
snmpwalk -v X -c public <IP> NET-SNMP-EXTEND-MIB::nsExtendOutputFull
```
**SNMP** enth√§lt viele Informationen √ºber den Host, darunter **Netzwerkschnittstellen** (IPv4- und **IPv6-Adresse**), Benutzernamen, Betriebszeit, Server-/Betriebssystemversion und **laufende Prozesse** (k√∂nnen Passw√∂rter enthalten)....

### **Gef√§hrliche Einstellungen**

Im Bereich des Netzwerkmanagements sind bestimmte Konfigurationen und Parameter entscheidend f√ºr eine umfassende √úberwachung und Steuerung.

### Zugriffseinstellungen

Zwei Hauptkonfigurationen erm√∂glichen den Zugriff auf den **vollen OID-Baum**, der ein wesentlicher Bestandteil des Netzwerkmanagements ist:

1. **`rwuser noauth`** ist so eingestellt, dass voller Zugriff auf den OID-Baum ohne Authentifizierung m√∂glich ist. Diese Einstellung ist unkompliziert und erm√∂glicht uneingeschr√§nkten Zugriff.
2. F√ºr eine spezifischere Steuerung kann der Zugriff gew√§hrt werden durch:
* **`rwcommunity`** f√ºr **IPv4**-Adressen und
* **`rwcommunity6`** f√ºr **IPv6**-Adressen.

Beide Befehle erfordern eine **Community-String** und die entsprechende IP-Adresse und bieten vollen Zugriff unabh√§ngig vom Ursprung der Anfrage.

### SNMP-Parameter f√ºr Microsoft Windows

Eine Reihe von **Management Information Base (MIB)-Werten** wird verwendet, um verschiedene Aspekte eines Windows-Systems √ºber SNMP zu √ºberwachen:

* **Systemprozesse**: √úber `1.3.6.1.2.1.25.1.6.0` k√∂nnen aktive Prozesse im System √ºberwacht werden.
* **Laufende Programme**: Der Wert `1.3.6.1.2.1.25.4.2.1.2` ist f√ºr die Verfolgung der aktuell laufenden Programme vorgesehen.
* **Prozesspfad**: Zur Bestimmung des Speicherorts eines Prozesses wird der MIB-Wert `1.3.6.1.2.1.25.4.2.1.4` verwendet.
* **Speichereinheiten**: Die √úberwachung von Speichereinheiten wird durch `1.3.6.1.2.1.25.2.3.1.4` erleichtert.
* **Softwarename**: Zur Identifizierung der auf einem System installierten Software wird `1.3.6.1.2.1.25.6.3.1.2` verwendet.
* **Benutzerkonten**: Der Wert `1.3.6.1.4.1.77.1.2.25` erm√∂glicht die Verfolgung von Benutzerkonten.
* **TCP-Local-Ports**: Schlie√ülich ist `1.3.6.1.2.1.6.13.1.3` f√ºr die √úberwachung von TCP-Local-Ports vorgesehen und bietet Einblicke in aktive Netzwerkverbindungen.

### Cisco

Werfen Sie einen Blick auf diese Seite, wenn Sie Cisco-Ger√§te verwenden:

{% content-ref url="cisco-snmp.md" %}
[cisco-snmp.md](cisco-snmp.md)
{% endcontent-ref %}

## Vom SNMP zum RCE

Wenn Sie den **String** haben, der es Ihnen erm√∂glicht, **Werte im SNMP-Dienst zu schreiben**, k√∂nnten Sie ihn missbrauchen, um **Befehle auszuf√ºhren**:

{% content-ref url="snmp-rce.md" %}
[snmp-rce.md](snmp-rce.md)
{% endcontent-ref %}

## **Massive SNMP**

[Braa ](https://github.com/mteg/braa)ist ein massiver SNMP-Scanner. Die beabsichtigte Verwendung eines solchen Tools besteht nat√ºrlich darin, SNMP-Abfragen durchzuf√ºhren - im Gegensatz zu snmpwalk von net-snmp kann es jedoch Dutzende oder Hunderte von Hosts gleichzeitig und in einem einzigen Prozess abfragen. Dadurch verbraucht es sehr wenige Systemressourcen und f√ºhrt das Scannen SEHR schnell durch.

Braa implementiert seinen EIGENEN SNMP-Stack, daher ben√∂tigt es KEINE SNMP-Bibliotheken wie net-snmp.

**Syntax:** braa \[Community-String]@\[IP des SNMP-Servers]:\[ISO-ID]
```bash
braa ignite123@192.168.1.125:.1.3.6.*
```
Dies kann eine gro√üe Menge an Informationen extrahieren, die Sie manuell nicht verarbeiten k√∂nnen.

Also, lassen Sie uns nach den interessantesten Informationen suchen (von [https://blog.rapid7.com/2016/05/05/snmp-data-harvesting-during-penetration-testing/](https://blog.rapid7.com/2016/05/05/snmp-data-harvesting-during-penetration-testing/)):

### **Ger√§te**

Der Prozess beginnt mit der Extraktion von **sysDesc MIB-Daten** (1.3.6.1.2.1.1.1.0) aus jeder Datei, um die Ger√§te zu identifizieren. Dies wird durch die Verwendung eines **grep-Befehls** erreicht:
```bash
grep ".1.3.6.1.2.1.1.1.0" *.snmp
```
### **Identifizieren des privaten Strings**

Ein entscheidender Schritt besteht darin, den **privaten Community-String** zu identifizieren, den Organisationen verwenden, insbesondere bei Cisco IOS-Routern. Dieser String erm√∂glicht das Extrahieren von **laufenden Konfigurationen** von Routern. Die Identifizierung beruht oft auf der Analyse von SNMP-Trap-Daten nach dem Wort "trap" mit einem **grep-Befehl**:
```bash
grep -i "trap" *.snmp
```
### **Benutzernamen/Passw√∂rter**

Protokolle, die in MIB-Tabellen gespeichert sind, werden auf **fehlgeschlagene Anmeldeversuche** √ºberpr√ºft, die versehentlich Passw√∂rter enthalten k√∂nnten, die als Benutzernamen eingegeben wurden. Schl√ºsselw√∂rter wie _fail_, _failed_ oder _login_ werden durchsucht, um wertvolle Daten zu finden:
```bash
grep -i "login\|fail" *.snmp
```
### **E-Mails**

Abschlie√üend wird zur Extraktion von **E-Mail-Adressen** aus den Daten ein **grep-Befehl** mit einem regul√§ren Ausdruck verwendet, der sich auf Muster konzentriert, die E-Mail-Formate entsprechen:
```bash
grep -E -o "\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,6}\b" *.snmp
```
## √Ñndern von SNMP-Werten

Sie k√∂nnen _**NetScanTools**_ verwenden, um **Werte zu √§ndern**. Sie m√ºssen den **privaten String** kennen, um dies zu tun.

## Spoofing

Wenn es eine ACL gibt, die nur bestimmten IPs das Abfragen des SMNP-Dienstes erlaubt, k√∂nnen Sie eine dieser Adressen im UDP-Paket f√§lschen und den Datenverkehr abfangen.

## √úberpr√ºfen von SNMP-Konfigurationsdateien

* snmp.conf
* snmpd.conf
* snmp-config.xml

<figure><img src="../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

Wenn Sie an einer **Hackerkarriere** interessiert sind und das Unhackbare hacken m√∂chten - **wir stellen ein!** (_flie√üendes Polnisch in Wort und Schrift erforderlich_).

{% embed url="https://www.stmcyber.com/careers" %}

## HackTricks Automatische Befehle
```
Protocol_Name: SNMP    #Protocol Abbreviation if there is one.
Port_Number:  161     #Comma separated if there is more than one.
Protocol_Description: Simple Network Managment Protocol         #Protocol Abbreviation Spelled out

Entry_1:
Name: Notes
Description: Notes for SNMP
Note: |
SNMP - Simple Network Management Protocol is a protocol used to monitor different devices in the network (like routers, switches, printers, IoTs...).

https://book.hacktricks.xyz/pentesting/pentesting-snmp

Entry_2:
Name: SNMP Check
Description: Enumerate SNMP
Command: snmp-check {IP}

Entry_3:
Name: OneSixtyOne
Description: Crack SNMP passwords
Command: onesixtyone -c /usr/share/seclists/Discovery/SNMP/common-snmp-community-strings-onesixtyone.txt {IP} -w 100

Entry_4:
Name: Nmap
Description: Nmap snmp (no brute)
Command: nmap --script "snmp* and not snmp-brute" {IP}

Entry_5:
Name: Hydra Brute Force
Description: Need Nothing
Command: hydra -P {Big_Passwordlist} -v {IP} snmp


```
<details>

<summary><strong>Erlernen Sie AWS-Hacking von Null auf Held mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks beworben sehen m√∂chten** oder **HackTricks als PDF herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merch**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) Github-Repositories einreichen.

</details>
