# 161,162,10161,10162/udp - Pentesting SNMP

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Voc√™ trabalha em uma **empresa de seguran√ßa cibern√©tica**? Voc√™ quer ver sua **empresa anunciada no HackTricks**? ou voc√™ quer ter acesso √† **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**? Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* **Junte-se ao** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para o** [**reposit√≥rio hacktricks**](https://github.com/carlospolop/hacktricks) **e para o** [**reposit√≥rio hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

<img src="../../.gitbook/assets/i3.png" alt="" data-size="original">\
**Dica de bug bounty**: **inscreva-se** no **Intigriti**, uma plataforma premium de **bug bounty criada por hackers, para hackers**! Junte-se a n√≥s em [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) hoje e comece a ganhar recompensas de at√© **$100.000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

## Informa√ß√µes B√°sicas

**SNMP - Simple Network Management Protocol** √© um protocolo usado para monitorar diferentes dispositivos na rede (como roteadores, switches, impressoras, IoTs...).
```
PORT    STATE SERVICE REASON                 VERSION
161/udp open  snmp    udp-response ttl 244   ciscoSystems SNMPv3 server (public)
```
{% hint style="info" %}
O SNMP tamb√©m usa a porta **162/UDP** para **traps**. Estes s√£o **pacotes de dados enviados do servidor SNMP para o cliente sem serem explicitamente solicitados**.
{% endhint %}

### MIB

Para garantir que o acesso SNMP funcione em diferentes fabricantes e com diferentes combina√ß√µes cliente-servidor, foi criada a **Base de Informa√ß√µes de Gerenciamento (MIB)**. A MIB √© um **formato independente para armazenar informa√ß√µes do dispositivo**. Uma MIB √© um **arquivo de texto** no qual todos os **objetos SNMP consult√°veis** de um dispositivo s√£o listados em uma hierarquia de √°rvore **padronizada**. Ele cont√©m pelo menos um `Object Identifier` (`OID`), que, al√©m do **endere√ßo exclusivo** necess√°rio e um **nome**, tamb√©m fornece informa√ß√µes sobre o tipo, direitos de acesso e uma descri√ß√£o do respectivo objeto.\
Os arquivos MIB s√£o escritos no formato de texto ASCII baseado em `Abstract Syntax Notation One` (`ASN.1`). As **MIBs n√£o cont√™m dados**, mas explicam **onde encontrar quais informa√ß√µes** e como elas se parecem, o que retorna valores para o OID espec√≠fico ou qual tipo de dados √© usado.

### OIDs

**OIDs** significa **Identificadores de Objeto**. **OIDs identificam exclusivamente objetos gerenciados em uma hierarquia MIB**. Isso pode ser representado como uma √°rvore, cujos n√≠veis s√£o atribu√≠dos por diferentes organiza√ß√µes. Os IDs de objeto MIB de n√≠vel superior (OIDs) pertencem a diferentes organiza√ß√µes padr√£o.\
Os fornecedores definem ramos privados incluindo objetos gerenciados para seus pr√≥prios produtos.

![](../../.gitbook/assets/snmp_oid_mib_tree.png)

Voc√™ pode **navegar** por uma **√°rvore OID** na web aqui: [http://www.oid-info.com/cgi-bin/display?tree=#focus](http://www.oid-info.com/cgi-bin/display?tree=#focus) ou **ver o que um OID significa** (como `1.3.6.1.2.1.1`) acessando [http://oid-info.com/get/1.3.6.1.2.1.1](http://oid-info.com/get/1.3.6.1.2.1.1).\
Existem alguns **OIDs bem conhecidos** como os que est√£o dentro de [1.3.6.1.2.1](http://oid-info.com/get/1.3.6.1.2.1) que se referem a vari√°veis SNMP definidas pelo MIB-2. E a partir dos **OIDs pendentes deste**, voc√™ pode obter alguns dados interessantes do host (dados do sistema, dados de rede, dados de processos...)

### **Exemplo de OID**

**`1 . 3 . 6 . 1 . 4 . 1 . 1452 . 1 . 2 . 5 . 1 . 3. 21 . 1 . 4 . 7`**

Aqui est√° uma quebra deste endere√ßo.

* 1 - isso √© chamado de ISO e estabelece que este √© um OID. √â por isso que todos os OIDs come√ßam com "1"
* 3 - isso √© chamado de ORG e √© usado para especificar a organiza√ß√£o que construiu o dispositivo.
* 6 - este √© o dod ou o Departamento de Defesa, que √© a organiza√ß√£o que estabeleceu a Internet primeiro.
* 1 - este √© o valor da Internet para denotar que todas as comunica√ß√µes acontecer√£o atrav√©s da Internet.
* 4 - este valor determina que este dispositivo √© feito por uma organiza√ß√£o privada e n√£o governamental.
* 1 - este valor denota que o dispositivo √© feito por uma empresa ou entidade comercial.

Esses seis primeiros valores tendem a ser os mesmos para todos os dispositivos e fornecem informa√ß√µes b√°sicas sobre eles. Esta sequ√™ncia de n√∫meros ser√° a mesma para todos os OIDs, exceto quando o dispositivo √© feito pelo governo.

Passando para o pr√≥ximo conjunto de n√∫meros.

* 1452 - d√° o nome da organiza√ß√£o que fabricou este dispositivo.
* 1 - explica o tipo de dispositivo. Neste caso, √© um despertador.
* 2 - determina que este dispositivo √© uma unidade de terminal remoto.

O restante dos valores fornece informa√ß√µes espec√≠ficas sobre o dispositivo.

* 5 - denota um ponto de alarme discreto.
* 1 - ponto espec√≠fico no dispositivo
* 3 - porta
* 21 - endere√ßo da porta
* 1 - exibi√ß√£o para a porta
* 4 - n√∫mero do ponto
* 7 - estado do ponto

_**(Exemplo retirado da**_ [_**qui**_](https://www.netadmintools.com/snmp-mib-and-oids)_**)**_

### Vers√µes SNMP

Existem 2 vers√µes importantes do SNMP:

* **SNMPv1**: Principal, ainda √© o mais frequente, a **autentica√ß√£o √© baseada em uma string** (string da comunidade) que viaja em **texto simples** (todas as informa√ß√µes viajam em texto simples). **Vers√£o 2 e 2c** enviam o **tr√°fego em texto simples** tamb√©m e usam uma **string da comunidade como autentica√ß√£o**.
* **SNMPv3**: Usa uma melhor forma de **autentica√ß√£o** e as informa√ß√µes viajam **criptografadas** (um **ataque de dicion√°rio** poderia ser realizado, mas seria muito mais dif√≠cil encontrar as credenciais corretas do que no SNMPv1 e v2).

### Strings da Comunidade

Como mencionado antes, **para acessar as informa√ß√µes salvas no MIB, voc√™ precisa saber a string da comunidade nas vers√µes 1 e 2/2c e as credenciais na vers√£o 3.**\
Existem **2 tipos de strings da comunidade**:

* **`public`** principalmente fun√ß√µes **somente leitura**
* **`private`** **Leitura/Grava√ß√£o** em geral

Observe que **a capacidade de escrita de um OID depende da string da comunidade usada**, ent√£o **mesmo** se voc√™ descobrir que est√° sendo usada a string "**public**", voc√™ pode ser capaz de **escrever alguns valores**. Al√©m disso, **podem existir objetos que s√£o sempre "Somente Leitura".**\
Se voc√™ tentar **escrever** um objeto, receber√° um erro **`noSuchName` ou `readOnly`**.

Nas vers√µes 1 e 2/2c, se voc√™ usar uma string da comunidade **inv√°lida**, o servidor n√£o **responder√°**. Portanto, se ele responder, uma **string da comunidade v√°lida foi usada**.

## Portas

* O agente SNMP recebe solicita√ß√µes na porta UDP **161**.
* O gerenciador recebe notifica√ß√µes ([Traps](https://en.wikipedia.org/wiki/Simple\_Network\_Management\_Protocol#Trap) e [InformRequests](https://en.wikipedia.org/wiki/Simple\_Network\_Management\_Protocol#InformRequest)) na porta **162**.
* Quando usado com [Transport Layer Security](https://en.wikipedia.org/wiki/Transport\_Layer\_Security) ou [Datagram Transport Layer Security](https://en.wikipedia.org/wiki/Datagram\_Transport\_Layer\_Security), as solicita√ß√µes s√£o recebidas na porta **10161** e as notifica√ß√µes s√£o enviadas para a porta **10162**.

## For√ßa Bruta de Strings da Comunidade (v1 e v2c)

Para **adivinhar a string da comunidade**, voc√™ pode realizar um ataque de dicion√°rio. Verifique [aqui diferentes maneiras de realizar um ataque de for√ßa bruta contra SNMP](../../generic-methodologies-and-resources/brute-force.md#snmp). Uma string da comunidade frequentemente usada √© `public`.

## Enumerando SNMP

√â recomendado instalar o seguinte para ver o que significa **cada OID coletado** do dispositivo:
```bash
apt-get install snmp-mibs-downloader
download-mibs
# Finally comment the line saying "mibs :" in /etc/snmp/snmp.conf
sudo vi /etc/snmp/snmp.conf
```
Se voc√™ conhece uma string de comunidade v√°lida, pode acessar os dados usando **SNMPWalk** ou **SNMP-Check**:
```bash
snmpbulkwalk -c [COMM_STRING] -v [VERSION] [IP] . #Don't forget the final dot
snmpbulkwalk -c public -v2c 10.10.11.136 .

snmpwalk -v [VERSION_SNMP] -c [COMM_STRING] [DIR_IP]
snmpwalk -v [VERSION_SNMP] -c [COMM_STRING] [DIR_IP] 1.3.6.1.2.1.4.34.1.3 #Get IPv6, needed dec2hex
snmpwalk -v [VERSION_SNMP] -c [COMM_STRING] [DIR_IP] NET-SNMP-EXTEND-MIB::nsExtendObjects #get extended
snmpwalk -v [VERSION_SNMP] -c [COMM_STRING] [DIR_IP] .1 #Enum all

snmp-check [DIR_IP] -p [PORT] -c [COMM_STRING]

nmap --script "snmp* and not snmp-brute" <target>

braa <community string>@<IP>:.1.3.6.* #Bruteforce specific OID
```
Gra√ßas √†s consultas estendidas (download-mibs), √© poss√≠vel enumerar ainda mais informa√ß√µes sobre o sistema com o seguinte comando:
```bash
snmpwalk -v X -c public <IP> NET-SNMP-EXTEND-MIB::nsExtendOutputFull
```
O SNMP tem muitas informa√ß√µes sobre o host e coisas que voc√™ pode achar interessante s√£o: interfaces de rede (endere√ßo IPv4 e IPv6), nomes de usu√°rio, tempo de atividade, vers√£o do servidor/SO e processos em execu√ß√£o (podem conter senhas)...

### Configura√ß√µes perigosas

De [https://academy.hackthebox.com/module/112/section/1075](https://academy.hackthebox.com/module/112/section/1075)

| Configura√ß√µes | Descri√ß√£o |
| --- | --- |
| `rwuser noauth` | Fornece acesso √† √°rvore OID completa sem autentica√ß√£o. |
| `rwcommunity <community string> <IPv4 address>` | Fornece acesso √† √°rvore OID completa independentemente de onde as solicita√ß√µes foram enviadas. |
| `rwcommunity6 <community string> <IPv6 address>` | Mesmo acesso que com `rwcommunity` com a diferen√ßa de usar IPv6. |

### Cisco

D√™ uma olhada nesta p√°gina se voc√™ estiver usando equipamentos Cisco:

{% content-ref url="cisco-snmp.md" %}
[cisco-snmp.md](cisco-snmp.md)
{% endcontent-ref %}

## Do SNMP para RCE

Se voc√™ tiver a **string** que permite que voc√™ **escreva valores** dentro do servi√ßo SNMP, poder√° abusar dela para **executar comandos**:

{% content-ref url="snmp-rce.md" %}
[snmp-rce.md](snmp-rce.md)
{% endcontent-ref %}

## SNMP em massa

[Braa](https://github.com/mteg/braa) √© um scanner SNMP em massa. O uso pretendido de tal ferramenta √©, √© claro, fazer consultas SNMP - mas, ao contr√°rio do snmpwalk do net-snmp, ele √© capaz de consultar dezenas ou centenas de hosts simultaneamente e em um √∫nico processo. Assim, consome muito poucos recursos do sistema e faz a varredura MUITO rapidamente.

Braa implementa sua PR√ìPRIA pilha SNMP, portanto, N√ÉO precisa de bibliotecas SNMP como net-snmp.

**Sintaxe:** braa \[Community-string]@\[IP do servidor SNMP]:\[iso id]
```
braa ignite123@192.168.1.125:.1.3.6.*
```
Isso pode extrair muitos MB de informa√ß√µes que voc√™ n√£o pode processar manualmente.

Ent√£o, vamos procurar as informa√ß√µes mais interessantes (de [https://blog.rapid7.com/2016/05/05/snmp-data-harvesting-during-penetration-testing/](https://blog.rapid7.com/2016/05/05/snmp-data-harvesting-during-penetration-testing/)):

### Dispositivos

Uma das primeiras coisas que fa√ßo √© extrair os dados MIB sysDesc .1.3.6.1.2.1.1.1.0 de cada arquivo para determinar de quais dispositivos eu coletei informa√ß√µes. Isso pode ser facilmente feito usando o seguinte comando grep:
```
grep ".1.3.6.1.2.1.1.1.0" *.snmp
```
### Identificar string privada

Como exemplo, se eu puder identificar a string de comunidade privada usada por uma organiza√ß√£o em seus roteadores Cisco IOS, ent√£o eu poderia possivelmente usar essa string de comunidade para extrair as configura√ß√µes em execu√ß√£o desses roteadores. O melhor m√©todo para encontrar esses dados geralmente est√° relacionado aos dados de armadilha SNMP. Ent√£o, novamente, usando o seguinte grep, podemos analisar rapidamente muitos dados MIB procurando a palavra-chave "trap":
```bash
grep -i "trap" *.snmp
```
### Nomes de usu√°rio/senhas

Outra √°rea de interesse s√£o os logs, descobri que existem alguns dispositivos que mant√™m logs dentro das tabelas MIB. Esses logs tamb√©m podem conter tentativas de login falhas. Pense na √∫ltima vez que voc√™ fez login em um dispositivo via Telnet ou SSH e inadvertidamente digitou sua senha como nome de usu√°rio. Normalmente, procuro por palavras-chave como _fail_, _failed_ ou _login_ e examino esses dados para ver se h√° algo de valor.
```bash
grep -i "login\|fail" *.snmp
```
### Emails

E-mails s√£o uma fonte valiosa de informa√ß√µes para um atacante. Eles podem conter senhas, informa√ß√µes de contato, informa√ß√µes financeiras e muito mais. √â importante verificar se h√° vazamentos de e-mails de uma organiza√ß√£o-alvo e tentar obter acesso a contas de e-mail relevantes.

Algumas t√©cnicas comuns para obter acesso a contas de e-mail incluem phishing, engenharia social e explora√ß√£o de vulnerabilidades em clientes de e-mail. Uma vez que o acesso √† conta de e-mail √© obtido, o atacante pode usar a conta para enviar e-mails maliciosos, acessar outras contas vinculadas e obter mais informa√ß√µes confidenciais.

Para evitar vazamentos de e-mails, √© importante que as organiza√ß√µes implementem medidas de seguran√ßa, como autentica√ß√£o de dois fatores, criptografia de e-mail e treinamento de conscientiza√ß√£o de seguran√ßa para funcion√°rios. Al√©m disso, √© importante monitorar regularmente a atividade de e-mail em busca de atividades suspeitas.
```bash
grep -E -o "\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,6}\b" *.snmp
```
## Modificando valores SNMP

Voc√™ pode usar o _**NetScanTools**_ para **modificar valores**. Voc√™ precisar√° saber a **string privada** para faz√™-lo.

## Spoofing

Se houver uma ACL que permita apenas alguns IPs a consultar o servi√ßo SMNP, voc√™ pode falsificar um desses endere√ßos dentro do pacote UDP e capturar o tr√°fego.

## Examinando arquivos de configura√ß√£o SNMP

* snmp.conf
* snmpd.conf
* snmp-config.xml

## Comandos Autom√°ticos do HackTricks
```
Protocol_Name: SNMP    #Protocol Abbreviation if there is one.
Port_Number:  161     #Comma separated if there is more than one.
Protocol_Description: Simple Network Managment Protocol         #Protocol Abbreviation Spelled out

Entry_1:
  Name: Notes
  Description: Notes for SNMP
  Note: |
    SNMP - Simple Network Management Protocol is a protocol used to monitor different devices in the network (like routers, switches, printers, IoTs...).

    https://book.hacktricks.xyz/pentesting/pentesting-snmp

Entry_2:
  Name: SNMP Check
  Description: Enumerate SNMP
  Command: snmp-check {IP}

Entry_3:
  Name: OneSixtyOne
  Description: Crack SNMP passwords
  Command: onesixtyone -c /usr/share/seclists/Discovery/SNMP/common-snmp-community-strings-onesixtyone.txt {IP} -w 100

Entry_4:
  Name: Nmap
  Description: Nmap snmp (no brute)
  Command: nmap --script "snmp* and not snmp-brute" {IP}

Entry_5:
  Name: Hydra Brute Force
  Description: Need Nothing
  Command: hydra -P {Big_Passwordlist} -v {IP} snmp
```
<img src="../../.gitbook/assets/i3.png" alt="" data-size="original">\
**Dica de recompensa por bugs**: **inscreva-se** no **Intigriti**, uma plataforma premium de recompensas por bugs criada por hackers, para hackers! Junte-se a n√≥s em [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) hoje mesmo e comece a ganhar recompensas de at√© **$100.000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Voc√™ trabalha em uma **empresa de seguran√ßa cibern√©tica**? Quer ver sua **empresa anunciada no HackTricks**? Ou quer ter acesso √† **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**? Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* **Junte-se ao** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para o** [**reposit√≥rio hacktricks**](https://github.com/carlospolop/hacktricks) **e para o** [**reposit√≥rio hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
