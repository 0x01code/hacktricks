# 161,162,10161,10162/udp - Pentesting SNMP

<details>

<summary><strong>Impara l'hacking di AWS da zero a eroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se vuoi vedere la tua **azienda pubblicizzata in HackTricks** o **scaricare HackTricks in PDF** Controlla i [**PACCHETTI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale di PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**The PEASS Family**](https://opensea.io/collection/the-peass-family), la nostra collezione di [**NFT esclusivi**](https://opensea.io/collection/the-peass-family)
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo Telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR a** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

<img src="../../.gitbook/assets/i3.png" alt="" data-size="original">\
**Suggerimento per bug bounty**: **registrati** su **Intigriti**, una piattaforma premium di **bug bounty creata da hacker, per hacker**! Unisciti a noi su [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) oggi stesso e inizia a guadagnare ricompense fino a **$100,000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

## Informazioni di base

**SNMP - Simple Network Management Protocol** √® un protocollo utilizzato per monitorare diversi dispositivi nella rete (come router, switch, stampanti, IoT...).
```
PORT    STATE SERVICE REASON                 VERSION
161/udp open  snmp    udp-response ttl 244   ciscoSystems SNMPv3 server (public)
```
{% hint style="info" %}
SNMP utilizza anche la porta **162/UDP** per le **traps**. Questi sono **pacchetti di dati inviati dal server SNMP al client senza essere esplicitamente richiesti**.
{% endhint %}

### MIB

Per garantire che l'accesso SNMP funzioni tra produttori diversi e con diverse combinazioni client-server, √® stato creato il **Management Information Base (MIB)**. MIB √® un **formato indipendente per memorizzare le informazioni del dispositivo**. Un MIB √® un **file di testo** in cui vengono elencati tutti gli **oggetti SNMP interrogabili** di un dispositivo in una gerarchia ad albero **standardizzata**. Contiene almeno un `Object Identifier` (`OID`), che, oltre all'**indirizzo univoco** necessario e a un **nome**, fornisce anche informazioni sul tipo, i diritti di accesso e una descrizione dell'oggetto corrispondente.\
I file MIB sono scritti nel formato di testo ASCII basato su `Abstract Syntax Notation One` (`ASN.1`). I **MIB non contengono dati**, ma spiegano **dove trovare quali informazioni** e come sono fatte, restituendo valori per l'OID specifico o quale tipo di dati viene utilizzato.

### OIDs

Gli **Object Identifier (OID)** svolgono un ruolo cruciale. Questi identificatori univoci sono progettati per gestire gli oggetti all'interno di un **Management Information Base (MIB)**.

I livelli pi√π alti degli ID degli oggetti MIB, o OIDs, sono assegnati a diverse organizzazioni che stabiliscono standard. √à all'interno di questi livelli superiori che viene stabilito il quadro per le pratiche e gli standard di gestione globale.

Inoltre, ai fornitori viene concessa la libert√† di creare rami privati. All'interno di questi rami, hanno **l'autonomia di includere oggetti gestiti pertinenti alle proprie linee di prodotto**. Questo sistema garantisce che ci sia un metodo strutturato e organizzato per identificare e gestire una vasta gamma di oggetti tra diversi fornitori e standard.

![](../../.gitbook/assets/snmp\_oid\_mib\_tree.png)

Puoi **navigare** attraverso un **albero OID** da qui: [http://www.oid-info.com/cgi-bin/display?tree=#focus](http://www.oid-info.com/cgi-bin/display?tree=#focus) o **vedere cosa significa un OID** (come `1.3.6.1.2.1.1`) accedendo a [http://oid-info.com/get/1.3.6.1.2.1.1](http://oid-info.com/get/1.3.6.1.2.1.1).\
Ci sono alcuni **OID ben noti** come quelli all'interno di [1.3.6.1.2.1](http://oid-info.com/get/1.3.6.1.2.1) che fa riferimento alle variabili SNMP definite da MIB-2. E dagli **OID in sospeso da questo** puoi ottenere alcuni dati interessanti sull'host (dati di sistema, dati di rete, dati dei processi...)

### **Esempio di OID**

[**Esempio da qui**](https://www.netadmintools.com/snmp-mib-and-oids/):

**`1 . 3 . 6 . 1 . 4 . 1 . 1452 . 1 . 2 . 5 . 1 . 3. 21 . 1 . 4 . 7`**

Ecco una scomposizione di questo indirizzo.

* 1 - questo viene chiamato ISO e stabilisce che si tratta di un OID. Per questo motivo tutti gli OID iniziano con "1"
* 3 - questo viene chiamato ORG ed √® utilizzato per specificare l'organizzazione che ha costruito il dispositivo.
* 6 - questo √® il dod o il Department of Defense, che √® l'organizzazione che ha stabilito per prima Internet.
* 1 - questo √® il valore di Internet per indicare che tutte le comunicazioni avverranno tramite Internet.
* 4 - questo valore determina che questo dispositivo √® realizzato da un'organizzazione privata e non governativa.
* 1 - questo valore indica che il dispositivo √® realizzato da un'azienda o da un'entit√† aziendale.

Questi primi sei valori tendono ad essere gli stessi per tutti i dispositivi e ti forniscono le informazioni di base su di essi. Questa sequenza di numeri sar√† la stessa per tutti gli OID, tranne quando il dispositivo √® realizzato dal governo.

Passando al set successivo di numeri.

* 1452 - fornisce il nome dell'organizzazione che ha prodotto questo dispositivo.
* 1 - spiega il tipo di dispositivo. In questo caso, si tratta di una sveglia.
* 2 - determina che questo dispositivo √® un'unit√† terminale remota.

Il resto dei valori fornisce informazioni specifiche sul dispositivo.

* 5 - indica un punto di allarme discreto.
* 1 - punto specifico nel dispositivo
* 3 - porta
* 21 - indirizzo della porta
* 1 - display per la porta
* 4 - numero del punto
* 7 - stato del punto

### Versioni SNMP

Ci sono 2 versioni importanti di SNMP:

* **SNMPv1**: La principale, √® ancora la pi√π frequente, l'**autenticazione si basa su una stringa** (community string) che viaggia in **plain-text** (tutte le informazioni viaggiano in plain text). **La versione 2 e 2c** inviano il **traffico in plain text** e utilizzano una **community string come autenticazione**.
* **SNMPv3**: Utilizza una forma di **autenticazione migliore** e le informazioni viaggiano **crittografate** (un **attacco a dizionario** potrebbe essere eseguito, ma sarebbe molto pi√π difficile trovare le credenziali corrette rispetto a SNMPv1 e v2).

### Community Strings

Come accennato in precedenza, **per accedere alle informazioni salvate nel MIB √® necessario conoscere la community string nelle versioni 1 e 2/2c e le credenziali nella versione 3.**\
Ci sono **2 tipi di community string**:

* **`public`** principalmente funzioni **solo lettura**
* **`private`** **Lettura/Scrittura** in generale

Si noti che **la scrivibilit√† di un OID dipende dalla community string utilizzata**, quindi **anche** se si scopre che viene utilizzata la stringa "**public**", potrebbe essere possibile **scrivere alcuni valori**. Inoltre, **potrebbero** esistere oggetti che sono **sempre "solo lettura"**.\
Se si prova a **scrivere** un oggetto, viene ricevuto un errore **`noSuchName` o `readOnly`**.

Nelle versioni 1 e 2/2c, se si utilizza una community string **errata**, il server non **risponder√†**. Quindi, se risponde, √® stata utilizzata una community string **valida**.

## Porte

[Da Wikipedia](https://en.wikipedia.org/wiki/Simple_Network_Management_Protocol#:~:text=All%20SNMP%20messages%20are%20transported,port%20161%20in%20the%20agent.):

* L'agente SNMP riceve le richieste sulla porta UDP **161**.
* Il manager riceve le notifiche ([Traps](https://en.wikipedia.org/wiki/Simple\_Network\_Management\_Protocol#Trap) e [InformRequests](https://en.wikipedia.org/wiki/Simple\_Network\_Management\_Protocol#InformRequest)) sulla porta **162**.
* Quando utilizzato con [Transport Layer Security](https://en.wikipedia.org/wiki/Transport\_Layer\_Security) o [Datagram Transport Layer Security](https://en.wikipedia.org/wiki/Datagram\_Transport\_Layer\_Security), le richieste vengono ricevute sulla porta **10161** e le notifiche vengono inviate alla porta **10162**.

## Brute-Force Community String (v1 e v2c)

Per **indovinare la community string** √® possibile eseguire un attacco a dizionario. Controlla [qui diversi modi per eseguire un attacco di forza bruta contro SNMP](../../generic-methodologies-and-resources/brute-force.md#snmp). Una community string spesso utilizzata √® `public`.
## Enumerazione SNMP

√à consigliato installare quanto segue per capire cosa significa **ogni OID raccolto** dal dispositivo:
```bash
apt-get install snmp-mibs-downloader
download-mibs
# Finally comment the line saying "mibs :" in /etc/snmp/snmp.conf
sudo vi /etc/snmp/snmp.conf
```
Se conosci una stringa di comunit√† valida, puoi accedere ai dati utilizzando **SNMPWalk** o **SNMP-Check**:
```bash
snmpbulkwalk -c [COMM_STRING] -v [VERSION] [IP] . #Don't forget the final dot
snmpbulkwalk -c public -v2c 10.10.11.136 .

snmpwalk -v [VERSION_SNMP] -c [COMM_STRING] [DIR_IP]
snmpwalk -v [VERSION_SNMP] -c [COMM_STRING] [DIR_IP] 1.3.6.1.2.1.4.34.1.3 #Get IPv6, needed dec2hex
snmpwalk -v [VERSION_SNMP] -c [COMM_STRING] [DIR_IP] NET-SNMP-EXTEND-MIB::nsExtendObjects #get extended
snmpwalk -v [VERSION_SNMP] -c [COMM_STRING] [DIR_IP] .1 #Enum all

snmp-check [DIR_IP] -p [PORT] -c [COMM_STRING]

nmap --script "snmp* and not snmp-brute" <target>

braa <community string>@<IP>:.1.3.6.* #Bruteforce specific OID
```
Grazie alle query estese (download-mibs), √® possibile enumerare ancora di pi√π sul sistema con il seguente comando:
```bash
snmpwalk -v X -c public <IP> NET-SNMP-EXTEND-MIB::nsExtendOutputFull
```
**SNMP** contiene molte informazioni sull'host e alcune cose interessanti che potresti trovare sono: **interfacce di rete** (indirizzo IPv4 e **IPv6**), nomi utente, tempo di attivit√†, versione del server/SO e **processi in esecuzione** (potrebbero contenere password)....

### **Impostazioni pericolose**

Nel campo della gestione di rete, alcune configurazioni e parametri sono fondamentali per garantire un monitoraggio e un controllo completi.

### Impostazioni di accesso

Due impostazioni principali consentono l'accesso all'**albero OID completo**, che √® un componente cruciale nella gestione di rete:

1. **`rwuser noauth`** √® impostato per consentire l'accesso completo all'albero OID senza la necessit√† di autenticazione. Questa impostazione √® semplice e consente un accesso illimitato.

2. Per un controllo pi√π specifico, l'accesso pu√≤ essere concesso utilizzando:
- **`rwcommunity`** per indirizzi **IPv4**, e
- **`rwcommunity6`** per indirizzi **IPv6**.

Entrambi i comandi richiedono una **stringa di comunit√†** e l'indirizzo IP pertinente, offrendo un accesso completo indipendentemente dall'origine della richiesta.

### Parametri SNMP per Microsoft Windows

Una serie di **valori di Management Information Base (MIB)** vengono utilizzati per monitorare vari aspetti di un sistema Windows tramite SNMP:

- **Processi di sistema**: Accessibile tramite `1.3.6.1.2.1.25.1.6.0`, questo parametro consente il monitoraggio dei processi attivi nel sistema.
- **Programmi in esecuzione**: Il valore `1.3.6.1.2.1.25.4.2.1.2` √® designato per il monitoraggio dei programmi attualmente in esecuzione.
- **Percorso dei processi**: Per determinare da dove viene eseguito un processo, viene utilizzato il valore MIB `1.3.6.1.2.1.25.4.2.1.4`.
- **Unit√† di archiviazione**: Il monitoraggio delle unit√† di archiviazione √® facilitato da `1.3.6.1.2.1.25.2.3.1.4`.
- **Nome del software**: Per identificare il software installato su un sistema, viene impiegato `1.3.6.1.2.1.25.6.3.1.2`.
- **Account utente**: Il valore `1.3.6.1.4.1.77.1.2.25` consente il monitoraggio degli account utente.
- **Porte locali TCP**: Infine, `1.3.6.1.2.1.6.13.1.3` √® designato per il monitoraggio delle porte TCP locali, fornendo informazioni sulle connessioni di rete attive.

### Cisco

Dai un'occhiata a questa pagina se hai attrezzature Cisco:

{% content-ref url="cisco-snmp.md" %}
[cisco-snmp.md](cisco-snmp.md)
{% endcontent-ref %}

## Da SNMP a RCE

Se hai la **stringa** che ti consente di **scrivere valori** all'interno del servizio SNMP, potresti essere in grado di abusarne per **eseguire comandi**:

{% content-ref url="snmp-rce.md" %}
[snmp-rce.md](snmp-rce.md)
{% endcontent-ref %}

## **SNMP massivo**

[Braa ](https://github.com/mteg/braa)√® uno scanner SNMP di massa. L'uso previsto di uno strumento del genere √®, ovviamente, effettuare query SNMP, ma a differenza di snmpwalk di net-snmp, √® in grado di interrogare decine o centinaia di host contemporaneamente e in un singolo processo. Pertanto, consuma pochissime risorse di sistema e effettua la scansione MOLTO velocemente.

Braa implementa la propria pila SNMP, quindi NON ha bisogno di librerie SNMP come net-snmp.

**Sintassi:** braa \[stringa di comunit√†]@\[IP del server SNMP]:\[ID iso]
```bash
braa ignite123@192.168.1.125:.1.3.6.*
```
Questo pu√≤ estrarre molte MB di informazioni che non puoi elaborare manualmente.


Quindi, cerchiamo le informazioni pi√π interessanti (da [https://blog.rapid7.com/2016/05/05/snmp-data-harvesting-during-penetration-testing/](https://blog.rapid7.com/2016/05/05/snmp-data-harvesting-during-penetration-testing/)):


### **Dispositivi**

Il processo inizia con l'estrazione dei dati **sysDesc MIB** (1.3.6.1.2.1.1.1.0) da ciascun file per identificare i dispositivi. Questo viene realizzato attraverso l'uso di un comando **grep**:
```bash
grep ".1.3.6.1.2.1.1.1.0" *.snmp
```
### **Identificare la stringa privata**

Un passaggio cruciale consiste nell'identificare la **stringa di comunit√† privata** utilizzata dalle organizzazioni, in particolare sui router Cisco IOS. Questa stringa consente l'estrazione delle **configurazioni in esecuzione** dai router. L'identificazione spesso si basa sull'analisi dei dati di SNMP Trap per la parola "trap" con un comando **grep**:
```bash
grep -i "trap" *.snmp
```
### **Nomi utente/Password**

Vengono esaminati i registri memorizzati nelle tabelle MIB per individuare **tentativi di accesso non riusciti**, che potrebbero includere accidentalmente password inserite come nomi utente. Vengono cercate parole chiave come _fail_, _failed_ o _login_ per trovare dati preziosi:
```bash
grep -i "login\|fail" *.snmp
```
### **Email**

Infine, per estrarre gli **indirizzi email** dai dati, viene utilizzato un **comando grep** con un'espressione regolare, concentrandosi su modelli che corrispondono ai formati email:
```bash
grep -E -o "\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,6}\b" *.snmp
```
## Modifica dei valori SNMP

Puoi utilizzare _**NetScanTools**_ per **modificare i valori**. Dovrai conoscere la **stringa privata** per poterlo fare.

## Spoofing

Se √® presente una ACL che consente solo a determinati indirizzi IP di interrogare il servizio SNMP, puoi falsificare uno di questi indirizzi all'interno del pacchetto UDP e intercettare il traffico.

## Esamina i file di configurazione SNMP

* snmp.conf
* snmpd.conf
* snmp-config.xml

## Comandi automatici di HackTricks
```
Protocol_Name: SNMP    #Protocol Abbreviation if there is one.
Port_Number:  161     #Comma separated if there is more than one.
Protocol_Description: Simple Network Managment Protocol         #Protocol Abbreviation Spelled out

Entry_1:
Name: Notes
Description: Notes for SNMP
Note: |
SNMP - Simple Network Management Protocol is a protocol used to monitor different devices in the network (like routers, switches, printers, IoTs...).

https://book.hacktricks.xyz/pentesting/pentesting-snmp

Entry_2:
Name: SNMP Check
Description: Enumerate SNMP
Command: snmp-check {IP}

Entry_3:
Name: OneSixtyOne
Description: Crack SNMP passwords
Command: onesixtyone -c /usr/share/seclists/Discovery/SNMP/common-snmp-community-strings-onesixtyone.txt {IP} -w 100

Entry_4:
Name: Nmap
Description: Nmap snmp (no brute)
Command: nmap --script "snmp* and not snmp-brute" {IP}

Entry_5:
Name: Hydra Brute Force
Description: Need Nothing
Command: hydra -P {Big_Passwordlist} -v {IP} snmp
```
<img src="../../.gitbook/assets/i3.png" alt="" data-size="original">\
**Suggerimento per bug bounty**: **iscriviti** a **Intigriti**, una piattaforma premium per bug bounty creata da hacker, per hacker! Unisciti a noi su [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) oggi stesso e inizia a guadagnare ricompense fino a **$100,000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

<details>

<summary><strong>Impara l'hacking di AWS da zero a eroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se vuoi vedere la tua **azienda pubblicizzata su HackTricks** o **scaricare HackTricks in PDF**, controlla i [**PACCHETTI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale di PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**The PEASS Family**](https://opensea.io/collection/the-peass-family), la nostra collezione di esclusive [**NFT**](https://opensea.io/collection/the-peass-family)
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo Telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR ai repository di** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) su GitHub.

</details>
