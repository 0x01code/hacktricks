# 161,162,10161,10162/udp - Ελεγκτική δοκιμή SNMP

<details>

<summary><strong>Μάθετε το χάκινγκ του AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι υποστήριξης του HackTricks:

* Αν θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**την Οικογένεια PEASS**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε στη** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στη [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Μοιραστείτε τα χάκινγκ κόλπα σας υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>

<img src="../../.gitbook/assets/i3.png" alt="" data-size="original">\
**Συμβουλή για bug bounty**: **εγγραφείτε** στο **Intigriti**, μια προηγμένη **πλατφόρμα bug bounty που δημιουργήθηκε από χάκερς, για χάκερς**! Γίνετε μέλος μας στο [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) σήμερα και αρχίστε να κερδίζετε αμοιβές έως και **$100,000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

## Βασικές Πληροφορίες

Το **SNMP - Simple Network Management Protocol** είναι ένα πρωτόκολλο που χρησιμοποιείται για την παρακολούθηση διάφορων συσκευών στο δίκτυο (όπως δρομολογητές, switch, εκτυπωτές, IoTs...).
```
PORT    STATE SERVICE REASON                 VERSION
161/udp open  snmp    udp-response ttl 244   ciscoSystems SNMPv3 server (public)
```
{% hint style="info" %}
Το SNMP χρησιμοποιεί επίσης τη θύρα **162/UDP** για **traps**. Αυτά είναι δεδομένα **πακέτα που στέλνονται από τον διακομιστή SNMP στον πελάτη χωρίς να ζητηθούν ρητά**.
{% endhint %}

### MIB

Για να εξασφαλιστεί ότι η πρόσβαση SNMP λειτουργεί σε διάφορους κατασκευαστές και με διάφορους συνδυασμούς πελάτη-διακομιστή, δημιουργήθηκε η **Βάση Πληροφοριών Διαχείρισης (MIB)**. Η MIB είναι ένα **ανεξάρτητο μορφότυπο για την αποθήκευση πληροφοριών συσκευής**. Μια MIB είναι ένα **κείμενο** αρχείο στο οποίο καταχωρούνται όλα τα ερωτήσιμα **αντικείμενα SNMP** μιας συσκευής σε μια **κανονικοποιημένη** ιεραρχία δέντρου. Περιέχει τουλάχιστον ένα `Αναγνωριστικό Αντικειμένου` (`OID`), το οποίο, εκτός από την απαραίτητη **μοναδική διεύθυνση** και ένα **όνομα**, παρέχει επίσης πληροφορίες σχετικά με τον τύπο, τα δικαιώματα πρόσβασης και μια περιγραφή του αντίστοιχου αντικειμένου.\
Τα αρχεία MIB γράφονται σε μορφή κειμένου ASCII βασισμένη στην `Αφηρημένη Σύνταξη Ένα` (`ASN.1`). Οι **MIB δεν περιέχουν δεδομένα**, αλλά εξηγούν **πού να βρείτε ποιες πληροφορίες** και πως φαίνονται, ποιες τιμές επιστρέφονται για το συγκεκριμένο OID, ή ποιος τύπος δεδομένων χρησιμοποιείται.

### OIDs

Τα **Αναγνωριστικά Αντικειμένων (OIDs)** παίζουν ένα κρίσιμο ρόλο. Αυτά τα μοναδικά αναγνωριστικά έχουν σχεδιαστεί για να διαχειρίζονται αντικείμενα εντός μιας **Βάσης Πληροφοριών Διαχείρισης (MIB)**.

Τα υψηλότερα επίπεδα των αναγνωριστικών αντικειμένων MIB, ή OIDs, ανατίθενται σε διάφορες οργανώσεις που θεσπίζουν πρότυπα. Είναι εντός αυτών των υψηλών επιπέδων που καθορίζεται το πλαίσιο για παγκόσμιες πρακτικές διαχείρισης και πρότυπα.

Επιπλέον, οι προμηθευτές έχουν την ελευθερία να δημιουργήσουν ιδιωτικά κλαδιά. Εντός αυτών των κλαδιών, έχουν την **αυτονομία να περιλαμβάνουν διαχειριζόμενα αντικείμενα που σχετίζονται με τις δικές τους γραμμές προϊόντων**. Αυτό το σύστημα εξασφαλίζει ότι υπάρχει μια δομημένη και οργανωμένη μέθοδος για την αναγνώριση και διαχείριση μιας ευρείας γκάμας αντικειμένων ανάμεσα σε διάφορους προμηθευτές και πρότυπα.

![](../../.gitbook/assets/snmp\_oid\_mib\_tree.png)

Μπορείτε να **περιηγηθείτε** μέσω ενός **δέντρου OID** από τον ιστότοπο εδώ: [http://www.oid-info.com/cgi-bin/display?tree=#focus](http://www.oid-info.com/cgi-bin/display?tree=#focus) ή **να δείτε τι σημαίνει ένα OID** (όπως `1.3.6.1.2.1.1`) προσπελαύνοντας [http://oid-info.com/get/1.3.6.1.2.1.1](http://oid-info.com/get/1.3.6.1.2.1.1).\
Υπάρχουν μερικά **γνωστά OIDs** όπως αυτά μέσα στο [1.3.6.1.2.1](http://oid-info.com/get/1.3.6.1.2.1) που αναφέρονται σε μεταβλητές πρωτοκόλλου απλής διαχείρισης δικτύου (SNMP) που έχουν καθοριστεί από το MIB-2. Και από τα **OIDs που εκκρεμούν από αυτό**, μπορείτε να αποκτήσετε ορισμένα ενδιαφέροντα δεδομένα κεντρικού υπολογιστή (δεδομένα συστήματος, δεδομένα δικτύου, δεδομένα διεργασιών...)

### **Παράδειγμα OID**

[**Παράδειγμα από εδώ**](https://www.netadmintools.com/snmp-mib-and-oids/):

**`1 . 3 . 6 . 1 . 4
## Απαρίθμηση SNMP

Συνιστάται να εγκαταστήσετε τα παρακάτω για να δείτε τι σημαίνει **κάθε OID που συλλέγεται** από τη συσκευή:
```bash
apt-get install snmp-mibs-downloader
download-mibs
# Finally comment the line saying "mibs :" in /etc/snmp/snmp.conf
sudo vi /etc/snmp/snmp.conf
```
Εάν γνωρίζετε ένα έγκυρο κοινό συμβολοσειράς, μπορείτε να αποκτήσετε πρόσβαση στα δεδομένα χρησιμοποιώντας τις εντολές **SNMPWalk** ή **SNMP-Check**:
```bash
snmpbulkwalk -c [COMM_STRING] -v [VERSION] [IP] . #Don't forget the final dot
snmpbulkwalk -c public -v2c 10.10.11.136 .

snmpwalk -v [VERSION_SNMP] -c [COMM_STRING] [DIR_IP]
snmpwalk -v [VERSION_SNMP] -c [COMM_STRING] [DIR_IP] 1.3.6.1.2.1.4.34.1.3 #Get IPv6, needed dec2hex
snmpwalk -v [VERSION_SNMP] -c [COMM_STRING] [DIR_IP] NET-SNMP-EXTEND-MIB::nsExtendObjects #get extended
snmpwalk -v [VERSION_SNMP] -c [COMM_STRING] [DIR_IP] .1 #Enum all

snmp-check [DIR_IP] -p [PORT] -c [COMM_STRING]

nmap --script "snmp* and not snmp-brute" <target>

braa <community string>@<IP>:.1.3.6.* #Bruteforce specific OID
```
Χάρη στα εκτεταμένα ερωτήματα (download-mibs), είναι δυνατό να απαριθμηθούν ακόμα περισσότερες πληροφορίες σχετικά με το σύστημα με την ακόλουθη εντολή:
```bash
snmpwalk -v X -c public <IP> NET-SNMP-EXTEND-MIB::nsExtendOutputFull
```
**SNMP** έχει πολλές πληροφορίες σχετικά με τον κεντρικό υπολογιστή και πράγματα που μπορεί να σας ενδιαφέρουν είναι: **Διεπαφές δικτύου** (διεύθυνση IPv4 και **IPv6**), Ονόματα χρηστών, Χρόνος λειτουργίας, Έκδοση διακομιστή/Λειτουργικού συστήματος και **διεργασίες** που εκτελούνται (μπορεί να περιέχουν κωδικούς πρόσβασης)....

### **Επικίνδυνες ρυθμίσεις**

Στον τομέα της διαχείρισης δικτύου, ορισμένες ρυθμίσεις και παράμετροι είναι καίριες για τη διασφάλιση ολοκληρωμένης παρακολούθησης και έλεγχου.

### Ρυθμίσεις πρόσβασης

Δύο κύριες ρυθμίσεις επιτρέπουν την πρόσβαση στο **πλήρες δέντρο OID**, το οποίο είναι ένα κρίσιμο στοιχείο στη διαχείριση δικτύου:

1. Η ρύθμιση **`rwuser noauth`** επιτρέπει την πλήρη πρόσβαση στο δέντρο OID χωρίς την ανάγκη για πιστοποίηση. Αυτή η ρύθμιση είναι απλή και επιτρέπει απεριόριστη πρόσβαση.

2. Για πιο συγκεκριμένο έλεγχο, μπορεί να γίνει παραχώρηση πρόσβασης χρησιμοποιώντας:
- **`rwcommunity`** για διευθύνσεις **IPv4**, και
- **`rwcommunity6`** για διευθύνσεις **IPv6**.

Και οι δύο εντολές απαιτούν ένα **κοινό συμβολοσειράς** και τη σχετική διεύθυνση IP, προσφέροντας πλήρη πρόσβαση ανεξάρτητα από την προέλευση του αιτήματος.

### Παράμετροι SNMP για τα Microsoft Windows

Μια σειρά από **τιμές βάσης πληροφοριών διαχείρισης (MIB)** χρησιμοποιούνται για την παρακολούθηση διάφορων πτυχών ενός συστήματος Windows μέσω SNMP:

- **Διεργασίες συστήματος**: Προσπελάσιμες μέσω `1.3.6.1.2.1.25.1.6.0`, αυτή η παράμετρος επιτρέπει την παρακολούθηση ενεργών διεργασιών στο σύστημα.
- **Τρέχοντα προγράμματα**: Η τιμή `1.3.6.1.2.1.25.4.2.1.2` ορίζεται για την παρακολούθηση προγραμμάτων που εκτελούνται αυτή τη στιγμή.
- **Διαδρομή διεργασιών**: Για να προσδιορίσετε από πού εκτελείται μια διεργασία, χρησιμοποιείται η τιμή MIB `1.3.6.1.2.1.25.4.2.1.4`.
- **Μονάδες αποθήκευσης**: Η παρακολούθηση μονάδων αποθήκευσης διευκολύνεται από το `1.3.6.1.2.1.25.2.3.1.4`.
- **Όνομα λογισμικού**: Για την αναγνώριση του λογισμικού που είναι εγκατεστημένο σε ένα σύστημα, χρησιμοποιείται το `1.3.6.1.2.1.25.6.3.1.2`.
- **Λογαριασμοί χρηστών**: Η τιμή `1.3.6.1.4.1.77.1.2.25` επιτρέπει την παρακολούθηση των λογαριασμών χρηστών.
- **Τοπικές θύρες TCP**: Τέλος, η τιμή `1.3.6.1.2.1.6.13.1.3` ορίζεται για την παρακολούθηση των τοπικών θυρών TCP, παρέχοντας πληροφορίες για ενεργές δικτυακές συνδέσεις.

### Cisco

Ρίξτε μια ματιά σε αυτήν τη σελίδα αν έχετε εξοπλισμό Cisco:

{% content-ref url="cisco-snmp.md" %}
[cisco-snmp.md](cisco-snmp.md)
{% endcontent-ref %}

## Από SNMP σε RCE

Αν έχετε το **string** που σας επιτρέπει να **γράψετε τιμές** μέσα στην υπηρεσία SNMP, μπορεί να είστε σε θέση να το καταχραστείτε για να **εκτελέσετε εντολές**:

{% content-ref url="snmp-rce.md" %}
[snmp-rce.md](snmp-rce.md)
{% endcontent-ref %}

## **Μαζικό SNMP**

Το [Braa](https://github.com/mteg/braa) είναι ένα εργαλείο μαζικής σάρωσης SNMP. Η προοριζόμενη χρήση ενός τέτοιου εργαλείου είναι, φυσικά, η πραγματοποίηση ερωτημάτων SNMP - αλλά αντίθετα με το snmpwalk από το net-snmp, είναι σε θέση να ερωτηθεί δεκάδες ή εκατοντάδες οικοδεσπότες ταυτόχρονα, και σε ένα μόνο διεργασία. Έτσι, καταναλώνει πολύ λίγους πόρους συστήματος και πραγματοποιεί τη σάρωση ΠΟΛΥ γρήγορα.

Το Braa υλοποιεί το δικό του στοίβα snmp, οπότε ΔΕΝ χρειάζεται καμία βιβλιοθήκη SNMP όπως το net-snmp.

**Σύνταξη:** braa \[Συμβολοσειρά κοινότητας]@\[IP του διακομιστή SNMP]:\[iso id]
```bash
braa ignite123@192.168.1.125:.1.3.6.*
```
Αυτό μπορεί να εξάγει πολλά MB πληροφοριών που δεν μπορείτε να επεξεργαστείτε χειροκίνητα.

Ας αναζητήσουμε λοιπόν τις πιο ενδιαφέρουσες πληροφορίες (από [https://blog.rapid7.com/2016/05/05/snmp-data-harvesting-during-penetration-testing/](https://blog.rapid7.com/2016/05/05/snmp-data-harvesting-during-penetration-testing/)):

### **Συσκευές**

Η διαδικασία ξεκινά με την εξαγωγή των δεδομένων **sysDesc MIB** (1.3.6.1.2.1.1.1.0) από κάθε αρχείο για την αναγνώριση των συσκευών. Αυτό επιτυγχάνεται μέσω της χρήσης ενός **εντολής grep**:
```bash
grep ".1.3.6.1.2.1.1.1.0" *.snmp
```
### **Αναγνώριση Ιδιωτικού Συμβολοσειράς**

Ένας κρίσιμος βήμα περιλαμβάνει την αναγνώριση της **ιδιωτικής συμβολοσειράς κοινότητας** που χρησιμοποιούν οι οργανισμοί, ιδιαίτερα σε δρομολογητές Cisco IOS. Αυτή η συμβολοσειρά επιτρέπει την εξαγωγή των **τρεχουσών διαμορφώσεων** από τους δρομολογητές. Η αναγνώριση συνήθως βασίζεται στην ανάλυση δεδομένων SNMP Trap για τη λέξη "trap" με ένα **εντολή grep**:
```bash
grep -i "trap" *.snmp
```
### **Ονόματα χρηστών/Κωδικοί πρόσβασης**

Οι καταγεγραμμένες καταχωρήσεις που αποθηκεύονται στους πίνακες MIB εξετάζονται για **αποτυχημένες προσπάθειες σύνδεσης**, οι οποίες μπορεί να περιλαμβάνουν κατά λάθος κωδικούς πρόσβασης που έχουν εισαχθεί ως ονόματα χρηστών. Αναζητούνται λέξεις-κλειδιά όπως _fail_, _failed_ ή _login_ για την εύρεση πολύτιμων δεδομένων:
```bash
grep -i "login\|fail" *.snmp
```
### **Ηλεκτρονικά Μηνύματα**

Τελικά, για να εξαγάγουμε **διευθύνσεις ηλεκτρονικού ταχυδρομείου** από τα δεδομένα, χρησιμοποιείται μια εντολή **grep** με έναν κανονικό έκφραση που επικεντρώνεται σε μοτίβα που ταιριάζουν με τις μορφές των ηλεκτρονικών ταχυδρομείων:
```bash
grep -E -o "\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,6}\b" *.snmp
```
## Τροποποίηση των τιμών SNMP

Μπορείτε να χρησιμοποιήσετε το _**NetScanTools**_ για να **τροποποιήσετε τις τιμές**. Θα πρέπει να γνωρίζετε το **ιδιωτικό συμβολοσειρά** για να το κάνετε αυτό.

## Πλαστογράφηση

Εάν υπάρχει ένας κανόνας ACL που επιτρέπει μόνο σε ορισμένες διευθύνσεις IP να ερωτήσουν την υπηρεσία SMNP, μπορείτε να πλαστογραφήσετε μία από αυτές τις διευθύνσεις μέσα στο πακέτο UDP και να καταγράψετε την κίνηση.

## Εξέταση αρχείων ρύθμισης SNMP

* snmp.conf
* snmpd.conf
* snmp-config.xml

## Αυτόματες εντολές HackTricks
```
Protocol_Name: SNMP    #Protocol Abbreviation if there is one.
Port_Number:  161     #Comma separated if there is more than one.
Protocol_Description: Simple Network Managment Protocol         #Protocol Abbreviation Spelled out

Entry_1:
Name: Notes
Description: Notes for SNMP
Note: |
SNMP - Simple Network Management Protocol is a protocol used to monitor different devices in the network (like routers, switches, printers, IoTs...).

https://book.hacktricks.xyz/pentesting/pentesting-snmp

Entry_2:
Name: SNMP Check
Description: Enumerate SNMP
Command: snmp-check {IP}

Entry_3:
Name: OneSixtyOne
Description: Crack SNMP passwords
Command: onesixtyone -c /usr/share/seclists/Discovery/SNMP/common-snmp-community-strings-onesixtyone.txt {IP} -w 100

Entry_4:
Name: Nmap
Description: Nmap snmp (no brute)
Command: nmap --script "snmp* and not snmp-brute" {IP}

Entry_5:
Name: Hydra Brute Force
Description: Need Nothing
Command: hydra -P {Big_Passwordlist} -v {IP} snmp
```
<img src="../../.gitbook/assets/i3.png" alt="" data-size="original">\
**Συμβουλή για bug bounty**: **Εγγραφείτε** στο **Intigriti**, μια προηγμένη πλατφόρμα bug bounty που δημιουργήθηκε από χάκερς, για χάκερς! Γίνετε μέλος σήμερα στο [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) και αρχίστε να κερδίζετε αμοιβές έως και **$100,000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

<details>

<summary><strong>Μάθετε το hacking του AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι για να υποστηρίξετε το HackTricks:

* Αν θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΠΛΑΝΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**The PEASS Family**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Γίνετε μέλος** 💬 [**ομάδας Discord**](https://discord.gg/hRep4RUj7f) ή της [**ομάδας telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Μοιραστείτε τα hacking tricks σας υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>
