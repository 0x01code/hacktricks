# 161,162,10161,10162/udp - Pentesting SNMP

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Travaillez-vous dans une entreprise de **cybers√©curit√©** ? Voulez-vous voir votre entreprise annonc√©e dans HackTricks ? ou voulez-vous avoir acc√®s √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**üí¨**](https://emojipedia.org/speech-balloon/) **groupe Discord** ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR au** [**repo hacktricks**](https://github.com/carlospolop/hacktricks) **et au** [**repo hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

<img src="../../.gitbook/assets/i3.png" alt="" data-size="original">\
**Astuce de prime de bug** : **inscrivez-vous** √† **Intigriti**, une plateforme de prime de bug premium cr√©√©e par des pirates, pour les pirates ! Rejoignez-nous sur [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) aujourd'hui et commencez √† gagner des primes allant jusqu'√† **100 000 $** !

{% embed url="https://go.intigriti.com/hacktricks" %}

## Informations de base

**SNMP - Simple Network Management Protocol** est un protocole utilis√© pour surveiller diff√©rents appareils dans le r√©seau (comme les routeurs, les commutateurs, les imprimantes, les IoT...).
```
PORT    STATE SERVICE REASON                 VERSION
161/udp open  snmp    udp-response ttl 244   ciscoSystems SNMPv3 server (public)
```
{% hint style="info" %}
SNMP utilise √©galement le port **162/UDP** pour les **traps**. Ce sont des **paquets de donn√©es envoy√©s du serveur SNMP au client sans √™tre explicitement demand√©s**.
{% endhint %}

### MIB

Pour garantir que l'acc√®s SNMP fonctionne entre les fabricants et avec diff√©rentes combinaisons client-serveur, le **Management Information Base (MIB)** a √©t√© cr√©√©. MIB est un **format ind√©pendant pour stocker les informations de l'appareil**. Un MIB est un **fichier texte** dans lequel tous les **objets SNMP interrogeables** d'un appareil sont r√©pertori√©s dans une hi√©rarchie d'arborescence **standardis√©e**. Il contient au moins un `Object Identifier` (`OID`), qui, en plus de l'**adresse unique** n√©cessaire et d'un **nom**, fournit √©galement des informations sur le type, les droits d'acc√®s et une description de l'objet respectif.\
Les fichiers MIB sont √©crits dans le format texte ASCII bas√© sur `Abstract Syntax Notation One` (`ASN.1`). Les **MIB ne contiennent pas de donn√©es**, mais ils expliquent **o√π trouver quelles informations** et √† quoi cela ressemble, ce qui renvoie des valeurs pour l'OID sp√©cifique, ou quel type de donn√©es est utilis√©.

### OIDs

**OID** signifie **O**bject **Id**entifiers. **Les OIDs identifient de mani√®re unique les objets g√©r√©s dans une hi√©rarchie MIB**. Cela peut √™tre repr√©sent√© sous forme d'arbre, dont les niveaux sont attribu√©s par diff√©rentes organisations. Les identifiants d'objet MIB de niveau sup√©rieur (OID) appartiennent √† diff√©rentes organisations standard.\
**Les fournisseurs d√©finissent des branches priv√©es comprenant des objets g√©r√©s pour leurs propres produits.**

![](../../.gitbook/assets/snmp_oid_mib_tree.png)

Vous pouvez **naviguer** dans un **arbre OID** depuis le web ici : [http://www.oid-info.com/cgi-bin/display?tree=#focus](http://www.oid-info.com/cgi-bin/display?tree=#focus) ou **voir ce que signifie un OID** (comme `1.3.6.1.2.1.1`) en acc√©dant √† [http://oid-info.com/get/1.3.6.1.2.1.1](http://oid-info.com/get/1.3.6.1.2.1.1).\
Il existe quelques **OID bien connus** comme ceux √† l'int√©rieur de [1.3.6.1.2.1](http://oid-info.com/get/1.3.6.1.2.1) qui font r√©f√©rence aux variables SNMP d√©finies par MIB-2 Simple Network Management Protocol (SNMP). Et √† partir des **OID en attente de celui-ci**, vous pouvez obtenir des donn√©es d'h√¥te int√©ressantes (donn√©es syst√®me, donn√©es r√©seau, donn√©es de processus...)

### **Exemple d'OID**

**`1 . 3 . 6 . 1 . 4 . 1 . 1452 . 1 . 2 . 5 . 1 . 3. 21 . 1 . 4 . 7`**

Voici une ventilation de cette adresse.

* 1 - cela s'appelle l'ISO et cela √©tablit qu'il s'agit d'un OID. C'est pourquoi tous les OIDs commencent par "1"
* 3 - cela s'appelle ORG et il est utilis√© pour sp√©cifier l'organisation qui a construit l'appareil.
* 6 - c'est le dod ou le D√©partement de la D√©fense qui est l'organisation qui a √©tabli Internet en premier.
* 1 - c'est la valeur d'Internet pour indiquer que toutes les communications se feront via Internet.
* 4 - cette valeur d√©termine que cet appareil est fabriqu√© par une organisation priv√©e et non gouvernementale.
* 1 - cette valeur indique que l'appareil est fabriqu√© par une entreprise ou une entit√© commerciale.

Ces six premi√®res valeurs ont tendance √† √™tre les m√™mes pour tous les appareils et elles vous donnent des informations de base sur eux. Cette s√©quence de nombres sera la m√™me pour tous les OIDs, sauf lorsque l'appareil est fabriqu√© par le gouvernement.

Passons au prochain ensemble de nombres.

* 1452 - donne le nom de l'organisation qui a fabriqu√© cet appareil.
* 1 - explique le type d'appareil. Dans ce cas, c'est une alarme.
* 2 - d√©termine que cet appareil est une unit√© de terminal √† distance.

Le reste des valeurs donne des informations sp√©cifiques sur l'appareil.

* 5 - indique un point d'alarme discret.
* 1 - point sp√©cifique dans l'appareil
* 3 - port
* 21 - adresse du port
* 1 - affichage pour le port
* 4 - num√©ro de point
* 7 - √©tat du point

_**(Exemple tir√© d'**_ [_**ici**_](https://www.netadmintools.com/snmp-mib-and-oids)_**)**_

### Versions SNMP

Il existe 2 versions importantes de SNMP :

* **SNMPv1** : La principale, elle est toujours la plus fr√©quente, l'**authentification est bas√©e sur une cha√Æne** (cha√Æne de communaut√©) qui voyage en **texte clair** (toutes les informations voyagent en texte clair). **La version 2 et 2c** envoient le **trafic en texte clair** √©galement et utilisent une **cha√Æne de communaut√© comme authentification**.
* **SNMPv3** : Utilise une meilleure forme d'**authentification** et les informations voyagent **crypt√©es** (une **attaque par dictionnaire** pourrait √™tre effectu√©e mais il serait beaucoup plus difficile de trouver les bonnes informations d'identification que dans SNMPv1 et v2).

### Cha√Ænes de communaut√©

Comme mentionn√© pr√©c√©demment, **pour acc√©der aux informations enregistr√©es sur le MIB, vous devez conna√Ætre la cha√Æne de communaut√© sur les versions 1 et 2/2c et les informations d'identification sur la version 3.**\
Il y a **2 types de cha√Ænes de communaut√©** :

* **`public`** principalement des fonctions **en lecture seule**
* **`private`** **Lecture/√©criture** en g√©n√©ral

Notez que **la possibilit√© d'√©crire sur un OID d√©pend de la cha√Æne de communaut√© utilis√©e**, donc **m√™me** si vous d√©couvrez que "**public**" est utilis√©, vous pourriez √™tre en mesure d'**√©crire certaines valeurs**. De plus, il **peut** exister des objets qui sont **toujours "Lecture seule"**.\
Si vous essayez d'**√©crire** un objet, une erreur **`noSuchName` ou `readOnly`** est re√ßue.

Dans les versions 1 et 2/2c, si vous utilisez une cha√Æne de communaut√© **incorrecte**, le serveur ne **r√©pondra pas**. Donc, s'il r√©pond, une **cha√Æne de communaut√© valide a √©t√© utilis√©e**.

## Ports

* L'agent SNMP re√ßoit des demandes sur le port UDP **161**.
* Le gestionnaire re√ßoit des notifications ([Traps](https://en.wikipedia.org/wiki/Simple\_Network\_Management\_Protocol#Trap) et [InformRequests](https://en.wikipedia.org/wiki/Simple\_Network\_Management\_Protocol#InformRequest)) sur le port **162**.
* Lorsqu'il est utilis√© avec [Transport Layer Security](https://en.wikipedia.org/wiki/Transport\_Layer\_Security) ou [Datagram Transport Layer Security](https://en.wikipedia.org/wiki/Datagram\_Transport\_Layer\_Security), les demandes sont re√ßues sur le port **10161** et les notifications sont envoy√©es sur le port **10162**.

## Brute-Force de la cha√Æne de communaut√© (v1 et v2c)

Pour **deviner la cha√Æne de communaut√©**, vous pouvez effectuer une attaque par dictionnaire. Consultez [ici diff√©rentes fa√ßons d'effectuer une attaque par force brute contre SNMP](../../generic-methodologies-and-resources/brute-force.md#snmp). Une cha√Æne de communaut√© fr√©quemment utilis√©e est `public`.

## √ânum√©ration SNMP

Il est recommand√© d'installer les √©l√©ments suivants pour voir ce que signifie **chaque OID collect√©** √† partir de l'appareil :
```bash
apt-get install snmp-mibs-downloader
download-mibs
# Finally comment the line saying "mibs :" in /etc/snmp/snmp.conf
sudo vi /etc/snmp/snmp.conf
```
Si vous connaissez une cha√Æne de communaut√© valide, vous pouvez acc√©der aux donn√©es en utilisant **SNMPWalk** ou **SNMP-Check**:
```bash
snmpbulkwalk -c [COMM_STRING] -v [VERSION] [IP] . #Don't forget the final dot
snmpbulkwalk -c public -v2c 10.10.11.136 .

snmpwalk -v [VERSION_SNMP] -c [COMM_STRING] [DIR_IP]
snmpwalk -v [VERSION_SNMP] -c [COMM_STRING] [DIR_IP] 1.3.6.1.2.1.4.34.1.3 #Get IPv6, needed dec2hex
snmpwalk -v [VERSION_SNMP] -c [COMM_STRING] [DIR_IP] NET-SNMP-EXTEND-MIB::nsExtendObjects #get extended
snmpwalk -v [VERSION_SNMP] -c [COMM_STRING] [DIR_IP] .1 #Enum all

snmp-check [DIR_IP] -p [PORT] -c [COMM_STRING]

nmap --script "snmp* and not snmp-brute" <target>

braa <community string>@<IP>:.1.3.6.* #Bruteforce specific OID
```
Gr√¢ce aux requ√™tes √©tendues (download-mibs), il est possible d'√©num√©rer encore plus d'informations sur le syst√®me avec la commande suivante :
```bash
snmpwalk -v X -c public <IP> NET-SNMP-EXTEND-MIB::nsExtendOutputFull
```
**SNMP** contient beaucoup d'informations sur l'h√¥te et des choses qui pourraient vous int√©resser sont: les **interfaces r√©seau** (adresse IPv4 et **IPv6**), les noms d'utilisateur, le temps de fonctionnement, la version du serveur/OS et les **processus** en cours d'ex√©cution (peuvent contenir des mots de passe)...

### Param√®tres dangereux

√Ä partir de [https://academy.hackthebox.com/module/112/section/1075](https://academy.hackthebox.com/module/112/section/1075)

| Param√®tres | Description |
| ---------- | ----------- |
| `rwuser noauth` | Fournit un acc√®s √† l'ensemble de l'arbre OID sans authentification. |
| `rwcommunity <community string> <adresse IPv4>` | Fournit un acc√®s √† l'ensemble de l'arbre OID ind√©pendamment de l'endroit o√π les demandes ont √©t√© envoy√©es. |
| `rwcommunity6 <community string> <adresse IPv6>` | M√™me acc√®s qu'avec `rwcommunity` avec la diff√©rence d'utiliser IPv6. |

### Cisco

Jetez un coup d'≈ìil √† cette page si vous avez un √©quipement Cisco:

{% content-ref url="cisco-snmp.md" %}
[cisco-snmp.md](cisco-snmp.md)
{% endcontent-ref %}

## De SNMP √† RCE

Si vous avez la **cha√Æne** qui vous permet d'**√©crire des valeurs** dans le service SNMP, vous pourriez √™tre en mesure de l'utiliser pour **ex√©cuter des commandes**:

{% content-ref url="snmp-rce.md" %}
[snmp-rce.md](snmp-rce.md)
{% endcontent-ref %}

## SNMP massif

[Braa](https://github.com/mteg/braa) est un scanner SNMP massif. L'utilisation pr√©vue d'un tel outil est bien s√ªr de faire des requ√™tes SNMP - mais contrairement √† snmpwalk de net-snmp, il est capable de faire des requ√™tes sur des dizaines ou des centaines d'h√¥tes simultan√©ment, et dans un seul processus. Ainsi, il consomme tr√®s peu de ressources syst√®me et effectue le balayage TR√àS rapidement.

Braa impl√©mente sa propre pile SNMP, il n'a donc pas besoin de biblioth√®ques SNMP comme net-snmp.

**Syntaxe:** braa \[cha√Æne de communaut√©]@\[adresse IP du serveur SNMP]:\[id iso]
```
braa ignite123@192.168.1.125:.1.3.6.*
```
Cela peut extraire beaucoup de Mo d'informations que vous ne pouvez pas traiter manuellement.

Alors, cherchons les informations les plus int√©ressantes (√† partir de [https://blog.rapid7.com/2016/05/05/snmp-data-harvesting-during-penetration-testing/](https://blog.rapid7.com/2016/05/05/snmp-data-harvesting-during-penetration-testing/)):

### Appareils

L'une des premi√®res choses que je fais est d'extraire les donn√©es MIB sysDesc .1.3.6.1.2.1.1.1.0 de chaque fichier pour d√©terminer les appareils √† partir desquels j'ai collect√© des informations. Cela peut facilement √™tre fait en utilisant la commande grep suivante:
```
grep ".1.3.6.1.2.1.1.1.0" *.snmp
```
### Identifier la cha√Æne priv√©e

Par exemple, si je peux identifier la cha√Æne de communaut√© priv√©e utilis√©e par une organisation sur ses routeurs Cisco IOS, je pourrais √©ventuellement utiliser cette cha√Æne de communaut√© pour extraire les configurations en cours d'ex√©cution de ces routeurs. La meilleure m√©thode pour trouver de telles donn√©es est souvent li√©e aux donn√©es SNMP Trap. Ainsi, en utilisant √† nouveau le grep suivant, nous pouvons parcourir rapidement de nombreuses donn√©es MIB en recherchant le mot cl√© "trap":
```bash
grep -i "trap" *.snmp
```
### Noms d'utilisateur/mots de passe

Une autre zone d'int√©r√™t est les journaux, j'ai d√©couvert qu'il y a des appareils qui contiennent des journaux dans les tables MIB. Ces journaux peuvent √©galement contenir des tentatives de connexion √©chou√©es. Pensez √† la derni√®re fois que vous vous √™tes connect√© √† un appareil via Telnet ou SSH et que vous avez involontairement entr√© votre mot de passe comme nom d'utilisateur. Je recherche g√©n√©ralement des mots cl√©s tels que _fail_, _failed_ ou _login_ et j'examine ces donn√©es pour voir s'il y a quelque chose de valeur.
```bash
grep -i "login\|fail" *.snmp
```
### Emails

Les emails
```bash
grep -E -o "\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,6}\b" *.snmp
```
## Modification des valeurs SNMP

Vous pouvez utiliser _**NetScanTools**_ pour **modifier les valeurs**. Vous devrez conna√Ætre la **cha√Æne priv√©e** pour le faire.

## Spoofing

S'il existe une ACL qui ne permet √† certaines adresses IP que de consulter le service SMNP, vous pouvez usurper l'une de ces adresses √† l'int√©rieur du paquet UDP et renifler le trafic.

## Examen des fichiers de configuration SNMP

* snmp.conf
* snmpd.conf
* snmp-config.xml

## Commandes automatiques HackTricks
```
Protocol_Name: SNMP    #Protocol Abbreviation if there is one.
Port_Number:  161     #Comma separated if there is more than one.
Protocol_Description: Simple Network Managment Protocol         #Protocol Abbreviation Spelled out

Entry_1:
  Name: Notes
  Description: Notes for SNMP
  Note: |
    SNMP - Simple Network Management Protocol is a protocol used to monitor different devices in the network (like routers, switches, printers, IoTs...).

    https://book.hacktricks.xyz/pentesting/pentesting-snmp

Entry_2:
  Name: SNMP Check
  Description: Enumerate SNMP
  Command: snmp-check {IP}

Entry_3:
  Name: OneSixtyOne
  Description: Crack SNMP passwords
  Command: onesixtyone -c /usr/share/seclists/Discovery/SNMP/common-snmp-community-strings-onesixtyone.txt {IP} -w 100

Entry_4:
  Name: Nmap
  Description: Nmap snmp (no brute)
  Command: nmap --script "snmp* and not snmp-brute" {IP}

Entry_5:
  Name: Hydra Brute Force
  Description: Need Nothing
  Command: hydra -P {Big_Passwordlist} -v {IP} snmp
```
<img src="../../.gitbook/assets/i3.png" alt="" data-size="original">\
**Astuce de prime de bug**: **inscrivez-vous** √† **Intigriti**, une plateforme de prime de bug premium cr√©√©e par des pirates, pour les pirates! Rejoignez-nous sur [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) aujourd'hui et commencez √† gagner des primes allant jusqu'√† **100 000 $**!

{% embed url="https://go.intigriti.com/hacktricks" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Travaillez-vous dans une entreprise de **cybers√©curit√©**? Voulez-vous voir votre entreprise annonc√©e dans HackTricks? ou voulez-vous avoir acc√®s √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF**? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFT**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**üí¨**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR au** [**repo hacktricks**](https://github.com/carlospolop/hacktricks) **et au** [**repo hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
