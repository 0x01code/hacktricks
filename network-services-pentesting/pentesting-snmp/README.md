# 161,162,10161,10162/udp - Pentesting SNMP

<details>

<summary><strong>Leer AWS-hacking van nul tot held met</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Ander maniere om HackTricks te ondersteun:

* As jy jou **maatskappy geadverteer wil sien in HackTricks** of **HackTricks in PDF wil aflaai**, kyk na die [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Kry die [**amptelike PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ontdek [**The PEASS Family**](https://opensea.io/collection/the-peass-family), ons versameling van eksklusiewe [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Deel jou hacktruuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-repos.

</details>

<img src="../../.gitbook/assets/i3.png" alt="" data-size="original">\
**Bug bounty wenk**: **teken aan** vir **Intigriti**, 'n premium **bug bounty-platform wat deur hackers geskep is, vir hackers**! Sluit vandag by ons aan by [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks), en begin om belonings tot **$100,000** te verdien!

{% embed url="https://go.intigriti.com/hacktricks" %}

## Basiese Inligting

**SNMP - Simple Network Management Protocol** is 'n protokol wat gebruik word om verskillende toestelle in die netwerk te monitor (soos roeteryers, skakelaars, drukkers, IoT-toestelle...).
```
PORT    STATE SERVICE REASON                 VERSION
161/udp open  snmp    udp-response ttl 244   ciscoSystems SNMPv3 server (public)
```
{% hint style="info" %}
SNMP gebruik ook die poort **162/UDP** vir **traps**. Dit is data **pakkies wat van die SNMP-bediener na die kli√´nt gestuur word sonder om eksplisiet aangevra te word**.
{% endhint %}

### MIB

Om te verseker dat SNMP-toegang oor vervaardigers en met verskillende kli√´nt-bediener kombinasies werk, is die **Management Information Base (MIB)** geskep. MIB is 'n **onafhanklike formaat vir die stoor van toestelinligting**. 'n MIB is 'n **teksl√™er** waarin alle navraagbare **SNMP-voorwerpe** van 'n toestel in 'n **gestandaardiseerde** boomhi√´rargie gelys word. Dit bevat ten minste een `Object Identifier` (`OID`), wat, naas die nodige **unieke adres** en 'n **naam**, ook inligting oor die tipe, toegangsregte en 'n beskrywing van die betrokke voorwerp verskaf.\
MIB-l√™ers is in die `Abstract Syntax Notation One` (`ASN.1`) gebaseerde ASCII-teksformaat geskryf. Die **MIB's bevat nie data nie**, maar verduidelik **waar om watter inligting te vind** en hoe dit lyk, wat terugkeerwaardes vir die spesifieke OID is, of watter datatipe gebruik word.

### OIDs

**Object Identifiers (OIDs)** speel 'n belangrike rol. Hierdie unieke identifiseerders is ontwerp om voorwerpe binne 'n **Management Information Base (MIB)** te bestuur.

Die hoogste vlakke van MIB-voorwerp-ID's, of OIDs, word toegewys aan diverse standaardstelorganisasies. Dit is binne hierdie topvlakke dat die raamwerk vir globale bestuurspraktyke en standaarde gevestig word.

Verkopers word ook die vryheid gegee om private takke te vestig. Binne hierdie takke het hulle die **selfstandigheid om bestuurde voorwerpe wat relevant is vir hul eie produklyne in te sluit**. Hierdie stelsel verseker dat daar 'n gestruktureerde en georganiseerde metode is om 'n wye verskeidenheid voorwerpe oor verskillende verkopers en standaarde te identifiseer en bestuur.

![](../../.gitbook/assets/snmp\_oid\_mib\_tree.png)

Jy kan deur 'n **OID-boom** op die web **navigeer** deur hier te gaan: [http://www.oid-info.com/cgi-bin/display?tree=#focus](http://www.oid-info.com/cgi-bin/display?tree=#focus) of **sien wat 'n OID beteken** (soos `1.3.6.1.2.1.1`) deur [http://oid-info.com/get/1.3.6.1.2.1.1](http://oid-info.com/get/1.3.6.1.2.1.1) te besoek.\
Daar is 'n paar **bekende OIDs** soos diegene binne [1.3.6.1.2.1](http://oid-info.com/get/1.3.6.1.2.1) wat verwys na MIB-2 gedefinieerde Simple Network Management Protocol (SNMP) veranderlikes. En van die **OID's wat van hierdie een afhang** kan jy interessante gasheerdata verkry (sisteme data, netwerkdata, prosesse data...)

### **OID-voorbeeld**

[**Voorbeeld van hier**](https://www.netadmintools.com/snmp-mib-and-oids/):

**`1 . 3 . 6 . 1 . 4 . 1 . 1452 . 1 . 2 . 5 . 1 . 3. 21 . 1 . 4 . 7`**

Hier is 'n uiteensetting van hierdie adres.

* 1 - dit word die ISO genoem en dit stel vas dat dit 'n OID is. Dit is hoekom alle OIDs met "1" begin.
* 3 - dit word ORG genoem en dit word gebruik om die organisasie wat die toestel gebou het, te spesifiseer.
* 6 - dit is die dod of die Department of Defense wat die organisasie was wat die Internet eerste gevestig het.
* 1 - dit is die waarde van die internet om aan te dui dat alle kommunikasie deur die Internet sal plaasvind.
* 4 - hierdie waarde bepaal dat hierdie toestel deur 'n private organisasie en nie 'n regeringstoestel gemaak is nie.
* 1 - hierdie waarde dui aan dat die toestel deur 'n onderneming of 'n besigheidsentiteit gemaak is.

Hierdie eerste ses waardes is gewoonlik dieselfde vir alle toestelle en dit gee jou die basiese inligting daaroor. Hierdie reeks getalle sal dieselfde wees vir alle OIDs, behalwe as die toestel deur die regering gemaak is.

Gaan voort na die volgende stel getalle.

* 1452 - gee die naam van die organisasie wat hierdie toestel vervaardig het.
* 1 - verduidelik die tipe toestel. In hierdie geval is dit 'n wekker.
* 2 - bepaal dat hierdie toestel 'n afgele√´ terminaleenheid is.

Die res van die waardes gee spesifieke inligting oor die toestel.

* 5 - dui op 'n diskrete alarm punt.
* 1 - spesifieke punt in die toestel
* 3 - poort
* 21 - adres van die poort
* 1 - vertoon vir die poort
* 4 - puntnommer
* 7 - toestand van die punt

### SNMP-weergawes

Daar is 2 belangrike weergawes van SNMP:

* **SNMPv1**: Die belangrikste een, dit is steeds die mees voorkomende, die **outentisering is gebaseer op 'n string** (gemeenskapsnaam) wat in **platte teks** reis (alle inligting reis in platte teks). **Weergawe 2 en 2c** stuur die **verkeer ook in platte teks** en gebruik 'n **gemeenskapsnaam as outentisering**.
* **SNMPv3**: Gebruik 'n beter **outentiseringsvorm** en die inligting reis **gekripteer** met behulp van (daar kan 'n **woordeboekaanval** uitgevoer word, maar dit sal baie moeiliker wees om die korrekte geloofsbriewe as in SNMPv1 en v2 te vind).

### Gemeenskapsname

Soos voorheen genoem, **om toegang te verkry tot die inligting wat in die MIB gestoor is, moet jy die gemeenskapsnaam in weergawes 1 en 2/2c weet en die geloofsbriewe in weergawe 3.**\
Daar is **2 tipes gemeenskapsname**:

* **`public`** hoofsaaklik **slegs lees** funksies
* **`private`** **Lees/Skryf** in die algemeen

Let daarop dat **die skryfbaarheid van 'n OID afhang van die gebruikte gemeenskapsnaam**, so **selfs** as jy vind dat "**public**" gebruik word, kan jy dalk in staat wees om **waardes te skryf**. Daar **kan** ook voorwerpe wees wat **altyd "Slegs lees" is**.\
As jy probeer om 'n voorwerp te **skryf**, sal 'n **`noSuchName` of `readOnly`-fout** ontvang word\*\*.\*\*

In weergawes 1 en 2/2c, as jy 'n **slegte** gemeenskapsnaam gebruik, sal die bediener nie **reageer** nie. Dus, as dit reageer, is 'n **geldige gemeenskapsnaam gebruik**.

## Poorte

[Vanaf Wikipedia](https://en.wikipedia.org/wiki/Simple_Network_Management_Protocol#:~:text=All%20SNMP%20messages%20are%20transported,port%20161%20in%20the%20agent.):

* Die SNMP-agent ontvang versoek op UDP-poort **161**.
* Die bestuurder ontvang kennisgewings ([Traps](https://en.wikipedia.org/wiki/Simple\_Network\_Management\_Protocol#Trap) en [InformRequests](https://en.wikipedia.org/wiki/Simple\_Network\_Management\_Protocol#InformRequest)) op poort **162**.
* Wanneer dit saam met [Transport Layer Security](https://en.wikipedia.org/wiki/Transport\_Layer\_Security) of [Datagram Transport Layer Security](https://en.wikipedia.org/wiki/Datagram\_Transport\_Layer\_Security) gebruik word, word versoek op poort **10161** ontvang en kennisgewings word na poort **10162** gestuur.

## Brute-Force Gemeenskapsnaam (v1 en v2c)

Om die gemeenskapsnaam te **raai**, kan jy 'n woordelysaanval uitvoer. Kyk [hier verskillende maniere om 'n brute-force-aanval teen SNMP uit te voer](../../generic-methodologies-and-resources/brute-force.md#snmp). 'n Gemeenskapsnaam wat dikwels gebruik word, is `public`.
## Opstel van SNMP

Dit word aanbeveel om die volgende te installeer om te sien wat beteken **elke OID wat ingesamel is** van die toestel:
```bash
apt-get install snmp-mibs-downloader
download-mibs
# Finally comment the line saying "mibs :" in /etc/snmp/snmp.conf
sudo vi /etc/snmp/snmp.conf
```
As jy 'n geldige gemeenskapsnaam weet, kan jy toegang verkry tot die data deur gebruik te maak van **SNMPWalk** of **SNMP-Check**:
```bash
snmpbulkwalk -c [COMM_STRING] -v [VERSION] [IP] . #Don't forget the final dot
snmpbulkwalk -c public -v2c 10.10.11.136 .

snmpwalk -v [VERSION_SNMP] -c [COMM_STRING] [DIR_IP]
snmpwalk -v [VERSION_SNMP] -c [COMM_STRING] [DIR_IP] 1.3.6.1.2.1.4.34.1.3 #Get IPv6, needed dec2hex
snmpwalk -v [VERSION_SNMP] -c [COMM_STRING] [DIR_IP] NET-SNMP-EXTEND-MIB::nsExtendObjects #get extended
snmpwalk -v [VERSION_SNMP] -c [COMM_STRING] [DIR_IP] .1 #Enum all

snmp-check [DIR_IP] -p [PORT] -c [COMM_STRING]

nmap --script "snmp* and not snmp-brute" <target>

braa <community string>@<IP>:.1.3.6.* #Bruteforce specific OID
```
Dankie aan uitgebreide navrae (laai-mibs af), is dit moontlik om selfs meer oor die stelsel op te som met die volgende bevel:
```bash
snmpwalk -v X -c public <IP> NET-SNMP-EXTEND-MIB::nsExtendOutputFull
```
**SNMP** het baie inligting oor die gasheer en dinge wat jy interessant mag vind, is: **Netwerkinterfaces** (IPv4 en **IPv6**-adres), Gebruikersname, Bedryfstyd, Bediener / OS-weergawe, en **prosesse** wat **loop** (kan wagwoorde bevat)....

### **Gevaarlike instellings**

In die w√™reld van netwerkbestuur is sekere konfigurasies en parameters sleutel tot omvattende monitering en beheer.

### Toegangsinstellings

Twee hoofinstellings maak toegang tot die **volledige OID-boom** moontlik, wat 'n belangrike komponent in netwerkbestuur is:

1. **`rwuser noauth`** is ingestel om volledige toegang tot die OID-boom sonder die nodigheid van outentifikasie toe te laat. Hierdie instelling is eenvoudig en maak onbeperkte toegang moontlik.

2. Vir meer spesifieke beheer kan toegang verleen word deur gebruik te maak van:
- **`rwcommunity`** vir **IPv4**-adresse, en
- **`rwcommunity6`** vir **IPv6**-adresse.

Beide opdragte vereis 'n **gemeenskapsnaam** en die betrokke IP-adres, en bied volledige toegang ongeag die oorsprong van die versoek.

### SNMP-parameters vir Microsoft Windows

'n Reeks **Bestuursinligtingsbasis (MIB) waardes** word gebruik om verskillende aspekte van 'n Windows-stelsel te monitor deur SNMP:

- **Stelselprosesse**: Toegang tot `1.3.6.1.2.1.25.1.6.0`, hierdie parameter maak dit moontlik om aktiewe prosesse binne die stelsel te monitor.
- **Lopende Programme**: Die waarde `1.3.6.1.2.1.25.4.2.1.2` is bedoel vir die opspoor van tans lopende programme.
- **Prosessepad**: Om vas te stel waar 'n proses vanaf loop, word die MIB-waarde `1.3.6.1.2.1.25.4.2.1.4` gebruik.
- **Stoor-eenhede**: Die monitering van stoor-eenhede word fasiliteer deur `1.3.6.1.2.1.25.2.3.1.4`.
- **Sagtewarenaam**: Om die sagteware wat op 'n stelsel ge√Ønstalleer is te identifiseer, word `1.3.6.1.2.1.25.6.3.1.2` gebruik.
- **Gebruikersrekeninge**: Die waarde `1.3.6.1.4.1.77.1.2.25` maak dit moontlik om gebruikersrekeninge te monitor.
- **TCP Plaaslike Poorte**: Laastens, word `1.3.6.1.2.1.6.13.1.3` aangewys vir die monitering van TCP plaaslike poorte, wat insig bied in aktiewe netwerkverbindings.

### Cisco

Kyk na hierdie bladsy as jy Cisco-toerusting het:

{% content-ref url="cisco-snmp.md" %}
[cisco-snmp.md](cisco-snmp.md)
{% endcontent-ref %}

## Van SNMP tot RCE

As jy die **string** het wat jou in staat stel om waardes binne die SNMP-diens te **skryf**, kan jy dit moontlik misbruik om **opdragte uit te voer**:

{% content-ref url="snmp-rce.md" %}
[snmp-rce.md](snmp-rce.md)
{% endcontent-ref %}

## **Massiewe SNMP**

[Braa ](https://github.com/mteg/braa)is 'n massiewe SNMP-skandeerder. Die bedoeling van so 'n instrument is natuurlik om SNMP-navrae te maak - maar anders as snmpwalk van net-snmp, kan dit gelyktydig tientalle of honderde gasheerstelsels ondervra en in 'n enkele proses hanteer. Dit verbruik dus baie min stelselhulpbronne en doen die skandering BAIE vinnig.

Braa implementeer sy EIE SNMP-stapel, dus het dit GEEN SNMP-biblioteke soos net-snmp nodig nie.

**Sintaksis:** braa \[Gemeenskapsnaam]@\[IP van SNMP-bediener]:\[iso-id]
```bash
braa ignite123@192.168.1.125:.1.3.6.*
```
Dit kan baie MB aan inligting onttrek wat jy nie handmatig kan verwerk nie.


So, laat ons kyk vir die mees interessante inligting (vanaf [https://blog.rapid7.com/2016/05/05/snmp-data-harvesting-during-penetration-testing/](https://blog.rapid7.com/2016/05/05/snmp-data-harvesting-during-penetration-testing/)):


### **Toestelle**

Die proses begin met die onttrekking van **sysDesc MIB-data** (1.3.6.1.2.1.1.1.0) uit elke l√™er om die toestelle te identifiseer. Dit word bereik deur die gebruik van 'n **grep-opdrag**:
```bash
grep ".1.3.6.1.2.1.1.1.0" *.snmp
```
### **Identifiseer Privaat String**

'n Belangrike stap behels die identifisering van die **privaat gemeenskapsnaam** wat deur organisasies gebruik word, veral op Cisco IOS-roeternetwerke. Hierdie string maak dit moontlik om **lopende konfigurasies** van roeternetwerke te onttrek. Die identifikasie berus dikwels op die analise van SNMP Trap-data vir die woord "trap" met 'n **grep-opdrag**:
```bash
grep -i "trap" *.snmp
```
### **Gebruikersname/ Wagwoorde**

Logs wat in MIB-tabelle gestoor word, word ondersoek vir **mislukte aanmeldingspogings**, wat per ongeluk wagwoorde kan insluit wat as gebruikersname ingevoer is. Sleutelwoorde soos _misluk_, _mislukte_, of _aanmelding_ word gesoek om waardevolle data te vind:
```bash
grep -i "login\|fail" *.snmp
```
### **E-posse**

Uiteindelik, om **e-posadressse** uit die data te onttrek, word 'n **grep-opdrag** met 'n regul√™re uitdrukking gebruik, wat fokus op patrone wat ooreenstem met e-posformate:
```bash
grep -E -o "\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,6}\b" *.snmp
```
## Wysiging van SNMP-waardes

Jy kan _**NetScanTools**_ gebruik om waardes te **verander**. Jy sal die **privaat string** moet weet om dit te doen.

## Spoofing

As daar 'n ACL is wat slegs sekere IP-adresse toelaat om die SNMP-diens te ondervra, kan jy een van hierdie adresse in die UDP-pakket vervals en die verkeer afluister.

## Ondersoek SNMP-konfigurasie l√™ers

* snmp.conf
* snmpd.conf
* snmp-config.xml

## HackTricks Outomatiese Opdragte
```
Protocol_Name: SNMP    #Protocol Abbreviation if there is one.
Port_Number:  161     #Comma separated if there is more than one.
Protocol_Description: Simple Network Managment Protocol         #Protocol Abbreviation Spelled out

Entry_1:
Name: Notes
Description: Notes for SNMP
Note: |
SNMP - Simple Network Management Protocol is a protocol used to monitor different devices in the network (like routers, switches, printers, IoTs...).

https://book.hacktricks.xyz/pentesting/pentesting-snmp

Entry_2:
Name: SNMP Check
Description: Enumerate SNMP
Command: snmp-check {IP}

Entry_3:
Name: OneSixtyOne
Description: Crack SNMP passwords
Command: onesixtyone -c /usr/share/seclists/Discovery/SNMP/common-snmp-community-strings-onesixtyone.txt {IP} -w 100

Entry_4:
Name: Nmap
Description: Nmap snmp (no brute)
Command: nmap --script "snmp* and not snmp-brute" {IP}

Entry_5:
Name: Hydra Brute Force
Description: Need Nothing
Command: hydra -P {Big_Passwordlist} -v {IP} snmp
```
<img src="../../.gitbook/assets/i3.png" alt="" data-size="original">\
**Foutbounty wenk**: **Teken aan** vir **Intigriti**, 'n premium **foutbounty platform geskep deur hackers, vir hackers**! Sluit vandag by ons aan by [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) en begin om belonings te verdien tot **$100,000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

<details>

<summary><strong>Leer AWS hacking vanaf nul tot held met</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Ander maniere om HackTricks te ondersteun:

* As jy jou **maatskappy geadverteer wil sien in HackTricks** of **HackTricks in PDF wil aflaai**, kyk na die [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Kry die [**amptelike PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ontdek [**The PEASS Family**](https://opensea.io/collection/the-peass-family), ons versameling van eksklusiewe [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Sluit aan by die** üí¨ [**Discord groep**](https://discord.gg/hRep4RUj7f) of die [**telegram groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Deel jou hacktruuks deur PRs in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
