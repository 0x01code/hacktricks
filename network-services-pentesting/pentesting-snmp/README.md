# 161,162,10161,10162/udp - Pentesting SNMP

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* ¬øTrabajas en una **empresa de ciberseguridad**? ¬øQuieres ver tu **empresa anunciada en HackTricks**? ¬øO quieres tener acceso a la **√∫ltima versi√≥n de PEASS o descargar HackTricks en PDF**? ¬°Consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obt√©n el [**swag oficial de PEASS y HackTricks**](https://peass.creator-spring.com)
* **√önete al** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠gueme** en **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Comparte tus trucos de hacking enviando PRs al** [**repositorio de hacktricks**](https://github.com/carlospolop/hacktricks) **y al** [**repositorio de hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

<img src="../../.gitbook/assets/i3.png" alt="" data-size="original">\
**Consejo de bug bounty**: **reg√≠strate** en **Intigriti**, una plataforma premium de **bug bounty creada por hackers, para hackers**. ¬°√önete a nosotros en [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) hoy mismo y comienza a ganar recompensas de hasta **$100,000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

## Informaci√≥n b√°sica

**SNMP - Simple Network Management Protocol** es un protocolo utilizado para monitorear diferentes dispositivos en la red (como routers, switches, impresoras, IoTs...).
```
PORT    STATE SERVICE REASON                 VERSION
161/udp open  snmp    udp-response ttl 244   ciscoSystems SNMPv3 server (public)
```
{% hint style="info" %}
SNMP tambi√©n utiliza el puerto **162/UDP** para **traps**. Estos son **paquetes de datos enviados desde el servidor SNMP al cliente sin ser solicitados expl√≠citamente**.
{% endhint %}

### MIB

Para asegurarse de que el acceso SNMP funcione en diferentes fabricantes y con diferentes combinaciones cliente-servidor, se cre√≥ la **Base de Informaci√≥n de Administraci√≥n (MIB)**. MIB es un **formato independiente para almacenar informaci√≥n del dispositivo**. Un MIB es un **archivo de texto** en el que se enumeran todos los **objetos SNMP** consultables de un dispositivo en una jerarqu√≠a de √°rbol **estandarizada**. Contiene al menos un `Identificador de Objeto` (`OID`), que, adem√°s de la direcci√≥n √∫nica necesaria y un nombre, tambi√©n proporciona informaci√≥n sobre el tipo, los derechos de acceso y una descripci√≥n del objeto respectivo.\
Los archivos MIB est√°n escritos en el formato de texto ASCII basado en `Abstract Syntax Notation One` (`ASN.1`). Los **MIB no contienen datos**, pero explican **d√≥nde encontrar qu√© informaci√≥n** y c√≥mo se ve, lo que devuelve valores para el OID espec√≠fico, o qu√© tipo de datos se utiliza.

### OIDs

**OIDs** significa **Identificadores de Objeto**. **OIDs identifican de manera √∫nica los objetos administrados en una jerarqu√≠a MIB**. Esto se puede representar como un √°rbol, cuyos niveles son asignados por diferentes organizaciones. Los identificadores de objetos MIB de nivel superior (OIDs) pertenecen a diferentes organizaciones est√°ndar.\
**Los proveedores definen ramas privadas que incluyen objetos administrados para sus propios productos.**

![](../../.gitbook/assets/snmp_oid_mib_tree.png)

Puede **navegar** a trav√©s de un **√°rbol OID** desde la web aqu√≠: [http://www.oid-info.com/cgi-bin/display?tree=#focus](http://www.oid-info.com/cgi-bin/display?tree=#focus) o **ver lo que significa un OID** (como `1.3.6.1.2.1.1`) accediendo a [http://oid-info.com/get/1.3.6.1.2.1.1](http://oid-info.com/get/1.3.6.1.2.1.1).\
Hay algunos **OIDs conocidos** como los que se encuentran dentro de [1.3.6.1.2.1](http://oid-info.com/get/1.3.6.1.2.1) que hacen referencia a variables SNMP definidas por MIB-2. Y a partir de los **OID pendientes de este** se pueden obtener algunos datos interesantes del host (datos del sistema, datos de red, datos de procesos...)

### **Ejemplo de OID**

**`1 . 3 . 6 . 1 . 4 . 1 . 1452 . 1 . 2 . 5 . 1 . 3. 21 . 1 . 4 . 7`**

Aqu√≠ hay un desglose de esta direcci√≥n.

* 1: esto se llama ISO y establece que esto es un OID. Es por eso que todos los OIDs comienzan con "1"
* 3: esto se llama ORG y se utiliza para especificar la organizaci√≥n que construy√≥ el dispositivo.
* 6: esto es el dod o el Departamento de Defensa, que es la organizaci√≥n que estableci√≥ Internet primero.
* 1: este es el valor de Internet para denotar que todas las comunicaciones se realizar√°n a trav√©s de Internet.
* 4: este valor determina que este dispositivo est√° hecho por una organizaci√≥n privada y no gubernamental.
* 1: este valor denota que el dispositivo est√° hecho por una empresa o una entidad comercial.

Estos primeros seis valores tienden a ser los mismos para todos los dispositivos y le brindan informaci√≥n b√°sica sobre ellos. Esta secuencia de n√∫meros ser√° la misma para todos los OIDs, excepto cuando el dispositivo es fabricado por el gobierno.

Pasando al siguiente conjunto de n√∫meros.

* 1452: da el nombre de la organizaci√≥n que fabric√≥ este dispositivo.
* 1: explica el tipo de dispositivo. En este caso, es un despertador.
* 2: determina que este dispositivo es una unidad terminal remota.

El resto de los valores proporcionan informaci√≥n espec√≠fica sobre el dispositivo.

* 5: denota un punto de alarma discreto.
* 1: punto espec√≠fico en el dispositivo
* 3: puerto
* 21: direcci√≥n del puerto
* 1: pantalla para el puerto
* 4: n√∫mero de punto
* 7: estado del punto

_**(Ejemplo tomado de**_ [_**aqu√≠**_](https://www.netadmintools.com/snmp-mib-and-oids)_**)**_

### Versiones de SNMP

Hay 2 versiones importantes de SNMP:

* **SNMPv1**: Principal, todav√≠a es la m√°s frecuente, la **autenticaci√≥n se basa en una cadena** (cadena de comunidad) que viaja en **texto plano** (toda la informaci√≥n viaja en texto plano). **La versi√≥n 2 y 2c** env√≠an el **tr√°fico en texto plano** tambi√©n y usan una **cadena de comunidad como autenticaci√≥n**.
* **SNMPv3**: Utiliza una mejor forma de **autenticaci√≥n** y la informaci√≥n viaja **encriptada** (un **ataque de diccionario** podr√≠a realizarse, pero ser√≠a mucho m√°s dif√≠cil encontrar las credenciales correctas que en SNMPv1 y v2).

### Cadenas de comunidad

Como se mencion√≥ antes, **para acceder a la informaci√≥n guardada en el MIB, es necesario conocer la cadena de comunidad en las versiones 1 y 2/2c y las credenciales en la versi√≥n 3.**\
Hay **2 tipos de cadenas de comunidad**:

* **`public`** principalmente funciones **solo de lectura**
* **`private`** **Lectura/Escritura** en general

Tenga en cuenta que **la capacidad de escritura de un OID depende de la cadena de comunidad utilizada**, por lo que **incluso** si encuentra que se est√° utilizando "**public**", podr√≠a ser capaz de **escribir algunos valores**. Adem√°s, **pueden** existir objetos que sean **siempre "Solo Lectura".**\
Si intenta **escribir** un objeto, se recibe un **error `noSuchName` o `readOnly`**.

En las versiones 1 y 2/2c, si usa una cadena de comunidad **incorrecta**, el servidor no **responder√°**. Entonces, si responde, se us√≥ una cadena de comunidad **v√°lida**.

## Puertos

* El agente SNMP recibe solicitudes en el puerto UDP **161**.
* El administrador recibe notificaciones ([Traps](https://en.wikipedia.org/wiki/Simple\_Network\_Management\_Protocol#Trap) e [InformRequests](https://en.wikipedia.org/wiki/Simple\_Network\_Management\_Protocol#InformRequest)) en el puerto **162**.
* Cuando se usa con [Transport Layer Security](https://en.wikipedia.org/wiki/Transport\_Layer\_Security) o [Datagram Transport Layer Security](https://en.wikipedia.org/wiki/Datagram\_Transport\_Layer\_Security), las solicitudes se reciben en el puerto **10161** y las notificaciones se env√≠an al puerto **10162**.

## Fuerza bruta de cadena de comunidad (v1 y v2c)

Para **adivinar la cadena de comunidad**, se puede realizar un ataque de diccionario. Consulte [aqu√≠ diferentes formas de realizar un ataque de fuerza bruta contra SNMP](../../generic-methodologies-and-resources/brute-force.md#snmp). Una cadena de comunidad frecuentemente utilizada es `public`.

## Enumeraci√≥n SNMP

Se recomienda instalar lo siguiente para ver lo que significa **cada OID recopilado** del dispositivo:
```bash
apt-get install snmp-mibs-downloader
download-mibs
# Finally comment the line saying "mibs :" in /etc/snmp/snmp.conf
sudo vi /etc/snmp/snmp.conf
```
Si conoces una cadena de comunidad v√°lida, puedes acceder a los datos utilizando **SNMPWalk** o **SNMP-Check**:
```bash
snmpbulkwalk -c [COMM_STRING] -v [VERSION] [IP] . #Don't forget the final dot
snmpbulkwalk -c public -v2c 10.10.11.136 .

snmpwalk -v [VERSION_SNMP] -c [COMM_STRING] [DIR_IP]
snmpwalk -v [VERSION_SNMP] -c [COMM_STRING] [DIR_IP] 1.3.6.1.2.1.4.34.1.3 #Get IPv6, needed dec2hex
snmpwalk -v [VERSION_SNMP] -c [COMM_STRING] [DIR_IP] NET-SNMP-EXTEND-MIB::nsExtendObjects #get extended
snmpwalk -v [VERSION_SNMP] -c [COMM_STRING] [DIR_IP] .1 #Enum all

snmp-check [DIR_IP] -p [PORT] -c [COMM_STRING]

nmap --script "snmp* and not snmp-brute" <target>

braa <community string>@<IP>:.1.3.6.* #Bruteforce specific OID
```
Gracias a las consultas extendidas (download-mibs), es posible enumerar a√∫n m√°s sobre el sistema con el siguiente comando:
```bash
snmpwalk -v X -c public <IP> NET-SNMP-EXTEND-MIB::nsExtendOutputFull
```
**SNMP** tiene mucha informaci√≥n sobre el host y cosas que pueden resultar interesantes como: **Interfaces de red** (direcciones IPv4 e **IPv6**), nombres de usuario, tiempo de actividad, versi√≥n del servidor/SO y **procesos** en ejecuci√≥n (que pueden contener contrase√±as)...

### **Configuraciones peligrosas**

**De** [**https://academy.hackthebox.com/module/112/section/1075**](https://academy.hackthebox.com/module/112/section/1075)\*\*\*\*

| **Configuraciones**                              | **Descripci√≥n**                                                                                   |
| ------------------------------------------------ | ------------------------------------------------------------------------------------------------- |
| `rwuser noauth`                                  | Proporciona acceso a todo el √°rbol OID sin autenticaci√≥n.                                          |
| `rwcommunity <cadena de comunidad> <direcci√≥n IPv4>`  | Proporciona acceso a todo el √°rbol OID independientemente de d√≥nde se hayan enviado las solicitudes. |
| `rwcommunity6 <cadena de comunidad> <direcci√≥n IPv6>` | Mismo acceso que con `rwcommunity` con la diferencia de usar IPv6.                                 |

### Cisco

Echa un vistazo a esta p√°gina si tienes equipos Cisco:

{% content-ref url="cisco-snmp.md" %}
[cisco-snmp.md](cisco-snmp.md)
{% endcontent-ref %}

## De SNMP a RCE

Si tienes la **cadena** que te permite **escribir valores** dentro del servicio SNMP, es posible que puedas abusar de ella para **ejecutar comandos**:

{% content-ref url="snmp-rce.md" %}
[snmp-rce.md](snmp-rce.md)
{% endcontent-ref %}

## **SNMP masivo**

[Braa ](https://github.com/mteg/braa)es un esc√°ner masivo de SNMP. El uso previsto de esta herramienta es, por supuesto, hacer consultas SNMP, pero a diferencia de snmpwalk de net-snmp, es capaz de hacer consultas a docenas o cientos de hosts simult√°neamente y en un solo proceso. Por lo tanto, consume muy pocos recursos del sistema y realiza el escaneo MUY r√°pido.

Braa implementa su propia pila SNMP, por lo que NO necesita bibliotecas SNMP como net-snmp.

**Sintaxis:** braa \[cadena de comunidad]@\[IP del servidor SNMP]:\[id iso]
```
braa ignite123@192.168.1.125:.1.3.6.*
```
Esto puede extraer muchos MB de informaci√≥n que no se pueden procesar manualmente.

Entonces, busquemos la informaci√≥n m√°s interesante (de [https://blog.rapid7.com/2016/05/05/snmp-data-harvesting-during-penetration-testing/](https://blog.rapid7.com/2016/05/05/snmp-data-harvesting-during-penetration-testing/)):

### Dispositivos

Una de las primeras cosas que hago es extraer los datos MIB sysDesc .1.3.6.1.2.1.1.1.0 de cada archivo para determinar de qu√© dispositivos he recopilado informaci√≥n. Esto se puede hacer f√°cilmente utilizando el siguiente comando grep:
```
grep ".1.3.6.1.2.1.1.1.0" *.snmp
```
### Identificar cadena privada

Por ejemplo, si puedo identificar la cadena de comunidad privada utilizada por una organizaci√≥n en sus routers Cisco IOS, entonces posiblemente podr√≠a usar esa cadena de comunidad para extraer las configuraciones en ejecuci√≥n de esos routers. El mejor m√©todo para encontrar dichos datos a menudo ha estado relacionado con los datos de trampa SNMP. Entonces, nuevamente, usando el siguiente grep, podemos analizar r√°pidamente una gran cantidad de datos MIB buscando la palabra clave "trampa":
```bash
grep -i "trap" *.snmp
```
### Nombres de usuario/contrase√±as

Otra √°rea de inter√©s son los registros, he descubierto que hay algunos dispositivos que almacenan registros dentro de las tablas MIB. Estos registros tambi√©n pueden contener intentos fallidos de inicio de sesi√≥n. Piense en la √∫ltima vez que inici√≥ sesi√≥n en un dispositivo a trav√©s de Telnet o SSH e ingres√≥ inadvertidamente su contrase√±a como nombre de usuario. Normalmente busco palabras clave como _fail_, _failed_ o _login_ y examino esos datos para ver si hay algo de valor.
```bash
grep -i "login\|fail" *.snmp
```
### Correos Electr√≥nicos
```bash
grep -E -o "\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,6}\b" *.snmp
```
## Modificaci√≥n de valores SNMP

Puedes usar _**NetScanTools**_ para **modificar valores**. Necesitar√°s conocer la **cadena privada** para poder hacerlo.

## Spoofing

Si hay una ACL que solo permite a algunas IPs hacer consultas al servicio SNMP, puedes falsificar una de estas direcciones dentro del paquete UDP y espiar el tr√°fico.

## Examinar archivos de configuraci√≥n SNMP

* snmp.conf
* snmpd.conf
* snmp-config.xml

## Comandos autom√°ticos de HackTricks
```
Protocol_Name: SNMP    #Protocol Abbreviation if there is one.
Port_Number:  161     #Comma separated if there is more than one.
Protocol_Description: Simple Network Managment Protocol         #Protocol Abbreviation Spelled out

Entry_1:
  Name: Notes
  Description: Notes for SNMP
  Note: |
    SNMP - Simple Network Management Protocol is a protocol used to monitor different devices in the network (like routers, switches, printers, IoTs...).

    https://book.hacktricks.xyz/pentesting/pentesting-snmp

Entry_2:
  Name: SNMP Check
  Description: Enumerate SNMP
  Command: snmp-check {IP}

Entry_3:
  Name: OneSixtyOne
  Description: Crack SNMP passwords
  Command: onesixtyone -c /usr/share/seclists/Discovery/SNMP/common-snmp-community-strings-onesixtyone.txt {IP} -w 100

Entry_4:
  Name: Nmap
  Description: Nmap snmp (no brute)
  Command: nmap --script "snmp* and not snmp-brute" {IP}

Entry_5:
  Name: Hydra Brute Force
  Description: Need Nothing
  Command: hydra -P {Big_Passwordlist} -v {IP} snmp
```
<img src="../../.gitbook/assets/i3.png" alt="" data-size="original">\
**Consejo de recompensa por errores**: ¬°**reg√≠strese** en **Intigriti**, una plataforma premium de **recompensas por errores creada por hackers, para hackers**! ¬°√önase a nosotros en [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) hoy mismo y comience a ganar recompensas de hasta **$100,000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* ¬øTrabaja en una **empresa de ciberseguridad**? ¬øQuiere ver su **empresa anunciada en HackTricks**? ¬øO quiere tener acceso a la **√∫ltima versi√≥n de PEASS o descargar HackTricks en PDF**? ¬°Consulte los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Descubra [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obtenga la [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* **√önase al** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠game en** **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Comparta sus trucos de hacking enviando PR al** [**repositorio de hacktricks**](https://github.com/carlospolop/hacktricks) **y al** [**repositorio de hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
