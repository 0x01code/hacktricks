# 143,993 - Πεντεστική IMAP

<details>

<summary><strong>Μάθετε το χάκινγκ του AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι για να υποστηρίξετε το HackTricks:

* Εάν θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**The PEASS Family**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε στη** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στη [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Μοιραστείτε τα χάκινγκ κόλπα σας υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>

<figure><img src="/.gitbook/assets/image (675).png" alt=""><figcaption></figcaption></figure>

Βρείτε ευπάθειες που έχουν μεγαλύτερη σημασία, ώστε να μπορείτε να τις διορθώσετε πιο γρήγορα. Το Intruder παρακολουθεί την επιθετική επιφάνεια σας, εκτελεί προληπτικές απειλητικές αναζητήσεις, εντοπίζει προβλήματα σε ολόκληρο το τεχνολογικό σας στοίβα, από APIs έως web εφαρμογές και συστήματα στο cloud. [**Δοκιμάστε το δωρεάν**](https://www.intruder.io/?utm\_source=referral\&utm\_campaign=hacktricks) σήμερα.

{% embed url="https://www.intruder.io/?utm_campaign=hacktricks&utm_source=referral" %}

***

## Πρωτόκολλο πρόσβασης σε μηνύματα Διαδικτύου

Το **πρωτόκολλο πρόσβασης σε μηνύματα Διαδικτύου (IMAP)** έχει σχεδιαστεί με σκοπό να επιτρέπει στους χρήστες να **έχουν πρόσβαση στα email τους από οποιαδήποτε τοποθεσία**, κυρίως μέσω μιας σύνδεσης στο Διαδίκτυο. Στην ουσία, τα email **διατηρούνται σε έναν διακομιστή** αντί να λαμβάνονται και να αποθηκεύονται σε μια προσωπική συσκευή. Αυτό σημαίνει ότι όταν ένα email ανοίγεται ή διαβάζεται, γίνεται **απευθείας από τον διακομιστή**. Αυτή η δυνατότητα επιτρέπει την ευκολία του να ελέγχετε τα email σας από **πολλές συσκευές**, εξασφαλίζοντας ότι δεν θα χαθούν μηνύματα ανεξάρτητα από τη συσκευή που χρησιμοποιείται.

Από προεπιλογή, το πρωτόκολλο IMAP λειτουργεί σε δύο θύρες:

* **Θύρα 143** - αυτή είναι η προεπιλεγμένη μη κρυπτογραφημένη θύρα IMAP
* **Θύρα 993** - αυτή είναι η θύρα που πρέπει να χρησιμοποιήσετε εάν θέλετε να συνδεθείτε με ασφάλεια χρησιμοποιώντας το πρωτόκολλο IMAP
```
PORT    STATE SERVICE REASON
143/tcp open  imap    syn-ack
```
## Ανάκτηση σήματος

Η ανάκτηση σήματος (banner grabbing) είναι μια τεχνική που χρησιμοποιείται στον τομέα της ασφάλειας δικτύου για να ανακτηθούν πληροφορίες σχετικά με έναν διακομιστή IMAP. Αυτή η τεχνική επιτρέπει στον επιτιθέμενο να αναγνωρίσει την έκδοση του διακομιστή, το λειτουργικό σύστημα που χρησιμοποιείται και άλλες πληροφορίες που μπορεί να είναι χρήσιμες για την εκμετάλλευση του συστήματος.

Για να πραγματοποιηθεί η ανάκτηση σήματος, ο επιτιθέμενος στέλνει ένα αίτημα σύνδεσης στον διακομιστή IMAP και λαμβάνει μια απάντηση που περιέχει το σήμα του διακομιστή. Αυτό το σήμα περιέχει πληροφορίες όπως η έκδοση του διακομιστή και άλλες λεπτομέρειες που μπορούν να χρησιμοποιηθούν για την εκμετάλλευση του συστήματος.

Η ανάκτηση σήματος μπορεί να γίνει με τη χρήση εργαλείων όπως το Telnet ή το Netcat. Ο επιτιθέμενος μπορεί να αναλύσει το σήμα που λαμβάνει για να ανακτήσει πληροφορίες για τον διακομιστή IMAP και να προχωρήσει σε επόμενα βήματα εκμετάλλευσης.
```bash
nc -nv <IP> 143
openssl s_client -connect <IP>:993 -quiet
```
### NTLM Auth - Αποκάλυψη πληροφοριών

Εάν ο διακομιστής υποστηρίζει NTLM auth (Windows), μπορείτε να αποκτήσετε ευαίσθητες πληροφορίες (εκδόσεις):
```
root@kali: telnet example.com 143
* OK The Microsoft Exchange IMAP4 service is ready.
>> a1 AUTHENTICATE NTLM
+
>> TlRMTVNTUAABAAAAB4IIAAAAAAAAAAAAAAAAAAAAAAA=
+ TlRMTVNTUAACAAAACgAKADgAAAAFgooCBqqVKFrKPCMAAAAAAAAAAEgASABCAAAABgOAJQAAAA9JAEkAUwAwADEAAgAKAEkASQBTADAAMQABAAoASQBJAFMAMAAxAAQACgBJAEkAUwAwADEAAwAKAEkASQBTADAAMQAHAAgAHwMI0VPy1QEAAAAA
```
Ή **αυτοματοποίηση** αυτού με το πρόσθετο **nmap** `imap-ntlm-info.nse`

### [Βίαιη δοκιμή IMAP](../generic-methodologies-and-resources/brute-force.md#imap)

## Σύνταξη


Παραδείγματα εντολών IAMP από [εδώ](https://donsutherland.org/crib/imap):
```
Login
A1 LOGIN username password
Values can be quoted to enclose spaces and special characters. A " must then be escape with a \
A1 LOGIN "username" "password"

List Folders/Mailboxes
A1 LIST "" *
A1 LIST INBOX *
A1 LIST "Archive" *

Create new Folder/Mailbox
A1 CREATE INBOX.Archive.2012
A1 CREATE "To Read"

Delete Folder/Mailbox
A1 DELETE INBOX.Archive.2012
A1 DELETE "To Read"

Rename Folder/Mailbox
A1 RENAME "INBOX.One" "INBOX.Two"

List Subscribed Mailboxes
A1 LSUB "" *

Status of Mailbox (There are more flags than the ones listed)
A1 STATUS INBOX (MESSAGES UNSEEN RECENT)

Select a mailbox
A1 SELECT INBOX

List messages
A1 FETCH 1:* (FLAGS)
A1 UID FETCH 1:* (FLAGS)

Retrieve Message Content
A1 FETCH 2 body[text]
A1 FETCH 2 all
A1 UID FETCH 102 (UID RFC822.SIZE BODY.PEEK[])

Close Mailbox
A1 CLOSE

Logout
A1 LOGOUT
```
### Εξέλιξη

IMAP (Internet Message Access Protocol) είναι ένα πρωτόκολλο που χρησιμοποιείται για την ανάκτηση και διαχείριση ηλεκτρονικών μηνυμάτων από έναν απομακρυσμένο διακομιστή. Αρχικά, το IMAP δημιουργήθηκε το 1986 και η τελευταία έκδοση του πρωτοκόλλου είναι το IMAPv4, το οποίο κυκλοφόρησε το 2003.

Το IMAP παρέχει πολλά πλεονεκτήματα σε σχέση με άλλα πρωτόκολλα ανάκτησης μηνυμάτων, όπως το POP3. Ένα από τα κύρια πλεονεκτήματα είναι η δυνατότητα να διατηρείτε τα μηνύματά σας στον απομακρυσμένο διακομιστή, επιτρέποντάς σας να αποκτήσετε πρόσβαση σε αυτά από πολλές συσκευές. Επίσης, μπορείτε να διαχειριστείτε τα μηνύματά σας στον απομακρυσμένο διακομιστή, όπως να δημιουργήσετε φακέλους, να μετακινήσετε μηνύματα και να διαγράψετε μηνύματα.

Ωστόσο, το IMAP έχει επίσης ορισμένες αδυναμίες που μπορούν να εκμεταλλευτούν οι επιτιθέμενοι. Οι επιθέσεις στο IMAP μπορούν να περιλαμβάνουν την απόκτηση πρόσβασης σε μη εξουσιοδοτημένα μηνύματα, την υποκλοπή διαπραγματεύσεων και την κατάχρηση ευπαθειών στο λογισμικό του διακομιστή IMAP.

Για να προστατευτείτε από επιθέσεις στο IMAP, μπορείτε να λάβετε μέτρα ασφαλείας, όπως τη χρήση ασφαλούς σύνδεσης (SSL/TLS), την εφαρμογή πολύπλοκων κωδικών πρόσβασης και την ενημέρωση του λογισμικού του διακομιστή IMAP για να διορθωθούν γνωστές ευπάθειες.
```
apt install evolution
```
![](<../.gitbook/assets/image (528).png>)

### CURL

Βασική πλοήγηση είναι δυνατή με το [CURL](https://ec.haxx.se/usingcurl/usingcurl-reademail#imap), αλλά η τεκμηρίωση είναι ελλιπής σε λεπτομέρειες, οπότε συνιστάται ο έλεγχος του [πηγαίου κώδικα](https://github.com/curl/curl/blob/master/lib/imap.c) για ακριβείς πληροφορίες.

1.  Λίστα με τα εισερχόμενα (εντολή imap `LIST "" "*"`)
```bash
curl -k 'imaps://1.2.3.4/' --user user:pass
```
2. Λίστα μηνυμάτων σε ένα φάκελο (εντολή imap `SELECT INBOX` και στη συνέχεια `SEARCH ALL`)

```bash
curl -k 'imaps://1.2.3.4/INBOX?ALL' --user user:pass
```

The result of this search is a list of message indicies.

Its also possible to provide more complex search terms. e.g. searching for drafts with password in mail body:

```bash
```bash
curl -k 'imaps://1.2.3.4/Drafts?TEXT password' --user user:pass
```

Μεταφορτώστε τη σελίδα `Drafts` από τον διακομιστή `1.2.3.4` μέσω του πρωτοκόλλου `imaps`, χρησιμοποιώντας το κείμενο `password` ως παράμετρο. Χρησιμοποιήστε τα διαπιστευτήρια `user:pass` για την αυθεντικοποίηση.
```

A nice overview of the search terms possible is located [here](https://www.atmail.com/blog/imap-commands/).

3.  Downloading a message (imap command `SELECT Drafts` and then `FETCH 1 BODY[]`)

```bash
```bash
curl -k 'imaps://1.2.3.4/Drafts;MAILINDEX=1' --user user:pass
```

Μεταφορτώστε τη σελίδα `Drafts` από τον IMAP διακομιστή στη διεύθυνση IP `1.2.3.4`, χρησιμοποιώντας το πρωτόκολλο `imaps`. Χρησιμοποιήστε τα διαπιστευτήρια `user:pass` για πιστοποίηση.
```

The mail index will be the same index returned from the search operation.

It is also possible to use `UID` (unique id) to access messages, however it is less conveniant as the search command needs to be manually formatted. E.g.

```bash
```bash
curl -k 'imaps://1.2.3.4/INBOX' -X 'UID SEARCH ALL' --user user:pass
curl -k 'imaps://1.2.3.4/INBOX;UID=1' --user user:pass
```

Μετάφραση:

```bash
curl -k 'imaps://1.2.3.4/INBOX' -X 'UID SEARCH ALL' --user user:pass
curl -k 'imaps://1.2.3.4/INBOX;UID=1' --user user:pass
```
```

Also, possible to download just parts of a message, e.g. subject and sender of first 5 messages (the `-v` is required to see the subject and sender):

```bash
```bash
$ curl -k 'imaps://1.2.3.4/INBOX' -X 'FETCH 1:5 BODY[HEADER.FIELDS (SUBJECT FROM)]' --user user:pass -v 2>&1 | grep '^<'
```

Μετάφραση:

```bash
$ curl -k 'imaps://1.2.3.4/INBOX' -X 'FETCH 1:5 BODY[HEADER.FIELDS (SUBJECT FROM)]' --user user:pass -v 2>&1 | grep '^<'
```
```

Although, its probably cleaner to just write a little for loop:

```bash
```bash
for m in {1..5}; do
echo $m
curl "imap://1.2.3.4/INBOX;MAILINDEX=$m;SECTION=HEADER.FIELDS%20(SUBJECT%20FROM)" --user user:pass
done
```

Για m στο διάστημα από 1 έως 5, κάνε
εκτύπωσε το m
κάνε αίτηση curl στο "imap://1.2.3.4/INBOX;MAILINDEX=$m;SECTION=HEADER.FIELDS%20(SUBJECT%20FROM)" --user user:pass
τέλος
```

## Shodan

* `port:143 CAPABILITY`
* `port:993 CAPABILITY`

## HackTricks Automatic Commands

```
Protocol_Name: IMAP    #Συντόμευση του πρωτοκόλλου αν υπάρχει.
Port_Number:  143,993     #Διαχωρισμένα με κόμμα αν υπάρχουν περισσότερα από ένα.
Protocol_Description: Internet Message Access Protocol         #Πλήρης εκδοχή της συντόμευσης του πρωτοκόλλου

Entry_1:
Name: Σημειώσεις
Description: Σημειώσεις για το WHOIS
Note: |
Το Internet Message Access Protocol (IMAP) σχεδιάστηκε με σκοπό να επιτρέπει στους χρήστες να έχουν πρόσβαση στα email τους από οποιαδήποτε τοποθεσία, κυρίως μέσω σύνδεσης στο διαδίκτυο. Στην ουσία, τα email παραμένουν αποθηκευμένα σε έναν διακομιστή αντί να γίνεται η λήψη και αποθήκευσή τους στην προσωπική συσκευή του ατόμου. Αυτό σημαίνει ότι όταν ένα email ανοίγει ή διαβάζεται, γίνεται απευθείας από τον διακομιστή. Αυτή η δυνατότητα επιτρέπει την ευκολία του να ελέγχετε τα email από πολλές συσκευές, εξασφαλίζοντας ότι δεν θα χαθεί κανένα μήνυμα ανεξάρτητα από τη συσκευή που χρησιμοποιείται.

https://book.hacktricks.xyz/pentesting/pentesting-imap

Entry_2:
Name: Banner Grab
Description: Banner Grab 143
Command: nc -nv {IP} 143

Entry_3:
Name: Ασφαλής Banner Grab
Description: Banner Grab 993
Command: openssl s_client -connect {IP}:993 -quiet

Entry_4:
Name: Απαρίθμηση mfs χωρίς την ανάγκη εκτέλεσης του msfconsole
Description: Απαρίθμηση IMAP χωρίς την ανάγκη εκτέλεσης του msfconsole
Note: πηγή από https://github.com/carlospolop/legion
Command: msfconsole -q -x 'use auxiliary/scanner/imap/imap_version; set RHOSTS {IP}; set RPORT 143; run; exit'
```

<figure><img src="/.gitbook/assets/image (675).png" alt=""><figcaption></figcaption></figure>

Find vulnerabilities that matter most so you can fix them faster. Intruder tracks your attack surface, runs proactive threat scans, finds issues across your whole tech stack, from APIs to web apps and cloud systems. [**Try it for free**](https://www.intruder.io/?utm\_source=referral\&utm\_campaign=hacktricks) today.

{% embed url="https://www.intruder.io/?utm_campaign=hacktricks&utm_source=referral" %}


<details>

<summary><strong>Learn AWS hacking from zero to hero with</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Other ways to support HackTricks:

* If you want to see your **company advertised in HackTricks** or **download HackTricks in PDF** Check the [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Get the [**official PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Discover [**The PEASS Family**](https://opensea.io/collection/the-peass-family), our collection of exclusive [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Join the** 💬 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Share your hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
