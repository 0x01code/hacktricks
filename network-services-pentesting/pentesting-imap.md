# 143,993 - IMAP рдкреЗрдВрдЯреЗрд╕реНрдЯрд┐рдВрдЧ

<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдЕрдЧрд░ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА HackTricks рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд рд╣реЛ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕ рджреЗрдЦреЗрдВ**](https://github.com/sponsors/carlospolop)!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рдХрд▓реЗрдХреНрд╢рди, [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдЦреЛрдЬреЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ **рдореБрдЭреЗ** **Twitter** ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВред

</details>

<figure><img src="/.gitbook/assets/image (675).png" alt=""><figcaption></figcaption></figure>

рд╡реЗ рд╕реБрд░рдХреНрд╖рд╛ рдЧрдбрд╝рдмрдбрд╝реАрдпреЛрдВ рдХреЛ рдЦреЛрдЬреЗрдВ рдЬреЛ рд╕рдмрд╕реЗ рдЕрдзрд┐рдХ рдорд╛рдпрдиреЗ рд░рдЦрддреА рд╣реИрдВ рддрд╛рдХрд┐ рдЖрдк рдЙрдиреНрд╣реЗрдВ рддреЗрдЬреА рд╕реЗ рдареАрдХ рдХрд░ рд╕рдХреЗрдВред Intruder рдЖрдкрдХреА рд╣рдорд▓реЗ рдХреА рд╕рддрд╣ рдХрд╛ рдЯреНрд░реИрдХ рдХрд░рддрд╛ рд╣реИ, рдкреНрд░реЛрдПрдХреНрдЯрд┐рд╡ рдзрд╛рд░рдгрд╛ рд╕реНрдХреИрди рдЪрд▓рд╛рддрд╛ рд╣реИ, рдЖрдкрдХреА рдкреВрд░реА рддрдХрдиреАрдХреА рд╕реНрдЯреИрдХ, API рд╕реЗ рд╡реЗрдм рдРрдкреНрд╕ рдФрд░ рдХреНрд▓рд╛рдЙрдб рд╕рд┐рд╕реНрдЯрдо рддрдХ рдореБрджреНрджреЗ рдЦреЛрдЬрддрд╛ рд╣реИред [**рдЖрдЬ рд╣реА рдореБрдлреНрдд рдореЗрдВ рдЗрд╕рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВ**](https://www.intruder.io/?utm\_source=referral\&utm\_campaign=hacktricks)ред

{% embed url="https://www.intruder.io/?utm_campaign=hacktricks&utm_source=referral" %}

***

## рдЗрдВрдЯрд░рдиреЗрдЯ рд╕рдВрджреЗрд╢ рдкрд╣реБрдВрдЪрдиреЗ рдХрд╛ рдкреНрд░реЛрдЯреЛрдХреЙрд▓

**рдЗрдВрдЯрд░рдиреЗрдЯ рд╕рдВрджреЗрд╢ рдкрд╣реБрдВрдЪрдиреЗ рдХрд╛ рдкреНрд░реЛрдЯреЛрдХреЙрд▓ (IMAP)** рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ **рдХрд┐рд╕реА рднреА рд╕реНрдерд╛рди рд╕реЗ рдЕрдкрдиреЗ рдИрдореЗрд▓ рд╕рдВрджреЗрд╢реЛрдВ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ** рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдиреЗ рдХреЗ рдЙрджреНрджреЗрд╢реНрдп рд╕реЗ рдбрд┐рдЬрд╝рд╛рдЗрди рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдореБрдЦреНрдп рд░реВрдк рд╕реЗ рдЗрдВрдЯрд░рдиреЗрдЯ рдХрдиреЗрдХреНрд╢рди рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗред рд╕рд╛рд░рд╛рдВрд╢ рдореЗрдВ, рдИрдореЗрд▓ **рд╕рд░реНрд╡рд░ рдкрд░ рд░рдЦреЗ рдЬрд╛рддреЗ рд╣реИрдВ** рдмрдЬрд╛рдп рдЗрд╕рдХреЗ рдХрд┐ рд╡реНрдпрдХреНрддрд┐ рдХреЗ рд╡реНрдпрдХреНрддрд┐рдЧрдд рдЙрдкрдХрд░рдг рдкрд░ рдбрд╛рдЙрдирд▓реЛрдб рдФрд░ рд╕реНрдЯреЛрд░ рдХрд┐рдП рдЬрд╛рдПрдВред рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдЬрдм рдПрдХ рдИрдореЗрд▓ рддрдХ рдкрд╣реБрдВрдЪрд╛ рдЬрд╛рддрд╛ рд╣реИ рдпрд╛ рдкрдврд╝рд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдпрд╣ **рд╕реАрдзреЗ рд╕рд░реНрд╡рд░ рд╕реЗ** рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдпрд╣ рдХреНрд╖рдорддрд╛ рд╡рд┐рднрд┐рдиреНрди рдЙрдкрдХрд░рдгреЛрдВ рд╕реЗ рдИрдореЗрд▓ рдЬрд╛рдВрдЪрдиреЗ рдХреА рд╕реБрд╡рд┐рдзрд╛ рдкреНрд░рджрд╛рди рдХрд░рддреА рд╣реИ, рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддреА рд╣реИ рдХрд┐ рдХреЛрдИ рд╕рдВрджреЗрд╢ рдЫреВрдЯ рдирд╣реАрдВ рдЬрд╛рддрд╛ рд╣реИ рдЪрд╛рд╣реЗ рдЬреЛ рдЙрдкрдХрд░рдг рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рдПред

рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ, IMAP рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рджреЛ рдкреЛрд░реНрдЯреНрд╕ рдкрд░ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ:

* **рдкреЛрд░реНрдЯ 143** - рдпрд╣ рдбрд┐рдлрд╝реЙрд▓реНрдЯ IMAP рдЧреИрд░-рдПрдиреНрдХреНрд░рд┐рдкреНрдЯреЗрдб рдкреЛрд░реНрдЯ рд╣реИ
* **рдкреЛрд░реНрдЯ 993** - рдпрд╣ рд╡рд╣ рдкреЛрд░реНрдЯ рд╣реИ рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╣реИ рдЕрдЧрд░ рдЖрдк IMAP рдХрд╛ рд╕реБрд░рдХреНрд╖рд┐рдд рд░реВрдк рд╕реЗ рдХрдиреЗрдХреНрдЯ рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВред
```
PORT    STATE SERVICE REASON
143/tcp open  imap    syn-ack
```
## рдмреИрдирд░ рдЧреНрд░рдмрд┐рдВрдЧ
```bash
nc -nv <IP> 143
openssl s_client -connect <IP>:993 -quiet
```
### NTLM рдкреНрд░рдорд╛рдгреАрдХрд░рдг - рд╕реВрдЪрдирд╛ рдлреБрдЯрдХрд╛рд░

рдпрджрд┐ рд╕рд░реНрд╡рд░ NTLM рдкреНрд░рдорд╛рдгреАрдХрд░рдг (Windows) рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИ, рддреЛ рдЖрдк рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдЬрд╛рдирдХрд╛рд░реА (рд╕рдВрд╕реНрдХрд░рдг) рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```
root@kali: telnet example.com 143
* OK The Microsoft Exchange IMAP4 service is ready.
>> a1 AUTHENTICATE NTLM
+
>> TlRMTVNTUAABAAAAB4IIAAAAAAAAAAAAAAAAAAAAAAA=
+ TlRMTVNTUAACAAAACgAKADgAAAAFgooCBqqVKFrKPCMAAAAAAAAAAEgASABCAAAABgOAJQAAAA9JAEkAUwAwADEAAgAKAEkASQBTADAAMQABAAoASQBJAFMAMAAxAAQACgBJAEkAUwAwADEAAwAKAEkASQBTADAAMQAHAAgAHwMI0VPy1QEAAAAA
```
рдпрд╛ **nmap** рдкреНрд▓рдЧрдЗрди `imap-ntlm-info.nse` рдХреЗ рд╕рд╛рде **рд╕реНрд╡рдЪрд╛рд▓рд┐рдд** рдХрд░реЗрдВ

### [IMAP Bruteforce](../generic-methodologies-and-resources/brute-force.md#imap)

## рд╡рд╛рдХреНрдпрд░рдЪрдирд╛

[рдпрд╣рд╛рдБ](https://donsutherland.org/crib/imap) рд╕реЗ рдЖрдИрдПрдПрдордкреА рдХрдорд╛рдВрдб рдЙрджрд╛рд╣рд░рдг:
```
Login
A1 LOGIN username password
Values can be quoted to enclose spaces and special characters. A " must then be escape with a \
A1 LOGIN "username" "password"

List Folders/Mailboxes
A1 LIST "" *
A1 LIST INBOX *
A1 LIST "Archive" *

Create new Folder/Mailbox
A1 CREATE INBOX.Archive.2012
A1 CREATE "To Read"

Delete Folder/Mailbox
A1 DELETE INBOX.Archive.2012
A1 DELETE "To Read"

Rename Folder/Mailbox
A1 RENAME "INBOX.One" "INBOX.Two"

List Subscribed Mailboxes
A1 LSUB "" *

Status of Mailbox (There are more flags than the ones listed)
A1 STATUS INBOX (MESSAGES UNSEEN RECENT)

Select a mailbox
A1 SELECT INBOX

List messages
A1 FETCH 1:* (FLAGS)
A1 UID FETCH 1:* (FLAGS)

Retrieve Message Content
A1 FETCH 2 body[text]
A1 FETCH 2 all
A1 UID FETCH 102 (UID RFC822.SIZE BODY.PEEK[])

Close Mailbox
A1 CLOSE

Logout
A1 LOGOUT
```
### рд╡рд┐рдХрд╛рд╕
```
apt install evolution
```
![](<../.gitbook/assets/image (528).png>)

### CURL

[**CURL**](https://ec.haxx.se/usingcurl/usingcurl-reademail#imap) рдХреЗ рд╕рд╛рде рдореВрд▓ рдиреЗрд╡рд┐рдЧреЗрд╢рди рд╕рдВрднрд╡ рд╣реИ, рд▓реЗрдХрд┐рди рджрд╕реНрддрд╛рд╡реЗрдЬрд╝реАрдХрд░рдг рд╡рд┐рд╕реНрддрд╛рд░ рд╕реЗ рдирд╣реАрдВ рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╕рдЯреАрдХ рд╡рд┐рд╡рд░рдг рдХреЗ рд▓рд┐рдП [рд╕реНрд░реЛрдд](https://github.com/curl/curl/blob/master/lib/imap.c) рдХреА рдЬрд╛рдВрдЪ рдХреА рдЬрд╛рддреА рд╣реИред

1.  рдореЗрд▓рдмреЙрдХреНрд╕ рдХреА рд╕реВрдЪреАрдХрд░рдг (imap рдХрдорд╛рдВрдб `LIST "" "*"`)
```bash
curl -k 'imaps://1.2.3.4/' --user user:pass
```
2. рдореЗрд▓рдмреЙрдХреНрд╕ рдореЗрдВ рд╕рдВрджреЗрд╢реЛрдВ рдХреА рд╕реВрдЪреА рдмрдирд╛рдирд╛ (imap рдХрдорд╛рдВрдб `SELECT INBOX` рдФрд░ рдлрд┐рд░ `SEARCH ALL`)

```bash
curl -k 'imaps://1.2.3.4/INBOX?ALL' --user user:pass```
```

The result of this search is a list of message indicies.

Its also possible to provide more complex search terms. e.g. searching for drafts with password in mail body:

```bash
```html
<p>curl -k 'imaps://1.2.3.4/Drafts?TEXT password' --user user:pass</p>
```
```

A nice overview of the search terms possible is located [here](https://www.atmail.com/blog/imap-commands/).

3.  Downloading a message (imap command `SELECT Drafts` and then `FETCH 1 BODY[]`)

```bash
```html
рдХрд░реНрд▓ -рдХ 'imaps://1.2.3.4/Drafts;MAILINDEX=1' --user user:pass
```
```

The mail index will be the same index returned from the search operation.

It is also possible to use `UID` (unique id) to access messages, however it is less conveniant as the search command needs to be manually formatted. E.g.

```bash
```plaintext
рдХрд░реНрд▓ -k 'imaps://1.2.3.4/INBOX' -X 'UID SEARCH ALL' --user user:pass
рдХрд░реНрд▓ -k 'imaps://1.2.3.4/INBOX;UID=1' --user user:pass
```
```

Also, possible to download just parts of a message, e.g. subject and sender of first 5 messages (the `-v` is required to see the subject and sender):

```bash
```html
<p>рдпрд╣рд╛рдБ рд╣рдордиреЗ IMAP рд╕рд░реНрд╡рд┐рд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ рдЙрджрд╛рд╣рд░рдг рджрд┐рдпрд╛ рд╣реИ:</p>
<p>рдпрд╣рд╛рдБ рд╣рдордиреЗ IMAP рд╕рд░реНрд╡рд░ 1.2.3.4 рдкрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо "user" рдФрд░ рдкрд╛рд╕рд╡рд░реНрдб "pass" рдХреЗ рд╕рд╛рде рдХрдиреЗрдХреНрдЯ рдХрд┐рдпрд╛ред</p>
<p>рдЗрд╕рдХреЗ рдмрд╛рдж рд╣рдордиреЗ рдкрд╣рд▓реЗ 5 рдИрдореЗрд▓реЛрдВ рдХреЗ рд▓рд┐рдП SUBJECT рдФрд░ FROM рд╢реАрд░реНрд╖рдХ рдХреЛ рдлреЗрдЪ рдХрд┐рдпрд╛ред</p>
```
```

Although, its probably cleaner to just write a little for loop:

```bash
```bash
for m in {1..5}; do
echo $m
curl "imap://1.2.3.4/INBOX;MAILINDEX=$m;SECTION=HEADER.FIELDS%20(SUBJECT%20FROM)" --user user:pass
done
```
```

## Shodan

* `port:143 CAPABILITY`
* `port:993 CAPABILITY`

## HackTricks Automatic Commands

```
Protocol_Name: IMAP    #Protocol Abbreviation if there is one.
Port_Number:  143,993     #Comma separated if there is more than one.
Protocol_Description: Internet Message Access Protocol         #Protocol Abbreviation Spelled out

Entry_1:
Name: Notes
Description: Notes for WHOIS
Note: |
рдЗрдВрдЯрд░рдиреЗрдЯ рд╕рдВрджреЗрд╢ рдкрд╣реБрдВрдЪрди рдкреНрд░реЛрдЯреЛрдХреЙрд▓ (IMAP) рдХрд╛ рдЙрджреНрджреЗрд╢реНрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рдХрд┐рд╕реА рднреА рд╕реНрдерд╛рди рд╕реЗ рдЙрдирдХреЗ рдИрдореЗрд▓ рд╕рдВрджреЗрд╢реЛрдВ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреА рд╕реБрд╡рд┐рдзрд╛ рдкреНрд░рджрд╛рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдбрд┐рдЬрд╝рд╛рдЗрди рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдореБрдЦреНрдп рд░реВрдк рд╕реЗ рдЗрдВрдЯрд░рдиреЗрдЯ рдХрдиреЗрдХреНрд╢рди рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗред рд╕рд╛рд░рд╛рдВрд╢ рдореЗрдВ, рдИрдореЗрд▓ рд╕рд░реНрд╡рд░ рдкрд░ рд░рдЦреЗ рдЬрд╛рддреЗ рд╣реИрдВ рдмрдЬрд╛рдп рдЗрд╕рдХреЗ рдХрд┐ рд╡реЗ рдПрдХ рд╡реНрдпрдХреНрддрд┐ рдХреЗ рд╡реНрдпрдХреНрддрд┐рдЧрдд рдЙрдкрдХрд░рдг рдкрд░ рдбрд╛рдЙрдирд▓реЛрдб рдФрд░ рд╕реНрдЯреЛрд░ рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВред рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдЬрдм рдПрдХ рдИрдореЗрд▓ рддрдХ рдкрд╣реБрдВрдЪрд╛ рдЬрд╛рддрд╛ рд╣реИ рдпрд╛ рдкрдврд╝рд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдпрд╣ рд╕реАрдзреЗ рд╕рд░реНрд╡рд░ рд╕реЗ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдпрд╣ рдХреНрд╖рдорддрд╛ рдПрдХ рд╕реЗ рдЕрдзрд┐рдХ рдЙрдкрдХрд░рдгреЛрдВ рд╕реЗ рдИрдореЗрд▓ рдХреА рдЬрд╛рдВрдЪ рдХрд░рдиреЗ рдХреА рд╕реБрд╡рд┐рдзрд╛ рдкреНрд░рджрд╛рди рдХрд░рддреА рд╣реИ, рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддреА рд╣реИ рдХрд┐ рдХреЛрдИ рд╕рдВрджреЗрд╢ рдЫреВрдЯ рдирд╣реАрдВ рдЬрд╛рддрд╛ рд╣реИ рдЪрд╛рд╣реЗ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдЙрдкрдХрд░рдг рдХреЛрдИ рднреА рд╣реЛред

https://book.hacktricks.xyz/pentesting/pentesting-imap

Entry_2:
Name: Banner Grab
Description: Banner Grab 143
Command: nc -nv {IP} 143

Entry_3:
Name: Secure Banner Grab
Description: Banner Grab 993
Command: openssl s_client -connect {IP}:993 -quiet

Entry_4:
Name: consolesless mfs enumeration
Description: IMAP enumeration without the need to run msfconsole
Note: sourced from https://github.com/carlospolop/legion
Command: msfconsole -q -x 'use auxiliary/scanner/imap/imap_version; set RHOSTS {IP}; set RPORT 143; run; exit'
```

<figure><img src="/.gitbook/assets/image (675).png" alt=""><figcaption></figcaption></figure>

Find vulnerabilities that matter most so you can fix them faster. Intruder tracks your attack surface, runs proactive threat scans, finds issues across your whole tech stack, from APIs to web apps and cloud systems. [**Try it for free**](https://www.intruder.io/?utm\_source=referral\&utm\_campaign=hacktricks) today.

{% embed url="https://www.intruder.io/?utm_campaign=hacktricks&utm_source=referral" %}


<details>

<summary><strong>Learn AWS hacking from zero to hero with</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Other ways to support HackTricks:

* If you want to see your **company advertised in HackTricks** or **download HackTricks in PDF** Check the [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Get the [**official PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Discover [**The PEASS Family**](https://opensea.io/collection/the-peass-family), our collection of exclusive [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Join the** ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** me on **Twitter** ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Share your hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
