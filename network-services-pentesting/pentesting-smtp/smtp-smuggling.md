# SMTP Smuggling

<details>

<summary><strong>Leer AWS-hacking vanaf nul tot held met</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Ander maniere om HackTricks te ondersteun:

* As jy jou **maatskappy geadverteer wil sien in HackTricks** of **HackTricks in PDF wil aflaai** Kyk na die [**INSKRYWINGSPLANNE**](https://github.com/sponsors/carlospolop)!
* Kry die [**amptelike PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ontdek [**Die PEASS Familie**](https://opensea.io/collection/the-peass-family), ons versameling van eksklusiewe [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Deel jou hack-truuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-opslag.

</details>

## Basiese Inligting

Hierdie tipe kwesbaarheid is [**oorspronklik ontdek in hierdie pos**](https://sec-consult.com/blog/detail/smtp-smuggling-spoofing-e-mails-worldwide/) waar dit verduidelik word dat dit moontlik is om **diskrepansies in hoe die SMTP-protokol ge√Ønterpreteer word** te misbruik wanneer 'n e-pos afgehandel word, wat 'n aanvaller in staat stel om meer e-posse in die liggaam van die regte een te smokkel, wat dit moontlik maak om ander gebruikers van die geaffekteerde domein te impersoneer (soos admin@outlook.com) deur verdedigings soos SPF te omseil.

### Waarom

Dit is omdat in die SMTP-protokol die **data van die boodskap** wat in die e-pos gestuur moet word, beheer word deur 'n gebruiker (aanvaller) wat spesiaal ontwerpte data kan stuur wat verskille in parserse misbruik wat ekstra e-posse in die ontvanger sal smokkel. Neem 'n kyk na hierdie ge√Øllustreerde voorbeeld van die oorspronklike pos:

<figure><img src="../../.gitbook/assets/image (2).png" alt=""><figcaption><p><a href="https://sec-consult.com/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/SMTP_Smuggling-Overview__09_.png">https://sec-consult.com/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/SMTP_Smuggling-Overview__09_.png</a></p></figcaption></figure>

### Hoe

Om hierdie kwesbaarheid uit te buit, moet 'n aanvaller data stuur wat die **Uitgaande SMPT-bediener dink dat dit net 1 e-pos is, maar die Inkomende SMTP-bediener dink dat daar verskeie e-posse is**.

Die navorsers het ontdek dat verskillende **Inkomende bedieners verskillende karakters as die einde van die data** van die e-posboodskap beskou wat Uitgaande bedieners nie doen nie.\
Byvoorbeeld, 'n gewone einde van die data is `\r\n.\r\n`. Maar as die Inkomende SMTP-bediener ook `\n.\n` ondersteun, kan 'n aanvaller net daardie data by sy e-pos voeg en begin om die SMTP-opdragte** van nuwe eenhede aan te dui om dit soos in die vorige beeld te smokkel.

Dit kan natuurlik net werk as die **Uitgaande SMTP-bediener hierdie data nie ook as die einde van die boodskapdata beskou nie**, want in daardie geval sal dit 2 e-posse sien in plaas van net 1, dus uiteindelik is dit die desinkronisasie wat in hierdie kwesbaarheid misbruik word.

Potensi√´le desinkronisasiedata:

* `\n.\n`
* `\n.\r\n`

Let ook daarop dat die SPF omseil word omdat as jy 'n e-pos smokkel vanaf `admin@outlook.com` van 'n e-pos vanaf `user@outlook.com`, **bly die afzender steeds `outlook.com`.**

## **Verwysings**

* [https://sec-consult.com/blog/detail/smtp-smuggling-spoofing-e-mails-worldwide/](https://sec-consult.com/blog/detail/smtp-smuggling-spoofing-e-mails-worldwide/)

<details>

<summary><strong>Leer AWS-hacking vanaf nul tot held met</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Ander maniere om HackTricks te ondersteun:

* As jy jou **maatskappy geadverteer wil sien in HackTricks** of **HackTricks in PDF wil aflaai** Kyk na die [**INSKRYWINGSPLANNE**](https://github.com/sponsors/carlospolop)!
* Kry die [**amptelike PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ontdek [**Die PEASS Familie**](https://opensea.io/collection/the-peass-family), ons versameling van eksklusiewe [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Deel jou hack-truuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-opslag.

</details>
