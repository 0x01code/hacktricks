# SMTP Smuggling

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Expert en √©quipe rouge AWS de HackTricks)</strong></a><strong>!</strong></summary>

Autres fa√ßons de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFT**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts GitHub.

</details>

## Informations de base

Ce type de vuln√©rabilit√© a √©t√© [**d√©couvert √† l'origine dans ce post**](https://sec-consult.com/blog/detail/smtp-smuggling-spoofing-e-mails-worldwide/) o√π il est expliqu√© qu'il est possible d'**exploiter les divergences dans l'interpr√©tation du protocole SMTP** lors de la finalisation d'un e-mail, permettant √† un attaquant de faire passer plus d'e-mails dans le corps de l'e-mail l√©gitime, permettant d'usurper d'autres utilisateurs du domaine affect√© (comme admin@outlook.com) en contournant les d√©fenses telles que SPF.

### Pourquoi

Cela est d√ª au fait que dans le protocole SMTP, les **donn√©es du message** √† envoyer dans l'e-mail sont contr√¥l√©es par un utilisateur (attaquant) qui pourrait envoyer des donn√©es sp√©cialement con√ßues en abusant des diff√©rences dans les analyseurs qui feront passer des e-mails suppl√©mentaires dans le r√©cepteur. Jetez un ≈ìil √† cet exemple illustr√© du post original :

<figure><img src="../../.gitbook/assets/image (8) (1).png" alt=""><figcaption><p><a href="https://sec-consult.com/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/SMTP_Smuggling-Overview__09_.png">https://sec-consult.com/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/SMTP_Smuggling-Overview__09_.png</a></p></figcaption></figure>

### Comment

Pour exploiter cette vuln√©rabilit√©, un attaquant doit envoyer des donn√©es que le **serveur SMTP sortant pense √™tre juste 1 e-mail mais que le serveur SMTP entrant pense √™tre plusieurs e-mails**.

Les chercheurs ont d√©couvert que diff√©rents **serveurs entrants consid√®rent diff√©rentes caract√®res comme la fin des donn√©es** du message e-mail que les serveurs sortants ne consid√®rent pas.\
Par exemple, une fin r√©guli√®re des donn√©es est `\r\n.\r\n`. Mais si le serveur SMTP entrant prend √©galement en charge `\n.\n`, un attaquant pourrait simplement ajouter **ces donn√©es dans son e-mail et commencer √† indiquer les commandes SMTP** de nouveaux pour les faire passer comme dans l'image pr√©c√©dente.

Bien s√ªr, cela ne fonctionnerait que si le **serveur SMTP sortant ne traite pas non plus ces donn√©es** comme la fin des donn√©es du message, car dans ce cas, il verrait 2 e-mails au lieu de 1, donc √† la fin, c'est la d√©synchronisation qui est exploit√©e dans cette vuln√©rabilit√©.

Donn√©es potentielles de d√©synchronisation :

* `\n.\n`
* `\n.\r\n`

Notez √©galement que le SPF est contourn√© car si vous faites passer un e-mail de `admin@outlook.com` pour un e-mail de `user@outlook.com`, **l'exp√©diteur est toujours `outlook.com`.**

## **R√©f√©rences**

* [https://sec-consult.com/blog/detail/smtp-smuggling-spoofing-e-mails-worldwide/](https://sec-consult.com/blog/detail/smtp-smuggling-spoofing-e-mails-worldwide/)

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Expert en √©quipe rouge AWS de HackTricks)</strong></a><strong>!</strong></summary>

Autres fa√ßons de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFT**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts GitHub.

</details>
