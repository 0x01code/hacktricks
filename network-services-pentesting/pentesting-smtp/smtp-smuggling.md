# SMTP Smuggling

<details>

<summary><strong>Aprenda hacking na AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Especialista em Equipe Vermelha AWS da HackTricks)</strong></a><strong>!</strong></summary>

Outras maneiras de apoiar a HackTricks:

* Se voc√™ quiser ver sua **empresa anunciada na HackTricks** ou **baixar o HackTricks em PDF**, verifique os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**swag oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-nos** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para os** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) reposit√≥rios do github.

</details>

## Informa√ß√µes B√°sicas

Esse tipo de vulnerabilidade foi [**originalmente descoberta neste post**](https://sec-consult.com/blog/detail/smtp-smuggling-spoofing-e-mails-worldwide/) onde √© explicado que √© poss√≠vel **explorar discrep√¢ncias na interpreta√ß√£o do protocolo SMTP** ao finalizar um e-mail, permitindo que um atacante contrabandeie mais e-mails no corpo do leg√≠timo, permitindo se passar por outros usu√°rios do dom√≠nio afetado (como admin@outlook.com) contornando defesas como SPF.

### Porqu√™

Isso ocorre porque no protocolo SMTP, os **dados da mensagem** a serem enviados no e-mail s√£o controlados por um usu√°rio (atacante) que poderia enviar dados especialmente elaborados abusando das diferen√ßas nos analisadores que contrabandear√£o e-mails extras no receptor. Veja este exemplo ilustrado do post original:

<figure><img src="../../.gitbook/assets/image (2).png" alt=""><figcaption><p><a href="https://sec-consult.com/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/SMTP_Smuggling-Overview__09_.png">https://sec-consult.com/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/SMTP_Smuggling-Overview__09_.png</a></p></figcaption></figure>

### Como

Para explorar essa vulnerabilidade, um atacante precisa enviar alguns dados que o **servidor SMPT de sa√≠da pensa que √© apenas 1 e-mail, mas o servidor SMTP de entrada pensa que s√£o v√°rios e-mails**.

Os pesquisadores descobriram que diferentes **servidores de entrada consideram diferentes caracteres como o final dos dados** da mensagem de e-mail que os servidores de sa√≠da n√£o consideram.\
Por exemplo, um final regular dos dados √© `\r\n.\r`. Mas se o servidor SMTP de entrada tamb√©m suportar `\n.`, um atacante poderia simplesmente adicionar **esses dados em seu e-mail e come√ßar a indicar os comandos SMTP** de novos para contrabande√°-lo, assim como na imagem anterior.

Claro, isso s√≥ funcionaria se o **servidor SMTP de sa√≠da tamb√©m n√£o tratasse esses dados** como o final dos dados da mensagem, porque nesse caso ele veria 2 e-mails em vez de apenas 1, ent√£o no final √© essa dessincroniza√ß√£o que est√° sendo abusada nessa vulnerabilidade.

Dados potenciais de dessincroniza√ß√£o:

* `\n.`
* `\n.\r`

Tamb√©m observe que o SPF √© contornado porque se voc√™ contrabandear um e-mail de `admin@outlook.com` de um e-mail de `user@outlook.com`, **o remetente ainda √© `outlook.com`.**

## **Refer√™ncias**

* [https://sec-consult.com/blog/detail/smtp-smuggling-spoofing-e-mails-worldwide/](https://sec-consult.com/blog/detail/smtp-smuggling-spoofing-e-mails-worldwide/)

<details>

<summary><strong>Aprenda hacking na AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Especialista em Equipe Vermelha AWS da HackTricks)</strong></a><strong>!</strong></summary>

Outras maneiras de apoiar a HackTricks:

* Se voc√™ quiser ver sua **empresa anunciada na HackTricks** ou **baixar o HackTricks em PDF**, verifique os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**swag oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-nos** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para os** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) reposit√≥rios do github.

</details>
