# SMTP Smuggling

<details>

<summary><strong>Μάθετε το χάκινγκ στο AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Ειδικός Red Team του HackTricks στο AWS)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι υποστήριξης του HackTricks:

* Αν θέλετε να δείτε την **εταιρεία σας διαφημισμένη στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**την Οικογένεια PEASS**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε** στην 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα τηλεγραφήματος**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε τα χάκινγκ κόλπα σας υποβάλλοντας PRs** στα αποθετήρια του [**HackTricks**](https://github.com/carlospolop/hacktricks) και του [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Βασικές Πληροφορίες

Αυτός ο τύπος ευπαθείας ανακαλύφθηκε [**αρχικά σε αυτήν την ανάρτηση**](https://sec-consult.com/blog/detail/smtp-smuggling-spoofing-e-mails-worldwide/) όπου εξηγείται ότι είναι δυνατόν να **εκμεταλλευτείτε αντιφάσεις στον τρόπο με τον οποίο ερμηνεύεται το πρωτόκολλο SMTP** κατά την ολοκλήρωση ενός email, επιτρέποντας σε έναν εισβολέα να εισάγει περισσότερα emails στο σώμα του νόμιμου, επιτρέποντας την υποκρισία άλλων χρηστών του επηρεασμένου τομέα (όπως το admin@outlook.com) παρακάμπτοντας τις αμυντικές μέθοδους όπως το SPF.

### Γιατί

Αυτό συμβαίνει επειδή στο πρωτόκολλο SMTP, τα **δεδομένα του μηνύματος** που πρόκειται να σταλούν στο email ελέγχονται από έναν χρήστη (εισβολέα) ο οποίος θα μπορούσε να στείλει ειδικά διαμορφωμένα δεδομένα εκμεταλλευόμενος τις διαφορές στους αναλυτές που θα εισάγουν επιπλέον emails στον παραλήπτη. Ρίξτε μια ματιά σε αυτό το εικονογραφημένο παράδειγμα από την αρχική ανάρτηση:

<figure><img src="../../.gitbook/assets/image (2).png" alt=""><figcaption><p><a href="https://sec-consult.com/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/SMTP_Smuggling-Overview__09_.png">https://sec-consult.com/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/SMTP_Smuggling-Overview__09_.png</a></p></figcaption></figure>

### Πώς

Για να εκμεταλλευτεί αυτήν την ευπαθεία, ένας εισβολέας πρέπει να στείλει κάποια δεδομένα τα οποία ο **Εξερχόμενος διακομιστής SMPT νομίζει ότι είναι απλώς 1 email αλλά ο Εισερχόμενος διακομιστής SMTP νομίζει ότι υπάρχουν πολλά emails**.

Οι ερευνητές ανακάλυψαν ότι διαφορετικοί **Εισερχόμενοι διακομιστές θεωρούν διαφορετικούς χαρακτήρες ως το τέλος των δεδομένων** του μηνύματος email που οι Εξερχόμενοι διακομιστές δεν θεωρούν.\
Για παράδειγμα, ένα κανονικό τέλος δεδομένων είναι `\r\n.\r`. Αλλά αν ο Εισερχόμενος διακομιστής SMTP υποστηρίζει επίσης το `\n.`, ένας εισβολέας θα μπορούσε απλώς να προσθέσει **αυτά τα δεδομένα στο email του και να αρχίσει να υποδεικνύει τις εντολές SMTP** ενός νέου για να το εισάγει όπως στην προηγούμενη εικόνα.

Φυσικά, αυτό θα μπορούσε να λειτουργήσει μόνο αν ο **Εξερχόμενος διακομιστής SMTP δεν θεωρεί επίσης αυτά τα δεδομένα** ως το τέλος των δεδομένων του μηνύματος, επειδή σε αυτήν την περίπτωση θα δει 2 emails αντί για 1, οπότε στο τέλος αυτή είναι η ασυγχρονισμένη λειτουργία που εκμεταλλεύεται αυτή η ευπαθεία.

Δυνητικά δεδομένα ασυγχρονισμού:

* `\n.`
* `\n.\r`

Επίσης, σημειώστε ότι το SPF παρακάμπτεται επειδή αν εισάγετε λαθρεμπορημένο email από το `admin@outlook.com` από ένα email από το `user@outlook.com`, **ο αποστολέας παραμένει `outlook.com`.**

## **Αναφορές**

* [https://sec-consult.com/blog/detail/smtp-smuggling-spoofing-e-mails-worldwide/](https://sec-consult.com/blog/detail/smtp-smuggling-spoofing-e-mails-worldwide/)

<details>

<summary><strong>Μάθετε το χάκινγκ στο AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Ειδικός Red Team του HackTricks στο AWS)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι υποστήριξης του HackTricks:

* Αν θέλετε να δείτε την **εταιρεία σας διαφημισμένη στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**την Οικογένεια PEASS**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε** στην 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα τηλεγραφήματος**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε τα χάκινγκ κόλπα σας υποβάλλοντας PRs** στα αποθετήρια του [**HackTricks**](https://github.com/carlospolop/hacktricks) και του [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
