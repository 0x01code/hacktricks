# SMTP-Schmuggel

<details>

<summary><strong>Erlernen Sie AWS-Hacking von Null auf Held mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks beworben sehen m√∂chten** oder **HackTricks im PDF-Format herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merchandise**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositories einreichen.

</details>

## Grundlegende Informationen

Diese Art von Schwachstelle wurde [**urspr√ºnglich in diesem Beitrag entdeckt**](https://sec-consult.com/blog/detail/smtp-smuggling-spoofing-e-mails-worldwide/), in dem erkl√§rt wird, dass es m√∂glich ist, **Diskrepanzen bei der Interpretation des SMTP-Protokolls auszunutzen**, um beim Abschluss einer E-Mail mehr E-Mails im Text der legitimen E-Mail zu schmuggeln. Dies erm√∂glicht es einem Angreifer, andere Benutzer der betroffenen Dom√§ne (wie admin@outlook.com) zu imitieren und Verteidigungen wie SPF zu umgehen.

### Warum

Dies liegt daran, dass im SMTP-Protokoll die **Daten der Nachricht**, die in der E-Mail gesendet werden sollen, von einem Benutzer (Angreifer) kontrolliert werden, der speziell gestaltete Daten senden k√∂nnte, die Unterschiede in Parsern missbrauchen, um zus√§tzliche E-Mails im Empf√§nger zu schmuggeln. Schauen Sie sich dieses illustrierte Beispiel aus dem Originalbeitrag an:

<figure><img src="../../.gitbook/assets/image (2).png" alt=""><figcaption><p><a href="https://sec-consult.com/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/SMTP_Smuggling-Overview__09_.png">https://sec-consult.com/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/SMTP_Smuggling-Overview__09_.png</a></p></figcaption></figure>

### Wie

Um diese Schwachstelle auszunutzen, muss ein Angreifer einige Daten senden, die der **Outbound-SMPT-Server f√ºr nur 1 E-Mail h√§lt, w√§hrend der Inbound-SMTP-Server denkt, dass es mehrere E-Mails sind**.

Die Forscher stellten fest, dass verschiedene **Inbound-Server verschiedene Zeichen als Ende der Daten** der E-Mail-Nachricht betrachten, die Outbound-Server nicht betrachten.\
Beispielsweise ist ein regul√§res Ende der Daten `\r\n.\r\n`. Aber wenn der Inbound-SMTP-Server auch `\n.\n` unterst√ºtzt, k√∂nnte ein Angreifer einfach **diese Daten seiner E-Mail hinzuf√ºgen und die SMTP-Befehle** eines neuen starten, um sie genauso zu schmuggeln wie im vorherigen Bild.

Nat√ºrlich k√∂nnte dies nur funktionieren, wenn der **Outbound-SMTP-Server diese Daten nicht auch als Ende der Nachrichtendaten behandelt**, da er in diesem Fall 2 E-Mails anstelle von nur 1 sehen w√ºrde. Am Ende wird also die Desynchronisation ausgenutzt, die diese Schwachstelle ausnutzt.

Potenzielle Desynchronisationsdaten:

* `\n.\n`
* `\n.\r\n`

Beachten Sie auch, dass SPF umgangen wird, weil wenn Sie eine E-Mail von `admin@outlook.com` aus einer E-Mail von `user@outlook.com` schmuggeln, **der Absender immer noch `outlook.com` ist**.

## **Referenzen**

* [https://sec-consult.com/blog/detail/smtp-smuggling-spoofing-e-mails-worldwide/](https://sec-consult.com/blog/detail/smtp-smuggling-spoofing-e-mails-worldwide/)

<details>

<summary><strong>Erlernen Sie AWS-Hacking von Null auf Held mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks beworben sehen m√∂chten** oder **HackTricks im PDF-Format herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merchandise**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositories einreichen.

</details>
