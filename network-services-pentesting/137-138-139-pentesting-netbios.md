## Servicio de nombres NetBios

* Servicio de nombres para registro y resoluci√≥n de nombres (puertos: 137/udp y 137/tcp).
* Servicio de distribuci√≥n de datagramas para comunicaci√≥n sin conexi√≥n (puerto: 138/udp).
* Servicio de sesi√≥n para comunicaci√≥n orientada a conexi√≥n (puerto: 139/tcp).

### Servicio de nombres

Cada m√°quina debe tener un nombre dentro de la red NetBios. Para solicitar un nombre, una m√°quina debe enviar un paquete "Consulta de nombre" en difusi√≥n y si alguien responde que ya est√° usando ese nombre, la m√°quina puede usar ese nombre. Si hay un servidor de Servicio de Nombres, la computadora podr√≠a preguntar al servidor de Servicio de Nombres si alguien est√° usando el nombre que quiere usar.

Para descubrir la direcci√≥n IP de un nombre, una PC debe enviar un paquete "Consulta de nombre" y esperar si alguien responde. Si hay un servidor de Servicio de Nombres, la PC puede preguntarle por la IP del nombre.
```bash
PORT    STATE SERVICE    VERSION
137/udp open  netbios-ns Samba nmbd netbios-ns (workgroup: WORKGROUP)
```
Enumerar un servicio NetBIOS te permite obtener los nombres que est√° utilizando el servidor y la direcci√≥n MAC del servidor.
```bash
nmblookup -A <IP>
nbtscan <IP>/30
sudo nmap -sU -sV -T4 --script nbstat.nse -p137 -Pn -n <IP>
```
### Servicio de Distribuci√≥n de Datagramas

Los datagramas de NetBIOS se env√≠an a trav√©s de UDP. Un datagrama se env√≠a con un paquete "Directo √önico" o "Directo de Grupo" si se env√≠a a un nombre de NetBIOS en particular, o con un paquete "Broadcast" si se env√≠a a todos los nombres de NetBIOS en la red.
```bash
PORT    STATE         SERVICE     VERSION
138/udp open|filtered netbios-dgm
```
### Servicio de Sesi√≥n

El modo de sesi√≥n permite que dos computadoras establezcan una conexi√≥n para una "conversaci√≥n", permite manejar mensajes m√°s grandes y proporciona detecci√≥n y recuperaci√≥n de errores.

Las sesiones se establecen intercambiando paquetes. La computadora que establece la sesi√≥n intenta hacer una conexi√≥n [TCP](https://en.wikipedia.org/wiki/Transmission\_Control\_Protocol) al puerto 139 de la computadora con la que se establecer√° la sesi√≥n. Si se establece la conexi√≥n, la computadora que establece la sesi√≥n env√≠a a trav√©s de la conexi√≥n un paquete de "Solicitud de Sesi√≥n" con los nombres NetBIOS de la aplicaci√≥n que establece la sesi√≥n y el nombre NetBIOS al que se establecer√° la sesi√≥n. La computadora con la que se establecer√° la sesi√≥n responder√° con una "Respuesta Positiva de Sesi√≥n" indicando que se puede establecer una sesi√≥n o una "Respuesta Negativa de Sesi√≥n" indicando que no se puede establecer una sesi√≥n (ya sea porque esa computadora no est√° escuchando sesiones que se establecen con ese nombre o porque no hay recursos disponibles para establecer una sesi√≥n con ese nombre).

Los datos se transmiten durante una sesi√≥n establecida mediante paquetes de Mensaje de Sesi√≥n.

TCP maneja el control de flujo y la retransmisi√≥n de todos los paquetes de servicio de sesi√≥n, y la divisi√≥n del flujo de datos sobre el cual se transmiten los paquetes en datagramas [IP](https://en.wikipedia.org/wiki/Internet\_Protocol) lo suficientemente peque√±os como para caber en paquetes de capa de enlace.

Las sesiones se cierran cerrando la conexi√≥n TCP.
```bash
PORT      STATE SERVICE      VERSION
139/tcp   open  netbios-ssn  Microsoft Windows netbios-ssn
```
**Lee la siguiente p√°gina para aprender c√≥mo enumerar este servicio:**

{% content-ref url="137-138-139-pentesting-netbios.md" %}
[137-138-139-pentesting-netbios.md](137-138-139-pentesting-netbios.md)
{% endcontent-ref %}

## Comandos Autom√°ticos de HackTricks
```
Protocol_Name: Netbios    #Protocol Abbreviation if there is one.
Port_Number:  137,138,139     #Comma separated if there is more than one.
Protocol_Description: Netbios         #Protocol Abbreviation Spelled out

Entry_1:
  Name: Notes
  Description: Notes for NetBios
  Note: |
    Name service for name registration and resolution (ports: 137/udp and 137/tcp).
    Datagram distribution service for connectionless communication (port: 138/udp).
    Session service for connection-oriented communication (port: 139/tcp).

    Every machine should have a name inside the NetBios network. To request a name, a machine should send a "Name Query" packet in broadcast and if anyone answer that it is already using that name, the machine can use that name. If there is a Name Service server, the computer could ask the Name Service server if someone is using the name that it wants to use.

    https://book.hacktricks.xyz/pentesting/137-138-139-pentesting-netbios

Entry_2:
  Name: Find Names
  Description: Three scans to find the names of the server
  Command: nmblookup -A {IP} &&&& nbtscan {IP}/30 &&&& nmap -sU -sV -T4 --script nbstat.nse -p 137 -Pn -n {IP}
```
<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* ¬øTrabajas en una **empresa de ciberseguridad**? ¬øQuieres ver tu **empresa anunciada en HackTricks**? ¬øO quieres tener acceso a la **√∫ltima versi√≥n de PEASS o descargar HackTricks en PDF**? ¬°Consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obt√©n la [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* **√önete al** [**üí¨**](https://emojipedia.org/speech-balloon/) **grupo de Discord** o al [**grupo de telegram**](https://t.me/peass) o **s√≠gueme en** **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Comparte tus trucos de hacking enviando PRs al** [**repositorio de hacktricks**](https://github.com/carlospolop/hacktricks) **y al** [**repositorio de hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
