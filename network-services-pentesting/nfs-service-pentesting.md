# 2049 - Pentesting Servi√ßo NFS

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Voc√™ trabalha em uma **empresa de ciberseguran√ßa**? Gostaria de ver sua **empresa anunciada no HackTricks**? ou gostaria de ter acesso √† **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**? Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* **Junte-se ao** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-me** no **Twitter** **üê¶**[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para o [reposit√≥rio hacktricks](https://github.com/carlospolop/hacktricks) e [reposit√≥rio hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>

## **Informa√ß√µes B√°sicas**

√â um sistema cliente/servidor que permite aos usu√°rios acessar arquivos em uma rede e trat√°-los como se estivessem em um diret√≥rio de arquivos local. Tem o mesmo prop√≥sito que o SMB, mas n√£o pode se comunicar com o SMB.

O protocolo NFS n√£o possui **mecanismo de autentica√ß√£o** ou **autoriza√ß√£o**. A autoriza√ß√£o √© obtida a partir das informa√ß√µes dispon√≠veis no sistema de arquivos, onde o servidor √© respons√°vel por traduzir as informa√ß√µes do **usu√°rio** fornecidas pelo **cliente** para as do **sistema de arquivos** e converter as informa√ß√µes de autoriza√ß√£o correspondentes da maneira mais correta poss√≠vel na sintaxe exigida pelo UNIX.

A autentica√ß√£o mais comum √© via `UID`/`GID` UNIX e `associa√ß√µes de grupos`, raz√£o pela qual essa sintaxe √© a mais prov√°vel de ser aplicada ao protocolo NFS. Um problema √© que o **cliente** e o **servidor** **n√£o necessariamente** precisam ter as **mesmas correspond√™ncias de UID/GID** para usu√°rios e grupos. Nenhuma verifica√ß√£o adicional pode ser feita por parte do servidor. Por isso, o NFS deve ser **apenas** usado com esse m√©todo de autentica√ß√£o em **redes confi√°veis**.

**Porta padr√£o**: 2049/TCP/UDP (exceto a vers√£o 4, que s√≥ precisa de TCP ou UDP).&#x20;
```
2049/tcp open  nfs     2-3 (RPC #100003
```
### Vers√µes

(De [https://academy.hackthebox.com/module/112/section/1068](https://academy.hackthebox.com/module/112/section/1068))

| **Vers√£o** | **Recursos**                                                                                                                                                                                                                                                               |
| ---------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `NFSv2`    | √â **mais antiga** mas √© suportada por muitos sistemas e inicialmente operava totalmente sobre UDP.                                                                                                                                                                        |
| `NFSv3`    | Possui mais recursos, incluindo tamanho de arquivo vari√°vel e melhor relat√≥rio de erros, mas n√£o √© totalmente compat√≠vel com clientes NFSv2.                                                                                                                                |
| `NFSv4`    | Inclui Kerberos, funciona atrav√©s de firewalls e na Internet, **n√£o requer mais portmappers**, suporta ACLs, aplica opera√ß√µes baseadas em estado e fornece melhorias de desempenho e alta **seguran√ßa**. Tamb√©m √© a primeira vers√£o a ter um protocolo baseado em estado. |

## Enumera√ß√£o

### Scripts nmap √∫teis
```bash
nfs-ls #List NFS exports and check permissions
nfs-showmount #Like showmount -e
nfs-statfs #Disk statistics and info from NFS share
```
### M√≥dulos √∫teis do metasploit
```bash
scanner/nfs/nfsmount #Scan NFS mounts and list permissions
```
### Montagem

Para saber **qual pasta** o servidor tem **dispon√≠vel** para montar, voc√™ pode perguntar usando:
```bash
showmount -e <IP>
```
Em seguida, monte usando:
```bash
mount -t nfs [-o vers=2] <ip>:<remote_folder> <local_folder> -o nolock
```
Deve-se especificar para **usar a vers√£o 2** porque ela n√£o possui **nenhuma** forma de **autentica√ß√£o** ou **autoriza√ß√£o**.

**Exemplo:**
```bash
mkdir /mnt/new_back
mount -t nfs [-o vers=2] 10.12.0.150:/backup /mnt/new_back -o nolock
```
## Permiss√µes

Se voc√™ montar uma pasta que cont√©m **arquivos ou pastas acess√≠veis apenas por algum usu√°rio** (por **UID**). Voc√™ pode **criar** **localmente** um usu√°rio com esse **UID** e usar esse **usu√°rio** para **acessar** o arquivo/pasta.

## NSFShell

Para listar, montar e alterar o UID e GID facilmente para ter acesso aos arquivos, voc√™ pode usar [nfsshell](https://github.com/NetDirect/nfsshell).

[Tutorial legal do NFSShell.](https://www.pentestpartners.com/security-blog/using-nfsshell-to-compromise-older-environments/)

## Arquivos de configura√ß√£o
```
/etc/exports
/etc/lib/nfs/etab
```
### Configura√ß√µes perigosas

(De [https://academy.hackthebox.com/module/112/section/1068](https://academy.hackthebox.com/module/112/section/1068))

| **Op√ß√£o**       | **Descri√ß√£o**                                                                                                      |
| ---------------- | -------------------------------------------------------------------------------------------------------------------- |
| `rw`             | Permiss√µes de leitura e escrita.                                                                                          |
| `insecure`       | Portas acima de 1024 ser√£o usadas.                                                                                       |
| `nohide`         | Se outro sistema de arquivos foi montado abaixo de um diret√≥rio exportado, este diret√≥rio √© exportado por sua pr√≥pria entrada de exporta√ß√£o. |
| `no_root_squash` | Todos os arquivos criados pelo root s√£o mantidos com o UID/GID 0.                                                               |
| `no_all_squash`  |                                                                                                                      |

## Escala√ß√£o de privil√©gios usando configura√ß√µes incorretas do NFS

[Escala√ß√£o de privil√©gios do NFS no_root_squash e no_all_squash](../linux-hardening/privilege-escalation/nfs-no_root_squash-misconfiguration-pe.md)

## Comandos Autom√°ticos do HackTricks
```
Protocol_Name: NFS    #Protocol Abbreviation if there is one.
Port_Number:  2049     #Comma separated if there is more than one.
Protocol_Description: Network File System         #Protocol Abbreviation Spelled out

Entry_1:
Name: Notes
Description: Notes for NFS
Note: |
It is a client/server system that allows users to access files across a network and treat them as if they resided in a local file directory.

#apt install nfs-common
showmount 10.10.10.180      ~or~showmount -e 10.10.10.180
should show you available shares (example /home)

mount -t nfs -o ver=2 10.10.10.180:/home /mnt/
cd /mnt
nano into /etc/passwd and change the uid (probably 1000 or 1001) to match the owner of the files if you are not able to get in

https://book.hacktricks.xyz/pentesting/nfs-service-pentesting

Entry_2:
Name: Nmap
Description: Nmap with NFS Scripts
Command: nmap --script=nfs-ls.nse,nfs-showmount.nse,nfs-statfs.nse -p 2049 {IP}
```
<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Trabalha em uma **empresa de ciberseguran√ßa**? Gostaria de ver sua **empresa anunciada no HackTricks**? ou gostaria de ter acesso √† **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**? Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* **Junte-se ao** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-me no** **Twitter** **üê¶**[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para o [reposit√≥rio hacktricks](https://github.com/carlospolop/hacktricks) e [reposit√≥rio hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>
