# 2049 - Pentesting des NFS-Dienstes

<details>

<summary><strong>Lernen Sie das Hacken von AWS von Grund auf mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Arbeiten Sie in einem **Cybersicherheitsunternehmen**? M√∂chten Sie Ihr **Unternehmen in HackTricks bewerben**? Oder m√∂chten Sie Zugriff auf die **neueste Version von PEASS oder HackTricks im PDF-Format** haben? √úberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merchandise**](https://peass.creator-spring.com)
* **Treten Sie der** [**üí¨**](https://emojipedia.org/speech-balloon/) [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie mir auf **Twitter** üê¶[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an das [hacktricks repo](https://github.com/carlospolop/hacktricks) und das [hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)** senden.

</details>

## **Grundlegende Informationen**

**NFS** ist ein System, das f√ºr **Client/Server** entwickelt wurde und es Benutzern erm√∂glicht, nahtlos auf Dateien in einem Netzwerk zuzugreifen, als ob sich diese Dateien in einem lokalen Verzeichnis befinden w√ºrden.

Ein bemerkenswerter Aspekt dieses Protokolls ist das Fehlen von integrierten **Authentifizierungs-** oder **Autorisierungsmechanismen**. Stattdessen beruht die Autorisierung auf **Dateisysteminformationen**, wobei der Server damit beauftragt ist, die vom Client bereitgestellten Benutzerinformationen in das vom Dateisystem erforderliche **Autorisierungsformat** zu √ºbersetzen, das haupts√§chlich der **UNIX-Syntax** folgt.

Die Authentifizierung erfolgt in der Regel √ºber **UNIX-`UID`/`GID`-Kennungen und Gruppenmitgliedschaften**. Es besteht jedoch eine Herausforderung aufgrund der m√∂glichen Unstimmigkeit in den **`UID`/`GID`-Zuordnungen** zwischen Clients und Servern, wodurch dem Server keine zus√§tzliche √úberpr√ºfung erm√∂glicht wird. Folglich eignet sich das Protokoll am besten f√ºr die Verwendung in **vertrauensw√ºrdigen Netzwerken**, da es auf dieser Authentifizierungsmethode beruht.

**Standardport**: 2049/TCP/UDP (au√üer Version 4, hier wird nur TCP oder UDP ben√∂tigt).&#x20;
```
2049/tcp open  nfs     2-3 (RPC #100003
```
### Versionen

- **NFSv2**: Diese Version ist bekannt f√ºr ihre breite Kompatibilit√§t mit verschiedenen Systemen und markiert ihre Bedeutung durch anf√§ngliche Operationen √ºberwiegend √ºber UDP. Als **√§lteste** in der Serie legte sie den Grundstein f√ºr zuk√ºnftige Entwicklungen.

- **NFSv3**: Mit einer Reihe von Verbesserungen eingef√ºhrt, erweiterte NFSv3 seinen Vorg√§nger durch Unterst√ºtzung variabler Dateigr√∂√üen und verbesserte Fehlerberichterstattungsmechanismen. Trotz seiner Fortschritte stie√ü es an Grenzen bei der vollst√§ndigen Abw√§rtskompatibilit√§t mit NFSv2-Clients.

- **NFSv4**: Eine wegweisende Version in der NFS-Serie, brachte NFSv4 eine Reihe von Funktionen mit sich, die darauf abzielten, den Dateiaustausch √ºber Netzwerke zu modernisieren. Bemerkenswerte Verbesserungen sind die Integration von Kerberos f√ºr **hohe Sicherheit**, die F√§higkeit, Firewalls zu durchqueren und √ºber das Internet zu arbeiten, ohne Portmapper zu ben√∂tigen, Unterst√ºtzung f√ºr Access Control Lists (ACLs) und die Einf√ºhrung von zustandsbasierten Operationen. Die Leistungsverbesserungen und die √úbernahme eines zustandsbehafteten Protokolls zeichnen NFSv4 als entscheidenden Fortschritt in den Technologien f√ºr den Netzwerkdateiaustausch aus.

Jede Version von NFS wurde entwickelt, um den sich wandelnden Anforderungen von Netzwerkumgebungen gerecht zu werden und Sicherheit, Kompatibilit√§t und Leistung schrittweise zu verbessern.

## Enumeration

### N√ºtzliche nmap-Skripte
```bash
nfs-ls #List NFS exports and check permissions
nfs-showmount #Like showmount -e
nfs-statfs #Disk statistics and info from NFS share
```
### N√ºtzliche Metasploit-Module

Metasploit bietet eine Vielzahl von Modulen, die beim Pentesting von Netzwerkdiensten hilfreich sein k√∂nnen. Hier sind einige n√ºtzliche Module:

- `auxiliary/scanner/nfs/nfsmount`: Dieses Modul erm√∂glicht das Scannen eines Netzwerks nach NFS-Freigaben und das Mounten dieser Freigaben auf dem angreifenden System.
- `auxiliary/scanner/nfs/nfsenum`: Mit diesem Modul k√∂nnen NFS-Freigaben auf einem Zielserver enumeriert werden, um Informationen wie Dateisysteme, Berechtigungen und exportierte Verzeichnisse zu erhalten.
- `auxiliary/scanner/nfs/nfs_showmount`: Dieses Modul zeigt die exportierten NFS-Freigaben auf einem Zielserver an.
- `exploit/linux/nfs/nfsd`: Dieses Modul erm√∂glicht das Ausnutzen einer Schwachstelle im NFS-Dienst auf Linux-Systemen, um eine Remote-Code-Ausf√ºhrung zu erzielen.
- `exploit/solaris/nfs/nfsd`: Mit diesem Modul kann eine Schwachstelle im NFS-Dienst auf Solaris-Systemen ausgenutzt werden, um eine Remote-Code-Ausf√ºhrung zu erreichen.
- `exploit/windows/nfs/nfsd`: Dieses Modul erm√∂glicht das Ausnutzen einer Schwachstelle im NFS-Dienst auf Windows-Systemen, um eine Remote-Code-Ausf√ºhrung zu erzielen.

Diese Module k√∂nnen bei der Identifizierung von Schwachstellen und der Durchf√ºhrung von Angriffen auf NFS-Dienste sehr hilfreich sein.
```bash
scanner/nfs/nfsmount #Scan NFS mounts and list permissions
```
### Mounten

Um zu wissen, **welcher Ordner** vom Server zum Mounten **verf√ºgbar** ist, k√∂nnen Sie ihn mit folgendem Befehl anfragen:
```bash
showmount -e <IP>
```
Dann mounten Sie es mit:
```bash
mount -t nfs [-o vers=2] <ip>:<remote_folder> <local_folder> -o nolock
```
Sie sollten angeben, **Version 2 zu verwenden**, da sie **keine** **Authentifizierung** oder **Autorisierung** hat.

**Beispiel:**
```bash
mkdir /mnt/new_back
mount -t nfs [-o vers=2] 10.12.0.150:/backup /mnt/new_back -o nolock
```
## Berechtigungen

Wenn Sie einen Ordner einbinden, der **Dateien oder Ordner enth√§lt, die nur von einem bestimmten Benutzer** (√ºber **UID**) zug√§nglich sind, k√∂nnen Sie **lokal** einen Benutzer mit dieser **UID** erstellen und diesen **Benutzer** verwenden, um auf die Datei/den Ordner zuzugreifen.

## NSFShell

Um Dateien einfach aufzulisten, einzubinden und die UID und GID zu √§ndern, um Zugriff auf Dateien zu erhalten, k√∂nnen Sie [nfsshell](https://github.com/NetDirect/nfsshell) verwenden.

[Nice NFSShell Tutorial.](https://www.pentestpartners.com/security-blog/using-nfsshell-to-compromise-older-environments/)

## Konfigurationsdateien
```
/etc/exports
/etc/lib/nfs/etab
```
### Gef√§hrliche Einstellungen

- **Lese- und Schreibberechtigungen (`rw`):** Diese Einstellung erlaubt sowohl das Lesen als auch das Schreiben auf das Dateisystem. Es ist wichtig, die Auswirkungen einer solch weitreichenden Zugriffsberechtigung zu ber√ºcksichtigen.

- **Verwendung unsicherer Ports (`insecure`):** Wenn diese Option aktiviert ist, kann das System Ports √ºber 1024 nutzen. Die Sicherheit von Ports √ºber diesem Bereich kann geringer sein, was das Risiko erh√∂ht.

- **Sichtbarkeit von verschachtelten Dateisystemen (`nohide`):** Diese Konfiguration macht Verzeichnisse sichtbar, auch wenn ein anderes Dateisystem unter einem exportierten Verzeichnis eingebunden ist. Jedes Verzeichnis erfordert einen eigenen Exporteintrag f√ºr eine ordnungsgem√§√üe Verwaltung.

- **Eigentum von Root-Dateien (`no_root_squash`):** Mit dieser Einstellung behalten Dateien, die vom Root-Benutzer erstellt wurden, ihre urspr√ºngliche UID/GID von 0 bei, ohne das Prinzip des geringsten Privilegs zu beachten und potenziell √ºberm√§√üige Berechtigungen zu gew√§hren.

- **Kein Squashing aller Benutzer (`no_all_squash`):** Diese Option stellt sicher, dass Benutzeridentit√§ten im gesamten System erhalten bleiben, was zu Berechtigungs- und Zugriffskontrollproblemen f√ºhren kann, wenn sie nicht korrekt behandelt werden.

## Privilege Escalation durch NFS-Fehlkonfigurationen

[NFS no\_root\_squash und no\_all\_squash Privilege Escalation](../linux-hardening/privilege-escalation/nfs-no\_root\_squash-misconfiguration-pe.md)

## HackTricks Automatische Befehle
```
Protocol_Name: NFS    #Protocol Abbreviation if there is one.
Port_Number:  2049     #Comma separated if there is more than one.
Protocol_Description: Network File System         #Protocol Abbreviation Spelled out

Entry_1:
Name: Notes
Description: Notes for NFS
Note: |
NFS is a system designed for client/server that enables users to seamlessly access files over a network as though these files were located within a local directory.

#apt install nfs-common
showmount 10.10.10.180      ~or~showmount -e 10.10.10.180
should show you available shares (example /home)

mount -t nfs -o ver=2 10.10.10.180:/home /mnt/
cd /mnt
nano into /etc/passwd and change the uid (probably 1000 or 1001) to match the owner of the files if you are not able to get in

https://book.hacktricks.xyz/pentesting/nfs-service-pentesting

Entry_2:
Name: Nmap
Description: Nmap with NFS Scripts
Command: nmap --script=nfs-ls.nse,nfs-showmount.nse,nfs-statfs.nse -p 2049 {IP}
```
<details>

<summary><strong>Lernen Sie AWS-Hacking von Null auf Held mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Arbeiten Sie in einem **Cybersicherheitsunternehmen**? M√∂chten Sie Ihr **Unternehmen in HackTricks bewerben**? Oder m√∂chten Sie Zugriff auf die **neueste Version von PEASS oder HackTricks als PDF herunterladen**? √úberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family).
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merchandise**](https://peass.creator-spring.com).
* **Treten Sie der** [**üí¨**](https://emojipedia.org/speech-balloon/) [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie mir auf **Twitter** üê¶[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an das [hacktricks repo](https://github.com/carlospolop/hacktricks) und [hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)** einreichen.

</details>
