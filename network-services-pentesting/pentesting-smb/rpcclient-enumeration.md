# rpcclientの列挙

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks Cloud ☁️</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>🐦 Twitter 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 Youtube 🎥</strong></a></summary>

* **サイバーセキュリティ会社**で働いていますか？ **HackTricksで会社を宣伝**したいですか？または、**PEASSの最新バージョンにアクセスしたり、HackTricksをPDFでダウンロード**したいですか？[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を見つけてください。独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクションです。
* [**公式のPEASS＆HackTricksのグッズ**](https://peass.creator-spring.com)を手に入れましょう。
* [**💬**](https://emojipedia.org/speech-balloon/) [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**telegramグループ**](https://t.me/peass)に**参加**するか、**Twitter**で**フォロー**してください[**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**。**
* **ハッキングのトリックを共有するには、[hacktricks repo](https://github.com/carlospolop/hacktricks)と[hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)**にPRを提出してください。

</details>

<figure><img src="/.gitbook/assets/image (675).png" alt=""><figcaption></figcaption></figure>

脆弱性を見つけて修正を迅速に行いましょう。Intruderは、攻撃対象を追跡し、積極的な脅威スキャンを実行し、APIからWebアプリまで、クラウドシステムを含むテックスタック全体で問題を見つけます。[**無料でお試しください**](https://www.intruder.io/?utm\_source=referral\&utm\_campaign=hacktricks)。

{% embed url="https://www.intruder.io/?utm_campaign=hacktricks&utm_source=referral" %}

***

### **RIDとは**

[相対識別子（RID）](https://docs.microsoft.com/en-us/windows/security/identity-protection/access-control/security-identifiers)は、Windowsがオブジェクトを追跡および識別するために使用する**一意の識別子**（16進数形式で表される）です。これがどのように適用されるかを説明するために、以下の例を見てみましょう。

* NAME\_DOMAIN.LOCALドメインの[SID](https://docs.microsoft.com/en-us/windows/security/identity-protection/access-control/security-identifiers)は次のようになります：`S-1-5-21-1038751438-1834703946-36937684957`。
* ドメイン内でオブジェクトが作成されると、上記の数値（SID）はRIDと組み合わされ、オブジェクトを表すために使用される一意の値が作成されます。
* したがって、RID：\[0x457] Hex 0x457を持つドメインユーザー`john`は、10進数の`1111`に等しい値を持ち、完全なユーザーSIDは次のようになります：`S-1-5-21-1038751438-1834703946-36937684957-1111`。
* これはNAME\_DOMAIN.LOCALドメインの`john`オブジェクトに固有であり、このドメインまたは他のドメインの他のオブジェクトに関連付けられたこのペアの値は表示されません。

[**ここからの定義**](https://academy.hackthebox.com/module/143/section/1269)。

### **rpcclientを使用した列挙**

**このセクションの一部は、"**_**Network Security Assesment 3rd Edition**_**"という本から抜粋されました。**

Sambaの**`rpcclient`**ユーティリティを使用して、**名前付きパイプ**を介して**RPCエンドポイント**とやり取りすることができます。以下は、**SMBセッション**を**確立**するときに発行できるSAMR、LSARPC、およびLSARPC-DSインターフェースに対するコマンドのリストです（しばしば資格情報が必要です）。

#### サーバー情報

* **サーバー情報**：`srvinfo`

#### ユーザーの列挙

* **ユーザーの一覧表示**：`querydispinfo`および`enumdomusers`
* **ユーザーの詳細情報の取得**：`queryuser <0xrid>`
* **ユーザーグループの取得**：`queryusergroups <0xrid>`
* **ユーザーのSIDの取得**：`lookupnames <username>`
* **ユーザーエイリアスの取得**：`queryuseraliases [builtin|domain] <sid>`
```bash
# Brute-Force users RIDs
for i in $(seq 500 1100); do
rpcclient -N -U "" 10.129.14.128 -c "queryuser 0x$(printf '%x\n' $i)" | grep "User Name\|user_rid\|group_rid" && echo "";
done

# You can also use samrdump.py for this purpose
```
#### グループの列挙

* **グループの一覧表示**: `enumdomgroups`
* **グループの詳細情報の取得**: `querygroup <0xrid>`
* **グループのメンバーの取得**: `querygroupmem <0xrid>`

#### Aliasgroupsの列挙

* **エイリアスの一覧表示**: `enumalsgroups <builtin|domain>`
* **メンバーの取得**: `queryaliasmem builtin|domain <0xrid>`

#### ドメインの列挙

* **ドメインの一覧表示**: `enumdomains`
* **SIDの取得**: `lsaquery`
* **ドメイン情報の取得**: `querydominfo`

#### 共有の列挙

* **利用可能なすべての共有の列挙**: `netshareenumall`
* **共有に関する情報**: `netsharegetinfo <share>`

#### その他のSID

* **名前からSIDを検索**: `lookupnames <username>`
* **さらなるSIDの検索**: `lsaenumsid`
* **RIDサイクリング（さらなるSIDのチェック）**: `lookupsids <sid>`

#### **追加コマンド**

| **コマンド**         | **インターフェース**                                                                                                                                     | **説明**                                                                                                                           |
| ------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------- |
| queryuser           | SAMR                                                                                                                                              | ユーザー情報の取得                                                                                                                 |
| querygroup          | グループ情報の取得                                                                                                                        |                                                                                                                                           |
| querydominfo        | ドメイン情報の取得                                                                                                                       |                                                                                                                                           |
| enumdomusers        | ドメインユーザーの列挙                                                                                                                            |                                                                                                                                           |
| enumdomgroups       | ドメイングループの列挙                                                                                                                           |                                                                                                                                           |
| createdomuser       | ドメインユーザーの作成                                                                                                                              |                                                                                                                                           |
| deletedomuser       | ドメインユーザーの削除                                                                                                                              |                                                                                                                                           |
| lookupnames         | LSARPC                                                                                                                                            | ユーザー名をSID[a](https://learning.oreilly.com/library/view/network-security-assessment/9781491911044/ch08.html#ch08fn8)値に変換する |
| lookupsids          | SIDをユーザー名に変換する（RID[b](https://learning.oreilly.com/library/view/network-security-assessment/9781491911044/ch08.html#ch08fn9)サイクリング） |                                                                                                                                           |
| lsaaddacctrights    | ユーザーアカウントに権限を追加する                                                                                                                      |                                                                                                                                           |
| lsaremoveacctrights | ユーザーアカウントから権限を削除する                                                                                                                 |                                                                                                                                           |
| dsroledominfo       | LSARPC-DS                                                                                                                                         | プライマリドメイン情報の取得                                                                                                            |
| dsenumdomtrusts     | ADフォレスト内の信頼されたドメインの列挙                                                                                                     |                                                                                                                                           |

**samrdump**と**rpcdump**の動作をより理解するためには、[**Pentesting MSRPC**](../135-pentesting-msrpc.md)を読むべきです。

<figure><img src="/.gitbook/assets/image (675).png" alt=""><figcaption></figcaption></figure>

重要な脆弱性を見つけて、より速く修正できるようにしましょう。Intruderは攻撃対象を追跡し、積極的な脅威スキャンを実行し、APIからWebアプリまで、クラウドシステムまで、技術スタック全体で問題を見つけます。[**無料でお試しください**](https://www.intruder.io/?utm\_source=referral\&utm\_campaign=hacktricks)。

{% embed url="https://www.intruder.io/?utm_campaign=hacktricks&utm_source=referral" %}


<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks Cloud ☁️</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>🐦 Twitter 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 Youtube 🎥</strong></a></summary>

* **サイバーセキュリティ企業**で働いていますか？ **HackTricksで会社を宣伝**したいですか？または、**PEASSの最新バージョンやHackTricksのPDFをダウンロード**したいですか？[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を見つけてください、私たちの独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクションを！
* [**公式のPEASS＆HackTricksのグッズ**](https://peass.creator-spring.com)を手に入れましょう
* [**💬**](https://emojipedia.org/speech-balloon/) [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**telegramグループ**](https://t.me/peass)に参加するか、**Twitter** [**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**をフォローしてください**。
* **ハッキングのトリックを共有するには、[hacktricksリポジトリ](https://github.com/carlospolop/hacktricks)と[hacktricks-cloudリポジトリ](https://github.com/carlospolop/hacktricks-cloud)にPRを提出してください**。

</details>
