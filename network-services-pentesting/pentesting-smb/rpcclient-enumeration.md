# rpcclient Enumeration

<details>

<summary><strong>Lernen Sie AWS-Hacking von Grund auf mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Arbeiten Sie in einem **Cybersecurity-Unternehmen**? M√∂chten Sie Ihr **Unternehmen in HackTricks bewerben**? Oder m√∂chten Sie Zugriff auf die **neueste Version von PEASS oder HackTricks im PDF-Format** haben? √úberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merchandise**](https://peass.creator-spring.com)
* **Treten Sie der** [**üí¨**](https://emojipedia.org/speech-balloon/) [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegramm-Gruppe**](https://t.me/peass) bei oder **folgen** Sie mir auf **Twitter** üê¶[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an das [hacktricks-Repository](https://github.com/carlospolop/hacktricks) und das [hacktricks-cloud-Repository](https://github.com/carlospolop/hacktricks-cloud) senden**.

</details>

<figure><img src="/.gitbook/assets/image (675).png" alt=""><figcaption></figcaption></figure>

Finden Sie die wichtigsten Sicherheitsl√ºcken, damit Sie sie schneller beheben k√∂nnen. Intruder verfolgt Ihre Angriffsfl√§che, f√ºhrt proaktive Bedrohungsscans durch und findet Probleme in Ihrer gesamten Technologie-Stack, von APIs √ºber Webanwendungen bis hin zu Cloud-Systemen. [**Probieren Sie es noch heute kostenlos aus**](https://www.intruder.io/?utm\_source=referral\&utm\_campaign=hacktricks).

{% embed url="https://www.intruder.io/?utm_campaign=hacktricks&utm_source=referral" %}

***

### **Was ist eine RID**

### √úberblick √ºber Relative Identifiers (RID) und Security Identifiers (SID)

**Relative Identifiers (RID)** und **Security Identifiers (SID)** sind Schl√ºsselkomponenten in Windows-Betriebssystemen zur eindeutigen Identifizierung und Verwaltung von Objekten wie Benutzern und Gruppen in einem Netzwerkdienst.

- **SIDs** dienen als eindeutige Identifikatoren f√ºr Dom√§nen und stellen sicher, dass jede Dom√§ne unterscheidbar ist.
- **RIDs** werden an SIDs angeh√§ngt, um eindeutige Identifikatoren f√ºr Objekte innerhalb dieser Dom√§nen zu erstellen. Diese Kombination erm√∂glicht eine pr√§zise Verfolgung und Verwaltung von Berechtigungen und Zugriffskontrollen f√ºr Objekte.

Beispielsweise k√∂nnte ein Benutzer mit dem Namen `pepe` einen eindeutigen Identifikator haben, der die SID der Dom√§ne mit seiner spezifischen RID kombiniert, dargestellt sowohl in hexadezimaler (`0x457`) als auch in dezimaler (`1111`) Form. Dies ergibt einen vollst√§ndigen und eindeutigen Identifikator f√ºr pepe innerhalb der Dom√§ne wie: `S-1-5-21-1074507654-1937615267-42093643874-1111`.


### **Enumeration mit rpcclient**

Das Dienstprogramm **`rpcclient`** von Samba wird verwendet, um mit **RPC-Endpunkten √ºber benannte Pipes** zu interagieren. Nachdem eine **SMB-Sitzung hergestellt** wurde, k√∂nnen die folgenden Befehle an die Schnittstellen SAMR, LSARPC und LSARPC-DS gesendet werden, wobei oft Anmeldeinformationen erforderlich sind.

#### Serverinformationen

* Um **Serverinformationen zu erhalten**, wird der Befehl `srvinfo` verwendet.

#### Enumeration von Benutzern

* **Benutzer k√∂nnen aufgelistet** werden mit: `querydispinfo` und `enumdomusers`.
* **Details zu einem Benutzer** mit: `queryuser <0xrid>`.
* **Gruppen eines Benutzers** mit: `queryusergroups <0xrid>`.
* Die **SID eines Benutzers wird abgerufen** durch: `lookupnames <Benutzername>`.
* **Aliasnamen von Benutzern** mit: `queryuseraliases [builtin|domain] <sid>`.
```bash
# Users' RIDs-forced
for i in $(seq 500 1100); do
rpcclient -N -U "" [IP_ADDRESS] -c "queryuser 0x$(printf '%x\n' $i)" | grep "User Name\|user_rid\|group_rid" && echo "";
done

# samrdump.py can also serve this purpose
```
#### Enumeration von Gruppen

* **Gruppen** mit: `enumdomgroups`.
* **Details einer Gruppe** mit: `querygroup <0xrid>`.
* **Mitglieder einer Gruppe** durch: `querygroupmem <0xrid>`.

#### Enumeration von Alias-Gruppen

* **Alias-Gruppen** mit: `enumalsgroups <builtin|domain>`.
* **Mitglieder einer Alias-Gruppe** mit: `queryaliasmem builtin|domain <0xrid>`.

#### Enumeration von Dom√§nen

* **Dom√§nen** mit: `enumdomains`.
* **Die SID einer Dom√§ne wird abgerufen** durch: `lsaquery`.
* **Dom√§neninformationen werden abgerufen** mit: `querydominfo`.

#### Enumeration von Freigaben

* **Alle verf√ºgbaren Freigaben** mit: `netshareenumall`.
* **Informationen √ºber eine bestimmte Freigabe werden abgerufen** mit: `netsharegetinfo <share>`.

#### Zus√§tzliche Operationen mit SIDs

* **SIDs nach Namen** mit: `lookupnames <username>`.
* **Weitere SIDs** durch: `lsaenumsid`.
* **RID-Zyklus zur √úberpr√ºfung weiterer SIDs** wird durchgef√ºhrt mit: `lookupsids <sid>`.

#### **Zus√§tzliche Befehle**

| **Befehl**           | **Schnittstelle**                                                                                                                                  | **Beschreibung**                                                                                                                           |
| -------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------- |
| queryuser            | SAMR                                                                                                                                              | Benutzerinformationen abrufen                                                                                                              |
| querygroup           | Gruppeninformationen abrufen                                                                                                                        |                                                                                                                                           |
| querydominfo         | Dom√§neninformationen abrufen                                                                                                                       |                                                                                                                                           |
| enumdomusers         | Dom√§nenbenutzer auflisten                                                                                                                          |                                                                                                                                           |
| enumdomgroups        | Dom√§nengruppen auflisten                                                                                                                           |                                                                                                                                           |
| createdomuser        | Dom√§nenbenutzer erstellen                                                                                                                          |                                                                                                                                           |
| deletedomuser        | Dom√§nenbenutzer l√∂schen                                                                                                                            |                                                                                                                                           |
| lookupnames          | LSARPC                                                                                                                                            | Benutzernamen zu SID[a](https://learning.oreilly.com/library/view/network-security-assessment/9781491911044/ch08.html#ch08fn8)-Werten suchen |
| lookupsids           | SIDs zu Benutzernamen suchen (RID[b](https://learning.oreilly.com/library/view/network-security-assessment/9781491911044/ch08.html#ch08fn9)-Zyklus) |                                                                                                                                           |
| lsaaddacctrights     | Rechte zu einem Benutzerkonto hinzuf√ºgen                                                                                                           |                                                                                                                                           |
| lsaremoveacctrights  | Rechte von einem Benutzerkonto entfernen                                                                                                           |                                                                                                                                           |
| dsroledominfo        | LSARPC-DS                                                                                                                                         | Prim√§re Dom√§neninformationen abrufen                                                                                                      |
| dsenumdomtrusts      | Vertrauensw√ºrdige Dom√§nen in einem AD-Forest auflisten                                                                                             |                                                                                                                                           |

Um die Tools **samrdump** und **rpcdump** besser zu verstehen, sollten Sie [**Pentesting MSRPC**](../135-pentesting-msrpc.md) lesen.

<figure><img src="/.gitbook/assets/image (675).png" alt=""><figcaption></figcaption></figure>

Finden Sie die wichtigsten Schwachstellen, damit Sie sie schneller beheben k√∂nnen. Intruder verfolgt Ihre Angriffsfl√§che, f√ºhrt proaktive Bedrohungsscans durch und findet Probleme in Ihrer gesamten Technologie-Stack, von APIs √ºber Webanwendungen bis hin zu Cloud-Systemen. [**Probieren Sie es noch heute kostenlos aus**](https://www.intruder.io/?utm\_source=referral\&utm\_campaign=hacktricks).

{% embed url="https://www.intruder.io/?utm_campaign=hacktricks&utm_source=referral" %}


<details>

<summary><strong>Lernen Sie AWS-Hacking von Null auf Held mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Arbeiten Sie in einem **Cybersecurity-Unternehmen**? M√∂chten Sie Ihr **Unternehmen in HackTricks bewerben**? Oder m√∂chten Sie Zugriff auf die **neueste Version des PEASS oder HackTricks in PDF** haben? √úberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merch**](https://peass.creator-spring.com)
* **Treten Sie der** [**üí¨**](https://emojipedia.org/speech-balloon/) [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegramm-Gruppe**](https://t.me/peass) bei oder **folgen** Sie mir auf **Twitter** üê¶[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an das [hacktricks-Repo](https://github.com/carlospolop/hacktricks) und das [hacktricks-cloud-Repo](https://github.com/carlospolop/hacktricks-cloud) senden**.

</details>
