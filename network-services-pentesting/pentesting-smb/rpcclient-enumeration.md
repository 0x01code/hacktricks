# Wyliczanie rpcclient

<details>

<summary><strong>Naucz się hakować AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Czy pracujesz w **firmie z branży cyberbezpieczeństwa**? Chcesz zobaczyć, jak Twoja **firma jest reklamowana na HackTricks**? lub chcesz mieć dostęp do **najnowszej wersji PEASS lub pobrać HackTricks w formacie PDF**? Sprawdź [**PLANY SUBSKRYPCYJNE**](https://github.com/sponsors/carlospolop)!
* Odkryj [**Rodzinę PEASS**](https://opensea.io/collection/the-peass-family), naszą kolekcję ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* Zdobądź [**oficjalne gadżety PEASS & HackTricks**](https://peass.creator-spring.com)
* **Dołącz do** [**💬**](https://emojipedia.org/speech-balloon/) [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **śledź** mnie na **Twitterze** 🐦[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel się swoimi sztuczkami hakerskimi, przesyłając PR-y do [repozytorium hacktricks](https://github.com/carlospolop/hacktricks) i [repozytorium hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>

### **Co to jest RID**

### Przegląd Identyfikatorów Względnych (RID) i Identyfikatorów Bezpieczeństwa (SID)

**Identyfikatory Względne (RID)** i **Identyfikatory Bezpieczeństwa (SID)** są kluczowymi składnikami systemów operacyjnych Windows do unikatowej identyfikacji i zarządzania obiektami, takimi jak użytkownicy i grupy, w domenie sieciowej.

- **SID** służą jako unikatowe identyfikatory domen, zapewniając odróżnialność każdej domeny.
- **RID** są dołączane do SID w celu utworzenia unikatowych identyfikatorów dla obiektów w tych domenach. Ta kombinacja pozwala na precyzyjne śledzenie i zarządzanie uprawnieniami obiektów oraz kontrolami dostępu.

Na przykład użytkownik o nazwie `pepe` może mieć unikatowy identyfikator łączący SID domeny z jego konkretnym RID, reprezentowany zarówno w formacie szesnastkowym (`0x457`), jak i dziesiętnym (`1111`). To skutkuje kompletnym i unikatowym identyfikatorem dla pepe w obrębie domeny, np.: `S-1-5-21-1074507654-1937615267-42093643874-1111`.


### **Wyliczanie za pomocą rpcclient**

Użyteczność narzędzia **`rpcclient`** z Samba polega na interakcji z **punktem końcowym RPC poprzez nazwane potoki**. Poniżej przedstawione są polecenia, które można wydać do interfejsów SAMR, LSARPC i LSARPC-DS po **ustanowieniu sesji SMB**, często wymagającej poświadczeń.

#### Informacje o serwerze

* Aby uzyskać **Informacje o serwerze**: używane jest polecenie `srvinfo`.

#### Wyliczanie użytkowników

* **Użytkownicy mogą być wymienieni** za pomocą: `querydispinfo` i `enumdomusers`.
* **Szczegóły użytkownika** za pomocą: `queryuser <0xrid>`.
* **Grupy użytkownika** za pomocą: `queryusergroups <0xrid>`.
* **SID użytkownika jest pobierane** poprzez: `lookupnames <nazwa_użytkownika>`.
* **Aliasy użytkowników** za pomocą: `queryuseraliases [wbudowane|domena] <sid>`.
```bash
# Users' RIDs-forced
for i in $(seq 500 1100); do
rpcclient -N -U "" [IP_ADDRESS] -c "queryuser 0x$(printf '%x\n' $i)" | grep "User Name\|user_rid\|group_rid" && echo "";
done

# samrdump.py can also serve this purpose
```
#### Wyliczanie Grup

* **Grupy** za pomocą: `enumdomgroups`.
* **Szczegóły grupy** za pomocą: `querygroup <0xrid>`.
* **Członkowie grupy** poprzez: `querygroupmem <0xrid>`.

#### Wyliczanie Grup Aliasowych

* **Grupy aliasowe** za pomocą: `enumalsgroups <builtin|domain>`.
* **Członkowie grupy aliasowej** za pomocą: `queryaliasmem builtin|domain <0xrid>`.

#### Wyliczanie Domen

* **Domeny** za pomocą: `enumdomains`.
* **SID domeny jest pobierane** za pomocą: `lsaquery`.
* **Informacje o domenie są uzyskiwane** za pomocą: `querydominfo`.

#### Wyliczanie Zasobów

* **Wszystkie dostępne zasoby** za pomocą: `netshareenumall`.
* **Informacje o konkretnym zasobie są pobierane** za pomocą: `netsharegetinfo <share>`.

#### Dodatkowe Operacje z SID

* **SIDs według nazwy** za pomocą: `lookupnames <username>`.
* **Więcej SIDs** poprzez: `lsaenumsid`.
* **Cykliczne sprawdzanie RID w celu sprawdzenia więcej SIDs** jest wykonywane za pomocą: `lookupsids <sid>`.

#### **Dodatkowe polecenia**

| **Polecenie**         | **Interfejs**                                                                                                                                     | **Opis**                                                                                                                           |
| ------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------- |
| queryuser           | SAMR                                                                                                                                              | Pobierz informacje o użytkowniku                                                                                                                 |
| querygroup          | Pobierz informacje o grupie                                                                                                                        |                                                                                                                                           |
| querydominfo        | Pobierz informacje o domenie                                                                                                                       |                                                                                                                                           |
| enumdomusers        | Wylicz użytkowników domeny                                                                                                                            |                                                                                                                                           |
| enumdomgroups       | Wylicz grupy domeny                                                                                                                           |                                                                                                                                           |
| createdomuser       | Utwórz użytkownika domeny                                                                                                                              |                                                                                                                                           |
| deletedomuser       | Usuń użytkownika domeny                                                                                                                              |                                                                                                                                           |
| lookupnames         | LSARPC                                                                                                                                            | Wyszukaj nazwy użytkowników do wartości SID[a](https://learning.oreilly.com/library/view/network-security-assessment/9781491911044/ch08.html#ch08fn8) |
| lookupsids          | Wyszukaj SIDs do nazw użytkowników (Cykliczne sprawdzanie RID[b](https://learning.oreilly.com/library/view/network-security-assessment/9781491911044/ch08.html#ch08fn9)) |                                                                                                                                           |
| lsaaddacctrights    | Dodaj prawa do konta użytkownika                                                                                                                      |                                                                                                                                           |
| lsaremoveacctrights | Usuń prawa z konta użytkownika                                                                                                                 |                                                                                                                                           |
| dsroledominfo       | LSARPC-DS                                                                                                                                         | Uzyskaj informacje o głównej domenie                                                                                                            |
| dsenumdomtrusts     | Wylicz zaufane domeny w obrębie lasu AD                                                                                                     |                                                                                                                                           |

Aby **lepiej zrozumieć** jak działają narzędzia _**samrdump**_ **i** _**rpcdump**_ powinieneś przeczytać [**Pentesting MSRPC**](../135-pentesting-msrpc.md).

<details>

<summary><strong>Naucz się hakować AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Czy pracujesz w **firmie cyberbezpieczeństwa**? Chcesz zobaczyć swoją **firmę reklamowaną w HackTricks**? lub chcesz mieć dostęp do **najnowszej wersji PEASS lub pobrać HackTricks w formacie PDF**? Sprawdź [**PLANY SUBSKRYPCYJNE**](https://github.com/sponsors/carlospolop)!
* Odkryj [**Rodzinę PEASS**](https://opensea.io/collection/the-peass-family), naszą kolekcję ekskluzywnych [**NFTs**](https://opensea.io/collection/the-peass-family)
* Zdobądź [**oficjalne gadżety PEASS & HackTricks**](https://peass.creator-spring.com)
* **Dołącz do** [**💬**](https://emojipedia.org/speech-balloon/) [**Grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **śledź** mnie na **Twitterze** 🐦[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel się swoimi sztuczkami hakerskimi, przesyłając PR-y do [repozytorium hacktricks](https://github.com/carlospolop/hacktricks) i [repozytorium hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>
