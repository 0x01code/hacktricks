# rpcclient 열거

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>를 통해 제로에서 영웅까지 AWS 해킹 배우기<strong>!</strong></summary>

* **사이버 보안 회사**에서 일하시나요? **회사를 HackTricks에서 광고**하고 싶으신가요? 아니면 **PEASS의 최신 버전에 액세스하거나 HackTricks를 PDF로 다운로드**하고 싶으신가요? [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)를 확인하세요!
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)를 발견하세요. 독점적인 [**NFTs**](https://opensea.io/collection/the-peass-family) 컬렉션입니다.
* [**공식 PEASS & HackTricks 스웨그**](https://peass.creator-spring.com)를 얻으세요.
* [**💬**](https://emojipedia.org/speech-balloon/) [**Discord 그룹**](https://discord.gg/hRep4RUj7f) 또는 [**텔레그램 그룹**](https://t.me/peass)에 **참여**하거나 **Twitter**에서 **팔로우**하세요 🐦[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **[hacktricks repo](https://github.com/carlospolop/hacktricks)와 [hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)**에 PR을 제출하여 여러분의 해킹 기교를 공유하세요.

</details>

<figure><img src="/.gitbook/assets/image (675).png" alt=""><figcaption></figcaption></figure>

가장 중요한 취약점을 찾아서 더 빠르게 수정하세요. Intruder는 공격 표면을 추적하고 적극적인 위협 스캔을 실행하여 API부터 웹 앱 및 클라우드 시스템까지 전체 기술 스택에서 문제를 찾습니다. [**무료로 시도해보세요**](https://www.intruder.io/?utm\_source=referral\&utm\_campaign=hacktricks) 오늘.

{% embed url="https://www.intruder.io/?utm_campaign=hacktricks&utm_source=referral" %}

***

### **RID란 무엇인가요**

### 상대 식별자(RID) 및 보안 식별자(SID) 개요

**상대 식별자(RID)** 및 **보안 식별자(SID)**는 Windows 운영 체제에서 네트워크 도메인 내에서 사용자 및 그룹과 같은 개체를 고유하게 식별하고 관리하기 위한 주요 구성 요소입니다.

- **SID**는 도메인을 고유하게 식별하여 각 도메인이 구별될 수 있도록 합니다.
- **RID**는 해당 도메인 내의 개체에 대한 고유 식별자를 만들기 위해 SID에 추가됩니다. 이 조합을 통해 개체 권한 및 액세스 제어를 정확하게 추적하고 관리할 수 있습니다.

예를 들어, `pepe`라는 사용자는 도메인의 SID와 해당 RID를 결합하여 고유 식별자를 생성할 수 있습니다. 이는 16진수(`0x457`)와 10진수(`1111`) 형식으로 표시됩니다. 따라서 도메인 내에서 pepe에 대한 완전하고 고유한 식별자는 다음과 같습니다: `S-1-5-21-1074507654-1937615267-42093643874-1111`.


### **rpcclient를 사용한 열거**

Samba의 **`rpcclient`** 유틸리티는 **명명된 파이프를 통해 RPC 엔드포인트와 상호 작용**하기 위해 사용됩니다. **SMB 세션이 설정된 후**에는 SAMR, LSARPC 및 LSARPC-DS 인터페이스에 대해 아래 명령을 사용할 수 있습니다. 이는 종종 자격 증명이 필요합니다.

#### 서버 정보

* **서버 정보를 얻으려면**: `srvinfo` 명령을 사용합니다.

#### 사용자 열거

* **사용자를 나열**하려면: `querydispinfo` 및 `enumdomusers`를 사용합니다.
* **사용자의 세부 정보**는 다음과 같이 얻을 수 있습니다: `queryuser <0xrid>`.
* **사용자의 그룹**은 다음과 같이 얻을 수 있습니다: `queryusergroups <0xrid>`.
* **사용자의 SID를 검색**하려면 다음을 사용합니다: `lookupnames <username>`.
* **사용자의 별칭**은 다음과 같이 얻을 수 있습니다: `queryuseraliases [builtin|domain] <sid>`.
```bash
# Users' RIDs-forced
for i in $(seq 500 1100); do
rpcclient -N -U "" [IP_ADDRESS] -c "queryuser 0x$(printf '%x\n' $i)" | grep "User Name\|user_rid\|group_rid" && echo "";
done

# samrdump.py can also serve this purpose
```
#### 그룹 열거

* `enumdomgroups`를 사용하여 **그룹**을 열거합니다.
* `querygroup <0xrid>`를 사용하여 **그룹의 세부 정보**를 확인합니다.
* `querygroupmem <0xrid>`를 사용하여 **그룹의 구성원**을 확인합니다.

#### 별칭 그룹 열거

* `enumalsgroups <builtin|domain>`을 사용하여 **별칭 그룹**을 열거합니다.
* `queryaliasmem builtin|domain <0xrid>`를 사용하여 **별칭 그룹의 구성원**을 확인합니다.

#### 도메인 열거

* `enumdomains`를 사용하여 **도메인**을 열거합니다.
* `lsaquery`를 사용하여 **도메인의 SID를 검색**합니다.
* `querydominfo`를 사용하여 **도메인 정보를 얻습니다**.

#### 공유 열거

* `netshareenumall`을 사용하여 **모든 사용 가능한 공유**를 열거합니다.
* `netsharegetinfo <share>`를 사용하여 **특정 공유에 대한 정보를 가져옵니다**.

#### SID를 사용한 추가 작업

* `lookupnames <username>`을 사용하여 **이름으로 SID를 검색**합니다.
* `lsaenumsid`를 사용하여 **추가 SID를 검색**합니다.
* `lookupsids <sid>`를 사용하여 **RID 순환을 통해 더 많은 SID를 확인**합니다.

#### **추가 명령어**

| **명령어**           | **인터페이스**                                                                                                                                     | **설명**                                                                                                                           |
| ------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------- |
| queryuser           | SAMR                                                                                                                                              | 사용자 정보를 검색합니다.                                                                                                                 |
| querygroup          | 그룹 정보를 검색합니다.                                                                                                                        |                                                                                                                                           |
| querydominfo        | 도메인 정보를 검색합니다.                                                                                                                       |                                                                                                                                           |
| enumdomusers        | 도메인 사용자를 열거합니다.                                                                                                                            |                                                                                                                                           |
| enumdomgroups       | 도메인 그룹을 열거합니다.                                                                                                                           |                                                                                                                                           |
| createdomuser       | 도메인 사용자를 생성합니다.                                                                                                                              |                                                                                                                                           |
| deletedomuser       | 도메인 사용자를 삭제합니다.                                                                                                                              |                                                                                                                                           |
| lookupnames         | LSARPC                                                                                                                                            | 사용자 이름을 SID[a](https://learning.oreilly.com/library/view/network-security-assessment/9781491911044/ch08.html#ch08fn8) 값으로 변환합니다. |
| lookupsids          | SID를 사용자 이름으로 변환합니다 (RID[b](https://learning.oreilly.com/library/view/network-security-assessment/9781491911044/ch08.html#ch08fn9) 순환) |                                                                                                                                           |
| lsaaddacctrights    | 사용자 계정에 권한을 추가합니다.                                                                                                                      |                                                                                                                                           |
| lsaremoveacctrights | 사용자 계정에서 권한을 제거합니다.                                                                                                                 |                                                                                                                                           |
| dsroledominfo       | LSARPC-DS                                                                                                                                         | 기본 도메인 정보를 가져옵니다.                                                                                                            |
| dsenumdomtrusts     | AD 포레스트 내에서 신뢰하는 도메인을 열거합니다.                                                                                                     |                                                                                                                                           |

**samrdump**와 **rpcdump** 도구가 작동하는 방식을 **더 잘 이해**하려면 [**Pentesting MSRPC**](../135-pentesting-msrpc.md)를 읽어보세요.

<figure><img src="/.gitbook/assets/image (675).png" alt=""><figcaption></figcaption></figure>

가장 중요한 취약점을 찾아서 더 빠르게 수정하세요. Intruder는 공격 표면을 추적하고 예방적인 위협 스캔을 실행하여 API부터 웹 애플리케이션 및 클라우드 시스템까지 전체 기술 스택에서 문제를 찾습니다. [**무료로 사용해보세요**](https://www.intruder.io/?utm\_source=referral\&utm\_campaign=hacktricks)!

{% embed url="https://www.intruder.io/?utm_campaign=hacktricks&utm_source=referral" %}


<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>로 AWS 해킹을 처음부터 전문가까지 배워보세요<strong>!</strong></summary>

* **사이버 보안 회사에서 일하고 계신가요**? **회사를 HackTricks에서 광고**하거나 **PEASS의 최신 버전에 액세스**하거나 **HackTricks를 PDF로 다운로드**하고 싶으신가요? [**구독 요금제**](https://github.com/sponsors/carlospolop)를 확인해보세요!
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)를 발견하세요. 독점적인 [**NFT**](https://opensea.io/collection/the-peass-family) 컬렉션입니다.
* [**공식 PEASS & HackTricks 스웨그**](https://peass.creator-spring.com)를 얻으세요.
* [**💬**](https://emojipedia.org/speech-balloon/) [**Discord 그룹**](https://discord.gg/hRep4RUj7f) 또는 [**텔레그램 그룹**](https://t.me/peass)에 **참여**하거나 **Twitter**에서 저를 **팔로우**하세요 🐦[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **[hacktricks repo](https://github.com/carlospolop/hacktricks) 및 [hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)**에 PR을 제출하여 여러분의 해킹 기법을 공유하세요.

</details>
