# rpcclient enumeration

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

**Try Hard Security Group**

<figure><img src="/.gitbook/assets/telegram-cloud-document-1-5159108904864449420.jpg" alt=""><figcaption></figcaption></figure>

{% embed url="https://discord.gg/tryhardsecurity" %}

***

### –û–≥–ª—è–¥ –≤—ñ–¥–Ω–æ—Å–Ω–∏—Ö —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä—ñ–≤ (RID) —Ç–∞ —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä—ñ–≤ –±–µ–∑–ø–µ–∫–∏ (SID)

**–í—ñ–¥–Ω–æ—Å–Ω—ñ —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä–∏ (RID)** —Ç–∞ **—ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä–∏ –±–µ–∑–ø–µ–∫–∏ (SID)** —î –∫–ª—é—á–æ–≤–∏–º–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏ –≤ –æ–ø–µ—Ä–∞—Ü—ñ–π–Ω–∏—Ö —Å–∏—Å—Ç–µ–º–∞—Ö Windows –¥–ª—è —É–Ω—ñ–∫–∞–ª—å–Ω–æ—ó —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó —Ç–∞ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –æ–±'—î–∫—Ç–∞–º–∏, —Ç–∞–∫–∏–º–∏ —è–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ —Ç–∞ –≥—Ä—É–ø–∏, –≤ –º–µ–∂–∞—Ö –º–µ—Ä–µ–∂–µ–≤–æ–≥–æ –¥–æ–º–µ–Ω—É.

- **SID** —Å–ª—É–≥—É—é—Ç—å —É–Ω—ñ–∫–∞–ª—å–Ω–∏–º–∏ —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä–∞–º–∏ –¥–ª—è –¥–æ–º–µ–Ω—ñ–≤, –∑–∞–±–µ–∑–ø–µ—á—É—é—á–∏ —Ä–æ–∑—Ä—ñ–∑–Ω–µ–Ω–Ω—è –∫–æ–∂–Ω–æ–≥–æ –¥–æ–º–µ–Ω—É.
- **RID** –¥–æ–¥–∞—é—Ç—å—Å—è –¥–æ SID –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —É–Ω—ñ–∫–∞–ª—å–Ω–∏—Ö —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä—ñ–≤ –¥–ª—è –æ–±'—î–∫—Ç—ñ–≤ —É —Ü–∏—Ö –¥–æ–º–µ–Ω–∞—Ö. –¶—è –∫–æ–º–±—ñ–Ω–∞—Ü—ñ—è –¥–æ–∑–≤–æ–ª—è—î —Ç–æ—á–Ω–æ –≤—ñ–¥—Å—Ç–µ–∂—É–≤–∞—Ç–∏ —Ç–∞ —É–ø—Ä–∞–≤–ª—è—Ç–∏ –¥–æ–∑–≤–æ–ª–∞–º–∏ –æ–±'—î–∫—Ç—ñ–≤ —ñ –∫–æ–Ω—Ç—Ä–æ–ª–µ–º –¥–æ—Å—Ç—É–ø—É.

–ù–∞–ø—Ä–∏–∫–ª–∞–¥, –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–∞ —ñ–º'—è `pepe` –º–æ–∂–µ –º–∞—Ç–∏ —É–Ω—ñ–∫–∞–ª—å–Ω–∏–π —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä, —â–æ –ø–æ—î–¥–Ω—É—î SID –¥–æ–º–µ–Ω—É –∑ –π–æ–≥–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏–º RID, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–º —É —à—ñ—Å—Ç–Ω–∞–¥—Ü—è—Ç–∫–æ–≤–æ–º—É (`0x457`) —Ç–∞ –¥–µ—Å—è—Ç–∫–æ–≤–æ–º—É (`1111`) —Ñ–æ—Ä–º–∞—Ç–∞—Ö. –¶–µ –ø—Ä–∏–∑–≤–æ–¥–∏—Ç—å –¥–æ –ø–æ–≤–Ω–æ–≥–æ —Ç–∞ —É–Ω—ñ–∫–∞–ª—å–Ω–æ–≥–æ —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä–∞ –¥–ª—è pepe –≤ –º–µ–∂–∞—Ö –¥–æ–º–µ–Ω—É, —Ç–∞–∫–æ–≥–æ —è–∫: `S-1-5-21-1074507654-1937615267-42093643874-1111`.


### **–ü–µ—Ä–µ—Ä–∞—Ö—É–Ω–æ–∫ –∑ rpcclient**

–£—Ç–∏–ª—ñ—Ç–∞ **`rpcclient`** –∑ Samba –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –≤–∑–∞—î–º–æ–¥—ñ—ó –∑ **RPC –∫—ñ–Ω—Ü–µ–≤–∏–º–∏ —Ç–æ—á–∫–∞–º–∏ —á–µ—Ä–µ–∑ —ñ–º–µ–Ω–æ–≤–∞–Ω—ñ –∫–∞–Ω–∞–ª–∏**. –ù–∏–∂—á–µ –Ω–∞–≤–µ–¥–µ–Ω—ñ –∫–æ–º–∞–Ω–¥–∏, —è–∫—ñ –º–æ–∂–Ω–∞ –≤–∏–∫–æ–Ω–∞—Ç–∏ –Ω–∞ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞—Ö SAMR, LSARPC —Ç–∞ LSARPC-DS –ø—ñ—Å–ª—è –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è **SMB —Å–µ—Å—ñ—ó**, —â–æ —á–∞—Å—Ç–æ –≤–∏–º–∞–≥–∞—î –æ–±–ª—ñ–∫–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö.

#### –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ —Å–µ—Ä–≤–µ—Ä

* –©–æ–± –æ—Ç—Ä–∏–º–∞—Ç–∏ **—ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ —Å–µ—Ä–≤–µ—Ä**: –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –∫–æ–º–∞–Ω–¥–∞ `srvinfo`.

#### –ü–µ—Ä–µ—Ä–∞—Ö—É–Ω–æ–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤

* **–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –º–æ–∂–Ω–∞ –ø–µ—Ä–µ—Ä–∞—Ö—É–≤–∞—Ç–∏** –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é: `querydispinfo` —Ç–∞ `enumdomusers`.
* **–î–µ—Ç–∞–ª—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞** –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é: `queryuser <0xrid>`.
* **–ì—Ä—É–ø–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞** –∑: `queryusergroups <0xrid>`.
* **SID –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –æ—Ç—Ä–∏–º—É—î—Ç—å—Å—è** —á–µ—Ä–µ–∑: `lookupnames <username>`.
* **–ü—Å–µ–≤–¥–æ–Ω—ñ–º–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤** –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é: `queryuseraliases [builtin|domain] <sid>`.
```bash
# Users' RIDs-forced
for i in $(seq 500 1100); do
rpcclient -N -U "" [IP_ADDRESS] -c "queryuser 0x$(printf '%x\n' $i)" | grep "User Name\|user_rid\|group_rid" && echo "";
done

# samrdump.py can also serve this purpose
```
#### Enumeration of Groups

* **–ì—Ä—É–ø–∏** by: `enumdomgroups`.
* **–î–µ—Ç–∞–ª—ñ –≥—Ä—É–ø–∏** with: `querygroup <0xrid>`.
* **–ß–ª–µ–Ω–∏ –≥—Ä—É–ø–∏** through: `querygroupmem <0xrid>`.

#### Enumeration of Alias Groups

* **–ì—Ä—É–ø–∏ –ø—Å–µ–≤–¥–æ–Ω—ñ–º—ñ–≤** by: `enumalsgroups <builtin|domain>`.
* **–ß–ª–µ–Ω–∏ –≥—Ä—É–ø–∏ –ø—Å–µ–≤–¥–æ–Ω—ñ–º—ñ–≤** with: `queryaliasmem builtin|domain <0xrid>`.

#### Enumeration of Domains

* **–î–æ–º–µ–Ω–∏** using: `enumdomains`.
* **SID –¥–æ–º–µ–Ω—É –æ—Ç—Ä–∏–º—É—î—Ç—å—Å—è** through: `lsaquery`.
* **–Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –¥–æ–º–µ–Ω –æ—Ç—Ä–∏–º—É—î—Ç—å—Å—è** by: `querydominfo`.

#### Enumeration of Shares

* **–í—Å—ñ –¥–æ—Å—Ç—É–ø–Ω—ñ —Å–ø—ñ–ª—å–Ω—ñ —Ä–µ—Å—É—Ä—Å–∏** by: `netshareenumall`.
* **–Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏–π —Å–ø—ñ–ª—å–Ω–∏–π —Ä–µ—Å—É—Ä—Å –æ—Ç—Ä–∏–º—É—î—Ç—å—Å—è** with: `netsharegetinfo <share>`.

#### Additional Operations with SIDs

* **SIDs –∑–∞ —ñ–º–µ–Ω–µ–º** using: `lookupnames <username>`.
* **–ë—ñ–ª—å—à–µ SIDs** through: `lsaenumsid`.
* **–¶–∏–∫–ª—ñ—á–Ω–∏–π RID –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –±—ñ–ª—å—à–µ SIDs** is performed by: `lookupsids <sid>`.

#### **Extra commands**

| **–ö–æ–º–∞–Ω–¥–∞**         | **–Ü–Ω—Ç–µ—Ä—Ñ–µ–π—Å**                                                                                                                                     | **–û–ø–∏—Å**                                                                                                                           |
| ------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------- |
| queryuser           | SAMR                                                                                                                                              | –û—Ç—Ä–∏–º–∞—Ç–∏ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞                                                                                                                 |
| querygroup          | –û—Ç—Ä–∏–º–∞—Ç–∏ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –≥—Ä—É–ø—É                                                                                                                        |                                                                                                                                           |
| querydominfo        | –û—Ç—Ä–∏–º–∞—Ç–∏ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –¥–æ–º–µ–Ω                                                                                                                       |                                                                                                                                           |
| enumdomusers        | –ü–µ—Ä–µ—Ä–∞—Ö—É–≤–∞—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –¥–æ–º–µ–Ω—É                                                                                                                            |                                                                                                                                           |
| enumdomgroups       | –ü–µ—Ä–µ—Ä–∞—Ö—É–≤–∞—Ç–∏ –≥—Ä—É–ø–∏ –¥–æ–º–µ–Ω—É                                                                                                                           |                                                                                                                                           |
| createdomuser       | –°—Ç–≤–æ—Ä–∏—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –¥–æ–º–µ–Ω—É                                                                                                                              |                                                                                                                                           |
| deletedomuser       | –í–∏–¥–∞–ª–∏—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –¥–æ–º–µ–Ω—É                                                                                                                              |                                                                                                                                           |
| lookupnames         | LSARPC                                                                                                                                            | –ó–Ω–∞–π—Ç–∏ —ñ–º–µ–Ω–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –∑–∞ –∑–Ω–∞—á–µ–Ω–Ω—è–º–∏ SID[a](https://learning.oreilly.com/library/view/network-security-assessment/9781491911044/ch08.html#ch08fn8) |
| lookupsids          | –ó–Ω–∞–π—Ç–∏ SIDs –∑–∞ —ñ–º–µ–Ω–∞–º–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ (—Ü–∏–∫–ª—ñ—á–Ω–∏–π RID[b](https://learning.oreilly.com/library/view/network-security-assessment/9781491911044/ch08.html#ch08fn9)) |                                                                                                                                           |
| lsaaddacctrights    | –î–æ–¥–∞—Ç–∏ –ø—Ä–∞–≤–∞ –¥–æ –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞                                                                                                                      |                                                                                                                                           |
| lsaremoveacctrights | –í–∏–¥–∞–ª–∏—Ç–∏ –ø—Ä–∞–≤–∞ –∑ –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞                                                                                                                 |                                                                                                                                           |
| dsroledominfo       | LSARPC-DS                                                                                                                                         | –û—Ç—Ä–∏–º–∞—Ç–∏ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –æ—Å–Ω–æ–≤–Ω–∏–π –¥–æ–º–µ–Ω                                                                                                            |
| dsenumdomtrusts     | –ü–µ—Ä–µ—Ä–∞—Ö—É–≤–∞—Ç–∏ –¥–æ–≤—ñ—Ä–µ–Ω—ñ –¥–æ–º–µ–Ω–∏ –≤ –ª—ñ—Å—ñ AD                                                                                                     |                                                                                                                                           |

To **understand** better how the tools _**samrdump**_ **and** _**rpcdump**_ works you should read [**Pentesting MSRPC**](../135-pentesting-msrpc.md).

**Try Hard Security Group**

<figure><img src="/.gitbook/assets/telegram-cloud-document-1-5159108904864449420.jpg" alt=""><figcaption></figcaption></figure>

{% embed url="https://discord.gg/tryhardsecurity" %}

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
