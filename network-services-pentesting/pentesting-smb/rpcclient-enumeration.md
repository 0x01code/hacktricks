# rpcclient枚举

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks Cloud ☁️</strong></a> - <a href="https://twitter.com/hacktricks_live"><strong>🐦 Twitter 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 Youtube 🎥</strong></a></summary>

* 您在**网络安全公司**工作吗？想要在HackTricks中看到您的**公司广告**？或者想要访问**PEASS的最新版本或下载HackTricks的PDF**？请查看[**订阅计划**](https://github.com/sponsors/carlospolop)!
* 发现我们的独家[NFT收藏品**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* 获取[**官方PEASS和HackTricks周边产品**](https://peass.creator-spring.com)
* **加入** [**💬**](https://emojipedia.org/speech-balloon/) [**Discord群组**](https://discord.gg/hRep4RUj7f) 或 [**电报群组**](https://t.me/peass) 或在**Twitter** 🐦[**@carlospolopm**](https://twitter.com/hacktricks_live)**上关注**我。
* 通过向[hacktricks repo](https://github.com/carlospolop/hacktricks)和[hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)提交PR来分享您的黑客技巧。

</details>

<figure><img src="/.gitbook/assets/image (675).png" alt=""><figcaption></figcaption></figure>

发现最重要的漏洞，以便更快修复。Intruder跟踪您的攻击面，运行主动威胁扫描，发现整个技术堆栈中的问题，从API到Web应用程序和云系统。[**立即免费试用**](https://www.intruder.io/?utm\_source=referral\&utm\_campaign=hacktricks)。

{% embed url="https://www.intruder.io/?utm_campaign=hacktricks&utm_source=referral" %}

***

### **什么是RID**

### 相对标识符（RID）和安全标识符（SID）概述

**相对标识符（RID）**和**安全标识符（SID）**是Windows操作系统中用于唯一标识和管理对象（如用户和组）的关键组件。

- **SID**用作域的唯一标识符，确保每个域都是可区分的。
- **RID**附加到SID以创建这些域内对象的唯一标识符。这种组合允许对对象权限和访问控制进行精确跟踪和管理。

例如，名为`pepe`的用户可能具有将域的SID与其特定RID结合在一起的唯一标识符，以十六进制（`0x457`）和十进制（`1111`）格式表示。这导致了pepe在域内的完整和唯一标识符，如：`S-1-5-21-1074507654-1937615267-42093643874-1111`。

### **使用rpcclient进行枚举**

来自Samba的**`rpcclient`**实用程序用于通过命名管道与**RPC端点进行交互**。在**建立SMB会话**后，通常需要凭据，可以发出以下命令到SAMR、LSARPC和LSARPC-DS接口。

#### 服务器信息

* 要获取**服务器信息**：使用`srvinfo`命令。

#### 用户枚举

* 可以使用以下命令**列出用户**：`querydispinfo`和`enumdomusers`。
* 通过`queryuser <0xrid>`可以查看**用户的详细信息**。
* 使用`queryusergroups <0xrid>`可以查看**用户的组**。
* 通过`lookupnames <username>`可以检索**用户的SID**。
* 使用`queryuseraliases [builtin|domain] <sid>`可以查看**用户的别名**。
```bash
# Users' RIDs-forced
for i in $(seq 500 1100); do
rpcclient -N -U "" [IP_ADDRESS] -c "queryuser 0x$(printf '%x\n' $i)" | grep "User Name\|user_rid\|group_rid" && echo "";
done

# samrdump.py can also serve this purpose
```
#### 枚举组

- 使用`enumdomgroups`来枚举**组**。
- 使用`querygroup <0xrid>`来获取**组的详细信息**。
- 通过`querygroupmem <0xrid>`来查看**组的成员**。

#### 枚举别名组

- 使用`enumalsgroups <builtin|domain>`来枚举**别名组**。
- 使用`queryaliasmem builtin|domain <0xrid>`来查看**别名组的成员**。

#### 枚举域

- 使用`enumdomains`来枚举**域**。
- 通过`lsaquery`来检索**域的SID**。
- 使用`querydominfo`来获取**域信息**。

#### 枚举共享

- 使用`netshareenumall`来列出**所有可用的共享**。
- 使用`netsharegetinfo <share>`来获取特定共享的**信息**。

#### 使用SID的附加操作

- 使用`lookupnames <username>`来根据名称查找**SID**。
- 通过`lsaenumsid`来获取**更多的SID**。
- 使用`lookupsids <sid>`进行**RID循环**以检查更多的**SID**。

#### **额外命令**

| **命令**             | **接口**                                                                                                                                     | **描述**                                                                                                                           |
| ------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------- |
| queryuser           | SAMR                                                                                                                                              | 检索用户信息                                                                                                                 |
| querygroup          | 检索组信息                                                                                                                        |                                                                                                                                           |
| querydominfo        | 检索域信息                                                                                                                       |                                                                                                                                           |
| enumdomusers        | 枚举域用户                                                                                                                            |                                                                                                                                           |
| enumdomgroups       | 枚举域组                                                                                                                           |                                                                                                                                           |
| createdomuser       | 创建域用户                                                                                                                              |                                                                                                                                           |
| deletedomuser       | 删除域用户                                                                                                                              |                                                                                                                                           |
| lookupnames         | LSARPC                                                                                                                                            | 查找用户名到SID的值                                                                                                                 |
| lookupsids          | 查找SID到用户名（RID循环）                                                                                                                 |                                                                                                                                           |
| lsaaddacctrights    | 为用户帐户添加权限                                                                                                                      |                                                                                                                                           |
| lsaremoveacctrights | 从用户帐户中删除权限                                                                                                                 |                                                                                                                                           |
| dsroledominfo       | LSARPC-DS                                                                                                                                         | 获取主域信息                                                                                                            |
| dsenumdomtrusts     | 枚举AD森林中的受信任域                                                                                                     |                                                                                                                                           |

要更好地了解工具**samrdump**和**rpcdump**的工作原理，请阅读[**Pentesting MSRPC**](../135-pentesting-msrpc.md)。

<figure><img src="/.gitbook/assets/image (675).png" alt=""><figcaption></figcaption></figure>

找到最重要的漏洞，以便更快地修复它们。Intruder跟踪您的攻击面，运行主动威胁扫描，发现整个技术堆栈中的问题，从API到Web应用程序和云系统。[**立即免费试用**](https://www.intruder.io/?utm\_source=referral\&utm\_campaign=hacktricks)。

{% embed url="https://www.intruder.io/?utm_campaign=hacktricks&utm_source=referral" %}


<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks Cloud ☁️</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>🐦 Twitter 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 Youtube 🎥</strong></a></summary>

* 您在**网络安全公司**工作吗？您想在HackTricks中看到您的**公司广告**吗？或者您想访问**PEASS的最新版本或下载PDF版的HackTricks**吗？请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 发现我们的独家[NFTs收藏品**The PEASS Family**](https://opensea.io/collection/the-peass-family)。
* 获取[**官方PEASS和HackTricks周边产品**](https://peass.creator-spring.com)。
* **加入**[**💬**](https://emojipedia.org/speech-balloon/) **Discord群**](https://discord.gg/hRep4RUj7f) 或**电报群**或在**Twitter** 🐦[**@carlospolopm**](https://twitter.com/hacktricks_live)**上关注**我。
* 通过向[hacktricks repo](https://github.com/carlospolop/hacktricks)和[hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)提交PR来分享您的黑客技巧。

</details>
