# Uchambuzi wa rpcclient

<details>

<summary><strong>Jifunze kuhusu kudukua AWS kutoka mwanzo hadi kuwa bingwa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Je, unafanya kazi katika **kampuni ya usalama wa mtandao**? Je, ungependa kuona **kampuni yako ikionekana katika HackTricks**? Au ungependa kupata ufikiaji wa **toleo jipya zaidi la PEASS au kupakua HackTricks kwa muundo wa PDF**? Angalia [**MPANGO WA KUJIUNGA**](https://github.com/sponsors/carlospolop)!
* Gundua [**Familia ya PEASS**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa [**NFTs**](https://opensea.io/collection/the-peass-family) maalum
* Pata [**swag rasmi ya PEASS & HackTricks**](https://peass.creator-spring.com)
* **Jiunge na** [**üí¨**](https://emojipedia.org/speech-balloon/) [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au [**kikundi cha telegram**](https://t.me/peass) au **nifuatilie** kwenye **Twitter** üê¶[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Shiriki mbinu zako za kudukua kwa kuwasilisha PRs kwenye [repo ya hacktricks](https://github.com/carlospolop/hacktricks) na [repo ya hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>

<figure><img src="/.gitbook/assets/image (675).png" alt=""><figcaption></figcaption></figure>

Pata udhaifu unaofaa zaidi ili uweze kuyatatua haraka. Intruder inafuatilia eneo lako la shambulio, inafanya uchunguzi wa vitisho kwa njia ya kujitolea, inapata matatizo katika mfumo wako mzima wa teknolojia, kutoka kwa APIs hadi programu za wavuti na mifumo ya wingu. [**Jaribu bure**](https://www.intruder.io/?utm\_source=referral\&utm\_campaign=hacktricks) leo.

{% embed url="https://www.intruder.io/?utm_campaign=hacktricks&utm_source=referral" %}

***

### **Nini ni RID**

### Maelezo ya Kitambulisho cha Kipekee cha Kihesabu (RID) na Kitambulisho cha Usalama (SID)

**Kitambulisho cha Kipekee cha Kihesabu (RID)** na **Kitambulisho cha Usalama (SID)** ni sehemu muhimu katika mfumo wa uendeshaji wa Windows kwa ajili ya kutambua na kusimamia vitu, kama vile watumiaji na vikundi, ndani ya kikoa cha mtandao.

- **SIDs** hutumika kama vitambulisho vya kipekee kwa vikoa, kuhakikisha kuwa kila kikoa kinatofautishwa.
- **RIDs** huongezwa kwenye SIDs ili kuunda vitambulisho vya kipekee kwa vitu ndani ya vikoa hivyo. Uunganisho huu unaruhusu ufuatiliaji na usimamizi sahihi wa ruhusa za vitu na udhibiti wa ufikiaji.

Kwa mfano, mtumiaji anayejulikana kama `pepe` anaweza kuwa na kitambulisho kipekee kinachounganisha SID ya kikoa na RID yake maalum, iliyoonyeshwa kwa mfano katika mfumo wa hexadecimal (`0x457`) na decimal (`1111`). Hii inasababisha kitambulisho kamili na kipekee kwa pepe ndani ya kikoa kama: `S-1-5-21-1074507654-1937615267-42093643874-1111`.


### **Uchambuzi kwa kutumia rpcclient**

Zana ya **`rpcclient`** kutoka Samba hutumiwa kwa kuingiliana na **vipengele vya RPC kupitia mabomba yaliyopewa majina**. Amri zifuatazo zinaweza kutolewa kwa interfaces za SAMR, LSARPC, na LSARPC-DS baada ya kuanzishwa kwa kikao cha **SMB**, mara nyingi inahitaji vibali.

#### Taarifa za Seva

* Ili kupata **Taarifa za Seva**: hutumika amri ya `srvinfo`.

#### Uchambuzi wa Watumiaji

* **Watumiaji wanaweza kuorodheshwa** kwa kutumia: amri za `querydispinfo` na `enumdomusers`.
* **Maelezo ya mtumiaji** kwa: amri ya `queryuser <0xrid>`.
* **Vikundi vya mtumiaji** kwa: amri ya `queryusergroups <0xrid>`.
* **SID ya mtumiaji inapatikana** kupitia: amri ya `lookupnames <username>`.
* **Vidokezo vya watumiaji** kwa: amri ya `queryuseraliases [builtin|domain] <sid>`.
```bash
# Users' RIDs-forced
for i in $(seq 500 1100); do
rpcclient -N -U "" [IP_ADDRESS] -c "queryuser 0x$(printf '%x\n' $i)" | grep "User Name\|user_rid\|group_rid" && echo "";
done

# samrdump.py can also serve this purpose
```
#### Uchambuzi wa Vikundi

* **Vikundi** kwa: `enumdomgroups`.
* **Maelezo ya kikundi** kwa: `querygroup <0xrid>`.
* **Wanachama wa kikundi** kupitia: `querygroupmem <0xrid>`.

#### Uchambuzi wa Vikundi vya Kaliasi

* **Vikundi vya kaliasi** kwa: `enumalsgroups <builtin|domain>`.
* **Wanachama wa kikundi cha kaliasi** kwa: `queryaliasmem builtin|domain <0xrid>`.

#### Uchambuzi wa Maeneo

* **Maeneo** kwa kutumia: `enumdomains`.
* **SID ya kikoa inapatikana** kupitia: `lsaquery`.
* **Maelezo ya kikoa yanapatikana** kwa: `querydominfo`.

#### Uchambuzi wa Kugawana

* **Kugawana zote zinazopatikana** kwa: `netshareenumall`.
* **Taarifa kuhusu kugawana maalum inapatikana** kwa: `netsharegetinfo <share>`.

#### Operesheni Zaidi na SIDs

* **SIDs kwa jina** kwa kutumia: `lookupnames <username>`.
* **SIDs zaidi** kupitia: `lsaenumsid`.
* **RID cycling kuchunguza SIDs zaidi** inatekelezwa kwa: `lookupsids <sid>`.

#### **Amri za ziada**

| **Amri**             | **Interface**                                                                                                                                     | **Maelezo**                                                                                                                               |
| ------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------- |
| queryuser           | SAMR                                                                                                                                              | Pata taarifa za mtumiaji                                                                                                                 |
| querygroup          | Pata taarifa za kikundi                                                                                                                        |                                                                                                                                           |
| querydominfo        | Pata taarifa za kikoa                                                                                                                           |                                                                                                                                           |
| enumdomusers        | Panga watumiaji wa kikoa                                                                                                                         |                                                                                                                                           |
| enumdomgroups       | Panga vikundi vya kikoa                                                                                                                          |                                                                                                                                           |
| createdomuser       | Unda mtumiaji wa kikoa                                                                                                                           |                                                                                                                                           |
| deletedomuser       | Futa mtumiaji wa kikoa                                                                                                                           |                                                                                                                                           |
| lookupnames         | LSARPC                                                                                                                                            | Tafuta majina ya watumiaji hadi kwa SID[a](https://learning.oreilly.com/library/view/network-security-assessment/9781491911044/ch08.html#ch08fn8) thamani |
| lookupsids          | Tafuta SIDs hadi majina ya watumiaji (RID[b](https://learning.oreilly.com/library/view/network-security-assessment/9781491911044/ch08.html#ch08fn9) cycling) |                                                                                                                                           |
| lsaaddacctrights    | Ongeza haki kwa akaunti ya mtumiaji                                                                                                              |                                                                                                                                           |
| lsaremoveacctrights | Ondoa haki kutoka kwa akaunti ya mtumiaji                                                                                                         |                                                                                                                                           |
| dsroledominfo       | LSARPC-DS                                                                                                                                         | Pata taarifa ya msingi ya kikoa                                                                                                          |
| dsenumdomtrusts     | Panga vikoa vilivyotegemewa ndani ya msitu wa AD                                                                                                  |                                                                                                                                           |

Kwa **kuelewa** vizuri jinsi zana za _**samrdump**_ **na** _**rpcdump**_ zinafanya kazi, unapaswa kusoma [**Pentesting MSRPC**](../135-pentesting-msrpc.md).

<figure><img src="/.gitbook/assets/image (675).png" alt=""><figcaption></figcaption></figure>

Pata udhaifu unaowajali zaidi ili uweze kuzirekebisha haraka. Intruder inafuatilia eneo lako la shambulio, inatekeleza uchunguzi wa vitisho wa kujitokeza, inapata masuala katika mfumo wako wa teknolojia mzima, kutoka kwa APIs hadi programu za wavuti na mifumo ya wingu. [**Jaribu bure**](https://www.intruder.io/?utm\_source=referral\&utm\_campaign=hacktricks) leo.

{% embed url="https://www.intruder.io/?utm_campaign=hacktricks&utm_source=referral" %}


<details>

<summary><strong>Jifunze kuhusu kudukua AWS kutoka sifuri hadi shujaa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Je, unafanya kazi katika **kampuni ya usalama wa mtandao**? Je, ungependa kuona **kampuni yako inatangazwa katika HackTricks**? au ungependa kupata ufikiaji wa **toleo jipya zaidi la PEASS au kupakua HackTricks kwa PDF**? Angalia [**MPANGO WA KUJIUNGA**](https://github.com/sponsors/carlospolop)!
* Gundua [**The PEASS Family**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa [**NFTs**](https://opensea.io/collection/the-peass-family) za kipekee
* Pata [**swag rasmi ya PEASS & HackTricks**](https://peass.creator-spring.com)
* **Jiunge na** [**üí¨**](https://emojipedia.org/speech-balloon/) [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au **kikundi cha telegram**](https://t.me/peass) au **nifuate** kwenye **Twitter** üê¶[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Shiriki mbinu zako za kudukua kwa kuwasilisha PR kwa [repo ya hacktricks](https://github.com/carlospolop/hacktricks) na [repo ya hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>
