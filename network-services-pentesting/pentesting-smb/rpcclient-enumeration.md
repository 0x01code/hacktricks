# rpcclient enumeration

<details>

<summary><strong>AWS 해킹을 처음부터 전문가까지 배우세요</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* **사이버 보안 회사**에서 일하시나요? **HackTricks에서 귀사를 광고**하고 싶으신가요? 혹은 **PEASS의 최신 버전에 액세스하거나 HackTricks를 PDF로 다운로드**하고 싶으신가요? [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)를 확인해보세요!
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)를 발견해보세요, 저희의 독점적인 [**NFTs**](https://opensea.io/collection/the-peass-family) 컬렉션
* [**공식 PEASS & HackTricks 스왹**](https://peass.creator-spring.com)을 받아보세요
* **💬** [**Discord 그룹**](https://discord.gg/hRep4RUj7f)에 **가입**하거나 [**텔레그램 그룹**](https://t.me/peass)에 가입하시거나 **트위터** 🐦[**@carlospolopm**](https://twitter.com/hacktricks_live)**를 팔로우**하세요.
* **해킹 요령을 공유하고 싶으시다면 [hacktricks repo](https://github.com/carlospolop/hacktricks)와 [hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)로 PR을 제출**해주세요.

</details>

**Try Hard Security Group**

<figure><img src="../.gitbook/assets/telegram-cloud-document-1-5159108904864449420.jpg" alt=""><figcaption></figcaption></figure>

{% embed url="https://discord.gg/tryhardsecurity" %}

***

### 상대 식별자 (RID) 및 보안 식별자 (SID) 개요

**상대 식별자 (RID)** 및 **보안 식별자 (SID)**는 Windows 운영 체제에서 네트워크 도메인 내의 사용자 및 그룹과 같은 객체를 고유하게 식별하고 관리하는 데 중요한 구성 요소입니다.

- **SIDs**는 도메인을 고유하게 식별하여 각 도메인이 구별될 수 있도록 합니다.
- **RIDs**는 이러한 도메인 내 객체에 대한 고유 식별자를 만들기 위해 SIDs에 추가됩니다. 이 조합을 통해 객체 권한 및 액세스 제어를 정확하게 추적하고 관리할 수 있습니다.

예를 들어, `pepe`라는 사용자는 도메인의 SID와 해당 RID를 결합한 고유 식별자를 가질 수 있으며, 16진수(`0x457`) 및 10진수(`1111`) 형식으로 표시됩니다. 이로 인해 도메인 내 pepe에 대한 완전하고 고유한 식별자가 생성됩니다: `S-1-5-21-1074507654-1937615267-42093643874-1111`.


### **rpcclient를 사용한 열거**

**Samba**의 **`rpcclient`** 유틸리티는 **명명된 파이프를 통해 RPC 엔드포인트와 상호 작용**하는 데 사용됩니다. **SMB 세션이 설정된 후** SAMR, LSARPC 및 LSARPC-DS 인터페이스에 발행할 수 있는 아래 명령어들이 있습니다. 이는 종종 자격 증명이 필요합니다.

#### 서버 정보

* **서버 정보를 얻으려면**: `srvinfo` 명령어를 사용합니다.

#### 사용자 열거

* **사용자 목록을 확인**하려면: `querydispinfo` 및 `enumdomusers`를 사용합니다.
* **사용자의 세부 정보**는: `queryuser <0xrid>`로 확인합니다.
* **사용자의 그룹**은: `queryusergroups <0xrid>`로 확인합니다.
* **사용자의 SID를 검색**하려면: `lookupnames <username>`을 사용합니다.
* **사용자의 별칭**은: `queryuseraliases [builtin|domain] <sid>`로 확인합니다.
```bash
# Users' RIDs-forced
for i in $(seq 500 1100); do
rpcclient -N -U "" [IP_ADDRESS] -c "queryuser 0x$(printf '%x\n' $i)" | grep "User Name\|user_rid\|group_rid" && echo "";
done

# samrdump.py can also serve this purpose
```
#### 그룹 열거

* **그룹**은 `enumdomgroups`로.
* **그룹의 세부 정보**는 `querygroup <0xrid>`로 확인합니다.
* **그룹의 구성원**은 `querygroupmem <0xrid>`로 확인합니다.

#### 별칭 그룹 열거

* **별칭 그룹**은 `enumalsgroups <builtin|domain>`으로 확인합니다.
* **별칭 그룹의 구성원**은 `queryaliasmem builtin|domain <0xrid>`로 확인합니다.

#### 도메인 열거

* **도메인**은 `enumdomains`로 확인합니다.
* **도메인의 SID를 가져오려면** `lsaquery`를 사용합니다.
* **도메인 정보를 얻으려면** `querydominfo`를 사용합니다.

#### 공유 열거

* **모든 사용 가능한 공유**는 `netshareenumall`로 확인합니다.
* **특정 공유에 대한 정보**는 `netsharegetinfo <share>`로 가져옵니다.

#### SID를 사용한 추가 작업

* **이름으로 SID 확인**은 `lookupnames <username>`으로 합니다.
* **더 많은 SID**는 `lsaenumsid`로 확인합니다.
* **RID 순환을 통해 더 많은 SID를 확인**하려면 `lookupsids <sid>`를 사용합니다.

#### **추가 명령어**

| **명령어**           | **인터페이스**                                                                                                                                     | **설명**                                                                                                                           |
| ------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------- |
| queryuser           | SAMR                                                                                                                                              | 사용자 정보를 가져옵니다                                                                                                                 |
| querygroup          | 그룹 정보를 가져옵니다                                                                                                                        |                                                                                                                                           |
| querydominfo        | 도메인 정보를 가져옵니다                                                                                                                       |                                                                                                                                           |
| enumdomusers        | 도메인 사용자를 열거합니다                                                                                                                            |                                                                                                                                           |
| enumdomgroups       | 도메인 그룹을 열거합니다                                                                                                                           |                                                                                                                                           |
| createdomuser       | 도메인 사용자를 생성합니다                                                                                                                              |                                                                                                                                           |
| deletedomuser       | 도메인 사용자를 삭제합니다                                                                                                                              |                                                                                                                                           |
| lookupnames         | LSARPC                                                                                                                                            | 사용자 이름을 SID[a](https://learning.oreilly.com/library/view/network-security-assessment/9781491911044/ch08.html#ch08fn8) 값으로 변환합니다 |
| lookupsids          | SID를 사용자 이름으로 변환합니다 (RID[b](https://learning.oreilly.com/library/view/network-security-assessment/9781491911044/ch08.html#ch08fn9) 순환) |                                                                                                                                           |
| lsaaddacctrights    | 사용자 계정에 권한을 추가합니다                                                                                                                      |                                                                                                                                           |
| lsaremoveacctrights | 사용자 계정에서 권한을 제거합니다                                                                                                                 |                                                                                                                                           |
| dsroledominfo       | LSARPC-DS                                                                                                                                         | 기본 도메인 정보를 가져옵니다                                                                                                            |
| dsenumdomtrusts     | AD 포레스트 내 신뢰하는 도메인을 열거합니다                                                                                                     |                                                                                                                                           |

**_samrdump_** **및** **_rpcdump_** 도구가 어떻게 작동하는지 **이해**하려면 [**Pentesting MSRPC**](../135-pentesting-msrpc.md)를 읽어보세요.

**Try Hard Security Group**

<figure><img src="../.gitbook/assets/telegram-cloud-document-1-5159108904864449420.jpg" alt=""><figcaption></figcaption></figure>

{% embed url="https://discord.gg/tryhardsecurity" %}

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>로부터 제로에서 영웅까지 AWS 해킹을 배워보세요!</summary>

* **사이버 보안 회사**에서 일하시나요? **HackTricks에서 귀하의 회사를 광고**하고 싶으신가요? 또는 **PEASS의 최신 버전에 액세스**하거나 HackTricks를 **PDF로 다운로드**하고 싶으신가요? [**구독 요금제**](https://github.com/sponsors/carlospolop)를 확인해보세요!
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)를 발견해보세요, 저희의 독점 [**NFTs**](https://opensea.io/collection/the-peass-family) 컬렉션
* [**공식 PEASS & HackTricks 스왹**](https://peass.creator-spring.com)을 얻으세요
* [**💬**](https://emojipedia.org/speech-balloon/) [**Discord 그룹**](https://discord.gg/hRep4RUj7f) 또는 [**텔레그램 그룹**](https://t.me/peass)에 가입하거나 **트위터** 🐦[**@carlospolopm**](https://twitter.com/hacktricks_live)**를 팔로우**하세요.
* **해킹 트릭을 공유하려면 [hacktricks repo](https://github.com/carlospolop/hacktricks) 및 [hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)**로 PR을 제출하세요.

</details>
