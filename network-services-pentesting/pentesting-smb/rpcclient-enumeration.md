# Enumeracija rpcclient-a

<details>

<summary><strong>Nauƒçite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Da li radite u **kompaniji za kibernetiƒçku bezbednost**? ≈Ωelite li da vidite svoju **kompaniju reklamiranu na HackTricks-u**? Ili ≈æelite da imate pristup **najnovijoj verziji PEASS-a ili preuzmete HackTricks u PDF formatu**? Proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), na≈°u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* Nabavite [**zvaniƒçni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* **Pridru≈æite se** [**üí¨**](https://emojipedia.org/speech-balloon/) [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili me **pratite** na **Twitter-u** üê¶[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na [hacktricks repo](https://github.com/carlospolop/hacktricks) i [hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)**.

</details>

<figure><img src="/.gitbook/assets/image (675).png" alt=""><figcaption></figcaption></figure>

Pronaƒëite najva≈ænije ranjivosti kako biste ih br≈æe popravili. Intruder prati va≈°u povr≈°inu napada, pokreƒáe proaktivne pretnje, pronalazi probleme u celom va≈°em tehnolo≈°kom skupu, od API-ja do veb aplikacija i cloud sistema. [**Isprobajte ga besplatno**](https://www.intruder.io/?utm\_source=referral\&utm\_campaign=hacktricks) danas.

{% embed url="https://www.intruder.io/?utm_campaign=hacktricks&utm_source=referral" %}

***

### **≈†ta je RID**

### Pregled relativnih identifikatora (RID) i sigurnosnih identifikatora (SID)

**Relativni identifikatori (RID)** i **sigurnosni identifikatori (SID)** su kljuƒçni komponenti u Windows operativnim sistemima za jedinstveno identifikovanje i upravljanje objektima, kao ≈°to su korisnici i grupe, unutar mre≈ænog domena.

- **SID-ovi** slu≈æe kao jedinstveni identifikatori za domene, obezbeƒëujuƒái da svaki domen bude razlikovljiv.
- **RID-ovi** se dodaju SID-ovima kako bi se stvorili jedinstveni identifikatori za objekte unutar tih domena. Ova kombinacija omoguƒáava precizno praƒáenje i upravljanje dozvolama objekata i kontrolama pristupa.

Na primer, korisnik sa imenom `pepe` mo≈æe imati jedinstveni identifikator koji kombinuje SID domena sa njegovim specifiƒçnim RID-om, predstavljenim u heksadecimalnom (`0x457`) i decimalnom (`1111`) formatu. To rezultira potpunim i jedinstvenim identifikatorom za pepe-a unutar domena kao ≈°to je: `S-1-5-21-1074507654-1937615267-42093643874-1111`.


### **Enumeracija sa rpcclient-om**

Alat **`rpcclient`** iz Samba se koristi za interakciju sa **RPC endpointima putem imenovanih cevi**. Sledeƒáe komande se mogu izdati SAMR, LSARPC i LSARPC-DS interfejsima nakon uspostavljanja **SMB sesije**, ƒçesto zahtevajuƒái akreditive.

#### Informacije o serveru

* Da biste dobili **informacije o serveru**: koristite komandu `srvinfo`.

#### Enumeracija korisnika

* **Korisnici mogu biti navedeni** kori≈°ƒáenjem: komande `querydispinfo` i `enumdomusers`.
* **Detalji o korisniku** sa: komandom `queryuser <0xrid>`.
* **Grupe korisnika** sa: komandom `queryusergroups <0xrid>`.
* **SID korisnika se dobija** putem: komande `lookupnames <username>`.
* **Alias korisnika** sa: komandom `queryuseraliases [builtin|domain] <sid>`.
```bash
# Users' RIDs-forced
for i in $(seq 500 1100); do
rpcclient -N -U "" [IP_ADDRESS] -c "queryuser 0x$(printf '%x\n' $i)" | grep "User Name\|user_rid\|group_rid" && echo "";
done

# samrdump.py can also serve this purpose
```
#### Enumeracija grupa

* **Grupe** se dobijaju pomoƒáu: `enumdomgroups`.
* **Detalji grupe** se dobijaju pomoƒáu: `querygroup <0xrid>`.
* **ƒålanovi grupe** se dobijaju pomoƒáu: `querygroupmem <0xrid>`.

#### Enumeracija grupa sa aliasima

* **Grupe sa aliasima** se dobijaju pomoƒáu: `enumalsgroups <builtin|domain>`.
* **ƒålanovi grupe sa aliasima** se dobijaju pomoƒáu: `queryaliasmem builtin|domain <0xrid>`.

#### Enumeracija domena

* **Domeni** se dobijaju pomoƒáu: `enumdomains`.
* **SID domena se dobija** pomoƒáu: `lsaquery`.
* **Informacije o domenu se dobijaju** pomoƒáu: `querydominfo`.

#### Enumeracija deljenih resursa

* **Svi dostupni deljeni resursi** se dobijaju pomoƒáu: `netshareenumall`.
* **Informacije o odreƒëenom deljenom resursu se dobijaju** pomoƒáu: `netsharegetinfo <share>`.

#### Dodatne operacije sa SID-ovima

* **SID-ovi po imenu** se dobijaju pomoƒáu: `lookupnames <username>`.
* **Dodatni SID-ovi** se dobijaju pomoƒáu: `lsaenumsid`.
* **Provera dodatnih SID-ova kroz cikliranje RID-ova** se vr≈°i pomoƒáu: `lookupsids <sid>`.

#### **Dodatne komande**

| **Komanda**         | **Interfejs**                                                                                                                                     | **Opis**                                                                                                                           |
| ------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------- |
| queryuser           | SAMR                                                                                                                                              | Dobijanje informacija o korisniku                                                                                                                 |
| querygroup          | Dobijanje informacija o grupi                                                                                                                        |                                                                                                                                           |
| querydominfo        | Dobijanje informacija o domenu                                                                                                                       |                                                                                                                                           |
| enumdomusers        | Enumeracija korisnika domena                                                                                                                            |                                                                                                                                           |
| enumdomgroups       | Enumeracija grupa domena                                                                                                                           |                                                                                                                                           |
| createdomuser       | Kreiranje korisnika domena                                                                                                                              |                                                                                                                                           |
| deletedomuser       | Brisanje korisnika domena                                                                                                                              |                                                                                                                                           |
| lookupnames         | LSARPC                                                                                                                                            | Pretraga korisniƒçkih imena u SID[a](https://learning.oreilly.com/library/view/network-security-assessment/9781491911044/ch08.html#ch08fn8) vrednosti |
| lookupsids          | Pretraga SID-ova u korisniƒçka imena (cikliranje RID[b](https://learning.oreilly.com/library/view/network-security-assessment/9781491911044/ch08.html#ch08fn9)) |                                                                                                                                           |
| lsaaddacctrights    | Dodavanje prava korisniƒçkom nalogu                                                                                                                      |                                                                                                                                           |
| lsaremoveacctrights | Uklanjanje prava sa korisniƒçkog naloga                                                                                                                 |                                                                                                                                           |
| dsroledominfo       | LSARPC-DS                                                                                                                                         | Dobijanje osnovnih informacija o domenu                                                                                                            |
| dsenumdomtrusts     | Enumeracija poverenih domena unutar AD ≈°ume                                                                                                     |                                                                                                                                           |

Da biste **bolje razumeli** kako alati _**samrdump**_ **i** _**rpcdump**_ funkcioni≈°u, trebali biste proƒçitati [**Pentesting MSRPC**](../135-pentesting-msrpc.md).

<figure><img src="/.gitbook/assets/image (675).png" alt=""><figcaption></figcaption></figure>

Pronaƒëite najva≈ænije ranjivosti kako biste ih br≈æe otklonili. Intruder prati va≈°u povr≈°inu napada, pokreƒáe proaktivne pretrage pretnji, pronalazi probleme u celokupnom tehnolo≈°kom sklopu, od API-ja do veb aplikacija i sistemima u oblaku. [**Isprobajte ga besplatno**](https://www.intruder.io/?utm\_source=referral\&utm\_campaign=hacktricks) danas.

{% embed url="https://www.intruder.io/?utm_campaign=hacktricks&utm_source=referral" %}


<details>

<summary><strong>Nauƒçite hakovanje AWS-a od poƒçetka do naprednog nivoa sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Da li radite u **kompaniji za kibernetiƒçku bezbednost**? ≈Ωelite li da vidite **va≈°u kompaniju reklamiranu na HackTricks**? Ili ≈æelite da imate pristup **najnovijoj verziji PEASS-a ili preuzmete HackTricks u PDF formatu**? Proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), na≈°u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* Nabavite [**zvaniƒçni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* **Pridru≈æite se** [**üí¨**](https://emojipedia.org/speech-balloon/) [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili me **pratite** na **Twitteru** üê¶[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na [hacktricks repo](https://github.com/carlospolop/hacktricks) i [hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)**.

</details>
