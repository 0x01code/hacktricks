# rpcclient列挙

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks Cloud ☁️</strong></a> - <a href="https://twitter.com/hacktricks_live"><strong>🐦 Twitter 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 Youtube 🎥</strong></a></summary>

* **サイバーセキュリティ企業**で働いていますか？ **HackTricksで企業を宣伝**したいですか？または、**PEASSの最新バージョンにアクセス**したいですか、またはHackTricksを**PDFでダウンロード**したいですか？[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[NFTs](https://opensea.io/collection/the-peass-family)のコレクションを見つけてください
* [**公式PEASS＆HackTricks swag**](https://peass.creator-spring.com)を手に入れましょう
* [**💬**](https://emojipedia.org/speech-balloon/) [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**telegramグループ**](https://t.me/peass)に**参加**するか、**Twitter** 🐦[**@carlospolopm**](https://twitter.com/hacktricks_live)**をフォロー**してください。
* **ハッキングトリックを共有**するには、[hacktricksリポジトリ](https://github.com/carlospolop/hacktricks)と[hacktricks-cloudリポジトリ](https://github.com/carlospolop/hacktricks-cloud)にPRを提出してください。

</details>

<figure><img src="/.gitbook/assets/image (675).png" alt=""><figcaption></figcaption></figure>

最も重要な脆弱性を見つけて迅速に修正できます。Intruderは攻撃対象を追跡し、積極的な脅威スキャンを実行し、APIからWebアプリやクラウドシステムまでの技術スタック全体で問題を見つけます。[**無料でお試しください**](https://www.intruder.io/?utm_source=referral\&utm_campaign=hacktricks) 今すぐ。

{% embed url="https://www.intruder.io/?utm_campaign=hacktricks&utm_source=referral" %}

***

### **RIDとは**

### 相対識別子（RID）とセキュリティ識別子（SID）の概要

**相対識別子（RID）**と**セキュリティ識別子（SID）**は、Windowsオペレーティングシステムにおいて、ネットワークドメイン内のユーザーやグループなどのオブジェクトを一意に識別および管理するための重要なコンポーネントです。

- **SIDs**はドメインの一意な識別子として機能し、各ドメインを区別可能にします。
- **RIDs**はSIDsに追加され、それらのドメイン内のオブジェクトのための一意な識別子を作成します。この組み合わせにより、オブジェクトの権限とアクセス制御を正確に追跡および管理できます。

たとえば、ユーザー名が`pepe`の場合、そのユニークな識別子は、ドメインのSIDと彼の特定のRIDを組み合わせたもので、16進数（`0x457`）および10進数（`1111`）の形式で表されます。これにより、`S-1-5-21-1074507654-1937615267-42093643874-1111`のように、pepeのドメイン内で完全かつ一意な識別子が得られます。


### **rpcclientを使用した列挙**

Sambaの**`rpcclient`**ユーティリティは、**名前付きパイプを介してRPCエンドポイント**とやり取りするために使用されます。**SMBセッションが確立された後**に、しばしば資格情報が必要となります。

#### サーバー情報

* **サーバー情報を取得**するには、`srvinfo`コマンドを使用します。

#### ユーザーの列挙

* **ユーザーをリストアップ**するには、`querydispinfo`および`enumdomusers`を使用します。
* **ユーザーの詳細**は、`queryuser <0xrid>`で取得します。
* **ユーザーのグループ**は、`queryusergroups <0xrid>`で取得します。
* **ユーザーのSID**は、`lookupnames <username>`を使用して取得します。
* **ユーザーのエイリアス**は、`queryuseraliases [builtin|domain] <sid>`で取得します。
```bash
# Users' RIDs-forced
for i in $(seq 500 1100); do
rpcclient -N -U "" [IP_ADDRESS] -c "queryuser 0x$(printf '%x\n' $i)" | grep "User Name\|user_rid\|group_rid" && echo "";
done

# samrdump.py can also serve this purpose
```
#### グループの列挙

* **グループ**：`enumdomgroups`による。
* **グループの詳細**：`querygroup <0xrid>`を使用。
* **グループのメンバー**：`querygroupmem <0xrid>`を介して。

#### エイリアスグループの列挙

* **エイリアスグループ**：`enumalsgroups <builtin|domain>`による。
* **エイリアスグループのメンバー**：`queryaliasmem builtin|domain <0xrid>`を使用。

#### ドメインの列挙

* **ドメイン**：`enumdomains`を使用。
* **ドメインのSIDの取得**：`lsaquery`による。
* **ドメイン情報の取得**：`querydominfo`による。

#### 共有の列挙

* **利用可能なすべての共有**：`netshareenumall`による。
* **特定の共有に関する情報の取得**：`netsharegetinfo <share>`を使用。

#### SIDを使用した追加操作

* **名前からSIDへの変換**：`lookupnames <username>`を使用。
* **さらなるSID**：`lsaenumsid`による。
* **RIDサイクリングによるさらなるSIDの確認**：`lookupsids <sid>`の実行。

#### **追加コマンド**

| **コマンド**         | **インターフェース**                                                                                                                                     | **説明**                                                                                                                           |
| ------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------- |
| queryuser           | SAMR                                                                                                                                              | ユーザー情報の取得                                                                                                                 |
| querygroup          | グループ情報の取得                                                                                                                        |                                                                                                                                           |
| querydominfo        | ドメイン情報の取得                                                                                                                       |                                                                                                                                           |
| enumdomusers        | ドメインユーザーの列挙                                                                                                                            |                                                                                                                                           |
| enumdomgroups       | ドメイングループの列挙                                                                                                                           |                                                                                                                                           |
| createdomuser       | ドメインユーザーの作成                                                                                                                              |                                                                                                                                           |
| deletedomuser       | ドメインユーザーの削除                                                                                                                              |                                                                                                                                           |
| lookupnames         | LSARPC                                                                                                                                            | ユーザー名をSID[a](https://learning.oreilly.com/library/view/network-security-assessment/9781491911044/ch08.html#ch08fn8)値に変換する |
| lookupsids          | SIDをユーザー名に変換する（RID[b](https://learning.oreilly.com/library/view/network-security-assessment/9781491911044/ch08.html#ch08fn9)サイクリング） |                                                                                                                                           |
| lsaaddacctrights    | ユーザーアカウントに権限を追加                                                                                                                      |                                                                                                                                           |
| lsaremoveacctrights | ユーザーアカウントから権限を削除                                                                                                                 |                                                                                                                                           |
| dsroledominfo       | LSARPC-DS                                                                                                                                         | プライマリドメイン情報の取得                                                                                                            |
| dsenumdomtrusts     | ADフォレスト内の信頼されたドメインの列挙                                                                                                     |                                                                                                                                           |

**_samrdump_** **および** **_rpcdump_** の動作を理解するには、[**Pentesting MSRPC**](../135-pentesting-msrpc.md)を参照してください。

<figure><img src="/.gitbook/assets/image (675).png" alt=""><figcaption></figcaption></figure>

最も重要な脆弱性を見つけて修正を迅速化します。Intruderは攻撃対象を追跡し、積極的な脅威スキャンを実行し、APIからWebアプリケーション、クラウドシステムまで、技術スタック全体で問題を見つけます。[**無料でお試しください**](https://www.intruder.io/?utm\_source=referral\&utm\_campaign=hacktricks) 今日。

{% embed url="https://www.intruder.io/?utm_campaign=hacktricks&utm_source=referral" %}


<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks Cloud ☁️</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>🐦 Twitter 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 Youtube 🎥</strong></a></summary>

* **サイバーセキュリティ企業**で働いていますか？ **HackTricksで会社を宣伝**してみたいですか？または、**最新バージョンのPEASSをダウンロード**したいですか？[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[NFTs](https://opensea.io/collection/the-peass-family)コレクションを見つけます
* [**公式PEASS＆HackTricks swag**](https://peass.creator-spring.com)を手に入れましょう
* **[💬](https://emojipedia.org/speech-balloon/) Discordグループ**に参加するか、[telegram group](https://t.me/peass)に参加するか、**Twitter** 🐦[**@carlospolopm**](https://twitter.com/hacktricks_live)**をフォロー**してください。
* **ハッキングトリックを共有するには、[hacktricksリポジトリ](https://github.com/carlospolop/hacktricks)と[hacktricks-cloudリポジトリ](https://github.com/carlospolop/hacktricks-cloud)**にPRを提出してください。

</details>
