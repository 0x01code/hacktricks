# rpcclient рдЬрд╛рдВрдЪ

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>тШБя╕П HackTricks Cloud тШБя╕П</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ЁЯРж Twitter ЁЯРж</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ЁЯОЩя╕П Twitch ЁЯОЩя╕П</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ЁЯОе Youtube ЁЯОе</strong></a></summary>

* рдХреНрдпрд╛ рдЖрдк **рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХрдВрдкрдиреА** рдореЗрдВ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ? рдХреНрдпрд╛ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ**? рдпрд╛ рдХреНрдпрд╛ рдЖрдк **PEASS рдХреЗ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рдХрд╛ рдПрдХреНрд╕реЗрд╕** рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ? [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ!
* рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣ **The PEASS Family** рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks swag**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** [**ЁЯТм**](https://emojipedia.org/speech-balloon/) [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рдореБрдЭреЗ **Twitter** рдкрд░ **рдлреЙрд▓реЛ** рдХрд░реЗрдВ [**ЁЯРж**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ** [hacktricks рд░реЗрдкреЛ](https://github.com/carlospolop/hacktricks) рдФрд░ [hacktricks-cloud рд░реЗрдкреЛ](https://github.com/carlospolop/hacktricks-cloud) рдХреЛ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗред

</details>

<figure><img src="/.gitbook/assets/image (675).png" alt=""><figcaption></figcaption></figure>

рд╡реЗ рд╕реБрд░рдХреНрд╖рд╛ рдЦреЛрдЬреЗрдВ рдЬреЛ рд╕рдмрд╕реЗ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИрдВ рддрд╛рдХрд┐ рдЖрдк рдЙрдиреНрд╣реЗрдВ рддреЗрдЬреА рд╕реЗ рдареАрдХ рдХрд░ рд╕рдХреЗрдВред рдЗрдВрдЯреНрд░реВрдбрд░ рдЖрдкрдХреА рд╣рдорд▓реЗ рдХреА рд╕рддрд╣ рдХрд╛ рдЯреНрд░реИрдХ рдХрд░рддрд╛ рд╣реИ, рдкреНрд░реЛрдПрдХреНрдЯрд┐рд╡ рдзрд╛рд░рдгрд╛ рд╕реНрдХреИрди рдЪрд▓рд╛рддрд╛ рд╣реИ, рдПрдкреАрдЖрдИ рд╕реЗ рд╡реЗрдм рдРрдкреНрд╕ рдФрд░ рдХреНрд▓рд╛рдЙрдб рд╕рд┐рд╕реНрдЯрдо рдЬреИрд╕реЗ рдЖрдкрдХреЗ рдкреВрд░реЗ рдЯреЗрдХ рд╕реНрдЯреИрдХ рдореЗрдВ рдореБрджреНрджреЗ рдЦреЛрдЬрддрд╛ рд╣реИред [**рдЗрд╕реЗ рдореБрдлреНрдд рдореЗрдВ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВ**](https://www.intruder.io/?utm\_source=referral\&utm\_campaign=hacktricks) рдЖрдЬред

{% embed url="https://www.intruder.io/?utm_campaign=hacktricks&utm_source=referral" %}

***

### **рдЖрд░рдЖрдИрдбреА рдХреНрдпрд╛ рд╣реИ**

[рд░рд┐рд▓реЗрдЯрд┐рд╡ рдЖрдИрдбреЗрдВрдЯрд┐рдлрд╛рдпрд░ (рдЖрд░рдЖрдИрдбреА)](https://docs.microsoft.com/en-us/windows/security/identity-protection/access-control/security-identifiers) рдПрдХ **рдЕрджреНрд╡рд┐рддреАрдп рдкрд╣рдЪрд╛рдирдХрд░реНрддрд╛** (рд╣реЗрдХреНрд╕рд╛рдбреЗрд╕рд┐рдорд▓ рдкреНрд░рд╛рд░реВрдк рдореЗрдВ рдкреНрд░рд╕реНрддреБрдд) рд╣реИ рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ Windows рджреНрд╡рд╛рд░рд╛ **рд╡рд╕реНрддреБрдУрдВ рдХреЛ рдЯреНрд░реИрдХ рдФрд░ рдкрд╣рдЪрд╛рдирдиреЗ** рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдЗрд╕реЗ рд╕рдордЭрд╛рдиреЗ рдХреЗ рд▓рд┐рдП, рдиреАрдЪреЗ рджрд┐рдП рдЧрдП рдЙрджрд╛рд╣рд░рдгреЛрдВ рдкрд░ рдзреНрдпрд╛рди рджреЗрдВ:

* NAME\_DOMAIN.LOCAL рдбреЛрдореЗрди рдХреЗ рд▓рд┐рдП [SID](https://docs.microsoft.com/en-us/windows/security/identity-protection/access-control/security-identifiers) рд╣реИ: `S-1-5-21-1038751438-1834703946-36937684957`ред
* рдЬрдм рдПрдХ рд╡рд╕реНрддреБ рдбреЛрдореЗрди рдХреЗ рднреАрддрд░ рдмрдирд╛рдИ рдЬрд╛рддреА рд╣реИ, рддреЛ рдЙрдкрд░реЛрдХреНрдд рд╕рдВрдЦреНрдпрд╛ (SID) рдХреЛ рдПрдХ рдЖрд░рдЖрдИрдбреА рдХреЗ рд╕рд╛рде рдорд┐рд▓рд╛рдХрд░ рдПрдХ рдЕрджреНрд╡рд┐рддреАрдп рдорд╛рди рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдкреНрд░рдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ рдЬреЛ рд╡рд╕реНрддреБ рдХреЛ рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред
* рдЗрд╕рд▓рд┐рдП рдбреЛрдореЗрди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ `john` рдХреЗ рд╕рд╛рде рдПрдХ рдЖрд░рдЖрдИрдбреА:\[0x457] рд╣реЗрдХреНрд╕ 0x457 = рджрд╢рдорд▓рд╡ `1111`, рдХрд╛ рдкреВрд░рд╛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ SID рд╣реЛрдЧрд╛: `S-1-5-21-1038751438-1834703946-36937684957-1111`ред
* рдпрд╣ NAME\_DOMAIN.LOCAL рдбреЛрдореЗрди рдореЗрдВ `john` рд╡рд╕реНрддреБ рдХреЗ рд▓рд┐рдП рдЕрджреНрд╡рд┐рддреАрдп рд╣реИ рдФрд░ рдЖрдк рдХрднреА рдЗрд╕реЗ рдЗрд╕ рдбреЛрдореЗрди рдпрд╛ рдХрд┐рд╕реА рдЕрдиреНрдп рдбреЛрдореЗрди рдореЗрдВ рдХрд┐рд╕реА рдЕрдиреНрдп рд╡рд╕реНрддреБ рд╕реЗ рдЬреБрдбрд╝рд╛ рд╣реБрдЖ рдирд╣реАрдВ рджреЗрдЦреЗрдВрдЧреЗред

[**рдпрд╣рд╛рдБ**](https://academy.hackthebox.com/module/143/section/1269) рд╕реЗ рдкрд░рд┐рднрд╛рд╖рд╛ред

### **rpcclient рдХреЗ рд╕рд╛рде рдЬрд╛рдВрдЪ**

Samba рд╕реЗ **`rpcclient`** рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬреЛ **рдирд╛рдорд┐рдд рдкрд╛рдЗрдк рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ RPC рдЗрдВрдЯрд░рдлреЗрд╕** рдХреЗ рд╕рд╛рде рдмрд╛рддрдЪреАрдд рдХреЗ рд▓рд┐рдП рдЙрдкрдпреБрдХреНрдд рд╣реИред рдиреАрдЪреЗ рдРрд╕реЗ рдХрдорд╛рдВрдб рджрд┐рдП рдЧрдП рд╣реИрдВ рдЬреЛ рдПрдХ **SMB рд╕рддреНрд░ рд╕реНрдерд╛рдкрд┐рдд рд╣реЛрдиреЗ рдХреЗ рдмрд╛рдж** SAMR, LSARPC, рдФрд░ LSARPC-DS рдЗрдВрдЯрд░рдлреЗрд╕ рдХреЛ рдЬрд╛рдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдЬрд╛рд░реА рдХрд┐рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВ, рдЬрд┐рд╕рдореЗрдВ рдЕрдХреНрд╕рд░ рдкрд╣реБрдВрдЪ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред

#### рд╕рд░реНрд╡рд░ рд╕реВрдЪрдирд╛

* **рд╕рд░реНрд╡рд░ рд╕реВрдЪрдирд╛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ** рдХреЗ рд▓рд┐рдП: `srvinfo` рдХрдорд╛рдВрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

#### рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреА рдЬрд╛рдВрдЪ

* **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рд╕реВрдЪреАрдмрджреНрдз рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ** рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд░рдХреЗ: `querydispinfo` рдФрд░ `enumdomusers`ред
* **рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХрд╛ рд╡рд┐рд╡рд░рдг** рджреНрд╡рд╛рд░рд╛: `queryuser <0xrid>`ред
* **рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд╕рдореВрд╣** рдХреЗ рд╕рд╛рде: `queryusergroups <0xrid>`ред
* **рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХрд╛ SID рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ** рджреНрд╡рд╛рд░рд╛: `lookupnames <username>`ред
* **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рдЙрдкрдирд╛рдо** рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд░рдХреЗ: `queryuseraliases [builtin|domain] <sid>`ред
```bash
# Users' RIDs-forced
for i in $(seq 500 1100); do
rpcclient -N -U "" [IP_ADDRESS] -c "queryuser 0x$(printf '%x\n' $i)" | grep "User Name\|user_rid\|group_rid" && echo "";
done

# samrdump.py can also serve this purpose
```
#### рд╕рдореВрд╣реЛрдВ рдХрд╛ рдЬрд╛рдБрдЪ

* **рд╕рдореВрд╣** рдХреЗ рд▓рд┐рдП: `enumdomgroups`ред
* **рдПрдХ рд╕рдореВрд╣ рдХрд╛ рд╡рд┐рд╡рд░рдг** рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП: `querygroup <0xrid>`ред
* **рд╕рдореВрд╣ рдХреЗ рд╕рджрд╕реНрдп** рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдХреЗ рд▓рд┐рдП: `querygroupmem <0xrid>`ред

#### рдЙрдкрдирд╛рдо рд╕рдореВрд╣реЛрдВ рдХрд╛ рдЬрд╛рдБрдЪ

* **рдЙрдкрдирд╛рдо рд╕рдореВрд╣** рдХреЗ рд▓рд┐рдП: `enumalsgroups <builtin|domain>`ред
* **рдПрдХ рдЙрдкрдирд╛рдо рд╕рдореВрд╣ рдХреЗ рд╕рджрд╕реНрдп** рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдХреЗ рд▓рд┐рдП: `queryaliasmem builtin|domain <0xrid>`ред

#### рдбреЛрдореЗрдиреЛрдВ рдХрд╛ рдЬрд╛рдБрдЪ

* **рдбреЛрдореЗрди** рдХрд╛ рдЙрдкрдпреЛрдЧ: `enumdomains`ред
* **рдПрдХ рдбреЛрдореЗрди рдХрд╛ SID рдкреНрд░рд╛рдкреНрдд** рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП: `lsaquery`ред
* **рдбреЛрдореЗрди рд╕реВрдЪрдирд╛** рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП: `querydominfo`ред

#### рд╢реЗрдпрд░реЛрдВ рдХрд╛ рдЬрд╛рдБрдЪ

* **рд╕рднреА рдЙрдкрд▓рдмреНрдз рд╢реЗрдпрд░** рдХреЗ рд▓рд┐рдП: `netshareenumall`ред
* **рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рд╢реЗрдпрд░ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА** рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП: `netsharegetinfo <share>`ред

#### SIDs рдХреЗ рд╕рд╛рде рдЕрддрд┐рд░рд┐рдХреНрдд рдХрд╛рд░реНрдп

* **рдирд╛рдо рд╕реЗ SIDs** рдХрд╛ рдЙрдкрдпреЛрдЧ: `lookupnames <username>`ред
* **рдЕрдзрд┐рдХ SIDs** рдХреЗ рд▓рд┐рдП: `lsaenumsid`ред
* **рдЕрдзрд┐рдХ SIDs рдХреА рдЬрд╛рдБрдЪ рдХреЗ рд▓рд┐рдП RID рд╕рд╛рдЗрдХрд┐рд▓рд┐рдВрдЧ** рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ: `lookupsids <sid>`ред

#### **рдЕрддрд┐рд░рд┐рдХреНрдд рдХрдорд╛рдВрдб**

| **рдХрдорд╛рдВрдб**         | **рдЗрдВрдЯрд░рдлреЗрд╕**                                                                                                                                     | **рд╡рд┐рд╡рд░рдг**                                                                                                                           |
| ------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------- |
| queryuser           | SAMR                                                                                                                                              | рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЬрд╛рдирдХрд╛рд░реА рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ                                                                                                                 |
| querygroup          | рд╕рдореВрд╣ рдЬрд╛рдирдХрд╛рд░реА рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ                                                                                                                        |                                                                                                                                           |
| querydominfo        | рдбреЛрдореЗрди рдЬрд╛рдирдХрд╛рд░реА рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ                                                                                                                       |                                                                                                                                           |
| enumdomusers        | рдбреЛрдореЗрди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ                                                                                                                            |                                                                                                                                           |
| enumdomgroups       | рдбреЛрдореЗрди рд╕рдореВрд╣реЛрдВ рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ                                                                                                                           |                                                                                                                                           |
| createdomuser       | рдПрдХ рдбреЛрдореЗрди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдмрдирд╛рдПрдВ                                                                                                                              |                                                                                                                                           |
| deletedomuser       | рдПрдХ рдбреЛрдореЗрди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╣рдЯрд╛рдПрдВ                                                                                                                              |                                                                                                                                           |
| lookupnames         | LSARPC                                                                                                                                            | рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдореЛрдВ рдХреЛ SID рдорд╛рдиреЛрдВ[a](https://learning.oreilly.com/library/view/network-security-assessment/9781491911044/ch08.html#ch08fn8) рдорд╛рдиреЛрдВ |
| lookupsids          | SIDs рдХреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдореЛрдВ рдореЗрдВ рдЦреЛрдЬреЗрдВ (RID[b](https://learning.oreilly.com/library/view/network-security-assessment/9781491911044/ch08.html#ch08fn9) рд╕рд╛рдЗрдХрд┐рд▓рд┐рдВрдЧ) |                                                                                                                                           |
| lsaaddacctrights    | рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЦрд╛рддреЗ рдореЗрдВ рдЕрдзрд┐рдХрд╛рд░ рдЬреЛрдбрд╝реЗрдВ                                                                                                                      |                                                                                                                                           |
| lsaremoveacctrights | рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЦрд╛рддреЗ рд╕реЗ рдЕрдзрд┐рдХрд╛рд░ рд╣рдЯрд╛рдПрдВ                                                                                                                 |                                                                                                                                           |
| dsroledominfo       | LSARPC-DS                                                                                                                                         | рдкреНрд░рд╛рдердорд┐рдХ рдбреЛрдореЗрди рд╕реВрдЪрдирд╛ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ                                                                                                            |
| dsenumdomtrusts     | AD рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди рд╡рди
