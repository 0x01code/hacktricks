# Enumera√ß√£o do rpcclient

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Voc√™ trabalha em uma **empresa de seguran√ßa cibern√©tica**? Voc√™ quer ver sua **empresa anunciada no HackTricks**? ou voc√™ quer ter acesso √† **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**? Verifique os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* **Junte-se ao** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para o [reposit√≥rio hacktricks](https://github.com/carlospolop/hacktricks) e [reposit√≥rio hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>

<figure><img src="/.gitbook/assets/image (675).png" alt=""><figcaption></figcaption></figure>

Encontre vulnerabilidades que s√£o mais importantes para que voc√™ possa corrigi-las mais rapidamente. O Intruder rastreia sua superf√≠cie de ataque, executa varreduras proativas de amea√ßas, encontra problemas em toda a sua pilha de tecnologia, desde APIs at√© aplicativos da web e sistemas em nuvem. [**Experimente gratuitamente**](https://www.intruder.io/?utm\_source=referral\&utm\_campaign=hacktricks) hoje.

{% embed url="https://www.intruder.io/?utm_campaign=hacktricks&utm_source=referral" %}

***

### **O que √© um RID**

Um [Identificador Relativo (RID)](https://docs.microsoft.com/en-us/windows/security/identity-protection/access-control/security-identifiers) √© um **identificador √∫nico** (representado em formato hexadecimal) utilizado pelo Windows para **rastrear e identificar objetos**. Para explicar como isso se encaixa, vamos olhar para os exemplos abaixo:

* O [SID](https://docs.microsoft.com/en-us/windows/security/identity-protection/access-control/security-identifiers) para o dom√≠nio NAME\_DOMAIN.LOCAL √©: `S-1-5-21-1038751438-1834703946-36937684957`.
* Quando um objeto √© criado dentro de um dom√≠nio, o n√∫mero acima (SID) ser√° combinado com um RID para criar um valor √∫nico usado para representar o objeto.
* Portanto, o usu√°rio do dom√≠nio `john` com um RID:\[0x457] Hex 0x457 seria = decimal `1111`, ter√° um SID de usu√°rio completo: `S-1-5-21-1038751438-1834703946-36937684957-1111`.
* Isso √© √∫nico para o objeto `john` no dom√≠nio NAME\_DOMAIN.LOCAL e voc√™ nunca ver√° esse valor emparelhado ligado a outro objeto neste dom√≠nio ou em qualquer outro.

Defini√ß√£o da [**qui**](https://academy.hackthebox.com/module/143/section/1269).

### **Enumera√ß√£o com rpcclient**

**Parte desta se√ß√£o foi extra√≠da do livro "**_**Network Security Assesment 3rd Edition**_**"**

Voc√™ pode usar a utilidade **`rpcclient`** do Samba para interagir com **pontos de extremidade RPC via named pipes**. A seguir est√£o listados comandos que voc√™ pode emitir para as interfaces SAMR, LSARPC e LSARPC-DS ao **estabelecer** uma **sess√£o SMB** (geralmente exigindo credenciais).

#### Informa√ß√µes do servidor

* **Informa√ß√µes do servidor**: `srvinfo`

#### Enumera√ß√£o de usu√°rios

* **Listar usu√°rios**: `querydispinfo` e `enumdomusers`
* **Obter detalhes do usu√°rio**: `queryuser <0xrid>`
* **Obter grupos do usu√°rio**: `queryusergroups <0xrid>`
* **Obter SID de um usu√°rio**: `lookupnames <username>`
* **Obter aliases de usu√°rios**: `queryuseraliases [builtin|domain] <sid>`
```bash
# Brute-Force users RIDs
for i in $(seq 500 1100); do
rpcclient -N -U "" 10.129.14.128 -c "queryuser 0x$(printf '%x\n' $i)" | grep "User Name\|user_rid\|group_rid" && echo "";
done

# You can also use samrdump.py for this purpose
```
#### Enumera√ß√£o de Grupos

* **Listar grupos**: `enumdomgroups`
* **Obter detalhes do grupo**: `querygroup <0xrid>`
* **Obter membros do grupo**: `querygroupmem <0xrid>`

#### Enumera√ß√£o de Grupos de Alias

* **Listar alias**: `enumalsgroups <builtin|domain>`
* **Obter membros**: `queryaliasmem builtin|domain <0xrid>`

#### Enumera√ß√£o de Dom√≠nios

* **Listar dom√≠nios**: `enumdomains`
* **Obter SID**: `lsaquery`
* **Informa√ß√µes do dom√≠nio**: `querydominfo`

#### Enumera√ß√£o de Compartilhamentos

* **Enumerar todos os compartilhamentos dispon√≠veis**: `netshareenumall`
* **Informa√ß√µes sobre um compartilhamento**: `netsharegetinfo <share>`

#### Mais SIDs

* **Encontrar SIDs pelo nome**: `lookupnames <username>`
* **Encontrar mais SIDs**: `lsaenumsid`
* **Ciclagem de RID (verificar mais SIDs)**: `lookupsids <sid>`

#### **Comandos extras**

| **Comando**          | **Interface**                                                                                                                                     | **Descri√ß√£o**                                                                                                                           |
| -------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------- |
| queryuser            | SAMR                                                                                                                                              | Recuperar informa√ß√µes do usu√°rio                                                                                                                 |
| querygroup           | Recuperar informa√ß√µes do grupo                                                                                                                        |                                                                                                                                           |
| querydominfo         | Recuperar informa√ß√µes do dom√≠nio                                                                                                                       |                                                                                                                                           |
| enumdomusers         | Enumerar usu√°rios do dom√≠nio                                                                                                                            |                                                                                                                                           |
| enumdomgroups        | Enumerar grupos do dom√≠nio                                                                                                                           |                                                                                                                                           |
| createdomuser        | Criar um usu√°rio do dom√≠nio                                                                                                                              |                                                                                                                                           |
| deletedomuser        | Excluir um usu√°rio do dom√≠nio                                                                                                                              |                                                                                                                                           |
| lookupnames          | LSARPC                                                                                                                                            | Pesquisar nomes de usu√°rio para valores SID[a](https://learning.oreilly.com/library/view/network-security-assessment/9781491911044/ch08.html#ch08fn8) |
| lookupsids           | Pesquisar SIDs para nomes de usu√°rio (ciclagem de RID[b](https://learning.oreilly.com/library/view/network-security-assessment/9781491911044/ch08.html#ch08fn9)) |                                                                                                                                           |
| lsaaddacctrights     | Adicionar direitos a uma conta de usu√°rio                                                                                                                      |                                                                                                                                           |
| lsaremoveacctrights  | Remover direitos de uma conta de usu√°rio                                                                                                                 |                                                                                                                                           |
| dsroledominfo        | LSARPC-DS                                                                                                                                         | Obter informa√ß√µes do dom√≠nio prim√°rio                                                                                                            |
| dsenumdomtrusts      | Enumerar dom√≠nios confi√°veis dentro de uma floresta AD                                                                                                     |                                                                                                                                           |

Para **entender** melhor como as ferramentas _**samrdump**_ **e** _**rpcdump**_ funcionam, voc√™ deve ler [**Pentesting MSRPC**](../135-pentesting-msrpc.md).

<figure><img src="/.gitbook/assets/image (675).png" alt=""><figcaption></figcaption></figure>

Encontre vulnerabilidades que s√£o mais importantes para que voc√™ possa corrigi-las mais rapidamente. O Intruder rastreia sua superf√≠cie de ataque, executa varreduras proativas de amea√ßas, encontra problemas em toda a sua pilha de tecnologia, desde APIs at√© aplicativos da web e sistemas em nuvem. [**Experimente gratuitamente**](https://www.intruder.io/?utm\_source=referral\&utm\_campaign=hacktricks) hoje.

{% embed url="https://www.intruder.io/?utm_campaign=hacktricks&utm_source=referral" %}


<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Voc√™ trabalha em uma **empresa de ciberseguran√ßa**? Voc√™ quer ver sua **empresa anunciada no HackTricks**? ou voc√™ quer ter acesso √† **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**? Verifique os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Descubra [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* **Junte-se ao** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para o [reposit√≥rio hacktricks](https://github.com/carlospolop/hacktricks) e [hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)**.

</details>
