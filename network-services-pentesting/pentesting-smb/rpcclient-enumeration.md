# Enumerazione rpcclient

<details>

<summary><strong>Impara l'hacking di AWS da zero a esperto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Lavori in una **azienda di sicurezza informatica**? Vuoi vedere la tua **azienda pubblicizzata in HackTricks**? o vuoi avere accesso all'**ultima versione di PEASS o scaricare HackTricks in PDF**? Controlla i [**PACCHETTI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Scopri [**The PEASS Family**](https://opensea.io/collection/the-peass-family), la nostra collezione di esclusive [**NFT**](https://opensea.io/collection/the-peass-family)
* Ottieni il [**merchandising ufficiale di PEASS & HackTricks**](https://peass.creator-spring.com)
* **Unisciti al** [**üí¨**](https://emojipedia.org/speech-balloon/) [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo Telegram**](https://t.me/peass) o **seguimi** su **Twitter** üê¶[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR al [repo hacktricks](https://github.com/carlospolop/hacktricks) e al [repo hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>

<figure><img src="/.gitbook/assets/image (675).png" alt=""><figcaption></figcaption></figure>

Trova le vulnerabilit√† che contano di pi√π in modo da poterle correggere pi√π velocemente. Intruder traccia la tua superficie di attacco, esegue scansioni proattive delle minacce, trova problemi in tutta la tua infrastruttura tecnologica, dalle API alle applicazioni web e ai sistemi cloud. [**Provalo gratuitamente**](https://www.intruder.io/?utm\_source=referral\&utm\_campaign=hacktricks) oggi stesso.

{% embed url="https://www.intruder.io/?utm_campaign=hacktricks&utm_source=referral" %}

***

### **Cos'√® un RID**

### Panoramica degli identificatori relativi (RID) e degli identificatori di sicurezza (SID)

Gli **identificatori relativi (RID)** e gli **identificatori di sicurezza (SID)** sono componenti chiave nei sistemi operativi Windows per identificare e gestire in modo univoco oggetti, come utenti e gruppi, all'interno di un dominio di rete.

- Gli **SID** fungono da identificatori univoci per i domini, garantendo che ogni dominio sia distinguibile.
- I **RID** vengono aggiunti agli SID per creare identificatori univoci per gli oggetti all'interno di quei domini. Questa combinazione consente un tracciamento e una gestione precisi delle autorizzazioni degli oggetti e dei controlli di accesso.

Ad esempio, un utente di nome `pepe` potrebbe avere un identificatore univoco che combina l'SID del dominio con il suo RID specifico, rappresentato sia in formato esadecimale (`0x457`) che decimale (`1111`). Questo porta a un identificatore completo e univoco per pepe all'interno del dominio come: `S-1-5-21-1074507654-1937615267-42093643874-1111`.


### **Enumerazione con rpcclient**

L'utilit√† **`rpcclient`** di Samba viene utilizzata per interagire con **endpoint RPC tramite named pipe**. Di seguito sono riportati i comandi che possono essere eseguiti sulle interfacce SAMR, LSARPC e LSARPC-DS dopo l'**instaurazione di una sessione SMB**, spesso richiedendo credenziali.

#### Informazioni sul server

* Per ottenere le **informazioni sul server**: viene utilizzato il comando `srvinfo`.

#### Enumerazione degli utenti

* Gli **utenti possono essere elencati** utilizzando: `querydispinfo` e `enumdomusers`.
* **Dettagli di un utente** con: `queryuser <0xrid>`.
* **Gruppi di un utente** con: `queryusergroups <0xrid>`.
* **Viene recuperato l'SID di un utente** tramite: `lookupnames <username>`.
* **Alias degli utenti** con: `queryuseraliases [builtin|domain] <sid>`.
```bash
# Users' RIDs-forced
for i in $(seq 500 1100); do
rpcclient -N -U "" [IP_ADDRESS] -c "queryuser 0x$(printf '%x\n' $i)" | grep "User Name\|user_rid\|group_rid" && echo "";
done

# samrdump.py can also serve this purpose
```
#### Enumerazione dei gruppi

* **Gruppi** con: `enumdomgroups`.
* **Dettagli di un gruppo** con: `querygroup <0xrid>`.
* **Membri di un gruppo** tramite: `querygroupmem <0xrid>`.

#### Enumerazione dei gruppi di alias

* **Gruppi di alias** con: `enumalsgroups <builtin|domain>`.
* **Membri di un gruppo di alias** con: `queryaliasmem builtin|domain <0xrid>`.

#### Enumerazione dei domini

* **Domini** usando: `enumdomains`.
* **SID di un dominio viene recuperato** tramite: `lsaquery`.
* **Informazioni sul dominio vengono ottenute** tramite: `querydominfo`.

#### Enumerazione delle condivisioni

* **Tutte le condivisioni disponibili** con: `netshareenumall`.
* **Informazioni su una specifica condivisione vengono recuperate** con: `netsharegetinfo <share>`.

#### Operazioni aggiuntive con SID

* **SID per nome** usando: `lookupnames <username>`.
* **Altri SID** tramite: `lsaenumsid`.
* **Ciclo RID per controllare pi√π SID** viene eseguito con: `lookupsids <sid>`.

#### **Comandi aggiuntivi**

| **Comando**         | **Interfaccia**                                                                                                                                     | **Descrizione**                                                                                                                           |
| ------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------- |
| queryuser           | SAMR                                                                                                                                              | Recupera informazioni utente                                                                                                                 |
| querygroup          | Recupera informazioni gruppo                                                                                                                        |                                                                                                                                           |
| querydominfo        | Recupera informazioni dominio                                                                                                                       |                                                                                                                                           |
| enumdomusers        | Enumera utenti del dominio                                                                                                                            |                                                                                                                                           |
| enumdomgroups       | Enumera gruppi del dominio                                                                                                                           |                                                                                                                                           |
| createdomuser       | Crea un utente di dominio                                                                                                                              |                                                                                                                                           |
| deletedomuser       | Elimina un utente di dominio                                                                                                                              |                                                                                                                                           |
| lookupnames         | LSARPC                                                                                                                                            | Cerca nomi utente per valori SID[a](https://learning.oreilly.com/library/view/network-security-assessment/9781491911044/ch08.html#ch08fn8) |
| lookupsids          | Cerca SID per nomi utente (ciclo RID[b](https://learning.oreilly.com/library/view/network-security-assessment/9781491911044/ch08.html#ch08fn9)) |                                                                                                                                           |
| lsaaddacctrights    | Aggiunge diritti a un account utente                                                                                                                      |                                                                                                                                           |
| lsaremoveacctrights | Rimuove diritti da un account utente                                                                                                                 |                                                                                                                                           |
| dsroledominfo       | LSARPC-DS                                                                                                                                         | Ottiene informazioni sul dominio primario                                                                                                            |
| dsenumdomtrusts     | Enumera domini fidati all'interno di un forest AD                                                                                                     |                                                                                                                                           |

Per **comprendere** meglio come funzionano gli strumenti _**samrdump**_ **e** _**rpcdump**_ dovresti leggere [**Pentesting MSRPC**](../135-pentesting-msrpc.md).

<figure><img src="/.gitbook/assets/image (675).png" alt=""><figcaption></figcaption></figure>

Trova le vulnerabilit√† che contano di pi√π in modo da poterle correggere pi√π velocemente. Intruder traccia la tua superficie di attacco, esegue scansioni proattive delle minacce, trova problemi in tutta la tua infrastruttura tecnologica, dalle API alle applicazioni web e ai sistemi cloud. [**Provalo gratuitamente**](https://www.intruder.io/?utm\_source=referral\&utm\_campaign=hacktricks) oggi stesso.

{% embed url="https://www.intruder.io/?utm_campaign=hacktricks&utm_source=referral" %}


<details>

<summary><strong>Impara l'hacking di AWS da zero a esperto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Lavori in un'**azienda di sicurezza informatica**? Vuoi vedere la tua **azienda pubblicizzata su HackTricks**? o vuoi avere accesso all'**ultima versione di PEASS o scaricare HackTricks in PDF**? Controlla i [**PACCHETTI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Scopri [**The PEASS Family**](https://opensea.io/collection/the-peass-family), la nostra collezione di esclusive [**NFT**](https://opensea.io/collection/the-peass-family)
* Ottieni il [**merchandising ufficiale di PEASS & HackTricks**](https://peass.creator-spring.com)
* **Unisciti al** [**üí¨**](https://emojipedia.org/speech-balloon/) [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo Telegram**](https://t.me/peass) o **seguimi** su **Twitter** üê¶[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR al [repo hacktricks](https://github.com/carlospolop/hacktricks) e al [repo hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>
