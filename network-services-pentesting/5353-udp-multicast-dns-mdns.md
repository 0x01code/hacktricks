# 5353/UDP Multicast DNS (mDNS) e DNS-SD

<details>

<summary><strong>Aprenda hacking na AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ deseja ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**swag oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-nos** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para os reposit√≥rios** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## **Informa√ß√µes B√°sicas**

**Multicast DNS (mDNS)** permite opera√ß√µes **semelhantes ao DNS** em redes locais sem a necessidade de um servidor DNS tradicional. Ele opera na porta **UDP 5353** e permite que dispositivos descubram uns aos outros e seus servi√ßos, comumente visto em v√°rios dispositivos IoT. **Descoberta de Servi√ßo DNS (DNS-SD)**, frequentemente usada junto com mDNS, auxilia na identifica√ß√£o de servi√ßos dispon√≠veis na rede por meio de consultas DNS padr√£o.
```
PORT     STATE SERVICE
5353/udp open  zeroconf
```
### **Opera√ß√£o do mDNS**

Em ambientes sem um servidor DNS padr√£o, o mDNS permite que dispositivos resolvam nomes de dom√≠nio terminados em **.local** consultando o endere√ßo de multicast **224.0.0.251** (IPv4) ou **FF02::FB** (IPv6). Aspectos importantes do mDNS incluem um valor de **Tempo de Vida (TTL)** indicando a validade do registro e um **bit QU** que distingue entre consultas unicast e multicast. Em termos de seguran√ßa, √© crucial que as implementa√ß√µes do mDNS verifiquem se o endere√ßo de origem do pacote est√° alinhado com a sub-rede local.

### **Funcionamento do DNS-SD**

O DNS-SD facilita a descoberta de servi√ßos de rede consultando registros de ponteiro (PTR) que mapeiam tipos de servi√ßo para suas inst√¢ncias. Os servi√ßos s√£o identificados usando um padr√£o **_\<Service>.\_tcp or \_\<Service>.\_udp** dentro do dom√≠nio **.local**, levando √† descoberta dos registros **SRV** e **TXT** correspondentes que fornecem informa√ß√µes detalhadas do servi√ßo.

### **Explora√ß√£o de Rede**

#### **Uso do nmap**

Um comando √∫til para escanear a rede local em busca de servi√ßos mDNS √©:
```bash
nmap -Pn -sUC -p5353 [target IP address]
```
Este comando ajuda a identificar portas mDNS abertas e os servi√ßos anunciados sobre elas.

#### **Enumera√ß√£o de Rede com Pholus**

Para enviar ativamente solicita√ß√µes mDNS e capturar tr√°fego, a ferramenta **Pholus** pode ser utilizada da seguinte forma:
```bash
sudo python3 pholus3.py [network interface] -rq -stimeout 10
```
## Ataques

### **Explorando a Sonda mDNS**

Um vetor de ataque envolve o envio de respostas falsificadas para sondas mDNS, sugerindo que todos os nomes potenciais j√° est√£o em uso, dificultando assim que novos dispositivos selecionem um nome √∫nico. Isso pode ser executado usando:
```bash
sudo python pholus.py [network interface] -afre -stimeout 1000
```
Esta t√©cnica bloqueia efetivamente novos dispositivos de registrar seus servi√ßos na rede.

**Em resumo**, entender o funcionamento do mDNS e do DNS-SD √© crucial para a gest√£o e seguran√ßa de redes. Ferramentas como **nmap** e **Pholus** oferecem insights valiosos sobre os servi√ßos de rede locais, enquanto a consci√™ncia de vulnerabilidades potenciais ajuda a proteger contra ataques.


### Spoofing/MitM

O ataque mais interessante que voc√™ pode realizar sobre este servi√ßo √© realizar um **MitM** na **comunica√ß√£o entre o cliente e o servidor real**. Voc√™ pode ser capaz de obter arquivos sens√≠veis (MitM na comunica√ß√£o com a impressora) ou at√© credenciais (autentica√ß√£o do Windows).\
Para mais informa√ß√µes, consulte:

{% content-ref url="../generic-methodologies-and-resources/pentesting-network/spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md" %}
[spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md](../generic-methodologies-and-resources/pentesting-network/spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md)
{% endcontent-ref %}

## Refer√™ncias

* [Practical IoT Hacking: O Guia Definitivo para Atacar a Internet das Coisas](https://books.google.co.uk/books/about/Practical\_IoT\_Hacking.html?id=GbYEEAAAQBAJ\&redir\_esc=y)

<details>

<summary><strong>Aprenda a hackear a AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ deseja ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF** Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**swag oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-nos** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para os** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) reposit√≥rios do github.

</details>
