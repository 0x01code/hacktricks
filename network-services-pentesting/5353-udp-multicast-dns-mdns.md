## Informations de base

Multicast DNS (mDNS) est un protocole de **configuration z√©ro** qui vous permet d'effectuer des op√©rations **de type DNS** sur le r√©seau local en l'absence d'un serveur DNS classique en unicast. Le protocole utilise la **m√™me** API, les **formats de paquets** et les s√©mantiques de fonctionnement que DNS, vous permettant de r√©soudre des noms de domaine sur le r√©seau local. **DNS Service Discovery (DNS-SD)** est un protocole qui permet aux clients de **d√©couvrir une liste d'instances nomm√©es de services** (tels que test.\_ipps.\_tcp.local, ou linux.\_ssh.\_tcp.local) dans un domaine en utilisant des requ√™tes DNS standard. DNS-SD est le plus souvent utilis√© en conjonction avec mDNS mais n'en d√©pend pas. Ils sont tous deux utilis√©s par de nombreux appareils IoT, tels que les imprimantes r√©seau, les Apple TV, les Google Chromecast, les dispositifs de stockage en r√©seau (NAS) et les cam√©ras.\
**Port par d√©faut:** 5353/UDP
```
PORT     STATE SERVICE
5353/udp open  zeroconf
```
### Comment fonctionne mDNS

Les appareils utilisent mDNS lorsque le r√©seau local **ne dispose pas** d'un **serveur DNS unicast conventionnel**. Pour r√©soudre un nom de domaine pour une adresse locale en utilisant mDNS, l'appareil envoie une **requ√™te DNS pour un nom de domaine** se terminant par **.local** √† l'**adresse multicast** 224.0.0.251 (pour IPv4) ou FF02::FB (pour IPv6). Vous pouvez √©galement utiliser mDNS pour r√©soudre des **noms de domaine globaux** (non .local), mais les impl√©mentations de mDNS sont cens√©es **d√©sactiver** ce comportement par d√©faut. Les demandes et les r√©ponses mDNS utilisent **UDP** et le **port 5353** √† la fois comme port source et port de destination.

Les r√©ponses mDNS contiennent plusieurs indicateurs importants, notamment une valeur de **Time-to-Live** (TTL) qui indique pendant combien de secondes l'enregistrement est valide. L'envoi d'une r√©ponse avec **TTL=0 signifie que l'enregistrement correspondant doit √™tre effac√©**. Un autre indicateur important est le bit QU, qui indique si la requ√™te est une requ√™te unicast ou non. Si le **bit QU n'est pas d√©fini**, le paquet est une requ√™te multicast (QM). √âtant donn√© qu'il est possible de **recevoir des requ√™tes unicast en dehors du lien local**, les impl√©mentations s√©curis√©es de mDNS doivent toujours **v√©rifier que l'adresse source dans le paquet correspond √† la plage d'adresses de sous-r√©seau local**.

### Comment fonctionne DNS-SD

DNS-SD permet aux clients de **d√©couvrir les services disponibles sur le r√©seau**. Pour l'utiliser, les clients envoient des requ√™tes DNS standard pour des enregistrements de pointeur (PTR), qui associent le type de service √† une liste de noms d'instances sp√©cifiques de ce type de service.

Pour demander un enregistrement PTR, les clients utilisent la forme de nom "\<Service>.\<Domaine>". La partie **\<Service>** est le **nom du service** pr√©c√©d√© de "_" (par exemple, \_ipps, \_printer ou \_ipp) et soit **\_tcp ou \_udp**. La partie **\<Domaine>** est "**.local**".\
Les **r√©pondeurs** renvoient ensuite les enregistrements PTR qui pointent vers les **enregistrements de service (SRV)** et de **texte (TXT)** correspondants. Voici un exemple d'enregistrement PTR :
```
  _ipps._tcp.local: type PTR, class IN, test._ipps._tcp.local
```
La partie du record PTR √† gauche des deux-points est son nom, et celle √† droite est le record SRV vers lequel pointe le PTR. Le record SRV r√©pertorie l'h√¥te et le port cible o√π l'instance de service peut √™tre atteinte. Par exemple, l'image suivante montre un enregistrement SRV "test._ipps._tcp.local" dans Wireshark sur l'h√¥te ubuntu.local et le port 8000 :

![](<../.gitbook/assets/image (651) (1) (1) (1) (1).png>)

Par cons√©quent, le nom du record SRV est similaire au record PTR pr√©c√©d√© du nom de l'instance (test dans ce cas). Le TXT a le m√™me nom que le record SRV et contient les informations n√©cessaires lorsque l'adresse IP et le num√©ro de port (contenus dans le record SRV) pour un service ne sont pas suffisants pour l'identifier.

## √ânum√©ration

### nmap
```bash
nmap -Pn -sUC -p5353 192.168.1.2

Starting Nmap 6.46 (http://nmap.org) at 2015-01-01 10:30 GMT
Nmap scan report for 192.168.1.2
PORT     STATE SERVICE
5353/udp open  zeroconf
| dns-service-discovery:
|   9/tcp workstation
|     Address=192.168.1.2
|   22/tcp ssh
|     Address=192.168.1.2
|   22/tcp sftp-ssh
|     Address=192.168.1.2
|   445/tcp smb
|     Address=192.168.1.2
```
### √ânum√©ration du r√©seau

Vous pouvez en apprendre beaucoup sur le r√©seau local en envoyant simplement des requ√™tes mDNS et en capturant le trafic multicast mDNS.

Vous pouvez utiliser l'outil [**Pholus**](https://github.com/aatlasis/Pholus/) pour envoyer des requ√™tes mDNS (-rq) sur le r√©seau local et capturer le trafic multicast mDNS (pendant -stimeout 10 secondes):
```bash
sudo python3 pholus3.py eth0 -rq -stimeout 10
```
## Attaques

### Abus de la phase de sondage mDNS

Lorsqu'un r√©pondeur mDNS d√©marre ou modifie sa connectivit√©, il demande au r√©seau local s'il existe **une ressource avec le nom qu'il pr√©voit d'utiliser**. Si la r√©ponse contient l'enregistrement en question, l'h√¥te de sondage **doit choisir un nouveau nom**. Si 15 conflits ont lieu dans les 10 secondes, l'h√¥te doit alors attendre au moins cinq secondes avant toute tentative suppl√©mentaire. De plus, si une minute s'√©coule pendant laquelle l'h√¥te ne peut pas trouver de nom inutilis√©, il signale une erreur √† l'utilisateur.

La commande suivante emp√™chera tout nouveau p√©riph√©rique d'obtenir un nouveau nom car elle indiquera que **tout nom est d√©j√† pris** :
```bash
sudo python pholus.py eth0 -afre -stimeout 1000
```
### Spoofing/MitM

L'attaque la plus int√©ressante que vous pouvez effectuer sur ce service est de r√©aliser une **MitM** dans la **communication entre le client et le serveur r√©el**. Vous pourriez √™tre en mesure d'obtenir des fichiers sensibles (MitM la communication avec l'imprimante) voire des informations d'identification (authentification Windows).\
Pour plus d'informations, consultez :

{% content-ref url="../generic-methodologies-and-resources/pentesting-network/spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md" %}
[spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md](../generic-methodologies-and-resources/pentesting-network/spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md)
{% endcontent-ref %}

## R√©f√©rences

* [Practical IoT Hacking: The Definitive Guide to Attacking the Internet of Things](https://books.google.co.uk/books/about/Practical\_IoT\_Hacking.html?id=GbYEEAAAQBAJ\&redir\_esc=y)

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

- Travaillez-vous dans une **entreprise de cybers√©curit√©** ? Voulez-vous voir votre **entreprise annonc√©e dans HackTricks** ? ou voulez-vous avoir acc√®s √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !

- D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)

- Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)

- **Rejoignez le** [**üí¨**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**

- **Partagez vos astuces de piratage en soumettant des PR au repo [hacktricks](https://github.com/carlospolop/hacktricks) et [hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>
