# 53 - Pentesting DNS

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Voc√™ trabalha em uma **empresa de ciberseguran√ßa**? Voc√™ quer ver sua **empresa anunciada no HackTricks**? ou voc√™ quer ter acesso √† **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**? Verifique os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* **Junte-se ao** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para o** [**reposit√≥rio hacktricks**](https://github.com/carlospolop/hacktricks) **e** [**reposit√≥rio hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

<figure><img src="../.gitbook/assets/image (1) (1) (2) (4).png" alt=""><figcaption></figcaption></figure>

[**DragonJAR Security Conference √© um evento internacional de ciberseguran√ßa**](https://www.dragonjarcon.org/) com mais de uma d√©cada que ser√° realizado nos dias 7 e 8 de setembro de 2023 em Bogot√°, Col√¥mbia. √â um evento de alto conte√∫do t√©cnico onde s√£o apresentadas as √∫ltimas pesquisas em espanhol que atraem hackers e pesquisadores de todo o mundo.\
Registre-se agora no link abaixo e n√£o perca esta grande confer√™ncia!:

{% embed url="https://www.dragonjarcon.org/" %}

## **Informa√ß√µes b√°sicas**

O Sistema de Nomes de Dom√≠nio (DNS) √© a lista telef√¥nica da Internet. Os seres humanos acessam informa√ß√µes online por meio de nomes de dom√≠nio, como nytimes.com ou espn.com. Os navegadores da web interagem por meio de endere√ßos de Protocolo de Internet (IP). O DNS traduz nomes de dom√≠nio em [endere√ßos IP](https://www.cloudflare.com/learning/dns/glossary/what-is-my-ip-address/) para que os navegadores possam carregar recursos da Internet.\
De [aqui](https://www.cloudflare.com/learning/dns/what-is-dns/).

**Porta padr√£o:** 53
```
PORT     STATE SERVICE  REASON
53/tcp   open  domain  Microsoft DNS 6.1.7601 (1DB15D39) (Windows Server 2008 R2 SP1)
5353/udp open  zeroconf udp-response
53/udp   open  domain  Microsoft DNS 6.1.7601 (1DB15D39) (Windows Server 2008 R2 SP1)
```
### Diferentes Servidores DNS

Informa√ß√µes de [https://academy.hackthebox.com/module/112/section/1069](https://academy.hackthebox.com/module/112/section/1069)

| **Tipo de Servidor**           | **Descri√ß√£o**                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| ------------------------------ | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `Servidor Raiz DNS`            | Os servidores raiz do DNS s√£o respons√°veis pelos dom√≠nios de n√≠vel superior (`TLD`). Como √∫ltima inst√¢ncia, eles s√≥ s√£o solicitados se o servidor de nomes n√£o responder. Assim, um servidor raiz √© uma interface central entre os usu√°rios e o conte√∫do na Internet, pois ele vincula dom√≠nio e endere√ßo IP. A [Corpora√ß√£o da Internet para Atribui√ß√£o de Nomes e N√∫meros](https://www.icann.org/) (`ICANN`) coordena o trabalho dos servidores de nomes raiz. Existem `13` desses servidores raiz ao redor do mundo. |
| `Servidor de Nomes Autoritativo`| Servidores de nomes autoritativos possuem autoridade sobre uma zona espec√≠fica. Eles respondem apenas a consultas de sua √°rea de responsabilidade, e suas informa√ß√µes s√£o vinculativas. Se um servidor de nomes autoritativo n√£o puder responder a uma consulta do cliente, o servidor de nomes raiz assume nesse ponto.                                                                                                                                                                                                            |
| `Servidor de Nomes N√£o Autoritativo` | Servidores de nomes n√£o autoritativos n√£o s√£o respons√°veis por uma zona DNS espec√≠fica. Em vez disso, eles coletam informa√ß√µes sobre zonas DNS espec√≠ficas por conta pr√≥pria, o que √© feito usando consultas DNS recursivas ou iterativas.                                                                                                                                                                                                                                                                               |
| `Servidor DNS em Cache`        | Servidores DNS em cache armazenam em cache informa√ß√µes de outros servidores de nomes por um per√≠odo especificado. O servidor de nomes autoritativo determina a dura√ß√£o desse armazenamento.                                                                                                                                                                                                                                                                                                                             |
| `Servidor de Encaminhamento`   | Servidores de encaminhamento executam apenas uma fun√ß√£o: eles encaminham consultas DNS para outro servidor DNS.                                                                                                                                                                                                                                                                                                                                                                                            |
| `Resolvedor`                   | Resolvedores n√£o s√£o servidores DNS autoritativos, mas realizam a resolu√ß√£o de nomes localmente no computador ou roteador.                                                                                                                                                                                                                                                                                                                                                                               |

## Enumera√ß√£o

### **Banner Grabbing**

O DNS n√£o possui um "banner" para ser obtido. O equivalente mais pr√≥ximo √© uma consulta m√°gica para `version.bind. CHAOS TXT`, que funcionar√° na maioria dos servidores BIND.\
Voc√™ pode realizar essa consulta usando o `dig`:
```bash
dig version.bind CHAOS TXT @DNS
```
Se isso n√£o funcionar, voc√™ pode usar t√©cnicas de fingerprinting para determinar a vers√£o do servidor remoto - a ferramenta [`fpdns`](https://github.com/kirei/fpdns) √© uma op√ß√£o para isso, mas existem outras.

Voc√™ tamb√©m pode obter o banner com um script do **nmap**:
```
--script dns-nsid
```
### **Qualquer registro**

O registro **ANY** solicitar√° ao servidor DNS que **retorne** todas as **entradas** dispon√≠veis que **ele est√° disposto a divulgar**.
```bash
dig any victim.com @<DNS_IP>
```
### **Transfer√™ncia de Zona**

Este procedimento √© abreviado como `Transfer√™ncia de Zona Completa Ass√≠ncrona` (`AXFR`).
```bash
dig axfr @<DNS_IP> #Try zone transfer without domain
dig axfr @<DNS_IP> <DOMAIN> #Try zone transfer guessing the domain
fierce --domain <DOMAIN> --dns-servers <DNS_IP> #Will try toperform a zone transfer against every authoritative name server and if this doesn'twork, will launch a dictionary attack
```
### Mais informa√ß√µes
```bash
dig ANY @<DNS_IP> <DOMAIN>     #Any information
dig A @<DNS_IP> <DOMAIN>       #Regular DNS request
dig AAAA @<DNS_IP> <DOMAIN>    #IPv6 DNS request
dig TXT @<DNS_IP> <DOMAIN>     #Information
dig MX @<DNS_IP> <DOMAIN>      #Emails related
dig NS @<DNS_IP> <DOMAIN>      #DNS that resolves that name
dig -x 192.168.0.2 @<DNS_IP>   #Reverse lookup
dig -x 2a00:1450:400c:c06::93 @<DNS_IP> #reverse IPv6 lookup

#Use [-p PORT]  or  -6 (to use ivp6 address of dns)
```
#### Automa√ß√£o

Automating tasks is a crucial aspect of DNS pentesting. It allows you to efficiently perform repetitive tasks and save time. There are various tools and scripts available that can help you automate different aspects of DNS pentesting.

##### Enumeration

Enumeration is an important phase in DNS pentesting, and automating this process can be very beneficial. Tools like `dnsenum`, `dnsrecon`, and `fierce` can be used to automate DNS enumeration. These tools can help you gather information about DNS servers, subdomains, and other DNS records.

##### Zone Transfer

Automating zone transfer can help you quickly identify misconfigured DNS servers that allow zone transfers. Tools like `dnsrecon` and `axfr` can be used to automate zone transfer testing. These tools attempt to transfer the entire DNS zone from the target server and provide you with the results.

##### Brute-Forcing

Brute-forcing DNS subdomains can be a time-consuming task if done manually. However, automating this process can significantly speed up the enumeration of subdomains. Tools like `dnsenum`, `dnsrecon`, and `sublist3r` can be used to automate DNS brute-forcing.

##### DNS Cache Poisoning

Automating DNS cache poisoning attacks can help you identify vulnerable DNS servers. Tools like `dnsspooq` and `mitm6` can be used to automate DNS cache poisoning attacks. These tools exploit vulnerabilities in DNS implementations to poison the DNS cache and redirect traffic.

##### DNS Tunneling

DNS tunneling can be used to bypass firewalls and exfiltrate data from a target network. Automating DNS tunneling can help you establish covert communication channels. Tools like `iodine` and `dnscat2` can be used to automate DNS tunneling.

##### DNS Rebinding

Automating DNS rebinding attacks can help you bypass network security measures and gain unauthorized access to internal resources. Tools like `singularity` and `rebind` can be used to automate DNS rebinding attacks. These tools exploit vulnerabilities in DNS implementations to establish a two-way communication channel with the target network.

Automating these tasks can greatly enhance your efficiency and effectiveness in DNS pentesting. However, it is important to use these tools responsibly and with proper authorization.
```bash
for sub in $(cat <WORDLIST>);do dig $sub.<DOMAIN> @<DNS_IP> | grep -v ';\|SOA' | sed -r '/^\s*$/d' | grep $sub | tee -a subdomains.txt;done

dnsenum --dnsserver <DNS_IP> --enum -p 0 -s 0 -o subdomains.txt -f <WORDLIST> <DOMAIN>
```
#### Usando nslookup

O comando `nslookup` √© uma ferramenta de linha de comando usada para consultar servidores de nomes de dom√≠nio (DNS) e obter informa√ß√µes sobre registros DNS. Ele pode ser usado para verificar a resolu√ß√£o de nomes de dom√≠nio, encontrar o endere√ßo IP associado a um nome de dom√≠nio e obter informa√ß√µes sobre registros DNS espec√≠ficos, como registros MX, registros de alias (CNAME) e registros de servi√ßo (SRV).

A sintaxe b√°sica do comando `nslookup` √© a seguinte:

```
nslookup <nome_do_dom√≠nio>
```

Isso retornar√° o endere√ßo IP associado ao nome de dom√≠nio especificado. Voc√™ tamb√©m pode usar o comando `nslookup` para consultar servidores de nomes de dom√≠nio espec√≠ficos, especificando o servidor de nomes como um argumento adicional:

```
nslookup <nome_do_dom√≠nio> <servidor_de_nomes>
```

Isso enviar√° a consulta para o servidor de nomes especificado em vez de usar o servidor de nomes padr√£o configurado no sistema.

O comando `nslookup` tamb√©m suporta v√°rias op√ß√µes que podem ser usadas para personalizar a consulta. Alguns exemplos de op√ß√µes comuns incluem:

- `-type=<tipo_de_registro>`: Especifica o tipo de registro DNS a ser consultado, como A, MX, CNAME, etc.
- `-querytype=<tipo_de_registro>`: Uma op√ß√£o alternativa para especificar o tipo de registro DNS a ser consultado.
- `-debug`: Ativa o modo de depura√ß√£o, exibindo informa√ß√µes detalhadas sobre a consulta e a resposta do servidor de nomes.

Para obter uma lista completa de op√ß√µes suportadas pelo comando `nslookup`, consulte a documenta√ß√£o do seu sistema operacional ou execute `nslookup -h` para exibir a ajuda do comando.
```bash
nslookup
> SERVER <IP_DNS> #Select dns server
> 127.0.0.1 #Reverse lookup of 127.0.0.1, maybe...
> <IP_MACHINE> #Reverse lookup of a machine, maybe...
```
### M√≥dulos √∫teis do metasploit

Metasploit √© uma poderosa ferramenta de teste de penetra√ß√£o que oferece uma ampla gama de m√≥dulos para explorar vulnerabilidades em sistemas de rede. Aqui est√£o alguns m√≥dulos √∫teis do Metasploit que podem ser usados durante um teste de penetra√ß√£o em servi√ßos DNS:

- **auxiliary/scanner/dns/dns_cache_snoop**: Este m√≥dulo permite verificar o cache DNS de um servidor para obter informa√ß√µes sobre os registros armazenados em cache. Isso pode ser √∫til para identificar informa√ß√µes sens√≠veis que podem ser exploradas posteriormente.

- **auxiliary/scanner/dns/dns_enum**: Este m√≥dulo realiza uma enumera√ß√£o de DNS para descobrir informa√ß√µes sobre um dom√≠nio, como registros de host, registros MX e registros NS. Isso pode ajudar a identificar poss√≠veis pontos de entrada para ataques.

- **auxiliary/scanner/dns/dns_forward_lookup**: Este m√≥dulo realiza uma pesquisa de DNS para obter informa√ß√µes sobre um dom√≠nio ou um conjunto de dom√≠nios. Ele pode ser usado para verificar a exist√™ncia de registros DNS espec√≠ficos.

- **auxiliary/scanner/dns/dns_reverse_lookup**: Este m√≥dulo realiza uma pesquisa de DNS reversa para obter informa√ß√µes sobre um endere√ßo IP. Isso pode ser √∫til para identificar os dom√≠nios associados a um determinado endere√ßo IP.

- **auxiliary/scanner/dns/dns_srv_enum**: Este m√≥dulo realiza uma enumera√ß√£o de DNS para descobrir informa√ß√µes sobre servi√ßos espec√≠ficos dispon√≠veis em um dom√≠nio. Isso pode ajudar a identificar servi√ßos vulner√°veis que podem ser explorados.

Esses s√£o apenas alguns exemplos de m√≥dulos √∫teis do Metasploit para testes de penetra√ß√£o em servi√ßos DNS. O Metasploit oferece uma ampla gama de m√≥dulos adicionais que podem ser explorados para identificar e explorar vulnerabilidades em sistemas de rede.
```bash
auxiliary/gather/enum_dns #Perform enumeration actions
```
### Scripts nmap √∫teis

Nmap √© uma ferramenta de varredura de rede amplamente utilizada para descobrir hosts e servi√ßos em uma rede. Ele possui uma ampla gama de scripts embutidos que podem ser usados para testar a seguran√ßa de servi√ßos espec√≠ficos. Aqui est√£o alguns scripts nmap √∫teis para testes de penetra√ß√£o em servi√ßos DNS:

- **dns-brute.nse**: Este script realiza uma busca de subdom√≠nios usando uma lista de palavras-chave comuns. Ele pode ajudar a identificar subdom√≠nios n√£o autorizados ou mal configurados.

- **dns-cache-snoop.nse**: Este script verifica se um servidor DNS est√° vulner√°vel a ataques de cache snooping. Ele pode revelar informa√ß√µes confidenciais, como registros DNS armazenados em cache.

- **dns-zone-transfer.nse**: Este script verifica se um servidor DNS permite transfer√™ncias de zona n√£o autorizadas. Isso pode levar √† divulga√ß√£o de informa√ß√µes confidenciais sobre a infraestrutura de DNS.

- **dns-recursion.nse**: Este script verifica se um servidor DNS est√° configurado para permitir consultas recursivas. Isso pode ser explorado para realizar ataques de amplifica√ß√£o de DNS.

- **dns-update.nse**: Este script verifica se um servidor DNS est√° configurado para permitir atualiza√ß√µes din√¢micas. Isso pode ser explorado para realizar ataques de envenenamento de cache DNS.

Esses scripts podem ser executados usando o seguinte comando:

```
nmap -p 53 --script <nome_do_script> <alvo>
```

Substitua `<nome_do_script>` pelo nome do script desejado e `<alvo>` pelo endere√ßo IP ou nome de dom√≠nio do servidor DNS que voc√™ deseja testar.
```bash
#Perform enumeration actions
nmap -n --script "(default and *dns*) or fcrdns or dns-srv-enum or dns-random-txid or dns-random-srcport" <IP>
```
### DNS - Reverse BF

O DNS (Domain Name System) √© um servi√ßo fundamental na infraestrutura da Internet que traduz nomes de dom√≠nio leg√≠veis por humanos em endere√ßos IP. No entanto, o DNS tamb√©m pode ser explorado por hackers para obter informa√ß√µes valiosas sobre uma rede.

Uma t√©cnica comum usada em testes de penetra√ß√£o √© o Reverse BF (Brute Force), que envolve a enumera√ß√£o de registros DNS reversos para descobrir informa√ß√µes sobre os sistemas e servi√ßos em uma rede. Essa t√©cnica √© particularmente √∫til quando se deseja identificar hosts ocultos ou servi√ßos mal configurados.

O Reverse BF come√ßa com a identifica√ß√£o do intervalo de endere√ßos IP da rede-alvo. Em seguida, o testador de penetra√ß√£o usa uma ferramenta automatizada para realizar uma varredura de DNS reverso nesse intervalo de endere√ßos IP. A ferramenta tentar√° resolver cada endere√ßo IP reverso em um nome de dom√≠nio leg√≠vel por humanos.

Ao analisar os resultados da varredura, o testador de penetra√ß√£o pode identificar hosts adicionais que n√£o foram divulgados anteriormente. Essas informa√ß√µes podem ser usadas para planejar ataques direcionados ou explorar vulnerabilidades espec√≠ficas.

√â importante ressaltar que o Reverse BF deve ser realizado apenas em sistemas e redes autorizados, como parte de um teste de penetra√ß√£o √©tico. O uso indevido dessa t√©cnica pode ser considerado ilegal e resultar em consequ√™ncias legais graves.
```bash
dnsrecon -r 127.0.0.0/24 -n <IP_DNS>  #DNS reverse of all of the addresses
dnsrecon -r 127.0.1.0/24 -n <IP_DNS>  #DNS reverse of all of the addresses
dnsrecon -r <IP_DNS>/24 -n <IP_DNS>   #DNS reverse of all of the addresses
dnsrecon -d active.htb -a -n <IP_DNS> #Zone transfer
```
{% hint style="info" %}
Se voc√™ conseguir encontrar subdom√≠nios que resolvem para endere√ßos IP internos, voc√™ deve tentar realizar um reverse dns BF para os NSs do dom√≠nio solicitando essa faixa de IP.
{% endhint %}

Outra ferramenta para fazer isso: [https://github.com/amine7536/reverse-scan](https://github.com/amine7536/reverse-scan)

Voc√™ pode consultar faixas de IP reversas em [https://bgp.he.net/net/205.166.76.0/24#\_dns](https://bgp.he.net/net/205.166.76.0/24#\_dns) (essa ferramenta tamb√©m √© √∫til com BGP).

### DNS - Subdomains BF
```bash
dnsenum --dnsserver <IP_DNS> --enum -p 0 -s 0 -o subdomains.txt -f subdomains-1000.txt <DOMAIN>
dnsrecon -D subdomains-1000.txt -d <DOMAIN> -n <IP_DNS>
dnscan -d <domain> -r -w subdomains-1000.txt #Bruteforce subdomains in recursive way, https://github.com/rbsec/dnscan
```
### Servidores do Active Directory

Active Directory (AD) √© um servi√ßo de diret√≥rio desenvolvido pela Microsoft que armazena informa√ß√µes sobre objetos de rede, como usu√°rios, grupos, computadores e recursos compartilhados. Durante um teste de penetra√ß√£o, √© importante identificar e avaliar os servidores do Active Directory para encontrar poss√≠veis vulnerabilidades e explor√°-las.

Existem v√°rias t√©cnicas que podem ser usadas para pentestar servidores do Active Directory, incluindo:

- Enumera√ß√£o de usu√°rios: Identificar os usu√°rios registrados no dom√≠nio do Active Directory √© um passo importante para entender a estrutura e a seguran√ßa do ambiente. Isso pode ser feito usando ferramentas como o "enum4linux" ou o "ldapsearch".

- Enumera√ß√£o de grupos: Al√©m dos usu√°rios, √© importante identificar os grupos existentes no dom√≠nio do Active Directory. Isso pode fornecer informa√ß√µes sobre as permiss√µes e os privil√©gios concedidos aos usu√°rios. Ferramentas como o "enum4linux" ou o "ldapsearch" tamb√©m podem ser usadas para essa finalidade.

- Enumera√ß√£o de servi√ßos: Identificar os servi√ßos em execu√ß√£o nos servidores do Active Directory √© crucial para entender a superf√≠cie de ataque. Isso pode ser feito usando ferramentas como o "nmap" ou o "enum4linux".

- Enumera√ß√£o de pol√≠ticas de grupo: As pol√≠ticas de grupo s√£o usadas para definir configura√ß√µes de seguran√ßa em um dom√≠nio do Active Directory. Enumerar essas pol√≠ticas pode fornecer informa√ß√µes valiosas sobre as configura√ß√µes de seguran√ßa implementadas. Ferramentas como o "gpresult" ou o "Grouper2" podem ser usadas para essa finalidade.

- Explora√ß√£o de vulnerabilidades conhecidas: Uma vez identificados os servidores do Active Directory e suas configura√ß√µes, √© poss√≠vel explorar vulnerabilidades conhecidas para obter acesso n√£o autorizado ou elevar privil√©gios. Isso pode ser feito usando ferramentas como o "Metasploit" ou o "Empire".

√â importante lembrar que todas as atividades de pentest devem ser realizadas com permiss√£o e dentro dos limites legais.
```bash
dig -t _gc._tcp.lab.domain.com
dig -t _ldap._tcp.lab.domain.com
dig -t _kerberos._tcp.lab.domain.com
dig -t _kpasswd._tcp.lab.domain.com

nslookup -type=srv _kerberos._tcp.<CLIENT_DOMAIN>
nslookup -type=srv _kerberos._tcp.domain.com

nmap --script dns-srv-enum --script-args "dns-srv-enum.domain='domain.com'"
```
### DNSSec

DNSSec (Domain Name System Security Extensions) √© uma extens√£o de seguran√ßa para o protocolo DNS que visa proteger as consultas DNS contra ataques de envenenamento de cache e falsifica√ß√£o de resposta. O DNSSec utiliza criptografia de chave p√∫blica para garantir a autenticidade e integridade dos registros DNS.

O objetivo principal do DNSSec √© evitar ataques como o envenenamento de cache, onde um invasor falsifica uma resposta DNS para redirecionar os usu√°rios para um site malicioso. Com o DNSSec, os registros DNS s√£o assinados digitalmente pelo servidor autoritativo, permitindo que os clientes verifiquem a autenticidade dos registros recebidos.

Para implementar o DNSSec, √© necess√°rio configurar chaves de assinatura (KSKs) e chaves de zona (ZSKs) no servidor DNS. As KSKs s√£o usadas para assinar as chaves de zona, enquanto as ZSKs s√£o usadas para assinar os registros DNS. Essas chaves s√£o armazenadas em arquivos de chave e devem ser protegidas adequadamente para evitar o comprometimento da seguran√ßa.

Ao realizar um teste de penetra√ß√£o em um servidor DNS, √© importante verificar se o DNSSec est√° implementado corretamente. Isso pode ser feito verificando se os registros DNS est√£o assinados digitalmente e se as chaves de assinatura est√£o configuradas corretamente. Al√©m disso, √© importante verificar se o servidor DNS est√° configurado para validar as respostas DNS recebidas de outros servidores.

Embora o DNSSec forne√ßa uma camada adicional de seguran√ßa para o DNS, √© importante observar que nem todos os dom√≠nios implementam o DNSSec. Portanto, √© poss√≠vel encontrar dom√≠nios que n√£o possuem registros DNS assinados digitalmente.
```bash
#Query paypal subdomains to ns3.isc-sns.info
nmap -sSU -p53 --script dns-nsec-enum --script-args dns-nsec-enum.domains=paypal.com ns3.isc-sns.info
```
### IPv6

For√ßa bruta usando solicita√ß√µes "AAAA" para obter os endere√ßos IPv6 dos subdom√≠nios.
```bash
dnsdict6 -s -t <domain>
```
# Pentesting DNS

## Pentesting DNS Reverso

O DNS reverso √© um processo que envolve a resolu√ß√£o de endere√ßos IP em nomes de dom√≠nio. No entanto, em vez de resolver um endere√ßo IP em um nome de dom√≠nio, o DNS reverso resolve um nome de dom√≠nio em um endere√ßo IP. Isso √© √∫til para identificar o propriet√°rio de um determinado endere√ßo IP.

### T√©cnica de Bruteforce no DNS Reverso usando endere√ßos IPv6

O DNS reverso √© amplamente utilizado para fins de seguran√ßa, pois pode ajudar a identificar atividades maliciosas na rede. Uma t√©cnica comum usada durante a pentest √© o bruteforce no DNS reverso usando endere√ßos IPv6.

O bruteforce no DNS reverso usando endere√ßos IPv6 envolve a tentativa de resolver nomes de dom√≠nio para cada endere√ßo IPv6 poss√≠vel em uma determinada faixa. Isso pode ser √∫til para identificar hosts ativos, descobrir servi√ßos em execu√ß√£o em um determinado host e at√© mesmo encontrar informa√ß√µes sens√≠veis, como nomes de dom√≠nio internos.

Para realizar essa t√©cnica, voc√™ pode usar ferramentas como o `dnsrecon` ou o `dnsenum`. Essas ferramentas permitem que voc√™ especifique uma faixa de endere√ßos IPv6 e, em seguida, realizem uma consulta DNS reversa para cada endere√ßo na faixa especificada.

√â importante lembrar que essa t√©cnica pode ser demorada, pois envolve a resolu√ß√£o de um grande n√∫mero de endere√ßos IPv6. Al√©m disso, √© essencial obter permiss√£o adequada antes de realizar qualquer teste de penetra√ß√£o em um sistema ou rede.
```bash
dnsrevenum6 pri.authdns.ripe.net 2001:67c:2e8::/48 #Will use the dns pri.authdns.ripe.net
```
### DNS Recursion DDoS

Se **a recurs√£o DNS estiver habilitada**, um atacante pode **falsificar** a **origem** no pacote UDP para fazer com que o **DNS envie a resposta para o servidor da v√≠tima**. Um atacante pode abusar dos tipos de registro **ANY** ou **DNSSEC**, pois eles costumam ter respostas maiores.\
A maneira de **verificar** se um DNS suporta **recurs√£o** √© consultar um nome de dom√≠nio e **verificar** se a **flag "ra"** (_recursion available_) est√° na resposta:
```bash
dig google.com A @<IP>
```
**N√£o dispon√≠vel**:

![](<../.gitbook/assets/image (275).png>)

**Dispon√≠vel**:

![](<../.gitbook/assets/image (276).png>)

<figure><img src="../.gitbook/assets/image (1) (1) (2) (4).png" alt=""><figcaption></figcaption></figure>

[**A Confer√™ncia de Seguran√ßa DragonJAR √© um evento internacional de ciberseguran√ßa**](https://www.dragonjarcon.org/) com mais de uma d√©cada que ser√° realizada nos dias 7 e 8 de setembro de 2023 em Bogot√°, Col√¥mbia. √â um evento de alto conte√∫do t√©cnico onde s√£o apresentadas as √∫ltimas pesquisas em espanhol que atraem hackers e pesquisadores de todo o mundo.\
Registre-se agora no seguinte link e n√£o perca esta grande confer√™ncia!:

{% embed url="https://www.dragonjarcon.org/" %}

### Envio de e-mail para uma conta inexistente

Do livro: Avalia√ß√£o de Seguran√ßa de Rede (3¬™ edi√ß√£o)

Simplesmente enviar uma mensagem de e-mail para um endere√ßo inexistente em um dom√≠nio-alvo muitas vezes revela informa√ß√µes √∫teis sobre a rede interna por meio de uma _notifica√ß√£o de n√£o entrega_ (NDN).
```
Generating server: noa.nintendo.com

blah@nintendo.com
#550 5.1.1 RESOLVER.ADR.RecipNotFound; not found ##

Original message headers:

Received: from ONERDEDGE02.one.nintendo.com (10.13.20.35) by
onerdexch08.one.nintendo.com (10.13.30.39) with Microsoft SMTP Server (TLS)
id 14.3.174.1; Sat, 26 Apr 2014 16:52:22 -0700
Received: from barracuda.noa.nintendo.com (205.166.76.35) by
ONERDEDGE02.one.nintendo.com (10.13.20.35) with Microsoft SMTP Server (TLS)
id 14.3.174.1; Sat, 26 Apr 2014 16:51:22 -0700
X-ASG-Debug-ID: 1398556333-0614671716199b0d0001-zOQ9WJ
Received: from gateway05.websitewelcome.com (gateway05.websitewelcome.com  [69.93.154.37]) by
barracuda.noa.nintendo.com with ESMTP id xVNPkwaqGgdyH5Ag for <blah@nintendo.com>; Sat,
26 Apr 2014 16:52:13 -0700 (PDT)
X-Barracuda-Envelope-From: chris@example.org
X-Barracuda-Apparent-Source-IP: 69.93.154.37
```
Os seguintes dados neste transcript s√£o √∫teis:

* Nomes de host internos, endere√ßos IP e layout de subdom√≠nio
* O servidor de e-mail est√° executando o Microsoft Exchange Server 2010 SP3
* Um dispositivo da Barracuda Networks √© usado para realizar filtragem de conte√∫do

## Arquivos de configura√ß√£o
```
host.conf
/etc/resolv.conf
/etc/bind/named.conf
/etc/bind/named.conf.local
/etc/bind/named.conf.options
/etc/bind/named.conf.log
/etc/bind/*
```
Configura√ß√µes perigosas ao configurar um servidor Bind:

| **Op√ß√£o**          | **Descri√ß√£o**                                                                 |
| ----------------- | ------------------------------------------------------------------------------ |
| `allow-query`     | Define quais hosts t√™m permiss√£o para enviar solicita√ß√µes ao servidor DNS.     |
| `allow-recursion` | Define quais hosts t√™m permiss√£o para enviar solicita√ß√µes recursivas ao servidor DNS. |
| `allow-transfer`  | Define quais hosts t√™m permiss√£o para receber transfer√™ncias de zona do servidor DNS. |
| `zone-statistics` | Coleta dados estat√≠sticos das zonas.                                           |

## Comandos Autom√°ticos HackTricks
```
Protocol_Name: DNS    #Protocol Abbreviation if there is one.
Port_Number:  53     #Comma separated if there is more than one.
Protocol_Description: Domain Name Service        #Protocol Abbreviation Spelled out

Entry_1:
Name: Notes
Description: Notes for DNS
Note: |
#These are the commands I run every time I see an open DNS port

dnsrecon -r 127.0.0.0/24 -n {IP} -d {Domain_Name}
dnsrecon -r 127.0.1.0/24 -n {IP} -d {Domain_Name}
dnsrecon -r {Network}{CIDR} -n {IP} -d {Domain_Name}
dig axfr @{IP}
dig axfr {Domain_Name} @{IP}
nslookup
SERVER {IP}
127.0.0.1
{IP}
Domain_Name
exit

https://book.hacktricks.xyz/pentesting/pentesting-dns

Entry_2:
Name: Banner Grab
Description: Grab DNS Banner
Command: dig version.bind CHAOS TXT @DNS

Entry_3:
Name: Nmap Vuln Scan
Description: Scan for Vulnerabilities with Nmap
Command: nmap -n --script "(default and *dns*) or fcrdns or dns-srv-enum or dns-random-txid or dns-random-srcport" {IP}

Entry_4:
Name: Zone Transfer
Description: Three attempts at forcing a zone transfer
Command: dig axfr @{IP} && dix axfr @{IP} {Domain_Name} && fierce --dns-servers {IP} --domain {Domain_Name}


Entry_5:
Name: Active Directory
Description: Eunuerate a DC via DNS
Command: dig -t _gc._{Domain_Name} && dig -t _ldap._{Domain_Name} && dig -t _kerberos._{Domain_Name} && dig -t _kpasswd._{Domain_Name} && nmap --script dns-srv-enum --script-args "dns-srv-enum.domain={Domain_Name}"

Entry_6:
Name: consolesless mfs enumeration
Description: DNS enumeration without the need to run msfconsole
Note: sourced from https://github.com/carlospolop/legion
Command: msfconsole -q -x 'use auxiliary/scanner/dns/dns_amp; set RHOSTS {IP}; set RPORT 53; run; exit' && msfconsole -q -x 'use auxiliary/gather/enum_dns; set RHOSTS {IP}; set RPORT 53; run; exit'
```
<figure><img src="../.gitbook/assets/image (1) (1) (2) (4).png" alt=""><figcaption></figcaption></figure>

[**A Confer√™ncia de Seguran√ßa DragonJAR √© um evento internacional de ciberseguran√ßa**](https://www.dragonjarcon.org/) com mais de uma d√©cada que ser√° realizada nos dias 7 e 8 de setembro de 2023 em Bogot√°, Col√¥mbia. √â um evento de alto conte√∫do t√©cnico onde s√£o apresentadas as √∫ltimas pesquisas em espanhol que atraem hackers e pesquisadores de todo o mundo.\
Registre-se agora no seguinte link e n√£o perca esta grande confer√™ncia!:

{% embed url="https://www.dragonjarcon.org/" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Voc√™ trabalha em uma **empresa de ciberseguran√ßa**? Voc√™ quer ver sua **empresa anunciada no HackTricks**? ou voc√™ quer ter acesso √† **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**? Verifique os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* **Junte-se ao** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para o** [**reposit√≥rio hacktricks**](https://github.com/carlospolop/hacktricks) **e** [**reposit√≥rio hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
