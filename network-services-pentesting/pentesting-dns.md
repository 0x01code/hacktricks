# 53 - Ελεγχος Εισβολής DNS

<details>

<summary><strong>Μάθετε το χάκινγκ στο AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Ειδικός Red Team AWS του HackTricks)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι υποστήριξης του HackTricks:

* Αν θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**την Οικογένεια PEASS**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε στη** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στη [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε τα χάκινγκ κόλπα σας υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>

<figure><img src="../.gitbook/assets/image (2) (1).png" alt=""><figcaption></figcaption></figure>

**Άμεση διαθεσιμότητα εγκατάστασης για αξιολόγηση ευπαθειών & ελεγχο εισβολής**. Εκτελέστε έναν πλήρη έλεγχο εισβολής από οπουδήποτε με 20+ εργαλεία & χαρακτηριστικά που καλύπτουν από την αναγνώριση μέχρι την αναφορά. Δεν αντικαθιστούμε τους εισβολείς - αναπτύσσουμε προσαρμοσμένα εργαλεία, ανίχνευση & εκμετάλλευση modules για να τους δώσουμε πίσω χρόνο να εξερευνήσουν βαθύτερα, να ανοίξουν κελιά και να διασκεδάσουν.

{% embed url="https://pentest-tools.com/" %}

## **Βασικές Πληροφορίες**

Το **Σύστημα Ονομάτων Domain (DNS)** λειτουργεί ως ο κατάλογος του διαδικτύου, επιτρέποντας στους χρήστες να έχουν πρόσβαση σε ιστοσελίδες μέσω **εύκολων στην ανάκληση ονομάτων τομέων** όπως το google.com ή το facebook.com, αντί για τις αριθμητικές διευθύνσεις Internet Protocol (IP). Μεταφράζοντας τα ονόματα τομέων σε διευθύνσεις IP, το DNS εξασφαλίζει ότι οι περιηγητές ιστού μπορούν να φορτώνουν γρήγορα πόρους του διαδικτύου, απλοποιώντας τον τρόπο που πλοηγούμαστε στον online κόσμο.

**Προεπιλεγμένη θύρα:** 53
```
PORT     STATE SERVICE  REASON
53/tcp   open  domain  Microsoft DNS 6.1.7601 (1DB15D39) (Windows Server 2008 R2 SP1)
5353/udp open  zeroconf udp-response
53/udp   open  domain  Microsoft DNS 6.1.7601 (1DB15D39) (Windows Server 2008 R2 SP1)
```
### Διαφορετικοί Διακομιστές DNS

* **Διακομιστές Ρίζας DNS**: Αυτοί βρίσκονται στην κορυφή της ιεραρχίας DNS, διαχειρίζοντας τους κορυφαίους τομείς και επεμβαίνοντας μόνο εάν οι διακομιστές σε χαμηλότερο επίπεδο δεν ανταποκρίνονται. Το Internet Corporation for Assigned Names and Numbers (**ICANN**) εποπτεύει τη λειτουργία τους, με παγκόσμιο αριθμό 13.
* **Διακομιστές Αρμόδιοι για τα Ονόματα**: Αυτοί οι διακομιστές έχουν τον τελικό λόγο για τα ερωτήματα στις καθορισμένες ζώνες τους, προσφέροντας οριστικές απαντήσεις. Εάν δεν μπορούν να παρέχουν απάντηση, το ερώτημα ανακατεύεται στους διακομιστές ρίζας.
* **Μη-Αρμόδιοι Διακομιστές Ονομάτων**: Απουσιάζοντας απόλυτης κυριότητας στις ζώνες DNS, αυτοί οι διακομιστές συγκεντρώνουν πληροφορίες τομέα μέσω ερωτημάτων σε άλλους διακομιστές.
* **Διακομιστής DNS Προσωρινής Αποθήκευσης**: Αυτός ο τύπος διακομιστή αποθηκεύει στη μνήμη του προηγούμενες απαντήσεις ερωτημάτων για ένα συγκεκριμένο χρονικό διάστημα για ταχύτερους χρόνους απόκρισης σε μελλοντικά αιτήματα, με τη διάρκεια της μνήμης cache να καθορίζεται από τον αρμόδιο διακομιστή.
* **Διακομιστής Προώθησης**: Εξυπηρετώντας έναν απλό ρόλο, οι διακομιστές προώθησης απλώς μεταφέρουν ερωτήματα σε άλλο διακομιστή.
* **Επίλυσης**: Ενσωματωμένοι σε υπολογιστές ή δρομολογητές, οι επιλύτες εκτελούν την ανάλυση ονομάτων τοπικά και δεν θεωρούνται αρμόδιοι.

## Απαρίθμηση

### **Ανάκτηση Μπάνερ**

Δεν υπάρχουν μπάνερ στο DNS αλλά μπορείτε να ανακτήσετε το μαγικό ερώτημα για `version.bind. CHAOS TXT` το οποίο θα λειτουργήσει στους περισσότερους διακομιστές ονομάτων BIND.\
Μπορείτε να εκτελέσετε αυτό το ερώτημα χρησιμοποιώντας το `dig`:
```bash
dig version.bind CHAOS TXT @DNS
```
Επιπλέον, το εργαλείο [`fpdns`](https://github.com/kirei/fpdns) μπορεί επίσης να εντοπίσει τον διακομιστή.

Είναι επίσης δυνατό να ανακτηθεί το banner και με ένα **nmap** script:
```
--script dns-nsid
```
### **Οποιαδήποτε εγγραφή**

Η εγγραφή **ANY** θα ζητήσει από τον διακομιστή DNS να **επιστρέψει** όλες τις διαθέσιμες **καταχωρήσεις** που **είναι διατεθειμένος να αποκαλύψει**.
```bash
dig any victim.com @<DNS_IP>
```
### **Μεταφορά Ζώνης**

Αυτή η διαδικασία συντομεύεται ως `Ασύγχρονη Πλήρης Μεταφορά Ζώνης` (`AXFR`).
```bash
dig axfr @<DNS_IP> #Try zone transfer without domain
dig axfr @<DNS_IP> <DOMAIN> #Try zone transfer guessing the domain
fierce --domain <DOMAIN> --dns-servers <DNS_IP> #Will try toperform a zone transfer against every authoritative name server and if this doesn'twork, will launch a dictionary attack
```
### Περισσότερες πληροφορίες
```bash
dig ANY @<DNS_IP> <DOMAIN>     #Any information
dig A @<DNS_IP> <DOMAIN>       #Regular DNS request
dig AAAA @<DNS_IP> <DOMAIN>    #IPv6 DNS request
dig TXT @<DNS_IP> <DOMAIN>     #Information
dig MX @<DNS_IP> <DOMAIN>      #Emails related
dig NS @<DNS_IP> <DOMAIN>      #DNS that resolves that name
dig -x 192.168.0.2 @<DNS_IP>   #Reverse lookup
dig -x 2a00:1450:400c:c06::93 @<DNS_IP> #reverse IPv6 lookup

#Use [-p PORT]  or  -6 (to use ivp6 address of dns)
```
#### Αυτοματοποίηση
```bash
for sub in $(cat <WORDLIST>);do dig $sub.<DOMAIN> @<DNS_IP> | grep -v ';\|SOA' | sed -r '/^\s*$/d' | grep $sub | tee -a subdomains.txt;done

dnsenum --dnsserver <DNS_IP> --enum -p 0 -s 0 -o subdomains.txt -f <WORDLIST> <DOMAIN>
```
#### Χρησιμοποιώντας το nslookup
```bash
nslookup
> SERVER <IP_DNS> #Select dns server
> 127.0.0.1 #Reverse lookup of 127.0.0.1, maybe...
> <IP_MACHINE> #Reverse lookup of a machine, maybe...
```
### Χρήσιμα modules του metasploit
```bash
auxiliary/gather/enum_dns #Perform enumeration actions
```
### Χρήσιμα scripts του nmap
```bash
#Perform enumeration actions
nmap -n --script "(default and *dns*) or fcrdns or dns-srv-enum or dns-random-txid or dns-random-srcport" <IP>
```
### DNS - Αντίστροφη επίθεση με βροχή κωδικών
```bash
dnsrecon -r 127.0.0.0/24 -n <IP_DNS>  #DNS reverse of all of the addresses
dnsrecon -r 127.0.1.0/24 -n <IP_DNS>  #DNS reverse of all of the addresses
dnsrecon -r <IP_DNS>/24 -n <IP_DNS>   #DNS reverse of all of the addresses
dnsrecon -d active.htb -a -n <IP_DNS> #Zone transfer
```
{% hint style="info" %}
Εάν είστε σε θέση να βρείτε υποτομείς που αναφέρονται σε εσωτερικές διευθύνσεις IP, πρέπει να προσπαθήσετε να εκτελέσετε έναν αντίστροφο DNS BF στους NSs του τομέα ζητώντας αυτό το εύρος IP.
{% endhint %}

Ένα άλλο εργαλείο για να το κάνετε αυτό: [https://github.com/amine7536/reverse-scan](https://github.com/amine7536/reverse-scan)

Μπορείτε να ερωτήσετε αντίστροφα εύρη IP στο [https://bgp.he.net/net/205.166.76.0/24#\_dns](https://bgp.he.net/net/205.166.76.0/24#\_dns) (αυτό το εργαλείο είναι επίσης χρήσιμο με το BGP).

### DNS - Subdomains BF
```bash
dnsenum --dnsserver <IP_DNS> --enum -p 0 -s 0 -o subdomains.txt -f subdomains-1000.txt <DOMAIN>
dnsrecon -D subdomains-1000.txt -d <DOMAIN> -n <IP_DNS>
dnscan -d <domain> -r -w subdomains-1000.txt #Bruteforce subdomains in recursive way, https://github.com/rbsec/dnscan
```
### Διακομιστές Active Directory
```bash
dig -t _gc._tcp.lab.domain.com
dig -t _ldap._tcp.lab.domain.com
dig -t _kerberos._tcp.lab.domain.com
dig -t _kpasswd._tcp.lab.domain.com

nslookup -type=srv _kerberos._tcp.<CLIENT_DOMAIN>
nslookup -type=srv _kerberos._tcp.domain.com

nmap --script dns-srv-enum --script-args "dns-srv-enum.domain='domain.com'"
```
### DNSSec

Το Domain Name System Security Extensions (DNSSec) παρέχει αυθεντικοποίηση και εμπιστοσύνη στις απαντήσεις DNS με τη χρήση κρυπτογραφίας.
```bash
#Query paypal subdomains to ns3.isc-sns.info
nmap -sSU -p53 --script dns-nsec-enum --script-args dns-nsec-enum.domains=paypal.com ns3.isc-sns.info
```
### IPv6

Χρήση βίας με αιτήσεις "AAAA" για τη συλλογή των διευθύνσεων IPv6 των υποτομέων.
```bash
dnsdict6 -s -t <domain>
```
Χρησιμοποιώντας διευθύνσεις IPv6, εκτελέστε αναδιατύπωση DNS με βία.
```bash
dnsrevenum6 pri.authdns.ripe.net 2001:67c:2e8::/48 #Will use the dns pri.authdns.ripe.net
```
### DNS Recursion DDoS

Εάν η **αναδρομή DNS είναι ενεργοποιημένη**, ένας επιτιθέμενος θα μπορούσε να **πλασαρίσει** την **προέλευση** στο πακέτο UDP προκειμένου να κάνει το **DNS να στείλει την απάντηση στον διακομιστή θύμα**. Ένας επιτιθέμενος θα μπορούσε να καταχραστεί τους τύπους εγγραφών **ANY** ή **DNSSEC** καθώς συνήθως έχουν μεγαλύτερες απαντήσεις.\
Ο τρόπος να **ελέγξετε** αν ένα DNS υποστηρίζει τη **αναδρομή** είναι να ερωτήσετε ένα όνομα τομέα και να **ελέγξετε** αν η **σημαία "ra"** (_recursion available_) υπάρχει στην απάντηση:
```bash
dig google.com A @<IP>
```
**Μη διαθέσιμο**:

![](<../.gitbook/assets/image (275).png>)

**Διαθέσιμο**:

![](<../.gitbook/assets/image (276).png>)

<figure><img src="../.gitbook/assets/image (2) (1).png" alt=""><figcaption></figcaption></figure>

**Άμεση εγκατάσταση για αξιολόγηση ευπαθειών & δοκιμές διείσδυσης**. Εκτελέστε μια πλήρη δοκιμή διείσδυσης από οπουδήποτε με 20+ εργαλεία & χαρακτηριστικά που καλύπτουν από την αναγνώριση μέχρι την αναφορά. Δεν αντικαθιστούμε τους δοκιμαστές διείσδυσης - αναπτύσσουμε προσαρμοσμένα εργαλεία, ανίχνευση & εκμετάλλευση modules για να τους δώσουμε πίσω χρόνο να εξερευνήσουν βαθύτερα, να ανοίξουν κελύφη, και να διασκεδάσουν.

{% embed url="https://pentest-tools.com/" %}

### Αποστολή email σε μη υπάρχον λογαριασμό

Μέσω της εξέτασης μιας ειδοποίησης μη παράδοσης (NDN) που προκαλείται από ένα email που στάλθηκε σε μια μη έγκυρη διεύθυνση εντός ενός στόχου τομέα, συχνά αποκαλύπτονται πολύτιμες λεπτομέρειες του εσωτερικού δικτύου.

Η παρεχόμενη αναφορά μη παράδοσης περιλαμβάνει πληροφορίες όπως:

* Ο δημιουργός διακομιστής αναγνωρίστηκε ως `server.example.com`.
* Ένα μήνυμα αποτυχίας για το `user@example.com` με τον κωδικό σφάλματος `#550 5.1.1 RESOLVER.ADR.RecipNotFound; not found` επεστράφη.
* Εσωτερικές διευθύνσεις IP και ονόματα κεντρικών υπολογιστών αποκαλύφθηκαν στις αρχικές κεφαλίδες του μηνύματος.
```markdown
The original message headers were modified for anonymity and now present randomized data:

Generating server: server.example.com

user@example.com
#550 5.1.1 RESOLVER.ADR.RecipNotFound; not found ##

Original message headers:

Received: from MAILSERVER01.domain.example.com (192.168.1.1) by
mailserver02.domain.example.com (192.168.2.2) with Microsoft SMTP Server (TLS)
id 14.3.174.1; Mon, 25 May 2015 14:52:22 -0700
Received: from filter.example.com (203.0.113.1) by
MAILSERVER01.domain.example.com (192.168.1.1) with Microsoft SMTP Server (TLS)
id 14.3.174.1; Mon, 25 May 2015 14:51:22 -0700
X-ASG-Debug-ID: 1432576343-0614671716190e0d0001-zOQ9WJ
Received: from gateway.domainhost.com (gateway.domainhost.com [198.51.100.37]) by
filter.example.com with ESMTP id xVNPkwaqGgdyH5Ag for user@example.com; Mon,
25 May 2015 14:52:13 -0700 (PDT)
X-Envelope-From: sender@anotherdomain.org
X-Apparent-Source-IP: 198.51.100.37
```
## Αρχεία ρυθμίσεων
```
host.conf
/etc/resolv.conf
/etc/bind/named.conf
/etc/bind/named.conf.local
/etc/bind/named.conf.options
/etc/bind/named.conf.log
/etc/bind/*
```
Επικίνδυνες ρυθμίσεις κατά την παραμετροποίηση ενός διακομιστή Bind:

| **Επιλογή**        | **Περιγραφή**                                                                |
| ----------------- | ------------------------------------------------------------------------------ |
| `allow-query`     | Ορίζει ποιοι υπολογιστές επιτρέπεται να στέλνουν αιτήσεις στον διακομιστή DNS.            |
| `allow-recursion` | Ορίζει ποιοι υπολογιστές επιτρέπεται να στέλνουν αναδρομικές αιτήσεις στον διακομιστή DNS.  |
| `allow-transfer`  | Ορίζει ποιοι υπολογιστές επιτρέπεται να λαμβάνουν μεταφορές ζώνης από τον διακομιστή DNS. |
| `zone-statistics` | Συλλέγει στατιστικά δεδομένα ζωνών.                                            |

## Αναφορές

* [https://www.myrasecurity.com/en/knowledge-hub/dns/](https://www.myrasecurity.com/en/knowledge-hub/dns/)
* Βιβλίο: **Network Security Assessment 3η έκδοση**

## Αυτόματες Εντολές HackTricks
```
Protocol_Name: DNS    #Protocol Abbreviation if there is one.
Port_Number:  53     #Comma separated if there is more than one.
Protocol_Description: Domain Name Service        #Protocol Abbreviation Spelled out

Entry_1:
Name: Notes
Description: Notes for DNS
Note: |
#These are the commands I run every time I see an open DNS port

dnsrecon -r 127.0.0.0/24 -n {IP} -d {Domain_Name}
dnsrecon -r 127.0.1.0/24 -n {IP} -d {Domain_Name}
dnsrecon -r {Network}{CIDR} -n {IP} -d {Domain_Name}
dig axfr @{IP}
dig axfr {Domain_Name} @{IP}
nslookup
SERVER {IP}
127.0.0.1
{IP}
Domain_Name
exit

https://book.hacktricks.xyz/pentesting/pentesting-dns

Entry_2:
Name: Banner Grab
Description: Grab DNS Banner
Command: dig version.bind CHAOS TXT @DNS

Entry_3:
Name: Nmap Vuln Scan
Description: Scan for Vulnerabilities with Nmap
Command: nmap -n --script "(default and *dns*) or fcrdns or dns-srv-enum or dns-random-txid or dns-random-srcport" {IP}

Entry_4:
Name: Zone Transfer
Description: Three attempts at forcing a zone transfer
Command: dig axfr @{IP} && dix axfr @{IP} {Domain_Name} && fierce --dns-servers {IP} --domain {Domain_Name}


Entry_5:
Name: Active Directory
Description: Eunuerate a DC via DNS
Command: dig -t _gc._{Domain_Name} && dig -t _ldap._{Domain_Name} && dig -t _kerberos._{Domain_Name} && dig -t _kpasswd._{Domain_Name} && nmap --script dns-srv-enum --script-args "dns-srv-enum.domain={Domain_Name}"

Entry_6:
Name: consolesless mfs enumeration
Description: DNS enumeration without the need to run msfconsole
Note: sourced from https://github.com/carlospolop/legion
Command: msfconsole -q -x 'use auxiliary/scanner/dns/dns_amp; set RHOSTS {IP}; set RPORT 53; run; exit' && msfconsole -q -x 'use auxiliary/gather/enum_dns; set RHOSTS {IP}; set RPORT 53; run; exit'
```
<figure><img src="../.gitbook/assets/image (2) (1).png" alt=""><figcaption></figcaption></figure>

**Άμεση διαθεσιμότητα εγκατάστασης για αξιολόγηση ευπαθειών & δοκιμές διείσδυσης**. Εκτελέστε μια πλήρη δοκιμή διείσδυσης από οπουδήποτε με 20+ εργαλεία & χαρακτηριστικά που καλύπτουν από την αναγνώριση μέχρι την αναφορά. Δεν αντικαθιστούμε τους δοκιμαστές διείσδυσης - αναπτύσσουμε προσαρμοσμένα εργαλεία, ανίχνευση & εκμετάλλευση modules για να τους δώσουμε πίσω χρόνο να εξερευνήσουν βαθύτερα, να ανοίξουν κελιά και να διασκεδάσουν.

{% embed url="https://pentest-tools.com/" %}

<details>

<summary><strong>Μάθετε το χάκινγκ στο AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι υποστήριξης του HackTricks:

* Αν θέλετε να δείτε την **εταιρεία σας διαφημισμένη στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**Την Οικογένεια PEASS**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε στη** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στη [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε τα χάκινγκ κόλπα σας υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>
