# 53 - Pentesting DNS

<details>

<summary><strong>Jifunze kuhusu kudukua AWS kutoka sifuri hadi shujaa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Mtaalam wa Timu Nyekundu ya AWS ya HackTricks)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako inatangazwa kwenye HackTricks** au **kupakua HackTricks kwa muundo wa PDF** Angalia [**MPANGO WA KUJIUNGA**](https://github.com/sponsors/carlospolop)!
* Pata [**swag rasmi ya PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**Familia ya PEASS**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa [**NFTs**](https://opensea.io/collection/the-peass-family) ya kipekee
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au [**kikundi cha telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Shiriki mbinu zako za kudukua kwa kuwasilisha PR kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos za github.

</details>

<figure><img src="/.gitbook/assets/image (2).png" alt=""><figcaption></figcaption></figure>

**Usanidi uliopo mara moja kwa tathmini ya udhaifu na kudukua**. Tekeleza pentest kamili kutoka mahali popote na zana na huduma 20+ ambazo zinaanza kutoka kwa uchunguzi hadi ripoti. Hatuchukui nafasi ya wadukuzi - tunatengeneza zana za desturi, moduli za ugunduzi na uvamizi ili kuwapa muda wa kuchimba kwa kina, kudukua mifumo, na kufurahi.

{% embed url="https://pentest-tools.com/" %}

## **Maelezo Muhimu**

**Domain Name System (DNS)** inatumika kama daftari la mtandao, kuruhusu watumiaji kupata tovuti kupitia **majina ya kikoa rahisi kukumbuka** kama google.com au facebook.com, badala ya anwani za Itifaki ya Mtandao (IP) za nambari. Kwa kutafsiri majina ya kikoa kuwa anwani za IP, DNS inahakikisha kuwa vivinjari vya wavuti vinaweza kupakia rasilimali za mtandao haraka, kuwezesha jinsi tunavyonaviga ulimwengu wa mtandao.

**Bandari ya chaguo-msingi:** 53
```
PORT     STATE SERVICE  REASON
53/tcp   open  domain  Microsoft DNS 6.1.7601 (1DB15D39) (Windows Server 2008 R2 SP1)
5353/udp open  zeroconf udp-response
53/udp   open  domain  Microsoft DNS 6.1.7601 (1DB15D39) (Windows Server 2008 R2 SP1)
```
### Seva za DNS Tofauti

- **Seva za Mzizi wa DNS**: Hizi ziko juu kabisa katika muundo wa DNS, zikisimamia kikoa cha kiwango cha juu na kuingilia kati tu ikiwa seva za ngazi ya chini hazijibu. Shirika la Usajili wa Majina na Nambari za Mtandao (**ICANN**) linasimamia uendeshaji wao, na kuna jumla ya seva 13 za kimataifa.

- **Seva za Mamlaka**: Seva hizi ndizo zinazotoa maamuzi ya mwisho kwa maswali katika maeneo yao yaliyotengwa, zikitoa majibu sahihi. Ikiwa hawawezi kutoa jibu, swali linapelekwa kwa seva za mzizi.

- **Seva zisizo za Mamlaka**: Zisizo na umiliki wa maeneo ya DNS, seva hizi hukusanya habari za kikoa kupitia maswali kwa seva nyingine.

- **Seva ya Kuhifadhi Cache ya DNS**: Aina hii ya seva inakumbuka majibu ya maswali ya awali kwa muda uliowekwa ili kuharakisha majibu ya maombi ya baadaye, na muda wa kuhifadhi cache unadhibitiwa na seva ya mamlaka.

- **Seva ya Kuhamisha**: Kwa jukumu rahisi, seva za kuhamisha tu zinarudisha maswali kwa seva nyingine.

- **Mtekelezaji**: Imeunganishwa ndani ya kompyuta au ruta, watekelezaji hutekeleza ufafanuzi wa majina kwa ndani na hawachukuliwi kuwa wenye mamlaka.


## Uchambuzi

### **Kukamata Bango**

Hakuna bango katika DNS lakini unaweza kukamata swali la kichawi kwa `version.bind. CHAOS TXT` ambalo litafanya kazi kwenye seva nyingi za BIND.\
Unaweza kufanya swali hili kwa kutumia `dig`:
```bash
dig version.bind CHAOS TXT @DNS
```
Zaidi ya hayo, zana [`fpdns`](https://github.com/kirei/fpdns) inaweza pia kugundua alama ya seva.

Pia ni rahisi kupata bango pia na script ya **nmap**:
```
--script dns-nsid
```
### **Rekodi yoyote**

Rekodi ya **ANY** itaomba kwa seva ya DNS **kurudisha** kila **ingizo** inayopatikana ambayo **inakubali kufichua**.
```bash
dig any victim.com @<DNS_IP>
```
### **Uhamisho wa Eneo**

Utaratibu huu unaitwa `Uhamisho wa Eneo Kamili Usio na Synchrony` (`AXFR`).
```bash
dig axfr @<DNS_IP> #Try zone transfer without domain
dig axfr @<DNS_IP> <DOMAIN> #Try zone transfer guessing the domain
fierce --domain <DOMAIN> --dns-servers <DNS_IP> #Will try toperform a zone transfer against every authoritative name server and if this doesn'twork, will launch a dictionary attack
```
### Maelezo zaidi
```bash
dig ANY @<DNS_IP> <DOMAIN>     #Any information
dig A @<DNS_IP> <DOMAIN>       #Regular DNS request
dig AAAA @<DNS_IP> <DOMAIN>    #IPv6 DNS request
dig TXT @<DNS_IP> <DOMAIN>     #Information
dig MX @<DNS_IP> <DOMAIN>      #Emails related
dig NS @<DNS_IP> <DOMAIN>      #DNS that resolves that name
dig -x 192.168.0.2 @<DNS_IP>   #Reverse lookup
dig -x 2a00:1450:400c:c06::93 @<DNS_IP> #reverse IPv6 lookup

#Use [-p PORT]  or  -6 (to use ivp6 address of dns)
```
#### Uthibitishaji wa Kiotomatiki

Kiotomatiki ni mchakato wa kufanya shughuli za kawaida za kiotomatiki bila kuingilia kati kwa binadamu. Katika muktadha wa uthibitishaji wa kiotomatiki, hii inamaanisha kutumia zana na skrini za kiotomatiki kufanya majaribio ya uthibitishaji bila kuingilia kati kwa mwongozo wa binadamu.

Kuna zana nyingi za kiotomatiki zinazopatikana ambazo zinaweza kutumika kwa uthibitishaji wa kiotomatiki. Hizi zinajumuisha zana kama vile Selenium, Puppeteer, na Burp Suite. Zana hizi zinaweza kutumika kwa kuchukua hatua za kiotomatiki kwenye skrini za wavuti, kama vile kuingia kwenye akaunti, kujaza fomu, na kubofya viungo.

Uthibitishaji wa kiotomatiki unaweza kuwa na faida nyingi. Kwanza, inaweza kuokoa muda na juhudi kwa kufanya majaribio ya uthibitishaji kwa kasi zaidi kuliko kwa mkono. Pia, inaweza kusaidia kugundua kasoro za usalama ambazo zinaweza kuwa ngumu kugundua kwa njia ya kawaida.

Hata hivyo, kuna pia changamoto zinazohusiana na uthibitishaji wa kiotomatiki. Kwa mfano, zana za kiotomatiki zinaweza kuwa na udhaifu wao wenyewe na zinaweza kushindwa kufanya majaribio ya uthibitishaji kwa usahihi. Pia, kuna hatari ya kufanya majaribio ya uthibitishaji kwa wingi na kusababisha kufungwa kwa akaunti au kuzuiliwa kwa sababu ya shughuli zisizo za kawaida.

Kwa hiyo, ni muhimu kuzingatia faida na changamoto za uthibitishaji wa kiotomatiki kabla ya kuanza kutumia zana za kiotomatiki kwa madhumuni ya uthibitishaji. Ni muhimu pia kuzingatia sheria na kanuni zinazohusiana na uthibitishaji wa kiotomatiki ili kuepuka matatizo ya kisheria.
```bash
for sub in $(cat <WORDLIST>);do dig $sub.<DOMAIN> @<DNS_IP> | grep -v ';\|SOA' | sed -r '/^\s*$/d' | grep $sub | tee -a subdomains.txt;done

dnsenum --dnsserver <DNS_IP> --enum -p 0 -s 0 -o subdomains.txt -f <WORDLIST> <DOMAIN>
```
#### Kutumia nslookup

Nslookup ni chombo cha amri kinachotumiwa kwenye mfumo wa uendeshaji ili kuangalia na kuchunguza habari za DNS. Inaweza kutumiwa kwa uchunguzi wa kawaida wa DNS, kama vile kutafuta anwani ya IP kutoka kwa jina la kikoa (forward lookup) au kutafuta jina la kikoa kutoka kwa anwani ya IP (reverse lookup).

Kutumia nslookup ni rahisi. Unaweza kufungua terminal au amri ya msingi na kuingiza amri "nslookup" kufungua mazingira ya nslookup. Kisha, unaweza kuingiza amri zifuatazo:

- `server <DNS server>`: Inabadilisha seva ya DNS inayotumiwa na nslookup. Unaweza kubadilisha seva ya DNS kwa kuingiza anwani ya IP ya seva ya DNS unayotaka kutumia.
- `set type=<record type>`: Inabadilisha aina ya rekodi ya DNS inayotafutwa. Aina za kawaida ni "A" (IPv4), "AAAA" (IPv6), "MX" (Mail Exchanger), "NS" (Name Server), na "TXT" (Text).
- `<domain>`: Inatafuta anwani ya IP ya jina la kikoa lililopewa.
- `<IP address>`: Inatafuta jina la kikoa kutoka kwa anwani ya IP iliyotolewa.

Kwa mfano, ikiwa unataka kutafuta anwani ya IP ya kikoa "example.com", unaweza kuingiza amri `nslookup example.com`. Nslookup itakupa anwani ya IP ya kikoa hicho.

Nslookup ni chombo muhimu katika uchunguzi wa DNS na inaweza kutumiwa kwa uchunguzi wa kina wa mifumo ya DNS.
```bash
nslookup
> SERVER <IP_DNS> #Select dns server
> 127.0.0.1 #Reverse lookup of 127.0.0.1, maybe...
> <IP_MACHINE> #Reverse lookup of a machine, maybe...
```
### Moduli muhimu ya metasploit

Metasploit ni jukwaa maarufu la kufanya majaribio ya kuingilia kwenye mifumo ya kompyuta. Inatoa moduli mbalimbali ambazo zinaweza kutumika kwa ufanisi katika shughuli za kuingilia kwenye mifumo. Hapa chini ni baadhi ya moduli muhimu za Metasploit:

- `exploit`: Moduli hii hutumiwa kwa kuchunguza na kutumia udhaifu katika mfumo wa lengo.
- `payload`: Moduli hii inawezesha kuingiza na kutekeleza programu hasidi kwenye mfumo wa lengo.
- `auxiliary`: Moduli hii hutumiwa kwa shughuli za ziada kama kuchunguza mifumo, kusambaza programu hasidi, au kufanya uchunguzi wa kina.
- `post`: Moduli hii hutumiwa baada ya kuingia kwenye mfumo wa lengo ili kutekeleza shughuli za baadaye kama kukusanya taarifa au kudhibiti mfumo.
- `encoder`: Moduli hii inatumika kubadilisha programu hasidi ili kuepuka kugunduliwa na zana za usalama.

Moduli hizi ni muhimu sana katika kufanikisha shughuli za kuingilia kwenye mifumo na zinaweza kutumika kwa ufanisi katika mazingira mbalimbali ya kuingilia kwenye mifumo.
```bash
auxiliary/gather/enum_dns #Perform enumeration actions
```
### Skrƒ´pti za Nmap zinazoweza kusaidia

Nmap ni chombo maarufu cha kuchunguza mitandao na kufanya uchunguzi wa usalama. Inakuja na maktaba ya skrƒ´pti ambazo zinaweza kutumika kwa uchunguzi wa kina wa huduma za mtandao. Hapa kuna baadhi ya skrƒ´pti muhimu za Nmap:

- **dns-brute.nse**: Skrƒ´pti hii inafanya jaribio la kubainisha majina ya kikoa kwa kutumia nguvu ya kubadilisha majina ya kikoa. Inaweza kusaidia kugundua majina ya kikoa yaliyofichwa au yaliyosahaulika.

- **dns-cache-snoop.nse**: Skrƒ´pti hii inachunguza kumbukumbu ya DNS ya seva ya DNS na inajaribu kufichua habari nyeti kama vile majina ya kikoa yaliyotembelewa hivi karibuni.

- **dns-zone-transfer.nse**: Skrƒ´pti hii inajaribu kutekeleza uhamishaji wa eneo la DNS kutoka kwa seva ya DNS. Inaweza kusaidia kugundua habari muhimu kama vile majina ya kikoa, anwani za IP, na rekodi nyingine za DNS.

- **dns-recursion.nse**: Skrƒ´pti hii inajaribu kugundua ikiwa seva ya DNS inaruhusu upya wa DNS. Upya wa DNS unaweza kusababisha ukiukaji wa usalama kwa sababu inaweza kusababisha kuvuja kwa habari nyeti.

- **dns-service-discovery.nse**: Skrƒ´pti hii inajaribu kugundua huduma za DNS zinazopatikana kwenye mtandao. Inaweza kusaidia kubainisha seva za DNS zilizosanikishwa na kuchunguza mazingira ya mtandao.

- **dns-blacklist.nse**: Skrƒ´pti hii inachunguza ikiwa anwani ya IP au jina la kikoa linapatikana kwenye orodha nyeusi ya DNS. Inaweza kusaidia kugundua ikiwa anwani ya IP au jina la kikoa linaweza kuwa na sifa mbaya.

- **dns-random-srcport.nse**: Skrƒ´pti hii inajaribu kufanya uchunguzi wa seva ya DNS kwa kutumia bandari za chanzo zilizochaguliwa kwa nasibu. Inaweza kusaidia kuepuka kugunduliwa na vifaa vya usalama ambavyo vinaweza kuchunguza shughuli za kawaida za DNS.

- **dns-random-txid.nse**: Skrƒ´pti hii inajaribu kufanya uchunguzi wa seva ya DNS kwa kutumia kitambulisho cha uhamishaji (TXID) kilichochaguliwa kwa nasibu. Inaweza kusaidia kuepuka kugunduliwa na vifaa vya usalama ambavyo vinaweza kuchunguza shughuli za kawaida za DNS.

- **dns-random-tld.nse**: Skrƒ´pti hii inajaribu kufanya uchunguzi wa seva ya DNS kwa kutumia kikoa cha kiwango cha juu (TLD) kilichochaguliwa kwa nasibu. Inaweza kusaidia kuepuka kugunduliwa na vifaa vya usalama ambavyo vinaweza kuchunguza shughuli za kawaida za DNS.

- **dns-random-subdomain.nse**: Skrƒ´pti hii inajaribu kufanya uchunguzi wa seva ya DNS kwa kutumia kikoa cha chini kilichochaguliwa kwa nasibu. Inaweza kusaidia kuepuka kugunduliwa na vifaa vya usalama ambavyo vinaweza kuchunguza shughuli za kawaida za DNS.

- **dns-random-ip.nse**: Skrƒ´pti hii inajaribu kufanya uchunguzi wa seva ya DNS kwa kutumia anwani ya IP iliyochaguliwa kwa nasibu. Inaweza kusaidia kuepuka kugunduliwa na vifaa vya usalama ambavyo vinaweza kuchunguza shughuli za kawaida za DNS.

- **dns-random-query.nse**: Skrƒ´pti hii inajaribu kufanya uchunguzi wa seva ya DNS kwa kutumia swali la DNS lililochaguliwa kwa nasibu. Inaweza kusaidia kuepuka kugunduliwa na vifaa vya usalama ambavyo vinaweza kuchunguza shughuli za kawaida za DNS.

- **dns-random-rrtype.nse**: Skrƒ´pti hii inajaribu kufanya uchunguzi wa seva ya DNS kwa kutumia aina ya rekodi ya DNS iliyochaguliwa kwa nasibu. Inaweza kusaidia kuepuka kugunduliwa na vifaa vya usalama ambavyo vinaweza kuchunguza shughuli za kawaida za DNS.

- **dns-random-rrname.nse**: Skrƒ´pti hii inajaribu kufanya uchunguzi wa seva ya DNS kwa kutumia jina la rekodi ya DNS iliyochaguliwa kwa nasibu. Inaweza kusaidia kuepuka kugunduliwa na vifaa vya usalama ambavyo vinaweza kuchunguza shughuli za kawaida za DNS.

- **dns-random-rrclass.nse**: Skrƒ´pti hii inajaribu kufanya uchunguzi wa seva ya DNS kwa kutumia darasa la rekodi ya DNS iliyochaguliwa kwa nasibu. Inaweza kusaidia kuepuka kugunduliwa na vifaa vya usalama ambavyo vinaweza kuchunguza shughuli za kawaida za DNS.

- **dns-random-rrttl.nse**: Skrƒ´pti hii inajaribu kufanya uchunguzi wa seva ya DNS kwa kutumia thamani ya TTL ya rekodi ya DNS iliyochaguliwa kwa nasibu. Inaweza kusaidia kuepuka kugunduliwa na vifaa vya usalama ambavyo vinaweza kuchunguza shughuli za kawaida za DNS.

- **dns-random-rrdata.nse**: Skrƒ´pti hii inajaribu kufanya uchunguzi wa seva ya DNS kwa kutumia data ya rekodi ya DNS iliyochaguliwa kwa nasibu. Inaweza kusaidia kuepuka kugunduliwa na vifaa vya usalama ambavyo vinaweza kuchunguza shughuli za kawaida za DNS.
```bash
#Perform enumeration actions
nmap -n --script "(default and *dns*) or fcrdns or dns-srv-enum or dns-random-txid or dns-random-srcport" <IP>
```
### DNS - Reverse BF

#### Description

Reverse BF (Brute Force) is a technique used to discover subdomains by systematically guessing and querying DNS records. It involves iterating through a list of possible subdomains and sending DNS queries to check if they exist.

#### Methodology

1. Identify the target domain: Determine the main domain you want to perform the reverse BF on.

2. Generate a list of possible subdomains: Use tools like `dnsrecon`, `sublist3r`, or `amass` to create a list of potential subdomains.

3. Query DNS records: Iterate through the list of subdomains and send DNS queries to check if they resolve to an IP address. Tools like `dig` or `nslookup` can be used for this purpose.

4. Analyze the results: Examine the responses received from the DNS queries. Look for subdomains that return valid IP addresses, as they indicate potential targets for further investigation.

5. Enumerate discovered subdomains: Once you have identified valid subdomains, you can further enumerate them using techniques like zone transfers, DNS zone walking, or other enumeration tools.

6. Exploit the discovered subdomains: Depending on the purpose of your penetration test, you can proceed to exploit the discovered subdomains using various techniques such as subdomain takeover, vulnerability scanning, or other attack vectors.

#### Mitigation

To protect against reverse BF attacks, consider implementing the following measures:

- Implement rate limiting: Limit the number of DNS queries that can be made from a single IP address within a specific time frame.

- Monitor DNS logs: Regularly review DNS logs for any suspicious activity or an unusually high number of queries.

- Use strong and complex subdomain names: Avoid using predictable subdomain names that can be easily guessed.

- Regularly review and update DNS configurations: Ensure that DNS configurations are up to date and do not contain any unnecessary or vulnerable subdomains.

- Implement DNSSEC: DNS Security Extensions (DNSSEC) can provide additional security by digitally signing DNS records, preventing tampering or spoofing.

- Employ intrusion detection and prevention systems: Use IDS/IPS to detect and block suspicious DNS queries or traffic patterns.

By following these mitigation techniques, you can reduce the risk of reverse BF attacks and enhance the security of your DNS infrastructure.
```bash
dnsrecon -r 127.0.0.0/24 -n <IP_DNS>  #DNS reverse of all of the addresses
dnsrecon -r 127.0.1.0/24 -n <IP_DNS>  #DNS reverse of all of the addresses
dnsrecon -r <IP_DNS>/24 -n <IP_DNS>   #DNS reverse of all of the addresses
dnsrecon -d active.htb -a -n <IP_DNS> #Zone transfer
```
{% hint style="info" %}
Ikiwa unaweza kupata subdomains zinazotatuliwa kwa anwani za IP za ndani, unapaswa jaribu kufanya reverse dns BF kwa NSs ya kikoa kwa kuuliza kwa safu hiyo ya IP.
{% endhint %}

Zana nyingine ya kufanya hivyo: [https://github.com/amine7536/reverse-scan](https://github.com/amine7536/reverse-scan)

Unaweza kuuliza safu za IP za nyuma kwa [https://bgp.he.net/net/205.166.76.0/24#\_dns](https://bgp.he.net/net/205.166.76.0/24#\_dns) (zana hii pia ni muhimu na BGP).

### DNS - Subdomains BF
```bash
dnsenum --dnsserver <IP_DNS> --enum -p 0 -s 0 -o subdomains.txt -f subdomains-1000.txt <DOMAIN>
dnsrecon -D subdomains-1000.txt -d <DOMAIN> -n <IP_DNS>
dnscan -d <domain> -r -w subdomains-1000.txt #Bruteforce subdomains in recursive way, https://github.com/rbsec/dnscan
```
### Seva za Active Directory

Active Directory ni huduma ya utawala wa usalama inayotumiwa katika mifumo ya Windows Server. Inawezesha usimamizi wa watumiaji, vikundi, na rasilimali katika mtandao wa ndani. Kwa mafanikio ya udukuzi wa mtandao, ni muhimu kuelewa jinsi ya kuchunguza na kudukua seva za Active Directory.

#### Kuchunguza Seva za Active Directory

Kuna njia kadhaa za kuchunguza seva za Active Directory:

1. **DNS Enumeration**: Kwa kutumia zana kama `nslookup` au `dig`, unaweza kutafuta rekodi za DNS zinazohusiana na seva za Active Directory. Hii inaweza kutoa habari muhimu kama majina ya kikoa, anwani za IP, na seva za DNS zinazotumiwa.

2. **Port Scanning**: Kwa kutumia zana kama `nmap`, unaweza kutambua seva za Active Directory kwa kuchunguza bandari zinazohusiana na huduma hii. Bandari za kawaida zinazotumiwa ni pamoja na 389 (LDAP), 636 (LDAPS), na 3268 (Global Catalog).

3. **Service Enumeration**: Kwa kutumia zana kama `enum4linux` au `ldapsearch`, unaweza kuchunguza huduma zinazopatikana kwenye seva za Active Directory. Hii inaweza kutoa habari kama majina ya watumiaji, majina ya kikoa, na vikundi vilivyopo.

#### Kudukua Seva za Active Directory

Baada ya kuchunguza seva za Active Directory, unaweza kuanza kudukua ili kupata ufikiaji usio halali. Hapa kuna mbinu kadhaa zinazoweza kutumika:

1. **Brute Forcing**: Kwa kutumia zana kama `Hydra` au `CrackMapExec`, unaweza kujaribu kudukua nywila za watumiaji kwa kujaribu mchanganyiko wa maneno na tarakimu. Hii inaweza kufanikiwa ikiwa nywila dhaifu zinatumika.

2. **Pass-the-Hash**: Kwa kutumia zana kama `Mimikatz`, unaweza kuiba hash ya nywila kutoka kwa seva ya Active Directory na kuitumia kuingia kwenye mfumo bila kujua nywila halisi.

3. **Kerberoasting**: Kwa kutumia zana kama `Rubeus`, unaweza kudukua huduma ya Kerberos ili kuiba tiketi za huduma zinazotumiwa na seva za Active Directory. Hii inaweza kutoa ufikiaji usio halali kwa akaunti za huduma.

Kumbuka kuwa kudukua seva za Active Directory ni kinyume cha sheria na inapaswa kufanywa tu kwa idhini ya mmiliki wa mfumo.
```bash
dig -t _gc._tcp.lab.domain.com
dig -t _ldap._tcp.lab.domain.com
dig -t _kerberos._tcp.lab.domain.com
dig -t _kpasswd._tcp.lab.domain.com

nslookup -type=srv _kerberos._tcp.<CLIENT_DOMAIN>
nslookup -type=srv _kerberos._tcp.domain.com

nmap --script dns-srv-enum --script-args "dns-srv-enum.domain='domain.com'"
```
### DNSSec

DNSSec ni itifaki ya usalama ambayo inalenga kuimarisha usalama wa mfumo wa DNS. Inafanya hivyo kwa kusaini data ya DNS na kutumia uchunguzi wa umma na faragha ili kuhakikisha kuwa data ya DNS haijabadilishwa au kuharibiwa wakati wa uhamishaji.

DNSSec inaleta faida kadhaa kwa watumiaji wa DNS. Kwanza, inazuia mashambulizi ya kati ambapo mtu wa tatu anaweza kuingilia kati na kubadilisha data ya DNS. Pili, inazuia mashambulizi ya DNS cache poisoning ambapo mtu mwenye nia mbaya anaweza kudanganya mfumo wa DNS na kusababisha maelekezo sahihi ya DNS kuwa na matokeo yasiyofaa.

Kwa kuongezea, DNSSec inaruhusu watumiaji kuthibitisha kuwa data ya DNS wanayopokea ni sahihi na halisi. Hii inasaidia kuzuia mashambulizi ya phishing ambapo mtu mwenye nia mbaya anaweza kujaribu kuiba habari za siri kwa kudanganya watumiaji kuamini kuwa wanawasiliana na tovuti halali.

Kwa kumalizia, DNSSec ni muhimu katika kuhakikisha usalama wa mfumo wa DNS na kuzuia mashambulizi ya kati na udanganyifu. Ni muhimu kwa wataalamu wa usalama na watumiaji wa kawaida kuelewa na kutumia itifaki hii ili kuhakikisha kuwa mawasiliano yao ya mtandao ni salama na sahihi.
```bash
#Query paypal subdomains to ns3.isc-sns.info
nmap -sSU -p53 --script dns-nsec-enum --script-args dns-nsec-enum.domains=paypal.com ns3.isc-sns.info
```
### IPv6

Tumia nguvu kwa kutumia maombi ya "AAAA" ili kukusanya IPv6 ya subdomains.
```bash
dnsdict6 -s -t <domain>
```
# Pentesting DNS: Bruteforce reverse DNS in using IPv6 addresses

## Introduction

In this section, we will discuss the technique of bruteforcing reverse DNS using IPv6 addresses. Reverse DNS is a process that maps an IP address to a domain name. By bruteforcing reverse DNS, we can attempt to discover domain names associated with specific IPv6 addresses.

## Methodology

To bruteforce reverse DNS using IPv6 addresses, follow these steps:

1. **Enumerate IPv6 addresses**: Begin by enumerating a range of IPv6 addresses that you want to target. This can be done using various methods, such as scanning the network or using tools like `nmap`.

2. **Generate domain names**: Once you have a list of IPv6 addresses, generate a list of potential domain names that could be associated with these addresses. This can be done by combining common domain name prefixes and suffixes with the IPv6 addresses.

3. **Perform reverse DNS lookup**: Use a tool like `dig` or an online reverse DNS lookup service to perform a reverse DNS lookup for each IPv6 address and check if it resolves to any of the generated domain names.

4. **Analyze results**: Analyze the results of the reverse DNS lookup. If a domain name is discovered for an IPv6 address, further investigate the associated domain for potential vulnerabilities or misconfigurations.

## Tools

Here are some tools that can be used for bruteforcing reverse DNS using IPv6 addresses:

- `nmap`: A powerful network scanning tool that can be used to enumerate IPv6 addresses.
- `dig`: A command-line tool for performing DNS queries, including reverse DNS lookups.
- Online reverse DNS lookup services: There are various online services available that allow you to perform reverse DNS lookups.

## Conclusion

Bruteforcing reverse DNS using IPv6 addresses can be a useful technique for discovering domain names associated with specific IPv6 addresses. By analyzing the results, you may uncover potential vulnerabilities or misconfigurations that can be further exploited during a penetration test.
```bash
dnsrevenum6 pri.authdns.ripe.net 2001:67c:2e8::/48 #Will use the dns pri.authdns.ripe.net
```
### DNS Recursion DDoS

Ikiwa **DNS recursion** imeamilishwa, mshambuliaji anaweza **kudanganya** asili ya pakiti ya UDP ili kufanya DNS itume jibu kwa seva ya mwathiriwa. Mshambuliaji anaweza kutumia aina za rekodi **ANY** au **DNSSEC** kwani zina majibu makubwa.\
Njia ya **kuchunguza** ikiwa DNS inasaidia **recursion** ni kuuliza jina la kikoa na **kuchunguza** ikiwa **bendera "ra"** (_recursion inapatikana_) iko katika jibu:
```bash
dig google.com A @<IP>
```
**Hakuna inapatikana**:

![](<../.gitbook/assets/image (275).png>)

**Inapatikana**:

![](<../.gitbook/assets/image (276).png>)

<figure><img src="/.gitbook/assets/image (2).png" alt=""><figcaption></figcaption></figure>

**Usanidi uliopo mara moja kwa ajili ya tathmini ya udhaifu na upenyezaji wa mtihani**. Fanya mtihani kamili kutoka mahali popote na zana na huduma zaidi ya 20 ambazo zinaanza kutoka kwa uchunguzi hadi ripoti. Hatuchukui nafasi ya wapenyezaji - tunatengeneza zana za kawaida, moduli za ugunduzi na uvamizi ili kuwapa muda wa kuchimba kwa kina, kuvunja mabaka, na kufurahi.

{% embed url="https://pentest-tools.com/" %}

### Barua pepe kwa akaunti isiyopo

Kupitia uchunguzi wa taarifa ya kutofanikiwa kwa utoaji (NDN) uliochochewa na barua pepe iliyotumwa kwa anwani batili ndani ya kikoa cha lengo, maelezo muhimu ya mtandao wa ndani mara nyingi hufichuliwa.

Ripoti ya kutofanikiwa iliyotolewa inajumuisha habari kama vile:

- Seva inayozalisha iligunduliwa kama `server.example.com`.
- Taarifa ya kutofanikiwa kwa `user@example.com` na nambari ya kosa `#550 5.1.1 RESOLVER.ADR.RecipNotFound; haipatikani` ilirudishwa.
- Anwani za IP za ndani na majina ya mwenyeji yalifichuliwa katika vichwa vya ujumbe asili.
```markdown
The original message headers were modified for anonymity and now present randomized data:

Generating server: server.example.com

user@example.com
#550 5.1.1 RESOLVER.ADR.RecipNotFound; not found ##

Original message headers:

Received: from MAILSERVER01.domain.example.com (192.168.1.1) by
mailserver02.domain.example.com (192.168.2.2) with Microsoft SMTP Server (TLS)
id 14.3.174.1; Mon, 25 May 2015 14:52:22 -0700
Received: from filter.example.com (203.0.113.1) by
MAILSERVER01.domain.example.com (192.168.1.1) with Microsoft SMTP Server (TLS)
id 14.3.174.1; Mon, 25 May 2015 14:51:22 -0700
X-ASG-Debug-ID: 1432576343-0614671716190e0d0001-zOQ9WJ
Received: from gateway.domainhost.com (gateway.domainhost.com [198.51.100.37]) by
filter.example.com with ESMTP id xVNPkwaqGgdyH5Ag for user@example.com; Mon,
25 May 2015 14:52:13 -0700 (PDT)
X-Envelope-From: sender@anotherdomain.org
X-Apparent-Source-IP: 198.51.100.37
```
## Faili za Usanidi

Config files ni faili ambazo zina maelezo muhimu kuhusu jinsi mfumo unavyofanya kazi. Katika muktadha wa pentesting, config files zinaweza kuwa chanzo cha habari muhimu kwa hacker. Hapa chini ni baadhi ya config files za kawaida ambazo unaweza kukutana nazo wakati wa kufanya pentesting:

### /etc/resolv.conf

Faili hii ina maelezo kuhusu DNS resolvers ambazo mfumo unatumia. Inaweza kuonyesha DNS server za ndani na za nje ambazo mfumo unategemea. Kwa hacker, faili hii inaweza kutoa habari muhimu kuhusu miundombinu ya DNS ya shirika na inaweza kutumiwa kwa kufanya mashambulizi ya DNS.

### /etc/hosts

Faili hii ina orodha ya IP addresses na hostnames ambazo mfumo unajua. Inaweza kutumiwa kwa kubadilisha maelekezo ya DNS na kuelekeza trafiki kwa IP address sahihi. Kwa hacker, faili hii inaweza kutumiwa kwa kufanya mashambulizi ya man-in-the-middle na kudanganya trafiki.

### /etc/named.conf

Faili hii ina maelezo ya usanidi wa DNS server ya BIND. Inaweza kutoa habari muhimu kuhusu miundombinu ya DNS ya shirika na inaweza kutumiwa kwa kufanya mashambulizi ya DNS.

### /etc/dhcp/dhclient.conf

Faili hii ina maelezo ya usanidi wa DHCP client. Inaweza kuonyesha maelezo kuhusu DHCP server ambayo mfumo unategemea. Kwa hacker, faili hii inaweza kutoa habari muhimu kuhusu miundombinu ya DHCP ya shirika na inaweza kutumiwa kwa kufanya mashambulizi ya DHCP.

### /etc/dhcpd.conf

Faili hii ina maelezo ya usanidi wa DHCP server. Inaweza kutoa habari muhimu kuhusu miundombinu ya DHCP ya shirika na inaweza kutumiwa kwa kufanya mashambulizi ya DHCP.

### /etc/ssh/sshd_config

Faili hii ina maelezo ya usanidi wa SSH server. Inaweza kutoa habari muhimu kuhusu miundombinu ya SSH ya shirika na inaweza kutumiwa kwa kufanya mashambulizi ya SSH.

### /etc/openvpn/server.conf

Faili hii ina maelezo ya usanidi wa OpenVPN server. Inaweza kutoa habari muhimu kuhusu miundombinu ya VPN ya shirika na inaweza kutumiwa kwa kufanya mashambulizi ya VPN.

### /etc/samba/smb.conf

Faili hii ina maelezo ya usanidi wa Samba server. Inaweza kutoa habari muhimu kuhusu miundombinu ya file sharing ya shirika na inaweza kutumiwa kwa kufanya mashambulizi ya Samba.

### /etc/exports

Faili hii ina maelezo ya usanidi wa NFS server. Inaweza kutoa habari muhimu kuhusu miundombinu ya file sharing ya shirika na inaweza kutumiwa kwa kufanya mashambulizi ya NFS.

### /etc/redis/redis.conf

Faili hii ina maelezo ya usanidi wa Redis server. Inaweza kutoa habari muhimu kuhusu miundombinu ya caching na storage ya shirika na inaweza kutumiwa kwa kufanya mashambulizi ya Redis.

### /etc/mongodb.conf

Faili hii ina maelezo ya usanidi wa MongoDB server. Inaweza kutoa habari muhimu kuhusu miundombinu ya database ya shirika na inaweza kutumiwa kwa kufanya mashambulizi ya MongoDB.

### /etc/mysql/my.cnf

Faili hii ina maelezo ya usanidi wa MySQL server. Inaweza kutoa habari muhimu kuhusu miundombinu ya database ya shirika na inaweza kutumiwa kwa kufanya mashambulizi ya MySQL.

### /etc/postgresql/postgresql.conf

Faili hii ina maelezo ya usanidi wa PostgreSQL server. Inaweza kutoa habari muhimu kuhusu miundombinu ya database ya shirika na inaweza kutumiwa kwa kufanya mashambulizi ya PostgreSQL.

### /etc/ldap/ldap.conf

Faili hii ina maelezo ya usanidi wa LDAP client. Inaweza kutoa habari muhimu kuhusu miundombinu ya directory services ya shirika na inaweza kutumiwa kwa kufanya mashambulizi ya LDAP.

### /etc/ldap/slapd.conf

Faili hii ina maelezo ya usanidi wa LDAP server. Inaweza kutoa habari muhimu kuhusu miundombinu ya directory services ya shirika na inaweza kutumiwa kwa kufanya mashambulizi ya LDAP.

### /etc/krb5.conf

Faili hii ina maelezo ya usanidi wa Kerberos client. Inaweza kutoa habari muhimu kuhusu miundombinu ya authentication ya shirika na inaweza kutumiwa kwa kufanya mashambulizi ya Kerberos.

### /etc/krb5kdc/kdc.conf

Faili hii ina maelezo ya usanidi wa Kerberos KDC (Key Distribution Center). Inaweza kutoa habari muhimu kuhusu miundombinu ya authentication ya shirika na inaweza kutumiwa kwa kufanya mashambulizi ya Kerberos.

### /etc/krb5kdc/kadm5.acl

Faili hii ina maelezo ya usanidi wa Kerberos KDC ACL (Access Control List). Inaweza kutoa habari muhimu kuhusu miundombinu ya authentication ya shirika na inaweza kutumiwa kwa kufanya mashambulizi ya Kerberos.

### /etc/krb5kdc/kpropd.acl

Faili hii ina maelezo ya usanidi wa Kerberos KPROP (Kerberos Propagation) ACL (Access Control List). Inaweza kutoa habari muhimu kuhusu miundombinu ya authentication ya shirika na inaweza kutumiwa kwa kufanya mashambulizi ya Kerberos.
```
host.conf
/etc/resolv.conf
/etc/bind/named.conf
/etc/bind/named.conf.local
/etc/bind/named.conf.options
/etc/bind/named.conf.log
/etc/bind/*
```
Mipangilio hatari wakati wa kusanidi seva ya Bind:

| **Chaguo**        | **Maelezo**                                                                |
| ----------------- | ------------------------------------------------------------------------------ |
| `allow-query`     | Inafafanua ni mwenyeji gani anaruhusiwa kutuma maombi kwa seva ya DNS.            |
| `allow-recursion` | Inafafanua ni mwenyeji gani anaruhusiwa kutuma maombi ya kurudia kwa seva ya DNS.  |
| `allow-transfer`  | Inafafanua ni mwenyeji gani anaruhusiwa kupokea uhamisho wa eneo kutoka kwa seva ya DNS. |
| `zone-statistics` | Inakusanya data za takwimu za eneo.                                            |

## Marejeo
* [https://www.myrasecurity.com/en/knowledge-hub/dns/](https://www.myrasecurity.com/en/knowledge-hub/dns/)
* Kitabu: **Network Security Assessment 3rd edition**

## Amri za Kiotomatiki za HackTricks
```
Protocol_Name: DNS    #Protocol Abbreviation if there is one.
Port_Number:  53     #Comma separated if there is more than one.
Protocol_Description: Domain Name Service        #Protocol Abbreviation Spelled out

Entry_1:
Name: Notes
Description: Notes for DNS
Note: |
#These are the commands I run every time I see an open DNS port

dnsrecon -r 127.0.0.0/24 -n {IP} -d {Domain_Name}
dnsrecon -r 127.0.1.0/24 -n {IP} -d {Domain_Name}
dnsrecon -r {Network}{CIDR} -n {IP} -d {Domain_Name}
dig axfr @{IP}
dig axfr {Domain_Name} @{IP}
nslookup
SERVER {IP}
127.0.0.1
{IP}
Domain_Name
exit

https://book.hacktricks.xyz/pentesting/pentesting-dns

Entry_2:
Name: Banner Grab
Description: Grab DNS Banner
Command: dig version.bind CHAOS TXT @DNS

Entry_3:
Name: Nmap Vuln Scan
Description: Scan for Vulnerabilities with Nmap
Command: nmap -n --script "(default and *dns*) or fcrdns or dns-srv-enum or dns-random-txid or dns-random-srcport" {IP}

Entry_4:
Name: Zone Transfer
Description: Three attempts at forcing a zone transfer
Command: dig axfr @{IP} && dix axfr @{IP} {Domain_Name} && fierce --dns-servers {IP} --domain {Domain_Name}


Entry_5:
Name: Active Directory
Description: Eunuerate a DC via DNS
Command: dig -t _gc._{Domain_Name} && dig -t _ldap._{Domain_Name} && dig -t _kerberos._{Domain_Name} && dig -t _kpasswd._{Domain_Name} && nmap --script dns-srv-enum --script-args "dns-srv-enum.domain={Domain_Name}"

Entry_6:
Name: consolesless mfs enumeration
Description: DNS enumeration without the need to run msfconsole
Note: sourced from https://github.com/carlospolop/legion
Command: msfconsole -q -x 'use auxiliary/scanner/dns/dns_amp; set RHOSTS {IP}; set RPORT 53; run; exit' && msfconsole -q -x 'use auxiliary/gather/enum_dns; set RHOSTS {IP}; set RPORT 53; run; exit'
```
<figure><img src="/.gitbook/assets/image (2).png" alt=""><figcaption></figcaption></figure>

**Usanidi uliopo mara moja kwa tathmini ya udhaifu na upenyezaji**. Tekeleza upenyezaji kamili kutoka mahali popote na zana na huduma zaidi ya 20 ambazo zinaanza kutoka uchunguzi hadi ripoti. Hatuchukui nafasi ya wapenyezaji - tunatengeneza zana za kawaida, moduli za ugunduzi na uvamizi ili kuwapa muda wa kuchimba kwa kina, kuchukua udhibiti, na kufurahia.

{% embed url="https://pentest-tools.com/" %}

<details>

<summary><strong>Jifunze kuhusu kudukua AWS kutoka sifuri hadi shujaa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Mtaalam wa Timu Nyekundu ya AWS ya HackTricks)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako ikitangazwa kwenye HackTricks** au **kupakua HackTricks kwa muundo wa PDF** Angalia [**MPANGO WA KUJIUNGA**](https://github.com/sponsors/carlospolop)!
* Pata [**swag rasmi wa PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**Familia ya PEASS**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa [**NFTs**](https://opensea.io/collection/the-peass-family) za kipekee
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au [**kikundi cha telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Shiriki mbinu zako za kudukua kwa kuwasilisha PR kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) **na** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **repos za github.**

</details>
