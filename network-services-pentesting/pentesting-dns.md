# 53 - Πεντεστική Διείσδυση στο DNS

<details>

<summary><strong>Μάθετε το χάκινγκ του AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι για να υποστηρίξετε το HackTricks:

* Αν θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**την Οικογένεια PEASS**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε στη** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στη [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Μοιραστείτε τα χάκινγκ κόλπα σας υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>

<figure><img src="/.gitbook/assets/image (2).png" alt=""><figcaption></figcaption></figure>

**Άμεσα διαθέσιμη εγκατάσταση για αξιολόγηση ευπαθειών και πεντεστική διείσδυση**. Εκτελέστε μια πλήρη πεντεστική δοκιμή από οπουδήποτε με 20+ εργαλεία και χαρακτηριστικά που καλύπτουν από την αναγνώριση έως την αναφορά. Δεν αντικαθιστούμε τους πεντεστέρ - αναπτύσσουμε προσαρμοσμένα εργαλεία, ανίχνευση και εκμετάλλευση ενοτήτων για να τους δώσουμε πίσω κάποιο χρόνο για να εξερευνήσουν πιο βαθιά, να ανοίξουν καρέκλες και να διασκεδάσουν.

{% embed url="https://pentest-tools.com/" %}

## **Βασικές Πληροφορίες**

Το **Σύστημα Ονομάτων Τομέων (DNS)** λειτουργεί ως ο κατάλογος του διαδικτύου, επιτρέποντας στους χρήστες να έχουν πρόσβαση σε ιστότοπους μέσω **ευκολομνημόνευτων ονομάτων τομέων** όπως google.com ή facebook.com, αντί για τις αριθμητικές διευθύνσεις Internet Protocol (IP). Μεταφράζοντας τα ονόματα τομέων σε διευθύνσεις IP, το DNS εξασφαλίζει ότι οι περιηγητές ιστού μπορούν να φορτώνουν γρήγορα πόρους του διαδικτύου, απλοποιώντας τον τρόπο που περιηγούμαστε στον online κόσμο.

**Προεπιλεγμένη θύρα:** 53
```
PORT     STATE SERVICE  REASON
53/tcp   open  domain  Microsoft DNS 6.1.7601 (1DB15D39) (Windows Server 2008 R2 SP1)
5353/udp open  zeroconf udp-response
53/udp   open  domain  Microsoft DNS 6.1.7601 (1DB15D39) (Windows Server 2008 R2 SP1)
```
### Διάφοροι Διακομιστές DNS

- **Διακομιστές ρίζας DNS**: Αυτοί βρίσκονται στην κορυφή της ιεραρχίας DNS και διαχειρίζονται τους τομείς στην κορυφαία επίπεδη και επεμβαίνουν μόνο εάν οι χαμηλότερου επιπέδου διακομιστές δεν ανταποκρίνονται. Το Internet Corporation for Assigned Names and Numbers (**ICANN**) εποπτεύει τη λειτουργία τους, με παγκόσμιο αριθμό 13.

- **Διακομιστές εξουσιοδοτημένων ονομαστικών χώρων**: Αυτοί οι διακομιστές έχουν τον τελικό λόγο για τις ερωτήσεις στις επιλεγμένες ζώνες τους, προσφέροντας οριστικές απαντήσεις. Εάν δεν μπορούν να παράσχουν απάντηση, η ερώτηση αναβαθμίζεται στους διακομιστές ρίζας.

- **Διακομιστές μη εξουσιοδοτημένων ονομαστικών χώρων**: Αυτοί οι διακομιστές δεν έχουν κυριότητα πάνω από τους ονομαστικούς χώρους DNS και συλλέγουν πληροφορίες τομέα μέσω ερωτήσεων σε άλλους διακομιστές.

- **Διακομιστής κρυφής μνήμης DNS**: Αυτός ο τύπος διακομιστή αποθηκεύει στη μνήμη του προηγούμενες απαντήσεις ερωτήσεων για ένα συγκεκριμένο χρονικό διάστημα, προκειμένου να επιταχύνει τους χρόνους απόκρισης για μελλοντικά αιτήματα, με τη διάρκεια της μνήμης προσδιορίζεται από τον εξουσιοδοτημένο διακομιστή.

- **Διακομιστής προώθησης**: Οι διακομιστές προώθησης απλά μεταφέρουν ερωτήσεις σε άλλο διακομιστή.

- **Επίλυσης**: Ενσωματωμένοι σε υπολογιστές ή δρομολογητές, οι επιλύτες εκτελούν την ανάλυση ονομάτων τοπικά και δεν θεωρούνται εξουσιοδοτημένοι.


## Απαρίθμηση

### **Ανάκτηση Μπάνερ**

Δεν υπάρχουν μπάνερ στο DNS, αλλά μπορείτε να ανακτήσετε το μαγικό ερώτημα για `version.bind. CHAOS TXT`, το οποίο θα λειτουργήσει στους περισσότερους διακομιστές ονομάτων BIND.\
Μπορείτε να εκτελέσετε αυτό το ερώτημα χρησιμοποιώντας το `dig`:
```bash
dig version.bind CHAOS TXT @DNS
```
Επιπλέον, το εργαλείο [`fpdns`](https://github.com/kirei/fpdns) μπορεί επίσης να αναγνωρίσει τον διακομιστή.

Είναι επίσης δυνατό να ανακτηθεί το banner και με ένα **nmap** script:
```
--script dns-nsid
```
### **Οποιαδήποτε εγγραφή**

Η εγγραφή **ANY** θα ζητήσει από τον διακομιστή DNS να **επιστρέψει** όλες τις διαθέσιμες **καταχωρήσεις** που **είναι πρόθυμος να αποκαλύψει**.
```bash
dig any victim.com @<DNS_IP>
```
### **Μεταφορά Ζώνης**

Αυτή η διαδικασία είναι γνωστή ως `Ασύγχρονη Πλήρης Μεταφορά Ζώνης` (`AXFR`).
```bash
dig axfr @<DNS_IP> #Try zone transfer without domain
dig axfr @<DNS_IP> <DOMAIN> #Try zone transfer guessing the domain
fierce --domain <DOMAIN> --dns-servers <DNS_IP> #Will try toperform a zone transfer against every authoritative name server and if this doesn'twork, will launch a dictionary attack
```
### Περισσότερες πληροφορίες

Στο επόμενο κεφάλαιο θα εξετάσουμε τεχνικές για την εισβολή σε υπηρεσίες DNS. Οι υπηρεσίες DNS είναι υπεύθυνες για τη μετάφραση των ονομάτων τομέων σε διευθύνσεις IP και αποτελούν σημαντικό στόχο για επιθέσεις. Θα εξετάσουμε πώς να εκμεταλλευτούμε τυχόν ευπάθειες στις υπηρεσίες DNS για να αποκτήσουμε πρόσβαση σε συστήματα ή να προκαλέσουμε διαρροή πληροφοριών. Επίσης, θα εξετάσουμε πώς να εκτελέσουμε επιθέσεις DNS spoofing και DNS cache poisoning για να παραπλανήσουμε τους χρήστες και να αποκτήσουμε πρόσβαση σε ευαίσθητες πληροφορίες. Τέλος, θα εξετάσουμε πώς να εκτελέσουμε επιθέσεις DNS amplification για να προκαλέσουμε αποκλεισμό υπηρεσιών.
```bash
dig ANY @<DNS_IP> <DOMAIN>     #Any information
dig A @<DNS_IP> <DOMAIN>       #Regular DNS request
dig AAAA @<DNS_IP> <DOMAIN>    #IPv6 DNS request
dig TXT @<DNS_IP> <DOMAIN>     #Information
dig MX @<DNS_IP> <DOMAIN>      #Emails related
dig NS @<DNS_IP> <DOMAIN>      #DNS that resolves that name
dig -x 192.168.0.2 @<DNS_IP>   #Reverse lookup
dig -x 2a00:1450:400c:c06::93 @<DNS_IP> #reverse IPv6 lookup

#Use [-p PORT]  or  -6 (to use ivp6 address of dns)
```
#### Αυτοματοποίηση

Η αυτοματοποίηση είναι ένα σημαντικό εργαλείο για τους επαγγελματίες χάκερ κατά τη διάρκεια της διείσδυσης σε συστήματα. Με τη χρήση αυτοματοποιημένων εργαλείων, μπορούν να εκτελεστούν επαναλαμβανόμενες εργασίες μεγάλης κλίμακας με ακρίβεια και ταχύτητα. Αυτό μπορεί να εξοικονομήσει χρόνο και πόρους και να επιτρέψει στον χάκερ να επικεντρωθεί σε πιο προηγμένες επιθέσεις.

Οι εργαλειοθήκες αυτοματοποίησης μπορούν να χρησιμοποιηθούν για την εκτέλεση εργασιών όπως σάρωση δικτύου, εύρεση ευπάθειών, εκτέλεση επιθέσεων και ανάλυση αποτελεσμάτων. Αυτό μπορεί να γίνει με τη χρήση γλωσσών προγραμματισμού, όπως το Python, και τη χρήση εργαλείων αυτοματοποίησης, όπως το Ansible ή το Puppet.

Η αυτοματοποίηση μπορεί να βοηθήσει τους χάκερ να επιτύχουν τους στόχους τους με μεγαλύτερη αποτελεσματικότητα και ακρίβεια. Ωστόσο, είναι σημαντικό να χρησιμοποιείται με προσοχή και να τηρούνται όλες οι νομικές και ηθικές αρχές κατά τη χρήση της.
```bash
for sub in $(cat <WORDLIST>);do dig $sub.<DOMAIN> @<DNS_IP> | grep -v ';\|SOA' | sed -r '/^\s*$/d' | grep $sub | tee -a subdomains.txt;done

dnsenum --dnsserver <DNS_IP> --enum -p 0 -s 0 -o subdomains.txt -f <WORDLIST> <DOMAIN>
```
#### Χρήση της εντολής nslookup

The `nslookup` command is a powerful tool for querying DNS (Domain Name System) servers to obtain information about domain names and IP addresses. It can be used to perform various tasks during the process of network services pentesting. Here are some examples of how to use `nslookup`:

##### Basic Usage

To perform a basic DNS lookup, simply type `nslookup` followed by the domain name or IP address you want to query. For example:

```
nslookup example.com
```

This will return the IP address associated with the domain name `example.com`.

##### Querying Specific DNS Servers

By default, `nslookup` uses the DNS server configured on your system. However, you can specify a different DNS server to query by using the `server` command. For example:

```
nslookup example.com server 8.8.8.8
```

This will query the DNS server at IP address `8.8.8.8` for information about `example.com`.

##### Reverse DNS Lookup

To perform a reverse DNS lookup, where you have an IP address and want to find the associated domain name, use the `-type=PTR` option. For example:

```
nslookup 192.168.1.1 -type=PTR
```

This will return the domain name associated with the IP address `192.168.1.1`.

##### Querying Specific Record Types

By default, `nslookup` queries for the `A` record type, which returns the IP address associated with a domain name. However, you can query for other record types using the `-type` option. For example:

```
nslookup example.com -type=MX
```

This will return the mail exchange (MX) records for the domain `example.com`.

##### Verbose Output

To obtain more detailed information about the DNS query, use the `-debug` option. This will display additional information such as the DNS server being queried and the response received. For example:

```
nslookup example.com -debug
```

This will provide a verbose output of the DNS query for `example.com`.

##### Using a DNS Zone Transfer

In some cases, it may be possible to perform a DNS zone transfer to obtain a list of all the DNS records for a domain. To do this, use the `ls` command followed by the domain name and the DNS server to query. For example:

```
nslookup -ls example.com 8.8.8.8
```

This will attempt a DNS zone transfer for the domain `example.com` from the DNS server at IP address `8.8.8.8`.

These are just a few examples of how to use `nslookup` for DNS-related tasks during network services pentesting. Experiment with different options and commands to explore its full capabilities.
```bash
nslookup
> SERVER <IP_DNS> #Select dns server
> 127.0.0.1 #Reverse lookup of 127.0.0.1, maybe...
> <IP_MACHINE> #Reverse lookup of a machine, maybe...
```
### Χρήσιμα modules του metasploit

Metasploit είναι ένα εργαλείο ασφαλείας που χρησιμοποιείται ευρέως για την εκτέλεση επιθέσεων και την αξιολόγηση της ασφάλειας συστημάτων. Παρακάτω παρουσιάζονται μερικά από τα χρήσιμα modules που παρέχει το metasploit:

- **exploit/multi/handler**: Αυτό το module χρησιμοποιείται για την ακρόαση εισερχόμενων συνδέσεων και την εκτέλεση επιθέσεων.

- **exploit/windows/smb/ms17_010_eternalblue**: Αυτό το module εκμεταλλεύεται μια ευπάθεια στο πρωτόκολλο SMB των Windows γνωστή ως EternalBlue.

- **auxiliary/scanner/portscan/tcp**: Αυτό το module χρησιμοποιείται για τη σάρωση θυρών TCP σε έναν προορισμό.

- **auxiliary/scanner/http/dir_scanner**: Αυτό το module χρησιμοποιείται για την ανίχνευση και την εξαγωγή καταλόγων σε έναν διακομιστή HTTP.

- **post/multi/manage/shell_to_meterpreter**: Αυτό το module μετατρέπει μια κανονική κέλυφο σε μια κέλυφο Meterpreter, παρέχοντας πρόσβαση σε προηγμένες λειτουργίες.

Αυτά είναι μόνο μερικά από τα modules που παρέχονται από το metasploit. Μπορείτε να εξερευνήσετε περισσότερα modules και να τα χρησιμοποιήσετε για να εκτελέσετε επιθέσεις και να αξιολογήσετε την ασφάλεια των συστημάτων.
```bash
auxiliary/gather/enum_dns #Perform enumeration actions
```
### Χρήσιμα scripts του nmap

Το nmap είναι ένα εργαλείο ανοικτού κώδικα που χρησιμοποιείται για τη σάρωση δικτύων και την ανίχνευση ανοιχτών θυρών σε συσκευές. Παρακάτω παρουσιάζονται μερικά χρήσιμα scripts του nmap:

- **dns-brute.nse**: Αυτό το script εκτελεί μια επίθεση brute force στο DNS για να ανακαλύψει υποτομείς και ονόματα κεντρικού υπολογιστή.
- **dns-cache-snoop.nse**: Αυτό το script εκμεταλλεύεται την αδυναμία των DNS servers να προστατεύσουν την προσωρινή μνήμη τους και ανακτά πληροφορίες από την προσωρινή μνήμη του DNS server.
- **dns-zone-transfer.nse**: Αυτό το script εκτελεί μια ζώνη μεταφοράς DNS για να ανακτήσει πληροφορίες για το DNS domain.
- **dns-update.nse**: Αυτό το script εκτελεί μια ενημέρωση DNS για να δοκιμάσει την ευπάθεια του DNS server.
- **dns-random-txid.nse**: Αυτό το script αλλάζει το Transaction ID σε αιτήσεις DNS για να δυσκολέψει την ανίχνευση των επιθέσεων DNS cache poisoning.

Αυτά είναι μερικά από τα χρήσιμα scripts που μπορείτε να χρησιμοποιήσετε με το nmap για να εκτελέσετε δοκιμές ασφαλείας σε υπηρεσίες DNS.
```bash
#Perform enumeration actions
nmap -n --script "(default and *dns*) or fcrdns or dns-srv-enum or dns-random-txid or dns-random-srcport" <IP>
```
### DNS - Αντίστροφη Επίθεση Βρόχου Φόρτισης (Reverse BF)

Η αντίστροφη επίθεση βρόχου φόρτισης (Reverse BF) είναι μια τεχνική επίθεσης που χρησιμοποιείται στο πεντεστινγκ DNS για να ανακτήσει πληροφορίες σχετικά με τον DNS server ενός συστήματος.

Η επίθεση αυτή λειτουργεί εκμεταλλευόμενη την αντίστροφη αναζήτηση DNS, όπου δίνεται μια διεύθυνση IP και αναζητείται ο αντίστοιχος όνομα κεντρικού υπολογιστή. Ο επιτιθέμενος δημιουργεί μια λίστα με διευθύνσεις IP που θέλει να ελέγξει και τις αποστέλλει στον DNS server. Αν ο DNS server απαντήσει με ένα όνομα κεντρικού υπολογιστή, τότε η διεύθυνση IP θεωρείται έγκυρη. Αν ο DNS server απαντήσει με ένα μήνυμα σφάλματος, τότε η διεύθυνση IP θεωρείται μη έγκυρη.

Η αντίστροφη επίθεση βρόχου φόρτισης μπορεί να χρησιμοποιηθεί για να ανακτήσει πληροφορίες σχετικά με τον DNS server, όπως το λειτουργικό σύστημα, την έκδοση του λογισμικού και τις διαθέσιμες υπηρεσίες. Αυτές οι πληροφορίες μπορούν να χρησιμοποιηθούν για να εκμεταλλευτεί ο επιτιθέμενος τυχόν ευπάθειες στον DNS server και να προχωρήσει σε περαιτέρω επιθέσεις.
```bash
dnsrecon -r 127.0.0.0/24 -n <IP_DNS>  #DNS reverse of all of the addresses
dnsrecon -r 127.0.1.0/24 -n <IP_DNS>  #DNS reverse of all of the addresses
dnsrecon -r <IP_DNS>/24 -n <IP_DNS>   #DNS reverse of all of the addresses
dnsrecon -d active.htb -a -n <IP_DNS> #Zone transfer
```
{% hint style="info" %}
Εάν μπορείτε να βρείτε υποτομείς που αντιστοιχούν σε εσωτερικές διευθύνσεις IP, θα πρέπει να προσπαθήσετε να εκτελέσετε έναν αντίστροφο dns BF στους NSs του τομέα που ζητούν αυτήν την περιοχή IP.
{% endhint %}

Ένα άλλο εργαλείο για να το κάνετε αυτό: [https://github.com/amine7536/reverse-scan](https://github.com/amine7536/reverse-scan)

Μπορείτε να ερωτήσετε αντίστροφες περιοχές IP στο [https://bgp.he.net/net/205.166.76.0/24#\_dns](https://bgp.he.net/net/205.166.76.0/24#\_dns) (αυτό το εργαλείο είναι επίσης χρήσιμο με το BGP).

### DNS - Αντίστροφος BF υποτομέων
```bash
dnsenum --dnsserver <IP_DNS> --enum -p 0 -s 0 -o subdomains.txt -f subdomains-1000.txt <DOMAIN>
dnsrecon -D subdomains-1000.txt -d <DOMAIN> -n <IP_DNS>
dnscan -d <domain> -r -w subdomains-1000.txt #Bruteforce subdomains in recursive way, https://github.com/rbsec/dnscan
```
### Διακομιστές Active Directory

Οι διακομιστές Active Directory είναι υπεύθυνοι για τη διαχείριση των υπηρεσιών καταλόγου στο περιβάλλον του Active Directory. Αυτοί οι διακομιστές παρέχουν λειτουργίες όπως η αυθεντικοποίηση χρηστών, η εξουσιοδότηση πρόσβασης και η διαχείριση των αντικειμένων του καταλόγου, όπως χρήστες, ομάδες και υπολογιστές.

Κατά την εκτέλεση ενός penetration test, οι διακομιστές Active Directory μπορούν να αποτελέσουν σημαντικό στόχο για επιθέσεις. Οι επιθέσεις σε αυτούς τους διακομιστές μπορούν να οδηγήσουν σε αποκάλυψη ευαίσθητων πληροφοριών, όπως διαπιστευτήρια χρηστών, και να επιτρέψουν στον εισβολέα να αποκτήσει πρόσβαση σε ευαίσθητα δεδομένα ή να εκτελέσει κακόβουλο κώδικα στο περιβάλλον του Active Directory.

Κατά την αξιολόγηση της ασφάλειας των διακομιστών Active Directory, μπορούν να χρησιμοποιηθούν διάφορες τεχνικές, όπως η εκτέλεση επιθέσεων εξαντλητικής προσπάθειας, η εκμετάλλευση ευπάθειών λογισμικού ή η κλοπή διαπιστευτηρίων χρηστών. Επιπλέον, η ανάλυση της δομής του Active Directory και η εξέταση των ρυθμίσεων ασφαλείας μπορούν να αποκαλύψουν πιθανές ευπάθειες που μπορούν να εκμεταλλευτούν οι επιτιθέμενοι.
```bash
dig -t _gc._tcp.lab.domain.com
dig -t _ldap._tcp.lab.domain.com
dig -t _kerberos._tcp.lab.domain.com
dig -t _kpasswd._tcp.lab.domain.com

nslookup -type=srv _kerberos._tcp.<CLIENT_DOMAIN>
nslookup -type=srv _kerberos._tcp.domain.com

nmap --script dns-srv-enum --script-args "dns-srv-enum.domain='domain.com'"
```
### DNSSec

Το DNSSec (Domain Name System Security Extensions) είναι ένα σύνολο επεκτάσεων ασφαλείας για το πρωτόκολλο Domain Name System (DNS). Ο σκοπός του DNSSec είναι να παρέχει αυθεντικότητα και ακεραιότητα στις απαντήσεις DNS, προστατεύοντας έτσι τους χρήστες από επιθέσεις ψεύτικων ή τροποποιημένων απαντήσεων.

Το DNSSec χρησιμοποιεί ένα σύστημα ψηφιακών υπογραφών για να επιβεβαιώσει την αυθεντικότητα των απαντήσεων DNS. Κάθε DNS απάντηση υπογράφεται με ένα ιδιωτικό κλειδί και η υπογραφή επαληθεύεται με ένα δημόσιο κλειδί που είναι διαθέσιμο στο DNS. Αυτό επιτρέπει στους χρήστες να επιβεβαιώσουν ότι η απάντηση που λαμβάνουν είναι αυθεντική και δεν έχει τροποποιηθεί.

Η εφαρμογή του DNSSec απαιτεί την υποστήριξη από τους DNS servers και τους DNS clients. Οι DNS servers πρέπει να υπογράφουν τις απαντήσεις που παρέχουν, ενώ οι DNS clients πρέπει να επαληθεύουν τις υπογραφές που λαμβάνουν. Εάν η απάντηση δεν είναι υπογεγραμμένη ή η υπογραφή δεν είναι έγκυρη, ο DNS client μπορεί να απορρίψει την απάντηση ή να ειδοποιήσει τον χρήστη για πιθανή επίθεση.

Το DNSSec προσφέρει μια επιπλέον στρώση ασφάλειας στο DNS και μπορεί να προστατεύσει τους χρήστες από επιθέσεις όπως το DNS cache poisoning και το DNS spoofing. Ωστόσο, η εφαρμογή του DNSSec απαιτεί προσεκτική διαχείριση κλειδιών και υποστήριξη από όλους τους συμμετέχοντες στο DNS οικοσύστημα.
```bash
#Query paypal subdomains to ns3.isc-sns.info
nmap -sSU -p53 --script dns-nsec-enum --script-args dns-nsec-enum.domains=paypal.com ns3.isc-sns.info
```
### IPv6

Βίαιη επίθεση χρησιμοποιώντας αιτήσεις "AAAA" για να συλλέξετε τις διευθύνσεις IPv6 των υποτομέων.
```bash
dnsdict6 -s -t <domain>
```
# Βρόχος επίθεσης για αναστροφή DNS με χρήση διευθύνσεων IPv6

Η αναστροφή DNS είναι η διαδικασία με την οποία μετατρέπουμε μια διεύθυνση IP σε ένα όνομα κεντρικού υπολογιστή. Σε αυτό το κεφάλαιο, θα εξετάσουμε την τεχνική της βίαιης επίθεσης για αναστροφή DNS χρησιμοποιώντας διευθύνσεις IPv6.

## Βήμα 1: Συλλογή διευθύνσεων IPv6

Αρχικά, πρέπει να συλλέξουμε διευθύνσεις IPv6 που θα χρησιμοποιήσουμε για την επίθεση. Μπορούμε να το κάνουμε αυτό με διάφορους τρόπους, όπως:

- Αναζήτηση σε δημόσιες βάσεις δεδομένων DNS για διευθύνσεις IPv6.
- Χρήση εργαλείων αναζήτησης διευθύνσεων IPv6, όπως το `ipv6.google.com`.
- Εξερεύνηση δικτύων IPv6 και συλλογή διευθύνσεων από αυτά.

## Βήμα 2: Επίθεση με βίαιη αναστροφή DNS

Αφού συλλέξουμε τις διευθύνσεις IPv6, μπορούμε να προχωρήσουμε στην επίθεση με βίαιη αναστροφή DNS. Αυτό μπορεί να γίνει με τη χρήση εργαλείων όπως το `dnsrecon` ή το `dnsenum`. Αυτά τα εργαλεία θα εκτελέσουν αυτόματα την αναστροφή DNS για κάθε διεύθυνση IPv6 που τους παρέχουμε.

Μετά την εκτέλεση της επίθεσης, θα λάβουμε αποτελέσματα που θα περιέχουν τα αντίστοιχα ονόματα κεντρικού υπολογιστή για κάθε διεύθυνση IPv6. Αυτό μας επιτρέπει να ανακαλύψουμε πιθανές ευπάθειες ή αδυναμίες στο σύστημα.

## Συμπεράσματα

Η βίαιη επίθεση για αναστροφή DNS με χρήση διευθύνσεων IPv6 είναι μια αποτελεσματική τεχνική για την εξερεύνηση και την εκμετάλλευση πιθανών ευπαθειών σε ένα σύστημα. Με τη σωστή συλλογή διευθύνσεων IPv6 και τη χρήση κατάλληλων εργαλείων, μπορούμε να αποκτήσουμε πολύτιμες πληροφορίες και να εντοπίσουμε πιθανές ευπάθειες στο σύστημα.
```bash
dnsrevenum6 pri.authdns.ripe.net 2001:67c:2e8::/48 #Will use the dns pri.authdns.ripe.net
```
### DNS Recursion DDoS

Εάν η **αναδρομή DNS είναι ενεργοποιημένη**, ένας επιτιθέμενος μπορεί να **παραπλανήσει** την **προέλευση** στο πακέτο UDP για να καταστήσει το **DNS να στείλει την απάντηση στον διακομιστή θύμα**. Ένας επιτιθέμενος μπορεί να καταχραστεί τους τύπους εγγραφής **ANY** ή **DNSSEC**, καθώς συνήθως έχουν μεγαλύτερες απαντήσεις.\
Ο τρόπος για να **ελέγξετε** εάν ένα DNS υποστηρίζει **αναδρομή** είναι να ερωτηθεί ένα όνομα τομέα και να **ελεγχθεί** εάν η **σημαία "ra"** (_διαθέσιμη αναδρομή_) υπάρχει στην απάντηση:
```bash
dig google.com A @<IP>
```
**Μη διαθέσιμο**:

![](<../.gitbook/assets/image (275).png>)

**Διαθέσιμο**:

![](<../.gitbook/assets/image (276).png>)

<figure><img src="/.gitbook/assets/image (2).png" alt=""><figcaption></figcaption></figure>

**Άμεσα διαθέσιμη εγκατάσταση για αξιολόγηση ευπαθειών και δοκιμές διείσδυσης**. Εκτελέστε μια πλήρη δοκιμή διείσδυσης από οπουδήποτε με 20+ εργαλεία και χαρακτηριστικά που καλύπτουν από την αναγνώριση έως την αναφορά. Δεν αντικαθιστούμε τους δοκιμαστές διείσδυσης - αναπτύσσουμε προσαρμοσμένα εργαλεία, ανίχνευση και εκμετάλλευση ενοτήτων για να τους δώσουμε λίγο χρόνο για να εξερευνήσουν πιο βαθιά, να αποκτήσουν πρόσβαση σε κέλυφη και να διασκεδάσουν.

{% embed url="https://pentest-tools.com/" %}

### Αποστολή μηνύματος σε μη υπάρχον λογαριασμό

Μέσω της εξέτασης μιας ειδοποίησης μη παράδοσης (NDN) που προκαλείται από ένα email που αποστέλλεται σε μια μη έγκυρη διεύθυνση εντός ενός στόχου τομέα, συχνά αποκαλύπτονται σημαντικές λεπτομέρειες του εσωτερικού δικτύου.

Η παρεχόμενη αναφορά μη παράδοσης περιλαμβάνει πληροφορίες όπως:

- Ο δημιουργικός διακομιστής αναγνωρίστηκε ως `server.example.com`.
- Ένα αποτυχημένο μήνυμα για το `user@example.com` με τον κωδικό σφάλματος `#550 5.1.1 RESOLVER.ADR.RecipNotFound; not found` επεστράφη.
- Εσωτερικές διευθύνσεις IP και ονόματα κεντρικού υπολογιστή αποκαλύφθηκαν στις αρχικές κεφαλίδες του μηνύματος.
```markdown
The original message headers were modified for anonymity and now present randomized data:

Generating server: server.example.com

user@example.com
#550 5.1.1 RESOLVER.ADR.RecipNotFound; not found ##

Original message headers:

Received: from MAILSERVER01.domain.example.com (192.168.1.1) by
mailserver02.domain.example.com (192.168.2.2) with Microsoft SMTP Server (TLS)
id 14.3.174.1; Mon, 25 May 2015 14:52:22 -0700
Received: from filter.example.com (203.0.113.1) by
MAILSERVER01.domain.example.com (192.168.1.1) with Microsoft SMTP Server (TLS)
id 14.3.174.1; Mon, 25 May 2015 14:51:22 -0700
X-ASG-Debug-ID: 1432576343-0614671716190e0d0001-zOQ9WJ
Received: from gateway.domainhost.com (gateway.domainhost.com [198.51.100.37]) by
filter.example.com with ESMTP id xVNPkwaqGgdyH5Ag for user@example.com; Mon,
25 May 2015 14:52:13 -0700 (PDT)
X-Envelope-From: sender@anotherdomain.org
X-Apparent-Source-IP: 198.51.100.37
```
## Αρχεία ρυθμίσεων

Config files are files that contain configuration settings for various network services. These files are often used by system administrators to customize the behavior of the services running on a server. However, they can also be a valuable resource for hackers during a penetration test.

Τα αρχεία ρυθμίσεων είναι αρχεία που περιέχουν ρυθμίσεις για διάφορες υπηρεσίες δικτύου. Αυτά τα αρχεία χρησιμοποιούνται συχνά από τους διαχειριστές συστήματος για να προσαρμόσουν τη συμπεριφορά των υπηρεσιών που εκτελούνται σε ένα διακομιστή. Ωστόσο, μπορούν επίσης να αποτελέσουν μια πολύτιμη πηγή πληροφοριών για χάκερ κατά τη διάρκεια μιας δοκιμής διείσδυσης.

## DNS Config Files

DNS (Domain Name System) config files are specifically used to configure DNS servers. These files contain information about the DNS zones, records, and other settings related to DNS resolution.

Τα αρχεία ρυθμίσεων DNS (Domain Name System) χρησιμοποιούνται ειδικά για τη διαμόρφωση των διακομιστών DNS. Αυτά τα αρχεία περιέχουν πληροφορίες σχετικά με τις ζώνες DNS, τις εγγραφές και άλλες ρυθμίσεις που σχετίζονται με την ανάλυση DNS.

## Location of DNS Config Files

The location of DNS config files can vary depending on the operating system and DNS server software being used. Here are some common locations:

- **BIND**: `/etc/bind/`
- **Microsoft DNS Server**: `%SystemRoot%\System32\DNS\`
- **PowerDNS**: `/etc/powerdns/`
- **dnsmasq**: `/etc/dnsmasq.conf`

Η τοποθεσία των αρχείων ρυθμίσεων DNS μπορεί να διαφέρει ανάλογα με το λειτουργικό σύστημα και το λογισμικό διακομιστή DNS που χρησιμοποιείται. Εδώ είναι μερικές κοινές τοποθεσίες:

- **BIND**: `/etc/bind/`
- **Microsoft DNS Server**: `%SystemRoot%\System32\DNS\`
- **PowerDNS**: `/etc/powerdns/`
- **dnsmasq**: `/etc/dnsmasq.conf`

## Common DNS Config File Settings

DNS config files can contain a variety of settings, but here are some common ones:

- **Zone Configuration**: This section defines the DNS zones and their properties, such as the zone name, type, and file location.
- **Record Configuration**: This section defines the DNS records within each zone, such as A, CNAME, MX, and TXT records.
- **Forwarders**: This setting specifies the IP addresses of other DNS servers to which the DNS server should forward queries it cannot resolve locally.
- **Caching**: This setting determines whether the DNS server should cache DNS responses to improve performance.
- **Logging**: This setting controls the level of logging for DNS server activities, such as queries, updates, and errors.

Τα αρχεία ρυθμίσεων DNS μπορούν να περιέχουν διάφορες ρυθμίσεις, αλλά εδώ είναι μερικές κοινές:

- **Διαμόρφωση ζώνης**: Αυτή η ενότητα καθορίζει τις ζώνες DNS και τις ιδιότητές τους, όπως το όνομα της ζώνης, τον τύπο και την τοποθεσία του αρχείου.
- **Διαμόρφωση εγγραφής**: Αυτή η ενότητα καθορίζει τις εγγραφές DNS εντός κάθε ζώνης, όπως οι εγγραφές A, CNAME, MX και TXT.
- **Προωθητές**: Αυτή η ρύθμιση καθορίζει τις διευθύνσεις IP άλλων διακομιστών DNS στους οποίους ο διακομιστής DNS θα πρέπει να προωθεί ερωτήματα που δεν μπορεί να επιλύσει τοπικά.
- **Προσωρινή αποθήκευση**: Αυτή η ρύθμιση καθορίζει εάν ο διακομιστής DNS θα πρέπει να αποθηκεύει προσωρινά απαντήσεις DNS για να βελτιώσει την απόδοση.
- **Καταγραφή**: Αυτή η ρύθμιση ελέγχει το επίπεδο καταγραφής για τις δραστηριότητες του διακομιστή DNS, όπως ερωτήματα, ενημερώσεις και σφάλματα.
```
host.conf
/etc/resolv.conf
/etc/bind/named.conf
/etc/bind/named.conf.local
/etc/bind/named.conf.options
/etc/bind/named.conf.log
/etc/bind/*
```
Επικίνδυνες ρυθμίσεις κατά την διαμόρφωση ενός διακομιστή Bind:

| **Επιλογή**        | **Περιγραφή**                                                                |
| ----------------- | ------------------------------------------------------------------------------ |
| `allow-query`     | Ορίζει ποιοι υπολογιστές επιτρέπεται να στείλουν αιτήματα στον διακομιστή DNS.            |
| `allow-recursion` | Ορίζει ποιοι υπολογιστές επιτρέπεται να στείλουν αναδρομικά αιτήματα στον διακομιστή DNS.  |
| `allow-transfer`  | Ορίζει ποιοι υπολογιστές επιτρέπεται να λάβουν μεταφορά ζώνης από τον διακομιστή DNS. |
| `zone-statistics` | Συλλέγει στατιστικά δεδομένα των ζωνών.                                            |

## Αναφορές
* [https://www.myrasecurity.com/en/knowledge-hub/dns/](https://www.myrasecurity.com/en/knowledge-hub/dns/)
* Βιβλίο: **Network Security Assessment 3η έκδοση**

## Αυτόματες Εντολές HackTricks
```
Protocol_Name: DNS    #Protocol Abbreviation if there is one.
Port_Number:  53     #Comma separated if there is more than one.
Protocol_Description: Domain Name Service        #Protocol Abbreviation Spelled out

Entry_1:
Name: Notes
Description: Notes for DNS
Note: |
#These are the commands I run every time I see an open DNS port

dnsrecon -r 127.0.0.0/24 -n {IP} -d {Domain_Name}
dnsrecon -r 127.0.1.0/24 -n {IP} -d {Domain_Name}
dnsrecon -r {Network}{CIDR} -n {IP} -d {Domain_Name}
dig axfr @{IP}
dig axfr {Domain_Name} @{IP}
nslookup
SERVER {IP}
127.0.0.1
{IP}
Domain_Name
exit

https://book.hacktricks.xyz/pentesting/pentesting-dns

Entry_2:
Name: Banner Grab
Description: Grab DNS Banner
Command: dig version.bind CHAOS TXT @DNS

Entry_3:
Name: Nmap Vuln Scan
Description: Scan for Vulnerabilities with Nmap
Command: nmap -n --script "(default and *dns*) or fcrdns or dns-srv-enum or dns-random-txid or dns-random-srcport" {IP}

Entry_4:
Name: Zone Transfer
Description: Three attempts at forcing a zone transfer
Command: dig axfr @{IP} && dix axfr @{IP} {Domain_Name} && fierce --dns-servers {IP} --domain {Domain_Name}


Entry_5:
Name: Active Directory
Description: Eunuerate a DC via DNS
Command: dig -t _gc._{Domain_Name} && dig -t _ldap._{Domain_Name} && dig -t _kerberos._{Domain_Name} && dig -t _kpasswd._{Domain_Name} && nmap --script dns-srv-enum --script-args "dns-srv-enum.domain={Domain_Name}"

Entry_6:
Name: consolesless mfs enumeration
Description: DNS enumeration without the need to run msfconsole
Note: sourced from https://github.com/carlospolop/legion
Command: msfconsole -q -x 'use auxiliary/scanner/dns/dns_amp; set RHOSTS {IP}; set RPORT 53; run; exit' && msfconsole -q -x 'use auxiliary/gather/enum_dns; set RHOSTS {IP}; set RPORT 53; run; exit'
```
<figure><img src="/.gitbook/assets/image (2).png" alt=""><figcaption></figcaption></figure>

**Άμεσα διαθέσιμη εγκατάσταση για αξιολόγηση ευπαθειών και δοκιμή διείσδυσης**. Εκτελέστε μια πλήρη δοκιμή διείσδυσης από οπουδήποτε με 20+ εργαλεία και χαρακτηριστικά που καλύπτουν από την αναγνώριση έως την αναφορά. Δεν αντικαθιστούμε τους δοκιμαστές διείσδυσης - αναπτύσσουμε προσαρμοσμένα εργαλεία, ανίχνευση και εκμετάλλευση ενοτήτων για να τους δώσουμε πίσω χρόνο για να εξερευνήσουν πιο βαθιά, να αποκτήσουν πρόσβαση σε συστήματα και να διασκεδάσουν.

{% embed url="https://pentest-tools.com/" %}

<details>

<summary><strong>Μάθετε το hacking στο AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι για να υποστηρίξετε το HackTricks:

* Εάν θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** Ελέγξτε τα [**ΠΑΚΕΤΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**The PEASS Family**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε στη** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Μοιραστείτε τα hacking tricks σας υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>
