# 53 - DNSのペンテスト

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks Cloud ☁️</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>🐦 Twitter 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 Youtube 🎥</strong></a></summary>

* **サイバーセキュリティ企業**で働いていますか？ **HackTricksで会社を宣伝**したいですか？または、**PEASSの最新バージョンにアクセスしたり、HackTricksをPDFでダウンロード**したいですか？[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を見つけてください。独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクションです。
* [**公式のPEASS＆HackTricksのグッズ**](https://peass.creator-spring.com)を手に入れましょう。
* [**💬**](https://emojipedia.org/speech-balloon/) [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**telegramグループ**](https://t.me/peass)に**参加**するか、**Twitter**で**フォロー**してください[**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**。**
* **ハッキングのトリックを共有するには、PRを** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **と** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **に提出してください。**

</details>

<figure><img src="../.gitbook/assets/image (1) (1) (2) (4).png" alt=""><figcaption></figcaption></figure>

[**DragonJAR Security Conference es un evento internacional de ciberseguridad**](https://www.dragonjarcon.org/) con más de una década que se celebrará el 7 y 8 de septiembre de 2023 en Bogotá, Colombia. Es un evento de gran contenido técnico donde se presentan las últimas investigaciones en español que atrae a hackers e investigadores de todo el mundo.\
¡Regístrate ahora en el siguiente enlace y no te pierdas esta gran conferencia!:

{% embed url="https://www.dragonjarcon.org/" %}

## **基本情報**

ドメインネームシステム（DNS）はインターネットの電話帳です。人間はnytimes.comやespn.comのようなドメイン名を通じてオンラインで情報にアクセスします。Webブラウザはインターネットプロトコル（IP）アドレスを介して対話します。DNSはドメイン名を[IPアドレス](https://www.cloudflare.com/learning/dns/glossary/what-is-my-ip-address/)に変換して、ブラウザがインターネットリソースを読み込むことができるようにします。\
[ここから](https://www.cloudflare.com/learning/dns/what-is-dns/)。

**デフォルトポート:** 53
```
PORT     STATE SERVICE  REASON
53/tcp   open  domain  Microsoft DNS 6.1.7601 (1DB15D39) (Windows Server 2008 R2 SP1)
5353/udp open  zeroconf udp-response
53/udp   open  domain  Microsoft DNS 6.1.7601 (1DB15D39) (Windows Server 2008 R2 SP1)
```
### 異なるDNSサーバー

[https://academy.hackthebox.com/module/112/section/1069](https://academy.hackthebox.com/module/112/section/1069)からの情報

| **サーバータイプ**              | **説明**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| ------------------------------ | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `DNSルートサーバー`            | DNSのルートサーバーは、トップレベルドメイン（`TLD`）に対応しています。最後のインスタンスとして、名前サーバーが応答しない場合にのみ要求されます。したがって、ルートサーバーは、ドメインとIPアドレスをリンクするため、ユーザーとインターネット上のコンテンツの間の中央インターフェースです。[インターネット割り当て名前と番号の管理団体](https://www.icann.org/)（`ICANN`）は、ルート名前サーバーの作業を調整しています。世界中には`13`のルートサーバーがあります。 |
| `権威あるネームサーバー`       | 権威あるネームサーバーは、特定のゾーンに対して権限を持っています。彼らは自分の責任範囲からのクエリにのみ応答し、彼らの情報は拘束力があります。権威あるネームサーバーがクライアントのクエリに応答できない場合、ルート名前サーバーがその時点で引き継ぎます。                                                                                                                                                                                                                   |
| `非権威ネームサーバー`           | 非権威ネームサーバーは、特定のDNSゾーンに対して責任を持っていません。代わりに、再帰的または反復的なDNSクエリを使用して、特定のDNSゾーンの情報を自分で収集します。                                                                                                                                                                                                                                                                                                               |
| `キャッシュDNSサーバー`         | キャッシュDNSサーバーは、指定された期間の間、他のネームサーバーからの情報をキャッシュします。このストレージの期間は、権威あるネームサーバーが決定します。                                                                                                                                                                                                                                                                                                                             |
| `フォワーディングサーバー`       | フォワーディングサーバーは、DNSクエリを別のDNSサーバーに転送するだけの機能を持っています。                                                                                                                                                                                                                                                                                                                                                                                            |
| `リゾルバ`                     | リゾルバは権威あるDNSサーバーではありませんが、コンピューターまたはルーター内でローカルに名前解決を実行します。                                                                                                                                                                                                                                                                                                                                                                               |

## 列挙

### **バナーグラビング**

DNSには取得する「バナー」はありません。最も近い相当物は、ほとんどのBINDネームサーバーで機能する`version.bind. CHAOS TXT`のマジッククエリです。\
`dig`を使用してこのクエリを実行できます：
```bash
dig version.bind CHAOS TXT @DNS
```
もし上手くいかない場合は、指紋認識技術を使用してリモートサーバーのバージョンを特定することができます。[`fpdns`](https://github.com/kirei/fpdns)ツールはその1つのオプションですが、他にもあります。

また、**nmap**スクリプトでもバナーを取得することができます。
```
--script dns-nsid
```
### **任意のレコード**

レコード**ANY**は、DNSサーバーに対して、**開示する意思のある**すべての利用可能な**エントリ**を**返すように要求**します。
```bash
dig any victim.com @<DNS_IP>
```
### **ゾーン転送**

この手続きは`非同期フル転送ゾーン` (`AXFR`)と略されます。
```bash
dig axfr @<DNS_IP> #Try zone transfer without domain
dig axfr @<DNS_IP> <DOMAIN> #Try zone transfer guessing the domain
fierce --domain <DOMAIN> --dns-servers <DNS_IP> #Will try toperform a zone transfer against every authoritative name server and if this doesn'twork, will launch a dictionary attack
```
## DNSペンテスト

DNS（Domain Name System）は、インターネット上でドメイン名をIPアドレスに変換するためのシステムです。DNSは、Webサイトや電子メールなどのネットワークサービスの正常な動作に不可欠な役割を果たしています。DNSペンテストは、システムのセキュリティを評価するために行われるプロセスです。

DNSペンテストの目的は、以下のような脆弱性を特定することです。

- ゾーン転送の許可
- ゾーンの不正な登録
- ゾーンの不正な変更
- ゾーンの不正な削除
- ゾーンの情報漏洩
- ゾーンのDNSキャッシュポイズニング
- ゾーンのDNS応答の改ざん

DNSペンテストは、以下の手法を使用して実施されます。

1. ゾーン転送のテスト：ゾーン転送が許可されているかどうかを確認します。ゾーン転送が許可されている場合、攻撃者はゾーンの情報を取得し、システムに対する攻撃を計画することができます。

2. ゾーンの登録情報の確認：登録されているゾーンの情報を確認し、不正な登録がないかどうかを確認します。不正な登録がある場合、攻撃者はゾーンの情報を改ざんし、システムに対する攻撃を行うことができます。

3. ゾーンの変更のテスト：ゾーンの変更が正しく制限されているかどうかを確認します。ゾーンの変更が制限されていない場合、攻撃者はゾーンの情報を改ざんし、システムに対する攻撃を行うことができます。

4. ゾーンの削除のテスト：ゾーンの削除が正しく制限されているかどうかを確認します。ゾーンの削除が制限されていない場合、攻撃者はゾーンを削除し、システムに対する攻撃を行うことができます。

5. DNSキャッシュポイズニングのテスト：DNSキャッシュポイズニング攻撃を実施し、ゾーンの情報を改ざんすることができるかどうかを確認します。攻撃者は、キャッシュポイズニングを利用して、ユーザーを誤ったWebサイトに誘導することができます。

6. DNS応答の改ざんのテスト：DNS応答の改ざん攻撃を実施し、ゾーンの情報を改ざんすることができるかどうかを確認します。攻撃者は、改ざんされたDNS応答を利用して、ユーザーを誤ったWebサイトに誘導することができます。

DNSペンテストは、システムのセキュリティを向上させるために重要な手法です。正確なテストと適切な対策を実施することで、DNSに関連する脆弱性を特定し、それに対する適切な対策を講じることができます。
```bash
dig ANY @<DNS_IP> <DOMAIN>     #Any information
dig A @<DNS_IP> <DOMAIN>       #Regular DNS request
dig AAAA @<DNS_IP> <DOMAIN>    #IPv6 DNS request
dig TXT @<DNS_IP> <DOMAIN>     #Information
dig MX @<DNS_IP> <DOMAIN>      #Emails related
dig NS @<DNS_IP> <DOMAIN>      #DNS that resolves that name
dig -x 192.168.0.2 @<DNS_IP>   #Reverse lookup
dig -x 2a00:1450:400c:c06::93 @<DNS_IP> #reverse IPv6 lookup

#Use [-p PORT]  or  -6 (to use ivp6 address of dns)
```
#### 自動化

Automation plays a crucial role in the field of network services pentesting. It helps in streamlining and accelerating the process of identifying vulnerabilities and exploiting them. By automating certain tasks, pentesters can save time and effort, allowing them to focus on more complex and critical aspects of the assessment.

自動化は、ネットワークサービスのペントestingの分野で重要な役割を果たしています。脆弱性の特定とそれらの悪用のプロセスを効率化し、加速するのに役立ちます。特定のタスクを自動化することで、ペントesterは時間と労力を節約し、評価のより複雑で重要な側面に集中することができます。
```bash
for sub in $(cat <WORDLIST>);do dig $sub.<DOMAIN> @<DNS_IP> | grep -v ';\|SOA' | sed -r '/^\s*$/d' | grep $sub | tee -a subdomains.txt;done

dnsenum --dnsserver <DNS_IP> --enum -p 0 -s 0 -o subdomains.txt -f <WORDLIST> <DOMAIN>
```
#### nslookupの使用

The `nslookup` command is a commonly used tool for querying DNS (Domain Name System) servers to obtain information about domain names and IP addresses. It is available on most operating systems, including Windows, macOS, and Linux.

To use `nslookup`, open a command prompt or terminal and type `nslookup` followed by the domain name or IP address you want to query. Press Enter to execute the command.

For example, to obtain the IP address of a domain name, you can type:

```
nslookup example.com
```

This will display the IP address associated with the domain name `example.com`, along with other information such as the DNS server that provided the response.

You can also perform reverse DNS lookups by providing an IP address instead of a domain name. For example:

```
nslookup 192.168.0.1
```

This will display the domain name associated with the IP address `192.168.0.1`, if available.

`nslookup` also provides additional options and commands that can be used to customize the query and obtain more detailed information. To view the available options, type `nslookup` followed by the `-h` flag:

```
nslookup -h
```

This will display a list of available commands and their descriptions.

By using `nslookup`, you can gather valuable information about DNS records and troubleshoot DNS-related issues during the penetration testing process.
```bash
nslookup
> SERVER <IP_DNS> #Select dns server
> 127.0.0.1 #Reverse lookup of 127.0.0.1, maybe...
> <IP_MACHINE> #Reverse lookup of a machine, maybe...
```
### 便利なMetasploitモジュール

Metasploitは、さまざまなネットワークサービスの脆弱性を検出し、攻撃するための強力なツールです。以下に、特に役立ついくつかのMetasploitモジュールを紹介します。

#### 1. `auxiliary/scanner/dns/dns_enum`

このモジュールは、DNSサーバーに対してドメイン名の列挙を行います。ドメイン名の列挙は、ターゲットのネットワーク内の有効なドメイン名を特定するために使用されます。これにより、攻撃者はターゲットのネットワークに関する重要な情報を収集することができます。

#### 2. `auxiliary/scanner/dns/dns_recon`

このモジュールは、DNSサーバーに対して情報収集を行います。具体的には、DNSゾーン転送の有効化やDNSキャッシュポイズニングの可能性など、潜在的な脆弱性を特定します。これにより、攻撃者はDNSサーバーを悪用して、ターゲットのネットワークに侵入することができます。

#### 3. `auxiliary/scanner/dns/dns_bruteforce`

このモジュールは、DNSサーバーに対してブルートフォース攻撃を行います。ブルートフォース攻撃は、辞書やパターンを使用してドメイン名を推測し、有効なドメイン名を特定するために使用されます。これにより、攻撃者はターゲットのネットワークに対して有効な攻撃手法を見つけることができます。

#### 4. `auxiliary/scanner/dns/dns_cache_snoop`

このモジュールは、DNSキャッシュスヌーピングを行います。DNSキャッシュスヌーピングは、ターゲットのネットワーク内のDNSキャッシュから情報を収集するために使用されます。これにより、攻撃者はターゲットのネットワークに関する重要な情報を入手することができます。

これらのMetasploitモジュールは、DNSサービスのペンテストにおいて非常に役立つツールです。ただし、法的な制約と倫理的な考慮事項に留意しながら使用する必要があります。
```bash
auxiliary/gather/enum_dns #Perform enumeration actions
```
### 便利なnmapスクリプト

Nmapスクリプトは、ネットワークサービスのペンテストにおいて非常に役立つツールです。以下にいくつかの便利なnmapスクリプトを紹介します。

- **dns-brute.nse**: このスクリプトは、DNSサーバーに対してブルートフォース攻撃を実行します。DNSゾーンの情報を収集し、ホスト名やサブドメインを特定するのに役立ちます。

- **dns-cache-snoop.nse**: このスクリプトは、DNSキャッシュの情報をスヌーピングするために使用されます。キャッシュポイズニングの脆弱性を特定するのに役立ちます。

- **dns-zone-transfer.nse**: このスクリプトは、DNSゾーン転送の脆弱性を特定するために使用されます。攻撃者がDNSゾーンの情報を取得するのに役立ちます。

- **dns-blacklist.nse**: このスクリプトは、DNSブラックリストにドメインが登録されているかどうかを確認するために使用されます。ドメインがブラックリストに登録されている場合、悪意のある活動の可能性が高いです。

これらのスクリプトは、ネットワークサービスのペンテストにおいてDNSサーバーのセキュリティを評価するのに役立ちます。
```bash
#Perform enumeration actions
nmap -n --script "(default and *dns*) or fcrdns or dns-srv-enum or dns-random-txid or dns-random-srcport" <IP>
```
### DNS - 逆ブルートフォース攻撃

#### 概要

逆ブルートフォース攻撃は、DNSサーバーに対して行われる一種の攻撃です。この攻撃では、攻撃者は特定のドメイン名に対して、可能なすべてのIPアドレスを試行し、そのドメイン名に関連付けられたIPアドレスを特定します。

#### 攻撃手法

逆ブルートフォース攻撃は、以下の手順で実行されます。

1. 攻撃者は、対象のドメイン名を特定します。
2. 攻撃者は、ドメイン名に関連付けられたIPアドレスの範囲を特定します。
3. 攻撃者は、特定されたIPアドレスの範囲内のすべてのIPアドレスを試行します。
4. 攻撃者は、正しいIPアドレスを特定するために、DNS応答を監視します。
5. 攻撃者は、正しいIPアドレスを特定した後、そのIPアドレスを悪意のある目的で使用することができます。

#### 対策方法

逆ブルートフォース攻撃から保護するためには、以下の対策を実施することが重要です。

1. DNSサーバーのセキュリティを強化します。DNSサーバーには最新のセキュリティパッチを適用し、適切な設定を行います。
2. IPアドレスの範囲を制限します。DNSサーバーは、特定のIPアドレス範囲からのリクエストのみを受け付けるように設定することができます。
3. ブルートフォース攻撃を検知するための監視システムを導入します。異常なトラフィックや短期間における多数のリクエストを検知することができます。

以上が逆ブルートフォース攻撃に関する概要と対策方法です。
```bash
dnsrecon -r 127.0.0.0/24 -n <IP_DNS>  #DNS reverse of all of the addresses
dnsrecon -r 127.0.1.0/24 -n <IP_DNS>  #DNS reverse of all of the addresses
dnsrecon -r <IP_DNS>/24 -n <IP_DNS>   #DNS reverse of all of the addresses
dnsrecon -d active.htb -a -n <IP_DNS> #Zone transfer
```
{% hint style="info" %}
内部IPアドレスに解決するサブドメインを見つけることができれば、そのIP範囲を問い合わせるために、ドメインのNSに対して逆DNS BFを実行してみるべきです。
{% endhint %}

これを行うための別のツール：[https://github.com/amine7536/reverse-scan](https://github.com/amine7536/reverse-scan)

逆IP範囲を問い合わせるために、[https://bgp.he.net/net/205.166.76.0/24#\_dns](https://bgp.he.net/net/205.166.76.0/24#\_dns)を使用することもできます（このツールはBGPでも役立ちます）。

### DNS - サブドメインBF
```bash
dnsenum --dnsserver <IP_DNS> --enum -p 0 -s 0 -o subdomains.txt -f subdomains-1000.txt <DOMAIN>
dnsrecon -D subdomains-1000.txt -d <DOMAIN> -n <IP_DNS>
dnscan -d <domain> -r -w subdomains-1000.txt #Bruteforce subdomains in recursive way, https://github.com/rbsec/dnscan
```
### Active Directory サーバー

Active Directory（AD）サーバーは、Windowsベースのネットワーク環境で使用されるディレクトリサービスです。ADサーバーは、ユーザーアカウント、グループ、コンピュータ、およびその他のネットワークリソースの管理を担当します。ADサーバーは、ユーザー認証、アクセス制御、およびセキュリティポリシーの実施にも使用されます。

ADサーバーのペンテストでは、以下のような攻撃手法が使用されます。

- ユーザーアカウントの総当たり攻撃（ブルートフォース攻撃）：一連のパスワードを試し、有効なユーザーアカウントを特定します。
- パスワードのハッシュの盗み出し：パスワードハッシュを取得し、オフラインで解析して有効なパスワードを特定します。
- Kerberosチケットの盗み出し：Kerberos認証プロトコルを使用してユーザーが認証される際に生成されるチケットを盗み出します。
- ユーザーアカウントの権限昇格：特権ユーザーアカウントになりすまして、システム内の機密情報にアクセスします。

ADサーバーのセキュリティを確保するためには、強力なパスワードポリシーの実施、アカウントロックアウトの有効化、不要なユーザーアカウントの削除などの対策が必要です。また、最新のセキュリティパッチの適用やログ監視も重要です。
```
dig -t _gc._tcp.lab.domain.com
dig -t _ldap._tcp.lab.domain.com
dig -t _kerberos._tcp.lab.domain.com
dig -t _kpasswd._tcp.lab.domain.com
nmap --script dns-srv-enum --script-args "dns-srv-enum.domain='domain.com'"
```
DNSSec（Domain Name System Security Extensions）は、DNS（Domain Name System）プロトコルのセキュリティを強化するための拡張機能です。DNSSecは、DNS応答の信頼性と完全性を確保するために使用されます。

DNSSecは、以下の主なセキュリティ上の脆弱性を解決するために設計されています。

1. DNSキャッシュポイズニング：攻撃者がDNSキャッシュに偽の情報を注入することにより、ユーザーを誤ったウェブサイトに誘導する攻撃手法です。DNSSecは、デジタル署名を使用してDNS応答の信頼性を確保し、キャッシュポイズニング攻撃を防ぎます。

2. DNSハイジャッキング：攻撃者がDNS応答を改ざんし、ユーザーを攻撃者の制御下にあるウェブサイトに誘導する攻撃手法です。DNSSecは、デジタル署名を使用してDNS応答の完全性を確保し、ハイジャッキング攻撃を防ぎます。

DNSSecは、公開鍵暗号を使用してデジタル署名を生成し、DNSレコードに関連付けます。これにより、DNS応答の信頼性と完全性を確保することができます。また、DNSSecは、DNSネームサーバーとDNSクライアントの両方がDNSSecをサポートしている必要があります。

DNSSecの実装には、DNSサーバーの設定変更と鍵管理が必要です。また、DNSSecは、DNS応答の署名と検証に追加の計算リソースを必要とするため、パフォーマンスへの影響も考慮する必要があります。

DNSSecは、DNSのセキュリティを向上させるための重要なツールです。セキュリティ意識の高い組織は、DNSSecを実装して、DNS攻撃からの保護を強化することが推奨されています。
```bash
#Query paypal subdomains to ns3.isc-sns.info
nmap -sSU -p53 --script dns-nsec-enum --script-args dns-nsec-enum.domains=paypal.com ns3.isc-sns.info
```
### IPv6

"AAAA"リクエストを使用して、サブドメインのIPv6を収集するためのブルートフォース攻撃。
```bash
dnsdict6 -s -t <domain>
```
# IPv6アドレスを使用して逆DNSのブルートフォース攻撃

逆DNSブルートフォース攻撃は、IPv6アドレスを使用してネットワークサービスの脆弱性を特定するための効果的な手法です。この攻撃では、IPv6アドレスの範囲を網羅的にスキャンし、逆DNSレコードを特定します。

以下は、逆DNSブルートフォース攻撃の手順です。

1. ブルートフォース攻撃のためのIPv6アドレスの範囲を特定します。これには、ネットワークのIPv6アドレス範囲を調査する必要があります。

2. 特定したIPv6アドレス範囲を対象に、逆DNSレコードのブルートフォース攻撃を実行します。これには、ツールやスクリプトを使用することができます。

3. ブルートフォース攻撃によって特定された逆DNSレコードを分析し、脆弱性やセキュリティ上の問題を特定します。これには、不正な逆DNSレコードやセキュリティ設定の欠陥などが含まれます。

逆DNSブルートフォース攻撃は、ネットワークサービスのセキュリティ評価や脆弱性診断において重要な手法です。ただし、攻撃者は法的な制約や倫理的な考慮事項に留意する必要があります。
```bash
dnsrevenum6 pri.authdns.ripe.net 2001:67c:2e8::/48 #Will use the dns pri.authdns.ripe.net
```
### DNS再帰DDoS

DNS再帰が有効になっている場合、攻撃者はUDPパケットの**送信元**を**偽装**することで、DNSが応答を被害者サーバーに送信するようにすることができます。攻撃者は、**ANY**または**DNSSEC**レコードタイプを悪用することができます。これらは通常、より大きな応答を持っています。

DNSが再帰をサポートしているかどうかを**確認**する方法は、ドメイン名をクエリし、応答に**フラグ "ra"**（再帰利用可能）が含まれているかどうかを**確認**することです。
```bash
dig google.com A @<IP>
```
**利用できない**:

![](<../.gitbook/assets/image (275).png>)

**利用可能**:

![](<../.gitbook/assets/image (276).png>)

<figure><img src="../.gitbook/assets/image (1) (1) (2) (4).png" alt=""><figcaption></figcaption></figure>

[**DragonJAR Security Conferenceは国際的なサイバーセキュリティイベント**](https://www.dragonjarcon.org/)であり、2023年9月7日から8日までコロンビアのボゴタで開催されます。このイベントは、スペイン語で最新の研究が発表される技術的な内容の高いイベントであり、世界中のハッカーや研究者を惹きつけています。
以下のリンクから今すぐ登録し、この素晴らしいカンファレンスをお見逃しなく！:

{% embed url="https://www.dragonjarcon.org/" %}

### 存在しないアカウントへのメール

書籍: ネットワークセキュリティアセスメント（第3版）

ターゲットドメインの存在しないアドレスに単純にメールメッセージを送信するだけでも、_配信不能通知_（NDN）を通じて有用な内部ネットワーク情報が明らかになることがあります。
```
Generating server: noa.nintendo.com

blah@nintendo.com
#550 5.1.1 RESOLVER.ADR.RecipNotFound; not found ##

Original message headers:

Received: from ONERDEDGE02.one.nintendo.com (10.13.20.35) by
onerdexch08.one.nintendo.com (10.13.30.39) with Microsoft SMTP Server (TLS)
id 14.3.174.1; Sat, 26 Apr 2014 16:52:22 -0700
Received: from barracuda.noa.nintendo.com (205.166.76.35) by
ONERDEDGE02.one.nintendo.com (10.13.20.35) with Microsoft SMTP Server (TLS)
id 14.3.174.1; Sat, 26 Apr 2014 16:51:22 -0700
X-ASG-Debug-ID: 1398556333-0614671716199b0d0001-zOQ9WJ
Received: from gateway05.websitewelcome.com (gateway05.websitewelcome.com  [69.93.154.37]) by
barracuda.noa.nintendo.com with ESMTP id xVNPkwaqGgdyH5Ag for <blah@nintendo.com>; Sat,
26 Apr 2014 16:52:13 -0700 (PDT)
X-Barracuda-Envelope-From: chris@example.org
X-Barracuda-Apparent-Source-IP: 69.93.154.37
```
以下のトランスクリプトのデータは有用です：

* 内部ホスト名、IPアドレス、およびサブドメインのレイアウト
* メールサーバーはMicrosoft Exchange Server 2010 SP3を実行しています
* Barracuda Networksデバイスを使用してコンテンツフィルタリングを実行しています

## 設定ファイル
```
host.conf
/etc/resolv.conf
/etc/bind/named.conf
/etc/bind/named.conf.local
/etc/bind/named.conf.options
/etc/bind/named.conf.log
/etc/bind/*
```
Bindサーバーを設定する際の危険な設定:

| **オプション**        | **説明**                                                                |
| ----------------- | ------------------------------------------------------------------------------ |
| `allow-query`     | DNSサーバーにリクエストを送信することを許可するホストを定義します。            |
| `allow-recursion` | DNSサーバーに再帰的なリクエストを送信することを許可するホストを定義します。  |
| `allow-transfer`  | DNSサーバーからゾーン転送を受け取ることを許可するホストを定義します。 |
| `zone-statistics` | ゾーンの統計データを収集します。                                            |

## HackTricks自動コマンド
```
Protocol_Name: DNS    #Protocol Abbreviation if there is one.
Port_Number:  53     #Comma separated if there is more than one.
Protocol_Description: Domain Name Service        #Protocol Abbreviation Spelled out

Entry_1:
Name: Notes
Description: Notes for DNS
Note: |
#These are the commands I run every time I see an open DNS port

dnsrecon -r 127.0.0.0/24 -n {IP} -d {Domain_Name}
dnsrecon -r 127.0.1.0/24 -n {IP} -d {Domain_Name}
dnsrecon -r {Network}{CIDR} -n {IP} -d {Domain_Name}
dig axfr @{IP}
dig axfr {Domain_Name} @{IP}
nslookup
SERVER {IP}
127.0.0.1
{IP}
Domain_Name
exit

https://book.hacktricks.xyz/pentesting/pentesting-dns

Entry_2:
Name: Banner Grab
Description: Grab DNS Banner
Command: dig version.bind CHAOS TXT @DNS

Entry_3:
Name: Nmap Vuln Scan
Description: Scan for Vulnerabilities with Nmap
Command: nmap -n --script "(default and *dns*) or fcrdns or dns-srv-enum or dns-random-txid or dns-random-srcport" {IP}

Entry_4:
Name: Zone Transfer
Description: Three attempts at forcing a zone transfer
Command: dig axfr @{IP} && dix axfr @{IP} {Domain_Name} && fierce --dns-servers {IP} --domain {Domain_Name}


Entry_5:
Name: Active Directory
Description: Eunuerate a DC via DNS
Command: dig -t _gc._{Domain_Name} && dig -t _ldap._{Domain_Name} && dig -t _kerberos._{Domain_Name} && dig -t _kpasswd._{Domain_Name} && nmap --script dns-srv-enum --script-args "dns-srv-enum.domain={Domain_Name}"

Entry_6:
Name: consolesless mfs enumeration
Description: DNS enumeration without the need to run msfconsole
Note: sourced from https://github.com/carlospolop/legion
Command: msfconsole -q -x 'use auxiliary/scanner/dns/dns_amp; set RHOSTS {IP}; set RPORT 53; run; exit' && msfconsole -q -x 'use auxiliary/gather/enum_dns; set RHOSTS {IP}; set RPORT 53; run; exit'
```
<figure><img src="../.gitbook/assets/image (1) (1) (2) (4).png" alt=""><figcaption></figcaption></figure>

[**DragonJAR Security Conferenceは国際的なサイバーセキュリティイベント**](https://www.dragonjarcon.org/)で、2023年9月7日から8日までコロンビアのボゴタで開催されます。このイベントは、スペイン語で最新の研究が発表される技術的な内容の高いイベントであり、世界中のハッカーや研究者を惹きつけています。
以下のリンクから今すぐ登録し、この素晴らしいカンファレンスをお見逃しなく！:

{% embed url="https://www.dragonjarcon.org/" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks Cloud ☁️</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>🐦 Twitter 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 Youtube 🎥</strong></a></summary>

* **サイバーセキュリティ企業で働いていますか？** **HackTricksで会社を宣伝**したいですか？または、**PEASSの最新バージョンにアクセスしたり、HackTricksをPDFでダウンロード**したいですか？[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)をご覧ください。独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクションです。
* [**公式のPEASS＆HackTricksグッズ**](https://peass.creator-spring.com)を手に入れましょう。
* [**💬**](https://emojipedia.org/speech-balloon/) [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**telegramグループ**](https://t.me/peass)に**参加**するか、**Twitter**で**フォロー**してください[**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **ハッキングのトリックを共有するには、**[**hacktricks repo**](https://github.com/carlospolop/hacktricks) **と** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **にPRを提出してください。**

</details>
