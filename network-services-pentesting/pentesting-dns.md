# 53 - Pentesting DNS

<details>

<summary><strong>Leer AWS-hacking van nul tot held met</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Ander maniere om HackTricks te ondersteun:

* As jy jou **maatskappy geadverteer wil sien in HackTricks** of **HackTricks in PDF wil aflaai**, kyk na die [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Kry die [**amptelike PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ontdek [**The PEASS Family**](https://opensea.io/collection/the-peass-family), ons versameling eksklusiewe [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Deel jou hacktruuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-repos.

</details>

<figure><img src="/.gitbook/assets/image (2).png" alt=""><figcaption></figcaption></figure>

**Onmiddellik beskikbare opset vir kwesbaarheidsassessering en penetrasietoetsing**. Voer 'n volledige pentest uit van enige plek met 20+ gereedskap en funksies wat strek van rekognisering tot verslagdoening. Ons vervang nie pentesters nie - ons ontwikkel aangepaste gereedskap, opsporings- en uitbuitingsmodules om hulle 'n bietjie tyd terug te gee om dieper te graaf, skulpe te kraak en pret te h√™.

{% embed url="https://pentest-tools.com/" %}

## **Basiese Inligting**

Die **Domain Name System (DNS)** dien as die internet se gids, wat gebruikers in staat stel om webwerwe te besoek deur middel van **maklik onthoudbare domeinname** soos google.com of facebook.com, in plaas van die numeriese Internet Protocol (IP)-adresse. Deur domeinnamen na IP-adresse te vertaal, verseker die DNS dat webblaaie vinnig internetbronne kan laai, wat vereenvoudig hoe ons deur die aanlynw√™reld navigeer.

**Verstekpoort:** 53
```
PORT     STATE SERVICE  REASON
53/tcp   open  domain  Microsoft DNS 6.1.7601 (1DB15D39) (Windows Server 2008 R2 SP1)
5353/udp open  zeroconf udp-response
53/udp   open  domain  Microsoft DNS 6.1.7601 (1DB15D39) (Windows Server 2008 R2 SP1)
```
### Verskillende DNS-bediener

- **DNS-wortelbedieners**: Hierdie bedieners is bo-aan die DNS-hierargie en bestuur die topvlakdomeine en tree slegs op as laervlakbedieners nie reageer nie. Die Internet Corporation for Assigned Names and Numbers (**ICANN**) hou toesig oor hul werking, met 'n w√™reldwye telling van 13.

- **Gesaghebbende Naambediener**: Hierdie bedieners het die finale s√™ oor navrae in hul aangewese areas en bied definitiewe antwoorde. As hulle nie 'n antwoord kan gee nie, word die navraag na die wortelbedieners ge√´skaleer.

- **Nie-gesaghebbende Naambediener**: Sonder eienaarskap oor DNS-areas, versamel hierdie bedieners domeininligting deur navrae aan ander bedieners.

- **Caching DNS-bedieners**: Hierdie tipe bediener onthou vorige navraagantwoorde vir 'n bepaalde tyd om responstye vir toekomstige versoeke te versnel, met die kestoestyd bepaal deur die gesaghebbende bediener.

- **Deurverwysingsbediener**: Deurverwysingsbedieners stuur eenvoudig navrae na 'n ander bediener.

- **Oplosser**: Ge√Øntegreer binne rekenaars of roeternavorsers voer oplossers plaaslike naamoplossing uit en word nie as gesaghebbend beskou.


## Opname

### **Banner Grabbing**

Daar is nie baniers in DNS nie, maar jy kan die magiese navraag vir `version.bind. CHAOS TXT` gryp wat op die meeste BIND-naambediener sal werk.\
Jy kan hierdie navraag uitvoer met behulp van `dig`:
```bash
dig version.bind CHAOS TXT @DNS
```
Daarbenewens kan die instrument [`fpdns`](https://github.com/kirei/fpdns) ook die bediener se vingerafdruk bepaal.

Dit is ook moontlik om die banier te gryp met 'n **nmap** skrip:
```
--script dns-nsid
```
### **Enige rekord**

Die rekord **ENIGE** sal die DNS-bediener vra om **alle beskikbare inskrywings** wat **dit bereid is om bekend te maak**, terug te gee.
```bash
dig any victim.com @<DNS_IP>
```
### **Sone-oordrag**

Hierdie prosedure word afgekort as `Asynchrone Volle Oordrag Zone` (`AXFR`).
```bash
dig axfr @<DNS_IP> #Try zone transfer without domain
dig axfr @<DNS_IP> <DOMAIN> #Try zone transfer guessing the domain
fierce --domain <DOMAIN> --dns-servers <DNS_IP> #Will try toperform a zone transfer against every authoritative name server and if this doesn'twork, will launch a dictionary attack
```
### Meer inligting
```bash
dig ANY @<DNS_IP> <DOMAIN>     #Any information
dig A @<DNS_IP> <DOMAIN>       #Regular DNS request
dig AAAA @<DNS_IP> <DOMAIN>    #IPv6 DNS request
dig TXT @<DNS_IP> <DOMAIN>     #Information
dig MX @<DNS_IP> <DOMAIN>      #Emails related
dig NS @<DNS_IP> <DOMAIN>      #DNS that resolves that name
dig -x 192.168.0.2 @<DNS_IP>   #Reverse lookup
dig -x 2a00:1450:400c:c06::93 @<DNS_IP> #reverse IPv6 lookup

#Use [-p PORT]  or  -6 (to use ivp6 address of dns)
```
#### Outomatisering

Autmation is a key aspect of efficient and effective hacking. By automating repetitive tasks, hackers can save time and increase productivity. There are various tools and techniques available for automating different aspects of the hacking process.

Outomatisering is 'n sleutelaspek van doeltreffende en effektiewe hakwerk. Deur herhalende take te outomatiseer, kan hakkers tyd bespaar en produktiwiteit verhoog. Daar is verskeie hulpmiddels en tegnieke beskikbaar om verskillende aspekte van die hakproses te outomatiseer.

#### DNS Reconnaissance

DNS reconnaissance is an important phase in the hacking process. It involves gathering information about the target's DNS infrastructure, such as the domain name, IP addresses, and DNS records. This information can be used to identify potential vulnerabilities and attack vectors.

DNS-verkenning is 'n belangrike fase in die hakproses. Dit behels die versameling van inligting oor die teiken se DNS-infrastruktuur, soos die domeinnaam, IP-adresse en DNS-rekords. Hierdie inligting kan gebruik word om potensi√´le kwesbaarhede en aanvalsvektore te identifiseer.

#### DNS Zone Transfer

DNS zone transfer is a mechanism that allows the replication of DNS data across multiple DNS servers. It can be exploited by hackers to gather valuable information about the target's DNS infrastructure. By requesting a zone transfer, an attacker can obtain a complete copy of the target's DNS records, including subdomains and associated IP addresses.

DNS-sone-oordrag is 'n meganisme wat die replikasie van DNS-data oor verskeie DNS-bedieners moontlik maak. Dit kan deur hakkers uitgebuit word om waardevolle inligting oor die teiken se DNS-infrastruktuur te versamel. Deur 'n sone-oordrag aan te vra, kan 'n aanvaller 'n volledige kopie van die teiken se DNS-rekords verkry, insluitend subdomeine en geassosieerde IP-adresse.

#### DNS Cache Poisoning

DNS cache poisoning is a technique used by hackers to manipulate the DNS cache of a target's DNS server. By injecting malicious DNS records into the cache, an attacker can redirect traffic to a malicious website or intercept sensitive information. This technique can be used to launch phishing attacks or perform man-in-the-middle attacks.

DNS-kasvergiftiging is 'n tegniek wat deur hakkers gebruik word om die DNS-kas van 'n teiken se DNS-bediener te manipuleer. Deur kwaadwillige DNS-rekords in die kas in te spuit, kan 'n aanvaller verkeer na 'n kwaadwillige webwerf omskakel of sensitiewe inligting onderskep. Hierdie tegniek kan gebruik word om hengelaanvalle te lanceer of man-in-die-middel-aanvalle uit te voer.

#### DNS Amplification Attack

A DNS amplification attack is a type of DDoS attack that leverages the large response size of DNS queries to overwhelm a target's network infrastructure. By sending a small DNS query with a spoofed source IP address, an attacker can trick the DNS server into sending a much larger response to the target's IP address. This can result in a significant increase in network traffic, causing the target's network to become unresponsive.

'n DNS-versterkingsaanval is 'n tipe DDoS-aanval wat gebruik maak van die groot responsie-grootte van DNS-navrae om 'n teiken se netwerkinfrastruktuur te oorweldig. Deur 'n klein DNS-navraag met 'n vervalsde bron-IP-adres te stuur, kan 'n aanvaller die DNS-bediener mislei om 'n baie groter responsie na die teiken se IP-adres te stuur. Dit kan lei tot 'n aansienlike toename in netwerkverkeer, wat veroorsaak dat die teiken se netwerk onreageerbaar word.
```bash
for sub in $(cat <WORDLIST>);do dig $sub.<DOMAIN> @<DNS_IP> | grep -v ';\|SOA' | sed -r '/^\s*$/d' | grep $sub | tee -a subdomains.txt;done

dnsenum --dnsserver <DNS_IP> --enum -p 0 -s 0 -o subdomains.txt -f <WORDLIST> <DOMAIN>
```
#### Gebruik van nslookup

`nslookup` is een opdrachtregelhulpprogramma dat wordt gebruikt om DNS-informatie op te vragen. Het kan worden gebruikt om verschillende soorten DNS-query's uit te voeren, zoals het opzoeken van IP-adressen van domeinnamen en het omgekeerde opzoeken van domeinnamen van IP-adressen.

Om `nslookup` te gebruiken, open je een terminal en typ je `nslookup` gevolgd door het domein of IP-adres waarvoor je informatie wilt opvragen. Bijvoorbeeld:

```
nslookup example.com
```

Dit zal de IP-adressen van het domein "example.com" retourneren, samen met andere relevante informatie zoals de naam van de DNS-server die de informatie heeft verstrekt.

Je kunt ook het omgekeerde opzoeken doen door het IP-adres in plaats van de domeinnaam te gebruiken. Bijvoorbeeld:

```
nslookup 192.168.0.1
```

Dit zal de domeinnamen retourneren die zijn gekoppeld aan het IP-adres "192.168.0.1".

`nslookup` kan ook worden gebruikt om specifieke DNS-recordtypes op te zoeken, zoals A, MX, NS, enz. Om een specifiek recordtype op te zoeken, typ je het recordtype gevolgd door het domein of IP-adres. Bijvoorbeeld:

```
nslookup -type=mx example.com
```

Dit zal de MX-records (Mail Exchange) van het domein "example.com" retourneren.

`nslookup` kan ook worden gebruikt om een specifieke DNS-server te raadplegen. Om een specifieke DNS-server te gebruiken, typ je `server` gevolgd door het IP-adres van de DNS-server. Bijvoorbeeld:

```
nslookup
> server 8.8.8.8
> example.com
```

Dit zal `nslookup` instrueren om de DNS-server op "8.8.8.8" te gebruiken voor het opzoeken van informatie over het domein "example.com".

`nslookup` is een handig hulpprogramma voor het uitvoeren van DNS-query's en het verkrijgen van informatie over domeinen en IP-adressen. Het kan nuttig zijn bij het pentesten van netwerkservices om mogelijke kwetsbaarheden en configuratiefouten te identificeren.
```bash
nslookup
> SERVER <IP_DNS> #Select dns server
> 127.0.0.1 #Reverse lookup of 127.0.0.1, maybe...
> <IP_MACHINE> #Reverse lookup of a machine, maybe...
```
### Nuttige metasploit-modules

Metasploit is 'n kragtige raamwerk vir penetrasietoetse wat 'n verskeidenheid modules bied om verskillende aanvalstegnieke uit te voer. Hier is 'n paar nuttige metasploit-modules wat jy kan gebruik vir jou penetrasietoetse:

- `exploit/multi/handler`: Hierdie module stel jou in staat om 'n luisterende posisie te skep om inkomende verbindings te hanteer. Dit kan gebruik word om 'n sessie te skep wanneer 'n aanval suksesvol is.
- `exploit/windows/smb/ms17_010_eternalblue`: Hierdie module maak gebruik van die EternalBlue-uitbuiting om 'n aanval op 'n kwesbare Windows-masjien uit te voer. Dit kan gebruik word om 'n afstandbeheer-sessie te verkry.
- `auxiliary/scanner/http/wordpress_scanner`: Hierdie module skandeer 'n WordPress-webwerf vir bekende kwesbaarhede en gee jou inligting oor die veiligheidstoestand van die webwerf.
- `post/multi/gather/enum_dns`: Hierdie module versamel inligting oor DNS-opnames en stel jou in staat om DNS-inligting van 'n teikenstelsel te ondersoek.
- `exploit/multi/http/php_file_upload`: Hierdie module maak gebruik van 'n kwesbaarheid in PHP-l√™eroplaaifunksies om 'n l√™er op 'n teikenbediener te laai. Dit kan gebruik word om 'n webwerf te kompromitteer deur skadelike l√™ers op te laai.

Dit is net 'n paar voorbeelde van die vele modules wat beskikbaar is in Metasploit. Elke module het sy eie funksionaliteit en kan gebruik word vir spesifieke aanvalstegnieke. Dit is belangrik om die dokumentasie van elke module te raadpleeg om te verseker dat jy dit korrek gebruik vir jou penetrasietoetse.
```bash
auxiliary/gather/enum_dns #Perform enumeration actions
```
### Nuttige nmap-skripte

Hier is 'n lys van nuttige nmap-skripte wat gebruik kan word tydens netwerkdiens-pentesting:

- **dns-brute.nse**: Hierdie skrip voer 'n brute force-aanval uit om DNS-naamoplossing te probeer.
- **dns-cache-snoop.nse**: Hierdie skrip ondersoek die DNS-kasgeheue vir inligting oor DNS-navrae en -antwoorde.
- **dns-zone-transfer.nse**: Hierdie skrip probeer 'n DNS-sone-oordrag uitvoer om inligting oor DNS-rekords te verkry.
- **dns-blacklist.nse**: Hierdie skrip ondersoek of 'n DNS-bedieners IP-adres op 'n swartlys voorkom.
- **dns-recursion.nse**: Hierdie skrip toets of 'n DNS-bedieners rekursie ondersteun.
- **dns-random-srcport.nse**: Hierdie skrip gebruik 'n willekeurige bronpoort vir DNS-navrae om te probeer om beveiligingsmaatre√´ls te omseil.
- **dns-random-txid.nse**: Hierdie skrip gebruik 'n willekeurige transaksie-ID vir DNS-navrae om te probeer om beveiligingsmaatre√´ls te omseil.
- **dns-random-tld.nse**: Hierdie skrip gebruik 'n willekeurige topvlakdomein (TLD) vir DNS-navrae om te probeer om beveiligingsmaatre√´ls te omseil.
- **dns-random-subdomain.nse**: Hierdie skrip gebruik 'n willekeurige subdomein vir DNS-navrae om te probeer om beveiligingsmaatre√´ls te omseil.
- **dns-random-ip.nse**: Hierdie skrip gebruik 'n willekeurige IP-adres vir DNS-navrae om te probeer om beveiligingsmaatre√´ls te omseil.
- **dns-random-query.nse**: Hierdie skrip gebruik 'n willekeurige navraag vir DNS-navrae om te probeer om beveiligingsmaatre√´ls te omseil.
- **dns-random-rrtype.nse**: Hierdie skrip gebruik 'n willekeurige RR-tipe vir DNS-navrae om te probeer om beveiligingsmaatre√´ls te omseil.
- **dns-random-rrclass.nse**: Hierdie skrip gebruik 'n willekeurige RR-klas vir DNS-navrae om te probeer om beveiligingsmaatre√´ls te omseil.
- **dns-random-rrname.nse**: Hierdie skrip gebruik 'n willekeurige RR-naam vir DNS-navrae om te probeer om beveiligingsmaatre√´ls te omseil.
- **dns-random-rrdata.nse**: Hierdie skrip gebruik 'n willekeurige RR-data vir DNS-navrae om te probeer om beveiligingsmaatre√´ls te omseil.
- **dns-random-rrttl.nse**: Hierdie skrip gebruik 'n willekeurige RR-TTL vir DNS-navrae om te probeer om beveiligingsmaatre√´ls te omseil.
- **dns-random-rrsig.nse**: Hierdie skrip gebruik 'n willekeurige RR-SIG vir DNS-navrae om te probeer om beveiligingsmaatre√´ls te omseil.
- **dns-random-rrkey.nse**: Hierdie skrip gebruik 'n willekeurige RR-KEY vir DNS-navrae om te probeer om beveiligingsmaatre√´ls te omseil.
- **dns-random-rrsoa.nse**: Hierdie skrip gebruik 'n willekeurige RR-SOA vir DNS-navrae om te probeer om beveiligingsmaatre√´ls te omseil.
- **dns-random-rrns.nse**: Hierdie skrip gebruik 'n willekeurige RR-NS vir DNS-navrae om te probeer om beveiligingsmaatre√´ls te omseil.
- **dns-random-rrcname.nse**: Hierdie skrip gebruik 'n willekeurige RR-CNAME vir DNS-navrae om te probeer om beveiligingsmaatre√´ls te omseil.
- **dns-random-rrmx.nse**: Hierdie skrip gebruik 'n willekeurige RR-MX vir DNS-navrae om te probeer om beveiligingsmaatre√´ls te omseil.
- **dns-random-rrtxt.nse**: Hierdie skrip gebruik 'n willekeurige RR-TXT vir DNS-navrae om te probeer om beveiligingsmaatre√´ls te omseil.
- **dns-random-rrptr.nse**: Hierdie skrip gebruik 'n willekeurige RR-PTR vir DNS-navrae om te probeer om beveiligingsmaatre√´ls te omseil.
- **dns-random-rrhinfo.nse**: Hierdie skrip gebruik 'n willekeurige RR-HINFO vir DNS-navrae om te probeer om beveiligingsmaatre√´ls te omseil.
- **dns-random-rrnaptr.nse**: Hierdie skrip gebruik 'n willekeurige RR-NAPTR vir DNS-navrae om te probeer om beveiligingsmaatre√´ls te omseil.
- **dns-random-rrsrv.nse**: Hierdie skrip gebruik 'n willekeurige RR-SRV vir DNS-navrae om te probeer om beveiligingsmaatre√´ls te omseil.
- **dns-random-rrds.nse**: Hierdie skrip gebruik 'n willekeurige RR-DS vir DNS-navrae om te probeer om beveiligingsmaatre√´ls te omseil.
- **dns-random-rrsshfp.nse**: Hierdie skrip gebruik 'n willekeurige RR-SSHFP vir DNS-navrae om te probeer om beveiligingsmaatre√´ls te omseil.
- **dns-random-rrspf.nse**: Hierdie skrip gebruik 'n willekeurige RR-SPF vir DNS-navrae om te probeer om beveiligingsmaatre√´ls te omseil.
- **dns-random-rrrp.nse**: Hierdie skrip gebruik 'n willekeurige RR-RP vir DNS-navrae om te probeer om beveiligingsmaatre√´ls te omseil.
- **dns-random-rrsig0.nse**: Hierdie skrip gebruik 'n willekeurige RR-SIG0 vir DNS-navrae om te probeer om beveiligingsmaatre√´ls te omseil.
- **dns-random-rrnsec.nse**: Hierdie skrip gebruik 'n willekeurige RR-NSEC vir DNS-navrae om te probeer om beveiligingsmaatre√´ls te omseil.
- **dns-random-rrnsec3.nse**: Hierdie skrip gebruik 'n willekeurige RR-NSEC3 vir DNS-navrae om te probeer om beveiligingsmaatre√´ls te omseil.
- **dns-random-rrnsec3param.nse**: Hierdie skrip gebruik 'n willekeurige RR-NSEC3PARAM vir DNS-navrae om te probeer om beveiligingsmaatre√´ls te omseil.
- **dns-random-rrtlsa.nse**: Hierdie skrip gebruik 'n willekeurige RR-TLSA vir DNS-navrae om te probeer om beveiligingsmaatre√´ls te omseil.
- **dns-random-rrsmimea.nse**: Hierdie skrip gebruik 'n willekeurige RR-SMIMEA vir DNS-navrae om te probeer om beveiligingsmaatre√´ls te omseil.
- **dns-random-rrhip.nse**: Hierdie skrip gebruik 'n willekeurige RR-HIP vir DNS-navrae om te probeer om beveiligingsmaatre√´ls te omseil.
- **dns-random-rrninfo.nse**: Hierdie skrip gebruik 'n willekeurige RR-NINFO vir DNS-navrae om te probeer om beveiligingsmaatre√´ls te omseil.
- **dns-random-rrrpki.nse**: Hierdie skrip gebruik 'n willekeurige RR-RPKI vir DNS-navrae om te probeer om beveiligingsmaatre√´ls te omseil.
- **dns-random-rrtkey.nse**: Hierdie skrip gebruik 'n willekeurige RR-TKEY vir DNS-navrae om te probeer om beveiligingsmaatre√´ls te omseil.
- **dns-random-rrtsig.nse**: Hierdie skrip gebruik 'n willekeurige RR-TSIG vir DNS-navrae om te probeer om beveiligingsmaatre√´ls te omseil.
- **dns-random-rruri.nse**: Hierdie skrip gebruik 'n willekeurige RR-URI vir DNS-navrae om te probeer om beveiligingsmaatre√´ls te omseil.
- **dns-random-rrcaa.nse**: Hierdie skrip gebruik 'n willekeurige RR-CAA vir DNS-navrae om te probeer om beveiligingsmaatre√´ls te omseil.
- **dns-random-rrta.nse**: Hierdie skrip gebruik 'n willekeurige RR-TA vir DNS-navrae om te probeer om beveiligingsmaatre√´ls te omseil.
- **dns-random-rrdlv.nse**: Hierdie skrip gebruik 'n willekeurige RR-DLV vir DNS-navrae om te probeer om beveiligingsmaatre√´ls te omseil.

Dit is 'n lys van nmap-skripte wat jou kan help om DNS-gerelateerde kwessies te ondersoek en te misbruik tydens netwerkdiens-pentesting.
```bash
#Perform enumeration actions
nmap -n --script "(default and *dns*) or fcrdns or dns-srv-enum or dns-random-txid or dns-random-srcport" <IP>
```
### DNS - Omgekeerde BF

Omgekeerde brute force (Reverse BF) is een techniek die wordt gebruikt bij het pentesten van DNS-servers. Het doel van deze techniek is om subdomeinen te ontdekken door het uitvoeren van een omgekeerde DNS-zoekopdracht.

Bij een omgekeerde DNS-zoekopdracht wordt een IP-adres omgezet in een domeinnaam. Dit kan handig zijn bij het identificeren van subdomeinen die mogelijk niet openbaar zijn. 

Omgekeerde BF kan worden uitgevoerd met behulp van verschillende tools, zoals `dnsrecon`, `dnsenum` en `fierce`. Deze tools kunnen worden gebruikt om een lijst met subdomeinen te genereren op basis van een gegeven IP-adres.

Het is belangrijk op te merken dat omgekeerde BF een passieve techniek is en geen actieve aanvallen uitvoert op de DNS-server. Het is een nuttige methode om informatie te verzamelen tijdens het pentesten, maar het moet met de nodige voorzichtigheid worden gebruikt om geen ongewenste aandacht te trekken.
```bash
dnsrecon -r 127.0.0.0/24 -n <IP_DNS>  #DNS reverse of all of the addresses
dnsrecon -r 127.0.1.0/24 -n <IP_DNS>  #DNS reverse of all of the addresses
dnsrecon -r <IP_DNS>/24 -n <IP_DNS>   #DNS reverse of all of the addresses
dnsrecon -d active.htb -a -n <IP_DNS> #Zone transfer
```
{% hint style="info" %}
As jy subdomeine vind wat na interne IP-adresse verwys, moet jy probeer om 'n omgekeerde DNS BF uit te voer na die NSs van die domein en vra vir daardie IP-reeks.
{% endhint %}

'n Ander hulpmiddel om dit te doen: [https://github.com/amine7536/reverse-scan](https://github.com/amine7536/reverse-scan)

Jy kan omgekeerde IP-reeks navrae doen na [https://bgp.he.net/net/205.166.76.0/24#\_dns](https://bgp.he.net/net/205.166.76.0/24#\_dns) (hierdie hulpmiddel is ook nuttig met BGP).

### DNS - Subdomeine BF
```bash
dnsenum --dnsserver <IP_DNS> --enum -p 0 -s 0 -o subdomains.txt -f subdomains-1000.txt <DOMAIN>
dnsrecon -D subdomains-1000.txt -d <DOMAIN> -n <IP_DNS>
dnscan -d <domain> -r -w subdomains-1000.txt #Bruteforce subdomains in recursive way, https://github.com/rbsec/dnscan
```
### Aktiewe Direktory-bedieners

Active Directory (AD) is 'n diens wat deur Microsoft Windows aangebied word en dit stel organisasies in staat om gebruikers, rekenaars en hulpbronne binne 'n netwerk te bestuur. As 'n pentester is dit belangrik om 'n goeie begrip van AD-servers te h√™, aangesien dit dikwels 'n teiken is vir aanvalle.

Hier is 'n paar belangrike punte om in gedagte te hou wanneer dit kom by AD-servers:

- **Domain Controllers (DCs)**: Dit is die kern van 'n AD-omgewing en bevat die gebruikersrekenaars, groepe en beleide. Dit is die prim√™re doelwit vir aanvallers, aangesien dit toegang tot die hele AD-omgewing kan gee.
- **Global Catalog (GC)**: Die GC is 'n spesiale tipe DC wat 'n gedeeltelike replikasie van alle objekte in die AD-omgewing bevat. Dit maak dit makliker om soekvrae uit te voer en gebruikersinligting te vind.
- **LDAP**: Die Lightweight Directory Access Protocol (LDAP) is die protokol wat gebruik word om te kommunikeer met AD-servers. Dit maak dit moontlik om te soek, te lees en te skryf na die AD-databasis.
- **Kerberos**: Dit is die standaard-verifikasieprotokol wat deur AD gebruik word. Dit is belangrik om te verstaan hoe Kerberos werk en hoe dit gebruik kan word om toegang te verkry tot AD-bronne.
- **DNS**: Die Domain Name System (DNS) is noodsaaklik vir die funksionering van AD. Dit vertaal domeinname na IP-adresse en maak dit moontlik vir rekenaars om met mekaar te kommunikeer.
- **Group Policy Objects (GPOs)**: GPO's is beleidsinstellings wat op AD-objekte toegepas kan word. Dit kan gebruik word om sekuriteitsbeleide af te dwing en toegang tot hulpbronne te beperk.

Deur 'n goeie begrip van AD-servers te h√™, kan 'n pentester die omgewing beter assesseer en moontlike aanvals
```bash
dig -t _gc._tcp.lab.domain.com
dig -t _ldap._tcp.lab.domain.com
dig -t _kerberos._tcp.lab.domain.com
dig -t _kpasswd._tcp.lab.domain.com

nslookup -type=srv _kerberos._tcp.<CLIENT_DOMAIN>
nslookup -type=srv _kerberos._tcp.domain.com

nmap --script dns-srv-enum --script-args "dns-srv-enum.domain='domain.com'"
```
### DNSSec

DNSSec (Domain Name System Security Extensions) is 'n sekuriteitsuitbreiding vir die Domain Name System (DNS) wat ontwerp is om die integriteit en veiligheid van DNS-inligting te verbeter. Dit voeg 'n laag van sekuriteit by die DNS-protokol deur die ondertekening van DNS-rekords met digitale handtekeninge. Hierdie handtekeninge kan dan geverifieer word deur DNS-kli√´nte om te verseker dat die ontvangste DNS-inligting nie gewysig of vervals is nie.

DNSSec beskerm teen aanvalle soos DNS-spoofing, waar 'n aanvaller valse DNS-inligting versprei om gebruikers na 'n kwaadwillige webwerf te stuur. Dit beskerm ook teen DNS-cache-vergiftiging, waar 'n aanvaller valse DNS-inligting in 'n DNS-kas plaas om gebruikers na 'n kwaadwillige webwerf te stuur.

Om DNSSec te implementeer, moet 'n domeinnaameienaar DNS-rekords onderteken met 'n privaat sleutel en die ooreenstemmende openbare sleutel publiseer in die DNS. Wanneer 'n DNS-kli√´nt 'n DNS-rekord ontvang, kan dit die handtekening verifieer deur die ooreenstemmende openbare sleutel te gebruik. As die handtekening geldig is, kan die DNS-kli√´nt verseker dat die ontvangste DNS-inligting nie gewysig is nie.

DNSSec is 'n belangrike tegniek vir die verbetering van die veiligheid van die DNS en die beskerming teen aanvalle op DNS-inligting. Dit word aanbeveel dat domeinnaameienaars DNSSec implementeer om die integriteit en veiligheid van hul DNS-inligting te verseker.
```bash
#Query paypal subdomains to ns3.isc-sns.info
nmap -sSU -p53 --script dns-nsec-enum --script-args dns-nsec-enum.domains=paypal.com ns3.isc-sns.info
```
### IPv6

Brute force deur gebruik te maak van "AAAA" versoeke om die IPv6-adresse van die subdomeine te versamel.
```bash
dnsdict6 -s -t <domain>
```
# Bruteforce omgekeerde DNS in gebruik van IPv6-adresse

Omgekeerde DNS, ook bekend as omgekeerde DNS-opsoek, is 'n proses waardeur 'n IP-adres vertaal word na 'n domeinnaam. Dit kan nuttig wees tydens pentesting, omdat dit kan help om inligting oor die doelwit se infrastruktuur te bekom.

Om omgekeerde DNS vir IPv6-adresse te bruteforce, kan jy die volgende stappe volg:

1. Identifiseer die IPv6-adres wat jy wil ondersoek.
2. Gebruik 'n gereedskap soos `dnsrecon` of `dnsenum` om 'n lys moontlike domeinname te genereer wat gekoppel kan wees aan die IPv6-adres.
3. Voer 'n bruteforce-aanval uit deur die gereedskap te gebruik om elke moontlike domeinnaam te ondersoek en te kyk of dit gekoppel is aan die IPv6-adres.
4. Analiseer die resultate en identifiseer enige relevante domeinname wat gekoppel is aan die IPv6-adres.

Dit is belangrik om te onthou dat omgekeerde DNS-bruteforce 'n tydrowende proses kan wees, veral vir IPv6-adresse wat 'n groot aantal moontlike domeinname kan h√™. Dit kan ook 'n ho√´ volume van navrae na die DNS-infrastruktuur veroorsaak, wat 'n potensi√´le rooi vlag vir die doelwit se beveiliging kan wees.

Dit is dus raadsaam om hierdie tegniek met omsigtigheid en in ooreenstemming met die toepaslike wetlike en etiese riglyne te gebruik.
```bash
dnsrevenum6 pri.authdns.ripe.net 2001:67c:2e8::/48 #Will use the dns pri.authdns.ripe.net
```
### DNS Rekursie DDoS

Indien **DNS rekursie geaktiveer** is, kan 'n aanvaller die **oorsprong** op die UDP-pakket vervals om die **DNS om die respons na die slagofferserver te stuur**. 'n Aanvaller kan **ENIGE** of **DNSSEC** rekordtipes misbruik, aangesien hulle geneig is om die grootste respons te h√™.\
Die manier om te **verifieer** of 'n DNS **rekursie** ondersteun, is om 'n domeinnaam te ondervra en te **kyk** of die vlag "ra" (_rekursie beskikbaar_) in die respons is:
```bash
dig google.com A @<IP>
```
**Nie beskikbaar**:

![](<../.gitbook/assets/image (275).png>)

**Beskikbaar**:

![](<../.gitbook/assets/image (276).png>)

<figure><img src="/.gitbook/assets/image (2).png" alt=""><figcaption></figcaption></figure>

**Onmiddellik beskikbare opset vir kwesbaarheidsassessering en penetrasietoetsing**. Voer 'n volledige penetrasietoets uit van enige plek met 20+ gereedskap en funksies wat strek van rekognisering tot verslagdoening. Ons vervang nie penetrasietoetsers nie - ons ontwikkel aangepaste gereedskap, opsporings- en uitbuitingsmodules om hulle tyd te gee om dieper te graaf, skulpe te kraak en pret te h√™.

{% embed url="https://pentest-tools.com/" %}

### E-pos na 'n nie-bestaande rekening

Deur die ondersoek van 'n nie-lewering-kennisgewing (NDN) wat geaktiveer word deur 'n e-pos wat gestuur is na 'n ongeldige adres binne 'n teikendomein, word waardevolle interne netwerkdetails dikwels bekendgemaak.

Die verskafte nie-lewering-verslag bevat inligting soos:

- Die genererende bediener is ge√Ødentifiseer as `server.example.com`.
- 'n Foutkennisgewing vir `user@example.com` met die foutkode `#550 5.1.1 RESOLVER.ADR.RecipNotFound; not found` is teruggekeer.
- Interne IP-adresse en gasheernaam is bekendgemaak in die oorspronklike boodskaphoofstukke.
```markdown
The original message headers were modified for anonymity and now present randomized data:

Generating server: server.example.com

user@example.com
#550 5.1.1 RESOLVER.ADR.RecipNotFound; not found ##

Original message headers:

Received: from MAILSERVER01.domain.example.com (192.168.1.1) by
mailserver02.domain.example.com (192.168.2.2) with Microsoft SMTP Server (TLS)
id 14.3.174.1; Mon, 25 May 2015 14:52:22 -0700
Received: from filter.example.com (203.0.113.1) by
MAILSERVER01.domain.example.com (192.168.1.1) with Microsoft SMTP Server (TLS)
id 14.3.174.1; Mon, 25 May 2015 14:51:22 -0700
X-ASG-Debug-ID: 1432576343-0614671716190e0d0001-zOQ9WJ
Received: from gateway.domainhost.com (gateway.domainhost.com [198.51.100.37]) by
filter.example.com with ESMTP id xVNPkwaqGgdyH5Ag for user@example.com; Mon,
25 May 2015 14:52:13 -0700 (PDT)
X-Envelope-From: sender@anotherdomain.org
X-Apparent-Source-IP: 198.51.100.37
```
## Konfigurasie l√™ers

Config files, or configuration files, are files that contain settings and parameters for various software applications. These files are used to customize the behavior of the software and can be found in different locations depending on the operating system and the specific application.

Konfigurasie l√™ers, of konfigurasie l√™ers, is l√™ers wat instellings en parameters vir verskeie sagtewaretoepassings bevat. Hierdie l√™ers word gebruik om die gedrag van die sagteware aan te pas en kan in verskillende plekke gevind word, afhangende van die bedryfstelsel en die spesifieke toepassing.

Config files are commonly used in the context of network services, including DNS (Domain Name System). In the case of DNS, the config file is typically located in the `/etc` directory and is named `named.conf` or `named.conf.options`.

Konfigurasie l√™ers word algemeen gebruik in die konteks van netwerkdienste, insluitend DNS (Domain Name System). In die geval van DNS is die konfigurasie l√™er tipies gele√´ in die `/etc` gids en word dit genoem `named.conf` of `named.conf.options`.

These config files contain important information such as the IP addresses of DNS servers, domain zone configurations, and access control rules. By analyzing and manipulating these config files, a hacker can potentially gain unauthorized access, redirect DNS queries, or perform other malicious activities.

Hierdie konfigurasie l√™ers bevat belangrike inligting soos die IP-adresse van DNS-bedieners, domein-sone-konfigurasies en toegangsbeheer-re√´ls. Deur hierdie konfigurasie l√™ers te analiseer en te manipuleer, kan 'n hacker moontlik ongemagtigde toegang verkry, DNS-navrae omlei of ander skadelike aktiwiteite uitvoer.

It is important for pentesters and system administrators to review and secure these config files to prevent potential vulnerabilities and unauthorized access.

Dit is belangrik vir pentesters en stelseladministrateurs om hierdie konfigurasie l√™ers te hersien en te beveilig om potensi√´le kwesbaarhede en ongemagtigde toegang te voorkom.
```
host.conf
/etc/resolv.conf
/etc/bind/named.conf
/etc/bind/named.conf.local
/etc/bind/named.conf.options
/etc/bind/named.conf.log
/etc/bind/*
```
Gevaarlike instellings wanneer 'n Bind-bediener gekonfigureer word:

| **Opsie**         | **Beskrywing**                                                                 |
| ----------------- | ------------------------------------------------------------------------------ |
| `allow-query`     | Definieer watter gasheerse is toegelaat om navrae na die DNS-bediener te stuur.            |
| `allow-recursion` | Definieer watter gasheerse is toegelaat om herhalende navrae na die DNS-bediener te stuur.  |
| `allow-transfer`  | Definieer watter gasheerse is toegelaat om sone-oordragte van die DNS-bediener te ontvang. |
| `zone-statistics` | Versamel statistiese data van sones.                                            |

## Verwysings
* [https://www.myrasecurity.com/en/knowledge-hub/dns/](https://www.myrasecurity.com/en/knowledge-hub/dns/)
* Boek: **Network Security Assessment 3rd edition**

## HackTricks Outomatiese Opdragte
```
Protocol_Name: DNS    #Protocol Abbreviation if there is one.
Port_Number:  53     #Comma separated if there is more than one.
Protocol_Description: Domain Name Service        #Protocol Abbreviation Spelled out

Entry_1:
Name: Notes
Description: Notes for DNS
Note: |
#These are the commands I run every time I see an open DNS port

dnsrecon -r 127.0.0.0/24 -n {IP} -d {Domain_Name}
dnsrecon -r 127.0.1.0/24 -n {IP} -d {Domain_Name}
dnsrecon -r {Network}{CIDR} -n {IP} -d {Domain_Name}
dig axfr @{IP}
dig axfr {Domain_Name} @{IP}
nslookup
SERVER {IP}
127.0.0.1
{IP}
Domain_Name
exit

https://book.hacktricks.xyz/pentesting/pentesting-dns

Entry_2:
Name: Banner Grab
Description: Grab DNS Banner
Command: dig version.bind CHAOS TXT @DNS

Entry_3:
Name: Nmap Vuln Scan
Description: Scan for Vulnerabilities with Nmap
Command: nmap -n --script "(default and *dns*) or fcrdns or dns-srv-enum or dns-random-txid or dns-random-srcport" {IP}

Entry_4:
Name: Zone Transfer
Description: Three attempts at forcing a zone transfer
Command: dig axfr @{IP} && dix axfr @{IP} {Domain_Name} && fierce --dns-servers {IP} --domain {Domain_Name}


Entry_5:
Name: Active Directory
Description: Eunuerate a DC via DNS
Command: dig -t _gc._{Domain_Name} && dig -t _ldap._{Domain_Name} && dig -t _kerberos._{Domain_Name} && dig -t _kpasswd._{Domain_Name} && nmap --script dns-srv-enum --script-args "dns-srv-enum.domain={Domain_Name}"

Entry_6:
Name: consolesless mfs enumeration
Description: DNS enumeration without the need to run msfconsole
Note: sourced from https://github.com/carlospolop/legion
Command: msfconsole -q -x 'use auxiliary/scanner/dns/dns_amp; set RHOSTS {IP}; set RPORT 53; run; exit' && msfconsole -q -x 'use auxiliary/gather/enum_dns; set RHOSTS {IP}; set RPORT 53; run; exit'
```
<figure><img src="/.gitbook/assets/image (2).png" alt=""><figcaption></figcaption></figure>

**Onmiddellik beskikbare opset vir kwesbaarheidsassessering en penetrasietoetsing**. Voer 'n volledige penetrasietoets uit van enige plek met 20+ gereedskap en funksies wat strek van verkenningswerk tot verslagdoening. Ons vervang nie penetrasietoetsers nie - ons ontwikkel aangepaste gereedskap, opsporings- en uitbuitingsmodules om hulle tyd te gee om dieper te graaf, skulpe te kraak en pret te h√™.

{% embed url="https://pentest-tools.com/" %}

<details>

<summary><strong>Leer AWS-hacking van nul tot held met</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Ander maniere om HackTricks te ondersteun:

* As jy jou **maatskappy geadverteer wil sien in HackTricks** of **HackTricks in PDF wil aflaai**, kyk na die [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Kry die [**amptelike PEASS & HackTricks-uitrusting**](https://peass.creator-spring.com)
* Ontdek [**The PEASS Family**](https://opensea.io/collection/the-peass-family), ons versameling eksklusiewe [**NFT's**](https://opensea.io/collection/the-peass-family)
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Deel jou haktruuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-opslagplekke.

</details>
