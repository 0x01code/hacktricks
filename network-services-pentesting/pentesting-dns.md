# 53 - DNS Pentesting

<details>

<summary><strong>Sıfırdan kahraman olmaya kadar AWS hackleme öğrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Kırmızı Takım Uzmanı)</strong></a><strong>!</strong></summary>

HackTricks'ı desteklemenin diğer yolları:

* **Şirketinizi HackTricks'te reklamını görmek istiyorsanız** veya **HackTricks'i PDF olarak indirmek istiyorsanız** [**ABONELİK PLANLARI**]'na göz atın (https://github.com/sponsors/carlospolop)!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keşfedin, özel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* **Katılın** 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) veya bizi **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks\_live)**'da takip edin.**
* **Hacking püf noktalarınızı paylaşarak PR'lar göndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına katkıda bulunun.

</details>

<figure><img src="../.gitbook/assets/image (11).png" alt=""><figcaption></figcaption></figure>

**Anında kullanılabilir zafiyet değerlendirme ve penetrasyon testi kurulumu**. 20'den fazla araç ve özellikle tam bir pentest çalıştırın, keşiften raporlamaya kadar. Pentester'ları değiştirmiyoruz - özel araçlar, tespit ve istismar modülleri geliştiriyoruz, böylece daha derine kazma, kabukları patlatma ve eğlenme zamanı kazanıyorlar.

{% embed url="https://pentest-tools.com/" %}

## **Temel Bilgiler**

**Alan Adı Sistemi (DNS)**, kullanıcıların sayısal İnternet Protokolü (IP) adresleri yerine google.com veya facebook.com gibi **kolay hatırlanabilir alan adları** aracılığıyla web sitelerine erişmesini sağlayan internetin dizinidir. Alan adlarını IP adreslerine çevirerek DNS, web tarayıcılarının internet kaynaklarını hızlı bir şekilde yüklemesini sağlar, çevrimiçi dünyada gezinmemizi basitleştirir.

**Varsayılan bağlantı noktası:** 53
```
PORT     STATE SERVICE  REASON
53/tcp   open  domain  Microsoft DNS 6.1.7601 (1DB15D39) (Windows Server 2008 R2 SP1)
5353/udp open  zeroconf udp-response
53/udp   open  domain  Microsoft DNS 6.1.7601 (1DB15D39) (Windows Server 2008 R2 SP1)
```
### Farklı DNS Sunucuları

- **DNS Kök Sunucuları**: DNS hiyerarşisinin en üstünde bulunurlar, üst düzey alanları yönetir ve alt düzey sunucular yanıt vermezse devreye girerler. İnternet Tahsisli Adlar ve Sayılar Kurumu (**ICANN**) işletmelerini denetler ve küresel olarak 13 adet bulunmaktadır.
- **Yetkili Ad Sunucuları**: Bu sunucular, belirli bölgelerindeki sorgular için nihai kararı verirler ve kesin cevaplar sunarlar. Yanıt sağlayamazlarsa sorgu kök sunuculara yükseltilir.
- **Yetkisiz Ad Sunucuları**: DNS bölgeleri üzerinde sahiplikleri olmadığından, bu sunucular alan bilgilerini diğer sunuculara yapılan sorgular aracılığıyla toplarlar.
- **Önbelleğe Alan DNS Sunucusu**: Bu tür bir sunucu, gelecekteki istekler için yanıt sürelerini hızlandırmak için önceki sorgu yanıtlarını belirli bir süre boyunca hafızasında saklar. Önbellek süresi yetkili sunucu tarafından belirlenir.
- **Yönlendirme Sunucusu**: Basit bir rol üstlenen yönlendirme sunucuları, sorguları sadece başka bir sunucuya iletirler.
- **Çözümleyici**: Bilgisayarlar veya yönlendiriciler içinde entegre edilen çözümleyiciler, yerel olarak ad çözümünü gerçekleştirir ve yetkili olarak kabul edilmezler.

## Numaralandırma

### **Banner Yakalama**

DNS'te bannerlar bulunmamaktadır ancak `version.bind. CHAOS TXT` için sihirli sorguyu yakalayabilirsiniz, bu sorgu çoğu BIND ad sunucusunda çalışacaktır.\
Bu sorguyu `dig` kullanarak gerçekleştirebilirsiniz:
```bash
dig version.bind CHAOS TXT @DNS
```
Ayrıca, [`fpdns`](https://github.com/kirei/fpdns) aracı sunucunun parmak izini de alabilir.

Ayrıca **nmap** betiği ile banner da alınabilir:
```
--script dns-nsid
```
### **Herhangi bir kayıt**

**ANY** kaydı, DNS sunucusuna **geri dönmesini** isteyecek ve **açıklamaya istekli olduğu** tüm mevcut **girişleri** sormaktadır.
```bash
dig any victim.com @<DNS_IP>
```
### **Bölge Transferi**

Bu prosedür, `Asenkron Tam Transfer Bölgesi` (`AXFR`) olarak kısaltılmıştır.
```bash
dig axfr @<DNS_IP> #Try zone transfer without domain
dig axfr @<DNS_IP> <DOMAIN> #Try zone transfer guessing the domain
fierce --domain <DOMAIN> --dns-servers <DNS_IP> #Will try toperform a zone transfer against every authoritative name server and if this doesn'twork, will launch a dictionary attack
```
### Daha Fazla Bilgi
```bash
dig ANY @<DNS_IP> <DOMAIN>     #Any information
dig A @<DNS_IP> <DOMAIN>       #Regular DNS request
dig AAAA @<DNS_IP> <DOMAIN>    #IPv6 DNS request
dig TXT @<DNS_IP> <DOMAIN>     #Information
dig MX @<DNS_IP> <DOMAIN>      #Emails related
dig NS @<DNS_IP> <DOMAIN>      #DNS that resolves that name
dig -x 192.168.0.2 @<DNS_IP>   #Reverse lookup
dig -x 2a00:1450:400c:c06::93 @<DNS_IP> #reverse IPv6 lookup

#Use [-p PORT]  or  -6 (to use ivp6 address of dns)
```
#### Otomasyon
```bash
for sub in $(cat <WORDLIST>);do dig $sub.<DOMAIN> @<DNS_IP> | grep -v ';\|SOA' | sed -r '/^\s*$/d' | grep $sub | tee -a subdomains.txt;done

dnsenum --dnsserver <DNS_IP> --enum -p 0 -s 0 -o subdomains.txt -f <WORDLIST> <DOMAIN>
```
#### nslookup Kullanımı
```bash
nslookup
> SERVER <IP_DNS> #Select dns server
> 127.0.0.1 #Reverse lookup of 127.0.0.1, maybe...
> <IP_MACHINE> #Reverse lookup of a machine, maybe...
```
### Kullanışlı metasploit modülleri
```bash
auxiliary/gather/enum_dns #Perform enumeration actions
```
### Kullanışlı nmap betikleri
```bash
#Perform enumeration actions
nmap -n --script "(default and *dns*) or fcrdns or dns-srv-enum or dns-random-txid or dns-random-srcport" <IP>
```
### DNS - Ters BF
```bash
dnsrecon -r 127.0.0.0/24 -n <IP_DNS>  #DNS reverse of all of the addresses
dnsrecon -r 127.0.1.0/24 -n <IP_DNS>  #DNS reverse of all of the addresses
dnsrecon -r <IP_DNS>/24 -n <IP_DNS>   #DNS reverse of all of the addresses
dnsrecon -d active.htb -a -n <IP_DNS> #Zone transfer
```
{% hint style="info" %}
Eğer iç IP adreslerine çözünen alt alan adlarını bulabilirseniz, o IP aralığını soran alan adının NS'lerine ters dns BF yapmaya çalışmalısınız.
{% endhint %}

Bunu yapmak için başka bir araç: [https://github.com/amine7536/reverse-scan](https://github.com/amine7536/reverse-scan)

Ters IP aralıklarını sorgulayabilirsiniz [https://bgp.he.net/net/205.166.76.0/24#\_dns](https://bgp.he.net/net/205.166.76.0/24#\_dns) (bu araç aynı zamanda BGP ile de yardımcı olur).

### DNS - Alt Alan Adları BF
```bash
dnsenum --dnsserver <IP_DNS> --enum -p 0 -s 0 -o subdomains.txt -f subdomains-1000.txt <DOMAIN>
dnsrecon -D subdomains-1000.txt -d <DOMAIN> -n <IP_DNS>
dnscan -d <domain> -r -w subdomains-1000.txt #Bruteforce subdomains in recursive way, https://github.com/rbsec/dnscan
```
### Aktif Dizin sunucuları
```bash
dig -t _gc._tcp.lab.domain.com
dig -t _ldap._tcp.lab.domain.com
dig -t _kerberos._tcp.lab.domain.com
dig -t _kpasswd._tcp.lab.domain.com

nslookup -type=srv _kerberos._tcp.<CLIENT_DOMAIN>
nslookup -type=srv _kerberos._tcp.domain.com

nmap --script dns-srv-enum --script-args "dns-srv-enum.domain='domain.com'"
```
### DNSSec

### DNSSec
```bash
#Query paypal subdomains to ns3.isc-sns.info
nmap -sSU -p53 --script dns-nsec-enum --script-args dns-nsec-enum.domains=paypal.com ns3.isc-sns.info
```
### IPv6

Alt alan adlarının IPv6 adreslerini toplamak için "AAAA" isteklerini kullanarak kaba kuvvet uygulama.
```bash
dnsdict6 -s -t <domain>
```
### IPv6 Adreslerini Kullanarak Ters DNS Bruteforce Yöntemi

IPv6 adreslerini kullanarak ters DNS bruteforce yöntemi, hedefin IPv6 adreslerini çözümlemek için kullanılır. Bu yöntem, hedefin ağ altyapısını zayıf noktalar açısından değerlendirmek için etkili bir tekniktir.
```bash
dnsrevenum6 pri.authdns.ripe.net 2001:67c:2e8::/48 #Will use the dns pri.authdns.ripe.net
```
### DNS Yineleme DDoS

Eğer **DNS yineleme etkinse**, bir saldırgan UDP paketinde **kökeni sahtekarlık yapabilir** ve **DNS'in yanıtı kurban sunucuya göndermesini sağlayabilir**. Bir saldırgan **ANY** veya **DNSSEC** kayıt türlerini istismar edebilir çünkü genellikle daha büyük yanıtlara sahiptirler.\
Bir DNS'nin **yinelemeyi destekleyip desteklemediğini kontrol etmenin** yolu, bir alan adını sorgulamak ve yanıtta **"ra" bayrağının** (_yineleme mevcut_) olup olmadığını **kontrol etmektir**:
```bash
dig google.com A @<IP>
```
**Mevcut değil**:

![](<../.gitbook/assets/image (120).png>)

**Mevcut**:

![](<../.gitbook/assets/image (143).png>)

<figure><img src="../.gitbook/assets/image (11).png" alt=""><figcaption></figcaption></figure>

**Anında kullanılabilir zafiyet değerlendirme ve penetrasyon testi kurulumu**. 20'den fazla araç ve özellikle her yerden tam bir pentest çalıştırın, keşiften raporlamaya kadar uzanan. Pentester'ları değiştirmiyoruz - özel araçlar, tespit ve istismar modülleri geliştiriyoruz, böylece daha derine inmek, kabukları patlatmak ve eğlenmek için zaman kazanıyorlar.

{% embed url="https://pentest-tools.com/" %}

### Var olmayan hesaba e-posta gönderme

Hedef alan etki alanında geçersiz bir adrese gönderilen bir e-posta tarafından tetiklenen teslim edilemeyen bildirimin (NDN) incelenmesi yoluyla, genellikle değerli iç ağ ayrıntıları ifşa edilir.

Sağlanan teslim edilemeyen rapor şunları içerir:

* Oluşturan sunucu `server.example.com` olarak tanımlandı.
* `user@example.com` için `#550 5.1.1 RESOLVER.ADR.RecipNotFound; not found` hata kodu ile bir başarısızlık bildirimi geri döndürüldü.
* İç IP adresleri ve ana bilgisayar adları orijinal ileti başlıklarında ifşa edildi.
```markdown
The original message headers were modified for anonymity and now present randomized data:

Generating server: server.example.com

user@example.com
#550 5.1.1 RESOLVER.ADR.RecipNotFound; not found ##

Original message headers:

Received: from MAILSERVER01.domain.example.com (192.168.1.1) by
mailserver02.domain.example.com (192.168.2.2) with Microsoft SMTP Server (TLS)
id 14.3.174.1; Mon, 25 May 2015 14:52:22 -0700
Received: from filter.example.com (203.0.113.1) by
MAILSERVER01.domain.example.com (192.168.1.1) with Microsoft SMTP Server (TLS)
id 14.3.174.1; Mon, 25 May 2015 14:51:22 -0700
X-ASG-Debug-ID: 1432576343-0614671716190e0d0001-zOQ9WJ
Received: from gateway.domainhost.com (gateway.domainhost.com [198.51.100.37]) by
filter.example.com with ESMTP id xVNPkwaqGgdyH5Ag for user@example.com; Mon,
25 May 2015 14:52:13 -0700 (PDT)
X-Envelope-From: sender@anotherdomain.org
X-Apparent-Source-IP: 198.51.100.37
```
## Yapılandırma dosyaları
```
host.conf
/etc/resolv.conf
/etc/bind/named.conf
/etc/bind/named.conf.local
/etc/bind/named.conf.options
/etc/bind/named.conf.log
/etc/bind/*
```
## Tehlikeli ayarlar Bind sunucusu yapılandırılırken:

| **Seçenek**        | **Açıklama**                                                                |
| ----------------- | ------------------------------------------------------------------------------ |
| `allow-query`     | DNS sunucusuna istek göndermeye izin verilen ana bilgisayarları tanımlar.            |
| `allow-recursion` | DNS sunucusuna özyinelemeli istek göndermeye izin verilen ana bilgisayarları tanımlar.  |
| `allow-transfer`  | DNS sunucusundan bölge transferlerini almasına izin verilen ana bilgisayarları tanımlar. |
| `zone-statistics` | Bölgelerin istatistiksel verilerini toplar.                                            |

## Referanslar

* [https://www.myrasecurity.com/en/knowledge-hub/dns/](https://www.myrasecurity.com/en/knowledge-hub/dns/)
* Kitap: **Network Security Assessment 3. baskı**

## HackTricks Otomatik Komutları
```
Protocol_Name: DNS    #Protocol Abbreviation if there is one.
Port_Number:  53     #Comma separated if there is more than one.
Protocol_Description: Domain Name Service        #Protocol Abbreviation Spelled out

Entry_1:
Name: Notes
Description: Notes for DNS
Note: |
#These are the commands I run every time I see an open DNS port

dnsrecon -r 127.0.0.0/24 -n {IP} -d {Domain_Name}
dnsrecon -r 127.0.1.0/24 -n {IP} -d {Domain_Name}
dnsrecon -r {Network}{CIDR} -n {IP} -d {Domain_Name}
dig axfr @{IP}
dig axfr {Domain_Name} @{IP}
nslookup
SERVER {IP}
127.0.0.1
{IP}
Domain_Name
exit

https://book.hacktricks.xyz/pentesting/pentesting-dns

Entry_2:
Name: Banner Grab
Description: Grab DNS Banner
Command: dig version.bind CHAOS TXT @DNS

Entry_3:
Name: Nmap Vuln Scan
Description: Scan for Vulnerabilities with Nmap
Command: nmap -n --script "(default and *dns*) or fcrdns or dns-srv-enum or dns-random-txid or dns-random-srcport" {IP}

Entry_4:
Name: Zone Transfer
Description: Three attempts at forcing a zone transfer
Command: dig axfr @{IP} && dix axfr @{IP} {Domain_Name} && fierce --dns-servers {IP} --domain {Domain_Name}


Entry_5:
Name: Active Directory
Description: Eunuerate a DC via DNS
Command: dig -t _gc._{Domain_Name} && dig -t _ldap._{Domain_Name} && dig -t _kerberos._{Domain_Name} && dig -t _kpasswd._{Domain_Name} && nmap --script dns-srv-enum --script-args "dns-srv-enum.domain={Domain_Name}"

Entry_6:
Name: consolesless mfs enumeration
Description: DNS enumeration without the need to run msfconsole
Note: sourced from https://github.com/carlospolop/legion
Command: msfconsole -q -x 'use auxiliary/scanner/dns/dns_amp; set RHOSTS {IP}; set RPORT 53; run; exit' && msfconsole -q -x 'use auxiliary/gather/enum_dns; set RHOSTS {IP}; set RPORT 53; run; exit'
```
<figure><img src="../.gitbook/assets/image (11).png" alt=""><figcaption></figcaption></figure>

**Zafere ulaşmak için sıfırdan AWS hackleme öğrenin**. 20'den fazla araç ve özellikle her yerden tam bir pentest çalıştırın, keşiften raporlamaya kadar uzanır. Pentester'ları değiştirmiyoruz - özel araçlar, tespit ve istismar modülleri geliştiriyoruz, böylece daha derine inmek, kabukları patlatmak ve eğlenmek için zaman kazanıyorlar.

{% embed url="https://pentest-tools.com/" %}

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert) ile sıfırdan kahraman olana kadar AWS hacklemeyi öğrenin</strong>!</summary>

HackTricks'ı desteklemenin diğer yolları:

* **Şirketinizi HackTricks'te reklamını görmek istiyorsanız** veya **HackTricks'i PDF olarak indirmek istiyorsanız** [**ABONELİK PLANLARI**](https://github.com/sponsors/carlospolop)'na göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'yi keşfedin, özel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* **💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) katılın veya [**telegram grubuna**](https://t.me/peass) katılın veya bizi Twitter'da takip edin 🐦 [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Hacking hilelerinizi paylaşarak PR'lar göndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına katılın.

</details>
