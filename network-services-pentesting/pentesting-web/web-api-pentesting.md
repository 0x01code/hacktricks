# Web API Pentesting

<details>

<summary><strong>AWSハッキングをゼロからヒーローまで学ぶ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>！</strong></summary>

HackTricksをサポートする他の方法:

* **HackTricksにあなたの会社を広告したい**、または**HackTricksをPDFでダウンロードしたい**場合は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS & HackTricksグッズ**](https://peass.creator-spring.com)を入手する
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見する、私たちの独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクション
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)に**参加する**か、[**テレグラムグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)を**フォロー**してください。
* [**HackTricks**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のgithubリポジトリにPRを提出して、あなたのハッキングのコツを共有してください。

</details>

<figure><img src="../../.gitbook/assets/image (3) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

[**Trickest**](https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks)を使用して、世界で最も進んだコミュニティツールによって動力を供給される**ワークフローを簡単に構築して自動化**します。
今すぐアクセス：

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## 基本情報

主な内容:

* **Webサービス (SOAP/XML)**
* ドキュメントは**WSDL**形式を使用し、通常は`?wsdl`パスに保存されています。例：`https://api.example.com/api/?wsdl`
* このドキュメントの例は[http://www.dneonline.com/calculator.asmx](http://www.dneonline.com/calculator.asmx)で見ることができます（WSDLドキュメントは[http://www.dneonline.com/calculator.asmx?wsdl](http://www.dneonline.com/calculator.asmx?wsdl)にあります）。`Add`メソッドを呼び出すリクエストの例は[http://www.dneonline.com/calculator.asmx?op=Add](http://www.dneonline.com/calculator.asmx?op=Add)で見ることができます。
* これらのファイルを解析し、例のリクエストを作成するために、**SOAPUI**ツールまたは**WSDLer** Burp Suite拡張機能を使用できます。
* **REST APIs (JSON)**
* 標準のドキュメントはWADLファイルです。こちらで例を見つけることができます：[https://www.w3.org/Submission/wadl/](https://www.w3.org/Submission/wadl/)。しかし、[https://swagger.io/tools/swagger-ui/](https://swagger.io/tools/swagger-ui/)のような、より開発者に優しいAPI表現エンジンもあります（ページ内のデモをチェックしてください）。
* これらのファイルを解析し、例のリクエストを作成するために、**Postman**ツールを使用できます。
* [**GraphQL**](graphql.md)

## ラボ

* [**VAmPI**](https://github.com/erev0s/VAmPI)**:** VAmPIはFlaskで作られた脆弱なAPIで、APIのOWASPトップ10の脆弱性が含まれています。

## コツ

### SOAP/XML

この種のAPIは[**XXEに脆弱**](../../pentesting-web/xxe-xee-xml-external-entity.md)である可能性がありますが、通常はユーザーからの入力で**DTD宣言**が**許可されていません**。

CDATAタグを使用してペイロードを挿入することもできます（XMLが有効である限り）。

![](<../../.gitbook/assets/image (534).png>)

### アクセスチェック

通常、一部のAPIエンドポイントは他のものよりも多くの権限を必要とします。権限の低い（未承認の）アカウントからより権限の高いエンドポイントにアクセスできるかどうかを常に試してみてください。

### CORS

APIの[**CORS**](../../pentesting-web/cors-bypass.md)設定を常にチェックしてください。攻撃者ドメインからの資格情報でリクエストを終了することを許可している場合、認証された被害者からの[**CSRF**](../../pentesting-web/csrf-cross-site-request-forgery.md)を介して多くの損害を与えることができます。

### パターン

API内のパターンを探して、それを使用してさらに多くを発見してください。
_/api/albums/**\<album_id>**/photos/**\<photo_id>**_ を見つけた場合、_/api/**posts**/\<post_id>/**comment**/_ のようなものを試してみることができます。新しいエンドポイントを発見するためにファジャーを使用してください。

### パラメータの追加

以下の例のようなものは、他のユーザーのフォトアルバムにアクセスすることができるかもしれません：
_/api/MyPictureList → /api/MyPictureList?**user_id=\<other_user_id>**_

### パラメータの置換

**パラメータをファズ**するか、別のエンドポイントで見た**パラメータを使用**して、他の情報にアクセスしようとすることができます。

例えば、次のようなものがある場合：_/api/albums?**album_id=\<album id>**_

**`album_id`** パラメータを完全に異なるものに**置き換え**て、他のデータを取得することができます：_/api/albums?**account_id=\<account id>**_

### パラメータ汚染

/api/account?**id=\<your account id>** → /api/account?**id=\<your account id>\&id=\<admin's account id>**

### ワイルドカードパラメータ

以下のシンボルをワイルドカードとして使用してみてください：**\***, **%**, **\_**, **.**

* /api/users/\*
* /api/users/%
* /api/users/\_
* /api/users/.

### HTTPリクエストメソッドの変更

HTTPメソッド：**GET, POST, PUT, DELETE, PATCH, INVENTED** を使用して、Webサーバーがそれらで予期しない情報を提供するかどうかをチェックしてみてください。

### リクエストcontent-type

以下のcontent-typesを試してみて、リクエストボディを適切に変更しながら、Webサーバーが予期しない動作をするかどうかを確認してください：

* **x-www-form-urlencoded** --> user=test
* **application/xml** --> \<user>test\</user>
* **application/json** --> {"user": "test"}

### パラメータの種類

**JSON**データが機能している場合は、予期しないデータタイプを送信してみてください：

* {"username": "John"}
* {"username": true}
* {"username": null}
* {"username": 1}
* {"username": \[true]}
* {"username": \["John", true]}
* {"username": {"$neq": "lalala"\}}
* 他に想像できる組み合わせ

**XML**データを送信できる場合は、[XXEインジェクション](../../pentesting-web/xxe-xee-xml-external-entity.md)をチェックしてください。

通常のPOSTデータを送信する場合は、配列や辞書を送信してみてください：

* username\[]=John
* username\[$neq]=lalala

### ルートで遊ぶ

`/files/..%2f..%2f + 被害者ID + %2f + 被害者ファイル名`

### 可能なバージョンをチェックする

古いバージョンがまだ使用されていて、最新のエンドポイントよりも脆弱である可能性があります

* `/api/v1/login`
* `/api/v2/login`\\
* `/api/CharityEventFeb2020/user/pp/<ID>`
* `/api/CharityEventFeb2021/user/pp/<ID>`

### 可能なバージョンをチェックする（自動アプローチ）

AutoRepeater Burp拡張機能：置換ルールを追加

* `タイプ: リクエスト文字列`
* `マッチ: v2 (高いバージョン)`
* `置換: v1 (低いバージョン)`

## 🛡️ APIセキュリティエンパイアチートシート

\
チートシートの著者：[Momen Eldawakhly (Cyber Guy)](https://www.linkedin.com/in/momen-eldawakhly-3b6250204)\
\
このリポジトリでは、APIセキュリティとAPIペネトレーションテストに関連するマインドマップ、コツ＆トリック、リソース、およびWEB上で最も進んだ正確なAPIセキュリティとペネトレーションテストリソースを提供します。私たちのマインドマップとリソースはOWASP TOP 10 API、ペネトレーションテストの経験、およびその他のリソースに基づいています。

### 🚪 最初の門：`{{Recon}}`

APIセキュリティエンパイアに入る最初の門は、APIインフラストラクチャに関する情報を収集し、APIの強力なリコンを実行して、インフラストラクチャ全体を危険にさらす可能性のある隠されたドアを抽出する方法を知ることです。したがって、最新のツールとAPIリコンの方法論を備えた、この更新されたAPIリコンマインドマップを提供します：

\
![](https://github.com/Cyber-Guy1/API-SecurityEmpire/blob/main/assets/API%20Pentesting%20Mindmap.png)

[**PDFバージョン**](https://github.com/Cyber-Guy1/API-SecurityEmpire/blob/main/assets/API%20Pentesting%20Mindmap.pdf) **|** [**XMindバージョン**](https://github.com/Cyber-Guy1/API-SecurityEmpire/blob/main/assets/API%20Pentesting%20Mindmap.xmind)

#### ⚔️ 必要な武器：

* [BurpSuite](https://portswigger.net/burp/releases)
* [FFUF](https://github.com/ffuf/ffuf)
* [Arjun](https://github.com/InsiderPhD/Arjun)
* [Postman](https://www.postman.com/downloads/)
* [SecLists](https://github.com/danielmiessler/SecLists/tree/master/Discovery/Web-Content)
* [FuzzDB](https://github.com/fuzzdb-project/fuzzdb)
* [SoapUI](https://www.soapui.org/downloads/soapui/)
* [GraphQL Voyager](https://apis.guru/graphql-voyager/)
* [Kiterunner](https://github.com/assetnote/kiterunner)
* [unfurl](https://github.com/tomnomnom/unfurl)

#### 🏋️ あなたの能力と武器をテストする：

* [vapi](https://github.com/roottusk/vapi)
* [Generic-University](https://github.com/InsiderPhD/Generic-University)

### 🚪 二番目の門：`{{Attacking}}`

#### RESTful & SOAPを攻撃する：

![](https://github.com/Cyber-Guy1/API-SecurityEmpire/blob/main/assets/API%20Pentesting%20Mindmap%20ATTACK.png)\
[**PDFバージョン**](https://github.com/Cyber-Guy1/API-SecurityEmpire/blob/main/assets/API%20Pentesting%20Mindmap%20ATTACK.pdf) **|** [**XMindバージョン**](https://github.com/Cyber-Guy1/API-SecurityEmpire/blob/main/assets/API%20Pentesting%20Mindmap%20ATTACK.xmind)\\

#### GraphQLを攻撃する：

GraphQLの攻撃が限られているため、APIテストの経験に基づいて、以下のマインドマップで可能なすべての攻撃を生成しようとしました：

![](https://github.com/Cyber-Guy1/API-SecurityEmpire/blob/main/assets/API%20Pentesting%20Mindmap%20%7B%7BGraphQL%20Attacking%7D%7D.png)\
[**PDFバージョン**](https://github.com/Cyber-Guy1/API-SecurityEmpire/blob/main/assets/API%20Pentesting%20Mindmap%20%7B%7BGraphQL%20Attacking%7D%7D.pdf) **|** [**XMindバージョン**](https://github.com/Cyber-Guy1/API-SecurityEmpire/blob/main/assets/API%20Pentesting%20Mindmap%20%7B%7BGraphQL%20Attacking%7D%7D.xmind)\\

## Owasp APIセキュリティトップ10

Owaspトップ10 APIの脆弱性を**検索**して**悪用**する方法を学ぶには、このドキュメントを読んでください：[https://github.com/OWASP/API-Security/blob/master/2019/en/dist/owasp-api-security-top-10.pdf](https://github.com/OWASP/API-Security/blob/master/2019/en/dist/owasp-api-security-top-10.pdf)

## APIセキュリティチェックリスト

{% embed url="https://github.com/shieldfy/API-Security-Checklist" %}

## API脆弱性ハンティング用Logger++フィルター

[https://github.com/bnematzadeh/LoggerPlusPlus-API-Filters](https://github.com/bnematzadeh/LoggerPlusPlus-API-Filters)

## 可能なAPIエンドポイントのリスト

[https://gist.github.com/yassineaboukir/8e12adefbd505ef704674ad6ad48743d](https://gist.github.com/yassineaboukir/8e12adefbd505ef704674ad6ad48743d)

## ツール

* [**kiterunner**](
```bash
kr scan https://domain.com/api/ -w routes-large.kite -x 20 # Downloaded from kiterunner repo
kr scan https://domain.com/api/ -A=apiroutes-220828 -x 20
kr brute https://domain.com/api/ -A=raft-large-words -x 20 -d=0
kr brute https://domain.com/api/ -w /tmp/lang-english.txt -x 20 -d=0
```
* [**automatic-api-attack-tool**](https://github.com/imperva/automatic-api-attack-tool): Impervaのカスタマイズ可能なAPI攻撃ツールは、API仕様を入力として受け取り、それに基づいた攻撃を生成して実行します。
* [**Astra**](https://github.com/flipkart-incubator/Astra): 複数の異なるWeb脆弱性を見つけるためのAPIテストツールです。
* [**Susanoo**](https://github.com/ant4g0nist/Susanoo): 脆弱性APIスキャナー。
* [**restler-fuzzer**](https://github.com/microsoft/restler-fuzzer): RESTlerは、_最初の状態を持つREST APIファジングツール_で、REST APIを通じてクラウドサービスを自動的にテストし、これらのサービスのセキュリティと信頼性のバグを見つけます。OpenAPI/Swagger仕様を持つクラウドサービスに対して、RESTlerはその仕様全体を分析し、サービスをREST APIを通じて実行するテストを生成して実行します。
* [**TnT-Fuzzer**](https://github.com/Teebytes/TnT-Fuzzer)**:** TnT-Fuzzerは、pythonで書かれたOpenAPI（swagger）ファジャーです。
* [**APIFuzzer**](https://github.com/KissPeter/APIFuzzer)**:** APIFuzzerはAPIの説明を読み、段階的にフィールドをファジングして、アプリケーションがファジングされたパラメーターを処理できるかどうかを検証します。
* [**API-fuzzer**](https://github.com/Fuzzapi/API-fuzzer): API\_Fuzzer gemはAPIリクエストを入力として受け取り、APIにおける可能性のある脆弱性を返します。
* [**race-the-web**](https://github.com/TheHackerDev/race-the-web): Webアプリケーションでのレースコンディションをテストするために、ユーザー指定のリクエスト数を_同時に_ターゲットURL（またはURL）に送信し、サーバーからの応答の一意性を比較します。

<figure><img src="../../.gitbook/assets/image (3) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

[**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks)を使用して、世界で**最も進んだ**コミュニティツールによって動力を供給される**ワークフローを簡単に構築し自動化**します。\
今すぐアクセス：

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)で</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>AWSハッキングをゼロからヒーローまで学ぶ</strong></a><strong>！</strong></summary>

HackTricksをサポートする他の方法：

* **HackTricksに広告を掲載したい**、または**HackTricksをPDFでダウンロードしたい**場合は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS & HackTricksグッズ**](https://peass.creator-spring.com)を入手する
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFT**](https://opensea.io/collection/the-peass-family)コレクションをチェックする
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)に**参加する**か、[**テレグラムグループ**](https://t.me/peass)に参加する、または**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)を**フォローする**。
* [**HackTricks**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のgithubリポジトリにPRを提出して、あなたのハッキングのコツを**共有する**。

</details>
