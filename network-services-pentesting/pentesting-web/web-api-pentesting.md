# Pentestage des API Web

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Travaillez-vous dans une **entreprise de cybers√©curit√©** ? Voulez-vous voir votre **entreprise annonc√©e dans HackTricks** ? ou voulez-vous avoir acc√®s √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**üí¨**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR au** [**repo hacktricks**](https://github.com/carlospolop/hacktricks) **et au** [**repo hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

<figure><img src="../../.gitbook/assets/image (3).png" alt=""><figcaption></figcaption></figure>

Utilisez [**Trickest**](https://trickest.io/) pour cr√©er et **automatiser des flux de travail** aliment√©s par les outils communautaires les plus avanc√©s au monde.\
Obtenez un acc√®s aujourd'hui :

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## Informations de base

Principales :

* **Services Web (SOAP/XML)**
* La documentation utilise le format **WSDL** et est g√©n√©ralement enregistr√©e dans le chemin `?wsdl` comme `https://api.example.com/api/?wsdl`
* Un exemple de cette documentation peut √™tre trouv√© sur [http://www.dneonline.com/calculator.asmx](http://www.dneonline.com/calculator.asmx) (document WSDL sur [http://www.dneonline.com/calculator.asmx?wsdl](http://www.dneonline.com/calculator.asmx?wsdl)) et vous pouvez voir un exemple de requ√™te appelant la m√©thode `Add` sur [http://www.dneonline.com/calculator.asmx?op=Add](http://www.dneonline.com/calculator.asmx?op=Add)
* Pour analyser ces fichiers et cr√©er des requ√™tes d'exemple, vous pouvez utiliser l'outil **SOAPUI** ou l'extension **WSDLer** de Burp Suite.
* **API REST (JSON)**
* La documentation standard est le fichier WADL. Trouvez un exemple ici : [https://www.w3.org/Submission/wadl/](https://www.w3.org/Submission/wadl/). Cependant, il existe d'autres moteurs de repr√©sentation d'API plus conviviaux pour les d√©veloppeurs comme [https://swagger.io/tools/swagger-ui/](https://swagger.io/tools/swagger-ui/) (consultez la d√©mo sur la page)
* Pour analyser ces fichiers et cr√©er des requ√™tes d'exemple, vous pouvez utiliser l'outil **Postman**
* [**GraphQL**](graphql.md)

## Laboratoires

* [**VAmPI**](https://github.com/erev0s/VAmPI)**:** VAmPI est une API vuln√©rable cr√©√©e avec Flask et elle inclut des vuln√©rabilit√©s issues du top 10 des vuln√©rabilit√©s OWASP pour les API.

## Astuces

### SOAP/XML

Ce type d'API peut √™tre [**vuln√©rable aux XXE**](../../pentesting-web/xxe-xee-xml-external-entity.md), mais g√©n√©ralement les **d√©clarations DTD** sont **interdites** dans les entr√©es de l'utilisateur.

Vous pouvez √©galement essayer d'utiliser des balises CDATA pour ins√©rer des charges utiles (tant que le XML est valide)

![](<../../.gitbook/assets/image (534).png>)

### V√©rifier l'acc√®s

G√©n√©ralement, certains points d'extr√©mit√© de l'API n√©cessitent plus de privil√®ges que d'autres. Essayez toujours d'acc√©der aux points d'extr√©mit√© les plus privil√©gi√©s √† partir de comptes moins privil√©gi√©s (non autoris√©s) pour voir si c'est possible.

### CORS

V√©rifiez toujours la configuration [**CORS**](../../pentesting-web/cors-bypass.md) de l'API, car si elle permet de terminer la requ√™te avec les informations d'identification du domaine de l'attaquant, beaucoup de dommages peuvent √™tre caus√©s via [**CSRF**](../../pentesting-web/csrf-cross-site-request-forgery.md) √† partir de victimes authentifi√©es.

### Mod√®les

Recherchez des mod√®les d'API √† l'int√©rieur de l'API et essayez de les utiliser pour en d√©couvrir davantage.\
Si vous trouvez _/api/albums/**\<album\_id>**/photos/**\<photo\_id>**_\*\* \*\* vous pouvez √©galement essayer des choses comme _/api/**posts**/\<post\_id>/**comment**/_. Utilisez un fuzzer pour d√©couvrir ces nouveaux points d'extr√©mit√©.

### Ajouter des param√®tres

Quelque chose comme l'exemple suivant pourrait vous donner acc√®s √† l'album photo d'un autre utilisateur :\
_/api/MyPictureList ‚Üí /api/MyPictureList?**user\_id=\<other\_user\_id>**_

### Remplacer les param√®tres

Vous pouvez essayer de **fuzzer les param√®tres** ou d'utiliser des param√®tres **que vous avez vus** dans d'autres points d'extr√©mit√© pour essayer d'acc√©der √† d'autres informations.

Par exemple, si vous voyez quelque chose comme : _/api/albums?**album\_id=\<album id>**_

Vous pouvez **remplacer** le param√®tre **`album_id`** par quelque chose de compl√®tement diff√©rent et potentiellement obtenir d'autres donn√©es : _/api/albums?**account\_id=\<account id>**_
### Pollution de param√®tres

/api/account?**id=\<votre identifiant de compte>** ‚Üí /api/account?**id=\<votre identifiant de compte>\&id=\<identifiant de compte de l'administrateur>**

### Param√®tre g√©n√©rique

Essayez d'utiliser les symboles suivants comme param√®tres g√©n√©riques : **\***, **%**, **\_**, **.**

* /api/users/\*
* /api/users/%
* /api/users/\_
* /api/users/.

### Changement de m√©thode de requ√™te HTTP

Vous pouvez essayer d'utiliser les m√©thodes HTTP : **GET, POST, PUT, DELETE, PATCH, INVENTED** pour v√©rifier si le serveur web vous donne des informations inattendues avec elles.

### Type de contenu de la requ√™te

Essayez de jouer avec les types de contenu suivants (en modifiant en cons√©quence le corps de la requ√™te) pour que le serveur web se comporte de mani√®re inattendue :

* **x-www-form-urlencoded** --> user=test
* **application/xml** --> \<user>test\</user>
* **application/json** --> {"user": "test"}

### Types de param√®tres

Si les donn√©es **JSON** fonctionnent, essayez d'envoyer des types de donn√©es inattendus comme :

* {"username": "John"}
* {"username": true}
* {"username": null}
* {"username": 1}
* {"username": \[true]}
* {"username": \["John", true]}
* {"username": {"$neq": "lalala"\}}
* toute autre combinaison que vous pouvez imaginer

Si vous pouvez envoyer des donn√©es **XML**, v√©rifiez les [injections XXE](../../pentesting-web/xxe-xee-xml-external-entity.md).

Si vous envoyez des donn√©es POST r√©guli√®res, essayez d'envoyer des tableaux et des dictionnaires :

* username\[]=John
* username\[$neq]=lalala

### Jouez avec les routes

`/files/..%2f..%2f + ID de la victime + %2f + nom de fichier de la victime`

### V√©rifiez les versions possibles

Les anciennes versions peuvent encore √™tre utilis√©es et √™tre plus vuln√©rables que les derniers points d'acc√®s

* `/api/v1/login`
* `/api/v2/login`\\
* `/api/CharityEventFeb2020/user/pp/<ID>`
* `/api/CharityEventFeb2021/user/pp/<ID>`

### V√©rifiez les versions possibles (approche automatis√©e)

Extension AutoRepeater Burp : Ajoutez une r√®gle de remplacement

* `Type : Cha√Æne de requ√™te`
* `Correspondance : v2 (version sup√©rieure)`
* `Remplacer : v1 (version inf√©rieure)`

![](../.gitbook/assets/image%20\(9\)%20\(1\)%20\(2\).png)

\
Utilisez [**Trickest**](https://trickest.io/) pour cr√©er et automatiser facilement des flux de travail aliment√©s par les outils communautaires les plus avanc√©s au monde.\
Acc√©dez d√®s aujourd'hui :

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## üõ°Ô∏è Feuille de triche de l'Empire de la s√©curit√© des API

\
Auteur de la feuille de triche : [Momen Eldawakhly (Cyber Guy)](https://www.linkedin.com/in/momen-eldawakhly-3b6250204)\
\
Dans ce r√©f√©rentiel, vous trouverez : des cartes mentales, des astuces, des ressources et tout ce qui concerne la s√©curit√© des API et les tests de p√©n√©tration des API. Nos cartes mentales et nos ressources sont bas√©es sur le TOP 10 API de l'OWASP, notre exp√©rience en mati√®re de tests de p√©n√©tration et d'autres ressources pour fournir la ressource la plus avanc√©e et pr√©cise en mati√®re de s√©curit√© des API et de tests de p√©n√©tration sur le WEB !!

### üö™ Premi√®re porte : `{{Reconnaissance}}`

La premi√®re porte pour entrer dans l'Empire de la s√©curit√© des API est de savoir comment recueillir des informations sur l'infrastructure de l'API et comment effectuer une reconnaissance puissante sur l'API pour extraire les portes cach√©es qui compromettent toute l'infrastructure, nous vous proposons donc cette carte mentale de reconnaissance de l'API mise √† jour avec les derniers outils et m√©thodologies en mati√®re de reconnaissance de l'API :

\
![](https://github.com/Cyber-Guy1/API-SecurityEmpire/blob/main/assets/API%20Pentesting%20Mindmap.png)

[**Version PDF**](https://github.com/Cyber-Guy1/API-SecurityEmpire/blob/main/assets/API%20Pentesting%20Mindmap.pdf) **|** [**Version XMind**](https://github.com/Cyber-Guy1/API-SecurityEmpire/blob/main/assets/API%20Pentesting%20Mindmap.xmind)

#### ‚öîÔ∏è Les armes dont vous aurez besoin :

* [BurpSuite](https://portswigger.net/burp/releases)
* [FFUF](https://github.com/ffuf/ffuf)
* [Arjun](https://github.com/InsiderPhD/Arjun)
* [Postman](https://www.postman.com/downloads/)
* [SecLists](https://github.com/danielmiessler/SecLists/tree/master/Discovery/Web-Content)
* [FuzzDB](https://github.com/fuzzdb-project/fuzzdb)
* [SoapUI](https://www.soapui.org/downloads/soapui/)
* [GraphQL Voyager](https://apis.guru/graphql-voyager/)
* [Kiterunner](https://github.com/assetnote/kiterunner)
* [unfurl](https://github.com/tomnomnom/unfurl)

#### üèãÔ∏è Testez vos comp√©tences et vos armes :

* [vapi](https://github.com/roottusk/vapi)
* [Generic-University](https://github.com/InsiderPhD/Generic-University)

### üö™ Deuxi√®me porte : `{{Attaque}}`

#### Attaque RESTful & SOAP :

![](https://github.com/Cyber-Guy1/API-SecurityEmpire/blob/main/assets/API%20Pentesting%20Mindmap%20ATTACK.png)\
[**Version PDF**](https://github.com/Cyber-Guy1/API-SecurityEmpire/blob/main/assets/API%20Pentesting%20Mindmap%20ATTACK.pdf) **|** [**Version XMind**](https://github.com/Cyber-Guy1/API-SecurityEmpire/blob/main/assets/API%20Pentesting%20Mindmap%20ATTACK.xmind)\\

#### Attaque GraphQL :

En raison des attaques limit√©es dans le GraphQL, nous avons essay√© de g√©n√©rer toutes les attaques possibles en fonction de notre exp√©rience dans les tests d'API dans la carte mentale suivante :

![](https://github.com/Cyber-Guy1/API-SecurityEmpire/blob/main/assets/API%20Pentesting%20Mindmap%20%7B%7BGraphQL%20Attacking%7D%7D.png)\
[**Version PDF**](https://github.com/Cyber-Guy1/API-SecurityEmpire/blob/main/assets/API%20Pentesting%20Mindmap%20%7B%7BGraphQL%20Attacking%7D%7D.pdf) **|** [**Version XMind**](https://github.com/Cyber-Guy1/API-SecurityEmpire/blob/main/assets/API%20Pentesting%20Mindmap%20%7B%7BGraphQL%20Attacking%7D%7D.xmind)\\
## Owasp API Security Top 10

Lisez ce document pour apprendre comment **rechercher** et **exploiter** les 10 principales vuln√©rabilit√©s API d'Owasp: [https://github.com/OWASP/API-Security/blob/master/2019/fr/dist/owasp-api-security-top-10.pdf](https://github.com/OWASP/API-Security/blob/master/2019/fr/dist/owasp-api-security-top-10.pdf)

## Liste de contr√¥le de s√©curit√© des API

{% embed url="https://github.com/shieldfy/API-Security-Checklist" %}

## Filtres Logger++ pour la recherche de vuln√©rabilit√©s API

[https://github.com/bnematzadeh/LoggerPlusPlus-API-Filters](https://github.com/bnematzadeh/LoggerPlusPlus-API-Filters)

## Liste des points d'extr√©mit√© API possibles

[https://gist.github.com/yassineaboukir/8e12adefbd505ef704674ad6ad48743d](https://gist.github.com/yassineaboukir/8e12adefbd505ef704674ad6ad48743d)

## Outils

* [**kiterunner**](https://github.com/assetnote/kiterunner): Excellent outil pour **d√©couvrir les points d'extr√©mit√© API.**
```bash
kr scan https://domain.com/api/ -w routes-large.kite -x 20 # Downloaded from kiterunner repo
kr scan https://domain.com/api/ -A=apiroutes-220828 -x 20
kr brute https://domain.com/api/ -A=raft-large-words -x 20 -d=0
kr brute https://domain.com/api/ -w /tmp/lang-english.txt -x 20 -d=0
```
* [**automatic-api-attack-tool**](https://github.com/imperva/automatic-api-attack-tool) : Outil d'attaque d'API personnalisable d'Imperva qui prend une sp√©cification d'API en entr√©e, g√©n√®re et ex√©cute des attaques bas√©es sur celle-ci en sortie.
* [**Astra**](https://github.com/flipkart-incubator/Astra) : Un autre outil de test d'API pour trouver plusieurs vuln√©rabilit√©s web diff√©rentes.
* [**Susanoo**](https://github.com/ant4g0nist/Susanoo) : Scanner de vuln√©rabilit√© d'API.
* [**restler-fuzzer**](https://github.com/microsoft/restler-fuzzer) : RESTler est le _premier outil de fuzzing d'API REST √©tatique_ pour tester automatiquement les services cloud via leurs API REST et trouver des bugs de s√©curit√© et de fiabilit√© dans ces services. Pour un service cloud donn√© avec une sp√©cification OpenAPI/Swagger, RESTler analyse l'ensemble de sa sp√©cification, puis g√©n√®re et ex√©cute des tests qui exploitent le service via son API REST.
* [**TnT-Fuzzer**](https://github.com/Teebytes/TnT-Fuzzer)**:** TnT-Fuzzer est un fuzzer OpenAPI (swagger) √©crit en python.
* [**APIFuzzer**](https://github.com/KissPeter/APIFuzzer)**:** APIFuzzer lit la description de votre API et fuzz les champs √©tape par √©tape pour valider si votre application peut g√©rer les param√®tres fuzz√©s.
* [**API-fuzzer**](https://github.com/Fuzzapi/API-fuzzer) : Le gem API\_Fuzzer accepte une requ√™te API en entr√©e et renvoie les vuln√©rabilit√©s possibles dans l'API.
* [**race-the-web**](https://github.com/TheHackerDev/race-the-web) : Teste les conditions de concurrence dans les applications web en envoyant un nombre sp√©cifi√© de requ√™tes vers une URL cible (ou des URL) _simultan√©ment_, puis compare les r√©ponses du serveur pour d√©terminer leur unicit√©.

<figure><img src="../../.gitbook/assets/image (3).png" alt=""><figcaption></figcaption></figure>

Utilisez [**Trickest**](https://trickest.io/) pour cr√©er et automatiser facilement des flux de travail aliment√©s par les outils communautaires les plus avanc√©s au monde.\
Obtenez un acc√®s d√®s aujourd'hui :

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Vous travaillez dans une **entreprise de cybers√©curit√©** ? Vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ? ou souhaitez-vous avoir acc√®s √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFT**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**üí¨**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR au** [**repo hacktricks**](https://github.com/carlospolop/hacktricks) **et au** [**repo hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
