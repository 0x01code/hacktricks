# Pentesting de Web API

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* ¬øTrabajas en una **empresa de ciberseguridad**? ¬øQuieres ver tu **empresa anunciada en HackTricks**? ¬øO quieres tener acceso a la **√∫ltima versi√≥n de PEASS o descargar HackTricks en PDF**? ¬°Consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obt√©n el [**swag oficial de PEASS y HackTricks**](https://peass.creator-spring.com)
* **√önete al** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de Telegram**](https://t.me/peass) o **s√≠gueme** en **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Comparte tus trucos de hacking enviando PRs al** [**repositorio de hacktricks**](https://github.com/carlospolop/hacktricks) **y al** [**repositorio de hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

<figure><img src="../../.gitbook/assets/image (3) (1).png" alt=""><figcaption></figcaption></figure>

Usa [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) para construir y **automatizar flujos de trabajo** con las herramientas comunitarias m√°s avanzadas del mundo.\
Obt√©n acceso hoy mismo:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## Informaci√≥n b√°sica

Principal:

* **Servicios web (SOAP/XML)**
* La documentaci√≥n utiliza el formato **WSDL** y generalmente se guarda en la ruta `?wsdl`, como `https://api.example.com/api/?wsdl`
* Un ejemplo de esta documentaci√≥n se puede encontrar en [http://www.dneonline.com/calculator.asmx](http://www.dneonline.com/calculator.asmx) (documento WSDL en [http://www.dneonline.com/calculator.asmx?wsdl](http://www.dneonline.com/calculator.asmx?wsdl)) y puedes ver una solicitud de ejemplo llamando al m√©todo `Add` en [http://www.dneonline.com/calculator.asmx?op=Add](http://www.dneonline.com/calculator.asmx?op=Add)
* Para analizar estos archivos y crear solicitudes de ejemplo, puedes usar la herramienta **SOAPUI** o la extensi√≥n **WSDLer** de Burp Suite.
* **APIs REST (JSON)**
* La documentaci√≥n est√°ndar es el archivo WADL. Encuentra un ejemplo aqu√≠: [https://www.w3.org/Submission/wadl/](https://www.w3.org/Submission/wadl/). Sin embargo, existen otros motores de representaci√≥n de API m√°s amigables para los desarrolladores, como [https://swagger.io/tools/swagger-ui/](https://swagger.io/tools/swagger-ui/) (consulta la demostraci√≥n en la p√°gina)
* Para analizar estos archivos y crear solicitudes de ejemplo, puedes usar la herramienta **Postman**
* [**GraphQL**](graphql.md)

## Laboratorios

* [**VAmPI**](https://github.com/erev0s/VAmPI)**:** VAmPI es una API vulnerable hecha con Flask e incluye vulnerabilidades de las 10 principales vulnerabilidades de la OWASP para APIs.

## Trucos

### SOAP/XML

Este tipo de APIs pueden ser [**vulnerables a XXE**](../../pentesting-web/xxe-xee-xml-external-entity.md), pero generalmente las **Declaraciones DTD** est√°n **deshabilitadas** en la entrada del usuario.

Tambi√©n puedes intentar usar etiquetas CDATA para insertar payloads (siempre que el XML sea v√°lido)

![](<../../.gitbook/assets/image (534).png>)

### Verificar acceso

Por lo general, algunos puntos finales de la API requerir√°n m√°s privilegios que otros. Siempre intenta acceder a los puntos finales m√°s privilegiados desde cuentas menos privilegiadas (no autorizadas) para ver si es posible.

### CORS

Siempre verifica la configuraci√≥n de [**CORS**](../../pentesting-web/cors-bypass.md) de la API, ya que si permite finalizar la solicitud con las credenciales del dominio del atacante, se puede causar mucho da√±o a trav√©s de [**CSRF**](../../pentesting-web/csrf-cross-site-request-forgery.md) en v√≠ctimas autenticadas.

### Patrones

Busca patrones de API dentro de la API y trata de usarlos para descubrir m√°s.\
Si encuentras _/api/albums/**\<album\_id>**/photos/**\<photo\_id>**_\*\* \*\* tambi√©n podr√≠as probar cosas como _/api/**posts**/\<post\_id>/**comment**/_. Usa alg√∫n fuzzer para descubrir estos nuevos puntos finales.

### Agregar par√°metros

Algo como el siguiente ejemplo podr√≠a darte acceso al √°lbum de fotos de otro usuario:\
_/api/MyPictureList ‚Üí /api/MyPictureList?**user\_id=\<other\_user\_id>**_

### Reemplazar par√°metros

Puedes intentar **fuzzear par√°metros** o **usar** par√°metros **que hayas visto** en otros puntos finales para intentar acceder a otra informaci√≥n.

Por ejemplo, si ves algo como: _/api/albums?**album\_id=\<album id>**_

Podr√≠as **reemplazar** el par√°metro **`album_id`** con algo completamente diferente y potencialmente obtener otros datos: _/api/albums?**account\_id=\<account id>**_
### Contaminaci√≥n de par√°metros

/api/account?**id=\<tu id de cuenta>** ‚Üí /api/account?**id=\<tu id de cuenta>\&id=\<id de cuenta del administrador>**

### Par√°metro comod√≠n

Intenta usar los siguientes s√≠mbolos como comodines: **\***, **%**, **\_**, **.**

* /api/users/\*
* /api/users/%
* /api/users/\_
* /api/users/.

### Cambio del m√©todo de solicitud HTTP

Puedes intentar usar los m√©todos HTTP: **GET, POST, PUT, DELETE, PATCH, INVENTED** para verificar si el servidor web te proporciona informaci√≥n inesperada con ellos.

### Tipo de contenido de la solicitud

Intenta jugar con los siguientes tipos de contenido (modificando en consecuencia el cuerpo de la solicitud) para hacer que el servidor web se comporte de manera inesperada:

* **x-www-form-urlencoded** --> user=test
* **application/xml** --> \<user>test\</user>
* **application/json** --> {"user": "test"}

### Tipos de par√°metros

Si los datos **JSON** funcionan, intenta enviar tipos de datos inesperados como:

* {"username": "John"}
* {"username": true}
* {"username": null}
* {"username": 1}
* {"username": \[true]}
* {"username": \["John", true]}
* {"username": {"$neq": "lalala"\}}
* cualquier otra combinaci√≥n que puedas imaginar

Si puedes enviar datos **XML**, verifica las [inyecciones XXE](../../pentesting-web/xxe-xee-xml-external-entity.md).

Si env√≠as datos POST regulares, intenta enviar matrices y diccionarios:

* username\[]=John
* username\[$neq]=lalala

### Juega con las rutas

`/files/..%2f..%2f + ID de la v√≠ctima + %2f + nombre de archivo de la v√≠ctima`

### Verifica posibles versiones

Es posible que las versiones antiguas a√∫n se est√©n utilizando y sean m√°s vulnerables que los √∫ltimos puntos finales

* `/api/v1/login`
* `/api/v2/login`\\
* `/api/CharityEventFeb2020/user/pp/<ID>`
* `/api/CharityEventFeb2021/user/pp/<ID>`

### Verifica posibles versiones (enfoque automatizado)

Extensi√≥n AutoRepeater de Burp: Agrega una regla de reemplazo

* `Tipo: Cadena de solicitud`
* `Coincidencia: v2 (versi√≥n superior)`
* `Reemplazar: v1 (versi√≥n inferior)`

<figure><img src="../../.gitbook/assets/image (3) (1).png" alt=""><figcaption></figcaption></figure>

\
Utiliza [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) para construir y **automatizar flujos de trabajo** f√°cilmente con las herramientas comunitarias m√°s avanzadas del mundo.\
Obt√©n acceso hoy mismo:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## üõ°Ô∏è Hoja de trucos de API Security Empire

\
Autor de la hoja de trucos: [Momen Eldawakhly (Cyber Guy)](https://www.linkedin.com/in/momen-eldawakhly-3b6250204)\
\
En este repositorio encontrar√°s: mapas mentales, consejos y trucos, recursos y todo lo relacionado con la seguridad de API y la prueba de penetraci√≥n de API. Nuestros mapas mentales y recursos se basan en OWASP TOP 10 API, nuestra experiencia en pruebas de penetraci√≥n y otros recursos para ofrecer el recurso de seguridad de API y prueba de penetraci√≥n m√°s avanzado y preciso en la WEB.

### üö™ Primer paso: `{{Reconocimiento}}`

El primer paso para ingresar al Imperio de Seguridad de API es saber c√≥mo recopilar informaci√≥n sobre la infraestructura de la API y c√≥mo realizar un reconocimiento poderoso en la API para extraer las puertas ocultas que podr√≠an comprometer toda la infraestructura. Por lo tanto, proporcionamos este mapa mental actualizado de Reconocimiento de API con las √∫ltimas herramientas y metodolog√≠as en el reconocimiento de API:

\
![](https://github.com/Cyber-Guy1/API-SecurityEmpire/blob/main/assets/API%20Pentesting%20Mindmap.png)

[**Versi√≥n en PDF**](https://github.com/Cyber-Guy1/API-SecurityEmpire/blob/main/assets/API%20Pentesting%20Mindmap.pdf) **|** [**Versi√≥n en XMind**](https://github.com/Cyber-Guy1/API-SecurityEmpire/blob/main/assets/API%20Pentesting%20Mindmap.xmind)

#### ‚öîÔ∏è Armas que necesitar√°s:

* [BurpSuite](https://portswigger.net/burp/releases)
* [FFUF](https://github.com/ffuf/ffuf)
* [Arjun](https://github.com/InsiderPhD/Arjun)
* [Postman](https://www.postman.com/downloads/)
* [SecLists](https://github.com/danielmiessler/SecLists/tree/master/Discovery/Web-Content)
* [FuzzDB](https://github.com/fuzzdb-project/fuzzdb)
* [SoapUI](https://www.soapui.org/downloads/soapui/)
* [GraphQL Voyager](https://apis.guru/graphql-voyager/)
* [Kiterunner](https://github.com/assetnote/kiterunner)
* [unfurl](https://github.com/tomnomnom/unfurl)

#### üèãÔ∏è Pon a prueba tus habilidades y armas:

* [vapi](https://github.com/roottusk/vapi)
* [Generic-University](https://github.com/InsiderPhD/Generic-University)

### üö™ Segundo paso: `{{Ataque}}`

#### Ataque a RESTful y SOAP:

![](https://github.com/Cyber-Guy1/API-SecurityEmpire/blob/main/assets/API%20Pentesting%20Mindmap%20ATTACK.png)\
[**Versi√≥n en PDF**](https://github.com/Cyber-Guy1/API-SecurityEmpire/blob/main/assets/API%20Pentesting%20Mindmap%20ATTACK.pdf) **|** [**Versi√≥n en XMind**](https://github.com/Cyber-Guy1/API-SecurityEmpire/blob/main/assets/API%20Pentesting%20Mindmap%20ATTACK.xmind)\\

#### Ataque a GraphQL:

Debido a los ataques limitados en GraphQL, intentamos generar todos los posibles ataques en el siguiente mapa mental, bas√°ndonos en nuestra experiencia en pruebas de API:

![](https://github.com/Cyber-Guy1/API-SecurityEmpire/blob/main/assets/API%20Pentesting%20Mindmap%20%7B%7BGraphQL%20Attacking%7D%7D.png)\
[**Versi√≥n en PDF**](https://github.com/Cyber-Guy1/API-SecurityEmpire/blob/main/assets/API%20Pentesting%20Mindmap%20%7B%7BGraphQL%20Attacking%7D%7D.pdf) **|** [**Versi√≥n en XMind**](https://github.com/Cyber-Guy1/API-SecurityEmpire/blob/main/assets/API%20Pentesting%20Mindmap%20%7B%7BGraphQL%20Attacking%7D%7D.xmind)\\
## Owasp API Security Top 10

Lee este documento para aprender c√≥mo **buscar** y **explotar** las 10 principales vulnerabilidades de API de Owasp: [https://github.com/OWASP/API-Security/blob/master/2019/es/dist/owasp-api-security-top-10.pdf](https://github.com/OWASP/API-Security/blob/master/2019/es/dist/owasp-api-security-top-10.pdf)

## Lista de verificaci√≥n de seguridad de API

{% embed url="https://github.com/shieldfy/API-Security-Checklist" %}

## Filtros Logger++ para buscar vulnerabilidades de API

[https://github.com/bnematzadeh/LoggerPlusPlus-API-Filters](https://github.com/bnematzadeh/LoggerPlusPlus-API-Filters)

## Lista de posibles puntos finales de API

[https://gist.github.com/yassineaboukir/8e12adefbd505ef704674ad6ad48743d](https://gist.github.com/yassineaboukir/8e12adefbd505ef704674ad6ad48743d)

## Herramientas

* [**kiterunner**](https://github.com/assetnote/kiterunner): Excelente herramienta para **descubrir puntos finales de API.**
```bash
kr scan https://domain.com/api/ -w routes-large.kite -x 20 # Downloaded from kiterunner repo
kr scan https://domain.com/api/ -A=apiroutes-220828 -x 20
kr brute https://domain.com/api/ -A=raft-large-words -x 20 -d=0
kr brute https://domain.com/api/ -w /tmp/lang-english.txt -x 20 -d=0
```
* [**automatic-api-attack-tool**](https://github.com/imperva/automatic-api-attack-tool): Herramienta de ataque API personalizable de Imperva que toma una especificaci√≥n de API como entrada, genera y ejecuta ataques basados en ella como salida.
* [**Astra**](https://github.com/flipkart-incubator/Astra): Otra herramienta para pruebas de API para encontrar varias vulnerabilidades web diferentes.
* [**Susanoo**](https://github.com/ant4g0nist/Susanoo): Esc√°ner de vulnerabilidades de API.
* [**restler-fuzzer**](https://github.com/microsoft/restler-fuzzer): RESTler es la _primera herramienta de fuzzing de API REST con estado_ para probar autom√°ticamente servicios en la nube a trav√©s de sus API REST y encontrar errores de seguridad y confiabilidad en estos servicios. Para un servicio en la nube dado con una especificaci√≥n OpenAPI/Swagger, RESTler analiza toda su especificaci√≥n y luego genera y ejecuta pruebas que ejercen el servicio a trav√©s de su API REST.
* [**TnT-Fuzzer**](https://github.com/Teebytes/TnT-Fuzzer)**:** TnT-Fuzzer es un fuzzer OpenAPI (swagger) escrito en Python.
* [**APIFuzzer**](https://github.com/KissPeter/APIFuzzer)**:** APIFuzzer lee la descripci√≥n de tu API y, paso a paso, realiza fuzzing en los campos para validar si tu aplicaci√≥n puede manejar los par√°metros fuzzed.
* [**API-fuzzer**](https://github.com/Fuzzapi/API-fuzzer): La gema API\_Fuzzer acepta una solicitud de API como entrada y devuelve las posibles vulnerabilidades en la API.
* [**race-the-web**](https://github.com/TheHackerDev/race-the-web): Pruebas para condiciones de carrera en aplicaciones web enviando un n√∫mero especificado de solicitudes a una URL (o URLs) objetivo _simult√°neamente_, y luego compara las respuestas del servidor para determinar su unicidad.

<figure><img src="../../.gitbook/assets/image (3) (1).png" alt=""><figcaption></figcaption></figure>

Utiliza [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) para construir y **automatizar flujos de trabajo** f√°cilmente con las herramientas comunitarias m√°s avanzadas del mundo.\
Obt√©n acceso hoy mismo:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* ¬øTrabajas en una **empresa de ciberseguridad**? ¬øQuieres ver tu **empresa anunciada en HackTricks**? ¬øO quieres tener acceso a la **√∫ltima versi√≥n de PEASS o descargar HackTricks en PDF**? ¬°Consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obt√©n el [**swag oficial de PEASS y HackTricks**](https://peass.creator-spring.com)
* **√önete al** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de Telegram**](https://t.me/peass) o **s√≠gueme** en **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Comparte tus trucos de hacking enviando PRs al** [**repositorio de hacktricks**](https://github.com/carlospolop/hacktricks) **y al** [**repositorio de hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
