# Teste de Penetra√ß√£o em API Web

<details>

<summary><strong>Aprenda hacking no AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ quer ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**material oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **Junte-se ao grupo** üí¨ [**Discord**](https://discord.gg/hRep4RUj7f) ou ao grupo [**telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) no github.

</details>

<figure><img src="../../.gitbook/assets/image (3) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

Use [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) para construir e **automatizar fluxos de trabalho** com as ferramentas comunit√°rias **mais avan√ßadas** do mundo.\
Obtenha Acesso Hoje:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## Informa√ß√µes B√°sicas

Principais:

* **Servi√ßos Web (SOAP/XML)**
* A documenta√ß√£o utiliza o formato **WSDL** e geralmente √© salva no caminho `?wsdl` como `https://api.example.com/api/?wsdl`
* Um exemplo desta documenta√ß√£o pode ser encontrado em [http://www.dneonline.com/calculator.asmx](http://www.dneonline.com/calculator.asmx) (documento WSDL em [http://www.dneonline.com/calculator.asmx?wsdl](http://www.dneonline.com/calculator.asmx?wsdl)) e voc√™ pode ver um exemplo de solicita√ß√£o chamando o m√©todo `Add` em [http://www.dneonline.com/calculator.asmx?op=Add](http://www.dneonline.com/calculator.asmx?op=Add)
* Para analisar esses arquivos e criar solicita√ß√µes de exemplo, voc√™ pode usar a ferramenta **SOAPUI** ou a extens√£o **WSDLer** do Burp Suite.
* **APIs REST (JSON)**
* A documenta√ß√£o padr√£o √© o arquivo WADL. Encontre um exemplo aqui: [https://www.w3.org/Submission/wadl/](https://www.w3.org/Submission/wadl/). No entanto, existem outros motores de representa√ß√£o de API mais amig√°veis para desenvolvedores como [https://swagger.io/tools/swagger-ui/](https://swagger.io/tools/swagger-ui/) (confira a demonstra√ß√£o na p√°gina)
* Para analisar esses arquivos e criar solicita√ß√µes de exemplo, voc√™ pode usar a ferramenta **Postman**
* [**GraphQL**](graphql.md)

## Laborat√≥rios

* [**VAmPI**](https://github.com/erev0s/VAmPI)**:** VAmPI √© uma API vulner√°vel feita com Flask e inclui vulnerabilidades do top 10 da OWASP para APIs.

## Truques

### SOAP/XML

Esses tipos de APIs podem ser [**vulner√°veis a XXE**](../../pentesting-web/xxe-xee-xml-external-entity.md), mas geralmente **Declara√ß√µes DTD** s√£o **proibidas** na entrada do usu√°rio.

Voc√™ tamb√©m pode tentar usar tags CDATA para inserir cargas √∫teis (desde que o XML seja v√°lido)

![](<../../.gitbook/assets/image (534).png>)

### Verificar Acesso

Geralmente, alguns endpoints de API v√£o precisar de mais privil√©gios do que outros. Sempre tente acessar os endpoints mais privilegiados a partir de contas menos privilegiadas (n√£o autorizadas) para ver se √© poss√≠vel.

### CORS

Sempre verifique a configura√ß√£o de [**CORS**](../../pentesting-web/cors-bypass.md) da API, pois se ela permitir o envio de solicita√ß√µes com as credenciais do dom√≠nio do atacante, muitos danos podem ser causados via [**CSRF**](../../pentesting-web/csrf-cross-site-request-forgery.md) de v√≠timas autenticadas.

### Padr√µes

Procure por padr√µes na API e tente us√°-los para descobrir mais.\
Se voc√™ encontrar _/api/albums/**\<album\_id>**/photos/**\<photo\_id>**_\*\* \*\* voc√™ tamb√©m pode tentar coisas como _/api/**posts**/\<post\_id>/**comment**/_. Use algum fuzzer para descobrir esses novos endpoints.

### Adicionar par√¢metros

Algo como o exemplo a seguir pode dar acesso ao √°lbum de fotos de outro usu√°rio:\
_/api/MyPictureList ‚Üí /api/MyPictureList?**user\_id=\<other\_user\_id>**_

### Substituir par√¢metros

Voc√™ pode tentar **fuzzar par√¢metros** ou **usar** par√¢metros **que voc√™ viu** em diferentes endpoints para tentar acessar outras informa√ß√µes

Por exemplo, se voc√™ ver algo como: _/api/albums?**album\_id=\<album id>**_

Voc√™ poderia **substituir** o par√¢metro **`album_id`** por algo completamente diferente e potencialmente obter outros dados: _/api/albums?**account\_id=\<account id>**_

### Polui√ß√£o de par√¢metros

/api/account?**id=\<your account id>** ‚Üí /api/account?**id=\<your account id>\&id=\<admin's account id>**

### Par√¢metro curinga

Tente usar os seguintes s√≠mbolos como curingas: **\***, **%**, **\_**, **.**

* /api/users/\*
* /api/users/%
* /api/users/\_
* /api/users/.

### Mudan√ßa de m√©todo de solicita√ß√£o HTTP

Voc√™ pode tentar usar os m√©todos HTTP: **GET, POST, PUT, DELETE, PATCH, INVENTED** para verificar se o servidor web fornece informa√ß√µes inesperadas com eles.

### Tipo de conte√∫do da solicita√ß√£o

Tente alternar entre os seguintes tipos de conte√∫do (modificando adequadamente o corpo da solicita√ß√£o) para fazer o servidor web se comportar de maneira inesperada:

* **x-www-form-urlencoded** --> user=test
* **application/xml** --> \<user>test\</user>
* **application/json** --> {"user": "test"}

### Tipos de par√¢metros

Se dados em **JSON** est√£o funcionando, tente enviar tipos de dados inesperados como:

* {"username": "John"}
* {"username": true}
* {"username": null}
* {"username": 1}
* {"username": \[true]}
* {"username": \["John", true]}
* {"username": {"$neq": "lalala"\}}
* qualquer outra combina√ß√£o que voc√™ possa imaginar

Se voc√™ puder enviar dados em **XML**, verifique inje√ß√µes de [XXE](../../pentesting-web/xxe-xee-xml-external-entity.md).

Se voc√™ enviar dados regulares de POST, tente enviar arrays e dicion√°rios:

* username\[]=John
* username\[$neq]=lalala

### Brincar com rotas

`/files/..%2f..%2f + ID da v√≠tima + %2f + nome do arquivo da v√≠tima`

### Verificar poss√≠veis vers√µes

Vers√µes antigas podem ainda estar em uso e ser mais vulner√°veis do que os endpoints mais recentes

* `/api/v1/login`
* `/api/v2/login`\\
* `/api/CharityEventFeb2020/user/pp/<ID>`
* `/api/CharityEventFeb2021/user/pp/<ID>`

### Verificar poss√≠veis vers√µes (abordagem automatizada)

Extens√£o AutoRepeater do Burp: Adicione uma regra de substitui√ß√£o

* `Tipo: String de Solicita√ß√£o`
* `Correspond√™ncia: v2 (vers√£o superior)`
* `Substitui√ß√£o: v1 (vers√£o inferior)`

## üõ°Ô∏è API Security Empire Cheat Sheet

\
Autor do Cheat Sheet: [Momen Eldawakhly (Cyber Guy)](https://www.linkedin.com/in/momen-eldawakhly-3b6250204)\
\
Neste reposit√≥rio voc√™ encontrar√°: Mapas mentais, dicas e truques, recursos e tudo relacionado √† Seguran√ßa de API e Teste de Penetra√ß√£o de API. Nossos mapas mentais e recursos s√£o baseados no OWASP TOP 10 API, nossa experi√™ncia em Testes de Penetra√ß√£o e outros recursos para entregar o recurso de seguran√ßa e teste de penetra√ß√£o de API mais avan√ßado e preciso na WEB!!

### üö™ Primeiro port√£o: `{{Recon}}`

O primeiro port√£o para entrar no Imp√©rio da Seguran√ßa de API √© saber como coletar informa√ß√µes sobre a infraestrutura da API e como realizar um recon poderoso na API para extrair as portas ocultas que podem comprometer toda a infraestrutura, ent√£o, fornecemos este mapa mental de recon de API atualizado com as √∫ltimas ferramentas e metodologias em recon de API:

\
![](https://github.com/Cyber-Guy1/API-SecurityEmpire/blob/main/assets/API%20Pentesting%20Mindmap.png)

[**Vers√£o em PDF**](https://github.com/Cyber-Guy1/API-SecurityEmpire/blob/main/assets/API%20Pentesting%20Mindmap.pdf) **|** [**Vers√£o XMind**](https://github.com/Cyber-Guy1/API-SecurityEmpire/blob/main/assets/API%20Pentesting%20Mindmap.xmind)

#### ‚öîÔ∏è Armas que voc√™ precisar√°:

* [BurpSuite](https://portswigger.net/burp/releases)
* [FFUF](https://github.com/ffuf/ffuf)
* [Arjun](https://github.com/InsiderPhD/Arjun)
* [Postman](https://www.postman.com/downloads/)
* [SecLists](https://github.com/danielmiessler/SecLists/tree/master/Discovery/Web-Content)
* [FuzzDB](https://github.com/fuzzdb-project/fuzzdb)
* [SoapUI](https://www.soapui.org/downloads/soapui/)
* [GraphQL Voyager](https://apis.guru/graphql-voyager/)
* [Kiterunner](https://github.com/assetnote/kiterunner)
* [unfurl](https://github.com/tomnomnom/unfurl)

#### üèãÔ∏è Teste suas habilidades e armas:

* [vapi](https://github.com/roottusk/vapi)
* [Generic-University](https://github.com/InsiderPhD/Generic-University)

### üö™ Segundo port√£o: `{{Atacando}}`

#### Atacando RESTful & SOAP:

![](https://github.com/Cyber-Guy1/API-SecurityEmpire/blob/main/assets/API%20Pentesting%20Mindmap%20ATTACK.png)\
[**Vers√£o em PDF**](https://github.com/Cyber-Guy1/API-SecurityEmpire/blob/main/assets/API%20Pentesting%20Mindmap%20ATTACK.pdf) **|** [**Vers√£o XMind**](https://github.com/Cyber-Guy1/API-SecurityEmpire/blob/main/assets/API%20Pentesting%20Mindmap%20ATTACK.xmind)\\

#### Atacando GraphQL:

Devido aos ataques limitados no GraphQL, tentamos gerar todos os ataques poss√≠veis devido √† nossa experi√™ncia em testar APIs no seguinte mapa mental:

![](https://github.com/Cyber-Guy1/API-SecurityEmpire/blob/main/assets/API%20Pentesting%20Mindmap%20%7B%7BGraphQL%20Attacking%7D%7D.png)\
[**Vers√£o em PDF**](https://github.com/Cyber-Guy1/API-SecurityEmpire/blob/main/assets/API%20Pentesting%20Mindmap%20%7B%7BGraphQL%20Attacking%7D%7D.pdf) **|** [**Vers√£o XMind**](https://github.com/Cyber-Guy1/API-SecurityEmpire/blob/main/assets/API%20Pentesting%20Mindmap%20%7B%7BGraphQL%20Attacking%7D%7D.xmind)\\

## Owasp API Security Top 10

Leia este documento para aprender como **procurar** e **explorar** vulnerabilidades da Owasp Top 10 API: [https://github.com/OWASP/API-Security/blob/master/2019/en/dist/owasp-api-security-top-10.pdf](https://github.com/OWASP/API-Security/blob/master/2019/en/dist/owasp-api-security-top-10.pdf)

## Lista de Verifica√ß√£o de Seguran√ßa de API

{% embed url="https://github.com/shieldfy/API-Security-Checklist" %}

## Filtros Logger++ para Ca√ßa a Vulnerabilidades de API

[https://github.com/bnematzadeh/LoggerPlusPlus-API-Filters](https://github.com/bnematzadeh/LoggerPlusPlus-API-Filters)

## Lista de poss√≠veis endpoints de API

[https://gist.github.com/yassineaboukir/8e12adefbd505ef704674ad6ad48743d](https://gist.github.com/yassineaboukir/8e12adefbd505ef704674ad6ad48743d)

## Ferramentas

* [**kiterunner**](https://github.com/assetnote/kiterunner): Ferramenta excelente para **descobrir endpoints de API.**
```bash
kr scan https://domain.com/api/ -w routes-large.kite -x 20 # Downloaded from kiterunner repo
kr scan https://domain.com/api/ -A=apiroutes-220828 -x 20
kr brute https://domain.com/api/ -A=raft-large-words -x 20 -d=0
kr brute https://domain.com/api/ -w /tmp/lang-english.txt -x 20 -d=0
```
* [**automatic-api-attack-tool**](https://github.com/imperva/automatic-api-attack-tool): Ferramenta de ataque API personaliz√°vel da Imperva que recebe uma especifica√ß√£o de API como entrada, gera e executa ataques baseados nela como sa√≠da.
* [**Astra**](https://github.com/flipkart-incubator/Astra): Outra ferramenta para teste de API para encontrar v√°rias vulnerabilidades web diferentes.
* [**Susanoo**](https://github.com/ant4g0nist/Susanoo): Scanner de vulnerabilidade API.
* [**restler-fuzzer**](https://github.com/microsoft/restler-fuzzer): RESTler √© a _primeira ferramenta de fuzzing de API REST com estado_ para testar automaticamente servi√ßos em nuvem atrav√©s de suas APIs REST e encontrar bugs de seguran√ßa e confiabilidade nesses servi√ßos. Para um dado servi√ßo em nuvem com uma especifica√ß√£o OpenAPI/Swagger, RESTler analisa toda a especifica√ß√£o e, em seguida, gera e executa testes que exercitam o servi√ßo atrav√©s de sua API REST.
* [**TnT-Fuzzer**](https://github.com/Teebytes/TnT-Fuzzer)**:** TnT-Fuzzer √© um fuzzer OpenAPI (swagger) escrito em python.
* [**APIFuzzer**](https://github.com/KissPeter/APIFuzzer)**:** APIFuzzer l√™ a descri√ß√£o da sua API e passo a passo faz fuzzing dos campos para validar se a sua aplica√ß√£o pode lidar com os par√¢metros fuzzados.
* [**API-fuzzer**](https://github.com/Fuzzapi/API-fuzzer): A gema API\_Fuzzer aceita uma solicita√ß√£o de API como entrada e retorna vulnerabilidades poss√≠veis na API.
* [**race-the-web**](https://github.com/TheHackerDev/race-the-web): Testa condi√ß√µes de corrida em aplica√ß√µes web enviando um n√∫mero especificado pelo usu√°rio de solicita√ß√µes para uma URL alvo (ou URLs) _simultaneamente_, e depois compara as respostas do servidor para unicidade.

<figure><img src="../../.gitbook/assets/image (3) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

Use [**Trickest**](https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks) para construir e **automatizar fluxos de trabalho** com facilidade, alimentados pelas ferramentas comunit√°rias **mais avan√ßadas** do mundo.\
Obtenha Acesso Hoje:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><strong>Aprenda AWS hacking do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ quer ver a sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**material oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **Junte-se ao grupo** üí¨ [**Discord**](https://discord.gg/hRep4RUj7f) ou ao grupo [**telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios github** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
