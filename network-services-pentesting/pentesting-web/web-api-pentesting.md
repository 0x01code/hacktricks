# Web API Pentesting

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks Cloud ☁️</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>🐦 Twitter 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 Youtube 🎥</strong></a></summary>

* **サイバーセキュリティ企業**で働いていますか？ **HackTricksで会社を宣伝**したいですか？または、**PEASSの最新バージョンにアクセスしたり、HackTricksをPDFでダウンロード**したいですか？[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を見つけてください。独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクションです。
* [**公式のPEASS＆HackTricksのグッズ**](https://peass.creator-spring.com)を手に入れましょう。
* [**💬**](https://emojipedia.org/speech-balloon/) [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**telegramグループ**](https://t.me/peass)に**参加**するか、**Twitter**で**フォロー**してください[**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**。**
* **ハッキングのトリックを共有するには、PRを** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **と** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **に提出してください。**

</details>

<figure><img src="../../.gitbook/assets/image (3) (1).png" alt=""><figcaption></figcaption></figure>

[**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks)を使用して、世界で最も高度なコミュニティツールによって強化された**ワークフローを簡単に構築**および**自動化**します。\
今すぐアクセスを取得：

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## 基本情報

メイン：

* **Webサービス（SOAP/XML）**
* ドキュメントは通常、`?wsdl`のようなパスに保存される**WSDL**形式を使用します。例として、[http://www.dneonline.com/calculator.asmx](http://www.dneonline.com/calculator.asmx)（WSDLドキュメントは[http://www.dneonline.com/calculator.asmx?wsdl](http://www.dneonline.com/calculator.asmx?wsdl)）に見つけることができ、[http://www.dneonline.com/calculator.asmx?op=Add](http://www.dneonline.com/calculator.asmx?op=Add)で`Add`メソッドを呼び出す例のリクエストを確認できます。
* これらのファイルを解析して例のリクエストを作成するには、**SOAPUI**ツールまたは**WSDLer** Burp Suite拡張機能を使用できます。
* **REST API（JSON）**
* 標準のドキュメントはWADLファイルです。ここに例があります：[https://www.w3.org/Submission/wadl/](https://www.w3.org/Submission/wadl/)。ただし、[https://swagger.io/tools/swagger-ui/](https://swagger.io/tools/swagger-ui/)のような他の開発者向けのAPI表現エンジンもあります（ページのデモを確認してください）。
* これらのファイルを解析して例のリクエストを作成するには、**Postman**ツールを使用できます。
* [**GraphQL**](graphql.md)

## ラボ

* [**VAmPI**](https://github.com/erev0s/VAmPI)**:** VAmPIは、Flaskで作成された脆弱なAPIであり、OWASPトップ10のAPIの脆弱性が含まれています。

## トリック

### SOAP/XML

この種のAPIは[**XXEの脆弱性**](../../pentesting-web/xxe-xee-xml-external-entity.md)に対して脆弱である場合がありますが、通常、ユーザーからの入力では**DTD宣言**が**許可されていません**。

XMLが有効である限り、CDATAタグを使用してペイロードを挿入することも試してみることができます。

![](<../../.gitbook/assets/image (534).png>)

### アクセスの確認

通常、一部のAPIエンドポイントは他よりも多くの特権を必要とします。常に特権のない（認証されていない）アカウントから特権のあるエンドポイントにアクセスできるかどうかを確認してください。

### CORS

APIの[**CORS**](../../pentesting-web/cors-bypass.md)構成を常に確認してください。攻撃者のドメインからのクレデンシャルを使用してリクエストを終了する場合、認証された被害者からの[**CSRF**](../../pentesting-web/csrf-cross-site-request-forgery.md)によって多くの被害を受ける可能性があります。

### パターン

API内のパターンを検索し、それを使用してさらに発見することができます。\
例えば、_/api/albums/**\<album\_id>**/photos/**\<photo\_id>**_が見つかった場合、_/api/**posts**/\<post\_id>/**comment**/_のようなものも試してみることができます。いくつかのファズツールを使用して、新しいエンドポイントを発見します。

### パラメータの追加

次の例のようなものは、別のユーザーの写真アルバムにアクセスできるかもしれません：\
_/api/MyPictureList → /api/MyPictureList?**user\_id=\<other\_user\_id>**_

### パラメータの置換

パラメータを**ファズ**したり、別のエンドポイントで**見たパラメータ**を使用して他の情報にアクセスしようとすることができます。

例えば、次のようなものを見つけた場合：_/api/albums?**album\_id=\<album id>**_

**`album_id`**パラメータを完全に異なるもので置き換え、他のデータにアクセスすることができます：_/api/albums?**account\_id=\<account id>**_
### パラメータ汚染

/api/account?**id=\<あなたのアカウントID>** → /api/account?**id=\<あなたのアカウントID>\&id=\<管理者のアカウントID>**

### ワイルドカードパラメータ

以下の記号をワイルドカードとして使用してみてください: **\***, **%**, **\_**, **.**

* /api/users/\*
* /api/users/%
* /api/users/\_
* /api/users/.

### HTTPリクエストメソッドの変更

次のHTTPメソッドを使用して、ウェブサーバーが予期しない情報を提供するかどうかを確認してみてください: **GET, POST, PUT, DELETE, PATCH, INVENTED**

### リクエストのコンテンツタイプ

以下のコンテンツタイプを試してみて、ウェブサーバーが予期しない動作をするようにリクエストボディを変更してみてください:

* **x-www-form-urlencoded** --> user=test
* **application/xml** --> \<user>test\</user>
* **application/json** --> {"user": "test"}

### パラメータのタイプ

もし**JSON**データが機能している場合は、以下のような予期しないデータ型を送信してみてください:

* {"username": "John"}
* {"username": true}
* {"username": null}
* {"username": 1}
* {"username": \[true]}
* {"username": \["John", true]}
* {"username": {"$neq": "lalala"\}}
* その他の組み合わせ

もし**XML**データを送信できる場合は、[XXEインジェクション](../../pentesting-web/xxe-xee-xml-external-entity.md)をチェックしてください。

通常のPOSTデータを送信する場合は、配列や辞書を送信してみてください:

* username\[]=John
* username\[$neq]=lalala

### ルートの操作

`/files/..%2f..%2f + 被害者のID + %2f + 被害者のファイル名`

### 可能なバージョンの確認

古いバージョンはまだ使用されており、最新のエンドポイントよりも脆弱性が高い可能性があります。

* `/api/v1/login`
* `/api/v2/login`\\
* `/api/CharityEventFeb2020/user/pp/<ID>`
* `/api/CharityEventFeb2021/user/pp/<ID>`

### 可能なバージョンの確認（自動化アプローチ）

AutoRepeater Burp拡張機能: 置換ルールを追加

* `タイプ: リクエスト文字列`
* `マッチ: v2 (より高いバージョン)`
* `置換: v1 (より低いバージョン)`

<figure><img src="../../.gitbook/assets/image (3) (1).png" alt=""><figcaption></figcaption></figure>

\
[**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks)を使用して、世界で最も高度なコミュニティツールによって強化された**ワークフロー**を簡単に構築し、自動化することができます。\
今すぐアクセスを取得:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## 🛡️ APIセキュリティエンパイアチートシート

\
チートシートの作成者: [Momen Eldawakhly (Cyber Guy)](https://www.linkedin.com/in/momen-eldawakhly-3b6250204)\
\
このリポジトリには、APIセキュリティとAPIペネトレーションテストに関連するマインドマップ、ヒント＆トリック、リソースなどが含まれています。当社のマインドマップとリソースは、OWASP TOP 10 API、ペネトレーションテストの経験、および他のリソースに基づいており、WEBで最も高度で正確なAPIセキュリティとペネトレーションテストのリソースを提供しています。

### 🚪 最初のゲート: `{{Recon}}`

APIセキュリティエンパイアに入るための最初のゲートは、APIインフラストラクチャに関する情報を収集し、APIに対して強力なリコンを実行する方法を知ることです。これにより、全体のインフラストラクチャを危険にさらす隠れたドアを抽出することができます。最新のツールと方法論を使用した最新のAPIリコンマインドマップを提供します:

\
![](https://github.com/Cyber-Guy1/API-SecurityEmpire/blob/main/assets/API%20Pentesting%20Mindmap.png)

[**PDFバージョン**](https://github.com/Cyber-Guy1/API-SecurityEmpire/blob/main/assets/API%20Pentesting%20Mindmap.pdf) **|** [**XMindバージョン**](https://github.com/Cyber-Guy1/API-SecurityEmpire/blob/main/assets/API%20Pentesting%20Mindmap.xmind)

#### ⚔️ 必要な武器:

* [BurpSuite](https://portswigger.net/burp/releases)
* [FFUF](https://github.com/ffuf/ffuf)
* [Arjun](https://github.com/InsiderPhD/Arjun)
* [Postman](https://www.postman.com/downloads/)
* [SecLists](https://github.com/danielmiessler/SecLists/tree/master/Discovery/Web-Content)
* [FuzzDB](https://github.com/fuzzdb-project/fuzzdb)
* [SoapUI](https://www.soapui.org/downloads/soapui/)
* [GraphQL Voyager](https://apis.guru/graphql-voyager/)
* [Kiterunner](https://github.com/assetnote/kiterunner)
* [unfurl](https://github.com/tomnomnom/unfurl)

#### 🏋️ 能力と武器をテストする:

* [vapi](https://github.com/roottusk/vapi)
* [Generic-University](https://github.com/InsiderPhD/Generic-University)

### 🚪 2番目のゲート: `{{攻撃}}`

#### RESTful＆SOAPの攻撃:

![](https://github.com/Cyber-Guy1/API-SecurityEmpire/blob/main/assets/API%20Pentesting%20Mindmap%20ATTACK.png)\
[**PDFバージョン**](https://github.com/Cyber-Guy1/API-SecurityEmpire/blob/main/assets/API%20Pentesting%20Mindmap%20ATTACK.pdf) **|** [**XMindバージョン**](https://github.com/Cyber-Guy1/API-SecurityEmpire/blob/main/assets/API%20Pentesting%20Mindmap%20ATTACK.xmind)\\

#### GraphQLの攻撃:

GraphQLの攻撃は限定的なため、APIテストの経験に基づいて可能な攻撃をすべて生成しようとしました。次のマインドマップに示します:

![](https://github.com/Cyber-Guy1/API-SecurityEmpire/blob/main/assets/API%20Pentesting%20Mindmap%20%7B%7BGraphQL%20Attacking%7D%7D.png)\
[**PDFバージョン**](https://github.com/Cyber-Guy1/API-SecurityEmpire/blob/main/assets/API%20Pentesting%20Mindmap%20%7B%7BGraphQL%20Attacking%7D%7D.pdf) **|** [**XMindバージョン**](https://github.com/Cyber-Guy1/API-SecurityEmpire/blob/main/assets/API%20Pentesting%20Mindmap%20%7B%7BGraphQL%20Attacking%7D%7D.xmind)\\
## Owasp APIセキュリティトップ10

Owasp Top 10 APIの脆弱性を**検索**および**悪用**する方法については、次のドキュメントを参照してください：[https://github.com/OWASP/API-Security/blob/master/2019/en/dist/owasp-api-security-top-10.pdf](https://github.com/OWASP/API-Security/blob/master/2019/en/dist/owasp-api-security-top-10.pdf)

## APIセキュリティチェックリスト

{% embed url="https://github.com/shieldfy/API-Security-Checklist" %}

## API脆弱性のハンティングのためのLogger++フィルター

[https://github.com/bnematzadeh/LoggerPlusPlus-API-Filters](https://github.com/bnematzadeh/LoggerPlusPlus-API-Filters)

## 可能なAPIエンドポイントのリスト

[https://gist.github.com/yassineaboukir/8e12adefbd505ef704674ad6ad48743d](https://gist.github.com/yassineaboukir/8e12adefbd505ef704674ad6ad48743d)

## ツール

* [**kiterunner**](https://github.com/assetnote/kiterunner)：APIエンドポイントを**発見**するための優れたツール。
```bash
kr scan https://domain.com/api/ -w routes-large.kite -x 20 # Downloaded from kiterunner repo
kr scan https://domain.com/api/ -A=apiroutes-220828 -x 20
kr brute https://domain.com/api/ -A=raft-large-words -x 20 -d=0
kr brute https://domain.com/api/ -w /tmp/lang-english.txt -x 20 -d=0
```
* [**automatic-api-attack-tool**](https://github.com/imperva/automatic-api-attack-tool): Impervaのカスタマイズ可能なAPI攻撃ツールは、API仕様を入力として受け取り、それに基づいて攻撃を生成して実行します。
* [**Astra**](https://github.com/flipkart-incubator/Astra): 異なるウェブ脆弱性を見つけるためのAPIテストツールです。
* [**Susanoo**](https://github.com/ant4g0nist/Susanoo): 脆弱性APIスキャナーです。
* [**restler-fuzzer**](https://github.com/microsoft/restler-fuzzer): RESTlerは、REST APIを介してクラウドサービスを自動的にテストし、これらのサービスのセキュリティおよび信頼性のバグを見つけるための_最初の状態を持つREST APIファジングツール_です。与えられたクラウドサービスに対してOpenAPI/Swagger仕様がある場合、RESTlerはその仕様全体を分析し、それに基づいてサービスをテストするためのテストを生成して実行します。
* [**TnT-Fuzzer**](https://github.com/Teebytes/TnT-Fuzzer)**:** TnT-Fuzzerは、Pythonで書かれたOpenAPI（swagger）ファジングツールです。
* [**APIFuzzer**](https://github.com/KissPeter/APIFuzzer)**:** APIFuzzerは、APIの説明を読み取り、ステップバイステップでフィールドをファジングして、アプリケーションがファジングされたパラメータに対応できるかどうかを検証します。
* [**API-fuzzer**](https://github.com/Fuzzapi/API-fuzzer): API\_Fuzzerジェムは、APIリクエストを入力として受け取り、APIで可能な脆弱性を返します。
* [**race-the-web**](https://github.com/TheHackerDev/race-the-web): ウェブアプリケーションの競合状態をテストするために、ユーザー指定の数のリクエストをターゲットURL（またはURL）に_同時に_送信し、サーバーからの応答を一意性に基づいて比較します。

<figure><img src="../../.gitbook/assets/image (3) (1).png" alt=""><figcaption></figcaption></figure>

[**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks)を使用して、世界で最も高度なコミュニティツールによって強化された**ワークフローを簡単に構築**および**自動化**します。\
今すぐアクセスを取得：

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks Cloud ☁️</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>🐦 Twitter 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 Youtube 🎥</strong></a></summary>

* **サイバーセキュリティ企業で働いていますか？ HackTricksであなたの会社を宣伝したいですか？または、最新バージョンのPEASSを入手したり、HackTricksをPDFでダウンロードしたりしたいですか？[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！**
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見しましょう、独占的な[NFTs](https://opensea.io/collection/the-peass-family)のコレクションです。
* [**公式のPEASS＆HackTricksのスワッグ**](https://peass.creator-spring.com)を手に入れましょう。
* [**💬**](https://emojipedia.org/speech-balloon/) [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**テレグラムグループ**](https://t.me/peass)に参加するか、**Twitter**で私をフォローしてください[**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**。**
* **ハッキングのトリックを共有するには、PRを**[**hacktricks repo**](https://github.com/carlospolop/hacktricks) **と** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **に提出してください。**

</details>
