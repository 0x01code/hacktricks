# Test de p√©n√©tration d'API Web

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux d√©p√¥ts github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

<figure><img src="../../.gitbook/assets/image (3) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

Utilisez [**Trickest**](https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks) pour construire et **automatiser des workflows** aliment√©s par les outils communautaires **les plus avanc√©s**.\
Obtenez l'acc√®s aujourd'hui :

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## Informations de base

Principales :

* **Services Web (SOAP/XML)**
* La documentation utilise le format **WSDL** et est g√©n√©ralement enregistr√©e dans le chemin `?wsdl` comme `https://api.example.com/api/?wsdl`
* Un exemple de cette documentation peut √™tre trouv√© ici : [http://www.dneonline.com/calculator.asmx](http://www.dneonline.com/calculator.asmx) (document WSDL dans [http://www.dneonline.com/calculator.asmx?wsdl](http://www.dneonline.com/calculator.asmx?wsdl)) et vous pouvez voir un exemple de requ√™te appelant la m√©thode `Add` dans [http://www.dneonline.com/calculator.asmx?op=Add](http://www.dneonline.com/calculator.asmx?op=Add)
* Pour analyser ces fichiers et cr√©er des requ√™tes exemples, vous pouvez utiliser l'outil **SOAPUI** ou l'extension Burp Suite **WSDLer**.
* **API REST (JSON)**
* La documentation standard est le fichier WADL. Trouvez un exemple ici : [https://www.w3.org/Submission/wadl/](https://www.w3.org/Submission/wadl/). Cependant, il existe d'autres moteurs de repr√©sentation d'API plus conviviaux pour les d√©veloppeurs comme [https://swagger.io/tools/swagger-ui/](https://swagger.io/tools/swagger-ui/) (consultez la d√©mo sur la page)
* Pour analyser ces fichiers et cr√©er des requ√™tes exemples, vous pouvez utiliser l'outil **Postman**
* [**GraphQL**](graphql.md)

## Labs

* [**VAmPI**](https://github.com/erev0s/VAmPI)**:** VAmPI est une API vuln√©rable cr√©√©e avec Flask et elle inclut des vuln√©rabilit√©s du top 10 de l'OWASP pour les API.

## Astuces

### SOAP/XML

Ces types d'API peuvent √™tre [**vuln√©rables aux XXE**](../../pentesting-web/xxe-xee-xml-external-entity.md), mais g√©n√©ralement les **d√©clarations DTD** sont **interdites** dans les entr√©es de l'utilisateur.

Vous pourriez √©galement essayer d'utiliser des balises CDATA pour ins√©rer des charges utiles (tant que le XML est valide)

![](<../../.gitbook/assets/image (534).png>)

### V√©rifier l'acc√®s

Habituellement, certains points de terminaison de l'API vont n√©cessiter plus de privil√®ges que d'autres. Essayez toujours d'acc√©der aux points de terminaison les plus privil√©gi√©s √† partir de comptes moins privil√©gi√©s (non autoris√©s) pour voir si c'est possible.

### CORS

V√©rifiez toujours la configuration [**CORS**](../../pentesting-web/cors-bypass.md) de l'API, car si elle permet d'envoyer des requ√™tes avec les identifiants depuis le domaine de l'attaquant, beaucoup de dommages peuvent √™tre caus√©s via [**CSRF**](../../pentesting-web/csrf-cross-site-request-forgery.md) depuis des victimes authentifi√©es.

### Mod√®les

Recherchez des mod√®les d'API √† l'int√©rieur de l'api et essayez de les utiliser pour en d√©couvrir plus.\
Si vous trouvez _/api/albums/**\<album_id>**/photos/**\<photo_id>**_\*\* \*\* vous pourriez √©galement essayer des choses comme _/api/**posts**/\<post_id>/**comment**/_. Utilisez un fuzzer pour d√©couvrir ces nouveaux points de terminaison.

### Ajouter des param√®tres

Quelque chose comme l'exemple suivant pourrait vous donner acc√®s √† l'album photo d'un autre utilisateur :\
_/api/MyPictureList ‚Üí /api/MyPictureList?**user_id=\<other_user_id>**_

### Remplacer des param√®tres

Vous pouvez essayer de **fuzzer des param√®tres** ou **utiliser** des param√®tres **que vous avez vus** dans diff√©rents points de terminaison pour essayer d'acc√©der √† d'autres informations

Par exemple, si vous voyez quelque chose comme : _/api/albums?**album_id=\<album id>**_

Vous pourriez **remplacer** le param√®tre **`album_id`** par quelque chose de compl√®tement diff√©rent et potentiellement obtenir d'autres donn√©es : _/api/albums?**account_id=\<account id>**_

### Pollution de param√®tres

/api/account?**id=\<your account id>** ‚Üí /api/account?**id=\<your account id>\&id=\<admin's account id>**

### Param√®tre g√©n√©rique

Essayez d'utiliser les symboles suivants comme g√©n√©riques : **\***, **%**, **\_**, **.**

* /api/users/\*
* /api/users/%
* /api/users/\_
* /api/users/.

### Changement de m√©thode de requ√™te HTTP

Vous pouvez essayer d'utiliser les m√©thodes HTTP : **GET, POST, PUT, DELETE, PATCH, INVENTED** pour v√©rifier si le serveur web vous donne des informations inattendues avec elles.

### Type de contenu de la requ√™te

Essayez de jouer entre les types de contenu suivants (en modifiant en cons√©quence le corps de la requ√™te) pour faire se comporter le serveur web de mani√®re inattendue :

* **x-www-form-urlencoded** --> user=test
* **application/xml** --> \<user>test\</user>
* **application/json** --> {"user": "test"}

### Types de param√®tres

Si les donn√©es **JSON** fonctionnent, essayez d'envoyer des types de donn√©es inattendus comme :

* {"username": "John"}
* {"username": true}
* {"username": null}
* {"username": 1}
* {"username": \[true]}
* {"username": \["John", true]}
* {"username": {"$neq": "lalala"\}}
* toute autre combinaison que vous pouvez imaginer

Si vous pouvez envoyer des donn√©es **XML**, v√©rifiez les injections [XXE](../../pentesting-web/xxe-xee-xml-external-entity.md).

Si vous envoyez des donn√©es POST r√©guli√®res, essayez d'envoyer des tableaux et des dictionnaires :

* username\[]=John
* username\[$neq]=lalala

### Jouer avec les routes

`/files/..%2f..%2f + ID de la victime + %2f + nom de fichier de la victime`

### V√©rifier les versions possibles

Les anciennes versions peuvent encore √™tre utilis√©es et √™tre plus vuln√©rables que les derniers points de terminaison

* `/api/v1/login`
* `/api/v2/login`\\
* `/api/CharityEventFeb2020/user/pp/<ID>`
* `/api/CharityEventFeb2021/user/pp/<ID>`

### V√©rifier les versions possibles (approche automatis√©e)

Extension Burp AutoRepeater : Ajoutez une r√®gle de remplacement

* `Type : Cha√Æne de requ√™te`
* `Correspondance : v2 (version sup√©rieure)`
* `Remplacement : v1 (version inf√©rieure)`

## üõ°Ô∏è Feuille de triche Empire de la s√©curit√© des API

\
Auteur de la feuille de triche : [Momen Eldawakhly (Cyber Guy)](https://www.linkedin.com/in/momen-eldawakhly-3b6250204)\
\
Dans ce d√©p√¥t, vous trouverez : Mindmaps, astuces & conseils, ressources et tout ce qui est li√© √† la s√©curit√© des API et au test de p√©n√©tration des API. Nos mindmaps et ressources sont bas√©s sur le TOP 10 de l'OWASP pour les API, notre exp√©rience en test de p√©n√©tration et d'autres ressources pour fournir la ressource de s√©curit√© et de test de p√©n√©tration des API la plus avanc√©e et pr√©cise sur le WEB !!

### üö™ Premi√®re porte : `{{Recon}}`

La premi√®re porte pour entrer dans l'Empire de la s√©curit√© des API est de savoir comment collecter des informations sur l'infrastructure de l'API et comment effectuer une reconnaissance puissante sur l'API pour extraire les portes cach√©es qui vous ont permis de compromettre toute l'infrastructure, donc, nous fournissons cette mindmap de reconnaissance d'API mise √† jour avec les derniers outils et m√©thodologies en reconnaissance d'API :

\
![](https://github.com/Cyber-Guy1/API-SecurityEmpire/blob/main/assets/API%20Pentesting%20Mindmap.png)

[**Version PDF**](https://github.com/Cyber-Guy1/API-SecurityEmpire/blob/main/assets/API%20Pentesting%20Mindmap.pdf) **|** [**Version XMind**](https://github.com/Cyber-Guy1/API-SecurityEmpire/blob/main/assets/API%20Pentesting%20Mindmap.xmind)

#### ‚öîÔ∏è Armes dont vous aurez besoin :

* [BurpSuite](https://portswigger.net/burp/releases)
* [FFUF](https://github.com/ffuf/ffuf)
* [Arjun](https://github.com/InsiderPhD/Arjun)
* [Postman](https://www.postman.com/downloads/)
* [SecLists](https://github.com/danielmiessler/SecLists/tree/master/Discovery/Web-Content)
* [FuzzDB](https://github.com/fuzzdb-project/fuzzdb)
* [SoapUI](https://www.soapui.org/downloads/soapui/)
* [GraphQL Voyager](https://apis.guru/graphql-voyager/)
* [Kiterunner](https://github.com/assetnote/kiterunner)
* [unfurl](https://github.com/tomnomnom/unfurl)

#### üèãÔ∏è Testez vos capacit√©s et vos armes :

* [vapi](https://github.com/roottusk/vapi)
* [Generic-University](https://github.com/InsiderPhD/Generic-University)

### üö™ Deuxi√®me porte : `{{Attaque}}`

#### Attaquer RESTful & SOAP :

![](https://github.com/Cyber-Guy1/API-SecurityEmpire/blob/main/assets/API%20Pentesting%20Mindmap%20ATTACK.png)\
[**Version PDF**](https://github.com/Cyber-Guy1/API-SecurityEmpire/blob/main/assets/API%20Pentesting%20Mindmap%20ATTACK.pdf) **|** [**Version XMind**](https://github.com/Cyber-Guy1/API-SecurityEmpire/blob/main/assets/API%20Pentesting%20Mindmap%20ATTACK.xmind)\\

#### Attaquer GraphQL :

En raison des attaques limit√©es dans GraphQL, nous avons essay√© de g√©n√©rer toutes les attaques possibles en raison de notre exp√©rience dans le test des API dans la mindmap suivante :

![](https://github.com/Cyber-Guy1/API-SecurityEmpire/blob/main/assets/API%20Pentesting%20Mindmap%20%7B%7BGraphQL%20Attacking%7D%7D.png)\
[**Version PDF**](https://github.com/Cyber-Guy1/API-SecurityEmpire/blob/main/assets/API%20Pentesting%20Mindmap%20%7B%7BGraphQL%20Attacking%7D%7D.pdf) **|** [**Version XMind**](https://github.com/Cyber-Guy1/API-SecurityEmpire/blob/main/assets/API%20Pentesting%20Mindmap%20%7B%7BGraphQL%20Attacking%7D%7D.xmind)\\

## Top 10 de la s√©curit√© des API d'Owasp

Lisez ce document pour apprendre comment **rechercher** et **exploiter** les vuln√©rabilit√©s du Top 10 de l'API d'Owasp : [https://github.com/OWASP/API-Security/blob/master/2019/en/dist/owasp-api-security-top-10.pdf](https://github.com/OWASP/API-Security/blob/master/2019/en/dist/owasp-api-security-top-10.pdf)

## Liste de contr√¥le de la s√©curit√© des API

{% embed url="https://github.com/shieldfy/API-Security-Checklist" %}

## Filtres Logger++ pour la chasse aux vuln√©rabilit√©s des API

[https://github.com/bnematzadeh/LoggerPlusPlus-API-Filters](https://github.com/bnematzadeh/LoggerPlusPlus-API-Filters)

## Liste des points de terminaison d'API possibles

[https://gist.github.com/yassineaboukir/8e12adefbd505ef704674ad6ad48743d](https://gist.github.com/yassineaboukir/8e12adefbd505ef704674ad6ad48743d)

## Outils

* [**kiterunner**](https://github.com/assetnote/kiterunner) : Excellent outil pour **d√©couvrir les points de terminaison d'API.**
```bash
kr scan https://domain.com/api/ -w routes-large.kite -x 20 # Downloaded from kiterunner repo
kr scan https://domain.com/api/ -A=apiroutes-220828 -x 20
kr brute https://domain.com/api/ -A=raft-large-words -x 20 -d=0
kr brute https://domain.com/api/ -w /tmp/lang-english.txt -x 20 -d=0
```
* [**automatic-api-attack-tool**](https://github.com/imperva/automatic-api-attack-tool) : Outil d'attaque API personnalisable d'Imperva qui prend une sp√©cification d'API en entr√©e, g√©n√®re et ex√©cute des attaques bas√©es sur celle-ci en sortie.
* [**Astra**](https://github.com/flipkart-incubator/Astra) : Un autre outil pour tester les API afin de trouver plusieurs vuln√©rabilit√©s web diff√©rentes.
* [**Susanoo**](https://github.com/ant4g0nist/Susanoo) : Scanner de vuln√©rabilit√© API.
* [**restler-fuzzer**](https://github.com/microsoft/restler-fuzzer) : RESTler est le _premier outil de fuzzing REST API avec √©tat_ pour tester automatiquement les services cloud via leurs REST API et trouver des bugs de s√©curit√© et de fiabilit√© dans ces services. Pour un service cloud donn√© avec une sp√©cification OpenAPI/Swagger, RESTler analyse l'int√©gralit√© de sa sp√©cification, puis g√©n√®re et ex√©cute des tests qui sollicitent le service via son REST API.
* [**TnT-Fuzzer**](https://github.com/Teebytes/TnT-Fuzzer)** :** TnT-Fuzzer est un fuzzer OpenAPI (swagger) √©crit en python.
* [**APIFuzzer**](https://github.com/KissPeter/APIFuzzer)** :** APIFuzzer lit votre description d'API et fuzz progressivement les champs pour valider si votre application peut g√©rer les param√®tres fuzz√©s.
* [**API-fuzzer**](https://github.com/Fuzzapi/API-fuzzer) : Le gem API\_Fuzzer accepte une requ√™te API en entr√©e et retourne les vuln√©rabilit√©s possibles dans l'API.
* [**race-the-web**](https://github.com/TheHackerDev/race-the-web) : Teste les conditions de concurrence dans les applications web en envoyant un nombre sp√©cifi√© par l'utilisateur de requ√™tes √† une URL cible (ou des URLs) _simultan√©ment_, puis compare les r√©ponses du serveur pour l'unicit√©.

<figure><img src="../../.gitbook/assets/image (3) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

Utilisez [**Trickest**](https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks) pour construire et **automatiser des workflows** aliment√©s par les outils communautaires **les plus avanc√©s**.\
Obtenez l'acc√®s aujourd'hui :

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><strong>Apprenez le hacking AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> !</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm).
* **Partagez vos astuces de hacking en soumettant des PR aux d√©p√¥ts github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
