# GraphQL

<details>

<summary><strong>Jifunze kuhusu kudukua AWS kutoka sifuri hadi shujaa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Mtaalam wa Timu Nyekundu ya AWS ya HackTricks)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako inatangazwa kwenye HackTricks** au **kupakua HackTricks kwa muundo wa PDF** Angalia [**MPANGO WA KUJIUNGA**](https://github.com/sponsors/carlospolop)!
* Pata [**swag rasmi ya PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**Familia ya PEASS**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa [**NFTs**](https://opensea.io/collection/the-peass-family) za kipekee
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au [**kikundi cha telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Shiriki mbinu zako za kudukua kwa kuwasilisha PRs kwenye** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos za github.

</details>

## Utangulizi

GraphQL **inasisitizwa** kama **mbadala yenye ufanisi** kwa API ya REST, ikitoa njia rahisi ya kuuliza data kutoka kwa seva ya nyuma. Tofauti na REST, ambayo mara nyingi inahitaji maombi mengi kwenye vituo tofauti ili kukusanya data, GraphQL inawezesha kupata habari zote zinazohitajika kupitia **ombi moja**. Hii inasaidia sana wabunifu kwa kupunguza ugumu wa mchakato wao wa kupata data.

## GraphQL na Usalama

Na kuibuka kwa teknolojia mpya, ikiwa ni pamoja na GraphQL, pia kuna uwazi mpya wa usalama. Jambo muhimu kuzingatia ni kwamba **GraphQL hauna njia za uwakilishi kwa chaguo-msingi**. Ni jukumu la wabunifu kuweka hatua za usalama kama hizo. Bila uwakilishi sahihi, vituo vya GraphQL vinaweza kufichua habari nyeti kwa watumiaji wasiothibitishwa, na hivyo kuwa na hatari kubwa ya usalama.

### Mashambulizi ya Directory Brute Force na GraphQL

Ili kutambua vituo vya GraphQL vilivyofichuliwa, ni vyema kuongeza njia maalum katika mashambulizi ya directory brute force. Njia hizi ni:

- `/graphql`
- `/graphiql`
- `/graphql.php`
- `/graphql/console`
- `/api`
- `/api/graphql`
- `/graphql/api`
- `/graphql/graphql`

Kutambua vituo vya GraphQL vilivyofunguliwa kunaruhusu uchunguzi wa maswali yanayoungwa mkono. Hii ni muhimu kwa kuelewa data inayopatikana kupitia kituo cha mwisho. Mfumo wa utambuzi wa GraphQL unawezesha hili kwa kutoa maelezo ya maswali ambayo muundo unaweza kusaidia. Kwa habari zaidi kuhusu hili, tazama nyaraka za GraphQL kuhusu utambuzi: [**GraphQL: Lugha ya maswali kwa APIs.**](https://graphql.org/learn/introspection/)

### Alama ya Vidole

Zana ya [**graphw00f**](https://github.com/dolevf/graphw00f) inaweza kutambua injini ya GraphQL inayotumiwa kwenye seva na kisha kuchapisha habari muhimu kwa mkaguzi wa usalama.

#### Maswali ya Ulimwenguni <a href="#maswali-ya-ulimwenguni" id="maswali-ya-ulimwenguni"></a>

Ili kuthibitisha ikiwa URL ni huduma ya GraphQL, **swali la ulimwenguni**, `query{__typename}`, linaweza kutumwa. Ikiwa jibu linaleta `{"data": {"__typename": "Query"}}`, inathibitisha kuwa URL ina kituo cha GraphQL. Njia hii inategemea uwanja wa `__typename` wa GraphQL, ambao unaonyesha aina ya kitu kinachoulizwa.
```javascript
query{__typename}
```
### Uchunguzi wa Msingi

Kawaida, Graphql inasaidia **GET**, **POST** (x-www-form-urlencoded) na **POST**(json). Ingawa kwa usalama inashauriwa kuruhusu tu json ili kuzuia mashambulizi ya CSRF.

#### Uchunguzi wa Ndani

Ili kutumia uchunguzi wa ndani ili kugundua habari za muundo, tafuta uwanja wa `__schema`. Uwanja huu upo kwenye aina ya msingi ya maswali yote.
```bash
query={__schema{types{name,fields{name}}}}
```
Kwa kutumia swali hili utapata jina la aina zote zinazotumiwa:

![](<../../.gitbook/assets/image (202).png>)

{% code overflow="wrap" %}
```bash
query={__schema{types{name,fields{name,args{name,description,type{name,kind,ofType{name, kind}}}}}}}
```
{% endcode %}

Kwa kutumia swali hili, unaweza kuchambua aina zote, shamba zake, na hoja zake (na aina ya hoja). Hii itakuwa muhimu sana kujua jinsi ya kuuliza habari kutoka kwenye database.

![](<../../.gitbook/assets/image (207) (3).png>)

**Makosa**

Ni muhimu kujua ikiwa **makosa** yataonyeshwa kwani yatasaidia kutoa **habari muhimu**.
```
?query={__schema}
?query={}
?query={thisdefinitelydoesnotexist}
```
![](<../../.gitbook/assets/image (205) (1).png>)

**Tambua Mpangilio wa Database kupitia Introspection**

{% hint style="info" %}
Ikiwa introspection imeamilishwa lakini swali hapo juu halifanyi kazi, jaribu kuondoa maagizo ya `onOperation`, `onFragment`, na `onField` kutoka kwa muundo wa swali.
{% endhint %}
```bash
#Full introspection query

query IntrospectionQuery {
__schema {
queryType {
name
}
mutationType {
name
}
subscriptionType {
name
}
types {
...FullType
}
directives {
name
description
args {
...InputValue
}
onOperation  #Often needs to be deleted to run query
onFragment   #Often needs to be deleted to run query
onField      #Often needs to be deleted to run query
}
}
}

fragment FullType on __Type {
kind
name
description
fields(includeDeprecated: true) {
name
description
args {
...InputValue
}
type {
...TypeRef
}
isDeprecated
deprecationReason
}
inputFields {
...InputValue
}
interfaces {
...TypeRef
}
enumValues(includeDeprecated: true) {
name
description
isDeprecated
deprecationReason
}
possibleTypes {
...TypeRef
}
}

fragment InputValue on __InputValue {
name
description
type {
...TypeRef
}
defaultValue
}

fragment TypeRef on __Type {
kind
name
ofType {
kind
name
ofType {
kind
name
ofType {
kind
name
}
}
}
}
```
Ombi la uchunguzi wa ndani ya mstari:
```
/?query=fragment%20FullType%20on%20Type%20{+%20%20kind+%20%20name+%20%20description+%20%20fields%20{+%20%20%20%20name+%20%20%20%20description+%20%20%20%20args%20{+%20%20%20%20%20%20...InputValue+%20%20%20%20}+%20%20%20%20type%20{+%20%20%20%20%20%20...TypeRef+%20%20%20%20}+%20%20}+%20%20inputFields%20{+%20%20%20%20...InputValue+%20%20}+%20%20interfaces%20{+%20%20%20%20...TypeRef+%20%20}+%20%20enumValues%20{+%20%20%20%20name+%20%20%20%20description+%20%20}+%20%20possibleTypes%20{+%20%20%20%20...TypeRef+%20%20}+}++fragment%20InputValue%20on%20InputValue%20{+%20%20name+%20%20description+%20%20type%20{+%20%20%20%20...TypeRef+%20%20}+%20%20defaultValue+}++fragment%20TypeRef%20on%20Type%20{+%20%20kind+%20%20name+%20%20ofType%20{+%20%20%20%20kind+%20%20%20%20name+%20%20%20%20ofType%20{+%20%20%20%20%20%20kind+%20%20%20%20%20%20name+%20%20%20%20%20%20ofType%20{+%20%20%20%20%20%20%20%20kind+%20%20%20%20%20%20%20%20name+%20%20%20%20%20%20%20%20ofType%20{+%20%20%20%20%20%20%20%20%20%20kind+%20%20%20%20%20%20%20%20%20%20name+%20%20%20%20%20%20%20%20%20%20ofType%20{+%20%20%20%20%20%20%20%20%20%20%20%20kind+%20%20%20%20%20%20%20%20%20%20%20%20name+%20%20%20%20%20%20%20%20%20%20%20%20ofType%20{+%20%20%20%20%20%20%20%20%20%20%20%20%20%20kind+%20%20%20%20%20%20%20%20%20%20%20%20%20%20name+%20%20%20%20%20%20%20%20%20%20%20%20%20%20ofType%20{+%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20kind+%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20name+%20%20%20%20%20%20%20%20%20%20%20%20%20%20}+%20%20%20%20%20%20%20%20%20%20%20%20}+%20%20%20%20%20%20%20%20%20%20}+%20%20%20%20%20%20%20%20}+%20%20%20%20%20%20}+%20%20%20%20}+%20%20}+}++query%20IntrospectionQuery%20{+%20%20schema%20{+%20%20%20%20queryType%20{+%20%20%20%20%20%20name+%20%20%20%20}+%20%20%20%20mutationType%20{+%20%20%20%20%20%20name+%20%20%20%20}+%20%20%20%20types%20{+%20%20%20%20%20%20...FullType+%20%20%20%20}+%20%20%20%20directives%20{+%20%20%20%20%20%20name+%20%20%20%20%20%20description+%20%20%20%20%20%20locations+%20%20%20%20%20%20args%20{+%20%20%20%20%20%20%20%20...InputValue+%20%20%20%20%20%20}+%20%20%20%20}+%20%20}+}
```
Mstari wa mwisho wa nambari ni ombi la graphql ambalo litatoa habari zote za meta kutoka kwa graphql (majina ya vitu, parameta, aina ...)

![](<../../.gitbook/assets/image (206).png>)

Ikiwa introspection imeamilishwa, unaweza kutumia [**GraphQL Voyager**](https://github.com/APIs-guru/graphql-voyager) kuona kwa GUI chaguo zote.

### Kuuliza

Sasa tukijua aina gani ya habari imehifadhiwa ndani ya database, jaribu **kuchukua baadhi ya thamani**.

Katika introspection unaweza kupata **kitu gani unaweza kuuliza moja kwa moja** (kwa sababu huwezi kuuliza kitu tu kwa sababu kipo). Katika picha ifuatayo unaweza kuona kuwa "_queryType_" inaitwa "_Query_" na moja ya uga wa kitu cha "_Query_" ni "_flags_", ambayo pia ni aina ya kitu. Kwa hivyo unaweza kuuliza kitu cha bendera.

![](../../.gitbook/assets/screenshot-from-2021-03-13-18-17-48.png)

Tambua kuwa aina ya ombi "_flags_" ni "_Flags_", na kitu hiki kimefafanuliwa kama ifuatavyo:

![](../../.gitbook/assets/screenshot-from-2021-03-13-18-22-57.png)

Unaweza kuona kuwa vitu vya "_Flags_" vinaundwa na **jina** na .**thamani** Kisha unaweza kupata majina yote na thamani za bendera na ombi hili:
```javascript
query={flags{name, value}}
```
Tafadhali kumbuka kuwa ikiwa **kitu cha kuuliza** ni **aina ya msingi** kama **herufi** kama ilivyo katika mfano ufuatao

![](<../../.gitbook/assets/image (441).png>)

Unaweza tu kuuliza kwa:
```javascript
query={hiddenFlags}
```
Katika mfano mwingine ambapo kulikuwa na vitu 2 ndani ya kitu cha aina "_Query_": "_user_" na "_users_".\
Ikiwa vitu hivi havihitaji hoja yoyote ya utafutaji, unaweza **kupata habari zote kutoka kwao** kwa tu **kuomba** data unayotaka. Katika mfano huu kutoka kwenye mtandao, unaweza kuchukua majina ya watumiaji na nywila zilizohifadhiwa:

![](<../../.gitbook/assets/image (208).png>)

Hata hivyo, katika mfano huu ikiwa unajaribu kufanya hivyo utapata **kosa** hili:

![](<../../.gitbook/assets/image (210).png>)

Inaonekana kwa njia fulani itatafuta kwa kutumia hoja ya "_**uid**_" ya aina _**Int**_.\
Hata hivyo, tayari tulijua hilo, katika sehemu ya [Uchunguzi wa Msingi](graphql.md#basic-enumeration) ilipendekezwa hoja ambayo ilikuwa inatuonyesha habari zote zinazohitajika: `query={__schema{types{name,fields{name, args{name,description,type{name, kind, ofType{name, kind}}}}}}}`

Ikiwa unasoma picha iliyotolewa wakati ninaendesha hoja hiyo utaona kuwa "_**user**_" alikuwa na **arg** "_**uid**_" ya aina _Int_.

Kwa hiyo, kwa kufanya jaribio dogo la _**uid**_ bruteforce niligundua kuwa katika _**uid**=**1**_ jina la mtumiaji na nywila zilipatikana:\
`query={user(uid:1){user,password}}`

![](<../../.gitbook/assets/image (211).png>)

Tafadhali kumbuka kuwa **niligundua** kuwa niliweza kuuliza **parameta** "_**user**_" na "_**password**_" kwa sababu ikiwa jaribu kutafuta kitu ambacho hakipo (`query={user(uid:1){noExists}}`) napata kosa hili:

![](<../../.gitbook/assets/image (213).png>)

Na wakati wa **hatua ya uchunguzi** niligundua kuwa kitu cha "_**dbuser**_" kilikuwa na vitu "_**user**_" na "_**password**_.

**Mbinu ya kudumpishwa kwa herufi za utafutaji (shukrani kwa @BinaryShadow\_)**

Ikiwa unaweza kutafuta kwa kutumia aina ya herufi, kama: `query={theusers(description: ""){username,password}}` na **unatafuta herufi tupu** itadumpisha data yote. (_Tafadhali kumbuka mfano huu hauhusiani na mfano wa mafunzo, kwa mfano huu fikiria unaweza kutafuta kwa kutumia "**theusers**" kwa kutumia uga wa aina ya String unaoitwa "**description**"_).

### Utafutaji

Katika mpangilio huu, **database** ina **watu** na **filamu**. **Watu** wanatambuliwa na **barua pepe** na **jina**; **filamu** kwa jina lao na **kiwango**. **Watu** wanaweza kuwa marafiki na wao wenyewe na pia kuwa na filamu, ikionyesha uhusiano ndani ya database.

Unaweza **kutafuta** watu **kwa** jina **na** kupata barua pepe zao:
```javascript
{
searchPerson(name: "John Doe") {
email
}
}
```
Unaweza **kutafuta** watu **kwa** **jina** na kupata **filamu** wanazozipenda:
```javascript
{
searchPerson(name: "John Doe") {
email
subscribedMovies {
edges {
node {
name
}
}
}
}
}
```
Tazama jinsi ilivyoelezwa kupata `jina` la `subscribedMovies` ya mtu.

Pia unaweza **kutafuta vitu kadhaa kwa wakati mmoja**. Katika kesi hii, utafutaji wa sinema 2 unafanywa:
```javascript
{
searchPerson(subscribedMovies: [{name: "Inception"}, {name: "Rocky"}]) {
name
}
}r
```
Au hata **mahusiano ya vitu tofauti tofauti kwa kutumia majina mbadala**:
```javascript
{
johnsMovieList: searchPerson(name: "John Doe") {
subscribedMovies {
edges {
node {
name
}
}
}
}
davidsMovieList: searchPerson(name: "David Smith") {
subscribedMovies {
edges {
node {
name
}
}
}
}
}
```
### Mabadiliko

**Mabadiliko hutumika kufanya mabadiliko upande wa seva.**

Katika **introspection** unaweza kupata **mabadiliko yaliyotangazwa**. Katika picha ifuatayo, "_MutationType_" inaitwa "_Mutation_" na kifaa cha "_Mutation_" kina majina ya mabadiliko (kama vile "_addPerson_" katika kesi hii):

![](../../.gitbook/assets/screenshot-from-2021-03-13-18-26-27.png)

Katika mpangilio huu, **database** ina **watu** na **filamu**. **Watu** wanatambuliwa na **barua pepe** na **jina**; **Filamu** zinatambuliwa na **jina** na **kiwango**. **Watu** wanaweza kuwa marafiki na pia kuwa na filamu, ikionyesha uhusiano ndani ya database.

Mabadiliko ya kuunda **filamu mpya** ndani ya database yanaweza kuwa kama ifuatavyo (katika mfano huu mabadiliko yanaitwa `addMovie`):
```javascript
mutation {
addMovie(name: "Jumanji: The Next Level", rating: "6.8/10", releaseYear: 2019) {
movies {
name
rating
}
}
}
```
**Tafadhali kumbuka jinsi thamani na aina ya data zinavyoonyeshwa katika ombi.**

Kwa kuongezea, hifadhidata inasaidia operesheni ya **mutation**, iliyoitwa `addPerson`, ambayo inaruhusu uundaji wa **watoto** pamoja na uhusiano wao na **marafiki** na **filamu** zilizopo. Ni muhimu kuzingatia kuwa marafiki na filamu lazima wawe tayari katika hifadhidata kabla ya kuwahusisha na mtu aliyeumbwa hivi karibuni.
```javascript
mutation {
addPerson(name: "James Yoe", email: "jy@example.com", friends: [{name: "John Doe"}, {email: "jd@example.com"}], subscribedMovies: [{name: "Rocky"}, {name: "Interstellar"}, {name: "Harry Potter and the Sorcerer's Stone"}]) {
person {
name
email
friends {
edges {
node {
name
email
}
}
}
subscribedMovies {
edges {
node {
name
rating
releaseYear
}
}
}
}
}
}
```
### Kuchanganya nguvu ya nguvu katika ombi 1 la API

Taarifa hii ilichukuliwa kutoka [https://lab.wallarm.com/graphql-batching-attack/](https://lab.wallarm.com/graphql-batching-attack/).\
Uthibitishaji kupitia GraphQL API na **kupeleka wakati mmoja maswali mengi na vitambulisho tofauti** ili kuvithibitisha. Hii ni shambulio la nguvu ya kawaida, lakini sasa inawezekana kutuma zaidi ya jozi moja ya jina la mtumiaji/nywila kwa ombi moja la HTTP kutokana na kipengele cha kuchanganya cha GraphQL. Njia hii itawadanganya programu za ufuatiliaji wa kiwango cha nje kuamini kuwa kila kitu kiko sawa na hakuna boti ya kuvunja nguvu inayojaribu kuhadithi nywila.

Hapa chini unaweza kupata mfano rahisi wa ombi la uthibitishaji wa programu, na **jozi 3 tofauti za barua pepe/nywila kwa wakati mmoja**. Kwa wazi, inawezekana kutuma maelfu kwa ombi moja kwa njia ile ile:

![](<../../.gitbook/assets/image (182) (1).png>)

Kama tunavyoona kutoka kwa picha ya majibu, maombi ya kwanza na ya tatu yalirudisha _null_ na kuonyesha habari inayolingana katika sehemu ya _error_. **Mutation ya pili ilikuwa na data sahihi ya uthibitishaji** na majibu yana kikoa sahihi cha kikao cha uthibitishaji.

![](<../../.gitbook/assets/image (119) (1).png>)

## GraphQL Bila Uchunguzi

Zaidi na zaidi **vikoa vya graphql vinazima uchunguzi**. Walakini, makosa ambayo graphql inarusha wakati ombi lisilotarajiwa linapokelewa ni ya kutosha kwa zana kama [**clairvoyance**](https://github.com/nikitastupin/clairvoyance) kuunda tena sehemu kubwa ya muundo.

Zaidi ya hayo, kifaa cha Burp Suite [**GraphQuail**](https://github.com/forcesunseen/graphquail) **kinachunguza maombi ya GraphQL API yanayopitia Burp** na **kujenga** muundo wa GraphQL **ndani** na kila swali jipya linapoonekana. Pia inaweza kuonyesha muundo kwa GraphiQL na Voyager. Kifaa hiki kinarudisha majibu bandia wakati kinapokea ombi la uchunguzi. Kama matokeo, GraphQuail inaonyesha maswali yote, hoja, na uga uliopo kwa matumizi ndani ya API. Kwa habari zaidi [**angalia hii**](https://blog.forcesunseen.com/graphql-security-testing-without-a-schema).

Orodha nzuri ya maneno [**GraphQL inayoweza kugunduliwa inaweza kupatikana hapa**](https://github.com/Escape-Technologies/graphql-wordlist?).

### Kuvuka Ulinzi wa Uchunguzi wa GraphQL <a href="#bypassing-graphql-introspection-defences" id="bypassing-graphql-introspection-defences"></a>

### **Kuvuka Ulinzi wa Uchunguzi wa GraphQL**

Ili kuvuka vizuizi kwenye maswali ya uchunguzi katika API, kuweka **herufi maalum baada ya neno la msingi `__schema`** inathibitisha ufanisi. Njia hii inatumia makosa ya kawaida ya watengenezaji katika mifumo ya regex ambayo inalenga kuzuia uchunguzi kwa kuzingatia neno la msingi la `__schema`. Kwa kuongeza herufi kama **nafasi, mistari mipya, na comma**, ambayo GraphQL inapuuza lakini inaweza kutokuwa imehesabiwa katika regex, vizuizi vinaweza kuzungukwa. Kwa mfano, swali la uchunguzi na mstari mpya baada ya `__schema` linaweza kuvuka ulinzi kama huo:
```bash
# Example with newline to bypass
{
"query": "query{__schema
{queryType{name}}}"
}
```
Ikiwa haifanikiwi, fikiria njia mbadala za ombi, kama vile ombi la **GET** au **POST na `x-www-form-urlencoded`**, kwani vizuizi vinaweza kuomba tu kwa ombi la POST.

### **Kugundua Miundo ya GraphQL Iliyofichuliwa**

Wakati uchunguzi umefungwa, kuchunguza nambari ya chanzo ya wavuti kwa ajili ya maswali yaliyopakuliwa mapema katika maktaba za JavaScript ni mkakati wenye manufaa. Maswali haya yanaweza kupatikana kwa kutumia kichupo cha `Vyanzo` katika zana za watengenezaji, kutoa ufahamu juu ya muundo wa API na kufunua maswali yanayoweza kuwa **yanayofichua habari nyeti**. Amri za kutafuta ndani ya zana za watengenezaji ni:
```javascript
Inspect/Sources/"Search all files"
file:* mutation
file:* query
```
## CSRF katika GraphQL

Ikiwa haujui CSRF ni nini, soma ukurasa ufuatao:

{% content-ref url="../../pentesting-web/csrf-cross-site-request-forgery.md" %}
[csrf-cross-site-request-forgery.md](../../pentesting-web/csrf-cross-site-request-forgery.md)
{% endcontent-ref %}

Huko nje utaweza kupata vituo vingi vya GraphQL **vilivyowekwa bila alama za CSRF.**

Tafadhali kumbuka kuwa ombi za GraphQL kawaida hutumwa kupitia ombi za POST kwa kutumia Content-Type **`application/json`**.
```javascript
{"operationName":null,"variables":{},"query":"{\n  user {\n    firstName\n    __typename\n  }\n}\n"}
```
Hata hivyo, sehemu kubwa ya vituo vya GraphQL pia hutoa msaada wa maombi ya POST ya **`form-urlencoded`:**
```javascript
query=%7B%0A++user+%7B%0A++++firstName%0A++++__typename%0A++%7D%0A%7D%0A
```
Kwa hivyo, kama maombi ya CSRF kama yale ya awali yanatumwa **bila maombi ya awali**, ni rahisi kufanya **mabadiliko** katika GraphQL kwa kutumia CSRF.

Hata hivyo, kumbuka kuwa thamani mpya ya chaguo la `samesite` ya kidakuzi cha Chrome ni `Lax`. Hii inamaanisha kuwa kidakuzi kitatumwa tu kutoka kwa wavuti ya mtu wa tatu katika maombi ya GET.

Kumbuka pia kuwa kwa kawaida ni rahisi kutuma ombi la **kuuliza** pia kama ombi la **GET** na ishara ya CSRF huenda isithibitishwe katika ombi la GET.

Pia, kwa kutumia [**mshambulizi wa XS-Search**](../../pentesting-web/xs-search.md), inawezekana kuvuja maudhui kutoka kwa hatua ya mwisho ya GraphQL kwa kutumia vibali vya mtumiaji.

Kwa habari zaidi, **angalia** [**chapisho la asili hapa**](https://blog.doyensec.com/2021/05/20/graphql-csrf.html).

## Uthibitishaji katika GraphQL

Kazi nyingi za GraphQL zilizoelezwa kwenye hatua ya mwisho huenda zinathibitisha tu uthibitisho wa ombaji lakini sio idhini.

Kubadilisha pembejeo za ombi kunaweza kusababisha kuvuja kwa maelezo nyeti ya akaunti [yaliyovuja](https://hackerone.com/reports/792927).

Hata mabadiliko yanaweza kusababisha kuchukuliwa kwa akaunti kwa kujaribu kubadilisha data ya akaunti nyingine.
```javascript
{
"operationName":"updateProfile",
"variables":{"username":INJECT,"data":INJECT},
"query":"mutation updateProfile($username: String!,...){updateProfile(username: $username,...){...}}"
}
```
### Kupita kwenye uthibitisho katika GraphQL

[Kuunganisha maswali](https://s1n1st3r.gitbook.io/theb10g/graphql-query-authentication-bypass-vuln) pamoja kunaweza kusaidia kuepuka mfumo dhaifu wa uthibitisho.

Katika mfano ulio hapo chini unaweza kuona kuwa uendeshaji ni "forgotPassword" na kwamba inapaswa kutekeleza tu swali la forgotPassword lililohusishwa nayo. Hii inaweza kuepukwa kwa kuongeza swali mwishoni, katika kesi hii tunaweka "register" na kigezo cha mtumiaji ili mfumo ujiandikishe kama mtumiaji mpya.

<figure><img src="../../.gitbook/assets/GraphQLAuthBypassMethod.PNG" alt=""><figcaption></figcaption></figure>

## Kupita kwenye Kikomo cha Kiwango kwa Kutumia Majina Badala katika GraphQL

Katika GraphQL, majina badala ni kipengele chenye nguvu kinachoruhusu **kuweka majina ya mali kwa uwazi** wakati wa kutuma ombi la API. Uwezo huu ni muhimu hasa kwa kupata **mifano mingi ya aina ile ile** ya kitu katika ombi moja. Majina badala yanaweza kutumika kushinda kizuizi kinachozuia vitu vya GraphQL kuwa na mali nyingi zenye jina sawa.

Ili kuelewa kwa undani majina badala ya GraphQL, rasilimali ifuatayo inapendekezwa: [Majina Badala](https://portswigger.net/web-security/graphql/what-is-graphql#aliases).

Ingawa kusudi kuu la majina badala ni kupunguza hitaji la wito nyingi za API, matumizi yasiyotarajiwa yamegunduliwa ambapo majina badala yanaweza kutumika kutekeleza mashambulizi ya nguvu kwenye kipengele cha GraphQL. Hii inawezekana kwa sababu baadhi ya vipengele vinalindwa na vizuizi vya kiwango cha kuzuia mashambulizi ya nguvu kwa kuzuia **idadi ya maombi ya HTTP**. Walakini, vizuizi hivi vya kiwango cha kuzuia huenda havizingatii idadi ya uendeshaji ndani ya kila ombi. Kwa kuwa majina badala huruhusu kuongeza maswali mengi katika ombi moja la HTTP, yanaweza kuepuka hatua za kikomo cha kiwango kama hizo.

Fikiria mfano uliotolewa hapa chini, ambao unaonyesha jinsi maswali yaliyopewa majina badala yanaweza kutumika kuthibitisha uhalali wa nambari za punguzo za duka. Njia hii inaweza kuepuka kikomo cha kiwango kwa kuunganisha maswali kadhaa katika ombi moja la HTTP, na hivyo kuruhusu uthibitisho wa nambari za punguzo nyingi kwa wakati mmoja.
```bash
# Example of a request utilizing aliased queries to check for valid discount codes
query isValidDiscount($code: Int) {
isvalidDiscount(code:$code){
valid
}
isValidDiscount2:isValidDiscount(code:$code){
valid
}
isValidDiscount3:isValidDiscount(code:$code){
valid
}
}
```
## Vifaa

### Skana za Udhaifu

* [https://github.com/gsmith257-cyber/GraphCrawler](https://github.com/gsmith257-cyber/GraphCrawler): Zana ambayo inaweza kutumika kukamata muundo na kutafuta data nyeti, kujaribu idhini, kuvunja nguvu muundo, na kupata njia kwa aina iliyoombwa.
* [https://blog.doyensec.com/2020/03/26/graphql-scanner.html](https://blog.doyensec.com/2020/03/26/graphql-scanner.html): Inaweza kutumika kama standalone au [Burp extension](https://github.com/doyensec/inql).
* [https://github.com/swisskyrepo/GraphQLmap](https://github.com/swisskyrepo/GraphQLmap): Inaweza kutumika kama mteja wa CLI pia kwa kutekeleza mashambulizi kiotomatiki.
* [https://gitlab.com/dee-see/graphql-path-enum](https://gitlab.com/dee-see/graphql-path-enum): Zana ambayo inaorodhesha njia tofauti za kufikia aina iliyoombwa katika muundo wa GraphQL.
* [https://github.com/doyensec/inql](https://github.com/doyensec/inql): Burp extension kwa ajili ya kupima GraphQL kwa kiwango cha juu. Sehemu ya _**Scanner**_ ndiyo msingi wa InQL v5.0, ambapo unaweza kuchambua kipengele cha GraphQL au faili ya muundo wa kujitambulisha ya ndani. Inazalisha moja kwa moja maswali yote na mabadiliko yanayowezekana, na kuyapanga katika muonekano ulio na muundo kwa ajili ya uchambuzi wako. Sehemu ya _**Attacker**_ inakuwezesha kutekeleza mashambulizi ya GraphQL kwa wingi, ambayo inaweza kuwa na manufaa kwa kuzunguka vizuizi vya kiwango cha chini vilivyotekelezwa vibaya.

### Wateja

* [https://github.com/graphql/graphiql](https://github.com/graphql/graphiql): Mteja wa GUI
* [https://altair.sirmuel.design/](https://altair.sirmuel.design/): Mteja wa GUI

### Vipimo vya Kiotomatiki

{% embed url="https://graphql-dashboard.herokuapp.com/" %}

* Video inayoelezea AutoGraphQL: [https://www.youtube.com/watch?v=JJmufWfVvyU](https://www.youtube.com/watch?v=JJmufWfVvyU)

## Marejeo

* [**https://jondow.eu/practical-graphql-attack-vectors/**](https://jondow.eu/practical-graphql-attack-vectors/)
* [**https://medium.com/@the.bilal.rizwan/graphql-common-vulnerabilities-how-to-exploit-them-464f9fdce696**](https://medium.com/@the.bilal.rizwan/graphql-common-vulnerabilities-how-to-exploit-them-464f9fdce696)
* [**https://medium.com/@apkash8/graphql-vs-rest-api-model-common-security-test-cases-for-graphql-endpoints-5b723b1468b4**](https://medium.com/@apkash8/graphql-vs-rest-api-model-common-security-test-cases-for-graphql-endpoints-5b723b1468b4)
* [**http://ghostlulz.com/api-hacking-graphql/**](http://ghostlulz.com/api-hacking-graphql/)
* [**https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/GraphQL%20Injection/README.md**](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/GraphQL%20Injection/README.md)
* [**https://medium.com/@the.bilal.rizwan/graphql-common-vulnerabilities-how-to-exploit-them-464f9fdce696**](https://medium.com/@the.bilal.rizwan/graphql-common-vulnerabilities-how-to-exploit-them-464f9fdce696)
* [**https://portswigger.net/web-security/graphql**](https://portswigger.net/web-security/graphql)

<details>

<summary><strong>Jifunze kuhusu kudukua AWS kutoka sifuri hadi shujaa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako ikitangazwa kwenye HackTricks** au **kupakua HackTricks kwa muundo wa PDF** Angalia [**MPANGO WA KUJIUNGA**](https://github.com/sponsors/carlospolop)!
* Pata [**swag rasmi wa PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**The PEASS Family**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa [**NFTs**](https://opensea.io/collection/the-peass-family) za kipekee
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au **kikundi cha** [**telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Shiriki mbinu zako za kudukua kwa kuwasilisha PR kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
