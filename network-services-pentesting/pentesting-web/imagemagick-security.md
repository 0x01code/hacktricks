# Seguran√ßa do ImageMagick

<details>

<summary><strong>Aprenda hacking na AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ deseja ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF** Verifique os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-nos** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para os** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) reposit√≥rios do github.

</details>

Verifique mais detalhes em [**https://blog.doyensec.com/2023/01/10/imagemagick-security-policy-evaluator.html**](https://blog.doyensec.com/2023/01/10/imagemagick-security-policy-evaluator.html)

O ImageMagick, uma biblioteca vers√°til de processamento de imagens, apresenta um desafio na configura√ß√£o de sua pol√≠tica de seguran√ßa devido √†s suas extensas op√ß√µes e √† falta de documenta√ß√£o online detalhada. Os usu√°rios frequentemente criam pol√≠ticas com base em fontes de internet fragmentadas, levando a poss√≠veis configura√ß√µes incorretas. A biblioteca suporta uma vasta gama de mais de 100 formatos de imagem, cada um contribuindo para sua complexidade e perfil de vulnerabilidade, como demonstrado por incidentes de seguran√ßa hist√≥ricos.

## Rumo a Pol√≠ticas Mais Seguras
Para enfrentar esses desafios, uma [ferramenta foi desenvolvida](https://imagemagick-secevaluator.doyensec.com/) para auxiliar no design e auditoria das pol√≠ticas de seguran√ßa do ImageMagick. Esta ferramenta √© baseada em extensa pesquisa e tem como objetivo garantir que as pol√≠ticas sejam n√£o apenas robustas, mas tamb√©m livres de brechas que poderiam ser exploradas.

## Abordagem de Lista de Permiss√µes vs Lista de Bloqueios
Historicamente, as pol√≠ticas do ImageMagick dependiam de uma abordagem de lista de bloqueios, onde codificadores espec√≠ficos tinham o acesso negado. No entanto, mudan√ßas no ImageMagick 6.9.7-7 alteraram esse paradigma, permitindo uma abordagem de lista de permiss√µes. Esta abordagem primeiro nega o acesso a todos os codificadores e, em seguida, concede seletivamente acesso aos confi√°veis, aprimorando a postura de seguran√ßa.
```xml
...
<policy domain="coder" rights="none" pattern="*" />
<policy domain="coder" rights="read | write" pattern="{GIF,JPEG,PNG,WEBP}" />
...
```
## Sensibilidade a Mai√∫sculas nas Pol√≠ticas
√â crucial notar que os padr√µes de pol√≠ticas no ImageMagick s√£o sens√≠veis a mai√∫sculas. Portanto, garantir que os codificadores e m√≥dulos estejam corretamente em mai√∫sculas nas pol√≠ticas √© vital para evitar permiss√µes n√£o intencionais.

## Limites de Recursos
O ImageMagick √© propenso a ataques de nega√ß√£o de servi√ßo se n√£o estiver configurado corretamente. Definir limites de recursos expl√≠citos na pol√≠tica √© essencial para prevenir tais vulnerabilidades.

## Fragmenta√ß√£o de Pol√≠ticas
As pol√≠ticas podem estar fragmentadas em diferentes instala√ß√µes do ImageMagick, levando a conflitos ou substitui√ß√µes potenciais. √â recomendado localizar e verificar os arquivos de pol√≠ticas ativas usando comandos como:
```shell
$ find / -iname policy.xml
```
## Uma Pol√≠tica Inicial Restritiva
Foi proposto um modelo de pol√≠tica restritiva, focando em limita√ß√µes rigorosas de recursos e controles de acesso. Este modelo serve como base para o desenvolvimento de pol√≠ticas personalizadas que estejam alinhadas com requisitos espec√≠ficos de aplicativos.

A efic√°cia de uma pol√≠tica de seguran√ßa pode ser confirmada usando o comando `identify -list policy` no ImageMagick. Al√©m disso, a [ferramenta de avalia√ß√£o](https://imagemagick-secevaluator.doyensec.com/) mencionada anteriormente pode ser usada para refinar a pol√≠tica com base em necessidades individuais.

## Refer√™ncias
* [https://blog.doyensec.com/2023/01/10/imagemagick-security-policy-evaluator.html**](https://blog.doyensec.com/2023/01/10/imagemagick-security-policy-evaluator.html)
