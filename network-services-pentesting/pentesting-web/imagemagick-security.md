# ImageMagick рд╕реБрд░рдХреНрд╖рд╛

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>тШБя╕П HackTricks Cloud тШБя╕П</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ЁЯРж Twitter ЁЯРж</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ЁЯОЩя╕П Twitch ЁЯОЩя╕П</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ЁЯОе Youtube ЁЯОе</strong></a></summary>

* рдХреНрдпрд╛ рдЖрдк рдХрд┐рд╕реА **рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХрдВрдкрдиреА** рдореЗрдВ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ? рдХреНрдпрд╛ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХреЛ HackTricks рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд** рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ? рдпрд╛ рдХреНрдпрд╛ рдЖрдкрдХреЛ **PEASS рдХреА рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рдХрд╛ рдЙрдкрдпреЛрдЧ** рдХрд░рдиреЗ рдХреА рдЗрдЪреНрдЫрд╛ рд╣реИ? [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ!
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ рд╕рдВрдЧреНрд░рд╣ [**NFTs**](https://opensea.io/collection/the-peass-family)
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks swag**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**ЁЯТм**](https://emojipedia.org/speech-balloon/) [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ **рд╢рд╛рдорд┐рд▓** рд╣реЛрдВ рдпрд╛ рдореБрдЭреЗ **Twitter** [**ЁЯРж**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)** рдХрд╛ рдкрд╛рд▓рди рдХрд░реЗрдВ**.
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **рдФрд░** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **рдХреЛ** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **рдореЗрдВред**

</details>

**рдпрд╣ рдкреЛрд╕реНрдЯ** [**https://blog.doyensec.com/2023/01/10/imagemagick-security-policy-evaluator.html**](https://blog.doyensec.com/2023/01/10/imagemagick-security-policy-evaluator.html) **рд╕реЗ рдХреЙрдкреА рдХреА рдЧрдИ рд╣реИред**

рд╣рдорд╛рд░реЗ рдСрдбрд┐рдЯ рдХреЗ рджреМрд░рд╛рди рд╣рдо рдХрднреА-рдХрднреА [ImageMagick](https://imagemagick.org/) рд╕реБрд░рдХреНрд╖рд╛ рдиреАрддрд┐ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓реЗрдВ (`policy.xml`) рдорд┐рд▓рддреА рд╣реИрдВ, рдЬреЛ рдкреБрд╕реНрддрдХрд╛рд▓рдп рджреНрд╡рд╛рд░рд╛ рдЦрд╛рджреНрдп рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреА рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд╡реНрдпрд╡рд╣рд╛рд░ рдФрд░ рд╕реАрдорд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА рд╣реЛрддреА рд╣реИрдВред рдЬрдВрдЧрд▓реА рдореЗрдВ, рдЗрди рдлрд╝рд╛рдЗрд▓реЛрдВ рдореЗрдВ рдЕрдХреНрд╕рд░ рдЗрдВрдЯрд░рдиреЗрдЯ рдХреЗ рдЪрд╛рд░реЛрдВ рдУрд░ рд╕реЗ рд▓рд┐рдП рдЧрдП рд╕рд┐рдлрд╛рд░рд┐рд╢реЛрдВ рдХреА рдПрдХ рдмрд╣реБрддрд╛рдпрдд рдкрд╛рдИ рдЬрд╛рддреА рд╣реИред рдпрд╣ рдЖрдорддреМрд░ рдкрд░ рджреЛ рдХрд╛рд░рдгреЛрдВ рд╕реЗ рд╣реЛрддрд╛ рд╣реИ:

* рдЗрд╕рдХреЗ рд╡рд┐рдХрд▓реНрдкреЛрдВ рдХрд╛ рдСрдирд▓рд╛рдЗрди рджрд╕реНрддрд╛рд╡реЗрдЬрд╝реАрдХрд░рдг рдкреГрд╖реНрда рдкрд░ рдХреЗрд╡рд▓ рд╕рд╛рдорд╛рдиреНрдп рд░реВрдк рд╕реЗ рд╡рд░реНрдгрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬрд╣рд╛рдВ рдиреАрддрд┐ рджреНрд╡рд╛рд░рд╛ рдЕрдиреБрдорддрд┐ рджреА рдЬрд╛рдиреЗ рд╡рд╛рд▓реА рдкреНрд░рддреНрдпреЗрдХ рд╕реБрд░рдХреНрд╖рд╛ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХрд╛ рд╡рд┐рд╡рд░рдг рд╕реНрдкрд╖реНрдЯ рдирд╣реАрдВ рд╣реЛрддрд╛ рд╣реИред рдЬрдмрдХрд┐ рдирд╡рд╛рдЧрдиреНрддреБрдХ рдХреЗ рд▓рд┐рдП рд╕рдВрд░рдЪрдирд╛рддреНрдордХ рдЬрдЯрд┐рд▓рддрд╛ рдФрд░ рдиреАрддрд┐ рджреНрд╡рд╛рд░рд╛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рд╡рд┐рдХрд▓реНрдкреЛрдВ рдХреА рд╡рд┐рд╕реНрддрд╛рд░рд╢реАрд▓рддрд╛ рдирд╡рд╛рдЧрдиреНрддреБрдХ рдХреЗ рд▓рд┐рдП рдкреНрд░рдореБрдЦ рдмрд╛рдзрд╛рдПрдВ рд╣реИрдВ, рддреЛ рд╕рдВрдмрдВрдзрд┐рдд рдЬреНрдЮрд╛рди рдЖрдзрд╛рд░ рдЕрдзрд┐рдХ рд╕реНрд╡рд╛рдЧрддрдкреВрд░реНрдг рд╣реЛ рд╕рдХрддрд╛ рд╣реИред рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ, ImageMagick рдХреЗ рдкрд╛рд╕ рдПрдХ рдЕрд╕реАрдорд┐рдд рдиреАрддрд┐ рд╣реЛрддреА рд╣реИ рдЬрд┐рд╕реЗ рдбреЗрд╡рд▓рдкрд░реНрд╕ рдХреЛ рдЕрдкрдиреЗ рдЙрдкрдпреЛрдЧ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рд╕рдорд╛рдпреЛрдЬрд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред рджрд╕реНрддрд╛рд╡реЗрдЬрд╝реАрдХрд░рдг рдХреЗ рдЕрдиреБрд╕рд╛рд░, _"рдпрд╣ ImageMagick рд╕реНрдерд╛рдкрдирд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдЕрдзрд┐рдХрддрдо рдЙрдкрдпреЛрдЧрд┐рддрд╛ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ рдЬреЛ рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рд╡реЗрдмрд╕рд╛рдЗрдЯ рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рд╕реБрд░рдХреНрд╖рд╛ рдЬреЛрдЦрд┐рдореЛрдВ рдХреЛ рдмрд╣реБрдд рдХрдо рдХрд░ рджреЗрддреЗ рд╣реИрдВ, рд╢рд╛рдпрдж рдПрдХ рдбреЙрдХрд░ рдЙрджрд╛рд╣рд░рдг рдореЗрдВ рдпрд╛ рдПрдХ рдлрд╝рд╛рдпрд░рд╡реЙрд▓ рдХреЗ рдкреАрдЫреЗред"_ рдПрдХ рд╕реБрд░рдХреНрд╖рд┐рдд рд╕рдЦреНрдд рдиреАрддрд┐ рднреА рдЙрдкрд▓рдмреНрдз рд╣реЛрддреА рд╣реИ, рд╣рд╛рд▓рд╛рдВрдХрд┐ [рдкрд┐рдЫрд▓реЗ рдореЗрдВ рджрд░реНрдЬ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ](https://www.synacktiv.com/en/publications/playing-with-imagetragick-like-its-2016.html) рдХрд┐ рдпрд╣ рд╣рдореЗрд╢рд╛ рдареАрдХ рд╕реЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдирд╣реАрдВ рд╣реЛрддреА рд╣реИред
* ImageMagick [100 рд╕реЗ рдЕрдзрд┐рдХ рдкреНрд░рдореБрдЦ рдлрд╝рд╛рдЗрд▓ рдкреНрд░рд╛рд░реВрдкреЛрдВ](https://imagemagick.org/script/formats.php#supported) (рдЙрдк-рдкреНрд░рд╛рд░реВрдкреЛрдВ рдХреЛ рд╕рдореЗрдд рдирд╣реАрдВ) рдХреЗ рдкреНрд░рдХрд╛рд░ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИред рд╡рд░реНрд╖реЛрдВ рд╕реЗ рдкреБрд╕реНрддрдХрд╛рд▓рдп рдХреЛ рдкреНрд░рднрд╛рд╡рд┐рдд рдХрд░рдиреЗ рд╡рд╛рд▓реА рдмрджрдирд╛рдо рд╕реБрд░рдХреНрд╖рд╛ рдЦреЛрдЬреЛрдВ рдиреЗ рдиреАрддрд┐ рдореЗрдВ рдкреНрд░рднрд╛рд╡рд┐рдд рдкреНрд░рд╛рд░реВрдкреЛрдВ рдФрд░ рд╕реБрд╡рд┐рдзрд╛рдУрдВ рдХреЛ рдЫреЛрдбрд╝рдиреЗ рдХреЗ рд▓рд┐рдП рдиреАрддрд┐ рдЖрдЗрдЯрдо рдЬреЛрдбрд╝рдиреЗ рдХреЗ рд╕рд╛рде рддрддреНрдкрд░рддрд╛ рдХреА рд╣реИ (ImageTragick рдореЗрдВ [2016](https://imagetragick.com/), [@taviso](https://twitter.com/taviso) рдХреЗ RCE рджреНрд╡рд╛рд░рд╛ GhostScript рдореЗрдВ [2018](https://seclists.org/oss-sec/2018/q3/142), [@insertScript](https://twitter.com/insertScript) рдХреЗ рджреНрд╡рд╛рд░рд╛ PDF рдкрд╛рд╕рд╡рд░реНрдб рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╢реИрд▓ рдЗрдВрдЬреЗрдХреНрд╢рди [2020](https://insert-script.blogspot.com/2020/11/imagemagick-shell-injection-via-pdf.html), [@alexisdanizan](https://twitter.com/alexisdanizan) рдХреЗ [2021](https://www.synacktiv.com/en/publications/playing-with-imagetragick-like-its-2016.html))ред

### рд╕реБрд░рдХреНрд╖рд┐рдд рдиреАрддрд┐рдпреЛрдВ рдХреА рдУрд░ <a href="#towards-safer-policies" id="towards-safer-policies"></a>

рдЗрд╕ рдзреНрдпрд╛рди рдореЗрдВ рд░рдЦрддреЗ рд╣реБрдП, рд╣рдордиреЗ ImageMagick рдХреА рд╕реБрд░рдХреНрд╖рд╛ рдиреАрддрд┐ рдкрд╛рд░реНрд╕рд░
```xml
...
<policy domain="coder" rights="none" pattern="EPHEMERAL" />
<policy domain="coder" rights="none" pattern="EPI" />
<policy domain="coder" rights="none" pattern="EPS" />
<policy domain="coder" rights="none" pattern="MSL" />
<policy domain="coder" rights="none" pattern="MVG" />
<policy domain="coder" rights="none" pattern="PDF" />
<policy domain="coder" rights="none" pattern="PLT" />
<policy domain="coder" rights="none" pattern="PS" />
<policy domain="coder" rights="none" pattern="PS2" />
<policy domain="coder" rights="none" pattern="PS3" />
<policy domain="coder" rights="none" pattern="SHOW" />
<policy domain="coder" rights="none" pattern="TEXT" />
<policy domain="coder" rights="none" pattern="WIN" />
<policy domain="coder" rights="none" pattern="XPS" />
...
```
ImageMagick 6.9.7-7 рдореЗрдВ, рдПрдХ [рдЕрдирд╕реВрдЪреАрдд рдкрд░рд┐рд╡рд░реНрддрди](https://blog.awm.jp/2017/02/09/imagemagick-en/) рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред рдиреАрддрд┐ рдкрд╛рд░реНрд╕рд░ рдиреЗ рдмрджрд▓ рджрд┐рдпрд╛ рдерд╛ рдФрд░ рдЕрдм рдиреАрддрд┐ рдореЗрдВ рдХрдо рд╕реЗ рдХрдо рдПрдХ `none`-рдЕрдиреБрдорддрд┐ рдирд┐рдпрдо рд╣реЛрдиреЗ рдкрд░ рдХреЛрдбрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдЕрдиреБрдорддрд┐ рдирд╣реАрдВ рджреЗрддрд╛ рд╣реИ, рдмрд▓реНрдХрд┐ рдХреЛрдбрд░ рдХреЗ рд▓рд┐рдП рдиреАрддрд┐ рдореЗрдВ рдЕрдВрддрд┐рдо рдорд┐рд▓рд╛рди рдирд┐рдпрдо рдХрд╛ рдкрд╛рд▓рди рдХрд░рддрд╛ рд╣реИред рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдЖрдзреБрдирд┐рдХ рдиреАрддрд┐рдпреЛрдВ рдореЗрдВ рдПрдХ рдЕрдиреБрдорддрд┐ рд╕реВрдЪреА рджреНрд╡рд╛рд░рд╛ рдЕрдиреБрдорддрд┐ рджреЗрдиреЗ рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рд╣реЛрддреА рд╣реИ, рдкрд╣рд▓реЗ рд╕рднреА рдХреЛрдбрд░реНрд╕ рдХреЛ `rights` рд╕реЗ рдЗрдирдХрд╛рд░ рдХрд░рдХреЗ рдорд╛рдиреНрдпрддрд╛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдХреЛрдбрд░реНрд╕ рдХреЛ рд╕рдХреНрд╖рдо рдХрд░рддреЗ рд╣реБрдПред рдПрдХ рдФрд░ рд╕реБрд░рдХреНрд╖рд┐рдд рдиреАрддрд┐ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╣реЛ рд╕рдХрддреА рд╣реИ:
```xml
...
<policy domain="delegate" rights="none" pattern="*" />
<policy domain="coder" rights="none" pattern="*" />
<policy domain="coder" rights="read | write" pattern="{GIF,JPEG,PNG,WEBP}" />
...
```
### рдорд╛рдорд▓реЗ рдХреА рдорд╛рдиреНрдпрддрд╛ <a href="#case-sensitivity" id="case-sensitivity"></a>

рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХреЛ рдзреНрдпрд╛рди рд╕реЗ рд╡рд┐рдЪрд╛рд░ рдХрд░реЗрдВ:
```
...
<policy domain="coder" rights="none" pattern="ephemeral,epi,eps,msl,mvg,pdf,plt,ps,ps2,ps3,show,text,win,xps" />
...
```
рдЗрд╕рдХреЗ рд╕рд╛рде, рдкрд░рд┐рд╡рд░реНрддрдиреЛрдВ рдХреА рдЕрдиреБрдорддрд┐ рдЕрднреА рднреА рд╣реЛрдЧреА, рдХреНрдпреЛрдВрдХрд┐ рдиреАрддрд┐ рдкреИрдЯрд░реНрди рдорд╛рдорд▓реЗ рдореЗрдВ рдорд╛рдорд▓реЗ рдХреЛ рдорд╛рдорд▓реЗ рдХреЗ рд░реВрдк рдореЗрдВ рдЕрдкрд░рд┐рд╡рд░реНрддрдирд╢реАрд▓ рд╣реЛрддрд╛ рд╣реИред рдХреЛрдбрд░ рдФрд░ рдореЙрдбреНрдпреВрд▓ рдХреЛ рдиреАрддрд┐ рдореЗрдВ рд╣рдореЗрд╢рд╛ рдЕрдкрд░-рдХреЗрд╕ рдореЗрдВ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП (рдЙрджрд╛ред "EPS" рдирд╣реАрдВ "eps"ред)

### рд╕рдВрд╕рд╛рдзрди рд╕реАрдорд╛рдПрдВ <a href="#resource-limits" id="resource-limits"></a>

ImageMagick рдореЗрдВ рдбрд┐рдирд╛рдпрд▓ рдСрдл рд╕рд░реНрд╡рд┐рд╕ рдЖрд╕рд╛рдиреА рд╕реЗ рд╣рд╛рд╕рд┐рд▓ рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИред рдПрдХ рддрд╛рдЬрдЧреА рд╕реЗрдЯ рдХреЗ рдкреЗрд▓реЛрдб рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдпрд╣ рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рд╣реЛрддрд╛ рд╣реИ рдХрд┐ рдЖрдк рдЧрд┐рддрд╣рдм рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдХреА рд╣рд╛рд▓ рд╣реА рдореЗрдВ рдЦреЛрд▓реА рдЧрдИ рд╕рдорд╕реНрдпрд╛рдУрдВ рдореЗрдВ рд░рд┐рдкреЛрд░реНрдЯ рдХреА рдЧрдИ "oom" рдпрд╛ рд╕рдорд╛рди рд╢рдмреНрджреЛрдВ рдХреА рдЦреЛрдЬ рдХрд░реЗрдВред рдпрд╣ рдПрдХ рд╕рдорд╕реНрдпрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдПрдХ ImageMagick рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдкреЛрдЯреЗрдВрд╢рд┐рдпрд▓реА рд╣рд╛рдирд┐рдХрд╛рд░рдХ рдЗрдирдкреБрдЯ рдХреЛ рд╕реНрд╡реАрдХрд╛рд░ рдХрд░рдиреЗ рд╡рд╛рд▓рд╛ (рдЬреЛ рдЕрдХреНрд╕рд░ рдорд╛рдорд▓рд╛ рд╣реЛрддрд╛ рд╣реИ) рд╣рдореЗрд╢рд╛ рд╢реЛрд╖рд┐рдд рд╣реЛрдиреЗ рдХреЗ рд▓рд┐рдП рдкреНрд░рд╡реГрддреНрдд рд╣реЛрдЧрд╛ред рдЗрд╕рдХреЗ рдХрд╛рд░рдг, рдпрд╣ рдЯреВрд▓ рднреА рд░рд┐рдкреЛрд░реНрдЯ рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдпрджрд┐ рдиреАрддрд┐ рджреНрд╡рд╛рд░рд╛ рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рд╕рд╛рдордпрд┐рдХ рд╕реАрдорд╛рдПрдВ рд╕реЗрдЯ рдирд╣реАрдВ рдХреА рдЧрдИ рд╣реИрдВ рддреЛред

### рдиреАрддрд┐ рд╡рд┐рдЫреЗрдж <a href="#policy-fragmentation" id="policy-fragmentation"></a>

рдПрдХ рдмрд╛рд░ рдЬрдм рдПрдХ рдиреАрддрд┐ рдкрд░рд┐рднрд╛рд╖рд┐рдд рд╣реЛрддреА рд╣реИ, рддреЛ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ рдХрд┐ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдП рдХрд┐ рдиреАрддрд┐ рдлрд╝рд╛рдЗрд▓ рдкреНрд░рднрд╛рд╡реА рд╣реЛ рд░рд╣реА рд╣реИред рд╡рд┐рддрд░рдг рдХреЗ рд╕рд╛рде рдмрдВрдбрд▓ рдЗрдореЗрдЬрдореИрдЬрд┐рдХ рдкреИрдХреЗрдЬ рдпрд╛ рдХрдИ рдкреИрдХреЗрдЬ рдкреНрд░рдмрдВрдзрдХреЛрдВ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╕реНрдерд╛рдкрд┐рдд рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рдЗрдореЗрдЬрдореИрдЬрд┐рдХ рдкреИрдХреЗрдЬ рдПрдХ рджреВрд╕рд░реЗ рдХреЗ рд╕рд╛рде рдмрд╛рдзрд╛ рдбрд╛рд▓рдиреЗ рд╡рд╛рд▓реА рдЕрд▓рдЧ-рдЕрд▓рдЧ рдиреАрддрд┐рдпреЛрдВ рдХреЛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдЖрдкрдХреА рд╕реНрдерд╛рдиреАрдп рдорд╢реАрди рдкрд░ рддреНрд╡рд░рд┐рдд `find` рдПрдХ `policy.xml` рдлрд╝рд╛рдЗрд▓ рдХреЗ рдПрдХрд╛рдзрд┐рдХ рдШрдЯрдирд╛рдПрдБ рдкрд╣рдЪрд╛рдиреЗрдВрдЧреЗ:
```shell-session
$ find / -iname policy.xml

# Example output on macOS
/usr/local/etc/ImageMagick-7/policy.xml
/usr/local/Cellar/imagemagick@6/6.9.12-60/etc/ImageMagick-6/policy.xml
/usr/local/Cellar/imagemagick@6/6.9.12-60/share/doc/ImageMagick-6/www/source/policy.xml
/usr/local/Cellar/imagemagick/7.1.0-45/etc/ImageMagick-7/policy.xml
/usr/local/Cellar/imagemagick/7.1.0-45/share/doc/ImageMagick-7/www/source/policy.xml

# Example output on Ubuntu
/usr/local/etc/ImageMagick-7/policy.xml
/usr/local/share/doc/ImageMagick-7/www/source/policy.xml
/opt/ImageMagick-7.0.11-5/config/policy.xml
/opt/ImageMagick-7.0.11-5/www/source/policy.xml

```
рдиреАрддрд┐рдпреЛрдВ рдХреЛ рднреА [-limit](https://imagemagick.org/script/command-line-options.php#limit) CLI рддрд░реНрдХ, [MagickCore API](https://imagemagick.org/api/resource.php#SetMagickResourceLimit) рд╡рд┐рдзрд┐рдпреЛрдВ рдпрд╛ рдкрд░реНрдпрд╛рд╡рд░рдг рдЪрд░реЛрдВ рдХреЗ рд╕рд╛рде рд╡рд┐рдиреНрдпрд╛рд╕рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

### рдПрдХ рдкреНрд░рд╛рд░рдВрднрд┐рдХ, рд╕рдВрдХреАрд░реНрдг рдиреАрддрд┐ <a href="#a-starter-restrictive-policy" id="a-starter-restrictive-policy"></a>

рдЖрдзрд┐рдХрд╛рд░рд┐рдХ рджрд╕реНрддрд╛рд╡реЗрдЬрд╝реАрдХрд░рдг рдореЗрдВ рд╡рд░реНрдгрд┐рдд рд╕рдмрд╕реЗ рд╕рдВрдХреАрд░реНрдг рдиреАрддрд┐ рд╕реЗ рд╢реБрд░реВ рдХрд░рдХреЗ, рд╣рдордиреЗ рдЕрдкрдиреА рд╕рднреА рдЕрд╡рд▓реЛрдХрдиреЛрдВ рдХреЛ рдПрдХрддреНрд░ рдХрд░рдиреЗ рд╡рд╛рд▓реА рд╕рдВрдХреАрд░реНрдг рдиреАрддрд┐ рддреИрдпрд╛рд░ рдХреА рд╣реИ:
```xml
<policymap xmlns="">
<policy domain="resource" name="temporary-path" value="/mnt/magick-conversions-with-restrictive-permissions"/> <!-- the location should only be accessible to the low-privileged user running ImageMagick -->
<policy domain="resource" name="memory" value="256MiB"/>
<policy domain="resource" name="list-length" value="32"/>
<policy domain="resource" name="width" value="8KP"/>
<policy domain="resource" name="height" value="8KP"/>
<policy domain="resource" name="map" value="512MiB"/>
<policy domain="resource" name="area" value="16KP"/>
<policy domain="resource" name="disk" value="1GiB"/>
<policy domain="resource" name="file" value="768"/>
<policy domain="resource" name="thread" value="2"/>
<policy domain="resource" name="time" value="10"/>
<policy domain="module" rights="none" pattern="*" />
<policy domain="delegate" rights="none" pattern="*" />
<policy domain="coder" rights="none" pattern="*" />
<policy domain="coder" rights="write" pattern="{PNG,JPG,JPEG}" /> <!-- your restricted set of acceptable formats, set your rights needs -->
<policy domain="filter" rights="none" pattern="*" />
<policy domain="path" rights="none" pattern="@*"/>
<policy domain="cache" name="memory-map" value="anonymous"/>
<policy domain="cache" name="synchronize" value="true"/>
<!-- <policy domain="cache" name="shared-secret" value="my-secret-passphrase" stealth="True"/> Only needed for distributed pixel cache spanning multiple servers -->
<policy domain="system" name="shred" value="2"/>
<policy domain="system" name="max-memory-request" value="256MiB"/>
<policy domain="resource" name="throttle" value="1"/> <!-- Periodically yield the CPU for at least the time specified in ms -->
<policy xmlns="" domain="system" name="precision" value="6"/>
</policymap>
```
рдЖрдк `identify` рдХрдорд╛рдВрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдПрдХ рд╕реБрд░рдХреНрд╖рд╛ рдиреАрддрд┐ рд╕рдХреНрд░рд┐рдп рд╣реИ:
```
identify -list policy
Path: ImageMagick/policy.xml
...
```
рдЖрдк рдЕрдкрдиреА рддреИрдпрд╛рд░ рдХреА рдЧрдИ рдиреАрддрд┐ рдХрд╛ рд╡рд┐рдХрд╕рд┐рдд рдХрд░рддреЗ рд╕рдордп рд╣рдорд╛рд░реЗ рдореВрд▓реНрдпрд╛рдВрдХрди рдЙрдкрдХрд░рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рднреА рдЦреЗрд▓ рд╕рдХрддреЗ рд╣реИрдВред

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>тШБя╕П HackTricks Cloud тШБя╕П</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ЁЯРж Twitter ЁЯРж</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ЁЯОЩя╕П Twitch ЁЯОЩя╕П</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ЁЯОе Youtube ЁЯОе</strong></a></summary>

* рдХреНрдпрд╛ рдЖрдк рдПрдХ **рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХрдВрдкрдиреА** рдореЗрдВ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ? рдХреНрдпрд╛ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХреЛ HackTricks рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд** рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ? рдпрд╛ рдХреНрдпрд╛ рдЖрдкрдХреЛ **PEASS рдХреЗ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рдХрд╛ рдЙрдкрдпреЛрдЧ** рдХрд░рдиреЗ рдХреА рдЗрдЪреНрдЫрд╛ рд╣реИ? [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ!
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFT рд╕рдВрдЧреНрд░рд╣**](https://opensea.io/collection/the-peass-family) рджреЗрдЦреЗрдВ
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks swag**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** [**ЁЯТм**](https://emojipedia.org/speech-balloon/) [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ рдпрд╛ рдореБрдЭреЗ **Twitter** рдкрд░ **рдлрд╝реЙрд▓реЛ** рдХрд░реЗрдВ [**ЁЯРж**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ рдФрд░ PR рдЬрдорд╛ рдХрд░рдХреЗ** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **рдФрд░** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **рдХреЛ**ред

</details>
