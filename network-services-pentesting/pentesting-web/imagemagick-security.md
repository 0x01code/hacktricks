# ImageMagick Sicherheit

<details>

<summary><strong>Lernen Sie AWS-Hacking von Grund auf mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks bewerben m√∂chten** oder **HackTricks als PDF herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merchandise**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositories senden.

</details>

Weitere Details finden Sie unter [**https://blog.doyensec.com/2023/01/10/imagemagick-security-policy-evaluator.html**](https://blog.doyensec.com/2023/01/10/imagemagick-security-policy-evaluator.html)

ImageMagick, eine vielseitige Bildverarbeitungsbibliothek, stellt aufgrund ihrer umfangreichen Optionen und fehlenden detaillierten Online-Dokumentation eine Herausforderung bei der Konfiguration ihrer Sicherheitsrichtlinie dar. Benutzer erstellen oft Richtlinien basierend auf fragmentierten Internetquellen, was zu potenziellen Fehlkonfigurationen f√ºhrt. Die Bibliothek unterst√ºtzt eine Vielzahl von √ºber 100 Bildformaten, die jeweils zu ihrer Komplexit√§t und ihrem Schwachstellenprofil beitragen, wie durch historische Sicherheitsvorf√§lle gezeigt wurde.

## Hin zu sichereren Richtlinien
Um diese Herausforderungen anzugehen, wurde ein [Tool entwickelt](https://imagemagick-secevaluator.doyensec.com/), das bei der Gestaltung und √úberpr√ºfung der Sicherheitsrichtlinien von ImageMagick hilft. Dieses Tool basiert auf umfangreichen Forschungen und zielt darauf ab, sicherzustellen, dass die Richtlinien nicht nur robust sind, sondern auch frei von Schwachstellen, die ausgenutzt werden k√∂nnten.

## Allowlist vs. Denylist-Ansatz
Historisch gesehen basierten ImageMagick-Richtlinien auf einem Denylist-Ansatz, bei dem bestimmte Codierer den Zugriff verweigert wurden. √Ñnderungen in ImageMagick 6.9.7-7 haben jedoch dieses Paradigma verschoben und erm√∂glichen einen Allowlist-Ansatz. Bei diesem Ansatz werden zun√§chst allen Codierern der Zugriff verweigert und dann selektiv vertrauensw√ºrdigen Codierern Zugriff gew√§hrt, um die Sicherheitslage zu verbessern.
```xml
...
<policy domain="coder" rights="none" pattern="*" />
<policy domain="coder" rights="read | write" pattern="{GIF,JPEG,PNG,WEBP}" />
...
```
## Gro√ü- und Kleinschreibung in Richtlinien
Es ist wichtig zu beachten, dass Richtlinienmuster in ImageMagick Gro√ü- und Kleinschreibung beachten. Daher ist es entscheidend, sicherzustellen, dass Codierer und Module in den Richtlinien korrekt in Gro√übuchstaben geschrieben sind, um unbeabsichtigte Berechtigungen zu verhindern.

## Ressourcenbegrenzungen
ImageMagick ist anf√§llig f√ºr Denial-of-Service-Angriffe, wenn es nicht ordnungsgem√§√ü konfiguriert ist. Das Festlegen expliziter Ressourcenbegrenzungen in der Richtlinie ist unerl√§sslich, um solche Sicherheitsl√ºcken zu verhindern.

## Richtlinienfragmentierung
Richtlinien k√∂nnen √ºber verschiedene ImageMagick-Installationen fragmentiert sein, was zu potenziellen Konflikten oder √úberschreibungen f√ºhren kann. Es wird empfohlen, die aktiven Richtliniendateien mithilfe von Befehlen wie dem folgenden zu lokalisieren und zu √ºberpr√ºfen:
```shell
$ find / -iname policy.xml
```
## Eine Starter-Richtlinie mit Einschr√§nkungen
Es wurde eine Vorlage f√ºr eine restriktive Richtlinie vorgeschlagen, die sich auf strenge Ressourcenbeschr√§nkungen und Zugriffskontrollen konzentriert. Diese Vorlage dient als Grundlage f√ºr die Entwicklung ma√ügeschneiderter Richtlinien, die den spezifischen Anforderungen der Anwendung entsprechen.

Die Wirksamkeit einer Sicherheitsrichtlinie kann mit dem Befehl `identify -list policy` in ImageMagick best√§tigt werden. Dar√ºber hinaus kann das zuvor erw√§hnte [Bewertungstool](https://imagemagick-secevaluator.doyensec.com/) verwendet werden, um die Richtlinie entsprechend den individuellen Bed√ºrfnissen zu optimieren.

## Referenzen
* [https://blog.doyensec.com/2023/01/10/imagemagick-security-policy-evaluator.html**](https://blog.doyensec.com/2023/01/10/imagemagick-security-policy-evaluator.html)



<details>

<summary><strong>Lernen Sie AWS-Hacking von Grund auf mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks bewerben m√∂chten** oder **HackTricks als PDF herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merchandise**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositories senden.

</details>
