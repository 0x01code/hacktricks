# Cabe√ßalhos HTTP Especiais

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Voc√™ trabalha em uma **empresa de seguran√ßa cibern√©tica**? Voc√™ quer ver sua **empresa anunciada no HackTricks**? ou voc√™ quer ter acesso √† **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**? Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* **Junte-se ao** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para o** [**reposit√≥rio hacktricks**](https://github.com/carlospolop/hacktricks) **e** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Listas de palavras e ferramentas

* [https://github.com/danielmiessler/SecLists/tree/master/Miscellaneous/web/http-request-headers](https://github.com/danielmiessler/SecLists/tree/master/Miscellaneous/web/http-request-headers)
* [https://github.com/rfc-st/humble](https://github.com/rfc-st/humble)

## Cabe√ßalhos para alterar a localiza√ß√£o

Reescrever o **IP de origem**:

* `X-Originating-IP: 127.0.0.1`
* `X-Forwarded-For: 127.0.0.1`
* `X-Forwarded: 127.0.0.1`
* `Forwarded-For: 127.0.0.1`
* `X-Forwarded-Host: 127.0.0.1`
* `X-Remote-IP: 127.0.0.1`
* `X-Remote-Addr: 127.0.0.1`
* `X-ProxyUser-Ip: 127.0.0.1`
* `X-Original-URL: 127.0.0.1`
* `Client-IP: 127.0.0.1`
* `X-Client-IP: 127.0.0.1`
* `X-Host: 127.0.0.1`
* `True-Client-IP: 127.0.0.1`
* `Cluster-Client-IP: 127.0.0.1`
* `X-ProxyUser-Ip: 127.0.0.1`
* `Via: 1.0 fred, 1.1 127.0.0.1`
* `Connection: close, X-Forwarded-For` (Verifique os cabe√ßalhos hop-by-hop)

Reescrever a **localiza√ß√£o**:

* `X-Original-URL: /admin/console`
* `X-Rewrite-URL: /admin/console`

## Cabe√ßalhos hop-by-hop

Um cabe√ßalho hop-by-hop √© um cabe√ßalho projetado para ser processado e consumido pelo proxy que est√° manipulando a solicita√ß√£o, em vez de um cabe√ßalho end-to-end.

* `Connection: close, X-Forwarded-For`

{% content-ref url="../../pentesting-web/abusing-hop-by-hop-headers.md" %}
[abusing-hop-by-hop-headers.md](../../pentesting-web/abusing-hop-by-hop-headers.md)
{% endcontent-ref %}

## HTTP Request Smuggling

* `Content-Length: 30`
* `Transfer-Encoding: chunked`

{% content-ref url="../../pentesting-web/http-request-smuggling/" %}
[http-request-smuggling](../../pentesting-web/http-request-smuggling/)
{% endcontent-ref %}

## Cabe√ßalhos de cache

**Cabe√ßalhos de cache do servidor**:

* **`X-Cache`** na resposta pode ter o valor **`miss`** quando a solicita√ß√£o n√£o foi armazenada em cache e o valor **`hit`** quando est√° em cache
* **`Cache-Control`** indica se um recurso est√° sendo armazenado em cache e quando ser√° a pr√≥xima vez que o recurso ser√° armazenado em cache novamente: `Cache-Control: public, max-age=1800`
* **`Vary`** √© frequentemente usado na resposta para **indicar cabe√ßalhos adicionais** que s√£o tratados como **parte da chave de cache**, mesmo que normalmente n√£o sejam chaveados.
* **`Age`** define os tempos em segundos que o objeto esteve no cache do proxy.
* **`Server-Timing: cdn-cache; desc=HIT`** tamb√©m indica que um recurso foi armazenado em cache

{% content-ref url="../../pentesting-web/cache-deception.md" %}
[cache-deception.md](../../pentesting-web/cache-deception.md)
{% endcontent-ref %}

**Cabe√ßalhos de cache local**:

* `Clear-Site-Data`: Cabe√ßalho para indicar o cache que deve ser removido: `Clear-Site-Data: "cache", "cookies"`
* `Expires`: Cont√©m a data/hora em que a resposta
```http
Content-Security-Policy: require-trusted-types-for 'script'
```

```javascript
// Feature detection
if (window.trustedTypes && trustedTypes.createPolicy) {
  // Name and create a policy
  const policy = trustedTypes.createPolicy('escapePolicy', {
    createHTML: str => {
      return str.replace(/\</g, '&lt;').replace(/>/g, '&gt;');
    }
  });
}
```

```javascript
// Assignment of raw strings is blocked by Trusted Types.
el.innerHTML = 'some string'; // This throws an exception.

// Assignment of Trusted Types is accepted safely.
const escaped = policy.createHTML('<img src=x onerror=alert(1)>');
el.innerHTML = escaped;  // '&lt;img src=x onerror=alert(1)&gt;'
```
### X-Content-Type-Options <a href="#xcto" id="xcto"></a>

Quando um documento HTML malicioso √© servido a partir do seu dom√≠nio (por exemplo, se uma imagem enviada para um servi√ßo de fotos cont√©m marca√ß√£o HTML v√°lida), alguns navegadores o tratam como um documento ativo e permitem que ele execute scripts no contexto do aplicativo, levando a um [bug de cross-site scripting](https://www.google.com/about/appsecurity/learning/xss/).

`X-Content-Type-Options: nosniff` impede isso, instruindo o navegador de que o [tipo MIME](https://mimesniff.spec.whatwg.org/#introduction) definido no cabe√ßalho `Content-Type` para uma determinada resposta est√° correto. Este cabe√ßalho √© recomendado para **todos os seus recursos**.
```http
X-Content-Type-Options: nosniff
```
### X-Frame-Options <a href="#xfo" id="xfo"></a>

Se um site malicioso pode incorporar seu site como um iframe, isso pode permitir que invasores invoquem a√ß√µes n√£o intencionais pelo usu√°rio com [clickjacking](https://portswigger.net/web-security/clickjacking). Al√©m disso, em alguns casos, ataques do tipo [Spectre](https://en.wikipedia.org/wiki/Spectre\_\(security\_vulnerability\)) d√£o a sites maliciosos a chance de aprender sobre o conte√∫do de um documento incorporado.

`X-Frame-Options` indica se um navegador deve ou n√£o ser permitido a renderizar uma p√°gina em um `<frame>`, `<iframe>`, `<embed>` ou `<object>`. **Todos os documentos** s√£o recomendados a enviar este cabe√ßalho para indicar se permitem ser incorporados por outros documentos.

Se voc√™ precisar de um controle mais granular, como permitir apenas uma origem espec√≠fica para incorporar o documento, use a diretiva [frame-ancestors](https://developer.mozilla.org/docs/Web/HTTP/Headers/Content-Security-Policy/frame-ancestors) do [CSP](https://web.dev/security-headers/#csp).
```http
X-Frame-Options: DENY
```
### Pol√≠tica de Recursos de Origem Cruzada (CORP) <a href="#corp" id="corp"></a>

Um atacante pode incorporar recursos de outra origem, por exemplo, do seu site, para aprender informa√ß√µes sobre eles, explorando vazamentos entre sites.

`Cross-Origin-Resource-Policy` mitiga esse risco indicando o conjunto de sites em que pode ser carregado. O cabe√ßalho pode ter um dos tr√™s valores: `same-origin`, `same-site` e `cross-origin`. **Todos os recursos** s√£o recomendados a enviar esse cabe√ßalho para indicar se permitem ser carregados por outros sites.
```
Cross-Origin-Resource-Policy: same-origin
```
### Pol√≠tica de Recursos de Origem Cruzada (CORB) <a href="#corp" id="corp"></a>

Ajuda a mitigar a amea√ßa de ataques de canal lateral (incluindo Spectre). √â projetado para impedir que o navegador **entregue determinadas respostas de rede de origem cruzada para uma p√°gina da web**, quando elas podem conter informa√ß√µes confidenciais e **n√£o s√£o necess√°rias para recursos da web existentes**.\
Da mesma forma, tamb√©m ajuda a mitigar vulnerabilidades de Inclus√£o de Script de Origem Cruzada (XSSI).\
Por exemplo, ele bloquear√° uma resposta de texto/html de origem cruzada solicitada de uma tag \<script> ou \<img>, substituindo-a por uma resposta vazia. Esta √© uma parte importante das prote√ß√µes inclu√≠das com [Isolamento de Site](https://www.chromium.org/Home/chromium-security/site-isolation).

### Pol√≠tica de Abertura de Origem Cruzada (COOP) <a href="#coop" id="coop"></a>

O site de um invasor pode abrir outro site em uma janela pop-up para aprender informa√ß√µes sobre ele, explorando [vazamentos de origem cruzada baseados na web](https://xsleaks.dev). Em alguns casos, isso tamb√©m pode permitir a explora√ß√£o de ataques de canal lateral baseados em [Spectre](https://en.wikipedia.org/wiki/Spectre\_\(security\_vulnerability\)).

O cabe√ßalho `Cross-Origin-Opener-Policy` fornece uma maneira para um documento se isolar de janelas de origem cruzada abertas por meio de `window.open()` ou um link com `target="_blank"` sem `rel="noopener"`. Como resultado, qualquer abertura de origem cruzada do documento n√£o ter√° refer√™ncia a ele e n√£o poder√° interagir com ele.
```http
Cross-Origin-Opener-Policy: same-origin-allow-popups
```
### Compartilhamento de Recursos de Origem Cruzada (CORS) <a href="#cors" id="cors"></a>

Ao contr√°rio de outros itens deste artigo, o Compartilhamento de Recursos de Origem Cruzada (CORS) n√£o √© um cabe√ßalho, mas um mecanismo do navegador que solicita e permite o acesso a recursos de origem cruzada.

Por padr√£o, os navegadores aplicam [a pol√≠tica de mesma origem](https://web.dev/same-origin-policy/) para impedir que uma p√°gina da web acesse recursos de origem cruzada. Por exemplo, quando uma imagem de origem cruzada √© carregada, mesmo que seja exibida visualmente na p√°gina da web, o JavaScript na p√°gina n√£o tem acesso aos dados da imagem. O provedor de recursos pode relaxar as restri√ß√µes e permitir que outros sites leiam o recurso optando pelo CORS.
```http
Access-Control-Allow-Origin: https://example.com
Access-Control-Allow-Credentials: true
```
### Pol√≠tica de Incorpora√ß√£o de Origem Cruzada (COEP) <a href="#coep" id="coep"></a>

Para reduzir a capacidade de ataques baseados em [Spectre](https://en.wikipedia.org/wiki/Spectre\_\(security\_vulnerability\)) de roubar recursos de origem cruzada, recursos como `SharedArrayBuffer` ou `performance.measureUserAgentSpecificMemory()` s√£o desativados por padr√£o.

`Cross-Origin-Embedder-Policy: require-corp` impede que documentos e workers carreguem recursos de origem cruzada, como imagens, scripts, folhas de estilo, iframes e outros, a menos que esses recursos optem explicitamente por serem carregados por meio de cabe√ßalhos [CORS](https://web.dev/security-headers/#cors) ou [CORP](https://web.dev/security-headers/#corp). COEP pode ser combinado com `Cross-Origin-Opener-Policy` para optar um documento pelo isolamento de origem cruzada.

Use `Cross-Origin-Embedder-Policy: require-corp` quando quiser habilitar o [isolamento de origem cruzada](https://web.dev/coop-coep/) para o seu documento.
```http
Cross-Origin-Embedder-Policy: require-corp
```
### HTTP Strict Transport Security (HSTS) <a href="#hsts" id="hsts"></a>

A comunica√ß√£o por meio de uma conex√£o HTTP simples n√£o √© criptografada, tornando os dados transferidos acess√≠veis a espi√µes de rede.

O cabe√ßalho `Strict-Transport-Security` informa ao navegador que ele nunca deve carregar o site usando HTTP e, em vez disso, usar HTTPS. Uma vez definido, o navegador usar√° HTTPS em vez de HTTP para acessar o dom√≠nio sem um redirecionamento por um per√≠odo definido no cabe√ßalho.
```http
Strict-Transport-Security: max-age=3153600
```
## Recursos

* [https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers)
* [https://web.dev/security-headers/](https://web.dev/security-headers/)

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Voc√™ trabalha em uma **empresa de ciberseguran√ßa**? Voc√™ quer ver sua **empresa anunciada no HackTricks**? ou voc√™ quer ter acesso √† **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**? Verifique os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* **Junte-se ao** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para o** [**reposit√≥rio hacktricks**](https://github.com/carlospolop/hacktricks) **e para o** [**reposit√≥rio hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
