# Encabezados HTTP especiales

<details>

<summary><strong>Aprende a hackear AWS desde cero hasta convertirte en un experto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si deseas ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** ¬°Consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Obt√©n el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠guenos** en **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Listas de palabras y herramientas

* [https://github.com/danielmiessler/SecLists/tree/master/Miscellaneous/web/http-request-headers](https://github.com/danielmiessler/SecLists/tree/master/Miscellaneous/web/http-request-headers)
* [https://github.com/rfc-st/humble](https://github.com/rfc-st/humble)

## Encabezados para cambiar la ubicaci√≥n

Reescribir **IP de origen**:

* `X-Originating-IP: 127.0.0.1`
* `X-Forwarded-For: 127.0.0.1`
* `X-Forwarded: 127.0.0.1`
* `Forwarded-For: 127.0.0.1`
* `X-Forwarded-Host: 127.0.0.1`
* `X-Remote-IP: 127.0.0.1`
* `X-Remote-Addr: 127.0.0.1`
* `X-ProxyUser-Ip: 127.0.0.1`
* `X-Original-URL: 127.0.0.1`
* `Client-IP: 127.0.0.1`
* `X-Client-IP: 127.0.0.1`
* `X-Host: 127.0.0.1`
* `True-Client-IP: 127.0.0.1`
* `Cluster-Client-IP: 127.0.0.1`
* `Via: 1.0 fred, 1.1 127.0.0.1`
* `Connection: close, X-Forwarded-For` (Verificar encabezados hop-by-hop)

Reescribir **ubicaci√≥n**:

* `X-Original-URL: /admin/console`
* `X-Rewrite-URL: /admin/console`

## Encabezados hop-by-hop

Un encabezado hop-by-hop es un encabezado dise√±ado para ser procesado y consumido por el proxy que maneja actualmente la solicitud, en lugar de un encabezado de extremo a extremo.

* `Connection: close, X-Forwarded-For`

{% content-ref url="../../pentesting-web/abusing-hop-by-hop-headers.md" %}
[abusing-hop-by-hop-headers.md](../../pentesting-web/abusing-hop-by-hop-headers.md)
{% endcontent-ref %}

## Contrabando de solicitudes HTTP

* `Content-Length: 30`
* `Transfer-Encoding: chunked`

{% content-ref url="../../pentesting-web/http-request-smuggling/" %}
[http-request-smuggling](../../pentesting-web/http-request-smuggling/)
{% endcontent-ref %}

## Encabezados de cach√©

**Encabezados de cach√© del servidor**:

* **`X-Cache`** en la respuesta puede tener el valor **`miss`** cuando la solicitud no estaba en cach√© y el valor **`hit`** cuando est√° en cach√©
* **`Cache-Control`** indica si un recurso est√° siendo almacenado en cach√© y cu√°ndo ser√° la pr√≥xima vez que el recurso se almacene en cach√© nuevamente: `Cache-Control: public, max-age=1800`
* **`Vary`** se usa a menudo en la respuesta para **indicar encabezados adicionales** que se tratan como **parte de la clave de cach√©** incluso si normalmente no est√°n en clave.
* **`Age`** define los tiempos en segundos que el objeto ha estado en la cach√© del proxy.
* **`Server-Timing: cdn-cache; desc=HIT`** tambi√©n indica que un recurso fue almacenado en cach√©

{% content-ref url="../../pentesting-web/cache-deception.md" %}
[cache-deception.md](../../pentesting-web/cache-deception.md)
{% endcontent-ref %}

**Encabezados de cach√© local**:

* `Clear-Site-Data`: Encabezado para indicar la cach√© que debe eliminarse: `Clear-Site-Data: "cache", "cookies"`
* `Expires`: Contiene la fecha/hora en que la respuesta debe expirar: `Expires: Wed, 21 Oct 2015 07:28:00 GMT`
* `Pragma: no-cache` igual que `Cache-Control: no-cache`
* `Warning`: El encabezado general **`Warning`** de HTTP contiene informaci√≥n sobre posibles problemas con el estado del mensaje. Puede aparecer m√°s de un encabezado `Warning` en una respuesta. `Warning: 110 anderson/1.3.37 "Response is stale"`

## Condiciones

* Las solicitudes que utilizan estos encabezados: **`If-Modified-Since`** y **`If-Unmodified-Since`** responder√°n con datos solo si el encabezado de respuesta **`Last-Modified`** contiene un tiempo diferente.
* Las solicitudes condicionales que utilizan **`If-Match`** y **`If-None-Match`** utilizan un valor Etag para que el servidor web env√≠e el contenido de la respuesta si los datos (Etag) han cambiado. El `Etag` se toma de la respuesta HTTP.
* El valor **Etag** suele ser **calculado en funci√≥n** del **contenido** de la respuesta. Por ejemplo, `ETag: W/"37-eL2g8DEyqntYlaLp5XLInBWsjWI"` indica que el `Etag` es el **Sha1** de **37 bytes**.

## Solicitudes de rango

* **`Accept-Ranges`**: Indica si el servidor admite solicitudes de rango, y en qu√© unidad puede expresarse el rango. `Accept-Ranges: <unidad-de-rango>`
* **`Range`**: Indica la parte de un documento que el servidor debe devolver.
* **`If-Range`**: Crea una solicitud de rango condicional que solo se cumple si el etag o la fecha dados coinciden con el recurso remoto. Se utiliza para evitar la descarga de dos rangos de una versi√≥n incompatible del recurso.
* **`Content-Range`**: Indica d√≥nde en un mensaje de cuerpo completo pertenece un mensaje parcial.

## Informaci√≥n del cuerpo del mensaje

* **`Content-Length`:** El tama√±o del recurso, en n√∫mero decimal de bytes.
* **`Content-Type`**: Indica el tipo de medio del recurso
* **`Content-Encoding`**: Se utiliza para especificar el algoritmo de compresi√≥n.
* **`Content-Language`**: Describe el idioma(s) humano(s) previsto(s) para la audiencia, permitiendo que un usuario diferencie seg√∫n el idioma preferido por los usuarios.
* **`Content-Location`**: Indica una ubicaci√≥n alternativa para los datos devueltos.

Desde el punto de vista de una prueba de penetraci√≥n, esta informaci√≥n suele ser "in√∫til", pero si el recurso est√° **protegido** por un 401 o 403 y puedes encontrar alguna **forma** de **obtener** esta **informaci√≥n**, esto podr√≠a ser **interesante**.\
Por ejemplo, una combinaci√≥n de **`Range`** y **`Etag`** en una solicitud HEAD puede filtrar el contenido de la p√°gina a trav√©s de solicitudes HEAD:

* Una solicitud con el encabezado `Range: bytes=20-20` y con una respuesta que contiene `ETag: W/"1-eoGvPlkaxxP4HqHv6T3PNhV9g3Y"` est√° filtrando que el SHA1 del byte 20 es `ETag: eoGvPlkaxxP4HqHv6T3PNhV9g3Y`

## Informaci√≥n del servidor

* `Server: Apache/2.4.1 (Unix)`
* `X-Powered-By: PHP/5.3.3`

## Controles

* **`Allow`**: Este encabezado se utiliza para comunicar los m√©todos HTTP que un recurso puede manejar. Por ejemplo, podr√≠a especificarse como `Allow: GET, POST, HEAD`, indicando que el recurso admite estos m√©todos.
* **`Expect`**: Utilizado por el cliente para transmitir expectativas que el servidor debe cumplir para que la solicitud se procese correctamente. Un caso de uso com√∫n implica el encabezado `Expect: 100-continue`, que indica que el cliente tiene la intenci√≥n de enviar una carga de datos grande. El cliente espera una respuesta `100 (Continue)` antes de continuar con la transmisi√≥n. Este mecanismo ayuda a optimizar el uso de la red al esperar la confirmaci√≥n del servidor.

## Descargas

* El encabezado **`Content-Disposition`** en las respuestas HTTP indica si un archivo debe mostrarse **en l√≠nea** (dentro de la p√°gina web) o tratarse como un **archivo adjunto** (descargado). Por ejemplo:
```
Content-Disposition: attachment; filename="filename.jpg"
```
## Encabezados de Seguridad

### Pol√≠tica de Seguridad de Contenido (CSP) <a href="#csp" id="csp"></a>

{% content-ref url="../../pentesting-web/content-security-policy-csp-bypass/" %}
[content-security-policy-csp-bypass](../../pentesting-web/content-security-policy-csp-bypass/)
{% endcontent-ref %}

### **Tipos de Confianza**

Al hacer cumplir los Tipos de Confianza a trav√©s de CSP, las aplicaciones pueden protegerse contra ataques de XSS en el DOM. Los Tipos de Confianza garantizan que solo objetos espec√≠ficamente dise√±ados, compatibles con las pol√≠ticas de seguridad establecidas, puedan utilizarse en llamadas peligrosas a API web, asegurando as√≠ el c√≥digo JavaScript de forma predeterminada.
```javascript
// Feature detection
if (window.trustedTypes && trustedTypes.createPolicy) {
// Name and create a policy
const policy = trustedTypes.createPolicy('escapePolicy', {
createHTML: str => str.replace(/\</g, '&lt;').replace(/>/g, '&gt;');
});
}
```

```javascript
// Assignment of raw strings is blocked, ensuring safety.
el.innerHTML = 'some string'; // Throws an exception.
const escaped = policy.createHTML('<img src=x onerror=alert(1)>');
el.innerHTML = escaped;  // Results in safe assignment.
```
### **X-Content-Type-Options**

Este encabezado previene el tipo de MIME sniffing, una pr√°ctica que podr√≠a llevar a vulnerabilidades XSS. Asegura que los navegadores respeten los tipos de MIME especificados por el servidor.
```
X-Content-Type-Options: nosniff
```
### **X-Frame-Options**

Para combatir el clickjacking, este encabezado restringe c√≥mo se pueden incrustar documentos en etiquetas `<frame>`, `<iframe>`, `<embed>`, o `<object>`, recomendando que todos los documentos especifiquen expl√≠citamente sus permisos de incrustaci√≥n.
```
X-Frame-Options: DENY
```
### **Pol√≠tica de Recursos de Origen Cruzado (CORP) y Compartir Recursos de Origen Cruzado (CORS)**

CORP es crucial para especificar qu√© recursos pueden ser cargados por sitios web, mitigando filtraciones entre sitios. CORS, por otro lado, permite un mecanismo m√°s flexible de compartir recursos de origen cruzado, relajando la pol√≠tica de mismo origen bajo ciertas condiciones.
```
Cross-Origin-Resource-Policy: same-origin
Access-Control-Allow-Origin: https://example.com
Access-Control-Allow-Credentials: true
```
### **Pol√≠tica de incrustaci√≥n de origen cruzado (COEP) y Pol√≠tica de apertura de origen cruzado (COOP)**

COEP y COOP son esenciales para habilitar el aislamiento de origen cruzado, reduciendo significativamente el riesgo de ataques similares a Spectre. Controlan la carga de recursos de origen cruzado y la interacci√≥n con ventanas de origen cruzado, respectivamente.
```
Cross-Origin-Embedder-Policy: require-corp
Cross-Origin-Opener-Policy: same-origin-allow-popups
```
### **HTTP Strict Transport Security (HSTS)**

Por √∫ltimo, HSTS es una caracter√≠stica de seguridad que obliga a los navegadores a comunicarse solo con servidores a trav√©s de conexiones seguras HTTPS, mejorando as√≠ la privacidad y la seguridad.
```
Strict-Transport-Security: max-age=3153600
```
## Referencias

* [https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Disposition](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Disposition)
* [https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers)
* [https://web.dev/security-headers/](https://web.dev/security-headers/)
* [https://web.dev/articles/security-headers](https://web.dev/articles/security-headers)

<details>

<summary><strong>Aprende hacking en AWS de cero a h√©roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si deseas ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** Consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Obt√©n el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠guenos** en **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
