# 特別なHTTPヘッダ

<details>

<summary><strong>htARTE（HackTricks AWS Red Team Expert）</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>を通じてゼロからヒーローまでAWSハッキングを学ぶ</strong></a><strong>！</strong></summary>

HackTricks をサポートする他の方法:

* **HackTricks で企業を宣伝**したい場合や **HackTricks をPDFでダウンロード**したい場合は [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop) をチェック！
* [**公式PEASS＆HackTricksスウォッグ**](https://peass.creator-spring.com)を入手
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクションを見つける
* **💬 [Discordグループ](https://discord.gg/hRep4RUj7f)** に参加するか、[telegramグループ](https://t.me/peass)に参加するか、**Twitter** 🐦 で **@carlospolopm** をフォローする [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **ハッキングトリックを共有するために** [**HackTricks**](https://github.com/carlospolop/hacktricks) と [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) のgithubリポジトリにPRを提出する

</details>

## ワードリスト＆ツール

* [https://github.com/danielmiessler/SecLists/tree/master/Miscellaneous/web/http-request-headers](https://github.com/danielmiessler/SecLists/tree/master/Miscellaneous/web/http-request-headers)
* [https://github.com/rfc-st/humble](https://github.com/rfc-st/humble)

## 位置を変更するヘッダ

**IPソース**を書き換える:

* `X-Originating-IP: 127.0.0.1`
* `X-Forwarded-For: 127.0.0.1`
* `X-Forwarded: 127.0.0.1`
* `Forwarded-For: 127.0.0.1`
* `X-Forwarded-Host: 127.0.0.1`
* `X-Remote-IP: 127.0.0.1`
* `X-Remote-Addr: 127.0.0.1`
* `X-ProxyUser-Ip: 127.0.0.1`
* `X-Original-URL: 127.0.0.1`
* `Client-IP: 127.0.0.1`
* `X-Client-IP: 127.0.0.1`
* `X-Host: 127.0.0.1`
* `True-Client-IP: 127.0.0.1`
* `Cluster-Client-IP: 127.0.0.1`
* `Via: 1.0 fred, 1.1 127.0.0.1`
* `Connection: close, X-Forwarded-For`（ホップバイホップヘッダを確認）

**位置**を書き換える:

* `X-Original-URL: /admin/console`
* `X-Rewrite-URL: /admin/console`

## ホップバイホップヘッダ

ホップバイホップヘッダは、リクエストを処理しているプロキシによって処理および消費されるヘッダであり、エンドツーエンドヘッダとは対照的です。

* `Connection: close, X-Forwarded-For`

{% content-ref url="../../pentesting-web/abusing-hop-by-hop-headers.md" %}
[abusing-hop-by-hop-headers.md](../../pentesting-web/abusing-hop-by-hop-headers.md)
{% endcontent-ref %}

## HTTPリクエストスマグリング

* `Content-Length: 30`
* `Transfer-Encoding: chunked`

{% content-ref url="../../pentesting-web/http-request-smuggling/" %}
[http-request-smuggling](../../pentesting-web/http-request-smuggling/)
{% endcontent-ref %}

## キャッシュヘッダ

**サーバーキャッシュヘッダ**:

* 応答の **`X-Cache`** には、リクエストがキャッシュされていない場合は値 **`miss`**、キャッシュされている場合は値 **`hit`** が含まれる場合があります
* ヘッダ **`Cf-Cache-Status`** でも同様の動作が見られます
* **`Cache-Control`** はリソースがキャッシュされているかどうかを示し、次回リソースが再度キャッシュされる時間を示します: `Cache-Control: public, max-age=1800`
* **`Vary`** は通常はキーにならないヘッダを **キャッシュキーの一部として扱う** 追加のヘッダを示すために応答でよく使用されます。
* **`Age`** はオブジェクトがプロキシキャッシュに格納されている時間（秒単位）を定義します。
* **`Server-Timing: cdn-cache; desc=HIT`** はリソースがキャッシュされていることを示します

{% content-ref url="../../pentesting-web/cache-deception.md" %}
[cache-deception.md](../../pentesting-web/cache-deception.md)
{% endcontent-ref %}

**ローカルキャッシュヘッダ**:

* `Clear-Site-Data`: 削除すべきキャッシュを示すヘッダ: `Clear-Site-Data: "cache", "cookies"`
* `Expires`: 応答が期限切れになる日付/時刻を含む: `Expires: Wed, 21 Oct 2015 07:28:00 GMT`
* `Pragma: no-cache` は `Cache-Control: no-cache` と同じ
* `Warning`: **`Warning`** 一般的なHTTPヘッダには、メッセージのステータスに問題がある可能性に関する情報が含まれます。複数の `Warning` ヘッダが応答に表示される場合があります。 `Warning: 110 anderson/1.3.37 "Response is stale"`

## 条件付きリクエスト

* これらのヘッダを使用したリクエスト：**`If-Modified-Since`** および **`If-Unmodified-Since`** は、応答ヘッダ **`Last-Modified`** が異なる時間を含む場合にのみデータで応答されます。
* **`If-Match`** と **`If-None-Match`** を使用した条件付きリクエストは、Etag 値を使用して、データ（Etag）が変更された場合にのみウェブサーバーが応答の内容を送信します。 `Etag` はHTTP応答から取得されます。
* **Etag** 値は通常、応答の内容に基づいて **計算されます**。たとえば、`ETag: W/"37-eL2g8DEyqntYlaLp5XLInBWsjWI"` は、`Etag` が **37バイト** の **Sha1** であることを示しています。

## レンジリクエスト

* **`Accept-Ranges`**: サーバーがレンジリクエストをサポートしているかどうか、およびどの単位でレンジを表現できるかを示します。 `Accept-Ranges: <range-unit>`
* **`Range`**: サーバーが返すべきドキュメントの一部を示します。
* **`If-Range`**: 指定されたETagまたは日付がリモートリソースと一致する場合にのみ満たされる条件付きレンジリクエストを作成します。互換性のないリソースの異なるバージョンから2つの範囲をダウンロードするのを防ぐために使用されます。
* **`Content-Range`**: フルボディメッセージ内の部分メッセージが属する場所を示します。

## メッセージ本体情報

* **`Content-Length`:** リソースのサイズ（バイト単位の10進数）を示します。
* **`Content-Type`**: リソースのメディアタイプを示します
* **`Content-Encoding`**: 圧縮アルゴリズムを指定するために使用されます。
* **`Content-Language`**: 観客向けに意図された人間の言語を記述し、ユーザーが自分自身の好みの言語に応じて区別できるようにします。
* **`Content-Location`**: 返されたデータの代替場所を示します。

ペンテストの観点からは、この情報は通常「無意味」ですが、リソースが401または403で保護されており、この情報を取得する方法が見つかる場合、これは「興味深い」かもしれません。\
たとえば、HEADリクエストでの **`Range`** と **`Etag`** の組み合わせは、ページの内容を HEAD リクエスト経由で漏洩させる可能性があります:

* ヘッダ `Range: bytes=20-20` を含むリクエストと、`ETag: W/"1-eoGvPlkaxxP4HqHv6T3PNhV9g3Y"` を含む応答がある場合、バイト20のSHA1が `ETag: eoGvPlkaxxP4HqHv6T3PNhV9g3Y` であることが漏洩しています。
## サーバー情報

* `Server: Apache/2.4.1 (Unix)`
* `X-Powered-By: PHP/5.3.3`

## コントロール

* **`Allow`**: このヘッダーは、リソースが処理できるHTTPメソッドを通知するために使用されます。たとえば、`Allow: GET, POST, HEAD` と指定されることがあり、これはリソースがこれらのメソッドをサポートしていることを示します。
* **`Expect`**: クライアントがリクエストの処理に成功するためにサーバーが満たす必要がある期待を伝達するために使用されます。一般的な使用例として、`Expect: 100-continue` ヘッダーがあります。これは、クライアントが大きなデータペイロードを送信する意図であることを示します。クライアントは、送信を続行する前に `100 (Continue)` 応答を待ちます。このメカニズムは、サーバーの確認を待つことでネットワークの使用を最適化するのに役立ちます。

## ダウンロード

* HTTPレスポンスの **`Content-Disposition`** ヘッダーは、ファイルを **inline**（ウェブページ内）で表示するか、**attachment**（ダウンロード）として扱うかを指示します。たとえば：
```
Content-Disposition: attachment; filename="filename.jpg"
```
## セキュリティヘッダー

### コンテンツセキュリティポリシー（CSP）<a href="#csp" id="csp"></a>

{% content-ref url="../../pentesting-web/content-security-policy-csp-bypass/" %}
[content-security-policy-csp-bypass](../../pentesting-web/content-security-policy-csp-bypass/)
{% endcontent-ref %}

### **信頼されたタイプ**

CSPを介して信頼されたタイプを強制することで、アプリケーションはDOM XSS攻撃から保護されます。信頼されたタイプは、特定に作成されたオブジェクトのみが危険なWeb API呼び出しで使用され、それによってJavaScriptコードがデフォルトでセキュリティポリシーに準拠することを保証します。
```javascript
// Feature detection
if (window.trustedTypes && trustedTypes.createPolicy) {
// Name and create a policy
const policy = trustedTypes.createPolicy('escapePolicy', {
createHTML: str => str.replace(/\</g, '&lt;').replace(/>/g, '&gt;');
});
}
```

```javascript
// Assignment of raw strings is blocked, ensuring safety.
el.innerHTML = 'some string'; // Throws an exception.
const escaped = policy.createHTML('<img src=x onerror=alert(1)>');
el.innerHTML = escaped;  // Results in safe assignment.
```
### **X-Content-Type-Options**

このヘッダーは、XSS脆弱性につながる可能性があるMIMEタイプスニッフィングを防ぎます。これにより、ブラウザがサーバーで指定されたMIMEタイプを尊重することが保証されます。
```
X-Content-Type-Options: nosniff
```
### **X-Frame-Options**

クリックジャッキングに対抗するために、このヘッダーは、ドキュメントが`<frame>`、`<iframe>`、`<embed>`、または`<object>`タグに埋め込まれる方法を制限し、すべてのドキュメントに埋め込み許可を明示的に指定することを推奨しています。
```
X-Frame-Options: DENY
```
### **Cross-Origin Resource Policy (CORP) と Cross-Origin Resource Sharing (CORS)**

CORP は、ウェブサイトが読み込むことができるリソースを指定するために重要であり、クロスサイトリークを軽減します。一方、CORS は、より柔軟なクロスオリジンリソース共有メカニズムを可能にし、特定の条件下で同一オリジンポリシーを緩和します。
```
Cross-Origin-Resource-Policy: same-origin
Access-Control-Allow-Origin: https://example.com
Access-Control-Allow-Credentials: true
```
### **Cross-Origin Embedder Policy (COEP) と Cross-Origin Opener Policy (COOP)**

COEP と COOP は、クロスオリジンの分離を可能にするために重要であり、Spectre のような攻撃のリスクを大幅に低減します。これらは、クロスオリジンリソースの読み込みとクロスオリジンウィンドウとのやり取りを制御します。
```
Cross-Origin-Embedder-Policy: require-corp
Cross-Origin-Opener-Policy: same-origin-allow-popups
```
### **HTTP Strict Transport Security (HSTS)**

最後に、HSTSはブラウザがサーバーとの通信を安全なHTTPS接続のみで行うよう強制するセキュリティ機能です。これにより、プライバシーとセキュリティが向上します。
```
Strict-Transport-Security: max-age=3153600
```
## 参考文献

* [https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Disposition](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Disposition)
* [https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers)
* [https://web.dev/security-headers/](https://web.dev/security-headers/)
* [https://web.dev/articles/security-headers](https://web.dev/articles/security-headers)

<details>

<summary><strong>ゼロからヒーローまでのAWSハッキングを学ぶ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE（HackTricks AWS Red Team Expert）</strong></a><strong>！</strong></summary>

HackTricks をサポートする他の方法:

* **HackTricks で企業を宣伝したい** または **HackTricks をPDFでダウンロードしたい** 場合は [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop) をチェックしてください！
* [**公式PEASS＆HackTricksスウォッグ**](https://peass.creator-spring.com)を入手する
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) を発見し、独占的な [**NFTs**](https://opensea.io/collection/the-peass-family) のコレクションを見つける
* **💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f) または [**telegramグループ**](https://t.me/peass) に参加するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks\_live)** をフォローする。**
* **HackTricks** と [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) のGitHubリポジトリに PR を提出して、あなたのハッキングトリックを共有してください。

</details>
