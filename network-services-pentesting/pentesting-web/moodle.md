# Moodle

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks Cloud ☁️</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>🐦 Twitter 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 Youtube 🎥</strong></a></summary>

* 你在**网络安全公司**工作吗？想要在HackTricks中**宣传你的公司**吗？或者你想要**获取PEASS的最新版本或下载HackTricks的PDF**吗？请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 发现我们的独家[**NFTs**](https://opensea.io/collection/the-peass-family)收藏品- [**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* 获取[**官方PEASS和HackTricks周边产品**](https://peass.creator-spring.com)
* **加入**[**💬**](https://emojipedia.org/speech-balloon/) [**Discord群组**](https://discord.gg/hRep4RUj7f) 或者 [**Telegram群组**](https://t.me/peass) 或者 **关注**我在**Twitter**上的[**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **通过向[hacktricks repo](https://github.com/carlospolop/hacktricks)和[hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)提交PR来分享你的黑客技巧**。

</details>

<img src="../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="original">

如果你对**黑客职业**感兴趣并且想要攻破不可攻破的系统- **我们正在招聘！**（需要流利的波兰语书写和口语能力）。

{% embed url="https://www.stmcyber.com/careers" %}

## 自动扫描

### droopescan
```bash
pip3 install droopescan
droopescan scan moodle -u http://moodle.example.com/<moodle_path>/

[+] Plugins found:
forum http://moodle.schooled.htb/moodle/mod/forum/
http://moodle.schooled.htb/moodle/mod/forum/upgrade.txt
http://moodle.schooled.htb/moodle/mod/forum/version.php

[+] No themes found.

[+] Possible version(s):
3.10.0-beta

[+] Possible interesting urls found:
Static readme file. - http://moodle.schooled.htb/moodle/README.txt
Admin panel - http://moodle.schooled.htb/moodle/login/

[+] Scan finished (0:00:05.643539 elapsed)
```
### moodlescan

moodlescan is a tool used for scanning and enumerating Moodle instances. It can be used to gather information about the Moodle installation, such as version, plugins, and themes. This information can be useful for identifying potential vulnerabilities and weaknesses in the Moodle system.

To use moodlescan, you need to provide the target Moodle URL. The tool will then perform various checks and scans to gather information about the Moodle instance. It will check for common vulnerabilities, such as SQL injection, cross-site scripting (XSS), and insecure file uploads.

moodlescan also has the ability to brute force user credentials, allowing you to test the strength of passwords used in the Moodle system. This can be useful for identifying weak passwords that could be easily compromised.

In addition to scanning for vulnerabilities, moodlescan can also be used to enumerate users, courses, and other information within the Moodle system. This can help in understanding the structure and organization of the Moodle instance.

Overall, moodlescan is a powerful tool for scanning and enumerating Moodle instances. It can help identify potential vulnerabilities and weaknesses in the system, allowing for better security and protection of Moodle installations.
```bash
#Install from https://github.com/inc0d3/moodlescan
python3 moodlescan.py -k -u http://moodle.example.com/<moodle_path>/

Version 0.7 - Dic/2020
.............................................................................................................

By Victor Herrera - supported by www.incode.cl

.............................................................................................................

Getting server information http://moodle.schooled.htb/moodle/ ...

server         	: Apache/2.4.46 (FreeBSD) PHP/7.4.15
x-powered-by   	: PHP/7.4.15
x-frame-options	: sameorigin
last-modified  	: Wed, 07 Apr 2021 21:33:41 GMT

Getting moodle version...

Version found via /admin/tool/lp/tests/behat/course_competencies.feature : Moodle v3.9.0-beta

Searching vulnerabilities...


Vulnerabilities found: 0

Scan completed.
```
### CMSMap

CMSMap是一款用于扫描和识别Moodle网站的工具。它可以帮助你发现Moodle网站的漏洞和弱点，以便进行进一步的渗透测试。

#### 安装CMSMap

要安装CMSMap，你可以使用以下命令：

```bash
git clone https://github.com/Dionach/CMSmap.git
cd CMSmap
python3 cmsmap.py -h
```

#### 使用CMSMap

使用CMSMap扫描Moodle网站非常简单。只需运行以下命令：

```bash
python3 cmsmap.py -t <target> -u <username> -p <password>
```

其中，`<target>`是目标Moodle网站的URL，`<username>`和`<password>`是登录Moodle网站所需的凭据。

#### CMSMap功能

CMSMap具有以下功能：

- 扫描Moodle网站的漏洞和弱点
- 发现Moodle网站的敏感文件和目录
- 检测Moodle网站的插件和主题
- 暴力破解Moodle网站的登录凭据
- 提供详细的扫描报告和结果

#### CMSMap示例

以下是使用CMSMap扫描Moodle网站的示例命令：

```bash
python3 cmsmap.py -t https://example.com/moodle -u admin -p password123
```

这将扫描`https://example.com/moodle`网站，并使用`admin`和`password123`作为登录凭据。

#### 注意事项

在使用CMSMap进行渗透测试时，请确保你已经获得了合法的授权，并且仅在合法的环境中使用。滥用这个工具可能会违反法律规定，并对他人造成损害。
```bash
pip3 install git+https://github.com/dionach/CMSmap.git
cmsmap http://moodle.example.com/<moodle_path>
```
### CVEs

我发现自动化工具在发现影响 Moodle 版本的漏洞方面几乎是**无用的**。你可以在 [https://snyk.io/vuln/composer:moodle%2Fmoodle](https://snyk.io/vuln/composer:moodle%2Fmoodle) 上**检查**它们。

## **RCE**

你需要拥有**管理员**角色，并且你可以在**"站点管理"**选项卡中**安装插件**：

![](<../../.gitbook/assets/image (447).png>)

如果你是管理员，你可能仍然需要**激活此选项**。你可以在 Moodle 特权升级 PoC 中查看如何激活：[https://github.com/HoangKien1020/CVE-2020-14321](https://github.com/HoangKien1020/CVE-2020-14321)。

然后，你可以**安装以下包含经典 pentest-monkey php 反向 shell 的插件**（在上传之前，你需要解压缩它，更改反向 shell 的 IP 和端口，然后再次压缩）：

{% file src="../../.gitbook/assets/moodle-rce-plugin.zip" %}

或者你可以使用来自 [https://github.com/HoangKien1020/Moodle\_RCE](https://github.com/HoangKien1020/Moodle\_RCE) 的插件，以获取带有 "cmd" 参数的常规 PHP shell。

要访问启动恶意插件，你需要访问：
```bash
http://domain.com/<moodle_path>/blocks/rce/lang/en/block_rce.php?cmd=id
```
## POST

### 查找数据库凭据

To find database credentials in a Moodle application, you can use the following steps:

1. Intercept the POST request using a proxy tool like Burp Suite.
2. Analyze the request parameters and look for any parameters related to database connection or credentials.
3. Look for parameters such as `dbhost`, `dbuser`, `dbpass`, `dbname`, or any other parameters that may indicate database credentials.
4. Extract the values of these parameters and note them down for further analysis.

By finding the database credentials, you can gain unauthorized access to the database and potentially extract sensitive information or perform other malicious activities. It is important to note that unauthorized access to databases is illegal and unethical. Always ensure you have proper authorization and follow ethical guidelines when performing any security testing or penetration testing activities.
```bash
find / -name "config.php" 2>/dev/null | grep "moodle/config.php"
```
### 从数据库中转储凭据

To dump credentials from a Moodle database, you can follow these steps:

1. Identify the database credentials: Locate the Moodle configuration file (`config.php`) which contains the database connection details. Look for the variables `$CFG->dbuser` and `$CFG->dbpass` to find the username and password.

2. Connect to the database: Use the obtained credentials to connect to the Moodle database. You can use tools like phpMyAdmin or command-line utilities like `mysql` to establish a connection.

3. Dump the credentials: Once connected to the database, you can execute SQL queries to extract the credentials. The table `mdl_user` usually stores user information, including usernames and hashed passwords. You can use a query like `SELECT username, password FROM mdl_user` to retrieve this information.

4. Decrypt the passwords (if necessary): If the passwords are stored in a hashed format, you may need to decrypt them using techniques like rainbow tables or brute-forcing. Tools like John the Ripper or Hashcat can be used for this purpose.

Remember to always perform these actions within the scope of a legal and authorized penetration testing engagement.
```bash
/usr/local/bin/mysql -u <username> --password=<password> -e "use moodle; select email,username,password from mdl_user; exit"
```
<img src="../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="original">

如果你对**黑客职业**感兴趣并想要攻破不可攻破的东西 - **我们正在招聘！**（需要流利的波兰语书面和口语能力）。

{% embed url="https://www.stmcyber.com/careers" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks 云 ☁️</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>🐦 Twitter 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 Youtube 🎥</strong></a></summary>

* 你在一家**网络安全公司**工作吗？想要在 HackTricks 中**宣传你的公司**吗？或者你想要**获取最新版本的 PEASS 或下载 HackTricks 的 PDF**吗？请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 发现我们的独家[**NFTs**](https://opensea.io/collection/the-peass-family)收藏品 - [**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* 获取[**官方 PEASS & HackTricks 商品**](https://peass.creator-spring.com)
* **加入**[**💬**](https://emojipedia.org/speech-balloon/) [**Discord 群组**](https://discord.gg/hRep4RUj7f) 或 [**Telegram 群组**](https://t.me/peass)，或者在 **Twitter** 上**关注**我 [**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**。**
* **通过向 [hacktricks 仓库](https://github.com/carlospolop/hacktricks) 和 [hacktricks-cloud 仓库](https://github.com/carlospolop/hacktricks-cloud) 提交 PR 来分享你的黑客技巧**。

</details>
