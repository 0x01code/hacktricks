# Moodle

<details>

<summary><strong>Naucz się hakować AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeśli chcesz zobaczyć swoją **firmę reklamowaną w HackTricks** lub **pobrać HackTricks w formacie PDF**, sprawdź [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Zdobądź [**oficjalne gadżety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzinę PEASS**](https://opensea.io/collection/the-peass-family), naszą kolekcję ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Dołącz do** 💬 [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **śledź** nas na **Twitterze** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel się swoimi sztuczkami hakerskimi, przesyłając PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

<img src="../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt="" data-size="original">

Jeśli interesuje Cię **kariera hakerska** i hakowanie niemożliwego - **zatrudniamy!** (_wymagane biegłe posługiwanie się językiem polskim w mowie i piśmie_).

{% embed url="https://www.stmcyber.com/careers" %}

## Automatyczne Skanowanie

### droopescan
```bash
pip3 install droopescan
droopescan scan moodle -u http://moodle.example.com/<moodle_path>/

[+] Plugins found:
forum http://moodle.schooled.htb/moodle/mod/forum/
http://moodle.schooled.htb/moodle/mod/forum/upgrade.txt
http://moodle.schooled.htb/moodle/mod/forum/version.php

[+] No themes found.

[+] Possible version(s):
3.10.0-beta

[+] Possible interesting urls found:
Static readme file. - http://moodle.schooled.htb/moodle/README.txt
Admin panel - http://moodle.schooled.htb/moodle/login/

[+] Scan finished (0:00:05.643539 elapsed)
```
### moodlescan

`moodlescan` is a tool used for scanning and enumerating Moodle instances. It helps in identifying vulnerabilities and misconfigurations in Moodle installations.

#### Usage

```
moodlescan [options] <target>
```

#### Options

- `-p, --port <port>`: Specify the port to connect to (default: 80).
- `-s, --ssl`: Use SSL/TLS for the connection.
- `-u, --username <username>`: Specify the username for authentication.
- `-P, --password <password>`: Specify the password for authentication.
- `-t, --threads <threads>`: Specify the number of threads to use for scanning (default: 10).
- `-o, --output <output>`: Specify the output file to save the results.

#### Examples

Scan a Moodle instance on the default port:

```
moodlescan example.com
```

Scan a Moodle instance on a specific port:

```
moodlescan -p 8080 example.com
```

Scan a Moodle instance using SSL/TLS:

```
moodlescan -s example.com
```

Scan a Moodle instance with authentication:

```
moodlescan -u admin -P password example.com
```

Scan a Moodle instance and save the results to a file:

```
moodlescan -o results.txt example.com
```

#### Note

`moodlescan` is a powerful tool that should only be used for legitimate purposes, such as penetration testing and security assessments. Unauthorized use of this tool is strictly prohibited.
```bash
#Install from https://github.com/inc0d3/moodlescan
python3 moodlescan.py -k -u http://moodle.example.com/<moodle_path>/

Version 0.7 - Dic/2020
.............................................................................................................

By Victor Herrera - supported by www.incode.cl

.............................................................................................................

Getting server information http://moodle.schooled.htb/moodle/ ...

server         	: Apache/2.4.46 (FreeBSD) PHP/7.4.15
x-powered-by   	: PHP/7.4.15
x-frame-options	: sameorigin
last-modified  	: Wed, 07 Apr 2021 21:33:41 GMT

Getting moodle version...

Version found via /admin/tool/lp/tests/behat/course_competencies.feature : Moodle v3.9.0-beta

Searching vulnerabilities...


Vulnerabilities found: 0

Scan completed.
```
### CMSMap

CMSMap to skrypt napisany w języku Python, który służy do skanowania i mapowania systemów zarządzania treścią (CMS). Skrypt ten może pomóc w identyfikacji używanego CMS na stronie internetowej oraz w odkrywaniu potencjalnych podatności.

#### Instalacja

Aby zainstalować CMSMap, wykonaj następujące kroki:

1. Pobierz skrypt z repozytorium GitHub:

   ```
   git clone https://github.com/Dionach/CMSmap.git
   ```

2. Przejdź do katalogu CMSMap:

   ```
   cd CMSmap
   ```

3. Zainstaluj wymagane zależności:

   ```
   pip install -r requirements.txt
   ```

#### Użycie

Po zainstalowaniu CMSMap, możesz go uruchomić, wykonując poniższą komendę:

```
python3 cmsmap.py -t <adres_strony>
```

Gdzie `<adres_strony>` to adres URL strony, którą chcesz zeskanować.

#### Funkcje

CMSMap oferuje wiele funkcji, które mogą być przydatne podczas testowania penetracyjnego stron internetowych opartych na CMS. Niektóre z tych funkcji to:

- Skanowanie strony w poszukiwaniu używanego CMS.
- Wykrywanie wersji CMS oraz zainstalowanych wtyczek i motywów.
- Wyszukiwanie podatności w CMS.
- Wykonywanie ataków słownikowych na panel logowania CMS.
- Wykonywanie ataków wstrzykiwania SQL.
- Wykonywanie ataków wstrzykiwania XSS.
- Wykonywanie ataków wstrzykiwania kodu PHP.

#### Podsumowanie

CMSMap to przydatne narzędzie do skanowania i mapowania systemów zarządzania treścią. Może pomóc w identyfikacji używanego CMS na stronie internetowej oraz w odkrywaniu potencjalnych podatności.
```bash
pip3 install git+https://github.com/dionach/CMSmap.git
cmsmap http://moodle.example.com/<moodle_path>
```
### CVEs

Zauważyłem, że automatyczne narzędzia są dość **bezużyteczne w znajdowaniu podatności dotyczących wersji moodle**. Możesz **sprawdzić** je tutaj: [**https://snyk.io/vuln/composer:moodle%2Fmoodle**](https://snyk.io/vuln/composer:moodle%2Fmoodle)

## **RCE**

Musisz mieć rolę **managera** i **możesz instalować wtyczki** w zakładce **"Administracja witryny"**\*\*:\*\*

![](<../../.gitbook/assets/image (447).png>)

Jeśli jesteś managerem, możesz nadal potrzebować **aktywować tę opcję**. Możesz zobaczyć, jak to zrobić w dowodzie koncepcyjnym eskalacji uprawnień moodle: [https://github.com/HoangKien1020/CVE-2020-14321](https://github.com/HoangKien1020/CVE-2020-14321).

Następnie możesz **zainstalować następującą wtyczkę**, która zawiera klasyczną powłokę php r**ev shell** (_przed jej przesłaniem musisz ją rozpakować, zmienić IP i port revshell i ponownie spakować_)

{% file src="../../.gitbook/assets/moodle-rce-plugin.zip" %}

Możesz również użyć wtyczki z [https://github.com/HoangKien1020/Moodle\_RCE](https://github.com/HoangKien1020/Moodle\_RCE), aby uzyskać zwykłą powłokę PHP z parametrem "cmd".

Aby uruchomić złośliwą wtyczkę, musisz uzyskać dostęp do:
```bash
http://domain.com/<moodle_path>/blocks/rce/lang/en/block_rce.php?cmd=id
```
### Znajdź dane uwierzytelniające bazy danych

Aby znaleźć dane uwierzytelniające bazy danych w aplikacji Moodle, możesz wykorzystać technikę POST. Ta technika polega na wysyłaniu żądań POST do różnych ścieżek aplikacji w celu znalezienia potencjalnych wycieków danych.

#### Krok 1: Przechwycenie żądania POST

Najpierw musisz przechwycić żądanie POST, które jest wysyłane podczas logowania do aplikacji Moodle. Możesz to zrobić za pomocą narzędzia do przechwytywania ruchu sieciowego, takiego jak Wireshark lub Burp Suite.

#### Krok 2: Analiza żądania POST

Po przechwyceniu żądania POST, musisz przeanalizować jego zawartość w celu znalezienia potencjalnych danych uwierzytelniających bazy danych. Skup się na parametrach, które mogą zawierać takie informacje, takich jak "username", "password" lub "db".

#### Krok 3: Testowanie danych uwierzytelniających

Po znalezieniu potencjalnych danych uwierzytelniających, możesz przetestować je, próbując się zalogować do bazy danych. Możesz to zrobić za pomocą narzędzi takich jak phpMyAdmin lub narzędzia wiersza poleceń, takie jak MySQL.

#### Krok 4: Wykorzystanie danych uwierzytelniających

Jeśli dane uwierzytelniające są poprawne, możesz wykorzystać je do uzyskania dostępu do bazy danych Moodle. Możesz przeglądać, modyfikować lub usuwać dane w bazie danych, w zależności od uprawnień użytkownika.

Pamiętaj, że przeprowadzanie testów penetracyjnych bez zgody właściciela systemu jest nielegalne. Wykonuj te techniki tylko na systemach, do których masz uprawnienia i zgody.
```bash
find / -name "config.php" 2>/dev/null | grep "moodle/config.php"
```
### Wydobądź dane uwierzytelniające z bazy danych

To dump credentials from a Moodle database, you can follow these steps:

1. Identify the database credentials: Locate the Moodle configuration file (`config.php`) which contains the database connection details. Look for the variables `$CFG->dbuser` and `$CFG->dbpass` to find the username and password.

2. Connect to the database: Use the obtained credentials to connect to the Moodle database. You can use tools like phpMyAdmin or the command-line interface (CLI) to establish a connection.

3. Dump the user credentials: Once connected to the database, you can execute SQL queries to extract the user credentials. The relevant tables are usually `mdl_user` and `mdl_user_password_history`. Retrieve the necessary fields such as usernames and hashed passwords.

4. Decrypt the passwords (if necessary): If the passwords are stored in a hashed format, you may need to use techniques like rainbow tables or brute-force attacks to crack them. Tools like John the Ripper or Hashcat can assist in this process.

By following these steps, you can successfully dump credentials from a Moodle database during a penetration test. Remember to always obtain proper authorization before performing any hacking activities.
```bash
/usr/local/bin/mysql -u <username> --password=<password> -e "use moodle; select email,username,password from mdl_user; exit"
```
<img src="../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt="" data-size="original">

Jeśli interesuje Cię **kariera hakera** i hakowanie nie do przebicia - **zatrudniamy!** (_wymagane biegłe posługiwanie się językiem polskim_).

{% embed url="https://www.stmcyber.com/careers" %}

<details>

<summary><strong>Naucz się hakować AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeśli chcesz zobaczyć swoją **firmę reklamowaną w HackTricks** lub **pobrać HackTricks w formacie PDF**, sprawdź [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Zdobądź [**oficjalne gadżety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzinę PEASS**](https://opensea.io/collection/the-peass-family), naszą kolekcję ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Dołącz do** 💬 [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **śledź** nas na **Twitterze** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel się swoimi sztuczkami hakerskimi, przesyłając PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) **i** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **repozytoriów GitHub**.

</details>
