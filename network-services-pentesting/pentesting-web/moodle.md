# Moodle

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks Cloud ☁️</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>🐦 Twitter 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 Youtube 🎥</strong></a></summary>

* 你在**网络安全公司**工作吗？想要在HackTricks中**宣传你的公司**吗？或者你想要**获取PEASS的最新版本或下载HackTricks的PDF**吗？请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 发现我们的独家[**NFTs**](https://opensea.io/collection/the-peass-family)收藏品- [**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* 获取[**官方PEASS和HackTricks周边产品**](https://peass.creator-spring.com)
* **加入**[**💬**](https://emojipedia.org/speech-balloon/) [**Discord群组**](https://discord.gg/hRep4RUj7f) 或者 [**telegram群组**](https://t.me/peass) 或者 **关注**我在**Twitter**上的[**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **通过向**[**hacktricks repo**](https://github.com/carlospolop/hacktricks) **和**[**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **提交PR来分享你的黑客技巧。**

</details>

<img src="../../.gitbook/assets/image (1) (1) (1) (1) (1).png" alt="" data-size="original">

如果你对**黑客职业**感兴趣并且想要攻破不可攻破的目标- **我们正在招聘！**（需要流利的波兰语书写和口语能力）。

{% embed url="https://www.stmcyber.com/careers" %}

## 自动扫描

### droopescan
```bash
pip3 install droopescan
droopescan scan moodle -u http://moodle.example.com/<moodle_path>/

[+] Plugins found:
forum http://moodle.schooled.htb/moodle/mod/forum/
http://moodle.schooled.htb/moodle/mod/forum/upgrade.txt
http://moodle.schooled.htb/moodle/mod/forum/version.php

[+] No themes found.

[+] Possible version(s):
3.10.0-beta

[+] Possible interesting urls found:
Static readme file. - http://moodle.schooled.htb/moodle/README.txt
Admin panel - http://moodle.schooled.htb/moodle/login/

[+] Scan finished (0:00:05.643539 elapsed)
```
### moodlescan

moodlescan is a command-line tool used for scanning and identifying vulnerabilities in Moodle installations. It is specifically designed for penetration testers and security professionals to assess the security of Moodle-based e-learning platforms.

#### Installation

To install moodlescan, follow these steps:

1. Clone the moodlescan repository from GitHub:

   ```
   git clone https://github.com/edduarte/moodlescan.git
   ```

2. Change into the moodlescan directory:

   ```
   cd moodlescan
   ```

3. Install the required dependencies using pip:

   ```
   pip install -r requirements.txt
   ```

#### Usage

To use moodlescan, run the following command:

```
python moodlescan.py [options] <target>
```

Replace `<target>` with the URL of the Moodle installation you want to scan.

#### Options

moodlescan supports the following options:

- `-h, --help`: Display the help message and exit.
- `-v, --version`: Display the version number and exit.
- `-u, --username <username>`: Specify the username to use for authentication.
- `-p, --password <password>`: Specify the password to use for authentication.
- `-c, --cookie <cookie>`: Specify the cookie to use for authentication.
- `-o, --output <output_file>`: Specify the output file to save the scan results.
- `-s, --ssl`: Use SSL/TLS for the connection.
- `-r, --redirects`: Follow redirects.
- `-t, --timeout <timeout>`: Specify the timeout value for requests (in seconds).

#### Example

Here is an example command to scan a Moodle installation:

```
python moodlescan.py -u admin -p password https://example.com/moodle
```

This will scan the Moodle installation at `https://example.com/moodle` using the specified username and password for authentication. The scan results will be displayed on the console.

#### Conclusion

moodlescan is a powerful tool for identifying vulnerabilities in Moodle installations. By using this tool, penetration testers and security professionals can assess the security of Moodle-based e-learning platforms and take appropriate measures to mitigate any identified risks.
```bash
#Install from https://github.com/inc0d3/moodlescan
python3 moodlescan.py -k -u http://moodle.example.com/<moodle_path>/

Version 0.7 - Dic/2020
.............................................................................................................

By Victor Herrera - supported by www.incode.cl

.............................................................................................................

Getting server information http://moodle.schooled.htb/moodle/ ...

server         	: Apache/2.4.46 (FreeBSD) PHP/7.4.15
x-powered-by   	: PHP/7.4.15
x-frame-options	: sameorigin
last-modified  	: Wed, 07 Apr 2021 21:33:41 GMT

Getting moodle version...

Version found via /admin/tool/lp/tests/behat/course_competencies.feature : Moodle v3.9.0-beta

Searching vulnerabilities...


Vulnerabilities found: 0

Scan completed.
```
### CMSMap

CMSMap是一款用于扫描和识别Moodle网站的工具。Moodle是一种广泛使用的开源学习管理系统，用于创建在线课程和虚拟学习环境。CMSMap可以帮助渗透测试人员发现Moodle网站上的漏洞和弱点。

使用CMSMap，您可以执行以下操作：

- **信息收集**：CMSMap可以收集有关目标Moodle网站的信息，包括版本号、插件和主题。
- **漏洞扫描**：CMSMap可以扫描Moodle网站以查找已知的漏洞和安全问题。
- **弱点利用**：CMSMap可以利用已知的漏洞和弱点来获取对Moodle网站的未授权访问或执行其他恶意操作。
- **密码破解**：CMSMap可以尝试使用常见的用户名和密码组合对Moodle网站进行暴力破解。

要使用CMSMap，您需要提供目标Moodle网站的URL。然后，CMSMap将自动执行各种扫描和利用技术，以帮助您发现潜在的安全问题。

请注意，使用CMSMap进行Moodle网站的渗透测试需要合法的授权和许可。未经授权的访问和攻击是违法行为，可能会导致严重的法律后果。
```bash
pip3 install git+https://github.com/dionach/CMSmap.git
cmsmap http://moodle.example.com/<moodle_path>
```
### CVEs

我发现自动工具在发现影响 Moodle 版本的漏洞方面相当无用。你可以在 [https://snyk.io/vuln/composer:moodle%2Fmoodle](https://snyk.io/vuln/composer:moodle%2Fmoodle) 上检查它们。

## RCE

你需要拥有管理员角色，并且可以在“站点管理”选项卡中安装插件：

![](<../../.gitbook/assets/image (447).png>)

即使你是管理员，你可能仍然需要激活此选项。你可以在 Moodle 特权升级 PoC 中查看如何激活：[https://github.com/HoangKien1020/CVE-2020-14321](https://github.com/HoangKien1020/CVE-2020-14321)。

然后，你可以安装以下包含经典 pentest-monkey php 反向 shell 的插件（在上传之前，你需要解压缩它，更改反向 shell 的 IP 和端口，然后再次压缩）：

{% file src="../../.gitbook/assets/moodle-rce-plugin.zip" %}

或者你可以使用来自 [https://github.com/HoangKien1020/Moodle\_RCE](https://github.com/HoangKien1020/Moodle\_RCE) 的插件，以获取带有 "cmd" 参数的常规 PHP shell。

要访问启动恶意插件，你需要访问：
```bash
http://domain.com/<moodle_path>/blocks/rce/lang/en/block_rce.php?cmd=id
```
## POST

### 查找数据库凭据

在进行网络服务渗透测试时，查找数据库凭据是一项重要的任务。数据库凭据通常存储在配置文件或环境变量中，用于连接和访问数据库。通过获取这些凭据，黑客可以进一步访问和操纵数据库中的敏感数据。

以下是一些常见的方法来查找数据库凭据：

1. **配置文件**：许多Web应用程序使用配置文件来存储敏感信息，包括数据库凭据。通过查找应用程序的配置文件，可以找到数据库的用户名和密码。

2. **环境变量**：有些应用程序使用环境变量来存储敏感信息，包括数据库凭据。通过检查应用程序的环境变量，可以找到数据库的凭据信息。

3. **源代码**：有时，数据库凭据可能直接硬编码在应用程序的源代码中。通过检查应用程序的源代码，可以找到数据库的用户名和密码。

4. **错误信息**：有时，应用程序可能会在错误消息中泄露数据库凭据。通过检查应用程序的错误消息，可以找到数据库的凭据信息。

在查找数据库凭据时，黑客需要仔细分析应用程序的不同组件，包括配置文件、环境变量、源代码和错误消息。通过使用这些方法，黑客可以成功地获取数据库的凭据，从而进一步渗透和操纵目标系统中的敏感数据。
```bash
find / -name "config.php" 2>/dev/null | grep "moodle/config.php"
```
### 从数据库中获取凭据

To dump credentials from a database, you can follow these steps:

1. Identify the target database: Determine the type of database being used by the web application. Common databases include MySQL, PostgreSQL, Oracle, and Microsoft SQL Server.

2. Enumerate database users: Use techniques such as SQL injection or brute-forcing to identify the database users. This can be done by exploiting vulnerabilities in the web application or by using default or weak credentials.

3. Extract credentials: Once you have identified the database users, you can extract their credentials from the database. This can be done by querying the database tables that store user information, such as the "users" table.

4. Decrypt or crack passwords: If the passwords are stored in a hashed or encrypted format, you may need to decrypt or crack them to obtain the plaintext passwords. This can be done using techniques such as password cracking or rainbow table attacks.

5. Use the credentials: Once you have obtained the credentials, you can use them to gain unauthorized access to the web application or other systems that use the same credentials.

It is important to note that dumping credentials from a database without proper authorization is illegal and unethical. These techniques should only be used for legitimate purposes, such as penetration testing or securing your own systems. Always ensure that you have the necessary permissions and legal authorization before attempting any database credential extraction.
```bash
/usr/local/bin/mysql -u <username> --password=<password> -e "use moodle; select email,username,password from mdl_user; exit"
```
<img src="../../.gitbook/assets/image (1) (1) (1) (1) (1).png" alt="" data-size="original">

如果你对**黑客职业**感兴趣并想要攻破不可攻破的东西 - **我们正在招聘！**（需要流利的波兰语书写和口语能力）。

{% embed url="https://www.stmcyber.com/careers" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks Cloud ☁️</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>🐦 Twitter 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 Youtube 🎥</strong></a></summary>

* 你在一家**网络安全公司**工作吗？你想在HackTricks中看到你的**公司广告**吗？或者你想要**获取PEASS的最新版本或下载PDF格式的HackTricks**吗？请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 发现我们的独家[**NFTs**](https://opensea.io/collection/the-peass-family)收藏品 - [**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* 获得[**官方PEASS和HackTricks周边产品**](https://peass.creator-spring.com)
* **加入**[**💬**](https://emojipedia.org/speech-balloon/) [**Discord群组**](https://discord.gg/hRep4RUj7f) 或 [**Telegram群组**](https://t.me/peass)，或者在**Twitter**上**关注**我[**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**。**
* **通过向**[**hacktricks repo**](https://github.com/carlospolop/hacktricks) **和**[**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **提交PR来分享你的黑客技巧。**

</details>
