# Moodle

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* ¬øTrabajas en una **empresa de ciberseguridad**? ¬øQuieres ver tu **empresa anunciada en HackTricks**? ¬øO quieres tener acceso a la **√∫ltima versi√≥n de PEASS o descargar HackTricks en PDF**? ¬°Consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obt√©n el [**swag oficial de PEASS y HackTricks**](https://peass.creator-spring.com)
* **√önete al** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de Telegram**](https://t.me/peass) o **s√≠gueme** en **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Comparte tus trucos de hacking enviando PRs al** [**repositorio de hacktricks**](https://github.com/carlospolop/hacktricks) **y al** [**repositorio de hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

<img src="../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1).png" alt="" data-size="original">

Si est√°s interesado en una **carrera de hacking** y hackear lo imposible - ¬°**estamos contratando**! (_se requiere fluidez en polaco escrito y hablado_).

{% embed url="https://www.stmcyber.com/careers" %}

## Escaneos autom√°ticos

### droopescan
```bash
pip3 install droopescan
droopescan scan moodle -u http://moodle.example.com/<moodle_path>/

[+] Plugins found:
forum http://moodle.schooled.htb/moodle/mod/forum/
http://moodle.schooled.htb/moodle/mod/forum/upgrade.txt
http://moodle.schooled.htb/moodle/mod/forum/version.php

[+] No themes found.

[+] Possible version(s):
3.10.0-beta

[+] Possible interesting urls found:
Static readme file. - http://moodle.schooled.htb/moodle/README.txt
Admin panel - http://moodle.schooled.htb/moodle/login/

[+] Scan finished (0:00:05.643539 elapsed)
```
El comando `moodlescan` es una herramienta de escaneo de seguridad dise√±ada espec√≠ficamente para Moodle, una plataforma de aprendizaje en l√≠nea. Esta herramienta se utiliza para identificar posibles vulnerabilidades en una instalaci√≥n de Moodle y proporciona informaci√≥n detallada sobre los riesgos de seguridad.

El comando `moodlescan` realiza una serie de pruebas automatizadas en la instancia de Moodle, incluyendo la verificaci√≥n de la configuraci√≥n del servidor, la detecci√≥n de versiones obsoletas de software, la b√∫squeda de archivos y directorios sensibles, y la identificaci√≥n de posibles problemas de seguridad en los plugins instalados.

Para utilizar `moodlescan`, simplemente ejecuta el comando seguido de la URL de la instancia de Moodle que deseas escanear. Por ejemplo:

```
moodlescan https://example.com/moodle
```

Una vez que el escaneo est√© completo, `moodlescan` generar√° un informe detallado que incluye una lista de las vulnerabilidades encontradas y recomendaciones para solucionarlas. Este informe puede ser utilizado por los administradores de Moodle para fortalecer la seguridad de su instalaci√≥n y proteger la informaci√≥n confidencial de los usuarios.

Es importante tener en cuenta que `moodlescan` es una herramienta de escaneo automatizada y no reemplaza una evaluaci√≥n de seguridad completa realizada por un profesional de seguridad. Sin embargo, puede ser una herramienta √∫til para identificar r√°pidamente posibles problemas de seguridad en una instalaci√≥n de Moodle.
```bash
#Install from https://github.com/inc0d3/moodlescan
python3 moodlescan.py -k -u http://moodle.example.com/<moodle_path>/

Version 0.7 - Dic/2020
.............................................................................................................

By Victor Herrera - supported by www.incode.cl

.............................................................................................................

Getting server information http://moodle.schooled.htb/moodle/ ...

server         	: Apache/2.4.46 (FreeBSD) PHP/7.4.15
x-powered-by   	: PHP/7.4.15
x-frame-options	: sameorigin
last-modified  	: Wed, 07 Apr 2021 21:33:41 GMT

Getting moodle version...

Version found via /admin/tool/lp/tests/behat/course_competencies.feature : Moodle v3.9.0-beta

Searching vulnerabilities...


Vulnerabilities found: 0

Scan completed.
```
### CMSMap

CMSMap es una herramienta de c√≥digo abierto que se utiliza para escanear y enumerar los sistemas de gesti√≥n de contenido (CMS) en un sitio web. Esta herramienta es √∫til durante las pruebas de penetraci√≥n para identificar el CMS utilizado por un sitio web y obtener informaci√≥n sobre las vulnerabilidades conocidas asociadas con ese CMS en particular.

#### Caracter√≠sticas principales

- Escaneo de CMS: CMSMap puede escanear un sitio web en busca de CMS populares como WordPress, Joomla, Drupal, Magento, etc. Esto ayuda a los pentesters a identificar r√°pidamente el CMS utilizado por el sitio web objetivo.

- Enumeraci√≥n de usuarios: CMSMap puede enumerar los usuarios registrados en un sitio web basado en CMS. Esto puede ser √∫til para identificar posibles cuentas de administrador o usuarios con privilegios especiales.

- Enumeraci√≥n de plugins y temas: CMSMap puede enumerar los plugins y temas instalados en un sitio web basado en CMS. Esto proporciona informaci√≥n adicional sobre las funcionalidades y configuraciones del sitio web.

- Escaneo de vulnerabilidades conocidas: CMSMap puede buscar vulnerabilidades conocidas asociadas con el CMS identificado. Esto ayuda a los pentesters a identificar posibles puntos d√©biles en el sitio web objetivo.

#### Uso b√°sico

El uso b√°sico de CMSMap implica proporcionar la URL del sitio web objetivo y ejecutar el comando correspondiente. Por ejemplo, para escanear un sitio web en busca de CMS, se puede utilizar el siguiente comando:

```
cmsmap.py -u <URL>
```

Para enumerar usuarios registrados en un sitio web basado en CMS, se puede utilizar el siguiente comando:

```
cmsmap.py -u <URL> --users
```

Para enumerar plugins y temas instalados en un sitio web basado en CMS, se puede utilizar el siguiente comando:

```
cmsmap.py -u <URL> --plugins-themes
```

Para escanear vulnerabilidades conocidas asociadas con el CMS identificado, se puede utilizar el siguiente comando:

```
cmsmap.py -u <URL> --vulnerabilities
```

Es importante tener en cuenta que CMSMap es una herramienta de prueba de penetraci√≥n y solo debe utilizarse con fines legales y √©ticos.
```bash
pip3 install git+https://github.com/dionach/CMSmap.git
cmsmap http://moodle.example.com/<moodle_path>
```
### CVEs

Encontr√© que las herramientas autom√°ticas son bastante **in√∫tiles para encontrar vulnerabilidades que afecten a la versi√≥n de Moodle**. Puedes **verificar** esto en [**https://snyk.io/vuln/composer:moodle%2Fmoodle**](https://snyk.io/vuln/composer:moodle%2Fmoodle)

## **RCE**

Necesitas tener el rol de **gerente** y **puedes instalar complementos** dentro de la pesta√±a de **"Administraci√≥n del sitio"**:

![](<../../.gitbook/assets/image (447).png>)

Si eres gerente, es posible que a√∫n necesites **activar esta opci√≥n**. Puedes ver c√≥mo hacerlo en la prueba de concepto de escalada de privilegios de Moodle: [https://github.com/HoangKien1020/CVE-2020-14321](https://github.com/HoangKien1020/CVE-2020-14321).

Luego, puedes **instalar el siguiente complemento** que contiene el cl√°sico shell reverso en PHP de pentest-monkey (_antes de subirlo, debes descomprimirlo, cambiar la IP y el puerto del revshell y comprimirlo nuevamente_)

{% file src="../../.gitbook/assets/moodle-rce-plugin.zip" %}

O puedes usar el complemento de [https://github.com/HoangKien1020/Moodle\_RCE](https://github.com/HoangKien1020/Moodle\_RCE) para obtener un shell PHP regular con el par√°metro "cmd".

Para acceder y lanzar el complemento malicioso, debes acceder a:
```bash
http://domain.com/<moodle_path>/blocks/rce/lang/en/block_rce.php?cmd=id
```
## POST

### Encontrar credenciales de la base de datos
```bash
find / -name "config.php" 2>/dev/null | grep "moodle/config.php"
```
### Volcar credenciales de la base de datos

Para realizar una prueba de penetraci√≥n en un sitio web Moodle, es posible que desees extraer las credenciales de la base de datos. Esto te permitir√° obtener informaci√≥n de inicio de sesi√≥n de los usuarios y potencialmente acceder a sus cuentas.

Aqu√≠ hay algunos pasos que puedes seguir para volcar las credenciales de la base de datos:

1. **Enumeraci√≥n de la base de datos**: Utiliza t√©cnicas de enumeraci√≥n para identificar el tipo de base de datos utilizada por Moodle. Esto te ayudar√° a seleccionar las herramientas y comandos adecuados para extraer las credenciales.

2. **Escaneo de puertos**: Realiza un escaneo de puertos para identificar los servicios y puertos abiertos en el servidor Moodle. Esto te ayudar√° a determinar si hay alg√∫n servicio de base de datos en ejecuci√≥n.

3. **Identificaci√≥n de credenciales de conexi√≥n**: Busca en los archivos de configuraci√≥n de Moodle o en otros archivos relevantes las credenciales de conexi√≥n a la base de datos. Estos archivos pueden contener informaci√≥n como el nombre de usuario y la contrase√±a utilizados para acceder a la base de datos.

4. **Extracci√≥n de credenciales**: Utiliza herramientas como `sqlmap` o `mysqldump` para extraer las credenciales de la base de datos. Estas herramientas te permitir√°n obtener informaci√≥n de inicio de sesi√≥n almacenada en la base de datos de Moodle.

Es importante tener en cuenta que realizar pruebas de penetraci√≥n sin el consentimiento expl√≠cito del propietario del sitio web es ilegal. Aseg√∫rate de obtener el permiso adecuado antes de realizar cualquier prueba de penetraci√≥n.
```bash
/usr/local/bin/mysql -u <username> --password=<password> -e "use moodle; select email,username,password from mdl_user; exit"
```
<img src="../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1).png" alt="" data-size="original">

Si est√°s interesado en una **carrera de hacking** y hackear lo inhackeable - **¬°estamos contratando!** (_se requiere fluidez en polaco escrito y hablado_).

{% embed url="https://www.stmcyber.com/careers" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* ¬øTrabajas en una **empresa de ciberseguridad**? ¬øQuieres ver tu **empresa anunciada en HackTricks**? ¬øO quieres tener acceso a la **√∫ltima versi√≥n de PEASS o descargar HackTricks en PDF**? ¬°Consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obt√©n el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* **√önete al** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de Telegram**](https://t.me/peass) o **s√≠gueme** en **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Comparte tus trucos de hacking enviando PRs al** [**repositorio de hacktricks**](https://github.com/carlospolop/hacktricks) **y al** [**repositorio de hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
