# Moodle

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Travaillez-vous dans une entreprise de **cybers√©curit√©** ? Voulez-vous voir votre **entreprise annonc√©e dans HackTricks** ? ou voulez-vous avoir acc√®s √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**üí¨**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR au [d√©p√¥t hacktricks](https://github.com/carlospolop/hacktricks) et au [d√©p√¥t hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>

<img src="../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="original">

Si vous √™tes int√©ress√© par une **carri√®re de piratage** et que vous voulez pirater l'impossible - **nous recrutons !** (_polonais courant √©crit et parl√© requis_).

{% embed url="https://www.stmcyber.com/careers" %}

## Scans automatiques

### droopescan
```bash
pip3 install droopescan
droopescan scan moodle -u http://moodle.example.com/<moodle_path>/

[+] Plugins found:                                                              
    forum http://moodle.schooled.htb/moodle/mod/forum/
        http://moodle.schooled.htb/moodle/mod/forum/upgrade.txt
        http://moodle.schooled.htb/moodle/mod/forum/version.php

[+] No themes found.

[+] Possible version(s):
    3.10.0-beta

[+] Possible interesting urls found:
    Static readme file. - http://moodle.schooled.htb/moodle/README.txt
    Admin panel - http://moodle.schooled.htb/moodle/login/

[+] Scan finished (0:00:05.643539 elapsed)
```
### moodlescan

moodlescan est un outil de reconnaissance pour Moodle. Il peut √™tre utilis√© pour identifier les versions de Moodle, les plugins install√©s et les utilisateurs. Il peut √©galement √™tre utilis√© pour trouver des vuln√©rabilit√©s connues dans les versions de Moodle et les plugins install√©s.

Pour utiliser moodlescan, il suffit de sp√©cifier l'URL de la page d'accueil de Moodle. moodlescan effectuera ensuite une s√©rie de requ√™tes pour identifier les informations pertinentes. Les r√©sultats seront affich√©s dans la console.

Voici un exemple d'utilisation de moodlescan:

```
python3 moodlescan.py -u https://example.com/moodle
```

Cela affichera les informations suivantes:

```
Moodle version: 3.9.2
Installed plugins:
- mod_forum
- mod_assign
- local_statistics
- theme_boost
```

moodlescan peut √©galement √™tre utilis√© pour trouver des utilisateurs de Moodle. Pour ce faire, il suffit d'utiliser l'option `-f` et de sp√©cifier un fichier contenant une liste de noms d'utilisateurs. moodlescan effectuera ensuite une s√©rie de requ√™tes pour d√©terminer si les utilisateurs sont pr√©sents sur le site Moodle sp√©cifi√©.

Voici un exemple d'utilisation de moodlescan pour trouver des utilisateurs:

```
python3 moodlescan.py -u https://example.com/moodle -f users.txt
```

Cela affichera les informations suivantes:

```
User found: alice
User found: bob
User not found: charlie
```
```bash
#Install from https://github.com/inc0d3/moodlescan
python3 moodlescan.py -k -u http://moodle.example.com/<moodle_path>/

Version 0.7 - Dic/2020
.............................................................................................................

By Victor Herrera - supported by www.incode.cl
	
.............................................................................................................

Getting server information http://moodle.schooled.htb/moodle/ ...

server         	: Apache/2.4.46 (FreeBSD) PHP/7.4.15
x-powered-by   	: PHP/7.4.15
x-frame-options	: sameorigin
last-modified  	: Wed, 07 Apr 2021 21:33:41 GMT

Getting moodle version...

Version found via /admin/tool/lp/tests/behat/course_competencies.feature : Moodle v3.9.0-beta

Searching vulnerabilities...


Vulnerabilities found: 0

Scan completed.
```
### CMSMap

CMSMap est un outil open source qui permet de scanner les sites web pour d√©tecter les CMS (syst√®mes de gestion de contenu) utilis√©s. Il peut √©galement √™tre utilis√© pour trouver des vuln√©rabilit√©s connues dans ces CMS. CMSMap prend en charge de nombreux CMS populaires tels que WordPress, Joomla, Drupal, Magento, et bien d'autres. Il peut √©galement √™tre utilis√© pour trouver des plugins vuln√©rables et des th√®mes utilis√©s sur le site. CMSMap est un outil utile pour les tests de p√©n√©tration et les audits de s√©curit√© des sites web.
```bash
pip3 install git+https://github.com/dionach/CMSmap.git
cmsmap http://moodle.example.com/<moodle_path>
```
### CVEs

J'ai constat√© que les outils automatiques sont assez **inutiles pour trouver des vuln√©rabilit√©s affectant la version moodle**. Vous pouvez les **v√©rifier** sur [**https://snyk.io/vuln/composer:moodle%2Fmoodle**](https://snyk.io/vuln/composer:moodle%2Fmoodle)

## **RCE**

Vous devez avoir le r√¥le de **manager** et vous **pouvez installer des plugins** dans l'onglet **"Administration du site"**\*\*:\*\*

![](<../../.gitbook/assets/image (447).png>)

Si vous √™tes un manager, vous devrez peut-√™tre **activer cette option**. Vous pouvez voir comment faire dans la preuve de concept d'escalade de privil√®ges moodle: [https://github.com/HoangKien1020/CVE-2020-14321](https://github.com/HoangKien1020/CVE-2020-14321).

Ensuite, vous pouvez **installer le plugin suivant** qui contient le shell php r**ev classique de pentest-monkey** (_avant de le t√©l√©charger, vous devez le d√©compresser, changer l'IP et le port du revshell et le recompresser_)

{% file src="../../.gitbook/assets/moodle-rce-plugin.zip" %}

Ou vous pouvez utiliser le plugin de [https://github.com/HoangKien1020/Moodle\_RCE](https://github.com/HoangKien1020/Moodle\_RCE) pour obtenir un shell PHP r√©gulier avec le param√®tre "cmd".

Pour acc√©der au lancement du plugin malveillant, vous devez acc√©der √†:
```bash
http://domain.com/<moodle_path>/blocks/rce/lang/en/block_rce.php?cmd=id
```
## POST

### Trouver les identifiants de la base de donn√©es
```bash
find / -name "config.php" 2>/dev/null | grep "moodle/config.php"
```
### Extraire les identifiants de la base de donn√©es

---

#### Description

Dans certains cas, il est possible d'extraire les identifiants de la base de donn√©es de Moodle en utilisant des vuln√©rabilit√©s ou des erreurs de configuration.

#### Proc√©dure

1. Tout d'abord, il est n√©cessaire de trouver les informations de connexion √† la base de donn√©es. Cela peut √™tre fait en examinant le fichier `config.php` situ√© dans le r√©pertoire racine de Moodle.

2. Une fois que vous avez les informations de connexion, vous pouvez utiliser des outils tels que `mysql` ou `phpMyAdmin` pour acc√©der √† la base de donn√©es.

3. Recherchez la table `mdl_user` qui contient les informations d'identification des utilisateurs.

4. Si les mots de passe sont stock√©s en clair, vous pouvez simplement les extraire. Sinon, vous devrez utiliser des techniques de craquage de mot de passe pour les r√©cup√©rer.

#### Contre-mesures

- Assurez-vous que les informations de connexion √† la base de donn√©es sont correctement s√©curis√©es et ne sont pas accessibles publiquement.
- Utilisez des algorithmes de hachage forts pour stocker les mots de passe des utilisateurs.
- Restreignez l'acc√®s √† la base de donn√©es uniquement aux utilisateurs autoris√©s.
```bash
/usr/local/bin/mysql -u <username> --password=<password> -e "use moodle; select email,username,password from mdl_user; exit"
```
<img src="../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="original">

Si vous √™tes int√©ress√© par une **carri√®re de hacker** et souhaitez hacker l'imp√©n√©trable - **nous recrutons !** (_ma√Ætrise du polonais √† l'√©crit et √† l'oral requise_).

{% embed url="https://www.stmcyber.com/careers" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Travaillez-vous dans une **entreprise de cybers√©curit√©** ? Voulez-vous voir votre **entreprise annonc√©e dans HackTricks** ? ou voulez-vous avoir acc√®s √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**üí¨**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR au [d√©p√¥t hacktricks](https://github.com/carlospolop/hacktricks) et au [d√©p√¥t hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>
