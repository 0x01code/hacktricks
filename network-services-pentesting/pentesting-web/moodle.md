# Moodle

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Voc√™ trabalha em uma **empresa de seguran√ßa cibern√©tica**? Voc√™ quer ver sua **empresa anunciada no HackTricks**? ou voc√™ quer ter acesso √† **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**? Verifique os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* **Junte-se ao** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para o** [**reposit√≥rio hacktricks**](https://github.com/carlospolop/hacktricks) **e** [**reposit√≥rio hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

<img src="../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt="" data-size="original">

Se voc√™ est√° interessado em uma **carreira de hacking** e hackear o inquebr√°vel - **estamos contratando!** (_flu√™ncia em polon√™s escrita e falada √© necess√°ria_).

{% embed url="https://www.stmcyber.com/careers" %}

## Scans Autom√°ticos

### droopescan
```bash
pip3 install droopescan
droopescan scan moodle -u http://moodle.example.com/<moodle_path>/

[+] Plugins found:
forum http://moodle.schooled.htb/moodle/mod/forum/
http://moodle.schooled.htb/moodle/mod/forum/upgrade.txt
http://moodle.schooled.htb/moodle/mod/forum/version.php

[+] No themes found.

[+] Possible version(s):
3.10.0-beta

[+] Possible interesting urls found:
Static readme file. - http://moodle.schooled.htb/moodle/README.txt
Admin panel - http://moodle.schooled.htb/moodle/login/

[+] Scan finished (0:00:05.643539 elapsed)
```
O comando `moodlescan` √© uma ferramenta de linha de comando usada para realizar a varredura de vulnerabilidades em instala√ß√µes do Moodle. Essa ferramenta √© especialmente √∫til durante testes de penetra√ß√£o em ambientes Moodle, permitindo identificar poss√≠veis falhas de seguran√ßa que podem ser exploradas por hackers.

O `moodlescan` √© capaz de verificar v√°rias vulnerabilidades conhecidas no Moodle, incluindo problemas de configura√ß√£o, falhas de autentica√ß√£o, inje√ß√£o de SQL, cross-site scripting (XSS) e muito mais. Ele tamb√©m pode ser usado para verificar a vers√£o do Moodle instalada e fornecer informa√ß√µes detalhadas sobre a configura√ß√£o do sistema.

Para usar o `moodlescan`, basta executar o comando seguido pelo URL da instala√ß√£o do Moodle que deseja verificar. Por exemplo:

```
moodlescan https://example.com/moodle
```

O `moodlescan` ir√° ent√£o iniciar a varredura e exibir os resultados na tela. √â importante ressaltar que essa ferramenta deve ser usada apenas em ambientes autorizados, como parte de um teste de penetra√ß√£o leg√≠timo. O uso indevido ou n√£o autorizado do `moodlescan` pode ser considerado ilegal e sujeito a penalidades.
```bash
#Install from https://github.com/inc0d3/moodlescan
python3 moodlescan.py -k -u http://moodle.example.com/<moodle_path>/

Version 0.7 - Dic/2020
.............................................................................................................

By Victor Herrera - supported by www.incode.cl

.............................................................................................................

Getting server information http://moodle.schooled.htb/moodle/ ...

server         	: Apache/2.4.46 (FreeBSD) PHP/7.4.15
x-powered-by   	: PHP/7.4.15
x-frame-options	: sameorigin
last-modified  	: Wed, 07 Apr 2021 21:33:41 GMT

Getting moodle version...

Version found via /admin/tool/lp/tests/behat/course_competencies.feature : Moodle v3.9.0-beta

Searching vulnerabilities...


Vulnerabilities found: 0

Scan completed.
```
O CMSMap √© uma ferramenta de c√≥digo aberto usada para realizar testes de penetra√ß√£o em sistemas de gerenciamento de conte√∫do (CMS). Ele √© projetado para identificar e explorar vulnerabilidades em CMS populares, como o Moodle. O CMSMap pode ser usado para descobrir informa√ß√µes sobre a instala√ß√£o do Moodle, como vers√£o, plugins instalados e temas ativos. Ele tamb√©m pode ajudar a identificar poss√≠veis pontos fracos que podem ser explorados durante um teste de penetra√ß√£o. O CMSMap √© uma ferramenta poderosa para hackers √©ticos e profissionais de seguran√ßa que desejam avaliar a seguran√ßa de um site baseado em Moodle.
```bash
pip3 install git+https://github.com/dionach/CMSmap.git
cmsmap http://moodle.example.com/<moodle_path>
```
### CVEs

Descobri que as ferramentas autom√°ticas s√£o bastante **in√∫teis para encontrar vulnerabilidades que afetam a vers√£o do Moodle**. Voc√™ pode **verific√°-las** em [**https://snyk.io/vuln/composer:moodle%2Fmoodle**](https://snyk.io/vuln/composer:moodle%2Fmoodle)

## **RCE**

Voc√™ precisa ter a fun√ß√£o de **gerente** e **pode instalar plugins** dentro da guia **"Administra√ß√£o do site"**\*\*:\*\*

![](<../../.gitbook/assets/image (447).png>)

Se voc√™ for gerente, talvez ainda precise **ativar essa op√ß√£o**. Voc√™ pode ver como fazer isso no PoC de escalonamento de privil√©gios do Moodle: [https://github.com/HoangKien1020/CVE-2020-14321](https://github.com/HoangKien1020/CVE-2020-14321).

Em seguida, voc√™ pode **instalar o seguinte plugin** que cont√©m o cl√°ssico shell reverso em PHP do pentest-monkey (_antes de fazer o upload, voc√™ precisa descompact√°-lo, alterar o IP e a porta do revshell e compact√°-lo novamente_)

{% file src="../../.gitbook/assets/moodle-rce-plugin.zip" %}

Ou voc√™ pode usar o plugin de [https://github.com/HoangKien1020/Moodle\_RCE](https://github.com/HoangKien1020/Moodle\_RCE) para obter um shell PHP regular com o par√¢metro "cmd".

Para acessar o plugin malicioso, voc√™ precisa acessar:
```bash
http://domain.com/<moodle_path>/blocks/rce/lang/en/block_rce.php?cmd=id
```
### Encontrar credenciais do banco de dados

Durante um teste de penetra√ß√£o em um site Moodle, uma etapa importante √© encontrar as credenciais do banco de dados. Essas informa√ß√µes s√£o essenciais para acessar e manipular os dados armazenados no banco de dados do Moodle.

Uma maneira comum de encontrar as credenciais do banco de dados √© explorar o c√≥digo-fonte do site Moodle. Procure por arquivos como `config.php` ou `config-dist.php`, que geralmente cont√™m as informa√ß√µes de conex√£o com o banco de dados.

Outra abordagem √© realizar uma an√°lise de tr√°fego usando ferramentas como o Wireshark. Monitore o tr√°fego de rede enquanto realiza a√ß√µes no site Moodle, como fazer login ou acessar p√°ginas espec√≠ficas. Procure por pacotes que contenham informa√ß√µes de conex√£o com o banco de dados, como consultas SQL ou solicita√ß√µes POST.

Al√©m disso, voc√™ pode tentar explorar vulnerabilidades conhecidas no Moodle que possam expor as credenciais do banco de dados. Verifique se h√° vers√µes desatualizadas ou vulnerabilidades conhecidas que possam ser exploradas para obter acesso √†s informa√ß√µes do banco de dados.

Uma vez que voc√™ tenha as credenciais do banco de dados, poder√° us√°-las para acessar diretamente o banco de dados do Moodle e realizar atividades como extra√ß√£o de dados, modifica√ß√£o de registros ou at√© mesmo a exclus√£o de informa√ß√µes sens√≠veis. No entanto, √© importante lembrar que realizar essas a√ß√µes sem permiss√£o √© ilegal e pode ter consequ√™ncias legais graves. Portanto, sempre realize testes de penetra√ß√£o em um ambiente controlado e com permiss√£o pr√©via do propriet√°rio do site.
```bash
find / -name "config.php" 2>/dev/null | grep "moodle/config.php"
```
### Extrair Credenciais do banco de dados

To dump credentials from a database, you can follow these steps:

1. Identify the target database: Determine the type of database being used by the web application. Common databases include MySQL, PostgreSQL, Oracle, and Microsoft SQL Server.

2. Enumerate database users: Use techniques such as SQL injection or brute-forcing to identify the database users.

3. Exploit database vulnerabilities: Exploit any known vulnerabilities in the database to gain unauthorized access. This could include exploiting weak passwords, default credentials, or unpatched vulnerabilities.

4. Dump the credentials: Once access to the database is obtained, use SQL queries or tools like `mysqldump` or `pg_dump` to extract the credentials from the database tables.

5. Analyze the dumped data: Review the dumped data to identify usernames, passwords, and other relevant credentials. This information can be used for further exploitation or to gain unauthorized access to other systems.

It is important to note that extracting credentials from a database without proper authorization is illegal and unethical. These techniques should only be used in a controlled and authorized environment, such as during a penetration test or with explicit permission from the system owner.
```bash
/usr/local/bin/mysql -u <username> --password=<password> -e "use moodle; select email,username,password from mdl_user; exit"
```
<img src="../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt="" data-size="original">

Se voc√™ est√° interessado em uma **carreira de hacking** e hackear o inquebr√°vel - **estamos contratando!** (_flu√™ncia em polon√™s escrita e falada √© necess√°ria_).

{% embed url="https://www.stmcyber.com/careers" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Voc√™ trabalha em uma **empresa de ciberseguran√ßa**? Voc√™ quer ver sua **empresa anunciada no HackTricks**? ou voc√™ quer ter acesso √† **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**? Verifique os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* **Junte-se ao** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para o** [**reposit√≥rio hacktricks**](https://github.com/carlospolop/hacktricks) **e** [**reposit√≥rio hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
