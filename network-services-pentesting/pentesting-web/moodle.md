# Moodle

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Travaillez-vous dans une **entreprise de cybers√©curit√©** ? Voulez-vous voir votre **entreprise annonc√©e dans HackTricks** ? Ou voulez-vous avoir acc√®s √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFT**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**üí¨**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR au** [**repo hacktricks**](https://github.com/carlospolop/hacktricks) **et au** [**repo hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

<img src="../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt="" data-size="original">

Si vous √™tes int√©ress√© par une **carri√®re en piratage** et souhaitez pirater l'impossible - **nous recrutons !** (_ma√Ætrise du polonais √©crit et parl√© requise_).

{% embed url="https://www.stmcyber.com/careers" %}

## Scans automatiques

### droopescan
```bash
pip3 install droopescan
droopescan scan moodle -u http://moodle.example.com/<moodle_path>/

[+] Plugins found:
forum http://moodle.schooled.htb/moodle/mod/forum/
http://moodle.schooled.htb/moodle/mod/forum/upgrade.txt
http://moodle.schooled.htb/moodle/mod/forum/version.php

[+] No themes found.

[+] Possible version(s):
3.10.0-beta

[+] Possible interesting urls found:
Static readme file. - http://moodle.schooled.htb/moodle/README.txt
Admin panel - http://moodle.schooled.htb/moodle/login/

[+] Scan finished (0:00:05.643539 elapsed)
```
Le `moodlescan` est un outil de balayage sp√©cialement con√ßu pour d√©tecter les vuln√©rabilit√©s dans les installations Moodle. Il utilise des techniques de balayage automatis√©es pour identifier les failles de s√©curit√© courantes telles que les injections SQL, les failles XSS et les probl√®mes de configuration. L'outil peut √©galement √™tre utilis√© pour collecter des informations sur le site Moodle cible, telles que les versions des composants, les utilisateurs et les cours.

#### Utilisation

```
moodlescan [options] <url>
```

#### Options

- `-h, --help`: Affiche l'aide et quitte.
- `-v, --version`: Affiche la version de l'outil.
- `-u, --username <username>`: Sp√©cifie le nom d'utilisateur √† utiliser pour l'authentification.
- `-p, --password <password>`: Sp√©cifie le mot de passe √† utiliser pour l'authentification.
- `-c, --cookie <cookie>`: Sp√©cifie le cookie √† utiliser pour l'authentification.
- `-o, --output <file>`: Sp√©cifie le fichier de sortie pour enregistrer les r√©sultats du balayage.
- `-s, --scan <scan>`: Sp√©cifie les types de vuln√©rabilit√©s √† rechercher. Les options disponibles sont `sql`, `xss` et `config`. Par d√©faut, toutes les vuln√©rabilit√©s sont recherch√©es.

#### Exemples

1. Balayer un site Moodle sans authentification :

```
moodlescan https://example.com
```

2. Balayer un site Moodle en sp√©cifiant un nom d'utilisateur et un mot de passe pour l'authentification :

```
moodlescan -u admin -p password123 https://example.com
```

3. Balayer un site Moodle en sp√©cifiant un cookie pour l'authentification :

```
moodlescan -c "session=abcdef123456" https://example.com
```

4. Balayer un site Moodle en sp√©cifiant le type de vuln√©rabilit√©s √† rechercher :

```
moodlescan -s sql,xss https://example.com
```

#### Remarques

- Assurez-vous d'avoir l'autorisation appropri√©e avant de balayer un site Moodle.
- L'outil peut g√©n√©rer un grand nombre de requ√™tes, ce qui peut entra√Æner un blocage IP ou une d√©tection par les syst√®mes de d√©tection d'intrusion. Utilisez-le avec pr√©caution.
```bash
#Install from https://github.com/inc0d3/moodlescan
python3 moodlescan.py -k -u http://moodle.example.com/<moodle_path>/

Version 0.7 - Dic/2020
.............................................................................................................

By Victor Herrera - supported by www.incode.cl

.............................................................................................................

Getting server information http://moodle.schooled.htb/moodle/ ...

server         	: Apache/2.4.46 (FreeBSD) PHP/7.4.15
x-powered-by   	: PHP/7.4.15
x-frame-options	: sameorigin
last-modified  	: Wed, 07 Apr 2021 21:33:41 GMT

Getting moodle version...

Version found via /admin/tool/lp/tests/behat/course_competencies.feature : Moodle v3.9.0-beta

Searching vulnerabilities...


Vulnerabilities found: 0

Scan completed.
```
### CMSMap

CMSMap est un outil de cartographie de CMS qui permet aux testeurs de p√©n√©tration de d√©couvrir les informations relatives √† un syst√®me de gestion de contenu (CMS) sp√©cifique. Cet outil est tr√®s utile pour identifier les vuln√©rabilit√©s potentielles et les points faibles d'un CMS donn√©.

#### Installation

Pour installer CMSMap, vous pouvez utiliser la commande suivante :

```
pip install cmsmap
```

#### Utilisation

Une fois install√©, vous pouvez ex√©cuter CMSMap en utilisant la commande suivante :

```
cmsmap -t <cible>
```

Remplacez `<cible>` par l'URL de la cible que vous souhaitez analyser. CMSMap effectuera une analyse approfondie du CMS utilis√© par la cible et affichera les informations pertinentes.

#### Fonctionnalit√©s

CMSMap offre plusieurs fonctionnalit√©s utiles pour les testeurs de p√©n√©tration, notamment :

- La d√©tection du CMS utilis√© par la cible
- La recherche de vuln√©rabilit√©s connues dans le CMS
- La r√©cup√©ration des noms d'utilisateur et des mots de passe par d√©faut
- La recherche de plugins et de th√®mes install√©s
- L'identification des versions du CMS et des composants utilis√©s
- L'exploration des r√©pertoires et des fichiers sensibles

#### Conclusion

CMSMap est un outil puissant pour les testeurs de p√©n√©tration qui souhaitent √©valuer la s√©curit√© d'un CMS sp√©cifique. En utilisant CMSMap, vous pouvez identifier les vuln√©rabilit√©s potentielles et les points faibles d'un CMS, ce qui vous permet de prendre des mesures pour les corriger et renforcer la s√©curit√© de votre syst√®me.
```bash
pip3 install git+https://github.com/dionach/CMSmap.git
cmsmap http://moodle.example.com/<moodle_path>
```
### CVEs

J'ai constat√© que les outils automatiques sont assez **inutiles pour trouver des vuln√©rabilit√©s affectant la version de Moodle**. Vous pouvez les **v√©rifier** sur [**https://snyk.io/vuln/composer:moodle%2Fmoodle**](https://snyk.io/vuln/composer:moodle%2Fmoodle)

## **RCE**

Vous devez avoir le r√¥le de **manager** et vous **pouvez installer des plugins** dans l'onglet **"Administration du site"**\*\*:\*\*

![](<../../.gitbook/assets/image (447).png>)

Si vous √™tes un manager, vous devrez peut-√™tre **activer cette option**. Vous pouvez voir comment le faire dans la preuve de concept d'escalade de privil√®ges de Moodle: [https://github.com/HoangKien1020/CVE-2020-14321](https://github.com/HoangKien1020/CVE-2020-14321).

Ensuite, vous pouvez **installer le plugin suivant** qui contient le shell PHP classique de pentest-monkey r**ev** (_avant de le t√©l√©charger, vous devez le d√©compresser, changer l'adresse IP et le port du revshell, puis le recompresser_)

{% file src="../../.gitbook/assets/moodle-rce-plugin.zip" %}

Ou vous pouvez utiliser le plugin de [https://github.com/HoangKien1020/Moodle\_RCE](https://github.com/HoangKien1020/Moodle\_RCE) pour obtenir un shell PHP r√©gulier avec le param√®tre "cmd".

Pour acc√©der au lancement du plugin malveillant, vous devez acc√©der √†:
```bash
http://domain.com/<moodle_path>/blocks/rce/lang/en/block_rce.php?cmd=id
```
## POST

### Trouver les identifiants de la base de donn√©es

L'une des premi√®res √©tapes lors de la recherche de vuln√©rabilit√©s dans une application Moodle est de trouver les identifiants de la base de donn√©es. Ces informations peuvent √™tre utilis√©es pour acc√©der directement √† la base de donn√©es et extraire des donn√©es sensibles.

Pour trouver les identifiants de la base de donn√©es, vous pouvez utiliser diff√©rentes techniques de test d'injection SQL. L'une des m√©thodes couramment utilis√©es est l'injection SQL bas√©e sur les erreurs. Cette technique consiste √† envoyer des requ√™tes SQL malveillantes qui provoquent des erreurs dans l'application, r√©v√©lant ainsi des informations sensibles telles que les identifiants de connexion √† la base de donn√©es.

Voici un exemple de requ√™te SQL malveillante qui peut √™tre utilis√©e pour extraire les identifiants de la base de donn√©es :

```sql
' UNION SELECT NULL, CONCAT(username, 0x3a, password), NULL FROM mdl_user --
```

Cette requ√™te utilise l'instruction UNION SELECT pour extraire les noms d'utilisateur et les mots de passe de la table mdl_user de la base de donn√©es Moodle. Les r√©sultats de cette requ√™te seront affich√©s dans les messages d'erreur de l'application, ce qui permettra de r√©cup√©rer les identifiants de la base de donn√©es.

Il est important de noter que l'utilisation de ces techniques de test d'injection SQL doit √™tre effectu√©e dans un environnement contr√¥l√© et autoris√©, tel qu'un environnement de test ou un engagement de pentest. L'acc√®s non autoris√© √† des syst√®mes ou des donn√©es peut entra√Æner des cons√©quences l√©gales graves.
```bash
find / -name "config.php" 2>/dev/null | grep "moodle/config.php"
```
### Extraire les identifiants de la base de donn√©es

To dump credentials from a database, you can use various techniques depending on the type of database you are targeting. Here are some common methods:

1. **SQL Injection**: If the web application is vulnerable to SQL injection, you can exploit it to extract credentials from the database. By injecting malicious SQL queries, you can retrieve usernames and passwords stored in the database.

2. **Brute-forcing**: If you have obtained a database dump file, you can use brute-forcing techniques to crack hashed passwords. By trying different combinations of passwords and comparing the hashes, you may be able to recover plaintext passwords.

3. **Exploiting Misconfigurations**: Sometimes, databases are misconfigured and allow unauthorized access. By exploiting these misconfigurations, you can gain direct access to the database and extract credentials.

4. **Using Database Exploitation Tools**: There are several tools available that can help you extract credentials from databases. For example, tools like SQLMap, DBeaver, or Metasploit can be used to automate the process of dumping credentials.

Remember, it is important to have proper authorization and legal permission before attempting to extract credentials from a database. Unauthorized access to databases is illegal and unethical. Always ensure you are conducting penetration testing within the boundaries of the law and with the appropriate permissions.
```bash
/usr/local/bin/mysql -u <username> --password=<password> -e "use moodle; select email,username,password from mdl_user; exit"
```
<img src="../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt="" data-size="original">

Si vous √™tes int√©ress√© par une **carri√®re de hacking** et que vous souhaitez pirater l'impossible - **nous recrutons !** (_ma√Ætrise du polonais √† l'√©crit et √† l'oral requise_).

{% embed url="https://www.stmcyber.com/careers" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Travaillez-vous dans une **entreprise de cybers√©curit√©** ? Voulez-vous voir votre **entreprise annonc√©e dans HackTricks** ? Ou souhaitez-vous avoir acc√®s √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFT**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**üí¨**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR au** [**repo hacktricks**](https://github.com/carlospolop/hacktricks) **et au** [**repo hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
