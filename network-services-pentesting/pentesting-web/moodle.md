# Moodle

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks Cloud ☁️</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>🐦 Twitter 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 Youtube 🎥</strong></a></summary>

* **サイバーセキュリティ会社**で働いていますか？ **HackTricksで会社を宣伝**したいですか？または、**PEASSの最新バージョンにアクセスしたり、HackTricksをPDFでダウンロード**したいですか？[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を見つけてください。独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクションです。
* [**公式のPEASS＆HackTricksのグッズ**](https://peass.creator-spring.com)を手に入れましょう。
* [**💬**](https://emojipedia.org/speech-balloon/) [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**telegramグループ**](https://t.me/peass)に**参加**するか、**Twitter**で**フォロー**してください[**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**。**
* **ハッキングのトリックを共有するには、[hacktricks repo](https://github.com/carlospolop/hacktricks)と[hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)**にPRを提出してください。

</details>

<img src="../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="original">

もし**ハッキングのキャリア**に興味があり、**解読不能なものをハック**したい場合は、**採用中です**（_流暢なポーランド語の読み書きが必要です_）。

{% embed url="https://www.stmcyber.com/careers" %}

## 自動スキャン

### droopescan
```bash
pip3 install droopescan
droopescan scan moodle -u http://moodle.example.com/<moodle_path>/

[+] Plugins found:
forum http://moodle.schooled.htb/moodle/mod/forum/
http://moodle.schooled.htb/moodle/mod/forum/upgrade.txt
http://moodle.schooled.htb/moodle/mod/forum/version.php

[+] No themes found.

[+] Possible version(s):
3.10.0-beta

[+] Possible interesting urls found:
Static readme file. - http://moodle.schooled.htb/moodle/README.txt
Admin panel - http://moodle.schooled.htb/moodle/login/

[+] Scan finished (0:00:05.643539 elapsed)
```
### moodlescan

moodlescan is a tool used for scanning and enumerating Moodle instances. It can be used to gather information about the Moodle installation, such as version, plugins, and themes. This information can be useful for identifying potential vulnerabilities and weaknesses in the Moodle system.

To use moodlescan, you can run the following command:

```
moodlescan <target>
```

Replace `<target>` with the URL or IP address of the Moodle instance you want to scan.

The tool will then perform various checks and queries to gather information about the Moodle installation. It will display the results, including the Moodle version, installed plugins, and themes.

By analyzing the results, you can identify potential vulnerabilities and weaknesses in the Moodle system. This information can be used to further exploit the system or to strengthen its security.

It is important to note that moodlescan should only be used for ethical purposes, such as penetration testing or security auditing. Unauthorized use of this tool can lead to legal consequences.
```bash
#Install from https://github.com/inc0d3/moodlescan
python3 moodlescan.py -k -u http://moodle.example.com/<moodle_path>/

Version 0.7 - Dic/2020
.............................................................................................................

By Victor Herrera - supported by www.incode.cl

.............................................................................................................

Getting server information http://moodle.schooled.htb/moodle/ ...

server         	: Apache/2.4.46 (FreeBSD) PHP/7.4.15
x-powered-by   	: PHP/7.4.15
x-frame-options	: sameorigin
last-modified  	: Wed, 07 Apr 2021 21:33:41 GMT

Getting moodle version...

Version found via /admin/tool/lp/tests/behat/course_competencies.feature : Moodle v3.9.0-beta

Searching vulnerabilities...


Vulnerabilities found: 0

Scan completed.
```
### CMSMap

CMSMapは、ウェブサイトがどのCMS（コンテンツ管理システム）を使用しているかを特定するためのツールです。このツールは、ウェブサイトのURLを入力すると、自動的にCMSの種類を特定し、そのバージョンやインストールされているプラグインなどの情報を提供します。

CMSMapは、ウェブサイトのセキュリティ評価や侵入テストに役立ちます。特定のCMSの脆弱性を検出するために使用することもできます。このツールは、ウェブサイトのCMSに関する情報を収集するために使用されるため、侵入テストの一環として使用する場合は、適切な許可を取得することが重要です。

CMSMapは、Pythonで書かれており、コマンドラインインターフェースを介して使用されます。ウェブサイトのURLを指定し、CMSMapが自動的に情報を収集することができます。このツールは、ウェブサイトのCMSに関する情報を簡単に取得するため、侵入テストの初心者から上級者まで幅広いユーザーに適しています。

CMSMapは、ウェブサイトのCMSに関する情報を収集するための便利なツールです。ウェブサイトのセキュリティ評価や侵入テストに役立つため、セキュリティ専門家やエンジニアにとって重要なツールです。
```bash
pip3 install git+https://github.com/dionach/CMSmap.git
cmsmap http://moodle.example.com/<moodle_path>
```
### CVEs

自動ツールは、Moodleのバージョンに影響を与える脆弱性を見つけるのにはほとんど役に立たないことがわかりました。これらの脆弱性は、[https://snyk.io/vuln/composer:moodle%2Fmoodle](https://snyk.io/vuln/composer:moodle%2Fmoodle)で確認できます。

## RCE

「マネージャー」の役割を持っている必要があり、「サイト管理」タブ内でプラグインをインストールできます。

![](<../../.gitbook/assets/image (447).png>)

マネージャーであっても、このオプションを有効にする必要がある場合があります。Moodle特権エスカレーションPoCで確認できます：[https://github.com/HoangKien1020/CVE-2020-14321](https://github.com/HoangKien1020/CVE-2020-14321)。

次に、次のプラグインをインストールできます。このプラグインには、クラシックなpentest-monkey php逆シェルが含まれています（アップロードする前に解凍し、revshellのIPとポートを変更し、再度圧縮する必要があります）。

{% file src="../../.gitbook/assets/moodle-rce-plugin.zip" %}

または、「cmd」パラメータを使用して通常のPHPシェルを取得するために、[https://github.com/HoangKien1020/Moodle\_RCE](https://github.com/HoangKien1020/Moodle\_RCE)からプラグインを使用することもできます。

悪意のあるプラグインにアクセスするには、次の場所にアクセスする必要があります：
```bash
http://domain.com/<moodle_path>/blocks/rce/lang/en/block_rce.php?cmd=id
```
## POST

### データベースの資格情報を見つける

データベースの資格情報を見つけるために、以下の手順を実行します。

1. ページのソースコードを調査します。特に、`<form>` タグ内の `action` 属性や `input` タグ内の `name` 属性に注目します。

2. フォームの送信先のURLを特定します。これは、`action` 属性の値です。

3. フォームの送信データを確認します。`input` タグの `name` 属性と `value` 属性をチェックします。特に、`username` や `password` といったフィールドがあるか確認します。

4. フォームの送信データを使用して、データベースの資格情報を特定します。`username` フィールドには、データベースのユーザー名が、`password` フィールドには、データベースのパスワードが入力される可能性があります。

以上の手順を実行することで、データベースの資格情報を見つけることができます。
```bash
find / -name "config.php" 2>/dev/null | grep "moodle/config.php"
```
### データベースから資格情報をダンプする

To dump credentials from a database, you can use various techniques depending on the type of database you are targeting. Here are some common methods:

#### 1. SQL Injection

If the target application is vulnerable to SQL injection, you can exploit this vulnerability to extract credentials from the database. By injecting malicious SQL queries, you can retrieve sensitive information such as usernames and passwords.

#### 2. Brute-forcing Database Credentials

In some cases, the database may have weak or default credentials. You can use brute-forcing techniques to guess the username and password combination and gain unauthorized access to the database.

#### 3. Exploiting Misconfigured Database Permissions

If the database has misconfigured permissions, you may be able to exploit this to access the credentials. For example, if the database allows public read access to certain tables or files, you can retrieve the credentials stored within them.

#### 4. Exploiting Database Vulnerabilities

Certain databases may have known vulnerabilities that can be exploited to extract credentials. It is important to keep track of the latest vulnerabilities and patches for the specific database you are targeting.

Remember, unauthorized access to databases and extracting credentials without proper authorization is illegal. Always ensure you have the necessary permissions and legal authorization before attempting any database credential extraction techniques.
```bash
/usr/local/bin/mysql -u <username> --password=<password> -e "use moodle; select email,username,password from mdl_user; exit"
```
<img src="../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="original">

もしあなたが**ハッキングのキャリア**に興味があり、**解読不能なものをハック**したいのであれば - **私たちは採用しています！**（_流暢なポーランド語の読み書きが必要です_）。

{% embed url="https://www.stmcyber.com/careers" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks Cloud ☁️</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>🐦 Twitter 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 Youtube 🎥</strong></a></summary>

* あなたは**サイバーセキュリティ会社**で働いていますか？ HackTricksであなたの**会社を宣伝**したいですか？または、**最新バージョンのPEASSにアクセスしたり、HackTricksをPDFでダウンロード**したいですか？[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を見つけてください、私たちの独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクション
* [**公式のPEASS＆HackTricksのグッズ**](https://peass.creator-spring.com)を手に入れましょう
* [**💬**](https://emojipedia.org/speech-balloon/) [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**telegramグループ**](https://t.me/peass)に**参加**するか、**Twitter**で私を**フォロー**してください[**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **ハッキングのトリックを共有するために、[hacktricksのリポジトリ](https://github.com/carlospolop/hacktricks)と[hacktricks-cloudのリポジトリ](https://github.com/carlospolop/hacktricks-cloud)**にPRを提出してください。

</details>
