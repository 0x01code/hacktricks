# Moodle

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* ¬øTrabajas en una **empresa de ciberseguridad**? ¬øQuieres ver tu **empresa anunciada en HackTricks**? ¬øO quieres tener acceso a la **√∫ltima versi√≥n de PEASS o descargar HackTricks en PDF**? ¬°Consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obt√©n el [**swag oficial de PEASS y HackTricks**](https://peass.creator-spring.com)
* **√önete al** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de Telegram**](https://t.me/peass) o **s√≠gueme** en **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Comparte tus trucos de hacking enviando PRs al** [**repositorio de hacktricks**](https://github.com/carlospolop/hacktricks) **y al** [**repositorio de hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

<img src="../../.gitbook/assets/image (1) (1) (1) (1) (1).png" alt="" data-size="original">

Si est√°s interesado en una **carrera de hacking** y hackear lo imposible - ¬°**estamos contratando**! (_se requiere fluidez en polaco escrito y hablado_).

{% embed url="https://www.stmcyber.com/careers" %}

## Escaneos Autom√°ticos

### droopescan
```bash
pip3 install droopescan
droopescan scan moodle -u http://moodle.example.com/<moodle_path>/

[+] Plugins found:
forum http://moodle.schooled.htb/moodle/mod/forum/
http://moodle.schooled.htb/moodle/mod/forum/upgrade.txt
http://moodle.schooled.htb/moodle/mod/forum/version.php

[+] No themes found.

[+] Possible version(s):
3.10.0-beta

[+] Possible interesting urls found:
Static readme file. - http://moodle.schooled.htb/moodle/README.txt
Admin panel - http://moodle.schooled.htb/moodle/login/

[+] Scan finished (0:00:05.643539 elapsed)
```
El comando `moodlescan` es una herramienta de escaneo de seguridad dise√±ada espec√≠ficamente para Moodle, una plataforma de aprendizaje en l√≠nea. Esta herramienta se utiliza para identificar posibles vulnerabilidades en una instalaci√≥n de Moodle y proporciona informaci√≥n detallada sobre los riesgos de seguridad.

El comando `moodlescan` se ejecuta desde la l√≠nea de comandos y acepta varios par√°metros para personalizar el escaneo. Algunas de las caracter√≠sticas clave de `moodlescan` incluyen:

- Escaneo de versiones de Moodle: `moodlescan` puede identificar la versi√≥n exacta de Moodle que se est√° ejecutando en un sitio web. Esto es √∫til para determinar si una instalaci√≥n de Moodle est√° actualizada y si se han corregido las vulnerabilidades conocidas en versiones anteriores.

- Escaneo de plugins: `moodlescan` puede analizar los plugins instalados en un sitio de Moodle y verificar si hay vulnerabilidades conocidas en ellos. Esto es importante, ya que los plugins pueden introducir nuevas vulnerabilidades en una instalaci√≥n de Moodle.

- Escaneo de configuraci√≥n: `moodlescan` tambi√©n puede analizar la configuraci√≥n de Moodle en busca de posibles problemas de seguridad. Esto incluye la verificaci√≥n de la configuraci√≥n de autenticaci√≥n, la configuraci√≥n de permisos y otras configuraciones relacionadas con la seguridad.

Es importante destacar que `moodlescan` es una herramienta de escaneo de seguridad y no debe utilizarse para fines maliciosos. Su objetivo principal es ayudar a los administradores de Moodle a identificar y corregir posibles vulnerabilidades en sus instalaciones.
```bash
#Install from https://github.com/inc0d3/moodlescan
python3 moodlescan.py -k -u http://moodle.example.com/<moodle_path>/

Version 0.7 - Dic/2020
.............................................................................................................

By Victor Herrera - supported by www.incode.cl

.............................................................................................................

Getting server information http://moodle.schooled.htb/moodle/ ...

server         	: Apache/2.4.46 (FreeBSD) PHP/7.4.15
x-powered-by   	: PHP/7.4.15
x-frame-options	: sameorigin
last-modified  	: Wed, 07 Apr 2021 21:33:41 GMT

Getting moodle version...

Version found via /admin/tool/lp/tests/behat/course_competencies.feature : Moodle v3.9.0-beta

Searching vulnerabilities...


Vulnerabilities found: 0

Scan completed.
```
### CMSMap

CMSMap es una herramienta de c√≥digo abierto que se utiliza para escanear y enumerar los sistemas de gesti√≥n de contenido (CMS) en un sitio web. Esta herramienta es √∫til durante las pruebas de penetraci√≥n para identificar el CMS utilizado por un sitio web y obtener informaci√≥n sobre las vulnerabilidades conocidas asociadas con ese CMS en particular.

#### Caracter√≠sticas principales de CMSMap:

- Escaneo de CMS: CMSMap puede escanear un sitio web en busca de CMS populares como WordPress, Joomla, Drupal, etc. Esto ayuda a los pentesters a identificar r√°pidamente el CMS utilizado por el sitio web objetivo.

- Enumeraci√≥n de usuarios: CMSMap puede enumerar los usuarios registrados en un sitio web basado en CMS. Esto puede ser √∫til para identificar posibles nombres de usuario v√°lidos para ataques de fuerza bruta o intentos de inicio de sesi√≥n.

- Enumeraci√≥n de plugins y temas: CMSMap puede enumerar los plugins y temas instalados en un sitio web basado en CMS. Esto proporciona informaci√≥n valiosa sobre las versiones de los plugins y temas, lo que puede ayudar a identificar vulnerabilidades conocidas.

- Enumeraci√≥n de directorios: CMSMap puede enumerar los directorios y archivos presentes en un sitio web. Esto puede ayudar a los pentesters a identificar posibles puntos de entrada para ataques de inyecci√≥n de c√≥digo o acceso no autorizado.

- Escaneo de vulnerabilidades: CMSMap puede escanear un sitio web en busca de vulnerabilidades conocidas asociadas con el CMS utilizado. Esto ayuda a los pentesters a identificar posibles puntos d√©biles en el sitio web objetivo.

CMSMap es una herramienta poderosa que puede ahorrar tiempo y esfuerzo durante las pruebas de penetraci√≥n de sitios web basados en CMS. Sin embargo, es importante utilizar esta herramienta de manera √©tica y obtener el permiso adecuado antes de realizar cualquier escaneo o prueba de penetraci√≥n.
```bash
pip3 install git+https://github.com/dionach/CMSmap.git
cmsmap http://moodle.example.com/<moodle_path>
```
### CVEs

Encontr√© que las herramientas autom√°ticas son bastante **in√∫tiles para encontrar vulnerabilidades que afecten a la versi√≥n de Moodle**. Puedes **verificar** esto en [**https://snyk.io/vuln/composer:moodle%2Fmoodle**](https://snyk.io/vuln/composer:moodle%2Fmoodle)

## **RCE**

Necesitas tener el rol de **gerente** y **puedes instalar complementos** dentro de la pesta√±a de **"Administraci√≥n del sitio"**:

![](<../../.gitbook/assets/image (447).png>)

Si eres gerente, es posible que a√∫n necesites **activar esta opci√≥n**. Puedes ver c√≥mo hacerlo en la prueba de concepto de escalada de privilegios de Moodle: [https://github.com/HoangKien1020/CVE-2020-14321](https://github.com/HoangKien1020/CVE-2020-14321).

Luego, puedes **instalar el siguiente complemento** que contiene el cl√°sico shell reverso en PHP de pentest-monkey (_antes de subirlo, debes descomprimirlo, cambiar la IP y el puerto del revshell y comprimirlo nuevamente_)

{% file src="../../.gitbook/assets/moodle-rce-plugin.zip" %}

O puedes usar el complemento de [https://github.com/HoangKien1020/Moodle\_RCE](https://github.com/HoangKien1020/Moodle\_RCE) para obtener un shell PHP regular con el par√°metro "cmd".

Para acceder y lanzar el complemento malicioso, debes acceder a:
```bash
http://domain.com/<moodle_path>/blocks/rce/lang/en/block_rce.php?cmd=id
```
## POST

### Encontrar credenciales de la base de datos
```bash
find / -name "config.php" 2>/dev/null | grep "moodle/config.php"
```
### Volcar credenciales de la base de datos

Para realizar una prueba de penetraci√≥n en un sitio web Moodle, es posible que desees extraer las credenciales de la base de datos. Esto te permitir√° obtener informaci√≥n de inicio de sesi√≥n de los usuarios y potencialmente acceder a sus cuentas.

Aqu√≠ hay algunos pasos que puedes seguir para volcar las credenciales de la base de datos:

1. Identifica el tipo de base de datos utilizada por Moodle. Puede ser MySQL, PostgreSQL u otro sistema de gesti√≥n de bases de datos.

2. Utiliza herramientas como `phpMyAdmin` o `pgAdmin` para acceder a la base de datos. Estas herramientas te permitir√°n ejecutar consultas SQL y extraer datos de la base de datos.

3. Ejecuta una consulta SQL para extraer las credenciales de la tabla de usuarios. Por ejemplo, en MySQL, puedes usar la siguiente consulta:

   ```sql
   SELECT username, password FROM mdl_user;
   ```

   Esta consulta seleccionar√° los nombres de usuario y las contrase√±as de la tabla `mdl_user`. Aseg√∫rate de ajustar el nombre de la tabla seg√∫n la configuraci√≥n de tu base de datos.

4. Guarda los resultados de la consulta en un archivo seguro. Puedes utilizar comandos como `SELECT ... INTO OUTFILE` en MySQL para guardar los resultados en un archivo CSV o TXT.

Recuerda que realizar pruebas de penetraci√≥n en un sitio web sin permiso expl√≠cito es ilegal y puede tener consecuencias legales graves. Siempre aseg√∫rate de obtener el consentimiento del propietario del sitio web antes de realizar cualquier prueba de penetraci√≥n.
```bash
/usr/local/bin/mysql -u <username> --password=<password> -e "use moodle; select email,username,password from mdl_user; exit"
```
<img src="../../.gitbook/assets/image (1) (1) (1) (1) (1).png" alt="" data-size="original">

Si est√°s interesado en una **carrera de hacking** y hackear lo inhackeable, ¬°**estamos contratando!** (_se requiere fluidez en polaco escrito y hablado_).

{% embed url="https://www.stmcyber.com/careers" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* ¬øTrabajas en una **empresa de ciberseguridad**? ¬øQuieres ver tu **empresa anunciada en HackTricks**? ¬øO quieres tener acceso a la **√∫ltima versi√≥n de PEASS o descargar HackTricks en PDF**? ¬°Consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obt√©n el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* **√önete al** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de Telegram**](https://t.me/peass) o **s√≠gueme** en **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Comparte tus trucos de hacking enviando PRs al** [**repositorio de hacktricks**](https://github.com/carlospolop/hacktricks) **y al** [**repositorio de hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
