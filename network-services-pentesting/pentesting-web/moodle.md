# Moodle

<details>

<summary><strong>AWS hacklemeyi sıfırdan kahraman olmaya öğrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Kırmızı Takım Uzmanı)</strong></a><strong>!</strong></summary>

HackTricks'ı desteklemenin diğer yolları:

* **Şirketinizi HackTricks'te reklamınızı görmek** veya **HackTricks'i PDF olarak indirmek** için [**ABONELİK PLANLARI'na**](https://github.com/sponsors/carlospolop) göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keşfedin, özel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın** veya **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)**'u takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna **PR göndererek paylaşın**.

</details>

<img src="../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt="" data-size="original">

Eğer **hacking kariyeri** ile ilgileniyorsanız ve hacklenemez olanı hacklemek istiyorsanız - **işe alıyoruz!** (_akıcı Lehçe yazılı ve sözlü gereklidir_).

{% embed url="https://www.stmcyber.com/careers" %}

## Otomatik Taramalar

### droopescan
```bash
pip3 install droopescan
droopescan scan moodle -u http://moodle.example.com/<moodle_path>/

[+] Plugins found:
forum http://moodle.schooled.htb/moodle/mod/forum/
http://moodle.schooled.htb/moodle/mod/forum/upgrade.txt
http://moodle.schooled.htb/moodle/mod/forum/version.php

[+] No themes found.

[+] Possible version(s):
3.10.0-beta

[+] Possible interesting urls found:
Static readme file. - http://moodle.schooled.htb/moodle/README.txt
Admin panel - http://moodle.schooled.htb/moodle/login/

[+] Scan finished (0:00:05.643539 elapsed)
```
#### moodlescan

`moodlescan` is a tool specifically designed for scanning Moodle installations. It can be used to identify vulnerabilities and misconfigurations in Moodle instances.

The tool performs various checks, including:

- Version detection: It identifies the version of Moodle being used, which can help in determining if any known vulnerabilities exist.
- Plugin enumeration: It lists all the installed plugins in the Moodle instance, which can help in identifying potential vulnerabilities associated with specific plugins.
- Directory enumeration: It scans for common directories and files that may contain sensitive information or configuration files.
- User enumeration: It attempts to enumerate valid usernames in the Moodle instance, which can be useful for further exploitation.
- Password brute-forcing: It can perform brute-force attacks to guess weak passwords of Moodle user accounts.

To use `moodlescan`, you need to provide the target Moodle URL and specify the desired scan options. The tool will then perform the specified checks and provide a report of any vulnerabilities or misconfigurations found.

It is important to note that `moodlescan` should only be used for ethical purposes, such as penetration testing or security auditing with proper authorization. Unauthorized use of this tool can lead to legal consequences.
```bash
#Install from https://github.com/inc0d3/moodlescan
python3 moodlescan.py -k -u http://moodle.example.com/<moodle_path>/

Version 0.7 - Dic/2020
.............................................................................................................

By Victor Herrera - supported by www.incode.cl

.............................................................................................................

Getting server information http://moodle.schooled.htb/moodle/ ...

server         	: Apache/2.4.46 (FreeBSD) PHP/7.4.15
x-powered-by   	: PHP/7.4.15
x-frame-options	: sameorigin
last-modified  	: Wed, 07 Apr 2021 21:33:41 GMT

Getting moodle version...

Version found via /admin/tool/lp/tests/behat/course_competencies.feature : Moodle v3.9.0-beta

Searching vulnerabilities...


Vulnerabilities found: 0

Scan completed.
```
### CMSMap

CMSMap, bir içerik yönetim sistemi (CMS) keşfetme ve sızma testi aracıdır. Bu araç, hedef web sitesinin hangi CMS'i kullandığını belirlemek için farklı teknikler kullanır. CMSMap, hedef sistemdeki zayıf noktaları tespit etmek ve sızma testi yapmak için kullanılabilir.

#### Kurulum

CMSMap'i kurmak için aşağıdaki adımları izleyin:

1. Python'u yükleyin (versiyon 2.7.x veya 3.x).
2. CMSMap'i indirin: `git clone https://github.com/Dionach/CMSmap.git`
3. Gerekli bağımlılıkları yüklemek için aşağıdaki komutu çalıştırın: `pip install -r requirements.txt`

#### Kullanım

CMSMap'i kullanmak için aşağıdaki komutu kullanın:

```
python cmsmap.py -t <hedef URL>
```

`<hedef URL>` yerine hedef web sitesinin URL'sini girin. CMSMap, hedef web sitesinin hangi CMS'i kullandığını belirleyecek ve ilgili zayıf noktaları tespit etmek için otomatik olarak tarama yapacaktır.

#### Örnek Kullanım

Aşağıdaki örnek, CMSMap'in nasıl kullanılacağını göstermektedir:

```
python cmsmap.py -t http://www.example.com
```

Bu komut, `http://www.example.com` adresindeki web sitesi için CMS taraması yapacaktır. CMSMap, hedef web sitesinin hangi CMS'i kullandığını belirleyecek ve ilgili zayıf noktaları tespit etmek için otomatik olarak tarama yapacaktır.

#### Sonuçlar

CMSMap, tarama sonucunda elde edilen bilgileri ayrıntılı bir şekilde sunar. Bu bilgiler, hedef web sitesinin hangi CMS'i kullandığını, CMS sürümünü, kullanılan eklentileri ve diğer ilgili bilgileri içerir. Bu bilgiler, sızma testi yaparken hedef sistemdeki zayıf noktaları belirlemek için kullanılabilir.

#### CMSMap'in Sınırlamaları

CMSMap, yalnızca hedef web sitesinin hangi CMS'i kullandığını belirlemek ve ilgili zayıf noktaları tespit etmek için kullanılabilir. Bu araç, hedef web sitesinin güvenlik açıklarını otomatik olarak sömürmez veya sızma testi yapmaz. CMSMap'i kullanırken, elde edilen sonuçları dikkatlice değerlendirmek ve manuel olarak sızma testi yapmak önemlidir.
```bash
pip3 install git+https://github.com/dionach/CMSmap.git
cmsmap http://moodle.example.com/<moodle_path>
```
### CVE'ler

Otomatik araçların, moodle sürümünü etkileyen zafiyetleri bulmada oldukça **kullanışsız olduğunu** tespit ettim. Bunları [**https://snyk.io/vuln/composer:moodle%2Fmoodle**](https://snyk.io/vuln/composer:moodle%2Fmoodle) adresinden **kontrol edebilirsiniz**.

## **RCE**

**Yönetici** rolüne sahip olmanız ve **"Site yönetimi"** sekmesi içinde **eklentileri yükleyebilmeniz gerekmektedir**:

![](<../../.gitbook/assets/image (447).png>)

Yönetici olsanız bile, bu seçeneği **etkinleştirmeniz gerekebilir**. Moodle ayrıcalık yükseltme PoC'sinde nasıl yapılacağını görebilirsiniz: [https://github.com/HoangKien1020/CVE-2020-14321](https://github.com/HoangKien1020/CVE-2020-14321).

Ardından, aşağıdaki eklentiyi **yükleyebilirsiniz**. Bu eklenti, klasik pentest-monkey php **rev shell**'i içermektedir (_yüklemek için önce sıkıştırılmış dosyayı açmanız, revshell'in IP ve portunu değiştirmeniz ve tekrar sıkıştırmanız gerekmektedir_)

{% file src="../../.gitbook/assets/moodle-rce-plugin.zip" %}

Veya "cmd" parametresiyle düzenli bir PHP shell elde etmek için [https://github.com/HoangKien1020/Moodle\_RCE](https://github.com/HoangKien1020/Moodle\_RCE) adresindeki eklentiyi kullanabilirsiniz.

Kötü amaçlı eklentiyi başlatmak için aşağıdaki adrese erişmeniz gerekmektedir:
```bash
http://domain.com/<moodle_path>/blocks/rce/lang/en/block_rce.php?cmd=id
```
### Veritabanı Kimlik Bilgilerini Bulma

Bir Moodle uygulamasını hedef aldığınızda, veritabanı kimlik bilgilerini bulmak, hedef sisteme erişim sağlamak için önemli bir adımdır. Bu kimlik bilgileri, Moodle uygulamasının veritabanına erişmek için kullanılan kullanıcı adı ve şifreyi içerir.

Veritabanı kimlik bilgilerini bulmak için aşağıdaki adımları izleyebilirsiniz:

1. İlk olarak, hedef Moodle uygulamasının web sayfasını inceleyin ve kaynak kodunu kontrol edin. Bu sayede, veritabanı kimlik bilgilerinin doğrudan kaynak kodunda yer alıp almadığını kontrol edebilirsiniz.

2. Eğer veritabanı kimlik bilgileri kaynak kodunda bulunmuyorsa, hedef sistemin konfigürasyon dosyalarını kontrol edin. Moodle uygulamasının genellikle `config.php` adında bir konfigürasyon dosyası bulunur. Bu dosyayı inceleyerek, veritabanı kimlik bilgilerini bulabilirsiniz.

3. Konfigürasyon dosyasında veritabanı kimlik bilgilerini bulamazsanız, hedef sistemin diğer dosyalarını kontrol edin. Özellikle, Moodle uygulamasının yüklendiği dizindeki `config.php` dosyasını kontrol edin. Bu dosya, veritabanı kimlik bilgilerini içerebilir.

Veritabanı kimlik bilgilerini bulduktan sonra, bu bilgileri kullanarak hedef sisteme erişim sağlayabilir ve gerekli işlemleri gerçekleştirebilirsiniz. Ancak, bu işlemi yasal ve etik sınırlar içinde gerçekleştirmeniz önemlidir.
```bash
find / -name "config.php" 2>/dev/null | grep "moodle/config.php"
```
### Veritabanından Kimlik Bilgilerini Çekme

Bir Moodle uygulaması üzerinde çalışırken, hedefin veritabanına erişim sağlamak ve kimlik bilgilerini çekmek isteyebilirsiniz. Bu, hedefin kullanıcı adları ve şifreler gibi hassas bilgilerini elde etmenizi sağlar.

Bu işlemi gerçekleştirmek için aşağıdaki adımları izleyebilirsiniz:

1. İlk olarak, hedefin Moodle uygulamasının veritabanı bilgilerini elde etmeniz gerekmektedir. Bu bilgiler genellikle Moodle'nin yapılandırma dosyasında bulunur. Dosya genellikle `config.php` olarak adlandırılır ve Moodle uygulamasının ana dizininde yer alır.

2. Veritabanı bilgilerini elde ettikten sonra, bir veritabanı yönetim aracı kullanarak hedefin veritabanına bağlanabilirsiniz. Örneğin, phpMyAdmin veya MySQL komut satırı aracını kullanabilirsiniz.

3. Veritabanına bağlandıktan sonra, kullanıcı tablosunu araştırabilirsiniz. Moodle'de kullanıcılar genellikle `mdl_user` tablosunda saklanır. Bu tabloyu inceleyerek kullanıcı adları ve şifreler gibi kimlik bilgilerini bulabilirsiniz.

4. Kimlik bilgilerini çekmek için SQL sorgularını kullanabilirsiniz. Örneğin, aşağıdaki sorgu kullanıcı adı ve şifreleri çekmek için kullanılabilir:

   ```sql
   SELECT username, password FROM mdl_user;
   ```

   Bu sorguyu çalıştırdığınızda, kullanıcı adları ve şifreler gibi kimlik bilgileri sonuç olarak dönecektir.

5. Elde ettiğiniz kimlik bilgilerini kullanarak hedefin Moodle uygulamasına erişebilirsiniz. Bu, hedefin hesaplarına yetkisiz erişim sağlamanıza olanak tanır.

Bu işlemi gerçekleştirirken dikkatli olmanız önemlidir. Yasal izinler olmadan veya yetkisiz erişim sağlamadan başka bir kişinin veritabanına erişmek yasa dışıdır ve ciddi sonuçlara yol açabilir. Bu nedenle, her zaman yasal ve etik sınırlar içinde çalıştığınızdan emin olun.
```bash
/usr/local/bin/mysql -u <username> --password=<password> -e "use moodle; select email,username,password from mdl_user; exit"
```
<img src="../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt="" data-size="original">

Eğer **hacking kariyeri** ile ilgileniyorsanız ve hacklenemez olanı hacklemek istiyorsanız - **işe alıyoruz!** (_akıcı polonyaca yazılı ve konuşma becerisi gereklidir_).

{% embed url="https://www.stmcyber.com/careers" %}

<details>

<summary><strong>htARTE (HackTricks AWS Kırmızı Takım Uzmanı)</strong> ile sıfırdan kahraman olmak için AWS hacklemeyi öğrenin<strong>!</strong></summary>

HackTricks'i desteklemenin diğer yolları:

* **Şirketinizi HackTricks'te reklamınızı görmek veya HackTricks'i PDF olarak indirmek isterseniz** [**ABONELİK PLANLARI'na**](https://github.com/sponsors/carlospolop) göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keşfedin, özel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın** veya **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)**'ı takip edin**.
* **Hacking hilelerinizi HackTricks ve HackTricks Cloud github depolarına PR göndererek paylaşın**.

</details>
