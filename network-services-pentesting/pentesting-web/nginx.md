# Nginx

<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдЕрдЧрд░ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА HackTricks рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд рд╣реЛ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕ рджреЗрдЦреЗрдВ**](https://github.com/sponsors/carlospolop)!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣, [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдЦреЛрдЬреЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@carlospolopm**](https://twitter.com/hacktricks\_live)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВред

</details>

<figure><img src="../../.gitbook/assets/image (2) (1).png" alt=""><figcaption></figcaption></figure>

**рдХрд┐рд╕реА рднреА рд╕реНрдерд╛рди рд╕реЗ рд╡реНрдпрдХреНрддрд┐рдЧрддрддрд╛ рдореВрд▓реНрдпрд╛рдВрдХрди рдФрд░ рдкреЗрдиреЗрдЯреНрд░реЗрд╢рди рдЯреЗрд╕реНрдЯрд┐рдВрдЧ рдХреЗ рд▓рд┐рдП рддреБрд░рдВрдд рдЙрдкрд▓рдмреНрдз рд╕реЗрдЯрдЕрдк**ред 20+ рдЯреВрд▓ рдФрд░ рд╕реБрд╡рд┐рдзрд╛рдУрдВ рдХреЗ рд╕рд╛рде рдПрдХ рдкреВрд░реНрдг рдкреЗрдирдЯреЗрд╕реНрдЯ рдЪрд▓рд╛рдПрдВ рдЬреЛ рдкреБрдирд░реАрдХреНрд╖рдг рд╕реЗ рд░рд┐рдкреЛрд░реНрдЯрд┐рдВрдЧ рддрдХ рдЬрд╛рддреЗ рд╣реИрдВред рд╣рдо рдкреЗрдирдЯреЗрд╕реНрдЯрд░реНрд╕ рдХреЛ рдмрджрд▓рдиреЗ рдирд╣реАрдВ рд╣реИрдВ - рд╣рдо рдЙрдиреНрд╣реЗрдВ рд╡рд╛рдкрд╕ рдХреБрдЫ рд╕рдордп рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд╕реНрдЯрдо рдЯреВрд▓, рдкрд╣рдЪрд╛рди рдФрд░ рд╢реЛрд╖рдг рдореЙрдбреНрдпреВрд▓ рд╡рд┐рдХрд╕рд┐рдд рдХрд░рддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рд╡реЗ рдЧрд╣рд░рд╛рдИ рдореЗрдВ рдЦреЛрдЬ рдХрд░рдиреЗ, рд╢реИрд▓реНрд╕ рдкреЙрдк рдХрд░рдиреЗ рдФрд░ рдордЬрд╝рд╛ рдХрд░рдиреЗ рдореЗрдВ рд╕рдорд░реНрде рд╣реЛрдВред

{% embed url="https://pentest-tools.com/" %}

## Missing root location <a href="#missing-root-location" id="missing-root-location"></a>

## **Nginx Root Directory рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛рдПрдБ**

Nginx рд╕рд░реНрд╡рд░ рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рддреЗ рд╕рдордп, **рд░реВрдЯ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛** рдорд╣рддреНрд╡рдкреВрд░реНрдг рднреВрдорд┐рдХрд╛ рдирд┐рднрд╛рддрд╛ рд╣реИ рдЬрд┐рд╕рд╕реЗ рдлрд╝рд╛рдЗрд▓реЗрдВ рд╕реЗрд╡рд╛ рдХреА рдЬрд╛рддреА рд╣реИрдВред рдиреАрдЪреЗ рджрд┐рдП рдЧрдП рдЙрджрд╛рд╣рд░рдг рдХреЛ рдзреНрдпрд╛рди рд╕реЗ рджреЗрдЦреЗрдВ:
```bash
server {
root /etc/nginx;

location /hello.txt {
try_files $uri $uri/ =404;
proxy_pass http://127.0.0.1:8080/;
}
}
```
рдЗрд╕ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдореЗрдВ, `/etc/nginx` рдХреЛ рдореВрд▓ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХреЗ рд░реВрдк рдореЗрдВ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред рдпрд╣ рд╕реЗрдЯрдЕрдк рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдореВрд▓ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХреЗ рднреАрддрд░ рдлрд╝рд╛рдЗрд▓реЛрдВ рддрдХ рдкрд╣реБрдБрдЪ рджреЗрддрд╛ рд╣реИ, рдЬреИрд╕реЗ `/hello.txt`ред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдорд╣рддреНрд╡рдкреВрд░реНрдг рдпрд╣рд╛рдБ рдзреНрдпрд╛рди рджреЗрдирд╛ рд╣реИ рдХрд┐ рдХреЗрд╡рд▓ рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рд╕реНрдерд╛рди (`/hello.txt`) рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред рдореВрд▓ рд╕реНрдерд╛рди рдХреЗ рд▓рд┐рдП рдХреЛрдИ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдирд╣реАрдВ рд╣реИ (`location / {...}`)ред рдпрд╣ рдЫреВрдЯ рдпрд╣ рджрд░реНрд╢рд╛рддреА рд╣реИ рдХрд┐ рдореВрд▓ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рд╡реИрд╢реНрд╡рд┐рдХ рд░реВрдк рд╕реЗ рд▓рд╛рдЧреВ рд╣реЛрддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рд░рд┐рдХреНрд╡реЗрд╕реНрдЯ `/` рдХреЗ рдореВрд▓ рдкрде рдХреЛ рдкрд╣реБрдБрдЪрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ рдФрд░ `/etc/nginx` рдХреЗ рдиреАрдЪреЗ рдлрд╝рд╛рдЗрд▓реЛрдВ рддрдХ рдкрд╣реБрдБрдЪрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред

рдЗрд╕ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рд╕реЗ рдПрдХ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╕реБрд░рдХреНрд╖рд╛ рд╡рд┐рдЪрд╛рд░ рдЙрдарддрд╛ рд╣реИред рдПрдХ рд╕рд╛рдзрд╛рд░рдг `GET` рд░рд┐рдХреНрд╡реЗрд╕реНрдЯ, рдЬреИрд╕реЗ `GET /nginx.conf`, `/etc/nginx/nginx.conf` рдкрд░ рд╕реНрдерд┐рдд Nginx рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓ рдХреЛ рд╕реЗрд╡ рдХрд░рдХреЗ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдЬрд╛рдирдХрд╛рд░реА рдХреЛ рдЙрдЬрд╛рдЧрд░ рдХрд░ рд╕рдХрддрд╛ рд╣реИред рдореВрд▓ рдХреЛ рдХрдо рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛, рдЬреИрд╕реЗ `/etc`, рдкрд░ рд╕реЗрдЯ рдХрд░рдирд╛ рдЗрд╕ рдЬреЛрдЦрд┐рдо рдХреЛ рдХрдо рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рдлрд┐рд░ рднреА рдпрд╣ рдЕрдирдЬрд╛рдиреЗ рдореЗрдВ рдЕрдиреНрдп рдорд╣рддреНрд╡рдкреВрд░реНрдг рдлрд╝рд╛рдЗрд▓реЛрдВ рддрдХ рдкрд╣реБрдБрдЪ рдХреА рдЕрдиреБрдорддрд┐ рджреЗ рд╕рдХрддрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рдЕрдиреНрдп рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓реЗрдВ, рдПрдХреНрд╕реЗрд╕ рд▓реЙрдЧ, рдФрд░ рдпрд╣рд╛рдБ рддрдХ рдХрд┐ HTTP рдмреЗрд╕рд┐рдХ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯреЗрдб рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рднреА рд╢рд╛рдорд┐рд▓ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред

## рдЙрдкрдирд╛рдо LFI рдЧрд▓рддрд┐рдпреЛрдВ <a href="#alias-lfi-misconfiguration" id="alias-lfi-misconfiguration"></a>

Nginx рдХреА рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓реЛрдВ рдореЗрдВ, "location" рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдПрдХ рдХрд░реАрдмреА рдЬрд╛рдВрдЪ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред рдПрдХ рд╕реБрд░рдХреНрд╖рд╛ рджреЛрд╖ рдЬрд┐рд╕реЗ рд╕реНрдерд╛рдиреАрдп рдлрд╝рд╛рдЗрд▓ рд╕рдорд╛рд╡реЗрд╢рди (LFI) рдХреЗ рд░реВрдк рдореЗрдВ рдЬрд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИ, рдПрдХ рдРрд╕реА рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЕрдирдЬрд╛рдиреЗ рдореЗрдВ рджрд╛рдЦрд┐рд▓ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреЗ рд╕рдорд╛рди рд╣реЛред
```
location /imgs {
alias /path/images/;
}
```
рдпрд╣ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди LFI рд╣рдорд▓реЛрдВ рдХреЗ рд▓рд┐рдП рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рд╕рд░реНрд╡рд░ `/imgs../flag.txt` рдЬреИрд╕реЗ рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ рдлрд╝рд╛рдЗрд▓реЛрдВ рддрдХ рдкрд╣реБрдБрдЪрдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдорд╛рдирддрд╛ рд╣реИ рдЬреЛ рдЗрдЪреНрдЫрд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдд рдирд┐рд░реНрдж
```
location /imgs/ {
alias /path/images/;
}
```
рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА: [https://www.acunetix.com/vulnerabilities/web/path-traversal-via-misconfigured-nginx-alias/](https://www.acunetix.com/vulnerabilities/web/path-traversal-via-misconfigured-nginx-alias/)

Accunetix рдЯреЗрд╕реНрдЯ:
```
alias../ => HTTP status code 403
alias.../ => HTTP status code 404
alias../../ => HTTP status code 403
alias../../../../../../../../../../../ => HTTP status code 400
alias../ => HTTP status code 403
```
## рдЕрд╕реБрд░рдХреНрд╖рд┐рдд рдкрде рдкреНрд░рддрд┐рдмрдВрдз <a href="#unsafe-variable-use" id="unsafe-variable-use"></a>

рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреГрд╖реНрда рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ рддрд╛рдХрд┐ рдЖрдк рдЬреИрд╕реЗ рдирд┐рд░реНрджреЗрд╢реЛрдВ рдХреЛ рдЕрдирджреЗрдЦрд╛ рдХрд░ рд╕рдХреЗрдВ:
```plaintext
location = /admin {
deny all;
}

location = /admin/ {
deny all;
}
```
## рдЕрд╕реБрд░рдХреНрд╖рд┐рдд рд╡реЗрд░рд┐рдПрдмрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ / рдПрдЪрдЯреАрдЯреАрдкреА рд░рд┐рдХреНрд╡реЗрд╕реНрдЯ рд╕реНрдкреНрд▓рд┐рдЯрд┐рдВрдЧ <a href="#unsafe-variable-use" id="unsafe-variable-use"></a>

{% hint style="danger" %}
рд╡рдВрд▓рд░реЗрдмрд▓ рд╡реЗрд░рд┐рдПрдмрд▓ `$uri` рдФрд░ `$document_uri` рд╣реИрдВ рдФрд░ рдЗрд╕реЗ `$request_uri` рд╕реЗ рдмрджрд▓рдХрд░ рдареАрдХ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

рд░реЗрдЧреЗрдХреНрд╕ рднреА рд╡рдВрд▓рд░реЗрдмрд▓ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рдЬреИрд╕реЗ:

`location ~ /docs/([^/])? { тАж $1 тАж }` - рд╡рдВрд▓рд░реЗрдмрд▓

`location ~ /docs/([^/\s])? { тАж $1 тАж }` - рд╡рдВрд▓рд░реЗрдмрд▓ рдирд╣реАрдВ (рдЕрдВрддрд░рд┐рдХреНрд╖ рдХреА рдЬрд╛рдВрдЪ)

`location ~ /docs/(.*)? { тАж $1 тАж }`  - рд╡рдВрд▓рд░реЗрдмрд▓ рдирд╣реАрдВ
{% endhint %}

Nginx рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдореЗрдВ рдПрдХ рд╡рдВрд▓рд░реЗрдмрд┐рд▓рд┐рдЯреА рдиреАрдЪреЗ рджрд┐рдП рдЧрдП рдЙрджрд╛рд╣рд░рдг рджреНрд╡рд╛рд░рд╛ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХреА рдЧрдИ рд╣реИ:
```
location / {
return 302 https://example.com$uri;
}
```
рд╡рд░реНрдг \r (рдХреИрд░рд┐рдЬ рд░рд┐рдЯрд░реНрди) рдФрд░ \n (рд▓рд╛рдЗрди рдлреАрдб) HTTP рдЕрдиреБрд░реЛрдзреЛрдВ рдореЗрдВ рдирдП рдкрдВрдХреНрддрд┐рдпреЛрдВ рдХреЛ рджрд░реНрд╢рд╛рддреЗ рд╣реИрдВ, рдФрд░ рдЙрдирдХреЗ URL-encoded рд░реВрдк `%0d%0a` рдХреЗ рд░реВрдк рдореЗрдВ рдкреНрд░рд╕реНрддреБрдд рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВред рдЗрди рд╡рд░реНрдгреЛрдВ рдХреЛ рдЕрдиреБрд░реЛрдз рдореЗрдВ рд╢рд╛рдорд┐рд▓ рдХрд░рдирд╛ (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, `http://localhost/%0d%0aDetectify:%20clrf`) рдПрдХ рдЧрд▓рдд рд░реВрдк рд╕реЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдП рдЧрдП рд╕рд░реНрд╡рд░ рдХреЛ рдПрдХ рдирдпрд╛ рд╣реЗрдбрд░ рдЬрд╛рд░реА рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкреНрд░реЗрд░рд┐рдд рдХрд░рддрд╛ рд╣реИред рдпрд╣ рдЗрд╕рд▓рд┐рдП рд╣реЛрддрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ $uri рдЪрд░ рдкрдВрдХреНрддрд┐рдпреЛрдВ рдХреЛ URL-encoded рдХрд░рддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рдПрдХ рдЕрдкреНрд░рддреНрдпрд╛рд╢рд┐рдд рд╣реЗрдбрд░ рдЙрддреНрдкрдиреНрди рд╣реЛрддрд╛ рд╣реИ:
```
HTTP/1.1 302 Moved Temporarily
Server: nginx/1.19.3
Content-Type: text/html
Content-Length: 145
Connection: keep-alive
Location: https://example.com/
Detectify: clrf
```
рдЬрд╛рдиреЗрдВ [https://blog.detectify.com/2019/06/14/http-response-splitting-exploitations-and-mitigations/](https://blog.detectify.com/2019/06/14/http-response-splitting-exploitations-and-mitigations/) рдкрд░ CRLF рдЗрдВрдЬреЗрдХреНрд╢рди рдФрд░ рд░рд┐рд╕реНрдкреЙрдиреНрд╕ рд╕реНрдкреНрд▓рд┐рдЯрд┐рдВрдЧ рдХреЗ рдЬреЛрдЦрд┐рдо рдХреЗ рдмрд╛рд░реЗ рдореЗрдВред

рдЗрд╕ рддрдХрдиреАрдХ рдХреЛ [**рдЗрд╕ рдЯреЙрдХ рдореЗрдВ рд╕рдордЭрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ**](https://www.youtube.com/watch?v=gWQyWdZbdoY\&list=PL0xCSYnG\_iTtJe2V6PQqamBF73n7-f1Nr\&index=77) рдХреБрдЫ рд╡рдВрд▓рд░рдмрд▓ рдЙрджрд╛рд╣рд░рдгреЛрдВ рдФрд░ рдкрд╣рдЪрд╛рди рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЗ рд╕рд╛рдеред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЗрд╕ рдорд┐рд╕рдХреЙрдиреНрдлрд┐рдЧрд░реЗрд╢рди рдХреЛ рдХрд╛рд▓рд╛ рдмреЙрдХреНрд╕ рджреГрд╖реНрдЯрд┐рдХреЛрдг рд╕реЗ рдкрд╣рдЪрд╛рдирдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдк рдЗрди рдЕрдиреБрд░реЛрдзреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

* `https://example.com/%20X` - рдХреЛрдИ рднреА HTTP рдХреЛрдб
* `https://example.com/%20H` - 400 рдмреИрдб рд░рд┐рдХреНрд╡реЗрд╕реНрдЯ

рдпрджрд┐ рд╡рдВрд▓рд░рдмрд▓ рд╣реИ, рддреЛ рдкрд╣рд▓рд╛ "X" рдХреЗ рд░реВрдк рдореЗрдВ рд▓реМрдЯреЗрдЧрд╛ рдХреНрдпреЛрдВрдХрд┐ рдХреЛрдИ рднреА HTTP рдореЗрдердб рд╣реИ рдФрд░ рджреВрд╕рд░рд╛ рддреНрд░реБрдЯрд┐ рдХреЗ рд░реВрдк рдореЗрдВ рд▓реМрдЯреЗрдЧрд╛ рдХреНрдпреЛрдВрдХрд┐ H рдПрдХ рдорд╛рдиреНрдп рдореЗрдердб рдирд╣реАрдВ рд╣реИред рдЗрд╕рд▓рд┐рдП рд╕рд░реНрд╡рд░ рдХреБрдЫ рдЗрд╕ рдкреНрд░рдХрд╛рд░ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдЧрд╛: `GET / H HTTP/1.1` рдФрд░ рдпрд╣ рддреНрд░реБрдЯрд┐ рдХреЛ рдЯреНрд░рд┐рдЧрд░ рдХрд░реЗрдЧрд╛ред

рдПрдХ рдФрд░ рдкрд╣рдЪрд╛рди рдЙрджрд╛рд╣рд░рдг рд╣реЛ рд╕рдХрддрд╛ рд╣реИ:

* `http://company.tld/%20HTTP/1.1%0D%0AXXXX:%20x` - рдХреЛрдИ рднреА HTTP рдХреЛрдб
* `http://company.tld/%20HTTP/1.1%0D%0AHost:%20x` - 400 рдмреИрдб рд░рд┐рдХреНрд╡реЗрд╕реНрдЯ

рдЙрд╕ рдЯреЙрдХ рдореЗрдВ рдкреНрд░рд╕реНрддреБрдд рдХреБрдЫ рд╡рдВрд▓рд░рдмрд▓ рдХреЙрдиреНрдлрд┐рдЧрд░реЗрд╢рди рдЙрджрд╛рд╣рд░рдг рдереЗ:

* рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ **`$uri`** рдЕрдВрддрд┐рдо URL рдореЗрдВ рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред
```
location ^~ /lite/api/ {
proxy_pass http://lite-backend$uri$is_args$args;
}
```
* рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдлрд┐рд░ рд╕реЗ **`$uri`** URL рдореЗрдВ рд╣реИ (рдЗрд╕ рдмрд╛рд░ рдкреИрд░рд╛рдореАрдЯрд░ рдХреЗ рдЕрдВрджрд░)
```
location ~ ^/dna/payment {
rewrite ^/dna/([^/]+) /registered/main.pl?cmd=unifiedPayment&context=$1&native_uri=$uri break;
proxy_pass http://$back;
```
* рдЕрдм AWS S3 рдореЗрдВ
```
location /s3/ {
proxy_pass https://company-bucket.s3.amazonaws.com$uri;
}
```
### рдХреЛрдИ рднреА рдЪрд░

рдкрд╛рдпрд╛ рдЧрдпрд╛ рдХрд┐ **рдЙрдкрдпреЛрдХреНрддрд╛ рджреНрд╡рд╛рд░рд╛ рдкреНрд░рджрддреНрдд рдбреЗрдЯрд╛** рдХреЛ рдХреБрдЫ рдкрд░рд┐рд╕реНрдерд┐рддрд┐рдпреЛрдВ рдХреЗ рддрд╣рдд рдПрдХ **Nginx рдЪрд░** рдХреЗ рд░реВрдк рдореЗрдВ рд╡реНрдпрд╡рд╣рд╛рд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдЗрд╕ рд╡реНрдпрд╡рд╣рд╛рд░ рдХрд╛ рдХрд╛рд░рдг рдХреБрдЫ рд╣рдж рддрдХ рдЕрдЬреНрдЮрд╛рдд рд╣реИ, рдлрд┐рд░ рднреА рдпрд╣ рдЕрджреНрднреБрдд рдирд╣реАрдВ рд╣реИ рдФрд░ рд╕реНрдкрд╖реНрдЯреАрдХреГрдд рдХрд░рдирд╛ рд╕рд░рд▓ рдирд╣реАрдВ рд╣реИред рдЗрд╕ рд╡рд┐рд╕рдВрдЧрддрд┐ рдХреЛ рд╣реИрдХрд░рд╡рди рдореЗрдВ рдПрдХ рд╕реБрд░рдХреНрд╖рд╛ рд░рд┐рдкреЛрд░реНрдЯ рдореЗрдВ рдЙрдЬрд╛рдЧрд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛, рдЬрд┐рд╕реЗ [рдпрд╣рд╛рдБ](https://hackerone.com/reports/370094) рджреЗрдЦрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рддреНрд░реБрдЯрд┐ рд╕рдВрджреЗрд╢ рдХреА рдЕрдзреНрдпрдпрди рдХреЗ рдмрд╛рдж рдФрд░ рдЙрд╕рдХреА рдкрд╣рдЪрд╛рди рдХреЗ рдмрд╛рдж, [Nginx рдХреЛрдбрдмреЗрд╕ рдХреЗ SSI рдлрд╝рд┐рд▓реНрдЯрд░ рдореЙрдбреНрдпреВрд▓](https://github.com/nginx/nginx/blob/2187586207e1465d289ae64cedc829719a048a39/src/http/modules/ngx\_http\_ssi\_filter\_module.c#L365) рдореЗрдВ рдЗрд╕рдХреЗ рдкреНрд░рд╛рд░рдВрднрд┐рдХ рдХрд╛рд░рдг рдХреЗ рд░реВрдк рдореЗрдВ рд╕рд░реНрд╡рд░ рд╕рд╛рдЗрдб рд╕рдореНрдорд┐рд▓рд┐рдд рдХреЛ рдирд┐рд╢рд╛рдирд╛рдмрджреНрдз рдХрд┐рдпрд╛ред

рдЗрд╕ рдЧрд▓рдд рд╡рд┐рдиреНрдпрд╛рд╕ рдХреЛ **рдкрд╣рдЪрд╛рдирдиреЗ** рдХреЗ рд▓рд┐рдП, рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрдорд╛рдВрдб рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рдПрдХ рд░реЗрдлрд╝рд░ рд╣реЗрдбрд░ рд╕реЗрдЯ рдХрд░рдирд╛ рд╢рд╛рдорд┐рд▓ рд╣реИ рддрд╛рдХрд┐ рдЪрд░ рдкреНрд░рд┐рдВрдЯ рдХрд░рдиреЗ рдХрд╛ рдкрд░реАрдХреНрд╖рдг рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗ:
```bash
$ curl -H тАШReferer: barтАЩ http://localhost/foo$http_referer | grep тАШfoobarтАЩ
```
рдЗрд╕ рдорд┐рд╕рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХреЗ рд▓рд┐рдП рд╕рд┐рд╕реНрдЯрдореНрд╕ рдХреЗ рдЕрдзреНрдпрдпрди рдореЗрдВ рдХрдИ рд╕реНрдерд┐рддрд┐рдпрд╛рдБ рдкреНрд░рдХрдЯ рд╣реБрдИрдВ рдЬрд╣рд╛рдБ Nginx рдЪрд░ рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рджреНрд╡рд╛рд░рд╛ рдкреНрд░рд┐рдВрдЯ рдХрд┐рдП рдЬрд╛ рд╕рдХрддреЗ рдереЗред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдПрдХ рд╕рдВрд╡рд┐рджрд╛рдирд╢реАрд▓рддрд╛ рдХреА рд╕рдВрдЦреНрдпрд╛ рдореЗрдВ рдХрдореА рдЗрд╕ рд╕реБрдЭрд╛рд╡ рдХреЛ рджреЗрддреА рд╣реИ рдХрд┐ рдЗрд╕ рдореБрджреНрджреЗ рдХреЛ рд╕реБрдзрд╛рд░рдиреЗ рдХреЗ рдкреНрд░рдпрд╛рд╕ рд╕рд╛рдЭреЗрджрд╛рд░реА рд╕реЗ рд╕рдлрд▓ рд░рд╣реЗ рд╣реИрдВред

## рд░реЙ рдмреИрдХрдПрдВрдб рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдкрдарди

Nginx `proxy_pass` рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдПрдХ рд╕реБрд╡рд┐рдзрд╛ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ рдЬреЛ рдмреИрдХрдПрдВрдб рджреНрд╡рд╛рд░рд╛ рдЙрддреНрдкрдиреНрди рддреНрд░реБрдЯрд┐рдпреЛрдВ рдФрд░ HTTP рд╣реЗрдбрд░ рдХрд╛ рдЕрд╡рд░реЛрдзрдг рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИ, рдЬрд┐рд╕рдХрд╛ рдЙрджреНрджреЗрд╢реНрдп рдЖрдВрддрд░рд┐рдХ рддреНрд░реБрдЯрд┐ рд╕рдВрджреЗрд╢реЛрдВ рдФрд░ рд╣реЗрдбрд░ рдХреЛ рдЫреБрдкрд╛рдирд╛ рд╣реИред рдЗрд╕реЗ Nginx рджреНрд╡рд╛рд░рд╛ рдмреИрдХрдПрдВрдб рддреНрд░реБрдЯрд┐рдпреЛрдВ рдХреЗ рдкреНрд░рддрд┐ рдХрд╕реНрдЯрдо рддреНрд░реБрдЯрд┐ рдкреГрд╖реНрда рд╕реЗрд╡рд┐рдд рдХрд░рдХреЗ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЪреБрдиреМрддрд┐рдпрд╛рдБ рдЙрддреНрдкрдиреНрди рд╣реЛрддреА рд╣реИрдВ рдЬрдм Nginx рдПрдХ рдЕрдорд╛рдиреНрдп HTTP рдЕрдиреБрд░реЛрдз рдХрд╛ рд╕рд╛рдордирд╛ рдХрд░рддрд╛ рд╣реИред рдРрд╕рд╛ рдЕрдиреБрд░реЛрдз рдкреНрд░рд╛рдкреНрдд рд╣реЛрдиреЗ рдкрд░ рдмреИрдХрдПрдВрдб рдХреЛ рдЕрдЧреНрд░реЗрд╖рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдФрд░ рдлрд┐рд░ Nginx рдХреА рд╣рд╕реНрддрдХреНрд╖реЗрдк рдХреЗ рдмрд┐рдирд╛ рдмреИрдХрдПрдВрдб рдХреА рд░реЙ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рд╕реАрдзреЗ рдХреНрд▓рд╛рдЗрдВрдЯ рдХреЛ рднреЗрдЬ рджреА рдЬрд╛рддреА рд╣реИред

рдПрдХ uWSGI рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рдПрдХ рдЙрджрд╛рд╣рд░рдг рд╕реНрдерд┐рддрд┐ рдХрд╛ рд╡рд┐рдЪрд╛рд░ рдХрд░реЗрдВ:
```python
def application(environ, start_response):
start_response('500 Error', [('Content-Type', 'text/html'), ('Secret-Header', 'secret-info')])
return [b"Secret info, should not be visible!"]
```
рдЗрд╕реЗ рдкреНрд░рдмрдВрдзрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, Nginx рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдореЗрдВ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛рдПрдБ рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛рддреА рд╣реИрдВ:
```
http {
error_page 500 /html/error.html;
proxy_intercept_errors on;
proxy_hide_header Secret-Header;
}
```
* [**proxy\_intercept\_errors**](http://nginx.org/en/docs/http/ngx\_http\_proxy\_module.html#proxy\_intercept\_errors): рдпрд╣ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ Nginx рдХреЛ рдмреИрдХрдПрдВрдб рдЬрд╡рд╛рдмреЛрдВ рдХреЗ рд▓рд┐рдП рдПрдХ рдХрд╕реНрдЯрдо рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдкреНрд░рджрд╛рди рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИ рдЬрд┐рдирдХрд╛ рд╕реНрдерд┐рддрд┐ рдХреЛрдб 300 рд╕реЗ рдЕрдзрд┐рдХ рд╣реИред рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ рд╣рдорд╛рд░реЗ рдЙрджрд╛рд╣рд░рдг uWSGI рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЗ рд▓рд┐рдП, `500 рддреНрд░реБрдЯрд┐` рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдХреЛ Nginx рджреНрд╡рд╛рд░рд╛ рд░реЛрдХрд╛ рдФрд░ рд╕рдВрднрд╛рд▓рд╛ рдЬрд╛рддрд╛ рд╣реИред
* [**proxy\_hide\_header**](http://nginx.org/en/docs/http/ngx\_http\_proxy\_module.html#proxy\_hide\_header): рдЬреИрд╕рд╛ рдирд╛рдо рд╕реБрдЭрд╛рддрд╛ рд╣реИ, рдпрд╣ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдЧреНрд░рд╛рд╣рдХ рд╕реЗ рдирд┐рд░реНрджрд┐рд╖реНрдЯ HTTP рд╣реЗрдбрд░ рдХреЛ рдЫреБрдкрд╛рддреА рд╣реИ, рдЧреЛрдкрдиреАрдпрддрд╛ рдФрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХреЛ рдмрдврд╝рд╛рддреА рд╣реИред

рдЬрдм рдПрдХ рд╡реИрдз `GET` рдЕрдиреБрд░реЛрдз рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ Nginx рдЗрд╕реЗ рд╕рд╛рдорд╛рдиреНрдп рд░реВрдк рд╕реЗ рдкреНрд░рд╕рдВрд╕реНрдХрд░рдг рдХрд░рддрд╛ рд╣реИ, рдХрд┐рд╕реА рднреА рдЧреБрдкреНрдд рд╣реЗрдбрд░ рдХреЛ рдЙрдЬрд╛рдЧрд░ рди рдХрд░рддреЗ рд╣реБрдП рдПрдХ рдорд╛рдирдХ рддреНрд░реБрдЯрд┐ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рд╡рд╛рдкрд╕ рджреЗрддрд╛ рд╣реИред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдПрдХ рдЕрд╡реИрдз HTTP рдЕрдиреБрд░реЛрдз рдЗрд╕ рддрдВрддреНрд░ рдХреЛ рдЕрдирджреЗрдЦрд╛ рдХрд░рддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдХрд┐ рд░реЙ рдмреИрдХрдПрдВрдб рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛рдПрдБ рдЙрдЬрд╛рдЧрд░ рд╣реЛрддреА рд╣реИрдВ, рдЧреБрдкреНрдд рд╣реЗрдбрд░ рдФрд░ рддреНрд░реБрдЯрд┐ рд╕рдВрджреЗрд╢реЛрдВ рд╕рд╣рд┐рддред

## merge\_slashes set to off

рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ, Nginx рдХрд╛ **`merge_slashes` рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛** **`on`** рдкрд░ рд╕реЗрдЯ рд╣реЛрддрд╛ рд╣реИ, рдЬреЛ рдПрдХ URL рдореЗрдВ рдХрдИ рдлреЙрд░рд╡рд░реНрдб рд╕реНрд▓реИрд╢ рдХреЛ рдПрдХ рд╣реА рд╕реНрд▓реИрд╢ рдореЗрдВ рд╕рдВрдХреНрд╖реЗрдкрд┐рдд рдХрд░рддрд╛ рд╣реИред рдпрд╣ рд╕реБрд╡рд┐рдзрд╛, URL рдкреНрд░рд╕рдВрд╕реНрдХрд░рдг рдХреЛ рд╕реБрдЧрдо рдмрдирд╛рдиреЗ рдХреЗ рдмрд╛рд╡рдЬреВрдж, Nginx рдХреЗ рдкреАрдЫреЗ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдореЗрдВ рдЧреБрдкреНрдд рдлрд╝рд╛рдЗрд▓ рд╕рдорд╛рд╡реЗрд╢ (LFI) рд╣рдорд▓реЛрдВ рдХреЗ рдкреНрд░рддрд┐ рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдЕрдиреБрдкреНрд░рдпреЛрдЧреЛрдВ рдХреЛ рдЫреБрдкрд╛ рд╕рдХрддрд╛ рд╣реИред рд╕реБрд░рдХреНрд╖рд╛ рд╡рд┐рд╢реЗрд╖рдЬреНрдЮ **рдбреИрдиреА рд░реЙрдмрд┐рдВрд╕рди рдФрд░ рд░реЛрдЯреЗрдо рдмрд╛рд░** рдиреЗ рдЗрд╕ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд╡реНрдпрд╡рд╣рд╛рд░ рдХреЗ рд╕рд╛рде рдЬреБрдбрд╝реА рд╕рдВрднрд╛рд╡рд┐рдд рдЬреЛрдЦрд┐рдореЛрдВ рдХреЛ рдЙрдЬрд╛рдЧрд░ рдХрд┐рдпрд╛ рд╣реИ, рд╡рд┐рд╢реЗрд╖рдХрд░ рдЬрдм Nginx рдПрдХ рд░рд┐рд╡рд░реНрд╕-рдкреНрд░реЙрдХреНрд╕реА рдХреЗ рд░реВрдк рдореЗрдВ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИред

рдЗрд╕ рдкреНрд░рдХрд╛рд░ рдХреЗ рдЬреЛрдЦрд┐рдореЛрдВ рдХреЛ рдХрдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЗрд╕реЗ рд╕реБрдЭрд╛рд╡ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдХрд┐ **`merge_slashes` рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХреЛ рдмрдВрдж рдХрд░ рджрд┐рдпрд╛ рдЬрд╛рдП** рдЬрд┐рди рдЕрдиреБрдкреНрд░рдпреЛрдЧреЛрдВ рдХреЗ рдкреНрд░рддрд┐ рдпрд╣ рдЬреЛрдЦрд┐рдо рдкреНрд░рднрд╛рд╡рд┐рдд рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред рдЗрд╕рд╕реЗ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рд╣реЛрддрд╛ рд╣реИ рдХрд┐ Nginx рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ рдЕрдиреБрдкреНрд░рдпреЛрдЧ рдХреЛ рдмрд┐рдирд╛ URL рд╕рдВрд░рдЪрдирд╛ рдХреЛ рдмрджрд▓реЗ рдЖрдЧреЗ рднреЗрдЬрддрд╛ рд╣реИ, рдЗрд╕рд╕реЗ рдХрд┐рд╕реА рднреА рдЕрдВрддрд░реНрдирд┐рд╣рд┐рдд рд╕реБрд░рдХреНрд╖рд╛ рдореБрджреНрджреЛрдВ рдХреЛ рдЫреБрдкрд╛рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдирд╣реАрдВ рдХрд░рддрд╛ред

рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП [рдбреИрдиреА рд░реЙрдмрд┐рдВрд╕рди рдФрд░ рд░реЛрдЯреЗрдо рдмрд╛рд░](https://medium.com/appsflyer/nginx-may-be-protecting-your-applications-from-traversal-attacks-without-you-even-knowing-b08f882fd43d) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВред

### **рдорд╛рдирдЪрд┐рддреНрд░ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдореЗрдВ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдорд╛рди**

**Nginx рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди** рдореЗрдВ, `map` рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдЕрдХреНрд╕рд░ **рдЕрдзрд┐рдХреГрддрд┐ рдирд┐рдпрдВрддреНрд░рдг** рдореЗрдВ рдПрдХ рднреВрдорд┐рдХрд╛ рдирд┐рднрд╛рддреА рд╣реИред рдПрдХ рд╕рд╛рдорд╛рдиреНрдп рдЧрд▓рддреА рдПрдХ **рдбрд┐рдлрд╝реЙрд▓реНрдЯ** рдорд╛рди рдирд┐рд░реНрджрд┐рд╖реНрдЯ рди рдХрд░рдирд╛ рд╣реИ, рдЬреЛ рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ рдХреА рдУрд░ рд▓реЗ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП:
```yaml
http {
map $uri $mappocallow {
/map-poc/private 0;
/map-poc/secret 0;
/map-poc/public 1;
}
}
```

```yaml
server {
location /map-poc {
if ($mappocallow = 0) {return 403;}
return 200 "Hello. It is private area: $mappocallow";
}
}
```
рдмрд┐рдирд╛ `default` рдХреЗ, рдПрдХ **рд╣рд╛рдирд┐рдХрд╛рд░рдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛** рд╕реБрд░рдХреНрд╖рд╛ рдХреЛ рдЫрд▓рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ `/map-poc` рдХреЗ рднреАрддрд░ **рдЕрдкрд░рд┐рднрд╛рд╖рд┐рдд URI** рддрдХ рдкрд╣реБрдВрдЪрдХрд░ред [Nginx рдореИрдиреБрдЕрд▓](https://nginx.org/en/docs/http/ngx\_http\_map\_module.html) рдпрд╣ рд╕рд▓рд╛рд╣ рджреЗрддрд╛ рд╣реИ рдХрд┐ рдЗрд╕ рддрд░рд╣ рдХреА рд╕рдорд╕реНрдпрд╛рдУрдВ рд╕реЗ рдмрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ **рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдорд╛рди** рд╕реЗрдЯ рдХрд░реЗрдВред

### **DNS рд╕реНрдкреВрдлрд┐рдВрдЧ рд╕реБрд░рдХреНрд╖рд╛рддреНрдордХрддрд╛**

рдирд┐рд╢реНрдЪрд┐рдд рдкрд░рд┐рд╕реНрдерд┐рддрд┐рдпреЛрдВ рдХреЗ рддрд╣рдд Nginx рдХреЗ рдЦрд┐рд▓рд╛рдл DNS рд╕реНрдкреВрдлрд┐рдВрдЧ рд╕рдВрднрд╡ рд╣реИред рдпрджрд┐ рдПрдХ рд╣рдорд▓рд╛рд╡рд░ Nginx рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ **DNS рд╕рд░реНрд╡рд░** рдХреЛ рдЬрд╛рдирддрд╛ рд╣реИ рдФрд░ рдЙрд╕рдХреЗ DNS рдХреНрд╡реЗрд░реА рдХреЛ рдЖрддреНрдорд╕рд╛рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рддреЛ рд╡рд╣ DNS рд░рд┐рдХреЙрд░реНрдб рдХреЛ рд╕реНрдкреВрдлрд╝ рдХрд░ рд╕рдХрддрд╛ рд╣реИред рдпрд╣ рд╡рд┐рдзрд┐, рд╣рд╛рд▓рд╛рдВрдХрд┐, Nginx рдХреЛ DNS рд╕рдВрдХрд▓рди рдХреЗ рд▓рд┐рдП **localhost (127.0.0.1)** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рддреЛ рдЕрд╕рдлрд▓ рд╣реЛрддрд╛ рд╣реИред Nginx рдХреЛ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреНрд░рдХрд╛рд░ рд╕реЗ рдПрдХ DNS рд╕рд░реНрд╡рд░ рдХреА рдирд┐рд░реНрджрд┐рд╖реНрдЯрд┐ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ:
```yaml
resolver 8.8.8.8;
```
### **`proxy_pass` рдФрд░ `internal` рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛рдПрдБ**

**`proxy_pass`** рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдЕрдиреНрдп рд╕рд░реНрд╡рд░реЛрдВ рдХреЛ рдЕрдиреНрдпрд╛рдиреНрдп рдпрд╛ рдмрд╛рд╣рд░реА рд░реВрдк рд╕реЗ рдкреБрдирд░реНрдирд┐рд░реНрджреЗрд╢рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред **`internal`** рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддреА рд╣реИ рдХрд┐ рдХреБрдЫ рд╕реНрдерд╛рди рдХреЗрд╡рд▓ Nginx рдХреЗ рднреАрддрд░ рд╣реА рдкрд╣реБрдВрдЪрдиреЗ рдпреЛрдЧреНрдп рд╣реИрдВред рдпреЗ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛рдПрдБ рд╕реНрд╡рдпрдВ рдореЗрдВ рдХреЛрдИ рд╕реБрд░рдХреНрд╖рд╛ рджреЛрд╖ рдирд╣реАрдВ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдЗрдирдХреА рд╡рд┐рдиреНрдпрд╛рд╕ рдХреА рдЬрд╛рдВрдЪ рдХреЛ рд╕рд╛рд╡рдзрд╛рдиреА рд╕реЗ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП рддрд╛рдХрд┐ рд╕реБрд░рдХреНрд╖рд╛ рдХреА рдХрдореА рд╕реЗ рдмрдЪрд╛ рдЬрд╛ рд╕рдХреЗред

## proxy\_set\_header Upgrade рдФрд░ Connection

рдпрджрд┐ nginx рд╕рд░реНрд╡рд░ рдХреЛ Upgrade рдФрд░ Connection рд╣реЗрдбрд░ рдкрд╛рд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рддреЛ [**h2c Smuggling attack**](../../pentesting-web/h2c-smuggling.md) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рддрд╛рдХрд┐ рд╕рдВрд░рдХреНрд╖рд┐рдд/рдЖрдВрддрд░рд┐рдХ рдЕрдВрддрдмрд┐рдВрджреБ рддрдХ рдкрд╣реБрдВрдЪрд╛ рдЬрд╛ рд╕рдХреЗред

{% hint style="danger" %}
рдпрд╣ рд╕реБрд░рдХреНрд╖рд╛ рджреЛрд╖ рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдХреЛ **`proxy_pass` рдЕрдВрддрдмрд┐рдВрджреБ** (`http://backend:9999` рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ) рдХреЗ рд╕рд╛рде рд╕реАрдзрд╛ рдХрдиреЗрдХреНрд╢рди рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдЧрд╛ рдЬрд┐рд╕рдХреА рд╕рд╛рдордЧреНрд░реА рдХреЛ nginx рджреНрд╡рд╛рд░рд╛ рдЬрд╛рдВрдЪрд╛ рдирд╣реАрдВ рдЬрд╛рдПрдЧрд╛ред
{% endhint %}

рдЪреЛрд░реА рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╡рд┐рдХрд▓реНрдкрд┐рдд рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХрд╛ рдЙрджрд╛рд╣рд░рдг `/flag` рд╕реЗ [рдпрд╣рд╛рдБ](https://bishopfox.com/blog/h2c-smuggling-request) рдЪреБрд░рд╛рдиреЗ рдХреЗ рд▓рд┐рдП:
```
server {
listen       443 ssl;
server_name  localhost;

ssl_certificate       /usr/local/nginx/conf/cert.pem;
ssl_certificate_key   /usr/local/nginx/conf/privkey.pem;

location / {
proxy_pass http://backend:9999;
proxy_http_version 1.1;
proxy_set_header Upgrade $http_upgrade;
proxy_set_header Connection $http_connection;
}

location /flag {
deny all;
}
```
{% hint style="warning" %}
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдпрджрд┐ `proxy_pass` рдХрд┐рд╕реА рд╡рд┐рд╢рд┐рд╖реНрдЯ **рдкрде** рдХреА рдУрд░ рдЗрд╢рд╛рд░рд╛ рдХрд░ рд░рд╣рд╛ рдерд╛ рдЬреИрд╕реЗ `http://backend:9999/socket.io` рддреЛ рдХрдиреЗрдХреНрд╢рди `http://backend:9999` рдХреЗ рд╕рд╛рде рд╕реНрдерд╛рдкрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ рддрд╛рдХрд┐ рдЖрдк **рдЙрд╕ рдЖрдВрддрд░рд┐рдХ рдЕрдВрддрдмрд┐рдВрджреБ рдХреЗ рднреАрддрд░ рдХрд┐рд╕реА рдЕрдиреНрдп рдкрде рд╕реЗ рд╕рдВрдкрд░реНрдХ рдХрд░ рд╕рдХреЗрдВред рдЗрд╕рд▓рд┐рдП рдпрджрд┐ proxy\_pass рдХреЗ URL рдореЗрдВ рдХреЛрдИ рдкрде рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рддреЛ рдЗрд╕рдХрд╛ рдорд╛рдпрдирд╛ рдирд╣реАрдВ рд╣реИред**
{% endhint %}

## рдЦреБрдж рд╕реЗ рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдВ

Detectify рдиреЗ рдПрдХ GitHub рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдмрдирд╛рдИ рд╣реИ рдЬрд╣рд╛рдВ рдЖрдк Docker рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЕрдкрдиреА рдЦреБрдж рдХреА рд╡рдВрд▓рд░реЗрдмрд▓ Nginx рдкрд░реАрдХреНрд╖рдг рд╕рд░реНрд╡рд░ рдХреЛ рд╕реЗрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд┐рд╕рдореЗрдВ рдЗрд╕ рд▓реЗрдЦ рдореЗрдВ рдЪрд░реНрдЪрд╛ рдХреА рдЧрдИ рдХреБрдЫ рдЧрд▓рддрд┐рдпреЛрдВ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ!

[https://github.com/detectify/vulnerable-nginx](https://github.com/detectify/vulnerable-nginx)

## рд╕реНрдерд┐рд░ рд╡рд┐рд╢реНрд▓реЗрд╖рдХ рдЙрдкрдХрд░рдг

### [GIXY](https://github.com/yandex/gixy)

Gixy рдПрдХ рдЙрдкрдХрд░рдг рд╣реИ рдЬреЛ Nginx рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣реИред Gixy рдХрд╛ рдореБрдЦреНрдп рд▓рдХреНрд╖реНрдп рд╕реБрд░рдХреНрд╖рд╛ рдЧрд▓рддрд┐рдпреЛрдВ рдХреЛ рд░реЛрдХрдирд╛ рдФрд░ рджреЛрд╖ рдХреА рдЦреЛрдЬ рдХреЛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдХрд░рдирд╛ рд╣реИред

### [Nginxpwner](https://github.com/stark0de/nginxpwner)

Nginxpwner рдПрдХ рд╕рд░рд▓ рдЙрдкрдХрд░рдг рд╣реИ рдЬреЛ рд╕рд╛рдорд╛рдиреНрдп Nginx рдЧрд▓рддрд┐рдпреЛрдВ рдФрд░ рд╕реБрд░рдХреНрд╖рд╛ рд╡рд┐рдлрд▓рддрд╛рдУрдВ рдХреА рдЦреЛрдЬ рдХреЗ рд▓рд┐рдП рд╣реИред

## рд╕рдВрджрд░реНрдн

* [**https://blog.detectify.com/2020/11/10/common-nginx-misconfigurations/**](https://blog.detectify.com/2020/11/10/common-nginx-misconfigurations/)
* [**http://blog.zorinaq.com/nginx-resolver-vulns/**](http://blog.zorinaq.com/nginx-resolver-vulns/)
* [**https://github.com/yandex/gixy/issues/115**](https://github.com/yandex/gixy/issues/115)

<figure><img src="../../.gitbook/assets/image (2) (1).png" alt=""><figcaption></figcaption></figure>

**рд╡рд┐рдХрд▓реНрдк рдЙрдкрд▓рдмреНрдз рд╕реЗрдЯрдЕрдк рд╡рд┐рдХрд▓реНрдкрдиреАрдпрддрд╛ рдореВрд▓реНрдпрд╛рдВрдХрди рдФрд░ рдкреЗрдиреЗрдЯреНрд░реЗрд╢рди рдЯреЗрд╕реНрдЯрд┐рдВрдЧ рдХреЗ рд▓рд┐рдП**ред рдХрд╣реАрдВ рд╕реЗ рднреА 20+ рдЙрдкрдХрд░рдг рдФрд░ рд╕реБрд╡рд┐рдзрд╛рдУрдВ рдХреЗ рд╕рд╛рде рдПрдХ рдкреВрд░реНрдг рдкреЗрдВрдЯреЗрд╕реНрдЯ рдЪрд▓рд╛рдПрдВ рдЬреЛ рдкреБрдирд░реАрдХреНрд╖рдг рд╕реЗ рд░рд┐рдкреЛрд░реНрдЯрд┐рдВрдЧ рддрдХ рдЬрд╛рддреЗ рд╣реИрдВред рд╣рдо рдкреЗрдВрдЯреЗрд╕реНрдЯрд░реНрд╕ рдХреЛ рдмрджрд▓рдиреЗ рдирд╣реАрдВ рд╣реИрдВ - рд╣рдо рдЙрдиреНрд╣реЗрдВ рд╡рд╛рдкрд╕ рдХреБрдЫ рд╕рдордп рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд╕реНрдЯрдо рдЙрдкрдХрд░рдг, рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдФрд░ рд╢реЛрд╖рдг рдореЙрдбреНрдпреВрд▓ рд╡рд┐рдХрд╕рд┐рдд рдХрд░рддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рд╡реЗ рдЧрд╣рд░рд╛рдИ рдореЗрдВ рдЦреЛрдЬ рдХрд░ рд╕рдХреЗрдВ, рд╢реИрд▓реНрд╕ рдкреЙрдк рдХрд░ рд╕рдХреЗрдВ, рдФрд░ рдордЬрд╝рд╛ рдХрд░ рд╕рдХреЗрдВред

{% embed url="https://pentest-tools.com/" %}

<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб** рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рдХрд▓реЗрдХреНрд╢рди [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдЦреЛрдЬреЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@carlospolopm**](https://twitter.com/hacktricks\_live)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ** рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдФрд░ рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдХреНрд▓рд╛рдЙрдб рдЧрд┐рдЯрд╣рдм рд░реЗрдкреЛ рдореЗрдВ PR рдЬрдорд╛ рдХрд░рдХреЗред

</details>
