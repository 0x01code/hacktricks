# Nginx

<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

рджреВрд╕рд░реЗ рддрд░реАрдХреЗ HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП:

* рдЕрдЧрд░ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕ рджреЗрдЦреЗрдВ**](https://github.com/sponsors/carlospolop)!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@carlospolopm**](https://twitter.com/hacktricks_live)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ** рджреНрд╡рд╛рд░рд╛ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВред

</details>

<figure><img src="/.gitbook/assets/image (2).png" alt=""><figcaption></figcaption></figure>

**рддрддреНрдХрд╛рд▓ рдЙрдкрд▓рдмреНрдз рд╕реЗрдЯрдЕрдк рд╡реНрдпрдХреНрддрд┐рдЧрддрддрд╛ рдореВрд▓реНрдпрд╛рдВрдХрди рдФрд░ рдкреЗрдиреЗрдЯреНрд░реЗрд╢рди рдЯреЗрд╕реНрдЯрд┐рдВрдЧ рдХреЗ рд▓рд┐рдП**ред рдХрд╣реАрдВ рд╕реЗ рднреА 20+ рдЯреВрд▓реНрд╕ рдФрд░ рд╕реБрд╡рд┐рдзрд╛рдУрдВ рдХреЗ рд╕рд╛рде рдкреВрд░реНрдг рдкреЗрдирдЯреЗрд╕реНрдЯ рдЪрд▓рд╛рдПрдВ рдЬреЛ рдкреБрдирд░реАрдХреНрд╖рдг рд╕реЗ рд░рд┐рдкреЛрд░реНрдЯрд┐рдВрдЧ рддрдХ рдЬрд╛рддреЗ рд╣реИрдВред рд╣рдо рдкреЗрдирдЯреЗрд╕реНрдЯрд░реНрд╕ рдХреЛ рдмрджрд▓рдиреЗ рдирд╣реАрдВ - рд╣рдо рдЙрдиреНрд╣реЗрдВ рд╡рд╛рдкрд╕ рдХреБрдЫ рд╕рдордп рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд╕реНрдЯрдо рдЯреВрд▓реНрд╕, рдкрд╣рдЪрд╛рди рдФрд░ рд╢реЛрд╖рдг рдореЙрдбреНрдпреВрд▓ рд╡рд┐рдХрд╕рд┐рдд рдХрд░рддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рд╡реЗ рдЧрд╣рд░рд╛рдИ рдореЗрдВ рдЦреЛрдЬ рдХрд░ рд╕рдХреЗрдВ, рд╢реИрд▓реНрд╕ рдкреЙрдк рдХрд░ рд╕рдХреЗрдВ, рдФрд░ рдордЬрд╝рд╛ рдХрд░ рд╕рдХреЗрдВред

{% embed url="https://pentest-tools.com/" %}

## Missing root location <a href="#missing-root-location" id="missing-root-location"></a>

## **Nginx Root Directory рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛рдПрдВ**

Nginx рд╕рд░реНрд╡рд░ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рддреЗ рд╕рдордп, **root directive** рдорд╣рддреНрд╡рдкреВрд░реНрдг рднреВрдорд┐рдХрд╛ рдирд┐рднрд╛рддрд╛ рд╣реИ рдЬрд┐рд╕рд╕реЗ рдлрд╝рд╛рдЗрд▓реЗрдВ рд╕реЗрд╡рд╛ рдХреА рдЬрд╛рддреА рд╣реИрдВ рдХрд╛ рдЖрдзрд╛рд░ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рддрд╛ рд╣реИред рдиреАрдЪреЗ рджрд┐рдП рдЧрдП рдЙрджрд╛рд╣рд░рдг рдХреЛ рдзреНрдпрд╛рди рд╕реЗ рджреЗрдЦреЗрдВ:
```bash
server {
root /etc/nginx;

location /hello.txt {
try_files $uri $uri/ =404;
proxy_pass http://127.0.0.1:8080/;
}
}
```
рдЗрд╕ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдореЗрдВ, `/etc/nginx` рдХреЛ рдореВрд▓ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХреЗ рд░реВрдк рдореЗрдВ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред рдпрд╣ рд╕реЗрдЯрдЕрдк рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдореВрд▓ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХреЗ рднреАрддрд░ рдлрд╝рд╛рдЗрд▓реЛрдВ рддрдХ рдкрд╣реБрдБрдЪ рджреЗрддрд╛ рд╣реИ, рдЬреИрд╕реЗ `/hello.txt`ред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдорд╣рддреНрд╡рдкреВрд░реНрдг рдпрд╣ рд╣реИ рдХрд┐ рдХреЗрд╡рд▓ рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рд╕реНрдерд╛рди (`/hello.txt`) рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред рдореВрд▓ рд╕реНрдерд╛рди рдХреЗ рд▓рд┐рдП рдХреЛрдИ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдирд╣реАрдВ рд╣реИ (`location / {...}`)ред рдпрд╣ рдЫреВрдЯ рдпрд╣ рджрд░реНрд╢рд╛рддреА рд╣реИ рдХрд┐ рдореВрд▓ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рд╡реИрд╢реНрд╡рд┐рдХ рд░реВрдк рд╕реЗ рд▓рд╛рдЧреВ рд╣реЛрддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рд░рд┐рдХреНрд╡реЗрд╕реНрдЯ `/` рдХреЗ рдореВрд▓ рдкрде рдХреЛ рдПрдХреНрд╕реЗрд╕ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдорд┐рд▓рддреА рд╣реИ рдФрд░ `/etc/nginx` рдХреЗ рдиреАрдЪреЗ рдлрд╝рд╛рдЗрд▓реЛрдВ рддрдХ рдкрд╣реБрдБрдЪ рд╕рдХрддреА рд╣реИред

рдЗрд╕ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рд╕реЗ рдПрдХ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╕реБрд░рдХреНрд╖рд╛ рд╡рд┐рдЪрд╛рд░ рдЙрддреНрдкрдиреНрди рд╣реЛрддрд╛ рд╣реИред рдПрдХ рд╕рд╛рдзрд╛рд░рдг `GET` рд░рд┐рдХреНрд╡реЗрд╕реНрдЯ, рдЬреИрд╕реЗ `GET /nginx.conf`, Nginx рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓ рдХреЛ рдЙрдЬрд╛рдЧрд░ рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ `/etc/nginx/nginx.conf` рдкрд░ рд╕реНрдерд┐рдд рд╣реИред рдореВрд▓ рдХреЛ рдХрдо рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛, рдЬреИрд╕реЗ `/etc`, рдкрд░ рд╕реЗрдЯ рдХрд░рдирд╛ рдЗрд╕ рдЬреЛрдЦрд┐рдо рдХреЛ рдХрдо рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рдлрд┐рд░ рднреА рдпрд╣ рдЕрдирдЬрд╛рди рд░реВрдк рд╕реЗ рдЕрдиреНрдп рдорд╣рддреНрд╡рдкреВрд░реНрдг рдлрд╝рд╛рдЗрд▓реЛрдВ рддрдХ рдкрд╣реБрдБрдЪ рджреЗрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗ рд╕рдХрддрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рдЕрдиреНрдп рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓реЗрдВ, рдПрдХреНрд╕реЗрд╕ рд▓реЙрдЧ, рдФрд░ рдпрд╣рд╛рдБ рддрдХ рдХрд┐ HTTP рдмреЗрд╕рд┐рдХ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯреЗрдб рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рднреА рд╢рд╛рдорд┐рд▓ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред
```
location /imgs {
alias /path/images/;
}
```
рдпрд╣ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди LFI рд╣рдорд▓реЛрдВ рдХреЗ рд▓рд┐рдП рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рд╕рд░реНрд╡рд░ рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ `/imgs../flag.txt` рдЬреИрд╕реЗ рд╕рдордЭ рд░рд╣рд╛ рд╣реИ рдЬреИрд╕реЗ рдХрд┐ рдЗрдВрдЯреЗрдВрдбреЗрдб рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА рдХреЗ рдмрд╛рд╣рд░ рдлрд╝рд╛рдЗрд▓реЛрдВ рддрдХ рдкрд╣реБрдБрдЪрдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕, рдЕрд╕рд▓ рдореЗрдВ `/path/images/../flag.txt` рддрдХ рдкрд╣реБрдБрдЪрдиреЗ рдХрд╛ рдкрд░рд┐рдгрд╛рдо рд╣реЛрддрд╛ рд╣реИред рдпрд╣ рджреЛрд╖ рд╣рдорд▓рд╛рд╡рд░реЛрдВ рдХреЛ рд╕рд░реНрд╡рд░ рдХреА рдлрд╝рд╛рдЗрд▓ рд╕рд┐рд╕реНрдЯрдо рд╕реЗ рдлрд╝рд╛рдЗрд▓реЗрдВ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ рдЬреЛ рд╡реЗрдм рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдкрд╣реБрдБрдЪрдиреЗ рдпреЛрдЧреНрдп рдирд╣реАрдВ рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдПред

рдЗрд╕ рд╕рдВрд░рдХреНрд╖рдгрд╣реЗрддреБ, рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХреЛ рд╕рдорд╛рдпреЛрдЬрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП:
```
location /imgs/ {
alias /path/images/;
}
```
рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА: [https://www.acunetix.com/vulnerabilities/web/path-traversal-via-misconfigured-nginx-alias/](https://www.acunetix.com/vulnerabilities/web/path-traversal-via-misconfigured-nginx-alias/)

Accunetix рдЯреЗрд╕реНрдЯ:
```
alias../ => HTTP status code 403
alias.../ => HTTP status code 404
alias../../ => HTTP status code 403
alias../../../../../../../../../../../ => HTTP status code 400
alias../ => HTTP status code 403
```
## рдЕрд╕реБрд░рдХреНрд╖рд┐рдд рдкрде рдкреНрд░рддрд┐рдмрдВрдз <a href="#unsafe-variable-use" id="unsafe-variable-use"></a>

рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреГрд╖реНрда рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ рддрд╛рдХрд┐ рдЖрдк рдЬреИрд╕реЗ рдирд┐рд░реНрджреЗрд╢реЛрдВ рдХреЛ рдЕрдирджреЗрдЦрд╛ рдХрд░ рд╕рдХреЗрдВ:
```plaintext
location = /admin {
deny all;
}

location = /admin/ {
deny all;
}
```
## рдЕрд╕реБрд░рдХреНрд╖рд┐рдд рдЪрд░ рдкреНрд░рдпреЛрдЧ <a href="#unsafe-variable-use" id="unsafe-variable-use"></a>

Nginx рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдореЗрдВ рдПрдХ рд╕реБрд░рдХреНрд╖рд╛ рджреЛрд╖ рдиреАрдЪреЗ рджрд┐рдП рдЧрдП рдЙрджрд╛рд╣рд░рдг рд╕реЗ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ:
```
location / {
return 302 https://example.com$uri;
}
```
рд╡рд░реНрдг \r (рдХреИрд░рд┐рдЬ рд░рд┐рдЯрд░реНрди) рдФрд░ \n (рд▓рд╛рдЗрди рдлреАрдб) HTTP рдЕрдиреБрд░реЛрдзреЛрдВ рдореЗрдВ рдирдП рдкрдВрдХреНрддрд┐рдпреЛрдВ рдХреЛ рджрд░реНрд╢рд╛рддреЗ рд╣реИрдВ, рдФрд░ рдЙрдирдХреЗ URL-encoded рд░реВрдк `%0d%0a` рдХреЗ рд░реВрдк рдореЗрдВ рдкреНрд░рд╕реНрддреБрдд рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВред рдЗрди рд╡рд░реНрдгреЛрдВ рдХреЛ рдЕрдиреБрд░реЛрдз рдореЗрдВ рд╢рд╛рдорд┐рд▓ рдХрд░рдирд╛ (рдЬреИрд╕реЗ, `http://localhost/%0d%0aDetectify:%20clrf`) рдПрдХ рдЧрд▓рдд рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдП рдЧрдП рд╕рд░реНрд╡рд░ рдХреЛ рдПрдХ рдирдпрд╛ рд╣реЗрдбрд░ рдЬрд╛рд░реА рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдордЬрдмреВрд░ рдХрд░рддрд╛ рд╣реИред рдпрд╣ рдЗрд╕рд▓рд┐рдП рд╣реЛрддрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ $uri рдЪрд░ рдореЗрдВ URL-encoded рдирдП рдкрдВрдХреНрддрд┐ рд╡рд░реНрдгреЛрдВ рдХреЛ рдбрд┐рдХреЛрдб рдХрд░рддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рдПрдХ рдЕрдкреНрд░рддреНрдпрд╛рд╢рд┐рдд рд╣реЗрдбрд░ рдЙрддреНрдкрдиреНрди рд╣реЛрддрд╛ рд╣реИ:
```
HTTP/1.1 302 Moved Temporarily
Server: nginx/1.19.3
Content-Type: text/html
Content-Length: 145
Connection: keep-alive
Location: https://example.com/
Detectify: clrf
```
рдЬрд╛рдиреЗрдВ [https://blog.detectify.com/2019/06/14/http-response-splitting-exploitations-and-mitigations/](https://blog.detectify.com/2019/06/14/http-response-splitting-exploitations-and-mitigations/) рдкрд░ CRLF рдЗрдВрдЬреЗрдХреНрд╢рди рдФрд░ рд░рд┐рд╕реНрдкреЙрдиреНрд╕ рд╕реНрдкреНрд▓рд┐рдЯрд┐рдВрдЧ рдХреЗ рдЬреЛрдЦрд┐рдо рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХред

### рдХреЛрдИ рднреА рд╡реЗрд░рд┐рдПрдмрд▓

рдкрддрд╛ рдЪрд▓рд╛ рдХрд┐ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рджреНрд╡рд╛рд░рд╛ рдкреНрд░рджрддреНрдд рдбреЗрдЯрд╛** рдХреЛ рдХреБрдЫ рдкрд░рд┐рд╕реНрдерд┐рддрд┐рдпреЛрдВ рдХреЗ рддрд╣рдд рдПрдХ **Nginx рд╡реЗрд░рд┐рдПрдмрд▓** рдХреЗ рд░реВрдк рдореЗрдВ рджреЗрдЦрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдЗрд╕ рд╡реНрдпрд╡рд╣рд╛рд░ рдХрд╛ рдХрд╛рд░рдг рдХреБрдЫ рд╣рдж рддрдХ рдЕрдЬреНрдЮрд╛рдд рд╣реИ, рд▓реЗрдХрд┐рди рдпрд╣ рджреБрд░реНрд▓рдн рдирд╣реАрдВ рд╣реИ рдФрд░ рд╕реНрдкрд╖реНрдЯ рдирд╣реАрдВ рд╣реИ рдХрд┐ рдЗрд╕реЗ рд╕рддреНрдпрд╛рдкрд┐рдд рдХреИрд╕реЗ рдХрд┐рдпрд╛ рдЬрд╛рдПред рдЗрд╕ рд╡рд┐рд╕рдВрдЧрддрд┐ рдХреЛ рд╣реИрдХрд░рд╡рди рдкрд░ рдПрдХ рд╕реБрд░рдХреНрд╖рд╛ рд░рд┐рдкреЛрд░реНрдЯ рдореЗрдВ рдЙрдЬрд╛рдЧрд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛, рдЬрд┐рд╕реЗ [рдпрд╣рд╛рдБ](https://hackerone.com/reports/370094) рджреЗрдЦрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рддреНрд░реБрдЯрд┐ рд╕рдВрджреЗрд╢ рдХреА рдЕрдзреНрдпрдпрди рдХреЗ рдмрд╛рдж рдФрд░ рдЙрд╕рдХреА рдкрд╣рдЪрд╛рди рдХреЗ рдмрд╛рдж, рдЗрд╕реЗ [Nginx рдХреЛрдбрдмреЗрд╕ рдХреЗ SSI рдлрд╝рд┐рд▓реНрдЯрд░ рдореЙрдбреНрдпреВрд▓](https://github.com/nginx/nginx/blob/2187586207e1465d289ae64cedc829719a048a39/src/http/modules/ngx_http_ssi_filter_module.c#L365) рдореЗрдВ рдкрд╣рдЪрд╛рдирд╛ рдЧрдпрд╛, рдЬрд┐рд╕рд╕реЗ рд╕рд░реНрд╡рд░ рд╕рд╛рдЗрдб рд╕рдореНрдорд┐рд▓рд┐рдд (SSI) рдХреЛ рдореВрд▓ рдХрд╛рд░рдг рдорд╛рдирд╛ рдЧрдпрд╛ред

рдЗрд╕ рдЧрд▓рдд рд╡рд┐рдиреНрдпрд╛рд╕ рдХреЛ **рдкрд╣рдЪрд╛рдирдиреЗ рдХреЗ рд▓рд┐рдП**, рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрдорд╛рдВрдб рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рдПрдХ рд░реЗрдлрд╝рд░ рд╣реЗрдбрд░ рд╕реЗрдЯ рдХрд░рдирд╛ рд╢рд╛рдорд┐рд▓ рд╣реИ рддрд╛рдХрд┐ рд╡реЗрд░рд┐рдПрдмрд▓ рдкреНрд░рд┐рдВрдЯ рдХрд░рдиреЗ рдХрд╛ рдкрд░реАрдХреНрд╖рдг рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗ:
```bash
$ curl -H тАШReferer: barтАЩ http://localhost/foo$http_referer | grep тАШfoobarтАЩ
```
рдЗрд╕ рдорд┐рд╕рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХреЗ рд╕реНрдХреИрдирд┐рдВрдЧ рдХреЗ рдЬрд░рд┐рдП рдкреНрд░рдгрд╛рд▓рд┐рдпреЛрдВ рдкрд░ рдХрдИ рд╕реНрдерд┐рддрд┐рдпреЛрдВ рдХрд╛ рдкрддрд╛ рдЪрд▓рд╛ рдЬрд╣рд╛рдВ Nginx рдЪрд░ рджреНрд╡рд╛рд░рд╛ рдкреНрд░рд┐рдВрдЯ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рдерд╛ред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдПрдХ рд╕рдВрд╡рд┐рджрд╛рдирд╢реАрд▓ рдШрдЯрдиреЛрдВ рдХреА рд╕рдВрдЦреНрдпрд╛ рдореЗрдВ рдХрдореА рдЗрд╕ рд╕реБрдзрд╛рд░ рдХреЗ рдкреНрд░рдпрд╛рд╕реЛрдВ рдХрд╛ рд╕реБрдЭрд╛рд╡ рджреЗрддреА рд╣реИ рдХрд┐ рдпрд╣ рдореБрджреНрджрд╛ рдХреБрдЫ рд╣рдж рддрдХ рд╕рдлрд▓ рд░рд╣рд╛ рд╣реИред

## рд░реЙ рдмреИрдХрдПрдВрдб рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдкрдарди

Nginx `proxy_pass` рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдПрдХ рд╕реБрд╡рд┐рдзрд╛ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ рдЬреЛ рдмреИрдХрдПрдВрдб рджреНрд╡рд╛рд░рд╛ рдЙрддреНрдкрдиреНрди рддреНрд░реБрдЯрд┐рдпреЛрдВ рдФрд░ HTTP рд╣реЗрдбрд░ рдХреЛ рдЕрдВрддрд░реНрджреГрд╖реНрдЯрд┐ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИ, рдЬрд┐рд╕рдХрд╛ рдЙрджреНрджреЗрд╢реНрдп рдЖрдВрддрд░рд┐рдХ рддреНрд░реБрдЯрд┐ рд╕рдВрджреЗрд╢реЛрдВ рдФрд░ рд╣реЗрдбрд░ рдХреЛ рдЫреБрдкрд╛рдирд╛ рд╣реИред рдЗрд╕реЗ Nginx рджреНрд╡рд╛рд░рд╛ рдмреИрдХрдПрдВрдб рддреНрд░реБрдЯрд┐рдпреЛрдВ рдХреЗ рдкреНрд░рддрд┐ рдХрд╕реНрдЯрдо рддреНрд░реБрдЯрд┐ рдкреГрд╖реНрда рд╕реЗрд╡рд┐рдд рдХрд░рдХреЗ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЪреБрдиреМрддрд┐рдпрд╛рдВ рдЙрддреНрдкрдиреНрди рд╣реЛрддреА рд╣реИрдВ рдЬрдм Nginx рдПрдХ рдЕрдорд╛рдиреНрдп HTTP рдЕрдиреБрд░реЛрдз рдХрд╛ рд╕рд╛рдордирд╛ рдХрд░рддрд╛ рд╣реИред рдРрд╕рд╛ рдЕрдиреБрд░реЛрдз рдмреИрдХрдПрдВрдб рдХреЛ рдкреНрд░рд╛рдкреНрдд рд╣реЛрдиреЗ рдХреЗ рд░реВрдк рдореЗрдВ рдлреЙрд░рд╡рд░реНрдб рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдФрд░ рдлрд┐рд░ рдмреИрдХрдПрдВрдб рдХреА рд░реЙ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рд╕реАрдзреЗ рдХреНрд▓рд╛рдЗрдВрдЯ рдХреЛ рднреЗрдЬ рджреА рдЬрд╛рддреА рд╣реИ рдмрд┐рдирд╛ Nginx рдХреЗ рд╣рд╕реНрддрдХреНрд╖реЗрдк рдХреЗред

рдПрдХ uWSGI рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рд╢рд╛рдорд┐рд▓ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдПрдХ рдЙрджрд╛рд╣рд░рдг рд╕реНрдерд┐рддрд┐ рдХрд╛ рд╡рд┐рдЪрд╛рд░ рдХрд░реЗрдВ:
```python
def application(environ, start_response):
start_response('500 Error', [('Content-Type', 'text/html'), ('Secret-Header', 'secret-info')])
return [b"Secret info, should not be visible!"]
```
рдЗрд╕реЗ рдкреНрд░рдмрдВрдзрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, Nginx рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдореЗрдВ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛рдПрдБ рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛рддреА рд╣реИрдВ:
```
http {
error_page 500 /html/error.html;
proxy_intercept_errors on;
proxy_hide_header Secret-Header;
}
```
- **[proxy_intercept_errors](http://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_intercept_errors)**: рдпрд╣ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ Nginx рдХреЛ рдмреИрдХрдПрдВрдб рдЬрд╡рд╛рдмреЛрдВ рдХреЗ рд▓рд┐рдП рдПрдХ рдХрд╕реНрдЯрдо рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдкреНрд░рджрд╛рди рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИ рдЬрд┐рдирдХрд╛ рд╕реНрдерд┐рддрд┐ рдХреЛрдб 300 рд╕реЗ рдЕрдзрд┐рдХ рд╣реИред рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ рд╣рдорд╛рд░реЗ рдЙрджрд╛рд╣рд░рдг uWSGI рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЗ рд▓рд┐рдП, `500 рддреНрд░реБрдЯрд┐` рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдХреЛ Nginx рджреНрд╡рд╛рд░рд╛ рд░реЛрдХрд╛ рдФрд░ рд╕рдВрднрд╛рд▓рд╛ рдЬрд╛рддрд╛ рд╣реИред
- **[proxy_hide_header](http://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_hide_header)**: рдЬреИрд╕рд╛ рдирд╛рдо рд╕реБрдЭрд╛рддрд╛ рд╣реИ, рдпрд╣ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдЧреНрд░рд╛рд╣рдХ рд╕реЗ рдирд┐рд░реНрджрд┐рд╖реНрдЯ HTTP рд╣реЗрдбрд░ рдХреЛ рдЫреБрдкрд╛рддреА рд╣реИ, рдЧреЛрдкрдиреАрдпрддрд╛ рдФрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХреЛ рдмрдврд╝рд╛рддреА рд╣реИред

рдЬрдм рдПрдХ рдорд╛рдиреНрдп `GET` рдЕрдиреБрд░реЛрдз рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ Nginx рдЗрд╕реЗ рд╕рд╛рдорд╛рдиреНрдп рд░реВрдк рд╕реЗ рдкреНрд░рд╕рдВрд╕реНрдХрд░рдг рдХрд░рддрд╛ рд╣реИ, рдХрд┐рд╕реА рднреА рдЧреБрдкреНрдд рд╣реЗрдбрд░ рдХреЛ рдЙрдЬрд╛рдЧрд░ рди рдХрд░рддреЗ рд╣реБрдП рдПрдХ рдорд╛рдирдХ рддреНрд░реБрдЯрд┐ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рд╡рд╛рдкрд╕ рджреЗрддрд╛ рд╣реИред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдПрдХ рдЕрдорд╛рдиреНрдп HTTP рдЕрдиреБрд░реЛрдз рдЗрд╕ рддрдВрддреНрд░ рдХреЛ рдЕрдирджреЗрдЦрд╛ рдХрд░рддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдХрд┐ рд░реЙ рдмреИрдХрдПрдВрдб рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛рдПрдБ рдЙрдЬрд╛рдЧрд░ рд╣реЛрддреА рд╣реИрдВ, рдЧреБрдкреНрдд рд╣реЗрдбрд░ рдФрд░ рддреНрд░реБрдЯрд┐ рд╕рдВрджреЗрд╢ рд╕рд╣рд┐рддред

## merge\_slashes set to off

рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ, Nginx рдХрд╛ **`merge_slashes` рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛** **`on`** рдкрд░ рд╕реЗрдЯ рд╣реЛрддрд╛ рд╣реИ, рдЬреЛ рдПрдХ URL рдореЗрдВ рдХрдИ рдлреЙрд░рд╡рд░реНрдб рд╕реНрд▓реИрд╢ рдХреЛ рдПрдХ рд╣реА рд╕реНрд▓реИрд╢ рдореЗрдВ рд╕рдВрдХреНрд╖реЗрдкрд┐рдд рдХрд░рддрд╛ рд╣реИред рдпрд╣ рд╕реБрд╡рд┐рдзрд╛, URL рдкреНрд░рд╕рдВрд╕реНрдХрд░рдг рдХреЛ рд╕реБрдЧрдо рдмрдирд╛рдиреЗ рдХреЗ рдмрд╛рд╡рдЬреВрдж, Nginx рдХреЗ рдкреАрдЫреЗ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдореЗрдВ рдЧреБрдкреНрддрд┐рдпреЛрдВ рдХреЛ рдЫреБрдкрд╛рдиреЗ рдХреА рдЧрд▓рддреА рд╕реЗ рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рд╡рд┐рдХрд▓реНрдкрд┐рдд рд▓реЛрдХрд▓ рдлрд╝рд╛рдЗрд▓ рд╕рдорд╛рд╡реЗрд╢рди (LFI) рд╣рдорд▓реЛрдВ рдореЗрдВ рдЧреБрдорд░рд╛рд╣реА рдХрд░ рд╕рдХрддреА рд╣реИред рд╕реБрд░рдХреНрд╖рд╛ рд╡рд┐рд╢реЗрд╖рдЬреНрдЮ **рдбреИрдиреА рд░реЙрдмрд┐рдВрд╕рди рдФрд░ рд░реЛрдЯреЗрдо рдмрд╛рд░** рдиреЗ рдЗрд╕ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд╡реНрдпрд╡рд╣рд╛рд░ рдХреЗ рд╕рд╛рде рдЬреБрдбрд╝реА рд╕рдВрднрд╛рд╡рд┐рдд рдЬреЛрдЦрд┐рдореЛрдВ рдХреЛ рдЙрдЬрд╛рдЧрд░ рдХрд┐рдпрд╛ рд╣реИ, рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рдЬрдм Nginx рдПрдХ рд░рд┐рд╡рд░реНрд╕-рдкреНрд░реЙрдХреНрд╕реА рдХреЗ рд░реВрдк рдореЗрдВ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИред

рдРрд╕реЗ рдЬреЛрдЦрд┐рдореЛрдВ рдХреЛ рдХрдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдпрд╣ рд╕реБрдЭрд╛рд╡ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдХрд┐ **`merge_slashes` рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХреЛ рдмрдВрдж рдХрд░ рджрд┐рдпрд╛ рдЬрд╛рдП** рдЬрд┐рди рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рдЗрди рдЬреЛрдЦрд┐рдореЛрдВ рдХреЗ рдкреНрд░рддрд┐ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рд╣реИред рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ Nginx рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рдмрд┐рдирд╛ URL рд╕рдВрд░рдЪрдирд╛ рдХреЛ рдмрджрд▓реЗ рдЖрдЧреЗ рднреЗрдЬрддрд╛ рд╣реИ, рдЗрд╕рд╕реЗ рдХрд┐рд╕реА рднреА рдЕрдВрддрд░реНрдирд┐рд╣рд┐рдд рд╕реБрд░рдХреНрд╖рд╛ рдореБрджреНрджреЛрдВ рдХреЛ рдорд╛рд╕реНрдХ рдирд╣реАрдВ рдХрд░рддрд╛ред

рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП [рдбреИрдиреА рд░реЙрдмрд┐рдВрд╕рди рдФрд░ рд░реЛрдЯреЗрдо рдмрд╛рд░](https://medium.com/appsflyer/nginx-may-be-protecting-your-applications-from-traversal-attacks-without-you-even-knowing-b08f882fd43d) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВред

### **рдорд╛рдирдЪрд┐рддреНрд░ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдореЗрдВ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдорд╛рди**

**Nginx рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди** рдореЗрдВ, `map` рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдЕрдХреНрд╕рд░ **рдЕрдзрд┐рдХреГрддрд┐ рдирд┐рдпрдВрддреНрд░рдг** рдореЗрдВ рдПрдХ рднреВрдорд┐рдХрд╛ рдирд┐рднрд╛рддреА рд╣реИред рдПрдХ рд╕рд╛рдорд╛рдиреНрдп рдЧрд▓рддреА рдПрдХ **рдбрд┐рдлрд╝реЙрд▓реНрдЯ** рдорд╛рди рдХреА рдирд┐рд░реНрджрд┐рд╖реНрдЯрд┐ рди рдХрд░рдирд╛ рд╣реИ, рдЬреЛ рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ рдХреА рдУрд░ рд▓реЗ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП:
```yaml
http {
map $uri $mappocallow {
/map-poc/private 0;
/map-poc/secret 0;
/map-poc/public 1;
}
}
```

```yaml
server {
location /map-poc {
if ($mappocallow = 0) {return 403;}
return 200 "Hello. It is private area: $mappocallow";
}
}
```
рдмрд┐рдирд╛ `default` рдХреЗ, рдПрдХ **рд╣рд╛рдирд┐рдХрд╛рд░рдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛** рд╕реБрд░рдХреНрд╖рд╛ рдХреЛ рдЫрд▓рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ `/map-poc` рдХреЗ рднреАрддрд░ **рдЕрдкрд░рд┐рднрд╛рд╖рд┐рдд URI** рддрдХ рдкрд╣реБрдВрдЪрдХрд░ред [Nginx рдореИрдиреБрдЕрд▓](https://nginx.org/en/docs/http/ngx_http_map_module.html) рдпрд╣ рд╕рд▓рд╛рд╣ рджреЗрддрд╛ рд╣реИ рдХрд┐ рдЗрд╕рд╕реЗ рдмрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ **рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдорд╛рди** рд╕реЗрдЯ рдХрд░реЗрдВред

### **DNS рд╕реНрдкреВрдлрд┐рдВрдЧ рд╕реБрд░рдХреНрд╖рд╛рднрдВрдЧрддрд╛**

рдирд┐рд╢реНрдЪрд┐рдд рдкрд░рд┐рд╕реНрдерд┐рддрд┐рдпреЛрдВ рдХреЗ рддрд╣рдд Nginx рдХреЗ рдЦрд┐рд▓рд╛рдл DNS рд╕реНрдкреВрдлрд┐рдВрдЧ рд╕рдВрднрд╡ рд╣реИред рдпрджрд┐ рдПрдХ рд╣рдорд▓рд╛рд╡рд░ Nginx рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ **DNS рд╕рд░реНрд╡рд░** рдХреЛ рдЬрд╛рдирддрд╛ рд╣реИ рдФрд░ рдЙрд╕рдХреЗ DNS рдХреНрд╡реЗрд░реА рдХреЛ рдЖрддреНрдорд╕рд╛рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рддреЛ рд╡рд╣ DNS рд░рд┐рдХреЙрд░реНрдб рдХреЛ рд╕реНрдкреВрдлрд╝ рдХрд░ рд╕рдХрддрд╛ рд╣реИред рдпрд╣ рд╡рд┐рдзрд┐, рд╣рд╛рд▓рд╛рдВрдХрд┐, Nginx рдХреЛ DNS рд╕рдВрдХрд▓рди рдХреЗ рд▓рд┐рдП **localhost (127.0.0.1)** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рддреЛ рдЕрд╕рдлрд▓ рд╣реИред Nginx рдХреЛ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд░реВрдк рдореЗрдВ рдПрдХ DNS рд╕рд░реНрд╡рд░ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ:
```yaml
resolver 8.8.8.8;
```
### **`proxy_pass` рдФрд░ `internal` рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛рдПрдБ**

**`proxy_pass`** рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдЕрдиреНрдп рд╕рд░реНрд╡рд░реЛрдВ рдХреЛ рдЕрдиреНрдпрд╛рдиреНрдп рдпрд╛ рдмрд╛рд╣рд░реА рд░реВрдк рд╕реЗ рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ рдкреБрдирд░реНрдирд┐рд░реНрджреЗрд╢рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред **`internal`** рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддреА рд╣реИ рдХрд┐ рдХреБрдЫ рд╕реНрдерд╛рди рдХреЗрд╡рд▓ Nginx рдХреЗ рднреАрддрд░ рд╣реА рдкрд╣реБрдВрдЪрдиреЗ рдпреЛрдЧреНрдп рд╣реИрдВред рдпрджреНрдпрдкрд┐ рдпреЗ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛рдПрдБ рд╕реНрд╡рдпрдВ рдореЗрдВ рдХреЛрдИ рд╕реБрд░рдХреНрд╖рд╛ рджреЛрд╖ рдирд╣реАрдВ рд╣реИрдВ, рдЙрдирдХреЗ рд╡рд┐рдиреНрдпрд╛рд╕ рдХреА рд╕рд╛рд╡рдзрд╛рдиреАрдкреВрд░реНрд╡рдХ рдЬрд╛рдВрдЪ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ рддрд╛рдХрд┐ рд╕реБрд░рдХреНрд╖рд╛ рдЧрдбрд╝рдмрдбрд╝реА рди рд╣реЛред

## proxy\_set\_header Upgrade рдФрд░ Connection

рдпрджрд┐ nginx рд╕рд░реНрд╡рд░ рдХреЛ Upgrade рдФрд░ Connection рд╣реЗрдбрд░реНрд╕ рдкрд╛рд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рддреЛ [**h2c Smuggling attack**](../../pentesting-web/h2c-smuggling.md) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рддрд╛рдХрд┐ рд╕рдВрд░рдХреНрд╖рд┐рдд/рдЖрдВрддрд░рд┐рдХ рдЕрдВрддрдмрд┐рдВрджреБ рддрдХ рдкрд╣реБрдВрдЪрд╛ рдЬрд╛ рд╕рдХреЗред

{% hint style="danger" %}
рдпрд╣ рд╕реБрд░рдХреНрд╖рд╛ рджреЛрд╖ рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдХреЛ **`proxy_pass` рдЕрдВрддрдмрд┐рдВрджреБ** (`http://backend:9999` рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ) рдХреЗ рд╕рд╛рде рд╕реАрдзрд╛ рдХрдиреЗрдХреНрд╢рди рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдЧрд╛ рдЬрд┐рд╕рдХреА рд╕рд╛рдордЧреНрд░реА рдХреЛ nginx рджреНрд╡рд╛рд░рд╛ рдЬрд╛рдВрдЪ рдирд╣реАрдВ рдХреА рдЬрд╛рдПрдЧреАред
{% endhint %}

/flag рдХреЛ рдЪреБрд░рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рд╡рд┐рдХрд▓реНрдкрд┐рдд рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХрд╛ рдЙрджрд╛рд╣рд░рдг [рдпрд╣рд╛рдБ](https://bishopfox.com/blog/h2c-smuggling-request) рд╕реЗ рд╣реИ:
```
server {
listen       443 ssl;
server_name  localhost;

ssl_certificate       /usr/local/nginx/conf/cert.pem;
ssl_certificate_key   /usr/local/nginx/conf/privkey.pem;

location / {
proxy_pass http://backend:9999;
proxy_http_version 1.1;
proxy_set_header Upgrade $http_upgrade;
proxy_set_header Connection $http_connection;
}

location /flag {
deny all;
}
```
{% hint style="warning" %}
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдпрджрд┐ `proxy_pass` рдХрд┐рд╕реА рд╡рд┐рд╢рд┐рд╖реНрдЯ **рдкрде** рдкрд░ рд╕рдВрдХреЗрдд рдХрд░ рд░рд╣рд╛ рдерд╛ рдЬреИрд╕реЗ `http://backend:9999/socket.io` рддреЛ рдХрдиреЗрдХреНрд╢рди `http://backend:9999` рдХреЗ рд╕рд╛рде рд╕реНрдерд╛рдкрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ рддрд╛рдХрд┐ рдЖрдк **рдЙрд╕ рдЖрдВрддрд░рд┐рдХ рдЕрдВрддрдмрд┐рдВрджреБ рдХреЗ рднреАрддрд░ рдХрд┐рд╕реА рдЕрдиреНрдп рдкрде рд╕реЗ рд╕рдВрдкрд░реНрдХ рдХрд░ рд╕рдХреЗрдВред рдЗрд╕рд▓рд┐рдП рдпрджрд┐ proxy\_pass рдХреЗ URL рдореЗрдВ рдХреЛрдИ рдкрде рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рддреЛ рдЗрд╕рдХрд╛ рдорддрд▓рдм рдирд╣реАрдВ рд╣реИред**
{% endhint %}

## рдЦреБрдж рд╕реЗ рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдВ

Detectify рдиреЗ рдПрдХ GitHub рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдмрдирд╛рдИ рд╣реИ рдЬрд╣рд╛рдВ рдЖрдк Docker рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЕрдкрдиреА рдЦреБрдж рдХреА рд╡рдВрд▓рд░реЗрдмрд▓ Nginx рдкрд░реАрдХреНрд╖рдг рд╕рд░реНрд╡рд░ рдХреЛ рд╕реЗрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд┐рд╕рдореЗрдВ рдЗрд╕ рд▓реЗрдЦ рдореЗрдВ рдЪрд░реНрдЪрд╛ рдХреА рдЧрдИ рдХреБрдЫ рдЧрд▓рддрд┐рдпреЛрдВ рдХреЛ рд╢рд╛рдорд┐рд▓ рдХрд░рдХреЗ рдЙрдиреНрд╣реЗрдВ рдЦреБрдж рдвреВрдВрдврд╝рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ!

[https://github.com/detectify/vulnerable-nginx](https://github.com/detectify/vulnerable-nginx)

## рд╕реНрдерд┐рд░ рд╡рд┐рд╢реНрд▓реЗрд╖рдХ рдЙрдкрдХрд░рдг

### [GIXY](https://github.com/yandex/gixy)

Gixy рдПрдХ рдЙрдкрдХрд░рдг рд╣реИ рдЬреЛ Nginx рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣реИред Gixy рдХрд╛ рдореБрдЦреНрдп рд▓рдХреНрд╖реНрдп рд╕реБрд░рдХреНрд╖рд╛ рдЧрд▓рддрд┐рдпреЛрдВ рдХреЛ рд░реЛрдХрдирд╛ рдФрд░ рджреЛрд╖ рдХреА рдЦреЛрдЬ рдХреЛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдХрд░рдирд╛ рд╣реИред

### [Nginxpwner](https://github.com/stark0de/nginxpwner)

Nginxpwner рдПрдХ рд╕рд░рд▓ рдЙрдкрдХрд░рдг рд╣реИ рдЬреЛ рд╕рд╛рдорд╛рдиреНрдп Nginx рдЧрд▓рддрд┐рдпреЛрдВ рдФрд░ рд╕реБрд░рдХреНрд╖рд╛ рд╡рд┐рдлрд▓рддрд╛рдУрдВ рдХреА рдЦреЛрдЬ рдХреЗ рд▓рд┐рдП рд╣реИред

## рд╕рдВрджрд░реНрдн

* [**https://blog.detectify.com/2020/11/10/common-nginx-misconfigurations/**](https://blog.detectify.com/2020/11/10/common-nginx-misconfigurations/)
* [**http://blog.zorinaq.com/nginx-resolver-vulns/**](http://blog.zorinaq.com/nginx-resolver-vulns/)
* [**https://github.com/yandex/gixy/issues/115**](https://github.com/yandex/gixy/issues/115)

<figure><img src="/.gitbook/assets/image (2).png" alt=""><figcaption></figcaption></figure>

**рд╡рд┐рдХрд▓реНрдк рдЙрдкрд▓рдмреНрдз рд╕реЗрдЯрдЕрдк рд╡рд┐рдХрд▓реНрдкрдиреАрдпрддрд╛ рдореВрд▓реНрдпрд╛рдВрдХрди рдФрд░ рдкреЗрдиреЗрдЯреНрд░реЗрд╢рди рдЯреЗрд╕реНрдЯрд┐рдВрдЧ рдХреЗ рд▓рд┐рдП**ред рдХрд╣реАрдВ рд╕реЗ рднреА 20+ рдЙрдкрдХрд░рдг рдФрд░ рд╕реБрд╡рд┐рдзрд╛рдУрдВ рдХреЗ рд╕рд╛рде рдПрдХ рдкреВрд░реНрдг рдкреЗрдВрдЯреЗрд╕реНрдЯ рдЪрд▓рд╛рдПрдВ рдЬреЛ рдкреБрдирд░реАрдХреНрд╖рдг рд╕реЗ рд░рд┐рдкреЛрд░реНрдЯрд┐рдВрдЧ рддрдХ рдЬрд╛рддреЗ рд╣реИрдВред рд╣рдо рдкреЗрдВрдЯреЗрд╕реНрдЯрд░реНрд╕ рдХреЛ рдмрджрд▓рдиреЗ рдирд╣реАрдВ рд╣реИрдВ - рд╣рдо рдЙрдиреНрд╣реЗрдВ рд╡рд╛рдкрд╕ рдХреБрдЫ рд╕рдордп рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд╕реНрдЯрдо рдЙрдкрдХрд░рдг, рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдФрд░ рд╢реЛрдзрди рдореЙрдбреНрдпреВрд▓ рд╡рд┐рдХрд╕рд┐рдд рдХрд░рддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рд╡реЗ рдЧрд╣рд░рд╛рдИ рдореЗрдВ рдЦреЛрдЬ рдХрд░ рд╕рдХреЗрдВ, рд╢реИрд▓реНрд╕ рдкреЙрдк рдХрд░ рд╕рдХреЗрдВ, рдФрд░ рдордЬрд╝рд╛ рдХрд░ рд╕рдХреЗрдВред

{% embed url="https://pentest-tools.com/" %}

<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА HackTricks рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд рд╣реЛ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣ [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдЦреЛрдЬреЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@carlospolopm**](https://twitter.com/hacktricks_live)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ** рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдФрд░ рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдХреНрд▓рд╛рдЙрдб рдЧрд┐рдЯрд╣рдм рд░реЗрдкреЛ рдореЗрдВ PR рдЬрдорд╛ рдХрд░рдХреЗред

</details>
