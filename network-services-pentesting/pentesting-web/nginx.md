# рдПрдирдЬрд┐рдирдХреНрд╕

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>тШБя╕П рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдХреНрд▓рд╛рдЙрдб тШБя╕П</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ЁЯРж рдЯреНрд╡рд┐рдЯрд░ ЁЯРж</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ЁЯОЩя╕П рдЯреНрд╡рд┐рдЪ ЁЯОЩя╕П</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ЁЯОе рдпреВрдЯреНрдпреВрдм ЁЯОе</strong></a></summary>

* рдХреНрдпрд╛ рдЖрдк **рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХрдВрдкрдиреА** рдореЗрдВ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ? рдХреНрдпрд╛ рдЖрдк рдЕрдкрдиреА рдХрдВрдкрдиреА рдХреЛ **рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд** рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ? рдпрд╛ рдХреНрдпрд╛ рдЖрдкрдХреЛ **PEASS рдХреА рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рдХрд╛ рдЙрдкрдпреЛрдЧ** рдХрд░рдиреЗ рдХреА рдЗрдЪреНрдЫрд╛ рд╣реИ? [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ!
* рдЦреЛрдЬреЗрдВ [**рдж рдкреАрдПрд╕ рдлреИрдорд┐рд▓реА**](https://opensea.io/collection/the-peass-family), рд╣рдорд╛рд░рд╛ рдПрдХреНрд╕рдХреНрд▓реВрд╕рд┐рд╡ [**рдПрдирдПрдлрдЯреА**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ рдкреАрдПрд╕ рдФрд░ рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com)
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** [**ЁЯТм**](https://emojipedia.org/speech-balloon/) [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рдореБрдЭреЗ **рдЯреНрд╡рд┐рдЯрд░** рдкрд░ **рдлреЙрд▓реЛ** рдХрд░реЗрдВ [**ЁЯРж**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рдХреЛ рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рд░реЗрдкреЛ** (https://github.com/carlospolop/hacktricks) **рдФрд░** [**рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕-рдХреНрд▓рд╛рдЙрдб рд░реЗрдкреЛ**](https://github.com/carlospolop/hacktricks-cloud) **рдореЗрдВ рдкреАрдЖрд░ рдЬрдорд╛ рдХрд░рдХреЗ рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВред**

</details>

<figure><img src="../../.gitbook/assets/image (1) (1) (2) (4).png" alt=""><figcaption></figcaption></figure>

[**рдбреНрд░реИрдЧрдирдЬрд╛рд░ рд╕реБрд░рдХреНрд╖рд╛ рд╕рдореНрдореЗрд▓рди рдПрдХ рдЕрдВрддрд░реНрд░рд╛рд╖реНрдЯреНрд░реАрдп рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХрд╛рд░реНрдпрдХреНрд░рдо рд╣реИ**](https://www.dragonjarcon.org/), рдЬреЛ 7 рдФрд░ 8 рд╕рд┐рддрдВрдмрд░ 2023 рдХреЛ рдмреЛрдЧреЛрдЯрд╛, рдХреЛрд▓рдВрдмрд┐рдпрд╛ рдореЗрдВ рдЖрдпреЛрдЬрд┐рдд рд╣реЛрдЧрд╛ред рдпрд╣ рдПрдХ рддрдХрдиреАрдХреА рд╕рд╛рдордЧреНрд░реА рдпреБрдХреНрдд рдШрдЯрдирд╛ рд╣реИ рдЬрд╣рд╛рдВ рд╕реНрдкреЗрдирд┐рд╢ рдореЗрдВ рдирд╡реАрдирддрдо рд╢реЛрдз рдкреНрд░рд╕реНрддреБрдд рдХреА рдЬрд╛рддреА рд╣реИ рдФрд░ рдпрд╣ рджреБрдирд┐рдпрд╛ рднрд░ рдХреЗ рд╣реИрдХрд░реНрд╕ рдФрд░ рд╢реЛрдзрдХрд░реНрддрд╛рдУрдВ рдХреЛ рдЖрдХрд░реНрд╖рд┐рдд рдХрд░рддрд╛ рд╣реИред\
рдЗрд╕ рдорд╣рд╛рди рд╕рдореНрдореЗрд▓рди рдХреЛ рди рдЫреЛрдбрд╝реЗрдВ, рдЕрдм рдиреАрдЪреЗ рджрд┐рдП рдЧрдП рд▓рд┐рдВрдХ рдкрд░ рд░рдЬрд┐рд╕реНрдЯрд░ рдХрд░реЗрдВ!:

{% embed url="https://www.dragonjarcon.org/" %}

## рдЧреБрдо рд░реВрдЯ рд╕реНрдерд╛рди <a href="#missing-root-location" id="missing-root-location"></a>
```
server {
root /etc/nginx;

location /hello.txt {
try_files $uri $uri/ =404;
proxy_pass http://127.0.0.1:8080/;
}
}
```
рдпрд╣рд╛рдВ рджрд┐рдП рдЧрдП рдЙрджрд╛рд╣рд░рдг рдореЗрдВ, рд░реВрдЯ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ Nginx рдХреЗ рд▓рд┐рдП рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХреА рдЬрд╛рддреА рд╣реИред рдЙрдкрд░реЛрдХреНрдд рдЙрджрд╛рд╣рд░рдг рдореЗрдВ, рд░реВрдЯ рдлрд╝реЛрд▓реНрдбрд░ `/etc/nginx` рд╣реИ, рдЬрд┐рд╕рдХрд╛ рдЕрд░реНрде рд╣реИ рдХрд┐ рд╣рдо рдЙрд╕ рдлрд╝реЛрд▓реНрдбрд░ рдХреЗ рднреАрддрд░ рдХреЗ рдлрд╝рд╛рдЗрд▓реЛрдВ рддрдХ рдкрд╣реБрдВрдЪ рд╕рдХрддреЗ рд╣реИрдВред рдЙрдкрд░реЛрдХреНрдд рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдореЗрдВ `/ (location / {...})` рдХреЗ рд▓рд┐рдП рдХреЛрдИ рд╕реНрдерд╛рди рдирд╣реАрдВ рд╣реИ, рдХреЗрд╡рд▓ `/hello.txt` рдХреЗ рд▓рд┐рдП рд╣реИред рдЗрд╕рдХреЗ рдХрд╛рд░рдг, `root` рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рд╡реИрд╢реНрд╡рд┐рдХ рд░реВрдк рд╕реЗ рд╕реЗрдЯ рд╣реЛрдЧрд╛, рдЬрд┐рд╕рдХрд╛ рдЕрд░реНрде рд╣реИ рдХрд┐ `/` рдкрд░рд┐рдпреЛрдЬрдирд╛ рдЖрдкрдХреЛ рд╕реНрдерд╛рдирд┐рдХ рдкрде `/etc/nginx` рдкрд░ рд▓реЗ рдЬрд╛рдПрдЧреАред

`GET /nginx.conf` рдЬреИрд╕рд╛ рдПрдХ рд╕рд░рд▓ рдЕрдиреБрд░реЛрдз Nginx рдХреЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓ рдХреА рд╕рд╛рдордЧреНрд░реА рдХреЛ рдЙрдЬрд╛рдЧрд░ рдХрд░реЗрдЧрд╛, рдЬреЛ `/etc/nginx/nginx.conf` рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реИред рдпрджрд┐ рд░реВрдЯ `/etc` рдкрд░ рд╕реЗрдЯ рд╣реИ, рддреЛ `/nginx/nginx.conf` рдкрд░ `GET` рдЕрдиреБрд░реЛрдз рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓ рдХреЛ рдЙрдЬрд╛рдЧрд░ рдХрд░реЗрдЧрд╛ред рдХреБрдЫ рдорд╛рдорд▓реЛрдВ рдореЗрдВ, рдЕрдиреНрдп рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓реЛрдВ, рдПрдХреНрд╕реЗрд╕-рд▓реЙрдЧ рдФрд░ рдпрд╣рд╛рдВ рддрдХ рдХрд┐ HTTP рдореВрд▓рднреВрдд рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЗ рд▓рд┐рдП рдПрдиреНрдХреНрд░рд┐рдкреНрдЯреЗрдб рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рддрдХ рдкрд╣реБрдВрдЪрдирд╛ рд╕рдВрднрд╡ рд╣реЛрддрд╛ рд╣реИред

## рдЕрд▓рд┐рдпрд╛рд╕ LFI рддреНрд░реБрдЯрд┐ рд╕рдорд╛рдХреГрддрд┐ <a href="#alias-lfi-misconfiguration" id="alias-lfi-misconfiguration"></a>

Nginx рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХреЗ рднреАрддрд░ "рд╕реНрдерд╛рди" рд╡рд┐рдзрд╛рдиреЛрдВ рдХреЛ рджреЗрдЦреЗрдВ, рдпрджрд┐ рдХреЛрдИ рдРрд╕рд╛ рджрд┐рдЦрддрд╛ рд╣реИ:
```
location /imgs {
alias /path/images/;
}
```
рдпрд╣рд╛рдБ рдПрдХ LFI рд╕рдВрдХрдЯ рд╣реИ рдХреНрдпреЛрдВрдХрд┐:
```
/imgs../flag.txt
```
# Nginx

Nginx рдПрдХ рдЦреБрд▓рд╛ рд╕реНрд░реЛрдд рд╡реЗрдм рд╕рд░реНрд╡рд░ рд╣реИ рдЬреЛ рдЙрдЪреНрдЪ рдкреНрд░рджрд░реНрд╢рди, рддрд╛рддреНрдХрд╛рд▓рд┐рдХ рдФрд░ рдореВрд▓реНрдп рдХрд╛рд░рдЧрд░рддрд╛ рдХреЗ рд╕рд╛рде рдЖрддрд╛ рд╣реИред рдпрд╣ рдПрдХ рдЖрдзрд┐рдХрд╛рд░рд┐рдХ рд╡реЗрдм рд╕рд░реНрд╡рд░ рдХреЗ рд░реВрдк рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдЗрдВрдЯрд░рдиреЗрдЯ рдкрд░ рд╡реЗрдм рд╕рд╛рдЗрдЯреЛрдВ рдХреЛ рд╣реЛрд╕реНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╡реНрдпрд╛рдкрдХ рд░реВрдк рд╕реЗ рдЙрдкрдпреЛрдЧ рд╣реЛрддрд╛ рд╣реИред

## рдиреЗрдЯрд╡рд░реНрдХ рд╕реЗрд╡рд╛рдУрдВ рдХреЗ рдкреЗрдВрдЯреЗрд╕реНрдЯрд┐рдВрдЧ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА рдЯрд┐рдкреНрд╕

### 1. рдиреЗрдЯрд╡рд░реНрдХ рд╕реНрдХреИрдирд┐рдВрдЧ

Nginx рд╕рд░реНрд╡рд░ рдХреА рдкрд╣рдЪрд╛рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдк рдиреЗрдЯрд╡рд░реНрдХ рд╕реНрдХреИрдирд┐рдВрдЧ рдЯреВрд▓реНрд╕ рдЬреИрд╕реЗ Nmap рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред Nmap рдХреЗ рджреНрд╡рд╛рд░рд╛ рдЖрдк рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЬрд╛рдирдХрд╛рд░реА рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

- рдЦреБрд▓реЗ рдкреЛрд░реНрдЯреНрд╕ рдХреА рд╕реВрдЪреА
- рдЪрд▓ рд░рд╣реЗ рд╕реЗрд╡рд╛рдУрдВ рдХреА рд╕реВрдЪреА
- рдиреЗрдЯрд╡рд░реНрдХ рдЯреЛрдкреЛрд▓реЙрдЬреА

### 2. рд╡реЗрдм рд╕рд░реНрд╡рд░ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХреА рдЬрд╛рдВрдЪ

Nginx рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓ (/etc/nginx/nginx.conf) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ рдФрд░ рдЕрдиреБрдорддрд┐рдпреЛрдВ, рдЕрдирд╛рдорд┐рдд рд╕рд░реНрд╡рд░ рдмреНрд▓реЙрдХ рдФрд░ рдЕрдиреБрдкреНрд░рдпреЛрдЧреЛрдВ рдХреЛ рдЦреЛрдЬреЗрдВред рдпрд╣ рдЖрдкрдХреЛ рд╕реБрд░рдХреНрд╖рд╛ рдХреА рдХрдорд┐рдпреЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░рдиреЗ рдореЗрдВ рдорджрдж рдХрд░реЗрдЧрд╛ред

### 3. рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА рд▓рд┐рд╕реНрдЯрд┐рдВрдЧ

рдпрджрд┐ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рд▓рд┐рд╕реНрдЯрд┐рдВрдЧ рд╕рдХреНрд╖рдо рд╣реИ, рддреЛ рдЖрдк рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХреА рд╕реВрдЪреА рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЗрд╕реЗ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╡реЗрдм рд╕рд╛рдЗрдЯ рдХреА рд╕рдВрд░рдЪрдирд╛ рдФрд░ рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

### 4. рд╡реЗрдм рдлрд╝рд╛рдЗрд▓реНрд╕ рдХреА рдЬрд╛рдВрдЪ

рд╡реЗрдм рд╕рд╛рдЗрдЯ рдХреЗ рд▓рд┐рдП рдЙрдкрд▓рдмреНрдз рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ рдФрд░ рд╕рдВрднрд╛рд╡рд┐рдд рдЧрдВрднреАрд░рддрд╛ рдХреЗ рд╕рдВрдХреЗрддреЛрдВ рдХреЛ рдЦреЛрдЬреЗрдВред рдпрд╣ рдЖрдкрдХреЛ рд╡реЗрдм рд╕рд╛рдЗрдЯ рдХреЗ рдЕрдВрджрд░ рдХреА рдЬрд╛рдирдХрд╛рд░реА рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдореЗрдВ рдорджрдж рдХрд░реЗрдЧрд╛ред

### 5. рд╡реЗрдм рдПрдкреНрд▓реАрдХреЗрд╢рди рд╡рд┐рд╢реНрд▓реЗрд╖рдг

рд╡реЗрдм рдПрдкреНрд▓реАрдХреЗрд╢рди рдХреЗ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХреЗ рд▓рд┐рдП рдЯреВрд▓реНрд╕ рдЬреИрд╕реЗ Burp Suite рдФрд░ OWASP ZAP рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред рдпрд╣ рдЖрдкрдХреЛ рд╕рдВрднрд╛рд╡рд┐рдд рд╕реБрд░рдХреНрд╖рд╛ рдХреА рдХрдорд┐рдпреЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░рдиреЗ рдореЗрдВ рдорджрдж рдХрд░реЗрдЧрд╛ред

### 6. рд╡реЗрдм рд╕рд░реНрд╡рд░ рдХреЗ рд▓рд┐рдП рдЕрдиреБрдкреНрд░рдпреЛрдЧреЛрдВ рдХреА рдЬрд╛рдВрдЪ

рд╡реЗрдм рд╕рд░реНрд╡рд░ рдкрд░ рдЪрд▓ рд░рд╣реЗ рдЕрдиреБрдкреНрд░рдпреЛрдЧреЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ рдФрд░ рд╕рдВрднрд╛рд╡рд┐рдд рдЧрдВрднреАрд░рддрд╛ рдХреЗ рд╕рдВрдХреЗрддреЛрдВ рдХреЛ рдЦреЛрдЬреЗрдВред рдпрд╣ рдЖрдкрдХреЛ рд╡реЗрдм рд╕рд░реНрд╡рд░ рдХреА рд╕реБрд░рдХреНрд╖рд╛ рдХреА рдХрдорд┐рдпреЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░рдиреЗ рдореЗрдВ рдорджрдж рдХрд░реЗрдЧрд╛ред

### 7. рд╡реЗрдм рдлрд╝рд╛рдЗрд▓реНрд╕ рдХреА рд▓реАрдХреЗрдЬрд╝

рд╡реЗрдм рд╕рд╛рдЗрдЯ рдкрд░ рд▓реАрдХ рд╣реЛ рд╕рдХрдиреЗ рд╡рд╛рд▓реА рдЧреЛрдкрдиреАрдпрддрд╛ рд╕рдВрдмрдВрдзреА рдЬрд╛рдирдХрд╛рд░реА рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ, рдЬреИрд╕реЗ рдХрд┐ рдбреЗрдЯрд╛рдмреЗрд╕ рдХреЗ рд▓реЙрдЧрд┐рди рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕, рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреА рдЬрд╛рдирдХрд╛рд░реА, рдФрд░ рдЕрдиреНрдп рд╕рдВрдмрдВрдзрд┐рдд рдлрд╝рд╛рдЗрд▓реЗрдВред

### 8. рд╡реЗрдм рд╕рд░реНрд╡рд░ рдХреЗ рд▓рд┐рдП рджреВрд╕рд░реЗ рдЯреЗрдХреНрдиреЛрд▓реЙрдЬреАрдЬрд╝ рдХреА рдЬрд╛рдВрдЪ

рд╡реЗрдм рд╕рд░реНрд╡рд░ рдХреЗ рд╕рд╛рде рдЬреБрдбрд╝реЗ рдЕрдиреНрдп рдЯреЗрдХреНрдиреЛрд▓реЙрдЬреАрдЬрд╝ рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ, рдЬреИрд╕реЗ рдХрд┐ рдбреЗрдЯрд╛рдмреЗрд╕, рдХреИрд╢, рдФрд░ рдЕрдиреНрдп рд╕рдВрдмрдВрдзрд┐рдд рд╕реЗрд╡рд╛рдПрдВред рдпрд╣ рдЖрдкрдХреЛ рд╕реБрд░рдХреНрд╖рд╛ рдХреА рдХрдорд┐рдпреЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░рдиреЗ рдореЗрдВ рдорджрдж рдХрд░реЗрдЧрд╛ред

### 9. рд╡реЗрдм рдлрд╝рд╛рдЗрд▓реНрд╕ рдХреА рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреА рдЬрд╛рдВрдЪ

рд╡реЗрдм рд╕рд╛рдЗрдЯ рдХреЗ рд▓рд┐рдП рдЙрдкрд▓рдмреНрдз рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреА рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ рдФрд░ рд╕рдВрднрд╛рд╡рд┐рдд рдЕрдиреБрдорддрд┐ рджреНрд╡рд╛рд░рд╛ рдЙрддреНрдкрдиреНрди рд╕реБрд░рдХреНрд╖рд╛ рдХреА рдХрдорд┐рдпреЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВред

### 10. рд╡реЗрдм рдлрд╝рд╛рдЗрд▓реНрд╕ рдХреА рдЕрдкрд╡рд╛рдж

рд╡реЗрдм рд╕рд╛рдЗрдЯ рдкрд░ рдЕрдкрд╡рд╛рджрд┐рдд рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ, рдЬреИрд╕реЗ рдХрд┐ рдЕрдкрд╡рд╛рджрд┐рдд рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓реЗрдВ, рдЕрдкрд╡рд╛рджрд┐рдд рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдлрд╝рд╛рдЗрд▓реЗрдВ, рдФрд░ рдЕрдиреНрдп рд╕рдВрдмрдВрдзрд┐рдд рдлрд╝рд╛рдЗрд▓реЗрдВред

### 11. рд╡реЗрдм рдлрд╝рд╛рдЗрд▓реНрд╕ рдХреА рдЕрджреНрдпрддрдиреАрдпрддрд╛ рдХреА рдЬрд╛рдВрдЪ

рд╡реЗрдм рд╕рд╛рдЗрдЯ рдкрд░ рдЕрджреНрдпрддрдиреАрдп рдирд╣реАрдВ рд╣реЛрдиреЗ рд╡рд╛рд▓реА рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ, рдЬреИрд╕реЗ рдХрд┐ рдкреБрд░рд╛рдиреЗ рдпрд╛ рдЕрдкрд╡рд╛рджрд┐рдд рд╕рдВрд╕реНрдХрд░рдгреЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВред рдпрд╣ рдЖрдкрдХреЛ рд╕реБрд░рдХреНрд╖рд╛ рдХреА рдХрдорд┐рдпреЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░рдиреЗ рдореЗрдВ рдорджрдж рдХрд░реЗрдЧрд╛ред

### 12. рд╡реЗрдм рд╕рд░реНрд╡рд░ рдХреЗ рд▓рд┐рдП рд▓реЙрдЧ рд╡рд┐рд╢реНрд▓реЗрд╖рдг

Nginx рд▓реЙрдЧ рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ рдФрд░ рд▓реЙрдЧ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдЯреВрд▓реНрд╕ рдЬреИрд╕реЗ ELK Stack рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред рдпрд╣ рдЖрдкрдХреЛ рд╕реБрд░рдХреНрд╖рд╛ рдХреА рдХрдорд┐рдпреЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░рдиреЗ рдореЗрдВ рдорджрдж рдХрд░реЗрдЧрд╛ред

рдпрд╣рд╛рдВ рджреА рдЧрдИ рдЯрд┐рдкреНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЖрдк Nginx рд╕рд░реНрд╡рд░ рдХреА рд╕реБрд░рдХреНрд╖рд╛ рдХреА рдХрдорд┐рдпреЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рд╕рдВрднрд╛рд╡рд┐рдд рдЧрдВрднреАрд░рддрд╛ рдХреЛ рдареАрдХ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрд╛рдп рдвреВрдВрдв рд╕рдХрддреЗ рд╣реИрдВред
```
/path/images/../flag.txt
```
рд╕рд╣реА рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╣реЛрдЧреА:
```
location /imgs/ {
alias /path/images/;
}
```
**рддреЛ, рдЕрдЧрд░ рдЖрдкрдХреЛ рдХреЛрдИ Nginx рд╕рд░реНрд╡рд░ рдорд┐рд▓рддрд╛ рд╣реИ рддреЛ рдЖрдкрдХреЛ рдЗрд╕ рджреБрд░реНрдмрд▓рддрд╛ рдХреА рдЬрд╛рдВрдЪ рдХрд░рдиреА рдЪрд╛рд╣рд┐рдПред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЖрдк рдЗрд╕реЗ рдЦреЛрдЬрддреЗ рд╕рдордп рдпрджрд┐ рдЖрдкрдХреЛ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рдлрд╝рд╛рдЗрд▓реЗрдВ/рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдмреНрд░реВрдЯ рдлрд╝реЛрд░реНрд╕ рдЕрдЬреАрдм рддрд░реАрдХреЗ рд╕реЗ рдХрд╛рдо рдХрд░ рд░рд╣реА рд╣реИрдВ рддреЛ рднреА рдЖрдк рдЗрд╕реЗ рдЦреЛрдЬ рд╕рдХрддреЗ рд╣реИрдВред**

рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА: [https://www.acunetix.com/vulnerabilities/web/path-traversal-via-misconfigured-nginx-alias/](https://www.acunetix.com/vulnerabilities/web/path-traversal-via-misconfigured-nginx-alias/)

Accunetix рдЯреЗрд╕реНрдЯ:
```
alias../ => HTTP status code 403
alias.../ => HTTP status code 404
alias../../ => HTTP status code 403
alias../../../../../../../../../../../ => HTTP status code 400
alias../ => HTTP status code 403
```
## рдЕрд╕реБрд░рдХреНрд╖рд┐рдд рдкрде рдкреНрд░рддрд┐рдмрдВрдз <a href="#unsafe-variable-use" id="unsafe-variable-use"></a>

рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреГрд╖реНрда рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ рддрд╛рдХрд┐ рдЖрдк рдРрд╕реЗ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛рдУрдВ рдХреЛ рдЕрдирджреЗрдЦрд╛ рдХрд░ рд╕рдХреЗрдВ рдЬреИрд╕реЗ:
```plaintext
location = /admin {
deny all;
}

location = /admin/ {
deny all;
}
```
## рдЕрд╕реБрд░рдХреНрд╖рд┐рдд рдЪрд░ рдЙрдкрдпреЛрдЧ <a href="#unsafe-variable-use" id="unsafe-variable-use"></a>

рдПрдХ рдЕрд╕реБрд░рдХреНрд╖рд┐рдд Nginx рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХрд╛ рдЙрджрд╛рд╣рд░рдг рд╣реИ:
```
location / {
return 302 https://example.com$uri;
}
```
HTTP рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЗ рд▓рд┐рдП рдирдП рдкрдВрдХреНрддрд┐ рд╡рд░реНрдг \r (рдХреИрд░рд┐рдЬ рд░рд┐рдЯрд░реНрди) рдФрд░ \n (рд▓рд╛рдЗрди рдлрд╝реАрдб) рд╣реЛрддреЗ рд╣реИрдВред рдирдП рдкрдВрдХреНрддрд┐ рд╡рд░реНрдгреЛрдВ рдХреЛ URL-encode рдХрд░рдиреЗ рд╕реЗ рд╡рд░реНрдгреЛрдВ рдХрд╛ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ рдкреНрд░рд╛рдкреНрдд рд╣реЛрддрд╛ рд╣реИ `%0d%0a`ред рдЬрдм рдЗрди рд╡рд░реНрдгреЛрдВ рдХреЛ рдПрдХ рдЕрдиреБрд░реЛрдз рдореЗрдВ рд╢рд╛рдорд┐рд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬреИрд╕реЗ `http://localhost/%0d%0aDetectify:%20clrf` рдПрдХ рдорд┐рд╕реНрдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХреЗ рд╕рд╛рде рд╕рд░реНрд╡рд░ рдХреЛ, рд╕рд░реНрд╡рд░ рдирдП рд╣реИрдбрд░ рдХреЗ рд╕рд╛рде рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдХрд░реЗрдЧрд╛ рдЬрд┐рд╕рдХрд╛ рдирд╛рдо `Detectify` рд╣реЛрдЧрд╛ рдХреНрдпреЛрдВрдХрд┐ $uri рдЪрд░рд┐рддреНрд░ рдХреЛрдб рдХреЗ рдирдП рдкрдВрдХреНрддрд┐ рд╡рд░реНрдгреЛрдВ рдХреЛ URL-decode рдХрд┐рдпрд╛ рд╣реЛрддрд╛ рд╣реИред
```
HTTP/1.1 302 Moved Temporarily
Server: nginx/1.19.3
Content-Type: text/html
Content-Length: 145
Connection: keep-alive
Location: https://example.com/
Detectify: clrf
```
рдЬрд╛рдиреЗрдВ [https://blog.detectify.com/2019/06/14/http-response-splitting-exploitations-and-mitigations/](https://blog.detectify.com/2019/06/14/http-response-splitting-exploitations-and-mitigations/) рдкрд░ CRLF рдЗрдВрдЬреЗрдХреНрд╢рди рдФрд░ рд░рд┐рд╕реНрдкреЙрдиреНрд╕ рд╕реНрдкреНрд▓рд┐рдЯрд┐рдВрдЧ рдХреЗ рдЬреЛрдЦрд┐рдореЛрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдФрд░ рдЕрдзрд┐рдХред

### рдХреЛрдИ рднреА рдЪрд░

рдХреБрдЫ рдорд╛рдорд▓реЛрдВ рдореЗрдВ, рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рджреНрд╡рд╛рд░рд╛ рдкреНрд░рджрд╛рди рдХреА рдЬрд╛рдиреЗ рд╡рд╛рд▓реА рдбреЗрдЯрд╛ рдХреЛ рдПрдХ Nginx рдЪрд░ рдХреЗ рд░реВрдк рдореЗрдВ рд╡реНрдпрд╡рд╣рд╛рд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдпрд╣ рд╕реНрдкрд╖реНрдЯ рдирд╣реАрдВ рд╣реИ рдХрд┐ рдЗрд╕рдХрд╛ рдХрд╛рд░рдг рдХреНрдпрд╛ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдпрд╣ рдЗрддрдирд╛ рдЕрд╕рд╛рдорд╛рдиреНрдп рдпрд╛ рдкрд░реАрдХреНрд╖рдг рдХреЗ рд▓рд┐рдП рдЖрд╕рд╛рди рдирд╣реАрдВ рд╣реИ рдЬреИрд╕рд╛ рдХрд┐ рдЗрд╕ [H1 рд░рд┐рдкреЛрд░реНрдЯ](https://hackerone.com/reports/370094) рдореЗрдВ рджреЗрдЦрд╛ рдЧрдпрд╛ рд╣реИред рд╣рдо рдпрджрд┐ рд╣рдо рддреНрд░реБрдЯрд┐ рд╕рдВрджреЗрд╢ рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рддреЛ рд╣рдо рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдпрд╣ [SSI рдлрд╝рд┐рд▓реНрдЯрд░ рдореЙрдбреНрдпреВрд▓](https://github.com/nginx/nginx/blob/2187586207e1465d289ae64cedc829719a048a39/src/http/modules/ngx\_http\_ssi\_filter\_module.c#L365) рдореЗрдВ рдкрд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдкрддрд╛ рдЪрд▓рддрд╛ рд╣реИ рдХрд┐ рдпрд╣ SSI рдХреЗ рдХрд╛рд░рдг рд╣реИред

рдЗрд╕рдХрд╛ рдкрд░реАрдХреНрд╖рдг рдХрд░рдиреЗ рдХрд╛ рдПрдХ рддрд░реАрдХрд╛ рдПрдХ referer рд╣реЗрдбрд░ рдорд╛рди рд╕реЗрдЯ рдХрд░рдирд╛ рд╣реИ:
```
$ curl -H тАШReferer: barтАЩ http://localhost/foo$http_referer | grep тАШfoobarтАЩ
```
рд╣рдо рдЗрд╕ рддреНрд░реБрдЯрд┐ рдХреА рдЬрд╛рдВрдЪ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕реНрдХреИрди рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдХрдИ рд╕реНрдерд╛рдиреЛрдВ рдкрд░ рдкрд╛рдП рдЬрд╛рддреЗ рд╣реИрдВ рдЬрд╣рд╛рдВ рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ Nginx рдЪрд░реЛрдВ рдХреА рдорд╛рдиреНрдпрддрд╛ рдкреНрд░рд┐рдВрдЯ рдХрд░ рд╕рдХрддрд╛ рд╣реИред рдорд┐рд▓реЗ рд╡рд┐рдХрд▓реНрдкрд┐рдд рд╕рдВрд╕реНрдХрд░рдгреЛрдВ рдХреА рд╕рдВрдЦреНрдпрд╛ рдХрдо рд╣реЛ рдЧрдИ рд╣реИ рдЬреЛ рдЗрд╕рдХрд╛ рдЗрд╢рд╛рд░рд╛ рдХрд░ рд╕рдХрддреА рд╣реИ рдХрд┐ рдЗрд╕реЗ рдкреИрдЪ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред

## рд░реЙ рдмреИрдХрдПрдВрдб рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдкрдврд╝рдирд╛

Nginx рдХреЗ `proxy_pass` рдХреЗ рд╕рд╛рде, рдмреИрдХрдПрдВрдб рджреНрд╡рд╛рд░рд╛ рдмрдирд╛рдП рдЧрдП рддреНрд░реБрдЯрд┐рдпреЛрдВ рдФрд░ HTTP рд╣реИрдбрд░реНрд╕ рдХреЛ рдЕрд╡рд░реЛрдзрд┐рдд рдХрд░рдиреЗ рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рд╣реЛрддреА рд╣реИред рдпрд╣ рдмрд╣реБрдд рдЙрдкрдпреЛрдЧреА рд╣реЛрддрд╛ рд╣реИ рдЕрдЧрд░ рдЖрдк рдЖрдВрддрд░рд┐рдХ рддреНрд░реБрдЯрд┐ рд╕рдВрджреЗрд╢ рдФрд░ рд╣реИрдбрд░реНрд╕ рдХреЛ рдЫрд┐рдкрд╛рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рд╡реЗ Nginx рджреНрд╡рд╛рд░рд╛ рд╕рдВрднрд╛рд▓реЗ рдЬрд╛рдПрдВред Nginx рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдПрдХ рдЕрдиреБрдХреВрд▓ рддреНрд░реБрдЯрд┐ рдкреГрд╖реНрда рдкреНрд░рджрд╛рди рдХрд░реЗрдЧрд╛ рдЕрдЧрд░ рдмреИрдХрдПрдВрдб рдПрдХ рдХреЗ рд╕рд╛рде рдЬрд╡рд╛рдм рджреЗрддрд╛ рд╣реИред рд▓реЗрдХрд┐рди рдпрджрд┐ Nginx рдХреЛ рд╕рдордЭ рдореЗрдВ рдирд╣реАрдВ рдЖрддрд╛ рд╣реИ рдХрд┐ рдпрд╣ рдПрдХ HTTP рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рд╣реИ рддреЛ рдХреНрдпрд╛ рд╣реЛрдЧрд╛?

рдпрджрд┐ рдПрдХ рдХреНрд▓рд╛рдЗрдВрдЯ Nginx рдХреЛ рдЕрдорд╛рдиреНрдп HTTP рдЕрдиреБрд░реЛрдз рднреЗрдЬрддрд╛ рд╣реИ, рддреЛ рд╡рд╣ рдЕрдиреБрд░реЛрдз рдЕрдкрд░рд┐рд╡рд░реНрддрд┐рдд рд░реВрдк рдореЗрдВ рдмреИрдХрдПрдВрдб рдХреЛ рдлрд╡реНрд╡рд╛рд░рд╛ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛, рдФрд░ рдмреИрдХрдПрдВрдб рдЕрдкрдиреА рдХрдЪреНрдЪреА рд╕рд╛рдордЧреНрд░реА рдХреЗ рд╕рд╛рде рдЬрд╡рд╛рдм рджреЗрдЧрд╛ред рдлрд┐рд░, Nginx рдЕрдорд╛рдиреНрдп HTTP рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдХреЛ рд╕рдордЭ рдирд╣реАрдВ рдкрд╛рдПрдЧрд╛ рдФрд░ рдЙрд╕реЗ рдХреНрд▓рд╛рдЗрдВрдЯ рдХреЛ рдлрд╡реНрд╡рд╛рд░рд╛ рдХрд░ рджреЗрдЧрд╛ред рдРрд╕рд╛ рд╕реЛрдЪреЗрдВ рдХрд┐ рдПрдХ uWSGI рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдЗрд╕ рддрд░рд╣ рд╣реЛ:
```python
def application(environ, start_response):
start_response('500 Error', [('Content-Type',
'text/html'),('Secret-Header','secret-info')])
return [b"Secret info, should not be visible!"]
```
рдФрд░ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рд╕рд╛рде Nginx рдореЗрдВ:
```
http {
error_page 500 /html/error.html;
proxy_intercept_errors on;
proxy_hide_header Secret-Header;
}
```
[proxy\_intercept\_errors](http://nginx.org/en/docs/http/ngx\_http\_proxy\_module.html#proxy\_intercept\_errors) рдпрджрд┐ рдмреИрдХрдПрдВрдб рдХрд╛ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рд╕реНрдерд┐рддрд┐ 300 рд╕реЗ рдЕрдзрд┐рдХ рд╣реЛрддреА рд╣реИ рддреЛ рдПрдХ рдХрд╕реНрдЯрдо рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдкреНрд░рджрд╛рди рдХрд░реЗрдЧрд╛ред рд╣рдорд╛рд░реЗ uWSGI рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдореЗрдВ, рд╣рдо рдПрдХ `500 рддреНрд░реБрдЯрд┐` рднреЗрдЬреЗрдВрдЧреЗ рдЬреЛ Nginx рджреНрд╡рд╛рд░рд╛ рдЕрд╡рд░реЛрдзрд┐рдд рдХреА рдЬрд╛рдПрдЧреАред

[proxy\_hide\_header](http://nginx.org/en/docs/http/ngx\_http\_proxy\_module.html#proxy\_hide\_header) рдмрд╣реБрдд рд╣реА рд╕реНрдкрд╖реНрдЯ рд╣реИ; рдпрд╣ рдХреНрд▓рд╛рдЗрдВрдЯ рд╕реЗ рдХрд┐рд╕реА рднреА рдирд┐рд░реНрджрд┐рд╖реНрдЯ HTTP рд╣реИрдбрд░ рдХреЛ рдЫрд┐рдкрд╛ рджреЗрдЧрд╛ред

рдпрджрд┐ рд╣рдо рдПрдХ рд╕рд╛рдорд╛рдиреНрдп `GET` рдЕрдиреБрд░реЛрдз рднреЗрдЬрддреЗ рд╣реИрдВ, рддреЛ Nginx рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреЛ рд▓реМрдЯрд╛рдПрдЧрд╛:
```
HTTP/1.1 500 Internal Server Error
Server: nginx/1.10.3
Content-Type: text/html
Content-Length: 34
Connection: close
```
рд▓реЗрдХрд┐рди рдЕрдЧрд░ рд╣рдо рдПрдХ рдЕрдорд╛рдиреНрдп HTTP рдЕрдиреБрд░реЛрдз рднреЗрдЬрддреЗ рд╣реИрдВ, рдЬреИрд╕реЗ:
```
GET /? XTTP/1.1
Host: 127.0.0.1
Connection: close
```
рд╣рдореЗрдВ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдорд┐рд▓реЗрдЧреА:
```
XTTP/1.1 500 Error
Content-Type: text/html
Secret-Header: secret-info

Secret info, should not be visible!
```
## merge\_slashes рдХреЛ рдмрдВрдж рдХрд░реЗрдВ

[merge\_slashes](http://nginx.org/en/docs/http/ngx\_http\_core\_module.html#merge\_slashes) рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ "рдЪрд╛рд▓реВ" рдкрд░ рд╕реЗрдЯ рдХреА рдЬрд╛рддреА рд╣реИ рдЬреЛ рджреЛ рдпрд╛ рдЕрдзрд┐рдХ рдлрд╝реЙрд░рд╡рд░реНрдб рд╕реНрд▓реИрд╢ рдХреЛ рдПрдХ рдореЗрдВ рд╕рдВрдХреНрд╖реЗрдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рддрдВрддреНрд░ рд╣реИ, рдЗрд╕рд▓рд┐рдП `///` рдХреЛ `/` рдмрдирд╛ рджреЗрдЧрд╛ред рдпрджрд┐ Nginx рдХреЛ рд░рд┐рд╡рд░реНрд╕-рдкреНрд░реЙрдХреНрд╕реА рдХреЗ рд░реВрдк рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдкреНрд░реЙрдХреНрд╕реА рдХрд┐рдП рдЬрд╛ рд░рд╣реЗ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдореЗрдВ рд╕реНрдерд╛рдиреАрдп рдлрд╝рд╛рдЗрд▓ рд╕рдореНрдорд┐рд▓рди рдХреЗ рдкреНрд░рддрд┐ рдХрдордЬреЛрд░реА рд╣реЛрддреА рд╣реИ, рддреЛ рдЕрддрд┐рд░рд┐рдХреНрдд рд╕реНрд▓реИрд╢ рдХрд╛ рдЙрдкрдпреЛрдЧ рдЕрдиреБрд░реЛрдз рдореЗрдВ рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЬрдЧрд╣ рдЫреЛрдбрд╝ рд╕рдХрддрд╛ рд╣реИред рдЗрд╕рдХрд╛ рд╡рд┐рд╡рд░рдг [Danny Robinson and Rotem Bar](https://medium.com/appsflyer/nginx-may-be-protecting-your-applications-from-traversal-attacks-without-you-even-knowing-b08f882fd43d) рджреНрд╡рд╛рд░рд╛ рд╡рд┐рд╕реНрддрд╛рд░ рд╕реЗ рджрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред

рд╣рдордиреЗ 33 Nginx рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓реЗрдВ рдЦреЛрдЬреА рд╣реИрдВ рдЬрд┐рдирдореЗрдВ `merge_slashes` рдХреЛ "рдмрдВрдж" рдХрд░ рджрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред

## map рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХреЗ рд▓рд┐рдП рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдирд╣реАрдВ рд╣реИ

рдРрд╕рд╛ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рдпрд╣ рд╕рд╛рдорд╛рдиреНрдп рдорд╛рдорд▓рд╛ рд╣реИ рдЬрдм **`map` рдХрд┐рд╕реА рдкреНрд░рдХрд╛рд░ рдХреЗ рдЕрдзрд┐рдХреГрддрддрд╛ рдирд┐рдпрдВрддреНрд░рдг рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ**ред рд╕рд░рд▓рд┐рдд рдЙрджрд╛рд╣рд░рдг рдЗрд╕ рддрд░рд╣ рд╕реЗ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ:
```
http {
...
map $uri $mappocallow {
/map-poc/private 0;
/map-poc/secret 0;
/map-poc/public 1;
}
...
}
```

```
server {
...
location /map-poc {
if ($mappocallow = 0) {return 403;}
return 200 "Hello. It is private area: $mappocallow";
}
...
}
```
[рдореИрдиреБрдЕрд▓ рдХреЗ рдЕрдиреБрд╕рд╛рд░](https://nginx.org/en/docs/http/ngx\_http\_map\_module.html):

> рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдорд╛рди\
> рдпрджрд┐ рд╕реНрд░реЛрдд рдорд╛рди рдХрд┐рд╕реА рдирд┐рд░реНрджрд┐рд╖реНрдЯ рд╡реЗрд░рд┐рдПрдВрдЯ рдХреЗ рд╕рд╛рде рдореЗрд▓ рдирд╣реАрдВ рдЦрд╛рддрд╛ рд╣реИ, рддреЛ рдЗрд╕рд╕реЗ рдкрд░рд┐рдгрд╛рдорд╕реНрд╡рд░реВрдк рдорд╛рди рд╕реЗрдЯ рдХрд░рддрд╛ рд╣реИред рдЬрдм рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдирд╣реАрдВ рд╣реЛрддрд╛ рд╣реИ, рддреЛ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдкрд░рд┐рдгрд╛рдорд╕реНрд╡рд░реВрдк рдорд╛рди рдПрдХ рдЦрд╛рд▓реА рд╕реНрдЯреНрд░рд┐рдВрдЧ рд╣реЛрдЧрд╛ред

`default` рдорд╛рди рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЖрд╕рд╛рдиреА рд╕реЗ рднреВрд▓ рдЬрд╛рддрд╛ рд╣реИред рдЗрд╕рд▓рд┐рдП, **рдЕрдкрд░рд╛рдзреА рдЗрд╕ "рдЕрдзрд┐рдХреГрддрддрд╛ рдирд┐рдпрдВрддреНрд░рдг" рдХреЛ рджреБрд░реНрднрд╛рдЧреНрдпрдкреВрд░реНрдгрддрд╛ рд╕реЗ рдЙрдореНрд░ рдмрдврд╝рд╛ рд╕рдХрддрд╛ рд╣реИ** рдЬрдм рд╡рд╣ `/map-poc` рдХреЗ рдЕрдВрджрд░ рдХреЗ рдХрд┐рд╕реА рдЕрд╕реНрддрд┐рддреНрд╡ рдирд╣реАрдВ рд░рдЦрдиреЗ рд╡рд╛рд▓реЗ рдорд╛рдорд▓реЗ рдореЗрдВ рдЬреИрд╕реЗ `https://targethost.com/map-poc/another-private-area` рдкрд╣реБрдБрдЪрддрд╛ рд╣реИред

## Nginx рдореЗрдВ DNS Spoofing

рдЗрд╕ рдкреЛрд╕реНрдЯ рдХреЗ рдЕрдиреБрд╕рд╛рд░: [http://blog.zorinaq.com/nginx-resol**ver-vulns/**](http://blog.zorinaq.com/nginx-resolver-vulns/) **рдпрджрд┐ рдЖрдкрдХреЛ рдкрддрд╛ рд╣реИ рдХрд┐ Nginx рдХреМрди рд╕рд╛ DNS рд╕рд░реНрд╡рд░ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣рд╛ рд╣реИ** (рдФрд░ рдЖрдк рдХрд┐рд╕реА рддрд░реАрдХреЗ рд╕реЗ рд╕рдВрдЪрд╛рд░ рдХреЛ рдЕрд╡рд░реЛрдзрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рдпрд╣ **127.0.0.1** рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ) рдФрд░ **рдбреЛрдореЗрди рдЬрд┐рд╕рдХреА рдЬрд╛рдВрдЪ рдХреА рдЬрд╛ рд░рд╣реА рд╣реИ**, рддреЛ Nginx рдХреЛ DNS рд░рд┐рдХреЙрд░реНрдб рдХреЛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдВрднрд╡ рд╣реЛ рд╕рдХрддрд╛ рд╣реИред

Nginx рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреЗ рд╕рд╛рде рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ DNS рд╕рд░реНрд╡рд░ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░ рд╕рдХрддрд╛ рд╣реИ:
```
resolver     8.8.8.8;
```
## `proxy_pass` рдФрд░ `internal` рдирд┐рд░реНрджреЗрд╢

**`proxy_pass`** рдирд┐рд░реНрджреЗрд╢ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЖрдк **рдЕрдиреНрдп рд╕рд░реНрд╡рд░реЛрдВ рдХреЗ рд▓рд┐рдП рдЕрдВрддрд░реНрдирд┐рд╣рд┐рдд рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ рдкреБрдирд░реНрдирд┐рд░реНрджреЗрд╢рд┐рдд** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЖрдВрддрд░рд┐рдХ рдпрд╛ рдмрд╛рд╣рд░реАред\
**`internal`** рдирд┐рд░реНрджреЗрд╢ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ Nginx рдХреЛ рд╕реНрдкрд╖реНрдЯ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдХрд┐ **рд▓реЛрдХреЗрд╢рди рдХреЗрд╡рд▓ рдЖрдВрддрд░рд┐рдХ рд░реВрдк рд╕реЗ рдкрд╣реБрдВрдЪреА рдЬрд╛ рд╕рдХрддреА рд╣реИ**ред

рдЗрди рдирд┐рд░реНрджреЗрд╢реЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ **рдПрдХ рд╕реБрд░рдХреНрд╖рд╛ рджреЛрд╖ рдирд╣реАрдВ рд╣реИ, рд▓реЗрдХрд┐рди рдЖрдкрдХреЛ рдпрд╣ рдЬрд╛рдВрдЪрдирд╛ рдЪрд╛рд╣рд┐рдП рдХрд┐ рд╡реЗ рдХреИрд╕реЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдП рдЧрдП рд╣реИрдВ**ред

## proxy\_set\_header Upgrade & Connection

рдпрджрд┐ nginx рд╕рд░реНрд╡рд░ рдХреЛ Upgrade рдФрд░ Connection рд╣реИрдбрд░реНрд╕ рдкрд╛рд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рддреЛ [**h2c Smuggling рдЕрдЯреИрдХ**](../../pentesting-web/h2c-smuggling.md) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╕реБрд░рдХреНрд╖рд┐рдд/рдЖрдВрддрд░рд┐рдХ рдЕрдВрдд рдмрд┐рдВрджреБрдУрдВ рддрдХ рдкрд╣реБрдВрдЪ рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИред

{% hint style="danger" %}
рдпрд╣ рд╕реБрд░рдХреНрд╖рд╛ рджреЛрд╖ рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдХреЛ рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ рдХрд┐ рд╡рд╣ **`proxy_pass` рдЕрдВрдд рдмрд┐рдВрджреБ** (`рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ http://backend:9999`) рдХреЗ рд╕рд╛рде рдПрдХ рд╕реАрдзрд╛ рдХрдиреЗрдХреНрд╢рди рд╕реНрдерд╛рдкрд┐рдд рдХрд░реЗрдВ, рдЬрд┐рд╕рдХреА рд╕рд╛рдордЧреНрд░реА nginx рджреНрд╡рд╛рд░рд╛ рдЬрд╛рдВрдЪреА рдирд╣реАрдВ рдЬрд╛рдПрдЧреАред
{% endhint %}

рдЪреЛрд░реА рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдВрдХреНрд░рдорд┐рдд рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХрд╛ рдЙрджрд╛рд╣рд░рдг [рдпрд╣рд╛рдВ](https://bishopfox.com/blog/h2c-smuggling-request) рд╕реЗ `/flag` рдХрд░реЗрдВ:
```
server {
listen       443 ssl;
server_name  localhost;

ssl_certificate       /usr/local/nginx/conf/cert.pem;
ssl_certificate_key   /usr/local/nginx/conf/privkey.pem;

location / {
proxy_pass http://backend:9999;
proxy_http_version 1.1;
proxy_set_header Upgrade $http_upgrade;
proxy_set_header Connection $http_connection;
}

location /flag {
deny all;
}
```
{% hint style="warning" %}
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдпрджрд┐ `proxy_pass` рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ **рдкрде** рдХреА рдУрд░ рдкреЛрдЗрдВрдЯ рдХрд░ рд░рд╣рд╛ рд╣реЛ, рдЬреИрд╕реЗ `http://backend:9999/socket.io`, рддреЛ рдХрдиреЗрдХреНрд╢рди `http://backend:9999` рдХреЗ рд╕рд╛рде рд╕реНрдерд╛рдкрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛, рдЗрд╕рд▓рд┐рдП рдЖрдк **рдЙрд╕ рдЖрдВрддрд░рд┐рдХ рдЕрдВрддрдмрд┐рдВрджреБ рдХреЗ рднреАрддрд░ рдХрд┐рд╕реА рдЕрдиреНрдп рдкрде рд╕реЗ рд╕рдВрдкрд░реНрдХ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдЗрд╕рд▓рд┐рдП рдкреНрд░реЙрдХреНрд╕реА_рдкрд╛рд╕ рдХреЗ URL рдореЗрдВ рдкрде рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдиреЗ рдХрд╛ рдХреЛрдИ рдорд╣рддреНрд╡ рдирд╣реАрдВ рд╣реИред**
{% endhint %}

## рдЦреБрдж рдХреЛ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВ

Detectify рдиреЗ рдПрдХ GitHub рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдмрдирд╛рдпрд╛ рд╣реИ рдЬрд╣рд╛рдВ рдЖрдк Docker рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЕрдкрдиреЗ рдЦреБрдж рдХреЗ рд╡рдирд░рдмрд▓ Nginx рдкрд░реАрдХреНрд╖рдг рд╕рд░реНрд╡рд░ рдХреЛ рд╕реЗрдЯрдЕрдк рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЗрд╕ рд▓реЗрдЦ рдореЗрдВ рдЪрд░реНрдЪрд┐рдд рдХреБрдЫ рдЧрд▓рддрд┐рдпреЛрдВ рдХреЛ рдЦреЛрдЬрдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ!

[https://github.com/detectify/vulnerable-nginx](https://github.com/detectify/vulnerable-nginx)

## рд╕реНрдерд┐рд░ рд╡рд┐рд╢реНрд▓реЗрд╖рдХ рдЙрдкрдХрд░рдг

### [GIXY](https://github.com/yandex/gixy)

Gixy рдПрдХ рдЯреВрд▓ рд╣реИ рдЬреЛ Nginx рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣реИред Gixy рдХрд╛ рдореБрдЦреНрдп рд▓рдХреНрд╖реНрдп рд╕реБрд░рдХреНрд╖рд╛ рдЧрд▓рддрд┐рдпреЛрдВ рдХреЛ рд░реЛрдХрдирд╛ рдФрд░ рджреЛрд╖ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдХреА рд╕реНрд╡рдЪрд╛рд▓рд┐рддрддрд╛ рд╣реИред

### [Nginxpwner](https://github.com/stark0de/nginxpwner)

Nginxpwner рдПрдХ рд╕рд░рд▓ рдЯреВрд▓ рд╣реИ рдЬреЛ рд╕рд╛рдорд╛рдиреНрдп Nginx рдЧрд▓рддрд┐рдпреЛрдВ рдФрд░ рд╕реБрд░рдХреНрд╖рд╛ рджреБрд░реНрдмрд▓рддрд╛рдУрдВ рдХреА рдЦреЛрдЬ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣реИред

## рд╕рдВрджрд░реНрдн

* [**https://blog.detectify.com/2020/11/10/common-nginx-misconfigurations/**](https://blog.detectify.com/2020/11/10/common-nginx-misconfigurations/)
* [**http://blog.zorinaq.com/nginx-resolver-vulns/**](http://blog.zorinaq.com/nginx-resolver-vulns/)
* [**https://github.com/yandex/gixy/issues/115**](https://github.com/yandex/gixy/issues/115)

<figure><img src="../../.gitbook/assets/image (1) (1) (2) (4).png" alt=""><figcaption></figcaption></figure>

[**DragonJAR Security Conference es un evento internacional de ciberseguridad**](https://www.dragonjarcon.org/) con m├бs de una d├йcada que se celebrar├б el 7 y 8 de septiembre de 2023 en Bogot├б, Colombia. Es un evento de gran contenido t├йcnico donde se presentan las ├║ltimas investigaciones en espa├▒ol que atrae a hackers e investigadores de todo el mundo.\
┬бReg├нstrate ahora en el siguiente enlace y no te pierdas esta gran conferencia!:

{% embed url="https://www.dragonjarcon.org/" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>тШБя╕П HackTricks Cloud тШБя╕П</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ЁЯРж Twitter ЁЯРж</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ЁЯОЩя╕П Twitch ЁЯОЩя╕П</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ЁЯОе Youtube ЁЯОе</strong></a></summary>

* рдХреНрдпрд╛ рдЖрдк **рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХрдВрдкрдиреА** рдореЗрдВ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ? рдХреНрдпрд╛ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХреЛ HackTricks рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд** рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ? рдпрд╛ рдХреНрдпрд╛ рдЖрдкрдХреЛ **PEASS рдХреЗ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рддрдХ рдкрд╣реБрдВрдЪ рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ**? [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ!
* рдЦреЛрдЬреЗрдВ [**The PEASS Family**](https://opensea.io/collection/the-peass-family), рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ рд╕рдВрдЧреНрд░рд╣ [**NFTs**](https://opensea.io/collection/the-peass-family)
* рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ [**official PEASS & HackTricks swag**](https://peass.creator-spring.com)
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** [**ЁЯТм**](https://emojipedia.org/speech-balloon/) [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рдореБрдЭреЗ **Twitter** [**ЁЯРж**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)** рдХрд╛ рдкрд╛рд▓рди рдХрд░реЗрдВред**
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ рдФрд░ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **рдФрд░** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **рдХреЛ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВред**

</details>
