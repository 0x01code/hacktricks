# WebDav

<figure><img src="/.gitbook/assets/image (3).png" alt=""><figcaption></figcaption></figure>

\
使用[**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks)可以轻松构建和自动化由全球最先进的社区工具提供支持的工作流程。\
立即获取访问权限：

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks Cloud ☁️</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>🐦 Twitter 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 Youtube 🎥</strong></a></summary>

* 你在一家**网络安全公司**工作吗？你想在HackTricks中看到你的**公司广告**吗？或者你想要**获取PEASS的最新版本或下载PDF格式的HackTricks**吗？请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 发现我们的独家[**NFTs**](https://opensea.io/collection/the-peass-family)收藏品[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* 获取[**官方PEASS和HackTricks周边产品**](https://peass.creator-spring.com)
* **加入**[**💬**](https://emojipedia.org/speech-balloon/) [**Discord群组**](https://discord.gg/hRep4RUj7f)或[**电报群组**](https://t.me/peass)，或者**关注**我在**Twitter**上的[**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**。**
* **通过向**[**hacktricks repo**](https://github.com/carlospolop/hacktricks) **和**[**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **提交PR来分享你的黑客技巧。**

</details>

一个启用了WebDav的**HTTP服务器**是一个你可能可以在其中**更新、删除、移动、复制**文件的服务器。有时候你需要有**有效的凭证**（通常使用HTTP基本身份验证进行检查）。

你应该尝试**上传**一些**webshell**并从Web服务器上**执行**它，以控制服务器。\
通常，要**连接**到WebDav服务器，你需要有效的**凭证**：[**WebDav暴力破解**](../../generic-methodologies-and-resources/brute-force.md#http-basic-auth) _(基本身份验证)_。

另一种常见的配置是**禁止上传**由Web服务器**执行**的文件扩展名，你应该检查如何**绕过此限制**：

* **上传**具有**可执行扩展名**的文件（也许不被禁止）。
* **上传**没有**可执行扩展名**的文件（如.txt），并尝试使用**可执行扩展名**重命名（移动）文件。
* **上传**没有**可执行扩展名**的文件（如.txt），并尝试使用**可执行扩展名**复制文件。

## DavTest

**Davtest**尝试使用不同的扩展名**上传多个文件**并**检查**扩展名是否被**执行**：
```bash
davtest [-auth user:password] -move -sendbd auto -url http://<IP> #Uplaod .txt files and try to move it to other extensions
davtest [-auth user:password] -sendbd auto -url http://<IP> #Try to upload every extension
```
输出示例：

![](<../../.gitbook/assets/image (19) (1).png>)

这并不意味着 **.txt** 和 **.html 扩展名被执行**。这意味着你可以通过网络 **访问这些文件**。

## Cadaver

你可以使用这个工具来 **连接到 WebDav** 服务器并 **手动执行** 操作（如 **上传**、**移动** 或 **删除**）。
```
cadaver <IP>
```
## PUT请求

The PUT method is used to update or create a resource on a server. It is commonly used in web development to upload files or modify existing resources. In the context of web application penetration testing, the PUT method can be exploited to perform unauthorized modifications or upload malicious files to a vulnerable server.

PUT请求方法用于在服务器上更新或创建资源。它通常用于Web开发中上传文件或修改现有资源。在Web应用程序渗透测试的背景下，PUT方法可以被利用来执行未经授权的修改或向易受攻击的服务器上传恶意文件。

### WebDAV and PUT Method

WebDAV (Web Distributed Authoring and Versioning) is an extension of the HTTP protocol that allows clients to perform remote web content authoring operations. It includes support for the PUT method, which enables clients to upload files to a server.

WebDAV（Web分布式作者和版本控制）是HTTP协议的扩展，允许客户端执行远程Web内容创作操作。它包括对PUT方法的支持，使客户端能够将文件上传到服务器。

### Exploiting PUT Method for Unauthorized Modifications

In some cases, web servers may have misconfigured or improperly secured PUT functionality, allowing unauthorized users to modify resources. This can lead to various security issues, such as defacement of web pages, unauthorized access to sensitive information, or even remote code execution.

在某些情况下，Web服务器可能会配置错误或未正确保护PUT功能，从而允许未经授权的用户修改资源。这可能导致各种安全问题，例如网页篡改、对敏感信息的未经授权访问，甚至远程代码执行。

To exploit this vulnerability, an attacker can send a PUT request to the target server with the desired modifications. The request should include the necessary headers and body content to update the resource. If the server allows unauthorized modifications, the changes will be applied.

为了利用这个漏洞，攻击者可以向目标服务器发送一个带有所需修改的PUT请求。请求应包括更新资源所需的必要头部和正文内容。如果服务器允许未经授权的修改，那么修改将会被应用。

### Uploading Malicious Files

Another way to exploit the PUT method is by uploading malicious files to the server. If the server allows file uploads and does not properly validate or sanitize the uploaded files, an attacker can upload a file containing malicious code. This can lead to various attacks, such as remote code execution or file inclusion vulnerabilities.

利用PUT方法的另一种方式是向服务器上传恶意文件。如果服务器允许文件上传并且没有正确验证或清理上传的文件，攻击者可以上传包含恶意代码的文件。这可能导致各种攻击，例如远程代码执行或文件包含漏洞。

To perform this attack, the attacker crafts a PUT request with the malicious file as the body content. If the server allows the upload and does not properly validate the file, the malicious file will be stored on the server and can be accessed by other users or executed by the server.

为了执行这种攻击，攻击者构造一个带有恶意文件作为正文内容的PUT请求。如果服务器允许上传并且没有正确验证文件，那么恶意文件将被存储在服务器上，并且可以被其他用户访问或由服务器执行。

### Mitigation

To mitigate the risks associated with the PUT method, it is important to properly configure and secure web servers. Some recommended measures include:

- Disable the PUT method if it is not required for the application.
- Implement proper access controls and authentication mechanisms to prevent unauthorized modifications.
- Validate and sanitize all user input, especially file uploads, to prevent malicious file uploads.
- Regularly update and patch web server software to address any known vulnerabilities.

减轻与PUT方法相关的风险，重要的是正确配置和保护Web服务器。一些建议的措施包括：

- 如果应用程序不需要，禁用PUT方法。
- 实施适当的访问控制和身份验证机制，以防止未经授权的修改。
- 验证和清理所有用户输入，特别是文件上传，以防止恶意文件上传。
- 定期更新和修补Web服务器软件，以解决已知的任何漏洞。
```
curl -T 'shell.txt' 'http://$ip'
```
## MOVE 请求

The MOVE request is used in WebDAV to move a resource from one location to another. It is similar to the HTTP PUT method, but instead of creating a new resource, it moves an existing resource to a new location.

MOVE 请求在 WebDAV 中用于将资源从一个位置移动到另一个位置。它类似于 HTTP PUT 方法，但不是创建新资源，而是将现有资源移动到新位置。

### Syntax

The syntax of the MOVE request is as follows:

```
MOVE /source-resource HTTP/1.1
Host: example.com
Destination: /destination-resource
```

### Example

Here is an example of a MOVE request:

```
MOVE /file.txt HTTP/1.1
Host: example.com
Destination: /new-folder/file.txt
```

In this example, the file.txt resource is moved from the root directory to the new-folder directory.

### Response

The server responds to the MOVE request with a status code indicating the success or failure of the operation. If the move is successful, the server will return a 201 Created status code. If the move fails, the server will return an appropriate error status code, such as 403 Forbidden or 404 Not Found.

### Security Considerations

When performing a MOVE request, it is important to consider the security implications. Moving a resource can have unintended consequences, such as breaking links or causing data loss. It is recommended to thoroughly test the MOVE operation in a controlled environment before performing it on a production system.

### Conclusion

The MOVE request is a powerful method in WebDAV that allows for the movement of resources within a server. It is important to use this method with caution and thoroughly test it to avoid any unintended consequences.
```
curl -X MOVE --header 'Destination:http://$ip/shell.php' 'http://$ip/shell.txt'
```
<figure><img src="/.gitbook/assets/image (3).png" alt=""><figcaption></figcaption></figure>

使用[**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks)可以轻松构建和自动化由全球最先进的社区工具提供支持的工作流程。\
立即获取访问权限：

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## IIS5/6 WebDav漏洞

这个漏洞非常有趣。**WebDav**不允许上传或重命名扩展名为**.asp**的文件。但是，您可以通过在名称末尾添加**";.txt"**来绕过此限制，文件将被执行，就像它是一个.asp文件一样（您也可以使用".html"代替".txt"，但**不要忘记";"**）。

然后，您可以将您的shell上传为".**txt文件**，并将其复制/移动到".asp;.txt"文件中。通过Web服务器访问该文件，它将被执行（cadaver会说移动操作失败，但实际上是成功的）。

![](<../../.gitbook/assets/image (18) (1) (1).png>)

## 提交凭据

如果Webdav使用的是Apache服务器，则应查看Apache中配置的站点。通常在：\
_**/etc/apache2/sites-enabled/000-default**_

在其中，您可能会找到类似以下内容的东西：
```
ServerAdmin webmaster@localhost
Alias /webdav /var/www/webdav
<Directory /var/www/webdav>
DAV On
AuthType Digest
AuthName "webdav"
AuthUserFile /etc/apache2/users.password
Require valid-user
```
正如您所看到的，这里有一个包含**WebDAV**服务器的有效**凭据**的文件：
```
/etc/apache2/users.password
```
在这类文件中，您将找到**用户名**和**密码的哈希值**。这些是WebDAV服务器用于验证用户的凭据。

您可以尝试**破解**它们，或者如果出于某种原因您想要**访问**WebDAV服务器，可以**添加更多**凭据：
```bash
htpasswd /etc/apache2/users.password <USERNAME> #You will be prompted for the password
```
要检查新凭据是否有效，可以执行以下操作：
```bash
wget --user <USERNAME> --ask-password http://domain/path/to/webdav/ -O - -q
```
<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks云 ☁️</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>🐦 推特 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 YouTube 🎥</strong></a></summary>

* 你在一家**网络安全公司**工作吗？你想在HackTricks中看到你的**公司广告**吗？或者你想获得**PEASS的最新版本或下载HackTricks的PDF**吗？请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 发现我们的独家[**NFTs**](https://opensea.io/collection/the-peass-family)收藏品——[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* 获取[**官方PEASS和HackTricks周边产品**](https://peass.creator-spring.com)
* **加入**[**💬**](https://emojipedia.org/speech-balloon/) [**Discord群组**](https://discord.gg/hRep4RUj7f)或[**电报群组**](https://t.me/peass)，或者**关注**我在**Twitter**上的[**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**。**
* **通过向**[**hacktricks repo**](https://github.com/carlospolop/hacktricks) **和**[**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **提交PR来分享你的黑客技巧。**

</details>

<figure><img src="/.gitbook/assets/image (3).png" alt=""><figcaption></figcaption></figure>

\
使用[**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks)可以轻松构建和**自动化工作流程**，使用全球**最先进**的社区工具。\
立即获取访问权限：

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}
