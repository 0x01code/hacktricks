# Flask

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Travaillez-vous dans une **entreprise de cybers√©curit√©** ? Voulez-vous voir votre **entreprise annonc√©e dans HackTricks** ? ou voulez-vous avoir acc√®s √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFT**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**üí¨**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR au** [**repo hacktricks**](https://github.com/carlospolop/hacktricks) **et au** [**repo hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

<figure><img src="../../.gitbook/assets/image (9) (1) (2).png" alt=""><figcaption></figcaption></figure>

Utilisez [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) pour construire et **automatiser des flux de travail** aliment√©s par les outils communautaires les plus avanc√©s au monde.\
Obtenez un acc√®s aujourd'hui :

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

**Probablement, si vous jouez √† un CTF, une application Flask sera li√©e √†** [**SSTI**](../../pentesting-web/ssti-server-side-template-injection/)**.**

## Cookies

Le nom de session par d√©faut du cookie est **`session`**.

### D√©codeur

D√©codeur de cookies Flask en ligne : [https://www.kirsle.net/wizards/flask-session.cgi](https://www.kirsle.net/wizards/flask-session.cgi)

#### Manuel

Obtenez la premi√®re partie du cookie jusqu'au premier point et d√©codez-le en Base64>
```bash
echo "ImhlbGxvIg" | base64 -d
```
Le cookie est √©galement sign√© √† l'aide d'un mot de passe

### **Flask-Unsign**

Outil en ligne de commande pour r√©cup√©rer, d√©coder, forcer par la m√©thode brute et cr√©er des cookies de session d'une application Flask en devinant les cl√©s secr√®tes.

{% embed url="https://pypi.org/project/flask-unsign/" %}
```bash
pip3 install flask-unsign
```
#### **D√©coder le Cookie**

Le d√©codage d'un cookie peut √™tre utile lors d'un test d'intrusion pour analyser les informations stock√©es dans le cookie. Cela peut r√©v√©ler des donn√©es sensibles telles que des identifiants de session, des informations d'authentification ou d'autres informations confidentielles.

Pour d√©coder un cookie, vous pouvez utiliser des outils en ligne tels que "base64decode.net" ou des biblioth√®ques de programmation telles que "base64" en Python. Ces outils vous permettent de d√©coder le contenu du cookie √† partir de son encodage en base64.

Voici un exemple de code Python pour d√©coder un cookie en utilisant la biblioth√®que "base64" :

```python
import base64

def decode_cookie(cookie):
    decoded_cookie = base64.b64decode(cookie)
    return decoded_cookie

cookie = "SGVsbG8gV29ybGQh"
decoded_cookie = decode_cookie(cookie)
print(decoded_cookie)
```

Dans cet exemple, nous utilisons la fonction `b64decode` de la biblioth√®que `base64` pour d√©coder le cookie. Le r√©sultat est ensuite affich√© √† l'√©cran.

Il est important de noter que le d√©codage d'un cookie ne garantit pas que vous pourrez acc√©der √† toutes les informations sensibles. Certains cookies peuvent √™tre chiffr√©s ou avoir d'autres m√©canismes de protection qui emp√™chent leur d√©codage. Cependant, le d√©codage du cookie peut √™tre une √©tape importante dans l'analyse des informations stock√©es dans celui-ci.
```bash
flask-unsign --decode --cookie 'eyJsb2dnZWRfaW4iOmZhbHNlfQ.XDuWxQ.E2Pyb6x3w-NODuflHoGnZOEpbH8'
```
#### **Brute Force**

La technique de **Brute Force** est une m√©thode d'attaque utilis√©e pour essayer toutes les combinaisons possibles de mots de passe jusqu'√† ce que le bon soit trouv√©. C'est une approche simple mais efficace pour acc√©der √† un syst√®me en exploitant les faiblesses des mots de passe faibles. Les attaquants utilisent g√©n√©ralement des outils automatis√©s pour effectuer cette t√¢che, ce qui leur permet de tester rapidement un grand nombre de combinaisons. Pour se prot√©ger contre les attaques de force brute, il est important d'utiliser des mots de passe forts et de mettre en place des mesures de s√©curit√© suppl√©mentaires, telles que des verrouillages de compte apr√®s un certain nombre de tentatives infructueuses.
```bash
flask-unsign --wordlist /usr/share/wordlists/rockyou.txt --unsign --cookie '<cookie>' --no-literal-eval
```
#### **Signature**

La signature est un m√©canisme utilis√© pour v√©rifier l'int√©grit√© et l'authenticit√© des donn√©es. Elle est g√©n√©ralement utilis√©e pour garantir que les donn√©es n'ont pas √©t√© modifi√©es pendant le transit et qu'elles proviennent d'une source fiable.

Dans le contexte du d√©veloppement web, la signature est souvent utilis√©e pour prot√©ger les cookies de session et les tokens d'authentification. Lorsqu'un cookie ou un token est sign√©, il est associ√© √† une cl√© secr√®te connue uniquement par le serveur. Lorsque le serveur re√ßoit le cookie ou le token, il peut v√©rifier la signature en recalculant celle-ci √† l'aide de la cl√© secr√®te. Si la signature correspond, cela signifie que les donn√©es n'ont pas √©t√© modifi√©es et qu'elles proviennent du serveur.

La biblioth√®que Flask, utilis√©e pour le d√©veloppement d'applications web en Python, fournit un m√©canisme de signature int√©gr√© appel√© "Flask-Signing". Cette extension permet de signer et de v√©rifier les donn√©es de mani√®re s√©curis√©e.

Pour signer des donn√©es avec Flask-Signing, vous pouvez utiliser la fonction `signer` fournie par l'extension. Par exemple :

```python
from flask import Flask
from itsdangerous import URLSafeTimedSerializer

app = Flask(__name__)
app.config['SECRET_KEY'] = 'your-secret-key'

s = URLSafeTimedSerializer(app.config['SECRET_KEY'])

@app.route('/')
def index():
    data = {'username': 'Alice'}
    signed_data = s.dumps(data)
    return signed_data
```

Dans cet exemple, nous importons la classe `URLSafeTimedSerializer` de la biblioth√®que `itsdangerous`, qui est utilis√©e par Flask-Signing pour la signature des donn√©es. Nous cr√©ons ensuite une instance de `URLSafeTimedSerializer` en utilisant la cl√© secr√®te de l'application Flask. Ensuite, nous signons les donn√©es en utilisant la m√©thode `dumps` de l'instance `s`. Les donn√©es sign√©es sont renvoy√©es en tant que r√©ponse HTTP.

Pour v√©rifier la signature des donn√©es, vous pouvez utiliser la fonction `loads` de l'instance `s`. Par exemple :

```python
@app.route('/verify/<signed_data>')
def verify(signed_data):
    try:
        data = s.loads(signed_data)
        return f"Data: {data}"
    except:
        return "Invalid signature"
```

Dans cet exemple, nous d√©finissons une route `/verify/<signed_data>` qui prend les donn√©es sign√©es en tant que param√®tre d'URL. Nous utilisons la m√©thode `loads` de l'instance `s` pour v√©rifier la signature des donn√©es. Si la signature est valide, les donn√©es sont renvoy√©es en tant que r√©ponse HTTP. Sinon, un message d'erreur est renvoy√©.

La signature est un m√©canisme puissant pour garantir l'int√©grit√© et l'authenticit√© des donn√©es. En utilisant Flask-Signing, vous pouvez facilement impl√©menter la signature dans vos applications web Flask.
```bash
flask-unsign --sign --cookie "{'logged_in': True}" --secret 'CHANGEME'
```
#### Signature en utilisant des versions obsol√®tes (anciennes versions)

Lors de l'√©valuation de la s√©curit√© d'une application Flask, il est important de v√©rifier si elle utilise des versions obsol√®tes qui pourraient pr√©senter des vuln√©rabilit√©s connues. Les versions obsol√®tes de Flask peuvent √™tre sujettes √† des attaques de contournement de s√©curit√© ou √† des failles connues qui pourraient √™tre exploit√©es par des attaquants.

Pour identifier si une application Flask utilise une version obsol√®te, vous pouvez effectuer les √©tapes suivantes :

1. Recherchez la version de Flask utilis√©e par l'application. Cela peut √™tre trouv√© dans le fichier `requirements.txt` ou dans le fichier `setup.py` de l'application.

2. Comparez la version de Flask avec la derni√®re version disponible sur le site officiel de Flask. Si la version utilis√©e par l'application est inf√©rieure √† la derni√®re version disponible, cela indique qu'elle utilise une version obsol√®te.

3. Consultez la documentation de Flask pour identifier les vuln√©rabilit√©s connues dans les versions obsol√®tes. Recherchez les correctifs et les mises √† jour recommand√©es pour r√©soudre ces vuln√©rabilit√©s.

Si vous identifiez que l'application Flask utilise une version obsol√®te, il est recommand√© de mettre √† jour vers la derni√®re version stable de Flask pour b√©n√©ficier des correctifs de s√©curit√© et des am√©liorations de performance. Assurez-vous de tester soigneusement l'application apr√®s la mise √† jour pour vous assurer qu'elle fonctionne correctement.
```bash
flask-unsign --sign --cookie "{'logged_in': True}" --secret 'CHANGEME' --legacy
```
### **RIPsession**

Outil en ligne de commande pour effectuer une attaque par force brute sur des sites web en utilisant des cookies cr√©√©s avec flask-unsign.

{% embed url="https://github.com/Tagvi/ripsession" %}
```bash
ripsession -u 10.10.11.100 -c "{'logged_in': True, 'username': 'changeMe'}" -s password123 -f "user doesn't exist" -w wordlist.txt
```
### SQLi dans le cookie de session Flask avec SQLmap

[**Cet exemple**](../../pentesting-web/sql-injection/sqlmap/#eval) utilise l'option `eval` de sqlmap pour **automatiquement signer les charges utiles sqlmap** pour Flask en utilisant un secret connu.

## Proxy Flask vers SSRF

[**Dans cette explication**](https://rafa.hashnode.dev/exploiting-http-parsers-inconsistencies), il est expliqu√© comment Flask permet une requ√™te commen√ßant par le caract√®re "@":
```http
GET @/ HTTP/1.1
Host: target.com
Connection: close
```
Dans le sc√©nario suivant :
```python
from flask import Flask
from requests import get

app = Flask('__main__')
SITE_NAME = 'https://google.com/'

@app.route('/', defaults={'path': ''})
@app.route('/<path:path>')
def proxy(path):
return get(f'{SITE_NAME}{path}').content

app.run(host='0.0.0.0', port=8080)
```
Il est possible d'introduire quelque chose comme "@attacker.com" afin de provoquer une **SSRF**.

<figure><img src="../../.gitbook/assets/image (9) (1) (2).png" alt=""><figcaption></figcaption></figure>

Utilisez [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) pour cr√©er et automatiser facilement des flux de travail aliment√©s par les outils communautaires les plus avanc√©s au monde.\
Obtenez un acc√®s d√®s aujourd'hui :

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Travaillez-vous dans une **entreprise de cybers√©curit√©** ? Voulez-vous voir votre **entreprise annonc√©e dans HackTricks** ? ou voulez-vous avoir acc√®s √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**üí¨**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR au** [**repo hacktricks**](https://github.com/carlospolop/hacktricks) **et au** [**repo hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
