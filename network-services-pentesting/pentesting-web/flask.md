# Flask

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks Cloud ☁️</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>🐦 Twitter 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 Youtube 🎥</strong></a></summary>

* **サイバーセキュリティ会社**で働いていますか？ **HackTricksで会社を宣伝**したいですか？または、**PEASSの最新バージョンにアクセスしたり、HackTricksをPDFでダウンロード**したいですか？[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を見つけてください。独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクションです。
* [**公式のPEASS＆HackTricksのグッズ**](https://peass.creator-spring.com)を手に入れましょう。
* [**💬**](https://emojipedia.org/speech-balloon/) [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**telegramグループ**](https://t.me/peass)に**参加**するか、**Twitter**で**フォロー**してください[**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**。**
* **ハッキングのトリックを共有するには、PRを** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **と** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **に提出してください。**

</details>

<figure><img src="../../.gitbook/assets/image (9) (1) (2).png" alt=""><figcaption></figcaption></figure>

[**Trickest**](https://trickest.io/)を使用して、世界で最も高度なコミュニティツールによって強化された**ワークフローを簡単に構築**および**自動化**します。\
今すぐアクセスを取得：

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

**おそらく、CTFをプレイしている場合、Flaskアプリケーションは** [**SSTI**](../../pentesting-web/ssti-server-side-template-injection/)**に関連しているでしょう。**

## Cookies

デフォルトのクッキーセッション名は**`session`**です。

### デコーダー

オンラインのFlaskクッキーデコーダー：[https://www.kirsle.net/wizards/flask-session.cgi](https://www.kirsle.net/wizards/flask-session.cgi)

#### 手動

最初のドットまでのクッキーの最初の部分を取得し、Base64でデコードします>
```bash
echo "ImhlbGxvIg" | base64 -d
```
クッキーはパスワードを使用して署名されています。

### **Flask-Unsign**

秘密のキーを推測して、Flaskアプリケーションのセッションクッキーを取得、デコード、ブルートフォース、および作成するためのコマンドラインツールです。

{% embed url="https://pypi.org/project/flask-unsign/" %}
```bash
pip3 install flask-unsign
```
#### **Cookieのデコード**

```plaintext
To decode a Flask cookie, you can use the `itsdangerous` library. The `itsdangerous` library provides a `URLSafeTimedSerializer` class that can be used to decode and verify the integrity of a Flask cookie.

Here is an example of how to decode a Flask cookie using `itsdangerous`:

```python
from itsdangerous import URLSafeTimedSerializer

def decode_cookie(cookie_value, secret_key):
    serializer = URLSafeTimedSerializer(secret_key)
    try:
        decoded_data = serializer.loads(cookie_value)
        return decoded_data
    except Exception as e:
        print(f"Error decoding cookie: {e}")
        return None
```

In the above example, the `decode_cookie` function takes in the `cookie_value` and `secret_key` as parameters. It creates an instance of the `URLSafeTimedSerializer` class with the provided `secret_key`. The `loads` method of the serializer is then used to decode the `cookie_value`. If the decoding is successful, the decoded data is returned. If an error occurs during decoding, an error message is printed and `None` is returned.

Remember to keep the `secret_key` secure and not expose it in your code or configuration files.
```

Cookieをデコードするには、`itsdangerous`ライブラリを使用することができます。`itsdangerous`ライブラリには、FlaskのCookieをデコードし、整合性を検証するために使用できる`URLSafeTimedSerializer`クラスが提供されています。

以下は、`itsdangerous`を使用してFlaskのCookieをデコードする方法の例です。

```python
from itsdangerous import URLSafeTimedSerializer

def decode_cookie(cookie_value, secret_key):
    serializer = URLSafeTimedSerializer(secret_key)
    try:
        decoded_data = serializer.loads(cookie_value)
        return decoded_data
    except Exception as e:
        print(f"Error decoding cookie: {e}")
        return None
```

上記の例では、`decode_cookie`関数は`cookie_value`と`secret_key`をパラメータとして受け取ります。提供された`secret_key`で`URLSafeTimedSerializer`クラスのインスタンスを作成します。次に、シリアライザの`loads`メソッドを使用して`cookie_value`をデコードします。デコードが成功した場合、デコードされたデータが返されます。デコード中にエラーが発生した場合、エラーメッセージが表示され、`None`が返されます。

`secret_key`を安全に保管し、コードや設定ファイルで公開しないように注意してください。
```bash
flask-unsign --decode --cookie 'eyJsb2dnZWRfaW4iOmZhbHNlfQ.XDuWxQ.E2Pyb6x3w-NODuflHoGnZOEpbH8'
```
#### **ブルートフォース攻撃**

Brute Force（ブルートフォース）攻撃は、パスワードや認証情報を推測するために使用される攻撃手法です。この攻撃では、自動化されたツールを使用して、大量のパスワードの組み合わせを試行し、正しい組み合わせを見つけることを目指します。

ブルートフォース攻撃は、Webアプリケーションの脆弱性を悪用して、認証機構を回避することができます。攻撃者は、ユーザー名とパスワードの組み合わせを総当たりで試行し、正しい組み合わせを見つけることで、不正アクセスを行うことができます。

ブルートフォース攻撃を防ぐためには、強力なパスワードポリシーを実装し、アカウントロックアウト機能を使用することが重要です。また、2要素認証やCAPTCHAなどの追加のセキュリティ対策も有効です。

ブルートフォース攻撃は、時間とリソースがかかるため、攻撃者はパスワードの長さや複雑さによって成功率が変動することを理解しておく必要があります。
```bash
flask-unsign --wordlist /usr/share/wordlists/rockyou.txt --unsign --cookie '<cookie>' --no-literal-eval
```
#### **署名**

Flask supports signing the data to ensure its integrity and authenticity. The signing process involves generating a cryptographic signature for the data using a secret key. This signature can then be verified to ensure that the data has not been tampered with.

Flask provides the `itsdangerous` module for signing data. This module includes the `URLSafeSerializer` class, which can be used to sign and verify data.

To sign data using Flask, you can create an instance of the `URLSafeSerializer` class with a secret key. Then, you can use the `dumps()` method to sign the data and generate a URL-safe string representation of the signed data.

```python
from itsdangerous import URLSafeSerializer

# Create a serializer instance with a secret key
serializer = URLSafeSerializer('secret_key')

# Sign the data
signed_data = serializer.dumps(data)
```

To verify the signed data, you can use the `loads()` method of the serializer instance. This method will raise an exception if the data has been tampered with or if the signature is invalid.

```python
from itsdangerous import BadSignature

try:
    # Verify the signed data
    data = serializer.loads(signed_data)
except BadSignature:
    # Handle invalid signature
    pass
```

By using signing in Flask, you can ensure the integrity and authenticity of the data being transmitted or stored. This can be useful in preventing data tampering and unauthorized access.
```bash
flask-unsign --sign --cookie "{'logged_in': True}" --secret 'CHANGEME'
```
#### レガシー（古いバージョン）を使用した署名

Legacy versions of Flask, specifically versions 0.9 and earlier, use a different method for signing cookies compared to newer versions. This older method is considered less secure and should be avoided if possible.

To sign cookies using legacy versions of Flask, you can use the `itsdangerous` library. This library provides a `TimestampSigner` class that can be used to sign and verify cookies.

Here is an example of how to sign a cookie using the legacy method:

```python
from itsdangerous import TimestampSigner

def sign_cookie_legacy(cookie_value, secret_key):
    signer = TimestampSigner(secret_key)
    signed_cookie = signer.sign(cookie_value)
    return signed_cookie
```

In this example, the `sign_cookie_legacy` function takes the cookie value and a secret key as input. It then creates an instance of the `TimestampSigner` class using the secret key. The `sign` method is called on the signer object to sign the cookie value, and the signed cookie is returned.

To verify a signed cookie using the legacy method, you can use the `unsign` method of the `TimestampSigner` class:

```python
from itsdangerous import TimestampSigner, BadSignature

def verify_cookie_legacy(signed_cookie, secret_key):
    signer = TimestampSigner(secret_key)
    try:
        cookie_value = signer.unsign(signed_cookie)
        return cookie_value
    except BadSignature:
        return None
```

In this example, the `verify_cookie_legacy` function takes a signed cookie and a secret key as input. It creates an instance of the `TimestampSigner` class using the secret key. The `unsign` method is called on the signer object to verify the signed cookie. If the verification is successful, the original cookie value is returned. If the verification fails, `None` is returned.

It is important to note that using legacy signing methods can introduce security vulnerabilities. It is recommended to upgrade to a newer version of Flask and use the recommended signing methods for improved security.
```bash
flask-unsign --sign --cookie "{'logged_in': True}" --secret 'CHANGEME' --legacy
```
### **RIPsession**

Flask-unsignを使用して作成されたクッキーを使用してウェブサイトをブルートフォースするためのコマンドラインツールです。

{% embed url="https://github.com/Tagvi/ripsession" %}
```bash
ripsession -u 10.10.11.100 -c "{'logged_in': True, 'username': 'changeMe'}" -s password123 -f "user doesn't exist" -w wordlist.txt
```
### SQLi in FlaskセッションクッキーにおけるSQLmap

[**この例**](../../pentesting-web/sql-injection/sqlmap/#eval)では、既知の秘密を使用して、sqlmapの`eval`オプションを使用して、Flaskに対して自動的にsqlmapペイロードに署名します。

<figure><img src="../../.gitbook/assets/image (9) (1) (2).png" alt=""><figcaption></figcaption></figure>

[**Trickest**](https://trickest.io/)を使用して、世界で最も高度なコミュニティツールによって強化された**ワークフローを簡単に構築**および**自動化**します。\
今すぐアクセスを取得：

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks Cloud ☁️</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>🐦 Twitter 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 Youtube 🎥</strong></a></summary>

* **サイバーセキュリティ企業で働いていますか？** **HackTricksで会社を宣伝**したいですか？または、**最新バージョンのPEASSを入手**したいですか？または、HackTricksを**PDFでダウンロード**したいですか？[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見しましょう。独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクションです。
* [**公式のPEASS＆HackTricksのグッズ**](https://peass.creator-spring.com)を手に入れましょう。
* [**💬**](https://emojipedia.org/speech-balloon/) [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**telegramグループ**](https://t.me/peass)に**参加**するか、**Twitter**で私を**フォロー**してください[**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **ハッキングのトリックを共有するには、PRを** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **および** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **に提出してください。**

</details>
