# Flask

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks Cloud ☁️</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>🐦 Twitter 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 Youtube 🎥</strong></a></summary>

* **サイバーセキュリティ会社**で働いていますか？ **HackTricksで会社を宣伝**したいですか？または、**PEASSの最新バージョンにアクセスしたり、HackTricksをPDFでダウンロード**したいですか？[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を見つけてください。独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクションです。
* [**公式のPEASS＆HackTricksのグッズ**](https://peass.creator-spring.com)を手に入れましょう。
* [**💬**](https://emojipedia.org/speech-balloon/) [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**telegramグループ**](https://t.me/peass)に**参加**するか、**Twitter**で**フォロー**してください[**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**。**
* **ハッキングのトリックを共有するには、PRを** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **と** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **に提出してください。**

</details>

<figure><img src="../../.gitbook/assets/image (9) (1) (2).png" alt=""><figcaption></figcaption></figure>

[**Trickest**](https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks)を使用して、世界で最も高度なコミュニティツールによって強化された**ワークフローを簡単に構築**および**自動化**します。\
今すぐアクセスを取得：

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

**おそらく、CTFをプレイしている場合、Flaskアプリケーションは** [**SSTI**](../../pentesting-web/ssti-server-side-template-injection/)**に関連しているでしょう。**

## Cookies

デフォルトのクッキーセッション名は**`session`**です。

### デコーダー

オンラインのFlaskクッキーデコーダー：[https://www.kirsle.net/wizards/flask-session.cgi](https://www.kirsle.net/wizards/flask-session.cgi)

#### 手動

最初のドットまでのクッキーの最初の部分を取得し、Base64でデコードします>
```bash
echo "ImhlbGxvIg" | base64 -d
```
クッキーはパスワードを使用して署名されています。

### **Flask-Unsign**

秘密のキーを推測して、Flaskアプリケーションのセッションクッキーを取得、デコード、ブルートフォース、および作成するためのコマンドラインツールです。

{% embed url="https://pypi.org/project/flask-unsign/" %}
```bash
pip3 install flask-unsign
```
#### **Cookieのデコード**

```plaintext
The first step in analyzing a web application is to understand how it handles user sessions. One common method is through the use of cookies. Cookies are small pieces of data that are stored on the user's browser and are sent back to the server with each request.

In some cases, the cookies may be encoded or encrypted to protect the data they contain. To analyze the contents of a cookie, you will need to decode it.

There are several tools and techniques available to decode cookies. One popular tool is the "base64" encoding scheme. Base64 is a binary-to-text encoding scheme that represents binary data in an ASCII string format.

To decode a cookie encoded in base64, you can use online tools or programming libraries. For example, in Python, you can use the `base64` module to decode a base64-encoded cookie.

Here is an example of how to decode a base64-encoded cookie using Python:

```python
import base64

encoded_cookie = "SGVsbG8gV29ybGQh"
decoded_cookie = base64.b64decode(encoded_cookie).decode('utf-8')

print(decoded_cookie)
```

This will output the decoded cookie: "Hello World!".

By decoding the cookie, you can analyze the data it contains and gain insights into how the web application handles user sessions. This can be useful for identifying vulnerabilities or understanding the application's behavior.
```

Cookieのデコード
----------------

ウェブアプリケーションの解析を始める最初のステップは、ユーザーセッションの処理方法を理解することです。一般的な方法の1つは、Cookieを使用することです。Cookieは、ユーザーのブラウザに保存され、各リクエストと共にサーバーに送信される小さなデータの塊です。

場合によっては、Cookieに含まれるデータを保護するために、Cookieがエンコードまたは暗号化されていることがあります。Cookieの内容を解析するには、それをデコードする必要があります。

Cookieをデコードするためには、いくつかのツールやテクニックが利用できます。人気のあるツールの1つは、"base64"エンコーディングスキームです。Base64は、バイナリデータをASCII文字列形式で表現するバイナリ-テキストエンコーディングスキームです。

Pythonでは、オンラインツールやプログラミングライブラリを使用して、Base64でエンコードされたCookieをデコードすることができます。例えば、Pythonでは、`base64`モジュールを使用してBase64でエンコードされたCookieをデコードすることができます。

以下は、Pythonを使用してBase64でエンコードされたCookieをデコードする方法の例です。

```python
import base64

encoded_cookie = "SGVsbG8gV29ybGQh"
decoded_cookie = base64.b64decode(encoded_cookie).decode('utf-8')

print(decoded_cookie)
```

これにより、デコードされたCookie "Hello World!" が出力されます。

Cookieをデコードすることで、それが含むデータを解析し、ウェブアプリケーションがユーザーセッションを処理する方法を理解することができます。これは、脆弱性の特定やアプリケーションの動作の理解に役立ちます。
```bash
flask-unsign --decode --cookie 'eyJsb2dnZWRfaW4iOmZhbHNlfQ.XDuWxQ.E2Pyb6x3w-NODuflHoGnZOEpbH8'
```
#### **ブルートフォース攻撃**

Brute Force（ブルートフォース）攻撃は、パスワードや認証情報を推測するために、総当たりで可能なすべての組み合わせを試す攻撃手法です。この攻撃は、強力なコンピュータリソースと時間が必要ですが、脆弱なパスワードや弱い認証システムに対して効果的です。

ブルートフォース攻撃は、Webアプリケーションのセキュリティテストにおいて重要な手法です。攻撃者は、ログインフォームや認証APIなどのエンドポイントに対して、さまざまなパスワードを試すことで、正しいパスワードを特定しようとします。

ブルートフォース攻撃を防ぐためには、強力なパスワードポリシーを実装し、アカウントロックアウト機能やCAPTCHAなどのセキュリティメカニズムを導入することが重要です。また、ログイン試行回数の制限やIPアドレスのブロックなどの対策も有効です。

ブルートフォース攻撃は、セキュリティテストの一環として、合法的な目的で使用されることもあります。しかし、悪意のある攻撃者によって悪用される可能性もあるため、セキュリティ対策を適切に実施することが重要です。
```bash
flask-unsign --wordlist /usr/share/wordlists/rockyou.txt --unsign --cookie '<cookie>' --no-literal-eval
```
#### **署名**

Signing is a process used to verify the authenticity and integrity of data. In the context of web applications, signing is often used to ensure that data sent between the client and the server has not been tampered with.

In Flask, signing can be achieved using the `itsdangerous` library. This library provides a `Signer` class that can be used to sign and verify data.

To sign data in Flask, you first need to create a signer object by passing a secret key to the `Signer` class. The secret key should be a long and random string that is kept secret.

```python
from itsdangerous import Signer

secret_key = "mysecretkey"
signer = Signer(secret_key)
```

Once you have a signer object, you can use the `sign` method to sign data. The `sign` method takes a string as input and returns a signed string.

```python
data = "Hello, world!"
signed_data = signer.sign(data)
```

To verify the signed data, you can use the `unsign` method. The `unsign` method takes a signed string as input and returns the original data if the signature is valid. If the signature is invalid or the data has been tampered with, an exception will be raised.

```python
try:
    original_data = signer.unsign(signed_data)
    print(original_data)
except:
    print("Invalid signature")
```

By using signing in your Flask applications, you can ensure the integrity and authenticity of data transmitted between the client and the server. This can help prevent data tampering and unauthorized access to sensitive information.

#### **署名**

署名はデータの真正性と完全性を検証するために使用されるプロセスです。Webアプリケーションの文脈では、署名はクライアントとサーバー間で送信されるデータが改ざんされていないことを保証するためによく使用されます。

Flaskでは、`itsdangerous`ライブラリを使用して署名を実現することができます。このライブラリは、データの署名と検証を行うために使用できる`Signer`クラスを提供しています。

Flaskでデータに署名するには、まず`Signer`クラスに秘密鍵を渡すことで署名オブジェクトを作成する必要があります。秘密鍵は長くランダムな文字列であり、秘密に保持する必要があります。

```python
from itsdangerous import Signer

secret_key = "mysecretkey"
signer = Signer(secret_key)
```

署名オブジェクトを持っている場合、`sign`メソッドを使用してデータに署名することができます。`sign`メソッドは文字列を入力として受け取り、署名された文字列を返します。

```python
data = "Hello, world!"
signed_data = signer.sign(data)
```

署名されたデータを検証するには、`unsign`メソッドを使用することができます。`unsign`メソッドは署名された文字列を入力として受け取り、署名が有効であれば元のデータを返します。署名が無効であるか、データが改ざんされている場合は例外が発生します。

```python
try:
    original_data = signer.unsign(signed_data)
    print(original_data)
except:
    print("無効な署名です")
```

Flaskアプリケーションで署名を使用することで、クライアントとサーバー間で送信されるデータの完全性と真正性を保証することができます。これにより、データの改ざんや機密情報への不正アクセスを防ぐことができます。
```bash
flask-unsign --sign --cookie "{'logged_in': True}" --secret 'CHANGEME'
```
#### レガシー（古いバージョン）を使用した署名

Legacy versions of Flask, such as Flask 0.11 and below, use a different method for signing cookies compared to the current versions. In these older versions, the `itsdangerous` library is used for signing cookies.

To sign a cookie using legacy Flask versions, you can follow these steps:

1. Import the `itsdangerous` library: `from itsdangerous import Signer`.
2. Create an instance of the `Signer` class, passing in a secret key: `signer = Signer('your_secret_key')`.
3. Use the `signer.sign()` method to sign the cookie value: `signed_value = signer.sign('cookie_value')`.
4. Set the signed cookie value in the response: `response.set_cookie('cookie_name', signed_value)`.

Keep in mind that using legacy signing methods may have security implications, as newer versions of Flask have introduced improvements to the signing process. It is recommended to upgrade to the latest version of Flask and use the current signing method for better security.
```bash
flask-unsign --sign --cookie "{'logged_in': True}" --secret 'CHANGEME' --legacy
```
### **RIPsession**

flask-unsignを使用して作成されたクッキーを使用してウェブサイトをブルートフォースするためのコマンドラインツールです。

{% embed url="https://github.com/Tagvi/ripsession" %}
```bash
ripsession -u 10.10.11.100 -c "{'logged_in': True, 'username': 'changeMe'}" -s password123 -f "user doesn't exist" -w wordlist.txt
```
### FlaskセッションクッキーのSQLiにおけるSQLmap

[**この例**](../../pentesting-web/sql-injection/sqlmap/#eval)では、既知の秘密を使用して、sqlmapの`eval`オプションを使用して、Flaskに対して自動的にsqlmapペイロードに署名します。

<figure><img src="../../.gitbook/assets/image (9) (1) (2).png" alt=""><figcaption></figcaption></figure>

[**Trickest**](https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks)を使用して、世界で最も高度なコミュニティツールによって強化された**ワークフローを簡単に構築**し、自動化します。\
今すぐアクセスを取得：

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks Cloud ☁️</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>🐦 Twitter 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 Youtube 🎥</strong></a></summary>

* **サイバーセキュリティ企業で働いていますか？** **HackTricksで会社を宣伝**したいですか？または、**最新バージョンのPEASSを入手**したり、HackTricksを**PDFでダウンロード**したりしたいですか？[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見しましょう。独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクションです。
* [**公式のPEASS＆HackTricksのグッズ**](https://peass.creator-spring.com)を手に入れましょう。
* [**💬**](https://emojipedia.org/speech-balloon/) [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**telegramグループ**](https://t.me/peass)に**参加**するか、**Twitter**で私を**フォロー**してください[**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**。**
* **ハッキングのトリックを共有するには、**[**hacktricks repo**](https://github.com/carlospolop/hacktricks) **および** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **にPRを提出してください。**

</details>
