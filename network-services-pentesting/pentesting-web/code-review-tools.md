# Révision du code source / Outils SAST

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks Cloud ☁️</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>🐦 Twitter 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 Youtube 🎥</strong></a></summary>

* Travaillez-vous dans une **entreprise de cybersécurité** ? Voulez-vous voir votre **entreprise annoncée dans HackTricks** ? ou voulez-vous avoir accès à la **dernière version de PEASS ou télécharger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Découvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFT**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**💬**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR au** [**repo hacktricks**](https://github.com/carlospolop/hacktricks) **et au** [**repo hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Orientation et listes d'outils

* [**https://owasp.org/www-community/Source\_Code\_Analysis\_Tools**](https://owasp.org/www-community/Source\_Code\_Analysis\_Tools)
* [**https://github.com/analysis-tools-dev/static-analysis**](https://github.com/analysis-tools-dev/static-analysis)

## Outils multi-langages

### [Naxus - AI-Gents](https://www.naxusai.com/)

Il existe un **forfait gratuit pour la révision des PR**.

### [**Semgrep**](https://github.com/returntocorp/semgrep)

C'est un **outil Open Source**.

#### Langages pris en charge

| Catégorie     | Langages                                                                                             |
| ------------ | ----------------------------------------------------------------------------------------------------- |
| GA           | C# · Go · Java · JavaScript · JSX · JSON · PHP · Python · Ruby · Scala · Terraform · TypeScript · TSX |
| Beta         | Kotlin · Rust                                                                                         |
| Experimental | Bash · C · C++ · Clojure · Dart · Dockerfile · Elixir · HTML · Julia · Jsonnet · Lisp ·               |

#### Démarrage rapide

{% code overflow="wrap" %}
```bash
# Install https://github.com/returntocorp/semgrep#option-1-getting-started-from-the-cli
brew install semgrep

# Go to your repo code and scan
cd repo
semgrep scan --config auto
```
{% endcode %}

Vous pouvez également utiliser l'extension [**semgrep pour VSCode**](https://marketplace.visualstudio.com/items?itemName=Semgrep.semgrep) pour obtenir les résultats dans VSCode.

### [**SonarQube**](https://www.sonarsource.com/products/sonarqube/downloads/)

Il existe une version **gratuite** installable.

#### Démarrage rapide

{% code overflow="wrap" %}
```bash
# Run the paltform in docker
docker run -d --name sonarqube -e SONAR_ES_BOOTSTRAP_CHECKS_DISABLE=true -p 9000:9000 sonarqube:latest
# Install cli tool
brew install sonar-scanner

# Go to localhost:9000 and login with admin:admin or admin:sonar
# Generate a local project and then a TOKEN for it

# Using the token and from the folder with the repo, scan it
cd path/to/repo
sonar-scanner \
-Dsonar.projectKey=<project-name> \
-Dsonar.sources=. \
-Dsonar.host.url=http://localhost:9000 \
-Dsonar.token=<sonar_project_token>
```
{% endcode %}

### [**Snyk**](https://snyk.io/product/snyk-code/)

Il existe une **version gratuite installable**.

#### Démarrage rapide
```bash
# Install
sudo npm install -g snyk

# Authenticate (you can use a free account)
snyk auth

# Test for open source vulns & license issues
snyk test [--all-projects]

# Test for code vulnerabilities
## This will upload your code and you need to enable this option in: Settings > Snyk Code
snyk test code

# Test for vulns in images
snyk container test [image]

# Test for IaC vulns
snyk iac test
```
Vous pouvez également utiliser l'extension [**snyk VSCode**](https://marketplace.visualstudio.com/items?itemName=snyk-security.snyk-vulnerability-scanner) pour obtenir des résultats dans VSCode.

### CodeQL

Il existe une **version gratuite installable**.

#### Installer
```bash
brew install codeql
# Check it's correctly installed
codeql resolve qlpacks
```
Ou

{% code overflow="wrap" %}
```bash
# Download your release from https://github.com/github/codeql-action/releases
## Example
wget https://github.com/github/codeql-action/releases/download/codeql-bundle-v2.14.3/codeql-bundle-osx64.tar.gz

# Move it to the destination folder
mkdir ~/codeql
mv codeql-bundle* ~/codeql

# Decompress it
cd ~/codeql
tar -xzvf codeql-bundle-*.tar.gz
rm codeql-bundle-*.tar.gz

# Add to path
echo 'export PATH="$PATH:/Users/username/codeql/codeql"' >> ~/.zshrc

# Check it's correctly installed
## Open a new terminal
codeql resolve qlpacks
```
{% endcode %}

#### Démarrage rapide

{% code overflow="wrap" %}
```bash
# Prepare the database
## You need to export a GITHUB_TOKEN (codeql will detect languages automatically)
export GITHUB_TOKEN=ghp_32849y23hij4...
codeql database create <database> --db-cluster --source-root </path/to/repo>
## Or to indicate the languages yourself (https://docs.github.com/en/code-security/codeql-cli/getting-started-with-the-codeql-cli/preparing-your-code-for-codeql-analysis#running-codeql-database-create)
codeql database create <database> --language=<language-identifier> --source-root </path/to/repo>
## For example
export GITHUB_TOKEN=ghp_32849y23hij4...
codeql database create /tmp/codeql_db --db-cluster --source-root /path/to/repo # Generate the folder /tmp/codeql_db

# Analyze the code
codeql database analyze <database> --format=<format> --output=</out/file/path> --download
## Example
codeql database analyze /tmp/codeql_db --download --format=csv --output=/tmp/graphql_results.csv
```
{% endcode %}

Vous pouvez également utiliser l'extension [**VSCode**](https://marketplace.visualstudio.com/items?itemName=GitHub.vscode-codeql) pour obtenir les résultats dans VSCode.

### [Insider](https://github.com/insidersec/insider)

C'est **Open Source**, mais semble **non maintenu**.

#### Langages pris en charge

Java (Maven et Android), Kotlin (Android), Swift (iOS), .NET Full Framework, C# et Javascript (Node.js).

#### Démarrage rapide
```bash
# Check the correct release for your environment
$ wget https://github.com/insidersec/insider/releases/download/2.1.0/insider_2.1.0_linux_x86_64.tar.gz
$ tar -xf insider_2.1.0_linux_x86_64.tar.gz
$ chmod +x insider
$ ./insider --tech javascript  --target <projectfolder>
```
### [**DeepSource**](https://deepsource.com/pricing)&#x20;

Gratuit pour les **dépôts publics**.

## NodeJS

* **`yarn`**
```bash
# Install
brew isntall yarn
# Run
cd /path/to/repo
yarn audit
```
* [**nodejsscan**](https://github.com/ajinabraham/nodejsscan)**:** Outil de balayage de code de sécurité statique (SAST) pour les applications Node.js alimenté par [libsast](https://github.com/ajinabraham/libsast) et [semgrep](https://github.com/returntocorp/semgrep).
```bash
# Install & run
docker run -it -p 9090:9090 opensecurity/nodejsscan:latest
# Got to localhost:9090
# Upload a zip file with the code
```
* [**RetireJS**](https://github.com/RetireJS/retire.js)**:** L'objectif de Retire.js est de vous aider à détecter l'utilisation de versions de bibliothèques JS avec des vulnérabilités connues.
```bash
# Install
npm install -g retire
# Run
cd /path/to/repo
retire --colors
```
## Electron

* [**electronegativity**](https://github.com/doyensec/electronegativity)**:** C'est un outil pour identifier les mauvaises configurations et les anti-patterns de sécurité dans les applications basées sur Electron.

## Python

* [**Bandit**](https://github.com/PyCQA/bandit)**:** Bandit est un outil conçu pour trouver les problèmes de sécurité courants dans le code Python. Pour ce faire, Bandit traite chaque fichier, construit un AST à partir de celui-ci et exécute les plugins appropriés sur les nœuds AST. Une fois que Bandit a terminé de scanner tous les fichiers, il génère un rapport.
```bash
# Install
pip3 install bandit

# Run
bandit -r <path to folder>
```
* [**safety**](https://github.com/pyupio/safety): Safety vérifie les dépendances Python à la recherche de vulnérabilités de sécurité connues et suggère les mesures correctives appropriées pour les vulnérabilités détectées. Safety peut être exécuté sur les machines des développeurs, dans les pipelines CI/CD et sur les systèmes de production.
```bash
# Install
pip install safety
# Run
safety check
```
* [~~**Pyt**~~](https://github.com/python-security/pyt): Non maintenu

## .NET
```bash
# dnSpy
https://github.com/0xd4d/dnSpy

# .NET compilation
C:\Windows\Microsoft.NET\Framework64\v4.0.30319\csc.exe test.cs
```
## Java

Java est un langage de programmation orienté objet largement utilisé pour le développement d'applications. Il est couramment utilisé pour créer des applications web, des applications mobiles et des logiciels d'entreprise. Java est également utilisé dans le développement de nombreux frameworks et bibliothèques populaires.

Lors de l'examen du code Java, il existe plusieurs outils qui peuvent être utilisés pour faciliter le processus de révision du code. Ces outils peuvent aider à identifier les vulnérabilités de sécurité, les erreurs de programmation et les mauvaises pratiques de codage.

Voici quelques-uns des outils de révision de code les plus couramment utilisés pour le code Java :

- **FindBugs** : FindBugs est un outil d'analyse statique du code qui recherche les erreurs de programmation courantes et les vulnérabilités de sécurité dans le code Java. Il peut détecter des problèmes tels que des fuites de mémoire, des erreurs de gestion des exceptions et des erreurs de synchronisation.

- **Checkstyle** : Checkstyle est un outil qui vérifie si le code Java respecte les conventions de codage définies. Il peut détecter des problèmes tels que des noms de variables incorrects, des espaces inutiles et des indentations incorrectes.

- **PMD** : PMD est un outil d'analyse statique du code qui recherche les erreurs de programmation et les mauvaises pratiques de codage dans le code Java. Il peut détecter des problèmes tels que des variables inutilisées, des boucles infinies et des conditions toujours vraies ou toujours fausses.

- **SonarQube** : SonarQube est une plateforme d'analyse continue du code qui peut être utilisée pour analyser le code Java et détecter les vulnérabilités de sécurité, les erreurs de programmation et les mauvaises pratiques de codage. Il fournit des rapports détaillés sur la qualité du code et propose des recommandations pour l'améliorer.

Ces outils de révision de code peuvent être utilisés pour améliorer la qualité du code Java, identifier les problèmes de sécurité potentiels et garantir que le code respecte les meilleures pratiques de codage.
```bash
# JD-Gui
https://github.com/java-decompiler/jd-gui

# Java compilation step-by-step
javac -source 1.8 -target 1.8 test.java
mkdir META-INF
echo "Main-Class: test" > META-INF/MANIFEST.MF
jar cmvf META-INF/MANIFEST.MF test.jar test.class
```
| Tâche            | Commande                                                  |
| --------------- | --------------------------------------------------------- |
| Exécuter le Jar     | java -jar \[jar]                                          |
| Décompresser le Jar       | unzip -d \[répertoire de sortie] \[jar]                       |
| Créer le Jar      | jar -cmf META-INF/MANIFEST.MF \[jar de sortie] \*            |
| Base64 SHA256   | sha256sum \[fichier] \| cut -d' ' -f1 \| xxd -r -p \| base64 |
| Supprimer la signature  | rm META-INF/_.SF META-INF/_.RSA META-INF/\*.DSA           |
| Supprimer du Jar | zip -d \[jar] \[fichier à supprimer]                           |
| Décompiler la classe | procyon -o . \[chemin vers la classe]                             |
| Décompiler le Jar   | procyon -jar \[jar] -o \[répertoire de sortie]                |
| Compiler la classe   | javac \[chemin vers le fichier .java]                               |

## Aller
```bash
https://github.com/securego/gosec
```
## PHP

[Psalm](https://phpmagazine.net/2018/12/find-errors-in-your-php-applications-with-psalm.html) et [PHPStan](https://phpmagazine.net/2020/09/phpstan-pro-edition-launched.html).

### Plugins Wordpress

[https://www.pluginvulnerabilities.com/plugin-security-checker/](https://www.pluginvulnerabilities.com/plugin-security-checker/)

## Solidity

* [https://www.npmjs.com/package/solium](https://www.npmjs.com/package/solium)

## JavaScript

### Découverte

1. Burp:
* Spider et découvrir le contenu
* Sitemap > filtrer
* Sitemap > clic droit sur le domaine > Outils d'engagement > Trouver des scripts
2. [WaybackURLs](https://github.com/tomnomnom/waybackurls):
* `waybackurls <domain> |grep -i "\.js" |sort -u`

### Analyse statique

#### Déminifier/Embellecer/Préparer

* [https://prettier.io/playground/](https://prettier.io/playground/)
* [https://beautifier.io/](https://beautifier.io/)

#### Déobfusquer/Décompresser

**Remarque**: Il peut ne pas être possible de déobfusquer complètement.

1. Trouver et utiliser les fichiers .map:
* Si les fichiers .map sont exposés, ils peuvent être utilisés pour déobfusquer facilement.
* Couramment, foo.js.map correspond à foo.js. Recherchez-les manuellement.
* Utilisez [JS Miner](https://github.com/PortSwigger/js-miner) pour les rechercher.
* Assurez-vous d'effectuer une analyse active.
* Lisez '[Conseils/Notes](https://github.com/minamo7sen/burp-JS-Miner/wiki#tips--notes)'
* Si vous en trouvez, utilisez [Maximize](https://www.npmjs.com/package/maximize) pour déobfusquer.
2. Sans fichiers .map, essayez JSnice:
* Références: http://jsnice.org/ & https://www.npmjs.com/package/jsnice
* Conseils:
* Si vous utilisez jsnice.org, cliquez sur le bouton d'options à côté du bouton "Nicify JavaScript" et désélectionnez "Infer types" pour réduire l'encombrement du code avec des commentaires.
* Assurez-vous de ne laisser aucune ligne vide avant le script, car cela peut affecter le processus de déobfuscation et donner des résultats inexacts.
3. Utilisez console.log();
* Trouvez la valeur de retour à la fin et changez-la en `console.log(<packerReturnVariable>);` pour que le js déobfusqué soit affiché à la place d'être exécuté.
* Ensuite, collez le js modifié (et toujours obfusqué) dans https://jsconsole.com/ pour voir le js déobfusqué affiché dans la console.
* Enfin, collez la sortie déobfusquée dans https://prettier.io/playground/ pour l'embellir afin de l'analyser.
* **Remarque**: Si vous voyez toujours du js empaqueté (mais différent), il peut être empaqueté de manière récursive. Répétez le processus.

#### Analyser

Références: https://medium.com/techiepedia/javascript-code-review-guide-for-bug-bounty-hunters-c95a8aa7037a

Recherchez:

* Chargement anti-débogage
* Angular: [enableProdMode](https://blog.nvisium.com/angular-for-pentesters-part-2)
* Secrets
* Utilisez:
* [JS Miner](https://github.com/PortSwigger/js-miner)
* [RegHex](https://github.com/l4yton/RegHex) patterns
* [gf](https://github.com/tomnomnom/gf/tree/master/examples) patterns
* Recherchez des motifs pertinents dans le dictionnaire:
* pass, user, admin
* auth, login, sign, challenge, 2fa
* key, apikey, api\_key, api-key, jwt, token
* secret, security, secure
* ...
* Examen manuel
* Si une clé API est trouvée, vérifiez ici la syntaxe d'utilisation potentielle: https://github.com/streaak/keyhacks.
* Fonctions vulnérables
* InnerHTML() - Si vous trouvez cela, cela signifie qu'il y a une chance potentielle de XSS si aucune désinfection appropriée n'a lieu. Même si votre charge utile est désinfectée, ne vous inquiétez pas. Suivez le code pour savoir où se trouve la désinfection. Étudiez-le et essayez de contourner la désinfection.
* Postmessage() - Si vous avez lu mon article précédent (https://medium.com/techiepedia/what-are-sop-cors-and-ways-to-exploit-it-62a5e02100dc), vous remarquerez que Postmessage() peut entraîner un problème potentiel de CORS. Si le deuxième paramètre de la fonction est défini sur \*, vous êtes chanceux. Consultez mon article précédent pour comprendre davantage le mécanisme derrière.
* String.prototype.search() - Cette fonction semble normale. Pourquoi serait-elle une fonction dangereuse ? Eh bien, c'est parce que certains développeurs l'utilisent pour trouver l'occurrence d'une chaîne à l'intérieur d'une autre chaîne. Cependant, "." est traité comme un caractère générique dans cette fonction. Donc, si cette fonction est utilisée comme vérification de désinfection, vous pouvez simplement la contourner en entrant ".". Consultez le rapport de Filedescryptor sur hackerone: https://hackerone.com/reports/129873
* Points de terminaison et paramètres
* Utilisez [LinkFinder](https://github.com/GerbenJavado/LinkFinder) & [JS Miner](https://github.com/PortSwigger/js-miner).
* Bibliothèques et dépendances vulnérables
* Utilisez [Retire.js](https://retirejs.github.io/retire.js/) et [NPM](https://snyk.io/advisor/) (faites défiler jusqu'à la section sécurité > lien toutes les versions).
* URLs Cloud
* Utilisez [JS Miner](https://github.com/PortSwigger/js-miner).
* Sous-domaines
* Utilisez [JS Miner](https://github.com/PortSwigger/js-miner).
* Vulnérabilités de logique
* Acquérir une connaissance de la situation:
* `use strict;`?
* Recherchez des contrôles côté client:
* disable, enable, hidden, hide, show
* catch, finally, throw, try
* input, validate, verify, valid, correct, check, confirm, require, ..
* Recherchez des non-primitifs:
* function , =>
* class

### Analyse dynamique

Références

* https://www.youtube.com/watch?v=\_v8r\_t4v6hQ
* https://blog.nvisium.com/angular-for-pentesters-part-1
* https://blog.nvisium.com/angular-for-pentesters-part-2

Outils

* https://portswigger.net/burp/documentation/desktop/tools/dom-invader

#### Références moins utilisées

* https://cyberchef.org/
* https://olajs.com/javascript-prettifier
* https://jshint.com/
* https://github.com/jshint/jshint/

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks Cloud ☁️</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>🐦 Twitter 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 Youtube 🎥</strong></a></summary>

* Travaillez-vous dans une **entreprise de cybersécurité** ? Voulez-vous voir votre **entreprise annoncée dans HackTricks** ? ou voulez-vous avoir accès à la **dernière version de PEASS ou télécharger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Découvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**💬**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PRs au** [**repo hacktricks**](https://github.com/carlospolop/hacktricks) **et au** [**repo hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
