# Αποκάλυψη του CloudFlare

<details>

<summary><strong>Μάθετε το χάκινγκ του AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι για να υποστηρίξετε το HackTricks:

* Εάν θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**The PEASS Family**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε στη** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στη [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Μοιραστείτε τα χάκινγκ κόλπα σας υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>


## Κοινές Τεχνικές για την Αποκάλυψη του Cloudflare

* Μπορείτε να χρησιμοποιήσετε κάποιο υπηρεσία που σας δίνει τα **ιστορικά αρχεία DNS** του τομέα. Ίσως η ιστοσελίδα να λειτουργεί σε μια διεύθυνση IP που χρησιμοποιήθηκε προηγουμένως.
* Το ίδιο μπορεί να επιτευχθεί **ελέγχοντας τα ιστορικά πιστοποιητικά SSL** που μπορεί να δείχνουν στην αρχική διεύθυνση IP.
* Ελέγξτε επίσης **τα αρχεία DNS άλλων υποτομέων που δείχνουν απευθείας σε IP**, καθώς είναι πιθανό να δείχνουν άλλοι υποτομείς στον ίδιο διακομιστή (ίσως για να προσφέρουν FTP, mail ή οποιαδήποτε άλλη υπηρεσία).
* Εάν βρείτε ένα **SSRF μέσα στην εφαρμογή ιστοσελίδας** μπορείτε να το εκμεταλλευτείτε για να λάβετε τη διεύθυνση IP του διακομιστή.
* Αναζητήστε ένα μοναδικό κείμενο της ιστοσελίδας σε προγράμματα περιήγησης όπως το shodan (και ίσως το google και παρόμοια). Ίσως μπορείτε να βρείτε μια διεύθυνση IP με αυτό το περιεχόμενο.
* Με έναν παρόμοιο τρόπο αντί να αναζητήσετε ένα μοναδικό κείμενο μπορείτε να αναζητήσετε το εικονίδιο favicon με το εργαλείο: [https://github.com/karma9874/CloudFlare-IP](https://github.com/karma9874/CloudFlare-IP) ή με το [https://github.com/pielco11/fav-up](https://github.com/pielco11/fav-up)
* Αυτό δεν θα λειτουργήσει πολύ συχνά επειδή ο διακομιστής πρέπει να στέλνει την ίδια απόκριση όταν προσπελαύνεται με τη διεύθυνση IP, αλλά ποτέ δεν ξέρετε.

## Εργαλεία για την αποκάλυψη του Cloudflare

* Αναζητήστε τον τομέα μέσα στο [http://www.crimeflare.org:82/cfs.html](http://www.crimeflare.org:82/cfs.html) ή [https://crimeflare.herokuapp.com](https://crimeflare.herokuapp.com). Ή χρησιμοποιήστε το εργαλείο [CloudPeler](https://github.com/zidansec/CloudPeler) (το οποίο χρησιμοποιεί αυτήν την API)
* Αναζητήστε τον τομέα στο [https://leaked.site/index.php?resolver/cloudflare.0/](https://leaked.site/index.php?resolver/cloudflare.0/)
* [**CloudFlair**](https://github.com/christophetd/CloudFlair) είναι ένα εργαλείο που θα αναζητήσει χρησιμοποιώντας πιστοποιητικά Censys που περιέχουν το όνομα του τομέα, στη συνέχεια θα αναζητήσει τις IPv4 μέσα σε αυτά τα πιστοποιητικά και τέλος θα προσπαθήσει να αποκτήσει πρόσβαση στην ιστοσελίδα σε αυτές τις διευθύνσεις IP.
* [Censys](https://search.censys.io/)
* [Shodan](https://shodan.io/)
* [Bypass-firewalls-by-DNS-history](https://github.com/vincentcox/bypass-firewalls-by-DNS-history)
* Εάν έχετε ένα σύνολο πιθανών διευθύνσεων IP όπου βρίσκεται η ιστοσελίδα, μπορείτε να χρησιμοποιήσετε το [https://github.com/hakluke/hakoriginfinder](https://github.com/hakluke/hakoriginfinder)
```bash
# You can check if the tool is working with
prips 1.0.0.0/30 | hakoriginfinder -h one.one.one.one

# If you know the company is using AWS you could use the previous tool to search the
## web page inside the EC2 IPs
DOMAIN=something.com
WIDE_REGION=us
for ir in `curl https://ip-ranges.amazonaws.com/ip-ranges.json | jq -r '.prefixes[] | select(.service=="EC2") | select(.region|test("^us")) | .ip_prefix'`; do
echo "Checking $ir"
prips $ir | hakoriginfinder -h "$DOMAIN"
done
```
## Αποκάλυψη του Cloudflare από τις Cloud μηχανές

Σημείωση ότι ακόμα κι αν αυτό έγινε για μηχανές AWS, μπορεί να γίνει για οποιοδήποτε άλλο πάροχο cloud.

Για μια καλύτερη περιγραφή αυτής της διαδικασίας, ελέγξτε:

{% embed url="https://trickest.com/blog/cloudflare-bypass-discover-ip-addresses-aws/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}
```bash
# Find open ports
sudo masscan --max-rate 10000 -p80,443 $(curl -s https://ip-ranges.amazonaws.com/ip-ranges.json | jq -r '.prefixes[] | select(.service=="EC2") | .ip_prefix' | tr '\n' ' ') | grep "open"  > all_open.txt
# Format results
cat all_open.txt | sed 's,.*port \(.*\)/tcp on \(.*\),\2:\1,' | tr -d " " > all_open_formated.txt
# Search actual web pages
httpx -silent -threads 200 -l all_open_formated.txt -random-agent -follow-redirects -json -no-color -o webs.json
# Format web results and remove eternal redirects
cat webs.json | jq -r "select((.failed==false) and (.chain_status_codes | length) < 9) | .url" | sort -u > aws_webs.json

# Search via Host header
httpx -json -no-color -list aws_webs.json -header Host: cloudflare.malwareworld.com -threads 250 -random-agent -follow-redirects -o web_checks.json
```
## Παράκαμψη του Cloudflare μέσω του Cloudflare

### Εξουσιοδοτημένες Προέλευσης Σύρσματα

Αυτός ο μηχανισμός βασίζεται στα **πιστοποιητικά SSL του πελάτη** για την εξουσιοδότηση των συνδέσεων μεταξύ των αντίστροφων διακομιστών του Cloudflare και του διακομιστή προέλευσης, που ονομάζεται **mTLS**.

Αντί να διαμορφώνει το δικό του πιστοποιητικό, οι πελάτες μπορούν απλά να χρησιμοποιήσουν το πιστοποιητικό του Cloudflare για να επιτρέψουν οποιαδήποτε σύνδεση από το Cloudflare, **ανεξάρτητα από τον ενοικιαστή**.

{% hint style="danger" %}
Συνεπώς, ένας επιτιθέμενος μπορεί απλά να ορίσει ένα **τομέα στο Cloudflare χρησιμοποιώντας το πιστοποιητικό του Cloudflare και να τον κατευθύνει** προς τη διεύθυνση IP του τομέα του θύματος. Με αυτόν τον τρόπο, ορίζοντας τον δικό του τομέα εντελώς ανεπτυγμένο, το Cloudflare δεν θα προστατεύει τις αποστολές αιτήσεων.
{% endhint %}

Περισσότερες πληροφορίες [**εδώ**](https://socradar.io/cloudflare-protection-bypass-vulnerability-on-threat-actors-radar/).

### Επιτρεπόμενες Διευθύνσεις IP του Cloudflare

Αυτό θα **απορρίπτει τις συνδέσεις που δεν προέρχονται από τις** διευθύνσεις IP του Cloudflare. Αυτό είναι επίσης ευάλωτο στην προηγούμενη ρύθμιση όπου ένας επιτιθέμενος απλά **ορίζει τον δικό του τομέα στο Cloudflare** προς τη διεύθυνση IP του θύματος και το επιτίθεται.

Περισσότερες πληροφορίες [**εδώ**](https://socradar.io/cloudflare-protection-bypass-vulnerability-on-threat-actors-radar/).

## Παράκαμψη του Cloudflare για ανάκτηση πληροφοριών

### Προσωρινή Αποθήκευση

Μερικές φορές θέλετε απλά να παρακάμψετε το Cloudflare για να ανακτήσετε μόνο την ιστοσελίδα. Υπάρχουν μερικές επιλογές για αυτό:

* Χρησιμοποιήστε την αποθήκευση του Google: `https://webcache.googleusercontent.com/search?q=cache:https://www.petsathome.com/shop/en/pets/dog`
* Χρησιμοποιήστε άλλες υπηρεσίες αποθήκευσης όπως η [https://archive.org/web/](https://archive.org/web/)

### Επίλυτες του Cloudflare

Έχουν αναπτυχθεί αρκετοί επίλυτες του Cloudflare:

* [FlareSolverr](https://github.com/FlareSolverr/FlareSolverr)
* [cloudscraper](https://github.com/VeNoMouS/cloudscraper) [Οδηγός εδώ](https://scrapeops.io/python-web-scraping-playbook/python-cloudscraper/)
* [cloudflare-scrape](https://github.com/Anorov/cloudflare-scrape)
* [CloudflareSolverRe](https://github.com/RyuzakiH/CloudflareSolverRe)
* [Cloudflare-IUAM-Solver](https://github.com/ninja-beans/cloudflare-iuam-solver)
* [cloudflare-bypass](https://github.com/devgianlu/cloudflare-bypass) \[Αρχειοθετημένο]
* [CloudflareSolverRe](https://github.com/RyuzakiH/CloudflareSolverRe)

### Ενισχυμένοι Ανενεργοί Περιηγητές <a href="#option-4-scrape-with-fortified-headless-browsers" id="option-4-scrape-with-fortified-headless-browsers"></a>

Χρησιμοποιήστε έναν ανενεργό περιηγητή που δεν ανιχνεύεται ως αυτοματοποιημένος περιηγητής (μπορεί να χρειαστεί να το προσαρμόσετε για αυτό). Ορισμένες επιλογές είναι:

* **Puppeteer:** Το πρόσθετο [stealth](https://github.com/berstend/puppeteer-extra/tree/master/packages/puppeteer-extra-plugin-stealth) για το [puppeteer](https://github.com/puppeteer/puppeteer).
* **Playwright:** Το πρόσθετο [stealth](https://www.npmjs.com/package/playwright-stealth) θα έρθει σύντομα στο Playwright. Ακολουθήστε τις εξελίξεις [εδώ](https://github.com/berstend/puppeteer-extra/issues/454) και [εδώ](https://github.com/berstend/puppeteer-extra/tree/master/packages/playwright-extra).
* **Selenium:** Το [undetected-chromedriver](https://github.com/ultrafunkamsterdam/undetected-chromedriver) είναι μια βελτιστοποιημένη επιδιόρθωση του Selenium Chromedriver.

### Έξυπνος Διακομιστής Με Ενσωματωμένη Παράκαμψη του Cloudflare <a href="#option-5-smart-proxy-with-cloudflare-built-in-bypass" id="option-5-smart-proxy-with-cloudflare-built-in-bypass"></a>

Οι **έξυπνοι διακομιστές** ενημερώνονται συνεχώς από εξειδικευμένες εταιρείες, με στόχο να αντιμετωπίσουν τα μέτρα ασφαλείας τ
