# Kufunua CloudFlare

<details>

<summary><strong>Jifunze kuhusu kudukua AWS kutoka sifuri hadi shujaa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Mtaalam wa Timu Nyekundu ya AWS ya HackTricks)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako ikionekana kwenye HackTricks** au **kupakua HackTricks kwa muundo wa PDF** Angalia [**MPANGO WA KUJIUNGA**](https://github.com/sponsors/carlospolop)!
* Pata [**swag rasmi ya PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**The PEASS Family**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa [**NFTs**](https://opensea.io/collection/the-peass-family) ya kipekee
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au [**kikundi cha telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Shiriki mbinu zako za kudukua kwa kuwasilisha PR kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos za github.

</details>


## Mbinu za Kawaida za Kufunua Cloudflare

* Unaweza kutumia huduma fulani inayokupa **rekodi za DNS za zamani** za kikoa. Labda ukurasa wa wavuti unafanya kazi kwenye anwani ya IP iliyotumiwa hapo awali.
* Kitu kama hicho kinaweza kufikiwa **kwa kuangalia vyeti vya SSL vya zamani** ambavyo vinaweza kuashiria anwani ya IP ya asili.
* Angalia pia **rekodi za DNS za subdomains zingine zinazoashiria moja kwa moja kwenye IPs**, kwani inawezekana subdomains zingine zinaashiria seva ile ile (labda kutoa FTP, barua pepe au huduma nyingine yoyote).
* Ikiwa utapata **SSRF ndani ya programu ya wavuti** unaweza kuitumia kwa faida yako kupata anwani ya IP ya seva.
* Tafuta herufi ya pekee ya ukurasa wa wavuti kwenye vivinjari kama shodan (na labda google na kadhalika?). Labda unaweza kupata anwani ya IP na yaliyomo hayo.
* Kwa njia kama hiyo badala ya kutafuta herufi ya pekee unaweza kutafuta ishara ya favicon na zana: [https://github.com/karma9874/CloudFlare-IP](https://github.com/karma9874/CloudFlare-IP) au na [https://github.com/pielco11/fav-up](https://github.com/pielco11/fav-up)
* Hii haitafanya kazi mara kwa mara kwa sababu seva lazima itume jibu lile lile wakati inaingiwa kupitia anwani ya IP, lakini kamwe huwezi kujua.

## Zana za Kufunua Cloudflare

* Tafuta kikoa ndani ya [http://www.crimeflare.org:82/cfs.html](http://www.crimeflare.org:82/cfs.html) au [https://crimeflare.herokuapp.com](https://crimeflare.herokuapp.com). Au tumia zana [CloudPeler](https://github.com/zidansec/CloudPeler) (ambayo hutumia API hiyo)
* Tafuta kikoa kwenye [https://leaked.site/index.php?resolver/cloudflare.0/](https://leaked.site/index.php?resolver/cloudflare.0/)
* [**CloudFlair**](https://github.com/christophetd/CloudFlair) ni zana ambayo itatafuta kutumia vyeti vya Censys vinavyoonyesha jina la kikoa, kisha itatafuta IPv4 ndani ya vyeti hivyo na mwishowe itajaribu kufikia ukurasa wa wavuti kwenye IPs hizo.
* [Censys](https://search.censys.io/)
* [Shodan](https://shodan.io/)
* [Bypass-firewalls-by-DNS-history](https://github.com/vincentcox/bypass-firewalls-by-DNS-history)
* Ikiwa una seti ya IPs inayowezekana ambapo ukurasa wa wavuti unapatikana unaweza kutumia [https://github.com/hakluke/hakoriginfinder](https://github.com/hakluke/hakoriginfinder)
```bash
# You can check if the tool is working with
prips 1.0.0.0/30 | hakoriginfinder -h one.one.one.one

# If you know the company is using AWS you could use the previous tool to search the
## web page inside the EC2 IPs
DOMAIN=something.com
WIDE_REGION=us
for ir in `curl https://ip-ranges.amazonaws.com/ip-ranges.json | jq -r '.prefixes[] | select(.service=="EC2") | select(.region|test("^us")) | .ip_prefix'`; do
echo "Checking $ir"
prips $ir | hakoriginfinder -h "$DOMAIN"
done
```
## Kufunua Cloudflare kutoka kwenye Mashine za Wingu

Tafadhali kumbuka kuwa ingawa hii ilifanywa kwa mashine za AWS, inaweza kufanywa kwa mtoa huduma wa wingu yeyote.

Kwa maelezo zaidi juu ya mchakato huu angalia:

{% embed url="https://trickest.com/blog/cloudflare-bypass-discover-ip-addresses-aws/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}
```bash
# Find open ports
sudo masscan --max-rate 10000 -p80,443 $(curl -s https://ip-ranges.amazonaws.com/ip-ranges.json | jq -r '.prefixes[] | select(.service=="EC2") | .ip_prefix' | tr '\n' ' ') | grep "open"  > all_open.txt
# Format results
cat all_open.txt | sed 's,.*port \(.*\)/tcp on \(.*\),\2:\1,' | tr -d " " > all_open_formated.txt
# Search actual web pages
httpx -silent -threads 200 -l all_open_formated.txt -random-agent -follow-redirects -json -no-color -o webs.json
# Format web results and remove eternal redirects
cat webs.json | jq -r "select((.failed==false) and (.chain_status_codes | length) < 9) | .url" | sort -u > aws_webs.json

# Search via Host header
httpx -json -no-color -list aws_webs.json -header Host: cloudflare.malwareworld.com -threads 250 -random-agent -follow-redirects -o web_checks.json
```
## Kupita Cloudflare kupitia Cloudflare

### Kuthibitisha Kuvuta Asili

Mfumo huu unategemea **vyeti vya SSL** vya **mteja** **kuthibitisha uhusiano** kati ya seva za **kigeuzi cha nyuma cha Cloudflare** na seva ya **asili**, ambayo inaitwa **mTLS**.

Badala ya kusanidi cheti chake, wateja wanaweza kutumia cheti cha Cloudflare kuruhusu uhusiano wowote kutoka Cloudflare, **bila kujali mpangaji**.

{% hint style="danger" %}
Kwa hivyo, mshambuliaji anaweza tu kuweka **kikoa katika Cloudflare kwa kutumia cheti cha Cloudflare na kuelekeza** kwa anwani ya IP ya kikoa cha **mwathirika**. Kwa njia hii, kwa kuweka kikoa chake bila ulinzi kabisa, Cloudflare haitalinda maombi yaliyotumwa.
{% endhint %}

Maelezo zaidi [**hapa**](https://socradar.io/cloudflare-protection-bypass-vulnerability-on-threat-actors-radar/).

### Kuruhusu Anwani za IP za Cloudflare

Hii ita**kataa uhusiano ambao haukuanzia kwa Cloudflare** katika safu za anwani za IP za Cloudflare. Hii pia ina hatari kama mpangilio uliopita ambapo mshambuliaji tu anaweza **kuweka kikoa chake mwenyewe katika Cloudflare** kwa anwani ya IP ya **mwathirika** na kumshambulia.

Maelezo zaidi [**hapa**](https://socradar.io/cloudflare-protection-bypass-vulnerability-on-threat-actors-radar/).

## Kupita Cloudflare kwa ajili ya kuchimba

### Akiba

Marafiki unaweza tu kupita Cloudflare ili kuchimba ukurasa wa wavuti. Kuna chaguzi kadhaa kwa hili:

* Tumia akiba ya Google: `https://webcache.googleusercontent.com/search?q=cache:https://www.petsathome.com/shop/en/pets/dog`
* Tumia huduma nyingine za akiba kama [https://archive.org/web/](https://archive.org/web/)

### Wapatanishi wa Cloudflare

Kumekuwa na wapatanishi kadhaa wa Cloudflare waliotengenezwa:

* [FlareSolverr](https://github.com/FlareSolverr/FlareSolverr)
* [cloudscraper](https://github.com/VeNoMouS/cloudscraper) [Mwongozo hapa](https://scrapeops.io/python-web-scraping-playbook/python-cloudscraper/)
* [cloudflare-scrape](https://github.com/Anorov/cloudflare-scrape)
* [CloudflareSolverRe](https://github.com/RyuzakiH/CloudflareSolverRe)
* [Cloudflare-IUAM-Solver](https://github.com/ninja-beans/cloudflare-iuam-solver)
* [cloudflare-bypass](https://github.com/devgianlu/cloudflare-bypass) \[Imehifadhiwa]
* [CloudflareSolverRe](https://github.com/RyuzakiH/CloudflareSolverRe)

### Vivinjari Visivyoonekana vya Fortified <a href="#option-4-scrape-with-fortified-headless-browsers" id="option-4-scrape-with-fortified-headless-browsers"></a>

Tumia kivinjari kisichotambulika kama kivinjari cha moja kwa moja (unaweza kuhitaji kubinafsisha hilo). Baadhi ya chaguzi ni:

* **Puppeteer:** [Programu-jalizi ya siri](https://github.com/berstend/puppeteer-extra/tree/master/packages/puppeteer-extra-plugin-stealth) kwa [puppeteer](https://github.com/puppeteer/puppeteer).
* **Playwright:** [Programu-jalizi ya siri](https://www.npmjs.com/package/playwright-stealth) inakuja hivi karibuni kwa Playwright. Fuatilia maendeleo [hapa](https://github.com/berstend/puppeteer-extra/issues/454) na [hapa](https://github.com/berstend/puppeteer-extra/tree/master/packages/playwright-extra).
* **Selenium:** [undetected-chromedriver](https://github.com/ultrafunkamsterdam/undetected-chromedriver) ni kipande cha kuboreshwa cha Selenium Chromedriver.

### Wapatanishi Wenye Akili na Kupita kwa Cloudflare Imejengwa-ndani <a href="#option-5-smart-proxy-with-cloudflare-built-in-bypass" id="option-5-smart-proxy-with-cloudflare-built-in-bypass"></a>

Wapatanishi wenye akili ni wapatanishi ambao hupata sasisho mara kwa mara kutoka kwa kampuni maalum, wakilenga kuzidi hatua za usalama za Cloudflare (kwa sababu hiyo ndiyo biashara yao).

Baadhi yao ni:
* [ScraperAPI](https://www.scraperapi.com/?fp_ref=scrapeops)
* [Scrapingbee](https://www.scrapingbee.com/?fpr=scrapeops)
* [Oxylabs](https://oxylabs.go2cloud.org/aff_c?offer_id=7&aff_id=379&url_id=32)
* [Smartproxy](https://prf.hn/click/camref:1100loxdG/[p_id:1100l442001]/destination:https%3A%2F%2Fsmartproxy.com%2Fscraping%2Fweb) wanajulikana kwa njia zao za kuvuka Cloudflare.

Kwa wale wanaotafuta suluhisho lililoboreshwa, [ScrapeOps Proxy Aggregator](https://scrapeops.io/proxy-aggregator/) inaonekana kuwa bora. Huduma hii inaunganisha zaidi ya watoa huduma wa wapatanishi 20 katika API moja, ikichagua moja bora na yenye gharama nafuu zaidi kwa anwani zako za lengo, hivyo kutoa chaguo bora kwa kuvuka ulinzi wa Cloudflare.

### Rekebisha Ulinzi wa Cloudflare Dhidi ya Bots <a href="#option-6-reverse-engineer-cloudflare-anti-bot-protection" id="option-6-reverse-engineer-cloudflare-anti-bot-protection"></a>

Kurekebisha ulinzi wa Cloudflare dhidi ya bots ni mkakati unaotumiwa na watoa wapatanishi wenye akili, unaofaa kwa uchimbaji wa wavuti kwa kiasi kikubwa bila gharama kubwa ya kuendesha vivinjari vingi vya moja kwa moja.

**Faida:** Njia hii inaruhusu kuunda njia ya kuvuka kwa ufanisi sana ambayo inalenga hasa ukaguzi wa Cloudflare, ambayo ni nzuri kwa shughuli za kiwango kikubwa.

**Hasara:** Kupungua ni ugumu wa kuelewa na kudanganya mfumo wa kuzuia bots wa Cloudflare ambao ni wa kusudi la kuficha, na inahitaji jitihada endelevu za kujaribu mikakati tofauti na kusasisha njia ya kuvuka wakati Cloudflare inaboresha ulinzi wake.

Pata maelezo zaidi juu ya jinsi ya kufanya hivi katika [makala ya awali](https://scrapeops.io/web-scraping-playbook/how-to-bypass-cloudflare/).



## Marejeo

* [https://scrapeops.io/web-scraping-playbook/how-to-bypass-cloudflare/](https://scrapeops.io/web-scraping-playbook/how-to-bypass-cloudflare/)

<details>

<summary><strong>Jifunze kuhusu kudukua AWS kutoka sifuri hadi shujaa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako inayotangazwa katika HackTricks** au **kupakua HackTricks katika PDF** Angalia [**MPANGO WA KUJIUNGA**](https://github.com/sponsors/carlospolop)!
* Pata [**swag rasmi wa PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**The PEASS Family**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa [**NFTs**](https://opensea.io/collection/the-peass-family) ya kipekee
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au [**kikundi cha telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Shiriki mbinu zako za kudukua kwa kuwasilisha PR kwa** [**HackTricks**](https://github.com/carlosp
