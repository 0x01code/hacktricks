# CloudFlare'nin Ortaya Çıkarılması

<details>

<summary><strong>AWS hackleme konusunda sıfırdan kahramana dönüşmek için</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Kırmızı Takım Uzmanı)</strong></a><strong>'ı öğrenin!</strong></summary>

HackTricks'i desteklemenin diğer yolları:

* Şirketinizi HackTricks'te **reklamınızı görmek** veya **HackTricks'i PDF olarak indirmek** için [**ABONELİK PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* [**PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keşfedin, özel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın** veya **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)'u **takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına **PR göndererek paylaşın**.

</details>


## Cloudflare'i Ortaya Çıkarmak İçin Yaygın Teknikler

* Alan adının **geçmiş DNS kayıtlarını** veren bir hizmet kullanabilirsiniz. Belki web sayfası daha önce kullanılan bir IP adresinde çalışıyor.
* Aynı şekilde, **geçmiş SSL sertifikalarını kontrol ederek** orijin IP adresine işaret edebilirsiniz.
* Ayrıca, doğrudan IP adreslerine işaret eden **diğer alt alanların DNS kayıtlarını kontrol edin**, çünkü diğer alt alanlar aynı sunucuya işaret ediyor olabilir (belki FTP, posta veya başka bir hizmet sunmak için).
* Web uygulaması içinde bir **SSRF bulursanız**, bunu istismar ederek sunucunun IP adresini elde edebilirsiniz.
* Shodan gibi tarayıcılarda web sayfasının benzersiz bir dizesini arayarak (ve belki de Google ve benzeri yerlerde) bir IP adresi bulabilirsiniz.
* Benzer bir şekilde, benzersiz bir dize yerine favicon simgesini [https://github.com/karma9874/CloudFlare-IP](https://github.com/karma9874/CloudFlare-IP) veya [https://github.com/pielco11/fav-up](https://github.com/pielco11/fav-up) aracıyla arayabilirsiniz.
* Bu, sunucunun IP adresiyle erişildiğinde aynı yanıtı göndermesi gerektiği için çok sık çalışmayabilir, ancak asla bilemezsiniz.

## Cloudflare'i Ortaya Çıkarmak İçin Araçlar

* Alan adını [http://www.crimeflare.org:82/cfs.html](http://www.crimeflare.org:82/cfs.html) veya [https://crimeflare.herokuapp.com](https://crimeflare.herokuapp.com) adresinde arayın. Veya [CloudPeler](https://github.com/zidansec/CloudPeler) aracını kullanın (bu API'yi kullanır).
* Alan adını [https://leaked.site/index.php?resolver/cloudflare.0/](https://leaked.site/index.php?resolver/cloudflare.0/) adresinde arayın.
* [**CloudFlair**](https://github.com/christophetd/CloudFlair), alan adını içeren Censys sertifikalarını arayacak, ardından bu sertifikalardaki IPv4'leri arayacak ve son olarak bu IP'lerdeki web sayfasına erişmeye çalışacaktır.
* [Censys](https://search.censys.io/)
* [Shodan](https://shodan.io/)
* [Bypass-firewalls-by-DNS-history](https://github.com/vincentcox/bypass-firewalls-by-DNS-history)
* Web sayfasının bulunduğu potansiyel IP setine sahipseniz [https://github.com/hakluke/hakoriginfinder](https://github.com/hakluke/hakoriginfinder) aracını kullanabilirsiniz.
```bash
# You can check if the tool is working with
prips 1.0.0.0/30 | hakoriginfinder -h one.one.one.one

# If you know the company is using AWS you could use the previous tool to search the
## web page inside the EC2 IPs
DOMAIN=something.com
WIDE_REGION=us
for ir in `curl https://ip-ranges.amazonaws.com/ip-ranges.json | jq -r '.prefixes[] | select(.service=="EC2") | select(.region|test("^us")) | .ip_prefix'`; do
echo "Checking $ir"
prips $ir | hakoriginfinder -h "$DOMAIN"
done
```
## Bulut makinelerinden Cloudflare'ı ortaya çıkarma

Bu işlem AWS makineleri için yapılmış olsa da, herhangi bir diğer bulut sağlayıcı için de yapılabilir.

Bu sürecin daha iyi bir açıklaması için şuraya bakın:

{% embed url="https://trickest.com/blog/cloudflare-bypass-discover-ip-addresses-aws/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}
```bash
# Find open ports
sudo masscan --max-rate 10000 -p80,443 $(curl -s https://ip-ranges.amazonaws.com/ip-ranges.json | jq -r '.prefixes[] | select(.service=="EC2") | .ip_prefix' | tr '\n' ' ') | grep "open"  > all_open.txt
# Format results
cat all_open.txt | sed 's,.*port \(.*\)/tcp on \(.*\),\2:\1,' | tr -d " " > all_open_formated.txt
# Search actual web pages
httpx -silent -threads 200 -l all_open_formated.txt -random-agent -follow-redirects -json -no-color -o webs.json
# Format web results and remove eternal redirects
cat webs.json | jq -r "select((.failed==false) and (.chain_status_codes | length) < 9) | .url" | sort -u > aws_webs.json

# Search via Host header
httpx -json -no-color -list aws_webs.json -header Host: cloudflare.malwareworld.com -threads 250 -random-agent -follow-redirects -o web_checks.json
```
## Cloudflare'ı Cloudflare ile Geçme

### Kimlik Doğrulamalı Kaynak İsteği

Bu mekanizma, **mTLS** olarak adlandırılan **Cloudflare'ın ters proxy** sunucuları ile **kaynak** sunucusu arasındaki bağlantıları **müşteri** [**SSL sertifikaları**](https://socradar.io/how-to-monitor-your-ssl-certificates-expiration-easily-and-why/) **ile doğrulamaya** dayanır.

Müşteriler, kendi sertifikalarını yapılandırmak yerine, Cloudflare'ın sertifikasını kullanarak Cloudflare'dan gelen herhangi bir bağlantıya izin verebilir, **kiracıdan bağımsız olarak**.

{% hint style="danger" %}
Bu nedenle, bir saldırgan, Cloudflare'ın sertifikasını kullanarak bir **alan adını Cloudflare'a ayarlayabilir ve** onu **kurban** alan adının **IP** adresine yönlendirebilir. Bu şekilde, kendi alan adını tamamen korumasız bir şekilde ayarlayarak, Cloudflare gönderilen istekleri korumaz.
{% endhint %}

Daha fazla bilgi için [**buraya**](https://socradar.io/cloudflare-protection-bypass-vulnerability-on-threat-actors-radar/) bakın.

### Cloudflare IP Adreslerini Beyaz Listeye Alma

Bu, **Cloudflare'dan kaynaklanmayan bağlantıları reddeder**. Bu, bir saldırganın kendi alan adını Cloudflare'a yönlendirdiği ve kurbanın IP adresine saldırdığı önceki yapılandırmaya da savunmasızdır.

Daha fazla bilgi için [**buraya**](https://socradar.io/cloudflare-protection-bypass-vulnerability-on-threat-actors-radar/) bakın.

## Kazıma için Cloudflare'ı Geçme

### Önbellek

Bazen sadece web sayfasını kazımak için Cloudflare'ı geçmek istersiniz. Bunun için bazı seçenekler vardır:

* Google önbelleğini kullanın: `https://webcache.googleusercontent.com/search?q=cache:https://www.petsathome.com/shop/en/pets/dog`
* [https://archive.org/web/](https://archive.org/web/) gibi diğer önbellek hizmetlerini kullanın

### Cloudflare Çözücüleri

Birçok Cloudflare çözücüsü geliştirilmiştir:

* [FlareSolverr](https://github.com/FlareSolverr/FlareSolverr)
* [cloudscraper](https://github.com/VeNoMouS/cloudscraper) [Kılavuz burada](https://scrapeops.io/python-web-scraping-playbook/python-cloudscraper/)
* [cloudflare-scrape](https://github.com/Anorov/cloudflare-scrape)
* [CloudflareSolverRe](https://github.com/RyuzakiH/CloudflareSolverRe)
* [Cloudflare-IUAM-Solver](https://github.com/ninja-beans/cloudflare-iuam-solver)
* [cloudflare-bypass](https://github.com/devgianlu/cloudflare-bypass) \[Arşivlenmiş]
* [CloudflareSolverRe](https://github.com/RyuzakiH/CloudflareSolverRe)

### Güçlendirilmiş Başsız Tarayıcılar <a href="#option-4-scrape-with-fortified-headless-browsers" id="option-4-scrape-with-fortified-headless-browsers"></a>

Otomatik bir tarayıcı olarak algılanmayan bir başsız tarayıcı kullanın (bunu özelleştirmeniz gerekebilir). Bazı seçenekler şunlardır:

* **Puppeteer:** [puppeteer](https://github.com/puppeteer/puppeteer) için [gizlilik eklentisi](https://github.com/berstend/puppeteer-extra/tree/master/packages/puppeteer-extra-plugin-stealth).
* **Playwright:** [Playwright](https://github.com/microsoft/playwright) için [gizlilik eklentisi](https://www.npmjs.com/package/playwright-stealth) yakında gelecek. Gelişmeleri [buradan](https://github.com/berstend/puppeteer-extra/issues/454) ve [buradan](https://github.com/berstend/puppeteer-extra/tree/master/packages/playwright-extra) takip edin.
* **Selenium:** [undetected-chromedriver](https://github.com/ultrafunkamsterdam/undetected-chromedriver) optimize edilmiş bir Selenium Chromedriver yaması.

### Cloudflare İçeren Akıllı Proxy <a href="#option-5-smart-proxy-with-cloudflare-built-in-bypass" id="option-5-smart-proxy-with-cloudflare-built-in-bypass"></a>

**Akıllı proxy'ler**, Cloudflare'ın güvenlik önlemlerini atlatmayı hedefleyen özel şirketler tarafından sürekli güncellenen proxy'lerdir (çünkü bu onların işidir).

Bunlardan bazıları şunlardır:
* [ScraperAPI](https://www.scraperapi.com/?fp_ref=scrapeops)
* [Scrapingbee](https://www.scrapingbee.com/?fpr=scrapeops)
* [Oxylabs](https://oxylabs.go2cloud.org/aff_c?offer_id=7&aff_id=379&url_id=32)
* [Smartproxy](https://prf.hn/click/camref:1100loxdG/[p_id:1100l442001]/destination:https%3A%2F%2Fsmartproxy.com%2Fscraping%2Fweb) özel Cloudflare atlatma mekanizmalarıyla bilinir.

Optimize edilmiş bir çözüm arayanlar için [ScrapeOps Proxy Aggregator](https://scrapeops.io/proxy-aggregator/) öne çıkar. Bu hizmet, 20'den fazla proxy sağlayıcıyı tek bir API'ye entegre ederek, hedef alanlarınız için en iyi ve maliyet etkin proxy'yi otomatik olarak seçer ve böylece Cloudflare'ın savunmalarını geçmek için üstün bir seçenek sunar.

### Cloudflare Anti-Bot Korumasını Tersine Mühendislik Yapma <a href="#option-6-reverse-engineer-cloudflare-anti-bot-protection" id="option-6-reverse-engineer-cloudflare-anti-bot-protection"></a>

Cloudflare'ın anti-bot önlemlerini tersine mühendislik yapmak, birçok başsız tarayıcı çalıştırmak için yüksek maliyetli olmadan geniş çaplı web kazıma için kullanılan bir taktiktir.

**Avantajlar:** Bu yöntem, büyük ölçekli operasyonlar için ideal olan Cloudflare'ın kontrollerine özel olarak hedeflenen son derece verimli bir atlatma oluşturmayı sağlar.

**Dezavantajlar:** Dezavantajı, Cloudflare'ın kasıtlı olarak belirsiz olan anti-bot sistemini anlama ve aldatma karmaşıklığıdır. Farklı stratejileri test etmek ve Cloudflare korumalarını geliştirdikçe atlatmayı güncellemek için sürekli çaba gerektirir.

Bunu nasıl yapacağınıza dair daha fazla bilgiyi [orijinal makalede](https://scrapeops.io/web-scraping-playbook/how-to-bypass-cloudflare/) bulabilirsiniz.



## Referanslar

* [https://scrapeops.io/web-scraping-playbook/how-to-bypass-cloudflare/](https://scrapeops.io/web-scraping-playbook/how-to-bypass-cloudflare/)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sıfırdan kahraman olmak için AWS hackleme öğrenin</summary>

HackTricks'ı desteklemenin diğer yolları:

* Şirketinizi HackTricks'te **reklam vermek veya HackTricks'ı PDF olarak indirmek** için [**ABONELİK PLANLARINA**](https://github.com/sponsors/carlospolop) göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* Özel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluşan koleksiyonumuz olan [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'yi keşfedin
* **💬 Discord grubuna** [**katılın**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) veya **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)'u **takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna **PR göndererek** paylaşın.

</details>
