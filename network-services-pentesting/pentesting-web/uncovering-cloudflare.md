# Kufunua CloudFlare

<details>

<summary><strong>Jifunze kuhusu kudukua AWS kutoka sifuri hadi shujaa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako ikitangazwa kwenye HackTricks** au **kupakua HackTricks kwa PDF** Angalia [**MIPANGO YA KUJIUNGA**](https://github.com/sponsors/carlospolop)!
* Pata [**bidhaa rasmi za PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**Familia ya PEASS**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa [**NFTs**](https://opensea.io/collection/the-peass-family) ya kipekee
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au kikundi cha [**telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Shiriki mbinu zako za kudukua kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos za github.

</details>

## Mbinu za Kawaida za Kufunua Cloudflare

* Unaweza kutumia huduma inayokupa **rekodi za DNS za zamani** za kikoa. Labda ukurasa wa wavuti unatumika kwenye anwani ya IP iliyotumiwa hapo awali.
* Vivyo hivyo unaweza kufikia **kuangalia vyeti vya SSL vya zamani** ambavyo vinaweza kuashiria anwani ya IP ya asili.
* Angalia pia **rekodi za DNS za subdomains zingine zinazoashiria moja kwa moja kwenye IPs**, kwani inawezekana kwamba subdomains zingine zinaelekeza kwenye seva ile ile (labda kutoa FTP, barua pepe au huduma nyingine yoyote).
* Ikiwa unapata **SSRF ndani ya programu-jalizi ya wavuti** unaweza kuitumia kudhuru kupata anwani ya IP ya seva.
* Tafuta string ya kipekee ya ukurasa wa wavuti kwenye vivinjari kama shodan (na labda google na kadhalika?). Labda unaweza kupata anwani ya IP na yaliyomo hayo.
* Kwa njia sawa badala ya kutafuta string ya kipekee unaweza kutafuta icon ya favicon na zana: [https://github.com/karma9874/CloudFlare-IP](https://github.com/karma9874/CloudFlare-IP) au na [https://github.com/pielco11/fav-up](https://github.com/pielco11/fav-up)
* Hii haitafanya kazi mara kwa mara kwa sababu seva lazima itume jibu lile lile linapofikiwa kwa anwani ya IP, lakini kamwe hujui.

## Zana za Kufunua Cloudflare

* Tafuta kikoa ndani ya [http://www.crimeflare.org:82/cfs.html](http://www.crimeflare.org:82/cfs.html) au [https://crimeflare.herokuapp.com](https://crimeflare.herokuapp.com). Au tumia zana [CloudPeler](https://github.com/zidansec/CloudPeler) (ambayo hutumia API hiyo)
* Tafuta kikoa katika [https://leaked.site/index.php?resolver/cloudflare.0/](https://leaked.site/index.php?resolver/cloudflare.0/)
* [**CloudFlair**](https://github.com/christophetd/CloudFlair) ni zana itakayotafuta kutumia vyeti vya Censys vinavyoleta jina la kikoa, kisha itatafuta IPv4 ndani ya vyeti hivyo na mwishowe itajaribu kufikia ukurasa wa wavuti kwenye IPs hizo.
* [**CloakQuest3r**](https://github.com/spyboy-productions/CloakQuest3r): CloakQuest3r ni zana yenye nguvu ya Python iliyoundwa kwa umakini kufunua anwani halisi ya IP ya wavuti zilizolindwa na Cloudflare na njia mbadala zingine, huduma maarufu ya usalama wa wavuti na uboreshaji wa utendaji. Kazi yake kuu ni kutambua kwa usahihi anwani halisi ya IP ya seva za wavuti zilizofichwa nyuma ya kinga ya ulinzi ya Cloudflare.
* [Censys](https://search.censys.io/)
* [Shodan](https://shodan.io/)
* [Bypass-firewalls-by-DNS-history](https://github.com/vincentcox/bypass-firewalls-by-DNS-history)
* Ikiwa una seti ya IPs za uwezekano ambapo ukurasa wa wavuti unapatikana unaweza kutumia [https://github.com/hakluke/hakoriginfinder](https://github.com/hakluke/hakoriginfinder)
```bash
# You can check if the tool is working with
prips 1.0.0.0/30 | hakoriginfinder -h one.one.one.one

# If you know the company is using AWS you could use the previous tool to search the
## web page inside the EC2 IPs
DOMAIN=something.com
WIDE_REGION=us
for ir in `curl https://ip-ranges.amazonaws.com/ip-ranges.json | jq -r '.prefixes[] | select(.service=="EC2") | select(.region|test("^us")) | .ip_prefix'`; do
echo "Checking $ir"
prips $ir | hakoriginfinder -h "$DOMAIN"
done
```
## Kufunua Cloudflare kutoka kwa Mashine za Cloud

Tafadhali kumbuka kwamba hata kama hii ilifanywa kwa mashine za AWS, inaweza kufanywa kwa mtoa huduma mwingine yeyote wa wingu.

Kwa maelezo zaidi kuhusu mchakato huu angalia:

{% embed url="https://trickest.com/blog/cloudflare-bypass-discover-ip-addresses-aws/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}
```bash
# Find open ports
sudo masscan --max-rate 10000 -p80,443 $(curl -s https://ip-ranges.amazonaws.com/ip-ranges.json | jq -r '.prefixes[] | select(.service=="EC2") | .ip_prefix' | tr '\n' ' ') | grep "open"  > all_open.txt
# Format results
cat all_open.txt | sed 's,.*port \(.*\)/tcp on \(.*\),\2:\1,' | tr -d " " > all_open_formated.txt
# Search actual web pages
httpx -silent -threads 200 -l all_open_formated.txt -random-agent -follow-redirects -json -no-color -o webs.json
# Format web results and remove eternal redirects
cat webs.json | jq -r "select((.failed==false) and (.chain_status_codes | length) < 9) | .url" | sort -u > aws_webs.json

# Search via Host header
httpx -json -no-color -list aws_webs.json -header Host: cloudflare.malwareworld.com -threads 250 -random-agent -follow-redirects -o web_checks.json
```
## Kupitisha Cloudflare kupitia Cloudflare

### Kuvuta Asili Iliyothibitishwa

Mfumo huu unategemea **vyeti vya SSL vya wateja** kuthibitisha uhusiano kati ya seva za **reverse-proxy za Cloudflare** na seva ya **asili**, ambayo inaitwa **mTLS**.

Badala ya kusanidi cheti chake, wateja wanaweza tu kutumia cheti cha Cloudflare kuruhusu uhusiano wowote kutoka Cloudflare, **bila kujali mpangaji**.

{% hint style="danger" %}
Hivyo, mshambuliaji anaweza tu kuweka **kikoa katika Cloudflare kwa kutumia cheti cha Cloudflare na kuelekeza** kwa anwani ya **IP ya kikoa cha muathirika**. Kwa njia hii, kwa kuweka kikoa chake bila ulinzi kabisa, Cloudflare haitalinda maombi yanayotumwa.
{% endhint %}

Maelezo zaidi [**hapa**](https://socradar.io/cloudflare-protection-bypass-vulnerability-on-threat-actors-radar/).

### Rudisha Anwani za IP za Cloudflare

Hii ita **kataa uhusiano usiotoka kwa** anwani za IP za **Cloudflare**. Hii pia inaweza kuwa hatarini kwa usanidi uliopita ambapo mshambuliaji anaweza tu **kuuelekeza kikoa chake mwenyewe katika Cloudflare** kwa anwani ya **IP ya muathirika** na kumshambulia.

Maelezo zaidi [**hapa**](https://socradar.io/cloudflare-protection-bypass-vulnerability-on-threat-actors-radar/).

## Kupitisha Cloudflare kwa kuchimba

### Akiba

Maranyingine unaweza tu kutaka kupitisha Cloudflare ili kuchimba ukurasa wa wavuti. Kuna chaguo kadhaa kwa hili:

* Tumia akiba ya Google: `https://webcache.googleusercontent.com/search?q=cache:https://www.petsathome.com/shop/en/pets/dog`
* Tumia huduma zingine za akiba kama [https://archive.org/web/](https://archive.org/web/)

### Wabunifu wa Cloudflare

Kumekuwa na wabunifu kadhaa wa Cloudflare waliotengenezwa:

* [FlareSolverr](https://github.com/FlareSolverr/FlareSolverr)
* [cloudscraper](https://github.com/VeNoMouS/cloudscraper) [Mwongozo hapa](https://scrapeops.io/python-web-scraping-playbook/python-cloudscraper/)
* [cloudflare-scrape](https://github.com/Anorov/cloudflare-scrape)
* [CloudflareSolverRe](https://github.com/RyuzakiH/CloudflareSolverRe)
* [Cloudflare-IUAM-Solver](https://github.com/ninja-beans/cloudflare-iuam-solver)
* [cloudflare-bypass](https://github.com/devgianlu/cloudflare-bypass) \[Imehifadhiwa]
* [CloudflareSolverRe](https://github.com/RyuzakiH/CloudflareSolverRe)

### Vivinjari Visivyo na Kichwa Vilivyofanywa Imara <a href="#option-4-scrape-with-fortified-headless-browsers" id="option-4-scrape-with-fortified-headless-browsers"></a>

Tumia kivinjari kisichogunduliwa kama kivinjari cha moja kwa moja (inaweza kuhitaji kubadilishwa kwa hilo). Baadhi ya chaguo ni:

* **Puppeteer:** Programu-jalizi ya [stealth](https://github.com/berstend/puppeteer-extra/tree/master/packages/puppeteer-extra-plugin-stealth) kwa [puppeteer](https://github.com/puppeteer/puppeteer).
* **Playwright:** Programu-jalizi ya [stealth](https://www.npmjs.com/package/playwright-stealth) inakuja kwa Playwright hivi karibuni. Fuatilia maendeleo [hapa](https://github.com/berstend/puppeteer-extra/issues/454) na [hapa](https://github.com/berstend/puppeteer-extra/tree/master/packages/playwright-extra).
* **Selenium:** [undetected-chromedriver](https://github.com/ultrafunkamsterdam/undetected-chromedriver) ni kifurushi kilichoboreshwa cha Selenium Chromedriver.

### Proksi Mjanja na Kupitisha Imara wa Cloudflare <a href="#option-5-smart-proxy-with-cloudflare-built-in-bypass" id="option-5-smart-proxy-with-cloudflare-built-in-bypass"></a>

Proksi mjanja hupatiwa sasisho mara kwa mara na kampuni maalum, zikilenga kuzidi mbinu za usalama za Cloudflare (kwa kuwa hiyo ni biashara yao).

Baadhi yao ni:

* [ScraperAPI](https://www.scraperapi.com/?fp\_ref=scrapeops)
* [Scrapingbee](https://www.scrapingbee.com/?fpr=scrapeops)
* [Oxylabs](https://oxylabs.go2cloud.org/aff\_c?offer\_id=7\&aff\_id=379\&url\_id=32)
* [Smartproxy](https://prf.hn/click/camref:1100loxdG/\[p\_id:1100l442001]/destination:https%3A%2F%2Fsmartproxy.com%2Fscraping%2Fweb) zinajulikana kwa mifumo yao ya kipekee ya kupitisha Cloudflare.

Kwa wale wanaotafuta suluhisho lililoboreshwa, [ScrapeOps Proxy Aggregator](https://scrapeops.io/proxy-aggregator/) inaonekana. Huduma hii inaunganisha zaidi ya watoa proksi 20 katika API moja, ikichagua moja bora na yenye gharama nafuu zaidi kiotomatiki kwa uwanja wako lengwa, hivyo kutoa chaguo bora kwa kuvuka ulinzi wa Cloudflare.

### Geuza Mfumo wa Kinga wa Cloudflare Dhidi ya Bots <a href="#option-6-reverse-engineer-cloudflare-anti-bot-protection" id="option-6-reverse-engineer-cloudflare-anti-bot-protection"></a>

Kugeuza mfumo wa kinga wa Cloudflare dhidi ya bots ni mkakati unaotumiwa na watoa proksi wenye akili, unaofaa kwa uchimbaji wa wavuti wa kina bila gharama kubwa ya kuendesha vivinjari vingi vya moja kwa moja.

**Faida:** Mbinu hii inaruhusu uundaji wa njia ya kupitisha kwa ufanisi sana inayolenga hasa ukaguzi wa Cloudflare, ikiwa ni bora kwa shughuli kubwa.

**Hasara:** Upande mbaya ni ugumu unaohusika katika kuelewa na kudanganya mfumo wa anti-bot wa Cloudflare kwa makusudi, ukihitaji jitihada za kuendelea kujaribu mikakati tofauti na kusasisha njia ya kupitisha wakati Cloudflare inaboresha ulinzi wake.

Pata maelezo zaidi kuhusu jinsi ya kufanya hivi katika [makala ya awali](https://scrapeops.io/web-scraping-playbook/how-to-bypass-cloudflare/).

## Marejeo

* [https://scrapeops.io/web-scraping-playbook/how-to-bypass-cloudflare/](https://scrapeops.io/web-scraping-playbook/how-to-bypass-cloudflare/)

<details>

<summary><strong>Jifunze kuhusu kudukua AWS kutoka sifuri hadi shujaa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako ikitangazwa kwenye HackTricks** au **kupakua HackTricks kwa PDF** Angalia [**MIPANGO YA KUJIUNGA**](https://github.com/sponsors/carlospolop)!
* Pata [**bidhaa rasmi za PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**Familia ya PEASS**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa [**NFTs**](https://opensea.io/collection/the-peass-family) ya kipekee
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au kikundi cha [**telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Shiriki mbinu zako za kudukua kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
