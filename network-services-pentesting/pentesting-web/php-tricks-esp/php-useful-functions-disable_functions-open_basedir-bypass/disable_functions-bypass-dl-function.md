<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Expert en √©quipe rouge AWS de HackTricks)</strong></a><strong>!</strong></summary>

Autres fa√ßons de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts GitHub.

</details>

**Note importante:**

![image](https://user-images.githubusercontent.com/84577967/174675487-a4c4ca06-194f-4725-85af-231a2f35d56c.png)

**`dl`** est une fonction PHP qui peut √™tre utilis√©e pour charger des extensions PHP. Si la fonction n'est pas d√©sactiv√©e, elle pourrait √™tre utilis√©e pour **contourner `disable_functions` et ex√©cuter des commandes arbitraires**.\
Cependant, elle pr√©sente certaines limitations strictes :

* La fonction `dl` doit √™tre **pr√©sente** dans l'**environnement** et **non d√©sactiv√©e**
* L'extension PHP doit √™tre **compil√©e avec la m√™me version majeure** (version de l'API PHP) que celle utilis√©e par le serveur (vous pouvez voir cette information dans la sortie de phpinfo)
* L'extension PHP doit √™tre ** situ√©e dans le r√©pertoire** d√©fini par la directive **`extension_dir`** (vous pouvez le voir dans la sortie de phpinfo). Il est tr√®s peu probable qu'un attaquant essayant d'abuser du serveur ait un acc√®s en √©criture sur ce r√©pertoire, donc cette exigence vous emp√™chera probablement d'abuser de cette technique).

**Si vous remplissez ces conditions, continuez √† lire l'article** [**https://antichat.com/threads/70763/**](https://antichat.com/threads/70763/) **pour apprendre comment contourner `disable_functions`**. Voici un r√©sum√© :

La [fonction dl](http://www.php.net/manual/en/function.dl.php) est utilis√©e pour charger dynamiquement des extensions PHP pendant l'ex√©cution du script. Les extensions PHP, g√©n√©ralement √©crites en C/C++, am√©liorent la fonctionnalit√© de PHP. L'attaquant, en remarquant que la fonction `dl` n'est pas d√©sactiv√©e, d√©cide de cr√©er une extension PHP personnalis√©e pour ex√©cuter des commandes syst√®me.

### √âtapes prises par l'attaquant :

1. **Identification de la version PHP :**
- L'attaquant d√©termine la version PHP en utilisant un script (`<?php echo 'La version PHP est '.PHP_VERSION; ?>`).

2. **Acquisition de la source PHP :**
- T√©l√©charge la source PHP depuis le site officiel de [PHP](http://www.php.net/downloads.php) ou les [archives](http://museum.php.net) si la version est plus ancienne.

3. **Configuration PHP locale :**
- Extrait et installe la version sp√©cifique de PHP sur son syst√®me.

4. **Cr√©ation de l'extension :**
- √âtudie [la cr√©ation d'extensions PHP](http://www.php.net/manual/en/zend.creating.php) et inspecte le code source PHP.
- Se concentre sur la duplication de la fonctionnalit√© de la [fonction exec](http://www.php.net/manual/en/function.exec.php) situ√©e dans `ext/standard/exec.c`.

### Notes pour la compilation de l'extension personnalis√©e :

1. **ZEND_MODULE_API_NO :**
- Le `ZEND_MODULE_API_NO` dans `bypass.c` doit correspondre √† la version actuelle de la construction de l'extension Zend, r√©cup√©rable avec :
```bash
php -i | grep "Zend Extension Build" |awk -F"API4" '{print $2}' | awk -F"," '{print $1}'
```

2. **Modification de PHP_FUNCTION :**
- Pour les versions r√©centes de PHP (5, 7, 8), `PHP_FUNCTION(bypass_exec)` peut n√©cessiter des ajustements. Le snippet de code fourni d√©taille cette modification.

### Fichiers d'extension personnalis√©e :

- **bypass.c** :
- Impl√©mente la fonctionnalit√© principale de l'extension personnalis√©e.
- **php_bypass.h** :
- Fichier d'en-t√™te, d√©finissant les propri√©t√©s de l'extension.
- **config.m4** :
- Utilis√© par `phpize` pour configurer l'environnement de construction de l'extension personnalis√©e.

### Construction de l'extension :

1. **Commandes de compilation :**
- Utilise `phpize`, `./configure` et `make` pour compiler l'extension.
- Le fichier `bypass.so` r√©sultant est ensuite situ√© dans le sous-r√©pertoire modules.

2. **Nettoyage :**
- Ex√©cute `make clean` et `phpize --clean` apr√®s la compilation.

### T√©l√©chargement et ex√©cution sur l'h√¥te victime :

1. **Compatibilit√© des versions :**
- Veille √† ce que les versions de l'API PHP correspondent entre le syst√®me de l'attaquant et celui de la victime.

2. **Chargement de l'extension :**
- Utilise la fonction `dl`, contournant les restrictions en utilisant des chemins relatifs ou un script pour automatiser le processus.

3. **Ex√©cution du script :**
- L'attaquant t√©l√©charge `bypass.so` et un script PHP sur le serveur de la victime.
- Le script utilise la fonction `dl_local` pour charger dynamiquement `bypass.so` puis appelle `bypass_exec` avec une commande pass√©e via le param√®tre de requ√™te `cmd`.

### Ex√©cution de commandes :

- L'attaquant peut maintenant ex√©cuter des commandes en acc√©dant √† : `http://www.example.com/script.php?cmd=<commande>`


Cette explication d√©taill√©e d√©crit le processus de cr√©ation et de d√©ploiement d'une extension PHP pour ex√©cuter des commandes syst√®me, exploitant la fonction `dl`, qui devrait id√©alement √™tre d√©sactiv√©e pour √©viter de telles violations de s√©curit√©.


<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Expert en √©quipe rouge AWS de HackTricks)</strong></a><strong>!</strong></summary>

Autres fa√ßons de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts GitHub.

</details>
