<details>

<summary><strong>AWS hacklemeyi sıfırdan kahraman olmak için</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Kırmızı Takım Uzmanı)</strong></a><strong>!</strong></summary>

HackTricks'ı desteklemenin diğer yolları:

* **Şirketinizi HackTricks'te reklamını görmek isterseniz** veya **HackTricks'i PDF olarak indirmek isterseniz** [**ABONELİK PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks ürünlerini alın**](https://peass.creator-spring.com)
* Özel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluşan koleksiyonumuz [**The PEASS Family'yi**](https://opensea.io/collection/the-peass-family) keşfedin
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın** veya **Twitter'da** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)**'u takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına **PR göndererek paylaşın**.

</details>

**Önemli not:**

![image](https://user-images.githubusercontent.com/84577967/174675487-a4c4ca06-194f-4725-85af-231a2f35d56c.png)

**`dl`** PHP uzantılarını yüklemek için kullanılan bir PHP işlevdir. İşlev devre dışı bırakılmamışsa, **`disable_functions`'ı atlamak ve keyfi komutlar çalıştırmak** için kötüye kullanılabilir.\
Ancak, bazı katı sınırlamaları vardır:

* `dl` işlevi **çevrede mevcut** ve **devre dışı bırakılmamış** olmalıdır.
* PHP uzantısı, sunucunun kullandığı **aynı ana sürümle** (PHP API sürümü) derlenmiş olmalıdır (bu bilgiyi phpinfo çıktısında görebilirsiniz).
* PHP uzantısı, **`extension_dir`** yönergesi tarafından **tanımlanan dizinde** bulunmalıdır (bu bilgiyi phpinfo çıktısında görebilirsiniz). Sunucuyu kötüye kullanmaya çalışan bir saldırganın bu dizine yazma erişimi olması çok olası olmadığından, bu gereklilik muhtemelen bu teknikten yararlanmanızı engelleyecektir.

**Bu gereksinimleri karşılıyorsanız, disable\_functions'ı atlamayı öğrenmek için** [**https://antichat.com/threads/70763/**](https://antichat.com/threads/70763/) **bağlantısındaki gönderiyi okumaya devam edin**. İşte bir özet:

[dl işlevi](http://www.php.net/manual/en/function.dl.php), betik yürütme sırasında PHP uzantılarını dinamik olarak yüklemek için kullanılır. C/C++ ile genellikle yazılan PHP uzantıları, PHP'nin işlevselliğini geliştirir. Saldırgan, `dl` işlevinin devre dışı bırakılmadığını fark ettikten sonra, sistem komutlarını çalıştırmak için özel bir PHP uzantısı oluşturmaya karar verir.

### Saldırgan Tarafından İzlenen Adımlar:

1. **PHP Sürümünün Belirlenmesi:**
- Saldırgan, bir betik (`<?php echo 'PHP Sürümü: '.PHP_VERSION; ?>`) kullanarak PHP sürümünü belirler.

2. **PHP Kaynak Kodunun Edinilmesi:**
- PHP kaynak kodunu resmi [PHP web sitesinden](http://www.php.net/downloads.php) veya [arşivden](http://museum.php.net) (eğer sürüm eskiyse) indirir.

3. **Yerel PHP Kurulumu:**
- Belirli PHP sürümünü kendi sistemine çıkarır ve kurar.

4. **Uzantı Oluşturma:**
- [PHP uzantıları oluşturma](http://www.php.net/manual/en/zend.creating.php) konusunu inceler ve PHP kaynak kodunu inceler.
- `ext/standard/exec.c` konumunda bulunan [exec işlevinin](http://www.php.net/manual/en/function.exec.php) işlevselliğini çoğaltmaya odaklanır.

### Özel Uzantıyı Derleme Notları:

1. **ZEND_MODULE_API_NO:**
- `bypass.c` içindeki `ZEND_MODULE_API_NO`, mevcut Zend Extension Build ile eşleşmelidir. Bu bilgiyi aşağıdaki komutla alabilirsiniz:
```bash
php -i | grep "Zend Extension Build" |awk -F"API4" '{print $2}' | awk -F"," '{print $1}'
```

2. **PHP_FUNCTION Düzenlemesi:**
- Son PHP sürümleri (5, 7, 8) için `PHP_FUNCTION(bypass_exec)` düzenlemesi gerekebilir. Sağlanan kod parçacığı bu düzenlemeyi detaylandırır.

### Özel Uzantı Dosyaları:

- **bypass.c**:
- Özel uzantının temel işlevselliğini uygular.
- **php_bypass.h**:
- Uzantı özelliklerini tanımlayan başlık dosyası.
- **config.m4**:
- Özel uzantı için yapılandırmayı `phpize` kullanarak yapılandırmak için kullanılır.

### Uzantının Derlenmesi:

1. **Derleme Komutları:**
- Uzantının derlenmesi için `phpize`, `./configure` ve `make` kullanılır.
- Sonuç olarak oluşan `bypass.so` dosyası, modüller alt dizininde bulunur.

2. **Temizlik:**
- Derleme işleminden sonra `make clean` ve `phpize --clean` çalıştırılır.

### Kurban Sunucuda Yüklenmesi ve Yürütülmesi:

1. **Sürüm Uyumluluğu:**
- Saldırganın ve kurbanın sistemlerinde PHP API sürümlerinin eşleştiğinden emin olunur.

2. **Uzantı Yüklenmesi:**
- İlgili kısıtlamaları atlamak için `dl` işlevi kullanılır ve göreceli yollar veya süreci otomatikleştiren bir betik kullanılır.

3. **Betik Yürütme:**
- Saldırgan, `bypass.so` ve bir PHP betiğini kurban sunucusuna yükler.
- Betik, `dl_local` işlevini kullanarak `bypass.so`'yi dinamik olarak yükler ve ardından `cmd` sorgu parametresi aracılığıyla iletilen bir komutla `bypass_exec` işlevini çağırır.

### Komut Yürütme:

- Saldırgan artık komutları şu şekilde çalıştırabilir: `http://www.example.com/script.php?cmd=<komut>`


Bu ayrıntılı adım adım rehber, `dl` işlevini kötüye kullanarak sistem komutlarını çalıştırmak için özel bir PHP uzantısı oluşturma ve dağıtma sürecini açıklar. Bu, böyle bir güvenlik açığını önlemek için ideal olarak devre dışı bırakılması gereken `dl` işlevini istismar etmektedir.


<details>

<summary><strong>AWS hacklemeyi sıfırdan kahraman olmak için</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Kırmızı Takım Uzmanı)</strong></a><strong>!</strong></summary>

HackTricks'ı desteklemenin diğer yolları:

* **Şirketinizi HackTricks'te reklamını görmek isterseniz** veya **HackTricks'i PDF olarak indirmek isterseniz** [**ABONELİK PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks ürünlerini alın**](https://peass.creator-spring.com)
* Özel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluşan koleksiyonumuz [**The PEASS Family'yi**](https://opensea.io/collection/the-peass-family) keşfedin
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RU
