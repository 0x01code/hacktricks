<details>

<summary><strong>Lernen Sie AWS-Hacking von Grund auf mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks bewerben m√∂chten** oder **HackTricks als PDF herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merchandise**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositories senden.

</details>

**Wichtiger Hinweis:**

![image](https://user-images.githubusercontent.com/84577967/174675487-a4c4ca06-194f-4725-85af-231a2f35d56c.png)

**`dl`** ist eine PHP-Funktion, die verwendet werden kann, um PHP-Erweiterungen zu laden. Wenn die Funktion nicht deaktiviert ist, kann sie missbraucht werden, um **`disable_functions` zu umgehen und beliebige Befehle auszuf√ºhren**.\
Es gibt jedoch einige strenge Einschr√§nkungen:

* Die Funktion `dl` muss in der Umgebung **vorhanden** und **nicht deaktiviert** sein.
* Die PHP-Erweiterung muss mit derselben Hauptversion (PHP-API-Version) kompiliert sein, die der Server verwendet (diese Informationen finden Sie in der Ausgabe von phpinfo).
* Die PHP-Erweiterung muss sich im Verzeichnis befinden, das durch die Direktive **`extension_dir`** definiert ist (dies k√∂nnen Sie in der Ausgabe von phpinfo sehen). Es ist sehr unwahrscheinlich, dass ein Angreifer, der versucht, den Server zu missbrauchen, Schreibzugriff auf dieses Verzeichnis hat. Daher wird diese Anforderung Sie wahrscheinlich daran hindern, diese Technik zu missbrauchen.

**Wenn Sie diese Anforderungen erf√ºllen, lesen Sie den Beitrag weiter** [**https://antichat.com/threads/70763/**](https://antichat.com/threads/70763/) **, um zu erfahren, wie Sie `disable_functions` umgehen k√∂nnen**. Hier ist eine Zusammenfassung:

Die [dl-Funktion](http://www.php.net/manual/en/function.dl.php) wird verwendet, um PHP-Erweiterungen w√§hrend der Skriptausf√ºhrung dynamisch zu laden. PHP-Erweiterungen, die normalerweise in C/C++ geschrieben sind, erweitern die Funktionalit√§t von PHP. Der Angreifer bemerkt, dass die `dl`-Funktion nicht deaktiviert ist, und entscheidet sich, eine benutzerdefinierte PHP-Erweiterung zu erstellen, um Systembefehle auszuf√ºhren.

### Vom Angreifer durchgef√ºhrte Schritte:

1. **PHP-Versionsermittlung:**
- Der Angreifer ermittelt die PHP-Version mithilfe eines Skripts (`<?php echo 'PHP-Version ist '.PHP_VERSION; ?>`).

2. **Beschaffung des PHP-Quellcodes:**
- L√§dt den PHP-Quellcode von der offiziellen [PHP-Website](http://www.php.net/downloads.php) oder dem [Archiv](http://museum.php.net) herunter, wenn es sich um eine √§ltere Version handelt.

3. **Lokale PHP-Installation:**
- Extrahiert und installiert die spezifische PHP-Version auf ihrem System.

4. **Erstellung der Erweiterung:**
- Studiert die [Erstellung von PHP-Erweiterungen](http://www.php.net/manual/en/zend.creating.php) und inspiziert den PHP-Quellcode.
- Konzentriert sich darauf, die Funktionalit√§t der [exec-Funktion](http://www.php.net/manual/en/function.exec.php) zu duplizieren, die sich in `ext/standard/exec.c` befindet.

### Hinweise zur Kompilierung der benutzerdefinierten Erweiterung:

1. **ZEND_MODULE_API_NO:**
- Das `ZEND_MODULE_API_NO` in `bypass.c` muss mit dem aktuellen Zend Extension Build √ºbereinstimmen, der mit folgendem Befehl abgerufen werden kann:
```bash
php -i | grep "Zend Extension Build" |awk -F"API4" '{print $2}' | awk -F"," '{print $1}'
```

2. **√Ñnderung von PHP_FUNCTION:**
- F√ºr aktuelle PHP-Versionen (5, 7, 8) muss `PHP_FUNCTION(bypass_exec)` m√∂glicherweise angepasst werden. Der bereitgestellte Codeausschnitt enth√§lt Details zu dieser √Ñnderung.

### Dateien der benutzerdefinierten Erweiterung:

- **bypass.c**:
- Implementiert die Kernfunktionalit√§t der benutzerdefinierten Erweiterung.
- **php_bypass.h**:
- Header-Datei, die Erweiterungseigenschaften definiert.
- **config.m4**:
- Wird von `phpize` verwendet, um die Build-Umgebung f√ºr die benutzerdefinierte Erweiterung zu konfigurieren.

### Erstellung der Erweiterung:

1. **Kompilierungsbefehle:**
- Verwendet `phpize`, `./configure` und `make`, um die Erweiterung zu kompilieren.
- Die resultierende `bypass.so` befindet sich dann im Unterverzeichnis "modules".

2. **Aufr√§umen:**
- F√ºhrt nach der Kompilierung `make clean` und `phpize --clean` aus.

### Hochladen und Ausf√ºhren auf dem Opferhost:

1. **Versionskompatibilit√§t:**
- Stellt sicher, dass die PHP-API-Versionen zwischen dem System des Angreifers und dem des Opfers √ºbereinstimmen.

2. **Erweiterungsladen:**
- Verwendet die `dl`-Funktion, um Einschr√§nkungen zu umgehen, indem relative Pfade oder ein Skript zur Automatisierung des Vorgangs verwendet werden.

3. **Skriptausf√ºhrung:**
- Der Angreifer l√§dt `bypass.so` und ein PHP-Skript auf den Server des Opfers hoch.
- Das Skript verwendet die Funktion `dl_local`, um `bypass.so` dynamisch zu laden, und ruft dann `bypass_exec` mit einem √ºber den `cmd`-Abfrageparameter √ºbergebenen Befehl auf.

### Befehlsausf√ºhrung:

- Der Angreifer kann jetzt Befehle ausf√ºhren, indem er auf Folgendes zugreift: `http://www.example.com/script.php?cmd=<Befehl>`


Diese ausf√ºhrliche Anleitung beschreibt den Prozess der Erstellung und Bereitstellung einer PHP-Erweiterung zur Ausf√ºhrung von Systembefehlen unter Ausnutzung der `dl`-Funktion, die idealerweise deaktiviert sein sollte, um solche Sicherheitsverletzungen zu verhindern.


<details>

<summary><strong>Lernen Sie AWS-Hacking von Grund auf mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks bewerben m√∂chten** oder **HackTricks als PDF herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merchandise**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositories senden.

</details>
