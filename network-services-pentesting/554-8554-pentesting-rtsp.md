# 554,8554 - Pentesting RTSP

<details>

<summary><strong>Aprenda hacking no AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ quer ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**material oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **Junte-se ao grupo** üí¨ [**Discord**](https://discord.gg/hRep4RUj7f) ou ao grupo [**telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios github do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Informa√ß√µes B√°sicas

> O **Real Time Streaming Protocol** (**RTSP**) √© um protocolo de controle de rede projetado para uso em sistemas de entretenimento e comunica√ß√µes para controlar servidores de m√≠dia de streaming. O protocolo √© utilizado para estabelecer e controlar sess√µes de m√≠dia entre pontos finais. Clientes de servidores de m√≠dia emitem comandos ao estilo VHS, como play, record e pause, para facilitar o controle em tempo real do streaming de m√≠dia do servidor para um cliente (Video On Demand) ou de um cliente para o servidor (Grava√ß√£o de Voz).
>
> A transmiss√£o de dados de streaming em si n√£o √© uma tarefa do RTSP. A maioria dos servidores RTSP usa o Real-time Transport Protocol (RTP) em conjunto com o Real-time Control Protocol (RTCP) para entrega de fluxo de m√≠dia. No entanto, alguns fornecedores implementam protocolos de transporte propriet√°rios. O software de servidor RTSP da RealNetworks, por exemplo, tamb√©m usava o transporte de dados propriet√°rio da RealNetworks (RDT).

De [wikipedia](https://en.wikipedia.org/wiki/Real\_Time\_Streaming\_Protocol).

**Portas padr√£o:** 554,8554
```
PORT    STATE SERVICE
554/tcp open  rtsp
```
## Informa√ß√µes Detalhadas

Primeiramente, RTSP √© um protocolo semelhante ao HTTP. Possui uma estrutura diferente e comandos de controle, mas √© textual em seu formato e, uma vez que voc√™ aprenda o b√°sico dos comandos e como eles interagem, √© bastante f√°cil de usar. A especifica√ß√£o para RTSP √© bem direta. Aqui est√° um link para ela:

[RTSP ‚Äì RFC2326](https://tools.ietf.org/html/rfc2326)

O RTSP pode ser acessado sem autentica√ß√£o (comum em dispositivos prontos para uso) ou com autentica√ß√£o. O acesso autenticado espelha o HTTP, no sentido de que voc√™ tem autentica√ß√£o B√°sica e Digest, ambas quase id√™nticas ao HTTP. Para descobrir se seu dispositivo est√° autenticado ou n√£o, simplesmente envie uma solicita√ß√£o ‚ÄúDESCRIBE‚Äù. Uma solicita√ß√£o DESCRIBE simples se parece com:

`DESCRIBE rtsp://<ip>:<port> RTSP/1.0\r\nCSeq: 2\r\n`

Nota: o adicional ‚Äú\r\n‚Äù √© necess√°rio para uma resposta confi√°vel. Alguns sistemas aceitar√£o o √∫nico ‚Äú\r\n‚Äù, mas a maioria n√£o.

Isso pode ser enviado por um socket bruto. Assim como no HTTP, uma resposta bem-sucedida indicando que o acesso n√£o autenticado est√° dispon√≠vel conter√° um ‚Äú200 OK‚Äù. Neste caso, com DESCRIBE, tamb√©m conter√° todos os par√¢metros operacionais do feed de v√≠deo.

Se o dispositivo requer autentica√ß√£o, a resposta ser√° ‚Äú401 N√£o Autorizado‚Äù. A resposta tamb√©m indicar√° quais mecanismos de autentica√ß√£o est√£o dispon√≠veis. Se a autentica√ß√£o B√°sica estiver dispon√≠vel, a string de resposta conter√° uma linha de informa√ß√£o que tem ‚ÄúWWW-Authenticate: Basic‚Äù. O restante das informa√ß√µes fornecidas com a autentica√ß√£o B√°sica √© em grande parte irrelevante para realizar a autentica√ß√£o b√°sica.

Se a autentica√ß√£o Digest for necess√°ria, ent√£o a resposta ‚Äú401 N√£o Autorizado‚Äù ter√° uma linha de informa√ß√£o contendo ‚ÄúWWW-Authenticate: Digest‚Äù. As informa√ß√µes com a especifica√ß√£o Digest S√ÉO muito importantes se voc√™ for fazer a autentica√ß√£o Digest, ent√£o n√£o as ignore.

A autentica√ß√£o B√°sica √© o caminho a seguir, esperan√ßosamente a resposta recebida indica que ela est√° dispon√≠vel. Se n√£o, existem tr√™s m√©todos diferentes para montar um elemento de autentica√ß√£o Digest, ent√£o Digest pode se tornar problem√°tico, especialmente cego (n√£o autenticado). O restante deste artigo se ater√° √† autentica√ß√£o B√°sica. Eu posso escrever um artigo de acompanhamento mais tarde, uma vez que eu decifre o segredo para fazer a autentica√ß√£o Digest cega.

Para formular um elemento de autentica√ß√£o B√°sica, basta codificar em base 64 \<username> ‚Äú:‚Äù \<password> e adicion√°-lo √† solicita√ß√£o. Ent√£o, uma nova solicita√ß√£o se pareceria com:

`DESCRIBE rtsp://<ip>:<port> RTSP/1.0\r\nCSeq: 2\r\nAuthorization: Basic YWRtaW46MTIzNA==\r\n`

Novamente, note que a solicita√ß√£o √© terminada com o duplo ‚Äú\r\n‚Äù.

O valor YWRtaW46MTIzNA== √© o nome de usu√°rio e senha codificados em base 64 concatenados com ‚Äú:‚Äù. Neste caso, usei ‚Äúadmin‚Äù/‚Äù1234‚Äù. Alguns scripts simples em python para testar isso se parecem com:
```python
import socket
req = "DESCRIBE rtsp://<ip>:<port> RTSP/1.0\r\nCSeq: 2\r\nAuthorization: Basic YWRtaW46MTIzNA==\r\n\r\n"
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect(("192.168.1.1", 554))
s.sendall(req)
data = s.recv(1024)
print(data)
```
Eis que voc√™ tem acesso.

**De:** [**http://badguyfu.net/rtsp-brute-forcing-for-fun-and-naked-pictures/**](https://web.archive.org/web/20161020202643/http://badguyfu.net/rtsp-brute-forcing-for-fun-and-naked-pictures/)

## Enumera√ß√£o

Vamos obter informa√ß√µes sobre m√©todos v√°lidos e URLs suportados e tentar for√ßar a entrada (se necess√°rio) para acessar o conte√∫do.
```bash
nmap -sV --script "rtsp-*" -p <PORT> <IP>
```
### [Brute Force](../generic-methodologies-and-resources/brute-force.md#rtsp)

### **Outros programas √∫teis**

Para bruteforce: [https://github.com/Tek-Security-Group/rtsp\_authgrinder](https://github.com/Tek-Security-Group/rtsp\_authgrinder)

**Cameradar**

Cameradar permite que voc√™:

* Detecte hosts RTSP abertos em qualquer alvo acess√≠vel
* Obtenha suas informa√ß√µes p√∫blicas (nome do host, porta, modelo da c√¢mera, etc.)
* Execute ataques automatizados de dicion√°rio para obter a rota do stream (por exemplo, /live.sdp)
* Execute ataques automatizados de dicion√°rio para obter o nome de usu√°rio e senha das c√¢meras
* Gere miniaturas delas para verificar se os streams s√£o v√°lidos e para ter uma pr√©-visualiza√ß√£o r√°pida do seu conte√∫do
* Tente criar um pipeline Gstreamer para verificar se eles est√£o codificados corretamente
* Imprima um resumo de todas as informa√ß√µes que o Cameradar conseguiu obter
* [https://github.com/Ullaakut/cameradar](https://github.com/Ullaakut/cameradar)

<details>

<summary><strong>Aprenda AWS hacking do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ quer ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF** Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**merchandising oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **Junte-se ao grupo** üí¨ [**Discord**](https://discord.gg/hRep4RUj7f) ou ao grupo [**telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios github do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
