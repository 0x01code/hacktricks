# 5671,5672 - Pentesting AMQP

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks Cloud ☁️</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>🐦 Twitter 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 Youtube 🎥</strong></a></summary>

* **サイバーセキュリティ会社**で働いていますか？**HackTricksで会社の広告を掲載**したいですか？または、**最新版のPEASSを入手**したり、**HackTricksをPDFでダウンロード**したいですか？[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見してください。私たちの独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)コレクションです。
* [**公式のPEASS & HackTricksグッズ**](https://peass.creator-spring.com)を手に入れましょう。
* **[**💬**](https://emojipedia.org/speech-balloon/) [**Discordグループ**](https://discord.gg/hRep4RUj7f)や[**テレグラムグループ**](https://t.me/peass)に**参加するか**、**Twitter** [**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**に**フォローしてください。**
* **ハッキングのコツを共有するために、**[**hacktricksリポジトリ**](https://github.com/carlospolop/hacktricks)と[**hacktricks-cloudリポジトリ**](https://github.com/carlospolop/hacktricks-cloud)にPRを提出してください。**

</details>

## 基本情報

**RabbitMQ**は、_メッセージブローカー_または_キューマネージャー_としても知られる**メッセージキューイングソフトウェア**です。簡単に言うと、キューが定義され、アプリケーションが接続してメッセージを転送するソフトウェアです。\
**メッセージにはあらゆる種類の情報を含むことができます**。例えば、別のアプリケーション（別のサーバー上にあるかもしれません）で開始すべきプロセスやタスクに関する情報が含まれているかもしれませんし、単なるテキストメッセージである可能性もあります。キューマネージャーソフトウェアは、受信アプリケーションが接続してキューからメッセージを取り出すまでメッセージを保存します。その後、受信アプリケーションはメッセージを処理します。\
定義は[こちら](https://www.cloudamqp.com/blog/2015-05-18-part1-rabbitmq-for-beginners-what-is-rabbitmq.html)から。

**デフォルトポート**: 5672,5671
```
PORT     STATE SERVICE VERSION
5672/tcp open  amqp    RabbitMQ 3.1.5 (0-9)
```
## 列挙

### 手動
```python
import amqp
#By default it uses default credentials "guest":"guest"
conn = amqp.connection.Connection(host="<IP>", port=5672, virtual_host="/")
conn.connect()
for k, v in conn.server_properties.items():
print(k, v)
```
### 自動
```bash
nmap -sV -Pn -n -T4 -p 5672 --script amqp-info <IP>

PORT     STATE SERVICE VERSION
5672/tcp open  amqp    RabbitMQ 3.1.5 (0-9)
| amqp-info:
|   capabilities:
|     publisher_confirms: YES
|     exchange_exchange_bindings: YES
|     basic.nack: YES
|     consumer_cancel_notify: YES
|   copyright: Copyright (C) 2007-2013 GoPivotal, Inc.
|   information: Licensed under the MPL.  See http://www.rabbitmq.com/
|   platform: Erlang/OTP
|   product: RabbitMQ
|   version: 3.1.5
|   mechanisms: PLAIN AMQPLAIN
|_  locales: en_US
```
### ブルートフォース

* [**AMQPプロトコル ブルートフォース**](../generic-methodologies-and-resources/brute-force.md#amqp-activemq-rabbitmq-qpid-joram-and-solace)
* [**STOMPプロトコル ブルートフォース**](../generic-methodologies-and-resources/brute-force.md#stomp-activemq-rabbitmq-hornetq-and-openmq)

## その他のRabbitMQポート

[https://www.rabbitmq.com/networking.html](https://www.rabbitmq.com/networking.html) から、**rabbitmqが複数のポートを使用している**ことがわかります：

* **1883, 8883**: ([MQTTクライアント](http://mqtt.org) TLSなしとTLSあり、[MQTTプラグイン](https://www.rabbitmq.com/mqtt.html)が有効な場合。[**MQTTのペンテスト方法についてはこちらを参照してください**](1883-pentesting-mqtt-mosquitto.md)。
* **4369: epmd**, RabbitMQノードとCLIツールが使用するピアディスカバリーサービス。[**このサービスのペンテスト方法についてはこちらを参照してください**](4369-pentesting-erlang-port-mapper-daemon-epmd.md)。
* **5672, 5671**: AMQP 0-9-1と1.0クライアントがTLSなしとTLSありで使用
* **15672**: [HTTP API](https://www.rabbitmq.com/management.html)クライアント、[管理UI](https://www.rabbitmq.com/management.html)、[rabbitmqadmin](https://www.rabbitmq.com/management-cli.html)（[管理プラグイン](https://www.rabbitmq.com/management.html)が有効な場合のみ）。[**このサービスのペンテスト方法についてはこちらを参照してください**](15672-pentesting-rabbitmq-management.md)。
* 15674: STOMP-over-WebSocketsクライアント（[Web STOMPプラグイン](https://www.rabbitmq.com/web-stomp.html)が有効な場合のみ）
* 15675: MQTT-over-WebSocketsクライアント（[Web MQTTプラグイン](https://www.rabbitmq.com/web-mqtt.html)が有効な場合のみ）
* 15692: Prometheusメトリクス（[Prometheusプラグイン](https://www.rabbitmq.com/prometheus.html)が有効な場合のみ）
* 25672: ノード間およびCLIツール通信用（Erlang配布サーバーポート）で、動的範囲から割り当てられます（デフォルトでは単一のポートに限定され、AMQPポート+20000として計算されます）。外部接続が本当に必要でない限り（例えば、クラスターが[フェデレーション](https://www.rabbitmq.com/federation.html)を使用している、またはサブネット外のマシンでCLIツールを使用している場合）、これらのポートは公開されるべきではありません。詳細は[ネットワーキングガイド](https://www.rabbitmq.com/networking.html)を参照してください。**インターネット上で開かれているのはこれらのポートのうち9つだけです**。
* 35672-35682: CLIツールがノードと通信するために使用する（Erlang配布クライアントポート）で、動的範囲から割り当てられます（サーバー配布ポート+10000からサーバー配布ポート+10010まで計算されます）。詳細は[ネットワーキングガイド](https://www.rabbitmq.com/networking.html)を参照してください。
* 61613, 61614: [STOMPクライアント](https://stomp.github.io/stomp-specification-1.2.html) TLSなしとTLSあり（[STOMPプラグイン](https://www.rabbitmq.com/stomp.html)が有効な場合のみ）。このポートを開いているデバイスは10台未満で、ほとんどがDHTノードのUDPです。

## Shodan

* `AMQP`

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks Cloud ☁️</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>🐦 Twitter 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 Youtube 🎥</strong></a></summary>

* **サイバーセキュリティ会社**で働いていますか？**HackTricksにあなたの会社を広告したいですか？** または、**最新のPEASSバージョンにアクセスしたり、HackTricksをPDFでダウンロードしたいですか？** [**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見してください。私たちの独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)コレクションです。
* [**公式のPEASS & HackTricksグッズ**](https://peass.creator-spring.com)を手に入れましょう。
* **[**💬**](https://emojipedia.org/speech-balloon/) [**Discordグループ**](https://discord.gg/hRep4RUj7f)や[**テレグラムグループ**](https://t.me/peass)に**参加するか、** Twitter **[**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**に**フォローしてください。**
* **ハッキングのコツを共有するために、** [**hacktricksリポジトリ**](https://github.com/carlospolop/hacktricks) **と** [**hacktricks-cloudリポジトリ**](https://github.com/carlospolop/hacktricks-cloud) **にPRを提出してください。**

</details>
