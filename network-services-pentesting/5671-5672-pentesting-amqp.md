# 5671,5672 - Pentesting AMQP

<details>

<summary><strong>Jifunze kuhusu kudukua AWS kutoka mwanzo hadi kuwa bingwa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako ikionekana kwenye HackTricks** au **kupakua HackTricks kwa PDF** Angalia [**MPANGO WA KUJIUNGA**](https://github.com/sponsors/carlospolop)!
* Pata [**swag rasmi wa PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**The PEASS Family**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa [**NFTs**](https://opensea.io/collection/the-peass-family) za kipekee
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au [**kikundi cha telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Shiriki mbinu zako za kudukua kwa kuwasilisha PRs kwenye** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos za github.

</details>

## Taarifa Msingi

Kutoka [cloudamqp](https://www.cloudamqp.com/blog/2015-05-18-part1-rabbitmq-for-beginners-what-is-rabbitmq.html):

> **RabbitMQ** ni **programu ya foleni ya ujumbe** inayojulikana pia kama _message broker_ au _queue manager_. Kwa ufupi, ni programu ambapo foleni zinatengenezwa, ambapo programu zinahusiana ili kuhamisha ujumbe au ujumbe.\
> Ujumbe unaweza kuwa na aina yoyote ya habari. Inaweza, kwa mfano, kuwa na habari kuhusu mchakato au kazi ambayo inapaswa kuanza kwenye programu nyingine (ambayo inaweza hata kuwa kwenye seva nyingine), au inaweza kuwa ujumbe wa maandishi tu. Programu ya queue-manager inahifadhi ujumbe hadi programu ya kupokea inapounganisha na kuchukua ujumbe kutoka kwenye foleni. Programu ya kupokea kisha inaprocess ujumbe.\
Definition from .
```
PORT     STATE SERVICE VERSION
5672/tcp open  amqp    RabbitMQ 3.1.5 (0-9)
```
## Uchambuzi

### Kwa Mkono
```python
import amqp
#By default it uses default credentials "guest":"guest"
conn = amqp.connection.Connection(host="<IP>", port=5672, virtual_host="/")
conn.connect()
for k, v in conn.server_properties.items():
print(k, v)
```
### Kiotomatiki

AMQP (Advanced Message Queuing Protocol) ni itifaki ya mawasiliano ambayo hutumiwa kwa ajili ya kuwasiliana na mifumo ya ujumbe. Inaruhusu programu mbalimbali kubadilishana ujumbe kwa njia ya njia ya ujumbe. Kwa mfano, inaweza kutumika kwa ajili ya kuwasiliana kati ya seva na wateja, au kati ya seva mbili.

Katika mchakato wa pentesting, ni muhimu kuelewa jinsi AMQP inavyofanya kazi na jinsi inavyoweza kudukuliwa. Hii inaweza kusaidia kugundua udhaifu na kuchukua hatua za kiusalama zinazofaa.

Kuna njia kadhaa za kiotomatiki za kufanya pentesting kwenye itifaki ya AMQP. Hapa kuna baadhi ya zana maarufu:

- **RabbitMQ-CLI**: Hii ni zana ya amri ya mstari wa amri ambayo inaruhusu kufanya operesheni mbalimbali kwenye seva ya RabbitMQ. Inaweza kutumika kwa ajili ya kuchunguza mazingira ya RabbitMQ na kufanya majaribio ya kudukua.

- **AMQP-Client**: Hii ni maktaba ya Python ambayo inaruhusu kuunda wateja wa AMQP na kufanya operesheni mbalimbali kama kutuma na kupokea ujumbe. Inaweza kutumika kwa ajili ya kujenga skana za kiotomatiki na kufanya majaribio ya kudukua.

- **Metasploit**: Hii ni jukwaa la usalama ambalo linatoa zana mbalimbali za kudukua. Ina moduli kadhaa zinazohusiana na AMQP, ambazo zinaweza kutumika kwa ajili ya kufanya majaribio ya kudukua kwenye mifumo ya AMQP.

Kwa kutumia zana hizi za kiotomatiki, unaweza kufanya pentesting kwenye mifumo ya AMQP kwa njia ya haraka na yenye ufanisi. Hii inaweza kusaidia kugundua udhaifu na kuchukua hatua za kiusalama zinazofaa ili kulinda mifumo yako dhidi ya mashambulizi.
```bash
nmap -sV -Pn -n -T4 -p 5672 --script amqp-info <IP>

PORT     STATE SERVICE VERSION
5672/tcp open  amqp    RabbitMQ 3.1.5 (0-9)
| amqp-info:
|   capabilities:
|     publisher_confirms: YES
|     exchange_exchange_bindings: YES
|     basic.nack: YES
|     consumer_cancel_notify: YES
|   copyright: Copyright (C) 2007-2013 GoPivotal, Inc.
|   information: Licensed under the MPL.  See http://www.rabbitmq.com/
|   platform: Erlang/OTP
|   product: RabbitMQ
|   version: 3.1.5
|   mechanisms: PLAIN AMQPLAIN
|_  locales: en_US
```
### Brute Force

* [**AMQP Itifaki ya Brute-Force**](../generic-methodologies-and-resources/brute-force.md#amqp-activemq-rabbitmq-qpid-joram-and-solace)
* [**STOMP Itifaki ya Brute-Force**](../generic-methodologies-and-resources/brute-force.md#stomp-activemq-rabbitmq-hornetq-and-openmq)

## Bandari Nyingine za RabbitMQ

Katika [https://www.rabbitmq.com/networking.html](https://www.rabbitmq.com/networking.html) unaweza kupata kwamba **rabbitmq hutumia bandari kadhaa**:

* **1883, 8883**: ([wateja wa MQTT](http://mqtt.org) bila na na TLS, ikiwa [programu-jalizi ya MQTT](https://www.rabbitmq.com/mqtt.html) imeamilishwa. [**Jifunze zaidi kuhusu jinsi ya kufanya pentest MQTT hapa**](1883-pentesting-mqtt-mosquitto.md).
* **4369: epmd**, huduma ya ugunduzi wa rika inayotumiwa na nodi za RabbitMQ na zana za CLI. [**Jifunze zaidi kuhusu jinsi ya kufanya pentest kwenye huduma hii hapa**](4369-pentesting-erlang-port-mapper-daemon-epmd.md).
* **5672, 5671**: hutumiwa na wateja wa AMQP 0-9-1 na 1.0 bila na na TLS
* **15672**: wateja wa [API ya HTTP](https://www.rabbitmq.com/management.html), [UI ya usimamizi](https://www.rabbitmq.com/management.html) na [rabbitmqadmin](https://www.rabbitmq.com/management-cli.html) (tu ikiwa [programu-jalizi ya usimamizi](https://www.rabbitmq.com/management.html) imeamilishwa). [**Jifunze zaidi kuhusu jinsi ya kufanya pentest kwenye huduma hii hapa**](15672-pentesting-rabbitmq-management.md).
* 15674: wateja wa STOMP-over-WebSockets (tu ikiwa [programu-jalizi ya Web STOMP](https://www.rabbitmq.com/web-stomp.html) imeamilishwa)
* 15675: wateja wa MQTT-over-WebSockets (tu ikiwa [programu-jalizi ya Web MQTT](https://www.rabbitmq.com/web-mqtt.html) imeamilishwa)
* 15692: takwimu za Prometheus (tu ikiwa [programu-jalizi ya Prometheus](https://www.rabbitmq.com/prometheus.html) imeamilishwa)
* 25672: hutumiwa kwa mawasiliano kati ya nodi na zana za CLI (bandari ya seva ya usambazaji ya Erlang) na imepangiwa kutoka kwa safu ya kipekee (imezuiliwa kwa bandari moja tu kwa chaguo-msingi, inahesabiwa kama bandari ya AMQP + 20000). Isipokuwa mawasiliano ya nje kwenye bandari hizi ni muhimu sana (kwa mfano, kikundi kinatumia [federation](https://www.rabbitmq.com/federation.html) au zana za CLI zinatumika kwenye mashine zilizo nje ya subnet), bandari hizi hazipaswi kuwa wazi kwa umma. Angalia [mwongozo wa mtandao](https://www.rabbitmq.com/networking.html) kwa maelezo zaidi. **Ni bandari 9 tu kati ya hizi zilizofunguliwa kwenye mtandao**.
* 35672-35682: hutumiwa na zana za CLI (bandari za wateja wa usambazaji wa Erlang) kwa mawasiliano na nodi na imepangiwa kutoka kwa safu ya kipekee (imehesabiwa kama bandari ya usambazaji ya seva + 10000 hadi bandari ya usambazaji ya seva + 10010). Angalia [mwongozo wa mtandao](https://www.rabbitmq.com/networking.html) kwa maelezo zaidi.
* 61613, 61614: [wateja wa STOMP](https://stomp.github.io/stomp-specification-1.2.html) bila na na TLS (tu ikiwa [programu-jalizi ya STOMP](https://www.rabbitmq.com/stomp.html) imeamilishwa). Chini ya vifaa 10 na bandari hii wazi na kwa kawaida UDP kwa nodi za DHT.

## Shodan

* `AMQP`

<details>

<summary><strong>Jifunze kuhusu kuhack AWS kutoka sifuri hadi shujaa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako inatangazwa kwenye HackTricks** au **kupakua HackTricks kwa PDF** Angalia [**MPANGO WA KUJIUNGA**](https://github.com/sponsors/carlospolop)!
* Pata [**swag rasmi wa PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**The PEASS Family**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa [**NFTs**](https://opensea.io/collection/the-peass-family) za kipekee
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au [**kikundi cha telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Shiriki mbinu zako za kuhack kwa kuwasilisha PR kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
