# Per√≠metro externo: For√ßa bruta de senha remota e furtiva

As vers√µes 11.1.0.6, 11.1.0.7, 11.2.0.1, 11.2.0.2 e 11.2.0.3 s√£o vulner√°veis a essa t√©cnica. Para entender a ideia por tr√°s dessa vulnerabilidade, √© necess√°rio considerar como o protocolo de autentica√ß√£o funciona com o banco de dados. Vou mostrar isso para a vers√£o 11. A intera√ß√£o com o servidor ocorre da seguinte maneira:

1. O cliente se conecta ao servidor e envia o nome do usu√°rio.
2. O servidor gera um identificador de sess√£o ('AUTH_SESSKEY') e o criptografa usando AES-192. Como chave, o sistema usa o hash SHA-1 gerado a partir da senha do usu√°rio e do salt (‚ÄòAUTH_VFR_DATA‚Äô).
3. O servidor envia um ID de sess√£o criptografado e salt para o cliente.
4. O cliente gera a chave fazendo o hash de sua senha e do salt recebido. O cliente usa essa chave para descriptografar os dados da sess√£o recebidos do servidor.
5. Com base no ID de sess√£o do servidor descriptografado, o cliente gera uma nova chave p√∫blica para uso futuro.

Agora, aqui est√° a parte mais interessante: o ID de sess√£o 'AUTH_SESSKEY' enviado pelo servidor ao cliente tem um comprimento de 48 bytes. Destes, 40 bytes s√£o aleat√≥rios e os √∫ltimos 8 s√£o duplicados de '0x08'. O vetor de inicializa√ß√£o √© 0x00 (nulo). Sabendo que os √∫ltimos 8 bytes do identificador p√∫blico sempre consistem em '0x08', podemos fazer for√ßa bruta nessa senha e, al√©m disso, faz√™-lo em modo offline, o que significa uma velocidade tremenda, especialmente se voc√™ usar GPU. Para montar um ataque, voc√™ precisa saber o SID, o login v√°lido (por exemplo, a conta 'SYS' √© muito interessante) e, √© claro, ter a capacidade de se conectar ao banco de dados. Nesse caso, n√£o haver√° registros, como 'Tentativa de login inv√°lida', criados nos logs de auditoria do Oracle!

Resumindo:

1. Use o Wireshark para **interceptar** o **tr√°fego inicial** durante a **autoriza√ß√£o**. Isso ser√° ajudado pelo filtro 'tns'.
2. Extraia os **valores HEX para AUTH_SESSKEY, AUTH_VFR_DATA**.
3. Insira-os no [**script PoC**](https://www.exploit-db.com/exploits/22069), que realizar√° um ataque de dicion√°rio (for√ßa bruta).

## Usando nmap e john
```
root@kali:~# nmap -p1521 --script oracle-brute-stealth --script-args oracle-brute-stealth.sid=DB11g -n 10.11.21.30

Starting Nmap 6.49BETA4 (https://nmap.org) at 2016-03-02 14:58 EST
Nmap scan report for 10.11.21.30
PORT     STATE SERVICE
1521/tcp open  oracle
| oracle-brute-stealth:
|   Accounts
|     SYS:$o5logon$1245C95384E15E7F0C893FCD1893D8E19078170867E892CE86DF90880E09FAD3B4832CBCFDAC1
|     A821D2EA8E3D2209DB6*4202433F49DE9AE72AE2 - 
|     Hashed valid or invalid credentials
|   Statistics
|_    Performed 241 guesses in 12 seconds, average tps: 20

john hashes.txt
```
<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

- Voc√™ trabalha em uma **empresa de seguran√ßa cibern√©tica**? Voc√™ quer ver sua **empresa anunciada no HackTricks**? ou voc√™ quer ter acesso √† **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**? Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!

- Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)

- Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)

- **Junte-se ao** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**

- **Compartilhe seus truques de hacking enviando PRs para o [reposit√≥rio hacktricks](https://github.com/carlospolop/hacktricks) e [hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)**.

</details>
