# P√©rim√®tre ext√©rieur : Brute force de mot de passe √† distance en mode furtif

Les versions 11.1.0.6, 11.1.0.7, 11.2.0.1, 11.2.0.2 et 11.2.0.3 sont vuln√©rables √† cette technique. Pour comprendre l'id√©e derri√®re cette vuln√©rabilit√©, vous devez consid√©rer le fonctionnement du protocole d'authentification avec la base de donn√©es. Je vais le montrer pour la version 11. L'interaction avec le serveur se d√©roule comme suit :

1. Le client se connecte au serveur et envoie le nom d'utilisateur.
2. Le serveur g√©n√®re un identifiant de session ('AUTH_SESSKEY') et l'encrypte en utilisant AES-192. Comme cl√©, le syst√®me utilise le hachage SHA-1 g√©n√©r√© √† partir du mot de passe de l'utilisateur et du sel ('AUTH_VFR_DATA').
3. Le serveur envoie un identifiant de session et un sel encrypt√©s au client.
4. Le client g√©n√®re la cl√© en hachant son mot de passe et le sel re√ßu. Le client utilise cette cl√© pour d√©crypter les donn√©es de session re√ßues du serveur.
5. En fonction de l'identifiant de session du serveur d√©crypt√©, le client g√©n√®re une nouvelle cl√© publique pour une utilisation future.

Maintenant, voici la partie la plus int√©ressante : l'identifiant de session 'AUTH_SESSKEY' envoy√© par le serveur au client a une longueur de 48 octets. De ceux-ci, 40 octets sont al√©atoires, et les 8 derniers sont des duplicatas de '0x08'. Le vecteur d'initialisation est 0x00 (Null).\
Sachant que les 8 derniers octets de l'identifiant public consistent toujours en '0x08', nous pouvons effectuer une attaque par force brute sur ce mot de passe et, de plus, le faire en mode hors ligne, ce qui signifie une vitesse consid√©rable, surtout si vous utilisez un GPU. Pour monter une attaque, vous devez conna√Ætre SID, une connexion valide (par exemple, le compte 'SYS' est tr√®s int√©ressant) et, bien s√ªr, avoir la capacit√© de se connecter √† la base de donn√©es. Dans ce cas, il n'y aura pas d'enregistrements, tels que "Tentative de connexion invalide", cr√©√©s dans les journaux d'audit Oracle !

R√©sumons tout cela :

1. Utilisez Wireshark pour **intercepter** le **trafic initial** lors de l'**autorisation**. Cela sera aid√© par le filtre 'tns'.
2. Extrayez les **valeurs HEX pour AUTH_SESSKEY, AUTH_VFR_DATA**.
3. Ins√©rez-les dans le [**script PoC**](https://www.exploit-db.com/exploits/22069), qui effectuera une attaque par dictionnaire (force brute).

## Utilisation de nmap et john
```
root@kali:~# nmap -p1521 --script oracle-brute-stealth --script-args oracle-brute-stealth.sid=DB11g -n 10.11.21.30

Starting Nmap 6.49BETA4 (https://nmap.org) at 2016-03-02 14:58 EST
Nmap scan report for 10.11.21.30
PORT     STATE SERVICE
1521/tcp open  oracle
| oracle-brute-stealth:
|   Accounts
|     SYS:$o5logon$1245C95384E15E7F0C893FCD1893D8E19078170867E892CE86DF90880E09FAD3B4832CBCFDAC1
|     A821D2EA8E3D2209DB6*4202433F49DE9AE72AE2 - 
|     Hashed valid or invalid credentials
|   Statistics
|_    Performed 241 guesses in 12 seconds, average tps: 20

john hashes.txt
```
<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

- Travaillez-vous dans une entreprise de **cybers√©curit√©** ? Voulez-vous voir votre **entreprise annonc√©e dans HackTricks** ? ou voulez-vous avoir acc√®s √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !

- D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)

- Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)

- **Rejoignez le** [**üí¨**](https://emojipedia.org/speech-balloon/) **groupe Discord** ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**

- **Partagez vos astuces de piratage en soumettant des PR au [repo hacktricks](https://github.com/carlospolop/hacktricks) et au [repo hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>
