# Per√≠metro externo: Fuerza bruta de contrase√±a remota y sigilosa

**Las versiones 11.1.0.6, 11.1.0.7, 11.2.0.1, 11.2.0.2 y 11.2.0.3 son vulnerables** a esta t√©cnica. Para entender la idea detr√°s de esta vulnerabilidad, es necesario considerar c√≥mo funciona el protocolo de autenticaci√≥n con la base de datos. Mostrar√© c√≥mo funciona para la versi√≥n 11. La interacci√≥n con el servidor procede de la siguiente manera:

1. El cliente se conecta al servidor y env√≠a el nombre de usuario.
2. El servidor genera un identificador de sesi√≥n ('AUTH\_SESSKEY') y lo cifra utilizando AES-192. Como clave, el sistema utiliza el hash SHA-1 generado a partir de la contrase√±a del usuario y la sal ('AUTH\_VFR\_DATA').
3. El servidor env√≠a al cliente un identificador de sesi√≥n cifrado y una sal.
4. El cliente genera la clave cifrando su contrase√±a y la sal recibida. El cliente utiliza esta clave para descifrar los datos de sesi√≥n recibidos del servidor.
5. Bas√°ndose en el identificador de sesi√≥n del servidor descifrado, el cliente genera una nueva clave p√∫blica para su uso futuro.

Ahora, aqu√≠ est√° la parte m√°s interesante: El identificador de sesi√≥n 'AUTH\_SESSKEY' enviado por el servidor al cliente tiene una longitud de 48 bytes. De estos, 40 bytes son aleatorios y los √∫ltimos 8 son duplicados de '0x08'. El vector de inicializaci√≥n es 0x00 (nulo).\
Sabiendo que los √∫ltimos 8 bytes del identificador p√∫blico siempre consisten en '0x08', podemos realizar un ataque de fuerza bruta a esta contrase√±a y, adem√°s, hacerlo en modo offline, lo que significa una velocidad tremenda, especialmente si se utiliza una GPU. Para llevar a cabo un ataque, es necesario conocer el SID, un inicio de sesi√≥n v√°lido (por ejemplo, la cuenta 'SYS' es muy interesante) y, por supuesto, tener la capacidad de conectarse a la base de datos. En este caso, no habr√° registros, como 'Intento de inicio de sesi√≥n no v√°lido', creados en los registros de auditor√≠a de Oracle.

Resumiendo:

1. Utilice Wireshark para **interceptar** el **tr√°fico inicial** durante la **autorizaci√≥n**. Esto ser√° ayudado por el filtro 'tns'.
2. Extraiga los **valores HEX para AUTH\_SESSKEY, AUTH\_VFR\_DATA**.
3. Incl√∫yalos en el [**script PoC**](https://www.exploit-db.com/exploits/22069), que realizar√° un ataque de diccionario (fuerza bruta).

## Usando nmap y john
```
root@kali:~# nmap -p1521 --script oracle-brute-stealth --script-args oracle-brute-stealth.sid=DB11g -n 10.11.21.30

Starting Nmap 6.49BETA4 (https://nmap.org) at 2016-03-02 14:58 EST
Nmap scan report for 10.11.21.30
PORT     STATE SERVICE
1521/tcp open  oracle
| oracle-brute-stealth:
|   Accounts
|     SYS:$o5logon$1245C95384E15E7F0C893FCD1893D8E19078170867E892CE86DF90880E09FAD3B4832CBCFDAC1
|     A821D2EA8E3D2209DB6*4202433F49DE9AE72AE2 - 
|     Hashed valid or invalid credentials
|   Statistics
|_    Performed 241 guesses in 12 seconds, average tps: 20

john hashes.txt
```
<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

- ¬øTrabajas en una **empresa de ciberseguridad**? ¬øQuieres ver tu **empresa anunciada en HackTricks**? ¬øO quieres tener acceso a la **√∫ltima versi√≥n de PEASS o descargar HackTricks en PDF**? ¬°Consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!

- Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)

- Obt√©n la [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)

- **√önete al** [**üí¨**](https://emojipedia.org/speech-balloon/) **grupo de Discord** o al [**grupo de telegram**](https://t.me/peass) o **s√≠gueme en** **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**

- **Comparte tus trucos de hacking enviando PRs al [repositorio de hacktricks](https://github.com/carlospolop/hacktricks) y al [repositorio de hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>
