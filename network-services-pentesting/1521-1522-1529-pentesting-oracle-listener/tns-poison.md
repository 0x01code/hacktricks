<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks Cloud ☁️</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>🐦 Twitter 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 Youtube 🎥</strong></a></summary>

- Travaillez-vous dans une entreprise de **cybersécurité** ? Voulez-vous voir votre **entreprise annoncée dans HackTricks** ? ou voulez-vous avoir accès à la **dernière version de PEASS ou télécharger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !

- Découvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)

- Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)

- **Rejoignez le** [**💬**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**

- **Partagez vos astuces de piratage en soumettant des PR au [repo hacktricks](https://github.com/carlospolop/hacktricks) et au [repo hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>


# Poison TNS

Si vous rencontrez une version plus récente du listener, il ne reste plus beaucoup de place sauf le brute-forcing. Cependant, toutes les versions jusqu'à la version 12c sont vulnérables à une attaque appelée « Poison TNS ». Bien que la dernière version ne soit vulnérable que dans certaines configurations spéciales. Par exemple, l'une des façons de corriger cette vulnérabilité est de désactiver la configuration dynamique du listener, ce qui est impossible lors de l'utilisation d'Oracle DataGuard, PL/SQL Gateway en connexion avec APEX et dans certaines versions de SAP. En général, le problème est que, par défaut, le service d'écoute prend en charge la configuration à distance et, en outre, il permet de le faire de manière anonyme. C'est là que se situe le cœur de la vulnérabilité.

[![Fig. 1. TNS Poison Vulnerability](https://hackmag.com/wp-content/uploads/2015/04/poison.png)](https://hackmag.com/wp-content/uploads/2015/04/poison.png)

Fig. 1. Vulnérabilité Poison TNS

Voici un algorithme d'attaque d'exemple (voir Fig. 1) :

* Envoyer la requête TNS suivante : « CONNECT_DATA=(COMMAND=SERVICE_REGISTER_NSGR)) ».
* Le serveur vulnérable répondra : « (DESCRIPTION=(TMP=)) ». Voici ce que sera la réponse d'un serveur patché : « (ERROR_STACK=(ERROR=1194)) ».
* Générer un package de configuration avec SID et IP du nouveau listener (pour une future MITM). Le nombre de caractères dans le nom du SID actuel est fondamental. Vous devez le connaître, car c'est de cela que dépend un package bien formé.
* Ensuite, envoyer tous ces goodies au listener.
* Si tout est correct, alors toutes les nouvelles connexions seront transmises par le listener via votre IP contrôlée.

Il est important de ne pas oublier d'activer le proxying des requêtes (comme IP_forwarding sous Linux), sinon, au lieu d'une attaque MITM soignée, vous obtiendrez un DoS rugueux, car les nouveaux clients ne pourront pas se connecter à la base de données. En conséquence, un attaquant peut intégrer ses propres commandes dans la session d'un autre utilisateur. **Vous pouvez vérifier si le serveur est vulnérable en utilisant le module MSF suivant : « auxiliary/scanner/oracle/tnspoison_checker ».**

Toutes ces pages ont été extraites d'ici : [https://hackmag.com/uncategorized/looking-into-methods-to-penetrate-oracle-db/](https://hackmag.com/uncategorized/looking-into-methods-to-penetrate-oracle-db/)

**Autre façon de tester :**
```text
./odat.py tnspoison -s <IP> -p <PORT> -d <SID> --test-module
```
<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks Cloud ☁️</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>🐦 Twitter 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 Youtube 🎥</strong></a></summary>

- Travaillez-vous dans une entreprise de **cybersécurité** ? Voulez-vous voir votre **entreprise annoncée dans HackTricks** ? ou voulez-vous avoir accès à la **dernière version de PEASS ou télécharger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !

- Découvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)

- Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)

- **Rejoignez le** [**💬**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**

- **Partagez vos astuces de piratage en soumettant des PR au [repo hacktricks](https://github.com/carlospolop/hacktricks) et au [repo hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>
