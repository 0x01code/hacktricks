<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks云 ☁️</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>🐦 推特 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 Youtube 🎥</strong></a></summary>

- 你在一家**网络安全公司**工作吗？你想在HackTricks中看到你的**公司广告**吗？或者你想获得**PEASS的最新版本或下载PDF格式的HackTricks**吗？请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！

- 发现我们的独家[**NFTs**](https://opensea.io/collection/the-peass-family)收藏品- [**The PEASS Family**](https://opensea.io/collection/the-peass-family)

- 获取[**官方PEASS和HackTricks周边产品**](https://peass.creator-spring.com)

- **加入** [**💬**](https://emojipedia.org/speech-balloon/) [**Discord群组**](https://discord.gg/hRep4RUj7f) 或 [**电报群组**](https://t.me/peass) 或 **关注**我在**Twitter**上的[**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**

- **通过向[hacktricks repo](https://github.com/carlospolop/hacktricks)和[hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)提交PR来分享你的黑客技巧**。

</details>


# TNS中毒

如果你遇到了更新版本的监听器，除了暴力破解之外，几乎没有其他办法。然而，所有版本直到12c版本都容易受到一种名为“TNS中毒”的攻击。尽管较新版本只在某些特殊配置下容易受到攻击。例如，修复此漏洞的一种方法是禁用监听器的动态配置，但在使用Oracle DataGuard、与APEX连接的PL/SQL Gateway以及某些版本的SAP时是不可能的。总的来说，问题在于监听器服务默认支持远程配置，并且还允许匿名配置。这就是漏洞的核心所在。

[![图1. TNS中毒漏洞](https://hackmag.com/wp-content/uploads/2015/04/poison.png)](https://hackmag.com/wp-content/uploads/2015/04/poison.png)

图1. TNS中毒漏洞

这是一个示例攻击算法（见图1）：

* 发送以下TNS查询：“CONNECT\_DATA=\(COMMAND=SERVICE\_REGISTER\_NSGR\)\)”。
* 受漏洞影响的服务器将回复：“\(DESCRIPTION=\(TMP=\)\)”。这是修补后服务器的回答：“\(ERROR\_STACK=\(ERROR=1194\)\)”。
* 生成一个包含新监听器的SID和IP的配置包（用于未来的中间人攻击）。当前SID名称的字符数非常重要，你需要知道它，因为这取决于一个格式良好的包。
* 接下来，将所有这些好东西发送给监听器。
* 如果一切正常，那么所有新的连接将通过监听器转发到你控制的IP。

重要的是不要忘记启用查询的代理（例如Linux中的IP\_forwarding），否则，你将得到一个粗糙的DoS，而不是一个整洁的中间人攻击，因为新的客户端将无法连接到数据库。结果，攻击者可以在另一个用户的会话中嵌入自己的命令。**你可以使用以下MSF模块“auxiliary/scanner/oracle/tnspoison\_checker”来检查服务器是否容易受到攻击。**

本页内容摘自：[https://hackmag.com/uncategorized/looking-into-methods-to-penetrate-oracle-db/](https://hackmag.com/uncategorized/looking-into-methods-to-penetrate-oracle-db/)

**另一种测试方法：**
```text
./odat.py tnspoison -s <IP> -p <PORT> -d <SID> --test-module
```
<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks云 ☁️</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>🐦 推特 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 Youtube 🎥</strong></a></summary>

- 你在一家**网络安全公司**工作吗？你想在HackTricks中看到你的**公司广告**吗？或者你想获得**PEASS的最新版本或下载HackTricks的PDF**吗？请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！

- 发现我们的独家[**NFTs**](https://opensea.io/collection/the-peass-family)收藏品- [**The PEASS Family**](https://opensea.io/collection/the-peass-family)

- 获得[**官方PEASS和HackTricks周边产品**](https://peass.creator-spring.com)

- **加入** [**💬**](https://emojipedia.org/speech-balloon/) [**Discord群组**](https://discord.gg/hRep4RUj7f) 或 [**Telegram群组**](https://t.me/peass) 或 **关注**我在**Twitter**上的 [**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**

- **通过向[hacktricks repo](https://github.com/carlospolop/hacktricks)和[hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)提交PR来分享你的黑客技巧**。

</details>
