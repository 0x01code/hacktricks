# Envenenamento TNS

Se você encontrar uma versão mais recente do listener, não há muito espaço para manobra, exceto a força bruta. No entanto, todas as versões até a versão 12c são vulneráveis a um ataque chamado 'TNS Poison'. Embora a última versão seja vulnerável apenas em algumas configurações especiais. Por exemplo, uma das maneiras de corrigir essa vulnerabilidade é desativando a configuração dinâmica do listener, o que é impossível ao usar o Oracle DataGuard, PL/SQL Gateway em conexão com APEX e em algumas versões do SAP. Em geral, o problema é que, por padrão, o serviço de listener suporta configuração remota e, além disso, permite fazê-lo anonimamente. É aqui que está o coração da vulnerabilidade.

[![Fig. 1. Vulnerabilidade TNS Poison](https://hackmag.com/wp-content/uploads/2015/04/poison.png)](https://hackmag.com/wp-content/uploads/2015/04/poison.png)

Fig. 1. Vulnerabilidade TNS Poison

Este é um algoritmo de ataque de amostra (veja a Fig. 1):

* Envie a seguinte consulta TNS: 'CONNECT_DATA = \(COMMAND = SERVICE_REGISTER_NSGR\)\)'.
* O servidor vulnerável responderá: '\(DESCRIPTION = \(TMP = \)\)'. Isso é o que será a resposta de um servidor corrigido: '\(ERROR_STACK = \(ERROR = 1194\)\)'.
* Gere um pacote de configuração com SID e IP do novo listener (para futura MITM). O número de caracteres no nome do SID atual é de fundamental importância. Você precisa saber disso, já que é disso que depende um pacote bem formado.
* Em seguida, envie todos esses recursos para o listener.
* Se tudo estiver correto, todas as novas conexões serão encaminhadas pelo listener por meio do seu IP controlado.

É importante não esquecer de habilitar o proxy de consultas (como IP_forwarding no Linux), caso contrário, em vez de um ataque MITM limpo, você obterá um DoS bruto, porque os novos clientes não conseguirão se conectar ao banco de dados. Como resultado, um invasor pode incorporar seus próprios comandos dentro da sessão de outro usuário. **Você pode verificar se o servidor é vulnerável usando o seguinte módulo MSF: 'auxiliary/scanner/oracle/tnspoison_checker'.**

Toda esta página foi extraída daqui: [https://hackmag.com/uncategorized/looking-into-methods-to-penetrate-oracle-db/](https://hackmag.com/uncategorized/looking-into-methods-to-penetrate-oracle-db/)

**Outra maneira de testar:**
```text
./odat.py tnspoison -s <IP> -p <PORT> -d <SID> --test-module
```
<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks Cloud ☁️</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>🐦 Twitter 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 Youtube 🎥</strong></a></summary>

- Você trabalha em uma **empresa de segurança cibernética**? Você quer ver sua **empresa anunciada no HackTricks**? ou você quer ter acesso à **última versão do PEASS ou baixar o HackTricks em PDF**? Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!

- Descubra [**A Família PEASS**](https://opensea.io/collection/the-peass-family), nossa coleção exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)

- Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)

- **Junte-se ao** [**💬**](https://emojipedia.org/speech-balloon/) [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**

- **Compartilhe seus truques de hacking enviando PRs para o [repositório hacktricks](https://github.com/carlospolop/hacktricks) e [hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)**.

</details>
