# TNS Poison

Se voc√™ encontrar uma vers√£o mais recente do listener, n√£o h√° muitas op√ß√µes al√©m de for√ßa bruta. No entanto, todas as vers√µes at√© a vers√£o 12c s√£o vulner√°veis a um ataque chamado 'TNS Poison'. Embora a vers√£o posterior seja vulner√°vel apenas em algumas configura√ß√µes especiais. Por exemplo, uma das maneiras de corrigir essa vulnerabilidade √© desativando a configura√ß√£o din√¢mica do listener, o que √© imposs√≠vel ao usar Oracle DataGuard, PL/SQL Gateway em conex√£o com APEX e em algumas vers√µes do SAP. Em geral, o problema √© que, por padr√£o, o servi√ßo de listener suporta configura√ß√£o remota e, al√©m disso, permite faz√™-lo anonimamente. √â aqui que reside o cora√ß√£o da vulnerabilidade.

[![Fig. 1. Vulnerabilidade TNS Poison](https://hackmag.com/wp-content/uploads/2015/04/poison.png)](https://hackmag.com/wp-content/uploads/2015/04/poison.png)

Fig. 1. Vulnerabilidade TNS Poison

Este √© um algoritmo de ataque de exemplo \(veja Fig. 1\):

* Envie a seguinte consulta TNS: 'CONNECT\_DATA=\(COMMAND=SERVICE\_REGISTER\_NSGR\)\)'.
* O servidor vulner√°vel responder√°: '\(DESCRIPTION=\(TMP=\)\)'. Esta ser√° a resposta de um servidor corrigido: '\(ERROR\_STACK=\(ERROR=1194\)\)'.
* Gere um pacote de configura√ß√£o com SID e IP do novo listener \(para futuro MITM\). O n√∫mero de caracteres no nome do SID atual √© de fundamental import√¢ncia. Voc√™ precisa conhec√™-lo, pois √© isso que um pacote Bem Formado depende.
* Em seguida, envie todas essas informa√ß√µes ao listener.
* Se tudo estiver correto, ent√£o todas as novas conex√µes ser√£o encaminhadas pelo listener atrav√©s do seu IP controlado.

√â importante n√£o esquecer de habilitar o proxy das consultas \(como IP\_forwarding no Linux\), caso contr√°rio, em vez de um ataque MITM organizado, voc√™ ter√° um DoS bruto, porque os novos clientes n√£o poder√£o se conectar ao banco de dados. Como resultado, um atacante pode incorporar seus pr√≥prios comandos dentro da sess√£o de outro usu√°rio. **Voc√™ pode verificar se o servidor √© vulner√°vel usando o seguinte m√≥dulo MSF: 'auxiliary/scanner/oracle/tnspoison\_checker'.**

Toda esta p√°gina foi extra√≠da daqui: [https://hackmag.com/uncategorized/looking-into-methods-to-penetrate-oracle-db/](https://hackmag.com/uncategorized/looking-into-methods-to-penetrate-oracle-db/)

**Outra maneira de testar:**
```text
./odat.py tnspoison -s <IP> -p <PORT> -d <SID> --test-module
```
<details>

<summary><strong>Aprenda hacking no AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ quer ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**material oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **Junte-se ao grupo** üí¨ [**Discord**](https://discord.gg/hRep4RUj7f) ou ao grupo [**telegram**](https://t.me/peass) ou **siga**-me no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios github do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
