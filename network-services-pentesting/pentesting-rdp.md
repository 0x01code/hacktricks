# 3389 - RDP 펜테스팅

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>를 통해 AWS 해킹을 처음부터 전문가까지 배워보세요<strong>!</strong></summary>

HackTricks를 지원하는 다른 방법:

* **회사를 HackTricks에서 광고하거나 HackTricks를 PDF로 다운로드**하려면 [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)를 확인하세요!
* [**공식 PEASS & HackTricks 스웨그**](https://peass.creator-spring.com)를 얻으세요.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)를 발견하세요. 독점적인 [**NFTs**](https://opensea.io/collection/the-peass-family) 컬렉션입니다.
* 💬 [**Discord 그룹**](https://discord.gg/hRep4RUj7f) 또는 [**텔레그램 그룹**](https://t.me/peass)에 **참여**하거나 **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)**를** **팔로우**하세요.
* **Hacking 트릭을 공유하려면 PR을** [**HackTricks**](https://github.com/carlospolop/hacktricks) **및** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **github 저장소에 제출**하세요.

</details>

<figure><img src="/.gitbook/assets/image (2).png" alt=""><figcaption></figcaption></figure>

**취약점 평가 및 펜테스팅을 위한 즉시 사용 가능한 설정**. 20개 이상의 도구 및 기능을 사용하여 어디서든 전체 펜테스트를 실행하고, 리콘부터 보고까지 가능합니다. 우리는 펜테스터를 대체하지 않습니다 - 대신, 펜테스터가 더 깊이 파고들고, 쉘을 열고, 재미를 느낄 수 있도록 사용자 정의 도구, 탐지 및 공격 모듈을 개발합니다.

{% embed url="https://pentest-tools.com/" %}

## 기본 정보

Microsoft에서 개발된 **원격 데스크톱 프로토콜** (**RDP**)은 네트워크를 통해 컴퓨터 간에 그래픽 인터페이스 연결을 가능하게 하는 것을 목적으로 설계되었습니다. 이러한 연결을 설정하기 위해 사용자는 **RDP** 클라이언트 소프트웨어를 사용하며, 동시에 원격 컴퓨터는 **RDP** 서버 소프트웨어를 실행해야 합니다. 이 설정을 통해 원격 컴퓨터의 데스크톱 환경을 원활하게 제어하고 접근할 수 있으며, 사용자의 로컬 장치로 인터페이스를 가져올 수 있습니다.

**기본 포트:** 3389
```
PORT     STATE SERVICE
3389/tcp open  ms-wbt-server
```
## 열거

### 자동

{% code overflow="wrap" %}
```bash
nmap --script "rdp-enum-encryption or rdp-vuln-ms12-020 or rdp-ntlm-info" -p 3389 -T4 <IP>
```
{% endcode %}

사용 가능한 암호화 및 DoS 취약점을 확인하고 (서비스에 DoS를 발생시키지 않고) NTLM Windows 정보 (버전)를 얻습니다.

### [무차별 대입 공격](../generic-methodologies-and-resources/brute-force.md#rdp)

**주의하세요, 계정이 잠길 수 있습니다**

### **비밀번호 스프레이**

**주의하세요, 계정이 잠길 수 있습니다**
```bash
# https://github.com/galkan/crowbar
crowbar -b rdp -s 192.168.220.142/32 -U users.txt -c 'password123'
# hydra
hydra -L usernames.txt -p 'password123' 192.168.2.143 rdp
```
### 알려진 자격 증명/해시로 연결하기

If you have obtained known credentials or password hashes for an RDP (Remote Desktop Protocol) service, you can attempt to connect using them. This method can be useful if you have access to a compromised user account or have obtained credentials through other means.

To connect using known credentials, follow these steps:

1. Open your RDP client software (such as `xfreerdp`, `rdesktop`, or `mstsc`).
2. Enter the IP address or hostname of the target RDP server.
3. Provide the username and password or hash you have obtained.
4. Configure any additional settings, such as display resolution or audio redirection, if necessary.
5. Click on the "Connect" or "OK" button to initiate the connection.

If the provided credentials or hash are correct, you will be granted access to the remote desktop session. However, if the credentials are incorrect or the account has been disabled, you will not be able to establish a connection.

It is important to note that attempting to connect with unauthorized credentials or hashes is illegal and unethical. Always ensure you have proper authorization and permission before performing any penetration testing activities.
```bash
rdesktop -u <username> <IP>
rdesktop -d <domain> -u <username> -p <password> <IP>
xfreerdp [/d:domain] /u:<username> /p:<password> /v:<IP>
xfreerdp [/d:domain] /u:<username> /pth:<hash> /v:<IP> #Pass the hash
```
### 알려진 자격 증명을 RDP 서비스에 대해 확인하기

impacket의 rdp\_check.py를 사용하면 RDP 서비스에 대해 일부 자격 증명이 유효한지 확인할 수 있습니다:
```bash
rdp_check <domain>/<name>:<password>@<IP>
```
<figure><img src="/.gitbook/assets/image (2).png" alt=""><figcaption></figcaption></figure>

**취약성 평가 및 침투 테스트를 위한 즉시 사용 가능한 설정**. 20개 이상의 도구 및 기능을 사용하여 리콘부터 보고까지 전체 펜테스트를 어디에서나 실행할 수 있습니다. 우리는 펜테스터를 대체하지 않습니다 - 대신, 펜테스터들에게 더 깊이 파고들고, 쉘을 열고, 재미를 느낄 수 있도록 맞춤형 도구, 탐지 및 공격 모듈을 개발합니다.

{% embed url="https://pentest-tools.com/" %}

## **공격**

### 세션 도용

**SYSTEM 권한**으로 소유자의 비밀번호를 알 필요 없이 **어떤 사용자의 열린 RDP 세션에 접근**할 수 있습니다.

**열린 세션 가져오기:**
```
query user
```
**선택한 세션에 액세스하기**

To gain access to the selected session, follow these steps:

1. Identify the target system's IP address and ensure that it has the Remote Desktop Protocol (RDP) service enabled.
2. Use a port scanning tool to check if the RDP port (default: 3389) is open on the target system.
3. If the RDP port is open, attempt to establish a connection using an RDP client such as `xfreerdp` or `mstsc`.
4. Provide the necessary credentials (username and password) to authenticate and log in to the RDP session.
5. Once logged in, you will have access to the remote system's desktop and can interact with it as if you were physically present.

Note: It is important to obtain proper authorization before attempting to access any session or system that you do not own or have permission to access. Unauthorized access is illegal and unethical.
```bash
tscon <ID> /dest:<SESSIONNAME>
```
이제 선택한 RDP 세션 내부에 들어가서 Windows 도구와 기능만을 사용하여 사용자를 위장해야 합니다.

**중요**: 활성화된 RDP 세션에 액세스하면 사용 중인 사용자가 로그아웃됩니다.

프로세스 덤프를 통해 암호를 얻을 수도 있지만, 이 방법은 훨씬 빠르며 사용자의 가상 데스크톱과 상호작용할 수 있습니다(디스크에 저장되지 않은 메모장에 있는 암호, 다른 기기에서 열린 다른 RDP 세션 등).

#### **Mimikatz**

이를 수행하기 위해 mimikatz를 사용할 수도 있습니다:
```bash
ts::sessions        #Get sessions
ts::remote /id:2    #Connect to the session
```
### Sticky-keys & Utilman

이 기술을 **stickykeys** 또는 **utilman과 결합하면 언제든지 관리자 CMD 및 RDP 세션에 액세스할 수 있습니다.**

이미 이러한 기술 중 하나로 백도어가 설치된 RDP를 검색할 수 있습니다: [https://github.com/linuz/Sticky-Keys-Slayer](https://github.com/linuz/Sticky-Keys-Slayer)

### RDP 프로세스 주입

다른 도메인에서 또는 **더 높은 권한을 가진 사용자가 RDP를 통해** 관리자로 로그인한 경우, **그의 RDP 세션 프로세스에 비콘을 주입**하여 그의 대리인으로 행동할 수 있습니다:

{% content-ref url="../windows-hardening/active-directory-methodology/rdp-sessions-abuse.md" %}
[rdp-sessions-abuse.md](../windows-hardening/active-directory-methodology/rdp-sessions-abuse.md)
{% endcontent-ref %}

### RDP 그룹에 사용자 추가
```bash
net localgroup "Remote Desktop Users" UserLoginName /add
```
## 자동 도구

* [**AutoRDPwn**](https://github.com/JoelGMSec/AutoRDPwn)

**AutoRDPwn**은 주로 Microsoft Windows 컴퓨터에서 **Shadow** 공격을 자동화하기 위해 Powershell로 작성된 포스트-익스플로잇 프레임워크입니다. 이 취약점은 (Microsoft에서 기능으로 나열된) 원격 공격자가 피해자의 동의 없이 그의 데스크톱을 **볼 수 있게 해주며**, 운영 체제 자체의 도구를 사용하여 필요에 따라 제어할 수도 있습니다.

* [**EvilRDP**](https://github.com/skelsec/evilrdp)
* 명령 줄에서 자동화된 방식으로 마우스와 키보드를 제어합니다.
* 명령 줄에서 자동화된 방식으로 클립보드를 제어합니다.
* 클라이언트에서 RDP를 통해 대상으로 네트워크 통신을 전달하는 SOCKS 프록시를 생성합니다.
* 파일 전송이 대상에서 비활성화되어 있을 때도 대상과 파일을 업로드하고 다운로드합니다.
* 파일을 업로드하지 않고 대상에서 임의의 SHELL 및 PowerShell 명령을 실행합니다.

## HackTricks 자동 명령어
```
Protocol_Name: RDP    #Protocol Abbreviation if there is one.
Port_Number:  3389     #Comma separated if there is more than one.
Protocol_Description: Remote Desktop Protocol         #Protocol Abbreviation Spelled out

Entry_1:
Name: Notes
Description: Notes for RDP
Note: |
Developed by Microsoft, the Remote Desktop Protocol (RDP) is designed to enable a graphical interface connection between computers over a network. To establish such a connection, RDP client software is utilized by the user, and concurrently, the remote computer is required to operate RDP server software. This setup allows for the seamless control and access of a distant computer's desktop environment, essentially bringing its interface to the user's local device.

https://book.hacktricks.xyz/pentesting/pentesting-rdp

Entry_2:
Name: Nmap
Description: Nmap with RDP Scripts
Command: nmap --script "rdp-enum-encryption or rdp-vuln-ms12-020 or rdp-ntlm-info" -p 3389 -T4 {IP}
```
<figure><img src="/.gitbook/assets/image (2).png" alt=""><figcaption></figcaption></figure>

**취약성 평가 및 침투 테스트를 위한 즉시 사용 가능한 설정**. 리콘부터 보고서 작성까지 20개 이상의 도구와 기능으로 어디서든 전체 펜테스트를 실행하세요. 우리는 펜테스터를 대체하지 않습니다 - 대신, 펜테스터들에게 더 깊이 파고들고, 쉘을 획득하고, 재미를 느낄 수 있도록 맞춤형 도구, 탐지 및 공격 모듈을 개발합니다.

{% embed url="https://pentest-tools.com/" %}

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>를 통해 AWS 해킹을 처음부터 전문가까지 배워보세요<strong>!</strong></summary>

HackTricks를 지원하는 다른 방법:

* HackTricks에서 **회사 광고를 보거나 HackTricks를 PDF로 다운로드**하려면 [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)를 확인하세요!
* [**공식 PEASS & HackTricks 스웨그**](https://peass.creator-spring.com)를 구매하세요.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)를 발견하세요. 독점적인 [**NFTs**](https://opensea.io/collection/the-peass-family) 컬렉션입니다.
* 💬 [**Discord 그룹**](https://discord.gg/hRep4RUj7f) 또는 [**텔레그램 그룹**](https://t.me/peass)에 **참여**하거나 **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)을 **팔로우**하세요.
* **HackTricks**와 **HackTricks Cloud** github 저장소에 PR을 제출하여 여러분의 해킹 기법을 공유하세요.

</details>
