# 3389 - Ελέγχος Ασφαλείας RDP

<details>

<summary><strong>Μάθετε το χάκινγκ στο AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι υποστήριξης του HackTricks:

* Αν θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**την Οικογένεια PEASS**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε στη** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στη [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Μοιραστείτε τα χάκινγκ κόλπα σας υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>

<figure><img src="/.gitbook/assets/image (2).png" alt=""><figcaption></figcaption></figure>

**Άμεσα διαθέσιμη εγκατάσταση για αξιολόγηση ευπαθειών και ελέγχο διείσδυσης**. Εκτελέστε έναν πλήρη έλεγχο διείσδυσης από οπουδήποτε με 20+ εργαλεία και χαρακτηριστικά που καλύπτουν από την αναγνώριση έως την αναφορά. Δεν αντικαθιστούμε τους ελεγκτές διείσδυσης - αναπτύσσουμε προσαρμοσμένα εργαλεία, ανίχνευση και εκμετάλλευση ενοτήτων για να τους δώσουμε πίσω χρόνο για να εξερευνήσουν πιο βαθιά, να ανοίξουν καρέκλες και να διασκεδάσουν.

{% embed url="https://pentest-tools.com/" %}

## Βασικές Πληροφορίες

Αναπτύχθηκε από τη Microsoft, το **Remote Desktop Protocol** (**RDP**) σχεδιάστηκε για να επιτρέπει μια συνδεση γραφικής διεπαφής μεταξύ υπολογιστών μέσω δικτύου. Για να δημιουργηθεί μια τέτοια σύνδεση, ο χρήστης χρησιμοποιεί λογισμικό πελάτη **RDP**, ενώ ταυτόχρονα ο απομακρυσμένος υπολογιστής πρέπει να λειτουργεί ως διακομιστής **RDP**. Αυτή η ρύθμιση επιτρέπει τον άμεσο έλεγχο και πρόσβαση στο περιβάλλον επιφάνειας εργασίας ενός απομακρυσμένου υπολογιστή, φέρνοντας ουσιαστικά τη διεπαφή του στη συσκευή του χρήστη.

**Προεπιλεγμένη θύρα:** 3389
```
PORT     STATE SERVICE
3389/tcp open  ms-wbt-server
```
## Απαρίθμηση

### Αυτόματη

{% code overflow="wrap" %}
```bash
nmap --script "rdp-enum-encryption or rdp-vuln-ms12-020 or rdp-ntlm-info" -p 3389 -T4 <IP>
```
{% endcode %}

Ελέγχει τη διαθέσιμη κρυπτογράφηση και τη ευπάθεια DoS (χωρίς να προκαλεί DoS στην υπηρεσία) και αποκτά πληροφορίες για τα NTLM Windows (εκδόσεις).

### [Βίαιη είσοδος](../generic-methodologies-and-resources/brute-force.md#rdp)

**Προσοχή, μπορείτε να κλειδώσετε λογαριασμούς**

### **Ψεκασμός κωδικού πρόσβασης**

**Προσοχή, μπορείτε να κλειδώσετε λογαριασμούς**
```bash
# https://github.com/galkan/crowbar
crowbar -b rdp -s 192.168.220.142/32 -U users.txt -c 'password123'
# hydra
hydra -L usernames.txt -p 'password123' 192.168.2.143 rdp
```
### Σύνδεση με γνωστά διαπιστευτήρια/κατακερματισμένο κωδικό

Μια από τις πιο απλές μεθόδους για να προσπελάσετε ένα σύστημα RDP είναι να χρησιμοποιήσετε γνωστά διαπιστευτήρια ή κατακερματισμένους κωδικούς. Αυτό μπορεί να γίνει είτε με την προσπάθεια σύνδεσης με γνωστά διαπιστευτήρια, είτε με τη χρήση κατακερματισμένων κωδικών για να προσπελάσετε το σύστημα.

Για να δοκιμάσετε γνωστά διαπιστευτήρια, μπορείτε να χρησιμοποιήσετε κοινά ονόματα χρηστών και κωδικούς που συνήθως χρησιμοποιούνται, όπως "admin/admin", "administrator/administrator" ή "guest/guest". Επίσης, μπορείτε να δοκιμάσετε γνωστά διαπιστευτήρια που έχουν διαρρεύσει από προηγούμενες παραβιάσεις δεδομένων.

Αντίθετα, αν έχετε πρόσβαση σε έναν κατακερματισμένο κωδικό, μπορείτε να χρησιμοποιήσετε μια λειτουργία αντίστροφης κατακερματισμού για να αντιστοιχίσετε τον κατακερματισμένο κωδικό σε έναν πραγματικό κωδικό και να τον χρησιμοποιήσετε για να συνδεθείτε στο σύστημα RDP.

Πρέπει να σημειωθεί ότι αυτή η μέθοδος είναι αποτελεσματική μόνο εάν οι διαχειριστές του συστήματος δεν έχουν αλλάξει τα προεπιλεγμένα διαπιστευτήρια ή εάν δεν έχουν εφαρμόσει περιορισμούς πρόσβασης με βάση τη διεύθυνση IP.
```bash
rdesktop -u <username> <IP>
rdesktop -d <domain> -u <username> -p <password> <IP>
xfreerdp [/d:domain] /u:<username> /p:<password> /v:<IP>
xfreerdp [/d:domain] /u:<username> /pth:<hash> /v:<IP> #Pass the hash
```
### Έλεγχος γνωστών διαπιστευτηρίων σε υπηρεσίες RDP

Το rdp\_check.py από το impacket σας επιτρέπει να ελέγξετε εάν κάποια διαπιστευτήρια είναι έγκυρα για μια υπηρεσία RDP:
```bash
rdp_check <domain>/<name>:<password>@<IP>
```
<figure><img src="/.gitbook/assets/image (2).png" alt=""><figcaption></figcaption></figure>

**Άμεσα διαθέσιμη εγκατάσταση για αξιολόγηση ευπαθειών και δοκιμές διείσδυσης**. Εκτελέστε μια πλήρη δοκιμή διείσδυσης από οπουδήποτε με 20+ εργαλεία και χαρακτηριστικά που καλύπτουν από την αναγνώριση έως την αναφορά. Δεν αντικαθιστούμε τους δοκιμαστές διείσδυσης - αναπτύσσουμε προσαρμοσμένα εργαλεία, ανίχνευση και εκμετάλλευση ενοτήτων για να τους δώσουμε πίσω χρόνο για να εξερευνήσουν πιο βαθιά, να αποκτήσουν πρόσβαση σε κελύφη και να διασκεδάσουν.

{% embed url="https://pentest-tools.com/" %}

## **Επιθέσεις**

### Κλοπή συνεδρίας

Με **δικαιώματα SYSTEM** μπορείτε να αποκτήσετε πρόσβαση σε οποιαδήποτε **ανοιχτή συνεδρία RDP από οποιονδήποτε χρήστη** χωρίς να χρειάζεται να γνωρίζετε τον κωδικό πρόσβασης του ιδιοκτήτη.

**Λήψη ανοιχτών συνεδριών:**
```
query user
```
**Πρόσβαση στην επιλεγμένη συνεδρία**

To gain access to the selected session, you can use the following methods:

1. **Brute Force Attack**: This method involves systematically trying all possible combinations of usernames and passwords until the correct credentials are found. It is important to use a strong password list and implement rate limiting to avoid detection.

2. **Credential Stuffing**: In this method, a list of previously leaked usernames and passwords is used to attempt login to the session. It is crucial to use a large and up-to-date list of credentials for better chances of success.

3. **Password Spraying**: This technique involves using a small set of commonly used passwords and trying them against multiple user accounts. It is effective against weak passwords but requires a good understanding of the target's password policies.

4. **Session Hijacking**: This method involves intercepting and stealing an active session's credentials or session identifier. It can be done through techniques like session sidejacking, session fixation, or session replay attacks.

5. **Exploiting Vulnerabilities**: By identifying and exploiting vulnerabilities in the Remote Desktop Protocol (RDP) implementation or the underlying operating system, you can gain unauthorized access to the session. Common vulnerabilities include weak encryption, buffer overflows, and insecure RDP configurations.

Remember to always obtain proper authorization before attempting any of these techniques. Unauthorized access to someone else's session is illegal and unethical.
```bash
tscon <ID> /dest:<SESSIONNAME>
```
Τώρα θα βρίσκεστε μέσα στην επιλεγμένη συνεδρία RDP και θα πρέπει να προσομοιώσετε έναν χρήστη χρησιμοποιώντας μόνο εργαλεία και χαρακτηριστικά των Windows.

**Σημαντικό**: Όταν έχετε πρόσβαση σε μια ενεργή συνεδρία RDP, θα αποσυνδέσετε τον χρήστη που τη χρησιμοποιούσε.

Μπορείτε να ανακτήσετε κωδικούς πρόσβασης από τη διαδικασία ανάκτησης τους, αλλά αυτή η μέθοδος είναι πολύ πιο γρήγορη και σας επιτρέπει να αλληλεπιδράσετε με τα εικονικά γραφεία του χρήστη (κωδικοί πρόσβασης σε notepad χωρίς να αποθηκεύονται στον δίσκο, άλλες συνεδρίες RDP που είναι ανοιχτές σε άλλες μηχανές...)

#### **Mimikatz**

Μπορείτε επίσης να χρησιμοποιήσετε το mimikatz για να το κάνετε αυτό:
```bash
ts::sessions        #Get sessions
ts::remote /id:2    #Connect to the session
```
### Sticky-keys & Utilman

Συνδυάζοντας αυτήν την τεχνική με το **stickykeys** ή το **utilman, θα μπορείτε να έχετε πρόσβαση σε ένα διαχειριστικό CMD και οποιαδήποτε συνεδρία RDP οποτεδήποτε**.

Μπορείτε να αναζητήσετε RDPs που έχουν ήδη μολυνθεί με μία από αυτές τις τεχνικές εδώ: [https://github.com/linuz/Sticky-Keys-Slayer](https://github.com/linuz/Sticky-Keys-Slayer)

### Εισαγωγή διεργασίας RDP

Αν κάποιος από ένα διαφορετικό τομέα ή με **καλύτερα δικαιώματα συνδεθεί μέσω RDP** στον υπολογιστή όπου **είστε διαχειριστής**, μπορείτε να **εισάγετε** τον διακόπτη σας στην **διαδικασία της συνεδρίας RDP** του και να ενεργείτε ως αυτός:

{% content-ref url="../windows-hardening/active-directory-methodology/rdp-sessions-abuse.md" %}
[rdp-sessions-abuse.md](../windows-hardening/active-directory-methodology/rdp-sessions-abuse.md)
{% endcontent-ref %}

### Προσθήκη χρήστη στην ομάδα RDP
```bash
net localgroup "Remote Desktop Users" UserLoginName /add
```
## Αυτόματα Εργαλεία

* [**AutoRDPwn**](https://github.com/JoelGMSec/AutoRDPwn)

Το **AutoRDPwn** είναι ένα πλαίσιο μετά-εκμετάλλευσης που δημιουργήθηκε σε Powershell, σχεδιασμένο κυρίως για να αυτοματοποιήσει την επίθεση **Shadow** σε υπολογιστές Microsoft Windows. Αυτή η ευπάθεια (που αναφέρεται ως χαρακτηριστικό από τη Microsoft) επιτρέπει σε έναν απομακρυσμένο επιτιθέμενο να **προβάλει την επιφάνεια εργασίας του θύματός του χωρίς τη συγκατάθεσή του**, και ακόμα και να την ελέγχει κατόπιν αιτήματος, χρησιμοποιώντας εργαλεία που είναι ενσωματωμένα στο ίδιο το λειτουργικό σύστημα.

* [**EvilRDP**](https://github.com/skelsec/evilrdp)
* Έλεγχος του ποντικιού και του πληκτρολογίου με αυτοματοποιημένο τρόπο από τη γραμμή εντολών
* Έλεγχος του πρόχειρου με αυτοματοποιημένο τρόπο από τη γραμμή εντολών
* Δημιουργία ενός SOCKS proxy από τον πελάτη που δρομολογεί τη δικτυακή επικοινωνία προς τον στόχο μέσω RDP
* Εκτέλεση αυθαίρετων εντολών SHELL και PowerShell στον στόχο χωρίς να ανεβάζονται αρχεία
* Μεταφόρτωση και λήψη αρχείων από/προς τον στόχο, ακόμα και όταν οι μεταφορές αρχείων είναι απενεργοποιημένες στον στόχο

## Αυτόματες Εντολές HackTricks
```
Protocol_Name: RDP    #Protocol Abbreviation if there is one.
Port_Number:  3389     #Comma separated if there is more than one.
Protocol_Description: Remote Desktop Protocol         #Protocol Abbreviation Spelled out

Entry_1:
Name: Notes
Description: Notes for RDP
Note: |
Developed by Microsoft, the Remote Desktop Protocol (RDP) is designed to enable a graphical interface connection between computers over a network. To establish such a connection, RDP client software is utilized by the user, and concurrently, the remote computer is required to operate RDP server software. This setup allows for the seamless control and access of a distant computer's desktop environment, essentially bringing its interface to the user's local device.

https://book.hacktricks.xyz/pentesting/pentesting-rdp

Entry_2:
Name: Nmap
Description: Nmap with RDP Scripts
Command: nmap --script "rdp-enum-encryption or rdp-vuln-ms12-020 or rdp-ntlm-info" -p 3389 -T4 {IP}
```
<figure><img src="/.gitbook/assets/image (2).png" alt=""><figcaption></figcaption></figure>

**Άμεσα διαθέσιμη εγκατάσταση για αξιολόγηση ευπαθειών και δοκιμές διείσδυσης**. Εκτελέστε μια πλήρη δοκιμή διείσδυσης από οπουδήποτε με 20+ εργαλεία και χαρακτηριστικά που καλύπτουν από την αναγνώριση έως την αναφορά. Δεν αντικαθιστούμε τους δοκιμαστές διείσδυσης - αναπτύσσουμε προσαρμοσμένα εργαλεία, ανίχνευση και εκμετάλλευση ενοτήτων για να τους δώσουμε πίσω χρόνο για να εξερευνήσουν πιο βαθιά, να αποκτήσουν πρόσβαση σε συστήματα και να διασκεδάσουν.

{% embed url="https://pentest-tools.com/" %}

<details>

<summary><strong>Μάθετε το hacking στο AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι για να υποστηρίξετε το HackTricks:

* Εάν θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF**, ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**The PEASS Family**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε στη** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στη [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Μοιραστείτε τα κόλπα σας στο hacking υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>
