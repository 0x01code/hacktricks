# Protocolos B√°sicos de VoIP

<details>

<summary><strong>Aprenda hacking AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ deseja ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF** Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**swag oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-nos** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para o** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) reposit√≥rios do github.

</details>

### [WhiteIntel](https://whiteintel.io)

<figure><img src="../../../.gitbook/assets/image (1227).png" alt=""><figcaption></figcaption></figure>

[**WhiteIntel**](https://whiteintel.io) √© um mecanismo de busca alimentado pela **dark web** que oferece funcionalidades **gratuitas** para verificar se uma empresa ou seus clientes foram **comprometidos** por **malwares de roubo**.

O principal objetivo do WhiteIntel √© combater tomadas de contas e ataques de ransomware resultantes de malwares de roubo de informa√ß√µes.

Voc√™ pode verificar o site deles e experimentar o mecanismo gratuitamente em:

{% embed url="https://whiteintel.io" %}

***

## Protocolos de Sinaliza√ß√£o

### SIP (Protocolo de Inicia√ß√£o de Sess√£o)

Este √© o padr√£o da ind√∫stria, para mais informa√ß√µes consulte:

{% content-ref url="sip-session-initiation-protocol.md" %}
[sip-session-initiation-protocol.md](sip-session-initiation-protocol.md)
{% endcontent-ref %}

### MGCP (Protocolo de Controle de Gateway de M√≠dia)

MGCP (Protocolo de Controle de Gateway de M√≠dia) √© um **protocolo de sinaliza√ß√£o** e **controle de chamadas** delineado no RFC 3435. Ele opera em uma arquitetura centralizada, que consiste em tr√™s componentes principais:

1. **Agente de Chamadas ou Controlador de Gateway de M√≠dia (MGC)**: O gateway mestre na arquitetura MGCP √© respons√°vel por **gerenciar e controlar os gateways de m√≠dia**. Ele lida com processos de configura√ß√£o, modifica√ß√£o e t√©rmino de chamadas. O MGC se comunica com os gateways de m√≠dia usando o protocolo MGCP.
2. **Gateways de M√≠dia (MGs) ou Gateways Escravos**: Esses dispositivos **convertem fluxos de m√≠dia digitais entre diferentes redes**, como telefonia tradicional comutada por circuitos e redes IP comutadas por pacotes. Eles s√£o gerenciados pelo MGC e executam comandos recebidos dele. Os gateways de m√≠dia podem incluir fun√ß√µes como transcoding, packetization e cancelamento de eco.
3. **Gateways de Sinaliza√ß√£o (SGs)**: Esses gateways s√£o respons√°veis por **converter mensagens de sinaliza√ß√£o entre diferentes redes**, permitindo comunica√ß√£o cont√≠nua entre sistemas de telefonia tradicionais (por exemplo, SS7) e redes baseadas em IP (por exemplo, SIP ou H.323). Os gateways de sinaliza√ß√£o s√£o cruciais para interoperabilidade e garantir que as informa√ß√µes de controle de chamadas sejam comunicadas adequadamente entre as diferentes redes.

Em resumo, o MGCP centraliza a l√≥gica de controle de chamadas no agente de chamadas, o que simplifica o gerenciamento de gateways de m√≠dia e sinaliza√ß√£o, proporcionando melhor escalabilidade, confiabilidade e efici√™ncia em redes de telecomunica√ß√µes.

### SCCP (Protocolo de Controle de Cliente Magro)

O Protocolo de Controle de Cliente Magro (SCCP) √© um **protocolo de sinaliza√ß√£o e controle de chamadas propriet√°rio** de propriedade da Cisco Systems. √â **principalmente usado** para comunica√ß√£o entre o **Cisco Unified Communications Manager** (anteriormente conhecido como CallManager) e telefones IP Cisco ou outros endpoints de voz e v√≠deo da Cisco.

O SCCP √© um protocolo leve que simplifica a comunica√ß√£o entre o servidor de controle de chamadas e os dispositivos de endpoint. √â chamado de "Magro" por causa de seu design minimalista e requisitos de largura de banda reduzidos em compara√ß√£o com outros protocolos VoIP como H.323 ou SIP.

Os principais componentes de um sistema baseado em SCCP s√£o:

1. **Servidor de Controle de Chamadas**: Este servidor, normalmente um Cisco Unified Communications Manager, gerencia os processos de configura√ß√£o, modifica√ß√£o e t√©rmino de chamadas, bem como outras funcionalidades de telefonia, como encaminhamento de chamadas, transfer√™ncia de chamadas e reten√ß√£o de chamadas.
2. **Endpoints SCCP**: Estes s√£o dispositivos como telefones IP, unidades de videoconfer√™ncia ou outros endpoints de voz e v√≠deo da Cisco que usam SCCP para se comunicar com o servidor de controle de chamadas. Eles se registram no servidor, enviam e recebem mensagens de sinaliza√ß√£o e seguem as instru√ß√µes fornecidas pelo servidor de controle de chamadas para o tratamento de chamadas.
3. **Gateways**: Esses dispositivos, como gateways de voz ou gateways de m√≠dia, s√£o respons√°veis por converter fluxos de m√≠dia entre diferentes redes, como telefonia tradicional comutada por circuitos e redes IP comutadas por pacotes. Eles tamb√©m podem incluir funcionalidades adicionais, como transcoding ou cancelamento de eco.

O SCCP oferece um m√©todo de comunica√ß√£o simples e eficiente entre os servidores de controle de chamadas da Cisco e os dispositivos de endpoint. No entanto, vale ressaltar que **o SCCP √© um protocolo propriet√°rio**, o que pode limitar a interoperabilidade com sistemas n√£o-Cisco. Em tais casos, outros protocolos VoIP padr√£o como SIP podem ser mais adequados.

### H.323

H.323 √© uma **su√≠te de protocolos** para comunica√ß√£o multim√≠dia, incluindo voz, v√≠deo e confer√™ncias de dados em redes comutadas por pacotes, como redes baseadas em IP. Foi desenvolvido pela **Uni√£o Internacional de Telecomunica√ß√µes** (ITU-T) e fornece um framework abrangente para gerenciar sess√µes de comunica√ß√£o multim√≠dia.

Alguns componentes-chave da su√≠te H.323 incluem:

1. **Terminais**: Estes s√£o dispositivos de endpoint, como telefones IP, sistemas de videoconfer√™ncia ou aplicativos de software, que suportam H.323 e podem participar de sess√µes de comunica√ß√£o multim√≠dia.
2. **Gateways**: Esses dispositivos convertem fluxos de m√≠dia entre diferentes redes, como telefonia tradicional comutada por circuitos e redes IP comutadas por pacotes, permitindo interoperabilidade entre H.323 e outros sistemas de comunica√ß√£o. Eles tamb√©m podem incluir funcionalidades adicionais, como transcoding ou cancelamento de eco.
3. **Gatekeepers**: Estes s√£o componentes opcionais que fornecem servi√ßos de controle e gerenciamento de chamadas em uma rede H.323. Eles realizam fun√ß√µes como tradu√ß√£o de endere√ßos, gerenciamento de largura de banda e controle de admiss√£o, ajudando a gerenciar e otimizar os recursos da rede.
4. **Unidades de Controle Multiponto (MCUs)**: Estes dispositivos facilitam confer√™ncias multiponto gerenciando e misturando fluxos de m√≠dia de v√°rios endpoints. As MCUs permitem recursos como controle de layout de v√≠deo, comuta√ß√£o ativada por voz e presen√ßa cont√≠nua, possibilitando a realiza√ß√£o de confer√™ncias em grande escala com v√°rios participantes.

H.323 suporta uma variedade de codecs de √°udio e v√≠deo, bem como outros servi√ßos suplementares como encaminhamento de chamadas, transfer√™ncia de chamadas, reten√ß√£o de chamadas e espera de chamadas. Apesar de sua ampla ado√ß√£o nos primeiros dias de VoIP, H.323 foi gradualmente substitu√≠do por protocolos mais modernos e flex√≠veis como o **Protocolo de Inicia√ß√£o de Sess√£o (SIP)**, que oferece melhor interoperabilidade e implementa√ß√£o mais f√°cil. No entanto, H.323 continua em uso em muitos sistemas legados e continua sendo suportado por v√°rios fornecedores de equipamentos.

### IAX (Inter Asterisk eXchange)

IAX (Inter-Asterisk eXchange) √© um **protocolo de sinaliza√ß√£o e controle de chamadas** usado principalmente para comunica√ß√£o entre servidores Asterisk PBX (Private Branch Exchange) e outros dispositivos VoIP. Foi desenvolvido por Mark Spencer, o criador do software de PBX de c√≥digo aberto Asterisk, como uma alternativa a outros protocolos VoIP como SIP e H.323.

IAX √© conhecido por sua **simplicidade, efici√™ncia e facilidade de implementa√ß√£o**. Algumas caracter√≠sticas-chave do IAX incluem:

1. **Porta UDP √önica**: O IAX usa uma √∫nica porta UDP (4569) para tr√°fego de sinaliza√ß√£o e m√≠dia, o que simplifica a travessia de firewall e NAT, facilitando a implanta√ß√£o em v√°rios ambientes de rede.
2. **Protocolo Bin√°rio**: Ao contr√°rio de protocolos baseados em texto como SIP, o IAX √© um protocolo bin√°rio, o que reduz o consumo de largura de banda e o torna mais eficiente para transmitir dados de sinaliza√ß√£o e m√≠dia.
3. **Troncos**: O IAX suporta troncos, o que permite combinar v√°rias chamadas em uma √∫nica conex√£o de rede, reduzindo a sobrecarga e melhorando a utiliza√ß√£o da largura de banda.
4. **Criptografia Nativa**: O IAX possui suporte integrado para criptografia, usando m√©todos como RSA para troca de chaves e AES para criptografia de m√≠dia, proporcionando comunica√ß√£o segura entre os pontos finais.
5. **Comunica√ß√£o Peer-to-Peer**: O IAX pode ser usado para comunica√ß√£o direta entre pontos finais sem a necessidade de um servidor central, permitindo roteamento de chamadas mais simples e eficiente.

Apesar de seus benef√≠cios, o IAX tem algumas limita√ß√µes, como seu foco principal no ecossistema Asterisk e uma ado√ß√£o menos difundida em compara√ß√£o com protocolos mais estabelecidos como SIP. Como resultado, o IAX pode n√£o ser a melhor escolha para interoperabilidade com sistemas ou dispositivos n√£o-Asterisk. No entanto, para aqueles que trabalham dentro do ambiente Asterisk, o IAX oferece uma solu√ß√£o robusta e eficiente para comunica√ß√£o VoIP.
## Protocolos de Transmiss√£o e Transporte

### SDP (Protocolo de Descri√ß√£o de Sess√£o)

O SDP (Protocolo de Descri√ß√£o de Sess√£o) √© um **formato baseado em texto** usado para descrever as caracter√≠sticas de sess√µes multim√≠dia, como voz, v√≠deo ou confer√™ncias de dados, em redes IP. Foi desenvolvido pelo **Internet Engineering Task Force (IETF)** e √© definido no **RFC 4566**. O SDP n√£o lida com a transmiss√£o real de m√≠dia ou o estabelecimento de sess√µes, mas √© usado em conjunto com outros protocolos de sinaliza√ß√£o, como o **SIP (Protocolo de Inicia√ß√£o de Sess√£o)**, para negociar e trocar informa√ß√µes sobre os fluxos de m√≠dia e suas atributos.

Alguns elementos-chave do SDP incluem:

1. **Informa√ß√µes da Sess√£o**: O SDP descreve os detalhes de uma sess√£o multim√≠dia, incluindo nome da sess√£o, descri√ß√£o da sess√£o, hor√°rio de in√≠cio e t√©rmino.
2. **Fluxos de M√≠dia**: O SDP define as caracter√≠sticas dos fluxos de m√≠dia, como o tipo de m√≠dia (√°udio, v√≠deo ou texto), protocolo de transporte (por exemplo, RTP ou SRTP) e o formato da m√≠dia (por exemplo, informa√ß√µes de codec).
3. **Informa√ß√µes de Conex√£o**: O SDP fornece informa√ß√µes sobre o endere√ßo de rede (endere√ßo IP) e n√∫mero da porta onde a m√≠dia deve ser enviada ou recebida.
4. **Atributos**: O SDP suporta o uso de atributos para fornecer informa√ß√µes adicionais e opcionais sobre uma sess√£o ou fluxo de m√≠dia. Os atributos podem ser usados para especificar v√°rias funcionalidades como chaves de criptografia, requisitos de largura de banda ou mecanismos de controle de m√≠dia.

O SDP √© tipicamente usado no seguinte processo:

1. Uma parte iniciadora cria uma descri√ß√£o SDP da sess√£o multim√≠dia proposta, incluindo os detalhes dos fluxos de m√≠dia e seus atributos.
2. A descri√ß√£o SDP √© enviada para a parte receptora, geralmente incorporada em uma mensagem de protocolo de sinaliza√ß√£o como SIP ou RTSP.
3. A parte receptora processa a descri√ß√£o SDP e, com base em suas capacidades, pode aceitar, rejeitar ou modificar a sess√£o proposta.
4. A descri√ß√£o final do SDP √© enviada de volta para a parte iniciadora como parte da mensagem de protocolo de sinaliza√ß√£o, completando o processo de negocia√ß√£o.

A simplicidade e flexibilidade do SDP o tornam um padr√£o amplamente adotado para descrever sess√µes multim√≠dia em v√°rios sistemas de comunica√ß√£o, desempenhando um papel crucial no estabelecimento e gerenciamento de sess√µes multim√≠dia em tempo real em redes IP.

### RTP / RTCP / SRTP / ZRTP

1. **RTP (Protocolo de Transporte em Tempo Real)**: O RTP √© um protocolo de rede projetado para a entrega de dados de √°udio e v√≠deo, ou outras m√≠dias em tempo real, em redes IP. Desenvolvido pelo **IETF** e definido no **RFC 3550**, o RTP √© comumente usado com protocolos de sinaliza√ß√£o como SIP e H.323 para permitir a comunica√ß√£o multim√≠dia. O RTP fornece mecanismos para **sincroniza√ß√£o**, **sequenciamento** e **timestamping** de fluxos de m√≠dia, ajudando a garantir a reprodu√ß√£o suave e oportuna da m√≠dia.
2. **RTCP (Protocolo de Controle de Transporte em Tempo Real)**: O RTCP √© um protocolo complementar ao RTP, usado para monitorar a qualidade de servi√ßo (QoS) e fornecer feedback sobre a transmiss√£o de fluxos de m√≠dia. Definido no mesmo **RFC 3550** que o RTP, o RTCP **troca periodicamente pacotes de controle entre os participantes em uma sess√£o RTP**. Ele compartilha informa√ß√µes como perda de pacotes, jitter e tempo de ida e volta, o que ajuda a diagnosticar e se adaptar √†s condi√ß√µes de rede, melhorando a qualidade geral da m√≠dia.
3. **SRTP (Protocolo de Transporte Seguro em Tempo Real)**: O SRTP √© uma extens√£o do RTP que fornece **criptografia**, **autentica√ß√£o de mensagem** e **prote√ß√£o contra repeti√ß√£o** para fluxos de m√≠dia, garantindo a transmiss√£o segura de dados de √°udio e v√≠deo sens√≠veis. Definido no **RFC 3711**, o SRTP usa algoritmos criptogr√°ficos como AES para criptografia e HMAC-SHA1 para autentica√ß√£o de mensagem. O SRTP √© frequentemente usado em combina√ß√£o com protocolos de sinaliza√ß√£o seguros como SIP sobre TLS para fornecer seguran√ßa de ponta a ponta na comunica√ß√£o multim√≠dia.
4. **ZRTP (Protocolo de Transporte em Tempo Real de Zimmermann)**: O ZRTP √© um protocolo de acordo de chaves criptogr√°ficas que fornece **criptografia de ponta a ponta** para fluxos de m√≠dia RTP. Desenvolvido por Phil Zimmermann, o criador do PGP, o ZRTP √© descrito no **RFC 6189**. Ao contr√°rio do SRTP, que depende de protocolos de sinaliza√ß√£o para troca de chaves, o ZRTP √© projetado para funcionar independentemente do protocolo de sinaliza√ß√£o. Ele usa a **troca de chaves Diffie-Hellman** para estabelecer um segredo compartilhado entre as partes comunicantes, sem exigir confian√ßa pr√©via ou uma infraestrutura de chave p√∫blica (PKI). O ZRTP tamb√©m inclui recursos como **Strings de Autentica√ß√£o Curtas (SAS)** para proteger contra ataques de intermedi√°rios.

Esses protocolos desempenham pap√©is essenciais na **entrega e seguran√ßa da comunica√ß√£o multim√≠dia em tempo real em redes IP**. Enquanto o RTP e o RTCP lidam com a transmiss√£o real de m√≠dia e monitoramento de qualidade, o SRTP e o ZRTP garantem que a m√≠dia transmitida esteja protegida contra espionagem, adultera√ß√£o e ataques de repeti√ß√£o.
