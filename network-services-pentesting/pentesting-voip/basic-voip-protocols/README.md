# Protocolli VoIP di base

<details>

<summary><strong>Impara l'hacking AWS da zero a eroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se vuoi vedere la tua **azienda pubblicizzata su HackTricks** o **scaricare HackTricks in PDF** Controlla i [**PIANI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**La Famiglia PEASS**](https://opensea.io/collection/the-peass-family), la nostra collezione di [**NFT esclusivi**](https://opensea.io/collection/the-peass-family)
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR a** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos di github.

</details>

### [WhiteIntel](https://whiteintel.io)

<figure><img src="/.gitbook/assets/image (1224).png" alt=""><figcaption></figcaption></figure>

[**WhiteIntel**](https://whiteintel.io) √® un motore di ricerca alimentato dal **dark web** che offre funzionalit√† **gratuite** per verificare se un'azienda o i suoi clienti sono stati **compromessi** da **malware ruba-informazioni**.

Il loro obiettivo principale √® combattere i takeover di account e gli attacchi ransomware derivanti da malware che rubano informazioni.

Puoi visitare il loro sito web e provare il loro motore **gratuitamente** su:

{% embed url="https://whiteintel.io" %}

---

## Protocolli di segnalazione

### SIP (Session Initiation Protocol)

Questo √® lo standard del settore, per ulteriori informazioni controlla:

{% content-ref url="sip-session-initiation-protocol.md" %}
[sip-session-initiation-protocol.md](sip-session-initiation-protocol.md)
{% endcontent-ref %}

### MGCP (Media Gateway Control Protocol)

MGCP (Media Gateway Control Protocol) √® un **protocollo di segnalazione** e **controllo delle chiamate** delineato nella RFC 3435. Opera in un'architettura centralizzata, che √® composta da tre componenti principali:

1. **Call Agent o Media Gateway Controller (MGC)**: Il gateway principale nell'architettura MGCP √® responsabile della **gestione e del controllo dei media gateway**. Si occupa dei processi di configurazione, modifica e terminazione delle chiamate. Il MGC comunica con i media gateway utilizzando il protocollo MGCP.
2. **Media Gateways (MG) o Slave Gateways**: Questi dispositivi **convertire flussi di media digitali tra reti diverse**, come la telefonia tradizionale a commutazione di circuito e le reti IP a commutazione di pacchetto. Sono gestiti dal MGC ed eseguono i comandi ricevuti da esso. I media gateway possono includere funzioni come la trascodifica, la pacchettizzazione e la cancellazione dell'eco.
3. **Signaling Gateways (SG)**: Questi gateway sono responsabili della **conversione dei messaggi di segnalazione tra reti diverse**, consentendo una comunicazione senza soluzione di continuit√† tra sistemi di telefonia tradizionale (ad es. SS7) e reti basate su IP (ad es. SIP o H.323). I gateway di segnalazione sono cruciali per l'interoperabilit√† e per garantire che le informazioni di controllo delle chiamate siano comunicate correttamente tra le diverse reti.

In sintesi, MGCP centralizza la logica di controllo delle chiamate nell'agente di chiamata, semplificando la gestione dei media e dei gateway di segnalazione, fornendo una migliore scalabilit√†, affidabilit√† ed efficienza nelle reti di telecomunicazioni.

### SCCP (Skinny Client Control Protocol)

Il Protocollo di Controllo Client Magro (SCCP) √® un **protocollo di segnalazione e controllo delle chiamate proprietario** di propriet√† di Cisco Systems. √à principalmente **utilizzato** per la comunicazione tra **Cisco Unified Communications Manager** (precedentemente noto come CallManager) e telefoni IP Cisco o altri endpoint vocali e video Cisco.

SCCP √® un protocollo leggero che semplifica la comunicazione tra il server di controllo delle chiamate e i dispositivi endpoint. √à chiamato "Skinny" a causa del suo design minimalista e dei requisiti di larghezza di banda ridotti rispetto ad altri protocolli VoIP come H.323 o SIP.

I principali componenti di un sistema basato su SCCP sono:

1. **Server di Controllo delle Chiamate**: Questo server, tipicamente un Cisco Unified Communications Manager, gestisce i processi di configurazione, modifica e terminazione delle chiamate, nonch√© altre funzionalit√† telefoniche come il trasferimento di chiamata, il trasferimento di chiamata e il mantenimento della chiamata.
2. **Endpoint SCCP**: Si tratta di dispositivi come telefoni IP, unit√† di videoconferenza o altri endpoint vocali e video Cisco che utilizzano SCCP per comunicare con il server di controllo delle chiamate. Si registrano presso il server, inviano e ricevono messaggi di segnalazione e seguono le istruzioni fornite dal server di controllo delle chiamate per la gestione delle chiamate.
3. **Gateway**: Questi dispositivi, come i gateway vocali o i gateway multimediali, sono responsabili della conversione dei flussi multimediali tra reti diverse, come la telefonia tradizionale a commutazione di circuito e le reti IP a commutazione di pacchetto. Possono includere anche funzionalit√† aggiuntive, come la trascodifica o la cancellazione dell'eco.

SCCP offre un metodo di comunicazione semplice ed efficiente tra i server di controllo delle chiamate Cisco e i dispositivi endpoint. Tuttavia, √® importante notare che **SCCP √® un protocollo proprietario**, il che pu√≤ limitare l'interoperabilit√† con sistemi non Cisco. In tali casi, altri protocolli VoIP standard come SIP potrebbero essere pi√π adatti.

### H.323

H.323 √® una **suite di protocolli** per la comunicazione multimediale, inclusa la voce, la videochiamata e la videoconferenza su reti a commutazione di pacchetto, come le reti basate su IP. √à stato sviluppato dall'**Unione Internazionale delle Telecomunicazioni** (ITU-T) e fornisce un quadro completo per la gestione delle sessioni di comunicazione multimediale.

Alcuni componenti chiave della suite H.323 includono:

1. **Terminali**: Si tratta di dispositivi endpoint, come telefoni IP, sistemi di videoconferenza o applicazioni software, che supportano H.323 e possono partecipare a sessioni di comunicazione multimediale.
2. **Gateway**: Questi dispositivi convertire flussi multimediali tra reti diverse, come la telefonia tradizionale a commutazione di circuito e le reti IP a commutazione di pacchetto, consentendo l'interoperabilit√† tra H.323 e altri sistemi di comunicazione. Possono includere anche funzionalit√† aggiuntive, come la trascodifica o la cancellazione dell'eco.
3. **Gatekeeper**: Si tratta di componenti opzionali che forniscono servizi di controllo e gestione delle chiamate in una rete H.323. Svolgono funzioni come la traduzione degli indirizzi, la gestione della larghezza di banda e il controllo di ammissione, aiutando a gestire e ottimizzare le risorse di rete.
4. **Unit√† di Controllo Multipunto (MCU)**: Questi dispositivi facilitano le conferenze multipunto gestendo e mescolando flussi multimediali da pi√π endpoint. Le MCU consentono funzionalit√† come il controllo del layout video, il commutatore attivato dalla voce e la presenza continua, consentendo di ospitare conferenze su larga scala con pi√π partecipanti.

H.323 supporta una serie di codec audio e video, nonch√© altri servizi supplementari come il trasferimento di chiamata, il trasferimento di chiamata, il mantenimento della chiamata e l'attesa della chiamata. Nonostante la sua diffusa adozione nei primi giorni della VoIP, H.323 √® stato gradualmente sostituito da protocolli pi√π moderni e flessibili come il **Session Initiation Protocol (SIP)**, che offre una migliore interoperabilit√† e una pi√π facile implementazione. Tuttavia, H.323 continua ad essere utilizzato in molti sistemi legacy e continua a essere supportato da vari fornitori di apparecchiature.

### IAX (Inter Asterisk eXchange)

IAX (Inter-Asterisk eXchange) √® un **protocollo di segnalazione e controllo delle chiamate** utilizzato principalmente per la comunicazione tra server Asterisk PBX (Private Branch Exchange) e altri dispositivi VoIP. √à stato sviluppato da Mark Spencer, il creatore del software open-source Asterisk PBX, come alternativa ad altri protocolli VoIP come SIP e H.323.

IAX √® noto per la sua **semplicit√†, efficienza e facilit√† di implementazione**. Alcune caratteristiche chiave di IAX includono:

1. **Porta UDP singola**: IAX utilizza una singola porta UDP (4569) per il traffico di segnalazione e media, semplificando il firewall e il NAT traversal, rendendolo pi√π facile da implementare in vari ambienti di rete.
2. **Protocollo binario**: A differenza dei protocolli basati su testo come SIP, IAX √® un protocollo binario, che riduce il consumo di larghezza di banda e lo rende pi√π efficiente per la trasmissione di dati di segnalazione e media.
3. **Trunking**: IAX supporta il trunking, che consente di combinare pi√π chiamate in una singola connessione di rete, riducendo il sovraccarico e migliorando l'utilizzo della larghezza di banda.
4. **Crittografia nativa**: IAX ha un supporto integrato per la crittografia, utilizzando metodi come RSA per lo scambio di chiavi e AES per la crittografia dei media, fornendo una comunicazione sicura tra gli endpoint.
5. **Comunicazione peer-to-peer**: IAX pu√≤ essere utilizzato per la comunicazione diretta tra endpoint senza la necessit√† di un server centrale, consentendo un routing delle chiamate pi√π semplice ed efficiente.

Nonostante i suoi vantaggi, IAX ha alcune limitazioni, come la sua focalizzazione principale sull'ecosistema Asterisk e una diffusione meno ampia rispetto a protocolli pi√π consolidati come SIP. Di conseguenza, IAX potrebbe non essere la scelta migliore per l'interoperabilit√† con sistemi o dispositivi non Asterisk. Tuttavia, per coloro che lavorano all'interno dell'ambiente Asterisk, IAX offre una soluzione robusta ed efficiente per la comunicazione VoIP.
## Protocolli di trasmissione e trasporto

### SDP (Session Description Protocol)

SDP (Session Description Protocol) √® un formato **basato su testo** utilizzato per descrivere le caratteristiche delle sessioni multimediali, come voce, video o conferenze dati, su reti IP. √à stato sviluppato dall'**Internet Engineering Task Force (IETF)** e √® definito in **RFC 4566**. SDP non gestisce effettivamente la trasmissione dei media o l'instaurazione della sessione, ma viene utilizzato insieme ad altri protocolli di segnalazione, come **SIP (Session Initiation Protocol)**, per negoziare e scambiare informazioni sui flussi multimediali e le loro caratteristiche.

Alcuni elementi chiave di SDP includono:

1. **Informazioni sulla sessione**: SDP descrive i dettagli di una sessione multimediale, inclusi il nome della sessione, la descrizione della sessione, l'ora di inizio e di fine.
2. **Flussi multimediali**: SDP definisce le caratteristiche dei flussi multimediali, come il tipo di media (audio, video o testo), il protocollo di trasporto (ad esempio, RTP o SRTP) e il formato del media (ad esempio, informazioni sul codec).
3. **Informazioni sulla connessione**: SDP fornisce informazioni sull'indirizzo di rete (indirizzo IP) e il numero di porta in cui i media devono essere inviati o ricevuti.
4. **Attributi**: SDP supporta l'uso di attributi per fornire informazioni aggiuntive, facoltative, su una sessione o un flusso multimediale. Gli attributi possono essere utilizzati per specificare varie funzionalit√† come chiavi di crittografia, requisiti di larghezza di banda o meccanismi di controllo dei media.

Di solito, SDP viene utilizzato nel seguente processo:

1. Una parte iniziatrice crea una descrizione SDP della sessione multimediale proposta, inclusi i dettagli dei flussi multimediali e le loro caratteristiche.
2. La descrizione SDP viene inviata alla parte ricevente, di solito incorporata in un messaggio di protocollo di segnalazione come SIP o RTSP.
3. La parte ricevente elabora la descrizione SDP e, in base alle sue capacit√†, pu√≤ accettare, rifiutare o modificare la sessione proposta.
4. La descrizione SDP finale viene inviata di nuovo alla parte iniziatrice come parte del messaggio di protocollo di segnalazione, completando il processo di negoziazione.

La semplicit√† e la flessibilit√† di SDP lo rendono uno standard ampiamente adottato per descrivere sessioni multimediali in vari sistemi di comunicazione, svolgendo un ruolo cruciale nell'instaurare e gestire sessioni multimediali in tempo reale su reti IP.

### RTP / RTCP / SRTP / ZRTP

1. **RTP (Real-time Transport Protocol)**: RTP √® un protocollo di rete progettato per la consegna di dati audio e video, o di altri media in tempo reale, su reti IP. Sviluppato dall'**IETF** e definito in **RFC 3550**, RTP √® comunemente utilizzato con protocolli di segnalazione come SIP e H.323 per abilitare la comunicazione multimediale. RTP fornisce meccanismi per la **sincronizzazione**, la **sequenzializzazione** e il **timestamping** dei flussi multimediali, contribuendo a garantire una riproduzione media fluida e tempestiva.
2. **RTCP (Real-time Transport Control Protocol)**: RTCP √® un protocollo complementare a RTP, utilizzato per monitorare la qualit√† del servizio (QoS) e fornire feedback sulla trasmissione dei flussi multimediali. Definito nello stesso **RFC 3550** di RTP, RTCP **scambia periodicamente pacchetti di controllo tra i partecipanti a una sessione RTP**. Condivide informazioni come perdita di pacchetti, jitter e tempo di andata e ritorno, che aiutano a diagnosticare e adattarsi alle condizioni di rete, migliorando la qualit√† complessiva dei media.
3. **SRTP (Secure Real-time Transport Protocol)**: SRTP √® un'estensione di RTP che fornisce **crittografia**, **autenticazione dei messaggi** e **protezione dal replay** per i flussi multimediali, garantendo la trasmissione sicura di dati audio e video sensibili. Definito in **RFC 3711**, SRTP utilizza algoritmi crittografici come AES per la crittografia e HMAC-SHA1 per l'autenticazione dei messaggi. SRTP √® spesso utilizzato in combinazione con protocolli di segnalazione sicuri come SIP su TLS per fornire sicurezza end-to-end nella comunicazione multimediale.
4. **ZRTP (Zimmermann Real-time Transport Protocol)**: ZRTP √® un protocollo di accordo chiave crittografico che fornisce **crittografia end-to-end** per i flussi multimediali RTP. Sviluppato da Phil Zimmermann, il creatore di PGP, ZRTP √® descritto in **RFC 6189**. A differenza di SRTP, che si basa su protocolli di segnalazione per lo scambio di chiavi, ZRTP √® progettato per funzionare indipendentemente dal protocollo di segnalazione. Utilizza lo **scambio di chiavi Diffie-Hellman** per stabilire un segreto condiviso tra le parti che comunicano, senza richiedere fiducia preventiva o un'infrastruttura a chiave pubblica (PKI). ZRTP include anche funzionalit√† come **Short Authentication Strings (SAS)** per proteggersi dagli attacchi man-in-the-middle.

Questi protocolli svolgono ruoli essenziali nella **consegna e sicurezza della comunicazione multimediale in tempo reale su reti IP**. Mentre RTP e RTCP gestiscono effettivamente la trasmissione dei media e il monitoraggio della qualit√†, SRTP e ZRTP garantiscono che i media trasmessi siano protetti da intercettazioni, manipolazioni e attacchi di replay.
