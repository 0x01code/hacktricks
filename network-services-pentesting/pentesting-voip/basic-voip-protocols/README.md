# 基本的なVoIPプロトコル

<details>

<summary><strong>htARTE（HackTricks AWS Red Team Expert）</strong>を通じて、ゼロからヒーローまでAWSハッキングを学びましょう！</summary>

HackTricksをサポートする他の方法：

- **HackTricksで企業を宣伝したい**、または**HackTricksをPDFでダウンロードしたい**場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
- [**公式PEASS＆HackTricksスワッグ**](https://peass.creator-spring.com)を入手する
- [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)コレクションを見つける
- **💬 [Discordグループ](https://discord.gg/hRep4RUj7f)**に参加するか、[Telegramグループ](https://t.me/peass)に参加するか、**Twitter**で**@carlospolopm**をフォローする🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
- **ハッキングトリックを共有するために、[HackTricks](https://github.com/carlospolop/hacktricks)と[HackTricks Cloud](https://github.com/carlospolop/hacktricks-cloud)のGitHubリポジトリにPRを提出する**

</details>

## WhiteIntel

<figure><img src=".gitbook/assets/image (1224).png" alt=""><figcaption></figcaption></figure>

[**WhiteIntel**](https://whiteintel.io)は、**ダークウェブ**を活用した検索エンジンで、企業やその顧客が**盗聴マルウェア**によって**侵害**されていないかをチェックするための**無料**機能を提供しています。

WhiteIntelの主な目標は、情報窃取マルウェアによるアカウント乗っ取りやランサムウェア攻撃と戦うことです。

彼らのウェブサイトをチェックして、**無料**でエンジンを試すことができます：

{% embed url="https://whiteintel.io" %}

---

## シグナリングプロトコル

### SIP（Session Initiation Protocol）

これは業界標準であり、詳細については次を参照してください：

{% content-ref url="sip-session-initiation-protocol.md" %}
[sip-session-initiation-protocol.md](sip-session-initiation-protocol.md)
{% endcontent-ref %}

### MGCP（Media Gateway Control Protocol）

MGCP（Media Gateway Control Protocol）は、RFC 3435で概説された**シグナリング**および**コール** **コントロールプロトコル**です。これは、3つの主要なコンポーネントで構成される中央集権型アーキテクチャで動作します。

1. **コールエージェントまたはメディアゲートウェイコントローラ（MGC）**：MGCPアーキテクチャのマスターゲートウェイは、**メディアゲートウェイの管理と制御**を担当します。通話のセットアップ、変更、終了プロセスを処理します。MGCはMGCPプロトコルを使用してメディアゲートウェイと通信します。
2. **メディアゲートウェイ（MG）またはスレーブゲートウェイ**：これらのデバイスは、異なるネットワーク間でデジタルメディアストリームを変換します。例えば、従来の回線交換電話網とパケット交換IPネットワークです。これらはMGCによって管理され、それから受け取ったコマンドを実行します。メディアゲートウェイには、トランスコーディング、パケット化、エコーキャンセルなどの機能が含まれる場合があります。
3. **シグナリングゲートウェイ（SG）**：これらのゲートウェイは、異なるネットワーク間でシグナリングメッセージを変換し、従来の電話システム（例：SS7）とIPベースのネットワーク（例：SIPまたはH.323）間でシームレスな通信を可能にします。シグナリングゲートウェイは相互運用性を確保し、異なるネットワーク間で通話制御情報が適切に伝達されることを確認するために重要です。

要するに、MGCPは通話制御ロジックをコールエージェントに集約し、メディアおよびシグナリングゲートウェイの管理を簡素化し、通信ネットワークでのスケーラビリティ、信頼性、効率性を向上させます。

### SCCP（Skinny Client Control Protocol）

Skinny Client Control Protocol（SCCP）は、Cisco Systemsが所有する**プロプライエタリなシグナリングおよびコールコントロールプロトコル**です。これは主に**Cisco Unified Communications Manager**（以前はCallManagerとして知られていました）とCisco IP電話や他のCisco音声およびビデオエンドポイント間の通信に使用されます。

SCCPは、通話制御サーバーとエンドポイントデバイス間の通信を簡素化する軽量プロトコルです。その名前が「Skinny」であるのは、そのミニマリスティックなデザインと、他のVoIPプロトコル（H.323やSIPなど）と比較して帯域幅要件が少ないためです。

SCCPベースのシステムの主要なコンポーネントは次のとおりです：

1. **コールコントロールサーバー**：通常はCisco Unified Communications Managerで、通話のセットアップ、変更、終了プロセス、通話転送、通話保留などの他の電話機能を管理します。
2. **SCCPエンドポイント**：これらは、SCCPを使用して通話制御サーバーと通信するIP電話、ビデオ会議ユニット、または他のCisco音声およびビデオエンドポイントなどのデバイスです。これらはサーバーに登録し、シグナリングメッセージを送受信し、通話処理のためにコールコントロールサーバーからの指示に従います。
3. **ゲートウェイ**：これらのデバイスは、従来の回線交換電話網とパケット交換IPネットワーク間でメディアストリームを変換する責任があります。トランスコーディングやエコーキャンセルなどの追加機能も含まれる場合があります。

SCCPは、Ciscoのコールコントロールサーバーとエンドポイントデバイス間の簡単で効率的な通信方法を提供します。ただし、SCCPは**プロプライエタリプロトコル**であるため、非Ciscoシステムとの相互運用性が制限される可能性があります。そのような場合には、SIPなどの他の標準VoIPプロトコルの方が適している場合があります。

### H.323

H.323は、IPベースのネットワークなどのパケット交換ネットワークを介した音声、ビデオ、データ会議を含むマルチメディア通信のための**プロトコルスイート**です。国際電気通信連合（ITU-T）によって開発され、マルチメディア通信セッションを管理する包括的なフレームワークを提供します。

H.323スイートの主要なコンポーネントには次のものがあります：

1. **端末**：IP電話、ビデオ会議システム、ソフトウェアアプリケーションなど、H.323をサポートし、マルチメディア通信セッションに参加できるエンドポイントデバイスです。
2. **ゲートウェイ**：これらのデバイスは、従来の回線交換電話網とパケット交換IPネットワーク間でメディアストリームを変換し、H.323と他の通信システムとの間で相互運用性を実現します。トランスコーディングやエコーキャンセルなどの追加機能も含まれる場合があります。
3. **ゲートキーパー**：これらはH.323ネットワークで通話制御および管理サービスを提供するオプションのコンポーネントです。アドレス変換、帯域幅管理、アドミッション制御などの機能を実行し、ネットワークリソースを管理および最適化するのに役立ちます。
4. **マルチポイントコントロールユニット（MCU）**：これらのデバイスは、複数のエンドポイントからのメディアストリームを管理およびミックスすることで、マルチポイント会議を容易にします。MCUは、ビデオレイアウト制御、音声アクティブスイッチング、連続プレゼンスなどの機能を可能にし、複数の参加者を持つ大規模な会議を開催できるようにします。

H.323は、音声およびビデオコーデック、通話転送、通話転送、通話保留、通話待ちなどの他の補助サービスをサポートしています。VoIPの初期に広く採用されていましたが、H.323はより現代的で柔軟なプロトコルである**Session Initiation Protocol (SIP)**に徐々に置き換えられており、より良い相互運用性と簡単な実装を提供しています。ただし、H.323は多くのレガシーシステムで使用され続けており、さまざまな機器ベンダーによってサポートされています。

### IAX（Inter Asterisk eXchange）

IAX（Inter-Asterisk eXchange）は、Asterisk PBX（プライベートブランチ交換）サーバーと他のVoIPデバイス間の通信に主に使用される**シグナリングおよびコールコントロールプロトコル**です。AsteriskオープンソースPBXソフトウェアの作成者であるMark Spencerによって、SIPやH.323などの他のVoIPプロトコルに代わるものとして開発されました。

IAXは**シンプルさ、効率性、実装の容易さ**で知られています。IAXの主な特徴には次のものがあります：

1. **単一のUDPポート**：IAXは、シグナリングとメディアトラフィックの両方に単一のUDPポート（4569）を使用するため、ファイアウォールとNATトラバーサルを簡素化し、さまざまなネットワーク環境での展開を容易にします。
2. **バイナリプロトコル**：SIPなどのテキストベースのプロトコルとは異なり、IAXはバイナリプロトコルであり、帯域幅の消費を削減し、シグナリングおよびメディアデータの送信により効率的にします。
3. **トランキング**：IAXはトランキングをサポートし、複数の通話を単一のネットワーク接続に組み合わせることで、オーバーヘッドを削減し、帯域幅の利用を向上させます。
4. **ネイティブ暗号化**：IAXには、RSAなどの鍵交換およびAESなどのメディア暗号化に使用される暗号化の組み込みサポートがあり、エンドポイント間の安全な通信を提供します。
5. **ピアツーピア通信**：IAXは、中央サーバーなしでエンドポイント間の直接通信に使用でき、よりシンプルで効率的な通話ルーティングを実現します。

利点がある一方で、IAXにはAsteriskエコシステムへの主な焦点や、SIPなどのより確立されたプロトコルと比較しての普及度の低さなどの制限があります。その結果、IAXは非Asteriskシステムやデバイスとの相互運用性にとって最適な選択肢ではないかもしれません。ただし、Asterisk環境内で作業している場合、IAXはVoIP通信のための堅牢で効率的なソリューションを提供します。
## 伝送と輸送プロトコル

### SDP（Session Description Protocol）

SDP（Session Description Protocol）は、IPネットワーク上での音声、ビデオ、またはデータ会議などのマルチメディアセッションの特性を記述するために使用される**テキストベースの形式**です。**インターネットエンジニアリングタスクフォース（IETF）**によって開発され、**RFC 4566**で定義されています。SDPは実際のメディア伝送やセッション確立を処理しませんが、**SIP（Session Initiation Protocol）**などの他のシグナリングプロトコルと共に使用され、メディアストリームとその属性に関する情報を交渉および交換するために使用されます。

SDPの主要な要素には次のものがあります：

1. **セッション情報**：SDPは、セッション名、セッションの説明、開始時間、終了時間など、マルチメディアセッションの詳細を記述します。
2. **メディアストリーム**：SDPは、メディアタイプ（オーディオ、ビデオ、またはテキスト）、輸送プロトコル（例：RTPまたはSRTP）、およびメディアフォーマット（コーデック情報など）など、メディアストリームの特性を定義します。
3. **接続情報**：SDPは、メディアを送信または受信するためのネットワークアドレス（IPアドレス）とポート番号に関する情報を提供します。
4. **属性**：SDPは、セッションやメディアストリームに関する追加のオプション情報を提供するために属性の使用をサポートします。属性は、暗号化キー、帯域幅要件、またはメディア制御メカニズムなど、さまざまな機能を指定するために使用できます。

SDPは通常、次のプロセスで使用されます：

1. 開始する側が、提案されたマルチメディアセッションのSDP説明を作成します。これには、メディアストリームとその属性の詳細が含まれます。
2. SDP説明が受信側に送信され、通常はSIPやRTSPなどのシグナリングプロトコルメッセージに埋め込まれます。
3. 受信側はSDP説明を処理し、その機能に基づいて、提案されたセッションを受け入れたり、拒否したり、変更したりすることがあります。
4. 最終的なSDP説明が、シグナリングプロトコルメッセージの一部として開始する側に送信され、交渉プロセスが完了します。

SDPのシンプルさと柔軟性により、さまざまな通信システムでマルチメディアセッションを記述するための広く採用された標準となっており、IPネットワーク上でのリアルタイムマルチメディアセッションの確立と管理において重要な役割を果たしています。

### RTP / RTCP / SRTP / ZRTP

1. **RTP（Real-time Transport Protocol）**：RTPは、オーディオやビデオデータなどのリアルタイムメディアをIPネットワーク上で配信するために設計されたネットワークプロトコルです。**IETF**によって開発され、**RFC 3550**で定義されています。RTPは、**シンクロナイゼーション**、**シーケンス化**、および**タイムスタンプ**のメカニズムを提供し、メディアストリームのスムーズでタイムリーな再生を確保します。
2. **RTCP（Real-time Transport Control Protocol）**：RTCPは、RTPの補助プロトコルであり、メディアストリームの品質監視を行い、その伝送に関するフィードバックを提供するために使用されます。RTPと同じ**RFC 3550**で定義されており、RTCPは**RTPセッションの参加者間で定期的に制御パケットを交換**します。パケット損失、ジッター、ラウンドトリップタイムなどの情報を共有し、ネットワークの状況を診断し適応することで、全体的なメディア品質を向上させます。
3. **SRTP（Secure Real-time Transport Protocol）**：SRTPは、メディアストリームの**暗号化**、**メッセージ認証**、および**リプレイ保護**を提供するRTPの拡張機能であり、機密性の高いオーディオやビデオデータの安全な伝送を確保します。**RFC 3711**で定義されており、SRTPは暗号化にAESなどの暗号アルゴリズム、メッセージ認証にHMAC-SHA1などの暗号アルゴリズムを使用します。SRTPは、多くの場合、SIP over TLSなどのセキュアなシグナリングプロトコルと組み合わせて使用され、マルチメディア通信におけるエンドツーエンドのセキュリティを提供します。
4. **ZRTP（Zimmermann Real-time Transport Protocol）**：ZRTPは、RTPメディアストリームの**エンドツーエンドの暗号化**を提供する暗号鍵合意プロトコルです。PGPの作成者であるPhil Zimmermannによって開発され、**RFC 6189**で説明されています。シグナリングプロトコルに依存するSRTPとは異なり、ZRTPはシグナリングプロトコルとは独立して動作するように設計されています。通信する各当事者の間で共有秘密を確立するために**Diffie-Hellman鍵交換**を使用し、事前の信頼や公開鍵インフラストラクチャ（PKI）を必要とせずに動作します。ZRTPには、**中間者攻撃に対する保護**として**Short Authentication Strings（SAS）**などの機能も含まれています。

これらのプロトコルは、IPネットワーク上での**リアルタイムマルチメディア通信の提供と保護**において重要な役割を果たします。RTPとRTCPは実際のメディア伝送と品質監視を担当し、SRTPとZRTPは、伝送されるメディアが盗聴、改ざん、およびリプレイ攻撃から保護されることを確保します。
