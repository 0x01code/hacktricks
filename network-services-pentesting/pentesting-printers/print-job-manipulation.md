<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks Cloud ☁️</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>🐦 Twitter 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 Youtube 🎥</strong></a></summary>

- Você trabalha em uma **empresa de segurança cibernética**? Você quer ver sua **empresa anunciada no HackTricks**? ou você quer ter acesso à **última versão do PEASS ou baixar o HackTricks em PDF**? Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!

- Descubra [**A Família PEASS**](https://opensea.io/collection/the-peass-family), nossa coleção exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)

- Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)

- **Junte-se ao** [**💬**](https://emojipedia.org/speech-balloon/) [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**

- **Compartilhe suas técnicas de hacking enviando PRs para o [repositório hacktricks](https://github.com/carlospolop/hacktricks) e [hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)**.

</details>


# Conteúdo Overlay

Uma maneira simples de manipular a aparência de impressões é **usar overlays**. \
[**PCL**](./#pcl) tem uma função documentada para colocar **macros de overlay** em cima de um documento. Infelizmente, esse recurso é **limitado ao trabalho de impressão atual** e não pode ser tornar permanente. \
[**PostScript**](./#postscript-ps) não oferece tal funcionalidade por padrão, no entanto, pode ser programado para **redefinir o operador showpage** que está contido em cada documento PostScript para imprimir a página atual. O atacante pode **inserir seu código** lá, executá-lo e depois chamar a versão original do operador.\
Portanto, ela pode sobrepor todas as páginas a serem impressas com um arquivo EPS personalizado. Esse hack pode ser usado para **adicionar gráficos ou fontes arbitrários a cópias impressas de um documento** (é possível alterar completamente a aparência de um documento sobrepondo uma página em branco e depois adicionando conteúdo personalizado).\
Obviamente, tal abordagem só pode ser bem-sucedida se o PostScript for usado como driver de impressora e nenhum `StartJobPassword` estiver definido.

![](http://hacking-printers.net/wiki/images/thumb/9/93/Overlay.jpg/300px-Overlay.jpg)

**Como testar esse ataque?**

Use os comandos `cross` ou `overlay` do [**PRET**](https://github.com/RUB-NDS/PRET) no modo ps, desconecte e imprima um documento arbitrário:
```
./pret.py -q printer ps
Connection to printer established

Welcome to the pret shell. Type help or ? to list commands.
printer:/> overlay overlays/smiley.eps
printer:/> cross whoa "HACKED"
printer:/> exit
```
# Substituição de Conteúdo

Mesmo que um invasor possa colocar uma sobreposição acima de documentos existentes, ela não poderá **alterar valores específicos** no documento original, a menos que sua estrutura exata seja conhecida. Às vezes, não se quer apenas adicionar conteúdo personalizado, mas **analisar e substituir partes** do documento existente. \
O problema de substituir texto em arquivos PostScript pode ser reduzido ao **problema de extrair strings** do documento renderizado. Isso não é trivial, porque as strings podem ser construídas dinamicamente pelo próprio programa PostScript. Portanto, a análise e substituição simples dentro do código-fonte do documento não é uma opção.\
Você pode usar um **operador `show` redefinido**. O operador show aceita uma string como entrada, que é pintada em uma determinada localização da página atual. Ao redefinir o operador, o **texto** pode ser **extraído** de forma elegante. Essa abordagem também pode ser usada para **pesquisar e substituir** strings imediatamente **antes** de serem **pintadas**. \
A abordagem é **bem-sucedida** para documentos PostScript baseados em **LaTeX** que são enviados diretamente para a impressora, enquanto **falha** para arquivos PostScript gerados pelo **GIMP**, que em vez de strings **cria gráficos raster** de sua representação. O mesmo problema ocorre para qualquer formato de documento - até mesmo o próprio PostScript - quando processado pelo CUPS. Teoricamente, tais construções de linguagem também poderiam ser analisadas e devem ser objeto de pesquisas adicionais.

**Como testar esse ataque?**

Use o comando `replace` do [**PRET**](https://github.com/RUB-NDS/PRET) no modo ps, desconecte e imprima um documento PostScript contendo 'DEF':
```
./pret.py -q printer ps
Connection to printer established

Welcome to the pret shell. Type help or ? to list commands.
printer:/> replace "ABC" "DEF"
printer:/> exit
```
<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks Cloud ☁️</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>🐦 Twitter 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 Youtube 🎥</strong></a></summary>

- Você trabalha em uma **empresa de segurança cibernética**? Você quer ver sua **empresa anunciada no HackTricks**? ou você quer ter acesso à **última versão do PEASS ou baixar o HackTricks em PDF**? Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!

- Descubra [**A Família PEASS**](https://opensea.io/collection/the-peass-family), nossa coleção exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)

- Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)

- **Junte-se ao** [**💬**](https://emojipedia.org/speech-balloon/) [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**

- **Compartilhe seus truques de hacking enviando PRs para o [repositório hacktricks](https://github.com/carlospolop/hacktricks) e [hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)**.

</details>
