# 27017,27018 - Pentesting MongoDB

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Travaillez-vous dans une **entreprise de cybers√©curit√©** ? Voulez-vous voir votre **entreprise annonc√©e dans HackTricks** ? Ou voulez-vous avoir acc√®s √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFT**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**üí¨**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR au** [**repo hacktricks**](https://github.com/carlospolop/hacktricks) **et au** [**repo hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

Rejoignez le serveur [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) pour communiquer avec des hackers exp√©riment√©s et des chasseurs de primes !

**Perspectives de piratage**\
Engagez-vous avec du contenu qui explore les sensations et les d√©fis du piratage

**Actualit√©s de piratage en temps r√©el**\
Restez √† jour avec le monde du piratage rapide gr√¢ce aux actualit√©s et aux informations en temps r√©el

**Derni√®res annonces**\
Restez inform√© des derni√®res primes de bugs lanc√©es et des mises √† jour cruciales de la plateforme

**Rejoignez-nous sur** [**Discord**](https://discord.com/invite/N3FrSbmwdy) et commencez √† collaborer avec les meilleurs hackers d√®s aujourd'hui !

## Informations de base

MongoDB est un syst√®me de gestion de base de donn√©es (SGBD) [open source](https://whatis.techtarget.com/definition/open-source) qui utilise un mod√®le de base de donn√©es orient√© documents et prend en charge diverses formes de donn√©es. (De [ici](https://searchdatamanagement.techtarget.com/definition/MongoDB))

**Port par d√©faut :** 27017, 27018
```
PORT      STATE SERVICE VERSION
27017/tcp open  mongodb MongoDB 2.6.9 2.6.9
```
## √ânum√©ration

### Manuelle

L'√©num√©ration manuelle consiste √† recueillir des informations sur le service MongoDB en utilisant des m√©thodes manuelles. Voici quelques √©tapes √† suivre pour effectuer cette √©num√©ration :

1. **Recherche de l'adresse IP** : Utilisez des outils tels que `ping` ou `nslookup` pour trouver l'adresse IP du serveur MongoDB cible.

2. **V√©rification des ports** : Utilisez un scanner de ports, comme `nmap`, pour v√©rifier les ports 27017 et 27018 sur l'adresse IP cible. Ces ports sont g√©n√©ralement utilis√©s par MongoDB.

3. **Connexion √† MongoDB** : Utilisez l'outil `mongo` pour vous connecter au serveur MongoDB en sp√©cifiant l'adresse IP et le port. Par exemple : `mongo <adresse IP>:<port>`.

4. **Interrogation de la base de donn√©es** : Une fois connect√©, vous pouvez interroger la base de donn√©es pour obtenir des informations sur les collections, les documents et les utilisateurs. Utilisez des commandes telles que `show dbs`, `use <nom de la base de donn√©es>`, `show collections`, `db.<nom de la collection>.find()`, etc.

5. **Analyse des erreurs** : Lors de l'interrogation de la base de donn√©es, recherchez des erreurs ou des messages d'erreur qui pourraient r√©v√©ler des informations sensibles ou des vuln√©rabilit√©s.

6. **Collecte d'informations suppl√©mentaires** : Utilisez d'autres commandes MongoDB pour collecter des informations suppl√©mentaires, telles que `db.stats()`, `db.getUsers()`, `db.runCommand({whatsmyuri: 1})`, etc.

7. **Analyse des r√©sultats** : Analysez les r√©sultats de vos requ√™tes pour identifier des informations sensibles, des vuln√©rabilit√©s ou des configurations incorrectes.

8. **Documentation** : Consultez la documentation officielle de MongoDB pour en savoir plus sur les commandes et les fonctionnalit√©s sp√©cifiques.

La m√©thode d'√©num√©ration manuelle peut √™tre lente et n√©cessite une connaissance approfondie de MongoDB, mais elle permet de collecter des informations pr√©cises et de comprendre en d√©tail la configuration du service.
```python
from pymongo import MongoClient
client = MongoClient(host, port, username=username, password=password)
client.server_info() #Basic info
#If you have admin access you can obtain more info
admin = client.admin
admin_info = admin.command("serverStatus")
cursor = client.list_databases()
for db in cursor:
print(db)
print(client[db["name"]].list_collection_names())
#If admin access, you could dump the database also
```
**Quelques commandes MongoDB :**

```bash
# Start MongoDB service
sudo service mongod start

# Stop MongoDB service
sudo service mongod stop

# Restart MongoDB service
sudo service mongod restart

# Check MongoDB service status
sudo service mongod status

# Connect to MongoDB shell
mongo

# Show all databases
show dbs

# Switch to a specific database
use <database_name>

# Show all collections in the current database
show collections

# Insert a document into a collection
db.<collection_name>.insertOne({<document>})

# Find all documents in a collection
db.<collection_name>.find()

# Find documents that match a specific condition
db.<collection_name>.find({<condition>})

# Update documents in a collection
db.<collection_name>.updateOne({<filter>}, {<update>})

# Delete documents from a collection
db.<collection_name>.deleteOne({<filter>})
```

For more information, refer to the [MongoDB documentation](https://docs.mongodb.com/).
```bash
show dbs
use <db>
show collections
db.<collection>.find()  #Dump the collection
db.<collection>.count() #Number of records of the collection
db.current.find({"username":"admin"})  #Find in current db the username admin
```
### Automatique

MongoDB provides an automatic mechanism for creating backups of the database. This feature is called "mongodump" and it allows you to create a binary dump of the entire database or specific collections. The "mongodump" command can be executed from the command line and it supports various options to customize the backup process.

To create a backup of the entire database, you can simply run the following command:

```
mongodump --host <hostname> --port <port> --out <output_directory>
```

Replace `<hostname>` with the hostname or IP address of the MongoDB server, `<port>` with the port number on which MongoDB is running, and `<output_directory>` with the directory where you want to store the backup.

If you only want to backup specific collections, you can use the `--collection` option followed by the names of the collections you want to backup. For example:

```
mongodump --host <hostname> --port <port> --db <database_name> --collection <collection_name> --out <output_directory>
```

Replace `<database_name>` with the name of the database containing the collections you want to backup, and `<collection_name>` with the names of the collections you want to backup.

By default, "mongodump" creates a binary dump of the database in BSON format. If you want to create a human-readable JSON dump instead, you can use the `--json` option.

Once you have created a backup, you can restore it using the "mongorestore" command. This command allows you to restore a binary dump created by "mongodump" back into a MongoDB database.

To restore a backup, you can run the following command:

```
mongorestore --host <hostname> --port <port> --dir <backup_directory>
```

Replace `<hostname>` with the hostname or IP address of the MongoDB server, `<port>` with the port number on which MongoDB is running, and `<backup_directory>` with the directory where the backup files are located.

Note that the "mongorestore" command will overwrite any existing data in the database with the data from the backup. If you want to keep the existing data and only restore specific collections, you can use the `--collection` option followed by the names of the collections you want to restore.

MongoDB also provides a built-in mechanism for creating automated backups using the "mongodump" command. You can schedule regular backups by creating a cron job or using a task scheduler on your operating system. This ensures that your data is regularly backed up without manual intervention.
```bash
nmap -sV --script "mongo* and default" -p 27017 <IP> #By default all the nmap mongo enumerate scripts are used
```
### Shodan

* Tous les mongodb : `"informations sur le serveur mongodb"`
* Rechercher les serveurs mongodb enti√®rement ouverts : `"informations sur le serveur mongodb" -"partiellement activ√©"`
* Activer partiellement l'authentification uniquement : `"informations sur le serveur mongodb" "partiellement activ√©"`

## Connexion

Par d√©faut, mongo n'exige pas de mot de passe.\
**Admin** est une base de donn√©es mongo courante.
```bash
mongo <HOST>
mongo <HOST>:<PORT>
mongo <HOST>:<PORT>/<DB>
mongo <database> -u <username> -p '<password>'
```
Le script nmap : _**mongodb-brute**_ v√©rifiera si des identifiants sont n√©cessaires.
```bash
nmap -n -sV --script mongodb-brute -p 27017 <ip>
```
### [**Brute force**](../generic-methodologies-and-resources/brute-force.md#mongo)

Regardez √† l'int√©rieur de _/opt/bitnami/mongodb/mongodb.conf_ pour savoir si des identifiants sont n√©cessaires :
```bash
grep "noauth.*true" /opt/bitnami/mongodb/mongodb.conf | grep -v "^#" #Not needed
grep "auth.*true" /opt/bitnami/mongodb/mongodb.conf | grep -v "^#\|noauth" #Not needed
```
## Pr√©diction d'Object ID Mongo

Les Object IDs Mongo sont des cha√Ænes hexad√©cimales de **12 octets** :

![](../.gitbook/assets/id-and-objectids-in-mongodb.png)

Par exemple, voici comment nous pouvons diss√©quer un Object ID r√©el renvoy√© par une application : 5f2459ac9fa6dc2500314019

1. 5f2459ac : 1596217772 en d√©cimal = vendredi 31 juillet 2020 17:49:32
2. 9fa6dc : Identifiant de machine
3. 2500 : Identifiant de processus
4. 314019 : Un compteur incr√©mental

Parmi les √©l√©ments ci-dessus, l'identifiant de machine restera le m√™me tant que la base de donn√©es ex√©cutera la m√™me machine physique/virtuelle. L'identifiant de processus ne changera que si le processus MongoDB est red√©marr√©. Le timestamp sera mis √† jour chaque seconde. Le seul d√©fi pour deviner les Object IDs en incr√©mentant simplement les valeurs du compteur et du timestamp est le fait que Mongo DB g√©n√®re les Object IDs et attribue les Object IDs au niveau du syst√®me.

L'outil [https://github.com/andresriancho/mongo-objectid-predict](https://github.com/andresriancho/mongo-objectid-predict), √©tant donn√© un Object ID de d√©part (vous pouvez cr√©er un compte et obtenir un ID de d√©part), renvoie environ 1000 Object IDs probables qui auraient pu √™tre attribu√©s aux objets suivants, il vous suffit donc de les bruteforcer.

## Post

Si vous √™tes root, vous pouvez **modifier** le fichier **mongodb.conf** afin de ne pas avoir besoin d'informations d'identification (_noauth = true_) et de **vous connecter sans informations d'identification**.

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

Rejoignez le serveur [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) pour communiquer avec des hackers exp√©riment√©s et des chasseurs de primes en s√©curit√© !

**Perspectives de piratage**\
Engagez-vous avec du contenu qui explore les frissons et les d√©fis du piratage

**Actualit√©s de piratage en temps r√©el**\
Restez √† jour avec le monde du piratage rapide gr√¢ce √† des actualit√©s et des informations en temps r√©el

**Derni√®res annonces**\
Restez inform√© des nouvelles primes de bugs en cours de lancement et des mises √† jour cruciales de la plateforme

**Rejoignez-nous sur** [**Discord**](https://discord.com/invite/N3FrSbmwdy) et commencez √† collaborer avec les meilleurs hackers d√®s aujourd'hui !

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Vous travaillez dans une **entreprise de cybers√©curit√©** ? Vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ? ou souhaitez-vous avoir acc√®s √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**üí¨**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PRs** au [**repo hacktricks**](https://github.com/carlospolop/hacktricks) **et au** [**repo hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
