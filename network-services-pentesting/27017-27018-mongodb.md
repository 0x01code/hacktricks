# 27017,27018 - Pentesting MongoDB

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Travaillez-vous dans une **entreprise de cybers√©curit√©** ? Voulez-vous voir votre **entreprise annonc√©e dans HackTricks** ? Ou voulez-vous avoir acc√®s √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFT**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**üí¨**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR au** [**repo hacktricks**](https://github.com/carlospolop/hacktricks) **et au** [**repo hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

<figure><img src="../.gitbook/assets/image (1) (3).png" alt=""><figcaption></figcaption></figure>

**HackenProof est la plateforme des primes de bugs cryptographiques.**

**Obtenez des r√©compenses sans d√©lai**\
Les primes HackenProof sont lanc√©es uniquement lorsque les clients d√©posent le budget de r√©compense. Vous recevrez la r√©compense apr√®s la v√©rification du bug.

**Acqu√©rez de l'exp√©rience en pentesting web3**\
Les protocoles blockchain et les contrats intelligents sont le nouvel Internet ! Ma√Ætrisez la s√©curit√© web3 d√®s ses d√©buts.

**Devenez la l√©gende du hacker web3**\
Gagnez des points de r√©putation avec chaque bug v√©rifi√© et conqu√©rez le sommet du classement hebdomadaire.

[**Inscrivez-vous sur HackenProof**](https://hackenproof.com/register) commencez √† gagner gr√¢ce √† vos hacks !

{% embed url="https://hackenproof.com/register" %}

## Informations de base

MongoDB est un syst√®me de gestion de base de donn√©es (SGBD) [open source](https://whatis.techtarget.com/definition/open-source) qui utilise un mod√®le de base de donn√©es orient√© documents et prend en charge diverses formes de donn√©es. (De [ici](https://searchdatamanagement.techtarget.com/definition/MongoDB))

**Port par d√©faut :** 27017, 27018
```
PORT      STATE SERVICE VERSION
27017/tcp open  mongodb MongoDB 2.6.9 2.6.9
```
## √ânum√©ration

### Manuel

MongoDB est une base de donn√©es NoSQL populaire utilis√©e par de nombreuses applications. Lors de l'√©num√©ration manuelle d'une instance MongoDB, vous pouvez utiliser les √©tapes suivantes :

1. **Recherche de l'adresse IP** : Utilisez des outils tels que `ping` ou `nmap` pour trouver l'adresse IP de l'instance MongoDB.

2. **V√©rification des ports** : Utilisez un scanner de ports pour v√©rifier si les ports 27017 et 27018 sont ouverts sur l'adresse IP cible. Ces ports sont g√©n√©ralement utilis√©s par MongoDB.

3. **Connexion √† l'instance MongoDB** : Utilisez la commande `mongo` pour vous connecter √† l'instance MongoDB en sp√©cifiant l'adresse IP et le port. Par exemple : `mongo 192.168.0.1:27017`.

4. **V√©rification des bases de donn√©es** : Une fois connect√© √† l'instance MongoDB, utilisez la commande `show dbs` pour afficher les bases de donn√©es disponibles.

5. **Exploration des collections** : Utilisez la commande `use <database>` pour s√©lectionner une base de donn√©es sp√©cifique, puis utilisez `show collections` pour afficher les collections disponibles dans cette base de donn√©es.

6. **Affichage des documents** : Utilisez la commande `db.<collection>.find()` pour afficher les documents stock√©s dans une collection sp√©cifique.

7. **Analyse des r√©sultats** : Analysez les r√©sultats obtenus pour identifier des informations sensibles ou des vuln√©rabilit√©s potentielles.

Il est important de noter que l'√©num√©ration manuelle peut √™tre un processus long et fastidieux, en particulier si l'instance MongoDB contient de nombreuses bases de donn√©es et collections. Dans de tels cas, il peut √™tre plus efficace d'utiliser des outils d'√©num√©ration automatis√©s.
```python
from pymongo import MongoClient
client = MongoClient(host, port, username=username, password=password)
client.server_info() #Basic info
#If you have admin access you can obtain more info
admin = client.admin
admin_info = admin.command("serverStatus")
cursor = client.list_databases()
for db in cursor:
print(db)
print(client[db["name"]].list_collection_names())
#If admin access, you could dump the database also
```
**Quelques commandes MongoDB :**

```bash
# Start MongoDB service
sudo service mongod start

# Stop MongoDB service
sudo service mongod stop

# Restart MongoDB service
sudo service mongod restart

# Check MongoDB service status
sudo service mongod status

# Connect to MongoDB shell
mongo

# Show all databases
show dbs

# Switch to a specific database
use <database_name>

# Show all collections in the current database
show collections

# Insert a document into a collection
db.<collection_name>.insertOne({<document>})

# Find all documents in a collection
db.<collection_name>.find()

# Find documents that match a specific condition
db.<collection_name>.find({<condition>})

# Update documents in a collection
db.<collection_name>.updateOne({<condition>}, {$set: {<update>}})

# Delete documents from a collection
db.<collection_name>.deleteOne({<condition>})
```

**Note :** Assurez-vous d'avoir install√© et configur√© MongoDB correctement avant d'ex√©cuter ces commandes.
```bash
show dbs
use <db>
show collections
db.<collection>.find()  #Dump the collection
db.<collection>.count() #Number of records of the collection
db.current.find({"username":"admin"})  #Find in current db the username admin
```
### Automatique

MongoDB is a popular NoSQL database that is widely used in web applications. It uses a binary protocol for communication between the client and the server. By default, MongoDB listens on port 27017 for client connections and on port 27018 for internal cluster communication.

During a penetration test, it is important to check if MongoDB is running on these default ports and if it is vulnerable to any known exploits. One way to automate this process is by using tools like Nmap or Metasploit.

#### Nmap

Nmap is a powerful network scanning tool that can be used to discover open ports on a target system. To scan for MongoDB, you can use the following command:

```
nmap -p 27017,27018 <target_ip>
```

This command will scan the target IP address for open ports 27017 and 27018. If MongoDB is running on these ports, Nmap will report them as open.

#### Metasploit

Metasploit is a popular penetration testing framework that includes a wide range of tools and exploits. It also has modules specifically designed for MongoDB penetration testing.

To use Metasploit for MongoDB scanning, you can use the following command:

```
use auxiliary/scanner/mongodb/mongodb_login
```

This command will load the MongoDB login scanner module. You can then set the target IP address and run the module to check if MongoDB is vulnerable to any known login exploits.

Automating the scanning process using tools like Nmap or Metasploit can save time and effort during a penetration test. However, it is important to note that scanning or exploiting systems without proper authorization is illegal and unethical. Always ensure that you have the necessary permissions and legal authorization before conducting any penetration testing activities.
```bash
nmap -sV --script "mongo* and default" -p 27017 <IP> #By default all the nmap mongo enumerate scripts are used
```
### Shodan

* Tous les mongodb : `"informations sur le serveur mongodb"`
* Rechercher les serveurs mongodb enti√®rement ouverts : `"informations sur le serveur mongodb" -"partiellement activ√©"`
* Seulement partiellement activer l'authentification : `"informations sur le serveur mongodb" "partiellement activ√©"`

## Connexion

Par d√©faut, mongo n'exige pas de mot de passe.\
**Admin** est une base de donn√©es mongo courante.
```bash
mongo <HOST>
mongo <HOST>:<PORT>
mongo <HOST>:<PORT>/<DB>
mongo <database> -u <username> -p '<password>'
```
Le script nmap : _**mongodb-brute**_ v√©rifiera si des identifiants sont n√©cessaires.
```bash
nmap -n -sV --script mongodb-brute -p 27017 <ip>
```
### [**Brute force**](../generic-methodologies-and-resources/brute-force.md#mongo)

Regardez √† l'int√©rieur de _/opt/bitnami/mongodb/mongodb.conf_ pour savoir si des identifiants sont n√©cessaires :
```bash
grep "noauth.*true" /opt/bitnami/mongodb/mongodb.conf | grep -v "^#" #Not needed
grep "auth.*true" /opt/bitnami/mongodb/mongodb.conf | grep -v "^#\|noauth" #Not needed
```
## Pr√©diction d'Object ID Mongo

Les Object IDs Mongo sont des cha√Ænes hexad√©cimales de **12 octets** :

![](../.gitbook/assets/id-and-objectids-in-mongodb.png)

Par exemple, voici comment nous pouvons diss√©quer un Object ID r√©el renvoy√© par une application : 5f2459ac9fa6dc2500314019

1. 5f2459ac : 1596217772 en d√©cimal = vendredi 31 juillet 2020 17:49:32
2. 9fa6dc : Identifiant de machine
3. 2500 : Identifiant de processus
4. 314019 : Un compteur incr√©mental

Parmi les √©l√©ments ci-dessus, l'identifiant de machine restera le m√™me tant que la base de donn√©es ex√©cutera la m√™me machine physique/virtuelle. L'identifiant de processus ne changera que si le processus MongoDB est red√©marr√©. Le timestamp sera mis √† jour chaque seconde. Le seul d√©fi pour deviner les Object IDs en incr√©mentant simplement les valeurs du compteur et du timestamp est le fait que Mongo DB g√©n√®re les Object IDs et attribue les Object IDs au niveau du syst√®me.

L'outil [https://github.com/andresriancho/mongo-objectid-predict](https://github.com/andresriancho/mongo-objectid-predict), √©tant donn√© un Object ID de d√©part (vous pouvez cr√©er un compte et obtenir un ID de d√©part), renvoie environ 1000 Object IDs probables qui auraient pu √™tre attribu√©s aux objets suivants, il vous suffit donc de les bruteforcer.

## Post

Si vous √™tes root, vous pouvez **modifier** le fichier **mongodb.conf** afin de ne pas avoir besoin d'informations d'identification (_noauth = true_) et de **vous connecter sans informations d'identification**.

<figure><img src="../.gitbook/assets/image (1) (3).png" alt=""><figcaption></figcaption></figure>

**HackenProof est le lieu de tous les programmes de primes pour les bugs de cryptographie.**

**Obtenez une r√©compense sans d√©lai**\
Les primes HackenProof ne sont lanc√©es que lorsque leurs clients d√©posent le budget de r√©compense. Vous recevrez la r√©compense apr√®s la v√©rification du bug.

**Acqu√©rez de l'exp√©rience en pentesting web3**\
Les protocoles blockchain et les contrats intelligents sont le nouvel Internet ! Ma√Ætrisez la s√©curit√© web3 √† ses d√©buts.

**Devenez la l√©gende du hacker web3**\
Gagnez des points de r√©putation avec chaque bug v√©rifi√© et conqu√©rez le sommet du classement hebdomadaire.

[**Inscrivez-vous sur HackenProof**](https://hackenproof.com/register) et commencez √† gagner gr√¢ce √† vos hacks !

{% embed url="https://hackenproof.com/register" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Vous travaillez dans une **entreprise de cybers√©curit√©** ? Vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ? ou souhaitez-vous avoir acc√®s √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**üí¨**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR au** [**repo hacktricks**](https://github.com/carlospolop/hacktricks) **et au** [**repo hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
