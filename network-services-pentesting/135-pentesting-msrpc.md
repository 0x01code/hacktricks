# 135, 593 - Ελεγκτική δοκιμή MSRPC

<details>

<summary><strong>Μάθετε το χάκινγκ του AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι υποστήριξης του HackTricks:

* Εάν θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**The PEASS Family**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Συμμετάσχετε στην** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Μοιραστείτε τα χάκινγκ κόλπα σας υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

Εγγραφείτε στον διακομιστή [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) για να επικοινωνήσετε με έμπειρους χάκερ και κυνηγούς ευρημάτων ασφαλείας!

**Εισαγωγή στο Χάκινγκ**\
Ασχοληθείτε με περιεχόμενο που εξερευνά τον ενθουσιασμό και τις προκλήσεις του χάκινγκ

**Ειδήσεις Χάκινγκ σε Πραγματικό Χρόνο**\
Μείνετε ενημερωμένοι με τον γρήγορο ρυθμό του κόσμου του χάκινγκ μέσω ειδήσεων και αναλύσεων σε πραγματικό χρόνο

**Τελευταίες Ανακοινώσεις**\
Μείνετε ενημερωμένοι με τις νεότερες ευρήματα ασφαλείας που ξεκινούν και τις κρίσιμες ενημερώσεις των πλατφορμών

**Συμμετέχετε στο** [**Discord**](https://discord.com/invite/N3FrSbmwdy) **και αρχίστε να συνεργάζεστε με τους κορυφαίους χάκερ σήμερα!**

## Βασικές Πληροφορίες

Το πρωτόκολλο Microsoft Remote Procedure Call (MSRPC), ένα μοντέλο πελάτη-εξυπηρετητή που επιτρέπει σε ένα πρόγραμμα να ζητήσει μια υπηρεσία από ένα πρόγραμμα που βρίσκεται σε έναν άλλο υπολογιστή χωρίς να κατανοεί τις λεπτομέρειες του δικτύου, αρχικά προήλθε από λογισμικό ανοιχτού κώδικα και αργότερα αναπτύχθηκε και πνευματική ιδιοκτησία της Microsoft.

Ο εξυπηρετητής καταγραφής τελικού σημείου RPC μπορεί να προσπελαστεί μέσω των θυρών TCP και UDP 135, SMB στη θύρα TCP 139 και 445 (με μια κενή ή εξουσιοδοτημένη συνεδρία) και ως υπηρεσία ιστού στη θύρα TCP 593.
```
135/tcp   open     msrpc         Microsoft Windows RPC
```
## Πώς λειτουργεί το MSRPC;

Η διαδικασία του MSRPC ξεκινά από την εφαρμογή του πελάτη, καλώντας μια τοπική διαδικασία stub που συνεργάζεται με τη βιβλιοθήκη εκτέλεσης του πελάτη για να προετοιμάσει και να μεταδώσει το αίτημα στον διακομιστή. Αυτό περιλαμβάνει τη μετατροπή των παραμέτρων σε ένα πρότυπο μορφής Αναπαράστασης Δεδομένων Δικτύου. Η επιλογή του πρωτοκόλλου μεταφοράς καθορίζεται από τη βιβλιοθήκη εκτέλεσης, εάν ο διακομιστής είναι απομακρυσμένος, εξασφαλίζοντας ότι το RPC παραδίδεται μέσω του στοίβας δικτύου.

![https://0xffsec.com/handbook/images/msrpc.png](https://0xffsec.com/handbook/images/msrpc.png)

## **Αναγνώριση εκτεθειμένων υπηρεσιών RPC**

Η εκθεση των υπηρεσιών RPC μέσω TCP, UDP, HTTP και SMB μπορεί να προσδιοριστεί με την ανάκτηση πληροφοριών από την υπηρεσία εντοπισμού RPC και τα μεμονωμένα σημεία πρόσβασης. Εργαλεία όπως το rpcdump διευκολύνουν την αναγνώριση μοναδικών υπηρεσιών RPC, που συμβολίζονται από τις τιμές **IFID**, αποκαλύπτοντας λεπτομέρειες της υπηρεσίας και των συνδέσεων επικοινωνίας:
```
D:\rpctools> rpcdump [-p port] <IP>
**IFID**: 5a7b91f8-ff00-11d0-a9b2-00c04fb6e6fc version 1.0
Annotation: Messenger Service
UUID: 00000000-0000-0000-0000-000000000000
Binding: ncadg_ip_udp:<IP>[1028]
```
Η πρόσβαση στην υπηρεσία RPC locator επιτρέπεται μέσω συγκεκριμένων πρωτοκόλλων: ncacn\_ip\_tcp και ncadg\_ip\_udp για πρόσβαση μέσω θύρας 135, ncacn\_np για συνδέσεις SMB και ncacn\_http για επικοινωνία RPC μέσω ιστού. Οι παρακάτω εντολές επιδεικνύουν τη χρήση των ενοτήτων του Metasploit για τον έλεγχο και την αλληλεπίδραση με τις υπηρεσίες MSRPC, με έμφαση κυρίως στη θύρα 135:
```bash
use auxiliary/scanner/dcerpc/endpoint_mapper
use auxiliary/scanner/dcerpc/hidden
use auxiliary/scanner/dcerpc/management
use auxiliary/scanner/dcerpc/tcp_dcerpc_auditor
rpcdump.py <IP> -p 135
```
Όλες οι επιλογές εκτός από το `tcp_dcerpc_auditor` είναι ειδικά σχεδιασμένες για την επίθεση στο MSRPC στη θύρα 135.

#### Σημαντικά διεπαφές RPC

* **IFID**: 12345778-1234-abcd-ef00-0123456789ab
* **Named Pipe**: `\pipe\lsarpc`
* **Περιγραφή**: Διεπαφή LSA, χρησιμοποιείται για την απαρίθμηση χρηστών.


* **IFID**: 3919286a-b10c-11d0-9ba8-00c04fd92ef5
* **Named Pipe**: `\pipe\lsarpc`
* **Περιγραφή**: Διεπαφή LSA Directory Services (DS), χρησιμοποιείται για την απαρίθμηση περιοχών και σχέσεων εμπιστοσύνης.


* **IFID**: 12345778-1234-abcd-ef00-0123456789ac
* **Named Pipe**: `\pipe\samr`
* **Περιγραφή**: Διεπαφή LSA SAMR, χρησιμοποιείται για την πρόσβαση σε στοιχεία της δημόσιας βάσης δεδομένων SAM (π.χ. ονόματα χρηστών) και για την επίθεση με εξαναγκασμό κωδικών πρόσβασης χρηστών ανεξάρτητα από την πολιτική κλειδώματος λογαριασμού.


* **IFID**: 1ff70682-0a51-30e8-076d-740be8cee98b
* **Named Pipe**: `\pipe\atsvc`
* **Περιγραφή**: Προγραμματιστής εργασιών, χρησιμοποιείται για την εκτέλεση εντολών απομακρυσμένα.


* **IFID**: 338cd001-2244-31f1-aaaa-900038001003
* **Named Pipe**: `\pipe\winreg`
* **Περιγραφή**: Υπηρεσία απομακρυσμένης καταχώρησης, χρησιμοποιείται για την πρόσβαση και τροποποίηση του συστήματος καταχώρησης.


* **IFID**: 367abb81-9844-35f1-ad32-98f038001003
* **Named Pipe**: `\pipe\svcctl`
* **Περιγραφή**: Διαχειριστής ελέγχου υπηρεσιών και υπηρεσίες εξυπηρετητή, χρησιμοποιείται για την απομακρυσμένη εκκίνηση και διακοπή υπηρεσιών και την εκτέλεση εντολών.


* **IFID**: 4b324fc8-1670-01d3-1278-5a47bf6ee188
* **Named Pipe**: `\pipe\srvsvc`
* **Περιγραφή**: Διαχειριστής ελέγχου υπηρεσιών και υπηρεσίες εξυπηρετητή, χρησιμοποιείται για την απομακρυσμένη εκκίνηση και διακοπή υπηρεσιών και την εκτέλεση εντολών.


* **IFID**: 4d9f4ab8-7d1c-11cf-861e-0020af6e7c57
* **Named Pipe**: `\pipe\epmapper`
* **Περιγραφή**: Διεπαφή DCOM, χρησιμοποιείται για την επίθεση με εξαναγκασμό κωδικών πρόσβασης και τη συλλογή πληροφοριών μέσω του WM.

### Αναγνώριση διευθύνσεων IP

Χρησιμοποιώντας το [https://github.com/mubix/IOXIDResolver](https://github.com/mubix/IOXIDResolver), προέρχεται από την έρευνα της Airbus [εδώ](https://www.cyber.airbus.com/the-oxid-resolver-part-1-remote-enumeration-of-network-interfaces-without-any-authentication/), είναι δυνατόν να καταχραστείτε τη μέθοδο _**ServerAlive2**_ μέσα στη διεπαφή _**IOXIDResolver**_.

Αυτή η μέθοδος έχει χρησιμοποιηθεί για τη λήψη πληροφοριών διεπαφής ως διεύθυνση **IPv6** από το HTB box _APT_. Δείτε [εδώ](https://0xdf.gitlab.io/2021/04/10/htb-apt.html) για το άρθρο του 0xdf για το APT, περιλαμβάνει μια εναλλακτική μέθοδο χρησιμοποιώντας το rpcmap.py από το [Impacket](https://github.com/SecureAuthCorp/impacket/) με _stringbinding_ (βλ. παραπάνω).

## Θύρα 593

Το **rpcdump.exe** από το [rpctools](https://resources.oreilly.com/examples/9780596510305/tree/master/tools/rpctools) μπορεί να αλληλεπιδράσει με αυτήν τη θύρα.

#​# Αναφορές
* [https://www.cyber.airbus.com/the-oxid-resolver-part-1-remote-enumeration-of-network-interfaces-without-any-authentication/](https://www.cyber.airbus.com/the-oxid-resolver-part-1-remote-enumeration-of-network-interfaces-without-any-authentication/)
* [https://www.cyber.airbus.com/the-oxid-resolver-part-2-accessing-a-remote-object-inside-dcom/](https://www.cyber.airbus.com/the-oxid-resolver-part-2-accessing-a-remote-object-inside-dcom/)
* [https://0xffsec.com/handbook/services/msrpc/](https://0xffsec.com/handbook/services/msrpc/)

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

Εγγραφείτε στο [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) για να επικοινωνήσετε με έμπειρους χάκερ και κυνηγούς ευρημάτων ασφαλείας!

**Εισαγωγή στο Hacking**\
Ασχοληθείτε με περιεχόμενο που εξερευνά τον ενθουσιασμό και τις προκλήσεις του χάκινγκ.

**Ειδήσεις Χάκινγκ σε Πραγματικό Χρόνο**\
Μείνετε ενημερωμένοι με τον γρήγορο ρυθμό του κόσμου του χάκινγκ μέσω ειδήσεων και αναλύσεων σε πραγματικό χρόνο.

**Τελευταίες Ανακοινώσεις**\
Μείνετε ενημερωμένοι με τις νεότερες προσφορές ευρημάτων ασφαλείας κ
