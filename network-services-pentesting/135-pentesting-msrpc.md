# 135, 593 - MSRPC Pentesting

<details>

<summary><strong>AWS hacklemeyi sıfırdan kahramana öğrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> ile!</strong></summary>

HackTricks'ı desteklemenin diğer yolları:

* **Şirketinizi HackTricks'te reklamını görmek istiyorsanız** veya **HackTricks'i PDF olarak indirmek istiyorsanız** [**ABONELİK PLANLARI'na**](https://github.com/sponsors/carlospolop) göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family'yi**](https://opensea.io/collection/the-peass-family) keşfedin, özel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* **Bize katılın** 💬 [**Discord grubunda**](https://discord.gg/hRep4RUj7f) veya [**telegram grubunda**](https://t.me/peass) veya bizi **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks\_live)** takip edin.**
* **Hacking püf noktalarınızı paylaşarak HackTricks ve HackTricks Cloud** github depolarına PR göndererek katkıda bulunun.

</details>

<figure><img src="../.gitbook/assets/image (377).png" alt=""><figcaption></figcaption></figure>

Deneyimli hackerlar ve ödül avcıları ile iletişim kurmak için [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) sunucusuna katılın!

**Hackleme İçgörüleri**\
Hackleme heyecanını ve zorluklarını inceleyen içeriklerle etkileşime geçin

**Gerçek Zamanlı Hack Haberleri**\
Hızlı tempolu hackleme dünyasında gerçek zamanlı haberler ve içgörülerle güncel kalın

**En Son Duyurular**\
Yeni ödül avı başlatmaları ve önemli platform güncellemeleri hakkında bilgi edinin

**Bize katılın** [**Discord**](https://discord.com/invite/N3FrSbmwdy) ve bugün en iyi hackerlarla işbirliğine başlayın!

## Temel Bilgiler

Microsoft Uzak Prosedür Çağrısı (MSRPC) protokolü, bir programın ağın ayrıntılarını anlamadan başka bir bilgisayarda bulunan bir programdan hizmet istemesini sağlayan istemci-sunucu modelidir. Başlangıçta açık kaynak yazılımlardan türetilen ve daha sonra Microsoft tarafından geliştirilen ve telif hakkı alınan bir protokoldür.

RPC uç nokta eşleyicisine TCP ve UDP port 135 üzerinden, SMB üzerinden TCP 139 ve 445'te (boş veya kimlik doğrulamalı oturumla) ve bir web hizmeti olarak TCP port 593 üzerinden erişilebilir.
```
135/tcp   open     msrpc         Microsoft Windows RPC
```
## MSRPC nasıl çalışır?

İstemci uygulaması tarafından başlatılan MSRPC işlemi, yerel bir kısayol prosedürünü çağırarak başlar ve ardından isteği sunucuya iletmek için istemci çalışma zamanı kitaplığıyla etkileşime girer. Bu, parametreleri standart Bir Ağ Veri Temsili formatına dönüştürmeyi içerir. Sunucu uzakta ise, taşıma protokolü seçimi çalışma zamanı kitaplığı tarafından belirlenir ve RPC'nin ağ yığını üzerinden iletilmesini sağlar.

![https://0xffsec.com/handbook/images/msrpc.png](https://0xffsec.com/handbook/images/msrpc.png)

## **Açığa Çıkarılmış RPC Hizmetlerini Tanımlama**

RPC hizmetlerinin TCP, UDP, HTTP ve SMB üzerinde açığa çıkarılması, RPC yer bulucu hizmetini ve bireysel uç noktaları sorgulayarak belirlenebilir. rpcdump gibi araçlar, benzersiz RPC hizmetlerini tanımlamaya yardımcı olur, **IFID** değerleri ile belirtilen hizmet ayrıntılarını ve iletişim bağlantılarını ortaya çıkarır:
```
D:\rpctools> rpcdump [-p port] <IP>
**IFID**: 5a7b91f8-ff00-11d0-a9b2-00c04fb6e6fc version 1.0
Annotation: Messenger Service
UUID: 00000000-0000-0000-0000-000000000000
Binding: ncadg_ip_udp:<IP>[1028]
```
RPC yer bulucu servisine erişim belirli protokoller aracılığıyla etkinleştirilir: port 135 üzerinden erişim için ncacn\_ip\_tcp ve ncadg\_ip\_udp, SMB bağlantıları için ncacn\_np ve web tabanlı RPC iletişimi için ncacn\_http. Aşağıdaki komutlar, Metasploit modüllerinin MSRPC hizmetlerini denetlemek ve etkileşimde bulunmak için nasıl kullanılacağını örneklemektedir:
```bash
use auxiliary/scanner/dcerpc/endpoint_mapper
use auxiliary/scanner/dcerpc/hidden
use auxiliary/scanner/dcerpc/management
use auxiliary/scanner/dcerpc/tcp_dcerpc_auditor
rpcdump.py <IP> -p 135
```
Tüm seçenekler, `tcp_dcerpc_auditor` hariç, 135 numaralı port üzerinde MSRPC'yi hedeflemek için özel olarak tasarlanmıştır.

#### Dikkate Değer RPC Arayüzleri

* **IFID**: 12345778-1234-abcd-ef00-0123456789ab
* **Adlandırılmış Boru**: `\pipe\lsarpc`
* **Açıklama**: Kullanıcıları sıralamak için kullanılan LSA arayüzü.
* **IFID**: 3919286a-b10c-11d0-9ba8-00c04fd92ef5
* **Adlandırılmış Boru**: `\pipe\lsarpc`
* **Açıklama**: Alanlar ve güven ilişkilerini sıralamak için kullanılan LSA Dizin Hizmetleri (DS) arayüzü.
* **IFID**: 12345778-1234-abcd-ef00-0123456789ac
* **Adlandırılmış Boru**: `\pipe\samr`
* **Açıklama**: Kullanıcı adları gibi genel SAM veritabanı öğelerine erişmek ve hesap kilit politikasından bağımsız olarak kullanıcı şifrelerini kaba kuvvetle çözmek için kullanılan LSA SAMR arayüzü.
* **IFID**: 1ff70682-0a51-30e8-076d-740be8cee98b
* **Adlandırılmış Boru**: `\pipe\atsvc`
* **Açıklama**: Görev zamanlayıcı, uzaktan komutları yürütmek için kullanılır.
* **IFID**: 338cd001-2244-31f1-aaaa-900038001003
* **Adlandırılmış Boru**: `\pipe\winreg`
* **Açıklama**: Uzak kayıt defteri hizmeti, sistem kayıt defterine erişim ve değişiklik yapmak için kullanılır.
* **IFID**: 367abb81-9844-35f1-ad32-98f038001003
* **Adlandırılmış Boru**: `\pipe\svcctl`
* **Açıklama**: Hizmet kontrol yöneticisi ve sunucu hizmetleri, hizmetleri uzaktan başlatmak ve durdurmak ve komutları yürütmek için kullanılır.
* **IFID**: 4b324fc8-1670-01d3-1278-5a47bf6ee188
* **Adlandırılmış Boru**: `\pipe\srvsvc`
* **Açıklama**: Hizmet kontrol yöneticisi ve sunucu hizmetleri, hizmetleri uzaktan başlatmak ve durdurmak ve komutları yürütmek için kullanılır.
* **IFID**: 4d9f4ab8-7d1c-11cf-861e-0020af6e7c57
* **Adlandırılmış Boru**: `\pipe\epmapper`
* **Açıklama**: DCOM arayüzü, WM aracılığıyla kaba kuvvet şifre öğütme ve bilgi toplama için kullanılır.

### IP Adreslerini Tanımlama

[https://github.com/mubix/IOXIDResolver](https://github.com/mubix/IOXIDResolver) kullanılarak, _**IOXIDResolver**_ arayüzü içindeki _**ServerAlive2**_ yöntemi kötüye kullanılabilir.

Bu yöntem, HTB kutusu _APT_'den **IPv6** adresi olarak arayüz bilgilerini almak için kullanılmıştır. 0xdf APT yazısına [buradan](https://0xdf.gitlab.io/2021/04/10/htb-apt.html) ulaşabilirsiniz, Impacket'ten [rpcmap.py](https://github.com/SecureAuthCorp/impacket/) kullanarak _stringbinding_ ile alternatif bir yöntem içermektedir.

### Geçerli Kimlik Bilgileriyle Uzaktan Kod Yürütme

Geçerli bir kullanıcının kimlik bilgileri mevcutsa, [impacket çerçevesinden dcomexec.py](https://github.com/fortra/impacket/blob/master/examples/dcomexec.py) kullanılarak bir makinede uzaktan kod yürütmek mümkündür.

**Farklı mevcut nesnelerle denemeyi unutmayın**

* ShellWindows
* ShellBrowserWindow
* MMC20

## Port 593

**rpctools**'dan **rpcdump.exe** bu porta etkileşimde bulunabilir.

## Referanslar

* [https://www.cyber.airbus.com/the-oxid-resolver-part-1-remote-enumeration-of-network-interfaces-without-any-authentication/](https://www.cyber.airbus.com/the-oxid-resolver-part-1-remote-enumeration-of-network-interfaces-without-any-authentication/)
* [https://www.cyber.airbus.com/the-oxid-resolver-part-2-accessing-a-remote-object-inside-dcom/](https://www.cyber.airbus.com/the-oxid-resolver-part-2-accessing-a-remote-object-inside-dcom/)
* [https://0xffsec.com/handbook/services/msrpc/](https://0xffsec.com/handbook/services/msrpc/)

<figure><img src="../.gitbook/assets/image (377).png" alt=""><figcaption></figcaption></figure>

Deneyimli hackerlar ve hata avcıları ile iletişim kurmak için [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) sunucusuna katılın!

**Hacking İçgörüleri**\
Hacking'in heyecanını ve zorluklarını inceleyen içeriklerle etkileşime geçin

**Gerçek Zamanlı Hack Haberleri**\
Hızlı tempolu hacking dünyasını gerçek zamanlı haberler ve içgörülerle takip edin

**En Son Duyurular**\
Yeni hata avcılıklarını ve önemli platform güncellemelerini takip edin

**Bize** [**Discord**](https://discord.com/invite/N3FrSbmwdy) **katılın ve bugün en iyi hackerlarla işbirliğine başlayın!**
