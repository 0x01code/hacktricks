# 135, 593 - Pentesting MSRPC

<details>

<summary><strong>Aprenda hacking AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras maneiras de apoiar o HackTricks:

* Se voc√™ deseja ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF** Verifique os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**swag oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-nos** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para os** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) reposit√≥rios do github.

</details>

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

Junte-se ao servidor [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) para se comunicar com hackers experientes e ca√ßadores de recompensas por bugs!

**Percep√ß√µes de Hacking**\
Envolver-se com conte√∫do que explora a emo√ß√£o e os desafios do hacking

**Not√≠cias de Hacking em Tempo Real**\
Mantenha-se atualizado com o mundo acelerado do hacking atrav√©s de not√≠cias e percep√ß√µes em tempo real

**√öltimos An√∫ncios**\
Fique informado sobre os mais recentes programas de recompensas por bugs lan√ßados e atualiza√ß√µes cruciais da plataforma

**Junte-se a n√≥s no** [**Discord**](https://discord.com/invite/N3FrSbmwdy) e comece a colaborar com os melhores hackers hoje!

## Informa√ß√µes B√°sicas

O protocolo Microsoft Remote Procedure Call (MSRPC), um modelo cliente-servidor que permite a um programa solicitar um servi√ßo de um programa localizado em outro computador sem entender os detalhes da rede, foi inicialmente derivado de software de c√≥digo aberto e posteriormente desenvolvido e protegido por direitos autorais pela Microsoft.

O mapeador de pontos de extremidade RPC pode ser acessado via porta TCP e UDP 135, SMB na porta TCP 139 e 445 (com uma sess√£o nula ou autenticada), e como um servi√ßo da web na porta TCP 593.
```
135/tcp   open     msrpc         Microsoft Windows RPC
```
## Como funciona o MSRPC?

Iniciado pela aplica√ß√£o cliente, o processo MSRPC envolve chamar um procedimento stub local que interage com a biblioteca de tempo de execu√ß√£o do cliente para preparar e transmitir a solicita√ß√£o para o servidor. Isso inclui a convers√£o de par√¢metros em um formato padr√£o de Representa√ß√£o de Dados de Rede. A escolha do protocolo de transporte √© determinada pela biblioteca de tempo de execu√ß√£o se o servidor for remoto, garantindo que o RPC seja entregue atrav√©s da pilha de rede.

![https://0xffsec.com/handbook/images/msrpc.png](https://0xffsec.com/handbook/images/msrpc.png)

## **Identifica√ß√£o de Servi√ßos RPC Expostos**

A exposi√ß√£o de servi√ßos RPC atrav√©s de TCP, UDP, HTTP e SMB pode ser determinada consultando o servi√ßo de localiza√ß√£o RPC e os pontos finais individuais. Ferramentas como rpcdump facilitam a identifica√ß√£o de servi√ßos RPC √∫nicos, denotados por valores **IFID**, revelando detalhes do servi√ßo e vincula√ß√µes de comunica√ß√£o:
```
D:\rpctools> rpcdump [-p port] <IP>
**IFID**: 5a7b91f8-ff00-11d0-a9b2-00c04fb6e6fc version 1.0
Annotation: Messenger Service
UUID: 00000000-0000-0000-0000-000000000000
Binding: ncadg_ip_udp:<IP>[1028]
```
O acesso ao servi√ßo de localiza√ß√£o RPC √© habilitado por meio de protocolos espec√≠ficos: ncacn\_ip\_tcp e ncadg\_ip\_udp para acesso via porta 135, ncacn\_np para conex√µes SMB e ncacn\_http para comunica√ß√£o RPC baseada na web. Os comandos a seguir exemplificam a utiliza√ß√£o de m√≥dulos do Metasploit para auditar e interagir com os servi√ßos MSRPC, focando principalmente na porta 135:
```bash
use auxiliary/scanner/dcerpc/endpoint_mapper
use auxiliary/scanner/dcerpc/hidden
use auxiliary/scanner/dcerpc/management
use auxiliary/scanner/dcerpc/tcp_dcerpc_auditor
rpcdump.py <IP> -p 135
```
Todas as op√ß√µes, exceto `tcp_dcerpc_auditor`, s√£o especificamente projetadas para visar o MSRPC na porta 135.

#### Interfaces RPC not√°veis

* **IFID**: 12345778-1234-abcd-ef00-0123456789ab
* **Named Pipe**: `\pipe\lsarpc`
* **Descri√ß√£o**: Interface LSA, usada para enumerar usu√°rios.


* **IFID**: 3919286a-b10c-11d0-9ba8-00c04fd92ef5
* **Named Pipe**: `\pipe\lsarpc`
* **Descri√ß√£o**: Interface de Servi√ßos de Diret√≥rio (DS) LSA, usada para enumerar dom√≠nios e relacionamentos de confian√ßa.


* **IFID**: 12345778-1234-abcd-ef00-0123456789ac
* **Named Pipe**: `\pipe\samr`
* **Descri√ß√£o**: Interface SAMR LSA, usada para acessar elementos p√∫blicos do banco de dados SAM (por exemplo, nomes de usu√°rios) e for√ßar senhas de usu√°rios, independentemente da pol√≠tica de bloqueio de conta.


* **IFID**: 1ff70682-0a51-30e8-076d-740be8cee98b
* **Named Pipe**: `\pipe\atsvc`
* **Descri√ß√£o**: Agendador de tarefas, usado para executar comandos remotamente.


* **IFID**: 338cd001-2244-31f1-aaaa-900038001003
* **Named Pipe**: `\pipe\winreg`
* **Descri√ß√£o**: Servi√ßo de registro remoto, usado para acessar e modificar o registro do sistema.


* **IFID**: 367abb81-9844-35f1-ad32-98f038001003
* **Named Pipe**: `\pipe\svcctl`
* **Descri√ß√£o**: Gerenciador de controle de servi√ßos e servi√ßos de servidor, usado para iniciar e parar servi√ßos remotamente e executar comandos.


* **IFID**: 4b324fc8-1670-01d3-1278-5a47bf6ee188
* **Named Pipe**: `\pipe\srvsvc`
* **Descri√ß√£o**: Gerenciador de controle de servi√ßos e servi√ßos de servidor, usado para iniciar e parar servi√ßos remotamente e executar comandos.


* **IFID**: 4d9f4ab8-7d1c-11cf-861e-0020af6e7c57
* **Named Pipe**: `\pipe\epmapper`
* **Descri√ß√£o**: Interface DCOM, usada para for√ßa bruta de senhas e coleta de informa√ß√µes via WM.

### Identificando endere√ßos IP

Usando [https://github.com/mubix/IOXIDResolver](https://github.com/mubix/IOXIDResolver), proveniente da pesquisa da [Airbus](https://www.cyber.airbus.com/the-oxid-resolver-part-1-remote-enumeration-of-network-interfaces-without-any-authentication/), √© poss√≠vel abusar do m√©todo _**ServerAlive2**_ dentro da interface _**IOXIDResolver**_.

Este m√©todo foi usado para obter informa√ß√µes de interface como endere√ßo **IPv6** da m√°quina HTB _APT_. Veja [aqui](https://0xdf.gitlab.io/2021/04/10/htb-apt.html) o artigo da 0xdf sobre o APT, que inclui um m√©todo alternativo usando rpcmap.py do [Impacket](https://github.com/SecureAuthCorp/impacket/) com _stringbinding_ (veja acima).

## Porta 593

O **rpcdump.exe** do [rpctools](https://resources.oreilly.com/examples/9780596510305/tree/master/tools/rpctools) pode interagir com esta porta.

#‚Äã# Refer√™ncias
* [https://www.cyber.airbus.com/the-oxid-resolver-part-1-remote-enumeration-of-network-interfaces-without-any-authentication/](https://www.cyber.airbus.com/the-oxid-resolver-part-1-remote-enumeration-of-network-interfaces-without-any-authentication/)
* [https://www.cyber.airbus.com/the-oxid-resolver-part-2-accessing-a-remote-object-inside-dcom/](https://www.cyber.airbus.com/the-oxid-resolver-part-2-accessing-a-remote-object-inside-dcom/)
* [https://0xffsec.com/handbook/services/msrpc/](https://0xffsec.com/handbook/services/msrpc/)

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

Junte-se ao servidor [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) para se comunicar com hackers experientes e ca√ßadores de bugs!

**Percep√ß√µes de Hacking**\
Engaje-se com conte√∫do que explora a emo√ß√£o e os desafios do hacking

**Not√≠cias de Hacking em Tempo Real**\
Mantenha-se atualizado com o mundo acelerado do hacking por meio de not√≠cias e insights em tempo real

**√öltimos An√∫ncios**\
Fique informado sobre os novos programas de recompensas por bugs lan√ßados e atualiza√ß√µes cruciais da plataforma

**Junte-se a n√≥s no** [**Discord**](https://discord.com/invite/N3FrSbmwdy) e comece a colaborar com os melhores hackers hoje!

<details>

<summary><strong>Aprenda hacking AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras maneiras de apoiar o HackTricks:

* Se voc√™ deseja ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**swag oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou nos siga no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
