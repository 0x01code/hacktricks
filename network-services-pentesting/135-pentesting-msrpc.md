# 135, 593 - Pentesting MSRPC

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Expert Red Team AWS de HackTricks)</strong></a><strong>!</strong></summary>

Autres fa√ßons de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

Rejoignez le serveur [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) pour communiquer avec des pirates exp√©riment√©s et des chasseurs de primes !

**Perspectives de Piratage**\
Engagez-vous avec du contenu qui explore le frisson et les d√©fis du piratage

**Actualit√©s de Piratage en Temps R√©el**\
Restez √† jour avec le monde du piratage en √©volution rapide gr√¢ce aux actualit√©s et aux informations en temps r√©el

**Derni√®res Annonces**\
Restez inform√© des derni√®res primes de bugs lanc√©es et des mises √† jour cruciales de la plateforme

**Rejoignez-nous sur** [**Discord**](https://discord.com/invite/N3FrSbmwdy) et commencez √† collaborer avec les meilleurs pirates d√®s aujourd'hui !

## Informations de Base

Le protocole Microsoft Remote Procedure Call (MSRPC), un mod√®le client-serveur permettant √† un programme de demander un service √† un programme situ√© sur un autre ordinateur sans comprendre les sp√©cificit√©s du r√©seau, a √©t√© initialement d√©riv√© d'un logiciel open source, puis d√©velopp√© et prot√©g√© par des droits d'auteur par Microsoft.

Le gestionnaire de points de terminaison RPC peut √™tre acc√©d√© via les ports TCP et UDP 135, SMB sur TCP 139 et 445 (avec une session nulle ou authentifi√©e), et en tant que service web sur le port TCP 593.
```
135/tcp   open     msrpc         Microsoft Windows RPC
```
## Comment fonctionne MSRPC?

Initi√© par l'application cliente, le processus MSRPC implique l'appel d'une proc√©dure locale de stub qui interagit ensuite avec la biblioth√®que d'ex√©cution cliente pour pr√©parer et transmettre la demande au serveur. Cela inclut la conversion des param√®tres dans un format standard de repr√©sentation des donn√©es r√©seau. Le choix du protocole de transport est d√©termin√© par la biblioth√®que d'ex√©cution si le serveur est distant, assurant que la RPC est d√©livr√©e √† travers la pile r√©seau.

![https://0xffsec.com/handbook/images/msrpc.png](https://0xffsec.com/handbook/images/msrpc.png)

## **Identification des services RPC expos√©s**


L'exposition des services RPC √† travers TCP, UDP, HTTP et SMB peut √™tre d√©termin√©e en interrogeant le service de localisation RPC et les points de terminaison individuels. Des outils tels que rpcdump facilitent l'identification des services RPC uniques, d√©sign√©s par des valeurs **IFID**, r√©v√©lant les d√©tails du service et les liaisons de communication:
```
D:\rpctools> rpcdump [-p port] <IP>
**IFID**: 5a7b91f8-ff00-11d0-a9b2-00c04fb6e6fc version 1.0
Annotation: Messenger Service
UUID: 00000000-0000-0000-0000-000000000000
Binding: ncadg_ip_udp:<IP>[1028]
```
L'acc√®s au service de localisation RPC est activ√© via des protocoles sp√©cifiques : ncacn\_ip\_tcp et ncadg\_ip\_udp pour y acc√©der via le port 135, ncacn\_np pour les connexions SMB, et ncacn\_http pour la communication RPC bas√©e sur le web. Les commandes suivantes illustrent l'utilisation des modules Metasploit pour auditer et interagir avec les services MSRPC, en se concentrant principalement sur le port 135 :
```bash
use auxiliary/scanner/dcerpc/endpoint_mapper
use auxiliary/scanner/dcerpc/hidden
use auxiliary/scanner/dcerpc/management
use auxiliary/scanner/dcerpc/tcp_dcerpc_auditor
rpcdump.py <IP> -p 135
```
Toutes les options sauf `tcp_dcerpc_auditor` sont sp√©cifiquement con√ßues pour cibler MSRPC sur le port 135.

#### Interfaces RPC notables

**IFID**: 12345778-1234-abcd-ef00-0123456789ab
**Named Pipe**: \pipe\lsarpc
**Description**: Interface LSA, utilis√©e pour √©num√©rer les utilisateurs.

**IFID**: 3919286a-b10c-11d0-9ba8-00c04fd92ef5
**Named Pipe**: \pipe\lsarpc
**Description**: Interface LSA Directory Services (DS), utilis√©e pour √©num√©rer les domaines et les relations de confiance.

**IFID**: 12345778-1234-abcd-ef00-0123456789ac
**Named Pipe**: \pipe\samr
**Description**: Interface LSA SAMR, utilis√©e pour acc√©der aux √©l√©ments publics de la base de donn√©es SAM (par ex., noms d'utilisateur) et pour forcer les mots de passe des utilisateurs ind√©pendamment de la politique de verrouillage des comptes.

**IFID**: 1ff70682-0a51-30e8-076d-740be8cee98b
**Named Pipe**: \pipe\atsvc
**Description**: Planificateur de t√¢ches, utilis√© pour ex√©cuter des commandes √† distance.

**IFID**: 338cd001-2244-31f1-aaaa-900038001003
**Named Pipe**: \pipe\winreg
**Description**: Service de registre distant, utilis√© pour acc√©der et modifier le registre syst√®me.

**IFID**: 367abb81-9844-35f1-ad32-98f038001003
**Named Pipe**: \pipe\svcctl
**Description**: Gestionnaire de contr√¥le de service et services serveur, utilis√© pour d√©marrer et arr√™ter √† distance des services et ex√©cuter des commandes.

**IFID**: 4b324fc8-1670-01d3-1278-5a47bf6ee188
**Named Pipe**: \pipe\srvsvc
**Description**: Gestionnaire de contr√¥le de service et services serveur, utilis√© pour d√©marrer et arr√™ter √† distance des services et ex√©cuter des commandes.

**IFID**: 4d9f4ab8-7d1c-11cf-861e-0020af6e7c57
**Named Pipe**: \pipe\epmapper
**Description**: Interface DCOM, utilis√©e pour forcer le broyage de mots de passe et la collecte d'informations via WM.

### Identification des adresses IP

En utilisant [https://github.com/mubix/IOXIDResolver](https://github.com/mubix/IOXIDResolver), provenant de la recherche d'Airbus, il est possible d'abuser de la m√©thode _**ServerAlive2**_ √† l'int√©rieur de l'interface _**IOXIDResolver**_.

Cette m√©thode a √©t√© utilis√©e pour obtenir des informations d'interface en tant qu'adresse **IPv6** de la bo√Æte HTB _APT_. Voir [ici](https://0xdf.gitlab.io/2021/04/10/htb-apt.html) pour l'analyse APT de 0xdf, qui inclut une m√©thode alternative utilisant rpcmap.py d'[Impacket](https://github.com/SecureAuthCorp/impacket/) avec _stringbinding_ (voir ci-dessus).

## Port 593

Le **rpcdump.exe** de [rpctools](https://resources.oreilly.com/examples/9780596510305/tree/master/tools/rpctools) peut interagir avec ce port.

#‚Äã# R√©f√©rences
* [https://www.cyber.airbus.com/the-oxid-resolver-part-1-remote-enumeration-of-network-interfaces-without-any-authentication/](https://www.cyber.airbus.com/the-oxid-resolver-part-1-remote-enumeration-of-network-interfaces-without-any-authentication/)
* [https://www.cyber.airbus.com/the-oxid-resolver-part-2-accessing-a-remote-object-inside-dcom/](https://www.cyber.airbus.com/the-oxid-resolver-part-2-accessing-a-remote-object-inside-dcom/)
* [https://0xffsec.com/handbook/services/msrpc/](https://0xffsec.com/handbook/services/msrpc/)

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

Rejoignez le serveur [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) pour communiquer avec des hackers exp√©riment√©s et des chasseurs de primes en s√©curit√© !

**Perspectives sur le piratage**\
Engagez-vous avec du contenu qui explore l'excitation et les d√©fis du piratage

**Actualit√©s sur le piratage en temps r√©el**\
Restez inform√© du monde du piratage √† travers des actualit√©s et des informations en temps r√©el

**Derni√®res annonces**\
Restez inform√© des derni√®res primes de bugs lanc√©es et des mises √† jour cruciales de la plateforme

**Rejoignez-nous sur** [**Discord**](https://discord.com/invite/N3FrSbmwdy) et commencez √† collaborer avec les meilleurs hackers d√®s aujourd'hui !

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres fa√ßons de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
