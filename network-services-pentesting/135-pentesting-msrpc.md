# 135, 593 - Pentesting MSRPC

<details>

<summary><strong>Leer AWS-hacking vanaf nul tot held met</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Ander maniere om HackTricks te ondersteun:

* As jy jou **maatskappy geadverteer wil sien in HackTricks** of **HackTricks in PDF wil aflaai** Kyk na die [**INSKRYWINGSPLANNE**](https://github.com/sponsors/carlospolop)!
* Kry die [**amptelike PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ontdek [**Die PEASS Familie**](https://opensea.io/collection/the-peass-family), ons versameling eksklusiewe [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Deel jou haktruuks deur PRs in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-opslag.

</details>

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

Sluit aan by [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) bediener om met ervare hackers en foutbeloningsjagters te kommunikeer!

**Hacker-insigte**\
Raak betrokke by inhoud wat die opwinding en uitdagings van hackery ondersoek

**Hacker-nuus in werklikheid**\
Bly op hoogte van die snelveranderende hackery-w√™reld deur middel van nuus en insigte in werklikheid

**Nuutste aankondigings**\
Bly ingelig met die nuutste foutbelonings wat bekendgestel word en kritieke platformopdaterings

**Sluit by ons aan op** [**Discord**](https://discord.com/invite/N3FrSbmwdy) en begin vandag saamwerk met top hackers!
```
135/tcp   open     msrpc         Microsoft Windows RPC
```
## Hoe werk MSRPC?

Ge√Ønisieer deur die klienttoepassing, behels die MSRPC-proses die oproep van 'n plaaslike stub-prosedure wat dan interaksie het met die klient-runtime-biblioteek om die versoek na die bediener voor te berei en oor te dra. Dit sluit in die omskakeling van parameters na 'n standaard Netwerkdata-voorstellingformaat. Die keuse van vervoerprotokol word bepaal deur die runtime-biblioteek as die bediener afgele√´ is, wat verseker dat die RPC deur die netwerkstapel afgelewer word.

![https://0xffsec.com/handbook/images/msrpc.png](https://0xffsec.com/handbook/images/msrpc.png)

## **Identifisering van Blootgestelde RPC-diens**

Die blootstelling van RPC-diens oor TCP, UDP, HTTP, en SMB kan bepaal word deur die RPC-lokator-diens en individuele eindpunte te ondersoek. Gereedskap soos rpcdump fasiliteer die identifisering van unieke RPC-diens, aangedui deur **IFID**-waardes, wat diensbesonderhede en kommunikasiebinding onthul:
```
D:\rpctools> rpcdump [-p port] <IP>
**IFID**: 5a7b91f8-ff00-11d0-a9b2-00c04fb6e6fc version 1.0
Annotation: Messenger Service
UUID: 00000000-0000-0000-0000-000000000000
Binding: ncadg_ip_udp:<IP>[1028]
```
Toegang tot die RPC lokator-diens is geaktiveer deur spesifieke protokolle: ncacn_ip_tcp en ncadg_ip_udp vir toegang via poort 135, ncacn_np vir SMB-verbindinge, en ncacn_http vir web-gebaseerde RPC kommunikasie. Die volgende bevele illustreer die gebruik van Metasploit-modules om oudit en interaksie met MSRPC-diens te h√™, met 'n prim√™re fokus op poort 135:
```bash
use auxiliary/scanner/dcerpc/endpoint_mapper
use auxiliary/scanner/dcerpc/hidden
use auxiliary/scanner/dcerpc/management
use auxiliary/scanner/dcerpc/tcp_dcerpc_auditor
rpcdump.py <IP> -p 135
```
Alle opsies behalwe `tcp_dcerpc_auditor` is spesifiek ontwerp vir die teiken van MSRPC op poort 135.

#### Merkwaardige RPC-koppelvlakke

* **IFID**: 12345778-1234-abcd-ef00-0123456789ab
* **Genoemde Pyp**: `\pipe\lsarpc`
* **Beskrywing**: LSA-koppelvlak, gebruik om gebruikers op te som.

* **IFID**: 3919286a-b10c-11d0-9ba8-00c04fd92ef5
* **Genoemde Pyp**: `\pipe\lsarpc`
* **Beskrywing**: LSA-gidsdiens (DS) koppelvlak, gebruik om domeine en vertrouensverhoudings op te som.

* **IFID**: 12345778-1234-abcd-ef00-0123456789ac
* **Genoemde Pyp**: `\pipe\samr`
* **Beskrywing**: LSA SAMR-koppelvlak, gebruik om openbare SAM-databasis elemente (bv., gebruikersname) te benader en gebruikers wagwoorde te kragtig ongeag rekening sluitingsbeleid.

* **IFID**: 1ff70682-0a51-30e8-076d-740be8cee98b
* **Genoemde Pyp**: `\pipe\atsvc`
* **Beskrywing**: Taakbeplanner, gebruik om op afstand bevele uit te voer.

* **IFID**: 338cd001-2244-31f1-aaaa-900038001003
* **Genoemde Pyp**: `\pipe\winreg`
* **Beskrywing**: Afgele√´ registerdiens, gebruik om die stelselregister te benader en te wysig.

* **IFID**: 367abb81-9844-35f1-ad32-98f038001003
* **Genoemde Pyp**: `\pipe\svcctl`
* **Beskrywing**: Diensbeheerder en bedienerdiens, gebruik om dienste op afstand te begin en te stop en bevele uit te voer.

* **IFID**: 4b324fc8-1670-01d3-1278-5a47bf6ee188
* **Genoemde Pyp**: `\pipe\srvsvc`
* **Beskrywing**: Diensbeheerder en bedienerdiens, gebruik om dienste op afstand te begin en te stop en bevele uit te voer.

* **IFID**: 4d9f4ab8-7d1c-11cf-861e-0020af6e7c57
* **Genoemde Pyp**: `\pipe\epmapper`
* **Beskrywing**: DCOM-koppelvlak, gebruik vir wagwoordkragtig en inligtingversameling via WM.

### Identifisering van IP-adresse

Deur [https://github.com/mubix/IOXIDResolver](https://github.com/mubix/IOXIDResolver) te gebruik, afkomstig van [Airbus-navorsing](https://www.cyber.airbus.com/the-oxid-resolver-part-1-remote-enumeration-of-network-interfaces-without-any-authentication/), is dit moontlik om die _**ServerAlive2**_ metode binne die _**IOXIDResolver**_ koppelvlak te misbruik.

Hierdie metode is gebruik om koppelvlakinligting as **IPv6**-adres van die HTB-boks _APT_ te kry. Sien [hier](https://0xdf.gitlab.io/2021/04/10/htb-apt.html) vir 0xdf APT skryfstuk, dit sluit 'n alternatiewe metode in wat rpcmap.py van [Impacket](https://github.com/SecureAuthCorp/impacket/) met _stringbinding_ gebruik (sien bostaande).

### Uitvoering van 'n RCE met geldige geloofsbriewe

Dit is moontlik om afgele√´ kode op 'n masjien uit te voer, as die geloofsbriewe van 'n geldige gebruiker beskikbaar is deur [dcomexec.py](https://github.com/fortra/impacket/blob/master/examples/dcomexec.py) van die Impacket-raamwerk te gebruik.

**Onthou om met die verskillende beskikbare voorwerpe te probeer**
* ShellWindows
* ShellBrowserWindow
* MMC20

## Poort 593

Die **rpcdump.exe** van [rpctools](https://resources.oreilly.com/examples/9780596510305/tree/master/tools/rpctools) kan met hierdie poort kommunikeer.

## Verwysings
* [https://www.cyber.airbus.com/the-oxid-resolver-part-1-remote-enumeration-of-network-interfaces-without-any-authentication/](https://www.cyber.airbus.com/the-oxid-resolver-part-1-remote-enumeration-of-network-interfaces-without-any-authentication/)
* [https://www.cyber.airbus.com/the-oxid-resolver-part-2-accessing-a-remote-object-inside-dcom/](https://www.cyber.airbus.com/the-oxid-resolver-part-2-accessing-a-remote-object-inside-dcom/)
* [https://0xffsec.com/handbook/services/msrpc/](https://0xffsec.com/handbook/services/msrpc/)

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

Sluit aan by [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) bediener om met ervare hackers en foutbeloningsjagters te kommunikeer!

**Hack-insigte**\
Gaan in gesprek met inhoud wat die opwinding en uitdagings van hack ondersoek

**Re√´le tyd Hack-nuus**\
Bly op hoogte van die vinnige hack-w√™reld deur middel van nuus en insigte in re√´le tyd

**Nuutste aankondigings**\
Bly ingelig met die nuutste foutbelonings wat bekendgestel word en belangrike platformopdaterings

**Sluit by ons aan op** [**Discord**](https://discord.com/invite/N3FrSbmwdy) en begin vandag saamwerk met top hackers!
