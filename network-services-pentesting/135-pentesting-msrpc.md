## Informations de base

Microsoft Remote Procedure Call, √©galement connu sous le nom d'appel de fonction ou d'appel de sous-routine, est un protocole qui utilise le mod√®le client-serveur pour permettre √† un programme de demander un service √† un programme sur un autre ordinateur sans avoir √† comprendre les d√©tails du r√©seau de cet ordinateur. MSRPC a √©t√© initialement d√©riv√© d'un logiciel open source mais a √©t√© d√©velopp√© davantage et prot√©g√© par des droits d'auteur par Microsoft.

Selon la configuration de l'h√¥te, le gestionnaire de point de terminaison RPC peut √™tre accessible via les ports TCP et UDP 135, via SMB avec une session nulle ou authentifi√©e (TCP 139 et 445), et en tant que service Web √©coutant sur le port TCP 593.
```
135/tcp   open     msrpc         Microsoft Windows RPC
```
## Comment fonctionne MSRPC?

Le processus MSRPC commence c√¥t√© client, avec l'application cliente appelant une proc√©dure locale de stub au lieu du code impl√©mentant la proc√©dure. Le code stub client r√©cup√®re les param√®tres requis de l'espace d'adressage client et les transmet √† la biblioth√®que d'ex√©cution client, qui traduit ensuite les param√®tres dans un format standard de repr√©sentation de donn√©es r√©seau pour les transmettre au serveur.

Le stub client appelle ensuite des fonctions dans la biblioth√®que d'ex√©cution client RPC pour envoyer la demande et les param√®tres au serveur. Si le serveur est situ√© √† distance, la biblioth√®que d'ex√©cution sp√©cifie un protocole de transport appropri√© et un moteur et transmet le RPC √† la pile r√©seau pour le transport vers le serveur.\
√Ä partir de l√†: [https://www.extrahop.com/resources/protocols/msrpc/](https://www.extrahop.com/resources/protocols/msrpc/)

![](<../.gitbook/assets/image (133).png>)

**Image du livre "**_**Network Security Assesment 3rd Edition**_**"**

## **Identification des services RPC expos√©s**

Vous pouvez interroger le service de localisation RPC et les points de terminaison RPC individuels pour cataloguer les services int√©ressants s'ex√©cutant sur TCP, UDP, HTTP et SMB (via des pipes nomm√©s). Chaque valeur IFID recueillie par ce processus d√©signe un service RPC (par exemple, 5a7b91f8-ff00-11d0-a9b2-00c04fb6e6fc est l'interface Messenger).

Les utilitaires Windows rpcdump et ifids de Todd Sabin interrogent √† la fois le service de localisation RPC et les points de terminaison RPC sp√©cifiques pour r√©pertorier les valeurs IFID. La syntaxe de rpcdump est la suivante:
```
D:\rpctools> rpcdump [-p port] 192.168.189.1
IfId: 5a7b91f8-ff00-11d0-a9b2-00c04fb6e6fc version 1.0
Annotation: Messenger Service
UUID: 00000000-0000-0000-0000-000000000000
Binding: ncadg_ip_udp:192.168.189.1[1028]
```
Vous pouvez acc√©der au service RPC locator en utilisant quatre s√©quences de protocoles :

* ncacn\_ip\_tcp et ncadg\_ip\_udp (port TCP et UDP 135)
* ncacn\_np (le pipe nomm√© \pipe\epmapper via SMB)
* ncacn\_http (RPC sur HTTP via le port TCP 80, 593 et autres)
```bash
use auxiliary/scanner/dcerpc/endpoint_mapper
use auxiliary/scanner/dcerpc/hidden
use auxiliary/scanner/dcerpc/management
use auxiliary/scanner/dcerpc/tcp_dcerpc_auditor
rpcdump.py <IP> -p 135
```
_Notez que de toutes les options mentionn√©es, seule **`tcp_dcerpc_auditor`** ne peut √™tre ex√©cut√©e que contre **msrpc** sur le port 135._

#### Interfaces RPC notables

| **Valeur IFID**                      | **Named pipe** | **Description**                                                                                                                                                                                                                                                                           |
| ------------------------------------ | -------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 12345778-1234-abcd-ef00-0123456789ab | \pipe\lsarpc   | Interface LSA, utilis√©e pour √©num√©rer les utilisateurs                                                                                                                                                                                                                                    |
| 3919286a-b10c-11d0-9ba8-00c04fd92ef5 | \pipe\lsarpc   | Interface LSA Directory Services (DS), utilis√©e pour √©num√©rer les domaines et les relations de confiance                                                                                                                                                                                   |
| 12345778-1234-abcd-ef00-0123456789ac | \pipe\samr     | Interface LSA SAMR, utilis√©e pour acc√©der aux √©l√©ments publics de la base de donn√©es SAM (par exemple, les noms d'utilisateur) et pour forcer les mots de passe des utilisateurs ind√©pendamment de la politique de verrouillage de compte [biblioth√®que Oreilly](https://learning.oreilly.com/library/view/network-security-assessment/9781491911044/ch08.html#idm139659172852688) |
| 1ff70682-0a51-30e8-076d-740be8cee98b | \pipe\atsvc    | Planificateur de t√¢ches, utilis√© pour ex√©cuter des commandes √† distance                                                                                                                                                                                                                    |
| 338cd001-2244-31f1-aaaa-900038001003 | \pipe\winreg   | Service de registre √† distance, utilis√© pour acc√©der au registre syst√®me                                                                                                                                                                                                                    |
| 367abb81-9844-35f1-ad32-98f038001003 | \pipe\svcctl   | Gestionnaire de services et services de serveur, utilis√© pour d√©marrer et arr√™ter des services √† distance et ex√©cuter des commandes                                                                                                                                                        |
| 4b324fc8-1670-01d3-1278-5a47bf6ee188 | \pipe\srvsvc   | Gestionnaire de services et services de serveur, utilis√© pour d√©marrer et arr√™ter des services √† distance et ex√©cuter des commandes                                                                                                                                                        |
| 4d9f4ab8-7d1c-11cf-861e-0020af6e7c57 | \pipe\epmapper | Interface DCOM, prenant en charge WMI                                                                                                                                                                                                                                                      |

### Identification des adresses IP

En utilisant [https://github.com/mubix/IOXIDResolver](https://github.com/mubix/IOXIDResolver), qui provient de la recherche d'Airbus, il est possible d'abuser de la m√©thode _**ServerAlive2**_ √† l'int√©rieur de l'interface _**IOXIDResolver**_.

Cette m√©thode a √©t√© utilis√©e pour obtenir des informations d'interface telles que l'adresse **IPv6** de la bo√Æte HTB _APT_. Voir [ici](https://0xdf.gitlab.io/2021/04/10/htb-apt.html) pour le writeup APT de 0xdf, qui inclut une m√©thode alternative utilisant rpcmap.py de [Impacket](https://github.com/SecureAuthCorp/impacket/) avec _stringbinding_ (voir ci-dessus).

R√©f√©rences :

* [https://www.cyber.airbus.com/the-oxid-resolver-part-1-remote-enumeration-of-network-interfaces-without-any-authentication/](https://www.cyber.airbus.com/the-oxid-resolver-part-1-remote-enumeration-of-network-interfaces-without-any-authentication/)
* [https://www.cyber.airbus.com/the-oxid-resolver-part-2-accessing-a-remote-object-inside-dcom/](https://www.cyber.airbus.com/the-oxid-resolver-part-2-accessing-a-remote-object-inside-dcom/)

## Port 593

Le **rpcdump.exe** de [rpctools](https://resources.oreilly.com/examples/9780596510305/tree/master/tools/rpctools) peut interagir avec ce port.

‚Äã

<figure><img src="../.gitbook/assets/image (7) (2).png" alt=""><figcaption></figcaption></figure>

[**Suivez HackenProof**](https://bit.ly/3xrrDrL) **pour en savoir plus sur les bugs web3**

üêû Lisez les tutoriels sur les bugs web3

üîî Soyez inform√© des nouveaux programmes de primes pour bugs

üí¨ Participez aux discussions de la communaut√©

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Travaillez-vous dans une **entreprise de cybers√©curit√©** ? Voulez-vous voir votre **entreprise annonc√©e dans HackTricks** ? ou voulez-vous avoir acc√®s √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**üí¨**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR au** [**repo hacktricks**](https://github.com/carlospolop/hacktricks) **et au** [**repo hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
