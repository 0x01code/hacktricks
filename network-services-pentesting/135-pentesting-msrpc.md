# 135, 593 - MSRPC의 Pentesting

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>를 통해 AWS 해킹을 처음부터 전문가까지 배워보세요<strong>!</strong></summary>

HackTricks를 지원하는 다른 방법:

* **회사를 HackTricks에서 광고하거나 HackTricks를 PDF로 다운로드**하려면 [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)를 확인하세요!
* [**공식 PEASS & HackTricks 스웨그**](https://peass.creator-spring.com)를 얻으세요.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)를 발견하세요. 독점적인 [**NFTs**](https://opensea.io/collection/the-peass-family) 컬렉션입니다.
* 💬 [**Discord 그룹**](https://discord.gg/hRep4RUj7f) 또는 [**텔레그램 그룹**](https://t.me/peass)에 **참여**하거나 **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)**를** **팔로우**하세요.
* **Hacking Tricks를 공유하려면 PR을** [**HackTricks**](https://github.com/carlospolop/hacktricks) **및** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **github 저장소에 제출**하세요.

</details>

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

경험있는 해커와 버그 바운티 헌터와 소통하기 위해 [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) 서버에 가입하세요!

**해킹 통찰력**\
해킹의 스릴과 도전에 대해 자세히 알아보는 콘텐츠와 상호 작용하세요.

**실시간 해킹 뉴스**\
실시간 뉴스와 통찰력을 통해 빠르게 변화하는 해킹 세계를 따라가세요.

**최신 공지사항**\
새로운 버그 바운티 출시 및 중요한 플랫폼 업데이트에 대해 최신 정보를 받아보세요.

**[Discord](https://discord.com/invite/N3FrSbmwdy)에 참여하여 최고의 해커들과 협업을 시작하세요!**

## 기본 정보

Microsoft 원격 프로시저 호출(MSRPC) 프로토콜은 클라이언트-서버 모델로, 네트워크의 세부 사항을 이해하지 않고 다른 컴퓨터에 위치한 프로그램으로부터 서비스를 요청할 수 있게 해주는 프로토콜입니다. 이 프로토콜은 원래 오픈 소스 소프트웨어에서 파생되었으며, 후에 Microsoft에서 개발 및 저작권을 취득했습니다.

RPC 엔드포인트 매퍼는 TCP 및 UDP 포트 135를 통해 액세스할 수 있으며, TCP 139 및 445에서 SMB(인증되지 않은 또는 인증된 세션)으로 액세스할 수 있으며, TCP 포트 593에서 웹 서비스로 사용할 수 있습니다.
```
135/tcp   open     msrpc         Microsoft Windows RPC
```
## MSRPC는 어떻게 작동하나요?

클라이언트 응용 프로그램에 의해 시작되는 MSRPC 프로세스는 로컬 스텁 프로시저를 호출하여 클라이언트 런타임 라이브러리와 상호 작용하여 요청을 서버로 준비하고 전송하는 것을 포함합니다. 이 과정에는 매개 변수를 표준 네트워크 데이터 표현 형식으로 변환하는 것도 포함됩니다. 전송 프로토콜의 선택은 서버가 원격인 경우 런타임 라이브러리에 의해 결정되며, RPC가 네트워크 스택을 통해 전달되도록 보장합니다.

![https://0xffsec.com/handbook/images/msrpc.png](https://0xffsec.com/handbook/images/msrpc.png)

## **노출된 RPC 서비스 식별하기**

RPC 로케이터 서비스와 개별 엔드포인트를 쿼리함으로써 TCP, UDP, HTTP 및 SMB를 통한 RPC 서비스의 노출 여부를 확인할 수 있습니다. rpcdump와 같은 도구를 사용하여 고유한 RPC 서비스(IFID 값으로 표시됨)를 식별할 수 있으며, 이를 통해 서비스 세부 정보와 통신 바인딩을 확인할 수 있습니다:
```
D:\rpctools> rpcdump [-p port] <IP>
**IFID**: 5a7b91f8-ff00-11d0-a9b2-00c04fb6e6fc version 1.0
Annotation: Messenger Service
UUID: 00000000-0000-0000-0000-000000000000
Binding: ncadg_ip_udp:<IP>[1028]
```
RPC 로케이터 서비스에 대한 액세스는 특정 프로토콜을 통해 활성화됩니다: 포트 135를 통한 액세스를 위한 ncacn\_ip\_tcp 및 ncadg\_ip\_udp, SMB 연결을 위한 ncacn\_np, 웹 기반 RPC 통신을 위한 ncacn\_http. 다음 명령은 Metasploit 모듈을 사용하여 MSRPC 서비스를 감사하고 상호 작용하는 예시입니다. 주로 포트 135에 초점을 맞춥니다:
```bash
use auxiliary/scanner/dcerpc/endpoint_mapper
use auxiliary/scanner/dcerpc/hidden
use auxiliary/scanner/dcerpc/management
use auxiliary/scanner/dcerpc/tcp_dcerpc_auditor
rpcdump.py <IP> -p 135
```
`tcp_dcerpc_auditor`를 제외한 모든 옵션은 포트 135의 MSRPC를 대상으로 특별히 설계되었습니다.

#### 주목할만한 RPC 인터페이스

* **IFID**: 12345778-1234-abcd-ef00-0123456789ab
* **Named Pipe**: `\pipe\lsarpc`
* **Description**: 사용자를 열거하는 데 사용되는 LSA 인터페이스입니다.


* **IFID**: 3919286a-b10c-11d0-9ba8-00c04fd92ef5
* **Named Pipe**: `\pipe\lsarpc`
* **Description**: 도메인 및 신뢰 관계를 열거하는 데 사용되는 LSA 디렉터리 서비스(DS) 인터페이스입니다.


* **IFID**: 12345778-1234-abcd-ef00-0123456789ac
* **Named Pipe**: `\pipe\samr`
* **Description**: 계정 잠금 정책과 관계없이 공개 SAM 데이터베이스 요소(예: 사용자 이름)에 액세스하고 사용자 암호를 무차별 대입하는 데 사용되는 LSA SAMR 인터페이스입니다.


* **IFID**: 1ff70682-0a51-30e8-076d-740be8cee98b
* **Named Pipe**: `\pipe\atsvc`
* **Description**: 원격으로 명령을 실행하는 데 사용되는 작업 스케줄러입니다.


* **IFID**: 338cd001-2244-31f1-aaaa-900038001003
* **Named Pipe**: `\pipe\winreg`
* **Description**: 시스템 레지스트리에 액세스하고 수정하는 데 사용되는 원격 레지스트리 서비스입니다.


* **IFID**: 367abb81-9844-35f1-ad32-98f038001003
* **Named Pipe**: `\pipe\svcctl`
* **Description**: 서비스 제어 관리자 및 서버 서비스를 원격으로 시작하고 중지하며 명령을 실행하는 데 사용됩니다.


* **IFID**: 4b324fc8-1670-01d3-1278-5a47bf6ee188
* **Named Pipe**: `\pipe\srvsvc`
* **Description**: 서비스 제어 관리자 및 서버 서비스를 원격으로 시작하고 중지하며 명령을 실행하는 데 사용됩니다.


* **IFID**: 4d9f4ab8-7d1c-11cf-861e-0020af6e7c57
* **Named Pipe**: `\pipe\epmapper`
* **Description**: DCOM 인터페이스로, 암호 대입 및 정보 수집을 위해 WM을 통해 사용됩니다.

### IP 주소 식별

[https://github.com/mubix/IOXIDResolver](https://github.com/mubix/IOXIDResolver)를 사용하여 _**IOXIDResolver**_ 인터페이스 내부의 _**ServerAlive2**_ 메서드를 악용할 수 있습니다.

이 방법은 HTB 상자 _APT_에서 **IPv6** 주소와 같은 인터페이스 정보를 얻는 데 사용되었습니다. 0xdf의 APT writeup인 [여기](https://0xdf.gitlab.io/2021/04/10/htb-apt.html)에서는 rpcmap.py를 사용하여 _stringbinding_을 통해 대체 방법을 제공합니다.

## 포트 593

[rpctools](https://resources.oreilly.com/examples/9780596510305/tree/master/tools/rpctools)의 **rpcdump.exe**를 이 포트와 상호 작용할 수 있습니다.

#​# 참고 자료
* [https://www.cyber.airbus.com/the-oxid-resolver-part-1-remote-enumeration-of-network-interfaces-without-any-authentication/](https://www.cyber.airbus.com/the-oxid-resolver-part-1-remote-enumeration-of-network-interfaces-without-any-authentication/)
* [https://www.cyber.airbus.com/the-oxid-resolver-part-2-accessing-a-remote-object-inside-dcom/](https://www.cyber.airbus.com/the-oxid-resolver-part-2-accessing-a-remote-object-inside-dcom/)
* [https://0xffsec.com/handbook/services/msrpc/](https://0xffsec.com/handbook/services/msrpc/)

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

경험 많은 해커와 버그 바운티 헌터와 소통하려면 [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) 서버에 참여하세요!

**해킹 통찰력**\
해킹의 스릴과 도전을 다루는 콘텐츠에 참여하세요.

**실시간 해킹 뉴스**\
실시간 뉴스와 통찰력을 통해 빠르게 변화하는 해킹 세계를 따라가세요.

**최신 공지사항**\
새로운 버그 바운티 출시 및 중요한 플랫폼 업데이트에 대한 정보를 받아보세요.

**오늘 바로** [**Discord**](https://discord.com/invite/N3FrSbmwdy) **에 가입하여 최고의 해커들과 협업을 시작하세요!**

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>를 통해 AWS 해킹을 처음부터 전문가까지 배워보세요!</summary>

HackTricks를 지원하는 다른 방법:

* 회사를 **HackTricks에서 광고**하거나 **PDF로 HackTricks 다운로드**하려면 [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)를 확인하세요!
* [**공식 PEASS & HackTricks 스웨그**](https://peass.creator-spring.com)를 구매하세요.
* 독점적인 [**NFT**](https://opensea.io/collection/the-peass-family) 컬렉션인 [**The PEASS Family**](https://opensea.io/collection/the-peass-family)를 발견하세요.
* 💬 [**Discord 그룹**](https://discord.gg/hRep4RUj7f) 또는 [**텔레그램 그룹**](https://t.me/peass)에 가입하거나 **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)를 팔로우하세요.
* **HackTricks**와 **HackTricks Cloud** github 저장소에 PR을 제출하여 여러분의 해킹 기법을 공유하세요.

</details>
