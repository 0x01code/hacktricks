# 135, 593 - Pentesting MSRPC

<details>

<summary><strong>Leer AWS-hacking van nul tot held met</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Ander maniere om HackTricks te ondersteun:

* As jy jou **maatskappy geadverteer wil sien in HackTricks** of **HackTricks in PDF wil aflaai**, kyk na die [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Kry die [**amptelike PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ontdek [**The PEASS Family**](https://opensea.io/collection/the-peass-family), ons versameling eksklusiewe [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Deel jou hacking-truuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-repos.

</details>

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

Sluit aan by die [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) bediener om te kommunikeer met ervare hackers en foutjagters!

**Hacking-insigte**\
Raak betrokke by inhoud wat die opwinding en uitdagings van hacking ondersoek

**Hack-nuus in werklikheid**\
Bly op hoogte van die vinnige w√™reld van hacking deur middel van werklike nuus en insigte

**Nuutste aankondigings**\
Bly ingelig met die nuutste foutjagbountes wat begin en belangrike platform-opdaterings

**Sluit aan by ons op** [**Discord**](https://discord.com/invite/N3FrSbmwdy) en begin vandag saamwerk met top hackers!

## Basiese Inligting

Die Microsoft Remote Procedure Call (MSRPC) protokol, 'n klient-bedienermodel wat 'n program in staat stel om 'n diens van 'n program op 'n ander rekenaar aan te vra sonder om die spesifieke netwerk te verstaan, is aanvanklik afgelei van oopbron sagteware en later ontwikkel en gekopieer deur Microsoft.

Die RPC-eindpuntkartering kan benader word via TCP- en UDP-poort 135, SMB op TCP 139 en 445 (met 'n nul- of geauthentiseerde sessie), en as 'n webdiens op TCP-poort 593.
```
135/tcp   open     msrpc         Microsoft Windows RPC
```
## Hoe werk MSRPC?

Ge√Ønitieer deur die kli√´nttoepassing, behels die MSRPC-proses die oproep van 'n plaaslike stub-prosedure wat dan interaksie h√™ met die kli√´nt-runtime-biblioteek om die versoek voor te berei en oor te dra na die bediener. Dit sluit in die omskakeling van parameters na 'n standaard Netwerkdata-voorstelling-formaat. Die keuse van vervoerprotokol word bepaal deur die runtime-biblioteek as die bediener afgele√´ is, om te verseker dat die RPC deur die netwerkstapel afgelewer word.

![https://0xffsec.com/handbook/images/msrpc.png](https://0xffsec.com/handbook/images/msrpc.png)

## **Identifisering van Blootgestelde RPC-dienste**

Die blootstelling van RPC-dienste oor TCP, UDP, HTTP en SMB kan bepaal word deur die RPC-lokator-diens en individuele eindpunte te ondervra. Hulpmiddels soos rpcdump fasiliteer die identifisering van unieke RPC-dienste, aangedui deur **IFID**-waardes, wat diensbesonderhede en kommunikasiebindings openbaar:
```
D:\rpctools> rpcdump [-p port] <IP>
**IFID**: 5a7b91f8-ff00-11d0-a9b2-00c04fb6e6fc version 1.0
Annotation: Messenger Service
UUID: 00000000-0000-0000-0000-000000000000
Binding: ncadg_ip_udp:<IP>[1028]
```
Toegang tot die RPC-lokator-diens is moontlik deur spesifieke protokolle: ncacn\_ip\_tcp en ncadg\_ip\_udp vir toegang via poort 135, ncacn\_np vir SMB-verbindings, en ncacn\_http vir webgebaseerde RPC-kommunikasie. Die volgende opdragte illustreer die gebruik van Metasploit-modules om MSRPC-dienste te oudit en mee te skakel, met die klem op poort 135:
```bash
use auxiliary/scanner/dcerpc/endpoint_mapper
use auxiliary/scanner/dcerpc/hidden
use auxiliary/scanner/dcerpc/management
use auxiliary/scanner/dcerpc/tcp_dcerpc_auditor
rpcdump.py <IP> -p 135
```
Alle opsies behalwe `tcp_dcerpc_auditor` is spesifiek ontwerp vir die teiken van MSRPC op poort 135.

#### Noemenswaardige RPC-koppelvlakke

* **IFID**: 12345778-1234-abcd-ef00-0123456789ab
* **Genoemde Pyp**: `\pipe\lsarpc`
* **Beskrywing**: LSA-koppelvlak, gebruik om gebruikers op te som.


* **IFID**: 3919286a-b10c-11d0-9ba8-00c04fd92ef5
* **Genoemde Pyp**: `\pipe\lsarpc`
* **Beskrywing**: LSA Directory Services (DS) koppelvlak, gebruik om domeine en vertrouensverhoudings op te som.


* **IFID**: 12345778-1234-abcd-ef00-0123456789ac
* **Genoemde Pyp**: `\pipe\samr`
* **Beskrywing**: LSA SAMR-koppelvlak, gebruik om openbare SAM-databasis-elemente (bv. gebruikersname) en gebruikerswagwoorde te kragtig, ongeag rekeningblokkeringbeleid.


* **IFID**: 1ff70682-0a51-30e8-076d-740be8cee98b
* **Genoemde Pyp**: `\pipe\atsvc`
* **Beskrywing**: Taakbeplanner, gebruik om opdragte op afstand uit te voer.


* **IFID**: 338cd001-2244-31f1-aaaa-900038001003
* **Genoemde Pyp**: `\pipe\winreg`
* **Beskrywing**: Diensbeheerder, gebruik om toegang tot en wysiging van die stelselregister te verkry.


* **IFID**: 367abb81-9844-35f1-ad32-98f038001003
* **Genoemde Pyp**: `\pipe\svcctl`
* **Beskrywing**: Diensbeheerder en bedienerdienste, gebruik om dienste op afstand te begin en te stop en opdragte uit te voer.


* **IFID**: 4b324fc8-1670-01d3-1278-5a47bf6ee188
* **Genoemde Pyp**: `\pipe\srvsvc`
* **Beskrywing**: Diensbeheerder en bedienerdienste, gebruik om dienste op afstand te begin en te stop en opdragte uit te voer.


* **IFID**: 4d9f4ab8-7d1c-11cf-861e-0020af6e7c57
* **Genoemde Pyp**: `\pipe\epmapper`
* **Beskrywing**: DCOM-koppelvlak, gebruik vir kragtige wagwoordkrag en inligtingversameling via WM.

### Identifisering van IP-adresse

Deur [https://github.com/mubix/IOXIDResolver](https://github.com/mubix/IOXIDResolver) te gebruik, afkomstig van [Airbus-navorsing](https://www.cyber.airbus.com/the-oxid-resolver-part-1-remote-enumeration-of-network-interfaces-without-any-authentication/), is dit moontlik om die _**ServerAlive2**_-metode binne die _**IOXIDResolver**_-koppelvlak te misbruik.

Hierdie metode is gebruik om koppelvlakinligting as **IPv6**-adres van die HTB-boks _APT_ te verkry. Sien [hier](https://0xdf.gitlab.io/2021/04/10/htb-apt.html) vir 0xdf APT-verslag, dit sluit 'n alternatiewe metode in wat rpcmap.py van [Impacket](https://github.com/SecureAuthCorp/impacket/) met _stringbinding_ gebruik (sien hierbo).

## Poort 593

Die **rpcdump.exe** van [rpctools](https://resources.oreilly.com/examples/9780596510305/tree/master/tools/rpctools) kan met hierdie poort kommunikeer.

#‚Äã# Verwysings
* [https://www.cyber.airbus.com/the-oxid-resolver-part-1-remote-enumeration-of-network-interfaces-without-any-authentication/](https://www.cyber.airbus.com/the-oxid-resolver-part-1-remote-enumeration-of-network-interfaces-without-any-authentication/)
* [https://www.cyber.airbus.com/the-oxid-resolver-part-2-accessing-a-remote-object-inside-dcom/](https://www.cyber.airbus.com/the-oxid-resolver-part-2-accessing-a-remote-object-inside-dcom/)
* [https://0xffsec.com/handbook/services/msrpc/](https://0xffsec.com/handbook/services/msrpc/)

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

Sluit aan by [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) bediener om met ervare hackers en foutvinders te kommunikeer!

**Hacking Insights**\
Raak betrokke by inhoud wat die opwinding en uitdagings van hackering ondersoek

**Real-Time Hack News**\
Bly op hoogte van die vinnige hackeringw√™reld deur middel van real-time nuus en insigte

**Nuutste Aankondigings**\
Bly ingelig oor die nuutste foutvindings wat bekendgestel word en noodsaaklike platformopdaterings

**Sluit aan by ons op** [**Discord**](https://discord.com/invite/N3FrSbmwdy) en begin vandag saamwerk met top hackers!

<details>

<summary><strong>Leer AWS-hackering van nul tot held met</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Ander maniere om HackTricks te ondersteun:

* As jy wil sien dat jou **maatskappy geadverteer word in HackTricks** of **HackTricks aflaai in PDF-formaat**, kyk na die [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Kry die [**amptelike PEASS & HackTricks-uitrusting**](https://peass.creator-spring.com)
* Ontdek [**The PEASS Family**](https://opensea.io/collection/the-peass-family), ons versameling eksklusiewe [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Deel jou hackeringtruuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-opslag.

</details>
