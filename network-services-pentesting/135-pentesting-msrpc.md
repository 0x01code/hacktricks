# 135, 593 - Pentesting MSRPC

<details>

<summary><strong>Nauƒçite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naƒçini podr≈°ke HackTricks-u:

* Ako ≈æelite da vidite **va≈°u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniƒçni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), na≈°u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridru≈æite se** üí¨ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

Pridru≈æite se [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) serveru kako biste komunicirali sa iskusnim hakerima i lovcima na bagove!

**Hacking Insights**\
Ukljuƒçite se u sadr≈æaj koji istra≈æuje uzbuƒëenje i izazove hakovanja

**Real-Time Hack News**\
Budite u toku sa brzim svetom hakovanja kroz vesti i uvide u realnom vremenu

**Najnovije objave**\
Budite informisani o najnovijim pokretanjima nagrada za pronala≈æenje bagova i va≈ænim a≈æuriranjima platforme

**Pridru≈æite nam se na** [**Discord-u**](https://discord.com/invite/N3FrSbmwdy) i poƒçnite da saraƒëujete sa vrhunskim hakerima danas!

## Osnovne informacije

Microsoft Remote Procedure Call (MSRPC) protokol, model klijent-server koji omoguƒáava programu da zatra≈æi uslugu od programa sme≈°tenog na drugom raƒçunaru, a da ne razume specifiƒçnosti mre≈æe, prvobitno je izveden iz open-source softvera, a kasnije razvijen i za≈°tiƒáen autorskim pravima od strane Microsoft-a.

RPC endpoint mapper se mo≈æe pristupiti putem TCP i UDP porta 135, SMB na TCP portovima 139 i 445 (sa null ili autentifikovanom sesijom), i kao web servis na TCP portu 593.
```
135/tcp   open     msrpc         Microsoft Windows RPC
```
## Kako funkcioni≈°e MSRPC?

Proces MSRPC-a zapoƒçinje klijentska aplikacija koja poziva lokalnu stub proceduru koja zatim komunicira sa bibliotekom klijentskog izvr≈°nog okru≈æenja kako bi pripremila i prenela zahtev serveru. Ovo ukljuƒçuje konvertovanje parametara u standardni format za prikaz mre≈ænih podataka. Izbor transportnog protokola odreƒëuje biblioteka izvr≈°nog okru≈æenja ako je server udaljen, obezbeƒëujuƒái da se RPC dostavi preko mre≈ænog sloja.

![https://0xffsec.com/handbook/images/msrpc.png](https://0xffsec.com/handbook/images/msrpc.png)

## **Identifikacija izlo≈æenih RPC servisa**

Izlo≈æenost RPC servisa putem TCP, UDP, HTTP i SMB mo≈æe se utvrditi upitivanjem servisa za pronala≈æenje RPC-a i pojedinaƒçnih krajnjih taƒçaka. Alati poput rpcdump olak≈°avaju identifikaciju jedinstvenih RPC servisa, oznaƒçenih vrednostima **IFID**, otkrivajuƒái detalje servisa i veze za komunikaciju:
```
D:\rpctools> rpcdump [-p port] <IP>
**IFID**: 5a7b91f8-ff00-11d0-a9b2-00c04fb6e6fc version 1.0
Annotation: Messenger Service
UUID: 00000000-0000-0000-0000-000000000000
Binding: ncadg_ip_udp:<IP>[1028]
```
Pristup RPC locator servisu omoguƒáen je putem odreƒëenih protokola: ncacn\_ip\_tcp i ncadg\_ip\_udp za pristup preko porta 135, ncacn\_np za SMB veze i ncacn\_http za komunikaciju putem web baziranih RPC-a. Sledeƒáe komande ilustruju upotrebu Metasploit modula za proveru i interakciju sa MSRPC uslugama, sa glavnim fokusom na port 135:
```bash
use auxiliary/scanner/dcerpc/endpoint_mapper
use auxiliary/scanner/dcerpc/hidden
use auxiliary/scanner/dcerpc/management
use auxiliary/scanner/dcerpc/tcp_dcerpc_auditor
rpcdump.py <IP> -p 135
```
Sve opcije osim `tcp_dcerpc_auditor` su posebno dizajnirane za ciljanje MSRPC na portu 135.

#### Znaƒçajni RPC interfejsi

* **IFID**: 12345778-1234-abcd-ef00-0123456789ab
* **Imenovana cijev**: `\pipe\lsarpc`
* **Opis**: LSA interfejs, koristi se za enumeraciju korisnika.


* **IFID**: 3919286a-b10c-11d0-9ba8-00c04fd92ef5
* **Imenovana cijev**: `\pipe\lsarpc`
* **Opis**: LSA Directory Services (DS) interfejs, koristi se za enumeraciju domena i odnosa poverenja.


* **IFID**: 12345778-1234-abcd-ef00-0123456789ac
* **Imenovana cijev**: `\pipe\samr`
* **Opis**: LSA SAMR interfejs, koristi se za pristup javnim elementima baze podataka SAM (npr. korisniƒçka imena) i brute-force napad na lozinke korisnika bez obzira na politiku zakljuƒçavanja naloga.


* **IFID**: 1ff70682-0a51-30e8-076d-740be8cee98b
* **Imenovana cijev**: `\pipe\atsvc`
* **Opis**: Task scheduler, koristi se za daljinsko izvr≈°avanje komandi.


* **IFID**: 338cd001-2244-31f1-aaaa-900038001003
* **Imenovana cijev**: `\pipe\winreg`
* **Opis**: Usluga daljinskog registra, koristi se za pristupanje i izmenu sistemskog registra.


* **IFID**: 367abb81-9844-35f1-ad32-98f038001003
* **Imenovana cijev**: `\pipe\svcctl`
* **Opis**: Upravljaƒç uslugama i serverskim uslugama, koristi se za daljinsko pokretanje i zaustavljanje usluga i izvr≈°avanje komandi.


* **IFID**: 4b324fc8-1670-01d3-1278-5a47bf6ee188
* **Imenovana cijev**: `\pipe\srvsvc`
* **Opis**: Upravljaƒç uslugama i serverskim uslugama, koristi se za daljinsko pokretanje i zaustavljanje usluga i izvr≈°avanje komandi.


* **IFID**: 4d9f4ab8-7d1c-11cf-861e-0020af6e7c57
* **Imenovana cijev**: `\pipe\epmapper`
* **Opis**: DCOM interfejs, koristi se za brute-force napad na lozinke i prikupljanje informacija putem WM.

### Identifikacija IP adresa

Kori≈°ƒáenjem [https://github.com/mubix/IOXIDResolver](https://github.com/mubix/IOXIDResolver), koji potiƒçe iz [Airbus istra≈æivanja](https://www.cyber.airbus.com/the-oxid-resolver-part-1-remote-enumeration-of-network-interfaces-without-any-authentication/), moguƒáe je zloupotrebiti metodu _**ServerAlive2**_ unutar interfejsa _**IOXIDResolver**_.

Ova metoda se koristi za dobijanje informacija o interfejsu kao **IPv6** adresa sa HTB boksa _APT_. Pogledajte [ovde](https://0xdf.gitlab.io/2021/04/10/htb-apt.html) za 0xdf APT writeup, koji ukljuƒçuje alternativnu metodu kori≈°ƒáenjem rpcmap.py iz [Impacket](https://github.com/SecureAuthCorp/impacket/) sa _stringbinding_ (vidi gore).

## Port 593

**rpcdump.exe** iz [rpctools](https://resources.oreilly.com/examples/9780596510305/tree/master/tools/rpctools) mo≈æe komunicirati sa ovim portom.

#‚Äã# Reference
* [https://www.cyber.airbus.com/the-oxid-resolver-part-1-remote-enumeration-of-network-interfaces-without-any-authentication/](https://www.cyber.airbus.com/the-oxid-resolver-part-1-remote-enumeration-of-network-interfaces-without-any-authentication/)
* [https://www.cyber.airbus.com/the-oxid-resolver-part-2-accessing-a-remote-object-inside-dcom/](https://www.cyber.airbus.com/the-oxid-resolver-part-2-accessing-a-remote-object-inside-dcom/)
* [https://0xffsec.com/handbook/services/msrpc/](https://0xffsec.com/handbook/services/msrpc/)

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

Pridru≈æite se [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) serveru kako biste komunicirali sa iskusnim hakerima i lovcima na bagove!

**Hacking Insights**\
Ukljuƒçite se u sadr≈æaj koji istra≈æuje uzbuƒëenje i izazove hakovanja.

**Vesti o hakovanju u realnom vremenu**\
Budite u toku sa brzim svetom hakovanja putem vesti i saznanja u realnom vremenu.

**Najnovije objave**\
Budite informisani o najnovijim pokretanjima bug bounty-ja i va≈ænim a≈æuriranjima platforme.

**Pridru≈æite nam se na** [**Discord-u**](https://discord.com/invite/N3FrSbmwdy) i poƒçnite da saraƒëujete sa vrhunskim hakerima danas!

<details>

<summary><strong>Nauƒçite hakovanje AWS-a od poƒçetnika do struƒçnjaka sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naƒçini podr≈°ke HackTricks:

* Ako ≈æelite da vidite **ogla≈°avanje va≈°e kompanije u HackTricks-u** ili **preuzmete HackTricks u PDF formatu**, proverite [**PLANOVE ZA PRIJAVU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniƒçni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), na≈°u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridru≈æite se** üí¨ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje trikove hakovanja slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
