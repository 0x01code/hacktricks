# 135, 593 - Pentesting MSRPC

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Travaillez-vous dans une **entreprise de cybers√©curit√©** ? Voulez-vous voir votre **entreprise annonc√©e dans HackTricks** ? Ou voulez-vous avoir acc√®s √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFT**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**üí¨**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR au** [**repo hacktricks**](https://github.com/carlospolop/hacktricks) **et au** [**repo hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

<figure><img src="../.gitbook/assets/image (1) (3).png" alt=""><figcaption></figcaption></figure>

**HackenProof est la plateforme des primes de bugs cryptographiques.**

**Obtenez des r√©compenses sans d√©lai**\
Les primes HackenProof sont lanc√©es uniquement lorsque les clients d√©posent le budget de r√©compense. Vous recevrez la r√©compense apr√®s la v√©rification du bug.

**Acqu√©rez de l'exp√©rience en pentesting web3**\
Les protocoles blockchain et les contrats intelligents sont le nouvel Internet ! Ma√Ætrisez la s√©curit√© web3 d√®s ses d√©buts.

**Devenez la l√©gende du hacker web3**\
Gagnez des points de r√©putation avec chaque bug v√©rifi√© et conqu√©rez le sommet du classement hebdomadaire.

[**Inscrivez-vous sur HackenProof**](https://hackenproof.com/register) et commencez √† gagner gr√¢ce √† vos piratages !

{% embed url="https://hackenproof.com/register" %}

## Informations de base

Microsoft Remote Procedure Call, √©galement connu sous le nom d'appel de fonction ou d'appel de sous-routine, est [un protocole](http://searchmicroservices.techtarget.com/definition/Remote-Procedure-Call-RPC) qui utilise le mod√®le client-serveur afin de permettre √† un programme de demander un service √† un programme sur un autre ordinateur sans avoir √† comprendre les d√©tails du r√©seau de cet ordinateur. MSRPC a √©t√© initialement d√©riv√© d'un logiciel open source, mais a √©t√© d√©velopp√© et prot√©g√© par des droits d'auteur par Microsoft.

Selon la configuration de l'h√¥te, le gestionnaire de points de terminaison RPC peut √™tre accessible via les ports TCP et UDP 135, via SMB avec une session nulle ou authentifi√©e (TCP 139 et 445), et en tant que service web √©coutant sur le port TCP 593.
```
135/tcp   open     msrpc         Microsoft Windows RPC
```
## Comment fonctionne MSRPC?

[Le processus MSRPC commence c√¥t√© client](https://technet.microsoft.com/en-us/library/cc738291.aspx), avec l'application cliente appelant une proc√©dure locale de stub au lieu du code impl√©mentant la proc√©dure. Le code de stub client r√©cup√®re les param√®tres requis de l'espace d'adressage client et les transmet √† la biblioth√®que d'ex√©cution client, qui traduit ensuite les param√®tres dans un format standard de repr√©sentation des donn√©es r√©seau pour les transmettre au serveur.

Le stub client appelle ensuite les fonctions de la biblioth√®que d'ex√©cution client RPC pour envoyer la demande et les param√®tres au serveur. Si le serveur est situ√© √† distance, la biblioth√®que d'ex√©cution sp√©cifie un protocole de transport appropri√© et un moteur, puis transmet la RPC √† la pile r√©seau pour le transport vers le serveur.\
√Ä partir de l√†: [https://www.extrahop.com/resources/protocols/msrpc/](https://www.extrahop.com/resources/protocols/msrpc/)

![](<../.gitbook/assets/image (133).png>)

**Image tir√©e du livre "**_**Network Security Assesment 3rd Edition**_**"**

## **Identification des services RPC expos√©s**

**Section extraite du livre "**_**Network Security Assesment 3rd Edition**_**"**

Vous pouvez interroger le service de localisation RPC et les points de terminaison RPC individuels pour r√©pertorier les services int√©ressants s'ex√©cutant sur TCP, UDP, HTTP et SMB (via des pipes nomm√©s). Chaque valeur IFID collect√©e lors de ce processus repr√©sente un service RPC (par exemple, 5a7b91f8-ff00-11d0-a9b2-00c04fb6e6fc est l'interface Messenger).

Les utilitaires Windows rpcdump et ifids de Todd Sabin interrogent √† la fois le service de localisation RPC et des points de terminaison RPC sp√©cifiques pour r√©pertorier les valeurs IFID. La syntaxe de rpcdump est la suivante:
```
D:\rpctools> rpcdump [-p port] 192.168.189.1
IfId: 5a7b91f8-ff00-11d0-a9b2-00c04fb6e6fc version 1.0
Annotation: Messenger Service
UUID: 00000000-0000-0000-0000-000000000000
Binding: ncadg_ip_udp:192.168.189.1[1028]
```
Vous pouvez acc√©der au service de localisation RPC en utilisant quatre s√©quences de protocole :

* ncacn\_ip\_tcp et ncadg\_ip\_udp (port TCP et UDP 135)
* ncacn\_np (le pipe nomm√© \pipe\epmapper via SMB)
* ncacn\_http (RPC sur HTTP via le port TCP 80, 593 et autres)
```bash
use auxiliary/scanner/dcerpc/endpoint_mapper
use auxiliary/scanner/dcerpc/hidden
use auxiliary/scanner/dcerpc/management
use auxiliary/scanner/dcerpc/tcp_dcerpc_auditor
rpcdump.py <IP> -p 135
```
_Notez que parmi les options mentionn√©es, toutes sauf **`tcp_dcerpc_auditor`** peuvent √™tre ex√©cut√©es uniquement contre **msrpc** sur le port **135**._

#### Interfaces RPC notables

| **Valeur IFID**                      | **Named pipe** | **Description**                                                                                                                                                                                                                                                                           |
| ------------------------------------ | -------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 12345778-1234-abcd-ef00-0123456789ab | \pipe\lsarpc   | Interface LSA, utilis√©e pour √©num√©rer les utilisateurs                                                                                                                                                                                                                                   |
| 3919286a-b10c-11d0-9ba8-00c04fd92ef5 | \pipe\lsarpc   | Interface LSA Directory Services (DS), utilis√©e pour √©num√©rer les domaines et les relations de confiance                                                                                                                                                                                 |
| 12345778-1234-abcd-ef00-0123456789ac | \pipe\samr     | Interface LSA SAMR, utilis√©e pour acc√©der aux √©l√©ments publics de la base de donn√©es SAM (par exemple, les noms d'utilisateur) et pour forcer les mots de passe des utilisateurs ind√©pendamment de la politique de verrouillage des comptes [Biblioth√®que Oreilly](https://learning.oreilly.com/library/view/network-security-assessment/9781491911044/ch08.html#idm139659172852688) |
| 1ff70682-0a51-30e8-076d-740be8cee98b | \pipe\atsvc    | Planificateur de t√¢ches, utilis√© pour ex√©cuter des commandes √† distance                                                                                                                                                                                                                   |
| 338cd001-2244-31f1-aaaa-900038001003 | \pipe\winreg   | Service de registre distant, utilis√© pour acc√©der au registre syst√®me                                                                                                                                                                                                                     |
| 367abb81-9844-35f1-ad32-98f038001003 | \pipe\svcctl   | Gestionnaire de contr√¥le de service et services de serveur, utilis√© pour d√©marrer et arr√™ter des services √† distance et ex√©cuter des commandes                                                                                                                                              |
| 4b324fc8-1670-01d3-1278-5a47bf6ee188 | \pipe\srvsvc   | Gestionnaire de contr√¥le de service et services de serveur, utilis√© pour d√©marrer et arr√™ter des services √† distance et ex√©cuter des commandes                                                                                                                                              |
| 4d9f4ab8-7d1c-11cf-861e-0020af6e7c57 | \pipe\epmapper | Interface DCOM, prenant en charge WMI                                                                                                                                                                                                                                                     |

### Identification des adresses IP

En utilisant [https://github.com/mubix/IOXIDResolver](https://github.com/mubix/IOXIDResolver), provenant de [la recherche d'Airbus](https://www.cyber.airbus.com/the-oxid-resolver-part-1-remote-enumeration-of-network-interfaces-without-any-authentication/), il est possible d'exploiter la m√©thode _**ServerAlive2**_ √† l'int√©rieur de l'interface _**IOXIDResolver**_.

Cette m√©thode a √©t√© utilis√©e pour obtenir des informations d'interface sous forme d'adresse **IPv6** √† partir de la machine HTB _APT_. Voir [ici](https://0xdf.gitlab.io/2021/04/10/htb-apt.html) pour le rapport APT de 0xdf, qui inclut une m√©thode alternative utilisant rpcmap.py d'[Impacket](https://github.com/SecureAuthCorp/impacket/) avec _stringbinding_ (voir ci-dessus).

R√©f√©rences :

* [https://www.cyber.airbus.com/the-oxid-resolver-part-1-remote-enumeration-of-network-interfaces-without-any-authentication/](https://www.cyber.airbus.com/the-oxid-resolver-part-1-remote-enumeration-of-network-interfaces-without-any-authentication/)
* [https://www.cyber.airbus.com/the-oxid-resolver-part-2-accessing-a-remote-object-inside-dcom/](https://www.cyber.airbus.com/the-oxid-resolver-part-2-accessing-a-remote-object-inside-dcom/)

## Port 593

Le **rpcdump.exe** de [rpctools](https://resources.oreilly.com/examples/9780596510305/tree/master/tools/rpctools) peut interagir avec ce port.

‚Äã

<figure><img src="../.gitbook/assets/image (1) (3).png" alt=""><figcaption></figcaption></figure>

**HackenProof est la plateforme des primes pour les bugs de cryptographie.**

**Obtenez des r√©compenses sans d√©lai**\
Les primes HackenProof sont lanc√©es uniquement lorsque les clients d√©posent le budget de r√©compense. Vous recevrez la r√©compense apr√®s la v√©rification du bogue.

**Acqu√©rez de l'exp√©rience en pentest web3**\
Les protocoles blockchain et les contrats intelligents sont le nouvel Internet ! Ma√Ætrisez la s√©curit√© web3 d√®s ses d√©buts.

**Devenez une l√©gende du hacking web3**\
Gagnez des points de r√©putation avec chaque bogue v√©rifi√© et conqu√©rez le sommet du classement hebdomadaire.

[**Inscrivez-vous sur HackenProof**](https://hackenproof.com/register) et commencez √† gagner gr√¢ce √† vos hacks !

{% embed url="https://hackenproof.com/register" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Vous travaillez dans une **entreprise de cybers√©curit√©** ? Vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ? ou souhaitez-vous avoir acc√®s √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**üí¨**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR au** [**repo hacktricks**](https://github.com/carlospolop/hacktricks) **et au** [**repo hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
