# 135, 593 - Ελέγχος Πέντε MSRPC

<details>

<summary><strong>Μάθετε το χάκινγκ στο AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Ειδικός Ερυθρού Συνεργείου AWS του HackTricks)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι υποστήριξης του HackTricks:

* Αν θέλετε να δείτε την **εταιρεία σας διαφημισμένη στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**την Οικογένεια PEASS**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε στη** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στη [**ομάδα τηλεγραφήματος**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Μοιραστείτε τα χάκινγκ κόλπα σας υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

Συμμετέχετε στον [**Διακομιστή Discord του HackenProof**](https://discord.com/invite/N3FrSbmwdy) για να επικοινωνήσετε με έμπειρους χάκερ και κυνηγούς ευρημάτων ασφαλείας!

**Εισαγωγή στο Χάκινγκ**\
Ασχοληθείτε με περιεχόμενο που εξετάζει την αγωνία και τις προκλήσεις του χάκινγκ

**Ειδήσεις Χάκινγκ σε Πραγματικό Χρόνο**\
Μείνετε ενήμεροι με τον γρήγορο κόσμο του χάκινγκ μέσω ειδήσεων και αναλύσεων σε πραγματικό χρόνο

**Τελευταίες Ανακοινώσεις**\
Μείνετε ενήμεροι με τις νεότερες εκκινήσεις ευρημάτων ευπρεπούς και κρίσιμες ενημερώσεις πλατφόρμας

**Ελάτε στο** [**Discord**](https://discord.com/invite/N3FrSbmwdy) και αρχίστε να συνεργάζεστε με κορυφαίους χάκερ σήμερα! 

## Βασικές Πληροφορίες

Το πρωτόκολλο Microsoft Remote Procedure Call (MSRPC), ένα μοντέλο πελάτη-εξυπηρετητή που επιτρέπει σε ένα πρόγραμμα να ζητήσει μια υπηρεσία από ένα πρόγραμμα που βρίσκεται σε άλλο υπολογιστή χωρίς να κατανοεί τις λεπτομέρειες του δικτύου, προήλθε αρχικά από λογισμικό ανοιχτού κώδικα και αργότερα αναπτύχθηκε και προστατεύτηκε με πνευματικά δικαιώματα από τη Microsoft.

Ο εξυπηρετητής του RPC endpoint μπορεί να προσπελαστεί μέσω των θυρών TCP και UDP 135, SMB στις θύρες TCP 139 και 445 (με μια κενή ή ταυτοποιημένη συνεδρία) και ως υπηρεσία web στη θύρα TCP 593.
```
135/tcp   open     msrpc         Microsoft Windows RPC
```
## Πώς λειτουργεί το MSRPC;

Εκκινούμενη από την εφαρμογή πελάτη, η διαδικασία MSRPC περιλαμβάνει την κλήση μιας τοπικής διαδικασίας στήλης που στη συνέχεια αλληλεπιδρά με τη βιβλιοθήκη εκτέλεσης πελάτη για την προετοιμασία και τη μετάδοση του αιτήματος στον εξυπηρετητή. Αυτό περιλαμβάνει τη μετατροπή παραμέτρων σε ένα πρότυπο μορφής Αναπαράστασης Δεδομένων Δικτύου. Η επιλογή πρωτοκόλλου μεταφοράς καθορίζεται από τη βιβλιοθήκη εκτέλεσης εάν ο εξυπηρετητής είναι απομακρυσμένος, εξασφαλίζοντας ότι το RPC παραδίδεται μέσω του σωρού δικτύου.

![https://0xffsec.com/handbook/images/msrpc.png](https://0xffsec.com/handbook/images/msrpc.png)

## **Αναγνώριση Εκτεθειμένων Υπηρεσιών RPC**

Η εκθεση των υπηρεσιών RPC μέσω TCP, UDP, HTTP και SMB μπορεί να καθοριστεί με την ερώτηση της υπηρεσίας εντοπισμού RPC και των μεμονωμένων σημείων άκρων. Εργαλεία όπως το rpcdump διευκολύνουν την αναγνώριση μοναδικών υπηρεσιών RPC, που σημειώνονται με τιμές **IFID**, αποκαλύπτοντας λεπτομέρειες υπηρεσίας και συνδέσεις επικοινωνίας:
```
D:\rpctools> rpcdump [-p port] <IP>
**IFID**: 5a7b91f8-ff00-11d0-a9b2-00c04fb6e6fc version 1.0
Annotation: Messenger Service
UUID: 00000000-0000-0000-0000-000000000000
Binding: ncadg_ip_udp:<IP>[1028]
```
Η πρόσβαση στην υπηρεσία εντοπισμού RPC είναι ενεργοποιημένη μέσω συγκεκριμένων πρωτοκόλλων: ncacn_ip_tcp και ncadg_ip_udp για πρόσβαση μέσω θύρας 135, ncacn_np για συνδέσεις SMB, και ncacn_http για επικοινωνία RPC μέσω ιστού. Οι παρακάτω εντολές επιδεικνύουν τη χρήση των ενοτήτων του Metasploit για ελέγχους και αλληλεπίδραση με τις υπηρεσίες MSRPC, εστιάζοντας κυρίως στη θύρα 135:
```bash
use auxiliary/scanner/dcerpc/endpoint_mapper
use auxiliary/scanner/dcerpc/hidden
use auxiliary/scanner/dcerpc/management
use auxiliary/scanner/dcerpc/tcp_dcerpc_auditor
rpcdump.py <IP> -p 135
```
Όλες οι επιλογές εκτός από το `tcp_dcerpc_auditor` είναι σχεδιασμένες ειδικά για την επίθεση στο MSRPC στη θύρα 135.

#### Σημαντικές διεπαφές RPC

* **IFID**: 12345778-1234-abcd-ef00-0123456789ab
* **Named Pipe**: `\pipe\lsarpc`
* **Περιγραφή**: Διεπαφή LSA, χρησιμοποιείται για την απαρίθμηση χρηστών.


* **IFID**: 3919286a-b10c-11d0-9ba8-00c04fd92ef5
* **Named Pipe**: `\pipe\lsarpc`
* **Περιγραφή**: Διεπαφή υπηρεσιών καταλόγου LSA (DS), χρησιμοποιείται για την απαρίθμηση τομέων και σχέσεων εμπιστοσύνης.


* **IFID**: 12345778-1234-abcd-ef00-0123456789ac
* **Named Pipe**: `\pipe\samr`
* **Περιγραφή**: Διεπαφή LSA SAMR, χρησιμοποιείται για την πρόσβαση σε στοιχεία δημόσιας βάσης δεδομένων SAM (π.χ., ονόματα χρηστών) και για την εκτέλεση επίθεσης brute-force στους κωδικούς πρόσβασης χρηστών ανεξάρτητα από την πολιτική κλειδώματος λογαριασμού.


* **IFID**: 1ff70682-0a51-30e8-076d-740be8cee98b
* **Named Pipe**: `\pipe\atsvc`
* **Περιγραφή**: Προγραμματιστής εργασιών, χρησιμοποιείται για την απομακρυσμένη εκτέλεση εντολών.


* **IFID**: 338cd001-2244-31f1-aaaa-900038001003
* **Named Pipe**: `\pipe\winreg`
* **Περιγραφή**: Υπηρεσία απομακρυσμένης καταχώρησης, χρησιμοποιείται για την πρόσβαση και τροποποίηση του μητρώου του συστήματος.


* **IFID**: 367abb81-9844-35f1-ad32-98f038001003
* **Named Pipe**: `\pipe\svcctl`
* **Περιγραφή**: Διαχειριστής ελέγχου υπηρεσιών και υπηρεσίες εξυπηρέτησης, χρησιμοποιείται για την απομακρυσμένη εκκίνηση και διακοπή υπηρεσιών και την εκτέλεση εντολών.


* **IFID**: 4b324fc8-1670-01d3-1278-5a47bf6ee188
* **Named Pipe**: `\pipe\srvsvc`
* **Περιγραφή**: Διαχειριστής ελέγχου υπηρεσιών και υπηρεσίες εξυπηρέτησης, χρησιμοποιείται για την απομακρυσμένη εκκίνηση και διακοπή υπηρεσιών και την εκτέλεση εντολών.


* **IFID**: 4d9f4ab8-7d1c-11cf-861e-0020af6e7c57
* **Named Pipe**: `\pipe\epmapper`
* **Περιγραφή**: Διεπαφή DCOM, χρησιμοποιείται για την επίθεση brute-force στους κωδικούς πρόσβασης και τη συλλογή πληροφοριών μέσω του WM.

### Αναγνώριση διευθύνσεων IP

Χρησιμοποιώντας το [https://github.com/mubix/IOXIDResolver](https://github.com/mubix/IOXIDResolver), προέρχεται από την έρευνα της Airbus, είναι δυνατό να καταχραστείτε τη μέθοδο _**ServerAlive2**_ μέσα στη διεπαφή _**IOXIDResolver**_.

Αυτή η μέθοδος έχει χρησιμοποιηθεί για να λάβει πληροφορίες διεπαφής ως διεύθυνση **IPv6** από το HTB box _APT_. Δείτε [εδώ](https://0xdf.gitlab.io/2021/04/10/htb-apt.html) το άρθρο του 0xdf για το APT, περιλαμβάνει μια εναλλακτική μέθοδο χρησιμοποιώντας το rpcmap.py από το [Impacket](https://github.com/SecureAuthCorp/impacket/) με _stringbinding_ (δείτε παραπάνω).

### Εκτέλεση RCE με έγκυρα διαπιστευτήρια

Είναι δυνατό να εκτελεστεί απομακρυσμένος κώδικας σε μια μηχανή, εάν τα διαπιστευτήρια ενός έγκυρου χρήστη είναι διαθέσιμα χρησιμοποιώντας το [dcomexec.py](https://github.com/fortra/impacket/blob/master/examples/dcomexec.py) από το πλαίσιο impacket.

**Θυμηθείτε να δοκιμάσετε με τα διαφορετικά διαθέσιμα αντικείμενα**
* ShellWindows
* ShellBrowserWindow
* MMC20


## Θύρα 593

Το **rpcdump.exe** από [rpctools](https://resources.oreilly.com/examples/9780596510305/tree/master/tools/rpctools) μπορεί να αλληλεπιδράσει με αυτήν τη θύρα.

## Αναφορές
* [https://www.cyber.airbus.com/the-oxid-resolver-part-1-remote-enumeration-of-network-interfaces-without-any-authentication/](https://www.cyber.airbus.com/the-oxid-resolver-part-1-remote-enumeration-of-network-interfaces-without-any-authentication/)
* [https://www.cyber.airbus.com/the-oxid-resolver-part-2-accessing-a-remote-object-inside-dcom/](https://www.cyber.airbus.com/the-oxid-resolver-part-2-accessing-a-remote-object-inside-dcom/)
* [https://0xffsec.com/handbook/services/msrpc/](https://0xffsec.com/handbook/services/msrpc/)

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

Συμμετέχετε στο [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) server για επικοινωνία με έμπειρους χάκερ και κυνηγούς ευρημάτων ασφαλείας!

**Εισαγωγές Χάκερ**\
Ασχοληθείτε με περιεχόμενο που εξερευνά την αγωνία και τις προκλήσεις του χάκινγκ

**Ειδήσεις Χάκερ σε Πραγματικό Χρόνο**\
Μείνετε ενημερωμένοι με τον γρήγορο ρυθμό του κόσμου του χάκινγκ μέσω ειδήσεων και αναλύσεων σε πραγματικό χρόνο

**Τελευταίες Ανακοινώσεις**\
Μείνετε ενήμεροι με τις νεότερες ανακοινώσεις για νέες αμοιβές ευρημάτων και κρίσιμες ενημερώσεις πλατφόρμας

**Συμμετέχετε στο** [**Discord**](https://discord.com/invite/N3FrSbmwdy) και αρχίστε τη συνεργασία με κορυφαίους χάκερ σήμερα!

<details>

<summary><strong>Μάθετε το χάκινγκ στο AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι υποστήριξης του HackTricks:

* Εάν θέλετε να δείτε την **εταιρεία σας διαφημισμένη στο HackTricks** ή να **κατεβάσετε το HackTricks σε PDF** ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**την Οικογένεια PEASS**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Συμμετέχετε** 💬 στην **ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα τηλεγράφου**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Μοιραστείτε τα χάκινγκ κόλπα σας υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>
