# 135, 593 - MSRPC Pentesting

<details>

<summary><strong>AWS hacklemeyi sıfırdan kahraman olmak için</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Kırmızı Takım Uzmanı)</strong></a><strong>öğrenin!</strong></summary>

HackTricks'ı desteklemenin diğer yolları:

* **Şirketinizi HackTricks'te reklamını görmek** veya **HackTricks'i PDF olarak indirmek** için [**ABONELİK PLANLARI'na**](https://github.com/sponsors/carlospolop) göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keşfedin, özel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın** veya **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)**'u takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna **PR göndererek paylaşın**.

</details>

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

Deneyimli hackerlar ve ödül avcılarıyla iletişim kurmak için [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) sunucusuna katılın!

**Hacking İçgörüleri**\
Hacking'in heyecanına ve zorluklarına dalmış içeriklerle etkileşim kurun

**Gerçek Zamanlı Hack Haberleri**\
Hızlı tempolu hacking dünyasını gerçek zamanlı haberler ve içgörülerle takip edin

**En Son Duyurular**\
Yeni ödül avları başlatma ve önemli platform güncellemeleri hakkında bilgilendirme alın

**Bize katılın** [**Discord**](https://discord.com/invite/N3FrSbmwdy) ve bugün en iyi hackerlarla işbirliği yapmaya başlayın!

## Temel Bilgiler

Microsoft Remote Procedure Call (MSRPC) protokolü, bir programın ağın ayrıntılarını anlamadan başka bir bilgisayarda bulunan bir programdan hizmet istemesini sağlayan istemci-sunucu modelidir. İlk olarak açık kaynaklı yazılımdan türetilen ve daha sonra Microsoft tarafından geliştirilen ve telif hakkı alınan bir protokoldür.

RPC uç nokta eşlemesi, TCP ve UDP portu 135 üzerinden, TCP 139 ve 445'te SMB (boş veya kimlik doğrulamalı oturumla) ve TCP portu 593'te bir web servisi olarak erişilebilir.
```
135/tcp   open     msrpc         Microsoft Windows RPC
```
## MSRPC nasıl çalışır?

Müşteri uygulaması tarafından başlatılan MSRPC süreci, yerel bir yama prosedürünü çağırmayı içerir. Bu prosedür daha sonra isteği sunucuya iletmek için istemci çalışma zamanı kitaplığıyla etkileşime geçer. Bu, parametreleri standart bir Ağ Veri Temsili formatına dönüştürmeyi içerir. Taşıma protokolü seçimi, sunucu uzaktaysa çalışma zamanı kitaplığı tarafından belirlenir ve RPC'nin ağ yığını üzerinden iletilmesini sağlar.

![https://0xffsec.com/handbook/images/msrpc.png](https://0xffsec.com/handbook/images/msrpc.png)

## **Açığa Çıkarılmış RPC Hizmetlerini Tanımlama**

RPC yer bulucu hizmetini ve bireysel uç noktaları sorgulayarak TCP, UDP, HTTP ve SMB üzerindeki RPC hizmetlerinin açığa çıkarılması belirlenebilir. rpcdump gibi araçlar, **IFID** değerleriyle belirtilen benzersiz RPC hizmetlerinin tanımlanmasını kolaylaştırır ve hizmet ayrıntılarını ve iletişim bağlantılarını ortaya çıkarır.
```
D:\rpctools> rpcdump [-p port] <IP>
**IFID**: 5a7b91f8-ff00-11d0-a9b2-00c04fb6e6fc version 1.0
Annotation: Messenger Service
UUID: 00000000-0000-0000-0000-000000000000
Binding: ncadg_ip_udp:<IP>[1028]
```
RPC yer bulucu hizmetine erişim, belirli protokoller aracılığıyla etkinleştirilir: port 135 üzerinden erişim için ncacn\_ip\_tcp ve ncadg\_ip\_udp, SMB bağlantıları için ncacn\_np ve web tabanlı RPC iletişimi için ncacn\_http. Aşağıdaki komutlar, MSRPC hizmetlerini denetlemek ve etkileşimde bulunmak için Metasploit modüllerinin kullanımını örneklemektedir, öncelikle port 135'e odaklanarak:
```bash
use auxiliary/scanner/dcerpc/endpoint_mapper
use auxiliary/scanner/dcerpc/hidden
use auxiliary/scanner/dcerpc/management
use auxiliary/scanner/dcerpc/tcp_dcerpc_auditor
rpcdump.py <IP> -p 135
```
`tcp_dcerpc_auditor` hariç tüm seçenekler özel olarak 135 numaralı port üzerindeki MSRPC'yi hedef almak için tasarlanmıştır.

#### Önemli RPC arayüzleri

* **IFID**: 12345778-1234-abcd-ef00-0123456789ab
* **Adlandırılmış Pipe**: `\pipe\lsarpc`
* **Açıklama**: Kullanıcıları sıralamak için kullanılan LSA arayüzü.

* **IFID**: 3919286a-b10c-11d0-9ba8-00c04fd92ef5
* **Adlandırılmış Pipe**: `\pipe\lsarpc`
* **Açıklama**: Alanları ve güven ilişkilerini sıralamak için kullanılan LSA Dizin Hizmetleri (DS) arayüzü.

* **IFID**: 12345778-1234-abcd-ef00-0123456789ac
* **Adlandırılmış Pipe**: `\pipe\samr`
* **Açıklama**: Hesap kilitlenme politikasına bakılmaksızın, genel SAM veritabanı öğelerine (örneğin, kullanıcı adları) erişmek ve kullanıcı parolalarını kaba kuvvet saldırısıyla bulmak için kullanılan LSA SAMR arayüzü.

* **IFID**: 1ff70682-0a51-30e8-076d-740be8cee98b
* **Adlandırılmış Pipe**: `\pipe\atsvc`
* **Açıklama**: Komutları uzaktan yürütmek için kullanılan Görev Zamanlayıcısı.

* **IFID**: 338cd001-2244-31f1-aaaa-900038001003
* **Adlandırılmış Pipe**: `\pipe\winreg`
* **Açıklama**: Sistem kayıt defterine erişmek ve değiştirmek için kullanılan Uzaktan kayıt defteri hizmeti.

* **IFID**: 367abb81-9844-35f1-ad32-98f038001003
* **Adlandırılmış Pipe**: `\pipe\svcctl`
* **Açıklama**: Hizmet kontrol yöneticisi ve sunucu hizmetleri, hizmetleri uzaktan başlatmak ve durdurmak, komutları yürütmek için kullanılır.

* **IFID**: 4b324fc8-1670-01d3-1278-5a47bf6ee188
* **Adlandırılmış Pipe**: `\pipe\srvsvc`
* **Açıklama**: Hizmet kontrol yöneticisi ve sunucu hizmetleri, hizmetleri uzaktan başlatmak ve durdurmak, komutları yürütmek için kullanılır.

* **IFID**: 4d9f4ab8-7d1c-11cf-861e-0020af6e7c57
* **Adlandırılmış Pipe**: `\pipe\epmapper`
* **Açıklama**: WM aracılığıyla kaba kuvvet parola denemesi ve bilgi toplama için kullanılan DCOM arayüzü.

### IP adreslerini belirleme

[https://github.com/mubix/IOXIDResolver](https://github.com/mubix/IOXIDResolver) kullanarak, _**IOXIDResolver**_ arayüzündeki _**ServerAlive2**_ yöntemi kötüye kullanılabilir.

Bu yöntem, HTB kutusu _APT_'den **IPv6** adresi gibi arayüz bilgilerini elde etmek için kullanılmıştır. 0xdf APT yazısına [buradan](https://0xdf.gitlab.io/2021/04/10/htb-apt.html) bakabilirsiniz, içinde rpcmap.py'yi [Impacket](https://github.com/SecureAuthCorp/impacket/) ile _stringbinding_ kullanarak alternatif bir yöntem bulunmaktadır (yukarıya bakınız).

## 593 Numaralı Port

[rpctools](https://resources.oreilly.com/examples/9780596510305/tree/master/tools/rpctools) içindeki **rpcdump.exe** bu porta etkileşimde bulunabilir.

#​# Referanslar
* [https://www.cyber.airbus.com/the-oxid-resolver-part-1-remote-enumeration-of-network-interfaces-without-any-authentication/](https://www.cyber.airbus.com/the-oxid-resolver-part-1-remote-enumeration-of-network-interfaces-without-any-authentication/)
* [https://www.cyber.airbus.com/the-oxid-resolver-part-2-accessing-a-remote-object-inside-dcom/](https://www.cyber.airbus.com/the-oxid-resolver-part-2-accessing-a-remote-object-inside-dcom/)
* [https://0xffsec.com/handbook/services/msrpc/](https://0xffsec.com/handbook/services/msrpc/)

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

Deneyimli hackerlar ve ödül avcılarıyla iletişim kurmak için [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) sunucusuna katılın!

**Hacking Insights**\
Hacking'in heyecanını ve zorluklarını inceleyen içeriklere katılın.

**Gerçek Zamanlı Hack Haberleri**\
Hızlı tempolu hacking dünyasını gerçek zamanlı haberler ve içgörülerle takip edin.

**En Son Duyurular**\
Yeni ödül avları başlatma ve önemli platform güncellemeleri hakkında bilgi edinin.

Bugün en iyi hackerlarla işbirliği yapmak için [**Discord**](https://discord.com/invite/N3FrSbmwdy) adresimize katılın!

<details>

<summary><strong>Sıfırdan kahraman olmak için AWS hackleme öğrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks'i desteklemenin diğer yolları:

* Şirketinizi HackTricks'te **reklam vermek veya HackTricks'i PDF olarak indirmek** için [**ABONELİK PLANLARI**](https://github.com/sponsors/carlospolop)'na göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin.
* Özel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluşan koleksiyonumuz [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'yi keşfedin.
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katılın veya bizi **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)**'da** takip edin.
* Hacking hilelerinizi paylaşarak HackTricks ve HackTricks Cloud github depolarına PR göndererek katkıda bulunun.

</details>
