# Εντολές Memcache

<details>

<summary><strong>Μάθετε το χάκινγκ του AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι για να υποστηρίξετε το HackTricks:

* Εάν θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**The PEASS Family**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε στη** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στη [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Μοιραστείτε τα χάκινγκ κόλπα σας υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>

## Λίστα Εντολών

**Από** [**https://lzone.de/cheat-sheet/memcached**](https://lzone.de/cheat-sheet/memcached)

Οι υποστηριζόμενες εντολές (οι επίσημες και μερικές ανεπίσημες) καταγράφονται στο έγγραφο [doc/protocol.txt](https://github.com/memcached/memcached/blob/master/doc/protocol.txt).

Δυστυχώς, η περιγραφή της σύνταξης δεν είναι πραγματικά σαφής και μια απλή εντολή βοήθειας που να καταγράφει τις υπάρχουσες εντολές θα ήταν πολύ καλύτερη. Εδώ υπάρχει μια επισκόπηση των εντολών που μπορείτε να βρείτε στην [πηγή](https://github.com/memcached/memcached) (την τελευταία ενημέρωση έγινε στις 19.08.2016):

| Εντολή               | Περιγραφή                                                     | Παράδειγμα                                                                                                                                                                                                                                     |
| --------------------- | --------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| get                   | Διαβάζει μια τιμή                                                | `get mykey`                                                                                                                                                                                                                                 |
| set                   | Ορίζει μια κλειδί ανεξάρτητα                                     | <p><code>set mykey &#x3C;flags> &#x3C;ttl> &#x3C;size></code><br><br>&#x3C;p>Βεβαιωθείτε ότι χρησιμοποιείτε \r\n ως αλλαγές γραμμής όταν χρησιμοποιείτε εργαλεία Unix CLI. Για παράδειγμα&#x3C;/p> <code>printf "set mykey 0 60 4\r\ndata\r\n" | nc localhost 11211</code></p> |
| add                   | Προσθέτει ένα νέο κλειδί                                        | `add newkey 0 60 5`                                                                                                                                                                                                                         |
| replace               | Αντικαθιστά υπάρχον κλειδί                                     | `replace key 0 60 5`                                                                                                                                                                                                                        |
| append                | Προσθέτει δεδομένα σε υπάρχον κλειδί                            | `append key 0 60 15`                                                                                                                                                                                                                        |
| prepend               | Προσθέτει δεδομένα στην αρχή υπάρχοντος κλειδιού               | `prepend key 0 60 15`                                                                                                                                                                                                                       |
| incr                  | Αυξάνει την αριθμητική τιμή του κλειδιού κατά έναν δοσμένο αριθμό | `incr mykey 2`                                                                                                                                                                                                                              |
| decr                  | Μειώνει την αριθμητική τιμή του κλειδιού κατά έναν δοσμένο αριθμό | `decr mykey 5`                                                                                                                                                                                                                              |
| delete                | Διαγράφει ένα υπάρχον κλειδί                                    | `delete mykey`                                                                                                                                                                                                                              |
| flush\_all            | Ακυρώνει όλα τα στοιχεία αμέσως                                 | `flush_all`                                                                                                                                                                                                                                 |
| flush\_all            | Ακυρώνει όλα τα στοιχεία σε n δευτερόλεπτα                      | `flush_all 900`                                                                                                                                                                                                                             |
| stats                 | Εκτυπώνει γενικές στατιστικές                                    | `stats`                                                                                                                                                                                                                                     |
|                       | Εκτυπώνει στατιστικές μνήμης                                    | `stats slabs`                                                                                                                                                                                                                               |
|                       | Εκτυπώνει στατιστικές υψηλού επιπέδου ανάθεσης                  | `stats malloc`                                                                                                                                                                                                                              |
|                       | Εκτυπώνει πληροφορίες για τα αντικείμενα                         | `stats items`                                                                                                                                                                                                                               |
|                       |                                                                 | `stats detail`                                                                                                                                                                                                                              |
|                       |                                                                 | `stats sizes`                                                                                                                                                                                                                               |
|                       | Επαναφέρει τους μετρητές στατιστικών                             | `stats reset`                                                                                                                                                                                                                               |
| lru\_crawler metadump | Αδειάζει (σχεδόν όλα) τα μεταδεδομένα για (όλα) τα στοιχεία στην προσωρινή μνήμη | `lru_crawler metadump all`                                                                                                                                                                                                                  |
| version               | Εκτυπώνει την έκδοση του διακομιστή                              | `version`                                                                                                                                                                                                                                   |
| verbosity             | Αυξάνει το επίπεδο καταγραφής                                   | `verbosity`                                                                                                                                                                                                                                 |
| quit                  | Τερματίζει τη συνεδρία                                           | `quit`                                                                                                                                                                                                                                      |

#### Στατιστικά Κίνησης <a href="#traffic-statistics" id="traffic-statistics"></a>

Μπορείτε να ερωτήσετε τα τρέχοντα στατιστικά κίνησης χρησιμοποιώντας την εντολή
```
stats
```
Θα λάβετε μια λίστα που παρέχει τον αριθμό των συνδέσεων, τα bytes εισόδου/εξόδου και πολλά άλλα.

Παράδειγμα Αποτελέσματος:
```
STAT pid 14868
STAT uptime 175931
STAT time 1220540125
STAT version 1.2.2
STAT pointer_size 32
STAT rusage_user 620.299700
STAT rusage_system 1545.703017
STAT curr_items 228
STAT total_items 779
STAT bytes 15525
STAT curr_connections 92
STAT total_connections 1740
STAT connection_structures 165
STAT cmd_get 7411
STAT cmd_set 28445156
STAT get_hits 5183
STAT get_misses 2228
STAT evictions 0
STAT bytes_read 2112768087
STAT bytes_written 1000038245
STAT limit_maxbytes 52428800
STAT threads 1
END
```
#### Στατιστικά Μνήμης <a href="#memory-statistics" id="memory-statistics"></a>

Μπορείτε να ερωτηθείτε για τα τρέχοντα στατιστικά μνήμης χρησιμοποιώντας την εντολή
```
stats slabs
```
# Memcache Commands

## Introduction

Memcache is a widely used distributed memory caching system. It is commonly used to speed up dynamic web applications by caching data and reducing the load on the database.

## Basic Commands

### SET

**Command**: `set <key> <flags> <exptime> <bytes> [noreply]`

**Description**: Stores the specified value in the cache under the given key. The flags parameter is used to store metadata about the value, such as its data type. The exptime parameter specifies the expiration time for the value, in seconds. The bytes parameter specifies the size of the value in bytes. The optional noreply parameter tells the server not to send a response.

**Example**: `set mykey 0 3600 5\r\nhello\r\n`

### GET

**Command**: `get <key>`

**Description**: Retrieves the value stored in the cache under the given key.

**Example**: `get mykey`

### DELETE

**Command**: `delete <key> [noreply]`

**Description**: Deletes the value stored in the cache under the given key. The optional noreply parameter tells the server not to send a response.

**Example**: `delete mykey`

## Advanced Commands

### STATS

**Command**: `stats [settings]`

**Description**: Retrieves statistics about the memcache server. The optional settings parameter can be used to retrieve specific statistics.

**Example**: `stats`

### FLUSH_ALL

**Command**: `flush_all [delay]`

**Description**: Deletes all the values stored in the cache. The optional delay parameter specifies the number of seconds to wait before performing the flush.

**Example**: `flush_all`

### VERSION

**Command**: `version`

**Description**: Retrieves the version of the memcache server.

**Example**: `version`

## Conclusion

These are some of the basic and advanced commands that can be used to interact with a memcache server. Understanding these commands is essential for effective memcache management and troubleshooting.
```
STAT 1:chunk_size 80
STAT 1:chunks_per_page 13107
STAT 1:total_pages 1
STAT 1:total_chunks 13107
STAT 1:used_chunks 13106
STAT 1:free_chunks 1
STAT 1:free_chunks_end 12886
STAT 2:chunk_size 100
STAT 2:chunks_per_page 10485
STAT 2:total_pages 1
STAT 2:total_chunks 10485
STAT 2:used_chunks 10484
STAT 2:free_chunks 1
STAT 2:free_chunks_end 10477
[...]
STAT active_slabs 3
STAT total_malloced 3145436
END
```
Εάν δεν είστε βέβαιοι αν έχετε αρκετή μνήμη για την περίπτωση του memcached σας, παρακολουθήστε πάντα τους μετρητές "εκδιωγμένων" που δίνονται από την εντολή "stats". Εάν έχετε αρκετή μνήμη για την περίπτωση, ο μετρητής "εκδιωγμένων" θα πρέπει να είναι 0 ή τουλάχιστον να μην αυξάνεται.

#### Ποια Κλειδιά Χρησιμοποιούνται? <a href="#which-keys-are-used" id="which-keys-are-used"></a>

Δεν υπάρχει ενσωματωμένη λειτουργία για να προσδιορίσετε απευθείας το τρέχον σύνολο των κλειδιών. Ωστόσο, μπορείτε να χρησιμοποιήσετε την
```
stats items
```
## Command to Determine How Many Keys Exist

To determine the number of keys that exist in a Memcache server, you can use the `stats` command. This command provides statistics about the server, including the total number of keys stored.

```bash
stats items
```

This command will return a list of items with their corresponding statistics. Look for the line that starts with `STAT items:`, which will provide the total count of keys.

For example:

```bash
STAT items:1:number 10
```

In this case, the server has a total of 10 keys stored.
```
stats items
STAT items:1:number 220
STAT items:1:age 83095
STAT items:2:number 7
STAT items:2:age 1405
[...]
END
```
Αυτό τουλάχιστον βοηθά να δούμε αν χρησιμοποιούνται κλειδιά. Για να ανακτήσετε τα ονόματα των κλειδιών από ένα PHP script που ήδη πραγματοποιεί πρόσβαση στο memcache, μπορείτε να χρησιμοποιήσετε τον κώδικα PHP από το [100days.de](http://100days.de/serendipity/archives/55-Dumping-MemcacheD-Content-Keys-with-PHP.html).

<details>

<summary><strong>Μάθετε το hacking του AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι για να υποστηρίξετε το HackTricks:

* Εάν θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF**, ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**The PEASS Family**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Συμμετάσχετε** 💬 **στην ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή **στην ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Μοιραστείτε τα κόλπα σας για το hacking υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>
