# Memcache Opdragte

<details>

<summary><strong>Leer AWS-hacking van nul tot held met</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Ander maniere om HackTricks te ondersteun:

* As jy jou **maatskappy geadverteer wil sien in HackTricks** of **HackTricks in PDF wil aflaai**, kyk na die [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Kry die [**amptelike PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ontdek [**The PEASS Family**](https://opensea.io/collection/the-peass-family), ons versameling eksklusiewe [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Deel jou hacktruuks deur PRs in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-repos.

</details>

## Opdragte Spiekbriefie

**Vanaf** [**https://lzone.de/cheat-sheet/memcached**](https://lzone.de/cheat-sheet/memcached)

Die ondersteunde opdragte (die amptelike en sommige onoffisi√´le) word gedokumenteer in die [doc/protocol.txt](https://github.com/memcached/memcached/blob/master/doc/protocol.txt) dokument.

Ongelukkig is die sintaksisbeskrywing nie regtig duidelik nie en 'n eenvoudige hulpopdrag wat die bestaande opdragte lys, sou baie beter wees. Hier is 'n oorsig van die opdragte wat jy in die [bron](https://github.com/memcached/memcached) kan vind (soos vanaf 19.08.2016):

| Opdrag                | Beskrywing                                                      | Voorbeeld                                                                                                                                                                                                                                   |
| --------------------- | --------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| get                   | Lees 'n waarde                                                  | `get mykey`                                                                                                                                                                                                                                 |
| set                   | Stel 'n sleutel onvoorwaardelik in                              | <p><code>set mykey &#x3C;flags> &#x3C;ttl> &#x3C;size></code><br><br>&#x3C;p>Sorg dat jy \r\n gebruik as lynafbrekings wanneer jy Unix CLI-hulpmiddels gebruik. Byvoorbeeld&#x3C;/p> <code>printf "set mykey 0 60 4\r\ndata\r\n" | nc localhost 11211</code></p> |
| add                   | Voeg 'n nuwe sleutel by                                         | `add newkey 0 60 5`                                                                                                                                                                                                                         |
| replace               | Skryf bestaande sleutel oor                                     | `replace key 0 60 5`                                                                                                                                                                                                                        |
| append                | Voeg data by bestaande sleutel                                  | `append key 0 60 15`                                                                                                                                                                                                                        |
| prepend               | Voeg data voor bestaande sleutel                                | `prepend key 0 60 15`                                                                                                                                                                                                                       |
| incr                  | Verhoog numeriese sleutelwaarde met 'n gegewe getal             | `incr mykey 2`                                                                                                                                                                                                                              |
| decr                  | Verminder numeriese sleutelwaarde met 'n gegewe getal           | `decr mykey 5`                                                                                                                                                                                                                              |
| delete                | Verwyder 'n bestaande sleutel                                   | `delete mykey`                                                                                                                                                                                                                              |
| flush\_all            | Maak alle items onmiddellik ongeldig                            | `flush_all`                                                                                                                                                                                                                                 |
| flush\_all            | Maak alle items binne n sekond ongeldig                         | `flush_all 900`                                                                                                                                                                                                                             |
| stats                 | Druk algemene statistieke uit                                   | `stats`                                                                                                                                                                                                                                     |
|                       | Druk geheue-statistieke uit                                     | `stats slabs`                                                                                                                                                                                                                               |
|                       | Druk ho√´r vlak toewysingsstatistieke uit                        | `stats malloc`                                                                                                                                                                                                                              |
|                       | Druk inligting oor items uit                                    | `stats items`                                                                                                                                                                                                                               |
|                       |                                                                 | `stats detail`                                                                                                                                                                                                                              |
|                       |                                                                 | `stats sizes`                                                                                                                                                                                                                               |
|                       | Stel statistiektellers terug                                    | `stats reset`                                                                                                                                                                                                                               |
| lru\_crawler metadump | Dump (meeste van) die metadata vir (al) die items in die cache | `lru_crawler metadump all`                                                                                                                                                                                                                  |
| version               | Druk bedienerweergawe uit                                       | `version`                                                                                                                                                                                                                                   |
| verbosity             | Verhoog logvlak                                                 | `verbosity`                                                                                                                                                                                                                                 |
| quit                  | Be√´indig sessie                                                | `quit`                                                                                                                                                                                                                                      |

#### Verkeersstatistieke <a href="#traffic-statistics" id="traffic-statistics"></a>

Jy kan die huidige verkeersstatistieke navraag doen deur die opdrag te gebruik
```
stats
```
Jy sal 'n lys kry wat die aantal verbindings, bytes in/uit en nog baie meer diens. 

Voorbeeld Uitset:
```
STAT pid 14868
STAT uptime 175931
STAT time 1220540125
STAT version 1.2.2
STAT pointer_size 32
STAT rusage_user 620.299700
STAT rusage_system 1545.703017
STAT curr_items 228
STAT total_items 779
STAT bytes 15525
STAT curr_connections 92
STAT total_connections 1740
STAT connection_structures 165
STAT cmd_get 7411
STAT cmd_set 28445156
STAT get_hits 5183
STAT get_misses 2228
STAT evictions 0
STAT bytes_read 2112768087
STAT bytes_written 1000038245
STAT limit_maxbytes 52428800
STAT threads 1
END
```
#### Geheue Statistieke <a href="#geheue-statistieke" id="geheue-statistieke"></a>

Jy kan die huidige geheue statistieke navraag doen deur gebruik te maak van
```
stats slabs
```
# Memcache Commands

Hier is 'n lys van die mees gebruikte Memcache-opdragte:

## GET

Die `GET`-opdrag word gebruik om die waarde van 'n sleutel in Memcache te kry. Die sintaks is as volg:

```bash
GET <key>
```

## SET

Die `SET`-opdrag word gebruik om 'n waarde aan 'n sleutel in Memcache toe te ken. Die sintaks is as volg:

```bash
SET <key> <flags> <exptime> <bytes> [noreply]
<data block>
```

## ADD

Die `ADD`-opdrag word gebruik om 'n waarde aan 'n sleutel in Memcache toe te voeg, maar slegs as die sleutel nog nie bestaan nie. Die sintaks is as volg:

```bash
ADD <key> <flags> <exptime> <bytes> [noreply]
<data block>
```

## REPLACE

Die `REPLACE`-opdrag word gebruik om 'n waarde aan 'n sleutel in Memcache toe te ken, maar slegs as die sleutel reeds bestaan. Die sintaks is as volg:

```bash
REPLACE <key> <flags> <exptime> <bytes> [noreply]
<data block>
```

## DELETE

Die `DELETE`-opdrag word gebruik om 'n sleutel en die bybehorende waarde uit Memcache te verwyder. Die sintaks is as volg:

```bash
DELETE <key> [noreply]
```

## INCR

Die `INCR`-opdrag word gebruik om die waarde van 'n sleutel in Memcache met 'n sekere bedrag te verhoog. Die sintaks is as volg:

```bash
INCR <key> <value> [noreply]
```

## DECR

Die `DECR`-opdrag word gebruik om die waarde van 'n sleutel in Memcache met 'n sekere bedrag te verminder. Die sintaks is as volg:

```bash
DECR <key> <value> [noreply]
```

## APPEND

Die `APPEND`-opdrag word gebruik om data aan die einde van 'n waarde van 'n sleutel in Memcache toe te voeg. Die sintaks is as volg:

```bash
APPEND <key> <bytes> [noreply]
<data block>
```

## PREPEND

Die `PREPEND`-opdrag word gebruik om data aan die begin van 'n waarde van 'n sleutel in Memcache toe te voeg. Die sintaks is as volg:

```bash
PREPEND <key> <bytes> [noreply]
<data block>
```

## CAS

Die `CAS`-opdrag word gebruik om 'n waarde aan 'n sleutel in Memcache toe te ken, maar slegs as die waarde nie verander is sedert die laaste keer wat dit opgevra is nie. Die sintaks is as volg:

```bash
CAS <key> <flags> <exptime> <bytes> <cas unique> [noreply]
<data block>
```
```
STAT 1:chunk_size 80
STAT 1:chunks_per_page 13107
STAT 1:total_pages 1
STAT 1:total_chunks 13107
STAT 1:used_chunks 13106
STAT 1:free_chunks 1
STAT 1:free_chunks_end 12886
STAT 2:chunk_size 100
STAT 2:chunks_per_page 10485
STAT 2:total_pages 1
STAT 2:total_chunks 10485
STAT 2:used_chunks 10484
STAT 2:free_chunks 1
STAT 2:free_chunks_end 10477
[...]
STAT active_slabs 3
STAT total_malloced 3145436
END
```
As jy onseker is of jy genoeg geheue het vir jou memcached instansie, moet jy altyd kyk na die "evictions" tellers wat deur die "stats" bevel gegee word. As jy genoeg geheue het vir die instansie, moet die "evictions" teller 0 wees of ten minste nie toeneem nie.

#### Watter Sleutels Word Gebruik? <a href="#which-keys-are-used" id="which-keys-are-used"></a>

Daar is geen ingeboude funksie om direk die huidige stel sleutels te bepaal nie. Jy kan egter die
```
stats items
```
## Commando om te bepaal hoeveel sleutels daar bestaan.

Om te bepaal hoeveel sleutels daar in die memcache-stoorplek bestaan, kan jy die volgende bevel gebruik:

```bash
stats items
```

Hierdie bevel sal 'n lys van statistieke vir elke item in die memcache-stoorplek gee. Die aantal sleutels kan bepaal word deur die telling van die items in die lys.
```
stats items
STAT items:1:number 220
STAT items:1:age 83095
STAT items:2:number 7
STAT items:2:age 1405
[...]
END
```
Dit help ten minste om te sien of enige sleutels gebruik word. Om die sleutelname uit 'n PHP-skripsie te dump wat reeds die memcache-toegang doen, kan jy die PHP-kode van [100days.de](http://100days.de/serendipity/archives/55-Dumping-MemcacheD-Content-Keys-with-PHP.html) gebruik.

<details>

<summary><strong>Leer AWS-hacking van nul tot held met</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Ander maniere om HackTricks te ondersteun:

* As jy wil sien dat jou **maatskappy geadverteer word in HackTricks** of **HackTricks aflaai in PDF-formaat**, kyk na die [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Kry die [**amptelike PEASS & HackTricks-uitrusting**](https://peass.creator-spring.com)
* Ontdek [**The PEASS Family**](https://opensea.io/collection/the-peass-family), ons versameling eksklusiewe [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Deel jou haktruuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-opslagplekke.

</details>
