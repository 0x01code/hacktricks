<details>

<summary><strong>AWS hacklemeyi sıfırdan kahraman seviyesine öğrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Kırmızı Takım Uzmanı)</strong></a><strong>!</strong></summary>

HackTricks'ı desteklemenin diğer yolları:

* **Şirketinizi HackTricks'te reklamını görmek isterseniz** veya **HackTricks'i PDF olarak indirmek isterseniz** [**ABONELİK PLANLARINA**](https://github.com/sponsors/carlospolop) göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keşfedin, özel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın** veya **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)**'ı takip edin**.
* **Hacking hilelerinizi HackTricks ve HackTricks Cloud** github depolarına **PR göndererek paylaşın**.

</details>
```text
PORT     STATE SERVICE    VERSION
3299/tcp open  saprouter?
```
## Metasploit ile SAProuter Sızma Testi Anlama

SAProuter, SAP sistemleri için bir ters proxy olarak çalışır ve genellikle internet ile iç SAP ağları arasındaki erişimi kontrol etmek için kullanılır. Organizasyonel güvenlik duvarları aracılığıyla TCP port 3299'a izin verilerek genellikle internete açık hale getirilir. Bu yapılandırma, SAProuter'ın yüksek değerli iç ağlara bir geçit olarak hizmet edebileceği için sızma testi için çekici bir hedef haline gelir.

**Tarama ve Bilgi Toplama**

İlk olarak, **sap_service_discovery** modülü kullanılarak belirli bir IP üzerinde SAP router'ın çalışıp çalışmadığını tespit etmek için bir tarama yapılır. Bu adım, bir SAP router'ın varlığını ve açık portunu belirlemek için önemlidir.
```text
msf> use auxiliary/scanner/sap/sap_service_discovery
msf auxiliary(sap_service_discovery) > set RHOSTS 1.2.3.101
msf auxiliary(sap_service_discovery) > run
```
Keşif yapıldıktan sonra, iç ağ ayrıntılarını ortaya çıkarmak için SAP yönlendiricisinin yapılandırmasıyla ilgili daha fazla araştırma yapılır. Bunun için **sap_router_info_request** modülü kullanılır.
```text
msf auxiliary(sap_router_info_request) > use auxiliary/scanner/sap/sap_router_info_request
msf auxiliary(sap_router_info_request) > set RHOSTS 1.2.3.101
msf auxiliary(sap_router_info_request) > run
```
**Dahili Hizmetleri Sıralama**

Elde edilen dahili ağ bilgileriyle, **sap_router_portscanner** modülü kullanılarak SAProuter üzerinden dahili ana bilgisayarları ve hizmetleri sorgulanır, bu da dahili ağlar ve hizmet yapılandırmaları hakkında daha derin bir anlayış sağlar.
```text
msf auxiliary(sap_router_portscanner) > set INSTANCES 00-50
msf auxiliary(sap_router_portscanner) > set PORTS 32NN
```
Bu modülün, belirli SAP örneklerini ve bağlantı noktalarını hedefleme esnekliği, ayrıntılı iç ağ keşfi için etkili bir araç yapar.

**Gelişmiş Numaralandırma ve ACL Haritalama**

Daha ileri tarama, SAProuter üzerindeki Erişim Kontrol Listelerinin (ACL'lerin) nasıl yapılandırıldığını ortaya çıkarabilir ve hangi bağlantıların izin verildiğini veya engellendiğini detaylandırabilir. Bu bilgi, güvenlik politikalarını ve potansiyel güvenlik açıklarını anlamak için önemlidir.
```text
msf auxiliary(sap_router_portscanner) > set MODE TCP
msf auxiliary(sap_router_portscanner) > set PORTS 80,32NN
```
**İç Hostların Kör Numaralandırılması**

SAProuter'dan doğrudan bilgi almanın sınırlı olduğu senaryolarda, kör numaralandırma gibi teknikler uygulanabilir. Bu yaklaşım, doğrudan IP adresleri olmadan iç host adlarının varlığını tahmin etmeye ve doğrulamaya çalışarak potansiyel hedefleri ortaya çıkarır.

**Sızma Testi için Bilgileri Kullanma**

Ağın haritalandırılması ve erişilebilir hizmetlerin belirlenmesi sonrasında, sızma testçileri, iç SAP hizmetlerinin daha fazla keşfi ve sömürüsü için Metasploit'in proxy yeteneklerini SAProuter üzerinden kullanabilir.
```text
msf auxiliary(sap_hostctrl_getcomputersystem) > set Proxies sapni:1.2.3.101:3299
msf auxiliary(sap_hostctrl_getcomputersystem) > set RHOSTS 192.168.1.18
msf auxiliary(sap_hostctrl_getcomputersystem) > run
```
**Sonuç**

Bu yaklaşım, güvenli SAProuter yapılandırmalarının önemini vurgulamakta ve hedefe yönelik penetrasyon testleri aracılığıyla iç ağlara erişim potansiyelini ortaya koymaktadır. SAP yönlendiricilerini doğru şekilde güvence altına almak ve ağ güvenliği mimarisindeki rolünü anlamak, yetkisiz erişime karşı korunmak için önemlidir.

Daha detaylı bilgi için Metasploit modüllerine ve kullanımlarına [Rapid7 veritabanını](http://www.rapid7.com/db) ziyaret edebilirsiniz.


## **Referanslar**

* [https://www.rapid7.com/blog/post/2014/01/09/piercing-saprouter-with-metasploit/](https://www.rapid7.com/blog/post/2014/01/09/piercing-saprouter-with-metasploit/)

## Shodan

* `port:3299 !HTTP Network packet too big`



<details>

<summary><strong>AWS hackleme konusunda sıfırdan kahraman olmak için</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>'ı öğrenin!</strong></summary>

HackTricks'i desteklemenin diğer yolları:

* Şirketinizi HackTricks'te **reklamınızı görmek** veya **HackTricks'i PDF olarak indirmek** için [**ABONELİK PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* Özel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluşan koleksiyonumuz [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'i keşfedin
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın** veya **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)'u **takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna **PR göndererek** paylaşın.

</details>
