<details>

<summary><strong>Naucz się hakować AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeśli chcesz zobaczyć swoją **firmę reklamowaną w HackTricks** lub **pobrać HackTricks w formacie PDF**, sprawdź [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Zdobądź [**oficjalne gadżety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzinę PEASS**](https://opensea.io/collection/the-peass-family), naszą kolekcję ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Dołącz do** 💬 [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **śledź** nas na **Twitterze** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel się swoimi sztuczkami hakerskimi, przesyłając PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytoriów github.

</details>
```text
PORT     STATE SERVICE    VERSION
3299/tcp open  saprouter?
```
To jest podsumowanie postu z [https://blog.rapid7.com/2014/01/09/piercing-saprouter-with-metasploit/](https://blog.rapid7.com/2014/01/09/piercing-saprouter-with-metasploit/)


## Zrozumienie penetracji SAProuter za pomocą Metasploit

SAProuter działa jako odwrotny proxy dla systemów SAP, głównie w celu kontrolowania dostępu między internetem a wewnętrznymi sieciami SAP. Jest powszechnie wystawiany na działanie internetu poprzez umożliwienie portu TCP 3299 przez zapory organizacyjne. Taka konfiguracja sprawia, że SAProuter staje się atrakcyjnym celem testów penetracyjnych, ponieważ może służyć jako brama do wewnętrznych sieci o wysokiej wartości.

**Skanowanie i zbieranie informacji**

Początkowo przeprowadza się skanowanie w celu identyfikacji, czy na danym adresie IP działa router SAP przy użyciu modułu **sap_service_discovery**. Ten krok jest kluczowy dla ustalenia obecności routera SAP i otwartego portu.
```text
msf> use auxiliary/scanner/sap/sap_service_discovery
msf auxiliary(sap_service_discovery) > set RHOSTS 1.2.3.101
msf auxiliary(sap_service_discovery) > run
```
Po odkryciu, przeprowadza się dalsze dochodzenie w celu zbadania konfiguracji routera SAP przy użyciu modułu **sap_router_info_request**, aby potencjalnie ujawnić szczegóły wewnętrznej sieci.
```text
msf auxiliary(sap_router_info_request) > use auxiliary/scanner/sap/sap_router_info_request
msf auxiliary(sap_router_info_request) > set RHOSTS 1.2.3.101
msf auxiliary(sap_router_info_request) > run
```
**Wyliczanie wewnętrznych usług**

Dzięki uzyskanym wglądom w wewnętrzną sieć, moduł **sap_router_portscanner** jest używany do sondowania wewnętrznych hostów i usług za pośrednictwem SAProutera, co umożliwia lepsze zrozumienie wewnętrznych sieci i konfiguracji usług.
```text
msf auxiliary(sap_router_portscanner) > set INSTANCES 00-50
msf auxiliary(sap_router_portscanner) > set PORTS 32NN
```
Ten moduł jest elastyczny w celowaniu konkretnych instancji SAP i portów, co czyni go skutecznym narzędziem do szczegółowego badania wewnętrznej sieci.

**Zaawansowane wyliczanie i mapowanie ACL**

Dalsze skanowanie może ujawnić, jak są skonfigurowane listy kontroli dostępu (ACL) na SAProuterze, szczegółowo opisując, które połączenia są dozwolone lub zablokowane. Te informacje są kluczowe do zrozumienia polityk bezpieczeństwa i potencjalnych podatności.
```text
msf auxiliary(sap_router_portscanner) > set MODE TCP
msf auxiliary(sap_router_portscanner) > set PORTS 80,32NN
```
**Ślepe wyliczanie wewnętrznych hostów**

W sytuacjach, gdy bezpośrednie informacje z SAProuter są ograniczone, można zastosować techniki takie jak ślepe wyliczanie. Ta metoda polega na próbie zgadywania i weryfikacji istnienia wewnętrznych nazw hostów, ujawniając potencjalne cele bez bezpośrednich adresów IP.

**Wykorzystanie informacji do testów penetracyjnych**

Po zmapowaniu sieci i zidentyfikowaniu dostępnych usług, testerzy penetracyjni mogą wykorzystać możliwości proxy w Metasploit do przekierowania przez SAProuter w celu dalszego badania i eksploatacji wewnętrznych usług SAP.
```text
msf auxiliary(sap_hostctrl_getcomputersystem) > set Proxies sapni:1.2.3.101:3299
msf auxiliary(sap_hostctrl_getcomputersystem) > set RHOSTS 192.168.1.18
msf auxiliary(sap_hostctrl_getcomputersystem) > run
```
**Podsumowanie**

Ta metoda podkreśla znaczenie bezpiecznej konfiguracji SAProutera i zwraca uwagę na potencjał dostępu do wewnętrznych sieci poprzez ukierunkowane testowanie penetracyjne. Prawidłowe zabezpieczenie SAProuterów i zrozumienie ich roli w architekturze bezpieczeństwa sieciowego jest kluczowe dla ochrony przed nieautoryzowanym dostępem.

Aby uzyskać bardziej szczegółowe informacje na temat modułów Metasploit i ich użycia, odwiedź [bazę danych Rapid7](http://www.rapid7.com/db).


## **Odnośniki**

* [https://www.rapid7.com/blog/post/2014/01/09/piercing-saprouter-with-metasploit/](https://www.rapid7.com/blog/post/2014/01/09/piercing-saprouter-with-metasploit/)

## Shodan

* `port:3299 !HTTP Network packet too big`



<details>

<summary><strong>Naucz się hakować AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeśli chcesz zobaczyć swoją **firmę reklamowaną w HackTricks** lub **pobrać HackTricks w formacie PDF**, sprawdź [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Zdobądź [**oficjalne gadżety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzinę PEASS**](https://opensea.io/collection/the-peass-family), naszą kolekcję ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Dołącz do** 💬 [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **śledź** nas na **Twitterze** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel się swoimi sztuczkami hakerskimi, przesyłając PR do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
