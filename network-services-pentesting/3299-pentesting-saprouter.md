<details>

<summary><strong>从零开始学习AWS黑客技术，成为专家</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE（HackTricks AWS红队专家）</strong></a><strong>！</strong></summary>

其他支持HackTricks的方式：

* 如果您想看到您的**公司在HackTricks中做广告**或**下载PDF格式的HackTricks**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)!
* 获取[**官方PEASS & HackTricks周边产品**](https://peass.creator-spring.com)
* 探索[**PEASS家族**](https://opensea.io/collection/the-peass-family)，我们的独家[**NFTs**](https://opensea.io/collection/the-peass-family)
* **加入** 💬 [**Discord群**](https://discord.gg/hRep4RUj7f) 或 [**电报群**](https://t.me/peass) 或 **关注**我们的**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)**。**
* 通过向[**HackTricks**](https://github.com/carlospolop/hacktricks)和[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github仓库提交PR来分享您的黑客技巧。

</details>
```text
PORT     STATE SERVICE    VERSION
3299/tcp open  saprouter?
```
## 通过Metasploit理解SAProuter渗透

SAProuter充当SAP系统的反向代理，主要用于控制互联网与内部SAP网络之间的访问。通常通过允许TCP端口3299穿过组织防火墙来将其暴露在互联网上。这种设置使SAProuter成为渗透测试的一个吸引人的目标，因为它可能作为通往高价值内部网络的网关。

**扫描和信息收集**

首先，使用**sap_service_discovery**模块执行扫描，以确定给定IP上是否运行了SAP路由器。这一步对于建立SAP路由器及其开放端口的存在至关重要。
```text
msf> use auxiliary/scanner/sap/sap_service_discovery
msf auxiliary(sap_service_discovery) > set RHOSTS 1.2.3.101
msf auxiliary(sap_service_discovery) > run
```
在发现之后，使用 **sap_router_info_request** 模块对 SAP 路由器的配置进行进一步调查，可能会揭示内部网络细节。
```text
msf auxiliary(sap_router_info_request) > use auxiliary/scanner/sap/sap_router_info_request
msf auxiliary(sap_router_info_request) > set RHOSTS 1.2.3.101
msf auxiliary(sap_router_info_request) > run
```
**枚举内部服务**

通过获得的内部网络洞察力，使用**sap_router_portscanner**模块来通过SAProuter探测内部主机和服务，从而更深入地了解内部网络和服务配置。
```text
msf auxiliary(sap_router_portscanner) > set INSTANCES 00-50
msf auxiliary(sap_router_portscanner) > set PORTS 32NN
```
**高级枚举和ACL映射**

进一步的扫描可以揭示SAProuter上的访问控制列表（ACL）配置情况，详细说明了允许或阻止的连接。这些信息对于理解安全策略和潜在漏洞至关重要。
```text
msf auxiliary(sap_router_portscanner) > set MODE TCP
msf auxiliary(sap_router_portscanner) > set PORTS 80,32NN
```
**内部主机的盲枚举**

在直接从SAProuter获取信息受限的情况下，可以应用盲枚举等技术。这种方法尝试猜测和验证内部主机名的存在，揭示潜在目标而无需直接IP地址。

**利用信息进行渗透测试**

在绘制网络图并确定可访问的服务后，渗透测试人员可以利用Metasploit的代理功能通过SAProuter进行进一步探索和利用内部SAP服务。
```text
msf auxiliary(sap_hostctrl_getcomputersystem) > set Proxies sapni:1.2.3.101:3299
msf auxiliary(sap_hostctrl_getcomputersystem) > set RHOSTS 192.168.1.18
msf auxiliary(sap_hostctrl_getcomputersystem) > run
```
**结论**

这种方法强调了安全的SAProuter配置的重要性，并突出了通过有针对性的渗透测试访问内部网络的潜力。正确保护SAP路由器并了解它们在网络安全架构中的作用对于防止未经授权的访问至关重要。

要获取有关Metasploit模块及其用法的更详细信息，请访问[Rapid7的数据库](http://www.rapid7.com/db)。


## **参考资料**

* [https://www.rapid7.com/blog/post/2014/01/09/piercing-saprouter-with-metasploit/](https://www.rapid7.com/blog/post/2014/01/09/piercing-saprouter-with-metasploit/)

## Shodan

* `port:3299 !HTTP Network packet too big`



<details>

<summary><strong>从零开始学习AWS黑客技术，成为专家</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

支持HackTricks的其他方式：

* 如果您想看到您的**公司在HackTricks中做广告**或**下载PDF格式的HackTricks**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)!
* 获取[**官方PEASS & HackTricks周边产品**](https://peass.creator-spring.com)
* 探索[**PEASS家族**](https://opensea.io/collection/the-peass-family)，我们的独家[NFTs](https://opensea.io/collection/the-peass-family)收藏品
* **加入** 💬 [**Discord群**](https://discord.gg/hRep4RUj7f) 或 [**电报群**](https://t.me/peass) 或在**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)**上关注**我们。
* 通过向[**HackTricks**](https://github.com/carlospolop/hacktricks)和[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github仓库提交PR来分享您的黑客技巧。

</details>
