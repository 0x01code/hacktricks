<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>을 통해 AWS 해킹을 처음부터 전문가까지 배워보세요<strong>!</strong></summary>

HackTricks를 지원하는 다른 방법:

* **회사를 HackTricks에서 광고하거나 HackTricks를 PDF로 다운로드**하려면 [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)를 확인하세요!
* [**공식 PEASS & HackTricks 스웨그**](https://peass.creator-spring.com)를 얻으세요.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)를 발견하세요. 독점적인 [**NFTs**](https://opensea.io/collection/the-peass-family) 컬렉션입니다.
* 💬 [**Discord 그룹**](https://discord.gg/hRep4RUj7f) 또는 [**텔레그램 그룹**](https://t.me/peass)에 **참여**하거나 **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)을 **팔로우**하세요.
* **Hacking 트릭을 공유하려면** [**HackTricks**](https://github.com/carlospolop/hacktricks) 및 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github 저장소에 PR을 제출하세요.

</details>
```text
PORT     STATE SERVICE    VERSION
3299/tcp open  saprouter?
```
## Metasploit을 사용한 SAProuter 침투 이해하기

SAProuter는 주로 인터넷과 내부 SAP 네트워크 간의 액세스를 제어하기 위해 SAP 시스템에 대한 역방향 프록시로 작동합니다. 조직 방화벽을 통해 TCP 포트 3299를 허용하여 인터넷에 노출되는 경우가 많습니다. 이러한 설정으로 인해 SAProuter는 고가치 내부 네트워크로의 게이트웨이로 작용할 수 있기 때문에 펜테스팅의 매력적인 대상이 됩니다.

**스캐닝 및 정보 수집**

먼저, **sap_service_discovery** 모듈을 사용하여 주어진 IP에서 SAP 라우터가 실행 중인지 여부를 식별하기 위해 스캔을 수행합니다. 이 단계는 SAP 라우터의 존재와 열린 포트를 확인하는 데 중요합니다.
```text
msf> use auxiliary/scanner/sap/sap_service_discovery
msf auxiliary(sap_service_discovery) > set RHOSTS 1.2.3.101
msf auxiliary(sap_service_discovery) > run
```
다음으로, SAP 라우터의 구성에 대한 추가 조사가 수행됩니다. 이는 내부 네트워크 세부 정보를 확인할 수 있는 가능성이 있는 **sap_router_info_request** 모듈을 사용하여 이루어집니다.
```text
msf auxiliary(sap_router_info_request) > use auxiliary/scanner/sap/sap_router_info_request
msf auxiliary(sap_router_info_request) > set RHOSTS 1.2.3.101
msf auxiliary(sap_router_info_request) > run
```
**내부 서비스 열거**

획득한 내부 네트워크 정보를 바탕으로, **sap_router_portscanner** 모듈을 사용하여 SAProuter를 통해 내부 호스트와 서비스를 조사하여 내부 네트워크와 서비스 구성에 대한 깊은 이해를 얻을 수 있습니다.
```text
msf auxiliary(sap_router_portscanner) > set INSTANCES 00-50
msf auxiliary(sap_router_portscanner) > set PORTS 32NN
```
이 모듈은 특정 SAP 인스턴스와 포트를 대상으로 하는 유연성으로 인해 내부 네트워크를 자세히 탐색하는 데 효과적인 도구입니다.

**고급 열거 및 ACL 매핑**

추가 스캐닝을 통해 SAProuter에서 어떻게 액세스 제어 목록(ACL)이 구성되어 있는지 알 수 있으며, 어떤 연결이 허용되거나 차단되는지에 대한 정보를 상세히 파악할 수 있습니다. 이 정보는 보안 정책과 잠재적인 취약점을 이해하는 데 중요합니다.
```text
msf auxiliary(sap_router_portscanner) > set MODE TCP
msf auxiliary(sap_router_portscanner) > set PORTS 80,32NN
```
**내부 호스트의 블라인드 열거**

SAProuter로부터 직접적인 정보가 제한된 경우, 블라인드 열거와 같은 기술을 적용할 수 있습니다. 이 접근 방식은 내부 호스트 이름을 추측하고 확인하여 직접적인 IP 주소 없이 잠재적인 대상을 밝혀냅니다.

**펜트스팅을 위한 정보 활용**

네트워크를 매핑하고 접근 가능한 서비스를 식별한 후, 펜트스터는 Metasploit의 프록시 기능을 활용하여 SAProuter를 통해 내부 SAP 서비스의 추가적인 탐색과 악용을 위한 피벗을 수행할 수 있습니다.
```text
msf auxiliary(sap_hostctrl_getcomputersystem) > set Proxies sapni:1.2.3.101:3299
msf auxiliary(sap_hostctrl_getcomputersystem) > set RHOSTS 192.168.1.18
msf auxiliary(sap_hostctrl_getcomputersystem) > run
```
**결론**

이 접근 방식은 안전한 SAProuter 구성의 중요성을 강조하며, 대상화된 침투 테스트를 통해 내부 네트워크에 접근할 수 있는 잠재력을 강조합니다. SAP 라우터를 적절하게 보호하고 네트워크 보안 아키텍처에서의 역할을 이해하는 것은 무단 접근으로부터 보호하기 위해 중요합니다.

Metasploit 모듈 및 사용법에 대한 자세한 정보는 [Rapid7의 데이터베이스](http://www.rapid7.com/db)를 참조하십시오.


## **참고 자료**

* [https://www.rapid7.com/blog/post/2014/01/09/piercing-saprouter-with-metasploit/](https://www.rapid7.com/blog/post/2014/01/09/piercing-saprouter-with-metasploit/)

## Shodan

* `port:3299 !HTTP Network packet too big`



<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>를 통해 AWS 해킹을 처음부터 전문가까지 배워보세요<strong>!</strong></summary>

HackTricks를 지원하는 다른 방법:

* HackTricks에서 **회사 광고를 보거나 HackTricks를 PDF로 다운로드**하려면 [**구독 플랜**](https://github.com/sponsors/carlospolop)을 확인하세요!
* [**공식 PEASS & HackTricks 상품**](https://peass.creator-spring.com)을 구매하세요.
* 독점적인 [**NFT**](https://opensea.io/collection/the-peass-family) 컬렉션인 [**The PEASS Family**](https://opensea.io/collection/the-peass-family)를 발견하세요.
* 💬 [**Discord 그룹**](https://discord.gg/hRep4RUj7f) 또는 [**텔레그램 그룹**](https://t.me/peass)에 **참여**하거나 **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)을 **팔로우**하세요.
* **HackTricks**와 **HackTricks Cloud** github 저장소에 PR을 제출하여 여러분의 해킹 기법을 공유하세요.

</details>
