<details>

<summary><strong>htARTE（HackTricks AWS Red Team Expert）</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>を使用して、ゼロからヒーローまでAWSハッキングを学ぶ</strong></a><strong>！</strong></summary>

HackTricks をサポートする他の方法:

* **HackTricks で企業を宣伝したい** または **HackTricks をPDFでダウンロードしたい場合は** [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop) をチェックしてください！
* [**公式PEASS＆HackTricksスワッグ**](https://peass.creator-spring.com)を入手する
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)、当社の独占的な [**NFTs**](https://opensea.io/collection/the-peass-family) コレクションを発見する
* **💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f) または [**telegramグループ**](https://t.me/peass) に参加するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live) をフォローする**
* **ハッキングトリックを共有するために、PRを** [**HackTricks**](https://github.com/carlospolop/hacktricks) および [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github リポジトリに提出する

</details>
```text
PORT     STATE SERVICE    VERSION
3299/tcp open  saprouter?
```
## SAProuterのMetasploitによる侵入の理解

SAProuterは、主にインターネットと内部SAPネットワークの間のアクセスを制御するための逆プロキシとして機能します。組織のファイアウォールを介してTCPポート3299を許可することで、SAProuterは一般的にインターネットに公開されています。このセットアップにより、SAProuterは高価値な内部ネットワークへのゲートウェイとして機能する可能性があるため、ペネトレーションテストの対象として魅力的です。

**スキャンと情報収集**

最初に、**sap_service_discovery**モジュールを使用して、特定のIPでSAPルーターが実行されているかどうかを特定するスキャンが実行されます。このステップは、SAPルーターの存在とそのオープンポートを確立するために重要です。
```text
msf> use auxiliary/scanner/sap/sap_service_discovery
msf auxiliary(sap_service_discovery) > set RHOSTS 1.2.3.101
msf auxiliary(sap_service_discovery) > run
```
以下の発見に続いて、SAPルーターの構成に関するさらなる調査が、**sap_router_info_request**モジュールを使用して内部ネットワークの詳細を明らかにする可能性があります。
```text
msf auxiliary(sap_router_info_request) > use auxiliary/scanner/sap/sap_router_info_request
msf auxiliary(sap_router_info_request) > set RHOSTS 1.2.3.101
msf auxiliary(sap_router_info_request) > run
```
**内部サービスの列挙**

取得した内部ネットワークの洞察を活用し、**sap_router_portscanner**モジュールを使用してSAProuterを介して内部ホストやサービスを調査し、内部ネットワークやサービス構成の深い理解を可能にします。
```text
msf auxiliary(sap_router_portscanner) > set INSTANCES 00-50
msf auxiliary(sap_router_portscanner) > set PORTS 32NN
```
**高度な列挙とACLマッピング**

さらなるスキャンにより、SAProuter上でどのようにアクセス制御リスト（ACL）が構成されているかが明らかになり、許可またはブロックされている接続が詳細にわたって示されます。この情報は、セキュリティポリシーと潜在的な脆弱性を理解する上で重要です。
```text
msf auxiliary(sap_router_portscanner) > set MODE TCP
msf auxiliary(sap_router_portscanner) > set PORTS 80,32NN
```
**内部ホストの盲目的列挙**

SAProuterからの直接情報が限られているシナリオでは、盲目的列挙などのテクニックを適用できます。このアプローチは、内部ホスト名の存在を推測し、検証することで、直接IPアドレスを使用せずに潜在的なターゲットを明らかにします。

**侵入テストのための情報の活用**

ネットワークをマッピングし、アクセス可能なサービスを特定した後、侵入テスターはMetasploitのプロキシ機能を活用して、SAProuterを介して内部SAPサービスのさらなる探査と悪用を行うことができます。
```text
msf auxiliary(sap_hostctrl_getcomputersystem) > set Proxies sapni:1.2.3.101:3299
msf auxiliary(sap_hostctrl_getcomputersystem) > set RHOSTS 192.168.1.18
msf auxiliary(sap_hostctrl_getcomputersystem) > run
```
**結論**

このアプローチは、セキュアなSAProuterの設定の重要性を強調し、ターゲット型のペネトレーションテストを通じて内部ネットワークにアクセスする可能性を示しています。 SAPルーターを適切にセキュリティ設定し、ネットワークセキュリティアーキテクチャにおける役割を理解することは、不正アクセスから保護するために重要です。

Metasploitモジュールとその使用法の詳細については、[Rapid7のデータベース](http://www.rapid7.com/db)を参照してください。


## **参考文献**

* [https://www.rapid7.com/blog/post/2014/01/09/piercing-saprouter-with-metasploit/](https://www.rapid7.com/blog/post/2014/01/09/piercing-saprouter-with-metasploit/)

## Shodan

* `port:3299 !HTTP Network packet too big`



<details>

<summary><strong>ゼロからヒーローまでのAWSハッキングを学ぶ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE（HackTricks AWS Red Team Expert）</strong></a><strong>！</strong></summary>

HackTricksをサポートする他の方法：

* **HackTricksで企業を宣伝したい**または**HackTricksをPDFでダウンロードしたい**場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS＆HackTricksスワッグ**](https://peass.creator-spring.com)を手に入れる
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)コレクションを見つける
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**telegramグループ**](https://t.me/peass)に**参加**するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)を**フォロー**してください。
* **HackTricks**および**HackTricks Cloud**のGitHubリポジトリにPRを提出して、あなたのハッキングトリックを共有してください。

</details>
