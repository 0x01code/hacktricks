# 49 - Pentesting TACACS+

<details>

<summary><strong>Aprende hacking en AWS de cero a h√©roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** revisa los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Consigue el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠gueme** en **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de github de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Informaci√≥n B√°sica

**Terminal Access Controller Access Control System (TACACS)** es un protocolo de seguridad que proporciona validaci√≥n centralizada de usuarios que intentan obtener **acceso a un router o NAS**. TACACS+, una versi√≥n m√°s reciente del protocolo TACACS original, proporciona servicios separados de autenticaci√≥n, autorizaci√≥n y contabilidad (AAA).
```
PORT   STATE  SERVICE
49/tcp open   tacacs
```
**Puerto predeterminado:** 49

## Interceptaci√≥n de Clave de Autenticaci√≥n

Si un atacante logra interponerse entre el cliente y el servidor TACACS, **puede interceptar la clave de autenticaci√≥n** en forma encriptada y luego realizar un ataque de fuerza bruta local contra ella. As√≠, realizas fuerza bruta contra la clave y no apareces en los registros. Y si logras descifrar la clave con √©xito, **podr√°s acceder al equipo de red y descifrar el tr√°fico** en **Wireshark**.

### MitM

Para realizar un ataque MitM podr√≠as usar un [**ataque de spoofing ARP**](../generic-methodologies-and-resources/pentesting-network/#arp-spoofing).

### Fuerza Bruta de la Clave

Ahora necesitas ejecutar [Loki](https://c0decafe.de/svn/codename\_loki/trunk/). Esta es una herramienta especial dise√±ada para analizar la seguridad de los protocolos L2/L3. Sus capacidades son tan buenas como las del popular **Yersinia** y es un serio competidor de este. Loki tambi√©n puede realizar fuerza bruta en las claves TACACS. Si la clave se **descifra con √©xito** (**generalmente en formato encriptado MD5)**, **podemos acceder al equipo y descifrar el tr√°fico encriptado por TACACS.**
```
sudo loki_gtk.py
```
```markdown
Tambi√©n necesitas especificar la ruta al diccionario para hacer fuerza bruta a la clave encriptada. Aseg√∫rate de desmarcar la opci√≥n **Use Bruteforce**, de lo contrario, Loki har√° fuerza bruta a la contrase√±a sin usar el diccionario.

Ahora tenemos que esperar a que un administrador inicie sesi√≥n en el dispositivo a trav√©s del servidor TACACS. Se asume que el administrador de la red ya ha iniciado sesi√≥n, y nosotros, **interceptando el tr√°fico en medio mediante ARP spoofing**, interceptamos el tr√°fico. Y al hacerlo, los hosts leg√≠timos no se dan cuenta de que alguien m√°s ha interferido con su conexi√≥n.

Ahora haz clic en el bot√≥n **CRACK** y espera a que **Loki** descifre la contrase√±a.

### Descifrar Tr√°fico

Genial, logramos desbloquear la clave, ahora necesitamos descifrar el tr√°fico TACACS. Como dije, Wireshark puede manejar el tr√°fico TACACS encriptado si la clave est√° presente.

Vemos qu√© banner se utiliz√≥.

Encontramos el nombre de usuario del usuario `admin`

Como resultado, **tenemos las credenciales `admin:secret1234`,** que se pueden utilizar para acceder al hardware en s√≠. **Creo que verificar√© su validez.**

As√≠ es como puedes atacar TACACS+ y **ganar acceso** al panel de control del equipo de red.

## Referencias

* La secci√≥n de la clave de intercepci√≥n fue copiada de [https://medium.com/@in9uz/cisco-nightmare-pentesting-cisco-networks-like-a-devil-f4032eb437b9](https://medium.com/@in9uz/cisco-nightmare-pentesting-cisco-networks-like-a-devil-f4032eb437b9)

<details>

<summary><strong>Aprende hacking en AWS de cero a h√©roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver a tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** Consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Consigue el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠gueme** en **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de github de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
```
