# 123/udp - Pentesting NTP

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Voc√™ trabalha em uma **empresa de ciberseguran√ßa**? Voc√™ quer ver sua **empresa anunciada no HackTricks**? ou voc√™ quer ter acesso √† **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**? Verifique os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* **Junte-se ao** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para o** [**reposit√≥rio hacktricks**](https://github.com/carlospolop/hacktricks) **e para o** [**reposit√≥rio hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

<figure><img src="../.gitbook/assets/image (1) (3).png" alt=""><figcaption></figcaption></figure>

**HackenProof √© o lar de todas as recompensas por bugs de criptografia.**

**Seja recompensado sem atrasos**\
As recompensas do HackenProof s√£o lan√ßadas apenas quando seus clientes depositam o or√ßamento de recompensa. Voc√™ receber√° a recompensa ap√≥s a verifica√ß√£o do bug.

**Adquira experi√™ncia em pentesting web3**\
Protocolos blockchain e contratos inteligentes s√£o a nova Internet! Domine a seguran√ßa web3 em seus dias de ascens√£o.

**Torne-se a lenda do hacker web3**\
Ganhe pontos de reputa√ß√£o com cada bug verificado e conquiste o topo do leaderboard semanal.

[**Cadastre-se no HackenProof**](https://hackenproof.com/register) comece a ganhar com seus hacks!

{% embed url="https://hackenproof.com/register" %}

## Informa√ß√µes B√°sicas

O Network Time Protocol (**NTP**) √© um protocolo de rede para sincroniza√ß√£o de rel√≥gios entre sistemas de computador em redes de dados comutadas por pacotes e lat√™ncia vari√°vel.

**Porta padr√£o:** 123/udp
```
PORT    STATE SERVICE REASON
123/udp open  ntp     udp-response
```
## Enumera√ß√£o

### NTP (Network Time Protocol)

O Network Time Protocol (NTP) √© um protocolo de rede amplamente utilizado para sincronizar o rel√≥gio dos sistemas computacionais. Ele permite que os dispositivos obtenham a hora correta de servidores NTP confi√°veis.

Durante a enumera√ß√£o do NTP, podemos realizar as seguintes etapas:

1. Identificar os servidores NTP em um determinado alvo.
2. Verificar se os servidores NTP est√£o acess√≠veis e respondendo.
3. Obter informa√ß√µes sobre os servidores NTP, como vers√£o do protocolo, configura√ß√µes e detalhes do sistema operacional.
4. Identificar poss√≠veis vulnerabilidades nos servidores NTP.

### Identificando servidores NTP

Existem v√°rias maneiras de identificar os servidores NTP em um alvo. Alguns m√©todos comuns incluem:

- Pesquisa DNS reversa: procurar registros PTR que apontem para nomes de dom√≠nio relacionados ao NTP, como "ntp.example.com".
- Pesquisa de portas abertas: verificar se as portas padr√£o do NTP (123/UDP) est√£o abertas em um determinado alvo.
- Pesquisa de servi√ßos: procurar por servi√ßos NTP em um determinado alvo usando ferramentas de enumera√ß√£o de servi√ßos, como o Nmap.

### Verificando a acessibilidade dos servidores NTP

Ap√≥s identificar os servidores NTP, √© importante verificar se eles est√£o acess√≠veis e respondendo. Isso pode ser feito enviando uma solicita√ß√£o de consulta NTP para o servidor e aguardando uma resposta. Se o servidor responder, significa que est√° acess√≠vel.

### Obtendo informa√ß√µes sobre os servidores NTP

Uma vez que os servidores NTP estejam acess√≠veis, podemos obter informa√ß√µes sobre eles. Isso pode incluir a obten√ß√£o da vers√£o do protocolo NTP, configura√ß√µes espec√≠ficas do servidor e detalhes do sistema operacional. Essas informa√ß√µes podem ser √∫teis para identificar poss√≠veis vulnerabilidades nos servidores NTP.

### Identificando vulnerabilidades nos servidores NTP

Ap√≥s obter informa√ß√µes sobre os servidores NTP, podemos realizar uma an√°lise de vulnerabilidades para identificar poss√≠veis falhas de seguran√ßa. Alguns exemplos de vulnerabilidades comuns em servidores NTP incluem:

- Ataques de amplifica√ß√£o NTP: explorar servidores NTP mal configurados para amplificar ataques DDoS.
- Explora√ß√£o de vulnerabilidades conhecidas: aproveitar vulnerabilidades conhecidas no software NTP para obter acesso n√£o autorizado ou executar c√≥digo arbitr√°rio nos servidores.

√â importante realizar testes de penetra√ß√£o √©ticos e obter permiss√£o adequada antes de realizar qualquer teste de penetra√ß√£o em servidores NTP.
```bash
ntpq -c readlist <IP_ADDRESS>
ntpq -c readvar <IP_ADDRESS>
ntpq -c peers <IP_ADDRESS>
ntpq -c associations <IP_ADDRESS>
ntpdc -c monlist <IP_ADDRESS>
ntpdc -c listpeers <IP_ADDRESS>
ntpdc -c sysinfo <IP_ADDRESS>
```

```bash
nmap -sU -sV --script "ntp* and (discovery or vuln) and not (dos or brute)" -p 123 <IP>
```
## Examinar arquivos de configura√ß√£o

* ntp.conf

## Ataque de Amplifica√ß√£o NTP

[**Como funciona o ataque DDoS NTP**](https://resources.infosecinstitute.com/network-time-protocol-ntp-threats-countermeasures/#gref)

O protocolo NTP, por design, usa UDP para operar, o que n√£o requer nenhum handshake como o TCP, portanto, n√£o h√° registro da solicita√ß√£o. Assim, o ataque de amplifica√ß√£o DDoS NTP come√ßa quando um atacante cria pacotes com um IP de origem falsificado para fazer com que os pacotes pare√ßam estar vindo do alvo pretendido e os envia para o servidor NTP. O atacante inicialmente cria o pacote com poucos bytes, mas o NTP responde com uma grande quantidade de dados, contribuindo assim para a amplifica√ß√£o desse ataque.

Comando _MONLIST_: √â um comando do protocolo NTP que tem pouco uso, mas √© esse comando que √© o principal culpado por esse ataque. No entanto, o uso do comando MONLIST √© fornecer detalhes dos √∫ltimos 600 clientes que se conectaram ao servi√ßo de tempo NTP. Abaixo est√° a sintaxe do comando:
```bash
ntpdc -n -c monlist <IP>
```
## Shodan

* `ntp`

## Comandos Autom√°ticos do HackTricks
```
Protocol_Name: NTP    #Protocol Abbreviation if there is one.
Port_Number:  123     #Comma separated if there is more than one.
Protocol_Description: Network Time Protocol         #Protocol Abbreviation Spelled out

Entry_1:
Name: Notes
Description: Notes for NTP
Note: |
The Network Time Protocol (NTP) is a networking protocol for clock synchronization between computer systems over packet-switched, variable-latency data networks.

https://book.hacktricks.xyz/pentesting/pentesting-ntp

Entry_2:
Name: Nmap
Description: Enumerate NTP
Command: nmap -sU -sV --script "ntp* and (discovery or vuln) and not (dos or brute)" -p 123 {IP}
```
<figure><img src="../.gitbook/assets/image (1) (3).png" alt=""><figcaption></figcaption></figure>

**HackenProof √© o lar de todas as recompensas por bugs de criptografia.**

**Seja recompensado sem atrasos**\
As recompensas do HackenProof s√£o lan√ßadas apenas quando seus clientes depositam o or√ßamento de recompensa. Voc√™ receber√° a recompensa depois que o bug for verificado.

**Adquira experi√™ncia em pentesting web3**\
Protocolos de blockchain e contratos inteligentes s√£o a nova Internet! Domine a seguran√ßa web3 em seus dias de ascens√£o.

**Torne-se uma lenda hacker web3**\
Ganhe pontos de reputa√ß√£o com cada bug verificado e conquiste o topo do leaderboard semanal.

[**Cadastre-se no HackenProof**](https://hackenproof.com/register) e comece a ganhar com seus hacks!

{% embed url="https://hackenproof.com/register" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Voc√™ trabalha em uma **empresa de ciberseguran√ßa**? Voc√™ quer ver sua **empresa anunciada no HackTricks**? Ou voc√™ quer ter acesso √† **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**? Verifique os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* **Junte-se ao** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para o** [**reposit√≥rio hacktricks**](https://github.com/carlospolop/hacktricks) **e** [**reposit√≥rio hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
