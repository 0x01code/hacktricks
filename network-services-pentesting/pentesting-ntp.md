# 123/udp - Pentesting NTP

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* ¬øTrabajas en una **empresa de ciberseguridad**? ¬øQuieres ver tu **empresa anunciada en HackTricks**? ¬øO quieres tener acceso a la **√∫ltima versi√≥n de PEASS o descargar HackTricks en PDF**? ¬°Consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obt√©n el [**swag oficial de PEASS y HackTricks**](https://peass.creator-spring.com)
* **√önete al** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de Telegram**](https://t.me/peass) o **s√≠gueme** en **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Comparte tus trucos de hacking enviando PRs al** [**repositorio de hacktricks**](https://github.com/carlospolop/hacktricks) **y al** [**repositorio de hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

<figure><img src="../../.gitbook/assets/image (1).png" alt=""><figcaption></figcaption></figure>

**HackenProof es el hogar de todas las recompensas por errores de criptograf√≠a.**

**Obt√©n recompensas sin demoras**\
Las recompensas de HackenProof se lanzan solo cuando sus clientes depositan el presupuesto de recompensa. Obtendr√°s la recompensa despu√©s de que se verifique el error.

**Obt√©n experiencia en pentesting web3**\
¬°Los protocolos blockchain y los contratos inteligentes son el nuevo Internet! Domina la seguridad web3 en sus d√≠as de crecimiento.

**Convi√©rtete en la leyenda del hacker web3**\
Gana puntos de reputaci√≥n con cada error verificado y conquista la cima de la clasificaci√≥n semanal.

[**Reg√≠strate en HackenProof**](https://hackenproof.com/register) y comienza a ganar con tus hacks!

{% embed url="https://hackenproof.com/register" %}

## Informaci√≥n b√°sica

El Protocolo de Tiempo de Red (**NTP**) es un protocolo de red para la sincronizaci√≥n de relojes entre sistemas inform√°ticos a trav√©s de redes de datos conmutadas por paquetes y de latencia variable.

**Puerto predeterminado:** 123/udp
```
PORT    STATE SERVICE REASON
123/udp open  ntp     udp-response
```
## Enumeraci√≥n

### NTP Enumeration

### Enumeraci√≥n de NTP

NTP (Network Time Protocol) is a protocol used to synchronize the clocks of computers over a network. It is commonly used to ensure accurate timekeeping on systems.

NTP (Network Time Protocol) es un protocolo utilizado para sincronizar los relojes de las computadoras en una red. Se utiliza com√∫nmente para garantizar una sincronizaci√≥n precisa del tiempo en los sistemas.

During the enumeration phase, we can gather information about the NTP server, such as its version, configuration, and potential vulnerabilities.

Durante la fase de enumeraci√≥n, podemos recopilar informaci√≥n sobre el servidor NTP, como su versi√≥n, configuraci√≥n y posibles vulnerabilidades.

#### NTP Version Detection

#### Detecci√≥n de la versi√≥n de NTP

To determine the version of the NTP server, we can use the `ntpdate` command with the `-q` option followed by the IP address or hostname of the server.

Para determinar la versi√≥n del servidor NTP, podemos utilizar el comando `ntpdate` con la opci√≥n `-q` seguida de la direcci√≥n IP o el nombre de host del servidor.

```bash
ntpdate -q <IP_address/hostname>
```

This command will query the NTP server and display the version information.

Este comando consultar√° el servidor NTP y mostrar√° la informaci√≥n de la versi√≥n.

#### NTP Configuration Enumeration

#### Enumeraci√≥n de la configuraci√≥n de NTP

To gather information about the NTP server's configuration, we can use the `ntpq` command with the `-p` option followed by the IP address or hostname of the server.

Para recopilar informaci√≥n sobre la configuraci√≥n del servidor NTP, podemos utilizar el comando `ntpq` con la opci√≥n `-p` seguida de la direcci√≥n IP o el nombre de host del servidor.

```bash
ntpq -p <IP_address/hostname>
```

This command will display the current status of the NTP server, including the remote servers it is synchronized with.

Este comando mostrar√° el estado actual del servidor NTP, incluidos los servidores remotos con los que est√° sincronizado.

#### NTP Vulnerability Scanning

#### Escaneo de vulnerabilidades de NTP

There are several known vulnerabilities in older versions of NTP that can be exploited by attackers. To identify potential vulnerabilities, we can use vulnerability scanning tools such as Nessus or OpenVAS.

Existen varias vulnerabilidades conocidas en versiones antiguas de NTP que pueden ser explotadas por atacantes. Para identificar posibles vulnerabilidades, podemos utilizar herramientas de escaneo de vulnerabilidades como Nessus o OpenVAS.

These tools will scan the NTP server for known vulnerabilities and provide a report of any issues found.

Estas herramientas escanear√°n el servidor NTP en busca de vulnerabilidades conocidas y proporcionar√°n un informe de cualquier problema encontrado.
```bash
ntpq -c readlist <IP_ADDRESS>
ntpq -c readvar <IP_ADDRESS>
ntpq -c peers <IP_ADDRESS>
ntpq -c associations <IP_ADDRESS>
ntpdc -c monlist <IP_ADDRESS>
ntpdc -c listpeers <IP_ADDRESS>
ntpdc -c sysinfo <IP_ADDRESS>
```

```bash
nmap -sU -sV --script "ntp* and (discovery or vuln) and not (dos or brute)" -p 123 <IP>
```
## Examinar archivos de configuraci√≥n

* ntp.conf

## Ataque de Amplificaci√≥n NTP

[**C√≥mo funciona el ataque DDoS de NTP**](https://resources.infosecinstitute.com/network-time-protocol-ntp-threats-countermeasures/#gref)

El protocolo NTP utiliza UDP por dise√±o para operar, lo cual no requiere ning√∫n saludo como TCP, por lo tanto no hay registro de la solicitud. Por lo tanto, el ataque de amplificaci√≥n DDoS de NTP comienza cuando un atacante crea paquetes con una direcci√≥n IP de origen falsificada para que los paquetes parezcan provenir del objetivo previsto y los env√≠a al servidor NTP. Inicialmente, el atacante crea un paquete de pocos bytes, pero NTP responde con una gran cantidad de datos, lo que amplifica este ataque.

Comando _MONLIST_: Es un comando del protocolo NTP que tiene muy poco uso, pero es este comando el principal culpable de este ataque. Sin embargo, el uso del comando MONLIST es proporcionar detalles de los √∫ltimos 600 clientes que se han conectado al servicio de tiempo NTP. A continuaci√≥n se muestra la sintaxis del comando:
```bash
ntpdc -n -c monlist <IP>
```
## Shodan

* `ntp`

## Comandos Autom√°ticos de HackTricks
```
Protocol_Name: NTP    #Protocol Abbreviation if there is one.
Port_Number:  123     #Comma separated if there is more than one.
Protocol_Description: Network Time Protocol         #Protocol Abbreviation Spelled out

Entry_1:
Name: Notes
Description: Notes for NTP
Note: |
The Network Time Protocol (NTP) is a networking protocol for clock synchronization between computer systems over packet-switched, variable-latency data networks.

https://book.hacktricks.xyz/pentesting/pentesting-ntp

Entry_2:
Name: Nmap
Description: Enumerate NTP
Command: nmap -sU -sV --script "ntp* and (discovery or vuln) and not (dos or brute)" -p 123 {IP}
```
<figure><img src="../../.gitbook/assets/image (1).png" alt=""><figcaption></figcaption></figure>

**HackenProof es el hogar de todas las recompensas por errores de criptograf√≠a.**

**Obt√©n recompensas sin demoras**\
Las recompensas de HackenProof se lanzan solo cuando sus clientes depositan el presupuesto de recompensa. Obtendr√°s la recompensa despu√©s de que se verifique el error.

**Obt√©n experiencia en pentesting web3**\
¬°Los protocolos de blockchain y los contratos inteligentes son el nuevo Internet! Domina la seguridad web3 en sus d√≠as de crecimiento.

**Convi√©rtete en la leyenda del hacker web3**\
Gana puntos de reputaci√≥n con cada error verificado y conquista la cima de la tabla de clasificaci√≥n semanal.

[**Reg√≠strate en HackenProof**](https://hackenproof.com/register) ¬°comienza a ganar con tus hacks!

{% embed url="https://hackenproof.com/register" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* ¬øTrabajas en una **empresa de ciberseguridad**? ¬øQuieres ver tu **empresa anunciada en HackTricks**? ¬øO quieres tener acceso a la **√∫ltima versi√≥n de PEASS o descargar HackTricks en PDF**? ¬°Consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obt√©n el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* **√önete al** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠gueme** en **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Comparte tus trucos de hacking enviando PRs al** [**repositorio de hacktricks**](https://github.com/carlospolop/hacktricks) **y al** [**repositorio de hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
