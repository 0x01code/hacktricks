# Stack Overflow

<details>

<summary><strong>Erlernen Sie AWS-Hacking von Null auf Held mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks beworben sehen m√∂chten** oder **HackTricks als PDF herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merchandise**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositories einreichen.

</details>

## Was ist ein Stack Overflow

Ein **Stack Overflow** ist eine Schwachstelle, die auftritt, wenn ein Programm mehr Daten auf den Stack schreibt, als ihm zugewiesen sind. Diese √ºbersch√ºssigen Daten werden den **angrenzenden Speicherplatz √ºberschreiben**, was zur Besch√§digung g√ºltiger Daten, zur Unterbrechung des Kontrollflusses und potenziell zur Ausf√ºhrung von b√∂sartigem Code f√ºhren kann. Dieses Problem tritt h√§ufig aufgrund der Verwendung unsicherer Funktionen auf, die keine Grenzpr√ºfung f√ºr Eingaben durchf√ºhren.

Das Hauptproblem dieses √úberschreibens besteht darin, dass die **EIP**- und **EBP**-Zeiger zum Zur√ºckkehren zur vorherigen Funktion im Stack **gespeichert sind**. Daher kann ein Angreifer diese √ºberschreiben und die **Ausf√ºhrungsreihenfolge des Programms steuern**.

Die Schwachstelle tritt normalerweise auf, weil eine Funktion **mehr Bytes in den Stack kopiert als f√ºr sie allokiert sind**, und dadurch andere Teile des Stacks √ºberschrieben werden k√∂nnen.\
Einige g√§ngige Funktionen, die anf√§llig daf√ºr sind, sind: `strcpy`, `strcat`, `sprintf`, `gets`, `fgets`...

Beispielsweise k√∂nnten die folgenden Funktionen anf√§llig sein:
```c
void vulnerable() {
char buffer[128];
printf("Enter some text: ");
gets(buffer); // This is where the vulnerability lies
printf("You entered: %s\n", buffer);
}
```
### Finden von Stack Overflows

Der h√§ufigste Weg, Stack Overflows zu finden, besteht darin, eine sehr gro√üe Eingabe von `A`s zu geben (z. B. `python3 -c 'print("A"*1000)'`) und einen `Segmentation Fault` zu erwarten, der darauf hinweist, dass die **Adresse `0x41414141` versucht wurde zuzugreifen**.

Dar√ºber hinaus, sobald festgestellt wurde, dass eine Stack Overflow-Schwachstelle besteht, muss der Offset gefunden werden, bis es m√∂glich ist, **den EIP-Pointer zu √ºberschreiben**, daf√ºr wird in der Regel eine **De Bruijn-Sequenz** verwendet. Diese Sequenz ist f√ºr ein gegebenes Alphabet der Gr√∂√üe _k_ und Teilsequenzen der L√§nge _n_ eine **zyklische Sequenz, in der jede m√∂gliche Teilsequenz der L√§nge **_**n**_** genau einmal erscheint** als zusammenh√§ngende Teilsequenz.

Auf diese Weise ist es m√∂glich, anstelle herauszufinden, welcher Offset den EIP √ºberschreibt, man eine dieser Sequenzen als Padding verwenden kann und dann den Offset der Bytes finden, die es versehentlich √ºberschrieben haben.

Es ist m√∂glich, **pwntools** daf√ºr zu verwenden:
```python
from pwn import *

# Generate a De Bruijn sequence of length 1000 with an alphabet size of 256 (byte values)
pattern = cyclic(1000)

# This is an example value that you'd have found in the EIP/IP register upon crash
eip_value = p32(0x6161616c)
offset = cyclic_find(eip_value)  # Finds the offset of the sequence in the De Bruijn pattern
print(f"The offset is: {offset}")
```
oder **GEF**:
```bash
#Patterns
pattern create 200 #Generate length 200 pattern
pattern search "avaaawaa" #Search for the offset of that substring
pattern search $rsp #Search the offset given the content of $rsp
```
## Ausnutzen von Stack Overflows

W√§hrend eines √úberlaufs (vorausgesetzt, die √úberlaufgr√∂√üe ist gro√ü genug) k√∂nnen Werte anderer Variablen im Stack √ºberschrieben werden, bis EBP und EIP (oder sogar mehr) erreicht sind.\
Der h√§ufigste Weg, diese Art von Schwachstelle auszunutzen, besteht darin, **den EIP-Zeiger zu √§ndern**, sodass die **Steuerung an die Stelle umgeleitet wird, die der Benutzer in diesem Zeiger angegeben hat**, wenn die Funktion endet.

In anderen Szenarien reicht es m√∂glicherweise aus, **nur einige Variablenwerte im Stack zu √ºberschreiben**, um die Ausnutzung zu erm√∂glichen (wie bei einfachen CTF-Herausforderungen).

### Ret2win

In dieser Art von CTF-Herausforderungen gibt es eine **Funktion** **im** Bin√§rdatei, die **nie aufgerufen wird** und die **Sie aufrufen m√ºssen, um zu gewinnen**. F√ºr diese Herausforderungen m√ºssen Sie nur den **Offset finden, um den EIP zu √ºberschreiben** und die Adresse der Funktion zu finden, die aufgerufen werden soll (normalerweise ist [**ASLR**](../common-binary-protections/aslr.md) deaktiviert), sodass beim R√ºckgabewert der verwundbaren Funktion die versteckte Funktion aufgerufen wird:

{% content-ref url="ret2win.md" %}
[ret2win.md](ret2win.md)
{% endcontent-ref %}

### Ret2Shellcode

## Arten von Schutzma√ünahmen

{% content-ref url="../common-binary-protections/" %}
[common-binary-protections](../common-binary-protections/)
{% endcontent-ref %}

<details>

<summary><strong>Erlernen Sie AWS-Hacking von Null auf Held mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks beworben sehen m√∂chten** oder **HackTricks im PDF-Format herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merch**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositories einreichen.

</details>
