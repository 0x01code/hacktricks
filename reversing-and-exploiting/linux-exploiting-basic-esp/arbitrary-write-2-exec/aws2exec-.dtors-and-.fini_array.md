# .dtors

{% hint style="danger" %}
現在では、.dtors セクションを持つバイナリを見つけるのは非常に珍しいです。
{% endhint %}

デストラクタは、プログラムが終了する前に実行される関数です（`main` 関数が返された後）。\
これらの関数へのアドレスは、バイナリの **`.dtors`** セクションに格納されており、したがって、**`__DTOR_END__`** に **シェルコード** の **アドレス** を **書き込む** ことができれば、それはプログラムが終了する前に **実行** されます。

このセクションのアドレスを取得するには次のコマンドを使用します：
```bash
objdump -s -j .dtors /exec
rabin -s /exec | grep “__DTOR”
```
通常、**DTOR** マーカーは値 `ffffffff` と `00000000` の間にあります。したがって、これらの値だけを見ると、**登録された関数はない**ことを意味します。そのため、**`00000000`** を **シェルコードのアドレス** で上書きして、それを実行します。

{% hint style="warning" %}
もちろん、まずは **シェルコードを保存する場所を見つける** 必要があります。後でそれを呼び出すためです。
{% endhint %}

## **.fini\_array**

基本的に、これはプログラムが終了する前に呼び出される**関数のセット**です。これは **`.dtors`** のようなものです。これは、**アドレスにジャンプしてシェルコードを呼び出す**ことができる場合や、**脆弱性を2回目に悪用するために再び `main` に戻る**必要がある場合に興味深いです。
```bash
objdump -s -j .fini_array ./greeting

./greeting:     file format elf32-i386

Contents of section .fini_array:
8049934 a0850408

#Put your address in 0x8049934
```
これは**永久ループ**を作成しないことに注意してください。メインに戻るときにキャナリが気づき、スタックの末尾が破損している可能性があり、関数が再度呼び出されなくなります。したがって、これにより、脆弱性の**1回の実行が追加**されます。

{% hint style="danger" %}
[Full Relro](../common-binary-protections-and-bypasses/relro.md)を使用すると、`.fini_array`セクションが**読み取り専用**になります。
{% endhint %}

<details>

<summary><strong>htARTE（HackTricks AWS Red Team Expert）</strong>でAWSハッキングをゼロからヒーローまで学ぶ</summary>

HackTricksをサポートする他の方法：

* **HackTricksで企業を宣伝**したい場合や**HackTricksをPDFでダウンロード**したい場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS＆HackTricksスウォッグ**](https://peass.creator-spring.com)を入手する
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[NFTs](https://opensea.io/collection/the-peass-family)のコレクションを見つける
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)や[**telegramグループ**](https://t.me/peass)に**参加**するか、**Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)をフォローする
* **HackTricks**と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のGitHubリポジトリにPRを提出して、あなたのハッキングトリックを共有する

</details>
