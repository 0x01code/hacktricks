# ASLR

<details>

<summary><strong>从零开始学习AWS黑客技术，成为专家</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE（HackTricks AWS红队专家）</strong></a><strong>！</strong></summary>

支持HackTricks的其他方式：

* 如果您想在HackTricks中看到您的**公司广告**或**下载PDF格式的HackTricks**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)!
* 获取[**官方PEASS & HackTricks周边产品**](https://peass.creator-spring.com)
* 探索[**PEASS家族**](https://opensea.io/collection/the-peass-family)，我们的独家[NFT](https://opensea.io/collection/the-peass-family)收藏品
* **加入** 💬 [**Discord群**](https://discord.gg/hRep4RUj7f) 或 [**电报群**](https://t.me/peass) 或在**Twitter**上关注我们 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**。**
* 通过向[**HackTricks**](https://github.com/carlospolop/hacktricks)和[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github仓库提交PR来分享您的黑客技巧。

</details>

## ASLR

**地址空间布局随机化（ASLR）**是操作系统中使用的一种安全技术，用于**随机化系统和应用程序进程使用的内存地址**。通过这样做，它显著增加了攻击者预测特定进程和数据位置（如堆栈、堆和库）的难度，从而减轻了某些类型的利用，特别是缓冲区溢出。

### **ASLR并非完全随机**

PaX将进程地址空间分为**3组**：

* **代码和数据**（已初始化和未初始化）：`.text`、`.data`和`.bss` —> `delta_exec`变量中的**16位**熵。此变量在每个进程中随机初始化，并添加到初始地址。
* 由`mmap()`分配的**内存**和**共享库** —> **16位**，名为`delta_mmap`。
* **堆栈** —> **24位**，称为`delta_stack`。但实际上只使用**11位**（从第10到第20个字节，包括在内），对齐到**16字节** —> 这导致**524,288个可能的真实堆栈地址**。

上述数据适用于32位系统，降低的最终熵使得可以通过多次重试执行直到利用成功来绕过ASLR。

在64位系统中，熵要高得多，这是不可能的。

### **检查ASLR状态**

要在Linux系统上**检查**ASLR状态，您可以从`/proc/sys/kernel/randomize_va_space`文件中读取值。此文件中存储的值确定应用的ASLR类型：

* **0**：无随机化。一切都是静态的。
* **1**：保守随机化。共享库、堆栈、mmap()、VDSO页面被随机化。
* **2**：完全随机化。除了保守随机化随机化的元素外，通过`brk()`管理的内存也被随机化。

您可以使用以下命令检查ASLR状态：
```bash
bashCopy codecat /proc/sys/kernel/randomize_va_space
```
### **禁用 ASLR**

要**禁用** ASLR，您需要将 `/proc/sys/kernel/randomize_va_space` 的值设置为 **0**。通常不建议在测试或调试场景之外禁用 ASLR。以下是禁用方法：
```bash
echo 0 | sudo tee /proc/sys/kernel/randomize_va_space
```
您还可以通过以下方式禁用执行的ASLR：
```bash
setarch `arch` -R ./bin args
setarch `uname -m` -R ./bin args
```
### **启用ASLR**

要**启用**ASLR，您可以将值**2**写入`/proc/sys/kernel/randomize_va_space`文件。通常需要root权限。可以使用以下命令启用完全随机化：
```bash
echo 2 | sudo tee /proc/sys/kernel/randomize_va_space
```
### **跨重启保持**

使用`echo`命令进行的更改是临时的，将在重新启动时重置。要使更改持久化，您需要编辑`/etc/sysctl.conf`文件并添加或修改以下行：
```tsconfig
kernel.randomize_va_space=2 # Enable ASLR
# or
kernel.randomize_va_space=0 # Disable ASLR
```
编辑`/etc/sysctl.conf`后，使用以下命令应用更改：
```bash
sudo sysctl -p
```
这将确保您的ASLR设置在重新启动后保持不变。

<details>

<summary><strong>从零开始学习AWS黑客技术，成为专家</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE（HackTricks AWS红队专家）</strong></a><strong>！</strong></summary>

支持HackTricks的其他方式：

* 如果您想看到您的**公司在HackTricks中做广告**或**下载PDF格式的HackTricks**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)!
* 获取[**官方PEASS & HackTricks周边产品**](https://peass.creator-spring.com)
* 探索[**PEASS家族**](https://opensea.io/collection/the-peass-family)，我们的独家[**NFTs**](https://opensea.io/collection/the-peass-family)
* **加入** 💬 [**Discord群**](https://discord.gg/hRep4RUj7f) 或 [**电报群**](https://t.me/peass) 或 **关注**我们的**Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**。**
* 通过向[**HackTricks**](https://github.com/carlospolop/hacktricks)和[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github仓库提交PR来分享您的黑客技巧。

</details>
