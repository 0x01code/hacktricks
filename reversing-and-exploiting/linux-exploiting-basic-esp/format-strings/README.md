# Format Strings

<details>

<summary><strong>AWS hacklemeyi sıfırdan ileri seviyeye öğrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> ile!</strong></summary>

* **Bir siber güvenlik şirketinde mi çalışıyorsunuz? Şirketinizin HackTricks'te reklamını görmek ister misiniz? ya da PEASS'ın en son sürümüne erişmek veya HackTricks'i PDF olarak indirmek ister misiniz? [**ABONELİK PLANLARI**](https://github.com/sponsors/carlospolop)'na göz atın!
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) koleksiyonumuzu keşfedin, özel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family)
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* **Katılın** [**💬**](https://emojipedia.org/speech-balloon/) [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katılın veya **Twitter** 🐦[**@carlospolopm**](https://twitter.com/hacktricks\_live)**'u takip edin.**
* **Hacking püf noktalarınızı göndererek PR'ler oluşturarak** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **ve** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **ile paylaşın.**

</details>

## Temel Bilgiler

C'de **`printf`** bir dizeyi yazdırmak için kullanılabilen bir işlevdir. Bu işlevin beklediği **ilk parametre**, **biçimleyicilerle** birlikte **ham metindir**. Beklenen **sonraki parametreler**, ham metinden **biçimleyicileri** **yerine koymak için değerlerdir**.

Zafiyet, bir **saldırgan metnin bu işlevin ilk argümanı olarak** konulduğunda ortaya çıkar. Saldırgan, **printf biçim dizesi yeteneklerini kötüye kullanarak** **herhangi bir veriyi herhangi bir adrese yazmak** için **özel bir giriş oluşturabilir**. Bu şekilde **keyfi kod yürütebilir** hale gelir.

Biçimleyiciler:
```bash
%08x —> 8 hex bytes
%d —> Entire
%u —> Unsigned
%s —> String
%n —> Number of written bytes
%hn —> Occupies 2 bytes instead of 4
<n>$X —> Direct access, Example: ("%3$d", var1, var2, var3) —> Access to var3
```
**`%n`** komutu belirtilen adrese yazılan bayt sayısını yazar. Yazılması gereken onaltılık sayı kadar bayt yazarak herhangi bir veriyi yazabilirsiniz.
```bash
AAAA%.6000d%4\$n —> Write 6004 in the address indicated by the 4º param
AAAA.%500\$08x —> Param at offset 500
```
### **Sızma Akışı**

Daha önce açıklandığı gibi, bu zafiyetin **herhangi bir adrese herhangi bir şey yazılmasına (keyfi yazma)** izin verir.

Amacımız daha sonra çağrılacak bir **fonksiyonun adresini** **üzerine yazmak** olacak. İdeal olarak, adresi yürütülebilir bir bölümde bulunan bir **shellcode**'a ayarlayabilirdik, ancak muhtemelen yürütülebilir bir bölümde bir shellcode yazamayacaksınız.\
Bu nedenle, bir **kullanıcıdan argümanlarını alan bir fonksiyonu üzerine yazmak** ve onu **`system`** **fonksiyonuna işaret etmek** için farklı bir seçenek vardır.

Adresi yazmak için genellikle 2 adım atılır: İlk olarak adresin **2 baytını yazarsınız** ve ardından diğer 2'sini. Bunu yapmak için **`$hn`** kullanılır.

**HOB**, adresin 2 daha yüksek baytını çağırır\
**LOB**, adresin 2 daha düşük baytını çağırır

Bu nedenle, format dizesinin nasıl çalıştığından dolayı, önce \[HOB, LOB]'nin **en küçüğünü yazmanız** ve ardından diğerini yazmanız gerekir.

Eğer HOB < LOB ise\
`[adres+2][adres]%.[HOB-8]x%[offset]\$hn%.[LOB-HOB]x%[offset+1]`

Eğer HOB > LOB ise\
`[adres+2][adres]%.[LOB-8]x%[offset+1]\$hn%.[HOB-LOB]x%[offset]`

HOB LOB HOB\_shellcode-8 NºParam\_dir\_HOB LOB\_shell-HOB\_shell NºParam\_dir\_LOB

\`python -c 'print "\x26\x97\x04\x08"+"\x24\x97\x04\x08"+ "%.49143x" + "%4$hn" + "%.15408x" + "%5$hn"'\`

## Pwntools Şablonu

Bu tür bir zafiyet için bir saldırı hazırlamak için bir şablonu aşağıda bulabilirsiniz:

{% content-ref url="format-strings-template.md" %}
[format-strings-template.md](format-strings-template.md)
{% endcontent-ref %}

<details>

<summary><strong>Sıfırdan başlayarak AWS hacklemeyi</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> öğrenin!</strong></summary>

* **Bir siber güvenlik şirketinde mi çalışıyorsunuz? Şirketinizi HackTricks'te reklamını görmek ister misiniz? veya PEASS'ın en son sürümüne erişmek veya HackTricks'i PDF olarak indirmek ister misiniz?** [**ABONELİK PLANLARI**](https://github.com/sponsors/carlospolop)'na göz atın!
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) koleksiyonumuzu keşfedin, özel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family)
* [**Resmi PEASS & HackTricks ürünlerimizi alın**](https://peass.creator-spring.com)
* **💬** [**Discord grubuna**](https://discord.gg/hRep4RUj7f) katılın veya [**telegram grubuna**](https://t.me/peass) katılın veya beni **Twitter** 🐦[**@carlospolopm**](https://twitter.com/hacktricks\_live)**'da takip edin.**
* **Hacking püf noktalarınızı paylaşarak PR'lar göndererek** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **ve** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **ile katkıda bulunun.**

</details>
