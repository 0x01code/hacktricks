# Cha√Ænes de format

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Expert en √©quipe rouge AWS de HackTricks)</strong></a><strong>!</strong></summary>

* Travaillez-vous dans une **entreprise de cybers√©curit√©**? Voulez-vous voir votre **entreprise annonc√©e dans HackTricks**? ou voulez-vous avoir acc√®s √† la **derni√®re version du PEASS ou t√©l√©charger HackTricks en PDF**? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**üí¨**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**repo hacktricks**](https://github.com/carlospolop/hacktricks) **et** [**repo hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Informations de base

En C, **`printf`** est une fonction qui peut √™tre utilis√©e pour **afficher** une cha√Æne de caract√®res. Le **premier param√®tre** que cette fonction attend est le **texte brut avec les formateurs**. Les **param√®tres suivants** attendus sont les **valeurs** √† **substituer** aux **formateurs** du texte brut.

La vuln√©rabilit√© appara√Æt lorsque un **texte d'attaquant est mis en tant que premier argument** de cette fonction. L'attaquant pourra cr√©er une **entr√©e sp√©ciale en abusant** des **capacit√©s de cha√Æne de format printf** pour **√©crire n'importe quelle donn√©e √† n'importe quelle adresse**. En √©tant capable de cette mani√®re d'**ex√©cuter du code arbitraire**.

Formateurs:
```bash
%08x ‚Äî> 8 hex bytes
%d ‚Äî> Entire
%u ‚Äî> Unsigned
%s ‚Äî> String
%n ‚Äî> Number of written bytes
%hn ‚Äî> Occupies 2 bytes instead of 4
<n>$X ‚Äî> Direct access, Example: ("%3$d", var1, var2, var3) ‚Äî> Access to var3
```
**`%n`** **√©crit** le **nombre d'octets √©crits** √† l'**adresse indiqu√©e. √âcrire** autant **d'octets** que le nombre hexad√©cimal dont nous **avons besoin** d'√©crire est comment vous pouvez **√©crire n'importe quelle donn√©e**.
```bash
AAAA%.6000d%4\$n ‚Äî> Write 6004 in the address indicated by the 4¬∫ param
AAAA.%500\$08x ‚Äî> Param at offset 500
```
### **Flux de l'exploit**

Comme expliqu√© pr√©c√©demment, cette vuln√©rabilit√© permet d'**√©crire n'importe quoi √† n'importe quelle adresse (√©criture arbitraire).**

Le but va √™tre de **remplacer** l'**adresse** d'une **fonction** dans la **table GOT** qui sera appel√©e plus tard. Id√©alement, nous pourrions d√©finir l'**adresse sur un shellcode** situ√© dans une section ex√©cutable, mais il est tr√®s probable que vous ne puissiez pas √©crire un shellcode dans une section ex√©cutable.\
Une autre option est de **remplacer** une **fonction** qui **re√ßoit** ses **arguments** de l'**utilisateur** et de la **rediriger** vers la **fonction `system`**.

Pour √©crire l'adresse, g√©n√©ralement 2 √©tapes sont effectu√©es : Vous **√©crivez d'abord 2 octets** de l'adresse, puis les 2 autres. Pour ce faire, on utilise **`$hn`**.

**HOB** est appel√© pour les 2 octets les plus √©lev√©s de l'adresse\
**LOB** est appel√© pour les 2 octets les plus bas de l'adresse

Ainsi, en raison du fonctionnement des cha√Ænes de format, vous devez **d'abord √©crire le plus petit** des \[HOB, LOB] puis l'autre.

Si HOB < LOB\
`[adresse+2][adresse]%.[HOB-8]x%[d√©calage]\$hn%.[LOB-HOB]x%[d√©calage+1]`

Si HOB > LOB\
`[adresse+2][adresse]%.[LOB-8]x%[d√©calage+1]\$hn%.[HOB-LOB]x%[d√©calage]`

HOB LOB HOB\_shellcode-8 N¬∫Param\_dir\_HOB LOB\_shell-HOB\_shell N¬∫Param\_dir\_LOB

\`python -c 'print "\x26\x97\x04\x08"+"\x24\x97\x04\x08"+ "%.49143x" + "%4$hn" + "%.15408x" + "%5$hn"'\`

## Mod√®le Pwntools

Vous pouvez trouver un mod√®le pour pr√©parer une exploitation de ce type de vuln√©rabilit√© dans :

{% content-ref url="format-strings-template.md" %}
[format-strings-template.md](format-strings-template.md)
{% endcontent-ref %}

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Travaillez-vous dans une **entreprise de cybers√©curit√©** ? Voulez-vous voir votre **entreprise annonc√©e dans HackTricks** ? ou voulez-vous avoir acc√®s √† la **derni√®re version du PEASS ou t√©l√©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**üí¨**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez-moi** sur **Twitter** üê¶[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR au** [**d√©p√¥t hacktricks**](https://github.com/carlospolop/hacktricks) **et au** [**d√©p√¥t hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
