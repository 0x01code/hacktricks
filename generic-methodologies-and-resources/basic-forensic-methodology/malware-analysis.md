# Kötü Amaçlı Yazılım Analizi

<details>

<summary><strong>Sıfırdan kahraman olana kadar AWS hackleme öğrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Kırmızı Takım Uzmanı)</strong></a><strong>!</strong></summary>

HackTricks'ı desteklemenin diğer yolları:

* **Şirketinizi HackTricks'te reklamınızı görmek istiyorsanız** veya **HackTricks'i PDF olarak indirmek istiyorsanız** [**ABONELİK PLANLARI**]'na göz atın (https://github.com/sponsors/carlospolop)!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* [**PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keşfedin, özel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* **Katılın** 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) veya bizi **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)** takip edin.**
* **Hacking püf noktalarınızı paylaşarak PR'lar göndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına katkıda bulunun.

</details>

## Adli Bilişim Hile Kağıtları

[https://www.jaiminton.com/cheatsheet/DFIR/#](https://www.jaiminton.com/cheatsheet/DFIR/)

## Çevrimiçi Hizmetler

* [VirusTotal](https://www.virustotal.com/gui/home/upload)
* [HybridAnalysis](https://www.hybrid-analysis.com)
* [Koodous](https://koodous.com)
* [Intezer](https://analyze.intezer.com)
* [Any.Run](https://any.run/)

## Çevrimdışı Antivirüs ve Algılama Araçları

### Yara

#### Kurulum
```bash
sudo apt-get install -y yara
```
#### Kuralları hazırlayın

Bu betiği kullanarak github'dan tüm yara kötü amaçlı yazılım kurallarını indirin ve birleştirin: [https://gist.github.com/andreafortuna/29c6ea48adf3d45a979a78763cdc7ce9](https://gist.github.com/andreafortuna/29c6ea48adf3d45a979a78763cdc7ce9)\
_**rules**_ adlı bir dizin oluşturun ve betiği çalıştırın. Bu, kötü amaçlı yazılımlar için tüm yara kurallarını içeren _**malware\_rules.yar**_ adlı bir dosya oluşturacaktır.
```bash
wget https://gist.githubusercontent.com/andreafortuna/29c6ea48adf3d45a979a78763cdc7ce9/raw/4ec711d37f1b428b63bed1f786b26a0654aa2f31/malware_yara_rules.py
mkdir rules
python malware_yara_rules.py
```
#### Tarama
```bash
yara -w malware_rules.yar image  #Scan 1 file
yara -w malware_rules.yar folder #Scan the whole folder
```
#### YaraGen: Zararlı yazılım kontrolü ve kurallar oluşturma

[**YaraGen**](https://github.com/Neo23x0/yarGen) aracını kullanarak bir ikiliden yara kuralları oluşturabilirsiniz. Bu eğitimlere göz atın: [**Bölüm 1**](https://www.nextron-systems.com/2015/02/16/write-simple-sound-yara-rules/), [**Bölüm 2**](https://www.nextron-systems.com/2015/10/17/how-to-write-simple-but-sound-yara-rules-part-2/), [**Bölüm 3**](https://www.nextron-systems.com/2016/04/15/how-to-write-simple-but-sound-yara-rules-part-3/)
```bash
python3 yarGen.py --update
python3.exe yarGen.py --excludegood -m  ../../mals/
```
### ClamAV

#### Kurulum
```
sudo apt-get install -y clamav
```
#### Tarama
```bash
sudo freshclam      #Update rules
clamscan filepath   #Scan 1 file
clamscan folderpath #Scan the whole folder
```
### [Capa](https://github.com/mandiant/capa)

**Capa**, yürütülebilir dosyalardaki (PE, ELF, .NET) potansiyel olarak kötü niyetli **yetenekleri** tespit eder. Bu nedenle Att\&ck taktikleri gibi şeyleri veya şüpheli yetenekleri bulacaktır:

- OutputDebugString hatasını kontrol et
- bir hizmet olarak çalıştır
- işlem oluştur

[**Github deposundan**](https://github.com/mandiant/capa) edinin.

### IOC'ler

IOC, Tehdit Belirleyici anlamına gelir. Bir IOC, bazı potansiyel istenmeyen yazılımları veya onaylanmış **zararlı yazılımları tanımlayan koşullar** kümesidir. Mavi Takımlar, bu tür kötü niyetli dosyaları **sistemlerinde** ve **ağlarında aramak** için bu tür tanımlamaları kullanır.\
Bu tanımlamaları paylaşmak, bir bilgisayarda zararlı yazılım tanımlandığında ve o zararlı yazılım için bir IOC oluşturulduğunda, diğer Mavi Takımların zararlı yazılımı daha hızlı tanımlamasına yardımcı olur.

IOC'ler oluşturmak veya değiştirmek için bir araç [**IOC Editor**](https://www.fireeye.com/services/freeware/ioc-editor.html)**'dır.**\
[**Redline**](https://www.fireeye.com/services/freeware/redline.html) gibi araçları kullanarak bir cihazda tanımlanmış IOC'leri **aramak** mümkündür.

### Loki

[**Loki**](https://github.com/Neo23x0/Loki), Basit Tehdit Göstergeleri için bir tarayıcıdır.\
Tespit, dört tespit yöntemine dayanmaktadır:
```
1. File Name IOC
Regex match on full file path/name

2. Yara Rule Check
Yara signature matches on file data and process memory

3. Hash Check
Compares known malicious hashes (MD5, SHA1, SHA256) with scanned files

4. C2 Back Connect Check
Compares process connection endpoints with C2 IOCs (new since version v.10)
```
### Linux Zararlı Yazılım Tespiti

[**Linux Zararlı Yazılım Tespit (LMD)**](https://www.rfxn.com/projects/linux-malware-detect/), GNU GPLv2 lisansı altında yayınlanan, paylaşımlı barındırma ortamlarında karşılaşılan tehditlere odaklanan bir Linux zararlı yazılım tarayıcısıdır. Ağ kenarı sızma tespit sistemlerinden tehdit verileri kullanarak saldırılarda aktif olarak kullanılan zararlı yazılımları çıkartır ve tespit için imzalar oluşturur. Ayrıca, tehdit verileri, LMD ödeme özelliği ve zararlı yazılım topluluk kaynakları ile kullanıcı gönderimlerinden de elde edilir.

### rkhunter

[**rkhunter**](http://rkhunter.sourceforge.net) gibi araçlar, dosya sisteminde olası **rootkit** ve zararlı yazılımları kontrol etmek için kullanılabilir.
```bash
sudo ./rkhunter --check -r / -l /tmp/rkhunter.log [--report-warnings-only] [--skip-keypress]
```
### FLOSS

[**FLOSS**](https://github.com/mandiant/flare-floss) farklı teknikler kullanarak yürütülebilir dosyalar içinde şifrelenmiş dizeleri bulmaya çalışan bir araçtır.

### PEpper

[PEpper ](https://github.com/Th3Hurrican3/PEpper) yürütülebilir dosyanın içinde bazı temel bilgileri kontrol eder (ikili veri, entropi, URL'ler ve IP'ler, bazı yara kuralları).

### PEstudio

[PEstudio](https://www.winitor.com/download) Windows yürütülebilir dosyalar hakkında bilgi almayı sağlayan bir araçtır; içeri aktarımlar, dışarı aktarımlar, başlıklar gibi, ayrıca virüs toplamını kontrol eder ve potansiyel Att\&ck tekniklerini bulur.

### Detect It Easy(DiE)

[**DiE**](https://github.com/horsicq/Detect-It-Easy/) bir dosyanın **şifreli** olup olmadığını tespit etmek ve **paketleyicileri** bulmak için bir araçtır.

### NeoPI

[**NeoPI** ](https://github.com/CiscoCXSecurity/NeoPI) metin/skript dosyaları içindeki **şifrelenmiş** ve **şifrelenmiş** içeriği tespit etmek için çeşitli **istatistiksel yöntemler** kullanan bir Python betiğidir. NeoPI'nin amaçlanan amacı, **gizli web kabuk kodunun tespitine yardımcı olmaktır**.

### **php-malware-finder**

[**PHP-malware-finder**](https://github.com/nbs-system/php-malware-finder) **şifrelenmiş**/**şüpheli kodları** ve genellikle **kötü amaçlı yazılımlarda**/web kabuklarında kullanılan **PHP** işlevlerini içeren dosyaları tespit etmek için elinden geleni yapar.

### Apple Binary Signatures

Bazı **kötü amaçlı yazılım örneğini** kontrol ederken, binary'nin **imzasını kontrol etmek** her zaman önemlidir çünkü imzayı atan **geliştirici** muhtemelen zaten **kötü amaçlı yazılımla ilişkilidir.**
```bash
#Get signer
codesign -vv -d /bin/ls 2>&1 | grep -E "Authority|TeamIdentifier"

#Check if the app’s contents have been modified
codesign --verify --verbose /Applications/Safari.app

#Check if the signature is valid
spctl --assess --verbose /Applications/Safari.app
```
## Algılama Teknikleri

### Dosya Yığma

Eğer bir web sunucusunun **dosyalarını içeren bir klasörün** en son ne zaman **güncellendiğini** biliyorsanız, **web sunucusundaki tüm dosyaların oluşturulma ve değiştirilme tarihlerini kontrol edin** ve herhangi bir tarih **şüpheli** ise o dosyayı kontrol edin.

### Temel Çizgiler

Bir klasörün dosyalarının **değiştirilmemesi gerektiğini** biliyorsanız, klasörün **orijinal dosyalarının** **hash'ini hesaplayabilir** ve **şu anki** dosyalarla **karşılaştırabilirsiniz**. Değiştirilen her şey **şüpheli** olacaktır.

### İstatistiksel Analiz

Bilgiler loglarda kaydedildiğinde, bir web sunucusunun her dosyasının kaç kez erişildiği gibi istatistikleri **kontrol edebilirsiniz**, çünkü bir web kabuğu en çok kullanılanlardan biri olabilir.
