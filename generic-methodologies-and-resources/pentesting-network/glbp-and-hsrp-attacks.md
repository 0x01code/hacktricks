# GLBP & HSRP Saldırıları

<details>

<summary><strong>AWS hacklemeyi sıfırdan kahraman olmak için</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Kırmızı Takım Uzmanı)</strong></a><strong>öğrenin!</strong></summary>

HackTricks'i desteklemenin diğer yolları:

* Şirketinizi **HackTricks'te reklam vermek isterseniz** veya **HackTricks'i PDF olarak indirmek isterseniz** [**ABONELİK PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keşfedin, özel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın** veya **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**'ı takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına **PR göndererek paylaşın**.

</details>


## FHRP Hijacking Genel Bakış

### FHRP Hakkında Bilgiler
FHRP, birden fazla yönlendiriciyi tek bir sanal birimde birleştirerek ağın sağlamlığını sağlamak için tasarlanmıştır, böylece yük dağıtımını ve hata tolere edebilirliği artırır. Cisco Systems, bu pakette GLBP ve HSRP gibi önde gelen protokoller tanıttı.

### GLBP Protokolü Hakkında Bilgiler
Cisco'nun yaratımı olan GLBP, TCP/IP yığınında çalışır ve iletişim için UDP'yi 3222 numaralı bağlantı noktasında kullanır. GLBP grubundaki yönlendiriciler, 3 saniye aralıklarla "hello" paketleri alışverişi yapar. Bir yönlendirici bu paketleri 10 saniye boyunca göndermezse, çevrimdışı olduğu varsayılır. Bununla birlikte, bu zamanlayıcılar sabit değildir ve değiştirilebilir.

### GLBP İşlemleri ve Yük Dağıtımı
GLBP, tek bir sanal IP ile birden fazla sanal MAC adresi kullanarak yönlendiriciler arasında yük dağıtımını sağlayarak öne çıkar. Bir GLBP grubunda, her yönlendirici paket iletimine dahil olur. HSRP/VRRP'nin aksine, GLBP birkaç mekanizma aracılığıyla gerçek yük dengelemesi sunar:

- **Ana Bilgisayara Bağımlı Yük Dengelemesi:** Bir ana bilgisayara sürekli AVF MAC adresi atamasını sağlar, istikrarlı NAT yapılandırmaları için önemlidir.
- **Round-Robin Yük Dengelemesi:** Varsayılan yaklaşım, isteyen ana bilgisayarlara yönelik AVF MAC adresi atamasını sırayla yapar.
- **Ağırlıklı Round-Robin Yük Dengelemesi:** Önceden belirlenmiş "Ağırlık" metriklerine dayanarak yükü dağıtır.

### GLBP'deki Ana Bileşenler ve Terimler
- **AVG (Aktif Sanal Ağ Geçidi):** MAC adreslerini eş yönlendiricilere atama sorumluluğu olan ana yönlendirici.
- **AVF (Aktif Sanal İletici):** Ağ trafiğini yönetmek için belirlenen bir yönlendirici.
- **GLBP Önceliği:** AVG'yi belirleyen bir metrik, varsayılan olarak 100'den başlar ve 1 ile 255 arasında değişir.
- **GLBP Ağırlığı:** Bir yönlendiricideki mevcut yükü yansıtır, manuel olarak veya Nesne İzleme aracılığıyla ayarlanabilir.
- **GLBP Sanal IP Adresi:** Bağlı tüm cihazlar için ağın varsayılan ağ geçidi olarak hizmet verir.

GLBP, etkileşimler için ayrılmış çoklu yayın adresi 224.0.0.102 ve UDP bağlantı noktası 3222'yi kullanır. Yönlendiriciler "hello" paketlerini 3 saniye aralıklarla ileterek, bir paket 10 saniye boyunca kaçırılırsa işlevsiz kabul edilir.

### GLBP Saldırı Mekanizması
Bir saldırgan, GLBP paketi göndererek en yüksek öncelik değeri (255) ile birincil yönlendirici olabilir. Bu, trafik yakalama veya yönlendirme izni veren DoS veya MITM saldırılarına yol açabilir.

### Loki ile GLBP Saldırısı Gerçekleştirme
[Loki](https://github.com/raizo62/loki_on_kali), öncelik ve ağırlık değeri 255 olarak ayarlanmış bir paket enjekte ederek bir GLBP saldırısı gerçekleştirebilir. Saldırı öncesi adımlar, Wireshark gibi araçlar kullanarak sanal IP adresi, kimlik doğrulama varlığı ve yönlendirici öncelik değerleri gibi bilgileri toplamayı içerir.

Saldırı Adımları:
1. Promisküs moduna geçin ve IP yönlendirmeyi etkinleştirin.
2. Hedef yönlendiriciyi belirleyin ve IP'sini alın.
3. Bir Gratuitous ARP oluşturun.
4. AVG'yi taklit eden kötü niyetli bir GLBP paketi enjekte edin.
5. Saldırganın ağ arayüzüne GLBP sanal IP'sini yansıtan ikincil bir IP adresi atayın.
6. Tam trafik görünürlüğü için SNAT uygulayın.
7. İnternet erişimini orijinal AVG yönlendiricisi üzerinden devam ettirmek için yönlendirmeyi ayarlayın.

Bu adımları takip ederek, saldırgan kendisini ağ trafiğini, şifrelenmemiş veya hassas verileri de içeren bir "orta adam" olarak konumlandırır ve analiz edebilir.

Demonstrasyon için gereken komut parçaları aşağıda verilmiştir:
```bash
# Enable promiscuous mode and IP forwarding
sudo ip link set eth0 promisc on
sudo sysctl -w net.ipv4.ip_forward=1

# Configure secondary IP and SNAT
sudo ifconfig eth0:1 10.10.100.254 netmask 255.255.255.0
sudo iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE

# Adjust routing
sudo route del default
sudo route add -net 0.0.0.0 netmask 0.0.0.0 gw 10.10.100.100
```
### HSRP Hijacking ile İlgili Pasif Açıklama ve Komut Detayları

#### HSRP'nin Genel Bakışı (Hot Standby Router/Redundancy Protocol)
HSRP, ağ geçidi yedekliliği için tasarlanmış Cisco'ya ait bir protokoldür. Birden fazla fiziksel yönlendiriciyi paylaşılan bir IP adresine sahip tek bir mantıksal birim olarak yapılandırmayı sağlar. Bu mantıksal birim, trafiği yönlendiren birincil bir yönlendirici tarafından yönetilir. Yük dengelemesi için öncelik ve ağırlık gibi metrikler kullanan GLBP'nin aksine, HSRP trafiği yönetmek için tek bir etkin yönlendiriciye dayanır.

#### HSRP'deki Roller ve Terimler
- **HSRP Etkin Yönlendirici**: Trafik akışını yöneten ağ geçidi olarak hareket eden cihaz.
- **HSRP Bekleme Yönlendirici**: Etkin yönlendirici başarısız olduğunda devralmaya hazır olan yedek yönlendirici.
- **HSRP Grubu**: Tek bir dayanıklı sanal yönlendirici oluşturmak için işbirliği yapan yönlendiricilerin bir kümesi.
- **HSRP MAC Adresi**: HSRP yapılandırmasındaki mantıksal yönlendiriciye atanan sanal MAC adresi.
- **HSRP Sanal IP Adresi**: HSRP grubunun sanal IP adresi, bağlı cihazlar için varsayılan ağ geçidi olarak hareket eder.

#### HSRP Sürümleri
HSRP iki sürümde gelir, HSRPv1 ve HSRPv2, grup kapasitesi, çoklu yayın IP kullanımı ve sanal MAC adresi yapısı gibi farklılıklar gösterir. Protokol, hizmet bilgileri alışverişi için belirli çoklu yayın IP adreslerini kullanır ve Hello paketleri her 3 saniyede bir gönderilir. Bir yönlendiriciye 10 saniye içinde hiç paket alınmazsa etkin olmadığı varsayılır.

#### HSRP Saldırı Mekanizması
HSRP saldırıları, en yüksek öncelik değerini enjekte ederek Etkin Yönlendirici'nin rolünü zorla ele geçirmeyi içerir. Bu, Man-In-The-Middle (MITM) saldırısına yol açabilir. Ön saldırı adımları arasında HSRP yapılandırması hakkında veri toplamak yer alır ve bunu trafik analizi için Wireshark kullanarak yapabilirsiniz.

#### HSRP Kimlik Doğrulamasını Geçme Adımları
1. HSRP verilerini içeren ağ trafiğini .pcap dosyası olarak kaydedin.
```shell
tcpdump -w hsrp_traffic.pcap
```
2. hsrp2john.py kullanarak .pcap dosyasından MD5 karma değerlerini çıkarın.
```shell
python2 hsrp2john.py hsrp_traffic.pcap > hsrp_hashes
```
3. John the Ripper kullanarak MD5 karma değerlerini kırın.
```shell
john --wordlist=mywordlist.txt hsrp_hashes
```

**Loki ile HSRP Enjeksiyonu Gerçekleştirme**

1. HSRP reklamlarını tanımlamak için Loki'yi başlatın.
2. Ağ arayüzünü promiscuous moduna ve IP yönlendirmeyi etkinleştirin.
```shell
sudo ip link set eth0 promisc on
sudo sysctl -w net.ipv4.ip_forward=1
```
3. Loki'yi kullanarak belirli yönlendiriciyi hedefleyin, kırılmış HSRP şifresini girin ve Etkin Yönlendirici'yi taklit etmek için gerekli yapılandırmaları yapın.
4. Etkin Yönlendirici rolünü aldıktan sonra, ağ arayüzünü ve IP tablolarınızı meşru trafiği yakalamak için yapılandırın.
```shell
sudo ifconfig eth0:1 10.10.100.254 netmask 255.255.255.0
sudo iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
```
5. Trafik yönlendirmesini eski Etkin Yönlendirici üzerinden yönlendirmek için yönlendirme tablosunu değiştirin.
```shell
sudo route del default
sudo route add -net 0.0.0.0 netmask 0.0.0.0 gw 10.10.100.100
```
6. Yakalanan trafiğe net-creds.py veya benzer bir araç kullanarak kimlik bilgilerini yakalayın.
```shell
sudo python2 net-creds.py -i eth0
```

Bu adımları uygulamak, GLBP ele geçirme işlemi için yapılan işlemlere benzer şekilde saldırganı trafiği yakalamak ve manipüle etmek için bir konuma yerleştirir. Bu, HSRP gibi yedeklilik protokollerindeki zayıflığı ve sağlam güvenlik önlemlerine olan ihtiyacı vurgular.


## Kaynaklar
- [https://medium.com/@in9uz/cisco-nightmare-pentesting-cisco-networks-like-a-devil-f4032eb437b9](https://medium.com/@in9uz/cisco-nightmare-pentesting-cisco-networks-like-a-devil-f4032eb437b9)


<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sıfırdan kahraman olmak için AWS hackleme öğrenin!</summary>

HackTricks'ı desteklemenin diğer yolları:

* Şirketinizi HackTricks'te **reklamınızı görmek veya HackTricks'i PDF olarak indirmek** için [**ABONELİK PLANLARI**](https://github.com/sponsors/carlospolop)'na göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin.
* Özel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluşan koleksiyonumuz olan [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'yi keşfedin.
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katılın veya bizi **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**'da** takip edin.
* **Hacking hilelerinizi HackTricks ve HackTricks Cloud** github depolarına PR göndererek paylaşın.

</details>
