# R√©sum√© de Nmap (ESP)

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres fa√ßons de soutenir HackTricks:

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFT**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts GitHub.

</details>
```
nmap -sV -sC -O -n -oA nmapscan 192.168.0.1/24
```
## Param√®tres

### Adresses IP √† scanner

* **`<ip>,<net/mask>`:** Indique les adresses IP directement
* **`-iL <ips_file>`:** liste_IPs
* **`-iR <number>`**: Nombre d'adresses IP al√©atoires, vous pouvez exclure des adresses IP possibles avec `--exclude <Ips>` ou `--excludefile <file>`.

### D√©couverte d'√©quipements

Par d√©faut, Nmap lance une phase de d√©couverte compos√©e de: `-PA80 -PS443 -PE -PP`

* **`-sL`**: Non invasif, liste les cibles en effectuant des requ√™tes **DNS** pour r√©soudre les noms. Utile pour savoir, par exemple, si www.prueba.es/24 toutes les adresses IP sont nos cibles.
* **`-Pn`**: **Pas de ping**. Utile si vous savez qu'elles sont toutes actives (sinon, vous pourriez perdre beaucoup de temps, mais cette option produit √©galement des faux n√©gatifs en indiquant qu'elles ne sont pas actives), cela emp√™che la phase de d√©couverte.
* **`-sn`** : **Pas de scan de port**. Apr√®s avoir termin√© la phase de reconnaissance, il ne scanne pas les ports. C'est relativement discret et permet un petit scan r√©seau. Avec des privil√®ges, il envoie un ACK (-PA) √† 80, un SYN(-PS) √† 443 et une demande d'√©cho et une demande de timestamp, sans privil√®ges, il termine toujours les connexions. Si la cible est le r√©seau, il utilise uniquement ARP(-PR). S'il est utilis√© avec une autre option, seuls les paquets de l'autre option sont abandonn√©s.
* **`-PR`**: **Ping ARP**. Utilis√© par d√©faut lors de l'analyse des ordinateurs de notre r√©seau, c'est plus rapide que d'utiliser des pings. Si vous ne voulez pas utiliser de paquets ARP, utilisez `--send-ip`.
* **`-PS <ports>`**: Envoie des paquets SYN auxquels s'il r√©pond SYN/ACK, il est ouvert (s'il r√©pond avec RST pour ne pas terminer la connexion), s'il r√©pond RST, il est ferm√© et s'il ne r√©pond pas, il est injoignable. En cas de manque de privil√®ges, une connexion totale est automatiquement utilis√©e. Si aucun port n'est donn√©, il l'envoie √† 80.
* **`-PA <ports>`**: Comme le pr√©c√©dent mais avec ACK, la combinaison des deux donne de meilleurs r√©sultats.
* **`-PU <ports>`**: L'objectif est inverse, ils sont envoy√©s aux ports qui sont cens√©s √™tre ferm√©s. Certains pare-feu ne v√©rifient que les connexions TCP. S'il est ferm√©, il r√©pond avec un port injoignable, s'il r√©pond avec un autre icmp ou s'il ne r√©pond pas, il est laiss√© comme destination injoignable.
* **`-PE, -PP, -PM`** : PINGS ICMP: r√©ponse d'√©cho, timestamp et masque d'adresse. Ils sont lanc√©s pour savoir si la cible est active.
* **`-PY<ports>`**: Envoie des sondes SCTP INIT √† 80 par d√©faut, INIT-ACK(ouvert) ou ABORT(ferm√©) ou rien ou ICMP injoignable(inactif) peuvent √™tre r√©pondu.
* **`-PO <protocols>`**: Un protocole est indiqu√© dans les en-t√™tes, par d√©faut 1(ICMP), 2(IGMP) et 4(Encap IP). Pour les protocoles ICMP, IGMP, TCP (6) et UDP (17), les en-t√™tes de protocole sont envoy√©s, pour le reste seul l'en-t√™te IP est envoy√©. Le but de ceci est que en raison de la malformation des en-t√™tes, le protocole injoignable ou les r√©ponses du m√™me protocole sont r√©pondues pour savoir s'il est actif.
* **`-n`**: Pas de DNS
* **`-R`**: Toujours DNS

### Techniques de scan de ports

* **`-sS`**: Ne compl√®te pas la connexion donc ne laisse aucune trace, tr√®s bon s'il peut √™tre utilis√©. (privil√®ges) C'est celui utilis√© par d√©faut.
* **`-sT`**: Compl√®te la connexion, donc laisse une trace, mais peut √™tre utilis√© en toute s√©curit√©. Par d√©faut sans privil√®ges.
* **`-sU`**: Plus lent, pour UDP. Principalement: DNS(53), SNMP(161,162), DHCP(67 et 68), (-sU53,161,162,67,68): ouvert(r√©ponse), ferm√©(port injoignable), filtr√© (autre ICMP), ouvert/filtr√© (rien). En cas d'ouvert/filtr√©, -sV envoie de nombreuses requ√™tes pour d√©tecter l'une des versions prises en charge par nmap et peut d√©tecter le v√©ritable √©tat. Cela augmente consid√©rablement le temps.
* **`-sY`**: Le protocole SCTP √©choue √† √©tablir la connexion, donc il n'y a pas de journaux, fonctionne comme -PY
* **`-sN,-sX,-sF`:** Null, Fin, Xmas, ils peuvent p√©n√©trer certains pare-feu et extraire des informations. Ils sont bas√©s sur le fait que les machines conformes aux normes doivent r√©pondre avec RST √† toutes les demandes qui n'ont pas de drapeaux SYN, RST ou ACK lev√©s: ouvert/filtr√©(rien), ferm√©(RST), filtr√© (ICMP injoignable). Peu fiable sur Windows, CIsco, BSDI et OS/400. Sur Unix oui.
* **`-sM`**: Scan Maimon: Envoie des drapeaux FIN et ACK, utilis√© pour BSD, actuellement renverra tout comme ferm√©.
* **`-sA, sW`**: ACK et Window, est utilis√© pour d√©tecter les pare-feu, pour savoir si les ports sont filtr√©s ou non. Le -sW distingue entre ouvert/ferm√© car les ouverts r√©pondent avec une valeur de fen√™tre diff√©rente: ouvert (RST avec une fen√™tre diff√©rente de 0), ferm√© (RST fen√™tre = 0), filtr√© (ICMP injoignable ou rien). Tous les ordinateurs ne fonctionnent pas de cette mani√®re, donc s'ils sont tous ferm√©s, cela ne fonctionne pas, s'il y en a quelques-uns d'ouverts, cela fonctionne bien, et s'il y en a beaucoup d'ouverts et peu de ferm√©s, cela fonctionne √† l'envers.
* **`-sI`:** Scan en veille. Pour les cas o√π il y a un pare-feu actif mais que nous savons qu'il ne filtre pas vers une certaine adresse IP (ou lorsque nous voulons simplement rester anonymes), nous pouvons utiliser le scanner zombie (il fonctionne pour tous les ports), pour rechercher des zombies potentiels, nous pouvons utiliser le script ipidseq ou l'exploit auxiliary/scanner/ip/ipidseq. Ce scanner est bas√© sur le num√©ro IPID des paquets IP.
* **`--badsum`:** Il envoie la somme incorrecte, les ordinateurs rejetteraient les paquets, mais les pare-feu pourraient r√©pondre quelque chose, il est utilis√© pour d√©tecter les pare-feu.
* **`-sZ`:** Scanner SCTP "bizarre", lors de l'envoi de sondes avec des fragments d'√©cho de cookie, ils devraient √™tre abandonn√©s s'ils sont ouverts ou r√©pondus avec ABORT s'ils sont ferm√©s. Il peut passer √† travers les pare-feu que l'init ne peut pas passer, le mauvais c√¥t√© est qu'il ne distingue pas entre filtr√© et ouvert.
* **`-sO`:** Scan de protocole Ip. Envoie des en-t√™tes incorrects et vides dans lesquels parfois m√™me le protocole ne peut pas √™tre distingu√©. Si le protocole ICMP injoignable arrive, il est ferm√©, si le port injoignable arrive, il est ouvert, si une autre erreur arrive, filtr√©, s'il n'arrive rien, ouvert|filtr√©.
* **`-b <server>`:** FTPhost--> Il est utilis√© pour scanner un h√¥te √† partir d'un autre, cela se fait en se connectant au ftp d'une autre machine et en lui demandant d'envoyer des fichiers aux ports que vous souhaitez scanner √† partir d'une autre machine, selon les r√©ponses, nous saurons s'ils sont ouverts ou non. \[\<user>:\<password>@]\<server>\[:\<port>] Presque tous les serveurs ftp ne vous permettent plus de le faire et donc c'est de peu d'utilit√© pratique.

### **Analyse centr√©e**

**-p:** Utilis√© pour sp√©cifier les ports √† scanner. Pour s√©lectionner les 65335: **-p-** ou **-p all**. Nmap a une classification interne en fonction de sa popularit√©. Par d√©faut, il utilise les 1000 principaux. Avec **-F** (scan rapide), il analyse les 100 principaux. Avec **--top-ports \<numero>** Il analyse ce nombre de principaux (de 1 √† 65335). Il v√©rifie les ports dans un ordre al√©atoire, pour √©viter cela **-r**. Vous pouvez √©galement s√©lectionner des ports: 20-30,80,443,1024- Cela signifie qu'il regarde au-del√† de 1024. Vous pouvez √©galement regrouper les ports par protocoles: U:53,T:21-25,80,139,S:9. Vous pouvez √©galement choisir une plage parmi les ports populaires de nmap: -p \[-1024] analyse jusqu'au 1024 inclus dans nmap-services. **--port-ratio \<ratio>** Analyse les ports les plus courants selon un ratio qui doit √™tre compris entre 0 et 1

**-sV** Analyse de version, l'intensit√© peut √™tre r√©gl√©e de 0 √† 9, par d√©faut 7.

**--version-intensity \<numero>** R√©glez l'intensit√©, de sorte que plus bas il ne lancera que les sondes les plus probables, mais pas toutes. Cela peut consid√©rablement raccourcir le temps de scan UDP

**-O** D√©tection d'OS

**--osscan-limit** Pour bien scanner un h√¥te, il faut au moins un port ouvert et un autre ferm√©, si cette condition n'est pas remplie et que vous avez activ√© ceci, il n'essaie pas de pr√©dire l'OS (√©conomise du temps)

**--osscan-guess** Lorsque la d√©tection d'OS n'est pas parfaite, cela le force √† faire plus d'efforts

**Scripts**

\--script _\<filename>_|_\<category>_|_\<directory>_|_\<expression>_\[,...]

Pour utiliser les scripts par d√©faut, il suffit de faire -sC ou --script=default

Les types disponibles sont: auth, broadcast, default, discovery, dos, exploit, external, fuzzer, intrusive, malware, safe, version, et vuln

* **Auth:** ex√©cute tous ses _scripts_ disponibles pour l'authentification
* **Default:** ex√©cute les _scripts_ de base par d√©faut de l'outil
* **Discovery:** r√©cup√®re des informations sur la cible ou la victime
* **External:** _script_ pour utiliser des ressources externes
* **Intrusive:** utilise des _scripts_ consid√©r√©s comme intrusifs pour la victime ou la cible
* **Malware:** v√©rifie s'il y a des connexions ouvertes par des codes malveillants ou des _backdoors_
* **Safe:** ex√©cute des _scripts_ qui ne sont pas intrusifs
* **Vuln:** d√©couvre les vuln√©rabilit√©s les plus connues
* **All:** ex√©cute tous les _scripts_ avec l'extension NSE disponibles

Pour rechercher des scripts:

**nmap --script-help="http-\*" -> Ceux commen√ßant par http-**

**nmap --script-help="not intrusive" -> Tous sauf ceux-l√†**

**nmap --script-help="default or safe" -> Ceux qui sont dans l'un ou l'autre ou dans les deux**

**nmap --script-help="default and safe" --> Ceux qui sont dans les deux**

**nmap --script-help="(default or safe or intrusive) and not http-\*"**

\--script-args _\<n1>_=_\<v1>_,_\<n2>_={_\<n3>_=_\<v3>_},_\<n4>_={_\<v4>_,_\<v5>_}

\--script-args-file _\<filename>_

\--script-help _\<filename>_|_\<category>_|_\<directory>_|_\<expression>_|all\[,...]

\--script-trace ---> Fournit des informations sur le fonctionnement du script

\--script-updatedb

**Pour utiliser un script, il suffit de taper: namp --script Nom_du_script cible** --> En sp√©cifiant le script, le script et le scanner seront ex√©cut√©s, vous pouvez donc √©galement ajouter **‚Äúsafe=1‚Äù** pour ex√©cuter uniquement les scripts s√ªrs.

**Contr√¥le du temps**

**Nmap peut modifier le temps en secondes, minutes, ms:** --host-timeout arguments 900000ms, 900, 900s, et 15m font tous la m√™me chose.

Nmap divise le nombre total d'h√¥tes √† scanner en groupes et analyse ces groupes par blocs de sorte que tant que tous les h√¥tes n'ont pas √©t√© analys√©s, il ne passe pas au bloc suivant (et l'utilisateur ne re√ßoit aucune mise √† jour tant que le bloc n'a pas √©t√© analys√©) de cette mani√®re, il est plus optimal pour nmap d'utiliser de grands groupes. Par d√©faut en classe C, il utilise 256.

Cela peut √™tre modifi√© avec\*\*--min-hostgroup\*\* _**\<numhosts>**_**;** **--max-hostgroup** _**\<numhosts>**_ (Ajuster les tailles de groupe de scan parall√®le)

Vous pouvez contr√¥ler le nombre de scanners en parall√®le mais il est pr√©f√©rable de ne pas le faire (nmap int√®gre d√©j√† un contr√¥le automatique en fonction de l'√©tat du r√©seau): **--min-parallelism** _**\<numprobes>**_**;** **--max-parallelism** _**\<numprobes>**_

Vous pouvez contr√¥ler le d√©lai d'attente rtt, mais ce n'est g√©n√©ralement pas n√©cessaire: **--min-rtt-timeout** _**\<time>**_**,** **--max-rtt-timeout** _**\<time>**_**,** **--initial-rtt-timeout** _**\<time>**_

Vous pouvez modifier le nombre de tentatives:**--max-retries** _**\<numtries>**_

Vous pouvez modifier le temps de scan d'un h√¥te: **--host-timeout** _**\<time>**_

Vous pouvez modifier le d√©lai entre chaque scan pour ralentir la vitesse: **--scan-delay** _**\<time>**_**;** **--max-scan-delay** _**\<time>**_

Vous pouvez modifier le nombre de paquets par seconde: **--min-rate** _**\<number>**_**;** **--max-rate** _**\<number>**_

De nombreux ports mettent du temps √† r√©pondre car ils sont filtr√©s ou ferm√©s, si seuls les ouverts vous int√©ressent, vous pouvez acc√©l√©rer le processus avec: **--defeat-rst-ratelimit**

Pour d√©finir l'agressivit√© de nmap: -T paranoid|sneaky|polite|normal|aggressive|insane

\-T (0-1)

\-T0 --> Seul un port est scann√© √† la fois et il attend 5min avant le suivant

\-T1 et T2 --> Tr√®s similaires mais attendent respectivement 15 et 0,4sec entre chaque test

\-T3 --> Fonctionnement par d√©faut, inclut en parall√®le

\-T4 --> --max-rtt-timeout 1250ms --min-rtt-timeout 100ms --initial-rtt-timeout 500ms --max-retries 6 --max-scan-delay 10ms

\-T5 --> --max-rtt-timeout 300ms --min-rtt-timeout 50ms --initial-rtt-timeout 250ms --max-retries 2 --host-timeout 15m --max-scan-delay 5ms

**Firewall/IDS**

Ils bloquent les ports et analysent les paquets.

**-f** Pour fragmenter les paquets, par d√©faut ils sont fragment√©s en 8 octets apr√®s l'en-t√™te, pour sp√©cifier cette taille, utilisez ..mtu (avec cela, ne pas utiliser -f), le d√©calage doit √™tre un multiple de 8. **Les scanners de version et les scripts ne prennent pas en charge la fragmentation**

**-D decoy1,decoy2,ME** Nmap envoie des scanners mais avec d'autres adresses IP comme origine, de cette fa√ßon vous vous cachez. Si vous mettez ME dans la liste, nmap vous placera l√†, il est pr√©f√©rable de mettre 5 ou 6 avant vous pour vous masquer compl√®tement. Des adresses IP al√©atoires peuvent √™tre g√©n√©r√©es avec RND:\<numero> Pour g√©n√©rer \<numero> d'adresses IP al√©atoires. Ne fonctionne pas avec la d√©tection de versions sans connexion TCP. Si vous √™tes dans un r√©seau, il est pr√©f√©rable d
