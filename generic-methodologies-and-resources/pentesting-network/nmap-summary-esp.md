# Nmap 요약 (ESP)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>를 통해 AWS 해킹을 처음부터 전문가까지 배워보세요<strong>!</strong></summary>

HackTricks를 지원하는 다른 방법:

* **회사를 HackTricks에서 광고하거나 HackTricks를 PDF로 다운로드**하려면 [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)를 확인하세요!
* [**공식 PEASS & HackTricks 스웨그**](https://peass.creator-spring.com)를 얻으세요.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)를 발견하세요. 독점적인 [**NFTs**](https://opensea.io/collection/the-peass-family) 컬렉션입니다.
* 💬 [**Discord 그룹**](https://discord.gg/hRep4RUj7f) 또는 [**텔레그램 그룹**](https://t.me/peass)에 **참여**하거나 **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)를 **팔로우**하세요.
* **Hacking 트릭을 공유하려면** [**HackTricks**](https://github.com/carlospolop/hacktricks) 및 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github 저장소에 PR을 제출하세요.

</details>
```
nmap -sV -sC -O -n -oA nmapscan 192.168.0.1/24
```
## 매개변수

### 스캔할 IP

* **`<ip>,<net/mask>`:** 직접 IP를 지정합니다.
* **`-iL <ips_file>`:** IP 목록 파일을 사용합니다.
* **`-iR <number>`**: 무작위 IP의 개수를 지정합니다. `--exclude <Ips>` 또는 `--excludefile <file>`로 가능한 IP를 제외할 수 있습니다.

### 장비 탐지

기본적으로 Nmap은 `-PA80 -PS443 -PE -PP`로 구성된 탐지 단계를 실행합니다.

* **`-sL`**: 침입적이지 않으며, 이름을 해결하기 위해 DNS 요청을 보내는 대상을 나열합니다. 예를 들어 www.prueba.es/24의 모든 IP가 대상인지 알 수 있습니다.
* **`-Pn`**: **Ping 없음**. 모든 대상이 활성화되어 있다는 것을 알고 있다면 유용합니다. (그렇지 않으면 많은 시간이 소요될 수 있지만, 이 옵션은 활성화되지 않았다고 잘못된 결과를 보여줄 수도 있습니다.) 탐지 단계를 방지합니다.
* **`-sn`** : **포트 스캔 없음**. 탐지 단계를 완료한 후 포트를 스캔하지 않습니다. 비교적 은밀하며, 작은 네트워크 스캔이 가능합니다. 권한이 있는 경우 80에 대해 ACK(-PA)를 보내고, 443에 대해 SYN(-PS)를 보내며, 에코 요청과 타임스탬프 요청을 보냅니다. 권한이 없는 경우 항상 연결을 완료합니다. 대상이 네트워크인 경우 ARP(-PR)만 사용합니다. 다른 옵션과 함께 사용하면 다른 옵션의 패킷만 삭제됩니다.
* **`-PR`**: **ARP 핑**. 기본적으로 내 네트워크의 컴퓨터를 분석할 때 사용되며, 핑을 사용하는 것보다 빠릅니다. ARP 패킷을 사용하지 않으려면 `--send-ip`를 사용합니다.
* **`-PS <ports>`**: SYN 패킷을 보내고, SYN/ACK로 응답하면 열려있는 것으로 간주합니다(연결을 끝내지 않기 위해 RST로 응답). RST로 응답하면 닫혀있는 것이고, 응답이 없으면 도달할 수 없는 것입니다. 권한이 없는 경우 자동으로 전체 연결을 사용합니다. 포트가 지정되지 않은 경우 80으로 보냅니다.
* **`-PA <ports>`**: 이전과 동일하지만 ACK를 사용합니다. 두 옵션을 결합하면 더 좋은 결과를 얻을 수 있습니다.
* **`-PU <ports>`**: 목표는 반대입니다. 닫혀있을 것으로 예상되는 포트로 보냅니다. 일부 방화벽은 TCP 연결만 확인합니다. 닫혀있으면 포트 도달 불가능으로 응답하고, 다른 ICMP로 응답하거나 응답이 없으면 대상 도달 불가능으로 남겨둡니다.
* **`-PE, -PP, -PM`** : ICMP PING: 에코 응답, 타임스탬프, 주소 마스크. 대상이 활성화되어 있는지 확인하기 위해 전송됩니다.
* **`-PY<ports>`**: 기본적으로 80으로 SCTP INIT 프로브를 보냅니다. INIT-ACK(열림) 또는 ABORT(닫힘) 또는 응답 없음 또는 ICMP 도달 불가능이 응답될 수 있습니다.
* **`-PO <protocols>`**: 프로토콜이 헤더에 표시됩니다. 기본적으로 1(ICMP), 2(IGMP) 및 4(Encap IP)입니다. ICMP, IGMP, TCP(6) 및 UDP(17) 프로토콜의 경우 프로토콜 헤더가 전송되고, 나머지 경우에는 IP 헤더만 전송됩니다. 이는 헤더의 형태가 잘못되어 프로토콜 도달 불가능 또는 동일한 프로토콜의 응답이 도착하여 상태를 확인하기 위해 사용됩니다.
* **`-n`**: DNS 없음
* **`-R`**: 항상 DNS

### 포트 스캔 기법

* **`-sS`**: 연결을 완료하지 않으므로 추적이 남지 않습니다. 사용할 수 있는 경우 매우 좋습니다.(권한 필요) 기본적으로 사용됩니다.
* **`-sT`**: 연결을 완료하므로 추적이 남지만 안전하게 사용할 수 있습니다. 기본적으로 권한이 없습니다.
* **`-sU`**: 느리며, UDP에 사용됩니다. 대부분: DNS(53), SNMP(161,162), DHCP(67 및 68), (-sU53,161,162,67,68): 열림(응답), 닫힘(포트 도달 불가능), 필터링(다른 ICMP), 열림/필터링(응답 없음). 열림/필터링인 경우, -sV는 nmap이 지원하는 버전 중 하나를 감지하기 위해 많은 요청을 보냅니다. 시간이 많이 소요됩니다.
* **`-sY`**: SCTP 프로토콜은 연결을 설정하지 못하므로 로그가 없습니다. -PY와 동작 방식이 동일합니다.
* **`-sN,-sX,-sF`:** Null, Fin, Xmas, 일부 방화벽을 통해 침투하고 정보를 추출할 수 있습니다. 표준을 준수하는 기기는 SYN, RST 또는 ACK 플래그가 설정되지 않은 요청에 대해 모두 RST로 응답해야 한다는 사실에 기초합니다: 열림/필터링(응답 없음), 닫힘(RST), 필터링(ICMP 도달 불가능). Windows, CIsco, BSDI 및 OS/400에서 신뢰할 수 없습니다. Unix에서는 가능합니다.
* **`-sM`**: Maimon 스캔: FIN 및 ACK 플래그를 보냅니다. 현재 BSD에 사용되며 모두 닫혀있는 것으로 반환됩니다.
* **`-sA, sW`**: ACK 및 Window, 방화벽을 감지하기 위해 사용되며, 포트가 필터링되었는지 여부를 알 수 있습니다. -sW는 열린 포트가 다른 창 값으로 응답하기 때문에 열림/닫힘을 구분합니다
**--osscan-guess** OS 감지가 완벽하지 않을 때 더 많은 노력을 기울입니다.

**스크립트**

\--script _\<파일명>_|_\<카테고리>_|_\<디렉토리>_|_\<표현식>_\[,...]

기본 스크립트를 사용하려면 -sC 또는 --script=default를 사용하면 됩니다.

사용 가능한 스크립트 유형은 다음과 같습니다: auth, broadcast, default, discovery, dos, exploit, external, fuzzer, intrusive, malware, safe, version, and vuln

* **Auth:** 인증에 사용 가능한 모든 스크립트를 실행합니다.
* **Default:** 도구의 기본 스크립트를 실행합니다.
* **Discovery:** 대상 또는 피해자의 정보를 검색합니다.
* **External:** 외부 리소스를 사용하는 스크립트입니다.
* **Intrusive:** 피해자 또는 대상에게 침입적인 스크립트를 사용합니다.
* **Malware:** 악성 코드 또는 백도어로 인해 열린 연결을 확인합니다.
* **Safe:** 침입적이지 않은 스크립트를 실행합니다.
* **Vuln:** 가장 잘 알려진 취약점을 발견합니다.
* **All:** 가능한 모든 NSE 확장자를 가진 스크립트를 실행합니다.

스크립트를 검색하려면:

**nmap --script-help="http-\*" -> http-로 시작하는 스크립트**

**nmap --script-help="not intrusive" -> 해당되지 않는 모든 스크립트**

**nmap --script-help="default or safe" -> 하나 또는 둘 다에 속하는 스크립트**

**nmap --script-help="default and safe" --> 둘 다에 속하는 스크립트**

**nmap --script-help="(default or safe or intrusive) and not http-\*"**

\--script-args _\<n1>_=_\<v1>_,_\<n2>_={_\<n3>_=_\<v3>_},_\<n4>_={_\<v4>_,_\<v5>_}

\--script-args-file _\<파일명>_

\--script-help _\<파일명>_|_\<카테고리>_|_\<디렉토리>_|_\<표현식>_|all\[,...]

\--script-trace ---> 스크립트 진행 상황 정보 제공

\--script-updatedb

**스크립트를 사용하려면 단순히 nmap --script Script_Name target을 입력하면 됩니다.** --> 스크립트를 입력하면 스크립트와 스캐너가 모두 실행되므로 스캐너 옵션도 추가할 수 있습니다. "safe=1"을 추가하여 안전한 스크립트만 실행할 수 있습니다.

**시간 제어**

**Nmap은 초, 분, 밀리초 단위로 시간을 조정할 수 있습니다:** --host-timeout arguments 900000ms, 900, 900s, and 15m 모두 동일한 작업을 수행합니다.

Nmap은 스캔할 호스트의 총 수를 그룹으로 나누고, 이러한 그룹을 블록으로 분석하여 모든 그룹이 분석될 때까지 다음 블록으로 이동하지 않습니다(사용자도 블록이 분석될 때까지 업데이트를 받지 않습니다). 이렇게 하면 Nmap이 큰 그룹을 사용하는 것이 더 효율적입니다. 기본적으로 C 클래스에서는 256을 사용합니다.

다음과 같이 변경할 수 있습니다. **--min-hostgroup** _**\<호스트수>**_**;** **--max-hostgroup** _**\<호스트수>**_ (병렬 스캔 그룹 크기 조정)

병렬 스캔 수를 제어할 수 있지만 권장하지 않습니다(Nmap은 네트워크 상태에 따라 자동으로 제어합니다): **--min-parallelism** _**\<프로브수>**_**;** **--max-parallelism** _**\<프로브수>**_

RTT 타임아웃을 수정할 수 있지만 일반적으로 필요하지 않습니다: **--min-rtt-timeout** _**\<시간>**_**,** **--max-rtt-timeout** _**\<시간>**_**,** **--initial-rtt-timeout** _**\<시간>**_

시도 횟수를 수정할 수 있습니다: **--max-retries** _**\<시도횟수>**_

호스트의 스캔 시간을 수정할 수 있습니다: **--host-timeout** _**\<시간>**_

각 테스트 간의 시간을 느리게 조정할 수 있습니다: **--scan-delay** _**\<시간>**_**;** **--max-scan-delay** _**\<시간>**_

초당 패킷 수를 수정할 수 있습니다: **--min-rate** _**\<숫자>**_**;** **--max-rate** _**\<숫자>**_

많은 포트는 필터링되거나 닫혀 있어 응답하는 데 시간이 오래 걸립니다. 열려 있는 포트만 관심이 있는 경우 다음과 같이 더 빠르게 스캔할 수 있습니다: **--defeat-rst-ratelimit**

Nmap의 공격 강도를 정의하는 데 사용할 수 있습니다: -T paranoid|sneaky|polite|normal|aggressive|insane

\-T (0-1)

\-T0 --> 한 번에 1개의 포트만 스캔하고 다음까지 5분을 기다립니다.

\-T1 및 T2 --> 매우 유사하지만 각 테스트 간에 15초 및 0.4초를 기다립니다.

\-T3 --> 기본 동작, 병렬로 실행됩니다.

\-T4 --> --max-rtt-timeout 1250ms --min-rtt-timeout 100ms --initial-rtt-timeout 500ms --max-retries 6 --max-scan-delay 10ms

\-T5 --> --max-rtt-timeout 300ms --min-rtt-timeout 50ms --initial-rtt-timeout 250ms --max-retries 2 --host-timeout 15m --max-scan-delay 5ms

**방화벽/IDS**

포트를 차단하고 패킷을 분석합니다.

**-f** 패킷을 조각화하기 위해 사용됩니다. 기본적으로 헤더 이후 8바이트로 조각화되며, 이 크기를 지정하려면 ..mtu를 사용합니다(-f를 사용하지 않습니다). 오프셋은 8의 배수여야 합니다. **버전 스캐너 및 스크립트는 조각화를 지원하지 않습니다.**

**-D decoy1,decoy2,ME** Nmap은 다른 IP 주소를 출발지로 사용하여 스캔을 보냅니다. 이렇게 하면 자신을 숨길 수 있습니다
**--proxies** _**\<Comma-separated list of proxy URLs>**_ 프록시를 사용하기 위해 때때로 nmap이 원하는만큼의 연결을 유지하지 못하는 경우가 있으므로 병렬성을 수정해야합니다: --max-parallelism

**-sP** ARP를 통해 네트워크에서 호스트를 발견하기 위해 사용됩니다.

많은 관리자들은 특정 포트(예: 20, 53 및 67)에서 오는 모든 패킷을 통과시키는 방화벽 규칙을 생성합니다. 우리는 nmap에게 해당 포트에서 패킷을 보내도록 지시할 수 있습니다: **nmap --source-port 53 Ip**

**출력**

**-oN file** 일반 출력

**-oX file** XML 출력

**-oS file** 스크립트 키디 출력

**-oG file** grepable 출력

**-oA file** -oS를 제외한 모든 출력

**-v level** 상세도

**-d level** 디버깅

**--reason** 호스트 및 상태에 대한 이유

**--stats-every time** 주어진 시간마다 진행 상황을 알려줍니다.

**--packet-trace** 보낸 패킷을 확인하기 위해 --version-trace 또는 --script-trace와 같은 필터를 지정할 수 있습니다.

**--open** 열린, 열린|필터링된 및 필터링되지 않은 것을 표시합니다.

**--resume file** 요약을 생성합니다.

**기타**

**-6** IPv6를 허용합니다.

**-A** -O -sV -sC --traceroute와 동일합니다.

**실행 시간**

nmap이 실행되는 동안 옵션을 변경할 수 있습니다:

v / V 상세도 레벨 증가 / 감소

d / D 디버깅 레벨 증가 / 감소

p / P 패킷 추적 켜기 / 끄기

? 런타임 상호작용 도움말 화면 출력

**Vulscan**

nmap 스크립트로, 오프라인 데이터베이스(주요 데이터베이스에서 다운로드)에서 얻은 서비스 버전을 확인하고 가능한 취약점을 반환합니다.

사용하는 데이터베이스는 다음과 같습니다:

1. Scipvuldb.csv | [http://www.scip.ch/en/?vuldb](http://www.scip.ch/en/?vuldb)
2. Cve.csv | [http://cve.mitre.org](http://cve.mitre.org/)
3. Osvdb.csv | [http://www.osvdb.org](http://www.osvdb.org/)
4. Securityfocus.csv | [http://www.securityfocus.com/bid/](http://www.securityfocus.com/bid/)
5. Securitytracker.csv | [http://www.securitytracker.com](http://www.securitytracker.com/)
6. Xforce.csv | [http://xforce.iss.net](http://xforce.iss.net/)
7. Exploitdb.csv | [http://www.exploit-db.com](http://www.exploit-db.com/)
8. Openvas.csv | [http://www.openvas.org](http://www.openvas.org/)

Nmap 폴더에 다운로드하고 설치하려면:

wget http://www.computec.ch/projekte/vulscan/download/nmap\_nse\_vulscan-2.0.tar.gz && tar -czvf nmap\_nse\_vulscan-2.0.tar.gz vulscan/ && sudo cp -r vulscan/ /usr/share/nmap/scripts/

또한 데이터베이스 패키지를 다운로드하고 /usr/share/nmap/scripts/vulscan/에 추가해야합니다.

사용법:

모두 사용하려면: sudo nmap -sV --script=vulscan HOST\_TO\_SCAN

특정 데이터베이스를 사용하려면: sudo nmap -sV --script=vulscan --script-args vulscandb=cve.csv HOST\_TO\_SCAN

## Nmap 서비스 스캔 속도 향상 x16

[**이 게시물**](https://joshua.hu/nmap-speedup-service-scanning-16x)에 따르면, **`/usr/share/nmap/nmap-service-probes`**의 모든 **`totalwaitms`** 값을 **300**으로 수정하고 **`tcpwrappedms`** 값을 **200**으로 수정하여 nmap 서비스 분석 속도를 향상시킬 수 있습니다.

또한, **`servicewaitms`**가 명시적으로 정의되지 않은 프로브는 기본값인 **`5000`**을 사용합니다. 따라서 각 프로브에 값을 추가하거나 [**service\_scan.h**](https://github.com/nmap/nmap/blob/master/service\_scan.h#L79)에서 기본값을 변경하여 nmap을 **컴파일** 할 수 있습니다.

`/usr/share/nmap/nmap-service-probes` 파일에서 **`totalwaitms`**와 **`tcpwrappedms`**의 값을 전혀 변경하고 싶지 않은 경우, [파싱 코드](https://github.com/nmap/nmap/blob/master/service\_scan.cc#L1358)를 편집하여 `nmap-service-probes` 파일의 이러한 값들이 완전히 무시되도록 할 수 있습니다.

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>를 통해 제로에서 영웅까지 AWS 해킹을 배워보세요!</summary>

HackTricks를 지원하는 다른 방법:

* HackTricks에서 **회사 광고를 보거나 PDF로 HackTricks를 다운로드**하려면 [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)를 확인하세요!
* [**공식 PEASS & HackTricks 상품**](https://peass.creator-spring.com)을 구매하세요.
* 독점적인 [**NFTs**](https://opensea.io/collection/the-peass-family)인 [**The PEASS Family**](https://opensea.io/collection/the-peass-family)를 발견하세요.
* 💬 [**Discord 그룹**](https://discord.gg/hRep4RUj7f) 또는 [**텔레그램 그룹**](https://t.me/peass)에 **참여**하거나 **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)를 **팔로우**하세요.
* **HackTricks**와 **HackTricks Cloud** github 저장소에 PR을 제출하여 **자신의 해킹 기법을 공유**하세요.

</details>
