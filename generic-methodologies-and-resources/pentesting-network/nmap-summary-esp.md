# Nmap Özeti (ESP)

<details>

<summary><strong>AWS hacklemeyi sıfırdan kahraman olacak şekilde öğrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Kırmızı Takım Uzmanı)</strong></a><strong>!</strong></summary>

HackTricks'i desteklemenin diğer yolları:

* Şirketinizi HackTricks'te **reklamınızı görmek** veya **HackTricks'i PDF olarak indirmek** isterseniz, [**ABONELİK PLANLARINA**](https://github.com/sponsors/carlospolop) göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* Özel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluşan koleksiyonumuz [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'i keşfedin
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın** veya bizi **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**'da takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına **PR göndererek paylaşın**.

</details>
```
nmap -sV -sC -O -n -oA nmapscan 192.168.0.1/24
```
## Parametreler

### Tarama yapılacak IP'ler

* **`<ip>,<net/mask>`:** IP'leri doğrudan belirtir
* **`-iL <ips_file>`:** IP'leri içeren bir dosya
* **`-iR <number>`**: Rastgele IP sayısı, `--exclude <Ips>` veya `--excludefile <file>` ile olası IP'leri hariç tutabilirsiniz.

### Ekipman keşfi

Nmap varsayılan olarak `-PA80 -PS443 -PE -PP` olmak üzere bir keşif aşaması başlatır.

* **`-sL`**: İstilacı değildir, hedefleri listeler ve isimleri çözmek için **DNS** istekleri yapar. Örneğin www.prueba.es/24 gibi bir hedefte tüm IP'lerin hedeflerimiz olup olmadığını bilmek için kullanışlıdır.
* **`-Pn`**: **Ping yok**. Tüm IP'lerin aktif olduğunu bildiğinizde (aksi takdirde çok zaman kaybedebilirsiniz, ancak bu seçenek aynı zamanda yanlış negatif sonuçlar da üretebilir), keşif aşamasını engeller.
* **`-sn`** : **Port taraması yok**. Keşif aşamasını tamamladıktan sonra port taraması yapmaz. Nispeten gizli bir şekilde çalışır ve küçük bir ağ taramasına izin verir. Yetkilerle 80'e bir ACK (-PA), 443'e bir SYN(-PS) ve bir echo isteği ve bir zaman damgası isteği gönderir, yetkisiz olarak her zaman bağlantıları tamamlar. Hedef ağ ise sadece ARP(-PR) kullanır. Başka bir seçenekle kullanıldığında, yalnızca diğer seçeneğin paketleri atılır.
* **`-PR`**: **Ping ARP**. Kendi ağımızdaki bilgisayarları analiz ederken varsayılan olarak kullanılır, ping kullanmaktan daha hızlıdır. ARP paketleri kullanmak istemiyorsanız `--send-ip` kullanın.
* **`-PS <ports>`**: SYN paketleri gönderir, eğer SYN/ACK ile yanıtlarsa açıktır (bağlantıyı sonlandırmamak için RST ile yanıtlar), eğer RST ile yanıtlarsa kapalıdır ve yanıt vermezse ulaşılamazdır. Yetkileri yoksa, otomatik olarak bir tam bağlantı kullanılır. Eğer portlar belirtilmezse, 80'e gönderir.
* **`-PA <ports>`**: Öncekiyle aynıdır, ancak ACK ile birlikte kullanılır, ikisinin birleşimi daha iyi sonuçlar verir.
* **`-PU <ports>`**: Aksine, kapatılmış olması beklenen portlara gönderilir. Bazı güvenlik duvarları yalnızca TCP bağlantılarını kontrol eder. Eğer kapalıysa port unreachable ile yanıt verilir, başka bir icmp ile yanıt verilirse veya yanıt verilmezse hedefe ulaşılamaz olarak bırakılır.
* **`-PE, -PP, -PM`** : ICMP PING'ler: echo replay, timestamp ve addresmask. Hedefin aktif olup olmadığını belirlemek için gönderilir.
* **`-PY<ports>`**: Varsayılan olarak 80'e SCTP INIT probeleri gönderir, INIT-ACK(açık) veya ABORT(kapalı) veya hiçbir şey veya ICMP unreachable(pasif) yanıtlanabilir.
* **`-PO <protocols>`**: Başlıkta bir protokol belirtilir, varsayılan olarak 1(ICMP), 2(IGMP) ve 4(Encap IP). ICMP, IGMP, TCP (6) ve UDP (17) protokolleri için protokol başlıkları gönderilir, geri kalanlar için yalnızca IP başlığı gönderilir. Amacı, başlıkların bozukluğu nedeniyle, Protokol unreachable veya aynı protokolün yanıtlarıyla yanıt verilmesidir, böylece hedefin aktif olup olmadığı anlaşılır.
* **`-n`**: DNS yok
* **`-R`**: Her zaman DNS

### Port tarama teknikleri

* **`-sS`**: Bağlantıyı tamamlamaz, bu nedenle iz bırakmaz, kullanılabilirse çok iyidir (yetkilerle). Varsayılan olarak kullanılır.
* **`-sT`**: Bağlantıyı tamamlar, bu nedenle iz bırakır, ancak kesin olarak kullanılabilir. Varsayılan olarak yetkisiz.
* **`-sU`**: Daha yavaş, UDP için kullanılır. Genellikle: DNS(53), SNMP(161,162), DHCP(67 ve 68), (-sU53,161,162,67,68): açık(yanıt), kapalı(port unreachable), filtrelenmiş (başka bir ICMP), açık/filtrelenmiş (hiçbir şey). Açık/filtrelenmiş durumunda, -sV, nmap'in desteklediği sürümlerden herhangi birini tespit etmek için birçok istek gönderir ve gerçek durumu tespit edebilir. Bu süreyi çok artırır.
* **`-sY`**: SCTP protokolü bağlantıyı kuramaz, bu nedenle kayıtlar yoktur, -PY gibi çalışır
* **`-sN,-sX,-sF`:** Null, Fin, Xmas, bazı güvenlik duvarlarını aşabilir ve bilgi çıkarabilir. Standart uyumlu makinelerin SYN, RST veya ACK bayrakları içermeyen isteklere RST ile yanıt vermesi gerektiği varsayımına dayanırlar: açık/filtrelenmiş(hiçbir şey), kapalı(RST), filtrelenmiş (ICMP unreachable). Windows, CIsco, BSDI ve OS/400 üzerinde güvenilir değildir. Unix üzerinde evet.
* **`-sM`**: Maimon taraması: FIN ve ACK bayrakları gönderir, BSD için kullanılır, şu anda tümünü kapalı olarak döndürür.
* **`-sA, sW`**: ACK ve Window, güvenlik duvarlarını tespit etmek için kullanılır, portların filtrelenip filtrelenmediğini bilmek için. -sW, açık/kapalı arasında ayrım yapar çünkü açık olanlar farklı bir pencere değeriyle yanıt verir: açık (pencere değeri 0 olmayan RST), kapalı (RST pencere = 0), filtrelenmiş (ICMP unreachable veya hiçbir şey). Tüm bilgisayarlar bu şekilde çalışmadığından, eğer hepsi kapalıysa, çalışmıyor demektir, birkaç tanesi açıksa, düzgün çalışıyor demektir ve birçok açık ve az kapalı varsa, ters yönde çalışıyor demektir.
* **`-sI`:** Idle tarama. Etkin bir güvenlik duvarı olduğu ancak belirli bir IP'yi filtrelemediğimizi biliyorsak (veya sadece anonimlik istediğimizde) zombi tarayıcıyı kullanabiliriz (tüm portlar için çalışır), olası zombileri bulmak için ipidseq betiğini veya exploit auxiliary
**--osscan-guess** Bu seçenek, işletim sistemi tespiti tam olarak yapılamadığında daha fazla çaba harcar.

**Scriptler**

\--script _\<dosyaadı>_|_\<kategori>_|_\<dizin>_|_\<ifade>_\[,...]

Varsayılanları kullanmak için -sC veya --script=default yeterlidir.

Mevcut olan türler: auth, broadcast, default, discovery, dos, exploit, external, fuzzer, intrusive, malware, safe, version ve vuln

* **Auth:** Kimlik doğrulama için mevcut olan tüm scriptleri çalıştırır.
* **Default:** Aracın varsayılan temel scriptlerini çalıştırır.
* **Discovery:** Hedef veya kurban hakkında bilgi toplar.
* **External:** Harici kaynakları kullanmak için script.
* **Intrusive:** Kurban veya hedef için müdahaleci olarak kabul edilen scriptleri kullanır.
* **Malware:** Zararlı kodlar veya arka kapılar tarafından açılan bağlantıları kontrol eder.
* **Safe:** Müdahaleci olmayan scriptleri çalıştırır.
* **Vuln:** En yaygın bilinen zafiyetleri keşfeder.
* **All:** Mevcut olan tüm NSE uzantılı scriptleri çalıştırır.

Scriptleri aramak için:

**nmap --script-help="http-\*" -> http- ile başlayanlar**

**nmap --script-help="not intrusive" -> Bunlar hariç tüm scriptler**

**nmap --script-help="default or safe" -> İkisinden birinde veya her ikisinde olanlar**

**nmap --script-help="default and safe" --> Her ikisinde olanlar**

**nmap --script-help="(default or safe or intrusive) and not http-\*"**

\--script-args _\<n1>_=_\<v1>_,_\<n2>_={_\<n3>_=_\<v3>_},_\<n4>_={_\<v4>_,_\<v5>_}

\--script-args-file _\<dosyaadı>_

\--script-help _\<dosyaadı>_|_\<kategori>_|_\<dizin>_|_\<ifade>_|all\[,...]

\--script-trace ---> Scriptin ilerlemesi hakkında bilgi verir

\--script-updatedb

**Bir scripti kullanmak için sadece şunu yazmak yeterlidir: nmap --script Script_Adı hedef** --> Scripti belirttiğinizde, hem script hem de tarama çalıştırılır, bu nedenle tarama seçenekleri de ekleyebilirsiniz, sadece güvenli olanları çalıştırmak için **"safe=1"** ekleyebiliriz.

**Zaman Kontrolü**

**Nmap, saniye, dakika, ms cinsinden zamanı değiştirebilir:** --host-timeout arguments 900000ms, 900, 900s ve 15m hepsi aynı işi yapar.

Nmap, taraması gereken toplam hedef sayısını gruplara böler ve bu grupları bloklar halinde analiz eder, tüm gruplar analiz edilene kadar bir sonraki bloğa geçmez (ve kullanıcı da blok analiz edilene kadar herhangi bir güncelleme almaz). Bu şekilde, nmap için büyük grupların kullanılması daha iyidir. Varsayılan olarak, C sınıfında 256 kullanır.

Değiştirmek için\*\*--min-hostgroup\*\* _**\<numhosts>**_**;** **--max-hostgroup** _**\<numhosts>**_ (Paralel tarama grup boyutlarını ayarlayın)

Paralel tarama sayısını kontrol edebilirsiniz, ancak genellikle gerekli değildir (nmap, ağ durumuna dayalı otomatik kontrolü zaten içerir): **--min-parallelism** _**\<numprobes>**_**;** **--max-parallelism** _**\<numprobes>**_

RTT zaman aşımını değiştirebilirsiniz, ancak genellikle gerekli değildir: **--min-rtt-timeout** _**\<time>**_**,** **--max-rtt-timeout** _**\<time>**_**,** **--initial-rtt-timeout** _**\<time>**_

Deneme sayısını değiştirebilirsiniz: **--max-retries** _**\<numtries>**_

Bir hedefin tarama süresini değiştirebilirsiniz: **--host-timeout** _**\<time>**_

Her test arasındaki süreyi yavaşlatmak için: **--scan-delay** _**\<time>**_**;** **--max-scan-delay** _**\<time>**_

Saniye başına paket sayısını değiştirebilirsiniz: **--min-rate** _**\<number>**_**;** **--max-rate** _**\<number>**_

Filtrelenmiş veya kapalı olan birçok portun yanıt vermesi uzun sürebilir, yalnızca açık olanları ilgilendiriyorsanız, **--defeat-rst-ratelimit** ile daha hızlı tarama yapabilirsiniz.

Nmap'in ne kadar saldırgan olmasını istediğinizi belirlemek için: -T paranoid|sneaky|polite|normal|aggressive|insane

\-T (0-1)

\-T0 --> Sadece bir port taranır ve bir sonraki için 5 dakika beklenir

\-T1 ve T2 --> Birbirine çok benzer, ancak sırasıyla 15 ve 0.4 saniye beklerler

\-T3 --> Varsayılan işlev, paralel olarak tarar

\-T4 --> --max-rtt-timeout 1250ms --min-rtt-timeout 100ms --initial-rtt-timeout 500ms --max-retries 6 --max-scan-delay 10ms

\-T5 --> --max-rtt-timeout 300ms --min-rtt-timeout 50ms --initial-rtt-timeout 250ms --max-retries 2 --host-timeout 15m --max-scan-delay 5ms

**Firewall/IDS**

Portlara izin vermez ve paketleri analiz eder.

**-f** Paketleri parçalamak için kullanılır, varsayılan olarak başlıktan sonra 8 bayt olarak parçalar, bu boyutu belirtmek için ..mtu kullanılır (-f kullanmayın), ofset 8'in katı olmalıdır. **Versiyon taramaları ve scriptler parçalamayı desteklemez**

**-D decoy1,decoy2,BEN** Nmap, taramaları başka IP adresleriyle gönderir, böylece kendinizi gizlersiniz. ME'yi listeye eklerseniz, nmap sizi oraya yerleştirir, tamamen gizlenmek için kendinizden önce 5 veya 6 tane eklemek daha iyidir. RND:\<number> ile rastgele IP'ler oluşturabilirsiniz. TCP bağlantısız sürüm tespiti ile çalışmazlar. Bir ağın içindeyseniz, etkin IP'ler kullanmanız önemlidir, aksi takdirde sadece sizin etkin olduğunuzu kolayca tespit etmek mümkün olur.

Rastgele IP'ler kullanmak için: nmap -D RND: 10 Hedef_IP

**-S IP** Nmap, IP adresinizi alamazsa, bunu belirtmeniz gerekir. Ayrıca, başka bir hedefin onları taradığı izlenimini vermek için de kullanılabilir.

**-e \<arayüz>** Arayüzü seçmek için kullanılır

Birçok yönetici, her şeyin düzgün çalışması ve başka bir çözüm bulmak yerine giriş kapılarını açık bırakır. Bunlar DNS veya FTP portları olabilir... Bu
**--proxies** _**\<Virgülle ayrılmış proxy URL'lerinin listesi>**_ Proxy kullanmak için, bazen bir proxy, nmap'in istediği kadar çok bağlantıyı açık tutmaz, bu yüzden paralelizmi değiştirmemiz gerekebilir: --max-parallelism

**-sP** ARP ile ağdaki ana bilgisayarları keşfetmek için

Birçok yönetici, belirli bir bağlantı noktasından gelen tüm paketlerin geçmesine izin veren bir güvenlik duvarı kuralı oluşturur (örneğin 20, 53 ve 67 gibi), nmap'e paketlerimizi bu bağlantı noktalarından göndermesini söyleyebiliriz: **nmap --source-port 53 Ip**

**Çıktılar**

**-oN dosya** Normal çıktı

**-oX dosya** XML çıktısı

**-oS dosya** Script kidies çıktısı

**-oG dosya** Grepable çıktı

**-oA dosya** -oS hariç tüm çıktılar

**-v seviye** ayrıntı düzeyi

**-d seviye** hata ayıklama düzeyi

**--reason** Ana bilgisayarın nedeni ve durumu

**--stats-every zaman** Belirli bir süre sonra durumu bildirir

**--packet-trace** Gönderilen paketleri görmek için filtreler belirtilebilir, örneğin: --version-trace veya --script-trace

**--open** açık, açık|filtrelenen ve filtrelenmeyenleri gösterir

**--resume dosya** Özet çıkarır

**Çeşitli**

**-6** ipv6'ya izin verir

**-A** -O -sV -sC --traceroute ile aynıdır

**Çalışma süresi**

Nmap çalışırken seçenekleri değiştirebiliriz:

v / V Ayrıntı düzeyini artır / azalt

d / D Hata ayıklama düzeyini artır / azalt

p / P Paket izlemeyi aç / kapat

? Çalışma zamanı etkileşim yardım ekranını yazdır

**Vulscan**

Nmap betiği, çevrimdışı bir veritabanında (diğer önemli veritabanlarından indirilen) elde edilen hizmet sürümlerine bakar ve olası zayıflıkları döndürür.

Kullanılan veritabanları:

1. Scipvuldb.csv | [http://www.scip.ch/en/?vuldb](http://www.scip.ch/en/?vuldb)
2. Cve.csv | [http://cve.mitre.org](http://cve.mitre.org/)
3. Osvdb.csv | [http://www.osvdb.org](http://www.osvdb.org/)
4. Securityfocus.csv | [http://www.securityfocus.com/bid/](http://www.securityfocus.com/bid/)
5. Securitytracker.csv | [http://www.securitytracker.com](http://www.securitytracker.com/)
6. Xforce.csv | [http://xforce.iss.net](http://xforce.iss.net/)
7. Exploitdb.csv | [http://www.exploit-db.com](http://www.exploit-db.com/)
8. Openvas.csv | [http://www.openvas.org](http://www.openvas.org/)

Nmap klasörüne indirip kurmak için:

wget http://www.computec.ch/projekte/vulscan/download/nmap\_nse\_vulscan-2.0.tar.gz && tar -czvf nmap\_nse\_vulscan-2.0.tar.gz vulscan/ && sudo cp -r vulscan/ /usr/share/nmap/scripts/

Ayrıca, veritabanı paketlerini indirmeniz ve bunları /usr/share/nmap/scripts/vulscan/ dizinine eklemeniz gerekecektir.

Kullanım:

Hepsini kullanmak için: sudo nmap -sV --script=vulscan TARAMA\_YAPILACAK\_ANA\_BİLGİSAYAR

Belirli bir veritabanını kullanmak için: sudo nmap -sV --script=vulscan --script-args vulscandb=cve.csv TARAMA\_YAPILACAK\_ANA\_BİLGİSAYAR

## Nmap Hizmet taramasını 16 kat hızlandırma

[**Bu gönderiye**](https://joshua.hu/nmap-speedup-service-scanning-16x) göre, nmap hizmet analizini, **`/usr/share/nmap/nmap-service-probes`** dosyasındaki tüm **`totalwaitms`** değerlerini **300** ve **`tcpwrappedms`** değerini **200** olarak değiştirerek hızlandırabilirsiniz.

Ayrıca, özel olarak tanımlanmamış **`servicewaitms`** değeri olmayan problar, varsayılan bir değer olan **`5000`** kullanır. Bu nedenle, her bir proba değer ekleyebilir veya **nmap'i** kendimiz derleyebilir ve [**service\_scan.h**](https://github.com/nmap/nmap/blob/master/service\_scan.h#L79) dosyasında varsayılan değeri değiştirebiliriz.

Eğer `/usr/share/nmap/nmap-service-probes` dosyasındaki **`totalwaitms`** ve **`tcpwrappedms`** değerlerini hiç değiştirmek istemiyorsanız, [açma kodunu](https://github.com/nmap/nmap/blob/master/service\_scan.cc#L1358) düzenleyerek bu değerlerin `nmap-service-probes` dosyasında tamamen yok sayılmasını sağlayabilirsiniz.

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sıfırdan kahraman olmak için AWS hackleme öğrenin</summary>

HackTricks'yi desteklemenin diğer yolları:

* Şirketinizi HackTricks'te **tanıtmak veya HackTricks'i PDF olarak indirmek** için [**ABONELİK PLANLARI**](https://github.com/sponsors/carlospolop)'na göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* Özel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluşan koleksiyonumuz olan [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'yi keşfedin
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katılın veya bizi Twitter'da takip edin 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live).
* Hacking hilelerinizi [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına PR göndererek paylaşın.

</details>
