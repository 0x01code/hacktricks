# Nmap Sumar (ESP)

<details>

<summary><strong>Naučite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi načini podrške HackTricks-u:

* Ako želite da vidite **vašu kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**PLANOVE ZA PRIJAVU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvanični PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), našu kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridružite se** 💬 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

<figure><img src="/.gitbook/assets/WebSec_1500x400_10fps_21sn_lightoptimized_v2.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}
```
nmap -sV -sC -O -n -oA nmapscan 192.168.0.1/24
```
## Parametri

### IP adrese za skeniranje

* **`<ip>,<net/mask>`:** Označava IP adrese direktno
* **`-iL <ips_file>`:** lista_IP-ova
* **`-iR <number>`**: Broj slučajno odabranih IP adresa, možete isključiti moguće IP adrese sa `--exclude <Ips>` ili `--excludefile <file>`.

### Otkrivanje opreme

Podrazumevano, Nmap pokreće fazu otkrivanja koja se sastoji od: `-PA80 -PS443 -PE -PP`

* **`-sL`**: Nije invazivan, prikazuje mete praveći **DNS** zahteve za rešavanje imena. Korisno je znati da li su, na primer, svi IP-ovi na www.prueba.es/24 naši ciljevi.
* **`-Pn`**: **Bez pinga**. Ovo je korisno ako znate da su svi aktivni (ako ne, mogli biste izgubiti puno vremena, ali ova opcija takođe može proizvesti lažne negativne rezultate tvrdeći da nisu aktivni), sprečava fazu otkrivanja.
* **`-sn`** : **Bez skeniranja portova**. Nakon završetka faze izviđanja, ne skenira portove. Relativno je neprimetan i omogućava mali sken mreže. Sa privilegijama šalje ACK (-PA) na 80, SYN(-PS) na 443 i zahtev za eho i zahtev za vremenski pečat, bez privilegija uvek završava veze. Ako je cilj mreža, koristi samo ARP(-PR). Ako se koristi sa drugom opcijom, samo se odbacuju paketi druge opcije.
* **`-PR`**: **Ping ARP**. Podrazumevano se koristi prilikom analize računara u našoj mreži, brži je od korišćenja pingova. Ako ne želite da koristite ARP pakete, koristite `--send-ip`.
* **`-PS <ports>`**: Šalje SYN pakete na koje ako odgovori SYN/ACK, port je otvoren (na koji odgovara sa RST kako bi prekinuo vezu), ako odgovori RST, port je zatvoren, a ako ne odgovori, nedostupan je. U slučaju nedostatka privilegija, automatski se koristi ukupna veza. Ako nisu navedeni portovi, šalje se na 80.
* **`-PA <ports>`**: Kao prethodni, ali sa ACK, kombinovanjem oba daje bolje rezultate.
* **`-PU <ports>`**: Cilj je suprotan, šalju se na portove za koje se očekuje da su zatvoreni. Neki firewalli proveravaju samo TCP veze. Ako je zatvoren, odgovara se sa nedostupnim portom, ako se odgovori drugim icmp-om ili ne odgovori, ostaje kao nedostupan odredištu.
* **`-PE, -PP, -PM`** : ICMP PING-ovi: eho odgovor, vremenski pečat i maska adrese. Pokreću se kako bi saznali da li je cilj aktivan.
* **`-PY<ports>`**: Šalje SCTP INIT probe na 80 podrazumevano, INIT-ACK(otvoren) ili ABORT(zatvoren) ili ništa ili ICMP nedostupan(neaktivan) mogu biti odgovoreni.
* **`-PO <protocols>`**: Protokol je naznačen u zaglavljima, podrazumevano 1(ICMP), 2(IGMP) i 4(Encap IP). Za ICMP, IGMP, TCP (6) i UDP (17) protokole šalju se zaglavlja protokola, za ostale se šalje samo IP zaglavlje. Svrha ovoga je da zbog deformacije zaglavlja, na zahtevima za nedostupnim protokolom ili odgovorima istog protokola saznate da li je aktivan.
* **`-n`**: Bez DNS-a
* **`-R`**: Uvek DNS

### Tehnike skeniranja portova

* **`-sS`**: Ne završava vezu tako da ne ostavlja trag, veoma dobro ako se može koristiti (privilegije). Ovo je podrazumevano korišćeno.
* **`-sT`**: Završava vezu, pa ostavlja trag, ali se može koristiti sigurno. Podrazumevano bez privilegija.
* **`-sU`**: Sporije, za UDP. Najčešće: DNS(53), SNMP(161,162), DHCP(67 i 68), (-sU53,161,162,67,68): otvoren(odgovor), zatvoren(nedostupan port), filtriran(drugi ICMP), otvoren/filtriran (ništa). U slučaju otvoren/filtriran, -sV šalje brojne zahteve kako bi otkrio bilo koju od verzija koje nmap podržava i može otkriti pravo stanje. Značajno povećava vreme.
* **`-sY`**: SCTP protokol ne uspeva da uspostavi vezu, tako da nema zapisa, radi kao -PY
* **`-sN,-sX,-sF`:** Null, Fin, Xmas, mogu proći kroz neke firewalle i izvući informacije. Bazirane su na činjenici da standardno usklađeni uređaji treba da odgovore sa RST na sve zahteve koji nemaju SYN, RST ili ACK oznake podignute: otvoren/filtriran(ništa), zatvoren(RST), filtriran (ICMP nedostupan). Nepouzdane na Windows-u, CIsco-u, BSDI i OS/400. Na unix-u da.
* **`-sM`**: Maimon sken: Šalje FIN i ACK oznake, korišćeno za BSD, trenutno će sve vratiti kao zatvoreno.
* **`-sA, sW`**: ACK i Prozor, koristi se za otkrivanje firewalla, da bi se saznalo da li su portovi filtrirani ili ne. -sW razlikuje između otvorenih/zatvorenih jer otvoreni odgovaraju sa različitom vrednošću prozora: otvoren (RST sa prozorom različitim od 0), zatvoren (RST prozor = 0), filtriran (ICMP nedostupan ili ništa). Ne svi računari rade na ovaj način, pa ako su svi zatvoreni, ne radi, ako su neki otvoreni, radi dobro, a ako su mnogi otvoreni i malo zatvoreni, radi obrnuto.
* **`-sI`:** Idle sken. Za slučajeve kada postoji aktivan firewall, ali znamo da ne filtrira određeni IP (ili kada jednostavno želimo anonimnost) možemo koristiti zombie skener (radi za sve portove), da bismo pronašli moguće zombije možemo koristiti skriptu ipidseq ili eksploataciju auxiliary/scanner/ip/ipidseq. Ovaj skener se zasniva na broju IP paketa IPID.
* **`--badsum`:** Šalje pogrešan zbir, računari bi odbacili pakete, ali firewalli bi mogli odgovoriti nešto, koristi se za otkrivanje firewalla.
* **`-sZ`:** "Čudan" SCTP skener, prilikom slanja proba sa fragmentima cookie eha, trebali bi biti odbačeni ako su otvoreni ili odgovoreni sa ABORT ako su zatvoreni. Može proći kroz firewalle kroz koje init ne može proći, loša strana je što ne razlikuje između filtriranih i otvorenih.
* **`-sO`:** Skeniranje protokola Ip. Šalje loša i prazna zaglavlja u kojima se ponekad ne može razlikovati ni protokol. Ako stigne ICMP nedostupan protokol, zatvoren je, ako stigne nedostupan port, otvoren je, ako stigne druga greška, filtriran je, ako ništa ne stigne, otvoren|filtriran.
* **`-b <server>`:** FTPhost--> Koristi se za skeniranje hosta sa drugog, to se radi povezivanjem ftp-a druge mašine i traženjem da pošalje fajlove na portove koje želite skenirati sa druge mašine, prema odgovorima saznaćemo da li su otvoreni ili ne. \[\<user>:\<password>@]\<server>\[:\<port>] Skoro svi ftp serveri više ne dozvoljavaju ovo i stoga je od malo praktične koristi.

### **Analiza portova**

**-p:** Koristi se za određivanje portova za skeniranje. Za odabir svih 65335: **-p-** ili **-p all**. Nmap ima internu klasifikaciju prema popularnosti. Podrazumevano koristi prvih 1000. Sa **-F** (brzo skeniranje) analizira prvih 100. Sa **--top-ports \<numero>** Analizira taj broj glavnih portova (od 1 do 65335). Proverava portove u nasumičnom redosledu, da se to ne bi dogodilo **-r**. Takođe možemo odabrati portove: 20-30,80,443,1024- Ovo poslednje znači da gleda portove od 1024 nadalje. Takođe možemo grupisati portove po protokolima: U:53,T:21-25,80,139,S:9. Takođe možemo odabrati opseg unutar popularnih nmap portova: -p \[-1024] analizira do 1024 uključenih u nmap-services. **--port-ratio \<ratio>** Analizira najčešće korišćene portove sa odnosom koji treba biti između 0 i 1

**-sV** Skeniranje verzije, može se podešavati intenzitet od 0 do 9, podrazumevano 7.

**--version-intensity \<numero>** Podešavamo intenzitet, tako da što je niži, lansira samo najverovatnije sonde, ali ne sve. Time možemo značajno skratiti vreme skeniranja UDP

**-O** Detekcija OS-a

**--osscan-limit** Da bi dobro skenirao host, potrebno je da postoji barem jedan otvoren i jedan zatvoren port, ako se ovo ne ispuni i postavili smo ovo, ne pokušava predviđanje OS-a (štedi vreme)
**--osscan-guess** Kada detekcija operativnog sistema nije savršena, ovaj parametar povećava napor

**Skripte**

\--script _\<imefajla>_|_\<kategorija>_|_\<direktorijum>_|_\<izraz>_\[,...]

Za korišćenje podrazumevanih skripti, dovoljno je koristiti -sC ili --script=default

Tipovi skripti uključuju: auth, broadcast, default, discovery, dos, exploit, external, fuzzer, intrusive, malware, safe, version i vuln

* **Auth:** izvršava sve dostupne skripte za autentifikaciju
* **Default:** izvršava osnovne podrazumevane skripte alata
* **Discovery:** prikuplja informacije o meti ili žrtvi
* **External:** skripta za korišćenje spoljnih resursa
* **Intrusive:** koristi skripte koje se smatraju napadnim za žrtvu ili metu
* **Malware:** proverava da li postoje otvorene veze putem zlonamernih kodova ili vrata zaobilaska (backdoors)
* **Safe:** izvršava skripte koje nisu napadne
* **Vuln:** otkriva najpoznatije ranjivosti
* **All:** izvršava sve dostupne NSE skripte

Za pretragu skripti:

**nmap --script-help="http-\*" -> One koje počinju sa http-**

**nmap --script-help="not intrusive" -> Sve osim tih**

**nmap --script-help="default or safe" -> One koje su u jednom ili drugom ili oba**

**nmap --script-help="default and safe" --> One koje su u oba**

**nmap --script-help="(default or safe or intrusive) and not http-\*"**

\--script-args _\<n1>_=_\<v1>_,_\<n2>_={_\<n3>_=_\<v3>_},_\<n4>_={_\<v4>_,_\<v5>_}

\--script-args-file _\<imefajla>_

\--script-help _\<imefajla>_|_\<kategorija>_|_\<direktorijum>_|_\<izraz>_|all\[,...]

\--script-trace ---> Pruža informacije o toku skripte

\--script-updatedb

**Za korišćenje jedne skripte, dovoljno je navesti: nmap --script Ime\_skripte cilj** --> Navođenjem skripte, izvršiće se i skripta i skener, pa se mogu dodati opcije skenera, možemo dodati **“safe=1”** da bi se izvršile samo sigurne skripte.

**Kontrola vremena**

**Nmap može modifikovati vreme u sekundama, minutima, ms:** --host-timeout argumenti 900000ms, 900, 900s, i 15m rade istu stvar.

Nmap deli ukupan broj hostova za skeniranje u grupe i analizira te grupe u blokovima, tako da ne prelazi na sledeći blok dok svi nisu analizirani (i korisnik takođe ne dobija ažuriranja dok blok nije analiziran). Na ovaj način, za nmap je efikasnije koristiti veće grupe. Podrazumevano za klasu C koristi 256.

Može se promeniti sa\*\*--min-hostgroup\*\* _**\<brojhostova>**_**;** **--max-hostgroup** _**\<brojhostova>**_ (Prilagodi veličine paralelnih grupa skeniranja)

Može se kontrolisati broj skenera istovremeno, ali je bolje ne (nmap već ima automatsku kontrolu na osnovu stanja mreže): **--min-parallelism** _**\<brojproba>**_**;** **--max-parallelism** _**\<brojproba>**_

Možemo promeniti rtt timeout, ali obično nije potrebno: **--min-rtt-timeout** _**\<vreme>**_**,** **--max-rtt-timeout** _**\<vreme>**_**,** **--initial-rtt-timeout** _**\<vreme>**

Možemo promeniti broj pokušaja:**--max-retries** _**\<brojpokušaja>**_

Možemo promeniti vreme skeniranja hosta: **--host-timeout** _**\<vreme>**_

Možemo promeniti vreme između svake probe da bude sporije: **--scan-delay** _**\<vreme>**_**;** **--max-scan-delay** _**\<vreme>**_

Možemo promeniti broj paketa po sekundi: **--min-rate** _**\<broj>**_**;** **--max-rate** _**\<broj>**_

Mnogi portovi dugo traju da odgovore jer su filtrirani ili zatvoreni, ako nas zanimaju samo otvoreni, možemo biti brži sa: **--defeat-rst-ratelimit**

Za definisanje agresivnosti nmap-a: -T paranoid|sneaky|polite|normal|aggressive|insane

\-T (0-1)

\-T0 --> Skenira se samo 1 port odjednom i čeka 5 minuta do sledećeg

\-T1 i T2 --> Veoma slični, ali čekaju samo 15 i 0,4 sekundi između svake probe

\-T3 --> Podrazumevano ponašanje, uključuje paralelno skeniranje

\-T4 --> --max-rtt-timeout 1250ms --min-rtt-timeout 100ms --initial-rtt-timeout 500ms --max-retries 6 --max-scan-delay 10ms

\-T5 --> --max-rtt-timeout 300ms --min-rtt-timeout 50ms --initial-rtt-timeout 250ms --max-retries 2 --host-timeout 15m --max-scan-delay 5ms

**Firewall/IDS**

Blokiraju portove i analiziraju pakete.

**-f** Za fragmentaciju paketa, podrazumevano ih fragmentiše na 8 bajtova nakon zaglavlja, za specificiranje veličine koristimo ..mtu (sa ovim, ne koristiti -f), offset mora biti višekratnik od 8. **Skeneri verzija i skripti ne podržavaju fragmentaciju**

**-D decoy1,decoy2,ME** Nmap šalje skenere ali sa drugim IP adresama kao izvor, na taj način se skrivate. Ako stavite ME u listu, nmap će vas postaviti tamo, bolje je staviti 5 ili 6 ispred vas da vas potpuno zamaskira. Mogu se generisati slučajne IP adrese sa RND:\<broj> Za generisanje \<broj> slučajnih IP adresa. Ne funkcionišu sa detektorom verzija bez TCP konekcije. Ako ste unutar mreže, korisno je koristiti IP adrese koje su aktivne, jer će inače biti lako otkriti da ste jedini aktivan.

Za korišćenje slučajnih IP adresa: nmap-D RND: 10 Ip\_cilj

**-S IP** Kada Nmap ne prepoznaje vašu IP adresu, morate je navesti na ovaj način. Takođe se može koristiti da se stvori utisak da drugi cilj skenira njih.

**-e \<interfejs>** Za izbor interfejsa

Mnogi administratori ostavljaju otvorene ulazne portove kako bi sve funkcionisalo ispravno i bilo im je lakše nego tražiti drugo rešenje. Ovi portovi mogu biti DNS portovi ili FTP... za pronalaženje ove ranjivosti, nmap uključuje: **--source-port** _**\<brojporta>**_**;-g** _**\<brojporta>**_ _Su ekvivalentni_

**--data** _**\<heksadecimalnistring>**_ Za slanje heksadecimalnog teksta: --data 0xdeadbeef i --data \xCA\xFE\x09

**--data-string** _**\<string>**_ Za slanje običnog teksta: --data-string "Skeniranje sprovedeno od strane Bezbednosnih operacija, ekstenzija 7192"

**--data-length** _**\<broj>**_ Nmap šalje samo zaglavlja, ovim dodajemo određeni broj bajtova (koji će se generisati nasumično)

Za potpuno konfigurisanje IP paketa koristiti **--ip-options**

Ako želite videti opcije u poslatim i primljenim paketima, navedite --packet-trace. Za više informacija i primere korišćenja IP opcija sa Nmap-om, pogledajte [http://seclists.org/nmap-dev/2006/q3/52](http://seclists.org/nmap-dev/2006/q3/52).

**--ttl** _**\<vrednost>**_

**--randomize-hosts** Da napad bude manje očigledan

**--spoof-mac** _**\<MAC adresa, prefiks, ili ime proizvođača>**_ Za promenu MAC adrese primeri: Apple, 0, 01:02:03:04:05:06, deadbeefcafe, 0020F2, i Cisco
**--proxies** _**\<Zarezom odvojeni URL-ovi proxy servera>**_ Za korišćenje proxy servera, ponekad proxy server ne održava toliko otvorenih veza koliko nmap želi, pa bi trebalo prilagoditi paralelizam: --max-parallelism

**-sP** Za otkrivanje hostova u mreži u kojoj se nalazimo putem ARP-a

Mnogi administratori postavljaju pravilo u firewall-u koje dozvoljava prolaz svih paketa koji dolaze sa određenog porta (kao što su 20, 53 i 67), možemo reći nmap-u da šalje naše pakete sa tih portova: **nmap --source-port 53 IP**

**Izlazi**

**-oN file** Normalan izlaz

**-oX file** XML izlaz

**-oS file** Izlaz za skriptove

**-oG file** Grepable izlaz

**-oA file** Svi osim -oS

**-v level** nivo detaljnosti

**-d level** debagovanje

**--reason** Razlog hosta i stanja

**--stats-every time** Svaki put kada protekne to vreme, prikazuje nam kako ide

**--packet-trace** Za praćenje paketa koji se šalju, mogu se specificirati filteri poput: --version-trace ili --script-trace

**--open** prikazuje otvorene, otvorene|filtrirane i ne filtrirane

**--resume file** Pravi rezime

**Razno**

**-6** Dozvoljava ipv6

**-A** isto što i -O -sV -sC --traceroute

**Vreme izvršavanja**

Dok nmap radi, možemo menjati opcije:

v / V Povećajte / smanjite nivo detaljnosti

d / D Povećajte / smanjite nivo debagovanja

p / P Uključite / isključite praćenje paketa

? Prikazuje pomoćni ekran za interakciju u toku izvršavanja

**Vulscan**

Skripta nmap-a koja proverava verzije servisa dobijene iz offline baze podataka (koju preuzima sa drugih veoma važnih) i vraća moguće ranjivosti

Baze podataka koje koristi su:

1. Scipvuldb.csv | [http://www.scip.ch/en/?vuldb](http://www.scip.ch/en/?vuldb)
2. Cve.csv | [http://cve.mitre.org](http://cve.mitre.org/)
3. Osvdb.csv | [http://www.osvdb.org](http://www.osvdb.org/)
4. Securityfocus.csv | [http://www.securityfocus.com/bid/](http://www.securityfocus.com/bid/)
5. Securitytracker.csv | [http://www.securitytracker.com](http://www.securitytracker.com/)
6. Xforce.csv | [http://xforce.iss.net](http://xforce.iss.net/)
7. Exploitdb.csv | [http://www.exploit-db.com](http://www.exploit-db.com/)
8. Openvas.csv | [http://www.openvas.org](http://www.openvas.org/)

Za preuzimanje i instaliranje u Nmap folderu:

wget http://www.computec.ch/projekte/vulscan/download/nmap\_nse\_vulscan-2.0.tar.gz && tar -czvf nmap\_nse\_vulscan-2.0.tar.gz vulscan/ && sudo cp -r vulscan/ /usr/share/nmap/scripts/

Takođe je potrebno preuzeti pakete baza podataka i dodati ih u /usr/share/nmap/scripts/vulscan/

Korišćenje:

Za korišćenje svih: sudo nmap -sV --script=vulscan HOST\_A\_ESCANEAR

Za korišćenje određene baze podataka: sudo nmap -sV --script=vulscan --script-args vulscandb=cve.csv HOST\_A\_ESCANEAR

## Povećajte brzinu skeniranja servisa u Nmap-u x16

Prema [**ovom postu**](https://joshua.hu/nmap-speedup-service-scanning-16x) možete ubrzati analizu servisa u nmap-u tako što ćete promeniti sve vrednosti **`totalwaitms`** u **`/usr/share/nmap/nmap-service-probes`** na **300** i **`tcpwrappedms`** na **200**.

Osim toga, sonde koje nemaju posebno definisanu vrednost **`servicewaitms`** koriste podrazumevanu vrednost **`5000`**. Stoga, možemo dodati vrednosti za svaku sondu ili možemo **kompajlirati nmap** sami i promeniti podrazumevanu vrednost u [**service\_scan.h**](https://github.com/nmap/nmap/blob/master/service\_scan.h#L79).

Ako ne želite uopšte da menjate vrednosti **`totalwaitms`** i **`tcpwrappedms`** u fajlu `/usr/share/nmap/nmap-service-probes`, možete izmeniti [kod za parsiranje](https://github.com/nmap/nmap/blob/master/service\_scan.cc#L1358) tako da se ove vrednosti u fajlu `nmap-service-probes` potpuno ignorišu.

<figure><img src="/.gitbook/assets/WebSec_1500x400_10fps_21sn_lightoptimized_v2.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

<details>

<summary><strong>Naučite hakovanje AWS-a od početka do naprednog nivoa sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi načini podrške HackTricks-u:

* Ako želite da vidite svoju **kompaniju reklamiranu na HackTricks-u** ili da **preuzmete HackTricks u PDF formatu** proverite [**PLANOVE ZA PRIJAVU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvanični PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), našu kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridružite se** 💬 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili **telegram grupi** ili nas **pratite** na **Twitteru** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
