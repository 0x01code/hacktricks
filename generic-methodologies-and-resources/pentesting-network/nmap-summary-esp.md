<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks云 ☁️</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>🐦 推特 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 Youtube 🎥</strong></a></summary>

- 你在一家**网络安全公司**工作吗？想要在HackTricks中看到你的**公司广告**吗？或者你想要**获取PEASS的最新版本或下载HackTricks的PDF**吗？请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！

- 发现我们的独家[**NFTs**](https://opensea.io/collection/the-peass-family)收藏品——[**The PEASS Family**](https://opensea.io/collection/the-peass-family)

- 获取[**官方PEASS和HackTricks周边产品**](https://peass.creator-spring.com)

- **加入** [**💬**](https://emojipedia.org/speech-balloon/) [**Discord群组**](https://discord.gg/hRep4RUj7f) 或 [**Telegram群组**](https://t.me/peass)，或者在**Twitter**上**关注**我 [**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**

- **通过向[hacktricks仓库](https://github.com/carlospolop/hacktricks)和[hacktricks-cloud仓库](https://github.com/carlospolop/hacktricks-cloud)提交PR来分享你的黑客技巧**。

</details>
```text
nmap -sV -sC -O -n -oA nmapscan 192.168.0.1/24
```
**-iL** lista\_IPs

**-iR** numero --&gt; 随机IP数量，可以使用**--exclude &lt;Ips&gt;**或**--excludefile &lt;fichero&gt;**排除可能的IP

**设备发现:**

我们可以使用掩码/24

**-sL**: 非侵入性，通过DNS请求列出目标以解析名称。用于确定例如www.prueba.es/24中的所有IP是否是我们的目标。

默认情况下，Nmap会执行发现阶段，包括：-PA80 -PS443 -PE -PP

**-Pn** 无ping --&gt; 仅在**已知所有设备都处于活动状态**时有用（否则可能会浪费很多时间），阻止发现阶段

**-sn** 无端口扫描: 在完成识别阶段后**不分析端口**。相对隐蔽，允许对网络进行简单的识别。使用特权发送ACK（-PA）到80端口，发送SYN（-PS）到443端口，发送回显请求和时间戳请求，无特权时始终完成连接。如果目标是网络中的设备，则仅使用ARP（-PR）。如果与其他选项一起使用，则只会发送其他选项的数据包。

**-PR** ARP Ping: 默认情况下，用于分析本地网络中的设备，比使用ping更快。如果不想使用ARP数据包，则需要使用--send-ip。

**-PS&lt;ports&gt;** SYN: 向指定端口发送SYN数据包，如果收到SYN/ACK响应，则表示端口开放（发送RST以终止连接），如果收到RST响应，则表示端口关闭，如果没有响应，则表示不可达。如果没有特权，则自动使用完全连接。如果未指定端口，则默认发送到80端口。

**-PA&lt;ports&gt;** ACK: 与上述相同，但使用ACK。结合使用这两个选项可以获得更好的结果。

**-PU&lt;ports&gt;** UDP: 目标是相反的，发送到预计关闭的端口。某些防火墙仅检查TCP连接。如果端口关闭，则回复端口不可达，如果回复其他ICMP消息或未回复，则将其视为不可达目标。

**-PE, -PP, -PM** ICMP PING: 发送回显回复、时间戳和地址掩码请求以确定目标是否处于活动状态

**-PY&lt;ports&gt;** SCTP: 默认情况下，向80端口发送SCTP INIT探测，可以回复INIT-ACK（开放）、ABORT（关闭）或无响应或ICMP不可达（不活动）

-**PO&lt;protocols&gt;:** 在头部指定协议，默认为1（ICMP）、2（IGMP）和4（Encap IP）。对于ICMP、IGMP、TCP（6）和UDP（17）协议，发送协议头部，对于其他协议，仅发送IP头部。目的是通过协议头部的格式错误，收到协议不可达或相同协议的响应，以确定目标是否处于活动状态。

**-n** 无DNS解析

**-R** 始终进行DNS解析

**端口扫描技术:**

**-sS** --&gt; 不完整的连接，因此不会留下痕迹，如果可以使用则非常好（需要特权）。默认情况下使用此选项。

**-sT** --&gt; 完整的连接，因此会留下痕迹，但可以使用。默认情况下无需特权。

**-sU** --&gt; 更慢，用于UDP。主要用于：DNS（53）、SNMP（161,162）、DHCP（67和68）、\(-sU53,161,162,67,68\): 开放（有响应）、关闭（端口不可达）、过滤（其他ICMP消息）、开放/过滤（无响应）。如果开放/过滤，-sV会发送大量请求以检测Nmap支持的版本之一，从而可以检测真实状态。增加了扫描时间。

**-sY** --&gt; SCTP协议不会建立连接，因此没有记录，与-PY相同的功能

**-sN,-sX,-sF** --&gt; Null、Fin、Xmas，可以绕过某些防火墙并获取信息。基于符合标准的设备应该对没有SYN、RST或ACK标志的请求响应RST：开放/过滤（无响应）、关闭（RST）、过滤（ICMP不可达）。在Windows、Cisco、BSDI和OS/400上不可靠，在Unix上可靠。

**-sM Maimon scan:** 发送FIN和ACK标志，用于BSD，目前将所有内容返回为关闭状态。

**-sA, sW** --&gt; ACK和Window，用于检测防火墙，以确定端口是否被过滤。-sW可以区分开放/关闭状态，因为开放状态会以不同的窗口值响应：开放（RST窗口值不为0）、关闭（RST窗口值为0）、过滤（ICMP不可达或无响应）。不是所有设备都按此方式工作，因此如果所有端口都关闭，则表示不起作用；如果只有少数端口开放，则表示工作正常；如果有很多端口开放和少数端口关闭，则表示工作方式相反。

**-sI Idle scan** --&gt; 用于存在活动防火墙但我们知道该防火墙不会过滤特定IP（或者仅用于匿名性）的情况下，可以使用僵尸扫描器（适用于所有端口），可以使用ipidseq脚本或exploit auxiliary/scanner/ip/ipidseq来查找可能的僵尸。此扫描器基于IP数据包的IPID编号。

**--badsum --&gt;** 发送错误的校验和，设备将丢弃数据包，但防火墙可能会响应，用于检测防火墙

**-sZ** --&gt; SCTP的“奇怪”扫描器，通过发送带有cookie echo片段的探测来消除开放状态，或者如果关闭则回复ABORT。可以绕过无法绕过init的防火墙，但不区分过滤和开放状态。

**-sO** --&gt; IP协议扫描：发送格式错误和空的头部，有时无法区分协议。如果收到ICMP不可达协议，则表示关闭；如果收到不可达端口，则表示开放；如果收到其他错误，则表示过滤；如果没有收到任何响应，则表示开放\|过滤
**-b&lt;server&gt;** FTPhost--&gt; 用于从另一台主机扫描目标主机，它通过连接到另一台机器的FTP并请求将文件发送到要扫描的端口，根据响应确定它们是否打开。 \[&lt;username&gt;:&lt;password&gt;@\]&lt;server&gt;\[:&lt;port&gt;\] 大多数FTP服务器已经禁止了这种操作，因此它的实际用途已经很少了。

**集中分析:**

**-p:** 用于指定要扫描的端口。要选择所有65335个端口：**-p-** 或 **-p all**。Nmap根据端口的流行程度进行内部分类。默认情况下，它使用前1000个常用端口。使用**-F**（快速扫描）分析前100个常用端口。使用**--top-ports &lt;number&gt;**分析指定数量的常用端口（从1到65335）。它以随机顺序检查端口，为了避免这种情况，可以使用**-r**。我们还可以选择端口范围：20-30,80,443,1024- 这最后一个表示从1024开始的所有端口。我们还可以按协议分组端口：U:53,T:21-25,80,139,S:9。我们还可以选择nmap中常用端口范围内的一个范围：-p \[-1024\] 分析nmap-services中包含的前1024个端口。**--port-ratio &lt;ratio&gt;** 分析最常用的端口，比例必须在0和1之间。

**-sV** 版本扫描，可以调整强度从0到9，默认为7。

**--version-intensity &lt;number&gt;** 调整强度，较低的强度只会发送最可能的探测请求，而不是全部。这样可以大大缩短UDP扫描时间。

**-O** 操作系统检测

**--osscan-limit** 要正确扫描主机，至少需要一个打开的端口和一个关闭的端口，如果不满足此条件并且已经设置了此选项，则不会尝试进行操作系统预测（节省时间）。

**--osscan-guess** 当操作系统检测不完美时，这会增加尝试次数。

**脚本**

--script _&lt;filename&gt;_\|_&lt;category&gt;_\|_&lt;directory&gt;_\|_&lt;expression&gt;_\[,...\]

要使用默认脚本，只需使用-sC或--script=default

可用的类型有：auth、broadcast、default、discovery、dos、exploit、external、fuzzer、intrusive、malware、safe、version和vuln

* **Auth：**执行所有可用于身份验证的脚本
* **Default：**执行工具的默认基本脚本
* **Discovery：**获取目标或受害者的信息
* **External：**使用外部资源的脚本
* **Intrusive：**使用对受害者或目标来说是侵入性的脚本
* **Malware：**检查是否存在由恶意代码或后门打开的连接
* **Safe：**执行非侵入性的脚本
* **Vuln：**发现最常见的漏洞
* **All：**执行所有可用的NSE扩展脚本

要搜索脚本：

**nmap --script-help="http-\*" -&gt; 以http-开头的脚本**

**nmap --script-help="not intrusive" -&gt; 除了这些之外的所有脚本**

**nmap --script-help="default or safe" -&gt; 在一个或两个类别中的脚本**

**nmap --script-help="default and safe" --&gt; 在两个类别中的脚本**

**nmap --script-help="\(default or safe or intrusive\) and not http-\*"**

--script-args _&lt;n1&gt;_=_&lt;v1&gt;_,_&lt;n2&gt;_={_&lt;n3&gt;_=_&lt;v3&gt;_},_&lt;n4&gt;_={_&lt;v4&gt;_,_&lt;v5&gt;_}

--script-args-file _&lt;filename&gt;_

--script-help _&lt;filename&gt;_\|_&lt;category&gt;_\|_&lt;directory&gt;_\|_&lt;expression&gt;_\|all\[,...\]

--script-trace ---&gt; 提供脚本的详细信息

--script-updatedb

**要使用脚本，只需输入：nmap --script Script_Name target** --&gt; 输入脚本将同时执行脚本和扫描器，因此也可以添加扫描器选项，我们可以添加**“safe=1”**以仅执行安全脚本。

**时间控制**

**Nmap可以使用秒、分钟、毫秒来调整时间：** --host-timeout arguments 900000ms, 900, 900s, and 15m all do the same thing.

Nmap将要扫描的主机总数分成组，并以块的形式分析这些组，直到所有组都被分析完毕才进入下一个块（用户在分析块之前也不会收到任何更新）。这样，对于Nmap来说，使用较大的组更加高效。默认情况下，在C类网络中使用256个组。

可以使用**--min-hostgroup** _**&lt;numhosts&gt;**_**;** **--max-hostgroup** _**&lt;numhosts&gt;**_（调整并行扫描组的大小）

可以控制并行扫描器的数量，但最好不要这样做（nmap已经根据网络状态自动进行了控制）：**--min-parallelism** _**&lt;numprobes&gt;**_**;** **--max-parallelism** _**&lt;numprobes&gt;**_

可以修改RTT超时时间，但通常不需要：**--min-rtt-timeout** _**&lt;time&gt;**_**,** **--max-rtt-timeout** _**&lt;time&gt;**_**,** **--initial-rtt-timeout** _**&lt;time&gt;**_

可以修改尝试次数：**--max-retries** _**&lt;numtries&gt;**_

可以修改主机扫描时间：**--host-timeout** _**&lt;time&gt;**_

可以修改每个探测之间的延迟时间，以便慢慢进行：**--scan-delay** _**&lt;time&gt;**_**;** **--max-scan-delay** _**&lt;time&gt;**_

可以修改每秒发送的数据包数量：**--min-rate** _**&lt;number&gt;**_**;** **--max-rate** _**&lt;number&gt;**_

许多端口在被过滤或关闭时响应时间很长，如果只关注打开的端口，可以使用以下选项加快速度：**--defeat-rst-ratelimit**
要定义nmap的侵略性：-T paranoid\|sneaky\|polite\|normal\|aggressive\|insane

-T \(0-1\)

-T0 --&gt;每次只扫描一个端口，等待5分钟再进行下一个扫描

-T1和T2 --&gt;非常相似，但等待时间分别为15秒和0.4秒

-T3 --&gt;默认模式，包括并行扫描

-T4 --&gt; --max-rtt-timeout 1250ms --min-rtt-timeout 100ms --initial-rtt-timeout 500ms --max-retries 6 --max-scan-delay 10ms

-T5 --&gt; --max-rtt-timeout 300ms --min-rtt-timeout 50ms --initial-rtt-timeout 250ms --max-retries 2 --host-timeout 15m --max-scan-delay 5ms

**防火墙/IDS**

阻止端口访问并分析数据包。

**-f**用于分片数据包，默认情况下将数据包分片为8字节，可以使用..mtu来指定分片大小（不使用-f），偏移量必须是8的倍数。**版本扫描器和脚本不支持分片**

**-D decoy1,decoy2,ME** Nmap发送扫描请求，但使用其他IP地址作为源地址，以隐藏真实身份。如果将ME放在列表中，Nmap将使用您的真实IP地址，最好在您之前放置5或6个IP地址以完全掩盖您的身份。可以使用RND:&lt;number&gt;生成随机IP地址，生成&lt;number&gt;个随机IP地址。不适用于无TCP连接的版本检测。如果您在一个网络中，最好使用活动的IP地址，否则很容易发现您是唯一的活动IP地址。

使用随机IP地址：nmap -D RND:10 Target_IP

**-S IP**当Nmap无法获取您的IP地址时，您需要使用此选项指定IP地址。也可用于让目标认为有其他主机正在扫描它们。

**-e &lt;interface&gt;**选择要使用的网络接口

许多管理员会打开入站端口以确保系统正常运行，并且这样做比寻找其他解决方案更容易。这些端口可能是DNS或FTP端口...为了查找此漏洞，nmap提供了以下选项：**--source-port** _**&lt;portnumber&gt;**_**;-g** _**&lt;portnumber&gt;**_ **等效**

**--data** _**&lt;hex string&gt;**_用于发送十六进制文本：--data 0xdeadbeef和--data \xCA\xFE\x09

**--data-string** _**&lt;string&gt;**_用于发送普通文本：--data-string "Scan conducted by Security Ops, extension 7192"

**--data-length** _**&lt;number&gt;**_ Nmap仅发送报头，使用此选项可以使其添加指定数量的字节（随机生成）

要完全配置IP数据包，请使用**--ip-options**

如果要查看发送和接收的数据包选项，请指定--packet-trace。有关使用Nmap的IP选项的更多信息和示例，请参阅[http://seclists.org/nmap-dev/2006/q3/52](http://seclists.org/nmap-dev/2006/q3/52)。

**--ttl** _**&lt;value&gt;**_

**--randomize-hosts**使攻击不那么明显

**--spoof-mac** _**&lt;MAC address, prefix, or vendor name&gt;**_更改MAC地址的选项，例如：Apple, 0, 01:02:03:04:05:06, deadbeefcafe, 0020F2, and Cisco

**--proxies** _**&lt;Comma-separated list of proxy URLs&gt;**_使用代理，有时代理无法维持与nmap所需的连接数，因此需要调整并行性：--max-parallelism

**-sP**通过ARP发现网络中的主机

许多管理员在防火墙中创建了一个规则，允许通过特定端口（如20、53和67）的所有数据包通过，我们可以告诉nmap从这些端口发送我们的数据包：**nmap --source-port 53 Target_IP**

**输出**

**-oN file**普通输出

**-oX file**XML输出

**-oS file**脚本输出

**-oG file**可grep输出

**-oA file**除了脚本输出之外的所有输出

**-v level**详细程度

**-d level**调试级别

**--reason**显示主机和状态的原因

**--stats-every time**每隔一段时间显示扫描统计信息

**--packet-trace**查看发送的数据包，可以指定过滤器，如：--version-trace或--script-trace

**--open**显示开放、开放\|过滤和未过滤的端口

**--resume file**生成扫描摘要

**其他**

**-6**启用IPv6

**-A**等同于-O -sV -sC --traceroute

**运行时**

在nmap运行时可以更改选项：

v / V 增加/减少详细程度

d / D 增加/减少调试级别

p / P 打开/关闭数据包跟踪

? 打印运行时交互帮助屏幕

**Vulscan**

Nmap脚本，检查从离线数据库（从其他重要数据库下载）获取的服务版本，并返回可能的漏洞。

使用的数据库：

1. Scipvuldb.csv \| [http://www.scip.ch/en/?vuldb](http://www.scip.ch/en/?vuldb)
2. Cve.csv \| [http://cve.mitre.org](http://cve.mitre.org/)
3. Osvdb.csv \| [http://www.osvdb.org](http://www.osvdb.org/)
4. Securityfocus.csv \| [http://www.securityfocus.com/bid/](http://www.securityfocus.com/bid/)
5. Securitytracker.csv \| [http://www.securitytracker.com](http://www.securitytracker.com/)
6. Xforce.csv \| [http://xforce.iss.net](http://xforce.iss.net/)
7. Exploitdb.csv \| [http://www.exploit-db.com](http://www.exploit-db.com/)
8. Openvas.csv \| [http://www.openvas.org](http://www.openvas.org/)

要下载并安装到Nmap文件夹中：

wget http://www.computec.ch/projekte/vulscan/download/nmap\_nse\_vulscan-2.0.tar.gz && tar -czvf nmap\_nse\_vulscan-2.0.tar.gz vulscan/ && sudo cp -r vulscan/ /usr/share/nmap/scripts/

还需要下载数据库文件并将其添加到/usr/share/nmap/scripts/vulscan/中。

用法：

要使用所有数据库：sudo nmap -sV --script=vulscan TARGET\_IP
要使用特定的数据库：sudo nmap -sV --script=vulscan --script-args vulscandb=cve.csv HOST_A_TO_SCAN



<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks Cloud ☁️</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>🐦 Twitter 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 Youtube 🎥</strong></a></summary>

- 你在一家**网络安全公司**工作吗？你想在HackTricks中看到你的**公司广告**吗？或者你想获得**PEASS的最新版本或下载PDF格式的HackTricks**吗？请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！

- 发现我们的独家[NFT收藏品**The PEASS Family**](https://opensea.io/collection/the-peass-family)

- 获取[**官方PEASS和HackTricks周边产品**](https://peass.creator-spring.com)

- **加入**[**💬**](https://emojipedia.org/speech-balloon/) [**Discord群组**](https://discord.gg/hRep4RUj7f) 或 [**Telegram群组**](https://t.me/peass) 或 **关注**我在**Twitter**上的[**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**

- **通过向[hacktricks repo](https://github.com/carlospolop/hacktricks)和[hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)提交PR来分享你的黑客技巧**。

</details>
