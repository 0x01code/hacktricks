# Le spoofing de SSDP et des dispositifs UPnP avec EvilSSDP

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Travaillez-vous dans une entreprise de **cybers√©curit√©** ? Voulez-vous voir votre **entreprise annonc√©e dans HackTricks** ? ou voulez-vous avoir acc√®s √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**üí¨**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR au [repo hacktricks](https://github.com/carlospolop/hacktricks) et au [repo hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>

**Ce post a √©t√© copi√© depuis** [**https://www.hackingarticles.in/evil-ssdp-spoofing-the-ssdp-and-upnp-devices/**](https://www.hackingarticles.in/evil-ssdp-spoofing-the-ssdp-and-upnp-devices/)

## **Introduction**

### **Qu'est-ce que SSDP ?**

SSDP ou Simple Service Discovery Protocol est un protocole de r√©seau con√ßu pour la **publicit√© et la d√©couverte des services de r√©seau**. Il peut fonctionner sans aucune configuration DHCP ou DNS. Il a √©t√© con√ßu pour √™tre utilis√© dans des environnements r√©sidentiels ou de petits bureaux. Il utilise UDP comme protocole de transport sous-jacent sur le **port 1900**. Il utilise la m√©thode HTTP NOTIFY pour annoncer l'√©tablissement ou le retrait de services √† un groupe multicast. C'est la base du protocole de d√©couverte UPnP.

### **Quels sont les dispositifs UPnP ?**

UPnP ou Universal Plug and Play est un ensemble de **protocoles de r√©seau** qui permettent aux dispositifs en r√©seau, tels que les ordinateurs personnels, les imprimantes, les passerelles Internet, les points d'acc√®s Wi-Fi et les dispositifs mobiles de **d√©couvrir la disponibilit√© de chacun sur le r√©seau** et d'√©tablir des services de r√©seau pour les communications, le partage de donn√©es et de divertissement. L'architecture UPnP prend en charge le r√©seau de configuration z√©ro. Un dispositif compatible UPnP de n'importe quel fournisseur peut rejoindre dynamiquement un r√©seau, obtenir une adresse IP, **annoncer son nom, annoncer ou transmettre ses capacit√©s** sur demande et apprendre la pr√©sence et les capacit√©s d'autres dispositifs.

### **Flux**

La pile **UPnP** se compose de **six couches** : adressage, d√©couverte, description, contr√¥le, √©v√©nement et pr√©sentation.

Dans la couche d'adressage, les syst√®mes compatibles UPnP essaient d'obtenir une adresse IP via **DHCP**. Si cela n'est pas possible, ils **s'assignent une adresse** de la plage 169.254.0.0/16 (RFC 3927), un processus connu sous le nom d'AutoIP.

Ensuite, vient la couche de d√©couverte, dans laquelle le syst√®me recherche d'autres dispositifs sur le r√©seau en utilisant le **Simple Service Discovery Protocol** (SSDP). Les deux fa√ßons de d√©couvrir les dispositifs sont **activement** et **passivement**. Lors de l'utilisation de la m√©thode **active**, les dispositifs compatibles UPnP **envoient un message de d√©couverte** (appel√© une **requ√™te M-SEARCH**) √† l'adresse multicast **239.255.255.250 sur le port UDP 1900.** Nous appelons cette requ√™te HTTPU (HTTP sur UDP) car elle contient un en-t√™te similaire √† l'en-t√™te HTTP. La requ√™te M-SEARCH ressemble √† ceci :
```
  M-SEARCH * HTTP/1.1
  ST: ssdp:all
  MX: 5
  MAN: ssdp:discover
  HOST: 239.255.255.250:1900
```
Les syst√®mes UPnP qui √©coutent cette demande doivent r√©pondre avec un message unicast UDP qui annonce l'emplacement HTTP du fichier XML de description, qui r√©pertorie les services pris en charge par le p√©riph√©rique.

Lors de l'utilisation de la m√©thode **passive** pour d√©couvrir des p√©riph√©riques, les p√©riph√©riques compatibles UPnP annoncent p√©riodiquement leurs services sur le r√©seau en envoyant un message **NOTIFY √† l'adresse multicast** 239.255.255.250 sur le port UDP 1900. Ce message, qui suit, ressemble √† celui envoy√© en r√©ponse √† la d√©couverte active:
```
  NOTIFY * HTTP/1.1\r\n
  HOST: 239.255.255.250:1900\r\n
  CACHE-CONTROL: max-age=60\r\n
  LOCATION: http://192.168.10.254:5000/rootDesc.xml\r\n
  SERVER: OpenWRT/18.06-SNAPSHOT UPnP/1.1 MiniUPnPd/2.1\r\n
  NT: urn:schemas-upnp-org:service:WANIPConnection:2
```
La description de chaque profil UPnP est r√©f√©renc√©e soit dans la valeur du champ LOCATION du message de r√©ponse re√ßu lors de la d√©couverte active, soit dans le message NOTIFY re√ßu lors de la d√©couverte passive.

La couche de contr√¥le est probablement la plus importante; elle permet aux clients d'envoyer des commandes au dispositif UPnP en utilisant les URL du fichier de description. Ils peuvent le faire en utilisant le protocole SOAP (Simple Object Access Protocol), un protocole de messagerie qui utilise XML sur HTTP. Les dispositifs envoient des requ√™tes SOAP √† l'endpoint controlURL, d√©crit dans la balise \<service> √† l'int√©rieur du fichier de description. Une balise \<service> ressemble √† ceci:
```xml
 <service>
     <serviceType>urn:schemas-upnp-org:service:WANIPConnection:2</serviceType>
     <serviceId>urn:upnp-org:serviceId:WANIPConn1</serviceId>
     <SCPDURL>/WANIPCn.xml</SCPDURL>
     <controlURL>/ctl/IPConn</controlURL>
     <eventSubURL>/evt/IPConn</eventSubURL>
 </service>
```
### **IGD - Internet Gateway Device**

**IGD** cartographie les ports dans les configurations de traduction d'adresse r√©seau (NAT). IGD permet √† une application d'ajouter dynamiquement une cartographie de port temporaire sur le routeur pour une certaine p√©riode de temps (sans que l'utilisateur n'ait besoin d'effectuer une √©tape manuelle).

La plupart des appareils n'acceptent normalement pas les paquets SSDP via l'interface WAN, mais certains d'entre eux peuvent encore accepter des commandes IGD via des points de contr√¥le SOAP ouverts.

Dans la section Outil Umap, vous pouvez trouver un moyen d'exploiter ce vecteur.

## **Outils**

### **Miranda**

[**Miranda**](https://raw.githubusercontent.com/0x90/miranda-upnp/master/src/miranda.py) est un client UPnP python2 qui peut √™tre utile pour d√©couvrir les services UPnP, obtenir les d√©tails et envoyer des commandes √† ces services :
```
upnp> msearch

Entering discovery mode for 'upnp:rootdevice', Ctl+C to stop...


SSDP reply message from 192.168.1.254:49152
XML file is located at http://192.168.1.254:49152/wps_device.xml
Device is running Unspecified, UPnP/1.0, Unspecified



SSDP reply message from 192.168.1.254:53350
XML file is located at http://192.168.1.254:53350/37699b14/rootDesc.xml
Device is running Linux/3.4.11 UPnP/1.0 MiniUPnPd/1.9


upnp> host list
	[0] 192.168.1.254:49152
	[1] 192.168.1.254:53350

upnp> host get 0
upnp> host details 0

Host name:         192.168.1.254:49152
UPNP XML File:     http://192.168.1.254:49152/wps_device.xml


Device information:
	Device Name: WFADevice
		Service Name: WFAWLANConfig
			controlURL: wps_control
			eventSubURL: wps_event
			serviceId: urn:wifialliance-org:serviceId:WFAWLANConfig1
			SCPDURL: wps_scpd.xml
			fullName: urn:schemas-wifialliance-org:service:WFAWLANConfig:1
			ServiceActions:
				PutMessage
					NewInMessage 
						InMessage:
							dataType: bin.base64

[...]

upnp> host send 0 WFADevice WFAWLANConfig PutMessage
```
### Umap

L'outil [**umap**](https://github.com/0x90/upnp-arsenal/blob/master/umap-bypass.py) peut aider √† **d√©couvrir les commandes upnp** qui sont **disponibles** depuis les interfaces **WAN** m√™me si elles ne sont pas annonc√©es dans ces interfaces (cela est d√ª √† des impl√©mentations d√©fectueuses). Notez que si, par exemple, vous testez un routeur et que vous y avez acc√®s √† la fois depuis le r√©seau interne et l'interface WAN, vous devriez essayer d'**√©num√©rer tous les services depuis le r√©seau interne** (en utilisant **miranda** par exemple) et ensuite essayer d'**appeler ces services depuis le r√©seau externe**.

### **Autres outils UPnP**

Trouvez sur [**https://github.com/0x90/upnp-arsenal**](https://github.com/0x90/upnp-arsenal) plus d'outils upnp.

### **Evil SSDP**

L'outil Evil SSDP a √©t√© d√©velopp√© par [initstring](https://twitter.com/init\_string). Cet outil est h√©berg√© sur GitHub. Nous allons utiliser la commande git clone pour cloner tout le contenu du git sur notre machine attaquante. La commande git clone cr√©era un r√©pertoire portant le m√™me nom que sur GitHub. √âtant donn√© que l'outil est d√©velopp√© en Python version 3, nous devrons utiliser python3 suivi du nom du fichier .py pour ex√©cuter le programme. Ici, nous pouvons voir un √©cran d'aide de base de l'outil.
```bash
git clone https://github.com/initstring/evil-ssdp.git
cd evil-ssdp/ls
python3 evil-ssdp.py --help
```
![](https://i0.wp.com/1.bp.blogspot.com/-O6lddDvxqts/Xkq5PHqeE\_I/AAAAAAAAisQ/FKOCxVwT9cMy54lLy0SsYcKoM5Q95K5mQCLcBGAsYHQ/s1600/1.png?w=687\&ssl=1)

Dans le r√©pertoire clon√©, nous trouverons un r√©pertoire nomm√© templates. Il contient tous les mod√®les pr√©-compil√©s qui peuvent √™tre utilis√©s pour le phishing de l'utilisateur cible.

## **Spoofing Scanner SSDP**

Maintenant que nous avons ex√©cut√© l'outil sans aucun probl√®me, utilisons-le pour obtenir des informations d'identification. Dans cette premi√®re pratique, nous allons usurper un scanner en tant que p√©riph√©rique UPnP fiable. Pour commencer, nous devrons configurer le mod√®le.

### **Configuration du mod√®le**

Pour utiliser l'outil, nous devrons fournir l'interface r√©seau. Ici, sur notre machine attaquante, nous avons "eth0" comme interface, vous pouvez trouver votre interface en utilisant la commande "ifconfig".

Apr√®s avoir fourni l'interface, nous utiliserons le param√®tre "--template" pour passer un mod√®le que nous avons trouv√© pr√©c√©demment dans le r√©pertoire des mod√®les. Pour usurper un scanner, nous ex√©cuterons la commande suivante. Comme nous pouvons le voir, l'outil a fait son travail et a h√©berg√© plusieurs fichiers de mod√®le sur notre machine attaquante au port 8888. Nous avons √©galement le pointeur SMB h√©berg√©.
```bash
ls temlates/
python3 evil-ssdp.py eth0 --template scanner
```
![](https://i0.wp.com/1.bp.blogspot.com/-kg05jQ03Fnw/Xkq5Qing\_qI/AAAAAAAAisk/GYK8MuCKqKUalqh3DHGWVRoyDlAQaxUrwCLcBGAsYHQ/s1600/2.png?w=687\&ssl=1)

### **Manipulation de l'utilisateur**

La prochaine √©tape logique consiste √† manipuler l'utilisateur pour qu'il clique sur l'application. √âtant sur le m√™me r√©seau que la cible, notre faux scanner appara√Ætra sur son explorateur. C'est l√† que UPnP entre en jeu. L'outil Evil SSDP cr√©e ce scanner authentique sur le syst√®me de la cible sans aucune interaction forc√©e avec celle-ci.

![](https://i1.wp.com/1.bp.blogspot.com/-\_05xXp10Buk/Xkq5Qz4yosI/AAAAAAAAiso/HdHr0qJ59rkR2ur\_UYcrHMdf93uqMhXUwCLcBGAsYHQ/s1600/3.png?w=687\&ssl=1)

En cliquant sur l'ic√¥ne √† l'int√©rieur de l'Explorateur, nous serons redirig√©s vers le navigateur Web par d√©faut, ouvrant notre lien h√©berg√©. Les mod√®les que nous avons utilis√©s sont en jeu ici. L'utilisateur est maintenant conscient qu'il/elle est effectivement connect√© √† un scanner authentique ou √† un faux dispositif UPnP que nous avons g√©n√©r√©. La cible inconsciente n'ayant aucune id√©e entre les valides et les faux identifiants entre lesquels choisir, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations de connexion valides et les informations de connexion fausses, entre les informations
```bash
python3 evil-ssdp.py eth0 --template office365
```
![](https://i1.wp.com/1.bp.blogspot.com/-8GWxmKPDkIo/Xkq5RmgF8\_I/AAAAAAAAis0/bxVTcd4aBCUZBEDuUIg3-G39aMu7l5YCgCLcBGAsYHQ/s1600/6.png?w=687\&ssl=1)

Comme nous pouvons le voir, l'outil a fait son travail et a h√©berg√© plusieurs fichiers de mod√®le sur notre machine attaquante au port 8888.

### **Manipulation de l'utilisateur**

D√®s que nous ex√©cutons l'outil, nous avons un p√©riph√©rique UPnP nomm√© Office365 Backups. Cela a √©t√© fait par l'outil sans avoir √† envoyer de fichier, de charge utile ou tout autre type d'interaction √† l'utilisateur cible. Tout ce qui reste, c'est que l'utilisateur clique sur l'ic√¥ne.

![](https://i0.wp.com/1.bp.blogspot.com/-txqBOw02D6w/Xkq5RgolUcI/AAAAAAAAis4/wkQTzYBmtdU\_Nbq9X1qI47FlJtdqHvIjQCLcBGAsYHQ/s1600/7.png?w=687\&ssl=1)

Lorsque l'utilisateur cible clique sur l'ic√¥ne, il est redirig√© vers notre fausse page de mod√®le via son navigateur par d√©faut. Il s'agit d'une page Microsoft tr√®s authentique. L'utilisateur sans m√©fiance entre ses identifiants valides sur cette page.

![](https://i1.wp.com/1.bp.blogspot.com/-69Tf3PRpvhM/Xkq5RziDXzI/AAAAAAAAis8/vjejKgh0XigRHFC2Ib8QCpPlzx\_RAu4eACLcBGAsYHQ/s1600/8.png?w=687\&ssl=1)

### **R√©cup√©ration des identifiants**

D√®s que l'utilisateur entre les identifiants et qu'ils sont transmis en tant que demande de publication sur le serveur, qui est notre machine cible, nous voyons que sur notre terminal, nous avons les identifiants.

![](https://i0.wp.com/1.bp.blogspot.com/-3KXN6DKT\_E0/Xkq5SEwhKHI/AAAAAAAAitA/a2gTi5UwNE0JsMH-XQEW33MchkxgjPGSwCLcBGAsYHQ/s1600/9.png?w=687\&ssl=1)

## **D√©viation de l'utilisateur vers un SSDP de coffre-fort de mot de passe**

Jusqu'√† pr√©sent, nous avons r√©ussi √† usurper l'utilisateur cible pour obtenir des identifiants de scanner et des identifiants de sauvegarde Office365. Mais maintenant, nous allons pour la chose la plus importante qui est utilis√©e comme un UPnP, le coffre-fort de mot de passe.

### **Configuration du mod√®le**

Comme nous l'avons fait dans nos pratiques pr√©c√©dentes, nous devrons configurer le mod√®le pour le coffre-fort de mot de passe. En un rien de temps, l'outil h√©berge le mod√®le de coffre-fort de mot de passe sur le port 8888.
```bash
python3 evil-ssdp.py eth0 --template password-vault
```
### **Manipulation de l'utilisateur**

En passant √† la machine cible, nous voyons que le Password Vault UPnP est visible dans l'Explorateur. Maintenant, il suffit que l'utilisateur clique sur le p√©riph√©rique et tombe dans notre attaque. En voyant quelque chose comme Password Vault, l'utilisateur sera tent√© de cliquer sur l'ic√¥ne.

![](https://i2.wp.com/1.bp.blogspot.com/-3oMPYaCZ46k/Xkq5PB4zQ\_I/AAAAAAAAisM/i5C8qZVB8RYWBwAkiKCZbdptIbsnk4CUwCLcBGAsYHQ/s1600/11.png?w=687\&ssl=1)

Comme l'utilisateur sans m√©fiance pense qu'il/elle a accompli des choses tr√®s importantes avec les fausses cl√©s et les mots de passe. Cela fonctionne comme une distraction pour l'utilisateur, car cela le conduira √† essayer cette liste exhaustive de justificatifs sans succ√®s.

![](https://i0.wp.com/1.bp.blogspot.com/-SrCMlWIUxCM/Xkq5Pg\_IznI/AAAAAAAAisU/L\_ZIvQKfltkyk9iUCrEGyXCojx5b86uFgCLcBGAsYHQ/s1600/12.png?w=687\&ssl=1)

## **Falsification de SSDP Microsoft Azure**

Lorsque l'on travaille avec la falsification, l'une des t√¢ches les plus importantes est de ne pas laisser l'utilisateur cible savoir qu'il/elle a √©t√© victime de la falsification. Cela peut √™tre r√©alis√© en redirigeant l'utilisateur apr√®s que l'attaquant ait r√©cup√©r√© les justificatifs ou les cookies ou tout ce que l'attaquant voulait acqu√©rir. L'outil evil\_ssdp dispose d'un param√®tre (-u) qui redirige l'utilisateur cibl√© vers n'importe quelle URL choisie par l'attaquant. Examinons le fonctionnement de ce param√®tre en action.

Pour commencer, nous utiliserons python3 pour charger l'outil. Ensuite, nous mentionnons l'interface r√©seau qui doit √™tre utilis√©e. Maintenant, pour cette pratique, nous utiliserons le mod√®le de stockage Microsoft Azure. Apr√®s avoir s√©lectionn√© le mod√®le, nous mettons le param√®tre (-u) et mentionnons ensuite n'importe quelle URL o√π nous voulons rediriger l'utilisateur. Ici, nous utilisons le lien officiel de Microsoft. Mais cela peut √™tre n'importe quel site malveillant.
```bash
python3 evil-ssdp.py eth0 --template microsoft-azure -u https://malicous-site.com
```
### **Manipulation de l'utilisateur**

Maintenant que nous avons lanc√© l'outil, il cr√©era un p√©riph√©rique UPnP sur la machine cible comme indiqu√© dans l'image ci-dessous. Pour que l'attaque r√©ussisse, la cible doit cliquer sur le p√©riph√©rique.

![](https://i1.wp.com/1.bp.blogspot.com/-rROTfEGP3z8/Xkq5QBn46dI/AAAAAAAAisc/7RDv7fI3BPYt1XmrKVRKOEHurkGY1xeogCLcBGAsYHQ/s1600/14.png?w=687\&ssl=1)

Apr√®s avoir cliqu√© sur l'ic√¥ne, nous voyons que l'utilisateur est redirig√© vers la page officielle de Microsoft. Cela peut √™tre ce que l'attaquant veut.

![](https://i2.wp.com/1.bp.blogspot.com/-gU36s2kyIbg/Xkq5QVRh61I/AAAAAAAAisg/hN3uVMTPh-suDiH5ID3-mWcQiNvDVYeJACLcBGAsYHQ/s1600/15.png?w=687\&ssl=1)

Ceci conclut notre pratique de cet outil de spoofing impressionnant.

## **Att√©nuation**

* D√©sactiver les p√©riph√©riques UPnP.
* √âduquer les utilisateurs pour pr√©venir les attaques de phishing.
* Surveiller le r√©seau pour le voyage de mot de passe en clair.

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Travaillez-vous dans une **entreprise de cybers√©curit√©** ? Voulez-vous voir votre **entreprise annonc√©e dans HackTricks** ? ou voulez-vous avoir acc√®s √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**üí¨**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR au [repo hacktricks](https://github.com/carlospolop/hacktricks) et au [repo hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>
