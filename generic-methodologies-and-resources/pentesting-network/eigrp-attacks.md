# Attaques EIGRP

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Travaillez-vous dans une **entreprise de cybers√©curit√©** ? Voulez-vous voir votre **entreprise annonc√©e dans HackTricks** ? ou voulez-vous avoir acc√®s √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**üí¨**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR au** [**repo hacktricks**](https://github.com/carlospolop/hacktricks) **et au** [**repo hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

**Cette page a √©t√© copi√©e depuis** [**https://medium.com/@in9uz/cisco-nightmare-pentesting-cisco-networks-like-a-devil-f4032eb437b9**](https://medium.com/@in9uz/cisco-nightmare-pentesting-cisco-networks-like-a-devil-f4032eb437b9)

## Attaquer le protocole EIGRP <a href="#0f82" id="0f82"></a>

**EIGRP (Enhanced Interior Gateway Routing Protocol)** est un protocole de routage dynamique. **C'est un protocole de vecteur de distance.** **S'il n'y a pas d'authentification et de configuration des interfaces passives, un intrus peut interf√©rer avec le routage EIGRP et causer une empoisonnement des tables de routage.** **De plus, le r√©seau EIGRP (en d'autres termes, le syst√®me autonome) est plat et n'a pas de segmentation en zones.** Que cela pourrait-il signifier pour un attaquant ? Eh bien, s'il injecte une route, il est probable que cette route se propage dans tout le syst√®me autonome EIGRP.

<figure><img src="../../.gitbook/assets/image (25) (1).png" alt=""><figcaption></figcaption></figure>

Tout d'abord, attaquer un syst√®me EIGRP autonome n√©cessite d'√©tablir une relation de voisinage avec un routeur EIGRP l√©gitime, ce qui ouvre de nombreuses possibilit√©s, de la reconnaissance de base √† diverses injections.

Pour cela, j'utiliserai [**FRRouting**](https://frrouting.org/). Il s'agit d'un logiciel open source con√ßu pour cr√©er un routeur dans Unix et Linux. **FRRouting** vous permet de mettre en place **un routeur virtuel qui prend en charge BGP, OSPF, EIGRP, RIP et d'autres protocoles.** Tout ce que vous avez √† faire est de le d√©ployer sur votre syst√®me d'attaquant et vous pouvez en fait pr√©tendre √™tre un routeur l√©gitime dans le domaine de routage. Je vais vous montrer comment d√©ployer FRR sur votre syst√®me dans la section suivante.

### Intelligence r√©seau <a href="#41e6" id="41e6"></a>

**Se connecter au domaine de routage nous permet de faire l'√©num√©ration et la reconnaissance des r√©seaux et de ne pas passer beaucoup de temps √† scanner.** Cette m√©thode vous fait gagner beaucoup de temps pr√©cieux. **De plus, en scannant, vous pouvez vous faire rep√©rer devant les syst√®mes de s√©curit√© IPS/IDS.** Pour moi, la connexion au domaine et l'√©num√©ration sont le vecteur d'attaque sur les domaines de routage qui vous donne le plus d'impact. Mais pour cela, vous devez d√©ployer **FRRouting**. C'est parti.

**Il est n√©cessaire de modifier le fichier de configuration daemons.** Il contient les configurations des d√©mons dans le contexte de leur activit√©. Soit ils sont activ√©s (yes) soit non (no). Nous devons activer le d√©mon **eigrpd**.
```
~# nano /etc/frr/daemons
eigrpd=yes
```
<figure><img src="../../.gitbook/assets/image (15) (1).png" alt=""><figcaption></figcaption></figure>

Ensuite, vous devez corriger le fichier **vtysh.conf** en ajoutant une ligne responsable de la sauvegarde de la configuration dans un fichier, afin que les configurations de diff√©rents protocoles ne soient pas dispers√©es dans diff√©rents fichiers **(par exemple, eigrpd.conf, staticd.conf).** Cela est configurable en option.
```
~# nano /etc/frr/vtysh.conf
service integrated-vtysh-config
```
La configuration de FRRouting est termin√©e. Maintenant, il est temps d'ex√©cuter le d√©mon FRR. Et oui, nous devons activer le routage du trafic. Par d√©faut, il est d√©sactiv√© dans les distributions Linux.
```
~$ sudo systemctl start frr
~$ sudo sysctl -w net.ipv4.ip_forward=1
```
<figure><img src="../../.gitbook/assets/image (32).png" alt=""><figcaption></figcaption></figure>

La commande **vtysh** nous am√®nera au panneau de contr√¥le du routeur FRR.
```
~$ sudo vtysh
```
### English Input:

```
## EIGRP Attacks

EIGRP (Enhanced Interior Gateway Routing Protocol) is a Cisco proprietary routing protocol that is used to share routing information between routers. EIGRP is a distance vector protocol that uses bandwidth and delay as its metrics. EIGRP is a reliable protocol that is easy to configure and troubleshoot. However, EIGRP is vulnerable to various attacks that can compromise the confidentiality, integrity, and availability of the network.

### EIGRP Authentication Attacks

EIGRP supports authentication to prevent unauthorized access to the routing information. EIGRP authentication can be configured using a key chain or a static key. However, EIGRP authentication is vulnerable to various attacks that can bypass or crack the authentication mechanism.

#### EIGRP Key Chain Attacks

An EIGRP key chain is a sequence of keys that are used to authenticate EIGRP packets. Each key in the key chain has a key ID, a key string, and a cryptographic algorithm. The key ID is a number that identifies the key in the key chain. The key string is a password that is used to generate the message digest. The cryptographic algorithm is used to generate the message digest.

An EIGRP key chain can be attacked in various ways, such as:

- **Key ID Spoofing**: An attacker can spoof the key ID in an EIGRP packet to bypass the authentication mechanism. The attacker can send an EIGRP packet with a valid key ID that belongs to another router in the network. This can trick the receiving router into accepting the packet as authentic.

- **Key String Cracking**: An attacker can crack the key string in an EIGRP packet to generate a valid message digest. The attacker can use various tools and techniques to crack the key string, such as brute-force, dictionary attack, rainbow table attack, etc.

#### EIGRP Static Key Attacks

An EIGRP static key is a password that is used to authenticate EIGRP packets. The static key is configured on each router that participates in the EIGRP process. The static key is vulnerable to various attacks that can bypass or crack the authentication mechanism.

An EIGRP static key can be attacked in various ways, such as:

- **Password Guessing**: An attacker can guess the static key by using various tools and techniques, such as brute-force, dictionary attack, etc.

- **Packet Sniffing**: An attacker can sniff the EIGRP packets that contain the static key and use it to generate a valid message digest.

### EIGRP DoS Attacks

EIGRP is vulnerable to various DoS (Denial of Service) attacks that can disrupt the normal operation of the network. EIGRP DoS attacks can be launched using various tools and techniques, such as:

- **EIGRP Hello Flood**: An attacker can flood the network with EIGRP Hello packets to consume the bandwidth and resources of the network. This can cause the network to become slow or unresponsive.

- **EIGRP Route Poisoning**: An attacker can send false routing information to the network to mislead the routers and cause routing loops. This can cause the network to become unstable or unreachable.

- **EIGRP Authentication Failure**: An attacker can send invalid EIGRP packets to the network to trigger authentication failures. This can cause the routers to reset their EIGRP process and disrupt the normal operation of the network.
```

### French Output:

```
## Attaques EIGRP

EIGRP (Enhanced Interior Gateway Routing Protocol) est un protocole de routage propri√©taire de Cisco qui est utilis√© pour partager des informations de routage entre les routeurs. EIGRP est un protocole de vecteur de distance qui utilise la bande passante et le d√©lai comme m√©triques. EIGRP est un protocole fiable qui est facile √† configurer et √† d√©panner. Cependant, EIGRP est vuln√©rable √† diverses attaques qui peuvent compromettre la confidentialit√©, l'int√©grit√© et la disponibilit√© du r√©seau.

### Attaques d'authentification EIGRP

EIGRP prend en charge l'authentification pour emp√™cher l'acc√®s non autoris√© aux informations de routage. L'authentification EIGRP peut √™tre configur√©e √† l'aide d'une cha√Æne de cl√©s ou d'une cl√© statique. Cependant, l'authentification EIGRP est vuln√©rable √† diverses attaques qui peuvent contourner ou craquer le m√©canisme d'authentification.

#### Attaques de cha√Æne de cl√©s EIGRP

Une cha√Æne de cl√©s EIGRP est une s√©quence de cl√©s qui sont utilis√©es pour authentifier les paquets EIGRP. Chaque cl√© de la cha√Æne de cl√©s a un identifiant de cl√©, une cha√Æne de cl√© et un algorithme cryptographique. L'identifiant de cl√© est un num√©ro qui identifie la cl√© dans la cha√Æne de cl√©s. La cha√Æne de cl√© est un mot de passe qui est utilis√© pour g√©n√©rer la somme de contr√¥le du message. L'algorithme cryptographique est utilis√© pour g√©n√©rer la somme de contr√¥le du message.

Une cha√Æne de cl√©s EIGRP peut √™tre attaqu√©e de diverses mani√®res, telles que:

- **Spoofing d'identifiant de cl√©**: Un attaquant peut usurper l'identifiant de cl√© dans un paquet EIGRP pour contourner le m√©canisme d'authentification. L'attaquant peut envoyer un paquet EIGRP avec un identifiant de cl√© valide qui appartient √† un autre routeur du r√©seau. Cela peut tromper le routeur r√©cepteur en acceptant le paquet comme authentique.

- **Craquage de cha√Æne de cl√©**: Un attaquant peut craquer la cha√Æne de cl√© dans un paquet EIGRP pour g√©n√©rer une somme de contr√¥le valide. L'attaquant peut utiliser divers outils et techniques pour craquer la cha√Æne de cl√©, telles que la force brute, l'attaque par dictionnaire, l'attaque par table arc-en-ciel, etc.

#### Attaques de cl√© statique EIGRP

Une cl√© statique EIGRP est un mot de passe qui est utilis√© pour authentifier les paquets EIGRP. La cl√© statique est configur√©e sur chaque routeur qui participe au processus EIGRP. La cl√© statique est vuln√©rable √† diverses attaques qui peuvent contourner ou craquer le m√©canisme d'authentification.

Une cl√© statique EIGRP peut √™tre attaqu√©e de diverses mani√®res, telles que:

- **Deviner le mot de passe**: Un attaquant peut deviner la cl√© statique en utilisant divers outils et techniques, telles que la force brute, l'attaque par dictionnaire, etc.

- **Sniffing de paquets**: Un attaquant peut renifler les paquets EIGRP qui contiennent la cl√© statique et l'utiliser pour g√©n√©rer une somme de contr√¥le valide.

### Attaques DoS EIGRP

EIGRP est vuln√©rable √† diverses attaques DoS (D√©ni de Service) qui peuvent perturber le fonctionnement normal du r√©seau. Les attaques DoS EIGRP peuvent √™tre lanc√©es √† l'aide de divers outils et techniques, telles que:

- **Inondation de Hello EIGRP**: Un attaquant peut inonder le r√©seau avec des paquets Hello EIGRP pour consommer la bande passante et les ressources du r√©seau. Cela peut rendre le r√©seau lent ou non r√©actif.

- **Empoisonnement de route EIGRP**: Un attaquant peut envoyer de fausses informations de routage au r√©seau pour tromper les routeurs et provoquer des boucles de routage. Cela peut rendre le r√©seau instable ou inaccessible.

- **√âchec d'authentification EIGRP**: Un attaquant peut envoyer des paquets EIGRP invalides au r√©seau pour d√©clencher des √©checs d'authentification. Cela peut amener les routeurs √† r√©initialiser leur processus EIGRP et perturber le fonctionnement normal du r√©seau.
```
```
Inguz# show version
```
<figure><img src="../../.gitbook/assets/image (3) (2) (2).png" alt=""><figcaption></figcaption></figure>

> **Cependant, n'oubliez pas que le domaine de routage EIGRP peut √™tre prot√©g√© par une authentification. Mais vous avez toujours une chance de vous connecter au domaine de routage. Lorsque les paquets hello sont envoy√©s, ils contiennent √©galement des hachages cryptographiques. Si vous pouvez extraire ces hachages de l'extraction de trafic et r√©initialiser le mot de passe, vous pouvez vous connecter au domaine de routage avec ce mot de passe.**

Acc√©dez au mode de configuration globale et d√©marrez le processus **EIGRP**, sp√©cifiez le num√©ro du syst√®me autonome - **1**

Et nous devons √©galement d√©clarer le r√©seau dans lequel nous sommes. Nous sommes dans le r√©seau 10.10.100.0/24. Mon adresse est 10.10.100.50/32
```
Inguz# configInguz(config)# router eigrp 1Inguz(config-router) network 10.10.100.50/32
```
Ensuite, le voisinage entre les routeurs EIGRP l√©gitimes est √©tabli. Il y en a deux sur mon r√©seau :

* **GW1 (10.10.100.100)**
* **GW2 (10.10.100.200)**

Voisinage EIGRP avec GW1 (10.10.100.100) :

<figure><img src="../../.gitbook/assets/image (5) (1) (2).png" alt=""><figcaption></figcaption></figure>

Voisinage EIGRP avec GW2 (10.10.100.200) :

<figure><img src="../../.gitbook/assets/image (30) (1).png" alt=""><figcaption></figcaption></figure>

Pendant l'√©tablissement et la maintenance du voisinage entre les routeurs EIGRP, les routeurs √©changent leurs informations de routage. Apr√®s l'√©tablissement du voisinage, de nouvelles routes appara√Ætront dans notre table de routage du syst√®me attaquant, √† savoir :

* **10.1.239.0/24 via 10.10.100.100 ;**
* **30.30.30.0/24 via 10.10.100.100 ;**
* **100.100.100.0/24 via 10.10.100.100 ;**
* **172.16.100.0/24 via 10.10.100.200**

<figure><img src="../../.gitbook/assets/image (29) (1) (2).png" alt=""><figcaption></figcaption></figure>

Ainsi, apr√®s l'√©tablissement du voisinage, nous connaissons l'existence de ces sous-r√©seaux, ce qui facilite notre pentest et nous fait gagner du temps. Nous pouvons nous passer de la num√©risation de sous-r√©seau suppl√©mentaire. Maintenant, nous sommes dans le domaine de routage EIGRP et nous pouvons d√©velopper quelques vecteurs d'attaque. Parlons-en.

### Faux voisins EIGRP <a href="#51ee" id="51ee"></a>

**J'ai d√©couvert que la g√©n√©ration et l'envoi rapide de paquets EIGRP hello en masse surchargent le CPU du routeur, ce qui peut ouvrir la porte √† une attaque DoS.** J'ai d√©velopp√© un petit script [**helloflooding.py**](https://github.com/in9uz/EIGRPWN/blob/main/helloflooding.py), mais il me semble que le script manque de vitesse d'envoi des paquets. **Cela est d√ª √† GIL**, qui emp√™che la fonction **sprayhello** de s'ex√©cuter en plusieurs threads par seconde. **Finalement, je r√©√©crirai le script en C.**

<figure><img src="../../.gitbook/assets/image (2) (6) (1).png" alt=""><figcaption></figcaption></figure>

Arguments du script :

* **Interface du syst√®me attaquant (eth0) ;**
* **Num√©ro de syst√®me autonome EIGRP (1) ;**
* **Sous-r√©seau o√π se trouve le syst√®me attaquant. Dans mon cas, le sous-r√©seau est 10.10.100.0/24**
```
~$ sudo python3 helloflooding.py --interface eth0 --as 1 --subnet 10.10.100.0/24
```
<figure><img src="../../.gitbook/assets/image (26) (1).png" alt=""><figcaption></figcaption></figure>

### Blackhole EIGRP <a href="#5c04" id="5c04"></a>

L'essence de cette attaque est une simple injection d'une fausse route qui empoisonnera la table de routage. Le trafic vers, disons, le r√©seau `10.10.100.0/24` ne m√®nera nulle part, causant un d√©ni de service. Une telle attaque est appel√©e un Blackhole. Le script [**routeinject.py**](https://github.com/in9uz/EIGRPWN/blob/main/routeinject.py) sera l'outil utilis√© pour la r√©aliser. Pour cet exemple, je vais envoyer du trafic destin√© √† l'h√¥te `172.16.100.140/32` vers le trou noir.

<figure><img src="../../.gitbook/assets/image (16) (1).png" alt=""><figcaption></figcaption></figure>

Arguments du script:

* **interface du syst√®me attaquant**
* **num√©ro AS EIGRP**
* **adresse IP de l'attaquant**
* **adresse IP du sous-r√©seau cible dont le trafic sera envoy√© vers le trou noir**
* **masque de sous-r√©seau cible**
```
~$ sudo python3 routeinject.py --interface eth0 --as 1 --src 10.10.100.50 --dst 172.16.100.140 --prefix 32
```
<figure><img src="../../.gitbook/assets/image (20) (1).png" alt=""><figcaption></figcaption></figure>

**Notre h√¥te semble avoir des probl√®mes :)**

<figure><img src="../../.gitbook/assets/image (6) (1) (1).png" alt=""><figcaption></figcaption></figure>

Comme vous pouvez le voir, l'h√¥te perd la connectivit√© avec l'h√¥te **172.16.100.140/32** en raison de l'injection de route.

### Abus des valeurs K <a href="#25aa" id="25aa"></a>

Pour √©tablir des voisins EIGRP, **les routeurs utilisent des valeurs K sp√©ciales.** Ils doivent √™tre identiques parmi tous les voisins EIGRP. Si au moins une valeur K ne correspond pas, le domaine EIGRP se bloquera et le voisinage sera rompu. Nous utiliserons [**relationshipnightmare.py**](https://github.com/in9uz/EIGRPWN/blob/main/relationshipnightmare.py) \*\*\*\* pour effectuer cette attaque\*\*.\*\*

<figure><img src="../../.gitbook/assets/image (12) (2).png" alt=""><figcaption></figcaption></figure>

Arguments du script :

* **interface r√©seau**
* **num√©ro AS EIGRP**
* **adresse IP du routeur l√©gitime**

**Au nom de l'adresse IP sp√©cifi√©e, une injection sera envoy√©e sur l'adresse IP EIGRP multicast, dans laquelle les valeurs K sont diff√©rentes.** Dans mon cas, je vais rompre le voisinage au nom du routeur GW1 **(l'adresse est 10.10.100.100)**.
```
~$ sudo python3 relationshipnightmare.py --interface eth0 --as 1 --src 10.10.100.100
```
<figure><img src="../../.gitbook/assets/image (9) (1) (4).png" alt=""><figcaption><p>Extrait du trafic lors d'une perturbation de voisinage</p></figcaption></figure>

<figure><img src="../../.gitbook/assets/image (27) (1).png" alt=""><figcaption><p>Le routeur GW1 se d√©connecte et se reconnecte sans cesse √† EIGRP</p></figcaption></figure>

**Une attaque DoS peut √™tre effectu√©e de cette mani√®re. Pendant l'op√©ration, des interruptions et des tentatives de voisinage sans fin se produisent, paralysant une partie du domaine de routage EIGRP.**

### D√©bordement de table de routage <a href="#1d0c" id="1d0c"></a>

L'essence de cette attaque est de provoquer l'envoi d'un grand nombre de fausses routes, qui vont d√©border la table de routage. Cela √©puise les ressources informatiques du routeur, √† savoir le CPU et la RAM, car les injections se produisent √† une vitesse √©norme. Cette attaque est mise en ≈ìuvre par le script [**routingtableoverflow.py**](https://github.com/in9uz/EIGRPWN/blob/main/routingtableoverflow.py).

<figure><img src="../../.gitbook/assets/image (3) (4).png" alt=""><figcaption></figcaption></figure>

Arguments du script

* **interface r√©seau**
* **Num√©ro AS EIGRP**
* **Adresse IP de l'attaquant**
```
in9uz@Inguz:~$ sudo python3 routingtableoverflow.py --interface eth0 --as 1 --src 10.10.100.50
```
Apr√®s l'ex√©cution du script, la table de routage commence √† d√©border de routes. Les adresses al√©atoires des r√©seaux cibles sont dues √† l'utilisation de **RandIP()** dans [**Scapy**](https://github.com/secdev/scapy).

<figure><img src="../../.gitbook/assets/image (4) (4).png" alt=""><figcaption><p>La table de routage d√©borde sur le routeur GW1</p></figcaption></figure>

<figure><img src="../../.gitbook/assets/image (21) (1).png" alt=""><figcaption><p>Processeur de routeur surcharg√©</p></figcaption></figure>

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Travaillez-vous dans une **entreprise de cybers√©curit√©** ? Voulez-vous voir votre **entreprise annonc√©e dans HackTricks** ? ou voulez-vous avoir acc√®s √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**üí¨**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR au** [**repo hacktricks**](https://github.com/carlospolop/hacktricks) **et au** [**repo hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
