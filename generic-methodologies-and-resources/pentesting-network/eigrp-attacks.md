# Ataques EIGRP

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Voc√™ trabalha em uma **empresa de ciberseguran√ßa**? Voc√™ quer ver sua **empresa anunciada no HackTricks**? ou voc√™ quer ter acesso √† **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**? Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* **Junte-se ao** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para o** [**reposit√≥rio hacktricks**](https://github.com/carlospolop/hacktricks) **e para o** [**reposit√≥rio hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

**Esta p√°gina foi copiada de** [**https://medium.com/@in9uz/cisco-nightmare-pentesting-cisco-networks-like-a-devil-f4032eb437b9**](https://medium.com/@in9uz/cisco-nightmare-pentesting-cisco-networks-like-a-devil-f4032eb437b9)

## Atacando o Protocolo EIGRP <a href="#0f82" id="0f82"></a>

**EIGRP (Enhanced Interior Gateway Routing Protocol)** √© um protocolo de roteamento din√¢mico. **√â um protocolo de vetor de dist√¢ncia.** **Se n√£o houver autentica√ß√£o e configura√ß√£o de interfaces passivas, um invasor pode interferir no roteamento EIGRP e causar envenenamento das tabelas de roteamento.** **Al√©m disso, a rede EIGRP (em outras palavras, sistema aut√¥nomo) √© plana e n√£o tem segmenta√ß√£o em zonas.** O que isso poderia significar para um invasor? Bem, se ele injetar uma rota, √© prov√°vel que essa rota se espalhe por todo o sistema aut√¥nomo EIGRP.

<figure><img src="../../.gitbook/assets/image (25) (1).png" alt=""><figcaption></figcaption></figure>

Em primeiro lugar, atacar um sistema EIGRP aut√¥nomo requer o estabelecimento de uma vizinhan√ßa com um roteador EIGRP leg√≠timo, o que abre muitas possibilidades, desde reconhecimento b√°sico at√© v√°rias inje√ß√µes.

Para isso, usarei o [**FRRouting**](https://frrouting.org/). Este √© um software de c√≥digo aberto projetado para criar um roteador no Unix e Linux. **FRRouting** permite que voc√™ implemente **um roteador virtual que suporta BGP, OSPF, EIGRP, RIP e outros protocolos.** Tudo o que voc√™ precisa fazer √© implant√°-lo em seu sistema de atacante e voc√™ pode realmente fingir ser um roteador leg√≠timo no dom√≠nio de roteamento. Vou mostrar como implantar o FRR em seu sistema na pr√≥xima se√ß√£o.

### Intelig√™ncia de Rede <a href="#41e6" id="41e6"></a>

**Conectar-se ao dom√≠nio de roteamento permite fazer enumera√ß√£o e reconhecimento de redes e n√£o gastar muito tempo escaneando.** Este m√©todo economiza muito tempo precioso. **Al√©m disso, ao escanear, voc√™ pode ser detectado pelos sistemas de seguran√ßa IPS/IDS.** Para mim, conectar-se ao dom√≠nio e enumera√ß√£o √© o vetor de ataque em dom√≠nios de roteamento que lhe d√° o maior impacto. Mas para fazer isso, voc√™ precisa implantar o **FRRouting**. Aqui vamos n√≥s.

**√â necess√°rio editar o arquivo de configura√ß√£o daemons.** Ele cont√©m as configura√ß√µes dos daemons no contexto de sua atividade. Ou eles est√£o habilitados (yes) ou n√£o (no). Precisamos ativar o daemon **eigrpd**.
```
~# nano /etc/frr/daemons
eigrpd=yes
```
<figure><img src="../../.gitbook/assets/image (15) (1).png" alt=""><figcaption></figcaption></figure>

Depois disso, voc√™ precisa corrigir o arquivo **vtysh.conf** adicionando uma linha respons√°vel por salvar a configura√ß√£o em um √∫nico arquivo, para que as configura√ß√µes de diferentes protocolos n√£o sejam espalhadas em arquivos diferentes **(por exemplo, eigrpd.conf, staticd.conf).** Isso √© configur√°vel opcionalmente.
```
~# nano /etc/frr/vtysh.conf
service integrated-vtysh-config
```
A configura√ß√£o do FRRouting est√° conclu√≠da. Agora √© hora de executar o daemon FRR. E sim, precisamos habilitar o roteamento de tr√°fego. Por padr√£o, ele √© desativado nas distribui√ß√µes Linux.
```
~$ sudo systemctl start frr
~$ sudo sysctl -w net.ipv4.ip_forward=1
```
O comando **vtysh** nos levar√° ao painel de controle do roteador FRR.
```
~$ sudo vtysh
```
### EIGRP Attacks

#### Introduction

EIGRP (Enhanced Interior Gateway Routing Protocol) is a Cisco proprietary routing protocol that is widely used in enterprise networks. It is an advanced distance-vector routing protocol that uses bandwidth and delay as metrics for path selection. EIGRP is a classless routing protocol that supports VLSM (Variable Length Subnet Masking) and CIDR (Classless Inter-Domain Routing).

#### EIGRP Protocol Overview

EIGRP uses a Diffusing Update Algorithm (DUAL) to calculate the shortest path to a destination network. EIGRP routers exchange routing information with their neighbors using multicast packets. EIGRP routers maintain a topology table that contains information about all the networks in the topology, including the metric, the next hop, and the outgoing interface.

#### EIGRP Attacks

EIGRP is vulnerable to several attacks that can be used to disrupt network operations or to gain unauthorized access to network resources. The following are some of the most common EIGRP attacks:

- **EIGRP Neighbor Spoofing**: An attacker can spoof EIGRP packets to make a router believe that it has a neighbor that does not exist. This can be used to inject false routing information into the network or to cause a denial of service (DoS) attack.

- **EIGRP Route Injection**: An attacker can inject false routing information into the network by sending EIGRP packets with a lower metric than the legitimate routes. This can be used to redirect traffic to a malicious destination or to cause a DoS attack.

- **EIGRP Route Poisoning**: An attacker can send EIGRP packets with an infinite metric to poison the routing tables of EIGRP routers. This can be used to cause a DoS attack or to redirect traffic to a malicious destination.

- **EIGRP Authentication Bypass**: EIGRP supports authentication to prevent unauthorized access to routing information. However, if authentication is not properly configured, an attacker can bypass it and gain access to sensitive information.

#### Conclusion

EIGRP is a widely used routing protocol that is vulnerable to several attacks. It is important to properly configure EIGRP and to implement security measures to prevent unauthorized access to routing information.
```
Inguz# show version
```
<figure><img src="../../.gitbook/assets/image (3) (2) (2).png" alt=""><figcaption></figcaption></figure>

> **No entanto, n√£o se esque√ßa de que o dom√≠nio de roteamento EIGRP pode ser protegido por autentica√ß√£o. Mas ainda h√° uma chance de se conectar ao dom√≠nio de roteamento. Quando os pacotes hello s√£o enviados, eles tamb√©m cont√™m hashes criptogr√°ficos. Se voc√™ puder extrair esses hashes do dump de tr√°fego e redefinir a senha, poder√° fazer login no dom√≠nio de roteamento com essa senha.**

V√° para o modo de configura√ß√£o global e inicie o processo **EIGRP**, especifique o n√∫mero do sistema aut√¥nomo - **1**

E tamb√©m precisamos declarar a rede em que estamos. Estamos em 10.10.100.0/24. Meu endere√ßo √© 10.10.100.50/32
```
Inguz# configInguz(config)# router eigrp 1Inguz(config-router) network 10.10.100.50/32
```
Depois disso, o bairro entre os roteadores EIGRP leg√≠timos √© estabelecido. H√° dois deles na minha rede:

* **GW1 (10.10.100.100)**
* **GW2 (10.10.100.200)**

Vizinhan√ßa EIGRP com GW1 (10.10.100.100):

<figure><img src="../../.gitbook/assets/image (5) (1) (2).png" alt=""><figcaption></figcaption></figure>

Vizinhan√ßa EIGRP com GW2 (10.10.100.200):

<figure><img src="../../.gitbook/assets/image (30) (1).png" alt=""><figcaption></figcaption></figure>

Durante o estabelecimento e manuten√ß√£o da vizinhan√ßa entre os roteadores EIGRP, os roteadores trocam suas informa√ß√µes de roteamento. Ap√≥s o estabelecimento da vizinhan√ßa, novas rotas aparecer√£o na tabela de roteamento do sistema atacante, a saber:

* **10.1.239.0/24 via 10.10.100.100;**
* **30.30.30.0/24 via 10.10.100.100;**
* **100.100.100.0/24 via 10.10.100.100;**
* **172.16.100.0/24 via 10.10.100.200**

<figure><img src="../../.gitbook/assets/image (29) (1) (2).png" alt=""><figcaption></figcaption></figure>

Assim, ap√≥s o estabelecimento da vizinhan√ßa, sabemos sobre a exist√™ncia dessas sub-redes, o que facilita o pentest e economiza tempo. Podemos fazer sem varreduras adicionais de sub-redes. Agora estamos no dom√≠nio de roteamento EIGRP e podemos desenvolver alguns vetores de ataque. Vamos falar sobre eles.

### Vizinhos EIGRP Falsos <a href="#51ee" id="51ee"></a>

**Descobri que gerar e enviar rapidamente pacotes EIGRP hello em massa sobrecarrega a CPU do roteador, o que, por sua vez, pode abrir a porta para um ataque DoS.** Eu desenvolvi um pequeno script [**helloflooding.py**](https://github.com/in9uz/EIGRPWN/blob/main/helloflooding.py), mas parece-me que o script carece de velocidade no envio dos pacotes. **Isso √© causado pelo GIL**, que impede que a fun√ß√£o **sprayhello** seja executada em v√°rias threads por segundo. **Eventualmente, reescreverei o script em C.**

<figure><img src="../../.gitbook/assets/image (2) (6) (1).png" alt=""><figcaption></figcaption></figure>

Argumentos do script:

* **Interface do sistema atacante (eth0);**
* **N√∫mero aut√¥nomo do sistema EIGRP (1);**
* **Sub-rede onde o sistema atacante est√° localizado. No meu caso, a sub-rede √© 10.10.100.0/24**
```
~$ sudo python3 helloflooding.py --interface eth0 --as 1 --subnet 10.10.100.0/24
```
<figure><img src="../../.gitbook/assets/image (26) (1).png" alt=""><figcaption></figcaption></figure>

### Buraco Negro EIGRP <a href="#5c04" id="5c04"></a>

A ess√™ncia desse ataque √© uma simples inje√ß√£o de uma rota falsa que ir√° envenenar a tabela de roteamento. O tr√°fego para, digamos, a rede `10.10.100.0/24` n√£o ir√° a lugar algum, causando uma nega√ß√£o de servi√ßo. Esse tipo de ataque √© chamado de Buraco Negro. O script [**routeinject.py**](https://github.com/in9uz/EIGRPWN/blob/main/routeinject.py) ser√° a ferramenta usada para execut√°-lo. Para este exemplo, enviarei tr√°fego destinado ao host `172.16.100.140/32` para o buraco negro.

<figure><img src="../../.gitbook/assets/image (16) (1).png" alt=""><figcaption></figcaption></figure>

Argumentos do script:

* **interface do sistema atacante**
* **n√∫mero AS do EIGRP**
* **endere√ßo IP do atacante**
* **endere√ßo IP da sub-rede de destino cujo tr√°fego ser√° enviado para o buraco negro**
* **m√°scara de sub-rede de destino**
```
~$ sudo python3 routeinject.py --interface eth0 --as 1 --src 10.10.100.50 --dst 172.16.100.140 --prefix 32
```
<figure><img src="../../.gitbook/assets/image (20) (1).png" alt=""><figcaption></figcaption></figure>

**Nosso host parece estar em apuros :)**

<figure><img src="../../.gitbook/assets/image (6) (1) (1).png" alt=""><figcaption></figcaption></figure>

Como voc√™ pode ver, o host perde a conectividade com o host **172.16.100.140/32** devido √† inje√ß√£o de rota.

### Abusando dos Valores K <a href="#25aa" id="25aa"></a>

Para estabelecer vizinhos EIGRP, **os roteadores usam valores K especiais.** Eles devem ser iguais entre todos os vizinhos EIGRP. Se pelo menos um valor K n√£o corresponder, o dom√≠nio EIGRP ir√° falhar e a vizinhan√ßa ser√° interrompida. Usaremos o [**relationshipnightmare.py**](https://github.com/in9uz/EIGRPWN/blob/main/relationshipnightmare.py) para realizar este ataque\*\*.\*\*

<figure><img src="../../.gitbook/assets/image (12) (2).png" alt=""><figcaption></figcaption></figure>

Argumentos do script:

* **interface de rede**
* **n√∫mero AS EIGRP**
* **Endere√ßo IP do roteador leg√≠timo**

**Em nome do IP especificado, ser√° enviada uma inje√ß√£o no endere√ßo IP EIGRP multicast, no qual os valores K s√£o diferentes.** No meu caso, vou quebrar a vizinhan√ßa em nome do roteador GW1 **(endere√ßo √© 10.10.100.100)**.
```
~$ sudo python3 relationshipnightmare.py --interface eth0 --as 1 --src 10.10.100.100
```
<figure><img src="../../.gitbook/assets/image (9) (1).png" alt=""><figcaption><p>Despejo de tr√°fego durante uma interrup√ß√£o de vizinhan√ßa</p></figcaption></figure>

<figure><img src="../../.gitbook/assets/image (27) (1).png" alt=""><figcaption><p>O roteador GW1 desconecta e reconecta o EIGRP infinitamente</p></figcaption></figure>

**Um ataque DoS pode ser realizado desta maneira. Durante a opera√ß√£o, ocorrem interrup√ß√µes e tentativas de vizinhan√ßa infinitas, paralisando parte do dom√≠nio de roteamento EIGRP.**

### Sobrecarga da tabela de roteamento <a href="#1d0c" id="1d0c"></a>

A ess√™ncia deste ataque √© provocar o envio de um grande n√∫mero de rotas falsas, que v√£o sobrecarregar a tabela de roteamento. Isso esgota os recursos de computa√ß√£o do roteador, ou seja, a CPU e a RAM, uma vez que as inje√ß√µes ocorrem em uma velocidade enorme. Este ataque √© implementado pelo script [**routingtableoverflow.py**](https://github.com/in9uz/EIGRPWN/blob/main/routingtableoverflow.py).

<figure><img src="../../.gitbook/assets/image (3) (4).png" alt=""><figcaption></figcaption></figure>

Argumentos do script

* **interface de rede**
* **N√∫mero AS do EIGRP**
* **Endere√ßo IP do atacante**
```
in9uz@Inguz:~$ sudo python3 routingtableoverflow.py --interface eth0 --as 1 --src 10.10.100.50
```
Ap√≥s a execu√ß√£o do script, a tabela de roteamento come√ßa a transbordar com rotas. Os endere√ßos aleat√≥rios das redes de destino s√£o devidos ao uso de **RandIP()** no [**Scapy**](https://github.com/secdev/scapy).

<figure><img src="../../.gitbook/assets/image (4) (4).png" alt=""><figcaption><p>Tabela de roteamento transbordando no roteador GW1</p></figcaption></figure>

<figure><img src="../../.gitbook/assets/image (21) (1).png" alt=""><figcaption><p>CPU do roteador sobrecarregada</p></figcaption></figure>

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Voc√™ trabalha em uma **empresa de seguran√ßa cibern√©tica**? Voc√™ quer ver sua **empresa anunciada no HackTricks**? ou quer ter acesso √† **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**? Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Descubra [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* **Junte-se ao** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para o** [**reposit√≥rio hacktricks**](https://github.com/carlospolop/hacktricks) **e para o** [**reposit√≥rio hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
