# Ataques EIGRP

<details>

<summary><strong>Aprende hacking en AWS desde cero hasta experto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si deseas ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** Consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Obt√©n [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠guenos** en **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Comparte tus trucos de hacking enviando PRs a los** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repositorios de github.

</details>

**Esta p√°gina se basa en** [****](https://medium.com/@in9uz/cisco-nightmare-pentesting-cisco-networks-like-a-devil-f4032eb437b9). Consulta para m√°s informaci√≥n.

## Comprendiendo las Vulnerabilidades del Protocolo EIGRP <a href="#0f82" id="0f82"></a>

**EIGRP (Enhanced Interior Gateway Routing Protocol)** se identifica como un protocolo de enrutamiento din√°mico de vector de distancia. Se observa una vulnerabilidad cr√≠tica si se descuida la autenticaci√≥n o la configuraci√≥n de interfaces pasivas, lo que puede llevar a la contaminaci√≥n potencial de las tablas de enrutamiento. Adem√°s, la estructura de la red EIGRP, o sistema aut√≥nomo, no est√° segmentada, careciendo de cualquier forma de divisiones de zona. Esta estructura plana implica que las rutas inyectadas por un atacante podr√≠an propagarse por todo el sistema aut√≥nomo.

![](../../.gitbook/assets/image (25) (1).png)

El primer paso para explotar un sistema EIGRP implica establecer una conexi√≥n con un enrutador EIGRP leg√≠timo. Esta conexi√≥n abre caminos que van desde la reconocimiento hasta varias formas de inyecciones. Para facilitar esto, se utiliza [**FRRouting**](https://frrouting.org/), una soluci√≥n de c√≥digo abierto, para emular un enrutador en sistemas Unix y Linux. **FRRouting** admite m√∫ltiples protocolos incluyendo BGP, OSPF y EIGRP. La implementaci√≥n de FRRouting en el sistema de un atacante les permite imitar un enrutador leg√≠timo dentro del dominio de enrutamiento. Instrucciones detalladas para implementar FRR en tu sistema seguir√°n.

### Recopilaci√≥n de Inteligencia de Red <a href="#41e6" id="41e6"></a>

La integraci√≥n en el dominio de enrutamiento permite la enumeraci√≥n y el reconocimiento de redes, ofreciendo una alternativa eficiente en tiempo a los escaneos extensos. Este enfoque no solo ahorra tiempo, sino que tambi√©n mitiga el riesgo de detecci√≥n por parte de sistemas de seguridad IPS/IDS. Para lograr esto se requiere la implementaci√≥n de **FRRouting**.

Se requieren modificaciones en el archivo de configuraci√≥n `daemons`, que controla las actividades del demonio. Es necesario activar el demonio **eigrpd**.
```bash
~# nano /etc/frr/daemons
eigrpd=yes
```
Adicionalmente, se necesitan ajustes en el archivo **vtysh.conf** para garantizar que las configuraciones de varios protocolos se consoliden en un solo archivo.
```bash
~# nano /etc/frr/vtysh.conf
service integrated-vtysh-config
```
Despu√©s de la configuraci√≥n, se requiere la iniciaci√≥n del demonio FRR y la habilitaci√≥n del enrutamiento de tr√°fico (deshabilitado de forma predeterminada en las distribuciones de Linux).
```bash
~$ sudo systemctl start frr
~$ sudo sysctl -w net.ipv4.ip_forward=1
```
El comando **vtysh** proporciona acceso al panel de control del enrutador FRR.
```bash
~$ sudo vtysh
```
Ejemplo de uso:
```bash
root# show version
```
> Nota: El dominio de enrutamiento EIGRP podr√≠a estar asegurado con autenticaci√≥n. Sin embargo, a√∫n es posible acceder extrayendo hashes criptogr√°ficos de los paquetes hello y restableciendo la contrase√±a.

En el modo de configuraci√≥n global, inicie el proceso **EIGRP** y defina el n√∫mero de sistema aut√≥nomo ‚Äî **1**, junto con la ubicaci√≥n de la red.
```bash
root# config
root(config)# router eigrp 1
root(config-router) network 10.10.100.50/32
```
Post-establecimiento de conexiones de vecinos con enrutadores EIGRP leg√≠timos (en este caso, **GW1 (10.10.100.100)** y **GW2 (10.10.100.200)**), los enrutadores intercambian informaci√≥n de enrutamiento. Este proceso resulta en la aparici√≥n de nuevas rutas en la tabla de enrutamiento del sistema atacante, lo que ayuda en las pruebas de penetraci√≥n y ahorra tiempo en el escaneo de subredes. En esta etapa, el sistema forma parte del dominio de enrutamiento EIGRP y est√° listo para el desarrollo de vectores de ataque adicionales.

![](../../.gitbook/assets/image (5) (1) (2).png)
![](../../.gitbook/assets/image (30) (1).png)
![](../../.gitbook/assets/image (29) (1) (2).png)

### Explotando EIGRP: Vectores de Ataque <a href="#51ee" id="51ee"></a>

#### 1. Vecinos EIGRP Falsos
El env√≠o masivo de paquetes hello de EIGRP puede provocar una sobrecarga de la CPU en los enrutadores, abriendo paso a ataques de denegaci√≥n de servicio (DoS). Se utiliza un script, **helloflooding.py**, para esto, aunque la velocidad de env√≠o de paquetes est√° limitada por GIL (Global Interpreter Lock). Se est√°n realizando planes para reescribir el script en C para un rendimiento mejorado.

![](../../.gitbook/assets/image (2) (6) (1).png)

El uso del script implica especificar:
- Interfaz de red (por ejemplo, eth0)
- N√∫mero de sistema aut√≥nomo EIGRP (por ejemplo, 1)
- Ubicaci√≥n de la subred (por ejemplo, 10.10.100.0/24)
```bash
~$ sudo python3 helloflooding.py --interface eth0 --as 1 --subnet 10.10.100.0/24
```
#### 2. Ataque EIGRP Blackhole
Este ataque implica inyectar una ruta falsa para interrumpir el flujo de tr√°fico, com√∫nmente conocido como un ataque Blackhole. El script **routeinject.py** se utiliza con este prop√≥sito. Por ejemplo, redirigir el tr√°fico para `172.16.100.140/32` hacia un destino inexistente.

![](../../.gitbook/assets/image (16) (1).png)

Los par√°metros del script incluyen:
- Interfaz del sistema del atacante
- N√∫mero AS de EIGRP
- Direcci√≥n IP del atacante
- Subred objetivo IP y su m√°scara
```bash
~$ sudo python3 routeinject.py --interface eth0 --as 1 --src 10.10.100.50 --dst 172.16.100.140 --prefix 32
```
![](../../.gitbook/assets/image (20) (1).png)

El resultado es una p√©rdida de conectividad con el host objetivo debido a la inyecci√≥n de rutas.

![](../../.gitbook/assets/image (6) (1) (1).png)

#### 3. Abuso de valores K
Los valores K desiguales entre los routers EIGRP pueden interrumpir el dominio EIGRP. El script **relationshipnightmare.py** explota esto inyectando valores K alterados, desencadenando interrupciones y reconexiones continuas dentro del dominio EIGRP, lo que resulta efectivamente en un ataque de denegaci√≥n de servicio (DoS).

![](../../.gitbook/assets/image (12) (2) (1).png)

El script requiere:
- Interfaz de red
- N√∫mero de AS de EIGRP
- Direcci√≥n IP de un enrutador leg√≠timo

Las alteraciones inyectadas se env√≠an desde la IP especificada a la direcci√≥n IP de EIGRP multicast, causando la discrepancia.
```bash
~$ sudo python3 relationshipnightmare.py --interface eth0 --as 1 --src 10.10.100.100
```
![](../../.gitbook/assets/image (9) (1) (4).png)
![](../../.gitbook/assets/image (27) (1).png)

#### 4. Desbordamiento de la Tabla de Enrutamiento
Este ataque inunda la tabla de enrutamiento con rutas falsas, sobrecargando la CPU y la RAM del enrutador. El script **routingtableoverflow.py** facilita esto al enviar r√°pidamente numerosas rutas falsas.

![](../../.gitbook/assets/image (3) (4).png)

Par√°metros del script:
- Interfaz de red
- N√∫mero AS de EIGRP
- Direcci√≥n IP del atacante

Tras la ejecuci√≥n del script, la tabla de enrutamiento se satura con rutas falsas, afectando severamente el rendimiento del enrutador.
```bash
sudo python3 routingtableoverflow.py --interface eth0 --as 1 --src 10.10.100.50
```
<details>

<summary><strong>Aprende hacking en AWS de cero a h√©roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si deseas ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** Consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Obt√©n el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠guenos** en **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
