# Ataques EIGRP

<details>

<summary><strong>Aprende hacking en AWS de cero a h√©roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** revisa los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Consigue el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **sigue** a **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repos de github** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

**Esta p√°gina est√° basada en** [****](https://medium.com/@in9uz/cisco-nightmare-pentesting-cisco-networks-like-a-devil-f4032eb437b9). Consulta para m√°s informaci√≥n.

## Entendiendo las Vulnerabilidades del Protocolo EIGRP <a href="#0f82" id="0f82"></a>

**EIGRP (Enhanced Interior Gateway Routing Protocol)** es identificado como un protocolo de enrutamiento din√°mico y vector-distancia. Se observa una vulnerabilidad cr√≠tica si se descuida la autenticaci√≥n o la configuraci√≥n de interfaces pasivas, lo que lleva a la posible corrupci√≥n de las tablas de enrutamiento. Adem√°s, la estructura de la red EIGRP, o sistema aut√≥nomo, no est√° segmentada, careciendo de cualquier forma de divisiones de zonas. Esta estructura plana implica que las rutas inyectadas por un atacante podr√≠an propagarse a trav√©s de todo el sistema aut√≥nomo.

![](../../.gitbook/assets/image (25) (1).png)

El primer paso para explotar un sistema EIGRP implica establecer una conexi√≥n con un router EIGRP leg√≠timo. Esta conexi√≥n abre caminos que van desde el reconocimiento hasta varias formas de inyecciones. Para facilitar esto, se utiliza [**FRRouting**](https://frrouting.org/), una soluci√≥n de c√≥digo abierto, para emular un router en sistemas Unix y Linux. **FRRouting** soporta m√∫ltiples protocolos incluyendo BGP, OSPF y EIGRP. El despliegue de FRRouting en un sistema atacante les permite imitar un router leg√≠timo dentro del dominio de enrutamiento. Las instrucciones detalladas para desplegar FRR en tu sistema se proporcionar√°n a continuaci√≥n.

### Recopilaci√≥n de Inteligencia de Red <a href="#41e6" id="41e6"></a>

La integraci√≥n en el dominio de enrutamiento permite la enumeraci√≥n y el reconocimiento de redes, ofreciendo una alternativa eficiente en tiempo a los escaneos extensivos. Este enfoque no solo ahorra tiempo sino que tambi√©n mitiga el riesgo de detecci√≥n por sistemas de seguridad IPS/IDS. Para lograr esto se requiere el despliegue de **FRRouting**.

Se requieren modificaciones en el archivo de configuraci√≥n `daemons`, que controla las actividades de los demonios. Es necesaria la activaci√≥n del demonio **eigrpd**.
```bash
~# nano /etc/frr/daemons
eigrpd=yes
```
![](../../.gitbook/assets/image (15) (1).png)

Adem√°s, se necesitan ajustes en el archivo **vtysh.conf** para asegurar que las configuraciones de varios protocolos se consoliden en un √∫nico archivo.
```bash
~# nano /etc/frr/vtysh.conf
service integrated-vtysh-config
```
Post-configuraci√≥n, se requiere la iniciaci√≥n del daemon FRR y la habilitaci√≥n del enrutamiento de tr√°fico (deshabilitado por defecto en distribuciones Linux).
```bash
~$ sudo systemctl start frr
~$ sudo sysctl -w net.ipv4.ip_forward=1
```
```markdown
![](../../.gitbook/assets/image (32).png)

El comando **vtysh** proporciona acceso al panel de control del router FRR.
```
```bash
~$ sudo vtysh
```
Uso de ejemplo:
```bash
root# show version
```
```markdown
![](../../.gitbook/assets/image (3) (2) (2).png)

> Nota: El dominio de enrutamiento EIGRP puede estar asegurado con autenticaci√≥n. Sin embargo, el acceso potencial sigue siendo posible extrayendo los hashes criptogr√°ficos de los paquetes hello y restableciendo la contrase√±a.

En el modo de configuraci√≥n global, inicia el proceso **EIGRP** y define el n√∫mero del sistema aut√≥nomo ‚Äî **1**, junto con la ubicaci√≥n de la red.
```
```bash
root# config
root(config)# router eigrp 1
root(config-router) network 10.10.100.50/32
```
### Explotaci√≥n de EIGRP: Vectores de Ataque <a href="#51ee" id="51ee"></a>

#### 1. Vecinos Falsos de EIGRP
El env√≠o masivo de paquetes hello de EIGRP puede provocar una sobrecarga de CPU en los routers, abriendo camino para ataques DoS. Para ello se utiliza un script, **helloflooding.py**, aunque su velocidad de env√≠o de paquetes est√° limitada por GIL (Global Interpreter Lock). Se est√°n realizando planes para reescribir el script en C para mejorar el rendimiento.

![](../../.gitbook/assets/image (2) (6) (1).png)

El uso del script implica especificar:
- Interfaz de red (por ejemplo, eth0)
- N√∫mero de sistema aut√≥nomo de EIGRP (por ejemplo, 1)
- Ubicaci√≥n de la subred (por ejemplo, 10.10.100.0/24)
```bash
~$ sudo python3 helloflooding.py --interface eth0 --as 1 --subnet 10.10.100.0/24
```
#### 2. Ataque de Agujero Negro EIGRP
Este ataque implica inyectar una ruta falsa para interrumpir el flujo de tr√°fico, com√∫nmente conocido como ataque de Agujero Negro. Se utiliza el script **routeinject.py** para este prop√≥sito. Por ejemplo, redirigir el tr√°fico para `172.16.100.140/32` a un destino inexistente.

![](../../.gitbook/assets/image (16) (1).png)

Los par√°metros del script incluyen:
- Interfaz del sistema del atacante
- N√∫mero AS de EIGRP
- Direcci√≥n IP del atacante
- IP de la subred objetivo y su m√°scara
```bash
~$ sudo python3 routeinject.py --interface eth0 --as 1 --src 10.10.100.50 --dst 172.16.100.140 --prefix 32
```
![](../../.gitbook/assets/image (20) (1).png)

El resultado es una p√©rdida de conectividad al host objetivo debido a la inyecci√≥n de rutas.

![](../../.gitbook/assets/image (6) (1) (1).png)

#### 3. Abuso de K-Values
Valores de K desajustados entre los routers EIGRP pueden interrumpir el dominio EIGRP. El script **relationshipnightmare.py** explota esto inyectando valores de K alterados, provocando interrupciones continuas y reconexiones dentro del dominio EIGRP, resultando efectivamente en un ataque DoS.

![](../../.gitbook/assets/image (12) (2) (1).png)

El script requiere:
- Interfaz de red
- N√∫mero AS de EIGRP
- Direcci√≥n IP de un router leg√≠timo

Las alteraciones inyectadas se env√≠an desde la IP especificada a la direcci√≥n IP multicast de EIGRP, causando el desajuste.
```bash
~$ sudo python3 relationshipnightmare.py --interface eth0 --as 1 --src 10.10.100.100
```
#### 4. Desbordamiento de la Tabla de Enrutamiento
Este ataque inunda la tabla de enrutamiento con rutas falsas, sobrecargando la CPU y la RAM del enrutador. El script **routingtableoverflow.py** facilita esto al enviar r√°pidamente numerosas rutas falsas.

![](../../.gitbook/assets/image (3) (4).png)

Par√°metros del script:
- Interfaz de red
- N√∫mero AS de EIGRP
- Direcci√≥n IP del atacante

Tras la ejecuci√≥n del script, la tabla de enrutamiento se satura con rutas espurias, afectando gravemente el rendimiento del enrutador.
```bash
sudo python3 routingtableoverflow.py --interface eth0 --as 1 --src 10.10.100.50
```
![](../../.gitbook/assets/image (4) (4).png)
![](../../.gitbook/assets/image (21) (1).png)

<details>

<summary><strong>Aprende hacking en AWS de cero a h√©roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver a tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF**, consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Consigue el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **sigue**me en **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de github** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
