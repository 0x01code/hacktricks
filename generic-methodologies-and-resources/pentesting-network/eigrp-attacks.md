# Ataques EIGRP

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* ¬øTrabajas en una **empresa de ciberseguridad**? ¬øQuieres ver tu **empresa anunciada en HackTricks**? ¬øO quieres tener acceso a la **√∫ltima versi√≥n de PEASS o descargar HackTricks en PDF**? ¬°Consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n de exclusivos [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obt√©n el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* **√önete al** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠gueme** en **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Comparte tus trucos de hacking enviando PRs al** [**repositorio de hacktricks**](https://github.com/carlospolop/hacktricks) **y al** [**repositorio de hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

**Esta p√°gina fue copiada de** [**https://medium.com/@in9uz/cisco-nightmare-pentesting-cisco-networks-like-a-devil-f4032eb437b9**](https://medium.com/@in9uz/cisco-nightmare-pentesting-cisco-networks-like-a-devil-f4032eb437b9)

## Atacando el protocolo EIGRP <a href="#0f82" id="0f82"></a>

**EIGRP (Protocolo de enrutamiento de puerta de enlace interior mejorado)** es un protocolo de enrutamiento din√°mico. **Es un protocolo vector de distancia.** **Si no hay autenticaci√≥n y configuraci√≥n de interfaces pasivas, un intruso puede interferir en el enrutamiento EIGRP y causar envenenamiento de tablas de enrutamiento.** **Adem√°s, la red EIGRP (en otras palabras, el sistema aut√≥nomo) es plana y no tiene segmentaci√≥n en ninguna zona.** ¬øQu√© podr√≠a significar esto para un atacante? Bueno, si inyecta una ruta, es probable que esta ruta se propague por todo el sistema aut√≥nomo EIGRP.

<figure><img src="../../.gitbook/assets/image (25) (1).png" alt=""><figcaption></figcaption></figure>

En primer lugar, atacar un sistema EIGRP independiente requiere establecer una vecindad con un enrutador EIGRP leg√≠timo, lo que abre muchas posibilidades, desde reconocimiento b√°sico hasta varias inyecciones.

Para esto usar√© [**FRRouting**](https://frrouting.org/). Este es un software de c√≥digo abierto dise√±ado para crear un enrutador en Unix y Linux. **FRRouting** te permite implementar **un enrutador virtual que admite BGP, OSPF, EIGRP, RIP y otros protocolos.** Todo lo que necesitas hacer es implementarlo en el sistema del atacante y puedes fingir ser un enrutador leg√≠timo en el dominio de enrutamiento. Te mostrar√© c√≥mo implementar FRR en tu sistema en la siguiente secci√≥n.

### Inteligencia de red <a href="#41e6" id="41e6"></a>

**Conectarse al dominio de enrutamiento nos permite hacer enumeraci√≥n y reconocimiento de redes y no pasar mucho tiempo escaneando.** Este m√©todo te ahorra mucho tiempo valioso. **Adem√°s, al escanear, puedes ser detectado por sistemas de seguridad IPS/IDS.** Para m√≠, conectarse al dominio y la enumeraci√≥n es el vector de ataque en los dominios de enrutamiento que te da el mayor impacto. Pero para hacer esto necesitas implementar **FRRouting**. Aqu√≠ vamos.

**Es necesario editar el archivo de configuraci√≥n daemons.** Contiene las configuraciones de los demonios en el contexto de su actividad. Ya sea que est√©n habilitados (s√≠) o no (no). Necesitamos activar el demonio **eigrpd**.
```
~# nano /etc/frr/daemons
eigrpd=yes
```
<figure><img src="../../.gitbook/assets/image (15) (1).png" alt=""><figcaption></figcaption></figure>

Despu√©s de eso, es necesario corregir el archivo **vtysh.conf** agregando una l√≠nea responsable de guardar la configuraci√≥n en un solo archivo, para que las configuraciones de diferentes protocolos no se dispersen en diferentes archivos **(por ejemplo, eigrpd.conf, staticd.conf).** Es configurable opcionalmente.
```
~# nano /etc/frr/vtysh.conf
service integrated-vtysh-config
```
La configuraci√≥n de FRRouting est√° lista. Ahora es el momento de ejecutar el demonio de FRR. Y s√≠, necesitamos habilitar el enrutamiento de tr√°fico. Por defecto, est√° deshabilitado en las distribuciones de Linux.
```
~$ sudo systemctl start frr
~$ sudo sysctl -w net.ipv4.ip_forward=1
```
<figure><img src="../../.gitbook/assets/image (32).png" alt=""><figcaption></figcaption></figure>

El comando **vtysh** nos llevar√° al panel de control del router FRR.
```
~$ sudo vtysh
```
### EIGRP Attacks

#### Introduction

EIGRP (Enhanced Interior Gateway Routing Protocol) is a Cisco proprietary routing protocol that is widely used in enterprise networks. It is an advanced distance-vector routing protocol that uses Diffusing Update Algorithm (DUAL) to calculate the shortest path to a destination network. EIGRP is a classless routing protocol that supports variable-length subnet masks (VLSM) and route summarization.

#### EIGRP Protocol Overview

EIGRP uses a hierarchical network design that consists of the following components:

- Autonomous System (AS): A collection of networks that are under a common administrative domain.
- Router: A device that forwards data packets between networks.
- Neighbor: A router that shares routing information with another router.
- Topology Table: A database that stores information about all known routes in the network.
- Routing Table: A database that stores the best routes to each destination network.
- Metrics: A set of values that are used to calculate the best path to a destination network.

#### EIGRP Attacks

EIGRP is vulnerable to the following attacks:

- Eavesdropping: An attacker can intercept EIGRP packets and obtain sensitive information such as network topology, routing tables, and metrics.
- Spoofing: An attacker can send fake EIGRP packets to a router and manipulate its routing table. This can lead to traffic redirection, black-holing, and denial of service (DoS) attacks.
- Injection: An attacker can inject fake EIGRP packets into the network to advertise false routes. This can lead to traffic interception, man-in-the-middle (MitM) attacks, and data leakage.
- DoS: An attacker can flood the network with EIGRP packets to consume network resources and cause network congestion.

#### EIGRP Countermeasures

To mitigate EIGRP attacks, the following countermeasures can be implemented:

- Authentication: EIGRP supports MD5 authentication to secure the exchange of routing information between routers.
- Encryption: EIGRP supports IPsec encryption to protect the confidentiality and integrity of routing information.
- Access Control: EIGRP packets should be filtered at network boundaries to prevent unauthorized access and spoofing.
- Monitoring: EIGRP traffic should be monitored for anomalies and suspicious activity.
- Hardening: EIGRP routers should be hardened by disabling unnecessary services and features, and applying security patches and updates. 

#### Conclusion

EIGRP is a powerful routing protocol that provides many benefits to enterprise networks. However, it is important to be aware of its vulnerabilities and implement appropriate countermeasures to protect against attacks. By following the best practices of network security, organizations can ensure the integrity, availability, and confidentiality of their network infrastructure. 

#### References

- [Cisco EIGRP Overview](https://www.cisco.com/c/en/us/support/docs/ip/enhanced-interior-gateway-routing-protocol-eigrp/16406-eigrp-toc.html)
- [EIGRP Security Best Practices](https://www.cisco.com/c/en/us/support/docs/ip/enhanced-interior-gateway-routing-protocol-eigrp/13669-17.html) 

### Ataques EIGRP

#### Introducci√≥n

EIGRP (Protocolo de enrutamiento de puerta de enlace interior mejorado) es un protocolo de enrutamiento propietario de Cisco que se utiliza ampliamente en redes empresariales. Es un protocolo de enrutamiento vectorial de distancia avanzado que utiliza el algoritmo de actualizaci√≥n difusa (DUAL) para calcular la ruta m√°s corta a una red de destino. EIGRP es un protocolo de enrutamiento sin clase que admite m√°scaras de subred de longitud variable (VLSM) y resumen de ruta.

#### Descripci√≥n general del protocolo EIGRP

EIGRP utiliza un dise√±o de red jer√°rquico que consta de los siguientes componentes:

- Sistema aut√≥nomo (AS): una colecci√≥n de redes que se encuentran bajo un dominio administrativo com√∫n.
- Enrutador: un dispositivo que reenv√≠a paquetes de datos entre redes.
- Vecino: un enrutador que comparte informaci√≥n de enrutamiento con otro enrutador.
- Tabla de topolog√≠a: una base de datos que almacena informaci√≥n sobre todas las rutas conocidas en la red.
- Tabla de enrutamiento: una base de datos que almacena las mejores rutas para cada red de destino.
- M√©tricas: un conjunto de valores que se utilizan para calcular la mejor ruta a una red de destino.

#### Ataques EIGRP

EIGRP es vulnerable a los siguientes ataques:

- Espionaje: un atacante puede interceptar paquetes EIGRP y obtener informaci√≥n confidencial como la topolog√≠a de la red, las tablas de enrutamiento y las m√©tricas.
- Suplantaci√≥n: un atacante puede enviar paquetes EIGRP falsos a un enrutador y manipular su tabla de enrutamiento. Esto puede provocar la redirecci√≥n de tr√°fico, la eliminaci√≥n de tr√°fico y ataques de denegaci√≥n de servicio (DoS).
- Inyecci√≥n: un atacante puede inyectar paquetes EIGRP falsos en la red para anunciar rutas falsas. Esto puede provocar la interceptaci√≥n de tr√°fico, ataques de hombre en el medio (MitM) y fugas de datos.
- DoS: un atacante puede inundar la red con paquetes EIGRP para consumir recursos de red y causar congesti√≥n de red.

#### Contramedidas EIGRP

Para mitigar los ataques EIGRP, se pueden implementar las siguientes contramedidas:

- Autenticaci√≥n: EIGRP admite autenticaci√≥n MD5 para asegurar el intercambio de informaci√≥n de enrutamiento entre enrutadores.
- Cifrado: EIGRP admite cifrado IPsec para proteger la confidencialidad e integridad de la informaci√≥n de enrutamiento.
- Control de acceso: los paquetes EIGRP deben filtrarse en los l√≠mites de la red para evitar el acceso no autorizado y la suplantaci√≥n.
- Monitoreo: el tr√°fico EIGRP debe monitorearse en busca de anomal√≠as y actividad sospechosa.
- Fortalecimiento: los enrutadores EIGRP deben fortalecerse mediante la desactivaci√≥n de servicios y caracter√≠sticas innecesarios, y la aplicaci√≥n de parches y actualizaciones de seguridad.

#### Conclusi√≥n

EIGRP es un protocolo de enrutamiento potente que proporciona muchos beneficios a las redes empresariales. Sin embargo, es importante conocer sus vulnerabilidades e implementar contramedidas adecuadas para protegerse contra los ataques. Siguiendo las mejores pr√°cticas de seguridad de red, las organizaciones pueden garantizar la integridad, disponibilidad y confidencialidad de su infraestructura de red.

#### Referencias

- [Descripci√≥n general de Cisco EIGRP](https://www.cisco.com/c/en/us/support/docs/ip/enhanced-interior-gateway-routing-protocol-eigrp/16406-eigrp-toc.html)
- [Mejores pr√°cticas de seguridad de EIGRP](https://www.cisco.com/c/en/us/support/docs/ip/enhanced-interior-gateway-routing-protocol-eigrp/13669-17.html)
```
Inguz# show version
```
<figure><img src="../../.gitbook/assets/image (3) (2) (2).png" alt=""><figcaption></figcaption></figure>

> **Sin embargo, no olvides que el dominio de enrutamiento EIGRP puede estar protegido por autenticaci√≥n. Pero a√∫n tienes la oportunidad de conectarte al dominio de enrutamiento. Cuando se env√≠an paquetes hello, tambi√©n contienen hashes criptogr√°ficos. Si puedes extraer estos hashes del volcado de tr√°fico y restablecer la contrase√±a, puedes iniciar sesi√≥n en el dominio de enrutamiento con esta contrase√±a.**

Ve al modo de configuraci√≥n global y comienza el proceso de **EIGRP**, especifica el n√∫mero de sistema aut√≥nomo - **1**

Y tambi√©n necesitamos declarar la red en la que estamos. Estamos en 10.10.100.0/24. Mi direcci√≥n es 10.10.100.50/32
```
Inguz# configInguz(config)# router eigrp 1Inguz(config-router) network 10.10.100.50/32
```
Despu√©s de eso, se establece la vecindad entre los routers EIGRP leg√≠timos. Hay dos de ellos en mi red:

* **GW1 (10.10.100.100)**
* **GW2 (10.10.100.200)**

Vecindad EIGRP con GW1 (10.10.100.100):

<figure><img src="../../.gitbook/assets/image (5) (1) (2).png" alt=""><figcaption></figcaption></figure>

Vecindad EIGRP con GW2 (10.10.100.200):

<figure><img src="../../.gitbook/assets/image (30) (1).png" alt=""><figcaption></figcaption></figure>

Durante el establecimiento y mantenimiento de la vecindad entre los routers EIGRP, los routers intercambian su informaci√≥n de enrutamiento. Despu√©s de que se establece la vecindad, aparecer√°n nuevas rutas en nuestra tabla de enrutamiento del sistema atacante, a saber:

* **10.1.239.0/24 a trav√©s de 10.10.100.100;**
* **30.30.30.0/24 a trav√©s de 10.10.100.100;**
* **100.100.100.0/24 a trav√©s de 10.10.100.100;**
* **172.16.100.0/24 a trav√©s de 10.10.100.200**

<figure><img src="../../.gitbook/assets/image (29) (1) (2).png" alt=""><figcaption></figcaption></figure>

As√≠, despu√©s de establecer la vecindad, sabemos sobre la existencia de estas subredes, lo que nos facilita la prueba de penetraci√≥n y nos ahorra tiempo. Podemos prescindir del escaneo adicional de subredes. Ahora estamos en el dominio de enrutamiento EIGRP y podemos desarrollar algunos vectores de ataque. Hablemos de ellos.

### Vecinos EIGRP falsos <a href="#51ee" id="51ee"></a>

**He descubierto que generar y enviar r√°pidamente paquetes de saludo EIGRP masivos sobrecarga la CPU del router, lo que a su vez puede abrir la puerta a un ataque DoS.** He desarrollado un peque√±o script [**helloflooding.py**](https://github.com/in9uz/EIGRPWN/blob/main/helloflooding.py), pero me parece que el script carece de velocidad para enviar los paquetes. **Esto se debe a GIL**, que impide que la funci√≥n **sprayhello** se ejecute en m√∫ltiples hilos por segundo. **Eventualmente reescribir√© el script en C.**

<figure><img src="../../.gitbook/assets/image (2) (6) (1).png" alt=""><figcaption></figcaption></figure>

Argumentos del script:

* **Interfaz del sistema atacante (eth0);**
* **N√∫mero aut√≥nomo del sistema EIGRP (1);**
* **Subred donde se encuentra el sistema atacante. En mi caso, la subred es 10.10.100.0/24**
```
~$ sudo python3 helloflooding.py --interface eth0 --as 1 --subnet 10.10.100.0/24
```
<figure><img src="../../.gitbook/assets/image (26) (1).png" alt=""><figcaption></figcaption></figure>

### Agujero negro EIGRP <a href="#5c04" id="5c04"></a>

La esencia de este ataque es la simple inyecci√≥n de una ruta falsa que envenenar√° la tabla de enrutamiento. El tr√°fico hacia, digamos, la red `10.10.100.0/24` no llegar√° a ninguna parte, causando una denegaci√≥n de servicio. Este tipo de ataque se llama agujero negro. La herramienta utilizada para realizarlo ser√° el script [**routeinject.py**](https://github.com/in9uz/EIGRPWN/blob/main/routeinject.py). Para este ejemplo, enviar√© tr√°fico destinado al host `172.16.100.140/32` al agujero negro.

<figure><img src="../../.gitbook/assets/image (16) (1).png" alt=""><figcaption></figcaption></figure>

Argumentos del script:

* **interfaz del sistema atacante**
* **n√∫mero AS de EIGRP**
* **direcci√≥n IP del atacante**
* **direcci√≥n IP de la subred objetivo cuyo tr√°fico se enviar√° al agujero negro**
* **m√°scara de subred objetivo**
```
~$ sudo python3 routeinject.py --interface eth0 --as 1 --src 10.10.100.50 --dst 172.16.100.140 --prefix 32
```
<figure><img src="../../.gitbook/assets/image (20) (1) (2).png" alt=""><figcaption></figcaption></figure>

**Nuestro host parece estar en problemas :)**

<figure><img src="../../.gitbook/assets/image (6) (1) (1).png" alt=""><figcaption></figcaption></figure>

Como se puede ver, el host pierde la conectividad con el host **172.16.100.140/32** debido a la inyecci√≥n de ruta.

### Abusando de los valores K <a href="#25aa" id="25aa"></a>

Para establecer vecinos EIGRP, **los routers usan valores K especiales.** Estos deben ser iguales entre todos los vecinos EIGRP. Si al menos un valor K no coincide, el dominio EIGRP se bloquear√° y la vecindad se romper√°. Usaremos [**relationshipnightmare.py**](https://github.com/in9uz/EIGRPWN/blob/main/relationshipnightmare.py) \*\*\*\* para realizar este ataque\*\*.\*\*

<figure><img src="../../.gitbook/assets/image (12) (2).png" alt=""><figcaption></figcaption></figure>

Argumentos del script:

* **interfaz de red**
* **n√∫mero AS de EIGRP**
* **direcci√≥n IP del router leg√≠timo**

**En nombre de la direcci√≥n IP especificada se enviar√° una inyecci√≥n en la direcci√≥n IP multicast de EIGRP, en la que los valores K son diferentes.** En mi caso, romper√© la vecindad en nombre del router GW1 **(la direcci√≥n es 10.10.100.100)**.
```
~$ sudo python3 relationshipnightmare.py --interface eth0 --as 1 --src 10.10.100.100
```
<figure><img src="../../.gitbook/assets/image (9) (1).png" alt=""><figcaption><p>Dump de tr√°fico durante una interrupci√≥n de vecindario</p></figcaption></figure>

<figure><img src="../../.gitbook/assets/image (27) (1).png" alt=""><figcaption><p>El router GW1 se desconecta y reconecta infinitamente a EIGRP</p></figcaption></figure>

**Un ataque DoS puede llevarse a cabo de esta manera. Durante la operaci√≥n, ocurren desconexiones y intentos de vecindario infinitos, paralizando parte del dominio de enrutamiento EIGRP.**

### Desbordamiento de tabla de enrutamiento <a href="#1d0c" id="1d0c"></a>

La esencia de este ataque es provocar el env√≠o de una gran cantidad de rutas falsas, que desbordar√°n la tabla de enrutamiento. Esto agota los recursos inform√°ticos del router, es decir, la CPU y la RAM, ya que las inyecciones ocurren a una velocidad enorme. Este ataque se implementa con el script [**routingtableoverflow.py**](https://github.com/in9uz/EIGRPWN/blob/main/routingtableoverflow.py)

<figure><img src="../../.gitbook/assets/image (3) (4).png" alt=""><figcaption></figcaption></figure>

Argumentos del script

* **interfaz de red**
* **N√∫mero AS de EIGRP**
* **Direcci√≥n IP del atacante**
```
in9uz@Inguz:~$ sudo python3 routingtableoverflow.py --interface eth0 --as 1 --src 10.10.100.50
```
Despu√©s de ejecutar el script, la tabla de enrutamiento comienza a desbordarse con rutas. Las direcciones aleatorias de las redes objetivo se deben al uso de **RandIP()** en [**Scapy**](https://github.com/secdev/scapy).

<figure><img src="../../.gitbook/assets/image (4) (4).png" alt=""><figcaption><p>Tabla de enrutamiento desbordada en el router GW1</p></figcaption></figure>

<figure><img src="../../.gitbook/assets/image (21) (1).png" alt=""><figcaption><p>CPU del router sobrecargado</p></figcaption></figure>

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* ¬øTrabajas en una **empresa de ciberseguridad**? ¬øQuieres ver tu **empresa anunciada en HackTricks**? ¬øO quieres tener acceso a la **√∫ltima versi√≥n de PEASS o descargar HackTricks en PDF**? ¬°Consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obt√©n el [**swag oficial de PEASS y HackTricks**](https://peass.creator-spring.com)
* **√önete al** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠gueme** en **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Comparte tus trucos de hacking enviando PR al** [**repositorio de hacktricks**](https://github.com/carlospolop/hacktricks) **y al** [**repositorio de hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
