# EIGRP 攻击

<details>

<summary><strong>从零开始学习 AWS 黑客技术直到成为专家，通过</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS 红队专家)</strong></a><strong>！</strong></summary>

支持 HackTricks 的其他方式：

* 如果你想在 HackTricks 上看到你的**公司广告**或**下载 HackTricks 的 PDF**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取[**官方 PEASS & HackTricks 商品**](https://peass.creator-spring.com)
* 发现[**PEASS 家族**](https://opensea.io/collection/the-peass-family)，我们独家的[**NFTs 集合**](https://opensea.io/collection/the-peass-family)
* **加入** 💬 [**Discord 群组**](https://discord.gg/hRep4RUj7f) 或 [**telegram 群组**](https://t.me/peass) 或在 **Twitter** 🐦 上**关注**我 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github 仓库提交 PR 来分享你的黑客技巧。

</details>

**此页面复制自** [**https://medium.com/@in9uz/cisco-nightmare-pentesting-cisco-networks-like-a-devil-f4032eb437b9**](https://medium.com/@in9uz/cisco-nightmare-pentesting-cisco-networks-like-a-devil-f4032eb437b9)\*\*\*\*

## 攻击 EIGRP 协议 <a href="#0f82" id="0f82"></a>

**EIGRP (增强型内部网关路由协议)** 是一种动态路由协议。**它是一种距离矢量协议。** **如果没有认证和被动接口的配置，入侵者可以干扰 EIGRP 路由并导致路由表污染。** **此外，EIGRP 网络（换句话说，自治系统）是扁平的，没有分割成任何区域。** 这对攻击者意味着什么？如果他注入一条路由，这条路由很可能会在整个自治的 EIGRP 系统中传播。

<figure><img src="../../.gitbook/assets/image (25) (1).png" alt=""><figcaption></figcaption></figure>

首先，攻击一个独立的 EIGRP 系统需要与合法的 EIGRP 路由器建立邻居关系，这为从基本侦察到各种注入打开了很多可能性。

为此，我将使用 [**FRRouting**](https://frrouting.org/)。这是一个开源软件，旨在在 Unix 和 Linux 中创建路由器。**FRRouting** 允许你实现**一个支持 BGP、OSPF、EIGRP、RIP 和其他协议的虚拟路由器。** 你需要做的就是在攻击者的系统上部署它，你就可以真正假装成路由域中的合法路由器。我将在下一节向你展示如何在你的系统上部署 FRR。

### 网络情报 <a href="#41e6" id="41e6"></a>

**连接到路由域允许我们进行网络枚举和侦察，而不需要花费大量时间扫描。** 这种方法为你节省了宝贵的时间。**此外，通过扫描，你可能会在 IPS/IDS 安全系统面前暴露。** 对我来说，连接到域和枚举是对路由域的攻击向量，它给你带来最大的影响。但要做到这一点，你需要部署 **FRRouting**。我们开始吧。

**需要编辑配置文件 daemons。** 它包含了守护进程在其活动上下文中的配置。它们要么被启用（是）要么不被启用（否）。我们需要激活 **eigrpd** 守护进程。
```
~# nano /etc/frr/daemons
eigrpd=yes
```
```markdown
<figure><img src="../../.gitbook/assets/image (15) (1).png" alt=""><figcaption></figcaption></figure>

之后，您需要通过添加一行负责将配置保存到一个文件的代码来修正 **vtysh.conf** 文件，以便不同协议的配置不会散布到不同的文件中 **(例如 eigrpd.conf, staticd.conf)**。这是可选配置的。
```
```
~# nano /etc/frr/vtysh.conf
service integrated-vtysh-config
```
FRRouting配置已完成。现在是运行FRR守护进程的时候了。**而且，我们需要启用流量路由。默认情况下，它在Linux发行版中是禁用的**
```
~$ sudo systemctl start frr
~$ sudo sysctl -w net.ipv4.ip_forward=1
```
<figure><img src="../../.gitbook/assets/image (32).png" alt=""><figcaption></figcaption></figure>

**vtysh** 命令将带我们进入 FRR 路由器控制面板。
```
~$ sudo vtysh
```
```markdown
# EIGRP Attacks

EIGRP (Enhanced Interior Gateway Routing Protocol) is a Cisco proprietary routing protocol. It is commonly used in enterprise networks and can be a target for various attacks.

## Types of EIGRP Attacks

### Route Injection

Attackers can inject malicious routes into an EIGRP-enabled network to redirect traffic or create routing loops.

### Neighbor Shutdown

An attacker can send a spoofed EIGRP packet to a router, causing it to reset its neighbor relationship, leading to a denial of service.

### Reconnaissance

By passively listening to EIGRP traffic, an attacker can gain valuable information about the network topology.

## Mitigation Techniques

To protect against EIGRP attacks, consider the following measures:

- Implement authentication on all EIGRP routers.
- Use access control lists (ACLs) to filter EIGRP traffic.
- Employ prefix lists to prevent route injection.
- Regularly update and patch routers to fix vulnerabilities.

## Tools for EIGRP Attacks

Several tools can facilitate EIGRP attacks, including:

- **Yersinia**: A network tool designed to take advantage of some weaknesses in different network protocols.
- **GNS3**: A network software emulator that allows the combination of virtual and real devices to simulate complex networks.
- **Wireshark**: A network protocol analyzer that can capture and interactively browse the traffic running on a computer network.
```
```markdown
# EIGRP 攻击

EIGRP（增强型内部网关路由协议）是 Cisco 的专有路由协议。它通常用于企业网络，并且可能成为各种攻击的目标。

## EIGRP 攻击类型

### 路由注入

攻击者可以向启用 EIGRP 的网络中注入恶意路由，以重定向流量或创建路由循环。

### 邻居关闭

攻击者可以发送伪造的 EIGRP 数据包给路由器，导致它重置其邻居关系，从而导致服务拒绝。

### 侦察

通过被动监听 EIGRP 流量，攻击者可以获得有关网络拓扑的宝贵信息。

## 缓解技术

为了防范 EIGRP 攻击，请考虑以下措施：

- 在所有 EIGRP 路由器上实施认证。
- 使用访问控制列表（ACLs）过滤 EIGRP 流量。
- 使用前缀列表防止路由注入。
- 定期更新和修补路由器以修复漏洞。

## EIGRP 攻击工具

有几种工具可以促进 EIGRP 攻击，包括：

- **Yersinia**：一个网络工具，旨在利用不同网络协议中的一些弱点。
- **GNS3**：一个网络软件仿真器，允许虚拟和真实设备的组合来模拟复杂网络。
- **Wireshark**：一个网络协议分析器，可以捕获并交互式浏览计算机网络上的流量。
```
```
Inguz# show version
```
```markdown
> **但是，不要忘记EIGRP路由域可以通过认证来保护。但你仍然有机会连接到路由域。当hello数据包被发送出去时，它们也包含了加密哈希。如果你能从流量转储中提取这些哈希并重置密码，你就可以使用这个密码登录到路由域。**

进入全局配置模式并启动**EIGRP**进程，指定自治系统号码 — **1**

我们还需要声明我们所在的网络。我们位于10.10.100.0/24。我的地址是10.10.100.50/32
```
```
Inguz# configInguz(config)# router eigrp 1Inguz(config-router) network 10.10.100.50/32
```
在建立合法EIGRP路由器之间的邻接关系后，我的网络上有两个这样的路由器：

* **GW1 (10.10.100.100)**
* **GW2 (10.10.100.200)**

与GW1 (10.10.100.100) 的EIGRP邻接关系：

<figure><img src="../../.gitbook/assets/image (5) (1) (2).png" alt=""><figcaption></figcaption></figure>

与GW2 (10.10.100.200) 的EIGRP邻接关系：

<figure><img src="../../.gitbook/assets/image (30) (1).png" alt=""><figcaption></figcaption></figure>

在EIGRP路由器之间建立和维护邻接关系期间，路由器会交换它们的路由信息。邻接关系建立后，我们攻击系统的路由表中将出现新的路由，具体如下：

* **10.1.239.0/24 通过 10.10.100.100;**
* **30.30.30.0/24 通过 10.10.100.100;**
* **100.100.100.0/24 通过 10.10.100.100;**
* **172.16.100.0/24 通过 10.10.100.200**

<figure><img src="../../.gitbook/assets/image (29) (1) (2).png" alt=""><figcaption></figcaption></figure>

因此，在建立邻接关系后，我们知道了这些子网的存在，这使我们更容易进行渗透测试并节省时间。我们可以不需要进行额外的子网扫描。现在我们处于EIGRP路由域中，我们可以开发一些攻击向量。让我们来谈谈它们。

### 伪造EIGRP邻居 <a href="#51ee" id="51ee"></a>

**我发现生成并快速发送大量EIGRP hello数据包会使路由器的CPU负载过高，这反过来可能会导致DoS攻击。** 我开发了一个小的[**helloflooding.py**](https://github.com/in9uz/EIGRPWN/blob/main/helloflooding.py)脚本，但我觉得脚本发送数据包的速度不够快。**这是由于GIL造成的**，它阻止了**sprayhello**函数每秒在多个线程中运行。**最终我会用C语言重写这个脚本。**

<figure><img src="../../.gitbook/assets/image (2) (6) (1).png" alt=""><figcaption></figcaption></figure>

脚本的参数：

* **攻击系统的接口（eth0）;**
* **EIGRP自治系统号（1）;**
* **攻击系统所在的子网。在我的案例中，子网是10.10.100.0/24**
```
~$ sudo python3 helloflooding.py --interface eth0 --as 1 --subnet 10.10.100.0/24
```
### EIGRP 黑洞攻击 <a href="#5c04" id="5c04"></a>

这种攻击的本质是简单地注入一个假路由，这将污染路由表。流量到达**例如** `10.10.100.0/24` **网络将无处可去，导致服务拒绝。这种攻击被称为黑洞。** 脚本 [**routeinject.py**](https://github.com/in9uz/EIGRPWN/blob/main/routeinject.py) **** 将被用来执行它。在这个例子中，我将把目的地为主机 `172.16.100.140/32` 的流量发送到黑洞。

脚本参数：

* **攻击系统的接口**
* **EIGRP AS 号码**
* **攻击者的 IP 地址**
* **目标子网的 IP 地址，其流量将被发送到黑洞**
* **目标子网掩码**
```
~$ sudo python3 routeinject.py --interface eth0 --as 1 --src 10.10.100.50 --dst 172.16.100.140 --prefix 32
```
<figure><img src="../../.gitbook/assets/image (20) (1).png" alt=""><figcaption></figcaption></figure>

**我们的主机似乎遇到麻烦了 :)**

<figure><img src="../../.gitbook/assets/image (6) (1) (1).png" alt=""><figcaption></figcaption></figure>

如您所见，由于路由注入，主机失去了与主机 **172.16.100.140/32** 的连接。

### 滥用 K-值 <a href="#25aa" id="25aa"></a>

为了建立 EIGRP 邻居，**路由器使用特殊的 K-值。** 它们必须在所有 EIGRP 邻居之间相同。如果至少有一个 K-值不匹配，EIGRP 域将崩溃，邻居关系将被破坏。我们将使用 [**relationshipnightmare.py**](https://github.com/in9uz/EIGRPWN/blob/main/relationshipnightmare.py) \*\*\*\* 来执行这个攻击\*\*。\*\*

<figure><img src="../../.gitbook/assets/image (12) (2) (1).png" alt=""><figcaption></figcaption></figure>

脚本参数：

* **网络接口**
* **EIGRP AS 号码**
* **合法路由器的 IP 地址**

**代表指定的 IP，将在多播 EIGRP IP 地址上发送注入，其中 K-值是不同的。** 在我的案例中，我将代表路由器 GW1 **(地址是 10.10.100.100)** 破坏邻居关系。
```
~$ sudo python3 relationshipnightmare.py --interface eth0 --as 1 --src 10.10.100.100
```
<figure><img src="../../.gitbook/assets/image (9) (1) (4).png" alt=""><figcaption><p>邻居关系中断期间的流量转储</p></figcaption></figure>

<figure><img src="../../.gitbook/assets/image (27) (1).png" alt=""><figcaption><p>GW1 路由器不断断开并重新连接 EIGRP</p></figcaption></figure>

**这种方式可以执行 DoS 攻击。在操作期间，会不断发生中断和邻居尝试，使部分 EIGRP 路由域瘫痪。**

### 路由表溢出 <a href="#1d0c" id="1d0c"></a>

这种攻击的本质是引发发送大量假路由，这将导致路由表溢出。这耗尽了路由器的计算资源，即 CPU 和 RAM，因为注入发生的速度非常快。这种攻击是通过 [**routingtableoverflow.py**](https://github.com/in9uz/EIGRPWN/blob/main/routingtableoverflow.py) **脚本** 实现的

<figure><img src="../../.gitbook/assets/image (3) (4).png" alt=""><figcaption></figcaption></figure>

脚本参数

* **网络接口**
* **EIGRP AS 号码**
* **攻击者的 IP 地址**
```
in9uz@Inguz:~$ sudo python3 routingtableoverflow.py --interface eth0 --as 1 --src 10.10.100.50
```
```markdown
执行脚本后，路由表开始溢出路由。目标网络的随机地址是由于在 [**Scapy**](https://github.com/secdev/scapy) 中使用了 **RandIP()**。

<figure><img src="../../.gitbook/assets/image (4) (4).png" alt=""><figcaption><p>GW1 路由器的路由表溢出</p></figcaption></figure>

<figure><img src="../../.gitbook/assets/image (21) (1).png" alt=""><figcaption><p>路由器 CPU 负载过重</p></figcaption></figure>

<details>

<summary><strong>从零开始学习 AWS 黑客攻击成为英雄，通过</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS 红队专家)</strong></a><strong>！</strong></summary>

支持 HackTricks 的其他方式：

* 如果您想在 **HackTricks** 中看到您的**公司广告**或**下载 HackTricks 的 PDF**，请查看 [**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取 [**官方 PEASS & HackTricks 商品**](https://peass.creator-spring.com)
* 发现 [**PEASS 家族**](https://opensea.io/collection/the-peass-family)，我们独家的 [**NFTs**](https://opensea.io/collection/the-peass-family) 收藏
* **加入** 💬 [**Discord 群组**](https://discord.gg/hRep4RUj7f) 或 [**telegram 群组**](https://t.me/peass) 或在 **Twitter** 🐦 上**关注**我 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **通过向 [**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github 仓库提交 PR 来分享您的黑客技巧。**

</details>
```
