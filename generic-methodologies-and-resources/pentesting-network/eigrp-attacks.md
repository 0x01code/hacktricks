# EIGRP 攻撃

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks Cloud ☁️</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>🐦 Twitter 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 Youtube 🎥</strong></a></summary>

* **サイバーセキュリティ企業**で働いていますか？ **HackTricks で会社を宣伝**したいですか？または、**最新バージョンの PEASS を入手したり、HackTricks を PDF でダウンロード**したいですか？[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を見つけてください。独占的な [**NFT**](https://opensea.io/collection/the-peass-family) のコレクションです。
* [**公式の PEASS & HackTricks スワッグ**](https://peass.creator-spring.com)を手に入れましょう。
* [**💬**](https://emojipedia.org/speech-balloon/) [**Discord グループ**](https://discord.gg/hRep4RUj7f) または [**telegram グループ**](https://t.me/peass) に参加するか、**Twitter** [**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)** をフォローしてください。**
* **ハッキングのトリックを共有するには、PR を** [**hacktricks リポジトリ**](https://github.com/carlospolop/hacktricks) **と** [**hacktricks-cloud リポジトリ**](https://github.com/carlospolop/hacktricks-cloud) **に提出してください。**

</details>

**このページは** [**https://medium.com/@in9uz/cisco-nightmare-pentesting-cisco-networks-like-a-devil-f4032eb437b9**](https://medium.com/@in9uz/cisco-nightmare-pentesting-cisco-networks-like-a-devil-f4032eb437b9) **からコピーされました**\*\*\*\*

## EIGRP プロトコルの攻撃 <a href="#0f82" id="0f82"></a>

**EIGRP（Enhanced Interior Gateway Routing Protocol）**は、動的ルーティングプロトコルです。**距離ベクトルプロトコルです。** **認証やパッシブインターフェースの設定がない場合、侵入者は EIGRP ルーティングに干渉し、ルーティングテーブルの汚染を引き起こすことができます。** **さらに、EIGRP ネットワーク（つまり、自律システム）はフラットで、任意のゾーンにセグメント化されていません。** これは攻撃者にとってどういう意味があるでしょうか？まあ、彼がルートを注入すれば、このルートは自律 EIGRP システム全体に広がる可能性が高いです。

<figure><img src="../../.gitbook/assets/image (25) (1).png" alt=""><figcaption></figcaption></figure>

まず最初に、スタンドアロンの EIGRP システムを攻撃するには、正当な EIGRP ルーターとの隣接関係を確立する必要があります。これにより、基本的な偵察からさまざまな注入まで、多くの可能性が開かれます。

そのために、[**FRRouting**](https://frrouting.org/) を使用します。これは、Unix と Linux でルーターを作成するために設計されたオープンソースソフトウェアです。**FRRouting** は、**BGP、OSPF、EIGRP、RIP などのプロトコルをサポートする仮想ルーターを実装することができます。** 攻撃者のシステムに展開するだけで、実際には正当なルーターとしてルーティングドメイン内で振る舞うことができます。次のセクションでは、システムに FRR を展開する方法を紹介します。

### ネットワークインテリジェンス <a href="#41e6" id="41e6"></a>

**ルーティングドメインに接続することで、ネットワークの列挙と偵察を行い、多くの時間をスキャンに費やす必要がありません。** この方法は、貴重な時間を節約します。**また、スキャンによって、IPS/IDS セキュリティシステムの前で燃え尽きる可能性があります。** 私にとって、ドメインへの接続と列挙は、最も影響力のあるルーティングドメインへの攻撃ベクトルです。しかし、これを行うには **FRRouting** を展開する必要があります。さあ、始めましょう。

**設定ファイル daemons を編集する必要があります。** これには、デーモンの設定が含まれています。デーモンは、その活動の文脈での設定を持っています。有効（yes）または無効（no）のいずれかです。**eigrpd** デーモンを有効にする必要があります。
```
~# nano /etc/frr/daemons
eigrpd=yes
```
<figure><img src="../../.gitbook/assets/image (15) (1).png" alt=""><figcaption></figcaption></figure>

その後、**vtysh.conf**ファイルを修正する必要があります。これにより、異なるプロトコルの設定が異なるファイルに分散しないように、設定を1つのファイルに保存するための行が追加されます **（例：eigrpd.conf、staticd.conf）。** これはオプションで設定可能です。
```
~# nano /etc/frr/vtysh.conf
service integrated-vtysh-config
```
FRRoutingの設定が完了しました。今度はFRRデーモンを実行する時です。そして、はい、トラフィックルーティングを有効にする必要があります。デフォルトではLinuxディストリビューションでは無効になっています。
```
~$ sudo systemctl start frr
~$ sudo sysctl -w net.ipv4.ip_forward=1
```
<figure><img src="../../.gitbook/assets/image (32).png" alt=""><figcaption></figcaption></figure>

**vtysh**コマンドを使用すると、FRRルーターの制御パネルに移動できます。
```
~$ sudo vtysh
```
# EIGRP Attacks

EIGRP (Enhanced Interior Gateway Routing Protocol) is a Cisco proprietary routing protocol used to exchange routing information within a network. As a pentester, it is important to understand EIGRP and its potential vulnerabilities in order to identify and exploit them during a penetration test.

## EIGRP Protocol Overview

EIGRP is a distance vector routing protocol that uses the Diffusing Update Algorithm (DUAL) to calculate the best path for routing packets. It operates at the Network layer (Layer 3) of the OSI model and supports both IPv4 and IPv6.

EIGRP uses a hierarchical network design, where routers are organized into autonomous systems (AS). Each AS is further divided into multiple areas, and routers within an area exchange routing information using EIGRP.

## EIGRP Attacks

1. **EIGRP Neighbor Spoofing**: An attacker can spoof EIGRP neighbor advertisements to trick a router into establishing a neighbor relationship with a malicious device. Once the relationship is established, the attacker can manipulate routing information or launch further attacks.

2. **EIGRP Route Manipulation**: By injecting false routing information into the EIGRP network, an attacker can manipulate the routing table of routers within the network. This can lead to traffic redirection, network congestion, or even denial of service (DoS) attacks.

3. **EIGRP Authentication Bypass**: EIGRP supports authentication mechanisms to ensure the integrity and authenticity of routing updates. However, misconfigurations or weak authentication settings can allow an attacker to bypass authentication and inject malicious routing updates.

4. **EIGRP Protocol Vulnerabilities**: Like any other protocol, EIGRP may have vulnerabilities that can be exploited by attackers. It is important to stay updated with the latest security advisories and patches from Cisco to mitigate these vulnerabilities.

## Countermeasures

To protect against EIGRP attacks, consider implementing the following countermeasures:

1. **EIGRP Authentication**: Enable authentication for EIGRP to ensure that only trusted routers can exchange routing information. Use strong authentication methods, such as MD5 or SHA-256, and regularly update authentication keys.

2. **Access Control**: Implement proper access control mechanisms to prevent unauthorized access to routers and network devices. This includes securing physical access, using strong passwords, and disabling unnecessary services.

3. **Network Segmentation**: Divide the network into smaller segments using VLANs or subnets. This helps contain the impact of an EIGRP attack and limits the attacker's ability to move laterally within the network.

4. **Regular Auditing**: Perform regular audits of EIGRP configurations and network devices to identify any misconfigurations or vulnerabilities. This includes reviewing access control lists, monitoring routing tables, and analyzing network traffic.

By understanding EIGRP and its potential vulnerabilities, pentesters can effectively assess the security of a network and recommend appropriate countermeasures to mitigate risks.
```
Inguz# show version
```
<figure><img src="../../.gitbook/assets/image (3) (2) (2).png" alt=""><figcaption></figcaption></figure>

> **ただし、EIGRPルーティングドメインは認証によって保護される可能性があることを忘れないでください。ただし、ルーティングドメインに接続するチャンスはまだあります。ハローパケットが送信されるとき、それらには暗号ハッシュも含まれています。トラフィックダンプからこれらのハッシュを抽出し、パスワードをリセットすることができれば、このパスワードでルーティングドメインにログインできます。**

グローバル設定モードに移動し、**EIGRP**プロセスを開始します。自律システム番号を指定します - **1**

また、私たちがいるネットワークも宣言する必要があります。私たちは10.10.100.0/24にいます。私のアドレスは10.10.100.50/32です。
```
Inguz# configInguz(config)# router eigrp 1Inguz(config-router) network 10.10.100.50/32
```
その後、正当なEIGRPルーター間のネイバーリングが確立されます。私のネットワークには2つのルーターがあります：

- **GW1（10.10.100.100）**
- **GW2（10.10.100.200）**

GW1（10.10.100.100）とのEIGRPネイバーリング：

<figure><img src="../../.gitbook/assets/image (5) (1) (2).png" alt=""><figcaption></figcaption></figure>

GW2（10.10.100.200）とのEIGRPネイバーリング：

<figure><img src="../../.gitbook/assets/image (30) (1).png" alt=""><figcaption></figcaption></figure>

EIGRPルーター間のネイバーリングの確立と維持中、ルーターはルーティング情報を交換します。ネイバーリングが確立された後、攻撃システムのルーティングテーブルに新しいルートが表示されます。具体的には：

- **10.1.239.0/24は10.10.100.100を経由して;**
- **30.30.30.0/24は10.10.100.100を経由して;**
- **100.100.100.0/24は10.10.100.100を経由して;**
- **172.16.100.0/24は10.10.100.200を経由して**

<figure><img src="../../.gitbook/assets/image (29) (1) (2).png" alt=""><figcaption></figcaption></figure>

したがって、ネイバーリングが確立された後、これらのサブネットの存在を知ることができます。これにより、サブネットのスキャンなしでペントテストを行うことができ、時間を節約することができます。これでEIGRPルーティングドメインにいますので、いくつかの攻撃ベクトルを開発することができます。それについて話しましょう。

### 偽のEIGRPネイバー <a href="#51ee" id="51ee"></a>

**大量のEIGRPハローパケットを生成して迅速に送信することで、ルーターのCPUを過負荷にすることができ、それによりDoS攻撃の可能性が開かれます。**私は少しの[**helloflooding.py**](https://github.com/in9uz/EIGRPWN/blob/main/helloflooding.py)スクリプトを開発しましたが、パケットの送信速度が足りないように思えます。これはGILによるもので、**sprayhello**関数が秒間複数のスレッドで実行されないためです。**最終的にはCでスクリプトを書き直す予定です。**

<figure><img src="../../.gitbook/assets/image (2) (6) (1).png" alt=""><figcaption></figcaption></figure>

スクリプトの引数：

- **攻撃システムのインターフェース（eth0）;**
- **EIGRP自律システム番号（1）;**
- **攻撃システムが存在するサブネット。私の場合、サブネットは10.10.100.0/24です**
```
~$ sudo python3 helloflooding.py --interface eth0 --as 1 --subnet 10.10.100.0/24
```
<figure><img src="../../.gitbook/assets/image (26) (1).png" alt=""><figcaption></figcaption></figure>

### EIGRPブラックホール <a href="#5c04" id="5c04"></a>

この攻撃の本質は、ルーティングテーブルを毒化する偽のルートの単純なインジェクションです。**例えば、`10.10.100.0/24`ネットワークへのトラフィックはどこにも行かず、サービス拒否を引き起こします。このような攻撃はブラックホールと呼ばれます。**この攻撃を実行するために使用されるツールは、[**routeinject.py**](https://github.com/in9uz/EIGRPWN/blob/main/routeinject.py)です。この例では、ホスト`172.16.100.140/32`へのトラフィックをブラックホールに送信します。

<figure><img src="../../.gitbook/assets/image (16) (1).png" alt=""><figcaption></figcaption></figure>

スクリプトの引数:

* **攻撃システムのインターフェース**
* **EIGRP AS番号**
* **攻撃者のIPアドレス**
* **トラフィックがブラックホールに送信されるターゲットサブネットのIPアドレス**
* **ターゲットサブネットのサブネットマスク**
```
~$ sudo python3 routeinject.py --interface eth0 --as 1 --src 10.10.100.50 --dst 172.16.100.140 --prefix 32
```
<figure><img src="../../.gitbook/assets/image (20) (1).png" alt=""><figcaption></figcaption></figure>

**私たちのホストはトラブルに見舞われているようです :)**

<figure><img src="../../.gitbook/assets/image (6) (1) (1).png" alt=""><figcaption></figcaption></figure>

ご覧の通り、ホストは**172.16.100.140/32**への接続性をルートインジェクションによって失っています。

### K-Valuesの乱用 <a href="#25aa" id="25aa"></a>

EIGRPの隣接関係を確立するために、**ルーターは特別なK-Valuesを使用します。**これらはすべてのEIGRPの隣接関係で同じでなければなりません。少なくとも1つのK-Valueが一致しない場合、EIGRPドメインはクラッシュし、隣接関係が壊れます。この攻撃を実行するために、[**relationshipnightmare.py**](https://github.com/in9uz/EIGRPWN/blob/main/relationshipnightmare.py)を使用します\*\*.\*\*

<figure><img src="../../.gitbook/assets/image (12) (2) (1).png" alt=""><figcaption></figcaption></figure>

スクリプトの引数:

* **ネットワークインターフェース**
* **EIGRP AS番号**
* **正規のルーターのIPアドレス**

**指定されたIPの代わりに、異なるK-Valuesが含まれるマルチキャストEIGRP IPアドレスにインジェクトが送信されます。**私の場合、ルーターGW1の代わりにネイバーフッドを壊します **(アドレスは10.10.100.100です)**。
```
~$ sudo python3 relationshipnightmare.py --interface eth0 --as 1 --src 10.10.100.100
```
<figure><img src="../../.gitbook/assets/image (9) (1) (4).png" alt=""><figcaption><p>隣接障害発生時のトラフィックのダンプ</p></figcaption></figure>

<figure><img src="../../.gitbook/assets/image (27) (1).png" alt=""><figcaption><p>GW1ルーターがEIGRPを切断し続ける</p></figcaption></figure>

**この方法でDoS攻撃が行われることがあります。操作中には、切断と隣接試行が絶え間なく発生し、EIGRPルーティングドメインの一部が麻痺します。**

### ルーティングテーブルのオーバーフロー <a href="#1d0c" id="1d0c"></a>

この攻撃の本質は、大量の偽のルートを送信させ、ルーティングテーブルをオーバーフローさせることです。これにより、ルーターの計算リソースであるCPUとRAMが枯渇します。なぜなら、インジェクションは非常に高速に行われるからです。この攻撃は[**routingtableoverflow.py**](https://github.com/in9uz/EIGRPWN/blob/main/routingtableoverflow.py) **スクリプト**で実装されます。

<figure><img src="../../.gitbook/assets/image (3) (4).png" alt=""><figcaption></figcaption></figure>

スクリプトの引数

* **ネットワークインターフェース**
* **EIGRP AS番号**
* **攻撃者のIPアドレス**
```
in9uz@Inguz:~$ sudo python3 routingtableoverflow.py --interface eth0 --as 1 --src 10.10.100.50
```
スクリプトを実行すると、ルーティングテーブルがルートで溢れ始めます。ターゲットネットワークのランダムなアドレスは、[Scapy](https://github.com/secdev/scapy)の**RandIP()**の使用によるものです。

<figure><img src="../../.gitbook/assets/image (4) (4).png" alt=""><figcaption><p>GW1ルーターでのルーティングテーブルのオーバーフロー</p></figcaption></figure>

<figure><img src="../../.gitbook/assets/image (21) (1).png" alt=""><figcaption><p>過負荷のルーターCPU</p></figcaption></figure>

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks Cloud ☁️</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>🐦 Twitter 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 Youtube 🎥</strong></a></summary>

* **サイバーセキュリティ企業で働いていますか？** **HackTricksで会社を宣伝**したいですか？または、**PEASSの最新バージョンやHackTricksのPDFをダウンロード**したいですか？[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を見つけてください。独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクションです。
* [**公式のPEASS＆HackTricksのグッズ**](https://peass.creator-spring.com)を手に入れましょう。
* [**💬**](https://emojipedia.org/speech-balloon/) [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**Telegramグループ**](https://t.me/peass)に**参加**するか、**Twitter**で**フォロー**してください[**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**。**
* **ハッキングのトリックを共有するには、**[**hacktricks repo**](https://github.com/carlospolop/hacktricks) **と** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **にPRを提出してください。**

</details>
