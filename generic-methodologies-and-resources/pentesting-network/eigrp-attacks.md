# EIGRP攻撃

<details>

<summary><strong>**htARTE（HackTricks AWS Red Team Expert）**で**ゼロからヒーローまでAWSハッキングを学ぶ**</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>こちら</strong></a><strong>！</strong></summary>

HackTricksをサポートする他の方法:

* **HackTricksで企業を宣伝したい**または**HackTricksをPDFでダウンロードしたい**場合は[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS＆HackTricksグッズ**](https://peass.creator-spring.com)を入手する
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFT**](https://opensea.io/collection/the-peass-family)コレクションを見る
* **💬 [Discordグループ](https://discord.gg/hRep4RUj7f)**に参加するか、[telegramグループ](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)をフォローする。
* **ハッキングトリックを共有するには、**[**HackTricks**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のGitHubリポジトリにPRを提出してください。

</details>

**このページは** [****](https://medium.com/@in9uz/cisco-nightmare-pentesting-cisco-networks-like-a-devil-f4032eb437b9) **に基づいています。詳細についてはそちらをご確認ください。**

## EIGRPプロトコルの脆弱性の理解 <a href="#0f82" id="0f82"></a>

**EIGRP（Enhanced Interior Gateway Routing Protocol）**は、動的なディスタンスベクトルルーティングプロトコルとして識別されています。認証やパッシブインターフェースの構成が無視されると、潜在的なルーティングテーブルの毒入れが発生する重大な脆弱性が観察されます。さらに、EIGRPネットワークまたは自律システムの構造は、ゾーンの区分の形式を欠いた非セグメント化されています。このフラットな構造は、攻撃者によって注入されたルートが自律システム全体に伝播する可能性があることを意味します。

![](../../.gitbook/assets/image (25) (1).png)

EIGRPシステムを悪用する最初のステップは、正規のEIGRPルーターとの接続を確立することです。この接続により、偵察からさまざまな形式のインジェクションまでの手段が開かれます。これを実現するために、UnixおよびLinuxシステム上のルーターをエミュレートするために、オープンソースのソリューションである[**FRRouting**](https://frrouting.org/)が利用されます。**FRRouting**は、BGP、OSPF、EIGRPを含む複数のプロトコルをサポートしています。攻撃者のシステムにFRRoutingを展開することで、ルーティングドメイン内で正規のルーターを模倣することが可能となります。システムにFRRを展開するための詳細な手順については後述します。

### ネットワークインテリジェンスの収集 <a href="#41e6" id="41e6"></a>

ルーティングドメインへの統合により、ネットワークの列挙と偵察が可能となり、広範なスキャンに比べて時間を節約できるだけでなく、IPS/IDSセキュリティシステムによる検出リスクを軽減できます。これを実現するには、**FRRouting**の展開が必要です。

デーモンのアクティビティを制御する`daemons`構成ファイルで変更が必要です。**eigrpd**デーモンのアクティベーションが必要です。
```bash
~# nano /etc/frr/daemons
eigrpd=yes
```
![](../../.gitbook/assets/image (15) (1).png)

さらに、さまざまなプロトコルの設定が1つのファイルに統合されるように、**vtysh.conf**ファイルを調整する必要があります。
```bash
~# nano /etc/frr/vtysh.conf
service integrated-vtysh-config
```
Post-configuration、FRRデーモンの起動とトラフィックルーティングの有効化（Linuxディストリビューションではデフォルトで無効になっています）が必要です。
```bash
~$ sudo systemctl start frr
~$ sudo sysctl -w net.ipv4.ip_forward=1
```
![](../../.gitbook/assets/image (32).png)

**vtysh**コマンドはFRRルーターのコントロールパネルへのアクセスを提供します。
```bash
~$ sudo vtysh
```
例:
```bash
root# show version
```
> ノート: EIGRP ルーティングドメインは認証で保護されているかもしれません。ただし、ハローパケットから暗号ハッシュを抽出してパスワードをリセットすることで、潜在的なアクセスが依然として可能です。

グローバル構成モードで、**EIGRP** プロセスを開始し、自律システム番号を **1** と定義し、ネットワークの場所を指定します。
```bash
root# config
root(config)# router eigrp 1
root(config-router) network 10.10.100.50/32
```
EIGRPルーターとの正当な隣接接続の確立後（この場合、**GW1（10.10.100.100）**および**GW2（10.10.100.200）**）、ルーターはルーティング情報を交換します。 このプロセスにより、攻撃システムのルーティングテーブルに新しいルートが表示され、ペネトレーションテストを支援し、サブネットスキャンにかかる時間を節約します。 この段階では、システムはEIGRPルーティングドメインの一部となり、さらなる攻撃ベクトルの開発に備えています。

![](../../.gitbook/assets/image (5) (1) (2).png)
![](../../.gitbook/assets/image (30) (1).png)
![](../../.gitbook/assets/image (29) (1) (2).png)

### EIGRPの悪用: 攻撃ベクトル <a href="#51ee" id="51ee"></a>

#### 1. 偽のEIGRP隣接
EIGRPハローパケットの大量送信は、ルーターのCPU過負荷を引き起こし、DoS攻撃の道を開く可能性があります。 このために**helloflooding.py**スクリプトが使用されますが、そのパケット送信速度はGIL（Global Interpreter Lock）によって制限されています。 性能向上のためにスクリプトをC言語で書き直す計画が進行中です。

![](../../.gitbook/assets/image (2) (6) (1).png)

スクリプトの使用には、次の指定が必要です：
- ネットワークインターフェース（例：eth0）
- EIGRP自律システム番号（例：1）
- サブネットの場所（例：10.10.100.0/24）
```bash
~$ sudo python3 helloflooding.py --interface eth0 --as 1 --subnet 10.10.100.0/24
```
#### 2. EIGRPブラックホール
この攻撃は、一般的にブラックホール攻撃と呼ばれる、トラフィックフローを妨害するために偽のルートを注入する攻撃です。この目的のために**routeinject.py**スクリプトが使用されます。例えば、`172.16.100.140/32`へのトラフィックを存在しない宛先にリダイレクトすることがあります。

スクリプトのパラメータには次のものが含まれます：
- 攻撃者のシステムインターフェース
- EIGRP AS番号
- 攻撃者のIPアドレス
- ターゲットサブネットIPとそのマスク
```bash
~$ sudo python3 routeinject.py --interface eth0 --as 1 --src 10.10.100.50 --dst 172.16.100.140 --prefix 32
```
![](../../.gitbook/assets/image (20) (1).png)

ターゲットホストへの接続がルートインジェクションによって失われる結果となります。

![](../../.gitbook/assets/image (6) (1) (1).png)

#### 3. K-Valuesの悪用
EIGRPルーター間でのK-Valuesの不一致は、EIGRPドメインを混乱させる可能性があります。**relationshipnightmare.py**スクリプトは、変更されたK-Valuesを注入してEIGRPドメイン内で連続的な混乱と再接続を引き起こし、実質的にDoS攻撃を引き起こします。

![](../../.gitbook/assets/image (12) (2) (1).png)

スクリプトには以下が必要です：
- ネットワークインターフェース
- EIGRP AS番号
- 正規のルーターのIPアドレス

指定されたIPからマルチキャストEIGRP IPアドレスに送信される注入された変更により、不一致が引き起こされます。
```bash
~$ sudo python3 relationshipnightmare.py --interface eth0 --as 1 --src 10.10.100.100
```
![](../../.gitbook/assets/image (9) (1) (4).png)
![](../../.gitbook/assets/image (27) (1).png)

#### 4. ルーティングテーブルオーバーフロー
この攻撃は、偽のルートでルーティングテーブルを氾濫させ、ルーターのCPUとRAMを過負荷にします。**routingtableoverflow.py**スクリプトは、多数の偽のルートを迅速に送信することでこれを容易にします。

![](../../.gitbook/assets/image (3) (4).png)

スクリプトのパラメータ:
- ネットワークインターフェース
- EIGRP AS番号
- 攻撃者のIPアドレス

スクリプトを実行すると、ルーティングテーブルが不正なルートで満たされ、ルーターのパフォーマンスに深刻な影響を与えます。
```bash
sudo python3 routingtableoverflow.py --interface eth0 --as 1 --src 10.10.100.50
```
![](../../.gitbook/assets/image (4) (4).png)
![](../../.gitbook/assets/image (21) (1).png)

<details>

<summary><strong>ゼロからヒーローまでのAWSハッキングを学ぶ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE（HackTricks AWS Red Team Expert）</strong></a><strong>！</strong></summary>

HackTricksをサポートする他の方法：

* **HackTricksで企業を宣伝したい**または**HackTricksをPDFでダウンロードしたい**場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS＆HackTricksのグッズ**](https://peass.creator-spring.com)を入手する
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクションを見つける
* **💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**telegramグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**をフォローする。**
* **HackTricks**と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のgithubリポジトリにPRを提出して、あなたのハッキングトリックを共有する。

</details>
