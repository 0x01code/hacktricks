# Ataques EIGRP

<details>

<summary><strong>Aprenda hacking no AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ quer ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**material oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **Junte-se ao grupo** üí¨ [**Discord**](https://discord.gg/hRep4RUj7f) ou ao grupo [**telegram**](https://t.me/peass) ou **siga**-me no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios github do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

**Esta p√°gina √© baseada em** [****](https://medium.com/@in9uz/cisco-nightmare-pentesting-cisco-networks-like-a-devil-f4032eb437b9). Confira para mais informa√ß√µes.

## Compreendendo as Vulnerabilidades do Protocolo EIGRP <a href="#0f82" id="0f82"></a>

**EIGRP (Enhanced Interior Gateway Routing Protocol)** √© identificado como um protocolo de roteamento din√¢mico do tipo vetor-dist√¢ncia. Uma vulnerabilidade cr√≠tica √© observada se a autentica√ß√£o ou configura√ß√£o de interfaces passivas s√£o negligenciadas, levando ao poss√≠vel envenenamento de tabelas de roteamento. Al√©m disso, a estrutura da rede EIGRP, ou sistema aut√¥nomo, √© n√£o segmentada, sem qualquer forma de divis√µes de zona. Esta estrutura plana implica que rotas injetadas por um atacante poderiam se propagar por todo o sistema aut√¥nomo.

![](../../.gitbook/assets/image (25) (1).png)

O primeiro passo para explorar um sistema EIGRP envolve estabelecer uma conex√£o com um roteador EIGRP leg√≠timo. Esta conex√£o abre caminhos que v√£o desde reconhecimento at√© v√°rias formas de inje√ß√µes. Para facilitar isso, [**FRRouting**](https://frrouting.org/), uma solu√ß√£o de c√≥digo aberto, √© utilizada para emular um roteador em sistemas Unix e Linux. **FRRouting** suporta m√∫ltiplos protocolos incluindo BGP, OSPF e EIGRP. A implanta√ß√£o do FRRouting no sistema de um atacante permite que eles imitem um roteador leg√≠timo dentro do dom√≠nio de roteamento. Instru√ß√µes detalhadas para a implanta√ß√£o do FRR no seu sistema ser√£o fornecidas a seguir.

### Coletando Intelig√™ncia de Rede <a href="#41e6" id="41e6"></a>

A integra√ß√£o no dom√≠nio de roteamento permite a enumera√ß√£o e reconhecimento de redes, oferecendo uma alternativa eficiente em termos de tempo para varreduras extensas. Esta abordagem n√£o s√≥ economiza tempo, mas tamb√©m mitiga o risco de detec√ß√£o por sistemas de seguran√ßa IPS/IDS. Para alcan√ßar isso, √© necess√°ria a implanta√ß√£o do **FRRouting**.

Modifica√ß√µes s√£o necess√°rias no arquivo de configura√ß√£o `daemons`, que controla as atividades dos daemons. A ativa√ß√£o do daemon **eigrpd** √© necess√°ria.
```bash
~# nano /etc/frr/daemons
eigrpd=yes
```
![](../../.gitbook/assets/image (15) (1).png)

Al√©m disso, ajustes no arquivo **vtysh.conf** s√£o necess√°rios para garantir que as configura√ß√µes de v√°rios protocolos sejam consolidadas em um √∫nico arquivo.
```bash
~# nano /etc/frr/vtysh.conf
service integrated-vtysh-config
```
Ap√≥s a configura√ß√£o, a inicia√ß√£o do daemon FRR e a ativa√ß√£o do roteamento de tr√°fego (desativado por padr√£o em distribui√ß√µes Linux) s√£o necess√°rias.
```bash
~$ sudo systemctl start frr
~$ sudo sysctl -w net.ipv4.ip_forward=1
```
```markdown
![](../../.gitbook/assets/image (32).png)

O comando **vtysh** fornece acesso ao painel de controle do roteador FRR.
```
```bash
~$ sudo vtysh
```
Exemplo de uso:
```bash
root# show version
```
```markdown
![](../../.gitbook/assets/image (3) (2) (2).png)

> Nota: O dom√≠nio de roteamento EIGRP pode ser protegido com autentica√ß√£o. No entanto, ainda √© poss√≠vel obter acesso potencial extraindo hashes criptogr√°ficos de pacotes hello e redefinindo a senha.

No modo de configura√ß√£o global, inicie o processo **EIGRP** e defina o n√∫mero do sistema aut√¥nomo ‚Äî **1**, juntamente com a localiza√ß√£o da rede.
```
```bash
root# config
root(config)# router eigrp 1
root(config-router) network 10.10.100.50/32
```
Ap√≥s o estabelecimento de conex√µes de vizinhan√ßa com roteadores EIGRP leg√≠timos (neste caso, **GW1 (10.10.100.100)** e **GW2 (10.10.100.200)**), os roteadores trocam informa√ß√µes de roteamento. Esse processo resulta no aparecimento de novas rotas na tabela de roteamento do sistema atacante, auxiliando no pentesting e economizando tempo na varredura de sub-redes. Neste est√°gio, o sistema faz parte do dom√≠nio de roteamento EIGRP e est√° pronto para o desenvolvimento de vetores de ataque adicionais.

![](../../.gitbook/assets/image (5) (1) (2).png)
![](../../.gitbook/assets/image (30) (1).png)
![](../../.gitbook/assets/image (29) (1) (2).png)

### Explorando EIGRP: Vetores de Ataque <a href="#51ee" id="51ee"></a>

#### 1. Vizinhos EIGRP Falsos
O envio em massa de pacotes hello EIGRP pode levar √† sobrecarga da CPU nos roteadores, abrindo caminho para ataques DoS. Um script, **helloflooding.py**, √© utilizado para isso, embora sua velocidade de envio de pacotes seja limitada pelo GIL (Global Interpreter Lock). Planos para reescrever o script em C para melhorar o desempenho est√£o em andamento.

![](../../.gitbook/assets/image (2) (6) (1).png)

O uso do script envolve a especifica√ß√£o de:
- Interface de rede (por exemplo, eth0)
- N√∫mero do sistema aut√¥nomo EIGRP (por exemplo, 1)
- Localiza√ß√£o da sub-rede (por exemplo, 10.10.100.0/24)
```bash
~$ sudo python3 helloflooding.py --interface eth0 --as 1 --subnet 10.10.100.0/24
```
#### 2. EIGRP Blackhole
Este ataque envolve a inje√ß√£o de uma rota falsa para interromper o fluxo de tr√°fego, comumente referido como ataque Blackhole. O script **routeinject.py** √© utilizado para esse fim. Por exemplo, redirecionando o tr√°fego para `172.16.100.140/32` para um destino inexistente.

![](../../.gitbook/assets/image (16) (1).png)

Os par√¢metros do script incluem:
- Interface do sistema do atacante
- N√∫mero AS do EIGRP
- Endere√ßo IP do atacante
- IP da sub-rede alvo e sua m√°scara
```bash
~$ sudo python3 routeinject.py --interface eth0 --as 1 --src 10.10.100.50 --dst 172.16.100.140 --prefix 32
```
![](../../.gitbook/assets/image (20) (1).png)

O resultado √© a perda de conectividade com o host alvo devido √† inje√ß√£o de rotas.

![](../../.gitbook/assets/image (6) (1) (1).png)

#### 3. Abusando dos K-Values
Valores de K incompat√≠veis entre roteadores EIGRP podem interromper o dom√≠nio EIGRP. O script **relationshipnightmare.py** explora isso injetando valores de K alterados, desencadeando interrup√ß√µes cont√≠nuas e reconex√µes dentro do dom√≠nio EIGRP, resultando efetivamente em um ataque de DoS.

![](../../.gitbook/assets/image (12) (2) (1).png)

O script requer:
- Interface de rede
- N√∫mero AS EIGRP
- Endere√ßo IP de um roteador leg√≠timo

As altera√ß√µes injetadas s√£o enviadas do IP especificado para o endere√ßo IP multicast EIGRP, causando a incompatibilidade.
```bash
~$ sudo python3 relationshipnightmare.py --interface eth0 --as 1 --src 10.10.100.100
```
#### 4. Sobrecarga da Tabela de Roteamento
Este ataque inunda a tabela de roteamento com rotas falsas, sobrecarregando a CPU e a RAM do roteador. O script **routingtableoverflow.py** facilita isso, enviando rapidamente in√∫meras rotas falsas.

Par√¢metros do script:
- Interface de rede
- N√∫mero AS EIGRP
- Endere√ßo IP do atacante

Ap√≥s a execu√ß√£o do script, a tabela de roteamento fica saturada com rotas esp√∫rias, afetando gravemente o desempenho do roteador.
```bash
sudo python3 routingtableoverflow.py --interface eth0 --as 1 --src 10.10.100.50
```
```markdown
![](../../.gitbook/assets/image (4) (4).png)
![](../../.gitbook/assets/image (21) (1).png)

<details>

<summary><strong>Aprenda hacking no AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ quer ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**material oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **Junte-se ao grupo** üí¨ [**Discord**](https://discord.gg/hRep4RUj7f) ou ao grupo [**telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) no github.

</details>
```
