# Ataques EIGRP

<details>

<summary><strong>Aprenda hacking AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras maneiras de apoiar o HackTricks:

* Se voc√™ deseja ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF** Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**swag oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-nos** no **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para os** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) reposit√≥rios do github.

</details>

**Esta p√°gina √© baseada em** [****](https://medium.com/@in9uz/cisco-nightmare-pentesting-cisco-networks-like-a-devil-f4032eb437b9). Verifique para mais informa√ß√µes.

## Compreens√£o das Vulnerabilidades do Protocolo EIGRP <a href="#0f82" id="0f82"></a>

**EIGRP (Enhanced Interior Gateway Routing Protocol)** √© identificado como um protocolo de roteamento din√¢mico de vetor de dist√¢ncia. Uma vulnerabilidade cr√≠tica √© observada se a autentica√ß√£o ou a configura√ß√£o de interfaces passivas forem negligenciadas, levando a poss√≠veis envenenamentos de tabelas de roteamento. Al√©m disso, a estrutura da rede EIGRP, ou sistema aut√¥nomo, n√£o √© segmentada, faltando qualquer forma de divis√µes de zona. Essa estrutura plana implica que rotas injetadas por um atacante poderiam se propagar por todo o sistema aut√¥nomo.

![](../../.gitbook/assets/image (25) (1).png)

O primeiro passo para explorar um sistema EIGRP envolve estabelecer uma conex√£o com um roteador EIGRP leg√≠timo. Essa conex√£o abre caminhos que v√£o desde a reconhecimento at√© v√°rias formas de inje√ß√µes. Para facilitar isso, [**FRRouting**](https://frrouting.org/), uma solu√ß√£o de c√≥digo aberto, √© utilizada para emular um roteador em sistemas Unix e Linux. **FRRouting** suporta m√∫ltiplos protocolos, incluindo BGP, OSPF e EIGRP. A implanta√ß√£o do FRRouting no sistema de um atacante permite que eles imitem um roteador leg√≠timo dentro do dom√≠nio de roteamento. Instru√ß√µes detalhadas para implantar o FRR em seu sistema seguir√£o.

### Coleta de Intelig√™ncia de Rede <a href="#41e6" id="41e6"></a>

A integra√ß√£o no dom√≠nio de roteamento permite a enumera√ß√£o e reconhecimento de redes, oferecendo uma alternativa eficiente em termos de tempo para varreduras extensas. Essa abordagem n√£o apenas economiza tempo, mas tamb√©m mitiga o risco de detec√ß√£o por sistemas de seguran√ßa IPS/IDS. Para alcan√ßar isso, √© necess√°ria a implanta√ß√£o do **FRRouting**.

Modifica√ß√µes s√£o necess√°rias no arquivo de configura√ß√£o `daemons`, que controla as atividades do daemon. A ativa√ß√£o do daemon **eigrpd** √© necess√°ria.
```bash
~# nano /etc/frr/daemons
eigrpd=yes
```
Al√©m disso, s√£o necess√°rios ajustes no arquivo **vtysh.conf** para garantir que as configura√ß√µes de v√°rios protocolos sejam consolidadas em um √∫nico arquivo.
```bash
~# nano /etc/frr/vtysh.conf
service integrated-vtysh-config
```
Ap√≥s a configura√ß√£o, √© necess√°rio iniciar o daemon FRR e habilitar o roteamento de tr√°fego (desativado por padr√£o em distribui√ß√µes Linux).
```bash
~$ sudo systemctl start frr
~$ sudo sysctl -w net.ipv4.ip_forward=1
```
O comando **vtysh** fornece acesso ao painel de controle do roteador FRR.
```bash
~$ sudo vtysh
```
Exemplo de uso:
```bash
root# show version
```
![](../../.gitbook/assets/image (3) (2) (2).png)

> Nota: O dom√≠nio de roteamento EIGRP pode estar protegido com autentica√ß√£o. No entanto, o acesso potencial ainda √© poss√≠vel extraindo hashes criptogr√°ficos dos pacotes hello e redefinindo a senha.

No modo de configura√ß√£o global, inicie o processo **EIGRP** e defina o n√∫mero do sistema aut√¥nomo como **1**, juntamente com a localiza√ß√£o da rede.
```bash
root# config
root(config)# router eigrp 1
root(config-router) network 10.10.100.50/32
```
Ap√≥s o estabelecimento de conex√µes de vizinhan√ßa com roteadores EIGRP leg√≠timos (neste caso, **GW1 (10.10.100.100)** e **GW2 (10.10.100.200)**), os roteadores trocam informa√ß√µes de roteamento. Esse processo resulta na apari√ß√£o de novas rotas na tabela de roteamento do sistema de ataque, auxiliando nos testes de penetra√ß√£o e economizando tempo na varredura de sub-redes. Nesta etapa, o sistema faz parte do dom√≠nio de roteamento EIGRP e est√° pronto para o desenvolvimento de vetores de ataque adicionais.

![](../../.gitbook/assets/image (5) (1) (2).png)
![](../../.gitbook/assets/image (30) (1).png)
![](../../.gitbook/assets/image (29) (1) (2).png)

### Explorando o EIGRP: Vetores de Ataque <a href="#51ee" id="51ee"></a>

#### 1. Vizinhos EIGRP Falsos
O envio em massa de pacotes hello do EIGRP pode levar √† sobrecarga da CPU nos roteadores, abrindo caminho para ataques de nega√ß√£o de servi√ßo (DoS). Um script, **helloflooding.py**, √© utilizado para isso, embora a velocidade de envio de pacotes seja limitada pelo GIL (Global Interpreter Lock). Planos para reescrever o script em C para melhorar o desempenho est√£o em andamento.

![](../../.gitbook/assets/image (2) (6) (1).png)

O uso do script envolve a especifica√ß√£o de:
- Interface de rede (por exemplo, eth0)
- N√∫mero do sistema aut√¥nomo EIGRP (por exemplo, 1)
- Localiza√ß√£o da sub-rede (por exemplo, 10.10.100.0/24)
```bash
~$ sudo python3 helloflooding.py --interface eth0 --as 1 --subnet 10.10.100.0/24
```
#### 2. Buraco Negro EIGRP
Este ataque envolve a inje√ß√£o de uma rota falsa para interromper o fluxo de tr√°fego, comumente referido como um ataque de Buraco Negro. O script **routeinject.py** √© utilizado para esse fim. Por exemplo, redirecionando o tr√°fego para `172.16.100.140/32` para um destino inexistente.

![](../../.gitbook/assets/image (16) (1).png)

Os par√¢metros do script incluem:
- Interface do sistema do atacante
- N√∫mero AS do EIGRP
- Endere√ßo IP do atacante
- Sub-rede de destino IP e sua m√°scara
```bash
~$ sudo python3 routeinject.py --interface eth0 --as 1 --src 10.10.100.50 --dst 172.16.100.140 --prefix 32
```
![](../../.gitbook/assets/image (20) (1).png)

O resultado √© uma perda de conectividade com o host alvo devido √† inje√ß√£o de rota.

![](../../.gitbook/assets/image (6) (1) (1).png)

#### 3. Abusando dos Valores K
Valores K incompat√≠veis entre os roteadores EIGRP podem interromper o dom√≠nio EIGRP. O script **relationshipnightmare.py** explora isso injetando valores K alterados, desencadeando interrup√ß√µes e reconex√µes cont√≠nuas dentro do dom√≠nio EIGRP, resultando efetivamente em um ataque de DoS.

![](../../.gitbook/assets/image (12) (2) (1).png)

O script requer:
- Interface de rede
- N√∫mero AS do EIGRP
- Endere√ßo IP de um roteador leg√≠timo

As altera√ß√µes injetadas s√£o enviadas do IP especificado para o endere√ßo IP EIGRP multicast, causando a incompatibilidade.
```bash
~$ sudo python3 relationshipnightmare.py --interface eth0 --as 1 --src 10.10.100.100
```
#### 4. Desbordamento da Tabela de Roteamento
Este ataque inunda a tabela de roteamento com rotas falsas, sobrecarregando a CPU e a RAM do roteador. O script **routingtableoverflow.py** facilita isso ao enviar rapidamente v√°rias rotas falsas.

Script par√¢metros:
- Interface de rede
- N√∫mero AS do EIGRP
- Endere√ßo IP do atacante

Ap√≥s a execu√ß√£o do script, a tabela de roteamento fica saturada com rotas esp√∫rias, afetando severamente o desempenho do roteador.
```bash
sudo python3 routingtableoverflow.py --interface eth0 --as 1 --src 10.10.100.50
```
<details>

<summary><strong>Aprenda hacking AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras maneiras de apoiar o HackTricks:

* Se voc√™ deseja ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF** Verifique os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**swag oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-nos** no **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para os** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) reposit√≥rios do github.

</details>
