# Attaques EIGRP

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Travaillez-vous dans une **entreprise de cybers√©curit√©** ? Voulez-vous voir votre **entreprise annonc√©e dans HackTricks** ? ou voulez-vous avoir acc√®s √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**üí¨**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR au** [**repo hacktricks**](https://github.com/carlospolop/hacktricks) **et au** [**repo hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

**Cette page a √©t√© copi√©e depuis** [**https://medium.com/@in9uz/cisco-nightmare-pentesting-cisco-networks-like-a-devil-f4032eb437b9**](https://medium.com/@in9uz/cisco-nightmare-pentesting-cisco-networks-like-a-devil-f4032eb437b9)

## Attaquer le protocole EIGRP <a href="#0f82" id="0f82"></a>

**EIGRP (Enhanced Interior Gateway Routing Protocol)** est un protocole de routage dynamique. **C'est un protocole de vecteur de distance.** **S'il n'y a pas d'authentification et de configuration des interfaces passives, un intrus peut interf√©rer avec le routage EIGRP et causer une empoisonnement des tables de routage.** **De plus, le r√©seau EIGRP (en d'autres termes, le syst√®me autonome) est plat et n'a pas de segmentation en zones.** Qu'est-ce que cela pourrait signifier pour un attaquant ? Eh bien, s'il injecte une route, il est probable que cette route se propage dans tout le syst√®me autonome EIGRP.

<figure><img src="../../.gitbook/assets/image (25) (1).png" alt=""><figcaption></figcaption></figure>

Tout d'abord, attaquer un syst√®me EIGRP autonome n√©cessite d'√©tablir une relation de voisinage avec un routeur EIGRP l√©gitime, ce qui ouvre de nombreuses possibilit√©s, de la reconnaissance de base √† diverses injections.

Pour cela, j'utiliserai [**FRRouting**](https://frrouting.org/). Il s'agit d'un logiciel open source con√ßu pour cr√©er un routeur dans Unix et Linux. **FRRouting** vous permet de mettre en place **un routeur virtuel qui prend en charge BGP, OSPF, EIGRP, RIP et d'autres protocoles.** Tout ce que vous avez √† faire est de le d√©ployer sur votre syst√®me d'attaquant et vous pouvez en fait pr√©tendre √™tre un routeur l√©gitime dans le domaine de routage. Je vais vous montrer comment d√©ployer FRR sur votre syst√®me dans la section suivante.

### Intelligence r√©seau <a href="#41e6" id="41e6"></a>

**Se connecter au domaine de routage nous permet de faire l'√©num√©ration et la reconnaissance des r√©seaux et de ne pas passer beaucoup de temps √† scanner.** Cette m√©thode vous fait gagner beaucoup de temps pr√©cieux. **De plus, en scannant, vous pouvez vous faire rep√©rer devant les syst√®mes de s√©curit√© IPS/IDS.** Pour moi, la connexion au domaine et l'√©num√©ration sont le vecteur d'attaque sur les domaines de routage qui vous donne le plus d'impact. Mais pour cela, vous devez d√©ployer **FRRouting**. C'est parti.

**Il est n√©cessaire de modifier le fichier de configuration daemons.** Il contient les configurations des d√©mons dans le contexte de leur activit√©. Soit ils sont activ√©s (yes) soit non (no). Nous devons activer le d√©mon **eigrpd**.
```
~# nano /etc/frr/daemons
eigrpd=yes
```
<figure><img src="../../.gitbook/assets/image (15) (1).png" alt=""><figcaption></figcaption></figure>

Ensuite, vous devez corriger le fichier **vtysh.conf** en ajoutant une ligne responsable de la sauvegarde de la configuration dans un seul fichier, afin que les configurations de diff√©rents protocoles ne soient pas dispers√©es dans diff√©rents fichiers **(par exemple, eigrpd.conf, staticd.conf).** Cela est configurable en option.
```
~# nano /etc/frr/vtysh.conf
service integrated-vtysh-config
```
La configuration de FRRouting est termin√©e. Maintenant, il est temps d'ex√©cuter le d√©mon FRR. Et oui, nous devons activer le routage du trafic. Par d√©faut, il est d√©sactiv√© dans les distributions Linux.
```
~$ sudo systemctl start frr
~$ sudo sysctl -w net.ipv4.ip_forward=1
```
<figure><img src="../../.gitbook/assets/image (32).png" alt=""><figcaption></figcaption></figure>

La commande **vtysh** nous am√®nera au panneau de contr√¥le du routeur FRR.
```
~$ sudo vtysh
```
### EIGRP Attacks

#### EIGRP Protocol

Le protocole EIGRP (Enhanced Interior Gateway Routing Protocol) est un protocole de routage propri√©taire d√©velopp√© par Cisco. Il est utilis√© pour acheminer des paquets de donn√©es sur un r√©seau de plusieurs routeurs. EIGRP est un protocole de routage √† vecteur de distance qui utilise la m√©trique de co√ªt pour d√©terminer le meilleur chemin vers une destination.

#### EIGRP Attacks

Les attaques EIGRP peuvent √™tre utilis√©es pour perturber le trafic r√©seau, obtenir des informations sur le r√©seau et m√™me prendre le contr√¥le de certains routeurs. Les attaques EIGRP courantes comprennent :

- Spoofing EIGRP : un attaquant peut envoyer des paquets EIGRP falsifi√©s pour tromper les routeurs du r√©seau et leur faire croire qu'il est le routeur le plus proche d'une destination donn√©e. Cela peut entra√Æner une redirection de trafic vers l'attaquant ou une interruption de la connectivit√©.

- Injection de route EIGRP : un attaquant peut injecter de fausses routes EIGRP dans le r√©seau pour rediriger le trafic vers des destinations malveillantes ou pour emp√™cher le trafic d'atteindre certaines destinations.

- Attaques de d√©ni de service (DoS) EIGRP : un attaquant peut envoyer des paquets EIGRP malveillants pour surcharger les routeurs du r√©seau et les emp√™cher de fonctionner correctement.

#### Mitigation

Pour se prot√©ger contre les attaques EIGRP, il est recommand√© de :

- Configurer l'authentification EIGRP pour emp√™cher les attaquants de falsifier des paquets EIGRP.

- Utiliser des listes de contr√¥le d'acc√®s (ACL) pour limiter les paquets EIGRP entrants et sortants.

- Surveiller le trafic EIGRP pour d√©tecter les anomalies et les activit√©s suspectes.

- Mettre √† jour r√©guli√®rement les routeurs avec les derniers correctifs de s√©curit√© pour r√©duire les vuln√©rabilit√©s connues.
```
Inguz# show version
```
<figure><img src="../../.gitbook/assets/image (3) (2) (2).png" alt=""><figcaption></figcaption></figure>

> **Cependant, n'oubliez pas que le domaine de routage EIGRP peut √™tre prot√©g√© par une authentification. Mais vous avez toujours une chance de vous connecter au domaine de routage. Lorsque les paquets hello sont envoy√©s, ils contiennent √©galement des hachages cryptographiques. Si vous pouvez extraire ces hachages de l'extraction de trafic et r√©initialiser le mot de passe, vous pouvez vous connecter au domaine de routage avec ce mot de passe.**

Acc√©dez au mode de configuration globale et d√©marrez le processus **EIGRP**, sp√©cifiez le num√©ro du syst√®me autonome - **1**

Et nous devons √©galement d√©clarer le r√©seau dans lequel nous sommes. Nous sommes dans le r√©seau 10.10.100.0/24. Mon adresse est 10.10.100.50/32
```
Inguz# configInguz(config)# router eigrp 1Inguz(config-router) network 10.10.100.50/32
```
Apr√®s cela, le voisinage entre les routeurs EIGRP l√©gitimes est √©tabli. Il y en a deux sur mon r√©seau :

* **GW1 (10.10.100.100)**
* **GW2 (10.10.100.200)**

Voisinage EIGRP avec GW1 (10.10.100.100) :

<figure><img src="../../.gitbook/assets/image (5) (1) (2).png" alt=""><figcaption></figcaption></figure>

Voisinage EIGRP avec GW2 (10.10.100.200) :

<figure><img src="../../.gitbook/assets/image (30) (1).png" alt=""><figcaption></figcaption></figure>

Pendant l'√©tablissement et la maintenance du voisinage entre les routeurs EIGRP, les routeurs √©changent leurs informations de routage. Apr√®s l'√©tablissement du voisinage, de nouvelles routes appara√Ætront dans notre table de routage du syst√®me attaquant, √† savoir :

* **10.1.239.0/24 via 10.10.100.100;**
* **30.30.30.0/24 via 10.10.100.100;**
* **100.100.100.0/24 via 10.10.100.100;**
* **172.16.100.0/24 via 10.10.100.200**

<figure><img src="../../.gitbook/assets/image (29) (1) (2).png" alt=""><figcaption></figcaption></figure>

Ainsi, apr√®s l'√©tablissement du voisinage, nous connaissons l'existence de ces sous-r√©seaux, ce qui facilite notre pentest et nous fait gagner du temps. Nous pouvons nous passer de la num√©risation de sous-r√©seau suppl√©mentaire. Maintenant, nous sommes dans le domaine de routage EIGRP et nous pouvons d√©velopper quelques vecteurs d'attaque. Parlons-en.

### Faux voisins EIGRP <a href="#51ee" id="51ee"></a>

**J'ai d√©couvert que la g√©n√©ration et l'envoi rapide de paquets EIGRP hello en masse surchargent le CPU du routeur, ce qui peut ouvrir la porte √† une attaque DoS.** J'ai d√©velopp√© un petit script [**helloflooding.py**](https://github.com/in9uz/EIGRPWN/blob/main/helloflooding.py), mais il me semble que le script manque de vitesse d'envoi des paquets. **Cela est d√ª √† GIL**, qui emp√™che la fonction **sprayhello** de s'ex√©cuter en plusieurs threads par seconde. **Finalement, je r√©√©crirai le script en C.**

<figure><img src="../../.gitbook/assets/image (2) (6) (1).png" alt=""><figcaption></figcaption></figure>

Arguments du script :

* **Interface du syst√®me attaquant (eth0) ;**
* **Num√©ro de syst√®me autonome EIGRP (1) ;**
* **Sous-r√©seau o√π se trouve le syst√®me attaquant. Dans mon cas, le sous-r√©seau est 10.10.100.0/24**
```
~$ sudo python3 helloflooding.py --interface eth0 --as 1 --subnet 10.10.100.0/24
```
<figure><img src="../../.gitbook/assets/image (26) (1).png" alt=""><figcaption></figcaption></figure>

### Trou noir EIGRP <a href="#5c04" id="5c04"></a>

L'essence de cette attaque est une simple injection d'une fausse route qui empoisonnera la table de routage. Le trafic vers, disons, le r√©seau `10.10.100.0/24` ne m√®nera nulle part, causant un d√©ni de service. Une telle attaque est appel√©e un Trou noir. Le script [**routeinject.py**](https://github.com/in9uz/EIGRPWN/blob/main/routeinject.py) sera l'outil utilis√© pour la r√©aliser. Pour cet exemple, je vais envoyer du trafic destin√© √† l'h√¥te `172.16.100.140/32` vers le trou noir.

<figure><img src="../../.gitbook/assets/image (16) (1).png" alt=""><figcaption></figcaption></figure>

Arguments du script:

* **interface du syst√®me attaquant**
* **num√©ro AS EIGRP**
* **adresse IP de l'attaquant**
* **adresse IP du sous-r√©seau cible dont le trafic sera envoy√© vers le trou noir**
* **masque de sous-r√©seau cible**
```
~$ sudo python3 routeinject.py --interface eth0 --as 1 --src 10.10.100.50 --dst 172.16.100.140 --prefix 32
```
<figure><img src="../../.gitbook/assets/image (20) (1).png" alt=""><figcaption></figcaption></figure>

**Notre h√¥te semble avoir des probl√®mes :)**

<figure><img src="../../.gitbook/assets/image (6) (1) (1).png" alt=""><figcaption></figcaption></figure>

Comme vous pouvez le voir, l'h√¥te perd la connectivit√© avec l'h√¥te **172.16.100.140/32** en raison d'une injection de route.

### Abus des valeurs K <a href="#25aa" id="25aa"></a>

Pour √©tablir des voisins EIGRP, **les routeurs utilisent des valeurs K sp√©ciales.** Elles doivent √™tre identiques parmi tous les voisins EIGRP. Si au moins une valeur K ne correspond pas, le domaine EIGRP se bloquera et le voisinage sera rompu. Nous utiliserons [**relationshipnightmare.py**](https://github.com/in9uz/EIGRPWN/blob/main/relationshipnightmare.py) \*\*\*\* pour effectuer cette attaque\*\*.\*\*

<figure><img src="../../.gitbook/assets/image (12) (2).png" alt=""><figcaption></figcaption></figure>

Arguments du script :

* **interface r√©seau**
* **num√©ro AS EIGRP**
* **adresse IP du routeur l√©gitime**

**Au nom de l'adresse IP sp√©cifi√©e, une injection sera envoy√©e sur l'adresse IP EIGRP multicast, dans laquelle les valeurs K sont diff√©rentes.** Dans mon cas, je vais rompre le voisinage au nom du routeur GW1 **(l'adresse est 10.10.100.100)**.
```
~$ sudo python3 relationshipnightmare.py --interface eth0 --as 1 --src 10.10.100.100
```
<figure><img src="../../.gitbook/assets/image (9) (1).png" alt=""><figcaption><p>Extrait du trafic lors d'une perturbation de voisinage</p></figcaption></figure>

<figure><img src="../../.gitbook/assets/image (27) (1).png" alt=""><figcaption><p>Le routeur GW1 se d√©connecte et se reconnecte sans cesse √† EIGRP</p></figcaption></figure>

**Une attaque DoS peut √™tre effectu√©e de cette mani√®re. Pendant l'op√©ration, des interruptions et des tentatives de voisinage sans fin se produisent, paralysant une partie du domaine de routage EIGRP.**

### D√©bordement de table de routage <a href="#1d0c" id="1d0c"></a>

L'essence de cette attaque est de provoquer l'envoi d'un grand nombre de fausses routes, qui vont d√©border la table de routage. Cela √©puise les ressources informatiques du routeur, √† savoir le CPU et la RAM, car les injections se produisent √† une vitesse √©norme. Cette attaque est mise en ≈ìuvre par le script [**routingtableoverflow.py**](https://github.com/in9uz/EIGRPWN/blob/main/routingtableoverflow.py).

<figure><img src="../../.gitbook/assets/image (3) (4).png" alt=""><figcaption></figcaption></figure>

Arguments du script

* **interface r√©seau**
* **Num√©ro AS EIGRP**
* **Adresse IP de l'attaquant**
```
in9uz@Inguz:~$ sudo python3 routingtableoverflow.py --interface eth0 --as 1 --src 10.10.100.50
```
Apr√®s l'ex√©cution du script, la table de routage commence √† d√©border de routes. Les adresses al√©atoires des r√©seaux cibles sont dues √† l'utilisation de **RandIP()** dans [**Scapy**](https://github.com/secdev/scapy).

<figure><img src="../../.gitbook/assets/image (4) (4).png" alt=""><figcaption><p>Table de routage d√©bord√©e sur le routeur GW1</p></figcaption></figure>

<figure><img src="../../.gitbook/assets/image (21) (1).png" alt=""><figcaption><p>Processeur du routeur surcharg√©</p></figcaption></figure>

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Travaillez-vous dans une **entreprise de cybers√©curit√©** ? Voulez-vous voir votre **entreprise annonc√©e dans HackTricks** ? ou voulez-vous avoir acc√®s √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**üí¨**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR au** [**repo hacktricks**](https://github.com/carlospolop/hacktricks) **et au** [**repo hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
