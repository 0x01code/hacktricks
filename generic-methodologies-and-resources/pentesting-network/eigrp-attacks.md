# Ataques EIGRP

<details>

<summary><strong>Aprenda hacking no AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ quer ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**material oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **Junte-se ao grupo** üí¨ [**Discord**](https://discord.gg/hRep4RUj7f) ou ao grupo [**telegram**](https://t.me/peass) ou **siga**-me no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios github** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

**Esta p√°gina foi copiada de** [**https://medium.com/@in9uz/cisco-nightmare-pentesting-cisco-networks-like-a-devil-f4032eb437b9**](https://medium.com/@in9uz/cisco-nightmare-pentesting-cisco-networks-like-a-devil-f4032eb437b9)\*\*\*\*

## Atacando o Protocolo EIGRP <a href="#0f82" id="0f82"></a>

**EIGRP (Enhanced Interior Gateway Routing Protocol)** √© um protocolo de roteamento din√¢mico. **√â um protocolo de vetor de dist√¢ncia.** **Se n√£o houver autentica√ß√£o e configura√ß√£o de interfaces passivas, um intruso pode interferir no roteamento EIGRP e causar envenenamento de tabelas de roteamento.** **Al√©m disso, a rede EIGRP (em outras palavras, sistema aut√¥nomo) √© plana e n√£o tem segmenta√ß√£o em zonas.** O que isso poderia significar para um atacante? Bem, se ele injetar uma rota, √© prov√°vel que essa rota se espalhe por todo o sistema aut√¥nomo EIGRP.

<figure><img src="../../.gitbook/assets/image (25) (1).png" alt=""><figcaption></figcaption></figure>

Primeiramente, atacar um sistema EIGRP isolado requer estabelecer uma vizinhan√ßa com um roteador EIGRP leg√≠timo, o que abre uma s√©rie de possibilidades, desde reconhecimento b√°sico at√© v√°rias inje√ß√µes.

Para isso, usarei o [**FRRouting**](https://frrouting.org/). Este √© um software de c√≥digo aberto projetado para criar um roteador em Unix e Linux. **FRRouting** permite implementar **um roteador virtual que suporta BGP, OSPF, EIGRP, RIP e outros protocolos.** Tudo o que voc√™ precisa fazer √© implant√°-lo no sistema do atacante e voc√™ pode realmente se passar por um roteador leg√≠timo no dom√≠nio de roteamento. Vou mostrar como implantar o FRR no seu sistema na pr√≥xima se√ß√£o.

### Intelig√™ncia de Rede <a href="#41e6" id="41e6"></a>

**Conectar-se ao dom√≠nio de roteamento nos permite fazer enumera√ß√£o e reconhecimento de redes sem gastar muito tempo escaneando.** Este m√©todo economiza muito tempo precioso. **Al√©m disso, ao escanear, voc√™ pode ser detectado pelos sistemas de seguran√ßa IPS/IDS.** Para mim, conectar-se ao dom√≠nio e fazer a enumera√ß√£o √© o vetor de ataque em dom√≠nios de roteamento que oferece o maior impacto. Mas para fazer isso, voc√™ precisa implantar o **FRRouting**. Vamos l√°.

**√â necess√°rio editar o arquivo de configura√ß√£o daemons.** Ele cont√©m as configura√ß√µes dos daemons no contexto de sua atividade. Ou eles est√£o ativados (yes) ou n√£o (no). Precisamos ativar o daemon **eigrpd**.
```
~# nano /etc/frr/daemons
eigrpd=yes
```
```markdown
<figure><img src="../../.gitbook/assets/image (15) (1).png" alt=""><figcaption></figcaption></figure>

Ap√≥s isso, voc√™ precisa corrigir o arquivo **vtysh.conf** adicionando uma linha respons√°vel por salvar a configura√ß√£o em um √∫nico arquivo, para que as configura√ß√µes de diferentes protocolos n√£o fiquem dispersas em arquivos diferentes **(por exemplo, eigrpd.conf, staticd.conf).** Isso √© configur√°vel opcionalmente.
```
```
~# nano /etc/frr/vtysh.conf
service integrated-vtysh-config
```
A configura√ß√£o do FRRouting est√° conclu√≠da. Agora √© hora de executar o daemon FRR. **E sim, precisamos habilitar o roteamento de tr√°fego. Por padr√£o, ele est√° desativado nas distribui√ß√µes Linux**
```
~$ sudo systemctl start frr
~$ sudo sysctl -w net.ipv4.ip_forward=1
```
```markdown
<figure><img src="../../.gitbook/assets/image (32).png" alt=""><figcaption></figcaption></figure>

O comando **vtysh** nos levar√° ao painel de controle do roteador FRR.
```
```
~$ sudo vtysh
```
Sure, please provide the English text that you need translated into Portuguese.
```
Inguz# show version
```
```markdown
> **No entanto, n√£o se esque√ßa de que o dom√≠nio de roteamento EIGRP pode ser protegido por autentica√ß√£o. Mas voc√™ ainda tem a chance de se conectar ao dom√≠nio de roteamento. Quando pacotes hello s√£o enviados, eles tamb√©m cont√™m hashes criptogr√°ficos. Se voc√™ conseguir extrair esses hashes do dump de tr√°fego e redefinir a senha, voc√™ pode fazer login no dom√≠nio de roteamento com essa senha.**

V√° para o modo de configura√ß√£o global e inicie o processo **EIGRP**, especifique o n√∫mero do sistema aut√¥nomo ‚Äî **1**

E tamb√©m precisamos declarar a rede em que estamos. Estamos em 10.10.100.0/24. Meu endere√ßo √© 10.10.100.50/32
```
```
Inguz# configInguz(config)# router eigrp 1Inguz(config-router) network 10.10.100.50/32
```
Ap√≥s isso, a vizinhan√ßa entre os roteadores EIGRP leg√≠timos √© estabelecida. Existem dois deles na minha rede:

* **GW1 (10.10.100.100)**
* **GW2 (10.10.100.200)**

Vizinhan√ßa EIGRP com GW1 (10.10.100.100):

<figure><img src="../../.gitbook/assets/image (5) (1) (2).png" alt=""><figcaption></figcaption></figure>

Vizinhan√ßa EIGRP com GW2 (10.10.100.200):

<figure><img src="../../.gitbook/assets/image (30) (1).png" alt=""><figcaption></figcaption></figure>

Durante o estabelecimento e manuten√ß√£o da vizinhan√ßa entre roteadores EIGRP, os roteadores trocam suas informa√ß√µes de roteamento. Ap√≥s a vizinhan√ßa ser estabelecida, novas rotas aparecer√£o na nossa tabela de roteamento do sistema atacante, a saber:

* **10.1.239.0/24 via 10.10.100.100;**
* **30.30.30.0/24 via 10.10.100.100;**
* **100.100.100.0/24 via 10.10.100.100;**
* **172.16.100.0/24 via 10.10.100.200**

<figure><img src="../../.gitbook/assets/image (29) (1) (2).png" alt=""><figcaption></figcaption></figure>

Assim, ap√≥s estabelecer a vizinhan√ßa, sabemos sobre a exist√™ncia dessas sub-redes, o que facilita o nosso pentesting e economiza tempo. Podemos dispensar a varredura adicional de sub-redes. Agora estamos no dom√≠nio de roteamento EIGRP e podemos desenvolver alguns vetores de ataque. Vamos falar sobre eles.

### Vizinhos EIGRP Falsos <a href="#51ee" id="51ee"></a>

**Descobri que gerar e enviar rapidamente pacotes EIGRP hello em massa sobrecarrega a CPU do roteador, o que por sua vez pode abrir a porta para um ataque DoS.** Desenvolvi um pequeno script [**helloflooding.py**](https://github.com/in9uz/EIGRPWN/blob/main/helloflooding.py) \*\*\*\*, mas parece-me que o script carece de velocidade no envio dos pacotes. **Isso √© causado pelo GIL**, que impede a fun√ß√£o **sprayhello** de ser executada em m√∫ltiplas threads por segundo. **Eventualmente reescreverei o script em C.**

<figure><img src="../../.gitbook/assets/image (2) (6) (1).png" alt=""><figcaption></figcaption></figure>

Argumentos do script:

* **Interface do sistema atacante (eth0);**
* **N√∫mero do sistema aut√¥nomo EIGRP (1);**
* **Sub-rede onde o sistema atacante est√° localizado. No meu caso, a sub-rede √© 10.10.100.0/24**
```
~$ sudo python3 helloflooding.py --interface eth0 --as 1 --subnet 10.10.100.0/24
```
### EIGRP Blackhole <a href="#5c04" id="5c04"></a>

A ess√™ncia deste ataque √© uma simples inje√ß√£o de uma rota falsa que ir√° envenenar a tabela de roteamento. O tr√°fego para, **digamos, a** `10.10.100.0/24` **rede n√£o ir√° a lugar algum, causando uma nega√ß√£o de servi√ßo. Tal ataque √© chamado de Blackhole.** O script [**routeinject.py**](https://github.com/in9uz/EIGRPWN/blob/main/routeinject.py) \*\*\*\* ser√° a ferramenta usada para realiz√°-lo. Para este exemplo, vou enviar tr√°fego destinado ao host `172.16.100.140/32` para o buraco negro.

<figure><img src="../../.gitbook/assets/image (16) (1).png" alt=""><figcaption></figcaption></figure>

Argumentos do script:

* **interface do sistema atacante**
* **n√∫mero AS do EIGRP**
* **endere√ßo IP do atacante**
* **endere√ßo IP da sub-rede alvo cujo tr√°fego ser√° enviado para o buraco negro**
* **m√°scara de sub-rede alvo**
```
~$ sudo python3 routeinject.py --interface eth0 --as 1 --src 10.10.100.50 --dst 172.16.100.140 --prefix 32
```
<figure><img src="../../.gitbook/assets/image (20) (1).png" alt=""><figcaption></figcaption></figure>

**Nosso host parece estar em apuros :)**

<figure><img src="../../.gitbook/assets/image (6) (1) (1).png" alt=""><figcaption></figcaption></figure>

Como voc√™ pode ver, o host perde conectividade com o host **172.16.100.140/32** devido √† inje√ß√£o de rota.

### Abusando dos K-Values <a href="#25aa" id="25aa"></a>

Para estabelecer vizinhos EIGRP, **os roteadores usam K-values especiais.** Eles devem ser iguais entre todos os vizinhos EIGRP. Se pelo menos um K-value n√£o coincidir, o dom√≠nio EIGRP ir√° falhar e a vizinhan√ßa ser√° quebrada. Usaremos [**relationshipnightmare.py**](https://github.com/in9uz/EIGRPWN/blob/main/relationshipnightmare.py) \*\*\*\* para realizar este ataque\*\*.\*\*

<figure><img src="../../.gitbook/assets/image (12) (2) (1).png" alt=""><figcaption></figcaption></figure>

Argumentos do script:

* **interface de rede**
* **n√∫mero AS EIGRP**
* **Endere√ßo IP do roteador leg√≠timo**

**Em nome do IP especificado, ser√° enviada uma inje√ß√£o no endere√ßo IP multicast EIGRP, no qual os K-values s√£o diferentes.** No meu caso, vou quebrar a vizinhan√ßa em nome do roteador GW1 **(endere√ßo √© 10.10.100.100)**.
```
~$ sudo python3 relationshipnightmare.py --interface eth0 --as 1 --src 10.10.100.100
```
<figure><img src="../../.gitbook/assets/image (9) (1) (4).png" alt=""><figcaption><p>Despejo de tr√°fego durante uma interrup√ß√£o de vizinhan√ßa</p></figcaption></figure>

<figure><img src="../../.gitbook/assets/image (27) (1).png" alt=""><figcaption><p>Roteador GW1 desconecta e reconecta EIGRP incessantemente</p></figcaption></figure>

**Um ataque DoS pode ser realizado desta forma. Durante a opera√ß√£o, ocorrem interrup√ß√µes e tentativas de vizinhan√ßa incessantes, paralisando parte do dom√≠nio de roteamento EIGRP.**

### Sobrecarga da tabela de roteamento <a href="#1d0c" id="1d0c"></a>

A ess√™ncia deste ataque √© provocar o envio de um n√∫mero enorme de rotas falsas, que ir√£o sobrecarregar a tabela de roteamento. Isso esgota os recursos de computa√ß√£o do roteador, nomeadamente a CPU e a RAM, uma vez que as inje√ß√µes ocorrem a uma velocidade enorme. Este ataque √© implementado pelo script [**routingtableoverflow.py**](https://github.com/in9uz/EIGRPWN/blob/main/routingtableoverflow.py)

<figure><img src="../../.gitbook/assets/image (3) (4).png" alt=""><figcaption></figcaption></figure>

Argumentos do script

* **interface de rede**
* **N√∫mero AS do EIGRP**
* **Endere√ßo IP do atacante**
```
in9uz@Inguz:~$ sudo python3 routingtableoverflow.py --interface eth0 --as 1 --src 10.10.100.50
```
Ap√≥s executar o script, a tabela de roteamento come√ßa a transbordar com rotas. Os endere√ßos aleat√≥rios das redes alvo s√£o devido ao uso de **RandIP()** no [**Scapy**](https://github.com/secdev/scapy).

<figure><img src="../../.gitbook/assets/image (4) (4).png" alt=""><figcaption><p>Tabela de roteamento transborda no roteador GW1</p></figcaption></figure>

<figure><img src="../../.gitbook/assets/image (21) (1).png" alt=""><figcaption><p>CPU do roteador sobrecarregada</p></figcaption></figure>

<details>

<summary><strong>Aprenda hacking no AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ quer ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**material oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **Junte-se ao grupo** üí¨ [**Discord**](https://discord.gg/hRep4RUj7f) ou ao grupo [**telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios do GitHub** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
