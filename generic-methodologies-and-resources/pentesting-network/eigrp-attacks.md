# EIGRP 攻击

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks 云 ☁️</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>🐦 Twitter 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 Youtube 🎥</strong></a></summary>

* 你在一家**网络安全公司**工作吗？你想在 HackTricks 中看到你的**公司广告**吗？或者你想获得**PEASS 的最新版本或下载 HackTricks 的 PDF 版本**吗？请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 发现我们的独家[**NFTs**](https://opensea.io/collection/the-peass-family)收藏品——[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* 获取[**官方 PEASS & HackTricks 商品**](https://peass.creator-spring.com)
* **加入**[**💬**](https://emojipedia.org/speech-balloon/) [**Discord 群组**](https://discord.gg/hRep4RUj7f) 或 [**telegram 群组**](https://t.me/peass)，或者**关注**我在**Twitter**上的[**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**。**
* **通过向**[**hacktricks 仓库**](https://github.com/carlospolop/hacktricks) **和**[**hacktricks-cloud 仓库**](https://github.com/carlospolop/hacktricks-cloud) **提交 PR 来分享你的黑客技巧。**

</details>

**本页内容来自** [**https://medium.com/@in9uz/cisco-nightmare-pentesting-cisco-networks-like-a-devil-f4032eb437b9**](https://medium.com/@in9uz/cisco-nightmare-pentesting-cisco-networks-like-a-devil-f4032eb437b9)\*\*\*\*

## 攻击 EIGRP 协议 <a href="#0f82" id="0f82"></a>

**EIGRP（增强型内部网关路由协议）**是一种动态路由协议。**它是一种距离矢量协议。** **如果没有身份验证和被动接口的配置，入侵者可以干扰 EIGRP 路由并导致路由表污染。** **此外，EIGRP 网络（换句话说，自治系统）是扁平的，没有分段成任何区域。** 这对攻击者意味着什么？嗯，如果他注入一条路由，很可能这条路由会在自治 EIGRP 系统中传播。

<figure><img src="../../.gitbook/assets/image (25) (1).png" alt=""><figcaption></figcaption></figure>

首先，攻击一个独立的 EIGRP 系统需要与合法的 EIGRP 路由器建立邻居关系，这打开了很多可能性，从基本的侦察到各种注入。

为此，我将使用 [**FRRouting**](https://frrouting.org/)。这是一个开源软件，用于在 Unix 和 Linux 中创建路由器。**FRRouting** 允许您实现**支持 BGP、OSPF、EIGRP、RIP 和其他协议的虚拟路由器**。您只需要在攻击者的系统上部署它，您实际上可以假装成路由域中的合法路由器。我将向您展示如何在下一节中在您的系统上部署 FRR。

### 网络情报 <a href="#41e6" id="41e6"></a>

**连接到路由域允许我们对网络进行枚举和侦察，而不需要花费大量时间进行扫描。** 这种方法可以节省您大量宝贵的时间。**此外，通过扫描，您可能会在 IPS/IDS 安全系统面前暴露自己。** 对我来说，连接到域和枚举是对路由域的攻击向量，给您带来最大的影响。但是要做到这一点，您需要部署 **FRRouting**。我们开始吧。

**需要编辑配置文件 daemons。** 它包含了守护进程的配置，以及它们的活动上下文。它们是启用的（yes）还是未启用的（no）。我们需要激活 **eigrpd** 守护进程。
```
~# nano /etc/frr/daemons
eigrpd=yes
```
<figure><img src="../../.gitbook/assets/image (15) (1).png" alt=""><figcaption></figcaption></figure>

之后，您需要通过添加一行代码来修正**vtysh.conf**文件，以便将配置保存到一个文件中，这样不同协议的配置就不会散落在不同的文件中（例如eigrpd.conf，staticd.conf）。这是可选的配置。
```
~# nano /etc/frr/vtysh.conf
service integrated-vtysh-config
```
FRRouting配置已完成。现在是运行FRR守护进程的时候了。**是的，我们需要启用流量路由。在Linux发行版中，默认情况下是禁用的**。
```
~$ sudo systemctl start frr
~$ sudo sysctl -w net.ipv4.ip_forward=1
```
<figure><img src="../../.gitbook/assets/image (32).png" alt=""><figcaption></figcaption></figure>

**vtysh**命令将带我们进入FRR路由器控制面板。
```
~$ sudo vtysh
```
# EIGRP Attacks

## Introduction

EIGRP (Enhanced Interior Gateway Routing Protocol) is a Cisco proprietary routing protocol used to exchange routing information within a network. It is widely used in enterprise networks.

In this section, we will explore some common EIGRP attacks that can be used during a penetration test.

## EIGRP Neighbor Spoofing

EIGRP Neighbor Spoofing is a technique used to impersonate a legitimate EIGRP neighbor in order to manipulate routing information. By spoofing the EIGRP neighbor, an attacker can redirect traffic to a malicious destination or cause a denial of service.

To perform EIGRP Neighbor Spoofing, the attacker needs to send EIGRP Hello packets with a spoofed source IP address. This will trick the target router into believing that the attacker is a legitimate neighbor.

## EIGRP Route Injection

EIGRP Route Injection is a technique used to inject malicious routes into the EIGRP routing table. By injecting a malicious route, an attacker can redirect traffic to a malicious destination or perform a man-in-the-middle attack.

To perform EIGRP Route Injection, the attacker needs to send EIGRP Update packets with a spoofed source IP address and a malicious route. This will cause the target router to add the malicious route to its routing table.

## EIGRP Authentication Bypass

EIGRP Authentication Bypass is a technique used to bypass the authentication mechanism of EIGRP. By bypassing the authentication, an attacker can gain unauthorized access to the EIGRP routing domain.

To perform EIGRP Authentication Bypass, the attacker needs to send EIGRP packets without the required authentication credentials. This will trick the target router into accepting the packets and allowing the attacker to access the EIGRP routing domain.

## Conclusion

EIGRP attacks can be used to manipulate routing information, redirect traffic, or gain unauthorized access to a network. It is important for network administrators to be aware of these attacks and implement appropriate security measures to protect against them.
```
Inguz# show version
```
<figure><img src="../../.gitbook/assets/image (3) (2) (2).png" alt=""><figcaption></figcaption></figure>

> **然而，不要忘记EIGRP路由域可以通过身份验证进行保护。但是你仍然有机会连接到路由域。当hello数据包发送出去时，它们也包含了加密哈希值。如果你能从流量转储中提取这些哈希值并重置密码，你就可以使用这个密码登录到路由域。**

进入全局配置模式并启动**EIGRP**进程，指定自治系统号为**1**

我们还需要声明我们所在的网络。我们在10.10.100.0/24网络中。我的地址是10.10.100.50/32
```
Inguz# configInguz(config)# router eigrp 1Inguz(config-router) network 10.10.100.50/32
```
之后，合法的EIGRP路由器之间建立了邻居关系。在我的网络中有两个：

* **GW1（10.10.100.100）**
* **GW2（10.10.100.200）**

与GW1（10.10.100.100）建立的EIGRP邻居关系：

<figure><img src="../../.gitbook/assets/image (5) (1) (2).png" alt=""><figcaption></figcaption></figure>

与GW2（10.10.100.200）建立的EIGRP邻居关系：

<figure><img src="../../.gitbook/assets/image (30) (1).png" alt=""><figcaption></figcaption></figure>

在建立和维护EIGRP路由器之间的邻居关系期间，路由器会交换其路由信息。在建立邻居关系后，攻击系统的路由表中将出现新的路由，即：

* **10.1.239.0/24通过10.10.100.100;**
* **30.30.30.0/24通过10.10.100.100;**
* **100.100.100.0/24通过10.10.100.100;**
* **172.16.100.0/24通过10.10.100.200**

<figure><img src="../../.gitbook/assets/image (29) (1) (2).png" alt=""><figcaption></figcaption></figure>

因此，在建立邻居关系后，我们了解到这些子网的存在，这使我们更容易进行渗透测试并节省时间。我们可以不进行额外的子网扫描。现在我们处于EIGRP路由域中，可以开发一些攻击向量。让我们来谈谈它们。

### 伪造EIGRP邻居 <a href="#51ee" id="51ee"></a>

**我发现生成并快速发送大量的EIGRP hello数据包会导致路由器的CPU负载过高，从而可能打开DoS攻击的大门。**我开发了一个名为[**helloflooding.py**](https://github.com/in9uz/EIGRPWN/blob/main/helloflooding.py)的小脚本，但我觉得脚本发送数据包的速度不够快。这是由于GIL的原因，它阻止了**sprayhello**函数以每秒多个线程运行。**最终我会用C语言重写这个脚本。**

<figure><img src="../../.gitbook/assets/image (2) (6) (1).png" alt=""><figcaption></figcaption></figure>

脚本的参数：

* **攻击系统的接口（eth0）；**
* **EIGRP自治系统号（1）；**
* **攻击系统所在的子网。在我的情况下，子网是10.10.100.0/24**
```
~$ sudo python3 helloflooding.py --interface eth0 --as 1 --subnet 10.10.100.0/24
```
<figure><img src="../../.gitbook/assets/image (26) (1).png" alt=""><figcaption></figcaption></figure>

### EIGRP黑洞攻击 <a href="#5c04" id="5c04"></a>

这种攻击的本质是注入一个虚假的路由，污染路由表。到达 `10.10.100.0/24` 网络的流量将无法到达目的地，导致服务拒绝。这种攻击被称为黑洞攻击。使用的工具是 [**routeinject.py**](https://github.com/in9uz/EIGRPWN/blob/main/routeinject.py) 脚本。在这个例子中，我将把流量发送到黑洞，目的地是主机 `172.16.100.140/32`。

<figure><img src="../../.gitbook/assets/image (16) (1).png" alt=""><figcaption></figcaption></figure>

脚本的参数：

* 攻击系统的接口
* EIGRP AS号
* 攻击者的IP地址
* 将流量发送到黑洞的目标子网的IP地址
* 目标子网的子网掩码
```
~$ sudo python3 routeinject.py --interface eth0 --as 1 --src 10.10.100.50 --dst 172.16.100.140 --prefix 32
```
<figure><img src="../../.gitbook/assets/image (20) (1).png" alt=""><figcaption></figcaption></figure>

**我们的主机似乎遇到了麻烦 :)**

<figure><img src="../../.gitbook/assets/image (6) (1) (1).png" alt=""><figcaption></figcaption></figure>

正如你所看到的，由于路由注入，主机与主机**172.16.100.140/32**失去了连接。

### 滥用 K-Values <a href="#25aa" id="25aa"></a>

为了建立 EIGRP 邻居关系，**路由器使用特殊的 K-Values**。这些值在所有 EIGRP 邻居之间必须相同。如果至少有一个 K-Value 不匹配，EIGRP 域将崩溃，邻居关系将中断。我们将使用 [**relationshipnightmare.py**](https://github.com/in9uz/EIGRPWN/blob/main/relationshipnightmare.py) 来执行这个攻击\*\*。\*\*

<figure><img src="../../.gitbook/assets/image (12) (2) (1).png" alt=""><figcaption></figcaption></figure>

脚本参数:

* **网络接口**
* **EIGRP AS 号码**
* **合法路由器的 IP 地址**

**代表指定的 IP，将会向多播 EIGRP IP 地址发送一个注入请求，在其中 K-Values 是不同的。**在我的情况下，我将代表路由器 GW1 **(地址为 10.10.100.100)** 断开邻居关系。
```
~$ sudo python3 relationshipnightmare.py --interface eth0 --as 1 --src 10.10.100.100
```
<figure><img src="../../.gitbook/assets/image (9) (1) (4).png" alt=""><figcaption><p>邻居中断期间的流量转储</p></figcaption></figure>

<figure><img src="../../.gitbook/assets/image (27) (1).png" alt=""><figcaption><p>GW1路由器无休止地断开和重新连接EIGRP</p></figcaption></figure>

**可以通过这种方式进行拒绝服务（DoS）攻击。在操作过程中，会发生无休止的断开和邻居尝试，导致EIGRP路由域的一部分瘫痪。**

### 路由表溢出 <a href="#1d0c" id="1d0c"></a>

这种攻击的本质是引发发送大量的虚假路由，从而溢出路由表。这会耗尽路由器的计算资源，即CPU和RAM，因为注入速度非常快。此攻击可通过[**routingtableoverflow.py**](https://github.com/in9uz/EIGRPWN/blob/main/routingtableoverflow.py)脚本实现。

<figure><img src="../../.gitbook/assets/image (3) (4).png" alt=""><figcaption></figcaption></figure>

脚本参数

* **网络接口**
* **EIGRP AS号**
* **攻击者的IP地址**
```
in9uz@Inguz:~$ sudo python3 routingtableoverflow.py --interface eth0 --as 1 --src 10.10.100.50
```
运行脚本后，路由表开始溢出。目标网络的随机地址是由于在[Scapy](https://github.com/secdev/scapy)中使用了**RandIP()**。

<figure><img src="../../.gitbook/assets/image (4) (4).png" alt=""><figcaption><p>GW1路由器上的路由表溢出</p></figcaption></figure>

<figure><img src="../../.gitbook/assets/image (21) (1).png" alt=""><figcaption><p>过载的路由器CPU</p></figcaption></figure>

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks云 ☁️</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>🐦 Twitter 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 Youtube 🎥</strong></a></summary>

* 你在一家**网络安全公司**工作吗？想要在HackTricks中**宣传你的公司**吗？或者想要**获取PEASS的最新版本或下载PDF格式的HackTricks**吗？请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 发现我们的独家[NFT收藏品**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* 获得[**官方PEASS和HackTricks周边产品**](https://peass.creator-spring.com)
* **加入**[**💬**](https://emojipedia.org/speech-balloon/) [**Discord群组**](https://discord.gg/hRep4RUj7f) 或 [**Telegram群组**](https://t.me/peass)，或者**关注**我在**Twitter**上的[**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**。**
* **通过向**[**hacktricks repo**](https://github.com/carlospolop/hacktricks) **和**[**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **提交PR来分享你的黑客技巧。**

</details>
