# EIGRP攻撃

<details>

<summary><strong>AWSハッキングをゼロからヒーローまで学ぶには</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>をご覧ください！</strong></summary>

HackTricksをサポートする他の方法:

* **HackTricksにあなたの会社を広告したい**、または**HackTricksをPDFでダウンロードしたい**場合は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS & HackTricksグッズ**](https://peass.creator-spring.com)を入手する
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクションをチェックする
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)に**参加する**か、[**telegramグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)を**フォロー**してください。
* [**HackTricks**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のgithubリポジトリにPRを提出して、あなたのハッキングのコツを**共有してください**。

</details>

**このページは** [****](https://medium.com/@in9uz/cisco-nightmare-pentesting-cisco-networks-like-a-devil-f4032eb437b9)に基づいています。詳細はこちらをご覧ください。

## EIGRPプロトコルの脆弱性の理解 <a href="#0f82" id="0f82"></a>

**EIGRP (Enhanced Interior Gateway Routing Protocol)** は、動的なディスタンスベクター型ルーティングプロトコルとして識別されます。認証やパッシブインターフェースの設定が怠られた場合、ルーティングテーブルの汚染という重大な脆弱性が観察されます。さらに、EIGRPネットワーク、または自律システムの構造は、ゾーン分割がない非セグメント化されたものです。このフラットな構造は、攻撃者によって注入されたルートが自律システム全体に伝播する可能性を意味します。

![](../../.gitbook/assets/image (25) (1).png)

EIGRPシステムを悪用する最初のステップは、正当なEIGRPルーターとの接続を確立することです。この接続は、偵察から様々な形の注入まで、幅広い範囲の活動を可能にします。これを容易にするために、UnixおよびLinuxシステム上でルーターをエミュレートするオープンソースソリューションである[**FRRouting**](https://frrouting.org/)が利用されます。**FRRouting**はBGP、OSPF、EIGRPを含む複数のプロトコルをサポートしています。攻撃者のシステム上でFRRoutingを展開することで、ルーティングドメイン内の正当なルーターを模倣することができます。FRRをシステムに展開するための詳細な手順は後ほど説明します。

### ネットワークインテリジェンスの収集 <a href="#41e6" id="41e6"></a>

ルーティングドメインへの統合により、ネットワークの列挙と偵察が可能になり、広範なスキャンに比べて時間効率の良い代替手段を提供します。このアプローチは時間を節約するだけでなく、IPS/IDSセキュリティシステムによる検出リスクを軽減します。これを実現するには**FRRouting**の展開が必要です。

`daemons`設定ファイルには変更が必要です。これはデーモンの活動を制御します。**eigrpd**デーモンをアクティブにすることが必要です。
```bash
~# nano /etc/frr/daemons
eigrpd=yes
```
![](../../.gitbook/assets/image (15) (1).png)

さらに、様々なプロトコルの設定を単一のファイルに統合するために、**vtysh.conf** ファイルの調整が必要です。
```bash
~# nano /etc/frr/vtysh.conf
service integrated-vtysh-config
```
設定後、FRRデーモンの起動とトラフィックルーティングの有効化（Linuxディストリビューションではデフォルトで無効）が必要です。
```bash
~$ sudo systemctl start frr
~$ sudo sysctl -w net.ipv4.ip_forward=1
```
```markdown
![](../../.gitbook/assets/image (32).png)

**vtysh** コマンドはFRRルーター制御パネルへのアクセスを提供します。
```
```bash
~$ sudo vtysh
```
例の使用法：
```bash
root# show version
```
```markdown
![](../../.gitbook/assets/image (3) (2) (2).png)

> 注: EIGRPルーティングドメインは認証で保護されている可能性があります。しかし、ハローパケットから暗号ハッシュを抽出し、パスワードをリセットすることでアクセスが可能になることがあります。

グローバル設定モードで、**EIGRP**プロセスを開始し、自律システム番号 — **1** とネットワークの場所を定義します。
```
```bash
root# config
root(config)# router eigrp 1
root(config-router) network 10.10.100.50/32
```
正当なEIGRPルーター（この場合、**GW1 (10.10.100.100)** と **GW2 (10.10.100.200)**）との隣接関係が確立された後、ルーターはルーティング情報を交換します。このプロセスにより、攻撃システムのルーティングテーブルに新しいルートが表示され、ペネトレーションテストを支援し、サブネットスキャンにかかる時間を節約します。この段階で、システムはEIGRPルーティングドメインの一部となり、さらなる攻撃ベクトルの開発の準備が整います。

![](../../.gitbook/assets/image (5) (1) (2).png)
![](../../.gitbook/assets/image (30) (1).png)
![](../../.gitbook/assets/image (29) (1) (2).png)

### EIGRPの悪用：攻撃ベクトル <a href="#51ee" id="51ee"></a>

#### 1. 偽のEIGRP隣接関係
EIGRP helloパケットを大量に送信することで、ルーターのCPUに過負荷をかけ、DoS攻撃への道を開きます。このために、**helloflooding.py**というスクリプトが使用されますが、そのパケット送信速度はGIL（Global Interpreter Lock）によって制限されています。パフォーマンスを向上させるために、スクリプトをC言語で書き直す計画が進行中です。

![](../../.gitbook/assets/image (2) (6) (1).png)

スクリプトの使用には以下の指定が必要です：
- ネットワークインターフェース（例：eth0）
- EIGRP自律システム番号（例：1）
- サブネットの位置（例：10.10.100.0/24）
```bash
~$ sudo python3 helloflooding.py --interface eth0 --as 1 --subnet 10.10.100.0/24
```
#### 2. EIGRP ブラックホール
この攻撃は、トラフィックの流れを妨害するために偽のルートを注入することを含み、一般的にブラックホール攻撃と呼ばれます。この目的のために **routeinject.py** スクリプトが使用されます。例えば、`172.16.100.140/32` のトラフィックを存在しない宛先にリダイレクトします。

スクリプトのパラメーターには以下が含まれます:
- 攻撃者のシステムインターフェース
- EIGRP AS 番号
- 攻撃者のIPアドレス
- ターゲットサブネットのIPとそのマスク
```bash
~$ sudo python3 routeinject.py --interface eth0 --as 1 --src 10.10.100.50 --dst 172.16.100.140 --prefix 32
```
![](../../.gitbook/assets/image (20) (1).png)

結果は、ルートインジェクションによる対象ホストへの接続喪失です。

![](../../.gitbook/assets/image (6) (1) (1).png)

#### 3. K-Valuesの悪用
EIGRPルーター間のK-valuesの不一致は、EIGRPドメインを混乱させる可能性があります。**relationshipnightmare.py** スクリプトは、変更されたK-valuesを注入することでこれを悪用し、EIGRPドメイン内で継続的な混乱と再接続を引き起こし、実質的にDoS攻撃をもたらします。

![](../../.gitbook/assets/image (12) (2) (1).png)

スクリプトに必要なもの:
- ネットワークインターフェース
- EIGRP AS番号
- 正規ルーターのIPアドレス

注入された変更は、指定されたIPからマルチキャストEIGRP IPアドレスに送信され、不一致を引き起こします。
```bash
~$ sudo python3 relationshipnightmare.py --interface eth0 --as 1 --src 10.10.100.100
```
#### 4. ルーティングテーブルオーバーフロー
この攻撃は、偽のルートでルーティングテーブルを氾濫させ、ルーターのCPUとRAMに負荷をかけます。**routingtableoverflow.py** スクリプトは、多数の偽のルートを迅速に送信することでこれを容易にします。

スクリプトパラメーター:
- ネットワークインターフェース
- EIGRP AS番号
- 攻撃者のIPアドレス

スクリプト実行後、ルーティングテーブルは偽のルートで飽和し、ルーターのパフォーマンスが著しく低下します。
```bash
sudo python3 routingtableoverflow.py --interface eth0 --as 1 --src 10.10.100.50
```
```markdown
![](../../.gitbook/assets/image (4) (4).png)
![](../../.gitbook/assets/image (21) (1).png)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)でゼロからヒーローまでAWSハッキングを学ぶ</strong></summary>

HackTricksをサポートする他の方法:

* **HackTricksにあなたの会社を広告したい場合**や**HackTricksをPDFでダウンロードしたい場合**は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS & HackTricksグッズ**](https://peass.creator-spring.com)を入手する
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクションをチェックする
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)に**参加する**か、[**テレグラムグループ**](https://t.me/peass)に参加する、または**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)を**フォローする**。
* [**HackTricks**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のgithubリポジトリにPRを提出して、あなたのハッキングのコツを**共有する**。

</details>
```
