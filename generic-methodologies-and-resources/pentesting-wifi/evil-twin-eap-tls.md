# Evil Twin EAP-TLS

<details>

<summary><strong>通过</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>从零开始学习AWS黑客攻击！</strong></summary>

支持HackTricks的其他方式：

* 如果您想在**HackTricks中看到您的公司广告**或**下载HackTricks的PDF**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取[**官方的PEASS & HackTricks商品**](https://peass.creator-spring.com)
* 发现[**PEASS家族**](https://opensea.io/collection/the-peass-family)，我们独家的[**NFTs系列**](https://opensea.io/collection/the-peass-family)
* **加入** 💬 [**Discord群组**](https://discord.gg/hRep4RUj7f) 或 [**telegram群组**](https://t.me/peass) 或在 **Twitter** 🐦 上**关注**我 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github仓库提交PR来分享您的黑客技巧。**

</details>

<img src="../../.gitbook/assets/i3.png" alt="" data-size="original">\
**Bug bounty tip**: **注册** **Intigriti**，一个由黑客创建的高级**bug赏金平台**！立即加入我们 [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks)，开始赚取高达**$100,000**的赏金！

{% embed url="https://go.intigriti.com/hacktricks" %}

在某个时刻，我需要使用下面帖子中提出的解决方案，但是[https://github.com/OpenSecurityResearch/hostapd-wpe](https://github.com/OpenSecurityResearch/hostapd-wpe)中的步骤在现代kali（2019v3）中不再适用。\
无论如何，让它们工作很容易。\
您只需要从这里下载hostapd-2.6：[https://w1.fi/releases/](https://w1.fi/releases/)，并在再次编译hostapd-wpe之前安装：`apt-get install libssl1.0-dev`

### 分析和利用无线网络中的EAP-TLS

#### 背景：无线网络中的EAP-TLS
EAP-TLS是一种安全协议，通过证书在客户端和服务器之间提供相互认证。只有在客户端和服务器相互认证对方的证书后，才会建立连接。

#### 遇到的挑战
在评估过程中，当使用`hostapd-wpe`工具时遇到了一个有趣的错误。该工具由于客户端的证书由未知的证书颁发机构（CA）签名，而拒绝了客户端的连接。这表明客户端确实信任了假服务器的证书，指向客户端安全配置上的疏忽。

#### 目标：设置中间人（MiTM）攻击
目标是修改工具以接受任何客户端证书。这将允许与恶意无线网络建立连接，并启用MiTM攻击，可能捕获明文凭据或其他敏感数据。

#### 解决方案：修改`hostapd-wpe`
对`hostapd-wpe`源代码的分析显示，客户端证书验证由OpenSSL函数`SSL_set_verify`中的一个参数（`verify_peer`）控制。通过将此参数的值从1（验证）更改为0（不验证），工具被修改为接受任何客户端证书。

#### 攻击的执行
1. **环境检查：** 使用`airodump-ng`监控无线网络并识别目标。
2. **设置假AP：** 运行修改后的`hostapd-wpe`创建一个模仿目标网络的假接入点（AP）。
3. **定制认证门户页面：** 自定义登录页面，使其看起来合法且对目标用户来说熟悉。
4. **去认证攻击：** 可选地，执行去认证攻击，将客户端从合法网络断开并连接到假AP。
5. **捕获凭据：** 一旦客户端连接到假AP并与认证门户页面交互，他们的凭据就会被捕获。

#### 攻击的观察
- 在Windows机器上，系统可能会自动连接到假AP，并在尝试网络导航时呈现认证门户页面。
- 在iPhone上，用户可能会被提示接受新证书，然后呈现认证门户页面。

#### 结论
虽然EAP-TLS被认为是安全的，但其有效性在很大程度上取决于正确的配置和最终用户的谨慎行为。配置不当的设备或不知情的用户接受恶意证书可能会破坏受EAP-TLS保护的网络的安全性。

更多详情请查看 https://versprite.com/blog/application-security/eap-tls-wireless-infrastructure/

# 参考资料
* [https://versprite.com/blog/application-security/eap-tls-wireless-infrastructure/](https://versprite.com/blog/application-security/eap-tls-wireless-infrastructure/)

<img src="../../.gitbook/assets/i3.png" alt="" data-size="original">\
**Bug bounty tip**: **注册** **Intigriti**，一个由黑客创建的高级**bug赏金平台**！立即加入我们 [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks)，开始赚取高达**$100,000**的赏金！

{% embed url="https://go.intigriti.com/hacktricks" %}

<details>

<summary><strong>通过</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>从零开始学习AWS黑客攻击！</strong></summary>

支持HackTricks的其他方式：

* 如果您想在**HackTricks中看到您的公司广告**或**下载HackTricks的PDF**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取[**官方的PEASS & HackTricks商品**](https://peass.creator-spring.com)
* 发现[**PEASS家族**](https://opensea.io/collection/the-peass-family)，我们独家的[**NFTs系列**](https://opensea.io/collection/the-peass-family)
* **加入** 💬 [**Discord群组**](https://discord.gg/hRep4RUj7f) 或 [**telegram群组**](https://t.me/peass) 或在 **Twitter** 🐦 上**关注**我 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github仓库提交PR来分享您的黑客技巧。**

</details>
