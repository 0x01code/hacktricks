# Evil Twin EAP-TLS

<details>

<summary><strong>AWSハッキングをゼロからヒーローまで学ぶ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>！</strong></summary>

HackTricksをサポートする他の方法:

* **HackTricksにあなたの会社を広告したい**、または**HackTricksをPDFでダウンロードしたい**場合は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS & HackTricksグッズ**](https://peass.creator-spring.com)を入手する
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見する、私たちの独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクション
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)に**参加する**か、[**telegramグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)を**フォローする**。
* [**HackTricks**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のgithubリポジトリにPRを提出して、あなたのハッキングのコツを共有する。

</details>

<img src="../../.gitbook/assets/i3.png" alt="" data-size="original">\
**バグバウンティのヒント**: **Intigriti**に**登録する**、ハッカーによって作られたプレミアムな**バグバウンティプラットフォーム**！今日[**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks)に参加して、最大**$100,000**のバウンティを獲得し始めましょう！

{% embed url="https://go.intigriti.com/hacktricks" %}

ある時点で、以下の投稿で提案されたソリューションを使用する必要がありましたが、[https://github.com/OpenSecurityResearch/hostapd-wpe](https://github.com/OpenSecurityResearch/hostapd-wpe)の手順はもはや現代のkali（2019v3）では機能しませんでした。\
とにかく、それらを機能させるのは簡単です。\
ここからhostapd-2.6をダウンロードするだけです：[https://w1.fi/releases/](https://w1.fi/releases/) そして、再びhostapd-wpeをコンパイルする前にインストールします：`apt-get install libssl1.0-dev`

### ワイヤレスネットワークでのEAP-TLSの分析と悪用

#### 背景: ワイヤレスネットワークのEAP-TLS
EAP-TLSは、証明書を使用してクライアントとサーバー間の相互認証を提供するセキュリティプロトコルです。接続は、クライアントとサーバーがお互いの証明書を認証した場合にのみ確立されます。

#### 遭遇した課題
評価中に、`hostapd-wpe`ツールを使用しているときに興味深いエラーが発生しました。ツールは、クライアントの証明書が未知の証明機関（CA）によって署名されているため、クライアントの接続を拒否しました。これは、クライアントが偽のサーバーの証明書を信頼していることを示しており、クライアント側のセキュリティ設定が緩いことを指摘しています。

#### 目的: 中間者攻撃（MiTM）の設定
目標は、ツールを変更して任意のクライアント証明書を受け入れるようにすることでした。これにより、悪意のあるワイヤレスネットワークとの接続が可能になり、MiTM攻撃を実行し、プレーンテキストの資格情報やその他の機密データをキャプチャする可能性があります。

#### `hostapd-wpe`の変更
`hostapd-wpe`のソースコードの分析により、クライアント証明書の検証はOpenSSL関数`SSL_set_verify`のパラメータ（`verify_peer`）によって制御されていることが明らかになりました。このパラメータの値を1（検証する）から0（検証しない）に変更することで、ツールは任意のクライアント証明書を受け入れるようになりました。

#### 攻撃の実行
1. **環境チェック:** `airodump-ng`を使用してワイヤレスネットワークを監視し、ターゲットを特定します。
2. **偽APの設定:** 変更された`hostapd-wpe`を実行して、ターゲットネットワークを模倣する偽のアクセスポイント（AP）を作成します。
3. **キャプティブポータルのカスタマイズ:** ターゲットユーザーにとって正当で馴染みのあるように、キャプティブポータルのログインページをカスタマイズします。
4. **認証解除攻撃:** オプションで、クライアントを正規のネットワークから切断し、偽のAPに接続させるために認証解除攻撃を実行します。
5. **資格情報のキャプチャ:** クライアントが偽のAPに接続し、キャプティブポータルと対話すると、その資格情報がキャプチャされます。

#### 攻撃からの観察
- Windowsマシンでは、システムが自動的に偽のAPに接続し、ウェブナビゲーションを試みるとキャプティブポータルが表示される可能性があります。
- iPhoneでは、ユーザーに新しい証明書を受け入れるように促され、その後キャプティブポータルが表示されることがあります。

#### 結論
EAP-TLSは安全と考えられていますが、その効果は正しい設定とエンドユーザーの慎重な行動に大きく依存しています。誤って設定されたデバイスや、悪質な証明書を受け入れることを疑わないユーザーは、EAP-TLSで保護されたネットワークのセキュリティを損なう可能性があります。

詳細については https://versprite.com/blog/application-security/eap-tls-wireless-infrastructure/ をチェックしてください。

# 参考文献
* [https://versprite.com/blog/application-security/eap-tls-wireless-infrastructure/](https://versprite.com/blog/application-security/eap-tls-wireless-infrastructure/)

<img src="../../.gitbook/assets/i3.png" alt="" data-size="original">\
**バグバウンティのヒント**: **Intigriti**に**登録する**、ハッカーによって作られたプレミアムな**バグバウンティプラットフォーム**！今日[**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks)に参加して、最大**$100,000**のバウンティを獲得し始めましょう！

{% embed url="https://go.intigriti.com/hacktricks" %}

<details>

<summary><strong>AWSハッキングをゼロからヒーローまで学ぶ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>！</strong></summary>

HackTricksをサポートする他の方法:

* **HackTricksにあなたの会社を広告したい**、または**HackTricksをPDFでダウンロードしたい**場合は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS & HackTricksグッズ**](https://peass.creator-spring.com)を入手する
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見する、私たちの独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクション
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)に**参加する**か、[**telegramグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)を**フォローする**。
* [**HackTricks**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のgithubリポジトリにPRを提出して、あなたのハッキングのコツを共有する。

</details>
