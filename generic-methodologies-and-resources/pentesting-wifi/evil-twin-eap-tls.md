# Evil Twin EAP-TLS

<details>

<summary><strong>Lernen Sie AWS-Hacking von Null auf Held mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks bewerben m√∂chten** oder **HackTricks als PDF herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merchandise**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositories senden.

</details>

<img src="../../.gitbook/assets/i3.png" alt="" data-size="original">\
**Bug-Bounty-Tipp**: **Melden Sie sich an** f√ºr **Intigriti**, eine Premium-**Bug-Bounty-Plattform, die von Hackern f√ºr Hacker erstellt wurde**! Treten Sie uns noch heute unter [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) bei und verdienen Sie Pr√§mien von bis zu **100.000 $**!

{% embed url="https://go.intigriti.com/hacktricks" %}

Irgendwann musste ich die vorgeschlagene L√∂sung im folgenden Beitrag verwenden, aber die Schritte in [https://github.com/OpenSecurityResearch/hostapd-wpe](https://github.com/OpenSecurityResearch/hostapd-wpe) funktionierten nicht mehr in modernem Kali (2019v3).\
Wie auch immer, es ist einfach, sie zum Laufen zu bringen.\
Sie m√ºssen nur den hostapd-2.6 von hier herunterladen: [https://w1.fi/releases/](https://w1.fi/releases/) und vor der erneuten Kompilierung von hostapd-wpe installieren: `apt-get install libssl1.0-dev`

### Analyse und Ausnutzung von EAP-TLS in drahtlosen Netzwerken

#### Hintergrund: EAP-TLS in drahtlosen Netzwerken
EAP-TLS ist ein Sicherheitsprotokoll, das eine gegenseitige Authentifizierung zwischen Client und Server mithilfe von Zertifikaten erm√∂glicht. Die Verbindung wird nur hergestellt, wenn sowohl der Client als auch der Server die Zertifikate des jeweils anderen authentifizieren.

#### Herausforderung
W√§hrend einer Bewertung wurde ein interessanter Fehler festgestellt, als das Tool `hostapd-wpe` verwendet wurde. Das Tool lehnte die Verbindung des Clients ab, da das Zertifikat des Clients von einer unbekannten Zertifizierungsstelle (CA) signiert wurde. Dies deutete darauf hin, dass der Client dem gef√§lschten Serverzertifikat vertraute und auf eine nachl√§ssige Sicherheitskonfiguration auf der Clientseite hinwies.

#### Ziel: Ein Man-in-the-Middle (MiTM)-Angriff einrichten
Das Ziel bestand darin, das Tool so zu √§ndern, dass es jedes Clientzertifikat akzeptiert. Dadurch konnte eine Verbindung mit dem b√∂sartigen drahtlosen Netzwerk hergestellt und ein MiTM-Angriff erm√∂glicht werden, bei dem m√∂glicherweise Klartext-Anmeldeinformationen oder andere sensible Daten erfasst werden.

#### L√∂sung: Modifizierung von `hostapd-wpe`
Die Analyse des Quellcodes von `hostapd-wpe` ergab, dass die Validierung des Clientzertifikats von einem Parameter (`verify_peer`) in der OpenSSL-Funktion `SSL_set_verify` gesteuert wurde. Durch √Ñndern des Werts dieses Parameters von 1 (validieren) auf 0 (nicht validieren) wurde das Tool dazu gebracht, jedes Clientzertifikat zu akzeptieren.

#### Ausf√ºhrung des Angriffs
1. **√úberpr√ºfung der Umgebung:** Verwenden Sie `airodump-ng`, um drahtlose Netzwerke zu √ºberwachen und Ziele zu identifizieren.
2. **Einrichten eines gef√§lschten AP:** F√ºhren Sie das modifizierte `hostapd-wpe` aus, um einen gef√§lschten Access Point (AP) zu erstellen, der das Zielnetzwerk imitiert.
3. **Anpassung des Captive Portals:** Passen Sie die Anmeldeseite des Captive Portals an, um f√ºr den Zielbenutzer legitim und vertraut auszusehen.
4. **Deauthentifizierungsangriff:** Optional kann ein Deauthentifizierungsangriff durchgef√ºhrt werden, um den Client von dem legitimen Netzwerk zu trennen und mit dem gef√§lschten AP zu verbinden.
5. **Erfassung von Anmeldeinformationen:** Sobald der Client eine Verbindung zum gef√§lschten AP herstellt und mit dem Captive Portal interagiert, werden seine Anmeldeinformationen erfasst.

#### Beobachtungen aus dem Angriff
- Auf Windows-Maschinen kann das System automatisch eine Verbindung zum gef√§lschten AP herstellen und das Captive Portal anzeigen, wenn eine Webnavigation versucht wird.
- Auf einem iPhone wird der Benutzer m√∂glicherweise aufgefordert, ein neues Zertifikat zu akzeptieren und dann das Captive Portal anzuzeigen.

#### Fazit
Obwohl EAP-TLS als sicher gilt, h√§ngt seine Wirksamkeit stark von der korrekten Konfiguration und dem vorsichtigen Verhalten der Endbenutzer ab. Falsch konfigurierte Ger√§te oder arglose Benutzer, die gef√§lschte Zertifikate akzeptieren, k√∂nnen die Sicherheit eines durch EAP-TLS gesch√ºtzten Netzwerks untergraben.

Weitere Informationen finden Sie unter https://versprite.com/blog/application-security/eap-tls-wireless-infrastructure/

## Referenzen
* [https://versprite.com/blog/application-security/eap-tls-wireless-infrastructure/](https://versprite.com/blog/application-security/eap-tls-wireless-infrastructure/)

<img src="../../.gitbook/assets/i3.png" alt="" data-size="original">\
**Bug-Bounty-Tipp**: **Melden Sie sich an** f√ºr **Intigriti**, eine Premium-**Bug-Bounty-Plattform, die von Hackern f√ºr Hacker erstellt wurde**! Treten Sie uns noch heute unter [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) bei und verdienen Sie Pr√§mien von bis zu **100.000 $**!

{% embed url="https://go.intigriti.com/hacktricks" %}

<details>

<summary><strong>Lernen Sie AWS-Hacking von Null auf Held mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks bewerben m√∂chten** oder **HackTricks als PDF herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merchandise**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositories senden.

</details>
