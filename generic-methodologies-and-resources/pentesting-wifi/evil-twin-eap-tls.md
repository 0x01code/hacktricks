# B√∂ser Zwillings-EAP-TLS

{% hint style="success" %}
Lernen & √ºben Sie AWS-Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Lernen & √ºben Sie GCP-Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtzen Sie HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) Github-Repositorys einreichen.

</details>
{% endhint %}

<img src="../../.gitbook/assets/i3.png" alt="" data-size="original">\
**Bug-Bounty-Tipp**: **Melden Sie sich an** f√ºr **Intigriti**, eine Premium-**Bug-Bounty-Plattform, die von Hackern f√ºr Hacker erstellt wurde! Treten Sie uns bei [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) heute bei und beginnen Sie, Pr√§mien von bis zu **100.000 $** zu verdienen!

{% embed url="https://go.intigriti.com/hacktricks" %}

Irgendwann musste ich die vorgeschlagene L√∂sung aus dem unten stehenden Beitrag verwenden, aber die Schritte in [https://github.com/OpenSecurityResearch/hostapd-wpe](https://github.com/OpenSecurityResearch/hostapd-wpe) funktionierten nicht mehr in modernen Kali-Versionen (2019v3).\
Wie auch immer, es ist einfach, sie zum Laufen zu bringen.\
Sie m√ºssen nur den hostapd-2.6 von hier herunterladen: [https://w1.fi/releases/](https://w1.fi/releases) und bevor Sie hostapd-wpe erneut kompilieren, installieren Sie: `apt-get install libssl1.0-dev`

### Analyse und Ausnutzung von EAP-TLS in drahtlosen Netzwerken

#### Hintergrund: EAP-TLS in drahtlosen Netzwerken
EAP-TLS ist ein Sicherheitsprotokoll, das eine gegenseitige Authentifizierung zwischen Client und Server mithilfe von Zertifikaten bereitstellt. Die Verbindung wird nur hergestellt, wenn sowohl der Client als auch der Server die Zertifikate des anderen authentifizieren.

#### Herausforderung
W√§hrend einer Bewertung wurde ein interessanter Fehler festgestellt, als das Tool `hostapd-wpe` verwendet wurde. Das Tool lehnte die Verbindung des Clients ab, da das Zertifikat des Clients von einer unbekannten Zertifizierungsstelle (CA) signiert wurde. Dies deutete darauf hin, dass der Client dem gef√§lschten Serverzertifikat vertraute und auf nachl√§ssige Sicherheitskonfigurationen auf der Clientseite hinwies.

#### Ziel: Ein Man-in-the-Middle (MiTM)-Angriff einrichten
Das Ziel war es, das Tool so zu √§ndern, dass es jedes Client-Zertifikat akzeptiert. Dadurch w√ºrde die Verbindung mit dem b√∂sartigen drahtlosen Netzwerk hergestellt und ein MiTM-Angriff erm√∂glicht, bei dem potenziell Klartext-Anmeldeinformationen oder andere sensible Daten erfasst werden k√∂nnten.

#### L√∂sung: Modifizierung von `hostapd-wpe`
Die Analyse des Quellcodes von `hostapd-wpe` ergab, dass die Validierung des Client-Zertifikats von einem Parameter (`verify_peer`) in der OpenSSL-Funktion `SSL_set_verify` gesteuert wurde. Durch √Ñndern des Werts dieses Parameters von 1 (validieren) auf 0 (nicht validieren) wurde das Tool so modifiziert, dass es jedes Client-Zertifikat akzeptiert.

#### Ausf√ºhrung des Angriffs
1. **Umgebungspr√ºfung:** Verwenden Sie `airodump-ng`, um drahtlose Netzwerke zu √ºberwachen und Ziele zu identifizieren.
2. **Falschen AP einrichten:** F√ºhren Sie das modifizierte `hostapd-wpe` aus, um einen gef√§lschten Access Point (AP) zu erstellen, der das Zielnetzwerk imitiert.
3. **Anpassung des Captive Portals:** Passen Sie die Login-Seite des Captive Portals an, um f√ºr den Zielbenutzer legitim und vertraut zu erscheinen.
4. **Deauthentifizierungsangriff:** Optional kann ein Deauthentifizierungsangriff durchgef√ºhrt werden, um den Client vom legitimen Netzwerk zu trennen und mit dem gef√§lschten AP zu verbinden.
5. **Erfassung von Anmeldeinformationen:** Sobald der Client eine Verbindung zum gef√§lschten AP herstellt und mit dem Captive Portal interagiert, werden seine Anmeldeinformationen erfasst.

#### Beobachtungen aus dem Angriff
- Auf Windows-Maschinen kann das System automatisch eine Verbindung zum gef√§lschten AP herstellen und das Captive Portal anzeigen, wenn versucht wird, im Web zu navigieren.
- Auf einem iPhone wird der Benutzer m√∂glicherweise aufgefordert, ein neues Zertifikat zu akzeptieren und dann mit dem Captive Portal konfrontiert.

#### Fazit
Obwohl EAP-TLS als sicher gilt, h√§ngt seine Wirksamkeit stark von der korrekten Konfiguration und dem vorsichtigen Verhalten der Endbenutzer ab. Fehlkonfigurierte Ger√§te oder arglose Benutzer, die Rogue-Zertifikate akzeptieren, k√∂nnen die Sicherheit eines durch EAP-TLS gesch√ºtzten Netzwerks untergraben.

F√ºr weitere Details siehe https://versprite.com/blog/application-security/eap-tls-wireless-infrastructure/

## Referenzen
* [https://versprite.com/blog/application-security/eap-tls-wireless-infrastructure/](https://versprite.com/blog/application-security/eap-tls-wireless-infrastructure/)

<img src="../../.gitbook/assets/i3.png" alt="" data-size="original">\
**Bug-Bounty-Tipp**: **Melden Sie sich an** f√ºr **Intigriti**, eine Premium-**Bug-Bounty-Plattform, die von Hackern f√ºr Hacker erstellt wurde! Treten Sie uns bei [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) heute bei und beginnen Sie, Pr√§mien von bis zu **100.000 $** zu verdienen!

{% embed url="https://go.intigriti.com/hacktricks" %}

{% hint style="success" %}
Lernen & √ºben Sie AWS-Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Lernen & √ºben Sie GCP-Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtzen Sie HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) Github-Repositorys einreichen.

</details>
{% endhint %}
