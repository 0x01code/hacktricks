# Evil Twin EAP-TLS

<details>

<summary><strong>Aprende hacking en AWS de cero a h칠roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver a tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** revisa los [**PLANES DE SUSCRIPCI칍N**](https://github.com/sponsors/carlospolop)!
* Consigue el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci칩n de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s칤gueme** en **Twitter** 游냕 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de GitHub de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

<img src="../../.gitbook/assets/i3.png" alt="" data-size="original">\
**Consejo para cazar recompensas**: **reg칤strate** en **Intigriti**, una plataforma premium de caza de recompensas creada por hackers, para hackers. 칔nete a nosotros en [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) hoy, y comienza a ganar recompensas de hasta **$100,000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

En alg칰n momento necesit칠 usar la soluci칩n propuesta en el post de abajo pero los pasos en [https://github.com/OpenSecurityResearch/hostapd-wpe](https://github.com/OpenSecurityResearch/hostapd-wpe) ya no funcionaban en kali moderno (2019v3).\
De todos modos, es f치cil hacer que funcionen.\
Solo necesitas descargar hostapd-2.6 de aqu칤: [https://w1.fi/releases/](https://w1.fi/releases/) y antes de compilar nuevamente hostapd-wpe instalar: `apt-get install libssl1.0-dev`

### Analizando y Explotando EAP-TLS en Redes Inal치mbricas

#### Antecedentes: EAP-TLS en Redes Inal치mbricas
EAP-TLS es un protocolo de seguridad que proporciona autenticaci칩n mutua entre cliente y servidor mediante certificados. La conexi칩n solo se establece si tanto el cliente como el servidor autentican los certificados del otro.

#### Desaf칤o Encontrado
Durante una evaluaci칩n, se encontr칩 un error interesante al usar la herramienta `hostapd-wpe`. La herramienta rechaz칩 la conexi칩n del cliente debido a que el certificado del cliente estaba firmado por una Autoridad de Certificaci칩n (CA) desconocida. Esto indicaba que el cliente s칤 confiaba en el certificado del servidor falso, se침alando configuraciones de seguridad laxas en el lado del cliente.

#### Objetivo: Configurar un Ataque Man-in-the-Middle (MiTM)
El objetivo era modificar la herramienta para aceptar cualquier certificado de cliente. Esto permitir칤a el establecimiento de una conexi칩n con la red inal치mbrica maliciosa y habilitar un ataque MiTM, capturando potencialmente credenciales en texto plano u otros datos sensibles.

#### Soluci칩n: Modificar `hostapd-wpe`
El an치lisis del c칩digo fuente de `hostapd-wpe` revel칩 que la validaci칩n del certificado del cliente estaba controlada por un par치metro (`verify_peer`) en la funci칩n de OpenSSL `SSL_set_verify`. Al cambiar el valor de este par치metro de 1 (validar) a 0 (no validar), se logr칩 que la herramienta aceptara cualquier certificado de cliente.

#### Ejecuci칩n del Ataque
1. **Verificaci칩n del Entorno:** Utilizar `airodump-ng` para monitorear redes inal치mbricas e identificar objetivos.
2. **Configurar AP Falso:** Ejecutar `hostapd-wpe` modificado para crear un Punto de Acceso (AP) falso que imite la red objetivo.
3. **Personalizaci칩n del Portal Cautivo:** Personalizar la p치gina de inicio de sesi칩n del portal cautivo para que parezca leg칤tima y familiar para el usuario objetivo.
4. **Ataque de Desautenticaci칩n:** Opcionalmente, realizar un ataque de desautenticaci칩n para desconectar al cliente de la red leg칤tima y conectarlo al AP falso.
5. **Captura de Credenciales:** Una vez que el cliente se conecta al AP falso e interact칰a con el portal cautivo, se capturan sus credenciales.

#### Observaciones del Ataque
- En m치quinas Windows, el sistema podr칤a conectarse autom치ticamente al AP falso, presentando el portal cautivo cuando se intenta navegar por la web.
- En un iPhone, se podr칤a solicitar al usuario que acepte un nuevo certificado y luego se le presentar칤a el portal cautivo.

#### Conclusi칩n
Aunque se considera que EAP-TLS es seguro, su efectividad depende en gran medida de la configuraci칩n correcta y del comportamiento cauteloso de los usuarios finales. Los dispositivos mal configurados o los usuarios desprevenidos que aceptan certificados fraudulentos pueden socavar la seguridad de una red protegida por EAP-TLS.

Para m치s detalles consulta https://versprite.com/blog/application-security/eap-tls-wireless-infrastructure/

# Referencias
* [https://versprite.com/blog/application-security/eap-tls-wireless-infrastructure/](https://versprite.com/blog/application-security/eap-tls-wireless-infrastructure/)

<img src="../../.gitbook/assets/i3.png" alt="" data-size="original">\
**Consejo para cazar recompensas**: **reg칤strate** en **Intigriti**, una plataforma premium de caza de recompensas creada por hackers, para hackers. 칔nete a nosotros en [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) hoy, y comienza a ganar recompensas de hasta **$100,000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

<details>

<summary><strong>Aprende hacking en AWS de cero a h칠roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver a tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** revisa los [**PLANES DE SUSCRIPCI칍N**](https://github.com/sponsors/carlospolop)!
* Consigue el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci칩n de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s칤gueme** en **Twitter** 游냕 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de GitHub de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
