# 恶意双子EAP-TLS

{% hint style="success" %}
学习和实践AWS黑客：<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks培训AWS红队专家（ARTE）**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
学习和实践GCP黑客：<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks培训GCP红队专家（GRTE）**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>支持HackTricks</summary>

* 查看[**订阅计划**](https://github.com/sponsors/carlospolop)!
* **加入** 💬 [**Discord群**](https://discord.gg/hRep4RUj7f) 或 [**电报群**](https://t.me/peass) 或 **关注**我们的**Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* 通过向[**HackTricks**](https://github.com/carlospolop/hacktricks)和[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github仓库提交PR来分享黑客技巧。

</details>
{% endhint %}

<img src="../../.gitbook/assets/i3.png" alt="" data-size="original">\
**赏金提示**：**注册**Intigriti，这是一个由黑客创建的高级**赏金平台**！立即加入我们：[**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks)，开始赚取高达**$100,000**的赏金！

{% embed url="https://go.intigriti.com/hacktricks" %}

在某个时候，我需要使用下面帖子中提出的解决方案，但是[https://github.com/OpenSecurityResearch/hostapd-wpe](https://github.com/OpenSecurityResearch/hostapd-wpe)中的步骤在现代kali（2019v3）中不再起作用。\
无论如何，很容易让它们起作用。\
您只需要从这里下载hostapd-2.6：[https://w1.fi/releases/](https://w1.fi/releases)，并在重新编译hostapd-wpe之前安装：`apt-get install libssl1.0-dev`

### 分析和利用无线网络中的EAP-TLS

#### 背景：无线网络中的EAP-TLS
EAP-TLS是一种安全协议，使用证书在客户端和服务器之间提供相互认证。只有在客户端和服务器互相验证彼此的证书时，连接才会建立。

#### 遇到的挑战
在评估过程中，使用`hostapd-wpe`工具时遇到了一个有趣的错误。由于客户端的证书是由未知的证书颁发机构（CA）签名的，该工具拒绝了客户端的连接。这表明客户端信任了伪造服务器的证书，指向客户端端口的安全配置不严格。

#### 目标：设置中间人攻击（MiTM）攻击
目标是修改工具以接受任何客户端证书。这将允许与恶意无线网络建立连接，并启用MiTM攻击，可能捕获明文凭据或其他敏感数据。

#### 解决方案：修改`hostapd-wpe`
对`hostapd-wpe`的源代码进行分析，发现客户端证书验证由OpenSSL函数`SSL_set_verify`中的一个参数（`verify_peer`）控制。通过将此参数的值从1（验证）更改为0（不验证），工具被修改为接受任何客户端证书。

#### 攻击的执行
1. **环境检查：**使用`airodump-ng`监视无线网络并识别目标。
2. **设置虚假AP：**运行修改后的`hostapd-wpe`创建一个模拟目标网络的虚假接入点（AP）。
3. **定制强制门户：**定制强制门户的登录页面，使其看起来合法且对目标用户熟悉。
4. **去认证攻击：**可选择执行去认证攻击，将客户端从合法网络断开连接并将其连接到虚假AP。
5. **捕获凭据：**一旦客户端连接到虚假AP并与强制门户交互，它们的凭据就会被捕获。

#### 攻击的观察
- 在Windows机器上，系统可能会自动连接到虚假AP，在尝试进行网页导航时显示强制门户。
- 在iPhone上，用户可能会被提示接受新证书，然后显示强制门户。

#### 结论
虽然EAP-TLS被认为是安全的，但其有效性在很大程度上取决于正确的配置和终端用户的谨慎行为。配置错误的设备或毫不知情的用户接受伪造证书可能会破坏EAP-TLS保护网络的安全性。

有关更多详细信息，请查看https://versprite.com/blog/application-security/eap-tls-wireless-infrastructure/

## 参考资料
* [https://versprite.com/blog/application-security/eap-tls-wireless-infrastructure/](https://versprite.com/blog/application-security/eap-tls-wireless-infrastructure/)

<img src="../../.gitbook/assets/i3.png" alt="" data-size="original">\
**赏金提示**：**注册**Intigriti，这是一个由黑客创建的高级**赏金平台**！立即加入我们：[**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks)，开始赚取高达**$100,000**的赏金！

{% embed url="https://go.intigriti.com/hacktricks" %}

{% hint style="success" %}
学习和实践AWS黑客：<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks培训AWS红队专家（ARTE）**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
学习和实践GCP黑客：<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks培训GCP红队专家（GRTE）**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>支持HackTricks</summary>

* 查看[**订阅计划**](https://github.com/sponsors/carlospolop)!
* **加入** 💬 [**Discord群**](https://discord.gg/hRep4RUj7f) 或 [**电报群**](https://t.me/peass) 或 **关注**我们的**Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* 通过向[**HackTricks**](https://github.com/carlospolop/hacktricks)和[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github仓库提交PR来分享黑客技巧。

</details>
{% endhint %}
