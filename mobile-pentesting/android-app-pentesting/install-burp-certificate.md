# Burp рдкреНрд░рдорд╛рдгрдкрддреНрд░ рд╕реНрдерд╛рдкрд┐рдд рдХрд░реЗрдВ

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>тШБя╕П HackTricks Cloud тШБя╕П</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ЁЯРж Twitter ЁЯРж</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ЁЯОЩя╕П Twitch ЁЯОЩя╕П</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ЁЯОе Youtube ЁЯОе</strong></a></summary>

* рдХреНрдпрд╛ рдЖрдк **рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХрдВрдкрдиреА** рдореЗрдВ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ? рдХреНрдпрд╛ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗ**? рдпрд╛ рдХреНрдпрд╛ рдЖрдк **PEASS рдХреЗ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рддрдХ рдкрд╣реБрдБрдЪрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ**? [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдУрдВ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ!
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* **[**ЁЯТм**](https://emojipedia.org/speech-balloon/) [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ рдпрд╛ [**telegram рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ рдпрд╛ рдореБрдЭреЗ **Twitter** рдкрд░ **рдлреЙрд▓реЛ** рдХрд░реЗрдВ [**ЁЯРж**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, [**hacktricks repo**](https://github.com/carlospolop/hacktricks) рдФрд░ [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ.**

</details>

## рд╡рд░реНрдЪреБрдЕрд▓ рдорд╢реАрди рдкрд░

рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ рдЖрдкрдХреЛ Burp рд╕реЗ Der рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред рдЖрдк рдпрд╣ _**Proxy**_ --> _**Options**_ --> _**Import / Export CA certificate**_ рдореЗрдВ рдЬрд╛рдХрд░ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

![](<../../.gitbook/assets/image (367).png>)

**Der рдкреНрд░рд╛рд░реВрдк рдореЗрдВ рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдирд┐рд░реНрдпрд╛рдд рдХрд░реЗрдВ** рдФрд░ рдЗрд╕реЗ рдРрд╕реЗ рд░реВрдк рдореЗрдВ **рдкрд░рд┐рд╡рд░реНрддрд┐рдд** рдХрд░реЗрдВ рдЬрд┐рд╕реЗ **Android** рд╕рдордЭ рд╕рдХреЗред рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ **AVD рдореЗрдВ Android рдорд╢реАрди рдкрд░ burp рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП** рдЖрдкрдХреЛ рдЗрд╕ рдорд╢реАрди рдХреЛ **`-writable-system`** рд╡рд┐рдХрд▓реНрдк рдХреЗ рд╕рд╛рде **рдЪрд▓рд╛рдирд╛** рд╣реЛрдЧрд╛ред\
рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП рдЖрдк рдЗрд╕реЗ рдЗрд╕ рддрд░рд╣ рдЪрд▓рд╛ рд╕рдХрддреЗ рд╣реИрдВ:

{% code overflow="wrap" %}
```bash
C:\Users\<UserName>\AppData\Local\Android\Sdk\tools\emulator.exe -avd "AVD9" -http-proxy 192.168.1.12:8080 -writable-system
```
{% endcode %}

рдлрд┐рд░, **burp рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП**:

{% code overflow="wrap" %}
```bash
openssl x509 -inform DER -in burp_cacert.der -out burp_cacert.pem
CERTHASHNAME="`openssl x509 -inform PEM -subject_hash_old -in burp_cacert.pem | head -1`.0"
mv burp_cacert.pem $CERTHASHNAME #Correct name
adb root && sleep 2 && adb remount #Allow to write on /syste
adb push $CERTHASHNAME /sdcard/ #Upload certificate
adb shell mv /sdcard/$CERTHASHNAME /system/etc/security/cacerts/ #Move to correct location
adb shell chmod 644 /system/etc/security/cacerts/$CERTHASHNAME #Assign privileges
adb reboot #Now, reboot the machine
```
{% endcode %}

рдорд╢реАрди рдкреБрдирдГ рдЖрд░рдВрдн рд╣реЛрдиреЗ рдХреЗ рдмрд╛рдж, рдмрд░реНрдк рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдЙрд╕рдХреЗ рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдореЗрдВ рд▓рд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛!

## Magisc рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛

рдпрджрд┐ рдЖрдкрдиреЗ рдЕрдкрдиреЗ рдбрд┐рд╡рд╛рдЗрд╕ рдХреЛ Magisc рдХреЗ рд╕рд╛рде рд░реВрдЯ рдХрд┐рдпрд╛ рд╣реИ (рд╢рд╛рдпрдж рдПрдХ рдПрдореБрд▓реЗрдЯрд░), рдФрд░ рдЖрдк рдкрд┐рдЫрд▓реЗ рдЪрд░рдгреЛрдВ рдХрд╛ рдкрд╛рд▓рди рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдХреНрдпреЛрдВрдХрд┐ рдлрд╛рдЗрд▓рд╕рд┐рд╕реНрдЯрдо рдХреЗрд╡рд▓-рдкрдврд╝рдиреЗ рдХреЗ рд▓рд┐рдП рд╣реИ рдФрд░ рдЖрдк рдЗрд╕реЗ рд▓рд┐рдЦрдиреЗ рдпреЛрдЧреНрдп рд░реВрдк рдореЗрдВ рдкреБрдирдГ рдорд╛рдЙрдВрдЯ рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рддреЛ рдПрдХ рдФрд░ рддрд░реАрдХрд╛ рд╣реИред

[**рдЗрд╕ рд╡реАрдбрд┐рдпреЛ**](https://www.youtube.com/watch?v=qQicUW0svB8) рдореЗрдВ рдмрддрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ рдХрд┐ рдЖрдкрдХреЛ рдХреНрдпрд╛ рдХрд░рдирд╛ рд╣реИ:

1. **CA рдкреНрд░рдорд╛рдгрдкрддреНрд░ рд╕реНрдерд╛рдкрд┐рдд рдХрд░реЗрдВ**: рдмрд╕ DER Burp рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдХреЛ `.crt` рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдореЗрдВ рдмрджрд▓рдХрд░ рдореЛрдмрд╛рдЗрд▓ рдореЗрдВ **рдЦреАрдВрдЪреЗрдВ рдФрд░ рдЫреЛрдбрд╝реЗрдВ** рддрд╛рдХрд┐ рдпрд╣ рдбрд╛рдЙрдирд▓реЛрдб рдлреЛрд▓реНрдбрд░ рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реЛ рдЬрд╛рдП рдФрд░ `Install a certificate` -> `CA certificate` рдкрд░ рдЬрд╛рдПрдВ

<figure><img src="../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt="" width="164"><figcaption></figcaption></figure>

* `Trusted credentials` -> `USER` рдкрд░ рдЬрд╛рдХрд░ рдЬрд╛рдВрдЪреЗрдВ рдХрд┐ рдкреНрд░рдорд╛рдгрдкрддреНрд░ рд╕рд╣реА рдврдВрдЧ рд╕реЗ рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реБрдЖ рд╣реИ

<figure><img src="../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt="" width="334"><figcaption></figcaption></figure>

2. **рдЗрд╕реЗ рд╕рд┐рд╕реНрдЯрдо рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рдмрдирд╛рдПрдВ**: Magisc рдореЙрдбреНрдпреВрд▓ [MagiskTrustUserCerts](https://github.com/NVISOsecurity/MagiskTrustUserCerts) (рдПрдХ .zip рдлрд╛рдЗрд▓) рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ, рдЗрд╕реЗ рдлреЛрди рдореЗрдВ **рдЦреАрдВрдЪреЗрдВ рдФрд░ рдЫреЛрдбрд╝реЗрдВ**, рдлреЛрди рдореЗрдВ **Magics рдРрдк** рдкрд░ рдЬрд╛рдПрдВ **`Modules`** рд╕реЗрдХреНрд╢рди рдореЗрдВ, **`Install from storage`** рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВ, .zip рдореЙрдбреНрдпреВрд▓ рдХреЛ рдЪреБрдиреЗрдВ рдФрд░ рдЗрдВрд╕реНрдЯреЙрд▓ рд╣реЛрдиреЗ рдХреЗ рдмрд╛рдж рдлреЛрди рдХреЛ **рдкреБрдирдГ рдЖрд░рдВрдн** рдХрд░реЗрдВ:

<figure><img src="../../.gitbook/assets/image (2) (1) (1) (1) (1) (1) (1) (1).png" alt="" width="345"><figcaption></figcaption></figure>

* рдкреБрдирдГ рдЖрд░рдВрдн рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, `Trusted credentials` -> `SYSTEM` рдкрд░ рдЬрд╛рдПрдВ рдФрд░ рдЬрд╛рдВрдЪреЗрдВ рдХрд┐ Postswigger рдкреНрд░рдорд╛рдгрдкрддреНрд░ рд╡рд╣рд╛рдВ рд╣реИ

<figure><img src="../../.gitbook/assets/image (3) (1) (1) (1).png" alt="" width="314"><figcaption></figcaption></figure>

## рдПрдВрдбреНрд░реЙрдЗрдб 14 рдХреЗ рдмрд╛рдж

рдкрд░рд┐рд╡рд░реНрддрди:

* рдЕрдм рддрдХ, рд╕рд┐рд╕реНрдЯрдо-рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп CA рдкреНрд░рдорд╛рдгрдкрддреНрд░ **`/system/etc/security/cacerts/`** рдореЗрдВ рд░рд╣рддреЗ рдереЗред рдПрдХ рдорд╛рдирдХ AOSP рдПрдореБрд▓реЗрдЯрд░ рдкрд░, рдЗрдиреНрд╣реЗрдВ рд░реВрдЯ рдПрдХреНрд╕реЗрд╕ рдХреЗ рд╕рд╛рде рд╕реАрдзреЗ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рдерд╛, рдЬрд┐рд╕рд╕реЗ рддреБрд░рдВрдд **рд╣рд░ рдЬрдЧрд╣ рдкреНрд░рднрд╛рд╡** рдкрдбрд╝рддрд╛ рдерд╛ред
* рдПрдВрдбреНрд░реЙрдЗрдб 14 рдореЗрдВ, рд╕рд┐рд╕реНрдЯрдо-рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп CA рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдЖрдорддреМрд░ рдкрд░ **`/apex/com.android.conscrypt/cacerts`** рдореЗрдВ рд░рд╣реЗрдВрдЧреЗ, рдФрд░ **`/apex` рдХрд╛ рдкреВрд░рд╛ рд╣рд┐рд╕реНрд╕рд╛ рдЕрдкрд░рд┐рд╡рд░реНрддрдиреАрдп рд╣реИ**ред
* **APEX cacerts рдкрде рдХреЛ рдкреБрдирдГ рдорд╛рдЙрдВрдЯ рдХрд░рдирд╛ рдЬреИрд╕реЗ рд▓рд┐рдЦрдиреЗ рдпреЛрдЧреНрдп рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛** - рдкреБрдирдГ рдорд╛рдЙрдВрдЯ рд╕рд┐рд░реНрдл рд╡рд┐рдлрд▓ рд╣реЛ рдЬрд╛рддреЗ рд╣реИрдВред рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рдпрджрд┐ рдЖрдк рд░реВрдЯ рд╢реЗрд▓ рд╕реЗ рдкреВрд░реЗ рдкрде рдХреЛ рдЕрдирдорд╛рдЙрдВрдЯ рднреА рдХрд░ рджреЗрддреЗ рд╣реИрдВ, рддреЛ рдРрдкреНрд╕ рдЕрднреА рднреА рдЖрдкрдХреЗ рдкреНрд░рдорд╛рдгрдкрддреНрд░реЛрдВ рдХреЛ рдареАрдХ рд╕реЗ рдкрдврд╝ рд╕рдХрддреЗ рд╣реИрдВред
* рдКрдкрд░ рд╕реЗ рдПрдХ tmpfs рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА рдорд╛рдЙрдВрдЯ рдХрд░рдиреЗ рдХреА рд╡реИрдХрд▓реНрдкрд┐рдХ рддрдХрдиреАрдХ рднреА рдХрд╛рдо рдирд╣реАрдВ рдХрд░рддреА рд╣реИ - рднрд▓реЗ рд╣реА рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реЛ рдХрд┐ `ls /apex/com.android.conscrypt/cacerts` рдХреБрдЫ рднреА рдирд╣реАрдВ рджрд┐рдЦрд╛ рд╕рдХрддрд╛ рд╣реИ (рдпрд╛ рдЖрдк рдЬреЛ рднреА рдЪрд╛рд╣реЗрдВ), рдРрдкреНрд╕ рдЕрднреА рднреА рд╡рд╣реА рдореВрд▓ рдбреЗрдЯрд╛ рджреЗрдЦреЗрдВрдЧреЗред
* рдХреНрдпреЛрдВрдХрд┐ `/apex` рдорд╛рдЙрдВрдЯ рдХреЛ [рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рдорд╛рдЙрдВрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ](https://cs.android.com/android/platform/superproject/main/+/main:system/core/init/mount\_namespace.cpp;l=97;drc=566c65239f1cf3fcb0d8745715e5ef1083d4bd3a) **PRIVATE рдкреНрд░рд╕рд╛рд░рдг рдХреЗ рд╕рд╛рде**, рддрд╛рдХрд┐ `/apex` рдкрде рдХреЗ рдЕрдВрджрд░ рд╕рднреА рдорд╛рдЙрдВрдЯреНрд╕ рдореЗрдВ рд╣реЛрдиреЗ рд╡рд╛рд▓реЗ рд╕рднреА рдкрд░рд┐рд╡рд░реНрддрди рдХрднреА рднреА рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЗ рдмреАрдЪ рд╕рд╛рдЭрд╛ рдирд╣реАрдВ рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВред

рдпрд╣ OS рдХреЛ рд╢реБрд░реВ рдХрд░рдиреЗ рд╡рд╛рд▓реА `init` рдкреНрд░рдХреНрд░рд┐рдпрд╛ рджреНрд╡рд╛рд░рд╛ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬреЛ рдлрд┐рд░ [Zygote рдкреНрд░рдХреНрд░рд┐рдпрд╛](https://en.wikipedia.org/wiki/Booting\_process\_of\_Android\_devices#Zygote) рдХреЛ рд▓реЙрдиреНрдЪ рдХрд░рддреА рд╣реИ (рдПрдХ рдирдП рдорд╛рдЙрдВрдЯ рдиреЗрдорд╕реНрдкреЗрд╕ рдХреЗ рд╕рд╛рде рдЬреЛ рдорд╛рддрд╛-рдкрд┐рддрд╛ рд╕реЗ рдХреЙрдкреА рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЕрдкрдиреЗ **рдЦреБрдж рдХреЗ рдирд┐рдЬреА `/apex` рдорд╛рдЙрдВрдЯ** рд╕рд╣рд┐рдд), рдЬреЛ рдмрджрд▓реЗ рдореЗрдВ **рдкреНрд░рддреНрдпреЗрдХ рдРрдк рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рд╢реБрд░реВ рдХрд░рддрд╛ рд╣реИ** рдЬрдм рднреА рдбрд┐рд╡рд╛рдЗрд╕ рдкрд░ рдПрдХ рдРрдк рд▓реЙрдиреНрдЪ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ (рдЬреЛ рдлрд┐рд░ рдЙрд╕реА рдирд┐рдЬреА `/apex` рдорд╛рдЙрдВрдЯ рдХреЛ рдХреЙрдкреА рдХрд░рддреЗ рд╣реИрдВ)ред

### рдорд╛рдЙрдВрдЯрдкреЙрдЗрдВрдЯреНрд╕ рдХреЛ рдкреБрдирд░рд╛рд╡рд░реНрддреА рд░реВрдк рд╕реЗ рдкреБрдирдГ рдорд╛рдЙрдВрдЯ рдХрд░рдирд╛

* рдЖрдк `/apex` рдХреЛ рдореИрдиреНрдпреБрдЕрд▓реА рдкреБрдирдГ рдорд╛рдЙрдВрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, PRIVATE рдкреНрд░рд╕рд╛рд░рдг рдХреЛ рд╣рдЯрд╛рдХрд░ рдФрд░ рдЗрд╕реЗ рд▓рд┐рдЦрдиреЗ рдпреЛрдЧреНрдп рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ (рд╡рд┐рдбрдВрдмрдирд╛ рдпрд╣ рд╣реИ рдХрд┐ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдирд┐рдЬреА рдкреНрд░рд╕рд╛рд░рдг рдХреЛ рд╣рдЯрд╛рдирд╛ _рд╣рд░ рдЬрдЧрд╣_ рдкреНрд░рд╕рд╛рд░рд┐рдд рд╣реЛрддрд╛ рд╣реИ)
* рдЖрдк `/apex/com.android.conscrypt` рдХреА рдкреВрд░реА рд╕рд╛рдордЧреНрд░реА рдХреЛ рдХрд╣реАрдВ рдФрд░ рдХреЙрдкреА рдХрд░рддреЗ рд╣реИрдВ
* рдлрд┐рд░ рдЖрдк `/apex/com.android.conscrypt` рдХреЛ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдЕрдирдорд╛рдЙрдВрдЯ рдХрд░ рджреЗрддреЗ рд╣реИрдВ - рдЗрд╕ рдореЙрдбреНрдпреВрд▓ рдХреЛ рдЕрдкрд░рд┐рд╡рд░реНрддрдиреАрдп рд░реВрдк рд╕реЗ рдкреНрд░рджрд╛рди рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рд░реАрдб-рдУрдирд▓реА рдорд╛рдЙрдВрдЯ рдХреЛ рд╣рдЯрд╛ рджреЗрддреЗ рд╣реИрдВ
* рдлрд┐рд░ рдЖрдк рд╕рд╛рдордЧреНрд░реА рдХреЛ рд╡рд╛рдкрд╕ рдХреЙрдкреА рдХрд░рддреЗ рд╣реИрдВ, рддрд╛рдХрд┐ рдпрд╣ `/apex` рдорд╛рдЙрдВрдЯ рдореЗрдВ рд╕реАрдзреЗ рд░рд╣рддреА рд╣реИ, рдЬрд╣рд╛рдВ рдЗрд╕реЗ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ (рдЖрдкрдХреЛ рдпрд╣ рдЬрд▓реНрджреА рд╕реЗ рдХрд░рдирд╛ рд╣реЛрдЧрд╛, рдХреНрдпреЛрдВрдХрд┐ [рдЬрд╛рд╣рд┐рд░ рддреМрд░ рдкрд░](https://infosec.exchange/@g1a55er/111069489513139531) рдЖрдк рдЕрдиреНрдпрдерд╛ рдХреНрд░реИрд╢ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ)
* рдпрд╣ рддреБрд░рдВрдд рдкреНрд░рднрд╛рд╡ рдореЗрдВ рдЖрдирд╛ рдЪрд╛рд╣рд┐рдП, рд▓реЗрдХрд┐рди рд╡реЗ `system_server` рдХреЛ рдорд╛рд░рдиреЗ рдХреА рд╕рд┐рдлрд╛рд░рд┐рд╢ рдХрд░рддреЗ рд╣реИрдВ (рд╕рднреА рдРрдкреНрд╕ рдХреЛ рдкреБрдирдГ рдЖрд░рдВрдн рдХрд░рдирд╛) рддрд╛рдХрд┐ рд╕рдм рдХреБрдЫ рдПрдХ рд╕реБрд╕рдВрдЧрдд рд╕реНрдерд┐рддрд┐ рдореЗрдВ рд╡рд╛рдкрд╕ рдЖ рдЬрд╛рдПред
```bash
# Create a separate temp directory, to hold the current certificates
# Otherwise, when we add the mount we can't read the current certs anymore.
mkdir -p -m 700 /data/local/tmp/tmp-ca-copy

# Copy out the existing certificates
cp /apex/com.android.conscrypt/cacerts/* /data/local/tmp/tmp-ca-copy/

# Create the in-memory mount on top of the system certs folder
mount -t tmpfs tmpfs /system/etc/security/cacerts

# Copy the existing certs back into the tmpfs, so we keep trusting them
mv /data/local/tmp/tmp-ca-copy/* /system/etc/security/cacerts/

# Copy our new cert in, so we trust that too
mv $CERTIFICATE_PATH /system/etc/security/cacerts/

# Update the perms & selinux context labels
chown root:root /system/etc/security/cacerts/*
chmod 644 /system/etc/security/cacerts/*
chcon u:object_r:system_file:s0 /system/etc/security/cacerts/*

# Deal with the APEX overrides, which need injecting into each namespace:

# First we get the Zygote process(es), which launch each app
ZYGOTE_PID=$(pidof zygote || true)
ZYGOTE64_PID=$(pidof zygote64 || true)
# N.b. some devices appear to have both!

# Apps inherit the Zygote's mounts at startup, so we inject here to ensure
# all newly started apps will see these certs straight away:
for Z_PID in "$ZYGOTE_PID" "$ZYGOTE64_PID"; do
if [ -n "$Z_PID" ]; then
nsenter --mount=/proc/$Z_PID/ns/mnt -- \
/bin/mount --bind /system/etc/security/cacerts /apex/com.android.conscrypt/cacerts
fi
done

# Then we inject the mount into all already running apps, so they
# too see these CA certs immediately:

# Get the PID of every process whose parent is one of the Zygotes:
APP_PIDS=$(
echo "$ZYGOTE_PID $ZYGOTE64_PID" | \
xargs -n1 ps -o 'PID' -P | \
grep -v PID
)

# Inject into the mount namespace of each of those apps:
for PID in $APP_PIDS; do
nsenter --mount=/proc/$PID/ns/mnt -- \
/bin/mount --bind /system/etc/security/cacerts /apex/com.android.conscrypt/cacerts &
done
wait # Launched in parallel - wait for completion here

echo "System certificate injected"
```
### NSEnter рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ Bind-mounting

*   рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рд╣рдореЗрдВ рдХрд╣реАрдВ рдПрдХ рд▓рд┐рдЦрдиреЗ рдпреЛрдЧреНрдп рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рд╕реЗрдЯ рдЕрдк рдХрд░рдиреА рд╣реЛрдЧреАред рдореМрдЬреВрджрд╛ рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХреЗ рд╕рд╛рде рдЖрд╕рд╛рди рд╕рдВрдЧрддрддрд╛ рдХреЗ рд▓рд┐рдП, рдореИрдВ рдпрд╣ `tmpfs` рдорд╛рдЙрдВрдЯ рдХреЗ рд╕рд╛рде рдХрд░ рд░рд╣рд╛ рд╣реВрдБ рдЬреЛ рдЕрднреА рднреА рдореМрдЬреВрдж рдЧреИрд░-APEX рд╕рд┐рд╕реНрдЯрдо рд╕рд░реНрдЯ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдкрд░ рд╣реИ:

```bash
mount -t tmpfs tmpfs /system/etc/security/cacerts
```
* рдлрд┐рд░ рдЖрдк рдЙрд╕ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдореЗрдВ CA рдкреНрд░рдорд╛рдгрдкрддреНрд░ рд░рдЦрддреЗ рд╣реИрдВ рдЬрд┐рд╕рдореЗрдВ рдЖрдк рд░реБрдЪрд┐ рд░рдЦрддреЗ рд╣реИрдВ (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЖрдк рдореМрдЬреВрджрд╛ `/apex/com.android.conscrypt/cacerts/` CA рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рд╕реЗ рд╕рднреА рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдХреЛ рдХреЙрдкреА рдХрд░рдирд╛ рдЪрд╛рд╣ рд╕рдХрддреЗ рд╣реИрдВ) рдФрд░ рдЙрдЪрд┐рдд рдЕрдиреБрдорддрд┐рдпрд╛рдБ рдФрд░ SELinux рд▓реЗрдмрд▓ рд╕реЗрдЯ рдХрд░рддреЗ рд╣реИрдВред
*   рдлрд┐рд░, `nsenter` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ Zygote рдХреЗ рдорд╛рдЙрдВрдЯ рдиреЗрдорд╕реНрдкреЗрд╕ рдореЗрдВ рдкреНрд░рд╡реЗрд╢ рдХрд░реЗрдВ, рдФрд░ рдЗрд╕ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХреЛ APEX рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдкрд░ рдмрд╛рдЗрдВрдб рдорд╛рдЙрдВрдЯ рдХрд░реЗрдВ:

```bash
nsenter --mount=/proc/$ZYGOTE_PID/ns/mnt -- \
/bin/mount --bind /system/etc/security/cacerts /apex/com.android.conscrypt/cacerts
```

Zygote рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдкреНрд░рддреНрдпреЗрдХ рдРрдк рдХреЛ рдЬрдиреНрдо рджреЗрддреА рд╣реИ, рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдкрдиреЗ рдорд╛рдЙрдВрдЯ рдиреЗрдорд╕реНрдкреЗрд╕ рдХреА рдкреНрд░рддрд┐рд▓рд┐рдкрд┐ рдмрдирд╛рддреА рд╣реИ, рдЗрд╕рд▓рд┐рдП рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддреА рд╣реИ рдХрд┐ рд╕рднреА рдирдП рд▓реЙрдиреНрдЪ рдХрд┐рдП рдЧрдП рдРрдкреНрд╕ (рдЕрдм рд╕реЗ рд╢реБрд░реВ рдХрд┐рдП рдЧрдП рд╕рдм рдХреБрдЫ) рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗред
*   рдлрд┐рд░, `nsenter` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкреНрд░рддреНрдпреЗрдХ рдкрд╣рд▓реЗ рд╕реЗ рдЪрд▓ рд░рд╣реЗ рдРрдк рдХреЗ рдиреЗрдорд╕реНрдкреЗрд╕ рдореЗрдВ рдкреНрд░рд╡реЗрд╢ рдХрд░реЗрдВ, рдФрд░ рд╡рд╣реА рдХрд░реЗрдВ:

```bash
nsenter --mount=/proc/$APP_PID/ns/mnt -- \
/bin/mount --bind /system/etc/security/cacerts /apex/com.android.conscrypt/cacerts
```

рд╡реИрдХрд▓реНрдкрд┐рдХ рд░реВрдк рд╕реЗ, рдпрджрд┐ рдЖрдк рдЕрдЬреАрдм UX рдХреА рдкрд░рд╡рд╛рд╣ рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдЖрдк `init` (PID 1) рдкрд░ рд╣реА рдмрд╛рдЗрдВрдб рдорд╛рдЙрдВрдЯ рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП рдФрд░ рдлрд┐рд░ `stop && start` рдЪрд▓рд╛рдХрд░ OS рдХреЛ рд╕реЙрдлреНрдЯ-рд░рд┐рдмреВрдЯ рдХрд░реЗрдВ, рд╕рднреА рдиреЗрдорд╕реНрдкреЗрд╕ рдХреЛ рдлрд┐рд░ рд╕реЗ рдмрдирд╛рдПрдВ рдФрд░ рдЕрдкрдиреЗ рдкрд░рд┐рд╡рд░реНрддрдиреЛрдВ рдХреЛ рд╣рд░ рдЬрдЧрд╣ рдкреНрд░рд╕рд╛рд░рд┐рдд рдХрд░реЗрдВ (рд▓реЗрдХрд┐рди рд╡реНрдпрдХреНрддрд┐рдЧрдд рд░реВрдк рд╕реЗ рдореИрдВ рдЕрдЬреАрдм рд░рд┐рдмреВрдЯ рдХреА рдкрд░рд╡рд╛рд╣ рдХрд░рддрд╛ рд╣реВрдБ, рдЗрд╕рд▓рд┐рдП рдореИрдВ рдЙрд╕ рдорд╛рд░реНрдЧ рдХреЛ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдирдЬрд░рдЕрдВрджрд╛рдЬ рдХрд░ рд░рд╣рд╛ рд╣реВрдБ)ред

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>тШБя╕П HackTricks Cloud тШБя╕П</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ЁЯРж Twitter ЁЯРж</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ЁЯОЩя╕П Twitch ЁЯОЩя╕П</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ЁЯОе Youtube ЁЯОе</strong></a></summary>

* рдХреНрдпрд╛ рдЖрдк **cybersecurity company** рдореЗрдВ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ? рдХреНрдпрд╛ рдЖрдк рдЕрдкрдиреА **company рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ**? рдпрд╛ рдХреНрдпрд╛ рдЖрдк **PEASS рдХреЗ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рддрдХ рдкрд╣реБрдБрдЪ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ**? [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╕рдВрдЧреНрд░рд╣ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рдХрд╛ред
* [**official PEASS & HackTricks swag**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВред
* **[**ЁЯТм**](https://emojipedia.org/speech-balloon/) [**Discord group**](https://discord.gg/hRep4RUj7f) рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ рдпрд╛ [**telegram group**](https://t.me/peass) рдореЗрдВ рдпрд╛ рдореБрдЭреЗ **Twitter** рдкрд░ **рдлреЙрд▓реЛ** рдХрд░реЗрдВ [**ЁЯРж**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **hacktricks repo** рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ рдФрд░ **hacktricks-cloud repo** рдореЗрдВред

</details>
