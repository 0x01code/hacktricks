# –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—É Burp

<details>

<summary><strong>–í–∏–≤—á–∞–π—Ç–µ —Ö–∞–∫—ñ–Ω–≥ AWS –≤—ñ–¥ –Ω—É–ª—è –¥–æ –≥–µ—Ä–æ—è –∑</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

–Ü–Ω—à—ñ —Å–ø–æ—Å–æ–±–∏ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ HackTricks:

* –Ø–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ –≤–∞—à—É **–∫–æ–º–ø–∞–Ω—ñ—é —Ä–µ–∫–ª–∞–º–æ–≤–∞–Ω—É –Ω–∞ HackTricks** –∞–±–æ **–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ HackTricks —É —Ñ–æ—Ä–º–∞—Ç—ñ PDF**, –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ü–õ–ê–ù–ò –ü–Ü–î–ü–ò–°–ö–ò**](https://github.com/sponsors/carlospolop)!
* –û—Ç—Ä–∏–º–∞–π—Ç–µ [**–æ—Ñ—ñ—Ü—ñ–π–Ω–∏–π PEASS & HackTricks –º–µ—Ä—á**](https://peass.creator-spring.com)
* –í—ñ–¥–∫—Ä–∏–π—Ç–µ –¥–ª—è —Å–µ–±–µ [**–°—ñ–º'—é PEASS**](https://opensea.io/collection/the-peass-family), –Ω–∞—à—É –∫–æ–ª–µ–∫—Ü—ñ—é –µ–∫—Å–∫–ª—é–∑–∏–≤–Ω–∏—Ö [**NFT**](https://opensea.io/collection/the-peass-family)
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –Ω–∞–º–∏ –Ω–∞ **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **–ü–æ–¥—ñ–ª—ñ—Ç—å—Å—è —Å–≤–æ—ó–º–∏ —Ö–∞–∫—ñ–Ω–≥-–ø—Ä–∏–π–æ–º–∞–º–∏, –Ω–∞–¥—Å–∏–ª–∞–π—Ç–µ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) **—ñ** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤ –Ω–∞ GitHub.**

</details>

## –ù–∞ –≤—ñ—Ä—Ç—É–∞–ª—å–Ω—ñ–π –º–∞—à–∏–Ω—ñ

–ü–æ-–ø–µ—Ä—à–µ, –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç Der –∑ Burp. –¶–µ –º–æ–∂–Ω–∞ –∑—Ä–æ–±–∏—Ç–∏ –≤ _**Proxy**_ --> _**Options**_ --> _**Import / Export CA certificate**_

![](<../../.gitbook/assets/image (367).png>)

**–ï–∫—Å–ø–æ—Ä—Ç—É–π—Ç–µ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç —É —Ñ–æ—Ä–º–∞—Ç—ñ Der** —ñ –ø–µ—Ä–µ—Ç–≤–æ—Ä—ñ—Ç—å –π–æ–≥–æ –≤ —Ñ–æ—Ä–º—É, —è–∫—É **–∑–º–æ–∂–µ —Ä–æ–∑—É–º—ñ—Ç–∏ Android**. –ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ **–¥–ª—è –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—É burp –Ω–∞ Android-–º–∞—à–∏–Ω—ñ –≤ AVD** –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ **–∑–∞–ø—É—Å—Ç–∏—Ç–∏** —Ü—é –º–∞—à–∏–Ω—É **–∑ –æ–ø—Ü—ñ—î—é** **`-writable-system`**.\
–ù–∞–ø—Ä–∏–∫–ª–∞–¥, –≤–∏ –º–æ–∂–µ—Ç–µ –∑–∞–ø—É—Å—Ç–∏—Ç–∏ –π–æ–≥–æ —Ç–∞–∫:

{% code overflow="wrap" %}
```bash
C:\Users\<UserName>\AppData\Local\Android\Sdk\tools\emulator.exe -avd "AVD9" -http-proxy 192.168.1.12:8080 -writable-system
```
{% endcode %}

–ü–æ—Ç—ñ–º, —â–æ–± **–Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç burp**, –≤–∏–∫–æ–Ω–∞–π—Ç–µ:

{% code overflow="wrap" %}
```bash
openssl x509 -inform DER -in burp_cacert.der -out burp_cacert.pem
CERTHASHNAME="`openssl x509 -inform PEM -subject_hash_old -in burp_cacert.pem | head -1`.0"
mv burp_cacert.pem $CERTHASHNAME #Correct name
adb root && sleep 2 && adb remount #Allow to write on /syste
adb push $CERTHASHNAME /sdcard/ #Upload certificate
adb shell mv /sdcard/$CERTHASHNAME /system/etc/security/cacerts/ #Move to correct location
adb shell chmod 644 /system/etc/security/cacerts/$CERTHASHNAME #Assign privileges
adb reboot #Now, reboot the machine
```
{% endcode %}

–ü—ñ—Å–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è **–ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø—Ä–∏—Å—Ç—Ä–æ—é** —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç Burp –±—É–¥–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏—Å—è –Ω–∏–º!

## –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è Magisc

–Ø–∫—â–æ –≤–∏ **–æ—Ç—Ä–∏–º–∞–ª–∏ –ø—Ä–∞–≤–∞ root –Ω–∞ –ø—Ä–∏—Å—Ç—Ä–æ—ó –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é Magisc** (–º–æ–∂–ª–∏–≤–æ, –µ–º—É–ª—è—Ç–æ—Ä–∞), —ñ –≤–∏ **–Ω–µ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ–Ω–∞—Ç–∏** –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ **–∫—Ä–æ–∫–∏** –¥–ª—è –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∞ Burp —á–µ—Ä–µ–∑ —Ç–µ, —â–æ **—Ñ–∞–π–ª–æ–≤–∞ —Å–∏—Å—Ç–µ–º–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç—ñ–ª—å–∫–∏ –¥–ª—è —á–∏—Ç–∞–Ω–Ω—è**, —ñ –≤–∏ –Ω–µ –º–æ–∂–µ—Ç–µ –∑–º—ñ–Ω–∏—Ç–∏ —ó—ó –Ω–∞ –¥–æ—Å—Ç—É–ø–Ω—É –¥–ª—è –∑–∞–ø–∏—Å—É, —î —â–µ –æ–¥–∏–Ω —Å–ø–æ—Å—ñ–±.

–ü–æ—è—Å–Ω–µ–Ω–æ –≤ [**—Ü—å–æ–º—É –≤—ñ–¥–µ–æ**](https://www.youtube.com/watch?v=qQicUW0svB8) –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ:

1. **–í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç CA**: –ü—Ä–æ—Å—Ç–æ **–ø–µ—Ä–µ—Ç—è–≥–Ω—ñ—Ç—å** DER —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç Burp, **–∑–º—ñ–Ω–∏–≤—à–∏ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è** –Ω–∞ `.crt`, –Ω–∞ –º–æ–±—ñ–ª—å–Ω–∏–π –ø—Ä–∏—Å—Ç—Ä—ñ–π, —â–æ–± –≤—ñ–Ω –∑–±–µ—Ä—ñ–≥–∞–≤—Å—è –≤ –ø–∞–ø—Ü—ñ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è, —Ç–∞ –ø–µ—Ä–µ–π–¥—ñ—Ç—å –¥–æ `–í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç` -> `–°–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç CA`

<figure><img src="../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt="" width="164"><figcaption></figcaption></figure>

* –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —â–æ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç –±—É–≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∑–±–µ—Ä–µ–∂–µ–Ω–∏–π, –ø–µ—Ä–µ–π—à–æ–≤—à–∏ –¥–æ `–î–æ–≤—ñ—Ä–µ–Ω—ñ –æ–±–ª—ñ–∫–æ–≤—ñ –∑–∞–ø–∏—Å–∏` -> `–ö–û–†–ò–°–¢–£–í–ê–ß`

<figure><img src="../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt="" width="334"><figcaption></figcaption></figure>

2. **–ó—Ä–æ–±—ñ—Ç—å –π–æ–≥–æ –¥–æ–≤—ñ—Ä–µ–Ω–∏–º —Å–∏—Å—Ç–µ–º–æ—é**: –ó–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ –º–æ–¥—É–ª—å Magisc [MagiskTrustUserCerts](https://github.com/NVISOsecurity/MagiskTrustUserCerts) (—Ñ–∞–π–ª .zip), **–ø–µ—Ä–µ—Ç—è–≥–Ω—ñ—Ç—å –π–æ–≥–æ** –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω, –ø–µ—Ä–µ–π–¥—ñ—Ç—å –¥–æ –¥–æ–¥–∞—Ç–∫–∞ **Magics** –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω—ñ –≤ —Ä–æ–∑–¥—ñ–ª **`–ú–æ–¥—É–ª—ñ`**, –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å –Ω–∞ **`–í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –∑—ñ —Å—Ö–æ–≤–∏—â–∞`**, –≤–∏–±–µ—Ä—ñ—Ç—å –º–æ–¥—É–ª—å `.zip` —ñ –ø—ñ—Å–ª—è –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è **–ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ** —Ç–µ–ª–µ—Ñ–æ–Ω:

<figure><img src="../../.gitbook/assets/image (2) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt="" width="345"><figcaption></figcaption></figure>

* –ü—ñ—Å–ª—è –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø–µ—Ä–µ–π–¥—ñ—Ç—å –¥–æ `–î–æ–≤—ñ—Ä–µ–Ω—ñ –æ–±–ª—ñ–∫–æ–≤—ñ –∑–∞–ø–∏—Å–∏` -> `–°–ò–°–¢–ï–ú–ê` —Ç–∞ –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —á–∏ —î —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç Postswigger —Ç–∞–º

<figure><img src="../../.gitbook/assets/image (3) (1) (1) (1) (1) (1) (1).png" alt="" width="314"><figcaption></figcaption></figure>

## –ü—ñ—Å–ª—è Android 14

–£ –Ω–∞–π–Ω–æ–≤—ñ—à–æ–º—É –≤–∏–ø—É—Å–∫—É Android 14 —Å–ø–æ—Å—Ç–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –∑–Ω–∞—á–Ω–∏–π –∑—Å—É–≤ —É —Ä–æ–±–æ—Ç—ñ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—ñ–≤ —É–ø–æ–≤–Ω–æ–≤–∞–∂–µ–Ω–æ–≥–æ –æ—Ä–≥–∞–Ω—É (CA), —è–∫—ñ –¥–æ–≤—ñ—Ä—è—é—Ç—å—Å—è —Å–∏—Å—Ç–µ–º—ñ. –†–∞–Ω—ñ—à–µ —Ü—ñ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∏ –∑–Ω–∞—Ö–æ–¥–∏–ª–∏—Å—è –≤ **`/system/etc/security/cacerts/`**, –¥–æ—Å—Ç—É–ø–Ω–æ–º—É —Ç–∞ –∑–º—ñ–Ω—é–≤–∞–Ω–æ–º—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º–∏ –∑ –ø—Ä–∞–≤–∞–º–∏ root, —â–æ –¥–æ–∑–≤–æ–ª—è–ª–æ –Ω–µ–≥–∞–π–Ω–µ –∑–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è –ø–æ –≤—Å—ñ–π —Å–∏—Å—Ç–µ–º—ñ. –û–¥–Ω–∞–∫ –∑ Android 14 –º—ñ—Å—Ü–µ –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –±—É–ª–æ –ø–µ—Ä–µ–º—ñ—â–µ–Ω–æ –¥–æ **`/apex/com.android.conscrypt/cacerts`**, –∫–∞—Ç–∞–ª–æ–≥—É –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ —à–ª—è—Ö—É **`/apex`**, —è–∫–∏–π –∑–∞ —Å–≤–æ—î—é –ø—Ä–∏—Ä–æ–¥–æ—é —î –Ω–µ–∑–º—ñ–Ω–Ω–∏–º.

–°–ø—Ä–æ–±–∏ –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —à–ª—è—Ö **APEX cacerts** —è–∫ –¥–æ—Å—Ç—É–ø–Ω–∏–π –¥–ª—è –∑–∞–ø–∏—Å—É –ø—Ä–∏–∑–≤–æ–¥—è—Ç—å –¥–æ –Ω–µ–≤–¥–∞—á—ñ, –æ—Å–∫—ñ–ª—å–∫–∏ —Å–∏—Å—Ç–µ–º–∞ –Ω–µ –¥–æ–∑–≤–æ–ª—è—î —Ç–∞–∫—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó. –ù–∞–≤—ñ—Ç—å —Å–ø—Ä–æ–±–∏ —Ä–æ–∑–º–æ–Ω—Ç—É–≤–∞—Ç–∏ –∞–±–æ –Ω–∞–∫–ª–∞–¥–∞—Ç–∏ –∫–∞—Ç–∞–ª–æ–≥ —Ç–∏–º—á–∞—Å–æ–≤–æ—é —Ñ–∞–π–ª–æ–≤–æ—é —Å–∏—Å—Ç–µ–º–æ—é (tmpfs) –Ω–µ –æ–±–º–∏–Ω–∞—é—Ç—å –Ω–µ–∑–º—ñ–Ω–Ω—ñ—Å—Ç—å; –¥–æ–¥–∞—Ç–∫–∏ –ø—Ä–æ–¥–æ–≤–∂—É—é—Ç—å –æ—Ç—Ä–∏–º—É–≤–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–∏—Ö –¥–∞–Ω–∏—Ö —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—ñ–≤ –Ω–µ–∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ –∑–º—ñ–Ω –Ω–∞ —Ä—ñ–≤–Ω—ñ —Ñ–∞–π–ª–æ–≤–æ—ó —Å–∏—Å—Ç–µ–º–∏. –¶—è —Å—Ç—ñ–π–∫—ñ—Å—Ç—å –ø–æ—è—Å–Ω—é—î—Ç—å—Å—è —Ç–∏–º, —â–æ –º–æ–Ω—Ç—É–≤–∞–Ω–Ω—è **`/apex`** –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–æ –∑ –ø—Ä–∏–≤–∞—Ç–Ω–∏–º –ø–æ—à–∏—Ä–µ–Ω–Ω—è–º, —â–æ –∑–∞–±–µ–∑–ø–µ—á—É—î, —â–æ –±—É–¥—å-—è–∫—ñ –∑–º—ñ–Ω–∏ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –∫–∞—Ç–∞–ª–æ–≥—É **`/apex`** –Ω–µ –≤–ø–ª–∏–≤–∞—é—Ç—å –Ω–∞ —ñ–Ω—à—ñ –ø—Ä–æ—Ü–µ—Å–∏.

–Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è Android –≤–∫–ª—é—á–∞—î –ø—Ä–æ—Ü–µ—Å `init`, —è–∫–∏–π, –ø–æ—á–∏–Ω–∞—é—á–∏ –æ–ø–µ—Ä–∞—Ü—ñ–π–Ω—É —Å–∏—Å—Ç–µ–º—É, —Ç–∞–∫–æ–∂ –∑–∞–ø—É—Å–∫–∞—î –ø—Ä–æ—Ü–µ—Å Zygote. –¶–µ–π –ø—Ä–æ—Ü–µ—Å –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –∑–∞ –∑–∞–ø—É—Å–∫ –ø—Ä–æ—Ü–µ—Å—ñ–≤ –¥–æ–¥–∞—Ç–∫—ñ–≤ –∑ –Ω–æ–≤–∏–º –ø—Ä–æ—Å—Ç–æ—Ä–æ–º —ñ–º–µ–Ω –º–æ–Ω—Ç—É–≤–∞–Ω–Ω—è, —è–∫–∏–π –≤–∫–ª—é—á–∞—î –ø—Ä–∏–≤–∞—Ç–Ω–µ –º–æ–Ω—Ç—É–≤–∞–Ω–Ω—è **`/apex`**, —ñ —Ç–∞–∫–∏–º —á–∏–Ω–æ–º —ñ–∑–æ–ª—é—î –∑–º—ñ–Ω–∏ –≤ —Ü—å–æ–º—É –∫–∞—Ç–∞–ª–æ–∑—ñ –≤—ñ–¥ —ñ–Ω—à–∏—Ö –ø—Ä–æ—Ü–µ—Å—ñ–≤.

–¢–∏–º –Ω–µ –º–µ–Ω—à, —ñ—Å–Ω—É—î –æ–±—Ö—ñ–¥–Ω–∏–π —à–ª—è—Ö –¥–ª—è —Ç–∏—Ö, —Ö—Ç–æ –ø–æ—Ç—Ä–µ–±—É—î –∑–º—ñ–Ω–∏—Ç–∏ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∏ CA, —è–∫–∏–º –¥–æ–≤—ñ—Ä—è—î —Å–∏—Å—Ç–µ–º–∞, –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –∫–∞—Ç–∞–ª–æ–≥—É **`/apex`**. –¶–µ –≤–∫–ª—é—á–∞—î –≤ —Å–µ–±–µ —Ä—É—á–Ω–µ –ø–æ–≤—Ç–æ—Ä–Ω–µ –º–æ–Ω—Ç—É–≤–∞–Ω–Ω—è **`/apex`**, —â–æ–± –≤–∏–¥–∞–ª–∏—Ç–∏ –ø—Ä–∏–≤–∞—Ç–Ω–µ –ø–æ—à–∏—Ä–µ–Ω–Ω—è, –∑—Ä–æ–±–∏–≤—à–∏ –π–æ–≥–æ –¥–æ—Å—Ç—É–ø–Ω–∏–º –¥–ª—è –∑–∞–ø–∏—Å—É. –ü—Ä–æ—Ü–µ—Å –≤–∫–ª—é—á–∞—î –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è –≤–º—ñ—Å—Ç—É **`/apex/com.android.conscrypt`** –≤ —ñ–Ω—à–µ –º—ñ—Å—Ü–µ, —Ä–æ–∑–º–æ–Ω—Ç–æ–≤—É–≤–∞–Ω–Ω—è –∫–∞—Ç–∞–ª–æ–≥—É **`/apex/com.android.conscrypt`**, —â–æ–± —É—Å—É–Ω—É—Ç–∏ –æ–±–º–µ–∂–µ–Ω–Ω—è —Ç—ñ–ª—å–∫–∏ –¥–ª—è —á–∏—Ç–∞–Ω–Ω—è, –∞ –ø–æ—Ç—ñ–º –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –≤–º—ñ—Å—Ç—É –Ω–∞ —ó—Ö–Ω—î –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–µ –º—ñ—Å—Ü–µ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ **`/apex`**. –¶–µ–π –ø—ñ–¥—Ö—ñ–¥ –ø–æ—Ç—Ä–µ–±—É—î —à–≤–∏–¥–∫–æ–≥–æ –≤—Ç—Ä—É—á–∞–Ω–Ω—è, —â–æ–± —É–Ω–∏–∫–Ω—É—Ç–∏ –∞–≤–∞—Ä—ñ–π–Ω–æ—ó –∑—É–ø–∏–Ω–∫–∏ —Å–∏—Å—Ç–µ–º–∏. –î–ª—è –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –∑–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è —Ü–∏—Ö –∑–º—ñ–Ω —Ä–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—å—Å—è –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–∏ `system_server`, —â–æ –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—î –≤—Å—ñ –¥–æ–¥–∞—Ç–∫–∏ —Ç–∞ –ø—Ä–∏–≤–æ–¥–∏—Ç—å —Å–∏—Å—Ç–µ–º—É –¥–æ —Å—Ç–∞–Ω—É, —è–∫–∏–π –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –≤—Å—ñ–º.
```bash
# Create a separate temp directory, to hold the current certificates
# Otherwise, when we add the mount we can't read the current certs anymore.
mkdir -p -m 700 /data/local/tmp/tmp-ca-copy

# Copy out the existing certificates
cp /apex/com.android.conscrypt/cacerts/* /data/local/tmp/tmp-ca-copy/

# Create the in-memory mount on top of the system certs folder
mount -t tmpfs tmpfs /system/etc/security/cacerts

# Copy the existing certs back into the tmpfs, so we keep trusting them
mv /data/local/tmp/tmp-ca-copy/* /system/etc/security/cacerts/

# Copy our new cert in, so we trust that too
mv $CERTIFICATE_PATH /system/etc/security/cacerts/

# Update the perms & selinux context labels
chown root:root /system/etc/security/cacerts/*
chmod 644 /system/etc/security/cacerts/*
chcon u:object_r:system_file:s0 /system/etc/security/cacerts/*

# Deal with the APEX overrides, which need injecting into each namespace:

# First we get the Zygote process(es), which launch each app
ZYGOTE_PID=$(pidof zygote || true)
ZYGOTE64_PID=$(pidof zygote64 || true)
# N.b. some devices appear to have both!

# Apps inherit the Zygote's mounts at startup, so we inject here to ensure
# all newly started apps will see these certs straight away:
for Z_PID in "$ZYGOTE_PID" "$ZYGOTE64_PID"; do
if [ -n "$Z_PID" ]; then
nsenter --mount=/proc/$Z_PID/ns/mnt -- \
/bin/mount --bind /system/etc/security/cacerts /apex/com.android.conscrypt/cacerts
fi
done

# Then we inject the mount into all already running apps, so they
# too see these CA certs immediately:

# Get the PID of every process whose parent is one of the Zygotes:
APP_PIDS=$(
echo "$ZYGOTE_PID $ZYGOTE64_PID" | \
xargs -n1 ps -o 'PID' -P | \
grep -v PID
)

# Inject into the mount namespace of each of those apps:
for PID in $APP_PIDS; do
nsenter --mount=/proc/$PID/ns/mnt -- \
/bin/mount --bind /system/etc/security/cacerts /apex/com.android.conscrypt/cacerts &
done
wait # Launched in parallel - wait for completion here

echo "System certificate injected"
```
### –ü—Ä–∏–≤'—è–∑–∫–∞ —á–µ—Ä–µ–∑ NSEnter

1. **–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∑–∞–ø–∏—Å—É—î–º–æ–≥–æ –∫–∞—Ç–∞–ª–æ–≥—É**: –°–ø–æ—á–∞—Ç–∫—É –∑–∞–ø–∏—Å—É—î–º–∏–π –∫–∞—Ç–∞–ª–æ–≥ –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î—Ç—å—Å—è, –º–æ–Ω—Ç—É–≤–∞–Ω–Ω—è–º `tmpfs` –Ω–∞–¥ —ñ—Å–Ω—É—é—á–∏–º –∫–∞—Ç–∞–ª–æ–≥–æ–º —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—ñ–≤ —Å–∏—Å—Ç–µ–º–∏, —è–∫–∏–π –Ω–µ —î APEX. –¶–µ –¥–æ—Å—è–≥–∞—î—Ç—å—Å—è –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –Ω–∞—Å—Ç—É–ø–Ω–æ—ó –∫–æ–º–∞–Ω–¥–∏:
```bash
mount -t tmpfs tmpfs /system/etc/security/cacerts
```
2. **–ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—ñ–≤ –¶–°**: –ü—ñ—Å–ª—è –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∑–∞–ø–∏—Å—É–≤–∞–ª—å–Ω–æ–≥–æ –∫–∞—Ç–∞–ª–æ–≥—É —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∏ –¶–°, —è–∫—ñ –≤–∏ –º–∞—î—Ç–µ –Ω–∞–º—ñ—Ä –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏, —Å–ª—ñ–¥ —Å–∫–æ–ø—ñ—é–≤–∞—Ç–∏ –≤ —Ü–µ–π –∫–∞—Ç–∞–ª–æ–≥. –¶–µ –º–æ–∂–µ –≤–∫–ª—é—á–∞—Ç–∏ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è —Ç–∏–ø–æ–≤–∏—Ö —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—ñ–≤ –∑ `/apex/com.android.conscrypt/cacerts/`. –ù–µ–æ–±—Ö—ñ–¥–Ω–æ –Ω–∞–ª–µ–∂–Ω–∏–º —á–∏–Ω–æ–º –Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ –¥–æ–∑–≤–æ–ª–∏ —Ç–∞ –º—ñ—Ç–∫–∏ SELinux –¥–ª—è —Ü–∏—Ö —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—ñ–≤.
3. **–ü—Ä–∏–≤'—è–∑–∫–∞ –º–æ–Ω—Ç—É–≤–∞–Ω–Ω—è –¥–ª—è Zygote**: –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ `nsenter`, –≤–∏ –≤—Ö–æ–¥–∏—Ç–µ –≤ –ø—Ä–æ—Å—Ç—ñ—Ä —ñ–º–µ–Ω –º–æ–Ω—Ç—É–≤–∞–Ω–Ω—è Zygote. Zygote, —è–∫–∏–π —î –ø—Ä–æ—Ü–µ—Å–æ–º, –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω–∏–º –∑–∞ –∑–∞–ø—É—Å–∫ –¥–æ–¥–∞—Ç–∫—ñ–≤ Android, –ø–æ—Ç—Ä–µ–±—É—î —Ü—å–æ–≥–æ –∫—Ä–æ–∫—É, —â–æ–± –∑–∞–±–µ–∑–ø–µ—á–∏—Ç–∏, —â–æ –≤—Å—ñ –¥–æ–¥–∞—Ç–∫–∏, –∑–∞–ø—É—â–µ–Ω—ñ –Ω–∞–¥–∞–ª—ñ, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏–º—É—Ç—å –Ω–æ–≤—ñ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω—ñ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∏ –¶–°. –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–∞ –∫–æ–º–∞–Ω–¥–∞:
```bash
nsenter --mount=/proc/$ZYGOTE_PID/ns/mnt -- /bin/mount --bind /system/etc/security/cacerts /apex/com.android.conscrypt/cacerts
```
–¶–µ –∑–∞–±–µ–∑–ø–µ—á—É—î, —â–æ –∫–æ–∂–Ω–∞ –Ω–æ–≤–∞ –ø—Ä–æ–≥—Ä–∞–º–∞, —è–∫–∞ —Ä–æ–∑–ø–æ—á–Ω–µ—Ç—å—Å—è, –±—É–¥–µ –¥–æ—Ç—Ä–∏–º—É–≤–∞—Ç–∏—Å—è –æ–Ω–æ–≤–ª–µ–Ω–æ—ó –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—ñ–≤ –¶–°.

4. **–ó–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è –∑–º—ñ–Ω –¥–æ –∑–∞–ø—É—â–µ–Ω–∏—Ö –ø—Ä–æ–≥—Ä–∞–º**: –î–ª—è –∑–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è –∑–º—ñ–Ω –¥–æ –≤–∂–µ –∑–∞–ø—É—â–µ–Ω–∏—Ö –ø—Ä–æ–≥—Ä–∞–º, –∑–Ω–æ–≤—É –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è `nsenter`, —â–æ–± –≤–≤—ñ–π—Ç–∏ –≤ –ø—Ä–æ—Å—Ç—ñ—Ä —ñ–º–µ–Ω –∫–æ–∂–Ω–æ—ó –ø—Ä–æ–≥—Ä–∞–º–∏ –æ–∫—Ä–µ–º–æ —Ç–∞ –≤–∏–∫–æ–Ω–∞—Ç–∏ –∞–Ω–∞–ª–æ–≥—ñ—á–Ω–µ –∑–≤'—è–∑—É–≤–∞–Ω–Ω—è –º–æ–Ω—Ç–∞. –ù–µ–æ–±—Ö—ñ–¥–Ω–∞ –∫–æ–º–∞–Ω–¥–∞:
```bash
nsenter --mount=/proc/$APP_PID/ns/mnt -- /bin/mount --bind /system/etc/security/cacerts /apex/com.android.conscrypt/cacerts
```
5. **–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∏–π –ø—ñ–¥—Ö—ñ–¥ - –ú'—è–∫–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫**: –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∏–π –º–µ—Ç–æ–¥ –ø–µ—Ä–µ–¥–±–∞—á–∞—î –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –ø—Ä–∏–≤'—è–∑–∫–∏ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü—ñ—ó –¥–æ –ø—Ä–æ—Ü–µ—Å—É `init` (PID 1), –∑–∞ —è–∫–∏–º —Å–ª—ñ–¥—É—î –º'—è–∫–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –æ–ø–µ—Ä–∞—Ü—ñ–π–Ω–æ—ó —Å–∏—Å—Ç–µ–º–∏ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –∫–æ–º–∞–Ω–¥ `stop && start`. –¶–µ–π –ø—ñ–¥—Ö—ñ–¥ –ø–µ—Ä–µ–¥–±–∞—á–∞—î –ø–æ—à–∏—Ä–µ–Ω–Ω—è –∑–º—ñ–Ω —É –≤—Å—ñ—Ö –ø—Ä–æ—Å—Ç–æ—Ä–∞—Ö —ñ–º–µ–Ω, —É–Ω–∏–∫–Ω–µ–Ω–Ω—è –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ—Å—Ç—ñ –æ–∫—Ä–µ–º–æ –∞–¥—Ä–µ—Å—É–≤–∞—Ç–∏ –∫–æ–∂–Ω–∏–π –∑–∞–ø—É—â–µ–Ω–∏–π –¥–æ–¥–∞—Ç–æ–∫. –û–¥–Ω–∞–∫ —Ü–µ–π –º–µ—Ç–æ–¥, —è–∫ –ø—Ä–∞–≤–∏–ª–æ, –º–µ–Ω—à–µ –ø–æ–ø—É–ª—è—Ä–Ω–∏–π —á–µ—Ä–µ–∑ –Ω–µ–∑—Ä—É—á–Ω—ñ—Å—Ç—å –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è.

## –ü–æ—Å–∏–ª–∞–Ω–Ω—è

* [https://httptoolkit.com/blog/android-14-install-system-ca-certificate/](https://httptoolkit.com/blog/android-14-install-system-ca-certificate/)
