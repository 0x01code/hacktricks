# рдмрд░реНрдк рд╕рд░реНрдЯрд┐рдлрд┐рдХреЗрдЯ рдЗрдВрд╕реНрдЯреЙрд▓ рдХрд░реЗрдВ

<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдЕрдЧрд░ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА HackTricks рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд рд╣реЛ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕ рджреЗрдЦреЗрдВ**](https://github.com/sponsors/carlospolop)!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХрд╛ рдЦреЛрдЬреЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@carlospolopm**](https://twitter.com/hacktricks_live)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ** рджреНрд╡рд╛рд░рд╛ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВред

</details>

## рдПрдХ рд╡рд░реНрдЪреБрдЕрд▓ рдорд╢реАрди рдкрд░

рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рдЖрдкрдХреЛ рдмрд░реНрдк рд╕реЗ Der рд╕рд░реНрдЯрд┐рдлрд┐рдХреЗрдЯ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред рдЖрдк рдЗрд╕реЗ _**рдкреНрд░реЙрдХреНрд╕реА**_ --> _**рд╡рд┐рдХрд▓реНрдк**_ --> _**рдЖрдпрд╛рдд / рдирд┐рд░реНрдпрд╛рдд рд╕реАрдП рд╕рд░реНрдЯрд┐рдлрд┐рдХреЗрдЯ**_ рдореЗрдВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

![](<../../.gitbook/assets/image (367).png>)

**Der рдкреНрд░рд╛рд░реВрдк рдореЗрдВ рд╕рд░реНрдЯрд┐рдлрд┐рдХреЗрдЯ рдирд┐рд░реНрдпрд╛рдд** рдХрд░реЗрдВ рдФрд░ рдЗрд╕реЗ рдПрдХ рд░реВрдк рдореЗрдВ **рдкрд░рд┐рд╡рд░реНрддрд┐рдд** рдХрд░реЗрдВ рдЬрд┐рд╕реЗ **Android** рд╕рдордЭ рд╕рдХреЗред рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ **рдПрд╡реАрдбреА рдореЗрдВ рдмрд░реНрдк рд╕рд░реНрдЯрд┐рдлрд┐рдХреЗрдЯ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП** рдЖрдкрдХреЛ рдЗрд╕ рдорд╢реАрди рдХреЛ **`-writable-system`** рд╡рд┐рдХрд▓реНрдк рдХреЗ рд╕рд╛рде **рдЪрд▓рд╛рдиреЗ** рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред\
рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЖрдк рдЗрд╕реЗ рдЗрд╕ рдкреНрд░рдХрд╛рд░ рд╕реЗ рдЪрд▓рд╛ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
C:\Users\<UserName>\AppData\Local\Android\Sdk\tools\emulator.exe -avd "AVD9" -http-proxy 192.168.1.12:8080 -writable-system
```
{% endcode %}

рдлрд┐рд░, **рдмрд░реНрдк рдХрд╛ рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░реЗрдВ**:

{% code overflow="wrap" %}
```bash
openssl x509 -inform DER -in burp_cacert.der -out burp_cacert.pem
CERTHASHNAME="`openssl x509 -inform PEM -subject_hash_old -in burp_cacert.pem | head -1`.0"
mv burp_cacert.pem $CERTHASHNAME #Correct name
adb root && sleep 2 && adb remount #Allow to write on /syste
adb push $CERTHASHNAME /sdcard/ #Upload certificate
adb shell mv /sdcard/$CERTHASHNAME /system/etc/security/cacerts/ #Move to correct location
adb shell chmod 644 /system/etc/security/cacerts/$CERTHASHNAME #Assign privileges
adb reboot #Now, reboot the machine
```
{% endcode %}

рдПрдХ рдмрд╛рд░ **рдорд╢реАрди рдкреВрд░реА рддрд░рд╣ рд╕реЗ рд░рд┐рдмреВрдЯ рд╣реЛрдиреЗ** рдХреЗ рдмрд╛рдж рдмрд░реНрдк рд╕рд░реНрдЯрд┐рдлрд┐рдХреЗрдЯ рдЙрд╕рдХреЗ рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдореЗрдВ рд╣реЛрдЧрд╛!

## рдореИрдЬрд┐рд╕реНрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ

рдпрджрд┐ рдЖрдкрдиреЗ рдЕрдкрдиреА рдбрд┐рд╡рд╛рдЗрд╕ рдХреЛ рдореИрдЬрд┐рд╕реНрдХ рдХреЗ рд╕рд╛рде рд░реВрдЯ рдХрд┐рдпрд╛ рд╣реИ (рд╢рд╛рдпрдж рдПрдХ рдПрдореНрдпреБрд▓реЗрдЯрд░), рдФрд░ рдЖрдк рдкрд┐рдЫрд▓реЗ **рд╕реНрдЯреЗрдкреНрд╕** рдХрд╛ рдкрд╛рд▓рди рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рдмрд░реНрдк рд╕рд░реНрдЯрд┐рдлрд┐рдХреЗрдЯ рдЗрдВрд╕реНрдЯреЙрд▓ рдХрд░ рд╕рдХреЗрдВ рдХреНрдпреЛрдВрдХрд┐ **рдлрд╝рд╛рдЗрд▓ рд╕рд┐рд╕реНрдЯрдо рдХреЗрд╡рд▓ рдкрдврд╝рдиреЗ рдХреЗ рд▓рд┐рдП** рд╣реИ рдФрд░ рдЖрдк рдЗрд╕реЗ рд░рд╛рдЗрдЯреЗрдмрд▓ рдирд╣реАрдВ рд░реАрдорд╛рдЙрдВрдЯ рдХрд░ рд╕рдХрддреЗ, рддреЛ рдПрдХ рдФрд░ рддрд░реАрдХрд╛ рд╣реИред

[**рдЗрд╕ рд╡реАрдбрд┐рдпреЛ**](https://www.youtube.com/watch?v=qQicUW0svB8) рдореЗрдВ рд╕реНрдкрд╖реНрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рдХрд┐ рдЖрдкрдХреЛ:

1. **рд╕реАрдП рд╕рд░реНрдЯрд┐рдлрд┐рдХреЗрдЯ рдЗрдВрд╕реНрдЯреЙрд▓ рдХрд░реЗрдВ**: рдмрд╕ рдореЛрдмрд╛рдЗрд▓ рдореЗрдВ рдбреАрдИрдЖрд░ рдмрд░реНрдк рд╕рд░реНрдЯрд┐рдлрд┐рдХреЗрдЯ рдХреЛ `.crt` рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдореЗрдВ рдмрджрд▓рдХрд░ рдбреНрд░реИрдЧ рдПрдВрдб рдбреНрд░реЙрдк рдХрд░реЗрдВ рддрд╛рдХрд┐ рдпрд╣ рдбрд╛рдЙрдирд▓реЛрдбреНрд╕ рдлрд╝реЛрд▓реНрдбрд░ рдореЗрдВ рд╕реНрдЯреЛрд░ рд╣реЛ рдФрд░ `рдЗрдВрд╕реНрдЯреЙрд▓ рд╕рд░реНрдЯрд┐рдлрд┐рдХреЗрдЯ` -> `рд╕реАрдП рд╕рд░реНрдЯрд┐рдлрд┐рдХреЗрдЯ` рдкрд░ рдЬрд╛рдПрдВ

<figure><img src="../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt="" width="164"><figcaption></figcaption></figure>

* рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░реЗрдВ рдХрд┐ рд╕рд░реНрдЯрд┐рдлрд┐рдХреЗрдЯ рд╕рд╣реА рдврдВрдЧ рд╕реЗ рд╕реНрдЯреЛрд░ рд╣реБрдЖ рд╣реИ рдЬрд╛рдХрд░ `рдЯреНрд░рд╕реНрдЯреЗрдб рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕` -> `рдпреВрдЬрд╝рд░` рдкрд░ рдЬрд╛рдПрдВ

<figure><img src="../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt="" width="334"><figcaption></figcaption></figure>

2. **рдЗрд╕реЗ рд╕рд┐рд╕реНрдЯрдо рдЯреНрд░рд╕реНрдЯреЗрдб рдмрдирд╛рдПрдВ**: рдореИрдЬрд┐рд╕реНрдХ рдореЙрдбреНрдпреВрд▓ [MagiskTrustUserCerts](https://github.com/NVISOsecurity/MagiskTrustUserCerts) (рдПрдХ .zip рдлрд╝рд╛рдЗрд▓) рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ, рдлрд╝реЛрди рдореЗрдВ рдбреНрд░реИрдЧ рдПрдВрдб рдбреНрд░реЙрдк рдХрд░реЗрдВ, рдлрд╝реЛрди рдореЗрдВ рдореИрдЬрд┐рдХреНрд╕ рдРрдк рдореЗрдВ рдЬрд╛рдПрдВ, `рдореЙрдбреНрдпреВрд▓реНрд╕` рд╕реЗрдХреНрд╢рди рдореЗрдВ рдЬрд╛рдПрдВ, `рд╕реНрдЯреЛрд░реЗрдЬ рд╕реЗ рдЗрдВрд╕реНрдЯреЙрд▓ рдХрд░реЗрдВ` рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВ, `.zip` рдореЙрдбреНрдпреВрд▓ рдХрд╛ рдЪрдпрди рдХрд░реЗрдВ рдФрд░ рдПрдХ рдмрд╛рд░ рдЗрдВрд╕реНрдЯреЙрд▓ рд╣реЛрдиреЗ рдХреЗ рдмрд╛рдж рдлрд╝реЛрди рдХреЛ **рд░реАрдмреВрдЯ** рдХрд░реЗрдВ:

<figure><img src="../../.gitbook/assets/image (2) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt="" width="345"><figcaption></figcaption></figure>

* рд░реАрдмреВрдЯ рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, `рдЯреНрд░рд╕реНрдЯреЗрдб рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕` -> `рд╕рд┐рд╕реНрдЯрдо` рдкрд░ рдЬрд╛рдПрдВ рдФрд░ рджреЗрдЦреЗрдВ рдХрд┐ рдкреЛрд╕реНрдЯрд╕реНрд╡рд┐рдЧрд░ рд╕рд░реНрдЯ рд╣реИ рдпрд╛ рдирд╣реАрдВ

<figure><img src="../../.gitbook/assets/image (3) (1) (1) (1) (1) (1).png" alt="" width="314"><figcaption></figcaption></figure>

## рдПрдВрдбреНрд░реЙрдЗрдб 14 рдХреЗ рдмрд╛рдж

рдирд╡реАрдирддрдо рдПрдВрдбреНрд░реЙрдЗрдб 14 рд░рд┐рд▓реАрдЬрд╝ рдореЗрдВ, рд╕рд┐рд╕реНрдЯрдо-рдЯреНрд░рд╕реНрдЯреЗрдб рд╕рд░реНрдЯрд┐рдлрд┐рдХреЗрдЯ рдЕрдереЙрд░рд┐рдЯреА (рд╕реАрдП) рд╕рд░реНрдЯрд┐рдлрд┐рдХреЗрдЯреЛрдВ рдХреЗ рд╣реИрдВрдбрд▓рд┐рдВрдЧ рдореЗрдВ рдПрдХ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдкрд░рд┐рд╡рд░реНрддрди рджреЗрдЦрд╛ рдЧрдпрд╛ рд╣реИред рдкрд╣рд▓реЗ, рдпреЗ рд╕рд░реНрдЯрд┐рдлрд┐рдХреЗрдЯ **`/system/etc/security/cacerts/`** рдореЗрдВ рд╕реНрдерд╛рдкрд┐рдд рдереЗ, рдЬрд┐рдиреНрд╣реЗрдВ рд░реВрдЯ рдкреНрд░рд┐рд╡рд┐рд▓реЗрдЬрд╝ рд╡рд╛рд▓реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рджреНрд╡рд╛рд░рд╛ рдкрд╣реБрдВрдЪрдиреЗ рдФрд░ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдереА, рдЬрд┐рд╕рд╕реЗ рдкреНрд░рдгрд╛рд▓реА рдкрд░ рддрддреНрдХрд╛рд▓ рд▓рд╛рдЧреВ рд╣реЛ рд╕рдХрддрд╛ рдерд╛ред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдПрдВрдбреНрд░реЙрдЗрдб 14 рдХреЗ рд╕рд╛рде, рд╕реНрдЯреЛрд░реЗрдЬ рд╕реНрдерд╛рдирдХ рдХреЛ **`/apex/com.android.conscrypt/cacerts`** рдореЗрдВ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдЬреЛ **`/apex`** рдкрде рдХреЗ рднреАрддрд░ рдПрдХ рдирд┐рд░реНрд╡рд┐рд╡рд╛рдж рд╕реНрд╡рднрд╛рд╡ рд╡рд╛рд▓рд╛ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рд╣реИред

**APEX cacerts рдкрде** рдХреЛ рд░рд╛рдЗрдЯреЗрдмрд▓ рд░реВрдк рдореЗрдВ рд░реАрдорд╛рдЙрдВрдЯ рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рд╡рд┐рдлрд▓ рд╣реЛрддреА рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдкреНрд░рдгрд╛рд▓реА рдРрд╕реЗ рдХрд╛рд░реНрдпреЛрдВ рдХреА рдЕрдиреБрдорддрд┐ рдирд╣реАрдВ рджреЗрддреАред рди рддреЛ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХреЛ рдЕрдирдорд╛рдЙрдВрдЯ рдХрд░рдиреЗ рдпрд╛ рдЙрд╕реЗ рдПрдХ рдЕрд╕реНрдерд╛рдпреА рдлрд╝рд╛рдЗрд▓ рд╕рд┐рд╕реНрдЯрдо (рдЯреАрдПрдордкреАрдПрд╕) рдХреЗ рд╕рд╛рде рдУрд╡рд░рд▓реЗ рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢реЗрдВ рдЗрд╕ рдЕрдЪрд▓рддрд╛ рдХреЛ рджреВрд░ рдирд╣реАрдВ рдХрд░рддреА рд╣реИрдВ; рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдлрд╝рд╛рдЗрд▓ рд╕рд┐рд╕реНрдЯрдо рд╕реНрддрд░ рдкрд░ рдкрд░рд┐рд╡рд░реНрддрдиреЛрдВ рдХрд╛ рдЕрднреНрдпрд╛рд╕ рдХрд░рддреЗ рд░рд╣рддреЗ рд╣реИрдВред рдпрд╣ рдЯрд┐рдХрд╛рдКрддрд╛ **`/apex`** рдорд╛рдЙрдВрдЯ рдХреЛ рдкреНрд░рд╛рдЗрд╡реЗрдЯ рдкреНрд░рд╕рд╛рд░рдг рдХреЗ рд╕рд╛рде рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдиреЗ рд╕реЗ рд╣реЛрддреА рд╣реИ, рдЬрд┐рд╕рд╕реЗ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рд╣реЛрддрд╛ рд╣реИ рдХрд┐ **`/apex`** рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХреЗ рднреАрддрд░ рдХрд┐рдП рдЧрдП рдкрд░рд┐рд╡рд░реНрддрди рдЕрдиреНрдп рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдкрд░ рдкреНрд░рднрд╛рд╡ рдирд╣реАрдВ рдбрд╛рд▓рддреЗред

рдПрдВрдбреНрд░реЙрдЗрдб рдХреА рдкреНрд░рд╛рд░рдВрднрд┐рдХреАрдХрд░рдг рдореЗрдВ `рдЗрдирд┐рдЯ` рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд╢рд╛рдорд┐рд▓ рд╣реИ, рдЬреЛ рдСрдкрд░реЗрдЯрд┐рдВрдЧ рд╕рд┐рд╕реНрдЯрдо рдХреА рд╢реБрд░реБрдЖрдд рдкрд░ рдЬрдм рд╢реБрд░реВ рд╣реЛрддреА рд╣реИ, рддреЛ рдЬрд╛рдЗрдЧреЛрдЯ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рднреА рдЖрд░рдВрдн рдХрд░рддреА рд╣реИред рдпрд╣ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдПрдХ рдирдП рдорд╛рдЙрдВрдЯ рдиреЗрдорд╕реНрдкреЗрд╕ рдХреЗ рд╕рд╛рде рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЛ рд▓реЙрдиреНрдЪ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЬрд┐рдореНрдореЗрджрд╛рд░ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рдПрдХ рдирд┐рдЬреА **`/apex`** рдорд╛рдЙрдВрдЯ рд╢рд╛рдорд┐рд▓ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдЗрд╕ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХреЗ рдкрд░рд┐рд╡рд░реНрддрдиреЛрдВ рдХреЛ рдЕрдиреНрдп рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рд╕реЗ рдЕрд▓рдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

рд╣рд╛рд▓рд╛рдВрдХрд┐, **`/apex`** рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХреЗ рднреАрддрд░ рд╕рд┐рд╕реНрдЯрдо-рдЯреНрд░рд╕реНрдЯреЗрдб рд╕реАрдП рд╕рд░реНрдЯрд┐рдлрд┐рдХреЗрдЯреЛрдВ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рд╡рд╛рд▓реЛрдВ рдХреЗ рд▓рд┐рдП рдПрдХ рдЙрдкрд╛рдп рдореМрдЬреВрдж рд╣реИред рдЗрд╕рдореЗрдВ **`/apex`** рдХреЛ рдкреНрд░рд╛рдЗрд╡реЗрдЯ рдкреНрд░рд╕рд╛рд░рдг рд╣рдЯрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдореИрдиреНрдпреБрдЕрд▓ рд░реАрдорд╛рдЙрдВрдЯ рдХрд░рдирд╛ рд╢рд╛рдорд┐рд▓ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдЗрд╕реЗ рд░рд╛рдЗрдЯреЗрдмрд▓ рдмрдирд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдЗрд╕ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ **`/apex/com.android.conscrypt`** рдХреА рд╕рд╛рдордЧреНрд░реА рдХреА рдХреЙрдкреА рдХрд░рдирд╛, **`/apex/com.android.conscrypt`** рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХреЛ рдЕрдирдорд╛рдЙрдВрдЯ рдХрд░рдирд╛ рддрд╛рдХрд┐ рдкрдврд╝рдиреЗ рдпреЛрдЧреНрдп рдкреНрд░рддрд┐рдмрдВрдз рдХреЛ рд╣рдЯрд╛рдпрд╛ рдЬрд╛ рд╕рдХреЗ, рдФрд░ рдлрд┐рд░ рд╕рд╛рдордЧреНрд░реА рдХреЛ рдЙрд╕рдХреЗ рдореВрд▓ рд╕реНрдерд╛рди рдкрд░ **`/apex`** рдХреЗ рднреАрддрд░ рдмрд╣рд╛рд▓ рдХрд░рдирд╛ рд╣реИред рдЗрд╕ рджреГрд╖реНрдЯрд┐рдХреЛрдг рд╕реЗ рд╕рд┐рд╕реНрдЯрдо-рд╡рд╛рдЗрдб рдкрд░рд┐рд╡рд░реНрддрдиреЛрдВ рдХреЛ рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, `system_server` рдХреЛ рдкреБрдирдГ рдЖрд░рдВрдн рдХрд░рдиреЗ рдХреА рд╕рд┐рдлрд╛рд░рд┐рд╢ рдХреА рдЬрд╛рддреА рд╣реИ, рдЬрд┐рд╕рд╕реЗ рд╕рднреА рдПрдкреНрд▓рд┐рдХреЗрд╢рдиреЛрдВ рдХреЛ рдкреБрдирдГ рдЖрд░рдВрдн рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рд╕рд┐рд╕реНрдЯрдо рдХреЛ рдПрдХ рд╕рдВрдЧрдд рд╕реНрдерд┐рддрд┐ рдореЗрдВ рд▓рд╛рддрд╛ рд╣реИред
```bash
# Create a separate temp directory, to hold the current certificates
# Otherwise, when we add the mount we can't read the current certs anymore.
mkdir -p -m 700 /data/local/tmp/tmp-ca-copy

# Copy out the existing certificates
cp /apex/com.android.conscrypt/cacerts/* /data/local/tmp/tmp-ca-copy/

# Create the in-memory mount on top of the system certs folder
mount -t tmpfs tmpfs /system/etc/security/cacerts

# Copy the existing certs back into the tmpfs, so we keep trusting them
mv /data/local/tmp/tmp-ca-copy/* /system/etc/security/cacerts/

# Copy our new cert in, so we trust that too
mv $CERTIFICATE_PATH /system/etc/security/cacerts/

# Update the perms & selinux context labels
chown root:root /system/etc/security/cacerts/*
chmod 644 /system/etc/security/cacerts/*
chcon u:object_r:system_file:s0 /system/etc/security/cacerts/*

# Deal with the APEX overrides, which need injecting into each namespace:

# First we get the Zygote process(es), which launch each app
ZYGOTE_PID=$(pidof zygote || true)
ZYGOTE64_PID=$(pidof zygote64 || true)
# N.b. some devices appear to have both!

# Apps inherit the Zygote's mounts at startup, so we inject here to ensure
# all newly started apps will see these certs straight away:
for Z_PID in "$ZYGOTE_PID" "$ZYGOTE64_PID"; do
if [ -n "$Z_PID" ]; then
nsenter --mount=/proc/$Z_PID/ns/mnt -- \
/bin/mount --bind /system/etc/security/cacerts /apex/com.android.conscrypt/cacerts
fi
done

# Then we inject the mount into all already running apps, so they
# too see these CA certs immediately:

# Get the PID of every process whose parent is one of the Zygotes:
APP_PIDS=$(
echo "$ZYGOTE_PID $ZYGOTE64_PID" | \
xargs -n1 ps -o 'PID' -P | \
grep -v PID
)

# Inject into the mount namespace of each of those apps:
for PID in $APP_PIDS; do
nsenter --mount=/proc/$PID/ns/mnt -- \
/bin/mount --bind /system/etc/security/cacerts /apex/com.android.conscrypt/cacerts &
done
wait # Launched in parallel - wait for completion here

echo "System certificate injected"
```
### NSEnter рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдмрд╛рдЗрдВрдб-рдорд╛рдЙрдВрдЯрд┐рдВрдЧ

1. **рдПрдХ рд▓рд┐рдЦрдиреЗ рдпреЛрдЧреНрдп рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рд╕реЗрдЯ рдХрд░рдирд╛**: рдкрд╣рд▓реЗ, рдореМрдЬреВрджрд╛ рдЧреИрд░-APEX рд╕рд┐рд╕реНрдЯрдо рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдкрд░ `tmpfs` рдХреЛ рдорд╛рдЙрдВрдЯ рдХрд░рдХреЗ рдПрдХ рд▓рд┐рдЦрдиреЗ рдпреЛрдЧреНрдп рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рд╕реНрдерд╛рдкрд┐рдд рдХреА рдЬрд╛рддреА рд╣реИред рдпрд╣ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрдорд╛рдВрдб рдХреЗ рд╕рд╛рде рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ:
```bash
mount -t tmpfs tmpfs /system/etc/security/cacerts
```
2. **рддреИрдпрд╛рд░реА CA рдкреНрд░рдорд╛рдгрдкрддреНрд░**: рд▓реЗрдЦрдиреАрдп рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХреА рд╕реЗрдЯрдЕрдк рдХреЗ рдмрд╛рдж, рдЙрди CA рдкреНрд░рдорд╛рдгрдкрддреНрд░реЛрдВ рдХреЛ рдЗрд╕ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдореЗрдВ рдХреЙрдкреА рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП рдЬрд┐рдиреНрд╣реЗрдВ рдЖрдк рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВред рдЗрд╕рдореЗрдВ `/apex/com.android.conscrypt/cacerts/` рд╕реЗ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдкреНрд░рдорд╛рдгрдкрддреНрд░реЛрдВ рдХреА рдХреЙрдкреА рд╢рд╛рдорд┐рд▓ рд╣реЛ рд╕рдХрддреА рд╣реИред рдЗрди рдкреНрд░рдорд╛рдгрдкрддреНрд░реЛрдВ рдХреА рдЕрдиреБрд░реВрдк рдЕрдиреБрдорддрд┐рдпреЛрдВ рдФрд░ SELinux рд▓реЗрдмрд▓ рдХреЛ рд╕рд╣реА рдврдВрдЧ рд╕реЗ рд╕рдорд╛рдпреЛрдЬрд┐рдд рдХрд░рдирд╛ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИред

3. **Zygote рдХреЗ рд▓рд┐рдП рдмрд╛рдЗрдВрдб рдорд╛рдЙрдВрдЯрд┐рдВрдЧ**: `nsenter` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ, рд╡реНрдпрдХреНрддрд┐ Zygote рдХреЗ рдорд╛рдЙрдВрдЯ рдиреЗрдорд╕реНрдкреЗрд╕ рдореЗрдВ рдкреНрд░рд╡реЗрд╢ рдХрд░рддрд╛ рд╣реИред Zygote, рдЬреЛ Android рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд▓реЙрдиреНрдЪ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЬрд┐рдореНрдореЗрджрд╛рд░ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд╣реИ, рдЗрд╕ рдХрджрдо рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ рддрд╛рдХрд┐ рдЖрдЧреЗ рд╕реЗ рдкреНрд░рд╛рд░рдВрдн рдХреА рдЧрдИ рд╕рднреА рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдирдП рд╡рд┐рдиреНрдпрд╛рд╕рд┐рдд CA рдкреНрд░рдорд╛рдгрдкрддреНрд░реЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд┐рдпрд╛ рдЬрд╛рдиреЗ рд╡рд╛рд▓рд╛ рдХрдорд╛рдВрдб рд╣реИ:
```bash
nsenter --mount=/proc/$ZYGOTE_PID/ns/mnt -- /bin/mount --bind /system/etc/security/cacerts /apex/com.android.conscrypt/cacerts
```
рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдкреНрд░рддреНрдпреЗрдХ рдирдпрд╛ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдЕрдкрдбреЗрдЯреЗрдб рд╕реАрдП рдкреНрд░рдорд╛рдгрдкрддреНрд░ рд╕реЗрдЯрдЕрдк рдХрд╛ рдкрд╛рд▓рди рдХрд░реЗрдЧрд╛ред

4. **рдЪрд▓ рд░рд╣реЗ рдПрдкреНрд▓рд┐рдХреЗрд╢рдиреЛрдВ рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрди рд▓рд╛рдЧреВ рдХрд░рдирд╛**: рдкрд╣рд▓реЗ рд╕реЗ рдЪрд▓ рд░рд╣реЗ рдПрдкреНрд▓рд┐рдХреЗрд╢рдиреЛрдВ рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрди рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, `nsenter` рдХреЛ рдлрд┐рд░ рд╕реЗ рдкреНрд░рддреНрдпреЗрдХ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЗ рдиреЗрдорд╕реНрдкреЗрд╕ рдореЗрдВ рдкреНрд░рд╡реЗрд╢ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдПрдХ рд╕рдорд╛рди рдмрд╛рдЗрдВрдб рдорд╛рдЙрдВрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдПред рдЖрд╡рд╢реНрдпрдХ рдХрдорд╛рдВрдб рд╣реИ:
```bash
nsenter --mount=/proc/$APP_PID/ns/mnt -- /bin/mount --bind /system/etc/security/cacerts /apex/com.android.conscrypt/cacerts
```
5. **рд╡реИрдХрд▓реНрдкрд┐рдХ рджреГрд╖реНрдЯрд┐рдХреЛрдг - рд╕реЙрдлреНрдЯ рд░реАрдмреВрдЯ**: рдПрдХ рд╡реИрдХрд▓реНрдкрд┐рдХ рд╡рд┐рдзрд┐ рдореЗрдВ `init` рдкреНрд░рдХреНрд░рд┐рдпрд╛ (PID 1) рдкрд░ рдмрд╛рдЗрдВрдб рдорд╛рдЙрдВрдЯ рдХрд░рдирд╛ рд╢рд╛рдорд┐рд▓ рд╣реИ, рдЬрд┐рд╕рдХреЗ рдмрд╛рдж рдСрдкрд░реЗрдЯрд┐рдВрдЧ рд╕рд┐рд╕реНрдЯрдо рдХреЛ `stop && start` рдХрдорд╛рдВрдб рдХреЗ рд╕рд╛рде рд╕реЙрдлреНрдЯ рд░реАрдмреВрдЯ рдХрд░рдирд╛ред рдпрд╣ рджреГрд╖реНрдЯрд┐рдХреЛрдг рд╕рднреА рдиреЗрдорд╕реНрдкреЗрд╕ рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрдиреЛрдВ рдХреЛ рдлреИрд▓рд╛рдПрдЧрд╛, рдЬрд┐рд╕рд╕реЗ рд╣рд░ рдЪрд▓ рд░рд╣реЗ рдРрдк рдХреЛ рд╡реНрдпрдХреНрддрд┐рдЧрдд рд░реВрдк рд╕реЗ рд╕рдВрдмреЛрдзрд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реЛрдЧреАред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЗрд╕ рд╡рд┐рдзрд┐ рдХреЛ рдЖрдо рддреМрд░ рдкрд░ рдкреБрдирд░рд╛рд░рдВрдн рдХрд░рдиреЗ рдХреА рдЕрд╕реБрд╡рд┐рдзрд╛ рдХреЗ рдХрд╛рд░рдг рдХрдо рдкрд╕рдВрдж рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

## рд╕рдВрджрд░реНрдн
* [https://httptoolkit.com/blog/android-14-install-system-ca-certificate/](https://httptoolkit.com/blog/android-14-install-system-ca-certificate/)

<details>

<summary><strong>рдЬреАрд░реНрдг AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ рд╕реАрдЦреЗрдВ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@carlospolopm**](https://twitter.com/hacktricks_live) рдкрд░ **рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github рд░реЗрдкреЛ рдореЗрдВ PR рдЬрдорд╛ рдХрд░рдХреЗред

</details>
