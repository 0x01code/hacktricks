# Installeer Burp-sertifikaat

<details>

<summary><strong>Leer AWS-hacking vanaf nul tot held met</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Ander maniere om HackTricks te ondersteun:

* As jy jou **maatskappy in HackTricks wil adverteer** of **HackTricks in PDF wil aflaai**, kyk na die [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Kry die [**amptelike PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ontdek [**The PEASS Family**](https://opensea.io/collection/the-peass-family), ons versameling eksklusiewe [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Deel jou hacktruuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-repos.

</details>

## Op 'n Virtuele Masjien

Eerstens moet jy die Der-sertifikaat van Burp aflaai. Jy kan dit doen in _**Proxy**_ --> _**Options**_ --> _**Import / Export CA certificate**_

![](<../../.gitbook/assets/image (367).png>)

**Voer die sertifikaat uit in Der-formaat** en laat ons dit **omskep** na 'n vorm wat **Android** sal kan **verstaan.** Let daarop dat **om die burp-sertifikaat op die Android-masjien in AVD te konfigureer**, moet jy hierdie masjien **met die** **`-writable-system`**-opsie **uitvoer**.\
Byvoorbeeld, jy kan dit so uitvoer:

{% code overflow="wrap" %}
```bash
C:\Users\<UserName>\AppData\Local\Android\Sdk\tools\emulator.exe -avd "AVD9" -http-proxy 192.168.1.12:8080 -writable-system
```
{% endcode %}

Dan, om die sertifikaat van burp te **konfigureer**, doen die volgende:

{% code overflow="wrap" %}
```bash
openssl x509 -inform DER -in burp_cacert.der -out burp_cacert.pem
CERTHASHNAME="`openssl x509 -inform PEM -subject_hash_old -in burp_cacert.pem | head -1`.0"
mv burp_cacert.pem $CERTHASHNAME #Correct name
adb root && sleep 2 && adb remount #Allow to write on /syste
adb push $CERTHASHNAME /sdcard/ #Upload certificate
adb shell mv /sdcard/$CERTHASHNAME /system/etc/security/cacerts/ #Move to correct location
adb shell chmod 644 /system/etc/security/cacerts/$CERTHASHNAME #Assign privileges
adb reboot #Now, reboot the machine
```
{% endcode %}

Sodra die **rekenaar klaar herlaai** het, sal die Burp-sertifikaat deur dit gebruik word!

## Gebruik van Magisc

As jy jou toestel met Magisc **geroot** het (dalk 'n emulator), en jy **kan nie** die vorige **stappe** volg om die Burp-sertifikaat te installeer nie omdat die **l√™ersisteem skryfbeskerming** het en jy dit nie skryfbaar kan maak nie, is daar 'n ander manier.

Soos verduidelik in [**hierdie video**](https://www.youtube.com/watch?v=qQicUW0svB8) moet jy:

1. **Installeer 'n CA-sertifikaat**: Sleep die DER Burp-sertifikaat **met die verandering van die l√™eruitbreiding** na `.crt` in die mobiele toestel sodat dit in die Aflaai-gevorderde gestoor word en gaan na `Installeer 'n sertifikaat` -> `CA-sertifikaat`

<figure><img src="../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt="" width="164"><figcaption></figcaption></figure>

* Kontroleer dat die sertifikaat korrek gestoor is deur na `Vertroude legitimasie` -> `GEBRUIKER` te gaan

<figure><img src="../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt="" width="334"><figcaption></figcaption></figure>

2. **Maak dit Sisteem-vertrou**: Laai die Magisc-module [MagiskTrustUserCerts](https://github.com/NVISOsecurity/MagiskTrustUserCerts) ( 'n .zip-l√™er) af, **sleep dit** na die foon, gaan na die **Magics-app** op die foon na die **`Modules`**-afdeling, klik op **`Installeer vanaf stoor`**, kies die `.zip`-module en nadat dit ge√Ønstalleer is, **herlaai** die foon:

<figure><img src="../../.gitbook/assets/image (2) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt="" width="345"><figcaption></figcaption></figure>

* Na herlaaiing, gaan na `Vertroude legitimasie` -> `SISTEEM` en kontroleer of die Postswigger-sertifikaat daar is

<figure><img src="../../.gitbook/assets/image (3) (1) (1) (1) (1) (1).png" alt="" width="314"><figcaption></figcaption></figure>

## Na Android 14

In die nuutste Android 14 vrystelling is 'n beduidende verskuiwing waargeneem in die hantering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertifisering van sertif
```bash
# Create a separate temp directory, to hold the current certificates
# Otherwise, when we add the mount we can't read the current certs anymore.
mkdir -p -m 700 /data/local/tmp/tmp-ca-copy

# Copy out the existing certificates
cp /apex/com.android.conscrypt/cacerts/* /data/local/tmp/tmp-ca-copy/

# Create the in-memory mount on top of the system certs folder
mount -t tmpfs tmpfs /system/etc/security/cacerts

# Copy the existing certs back into the tmpfs, so we keep trusting them
mv /data/local/tmp/tmp-ca-copy/* /system/etc/security/cacerts/

# Copy our new cert in, so we trust that too
mv $CERTIFICATE_PATH /system/etc/security/cacerts/

# Update the perms & selinux context labels
chown root:root /system/etc/security/cacerts/*
chmod 644 /system/etc/security/cacerts/*
chcon u:object_r:system_file:s0 /system/etc/security/cacerts/*

# Deal with the APEX overrides, which need injecting into each namespace:

# First we get the Zygote process(es), which launch each app
ZYGOTE_PID=$(pidof zygote || true)
ZYGOTE64_PID=$(pidof zygote64 || true)
# N.b. some devices appear to have both!

# Apps inherit the Zygote's mounts at startup, so we inject here to ensure
# all newly started apps will see these certs straight away:
for Z_PID in "$ZYGOTE_PID" "$ZYGOTE64_PID"; do
if [ -n "$Z_PID" ]; then
nsenter --mount=/proc/$Z_PID/ns/mnt -- \
/bin/mount --bind /system/etc/security/cacerts /apex/com.android.conscrypt/cacerts
fi
done

# Then we inject the mount into all already running apps, so they
# too see these CA certs immediately:

# Get the PID of every process whose parent is one of the Zygotes:
APP_PIDS=$(
echo "$ZYGOTE_PID $ZYGOTE64_PID" | \
xargs -n1 ps -o 'PID' -P | \
grep -v PID
)

# Inject into the mount namespace of each of those apps:
for PID in $APP_PIDS; do
nsenter --mount=/proc/$PID/ns/mnt -- \
/bin/mount --bind /system/etc/security/cacerts /apex/com.android.conscrypt/cacerts &
done
wait # Launched in parallel - wait for completion here

echo "System certificate injected"
```
### Bind-montasie deur NSEnter

1. **Opstel van 'n Skryfbare Gids**: Aanvanklik word 'n skryfbare gids opgestel deur 'n `tmpfs` oor die bestaande nie-APEX-stelselertifikaatgids te monteer. Dit word bereik met die volgende bevel:
```bash
mount -t tmpfs tmpfs /system/etc/security/cacerts
```
2. **Voorbereiding van CA-sertifikate**: Na die opstel van die skryfbare gids moet die CA-sertifikate wat jy wil gebruik, gekopieer word na hierdie gids. Dit mag die kopie van die verstek sertifikate vanaf `/apex/com.android.conscrypt/cacerts/` behels. Dit is noodsaaklik om die toestemmings en SELinux-etikette van hierdie sertifikate dienooreenkomstig aan te pas.

3. **Bind Montering vir Zygote**: Deur gebruik te maak van `nsenter`, betree jy die monteer-namespace van Zygote. Zygote, as die proses wat verantwoordelik is vir die begin van Android-toepassings, vereis hierdie stap om te verseker dat alle toepassings wat hierna ge√Ønisieer word, die nuut gekonfigureerde CA-sertifikate gebruik. Die gebruikte bevel is:
```bash
nsenter --mount=/proc/$ZYGOTE_PID/ns/mnt -- /bin/mount --bind /system/etc/security/cacerts /apex/com.android.conscrypt/cacerts
```
Dit verseker dat elke nuwe app wat begin, sal voldoen aan die opgedateerde CA-sertifikate-instelling.

4. **Veranderinge toepas op lopende apps**: Om die veranderinge op reeds lopende programme toe te pas, word `nsenter` weer gebruik om individueel in elke app se namespace in te gaan en 'n soortgelyke bind mount uit te voer. Die nodige bevel is:
```bash
nsenter --mount=/proc/$APP_PID/ns/mnt -- /bin/mount --bind /system/etc/security/cacerts /apex/com.android.conscrypt/cacerts
```
5. **Alternatiewe Benadering - Sagte Herlaai**: 'n Alternatiewe metode behels die uitvoer van die bind mount op die `init` proses (PID 1), gevolg deur 'n sagte herlaai van die bedryfstelsel met die `stop && start` opdragte. Hierdie benadering sal die veranderinge oor alle namespaces versprei, wat die noodsaaklikheid om elke lopende app individueel te adresseer, vermy. Hierdie metode word egter oor die algemeen minder verkies as gevolg van die ongerief van herlaaiing.

## Verwysings
* [https://httptoolkit.com/blog/android-14-install-system-ca-certificate/](https://httptoolkit.com/blog/android-14-install-system-ca-certificate/)

<details>

<summary><strong>Leer AWS-hacking vanaf nul tot held met</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Ander maniere om HackTricks te ondersteun:

* As jy wil sien dat jou **maatskappy geadverteer word in HackTricks** of **HackTricks aflaai in PDF-formaat**, kyk na die [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Kry die [**amptelike PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ontdek [**The PEASS Family**](https://opensea.io/collection/the-peass-family), ons versameling eksklusiewe [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Deel jou hacktruuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-opslag.

</details>
