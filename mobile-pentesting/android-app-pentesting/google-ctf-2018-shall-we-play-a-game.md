# Google CTF 2018 - 我们来玩个游戏吧？

<details>

<summary><strong>从零开始学习 AWS 黑客技术，成为专家</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE（HackTricks AWS 红队专家）</strong></a><strong>！</strong></summary>

支持 HackTricks 的其他方式：

* 如果您想看到您的**公司在 HackTricks 中做广告**或**下载 PDF 版的 HackTricks**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)!
* 获取[**官方 PEASS & HackTricks 商品**](https://peass.creator-spring.com)
* 探索[**PEASS 家族**](https://opensea.io/collection/the-peass-family)，我们的独家[**NFTs**](https://opensea.io/collection/the-peass-family)
* **加入** 💬 [**Discord 群组**](https://discord.gg/hRep4RUj7f) 或 [**电报群组**](https://t.me/peass) 或在 **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks\_live)** 上关注我们**。
* 通过向 [**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github 仓库提交 PR 来分享您的黑客技巧。

</details>

在这里下载 APK：

我将上传 APK 到 [https://appetize.io/](https://appetize.io)（免费账户）查看 apk 的行为：

![](<../../.gitbook/assets/image (421).png>)

看起来你需要赢得 1000000 次才能获得 flag。

按照 [Android 渗透测试](./) 中的步骤，您可以反编译应用程序以获取 smali 代码，并使用 jadx 读取 Java 代码。

阅读 Java 代码：

![](<../../.gitbook/assets/image (495).png>)

看起来打印 flag 的函数是 **m().**

## **Smali 更改**

### **第一次调用 m()**

让应用程序在变量 _this.o != 1000000_ 时调用 m()，为此，只需更改条件：
```
if-ne v0, v9, :cond_2
```
## Google CTF 2018: Shall we play a game?

---

### Flag 1

The first flag is stored in the `SharedPreferences` of the application. You can easily retrieve it using `adb`.

### Flag 2

The second flag is stored in the app's internal database. You can access it by pulling the database file from the device using `adb`.

### Flag 3

The third flag is stored in a file located at `/data/data/com.google.ctf.shallweplayagame/files/flag3.txt` on the device. You can pull this file using `adb`.

### Flag 4

The fourth flag is stored in the app's cache directory. You can retrieve it by pulling the cache directory from the device using `adb`.

### Flag 5

The fifth flag is stored in the app's private directory. You can access it by pulling the app's private directory from the device using `adb`.

### Flag 6

The sixth flag is stored in the app's external storage directory. You can retrieve it by pulling the external storage directory from the device using `adb`.
```
if-eq v0, v9, :cond_2
```
![之前](<../../.gitbook/assets/image (383).png>)

![之后](<../../.gitbook/assets/image (838).png>)

按照[Android渗透测试](./)的步骤重新编译并签署APK。然后，将其上传到[https://appetize.io/](https://appetize.io)，看看会发生什么：

![](<../../.gitbook/assets/image (128).png>)

看起来标志是未完全解密地写入的。可能应该调用m()函数1000000次。

**另一种**方法是不更改指令，而是更改比较的指令：

![](<../../.gitbook/assets/image (840).png>)

**另一种**方法是将值与1000000进行比较，将值设置为1，以便将this.o与1进行比较：

![](<../../.gitbook/assets/image (629).png>)

第四种方法是添加一条指令，将v9(1000000)的值移动到v0 _(this.o)_：

![](<../../.gitbook/assets/image (414).png>)

![](<../../.gitbook/assets/image (424).png>)

## 解决方案

当您第一次获胜时，使应用程序运行循环100000次。为此，您只需要创建**：goto\_6**循环，并使应用程序**跳转到那里，如果`this.o`**的值不是100000：

![](<../../.gitbook/assets/image (1090).png>)

您需要在物理设备内执行此操作，因为（我不知道为什么）在模拟设备中无法正常工作。
