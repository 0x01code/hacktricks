# Google CTF 2018 - Shall We Play a Game?

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks Cloud ☁️</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>🐦 Twitter 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 Youtube 🎥</strong></a></summary>

* サイバーセキュリティ会社で働いていますか？ **HackTricksで会社を宣伝**したいですか？または、**PEASSの最新バージョンにアクセスしたり、HackTricksをPDFでダウンロード**したいですか？[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を見つけてください。独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクションです。
* [**公式のPEASS＆HackTricksのグッズ**](https://peass.creator-spring.com)を手に入れましょう。
* [**💬**](https://emojipedia.org/speech-balloon/) [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**telegramグループ**](https://t.me/peass)に**参加**するか、**Twitter**で**フォロー**してください[**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**。**
* **ハッキングのトリックを共有するには、PRを** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **と** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **に提出してください。**

</details>

APKをここからダウンロードしてください：

APKを[https://appetize.io/](https://appetize.io)（無料アカウント）にアップロードして、APKの動作を確認します：

![](<../../.gitbook/assets/image (46).png>)

フラグを取得するには1000000回勝つ必要があるようです。

[Androidのペントテスト](./)の手順に従って、アプリケーションを逆コンパイルしてsmaliコードを取得し、jadxを使用してJavaコードを読み取ることができます。

Javaコードを読む：

![](<../../.gitbook/assets/image (47).png>)

フラグを表示する関数は**m()**のようです。

## **Smaliの変更**

### **最初の呼び出しでm()を呼び出す**

変数_this.o != 1000000_の場合にアプリケーションがm()を呼び出すようにします。条件を変更するだけです：
```
if-ne v0, v9, :cond_2
```
/hive/hacktricks/mobile-pentesting/android-app-pentesting/google-ctf-2018-shall-we-play-a-game.md

# Google CTF 2018 - Shall we play a game?

## Challenge Description

This challenge is about an Android application that simulates a game. The goal is to find a vulnerability in the app and exploit it to gain access to the flag.

## Initial Analysis

The first step is to decompile the APK file using a tool like JADX or apktool. Once decompiled, we can analyze the source code to identify potential vulnerabilities.

## Reverse Engineering

In the source code, we find a class called `MainActivity` that handles the main functionality of the app. By analyzing this class, we discover that the app communicates with a remote server using a custom protocol.

## Network Communication

To understand the communication protocol, we need to intercept the network traffic between the app and the server. We can use tools like Wireshark or Burp Suite to capture and analyze the traffic.

## Vulnerability Discovery

After analyzing the network traffic, we find that the app sends a request to the server with a parameter called `command`. By manipulating this parameter, we can trigger a command injection vulnerability.

## Exploitation

To exploit the command injection vulnerability, we can send a malicious command as the value of the `command` parameter. This command will be executed on the server, allowing us to gain control and access the flag.

## Conclusion

By analyzing the source code and intercepting the network traffic, we were able to discover and exploit a command injection vulnerability in the Android app. This allowed us to gain control of the server and access the flag.
```
if-eq v0, v9, :cond_2
```
![Before](<../../.gitbook/assets/image (48).png>)

![After](<../../.gitbook/assets/image (49).png>)

[Androidのペントテスト](./)の手順に従って、APKを再コンパイルして署名します。その後、[https://appetize.io/](https://appetize.io)にアップロードして、何が起こるか見てみましょう：

![](<../../.gitbook/assets/image (50).png>)

フラグが完全に復号化されずに書かれているようです。おそらくm()関数を1000000回呼び出す必要があります。

これを行う**別の方法**は、命令を変更せずに比較する命令を変更することです：

![](<../../.gitbook/assets/image (55).png>)

**別の方法**は、1000000ではなく1と比較するように値を設定することです。これにより、this.oが1と比較されます：

![](<../../.gitbook/assets/image (57).png>)

4番目の方法は、v9（1000000）の値をv0（this.o）に移動する命令を追加することです：

![](<../../.gitbook/assets/image (58).png>)

![](<../../.gitbook/assets/image (52).png>)

## 解決策

アプリケーションが最初に勝った場合に、ループを100000回実行するようにします。これを行うには、**：goto\_6**ループを作成し、アプリケーションが**\_this.o**の値が100000でない場合にそこに**ジャンプするようにします**：

![](<../../.gitbook/assets/image (59).png>)

これは物理デバイス内で行う必要があります（なぜかはわかりません）。

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks Cloud ☁️</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>🐦 Twitter 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 Youtube 🎥</strong></a></summary>

* **サイバーセキュリティ企業で働いていますか？ HackTricksで会社を宣伝したいですか？または、PEASSの最新バージョンにアクセスしたり、HackTricksをPDFでダウンロードしたりしたいですか？** [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見しましょう、私たちの独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクション
* [**公式のPEASS＆HackTricks swag**](https://peass.creator-spring.com)を手に入れましょう
* [**💬**](https://emojipedia.org/speech-balloon/) [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**Telegramグループ**](https://t.me/peass)に参加するか、**Twitter** [**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**をフォローしてください。**
* **ハッキングのトリックを共有するには、PRを** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **と** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **に提出してください。**

</details>
