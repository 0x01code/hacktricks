# Decompiladores de APK

<details>

<summary><strong>Aprenda hacking no AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ quer ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**material oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **Junte-se ao grupo** üí¨ [**Discord**](https://discord.gg/hRep4RUj7f) ou ao grupo [**telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios github do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## [JD-Gui](https://github.com/java-decompiler/jd-gui)

Primeiro decompilador Java famoso com interface gr√°fica, voc√™ pode us√°-lo para investigar o c√≥digo Java do APK uma vez que o tenha obtido.

## [Jadx](https://github.com/skylot/jadx)

Decompilador Java integrado (multiplataforma) e, no momento, acredito que seja o recomendado.\
Basta **baixar** a **√∫ltima** vers√£o e execut√°-la a partir da pasta _**bin**_:
```
jadx-gui
```
Utilizando a interface gr√°fica, voc√™ pode realizar **busca de texto**, ir para as **defini√ß√µes de fun√ß√µes** (_CTRL + clique esquerdo_ na fun√ß√£o) e refer√™ncias cruzadas (_clique direito_ --> _Find Usage_)

Se voc√™ **deseja apenas** o **c√≥digo java** mas sem usar uma interface gr√°fica, uma maneira muito f√°cil √© usar a ferramenta de linha de comando jadx:
```
jadx app.apk
```
Algumas **op√ß√µes interessantes do jadx** (vers√µes GUI e CLI) s√£o:
```
-d <path to output dir>
--no-res #No resources
--no-src #No source code
--no-imports #Always write entire package name (very useful to know where is the function that you might want to hook)
```
## [GDA-android-reversing-Tool](https://github.com/charles2gan/GDA-android-reversing-Tool)

GDA √© tamb√©m uma poderosa e r√°pida plataforma de an√°lise reversa. Que n√£o suporta apenas a opera√ß√£o b√°sica de descompila√ß√£o, mas tamb√©m muitas fun√ß√µes excelentes como **Detec√ß√£o de comportamento malicioso, Detec√ß√£o de vazamento de privacidade, Detec√ß√£o de vulnerabilidade, Resolu√ß√£o de caminho, Identifica√ß√£o de empacotador, An√°lise de rastreamento de vari√°veis, Desofusca√ß√£o, Scripts Python & Java, Extra√ß√£o de mem√≥ria do dispositivo, Decifra√ß√£o e cifra√ß√£o de dados** etc.

**Apenas para Windows.**

![](<../../.gitbook/assets/image (207) (1) (1).png>)

## [Bytecode-Viewer](https://github.com/Konloch/bytecode-viewer/releases)

Outra **ferramenta interessante para fazer uma an√°lise est√°tica √©**: [**bytecode-viewer**](https://github.com/Konloch/bytecode-viewer/releases)**.** Ela permite que voc√™ descompile o APK usando **v√°rios descompiladores ao mesmo tempo**. Ent√£o, voc√™ pode ver, por exemplo, 2 descompiladores Java diferentes e um descompilador Smali. Ela tamb√©m permite que voc√™ **modifique** o c√≥digo:

![](<../../.gitbook/assets/image (82).png>)

Se voc√™ modificar o c√≥digo, ent√£o voc√™ pode **export√°-lo**.\
Um ponto negativo do bytecode-viewer √© que ele **n√£o possui refer√™ncias** ou **refer√™ncias cruzadas.**

## [**Enjarify**](https://github.com/Storyyeller/enjarify)

Enjarify √© uma ferramenta para traduzir bytecode Dalvik para bytecode Java equivalente. Isso permite que ferramentas de an√°lise Java analisem aplica√ß√µes Android.\
Dex2jar √© uma ferramenta mais antiga que tamb√©m tenta traduzir Dalvik para bytecode Java. Funciona razoavelmente bem na maioria das vezes, mas muitos recursos obscuros ou casos extremos far√£o com que falhe ou at√© mesmo produza resultados incorretos silenciosamente. Em contraste, Enjarify √© projetado para funcionar em tantos casos quanto poss√≠vel, mesmo para c√≥digo onde Dex2jar falharia. Entre outras coisas, Enjarify lida corretamente com nomes de classes unicode, constantes usadas como v√°rios tipos, convers√µes impl√≠citas, manipuladores de exce√ß√£o saltando para o fluxo de controle normal, classes que referenciam muitas constantes, m√©todos muito longos, manipuladores de exce√ß√£o ap√≥s um manipulador catchall e valores iniciais est√°ticos do tipo errado.

## [CFR](https://github.com/leibnitz27/cfr)

CFR descompilar√° recursos modernos do Java - [incluindo muito do Java ](https://www.benf.org/other/cfr/java9observations.html)[9](https://github.com/leibnitz27/cfr/blob/master/java9stringconcat.html), [12](https://www.benf.org/other/cfr/switch\_expressions.html) & [14](https://www.benf.org/other/cfr/java14instanceof\_pattern), mas √© escrito inteiramente em Java 6, ent√£o funcionar√° em qualquer lugar! ([FAQ](https://www.benf.org/other/cfr/faq.html)) - Ele at√© far√° um esfor√ßo decente para transformar arquivos de classe de outras linguagens JVM de volta para java!

Esse arquivo JAR pode ser usado da seguinte forma:
```
java -jar ./cfr.jar "$JARFILE" --outputdir "$OUTDIR"
```
Para arquivos JAR maiores, notei que ele esgota a mem√≥ria. Voc√™ pode simplesmente adaptar o tamanho do pool de aloca√ß√£o de mem√≥ria da JVM se isso tamb√©m acontecer com voc√™.
```
java -Xmx4G -jar ./cfr.jar "$JARFILE" --outputdir "$OUTDIR"
```
Este exemplo permitir√° a aloca√ß√£o m√°xima de 4GB.

No diret√≥rio de sa√≠da, voc√™ encontrar√° os arquivos `.java` decompilados, juntamente com um resumo da decompila√ß√£o

## [Fernflower](https://github.com/JetBrains/intellij-community/tree/master/plugins/java-decompiler/engine)

A seguir temos o [Fernflower](https://github.com/JetBrains/intellij-community/tree/master/plugins/java-decompiler/engine), que faz parte do [IntelliJ IDEA](https://www.jetbrains.com/idea/). Todos mencionam que √© um decompilador _anal√≠tico_ (conforme declarado na descri√ß√£o do projeto), mas ningu√©m explica o que isso realmente significa. Eu s√≥ encontrei [esta pergunta no Stackoverflow](https://stackoverflow.com/q/62298929), que infelizmente permanece sem resposta at√© hoje.

De qualquer forma, como n√£o h√° lan√ßamentos aut√¥nomos, voc√™ precisa constru√≠-lo voc√™ mesmo. Sendo um projeto baseado em [Gradle](https://gradle.org), voc√™ pode clon√°-lo e depois executar o seguinte comando, desde que o Gradle esteja instalado em sua m√°quina.
```
cd ./plugins/java-decompiler/engine && gradle jar
```
Aqui, primeiro mudamos nosso diret√≥rio de trabalho para o diret√≥rio raiz do Fernflower. Em seguida, instru√≠mos o Gradle a construir o arquivo `./build/libs/fernflower.jar`.

A invoca√ß√£o do Fernflower √© semelhante √† do CFR.
```
java -jar ./fernflower.jar "$JARFILE" "$OUTDIR"
```
Entre os decompiladores descritos aqui, este √© o √∫nico que gera os arquivos `.java` em um arquivo JAR. Voc√™ pode facilmente extrair os arquivos de c√≥digo-fonte usando `unzip`.

## [Krakatau](https://github.com/Storyyeller/Krakatau)

Lembra do Enjarify mencionado acima? O mesmo autor tamb√©m √© o desenvolvedor de um decompilador chamado [Krakatau](https://github.com/Storyyeller/Krakatau).

Em contraste com os outros projetos, este √© escrito em Python. E eu acho que essa √© a raz√£o pela qual ele √© um pouco diferente dos outros.

Deixe-me citar do [README do projeto](https://github.com/Storyyeller/Krakatau/blob/master/README.md).

> Em seguida, certifique-se de que voc√™ tem jars contendo defini√ß√µes para quaisquer classes externas (ou seja, bibliotecas) que possam ser referenciadas pelo jar que voc√™ est√° tentando decompilar. Isso inclui as classes da biblioteca padr√£o (ou seja, JRT).

E de acordo com a descri√ß√£o, essas classes da biblioteca padr√£o v√™m com at√© a vers√£o 8 do Java na forma do arquivo `rt.jar`. Para vers√µes posteriores, o autor fornece [jrt-extractor](https://github.com/Storyyeller/jrt-extractor), que pode gerar esse arquivo para n√≥s.

Ent√£o, baixamos essa ferramenta e executamos os seguintes comandos.
```
cd ./jrt-extractor
javac JRTExtractor.java
java -ea JRTExtractor
```
Este comando deve ter criado um arquivo `rt.jar` dentro do diret√≥rio.

Com este arquivo, podemos executar o Krakatau da seguinte forma.
```
./Krakatau/decompile.py -out "$OUTDIR" -skip -nauto -path ./jrt-extractor/rt.jar "$JARFILE"
```
## [procyon](https://github.com/mstrobel/procyon)

Uma vez instalado, o uso √© simples.
```
procyon -jar "$JARFILE" -o "$OUTDIR"
```
## Refer√™ncias

{% embed url="https://eiken.dev/blog/2021/02/how-to-break-your-jar-in-2021-decompilation-guide-for-jars-and-apks/#cfr" %}

<details>

<summary><strong>Aprenda hacking no AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ quer ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**material oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **Junte-se ao grupo** üí¨ [**Discord**](https://discord.gg/hRep4RUj7f) ou ao grupo [**telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios github do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
