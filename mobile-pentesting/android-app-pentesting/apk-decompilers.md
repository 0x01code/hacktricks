# Decompiladores de APK

<details>

<summary><strong>Aprende hacking en AWS de cero a h√©roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF**, consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Consigue el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **sigue** a **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de GitHub** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## [JD-Gui](https://github.com/java-decompiler/jd-gui)

El primer decompilador Java con interfaz gr√°fica famoso, puedes usarlo para investigar el c√≥digo Java del APK una vez que lo hayas obtenido.

## [Jadx](https://github.com/skylot/jadx)

Decompilador Java integrado (multiplataforma) y en este momento creo que es el recomendado.\
Simplemente **descarga** la **√∫ltima** versi√≥n y ejec√∫tala desde la carpeta _**bin**_:
```
jadx-gui
```
Utilizando la interfaz gr√°fica puedes realizar **b√∫squeda de texto**, ir a las **definiciones de funciones** (_CTRL + clic izquierdo_ en la funci√≥n) y referencias cruzadas (_clic derecho_ --> _Buscar uso_)

Si **solo quieres** el **c√≥digo java** pero sin usar una interfaz gr√°fica, una manera muy f√°cil es usar la herramienta de l√≠nea de comandos jadx:
```
jadx app.apk
```
Algunas **opciones interesantes de jadx** (versiones GUI y CLI) son:
```
-d <path to output dir>
--no-res #No resources
--no-src #No source code
--no-imports #Always write entire package name (very useful to know where is the function that you might want to hook)
```
## [GDA-android-reversing-Tool](https://github.com/charles2gan/GDA-android-reversing-Tool)

GDA es tambi√©n una plataforma de an√°lisis de ingenier√≠a inversa potente y r√°pida. Que no solo soporta las operaciones b√°sicas de decompilaci√≥n, sino tambi√©n muchas funciones excelentes como **Detecci√≥n de comportamiento malicioso, Detecci√≥n de fuga de privacidad, Detecci√≥n de vulnerabilidades, Resoluci√≥n de caminos, Identificaci√≥n de empaquetadores, An√°lisis de seguimiento de variables, Desofuscaci√≥n, Scripts de Python y Java, Extracci√≥n de memoria del dispositivo, Descifrado y cifrado de datos**, etc.

**Solo para Windows.**

![](<../../.gitbook/assets/image (207) (1) (1).png>)

## [Bytecode-Viewer](https://github.com/Konloch/bytecode-viewer/releases)

Otra **herramienta interesante para realizar un an√°lisis est√°tico es**: [**bytecode-viewer**](https://github.com/Konloch/bytecode-viewer/releases)**.** Permite decompilar el APK usando **varios decompiladores al mismo tiempo**. Entonces, puedes ver, por ejemplo, 2 decompiladores de Java diferentes y un decompilador Smali. Tambi√©n te permite **modificar** el c√≥digo:

![](<../../.gitbook/assets/image (82).png>)

Si modificas el c√≥digo, entonces puedes **exportarlo**.\
Una desventaja de bytecode-viewer es que no tiene **referencias** ni **referencias cruzadas**.

## [**Enjarify**](https://github.com/Storyyeller/enjarify)

Enjarify es una herramienta para traducir el bytecode de Dalvik a bytecode de Java equivalente. Esto permite que las herramientas de an√°lisis de Java analicen aplicaciones Android.\
Dex2jar es una herramienta m√°s antigua que tambi√©n intenta traducir Dalvik a bytecode de Java. Funciona razonablemente bien la mayor√≠a del tiempo, pero muchas caracter√≠sticas oscuras o casos l√≠mite har√°n que falle o incluso produzca resultados incorrectos silenciosamente. En contraste, Enjarify est√° dise√±ado para funcionar en tantos casos como sea posible, incluso para c√≥digo donde Dex2jar fallar√≠a. Entre otras cosas, Enjarify maneja correctamente nombres de clases unicode, constantes usadas como m√∫ltiples tipos, conversiones impl√≠citas, manejadores de excepciones que saltan al flujo de control normal, clases que hacen referencia a demasiadas constantes, m√©todos muy largos, manejadores de excepciones despu√©s de un manejador catchall y valores iniciales est√°ticos del tipo incorrecto.

## [CFR](https://github.com/leibnitz27/cfr)

CFR decompilar√° caracter√≠sticas modernas de Java - [incluyendo mucho de Java ](https://www.benf.org/other/cfr/java9observations.html)[9](https://github.com/leibnitz27/cfr/blob/master/java9stringconcat.html), [12](https://www.benf.org/other/cfr/switch_expressions.html) & [14](https://www.benf.org/other/cfr/java14instanceof_pattern), pero est√° escrito enteramente en Java 6, ¬°as√≠ que funcionar√° en cualquier lugar! ([FAQ](https://www.benf.org/other/cfr/faq.html)) - ¬°Incluso har√° un buen intento de convertir archivos de clase de otros lenguajes JVM de nuevo a java!

Ese archivo JAR se puede usar de la siguiente manera:
```
java -jar ./cfr.jar "$JARFILE" --outputdir "$OUTDIR"
```
Para archivos JAR m√°s grandes, descubr√≠ que se quedaba sin memoria. Puedes adaptar simplemente el tama√±o del pool de asignaci√≥n de memoria de la JVM si eso tambi√©n te sucede.
```
java -Xmx4G -jar ./cfr.jar "$JARFILE" --outputdir "$OUTDIR"
```
Este ejemplo permitir√° asignar un m√°ximo de 4GB.

En el directorio de salida, encontrar√°s los archivos `.java` descompilados, junto con un resumen de la descompilaci√≥n.

## [Fernflower](https://github.com/JetBrains/intellij-community/tree/master/plugins/java-decompiler/engine)

El siguiente es [Fernflower](https://github.com/JetBrains/intellij-community/tree/master/plugins/java-decompiler/engine), que forma parte de [IntelliJ IDEA](https://www.jetbrains.com/idea/). Todos mencionan que es un descompilador _anal√≠tico_ (como se indica en la descripci√≥n de su proyecto), pero nadie se√±ala qu√© significa esto realmente. Solo encontr√© [esta pregunta en Stackoverflow](https://stackoverflow.com/q/62298929), que lamentablemente sigue sin respuesta hasta el d√≠a de hoy.

De todos modos, dado que no hay versiones independientes, necesitas construirlo t√∫ mismo. Como proyecto basado en [Gradle](https://gradle.org), puedes clonarlo y luego ejecutar el siguiente comando, siempre que Gradle est√© instalado en tu m√°quina.
```
cd ./plugins/java-decompiler/engine && gradle jar
```
Aqu√≠, primero cambiamos nuestro directorio de trabajo al directorio ra√≠z de Fernflower. Luego, instruimos a Gradle para construir el archivo `./build/libs/fernflower.jar`.

La invocaci√≥n de Fernflower es similar a la de CFR.
```
java -jar ./fernflower.jar "$JARFILE" "$OUTDIR"
```
Entre los decompiladores descritos aqu√≠, este es el √∫nico que genera los archivos `.java` en un archivo JAR. Puedes extraer f√°cilmente los archivos fuente utilizando `unzip`.

## [Krakatau](https://github.com/Storyyeller/Krakatau)

¬øRecuerdas Enjarify de arriba? El mismo autor tambi√©n es el desarrollador de un decompilador llamado [Krakatau](https://github.com/Storyyeller/Krakatau).

A diferencia de los otros proyectos, este est√° escrito en Python. Y creo que esta es la raz√≥n por la cual es un poco diferente de los dem√°s.

Perm√≠teme citar del [README del proyecto](https://github.com/Storyyeller/Krakatau/blob/master/README.md).

> A continuaci√≥n, aseg√∫rate de tener jars que contengan definiciones para cualquier clase externa (es decir, librer√≠as) que pueda ser referenciada por el jar que est√°s intentando decompilar. Esto incluye las clases de la biblioteca est√°ndar (es decir, JRT).

Y seg√∫n la descripci√≥n, estas clases de la biblioteca est√°ndar vienen con hasta la versi√≥n 8 de Java en forma del archivo `rt.jar`. Para versiones posteriores, el autor proporciona [jrt-extractor](https://github.com/Storyyeller/jrt-extractor), que puede generar este archivo para nosotros.

As√≠ que descargamos esa herramienta y ejecutamos los siguientes comandos.
```
cd ./jrt-extractor
javac JRTExtractor.java
java -ea JRTExtractor
```
Este deber√≠a haber escrito un archivo `rt.jar` dentro del directorio.

Dado este archivo, podemos ejecutar Krakatau de la siguiente manera.
```
./Krakatau/decompile.py -out "$OUTDIR" -skip -nauto -path ./jrt-extractor/rt.jar "$JARFILE"
```
## [procyon](https://github.com/mstrobel/procyon)

Una vez instalado, el uso es sencillo.
```
procyon -jar "$JARFILE" -o "$OUTDIR"
```
## Referencias

{% embed url="https://eiken.dev/blog/2021/02/how-to-break-your-jar-in-2021-decompilation-guide-for-jars-and-apks/#cfr" %}

<details>

<summary><strong>Aprende hacking en AWS de cero a h√©roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver a tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Consigue el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **sigue** a **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de github** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
