# APKデコンパイラ

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks Cloud ☁️</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>🐦 Twitter 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 Youtube 🎥</strong></a></summary>

* **サイバーセキュリティ会社**で働いていますか？ **HackTricksで会社を宣伝**したいですか？または、**PEASSの最新バージョンにアクセスしたり、HackTricksをPDFでダウンロード**したいですか？[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を見つけてください。独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクションです。
* [**公式のPEASS＆HackTricksのグッズ**](https://peass.creator-spring.com)を手に入れましょう。
* [**💬**](https://emojipedia.org/speech-balloon/) [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**telegramグループ**](https://t.me/peass)に**参加**するか、**Twitter**で**フォロー**してください[**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**。**
* **ハッキングのトリックを共有するには、PRを** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **と** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **に提出してください。**

</details>

## [JD-Gui](https://github.com/java-decompiler/jd-gui)

最初の有名なGUI Javaデコンパイラで、APKから取得したJavaコードを調査するために使用できます。

## [Jadx](https://github.com/skylot/jadx)

ビルドインJava（マルチプラットフォーム）で、現時点ではおそらく推奨されているものです。\
単に**最新バージョンをダウンロード**して、_**bin**_フォルダから実行します。
```
jadx-gui
```
GUIを使用すると、**テキスト検索**を実行したり、**関数の定義**（関数をクリックしてCTRL +左クリック）やクロスリファレンス（右クリック→使用箇所を検索）に移動したりできます。

GUIを使用せずに**Javaコードのみ**を取得したい場合、jadxのCLIツールを使用するのが非常に簡単です。
```
jadx app.apk
```
次に、jadxの興味深いオプション（GUIおよびCLIバージョン）があります。
```
-d <path to output dir>
--no-res #No resources
--no-src #No source code
--no-imports #Always write entire package name (very useful to know where is the function that you might want to hook)
```
## [GDA-android-reversing-Tool](https://github.com/charles2gan/GDA-android-reversing-Tool)

GDAは強力で高速な逆解析プラットフォームです。基本的な逆コンパイル操作だけでなく、**悪意のある動作の検出、プライバシーの漏洩検出、脆弱性の検出、パスの解決、パッカーの識別、変数のトラッキング分析、難読化、Python＆Javaスクリプト、デバイスメモリの抽出、データの復号化と暗号化**など、多くの優れた機能をサポートしています。

**Windowsのみ対応。**

![](<../../.gitbook/assets/image (207) (1) (1).png>)

## [Bytecode-Viewer](https://github.com/Konloch/bytecode-viewer/releases)

もう1つの**興味深い静的解析ツール**は、[**bytecode-viewer**](https://github.com/Konloch/bytecode-viewer/releases)**です。**これにより、**複数の逆コンパイラを同時に使用してAPKを逆コンパイル**することができます。例えば、2つの異なるJava逆コンパイラと1つのSmali逆コンパイラを使用できます。また、コードを**変更する**こともできます。

![](<../../.gitbook/assets/image (82).png>)

コードを変更した場合、それを**エクスポート**することができます。\
bytecode-viewerの欠点は、**参照や相互参照がない**ことです。

## [**Enjarify**](https://github.com/Storyyeller/enjarify)

Enjarifyは、Dalvikバイトコードを等価のJavaバイトコードに変換するツールです。これにより、Javaの解析ツールでAndroidアプリケーションを分析することができます。\
Dex2jarは、DalvikからJavaバイトコードに変換しようとする古いツールです。ほとんどの場合、うまく動作しますが、一部のマイナーな機能や特殊なケースでは失敗したり、間違った結果を生成したりすることがあります。それに対して、Enjarifyはできるだけ多くのケースで動作するように設計されており、Dex2jarでは失敗するコードでも正しく処理します。Enjarifyは、ユニコードのクラス名、複数の型として使用される定数、暗黙のキャスト、例外ハンドラが通常の制御フローにジャンプすること、定数を参照しすぎるクラス、非常に長いメソッド、キャッチオールハンドラの後の例外ハンドラ、間違った型の静的初期値など、さまざまなケースを正しく処理します。

## [CFR](https://github.com/leibnitz27/cfr)

CFRは、モダンなJavaの機能を逆コンパイルします - [Java ](https://www.benf.org/other/cfr/java9observations.html)[9](https://github.com/leibnitz27/cfr/blob/master/java9stringconcat.html)、[12](https://www.benf.org/other/cfr/switch\_expressions.html)、[14](https://www.benf.org/other/cfr/java14instanceof\_pattern)を含む - ただし、Java 6で完全に書かれているため、どこでも動作します！ ([FAQ](https://www.benf.org/other/cfr/faq.html)) - 他のJVM言語のクラスファイルをJavaに戻すのにもうまく対応します！

そのJARファイルは次のように使用できます：
```
java -jar ./cfr.jar "$JARFILE" --outputdir "$OUTDIR"
```
大きなJARファイルでは、メモリが不足することがあります。もし同じ問題が発生した場合は、JVMのメモリ割り当てプールのサイズを調整することができます。
```
java -Xmx4G -jar ./cfr.jar "$JARFILE" --outputdir "$OUTDIR"
```
この例では、最大4GBが割り当てられます。

出力ディレクトリには、デコンパイルされた`.java`ファイルと、デコンパイルの概要が含まれています。

## [Fernflower](https://github.com/JetBrains/intellij-community/tree/master/plugins/java-decompiler/engine)

次は[Fernflower](https://github.com/JetBrains/intellij-community/tree/master/plugins/java-decompiler/engine)です。これは[IntelliJ IDEA](https://www.jetbrains.com/idea/)の一部です。みんなが言うように、これは「解析的な」デコンパイラです（彼らのプロジェクトの説明に記載されています）、しかし、実際にはこれがどういう意味なのかは誰も指摘していません。私はただ[このStackoverflowの質問](https://stackoverflow.com/q/62298929)を見つけましたが、残念ながら今日まで回答はありません。

とにかく、自己完結型のリリースがないため、自分でビルドする必要があります。[Gradle](https://gradle.org)ベースのプロジェクトとして、クローンして、Gradleがマシンにインストールされている場合は次のコマンドを実行します。
```
cd ./plugins/java-decompiler/engine && gradle jar
```
以下では、まず作業ディレクトリをFernflowerのルートディレクトリに切り替えます。次に、Gradleに`./build/libs/fernflower.jar`ファイルをビルドするよう指示します。

Fernflowerの呼び出しはCFRと似ています。
```
java -jar ./fernflower.jar "$JARFILE" "$OUTDIR"
```
以下のデコンパイラの中で、これは生成された`.java`ファイルをJARファイルで出力する唯一のものです。`unzip`を使用して簡単にソースファイルを抽出できます。

## [Krakatau](https://github.com/Storyyeller/Krakatau)

前述のEnjarifyを覚えていますか？同じ作者が開発したデコンパイラの[Krakatau](https://github.com/Storyyeller/Krakatau)です。

他のプロジェクトとは異なり、これはPythonで書かれています。そして、これが他と少し異なる理由だと思います。

プロジェクトの[README](https://github.com/Storyyeller/Krakatau/blob/master/README.md)から引用します。

> 次に、デコンパイルしようとしているJARが参照する外部クラス（つまりライブラリ）の定義を含むJARがあることを確認してください。これには標準ライブラリクラス（つまりJRT）も含まれます。

そして、説明によると、これらの標準ライブラリクラスはJavaのバージョン8まで`rt.jar`というファイルの形式で提供されています。後のバージョンでは、作者は[jrt-extractor](https://github.com/Storyyeller/jrt-extractor)を提供しており、これを使用してこのファイルを生成できます。

そのため、このツールをダウンロードし、以下のコマンドを実行します。
```
cd ./jrt-extractor
javac JRTExtractor.java
java -ea JRTExtractor
```
このディレクトリ内には、`rt.jar`というファイルが書き込まれているはずです。

このファイルがあれば、Krakatauを以下のように実行できます。
```
./Krakatau/decompile.py -out "$OUTDIR" -skip -nauto -path ./jrt-extractor/rt.jar "$JARFILE"
```
プロジェクトのGitHubを参照して、パラメータの説明を確認してください。ただし、JARファイルで使用されるライブラリについては、Krakatauは`-path`フラグにJARファイルとして追加する必要があります。

## [procyon](https://github.com/mstrobel/procyon)

インストール後、使用方法は簡単です。
```
procyon -jar "$JARFILE" -o "$OUTDIR"
```
## 参考文献

{% embed url="https://eiken.dev/blog/2021/02/how-to-break-your-jar-in-2021-decompilation-guide-for-jars-and-apks/#cfr" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks Cloud ☁️</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>🐦 Twitter 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 Youtube 🎥</strong></a></summary>

* **サイバーセキュリティ企業で働いていますか？** **HackTricksで会社を宣伝**したいですか？または、**PEASSの最新バージョンにアクセスしたり、HackTricksをPDFでダウンロード**したいですか？[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見しましょう。独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクションです。
* [**公式のPEASS＆HackTricksのグッズ**](https://peass.creator-spring.com)を手に入れましょう。
* [**💬**](https://emojipedia.org/speech-balloon/) [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**telegramグループ**](https://t.me/peass)に**参加**するか、**Twitter**で**フォロー**してください[**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**。**
* **ハッキングのトリックを共有するには、PRを** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **と** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **に提出してください。**

</details>
