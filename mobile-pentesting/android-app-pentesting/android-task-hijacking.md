# Android Task Hijacking

<details>

<summary><strong>Impara l'hacking di AWS da zero a eroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se vuoi vedere la tua **azienda pubblicizzata su HackTricks** o **scaricare HackTricks in PDF** Controlla i [**PACCHETTI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale di PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**The PEASS Family**](https://opensea.io/collection/the-peass-family), la nostra collezione di [**NFT**](https://opensea.io/collection/the-peass-family) esclusivi
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo Telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR ai repository GitHub di** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

<figure><img src="/.gitbook/assets/image (675).png" alt=""><figcaption></figcaption></figure>

Trova le vulnerabilit√† che contano di pi√π in modo da poterle correggere pi√π velocemente. Intruder traccia la tua superficie di attacco, esegue scansioni proattive delle minacce, trova problemi in tutta la tua infrastruttura tecnologica, dalle API alle applicazioni web e ai sistemi cloud. [**Provalo gratuitamente**](https://www.intruder.io/?utm\_source=referral\&utm\_campaign=hacktricks) oggi stesso.

{% embed url="https://www.intruder.io/?utm_campaign=hacktricks&utm_source=referral" %}

***

## Task, Back Stack e Foreground Activities

In Android, un **task** √® essenzialmente un insieme di attivit√† con cui gli utenti interagiscono per completare un lavoro specifico, organizzato all'interno di uno **stack di retroazione**. Questo stack ordina le attivit√† in base al momento in cui sono state aperte, con l'attivit√† pi√π recente visualizzata in cima come **attivit√† in primo piano**. In ogni momento, solo questa attivit√† √® visibile sullo schermo, facendola parte del **task in primo piano**.

Ecco una rapida panoramica delle transizioni delle attivit√†:

- **Attivit√† 1** inizia come l'unica attivit√† in primo piano.
- Il lancio di **Attivit√† 2** spinge **Attivit√† 1** nello stack di retroazione, portando **Attivit√† 2** in primo piano.
- L'avvio di **Attivit√† 3** sposta **Attivit√† 1** e **Attivit√† 2** pi√π indietro nello stack, con **Attivit√† 3** ora in primo piano.
- La chiusura di **Attivit√† 3** riporta **Attivit√† 2** in primo piano, mostrando il meccanismo di navigazione dei task semplificato di Android.

![https://developer.android.com/images/fundamentals/diagram_backstack.png](<../../.gitbook/assets/image (548).png>)

## Attacco di affinit√† del task

### Panoramica di Affinit√† del Task e Modalit√† di Avvio

Nelle applicazioni Android, **l'affinit√† del task** specifica il task preferito di un'attivit√†, generalmente allineato con il nome del pacchetto dell'app. Questa configurazione √® fondamentale per creare un'app di prova concettuale (PoC) per dimostrare l'attacco.

### Modalit√† di Avvio

L'attributo `launchMode` indica la gestione delle istanze delle attivit√† all'interno dei task. La modalit√† **singleTask** √® fondamentale per questo attacco, che stabilisce tre scenari in base alle istanze delle attivit√† esistenti e alle corrispondenze di affinit√† del task. L'exploit si basa sulla capacit√† dell'app di un attaccante di imitare l'affinit√† del task dell'app target, ingannando il sistema Android nel lanciare l'app dell'attaccante invece dell'app target prevista.

### Dettagli dei Passaggi dell'Attacco

1. **Installazione dell'app malevola**: La vittima installa l'app dell'attaccante sul proprio dispositivo.
2. **Attivazione iniziale**: La vittima apre per la prima volta l'app malevola, preparando il dispositivo per l'attacco.
3. **Tentativo di avvio dell'app target**: La vittima cerca di aprire l'app target.
4. **Esecuzione di dirottamento**: A causa dell'affinit√† del task corrispondente, l'app malevola viene avviata al posto dell'app target.
5. **Inganno**: L'app malevola presenta una schermata di accesso falsa simile all'app target, ingannando l'utente affinch√© inserisca informazioni sensibili.

Per un'implementazione pratica di questo attacco, fare riferimento al repository Task Hijacking Strandhogg su GitHub: [Task Hijacking Strandhogg](https://github.com/az0mb13/Task_Hijacking_Strandhogg).

### Misure di Prevenzione

Per prevenire tali attacchi, gli sviluppatori possono impostare `taskAffinity` su una stringa vuota e optare per la modalit√† di avvio `singleInstance`, garantendo l'isolamento della propria app dalle altre. Personalizzare la funzione `onBackPressed()` offre una protezione aggiuntiva contro il dirottamento del task.

## **Riferimenti**

* [**https://blog.dixitaditya.com/android-task-hijacking/**](https://blog.dixitaditya.com/android-task-hijacking/)
* [**https://blog.takemyhand.xyz/2021/02/android-task-hijacking-with.html**](https://blog.takemyhand.xyz/2021/02/android-task-hijacking-with.html)

<figure><img src="/.gitbook/assets/image (675).png" alt=""><figcaption></figcaption></figure>

Trova le vulnerabilit√† che contano di pi√π in modo da poterle correggere pi√π velocemente. Intruder traccia la tua superficie di attacco, esegue scansioni proattive delle minacce, trova problemi in tutta la tua infrastruttura tecnologica, dalle API alle applicazioni web e ai sistemi cloud. [**Provalo gratuitamente**](https://www.intruder.io/?utm\_source=referral\&utm\_campaign=hacktricks) oggi stesso.

{% embed url="https://www.intruder.io/?utm_campaign=hacktricks&utm_source=referral" %}

<details>

<summary><strong>Impara l'hacking di AWS da zero a eroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se vuoi vedere la tua **azienda pubblicizzata su HackTricks** o **scaricare HackTricks in PDF** Controlla i [**PACCHETTI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale di PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**The PEASS Family**](https://opensea.io/collection/the-peass-family), la nostra collezione di [**NFT**](https://opensea.io/collection/the-peass-family) esclusivi
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo Telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR ai repository GitHub di** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
