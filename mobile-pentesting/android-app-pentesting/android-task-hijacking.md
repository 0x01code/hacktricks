# Android Task Hijacking

<details>

<summary><strong>Impara l'hacking AWS da zero a eroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Esperto Red Team AWS di HackTricks)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se vuoi vedere la tua **azienda pubblicizzata su HackTricks** o **scaricare HackTricks in PDF** Controlla i [**PIANI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale di PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**La Famiglia PEASS**](https://opensea.io/collection/the-peass-family), la nostra collezione di [**NFT**](https://opensea.io/collection/the-peass-family) esclusivi
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR ai** [**HackTricks**](https://github.com/carlospolop/hacktricks) e ai [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repository di GitHub.

</details>

**Try Hard Security Group**

<figure><img src="../../.gitbook/assets/telegram-cloud-document-1-5159108904864449420.jpg" alt=""><figcaption></figcaption></figure>

{% embed url="https://discord.gg/tryhardsecurity" %}

***

## Attacco di dirottamento dell'attivit√†, dello stack posteriore e delle attivit√† in primo piano

In Android, un **task** √® essenzialmente un insieme di attivit√† con cui gli utenti interagiscono per completare un lavoro specifico, organizzato all'interno di uno **stack posteriore**. Questo stack ordina le attivit√† in base a quando sono state aperte, con l'attivit√† pi√π recente visualizzata in alto come **attivit√† in primo piano**. In ogni momento, solo questa attivit√† √® visibile sullo schermo, facendola parte del **task in primo piano**.

Ecco una rapida panoramica delle transizioni delle attivit√†:

* **Attivit√† 1** inizia come unica attivit√† in primo piano.
* Il lancio di **Attivit√† 2** spinge **Attivit√† 1** nello stack posteriore, portando **Attivit√† 2** in primo piano.
* Avviare **Attivit√† 3** sposta **Attivit√† 1** e **Attivit√† 2** ulteriormente nello stack, con **Attivit√† 3** ora davanti.
* Chiudere **Attivit√† 3** riporta **Attivit√† 2** in primo piano, mostrando il meccanismo di navigazione dei task semplificato di Android.

![https://developer.android.com/images/fundamentals/diagram\_backstack.png](<../../.gitbook/assets/image (698).png>)

## Attacco di affinit√† del task

### Panoramica dell'affinit√† del task e delle modalit√† di lancio

Nelle applicazioni Android, l'**affinit√† del task** specifica il task preferito di un'attivit√†, allineandosi tipicamente con il nome del pacchetto dell'app. Questa configurazione √® fondamentale per creare un'app di prova (PoC) per dimostrare l'attacco.

### Modalit√† di lancio

L'attributo `launchMode` dirige la gestione delle istanze di attivit√† all'interno dei task. La modalit√† **singleTask** √® fondamentale per questo attacco, che detta tre scenari in base alle istanze di attivit√† esistenti e alle corrispondenze di affinit√† del task. L'exploit si basa sulla capacit√† dell'app di un attaccante di imitare l'affinit√† del task dell'app target, inducendo il sistema Android a lanciare l'app dell'attaccante invece dell'app target previsto.

### Passaggi dettagliati dell'attacco

1. **Installazione dell'app malevola**: La vittima installa l'app dell'attaccante sul proprio dispositivo.
2. **Attivazione iniziale**: La vittima apre prima l'app malevola, preparando il dispositivo per l'attacco.
3. **Tentativo di lancio dell'app target**: La vittima tenta di aprire l'app target.
4. **Esecuzione del dirottamento**: A causa dell'affinit√† del task corrispondente, l'app malevola viene lanciata al posto dell'app target.
5. **Inganno**: L'app malevola presenta una schermata di accesso falsa simile all'app target, inducendo l'utente a inserire informazioni sensibili.

Per un'implementazione pratica di questo attacco, fare riferimento al repository Task Hijacking Strandhogg su GitHub: [Task Hijacking Strandhogg](https://github.com/az0mb13/Task\_Hijacking\_Strandhogg).

### Misure di prevenzione

Per prevenire tali attacchi, gli sviluppatori possono impostare `taskAffinity` su una stringa vuota e optare per la modalit√† di lancio `singleInstance`, garantendo l'isolamento della propria app dalle altre. Personalizzare la funzione `onBackPressed()` offre una protezione aggiuntiva contro il dirottamento del task.

## **Riferimenti**

* [**https://blog.dixitaditya.com/android-task-hijacking/**](https://blog.dixitaditya.com/android-task-hijacking/)
* [**https://blog.takemyhand.xyz/2021/02/android-task-hijacking-with.html**](https://blog.takemyhand.xyz/2021/02/android-task-hijacking-with.html)

**Try Hard Security Group**

<figure><img src="../../.gitbook/assets/telegram-cloud-document-1-5159108904864449420.jpg" alt=""><figcaption></figcaption></figure>

{% embed url="https://discord.gg/tryhardsecurity" %}

<details>

<summary><strong>Impara l'hacking AWS da zero a eroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Esperto Red Team AWS di HackTricks)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se vuoi vedere la tua **azienda pubblicizzata su HackTricks** o **scaricare HackTricks in PDF** Controlla i [**PIANI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale di PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**La Famiglia PEASS**](https://opensea.io/collection/the-peass-family), la nostra collezione di [**NFT**](https://opensea.io/collection/the-peass-family) esclusivi
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR ai** [**HackTricks**](https://github.com/carlospolop/hacktricks) e ai [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repository di GitHub.

</details>
