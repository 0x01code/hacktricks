# Android Task Hijacking

<details>

<summary><strong>Lernen Sie AWS-Hacking von Null auf Held mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks beworben sehen m√∂chten** oder **HackTricks im PDF-Format herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merchandise**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositories einreichen.

</details>

## Task, Back Stack und Vordergrundaktivit√§ten

In Android ist eine **Task** im Wesentlichen eine Reihe von Aktivit√§ten, mit denen Benutzer interagieren, um einen bestimmten Job abzuschlie√üen, die in einem **Back Stack** organisiert sind. Dieser Stapel ordnet Aktivit√§ten basierend darauf, wann sie ge√∂ffnet wurden, wobei die zuletzt ge√∂ffnete Aktivit√§t als **Vordergrundaktivit√§t** oben angezeigt wird. Zu jedem Zeitpunkt ist nur diese Aktivit√§t auf dem Bildschirm sichtbar und geh√∂rt somit zur **Vordergrundaufgabe**.

Hier ist eine kurze √úbersicht √ºber Aktivit√§ts√ºberg√§nge:

* **Aktivit√§t 1** startet als einzige Aktivit√§t im Vordergrund.
* Das Starten von **Aktivit√§t 2** schiebt **Aktivit√§t 1** in den Back Stack und bringt **Aktivit√§t 2** in den Vordergrund.
* Das Starten von **Aktivit√§t 3** verschiebt **Aktivit√§t 1** und **Aktivit√§t 2** weiter nach hinten im Stapel, wobei **Aktivit√§t 3** jetzt vorne steht.
* Das Schlie√üen von **Aktivit√§t 3** bringt **Aktivit√§t 2** wieder in den Vordergrund und zeigt den schlanken Navigationsmechanismus von Android.

![https://developer.android.com/images/fundamentals/diagram\_backstack.png](<../../.gitbook/assets/image (548).png>)

## Task-Affinit√§tsangriff

### √úberblick √ºber Task-Affinit√§t und Startmodi

In Android-Anwendungen gibt die **Task-Affinit√§t** die bevorzugte Task einer Aktivit√§t an, die in der Regel mit dem Paketnamen der App √ºbereinstimmt. Diese Einrichtung ist entscheidend f√ºr die Erstellung einer Proof-of-Concept (PoC)-App zur Demonstration des Angriffs.

### Startmodi

Das Attribut `launchMode` steuert die Behandlung von Aktivit√§tsinstanzen innerhalb von Tasks. Der **singleTask**-Modus ist f√ºr diesen Angriff entscheidend und bestimmt drei Szenarien basierend auf den vorhandenen Aktivit√§tsinstanzen und Task-Affinit√§ts√ºbereinstimmungen. Der Exploit h√§ngt von der F√§higkeit einer Angreifer-App ab, die Task-Affinit√§t der Ziel-App nachzuahmen und das Android-System dazu zu bringen, die App des Angreifers anstelle der beabsichtigten Ziel-App zu starten.

### Detaillierte Angriffsschritte

1. **Installation der b√∂sartigen App**: Das Opfer installiert die App des Angreifers auf seinem Ger√§t.
2. **Erstaktivierung**: Das Opfer √∂ffnet zun√§chst die b√∂sartige App und bereitet das Ger√§t f√ºr den Angriff vor.
3. **Startversuch der Ziel-App**: Das Opfer versucht, die Ziel-App zu √∂ffnen.
4. **Hijack-Ausf√ºhrung**: Aufgrund der √ºbereinstimmenden Task-Affinit√§t wird die b√∂sartige App anstelle der Ziel-App gestartet.
5. **T√§uschung**: Die b√∂sartige App zeigt einen gef√§lschten Anmeldebildschirm, der der Ziel-App √§hnelt, und t√§uscht den Benutzer dazu, sensible Informationen einzugeben.

F√ºr eine praktische Umsetzung dieses Angriffs verweisen Sie auf das Task Hijacking Strandhogg-Repository auf GitHub: [Task Hijacking Strandhogg](https://github.com/az0mb13/Task\_Hijacking\_Strandhogg).

### Pr√§ventivma√ünahmen

Um solche Angriffe zu verhindern, k√∂nnen Entwickler `taskAffinity` auf einen leeren String setzen und den `singleInstance`-Startmodus w√§hlen, um sicherzustellen, dass ihre App von anderen isoliert ist. Die Anpassung der `onBackPressed()`-Funktion bietet zus√§tzlichen Schutz gegen Task-Hijacking.

## **Referenzen**

* [**https://blog.dixitaditya.com/android-task-hijacking/**](https://blog.dixitaditya.com/android-task-hijacking/)
* [**https://blog.takemyhand.xyz/2021/02/android-task-hijacking-with.html**](https://blog.takemyhand.xyz/2021/02/android-task-hijacking-with.html)

<details>

<summary><strong>Lernen Sie AWS-Hacking von Null auf Held mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks beworben sehen m√∂chten** oder **HackTricks im PDF-Format herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merchandise**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositories einreichen.

</details>
