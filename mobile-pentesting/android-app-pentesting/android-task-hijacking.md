# Android Task Hijacking

<details>

<summary><strong>Lernen Sie AWS-Hacking von Grund auf mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks bewerben m√∂chten** oder **HackTricks als PDF herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merchandise**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositories senden.

</details>

<figure><img src="/.gitbook/assets/image (675).png" alt=""><figcaption></figcaption></figure>

Finden Sie die wichtigsten Schwachstellen, damit Sie sie schneller beheben k√∂nnen. Intruder verfolgt Ihre Angriffsfl√§che, f√ºhrt proaktive Bedrohungsscans durch und findet Probleme in Ihrer gesamten Technologie-Stack, von APIs √ºber Webanwendungen bis hin zu Cloud-Systemen. [**Probieren Sie es noch heute kostenlos aus**](https://www.intruder.io/?utm\_source=referral\&utm\_campaign=hacktricks).

{% embed url="https://www.intruder.io/?utm_campaign=hacktricks&utm_source=referral" %}

***

## Aufgabe, Back Stack und Vordergrundaktivit√§ten

In Android ist eine **Aufgabe** im Wesentlichen eine Reihe von Aktivit√§ten, mit denen Benutzer interagieren, um eine bestimmte Aufgabe abzuschlie√üen, die in einem **Back Stack** organisiert ist. Dieser Stapel ordnet Aktivit√§ten basierend auf dem Zeitpunkt, zu dem sie ge√∂ffnet wurden, an, wobei die zuletzt ge√∂ffnete Aktivit√§t oben als **Vordergrundaktivit√§t** angezeigt wird. Zu jedem Zeitpunkt ist nur diese Aktivit√§t auf dem Bildschirm sichtbar und geh√∂rt zur **Vordergrundaufgabe**.

Hier ist eine kurze √úbersicht √ºber Aktivit√§ts√ºberg√§nge:

- **Aktivit√§t 1** startet als einzige Aktivit√§t im Vordergrund.
- Das Starten von **Aktivit√§t 2** schiebt **Aktivit√§t 1** in den Back Stack und bringt **Aktivit√§t 2** in den Vordergrund.
- Das Starten von **Aktivit√§t 3** verschiebt **Aktivit√§t 1** und **Aktivit√§t 2** weiter nach hinten im Stapel, wobei **Aktivit√§t 3** jetzt vorne steht.
- Das Schlie√üen von **Aktivit√§t 3** bringt **Aktivit√§t 2** wieder in den Vordergrund und zeigt den optimierten Aufgaben-Navigationsmechanismus von Android.

![https://developer.android.com/images/fundamentals/diagram_backstack.png](<../../.gitbook/assets/image (548).png>)

## Task-Affinit√§tsangriff

### √úberblick √ºber Task-Affinit√§t und Startmodi

In Android-Anwendungen gibt die **Task-Affinit√§t** die bevorzugte Aufgabe einer Aktivit√§t an, die in der Regel mit dem Paketnamen der App √ºbereinstimmt. Diese Einrichtung ist entscheidend f√ºr die Erstellung einer Proof-of-Concept (PoC)-App, um den Angriff zu demonstrieren.

### Startmodi

Das Attribut `launchMode` steuert die Verwaltung von Aktivit√§tsinstanzen innerhalb von Aufgaben. Der **singleTask**-Modus ist f√ºr diesen Angriff entscheidend und legt drei Szenarien basierend auf den vorhandenen Aktivit√§tsinstanzen und √úbereinstimmungen der Task-Affinit√§t fest. Der Exploit beruht auf der F√§higkeit der App eines Angreifers, die Task-Affinit√§t der Ziel-App zu imitieren und das Android-System dazu zu bringen, die App des Angreifers anstelle der beabsichtigten Ziel-App zu starten.

### Detaillierte Angriffsschritte

1. **Installation der b√∂sartigen App**: Das Opfer installiert die App des Angreifers auf seinem Ger√§t.
2. **Erstmalige Aktivierung**: Das Opfer √∂ffnet zuerst die b√∂sartige App und bereitet das Ger√§t f√ºr den Angriff vor.
3. **Versuch des Startens der Ziel-App**: Das Opfer versucht, die Ziel-App zu √∂ffnen.
4. **Hijack-Ausf√ºhrung**: Aufgrund der √ºbereinstimmenden Task-Affinit√§t wird die b√∂sartige App anstelle der Ziel-App gestartet.
5. **T√§uschung**: Die b√∂sartige App zeigt einen gef√§lschten Anmeldebildschirm, der der Ziel-App √§hnelt, und t√§uscht den Benutzer dazu, sensible Informationen einzugeben.

F√ºr eine praktische Umsetzung dieses Angriffs siehe das Task Hijacking Strandhogg-Repository auf GitHub: [Task Hijacking Strandhogg](https://github.com/az0mb13/Task_Hijacking_Strandhogg).

### Pr√§ventivma√ünahmen

Um solche Angriffe zu verhindern, k√∂nnen Entwickler `taskAffinity` auf einen leeren String setzen und den `singleInstance`-Startmodus w√§hlen, um die Isolierung ihrer App von anderen zu gew√§hrleisten. Die Anpassung der Funktion `onBackPressed()` bietet zus√§tzlichen Schutz gegen Task-Hijacking.

## **Referenzen**

* [**https://blog.dixitaditya.com/android-task-hijacking/**](https://blog.dixitaditya.com/android-task-hijacking/)
* [**https://blog.takemyhand.xyz/2021/02/android-task-hijacking-with.html**](https://blog.takemyhand.xyz/2021/02/android-task-hijacking-with.html)

<figure><img src="/.gitbook/assets/image (675).png" alt=""><figcaption></figcaption></figure>

Finden Sie die wichtigsten Schwachstellen, damit Sie sie schneller beheben k√∂nnen. Intruder verfolgt Ihre Angriffsfl√§che, f√ºhrt proaktive Bedrohungsscans durch und findet Probleme in Ihrer gesamten Technologie-Stack, von APIs √ºber Webanwendungen bis hin zu Cloud-Systemen. [**Probieren Sie es noch heute kostenlos aus**](https://www.intruder.io/?utm\_source=referral\&utm\_campaign=hacktricks).

{% embed url="https://www.intruder.io/?utm_campaign=hacktricks&utm_source=referral" %}

<details>

<summary><strong>Lernen Sie AWS-Hacking von Grund auf mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks bewerben m√∂chten** oder **HackTricks als PDF herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merchandise**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositories senden.

</details>
