# Android Task Hijacking

<details>

<summary><strong>Μάθετε το χάκινγκ του AWS από το μηδέν έως τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Ειδικός Red Team του HackTricks AWS)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι υποστήριξης του HackTricks:

* Αν θέλετε να δείτε την **εταιρεία σας διαφημισμένη στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**την Οικογένεια PEASS**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε** στη 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στη [**ομάδα τηλεγραφήματος**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε τα χάκινγκ κόλπα σας υποβάλλοντας PRs** στα [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του GitHub.

</details>

## Task, Back Stack and Foreground Activities

Στο Android, ένα **task** είναι ουσιαστικά ένα σύνολο δραστηριοτήτων με τις οποίες αλληλεπιδρούν οι χρήστες για την ολοκλήρωση μιας συγκεκριμένης εργασίας, οργανωμένο μέσα σε ένα **back stack**. Αυτή η στοίβα ταξινομεί τις δραστηριότητες με βάση το χρόνο που άνοιξαν, με την πιο πρόσφατη δραστηριότητα να εμφανίζεται στην κορυφή ως **foreground activity**. Ανά πάσα στιγμή, μόνο αυτή η δραστηριότητα είναι ορατή στην οθόνη, καθιστώντας τη μέρος του **foreground task**.

Εδώ υπάρχει μια γρήγορη ανάλυση των μεταβάσεων δραστηριοτήτων:

* Η **Δραστηριότητα 1** ξεκινά ως η μοναδική δραστηριότητα στο foreground.
* Η εκκίνηση της **Δραστηριότητας 2** μετακινεί τη **Δραστηριότητα 1** στο back stack, φέρνοντας τη **Δραστηριότητα 2** στο foreground.
* Η έναρξη της **Δραστηριότητας 3** μετακινεί τη **Δραστηριότητα 1** και τη **Δραστηριότητα 2** περαιτέρω πίσω στη στοίβα, με τη **Δραστηριότητα 3** τώρα μπροστά.
* Το κλείσιμο της **Δραστηριότητας 3** φέρνει τη **Δραστηριότητα 2** πίσω στο foreground, επιδεικνύοντας τον απλοποιημένο μηχανισμό πλοήγησης των tasks του Android.

![https://developer.android.com/images/fundamentals/diagram\_backstack.png](<../../.gitbook/assets/image (548).png>)

## Task affinity attack

### Επισκόπηση της Task Affinity και των Λειτουργιών Εκκίνησης

Στις εφαρμογές Android, η **task affinity** καθορίζει το προτιμώμενο task μιας δραστηριότητας, συνήθως ευθυγραμμιζόμενη με το όνομα πακέτου της εφαρμογής. Αυτή η ρύθμιση είναι ουσιώδης για τη δημιουργία μιας εφαρμογής proof-of-concept (PoC) για την επίδειξη της επίθεσης.

### Λειτουργίες Εκκίνησης

Το χαρακτηριστικό `launchMode` καθοδηγεί την χειρισμό των περιπτώσεων δραστηριοτήτων εντός των tasks. Η λειτουργία **singleTask** είναι κρίσιμη για αυτήν την επίθεση, διατάσσοντας τρεις σενάρια βάσει των υπαρχουσών περιπτώσεων δραστηριοτήτων και των αντιστοιχιών task affinity. Η εκμετάλλευση βασίζεται στη δυνατότητα της εφαρμογής του επιτιθέμενου να μιμείται την task affinity της εφαρμογής-στόχου, παραπλανώντας το σύστημα Android να εκκινήσει την εφαρμογή του επιτιθέμενου αντί της επιθυμητής στόχου.

### Λεπτομερείς Βήματα Επίθεσης

1. **Εγκατάσταση Κακόβουλης Εφαρμογής**: Ο θύμα εγκαθιστά την κακόβουλη εφαρμογή του επιτιθέμενου στη συσκευή του.
2. **Αρχική Ενεργοποίηση**: Το θύμα ανοίγει πρώτα την κακόβουλη εφαρμογή, προετοιμάζοντας τη συσκευή για την επίθεση.
3. **Προσπάθεια Εκκίνησης της Εφαρμογής-Στόχου**: Το θύμα προσπαθεί να ανοίξει την εφαρμογή-στόχο.
4. **Εκτέλεση Απαγωγής**: Λόγω της αντιστοίχισης της task affinity, η κακόβουλη εφαρμογή εκκινείται αντί της εφαρμογής-στόχου.
5. **Απάτη**: Η κακόβουλη εφαρμογή παρουσιάζει μια ψεύτικη οθόνη σύνδεσης που μοιάζει με την εφαρμογή-στόχο, εξαπατώντας τον χρήστη να εισάγει ευαίσθητες πληροφορίες.

Για μια πρακτική υλοποίηση αυτής της επίθεσης, ανατρέξτε στο αποθετήριο Task Hijacking Strandhogg στο GitHub: [Task Hijacking Strandhogg](https://github.com/az0mb13/Task\_Hijacking\_Strandhogg).

### Μέτρα Πρόληψης

Για την πρόληψη τέτοιων επιθέσεων, οι προγραμματιστές μπορούν να ορίσουν το `taskAffinity` σε κενό συμβολοσειράς και να επιλέξουν τη λειτουργία εκκίνησης `singleInstance`, εξασφαλίζοντας την απομόνωση της εφαρμογής τους από άλλες. Η προσαρμογή της λειτουργίας `onBackPressed()` προσφέρει επιπλέον προστασία ενάντια στην απαγωγή task. 

## **Αναφορές**

* [**https://blog.dixitaditya.com/android-task-hijacking/**](https://blog.dixitaditya.com/android-task-hijacking/)
* [**https://blog.takemyhand.xyz/2021/02/android-task-hijacking-with.html**](https://blog.takemyhand.xyz/2021/02/android-task-hijacking-with.html)

<details>

<summary><strong>Μάθετε το χάκινγκ του AWS από το μηδέν έως τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Ειδικός Red Team του HackTricks AWS)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι υποστήριξης του HackTricks:

* Αν θέλετε να δείτε την **εταιρεία σας διαφημισμένη στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**την Οικογένεια PEASS**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε** στη 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στη [**ομάδα τηλεγραφήματος**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε τα χάκινγκ κόλπα σας υποβάλλοντας PRs** στα [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του GitHub.

</details>
