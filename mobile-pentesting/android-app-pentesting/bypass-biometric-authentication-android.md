# Androidでの生体認証バイパス

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks Cloud ☁️</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>🐦 Twitter 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 Youtube 🎥</strong></a></summary>

* **サイバーセキュリティ会社**で働いていますか？**HackTricksで会社の広告を掲載**したいですか？または、**最新版のPEASSを入手**したり、**HackTricksをPDFでダウンロード**したいですか？[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見してください。私たちの独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)コレクションです。
* [**公式のPEASS & HackTricksグッズ**](https://peass.creator-spring.com)を手に入れましょう。
* **[**💬**](https://emojipedia.org/speech-balloon/) [**Discordグループ**](https://discord.gg/hRep4RUj7f)に参加するか、[**telegramグループ**](https://t.me/peass)に参加するか、**Twitter** [**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**にフォローしてください。**
* **[hacktricksリポジトリ](https://github.com/carlospolop/hacktricks)と[hacktricks-cloudリポジトリ](https://github.com/carlospolop/hacktricks-cloud)にPRを提出して、あなたのハッキングのコツを共有してください。**

</details>

### **方法1 – Crypto Objectを使用しないバイパス**

ここでの焦点は、認証プロセスにおいて重要な*onAuthenticationSucceeded*コールバックにあります。WithSecureの研究者が開発した[Fridaスクリプト](https://github.com/WithSecureLABS/android-keystore-audit/blob/master/frida-scripts/fingerprint-bypass.js)を使用すると、*onAuthenticationSucceeded(...)*のNULL *CryptoObject*をバイパスできます。このスクリプトは、メソッドの呼び出し時に指紋認証を自動的にバイパスするように強制します。以下は、Androidの指紋コンテキストでのバイパスを示す簡略化されたスニペットで、完全なアプリケーションは[GitHub](https://github.com/St3v3nsS/InsecureBanking)で利用可能です。
```javascript
biometricPrompt = new BiometricPrompt(this, executor, new BiometricPrompt.AuthenticationCallback() {
@Override
public void onAuthenticationSucceeded(@NonNull BiometricPrompt.AuthenticationResult result) {
Toast.makeText(MainActivity.this,"Success",Toast.LENGTH_LONG).show();
}
});
```
実行するコマンド Frida スクリプト：
```bash
frida -U -f com.generic.insecurebankingfingerprint --no-pause -l fingerprint-bypass.js
```
### **方法2 – 例外処理アプローチ**

WithSecureが提供する[Fridaスクリプト](https://github.com/WithSecureLABS/android-keystore-audit/blob/master/frida-scripts/fingerprint-bypass-via-exception-handling.js)は、安全でない暗号オブジェクトの使用をバイパスする方法を対処します。このスクリプトは、指紋によって認証されていない*CrytoObject*を使って*onAuthenticationSucceeded*を呼び出します。アプリケーションが異なる暗号オブジェクトを使用しようとすると、例外が発生します。スクリプトは、_Cipher_ クラスで*javax.crypto.IllegalBlockSizeException*を処理しながら*onAuthenticationSucceeded*を呼び出す準備をします。これにより、アプリケーションが使用する後続のオブジェクトが新しいキーで暗号化されることを保証します。

Fridaスクリプトを実行するコマンド：
```bash
frida -U -f com.generic.insecurebankingfingerprint --no-pause -l fingerprint-bypass-via-exception-handling.js
```
指紋認証画面に到達し、`authenticate()` の開始時に、Fridaコンソールで `bypass()` を入力してバイパスをアクティブにします：
```
Spawning com.generic.insecurebankingfingerprint...
[Android Emulator 5554::com.generic.insecurebankingfingerprint]-> Hooking BiometricPrompt.authenticate()...
Hooking BiometricPrompt.authenticate2()...
Hooking FingerprintManager.authenticate()...
[Android Emulator 5554::com.generic.insecurebankingfingerprint]-> bypass()
```
### **方法3 – インストゥルメンテーションフレームワーク**

インストゥルメンテーションフレームワーク、例えばXposedやFridaは、ランタイムでアプリケーションメソッドにフックするために使用できます。指紋認証において、これらのフレームワークは以下のことができます：

1. **認証コールバックのモック**: `BiometricPrompt.AuthenticationCallback`の`onAuthenticationSucceeded`、`onAuthenticationFailed`、または`onAuthenticationError`メソッドにフックすることで、指紋認証プロセスの結果を制御できます。
2. **SSLピンニングのバイパス**: これにより、攻撃者はクライアントとサーバー間のトラフィックを傍受し、変更することができ、認証プロセスを変更したり、機密データを盗んだりする可能性があります。

Fridaの例コマンド：
```bash
frida -U -l script-to-bypass-authentication.js --no-pause -f com.generic.in
```
### **方法 4 – リバースエンジニアリング & コード変更**

`APKTool`、`dex2jar`、`JD-GUI` などのリバースエンジニアリングツールを使用して、Androidアプリケーションを逆コンパイルし、ソースコードを読み、認証メカニズムを理解することができます。一般的な手順は以下の通りです：

1. **APKの逆コンパイル**：APKファイルをより人間が読みやすい形式（Javaコードなど）に変換します。
2. **コードの分析**：指紋認証の実装を探し、潜在的な弱点（フォールバックメカニズムや不適切な検証チェックなど）を特定します。
3. **APKの再コンパイル**：指紋認証をバイパスするためにコードを変更した後、アプリケーションを再コンパイルし、署名してデバイスにインストールし、テストします。

### **方法 5 – カスタム認証ツールの使用**

認証メカニズムをテストし、バイパスするために設計された専門的なツールやスクリプトがあります。例えば：

1. **MAGISKモジュール**：MAGISKはAndroid用のツールで、デバイスをルート化し、指紋情報を含むハードウェアレベルの情報を変更または偽装するモジュールを追加することができます。
2. **カスタムビルドスクリプト**：Android Debug Bridge（ADB）やアプリケーションのバックエンドと直接対話し、指紋認証をシミュレートまたはバイパスするスクリプトを作成することができます。

# 参考文献
* [https://securitycafe.ro/2022/09/05/mobile-pentesting-101-bypassing-biometric-authentication/](https://securitycafe.ro/2022/09/05/mobile-pentesting-101-bypassing-biometric-authentication/)

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks Cloud ☁️</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>🐦 Twitter 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 Youtube 🎥</strong></a></summary>

* **サイバーセキュリティ会社**で働いていますか？**HackTricksにあなたの会社を広告したいですか？** または、**PEASSの最新バージョンにアクセスしたり、HackTricksをPDFでダウンロードしたいですか？** [**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見してください。私たちの独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクションです。
* [**公式のPEASS & HackTricksグッズ**](https://peass.creator-spring.com)を手に入れましょう。
* **[**💬**](https://emojipedia.org/speech-balloon/) [**Discordグループ**](https://discord.gg/hRep4RUj7f)や[**telegramグループ**](https://t.me/peass)に参加するか、**Twitter** [**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**にフォローしてください。**
* **[hacktricks repo](https://github.com/carlospolop/hacktricks)や[hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)にPRを提出して、あなたのハッキングのコツを共有してください。**

</details>
