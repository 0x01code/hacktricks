# Umgehung der biometrischen Authentifizierung (Android)


<details>

<summary><strong>Lernen Sie AWS-Hacking von Grund auf mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Arbeiten Sie in einem **Cybersicherheitsunternehmen**? M√∂chten Sie Ihr **Unternehmen in HackTricks bewerben**? Oder m√∂chten Sie Zugriff auf die **neueste Version von PEASS oder HackTricks im PDF-Format** haben? √úberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merchandise**](https://peass.creator-spring.com)
* **Treten Sie der** [**üí¨**](https://emojipedia.org/speech-balloon/) [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegramm-Gruppe**](https://t.me/peass) bei oder **folgen** Sie mir auf **Twitter** üê¶[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an das [hacktricks-Repository](https://github.com/carlospolop/hacktricks) und das [hacktricks-cloud-Repository](https://github.com/carlospolop/hacktricks-cloud) senden**.

</details>

## **Methode 1 - Umgehung ohne Verwendung eines Crypto-Objekts**

Der Fokus liegt hier auf dem *onAuthenticationSucceeded*-R√ºckruf, der im Authentifizierungsprozess entscheidend ist. Forscher von WithSecure haben ein [Frida-Skript](https://github.com/WithSecureLABS/android-keystore-audit/blob/master/frida-scripts/fingerprint-bypass.js) entwickelt, das die Umgehung des NULL-*CryptoObject* in *onAuthenticationSucceeded(...)* erm√∂glicht. Das Skript erzwingt eine automatische Umgehung der Fingerabdruck-Authentifizierung bei Aufruf der Methode. Im Folgenden finden Sie ein vereinfachtes Snippet, das die Umgehung in einem Android-Fingerabdruckkontext zeigt. Die vollst√§ndige Anwendung ist auf [GitHub](https://github.com/St3v3nsS/InsecureBanking) verf√ºgbar.
```javascript
biometricPrompt = new BiometricPrompt(this, executor, new BiometricPrompt.AuthenticationCallback() {
@Override
public void onAuthenticationSucceeded(@NonNull BiometricPrompt.AuthenticationResult result) {
Toast.makeText(MainActivity.this,"Success",Toast.LENGTH_LONG).show();
}
});
```
Befehl zum Ausf√ºhren des Frida-Skripts:
```bash
frida -U -f com.generic.insecurebankingfingerprint --no-pause -l fingerprint-bypass.js
```
## **Methode 2 - Ansatz zur Ausnahmebehandlung**

Ein weiteres [Frida-Skript](https://github.com/WithSecureLABS/android-keystore-audit/blob/master/frida-scripts/fingerprint-bypass-via-exception-handling.js) von WithSecure behandelt das Umgehen der unsicheren Verwendung von Kryptoobjekten. Das Skript ruft *onAuthenticationSucceeded* mit einem *CryptoObject* auf, das nicht von einem Fingerabdruck autorisiert wurde. Wenn die Anwendung versucht, ein anderes Chiffrenobjekt zu verwenden, wird eine Ausnahme ausgel√∂st. Das Skript bereitet sich darauf vor, *onAuthenticationSucceeded* aufzurufen und die *javax.crypto.IllegalBlockSizeException* in der Klasse _Cipher_ zu behandeln, um sicherzustellen, dass nachfolgende von der Anwendung verwendete Objekte mit dem neuen Schl√ºssel verschl√ºsselt werden.

Befehl zum Ausf√ºhren des Frida-Skripts:
```bash
frida -U -f com.generic.insecurebankingfingerprint --no-pause -l fingerprint-bypass-via-exception-handling.js
```
Nachdem Sie den Fingerabdruckbildschirm erreicht haben und die Funktion `authenticate()` gestartet wurde, geben Sie `bypass()` in die Frida-Konsole ein, um den Bypass zu aktivieren:
```
Spawning com.generic.insecurebankingfingerprint...
[Android Emulator 5554::com.generic.insecurebankingfingerprint]-> Hooking BiometricPrompt.authenticate()...
Hooking BiometricPrompt.authenticate2()...
Hooking FingerprintManager.authenticate()...
[Android Emulator 5554::com.generic.insecurebankingfingerprint]-> bypass()
```
## **Methode 3 - Instrumentation Frameworks**

Instrumentation-Frameworks wie Xposed oder Frida k√∂nnen verwendet werden, um zur Laufzeit in Anwendungsmethoden einzuhaken. F√ºr die Fingerabdruck-Authentifizierung k√∂nnen diese Frameworks Folgendes tun:

1. **Die Authentifizierungs-Callbacks f√§lschen**: Durch das Einhaken in die Methoden `onAuthenticationSucceeded`, `onAuthenticationFailed` oder `onAuthenticationError` des `BiometricPrompt.AuthenticationCallback` k√∂nnen Sie das Ergebnis des Fingerabdruck-Authentifizierungsprozesses kontrollieren.
2. **SSL-Pinning umgehen**: Dies erm√∂glicht einem Angreifer, den Datenverkehr zwischen Client und Server abzufangen und zu modifizieren, was potenziell den Authentifizierungsprozess ver√§ndern oder sensible Daten stehlen kann.

Beispielbefehl f√ºr Frida:
```bash
frida -U -l script-to-bypass-authentication.js --no-pause -f com.generic.in
```
## **Methode 4 - Reverse Engineering & Code-√Ñnderung**

Reverse Engineering-Tools wie `APKTool`, `dex2jar` und `JD-GUI` k√∂nnen verwendet werden, um eine Android-Anwendung zu dekompilieren, ihren Quellcode zu lesen und ihren Authentifizierungsmechanismus zu verstehen. Die Schritte umfassen in der Regel:

1. **Dekompilieren der APK**: Die APK-Datei in ein f√ºr Menschen lesbares Format (wie Java-Code) konvertieren.
2. **Analyse des Codes**: Nach der Implementierung der Fingerabdruck-Authentifizierung suchen und potenzielle Schwachstellen identifizieren (wie Ausweichmechanismen oder unzureichende Validierungspr√ºfungen).
3. **Rekompilieren der APK**: Nach der Modifizierung des Codes zur Umgehung der Fingerabdruck-Authentifizierung wird die Anwendung rekompiliert, signiert und auf dem Ger√§t zur √úberpr√ºfung installiert.

## **Methode 5 - Verwendung von benutzerdefinierten Authentifizierungstools**

Es gibt spezialisierte Tools und Skripte, die entwickelt wurden, um Authentifizierungsmechanismen zu testen und zu umgehen. Zum Beispiel:

1. **MAGISK-Module**: MAGISK ist ein Tool f√ºr Android, mit dem Benutzer ihre Ger√§te rooten und Module hinzuf√ºgen k√∂nnen, die Hardware-Ebene-Informationen wie Fingerabdr√ºcke modifizieren oder f√§lschen k√∂nnen.
2. **Benutzerdefinierte Skripte**: Skripte k√∂nnen geschrieben werden, um mit der Android Debug Bridge (ADB) oder direkt mit dem Backend der Anwendung zu interagieren und die Fingerabdruck-Authentifizierung zu simulieren oder zu umgehen.

## Referenzen
* [https://securitycafe.ro/2022/09/05/mobile-pentesting-101-bypassing-biometric-authentication/](https://securitycafe.ro/2022/09/05/mobile-pentesting-101-bypassing-biometric-authentication/)

<details>

<summary><strong>Lernen Sie AWS-Hacking von Grund auf mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Arbeiten Sie in einem **Cybersecurity-Unternehmen**? M√∂chten Sie Ihr **Unternehmen in HackTricks bewerben**? Oder m√∂chten Sie Zugriff auf die **neueste Version des PEASS erhalten oder HackTricks als PDF herunterladen**? √úberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merch**](https://peass.creator-spring.com)
* **Treten Sie der** [**üí¨**](https://emojipedia.org/speech-balloon/) [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegramm-Gruppe**](https://t.me/peass) bei oder **folgen** Sie mir auf **Twitter** üê¶[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an das [hacktricks-Repository](https://github.com/carlospolop/hacktricks) und das [hacktricks-cloud-Repository](https://github.com/carlospolop/hacktricks-cloud) senden**.

</details>
