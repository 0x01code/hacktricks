# Contourner l'authentification biom√©trique (Android)


<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Expert en √©quipe rouge AWS de HackTricks)</strong></a><strong>!</strong></summary>

* Travaillez-vous dans une **entreprise de cybers√©curit√©**? Voulez-vous voir votre **entreprise annonc√©e dans HackTricks**? ou voulez-vous avoir acc√®s √† la **derni√®re version du PEASS ou t√©l√©charger HackTricks en PDF**? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**üí¨**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR au [d√©p√¥t hacktricks](https://github.com/carlospolop/hacktricks) et [d√©p√¥t hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>

## **M√©thode 1 - Contournement sans utilisation d'objet Crypto**

L'accent est mis ici sur le rappel *onAuthenticationSucceeded*, qui est crucial dans le processus d'authentification. Les chercheurs de WithSecure ont d√©velopp√© un [script Frida](https://github.com/WithSecureLABS/android-keystore-audit/blob/master/frida-scripts/fingerprint-bypass.js), permettant de contourner le *CryptoObject* NULL dans *onAuthenticationSucceeded(...)*. Le script force un contournement automatique de l'authentification par empreinte digitale lors de l'invocation de la m√©thode. Ci-dessous se trouve un extrait simplifi√© d√©montrant le contournement dans un contexte d'empreinte digitale Android, avec l'application compl√®te disponible sur [GitHub](https://github.com/St3v3nsS/InsecureBanking).
```javascript
biometricPrompt = new BiometricPrompt(this, executor, new BiometricPrompt.AuthenticationCallback() {
@Override
public void onAuthenticationSucceeded(@NonNull BiometricPrompt.AuthenticationResult result) {
Toast.makeText(MainActivity.this,"Success",Toast.LENGTH_LONG).show();
}
});
```
Commande pour ex√©cuter le script Frida :
```bash
frida -U -f com.generic.insecurebankingfingerprint --no-pause -l fingerprint-bypass.js
```
## **M√©thode 2 - Approche de gestion des exceptions**

Un autre [script Frida](https://github.com/WithSecureLABS/android-keystore-audit/blob/master/frida-scripts/fingerprint-bypass-via-exception-handling.js) de WithSecure aborde le contournement de l'utilisation d'objets cryptographiques non s√©curis√©s. Le script invoque *onAuthenticationSucceeded* avec un *CryptoObject* qui n'a pas √©t√© autoris√© par une empreinte digitale. Si l'application tente d'utiliser un objet de chiffrement diff√©rent, cela d√©clenchera une exception. Le script se pr√©pare √† invoquer *onAuthenticationSucceeded* et √† g√©rer l'exception *javax.crypto.IllegalBlockSizeException* dans la classe _Cipher_, garantissant que les objets ult√©rieurs utilis√©s par l'application sont chiffr√©s avec la nouvelle cl√©.

Commande pour ex√©cuter le script Frida :
```bash
frida -U -f com.generic.insecurebankingfingerprint --no-pause -l fingerprint-bypass-via-exception-handling.js
```
Lorsque vous atteignez l'√©cran d'empreintes digitales et que vous lancez `authenticate()`, saisissez `bypass()` dans la console Frida pour activer le contournement :
```
Spawning com.generic.insecurebankingfingerprint...
[Android Emulator 5554::com.generic.insecurebankingfingerprint]-> Hooking BiometricPrompt.authenticate()...
Hooking BiometricPrompt.authenticate2()...
Hooking FingerprintManager.authenticate()...
[Android Emulator 5554::com.generic.insecurebankingfingerprint]-> bypass()
```
## **M√©thode 3 ‚Äì Cadres d'instrumentation**

Les cadres d'instrumentation comme Xposed ou Frida peuvent √™tre utilis√©s pour accrocher des m√©thodes d'application en temps d'ex√©cution. Pour l'authentification par empreinte digitale, ces cadres peuvent :

1. **Simuler les rappels d'authentification** : En accrochant les m√©thodes `onAuthenticationSucceeded`, `onAuthenticationFailed`, ou `onAuthenticationError` du `BiometricPrompt.AuthenticationCallback`, vous pouvez contr√¥ler le r√©sultat du processus d'authentification par empreinte digitale.
2. **Contourner l'√©pinglage SSL** : Cela permet √† un attaquant d'intercepter et de modifier le trafic entre le client et le serveur, potentiellement alt√©rant le processus d'authentification ou volant des donn√©es sensibles.

Commande d'exemple pour Frida :
```bash
frida -U -l script-to-bypass-authentication.js --no-pause -f com.generic.in
```
## **M√©thode 4 ‚Äì R√©tro-ing√©nierie & Modification de Code**

Des outils de r√©tro-ing√©nierie comme `APKTool`, `dex2jar` et `JD-GUI` peuvent √™tre utilis√©s pour d√©compiler une application Android, lire son code source et comprendre son m√©canisme d'authentification. Les √©tapes comprennent g√©n√©ralement :

1. **D√©compiler l'APK** : Convertir le fichier APK dans un format plus lisible par les humains (comme du code Java).
2. **Analyser le Code** : Rechercher l'impl√©mentation de l'authentification par empreinte digitale et identifier les √©ventuelles faiblesses (comme les m√©canismes de secours ou les v√©rifications de validation incorrectes).
3. **Recompiler l'APK** : Apr√®s avoir modifi√© le code pour contourner l'authentification par empreinte digitale, l'application est recompil√©e, sign√©e et install√©e sur l'appareil pour les tests.

## **M√©thode 5 ‚Äì Utilisation d'Outils d'Authentification Personnalis√©s**

Il existe des outils sp√©cialis√©s et des scripts con√ßus pour tester et contourner les m√©canismes d'authentification. Par exemple :

1. **Modules MAGISK** : MAGISK est un outil pour Android qui permet aux utilisateurs de rooter leurs appareils et d'ajouter des modules pouvant modifier ou imiter des informations au niveau mat√©riel, y compris les empreintes digitales.
2. **Scripts Personnalis√©s** : Des scripts peuvent √™tre √©crits pour interagir avec le Pont de D√©bogage Android (ADB) ou directement avec le backend de l'application pour simuler ou contourner l'authentification par empreinte digitale.

## R√©f√©rences
* [https://securitycafe.ro/2022/09/05/mobile-pentesting-101-bypassing-biometric-authentication/](https://securitycafe.ro/2022/09/05/mobile-pentesting-101-bypassing-biometric-authentication/)
