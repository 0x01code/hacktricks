# Bypassar Autentica√ß√£o Biom√©trica (Android)

<details>

<summary><strong>Aprenda hacking AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Voc√™ trabalha em uma **empresa de ciberseguran√ßa**? Gostaria de ver sua **empresa anunciada no HackTricks**? ou gostaria de ter acesso √† **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**? Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Adquira o [**swag oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* **Junte-se ao** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para o [reposit√≥rio hacktricks](https://github.com/carlospolop/hacktricks) e [reposit√≥rio hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>

## **M√©todo 1 ‚Äì Bypass sem Uso de Objeto Criptogr√°fico**

O foco aqui est√° no callback *onAuthenticationSucceeded*, que √© crucial no processo de autentica√ß√£o. Pesquisadores da WithSecure desenvolveram um [script Frida](https://github.com/WithSecureLABS/android-keystore-audit/blob/master/frida-scripts/fingerprint-bypass.js), permitindo o bypass do *CryptoObject* NULL em *onAuthenticationSucceeded(...)*. O script for√ßa um bypass autom√°tico da autentica√ß√£o por impress√£o digital ao ser invocado pelo m√©todo. Abaixo est√° um trecho simplificado demonstrando o bypass em um contexto de Impress√£o Digital Android, com a aplica√ß√£o completa dispon√≠vel no [GitHub](https://github.com/St3v3nsS/InsecureBanking).
```javascript
biometricPrompt = new BiometricPrompt(this, executor, new BiometricPrompt.AuthenticationCallback() {
@Override
public void onAuthenticationSucceeded(@NonNull BiometricPrompt.AuthenticationResult result) {
Toast.makeText(MainActivity.this,"Success",Toast.LENGTH_LONG).show();
}
});
```
Comando para executar o script Frida:
```bash
frida -U -f com.generic.insecurebankingfingerprint --no-pause -l fingerprint-bypass.js
```
## **M√©todo 2 - Abordagem de Manipula√ß√£o de Exce√ß√µes**

Outro [script Frida](https://github.com/WithSecureLABS/android-keystore-audit/blob/master/frida-scripts/fingerprint-bypass-via-exception-handling.js) da WithSecure aborda a bypassagem do uso inseguro do objeto de criptografia. O script invoca *onAuthenticationSucceeded* com um *CryptoObject* que n√£o foi autorizado por uma impress√£o digital. Se a aplica√ß√£o tentar usar um objeto de cifra diferente, isso ir√° desencadear uma exce√ß√£o. O script se prepara para invocar *onAuthenticationSucceeded* e lidar com a *javax.crypto.IllegalBlockSizeException* na classe _Cipher_, garantindo que objetos subsequentes usados pela aplica√ß√£o sejam criptografados com a nova chave.

Comando para executar o script Frida:
```bash
frida -U -f com.generic.insecurebankingfingerprint --no-pause -l fingerprint-bypass-via-exception-handling.js
```
Ao chegar na tela de impress√£o digital e a inicializa√ß√£o de `authenticate()`, digite `bypass()` no console do Frida para ativar o bypass:
```
Spawning com.generic.insecurebankingfingerprint...
[Android Emulator 5554::com.generic.insecurebankingfingerprint]-> Hooking BiometricPrompt.authenticate()...
Hooking BiometricPrompt.authenticate2()...
Hooking FingerprintManager.authenticate()...
[Android Emulator 5554::com.generic.insecurebankingfingerprint]-> bypass()
```
## **M√©todo 3 - Frameworks de Instrumenta√ß√£o**

Frameworks de instrumenta√ß√£o como Xposed ou Frida podem ser usados para se conectar aos m√©todos da aplica√ß√£o em tempo de execu√ß√£o. Para autentica√ß√£o por impress√£o digital, esses frameworks podem:

1. **Simular os Callbacks de Autentica√ß√£o**: Ao se conectar aos m√©todos `onAuthenticationSucceeded`, `onAuthenticationFailed` ou `onAuthenticationError` do `BiometricPrompt.AuthenticationCallback`, √© poss√≠vel controlar o resultado do processo de autentica√ß√£o por impress√£o digital.
2. **Burlar o SSL Pinning**: Isso permite que um atacante intercepte e modifique o tr√°fego entre o cliente e o servidor, potencialmente alterando o processo de autentica√ß√£o ou roubando dados sens√≠veis.

Comando de exemplo para Frida:
```bash
frida -U -l script-to-bypass-authentication.js --no-pause -f com.generic.in
```
## **M√©todo 4 - Engenharia Reversa e Modifica√ß√£o de C√≥digo**

Ferramentas de engenharia reversa como `APKTool`, `dex2jar` e `JD-GUI` podem ser usadas para descompilar um aplicativo Android, ler seu c√≥digo-fonte e entender seu mecanismo de autentica√ß√£o. Os passos geralmente incluem:

1. **Descompilar o APK**: Converter o arquivo APK para um formato mais leg√≠vel para humanos (como c√≥digo Java).
2. **Analisar o C√≥digo**: Procure a implementa√ß√£o da autentica√ß√£o por impress√£o digital e identifique poss√≠veis vulnerabilidades (como mecanismos de fallback ou verifica√ß√µes de valida√ß√£o inadequadas).
3. **Recompilar o APK**: Ap√≥s modificar o c√≥digo para contornar a autentica√ß√£o por impress√£o digital, o aplicativo √© recompilado, assinado e instalado no dispositivo para testes.

## **M√©todo 5 - Usando Ferramentas de Autentica√ß√£o Personalizadas**

Existem ferramentas e scripts especializados projetados para testar e contornar mecanismos de autentica√ß√£o. Por exemplo:

1. **M√≥dulos MAGISK**: MAGISK √© uma ferramenta para Android que permite aos usu√°rios fazer root em seus dispositivos e adicionar m√≥dulos que podem modificar ou falsificar informa√ß√µes em n√≠vel de hardware, incluindo impress√µes digitais.
2. **Scripts Personalizados**: Scripts podem ser escritos para interagir com a Android Debug Bridge (ADB) ou diretamente com o backend do aplicativo para simular ou contornar a autentica√ß√£o por impress√£o digital.

## Refer√™ncias
* [https://securitycafe.ro/2022/09/05/mobile-pentesting-101-bypassing-biometric-authentication/](https://securitycafe.ro/2022/09/05/mobile-pentesting-101-bypassing-biometric-authentication/)

<details>

<summary><strong>Aprenda hacking AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Voc√™ trabalha em uma **empresa de ciberseguran√ßa**? Gostaria de ver sua **empresa anunciada no HackTricks**? ou gostaria de ter acesso √† **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**? Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Adquira o [**swag oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* **Junte-se ao** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para o [reposit√≥rio hacktricks](https://github.com/carlospolop/hacktricks) e [reposit√≥rio hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>
