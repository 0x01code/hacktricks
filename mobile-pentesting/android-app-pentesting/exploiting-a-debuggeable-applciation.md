<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks Cloud ☁️</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>🐦 Twitter 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 Youtube 🎥</strong></a></summary>

- **サイバーセキュリティ会社**で働いていますか？ **HackTricksで会社を宣伝**したいですか？または、**PEASSの最新バージョンを入手したり、HackTricksをPDFでダウンロード**したいですか？[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！

- [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を見つけてください、私たちの独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクション

- [**公式のPEASS＆HackTricksのグッズ**](https://peass.creator-spring.com)を手に入れましょう

- [**💬**](https://emojipedia.org/speech-balloon/) [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**telegramグループ**](https://t.me/peass)に**参加**するか、**Twitter**で**フォロー**してください[**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**

- **ハッキングのトリックを共有するには、[hacktricksリポジトリ](https://github.com/carlospolop/hacktricks)と[hacktricks-cloudリポジトリ](https://github.com/carlospolop/hacktricks-cloud)にPRを提出してください**。

</details>


**情報は**[**https://resources.infosecinstitute.com/android-hacking-security-part-6-exploiting-debuggable-android-applications/#article**](https://resources.infosecinstitute.com/android-hacking-security-part-6-exploiting-debuggable-android-applications/#article)**からコピーされました**

この記事をより興味深くするために、デモンストレーション用に脆弱なアプリケーションを開発しました。このアプリケーションには「**ボタン**」と「**テキストビュー**」があります。

この記事に関連するコードをダウンロードするには、以下のフォームに入力してください。

アプリケーションを起動すると、「**Crack Me**」というメッセージが表示されます。

![](https://resources.infosecinstitute.com/wp-content/uploads/052314\_1204\_AndroidHack1.png)

図1

ボタンをクリックすると、「**Try Again**」と表示されます。今回の目標は、アプリケーションのソースコードを変更せずに、メッセージ「Try Again」を「Hacked」に変更することです。正確には、実行時に変更する必要があります。

## **必要なツール**

* エミュレータ
* adb - Android Debug Bridge
* jdb - Java Debugger

私の場合、インストールを簡単にするために、Android Tamerを使用しています。必要なツールはすべて事前にインストールされています。

## **関連するトピック**

* 脆弱性のチェック
* セットアップの準備
* 実行時のコードインジェクション

ゲームを始めましょう。

## **脆弱性のチェック**

実際には、この記事の中で最も簡単な部分です。

* 次のコマンドを使用して、APKTOOLを使ってアプリケーションをデコンパイルし、AndroidManifest.xmlファイルを取得します。

apktool d \<vulnerableapp>.apk

* AndroidManifest.xmlファイルで次の行を確認します。

android\_debuggable=”true”

AndroidManifest.xmlファイルで上記の行を見つけた場合、アプリケーションはデバッグ可能であり、攻撃の対象になります。

**注意:** アプリがデバッグ可能かどうかを確認するためにAPKTOOLを使用しました。前述のように、コードの一部を触れたり変更したりはしません。

## **セットアップの準備**

このステップでは、アプリケーションの実行中にコードをインジェクションするために必要なすべてのものをセットアップします。前の記事で説明したように、この記事ではリモートデバッグを使用します。

* エミュレータを起動します。
* 脆弱なアプリケーションをインストールします。
* ターミナルを開き、以下のコマンドを実行してエミュレータ上でリッスンしているDalvik VMポートを確認します。

_**adb jdwp**_

上記のコマンドは、以下に示すように接続およびデバッグできるすべてのポートを表示します。

![](https://resources.infosecinstitute.com/wp-content/uploads/052314\_1204\_AndroidHack2.png)

図2

**注意:** JDWPはJava Debug Wire Protocolの略です。VMで実行されているアプリケーションがデバッグ可能な場合、JDBを使用して接続できる一意のポートが公開されます。これは、JDWPのサポートによりDalvik仮想マシンで可能です。

* さて、ターゲットのアプリケーションを起動し、同じコマンドを実行して、ターゲットのアプリケーションに関連付けられたリッスンポートを確認します。以下に示すようになります。

![](https://resources.infosecinstitute.com/wp-content/uploads/052314\_1204\_AndroidHack3.png)

図2

図2と図3の違いに注目すると、図3でターゲットアプリケーションを起動した後に1つの追加ポート543がリッスンされていることがわかります。これが私たちのターゲットなので、このポートを使用してJDBをアプリケーションにアタッチします。

* アプリケーションにアタッチする前に、リモートデバッグを使用しているため、adbを使用してポートフォワードする必要があります。図4に示されています。

![](https://resources.infosecinstitute.com/wp-content/uploads/052314\_1204\_AndroidHack4.png)

図4

* さて、次の図に示すように、JDBをアプリケーションにアタッチしましょう。

![](https://resources.infosecinstitute.com/wp-content/uploads/052314\_1204\_AndroidHack5.png)

図5

## **実行時のコードインジェクション**

このステップでは、実際に脆弱なアプリケーションを実行時に変更して攻撃します。

アプリケーションの実行時に動作を変更するには、ブレークポイントを設定し、フローを制御する必要があります。ただし、アプリケーションで使用されるクラスやメソッドがわかりません。したがって、次のコマ
背後で何が起こっているかを理解するために、図10に示されているonClickメソッドに関連するコードを追っています。

![](https://resources.infosecinstitute.com/wp-content/uploads/052314\_1204\_AndroidHack11.png)

図10

さらに進む前に、コマンド「**locals**」を使用してこの時点でのローカル変数があるかどうかを確認しましょう。

![](https://resources.infosecinstitute.com/wp-content/uploads/052314\_1204\_AndroidHack12.png)

図11

わかりますように、私たちには興味深い情報はありません。

したがって、次の行を「**next**」コマンドを使用して実行しましょう。

![](https://resources.infosecinstitute.com/wp-content/uploads/052314\_1204\_AndroidHack13.png)

図12

次に、前のコマンドで何が起こったかを確認するために再び「**locals**」コマンドを実行してみましょう。

![](https://resources.infosecinstitute.com/wp-content/uploads/052314\_1204\_AndroidHack14.png)

図13

TextViewがメソッド引数にロードされていることが明らかです。図10で提供されたソースコードを見ると、TextViewのインスタンス化に関連する行が実行されています。

次の行を実行するために「**next**」コマンドを実行し、図のようにローカル変数をチェックしましょう。

![](https://resources.infosecinstitute.com/wp-content/uploads/052314\_1204\_AndroidHack15.png)

図14

すべてのローカル変数が表示されていることがわかります。文字列「**secret**」は興味深いようです。「Try Again」という値がボタンをクリックしたときに表示されるものです。

図10からは、値「**Try Again**」を表示するためにメソッド**setText**が実行されていることが非常に明確です。したがって、「**step**」コマンドを使用して「**setText**」メソッドの定義に入り、表示されるテキストを動的に変更しましょう。

![](https://resources.infosecinstitute.com/wp-content/uploads/052314\_1204\_AndroidHack16.png)

図15

定義内のローカル変数を「**locals**」を使用して確認しましょう。

![](https://resources.infosecinstitute.com/wp-content/uploads/052314\_1204\_AndroidHack17.png)

図16

次に、「**set**」コマンドを使用して「**text**」の値を「**Hacked**」に変更しましょう。

![](https://resources.infosecinstitute.com/wp-content/uploads/052314\_1204\_AndroidHack18.png)

図17

変更したコードを実行していないため、アプリケーションには変更が表示されません。

したがって、以下のように「**run**」コマンドを使用してアプリケーションを実行し、その画面上でアプリケーションの出力を確認しましょう。

![](https://resources.infosecinstitute.com/wp-content/uploads/052314\_1204\_AndroidHack19.png)

図18

エミュレータで実行中のアプリケーションを見てみましょう。

![](https://resources.infosecinstitute.com/wp-content/uploads/052314\_1204\_AndroidHack20.png)

図19

ランタイムでアプリケーションの出力を正常に変更しました。これは、アプリケーションがデバッグ可能な場合、アプリケーションの動作がどのように変更されるかを示す例です。脆弱なアプリケーションのコンテキストでデバイス上で「**シェルを取得する**」など、さまざまな操作を実行できます。
