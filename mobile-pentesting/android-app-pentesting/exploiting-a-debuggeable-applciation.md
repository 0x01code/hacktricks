# Exploitation d'une application d√©bogable

<details>

<summary><strong>Apprenez le hacking AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**merchandising officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de hacking en soumettant des PRs aux repos github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## **Contournement des v√©rifications de root et d√©bogable**

**Cette section de l'article est un r√©sum√© de l'article** [**https://medium.com/@shubhamsonani/hacking-with-precision-bypass-techniques-via-debugger-in-android-apps-27fd562b2cc0**](https://medium.com/@shubhamsonani/hacking-with-precision-bypass-techniques-via-debugger-in-android-apps-27fd562b2cc0)

### √âtapes pour rendre une application Android d√©bogable et contourner les v√©rifications

#### **Rendre l'application d√©bogable**

Contenu bas√© sur https://medium.com/@shubhamsonani/hacking-with-precision-bypass-techniques-via-debugger-in-android-apps-27fd562b2cc0

1. **D√©compiler l'APK :**
- Utilisez l'outil APK-GUI pour d√©compiler l'APK.
- Dans le fichier _android-manifest_, ins√©rez `android:debuggable=true` pour activer le mode d√©bogage.
- Recompilez, signez et alignez l'application modifi√©e.

2. **Installer l'application modifi√©e :**
- Utilisez la commande : `adb install <nom_application>`.

3. **R√©cup√©rer le nom du package :**
- Ex√©cutez `adb shell pm list packages ‚Äì3` pour lister les applications tierces et trouver le nom du package.

4. **Configurer l'application pour attendre la connexion du d√©bogueur :**
- Commande : `adb shell am setup-debug-app ‚Äìw <nom_package>`.
- **Note :** Cette commande doit √™tre ex√©cut√©e √† chaque fois avant de d√©marrer l'application pour s'assurer qu'elle attend le d√©bogueur.
- Pour la persistance, utilisez `adb shell am setup-debug-app ‚Äìw -‚Äìpersistent <nom_package>`.
- Pour supprimer tous les drapeaux, utilisez `adb shell am clear-debug-app <nom_package>`.

5. **Pr√©parer le d√©bogage dans Android Studio :**
- Naviguez dans Android Studio vers _Fichier -> Ouvrir le profil ou l'APK_.
- Ouvrez l'APK recompil√©.

6. **Placer des points d'arr√™t dans les fichiers Java cl√©s :**
- Placez des points d'arr√™t dans `MainActivity.java` (sp√©cifiquement dans la m√©thode `onCreate`), `b.java`, et `ContextWrapper.java`.

#### **Contournement des v√©rifications**

L'application, √† certains moments, v√©rifiera si elle est d√©bogable et cherchera √©galement des binaires indiquant un appareil root√©. Le d√©bogueur peut √™tre utilis√© pour modifier les informations de l'application, d√©sactiver le bit d√©bogable et changer les noms des binaires recherch√©s pour contourner ces v√©rifications.

Pour la v√©rification d√©bogable :

1. **Modifier les param√®tres de drapeau :**
- Dans la section des variables de la console du d√©bogueur, naviguez vers : `this mLoadedAPK -> mApplicationInfo -> flags = 814267974`.
- **Note :** La repr√©sentation binaire de `flags = 814267974` est `11000011100111011110`, indiquant que le "Flag_debuggable" est actif.

![Capture d'√©cran du d√©bogueur](https://miro.medium.com/v2/resize:fit:1400/1*-ckiSbWGSoc1beuxxpKbow.png)
*Figure : Capture d'√©cran illustrant la vue du d√©bogueur et la modification des param√®tres de drapeau.*

Ces √©tapes garantissent collectivement que l'application peut √™tre d√©bogu√©e et que certaines v√©rifications de s√©curit√© peuvent √™tre contourn√©es √† l'aide du d√©bogueur, facilitant une analyse ou une modification plus approfondie du comportement de l'application.

L'√©tape 2 implique de changer une valeur de drapeau √† 814267972, qui est repr√©sent√©e en binaire par 110000101101000000100010100.

## **Exploitation d'une vuln√©rabilit√©**

Une d√©monstration a √©t√© fournie en utilisant une application vuln√©rable contenant un bouton et un textview. Initialement, l'application affiche "Crack Me". L'objectif est de modifier le message de "Try Again" √† "Hacked" en temps r√©el, sans modifier le code source.

### **V√©rification de la vuln√©rabilit√©**
- L'application a √©t√© d√©compil√©e en utilisant `apktool` pour acc√©der au fichier `AndroidManifest.xml`.
- La pr√©sence de `android_debuggable="true"` dans le AndroidManifest.xml indique que l'application est d√©bogable et susceptible d'√™tre exploit√©e.
- Il convient de noter que `apktool` est utilis√© uniquement pour v√©rifier le statut d√©bogable sans modifier aucun code.

### **Pr√©paration de la configuration**
- Le processus a impliqu√© l'initiation d'un √©mulateur, l'installation de l'application vuln√©rable et l'utilisation de `adb jdwp` pour identifier les ports Dalvik VM en √©coute.
- Le JDWP (Java Debug Wire Protocol) permet le d√©bogage d'une application en cours d'ex√©cution dans une VM en exposant un port unique.
- Le transfert de port √©tait n√©cessaire pour le d√©bogage √† distance, suivi de l'attachement de JDB √† l'application cible.

### **Injection de code en temps r√©el**
- L'exploitation a √©t√© r√©alis√©e en pla√ßant des points d'arr√™t et en contr√¥lant le flux de l'application.
- Des commandes comme `classes` et `methods <nom_classe>` ont √©t√© utilis√©es pour d√©couvrir la structure de l'application.
- Un point d'arr√™t a √©t√© plac√© sur la m√©thode `onClick`, et son ex√©cution a √©t√© contr√¥l√©e.
- Les commandes `locals`, `next`, et `set` ont √©t√© utilis√©es pour inspecter et modifier les variables locales, en particulier en changeant le message "Try Again" en "Hacked".
- Le code modifi√© a √©t√© ex√©cut√© en utilisant la commande `run`, modifiant avec succ√®s la sortie de l'application en temps r√©el.

Cet exemple a d√©montr√© comment le comportement d'une application d√©bogable peut √™tre manipul√©, soulignant le potentiel pour des exploits plus complexes comme obtenir un acc√®s shell sur l'appareil dans le contexte de l'application.



# R√©f√©rences
* [https://medium.com/@shubhamsonani/hacking-with-precision-bypass-techniques-via-debugger-in-android-apps-27fd562b2cc0](https://medium.com/@shubhamsonani/hacking-with-precision-bypass-techniques-via-debugger-in-android-apps-27fd562b2cc0)
* [https://resources.infosecinstitute.com/android-hacking-security-part-6-exploiting-debuggable-android-applications](https://resources.infosecinstitute.com/android-hacking-security-part-6-exploiting-debuggable-android-applications)

<details>

<summary><strong>Apprenez le hacking AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**merchandising officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de hacking en soumettant des PRs aux repos github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
