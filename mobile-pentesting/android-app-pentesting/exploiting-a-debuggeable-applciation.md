# Ausnutzen einer debuggbaren Anwendung

<details>

<summary><strong>Lernen Sie AWS-Hacking von Grund auf mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks bewerben m√∂chten** oder **HackTricks als PDF herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merchandise**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs zu den** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositories einreichen.

</details>

# **Umgehen von Root- und Debugging-√úberpr√ºfungen**

Dieser Abschnitt des Beitrags ist eine Zusammenfassung des Beitrags [**https://medium.com/@shubhamsonani/hacking-with-precision-bypass-techniques-via-debugger-in-android-apps-27fd562b2cc0**](https://medium.com/@shubhamsonani/hacking-with-precision-bypass-techniques-via-debugger-in-android-apps-27fd562b2cc0)

## Schritte zum Aktivieren des Debugging-Modus und Umgehen von √úberpr√ºfungen in einer Android-App

### **Aktivieren des Debugging-Modus in der App**

Inhalt basierend auf https://medium.com/@shubhamsonani/hacking-with-precision-bypass-techniques-via-debugger-in-android-apps-27fd562b2cc0

1. **APK dekompilieren:**
- Verwenden Sie das APK-GUI-Tool zum Dekompilieren der APK.
- F√ºgen Sie in der _android-manifest_-Datei `android:debuggable=true` ein, um den Debugging-Modus zu aktivieren.
- Kompilieren Sie die modifizierte Anwendung erneut, signieren Sie sie und f√ºhren Sie den Zipalign-Vorgang durch.

2. **Installieren der modifizierten Anwendung:**
- Verwenden Sie den Befehl: `adb install <Anwendungsname>`.

3. **Abrufen des Paketnamens:**
- F√ºhren Sie `adb shell pm list packages ‚Äì3` aus, um Drittanbieteranwendungen aufzulisten und den Paketnamen zu finden.

4. **Die App auf Verbindung des Debuggers warten lassen:**
- Befehl: `adb shell am setup-debug-app ‚Äìw <Paketname>`.
- **Hinweis:** Dieser Befehl muss jedes Mal vor dem Starten der Anwendung ausgef√ºhrt werden, um sicherzustellen, dass sie auf den Debugger wartet.
- Verwenden Sie f√ºr die Persistenz `adb shell am setup-debug-app ‚Äìw -‚Äìpersistent <Paketname>`.
- Um alle Flags zu entfernen, verwenden Sie `adb shell am clear-debug-app <Paketname>`.

5. **Vorbereitung f√ºr das Debugging in Android Studio:**
- Navigieren Sie in Android Studio zu _Datei -> Profil oder APK √∂ffnen_.
- √ñffnen Sie die rekomplilierte APK.

6. **Setzen von Breakpoints in wichtigen Java-Dateien:**
- Setzen Sie Breakpoints in `MainActivity.java` (insbesondere in der Methode `onCreate`), `b.java` und `ContextWrapper.java`.

### **Umgehen von √úberpr√ºfungen**

Die Anwendung √ºberpr√ºft an bestimmten Stellen, ob sie debuggbar ist, und pr√ºft auch auf Bin√§rdateien, die auf ein gerootetes Ger√§t hinweisen. Der Debugger kann verwendet werden, um App-Informationen zu √§ndern, das Debuggable-Bit aufzuheben und die Namen der gesuchten Bin√§rdateien zu √§ndern, um diese √úberpr√ºfungen zu umgehen.

F√ºr die Debugging-√úberpr√ºfung:

1. **√Ñndern der Flag-Einstellungen:**
- Navigieren Sie in der Variablen-Sektion der Debugger-Konsole zu: `this mLoadedAPK -> mApplicationInfo -> flags = 814267974`.
- **Hinweis:** Die bin√§re Darstellung von `flags = 814267974` ist `11000011100111011110`, was darauf hinweist, dass "Flag_debuggable" aktiv ist.

![https://miro.medium.com/v2/resize:fit:1400/1*-ckiSbWGSoc1beuxxpKbow.png](https://miro.medium.com/v2/resize:fit:1400/1*-ckiSbWGSoc1beuxxpKbow.png)

Diese Schritte stellen sicher, dass die Anwendung debuggt werden kann und dass bestimmte Sicherheits√ºberpr√ºfungen mithilfe des Debuggers umgangen werden k√∂nnen, um eine detailliertere Analyse oder Modifikation des Verhaltens der Anwendung zu erm√∂glichen.

Schritt 2 beinhaltet das √Ñndern eines Flag-Werts auf 814267972, der bin√§r als 110000101101000000100010100 dargestellt wird.

# **Ausnutzen einer Schwachstelle**

Es wurde eine Demonstration anhand einer verwundbaren Anwendung mit einem Button und einem Textview durchgef√ºhrt. Anfangs zeigt die Anwendung "Crack Me" an. Das Ziel besteht darin, die Nachricht zur Laufzeit von "Try Again" in "Hacked" zu √§ndern, ohne den Quellcode zu √§ndern.

## **√úberpr√ºfung auf Schwachstellen**
- Die Anwendung wurde mit `apktool` dekompiliert, um auf die Datei `AndroidManifest.xml` zuzugreifen.
- Das Vorhandensein von `android_debuggable="true"` in der AndroidManifest.xml zeigt an, dass die Anwendung debuggbar ist und anf√§llig f√ºr Ausnutzung ist.
- Es ist erw√§hnenswert, dass `apktool` ausschlie√ülich verwendet wurde, um den Debugging-Status zu √ºberpr√ºfen, ohne Code zu √§ndern.

## **Vorbereitung der Einrichtung**
- Der Prozess umfasste das Starten eines Emulators, das Installieren der verwundbaren Anwendung und die Verwendung von `adb jdwp`, um die lauschenden Dalvik-VM-Ports zu identifizieren.
- Das JDWP (Java Debug Wire Protocol) erm√∂glicht das Debuggen einer in einer VM ausgef√ºhrten Anwendung, indem es einen eindeutigen Port freigibt.
- F√ºr das Remote-Debugging war eine Portweiterleitung erforderlich, gefolgt von der Anbindung von JDB an die Zielanwendung.

## **Code zur Laufzeit einschleusen**
- Die Ausnutzung wurde durch das Setzen von Breakpoints und die Kontrolle des Anwendungsflusses durchgef√ºhrt.
- Befehle wie `classes` und `methods <Klassenname>` wurden verwendet, um die Struktur der Anwendung aufzudecken.
- Ein Breakpoint wurde in der Methode `onClick` gesetzt und dessen Ausf√ºhrung wurde kontrolliert.
- Die Befehle `locals`, `next` und `set` wurden verwendet, um lokale Variablen zu inspizieren und zu √§ndern, insbesondere die √Ñnderung der Nachricht von "Try Again" zu "Hacked".
- Der modifizierte Code wurde mit dem Befehl `run` ausgef√ºhrt und hat die Ausgabe der Anwendung in Echtzeit erfolgreich ge√§ndert.

Dieses Beispiel zeigt, wie das Verhalten einer debuggbaren Anwendung manipuliert werden kann und verdeutlicht das Potenzial f√ºr komplexere Exploits wie den Zugriff auf die Shell auf dem Ger√§t im Kontext der Anwendung.



## Referenzen
* [https://medium.com/@shubhamsonani/hacking-with-precision-bypass-techniques-via-debugger-in-android-apps-27fd562b2cc0](https://medium.com/@shubhamsonani/hacking-with-precision-bypass-techniques-via-debugger-in-android-apps-27fd562b2cc0)
* [https://resources.infosecinstitute
