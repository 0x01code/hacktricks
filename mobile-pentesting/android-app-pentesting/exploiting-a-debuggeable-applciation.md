# Explorando uma aplica√ß√£o depur√°vel

<details>

<summary><strong>Aprenda hacking no AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ quer ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**material oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao grupo** üí¨ [**Discord**](https://discord.gg/hRep4RUj7f) ou ao grupo [**telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios do GitHub** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## **Burlando verifica√ß√µes de root e depur√°vel**

**Esta se√ß√£o do post √© um resumo do post** [**https://medium.com/@shubhamsonani/hacking-with-precision-bypass-techniques-via-debugger-in-android-apps-27fd562b2cc0**](https://medium.com/@shubhamsonani/hacking-with-precision-bypass-techniques-via-debugger-in-android-apps-27fd562b2cc0)

### Tornar o app depur√°vel e execut√°-lo aguardando um depurador

Passo 1 ‚Äî Decompilar o APK usando a ferramenta APK-GUI. Editar o arquivo _android-manifest_ e adicionar _**android:debuggable=true**,_ para tornar a aplica√ß√£o depur√°vel. Recompilar, assinar e alinhar o aplicativo com zipalign.

Passo 2 ‚Äî Instalar a aplica√ß√£o via -

_**adb install \<nome_da_aplica√ß√£o>**._

Passo 3 ‚Äî Obter o nome do pacote usando _-_

_**adb shell pm list packages ‚Äì3**_ (para listar as aplica√ß√µes de terceiros).

Passo 4 ‚Äî Agora fa√ßa a aplica√ß√£o aguardar pelo depurador atrav√©s deste comando ‚Äî _**adb shell am setup-debug-app ‚Äìw \<nome_do_pacote>**_.

**Nota ‚Äî** Voc√™ precisar√° executar este comando todas as vezes, antes de iniciar a aplica√ß√£o, para que a aplica√ß√£o aguarde pelo depurador.

Para torn√°-lo persistente, voc√™ pode usar ‚Äì

_**adb shell am setup-debug-app ‚Äìw -‚Äìpersistent \<nome_do_pacote>**._

Para limpar todas as flags ‚Äì

_**adb shell am clear-debug-app \<nome_do_pacote>**._

Passo 5 ‚Äî Abrir o _**Android Studio -> File -> Open Profile or APK**_ -> Abrir o APK recompilado.

Passo 6 ‚Äî Adicionar pontos de interrup√ß√£o aos arquivos java

* _**MainActivity.java ‚Äî m√©todo onCreate, b.java, ContextWrapper.java**_

### Burlar verifica√ß√µes

Em algum momento, o app obter√° informa√ß√µes sobre o app para verificar se √© depur√°vel e tamb√©m procurar√° por alguns bin√°rios para ver se o celular est√° com root. Usando o depurador, √© poss√≠vel alterar as informa√ß√µes do app para desmarcar o bit depur√°vel e tamb√©m mudar os nomes dos bin√°rios procurados, de modo que essas verifica√ß√µes sejam burladas. Por exemplo, para a verifica√ß√£o de depur√°vel:

Passo 1 ‚Äî Na se√ß√£o de vari√°veis do console do depurador, navegue at√© "_**this mLoadedAPK -> mApplicationInfo -> flags = 814267974**_"

<figure><img src="https://miro.medium.com/v2/resize:fit:1400/1*-ckiSbWGSoc1beuxxpKbow.png" alt="" height="192" width="700"><figcaption><p>captura de tela 9</p></figcaption></figure>

_**Nota: flags = 814267974 em bits bin√°rios √© 11000011100111011110. Isso significa que ‚ÄúFlag_debuggable‚Äù est√° definido.**_

Passo 2 ‚Äî Alterar o valor da flag para 814267972. Convers√£o de bits bin√°rios ‚Äî 110000101101000000100010100.

## **Explorando uma vulnerabilidade**

**A parte seguinte do post foi copiada de** [**https://resources.infosecinstitute.com/android-hacking-security-part-6-exploiting-debuggable-android-applications/#article**](https://resources.infosecinstitute.com/android-hacking-security-part-6-exploiting-debuggable-android-applications/#article)

Para tornar este artigo mais interessante, desenvolvi uma aplica√ß√£o vulner√°vel para fins de demonstra√ß√£o, que possui um ‚Äú**bot√£o**‚Äù e um ‚Äú**textview**‚Äú.

Preencha o formul√°rio abaixo para baixar o c√≥digo associado a este artigo.

Se lan√ßarmos a aplica√ß√£o, ela mostra a mensagem ‚Äú**Crack Me**‚Äú.

![](https://resources.infosecinstitute.com/wp-content/uploads/052314_1204_AndroidHack1.png)

Figura 1

Se clicarmos no bot√£o, ele diz ‚Äú**Tente Novamente**‚Äú. Agora, nosso objetivo √© mudar a mensagem ‚ÄúTente Novamente‚Äù para ‚ÄúHackeado‚Äù sem modificar o c√≥digo-fonte da aplica√ß√£o. Para ser preciso, temos que mud√°-lo em tempo de execu√ß√£o.

### **Ferramentas necess√°rias**

* Emulador
* adb ‚Äì Android Debug Bridge
* jdb ‚Äì Java Debugger

No meu caso, para facilitar as instala√ß√µes, estou usando o Android Tamer, pois todas as ferramentas acima necess√°rias j√° est√£o pr√©-instaladas.

### **T√≥picos envolvidos**

* Verifica√ß√£o de Vulnerabilidade.
* Preparando-se com a Configura√ß√£o.
* Inje√ß√£o de C√≥digo em Tempo de Execu√ß√£o.

Vamos come√ßar o jogo.

### **Verifica√ß√£o de vulnerabilidade**

Na verdade, esta √© a parte mais f√°cil de todo o artigo.

* Decompilar a aplica√ß√£o usando `apktool` para obter o arquivo `AndroidManifest.xml` usando o seguinte comando.
```bash
apktool d <vulnerableapp>.apk
```
* Inspecione o arquivo `Androidmanifest.xml` para a seguinte linha.
```bash
android_debuggable="true"
```
Se voc√™ encontrar a linha acima no arquivo AndroidManifest.xml, a aplica√ß√£o √© depur√°vel e pode ser explorada.

**Nota:** Usamos `apktool` para verificar se o aplicativo √© depur√°vel ou n√£o. N√£o vamos tocar ou modificar nenhum trecho de c√≥digo, como mencionado anteriormente.

### **Preparando o ambiente**

Nesta etapa, vamos configurar tudo o que √© necess√°rio para injetar c√≥digo no aplicativo durante sua execu√ß√£o. Como mencionado no artigo anterior, usaremos depura√ß√£o remota neste artigo.

* Inicie seu Emulador
* Instale o aplicativo vulner√°vel
* Abra seu terminal e execute o seguinte comando para ver as portas da Dalvik VM que est√£o ouvindo no emulador.

_**adb jdwp**_

O comando acima exibe todas as portas nas quais podemos conectar e depurar, conforme mostrado abaixo.

![](https://resources.infosecinstitute.com/wp-content/uploads/052314_1204_AndroidHack2.png)

Figura 2

**Nota:** JDWP significa Java Debug Wire Protocol. Se um aplicativo em execu√ß√£o em sua VM √© depur√°vel, ele exp√µe uma porta √∫nica na qual podemos nos conectar usando JDB. Isso √© poss√≠vel em M√°quinas Virtuais Dalvik com suporte de JDWP.

* Agora, inicie nosso aplicativo alvo e execute o mesmo comando para ver a porta de escuta associada ao nosso aplicativo alvo. Parece como mostrado abaixo.

![](https://resources.infosecinstitute.com/wp-content/uploads/052314_1204_AndroidHack3.png)

Figura 2

Se observarmos a diferen√ßa entre a Figura 2 e a Figura 3, h√° uma porta extra 543 ouvindo ap√≥s o lan√ßamento do aplicativo alvo na Figura 3. Vamos anexar o JDB ao aplicativo usando esta porta, j√° que este √© nosso alvo.

* Antes de anexar ao aplicativo, precisamos encaminhar a porta usando adb, pois estamos usando depura√ß√£o remota. Isso √© mostrado na Figura 4.

![](https://resources.infosecinstitute.com/wp-content/uploads/052314_1204_AndroidHack4.png)

Figura 4

* Agora, vamos anexar o JDB ao aplicativo conforme mostrado na figura a seguir.

![](https://resources.infosecinstitute.com/wp-content/uploads/052314_1204_AndroidHack5.png)

Figura 5

### **Inje√ß√£o de c√≥digo em tempo de execu√ß√£o**

Nesta etapa, vamos realmente explorar o aplicativo vulner√°vel modificando seu comportamento em tempo de execu√ß√£o.

Para modificar o comportamento do aplicativo em tempo de execu√ß√£o, precisamos configurar pontos de interrup√ß√£o e controlar o fluxo. Mas, n√£o sabemos quais classes e m√©todos s√£o usados no aplicativo. Ent√£o, vamos usar os seguintes comandos para descobrir as classes e m√©todos usados no aplicativo.

Para encontrar as classes: ‚Äú**classes**‚Äù

![](https://resources.infosecinstitute.com/wp-content/uploads/052314_1204_AndroidHack6.png)

Figura 6.1

Como tenho muitas classes listadas, estou listando apenas algumas. Mas se voc√™ continuar rolando para baixo, ver√° algumas classes definidas pelo usu√°rio interessantes, conforme mostrado na figura abaixo.

![](https://resources.infosecinstitute.com/wp-content/uploads/052314_1204_AndroidHack7.png)

Figura 6.2

Agora, vamos ver os m√©todos associados √† classe MainActivity$1 usando o seguinte comando.

‚Äú_**methods com.example.debug.MainActivity$1**_‚Äù

Isso √© mostrado na figura 7.

![](https://resources.infosecinstitute.com/wp-content/uploads/052314_1204_AndroidHack8.png)

Figura 7

Agora, vamos configurar um ponto de interrup√ß√£o no m√©todo onClick e controlar a execu√ß√£o do aplicativo, conforme mostrado na Figura 8.

_**‚Äústop in com.example.debug.MainActivity$1.onClick(android.view.View)‚Äù**_

![](https://resources.infosecinstitute.com/wp-content/uploads/052314_1204_AndroidHack9.png)

Figura 8

Para atingir o ponto de interrup√ß√£o, teremos que clicar manualmente no bot√£o no aplicativo. Uma vez ap√≥s clicar no bot√£o, o ponto de interrup√ß√£o ser√° atingido e aparecer√° conforme mostrado na Figura 9.

![](https://resources.infosecinstitute.com/wp-content/uploads/052314_1204_AndroidHack10.png)

Figura 9

A partir daqui, poderemos controlar e ver os valores sens√≠veis, argumentos de m√©todos, etc., usando v√°rios comandos.

Apenas para entender o que est√° acontecendo nos bastidores, estou seguindo o c√≥digo associado ao m√©todo onClick, que √© mostrado na Figura 10.

![](https://resources.infosecinstitute.com/wp-content/uploads/052314_1204_AndroidHack11.png)

Figura 10

Antes de prosseguir, vamos ver se h√° alguma vari√°vel local neste ponto usando o comando ‚Äú**locals**‚Äú.

![](https://resources.infosecinstitute.com/wp-content/uploads/052314_1204_AndroidHack12.png)

Figura 11

Como podemos ver, n√£o h√° informa√ß√µes interessantes para n√≥s.

Ent√£o, vamos executar a pr√≥xima linha usando o comando ‚Äú**next**‚Äù, conforme mostrado abaixo.

![](https://resources.infosecinstitute.com/wp-content/uploads/052314_1204_AndroidHack13.png)

Figura 12

Vamos tentar executar o comando ‚Äú**locals**‚Äù novamente para ver o que aconteceu no comando anterior.

![](https://resources.infosecinstitute.com/wp-content/uploads/052314_1204_AndroidHack14.png)

Figura 13

Est√° bastante claro que TextView foi carregado nos argumentos do m√©todo. Se olharmos para o c√≥digo-fonte fornecido na Figura 10, a linha associada √† instancia√ß√£o do TextView foi executada.

Vamos agora executar as pr√≥ximas linhas executando o comando ‚Äú**next**‚Äù e verificar as vari√°veis locais, conforme mostrado na figura abaixo.

![](https://resources.infosecinstitute.com/wp-content/uploads/052314_1204_AndroidHack15.png)

Figura 14

Como podemos ver, todas as vari√°veis locais foram exibidas. A string ‚Äú**secret**‚Äù parece interessante. O valor ‚ÄúTry Again‚Äù √© o que vai ser impresso quando clicarmos no bot√£o.

Da Figura 10, est√° muito claro que o m√©todo **setText** est√° sendo executado para imprimir o valor ‚Äú**Try Again**‚Äú. Ent√£o, vamos usar o comando ‚Äú**step**‚Äù para entrar na defini√ß√£o do m√©todo ‚Äú**setText**‚Äù e modificar dinamicamente o texto a ser impresso.

![](https://resources.infosecinstitute.com/wp-content/uploads/052314_1204_AndroidHack16.png)

Figura 15

Vamos ver as vari√°veis locais dentro da defini√ß√£o usando ‚Äú**locals**‚Äú.

![](https://resources.infosecinstitute.com/wp-content/uploads/052314_1204_AndroidHack17.png)

Figura 16

Agora, vamos mudar o valor de ‚Äú**text**‚Äù de ‚Äú**Try Again**‚Äù para ‚Äú**Hacked**‚Äù usando o comando ‚Äú**set**‚Äù.

![](https://resources.infosecinstitute.com/wp-content/uploads/052314_1204_AndroidHack18.png)

Figura 17

N√£o podemos ver nenhuma mudan√ßa no aplicativo, pois ainda n√£o executamos o c√≥digo modificado.

Ent√£o, vamos executar o aplicativo usando o comando ‚Äú**run**‚Äù, conforme mostrado abaixo, e ver a sa√≠da do aplicativo em sua tela.

![](https://resources.infosecinstitute.com/wp-content/uploads/052314_1204_AndroidHack19.png)

Figura 18

Vamos olhar para o aplicativo em execu√ß√£o no emulador.

![](https://resources.infosecinstitute.com/wp-content/uploads/052314_1204_AndroidHack20.png)

Figura 19

Modificamos com sucesso a sa√≠da do aplicativo em tempo de execu√ß√£o. Este √© apenas um exemplo para mostrar como o comportamento de um aplicativo pode ser modificado se o aplicativo for depur√°vel. Podemos realizar v√°rias outras coisas, incluindo ‚Äú**Obter um shell**‚Äù no dispositivo no contexto do aplicativo vulner√°vel.

<details>

<summary><strong>Aprenda AWS hacking do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras maneiras de apoiar o HackTricks:

* Se voc√™ quiser ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**material oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **Junte-se ao grupo** üí¨ [**Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga** me no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe suas dicas de hacking enviando PRs para os reposit√≥rios** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) no github.

</details>
