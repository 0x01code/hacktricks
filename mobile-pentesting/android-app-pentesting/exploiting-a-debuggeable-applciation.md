# Sfruttare un'applicazione debuggabile

<details>

<summary><strong>Impara l'hacking di AWS da zero a esperto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se vuoi vedere la tua **azienda pubblicizzata su HackTricks** o **scaricare HackTricks in PDF** Controlla i [**PACCHETTI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale di PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**The PEASS Family**](https://opensea.io/collection/the-peass-family), la nostra collezione di [**NFT**](https://opensea.io/collection/the-peass-family) esclusivi
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo Telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR ai repository GitHub di** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

# **Bypassare i controlli di root e debuggabilit√†**

Questa sezione del post √® un riassunto del post [**https://medium.com/@shubhamsonani/hacking-with-precision-bypass-techniques-via-debugger-in-android-apps-27fd562b2cc0**](https://medium.com/@shubhamsonani/hacking-with-precision-bypass-techniques-via-debugger-in-android-apps-27fd562b2cc0)

## Passaggi per rendere un'applicazione Android debuggabile e bypassare i controlli

### **Rendere l'applicazione debuggabile**

Contenuto basato su https://medium.com/@shubhamsonani/hacking-with-precision-bypass-techniques-via-debugger-in-android-apps-27fd562b2cc0

1. **Decompilare l'APK:**
- Utilizzare lo strumento APK-GUI per decompilare l'APK.
- Nel file _android-manifest_, inserire `android:debuggable=true` per abilitare la modalit√† di debug.
- Ricompilare, firmare e zipalignare l'applicazione modificata.

2. **Installare l'applicazione modificata:**
- Utilizzare il comando: `adb install <nome_applicazione>`.

3. **Recuperare il nome del pacchetto:**
- Eseguire `adb shell pm list packages ‚Äì3` per elencare le applicazioni di terze parti e trovare il nome del pacchetto.

4. **Impostare l'applicazione in attesa di una connessione del debugger:**
- Comando: `adb shell am setup-debug-app ‚Äìw <nome_pacchetto>`.
- **Nota:** Questo comando deve essere eseguito ogni volta prima di avviare l'applicazione per assicurarsi che attenda il debugger.
- Per la persistenza, utilizzare `adb shell am setup-debug-app ‚Äìw -‚Äìpersistent <nome_pacchetto>`.
- Per rimuovere tutti i flag, utilizzare `adb shell am clear-debug-app <nome_pacchetto>`.

5. **Prepararsi per il debug in Android Studio:**
- Navigare in Android Studio su _File -> Apri profilo o APK_.
- Aprire l'APK ricompilato.

6. **Impostare i punti di interruzione nei file Java chiave:**
- Posizionare i punti di interruzione in `MainActivity.java` (specificamente nel metodo `onCreate`), `b.java` e `ContextWrapper.java`.

### **Bypassare i controlli**

L'applicazione, in determinati punti, verificher√† se √® debuggabile e controller√† anche la presenza di binari che indicano un dispositivo con root. Il debugger pu√≤ essere utilizzato per modificare le informazioni dell'applicazione, annullare il bit di debuggabilit√† e modificare i nomi dei binari cercati per bypassare questi controlli.

Per il controllo di debuggabilit√†:

1. **Modificare le impostazioni del flag:**
- Nella sezione delle variabili della console del debugger, passare a: `this mLoadedAPK -> mApplicationInfo -> flags = 814267974`.
- **Nota:** La rappresentazione binaria di `flags = 814267974` √® `11000011100111011110`, che indica che il "Flag_debuggable" √® attivo.

![https://miro.medium.com/v2/resize:fit:1400/1*-ckiSbWGSoc1beuxxpKbow.png](https://miro.medium.com/v2/resize:fit:1400/1*-ckiSbWGSoc1beuxxpKbow.png)

Questi passaggi assicurano collettivamente che l'applicazione possa essere debuggata e che determinati controlli di sicurezza possano essere bypassati utilizzando il debugger, facilitando un'analisi o una modifica pi√π approfondita del comportamento dell'applicazione.

Il passaggio 2 prevede la modifica di un valore del flag a 814267972, che √® rappresentato in binario come 110000101101000000100010100.

# **Sfruttare una vulnerabilit√†**

√à stata fornita una dimostrazione utilizzando un'applicazione vulnerabile contenente un pulsante e un textview. Inizialmente, l'applicazione visualizza "Crack Me". L'obiettivo √® modificare il messaggio da "Try Again" a "Hacked" durante l'esecuzione, senza modificare il codice sorgente.

## **Verifica della vulnerabilit√†**
- L'applicazione √® stata decompilata utilizzando `apktool` per accedere al file `AndroidManifest.xml`.
- La presenza di `android_debuggable="true"` in AndroidManifest.xml indica che l'applicazione √® debuggabile e suscettibile di essere sfruttata.
- √à importante notare che `apktool` viene utilizzato esclusivamente per verificare lo stato di debuggabilit√† senza modificare alcun codice.

## **Preparazione dell'ambiente**
- Il processo ha coinvolto l'avvio di un emulatore, l'installazione dell'applicazione vulnerabile e l'utilizzo di `adb jdwp` per identificare le porte Dalvik VM in ascolto.
- JDWP (Java Debug Wire Protocol) consente il debug di un'applicazione in esecuzione in una VM esponendo una porta univoca.
- √à stato necessario l'inoltro delle porte per il debug remoto, seguito dall'attacco di JDB all'applicazione target.

## **Iniezione di codice in tempo di esecuzione**
- Lo sfruttamento √® stato effettuato impostando punti di interruzione e controllando il flusso dell'applicazione.
- Sono stati utilizzati comandi come `classes` e `methods <nome_classe>` per scoprire la struttura dell'applicazione.
- √à stato impostato un punto di interruzione nel metodo `onClick`, e la sua esecuzione √® stata controllata.
- Sono stati utilizzati i comandi `locals`, `next` e `set` per ispezionare e modificare le variabili locali, in particolare cambiando il messaggio "Try Again" in "Hacked".
- Il codice modificato √® stato eseguito utilizzando il comando `run`, modificando con successo l'output dell'applicazione in tempo reale.

Questo esempio ha dimostrato come il comportamento di un'applicazione debuggabile possa essere manipolato, evidenziando il potenziale per exploit pi√π complessi come l'accesso alla shell sul dispositivo nel contesto dell'applicazione.

## Riferimenti
* [https://medium.com/@shubhamsonani/hacking-with-precision-bypass-techniques-via-debugger-in-android-apps-27fd562b2cc0](https://medium.com/@shubhamsonani/hacking-with-precision-bypass-techniques-via-debugger-in-android-apps-27fd562b2cc0)
* [https://resources.infosecinstitute.com/android-hacking-security-part-6-exploiting-debuggable-android-applications](https://resources.infosecinstitute.com/android-hacking-security
