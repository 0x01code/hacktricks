# Teste de Penetra√ß√£o em Aplicativos Android

<details>

<summary><strong>Aprenda a hackear a AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras maneiras de apoiar o HackTricks:

* Se voc√™ deseja ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**swag oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe seus truques de hacking enviando PRs para os reposit√≥rios** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

Junte-se ao servidor [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) para se comunicar com hackers experientes e ca√ßadores de recompensas por bugs!

**Percep√ß√µes de Hacking**\
Engaje-se com conte√∫do que explora a emo√ß√£o e os desafios do hacking

**Not√≠cias de Hacking em Tempo Real**\
Mantenha-se atualizado com o mundo acelerado do hacking por meio de not√≠cias e percep√ß√µes em tempo real

**√öltimos An√∫ncios**\
Fique informado sobre os novos programas de recompensas por bugs lan√ßados e atualiza√ß√µes cruciais na plataforma

**Junte-se a n√≥s no** [**Discord**](https://discord.com/invite/N3FrSbmwdy) e comece a colaborar com os melhores hackers hoje!

## Conceitos B√°sicos de Aplicativos Android

√â altamente recomend√°vel come√ßar lendo esta p√°gina para saber sobre as **partes mais importantes relacionadas √† seguran√ßa do Android e os componentes mais perigosos em um aplicativo Android**:

{% content-ref url="android-applications-basics.md" %}
[android-applications-basics.md](android-applications-basics.md)
{% endcontent-ref %}

## ADB (Android Debug Bridge)

Esta √© a principal ferramenta que voc√™ precisa para se conectar a um dispositivo Android (emulado ou f√≠sico).\
Permite controlar seu dispositivo por **USB** ou **Rede** a partir de um computador, **copiar** arquivos de ida e volta, **instalar** e desinstalar aplicativos, executar comandos **shell**, realizar **backups**, ler **logs** e muito mais.

D√™ uma olhada na seguinte lista de [**Comandos ADB**](adb-commands.md) para aprender como usar o adb.

## Smali

√Äs vezes √© interessante **modificar o c√≥digo do aplicativo** para acessar **informa√ß√µes ocultas** (talvez senhas bem ofuscadas ou flags). Ent√£o, pode ser interessante descompilar o apk, modificar o c√≥digo e recompil√°-lo.\
[Neste tutorial](smali-changes.md) voc√™ pode **aprender como descompilar um APK, modificar o c√≥digo Smali e recompilar o APK** com a nova funcionalidade. Isso pode ser muito √∫til como uma **alternativa para v√°rios testes durante a an√°lise din√¢mica** que ser√£o apresentados. Ent√£o, **mantenha sempre em mente essa possibilidade**.

## Outros truques interessantes

* [Falsificar sua localiza√ß√£o na Play Store](spoofing-your-location-in-play-store.md)
* **Baixar APKs**: [https://apps.evozi.com/apk-downloader/](https://apps.evozi.com/apk-downloader/), [https://apkpure.com/es/](https://apkpure.com/es/), [https://www.apkmirror.com/](https://www.apkmirror.com), [https://apkcombo.com/es-es/apk-downloader/](https://apkcombo.com/es-es/apk-downloader/)
* Extrair APK do dispositivo:
```bash
adb shell pm list packages
com.android.insecurebankv2

adb shell pm path com.android.insecurebankv2
package:/data/app/com.android.insecurebankv2-Jnf8pNgwy3QA_U5f-n_4jQ==/base.apk

adb pull /data/app/com.android.insecurebankv2- Jnf8pNgwy3QA_U5f-n_4jQ==/base.apk
```
## An√°lise Est√°tica

Primeiramente, para analisar um APK voc√™ deve **dar uma olhada no c√≥digo Java** usando um decompilador.\
Por favor, [**leia aqui para encontrar informa√ß√µes sobre diferentes decompiladores dispon√≠veis**](apk-decompilers.md).

### Procurando por Informa√ß√µes Interessantes

Apenas olhando para as **strings** do APK voc√™ pode procurar por **senhas**, **URLs** ([https://github.com/ndelphit/apkurlgrep](https://github.com/ndelphit/apkurlgrep)), chaves de **API**, **criptografia**, **UUIDs de bluetooth**, **tokens** e qualquer coisa interessante... procure at√© por **backdoors** de execu√ß√£o de c√≥digo ou backdoors de autentica√ß√£o (credenciais de administrador codificadas no aplicativo).

**Firebase**

Preste aten√ß√£o especial √†s **URLs do firebase** e verifique se est√£o mal configuradas. [Mais informa√ß√µes sobre o que √© o Firebase e como explor√°-lo aqui.](../../network-services-pentesting/pentesting-web/buckets/firebase-database.md)

### Compreens√£o b√°sica da aplica√ß√£o - Manifest.xml, strings.xml

Usando qualquer um dos **decompiladores** mencionados [**aqui**](apk-decompilers.md) voc√™ poder√° ler o _Manifest.xml_. Voc√™ tamb√©m pode **renomear** a extens√£o do arquivo **apk para .zip** e **descompact√°-lo**.\
Lendo o **manifest** voc√™ pode encontrar **vulnerabilidades**:

* Primeiramente, verifique se **o aplicativo √© depur√°vel**. Um APK de produ√ß√£o n√£o deve ser (ou outros poder√£o se conectar a ele). Voc√™ pode verificar se um aplicativo √© depur√°vel procurando no manifesto pelo atributo `debuggable="true"` dentro da tag _\<application_ Exemplo: `<application theme="@2131296387" debuggable="true"`
* [Aprenda aqui](drozer-tutorial/#is-debuggeable) como encontrar aplicativos depur√°veis em um telefone e explor√°-los
* **Backup**: O atributo **`android:allowBackup`** define se os dados do aplicativo podem ser salvos e restaurados por um usu√°rio que habilitou a depura√ß√£o USB. Se a flag de backup estiver definida como true, permite que um atacante fa√ßa o backup dos dados do aplicativo via adb mesmo que o dispositivo n√£o esteja rooteado. Portanto, aplicativos que lidam e armazenam informa√ß√µes sens√≠veis como detalhes de cart√£o, senhas etc. devem ter essa configura√ß√£o explicitamente definida como **false** porque por padr√£o √© definida como **true** para evitar tais riscos.
* `<application android:allowBackup="false"`
* **NetworkSecurity:** A seguran√ßa de rede do aplicativo pode sobrescrever os valores padr√£o com **`android:networkSecurityConfig="@xml/network_security_config"`**. Um arquivo com esse nome pode ser colocado em _**res/xml.**_ Este arquivo configurar√° configura√ß√µes de seguran√ßa importantes como pins de certificado ou se permite tr√°fego HTTP. Voc√™ pode ler aqui mais informa√ß√µes sobre todas as coisas que podem ser configuradas, mas verifique este exemplo sobre como configurar o tr√°fego HTTP para alguns dom√≠nios:
* `<domain-config cleartextTrafficPermitted="true"> <domain includeSubdomains="true">formation-software.co.uk </domain></domain-config>`
* **Atividades Exportadas**: Verifique as atividades exportadas no manifesto, pois isso pode ser perigoso. Mais tarde na an√°lise din√¢mica ser√° explicado como [voc√™ pode abusar desse comportamento](./#exploiting-exported-activities-authorisation-bypass).
* **Provedores de Conte√∫do**: Se um provedor exportado estiver exposto, voc√™ poder√° acessar/modificar informa√ß√µes interessantes. Na an√°lise din√¢mica [voc√™ aprender√° como abusar deles](./#exploiting-content-providers-accessing-and-manipulating-sensitive-information).
* Verifique as configura√ß√µes de **FileProviders** dentro do atributo `android:name="android.support.FILE_PROVIDER_PATHS"`. [Leia aqui para aprender mais sobre FileProviders](./#fileprovider).
* **Servi√ßos Expostos**: Dependendo do que o servi√ßo est√° fazendo internamente, vulnerabilidades podem ser exploradas. Na an√°lise din√¢mica [voc√™ aprender√° como abusar deles](./#exploiting-services).
* **Receptores de Broadcast**: [Voc√™ aprender√° como possivelmente explor√°-los](./#exploiting-broadcast-receivers) durante a an√°lise din√¢mica.
* **Esquema de URL**: Leia o c√≥digo da atividade que gerencia o esquema e procure por vulnerabilidades no gerenciamento da entrada do usu√°rio. Mais informa√ß√µes sobre [o que √© um esquema de URL aqui](./#url-schemes).
* **minSdkVersion**, **targetSDKVersion**, **maxSdkVersion**: Eles indicam as vers√µes do Android em que o aplicativo ser√° executado. √â importante mant√™-los em mente porque do ponto de vista da seguran√ßa, suportar vers√µes antigas permitir√° que vers√µes vulner√°veis conhecidas do Android o executem.

Lendo **resources.arsc/strings.xml** voc√™ pode encontrar algumas **informa√ß√µes interessantes**:

* Chaves de API
* Esquemas personalizados
* Outras informa√ß√µes interessantes que os desenvolvedores salvam neste arquivo

### Tapjacking

**Tapjacking** √© um ataque onde um **aplicativo malicioso** √© lan√ßado e **se posiciona sobre um aplicativo v√≠tima**. Uma vez que obscurece visualmente o aplicativo v√≠tima, sua interface de usu√°rio √© projetada de forma a enganar o usu√°rio para interagir com ele, enquanto passa a intera√ß√£o para o aplicativo v√≠tima.\
Na pr√°tica, ele **cega o usu√°rio de saber que est√° realmente realizando a√ß√µes no aplicativo v√≠tima**.

Encontre mais informa√ß√µes em:

{% content-ref url="tapjacking.md" %}
[tapjacking.md](tapjacking.md)
{% endcontent-ref %}

### Sequestro de Tarefas

Uma **atividade** com o **`launchMode`** definido como **`singleTask` sem nenhuma `taskAffinity`** definida √© vulner√°vel ao sequestro de tarefas. Isso significa que um **aplicativo** pode ser instalado e, se lan√ßado antes do aplicativo real, poderia **sequestrar a tarefa do aplicativo real** (ent√£o o usu√°rio estar√° interagindo com o **aplicativo malicioso pensando que est√° usando o real**).

Mais informa√ß√µes em:

{% content-ref url="android-task-hijacking.md" %}
[android-task-hijacking.md](android-task-hijacking.md)
{% endcontent-ref %}

### Armazenamento de dados inseguro

**Armazenamento Interno**

No Android, arquivos **armazenados** no **armazenamento interno** s√£o **projetados** para serem **acess√≠veis** exclusivamente pelo **aplicativo** que os **criou**. Essa medida de seguran√ßa √© **imposta** pelo sistema operacional Android e geralmente √© adequada para as necessidades de seguran√ßa da maioria dos aplicativos. No entanto, os desenvolvedores √†s vezes utilizam modos como `MODE_WORLD_READABLE` e `MODE_WORLD_WRITABLE` para **permitir** que arquivos sejam **compartilhados** entre diferentes aplicativos. No entanto, esses modos **n√£o restringem o acesso** a esses arquivos por outros aplicativos, incluindo possivelmente maliciosos.

1. **An√°lise Est√°tica:**
- **Garanta** que o uso de `MODE_WORLD_READABLE` e `MODE_WORLD_WRITABLE` seja **cuidadosamente examinado**. Esses modos **podem potencialmente expor** arquivos a **acessos n√£o intencionais ou n√£o autorizados**.

2. **An√°lise Din√¢mica:**
- **Verifique** as **permiss√µes** definidas nos arquivos criados pelo aplicativo. Especificamente, **verifique** se algum arquivo est√° **definido para ser leg√≠vel ou grav√°vel globalmente**. Isso pode representar um risco significativo √† seguran√ßa, pois permitiria que **qualquer aplicativo** instalado no dispositivo, independentemente de sua origem ou inten√ß√£o, **leia ou modifique** esses arquivos.

**Armazenamento Externo**

### Diretrizes para Gerenciar Arquivos no Armazenamento Externo

Ao lidar com arquivos no **armazenamento externo**, como cart√µes SD, certas precau√ß√µes devem ser tomadas:

1. **Acessibilidade**:
- Arquivos no armazenamento externo s√£o **globalmente leg√≠veis e grav√°veis**. Isso significa que qualquer aplicativo ou usu√°rio pode acessar esses arquivos.

2. **Preocupa√ß√µes de Seguran√ßa**:
- Dada a facilidade de acesso, √© aconselh√°vel **n√£o armazenar informa√ß√µes sens√≠veis** no armazenamento externo.
- O armazenamento externo pode ser removido ou acessado por qualquer aplicativo, tornando-o menos seguro.

3. **Manuseio de Dados do Armazenamento Externo**:
- Sempre **realize valida√ß√£o de entrada** nos dados recuperados do armazenamento externo. Isso √© crucial porque os dados s√£o de uma fonte n√£o confi√°vel.
- Armazenar execut√°veis ou arquivos de classe no armazenamento externo para carregamento din√¢mico √© fortemente desencorajado.
- Se seu aplicativo precisar recuperar arquivos execut√°veis do armazenamento externo, certifique-se de que esses arquivos sejam **assinados e verificados criptograficamente** antes de serem carregados dinamicamente. Esta etapa √© vital para manter a integridade de seguran√ßa do seu aplicativo.

O armazenamento externo pode ser **acessado** em `/storage/emulated/0`, `/sdcard`, `/mnt/sdcard`

{% hint style="info" %}
A partir do Android 4.4 (**API 17**), o cart√£o SD possui uma estrutura de diret√≥rio que **limita o acesso de um aplicativo ao diret√≥rio especificamente para esse aplicativo**. Isso impede que aplicativos maliciosos obtenham acesso de leitura ou grava√ß√£o aos arquivos de outro aplicativo.
{% endhint %}

**Dados sens√≠veis armazenados em texto claro**

* **Prefer√™ncias compartilhadas**: O Android permite que cada aplicativo salve facilmente arquivos xml no caminho `/data/data/<nomedopacote>/shared_prefs/` e √†s vezes √© poss√≠vel encontrar informa√ß√µes sens√≠veis em texto claro nessa pasta.
* **Bancos de dados**: O Android permite que cada aplicativo salve bancos de dados sqlite facilmente no caminho `/data/data/<nomedopacote>/databases/` e √†s vezes √© poss√≠vel encontrar informa√ß√µes sens√≠veis em texto claro nessa pasta.

### TLS Quebrado

**Aceitar Todos os Certificados**

Por algum motivo, √†s vezes os desenvolvedores aceitam todos os certificados mesmo que, por exemplo, o nome do host n√£o corresponda com linhas de c√≥digo como a seguinte:
```java
SSLSocketFactory sf = new cc(trustStore);
sf.setHostnameVerifier(SSLSocketFactory.ALLOW_ALL_HOSTNAME_VERIFIER);
```
### Criptografia Quebrada

**Processos de Gerenciamento de Chave Fracos**

Alguns desenvolvedores salvam dados sens√≠veis no armazenamento local e os criptografam com uma chave codificada/previs√≠vel no c√≥digo. Isso n√£o deve ser feito, pois a revers√£o pode permitir que os atacantes extraiam as informa√ß√µes confidenciais.

**Uso de Algoritmos Inseguros e/ou Obsoletos**

Os desenvolvedores n√£o devem usar algoritmos **obsoletos** para realizar **verifica√ß√µes** de **autoriza√ß√£o**, **armazenar** ou **enviar** dados. Alguns desses algoritmos s√£o: RC4, MD4, MD5, SHA1... Se **hashes** forem usados para armazenar senhas, por exemplo, hashes resistentes a **ataques de for√ßa bruta** devem ser usados com salt.

### Outras verifica√ß√µes

* √â recomendado **ofuscar o APK** para dificultar o trabalho de engenharia reversa para os atacantes.
* Se o aplicativo for sens√≠vel (como aplicativos banc√°rios), ele deve realizar suas **pr√≥prias verifica√ß√µes para ver se o dispositivo m√≥vel est√° rooteado** e agir em conformidade.
* Se o aplicativo for sens√≠vel (como aplicativos banc√°rios), ele deve verificar se est√° sendo usado um **emulador**.
* Se o aplicativo for sens√≠vel (como aplicativos banc√°rios), ele deve **verificar sua pr√≥pria integridade antes de execut√°-lo** para verificar se foi modificado.
* Use [**APKiD**](https://github.com/rednaga/APKiD) para verificar qual compilador/packer/ofuscador foi usado para construir o APK

### Aplicativo React Native

Leia a seguinte p√°gina para aprender como acessar facilmente o c√≥digo JavaScript de aplicativos React:

{% content-ref url="react-native-application.md" %}
[react-native-application.md](react-native-application.md)
{% endcontent-ref %}

### Aplicativos Xamarin

Leia a seguinte p√°gina para aprender como acessar facilmente o c√≥digo C# de aplicativos Xamarin:

{% content-ref url="../xamarin-apps.md" %}
[xamarin-apps.md](../xamarin-apps.md)
{% endcontent-ref %}

### Aplicativos Supercompactados

De acordo com este [**post de blog**](https://clearbluejar.github.io/posts/desuperpacking-meta-superpacked-apks-with-github-actions/), supercompactado √© um algoritmo Meta que comprime o conte√∫do de um aplicativo em um √∫nico arquivo. O blog fala sobre a possibilidade de criar um aplicativo que descomprima esse tipo de aplicativo... e uma maneira mais r√°pida que envolve **executar o aplicativo e reunir os arquivos descompactados do sistema de arquivos**.

### An√°lise Est√°tica Automatizada de C√≥digo

A ferramenta [**mariana-trench**](https://github.com/facebook/mariana-trench) √© capaz de encontrar **vulnerabilidades** escaneando o **c√≥digo** do aplicativo. Esta ferramenta cont√©m uma s√©rie de **fontes conhecidas** (que indicam √† ferramenta os **locais** onde a **entrada** √© **controlada pelo usu√°rio**), **sinks** (que indicam √† ferramenta **locais perigosos** onde a entrada maliciosa do usu√°rio poderia causar danos) e **regras**. Essas regras indicam a **combina√ß√£o** de **fontes-sinks** que indicam uma vulnerabilidade.

Com esse conhecimento, **mariana-trench revisar√° o c√≥digo e encontrar√° poss√≠veis vulnerabilidades nele**.

### Segredos vazados

Um aplicativo pode conter segredos (chaves de API, senhas, URLs ocultas, subdom√≠nios...) que voc√™ pode descobrir. Voc√™ pode usar uma ferramenta como [https://github.com/dwisiswant0/apkleaks](https://github.com/dwisiswant0/apkleaks)

### Bypass na Autentica√ß√£o Biom√©trica

{% content-ref url="bypass-biometric-authentication-android.md" %}
[bypass-biometric-authentication-android.md](bypass-biometric-authentication-android.md)
{% endcontent-ref %}

### Outras fun√ß√µes interessantes

* **Execu√ß√£o de c√≥digo**: `Runtime.exec(), ProcessBuilder(), c√≥digo nativo:system()`
* **Enviar SMS**: `sendTextMessage, sendMultipartTestMessage`
* **Fun√ß√µes nativas** declaradas como `native`: `public native, System.loadLibrary, System.load`
* [Leia isso para aprender **como reverter fun√ß√µes nativas**](reversing-native-libraries.md)

### **Outros truques**

{% content-ref url="content-protocol.md" %}
[content-protocol.md](content-protocol.md)
{% endcontent-ref %}

***

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

Junte-se ao servidor [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) para se comunicar com hackers experientes e ca√ßadores de bugs!

**Percep√ß√µes de Hacking**\
Engaje-se com conte√∫do que explora a emo√ß√£o e os desafios do hacking

**Not√≠cias de Hacking em Tempo Real**\
Mantenha-se atualizado com o mundo acelerado do hacking por meio de not√≠cias e percep√ß√µes em tempo real

**√öltimos An√∫ncios**\
Fique informado sobre os mais novos programas de recompensas por bugs lan√ßados e atualiza√ß√µes cruciais na plataforma

**Junte-se a n√≥s no** [**Discord**](https://discord.com/invite/N3FrSbmwdy) e comece a colaborar com os melhores hackers hoje!

***

## An√°lise Din√¢mica

> Primeiramente, voc√™ precisa de um ambiente onde possa instalar o aplicativo e todo o ambiente (certificado Burp CA, Drozer e Frida principalmente). Portanto, um dispositivo com root (emulado ou n√£o) √© extremamente recomendado.

### An√°lise Din√¢mica Online

Voc√™ pode criar uma **conta gratuita** em: [https://appetize.io/](https://appetize.io). Essa plataforma permite que voc√™ **fa√ßa upload** e **execute** APKs, sendo √∫til para ver como um APK est√° se comportando.

Voc√™ pode at√© **ver os logs do seu aplicativo** na web e se conectar por meio de **adb**.

![](<../../.gitbook/assets/image (60).png>)

Gra√ßas √† conex√£o ADB, voc√™ pode usar **Drozer** e **Frida** nos emuladores.

### An√°lise Din√¢mica Local

#### Usando um emulador

* [**Android Studio**](https://developer.android.com/studio) (Voc√™ pode criar dispositivos **x86** e **arm**, e de acordo com [**este** ](https://android-developers.googleblog.com/2020/03/run-arm-apps-on-android-emulator.html)**√∫ltimo x86** vers√µes **suportam bibliotecas ARM** sem precisar de um emulador ARM lento).
* Aprenda a configur√°-lo nesta p√°gina:

{% content-ref url="avd-android-virtual-device.md" %}
[avd-android-virtual-device.md](avd-android-virtual-device.md)
{% endcontent-ref %}

* [**Genymotion**](https://www.genymotion.com/fun-zone/) **(Vers√£o gratuita:** Personal Edition, voc√™ precisa criar uma conta. _√â recomendado **baixar** a vers√£o **COM**_ _**VirtualBox** para evitar erros potenciais._)
* [**Nox**](https://es.bignox.com) (Gratuito, mas n√£o suporta Frida ou Drozer).

{% hint style="info" %}
Ao criar um novo emulador em qualquer plataforma, lembre-se de que quanto maior a tela, mais lento o emulador funcionar√°. Portanto, selecione telas pequenas, se poss√≠vel.
{% endhint %}

Para **instalar servi√ßos do Google** (como a Play Store) no Genymotion, voc√™ precisa clicar no bot√£o marcado em vermelho na seguinte imagem:

![](<../../.gitbook/assets/image (200) (1).png>)

Al√©m disso, observe que na **configura√ß√£o da VM Android no Genymotion** voc√™ pode selecionar o **modo de rede Bridge** (isso ser√° √∫til se voc√™ for conectar √† VM Android de uma VM diferente com as ferramentas).

#### Usar um dispositivo f√≠sico

Voc√™ precisa ativar as op√ß√µes de **depura√ß√£o** e ser√° √≥timo se voc√™ puder **rootear**:

1. **Configura√ß√µes**.
2. (A partir do Android 8.0) Selecione **Sistema**.
3. Selecione **Sobre o telefone**.
4. Pressione **N√∫mero da vers√£o** 7 vezes.
5. Volte e voc√™ encontrar√° as **Op√ß√µes do desenvolvedor**.

> Depois de instalar o aplicativo, a primeira coisa que voc√™ deve fazer √© test√°-lo e investigar o que ele faz, como funciona e se familiarizar com ele.\
> Sugiro **realizar esta an√°lise din√¢mica inicial usando a an√°lise din√¢mica do MobSF + pidcat**, para que possamos **aprender como o aplicativo funciona** enquanto o MobSF **captura** muitos **dados interessantes** que voc√™ pode revisar posteriormente.

### Vazamento de Dados N√£o Intencionais

**Logging**

Frequentemente, os desenvolvedores deixam informa√ß√µes de depura√ß√£o publicamente. Portanto, qualquer aplicativo com permiss√£o `READ_LOGS` pode **acessar esses logs** e obter informa√ß√µes sens√≠veis por meio deles.\
Ao navegar pelo aplicativo, use [**pidcat**](https://github.com/JakeWharton/pidcat)_(Recomendado, √© mais f√°cil de usar e ler)_ ou [adb logcat](adb-commands.md#logcat) para ler os logs criados e **procurar por informa√ß√µes sens√≠veis**.

{% hint style="warning" %}
Observe que a partir das **vers√µes posteriores ao Android 4.0**, **os aplicativos s√≥ podem acessar seus pr√≥prios logs**. Portanto, os aplicativos n√£o podem acessar os logs de outros aplicativos.\
De qualquer forma, ainda √© recomendado **n√£o registrar informa√ß√µes sens√≠veis**.
{% endhint %}

**Armazenamento de Buffer de C√≥pia/Colagem em Cache**

O Android fornece um **framework baseado em √°rea de transfer√™ncia** para fornecer a fun√ß√£o de c√≥pia/colagem em aplicativos Android. Mas isso cria um problema s√©rio quando algum **outro aplicativo** pode **acessar** a **√°rea de transfer√™ncia** que cont√©m alguns dados sens√≠veis. A fun√ß√£o de **c√≥pia/colagem** deve ser **desativada** para a **parte sens√≠vel** do aplicativo. Por exemplo, desative a c√≥pia de detalhes do cart√£o de cr√©dito.

**Logs de Falhas**

Se um aplicativo **falhar** durante a execu√ß√£o e salvar logs em algum lugar, esses logs podem ser √∫teis para um atacante, especialmente nos casos em que o aplicativo Android n√£o pode ser engenhado reversamente. Em seguida, evite criar logs quando os aplicativos falham e, se os logs forem enviados pela rede, certifique-se de que sejam enviados por um canal SSL.\
Como testador de penetra√ß√£o, **tente dar uma olhada nesses logs**.

**Dados Anal√≠ticos Enviados a Terceiros**

A maioria dos aplicativos usa outros servi√ßos em seus aplicativos, como o Google AdSense, mas √†s vezes eles **vazam alguns dados sens√≠veis** ou dados que n√£o precisam ser enviados para esse servi√ßo. Isso pode acontecer porque o desenvolvedor n√£o implementou o recurso corretamente. Voc√™ pode **verificando a intercepta√ß√£o do tr√°fego** do aplicativo e ver se algum dado sens√≠vel est√° sendo enviado para terceiros ou n√£o.

### Bancos de Dados SQLite

A maioria dos aplicativos usar√° **bancos de dados SQLite internos** para salvar informa√ß√µes. Durante o teste de penetra√ß√£o, d√™ uma **olhada** nos **bancos de dados** criados, nos nomes das **tabelas** e **colunas** e em todos os **dados** salvos, pois voc√™ pode encontrar **informa√ß√µes sens√≠veis** (o que seria uma vulnerabilidade).\
Os bancos de dados devem estar localizados em `/data/data/o.nome.do.pacote/bancos de dados` como `/data/data/com.mwr.example.sieve/bancos de dados`

Se o banco de dados estiver salvando informa√ß√µes confidenciais e estiver **criptografado** mas voc√™ pode **encontrar** a **senha** dentro do aplicativo, ainda √© uma **vulnerabilidade**.

Enumere as tabelas usando `.tables` e enumere as colunas das tabelas fazendo `.schema <nome_da_tabela>`

### Drozer (Atividades de Explora√ß√£o, Provedores de Conte√∫do e Servi√ßos)

**Drozer** permite que voc√™ **assuma o papel de um aplicativo Android** e interaja com outros aplicativos. Ele pode fazer **qualquer coisa que um aplicativo instalado possa fazer**, como fazer uso do mecanismo de Comunica√ß√£o entre Processos (IPC) do Android e interagir com o sistema operacional subjacente. Do [Guia do Drozer](https://labs.mwrinfosecurity.com/assets/BlogFiles/mwri-drozer-user-guide-2015-03-23.pdf).\
Drozer √© uma ferramenta √∫til para **explorar atividades exportadas, servi√ßos exportados e Provedores de Conte√∫do**, como voc√™ aprender√° nas se√ß√µes a seguir.

### Explorando Atividades Exportadas

[**Leia isso se quiser relembrar o que √© uma Atividade Android.**](android-applications-basics.md#launcher-activity-and-other-activities)\
Lembre-se tamb√©m de que o c√≥digo de uma atividade come√ßa com o m√©todo `onCreate`.

**Bypass de Autoriza√ß√£o**

Quando uma Atividade √© exportada, voc√™ pode invocar sua tela de um aplicativo externo. Portanto, se uma atividade com **informa√ß√µes sens√≠veis** for **exportada**, voc√™ poderia **burlar** os **mecanismos de autentica√ß√£o** para acess√°-la.\
[**Aprenda como explorar atividades exportadas com Drozer.**](drozer-tutorial/#activities)

Voc√™ tamb√©m pode iniciar uma atividade exportada a partir do adb:

* PackageName √© com.example.demo
* Nome da Atividade Exportada √© com.example.test.MainActivity
```bash
adb shell am start -n com.example.demo/com.example.test.MainActivity
```
**NOTA**: O MobSF detectar√° como malicioso o uso de _**singleTask/singleInstance**_ como `android:launchMode` em uma atividade, mas devido a [este](https://github.com/MobSF/Mobile-Security-Framework-MobSF/pull/750), aparentemente isso √© perigoso apenas em vers√µes antigas (vers√µes de API < 21).

{% hint style="info" %}
Note que uma viola√ß√£o de autoriza√ß√£o nem sempre √© uma vulnerabilidade, isso depender√° de como a viola√ß√£o funciona e quais informa√ß√µes s√£o expostas.
{% endhint %}

**Vazamento de informa√ß√µes sens√≠veis**

**As atividades tamb√©m podem retornar resultados**. Se voc√™ conseguir encontrar uma atividade exportada e desprotegida chamando o m√©todo **`setResult`** e **retornando informa√ß√µes sens√≠veis**, h√° um vazamento de informa√ß√µes sens√≠veis.

#### Tapjacking

Se o tapjacking n√£o for prevenido, voc√™ poderia abusar da atividade exportada para fazer o **usu√°rio realizar a√ß√µes inesperadas**. Para mais informa√ß√µes sobre [**o que √© Tapjacking, siga o link**](./#tapjacking).

### Explorando Provedores de Conte√∫do - Acessando e manipulando informa√ß√µes sens√≠veis

[**Leia isso se quiser relembrar o que √© um Provedor de Conte√∫do.**](android-applications-basics.md#content-provider)\
Os provedores de conte√∫do s√£o basicamente usados para **compartilhar dados**. Se um aplicativo tiver provedores de conte√∫do dispon√≠veis, voc√™ pode ser capaz de **extrair dados sens√≠veis** deles. Tamb√©m √© interessante testar poss√≠veis **inje√ß√µes de SQL** e **travessias de caminho** pois eles podem ser vulner√°veis.\
[**Aprenda como explorar Provedores de Conte√∫do com o Drozer.**](drozer-tutorial/#content-providers)

### **Explorando Servi√ßos**

[**Leia isso se quiser relembrar o que √© um Servi√ßo.**](android-applications-basics.md#services)\
Lembre-se que as a√ß√µes de um Servi√ßo come√ßam no m√©todo `onStartCommand`.

Um servi√ßo √© basicamente algo que **pode receber dados**, **process√°-los** e **retornar** (ou n√£o) uma resposta. Ent√£o, se um aplicativo estiver exportando alguns servi√ßos, voc√™ deve **verificar** o **c√≥digo** para entender o que ele est√° fazendo e **test√°-lo** **dinamicamente** para extrair informa√ß√µes confidenciais, burlar medidas de autentica√ß√£o...\
[**Aprenda como explorar Servi√ßos com o Drozer.**](drozer-tutorial/#services)

### **Explorando Receptores de Transmiss√£o**

[**Leia isso se quiser relembrar o que √© um Receptor de Transmiss√£o.**](android-applications-basics.md#broadcast-receivers)\
Lembre-se que as a√ß√µes de um Receptor de Transmiss√£o come√ßam no m√©todo `onReceive`.

Um receptor de transmiss√£o estar√° aguardando por um tipo de mensagem. Dependendo de como o receptor lida com a mensagem, ele pode ser vulner√°vel.\
[**Aprenda como explorar Receptores de Transmiss√£o com o Drozer.**](./#exploiting-broadcast-receivers)

### **Explorando Esquemas / Links Profundos**

Voc√™ pode procurar links profundos manualmente, usando ferramentas como o MobSF ou scripts como [este](https://github.com/ashleykinguk/FBLinkBuilder/blob/master/FBLinkBuilder.py).\
Voc√™ pode **abrir** um **esquema** declarado usando **adb** ou um **navegador**:

{% code overflow="wrap" %}
```bash
adb shell am start -a android.intent.action.VIEW -d "scheme://hostname/path?param=value" [your.package.name]
```
{% endcode %}

_Observe que voc√™ pode **omitir o nome do pacote** e o celular chamar√° automaticamente o aplicativo que deve abrir o link._

{% code overflow="wrap" %}
```markup
<!-- Browser regular link -->
<a href="scheme://hostname/path?param=value">Click me</a>
<!-- fallback in your url you could try the intent url -->
<a href="intent://hostname#Intent;scheme=scheme;package=your.package.name;S.browser_fallback_url=http%3A%2F%2Fwww.example.com;end">with alternative</a>
```
{% endcode %}

**C√≥digo executado**

Para encontrar o **c√≥digo que ser√° executado no aplicativo**, v√° para a atividade chamada pelo deeplink e procure a fun√ß√£o **`onNewIntent`**.

![](<../../.gitbook/assets/image (436) (1) (1) (1).png>)

**Informa√ß√µes sens√≠veis**

Sempre que encontrar um deep link, verifique se **n√£o est√° recebendo dados sens√≠veis (como senhas) por meio de par√¢metros de URL**, pois qualquer outro aplicativo poderia **fingir ser o deep link e roubar esses dados!**

**Par√¢metros no caminho**

Voc√™ **tamb√©m deve verificar se algum deep link est√° usando um par√¢metro dentro do caminho** do URL, como: `https://api.example.com/v1/users/{username}`, nesse caso voc√™ pode for√ßar uma travessia de caminho acessando algo como: `example://app/users?username=../../unwanted-endpoint%3fparam=value`.\
Observe que se voc√™ encontrar os endpoints corretos dentro do aplicativo, poder√° causar um **Redirecionamento Aberto** (se parte do caminho for usada como nome de dom√≠nio), **assumir o controle da conta** (se puder modificar detalhes dos usu√°rios sem token CSRF e o endpoint vulner√°vel usar o m√©todo correto) e qualquer outra vulnerabilidade. Mais [informa√ß√µes sobre isso aqui](http://dphoeniixx.com/2020/12/13-2/).

**Mais exemplos**

Um [relat√≥rio interessante de recompensa por bugs](https://hackerone.com/reports/855618) sobre links (_/.well-known/assetlinks.json_).

### Prote√ß√£o Insuficiente da Camada de Transporte

* **Falta de Inspe√ß√£o de Certificado:** O aplicativo Android falha em verificar a identidade do certificado apresentado a ele. A maioria dos aplicativos ignora os avisos e aceita qualquer certificado autoassinado apresentado. Alguns aplicativos, em vez disso, passam o tr√°fego por uma conex√£o HTTP.
* **Negocia√ß√£o de Aperto de M√£o Fraca:** Aplicativo e servidor realizam um aperto de m√£o SSL/TLS, mas usam uma su√≠te de cifras insegura que √© vulner√°vel a ataques MITM. Assim, qualquer atacante pode facilmente descriptografar essa conex√£o.
* **Vazamento de Informa√ß√µes de Privacidade:** Na maioria das vezes, acontece que os aplicativos fazem autentica√ß√£o por meio de um canal seguro, mas todas as outras conex√µes por meio de um canal n√£o seguro. Isso n√£o adiciona seguran√ßa ao aplicativo, pois outros dados sens√≠veis, como cookie de sess√£o ou dados do usu√°rio, podem ser interceptados por um usu√°rio malicioso.

Dos 3 cen√°rios apresentados, vamos discutir **como verificar a identidade do certificado**. Os outros 2 cen√°rios dependem da **configura√ß√£o do TLS** do servidor e se o **aplicativo envia dados n√£o criptografados**. O testador deve verificar por conta pr√≥pria a configura√ß√£o do TLS do servidor ([aqui](../../network-services-pentesting/pentesting-web/#ssl-tls-vulnerabilites)) e detectar se alguma **informa√ß√£o confidencial √© enviada por um canal n√£o criptografado/vulner√°vel**.\
Mais informa√ß√µes sobre como descobrir e corrigir esse tipo de vulnerabilidades [**aqui**](https://manifestsecurity.com/android-application-security-part-10/).

**SSL Pinning**

Por padr√£o, ao fazer uma conex√£o SSL, o cliente (aplicativo Android) verifica se o certificado do servidor tem uma cadeia de confian√ßa verific√°vel at√© um certificado confi√°vel (raiz) e corresponde ao nome do host solicitado. Isso leva ao problema de **Ataques Man-in-the-Middle (MITM)**.\
No Pinning de certificado, um aplicativo Android cont√©m o certificado do servidor e s√≥ transmite dados se o mesmo certificado for apresentado.\
√â recomend√°vel **aplicar o SSL Pinning** para os sites onde informa√ß√µes sens√≠veis ser√£o enviadas.

### Inspe√ß√£o de tr√°fego HTTP

Antes de tudo, voc√™ deve (deve) **instalar o certificado** da **ferramenta de proxy** que voc√™ vai usar, provavelmente o Burp. Se voc√™ n√£o instalar o certificado CA da ferramenta de proxy, provavelmente n√£o ver√° o tr√°fego criptografado no proxy.\
**Por favor,** [**leia este guia para aprender como instalar um certificado CA personalizado**](avd-android-virtual-device.md#install-burp-certificate-on-a-virtual-machine)**.**

Para aplicativos direcionados ao **N√≠vel de API 24+ n√£o √© suficiente instalar o certificado CA do Burp** no dispositivo. Para contornar essa nova prote√ß√£o, voc√™ precisa modificar o arquivo de Configura√ß√£o de Seguran√ßa de Rede. Portanto, voc√™ pode modificar este arquivo para autorizar seu certificado CA ou pode [**ler esta p√°gina para um tutorial sobre como for√ßar o aplicativo a aceitar novamente todos os certificados instalados no dispositivo**](make-apk-accept-ca-certificate.md).

**SSL Pinning**

J√° discutimos o que √© SSL Pinning apenas 2 par√°grafos antes. Quando implementado em um aplicativo, voc√™ precisar√° contorn√°-lo para inspecionar o tr√°fego HTTPS ou n√£o o ver√°.\
Aqui vou apresentar algumas op√ß√µes que usei para contornar essa prote√ß√£o:

* **Modificar automaticamente** o **apk** para **contornar** o SSLPinning com [**apk-mitm**](https://github.com/shroudedcode/apk-mitm). A maior vantagem dessa op√ß√£o √© que voc√™ n√£o precisar√° de root para contornar o SSL Pinning, mas precisar√° excluir o aplicativo e reinstalar o novo, e isso nem sempre funcionar√°.
* Voc√™ pode usar o **Frida** (discutido abaixo) para contornar essa prote√ß√£o. Aqui est√° um guia para usar Burp+Frida+Genymotion: [https://spenkk.github.io/bugbounty/Configuring-Frida-with-Burp-and-GenyMotion-to-bypass-SSL-Pinning/](https://spenkk.github.io/bugbounty/Configuring-Frida-with-Burp-and-GenyMotion-to-bypass-SSL-Pinning/)
* Voc√™ tamb√©m pode tentar **contornar automaticamente o SSL Pinning** usando [**objection**](frida-tutorial/objection-tutorial.md)**:** `objection --gadget com.package.app explore --startup-command "android sslpinning disable"`
* Voc√™ tamb√©m pode tentar **contornar automaticamente o SSL Pinning** usando **an√°lise din√¢mica do MobSF** (explicado abaixo)
* Se voc√™ ainda acha que h√° algum tr√°fego que n√£o est√° capturando, pode tentar **encaminhar o tr√°fego para o burp usando iptables**. Leia este blog: [https://infosecwriteups.com/bypass-ssl-pinning-with-ip-forwarding-iptables-568171b52b62](https://infosecwriteups.com/bypass-ssl-pinning-with-ip-forwarding-iptables-568171b52b62)

**Vulnerabilidades Web Comuns**

Observe que nesta etapa voc√™ deve procurar por vulnerabilidades web comuns. Muitas informa√ß√µes sobre vulnerabilidades web podem ser encontradas neste livro, ent√£o n√£o vou mencion√°-las aqui.

### Frida

Ferramenta de instrumenta√ß√£o din√¢mica para desenvolvedores, engenheiros reversos e pesquisadores de seguran√ßa. Saiba mais em [www.frida.re](https://www.frida.re).\
**√â incr√≠vel, voc√™ pode acessar o aplicativo em execu√ß√£o e enganchar m√©todos em tempo de execu√ß√£o para alterar o comportamento, alterar valores, extrair valores, executar c√≥digo diferente...**\
**Se voc√™ deseja fazer pentest em aplicativos Android, precisa saber como usar o Frida.**

**Aprenda a usar o Frida:** [**Tutorial do Frida**](frida-tutorial/)\
**Algum "GUI" para a√ß√µes com o Frida:** [**https://github.com/m0bilesecurity/RMS-Runtime-Mobile-Security**](https://github.com/m0bilesecurity/RMS-Runtime-Mobile-Security)\
**Algumas outras abstra√ß√µes baseadas no Frida:** [**https://github.com/sensepost/objection**](https://github.com/sensepost/objection) **,** [**https://github.com/dpnishant/appmon**](https://github.com/dpnishant/appmon)\
**Voc√™ pode encontrar alguns scripts incr√≠veis do Frida aqui:** [**https://codeshare.frida.re/**](https://codeshare.frida.re)

### **Despejar Mem√≥ria - Fridump**

Verifique se o aplicativo est√° armazenando informa√ß√µes sens√≠veis na mem√≥ria que n√£o deveria estar armazenando, como senhas ou mnem√¥nicos.

Usando [**Fridump3**](https://github.com/rootbsd/fridump3) voc√™ pode despejar a mem√≥ria do aplicativo com:
```bash
# With PID
python3 fridump3.py -u <PID>

# With name
frida-ps -Uai
python3 fridump3.py -u "<Name>"
```
Isso ir√° despejar a mem√≥ria na pasta ./dump e l√° voc√™ poder√° usar o grep com algo como:

{% code overflow="wrap" %}
```bash
strings * | grep -E "^[a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+$"
```
{% endcode %}

### **Dados sens√≠veis no Keystore**

No Android, o Keystore √© o melhor lugar para armazenar dados sens√≠veis, no entanto, com privil√©gios suficientes ainda √© **poss√≠vel acess√°-lo**. Como os aplicativos tendem a armazenar aqui **dados sens√≠veis em texto claro**, os testes de penetra√ß√£o devem verificar isso, pois um usu√°rio root ou algu√©m com acesso f√≠sico ao dispositivo poderia roubar esses dados.

Mesmo que um aplicativo armazene dados no keystore, os dados devem estar criptografados.

Para acessar os dados dentro do keystore, voc√™ pode usar este script Frida: [https://github.com/WithSecureLabs/android-keystore-audit/blob/master/frida-scripts/tracer-cipher.js](https://github.com/WithSecureLabs/android-keystore-audit/blob/master/frida-scripts/tracer-cipher.js)
```bash
frida -U -f com.example.app -l frida-scripts/tracer-cipher.js
```
### **Bypass de Impress√£o Digital/Biometria**

Usando o seguinte script do Frida, poderia ser poss√≠vel **burlar a autentica√ß√£o por impress√£o digital** que aplicativos Android podem estar realizando para **proteger √°reas sens√≠veis espec√≠ficas:**

{% code overflow="wrap" %}
```bash
frida --codeshare krapgras/android-biometric-bypass-update-android-11 -U -f <app.package>
```
{% endcode %}

### **Imagens de Fundo**

Quando voc√™ coloca um aplicativo em segundo plano, o Android armazena um **instant√¢neo do aplicativo** para que, quando ele for recuperado para o primeiro plano, comece a carregar a imagem antes do aplicativo, fazendo com que pare√ßa que o aplicativo foi carregado mais rapidamente.

No entanto, se esse instant√¢neo contiver **informa√ß√µes sens√≠veis**, algu√©m com acesso a ele poder√° **roubar essas informa√ß√µes** (observe que √© necess√°rio ter acesso root para acess√°-lo).

Os instant√¢neos geralmente s√£o armazenados em: **`/data/system_ce/0/snapshots`**

O Android fornece uma maneira de **prevenir a captura de tela definindo o par√¢metro de layout FLAG\_SECURE**. Ao usar essa flag, o conte√∫do da janela √© tratado como seguro, impedindo que ele apare√ßa em capturas de tela ou seja visualizado em displays n√£o seguros.
```bash
getWindow().setFlags(LayoutParams.FLAG_SECURE, LayoutParams.FLAG_SECURE);
```
### **Analisador de Aplicativos Android**

Esta ferramenta pode ajud√°-lo a gerenciar diferentes ferramentas durante a an√°lise din√¢mica: [https://github.com/NotSoSecure/android\_application\_analyzer](https://github.com/NotSoSecure/android\_application\_analyzer)

### Inje√ß√£o de Intent

Essa vulnerabilidade se assemelha ao **Redirecionamento Aberto na seguran√ßa web**. Como a classe `Intent` √© `Parcelable`, **objetos pertencentes a essa classe** podem ser **passados** como **dados extras** em outro objeto `Intent`.\
Muitos desenvolvedores fazem **uso** desse **recurso** e criam **componentes proxy** (atividades, receptores de transmiss√£o e servi√ßos) que **recebem um Intent incorporado e o passam para m√©todos perigosos** como `startActivity(...)`, `sendBroadcast(...)`, etc.\
Isso √© perigoso porque **um atacante pode for√ßar o aplicativo a iniciar um componente n√£o exportado que n√£o pode ser iniciado diretamente por outro aplicativo**, ou conceder ao atacante acesso aos seus provedores de conte√∫do. **`WebView`** √†s vezes tamb√©m altera um **URL de uma string para um objeto `Intent`**, usando o m√©todo `Intent.parseUri(...)`, e o passa para `startActivity(...)`.

### Inje√ß√µes no Lado do Cliente Android e outros

Provavelmente voc√™ conhece esse tipo de vulnerabilidades da Web. Voc√™ deve ter cuidado especial com essas vulnerabilidades em um aplicativo Android:

* **Inje√ß√£o de SQL:** Ao lidar com consultas din√¢micas ou Content-Providers, certifique-se de estar usando consultas parametrizadas.
* **Inje√ß√£o de JavaScript (XSS):** Verifique se o suporte a JavaScript e Plugins est√° desativado para quaisquer WebViews (desativado por padr√£o). [Mais informa√ß√µes aqui](webview-attacks.md#javascript-enabled).
* **Inclus√£o de Arquivo Local:** Verifique se o Acesso ao Sistema de Arquivos est√° desativado para quaisquer WebViews (ativado por padr√£o) `(webview.getSettings().setAllowFileAccess(false);)`. [Mais informa√ß√µes aqui](webview-attacks.md#javascript-enabled).
* **Cookies eternos**: Em v√°rios casos, quando o aplicativo Android encerra a sess√£o, o cookie n√£o √© revogado ou pode at√© ser salvo no disco.
* [**Flag Segura** em cookies](../../pentesting-web/hacking-with-cookies/#cookies-flags)

***

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

Junte-se ao servidor [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) para se comunicar com hackers experientes e ca√ßadores de bugs!

**Percep√ß√µes de Hacking**\
Envolver-se com conte√∫do que mergulha na emo√ß√£o e desafios do hacking

**Not√≠cias de Hacking em Tempo Real**\
Mantenha-se atualizado com o mundo acelerado do hacking por meio de not√≠cias e insights em tempo real

**√öltimos An√∫ncios**\
Fique informado sobre os mais novos programas de recompensas por bugs lan√ßados e atualiza√ß√µes cruciais na plataforma

**Junte-se a n√≥s no** [**Discord**](https://discord.com/invite/N3FrSbmwdy) e comece a colaborar com os melhores hackers hoje!

## An√°lise Autom√°tica

### [MobSF](https://github.com/MobSF/Mobile-Security-Framework-MobSF)

**An√°lise est√°tica**

![](<../../.gitbook/assets/image (61).png>)

**Avalia√ß√£o de vulnerabilidades do aplicativo** usando uma interface web agrad√°vel. Voc√™ tamb√©m pode realizar an√°lise din√¢mica (mas precisa preparar o ambiente).
```bash
docker pull opensecurity/mobile-security-framework-mobsf
docker run -it -p 8000:8000 opensecurity/mobile-security-framework-mobsf:latest
```
Observe que o MobSF pode analisar aplicativos **Android**(apk), **IOS**(ipa) **e Windows**(apx) (_os aplicativos do Windows devem ser analisados a partir de um MobSF instalado em um host do Windows_).\
Al√©m disso, se voc√™ criar um arquivo **ZIP** com o c√≥digo-fonte de um aplicativo **Android** ou **IOS** (v√° at√© a pasta raiz do aplicativo, selecione tudo e crie um arquivo ZIP), o MobSF tamb√©m poder√° analis√°-lo.

O MobSF tamb√©m permite que voc√™ fa√ßa a **diferen√ßa/compara√ß√£o** da an√°lise e integre o **VirusTotal** (voc√™ precisar√° configurar sua chave de API em _MobSF/settings.py_ e habilit√°-la: `VT_ENABLED = TRUE` `VT_API_KEY = <Sua chave de API>` `VT_UPLOAD = TRUE`). Voc√™ tamb√©m pode definir `VT_UPLOAD` como `False`, ent√£o o **hash** ser√° **enviado** em vez do arquivo.

### An√°lise din√¢mica assistida com o MobSF

O **MobSF** tamb√©m pode ser muito √∫til para a **an√°lise din√¢mica** no **Android**, mas nesse caso voc√™ precisar√° instalar o MobSF e o **genymotion** em seu host (uma VM ou Docker n√£o funcionar√£o). _Observa√ß√£o: Voc√™ precisa **iniciar primeiro uma VM no genymotion** e **depois o MobSF.**_\
O **analisador din√¢mico do MobSF** pode:

* **Extrair dados do aplicativo** (URLs, logs, √°rea de transfer√™ncia, capturas de tela feitas por voc√™, capturas de tela feitas pelo "**Exported Activity Tester**", e-mails, bancos de dados SQLite, arquivos XML e outros arquivos criados). Tudo isso √© feito automaticamente, exceto pelas capturas de tela, voc√™ precisa pressionar quando desejar uma captura de tela ou pressionar "**Exported Activity Tester**" para obter capturas de tela de todas as atividades exportadas.
* Capturar **tr√°fego HTTPS**
* Usar o **Frida** para obter **informa√ß√µes em tempo de execu√ß√£o**

A partir das vers√µes do Android > 5, ele **iniciar√° automaticamente o Frida** e definir√° as configura√ß√µes globais de **proxy** para **capturar** o tr√°fego. Ele capturar√° apenas o tr√°fego do aplicativo testado.

**Frida**

Por padr√£o, ele tamb√©m usar√° alguns Scripts do Frida para **burlar a verifica√ß√£o de SSL**, **detec√ß√£o de root** e **detec√ß√£o de depurador** e para **monitorar APIs interessantes**.\
O MobSF tamb√©m pode **invocar atividades exportadas**, capturar **capturas de tela** delas e **salv√°-las** para o relat√≥rio.

Para **iniciar** o teste din√¢mico, pressione o bot√£o verde: "**Iniciar Instrumenta√ß√£o**". Pressione "**Frida Live Logs**" para ver os logs gerados pelos scripts do Frida e "**Monitor de API ao Vivo**" para ver todas as invoca√ß√µes aos m√©todos conectados, argumentos passados e valores retornados (isso aparecer√° ap√≥s pressionar "Iniciar Instrumenta√ß√£o").\
O MobSF tamb√©m permite carregar seus pr√≥prios **scripts do Frida** (para enviar os resultados de seus scripts do Friday para o MobSF, use a fun√ß√£o `send()`). Ele tamb√©m possui **v√°rios scripts pr√©-escritos** que voc√™ pode carregar (voc√™ pode adicionar mais em `MobSF/DynamicAnalyzer/tools/frida_scripts/others/`), basta **selecion√°-los**, pressionar "**Carregar**" e pressionar "**Iniciar Instrumenta√ß√£o**" (voc√™ poder√° ver os logs desses scripts dentro de "**Frida Live Logs**").

![](<../../.gitbook/assets/image (215).png>)

Al√©m disso, voc√™ tem algumas funcionalidades auxiliares do Frida:

* **Enumerar Classes Carregadas**: Ele imprimir√° todas as classes carregadas
* **Capturar Strings**: Ele imprimir√° todas as strings capturadas ao usar o aplicativo (muito ruidoso)
* **Capturar Compara√ß√£o de Strings**: Pode ser muito √∫til. Ele **mostrar√° as 2 strings sendo comparadas** e se o resultado foi Verdadeiro ou Falso.
* **Enumerar M√©todos de Classe**: Insira o nome da classe (como "java.io.File") e ele imprimir√° todos os m√©todos da classe.
* **Pesquisar Padr√£o de Classe**: Pesquisar classes por padr√£o
* **Rastrear M√©todos de Classe**: **Rastrear** uma **classe inteira** (ver entradas e sa√≠das de todos os m√©todos da classe). Lembre-se de que por padr√£o o MobSF rastreia v√°rios m√©todos interessantes da API do Android.

Depois de selecionar o m√≥dulo auxiliar que deseja usar, voc√™ precisa pressionar "**Iniciar Instrumenta√ß√£o**" e ver√° todas as sa√≠das em "**Frida Live Logs**".

**Shell**

O Mobsf tamb√©m oferece um shell com alguns comandos **adb**, comandos do **MobSF** e comandos **shell** comuns na parte inferior da p√°gina de an√°lise din√¢mica. Alguns comandos interessantes:
```bash
help
shell ls
activities
exported_activities
services
receivers
```
**Ferramentas HTTP**

Quando o tr√°fego http √© capturado, voc√™ pode ver uma visualiza√ß√£o feia do tr√°fego capturado no fundo "**HTTP(S) Traffic**" ou uma visualiza√ß√£o mais agrad√°vel no fundo verde "**Start HTTPTools**". A partir da segunda op√ß√£o, voc√™ pode **enviar** as **solicita√ß√µes capturadas** para **proxies** como Burp ou Owasp ZAP.\
Para fazer isso, _ligue o Burp -->_ _desative o Intercept --> no MobSB HTTPTools selecione a solicita√ß√£o_ --> pressione "**Send to Fuzzer**" --> _selecione o endere√ßo do proxy_ ([http://127.0.0.1:8080\\](http://127.0.1:8080)).

Ap√≥s concluir a an√°lise din√¢mica com o MobSF, voc√™ pode pressionar "**Start Web API Fuzzer**" para **fuzz http requests** e procurar por vulnerabilidades.

{% hint style="info" %}
Ap√≥s realizar uma an√°lise din√¢mica com o MobSF, as configura√ß√µes do proxy podem estar incorretas e voc√™ n√£o poder√° corrigi-las pela GUI. Voc√™ pode corrigir as configura√ß√µes do proxy fazendo:
```
adb shell settings put global http_proxy :0
```
{% endhint %}

### An√°lise Din√¢mica Assistida com Inspeckage

Voc√™ pode obter a ferramenta em [**Inspeckage**](https://github.com/ac-pm/Inspeckage).\
Esta ferramenta usar√° alguns **Hooks** para informar **o que est√° acontecendo no aplicativo** enquanto voc√™ realiza uma **an√°lise din√¢mica**.

{% content-ref url="inspeckage-tutorial.md" %}
[inspeckage-tutorial.md](inspeckage-tutorial.md)
{% endcontent-ref %}

### [Yaazhini](https://www.vegabird.com/yaazhini/)

Esta √© uma **√≥tima ferramenta para realizar an√°lise est√°tica com uma GUI**

![](<../../.gitbook/assets/image (527).png>)

### [Qark](https://github.com/linkedin/qark)

Esta ferramenta √© projetada para procurar v√°rias **vulnerabilidades de seguran√ßa relacionadas a aplicativos Android**, seja no **c√≥digo-fonte** ou em **APKs empacotados**. A ferramenta tamb√©m √© **capaz de criar um APK implant√°vel "Proof-of-Concept"** e **comandos ADB** para explorar algumas das vulnerabilidades encontradas (atividades expostas, inten√ß√µes, tapjacking...). Assim como o Drozer, n√£o √© necess√°rio fazer root no dispositivo de teste.
```bash
pip3 install --user qark  # --user is only needed if not using a virtualenv
qark --apk path/to/my.apk
qark --java path/to/parent/java/folder
qark --java path/to/specific/java/file.java
```
### [**ReverseAPK**](https://github.com/1N3/ReverseAPK.git)

* Exibe todos os arquivos extra√≠dos para f√°cil refer√™ncia
* Decompila automaticamente arquivos APK para formato Java e Smali
* Analisa AndroidManifest.xml em busca de vulnerabilidades e comportamentos comuns
* An√°lise est√°tica de c√≥digo-fonte em busca de vulnerabilidades e comportamentos comuns
* Informa√ß√µes do dispositivo
* Inten√ß√µes
* Execu√ß√£o de comandos
* Refer√™ncias SQLite
* Refer√™ncias de log
* Provedores de conte√∫do
* Receptores de transmiss√£o
* Refer√™ncias de servi√ßo
* Refer√™ncias de arquivo
* Refer√™ncias de criptografia
* Segredos codificados
* URLs
* Conex√µes de rede
* Refer√™ncias SSL
* Refer√™ncias de WebView
```
reverse-apk relative/path/to/APP.apk
```
### [SUPER Android Analyzer](https://github.com/SUPERAndroidAnalyzer/super)

O SUPER √© uma aplica√ß√£o de linha de comando que pode ser usada no Windows, MacOS X e Linux, que analisa arquivos _.apk_ em busca de vulnerabilidades. Ele faz isso descomprimindo os APKs e aplicando uma s√©rie de regras para detectar essas vulnerabilidades.

Todas as regras est√£o centralizadas em um arquivo `rules.json`, e cada empresa ou testador pode criar suas pr√≥prias regras para analisar o que precisam.

Baixe os bin√°rios mais recentes na [p√°gina de download](https://superanalyzer.rocks/download.html)
```
super-analyzer {apk_file}
```
### [StaCoAn](https://github.com/vincentcox/StaCoAn)

![](<../../.gitbook/assets/image (62).png>)

StaCoAn √© uma ferramenta **multiplataforma** que auxilia desenvolvedores, ca√ßadores de bugs e hackers √©ticos na realiza√ß√£o de [an√°lise de c√≥digo est√°tico](https://en.wikipedia.org/wiki/Static\_program\_analysis) em aplicativos m√≥veis\*.

O conceito √© que voc√™ arraste e solte o arquivo do seu aplicativo m√≥vel (um arquivo .apk ou .ipa) na aplica√ß√£o StaCoAn e ela ir√° gerar um relat√≥rio visual e port√°til para voc√™. Voc√™ pode ajustar as configura√ß√µes e listas de palavras para obter uma experi√™ncia personalizada.

Baixe a [√∫ltima vers√£o](https://github.com/vincentcox/StaCoAn/releases):
```
./stacoan
```
### [AndroBugs](https://github.com/AndroBugs/AndroBugs\_Framework)

O AndroBugs Framework √© um sistema de an√°lise de vulnerabilidades do Android que ajuda desenvolvedores ou hackers a encontrar poss√≠veis vulnerabilidades de seguran√ßa em aplicativos Android.\
[Releases para Windows](https://github.com/AndroBugs/AndroBugs\_Framework/releases)
```
python androbugs.py -f [APK file]
androbugs.exe -f [APK file]
```
### [Androwarn](https://github.com/maaaaz/androwarn)

**Androwarn** √© uma ferramenta cujo principal objetivo √© detectar e alertar o usu√°rio sobre poss√≠veis comportamentos maliciosos desenvolvidos por um aplicativo Android.

A detec√ß√£o √© realizada com a **an√°lise est√°tica** do bytecode Dalvik do aplicativo, representado como **Smali**, com a biblioteca [`androguard`](https://github.com/androguard/androguard).

Esta ferramenta procura por **comportamentos comuns de aplicativos "ruins"** como: exfiltra√ß√£o de identificadores de telefonia, intercepta√ß√£o de fluxo de √°udio/v√≠deo, modifica√ß√£o de dados PIM, execu√ß√£o de c√≥digo arbitr√°rio...
```
python androwarn.py -i my_application_to_be_analyzed.apk -r html -v 3
```
### [Framework MARA](https://github.com/xtiankisutsa/MARA_Framework)

![](<../../.gitbook/assets/image (81).png>)

**MARA** √© um **F**ramework de **R**everse engineering e **A**n√°lise de **A**plicativos **M**√≥veis. √â uma ferramenta que re√∫ne ferramentas comumente usadas para reverse engineering e an√°lise de aplicativos m√≥veis, para auxiliar nos testes de aplicativos m√≥veis contra as amea√ßas de seguran√ßa m√≥vel da OWASP. Seu objetivo √© tornar essa tarefa mais f√°cil e amig√°vel para desenvolvedores de aplicativos m√≥veis e profissionais de seguran√ßa.

Ele √© capaz de:

* Extrair c√≥digo Java e Smali usando diferentes ferramentas
* Analisar APKs usando: [smalisca](https://github.com/dorneanu/smalisca), [ClassyShark](https://github.com/google/android-classyshark), [androbugs](https://github.com/AndroBugs/AndroBugs_Framework), [androwarn](https://github.com/maaaaz/androwarn), [APKiD](https://github.com/rednaga/APKiD)
* Extrair informa√ß√µes privadas do APK usando regexps.
* Analisar o Manifest.
* Analisar dom√≠nios encontrados usando: [pyssltest](https://github.com/moheshmohan/pyssltest), [testssl](https://github.com/drwetter/testssl.sh) e [whatweb](https://github.com/urbanadventurer/WhatWeb)
* Desofuscar APK via [apk-deguard.com](http://www.apk-deguard.com)

### Koodous

√ötil para detectar malware: [https://koodous.com/](https://koodous.com)

## Ofusca√ß√£o/Desofusca√ß√£o de c√≥digo

Observe que, dependendo do servi√ßo e configura√ß√£o que voc√™ usa para ofuscar o c√≥digo, segredos podem ou n√£o ser desofuscados.

### [ProGuard](https://en.wikipedia.org/wiki/ProGuard\_\(software\))

**ProGuard** √© uma ferramenta de linha de comando de c√≥digo aberto que reduz, otimiza e ofusca o c√≥digo Java. Ele √© capaz de otimizar o bytecode, bem como detectar e remover instru√ß√µes n√£o utilizadas. O ProGuard √© um software gratuito e √© distribu√≠do sob a Licen√ßa P√∫blica Geral GNU, vers√£o 2.

O ProGuard √© distribu√≠do como parte do Android SDK e √© executado ao compilar o aplicativo no modo de lan√ßamento.

De: [https://en.wikipedia.org/wiki/ProGuard\_(software)](https://en.wikipedia.org/wiki/ProGuard\_\(software\))

### [DexGuard](https://www.guardsquare.com/dexguard)

Encontre um guia passo a passo para desofuscar o apk em [https://blog.lexfo.fr/dexguard.html](https://blog.lexfo.fr/dexguard.html)

(Do guia) Da √∫ltima vez que verificamos, o modo de opera√ß√£o do Dexguard era:

* carregar um recurso como um InputStream;
* alimentar o resultado para uma classe herdando de FilterInputStream para descriptograf√°-lo;
* fazer alguma obfusca√ß√£o in√∫til para desperdi√ßar alguns minutos de tempo de um reversor;
* alimentar o resultado descriptografado para um ZipInputStream para obter um arquivo DEX;
* finalmente carregar o DEX resultante como um Recurso usando o m√©todo `loadDex`.

### [DeGuard](http://apk-deguard.com)

**DeGuard reverte o processo de ofusca√ß√£o realizado por ferramentas de obfusca√ß√£o do Android. Isso permite in√∫meras an√°lises de seguran√ßa, incluindo inspe√ß√£o de c√≥digo e previs√£o de bibliotecas.**

Voc√™ pode fazer upload de um APK ofuscado para a plataforma deles.

### [Simplify](https://github.com/CalebFenton/simplify)

√â um **desofuscador gen√©rico para Android.** Simplify **executa virtualmente um aplicativo** para entender seu comportamento e ent√£o **tenta otimizar o c√≥digo** para que ele se comporte de forma id√™ntica, mas seja mais f√°cil para um humano entender. Cada tipo de otimiza√ß√£o √© simples e gen√©rico, ent√£o n√£o importa qual o tipo espec√≠fico de obfusca√ß√£o usado.

### [APKiD](https://github.com/rednaga/APKiD)

APKiD fornece informa√ß√µes sobre **como um APK foi feito**. Ele identifica muitos **compiladores**, **empacotadores**, **obfuscadores** e outras coisas estranhas. √â o [_PEiD_](https://www.aldeid.com/wiki/PEiD) para Android.

### Manual

[Leia este tutorial para aprender alguns truques sobre **como reverter a obfusca√ß√£o personalizada**](manual-deobfuscation.md)

## Laborat√≥rios

### [Androl4b](https://github.com/sh4hin/Androl4b)

AndroL4b √© uma m√°quina virtual de seguran√ßa Android baseada no ubuntu-mate que inclui a cole√ß√£o dos √∫ltimos frameworks, tutoriais e laborat√≥rios de diferentes geeks de seguran√ßa e pesquisadores para engenharia reversa e an√°lise de malware.

### OWASP

{% embed url="https://github.com/OWASP/owasp-mstg%0Ahttps://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06g-testing-network-communication" %}

### Reposit√≥rios Git

[https://github.com/riddhi-shree/nullCommunity/tree/master/Android](https://github.com/riddhi-shree/nullCommunity/tree/master/Android)\
[https://www.youtube.com/watch?v=PMKnPaGWxtg\&feature=youtu.be\&ab\_channel=B3nacSec](https://www.youtube.com/watch?v=PMKnPaGWxtg\&feature=youtu.be\&ab\_channel=B3nacSec)

## Refer√™ncias

Para mais informa√ß√µes, visite:

* [https://appsecwiki.com/#/](https://appsecwiki.com/#/) √â uma √≥tima lista de recursos
* [https://maddiestone.github.io/AndroidAppRE/](https://maddiestone.github.io/AndroidAppRE/) Curso r√°pido de Android
* [https://manifestsecurity.com/android-application-security/](https://manifestsecurity.com/android-application-security/)
* [https://github.com/Ralireza/Android-Security-Teryaagh](https://github.com/Ralireza/Android-Security-Teryaagh)

## Para Testar

* [https://www.vegabird.com/yaazhini/](https://www.vegabird.com/yaazhini/)
* [https://github.com/abhi-r3v0/Adhrit](https://github.com/abhi-r3v0/Adhrit)

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

Junte-se ao [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) server para se comunicar com hackers experientes e ca√ßadores de bugs!

**Percep√ß√µes de Hacking**\
Engaje-se com conte√∫do que mergulha na emo√ß√£o e desafios do hacking

**Not√≠cias de Hacking em Tempo Real**\
Mantenha-se atualizado com o mundo acelerado do hacking atrav√©s de not√≠cias e percep√ß√µes em tempo real

**√öltimos An√∫ncios**\
Fique informado sobre os mais novos programas de recompensas por bugs lan√ßados e atualiza√ß√µes cruciais na plataforma

**Junte-se a n√≥s no** [**Discord**](https://discord.com/invite/N3FrSbmwdy) e comece a colaborar com os melhores hackers hoje!

<details>

<summary><strong>Aprenda hacking AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras maneiras de apoiar o HackTricks:

* Se voc√™ deseja ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF** Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**swag oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe seus truques de hacking enviando PRs para o** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
