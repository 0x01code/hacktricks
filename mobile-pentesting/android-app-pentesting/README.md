# Teste de Penetra√ß√£o em Aplica√ß√µes Android

<details>

<summary><strong>Aprenda hacking no AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ quer ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**material oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao grupo** üí¨ [**Discord**](https://discord.gg/hRep4RUj7f) ou ao grupo [**telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios github** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

Junte-se ao servidor [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) para se comunicar com hackers experientes e ca√ßadores de bugs!

**Insights de Hacking**\
Engaje-se com conte√∫do que explora a emo√ß√£o e os desafios do hacking

**Not√≠cias de Hacking em Tempo Real**\
Mantenha-se atualizado com o mundo acelerado do hacking atrav√©s de not√≠cias e insights em tempo real

**√öltimos An√∫ncios**\
Fique informado sobre os mais novos programas de bug bounty e atualiza√ß√µes importantes da plataforma

**Junte-se a n√≥s no** [**Discord**](https://discord.com/invite/N3FrSbmwdy) e comece a colaborar com os melhores hackers hoje mesmo!

## Fundamentos de Aplica√ß√µes Android

√â altamente recomend√°vel come√ßar lendo esta p√°gina para saber sobre as **partes mais importantes relacionadas √† seguran√ßa Android e os componentes mais perigosos em uma aplica√ß√£o Android**:

{% content-ref url="android-applications-basics.md" %}
[android-applications-basics.md](android-applications-basics.md)
{% endcontent-ref %}

## ADB (Android Debug Bridge)

Esta √© a principal ferramenta que voc√™ precisa para se conectar a um dispositivo android (emulado ou f√≠sico).\
Ela permite controlar seu dispositivo via **USB** ou **Rede** a partir de um computador, **copiar** arquivos para frente e para tr√°s, **instalar** e desinstalar apps, executar comandos **shell**, realizar **backups**, ler **logs** e mais.

D√™ uma olhada na seguinte lista de [**Comandos ADB**](adb-commands.md) para aprender a usar o adb.

## Smali

√Äs vezes √© interessante **modificar o c√≥digo da aplica√ß√£o** para acessar **informa√ß√µes ocultas** (talvez senhas bem ofuscadas ou flags). Ent√£o, pode ser interessante descompilar o apk, modificar o c√≥digo e recompil√°-lo.\
[**Neste tutorial** voc√™ pode **aprender como descompilar e modificar o c√≥digo Smali e recompilar o APK** com a nova funcionalidade](smali-changes.md). Isso pode ser muito √∫til como uma **alternativa para v√°rios testes durante a an√°lise din√¢mica** que ser√£o apresentados. Ent√£o, **sempre tenha em mente essa possibilidade**.

## Outras dicas interessantes

* [Falsificando sua localiza√ß√£o na Play Store](spoofing-your-location-in-play-store.md)
* **Baixar APKs**: [https://apps.evozi.com/apk-downloader/](https://apps.evozi.com/apk-downloader/), [https://apkpure.com/es/](https://apkpure.com/es/), [https://www.apkmirror.com/](https://www.apkmirror.com), [https://apkcombo.com/es-es/apk-downloader/](https://apkcombo.com/es-es/apk-downloader/)
* Extrair APK do dispositivo:
```bash
adb shell pm list packages
com.android.insecurebankv2

adb shell pm path com.android.insecurebankv2
package:/data/app/com.android.insecurebankv2-Jnf8pNgwy3QA_U5f-n_4jQ==/base.apk

adb pull /data/app/com.android.insecurebankv2- Jnf8pNgwy3QA_U5f-n_4jQ==/base.apk
```
## An√°lise Est√°tica

Primeiro de tudo, para analisar um APK voc√™ deve **olhar para o c√≥digo Java** usando um decompilador.\
Por favor, [**leia aqui para encontrar informa√ß√µes sobre diferentes decompiladores dispon√≠veis**](apk-decompilers.md).

### Procurando por Informa√ß√µes Interessantes

Apenas olhando para as **strings** do APK voc√™ pode procurar por **senhas**, **URLs** ([https://github.com/ndelphit/apkurlgrep](https://github.com/ndelphit/apkurlgrep)), **chaves de api**, **criptografia**, **uuids bluetooth**, **tokens** e qualquer coisa interessante... procure at√© por **backdoors** de execu√ß√£o de c√≥digo ou backdoors de autentica√ß√£o (credenciais de admin codificadas na aplica√ß√£o).

**Firebase**

Preste aten√ß√£o especial √†s **URLs do firebase** e verifique se est√° mal configurado. [Mais informa√ß√µes sobre o que √© Firebase e como explor√°-lo aqui.](../../network-services-pentesting/pentesting-web/buckets/firebase-database.md)

### Entendimento B√°sico da Aplica√ß√£o - Manifest.xml, strings.xml

Usando qualquer um dos **decompiladores** mencionados [**aqui**](apk-decompilers.md) voc√™ poder√° ler o _Manifest.xml_. Voc√™ tamb√©m pode **renomear** a extens√£o do arquivo **apk para .zip** e **descompact√°-lo**.\
Lendo o **manifesto** voc√™ pode encontrar **vulnerabilidades**:

* Primeiro de tudo, verifique se **a aplica√ß√£o √© depur√°vel**. Um APK de produ√ß√£o n√£o deveria ser (ou outros poder√£o se conectar a ele). Voc√™ pode verificar se uma aplica√ß√£o √© depur√°vel procurando no manifesto pelo atributo `debuggable="true"` dentro da tag _\<application_ Exemplo: `<application theme="@2131296387" debuggable="true"`
* [Aprenda aqui](drozer-tutorial/#is-debuggeable) como encontrar aplica√ß√µes depur√°veis em um telefone e explor√°-las
* **Backup**: O atributo **`android:allowBackup`** define se os dados da aplica√ß√£o podem ser salvos e restaurados por um usu√°rio que habilitou a depura√ß√£o usb. Se a flag de backup estiver definida como verdadeira, permite que um atacante fa√ßa o backup dos dados da aplica√ß√£o via adb mesmo se o dispositivo n√£o estiver rooteado. Portanto, aplica√ß√µes que lidam e armazenam informa√ß√µes sens√≠veis, como detalhes de cart√µes, senhas etc., devem ter essa configura√ß√£o explicitamente definida como **false** porque por padr√£o est√° definida como **true** para evitar tais riscos.
* `<application android:allowBackup="false"`
* **NetworkSecurity:** A seguran√ßa de rede da aplica√ß√£o pode sobrescrever os valores padr√µes com **`android:networkSecurityConfig="@xml/network_security_config"`**. Um arquivo com esse nome pode ser colocado em _**res/xml.**_ Esse arquivo configurar√° configura√ß√µes de seguran√ßa importantes como pinos de certificado ou se permite tr√°fego HTTP. Voc√™ pode ler aqui mais informa√ß√µes sobre todas as coisas que podem ser configuradas, mas verifique este exemplo sobre como configurar o tr√°fego HTTP para alguns dom√≠nios:
* `<domain-config cleartextTrafficPermitted="true"> <domain includeSubdomains="true">formation-software.co.uk </domain></domain-config>`
* **Atividades Exportadas**: Verifique as atividades exportadas dentro do manifesto, pois isso pode ser perigoso. Mais adiante na an√°lise din√¢mica ser√° explicado como [voc√™ pode abusar desse comportamento](./#exploiting-exported-activities-authorisation-bypass).
* **Provedores de Conte√∫do**: Se um provedor exportado est√° sendo exposto, voc√™ poder√° acessar/modificar informa√ß√µes interessantes. Na an√°lise din√¢mica [voc√™ aprender√° como abusar deles](./#exploiting-content-providers-accessing-and-manipulating-sensitive-information).
* Verifique as configura√ß√µes de **FileProviders** dentro do atributo `android:name="android.support.FILE_PROVIDER_PATHS"`. [Leia aqui para aprender mais sobre FileProviders](./#fileprovider).
* **Servi√ßos Expostos**: Dependendo do que o servi√ßo est√° fazendo internamente, vulnerabilidades podem ser exploradas. Na an√°lise din√¢mica [voc√™ aprender√° como abusar deles](./#exploiting-services).
* **Receptores de Broadcast**: [Voc√™ aprender√° como voc√™ pode possivelmente explor√°-los](./#exploiting-broadcast-receivers) durante a an√°lise din√¢mica.
* **Esquema de URL**: Leia o c√≥digo da atividade que gerencia o esquema e procure por vulnerabilidades no gerenciamento da entrada do usu√°rio. Mais informa√ß√µes sobre [o que √© um esquema de URL aqui](./#url-schemes).
* **minSdkVersion**, **targetSDKVersion**, **maxSdkVersion**: Eles indicam as vers√µes do Android nas quais o aplicativo funcionar√°. √â importante ter isso em mente porque, do ponto de vista da seguran√ßa, suportar vers√µes antigas permitir√° que vers√µes vulner√°veis conhecidas do Android o executem.

Lendo **resources.arsc/strings.xml** voc√™ pode encontrar algumas **informa√ß√µes interessantes**:

* Chaves de API
* Esquemas personalizados
* Outras informa√ß√µes interessantes que os desenvolvedores salvam neste arquivo

### Tapjacking

**Tapjacking** √© um ataque onde um **aplicativo malicioso** √© lan√ßado e **se posiciona em cima de um aplicativo v√≠tima**. Uma vez que ele obscurece visivelmente o aplicativo v√≠tima, sua interface de usu√°rio √© projetada de tal forma a enganar o usu√°rio para interagir com ela, enquanto passa a intera√ß√£o para o aplicativo v√≠tima.\
Na pr√°tica, est√° **cegando o usu√°rio de saber que est√° realmente realizando a√ß√µes no aplicativo v√≠tima**.

Encontre mais informa√ß√µes em:

{% content-ref url="tapjacking.md" %}
[tapjacking.md](tapjacking.md)
{% endcontent-ref %}

### Sequestro de Tarefa

Uma **atividade** com o **`launchMode`** definido como **`singleTask` sem nenhuma `taskAffinity`** definida √© vulner√°vel ao sequestro de tarefa. Isso significa que um **aplicativo** pode ser instalado e, se lan√ßado antes do aplicativo real, poderia **sequestrar a tarefa do aplicativo real** (ent√£o o usu√°rio estar√° interagindo com o **aplicativo malicioso pensando que est√° usando o verdadeiro**).

Mais informa√ß√µes em:

{% content-ref url="android-task-hijacking.md" %}
[android-task-hijacking.md](android-task-hijacking.md)
{% endcontent-ref %}

### Armazenamento Inseguro de Dados

**Armazenamento Interno**

Arquivos **criados** no **armazenamento interno** s√£o **acess√≠veis** apenas pelo **aplicativo**. Essa prote√ß√£o √© implementada pelo Android e √© suficiente para a maioria das aplica√ß√µes. Mas os desenvolvedores frequentemente usam `MODE_WORLD_READBALE` & `MODE_WORLD_WRITABLE` para dar acesso a esses arquivos a um aplicativo diferente, mas isso n√£o limita outros aplicativos (maliciosos) de acess√°-los.\
Durante a **an√°lise est√°tica** **verifique** o uso desses **modos**, durante a **an√°lise din√¢mica** **verifique** as **permiss√µes** dos arquivos criados (talvez alguns deles sejam leg√≠veis/grav√°veis mundialmente).\
[Mais informa√ß√µes sobre essa vulnerabilidade e como corrigi-la aqui.](https://manifestsecurity.com/android-application-security-part-8/)

**Armazenamento Externo**

Arquivos criados no **armazenamento externo**, como cart√µes SD, s√£o **globalmente leg√≠veis e grav√°veis**. Como o armazenamento externo pode ser removido pelo usu√°rio e tamb√©m modificado por qualquer aplicativo, voc√™ n√£o deve **armazenar informa√ß√µes sens√≠veis usando armazenamento externo**.\
Como com dados de qualquer fonte n√£o confi√°vel, voc√™ deve **realizar valida√ß√£o de entrada** ao lidar com **dados de armazenamento externo**. Recomendamos fortemente que voc√™ n√£o armazene arquivos execut√°veis ou arquivos de classe no armazenamento externo antes do carregamento din√¢mico. Se o seu aplicativo recuperar arquivos execut√°veis do armazenamento externo, os arquivos devem ser assinados e verificados criptograficamente antes do carregamento din√¢mico.\
Informa√ß√µes tiradas de [aqui](https://manifestsecurity.com/android-application-security-part-8/).

O armazenamento externo pode ser **acessado** em `/storage/emulated/0`, `/sdcard`, `/mnt/sdcard`

{% hint style="info" %}
A partir do Android 4.4 (**API 17**), o cart√£o SD tem uma estrutura de diret√≥rios que **limita o acesso de um aplicativo ao diret√≥rio que √© especificamente para aquele aplicativo**. Isso impede que aplicativos maliciosos ganhem acesso de leitura ou escrita aos arquivos de outro aplicativo.
{% endhint %}

**Dados Sens√≠veis Armazenados em Texto Claro**

* **Prefer√™ncias Compartilhadas**: O Android permite que cada aplicativo salve facilmente arquivos xml no caminho `/data/data/<packagename>/shared_prefs/` e √†s vezes √© poss√≠vel encontrar informa√ß√µes sens√≠veis em texto claro nessa pasta.
* **Bancos de Dados**: O Android permite que cada aplicativo salve facilmente bancos de dados sqlite no caminho `/data/data/<packagename>/databases/` e √†s vezes √© poss√≠vel encontrar informa√ß√µes sens√≠veis em texto claro nessa pasta.

### TLS Quebrado

**Aceitar Todos os Certificados**

Por alguma raz√£o, √†s vezes os desenvolvedores aceitam todos os certificados mesmo que, por exemplo, o nome do host n√£o corresponda com linhas de c√≥digo como a seguinte:
```java
SSLSocketFactory sf = new cc(trustStore);
sf.setHostnameVerifier(SSLSocketFactory.ALLOW_ALL_HOSTNAME_VERIFIER);
```
```markdown
Uma boa maneira de testar isso √© tentar capturar o tr√°fego usando algum proxy como o Burp sem autorizar o CA do Burp dentro do dispositivo. Al√©m disso, voc√™ pode gerar com o Burp um certificado para um hostname diferente e us√°-lo.

### Criptografia Quebrada

**Processos de Gerenciamento de Chaves Pobres**

Alguns desenvolvedores salvam dados sens√≠veis no armazenamento local e os criptografam com uma chave codificada/previs√≠vel no c√≥digo. Isso n√£o deve ser feito, pois algum processo de engenharia reversa poderia permitir que atacantes extra√≠ssem as informa√ß√µes confidenciais.

**Uso de Algoritmos Inseguros e/ou Obsoletos**

Desenvolvedores n√£o devem usar **algoritmos obsoletos** para realizar **verifica√ß√µes** de autoriza√ß√£o, **armazenar** ou **enviar** dados. Alguns desses algoritmos s√£o: RC4, MD4, MD5, SHA1... Se **hashes** s√£o usados para armazenar senhas, por exemplo, devem ser usados hashes **resistentes** √† for√ßa bruta com sal.

### Outras verifica√ß√µes

* √â recomendado **ofuscar o APK** para dificultar o trabalho de engenharia reversa por atacantes.
* Se o aplicativo for sens√≠vel (como apps banc√°rios), deve realizar **suas pr√≥prias verifica√ß√µes para ver se o celular est√° rooteado** e agir em consequ√™ncia.
* Se o aplicativo for sens√≠vel (como apps banc√°rios), deve verificar se um **emulador** est√° sendo usado.
* Se o aplicativo for sens√≠vel (como apps banc√°rios), deve **verificar sua pr√≥pria integridade antes de executar** para checar se foi modificado.
* Use [**APKiD**](https://github.com/rednaga/APKiD) para verificar qual compilador/packer/ofuscador foi usado para construir o APK

### Aplicativo React Native

Leia a seguinte p√°gina para aprender como acessar facilmente o c√≥digo javascript de aplica√ß√µes React:

{% content-ref url="react-native-application.md" %}
[react-native-application.md](react-native-application.md)
{% endcontent-ref %}

### Aplica√ß√µes Xamarin

Leia a seguinte p√°gina para aprender como acessar facilmente o c√≥digo C# de aplica√ß√µes xamarin:

{% content-ref url="../xamarin-apps.md" %}
[xamarin-apps.md](../xamarin-apps.md)
{% endcontent-ref %}

### Aplica√ß√µes Superpacked

De acordo com este [**post do blog**](https://clearbluejar.github.io/posts/desuperpacking-meta-superpacked-apks-with-github-actions/), superpacked √© um algoritmo da Meta que comprime o conte√∫do de uma aplica√ß√£o em um √∫nico arquivo. O blog fala sobre a possibilidade de criar um aplicativo que descomprima esses tipos de apps... e uma maneira mais r√°pida que envolve **executar o aplicativo e coletar os arquivos descomprimidos do sistema de arquivos.**

### An√°lise Est√°tica Automatizada de C√≥digo

A ferramenta [**mariana-trench**](https://github.com/facebook/mariana-trench) √© capaz de encontrar **vulnerabilidades** ao **analisar** o **c√≥digo** da aplica√ß√£o. Esta ferramenta cont√©m uma s√©rie de **fontes conhecidas** (que indica √† ferramenta os **locais** onde a **entrada** √© **controlada pelo usu√°rio**), **pontos de entrada** (que indica √† ferramenta **locais perigosos** onde a entrada maliciosa do usu√°rio pode causar danos) e **regras**. Essas regras indicam a **combina√ß√£o** de **fontes-pontos de entrada** que sinaliza uma vulnerabilidade.

Com esse conhecimento, **mariana-trench revisar√° o c√≥digo e encontrar√° poss√≠veis vulnerabilidades nele**.

### Segredos vazados

Um aplicativo pode conter segredos (chaves de API, senhas, URLs ocultas, subdom√≠nios...) dentro dele que voc√™ pode ser capaz de descobrir. Voc√™ poderia usar uma ferramenta como [https://github.com/dwisiswant0/apkleaks](https://github.com/dwisiswant0/apkleaks)

### Bypass de Autentica√ß√£o Biom√©trica

{% content-ref url="bypass-biometric-authentication-android.md" %}
[bypass-biometric-authentication-android.md](bypass-biometric-authentication-android.md)
{% endcontent-ref %}

### Outras fun√ß√µes interessantes

* **Execu√ß√£o de c√≥digo**: `Runtime.exec(), ProcessBuilder(), c√≥digo nativo:system()`
* **Enviar SMSs**: `sendTextMessage, sendMultipartTestMessage`
* **Fun√ß√µes nativas** declaradas como `native`: `public native, System.loadLibrary, System.load`
* [Leia isto para aprender **como reverter fun√ß√µes nativas**](reversing-native-libraries.md)

### **Outros truques**

{% content-ref url="content-protocol.md" %}
[content-protocol.md](content-protocol.md)
{% endcontent-ref %}

***

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

Junte-se ao servidor [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) para se comunicar com hackers experientes e ca√ßadores de recompensas por bugs!

**Insights de Hacking**\
Engaje-se com conte√∫do que explora a emo√ß√£o e os desafios do hacking

**Not√≠cias de Hacking em Tempo Real**\
Mantenha-se atualizado com o mundo acelerado do hacking atrav√©s de not√≠cias e insights em tempo real

**√öltimos An√∫ncios**\
Fique informado com os mais novos bounties de bugs lan√ßados e atualiza√ß√µes cruciais da plataforma

**Junte-se a n√≥s no** [**Discord**](https://discord.com/invite/N3FrSbmwdy) e comece a colaborar com os melhores hackers hoje!

***

## An√°lise Din√¢mica

> Primeiro de tudo, voc√™ precisa de um ambiente onde possa instalar o aplicativo e todo o ambiente (certificado CA do Burp, Drozer e Frida principalmente). Portanto, um dispositivo rooteado (emulado ou n√£o) √© extremamente recomendado.

### An√°lise Din√¢mica Online

Voc√™ pode criar uma **conta gratuita** em: [https://appetize.io/](https://appetize.io). Esta plataforma permite que voc√™ **fa√ßa upload** e **execute** APKs, por isso √© √∫til para ver como um apk se comporta.

Voc√™ pode at√© **ver os logs do seu aplicativo** na web e se conectar atrav√©s do **adb**.

![](<../../.gitbook/assets/image (60).png>)

Gra√ßas √† conex√£o ADB, voc√™ pode usar **Drozer** e **Frida** dentro dos emuladores.

### An√°lise Din√¢mica Local

#### Usando um emulador

* [**Android Studio**](https://developer.android.com/studio) (Voc√™ pode criar dispositivos **x86** e **arm**, e de acordo com [**este**](https://android-developers.googleblog.com/2020/03/run-arm-apps-on-android-emulator.html) **√∫ltimas vers√µes x86** suportam **bibliotecas ARM** sem precisar de um emulador arm lento).
* Aprenda a configur√°-lo nesta p√°gina:

{% content-ref url="avd-android-virtual-device.md" %}
[avd-android-virtual-device.md](avd-android-virtual-device.md)
{% endcontent-ref %}

* [**Genymotion**](https://www.genymotion.com/fun-zone/) **(Vers√£o gratuita:** Personal Edition, voc√™ precisa criar uma conta. _√â recomend√°vel **baixar** a vers√£o **COM**_ _**VirtualBox** para evitar erros potenciais._)
* [**Nox**](https://es.bignox.com) (Gratuito, mas n√£o suporta Frida ou Drozer).

{% hint style="info" %}
Ao criar um novo emulador em qualquer plataforma, lembre-se de que quanto maior a tela, mais lento o emulador funcionar√°. Portanto, selecione telas pequenas, se poss√≠vel.
{% endhint %}

Para **instalar servi√ßos do Google** (como AppStore) no Genymotion, voc√™ precisa clicar no bot√£o marcado em vermelho da seguinte imagem:

![](<../../.gitbook/assets/image (200) (1).png>)

Al√©m disso, observe que na **configura√ß√£o da VM Android no Genymotion** voc√™ pode selecionar o modo **Bridge Network** (isso ser√° √∫til se voc√™ estiver se conectando √† VM Android de uma VM diferente com as ferramentas).

#### Use um dispositivo f√≠sico

Voc√™ precisa ativar as op√ß√µes de **depura√ß√£o** e seria bom se voc√™ pudesse **rootear**:

1. **Configura√ß√µes**.
2. (A partir do Android 8.0) Selecione **Sistema**.
3. Selecione **Sobre o telefone**.
4. Pressione **N√∫mero da vers√£o** 7 vezes.
5. Volte e voc√™ encontrar√° as **Op√ß√µes de desenvolvedor**.

> Uma vez que voc√™ tenha instalado o aplicativo, a primeira coisa que voc√™ deve fazer √© experiment√°-lo e investigar o que ele faz, como funciona e se familiarizar com ele.\
> Eu sugeriria **realizar esta an√°lise din√¢mica inicial usando a an√°lise din√¢mica do MobSF + pidcat**, para que possamos **aprender como o aplicativo funciona** enquanto o MobSF **captura** muitos dados **interessantes** que voc√™ pode revisar mais tarde.

### Vazamento de Dados N√£o Intencionais

**Logging**

Muitas vezes, os desenvolvedores deixam informa√ß√µes de depura√ß√£o publicamente. Assim, qualquer aplicativo com permiss√£o `READ_LOGS` pode **acessar esses logs** e obter informa√ß√µes sens√≠veis por meio deles.\
Enquanto navega pelo aplicativo, use [**pidcat**](https://github.com/JakeWharton/pidcat)_(Recomendado, √© mais f√°cil de usar e ler)_ ou [adb logcat](adb-commands.md#logcat) para ler os logs criados e **procurar por informa√ß√µes sens√≠veis**.

{% hint style="warning" %}
Observe que a partir de vers√µes **posteriores ao Android 4.0**, **aplicativos s√≥ podem acessar seus pr√≥prios logs**. Ent√£o, aplicativos n√£o podem acessar logs de outros apps.\
De qualquer forma, ainda √© recomendado **n√£o registrar informa√ß√µes sens√≠veis**.
{% endhint %}

**C√≥pia/Colagem de Cache do Buffer**

O Android fornece uma estrutura baseada em **clipboard** para fornecer a fun√ß√£o de copiar-colar em aplicativos Android. Mas isso cria um problema s√©rio quando algum **outro aplicativo** pode **acessar** o **clipboard** que cont√©m alguns dados sens√≠veis. A fun√ß√£o **Copiar/Colar** deve ser **desativada** para a **parte sens√≠vel** do aplicativo. Por exemplo, desative a c√≥pia dos detalhes do cart√£o de cr√©dito.

**Logs de Falhas**

Se um aplicativo **falha** durante a execu√ß√£o e **salva logs** em algum lugar, esses logs podem ser √∫teis para um atacante, especialmente em casos em que o aplicativo Android n√£o pode ser engenharia reversa. Ent√£o, evite criar logs quando os aplicativos falharem e, se os logs forem enviados pela rede, garanta que sejam enviados por um canal SSL.\
Como pentester, **tente dar uma olhada nesses logs**.

**Dados de An√°lise Enviados a Terceiros**

A maioria dos aplicativos usa outros servi√ßos em seu aplicativo, como o Google Adsense, mas √†s vezes eles **vazam alguns dados sens√≠veis** ou dados que n√£o s√£o necess√°rios para serem enviados a esse servi√ßo. Isso pode acontecer devido ao desenvolvedor n√£o implementar o recurso corretamente. Voc√™ pode **verificar interceptando o tr√°fego** do aplicativo e ver se algum dado sens√≠vel √© enviado a terceiros ou n√£o.

### Bancos de Dados SQLite

A maioria dos aplicativos usar√° **bancos de dados SQLite internos** para salvar informa√ß√µes. Durante o pentest, d√™ uma **olhada** nos **bancos de dados** criados, nos nomes das **tabelas** e **colunas** e em todos os **dados** salvos, pois voc√™ pode encontrar **informa√ß√µes sens√≠veis** (o que seria uma vulnerabilidade).\
Os bancos de dados devem estar localizados em `/data/data/o.nome.do.pacote/bancos de dados` como `/data/data/com.mwr.example.sieve/databases`

Se o banco de dados estiver salvando informa√ß√µes confidenciais e estiver **criptografado** mas voc√™ pode **encontrar** a **senha** dentro do aplicativo, ainda √© uma **vulnerabilidade**.

Enumere as tabelas usando `.tables` e enumere as colunas das tabelas fazendo `.schema <nome_da_tabela>`

### Drozer (Explorar Atividades, Provedores de Conte√∫do e Servi√ßos)

**Drozer** permite que voc√™ **assuma o papel de um aplicativo Android** e interaja com outros aplicativos. Ele pode fazer **tudo o que um aplicativo instalado pode fazer**, como fazer uso do mecanismo de Comunica√ß√£o Inter-Processos (IPC) do Android e interagir com o sistema operacional subjacente. Do [Guia Drozer](https://labs.mwrinfosecurity.com/assets/BlogFiles/mwri-drozer-user-guide-2015-03-23.pdf).\
Drozer √© uma ferramenta √∫til para **explorar atividades exportadas, servi√ßos exportados e Provedores de Conte√∫do** como voc√™ aprender√° nas pr√≥ximas se√ß√µes.

### Explorando Atividades Exportadas

[**Leia isto se voc√™ quiser relembrar o que √© uma Atividade Android.**](android-applications-basics.md#launcher-activity-and-other-activities)\
Tamb√©m lembre-se de que o c√≥digo de uma atividade come√ßa com o m√©todo `onCreate`.

**Bypass de Autoriza√ß√£o**

Quando uma Atividade √© exportada, voc√™ pode invocar sua tela de um aplicativo externo. Portanto, se uma atividade com **informa√ß√µes sens√≠veis** for **exportada**, voc√™ poderia **burlar** os mecanismos de **autentica√ß√£o** para acess√°-la.\
[**Aprenda como explorar atividades exportadas com Drozer.**](drozer-tutorial/#activities)

Voc√™ tamb√©m pode iniciar uma atividade exportada a partir do adb:

* Nome do Pacote √© com.example.demo
* Nome da Atividade Exportada √© com.example.test.MainActivity
```
```bash
adb shell am start -n com.example.demo/com.example.test.MainActivity
```
**NOTA**: O MobSF detectar√° como malicioso o uso de _**singleTask/singleInstance**_ como `android:launchMode` em uma atividade, mas devido a [isto](https://github.com/MobSF/Mobile-Security-Framework-MobSF/pull/750), aparentemente isso s√≥ √© perigoso em vers√µes antigas (vers√µes da API < 21).

{% hint style="info" %}
Observe que uma falha de autoriza√ß√£o nem sempre √© uma vulnerabilidade, isso depender√° de como a falha funciona e quais informa√ß√µes s√£o expostas.
{% endhint %}

**Vazamento de informa√ß√µes sens√≠veis**

**Atividades tamb√©m podem retornar resultados**. Se voc√™ conseguir encontrar uma atividade exportada e desprotegida chamando o m√©todo **`setResult`** e **retornando informa√ß√µes sens√≠veis**, h√° um vazamento de informa√ß√µes sens√≠veis.

#### Tapjacking

Se o tapjacking n√£o for prevenido, voc√™ poder√° abusar da atividade exportada para fazer o **usu√°rio realizar a√ß√µes inesperadas**. Para mais informa√ß√µes sobre [**o que √© Tapjacking, siga o link**](./#tapjacking).

### Explorando Content Providers - Acessando e manipulando informa√ß√µes sens√≠veis

[**Leia isto se voc√™ quiser relembrar o que √© um Content Provider.**](android-applications-basics.md#content-provider)\
Os content providers s√£o basicamente usados para **compartilhar dados**. Se um aplicativo tem content providers dispon√≠veis, voc√™ pode ser capaz de **extrair dados sens√≠veis** deles. Tamb√©m √© interessante testar poss√≠veis **inje√ß√µes SQL** e **Path Traversals**, pois eles podem ser vulner√°veis.\
[**Aprenda a explorar Content Providers com Drozer.**](drozer-tutorial/#content-providers)

### **Explorando Servi√ßos**

[**Leia isto se voc√™ quiser relembrar o que √© um Servi√ßo.**](android-applications-basics.md#services)\
Lembre-se de que as a√ß√µes de um Servi√ßo come√ßam no m√©todo `onStartCommand`.

Um servi√ßo √© basicamente algo que **pode receber dados**, **process√°-los** e **retornar** (ou n√£o) uma resposta. Ent√£o, se um aplicativo est√° exportando alguns servi√ßos, voc√™ deve **verificar** o **c√≥digo** para entender o que ele est√° fazendo e **test√°-lo** **dinamicamente** para extrair informa√ß√µes confidenciais, burlar medidas de autentica√ß√£o...\
[**Aprenda a explorar Servi√ßos com Drozer.**](drozer-tutorial/#services)

### **Explorando Broadcast Receivers**

[**Leia isto se voc√™ quiser relembrar o que √© um Broadcast Receiver.**](android-applications-basics.md#broadcast-receivers)\
Lembre-se de que as a√ß√µes de um Broadcast Receiver come√ßam no m√©todo `onReceive`.

Um broadcast receiver estar√° esperando por um tipo de mensagem. Dependendo de como o receptor lida com a mensagem, ele pode ser vulner√°vel.\
[**Aprenda a explorar Broadcast Receivers com Drozer.**](./#exploiting-broadcast-receivers)

### **Explorando Schemes / Deep links**

Voc√™ pode procurar por deep links manualmente, usando ferramentas como MobSF ou scripts como [este](https://github.com/ashleykinguk/FBLinkBuilder/blob/master/FBLinkBuilder.py).\
Voc√™ pode **abrir** um **scheme** declarado usando **adb** ou um **navegador**:

{% code overflow="wrap" %}
```bash
adb shell am start -a android.intent.action.VIEW -d "scheme://hostname/path?param=value" [your.package.name]
```
_Note que voc√™ pode **omitir o nome do pacote** e o celular ir√° automaticamente chamar o aplicativo que deve abrir aquele link._

{% code overflow="wrap" %}
```markup
<!-- Browser regular link -->
<a href="scheme://hostname/path?param=value">Click me</a>
<!-- fallback in your url you could try the intent url -->
<a href="intent://hostname#Intent;scheme=scheme;package=your.package.name;S.browser_fallback_url=http%3A%2F%2Fwww.example.com;end">with alternative</a>
```
{% endcode %}

**C√≥digo executado**

Para encontrar o **c√≥digo que ser√° executado no App**, v√° at√© a atividade chamada pelo deeplink e procure a fun√ß√£o **`onNewIntent`**.

![](<../../.gitbook/assets/image (436) (1) (1) (1).png>)

**Informa√ß√µes sens√≠veis**

Sempre que encontrar um deep link, verifique se **n√£o est√° recebendo dados sens√≠veis (como senhas) via par√¢metros de URL**, pois qualquer outra aplica√ß√£o poderia **se passar pelo deep link e roubar esses dados!**

**Par√¢metros no caminho**

Voc√™ **deve verificar tamb√©m se algum deep link est√° usando um par√¢metro dentro do caminho** da URL como: `https://api.example.com/v1/users/{username}`, nesse caso voc√™ pode for√ßar um path traversal acessando algo como: `example://app/users?username=../../unwanted-endpoint%3fparam=value`.\
Note que se voc√™ encontrar os endpoints corretos dentro da aplica√ß√£o, voc√™ pode ser capaz de causar um **Open Redirect** (se parte do caminho for usada como nome de dom√≠nio), **tomada de conta** (se voc√™ puder modificar detalhes de usu√°rios sem token CSRF e o endpoint vulner√°vel usou o m√©todo correto) e qualquer outra vulnerabilidade. Mais [informa√ß√µes sobre isso aqui](http://dphoeniixx.com/2020/12/13-2/).

**Mais exemplos**

Um [relat√≥rio de bug bounty interessante](https://hackerone.com/reports/855618) sobre links (_/.well-known/assetlinks.json_).

### Prote√ß√£o Insuficiente da Camada de Transporte

* **Falta de Inspe√ß√£o de Certificado:** Aplicativo Android n√£o verifica a identidade do certificado apresentado a ele. A maioria dos aplicativos ignora os avisos e aceita qualquer certificado autoassinado apresentado. Alguns aplicativos, em vez disso, passam o tr√°fego por uma conex√£o HTTP.
* **Negocia√ß√£o de Handshake Fraca:** Aplicativo e servidor realizam um handshake SSL/TLS, mas usam um conjunto de cifras inseguro, vulner√°vel a ataques MITM. Assim, qualquer atacante pode facilmente descriptografar essa conex√£o.
* **Vazamento de Informa√ß√µes Privadas:** Na maioria das vezes, acontece que os aplicativos fazem autentica√ß√£o por um canal seguro, mas todas as outras conex√µes por um canal n√£o seguro. Isso n√£o contribui para a seguran√ßa do aplicativo porque dados sens√≠veis restantes, como cookie de sess√£o ou dados do usu√°rio, podem ser interceptados por um usu√°rio malicioso.

Dos 3 cen√°rios apresentados, vamos discutir **como verificar a identidade do certificado**. Os outros 2 cen√°rios dependem da **configura√ß√£o TLS** do servidor e se o **aplicativo envia dados n√£o criptografados**. O pentester deve verificar por conta pr√≥pria a configura√ß√£o TLS do servidor ([aqui](../../network-services-pentesting/pentesting-web/#ssl-tls-vulnerabilites)) e detectar se qualquer **informa√ß√£o confidencial √© enviada por um canal desprotegido/vulner√°vel**.\
Mais informa√ß√µes sobre como descobrir e corrigir esses tipos de vulnerabilidades [**aqui**](https://manifestsecurity.com/android-application-security-part-10/).

**SSL Pinning**

Por padr√£o, ao fazer uma conex√£o SSL, o cliente (aplicativo android) verifica se o certificado do servidor tem uma cadeia de confian√ßa verific√°vel de volta a um certificado confi√°vel (raiz) e corresponde ao nome do host solicitado. Isso leva ao problema de **Ataques de Intermedi√°rio (MITM)**.\
No SSL Pinning, um Aplicativo Android cont√©m o certificado do servidor e s√≥ transmite dados se o mesmo certificado for apresentado.\
√â recomendado **aplicar SSL Pinning** para os sites onde informa√ß√µes sens√≠veis ser√£o enviadas.

### Inspe√ß√£o do tr√°fego HTTP

Primeiramente, voc√™ deve (obrigatoriamente) **instalar o certificado** da **ferramenta proxy** que voc√™ vai usar, provavelmente o Burp. Se voc√™ n√£o instalar o certificado CA da ferramenta proxy, provavelmente n√£o conseguir√° ver o tr√°fego criptografado no proxy.\
**Por favor,** [**leia este guia para aprender como instalar um certificado CA personalizado**](avd-android-virtual-device.md#install-burp-certificate-on-a-virtual-machine)**.**

Para aplicativos que visam **API Level 24+ n√£o √© suficiente instalar o certificado CA do Burp** no dispositivo. Para contornar essa nova prote√ß√£o, voc√™ precisa modificar o arquivo de Configura√ß√£o de Seguran√ßa de Rede. Assim, voc√™ pode modificar este arquivo para autorizar seu certificado CA ou pode [**ler esta p√°gina para um tutorial sobre como for√ßar o aplicativo a aceitar novamente todos os certificados instalados no dispositivo**](make-apk-accept-ca-certificate.md).

**SSL Pinning**

J√° discutimos o que √© SSL Pinning apenas 2 par√°grafos antes. Quando implementado em um aplicativo, voc√™ precisar√° contorn√°-lo para inspecionar o tr√°fego HTTPS ou n√£o conseguir√° v√™-lo.\
Aqui vou apresentar algumas op√ß√µes que usei para contornar essa prote√ß√£o:

* Modificar automaticamente o **apk** para **contornar** o SSLPinning com [**apk-mitm**](https://github.com/shroudedcode/apk-mitm). A melhor vantagem dessa op√ß√£o √© que voc√™ n√£o precisar√° de root para contornar o SSL Pinning, mas precisar√° deletar o aplicativo e reinstalar o novo, e isso nem sempre funciona.
* Voc√™ pode usar **Frida** (discutido abaixo) para contornar essa prote√ß√£o. Aqui voc√™ tem um guia para usar Burp+Frida+Genymotion: [https://spenkk.github.io/bugbounty/Configuring-Frida-with-Burp-and-GenyMotion-to-bypass-SSL-Pinning/](https://spenkk.github.io/bugbounty/Configuring-Frida-with-Burp-and-GenyMotion-to-bypass-SSL-Pinning/)
* Voc√™ tamb√©m pode tentar **contornar automaticamente o SSL Pinning** usando [**objection**](frida-tutorial/objection-tutorial.md)**:** `objection --gadget com.package.app explore --startup-command "android sslpinning disable"`
* Voc√™ tamb√©m pode tentar **contornar automaticamente o SSL Pinning** usando **an√°lise din√¢mica do MobSF** (explicado abaixo)
* Se voc√™ ainda acha que h√° algum tr√°fego que n√£o est√° capturando, pode tentar **encaminhar o tr√°fego para o burp usando iptables**. Leia este blog: [https://infosecwriteups.com/bypass-ssl-pinning-with-ip-forwarding-iptables-568171b52b62](https://infosecwriteups.com/bypass-ssl-pinning-with-ip-forwarding-iptables-568171b52b62)

**Vulnerabilidades Comuns da Web**

Note que nesta etapa voc√™ deve procurar por vulnerabilidades comuns da web. Muitas informa√ß√µes sobre vulnerabilidades da web podem ser encontradas neste livro, ent√£o n√£o vou mencion√°-las aqui.

### Frida

Kit de ferramentas de instrumenta√ß√£o din√¢mica para desenvolvedores, engenheiros reversos e pesquisadores de seguran√ßa. Saiba mais em [www.frida.re](https://www.frida.re).\
**√â incr√≠vel, voc√™ pode acessar aplicativos em execu√ß√£o e enganchar m√©todos em tempo de execu√ß√£o para alterar o comportamento, mudar valores, extrair valores, executar c√≥digos diferentes...**\
**Se voc√™ quer fazer pentest em aplicativos Android, precisa saber como usar o Frida.**

**Aprenda a usar o Frida:** [**Tutorial do Frida**](frida-tutorial/)\
**Algumas "GUI" para a√ß√µes com Frida:** [**https://github.com/m0bilesecurity/RMS-Runtime-Mobile-Security**](https://github.com/m0bilesecurity/RMS-Runtime-Mobile-Security)\
**Algumas outras abstra√ß√µes baseadas no Frida:** [**https://github.com/sensepost/objection**](https://github.com/sensepost/objection) **,** [**https://github.com/dpnishant/appmon**](https://github.com/dpnishant/appmon)\
**Voc√™ pode encontrar alguns scripts Frida incr√≠veis aqui:** [**https://codeshare.frida.re/**](https://codeshare.frida.re)

### **Dump de Mem√≥ria - Fridump**

Verifique se o aplicativo est√° armazenando informa√ß√µes sens√≠veis na mem√≥ria que n√£o deveria estar armazenando, como senhas ou mnem√¥nicos.

Usando [**Fridump3**](https://github.com/rootbsd/fridump3) voc√™ pode fazer o dump da mem√≥ria do app com:
```bash
# With PID
python3 fridump3.py -u <PID>

# With name
frida-ps -Uai
python3 fridump3.py -u "<Name>"
```
Este comando ir√° despejar a mem√≥ria na pasta ./dump, e l√° voc√™ poder√° usar grep com algo como:

{% code overflow="wrap" %}
```bash
strings * | grep -E "^[a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+$"
```
### **Dados sens√≠veis no Keystore**

No Android, o Keystore √© o melhor lugar para armazenar dados sens√≠veis, no entanto, com privil√©gios suficientes ainda √© **poss√≠vel acess√°-lo**. Como as aplica√ß√µes tendem a armazenar aqui **dados sens√≠veis em texto claro**, os pentests devem verificar isso como usu√°rio root ou algu√©m com acesso f√≠sico ao dispositivo poderia ser capaz de roubar esses dados.

Mesmo que um aplicativo armazene dados no keystore, os dados devem ser criptografados.

Para acessar os dados dentro do keystore, voc√™ pode usar este script Frida: [https://github.com/WithSecureLabs/android-keystore-audit/blob/master/frida-scripts/tracer-cipher.js](https://github.com/WithSecureLabs/android-keystore-audit/blob/master/frida-scripts/tracer-cipher.js)
```bash
frida -U -f com.example.app -l frida-scripts/tracer-cipher.js
```
### **Bypass de Impress√£o Digital/Biom√©tricos**

Utilizando o seguinte script Frida, pode ser poss√≠vel **bypassar a autentica√ß√£o por impress√£o digital** que aplica√ß√µes Android podem estar realizando para **proteger certas √°reas sens√≠veis:**

{% code overflow="wrap" %}
```bash
frida --codeshare krapgras/android-biometric-bypass-update-android-11 -U -f <app.package>
```
### **Imagens de Fundo**

Quando voc√™ coloca um aplicativo em segundo plano, o Android armazena um **instant√¢neo do aplicativo** para que, quando ele for recuperado para o primeiro plano, comece a carregar a imagem antes do aplicativo para parecer que o aplicativo foi carregado mais rapidamente.

No entanto, se este instant√¢neo contiver **informa√ß√µes sens√≠veis**, algu√©m com acesso ao instant√¢neo pode **roubar essas informa√ß√µes** (note que voc√™ precisa de root para acess√°-lo).

Os instant√¢neos geralmente s√£o armazenados em torno de: **`/data/system_ce/0/snapshots`**

O Android oferece uma maneira de **prevenir a captura de tela definindo o par√¢metro de layout FLAG\_SECURE**. Ao usar essa flag, o conte√∫do da janela √© tratado como seguro, impedindo que ele apare√ßa em capturas de tela ou seja visualizado em exibi√ß√µes n√£o seguras.
```bash
getWindow().setFlags(LayoutParams.FLAG_SECURE, LayoutParams.FLAG_SECURE);
```
### **Analisador de Aplica√ß√µes Android**

Esta ferramenta pode ajud√°-lo a gerenciar diferentes ferramentas durante a an√°lise din√¢mica: [https://github.com/NotSoSecure/android\_application\_analyzer](https://github.com/NotSoSecure/android\_application\_analyzer)

### Inje√ß√£o de Intent

Esta vulnerabilidade se assemelha ao **Open Redirect em seguran√ßa web**. Como a classe `Intent` √© `Parcelable`, **objetos pertencentes a esta classe** podem ser **passados** como **dados extras** em outro objeto `Intent`.\
Muitos desenvolvedores fazem **uso** desta **funcionalidade** e criam **componentes proxy** (atividades, receptores de transmiss√£o e servi√ßos) que **recebem um Intent embutido e o passam para m√©todos perigosos** como `startActivity(...)`, `sendBroadcast(...)`, etc.\
Isso √© perigoso porque **um atacante pode for√ßar o aplicativo a lan√ßar um componente n√£o-exportado que n√£o pode ser iniciado diretamente de outro aplicativo**, ou conceder ao atacante acesso aos seus provedores de conte√∫do. **`WebView`** tamb√©m √†s vezes converte uma **URL de uma string para um objeto `Intent`**, usando o m√©todo `Intent.parseUri(...)`, e o passa para `startActivity(...)`.

### Inje√ß√µes no Lado do Cliente Android e outros

Provavelmente voc√™ j√° conhece esse tipo de vulnerabilidades da Web. Voc√™ tem que ter um cuidado especial com essas vulnerabilidades em um aplicativo Android:

* **SQL Injection:** Ao lidar com consultas din√¢micas ou Content-Providers, certifique-se de que est√° usando consultas parametrizadas.
* **JavaScript Injection (XSS):** Verifique se o suporte a JavaScript e Plugins est√° desativado para qualquer WebView (desativado por padr√£o). [Mais informa√ß√µes aqui](webview-attacks.md#javascript-enabled).
* **Local File Inclusion:** Verifique se o Acesso ao Sistema de Arquivos est√° desativado para qualquer WebView (ativado por padr√£o) `(webview.getSettings().setAllowFileAccess(false);)`. [Mais informa√ß√µes aqui](webview-attacks.md#javascript-enabled).
* **Cookies eternos**: Em v√°rios casos, quando o aplicativo Android termina a sess√£o, o cookie n√£o √© revogado ou pode at√© ser salvo no disco
* [**Secure Flag** em cookies](../../pentesting-web/hacking-with-cookies/#cookies-flags)

***

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

Junte-se ao servidor [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) para se comunicar com hackers experientes e ca√ßadores de recompensas por bugs!

**Insights de Hacking**\
Engaje-se com conte√∫do que explora a emo√ß√£o e os desafios do hacking

**Not√≠cias de Hacking em Tempo Real**\
Mantenha-se atualizado com o mundo acelerado do hacking atrav√©s de not√≠cias e insights em tempo real

**√öltimos An√∫ncios**\
Fique informado com os mais novos bounties de bugs lan√ßados e atualiza√ß√µes cruciais da plataforma

**Junte-se a n√≥s no** [**Discord**](https://discord.com/invite/N3FrSbmwdy) e comece a colaborar com os melhores hackers hoje!

## An√°lise Autom√°tica

### [MobSF](https://github.com/MobSF/Mobile-Security-Framework-MobSF)

**An√°lise est√°tica**

![](<../../.gitbook/assets/image (61).png>)

**Avalia√ß√£o de vulnerabilidade da aplica√ß√£o** usando uma interface web amig√°vel. Voc√™ tamb√©m pode realizar an√°lise din√¢mica (mas precisa preparar o ambiente).
```bash
docker pull opensecurity/mobile-security-framework-mobsf
docker run -it -p 8000:8000 opensecurity/mobile-security-framework-mobsf:latest
```
Observe que o MobSF pode analisar aplicativos **Android** (apk), **IOS** (ipa) e **Windows** (apx) (aplica√ß√µes do Windows devem ser analisadas a partir de um MobSF instalado em um host Windows).
Al√©m disso, se voc√™ criar um arquivo **ZIP** com o c√≥digo-fonte de um aplicativo **Android** ou **IOS** (v√° para a pasta raiz do aplicativo, selecione tudo e crie um arquivo ZIP), ele tamb√©m ser√° capaz de analis√°-lo.

O MobSF tamb√©m permite que voc√™ **diff/Compare** an√°lises e integre o **VirusTotal** (voc√™ precisar√° configurar sua chave de API em _MobSF/settings.py_ e ativ√°-la: `VT_ENABLED = TRUE` `VT_API_KEY = <Sua chave de API>` `VT_UPLOAD = TRUE`). Voc√™ tamb√©m pode definir `VT_UPLOAD` como `False`, ent√£o o **hash** ser√° **upload** em vez do arquivo.

### An√°lise Din√¢mica Assistida com MobSF

O **MobSF** tamb√©m pode ser muito √∫til para **an√°lise din√¢mica** em **Android**, mas nesse caso voc√™ precisar√° instalar o MobSF e o **genymotion** em seu host (uma VM ou Docker n√£o funcionar√°). _Nota: Voc√™ precisa **iniciar primeiro uma VM no genymotion** e **depois o MobSF.**_
O **analisador din√¢mico MobSF** pode:

* **Dump de dados da aplica√ß√£o** (URLs, logs, √°rea de transfer√™ncia, capturas de tela feitas por voc√™, capturas de tela feitas pelo "**Exported Activity Tester**", emails, bancos de dados SQLite, arquivos XML e outros arquivos criados). Tudo isso √© feito automaticamente, exceto pelas capturas de tela, voc√™ precisa pressionar quando quiser uma captura de tela ou precisa pressionar "**Exported Activity Tester**" para obter capturas de tela de todas as atividades exportadas.
* Capturar tr√°fego **HTTPS**
* Usar **Frida** para obter **informa√ß√µes em tempo de execu√ß√£o**

A partir das **vers√µes do Android > 5**, ele **iniciar√° automaticamente o Frida** e configurar√° as defini√ß√µes de **proxy** globais para **capturar** tr√°fego. Ele s√≥ capturar√° tr√°fego do aplicativo testado.

**Frida**

Por padr√£o, ele tamb√©m usar√° alguns Scripts Frida para **bypass SSL pinning**, **detec√ß√£o de root** e **detec√ß√£o de depurador** e para **monitorar APIs interessantes**.\
O MobSF tamb√©m pode **invocar atividades exportadas**, capturar **screenshots** delas e **salvar** para o relat√≥rio.

Para **iniciar** o teste din√¢mico, pressione o bot√£o verde: "**Start Instrumentation**". Pressione "**Frida Live Logs**" para ver os logs gerados pelos scripts Frida e "**Live API Monitor**" para ver todas as invoca√ß√µes de m√©todos enganchados, argumentos passados e valores retornados (isso aparecer√° ap√≥s pressionar "Start Instrumentation").\
O MobSF tamb√©m permite que voc√™ carregue seus pr√≥prios **scripts Frida** (para enviar os resultados dos seus scripts Frida para o MobSF, use a fun√ß√£o `send()`). Ele tamb√©m possui **v√°rios scripts pr√©-escritos** que voc√™ pode carregar (voc√™ pode adicionar mais em `MobSF/DynamicAnalyzer/tools/frida_scripts/others/`), basta **selecion√°-los**, pressionar "**Load**" e pressionar "**Start Instrumentation**" (voc√™ poder√° ver os logs desses scripts dentro de "**Frida Live Logs**").

![](<../../.gitbook/assets/image (215).png>)

Al√©m disso, voc√™ tem algumas funcionalidades auxiliares do Frida:

* **Enumerate Loaded Classes**: Ele imprimir√° todas as classes carregadas
* **Capture Strings**: Ele imprimir√° todas as strings capturadas enquanto usa o aplicativo (muito barulhento)
* **Capture String Comparisons**: Pode ser muito √∫til. Ele **mostrar√° as 2 strings sendo comparadas** e se o resultado foi Verdadeiro ou Falso.
* **Enumerate Class Methods**: Coloque o nome da classe (como "java.io.File") e ele imprimir√° todos os m√©todos da classe.
* **Search Class Pattern**: Pesquisar classes por padr√£o
* **Trace Class Methods**: **Trace** uma **classe inteira** (veja entradas e sa√≠das de todos os m√©todos da classe). Lembre-se de que, por padr√£o, o MobSF rastreia v√°rios m√©todos interessantes da API Android.

Uma vez que voc√™ tenha selecionado o m√≥dulo auxiliar que deseja usar, voc√™ precisa pressionar "**Start Instrumentation**" e ver√° todas as sa√≠das em "**Frida Live Logs**".

**Shell**

O MobSF tamb√©m oferece um shell com alguns comandos **adb**, comandos **MobSF** e comandos comuns de **shell** na parte inferior da p√°gina de an√°lise din√¢mica. Alguns comandos interessantes:
```bash
help
shell ls
activities
exported_activities
services
receivers
```
**Ferramentas HTTP**

Quando o tr√°fego http √© capturado, voc√™ pode ver uma vis√£o desagrad√°vel do tr√°fego capturado em "**HTTP(S) Traffic**" na parte inferior ou uma vis√£o mais agrad√°vel em "**Start HTTPTools**" no bot√£o verde. A partir da segunda op√ß√£o, voc√™ pode **enviar** as **solicita√ß√µes capturadas** para **proxies** como Burp ou Owasp ZAP.\
Para fazer isso, _ative o Burp -->_ _desative o Intercept --> no MobSB HTTPTools selecione a solicita√ß√£o_ --> pressione "**Send to Fuzzer**" --> _selecione o endere√ßo do proxy_ ([http://127.0.0.1:8080\\](http://127.0.0.1:8080)).

Uma vez que voc√™ terminar a an√°lise din√¢mica com o MobSF, voc√™ pode pressionar em "**Start Web API Fuzzer**" para **fuzzar solicita√ß√µes http** e procurar por vulnerabilidades.

{% hint style="info" %}
Ap√≥s realizar uma an√°lise din√¢mica com o MobSF, as configura√ß√µes de proxy podem estar mal configuradas e voc√™ n√£o conseguir√° corrigi-las pela GUI. Voc√™ pode corrigir as configura√ß√µes de proxy fazendo:
```
adb shell settings put global http_proxy :0
```
{% endhint %}

### An√°lise Din√¢mica Assistida com Inspeckage

Voc√™ pode obter a ferramenta de [**Inspeckage**](https://github.com/ac-pm/Inspeckage).\
Esta ferramenta usa alguns **Hooks** para informar **o que est√° acontecendo na aplica√ß√£o** enquanto voc√™ realiza uma **an√°lise din√¢mica**.

{% content-ref url="inspeckage-tutorial.md" %}
[inspeckage-tutorial.md](inspeckage-tutorial.md)
{% endcontent-ref %}

### [Yaazhini](https://www.vegabird.com/yaazhini/)

Esta √© uma **√≥tima ferramenta para realizar an√°lise est√°tica com uma GUI**

![](<../../.gitbook/assets/image (527).png>)

### [Qark](https://github.com/linkedin/qark)

Esta ferramenta √© projetada para procurar v√°rias **vulnerabilidades relacionadas √† seguran√ßa em aplica√ß√µes Android**, seja no **c√≥digo-fonte** ou em **APKs empacotados**. A ferramenta tamb√©m √© **capaz de criar um APK "Prova-de-Conceito" implant√°vel** e **comandos ADB**, para explorar algumas das vulnerabilidades encontradas (Atividades expostas, intents, tapjacking...). Assim como com Drozer, n√£o √© necess√°rio ter root no dispositivo de teste.
```bash
pip3 install --user qark  # --user is only needed if not using a virtualenv
qark --apk path/to/my.apk
qark --java path/to/parent/java/folder
qark --java path/to/specific/java/file.java
```
### [**ReverseAPK**](https://github.com/1N3/ReverseAPK.git)

* Exibe todos os arquivos extra√≠dos para f√°cil refer√™ncia
* Decompila automaticamente arquivos APK para os formatos Java e Smali
* Analisa AndroidManifest.xml para vulnerabilidades comuns e comportamento
* An√°lise est√°tica do c√≥digo-fonte para vulnerabilidades comuns e comportamento
* Informa√ß√µes do dispositivo
* Intents
* Execu√ß√£o de comandos
* Refer√™ncias SQLite
* Refer√™ncias de logs
* Provedores de conte√∫do
* Receptores de transmiss√£o
* Refer√™ncias de servi√ßos
* Refer√™ncias de arquivos
* Refer√™ncias criptogr√°ficas
* Segredos codificados
* URL's
* Conex√µes de rede
* Refer√™ncias SSL
* Refer√™ncias WebView
```
reverse-apk relative/path/to/APP.apk
```
### [SUPER Android Analyzer](https://github.com/SUPERAndroidAnalyzer/super)

SUPER √© uma aplica√ß√£o de linha de comando que pode ser usada no Windows, MacOS X e Linux, que analisa arquivos _.apk_ em busca de vulnerabilidades. Ele faz isso descomprimindo APKs e aplicando uma s√©rie de regras para detectar essas vulnerabilidades.

Todas as regras est√£o centradas em um arquivo `rules.json`, e cada empresa ou testador poderia criar suas pr√≥prias regras para analisar o que precisam.

Baixe os √∫ltimos bin√°rios na [p√°gina de download](https://superanalyzer.rocks/download.html)
```
super-analyzer {apk_file}
```
### [StaCoAn](https://github.com/vincentcox/StaCoAn)

![](<../../.gitbook/assets/image (62).png>)

StaCoAn √© uma ferramenta **crossplatform** que auxilia desenvolvedores, ca√ßadores de recompensas por bugs e hackers √©ticos a realizar [an√°lise de c√≥digo est√°tico](https://en.wikipedia.org/wiki/Static\_program\_analysis) em aplica√ß√µes m√≥veis\*.

O conceito √© que voc√™ arraste e solte o arquivo da sua aplica√ß√£o m√≥vel (um arquivo .apk ou .ipa) na aplica√ß√£o StaCoAn e ela gerar√° um relat√≥rio visual e port√°til para voc√™. Voc√™ pode ajustar as configura√ß√µes e listas de palavras para obter uma experi√™ncia personalizada.

Baixe a [√∫ltima vers√£o](https://github.com/vincentcox/StaCoAn/releases):
```
./stacoan
```
### [AndroBugs](https://github.com/AndroBugs/AndroBugs_Framework)

AndroBugs Framework √© um sistema de an√°lise de vulnerabilidades Android que ajuda desenvolvedores ou hackers a encontrar potenciais vulnerabilidades de seguran√ßa em aplica√ß√µes Android.\
[Lan√ßamentos para Windows](https://github.com/AndroBugs/AndroBugs_Framework/releases)
```
python androbugs.py -f [APK file]
androbugs.exe -f [APK file]
```
### [Androwarn](https://github.com/maaaaz/androwarn)

**Androwarn** √© uma ferramenta cujo principal objetivo √© detectar e alertar o usu√°rio sobre comportamentos potencialmente maliciosos desenvolvidos por um aplicativo Android.

A detec√ß√£o √© realizada com a **an√°lise est√°tica** do bytecode Dalvik do aplicativo, representado como **Smali**, com a biblioteca [`androguard`](https://github.com/androguard/androguard).

Esta ferramenta procura por **comportamentos comuns de aplica√ß√µes "ruins"** como: Exfiltra√ß√£o de identificadores de telefonia, Intercep√ß√£o de fluxo de √°udio/v√≠deo, Modifica√ß√£o de dados PIM, Execu√ß√£o de c√≥digo arbitr√°rio...
```
python androwarn.py -i my_application_to_be_analyzed.apk -r html -v 3
```
### [MARA Framework](https://github.com/xtiankisutsa/MARA_Framework)

![](<../../.gitbook/assets/image (81).png>)

**MARA** √© um **M**obile **A**pplication **R**everse engineering and **A**nalysis Framework. √â uma ferramenta que re√∫ne ferramentas comumente usadas para engenharia reversa e an√°lise de aplica√ß√µes m√≥veis, para auxiliar no teste de aplica√ß√µes m√≥veis contra as amea√ßas de seguran√ßa m√≥vel da OWASP. Seu objetivo √© tornar essa tarefa mais f√°cil e amig√°vel para desenvolvedores de aplica√ß√µes m√≥veis e profissionais de seguran√ßa.

Ele √© capaz de:

* Extrair c√≥digo Java e Smali usando diferentes ferramentas
* Analisar APKs usando: [smalisca](https://github.com/dorneanu/smalisca), [ClassyShark](https://github.com/google/android-classyshark), [androbugs](https://github.com/AndroBugs/AndroBugs_Framework), [androwarn](https://github.com/maaaaz/androwarn), [APKiD](https://github.com/rednaga/APKiD)
* Extrair informa√ß√µes privadas do APK usando regexps.
* Analisar o Manifesto.
* Analisar dom√≠nios encontrados usando: [pyssltest](https://github.com/moheshmohan/pyssltest), [testssl](https://github.com/drwetter/testssl.sh) e [whatweb](https://github.com/urbanadventurer/WhatWeb)
* Desofuscar APK via [apk-deguard.com](http://www.apk-deguard.com)

### Koodous

√ötil para detectar malware: [https://koodous.com/](https://koodous.com)

## Ofusca√ß√£o/Desofusca√ß√£o de c√≥digo

Note que, dependendo do servi√ßo e configura√ß√£o que voc√™ usar para ofuscar o c√≥digo, os segredos podem ou n√£o acabar ofuscados.

### [ProGuard](https://en.wikipedia.org/wiki/ProGuard_(software))

**ProGuard** √© uma ferramenta de linha de comando de c√≥digo aberto que reduz, otimiza e ofusca c√≥digo Java. √â capaz de otimizar bytecode, bem como detectar e remover instru√ß√µes n√£o utilizadas. ProGuard √© um software livre e √© distribu√≠do sob a GNU General Public License, vers√£o 2.

ProGuard √© distribu√≠do como parte do Android SDK e √© executado ao construir a aplica√ß√£o no modo de lan√ßamento.

De: [https://en.wikipedia.org/wiki/ProGuard_(software)](https://en.wikipedia.org/wiki/ProGuard_(software))

### [DexGuard](https://www.guardsquare.com/dexguard)

Encontre um guia passo a passo para desofuscar o apk em [https://blog.lexfo.fr/dexguard.html](https://blog.lexfo.fr/dexguard.html)

(Desse guia) A √∫ltima vez que verificamos, o modo de opera√ß√£o do Dexguard era:

* carregar um recurso como um InputStream;
* alimentar o resultado a uma classe que herda de FilterInputStream para descriptograf√°-lo;
* fazer alguma ofusca√ß√£o in√∫til para desperdi√ßar alguns minutos do tempo de um reversor;
* alimentar o resultado descriptografado a um ZipInputStream para obter um arquivo DEX;
* finalmente carregar o DEX resultante como um Recurso usando o m√©todo `loadDex`.

### [DeGuard](http://apk-deguard.com)

**DeGuard reverte o processo de ofusca√ß√£o realizado por ferramentas de ofusca√ß√£o Android. Isso permite v√°rias an√°lises de seguran√ßa, incluindo inspe√ß√£o de c√≥digo e previs√£o de bibliotecas.**

Voc√™ pode fazer upload de um APK ofuscado para a plataforma deles.

### [Simplify](https://github.com/CalebFenton/simplify)

√â um **desofuscador gen√©rico para Android.** Simplify **executa virtualmente um aplicativo** para entender seu comportamento e ent√£o **tenta otimizar o c√≥digo** para que se comporte de forma id√™ntica, mas seja mais f√°cil de entender por um humano. Cada tipo de otimiza√ß√£o √© simples e gen√©rico, ent√£o n√£o importa qual o tipo espec√≠fico de ofusca√ß√£o usado.

### [APKiD](https://github.com/rednaga/APKiD)

APKiD fornece informa√ß√µes sobre **como um APK foi feito**. Identifica muitos **compiladores**, **empacotadores**, **ofuscadores** e outras coisas estranhas. √â o [_PEiD_](https://www.aldeid.com/wiki/PEiD) para Android.

### Manual

[Leia este tutorial para aprender alguns truques sobre **como reverter ofusca√ß√£o personalizada**](manual-deobfuscation.md)

## Laborat√≥rios

### [Androl4b](https://github.com/sh4hin/Androl4b)

AndroL4b √© uma m√°quina virtual de seguran√ßa Android baseada em ubuntu-mate que inclui a cole√ß√£o dos mais recentes frameworks, tutoriais e laborat√≥rios de diferentes geeks de seguran√ßa e pesquisadores para engenharia reversa e an√°lise de malware.

### OWASP

{% embed url="https://github.com/OWASP/owasp-mstg%0Ahttps://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06g-testing-network-communication" %}

### Reposit√≥rios Git

[https://github.com/riddhi-shree/nullCommunity/tree/master/Android](https://github.com/riddhi-shree/nullCommunity/tree/master/Android)\
[https://www.youtube.com/watch?v=PMKnPaGWxtg&feature=youtu.be&ab_channel=B3nacSec](https://www.youtube.com/watch?v=PMKnPaGWxtg&feature=youtu.be&ab_channel=B3nacSec)

## Refer√™ncias

Para mais informa√ß√µes, visite:

* [https://appsecwiki.com/#/](https://appsecwiki.com/#/) √â uma √≥tima lista de recursos
* [https://maddiestone.github.io/AndroidAppRE/](https://maddiestone.github.io/AndroidAppRE/) Curso r√°pido de Android
* [https://manifestsecurity.com/android-application-security/](https://manifestsecurity.com/android-application-security/)
* [https://github.com/Ralireza/Android-Security-Teryaagh](https://github.com/Ralireza/Android-Security-Teryaagh)

## Para Testar

* [https://www.vegabird.com/yaazhini/](https://www.vegabird.com/yaazhini/)
* [https://github.com/abhi-r3v0/Adhrit](https://github.com/abhi-r3v0/Adhrit)

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

Junte-se ao servidor [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) para se comunicar com hackers experientes e ca√ßadores de recompensas por bugs!

**Insights de Hacking**\
Engaje-se com conte√∫do que explora a emo√ß√£o e os desafios do hacking

**Not√≠cias de Hacking em Tempo Real**\
Mantenha-se atualizado com o mundo acelerado do hacking atrav√©s de not√≠cias e insights em tempo real

**√öltimos An√∫ncios**\
Fique informado com os mais novos lan√ßamentos de recompensas por bugs e atualiza√ß√µes cruciais da plataforma

**Junte-se a n√≥s no** [**Discord**](https://discord.com/invite/N3FrSbmwdy) e comece a colaborar com os melhores hackers hoje!

<details>

<summary><strong>Aprenda hacking no AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras maneiras de apoiar o HackTricks:

* Se voc√™ quer ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF** Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**merchandising oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe suas dicas de hacking enviando PRs para os reposit√≥rios do GitHub** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
