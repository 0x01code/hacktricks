# Teste de Penetra√ß√£o em Aplicativos Android

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Voc√™ trabalha em uma **empresa de seguran√ßa cibern√©tica**? Voc√™ quer ver sua **empresa anunciada no HackTricks**? ou voc√™ quer ter acesso √† **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**? Verifique os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* **Junte-se ao** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para o** [**reposit√≥rio hacktricks**](https://github.com/carlospolop/hacktricks) **e** [**reposit√≥rio hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

**HackenProof √© o lar de todas as recompensas por bugs de criptografia.**

**Seja recompensado sem atrasos**\
As recompensas do HackenProof s√£o lan√ßadas apenas quando os clientes depositam o or√ßamento de recompensa. Voc√™ receber√° a recompensa ap√≥s a verifica√ß√£o do bug.

**Adquira experi√™ncia em teste de penetra√ß√£o web3**\
Protocolos de blockchain e contratos inteligentes s√£o a nova Internet! Domine a seguran√ßa web3 em seus dias de ascens√£o.

**Torne-se a lenda do hacker web3**\
Ganhe pontos de reputa√ß√£o com cada bug verificado e conquiste o topo do leaderboard semanal.

[**Cadastre-se no HackenProof**](https://hackenproof.com/register) comece a ganhar com seus hacks!

{% embed url="https://hackenproof.com/register" %}

## Conceitos B√°sicos de Aplicativos Android

√â altamente recomendado come√ßar a ler esta p√°gina para conhecer as **partes mais importantes relacionadas √† seguran√ßa do Android e os componentes mais perigosos em um aplicativo Android**:

{% content-ref url="android-applications-basics.md" %}
[android-applications-basics.md](android-applications-basics.md)
{% endcontent-ref %}

## ADB (Android Debug Bridge)

Esta √© a principal ferramenta que voc√™ precisa para se conectar a um dispositivo Android (emulado ou f√≠sico).\
Ele permite que voc√™ controle seu dispositivo por **USB** ou **Rede** a partir de um computador, **copie** arquivos de ida e volta, **instale** e desinstale aplicativos, execute comandos **shell**, fa√ßa **backups**, leia **logs** e muito mais.

D√™ uma olhada na seguinte lista de [**Comandos ADB**](adb-commands.md) para aprender como usar o adb.

## Smali

√Äs vezes, √© interessante **modificar o c√≥digo do aplicativo** para acessar **informa√ß√µes ocultas** (talvez senhas ou flags bem ofuscadas). Nesse caso, pode ser interessante descompilar o apk, modificar o c√≥digo e recompil√°-lo.\
[**Neste tutorial** voc√™ pode **aprender como descompilar um APK, modificar o c√≥digo Smali e recompilar o APK** com a nova funcionalidade](smali-changes.md). Isso pode ser muito √∫til como uma **alternativa para v√°rios testes durante a an√°lise din√¢mica** que ser√£o apresentados. Portanto, **sempre tenha isso em mente**.

## Outros truques interessantes

* [Falsificando sua localiza√ß√£o na Play Store](spoofing-your-location-in-play-store.md)
* **Baixar APKs**: [https://apps.evozi.com/apk-downloader/](https://apps.evozi.com/apk-downloader/), [https://apkpure.com/es/](https://apkpure.com/es/), [https://www.apkmirror.com/](https://www.apkmirror.com), [https://apkcombo.com/es-es/apk-downloader/](https://apkcombo.com/es-es/apk-downloader/)
* Extrair APK do dispositivo:
```bash
adb shell pm list packages
com.android.insecurebankv2

adb shell pm path com.android.insecurebankv2
package:/data/app/com.android.insecurebankv2-Jnf8pNgwy3QA_U5f-n_4jQ==/base.apk

adb pull /data/app/com.android.insecurebankv2- Jnf8pNgwy3QA_U5f-n_4jQ==/base.apk
```
## An√°lise Est√°tica

Antes de tudo, para analisar um APK, voc√™ deve **dar uma olhada no c√≥digo Java** usando um decompilador.\
Por favor, [**leia aqui para encontrar informa√ß√µes sobre diferentes decompiladores dispon√≠veis**](apk-decompilers.md).

### Procurando por informa√ß√µes interessantes

Apenas olhando para as **strings** do APK, voc√™ pode procurar por **senhas**, **URLs** ([https://github.com/ndelphit/apkurlgrep](https://github.com/ndelphit/apkurlgrep)), **chaves de API**, **criptografia**, **UUIDs de Bluetooth**, **tokens** e qualquer coisa interessante... procure at√© mesmo por **backdoors** de execu√ß√£o de c√≥digo ou backdoors de autentica√ß√£o (credenciais de administrador codificadas no aplicativo).

**Firebase**

Preste aten√ß√£o especial √†s **URLs do Firebase** e verifique se est√£o mal configuradas. [Mais informa√ß√µes sobre o que √© o Firebase e como explor√°-lo aqui.](../../network-services-pentesting/pentesting-web/buckets/firebase-database.md)

### Compreens√£o b√°sica do aplicativo - Manifest.xml, strings.xml

Usando qualquer um dos **decompiladores** mencionados [**aqui**](apk-decompilers.md), voc√™ poder√° ler o _Manifest.xml_. Voc√™ tamb√©m pode **renomear** o arquivo APK para a extens√£o **.zip** e **descompact√°-lo**.\
Lendo o **manifesto**, voc√™ pode encontrar **vulnerabilidades**:

* Primeiro, verifique se **o aplicativo pode ser depurado**. Um APK de produ√ß√£o n√£o deve ser (ou outros poder√£o se conectar a ele). Voc√™ pode verificar se um aplicativo pode ser depurado procurando no manifesto pelo atributo `debuggable="true"` dentro da tag _\<application_ Exemplo: `<application theme="@2131296387" debuggable="true"`
* [Aprenda aqui](drozer-tutorial/#is-debuggeable) como encontrar aplicativos depur√°veis em um telefone e explor√°-los
* **Backup**: O atributo **`android:allowBackup`** define se os dados do aplicativo podem ser salvos e restaurados por um usu√°rio que habilitou a depura√ß√£o USB. Se a sinaliza√ß√£o de backup estiver definida como verdadeira, ela permite que um invasor fa√ßa backup dos dados do aplicativo via adb, mesmo que o dispositivo n√£o esteja rooteado. Portanto, os aplicativos que lidam e armazenam informa√ß√µes sens√≠veis, como detalhes do cart√£o, senhas etc., devem ter essa configura√ß√£o explicitamente definida como **false**, porque por padr√£o ela √© definida como **true** para evitar esses riscos.
* `<application android:allowBackup="false"`
* **NetworkSecurity:** A seguran√ßa de rede do aplicativo pode substituir os valores padr√£o com **`android:networkSecurityConfig="@xml/network_security_config"`**. Um arquivo com esse nome pode ser colocado em _**res/xml.**_ Este arquivo configurar√° configura√ß√µes de seguran√ßa importantes, como pinos de certificado ou se permite tr√°fego HTTP. Voc√™ pode ler aqui mais informa√ß√µes sobre todas as coisas que podem ser configuradas, mas verifique este exemplo sobre como configurar o tr√°fego HTTP para alguns dom√≠nios:
* `<domain-config cleartextTrafficPermitted="true"> <domain includeSubdomains="true">formation-software.co.uk </domain></domain-config>`
* **Atividades exportadas**: Verifique as atividades exportadas no manifesto, pois isso pode ser perigoso. Mais tarde, na an√°lise din√¢mica, ser√° explicado como [voc√™ pode abusar desse comportamento](./#exploiting-exported-activities-authorisation-bypass).
* **Provedores de conte√∫do**: Se um provedor exportado estiver sendo exposto, voc√™ poder√° acessar/modificar informa√ß√µes interessantes. Na an√°lise din√¢mica, [voc√™ aprender√° como abusar deles](./#exploiting-content-providers-accessing-and-manipulating-sensitive-information).
* Verifique as configura√ß√µes de **FileProviders** no atributo `android:name="android.support.FILE_PROVIDER_PATHS"`. [Leia aqui para saber mais sobre FileProviders](./#fileprovider).
* **Servi√ßos expostos**: Dependendo do que o servi√ßo est√° fazendo internamente, vulnerabilidades podem ser exploradas. Na an√°lise din√¢mica, [voc√™ aprender√° como abusar deles](./#exploiting-services).
* **Receptores de transmiss√£o**: [Voc√™ aprender√° como possivelmente explor√°-los](./#exploiting-broadcast-receivers) durante a an√°lise din√¢mica.
* **Esquema de URL**: Leia o c√≥digo da atividade que gerencia o esquema e procure por vulnerabilidades no gerenciamento da entrada do usu√°rio. Mais informa√ß√µes sobre [o que √© um esquema de URL aqui](./#url-schemes).
* **minSdkVersion**, **targetSDKVersion**, **maxSdkVersion**: Eles indicam as vers√µes do Android em que o aplicativo ser√° executado. √â importante ter isso em mente porque, do ponto de vista da seguran√ßa, suportar vers√µes antigas permitir√° que vers√µes vulner√°veis conhecidas do Android o executem.

Lendo **resources.arsc/strings.xml**, voc√™ pode encontrar algumas **informa√ß√µes interessantes**:

* Chaves de API
* Esquemas personalizados
* Outras informa√ß√µes interessantes que os desenvolvedores salvam neste arquivo

### Tapjacking



### Sequestro de Tarefas

Uma **atividade** com o **`launchMode`** definido como **`singleTask` sem nenhuma `taskAffinity`** definida √© vulner√°vel a sequestro de tarefas. Isso significa que um **aplicativo** pode ser instalado e, se for iniciado antes do aplicativo real, ele pode **sequestrar a tarefa do aplicativo real** (ent√£o o usu√°rio estar√° interagindo com o **aplicativo malicioso pensando que est√° usando o real**).

Mais informa√ß√µes em:

{% content-ref url="android-task-hijacking.md" %}
[android-task-hijacking.md](android-task-hijacking.md)
{% endcontent-ref %}

### Armazenamento inseguro de dados

**Armazenamento interno**

Arquivos **criados** no **armazenamento interno** s√£o **acess√≠veis** apenas pelo **aplicativo**. Essa prote√ß√£o √© implementada pelo Android e √© suficiente para a maioria dos aplicativos. No entanto, os desenvolvedores frequentemente usam `MODE_WORLD_READBALE` e `MODE_WORLD_WRITABLE` para dar acesso a esses arquivos a um aplicativo diferente, mas isso n√£o impede que outros aplicativos (maliciosos) acessem esses arquivos.\
Durante a **an√°lise est√°tica**, verifique o uso desses **modos**, durante a **an√°lise din√¢mica**, verifique as **permiss√µes** dos arquivos criados (talvez alguns deles sejam leg√≠veis/grav√°veis em todo o mundo).\
[Mais informa√ß√µes sobre essa vulnerabilidade e como corrigi-la aqui.](https://manifestsecurity.com/android-application-security-part-8/)

**Armazenamento externo**

Arquivos criados no **armazenamento externo**, como cart√µes SD, s√£o **leg√≠veis e grav√°veis globalmente**. Como o armazenamento externo pode ser removido pelo usu√°rio e tamb√©m modificado por qualquer aplicativo, voc√™ n√£o deve armazenar informa√ß√µes sens√≠veis usando o armazenamento externo.\
Assim como dados de qualquer fonte n√£o confi√°vel, voc√™ deve **realizar valida√ß√£o de entrada** ao lidar com **dados do armazenamento externo**. Recomendamos fortemente que voc√™ n√£o armazene arquivos execut√°veis ou arquivos de classe no armazenamento externo antes do carregamento din√¢mico. Se o seu aplicativo recuperar arquivos execut√°veis do armazenamento externo, os arquivos devem ser assinados e verificados criptograficamente antes do carregamento din√¢mico.\
Informa√ß√µes retiradas daqui [aqui](https://manifestsecurity.com/android-application-security-part-8/).

O armazenamento externo pode ser **acessado** em `/storage/emulated/0`, `/sdcard`, `/mnt/sdcard`

{% hint style="info" %}
A partir do Android 4.4 (**API 17**), o cart√£o SD possui uma estrutura de diret√≥rios que **limita o acesso de um aplicativo ao diret√≥rio espec√≠fico para esse aplicativo**. Isso impede que aplicativos maliciosos tenham acesso de leitura ou grava√ß√£o aos arquivos de outro aplicativo.
{% endhint %}

**Dados sens√≠veis armazenados em texto simples**

* **Prefer√™ncias compartilhadas**: O Android permite que cada aplicativo salve facilmente arquivos XML no caminho `/data/data/<nomedopacote>/shared_prefs/` e √†s vezes √© poss√≠vel encontrar informa√ß√µes sens√≠veis em texto simples nessa pasta.
* **Bancos de dados**: O Android permite que cada aplicativo salve facilmente bancos de dados SQLite no caminho `/data/data/<nomedopacote>/databases/` e √†s vezes √© poss√≠vel encontrar informa√ß√µes sens√≠veis em texto simples nessa pasta.
### TLS Quebrado

**Aceitar Todos os Certificados**

Por algum motivo, √†s vezes os desenvolvedores aceitam todos os certificados, mesmo que, por exemplo, o nome do host n√£o corresponda com as linhas de c√≥digo como a seguinte:
```java
SSLSocketFactory sf = new cc(trustStore);
sf.setHostnameVerifier(SSLSocketFactory.ALLOW_ALL_HOSTNAME_VERIFIER);
```
Uma boa maneira de testar isso √© tentar capturar o tr√°fego usando um proxy como o Burp sem autorizar o CA do Burp dentro do dispositivo. Al√©m disso, voc√™ pode gerar com o Burp um certificado para um nome de host diferente e us√°-lo.

### Criptografia quebrada

**Processos de gerenciamento de chave fracos**

Alguns desenvolvedores salvam dados sens√≠veis no armazenamento local e os criptografam com uma chave codificada/previs√≠vel no c√≥digo. Isso n√£o deve ser feito, pois a revers√£o pode permitir que os atacantes extraiam as informa√ß√µes confidenciais.

**Uso de algoritmos inseguros e/ou obsoletos**

Os desenvolvedores n√£o devem usar algoritmos **obsoletos** para realizar **verifica√ß√µes** de **autoriza√ß√£o**, **armazenar** ou **enviar** dados. Alguns desses algoritmos s√£o: RC4, MD4, MD5, SHA1... Se **hashes** forem usados para armazenar senhas, por exemplo, devem ser usados hashes **resistentes** a ataques de for√ßa bruta com sal.

### Outras verifica√ß√µes

* √â recomendado **ofuscar o APK** para dificultar o trabalho de engenharia reversa para os atacantes.
* Se o aplicativo for sens√≠vel (como aplicativos banc√°rios), ele deve realizar suas **pr√≥prias verifica√ß√µes para ver se o dispositivo m√≥vel est√° rooteado** e agir em consequ√™ncia.
* Se o aplicativo for sens√≠vel (como aplicativos banc√°rios), ele deve verificar se est√° sendo usado um **emulador**.
* Se o aplicativo for sens√≠vel (como aplicativos banc√°rios), ele deve **verificar sua pr√≥pria integridade antes de execut√°-lo** para verificar se foi modificado.
* Use o [**APKiD**](https://github.com/rednaga/APKiD) para verificar qual compilador/packer/ofuscador foi usado para construir o APK.

### Aplicativo React Native

Leia a seguinte p√°gina para aprender como acessar facilmente o c√≥digo JavaScript de aplicativos React:

{% content-ref url="react-native-application.md" %}
[react-native-application.md](react-native-application.md)
{% endcontent-ref %}

### Aplicativos Xamarin

Leia a seguinte p√°gina para aprender como acessar facilmente o c√≥digo C# de aplicativos Xamarin:

{% content-ref url="../xamarin-apps.md" %}
[xamarin-apps.md](../xamarin-apps.md)
{% endcontent-ref %}

### Aplicativos Superpacked

De acordo com este [**post de blog**](https://clearbluejar.github.io/posts/desuperpacking-meta-superpacked-apks-with-github-actions/), superpacked √© um meta algoritmo que comprime o conte√∫do de um aplicativo em um √∫nico arquivo. O blog fala sobre a possibilidade de criar um aplicativo que descomprima esse tipo de aplicativo... e uma maneira mais r√°pida que envolve **executar o aplicativo e coletar os arquivos descomprimidos do sistema de arquivos**.

### An√°lise Est√°tica Automatizada de C√≥digo

A ferramenta [**mariana-trench**](https://github.com/facebook/mariana-trench) √© capaz de encontrar **vulnerabilidades** ao **analisar** o **c√≥digo** do aplicativo. Essa ferramenta cont√©m uma s√©rie de **fontes conhecidas** (que indicam √† ferramenta os **locais** onde a **entrada** √© **controlada pelo usu√°rio**), **sinks** (que indicam √† ferramenta **locais perigosos** onde a entrada maliciosa do usu√°rio pode causar danos) e **regras**. Essas regras indicam a **combina√ß√£o** de **fontes-sinks** que indica uma vulnerabilidade.

Com esse conhecimento, o **mariana-trench revisar√° o c√≥digo e encontrar√° poss√≠veis vulnerabilidades** nele.

### Vazamento de segredos

Um aplicativo pode conter segredos (chaves de API, senhas, URLs ocultas, subdom√≠nios...) que voc√™ pode descobrir. Voc√™ pode usar uma ferramenta como [https://github.com/dwisiswant0/apkleaks](https://github.com/dwisiswant0/apkleaks)

### Bypass na autentica√ß√£o biom√©trica

{% content-ref url="bypass-biometric-authentication-android.md" %}
[bypass-biometric-authentication-android.md](bypass-biometric-authentication-android.md)
{% endcontent-ref %}

### Outras fun√ß√µes interessantes

* **Execu√ß√£o de c√≥digo**: `Runtime.exec(), ProcessBuilder(), c√≥digo nativo: system()`
* **Envio de SMS**: `sendTextMessage, sendMultipartTestMessage`
* **Fun√ß√µes nativas** declaradas como `native`: `public native, System.loadLibrary, System.load`
* [Leia isso para aprender **como reverter fun√ß√µes nativas**](reversing-native-libraries.md)

### **Outros truques**

{% content-ref url="content-protocol.md" %}
[content-protocol.md](content-protocol.md)
{% endcontent-ref %}

***

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

**HackenProof √© o lar de todas as recompensas por bugs de criptografia.**

**Seja recompensado sem atrasos**\
As recompensas do HackenProof s√£o lan√ßadas apenas quando os clientes depositam o or√ßamento da recompensa. Voc√™ receber√° a recompensa ap√≥s a verifica√ß√£o do bug.

**Adquira experi√™ncia em pentesting web3**\
Protocolos de blockchain e contratos inteligentes s√£o a nova Internet! Domine a seguran√ßa web3 em seus dias de ascens√£o.

**Torne-se a lenda do hacker web3**\
Ganhe pontos de reputa√ß√£o com cada bug verificado e conquiste o topo do leaderboard semanal.

[**Cadastre-se no HackenProof**](https://hackenproof.com/register) e comece a ganhar com seus hacks!

{% embed url="https://hackenproof.com/register" %}

***

## An√°lise Din√¢mica

> Primeiro, voc√™ precisa de um ambiente onde possa instalar o aplicativo e todo o ambiente (certificado CA do Burp, Drozer e Frida principalmente). Portanto, um dispositivo com root (emulado ou n√£o) √© extremamente recomendado.

### An√°lise Din√¢mica Online

Voc√™ pode criar uma **conta gratuita** em: [https://appetize.io/](https://appetize.io). Essa plataforma permite que voc√™ **fa√ßa upload** e **execute** APKs, sendo √∫til para ver como um APK est√° se comportando.

Voc√™ pode at√© **ver os logs do seu aplicativo** na web e se conectar por meio do **adb**.

![](<../../.gitbook/assets/image (60).png>)

Gra√ßas √† conex√£o ADB, voc√™ pode usar o **Drozer** e o **Frida** nos emuladores.

### An√°lise Din√¢mica Local

#### Usando um emulador

* [**Android Studio**](https://developer.android.com/studio) (Voc√™ pode criar dispositivos **x86** e **arm**, e de acordo com [**este** ](https://android-developers.googleblog.com/2020/03/run-arm-apps-on-android-emulator.html)**√∫ltimas vers√µes x86** suportam bibliotecas ARM sem precisar de um emulador ARM lento).
* Aprenda a configur√°-lo nesta p√°gina:

{% content-ref url="avd-android-virtual-device.md" %}
[avd-android-virtual-device.md](avd-android-virtual-device.md)
{% endcontent-ref %}

* [**Genymotion**](https://www.genymotion.com/fun-zone/) **(Vers√£o gratuita:** Personal Edition, voc√™ precisa criar uma conta. _√â recomendado **baixar** a vers√£o **COM**_ _**VirtualBox** para evitar erros potenciais._)
* [**Nox**](https://es.bignox.com) (Gratuito, mas n√£o suporta Frida ou Drozer).

{% hint style="info" %}
Ao criar um novo emulador em qualquer plataforma, lembre-se de que quanto maior a tela, mais lento o emulador ser√° executado. Portanto, selecione telas pequenas, se poss√≠vel.
{% endhint %}

Para **instalar servi√ßos do Google** (como AppStore) no Genymotion, voc√™ precisa clicar no bot√£o marcado em vermelho na seguinte imagem:

![](<../../.gitbook/assets/image (200) (1).png>)

Al√©m disso, observe que na **configura√ß√£o da VM Android no Genymotion** voc√™ pode selecionar o modo de **Bridge Network** (isso ser√° √∫til se voc√™ estiver se conectando √† VM Android de uma VM diferente com as ferramentas).
#### Usar um dispositivo f√≠sico

Voc√™ precisa ativar as op√ß√µes de **depura√ß√£o** e seria bom se voc√™ pudesse **rootear**:

1. **Configura√ß√µes**.
2. (A partir do Android 8.0) Selecione **Sistema**.
3. Selecione **Sobre o telefone**.
4. Pressione **N√∫mero da vers√£o** 7 vezes.
5. Volte e voc√™ encontrar√° as **Op√ß√µes do desenvolvedor**.

> Depois de instalar o aplicativo, a primeira coisa que voc√™ deve fazer √© test√°-lo e investigar o que ele faz, como funciona e se familiarizar com ele.\
> Sugiro **realizar essa an√°lise din√¢mica inicial usando a an√°lise din√¢mica do MobSF + pidcat**, para que voc√™ possa **aprender como o aplicativo funciona** enquanto o MobSF **captura** muitos **dados** **interessantes** que voc√™ pode revisar posteriormente.

### Vazamento de dados n√£o intencional

**Registro**

Muitas vezes, os desenvolvedores deixam informa√ß√µes de depura√ß√£o publicamente. Portanto, qualquer aplicativo com permiss√£o `READ_LOGS` pode **acessar esses registros** e obter informa√ß√µes sens√≠veis por meio deles.\
Ao navegar pelo aplicativo, use o [**pidcat**](https://github.com/JakeWharton/pidcat)_(Recomendado, √© mais f√°cil de usar e ler)_ ou [adb logcat](adb-commands.md#logcat) para ler os registros criados e **procurar informa√ß√µes sens√≠veis**.

{% hint style="warning" %}
Observe que, a partir das vers√µes posteriores ao Android 4.0, **os aplicativos s√≥ podem acessar seus pr√≥prios registros**. Portanto, os aplicativos n√£o podem acessar os registros de outros aplicativos.\
De qualquer forma, ainda √© recomendado **n√£o registrar informa√ß√µes sens√≠veis**.
{% endhint %}

**Armazenamento em buffer de c√≥pia/colagem**

O Android fornece um framework baseado em **clipboard** para fornecer a fun√ß√£o de copiar e colar em aplicativos Android. Mas isso cria um problema s√©rio quando algum **outro aplicativo** pode **acessar** a **√°rea de transfer√™ncia** que cont√©m dados sens√≠veis. A fun√ß√£o de **copiar/colar** deve ser **desativada** para **partes sens√≠veis** do aplicativo. Por exemplo, desative a c√≥pia de detalhes do cart√£o de cr√©dito.

**Registros de falhas**

Se um aplicativo **falhar** durante a execu√ß√£o e **salvar registros** em algum lugar, esses registros podem ser √∫teis para um atacante, especialmente nos casos em que o aplicativo Android n√£o pode ser engenharia reversa. Portanto, evite criar registros quando o aplicativo falhar e, se os registros forem enviados pela rede, verifique se eles s√£o enviados por um canal SSL.\
Como pentester, **tente dar uma olhada nesses registros**.

**Dados de an√°lise enviados para terceiros**

A maioria dos aplicativos usa outros servi√ßos em seu aplicativo, como o Google Adsense, mas √†s vezes eles **vazam alguns dados sens√≠veis** ou dados que n√£o precisam ser enviados para esse servi√ßo. Isso pode acontecer porque o desenvolvedor n√£o implementou o recurso corretamente. Voc√™ pode **verificar interceptando o tr√°fego** do aplicativo e ver se algum dado sens√≠vel √© enviado para terceiros ou n√£o.

### Bancos de dados SQLite

A maioria dos aplicativos usar√° **bancos de dados SQLite internos** para salvar informa√ß√µes. Durante o pentest, d√™ uma **olhada** nos **bancos de dados** criados, nos nomes das **tabelas** e **colunas** e em todos os **dados** salvos, pois voc√™ pode encontrar **informa√ß√µes sens√≠veis** (o que seria uma vulnerabilidade).\
Os bancos de dados devem estar localizados em `/data/data/o.nome.do.pacote/databases`, como `/data/data/com.mwr.example.sieve/databases`

Se o banco de dados estiver salvando informa√ß√µes confidenciais e estiver **criptografado**, mas voc√™ pode **encontrar** a **senha** dentro do aplicativo, ainda √© uma **vulnerabilidade**.

Enumere as tabelas usando `.tables` e enumere as colunas das tabelas usando `.schema <nome_da_tabela>`

### Drozer (Explorando Atividades, Provedores de Conte√∫do e Servi√ßos)

**Drozer** permite que voc√™ **assuma o papel de um aplicativo Android** e interaja com outros aplicativos. Ele pode fazer **tudo o que um aplicativo instalado pode fazer**, como usar o mecanismo de Comunica√ß√£o entre Processos (IPC) do Android e interagir com o sistema operacional subjacente. Do [Guia do Drozer](https://labs.mwrinfosecurity.com/assets/BlogFiles/mwri-drozer-user-guide-2015-03-23.pdf).\
Drozer √© uma ferramenta √∫til para **explorar atividades exportadas, servi√ßos exportados e Provedores de Conte√∫do**, como voc√™ aprender√° nas se√ß√µes a seguir.

### Explorando atividades exportadas

[**Leia isso se voc√™ quiser relembrar o que √© uma Atividade Android.**](android-applications-basics.md#launcher-activity-and-other-activities)\
Lembre-se tamb√©m de que o c√≥digo de uma atividade come√ßa com o m√©todo `onCreate`.

**Burla de autoriza√ß√£o**

Quando uma atividade √© exportada, voc√™ pode invocar sua tela de um aplicativo externo. Portanto, se uma atividade com **informa√ß√µes sens√≠veis** for **exportada**, voc√™ pode **burlar** os mecanismos de **autentica√ß√£o** para acess√°-la.\
[**Aprenda como explorar atividades exportadas com o Drozer.**](drozer-tutorial/#activities)

Voc√™ tamb√©m pode iniciar uma atividade exportada pelo adb:

* PackageName √© com.example.demo
* Nome da atividade exportada √© com.example.test.MainActivity
```bash
adb shell am start -n com.example.demo/com.example.test.MainActivity
```
**NOTA**: O MobSF detectar√° como malicioso o uso de _**singleTask/singleInstance**_ como `android:launchMode` em uma atividade, mas devido a [isso](https://github.com/MobSF/Mobile-Security-Framework-MobSF/pull/750), aparentemente isso √© apenas perigoso em vers√µes antigas (vers√µes de API < 21).

{% hint style="info" %}
Observe que uma viola√ß√£o de autoriza√ß√£o nem sempre √© uma vulnerabilidade, isso depender√° de como a viola√ß√£o funciona e quais informa√ß√µes s√£o expostas.
{% endhint %}

**Vazamento de informa√ß√µes sens√≠veis**

**As atividades tamb√©m podem retornar resultados**. Se voc√™ conseguir encontrar uma atividade exportada e desprotegida que chame o m√©todo **`setResult`** e **retorne informa√ß√µes sens√≠veis**, haver√° um vazamento de informa√ß√µes sens√≠veis.

#### Tapjacking

Se o tapjacking n√£o for prevenido, voc√™ poder√° abusar da atividade exportada para fazer com que o **usu√°rio execute a√ß√µes inesperadas**. Para obter mais informa√ß√µes sobre [**o que √© Tapjacking, siga o link**](./#tapjacking).

### Explorando Provedores de Conte√∫do - Acessando e manipulando informa√ß√µes sens√≠veis

[**Leia isso se voc√™ quiser relembrar o que √© um Provedor de Conte√∫do.**](android-applications-basics.md#content-provider)\
Os provedores de conte√∫do s√£o basicamente usados para **compartilhar dados**. Se um aplicativo tiver provedores de conte√∫do dispon√≠veis, voc√™ poder√° **extrair** dados **sens√≠veis** deles. Tamb√©m √© interessante testar poss√≠veis **inje√ß√µes de SQL** e **travessias de caminho**, pois eles podem ser vulner√°veis.\
[**Aprenda como explorar Provedores de Conte√∫do com o Drozer.**](drozer-tutorial/#content-providers)

### **Explorando Servi√ßos**

[**Leia isso se voc√™ quiser relembrar o que √© um Servi√ßo.**](android-applications-basics.md#services)\
Lembre-se de que as a√ß√µes de um servi√ßo come√ßam no m√©todo `onStartCommand`.

Um servi√ßo √© basicamente algo que **pode receber dados**, **process√°-los** e **retornar** (ou n√£o) uma resposta. Portanto, se um aplicativo estiver exportando alguns servi√ßos, voc√™ deve **verificar** o **c√≥digo** para entender o que ele est√° fazendo e **test√°-lo** **dinamicamente** para extrair informa√ß√µes confidenciais, contornar medidas de autentica√ß√£o...\
[**Aprenda como explorar Servi√ßos com o Drozer.**](drozer-tutorial/#services)

### **Explorando Receptores de Transmiss√£o**

[**Leia isso se voc√™ quiser relembrar o que √© um Receptor de Transmiss√£o.**](android-applications-basics.md#broadcast-receivers)\
Lembre-se de que as a√ß√µes de um Receptor de Transmiss√£o come√ßam no m√©todo `onReceive`.

Um receptor de transmiss√£o estar√° aguardando um tipo de mensagem. Dependendo de como o receptor manipula a mensagem, ele pode ser vulner√°vel.\
[**Aprenda como explorar Receptores de Transmiss√£o com o Drozer.**](./#exploiting-broadcast-receivers)

### **Explorando Esquemas / Deep links**

Voc√™ pode procurar deep links manualmente, usando ferramentas como o MobSF ou scripts como [este](https://github.com/ashleykinguk/FBLinkBuilder/blob/master/FBLinkBuilder.py).\
Voc√™ pode **abrir** um **esquema** declarado usando o **adb** ou um **navegador**:

{% code overflow="wrap" %}
```bash
adb shell am start -a android.intent.action.VIEW -d "scheme://hostname/path?param=value" [your.package.name]
```
{% endcode %}

_Observa√ß√£o: voc√™ pode **omitir o nome do pacote** e o celular automaticamente chamar√° o aplicativo que deve abrir esse link._

{% code overflow="wrap" %}
```markup
<!-- Browser regular link -->
<a href="scheme://hostname/path?param=value">Click me</a>
<!-- fallback in your url you could try the intent url -->
<a href="intent://hostname#Intent;scheme=scheme;package=your.package.name;S.browser_fallback_url=http%3A%2F%2Fwww.example.com;end">with alternative</a>
```
{% endcode %}

**C√≥digo executado**

Para encontrar o **c√≥digo que ser√° executado no aplicativo**, v√° para a atividade chamada pelo deep link e procure a fun√ß√£o **`onNewIntent`**.

![](<../../.gitbook/assets/image (436) (1) (1) (1).png>)

**Informa√ß√µes sens√≠veis**

Sempre que encontrar um deep link, verifique se ele n√£o est√° recebendo dados sens√≠veis (como senhas) por meio de par√¢metros de URL, pois qualquer outro aplicativo pode **se passar pelo deep link e roubar esses dados!**

**Par√¢metros no caminho**

Voc√™ tamb√©m **deve verificar se algum deep link est√° usando um par√¢metro dentro do caminho** da URL, como: `https://api.example.com/v1/users/{username}`, nesse caso voc√™ pode for√ßar uma travessia de caminho acessando algo como: `example://app/users?username=../../unwanted-endpoint%3fparam=value`.\
Observe que se voc√™ encontrar os endpoints corretos dentro do aplicativo, poder√° causar um **Redirecionamento Aberto** (se parte do caminho for usado como nome de dom√≠nio), **assumir a conta** (se voc√™ puder modificar os detalhes dos usu√°rios sem token CSRF e o endpoint vulner√°vel usar o m√©todo correto) e qualquer outra vulnerabilidade. Mais [informa√ß√µes sobre isso aqui](http://dphoeniixx.com/2020/12/13-2/).

**Mais exemplos**

Um [relat√≥rio interessante de recompensa por bugs](https://hackerone.com/reports/855618) sobre links (_/.well-known/assetlinks.json_).

### Prote√ß√£o Insuficiente da Camada de Transporte

* **Falta de Inspe√ß√£o de Certificado:** O aplicativo Android n√£o verifica a identidade do certificado apresentado a ele. A maioria dos aplicativos ignora os avisos e aceita qualquer certificado autoassinado apresentado. Alguns aplicativos, em vez disso, passam o tr√°fego por uma conex√£o HTTP.
* **Negocia√ß√£o de Handshake Fraca:** O aplicativo e o servidor realizam um handshake SSL/TLS, mas usam uma su√≠te de criptografia insegura que √© vulner√°vel a ataques MITM. Assim, qualquer atacante pode facilmente descriptografar essa conex√£o.
* **Vazamento de Informa√ß√µes de Privacidade:** Na maioria das vezes, acontece que os aplicativos fazem autentica√ß√£o por meio de um canal seguro, mas todas as outras conex√µes s√£o feitas por meio de um canal n√£o seguro. Isso n√£o adiciona seguran√ßa ao aplicativo, pois dados sens√≠veis restantes, como cookie de sess√£o ou dados do usu√°rio, podem ser interceptados por um usu√°rio mal-intencionado.

Dos 3 cen√°rios apresentados, vamos discutir **como verificar a identidade do certificado**. Os outros 2 cen√°rios dependem da **configura√ß√£o do TLS** do servidor e se o **aplicativo envia dados n√£o criptografados**. O pentester deve verificar por conta pr√≥pria a configura√ß√£o do TLS do servidor ([aqui](../../network-services-pentesting/pentesting-web/#ssl-tls-vulnerabilites)) e detectar se alguma **informa√ß√£o confidencial √© enviada por um canal n√£o criptografado/vulner√°vel**.\
Mais informa√ß√µes sobre como descobrir e corrigir esse tipo de vulnerabilidade [**aqui**](https://manifestsecurity.com/android-application-security-part-10/).

**SSL Pinning**

Por padr√£o, ao fazer uma conex√£o SSL, o cliente (aplicativo Android) verifica se o certificado do servidor possui uma cadeia de confian√ßa verific√°vel at√© um certificado confi√°vel (raiz) e corresponde ao nome do host solicitado. Isso leva ao problema de **Ataques Man-in-the-Middle (MITM)**.\
No SSL Pinning, um aplicativo Android cont√©m o certificado do servidor e s√≥ transmite dados se o mesmo certificado for apresentado.\
√â recomendado **aplicar o SSL Pinning** nos sites onde informa√ß√µes sens√≠veis ser√£o enviadas.

### Inspe√ß√£o do tr√°fego HTTP

Antes de tudo, voc√™ deve (deve) **instalar o certificado** da ferramenta de **proxy** que voc√™ vai usar, provavelmente o Burp. Se voc√™ n√£o instalar o certificado CA da ferramenta de proxy, provavelmente n√£o ver√° o tr√°fego criptografado no proxy.\
**Por favor,** [**leia este guia para aprender como instalar um certificado CA personalizado**](android-burp-suite-settings.md)**.**

Para aplicativos direcionados ao **API Level 24+ n√£o √© suficiente instalar o certificado CA** do Burp no dispositivo. Para contornar essa nova prote√ß√£o, voc√™ precisa modificar o arquivo de Configura√ß√£o de Seguran√ßa de Rede. Portanto, voc√™ pode modificar esse arquivo para autorizar seu certificado CA ou pode [**ler esta p√°gina para um tutorial sobre como for√ßar o aplicativo a aceitar novamente todos os certificados instalados no dispositivo**](make-apk-accept-ca-certificate.md).

**SSL Pinning**

J√° discutimos o que √© o SSL Pinning apenas 2 par√°grafos antes. Quando implementado em um aplicativo, voc√™ precisar√° contorn√°-lo para inspecionar o tr√°fego HTTPS ou n√£o o ver√°.\
Aqui vou apresentar algumas op√ß√µes que usei para contornar essa prote√ß√£o:

* **Modificar automaticamente** o **apk** para **contornar** o SSL Pinning com [**apk-mitm**](https://github.com/shroudedcode/apk-mitm). A melhor vantagem dessa op√ß√£o √© que voc√™ n√£o precisar√° de acesso root para contornar o SSL Pinning, mas precisar√° excluir o aplicativo e reinstalar o novo, e isso nem sempre funcionar√°.
* Voc√™ pode usar o **Frida** (discutido abaixo) para contornar essa prote√ß√£o. Aqui est√° um guia para usar Burp+Frida+Genymotion: [https://spenkk.github.io/bugbounty/Configuring-Frida-with-Burp-and-GenyMotion-to-bypass-SSL-Pinning/](https://spenkk.github.io/bugbounty/Configuring-Frida-with-Burp-and-GenyMotion-to-bypass-SSL-Pinning/)
* Voc√™ tamb√©m pode tentar **contornar automaticamente o SSL Pinning** usando [**objection**](frida-tutorial/objection-tutorial.md)**:** `objection --gadget com.package.app explore --startup-command "android sslpinning disable"`
* Voc√™ tamb√©m pode tentar **contornar automaticamente o SSL Pinning** usando a **an√°lise din√¢mica do MobSF** (explicada abaixo)
* Se voc√™ ainda acha que h√° algum tr√°fego que n√£o est√° capturando, pode tentar **encaminhar o tr√°fego para o burp usando iptables**. Leia este blog: [https://infosecwriteups.com/bypass-ssl-pinning-with-ip-forwarding-iptables-568171b52b62](https://infosecwriteups.com/bypass-ssl-pinning-with-ip-forwarding-iptables-568171b52b62)

**Vulnerabilidades Web comuns**

Observe que nesta etapa voc√™ deve procurar por vulnerabilidades web comuns. Muitas informa√ß√µes sobre vulnerabilidades web podem ser encontradas neste livro, ent√£o n√£o vou mencion√°-las aqui.

### Frida

Kit de instrumenta√ß√£o din√¢mica para desenvolvedores, engenheiros reversos e pesquisadores de seguran√ßa. Saiba mais em [www.frida.re](https://www.frida.re).\
**√â incr√≠vel, voc√™ pode acessar o aplicativo em execu√ß√£o e interceptar m√©todos em tempo de execu√ß√£o para alterar o comportamento, alterar valores, extrair valores, executar c√≥digo diferente...**\
**Se voc√™ deseja fazer pentest em aplicativos Android, precisa saber como usar o Frida.**

**Aprenda a usar o Frida:** [**Tutorial do Frida**](frida-tutorial/)\
**Algumas "GUI" para a√ß√µes com o Frida:** [**https://github.com/m0bilesecurity/RMS-Runtime-Mobile-Security**](https://github.com/m0bilesecurity/RMS-Runtime-Mobile-Security)\
**Algumas outras abstra√ß√µes baseadas no Frida:** [**https://github.com/sensepost/objection**](https://github.com/sensepost/objection) **,** [**https://github.com/dpnishant/appmon**](https://github.com/dpnishant/appmon)\
**Voc√™ pode encontrar alguns scripts incr√≠veis do Frida aqui:** [**https://codeshare.frida.re/**](https://codeshare.frida.re)
### **Dump de Mem√≥ria - Fridump**

Verifique se o aplicativo est√° armazenando informa√ß√µes sens√≠veis na mem√≥ria que n√£o deveria estar armazenando, como senhas ou mnem√¥nicos.

Usando o [**Fridump3**](https://github.com/rootbsd/fridump3), voc√™ pode fazer o dump da mem√≥ria do aplicativo com:
```bash
# With PID
python3 fridump3.py -u <PID>

# With name
frida-ps -Uai
python3 fridump3.py -u "<Name>"
```
Isso ir√° despejar a mem√≥ria na pasta ./dump e l√° voc√™ pode usar o comando grep com algo como:

{% code overflow="wrap" %}
```bash
strings * | grep -E "^[a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+$"
```
{% endcode %}

### **Dados sens√≠veis no Keystore**

No Android, o Keystore √© o melhor lugar para armazenar dados sens√≠veis, no entanto, com privil√©gios suficientes, ainda √© **poss√≠vel acess√°-lo**. Como os aplicativos tendem a armazenar aqui **dados sens√≠veis em texto claro**, os testes de penetra√ß√£o devem verificar isso, pois um usu√°rio root ou algu√©m com acesso f√≠sico ao dispositivo pode ser capaz de roubar esses dados.

Mesmo que um aplicativo armazene dados no keystore, os dados devem ser criptografados.

Para acessar os dados dentro do keystore, voc√™ pode usar este script do Frida: [https://github.com/WithSecureLabs/android-keystore-audit/blob/master/frida-scripts/tracer-cipher.js](https://github.com/WithSecureLabs/android-keystore-audit/blob/master/frida-scripts/tracer-cipher.js)
```bash
frida -U -f com.example.app -l frida-scripts/tracer-cipher.js
```
### **Analisador de Aplicativos Android**

Esta ferramenta pode ajud√°-lo a gerenciar diferentes ferramentas durante a an√°lise din√¢mica: [https://github.com/NotSoSecure/android\_application\_analyzer](https://github.com/NotSoSecure/android\_application\_analyzer)

### Inje√ß√£o de Inten√ß√£o

Essa vulnerabilidade se assemelha ao **Redirecionamento Aberto na seguran√ßa da web**. Como a classe `Intent` √© `Parcelable`, **objetos pertencentes a essa classe** podem ser **passados** como **dados extras** em outro objeto `Intent`.\
Muitos desenvolvedores fazem **uso** dessa **funcionalidade** e criam **componentes proxy** (atividades, receptores de transmiss√£o e servi√ßos) que **recebem uma Inten√ß√£o incorporada e a passam para m√©todos perigosos** como `startActivity(...)`, `sendBroadcast(...)`, etc.\
Isso √© perigoso porque **um invasor pode for√ßar o aplicativo a iniciar um componente n√£o exportado que n√£o pode ser iniciado diretamente de outro aplicativo**, ou conceder ao invasor acesso aos seus provedores de conte√∫do. **`WebView`** √†s vezes tamb√©m altera um **URL de uma string para um objeto `Intent`**, usando o m√©todo `Intent.parseUri(...)`, e o passa para `startActivity(...)`.

### Inje√ß√µes no Lado do Cliente Android e outros

Provavelmente voc√™ j√° conhece esse tipo de vulnerabilidade na Web. Voc√™ deve ter cuidado especial com essas vulnerabilidades em um aplicativo Android:

* **Inje√ß√£o de SQL:** Ao lidar com consultas din√¢micas ou provedores de conte√∫do, verifique se est√° usando consultas parametrizadas.
* **Inje√ß√£o de JavaScript (XSS):** Verifique se o suporte a JavaScript e plugins est√° desativado para qualquer WebView (desativado por padr√£o). [Mais informa√ß√µes aqui](webview-attacks.md#javascript-enabled).
* **Inclus√£o de Arquivo Local:** Verifique se o acesso ao sistema de arquivos est√° desativado para qualquer WebView (ativado por padr√£o) `(webview.getSettings().setAllowFileAccess(false);)`. [Mais informa√ß√µes aqui](webview-attacks.md#javascript-enabled).
* **Cookies eternos**: Em v√°rios casos, quando o aplicativo Android encerra a sess√£o, o cookie n√£o √© revogado ou pode at√© ser salvo no disco.
* [**Flag Segura** em cookies](../../pentesting-web/hacking-with-cookies/#cookies-flags)

***

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

**HackenProof √© o lar de todas as recompensas por bugs de criptografia.**

**Seja recompensado sem atrasos**\
As recompensas do HackenProof s√£o lan√ßadas apenas quando seus clientes depositam o or√ßamento de recompensa. Voc√™ receber√° a recompensa ap√≥s a verifica√ß√£o do bug.

**Adquira experi√™ncia em pentesting web3**\
Protocolos de blockchain e contratos inteligentes s√£o a nova Internet! Domine a seguran√ßa web3 em seus dias de ascens√£o.

**Torne-se a lenda do hacker web3**\
Ganhe pontos de reputa√ß√£o com cada bug verificado e conquiste o topo do leaderboard semanal.

[**Cadastre-se no HackenProof**](https://hackenproof.com/register) comece a ganhar com seus hacks!

{% embed url="https://hackenproof.com/register" %}

## An√°lise Autom√°tica

### [MobSF](https://github.com/MobSF/Mobile-Security-Framework-MobSF)

**An√°lise est√°tica**

![](<../../.gitbook/assets/image (61).png>)

**Avalia√ß√£o de vulnerabilidades do aplicativo** usando uma interface web agrad√°vel. Voc√™ tamb√©m pode realizar an√°lise din√¢mica (mas precisa preparar o ambiente).
```bash
docker pull opensecurity/mobile-security-framework-mobsf
docker run -it -p 8000:8000 opensecurity/mobile-security-framework-mobsf:latest
```
Observe que o MobSF pode analisar aplicativos **Android** (apk), **IOS** (ipa) e **Windows** (apx) (_os aplicativos do Windows devem ser analisados a partir de um MobSF instalado em um host Windows_).\
Al√©m disso, se voc√™ criar um arquivo **ZIP** com o c√≥digo-fonte de um aplicativo **Android** ou **IOS** (v√° at√© a pasta raiz do aplicativo, selecione tudo e crie um arquivo ZIP), ele tamb√©m poder√° analis√°-lo.

O MobSF tamb√©m permite que voc√™ fa√ßa a **compara√ß√£o/diferencia√ß√£o** de an√°lises e integre o **VirusTotal** (voc√™ precisar√° configurar sua chave de API em _MobSF/settings.py_ e ativ√°-la: `VT_ENABLED = TRUE` `VT_API_KEY = <Sua chave de API>` `VT_UPLOAD = TRUE`). Voc√™ tamb√©m pode definir `VT_UPLOAD` como `False`, ent√£o o **hash** ser√° **enviado** em vez do arquivo.

### An√°lise din√¢mica assistida com o MobSF

O **MobSF** tamb√©m pode ser muito √∫til para an√°lise **din√¢mica** no **Android**, mas nesse caso voc√™ precisar√° instalar o MobSF e o **genymotion** em seu host (uma VM ou Docker n√£o funcionar√°). _Observa√ß√£o: voc√™ precisa **iniciar primeiro uma VM no genymotion** e **depois o MobSF**._\
O analisador din√¢mico do **MobSF** pode:

* **Extrair dados do aplicativo** (URLs, logs, √°rea de transfer√™ncia, capturas de tela feitas por voc√™, capturas de tela feitas pelo "**Exported Activity Tester**", e-mails, bancos de dados SQLite, arquivos XML e outros arquivos criados). Tudo isso √© feito automaticamente, exceto pelas capturas de tela, voc√™ precisa pressionar quando desejar uma captura de tela ou pressionar "**Exported Activity Tester**" para obter capturas de tela de todas as atividades exportadas.
* Capturar tr√°fego **HTTPS**
* Usar o **Frida** para obter **informa√ß√µes em tempo de execu√ß√£o**

A partir das vers√µes do Android > 5, ele **iniciar√° automaticamente o Frida** e definir√° as configura√ß√µes globais de **proxy** para **capturar** o tr√°fego. Ele capturar√° apenas o tr√°fego do aplicativo testado.

**Frida**

Por padr√£o, ele tamb√©m usar√° alguns scripts do Frida para **burlar o SSL pinning**, **detec√ß√£o de root** e **detec√ß√£o de depurador**, e para **monitorar APIs interessantes**.\
O MobSF tamb√©m pode **invocar atividades exportadas**, capturar **capturas de tela** delas e **salv√°-las** para o relat√≥rio.

Para **iniciar** o teste din√¢mico, pressione o bot√£o verde: "**Start Instrumentation**". Pressione "**Frida Live Logs**" para ver os logs gerados pelos scripts do Frida e "**Live API Monitor**" para ver todas as invoca√ß√µes aos m√©todos conectados, argumentos passados e valores retornados (isso aparecer√° ap√≥s pressionar "Start Instrumentation").\
O MobSF tamb√©m permite que voc√™ carregue seus pr√≥prios **scripts do Frida** (para enviar os resultados de seus scripts do Frida para o MobSF, use a fun√ß√£o `send()`). Ele tamb√©m possui **v√°rios scripts pr√©-escritos** que voc√™ pode carregar (voc√™ pode adicionar mais em `MobSF/DynamicAnalyzer/tools/frida_scripts/others/`), basta **selecion√°-los**, pressionar "**Load**" e pressionar "**Start Instrumentation**" (voc√™ poder√° ver os logs desses scripts dentro de "**Frida Live Logs**").

![](<../../.gitbook/assets/image (215).png>)

Al√©m disso, voc√™ tem algumas funcionalidades auxiliares do Frida:

* **Enumerate Loaded Classes**: Ele imprimir√° todas as classes carregadas
* **Capture Strings**: Ele imprimir√° todas as strings capturadas durante o uso do aplicativo (muito barulhento)
* **Capture String Comparisons**: Pode ser muito √∫til. Ele mostrar√° as 2 strings sendo comparadas e se o resultado foi verdadeiro ou falso.
* **Enumerate Class Methods**: Insira o nome da classe (como "java.io.File") e ele imprimir√° todos os m√©todos da classe.
* **Search Class Pattern**: Pesquisar classes por padr√£o
* **Trace Class Methods**: **Tra√ßar** uma **classe inteira** (ver entradas e sa√≠das de todos os m√©todos da classe). Lembre-se de que, por padr√£o, o MobSF rastreia v√°rios m√©todos interessantes da API do Android.

Depois de selecionar o m√≥dulo auxiliar que deseja usar, voc√™ precisa pressionar "**Start Intrumentation**" e ver√° todas as sa√≠das em "**Frida Live Logs**".

**Shell**

O MobSF tamb√©m oferece um shell com alguns comandos **adb**, comandos do **MobSF** e comandos comuns do **shell** na parte inferior da p√°gina de an√°lise din√¢mica. Alguns comandos interessantes:
```bash
help
shell ls
activities
exported_activities
services
receivers
```
**Ferramentas HTTP**

Quando o tr√°fego HTTP √© capturado, voc√™ pode ver uma visualiza√ß√£o feia do tr√°fego capturado na parte inferior "**HTTP(S) Traffic**" ou uma visualiza√ß√£o mais agrad√°vel no bot√£o verde "**Start HTTPTools**". A partir da segunda op√ß√£o, voc√™ pode **enviar** as **solicita√ß√µes capturadas** para **proxies** como o Burp ou o Owasp ZAP.\
Para fazer isso, _ligue o Burp -->_ _desligue o Intercept --> no MobSB HTTPTools selecione a solicita√ß√£o_ --> pressione "**Send to Fuzzer**" --> _selecione o endere√ßo do proxy_ ([http://127.0.0.1:8080\\](http://127.0.0.1:8080)).

Ap√≥s concluir a an√°lise din√¢mica com o MobSF, voc√™ pode pressionar "**Start Web API Fuzzer**" para **fuzz http requests** e procurar por vulnerabilidades.

{% hint style="info" %}
Ap√≥s realizar uma an√°lise din√¢mica com o MobSF, as configura√ß√µes do proxy podem estar incorretas e voc√™ n√£o poder√° corrigi-las pela GUI. Voc√™ pode corrigir as configura√ß√µes do proxy fazendo:
```
adb shell settings put global http_proxy :0
```
{% endhint %}

### An√°lise Din√¢mica Assistida com Inspeckage

Voc√™ pode obter a ferramenta em [**Inspeckage**](https://github.com/ac-pm/Inspeckage).\
Esta ferramenta usa alguns **Hooks** para informar **o que est√° acontecendo no aplicativo** enquanto voc√™ realiza uma **an√°lise din√¢mica**.

{% content-ref url="inspeckage-tutorial.md" %}
[inspeckage-tutorial.md](inspeckage-tutorial.md)
{% endcontent-ref %}

### [Yaazhini](https://www.vegabird.com/yaazhini/)

Esta √© uma **√≥tima ferramenta para realizar an√°lise est√°tica com uma interface gr√°fica**

![](<../../.gitbook/assets/image (527).png>)

### [Qark](https://github.com/linkedin/qark)

Esta ferramenta √© projetada para procurar v√°rias **vulnerabilidades de seguran√ßa relacionadas a aplicativos Android**, seja no **c√≥digo-fonte** ou em **APKs empacotados**. A ferramenta tamb√©m √© **capaz de criar um APK implant√°vel "Proof-of-Concept"** e **comandos ADB** para explorar algumas das vulnerabilidades encontradas (atividades expostas, intents, tapjacking...). Assim como o Drozer, n√£o √© necess√°rio fazer root no dispositivo de teste.
```bash
pip3 install --user qark  # --user is only needed if not using a virtualenv
qark --apk path/to/my.apk
qark --java path/to/parent/java/folder
qark --java path/to/specific/java/file.java
```
### [**ReverseAPK**](https://github.com/1N3/ReverseAPK.git)

* Exibe todos os arquivos extra√≠dos para f√°cil refer√™ncia
* Decompila automaticamente arquivos APK para formato Java e Smali
* Analisa o AndroidManifest.xml em busca de vulnerabilidades e comportamentos comuns
* An√°lise est√°tica do c√≥digo-fonte em busca de vulnerabilidades e comportamentos comuns
* Informa√ß√µes do dispositivo
* Intents
* Execu√ß√£o de comandos
* Refer√™ncias do SQLite
* Refer√™ncias de log
* Provedores de conte√∫do
* Receptores de broadcast
* Refer√™ncias de servi√ßo
* Refer√™ncias de arquivo
* Refer√™ncias de criptografia
* Segredos codificados
* URLs
* Conex√µes de rede
* Refer√™ncias SSL
* Refer√™ncias do WebView
```
reverse-apk relative/path/to/APP.apk
```
### [SUPER Android Analyzer](https://github.com/SUPERAndroidAnalyzer/super)

SUPER √© um aplicativo de linha de comando que pode ser usado no Windows, MacOS X e Linux, que analisa arquivos _.apk_ em busca de vulnerabilidades. Ele faz isso descompactando os APKs e aplicando uma s√©rie de regras para detectar essas vulnerabilidades.

Todas as regras est√£o centralizadas em um arquivo `rules.json`, e cada empresa ou testador pode criar suas pr√≥prias regras para analisar o que precisam.

Baixe os bin√°rios mais recentes na [p√°gina de download](https://superanalyzer.rocks/download.html)
```
super-analyzer {apk_file}
```
### [StaCoAn](https://github.com/vincentcox/StaCoAn)

![](<../../.gitbook/assets/image (62).png>)

StaCoAn √© uma ferramenta **multiplataforma** que auxilia desenvolvedores, ca√ßadores de recompensas por bugs e hackers √©ticos a realizar [an√°lise de c√≥digo est√°tico](https://en.wikipedia.org/wiki/Static\_program\_analysis) em aplicativos m√≥veis\*.

O conceito √© que voc√™ arraste e solte o arquivo do seu aplicativo m√≥vel (um arquivo .apk ou .ipa) na aplica√ß√£o StaCoAn e ela ir√° gerar um relat√≥rio visual e port√°til para voc√™. Voc√™ pode ajustar as configura√ß√µes e listas de palavras para obter uma experi√™ncia personalizada.

Baixe a [vers√£o mais recente](https://github.com/vincentcox/StaCoAn/releases):
```
./stacoan
```
### [AndroBugs](https://github.com/AndroBugs/AndroBugs\_Framework)

O AndroBugs Framework √© um sistema de an√°lise de vulnerabilidades do Android que ajuda desenvolvedores ou hackers a encontrar poss√≠veis vulnerabilidades de seguran√ßa em aplicativos Android.\
[Vers√µes para Windows](https://github.com/AndroBugs/AndroBugs\_Framework/releases)
```
python androbugs.py -f [APK file]
androbugs.exe -f [APK file]
```
### [Androwarn](https://github.com/maaaaz/androwarn)

**Androwarn** √© uma ferramenta cujo objetivo principal √© detectar e alertar o usu√°rio sobre poss√≠veis comportamentos maliciosos desenvolvidos por um aplicativo Android.

A detec√ß√£o √© realizada com a **an√°lise est√°tica** do bytecode Dalvik do aplicativo, representado como **Smali**, com a biblioteca [`androguard`](https://github.com/androguard/androguard).

Essa ferramenta procura por comportamentos comuns de aplicativos "ruins", como: exfiltra√ß√£o de identificadores de telefonia, intercepta√ß√£o de fluxo de √°udio/v√≠deo, modifica√ß√£o de dados PIM, execu√ß√£o de c√≥digo arbitr√°rio...
```
python androwarn.py -i my_application_to_be_analyzed.apk -r html -v 3
```
### [MARA Framework](https://github.com/xtiankisutsa/MARA_Framework)

![](<../../.gitbook/assets/image (81).png>)

**MARA** √© um **F**ramework de **R**everse engineering e **A**n√°lise de **A**plica√ß√µes **M**√≥veis. √â uma ferramenta que re√∫ne ferramentas comumente usadas para reverse engineering e an√°lise de aplicativos m√≥veis, para auxiliar nos testes de seguran√ßa de aplicativos m√≥veis em rela√ß√£o √†s amea√ßas de seguran√ßa m√≥vel da OWASP. Seu objetivo √© tornar essa tarefa mais f√°cil e amig√°vel para desenvolvedores de aplicativos m√≥veis e profissionais de seguran√ßa.

Ele √© capaz de:

* Extrair c√≥digo Java e Smali usando diferentes ferramentas
* Analisar APKs usando: [smalisca](https://github.com/dorneanu/smalisca), [ClassyShark](https://github.com/google/android-classyshark), [androbugs](https://github.com/AndroBugs/AndroBugs_Framework), [androwarn](https://github.com/maaaaz/androwarn), [APKiD](https://github.com/rednaga/APKiD)
* Extrair informa√ß√µes privadas do APK usando regexps.
* Analisar o Manifesto.
* Analisar dom√≠nios encontrados usando: [pyssltest](https://github.com/moheshmohan/pyssltest), [testssl](https://github.com/drwetter/testssl.sh) e [whatweb](https://github.com/urbanadventurer/WhatWeb)
* Desofuscar APK via [apk-deguard.com](http://www.apk-deguard.com)

### Koodous

√ötil para detectar malware: [https://koodous.com/](https://koodous.com)

## Ofuscando/Desofuscando c√≥digo

Observe que, dependendo do servi√ßo e da configura√ß√£o que voc√™ usa para ofuscar o c√≥digo, os segredos podem ou n√£o ser ofuscados.

### [ProGuard](https://en.wikipedia.org/wiki/ProGuard\_\(software\))

**ProGuard** √© uma ferramenta de linha de comando de c√≥digo aberto que reduz, otimiza e ofusca o c√≥digo Java. Ele √© capaz de otimizar o bytecode, bem como detectar e remover instru√ß√µes n√£o utilizadas. O ProGuard √© um software gratuito e √© distribu√≠do sob a Licen√ßa P√∫blica Geral GNU, vers√£o 2.

O ProGuard √© distribu√≠do como parte do Android SDK e √© executado ao compilar o aplicativo no modo de lan√ßamento.

De: [https://en.wikipedia.org/wiki/ProGuard\_(software)](https://en.wikipedia.org/wiki/ProGuard\_\(software\))

### [DexGuard](https://www.guardsquare.com/dexguard)

Encontre um guia passo a passo para desofuscar o apk em [https://blog.lexfo.fr/dexguard.html](https://blog.lexfo.fr/dexguard.html)

(Do guia) Da √∫ltima vez que verificamos, o modo de opera√ß√£o do Dexguard era:

* carregar um recurso como um InputStream;
* alimentar o resultado para uma classe herdando de FilterInputStream para descriptograf√°-lo;
* fazer alguma ofusca√ß√£o in√∫til para desperdi√ßar alguns minutos do tempo de um reverser;
* alimentar o resultado descriptografado para um ZipInputStream para obter um arquivo DEX;
* finalmente carregar o DEX resultante como um Recurso usando o m√©todo `loadDex`.

### [DeGuard](http://apk-deguard.com)

**DeGuard reverte o processo de ofusca√ß√£o realizado por ferramentas de ofusca√ß√£o do Android. Isso permite in√∫meras an√°lises de seguran√ßa, incluindo inspe√ß√£o de c√≥digo e previs√£o de bibliotecas.**

Voc√™ pode fazer upload de um APK ofuscado para a plataforma deles.

### [Simplify](https://github.com/CalebFenton/simplify)

√â um **desofuscador gen√©rico para Android**. Simplify **executa virtualmente um aplicativo** para entender seu comportamento e, em seguida, **tenta otimizar o c√≥digo** para que ele se comporte de forma id√™ntica, mas seja mais f√°cil de entender para um humano. Cada tipo de otimiza√ß√£o √© simples e gen√©rico, portanto, n√£o importa qual seja o tipo espec√≠fico de ofusca√ß√£o usado.

### [APKiD](https://github.com/rednaga/APKiD)

APKiD fornece informa√ß√µes sobre **como um APK foi feito**. Ele identifica muitos **compiladores**, **empacotadores**, **ofuscadores** e outras coisas estranhas. √â o [_PEiD_](https://www.aldeid.com/wiki/PEiD) para Android.

### Manual

[Leia este tutorial para aprender alguns truques sobre **como reverter ofusca√ß√£o personalizada**](manual-deobfuscation.md)

## Laborat√≥rios

### [Androl4b](https://github.com/sh4hin/Androl4b)

AndroL4b √© uma m√°quina virtual de seguran√ßa Android baseada no ubuntu-mate que inclui a cole√ß√£o dos √∫ltimos frameworks, tutoriais e laborat√≥rios de diferentes especialistas em seguran√ßa e pesquisadores para engenharia reversa e an√°lise de malware.

### OWASP

{% embed url="https://github.com/OWASP/owasp-mstg%0Ahttps://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06g-testing-network-communication" %}

### Reposit√≥rios Git

[https://github.com/riddhi-shree/nullCommunity/tree/master/Android](https://github.com/riddhi-shree/nullCommunity/tree/master/Android)\
[https://www.youtube.com/watch?v=PMKnPaGWxtg\&feature=youtu.be\&ab\_channel=B3nacSec](https://www.youtube.com/watch?v=PMKnPaGWxtg\&feature=youtu.be\&ab\_channel=B3nacSec)

## Refer√™ncias

Para mais informa√ß√µes, visite:

* [https://appsecwiki.com/#/](https://appsecwiki.com/#/) √â uma √≥tima lista de recursos
* [https://maddiestone.github.io/AndroidAppRE/](https://maddiestone.github.io/AndroidAppRE/) Curso r√°pido de Android
* [https://manifestsecurity.com/android-application-security/](https://manifestsecurity.com/android-application-security/)
* [https://github.com/Ralireza/Android-Security-Teryaagh](https://github.com/Ralireza/Android-Security-Teryaagh)

## Para Testar

* [https://www.vegabird.com/yaazhini/](https://www.vegabird.com/yaazhini/)
* [https://github.com/abhi-r3v0/Adhrit](https://github.com/abhi-r3v0/Adhrit)

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

**HackenProof √© o lar de todas as recompensas por bugs de criptografia.**

**Seja recompensado sem atrasos**\
As recompensas do HackenProof s√£o lan√ßadas apenas quando seus clientes depositam o or√ßamento de recompensa. Voc√™ receber√° a recompensa ap√≥s a verifica√ß√£o do bug.

**Adquira experi√™ncia em pentesting web3**\
Protocolos blockchain e contratos inteligentes s√£o a nova Internet! Domine a seguran√ßa web3 em seus dias de ascens√£o.

**Torne-se a lenda do hacker web3**\
Ganhe pontos de reputa√ß√£o com cada bug verificado e conquiste o topo do leaderboard semanal.

[**Cadastre-se no HackenProof**](https://hackenproof.com/register) comece a ganhar com seus hacks!

{% embed url="https://hackenproof.com/register" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Voc√™ trabalha em uma **empresa de ciberseguran√ßa**? Voc√™ quer ver sua **empresa anunciada no HackTricks**? ou voc√™ quer ter acesso √† **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**? Verifique os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Adquira o [**swag oficial da PEASS & HackTricks**](https://peass.creator-spring.com)
* **Junte-se ao** [**üí¨**](https://emojipedia.org/speech-balloon/) **grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo Telegram**](https://t.me/peass) ou **siga-me no Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para o** [**reposit√≥rio hacktricks**](https://github.com/carlospolop/hacktricks) **e o** [**reposit√≥rio hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
