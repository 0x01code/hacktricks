# Android-Anwendungen Pentesting

<details>

<summary><strong>Erlernen Sie AWS-Hacking von Null auf Held mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks beworben sehen m√∂chten** oder **HackTricks im PDF-Format herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merch**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositories senden.

</details>

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

Treten Sie dem [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) Server bei, um mit erfahrenen Hackern und Bug-Bounty-J√§gern zu kommunizieren!

**Hacking-Einblicke**\
Besch√§ftigen Sie sich mit Inhalten, die sich mit dem Nervenkitzel und den Herausforderungen des Hackens befassen

**Echtzeit-Hack-News**\
Bleiben Sie mit der schnelllebigen Hacking-Welt durch Echtzeitnachrichten und Einblicke auf dem Laufenden

**Neueste Ank√ºndigungen**\
Bleiben Sie √ºber die neuesten Bug-Bounties und wichtige Plattformupdates informiert

**Treten Sie uns bei** [**Discord**](https://discord.com/invite/N3FrSbmwdy) und beginnen Sie noch heute mit Top-Hackern zusammenzuarbeiten!

## Grundlagen von Android-Anwendungen

Es wird dringend empfohlen, diese Seite zu lesen, um mehr √ºber die **wichtigsten Teile im Zusammenhang mit der Android-Sicherheit und die gef√§hrlichsten Komponenten in einer Android-Anwendung** zu erfahren:

{% content-ref url="android-applications-basics.md" %}
[android-applications-basics.md](android-applications-basics.md)
{% endcontent-ref %}

## ADB (Android Debug Bridge)

Dies ist das Hauptwerkzeug, das Sie ben√∂tigen, um eine Verbindung zu einem Android-Ger√§t (emuliert oder physisch) herzustellen.\
**ADB** erm√∂glicht die Steuerung von Ger√§ten entweder √ºber **USB** oder **Netzwerk** von einem Computer aus. Mit diesem Dienstprogramm k√∂nnen Dateien in beide Richtungen **kopiert**, Apps **installiert** und **deinstalliert**, Shell-Befehle **ausgef√ºhrt**, Daten **gesichert**, Logs **gelesen** und andere Funktionen ausgef√ºhrt werden.

Werfen Sie einen Blick auf die folgende Liste von [**ADB-Befehlen**](adb-commands.md), um zu lernen, wie adb verwendet wird.

## Smali

Manchmal ist es interessant, den **Anwendungscode zu √§ndern**, um auf **versteckte Informationen** zuzugreifen (vielleicht gut verschleierte Passw√∂rter oder Flags). Dann k√∂nnte es interessant sein, die APK zu dekompilieren, den Code zu √§ndern und sie neu zu kompilieren.\
[**In diesem Tutorial** k√∂nnen Sie **lernen, wie man eine APK dekompiliert, den Smali-Code √§ndert und die APK neu kompiliert** mit der neuen Funktionalit√§t](smali-changes.md). Dies k√∂nnte als **Alternative f√ºr mehrere Tests w√§hrend der dynamischen Analyse** sehr n√ºtzlich sein, die vorgestellt werden. **Denken Sie also immer an diese M√∂glichkeit**.

## Andere interessante Tricks

* [Standortf√§lschung im Play Store](spoofing-your-location-in-play-store.md)
* **APKs herunterladen**: [https://apps.evozi.com/apk-downloader/](https://apps.evozi.com/apk-downloader/), [https://apkpure.com/es/](https://apkpure.com/es/), [https://www.apkmirror.com/](https://www.apkmirror.com), [https://apkcombo.com/es-es/apk-downloader/](https://apkcombo.com/es-es/apk-downloader/)
* APK vom Ger√§t extrahieren:
```bash
adb shell pm list packages
com.android.insecurebankv2

adb shell pm path com.android.insecurebankv2
package:/data/app/com.android.insecurebankv2-Jnf8pNgwy3QA_U5f-n_4jQ==/base.apk

adb pull /data/app/com.android.insecurebankv2- Jnf8pNgwy3QA_U5f-n_4jQ==/base.apk
```
## Statische Analyse

Zun√§chst einmal sollten Sie zur Analyse einer APK einen Blick auf den Java-Code werfen, indem Sie einen Decompiler verwenden. Bitte [lesen Sie hier, um Informationen zu verschiedenen verf√ºgbaren Decompilern zu finden](apk-decompilers.md).

### Suche nach interessanten Informationen

Durch das Betrachten der **Strings** der APK k√∂nnen Sie nach **Passw√∂rtern**, **URLs** ([https://github.com/ndelphit/apkurlgrep](https://github.com/ndelphit/apkurlgrep)), **API**-Schl√ºsseln, **Verschl√ºsselung**, **Bluetooth UUIDs**, **Tokens** und allem Interessanten suchen... suchen Sie sogar nach Code-Ausf√ºhrungs-**Hintert√ºren** oder Authentifizierungs-Hintert√ºren (fest codierte Admin-Anmeldeinformationen f√ºr die App).

**Firebase**

Achten Sie besonders auf **Firebase-URLs** und pr√ºfen Sie, ob sie schlecht konfiguriert sind. [Weitere Informationen dazu, was Firebase ist und wie man es ausnutzen kann, finden Sie hier.](../../network-services-pentesting/pentesting-web/buckets/firebase-database.md)

### Grundlegendes Verst√§ndnis der Anwendung - Manifest.xml, strings.xml

Die **Untersuchung der Dateien einer Anwendung **_**Manifest.xml**_** und **_**strings.xml**_** kann potenzielle Sicherheitsl√ºcken aufdecken**. Diese Dateien k√∂nnen mithilfe von Decompilern oder durch Umbenennen der APK-Dateierweiterung in .zip und anschlie√üendes Entpacken darauf zugegriffen werden.

**Aus dem Manifest.xml** identifizierte **Sicherheitsl√ºcken** umfassen:

* **Debugf√§hige Anwendungen**: Anwendungen, die als debugf√§hig (`debuggable="true"`) im _Manifest.xml_ festgelegt sind, stellen ein Risiko dar, da sie Verbindungen zulassen, die zu Ausnutzungen f√ºhren k√∂nnen. F√ºr ein besseres Verst√§ndnis, wie man debugf√§hige Anwendungen ausnutzt, siehe ein Tutorial zum Auffinden und Ausnutzen von debugf√§higen Anwendungen auf einem Ger√§t.
* **Backup-Einstellungen**: Das Attribut `android:allowBackup="false"` sollte explizit f√ºr Anwendungen festgelegt werden, die mit sensiblen Informationen umgehen, um nicht autorisierte Datenbackups √ºber adb zu verhindern, insbesondere wenn das USB-Debugging aktiviert ist.
* **Netzwerksicherheit**: Benutzerdefinierte Netzwerksicherheitskonfigurationen (`android:networkSecurityConfig="@xml/network_security_config"`) in _res/xml/_ k√∂nnen Sicherheitsdetails wie Zertifikatspins und HTTP-Verkehrseinstellungen festlegen. Ein Beispiel ist die Zulassung von HTTP-Verkehr f√ºr bestimmte Dom√§nen.
* **Exportierte Aktivit√§ten und Dienste**: Die Identifizierung exportierter Aktivit√§ten und Dienste im Manifest kann Komponenten hervorheben, die missbraucht werden k√∂nnten. Eine weitere Analyse w√§hrend des dynamischen Tests kann aufzeigen, wie diese Komponenten ausgenutzt werden k√∂nnen.
* **Inhaltsanbieter und Dateianbieter**: Offen gelegte Inhaltsanbieter k√∂nnten unbefugten Zugriff oder √Ñnderung von Daten erm√∂glichen. Auch die Konfiguration von Dateianbietern sollte √ºberpr√ºft werden.
* **Broadcast-Empf√§nger und URL-Schemata**: Diese Komponenten k√∂nnten f√ºr Ausnutzungen genutzt werden, wobei besonders darauf geachtet werden sollte, wie URL-Schemata f√ºr Eingabesicherheitsl√ºcken verwaltet werden.
* **SDK-Versionen**: Die Attribute `minSdkVersion`, `targetSDKVersion` und `maxSdkVersion` geben die unterst√ºtzten Android-Versionen an und unterstreichen die Bedeutung, veraltete, anf√§llige Android-Versionen aus Sicherheitsgr√ºnden nicht zu unterst√ºtzen.

Aus der **strings.xml**-Datei k√∂nnen sensible Informationen wie API-Schl√ºssel, benutzerdefinierte Schemas und andere Entwicklerhinweise entdeckt werden, was die Notwendigkeit einer sorgf√§ltigen √úberpr√ºfung dieser Ressourcen unterstreicht.

### Tapjacking

**Tapjacking** ist ein Angriff, bei dem eine **b√∂sartige Anwendung** gestartet wird und sich √ºber einer Opferanwendung positioniert. Sobald sie die Opfer-App sichtbar verdeckt, ist ihre Benutzeroberfl√§che so gestaltet, dass sie den Benutzer dazu bringt, mit ihr zu interagieren, w√§hrend sie die Interaktion an die Opfer-App weitergibt.\
Im Wesentlichen blendet es den Benutzer aus, sodass er nicht wei√ü, dass er tats√§chlich Aktionen auf der Opfer-App ausf√ºhrt.

Weitere Informationen finden Sie unter:

{% content-ref url="tapjacking.md" %}
[tapjacking.md](tapjacking.md)
{% endcontent-ref %}

### Task-Hijacking

Eine **Aktivit√§t** mit dem **`launchMode`** auf **`singleTask` ohne definiertes `taskAffinity`** ist anf√§llig f√ºr Task-Hijacking. Dies bedeutet, dass eine **Anwendung** installiert werden kann und wenn sie vor der echten Anwendung gestartet wird, k√∂nnte sie die Aufgabe der echten Anwendung **√ºbernehmen (so dass der Benutzer mit der b√∂sartigen Anwendung interagiert und denkt, er verwendet die echte)**.

Weitere Informationen unter:

{% content-ref url="android-task-hijacking.md" %}
[android-task-hijacking.md](android-task-hijacking.md)
{% endcontent-ref %}

### Unsichere Datenspeicherung

**Interner Speicher**

In Android sind Dateien, die im **internen** Speicher **gespeichert** sind, ausschlie√ülich f√ºr die **App** zug√§nglich, die sie **erstellt** hat. Diese Sicherheitsma√ünahme wird vom Android-Betriebssystem durchgesetzt und ist im Allgemeinen f√ºr die Sicherheitsanforderungen der meisten Anwendungen ausreichend. Manchmal nutzen Entwickler jedoch Modi wie `MODE_WORLD_READABLE` und `MODE_WORLD_WRITABLE`, um Dateien zwischen verschiedenen Anwendungen zu **teilen**. Diese Modi **beschr√§nken jedoch nicht den Zugriff** auf diese Dateien durch andere Anwendungen, einschlie√ülich potenziell b√∂sartiger.

1. **Statische Analyse:**
* **Stellen Sie sicher**, dass die Verwendung von `MODE_WORLD_READABLE` und `MODE_WORLD_WRITABLE` **sorgf√§ltig gepr√ºft** wird. Diese Modi k√∂nnen Dateien potenziell f√ºr **unerw√ºnschten oder nicht autorisierten Zugriff freigeben**.
2. **Dynamische Analyse:**
* **√úberpr√ºfen** Sie die **Berechtigungen**, die f√ºr von der App erstellte Dateien festgelegt sind. √úberpr√ºfen Sie insbesondere, ob Dateien **weltweit lesbar oder beschreibbar sind**. Dies kann ein erhebliches Sicherheitsrisiko darstellen, da es jeder **installierten Anwendung** auf dem Ger√§t, unabh√§ngig von ihrer Herkunft oder Absicht, erm√∂glichen w√ºrde, diese Dateien zu **lesen oder zu √§ndern**.

**Externer Speicher**

Beim Umgang mit Dateien auf **externem Speicher**, wie SD-Karten, sollten bestimmte Vorsichtsma√ünahmen getroffen werden:

1. **Zug√§nglichkeit**:
* Dateien auf externem Speicher sind **global lesbar und beschreibbar**. Dies bedeutet, dass jede Anwendung oder Benutzer auf diese Dateien zugreifen kann.
2. **Sicherheitsbedenken**:
* Aufgrund der einfachen Zug√§nglichkeit wird empfohlen, **keine sensiblen Informationen** auf externem Speicher zu speichern.
* Externer Speicher kann entfernt oder von jeder Anwendung aufgerufen werden, was ihn weniger sicher macht.
3. **Umgang mit Daten aus externem Speicher**:
* F√ºhren Sie immer eine **Eingabevalidierung** f√ºr aus externem Speicher abgerufene Daten durch. Dies ist entscheidend, da die Daten aus einer nicht vertrauensw√ºrdigen Quelle stammen.
* Das Speichern von ausf√ºhrbaren Dateien oder Klassen auf externem Speicher f√ºr das dynamische Laden wird dringend abgeraten.
* Wenn Ihre Anwendung ausf√ºhrbare Dateien aus externem Speicher abrufen muss, stellen Sie sicher, dass diese Dateien **signiert und kryptografisch √ºberpr√ºft** werden, bevor sie dynamisch geladen werden. Dieser Schritt ist entscheidend f√ºr die Aufrechterhaltung der Sicherheitsintegrit√§t Ihrer Anwendung.

Auf externen Speicher kann unter `/storage/emulated/0`, `/sdcard`, `/mnt/sdcard` zugegriffen werden.

{% hint style="info" %}
Ab Android 4.4 (**API 17**) hat die SD-Karte eine Verzeichnisstruktur, die den Zugriff einer App auf das Verzeichnis, das speziell f√ºr diese App vorgesehen ist, **beschr√§nkt**. Dies verhindert, dass b√∂sartige Anwendungen Lese- oder Schreibzugriff auf Dateien einer anderen App erhalten.
{% endhint %}

**Sensible Daten im Klartext gespeichert**

* **Geteilte Pr√§ferenzen**: Android erm√∂glicht es jeder Anwendung, XML-Dateien einfach im Pfad `/data/data/<packagename>/shared_prefs/` zu speichern, und manchmal ist es m√∂glich, sensible Informationen im Klartext in diesem Ordner zu finden.
* **Datenbanken**: Android erm√∂glicht es jeder Anwendung, SQLite-Datenbanken einfach im Pfad `/data/data/<packagename>/databases/` zu speichern, und manchmal ist es m√∂glich, sensible Informationen im Klartext in diesem Ordner zu finden.

### Gebrochenes TLS

**Alle Zertifikate akzeptieren**

Aus irgendeinem Grund akzeptieren Entwickler manchmal alle Zertifikate, auch wenn beispielsweise der Hostname nicht mit Zeilen des Codes √ºbereinstimmt wie der folgenden:
```java
SSLSocketFactory sf = new cc(trustStore);
sf.setHostnameVerifier(SSLSocketFactory.ALLOW_ALL_HOSTNAME_VERIFIER);
```
### Kaputte Kryptographie

**Schlechte Schl√ºsselverwaltungsprozesse**

Einige Entwickler speichern sensible Daten im lokalen Speicher und verschl√ºsseln sie mit einem im Code festgelegten/vorhersehbaren Schl√ºssel. Dies sollte vermieden werden, da durch Reverse Engineering Angreifer vertrauliche Informationen extrahieren k√∂nnten.

**Verwendung unsicherer und/oder veralteter Algorithmen**

Entwickler sollten keine **veralteten Algorithmen** verwenden, um **Autorisierungspr√ºfungen**, **Speicherung** oder **Senden** von Daten durchzuf√ºhren. Einige dieser Algorithmen sind: RC4, MD4, MD5, SHA1... Wenn **Hashes** beispielsweise zur Speicherung von Passw√∂rtern verwendet werden, sollten hash-brute-force **resistente** Hashes mit Salz verwendet werden.

### Andere √úberpr√ºfungen

* Es wird empfohlen, die APK zu **verschleiern**, um es Angreifern schwerer zu machen, den Reverse-Engineering-Prozess durchzuf√ºhren.
* Wenn die App sensibel ist (wie Bank-Apps), sollte sie ihre **eigenen √úberpr√ºfungen durchf√ºhren, um zu sehen, ob das Mobilger√§t gerootet ist**, und entsprechend handeln.
* Wenn die App sensibel ist (wie Bank-Apps), sollte sie √ºberpr√ºfen, ob ein **Emulator** verwendet wird.
* Wenn die App sensibel ist (wie Bank-Apps), sollte sie **ihre eigene Integrit√§t vor der Ausf√ºhrung √ºberpr√ºfen**, um festzustellen, ob sie modifiziert wurde.
* Verwenden Sie [**APKiD**](https://github.com/rednaga/APKiD), um zu √ºberpr√ºfen, welcher Compiler/Packer/Verschleierer zum Erstellen der APK verwendet wurde.

### React Native Anwendung

Lesen Sie die folgende Seite, um zu erfahren, wie Sie einfach auf den JavaScript-Code von React-Anwendungen zugreifen k√∂nnen:

{% content-ref url="react-native-application.md" %}
[react-native-application.md](react-native-application.md)
{% endcontent-ref %}

### Xamarin-Anwendungen

Lesen Sie die folgende Seite, um zu erfahren, wie Sie einfach auf den C#-Code von Xamarin-Anwendungen zugreifen k√∂nnen:

{% content-ref url="../xamarin-apps.md" %}
[xamarin-apps.md](../xamarin-apps.md)
{% endcontent-ref %}

### Supergepackte Anwendungen

Laut diesem [**Blog-Beitrag**](https://clearbluejar.github.io/posts/desuperpacking-meta-superpacked-apks-with-github-actions/) ist Superpacking ein Meta-Algorithmus, der den Inhalt einer Anwendung in eine einzige Datei komprimiert. Der Blog spricht √ºber die M√∂glichkeit, eine App zu erstellen, die diese Art von Apps dekomprimiert... und einen schnelleren Weg, der darin besteht, **die Anwendung auszuf√ºhren und die dekomprimierten Dateien aus dem Dateisystem zu sammeln**.

### Automatisierte statische Codeanalyse

Das Tool [**mariana-trench**](https://github.com/facebook/mariana-trench) ist in der Lage, **Schwachstellen** zu finden, indem es den **Code** der Anwendung **scannt**. Dieses Tool enth√§lt eine Reihe von **bekannten Quellen** (die dem Tool die **Stellen** angeben, an denen die **Eingabe vom Benutzer kontrolliert wird**), **Sinks** (die dem Tool **gef√§hrliche Stellen** angeben, an denen b√∂sartige Benutzereingaben Sch√§den verursachen k√∂nnten) und **Regeln**. Diese Regeln geben die **Kombination** von **Quellen-Sinks** an, die auf eine Schwachstelle hinweisen.

Mit diesem Wissen wird **mariana-trench den Code √ºberpr√ºfen und m√∂gliche Schwachstellen darin finden**.

### Geleakte Geheimnisse

Eine Anwendung kann Geheimnisse (API-Schl√ºssel, Passw√∂rter, versteckte URLs, Subdomains...) enthalten, die Sie m√∂glicherweise entdecken k√∂nnen. Sie k√∂nnten ein Tool wie [https://github.com/dwisiswant0/apkleaks](https://github.com/dwisiswant0/apkleaks) verwenden.

### Biometrische Authentifizierung umgehen

{% content-ref url="bypass-biometric-authentication-android.md" %}
[bypass-biometric-authentication-android.md](bypass-biometric-authentication-android.md)
{% endcontent-ref %}

### Andere interessante Funktionen

* **Codeausf√ºhrung**: `Runtime.exec(), ProcessBuilder(), nativer Code:system()`
* **SMS senden**: `sendTextMessage, sendMultipartTestMessage`
* Als `native` deklarierte **native Funktionen**: `public native, System.loadLibrary, System.load`
* [Lesen Sie dies, um zu lernen, **wie man native Funktionen umkehrt**](reversing-native-libraries.md)

### **Andere Tricks**

{% content-ref url="content-protocol.md" %}
[content-protocol.md](content-protocol.md)
{% endcontent-ref %}

***

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

Treten Sie dem [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) Server bei, um mit erfahrenen Hackern und Bug-Bounty-J√§gern zu kommunizieren!

**Hacking-Einblicke**\
Besch√§ftigen Sie sich mit Inhalten, die sich mit dem Nervenkitzel und den Herausforderungen des Hackens befassen

**Echtzeit-Hack-News**\
Bleiben Sie mit der schnelllebigen Hacking-Welt durch Echtzeitnachrichten und Einblicke auf dem Laufenden

**Neueste Ank√ºndigungen**\
Bleiben Sie √ºber die neuesten Bug-Bounties und wichtigen Plattformupdates informiert

**Treten Sie uns bei** [**Discord**](https://discord.com/invite/N3FrSbmwdy) bei und beginnen Sie noch heute mit Top-Hackern zusammenzuarbeiten!

***

## Dynamische Analyse

> Zun√§chst ben√∂tigen Sie eine Umgebung, in der Sie die Anwendung und die gesamte Umgebung installieren k√∂nnen (insbesondere Burp CA-Zertifikat, Drozer und Frida). Daher wird ein gerootetes Ger√§t (emuliert oder nicht) dringend empfohlen.

### Online-Dynamische Analyse

Sie k√∂nnen ein **kostenloses Konto** bei: [https://appetize.io/](https://appetize.io) erstellen. Diese Plattform erm√∂glicht es Ihnen, APKs hochzuladen und auszuf√ºhren, um das Verhalten einer APK zu sehen.

Sie k√∂nnen sogar die **Protokolle Ihrer Anwendung** im Web einsehen und √ºber **adb** eine Verbindung herstellen.

![](<../../.gitbook/assets/image (60).png>)

Dank der ADB-Verbindung k√∂nnen Sie **Drozer** und **Frida** in den Emulatoren verwenden.

### Lokale Dynamische Analyse

#### Verwendung eines Emulators

* [**Android Studio**](https://developer.android.com/studio) (Sie k√∂nnen **x86** und **arm** Ger√§te erstellen, und gem√§√ü [**diesen** ](https://android-developers.googleblog.com/2020/03/run-arm-apps-on-android-emulator.html)**neuesten x86**-Versionen **unterst√ºtzen ARM-Bibliotheken** ohne die Notwendigkeit eines langsamen ARM-Emulators).
* Erfahren Sie, wie Sie dies auf dieser Seite einrichten:

{% content-ref url="avd-android-virtual-device.md" %}
[avd-android-virtual-device.md](avd-android-virtual-device.md)
{% endcontent-ref %}

* [**Genymotion**](https://www.genymotion.com/fun-zone/) **(Kostenlose Version:** Personal Edition, Sie m√ºssen ein Konto erstellen. _Es wird empfohlen, die Version **MIT**_ _**VirtualBox** herunterzuladen, um potenzielle Fehler zu vermeiden._)
* [**Nox**](https://es.bignox.com) (Kostenlos, unterst√ºtzt jedoch kein Frida oder Drozer).

{% hint style="info" %}
Beim Erstellen eines neuen Emulators auf jeder Plattform gilt: Je gr√∂√üer der Bildschirm ist, desto langsamer wird der Emulator ausgef√ºhrt. W√§hlen Sie also m√∂glichst kleine Bildschirme aus.
{% endhint %}

Um **Google-Dienste** (wie AppStore) in Genymotion zu installieren, m√ºssen Sie auf die rot markierte Schaltfl√§che des folgenden Bildes klicken:

![](<../../.gitbook/assets/image (200) (1).png>)

Beachten Sie auch, dass Sie im **Konfigurationsmen√º der Android-VM in Genymotion** den **Bridge Network-Modus** ausw√§hlen k√∂nnen (dies ist n√ºtzlich, wenn Sie von einer anderen VM aus eine Verbindung zur Android-VM mit den Tools herstellen).
#### Verwendung eines physischen Ger√§ts

Sie m√ºssen die **Debugging**-Optionen aktivieren und es w√§re gut, wenn Sie es **rooten** k√∂nnten:

1. **Einstellungen**.
2. (Ab Android 8.0) W√§hlen Sie **System**.
3. W√§hlen Sie **Telefoninfo**.
4. Dr√ºcken Sie 7 Mal auf **Build-Nummer**.
5. Gehen Sie zur√ºck und Sie finden die **Entwickleroptionen**.

> Sobald Sie die Anwendung installiert haben, sollten Sie als Erstes versuchen, sie zu testen und zu untersuchen, was sie tut, wie sie funktioniert, und sich damit vertraut machen.\
> Ich schlage vor, diese anf√§ngliche dynamische Analyse mit MobSF-Dynamikanalyse + pidcat durchzuf√ºhren, damit wir lernen k√∂nnen, wie die Anwendung funktioniert, w√§hrend MobSF eine Menge interessanter Daten erfasst, die Sie sp√§ter √ºberpr√ºfen k√∂nnen.

### Unerw√ºnschtes Datenleck

**Protokollierung**

Entwickler sollten vorsichtig sein, Debug-Informationen √∂ffentlich preiszugeben, da dies zu sensiblen Datenlecks f√ºhren kann. Die Tools [**pidcat**](https://github.com/JakeWharton/pidcat) und `adb logcat` werden empfohlen, um Anwendungsprotokolle zu √ºberwachen und sensible Informationen zu identifizieren und zu sch√ºtzen. **Pidcat** wird aufgrund seiner Benutzerfreundlichkeit und Lesbarkeit bevorzugt.

{% hint style="warning" %}
Beachten Sie, dass ab **neueren Versionen als Android 4.0** **Anwendungen nur auf ihre eigenen Protokolle zugreifen k√∂nnen**. Anwendungen k√∂nnen also nicht auf Protokolle anderer Apps zugreifen.\
Es wird dennoch empfohlen, **keine sensiblen Informationen zu protokollieren**.
{% endhint %}

**Kopieren/Einf√ºgen-Zwischenspeicher-Caching**

Das auf dem Android basierende Zwischenspeicher-Framework erm√∂glicht die Kopier- und Einf√ºge-Funktionalit√§t in Apps, birgt jedoch ein Risiko, da **andere Anwendungen** auf den Zwischenspeicher zugreifen k√∂nnen, was potenziell sensible Daten offenlegen k√∂nnte. Es ist entscheidend, die Kopier-/Einf√ºge-Funktionen f√ºr sensible Bereiche einer Anwendung wie Kreditkartendaten zu deaktivieren, um Datenlecks zu verhindern.

**Absturzprotokolle**

Wenn eine Anwendung abst√ºrzt und Protokolle speichert, k√∂nnen diese Protokolle Angreifern helfen, insbesondere wenn die Anwendung nicht r√ºckentwickelt werden kann. Um dieses Risiko zu mindern, vermeiden Sie das Protokollieren von Abst√ºrzen, und wenn Protokolle √ºber das Netzwerk √ºbertragen werden m√ºssen, stellen Sie sicher, dass sie √ºber einen SSL-Kanal gesendet werden, um die Sicherheit zu gew√§hrleisten.

Als Pentester sollten Sie **einen Blick auf diese Protokolle werfen**.

**Analyse-Daten an Dritte gesendet**

Anwendungen integrieren oft Dienste wie Google Adsense, die aufgrund einer falschen Implementierung durch Entwickler versehentlich **sensible Daten preisgeben** k√∂nnen. Um potenzielle Datenlecks zu identifizieren, ist es ratsam, den Datenverkehr der Anwendung abzufangen und nach sensiblen Informationen zu suchen, die an Drittanbieterdienste gesendet werden.

### SQLite-DBs

Die meisten Anwendungen verwenden **interne SQLite-Datenbanken**, um Informationen zu speichern. W√§hrend des Pentests sollten Sie einen Blick auf die erstellten **Datenbanken**, die Namen der **Tabellen** und **Spalten** sowie alle gespeicherten **Daten** werfen, da Sie m√∂glicherweise **sensible Informationen** finden k√∂nnten (was eine Schwachstelle darstellen w√ºrde).\
Datenbanken sollten sich unter `/data/data/die.paket.name/databases` wie `/data/data/com.mwr.example.sieve/databases` befinden.

Wenn die Datenbank vertrauliche Informationen speichert und **verschl√ºsselt ist**, Sie jedoch das **Passwort** innerhalb der Anwendung **finden** k√∂nnen, handelt es sich dennoch um eine **Schwachstelle**.

Listen Sie die Tabellen mit `.tables` auf und listen Sie die Spalten der Tabellen mit `.schema <tabellenname>` auf.

### Drozer (Ausnutzen von Aktivit√§ten, Inhalten und Diensten)

Aus [Drozer-Dokumentation](https://labs.mwrinfosecurity.com/assets/BlogFiles/mwri-drozer-user-guide-2015-03-23.pdf): **Drozer** erm√∂glicht es Ihnen, die Rolle einer Android-App anzunehmen und mit anderen Apps zu interagieren. Es kann alles tun, was eine installierte Anwendung tun kann, wie z.B. Androids Inter-Process Communication (IPC)-Mechanismus nutzen und mit dem zugrunde liegenden Betriebssystem interagieren.\
Drozer ist ein n√ºtzliches Tool, um exportierte Aktivit√§ten, exportierte Dienste und Content Provider auszunutzen, wie Sie in den folgenden Abschnitten erfahren werden.

### Ausnutzen von exportierten Aktivit√§ten

[**Lesen Sie dies, wenn Sie auffrischen m√∂chten, was eine Android-Aktivit√§t ist.**](android-applications-basics.md#launcher-activity-and-other-activities)\
Denken Sie auch daran, dass der Code einer Aktivit√§t in der Methode **`onCreate`** beginnt.

**Autorisierungsumgehung**

Wenn eine Aktivit√§t exportiert ist, k√∂nnen Sie ihr Bildschirm von einer externen App aus aufrufen. Daher k√∂nnten Sie, wenn eine Aktivit√§t mit **sensiblen Informationen** **exportiert** ist, die **Authentifizierungsmechanismen umgehen**, um darauf zuzugreifen.

[Erfahren Sie, wie Sie exportierte Aktivit√§ten mit Drozer ausnutzen.](drozer-tutorial/#activities)

Sie k√∂nnen auch eine exportierte Aktivit√§t von adb aus starten:

* Paketname ist com.example.demo
* Exportierter Aktivit√§tsname ist com.example.test.MainActivity
```bash
adb shell am start -n com.example.demo/com.example.test.MainActivity
```
**Hinweis**: MobSF wird die Verwendung von _**singleTask/singleInstance**_ als `android:launchMode` in einer Aktivit√§t als b√∂sartig erkennen, aber aufgrund [dieses](https://github.com/MobSF/Mobile-Security-Framework-MobSF/pull/750) ist dies anscheinend nur auf alten Versionen (API-Versionen < 21) gef√§hrlich.

{% hint style="info" %}
Beachten Sie, dass eine Autorisierungsumgehung nicht immer eine Schwachstelle darstellt. Es h√§ngt davon ab, wie die Umgehung funktioniert und welche Informationen offengelegt werden.
{% endhint %}

**Leckage sensibler Informationen**

**Aktivit√§ten k√∂nnen auch Ergebnisse zur√ºckgeben**. Wenn es Ihnen gelingt, eine exportierte und ungesch√ºtzte Aktivit√§t zu finden, die die Methode **`setResult`** aufruft und **sensible Informationen zur√ºckgibt**, handelt es sich um eine sensible Informationsleckage.

#### Tapjacking

Wenn Tapjacking nicht verhindert wird, k√∂nnten Sie die exportierte Aktivit√§t missbrauchen, um den **Benutzer unerwartete Aktionen ausf√ºhren zu lassen**. Weitere Informationen zu [**was Tapjacking ist, finden Sie unter dem Link**](./#tapjacking).

### Ausnutzen von Content Providern - Zugriff auf und Manipulation sensibler Informationen

[**Lesen Sie dies, wenn Sie auffrischen m√∂chten, was ein Content Provider ist.**](android-applications-basics.md#content-provider)\
Content Provider werden im Wesentlichen verwendet, um **Daten zu teilen**. Wenn eine App Content Provider zur Verf√ºgung stellt, k√∂nnen Sie m√∂glicherweise **sensible** Daten daraus **extrahieren**. Es ist auch interessant, m√∂gliche **SQL-Injections** und **Pfadtraversierungen** zu testen, da sie anf√§llig sein k√∂nnten.

[**Erfahren Sie, wie Sie Content Provider mit Drozer ausnutzen k√∂nnen.**](drozer-tutorial/#content-providers)

### **Ausnutzen von Services**

[**Lesen Sie dies, wenn Sie auffrischen m√∂chten, was ein Service ist.**](android-applications-basics.md#services)\
Denken Sie daran, dass die Aktionen eines Service in der Methode `onStartCommand` beginnen.

Ein Service ist im Grunde etwas, das **Daten empfangen**, sie **verarbeiten** und eine Antwort **zur√ºckgeben** (oder auch nicht) kann. Wenn eine Anwendung einige Services exportiert, sollten Sie den **Code** √ºberpr√ºfen, um zu verstehen, was er tut, und ihn **dynamisch testen**, um vertrauliche Informationen zu extrahieren, Authentifizierungsma√ünahmen zu umgehen usw.\
[**Erfahren Sie, wie Sie Services mit Drozer ausnutzen k√∂nnen.**](drozer-tutorial/#services)

### **Ausnutzen von Broadcast Receivern**

[**Lesen Sie dies, wenn Sie auffrischen m√∂chten, was ein Broadcast Receiver ist.**](android-applications-basics.md#broadcast-receivers)\
Denken Sie daran, dass die Aktionen eines Broadcast Receivers in der Methode `onReceive` beginnen.

Ein Broadcast Receiver wartet auf eine Art von Nachricht. Je nachdem, wie der Receiver die Nachricht verarbeitet, k√∂nnte er anf√§llig sein.\
[**Erfahren Sie, wie Sie Broadcast Receiver mit Drozer ausnutzen k√∂nnen.**](./#exploiting-broadcast-receivers)

### **Ausnutzen von Schemas / Deep Links**

Sie k√∂nnen Deep Links manuell suchen, Tools wie MobSF oder Skripte wie [dieses hier](https://github.com/ashleykinguk/FBLinkBuilder/blob/master/FBLinkBuilder.py) verwenden.\
Sie k√∂nnen ein deklariertes **Schema** mit **adb** oder einem **Browser** **√∂ffnen**:

{% code overflow="wrap" %}
```bash
adb shell am start -a android.intent.action.VIEW -d "scheme://hostname/path?param=value" [your.package.name]
```
{% endcode %}

_Beachten Sie, dass Sie den Paketnamen **weglassen k√∂nnen** und das Mobilger√§t automatisch die App aufruft, die den Link √∂ffnen soll._

{% code overflow="wrap" %}
```markup
<!-- Browser regular link -->
<a href="scheme://hostname/path?param=value">Click me</a>
<!-- fallback in your url you could try the intent url -->
<a href="intent://hostname#Intent;scheme=scheme;package=your.package.name;S.browser_fallback_url=http%3A%2F%2Fwww.example.com;end">with alternative</a>
```
{% endcode %}

**Ausgef√ºhrter Code**

Um den **Code, der in der App ausgef√ºhrt wird**, zu finden, gehen Sie zur Aktivit√§t, die durch den Deeplink aufgerufen wird, und suchen Sie die Funktion **`onNewIntent`**.

![](<../../.gitbook/assets/image (436) (1) (1) (1).png>)

**Sensible Informationen**

Jedes Mal, wenn Sie einen Deeplink finden, √ºberpr√ºfen Sie, dass **keine sensiblen Daten (wie Passw√∂rter) √ºber URL-Parameter √ºbertragen werden**, da eine andere Anwendung den Deeplink **nachahmen und diese Daten stehlen k√∂nnte!**

**Parameter im Pfad**

Sie **m√ºssen auch √ºberpr√ºfen, ob ein Deeplink einen Parameter im Pfad** der URL verwendet, wie z.B.: `https://api.example.com/v1/users/{username}`, in diesem Fall k√∂nnen Sie einen Pfadtraversal erzwingen, indem Sie auf etwas wie zugreifen: `example://app/users?username=../../unwanted-endpoint%3fparam=value`.\
Beachten Sie, dass Sie, wenn Sie die richtigen Endpunkte innerhalb der Anwendung finden, einen **Open Redirect** verursachen k√∂nnen (wenn ein Teil des Pfads als Domainname verwendet wird), **Account√ºbernahme** (wenn Sie Benutzerdetails ohne CSRF-Token √§ndern k√∂nnen und der verwundbare Endpunkt die richtige Methode verwendet) und andere Schwachstellen. Weitere [Informationen dazu hier](http://dphoeniixx.com/2020/12/13-2/).

**Weitere Beispiele**

Ein [interessanter Bug-Bounty-Bericht](https://hackerone.com/reports/855618) √ºber Links (_/.well-known/assetlinks.json_).

### √úberpr√ºfung und Fehler bei der Transportebene

* **Zertifikate werden von Android-Anwendungen nicht immer ordnungsgem√§√ü √ºberpr√ºft**. Es ist √ºblich, dass diese Anwendungen Warnungen √ºbersehen und selbstsignierte Zertifikate akzeptieren oder in einigen F√§llen auf die Verwendung von HTTP-Verbindungen zur√ºckgreifen.
* **Verhandlungen w√§hrend des SSL/TLS-Handshakes sind manchmal schwach**, wobei unsichere Verschl√ºsselungssuiten verwendet werden. Diese Schwachstelle macht die Verbindung anf√§llig f√ºr Man-in-the-Middle (MITM)-Angriffe, die es Angreifern erm√∂glichen, die Daten zu entschl√ºsseln.
* **Leckage privater Informationen** ist ein Risiko, wenn Anwendungen sich √ºber sichere Kan√§le authentifizieren, dann aber √ºber unverschl√ºsselte Kan√§le f√ºr andere Transaktionen kommunizieren. Dieser Ansatz sch√ºtzt sensible Daten wie Sitzungscookies oder Benutzerdetails nicht vor dem Abfangen durch b√∂sartige Entit√§ten.

#### Zertifikats√ºberpr√ºfung

Wir werden uns auf die **Zertifikats√ºberpr√ºfung** konzentrieren. Die Integrit√§t des Serverzertifikats muss √ºberpr√ºft werden, um die Sicherheit zu erh√∂hen. Dies ist entscheidend, da unsichere TLS-Konfigurationen und die √úbertragung sensibler Daten √ºber unverschl√ºsselte Kan√§le erhebliche Risiken darstellen k√∂nnen. F√ºr detaillierte Schritte zur √úberpr√ºfung von Serverzertifikaten und zur Behebung von Schwachstellen bietet [**diese Ressource**](https://manifestsecurity.com/android-application-security-part-10/) umfassende Anleitungen.

#### SSL Pinning

SSL Pinning ist eine Sicherheitsma√ünahme, bei der die Anwendung das Serverzertifikat gegen eine im Anwendungscode gespeicherte Kopie √ºberpr√ºft. Diese Methode ist entscheidend, um MITM-Angriffe zu verhindern. Die Implementierung von SSL Pinning wird f√ºr Anwendungen, die sensible Informationen verarbeiten, dringend empfohlen.

#### Traffic-Inspektion

Um den HTTP-Verkehr zu inspizieren, ist es erforderlich, das Zertifikat des Proxy-Tools zu **installieren** (z.B. Burp). Ohne Installation dieses Zertifikats k√∂nnte der verschl√ºsselte Verkehr √ºber den Proxy nicht sichtbar sein. F√ºr eine Anleitung zur Installation eines benutzerdefinierten CA-Zertifikats, [**klicken Sie hier**](avd-android-virtual-device.md#install-burp-certificate-on-a-virtual-machine).

Anwendungen, die **API-Level 24 und h√∂her** anvisieren, erfordern √Ñnderungen an der Netzwerksicherheitskonfiguration, um das CA-Zertifikat des Proxys zu akzeptieren. Dieser Schritt ist entscheidend f√ºr die Inspektion des verschl√ºsselten Verkehrs. F√ºr Anweisungen zur √Ñnderung der Netzwerksicherheitskonfiguration, [**verweisen Sie auf dieses Tutorial**](make-apk-accept-ca-certificate.md).

#### Umgehen von SSL Pinning

Wenn SSL Pinning implementiert ist, ist es erforderlich, es zu umgehen, um den HTTPS-Verkehr zu inspizieren. Daf√ºr stehen verschiedene Methoden zur Verf√ºgung:

* Automatisches **√Ñndern** der **APK**, um das SSL-Pinning mit [**apk-mitm**](https://github.com/shroudedcode/apk-mitm) zu **umgehen**. Der gr√∂√üte Vorteil dieser Option ist, dass Sie kein Root ben√∂tigen, um das SSL Pinning zu umgehen, aber Sie m√ºssen die Anwendung l√∂schen und die neue installieren, und dies funktioniert nicht immer.
* Sie k√∂nnten **Frida** (unten diskutiert) verwenden, um diesen Schutz zu umgehen. Hier finden Sie eine Anleitung zur Verwendung von Burp+Frida+Genymotion: [https://spenkk.github.io/bugbounty/Configuring-Frida-with-Burp-and-GenyMotion-to-bypass-SSL-Pinning/](https://spenkk.github.io/bugbounty/Configuring-Frida-with-Burp-and-GenyMotion-to-bypass-SSL-Pinning/)
* Sie k√∂nnen auch versuchen, das **SSL Pinning automatisch zu umgehen**, indem Sie [**objection**](frida-tutorial/objection-tutorial.md)**:** `objection --gadget com.package.app explore --startup-command "android sslpinning disable"` verwenden
* Sie k√∂nnen auch versuchen, das **SSL Pinning automatisch zu umgehen**, indem Sie die **MobSF-Dynamikanalyse** (unten erkl√§rt) verwenden
* Wenn Sie immer noch der Meinung sind, dass es Verkehr gibt, den Sie nicht erfassen, k√∂nnen Sie versuchen, den Verkehr an Burp weiterzuleiten, indem Sie iptables verwenden. Lesen Sie diesen Blog: [https://infosecwriteups.com/bypass-ssl-pinning-with-ip-forwarding-iptables-568171b52b62](https://infosecwriteups.com/bypass-ssl-pinning-with-ip-forwarding-iptables-568171b52b62)

#### Suche nach g√§ngigen Web-Schwachstellen

Es ist auch wichtig, nach g√§ngigen Web-Schwachstellen in der Anwendung zu suchen. Detaillierte Informationen zur Identifizierung und Behebung dieser Schwachstellen sind √ºber den Rahmen dieser Zusammenfassung hinaus umfassend abgedeckt.

### Frida

[Frida](https://www.frida.re) ist ein dynamisches Instrumentierungstoolkit f√ºr Entwickler, Reverse-Engineers und Sicherheitsforscher.\
**Sie k√∂nnen auf die laufende Anwendung zugreifen und Methoden zur Laufzeit anhaken, um das Verhalten zu √§ndern, Werte zu √§ndern, Werte zu extrahieren, anderen Code auszuf√ºhren...**\
Wenn Sie Android-Anwendungen pentesten m√∂chten, m√ºssen Sie wissen, wie man Frida verwendet.

* Lernen Sie, wie man Frida verwendet: [**Frida-Tutorial**](frida-tutorial/)
* Einige "GUI" f√ºr Aktionen mit Frida: [**https://github.com/m0bilesecurity/RMS-Runtime-Mobile-Security**](https://github.com/m0bilesecurity/RMS-Runtime-Mobile-Security)
* Ojection ist gro√üartig, um die Verwendung von Frida zu automatisieren: [**https://github.com/sensepost/objection**](https://github.com/sensepost/objection) **,** [**https://github.com/dpnishant/appmon**](https://github.com/dpnishant/appmon)
* Hier finden Sie einige gro√üartige Frida-Skripte: [**https://codeshare.frida.re/**](https://codeshare.frida.re)

### **Speicher dumpen - Fridump**

√úberpr√ºfen Sie, ob die Anwendung sensible Informationen im Speicher speichert, die sie nicht speichern sollte, wie Passw√∂rter oder Mnemonics.

Mit [**Fridump3**](https://github.com/rootbsd/fridump3) k√∂nnen Sie den Speicher der App dumpen mit:
```bash
# With PID
python3 fridump3.py -u <PID>

# With name
frida-ps -Uai
python3 fridump3.py -u "<Name>"
```
Dies wird den Speicher im ./dump-Ordner ablegen, und dort k√∂nnten Sie mit etwas wie folgt grep durchf√ºhren:

{% code overflow="wrap" %}
```bash
strings * | grep -E "^[a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+$"
```
{% endcode %}

### **Sensitive Daten im Keystore**

In Android ist der Keystore der beste Ort, um sensible Daten zu speichern, jedoch ist es mit ausreichenden Berechtigungen immer noch **m√∂glich darauf zuzugreifen**. Da Apps dazu neigen, hier **sensible Daten im Klartext zu speichern**, sollten Pentests darauf pr√ºfen, da Root-Benutzer oder Personen mit physischem Zugriff auf das Ger√§t in der Lage sein k√∂nnten, diese Daten zu stehlen.

Auch wenn eine App Daten im Keystore speichert, sollten die Daten verschl√ºsselt sein.

Um auf die Daten im Keystore zuzugreifen, k√∂nnten Sie dieses Frida-Skript verwenden: [https://github.com/WithSecureLabs/android-keystore-audit/blob/master/frida-scripts/tracer-cipher.js](https://github.com/WithSecureLabs/android-keystore-audit/blob/master/frida-scripts/tracer-cipher.js)
```bash
frida -U -f com.example.app -l frida-scripts/tracer-cipher.js
```
### **Fingerabdruck/Biometrie-Umgehung**

Mithilfe des folgenden Frida-Skripts k√∂nnte es m√∂glich sein, die **Fingerabdruckauthentifizierung** zu umgehen, die Android-Apps m√∂glicherweise durchf√ºhren, um **bestimmte sensible Bereiche zu sch√ºtzen:**
```bash
frida --codeshare krapgras/android-biometric-bypass-update-android-11 -U -f <app.package>
```
{% endcode %}

### **Hintergrundbilder**

Wenn Sie eine Anwendung im Hintergrund platzieren, speichert Android eine **Momentaufnahme der Anwendung**, sodass beim Wiederherstellen in den Vordergrund das Bild geladen wird, bevor die App geladen wird, sodass es aussieht, als ob die App schneller geladen wurde.

Wenn diese Momentaufnahme jedoch **sensible Informationen** enth√§lt, k√∂nnte jemand, der Zugriff auf die Momentaufnahme hat, diese Informationen **stehlen** (beachten Sie, dass Sie Root-Zugriff ben√∂tigen, um darauf zuzugreifen).

Die Momentaufnahmen werden normalerweise unter **`/data/system_ce/0/snapshots`** gespeichert.

Android bietet eine M√∂glichkeit, **das Erfassen von Bildschirmfotos zu verhindern, indem der FLAG\_SECURE** Layout-Parameter festgelegt wird. Durch Verwendung dieses Flags werden die Fensterinhalte als sicher behandelt, sodass sie nicht in Bildschirmfotos erscheinen oder auf nicht sicheren Displays angezeigt werden k√∂nnen.
```bash
getWindow().setFlags(LayoutParams.FLAG_SECURE, LayoutParams.FLAG_SECURE);
```
### **Android-Anwendungsanalysator**

Dieses Tool k√∂nnte Ihnen helfen, verschiedene Tools w√§hrend der dynamischen Analyse zu verwalten: [https://github.com/NotSoSecure/android\_application\_analyzer](https://github.com/NotSoSecure/android\_application\_analyzer)

### Intent-Injektion

Entwickler erstellen oft Proxy-Komponenten wie Aktivit√§ten, Dienste und Broadcast-Empf√§nger, die diese Intents verarbeiten und sie an Methoden wie `startActivity(...)` oder `sendBroadcast(...)` weitergeben, was riskant sein kann.

Die Gefahr besteht darin, dass Angreifer nicht exportierte App-Komponenten ausl√∂sen oder auf sensible Inhaltsanbieter zugreifen k√∂nnen, indem sie diese Intents umleiten. Ein bemerkenswertes Beispiel ist die `WebView`-Komponente, die URLs √ºber `Intent.parseUri(...)` in `Intent`-Objekte umwandelt und sie dann ausf√ºhrt, was potenziell zu b√∂sartigen Intent-Injektionen f√ºhren kann.

### Wichtige Erkenntnisse

* **Intent-Injektion** √§hnelt dem Open-Redirect-Problem im Web.
* Exploits beinhalten das Weiterleiten von `Intent`-Objekten als Extras, die zu unsicheren Operationen f√ºhren k√∂nnen.
* Es kann nicht exportierte Komponenten und Inhaltsanbieter f√ºr Angreifer freilegen.
* Die Umwandlung von URLs in `Intent` durch `WebView` kann unbeabsichtigte Aktionen erleichtern.

### Android-Client-seitige Injektionen und andere

Sie kennen wahrscheinlich diese Art von Schwachstellen aus dem Web. Sie m√ºssen bei einer Android-Anwendung besonders vorsichtig sein:

* **SQL-Injektion:** Bei der Arbeit mit dynamischen Abfragen oder Content-Providern stellen Sie sicher, dass Sie parametrisierte Abfragen verwenden.
* **JavaScript-Injektion (XSS):** Stellen Sie sicher, dass JavaScript- und Plugin-Unterst√ºtzung f√ºr alle WebViews deaktiviert ist (standardm√§√üig deaktiviert). [Weitere Informationen hier](webview-attacks.md#javascript-enabled).
* **Lokale Dateieinschlie√üung:** WebViews sollten keinen Zugriff auf das Dateisystem haben (standardm√§√üig aktiviert) - `(webview.getSettings().setAllowFileAccess(false);)`. [Weitere Informationen hier](webview-attacks.md#javascript-enabled).
* **Ewige Cookies:** In mehreren F√§llen wird das Cookie nicht widerrufen, wenn die Android-Anwendung die Sitzung beendet, oder es k√∂nnte sogar auf der Festplatte gespeichert sein.
* [**Sicheres Flag** in Cookies](../../pentesting-web/hacking-with-cookies/#cookies-flags)

***

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

Treten Sie dem [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) Server bei, um mit erfahrenen Hackern und Bug-Bounty-J√§gern zu kommunizieren!

**Hacking-Einblicke**\
Besch√§ftigen Sie sich mit Inhalten, die sich mit dem Nervenkitzel und den Herausforderungen des Hackens befassen

**Echtzeit-Hack-News**\
Bleiben Sie mit der schnelllebigen Welt des Hackens durch Echtzeitnachrichten und Einblicke auf dem Laufenden

**Neueste Ank√ºndigungen**\
Bleiben Sie √ºber die neuesten Bug-Bounties und wichtige Plattformupdates informiert

**Treten Sie uns bei** [**Discord**](https://discord.com/invite/N3FrSbmwdy) bei und beginnen Sie noch heute mit Top-Hackern zusammenzuarbeiten!

## Automatische Analyse

### [MobSF](https://github.com/MobSF/Mobile-Security-Framework-MobSF)

**Statische Analyse**

![](<../../.gitbook/assets/image (61).png>)

**Vulnerabilit√§tsbewertung der Anwendung** mit einem benutzerfreundlichen webbasierten Frontend. Sie k√∂nnen auch eine dynamische Analyse durchf√ºhren (aber Sie m√ºssen die Umgebung vorbereiten).
```bash
docker pull opensecurity/mobile-security-framework-mobsf
docker run -it -p 8000:8000 opensecurity/mobile-security-framework-mobsf:latest
```
Beachten Sie, dass MobSF **Android**(apk), IOS**(ipa) und Windows**(apx)-Anwendungen analysieren kann (_Windows-Anwendungen m√ºssen von einem auf einem Windows-Host installierten MobSF analysiert werden_).\
Wenn Sie au√üerdem eine **ZIP**-Datei mit dem Quellcode einer **Android**- oder einer **IOS**-App erstellen (gehen Sie zum Stammverzeichnis der Anwendung, w√§hlen Sie alles aus und erstellen Sie eine ZIP-Datei), kann sie auch analysiert werden.

MobSF erm√∂glicht auch das **Diff/Vergleichen** von Analysen und die Integration von **VirusTotal** (Sie m√ºssen Ihren API-Schl√ºssel in _MobSF/settings.py_ festlegen und aktivieren: `VT_ENABLED = TRUE` `VT_API_KEY = <Ihr API-Schl√ºssel>` `VT_UPLOAD = TRUE`). Sie k√∂nnen auch `VT_UPLOAD` auf `False` setzen, dann wird der **Hash** anstelle der Datei **hochgeladen**.

### Unterst√ºtzte dynamische Analyse mit MobSF

**MobSF** kann auch bei der **dynamischen Analyse** in **Android** sehr hilfreich sein, aber in diesem Fall m√ºssen Sie MobSF und **Genymotion** auf Ihrem Host installieren (eine VM oder Docker funktionieren nicht). _Hinweis: Sie m√ºssen zuerst eine VM in Genymotion **starten** und **dann MobSF** ausf√ºhren._\
Der **MobSF-Dynamikanalysator** kann:

* **Anwendungsdaten ausgeben** (URLs, Protokolle, Zwischenablage, von Ihnen erstellte Screenshots, von "**Exported Activity Tester**" erstellte Screenshots, E-Mails, SQLite-Datenbanken, XML-Dateien und andere erstellte Dateien). All dies erfolgt automatisch, au√üer den Screenshots, die Sie machen m√ºssen, wenn Sie einen Screenshot w√ºnschen, oder Sie m√ºssen "**Exported Activity Tester**" dr√ºcken, um Screenshots aller exportierten Aktivit√§ten zu erhalten.
* HTTPS-Verkehr erfassen
* **Frida** verwenden, um **Laufzeitinformationen** zu erhalten

Ab Android **Versionen > 5** wird **Frida automatisch gestartet** und die globalen **Proxy**-Einstellungen werden so konfiguriert, dass der Verkehr **erfasst** wird. Es wird nur der Verkehr aus der getesteten Anwendung erfasst.

**Frida**

Standardm√§√üig werden auch einige Frida-Skripte verwendet, um **SSL-Pinning**, **Root-Erkennung** und **Debugger-Erkennung** zu **umgehen** und interessante APIs zu **√ºberwachen**.\
MobSF kann auch **exportierte Aktivit√§ten aufrufen**, **Screenshots** davon aufnehmen und f√ºr den Bericht **speichern**.

Um mit dem dynamischen Testen zu **beginnen**, dr√ºcken Sie die gr√ºne Schaltfl√§che "**Start Instrumentation**". Dr√ºcken Sie auf "**Frida Live Logs**", um die von den Frida-Skripten generierten Protokolle zu sehen, und auf "**Live API Monitor**", um alle Aufrufe an gehakte Methoden, √ºbergebene Argumente und zur√ºckgegebene Werte zu sehen (dies erscheint nach dem Dr√ºcken von "Start Instrumentation").\
MobSF erm√∂glicht es Ihnen auch, Ihre eigenen **Frida-Skripte** zu laden (um die Ergebnisse Ihrer Friday-Skripte an MobSF zu senden, verwenden Sie die Funktion `send()`). Es verf√ºgt auch √ºber **mehrere vordefinierte Skripte**, die Sie laden k√∂nnen (Sie k√∂nnen weitere unter `MobSF/DynamicAnalyzer/tools/frida_scripts/others/` hinzuf√ºgen), w√§hlen Sie sie einfach aus, dr√ºcken Sie "**Load**" und dr√ºcken Sie "**Start Instrumentation**" (Sie k√∂nnen die Protokolle dieser Skripte im "**Frida Live Logs**" sehen).

![](<../../.gitbook/assets/image (215).png>)

Dar√ºber hinaus verf√ºgen Sie √ºber einige Hilfs-Frida-Funktionen:

* **Klassen auflisten**: Es werden alle geladenen Klassen angezeigt
* **Zeichenfolgen erfassen**: Es werden alle erfassten Zeichenfolgen beim Verwenden der Anwendung angezeigt (sehr laut)
* **Zeichenfolgenvergleiche erfassen**: Kann sehr n√ºtzlich sein. Es zeigt die 2 verglichenen Zeichenfolgen und ob das Ergebnis True oder False war.
* **Methoden der Klasse auflisten**: Geben Sie den Klassennamen ein (wie "java.io.File") und es werden alle Methoden der Klasse angezeigt.
* **Klassenmuster suchen**: Klassen nach Muster suchen
* **Klassenmethoden verfolgen**: Eine **ganze Klasse** verfolgen (Eingaben und Ausgaben aller Methoden der Klasse anzeigen). Denken Sie daran, dass MobSF standardm√§√üig mehrere interessante Android-API-Methoden verfolgt.

Sobald Sie das Hilfsmodul ausgew√§hlt haben, das Sie verwenden m√∂chten, m√ºssen Sie auf "**Start Intrumentation**" dr√ºcken, und Sie sehen alle Ausgaben in "**Frida Live Logs**".

**Shell**

Mobsf bietet auch eine Shell mit einigen **adb**-Befehlen, **MobSF-Befehlen** und g√§ngigen **Shell-Befehlen** am unteren Rand der Seite f√ºr die dynamische Analyse. Einige interessante Befehle:
```bash
help
shell ls
activities
exported_activities
services
receivers
```
**HTTP-Tools**

Wenn HTTP-Verkehr erfasst wird, k√∂nnen Sie eine unansehnliche Ansicht des erfassten Verkehrs am unteren Rand von "**HTTP(S) Traffic**" oder eine sch√∂nere Ansicht im gr√ºnen Bereich von "**Start HTTPTools**" sehen. Mit der zweiten Option k√∂nnen Sie die erfassten Anfragen an Proxies wie Burp oder Owasp ZAP **senden**.\
Um dies zu tun, _schalten Sie Burp ein -->_ _schalten Sie Intercept aus --> in MobSB HTTPTools w√§hlen Sie die Anfrage aus_ --> dr√ºcken Sie "**An Fuzzer senden**" --> _w√§hlen Sie die Proxy-Adresse_ ([http://127.0.0.1:8080\\](http://127.0.0.1:8080)).

Nach Abschluss der dynamischen Analyse mit MobSF k√∂nnen Sie auf "**Start Web API Fuzzer**" dr√ºcken, um HTTP-Anfragen zu **fuzz** und nach Schwachstellen zu suchen.

{% hint style="info" %}
Nach Durchf√ºhrung einer dynamischen Analyse mit MobSF k√∂nnen die Proxy-Einstellungen falsch konfiguriert sein und Sie k√∂nnen sie nicht √ºber die GUI beheben. Sie k√∂nnen die Proxy-Einstellungen wie folgt beheben:
```
adb shell settings put global http_proxy :0
```
{% endhint %}

### Unterst√ºtzte dynamische Analyse mit Inspeckage

Sie k√∂nnen das Tool von [**Inspeckage**](https://github.com/ac-pm/Inspeckage) erhalten.\
Dieses Tool verwendet einige **Hooks**, um Ihnen mitzuteilen, **was in der Anwendung passiert**, w√§hrend Sie eine **dynamische Analyse** durchf√ºhren.

### [Yaazhini](https://www.vegabird.com/yaazhini/)

Dies ist ein **gro√üartiges Tool zur Durchf√ºhrung einer statischen Analyse mit einer grafischen Benutzeroberfl√§che**

![](<../../.gitbook/assets/image (527).png>)

### [Qark](https://github.com/linkedin/qark)

Dieses Tool ist darauf ausgelegt, nach mehreren **sicherheitsrelevanten Schwachstellen von Android-Anwendungen** zu suchen, entweder im **Quellcode** oder in **verpackten APKs**. Das Tool ist auch **in der Lage, ein "Proof-of-Concept" bereitstellbares APK** und **ADB-Befehle** zu erstellen, um einige der gefundenen Schwachstellen auszunutzen (exponierte Aktivit√§ten, Intents, Tapjacking...). Wie bei Drozer ist es nicht erforderlich, das Testger√§t zu rooten.
```bash
pip3 install --user qark  # --user is only needed if not using a virtualenv
qark --apk path/to/my.apk
qark --java path/to/parent/java/folder
qark --java path/to/specific/java/file.java
```
### [**ReverseAPK**](https://github.com/1N3/ReverseAPK.git)

* Zeigt alle extrahierten Dateien zur einfachen Referenz an
* Dekompiliert APK-Dateien automatisch in Java- und Smali-Format
* Analysiert AndroidManifest.xml auf h√§ufige Schwachstellen und Verhalten
* Statische Quellcodeanalyse auf h√§ufige Schwachstellen und Verhalten
* Ger√§teinformationen
* und mehr
```bash
reverse-apk relative/path/to/APP.apk
```
### [SUPER Android Analyzer](https://github.com/SUPERAndroidAnalyzer/super)

SUPER ist eine Befehlszeilenanwendung, die in Windows, MacOS X und Linux verwendet werden kann, um _.apk_ Dateien auf Schwachstellen zu untersuchen. Dies geschieht durch das Dekomprimieren von APKs und das Anwenden einer Reihe von Regeln zur Erkennung dieser Schwachstellen.

Alle Regeln sind in einer `rules.json`-Datei zentriert, und jedes Unternehmen oder Tester kann seine eigenen Regeln erstellen, um zu analysieren, was sie ben√∂tigen.

Laden Sie die neuesten Bin√§rdateien von der [Download-Seite](https://superanalyzer.rocks/download.html) herunter.
```
super-analyzer {apk_file}
```
### [StaCoAn](https://github.com/vincentcox/StaCoAn)

![](<../../.gitbook/assets/image (62).png>)

StaCoAn ist ein plattform√ºbergreifendes Tool, das Entwicklern, Bug-Bounty-J√§gern und ethischen Hackern bei der Durchf√ºhrung einer statischen Codeanalyse von mobilen Anwendungen hilft.

Das Konzept besteht darin, dass Sie Ihre mobile Anwendungsdatei (eine .apk- oder .ipa-Datei) in die StaCoAn-Anwendung ziehen und ablegen, und diese wird einen visuellen und tragbaren Bericht f√ºr Sie generieren. Sie k√∂nnen die Einstellungen und Wortlisten anpassen, um eine personalisierte Erfahrung zu erhalten.

Laden Sie die [neueste Version herunter](https://github.com/vincentcox/StaCoAn/releases):
```
./stacoan
```
### [AndroBugs](https://github.com/AndroBugs/AndroBugs\_Framework)

AndroBugs Framework ist ein Android-Schwachstellenanalyse-System, das Entwicklern oder Hackern hilft, potenzielle Sicherheitsl√ºcken in Android-Anwendungen zu finden.\
[Windows-Versionen](https://github.com/AndroBugs/AndroBugs\_Framework/releases)
```
python androbugs.py -f [APK file]
androbugs.exe -f [APK file]
```
### [Androwarn](https://github.com/maaaaz/androwarn)

**Androwarn** ist ein Tool, dessen Hauptziel es ist, potenziell b√∂sartige Verhaltensweisen zu erkennen und den Benutzer zu warnen, die von einer Android-Anwendung entwickelt wurden.

Die Erkennung erfolgt durch die **statische Analyse** des Dalvik-Bytecodes der Anwendung, dargestellt als **Smali**, mit der [`androguard`](https://github.com/androguard/androguard) Bibliothek.

Dieses Tool sucht nach **√ºblichem Verhalten von "schlechten" Anwendungen** wie: Exfiltration von Telekommunikationsidentifikatoren, Abfangen von Audio-/Videodatenstr√∂men, Modifikation von PIM-Daten, Ausf√ºhrung beliebigen Codes...
```
python androwarn.py -i my_application_to_be_analyzed.apk -r html -v 3
```
### [MARA Framework](https://github.com/xtiankisutsa/MARA_Framework)

![](<../../.gitbook/assets/image (81).png>)

**MARA** ist ein **M**obile **A**pplication **R**everse Engineering und **A**nalysis Framework. Es ist ein Tool, das g√§ngige Tools f√ºr das Reverse Engineering und die Analyse von mobilen Anwendungen zusammenf√ºhrt, um bei der Pr√ºfung von mobilen Anwendungen gegen die OWASP-Sicherheitsbedrohungen zu helfen. Das Ziel ist es, diese Aufgabe f√ºr mobile Anwendungs-Entwickler und Sicherheitsfachleute einfacher und benutzerfreundlicher zu gestalten.

Es kann:

* Java- und Smali-Code mit verschiedenen Tools extrahieren
* APKs analysieren mit: [smalisca](https://github.com/dorneanu/smalisca), [ClassyShark](https://github.com/google/android-classyshark), [androbugs](https://github.com/AndroBugs/AndroBugs_Framework), [androwarn](https://github.com/maaaaz/androwarn), [APKiD](https://github.com/rednaga/APKiD)
* Private Informationen aus der APK mithilfe von Regexps extrahieren.
* Das Manifest analysieren.
* Gefundene Domains analysieren mit: [pyssltest](https://github.com/moheshmohan/pyssltest), [testssl](https://github.com/drwetter/testssl.sh) und [whatweb](https://github.com/urbanadventurer/WhatWeb)
* APK √ºber [apk-deguard.com](http://www.apk-deguard.com) deobfuskieren

### Koodous

N√ºtzlich zur Erkennung von Malware: [https://koodous.com/](https://koodous.com)

## Code obfuskieren/deobfuskieren

Beachten Sie, dass je nach dem Service und der Konfiguration, die Sie zum Obfuskieren des Codes verwenden, Geheimnisse obfuskiert sein k√∂nnen oder nicht.

### [ProGuard](https://en.wikipedia.org/wiki/ProGuard\_\(software\))

Von [Wikipedia](https://en.wikipedia.org/wiki/ProGuard\_\(software\)): **ProGuard** ist ein Open-Source-Befehlszeilentool, das Java-Code verkleinert, optimiert und obfuskiert. Es kann Bytecode optimieren sowie ungenutzte Anweisungen erkennen und entfernen. ProGuard ist freie Software und wird unter der GNU General Public License, Version 2, verteilt.

ProGuard wird als Teil des Android SDK verteilt und wird beim Erstellen der Anwendung im Release-Modus ausgef√ºhrt.

### [DexGuard](https://www.guardsquare.com/dexguard)

Finden Sie eine schrittweise Anleitung zur Deobfuskierung der APK unter [https://blog.lexfo.fr/dexguard.html](https://blog.lexfo.fr/dexguard.html)

(Aus dieser Anleitung) Das letzte Mal, als wir nachgeschaut haben, war der Dexguard-Modus der Betrieb:

* Laden einer Ressource als InputStream;
* Das Ergebnis an eine von FilterInputStream abgeleitete Klasse weitergeben, um es zu entschl√ºsseln;
* Einige nutzlose Obfuskation durchf√ºhren, um einem Reverser ein paar Minuten Zeit zu stehlen;
* Das entschl√ºsselte Ergebnis an einen ZipInputStream weitergeben, um eine DEX-Datei zu erhalten;
* Schlie√ülich die resultierende DEX als Ressource mit der Methode `loadDex` laden.

### [DeGuard](http://apk-deguard.com)

**DeGuard kehrt den Vorgang der Obfuskation um, der von Android-Obfuskationstools durchgef√ºhrt wurde. Dies erm√∂glicht zahlreiche Sicherheitsanalysen, einschlie√ülich Codeinspektion und Vorhersage von Bibliotheken.**

Sie k√∂nnen eine obfuskierte APK auf ihrer Plattform hochladen.

### [Simplify](https://github.com/CalebFenton/simplify)

Es ist ein **generischer Android-Deobfuscator.** Simplify **f√ºhrt praktisch eine App aus**, um ihr Verhalten zu verstehen, und versucht dann, den Code zu optimieren, damit er sich identisch verh√§lt, aber f√ºr einen Menschen leichter verst√§ndlich ist. Jede Optimierungsart ist einfach und generisch, daher spielt es keine Rolle, welche spezifische Art der Obfuskation verwendet wird.

### [APKiD](https://github.com/rednaga/APKiD)

APKiD gibt Ihnen Informationen dar√ºber, **wie eine APK erstellt wurde**. Es identifiziert viele **Compiler**, **Packer**, **Obfuskatoren** und andere seltsame Dinge. Es ist [_PEiD_](https://www.aldeid.com/wiki/PEiD) f√ºr Android.

### Manuell

[Lesen Sie dieses Tutorial, um einige Tricks zum **Reverse Engineering von benutzerdefinierter Obfuskation** zu lernen](manual-deobfuscation.md)

## Labs

### [Androl4b](https://github.com/sh4hin/Androl4b)

AndroL4b ist eine Android-Sicherheitsvirtual Machine auf Basis von Ubuntu-Mate, die die neuesten Frameworks, Tutorials und Labs von verschiedenen Sicherheitsgeeks und Forschern f√ºr Reverse Engineering und Malware-Analyse enth√§lt.

## Referenzen

* [https://owasp.org/www-project-mobile-app-security/](https://owasp.org/www-project-mobile-app-security/)
* [https://appsecwiki.com/#/](https://appsecwiki.com/#/) Es ist eine gro√üartige Liste von Ressourcen
* [https://maddiestone.github.io/AndroidAppRE/](https://maddiestone.github.io/AndroidAppRE/) Android-Schnellkurs
* [https://manifestsecurity.com/android-application-security/](https://manifestsecurity.com/android-application-security/)
* [https://github.com/Ralireza/Android-Security-Teryaagh](https://github.com/Ralireza/Android-Security-Teryaagh)
* [https://www.youtube.com/watch?v=PMKnPaGWxtg\&feature=youtu.be\&ab\_channel=B3nacSec](https://www.youtube.com/watch?v=PMKnPaGWxtg\&feature=youtu.be\&ab\_channel=B3nacSec)

## Noch auszuprobieren

* [https://www.vegabird.com/yaazhini/](https://www.vegabird.com/yaazhini/)
* [https://github.com/abhi-r3v0/Adhrit](https://github.com/abhi-r3v0/Adhrit)

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

Treten Sie dem [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) Server bei, um mit erfahrenen Hackern und Bug-Bounty-J√§gern zu kommunizieren!

**Hacking Insights**\
Besch√§ftigen Sie sich mit Inhalten, die sich mit dem Nervenkitzel und den Herausforderungen des Hackens befassen

**Echtzeit-Hack-News**\
Bleiben Sie mit der schnelllebigen Hacking-Welt durch Echtzeit-Nachrichten und Einblicke auf dem Laufenden

**Neueste Ank√ºndigungen**\
Bleiben Sie √ºber die neuesten Bug-Bounties und wichtigen Plattform-Updates informiert

**Treten Sie uns bei** auf [**Discord**](https://discord.com/invite/N3FrSbmwdy) und beginnen Sie noch heute mit der Zusammenarbeit mit Top-Hackern!
