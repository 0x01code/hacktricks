# Pentesting de Aplicaciones Android

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* ¬øTrabajas en una **empresa de ciberseguridad**? ¬øQuieres ver tu **empresa anunciada en HackTricks**? ¬øO quieres tener acceso a la **√∫ltima versi√≥n de PEASS o descargar HackTricks en PDF**? ¬°Consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obt√©n el [**merchandising oficial de PEASS y HackTricks**](https://peass.creator-spring.com)
* **√önete al** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de Telegram**](https://t.me/peass) o **s√≠gueme** en **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Comparte tus trucos de hacking enviando PRs al** [**repositorio de hacktricks**](https://github.com/carlospolop/hacktricks) **y al** [**repositorio de hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

<figure><img src="../../.gitbook/assets/image (1).png" alt=""><figcaption></figcaption></figure>

**HackenProof es el hogar de todas las recompensas por errores de criptograf√≠a.**

**Obt√©n recompensas sin demoras**\
Las recompensas de HackenProof se lanzan solo cuando sus clientes depositan el presupuesto de recompensa. Obtendr√°s la recompensa despu√©s de que se verifique el error.

**Obt√©n experiencia en pentesting web3**\
¬°Los protocolos de blockchain y los contratos inteligentes son el nuevo Internet! Domina la seguridad web3 en sus d√≠as de crecimiento.

**Convi√©rtete en la leyenda del hacker web3**\
Gana puntos de reputaci√≥n con cada error verificado y conquista la cima de la clasificaci√≥n semanal.

[**Reg√≠strate en HackenProof**](https://hackenproof.com/register) y comienza a ganar con tus hacks!

{% embed url="https://hackenproof.com/register" %}

## Conceptos b√°sicos de las aplicaciones Android

Se recomienda encarecidamente comenzar a leer esta p√°gina para conocer las **partes m√°s importantes relacionadas con la seguridad de Android y los componentes m√°s peligrosos en una aplicaci√≥n Android**:

{% content-ref url="android-applications-basics.md" %}
[android-applications-basics.md](android-applications-basics.md)
{% endcontent-ref %}

## ADB (Android Debug Bridge)

Esta es la herramienta principal que necesitas para conectarte a un dispositivo Android (emulado o f√≠sico).\
Te permite controlar tu dispositivo a trav√©s de **USB** o **Red** desde una computadora, **copiar** archivos de ida y vuelta, **instalar** y desinstalar aplicaciones, ejecutar comandos de **shell**, realizar **copias de seguridad**, leer **registros** y m√°s.

Echa un vistazo a la siguiente lista de [**Comandos de ADB**](adb-commands.md) para aprender c√≥mo usar adb.

## Smali

A veces es interesante **modificar el c√≥digo de la aplicaci√≥n** para acceder a **informaci√≥n oculta** (quiz√°s contrase√±as bien ofuscadas o banderas). Luego, podr√≠a ser interesante descompilar el apk, modificar el c√≥digo y volver a compilarlo.\
[**En este tutorial** puedes **aprender c√≥mo descompilar un APK, modificar el c√≥digo Smali y volver a compilar el APK** con la nueva funcionalidad](smali-changes.md). Esto podr√≠a ser muy √∫til como una **alternativa para varias pruebas durante el an√°lisis din√°mico** que se presentar√°n. Entonces, **siempre ten en cuenta esta posibilidad**.

## Otros trucos interesantes

* [Falsificar tu ubicaci√≥n en Play Store](spoofing-your-location-in-play-store.md)
* **Descargar APKs**: [https://apps.evozi.com/apk-downloader/](https://apps.evozi.com/apk-downloader/), [https://apkpure.com/es/](https://apkpure.com/es/), [https://www.apkmirror.com/](https://www.apkmirror.com), [https://apkcombo.com/es-es/apk-downloader/](https://apkcombo.com/es-es/apk-downloader/)
* Extraer APK del dispositivo:
```
adb shell pm list packages
com.android.insecurebankv2

adb shell pm path com.android.insecurebankv2
package:/data/app/com.android.insecurebankv2-Jnf8pNgwy3QA_U5f-n_4jQ==/base.apk

adb pull /data/app/com.android.insecurebankv2- Jnf8pNgwy3QA_U5f-n_4jQ==/base.apk
```
<figure><img src="../../.gitbook/assets/image (1).png" alt=""><figcaption></figcaption></figure>

**HackenProof es el hogar de todas las recompensas por errores de criptograf√≠a.**

**Obt√©n recompensas sin demoras**\
Las recompensas de HackenProof se lanzan solo cuando sus clientes depositan el presupuesto de recompensa. Obtendr√°s la recompensa despu√©s de que se verifique el error.

**Obt√©n experiencia en pentesting web3**\
¬°Los protocolos de blockchain y los contratos inteligentes son el nuevo Internet! Domina la seguridad web3 en sus d√≠as de crecimiento.

**Convi√©rtete en una leyenda de los hackers web3**\
Gana puntos de reputaci√≥n con cada error verificado y conquista la cima de la clasificaci√≥n semanal.

[**Reg√≠strate en HackenProof**](https://hackenproof.com/register) ¬°comienza a ganar con tus hacks!

{% embed url="https://hackenproof.com/register" %}

## An√°lisis est√°tico

En primer lugar, para analizar un APK, debes **echar un vistazo al c√≥digo Java** utilizando un descompilador.\
Por favor, [**lee aqu√≠ para encontrar informaci√≥n sobre los diferentes descompiladores disponibles**](apk-decompilers.md).

### Buscando informaci√≥n interesante

Solo echando un vistazo a las **cadenas de texto** del APK, puedes buscar **contrase√±as**, **URLs** ([https://github.com/ndelphit/apkurlgrep](https://github.com/ndelphit/apkurlgrep)), claves de **API**, **encriptaci√≥n**, **UUIDs de Bluetooth**, **tokens** y cualquier cosa interesante... busca incluso puertas traseras de ejecuci√≥n de c√≥digo o puertas traseras de autenticaci√≥n (credenciales de administrador codificadas en la aplicaci√≥n).

**Firebase**

Presta especial atenci√≥n a las **URLs de Firebase** y verifica si est√°n mal configuradas. [M√°s informaci√≥n sobre qu√© es Firebase y c√≥mo explotarlo aqu√≠.](../../network-services-pentesting/pentesting-web/buckets/firebase-database.md)

### Comprensi√≥n b√°sica de la aplicaci√≥n - Manifest.xml, strings.xml

Utilizando cualquiera de los **descompiladores** mencionados [**aqu√≠**](apk-decompilers.md), podr√°s leer el _Manifest.xml_. Tambi√©n puedes **renombrar** el archivo APK cambiando la extensi√≥n a **.zip** y **descomprimirlo**.\
Leyendo el **manifiesto**, puedes encontrar **vulnerabilidades**:

* En primer lugar, verifica si **la aplicaci√≥n se puede depurar**. Un APK de producci√≥n no deber√≠a serlo (o de lo contrario, otros podr√°n conectarse a √©l). Puedes verificar si una aplicaci√≥n es depurable buscando en el manifiesto el atributo `debuggable="true"` dentro de la etiqueta _\<application_ Ejemplo: `<application theme="@2131296387" debuggable="true"`
* [Aprende aqu√≠](drozer-tutorial/#is-debuggeable) c√≥mo encontrar aplicaciones depurables en un tel√©fono y explotarlas.
* **Copia de seguridad**: El atributo **`android:allowBackup`** define si los datos de la aplicaci√≥n se pueden respaldar y restaurar por un usuario que haya habilitado la depuraci√≥n USB. Si la bandera de copia de seguridad est√° configurada en true, permite a un atacante hacer una copia de seguridad de los datos de la aplicaci√≥n a trav√©s de adb incluso si el dispositivo no est√° rooteado. Por lo tanto, las aplicaciones que manejan y almacenan informaci√≥n sensible como detalles de tarjetas, contrase√±as, etc. deben tener esta configuraci√≥n expl√≠citamente establecida en **false**, porque de forma predeterminada est√° establecida en **true** para evitar tales riesgos.
* `<application android:allowBackup="false"`
* **NetworkSecurity:** La seguridad de red de la aplicaci√≥n puede sobrescribir los valores predeterminados con **`android:networkSecurityConfig="@xml/network_security_config"`**. Se puede colocar un archivo con ese nombre en _**res/xml.**_ Este archivo configurar√° ajustes de seguridad importantes como pines de certificado o si permite tr√°fico HTTP. Puedes leer aqu√≠ m√°s informaci√≥n sobre todas las cosas que se pueden configurar, pero revisa este ejemplo sobre c√≥mo configurar el tr√°fico HTTP para algunos dominios:
* `<domain-config cleartextTrafficPermitted="true"> <domain includeSubdomains="true">formation-software.co.uk </domain></domain-config>`
* **Actividades exportadas**: Verifica las actividades exportadas dentro del manifiesto, ya que esto podr√≠a ser peligroso. M√°s adelante, en el an√°lisis din√°mico, se explicar√° c√≥mo [puedes aprovechar este comportamiento](./#exploiting-exported-activities-authorisation-bypass).
* **Proveedores de contenido**: Si se expone un proveedor exportado, podr√≠as acceder/modificar informaci√≥n interesante. En el an√°lisis din√°mico [aprender√°s c√≥mo aprovecharlos](./#exploiting-content-providers-accessing-and-manipulating-sensitive-information).
* Verifica las configuraciones de **FileProviders** dentro del atributo `android:name="android.support.FILE_PROVIDER_PATHS"`. [Lee aqu√≠ para obtener m√°s informaci√≥n sobre FileProviders](./#fileprovider).
* **Servicios expuestos**: Dependiendo de lo que el servicio est√© haciendo internamente, se podr√≠an explotar vulnerabilidades. En el an√°lisis din√°mico [aprender√°s c√≥mo aprovecharlos](./#exploiting-services).
* **Receptores de difusi√≥n**: [Aprender√°s c√≥mo posiblemente explotarlos](./#exploiting-broadcast-receivers) durante el an√°lisis din√°mico.
* **Esquema de URL**: Lee el c√≥digo de la actividad que gestiona el esquema y busca vulnerabilidades en la gesti√≥n de la entrada del usuario. M√°s informaci√≥n sobre [qu√© es un esquema de URL aqu√≠](./#url-schemes).
* **minSdkVersion**, **targetSDKVersion**, **maxSdkVersion**: Indican las versiones de Android en las que se ejecutar√° la aplicaci√≥n. Es importante tenerlos en cuenta porque, desde una perspectiva de seguridad, admitir versiones antiguas permitir√° que se ejecuten versiones conocidas de Android que tienen vulnerabilidades.

Leyendo **resources.arsc/strings.xml**, puedes encontrar informaci√≥n interesante:

* Claves de API
* Esquemas personalizados
* Otra informaci√≥n interesante que los desarrolladores guardan en este archivo

### Tapjacking

**Tapjacking** es un ataque en el que se lanza una **aplicaci√≥n maliciosa** y se posiciona sobre una aplicaci√≥n v√≠ctima. Una vez que oculta la aplicaci√≥n v√≠ctima, su interfaz de usuario est√° dise√±ada de tal manera que enga√±a al usuario para que interact√∫e con ella, mientras pasa la interacci√≥n a la aplicaci√≥n v√≠ctima.\
En efecto, **ciega al usuario para que no sepa que en realidad est√° realizando acciones en la aplicaci√≥n v√≠ctima**.

Para detectar aplicaciones vulnerables a este ataque, debes buscar **actividades exportadas** en el manifiesto de Android (ten en cuenta que una actividad con un intent-filter se exporta autom√°ticamente por defecto). Una vez que hayas encontrado las actividades exportadas, **verifica si requieren alg√∫n permiso**. Esto se debe a que la **aplicaci√≥n maliciosa tambi√©n necesitar√° ese permiso**.\
Finalmente, es importante verificar el c√≥digo en busca de posibles configuraciones de **`setFilterTouchesWhenObscured`**. Si se establece en **`true`**, un bot√≥n puede desactivarse autom√°ticamente si est√° oculto:
```markup
<Button android:text="Button"
android:id="@+id/button1"
android:layout_width="wrap_content"
android:layout_height="wrap_content"
android:filterTouchesWhenObscured="true">
</Button>
```
Puedes usar [**qark**](https://github.com/linkedin/qark) con el par√°metro `--exploit-apk` para crear una aplicaci√≥n maliciosa y probar posibles vulnerabilidades de **Tapjacking**.\
Un proyecto de ejemplo que implementa este tipo de caracter√≠stica se puede encontrar en [**FloatingWindowApp**](https://github.com/aminography/FloatingWindowApp).

La mitigaci√≥n es relativamente simple, ya que el desarrollador puede optar por no recibir eventos t√°ctiles cuando una vista est√° cubierta por otra. Usando la [Referencia del Desarrollador de Android](https://developer.android.com/reference/android/view/View#security):

> A veces es esencial que una aplicaci√≥n pueda verificar que una acci√≥n se est√° realizando con el pleno conocimiento y consentimiento del usuario, como otorgar una solicitud de permiso, realizar una compra o hacer clic en un anuncio. Desafortunadamente, una aplicaci√≥n maliciosa podr√≠a intentar enga√±ar al usuario para que realice estas acciones sin darse cuenta, ocultando el prop√≥sito previsto de la vista. Como remedio, el marco ofrece un mecanismo de filtrado t√°ctil que se puede utilizar para mejorar la seguridad de las vistas que proporcionan acceso a funcionalidades sensibles.
>
> Para habilitar el filtrado t√°ctil, llama a [`setFilterTouchesWhenObscured(boolean)`](https://developer.android.com/reference/android/view/View#setFilterTouchesWhenObscured%28boolean%29) o establece el atributo de dise√±o android:filterTouchesWhenObscured en true. Cuando est√° habilitado, el marco descartar√° los toques que se reciban siempre que la ventana de la vista est√© oculta por otra ventana visible. Como resultado, la vista no recibir√° toques cada vez que aparezca un toast, un di√°logo u otra ventana por encima de la ventana de la vista.

### Secuestro de Tareas

{% content-ref url="android-task-hijacking.md" %}
[android-task-hijacking.md](android-task-hijacking.md)
{% endcontent-ref %}

### Almacenamiento inseguro de datos

**Almacenamiento interno**

Los archivos **creados** en el **almacenamiento interno** solo son **accesibles** por la **aplicaci√≥n**. Esta protecci√≥n est√° implementada por Android y es suficiente para la mayor√≠a de las aplicaciones. Sin embargo, los desarrolladores a menudo utilizan `MODE_WORLD_READBALE` y `MODE_WORLD_WRITABLE` para dar acceso a esos archivos a otra aplicaci√≥n, pero esto no limita a otras aplicaciones (maliciosas) para acceder a ellos.\
Durante el **an√°lisis est√°tico**, verifica el uso de esos **modos**, durante el **an√°lisis din√°mico**, verifica los **permisos** de los archivos creados (tal vez algunos de ellos sean legibles / escribibles en todo el mundo).\
[M√°s informaci√≥n sobre esta vulnerabilidad y c√≥mo solucionarla aqu√≠.](https://manifestsecurity.com/android-application-security-part-8/)

**Almacenamiento externo**

Los archivos creados en el **almacenamiento externo**, como las tarjetas SD, son **legibles y escribibles globalmente**. Debido a que el almacenamiento externo puede ser eliminado por el usuario y tambi√©n modificado por cualquier aplicaci√≥n, no debes almacenar informaci√≥n sensible utilizando el almacenamiento externo.\
Al igual que con los datos de cualquier fuente no confiable, debes **realizar validaci√≥n de entrada** al manejar **datos del almacenamiento externo**. Recomendamos encarecidamente que no almacenes archivos ejecutables o archivos de clase en el almacenamiento externo antes de la carga din√°mica. Si tu aplicaci√≥n recupera archivos ejecutables desde el almacenamiento externo, los archivos deben estar firmados y verificados criptogr√°ficamente antes de la carga din√°mica.\
Informaci√≥n tomada de [aqu√≠](https://manifestsecurity.com/android-application-security-part-8/).

El almacenamiento externo se puede **acceder** en `/storage/emulated/0`, `/sdcard`, `/mnt/sdcard`

{% hint style="info" %}
A partir de Android 4.4 (**API 17**), la tarjeta SD tiene una estructura de directorios que **limita el acceso de una aplicaci√≥n al directorio espec√≠fico para esa aplicaci√≥n**. Esto evita que una aplicaci√≥n maliciosa obtenga acceso de lectura o escritura a los archivos de otra aplicaci√≥n.
{% endhint %}

**Datos sensibles almacenados en texto claro**

* **Preferencias compartidas**: Android permite que cada aplicaci√≥n guarde f√°cilmente archivos XML en la ruta `/data/data/<nombrepaquete>/shared_prefs/` y a veces es posible encontrar informaci√≥n sensible en texto claro en esa carpeta.
* **Bases de datos**: Android permite que cada aplicaci√≥n guarde bases de datos SQLite f√°cilmente en la ruta `/data/data/<nombrepaquete>/databases/` y a veces es posible encontrar informaci√≥n sensible en texto claro en esa carpeta.

### TLS roto

**Aceptar todos los certificados**

Por alguna raz√≥n, a veces los desarrolladores aceptan todos los certificados, incluso si, por ejemplo, el nombre de host no coincide con l√≠neas de c√≥digo como la siguiente:
```java
SSLSocketFactory sf = new cc(trustStore);
sf.setHostnameVerifier(SSLSocketFactory.ALLOW_ALL_HOSTNAME_VERIFIER);
```
Una buena manera de probar esto es intentar capturar el tr√°fico utilizando un proxy como Burp sin autorizar el CA de Burp dentro del dispositivo. Adem√°s, puedes generar con Burp un certificado para un nombre de host diferente y usarlo.

### Criptograf√≠a rota

**Procesos de gesti√≥n de claves deficientes**

Algunos desarrolladores guardan datos sensibles en el almacenamiento local y los cifran con una clave codificada/predecible en el c√≥digo. Esto no deber√≠a hacerse, ya que algunos procesos de reversi√≥n podr√≠an permitir a los atacantes extraer la informaci√≥n confidencial.

**Uso de algoritmos inseguros y/o obsoletos**

Los desarrolladores no deber√≠an utilizar algoritmos **obsoletos** para realizar **comprobaciones** de autorizaci√≥n, **almacenar** o **enviar** datos. Algunos de estos algoritmos son: RC4, MD4, MD5, SHA1... Si se utilizan **hashes** para almacenar contrase√±as, por ejemplo, se deben utilizar hashes resistentes a ataques de fuerza bruta con sal.

### Otras comprobaciones

* Se recomienda **ofuscar el APK** para dificultar el trabajo de ingenier√≠a inversa a los atacantes.
* Si la aplicaci√≥n es sensible (como las aplicaciones bancarias), deber√≠a realizar sus **propias comprobaciones para ver si el dispositivo m√≥vil est√° rooteado** y actuar en consecuencia.
* Si la aplicaci√≥n es sensible (como las aplicaciones bancarias), deber√≠a comprobar si se est√° utilizando un **emulador**.
* Si la aplicaci√≥n es sensible (como las aplicaciones bancarias), deber√≠a **verificar su propia integridad antes de ejecutarse** para comprobar si ha sido modificada.
* Utiliza [**APKiD**](https://github.com/rednaga/APKiD) para comprobar qu√© compilador/empaquetador/ofuscador se utiliz√≥ para construir el APK.

### Aplicaci√≥n React Native

Lee la siguiente p√°gina para aprender c√≥mo acceder f√°cilmente al c√≥digo JavaScript de las aplicaciones React:

{% content-ref url="react-native-application.md" %}
[react-native-application.md](react-native-application.md)
{% endcontent-ref %}

### Aplicaciones Xamarin

Las aplicaciones **Xamarin** est√°n escritas en **C#**, para acceder al c√≥digo C# **descomprimido**, necesitas obtener los archivos del **apk**:
```bash
7z r app.apk #Or any other zip decompression cmd
```
Luego, descomprime todos los DLsL utilizando [**xamarin-decompress**](https://github.com/NickstaDB/xamarin-decompress)**:**
```
python3 xamarin-decompress.py -o /path/to/decompressed/apk
```
### An√°lisis de c√≥digo est√°tico automatizado

La herramienta [**mariana-trench**](https://github.com/facebook/mariana-trench) es capaz de encontrar **vulnerabilidades** mediante el **escaneo** del **c√≥digo** de la aplicaci√≥n. Esta herramienta contiene una serie de **fuentes conocidas** (que indican a la herramienta los **lugares** donde la **entrada** est√° **controlada por el usuario**), **sumideros** (que indican a la herramienta **lugares peligrosos** donde la entrada maliciosa del usuario podr√≠a causar da√±os) y **reglas**. Estas reglas indican la **combinaci√≥n** de **fuentes-sumideros** que indica una vulnerabilidad.

Con este conocimiento, **mariana-trench revisar√° el c√≥digo y encontrar√° posibles vulnerabilidades en √©l**.

### Secretos filtrados

Una aplicaci√≥n puede contener secretos (claves de API, contrase√±as, URL ocultas, subdominios...) en su interior que podr√≠as descubrir. Puedes usar una herramienta como [https://github.com/dwisiswant0/apkleaks](https://github.com/dwisiswant0/apkleaks)

### Bypass de autenticaci√≥n biom√©trica

{% content-ref url="bypass-biometric-authentication-android.md" %}
[bypass-biometric-authentication-android.md](bypass-biometric-authentication-android.md)
{% endcontent-ref %}

### Otras funciones interesantes

* **Ejecuci√≥n de c√≥digo**: `Runtime.exec(), ProcessBuilder(), c√≥digo nativo: system()`
* **Enviar SMS**: `sendTextMessage, sendMultipartTestMessage`
* **Funciones nativas** declaradas como `native`: `public native, System.loadLibrary, System.load`
* [Lee esto para aprender **c√≥mo revertir funciones nativas**](reversing-native-libraries.md)

### **Otros trucos**

{% content-ref url="content-protocol.md" %}
[content-protocol.md](content-protocol.md)
{% endcontent-ref %}

<figure><img src="../../.gitbook/assets/image (1).png" alt=""><figcaption></figcaption></figure>

**HackenProof es el hogar de todas las recompensas por errores de cifrado.**

**Obt√©n recompensas sin demoras**\
Las recompensas de HackenProof se lanzan solo cuando sus clientes depositan el presupuesto de recompensa. Obtendr√°s la recompensa despu√©s de que se verifique el error.

**Obt√©n experiencia en pentesting web3**\
¬°Los protocolos de blockchain y los contratos inteligentes son el nuevo Internet! Domina la seguridad web3 en sus d√≠as de crecimiento.

**Convi√©rtete en la leyenda del hacker web3**\
Gana puntos de reputaci√≥n con cada error verificado y conquista la cima de la clasificaci√≥n semanal.

[**Reg√≠strate en HackenProof**](https://hackenproof.com/register) ¬°comienza a ganar con tus hacks!

{% embed url="https://hackenproof.com/register" %}

## An√°lisis din√°mico

> En primer lugar, necesitas un entorno donde puedas instalar la aplicaci√≥n y todo el entorno (certificado Burp CA, Drozer y Frida principalmente). Por lo tanto, se recomienda encarecidamente un dispositivo rooteado (emulado o no).

### An√°lisis din√°mico en l√≠nea

Puedes crear una **cuenta gratuita** en: [https://appetize.io/](https://appetize.io). Esta plataforma te permite **subir** y **ejecutar** APKs, por lo que es √∫til para ver c√≥mo se comporta una apk.

Incluso puedes **ver los registros de tu aplicaci√≥n** en la web y conectarte a trav√©s de **adb**.

![](<../../.gitbook/assets/image (60).png>)

Gracias a la conexi√≥n ADB, puedes usar **Drozer** y **Frida** dentro de los emuladores.

### An√°lisis din√°mico local

Puedes usar alg√∫n **emulador** como:

* [**Android Studio**](https://developer.android.com/studio) (Puedes crear dispositivos **x86** y **arm**, y seg√∫n [**esto** ](https://android-developers.googleblog.com/2020/03/run-arm-apps-on-android-emulator.html)**las √∫ltimas versiones x86** **soportan bibliotecas ARM** sin necesidad de un emulador ARM lento).
* Si quieres intentar **instalar** una **imagen** y luego quieres **eliminarla**, puedes hacerlo en Windows:`C:\Users\<User>\AppData\Local\Android\sdk\system-images\` o en Mac: `/Users/myeongsic/Library/Android/sdk/system-image`
* Este es el **emulador principal que recomiendo usar y puedes**[ **aprender a configurarlo en esta p√°gina**](avd-android-virtual-device.md).
* [**Genymotion**](https://www.genymotion.com/fun-zone/) **(Versi√≥n gratuita:** Personal Edition, necesitas crear una cuenta. _Se recomienda **descargar** la versi√≥n **CON**_ _**VirtualBox** para evitar posibles errores._)
* [Nox](https://es.bignox.com) (Gratis, pero no es compatible con Frida o Drozer).

{% hint style="info" %}
Al crear un nuevo emulador en cualquier plataforma, recuerda que cuanto m√°s grande sea la pantalla, m√°s lento funcionar√° el emulador. As√≠ que selecciona pantallas peque√±as si es posible.
{% endhint %}

Como la mayor√≠a de las personas usar√°n **Genymotion**, ten en cuenta este truco. Para **instalar servicios de Google** (como AppStore) debes hacer clic en el bot√≥n marcado en rojo de la siguiente imagen:

![](<../../.gitbook/assets/image (200) (1).png>)

Adem√°s, ten en cuenta que en la **configuraci√≥n de la VM de Android en Genymotion** puedes seleccionar el modo de red de puente (esto ser√° √∫til si te conectar√°s a la VM de Android desde una VM diferente con las herramientas).

O puedes usar un **dispositivo f√≠sico** (necesitas activar las opciones de depuraci√≥n y ser√≠a genial si puedes rootearlo):

1. **Configuraci√≥n**.
2. (A partir de Android 8.0) Selecciona **Sistema**.
3. Selecciona **Acerca del tel√©fono**.
4. Presiona **N√∫mero de compilaci√≥n** 7 veces.
5. Vuelve atr√°s y encontrar√°s las **Opciones de desarrollador**.

> Una vez que hayas instalado la aplicaci√≥n, lo primero que debes hacer es probarla e investigar qu√© hace, c√≥mo funciona y familiarizarte con ella.\
> Sugerir√≠a **realizar este an√°lisis din√°mico inicial utilizando el an√°lisis din√°mico de MobSF + pidcat**, para que puedas **aprender c√≥mo funciona la aplicaci√≥n** mientras MobSF **captura** una gran cantidad de **datos interesantes** que puedes revisar m√°s adelante.

### Fuga de datos no intencionada

**Registro**

A menudo, los desarrolladores dejan informaci√≥n de depuraci√≥n de forma p√∫blica. Por lo tanto, cualquier aplicaci√≥n con el permiso `READ_LOGS` puede **acceder a esos registros** y obtener informaci√≥n sensible a trav√©s de ellos.\
Mientras navegas por la aplicaci√≥n, utiliza [**pidcat**](https://github.com/JakeWharton/pidcat)_(Recomendado, es m√°s f√°cil de usar y leer)_ o [adb logcat](adb-commands.md#logcat) para leer los registros creados y **buscar informaci√≥n sensible**.

{% hint style="warning" %}
Ten en cuenta que a partir de las versiones posteriores a Android 4.0, **las aplicaciones solo pueden acceder a sus propios registros**. Por lo tanto, las aplicaciones no pueden acceder a los registros de otras aplicaciones.\
De todos modos, se recomienda **no registrar informaci√≥n sensible**.
{% endhint %}

**Cach√© del portapapeles**

Android proporciona un marco basado en el portapapeles para proporcionar la funci√≥n de copiar y pegar en las aplicaciones de Android. Pero esto crea un problema grave cuando alguna **otra aplicaci√≥n** puede **acceder** al **portapapeles** que contiene datos sensibles. La funci√≥n de **copiar/pegar** deber√≠a estar **deshabilitada** para las partes sensibles de la aplicaci√≥n. Por ejemplo, deshabilita la copia de detalles de tarjetas de cr√©dito.

**Registros de bloqueo**

Si una aplicaci√≥n **se bloquea** durante la ejecuci√≥n y guarda registros en alg√∫n lugar, esos registros pueden ser √∫tiles para un atacante, especialmente en casos en los que no se puede ingenier√≠a inversa de la aplicaci√≥n de Android. Luego, evita crear registros cuando la aplicaci√≥n se bloquea y, si los registros se env√≠an a trav√©s de la red, aseg√∫rate de que se env√≠en a trav√©s de un canal SSL.\
Como pentester, **intenta echar un vistazo a estos registros**.

**Datos de an√°lisis enviados a terceros**
La mayor√≠a de las aplicaciones utilizan otros servicios en su aplicaci√≥n, como Google Adsense, pero a veces **filtrar datos sensibles** o datos que no es necesario enviar a ese servicio. Esto puede suceder porque el desarrollador no implement√≥ correctamente la funci√≥n. Puedes **verificar interceptando el tr√°fico** de la aplicaci√≥n y ver si se env√≠an datos sensibles a terceros o no.

### Bases de datos SQLite

La mayor√≠a de las aplicaciones utilizar√°n **bases de datos SQLite internas** para guardar informaci√≥n. Durante la prueba de penetraci√≥n, **verifica** las **bases de datos** creadas, los nombres de las **tablas** y las **columnas**, y todos los **datos** guardados, ya que podr√≠as encontrar **informaci√≥n sensible** (lo cual ser√≠a una vulnerabilidad).\
Las bases de datos deben estar ubicadas en `/data/data/el.nombre.del.paquete/databases`, como `/data/data/com.mwr.example.sieve/databases`.

Si la base de datos guarda informaci√≥n confidencial y est√° **encriptada**, pero puedes **encontrar** la **contrase√±a** dentro de la aplicaci√≥n, sigue siendo una **vulnerabilidad**.

Enumera las tablas usando `.tables` y enumera las columnas de las tablas con `.schema <nombre_de_la_tabla>`

### Drozer (Actividades de explotaci√≥n, Proveedores de contenido y Servicios)

**Drozer** te permite **asumir el rol de una aplicaci√≥n de Android** e interactuar con otras aplicaciones. Puede hacer **cualquier cosa que una aplicaci√≥n instalada pueda hacer**, como utilizar el mecanismo de Comunicaci√≥n entre Procesos (IPC) de Android e interactuar con el sistema operativo subyacente. De [Gu√≠a de Drozer](https://labs.mwrinfosecurity.com/assets/BlogFiles/mwri-drozer-user-guide-2015-03-23.pdf).\
Drozer es una herramienta √∫til para **explotar actividades exportadas, servicios exportados y Proveedores de contenido**, como aprender√°s en las siguientes secciones.

### Explotando actividades exportadas

[**Lee esto si quieres recordar qu√© es una Actividad de Android.**](android-applications-basics.md#launcher-activity-and-other-activities)\
Tambi√©n recuerda que el c√≥digo de una actividad comienza con el m√©todo `onCreate`.

**Bypass de autorizaci√≥n**

Cuando una Actividad est√° exportada, puedes invocar su pantalla desde una aplicaci√≥n externa. Por lo tanto, si una actividad con **informaci√≥n sensible** est√° **exportada**, podr√≠as **burlar** los mecanismos de **autenticaci√≥n** para **acceder a ella**.\
[**Aprende c√≥mo explotar actividades exportadas con Drozer.**](drozer-tutorial/#activities)

Tambi√©n puedes iniciar una actividad exportada desde adb:

* El nombre del paquete es com.example.demo
* El nombre de la actividad exportada es com.example.test.MainActivity
```
adb shell am start -n com.example.demo/com.example.test.MainActivity
```
**NOTA**: MobSF detectar√° como malicioso el uso de _**singleTask/singleInstance**_ como `android:launchMode` en una actividad, pero debido a [esto](https://github.com/MobSF/Mobile-Security-Framework-MobSF/pull/750), aparentemente esto solo es peligroso en versiones antiguas (versiones de API < 21).

{% hint style="info" %}
Ten en cuenta que eludir una autorizaci√≥n no siempre es una vulnerabilidad, depender√° de c√≥mo funcione eludir y qu√© informaci√≥n se exponga.
{% endhint %}

**Fuga de informaci√≥n sensible**

**Las actividades tambi√©n pueden devolver resultados**. Si logras encontrar una actividad exportada y desprotegida que llame al m√©todo **`setResult`** y **devuelva informaci√≥n sensible**, entonces hay una fuga de informaci√≥n sensible.

### Explotando Proveedores de Contenido - Accediendo y manipulando informaci√≥n sensible

[**Lee esto si quieres recordar qu√© es un Proveedor de Contenido.**](android-applications-basics.md#proveedor-de-contenido)\
Los proveedores de contenido se utilizan b√°sicamente para **compartir datos**. Si una aplicaci√≥n tiene proveedores de contenido disponibles, es posible que puedas **extraer datos sensibles** de ellos. Tambi√©n es interesante probar posibles **inyecciones SQL** y **traves√≠as de ruta** ya que podr√≠an ser vulnerables.\
[**Aprende c√≥mo explotar Proveedores de Contenido con Drozer.**](drozer-tutorial/#proveedores-de-contenido)

### **Explotando Servicios**

[**Lee esto si quieres recordar qu√© es un Servicio.**](android-applications-basics.md#servicios)\
Recuerda que las acciones de un Servicio comienzan en el m√©todo `onStartCommand`.

Un servicio es b√°sicamente algo que **puede recibir datos**, **procesarlos** y **devolver** (o no) una respuesta. Entonces, si una aplicaci√≥n est√° exportando algunos servicios, debes **verificar** el **c√≥digo** para entender qu√© est√° haciendo y **probarlo** **din√°micamente** para extraer informaci√≥n confidencial, eludir medidas de autenticaci√≥n...\
[**Aprende c√≥mo explotar Servicios con Drozer.**](drozer-tutorial/#servicios)

### **Explotando Receptores de Difusi√≥n**

[**Lee esto si quieres recordar qu√© es un Receptor de Difusi√≥n.**](android-applications-basics.md#receptores-de-difusi√≥n)\
Recuerda que las acciones de un Receptor de Difusi√≥n comienzan en el m√©todo `onReceive`.

Un receptor de difusi√≥n estar√° esperando un tipo de mensaje. Dependiendo de c√≥mo maneje el receptor el mensaje, podr√≠a ser vulnerable.\
[**Aprende c√≥mo explotar Receptores de Difusi√≥n con Drozer.**](./#explotando-receptores-de-difusi√≥n)

### **Explotando Esquemas / Enlaces profundos**

Puedes buscar enlaces profundos manualmente, utilizando herramientas como MobSF o scripts como [este](https://github.com/ashleykinguk/FBLinkBuilder/blob/master/FBLinkBuilder.py).\
Puedes **abrir** un **esquema** declarado utilizando **adb** o un **navegador**:
```bash
adb shell am start -a android.intent.action.VIEW -d "scheme://hostname/path?param=value" [your.package.name]
```
_Nota que puedes **omitir el nombre del paquete** y el m√≥vil autom√°ticamente llamar√° a la aplicaci√≥n que deber√≠a abrir ese enlace._
```markup
<!-- Browser regular link -->
<a href="scheme://hostname/path?param=value">Click me</a>
<!-- fallback in your url you could try the intent url -->
<a href="intent://hostname#Intent;scheme=scheme;package=your.package.name;S.browser_fallback_url=http%3A%2F%2Fwww.example.com;end">with alternative</a>
```
**C√≥digo ejecutado**

Para encontrar el **c√≥digo que se ejecutar√° en la aplicaci√≥n**, ve a la actividad llamada por el enlace profundo y busca la funci√≥n **`onNewIntent`**.

![](<../../.gitbook/assets/image (436) (1) (1) (1).png>)

**Informaci√≥n sensible**

Cada vez que encuentres un enlace profundo, verifica que **no est√© recibiendo datos sensibles (como contrase√±as) a trav√©s de par√°metros de URL**, porque cualquier otra aplicaci√≥n podr√≠a **suplantar el enlace profundo y robar esos datos**.

**Par√°metros en la ruta**

Tambi√©n debes verificar si alg√∫n enlace profundo est√° utilizando un par√°metro dentro de la ruta de la URL, como: `https://api.example.com/v1/users/{username}`, en ese caso puedes forzar una traversi√≥n de ruta accediendo a algo como: `example://app/users?username=../../unwanted-endpoint%3fparam=value`.\
Ten en cuenta que si encuentras los endpoints correctos dentro de la aplicaci√≥n, es posible que puedas causar una **Redirecci√≥n Abierta** (si parte de la ruta se utiliza como nombre de dominio), **toma de control de cuenta** (si puedes modificar los detalles de los usuarios sin un token CSRF y el endpoint vulnerable utiliza el m√©todo correcto) y cualquier otra vulnerabilidad. M√°s [informaci√≥n sobre esto aqu√≠](http://dphoeniixx.com/2020/12/13-2/).

**M√°s ejemplos**

Un [informe interesante de recompensa por errores](https://hackerone.com/reports/855618) sobre enlaces (_/.well-known/assetlinks.json_).

### Protecci√≥n insuficiente de la capa de transporte

* **Falta de inspecci√≥n de certificados:** La aplicaci√≥n de Android no verifica la identidad del certificado presentado. La mayor√≠a de las aplicaciones ignoran las advertencias y aceptan cualquier certificado autofirmado presentado. Algunas aplicaciones, en cambio, pasan el tr√°fico a trav√©s de una conexi√≥n HTTP.
* **Negociaci√≥n de handshake d√©bil:** La aplicaci√≥n y el servidor realizan un handshake SSL/TLS pero utilizan un conjunto de cifrado inseguro que es vulnerable a ataques MITM. Por lo tanto, cualquier atacante puede descifrar f√°cilmente esa conexi√≥n.
* **Fuga de informaci√≥n de privacidad:** Muchas veces sucede que las aplicaciones autentican a trav√©s de un canal seguro pero el resto de las conexiones se realizan a trav√©s de un canal no seguro. Esto no agrega seguridad a la aplicaci√≥n porque los datos sensibles restantes, como las cookies de sesi√≥n o los datos de usuario, pueden ser interceptados por un usuario malintencionado.

De los 3 escenarios presentados, vamos a discutir **c√≥mo verificar la identidad del certificado**. Los otros 2 escenarios dependen de la **configuraci√≥n de TLS** del servidor y si la **aplicaci√≥n env√≠a datos sin cifrar**. El pentester debe verificar por s√≠ mismo la configuraci√≥n de TLS del servidor ([aqu√≠](../../network-services-pentesting/pentesting-web/#ssl-tls-vulnerabilites)) y detectar si se env√≠a alguna **informaci√≥n confidencial a trav√©s de un canal no cifrado/vulnerable**.\
M√°s informaci√≥n sobre c√≥mo descubrir y solucionar este tipo de vulnerabilidades [**aqu√≠**](https://manifestsecurity.com/android-application-security-part-10/).

**SSL Pinning**

Por defecto, al realizar una conexi√≥n SSL, el cliente (aplicaci√≥n de Android) verifica que el certificado del servidor tenga una cadena de confianza verificable hasta un certificado de confianza (ra√≠z) y coincida con el nombre de host solicitado. Esto lleva al problema de los **ataques de intermediario (MITM)**.\
En el Pinning de certificados, una aplicaci√≥n de Android contiene el certificado del servidor y solo transmite datos si se presenta el mismo certificado.\
Se recomienda **aplicar SSL Pinning** para los sitios donde se enviar√° informaci√≥n sensible.

### Inspeccionar el tr√°fico HTTP

En primer lugar, debes (debes) **instalar el certificado** de la herramienta de **proxy** que vas a utilizar, probablemente Burp. Si no instalas el certificado CA de la herramienta de proxy, es probable que no veas el tr√°fico cifrado en el proxy.\
**Por favor,** [**lee esta gu√≠a para aprender c√≥mo instalar un certificado CA personalizado**](android-burp-suite-settings.md)**.**

Para las aplicaciones dirigidas a **API Level 24+ no es suficiente instalar el certificado CA** de Burp en el dispositivo. Para evitar esta nueva protecci√≥n, debes modificar el archivo de configuraci√≥n de seguridad de red. Por lo tanto, puedes modificar este archivo para autorizar tu certificado CA o puedes [**leer esta p√°gina para obtener un tutorial sobre c√≥mo hacer que la aplicaci√≥n vuelva a aceptar todos los certificados instalados en el dispositivo**](make-apk-accept-ca-certificate.md).

**SSL Pinning**

Ya hemos discutido qu√© es el SSL Pinning solo 2 p√°rrafos antes. Cuando se implementa en una aplicaci√≥n, deber√°s evitarlo para inspeccionar el tr√°fico HTTPS o no lo ver√°s.\
Aqu√≠ voy a presentar algunas opciones que he utilizado para evitar esta protecci√≥n:

* Modificar autom√°ticamente el **apk** para **evitar** el SSL Pinning con [**apk-mitm**](https://github.com/shroudedcode/apk-mitm). La mejor ventaja de esta opci√≥n es que no necesitar√°s acceso root para evitar el SSL Pinning, pero deber√°s eliminar la aplicaci√≥n y reinstalar la nueva, y esto no siempre funcionar√°.
* Puedes usar **Frida** (discutido a continuaci√≥n) para evitar esta protecci√≥n. Aqu√≠ tienes una gu√≠a para usar Burp+Frida+Genymotion: [https://spenkk.github.io/bugbounty/Configuring-Frida-with-Burp-and-GenyMotion-to-bypass-SSL-Pinning/](https://spenkk.github.io/bugbounty/Configuring-Frida-with-Burp-and-GenyMotion-to-bypass-SSL-Pinning/)
* Tambi√©n puedes intentar **evitar autom√°ticamente el SSL Pinning** utilizando [**objection**](frida-tutorial/objection-tutorial.md)**:** `objection --gadget com.package.app explore --startup-command "android sslpinning disable"`
* Tambi√©n puedes intentar **evitar autom√°ticamente el SSL Pinning** utilizando el an√°lisis din√°mico de **MobSF** (explicado a continuaci√≥n)
* Si a√∫n crees que hay alg√∫n tr√°fico que no est√°s capturando, puedes intentar **redirigir el tr√°fico a Burp utilizando iptables**. Lee este blog: [https://infosecwriteups.com/bypass-ssl-pinning-with-ip-forwarding-iptables-568171b52b62](https://infosecwriteups.com/bypass-ssl-pinning-with-ip-forwarding-iptables-568171b52b62)

**Vulnerabilidades web comunes**

Ten en cuenta que en este paso debes buscar vulnerabilidades web comunes. Hay mucha informaci√≥n sobre vulnerabilidades web en este libro, por lo que no las mencionar√© aqu√≠.

### Frida

Herramienta de instrumentaci√≥n din√°mica para desarrolladores, ingenieros inversos e investigadores de seguridad. Obt√©n m√°s informaci√≥n en [www.frida.re](https://www.frida.re).\
**Es incre√≠ble, puedes acceder a la aplicaci√≥n en ejecuci√≥n y enganchar m√©todos en tiempo de ejecuci√≥n para cambiar el comportamiento, cambiar valores, extraer valores, ejecutar c√≥digo diferente...**\
**Si quieres hacer pentesting de aplicaciones de Android, debes saber c√≥mo usar Frida.**

**Aprende c√≥mo usar Frida:** [**Tutorial de Frida**](frida-tutorial/)\
**Algunas "GUI" para acciones con Frida:** [**https://github.com/m0bilesecurity/RMS-Runtime-Mobile-Security**](https://github.com/m0bilesecurity/RMS-Runtime-Mobile-Security)\
**Algunas otras abstracciones basadas en Frida:** [**https://github.com/sensepost/objection**](https://github.com/sensepost/objection) **,** [**https://github.com/dpnishant/appmon**](https://github.com/dpnishant/appmon)\
**Puedes encontrar algunos scripts incre√≠bles de Frida aqu√≠:** [**https://codeshare.frida.re/**](https://codeshare.frida.re)
### **Analizador de Aplicaciones Android**

Esta herramienta puede ayudarte a gestionar diferentes herramientas durante el an√°lisis din√°mico: [https://github.com/NotSoSecure/android\_application\_analyzer](https://github.com/NotSoSecure/android\_application\_analyzer)

### Inyecci√≥n de Intenciones

Esta vulnerabilidad se asemeja a la **Redirecci√≥n Abierta en seguridad web**. Dado que la clase `Intent` es `Parcelable`, **los objetos pertenecientes a esta clase** pueden ser **pasados** como **datos extra** en otro objeto `Intent`.\
Muchos desarrolladores hacen **uso** de esta **caracter√≠stica** y crean **componentes proxy** (actividades, receptores de difusi√≥n y servicios) que **toman una Intenci√≥n incrustada y la pasan a m√©todos peligrosos** como `startActivity(...)`, `sendBroadcast(...)`, etc.\
Esto es peligroso porque **un atacante puede forzar a la aplicaci√≥n a lanzar un componente no exportado que no se puede lanzar directamente desde otra aplicaci√≥n**, o conceder al atacante acceso a sus proveedores de contenido. **`WebView`** a veces tambi√©n cambia una **URL de una cadena a un objeto `Intent`**, utilizando el m√©todo `Intent.parseUri(...)`, y lo pasa a `startActivity(...)`.

### Inyecciones en el Lado del Cliente de Android y otros

Probablemente ya conozcas este tipo de vulnerabilidades en la Web. Debes tener especial cuidado con estas vulnerabilidades en una aplicaci√≥n Android:

* **Inyecci√≥n SQL:** Al tratar con consultas din√°micas o Proveedores de Contenido, aseg√∫rate de utilizar consultas parametrizadas.
* **Inyecci√≥n de JavaScript (XSS):** Verifica que JavaScript y el soporte de complementos est√©n deshabilitados para cualquier WebView (deshabilitado de forma predeterminada). [M√°s informaci√≥n aqu√≠](webview-attacks.md#javascript-enabled).
* **Inclusi√≥n de Archivos Locales:** Verifica que el acceso al sistema de archivos est√© deshabilitado para cualquier WebView (habilitado de forma predeterminada) `(webview.getSettings().setAllowFileAccess(false);)`. [M√°s informaci√≥n aqu√≠](webview-attacks.md#javascript-enabled).
* **Cookies Eternas**: En varios casos, cuando la aplicaci√≥n Android finaliza la sesi√≥n, la cookie no se revoca o incluso puede guardarse en el disco.
* [**Bandera de Seguridad** en las cookies](../../pentesting-web/hacking-with-cookies/#cookies-flags)

<figure><img src="../../.gitbook/assets/image (1).png" alt=""><figcaption></figcaption></figure>

**HackenProof es el hogar de todas las recompensas por errores criptogr√°ficos.**

**Obt√©n recompensas sin demoras**\
Las recompensas de HackenProof se lanzan solo cuando sus clientes depositan el presupuesto de recompensa. Obtendr√°s la recompensa despu√©s de que se verifique el error.

**Obt√©n experiencia en pentesting web3**\
¬°Los protocolos de blockchain y los contratos inteligentes son el nuevo Internet! Domina la seguridad web3 en sus d√≠as de crecimiento.

**Convi√©rtete en la leyenda del hacker web3**\
Gana puntos de reputaci√≥n con cada error verificado y conquista la cima de la clasificaci√≥n semanal.

[**Reg√≠strate en HackenProof**](https://hackenproof.com/register) ¬°comienza a ganar con tus hacks!

{% embed url="https://hackenproof.com/register" %}

## An√°lisis Autom√°tico

### [MobSF](https://github.com/MobSF/Mobile-Security-Framework-MobSF)

**An√°lisis est√°tico**

![](<../../.gitbook/assets/image (61).png>)

**Evaluaci√≥n de vulnerabilidades de la aplicaci√≥n** utilizando una interfaz web agradable. Tambi√©n puedes realizar an√°lisis din√°mico (pero necesitas preparar el entorno).
```
docker pull opensecurity/mobile-security-framework-mobsf
docker run -it -p 8000:8000 opensecurity/mobile-security-framework-mobsf:latest
```
Ten en cuenta que MobSF puede analizar aplicaciones de **Android** (apk), **IOS** (ipa) y **Windows** (apx) (las aplicaciones de Windows deben analizarse desde un MobSF instalado en un host de Windows).\
Adem√°s, si creas un archivo **ZIP** con el c√≥digo fuente de una aplicaci√≥n de **Android** o **IOS** (ve a la carpeta ra√≠z de la aplicaci√≥n, selecciona todo y crea un archivo ZIP), tambi√©n podr√°s analizarlo.

MobSF tambi√©n te permite realizar an√°lisis de **diferencias/comparaciones** e integrar **VirusTotal** (necesitar√°s configurar tu clave de API en _MobSF/settings.py_ y habilitarlo: `VT_ENABLED = TRUE` `VT_API_KEY = <Tu clave de API>` `VT_UPLOAD = TRUE`). Tambi√©n puedes establecer `VT_UPLOAD` en `False`, en ese caso se subir√° el **hash** en lugar del archivo.

### An√°lisis din√°mico asistido con MobSF

MobSF tambi√©n puede ser muy √∫til para el an√°lisis din√°mico en **Android**, pero en ese caso necesitar√°s instalar MobSF y **genymotion** en tu host (una m√°quina virtual o Docker no funcionar√°n). _Nota: Debes **iniciar primero una VM en genymotion** y **luego MobSF**._\
El analizador din√°mico de MobSF puede:

* **Extraer datos de la aplicaci√≥n** (URLs, registros, portapapeles, capturas de pantalla realizadas por ti, capturas de pantalla realizadas por "**Exported Activity Tester**", correos electr√≥nicos, bases de datos SQLite, archivos XML y otros archivos creados). Todo esto se hace autom√°ticamente, excepto las capturas de pantalla, debes presionar cuando desees una captura de pantalla o debes presionar "**Exported Activity Tester**" para obtener capturas de pantalla de todas las actividades exportadas.
* Capturar tr√°fico **HTTPS**
* Usar **Frida** para obtener **informaci√≥n en tiempo de ejecuci√≥n**

A partir de las versiones de Android > 5, MobSF iniciar√° autom√°ticamente Frida y establecer√° la configuraci√≥n global del **proxy** para capturar el tr√°fico. Solo capturar√° el tr√°fico de la aplicaci√≥n probada.

**Frida**

Por defecto, tambi√©n utilizar√° algunos scripts de Frida para **evitar el pinning SSL**, **detecci√≥n de root** y **detecci√≥n de depurador**, y para **monitorizar APIs interesantes**.\
MobSF tambi√©n puede **invocar actividades exportadas**, capturar **capturas de pantalla** de ellas y **guardarlas** para el informe.

Para **iniciar** las pruebas din√°micas, presiona el bot√≥n verde "**Start Instrumentation**". Presiona "**Frida Live Logs**" para ver los registros generados por los scripts de Frida y "**Live API Monitor**" para ver todas las invocaciones a los m√©todos enganchados, los argumentos pasados y los valores devueltos (esto aparecer√° despu√©s de presionar "Start Instrumentation").\
MobSF tambi√©n te permite cargar tus propios **scripts de Frida** (para enviar los resultados de tus scripts de Frida a MobSF, utiliza la funci√≥n `send()`). Tambi√©n tiene **varios scripts preescritos** que puedes cargar (puedes agregar m√°s en `MobSF/DynamicAnalyzer/tools/frida_scripts/others/`), solo **selecciona** los que desees, presiona "**Load**" y luego "**Start Instrumentation**" (podr√°s ver los registros de esos scripts dentro de "**Frida Live Logs**").

![](<../../.gitbook/assets/image (215).png>)

Adem√°s, tienes algunas funcionalidades auxiliares de Frida:

* **Enumerate Loaded Classes**: Imprimir√° todas las clases cargadas.
* **Capture Strings**: Imprimir√° todas las cadenas capturadas mientras se utiliza la aplicaci√≥n (muy ruidoso).
* **Capture String Comparisons**: Puede ser muy √∫til. Mostrar√° las 2 cadenas que se est√°n comparando y si el resultado fue verdadero o falso.
* **Enumerate Class Methods**: Ingresa el nombre de la clase (como "java.io.File") y se imprimir√°n todos los m√©todos de la clase.
* **Search Class Pattern**: Buscar clases por patr√≥n.
* **Trace Class Methods**: Rastrear una clase completa (ver entradas y salidas de todos los m√©todos de la clase). Recuerda que por defecto MobSF rastrea varios m√©todos interesantes de la API de Android.

Una vez que hayas seleccionado el m√≥dulo auxiliar que deseas utilizar, debes presionar "**Start Intrumentation**" y ver√°s todas las salidas en "**Frida Live Logs**".

**Shell**

Mobsf tambi√©n te ofrece una shell con algunos comandos **adb**, comandos de **MobSF** y comandos de **shell** comunes en la parte inferior de la p√°gina de an√°lisis din√°mico. Algunos comandos interesantes:
```
help
shell ls
activities
exported_activities
services
receivers
```
**Herramientas HTTP**

Cuando se captura el tr√°fico http, puedes ver una vista poco atractiva del tr√°fico capturado en la secci√≥n "**HTTP(S) Traffic**" o una vista m√°s agradable en el bot√≥n verde "**Start HTTPTools**". Desde la segunda opci√≥n, puedes **enviar** las **solicitudes capturadas** a **proxies** como Burp o Owasp ZAP.\
Para hacerlo, _enciende Burp -->_ _desactiva Intercept --> en MobSB HTTPTools selecciona la solicitud_ --> presiona "**Send to Fuzzer**" --> _selecciona la direcci√≥n del proxy_ ([http://127.0.0.1:8080\\](http://127.0.0.1:8080)).

Una vez que hayas terminado el an√°lisis din√°mico con MobSF, puedes presionar "**Start Web API Fuzzer**" para **fuzzear las solicitudes http** y buscar vulnerabilidades.

{% hint style="info" %}
Despu√©s de realizar un an√°lisis din√°mico con MobSF, es posible que la configuraci√≥n del proxy est√© mal configurada y no puedas solucionarlo desde la interfaz gr√°fica. Puedes solucionar la configuraci√≥n del proxy haciendo:
```
adb shell settings put global http_proxy :0
```
{% endhint %}

### An√°lisis din√°mico asistido con Inspeckage

Puedes obtener la herramienta de [**Inspeckage**](https://github.com/ac-pm/Inspeckage).\
Esta herramienta utiliza algunos **Hooks** para informarte **qu√© est√° sucediendo en la aplicaci√≥n** mientras realizas un **an√°lisis din√°mico**.

{% content-ref url="inspeckage-tutorial.md" %}
[inspeckage-tutorial.md](inspeckage-tutorial.md)
{% endcontent-ref %}

### [Yaazhini](https://www.vegabird.com/yaazhini/)

Esta es una **gran herramienta para realizar an√°lisis est√°tico con una interfaz gr√°fica**

![](<../../.gitbook/assets/image (527).png>)

### [Qark](https://github.com/linkedin/qark)

Esta herramienta est√° dise√±ada para buscar varias **vulnerabilidades de seguridad relacionadas con aplicaciones Android**, ya sea en **c√≥digo fuente** o en **APK empaquetados**. La herramienta tambi√©n es **capaz de crear un APK desplegable de "Prueba de concepto"** y **comandos ADB** para explotar algunas de las vulnerabilidades encontradas (actividades expuestas, intenciones, tapjacking...). Al igual que con Drozer, no es necesario rootear el dispositivo de prueba.
```bash
pip3 install --user qark  # --user is only needed if not using a virtualenv
qark --apk path/to/my.apk
qark --java path/to/parent/java/folder
qark --java path/to/specific/java/file.java
```
### [**ReverseAPK**](https://github.com/1N3/ReverseAPK.git)

* Muestra todos los archivos extra√≠dos para una f√°cil referencia
* Descompila autom√°ticamente archivos APK al formato Java y Smali
* Analiza AndroidManifest.xml en busca de vulnerabilidades y comportamientos comunes
* An√°lisis est√°tico del c√≥digo fuente en busca de vulnerabilidades y comportamientos comunes
* Informaci√≥n del dispositivo
* Intents
* Ejecuci√≥n de comandos
* Referencias a SQLite
* Referencias a registros
* Proveedores de contenido
* Receptores de transmisi√≥n
* Referencias a servicios
* Referencias a archivos
* Referencias a criptograf√≠a
* Secretos codificados
* URL's
* Conexiones de red
* Referencias a SSL
* Referencias a WebView
```
reverse-apk relative/path/to/APP.apk
```
### [SUPER Android Analyzer](https://github.com/SUPERAndroidAnalyzer/super)

SUPER es una aplicaci√≥n de l√≠nea de comandos que se puede utilizar en Windows, MacOS X y Linux para analizar archivos _.apk_ en busca de vulnerabilidades. Lo hace descomprimiendo los APK y aplicando una serie de reglas para detectar esas vulnerabilidades.

Todas las reglas se encuentran en un archivo `rules.json`, y cada empresa o probador puede crear sus propias reglas para analizar lo que necesiten.

Descarga las √∫ltimas versiones binarias en la [p√°gina de descargas](https://superanalyzer.rocks/download.html)
```
super-analyzer {apk_file}
```
### [StaCoAn](https://github.com/vincentcox/StaCoAn)

![](<../../.gitbook/assets/image (62).png>)

StaCoAn es una herramienta **multiplataforma** que ayuda a desarrolladores, cazadores de recompensas de errores y hackers √©ticos a realizar [an√°lisis de c√≥digo est√°tico](https://en.wikipedia.org/wiki/Static\_program\_analysis) en aplicaciones m√≥viles\*.

El concepto es que arrastres y sueltes el archivo de tu aplicaci√≥n m√≥vil (un archivo .apk o .ipa) en la aplicaci√≥n StaCoAn y generar√° un informe visual y port√°til para ti. Puedes ajustar la configuraci√≥n y las listas de palabras para obtener una experiencia personalizada.

Descarga la [√∫ltima versi√≥n](https://github.com/vincentcox/StaCoAn/releases):
```
./stacoan
```
### [AndroBugs](https://github.com/AndroBugs/AndroBugs\_Framework)

AndroBugs Framework es un sistema de an√°lisis de vulnerabilidades de Android que ayuda a los desarrolladores o hackers a encontrar posibles vulnerabilidades de seguridad en aplicaciones de Android.\
[Versiones para Windows](https://github.com/AndroBugs/AndroBugs\_Framework/releases)
```
python androbugs.py -f [APK file]
androbugs.exe -f [APK file]
```
### [Androwarn](https://github.com/maaaaz/androwarn)

**Androwarn** es una herramienta cuyo objetivo principal es detectar y advertir al usuario sobre posibles comportamientos maliciosos desarrollados por una aplicaci√≥n de Android.

La detecci√≥n se realiza mediante el an√°lisis est√°tico del bytecode Dalvik de la aplicaci√≥n, representado como **Smali**, con la biblioteca [`androguard`](https://github.com/androguard/androguard).

Esta herramienta busca comportamientos comunes de aplicaciones "malas" como: exfiltraci√≥n de identificadores de telefon√≠a, interceptaci√≥n de flujos de audio/video, modificaci√≥n de datos PIM, ejecuci√≥n de c√≥digo arbitrario...
```
python androwarn.py -i my_application_to_be_analyzed.apk -r html -v 3
```
### [MARA Framework](https://github.com/xtiankisutsa/MARA_Framework)

![](<../../.gitbook/assets/image (81).png>)

**MARA** es un **F**ramework de **R**everse engineering y **A**n√°lisis de **A**plicaciones **M**√≥viles. Es una herramienta que re√∫ne herramientas com√∫nmente utilizadas para el reverse engineering y an√°lisis de aplicaciones m√≥viles, para ayudar en las pruebas de seguridad de aplicaciones m√≥viles contra las amenazas de seguridad m√≥vil de OWASP. Su objetivo es facilitar esta tarea y hacerla m√°s amigable para los desarrolladores de aplicaciones m√≥viles y profesionales de seguridad.

Es capaz de:

* Extraer c√≥digo Java y Smali utilizando diferentes herramientas
* Analizar APKs utilizando: [smalisca](https://github.com/dorneanu/smalisca), [ClassyShark](https://github.com/google/android-classyshark), [androbugs](https://github.com/AndroBugs/AndroBugs_Framework), [androwarn](https://github.com/maaaaz/androwarn), [APKiD](https://github.com/rednaga/APKiD)
* Extraer informaci√≥n privada de la APK utilizando expresiones regulares.
* Analizar el Manifiesto.
* Analizar los dominios encontrados utilizando: [pyssltest](https://github.com/moheshmohan/pyssltest), [testssl](https://github.com/drwetter/testssl.sh) y [whatweb](https://github.com/urbanadventurer/WhatWeb)
* Desofuscar APK a trav√©s de [apk-deguard.com](http://www.apk-deguard.com)

### Koodous

√ötil para detectar malware: [https://koodous.com/](https://koodous.com)

<figure><img src="../../.gitbook/assets/image (1).png" alt=""><figcaption></figcaption></figure>

**HackenProof es el hogar de todas las recompensas por errores de criptograf√≠a.**

**Obt√©n recompensas sin demoras**\
Las recompensas de HackenProof se lanzan solo cuando sus clientes depositan el presupuesto de recompensa. Obtendr√°s la recompensa despu√©s de que se verifique el error.

**Obt√©n experiencia en pentesting web3**\
¬°Los protocolos de blockchain y los contratos inteligentes son el nuevo Internet! Domina la seguridad web3 en sus d√≠as de crecimiento.

**Convi√©rtete en la leyenda del hacker web3**\
Gana puntos de reputaci√≥n con cada error verificado y conquista la cima de la clasificaci√≥n semanal.

[**Reg√≠strate en HackenProof**](https://hackenproof.com/register) y comienza a ganar con tus hacks!

{% embed url="https://hackenproof.com/register" %}

## Ofuscando/Desofuscando c√≥digo

Ten en cuenta que dependiendo del servicio y la configuraci√≥n que utilices para ofuscar el c√≥digo, los secretos pueden o no terminar ofuscados.

### [ProGuard](https://en.wikipedia.org/wiki/ProGuard\_\(software\))

**ProGuard** es una herramienta de l√≠nea de comandos de c√≥digo abierto que reduce, optimiza y ofusca el c√≥digo Java. Es capaz de optimizar el bytecode y detectar y eliminar instrucciones no utilizadas. ProGuard es software libre y se distribuye bajo la Licencia P√∫blica General de GNU, versi√≥n 2.

ProGuard se distribuye como parte del Android SDK y se ejecuta al compilar la aplicaci√≥n en modo de lanzamiento.

De: [https://en.wikipedia.org/wiki/ProGuard\_(software)](https://en.wikipedia.org/wiki/ProGuard\_\(software\))

### [DexGuard](https://www.guardsquare.com/dexguard)

Encuentra una gu√≠a paso a paso para desofuscar el apk en [https://blog.lexfo.fr/dexguard.html](https://blog.lexfo.fr/dexguard.html)

(De esa gu√≠a) La √∫ltima vez que verificamos, el modo de operaci√≥n de Dexguard era:

* cargar un recurso como un InputStream;
* alimentar el resultado a una clase que hereda de FilterInputStream para descifrarlo;
* hacer alguna ofuscaci√≥n in√∫til para perder unos minutos de tiempo de un reversor;
* alimentar el resultado descifrado a un ZipInputStream para obtener un archivo DEX;
* finalmente cargar el DEX resultante como un recurso utilizando el m√©todo `loadDex`.

### [DeGuard](http://apk-deguard.com)

**DeGuard revierte el proceso de ofuscaci√≥n realizado por las herramientas de ofuscaci√≥n de Android. Esto permite realizar numerosos an√°lisis de seguridad, incluida la inspecci√≥n de c√≥digo y la predicci√≥n de bibliotecas.**

Puedes subir una APK ofuscada a su plataforma.

### [Simplify](https://github.com/CalebFenton/simplify)

Es un **desofuscador gen√©rico de Android.** Simplify **ejecuta virtualmente una aplicaci√≥n** para comprender su comportamiento y luego **intenta optimizar el c√≥digo** para que se comporte de manera id√©ntica pero sea m√°s f√°cil de entender para un humano. Cada tipo de optimizaci√≥n es simple y gen√©rico, por lo que no importa qu√© tipo espec√≠fico de ofuscaci√≥n se utilice.

### [APKiD](https://github.com/rednaga/APKiD)

APKiD te proporciona informaci√≥n sobre **c√≥mo se cre√≥ un APK**. Identifica muchos **compiladores**, **empaquetadores**, **ofuscadores** y otras cosas extra√±as. Es [_PEiD_](https://www.aldeid.com/wiki/PEiD) para Android.

### Manual

[Lea este tutorial para aprender algunos trucos sobre **c√≥mo desofuscar la ofuscaci√≥n personalizada**](manual-deobfuscation.md)

## Laboratorios

### [Androl4b](https://github.com/sh4hin/Androl4b)

AndroL4b es una m√°quina virtual de seguridad de Android basada en ubuntu-mate que incluye la colecci√≥n de los √∫ltimos frameworks, tutoriales y laboratorios de diferentes expertos en seguridad e investigadores para el reverse engineering y an√°lisis de malware.

### OWASP

{% embed url="https://github.com/OWASP/owasp-mstg%0Ahttps://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06g-testing-network-communication" %}

### Repositorios de Git

[https://github.com/riddhi-shree/nullCommunity/tree/master/Android](https://github.com/riddhi-shree/nullCommunity/tree/master/Android)\
[https://www.youtube.com/watch?v=PMKnPaGWxtg\&feature=youtu.be\&ab\_channel=B3nacSec](https://www.youtube.com/watch?v=PMKnPaGWxtg\&feature=youtu.be\&ab\_channel=B3nacSec)

## Referencias

Para obtener m√°s informaci√≥n, visita:

* [https://appsecwiki.com/#/](https://appsecwiki.com/#/) Es una gran lista de recursos
* [https://maddiestone.github.io/AndroidAppRE/](https://maddiestone.github.io/AndroidAppRE/) Curso r√°pido de Android
* [https://manifestsecurity.com/android-application-security/](https://manifestsecurity.com/android-application-security/)
* [https://github.com/Ralireza/Android-Security-Teryaagh](https://github.com/Ralireza/Android-Security-Teryaagh)
## Para probar

* [https://www.vegabird.com/yaazhini/](https://www.vegabird.com/yaazhini/)
* [https://github.com/abhi-r3v0/Adhrit](https://github.com/abhi-r3v0/Adhrit)

<figure><img src="../../.gitbook/assets/image (1).png" alt=""><figcaption></figcaption></figure>

**HackenProof es el hogar de todas las recompensas por errores de criptograf√≠a.**

**Obt√©n recompensas sin demoras**\
Las recompensas de HackenProof se lanzan solo cuando sus clientes depositan el presupuesto de recompensa. Obtendr√°s la recompensa despu√©s de que se verifique el error.

**Obt√©n experiencia en pentesting web3**\
¬°Los protocolos de blockchain y los contratos inteligentes son el nuevo Internet! Domina la seguridad web3 en sus d√≠as de crecimiento.

**Convi√©rtete en la leyenda del hacker web3**\
Gana puntos de reputaci√≥n con cada error verificado y conquista la cima de la tabla de clasificaci√≥n semanal.

[**Reg√≠strate en HackenProof**](https://hackenproof.com/register) y comienza a ganar con tus hacks!

{% embed url="https://hackenproof.com/register" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* ¬øTrabajas en una **empresa de ciberseguridad**? ¬øQuieres ver tu **empresa anunciada en HackTricks**? ¬øO quieres tener acceso a la **√∫ltima versi√≥n de PEASS o descargar HackTricks en PDF**? ¬°Consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obt√©n el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* **√önete al** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠gueme** en **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Comparte tus trucos de hacking enviando PRs al** [**repositorio de hacktricks**](https://github.com/carlospolop/hacktricks) **y al** [**repositorio de hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
