# Pentesting de Aplicaciones Android

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* ¬øTrabajas en una **empresa de ciberseguridad**? ¬øQuieres ver tu **empresa anunciada en HackTricks**? ¬øO quieres tener acceso a la **√∫ltima versi√≥n de PEASS o descargar HackTricks en PDF**? ¬°Consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obt√©n el [**swag oficial de PEASS y HackTricks**](https://peass.creator-spring.com)
* **√önete al** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠gueme** en **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Comparte tus trucos de hacking enviando PRs al** [**repositorio de hacktricks**](https://github.com/carlospolop/hacktricks) **y al** [**repositorio de hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

<figure><img src="../../.gitbook/assets/image (7) (2).png" alt=""><figcaption></figcaption></figure>

[**Sigue a HackenProof**](https://bit.ly/3xrrDrL) **para aprender m√°s sobre errores web3**

üêû Lee tutoriales de errores web3

üîî Recibe notificaciones sobre nuevos programas de recompensas por errores

üí¨ Participa en discusiones comunitarias

## Conceptos b√°sicos de las aplicaciones Android

Se recomienda encarecidamente leer esta p√°gina para conocer las **partes m√°s importantes relacionadas con la seguridad de Android y los componentes m√°s peligrosos en una aplicaci√≥n de Android**:

{% content-ref url="android-applications-basics.md" %}
[android-applications-basics.md](android-applications-basics.md)
{% endcontent-ref %}

## ADB (Android Debug Bridge)

Esta es la herramienta principal que necesitas para conectarte a un dispositivo Android (emulado o f√≠sico).\
Te permite controlar tu dispositivo a trav√©s de **USB** o **Red** desde un ordenador, **copiar** archivos de ida y vuelta, **instalar** y desinstalar aplicaciones, ejecutar comandos de **shell**, realizar **copias de seguridad**, leer **registros** y m√°s.

Echa un vistazo a la siguiente lista de [**Comandos ADB**](adb-commands.md) para aprender c√≥mo usar adb.

## Smali

A veces es interesante **modificar el c√≥digo de la aplicaci√≥n** para acceder a **informaci√≥n oculta** (quiz√°s contrase√±as bien ofuscadas o banderas). Entonces, podr√≠a ser interesante decompilar el apk, modificar el c√≥digo y recompilarlo.\
[**En este tutorial** puedes **aprender c√≥mo decompilar un APK, modificar el c√≥digo Smali y recompilar el APK** con la nueva funcionalidad](smali-changes.md). Esto podr√≠a ser muy √∫til como **alternativa para varias pruebas durante el an√°lisis din√°mico** que se van a presentar. Entonces, **mant√©n siempre en mente esta posibilidad**.

## Otros trucos interesantes

* [Falsificar tu ubicaci√≥n en Play Store](spoofing-your-location-in-play-store.md)
* **Descargar APKs**: [https://apps.evozi.com/apk-downloader/](https://apps.evozi.com/apk-downloader/), [https://apkpure.com/es/](https://apkpure.com/es/), [https://www.apkmirror.com/](https://www.apkmirror.com), [https://apkcombo.com/es-es/apk-downloader/](https://apkcombo.com/es-es/apk-downloader/)
* Extraer APK del dispositivo:
```
adb shell pm list packages
com.android.insecurebankv2

adb shell pm path com.android.insecurebankv2 
package:/data/app/com.android.insecurebankv2-Jnf8pNgwy3QA_U5f-n_4jQ==/base.apk

adb pull /data/app/com.android.insecurebankv2- Jnf8pNgwy3QA_U5f-n_4jQ==/base.apk
```
<figure><img src="../../.gitbook/assets/image (7) (2).png" alt=""><figcaption></figcaption></figure>

[**Sigue a HackenProof**](https://bit.ly/3xrrDrL) **para aprender m√°s sobre errores web3**

üêû Lee tutoriales sobre errores web3

üîî Recibe notificaciones sobre nuevos programas de recompensas por errores

üí¨ Participa en discusiones comunitarias

## An√°lisis est√°tico

En primer lugar, para analizar un APK, deber√≠as **echar un vistazo al c√≥digo Java** utilizando un decompilador.\
Por favor, [**lee aqu√≠ para encontrar informaci√≥n sobre los diferentes decompiladores disponibles**](apk-decompilers.md).

### Buscando informaci√≥n interesante

Simplemente echando un vistazo a las **cadenas de texto** del APK, puedes buscar **contrase√±as**, **URLs** ([https://github.com/ndelphit/apkurlgrep](https://github.com/ndelphit/apkurlgrep)), **claves** de API, **encriptaci√≥n**, **UUIDs** de Bluetooth, **tokens** y cualquier otra cosa interesante... incluso busca puertas traseras de **ejecuci√≥n de c√≥digo** o puertas traseras de autenticaci√≥n (credenciales de administrador codificadas en la aplicaci√≥n).

**Firebase**

Presta especial atenci√≥n a las **URLs de Firebase** y comprueba si est√° mal configurado. [M√°s informaci√≥n sobre qu√© es Firebase y c√≥mo explotarlo aqu√≠.](../../network-services-pentesting/pentesting-web/buckets/firebase-database.md)

### Comprensi√≥n b√°sica de la aplicaci√≥n - Manifest.xml, strings.xml

Utilizando cualquiera de los **decompiladores** mencionados [**aqu√≠**](apk-decompilers.md), podr√°s leer el _Manifest.xml_. Tambi√©n puedes **renombrar** el archivo APK cambiando la extensi√≥n del archivo a **.zip** y **descomprimirlo**.\
Leyendo el **manifiesto**, puedes encontrar **vulnerabilidades**:

* En primer lugar, comprueba si **la aplicaci√≥n es depurable**. Un APK de producci√≥n no deber√≠a serlo (o otros podr√°n conectarse a √©l). Puedes comprobar si una aplicaci√≥n es depurable buscando en el manifiesto el atributo `debuggable="true"` dentro de la etiqueta _\<application_ Ejemplo: `<application theme="@2131296387" debuggable="true"`
  * [Aprende aqu√≠](drozer-tutorial/#is-debuggeable) c√≥mo encontrar aplicaciones depurables en un tel√©fono y explotarlas
* **Copia de seguridad**: El atributo **`android:allowBackup`** define si los datos de la aplicaci√≥n pueden ser copiados de seguridad y restaurados por un usuario que haya habilitado la depuraci√≥n USB. Si la bandera de copia de seguridad est√° establecida en verdadero, permite a un atacante tomar la copia de seguridad de los datos de la aplicaci√≥n a trav√©s de adb incluso si el dispositivo no est√° rooteado. Por lo tanto, las aplicaciones que manejan y almacenan informaci√≥n sensible como detalles de tarjetas, contrase√±as, etc. deben tener esta configuraci√≥n expl√≠citamente establecida en **falso** porque por defecto est√° establecida en **verdadero** para evitar tales riesgos.
  * `<application android:allowBackup="false"`
* **Seguridad de la red:** La seguridad de la red de la aplicaci√≥n puede sobrescribir los valores predeterminados con **`android:networkSecurityConfig="@xml/network_security_config"`**. Se puede poner un archivo con ese nombre en _**res/xml.**_ Este archivo configurar√° importantes ajustes de seguridad como los pines de certificado o si permite el tr√°fico HTTP. Puedes leer aqu√≠ m√°s informaci√≥n sobre todas las cosas que se pueden configurar, pero comprueba este ejemplo sobre c√≥mo configurar el tr√°fico HTTP para algunos dominios:
  * `<domain-config cleartextTrafficPermitted="true"> <domain includeSubdomains="true">formation-software.co.uk </domain></domain-config>`
* **Actividades exportadas**: Comprueba las actividades exportadas dentro del manifiesto ya que esto podr√≠a ser peligroso. M√°s adelante en el an√°lisis din√°mico se explicar√° c√≥mo [puedes abusar de este comportamiento](./#exploiting-exported-activities-authorisation-bypass).
* **Proveedores de contenido**: Si se expone un proveedor exportado, podr√≠as ser capaz de acceder/modificar informaci√≥n interesante. En el an√°lisis din√°mico [aprender√°s c√≥mo abusar de ellos](./#exploiting-content-providers-accessing-and-manipulating-sensitive-information).
  * Comprueba las configuraciones de **FileProviders** dentro del atributo `android:name="android.support.FILE_PROVIDER_PATHS"`. [Lee aqu√≠ para aprender m√°s sobre FileProviders](./#fileprovider).
* **Servicios expuestos**: Dependiendo de lo que el servicio est√© haciendo internamente, se podr√≠an explotar vulnerabilidades. En el an√°lisis din√°mico [aprender√°s c√≥mo abusar de ellos](./#exploiting-services).
* **Receptores de difusi√≥n**: [Aprender√°s c√≥mo posiblemente explotarlos](./#exploiting-broadcast-receivers) durante el an√°lisis din√°mico.
* **Esquema de URL**: Lee el c√≥digo de la actividad que gestiona el esquema y busca vulnerabilidades que manejen la entrada del usuario. M√°s informaci√≥n sobre [qu√© es un esquema de URL aqu√≠](./#url-schemes).
* **minSdkVersion**, **targetSDKVersion**, **maxSdkVersion**: Indican las versiones de Android en las que se ejecutar√° la aplicaci√≥n. Es importante tenerlas en cuenta porque desde una perspectiva de seguridad, el soporte de versiones antiguas permitir√° que se ejecuten versiones vulnerables conocidas de Android.

Leyendo **resources.arsc/strings.xml** puedes encontrar alguna **informaci√≥n interesante**:

* Claves de API
* Esquemas personalizados
* Otra informaci√≥n interesante que los desarrolladores guardan en este archivo

### Tapjacking

**Tapjacking** es un ataque en el que se lanza una **aplicaci√≥n maliciosa** y se **posiciona encima de una aplicaci√≥n v√≠ctima**. Una vez que oculta visiblemente la aplicaci√≥n v√≠ctima, su interfaz de usuario est√° dise√±ada de tal manera que enga√±a al usuario para que interact√∫e con ella, mientras que est√° pasando la interacci√≥n a la aplicaci√≥n v√≠ctima.\
En efecto, est√° **ciegando al usuario para que no sepa que en realidad est√° realizando acciones en la aplicaci√≥n v√≠ctima**.

Para detectar aplicaciones vulnerables a este ataque, deber√≠as buscar **actividades exportadas** en el manifiesto de Android (ten en cuenta que una actividad con un filtro de intenci√≥n se exporta autom√°ticamente por defecto). Una vez que hayas encontrado las actividades exportadas, **comprueba si requieren alg√∫n permiso**. Esto se debe a que la **aplicaci√≥n maliciosa tambi√©n necesitar√° ese permiso**.\
Por √∫ltimo, es importante comprobar el c√≥digo para posibles configuraciones de **`setFilterTouchesWhenObscured`**. Si se establece en **`true`**, un bot√≥n puede desactivarse autom√°ticamente si est√° oscurecido:
```markup
<Button android:text="Button"
android:id="@+id/button1"
android:layout_width="wrap_content"
android:layout_height="wrap_content" 
android:filterTouchesWhenObscured="true">
</Button>
```
Puedes usar [**qark**](https://github.com/linkedin/qark) con el par√°metro `--exploit-apk` para crear una aplicaci√≥n maliciosa y probar posibles vulnerabilidades de **Tapjacking**.\
Un proyecto de ejemplo que implementa este tipo de caracter√≠stica se puede encontrar en [**FloatingWindowApp**](https://github.com/aminography/FloatingWindowApp).

La mitigaci√≥n es relativamente simple, ya que el desarrollador puede elegir no recibir eventos t√°ctiles cuando una vista est√° cubierta por otra. Usando la [Referencia del desarrollador de Android](https://developer.android.com/reference/android/view/View#security):

> A veces es esencial que una aplicaci√≥n pueda verificar que una acci√≥n se est√° realizando con el pleno conocimiento y consentimiento del usuario, como conceder una solicitud de permiso, realizar una compra o hacer clic en un anuncio. Desafortunadamente, una aplicaci√≥n maliciosa podr√≠a intentar enga√±ar al usuario para que realice estas acciones, sin saberlo, ocultando el prop√≥sito previsto de la vista. Como remedio, el marco ofrece un mecanismo de filtrado t√°ctil que se puede utilizar para mejorar la seguridad de las vistas que proporcionan acceso a funcionalidades sensibles.
>
> Para habilitar el filtrado t√°ctil, llama a [`setFilterTouchesWhenObscured(boolean)`](https://developer.android.com/reference/android/view/View#setFilterTouchesWhenObscured%28boolean%29) o establece el atributo de dise√±o android:filterTouchesWhenObscured en true. Cuando se habilita, el marco descartar√° los toques que se reciban siempre que la ventana de la vista est√© oculta por otra ventana visible. Como resultado, la vista no recibir√° toques cada vez que aparezca una ventana emergente, un cuadro de di√°logo u otra ventana por encima de la ventana de la vista.

### Secuestro de tareas

{% content-ref url="android-task-hijacking.md" %}
[android-task-hijacking.md](android-task-hijacking.md)
{% endcontent-ref %}

### Almacenamiento de datos inseguro

**Almacenamiento interno**

Los archivos **creados** en el almacenamiento **interno** son **accesibles** solo por la **aplicaci√≥n**. Esta protecci√≥n est√° implementada por Android y es suficiente para la mayor√≠a de las aplicaciones. Pero los desarrolladores a menudo usan `MODE_WORLD_READBALE` y `MODE_WORLD_WRITABLE` para dar acceso a esos archivos a otra aplicaci√≥n, pero esto no limita a otras aplicaciones (maliciosas) para acceder a ellos.\
Durante el **an√°lisis est√°tico**, comprueba el uso de esos **modos**, durante el **an√°lisis din√°mico**, comprueba los **permisos** de los archivos creados (tal vez algunos de ellos sean legibles / escribibles en todo el mundo).\
[M√°s informaci√≥n sobre esta vulnerabilidad y c√≥mo solucionarla aqu√≠.](https://manifestsecurity.com/android-application-security-part-8/)

**Almacenamiento externo**

Los archivos creados en el **almacenamiento externo**, como las tarjetas SD, son **legibles y escribibles globalmente**. Debido a que el almacenamiento externo puede ser eliminado por el usuario y tambi√©n modificado por cualquier aplicaci√≥n, no debes almacenar informaci√≥n confidencial utilizando el almacenamiento externo.\
Al igual que con los datos de cualquier fuente no confiable, debes **realizar la validaci√≥n de entrada** al manejar **datos del almacenamiento externo**. Recomendamos encarecidamente que no almacenes archivos ejecutables o archivos de clase en el almacenamiento externo antes de la carga din√°mica. Si tu aplicaci√≥n recupera archivos ejecutables desde el almacenamiento externo, los archivos deben estar firmados y verificados criptogr√°ficamente antes de la carga din√°mica.\
Informaci√≥n tomada de [aqu√≠](https://manifestsecurity.com/android-application-security-part-8/).

El almacenamiento externo se puede **acceder** en `/storage/emulated/0`, `/sdcard`, `/mnt/sdcard`

{% hint style="info" %}
A partir de Android 4.4 (**API 17**), la tarjeta SD tiene una estructura de directorios que **limita el acceso de una aplicaci√≥n al directorio que es espec√≠fico para esa aplicaci√≥n**. Esto evita que una aplicaci√≥n maliciosa obtenga acceso de lectura o escritura a los archivos de otra aplicaci√≥n.
{% endhint %}

**Datos sensibles almacenados en texto claro**

* **Preferencias compartidas**: Android permite que cada aplicaci√≥n guarde f√°cilmente archivos xml en la ruta `/data/data/<nombrepaquete>/shared_prefs/` y a veces es posible encontrar informaci√≥n sensible en texto claro en esa carpeta.
* **Bases de datos**: Android permite que cada aplicaci√≥n guarde f√°cilmente bases de datos sqlite en la ruta `/data/data/<nombrepaquete>/databases/` y a veces es posible encontrar informaci√≥n sensible en texto claro en esa carpeta.

### TLS roto

**Aceptar todos los certificados**

Por alguna raz√≥n, a veces los desarrolladores aceptan todos los certificados incluso si, por ejemplo, el nombre de host no coincide con l√≠neas de c√≥digo como la siguiente:
```java
SSLSocketFactory sf = new cc(trustStore);
sf.setHostnameVerifier(SSLSocketFactory.ALLOW_ALL_HOSTNAME_VERIFIER);
```
Una buena manera de probar esto es intentar capturar el tr√°fico usando alg√∫n proxy como Burp sin autorizar el CA de Burp dentro del dispositivo. Adem√°s, se puede generar con Burp un certificado para un nombre de host diferente y usarlo.

### Criptograf√≠a rota

**Procesos de gesti√≥n de claves deficientes**

Algunos desarrolladores guardan datos sensibles en el almacenamiento local y los cifran con una clave codificada/predictiva en el c√≥digo. Esto no deber√≠a hacerse ya que algunos procesos de reversi√≥n podr√≠an permitir a los atacantes extraer la informaci√≥n confidencial.

**Uso de algoritmos inseguros y/o obsoletos**

Los desarrolladores no deber√≠an usar algoritmos **obsoletos** para realizar comprobaciones de autorizaci√≥n, almacenar o enviar datos. Algunos de estos algoritmos son: RC4, MD4, MD5, SHA1... Si se usan **hashes** para almacenar contrase√±as, por ejemplo, se deben usar hashes resistentes a la fuerza bruta con sal.

### Otras comprobaciones

* Se recomienda **ofuscar el APK** para dificultar el trabajo de ingenier√≠a inversa a los atacantes.
* Si la aplicaci√≥n es sensible (como las aplicaciones bancarias), deber√≠a realizar sus **propias comprobaciones para ver si el m√≥vil est√° rooteado** y actuar en consecuencia.
* Si la aplicaci√≥n es sensible (como las aplicaciones bancarias), deber√≠a comprobar si se est√° utilizando un **emulador**.
* Si la aplicaci√≥n es sensible (como las aplicaciones bancarias), deber√≠a **comprobar su propia integridad antes de ejecutarse** para verificar si fue modificada.
* Usar [**APKiD**](https://github.com/rednaga/APKiD) para comprobar qu√© compilador/packer/ofuscador se us√≥ para construir el APK.

### Aplicaci√≥n React Native

Lea la siguiente p√°gina para aprender c√≥mo acceder f√°cilmente al c√≥digo JavaScript de las aplicaciones React:

{% content-ref url="react-native-application.md" %}
[react-native-application.md](react-native-application.md)
{% endcontent-ref %}

### Aplicaciones Xamarin

Las aplicaciones **Xamarin** est√°n escritas en **C#**, para acceder al c√≥digo C# **descomprimido**, es necesario obtener los archivos del **apk**:
```bash
7z r app.apk #Or any other zip decompression cmd
```
Luego, descomprime todos los DLsL usando [**xamarin-decompress**](https://github.com/NickstaDB/xamarin-decompress)**:**
```
python3 xamarin-decompress.py -o /path/to/decompressed/apk
```
### An√°lisis de c√≥digo est√°tico automatizado

La herramienta [**mariana-trench**](https://github.com/facebook/mariana-trench) es capaz de encontrar **vulnerabilidades** mediante el **escaneo** del **c√≥digo** de la aplicaci√≥n. Esta herramienta contiene una serie de **fuentes conocidas** (que indican a la herramienta los **lugares** donde la **entrada** est√° **controlada por el usuario**), **sumideros** (que indican a la herramienta **lugares peligrosos** donde la entrada malintencionada del usuario podr√≠a causar da√±os) y **reglas**. Estas reglas indican la **combinaci√≥n** de **fuentes-sumideros** que indica una vulnerabilidad.

Con este conocimiento, **mariana-trench revisar√° el c√≥digo y encontrar√° posibles vulnerabilidades en √©l**.

### Secretos filtrados

Una aplicaci√≥n puede contener secretos (claves API, contrase√±as, URL ocultas, subdominios...) dentro de ella que podr√≠as descubrir. Podr√≠as usar una herramienta como [https://github.com/dwisiswant0/apkleaks](https://github.com/dwisiswant0/apkleaks)

### Saltar la autenticaci√≥n biom√©trica

{% content-ref url="bypass-biometric-authentication-android.md" %}
[bypass-biometric-authentication-android.md](bypass-biometric-authentication-android.md)
{% endcontent-ref %}

### Otras funciones interesantes

* **Ejecuci√≥n de c√≥digo**: `Runtime.exec(), ProcessBuilder(), c√≥digo nativo:system()`
* **Enviar SMS**: `sendTextMessage, sendMultipartTestMessage`
* **Funciones nativas** declaradas como `native`: `public native, System.loadLibrary, System.load`
  * [Lee esto para aprender **c√≥mo revertir funciones nativas**](reversing-native-libraries.md)

### **Otros trucos**

{% content-ref url="content-protocol.md" %}
[content-protocol.md](content-protocol.md)
{% endcontent-ref %}

<figure><img src="../../.gitbook/assets/image (7) (2).png" alt=""><figcaption></figcaption></figure>

[**Sigue a HackenProof**](https://bit.ly/3xrrDrL) **para aprender m√°s sobre errores web3**

üêû Lee tutoriales de errores web3

üîî Recibe notificaciones sobre nuevos errores de recompensa

üí¨ Participa en discusiones comunitarias

## An√°lisis din√°mico

> En primer lugar, necesitas un entorno donde puedas instalar la aplicaci√≥n y todo el entorno (certificado Burp CA, Drozer y Frida principalmente). Por lo tanto, se recomienda encarecidamente un dispositivo rooteado (emulado o no).

### An√°lisis din√°mico en l√≠nea

Puedes crear una **cuenta gratuita** en: [https://appetize.io/](https://appetize.io). Esta plataforma te permite **subir** y **ejecutar** APKs, por lo que es √∫til para ver c√≥mo se comporta un APK.

Incluso puedes **ver los registros de tu aplicaci√≥n** en la web y conectarte a trav√©s de **adb**.

![](<../../.gitbook/assets/image (60).png>)

Gracias a la conexi√≥n ADB, puedes usar **Drozer** y **Frida** dentro de los emuladores.

### An√°lisis din√°mico local

Puedes usar alg√∫n **emulador** como:

* [**Android Studio**](https://developer.android.com/studio) (Puedes crear dispositivos **x86** y **arm**, y seg√∫n [**esto**](https://android-developers.googleblog.com/2020/03/run-arm-apps-on-android-emulator.html) **las √∫ltimas versiones x86** admiten **bibliotecas ARM** sin necesidad de un emulador ARM lento).
  * Si quieres intentar **instalar** una **imagen** y luego quieres **eliminarla**, puedes hacerlo en Windows:`C:\Users\<User>\AppData\Local\Android\sdk\system-images\` o Mac: `/Users/myeongsic/Library/Android/sdk/system-image`
  * Este es el **emulador principal que recomiendo usar y puedes** [**aprender a configurarlo en esta p√°gina**](avd-android-virtual-device.md).
* [**Genymotion**](https://www.genymotion.com/fun-zone/) **(Versi√≥n gratuita:** Personal Edition, necesitas crear una cuenta. _Se recomienda **descargar** la versi√≥n **CON**_ _**VirtualBox** para evitar posibles errores._)
* [Nox](https://es.bignox.com) (Gratis, pero no admite Frida o Drozer).

{% hint style="info" %}
Al crear un nuevo emulador en cualquier plataforma, recuerda que cuanto m√°s grande sea la pantalla, m√°s lento funcionar√° el emulador. As√≠ que selecciona pantallas peque√±as si es posible.
{% endhint %}

Como la mayor√≠a de la gente usar√° **Genymotion**, ten en cuenta este truco. Para **instalar servicios de Google** (como AppStore) necesitas hacer clic en el bot√≥n marcado en rojo de la siguiente imagen:

![](<../../.gitbook/assets/image (200) (1).png>)

Adem√°s, ten en cuenta que en la **configuraci√≥n de la VM de Android en Genymotion** puedes seleccionar el modo de red de **Bridge Network** (esto ser√° √∫til si te conectar√°s a la VM de Android desde una VM diferente con las herramientas).

O podr√≠as usar un **dispositivo f√≠sico** (necesitas activar las opciones de depuraci√≥n y ser√≠a genial si pudieras rootearlo):

1. **Configuraci√≥n**.
2. (Desde Android 8.0) Selecciona **Sistema**.
3. Selecciona **Acerca del tel√©fono**.
4. Presiona **N√∫mero de compilaci√≥n** 7 veces.
5. Vuelve atr√°s y encontrar√°s las **Opciones de desarrollador**.

> Una vez que hayas instalado la aplicaci√≥n, lo primero que debes hacer es probarla e investigar qu√© hace, c√≥mo funciona y sentirte c√≥modo con ella.\
> Sugerir√≠a **realizar este an√°lisis din√°mico inicial utilizando el an√°lisis din√°mico de MobSF + pidcat**, para que puedas **aprender c√≥mo funciona la aplicaci√≥n** mientras MobSF **captura** muchos **datos interesantes** que puedes revisar m√°s tarde.

### Fuga de datos no intencional

**Registro**

A menudo, los desarrolladores dejan informaci√≥n de depuraci√≥n p√∫blicamente. Por lo tanto, cualquier aplicaci√≥n con permiso `READ_LOGS` puede **acceder a esos registros** y puede obtener informaci√≥n confidencial a trav√©s de ellos.\
Mientras navegas por la aplicaci√≥n, usa [**pidcat**](https://github.com/JakeWharton/pidcat)_(Recomendado, es m√°s f√°cil de usar y leer)_ o [adb logcat](adb-commands.md#logcat) para leer los registros creados y **buscar informaci√≥n confidencial**.

{% hint style="warning" %}
Ten en cuenta que a partir de las versiones posteriores a Android 4.0, **las aplicaciones solo pueden acceder a sus propios registros**. Por lo tanto, las aplicaciones no pueden acceder a los registros de otras aplicaciones.\
De todos modos, todav√≠a se recomienda **no registrar informaci√≥n confidencial**.
{% endhint %}

**Cach√© del portapapeles**

Android proporciona un marco basado en el **portapapeles** para proporcionar la funci√≥n de copiar y pegar en las aplicaciones de Android. Pero esto crea un problema grave cuando alguna **otra aplicaci√≥n** puede **acceder** al **portapapeles** que contiene algunos datos confidenciales. La funci√≥n de **copiar/pegar** deber√≠a estar **deshabilitada** para la **parte sensible** de la aplicaci√≥n. Por ejemplo, deshabilita la copia de detalles de tarjetas de cr√©dito.

**Registros
```
adb shell am start -n com.example.demo/com.example.test.MainActivity
```
**NOTA**: MobSF detectar√° como malicioso el uso de _**singleTask/singleInstance**_ como `android:launchMode` en una actividad, pero debido a [esto](https://github.com/MobSF/Mobile-Security-Framework-MobSF/pull/750), aparentemente esto solo es peligroso en versiones antiguas (versiones de API < 21).

{% hint style="info" %}
Tenga en cuenta que un bypass de autorizaci√≥n no siempre es una vulnerabilidad, depender√° de c√≥mo funcione el bypass y qu√© informaci√≥n se exponga.
{% endhint %}

**Fuga de informaci√≥n sensible**

**Las actividades tambi√©n pueden devolver resultados**. Si logra encontrar una actividad exportada y no protegida que llame al m√©todo **`setResult`** y **devuelva informaci√≥n sensible**, hay una fuga de informaci√≥n sensible.

### Explotando Proveedores de Contenido - Accediendo y manipulando informaci√≥n sensible

[**Lea esto si desea recordar qu√© es un Proveedor de Contenido.**](android-applications-basics.md#content-provider)\
Los proveedores de contenido se utilizan b√°sicamente para **compartir datos**. Si una aplicaci√≥n tiene proveedores de contenido disponibles, es posible que pueda **extraer datos sensibles** de ellos. Tambi√©n es interesante probar posibles **inyecciones SQL** y **traves√≠as de ruta** ya que podr√≠an ser vulnerables.\
[**Aprenda c√≥mo explotar los Proveedores de Contenido con Drozer.**](drozer-tutorial/#content-providers)

### **Explotando Servicios**

[**Lea esto si desea recordar qu√© es un Servicio.**](android-applications-basics.md#services)\
Recuerde que las acciones de un Servicio comienzan en el m√©todo `onStartCommand`.

Un servicio es b√°sicamente algo que **puede recibir datos**, **procesarlos** y **devolver** (o no) una respuesta. Entonces, si una aplicaci√≥n est√° exportando algunos servicios, debe **verificar** el **c√≥digo** para entender qu√© est√° haciendo y **probarlo** **din√°micamente** para extraer informaci√≥n confidencial, saltarse medidas de autenticaci√≥n...\
[**Aprenda c√≥mo explotar los Servicios con Drozer.**](drozer-tutorial/#services)

### **Explotando Receptores de Difusi√≥n**

[**Lea esto si desea recordar qu√© es un Receptor de Difusi√≥n.**](android-applications-basics.md#broadcast-receivers)\
Recuerde que las acciones de un Receptor de Difusi√≥n comienzan en el m√©todo `onReceive`.

Un receptor de difusi√≥n estar√° esperando un tipo de mensaje. Dependiendo de c√≥mo maneje el receptor el mensaje, podr√≠a ser vulnerable.\
[**Aprenda c√≥mo explotar los Receptores de Difusi√≥n con Drozer.**](./#exploiting-broadcast-receivers)

### **Explotando Esquemas / Enlaces profundos**

Puede buscar enlaces profundos manualmente, utilizando herramientas como MobSF o scripts como [este](https://github.com/ashleykinguk/FBLinkBuilder/blob/master/FBLinkBuilder.py).\
Puede **abrir** un **esquema** declarado usando **adb** o un **navegador**:
```bash
adb shell am start -a android.intent.action.VIEW -d "scheme://hostname/path?param=value" [your.package.name]
```
_Nota que puedes **omitir el nombre del paquete** y el m√≥vil autom√°ticamente llamar√° a la aplicaci√≥n que deber√≠a abrir ese enlace._
```markup
<!-- Browser regular link -->
<a href="scheme://hostname/path?param=value">Click me</a>
<!-- fallback in your url you could try the intent url -->
<a href="intent://hostname#Intent;scheme=scheme;package=your.package.name;S.browser_fallback_url=http%3A%2F%2Fwww.example.com;end">with alternative</a>
```
**C√≥digo ejecutado**

Para encontrar el **c√≥digo que se ejecutar√° en la aplicaci√≥n**, ve a la actividad llamada por el enlace profundo y busca la funci√≥n **`onNewIntent`**.

![](<../../.gitbook/assets/image (436) (1) (1) (1).png>)

**Informaci√≥n sensible**

Cada vez que encuentres un enlace profundo, comprueba que **no est√© recibiendo datos sensibles (como contrase√±as) a trav√©s de par√°metros de URL**, porque cualquier otra aplicaci√≥n podr√≠a **suplantar el enlace profundo y robar esos datos**.

**Par√°metros en la ruta**

Tambi√©n **debes comprobar si alg√∫n enlace profundo est√° utilizando un par√°metro dentro de la ruta** de la URL como: `https://api.example.com/v1/users/{username}`, en ese caso puedes forzar una traves√≠a de ruta accediendo a algo como: `example://app/users?username=../../unwanted-endpoint%3fparam=value`.\
Ten en cuenta que si encuentras los endpoints correctos dentro de la aplicaci√≥n, podr√≠as causar una **Redirecci√≥n Abierta** (si parte de la ruta se utiliza como nombre de dominio), **toma de cuenta** (si puedes modificar los detalles de los usuarios sin token CSRF y el endpoint vulnerable utiliz√≥ el m√©todo correcto) y cualquier otra vulnerabilidad. M√°s [informaci√≥n sobre esto aqu√≠](http://dphoeniixx.com/2020/12/13-2/).

**M√°s ejemplos**

Un [informe interesante de recompensa por errores](https://hackerone.com/reports/855618) sobre enlaces (_/.well-known/assetlinks.json_).

### Protecci√≥n insuficiente de la capa de transporte

* **Falta de inspecci√≥n de certificados:** la aplicaci√≥n de Android no verifica la identidad del certificado presentado. La mayor√≠a de las aplicaciones ignoran las advertencias y aceptan cualquier certificado autofirmado presentado. Algunas aplicaciones, en cambio, pasan el tr√°fico a trav√©s de una conexi√≥n HTTP.
* **Negociaci√≥n de handshake d√©bil:** la aplicaci√≥n y el servidor realizan un handshake SSL/TLS pero utilizan un conjunto de cifrado inseguro que es vulnerable a ataques MITM. Por lo tanto, cualquier atacante puede descifrar f√°cilmente esa conexi√≥n.
* **Fuga de informaci√≥n de privacidad:** la mayor√≠a de las veces sucede que las aplicaciones hacen autenticaci√≥n a trav√©s de un canal seguro pero todas las dem√°s conexiones a trav√©s de un canal no seguro. Eso no a√±ade seguridad a la aplicaci√≥n porque el resto de los datos sensibles como la cookie de sesi√≥n o los datos de usuario pueden ser interceptados por un usuario malintencionado.

De los 3 escenarios presentados, vamos a discutir **c√≥mo verificar la identidad del certificado**. Los otros 2 escenarios dependen de la **configuraci√≥n TLS** del servidor y si la **aplicaci√≥n env√≠a datos sin cifrar**. El pentester debe comprobar por su cuenta la configuraci√≥n TLS del servidor ([aqu√≠](../../network-services-pentesting/pentesting-web/#ssl-tls-vulnerabilites)) y detectar si se env√≠a alguna **informaci√≥n confidencial por un canal no cifrado/vulnerable**.\
M√°s informaci√≥n sobre c√≥mo descubrir y solucionar este tipo de vulnerabilidades [**aqu√≠**](https://manifestsecurity.com/android-application-security-part-10/).

**SSL Pinning**

Por defecto, al realizar una conexi√≥n SSL, el cliente (aplicaci√≥n de Android) comprueba que el certificado del servidor tiene una cadena de confianza verificable hasta un certificado de confianza (ra√≠z) y coincide con el nombre de host solicitado. Esto lleva al problema de **ataques Man in the Middle (MITM)**.\
En el certificate Pinnning, una aplicaci√≥n de Android contiene el certificado del servidor y solo transmite datos si se presenta el mismo certificado.\
Se recomienda **aplicar SSL Pinning** para los sitios donde se va a enviar informaci√≥n sensible.

### Inspecci√≥n del tr√°fico HTTP

En primer lugar, debes (debes) **instalar el certificado** de la herramienta **proxy** que vas a utilizar, probablemente Burp. Si no instalas el certificado CA de la herramienta proxy, es probable que no veas el tr√°fico cifrado en el proxy.\
**Por favor,** [**lee esta gu√≠a para aprender c√≥mo instalar un certificado CA personalizado**](android-burp-suite-settings.md)**.**

Para las aplicaciones que apuntan a **API Level 24+ no es suficiente instalar el certificado Burp** en el dispositivo. Para evitar esta nueva protecci√≥n, debes modificar el archivo de configuraci√≥n de seguridad de red. Por lo tanto, podr√≠as modificar este archivo para autorizar tu certificado CA o puedes [**leer esta p√°gina para un tutorial sobre c√≥mo forzar a la aplicaci√≥n a aceptar de nuevo todos los certificados instalados en el dispositivo**](make-apk-accept-ca-certificate.md).

**SSL Pinning**

Ya hemos discutido qu√© es SSL Pinning solo 2 p√°rrafos antes. Cuando se implementa en una aplicaci√≥n, deber√°s omitirlo para inspeccionar el tr√°fico HTTPS o no lo ver√°s.\
Aqu√≠ voy a presentar algunas opciones que he utilizado para omitir esta protecci√≥n:

* Modificar autom√°ticamente el **apk** para **omitir** SSLPinning con [**apk-mitm**](https://github.com/shroudedcode/apk-mitm). El mejor pro de esta opci√≥n es que no necesitar√°s root para omitir el SSL Pinning, pero deber√°s eliminar la aplicaci√≥n y reinstalar la nueva, y esto no siempre funcionar√°.
* Podr√≠as usar **Frida** (discutido a continuaci√≥n) para omitir esta protecci√≥n. Aqu√≠ tienes una gu√≠a para usar Burp+Frida+Genymotion: [https://spenkk.github.io/bugbounty/Configuring-Frida-with-Burp-and-GenyMotion-to-bypass-SSL-Pinning/](https://spenkk.github.io/bugbounty/Configuring-Frida-with-Burp-and-GenyMotion-to-bypass-SSL-Pinning/)
* Tambi√©n puedes intentar **omitir autom√°ticamente SSL Pinning** usando [**objection**](frida-tutorial/objection-tutorial.md)**:** `objection --gadget com.package.app explore --startup-command "android sslpinning disable"`
* Tambi√©n puedes intentar **omitir autom√°ticamente SSL Pinning** usando **MobSF dynamic analysis** (explicado a continuaci√≥n)
* Si todav√≠a crees que hay alg√∫n tr√°fico que no est√°s capturando, puedes intentar **reenviar el tr√°fico a burp usando iptables**. Lee este blog: [https://infosecwriteups.com/bypass-ssl-pinning-with-ip-forwarding-iptables-568171b52b62](https://infosecwriteups.com/bypass-ssl-pinning-with-ip-forwarding-iptables-568171b52b62)

**Vulnerabilidades web comunes**

Ten en cuenta que en este paso debes buscar vulnerabilidades web comunes. Se puede encontrar mucha informaci√≥n sobre vulnerabilidades web en este libro, as√≠ que no las mencionar√© aqu√≠.

### Frida

Herramienta de instrumentaci√≥n din√°mica para desarrolladores, ingenieros inversos e investigadores de seguridad. Obt√©n m√°s informaci√≥n en [www.frida.re](https://www.frida.re).\
**Es incre√≠ble, puedes acceder a la aplicaci√≥n en ejecuci√≥n y enganchar m√©todos en tiempo de ejecuci√≥n para cambiar el comportamiento, cambiar valores, extraer valores, ejecutar c√≥digo diferente...**\
**Si quieres hacer pentesting de aplicaciones de Android, debes saber c√≥mo usar Frida.**

**Aprende a usar Frida:** [**Tutorial de Frida**](fr
```
docker pull opensecurity/mobile-security-framework-mobsf
docker run -it -p 8000:8000 opensecurity/mobile-security-framework-mobsf:latest
```
Ten en cuenta que MobSF puede analizar aplicaciones de **Android** (apk), **IOS** (ipa) y **Windows** (apx) (las aplicaciones de Windows deben ser analizadas desde un MobSF instalado en un host de Windows).\
Adem√°s, si creas un archivo **ZIP** con el c√≥digo fuente de una aplicaci√≥n de **Android** o **IOS** (ve a la carpeta ra√≠z de la aplicaci√≥n, selecciona todo y crea un archivo ZIP), tambi√©n podr√°s analizarlo.

MobSF tambi√©n te permite comparar an√°lisis y integrar VirusTotal (necesitar√°s configurar tu clave API en _MobSF/settings.py_ y habilitarlo: `VT_ENABLED = TRUE` `VT_API_KEY = <Tu clave API>` `VT_UPLOAD = TRUE`). Tambi√©n puedes establecer `VT_UPLOAD` en `False`, entonces el hash ser√° cargado en lugar del archivo.

### An√°lisis din√°mico asistido con MobSF

MobSF tambi√©n puede ser muy √∫til para el an√°lisis din√°mico en Android, pero en ese caso necesitar√°s instalar MobSF y genymotion en tu host (una VM o Docker no funcionar√°). _Nota: Necesitas iniciar primero una VM en genymotion y luego MobSF._\
El analizador din√°mico de MobSF puede:

* **Volcar datos de la aplicaci√≥n** (URLs, registros, portapapeles, capturas de pantalla realizadas por ti, capturas de pantalla realizadas por "**Exported Activity Tester**", correos electr√≥nicos, bases de datos SQLite, archivos XML y otros archivos creados). Todo esto se hace autom√°ticamente excepto las capturas de pantalla, debes presionar cuando quieras una captura de pantalla o debes presionar "**Exported Activity Tester**" para obtener capturas de pantalla de todas las actividades exportadas.
* Capturar **tr√°fico HTTPS**
* Usar **Frida** para obtener **informaci√≥n en tiempo de ejecuci√≥n**

A partir de las versiones de Android > 5, iniciar√° autom√°ticamente Frida y establecer√° la configuraci√≥n global del **proxy** para capturar el tr√°fico. Solo capturar√° el tr√°fico de la aplicaci√≥n probada.

**Frida**

Por defecto, tambi√©n usar√° algunos scripts de Frida para **omitir la validaci√≥n SSL**, **detecci√≥n de root** y **detecci√≥n de depurador** y para **monitorear APIs interesantes**.\
MobSF tambi√©n puede **invocar actividades exportadas**, capturar **capturas de pantalla** de ellas y **guardarlas** para el informe.

Para **iniciar** las pruebas din√°micas, presiona el bot√≥n verde: "**Start Instrumentation**". Presiona "**Frida Live Logs**" para ver los registros generados por los scripts de Frida y "**Live API Monitor**" para ver todas las invocaciones a los m√©todos enganchados, los argumentos pasados y los valores devueltos (esto aparecer√° despu√©s de presionar "Start Instrumentation").\
MobSF tambi√©n te permite cargar tus propios scripts de Frida (para enviar los resultados de tus scripts de Friday a MobSF, usa la funci√≥n `send()`). Tambi√©n tiene **varios scripts preescritos** que puedes cargar (puedes agregar m√°s en `MobSF/DynamicAnalyzer/tools/frida_scripts/others/`), solo **selecciona** uno, presiona "**Load**" y presiona "**Start Instrumentation**" (podr√°s ver los registros de esos scripts dentro de "**Frida Live Logs**").

![](<../../.gitbook/assets/image (215).png>)

Adem√°s, tienes algunas funcionalidades auxiliares de Frida:

* **Enumerate Loaded Classes**: Imprimir√° todas las clases cargadas
* **Capture Strings**: Imprimir√° todas las cadenas capturadas mientras se usa la aplicaci√≥n (muy ruidoso)
* **Capture String Comparisons**: Podr√≠a ser muy √∫til. Mostrar√° las 2 cadenas que se est√°n comparando y si el resultado fue verdadero o falso.
* **Enumerate Class Methods**: Pon el nombre de la clase (como "java.io.File") y se imprimir√°n todos los m√©todos de la clase.
* **Search Class Pattern**: Buscar clases por patr√≥n
* **Trace Class Methods**: **Rastrear** una **clase completa** (ver entradas y salidas de todos los m√©todos de la clase). Recuerda que por defecto MobSF rastrea varios m√©todos interesantes de Android Api.

Una vez que hayas seleccionado el m√≥dulo auxiliar que deseas usar, debes presionar "**Start Intrumentation**" y ver√°s todas las salidas en "**Frida Live Logs**".

**Shell**

Mobsf tambi√©n te ofrece una shell con algunos comandos **adb**, comandos **MobSF** y comandos **shell** comunes en la parte inferior de la p√°gina de an√°lisis din√°mico. Algunos comandos interesantes:
```
help
shell ls
activities
exported_activities
services
receivers
```
**Herramientas HTTP**

Cuando se captura el tr√°fico http, se puede ver una vista poco atractiva del tr√°fico capturado en la parte inferior de "**HTTP(S) Traffic**" o una vista m√°s agradable en el bot√≥n verde "**Start HTTPTools**". Desde la segunda opci√≥n, se pueden **enviar** las **solicitudes capturadas** a **proxies** como Burp o Owasp ZAP.\
Para hacerlo, _encienda Burp -->_ _apague Intercept --> en MobSB HTTPTools seleccione la solicitud_ --> presione "**Send to Fuzzer**" --> _seleccione la direcci√≥n del proxy_ ([http://127.0.0.1:8080\\](http://127.0.0.1:8080)).

Una vez que haya terminado el an√°lisis din√°mico con MobSF, puede presionar "**Start Web API Fuzzer**" para **fuzzear solicitudes http** y buscar vulnerabilidades.

{% hint style="info" %}
Despu√©s de realizar un an√°lisis din√°mico con MobSF, la configuraci√≥n del proxy puede estar mal configurada y no se podr√° solucionar desde la GUI. Puede solucionar la configuraci√≥n del proxy haciendo:
```
adb shell settings put global http_proxy :0
```
{% endhint %}

### An√°lisis Din√°mico Asistido con Inspeckage

Puedes obtener la herramienta de [**Inspeckage**](https://github.com/ac-pm/Inspeckage).\
Esta herramienta utiliza algunos **Hooks** para informarte **qu√© est√° sucediendo en la aplicaci√≥n** mientras realizas un **an√°lisis din√°mico**.

{% content-ref url="inspeckage-tutorial.md" %}
[inspeckage-tutorial.md](inspeckage-tutorial.md)
{% endcontent-ref %}

### [Yaazhini](https://www.vegabird.com/yaazhini/)

Esta es una **gran herramienta para realizar an√°lisis est√°tico con una GUI**

![](<../../.gitbook/assets/image (527).png>)

### [Qark](https://github.com/linkedin/qark)

Esta herramienta est√° dise√±ada para buscar varias **vulnerabilidades de seguridad relacionadas con aplicaciones de Android**, ya sea en **c√≥digo fuente** o en **APK empaquetados**. La herramienta tambi√©n es **capaz de crear un APK desplegable de "Prueba de Concepto"** y **comandos ADB**, para explotar algunas de las vulnerabilidades encontradas (actividades expuestas, intenciones, tapjacking...). Al igual que con Drozer, no es necesario rootear el dispositivo de prueba.
```bash
pip3 install --user qark  # --user is only needed if not using a virtualenv
qark --apk path/to/my.apk
qark --java path/to/parent/java/folder
qark --java path/to/specific/java/file.java
```
### [**ReverseAPK**](https://github.com/1N3/ReverseAPK.git)

* Muestra todos los archivos extra√≠dos para una f√°cil referencia
* Descompila autom√°ticamente los archivos APK al formato Java y Smali
* Analiza AndroidManifest.xml en busca de vulnerabilidades y comportamientos comunes
* An√°lisis est√°tico del c√≥digo fuente en busca de vulnerabilidades y comportamientos comunes
  * Informaci√≥n del dispositivo
  * Intenciones
  * Ejecuci√≥n de comandos
  * Referencias SQLite
  * Referencias de registro
  * Proveedores de contenido
  * Receptores de difusi√≥n
  * Referencias de servicio
  * Referencias de archivo
  * Referencias de criptograf√≠a
  * Secretos codificados
  * URL's
  * Conexiones de red
  * Referencias SSL
  * Referencias de WebView
```
reverse-apk relative/path/to/APP.apk
```
### [SUPER Android Analyzer](https://github.com/SUPERAndroidAnalyzer/super)

SUPER es una aplicaci√≥n de l√≠nea de comandos que se puede utilizar en Windows, MacOS X y Linux, que analiza archivos _.apk_ en busca de vulnerabilidades. Lo hace descomprimiendo los APK y aplicando una serie de reglas para detectar esas vulnerabilidades.

Todas las reglas se centran en un archivo `rules.json`, y cada empresa o probador podr√≠a crear sus propias reglas para analizar lo que necesitan.

Descargue los √∫ltimos binarios en la [p√°gina de descarga](https://superanalyzer.rocks/download.html)
```
super-analyzer {apk_file}
```
### [StaCoAn](https://github.com/vincentcox/StaCoAn)

![](<../../.gitbook/assets/image (62).png>)

StaCoAn es una herramienta **multiplataforma** que ayuda a desarrolladores, cazadores de errores y hackers √©ticos a realizar an√°lisis de c√≥digo est√°tico en aplicaciones m√≥viles\*.

El concepto es que arrastres y sueltes el archivo de tu aplicaci√≥n m√≥vil (un archivo .apk o .ipa) en la aplicaci√≥n StaCoAn y generar√° un informe visual y port√°til para ti. Puedes ajustar la configuraci√≥n y las listas de palabras para obtener una experiencia personalizada.

Descarga la [√∫ltima versi√≥n](https://github.com/vincentcox/StaCoAn/releases):
```
./stacoan
```
### [AndroBugs](https://github.com/AndroBugs/AndroBugs\_Framework)

AndroBugs Framework es un sistema de an√°lisis de vulnerabilidades de Android que ayuda a desarrolladores o hackers a encontrar posibles vulnerabilidades de seguridad en aplicaciones de Android.\
[Versiones para Windows](https://github.com/AndroBugs/AndroBugs\_Framework/releases)
```
python androbugs.py -f [APK file]
androbugs.exe -f [APK file]
```
### [Androwarn](https://github.com/maaaaz/androwarn)

**Androwarn** es una herramienta cuyo objetivo principal es detectar y advertir al usuario sobre posibles comportamientos maliciosos desarrollados por una aplicaci√≥n de Android.

La detecci√≥n se realiza con el **an√°lisis est√°tico** del bytecode Dalvik de la aplicaci√≥n, representado como **Smali**, con la biblioteca [`androguard`](https://github.com/androguard/androguard).

Esta herramienta busca **comportamientos comunes de aplicaciones "malas"** como: exfiltraci√≥n de identificadores de telefon√≠a, interceptaci√≥n de flujo de audio/video, modificaci√≥n de datos PIM, ejecuci√≥n de c√≥digo arbitrario...
```
python androwarn.py -i my_application_to_be_analyzed.apk -r html -v 3
```
### [MARA Framework](https://github.com/xtiankisutsa/MARA\_Framework)

![](<../../.gitbook/assets/image (81).png>)

**MARA** es un **F**ramework de **R**everse **E**ngineering y **A**n√°lisis de **A**plicaciones **M**√≥viles. Es una herramienta que re√∫ne herramientas com√∫nmente utilizadas para el reverse engineering y an√°lisis de aplicaciones m√≥viles, para ayudar en la prueba de aplicaciones m√≥viles contra las amenazas de seguridad m√≥vil de OWASP. Su objetivo es hacer que esta tarea sea m√°s f√°cil y amigable para los desarrolladores de aplicaciones m√≥viles y profesionales de seguridad.

Es capaz de:

* Extraer c√≥digo Java y Smali usando diferentes herramientas
* Analizar APKs usando: [smalisca](https://github.com/dorneanu/smalisca), [ClassyShark](https://github.com/google/android-classyshark), [androbugs](https://github.com/AndroBugs/AndroBugs\_Framework), [androwarn](https://github.com/maaaaz/androwarn), [APKiD](https://github.com/rednaga/APKiD)
* Extraer informaci√≥n privada del APK usando regexps.
* Analizar el Manifest.
* Analizar los dominios encontrados usando: [pyssltest](https://github.com/moheshmohan/pyssltest), [testssl](https://github.com/drwetter/testssl.sh) y [whatweb](https://github.com/urbanadventurer/WhatWeb)
* Desofuscar APK a trav√©s de [apk-deguard.com](http://www.apk-deguard.com)

### Koodous

√ötil para detectar malware: [https://koodous.com/](https://koodous.com)

<figure><img src="../../.gitbook/assets/image (7) (2).png" alt=""><figcaption></figcaption></figure>

[**Sigue a HackenProof**](https://bit.ly/3xrrDrL) **para aprender m√°s sobre errores web3**

üêû Lee tutoriales de errores web3

üîî Recibe notificaciones sobre nuevos programas de recompensas por errores

üí¨ Participa en discusiones comunitarias

## Ofuscando/Desofuscando c√≥digo

Tenga en cuenta que dependiendo del servicio y la configuraci√≥n que utilice para ofuscar el c√≥digo. Los secretos pueden o no terminar ofuscados.

### [ProGuard](https://en.wikipedia.org/wiki/ProGuard\_\(software\))

**ProGuard** es una herramienta de l√≠nea de comandos de c√≥digo abierto que reduce, optimiza y ofusca el c√≥digo Java. Es capaz de optimizar el bytecode y detectar y eliminar instrucciones no utilizadas. ProGuard es software libre y se distribuye bajo la Licencia P√∫blica General de GNU, versi√≥n 2.

ProGuard se distribuye como parte del SDK de Android y se ejecuta al compilar la aplicaci√≥n en modo de lanzamiento.

De: [https://en.wikipedia.org/wiki/ProGuard\_(software)](https://en.wikipedia.org/wiki/ProGuard\_\(software\))

### [DexGuard](https://www.guardsquare.com/dexguard)

Encuentra una gu√≠a paso a paso para desofuscar el apk en [https://blog.lexfo.fr/dexguard.html](https://blog.lexfo.fr/dexguard.html)

(De esa gu√≠a) La √∫ltima vez que comprobamos, el modo de operaci√≥n de Dexguard era:

* cargar un recurso como un InputStream;
* alimentar el resultado a una clase que hereda de FilterInputStream para descifrarlo;
* hacer alguna ofuscaci√≥n in√∫til para perder unos minutos de tiempo de un reversor;
* alimentar el resultado descifrado a un ZipInputStream para obtener un archivo DEX;
* finalmente cargar el DEX resultante como un recurso usando el m√©todo `loadDex`.

### [DeGuard](http://apk-deguard.com)

**DeGuard invierte el proceso de ofuscaci√≥n realizado por las herramientas de ofuscaci√≥n de Android. Esto permite numerosos an√°lisis de seguridad, incluyendo la inspecci√≥n de c√≥digo y la predicci√≥n de bibliotecas.**

Puede cargar un APK ofuscado en su plataforma.

### [Simplify](https://github.com/CalebFenton/simplify)

Es un **desofuscador gen√©rico de Android.** Simplify **ejecuta virtualmente una aplicaci√≥n** para entender su comportamiento y luego **trata de optimizar el c√≥digo** para que se comporte de manera id√©ntica pero sea m√°s f√°cil de entender para un humano. Cada tipo de optimizaci√≥n es simple y gen√©rico, por lo que no importa el tipo espec√≠fico de ofuscaci√≥n que se utilice.

### [APKiD](https://github.com/rednaga/APKiD)

APKiD te da informaci√≥n sobre **c√≥mo se hizo un APK**. Identifica muchos **compiladores**, **empaquetadores**, **ofuscadores** y otras cosas raras. Es [_PEiD_](https://www.aldeid.com/wiki/PEiD) para Android.

### Manual

[Lea este tutorial para aprender algunos trucos sobre **c√≥mo revertir la ofuscaci√≥n personalizada**](manual-deobfuscation.md)

## Laboratorios

### [Androl4b](https://github.com/sh4hin/Androl4b)

AndroL4b es una m√°quina virtual de seguridad de Android basada en ubuntu-mate que incluye la colecci√≥n de los √∫ltimos marcos, tutoriales y laboratorios de diferentes geeks y investigadores de seguridad para el reverse engineering y an√°lisis de malware.

### OWASP

{% embed url="https://github.com/OWASP/owasp-mstg%0Ahttps://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06g-testing-network-communication" %}

### Repositorios de Git

[https://github.com/riddhi-shree/nullCommunity/tree/master/Android](https://github.com/riddhi-shree/nullCommunity/tree/master/Android)\
[https://www.youtube.com/watch?v=PMKnPaGWxtg\&feature=youtu.be\&ab\_channel=B3nacSec](https://www.youtube.com/watch?v=PMKnPaGWxtg\&feature=youtu.be\&ab\_channel=B3nacSec)

## Referencias

Para obtener m√°s informaci√≥n, visite:

* [https://appsecwiki.com/#/](https://appsecwiki.com/#/) Es una gran lista de recursos
* [https://maddiestone.github.io/AndroidAppRE/](https://maddiestone.github.io/AndroidAppRE/) Curso r√°pido de Android
* [https://manifestsecurity.com/android-application-security/](https://manifestsecurity.com/android-application-security/)
* [https://github.com/Ralireza/Android-Security-Teryaagh](https://github.com/Ralireza/Android-Security-Teryaagh)

## Para probar

* [https://www.vegabird.com/yaazhini/](https://www.vegabird.com/yaazhini/)
* [https://github.com/abhi-r3v0/Adhrit](https://github.com/abhi-r3v0/Adhrit)

<figure><img src="../../.gitbook/assets/image (7) (2).png" alt=""><figcaption></figcaption></figure>

[**Sigue a HackenProof**](https://bit.ly/3xrrDrL) **para aprender m√°s sobre errores web3**

üêû Lee tutoriales de errores web3

üîî Recibe notificaciones sobre nuevos programas de recompensas por errores

üí¨ Participa en discusiones comunitarias

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* ¬øTrabajas en una **empresa de ciberseguridad**? ¬øQuieres ver tu **empresa anunciada en HackTricks**? ¬øo quieres tener acceso a la **√∫ltima versi√≥n del PEASS o descargar HackTricks en PDF**? ¬°Consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Descubre [**The PEASS Family**](https://opensea.io
