# Pentesting de Aplicaciones Android

<details>

<summary><strong>Aprende a hackear AWS de cero a h칠roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Experto en Equipos Rojos de AWS de HackTricks)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si deseas ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** 춰Consulta los [**PLANES DE SUSCRIPCI칍N**](https://github.com/sponsors/carlospolop)!
* Obt칠n la [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci칩n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s칤gueme** en **Twitter** 游냕 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

칔nete al servidor de [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) para comunicarte con hackers experimentados y cazadores de recompensas por errores.

**Perspectivas de Hacking**\
Invol칰crate con contenido que profundiza en la emoci칩n y desaf칤os del hacking.

**Noticias de Hacking en Tiempo Real**\
Mantente actualizado con el mundo del hacking a trav칠s de noticias e informaci칩n en tiempo real.

**칔ltimos Anuncios**\
Mantente informado sobre los nuevos programas de recompensas por errores y actualizaciones importantes de plataformas.

**칔nete a nosotros en** [**Discord**](https://discord.com/invite/N3FrSbmwdy) y comienza a colaborar con los mejores hackers hoy mismo!

## Conceptos B치sicos de Aplicaciones Android

Se recomienda encarecidamente comenzar leyendo esta p치gina para conocer las **partes m치s importantes relacionadas con la seguridad de Android y los componentes m치s peligrosos en una aplicaci칩n de Android**:

{% content-ref url="android-applications-basics.md" %}
[android-applications-basics.md](android-applications-basics.md)
{% endcontent-ref %}

## ADB (Android Debug Bridge)

Esta es la herramienta principal que necesitas para conectarte a un dispositivo Android (emulado o f칤sico).\
Te permite controlar tu dispositivo a trav칠s de **USB** o **Red** desde un ordenador, **copiar** archivos de ida y vuelta, **instalar** y desinstalar aplicaciones, ejecutar comandos de **shell**, realizar **copias de seguridad**, leer **registros** y m치s.

Echa un vistazo a la siguiente lista de [**Comandos ADB**](adb-commands.md) para aprender c칩mo usar adb.

## Smali

A veces es interesante **modificar el c칩digo de la aplicaci칩n** para acceder a **informaci칩n oculta** (quiz치s contrase침as bien ofuscadas o banderas). Entonces, podr칤a ser interesante decompilar el apk, modificar el c칩digo y recompilarlo.\
[**En este tutorial** puedes **aprender c칩mo decompilar un APK, modificar el c칩digo Smali y recompilar el APK** con la nueva funcionalidad](smali-changes.md). Esto podr칤a ser muy 칰til como una **alternativa para varias pruebas durante el an치lisis din치mico** que se van a presentar. Entonces, **siempre ten en cuenta esta posibilidad**.

## Otros trucos interesantes

* [Falsificar tu ubicaci칩n en Play Store](spoofing-your-location-in-play-store.md)
* **Descargar APKs**: [https://apps.evozi.com/apk-downloader/](https://apps.evozi.com/apk-downloader/), [https://apkpure.com/es/](https://apkpure.com/es/), [https://www.apkmirror.com/](https://www.apkmirror.com), [https://apkcombo.com/es-es/apk-downloader/](https://apkcombo.com/es-es/apk-downloader/)
* Extraer APK del dispositivo:
```bash
adb shell pm list packages
com.android.insecurebankv2

adb shell pm path com.android.insecurebankv2
package:/data/app/com.android.insecurebankv2-Jnf8pNgwy3QA_U5f-n_4jQ==/base.apk

adb pull /data/app/com.android.insecurebankv2- Jnf8pNgwy3QA_U5f-n_4jQ==/base.apk
```
## An치lisis Est치tico

En primer lugar, para analizar un APK debes **echar un vistazo al c칩digo Java** utilizando un decompilador.\
Por favor, [**lee aqu칤 para encontrar informaci칩n sobre los diferentes decompiladores disponibles**](apk-decompilers.md).

### Buscando informaci칩n interesante

Simplemente echando un vistazo a las **cadenas de texto** del APK puedes buscar **contrase침as**, **URLs** ([https://github.com/ndelphit/apkurlgrep](https://github.com/ndelphit/apkurlgrep)), claves de **API**, **encriptaci칩n**, **UUIDs de Bluetooth**, **tokens** y cualquier otra cosa interesante... busca incluso por **puertas traseras** de ejecuci칩n de c칩digo o puertas traseras de autenticaci칩n (credenciales de administrador codificadas en la aplicaci칩n).

**Firebase**

Presta especial atenci칩n a las **URLs de Firebase** y verifica si est치 mal configurado. [M치s informaci칩n sobre qu칠 es Firebase y c칩mo explotarlo aqu칤.](../../network-services-pentesting/pentesting-web/buckets/firebase-database.md)

### Comprensi칩n b치sica de la aplicaci칩n - Manifest.xml, strings.xml

Utilizando cualquiera de los **decompiladores** mencionados [**aqu칤**](apk-decompilers.md) podr치s leer el _Manifest.xml_. Tambi칠n puedes **renombrar** el archivo **apk** cambiando la extensi칩n a **.zip** y **descomprimi칠ndolo**.\
Al leer el **manifiesto** puedes encontrar **vulnerabilidades**:

* En primer lugar, verifica si **la aplicaci칩n es depurable**. Un APK de producci칩n no deber칤a serlo (de lo contrario, otros podr치n conectarse a 칠l). Puedes verificar si una aplicaci칩n es depurable buscando en el manifiesto el atributo `debuggable="true"` dentro de la etiqueta _\<application_ Ejemplo: `<application theme="@2131296387" debuggable="true"`
* [Aprende aqu칤](drozer-tutorial/#is-debuggeable) c칩mo encontrar aplicaciones depurables en un tel칠fono y explotarlas
* **Copia de seguridad**: El atributo **`android:allowBackup`** define si los datos de la aplicaci칩n pueden ser respaldados y restaurados por un usuario que haya habilitado la depuraci칩n por USB. Si la bandera de copia de seguridad est치 configurada como verdadera, permite a un atacante hacer una copia de seguridad de los datos de la aplicaci칩n a trav칠s de adb incluso si el dispositivo no est치 rooteado. Por lo tanto, las aplicaciones que manejan y almacenan informaci칩n sensible como detalles de tarjetas, contrase침as, etc. deben tener esta configuraci칩n expl칤citamente establecida como **falsa** porque por defecto est치 configurada como **verdadera** para prevenir tales riesgos.
* `<application android:allowBackup="false"`
* **Seguridad de red:** La seguridad de red de la aplicaci칩n puede sobrescribir los valores predeterminados con **`android:networkSecurityConfig="@xml/network_security_config"`**. Se puede colocar un archivo con ese nombre en _**res/xml.**_ Este archivo configurar치 ajustes de seguridad importantes como pines de certificados o si permite tr치fico HTTP. Puedes leer aqu칤 m치s informaci칩n sobre todas las cosas que se pueden configurar, pero revisa este ejemplo sobre c칩mo configurar el tr치fico HTTP para algunos dominios:
* `<domain-config cleartextTrafficPermitted="true"> <domain includeSubdomains="true">formation-software.co.uk </domain></domain-config>`
* **Actividades exportadas**: Verifica las actividades exportadas dentro del manifiesto, ya que esto podr칤a ser peligroso. M치s adelante en el an치lisis din치mico se explicar치 c칩mo [puedes abusar de este comportamiento](./#exploiting-exported-activities-authorisation-bypass).
* **Proveedores de contenido**: Si se expone un proveedor exportado, podr칤as acceder/modificar informaci칩n interesante. En el an치lisis din치mico [aprender치s c칩mo abusar de ellos](./#exploiting-content-providers-accessing-and-manipulating-sensitive-information).
* Verifica las configuraciones de **FileProviders** dentro del atributo `android:name="android.support.FILE_PROVIDER_PATHS"`. [Lee aqu칤 para aprender m치s sobre FileProviders](./#fileprovider).
* **Servicios expuestos**: Dependiendo de lo que haga internamente el servicio, podr칤an explotarse vulnerabilidades. En el an치lisis din치mico [aprender치s c칩mo abusar de ellos](./#exploiting-services).
* **Receptores de difusi칩n**: [Aprender치s c칩mo posiblemente explotarlos](./#exploiting-broadcast-receivers) durante el an치lisis din치mico.
* **Esquema de URL**: Lee el c칩digo de la actividad que maneja el esquema y busca vulnerabilidades en la gesti칩n de la entrada del usuario. M치s informaci칩n sobre [qu칠 es un esquema de URL aqu칤](./#url-schemes).
* **minSdkVersion**, **targetSDKVersion**, **maxSdkVersion**: Indican las versiones de Android en las que se ejecutar치 la aplicaci칩n. Es importante tenerlos en cuenta porque desde una perspectiva de seguridad, admitir versiones antiguas permitir치 que se ejecuten versiones vulnerables conocidas de Android.

Al leer **resources.arsc/strings.xml** puedes encontrar alguna **informaci칩n interesante**:

* Claves de API
* Esquemas personalizados
* Otra informaci칩n interesante que los desarrolladores guardan en este archivo

### Tapjacking

**Tapjacking** es un ataque donde una **aplicaci칩n maliciosa** se lanza y **se posiciona sobre una aplicaci칩n v칤ctima**. Una vez que oculta visualmente la aplicaci칩n v칤ctima, su interfaz de usuario est치 dise침ada de tal manera que enga침a al usuario para que interact칰e con ella, mientras pasa la interacci칩n a la aplicaci칩n v칤ctima.\
En efecto, **ciega al usuario para que no sepa que en realidad est치 realizando acciones en la aplicaci칩n v칤ctima**.

Encuentra m치s informaci칩n en:

{% content-ref url="tapjacking.md" %}
[tapjacking.md](tapjacking.md)
{% endcontent-ref %}

### Secuestro de tareas

Una **actividad** con el **`launchMode`** configurado como **`singleTask` sin ninguna `taskAffinity`** definida es vulnerable al secuestro de tareas. Esto significa que una **aplicaci칩n** puede ser instalada y si se lanza antes que la aplicaci칩n real, podr칤a **secuestrar la tarea de la aplicaci칩n real** (por lo que el usuario estar치 interactuando con la **aplicaci칩n maliciosa pensando que est치 usando la real**).

M치s informaci칩n en:

{% content-ref url="android-task-hijacking.md" %}
[android-task-hijacking.md](android-task-hijacking.md)
{% endcontent-ref %}

### Almacenamiento de datos inseguro

**Almacenamiento interno**

En Android, los archivos **almacenados** en el **almacenamiento interno** est치n **dise침ados** para ser **accesibles** exclusivamente por la **aplicaci칩n** que los **cre칩**. Esta medida de seguridad es **aplicada** por el sistema operativo Android y generalmente es adecuada para las necesidades de seguridad de la mayor칤a de las aplicaciones. Sin embargo, a veces los desarrolladores utilizan modos como `MODE_WORLD_READABLE` y `MODE_WORLD_WRITABLE` para **permitir** que los archivos sean **compartidos** entre diferentes aplicaciones. Sin embargo, estos modos **no restringen el acceso** a estos archivos por otras aplicaciones, incluidas potencialmente maliciosas.

1. **An치lisis est치tico:**
- **Aseg칰rate** de que el uso de `MODE_WORLD_READABLE` y `MODE_WORLD_WRITABLE` sea **escrutado cuidadosamente**. Estos modos **pueden exponer** los archivos a **accesos no deseados o no autorizados**.

2. **An치lisis din치mico:**
- **Verifica** los **permisos** establecidos en los archivos creados por la aplicaci칩n. Espec칤ficamente, **verifica** si alg칰n archivo est치 **configurado para ser legible o escribible a nivel mundial**. Esto puede representar un riesgo de seguridad significativo, ya que permitir칤a que **cualquier aplicaci칩n** instalada en el dispositivo, independientemente de su origen o intenci칩n, **lea o modifique** estos archivos.

**Almacenamiento externo**

### Pautas para gestionar archivos en almacenamiento externo

Al tratar con archivos en el **almacenamiento externo**, como tarjetas SD, se deben tomar ciertas precauciones:

1. **Accesibilidad**:
- Los archivos en el almacenamiento externo son **legibles y escribibles globalmente**. Esto significa que cualquier aplicaci칩n o usuario puede acceder a estos archivos.

2. **Preocupaciones de seguridad**:
- Dada la facilidad de acceso, se recomienda **no almacenar informaci칩n sensible** en el almacenamiento externo.
- El almacenamiento externo puede ser eliminado o accedido por cualquier aplicaci칩n, lo que lo hace menos seguro.

3. **Manejo de datos desde el almacenamiento externo**:
- Siempre **realiza validaci칩n de entrada** en los datos recuperados desde el almacenamiento externo. Esto es crucial porque los datos provienen de una fuente no confiable.
- Almacenar ejecutables o archivos de clase en el almacenamiento externo para carga din치mica est치 fuertemente desaconsejado.
- Si tu aplicaci칩n debe recuperar archivos ejecutables desde el almacenamiento externo, aseg칰rate de que estos archivos est칠n **firmados y verificados criptogr치ficamente** antes de ser cargados din치micamente. Este paso es vital para mantener la integridad de seguridad de tu aplicaci칩n.

El almacenamiento externo puede ser **accedido** en `/storage/emulated/0`, `/sdcard`, `/mnt/sdcard`

{% hint style="info" %}
A partir de Android 4.4 (**API 17**), la tarjeta SD tiene una estructura de directorios que **limita el acceso desde una aplicaci칩n al directorio espec칤ficamente para esa aplicaci칩n**. Esto evita que una aplicaci칩n maliciosa obtenga acceso de lectura o escritura a los archivos de otra aplicaci칩n.
{% endhint %}

**Datos sensibles almacenados en texto claro**

* **Preferencias compartidas**: Android permite a cada aplicaci칩n guardar f치cilmente archivos XML en la ruta `/data/data/<nombrepaquete>/shared_prefs/` y a veces es posible encontrar informaci칩n sensible en texto claro en esa carpeta.
* **Bases de datos**: Android permite a cada aplicaci칩n guardar bases de datos sqlite f치cilmente en la ruta `/data/data/<nombrepaquete>/databases/` y a veces es posible encontrar informaci칩n sensible en texto claro en esa carpeta.

### TLS roto

**Aceptar todos los certificados**

Por alguna raz칩n, a veces los desarrolladores aceptan todos los certificados incluso si, por ejemplo, el nombre de host no coincide con l칤neas de c칩digo como la siguiente:
```java
SSLSocketFactory sf = new cc(trustStore);
sf.setHostnameVerifier(SSLSocketFactory.ALLOW_ALL_HOSTNAME_VERIFIER);
```
### Criptograf칤a Rota

**Procesos de Gesti칩n de Claves Deficientes**

Algunos desarrolladores guardan datos sensibles en el almacenamiento local y los cifran con una clave codificada/predecible en el c칩digo. Esto no deber칤a hacerse, ya que un proceso de reversi칩n podr칤a permitir a los atacantes extraer la informaci칩n confidencial.

**Uso de Algoritmos Inseguros y/o Obsoletos**

Los desarrolladores no deber칤an utilizar algoritmos obsoletos para realizar comprobaciones de autorizaci칩n, almacenar o enviar datos. Algunos de estos algoritmos son: RC4, MD4, MD5, SHA1... Si se utilizan hashes para almacenar contrase침as, por ejemplo, se deben utilizar hashes resistentes a ataques de fuerza bruta con sal.

### Otras comprobaciones

* Se recomienda **ofuscar el APK** para dificultar el trabajo de ingenier칤a inversa a los atacantes.
* Si la aplicaci칩n es sensible (como las aplicaciones bancarias), deber칤a realizar sus propias comprobaciones para ver si el m칩vil est치 rooteado y actuar en consecuencia.
* Si la aplicaci칩n es sensible (como las aplicaciones bancarias), deber칤a comprobar si se est치 utilizando un **emulador**.
* Si la aplicaci칩n es sensible (como las aplicaciones bancarias), deber칤a **verificar su propia integridad antes de ejecutarse** para comprobar si fue modificada.
* Utiliza [**APKiD**](https://github.com/rednaga/APKiD) para verificar qu칠 compilador/empaquetador/ofuscador se utiliz칩 para construir el APK.

### Aplicaci칩n React Native

Lee la siguiente p치gina para aprender c칩mo acceder f치cilmente al c칩digo JavaScript de las aplicaciones React:

{% content-ref url="react-native-application.md" %}
[react-native-application.md](react-native-application.md)
{% endcontent-ref %}

### Aplicaciones Xamarin

Lee la siguiente p치gina para aprender c칩mo acceder f치cilmente al c칩digo C# de las aplicaciones Xamarin:

{% content-ref url="../xamarin-apps.md" %}
[xamarin-apps.md](../xamarin-apps.md)
{% endcontent-ref %}

### Aplicaciones Superpacked

Seg칰n esta [**publicaci칩n de blog**](https://clearbluejar.github.io/posts/desuperpacking-meta-superpacked-apks-with-github-actions/), superpacked es un algoritmo Meta que comprime el contenido de una aplicaci칩n en un solo archivo. El blog habla sobre la posibilidad de crear una aplicaci칩n que descomprima este tipo de aplicaciones... y una forma m치s r치pida que implica **ejecutar la aplicaci칩n y recopilar los archivos descomprimidos del sistema de archivos**.

### An치lisis de C칩digo Est치tico Automatizado

La herramienta [**mariana-trench**](https://github.com/facebook/mariana-trench) es capaz de encontrar **vulnerabilidades** escaneando el **c칩digo** de la aplicaci칩n. Esta herramienta contiene una serie de **fuentes conocidas** (que indican a la herramienta los **lugares** donde la **entrada** est치 **controlada por el usuario**), **sumideros** (que indican a la herramienta **lugares peligrosos** donde la entrada maliciosa del usuario podr칤a causar da침os) y **reglas**. Estas reglas indican la **combinaci칩n** de **fuentes-sumideros** que indica una vulnerabilidad.

Con este conocimiento, **mariana-trench revisar치 el c칩digo y encontrar치 posibles vulnerabilidades en 칠l**.

### Secretos filtrados

Una aplicaci칩n puede contener secretos (claves API, contrase침as, URL ocultas, subdominios...) en su interior que podr칤as descubrir. Puedes usar una herramienta como [https://github.com/dwisiswant0/apkleaks](https://github.com/dwisiswant0/apkleaks)

### Saltar la Autenticaci칩n Biom칠trica

{% content-ref url="bypass-biometric-authentication-android.md" %}
[bypass-biometric-authentication-android.md](bypass-biometric-authentication-android.md)
{% endcontent-ref %}

### Otras funciones interesantes

* **Ejecuci칩n de c칩digo**: `Runtime.exec(), ProcessBuilder(), c칩digo nativo:system()`
* **Enviar SMS**: `sendTextMessage, sendMultipartTestMessage`
* **Funciones nativas** declaradas como `native`: `public native, System.loadLibrary, System.load`
* [Lee esto para aprender **c칩mo revertir funciones nativas**](reversing-native-libraries.md)

### **Otros trucos**

{% content-ref url="content-protocol.md" %}
[content-protocol.md](content-protocol.md)
{% endcontent-ref %}

***

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

칔nete al servidor de [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) para comunicarte con hackers experimentados y cazadores de bugs!

**Perspectivas de Hacking**\
Invol칰crate con contenido que profundiza en la emoci칩n y desaf칤os del hacking

**Noticias de Hacking en Tiempo Real**\
Mantente actualizado con el mundo del hacking a trav칠s de noticias e informaci칩n en tiempo real

**칔ltimos Anuncios**\
Mantente informado sobre los nuevos programas de recompensas por errores que se lanzan y las actualizaciones importantes de la plataforma

**칔nete a nosotros en** [**Discord**](https://discord.com/invite/N3FrSbmwdy) 춰y comienza a colaborar con los mejores hackers hoy!

***

## An치lisis Din치mico

> En primer lugar, necesitas un entorno donde puedas instalar la aplicaci칩n y todo el entorno (certificado Burp CA, Drozer y Frida principalmente). Por lo tanto, se recomienda encarecidamente un dispositivo rooteado (emulado o no).

### An치lisis Din치mico en l칤nea

Puedes crear una **cuenta gratuita** en: [https://appetize.io/](https://appetize.io). Esta plataforma te permite **subir** y **ejecutar** APKs, por lo que es 칰til para ver c칩mo se comporta una APK.

Incluso puedes **ver los registros de tu aplicaci칩n** en la web y conectarte a trav칠s de **adb**.

![](<../../.gitbook/assets/image (60).png>)

Gracias a la conexi칩n ADB, puedes usar **Drozer** y **Frida** dentro de los emuladores.

### An치lisis Din치mico Local

#### Usando un emulador

* [**Android Studio**](https://developer.android.com/studio) (Puedes crear dispositivos **x86** y **arm**, y seg칰n [**esto** ](https://android-developers.googleblog.com/2020/03/run-arm-apps-on-android-emulator.html)las **칰ltimas versiones x86** **soportan bibliotecas ARM** sin necesidad de un emulador ARM lento).
* Aprende a configurarlo en esta p치gina:

{% content-ref url="avd-android-virtual-device.md" %}
[avd-android-virtual-device.md](avd-android-virtual-device.md)
{% endcontent-ref %}

* [**Genymotion**](https://www.genymotion.com/fun-zone/) **(Versi칩n gratuita:** Edici칩n Personal, necesitas crear una cuenta. _Se recomienda **descargar** la versi칩n **CON**_ _**VirtualBox** para evitar posibles errores._)
* [**Nox**](https://es.bignox.com) (Gratis, pero no es compatible con Frida o Drozer).

{% hint style="info" %}
Al crear un nuevo emulador en cualquier plataforma, recuerda que cuanto m치s grande sea la pantalla, m치s lento funcionar치 el emulador. Por lo tanto, selecciona pantallas peque침as si es posible.
{% endhint %}

Para **instalar servicios de Google** (como AppStore) en Genymotion, debes hacer clic en el bot칩n marcado en rojo de la siguiente imagen:

![](<../../.gitbook/assets/image (200) (1).png>)

Adem치s, ten en cuenta que en la **configuraci칩n de la VM de Android en Genymotion** puedes seleccionar el modo **Bridge Network** (esto ser치 칰til si te vas a conectar a la VM de Android desde una VM diferente con las herramientas).

#### Usar un dispositivo f칤sico

Debes activar las opciones de **depuraci칩n** y ser치 genial si puedes **rootearlo**:

1. **Ajustes**.
2. (Desde Android 8.0) Selecciona **Sistema**.
3. Selecciona **Acerca del tel칠fono**.
4. Presiona **N칰mero de compilaci칩n** 7 veces.
5. Vuelve atr치s y encontrar치s las **Opciones de desarrollador**.

> Una vez que hayas instalado la aplicaci칩n, lo primero que debes hacer es probarla e investigar qu칠 hace, c칩mo funciona y familiarizarte con ella.\
> Sugiero **realizar este an치lisis din치mico inicial utilizando el an치lisis din치mico de MobSF + pidcat**, para poder **aprender c칩mo funciona la aplicaci칩n** mientras MobSF **captura** una gran cantidad de **datos interesantes** que puedes revisar m치s adelante.

### Fuga de Datos No Intencionada

**Registro**

A menudo, los desarrolladores dejan informaci칩n de depuraci칩n de forma p칰blica. Por lo tanto, cualquier aplicaci칩n con permiso `READ_LOGS` puede **acceder a esos registros** y obtener informaci칩n sensible a trav칠s de ellos.\
Mientras navegas por la aplicaci칩n, utiliza [**pidcat**](https://github.com/JakeWharton/pidcat)_(Recomendado, es m치s f치cil de usar y leer_) o [adb logcat](adb-commands.md#logcat) para leer los registros creados y **buscar informaci칩n sensible**.

{% hint style="warning" %}
Ten en cuenta que a partir de **versiones posteriores a Android 4.0**, las **aplicaciones solo pueden acceder a sus propios registros**. Por lo tanto, las aplicaciones no pueden acceder a los registros de otras aplicaciones.\
De todos modos, se recomienda **no registrar informaci칩n sensible**.
{% endhint %}

**Almacenamiento en Cach칠 del Portapapeles**

Android proporciona un marco basado en el portapapeles para proporcionar la funci칩n de copiar y pegar en las aplicaciones de Android. Pero esto crea un problema grave cuando alguna **otra aplicaci칩n** puede **acceder** al **portapapeles** que contiene datos sensibles. La funci칩n de **copiar/pegar** deber칤a estar **deshabilitada** para la **parte sensible** de la aplicaci칩n. Por ejemplo, deshabilita la copia de detalles de tarjetas de cr칠dito.

**Registros de Errores**

Si una aplicaci칩n **falla** durante la ejecuci칩n y guarda registros en alg칰n lugar, esos registros pueden ser de ayuda para un atacante, especialmente en casos en los que la aplicaci칩n de Android no se puede revertir. Entonces, evita crear registros cuando las aplicaciones fallan y si los registros se env칤an por la red, aseg칰rate de que se env칤en a trav칠s de un canal SSL.\
Como pentester, **intenta echar un vistazo a estos registros**.

**Datos Anal칤ticos Enviados a Terceros**

La mayor칤a de las aplicaciones utilizan otros servicios en su aplicaci칩n como Google Adsense, pero a veces **filtran algunos datos sensibles** o datos que no es necesario enviar a ese servicio. Esto puede suceder porque el desarrollador no implement칩 la funci칩n correctamente. Puedes **verificando interceptando el tr치fico** de la aplicaci칩n y ver si se env칤an datos sensibles a terceros o no.

### Bases de Datos SQLite

La mayor칤a de las aplicaciones utilizar치n **bases de datos SQLite internas** para guardar informaci칩n. Durante la prueba de penetraci칩n, echa un **vistazo** a las **bases de datos** creadas, los nombres de las **tablas** y las **columnas** y todos los **datos** guardados, ya que podr칤as encontrar **informaci칩n sensible** (lo cual ser칤a una vulnerabilidad).\
Las bases de datos deben estar ubicadas en `/data/data/el.nombre.del.paquete/bases de datos` como `/data/data/com.mwr.example.sieve/bases de datos`

Si la base de datos est치 guardando informaci칩n confidencial y est치 **cifrada** pero puedes **encontrar** la **contrase침a** dentro de la aplicaci칩n, sigue siendo una **vulnerabilidad**.

Enumera las tablas usando `.tables` y enumera las columnas de las tablas haciendo `.schema <nombre_de_la_tabla>`

### Drozer (Actividades de Explotaci칩n, Proveedores de Contenido y Servicios)

**Drozer** te permite **asumir el rol de una aplicaci칩n de Android** e interactuar con otras aplicaciones. Puede hacer **cualquier cosa que una aplicaci칩n instalada pueda hacer**, como hacer uso del mecanismo de Comunicaci칩n entre Procesos (IPC) de Android e interactuar con el sistema operativo subyacente. De [Gu칤a de Drozer](https://labs.mwrinfosecurity.com/assets/BlogFiles/mwri-drozer-user-guide-2015-03-23.pdf).\
Drozer es una herramienta 칰til para **explotar actividades exportadas, servicios exportados y Proveedores de Contenido**, como aprender치s en las siguientes secciones.

### Explotando Actividades Exportadas

[**Lee esto si quieres recordar qu칠 es una Actividad de Android.**](android-applications-basics.md#launcher-activity-and-other-activities)\
Recuerda que el c칩digo de una actividad comienza con el m칠todo `onCreate`.

**Bypass de Autorizaci칩n**

Cuando una Actividad est치 exportada, puedes invocar su pantalla desde una aplicaci칩n externa. Por lo tanto, si una actividad con **informaci칩n sensible** est치 **exportada**, podr칤as **burlar** los **mecanismos de autenticaci칩n** para acceder a ella.\
[Aprende c칩mo explotar actividades exportadas con Drozer.](drozer-tutorial/#activities)

Tambi칠n puedes iniciar una actividad exportada desde adb:

* El nombre del paquete es com.example.demo
* El nombre de la Actividad Exportada es com.example.test.MainActivity
```bash
adb shell am start -n com.example.demo/com.example.test.MainActivity
```
**NOTA**: MobSF detectar치 como malicioso el uso de _**singleTask/singleInstance**_ como `android:launchMode` en una actividad, pero debido a [esto](https://github.com/MobSF/Mobile-Security-Framework-MobSF/pull/750), aparentemente esto solo es peligroso en versiones antiguas (versiones de API < 21).

{% hint style="info" %}
Ten en cuenta que una omisi칩n de autorizaci칩n no siempre es una vulnerabilidad, depender치 de c칩mo funcione la omisi칩n y qu칠 informaci칩n se exponga.
{% endhint %}

**Fuga de informaci칩n sensible**

**Las actividades tambi칠n pueden devolver resultados**. Si logras encontrar una actividad exportada y desprotegida que llame al m칠todo **`setResult`** y **devuelva informaci칩n sensible**, entonces hay una fuga de informaci칩n sensible.

#### Tapjacking

Si no se previene el tapjacking, podr칤as abusar de la actividad exportada para hacer que el **usuario realice acciones inesperadas**. Para obtener m치s informaci칩n sobre [**qu칠 es el Tapjacking sigue el enlace**](./#tapjacking).

### Explotando Proveedores de Contenido - Accediendo y manipulando informaci칩n sensible

[**Lee esto si quieres recordar qu칠 es un Proveedor de Contenido.**](android-applications-basics.md#content-provider)\
Los proveedores de contenido se utilizan b치sicamente para **compartir datos**. Si una aplicaci칩n tiene proveedores de contenido disponibles, es posible que puedas **extraer datos** sensibles de ellos. Tambi칠n es interesante probar posibles **inyecciones SQL** y **traves칤as de rutas** ya que podr칤an ser vulnerables.\
[**Aprende c칩mo explotar Proveedores de Contenido con Drozer.**](drozer-tutorial/#content-providers)

### **Explotando Servicios**

[**Lee esto si quieres recordar qu칠 es un Servicio.**](android-applications-basics.md#services)\
Recuerda que las acciones de un Servicio comienzan en el m칠todo `onStartCommand`.

Un servicio es b치sicamente algo que **puede recibir datos**, **procesarlos** y **devolver** (o no) una respuesta. Entonces, si una aplicaci칩n est치 exportando algunos servicios, debes **verificar** el **c칩digo** para entender qu칠 est치 haciendo y **probarlo** **din치micamente** para extraer informaci칩n confidencial, evadir medidas de autenticaci칩n...\
[**Aprende c칩mo explotar Servicios con Drozer.**](drozer-tutorial/#services)

### **Explotando Receptores de Difusi칩n**

[**Lee esto si quieres recordar qu칠 es un Receptor de Difusi칩n.**](android-applications-basics.md#broadcast-receivers)\
Recuerda que las acciones de un Receptor de Difusi칩n comienzan en el m칠todo `onReceive`.

Un receptor de difusi칩n estar치 esperando un tipo de mensaje. Dependiendo de c칩mo maneje el receptor el mensaje, podr칤a ser vulnerable.\
[**Aprende c칩mo explotar Receptores de Difusi칩n con Drozer.**](./#exploiting-broadcast-receivers)

### **Explotando Esquemas / Enlaces profundos**

Puedes buscar enlaces profundos manualmente, utilizando herramientas como MobSF o scripts como [este](https://github.com/ashleykinguk/FBLinkBuilder/blob/master/FBLinkBuilder.py).\
Puedes **abrir** un **esquema** declarado usando **adb** o un **navegador**:

{% code overflow="wrap" %}
```bash
adb shell am start -a android.intent.action.VIEW -d "scheme://hostname/path?param=value" [your.package.name]
```
{% endcode %}

_Tenga en cuenta que puede **omitir el nombre del paquete** y el m칩vil llamar치 autom치ticamente a la aplicaci칩n que deber칤a abrir ese enlace._

{% code overflow="wrap" %}
```markup
<!-- Browser regular link -->
<a href="scheme://hostname/path?param=value">Click me</a>
<!-- fallback in your url you could try the intent url -->
<a href="intent://hostname#Intent;scheme=scheme;package=your.package.name;S.browser_fallback_url=http%3A%2F%2Fwww.example.com;end">with alternative</a>
```
{% endcode %}

**C칩digo ejecutado**

Para encontrar el **c칩digo que se ejecutar치 en la aplicaci칩n**, ve a la actividad llamada por el enlace profundo y busca la funci칩n **`onNewIntent`**.

![](<../../.gitbook/assets/image (436) (1) (1) (1).png>)

**Informaci칩n sensible**

Cada vez que encuentres un enlace profundo, verifica que **no est칠 recibiendo datos sensibles (como contrase침as) a trav칠s de par치metros de URL**, 춰porque cualquier otra aplicaci칩n podr칤a **hacerse pasar por el enlace profundo y robar esos datos!**

**Par치metros en la ruta**

Debes verificar tambi칠n si alg칰n enlace profundo est치 utilizando un par치metro dentro de la ruta de la URL como: `https://api.example.com/v1/users/{username}`, en ese caso puedes forzar una traves칤a de ruta accediendo a algo como: `example://app/users?username=../../unwanted-endpoint%3fparam=value`.\
Ten en cuenta que si encuentras los endpoints correctos dentro de la aplicaci칩n, podr칤as causar una **Redirecci칩n Abierta** (si parte de la ruta se utiliza como nombre de dominio), **toma de cuenta** (si puedes modificar los detalles de los usuarios sin un token CSRF y el endpoint vulnerable utiliz칩 el m칠todo correcto) y cualquier otra vulnerabilidad. M치s [informaci칩n al respecto aqu칤](http://dphoeniixx.com/2020/12/13-2/).

**M치s ejemplos**

Un [informe interesante de recompensa por errores](https://hackerone.com/reports/855618) sobre enlaces (_/.well-known/assetlinks.json_).

### Protecci칩n Insuficiente de la Capa de Transporte

* **Falta de Inspecci칩n de Certificados:** La aplicaci칩n de Android no verifica la identidad del certificado presentado. La mayor칤a de las aplicaciones ignoran las advertencias y aceptan cualquier certificado autofirmado presentado. Algunas aplicaciones, en cambio, pasan el tr치fico a trav칠s de una conexi칩n HTTP.
* **Negociaci칩n de Handshake D칠bil:** La aplicaci칩n y el servidor realizan un handshake SSL/TLS pero utilizan un conjunto de cifrado inseguro que es vulnerable a ataques MITM. Por lo tanto, cualquier atacante puede descifrar f치cilmente esa conexi칩n.
* **Fuga de Informaci칩n de Privacidad:** Muchas veces sucede que las aplicaciones realizan la autenticaci칩n a trav칠s de un canal seguro pero el resto de la conexi칩n a trav칠s de un canal no seguro. Esto no a침ade seguridad a la aplicaci칩n porque otros datos sensibles como la cookie de sesi칩n o los datos de usuario pueden ser interceptados por un usuario malintencionado.

De los 3 escenarios presentados vamos a discutir **c칩mo verificar la identidad del certificado**. Los otros 2 escenarios dependen de la **configuraci칩n de TLS** del servidor y si la **aplicaci칩n env칤a datos sin cifrar**. El pentester debe verificar por su cuenta la configuraci칩n de TLS del servidor ([aqu칤](../../network-services-pentesting/pentesting-web/#ssl-tls-vulnerabilites)) y detectar si alguna **informaci칩n confidencial se env칤a por un canal no cifrado/vulnerable**.\
M치s informaci칩n sobre c칩mo descubrir y solucionar este tipo de vulnerabilidades [**aqu칤**](https://manifestsecurity.com/android-application-security-part-10/).

**Pinning de SSL**

Por defecto, al realizar una conexi칩n SSL, el cliente (aplicaci칩n de Android) verifica que el certificado del servidor tenga una cadena de confianza verificable hasta un certificado de confianza (ra칤z) y coincida con el nombre de host solicitado. Esto lleva al problema de **Ataques de Hombre en el Medio (MITM)**.\
En el Pinning de certificados, una aplicaci칩n de Android contiene el certificado del servidor y solo transmite datos si se presenta el mismo certificado.\
Se recomienda **aplicar Pinning de SSL** para los sitios donde se va a enviar informaci칩n sensible.

### Inspecci칩n del tr치fico HTTP

En primer lugar, debes (debes) **instalar el certificado** de la **herramienta de proxy** que vas a utilizar, probablemente Burp. Si no instalas el certificado de CA de la herramienta de proxy, es probable que no veas el tr치fico cifrado en el proxy.\
**Por favor,** [**lee esta gu칤a para aprender c칩mo instalar un certificado de CA personalizado**](avd-android-virtual-device.md#install-burp-certificate-on-a-virtual-machine)**.**

Para aplicaciones dirigidas a **API Level 24+ no es suficiente instalar el certificado CA de Burp** en el dispositivo. Para evitar esta nueva protecci칩n, debes modificar el archivo de Configuraci칩n de Seguridad de Red. Por lo tanto, podr칤as modificar este archivo para autorizar tu certificado de CA o puedes [**leer esta p치gina para un tutorial sobre c칩mo forzar a la aplicaci칩n a aceptar nuevamente todos los certificados instalados en el dispositivo**](make-apk-accept-ca-certificate.md).

**Pinning de SSL**

Ya hemos discutido qu칠 es el Pinning de SSL solo 2 p치rrafos antes. Cuando se implementa en una aplicaci칩n, necesitar치s evitarlo para inspeccionar el tr치fico HTTPS o no lo ver치s.\
Aqu칤 voy a presentar algunas opciones que he utilizado para evitar esta protecci칩n:

* Modificar autom치ticamente el **apk** para **evitar** el **Pinning de SSL** con [**apk-mitm**](https://github.com/shroudedcode/apk-mitm). El mayor beneficio de esta opci칩n es que no necesitar치s acceso root para evitar el Pinning de SSL, pero deber치s eliminar la aplicaci칩n y reinstalar la nueva, y esto no siempre funcionar치.
* Puedes usar **Frida** (discutido a continuaci칩n) para evitar esta protecci칩n. Aqu칤 tienes una gu칤a para usar Burp+Frida+Genymotion: [https://spenkk.github.io/bugbounty/Configuring-Frida-with-Burp-and-GenyMotion-to-bypass-SSL-Pinning/](https://spenkk.github.io/bugbounty/Configuring-Frida-with-Burp-and-GenyMotion-to-bypass-SSL-Pinning/)
* Tambi칠n puedes intentar **evitar autom치ticamente el Pinning de SSL** usando [**objection**](frida-tutorial/objection-tutorial.md)**:** `objection --gadget com.package.app explore --startup-command "android sslpinning disable"`
* Tambi칠n puedes intentar **evitar autom치ticamente el Pinning de SSL** usando **an치lisis din치mico de MobSF** (explicado a continuaci칩n)
* Si a칰n crees que hay alg칰n tr치fico que no est치s capturando, puedes intentar **redirigir el tr치fico a burp usando iptables**. Lee este blog: [https://infosecwriteups.com/bypass-ssl-pinning-with-ip-forwarding-iptables-568171b52b62](https://infosecwriteups.com/bypass-ssl-pinning-with-ip-forwarding-iptables-568171b52b62)

**Vulnerabilidades Web comunes**

Ten en cuenta que en este paso debes buscar vulnerabilidades web comunes. Se puede encontrar mucha informaci칩n sobre vulnerabilidades web en este libro, por lo que no las mencionar칠 aqu칤.

### Frida

Herramienta de instrumentaci칩n din치mica para desarrolladores, ingenieros inversos e investigadores de seguridad. Obt칠n m치s informaci칩n en [www.frida.re](https://www.frida.re).\
**Es incre칤ble, puedes acceder a la aplicaci칩n en ejecuci칩n y enganchar m칠todos en tiempo de ejecuci칩n para cambiar el comportamiento, cambiar valores, extraer valores, ejecutar c칩digo diferente...**\
**Si quieres hacer pentesting de aplicaciones de Android, necesitas saber c칩mo usar Frida.**

**Aprende a usar Frida:** [**Tutorial de Frida**](frida-tutorial/)\
**Algunas "GUI" para acciones con Frida:** [**https://github.com/m0bilesecurity/RMS-Runtime-Mobile-Security**](https://github.com/m0bilesecurity/RMS-Runtime-Mobile-Security)\
**Algunas otras abstracciones basadas en Frida:** [**https://github.com/sensepost/objection**](https://github.com/sensepost/objection) **,** [**https://github.com/dpnishant/appmon**](https://github.com/dpnishant/appmon)\
**Puedes encontrar algunos scripts incre칤bles de Frida aqu칤:** [**https://codeshare.frida.re/**](https://codeshare.frida.re)

### **Volcado de Memoria - Fridump**

Verifica si la aplicaci칩n est치 almacenando informaci칩n sensible en la memoria que no deber칤a estar almacenando como contrase침as o mnem칩nicos.

Usando [**Fridump3**](https://github.com/rootbsd/fridump3) puedes volcar la memoria de la aplicaci칩n con:
```bash
# With PID
python3 fridump3.py -u <PID>

# With name
frida-ps -Uai
python3 fridump3.py -u "<Name>"
```
Esto volcar치 la memoria en la carpeta ./dump, y all칤 podr칤as buscar con algo como:

{% code overflow="wrap" %}
```bash
strings * | grep -E "^[a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+$"
```
{% endcode %}

### **Datos sensibles en el Almac칠n de claves**

En Android, el Almac칠n de claves es el mejor lugar para almacenar datos sensibles, sin embargo, con suficientes privilegios todav칤a es **posible acceder a 칠l**. Dado que las aplicaciones tienden a almacenar aqu칤 **datos sensibles en texto claro**, las pruebas de penetraci칩n deben verificarlo, ya que un usuario root o alguien con acceso f칤sico al dispositivo podr칤a robar estos datos.

Incluso si una aplicaci칩n almacenara datos en el almac칠n de claves, los datos deber칤an estar encriptados.

Para acceder a los datos dentro del almac칠n de claves, podr칤as utilizar este script de Frida: [https://github.com/WithSecureLabs/android-keystore-audit/blob/master/frida-scripts/tracer-cipher.js](https://github.com/WithSecureLabs/android-keystore-audit/blob/master/frida-scripts/tracer-cipher.js)
```bash
frida -U -f com.example.app -l frida-scripts/tracer-cipher.js
```
### **Bypass de Huella Dactilar/Biometr칤a**

Usando el siguiente script de Frida, podr칤a ser posible **bypassar la autenticaci칩n de huella dactilar** que las aplicaciones de Android podr칤an estar realizando para **proteger ciertas 치reas sensibles:** 

{% code overflow="wrap" %}
```bash
frida --codeshare krapgras/android-biometric-bypass-update-android-11 -U -f <app.package>
```
{% endcode %}

### **Im치genes de Fondo**

Cuando pones una aplicaci칩n en segundo plano, Android guarda una **instant치nea de la aplicaci칩n** para que, al recuperarla al primer plano, comience a cargar la imagen antes que la aplicaci칩n, de modo que parezca que la aplicaci칩n se carg칩 m치s r치pido.

Sin embargo, si esta instant치nea contiene **informaci칩n sensible**, alguien con acceso a la instant치nea podr칤a **robar esa informaci칩n** (ten en cuenta que se necesita acceso de root para acceder a ella).

Las instant치neas suelen almacenarse en: **`/data/system_ce/0/snapshots`**

Android proporciona una forma de **prevenir la captura de pantalla configurando el par치metro de dise침o FLAG\_SECURE**. Al utilizar esta bandera, el contenido de la ventana se trata como seguro, evitando que aparezca en capturas de pantalla o se vea en pantallas no seguras.
```bash
getWindow().setFlags(LayoutParams.FLAG_SECURE, LayoutParams.FLAG_SECURE);
```
### **Analizador de Aplicaciones Android**

Esta herramienta podr칤a ayudarte a gestionar diferentes herramientas durante el an치lisis din치mico: [https://github.com/NotSoSecure/android\_application\_analyzer](https://github.com/NotSoSecure/android\_application\_analyzer)

### Inyecci칩n de Intents

Esta vulnerabilidad se asemeja a **Redirecci칩n Abierta en seguridad web**. Dado que la clase `Intent` es `Parcelable`, **los objetos pertenecientes a esta clase** pueden ser **pasados** como **datos extra** en otro objeto `Intent`.\
Muchos desarrolladores hacen **uso** de esta **caracter칤stica** y crean **componentes proxy** (actividades, receptores de difusi칩n y servicios) que **toman un Intent incrustado y lo pasan a m칠todos peligrosos** como `startActivity(...)`, `sendBroadcast(...)`, etc.\
Esto es peligroso porque **un atacante puede forzar a la aplicaci칩n a lanzar un componente no exportado que no puede ser lanzado directamente desde otra aplicaci칩n**, o conceder al atacante acceso a sus proveedores de contenido. **`WebView`** a veces tambi칠n cambia una **URL de una cadena a un objeto `Intent`**, utilizando el m칠todo `Intent.parseUri(...)`, y lo pasa a `startActivity(...)`.

### Inyecciones del Lado del Cliente en Android y otros

Probablemente conozcas este tipo de vulnerabilidades en la Web. Debes tener especial cuidado con estas vulnerabilidades en una aplicaci칩n Android:

* **Inyecci칩n SQL:** Al tratar con consultas din치micas o Content-Providers, aseg칰rate de estar utilizando consultas parametrizadas.
* **Inyecci칩n de JavaScript (XSS):** Verifica que JavaScript y el soporte de plugins est칠n deshabilitados para cualquier WebView (deshabilitado por defecto). [M치s informaci칩n aqu칤](webview-attacks.md#javascript-enabled).
* **Inclusi칩n de Archivos Locales:** Verifica que el Acceso al Sistema de Archivos est칠 deshabilitado para cualquier WebView (habilitado por defecto) `(webview.getSettings().setAllowFileAccess(false);)`. [M치s informaci칩n aqu칤](webview-attacks.md#javascript-enabled).
* **Cookies eternas:** En varios casos, cuando la aplicaci칩n Android finaliza la sesi칩n, la cookie no se revoca o incluso podr칤a estar guardada en disco.
* [**Bandera Segura** en cookies](../../pentesting-web/hacking-with-cookies/#cookies-flags)

***

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

칔nete al servidor de [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) para comunicarte con hackers experimentados y cazadores de bugs!

**Perspectivas de Hacking**\
Participa en contenido que profundiza en la emoci칩n y desaf칤os del hacking

**Noticias de Hacking en Tiempo Real**\
Mantente actualizado con el mundo del hacking a trav칠s de noticias e informaci칩n en tiempo real

**칔ltimos Anuncios**\
Mantente informado sobre los nuevos programas de recompensas por bugs que se lanzan y actualizaciones cruciales de la plataforma

**칔nete a nosotros en** [**Discord**](https://discord.com/invite/N3FrSbmwdy) y comienza a colaborar con los mejores hackers hoy!

## An치lisis Autom치tico

### [MobSF](https://github.com/MobSF/Mobile-Security-Framework-MobSF)

**An치lisis est치tico**

![](<../../.gitbook/assets/image (61).png>)

**Evaluaci칩n de vulnerabilidades de la aplicaci칩n** utilizando una agradable interfaz web. Tambi칠n puedes realizar an치lisis din치mico (pero necesitas preparar el entorno).
```bash
docker pull opensecurity/mobile-security-framework-mobsf
docker run -it -p 8000:8000 opensecurity/mobile-security-framework-mobsf:latest
```
Ten en cuenta que MobSF puede analizar aplicaciones de **Android**(apk), **IOS**(ipa) y Windows(apx) (_Las aplicaciones de Windows deben ser analizadas desde un MobSF instalado en un host de Windows_).\
Adem치s, si creas un archivo **ZIP** con el c칩digo fuente de una aplicaci칩n de **Android** o de **IOS** (ve a la carpeta ra칤z de la aplicaci칩n, selecciona todo y crea un archivo ZIP), tambi칠n podr치 analizarlo.

MobSF tambi칠n te permite **comparar/diferenciar** an치lisis e integrar **VirusTotal** (necesitar치s configurar tu clave de API en _MobSF/settings.py_ y habilitarlo: `VT_ENABLED = TRUE` `VT_API_KEY = <Tu clave de API>` `VT_UPLOAD = TRUE`). Tambi칠n puedes establecer `VT_UPLOAD` en `False`, entonces el **hash** se **subir치** en lugar del archivo.

### An치lisis din치mico asistido con MobSF

**MobSF** tambi칠n puede ser muy 칰til para el **an치lisis din치mico** en **Android**, pero en ese caso necesitar치s instalar MobSF y **genymotion** en tu host (una VM o Docker no funcionar치n). _Nota: Necesitas **iniciar primero una VM en genymotion** y **luego MobSF**._

El **analizador din치mico de MobSF** puede:

* **Volcar datos de la aplicaci칩n** (URLs, logs, portapapeles, capturas de pantalla realizadas por ti, capturas de pantalla realizadas por "**Exported Activity Tester**", correos electr칩nicos, bases de datos SQLite, archivos XML y otros archivos creados). Todo esto se hace autom치ticamente excepto las capturas de pantalla, debes presionar cuando desees una captura de pantalla o debes presionar "**Exported Activity Tester**" para obtener capturas de pantalla de todas las actividades exportadas.
* Capturar **tr치fico HTTPS**
* Usar **Frida** para obtener **informaci칩n en tiempo de ejecuci칩n**

A partir de las versiones de Android > 5, **iniciar치 autom치ticamente Frida** y establecer치 la configuraci칩n global de **proxy** para **capturar** el tr치fico. Solo capturar치 el tr치fico de la aplicaci칩n probada.

**Frida**

Por defecto, tambi칠n utilizar치 algunos Scripts de Frida para **burlar el pinning SSL**, **detecci칩n de root** y **detecci칩n de depurador** y para **monitorizar APIs interesantes**.\
MobSF tambi칠n puede **invocar actividades exportadas**, capturar **capturas de pantalla** de ellas y **guardarlas** para el informe.

Para **iniciar** las pruebas din치micas, presiona el bot칩n verde: "**Start Instrumentation**". Presiona "**Frida Live Logs**" para ver los logs generados por los scripts de Frida y "**Live API Monitor**" para ver todas las invocaciones a los m칠todos enganchados, los argumentos pasados y los valores devueltos (esto aparecer치 despu칠s de presionar "Start Instrumentation").\
MobSF tambi칠n te permite cargar tus propios **scripts de Frida** (para enviar los resultados de tus scripts de Frida a MobSF utiliza la funci칩n `send()`). Tambi칠n tiene **varios scripts preescritos** que puedes cargar (puedes a침adir m치s en `MobSF/DynamicAnalyzer/tools/frida_scripts/others/`), simplemente **selecciona** uno, presiona "**Load**" y luego "**Start Instrumentation**" (podr치s ver los logs de esos scripts dentro de "**Frida Live Logs**").

![](<../../.gitbook/assets/image (215).png>)

Adem치s, tienes algunas funcionalidades auxiliares de Frida:

* **Enumerar Clases Cargadas**: Imprimir치 todas las clases cargadas
* **Capturar Cadenas**: Imprimir치 todas las cadenas capturadas mientras se usa la aplicaci칩n (muy ruidoso)
* **Capturar Comparaciones de Cadenas**: Puede ser muy 칰til. Mostrar치 las 2 cadenas que se est치n comparando y si el resultado fue Verdadero o Falso.
* **Enumerar M칠todos de Clase**: Pon el nombre de la clase (como "java.io.File") y imprimir치 todos los m칠todos de la clase.
* **Buscar Patr칩n de Clase**: Buscar clases por patr칩n
* **Rastrear M칠todos de Clase**: **Rastrear** toda una **clase** (ver entradas y salidas de todos los m칠todos de la clase). Recuerda que por defecto MobSF rastrea varios m칠todos interesantes de la API de Android.

Una vez que hayas seleccionado el m칩dulo auxiliar que deseas utilizar, debes presionar "**Start Intrumentation**" y ver치s todas las salidas en "**Frida Live Logs**".

**Shell**

Mobsf tambi칠n te proporciona un shell con algunos comandos de **adb**, comandos de **MobSF** y comandos de **shell** comunes en la parte inferior de la p치gina de an치lisis din치mico. Algunos comandos interesantes:
```bash
help
shell ls
activities
exported_activities
services
receivers
```
**Herramientas HTTP**

Cuando se captura el tr치fico http, puedes ver una vista poco atractiva del tr치fico capturado en la parte inferior de "**HTTP(S) Traffic**" o una vista m치s agradable en el bot칩n verde "**Start HTTPTools**". Desde la segunda opci칩n, puedes **enviar** las **solicitudes capturadas** a **proxies** como Burp u Owasp ZAP.\
Para hacerlo, _encender Burp -->_ _apagar Intercept --> en MobSB HTTPTools seleccionar la solicitud_ --> presionar "**Send to Fuzzer**" --> _seleccionar la direcci칩n del proxy_ ([http://127.0.0.1:8080\\](http://127.0.1:8080)).

Una vez que hayas terminado el an치lisis din치mico con MobSF, puedes presionar "**Start Web API Fuzzer**" para **fuzzear solicitudes http** y buscar vulnerabilidades.

{% hint style="info" %}
Despu칠s de realizar un an치lisis din치mico con MobSF, la configuraci칩n del proxy puede estar mal configurada y es posible que no puedas solucionarlo desde la GUI. Puedes arreglar la configuraci칩n del proxy haciendo:
```
adb shell settings put global http_proxy :0
```
{% endhint %}

### An치lisis Din치mico Asistido con Inspeckage

Puedes obtener la herramienta de [**Inspeckage**](https://github.com/ac-pm/Inspeckage).\
Esta herramienta utilizar치 algunos **Hooks** para informarte **sobre lo que est치 sucediendo en la aplicaci칩n** mientras realizas un **an치lisis din치mico**.

{% content-ref url="inspeckage-tutorial.md" %}
[inspeckage-tutorial.md](inspeckage-tutorial.md)
{% endcontent-ref %}

### [Yaazhini](https://www.vegabird.com/yaazhini/)

Esta es una **gran herramienta para realizar an치lisis est치tico con una interfaz gr치fica**

![](<../../.gitbook/assets/image (527).png>)

### [Qark](https://github.com/linkedin/qark)

Esta herramienta est치 dise침ada para buscar varias **vulnerabilidades de seguridad relacionadas con aplicaciones de Android**, ya sea en **c칩digo fuente** o en **APKs empaquetados**. La herramienta tambi칠n es **capaz de crear un APK desplegable de "Prueba de Concepto"** y **comandos ADB** para explotar algunas de las vulnerabilidades encontradas (actividades expuestas, intenciones, tapjacking...). Al igual que con Drozer, no es necesario rootear el dispositivo de prueba.
```bash
pip3 install --user qark  # --user is only needed if not using a virtualenv
qark --apk path/to/my.apk
qark --java path/to/parent/java/folder
qark --java path/to/specific/java/file.java
```
### [**ReverseAPK**](https://github.com/1N3/ReverseAPK.git)

* Muestra todos los archivos extra칤dos para una f치cil referencia
* Descompila autom치ticamente archivos APK al formato Java y Smali
* Analiza AndroidManifest.xml en busca de vulnerabilidades y comportamientos comunes
* An치lisis est치tico del c칩digo fuente en busca de vulnerabilidades y comportamientos comunes
* Informaci칩n del dispositivo
* Intents
* Ejecuci칩n de comandos
* Referencias de SQLite
* Referencias de logging
* Proveedores de contenido
* Receptores de broadcast
* Referencias de servicios
* Referencias de archivos
* Referencias de criptograf칤a
* Secretos codificados
* URL's
* Conexiones de red
* Referencias SSL
* Referencias de WebView
```
reverse-apk relative/path/to/APP.apk
```
### [SUPER Android Analyzer](https://github.com/SUPERAndroidAnalyzer/super)

SUPER es una aplicaci칩n de l칤nea de comandos que se puede utilizar en Windows, MacOS X y Linux, que analiza archivos _.apk_ en busca de vulnerabilidades. Lo hace descomprimiendo los APK y aplicando una serie de reglas para detectar esas vulnerabilidades.

Todas las reglas se centran en un archivo `rules.json`, y cada empresa o probador podr칤a crear sus propias reglas para analizar lo que necesitan.

Descarga las 칰ltimas versiones binarias en la [p치gina de descargas](https://superanalyzer.rocks/download.html)
```
super-analyzer {apk_file}
```
### [StaCoAn](https://github.com/vincentcox/StaCoAn)

![](<../../.gitbook/assets/image (62).png>)

StaCoAn es una herramienta **multiplataforma** que ayuda a desarrolladores, cazadores de bugs y hackers 칠ticos a realizar [an치lisis de c칩digo est치tico](https://en.wikipedia.org/wiki/Static\_program\_analysis) en aplicaciones m칩viles\*.

El concepto es que arrastres y sueltes el archivo de tu aplicaci칩n m칩vil (un archivo .apk o .ipa) en la aplicaci칩n StaCoAn y generar치 un informe visual y port치til para ti. Puedes ajustar la configuraci칩n y listas de palabras para obtener una experiencia personalizada.

Descarga la [칰ltima versi칩n](https://github.com/vincentcox/StaCoAn/releases):
```
./stacoan
```
### [AndroBugs](https://github.com/AndroBugs/AndroBugs\_Framework)

AndroBugs Framework es un sistema de an치lisis de vulnerabilidades de Android que ayuda a desarrolladores o hackers a encontrar posibles vulnerabilidades de seguridad en aplicaciones de Android.\
[Versiones para Windows](https://github.com/AndroBugs/AndroBugs\_Framework/releases)
```
python androbugs.py -f [APK file]
androbugs.exe -f [APK file]
```
### [Androwarn](https://github.com/maaaaz/androwarn)

**Androwarn** es una herramienta cuyo objetivo principal es detectar y advertir al usuario sobre posibles comportamientos maliciosos desarrollados por una aplicaci칩n de Android.

La detecci칩n se realiza con el **an치lisis est치tico** del bytecode Dalvik de la aplicaci칩n, representado como **Smali**, con la biblioteca [`androguard`](https://github.com/androguard/androguard).

Esta herramienta busca **comportamientos comunes de aplicaciones "malas"** como: exfiltraci칩n de identificadores de telefon칤a, interceptaci칩n de flujo de audio/video, modificaci칩n de datos PIM, ejecuci칩n de c칩digo arbitrario...
```
python androwarn.py -i my_application_to_be_analyzed.apk -r html -v 3
```
### [Marco de trabajo MARA](https://github.com/xtiankisutsa/MARA_Framework)

![](<../../.gitbook/assets/image (81).png>)

**MARA** es un **M**arco de trabajo de **A**n치lisis e **I**ngenier칤a **I**nversa de **A**plicaciones **M**칩viles. Es una herramienta que re칰ne herramientas com칰nmente utilizadas para la ingenier칤a inversa y an치lisis de aplicaciones m칩viles, para ayudar en la prueba de aplicaciones m칩viles contra las amenazas de seguridad m칩vil de OWASP. Su objetivo es hacer esta tarea m치s f치cil y amigable para los desarrolladores de aplicaciones m칩viles y profesionales de seguridad.

Es capaz de:

* Extraer c칩digo Java y Smali utilizando diferentes herramientas
* Analizar APKs utilizando: [smalisca](https://github.com/dorneanu/smalisca), [ClassyShark](https://github.com/google/android-classyshark), [androbugs](https://github.com/AndroBugs/AndroBugs_Framework), [androwarn](https://github.com/maaaaz/androwarn), [APKiD](https://github.com/rednaga/APKiD)
* Extraer informaci칩n privada de la APK utilizando expresiones regulares.
* Analizar el Manifiesto.
* Analizar dominios encontrados utilizando: [pyssltest](https://github.com/moheshmohan/pyssltest), [testssl](https://github.com/drwetter/testssl.sh) y [whatweb](https://github.com/urbanadventurer/WhatWeb)
* Desofuscar APK a trav칠s de [apk-deguard.com](http://www.apk-deguard.com)

### Koodous

칔til para detectar malware: [https://koodous.com/](https://koodous.com)

## Ofuscar/Desofuscar c칩digo

Tenga en cuenta que dependiendo del servicio y la configuraci칩n que utilice para ofuscar el c칩digo. Los secretos pueden o no terminar ofuscados.

### [ProGuard](https://en.wikipedia.org/wiki/ProGuard\_\(software\))

**ProGuard** es una herramienta de l칤nea de comandos de c칩digo abierto que reduce, optimiza y ofusca el c칩digo Java. Es capaz de optimizar el bytecode, as칤 como detectar y eliminar instrucciones no utilizadas. ProGuard es software libre y se distribuye bajo la Licencia P칰blica General de GNU, versi칩n 2.

ProGuard se distribuye como parte del SDK de Android y se ejecuta al compilar la aplicaci칩n en modo de lanzamiento.

De: [https://en.wikipedia.org/wiki/ProGuard\_(software)](https://en.wikipedia.org/wiki/ProGuard\_\(software\))

### [DexGuard](https://www.guardsquare.com/dexguard)

Encuentre una gu칤a paso a paso para desofuscar el apk en [https://blog.lexfo.fr/dexguard.html](https://blog.lexfo.fr/dexguard.html)

(De esa gu칤a) La 칰ltima vez que verificamos, el modo de operaci칩n de Dexguard era:

* cargar un recurso como un InputStream;
* alimentar el resultado a una clase que hereda de FilterInputStream para descifrarlo;
* hacer alguna ofuscaci칩n in칰til para perder unos minutos de tiempo de un inversor;
* alimentar el resultado descifrado a un ZipInputStream para obtener un archivo DEX;
* finalmente cargar el DEX resultante como un Recurso utilizando el m칠todo `loadDex`.

### [DeGuard](http://apk-deguard.com)

**DeGuard revierte el proceso de ofuscaci칩n realizado por las herramientas de ofuscaci칩n de Android. Esto permite numerosos an치lisis de seguridad, incluida la inspecci칩n de c칩digo y la predicci칩n de bibliotecas.**

Puede cargar un APK ofuscado en su plataforma.

### [Simplify](https://github.com/CalebFenton/simplify)

Es un **desofuscador gen칠rico de Android.** Simplify **ejecuta virtualmente una aplicaci칩n** para comprender su comportamiento y luego **intenta optimizar el c칩digo** para que se comporte de manera id칠ntica pero sea m치s f치cil de entender para un humano. Cada tipo de optimizaci칩n es simple y gen칠rico, por lo que no importa qu칠 tipo espec칤fico de ofuscaci칩n se utilice.

### [APKiD](https://github.com/rednaga/APKiD)

APKiD le proporciona informaci칩n sobre **c칩mo se cre칩 un APK**. Identifica muchos **compiladores**, **empaquetadores**, **ofuscadores** y otras cosas extra침as. Es [_PEiD_](https://www.aldeid.com/wiki/PEiD) para Android.

### Manual

[Lea este tutorial para aprender algunos trucos sobre **c칩mo desofuscar la ofuscaci칩n personalizada**](manual-deobfuscation.md)

## Laboratorios

### [Androl4b](https://github.com/sh4hin/Androl4b)

AndroL4b es una m치quina virtual de seguridad de Android basada en ubuntu-mate que incluye la colecci칩n de los 칰ltimos marcos, tutoriales y laboratorios de diferentes geeks de seguridad e investigadores para ingenier칤a inversa y an치lisis de malware.

### OWASP

{% embed url="https://github.com/OWASP/owasp-mstg%0Ahttps://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06g-testing-network-communication" %}

### Repositorios de Git

[https://github.com/riddhi-shree/nullCommunity/tree/master/Android](https://github.com/riddhi-shree/nullCommunity/tree/master/Android)\
[https://www.youtube.com/watch?v=PMKnPaGWxtg\&feature=youtu.be\&ab\_channel=B3nacSec](https://www.youtube.com/watch?v=PMKnPaGWxtg\&feature=youtu.be\&ab\_channel=B3nacSec)

## Referencias

Para obtener m치s informaci칩n, visite:

* [https://appsecwiki.com/#/](https://appsecwiki.com/#/) Es una gran lista de recursos
* [https://maddiestone.github.io/AndroidAppRE/](https://maddiestone.github.io/AndroidAppRE/) Curso r치pido de Android
* [https://manifestsecurity.com/android-application-security/](https://manifestsecurity.com/android-application-security/)
* [https://github.com/Ralireza/Android-Security-Teryaagh](https://github.com/Ralireza/Android-Security-Teryaagh)

## Para Probar

* [https://www.vegabird.com/yaazhini/](https://www.vegabird.com/yaazhini/)
* [https://github.com/abhi-r3v0/Adhrit](https://github.com/abhi-r3v0/Adhrit)

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

칔nete al servidor de [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) para comunicarte con hackers experimentados y cazadores de bugs!

**Perspectivas de Hacking**\
Participa en contenido que profundiza en la emoci칩n y desaf칤os del hacking

**Noticias de Hacking en Tiempo Real**\
Mantente actualizado con el mundo del hacking a trav칠s de noticias e informaci칩n en tiempo real

**칔ltimos Anuncios**\
Mantente informado sobre los nuevos programas de recompensas por bugs que se lanzan y actualizaciones importantes de plataformas

**칔nete a nosotros en** [**Discord**](https://discord.com/invite/N3FrSbmwdy) y comienza a colaborar con los mejores hackers hoy!

<details>

<summary><strong>Aprende hacking en AWS de cero a h칠roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si deseas ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** 춰Consulta los [**PLANES DE SUSCRIPCI칍N**](https://github.com/sponsors/carlospolop)!
* Obt칠n el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci칩n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s칤gueme** en **Twitter** 游냕 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
