# Test des applications Android

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Expert en √©quipe rouge AWS de HackTricks)</strong></a><strong>!</strong></summary>

Autres fa√ßons de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFT**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts GitHub.

</details>

<figure><img src="../../.gitbook/assets/image (377).png" alt=""><figcaption></figcaption></figure>

Rejoignez le serveur [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) pour communiquer avec des pirates exp√©riment√©s et des chasseurs de primes !

**Perspectives de piratage**\
Engagez-vous avec du contenu qui explore le frisson et les d√©fis du piratage

**Actualit√©s de piratage en temps r√©el**\
Restez inform√© du monde du piratage en √©volution rapide gr√¢ce √† des actualit√©s et des informations en temps r√©el

**Derni√®res annonces**\
Restez inform√© des derni√®res primes de bugs lanc√©es et des mises √† jour cruciales de la plateforme

**Rejoignez-nous sur** [**Discord**](https://discord.com/invite/N3FrSbmwdy) et commencez √† collaborer avec les meilleurs pirates d√®s aujourd'hui !

## Bases des applications Android

Il est fortement recommand√© de commencer par lire cette page pour en savoir plus sur les **parties les plus importantes li√©es √† la s√©curit√© Android et les composants les plus dangereux dans une application Android** :

{% content-ref url="android-applications-basics.md" %}
[android-applications-basics.md](android-applications-basics.md)
{% endcontent-ref %}

## ADB (Android Debug Bridge)

C'est l'outil principal dont vous avez besoin pour vous connecter √† un appareil Android (√©mul√© ou physique).\
**ADB** permet de contr√¥ler les appareils soit par **USB** soit par **r√©seau** √† partir d'un ordinateur. Cet utilitaire permet la **copie** de fichiers dans les deux sens, l'**installation** et la **d√©sinstallation** d'applications, l'**ex√©cution** de commandes shell, la **sauvegarde** de donn√©es, la **lecture** de journaux, entre autres fonctions.

Consultez la liste suivante des [**Commandes ADB**](adb-commands.md) pour apprendre √† utiliser adb.

## Smali

Parfois, il est int√©ressant de **modifier le code de l'application** pour acc√©der √† des **informations cach√©es** (peut-√™tre des mots de passe bien obscurcis ou des indicateurs). Ensuite, il peut √™tre int√©ressant de d√©compiler l'APK, modifier le code et le recompiler.\
[Dans ce tutoriel](smali-changes.md), vous pouvez **apprendre √† d√©compiler un APK, modifier le code Smali et recompiler l'APK** avec la nouvelle fonctionnalit√©. Cela pourrait √™tre tr√®s utile comme **alternative pour plusieurs tests pendant l'analyse dynamique** qui vont √™tre pr√©sent√©s. Ensuite, **gardez toujours √† l'esprit cette possibilit√©**.

## Autres astuces int√©ressantes

* [Fausser votre emplacement dans le Play Store](spoofing-your-location-in-play-store.md)
* **T√©l√©charger des APK** : [https://apps.evozi.com/apk-downloader/](https://apps.evozi.com/apk-downloader/), [https://apkpure.com/es/](https://apkpure.com/es/), [https://www.apkmirror.com/](https://www.apkmirror.com), [https://apkcombo.com/es-es/apk-downloader/](https://apkcombo.com/es-es/apk-downloader/)
* Extraire un APK de l'appareil :
```bash
adb shell pm list packages
com.android.insecurebankv2

adb shell pm path com.android.insecurebankv2
package:/data/app/com.android.insecurebankv2-Jnf8pNgwy3QA_U5f-n_4jQ==/base.apk

adb pull /data/app/com.android.insecurebankv2- Jnf8pNgwy3QA_U5f-n_4jQ==/base.apk
```
## Analyse statique

Tout d'abord, pour analyser un APK, vous devriez **jeter un ≈ìil au code Java** en utilisant un d√©compilateur.\
Veuillez [**lire ici pour trouver des informations sur les diff√©rents d√©compilateurs disponibles**](apk-decompilers.md).

### Recherche d'informations int√©ressantes

En examinant simplement les **cha√Ænes de caract√®res** de l'APK, vous pouvez rechercher des **mots de passe**, des **URL** ([https://github.com/ndelphit/apkurlgrep](https://github.com/ndelphit/apkurlgrep)), des **cl√©s API**, du **chiffrement**, des **UUID Bluetooth**, des **jetons** et tout ce qui est int√©ressant... cherchez m√™me des **backdoors** d'ex√©cution de code ou des backdoors d'authentification (identifiants administrateur cod√©s en dur dans l'application).

**Firebase**

Portez une attention particuli√®re aux **URLs Firebase** et v√©rifiez si elles sont mal configur√©es. [Plus d'informations sur ce qu'est Firebase et comment l'exploiter ici.](../../network-services-pentesting/pentesting-web/buckets/firebase-database.md)

### Compr√©hension de base de l'application - Manifest.xml, strings.xml

L'**examen des fichiers \_Manifest.xml**_\*\* et \*\*_**strings.xml**\_\*\* d'une application peut r√©v√©ler des vuln√©rabilit√©s potentielles\*\*. Ces fichiers peuvent √™tre consult√©s en utilisant des d√©compilateurs ou en renommant l'extension du fichier APK en .zip, puis en le d√©zippant.

Les **vuln√©rabilit√©s** identifi√©es dans le **Manifest.xml** incluent :

* **Applications d√©bogables** : Les applications d√©finies comme d√©bogables (`debuggable="true"`) dans le fichier _Manifest.xml_ posent un risque car elles permettent des connexions pouvant conduire √† une exploitation. Pour une meilleure compr√©hension de l'exploitation des applications d√©bogables, consultez un tutoriel sur la recherche et l'exploitation d'applications d√©bogables sur un appareil.
* **Param√®tres de sauvegarde** : L'attribut `android:allowBackup="false"` devrait √™tre explicitement d√©fini pour les applications traitant des informations sensibles afin d'emp√™cher les sauvegardes de donn√©es non autoris√©es via adb, surtout lorsque le d√©bogage USB est activ√©.
* **S√©curit√© r√©seau** : Les configurations personnalis√©es de s√©curit√© r√©seau (`android:networkSecurityConfig="@xml/network_security_config"`) dans _res/xml/_ peuvent sp√©cifier des d√©tails de s√©curit√© tels que des √©pingles de certificat et des param√®tres de trafic HTTP. Un exemple est d'autoriser le trafic HTTP pour des domaines sp√©cifiques.
* **Activit√©s et services export√©s** : Identifier les activit√©s et services export√©s dans le manifeste peut mettre en √©vidence des composants qui pourraient √™tre mal utilis√©s. Une analyse plus approfondie lors des tests dynamiques peut r√©v√©ler comment exploiter ces composants.
* **Fournisseurs de contenu et FileProviders** : Les fournisseurs de contenu expos√©s pourraient permettre un acc√®s ou une modification non autoris√©s des donn√©es. La configuration des FileProviders devrait √©galement √™tre examin√©e.
* **R√©cepteurs de diffusion et sch√©mas d'URL** : Ces composants pourraient √™tre exploit√©s, en accordant une attention particuli√®re √† la gestion des sch√©mas d'URL pour les vuln√©rabilit√©s d'entr√©e.
* **Versions SDK** : Les attributs `minSdkVersion`, `targetSDKVersion` et `maxSdkVersion` indiquent les versions d'Android prises en charge, soulignant l'importance de ne pas prendre en charge des versions d'Android obsol√®tes et vuln√©rables pour des raisons de s√©curit√©.

√Ä partir du fichier **strings.xml**, des informations sensibles telles que des cl√©s API, des sch√©mas personnalis√©s et d'autres notes de d√©veloppeur peuvent √™tre d√©couvertes, soulignant la n√©cessit√© d'un examen attentif de ces ressources.

### Tapjacking

**Tapjacking** est une attaque o√π une **application malveillante** est lanc√©e et **se positionne au-dessus d'une application victime**. Une fois qu'elle obscurcit visuellement l'application victime, son interface utilisateur est con√ßue de mani√®re √† tromper l'utilisateur pour qu'il interagisse avec elle, tout en transmettant l'interaction √† l'application victime.\
En effet, cela **emp√™che l'utilisateur de savoir qu'il effectue r√©ellement des actions sur l'application victime**.

Trouvez plus d'informations dans :

{% content-ref url="tapjacking.md" %}
[tapjacking.md](tapjacking.md)
{% endcontent-ref %}

### D√©tournement de t√¢che

Une **activit√©** avec le **`launchMode`** d√©fini sur **`singleTask` sans aucune `taskAffinity`** d√©finie est vuln√©rable au d√©tournement de t√¢che. Cela signifie qu'une **application** peut √™tre install√©e et si elle est lanc√©e avant l'application r√©elle, elle pourrait **d√©tourner la t√¢che de l'application r√©elle** (ainsi l'utilisateur interagira avec la **mauvaise application en pensant qu'il utilise la vraie**).

Plus d'informations dans :

{% content-ref url="android-task-hijacking.md" %}
[android-task-hijacking.md](android-task-hijacking.md)
{% endcontent-ref %}

### Stockage de donn√©es non s√©curis√©

**Stockage interne**

Sur Android, les fichiers **stock√©s** dans le **stockage interne** sont **con√ßus** pour √™tre **accessibles** exclusivement par l'**application** qui les a **cr√©√©s**. Cette mesure de s√©curit√© est **appliqu√©e** par le syst√®me d'exploitation Android et est g√©n√©ralement ad√©quate pour les besoins de s√©curit√© de la plupart des applications. Cependant, les d√©veloppeurs utilisent parfois des modes tels que `MODE_WORLD_READABLE` et `MODE_WORLD_WRITABLE` pour **permettre** aux fichiers d'√™tre **partag√©s** entre diff√©rentes applications. Cependant, ces modes **ne restreignent pas l'acc√®s** √† ces fichiers par d'autres applications, y compris potentiellement des applications malveillantes.

1. **Analyse statique :**
* **Assurez-vous** que l'utilisation de `MODE_WORLD_READABLE` et `MODE_WORLD_WRITABLE` est **soigneusement examin√©e**. Ces modes **peuvent potentiellement exposer** les fichiers √† un **acc√®s non intentionnel ou non autoris√©**.
2. **Analyse dynamique :**
* **V√©rifiez** les **autorisations** d√©finies sur les fichiers cr√©√©s par l'application. En particulier, **v√©rifiez** si des fichiers sont **d√©finis comme lisibles ou modifiables mondialement**. Cela peut poser un risque de s√©curit√© important, car cela permettrait √† **n'importe quelle application** install√©e sur l'appareil, quelle que soit son origine ou son intention, de **lire ou de modifier** ces fichiers.

**Stockage externe**

Lorsqu'il s'agit de fichiers sur le **stockage externe**, comme les cartes SD, certaines pr√©cautions doivent √™tre prises :

1. **Accessibilit√©** :
* Les fichiers sur le stockage externe sont **lisibles et modifiables mondialement**. Cela signifie que n'importe quelle application ou utilisateur peut acc√©der √† ces fichiers.
2. **Pr√©occupations de s√©curit√©** :
* √âtant donn√© la facilit√© d'acc√®s, il est conseill√© de **ne pas stocker d'informations sensibles** sur le stockage externe.
* Le stockage externe peut √™tre retir√© ou acc√©d√© par n'importe quelle application, le rendant moins s√©curis√©.
3. **Traitement des donn√©es provenant du stockage externe** :
* Effectuez toujours une **validation des entr√©es** sur les donn√©es r√©cup√©r√©es depuis le stockage externe. C'est crucial car les donn√©es proviennent d'une source non fiable.
* Il est fortement d√©conseill√© de stocker des ex√©cutables ou des fichiers de classe sur le stockage externe pour un chargement dynamique.
* Si votre application doit r√©cup√©rer des fichiers ex√©cutables depuis le stockage externe, assurez-vous que ces fichiers sont **sign√©s et v√©rifi√©s cryptographiquement** avant d'√™tre charg√©s dynamiquement. Cette √©tape est essentielle pour maintenir l'int√©grit√© de s√©curit√© de votre application.

Le stockage externe peut √™tre **acc√©d√©** dans `/storage/emulated/0`, `/sdcard`, `/mnt/sdcard`

{% hint style="info" %}
√Ä partir d'Android 4.4 (**API 17**), la carte SD a une structure de r√©pertoire qui **limite l'acc√®s d'une application au r√©pertoire sp√©cifiquement d√©di√© √† cette application**. Cela emp√™che une application malveillante d'obtenir un acc√®s en lecture ou en √©criture aux fichiers d'une autre application.
{% endhint %}

**Donn√©es sensibles stock√©es en clair**

* **Pr√©f√©rences partag√©es** : Android permet √† chaque application de facilement enregistrer des fichiers XML dans le chemin `/data/data/<nomdupackage>/shared_prefs/` et parfois il est possible de trouver des informations sensibles en clair dans ce dossier.
* **Bases de donn√©es** : Android permet √† chaque application de facilement enregistrer des bases de donn√©es SQLite dans le chemin `/data/data/<nomdupackage>/databases/` et parfois il est possible de trouver des informations sensibles en clair dans ce dossier.

### TLS cass√©

**Accepter tous les certificats**

Pour une raison quelconque, parfois les d√©veloppeurs acceptent tous les certificats m√™me si par exemple le nom d'h√¥te ne correspond pas avec des lignes de code comme celle-ci :
```java
SSLSocketFactory sf = new cc(trustStore);
sf.setHostnameVerifier(SSLSocketFactory.ALLOW_ALL_HOSTNAME_VERIFIER);
```
### Cryptographie cass√©e

**Processus de gestion de cl√©s m√©diocre**

Certains d√©veloppeurs enregistrent des donn√©es sensibles dans le stockage local et les chiffrent avec une cl√© cod√©e/pr√©visible dans le code. Cela ne devrait pas √™tre fait car une r√©tro-ing√©nierie pourrait permettre aux attaquants d'extraire les informations confidentielles.

**Utilisation d'algorithmes non s√©curis√©s et/ou obsol√®tes**

Les d√©veloppeurs ne devraient pas utiliser des **algorithmes obsol√®tes** pour effectuer des **v√©rifications d'autorisation**, **stocker** ou **envoyer** des donn√©es. Certains de ces algorithmes sont : RC4, MD4, MD5, SHA1... Si des **hashes** sont utilis√©s pour stocker des mots de passe par exemple, des hashes r√©sistants √† la force brute devraient √™tre utilis√©s avec du sel.

### Autres v√©rifications

* Il est recommand√© d'**obfusquer l'APK** pour compliquer le travail de r√©tro-ing√©nierie des attaquants.
* Si l'application est sensible (comme les applications bancaires), elle devrait effectuer ses **propres v√©rifications pour voir si le mobile est root√©** et agir en cons√©quence.
* Si l'application est sensible (comme les applications bancaires), elle devrait v√©rifier si un **√©mulateur** est utilis√©.
* Si l'application est sensible (comme les applications bancaires), elle devrait **v√©rifier son int√©grit√© avant de l'ex√©cuter** pour v√©rifier si elle a √©t√© modifi√©e.
* Utilisez [**APKiD**](https://github.com/rednaga/APKiD) pour v√©rifier quel compilateur/packer/obfuscateur a √©t√© utilis√© pour construire l'APK.

### Application React Native

Consultez la page suivante pour apprendre comment acc√©der facilement au code JavaScript des applications React :

{% content-ref url="react-native-application.md" %}
[react-native-application.md](react-native-application.md)
{% endcontent-ref %}

### Applications Xamarin

Consultez la page suivante pour apprendre comment acc√©der facilement au code C# des applications Xamarin :

{% content-ref url="../xamarin-apps.md" %}
[xamarin-apps.md](../xamarin-apps.md)
{% endcontent-ref %}

### Applications Superpacked

Selon ce [**billet de blog**](https://clearbluejar.github.io/posts/desuperpacking-meta-superpacked-apks-with-github-actions/), superpacked est un m√©ta-algorithme qui compresse le contenu d'une application dans un seul fichier. Le blog parle de la possibilit√© de cr√©er une application qui d√©compresse ce type d'applications... et d'une mani√®re plus rapide qui implique d'**ex√©cuter l'application et de rassembler les fichiers d√©compress√©s du syst√®me de fichiers**.

### Analyse statique automatis√©e du code

L'outil [**mariana-trench**](https://github.com/facebook/mariana-trench) est capable de trouver des **vuln√©rabilit√©s** en **scannant** le **code** de l'application. Cet outil contient une s√©rie de **sources connues** (qui indiquent √† l'outil les **endroits** o√π l'**entr√©e** est **contr√¥l√©e par l'utilisateur**), des **sinks** (qui indiquent √† l'outil les **endroits dangereux** o√π une entr√©e utilisateur malveillante pourrait causer des dommages) et des **r√®gles**. Ces r√®gles indiquent la **combinaison** de **sources-sinks** qui indique une vuln√©rabilit√©.

Avec cette connaissance, **mariana-trench examinera le code et trouvera les vuln√©rabilit√©s potentielles**.

### Fuites de secrets

Une application peut contenir des secrets (cl√©s API, mots de passe, URL cach√©es, sous-domaines...) √† l'int√©rieur que vous pourriez d√©couvrir. Vous pourriez utiliser un outil tel que [https://github.com/dwisiswant0/apkleaks](https://github.com/dwisiswant0/apkleaks)

### Contourner l'authentification biom√©trique

{% content-ref url="bypass-biometric-authentication-android.md" %}
[bypass-biometric-authentication-android.md](bypass-biometric-authentication-android.md)
{% endcontent-ref %}

### Autres fonctions int√©ressantes

* **Ex√©cution de code** : `Runtime.exec(), ProcessBuilder(), code natif : system()`
* **Envoi de SMS** : `sendTextMessage, sendMultipartTestMessage`
* **Fonctions natives** d√©clar√©es comme `native` : `public native, System.loadLibrary, System.load`
* [Lisez ceci pour apprendre **comment inverser les fonctions natives**](reversing-native-libraries.md)

### **Autres astuces**

{% content-ref url="content-protocol.md" %}
[content-protocol.md](content-protocol.md)
{% endcontent-ref %}

***

<figure><img src="../../.gitbook/assets/image (377).png" alt=""><figcaption></figcaption></figure>

Rejoignez le serveur [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) pour communiquer avec des hackers exp√©riment√©s et des chasseurs de primes en bugs !

**Perspectives de piratage**\
Engagez-vous avec du contenu qui explore le frisson et les d√©fis du piratage

**Actualit√©s de piratage en temps r√©el**\
Restez √† jour avec le monde du piratage rapide gr√¢ce aux actualit√©s et aux informations en temps r√©el

**Derni√®res annonces**\
Restez inform√© des derni√®res primes au bug lanc√©es et des mises √† jour cruciales de la plateforme

**Rejoignez-nous sur** [**Discord**](https://discord.com/invite/N3FrSbmwdy) et commencez √† collaborer avec les meilleurs hackers d√®s aujourd'hui !

***

## Analyse dynamique

> Tout d'abord, vous avez besoin d'un environnement o√π vous pouvez installer l'application et tout l'environnement (certificat Burp CA, Drozer et Frida principalement). Par cons√©quent, un appareil root√© (√©mul√© ou non) est extr√™mement recommand√©.

### Analyse dynamique en ligne

Vous pouvez cr√©er un **compte gratuit** sur : [https://appetize.io/](https://appetize.io). Cette plateforme vous permet de **t√©l√©charger** et **ex√©cuter** des APK, il est donc utile de voir comment un APK se comporte.

Vous pouvez m√™me **voir les journaux de votre application** sur le web et vous connecter via **adb**.

![](<../../.gitbook/assets/image (828).png>)

Gr√¢ce √† la connexion ADB, vous pouvez utiliser **Drozer** et **Frida** √† l'int√©rieur des √©mulateurs.

### Analyse dynamique locale

#### Utilisation d'un √©mulateur

* [**Android Studio**](https://developer.android.com/studio) (Vous pouvez cr√©er des appareils **x86** et **arm**, et selon [**ceci** ](https://android-developers.googleblog.com/2020/03/run-arm-apps-on-android-emulator.html)les **derni√®res versions x86** supportent les biblioth√®ques ARM sans avoir besoin d'un √©mulateur ARM lent).
* Apprenez √† le configurer sur cette page :

{% content-ref url="avd-android-virtual-device.md" %}
[avd-android-virtual-device.md](avd-android-virtual-device.md)
{% endcontent-ref %}

* [**Genymotion**](https://www.genymotion.com/fun-zone/) **(Version gratuite :** Personal Edition, vous devez cr√©er un compte. _Il est recommand√© de **t√©l√©charger** la version **AVEC**_ _**VirtualBox** pour √©viter les erreurs potentielles._)
* [**Nox**](https://es.bignox.com) (Gratuit, mais ne prend pas en charge Frida ou Drozer).

{% hint style="info" %}
Lors de la cr√©ation d'un nouvel √©mulateur sur n'importe quelle plateforme, rappelez-vous que plus l'√©cran est grand, plus l'√©mulateur sera lent. S√©lectionnez donc de petits √©crans si possible.
{% endhint %}

Pour **installer les services Google** (comme AppStore) dans Genymotion, vous devez cliquer sur le bouton marqu√© en rouge de l'image suivante :

![](<../../.gitbook/assets/image (274).png>)

De plus, notez que dans la **configuration de la VM Android dans Genymotion**, vous pouvez s√©lectionner le mode **Bridge Network** (ce sera utile si vous devez vous connecter √† la VM Android depuis une autre VM avec les outils).

#### Utiliser un appareil physique

Vous devez activer les options de **d√©bogage** et ce serait bien si vous pouviez le **rooter** :

1. **Param√®tres**.
2. (√Ä partir d'Android 8.0) S√©lectionnez **Syst√®me**.
3. S√©lectionnez **√Ä propos du t√©l√©phone**.
4. Appuyez 7 fois sur **Num√©ro de build**.
5. Revenez en arri√®re et vous trouverez les **Options pour les d√©veloppeurs**.

> Une fois que vous avez install√© l'application, la premi√®re chose √† faire est de l'essayer et d'investiguer ce qu'elle fait, comment elle fonctionne et de vous familiariser avec elle.\
> Je vous sugg√®re de **r√©aliser cette analyse dynamique initiale en utilisant l'analyse dynamique de MobSF + pidcat**, ainsi nous pourrons **apprendre comment l'application fonctionne** tandis que MobSF **capture** beaucoup de **donn√©es int√©ressantes** que vous pourrez examiner plus tard.
### Fuite de donn√©es non intentionnelle

**Journalisation**

Les d√©veloppeurs doivent √™tre prudents quant √† l'exposition publique des **informations de d√©bogage**, car cela peut entra√Æner des fuites de donn√©es sensibles. Les outils [**pidcat**](https://github.com/JakeWharton/pidcat) et `adb logcat` sont recommand√©s pour surveiller les journaux d'application afin d'identifier et prot√©ger les informations sensibles. **Pidcat** est pr√©f√©r√© pour sa facilit√© d'utilisation et sa lisibilit√©.

{% hint style="warning" %}
Notez que **√† partir d'Android 4.0**, **les applications ne peuvent acc√©der qu'√† leurs propres journaux**. Les applications ne peuvent donc pas acc√©der aux journaux d'autres applications.\
Quoi qu'il en soit, il est toujours recommand√© de **ne pas journaliser d'informations sensibles**.
{% endhint %}

**Mise en cache du presse-papiers**

Le framework **bas√© sur le presse-papiers** d'Android permet la fonctionnalit√© de copier-coller dans les applications, mais pr√©sente un risque car **d'autres applications** peuvent **acc√©der** au presse-papiers, exposant potentiellement des donn√©es sensibles. Il est crucial de **d√©sactiver les fonctions de copier/coller** pour les sections sensibles d'une application, comme les d√©tails de carte de cr√©dit, pour √©viter les fuites de donn√©es.

**Journaux de plantage**

Si une application **plante** et **enregistre des journaux**, ces journaux peuvent aider les attaquants, en particulier lorsque l'application ne peut pas √™tre r√©tro-ing√©nier√©e. Pour att√©nuer ce risque, √©vitez de journaliser les plantages, et si les journaux doivent √™tre transmis via le r√©seau, assurez-vous qu'ils sont envoy√©s via un canal SSL pour la s√©curit√©.

En tant que pentester, **essayez de consulter ces journaux**.

**Donn√©es analytiques envoy√©es √† des tiers**

Les applications int√®grent souvent des services comme Google Adsense, qui peuvent involontairement **fuir des donn√©es sensibles** en raison d'une impl√©mentation incorrecte par les d√©veloppeurs. Pour identifier les fuites de donn√©es potentielles, il est conseill√© d'**intercepter le trafic de l'application** et de v√©rifier si des informations sensibles sont envoy√©es √† des services tiers.

### Bases de donn√©es SQLite

La plupart des applications utiliseront des **bases de donn√©es SQLite internes** pour enregistrer des informations. Lors du test d'intrusion, jetez un **≈ìil** aux **bases de donn√©es** cr√©√©es, aux noms des **tables** et des **colonnes** et √† toutes les **donn√©es** enregistr√©es car vous pourriez trouver des **informations sensibles** (ce qui serait une vuln√©rabilit√©).\
Les bases de donn√©es doivent √™tre situ√©es dans `/data/data/nom_du.package/databases` comme `/data/data/com.mwr.example.sieve/databases`

Si la base de donn√©es enregistre des informations confidentielles et est **chiffr√©e** mais que vous pouvez **trouver** le **mot de passe** √† l'int√©rieur de l'application, c'est toujours une **vuln√©rabilit√©**.

√ânum√©rez les tables en utilisant `.tables` et √©num√©rez les colonnes des tables en faisant `.schema <nom_de_la_table>`

### Drozer (Exploiter les activit√©s, les fournisseurs de contenu et les services)

D'apr√®s les [documents de Drozer](https://labs.mwrinfosecurity.com/assets/BlogFiles/mwri-drozer-user-guide-2015-03-23.pdf) : **Drozer** vous permet de **prendre le r√¥le d'une application Android** et d'interagir avec d'autres applications. Il peut faire **tout ce qu'une application install√©e peut faire**, comme utiliser le m√©canisme de communication inter-processus (IPC) d'Android et interagir avec le syst√®me d'exploitation sous-jacent.\
Drozer est un outil utile pour **exploiter les activit√©s export√©es, les services export√©s et les fournisseurs de contenu**, comme vous le verrez dans les sections suivantes.

### Exploiter les activit√©s export√©es

[**Lisez ceci si vous voulez vous rafra√Æchir sur ce qu'est une activit√© Android.**](android-applications-basics.md#launcher-activity-and-other-activities)\
Rappelez-vous √©galement que le code d'une activit√© commence dans la m√©thode **`onCreate`**.

**Contournement de l'autorisation**

Lorsqu'une activit√© est export√©e, vous pouvez invoquer son √©cran √† partir d'une application externe. Par cons√©quent, si une activit√© contenant des **informations sensibles** est **export√©e**, vous pourriez **contourner** les **m√©canismes d'authentification** pour y acc√©der.

[**Apprenez comment exploiter les activit√©s export√©es avec Drozer.**](drozer-tutorial/#activities)

Vous pouvez √©galement d√©marrer une activit√© export√©e depuis adb :

* Le nom du package est com.example.demo
* Le nom de l'activit√© export√©e est com.example.test.MainActivity
```bash
adb shell am start -n com.example.demo/com.example.test.MainActivity
```
**REMARQUE**: MobSF d√©tectera comme malveillante l'utilisation de _**singleTask/singleInstance**_ en tant que `android:launchMode` dans une activit√©, mais en raison de [ceci](https://github.com/MobSF/Mobile-Security-Framework-MobSF/pull/750), apparemment cela est seulement dangereux sur les anciennes versions (versions d'API < 21).

{% hint style="info" %}
Notez qu'une contournement d'autorisation n'est pas toujours une vuln√©rabilit√©, cela d√©pend de la fa√ßon dont le contournement fonctionne et des informations qui sont expos√©es.
{% endhint %}

**Fuite d'informations sensibles**

**Les activit√©s peuvent √©galement renvoyer des r√©sultats**. Si vous parvenez √† trouver une activit√© export√©e et non prot√©g√©e appelant la m√©thode **`setResult`** et **renvoyant des informations sensibles**, il s'agit d'une fuite d'informations sensibles.

#### Tapjacking

Si le tapjacking n'est pas emp√™ch√©, vous pourriez abuser de l'activit√© export√©e pour faire en sorte que l'**utilisateur effectue des actions inattendues**. Pour plus d'informations sur [**ce qu'est le Tapjacking, suivez le lien**](./#tapjacking).

### Exploitation des fournisseurs de contenu - Acc√®s et manipulation d'informations sensibles

[**Lisez ceci si vous voulez vous rafra√Æchir sur ce qu'est un fournisseur de contenu.**](android-applications-basics.md#content-provider)\
Les fournisseurs de contenu sont essentiellement utilis√©s pour **partager des donn√©es**. Si une application dispose de fournisseurs de contenu disponibles, vous pourriez √™tre en mesure d'**extraire des donn√©es sensibles** d'eux. Il est √©galement int√©ressant de tester les √©ventuelles **injections SQL** et les **travers√©es de chemin** car elles pourraient √™tre vuln√©rables.

[**Apprenez comment exploiter les fournisseurs de contenu avec Drozer.**](drozer-tutorial/#content-providers)

### **Exploitation des Services**

[**Lisez ceci si vous voulez vous rafra√Æchir sur ce qu'est un Service.**](android-applications-basics.md#services)\
Rappelez-vous que les actions d'un Service commencent dans la m√©thode `onStartCommand`.

Un service est essentiellement quelque chose qui **peut recevoir des donn√©es**, les **traiter** et **renvoyer** (ou non) une r√©ponse. Ensuite, si une application exporte certains services, vous devriez **v√©rifier** le **code** pour comprendre ce qu'il fait et le **tester** de mani√®re **dynamique** pour extraire des informations confidentielles, contourner les mesures d'authentification...\
[**Apprenez comment exploiter les Services avec Drozer.**](drozer-tutorial/#services)

### **Exploitation des R√©cepteurs de diffusion**

[**Lisez ceci si vous voulez vous rafra√Æchir sur ce qu'est un R√©cepteur de diffusion.**](android-applications-basics.md#broadcast-receivers)\
Rappelez-vous que les actions d'un R√©cepteur de diffusion commencent dans la m√©thode `onReceive`.

Un r√©cepteur de diffusion attendra un type de message. Selon la fa√ßon dont le r√©cepteur g√®re le message, il pourrait √™tre vuln√©rable.\
[**Apprenez comment exploiter les R√©cepteurs de diffusion avec Drozer.**](./#exploiting-broadcast-receivers)

### **Exploitation des Sch√©mas / Liens profonds**

Vous pouvez rechercher manuellement des liens profonds, en utilisant des outils comme MobSF ou des scripts comme [celui-ci](https://github.com/ashleykinguk/FBLinkBuilder/blob/master/FBLinkBuilder.py).\
Vous pouvez **ouvrir** un **sch√©ma** d√©clar√© en utilisant **adb** ou un **navigateur**:

{% code overflow="wrap" %}
```bash
adb shell am start -a android.intent.action.VIEW -d "scheme://hostname/path?param=value" [your.package.name]
```
{% endcode %}

_Notez que vous pouvez **omettre le nom du package** et le mobile appellera automatiquement l'application qui devrait ouvrir ce lien._

{% code overflow="wrap" %}
```markup
<!-- Browser regular link -->
<a href="scheme://hostname/path?param=value">Click me</a>
<!-- fallback in your url you could try the intent url -->
<a href="intent://hostname#Intent;scheme=scheme;package=your.package.name;S.browser_fallback_url=http%3A%2F%2Fwww.example.com;end">with alternative</a>
```
{% endcode %}

**Code ex√©cut√©**

Pour trouver le **code qui sera ex√©cut√© dans l'application**, allez √† l'activit√© appel√©e par le lien profond et recherchez la fonction **`onNewIntent`**.

![](<../../.gitbook/assets/image (436) (1) (1) (1).png>)

**Informations sensibles**

Chaque fois que vous trouvez un lien profond, v√©rifiez qu'il **ne re√ßoit pas de donn√©es sensibles (comme des mots de passe) via des param√®tres d'URL**, car toute autre application pourrait **usurper le lien profond et voler ces donn√©es !**

**Param√®tres dans le chemin**

Vous **devez √©galement v√©rifier si un lien profond utilise un param√®tre √† l'int√©rieur du chemin** de l'URL comme : `https://api.example.com/v1/users/{username}`, dans ce cas, vous pouvez forcer une travers√©e de chemin en acc√©dant √† quelque chose comme : `example://app/users?username=../../unwanted-endpoint%3fparam=value`.\
Notez que si vous trouvez les bons points de terminaison √† l'int√©rieur de l'application, vous pourriez √™tre en mesure de provoquer une **Redirection Ouverte** (si une partie du chemin est utilis√©e comme nom de domaine), une **prise de contr√¥le de compte** (si vous pouvez modifier les d√©tails des utilisateurs sans jeton CSRF et que le point de terminaison vuln√©rable utilise la m√©thode correcte) et toute autre vuln√©rabilit√©. Plus d'[informations √† ce sujet ici](http://dphoeniixx.com/2020/12/13-2/).

**Plus d'exemples**

Un [rapport de prime de bug int√©ressant](https://hackerone.com/reports/855618) sur les liens (_/.well-known/assetlinks.json_).

### Inspections de la couche de transport et √©checs de v√©rification

* Les **certificats ne sont pas toujours inspect√©s correctement** par les applications Android. Il est courant que ces applications ignorent les avertissements et acceptent les certificats auto-sign√©s ou, dans certains cas, reviennent √† utiliser des connexions HTTP.
* Les **n√©gociations pendant la poign√©e de main SSL/TLS sont parfois faibles**, utilisant des suites de chiffrement non s√©curis√©es. Cette vuln√©rabilit√© rend la connexion susceptible aux attaques de l'homme du milieu (MITM), permettant aux attaquants de d√©crypter les donn√©es.
* **La fuite d'informations priv√©es** est un risque lorsque les applications s'authentifient en utilisant des canaux s√©curis√©s mais communiquent ensuite via des canaux non s√©curis√©s pour d'autres transactions. Cette approche ne prot√®ge pas les donn√©es sensibles, telles que les cookies de session ou les d√©tails des utilisateurs, contre l'interception par des entit√©s malveillantes.

#### V√©rification des certificats

Nous allons nous concentrer sur la **v√©rification des certificats**. L'int√©grit√© du certificat du serveur doit √™tre v√©rifi√©e pour renforcer la s√©curit√©. C'est crucial car les configurations TLS non s√©curis√©es et la transmission de donn√©es sensibles sur des canaux non chiffr√©s peuvent poser des risques importants. Pour des √©tapes d√©taill√©es sur la v√©rification des certificats de serveur et la r√©solution des vuln√©rabilit√©s, [**cette ressource**](https://manifestsecurity.com/android-application-security-part-10/) fournit des conseils complets.

#### √âpinglage SSL

L'√©pinglage SSL est une mesure de s√©curit√© o√π l'application v√©rifie le certificat du serveur par rapport √† une copie connue stock√©e √† l'int√©rieur de l'application elle-m√™me. Cette m√©thode est essentielle pour pr√©venir les attaques MITM. Il est fortement recommand√© de mettre en ≈ìuvre l'√©pinglage SSL pour les applications manipulant des informations sensibles.

#### Inspection du trafic

Pour inspecter le trafic HTTP, il est n√©cessaire d'**installer le certificat de l'outil proxy** (par exemple, Burp). Sans installer ce certificat, le trafic chiffr√© pourrait ne pas √™tre visible via le proxy. Pour un guide sur l'installation d'un certificat CA personnalis√©, [**cliquez ici**](avd-android-virtual-device.md#install-burp-certificate-on-a-virtual-machine).

Les applications ciblant **le niveau API 24 et sup√©rieur** n√©cessitent des modifications de la Configuration de s√©curit√© r√©seau pour accepter le certificat CA du proxy. Cette √©tape est cruciale pour inspecter le trafic chiffr√©. Pour des instructions sur la modification de la Configuration de s√©curit√© r√©seau, [**consultez ce tutoriel**](make-apk-accept-ca-certificate.md).

#### Contournement de l'√©pinglage SSL

Lorsque l'√©pinglage SSL est mis en ≈ìuvre, contourner cette protection devient n√©cessaire pour inspecter le trafic HTTPS. Diverses m√©thodes sont disponibles √† cette fin :

* Modifier automatiquement l'**apk** pour **contourner** l'√©pinglage SSL avec [**apk-mitm**](https://github.com/shroudedcode/apk-mitm). Le principal avantage de cette option est que vous n'aurez pas besoin de root pour contourner l'√©pinglage SSL, mais vous devrez supprimer l'application et r√©installer la nouvelle, et cela ne fonctionnera pas toujours.
* Vous pourriez utiliser **Frida** (discut√© ci-dessous) pour contourner cette protection. Voici un guide pour utiliser Burp+Frida+Genymotion : [https://spenkk.github.io/bugbounty/Configuring-Frida-with-Burp-and-GenyMotion-to-bypass-SSL-Pinning/](https://spenkk.github.io/bugbounty/Configuring-Frida-with-Burp-and-GenyMotion-to-bypass-SSL-Pinning/)
* Vous pouvez √©galement essayer de **contourner automatiquement l'√©pinglage SSL** en utilisant [**objection**](frida-tutorial/objection-tutorial.md)**:** `objection --gadget com.package.app explore --startup-command "android sslpinning disable"`
* Vous pouvez √©galement essayer de **contourner automatiquement l'√©pinglage SSL** en utilisant **l'analyse dynamique MobSF** (expliqu√©e ci-dessous)
* Si vous pensez toujours qu'il y a du trafic que vous ne capturez pas, vous pouvez essayer de **rediriger le trafic vers Burp en utilisant iptables**. Lisez ce blog : [https://infosecwriteups.com/bypass-ssl-pinning-with-ip-forwarding-iptables-568171b52b62](https://infosecwriteups.com/bypass-ssl-pinning-with-ip-forwarding-iptables-568171b52b62)

#### Recherche de vuln√©rabilit√©s web courantes

Il est √©galement important de rechercher des vuln√©rabilit√©s web courantes dans l'application. Les informations d√©taill√©es sur l'identification et l'att√©nuation de ces vuln√©rabilit√©s d√©passent le cadre de ce r√©sum√© mais sont largement couvertes ailleurs.

### Frida

[Frida](https://www.frida.re) est une trousse d'instrumentation dynamique pour les d√©veloppeurs, les r√©tro-ing√©nieurs et les chercheurs en s√©curit√©.\
**Vous pouvez acc√©der √† l'application en cours d'ex√©cution et accrocher des m√©thodes en temps r√©el pour changer le comportement, changer les valeurs, extraire des valeurs, ex√©cuter un code diff√©rent...**\
Si vous voulez tester les applications Android, vous devez savoir comment utiliser Frida.

* Apprenez √† utiliser Frida : [**Tutoriel Frida**](frida-tutorial/)
* Quelques "GUI" pour des actions avec Frida : [**https://github.com/m0bilesecurity/RMS-Runtime-Mobile-Security**](https://github.com/m0bilesecurity/RMS-Runtime-Mobile-Security)
* Ojection est excellent pour automatiser l'utilisation de Frida : [**https://github.com/sensepost/objection**](https://github.com/sensepost/objection) **,** [**https://github.com/dpnishant/appmon**](https://github.com/dpnishant/appmon)
* Vous pouvez trouver quelques scripts Frida impressionnants ici : [**https://codeshare.frida.re/**](https://codeshare.frida.re)
* Essayez de contourner les m√©canismes anti-debugging / anti-Frida en chargeant Frida comme indiqu√© dans [https://erfur.github.io/blog/dev/code-injection-without-ptrace](https://erfur.github.io/blog/dev/code-injection-without-ptrace) (outil [linjector](https://github.com/erfur/linjector-rs))

### **Dump de m√©moire - Fridump**

V√©rifiez si l'application stocke des informations sensibles dans la m√©moire qu'elle ne devrait pas stocker comme des mots de passe ou des mn√©moniques.

En utilisant [**Fridump3**](https://github.com/rootbsd/fridump3) vous pouvez vider la m√©moire de l'application avec :
```bash
# With PID
python3 fridump3.py -u <PID>

# With name
frida-ps -Uai
python3 fridump3.py -u "<Name>"
```
Cela va vider la m√©moire dans le dossier ./dump, et l√† vous pourriez utiliser grep avec quelque chose comme :

{% code overflow="wrap" %}
```bash
strings * | grep -E "^[a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+$"
```
{% endcode %}

### **Donn√©es sensibles dans le Keystore**

Sur Android, le Keystore est le meilleur endroit pour stocker des donn√©es sensibles, cependant, avec suffisamment de privil√®ges, il est toujours **possible d'y acc√©der**. Comme les applications ont tendance √† stocker ici des **donn√©es sensibles en texte clair**, les tests d'intrusion doivent v√©rifier cela car un utilisateur root ou quelqu'un ayant un acc√®s physique √† l'appareil pourrait √™tre en mesure de voler ces donn√©es.

M√™me si une application stocke des donn√©es dans le keystore, les donn√©es doivent √™tre chiffr√©es.

Pour acc√©der aux donn√©es √† l'int√©rieur du keystore, vous pouvez utiliser ce script Frida : [https://github.com/WithSecureLabs/android-keystore-audit/blob/master/frida-scripts/tracer-cipher.js](https://github.com/WithSecureLabs/android-keystore-audit/blob/master/frida-scripts/tracer-cipher.js)
```bash
frida -U -f com.example.app -l frida-scripts/tracer-cipher.js
```
### **Contournement des empreintes digitales/biom√©trie**

En utilisant le script Frida suivant, il pourrait √™tre possible de **contourner l'authentification par empreinte digitale** que les applications Android pourraient effectuer afin de **prot√©ger certaines zones sensibles :**

{% code overflow="wrap" %}
```bash
frida --codeshare krapgras/android-biometric-bypass-update-android-11 -U -f <app.package>
```
{% endcode %}

### **Images d'arri√®re-plan**

Lorsque vous mettez une application en arri√®re-plan, Android stocke une **capture d'√©cran de l'application** afin que lorsqu'elle est ramen√©e √† l'avant-plan, elle commence √† charger l'image avant l'application pour donner l'impression que l'application a √©t√© charg√©e plus rapidement.

Cependant, si cette capture d'√©cran contient des **informations sensibles**, une personne ayant acc√®s √† la capture d'√©cran pourrait **voler ces informations** (notez que vous avez besoin des droits root pour y acc√©der).

Les captures d'√©cran sont g√©n√©ralement stock√©es autour de : **`/data/system_ce/0/snapshots`**

Android propose un moyen de **pr√©venir la capture d'√©cran en d√©finissant le param√®tre de mise en page FLAG\_SECURE**. En utilisant ce drapeau, le contenu de la fen√™tre est trait√© comme s√©curis√©, l'emp√™chant d'appara√Ætre dans les captures d'√©cran ou d'√™tre affich√© sur des √©crans non s√©curis√©s.
```bash
getWindow().setFlags(LayoutParams.FLAG_SECURE, LayoutParams.FLAG_SECURE);
```
### **Analyseur d'Application Android**

Cet outil pourrait vous aider √† g√©rer diff√©rents outils lors de l'analyse dynamique : [https://github.com/NotSoSecure/android\_application\_analyzer](https://github.com/NotSoSecure/android\_application\_analyzer)

### Injection d'Intent

Les d√©veloppeurs cr√©ent souvent des composants proxy tels que des activit√©s, des services et des r√©cepteurs de diffusion qui g√®rent ces Intents et les transmettent √† des m√©thodes telles que `startActivity(...)` ou `sendBroadcast(...)`, ce qui peut √™tre risqu√©.

Le danger r√©side dans le fait de permettre aux attaquants de d√©clencher des composants d'application non export√©s ou d'acc√©der √† des fournisseurs de contenu sensibles en d√©tournant ces Intents. Un exemple notable est le composant `WebView` qui convertit les URL en objets `Intent` via `Intent.parseUri(...)` puis les ex√©cute, ce qui peut potentiellement entra√Æner des injections d'Intent malveillantes.

### Points Essentiels

* **Injection d'Intent** est similaire au probl√®me de redirection ouverte sur le web.
* Les exploits impliquent le passage d'objets `Intent` en tant qu'extra, qui peuvent √™tre redirig√©s pour ex√©cuter des op√©rations non s√©curis√©es.
* Cela peut exposer des composants non export√©s et des fournisseurs de contenu aux attaquants.
* La conversion d'URL en `Intent` par `WebView` peut faciliter des actions non intentionnelles.

### Injections C√¥t√© Client Android et autres

Vous connaissez probablement ce type de vuln√©rabilit√©s du Web. Vous devez √™tre particuli√®rement prudent avec ces vuln√©rabilit√©s dans une application Android :

* **Injection SQL :** Lorsque vous travaillez avec des requ√™tes dynamiques ou des Content-Providers, assurez-vous d'utiliser des requ√™tes param√©tr√©es.
* **Injection JavaScript (XSS) :** V√©rifiez que le support JavaScript et des plugins est d√©sactiv√© pour toutes les WebViews (d√©sactiv√© par d√©faut). [Plus d'informations ici](webview-attacks.md#javascript-enabled).
* **Inclusion de Fichiers Locaux :** Les WebViews doivent avoir l'acc√®s au syst√®me de fichiers d√©sactiv√© (activ√© par d√©faut) - `(webview.getSettings().setAllowFileAccess(false);)`. [Plus d'informations ici](webview-attacks.md#javascript-enabled).
* **Cookies √âternels :** Dans plusieurs cas, lorsque l'application Android termine la session, le cookie n'est pas r√©voqu√© ou peut m√™me √™tre enregistr√© sur le disque.
* [**Drapeau de S√©curit√©** dans les cookies](../../pentesting-web/hacking-with-cookies/#cookies-flags)

***

<figure><img src="../../.gitbook/assets/image (377).png" alt=""><figcaption></figcaption></figure>

Rejoignez le serveur [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) pour communiquer avec des hackers exp√©riment√©s et des chasseurs de primes !

**Perspectives sur le Hacking**\
Engagez-vous avec du contenu qui explore l'excitation et les d√©fis du hacking

**Actualit√©s sur le Hacking en Temps R√©el**\
Restez √† jour avec le monde du hacking en √©volution rapide gr√¢ce aux actualit√©s et aux informations en temps r√©el

**Derni√®res Annonces**\
Restez inform√© des derni√®res primes de bugs lanc√©es et des mises √† jour cruciales de la plateforme

**Rejoignez-nous sur** [**Discord**](https://discord.com/invite/N3FrSbmwdy) et commencez √† collaborer avec les meilleurs hackers d√®s aujourd'hui !

## Analyse Automatique

### [MobSF](https://github.com/MobSF/Mobile-Security-Framework-MobSF)

**Analyse statique**

![](<../../.gitbook/assets/image (863).png>)

**√âvaluation des vuln√©rabilit√©s de l'application** en utilisant une interface web conviviale. Vous pouvez √©galement effectuer une analyse dynamique (mais vous devez pr√©parer l'environnement).
```bash
docker pull opensecurity/mobile-security-framework-mobsf
docker run -it -p 8000:8000 opensecurity/mobile-security-framework-mobsf:latest
```
Notez que MobSF peut analyser les applications **Android**(apk), **IOS**(ipa) et **Windows**(apx) (_les applications Windows doivent √™tre analys√©es √† partir d'un MobSF install√© sur un h√¥te Windows_).\
De plus, si vous cr√©ez un fichier **ZIP** avec le code source d'une application **Android** ou **IOS** (allez dans le dossier racine de l'application, s√©lectionnez tout et cr√©ez un fichier ZIP), MobSF pourra √©galement l'analyser.

MobSF vous permet √©galement de **diff/Comparer** les analyses et d'int√©grer **VirusTotal** (vous devrez d√©finir votre cl√© API dans _MobSF/settings.py_ et l'activer : `VT_ENABLED = TRUE` `VT_API_KEY = <Votre cl√© API>` `VT_UPLOAD = TRUE`). Vous pouvez √©galement d√©finir `VT_UPLOAD` sur `False`, puis le **hash** sera **t√©l√©charg√©** au lieu du fichier.

### Analyse dynamique assist√©e avec MobSF

**MobSF** peut √©galement √™tre tr√®s utile pour l'**analyse dynamique** sur **Android**, mais dans ce cas, vous devrez installer MobSF et **genymotion** sur votre h√¥te (une machine virtuelle ou Docker ne fonctionnera pas). _Remarque : Vous devez **d'abord d√©marrer une machine virtuelle dans genymotion** et **ensuite MobSF**._\
L'**analyseur dynamique MobSF** peut :

* **Extraire les donn√©es de l'application** (URL, journaux, presse-papiers, captures d'√©cran r√©alis√©es par vous, captures d'√©cran r√©alis√©es par "**Exported Activity Tester**", e-mails, bases de donn√©es SQLite, fichiers XML, et autres fichiers cr√©√©s). Tout cela est fait automatiquement sauf pour les captures d'√©cran, vous devez appuyer lorsque vous voulez une capture d'√©cran ou vous devez appuyer sur "**Exported Activity Tester**" pour obtenir des captures d'√©cran de toutes les activit√©s export√©es.
* Capturer le **trafic HTTPS**
* Utiliser **Frida** pour obtenir des **informations en temps r√©el**

√Ä partir des versions d'Android > 5, il **d√©marrera automatiquement Frida** et d√©finira les param√®tres de **proxy** globaux pour **capturer** le trafic. Il ne capturera le trafic que de l'application test√©e.

**Frida**

Par d√©faut, il utilisera √©galement certains scripts Frida pour **contourner l'√©pinglage SSL**, la **d√©tection de root** et la **d√©tection de d√©bogueur** et pour **surveiller les API int√©ressantes**.\
MobSF peut √©galement **appeler des activit√©s export√©es**, capturer des **captures d'√©cran** et les **sauvegarder** pour le rapport.

Pour **d√©marrer** le test dynamique, appuyez sur le bouton vert : "**Start Instrumentation**". Appuyez sur "**Frida Live Logs**" pour voir les journaux g√©n√©r√©s par les scripts Frida et "**Live API Monitor**" pour voir toutes les invocations des m√©thodes accroch√©es, les arguments pass√©s et les valeurs retourn√©es (cela appara√Ætra apr√®s avoir appuy√© sur "Start Instrumentation").\
MobSF vous permet √©galement de charger vos propres **scripts Frida** (pour envoyer les r√©sultats de vos scripts Frida √† MobSF, utilisez la fonction `send()`). Il dispose √©galement de **plusieurs scripts pr√©-√©crits** que vous pouvez charger (vous pouvez en ajouter d'autres dans `MobSF/DynamicAnalyzer/tools/frida_scripts/others/`), il vous suffit de les s√©lectionner, d'appuyer sur "**Load**" et d'appuyer sur "**Start Instrumentation**" (vous pourrez voir les journaux de ces scripts √† l'int√©rieur de "**Frida Live Logs**").

![](<../../.gitbook/assets/image (416).png>)

De plus, vous disposez de certaines fonctionnalit√©s auxiliaires Frida :

* **√ânum√©rer les classes charg√©es** : Il affichera toutes les classes charg√©es
* **Capturer les cha√Ænes** : Il affichera toutes les cha√Ænes captur√©es lors de l'utilisation de l'application (tr√®s bruyant)
* **Capturer les comparaisons de cha√Ænes** : Peut √™tre tr√®s utile. Il **affichera les 2 cha√Ænes compar√©es** et si le r√©sultat √©tait Vrai ou Faux.
* **√ânum√©rer les m√©thodes de classe** : Mettez le nom de la classe (comme "java.io.File") et il affichera toutes les m√©thodes de la classe.
* **Rechercher un motif de classe** : Rechercher des classes par motif
* **Tracer les m√©thodes de classe** : **Tracer** une **classe enti√®re** (voir les entr√©es et sorties de toutes les m√©thodes de la classe). Rappelez-vous que par d√©faut, MobSF trace plusieurs m√©thodes int√©ressantes de l'API Android.

Une fois que vous avez s√©lectionn√© le module auxiliaire que vous souhaitez utiliser, appuyez sur "**Start Intrumentation**" et vous verrez toutes les sorties dans "**Frida Live Logs**".

**Shell**

Mobsf vous propose √©galement un shell avec quelques commandes **adb**, des commandes **MobSF**, et des commandes **shell** courantes en bas de la page d'analyse dynamique. Quelques commandes int√©ressantes:
```bash
help
shell ls
activities
exported_activities
services
receivers
```
**Outils HTTP**

Lorsque le trafic http est captur√©, vous pouvez voir une vue peu attrayante du trafic captur√© sur le bas de "**HTTP(S) Traffic**" ou une vue plus agr√©able sur le bouton vert "**Start HTTPTools**". √Ä partir de la deuxi√®me option, vous pouvez **envoyer** les **requ√™tes captur√©es** vers des **proxies** comme Burp ou Owasp ZAP.\
Pour ce faire, _allumez Burp -->_ _d√©sactivez Intercept --> dans MobSB HTTPTools s√©lectionnez la requ√™te_ --> appuyez sur "**Send to Fuzzer**" --> _s√©lectionnez l'adresse du proxy_ ([http://127.0.0.1:8080\\](http://127.0.1:8080)).

Une fois que vous avez termin√© l'analyse dynamique avec MobSF, vous pouvez appuyer sur "**Start Web API Fuzzer**" pour **fuzzer les requ√™tes http** et rechercher des vuln√©rabilit√©s.

{% hint style="info" %}
Apr√®s avoir effectu√© une analyse dynamique avec MobSF, les param√®tres du proxy peuvent √™tre mal configur√©s et vous ne pourrez pas les corriger depuis l'interface graphique. Vous pouvez corriger les param√®tres du proxy en effectuant :
```
adb shell settings put global http_proxy :0
```
{% endhint %}

### Analyse dynamique assist√©e avec Inspeckage

Vous pouvez obtenir l'outil sur [**Inspeckage**](https://github.com/ac-pm/Inspeckage).\
Cet outil utilisera certains **Hooks** pour vous informer de **ce qui se passe dans l'application** pendant que vous effectuez une **analyse dynamique**.

### [Yaazhini](https://www.vegabird.com/yaazhini/)

C'est un **excellent outil pour effectuer une analyse statique avec une interface graphique**

![](<../../.gitbook/assets/image (738).png>)

### [Qark](https://github.com/linkedin/qark)

Cet outil est con√ßu pour rechercher plusieurs **vuln√©rabilit√©s d'application Android li√©es √† la s√©curit√©**, que ce soit dans le **code source** ou dans les **APK empaquet√©s**. L'outil est √©galement **capable de cr√©er un APK d√©ployable "Proof-of-Concept"** et des **commandes ADB** pour exploiter certaines des vuln√©rabilit√©s trouv√©es (activit√©s expos√©es, intentions, tapjacking...). Comme avec Drozer, il n'est pas n√©cessaire de rooter l'appareil de test.
```bash
pip3 install --user qark  # --user is only needed if not using a virtualenv
qark --apk path/to/my.apk
qark --java path/to/parent/java/folder
qark --java path/to/specific/java/file.java
```
### [**ReverseAPK**](https://github.com/1N3/ReverseAPK.git)

* Affiche tous les fichiers extraits pour une r√©f√©rence facile
* D√©compile automatiquement les fichiers APK au format Java et Smali
* Analyse AndroidManifest.xml pour les vuln√©rabilit√©s et comportements courants
* Analyse statique du code source pour les vuln√©rabilit√©s et comportements courants
* Informations sur l'appareil
* et plus
```bash
reverse-apk relative/path/to/APP.apk
```
### [SUPER Android Analyzer](https://github.com/SUPERAndroidAnalyzer/super)

SUPER est une application en ligne de commande qui peut √™tre utilis√©e sous Windows, MacOS X et Linux, pour analyser les fichiers _.apk_ √† la recherche de vuln√©rabilit√©s. Cela se fait en d√©compressant les APK et en appliquant une s√©rie de r√®gles pour d√©tecter ces vuln√©rabilit√©s.

Toutes les r√®gles sont regroup√©es dans un fichier `rules.json`, et chaque entreprise ou testeur peut cr√©er ses propres r√®gles pour analyser ce dont ils ont besoin.

T√©l√©chargez les derniers binaires sur la [page de t√©l√©chargement](https://superanalyzer.rocks/download.html)
```
super-analyzer {apk_file}
```
### [StaCoAn](https://github.com/vincentcox/StaCoAn)

![](<../../.gitbook/assets/image (294).png>)

StaCoAn est un outil **multiplateforme** qui aide les d√©veloppeurs, les chasseurs de bugs et les hackers √©thiques √† effectuer une [analyse de code statique](https://en.wikipedia.org/wiki/Static\_program\_analysis) sur les applications mobiles.

Le concept est que vous faites glisser et d√©posez votre fichier d'application mobile (un fichier .apk ou .ipa) sur l'application StaCoAn et elle g√©n√©rera un rapport visuel et portable pour vous. Vous pouvez ajuster les param√®tres et les listes de mots pour obtenir une exp√©rience personnalis√©e.

T√©l√©chargez la [derni√®re version](https://github.com/vincentcox/StaCoAn/releases) :
```
./stacoan
```
### [AndroBugs](https://github.com/AndroBugs/AndroBugs\_Framework)

AndroBugs Framework est un syst√®me d'analyse de vuln√©rabilit√©s Android qui aide les d√©veloppeurs ou les hackers √† trouver des vuln√©rabilit√©s de s√©curit√© potentielles dans les applications Android.\
[T√©l√©chargements pour Windows](https://github.com/AndroBugs/AndroBugs\_Framework/releases)
```
python androbugs.py -f [APK file]
androbugs.exe -f [APK file]
```
### [Androwarn](https://github.com/maaaaz/androwarn)

**Androwarn** est un outil dont le but principal est de d√©tecter et avertir l'utilisateur des comportements malveillants potentiels d√©velopp√©s par une application Android.

La d√©tection est effectu√©e avec l'**analyse statique** du bytecode Dalvik de l'application, repr√©sent√© sous forme de **Smali**, avec la biblioth√®que [`androguard`](https://github.com/androguard/androguard).

Cet outil recherche les **comportements courants des applications "malveillantes"** tels que : l'exfiltration des identifiants de t√©l√©phonie, l'interception du flux audio/vid√©o, la modification des donn√©es PIM, l'ex√©cution de code arbitraire...
```
python androwarn.py -i my_application_to_be_analyzed.apk -r html -v 3
```
### [Cadre MARA](https://github.com/xtiankisutsa/MARA_Framework)

![](<../../.gitbook/assets/image (592).png>)

**MARA** est un **Cadre d'Ing√©nierie Inverse et d'Analyse d'Applications Mobiles**. C'est un outil qui regroupe des outils couramment utilis√©s pour l'ing√©nierie inverse et l'analyse d'applications mobiles, pour aider √† tester les applications mobiles contre les menaces de s√©curit√© mobiles de l'OWASP. Son objectif est de rendre cette t√¢che plus facile et conviviale pour les d√©veloppeurs d'applications mobiles et les professionnels de la s√©curit√©.

Il est capable de :

* Extraire du code Java et Smali en utilisant diff√©rents outils
* Analyser les APK en utilisant : [smalisca](https://github.com/dorneanu/smalisca), [ClassyShark](https://github.com/google/android-classyshark), [androbugs](https://github.com/AndroBugs/AndroBugs_Framework), [androwarn](https://github.com/maaaaz/androwarn), [APKiD](https://github.com/rednaga/APKiD)
* Extraire des informations priv√©es de l'APK en utilisant des expressions r√©guli√®res.
* Analyser le Manifeste.
* Analyser les domaines trouv√©s en utilisant : [pyssltest](https://github.com/moheshmohan/pyssltest), [testssl](https://github.com/drwetter/testssl.sh) et [whatweb](https://github.com/urbanadventurer/WhatWeb)
* D√©obfusquer l'APK via [apk-deguard.com](http://www.apk-deguard.com)

### Koodous

Utile pour d√©tecter les logiciels malveillants : [https://koodous.com/](https://koodous.com)

## Obfuscation/D√©obfuscation du code

Notez que selon le service et la configuration que vous utilisez pour obfusquer le code. Les secrets peuvent √™tre ou non obfusqu√©s.

### [ProGuard](https://en.wikipedia.org/wiki/ProGuard\_\(software\))

D'apr√®s [Wikipedia](https://en.wikipedia.org/wiki/ProGuard\_\(software\)): **ProGuard** est un outil en ligne de commande open source qui r√©duit, optimise et obfusque le code Java. Il est capable d'optimiser le bytecode ainsi que de d√©tecter et supprimer les instructions inutilis√©es. ProGuard est un logiciel libre distribu√© sous la licence publique g√©n√©rale GNU, version 2.

ProGuard est distribu√© dans le cadre du SDK Android et s'ex√©cute lors de la construction de l'application en mode release.

### [DexGuard](https://www.guardsquare.com/dexguard)

Trouvez un guide √©tape par √©tape pour d√©obfusquer l'APK sur [https://blog.lexfo.fr/dexguard.html](https://blog.lexfo.fr/dexguard.html)

(Dans ce guide) La derni√®re fois que nous avons v√©rifi√©, le mode de fonctionnement de Dexguard √©tait :

* charger une ressource en tant qu'InputStream ;
* transmettre le r√©sultat √† une classe h√©ritant de FilterInputStream pour le d√©crypter ;
* effectuer une obfuscation inutile pour perdre quelques minutes de temps √† un r√©viseur ;
* transmettre le r√©sultat d√©crypt√© √† un ZipInputStream pour obtenir un fichier DEX ;
* enfin, charger le DEX r√©sultant en tant que ressource en utilisant la m√©thode `loadDex`.

### [DeGuard](http://apk-deguard.com)

**DeGuard inverse le processus d'obfuscation effectu√© par les outils d'obfuscation Android. Cela permet de nombreuses analyses de s√©curit√©, y compris l'inspection du code et la pr√©diction des biblioth√®ques.**

Vous pouvez t√©l√©charger un APK obfusqu√© sur leur plateforme.

### [Simplify](https://github.com/CalebFenton/simplify)

C'est un **d√©obfuscateur Android g√©n√©rique.** Simplify **ex√©cute virtuellement une application** pour comprendre son comportement, puis **essaie d'optimiser le code** pour qu'il se comporte de mani√®re identique mais soit plus facile √† comprendre pour un humain. Chaque type d'optimisation est simple et g√©n√©rique, donc peu importe le type sp√©cifique d'obfuscation utilis√©.

### [APKiD](https://github.com/rednaga/APKiD)

APKiD vous donne des informations sur **comment un APK a √©t√© cr√©√©**. Il identifie de nombreux **compilateurs**, **packers**, **obfuscateurs**, et d'autres choses √©tranges. C'est [_PEiD_](https://www.aldeid.com/wiki/PEiD) pour Android.

### Manuel

[Lisez ce tutoriel pour apprendre quelques astuces sur **comment inverser l'obfuscation personnalis√©e**](manual-deobfuscation.md)

## Laboratoires

### [Androl4b](https://github.com/sh4hin/Androl4b)

AndroL4b est une machine virtuelle de s√©curit√© Android bas√©e sur ubuntu-mate qui inclut la collection des derniers frameworks, tutoriels et laboratoires de diff√©rents geeks de la s√©curit√© et chercheurs pour l'ing√©nierie inverse et l'analyse de logiciels malveillants.

## R√©f√©rences

* [https://owasp.org/www-project-mobile-app-security/](https://owasp.org/www-project-mobile-app-security/)
* [https://appsecwiki.com/#/](https://appsecwiki.com/#/) C'est une excellente liste de ressources
* [https://maddiestone.github.io/AndroidAppRE/](https://maddiestone.github.io/AndroidAppRE/) Cours rapide sur Android
* [https://manifestsecurity.com/android-application-security/](https://manifestsecurity.com/android-application-security/)
* [https://github.com/Ralireza/Android-Security-Teryaagh](https://github.com/Ralireza/Android-Security-Teryaagh)
* [https://www.youtube.com/watch?v=PMKnPaGWxtg\&feature=youtu.be\&ab\_channel=B3nacSec](https://www.youtube.com/watch?v=PMKnPaGWxtg\&feature=youtu.be\&ab\_channel=B3nacSec)

## √Ä essayer

* [https://www.vegabird.com/yaazhini/](https://www.vegabird.com/yaazhini/)
* [https://github.com/abhi-r3v0/Adhrit](https://github.com/abhi-r3v0/Adhrit)

<figure><img src="../../.gitbook/assets/image (377).png" alt=""><figcaption></figcaption></figure>

Rejoignez le serveur [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) pour communiquer avec des hackers exp√©riment√©s et des chasseurs de bugs !

**Perspectives sur le Hacking**\
Engagez-vous avec du contenu qui explore le frisson et les d√©fis du hacking

**Actualit√©s sur le Hacking en Temps R√©el**\
Restez inform√© sur le monde du hacking √† rythme rapide gr√¢ce aux actualit√©s et aux analyses en temps r√©el

**Derni√®res Annonces**\
Restez inform√© des derni√®res primes de bugs lanc√©es et des mises √† jour cruciales de la plateforme

**Rejoignez-nous sur** [**Discord**](https://discord.com/invite/N3FrSbmwdy) et commencez √† collaborer avec les meilleurs hackers d√®s aujourd'hui !

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres fa√ßons de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Rejoignez** üí¨ le **groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
