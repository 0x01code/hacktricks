# Test d'applications Android

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Expert en √©quipe rouge AWS de HackTricks)</strong></a><strong>!</strong></summary>

Autres fa√ßons de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFT**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

Rejoignez le serveur [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) pour communiquer avec des pirates exp√©riment√©s et des chasseurs de primes !

**Perspectives de piratage**\
Engagez-vous avec du contenu qui explore le frisson et les d√©fis du piratage

**Actualit√©s de piratage en temps r√©el**\
Restez inform√© du monde du piratage en √©volution rapide gr√¢ce √† des actualit√©s et des informations en temps r√©el

**Derni√®res annonces**\
Restez inform√© des derni√®res primes de bugs lanc√©es et des mises √† jour cruciales de la plateforme

**Rejoignez-nous sur** [**Discord**](https://discord.com/invite/N3FrSbmwdy) et commencez √† collaborer avec les meilleurs pirates d√®s aujourd'hui !

## Bases des applications Android

Il est fortement recommand√© de commencer par lire cette page pour en savoir plus sur les **parties les plus importantes li√©es √† la s√©curit√© Android et les composants les plus dangereux dans une application Android** :

{% content-ref url="android-applications-basics.md" %}
[android-applications-basics.md](android-applications-basics.md)
{% endcontent-ref %}

## ADB (Android Debug Bridge)

C'est l'outil principal dont vous avez besoin pour vous connecter √† un appareil Android (√©mul√© ou physique).\
Il vous permet de contr√¥ler votre appareil via **USB** ou **R√©seau** depuis un ordinateur, **copier** des fichiers dans les deux sens, **installer** et d√©sinstaller des applications, ex√©cuter des commandes **shell**, effectuer des **sauvegardes**, lire des **logs** et plus encore.

Jetez un ≈ìil √† la liste suivante des [**Commandes ADB**](adb-commands.md) pour apprendre √† utiliser adb.

## Smali

Parfois, il est int√©ressant de **modifier le code de l'application** pour acc√©der √† des **informations cach√©es** (peut-√™tre des mots de passe bien obfusqu√©s ou des indicateurs). Ensuite, il pourrait √™tre int√©ressant de d√©compiler l'APK, modifier le code et le recompiler.\
[Dans ce tutoriel](smali-changes.md), vous pouvez **apprendre √† d√©compiler un APK, modifier le code Smali et recompiler l'APK** avec la nouvelle fonctionnalit√©. Cela pourrait √™tre tr√®s utile comme **alternative pour plusieurs tests pendant l'analyse dynamique** qui vont √™tre pr√©sent√©s. Ensuite, **gardez toujours √† l'esprit cette possibilit√©**.

## Autres astuces int√©ressantes

* [Fausser votre emplacement dans le Play Store](spoofing-your-location-in-play-store.md)
* **T√©l√©charger des APK** : [https://apps.evozi.com/apk-downloader/](https://apps.evozi.com/apk-downloader/), [https://apkpure.com/es/](https://apkpure.com/es/), [https://www.apkmirror.com/](https://www.apkmirror.com), [https://apkcombo.com/es-es/apk-downloader/](https://apkcombo.com/es-es/apk-downloader/)
* Extraire un APK de l'appareil :
```bash
adb shell pm list packages
com.android.insecurebankv2

adb shell pm path com.android.insecurebankv2
package:/data/app/com.android.insecurebankv2-Jnf8pNgwy3QA_U5f-n_4jQ==/base.apk

adb pull /data/app/com.android.insecurebankv2- Jnf8pNgwy3QA_U5f-n_4jQ==/base.apk
```
## Analyse statique

Tout d'abord, pour analyser un APK, vous devriez **jeter un ≈ìil au code Java** en utilisant un d√©compilateur.\
Veuillez [**lire ici pour trouver des informations sur les diff√©rents d√©compilateurs disponibles**](apk-decompilers.md).

### Recherche d'informations int√©ressantes

En examinant simplement les **cha√Ænes de caract√®res** de l'APK, vous pouvez rechercher des **mots de passe**, des **URL** ([https://github.com/ndelphit/apkurlgrep](https://github.com/ndelphit/apkurlgrep)), des **cl√©s API**, du **chiffrement**, des **UUID Bluetooth**, des **jetons** et tout ce qui est int√©ressant... cherchez m√™me des **backdoors** d'ex√©cution de code ou des backdoors d'authentification (identifiants administrateur cod√©s en dur dans l'application).

**Firebase**

Portez une attention particuli√®re aux **URL Firebase** et v√©rifiez si elles sont mal configur√©es. [Plus d'informations sur ce qu'est Firebase et comment l'exploiter ici.](../../network-services-pentesting/pentesting-web/buckets/firebase-database.md)

### Compr√©hension de base de l'application - Manifest.xml, strings.xml

En utilisant l'un des **d√©compilateurs** mentionn√©s [**ici**](apk-decompilers.md), vous pourrez lire le _Manifest.xml_. Vous pouvez √©galement **renommer** l'extension du fichier **apk en .zip** et le **d√©zipper**.\
En lisant le **manifest**, vous pouvez trouver des **vuln√©rabilit√©s** :

* Tout d'abord, v√©rifiez si **l'application est d√©bogable**. Un APK de production ne devrait pas l'√™tre (sinon d'autres pourront s'y connecter). Vous pouvez v√©rifier si une application est d√©bogable en cherchant dans le manifest l'attribut `debuggable="true"` √† l'int√©rieur de la balise _\<application_ Exemple : `<application theme="@2131296387" debuggable="true"`
* [Apprenez ici](drozer-tutorial/#is-debuggeable) comment trouver des applications d√©bogables sur un t√©l√©phone et les exploiter
* **Sauvegarde** : L'attribut **`android:allowBackup`** d√©finit si les donn√©es de l'application peuvent √™tre sauvegard√©es et restaur√©es par un utilisateur ayant activ√© le d√©bogage USB. Si le drapeau de sauvegarde est d√©fini sur true, cela permet √† un attaquant de sauvegarder les donn√©es de l'application via adb m√™me si l'appareil n'est pas root√©. Par cons√©quent, les applications qui g√®rent et stockent des informations sensibles telles que les d√©tails de carte, les mots de passe, etc. devraient avoir ce param√®tre explicitement d√©fini sur **false** car par d√©faut il est d√©fini sur **true** pour √©viter de tels risques.
* `<application android:allowBackup="false"`
* **S√©curit√© r√©seau** : La s√©curit√© r√©seau de l'application peut √©craser les valeurs par d√©faut avec **`android:networkSecurityConfig="@xml/network_security_config"`**. Un fichier portant ce nom peut √™tre plac√© dans _**res/xml.**_ Ce fichier configurera des param√®tres de s√©curit√© importants comme les √©pingles de certificat ou s'il autorise le trafic HTTP. Vous pouvez lire ici plus d'informations sur tout ce qui peut √™tre configur√©, mais v√©rifiez cet exemple sur la configuration du trafic HTTP pour certains domaines :
* `<domain-config cleartextTrafficPermitted="true"> <domain includeSubdomains="true">formation-software.co.uk </domain></domain-config>`
* **Activit√©s export√©es** : V√©rifiez les activit√©s export√©es dans le manifest car cela pourrait √™tre dangereux. Plus tard dans l'analyse dynamique, il sera expliqu√© comment [exploiter ce comportement](./#exploiting-exported-activities-authorisation-bypass).
* **Fournisseurs de contenu** : Si un fournisseur export√© est expos√©, vous pourriez acc√©der/modifier des informations int√©ressantes. Dans l'analyse dynamique, [vous apprendrez comment les exploiter](./#exploiting-content-providers-accessing-and-manipulating-sensitive-information).
* V√©rifiez les configurations des **FileProviders** dans l'attribut `android:name="android.support.FILE_PROVIDER_PATHS"`. [Lisez ici pour en savoir plus sur les FileProviders](./#fileprovider).
* **Services expos√©s** : Selon ce que fait le service en interne, des vuln√©rabilit√©s pourraient √™tre exploit√©es. Dans l'analyse dynamique, [vous apprendrez comment les exploiter](./#exploiting-services).
* **R√©cepteurs de diffusion** : [Vous apprendrez comment vous pouvez √©ventuellement les exploiter](./#exploiting-broadcast-receivers) pendant l'analyse dynamique.
* **Sch√©ma d'URL** : Lisez le code de l'activit√© g√©rant le sch√©ma et recherchez des vuln√©rabilit√©s dans la gestion de l'entr√©e de l'utilisateur. Plus d'infos sur [ce qu'est un sch√©ma d'URL ici](./#url-schemes).
* **minSdkVersion**, **targetSDKVersion**, **maxSdkVersion** : Ils indiquent les versions d'Android sur lesquelles l'application fonctionnera. Il est important de les garder √† l'esprit car du point de vue de la s√©curit√©, le support des anciennes versions permettra √† des versions d'Android vuln√©rables connues de l'ex√©cuter.

En lisant **resources.arsc/strings.xml**, vous pouvez trouver des **informations int√©ressantes** :

* Cl√©s API
* Sch√©mas personnalis√©s
* Autres informations int√©ressantes que les d√©veloppeurs enregistrent dans ce fichier

### Tapjacking

**Tapjacking** est une attaque o√π une **application malveillante** est lanc√©e et **se positionne au-dessus d'une application victime**. Une fois qu'elle obscurcit visuellement l'application victime, son interface utilisateur est con√ßue de mani√®re √† tromper l'utilisateur pour qu'il interagisse avec elle, tout en transmettant l'interaction √† l'application victime.\
En effet, cela **emp√™che l'utilisateur de savoir qu'il effectue r√©ellement des actions sur l'application victime**.

Trouvez plus d'informations dans :

{% content-ref url="tapjacking.md" %}
[tapjacking.md](tapjacking.md)
{% endcontent-ref %}

### D√©tournement de t√¢che

Une **activit√©** avec le **`launchMode`** d√©fini sur **`singleTask` sans aucune `taskAffinity`** d√©finie est vuln√©rable au d√©tournement de t√¢che. Cela signifie qu'une **application** peut √™tre install√©e et si elle est lanc√©e avant la vraie application, elle pourrait **d√©tourner la t√¢che de la vraie application** (ainsi l'utilisateur interagira avec la **mauvaise application en pensant qu'il utilise la vraie**).

Plus d'infos dans :

{% content-ref url="android-task-hijacking.md" %}
[android-task-hijacking.md](android-task-hijacking.md)
{% endcontent-ref %}

### Stockage de donn√©es non s√©curis√©

**Stockage interne**

Sur Android, les fichiers **stock√©s** dans le **stockage interne** sont **con√ßus** pour √™tre **accessibles** exclusivement par l'**application** qui les a **cr√©√©s**. Cette mesure de s√©curit√© est **appliqu√©e** par le syst√®me d'exploitation Android et est g√©n√©ralement ad√©quate pour les besoins de s√©curit√© de la plupart des applications. Cependant, les d√©veloppeurs utilisent parfois des modes tels que `MODE_WORLD_READABLE` et `MODE_WORLD_WRITABLE` pour **permettre** aux fichiers d'√™tre **partag√©s** entre diff√©rentes applications. Cependant, ces modes **ne restreignent pas l'acc√®s** √† ces fichiers par d'autres applications, y compris potentiellement malveillantes.

1. **Analyse statique :**
- **Assurez-vous** que l'utilisation de `MODE_WORLD_READABLE` et `MODE_WORLD_WRITABLE` est **soigneusement examin√©e**. Ces modes **peuvent potentiellement exposer** des fichiers √† un **acc√®s non voulu ou non autoris√©**.

2. **Analyse dynamique :**
- **V√©rifiez** les **autorisations** d√©finies sur les fichiers cr√©√©s par l'application. En particulier, **v√©rifiez** si des fichiers sont **d√©finis comme lisibles ou modifiables mondialement**. Cela peut poser un risque de s√©curit√© important, car cela permettrait √† **n'importe quelle application** install√©e sur l'appareil, quelle que soit son origine ou son intention, de **lire ou modifier** ces fichiers.

**Stockage externe**

### Directives pour la gestion des fichiers sur le stockage externe

Lorsque vous travaillez avec des fichiers sur le **stockage externe**, comme les cartes SD, certaines pr√©cautions doivent √™tre prises :

1. **Accessibilit√©** :
- Les fichiers sur le stockage externe sont **lisibles et modifiables mondialement**. Cela signifie que n'importe quelle application ou utilisateur peut acc√©der √† ces fichiers.

2. **Pr√©occupations de s√©curit√©** :
- √âtant donn√© la facilit√© d'acc√®s, il est conseill√© de **ne pas stocker d'informations sensibles** sur le stockage externe.
- Le stockage externe peut √™tre retir√© ou acc√©d√© par n'importe quelle application, le rendant moins s√©curis√©.

3. **Traitement des donn√©es provenant du stockage externe** :
- Effectuez toujours une **validation des entr√©es** sur les donn√©es r√©cup√©r√©es depuis le stockage externe. Cela est crucial car les donn√©es proviennent d'une source non fiable.
- Il est fortement d√©conseill√© de stocker des ex√©cutables ou des fichiers de classe sur le stockage externe pour un chargement dynamique.
- Si votre application doit r√©cup√©rer des fichiers ex√©cutables depuis le stockage externe, assurez-vous que ces fichiers sont **sign√©s et v√©rifi√©s cryptographiquement** avant d'√™tre charg√©s dynamiquement. Cette √©tape est essentielle pour maintenir l'int√©grit√© de s√©curit√© de votre application.

Le stockage externe peut √™tre **acc√©d√©** dans `/storage/emulated/0`, `/sdcard`, `/mnt/sdcard`

{% hint style="info" %}
√Ä partir d'Android 4.4 (**API 17**), la carte SD a une structure de r√©pertoire qui **limite l'acc√®s d'une application au r√©pertoire sp√©cifique √† cette application**. Cela emp√™che une application malveillante d'obtenir un acc√®s en lecture ou en √©criture aux fichiers d'une autre application.
{% endhint %}

**Donn√©es sensibles stock√©es en clair**

* **Pr√©f√©rences partag√©es** : Android permet √† chaque application de facilement enregistrer des fichiers XML dans le chemin `/data/data/<nomdupackage>/shared_prefs/` et parfois il est possible de trouver des informations sensibles en clair dans ce dossier.
* **Bases de donn√©es** : Android permet √† chaque application de facilement enregistrer des bases de donn√©es SQLite dans le chemin `/data/data/<nomdupackage>/databases/` et parfois il est possible de trouver des informations sensibles en clair dans ce dossier.

### TLS cass√©

**Accepter tous les certificats**

Pour une raison quelconque, parfois les d√©veloppeurs acceptent tous les certificats m√™me si par exemple le nom d'h√¥te ne correspond pas avec des lignes de code comme celle-ci :
```java
SSLSocketFactory sf = new cc(trustStore);
sf.setHostnameVerifier(SSLSocketFactory.ALLOW_ALL_HOSTNAME_VERIFIER);
```
### Cryptographie cass√©e

**Processus de gestion de cl√©s m√©diocre**

Certains d√©veloppeurs enregistrent des donn√©es sensibles dans le stockage local et les chiffrent avec une cl√© cod√©e/pr√©visible dans le code. Cela ne devrait pas √™tre fait car une r√©tro-ing√©nierie pourrait permettre aux attaquants d'extraire les informations confidentielles.

**Utilisation d'algorithmes non s√©curis√©s et/ou obsol√®tes**

Les d√©veloppeurs ne devraient pas utiliser des **algorithmes obsol√®tes** pour effectuer des **v√©rifications d'autorisation**, **stocker** ou **envoyer** des donn√©es. Certains de ces algorithmes sont : RC4, MD4, MD5, SHA1... Si des **hashes** sont utilis√©s pour stocker des mots de passe par exemple, des hashes r√©sistants √† la **brute-force** devraient √™tre utilis√©s avec un sel.

### Autres v√©rifications

* Il est recommand√© d'**obfusquer l'APK** pour compliquer le travail de r√©tro-ing√©nierie des attaquants.
* Si l'application est sensible (comme les applications bancaires), elle devrait effectuer ses **propres v√©rifications pour voir si le mobile est root√©** et agir en cons√©quence.
* Si l'application est sensible (comme les applications bancaires), elle devrait v√©rifier si un **√©mulateur** est utilis√©.
* Si l'application est sensible (comme les applications bancaires), elle devrait **v√©rifier son int√©grit√© avant de l'ex√©cuter** pour v√©rifier si elle a √©t√© modifi√©e.
* Utilisez [**APKiD**](https://github.com/rednaga/APKiD) pour v√©rifier quel compilateur/packer/obfuscateur a √©t√© utilis√© pour construire l'APK.

### Application React Native

Consultez la page suivante pour apprendre comment acc√©der facilement au code JavaScript des applications React :

{% content-ref url="react-native-application.md" %}
[react-native-application.md](react-native-application.md)
{% endcontent-ref %}

### Applications Xamarin

Consultez la page suivante pour apprendre comment acc√©der facilement au code C# des applications Xamarin :

{% content-ref url="../xamarin-apps.md" %}
[xamarin-apps.md](../xamarin-apps.md)
{% endcontent-ref %}

### Applications Superpacked

Selon ce [**billet de blog**](https://clearbluejar.github.io/posts/desuperpacking-meta-superpacked-apks-with-github-actions/), superpacked est un m√©ta-algorithme qui compresse le contenu d'une application dans un seul fichier. Le blog parle de la possibilit√© de cr√©er une application qui d√©compresse ce type d'applications... et d'une mani√®re plus rapide qui implique d'**ex√©cuter l'application et de rassembler les fichiers d√©compress√©s du syst√®me de fichiers**.

### Analyse de code statique automatis√©e

L'outil [**mariana-trench**](https://github.com/facebook/mariana-trench) est capable de trouver des **vuln√©rabilit√©s** en **scannant** le **code** de l'application. Cet outil contient une s√©rie de **sources connues** (qui indiquent √† l'outil les **endroits** o√π l'**entr√©e** est **contr√¥l√©e par l'utilisateur**), des **sinks** (qui indiquent √† l'outil les **endroits dangereux** o√π une entr√©e utilisateur malveillante pourrait causer des dommages) et des **r√®gles**. Ces r√®gles indiquent la **combinaison** de **sources-sinks** qui indique une vuln√©rabilit√©.

Avec cette connaissance, **mariana-trench examinera le code et trouvera les vuln√©rabilit√©s possibles**.

### Secrets divulgu√©s

Une application peut contenir des secrets (cl√©s API, mots de passe, URL cach√©es, sous-domaines...) √† l'int√©rieur que vous pourriez √™tre en mesure de d√©couvrir. Vous pourriez utiliser un outil tel que [https://github.com/dwisiswant0/apkleaks](https://github.com/dwisiswant0/apkleaks)

### Contourner l'authentification biom√©trique

{% content-ref url="bypass-biometric-authentication-android.md" %}
[bypass-biometric-authentication-android.md](bypass-biometric-authentication-android.md)
{% endcontent-ref %}

### Autres fonctions int√©ressantes

* **Ex√©cution de code** : `Runtime.exec(), ProcessBuilder(), code natif : system()`
* **Envoi de SMS** : `sendTextMessage, sendMultipartTestMessage`
* **Fonctions natives** d√©clar√©es comme `native` : `public native, System.loadLibrary, System.load`
* [Lisez ceci pour apprendre **comment inverser les fonctions natives**](reversing-native-libraries.md)

### **Autres astuces**

{% content-ref url="content-protocol.md" %}
[content-protocol.md](content-protocol.md)
{% endcontent-ref %}

***

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

Rejoignez le serveur [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) pour communiquer avec des hackers exp√©riment√©s et des chasseurs de primes en s√©curit√© !

**Perspectives en piratage**\
Engagez-vous avec du contenu qui explore le frisson et les d√©fis du piratage

**Actualit√©s sur le piratage en temps r√©el**\
Restez inform√© du monde du piratage en temps r√©el gr√¢ce aux actualit√©s et aux informations

**Derni√®res annonces**\
Restez inform√© des derni√®res primes de bugs lanc√©es et des mises √† jour cruciales de la plateforme

**Rejoignez-nous sur** [**Discord**](https://discord.com/invite/N3FrSbmwdy) et commencez √† collaborer avec les meilleurs hackers d√®s aujourd'hui !

***

## Analyse dynamique

> Tout d'abord, vous avez besoin d'un environnement o√π vous pouvez installer l'application et tout l'environnement (certificat Burp CA, Drozer et Frida principalement). Par cons√©quent, un appareil root√© (√©mul√© ou non) est extr√™mement recommand√©.

### Analyse dynamique en ligne

Vous pouvez cr√©er un **compte gratuit** sur : [https://appetize.io/](https://appetize.io). Cette plateforme vous permet de **t√©l√©charger** et **ex√©cuter** des APK, ce qui est utile pour voir comment un APK se comporte.

Vous pouvez m√™me **voir les journaux de votre application** sur le web et vous connecter via **adb**.

![](<../../.gitbook/assets/image (60).png>)

Gr√¢ce √† la connexion ADB, vous pouvez utiliser **Drozer** et **Frida** √† l'int√©rieur des √©mulateurs.

### Analyse dynamique locale

#### Utilisation d'un √©mulateur

* [**Android Studio**](https://developer.android.com/studio) (Vous pouvez cr√©er des appareils **x86** et **arm**, et selon [**ceci**](https://android-developers.googleblog.com/2020/03/run-arm-apps-on-android-emulator.html) les **derni√®res versions x86** **supportent les biblioth√®ques ARM** sans avoir besoin d'un √©mulateur arm lent).
* Apprenez √† le configurer sur cette page :

{% content-ref url="avd-android-virtual-device.md" %}
[avd-android-virtual-device.md](avd-android-virtual-device.md)
{% endcontent-ref %}

* [**Genymotion**](https://www.genymotion.com/fun-zone/) **(Version gratuite :** Personal Edition, vous devez cr√©er un compte. _Il est recommand√© de **t√©l√©charger** la version **AVEC**_ _**VirtualBox** pour √©viter les erreurs potentielles._)
* [**Nox**](https://es.bignox.com) (Gratuit, mais ne prend pas en charge Frida ou Drozer).

{% hint style="info" %}
Lors de la cr√©ation d'un nouvel √©mulateur sur n'importe quelle plateforme, rappelez-vous que plus l'√©cran est grand, plus l'√©mulateur sera lent. S√©lectionnez donc de petits √©crans si possible.
{% endhint %}

Pour **installer les services Google** (comme AppStore) dans Genymotion, vous devez cliquer sur le bouton marqu√© en rouge de l'image suivante :

![](<../../.gitbook/assets/image (200) (1).png>)

De plus, notez que dans la **configuration de la machine virtuelle Android dans Genymotion**, vous pouvez s√©lectionner le mode **Bridge Network** (ce sera utile si vous vous connectez √† la machine virtuelle Android depuis une autre machine virtuelle avec les outils).

#### Utiliser un appareil physique

Vous devez activer les options de **d√©bogage** et ce serait bien si vous pouviez le **rooter** :

1. **Param√®tres**.
2. (√Ä partir d'Android 8.0) S√©lectionnez **Syst√®me**.
3. S√©lectionnez **√Ä propos du t√©l√©phone**.
4. Appuyez 7 fois sur **Num√©ro de build**.
5. Revenez en arri√®re et vous trouverez les **Options pour les d√©veloppeurs**.

> Une fois que vous avez install√© l'application, la premi√®re chose √† faire est de l'essayer et d'investiguer ce qu'elle fait, comment elle fonctionne et de vous familiariser avec elle.\
> Je vous sugg√®re de **r√©aliser cette analyse dynamique initiale en utilisant l'analyse dynamique MobSF + pidcat**, ainsi nous pourrons **apprendre comment l'application fonctionne** tandis que MobSF **capture** beaucoup de **donn√©es int√©ressantes** que vous pourrez examiner plus tard.

### Fuite de donn√©es non intentionnelle

**Journalisation**

Souvent, les d√©veloppeurs laissent des informations de d√©bogage en public. Ainsi, toute application avec l'autorisation `READ_LOGS` peut **acc√©der √† ces journaux** et peut obtenir des informations sensibles √† travers cela.\
En naviguant dans l'application, utilisez [**pidcat**](https://github.com/JakeWharton/pidcat)_(Recommand√©, plus facile √† utiliser et √† lire_) ou [adb logcat](adb-commands.md#logcat) pour lire les journaux cr√©√©s et **rechercher des informations sensibles**.

{% hint style="warning" %}
Notez que √† partir d'**Android 4.0**, les **applications ne peuvent acc√©der qu'√† leurs propres journaux**. Les applications ne peuvent donc pas acc√©der aux journaux d'autres applications.\
Quoi qu'il en soit, il est toujours recommand√© de **ne pas journaliser d'informations sensibles**.
{% endhint %}

**Mise en cache du presse-papiers**

Android fournit un **cadre bas√© sur le presse-papiers** pour fournir la fonction copier-coller dans les applications Android. Mais cela cr√©e un probl√®me s√©rieux lorsque certaines **autres applications** peuvent **acc√©der** au **presse-papiers** qui contient des donn√©es sensibles. La fonction de **copier-coller** devrait √™tre **d√©sactiv√©e** pour la **partie sensible** de l'application. Par exemple, d√©sactivez la copie des d√©tails de la carte de cr√©dit.

**Journaux de plantage**

Si une application **plante** pendant l'ex√©cution et qu'elle **enregistre des journaux** quelque part, ces journaux peuvent √™tre utiles √† un attaquant, surtout dans les cas o√π l'application Android ne peut pas √™tre r√©tro-ing√©ni√©e. Ensuite, √©vitez de cr√©er des journaux lorsque les applications plantent et si les journaux sont envoy√©s sur le r√©seau, assurez-vous qu'ils sont envoy√©s sur un canal SSL.\
En tant que testeur d'intrusion, **essayez de jeter un ≈ìil √† ces journaux**.

**Donn√©es analytiques envoy√©es √† des tiers**

La plupart des applications utilisent d'autres services dans leur application comme Google Adsense mais parfois elles **divulguent certaines donn√©es sensibles** ou des donn√©es qui ne sont pas n√©cessaires √† envoyer √† ce service. Cela peut arriver parce que le d√©veloppeur n'a pas impl√©ment√© correctement la fonctionnalit√©. Vous pouvez **v√©rifier en interceptant le trafic** de l'application et voir si des donn√©es sensibles sont envoy√©es √† des tiers ou non.

### Bases de donn√©es SQLite

La plupart des applications utiliseront des **bases de donn√©es SQLite internes** pour enregistrer des informations. Pendant le test d'intrusion, jetez un **≈ìil** aux **bases de donn√©es** cr√©√©es, aux noms des **tables** et des **colonnes** et √† toutes les **donn√©es** enregistr√©es car vous pourriez trouver des **informations sensibles** (ce qui serait une vuln√©rabilit√©).\
Les bases de donn√©es devraient √™tre situ√©es dans `/data/data/le.nom.du.package/databases` comme `/data/data/com.mwr.example.sieve/databases`

Si la base de donn√©es enregistre des informations confidentielles et est **chiffr√©e** mais que vous pouvez **trouver** le **mot de passe** √† l'int√©rieur de l'application, c'est toujours une **vuln√©rabilit√©**.

√ânum√©rez les tables en utilisant `.tables` et √©num√©rez les colonnes des tables en faisant `.schema <nom_de_la_table>`

### Drozer (Activit√©s d'exploitation, Fournisseurs de contenu et Services)

**Drozer** vous permet de **prendre le r√¥le d'une application Android** et d'interagir avec d'autres applications. Il peut faire **tout ce qu'une application install√©e peut faire**, comme utiliser le m√©canisme de communication inter-processus (IPC) d'Android et interagir avec le syst√®me d'exploitation sous-jacent. √Ä partir du [Guide Drozer](https://labs.mwrinfosecurity.com/assets/BlogFiles/mwri-drozer-user-guide-2015-03-23.pdf).\
Drozer est un outil utile pour **exploiter les activit√©s export√©es, les services export√©s et les fournisseurs de contenu** comme vous le verrez dans les sections suivantes.

### Exploitation des activit√©s export√©es

[Lisez ceci si vous voulez vous rappeler ce qu'est une activit√© Android.](android-applications-basics.md#launcher-activity-and-other-activities)\
Rappelez-vous √©galement que le code d'une activit√© commence par la m√©thode `onCreate`.

**Contournement de l'autorisation**

Lorsqu'une activit√© est export√©e, vous pouvez invoquer son √©cran √† partir d'une application externe. Par cons√©quent, si une activit√© avec des **informations sensibles** est **export√©e**, vous pourriez **contourner** les **m√©canismes d'authentification** pour y acc√©der.\
[**Apprenez comment exploiter les activit√©s export√©es avec Drozer.**](drozer-tutorial/#activities)

Vous pouvez √©galement d√©marrer une activit√© export√©e √† partir de adb :

* Le nom du package est com.example.demo
* Le nom de l'activit√© export√©e est com.example.test.MainActivity
```bash
adb shell am start -n com.example.demo/com.example.test.MainActivity
```
**REMARQUE**: MobSF d√©tectera comme malveillante l'utilisation de _**singleTask/singleInstance**_ en tant que `android:launchMode` dans une activit√©, mais en raison de [ceci](https://github.com/MobSF/Mobile-Security-Framework-MobSF/pull/750), apparemment cela n'est dangereux que sur les anciennes versions (versions d'API < 21).

{% hint style="info" %}
Notez qu'une contournement d'autorisation n'est pas toujours une vuln√©rabilit√©, cela d√©pend de la mani√®re dont le contournement fonctionne et des informations expos√©es.
{% endhint %}

**Fuite d'informations sensibles**

**Les activit√©s peuvent √©galement renvoyer des r√©sultats**. Si vous parvenez √† trouver une activit√© export√©e et non prot√©g√©e appelant la m√©thode **`setResult`** et **renvoyant des informations sensibles**, il s'agit d'une fuite d'informations sensibles.

#### Tapjacking

Si le tapjacking n'est pas emp√™ch√©, vous pourriez abuser de l'activit√© export√©e pour faire effectuer √† l'**utilisateur des actions inattendues**. Pour plus d'informations sur [**ce qu'est le Tapjacking, suivez le lien**](./#tapjacking).

### Exploitation des fournisseurs de contenu - Acc√®s et manipulation d'informations sensibles

[**Lisez ceci si vous voulez vous rappeler ce qu'est un fournisseur de contenu.**](android-applications-basics.md#content-provider)\
Les fournisseurs de contenu sont essentiellement utilis√©s pour **partager des donn√©es**. Si une application dispose de fournisseurs de contenu disponibles, vous pourriez √™tre en mesure d'**extraire des donn√©es sensibles** d'eux. Il est √©galement int√©ressant de tester d'√©ventuelles **injections SQL** et **travers√©es de chemin** car elles pourraient √™tre vuln√©rables.\
[**Apprenez comment exploiter les fournisseurs de contenu avec Drozer.**](drozer-tutorial/#content-providers)

### **Exploitation des Services**

[**Lisez ceci si vous voulez vous rappeler ce qu'est un Service.**](android-applications-basics.md#services)\
Rappelez-vous que les actions d'un Service commencent dans la m√©thode `onStartCommand`.

Un service est essentiellement quelque chose qui **peut recevoir des donn√©es**, les **traiter** et **renvoyer** (ou non) une r√©ponse. Ensuite, si une application exporte certains services, vous devriez **v√©rifier** le **code** pour comprendre ce qu'il fait et le **tester** de mani√®re **dynamique** pour extraire des informations confidentielles, contourner les mesures d'authentification...\
[**Apprenez comment exploiter les Services avec Drozer.**](drozer-tutorial/#services)

### **Exploitation des R√©cepteurs de diffusion**

[**Lisez ceci si vous voulez vous rappeler ce qu'est un R√©cepteur de diffusion.**](android-applications-basics.md#broadcast-receivers)\
Rappelez-vous que les actions d'un R√©cepteur de diffusion commencent dans la m√©thode `onReceive`.

Un r√©cepteur de diffusion attendra un type de message. Selon la mani√®re dont le r√©cepteur g√®re le message, il pourrait √™tre vuln√©rable.\
[**Apprenez comment exploiter les R√©cepteurs de diffusion avec Drozer.**](./#exploiting-broadcast-receivers)

### **Exploitation des Sch√©mas / Liens profonds**

Vous pouvez rechercher manuellement des liens profonds, en utilisant des outils comme MobSF ou des scripts comme [celui-ci](https://github.com/ashleykinguk/FBLinkBuilder/blob/master/FBLinkBuilder.py).\
Vous pouvez **ouvrir** un **sch√©ma** d√©clar√© en utilisant **adb** ou un **navigateur**:

{% code overflow="wrap" %}
```bash
adb shell am start -a android.intent.action.VIEW -d "scheme://hostname/path?param=value" [your.package.name]
```
{% endcode %}

_Notez que vous pouvez **omettre le nom du package** et le mobile appellera automatiquement l'application qui devrait ouvrir ce lien._

{% code overflow="wrap" %}
```markup
<!-- Browser regular link -->
<a href="scheme://hostname/path?param=value">Click me</a>
<!-- fallback in your url you could try the intent url -->
<a href="intent://hostname#Intent;scheme=scheme;package=your.package.name;S.browser_fallback_url=http%3A%2F%2Fwww.example.com;end">with alternative</a>
```
{% endcode %}

**Code ex√©cut√©**

Pour trouver le **code qui sera ex√©cut√© dans l'application**, allez √† l'activit√© appel√©e par le lien profond et recherchez la fonction **`onNewIntent`**.

![](<../../.gitbook/assets/image (436) (1) (1) (1).png>)

**Informations sensibles**

Chaque fois que vous trouvez un lien profond, v√©rifiez qu'il ne re√ßoit pas de donn√©es sensibles (comme des mots de passe) via des param√®tres d'URL, car toute autre application pourrait **usurper le lien profond et voler ces donn√©es !**

**Param√®tres dans le chemin**

Vous devez √©galement v√©rifier si un lien profond utilise un param√®tre √† l'int√©rieur du chemin de l'URL comme : `https://api.example.com/v1/users/{username}`, dans ce cas, vous pouvez forcer une travers√©e de chemin en acc√©dant √† quelque chose comme : `example://app/users?username=../../unwanted-endpoint%3fparam=value`.\
Notez que si vous trouvez les bons points de terminaison √† l'int√©rieur de l'application, vous pourriez √™tre en mesure de provoquer une **Redirection Ouverte** (si une partie du chemin est utilis√©e comme nom de domaine), une **prise de contr√¥le de compte** (si vous pouvez modifier les d√©tails des utilisateurs sans jeton CSRF et que le point de terminaison vuln√©rable utilise la m√©thode correcte) et toute autre vuln√©rabilit√©. Plus d'[informations √† ce sujet ici](http://dphoeniixx.com/2020/12/13-2/).

**Autres exemples**

Un [rapport de prime de bug int√©ressant](https://hackerone.com/reports/855618) sur les liens (_/.well-known/assetlinks.json_).

### Protection insuffisante de la couche de transport

* **Absence d'inspection de certificat :** L'application Android ne parvient pas √† v√©rifier l'identit√© du certificat qui lui est pr√©sent√©. La plupart des applications ignorent les avertissements et acceptent tout certificat auto-sign√© pr√©sent√©. Certaines applications font passer le trafic par une connexion HTTP.
* **N√©gociation de poign√©e de main faible :** L'application et le serveur effectuent une poign√©e de main SSL/TLS mais utilisent une suite de chiffrement non s√©curis√©e qui est vuln√©rable aux attaques de type MITM. Ainsi, tout attaquant peut facilement d√©crypter cette connexion.
* **Fuite d'informations de confidentialit√© :** Il arrive souvent que les applications effectuent l'authentification via un canal s√©curis√© mais que toutes les autres connexions se fassent via un canal non s√©curis√©. Cela n'ajoute pas √† la s√©curit√© de l'application car d'autres donn√©es sensibles comme le cookie de session ou les donn√©es utilisateur peuvent √™tre intercept√©es par un utilisateur malveillant.

Parmi les 3 sc√©narios pr√©sent√©s, nous allons discuter de **comment v√©rifier l'identit√© du certificat**. Les 2 autres sc√©narios d√©pendent de la **configuration TLS** du serveur et si l'**application envoie des donn√©es non chiffr√©es**. Le testeur doit v√©rifier par lui-m√™me la configuration TLS du serveur ([ici](../../network-services-pentesting/pentesting-web/#ssl-tls-vulnerabilites)) et d√©tecter si des **informations confidentielles sont envoy√©es par un canal non chiffr√©/vuln√©rable**.\
Plus d'informations sur la d√©couverte et la correction de ce type de vuln√©rabilit√©s [**ici**](https://manifestsecurity.com/android-application-security-part-10/).

**√âpinglage SSL**

Par d√©faut, lors de l'√©tablissement d'une connexion SSL, le client (application Android) v√©rifie que le certificat du serveur a une cha√Æne de confiance v√©rifiable remontant √† un certificat de confiance (racine) et correspond au nom d'h√¥te demand√©. Cela pose un probl√®me d'**Attaques de l'Homme du Milieu (MITM)**.\
Dans l'√©pinglage de certificat, une application Android contient elle-m√™me le certificat du serveur et ne transmet les donn√©es que si le m√™me certificat est pr√©sent√©.\
Il est recommand√© d'**appliquer l'√©pinglage SSL** pour les sites o√π des informations sensibles vont √™tre envoy√©es.

### Inspection du trafic HTTP

Tout d'abord, vous devez (devez) **installer le certificat** de l'**outil proxy** que vous allez utiliser, probablement Burp. Si vous n'installez pas le certificat CA de l'outil proxy, vous ne verrez probablement pas le trafic chiffr√© dans le proxy.\
**Veuillez,** [**lire ce guide pour apprendre comment installer un certificat CA personnalis√©**](avd-android-virtual-device.md#install-burp-certificate-on-a-virtual-machine)**.**

Pour les applications ciblant **l'API Level 24+ il ne suffit pas d'installer le certificat CA de Burp** sur l'appareil. Pour contourner cette nouvelle protection, vous devez modifier le fichier de configuration de la s√©curit√© r√©seau. Ainsi, vous pourriez modifier ce fichier pour autoriser votre certificat CA ou vous pouvez [**lire cette page pour un tutoriel sur comment forcer l'application √† accepter √† nouveau tous les certificats install√©s sur l'appareil**](make-apk-accept-ca-certificate.md).

**√âpinglage SSL**

Nous avons d√©j√† discut√© de ce qu'est l'√©pinglage SSL juste 2 paragraphes plus t√¥t. Lorsqu'il est impl√©ment√© dans une application, vous devrez le contourner pour inspecter le trafic HTTPS ou vous ne le verrez pas.\
Ici, je vais pr√©senter quelques options que j'ai utilis√©es pour contourner cette protection :

* Modifier automatiquement l'**apk** pour **contourner** l'√©pinglage SSL avec [**apk-mitm**](https://github.com/shroudedcode/apk-mitm). Le principal avantage de cette option est que vous n'aurez pas besoin de root pour contourner l'√©pinglage SSL, mais vous devrez supprimer l'application et r√©installer la nouvelle, et cela ne fonctionnera pas toujours.
* Vous pourriez utiliser **Frida** (discut√© ci-dessous) pour contourner cette protection. Voici un guide pour utiliser Burp+Frida+Genymotion : [https://spenkk.github.io/bugbounty/Configuring-Frida-with-Burp-and-GenyMotion-to-bypass-SSL-Pinning/](https://spenkk.github.io/bugbounty/Configuring-Frida-with-Burp-and-GenyMotion-to-bypass-SSL-Pinning/)
* Vous pouvez √©galement essayer de **contourner automatiquement l'√©pinglage SSL** en utilisant [**objection**](frida-tutorial/objection-tutorial.md)**:** `objection --gadget com.package.app explore --startup-command "android sslpinning disable"`
* Vous pouvez √©galement essayer de **contourner automatiquement l'√©pinglage SSL** en utilisant **l'analyse dynamique de MobSF** (expliqu√©e ci-dessous)
* Si vous pensez toujours qu'il y a du trafic que vous ne capturez pas, vous pouvez essayer de **rediriger le trafic vers Burp en utilisant iptables**. Lisez ce blog : [https://infosecwriteups.com/bypass-ssl-pinning-with-ip-forwarding-iptables-568171b52b62](https://infosecwriteups.com/bypass-ssl-pinning-with-ip-forwarding-iptables-568171b52b62)

**Vuln√©rabilit√©s Web courantes**

Notez qu'√† cette √©tape, vous devriez rechercher des vuln√©rabilit√©s Web courantes. Beaucoup d'informations sur les vuln√©rabilit√©s Web se trouvent dans ce livre, donc je ne vais pas les mentionner ici.

### Frida

Bo√Æte √† outils d'instrumentation dynamique pour les d√©veloppeurs, les reverse-engineers et les chercheurs en s√©curit√©. En savoir plus sur [www.frida.re](https://www.frida.re).\
**C'est incroyable, vous pouvez acc√©der √† une application en cours d'ex√©cution et accrocher des m√©thodes en temps r√©el pour changer le comportement, changer les valeurs, extraire des valeurs, ex√©cuter un code diff√©rent...**\
**Si vous voulez tester des applications Android, vous devez savoir comment utiliser Frida.**

**Apprenez √† utiliser Frida :** [**Tutoriel Frida**](frida-tutorial/)\
**Quelques "GUI" pour les actions avec Frida :** [**https://github.com/m0bilesecurity/RMS-Runtime-Mobile-Security**](https://github.com/m0bilesecurity/RMS-Runtime-Mobile-Security)\
**Quelques autres abstractions bas√©es sur Frida :** [**https://github.com/sensepost/objection**](https://github.com/sensepost/objection) **,** [**https://github.com/dpnishant/appmon**](https://github.com/dpnishant/appmon)\
**Vous pouvez trouver quelques scripts Frida impressionnants ici :** [**https://codeshare.frida.re/**](https://codeshare.frida.re)

### **Dump de m√©moire - Fridump**

V√©rifiez si l'application stocke des informations sensibles en m√©moire qu'elle ne devrait pas stocker comme des mots de passe ou des mn√©moniques.

En utilisant [**Fridump3**](https://github.com/rootbsd/fridump3) vous pouvez vider la m√©moire de l'application avec :
```bash
# With PID
python3 fridump3.py -u <PID>

# With name
frida-ps -Uai
python3 fridump3.py -u "<Name>"
```
Cela va vider la m√©moire dans le dossier ./dump, et l√† vous pourriez utiliser grep avec quelque chose comme :

{% code overflow="wrap" %}
```bash
strings * | grep -E "^[a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+$"
```
{% endcode %}

### **Donn√©es sensibles dans le Keystore**

Sur Android, le Keystore est le meilleur endroit pour stocker des donn√©es sensibles, cependant, avec suffisamment de privil√®ges, il est toujours **possible d'y acc√©der**. Comme les applications ont tendance √† stocker ici des **donn√©es sensibles en texte clair**, les tests d'intrusion doivent v√©rifier cela car un utilisateur root ou quelqu'un ayant un acc√®s physique √† l'appareil pourrait voler ces donn√©es.

M√™me si une application stocke des donn√©es dans le keystore, les donn√©es devraient √™tre chiffr√©es.

Pour acc√©der aux donn√©es √† l'int√©rieur du keystore, vous pouvez utiliser ce script Frida : [https://github.com/WithSecureLabs/android-keystore-audit/blob/master/frida-scripts/tracer-cipher.js](https://github.com/WithSecureLabs/android-keystore-audit/blob/master/frida-scripts/tracer-cipher.js)
```bash
frida -U -f com.example.app -l frida-scripts/tracer-cipher.js
```
### **Contournement des empreintes digitales/biom√©trie**

En utilisant le script Frida suivant, il pourrait √™tre possible de **contourner l'authentification par empreinte digitale** que les applications Android pourraient effectuer afin de **prot√©ger certaines zones sensibles :**

{% code overflow="wrap" %}
```bash
frida --codeshare krapgras/android-biometric-bypass-update-android-11 -U -f <app.package>
```
{% endcode %}

### **Images de fond**

Lorsque vous mettez une application en arri√®re-plan, Android stocke une **capture d'√©cran de l'application** afin que lorsqu'elle revienne √† l'avant-plan, elle commence √† charger l'image avant l'application pour donner l'impression que l'application a √©t√© charg√©e plus rapidement.

Cependant, si cette capture d'√©cran contient des **informations sensibles**, une personne ayant acc√®s √† la capture d'√©cran pourrait **voler ces informations** (notez que vous avez besoin des droits root pour y acc√©der).

Les captures d'√©cran sont g√©n√©ralement stock√©es autour de : **`/data/system_ce/0/snapshots`**

Android propose un moyen de **pr√©venir la capture d'√©cran en d√©finissant le param√®tre de mise en page FLAG\_SECURE**. En utilisant ce drapeau, le contenu de la fen√™tre est trait√© comme s√©curis√©, l'emp√™chant d'appara√Ætre dans les captures d'√©cran ou d'√™tre affich√© sur des √©crans non s√©curis√©s.
```bash
getWindow().setFlags(LayoutParams.FLAG_SECURE, LayoutParams.FLAG_SECURE);
```
### **Analyseur d'application Android**

Cet outil pourrait vous aider √† g√©rer diff√©rents outils lors de l'analyse dynamique : [https://github.com/NotSoSecure/android\_application\_analyzer](https://github.com/NotSoSecure/android\_application\_analyzer)

### Injection d'Intent

Cette vuln√©rabilit√© ressemble √† **l'Open Redirect en s√©curit√© web**. Puisque la classe `Intent` est `Parcelable`, **les objets appartenant √† cette classe** peuvent √™tre **transmis** en tant que **donn√©es suppl√©mentaires** dans un autre objet `Intent`.\
De nombreux d√©veloppeurs **utilisent** cette **fonctionnalit√©** et cr√©ent des **composants proxy** (activit√©s, r√©cepteurs de diffusion et services) qui **prennent un Intent int√©gr√© et le transmettent √† des m√©thodes dangereuses** telles que `startActivity(...)`, `sendBroadcast(...)`, etc.\
C'est dangereux car **un attaquant peut forcer l'application √† lancer un composant non export√© qui ne peut pas √™tre lanc√© directement depuis une autre application**, ou √† accorder √† l'attaquant l'acc√®s √† ses fournisseurs de contenu. **`WebView`** change parfois une **URL d'une cha√Æne en un objet `Intent`**, en utilisant la m√©thode `Intent.parseUri(...)`, et le transmet √† `startActivity(...)`.

### Injections c√¥t√© client Android et autres

Vous connaissez probablement ce type de vuln√©rabilit√©s du Web. Vous devez √™tre particuli√®rement prudent avec ces vuln√©rabilit√©s dans une application Android :

* **Injection SQL :** Lorsque vous travaillez avec des requ√™tes dynamiques ou des Content-Providers, assurez-vous d'utiliser des requ√™tes param√©tr√©es.
* **Injection JavaScript (XSS) :** V√©rifiez que le support JavaScript et des plugins est d√©sactiv√© pour tout WebView (d√©sactiv√© par d√©faut). [Plus d'informations ici](webview-attacks.md#javascript-enabled).
* **Inclusion de fichiers locaux :** V√©rifiez que l'acc√®s au syst√®me de fichiers est d√©sactiv√© pour tout WebView (activ√© par d√©faut) `(webview.getSettings().setAllowFileAccess(false);)`. [Plus d'informations ici](webview-attacks.md#javascript-enabled).
* **Cookies √©ternels** : Dans plusieurs cas, lorsque l'application Android termine la session, le cookie n'est pas r√©voqu√© ou il pourrait m√™me √™tre enregistr√© sur le disque.
* [**Drapeau de s√©curit√©** dans les cookies](../../pentesting-web/hacking-with-cookies/#cookies-flags)

***

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

Rejoignez le serveur [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) pour communiquer avec des hackers exp√©riment√©s et des chasseurs de primes en bugs !

**Perspectives sur le Hacking**\
Engagez-vous avec du contenu qui explore le frisson et les d√©fis du hacking

**Actualit√©s sur le Hacking en Temps R√©el**\
Restez inform√© du monde du hacking en √©volution rapide gr√¢ce √† des actualit√©s et des perspectives en temps r√©el

**Derni√®res Annonces**\
Restez inform√© des derni√®res primes de bugs lanc√©es et des mises √† jour cruciales de la plateforme

**Rejoignez-nous sur** [**Discord**](https://discord.com/invite/N3FrSbmwdy) et commencez √† collaborer avec les meilleurs hackers d√®s aujourd'hui !

## Analyse Automatique

### [MobSF](https://github.com/MobSF/Mobile-Security-Framework-MobSF)

**Analyse statique**

![](<../../.gitbook/assets/image (61).png>)

**√âvaluation des vuln√©rabilit√©s de l'application** en utilisant une interface web conviviale. Vous pouvez √©galement effectuer une analyse dynamique (mais vous devez pr√©parer l'environnement).
```bash
docker pull opensecurity/mobile-security-framework-mobsf
docker run -it -p 8000:8000 opensecurity/mobile-security-framework-mobsf:latest
```
Notez que MobSF peut analyser les applications **Android**(apk), **IOS**(ipa) et **Windows**(apx) (_les applications Windows doivent √™tre analys√©es √† partir d'un MobSF install√© sur un h√¥te Windows_).\
De plus, si vous cr√©ez un fichier **ZIP** avec le code source d'une application **Android** ou **IOS** (allez dans le dossier racine de l'application, s√©lectionnez tout et cr√©ez un fichier ZIP), il pourra √©galement l'analyser.

MobSF vous permet √©galement de **diff/Comparer** les analyses et d'int√©grer **VirusTotal** (vous devrez d√©finir votre cl√© API dans _MobSF/settings.py_ et l'activer : `VT_ENABLED = TRUE` `VT_API_KEY = <Votre cl√© API>` `VT_UPLOAD = TRUE`). Vous pouvez √©galement d√©finir `VT_UPLOAD` sur `False`, puis le **hash** sera **t√©l√©charg√©** au lieu du fichier.

### Analyse dynamique assist√©e avec MobSF

**MobSF** peut √©galement √™tre tr√®s utile pour l'**analyse dynamique** sur **Android**, mais dans ce cas, vous devrez installer MobSF et **genymotion** sur votre h√¥te (une machine virtuelle ou Docker ne fonctionnera pas). _Remarque : Vous devez **d'abord d√©marrer une machine virtuelle dans genymotion** et **ensuite MobSF**._\
L'**analyseur dynamique MobSF** peut :

* **Extraire les donn√©es de l'application** (URL, journaux, presse-papiers, captures d'√©cran r√©alis√©es par vous, captures d'√©cran r√©alis√©es par "**Exported Activity Tester**", e-mails, bases de donn√©es SQLite, fichiers XML, et autres fichiers cr√©√©s). Tout cela est fait automatiquement sauf pour les captures d'√©cran, vous devez appuyer lorsque vous voulez une capture d'√©cran ou vous devez appuyer sur "**Exported Activity Tester**" pour obtenir des captures d'√©cran de toutes les activit√©s export√©es.
* Capturer le **trafic HTTPS**
* Utiliser **Frida** pour obtenir des **informations en temps r√©el**

√Ä partir des versions d'Android > 5, il **d√©marrera automatiquement Frida** et d√©finira les param√®tres de **proxy** globaux pour **capturer** le trafic. Il ne capturera le trafic que de l'application test√©e.

**Frida**

Par d√©faut, il utilisera √©galement certains scripts Frida pour **contourner l'√©pinglage SSL**, la **d√©tection de root** et la **d√©tection de d√©bogueur** et pour **surveiller les API int√©ressantes**.\
MobSF peut √©galement **appeler des activit√©s export√©es**, capturer des **captures d'√©cran** et les **sauvegarder** pour le rapport.

Pour **d√©marrer** le test dynamique, appuyez sur le bouton vert : "**Start Instrumentation**". Appuyez sur "**Frida Live Logs**" pour voir les journaux g√©n√©r√©s par les scripts Frida et "**Live API Monitor**" pour voir toutes les invocations des m√©thodes accroch√©es, les arguments pass√©s et les valeurs retourn√©es (cela appara√Ætra apr√®s avoir appuy√© sur "Start Instrumentation").\
MobSF vous permet √©galement de charger vos propres **scripts Frida** (pour envoyer les r√©sultats de vos scripts Frida √† MobSF, utilisez la fonction `send()`). Il dispose √©galement de **plusieurs scripts pr√©-√©crits** que vous pouvez charger (vous pouvez en ajouter d'autres dans `MobSF/DynamicAnalyzer/tools/frida_scripts/others/`), il vous suffit de les s√©lectionner, d'appuyer sur "**Load**" et d'appuyer sur "**Start Instrumentation**" (vous pourrez voir les journaux de ces scripts √† l'int√©rieur de "**Frida Live Logs**").

![](<../../.gitbook/assets/image (215).png>)

De plus, vous disposez de certaines fonctionnalit√©s auxiliaires Frida :

* **√ânum√©rer les classes charg√©es** : Il affichera toutes les classes charg√©es
* **Capturer les cha√Ænes** : Il affichera toutes les cha√Ænes captur√©es lors de l'utilisation de l'application (tr√®s bruyant)
* **Capturer les comparaisons de cha√Ænes** : Peut √™tre tr√®s utile. Il **affichera les 2 cha√Ænes compar√©es** et si le r√©sultat √©tait Vrai ou Faux.
* **√ânum√©rer les m√©thodes de classe** : Mettez le nom de la classe (comme "java.io.File") et il affichera toutes les m√©thodes de la classe.
* **Rechercher un motif de classe** : Rechercher des classes par motif
* **Tracer les m√©thodes de classe** : **Tracer** une **classe enti√®re** (voir les entr√©es et sorties de toutes les m√©thodes de la classe). N'oubliez pas que par d√©faut, MobSF trace plusieurs m√©thodes int√©ressantes de l'API Android.

Une fois que vous avez s√©lectionn√© le module auxiliaire que vous souhaitez utiliser, vous devez appuyer sur "**Start Intrumentation**" et vous verrez toutes les sorties dans "**Frida Live Logs**".

**Shell**

Mobsf vous propose √©galement un shell avec quelques commandes **adb**, commandes **MobSF**, et commandes **shell** courantes en bas de la page d'analyse dynamique. Quelques commandes int√©ressantes :
```bash
help
shell ls
activities
exported_activities
services
receivers
```
**Outils HTTP**

Lorsque le trafic http est captur√©, vous pouvez voir une vue peu attrayante du trafic captur√© sur le bas de "**HTTP(S) Traffic**" ou une vue plus agr√©able sur le bouton vert "**Start HTTPTools**". √Ä partir de la deuxi√®me option, vous pouvez **envoyer** les **requ√™tes captur√©es** vers des **proxies** comme Burp ou Owasp ZAP.\
Pour ce faire, _allumez Burp -->_ _d√©sactivez Intercept --> dans MobSB HTTPTools s√©lectionnez la requ√™te_ --> appuyez sur "**Send to Fuzzer**" --> _s√©lectionnez l'adresse du proxy_ ([http://127.0.0.1:8080\\](http://127.0.1:8080)).

Une fois que vous avez termin√© l'analyse dynamique avec MobSF, vous pouvez appuyer sur "**Start Web API Fuzzer**" pour **fuzzer les requ√™tes http** et rechercher des vuln√©rabilit√©s.

{% hint style="info" %}
Apr√®s avoir effectu√© une analyse dynamique avec MobSF, les param√®tres du proxy peuvent √™tre mal configur√©s et vous ne pourrez pas les corriger depuis l'interface graphique. Vous pouvez corriger les param√®tres du proxy en effectuant :
```
adb shell settings put global http_proxy :0
```
{% endhint %}

### Analyse dynamique assist√©e avec Inspeckage

Vous pouvez obtenir l'outil sur [**Inspeckage**](https://github.com/ac-pm/Inspeckage).\
Cet outil utilisera certains **Hooks** pour vous informer de **ce qui se passe dans l'application** pendant que vous effectuez une **analyse dynamique**.

{% content-ref url="inspeckage-tutorial.md" %}
[inspeckage-tutorial.md](inspeckage-tutorial.md)
{% endcontent-ref %}

### [Yaazhini](https://www.vegabird.com/yaazhini/)

C'est un **excellent outil pour effectuer une analyse statique avec une interface graphique**

![](<../../.gitbook/assets/image (527).png>)

### [Qark](https://github.com/linkedin/qark)

Cet outil est con√ßu pour rechercher plusieurs **vuln√©rabilit√©s li√©es √† la s√©curit√© des applications Android**, que ce soit dans le **code source** ou dans les **APK empaquet√©s**. L'outil est √©galement **capable de cr√©er un APK d√©ployable "Proof-of-Concept"** et des **commandes ADB** pour exploiter certaines des vuln√©rabilit√©s trouv√©es (activit√©s expos√©es, intentions, tapjacking...). Comme avec Drozer, il n'est pas n√©cessaire de rooter l'appareil de test.
```bash
pip3 install --user qark  # --user is only needed if not using a virtualenv
qark --apk path/to/my.apk
qark --java path/to/parent/java/folder
qark --java path/to/specific/java/file.java
```
### [**ReverseAPK**](https://github.com/1N3/ReverseAPK.git)

* Affiche tous les fichiers extraits pour une r√©f√©rence facile
* D√©compile automatiquement les fichiers APK au format Java et Smali
* Analyse AndroidManifest.xml pour les vuln√©rabilit√©s et comportements courants
* Analyse statique du code source pour les vuln√©rabilit√©s et comportements courants
* Informations sur l'appareil
* Intentions
* Ex√©cution de commandes
* R√©f√©rences SQLite
* R√©f√©rences de journalisation
* Fournisseurs de contenu
* R√©cepteurs de diffusion
* R√©f√©rences de service
* R√©f√©rences de fichiers
* R√©f√©rences de cryptographie
* Secrets cod√©s en dur
* URL
* Connexions r√©seau
* R√©f√©rences SSL
* R√©f√©rences WebView
```
reverse-apk relative/path/to/APP.apk
```
### [SUPER Android Analyzer](https://github.com/SUPERAndroidAnalyzer/super)

SUPER est une application en ligne de commande qui peut √™tre utilis√©e sous Windows, MacOS X et Linux, pour analyser les fichiers _.apk_ √† la recherche de vuln√©rabilit√©s. Cela se fait en d√©compressant les APK et en appliquant une s√©rie de r√®gles pour d√©tecter ces vuln√©rabilit√©s.

Toutes les r√®gles sont regroup√©es dans un fichier `rules.json`, et chaque entreprise ou testeur peut cr√©er ses propres r√®gles pour analyser ce dont ils ont besoin.

T√©l√©chargez les derniers binaires sur la [page de t√©l√©chargement](https://superanalyzer.rocks/download.html)
```
super-analyzer {apk_file}
```
### [StaCoAn](https://github.com/vincentcox/StaCoAn)

![](<../../.gitbook/assets/image (62).png>)

StaCoAn est un outil **multiplateforme** qui aide les d√©veloppeurs, les chasseurs de bugs et les hackers √©thiques √† effectuer une [analyse de code statique](https://en.wikipedia.org/wiki/Static\_program\_analysis) sur les applications mobiles\*.

Le concept est que vous faites glisser et d√©posez votre fichier d'application mobile (un fichier .apk ou .ipa) sur l'application StaCoAn et elle g√©n√©rera un rapport visuel et portable pour vous. Vous pouvez ajuster les param√®tres et les listes de mots pour obtenir une exp√©rience personnalis√©e.

T√©l√©chargez la [derni√®re version](https://github.com/vincentcox/StaCoAn/releases) :
```
./stacoan
```
### [AndroBugs](https://github.com/AndroBugs/AndroBugs\_Framework)

AndroBugs Framework est un syst√®me d'analyse de vuln√©rabilit√©s Android qui aide les d√©veloppeurs ou les hackers √† trouver des vuln√©rabilit√©s de s√©curit√© potentielles dans les applications Android.\
[T√©l√©chargements pour Windows](https://github.com/AndroBugs/AndroBugs\_Framework/releases)
```
python androbugs.py -f [APK file]
androbugs.exe -f [APK file]
```
### [Androwarn](https://github.com/maaaaz/androwarn)

**Androwarn** est un outil dont le but principal est de d√©tecter et avertir l'utilisateur des comportements malveillants potentiels d√©velopp√©s par une application Android.

La d√©tection est effectu√©e avec l'**analyse statique** du bytecode Dalvik de l'application, repr√©sent√© sous forme de **Smali**, avec la biblioth√®que [`androguard`](https://github.com/androguard/androguard).

Cet outil recherche les **comportements courants des applications "malveillantes"** tels que : l'exfiltration des identifiants de t√©l√©phonie, l'interception du flux audio/vid√©o, la modification des donn√©es PIM, l'ex√©cution de code arbitraire...
```
python androwarn.py -i my_application_to_be_analyzed.apk -r html -v 3
```
### [Cadre MARA](https://github.com/xtiankisutsa/MARA_Framework)

![](<../../.gitbook/assets/image (81).png>)

**MARA** est un **C**adre d'**A**nalyse et d'**I**ng√©nierie **R**everse d'**A**pplications **M**obiles. C'est un outil qui regroupe des outils couramment utilis√©s pour l'ing√©nierie inverse et l'analyse d'applications mobiles, pour aider √† tester les applications mobiles contre les menaces de s√©curit√© mobiles de l'OWASP. Son objectif est de rendre cette t√¢che plus facile et conviviale pour les d√©veloppeurs d'applications mobiles et les professionnels de la s√©curit√©.

Il est capable de :

* Extraire du code Java et Smali en utilisant diff√©rents outils
* Analyser les APK en utilisant : [smalisca](https://github.com/dorneanu/smalisca), [ClassyShark](https://github.com/google/android-classyshark), [androbugs](https://github.com/AndroBugs/AndroBugs_Framework), [androwarn](https://github.com/maaaaz/androwarn), [APKiD](https://github.com/rednaga/APKiD)
* Extraire des informations priv√©es de l'APK en utilisant des expressions r√©guli√®res.
* Analyser le Manifeste.
* Analyser les domaines trouv√©s en utilisant : [pyssltest](https://github.com/moheshmohan/pyssltest), [testssl](https://github.com/drwetter/testssl.sh) et [whatweb](https://github.com/urbanadventurer/WhatWeb)
* D√©obfusquer l'APK via [apk-deguard.com](http://www.apk-deguard.com)

### Koodous

Utile pour d√©tecter les logiciels malveillants : [https://koodous.com/](https://koodous.com)

## Obfuscation/D√©obfuscation de code

Notez que selon le service et la configuration que vous utilisez pour obfusquer le code. Les secrets peuvent √™tre ou non obfusqu√©s.

### [ProGuard](https://en.wikipedia.org/wiki/ProGuard\_\(software\))

**ProGuard** est un outil en ligne de commande open source qui r√©duit, optimise et obfusque le code Java. Il est capable d'optimiser le bytecode ainsi que de d√©tecter et supprimer les instructions inutilis√©es. ProGuard est un logiciel gratuit distribu√© sous la licence publique g√©n√©rale GNU, version 2.

ProGuard est distribu√© dans le cadre du SDK Android et s'ex√©cute lors de la construction de l'application en mode release.

De : [https://en.wikipedia.org/wiki/ProGuard\_(software)](https://en.wikipedia.org/wiki/ProGuard\_\(software\))

### [DexGuard](https://www.guardsquare.com/dexguard)

Trouvez un guide √©tape par √©tape pour d√©obfusquer l'APK dans [https://blog.lexfo.fr/dexguard.html](https://blog.lexfo.fr/dexguard.html)

(Dans ce guide) La derni√®re fois que nous avons v√©rifi√©, le mode de fonctionnement de Dexguard √©tait :

* charger une ressource en tant qu'InputStream ;
* transmettre le r√©sultat √† une classe h√©ritant de FilterInputStream pour le d√©crypter ;
* effectuer une obfuscation inutile pour perdre quelques minutes de temps d'un reverseur ;
* transmettre le r√©sultat d√©crypt√© √† un ZipInputStream pour obtenir un fichier DEX ;
* enfin, charger le DEX r√©sultant en tant que ressource en utilisant la m√©thode `loadDex`.

### [DeGuard](http://apk-deguard.com)

**DeGuard inverse le processus d'obfuscation effectu√© par les outils d'obfuscation Android. Cela permet de nombreuses analyses de s√©curit√©, y compris l'inspection du code et la pr√©diction des biblioth√®ques.**

Vous pouvez t√©l√©charger un APK obfusqu√© sur leur plateforme.

### [Simplify](https://github.com/CalebFenton/simplify)

Il s'agit d'un **d√©obfuscateur Android g√©n√©rique.** Simplify **ex√©cute virtuellement une application** pour comprendre son comportement, puis **essaie d'optimiser le code** pour qu'il se comporte de mani√®re identique mais soit plus facile √† comprendre pour un humain. Chaque type d'optimisation est simple et g√©n√©rique, donc peu importe le type sp√©cifique d'obfuscation utilis√©.

### [APKiD](https://github.com/rednaga/APKiD)

APKiD vous donne des informations sur **comment un APK a √©t√© cr√©√©**. Il identifie de nombreux **compilateurs**, **packers**, **obfuscateurs**, et d'autres choses √©tranges. C'est [_PEiD_](https://www.aldeid.com/wiki/PEiD) pour Android.

### Manuel

[Lisez ce tutoriel pour apprendre quelques astuces sur **comment inverser une obfuscation personnalis√©e**](manual-deobfuscation.md)

## Laboratoires

### [Androl4b](https://github.com/sh4hin/Androl4b)

AndroL4b est une machine virtuelle de s√©curit√© Android bas√©e sur ubuntu-mate qui inclut la collection des derniers frameworks, tutoriels et laboratoires de diff√©rents geeks de la s√©curit√© et chercheurs pour l'ing√©nierie inverse et l'analyse de logiciels malveillants.

### OWASP

{% embed url="https://github.com/OWASP/owasp-mstg%0Ahttps://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06g-testing-network-communication" %}

### D√©p√¥ts Git

[https://github.com/riddhi-shree/nullCommunity/tree/master/Android](https://github.com/riddhi-shree/nullCommunity/tree/master/Android)\
[https://www.youtube.com/watch?v=PMKnPaGWxtg\&feature=youtu.be\&ab\_channel=B3nacSec](https://www.youtube.com/watch?v=PMKnPaGWxtg\&feature=youtu.be\&ab\_channel=B3nacSec)

## R√©f√©rences

Pour plus d'informations, visitez :

* [https://appsecwiki.com/#/](https://appsecwiki.com/#/) C'est une excellente liste de ressources
* [https://maddiestone.github.io/AndroidAppRE/](https://maddiestone.github.io/AndroidAppRE/) Cours rapide sur Android
* [https://manifestsecurity.com/android-application-security/](https://manifestsecurity.com/android-application-security/)
* [https://github.com/Ralireza/Android-Security-Teryaagh](https://github.com/Ralireza/Android-Security-Teryaagh)

## √Ä Tester

* [https://www.vegabird.com/yaazhini/](https://www.vegabird.com/yaazhini/)
* [https://github.com/abhi-r3v0/Adhrit](https://github.com/abhi-r3v0/Adhrit)

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

Rejoignez le serveur [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) pour communiquer avec des hackers exp√©riment√©s et des chasseurs de primes en bugs!

**Perspectives sur le Hacking**\
Engagez-vous avec du contenu qui explore le frisson et les d√©fis du hacking

**Actualit√©s sur le Hacking en Temps R√©el**\
Restez inform√© sur le monde du hacking √† rythme rapide gr√¢ce aux actualit√©s et aux informations en temps r√©el

**Derni√®res Annonces**\
Restez inform√© des derni√®res primes de bugs lanc√©es et des mises √† jour cruciales de la plateforme

**Rejoignez-nous sur** [**Discord**](https://discord.com/invite/N3FrSbmwdy) et commencez √† collaborer avec les meilleurs hackers d√®s aujourd'hui!

<details>

<summary><strong>Apprenez le hacking AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres fa√ßons de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF** Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de hacking en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
