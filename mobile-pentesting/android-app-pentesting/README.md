# Pentesting de Aplicaciones Android

<details>

<summary><strong>Aprende hacking en AWS de cero a h칠roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver a tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** consulta los [**PLANES DE SUSCRIPCI칍N**](https://github.com/sponsors/carlospolop)!
* Consigue el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci칩n de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s칤gueme** en **Twitter** 游냕 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de github** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

칔nete al servidor de [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) para comunicarte con hackers experimentados y cazadores de recompensas por errores!

**Perspectivas de Hacking**\
Interact칰a con contenido que profundiza en la emoci칩n y los desaf칤os del hacking

**Noticias de Hacking en Tiempo Real**\
Mantente al d칤a con el mundo del hacking de ritmo r치pido a trav칠s de noticias e informaci칩n en tiempo real

**칔ltimos Anuncios**\
Mantente informado con los lanzamientos de nuevas recompensas por errores y actualizaciones cr칤ticas de la plataforma

**칔nete a nosotros en** [**Discord**](https://discord.com/invite/N3FrSbmwdy) y comienza a colaborar con los mejores hackers hoy mismo!

## Conceptos B치sicos de Aplicaciones Android

Es altamente recomendable comenzar leyendo esta p치gina para conocer sobre las **partes m치s importantes relacionadas con la seguridad de Android y los componentes m치s peligrosos en una aplicaci칩n Android**:

{% content-ref url="android-applications-basics.md" %}
[android-applications-basics.md](android-applications-basics.md)
{% endcontent-ref %}

## ADB (Android Debug Bridge)

Esta es la herramienta principal que necesitas para conectarte a un dispositivo android (emulado o f칤sico).\
Te permite controlar tu dispositivo a trav칠s de **USB** o **Red** desde una computadora, **copiar** archivos de ida y vuelta, **instalar** y desinstalar aplicaciones, ejecutar comandos de **shell**, realizar **copias de seguridad**, leer **logs** y m치s.

Echa un vistazo a la siguiente lista de [**Comandos ADB**](adb-commands.md) para aprender a usar adb.

## Smali

A veces es interesante **modificar el c칩digo de la aplicaci칩n** para acceder a **informaci칩n oculta** (quiz치s contrase침as bien ofuscadas o indicadores). Entonces, podr칤a ser interesante descompilar el apk, modificar el c칩digo y recompilarlo.\
[**En este tutorial** puedes **aprender c칩mo descompilar y modificar el c칩digo Smali y recompilar el APK** con la nueva funcionalidad](smali-changes.md). Esto podr칤a ser muy 칰til como una **alternativa para varias pruebas durante el an치lisis din치mico** que se van a presentar. Entonces, **ten siempre en cuenta esta posibilidad**.

## Otros trucos interesantes

* [Suplantaci칩n de tu ubicaci칩n en Play Store](spoofing-your-location-in-play-store.md)
* **Descargar APKs**: [https://apps.evozi.com/apk-downloader/](https://apps.evozi.com/apk-downloader/), [https://apkpure.com/es/](https://apkpure.com/es/), [https://www.apkmirror.com/](https://www.apkmirror.com), [https://apkcombo.com/es-es/apk-downloader/](https://apkcombo.com/es-es/apk-downloader/)
* Extraer APK del dispositivo:
```bash
adb shell pm list packages
com.android.insecurebankv2

adb shell pm path com.android.insecurebankv2
package:/data/app/com.android.insecurebankv2-Jnf8pNgwy3QA_U5f-n_4jQ==/base.apk

adb pull /data/app/com.android.insecurebankv2- Jnf8pNgwy3QA_U5f-n_4jQ==/base.apk
```
## An치lisis Est치tico

Primero que nada, para analizar un APK debes **echar un vistazo al c칩digo Java** usando un descompilador.\
Por favor, [**lee aqu칤 para encontrar informaci칩n sobre diferentes descompiladores disponibles**](apk-decompilers.md).

### Buscando Informaci칩n Interesante

Simplemente echando un vistazo a las **cadenas** del APK puedes buscar **contrase침as**, **URLs** ([https://github.com/ndelphit/apkurlgrep](https://github.com/ndelphit/apkurlgrep)), **claves api**, **cifrado**, **uuids de bluetooth**, **tokens** y cualquier cosa interesante... busca incluso **puertas traseras** de ejecuci칩n de c칩digo o puertas traseras de autenticaci칩n (credenciales de administrador codificadas en la aplicaci칩n).

**Firebase**

Presta especial atenci칩n a las **URLs de firebase** y verifica si est치 mal configurado. [M치s informaci칩n sobre qu칠 es Firebase y c칩mo explotarlo aqu칤.](../../network-services-pentesting/pentesting-web/buckets/firebase-database.md)

### Comprensi칩n B치sica de la Aplicaci칩n - Manifest.xml, strings.xml

Usando cualquiera de los **descompiladores** mencionados [**aqu칤**](apk-decompilers.md) podr치s leer el _Manifest.xml_. Tambi칠n podr칤as **cambiar** la extensi칩n del archivo **apk a .zip** y **descomprimirlo**.\
Leyendo el **manifiesto** puedes encontrar **vulnerabilidades**:

* Primero que nada, verifica si **la aplicaci칩n es depurable**. Un APK de producci칩n no deber칤a serlo (o otros podr치n conectarse a 칠l). Puedes verificar si una aplicaci칩n es depurable buscando en el manifiesto el atributo `debuggable="true"` dentro de la etiqueta _\<application_ Ejemplo: `<application theme="@2131296387" debuggable="true"`
* [Aprende aqu칤](drozer-tutorial/#is-debuggeable) c칩mo encontrar aplicaciones depurables en un tel칠fono y explotarlas
* **Backup**: El atributo **`android:allowBackup`** define si los datos de la aplicaci칩n pueden ser respaldados y restaurados por un usuario que ha habilitado la depuraci칩n usb. Si la bandera de respaldo est치 configurada como verdadera, permite a un atacante tomar el respaldo de los datos de la aplicaci칩n a trav칠s de adb incluso si el dispositivo no est치 rooteado. Por lo tanto, las aplicaciones que manejan y almacenan informaci칩n sensible como detalles de tarjetas, contrase침as, etc., deber칤an tener esta configuraci칩n expl칤citamente establecida en **falso** porque por defecto est치 configurada en **verdadero** para prevenir tales riesgos.
* `<application android:allowBackup="false"`
* **NetworkSecurity:** La seguridad de red de la aplicaci칩n puede sobrescribir los valores predeterminados con **`android:networkSecurityConfig="@xml/network_security_config"`**. Un archivo con ese nombre puede ser colocado en _**res/xml.**_ Este archivo configurar치 ajustes de seguridad importantes como pines de certificado o si permite tr치fico HTTP. Puedes leer aqu칤 m치s informaci칩n sobre todas las cosas que se pueden configurar, pero revisa este ejemplo sobre c칩mo configurar tr치fico HTTP para algunos dominios:
* `<domain-config cleartextTrafficPermitted="true"> <domain includeSubdomains="true">formation-software.co.uk </domain></domain-config>`
* **Actividades Exportadas**: Verifica las actividades exportadas dentro del manifiesto ya que esto podr칤a ser peligroso. M치s adelante en el an치lisis din치mico se explicar치 c칩mo [puedes abusar de este comportamiento](./#exploiting-exported-activities-authorisation-bypass).
* **Proveedores de Contenido**: Si se est치 exponiendo un proveedor exportado, podr칤as ser capaz de acceder/modificar informaci칩n interesante. En el an치lisis din치mico [aprender치s c칩mo abusar de ellos](./#exploiting-content-providers-accessing-and-manipulating-sensitive-information).
* Verifica las configuraciones de **FileProviders** dentro del atributo `android:name="android.support.FILE_PROVIDER_PATHS"`. [Lee aqu칤 para aprender m치s sobre FileProviders](./#fileprovider).
* **Servicios Expuestos**: Dependiendo de lo que el servicio est칠 haciendo internamente, las vulnerabilidades podr칤an ser explotadas. En el an치lisis din치mico [aprender치s c칩mo abusar de ellos](./#exploiting-services).
* **Receptores de Broadcast**: [Aprender치s c칩mo posiblemente explotarlos](./#exploiting-broadcast-receivers) durante el an치lisis din치mico.
* **Esquema URL**: Lee el c칩digo de la actividad que maneja el esquema y busca vulnerabilidades en la gesti칩n de la entrada del usuario. M치s informaci칩n sobre [qu칠 es un esquema URL aqu칤](./#url-schemes).
* **minSdkVersion**, **targetSDKVersion**, **maxSdkVersion**: Indican las versiones de Android en las que la aplicaci칩n funcionar치. Es importante tenerlas en cuenta porque desde una perspectiva de seguridad, soportar versiones antiguas permitir치 que versiones de Android conocidas por ser vulnerables la ejecuten.

Leyendo **resources.arsc/strings.xml** puedes encontrar **informaci칩n interesante**:

* Claves API
* Esquemas personalizados
* Otra informaci칩n interesante que los desarrolladores guardan en este archivo

### Tapjacking

**Tapjacking** es un ataque donde una **aplicaci칩n maliciosa** se lanza y **se posiciona encima de una aplicaci칩n v칤ctima**. Una vez que oculta visiblemente la app v칤ctima, su interfaz de usuario est치 dise침ada de tal manera que enga침a al usuario para interactuar con ella, mientras pasa la interacci칩n a la aplicaci칩n v칤ctima.\
En efecto, est치 **impidiendo que el usuario sepa que en realidad est치 realizando acciones en la aplicaci칩n v칤ctima**.

Encuentra m치s informaci칩n en:

{% content-ref url="tapjacking.md" %}
[tapjacking.md](tapjacking.md)
{% endcontent-ref %}

### Secuestro de Tareas

Una **actividad** con el **`launchMode`** configurado en **`singleTask` sin ninguna `taskAffinity`** definida es vulnerable al secuestro de tareas. Esto significa que una **aplicaci칩n** puede ser instalada y si se lanza antes de la aplicaci칩n real podr칤a **secuestrar la tarea de la aplicaci칩n real** (as칤 el usuario estar치 interactuando con la **aplicaci칩n maliciosa pensando que est치 usando la real**).

M치s informaci칩n en:

{% content-ref url="android-task-hijacking.md" %}
[android-task-hijacking.md](android-task-hijacking.md)
{% endcontent-ref %}

### Almacenamiento de Datos Inseguro

**Almacenamiento Interno**

Los archivos **creados** en el almacenamiento **interno** son **accesibles** solo por la **aplicaci칩n**. Esta protecci칩n es implementada por Android y es suficiente para la mayor칤a de las aplicaciones. Pero los desarrolladores a menudo usan `MODE_WORLD_READBALE` & `MODE_WORLD_WRITABLE` para dar acceso a esos archivos a una aplicaci칩n diferente, pero esto no limita a otras aplicaciones (maliciosas) de acceder a ellos.\
Durante el an치lisis **est치tico** **verifica** el uso de esos **modos**, durante el an치lisis **din치mico** **verifica** los **permisos** de los archivos creados (quiz치s algunos de ellos son legibles/escribibles a nivel mundial).\
[M치s informaci칩n sobre esta vulnerabilidad y c칩mo solucionarla aqu칤.](https://manifestsecurity.com/android-application-security-part-8/)

**Almacenamiento Externo**

Los archivos creados en el **almacenamiento externo**, como tarjetas SD, son **legibles y escribibles globalmente**. Debido a que el almacenamiento externo puede ser removido por el usuario y tambi칠n modificado por cualquier aplicaci칩n, no debes **almacenar informaci칩n sensible usando almacenamiento externo**.\
Como con datos de cualquier fuente no confiable, debes **realizar validaci칩n de entrada** al manejar **datos de almacenamiento externo**. Recomendamos encarecidamente que no almacenes archivos ejecutables o archivos de clase en almacenamiento externo antes de la carga din치mica. Si tu aplicaci칩n recupera archivos ejecutables del almacenamiento externo, los archivos deben estar firmados y verificados criptogr치ficamente antes de la carga din치mica.\
Informaci칩n tomada de [aqu칤](https://manifestsecurity.com/android-application-security-part-8/).

El almacenamiento externo se puede **acceder** en `/storage/emulated/0`, `/sdcard`, `/mnt/sdcard`

{% hint style="info" %}
A partir de Android 4.4 (**API 17**), la tarjeta SD tiene una estructura de directorios que **limita el acceso de una aplicaci칩n al directorio que es espec칤ficamente para esa aplicaci칩n**. Esto evita que una aplicaci칩n maliciosa obtenga acceso de lectura o escritura a los archivos de otra aplicaci칩n.
{% endhint %}

**Datos Sensibles Almacenados en Texto Claro**

* **Preferencias Compartidas**: Android permite a cada aplicaci칩n guardar f치cilmente archivos xml en la ruta `/data/data/<packagename>/shared_prefs/` y a veces es posible encontrar informaci칩n sensible en texto claro en esa carpeta.
* **Bases de Datos**: Android permite a cada aplicaci칩n guardar f치cilmente bases de datos sqlite en la ruta `/data/data/<packagename>/databases/` y a veces es posible encontrar informaci칩n sensible en texto claro en esa carpeta.

### TLS Roto

**Aceptar Todos los Certificados**

Por alguna raz칩n a veces los desarrolladores aceptan todos los certificados incluso si por ejemplo el nombre del host no coincide con l칤neas de c칩digo como la siguiente:
```java
SSLSocketFactory sf = new cc(trustStore);
sf.setHostnameVerifier(SSLSocketFactory.ALLOW_ALL_HOSTNAME_VERIFIER);
```
Una buena manera de probar esto es intentar capturar el tr치fico utilizando alg칰n proxy como Burp sin autorizar el CA de Burp dentro del dispositivo. Tambi칠n, puedes generar con Burp un certificado para un nombre de host diferente y usarlo.

### Criptograf칤a Rota

**Procesos de Gesti칩n de Claves Deficientes**

Algunos desarrolladores guardan datos sensibles en el almacenamiento local y los encriptan con una clave codificada/predecible en el c칩digo. Esto no deber칤a hacerse ya que un poco de ingenier칤a inversa podr칤a permitir a los atacantes extraer la informaci칩n confidencial.

**Uso de Algoritmos Inseguros y/o Obsoletos**

Los desarrolladores no deber칤an usar **algoritmos obsoletos** para realizar **verificaciones** de autorizaci칩n, **almacenar** o **enviar** datos. Algunos de estos algoritmos son: RC4, MD4, MD5, SHA1... Si se utilizan **hashes** para almacenar contrase침as, por ejemplo, se deben usar hashes **resistentes** a la fuerza bruta con sal.

### Otras comprobaciones

* Se recomienda **ofuscar el APK** para dificultar el trabajo de ingenier칤a inversa a los atacantes.
* Si la aplicaci칩n es sensible (como las de bancos), deber칤a realizar **sus propias comprobaciones para ver si el m칩vil est치 rooteado** y actuar en consecuencia.
* Si la aplicaci칩n es sensible (como las de bancos), deber칤a comprobar si se est치 utilizando un **emulador**.
* Si la aplicaci칩n es sensible (como las de bancos), deber칤a **verificar su propia integridad antes de ejecutarse** para comprobar si fue modificada.
* Usa [**APKiD**](https://github.com/rednaga/APKiD) para comprobar qu칠 compilador/empaquetador/ofuscador se utiliz칩 para construir el APK

### Aplicaci칩n React Native

Lee la siguiente p치gina para aprender c칩mo acceder f치cilmente al c칩digo javascript de aplicaciones React:

{% content-ref url="react-native-application.md" %}
[react-native-application.md](react-native-application.md)
{% endcontent-ref %}

### Aplicaciones Xamarin

Lee la siguiente p치gina para aprender c칩mo acceder f치cilmente al c칩digo C# de aplicaciones xamarin:

{% content-ref url="../xamarin-apps.md" %}
[xamarin-apps.md](../xamarin-apps.md)
{% endcontent-ref %}

### Aplicaciones Superempaquetadas

Seg칰n este [**art칤culo del blog**](https://clearbluejar.github.io/posts/desuperpacking-meta-superpacked-apks-with-github-actions/), superempaquetado es un algoritmo de Meta que comprime el contenido de una aplicaci칩n en un solo archivo. El blog habla sobre la posibilidad de crear una aplicaci칩n que descomprima este tipo de aplicaciones... y una manera m치s r치pida que implica **ejecutar la aplicaci칩n y recopilar los archivos descomprimidos del sistema de archivos.**

### An치lisis Est치tico Automatizado del C칩digo

La herramienta [**mariana-trench**](https://github.com/facebook/mariana-trench) es capaz de encontrar **vulnerabilidades** al **escanear** el **c칩digo** de la aplicaci칩n. Esta herramienta contiene una serie de **fuentes conocidas** (que indican a la herramienta los **lugares** donde la **entrada** est치 **controlada por el usuario**), **sumideros** (que indican a la herramienta **lugares peligrosos** donde la entrada maliciosa del usuario podr칤a causar da침os) y **reglas**. Estas reglas indican la **combinaci칩n** de **fuentes-sumideros** que se침alan una vulnerabilidad.

Con este conocimiento, **mariana-trench revisar치 el c칩digo y encontrar치 posibles vulnerabilidades en 칠l**.

### Secretos Revelados

Una aplicaci칩n puede contener secretos (claves de API, contrase침as, URLs ocultas, subdominios...) dentro de ella que podr칤as descubrir. Podr칤as usar una herramienta como [https://github.com/dwisiswant0/apkleaks](https://github.com/dwisiswant0/apkleaks)

### Eludir la Autenticaci칩n Biom칠trica

{% content-ref url="bypass-biometric-authentication-android.md" %}
[bypass-biometric-authentication-android.md](bypass-biometric-authentication-android.md)
{% endcontent-ref %}

### Otras funciones interesantes

* **Ejecuci칩n de c칩digo**: `Runtime.exec(), ProcessBuilder(), c칩digo nativo:system()`
* **Enviar SMS**: `sendTextMessage, sendMultipartTestMessage`
* **Funciones nativas** declaradas como `native`: `public native, System.loadLibrary, System.load`
* [Lee esto para aprender **c칩mo revertir funciones nativas**](reversing-native-libraries.md)

### **Otros trucos**

{% content-ref url="content-protocol.md" %}
[content-protocol.md](content-protocol.md)
{% endcontent-ref %}

***

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

칔nete al servidor de [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) para comunicarte con hackers experimentados y cazadores de recompensas por errores.

**Perspectivas de Hacking**\
Interact칰a con contenido que profundiza en la emoci칩n y los desaf칤os del hacking.

**Noticias de Hacking en Tiempo Real**\
Mantente al d칤a con el mundo del hacking a trav칠s de noticias e insights en tiempo real.

**칔ltimos Anuncios**\
Mantente informado con los lanzamientos de nuevas recompensas por errores y actualizaciones cruciales de la plataforma.

**칔nete a nosotros en** [**Discord**](https://discord.com/invite/N3FrSbmwdy) y comienza a colaborar con los mejores hackers hoy mismo.

***

## An치lisis Din치mico

> Primero que nada, necesitas un entorno donde puedas instalar la aplicaci칩n y todo el entorno (certificado CA de Burp, Drozer y Frida principalmente). Por lo tanto, se recomienda encarecidamente un dispositivo rooteado (emulado o no).

### An치lisis Din치mico en L칤nea

Puedes crear una **cuenta gratuita** en: [https://appetize.io/](https://appetize.io). Esta plataforma te permite **subir** y **ejecutar** APKs, por lo que es 칰til para ver c칩mo se comporta un apk.

Incluso puedes **ver los registros de tu aplicaci칩n** en la web y conectarte a trav칠s de **adb**.

![](<../../.gitbook/assets/image (60).png>)

Gracias a la conexi칩n ADB puedes usar **Drozer** y **Frida** dentro de los emuladores.

### An치lisis Din치mico Local

#### Usando un emulador

* [**Android Studio**](https://developer.android.com/studio) (Puedes crear dispositivos **x86** y **arm**, y seg칰n [**esto**](https://android-developers.googleblog.com/2020/03/run-arm-apps-on-android-emulator.html) las 칰ltimas versiones **x86** **soportan bibliotecas ARM** sin necesidad de un emulador arm lento).
* Aprende a configurarlo en esta p치gina:

{% content-ref url="avd-android-virtual-device.md" %}
[avd-android-virtual-device.md](avd-android-virtual-device.md)
{% endcontent-ref %}

* [**Genymotion**](https://www.genymotion.com/fun-zone/) **(Versi칩n gratuita:** Personal Edition, necesitas crear una cuenta. _Se recomienda **descargar** la versi칩n **CON**_ _**VirtualBox** para evitar posibles errores._)
* [**Nox**](https://es.bignox.com) (Gratis, pero no soporta Frida o Drozer).

{% hint style="info" %}
Al crear un nuevo emulador en cualquier plataforma, recuerda que cuanto m치s grande sea la pantalla, m치s lento funcionar치 el emulador. Por lo tanto, selecciona pantallas peque침as si es posible.
{% endhint %}

Para **instalar servicios de Google** (como AppStore) en Genymotion necesitas hacer clic en el bot칩n marcado en rojo de la siguiente imagen:

![](<../../.gitbook/assets/image (200) (1).png>)

Adem치s, ten en cuenta que en la **configuraci칩n de la VM de Android en Genymotion** puedes seleccionar **modo de red Bridge** (esto ser치 칰til si te conectar치s a la VM de Android desde una VM diferente con las herramientas).

#### Usar un dispositivo f칤sico

Necesitas activar las opciones de **depuraci칩n** y ser칤a genial si puedes **rootearlo**:

1. **Ajustes**.
2. (Desde Android 8.0) Selecciona **Sistema**.
3. Selecciona **Acerca del tel칠fono**.
4. Presiona **N칰mero de compilaci칩n** 7 veces.
5. Regresa y encontrar치s las **Opciones de desarrollador**.

> Una vez que hayas instalado la aplicaci칩n, lo primero que debes hacer es probarla e investigar qu칠 hace, c칩mo funciona y familiarizarte con ella.\
> Sugiero **realizar este an치lisis din치mico inicial usando el an치lisis din치mico de MobSF + pidcat**, para que podamos **aprender c칩mo funciona la aplicaci칩n** mientras MobSF **captura** una gran cantidad de **datos interesantes** que puedes revisar m치s tarde.

### Fuga de Datos No Intencionada

**Registro**

A menudo, los desarrolladores dejan informaci칩n de depuraci칩n p칰blicamente. Por lo tanto, cualquier aplicaci칩n con permiso `READ_LOGS` puede **acceder a esos registros** y obtener informaci칩n sensible a trav칠s de ellos.\
Mientras navegas por la aplicaci칩n, usa [**pidcat**](https://github.com/JakeWharton/pidcat)_(Recomendado, es m치s f치cil de usar y leer)_ o [adb logcat](adb-commands.md#logcat) para leer los registros creados y **buscar informaci칩n sensible**.

{% hint style="warning" %}
Ten en cuenta que desde versiones **posteriores a Android 4.0**, las **aplicaciones solo pueden acceder a sus propios registros**. Por lo tanto, las aplicaciones no pueden acceder a los registros de otras aplicaciones.\
De todos modos, todav칤a se recomienda **no registrar informaci칩n sensible**.
{% endhint %}

**Cach칠 del Buffer de Copiar/Pegar**

Android proporciona un marco basado en **portapapeles** para proporcionar la funci칩n de copiar y pegar en aplicaciones android. Pero esto crea un problema serio cuando alguna **otra aplicaci칩n** puede **acceder** al **portapapeles** que contiene datos sensibles. La funci칩n de **Copiar/Pegar** debe ser **deshabilitada** para la **parte sensible** de la aplicaci칩n. Por ejemplo, deshabilitar la copia de detalles de tarjetas de cr칠dito.

**Registros de Fallos**

Si una aplicaci칩n **se bloquea** durante la ejecuci칩n y **guarda registros** en alg칰n lugar, esos registros pueden ser de ayuda para un atacante, especialmente en casos en los que la aplicaci칩n android no se puede revertir. Entonces, evita crear registros cuando las aplicaciones se bloquean y si los registros se env칤an a trav칠s de la red, aseg칰rate de que se env칤en a trav칠s de un canal SSL.\
Como pentester, **intenta echar un vistazo a estos registros**.

**Datos Anal칤ticos Enviados a Terceros**

La mayor칤a de las aplicaciones utilizan otros servicios en su aplicaci칩n como Google Adsense, pero a veces **filtran algunos datos sensibles** o datos que no se requieren enviar a ese servicio. Esto puede ocurrir debido a que el desarrollador no implementa la funci칩n correctamente. Puedes **buscar interceptando el tr치fico** de la aplicaci칩n y ver si se env칤a alg칰n dato sensible a terceros o no.

### Bases de Datos SQLite

La mayor칤a de las aplicaciones utilizar치n **bases de datos SQLite internas** para guardar informaci칩n. Durante el pentest, echa un **vistazo** a las **bases de datos** creadas, los nombres de las **tablas** y **columnas** y todos los **datos** guardados porque podr칤as encontrar **informaci칩n sensible** (lo que ser칤a una vulnerabilidad).\
Las bases de datos deben estar ubicadas en `/data/data/el.nombre.del.paquete/databases` como `/data/data/com.mwr.example.sieve/databases`

Si la base de datos guarda informaci칩n confidencial y est치 **encriptada** pero puedes **encontrar** la **contrase침a** dentro de la aplicaci칩n, sigue siendo una **vulnerabilidad**.

Enumera las tablas usando `.tables` y enumera las columnas de las tablas haciendo `.schema <nombre_de_la_tabla>`

### Drozer (Explotar Actividades, Proveedores de Contenido y Servicios)

**Drozer** te permite **asumir el papel de una aplicaci칩n Android** e interactuar con otras aplicaciones. Puede hacer **todo lo que una aplicaci칩n instalada puede hacer**, como hacer uso del mecanismo de Comunicaci칩n entre Procesos (IPC) de Android e interactuar con el sistema operativo subyacente. Desde [Gu칤a de Drozer](https://labs.mwrinfosecurity.com/assets/BlogFiles/mwri-drozer-user-guide-2015-03-23.pdf).\
Drozer es una herramienta 칰til para **explotar actividades exportadas, servicios exportados y Proveedores de Contenido** como aprender치s en las siguientes secciones.

### Explotando Actividades Exportadas

[**Lee esto si quieres recordar qu칠 es una Actividad Android.**](android-applications-basics.md#launcher-activity-and-other-activities)\
Tambi칠n recuerda que el c칩digo de una actividad comienza con el m칠todo `onCreate`.

**Elusi칩n de autorizaci칩n**

Cuando una Actividad est치 exportada, puedes invocar su pantalla desde una aplicaci칩n externa. Por lo tanto, si una actividad con **informaci칩n sensible** est치 **exportada**, podr칤as **eludir** los mecanismos de **autenticaci칩n** **para acceder a ella.**\
[**Aprende c칩mo explotar actividades exportadas con Drozer.**](drozer-tutorial/#activities)

Tambi칠n puedes iniciar una actividad exportada desde adb:

* El NombreDelPaquete es com.example.demo
* El NombreDeLaActividadExportada es com.example.test.MainActivity
```bash
adb shell am start -n com.example.demo/com.example.test.MainActivity
```
**NOTA**: MobSF detectar치 como malicioso el uso de _**singleTask/singleInstance**_ como `android:launchMode` en una actividad, pero debido a [esto](https://github.com/MobSF/Mobile-Security-Framework-MobSF/pull/750), aparentemente esto solo es peligroso en versiones antiguas (versiones de API < 21).

{% hint style="info" %}
Ten en cuenta que un bypass de autorizaci칩n no siempre es una vulnerabilidad, depender치 de c칩mo funcione el bypass y qu칠 informaci칩n se exponga.
{% endhint %}

**Fuga de informaci칩n sensible**

**Las actividades tambi칠n pueden devolver resultados**. Si logras encontrar una actividad exportada y desprotegida que llame al m칠todo **`setResult`** y **devuelva informaci칩n sensible**, hay una fuga de informaci칩n sensible.

#### Tapjacking

Si no se previene el tapjacking, podr칤as abusar de la actividad exportada para hacer que el **usuario realice acciones inesperadas**. Para m치s informaci칩n sobre [**qu칠 es Tapjacking sigue el enlace**](./#tapjacking).

### Explotaci칩n de Content Providers - Acceso y manipulaci칩n de informaci칩n sensible

[**Lee esto si quieres recordar qu칠 es un Content Provider.**](android-applications-basics.md#content-provider)\
Los content providers se utilizan b치sicamente para **compartir datos**. Si una app tiene content providers disponibles, podr칤as ser capaz de **extraer datos sensibles** de ellos. Tambi칠n es interesante probar posibles **inyecciones SQL** y **Path Traversals** ya que podr칤an ser vulnerables.\
[**Aprende c칩mo explotar Content Providers con Drozer.**](drozer-tutorial/#content-providers)

### **Explotaci칩n de Servicios**

[**Lee esto si quieres recordar qu칠 es un Servicio.**](android-applications-basics.md#services)\
Recuerda que las acciones de un Servicio comienzan en el m칠todo `onStartCommand`.

Un servicio es b치sicamente algo que **puede recibir datos**, **procesarlos** y **devolver** (o no) una respuesta. Entonces, si una aplicaci칩n est치 exportando algunos servicios, debes **verificar** el **c칩digo** para entender qu칠 est치 haciendo y **probarlo** **din치micamente** para extraer informaci칩n confidencial, eludir medidas de autenticaci칩n...\
[**Aprende c칩mo explotar Servicios con Drozer.**](drozer-tutorial/#services)

### **Explotaci칩n de Broadcast Receivers**

[**Lee esto si quieres recordar qu칠 es un Broadcast Receiver.**](android-applications-basics.md#broadcast-receivers)\
Recuerda que las acciones de un Broadcast Receiver comienzan en el m칠todo `onReceive`.

Un broadcast receiver estar치 esperando por un tipo de mensaje. Dependiendo de c칩mo el receptor maneje el mensaje, podr칤a ser vulnerable.\
[**Aprende c칩mo explotar Broadcast Receivers con Drozer.**](./#exploiting-broadcast-receivers)

### **Explotaci칩n de Esquemas / Deep links**

Puedes buscar deep links manualmente, usando herramientas como MobSF o scripts como [este](https://github.com/ashleykinguk/FBLinkBuilder/blob/master/FBLinkBuilder.py).\
Puedes **abrir** un **esquema** declarado usando **adb** o un **navegador**:

{% code overflow="wrap" %}
```bash
adb shell am start -a android.intent.action.VIEW -d "scheme://hostname/path?param=value" [your.package.name]
```
{% endcode %}

_Tenga en cuenta que puede **omitir el nombre del paquete** y el m칩vil llamar치 autom치ticamente a la aplicaci칩n que deber칤a abrir ese enlace._

{% code overflow="wrap" %}
```markup
<!-- Browser regular link -->
<a href="scheme://hostname/path?param=value">Click me</a>
<!-- fallback in your url you could try the intent url -->
<a href="intent://hostname#Intent;scheme=scheme;package=your.package.name;S.browser_fallback_url=http%3A%2F%2Fwww.example.com;end">with alternative</a>
```
{% endcode %}

**C칩digo ejecutado**

Para encontrar el **c칩digo que se ejecutar치 en la App**, ve a la actividad llamada por el deeplink y busca la funci칩n **`onNewIntent`**.

![](<../../.gitbook/assets/image (436) (1) (1) (1).png>)

**Informaci칩n sensible**

Cada vez que encuentres un deep link verifica que **no est칠 recibiendo datos sensibles (como contrase침as) a trav칠s de par치metros URL**, porque cualquier otra aplicaci칩n podr칤a **suplantar el deep link y robar esos datos**.

**Par치metros en la ruta**

**Tambi칠n debes verificar si alg칰n deep link est치 utilizando un par치metro dentro de la ruta** de la URL como: `https://api.example.com/v1/users/{username}`, en ese caso puedes forzar un path traversal accediendo a algo como: `example://app/users?username=../../unwanted-endpoint%3fparam=value`.\
Ten en cuenta que si encuentras los endpoints correctos dentro de la aplicaci칩n, podr칤as causar un **Open Redirect** (si parte de la ruta se usa como nombre de dominio), **toma de control de cuenta** (si puedes modificar los detalles de los usuarios sin token CSRF y el endpoint vulnerable us칩 el m칠todo correcto) y cualquier otra vulnerabilidad. M치s [informaci칩n sobre esto aqu칤](http://dphoeniixx.com/2020/12/13-2/).

**M치s ejemplos**

Un [informe de bug bounty interesante](https://hackerone.com/reports/855618) sobre enlaces (_/.well-known/assetlinks.json_).

### Protecci칩n Insuficiente de la Capa de Transporte

* **Falta de Inspecci칩n de Certificados:** La Aplicaci칩n Android no verifica la identidad del certificado presentado. La mayor칤a de las aplicaciones ignoran las advertencias y aceptan cualquier certificado autofirmado presentado. Algunas aplicaciones, en cambio, pasan el tr치fico a trav칠s de una conexi칩n HTTP.
* **Negociaci칩n de Handshake D칠bil:** La aplicaci칩n y el servidor realizan un handshake SSL/TLS pero usan un conjunto de cifrado inseguro que es vulnerable a ataques MITM. Por lo tanto, cualquier atacante puede descifrar f치cilmente esa conexi칩n.
* **Fuga de Informaci칩n Privada:** La mayor칤a de las veces sucede que las aplicaciones hacen autenticaci칩n a trav칠s de un canal seguro pero el resto de la conexi칩n a trav칠s de un canal no seguro. Eso no contribuye a la seguridad de la aplicaci칩n porque otros datos sensibles como la cookie de sesi칩n o los datos del usuario pueden ser interceptados por un usuario malicioso.

De los 3 escenarios presentados vamos a discutir **c칩mo verificar la identidad del certificado**. Los otros 2 escenarios dependen de la **configuraci칩n TLS** del servidor y si la **aplicaci칩n env칤a datos sin cifrar**. El pentester debe verificar por s칤 mismo la configuraci칩n TLS del servidor ([aqu칤](../../network-services-pentesting/pentesting-web/#ssl-tls-vulnerabilites)) y detectar si cualquier **informaci칩n confidencial se env칤a por un canal no cifrado/vulnerable**.\
M치s informaci칩n sobre c칩mo descubrir y solucionar este tipo de vulnerabilidades [**aqu칤**](https://manifestsecurity.com/android-application-security-part-10/).

**SSL Pinning**

Por defecto, al realizar una conexi칩n SSL, el cliente (app android) verifica que el certificado del servidor tenga una cadena de confianza verificable hasta un certificado de confianza (ra칤z) y coincida con el nombre de host solicitado. Esto conduce al problema de **Ataques de Hombre en el Medio (MITM)**.\
En el Pinnning de Certificados, una Aplicaci칩n Android contiene el certificado del servidor y solo transmite datos si se presenta el mismo certificado.\
Se recomienda **aplicar SSL Pinning** para los sitios donde se va a enviar informaci칩n sensible.

### Inspecci칩n del tr치fico HTTP

Primero que todo, deber칤as (debes) **instalar el certificado** del **proxy** que vas a usar, probablemente Burp. Si no instalas el certificado CA del proxy, probablemente no podr치s ver el tr치fico cifrado en el proxy.\
**Por favor,** [**lee esta gu칤a para aprender c칩mo instalar un certificado CA personalizado**](avd-android-virtual-device.md#install-burp-certificate-on-a-virtual-machine)**.**

Para aplicaciones que apuntan al **Nivel de API 24+ no es suficiente instalar el certificado CA de Burp** en el dispositivo. Para eludir esta nueva protecci칩n necesitas modificar el archivo de Configuraci칩n de Seguridad de Red. Por lo tanto, podr칤as modificar este archivo para autorizar tu certificado CA o puedes [**leer esta p치gina para un tutorial sobre c칩mo forzar a la aplicaci칩n a aceptar de nuevo todos los certificados instalados en el dispositivo**](make-apk-accept-ca-certificate.md).

**SSL Pinning**

Ya hemos discutido qu칠 es SSL Pinning justo 2 p치rrafos antes. Cuando est치 implementado en una aplicaci칩n necesitar치s eludirlo para inspeccionar el tr치fico HTTPS o no lo ver치s.\
Aqu칤 voy a presentar algunas opciones que he usado para eludir esta protecci칩n:

* **Modificar** autom치ticamente el **apk** para **eludir** SSLPinning con [**apk-mitm**](https://github.com/shroudedcode/apk-mitm). La mejor ventaja de esta opci칩n es que no necesitar치s root para eludir el SSL Pinning, pero necesitar치s eliminar la aplicaci칩n y reinstalar la nueva, y esto no siempre funcionar치.
* Podr칤as usar **Frida** (discutido m치s abajo) para eludir esta protecci칩n. Aqu칤 tienes una gu칤a para usar Burp+Frida+Genymotion: [https://spenkk.github.io/bugbounty/Configuring-Frida-with-Burp-and-GenyMotion-to-bypass-SSL-Pinning/](https://spenkk.github.io/bugbounty/Configuring-Frida-with-Burp-and-GenyMotion-to-bypass-SSL-Pinning/)
* Tambi칠n puedes intentar **eludir autom치ticamente SSL Pinning** usando [**objection**](frida-tutorial/objection-tutorial.md)**:** `objection --gadget com.package.app explore --startup-command "android sslpinning disable"`
* Tambi칠n puedes intentar **eludir autom치ticamente SSL Pinning** usando **an치lisis din치mico de MobSF** (explicado m치s abajo)
* Si a칰n piensas que hay alg칰n tr치fico que no est치s capturando puedes intentar **redirigir el tr치fico a burp usando iptables**. Lee este blog: [https://infosecwriteups.com/bypass-ssl-pinning-with-ip-forwarding-iptables-568171b52b62](https://infosecwriteups.com/bypass-ssl-pinning-with-ip-forwarding-iptables-568171b52b62)

**Vulnerabilidades web comunes**

Ten en cuenta que en este paso debes buscar vulnerabilidades web comunes. Mucha informaci칩n sobre vulnerabilidades web se puede encontrar en este libro, as칤 que no las mencionar칠 aqu칤.

### Frida

Kit de herramientas de instrumentaci칩n din치mica para desarrolladores, ingenieros inversos e investigadores de seguridad. Aprende m치s en [www.frida.re](https://www.frida.re).\
**Es incre칤ble, puedes acceder a aplicaciones en ejecuci칩n y enganchar m칠todos en tiempo de ejecuci칩n para cambiar el comportamiento, cambiar valores, extraer valores, ejecutar c칩digo diferente...**\
**Si quieres hacer pentesting a aplicaciones Android necesitas saber c칩mo usar Frida.**

**Aprende a usar Frida:** [**Tutorial de Frida**](frida-tutorial/)\
**Algunas "GUI" para acciones con Frida:** [**https://github.com/m0bilesecurity/RMS-Runtime-Mobile-Security**](https://github.com/m0bilesecurity/RMS-Runtime-Mobile-Security)\
**Otras abstracciones basadas en Frida:** [**https://github.com/sensepost/objection**](https://github.com/sensepost/objection) **,** [**https://github.com/dpnishant/appmon**](https://github.com/dpnishant/appmon)\
**Puedes encontrar algunos scripts de Frida incre칤bles aqu칤:** [**https://codeshare.frida.re/**](https://codeshare.frida.re)

### **Volcado de Memoria - Fridump**

Verifica si la aplicaci칩n est치 almacenando informaci칩n sensible dentro de la memoria que no deber칤a estar almacenando, como contrase침as o mnem칩nicos.

Usando [**Fridump3**](https://github.com/rootbsd/fridump3) puedes volcar la memoria de la app con:
```bash
# With PID
python3 fridump3.py -u <PID>

# With name
frida-ps -Uai
python3 fridump3.py -u "<Name>"
```
Esta acci칩n volcar치 la memoria en la carpeta ./dump, y all칤 podr칤as usar grep con algo como:

{% code overflow="wrap" %}
```bash
strings * | grep -E "^[a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+$"
```
### **Datos sensibles en Keystore**

En Android, Keystore es el mejor lugar para almacenar datos sensibles, sin embargo, con suficientes privilegios a칰n es **posible acceder a 칠l**. Como las aplicaciones tienden a almacenar aqu칤 **datos sensibles en texto claro**, los pentests deben verificarlo como usuario root o alguien con acceso f칤sico al dispositivo podr칤a robar estos datos.

Incluso si una aplicaci칩n almacen칩 datos en el keystore, los datos deben estar cifrados.

Para acceder a los datos dentro del keystore puedes usar este script de Frida: [https://github.com/WithSecureLabs/android-keystore-audit/blob/master/frida-scripts/tracer-cipher.js](https://github.com/WithSecureLabs/android-keystore-audit/blob/master/frida-scripts/tracer-cipher.js)
```bash
frida -U -f com.example.app -l frida-scripts/tracer-cipher.js
```
### **Bypass de Huellas Dactilares/Biom칠tricos**

Utilizando el siguiente script de Frida podr칤a ser posible **bypass la autenticaci칩n por huella dactilar** que las aplicaciones Android podr칤an estar realizando para **proteger ciertas 치reas sensibles:**

{% code overflow="wrap" %}
```bash
frida --codeshare krapgras/android-biometric-bypass-update-android-11 -U -f <app.package>
```
{% endcode %}

### **Im치genes de Fondo**

Cuando pones una aplicaci칩n en segundo plano, Android almacena una **instant치nea de la aplicaci칩n** para que, cuando se recupere en primer plano, comience a cargar la imagen antes de la aplicaci칩n para que parezca que la aplicaci칩n se carg칩 m치s r치pido.

Sin embargo, si esta instant치nea contiene **informaci칩n sensible**, alguien con acceso a la instant치nea podr칤a **robar esa informaci칩n** (nota que necesitas ser root para acceder a ella).

Las instant치neas suelen almacenarse en: **`/data/system_ce/0/snapshots`**

Android proporciona una manera de **prevenir la captura de pantalla estableciendo el par치metro de dise침o FLAG\_SECURE**. Al usar esta bandera, el contenido de la ventana se trata como seguro, evitando que aparezca en capturas de pantalla o que sea visto en pantallas no seguras.
```bash
getWindow().setFlags(LayoutParams.FLAG_SECURE, LayoutParams.FLAG_SECURE);
```
### **Analizador de Aplicaciones Android**

Esta herramienta podr칤a ayudarte a gestionar diferentes herramientas durante el an치lisis din치mico: [https://github.com/NotSoSecure/android\_application\_analyzer](https://github.com/NotSoSecure/android\_application\_analyzer)

### Inyecci칩n de Intent

Esta vulnerabilidad se asemeja a **Open Redirect en seguridad web**. Dado que la clase `Intent` es `Parcelable`, **objetos pertenecientes a esta clase** pueden ser **pasados** como **datos extra** en otro objeto `Intent`.\
Muchos desarrolladores hacen **uso** de esta **caracter칤stica** y crean **componentes proxy** (actividades, receptores de difusi칩n y servicios) que **toman un Intent incrustado y lo pasan a m칠todos peligrosos** como `startActivity(...)`, `sendBroadcast(...)`, etc.\
Esto es peligroso porque **un atacante puede forzar a la app a lanzar un componente no exportado que no puede ser lanzado directamente desde otra app**, o para conceder al atacante acceso a sus proveedores de contenido. **`WebView`** tambi칠n a veces cambia una **URL de un string a un objeto `Intent`**, utilizando el m칠todo `Intent.parseUri(...)`, y lo pasa a `startActivity(...)`.

### Inyecciones en el Lado del Cliente de Android y otros

Probablemente conozcas este tipo de vulnerabilidades de la Web. Debes tener especial cuidado con estas vulnerabilidades en una aplicaci칩n Android:

* **SQL Injection:** Cuando trates con consultas din치micas o Content-Providers aseg칰rate de estar utilizando consultas parametrizadas.
* **JavaScript Injection (XSS):** Verifica que el soporte de JavaScript y Plugin est칠 desactivado para cualquier WebView (desactivado por defecto). [M치s informaci칩n aqu칤](webview-attacks.md#javascript-enabled).
* **Local File Inclusion:** Verifica que el acceso al sistema de archivos est칠 desactivado para cualquier WebView (activado por defecto) `(webview.getSettings().setAllowFileAccess(false);)`. [M치s informaci칩n aqu칤](webview-attacks.md#javascript-enabled).
* **Cookies eternas**: En varios casos cuando la aplicaci칩n android termina la sesi칩n la cookie no se revoca o incluso podr칤a ser guardada en disco
* [**Secure Flag** en cookies](../../pentesting-web/hacking-with-cookies/#cookies-flags)

***

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

칔nete al servidor de [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) para comunicarte con hackers experimentados y cazadores de recompensas por errores!

**Perspectivas de Hacking**\
Interact칰a con contenido que profundiza en la emoci칩n y los desaf칤os del hacking

**Noticias de Hacking en Tiempo Real**\
Mantente al d칤a con el mundo del hacking de ritmo r치pido a trav칠s de noticias e insights en tiempo real

**칔ltimos Anuncios**\
Mantente informado con los lanzamientos de nuevas recompensas por errores y actualizaciones cruciales de la plataforma

**칔nete a nosotros en** [**Discord**](https://discord.com/invite/N3FrSbmwdy) y comienza a colaborar con los mejores hackers hoy mismo!

## An치lisis Autom치tico

### [MobSF](https://github.com/MobSF/Mobile-Security-Framework-MobSF)

**An치lisis est치tico**

![](<../../.gitbook/assets/image (61).png>)

**Evaluaci칩n de vulnerabilidades de la aplicaci칩n** utilizando una agradable interfaz web. Tambi칠n puedes realizar an치lisis din치mico (pero necesitas preparar el entorno).
```bash
docker pull opensecurity/mobile-security-framework-mobsf
docker run -it -p 8000:8000 opensecurity/mobile-security-framework-mobsf:latest
```
Tenga en cuenta que MobSF puede analizar aplicaciones **Android** (apk), **IOS** (ipa) y **Windows** (apx) (_las aplicaciones de Windows deben analizarse desde un MobSF instalado en un host de Windows_).
Adem치s, si crea un archivo **ZIP** con el c칩digo fuente de una aplicaci칩n **Android** o **IOS** (vaya a la carpeta ra칤z de la aplicaci칩n, seleccione todo y cree un archivo ZIP), tambi칠n podr치 analizarlo.

MobSF tambi칠n permite **diff/Compare** an치lisis e integrar **VirusTotal** (necesitar치 configurar su clave API en _MobSF/settings.py_ y habilitarlo: `VT_ENABLED = TRUE` `VT_API_KEY = <Su clave API>` `VT_UPLOAD = TRUE`). Tambi칠n puede configurar `VT_UPLOAD` en `False`, entonces el **hash** ser치 **subido** en lugar del archivo.

### An치lisis din치mico asistido con MobSF

**MobSF** tambi칠n puede ser muy 칰til para el **an치lisis din치mico** en **Android**, pero en ese caso necesitar치 instalar MobSF y **genymotion** en su host (una VM o Docker no funcionar치). _Nota: Necesita **iniciar primero una VM en genymotion** y **luego MobSF.**_\
El **analizador din치mico MobSF** puede:

* **Volcar datos de la aplicaci칩n** (URLs, registros, portapapeles, capturas de pantalla hechas por usted, capturas de pantalla hechas por "**Exported Activity Tester**", correos electr칩nicos, bases de datos SQLite, archivos XML y otros archivos creados). Todo esto se hace autom치ticamente excepto las capturas de pantalla, necesita presionar cuando desee una captura de pantalla o necesita presionar "**Exported Activity Tester**" para obtener capturas de pantalla de todas las actividades exportadas.
* Capturar tr치fico **HTTPS**
* Usar **Frida** para obtener **informaci칩n en tiempo de ejecuci칩n**

Desde versiones de android **> 5**, **iniciar치 autom치ticamente Frida** y configurar치 ajustes globales de **proxy** para **capturar** tr치fico. Solo capturar치 tr치fico de la aplicaci칩n probada.

**Frida**

Por defecto, tambi칠n usar치 algunos scripts de Frida para **bypass SSL pinning**, **detecci칩n de root** y **detecci칩n de depurador** y para **monitorear APIs interesantes**.\
MobSF tambi칠n puede **invocar actividades exportadas**, capturar **capturas de pantalla** de ellas y **guardarlas** para el informe.

Para **iniciar** las pruebas din치micas presione el bot칩n verde: "**Start Instrumentation**". Presione "**Frida Live Logs**" para ver los registros generados por los scripts de Frida y "**Live API Monitor**" para ver todas las invocaciones a m칠todos enganchados, argumentos pasados y valores devueltos (esto aparecer치 despu칠s de presionar "Start Instrumentation").\
MobSF tambi칠n le permite cargar sus propios **scripts de Frida** (para enviar los resultados de sus scripts de Frida a MobSF use la funci칩n `send()`). Tambi칠n tiene **varios scripts preescritos** que puede cargar (puede agregar m치s en `MobSF/DynamicAnalyzer/tools/frida_scripts/others/`), solo **sel칠ctionelos**, presione "**Load**" y presione "**Start Instrumentation**" (podr치 ver los registros de esos scripts dentro de "**Frida Live Logs**").

![](<../../.gitbook/assets/image (215).png>)

Adem치s, tiene algunas funcionalidades auxiliares de Frida:

* **Enumerar Clases Cargadas**: Imprimir치 todas las clases cargadas
* **Capturar Cadenas**: Imprimir치 todas las cadenas capturadas mientras usa la aplicaci칩n (muy ruidoso)
* **Capturar Comparaciones de Cadenas**: Podr칤a ser muy 칰til. Mostrar치 **las 2 cadenas que se est치n comparando** y si el resultado fue Verdadero o Falso.
* **Enumerar M칠todos de Clase**: Ponga el nombre de la clase (como "java.io.File") e imprimir치 todos los m칠todos de la clase.
* **Buscar Patr칩n de Clase**: Buscar clases por patr칩n
* **Rastrear M칠todos de Clase**: **Rastrear** una **clase completa** (ver entradas y salidas de todos los m칠todos de la clase). Recuerde que por defecto MobSF rastrea varios m칠todos interesantes de la API de Android.

Una vez que haya seleccionado el m칩dulo auxiliar que desea usar, necesita presionar "**Start Instrumentation**" y ver치 todas las salidas en "**Frida Live Logs**".

**Shell**

MobSF tambi칠n le ofrece una shell con algunos comandos de **adb**, comandos de **MobSF** y comandos comunes de **shell** en la parte inferior de la p치gina de an치lisis din치mico. Algunos comandos interesantes:
```bash
help
shell ls
activities
exported_activities
services
receivers
```
**Herramientas HTTP**

Cuando se captura tr치fico http, puedes ver una vista poco atractiva del tr치fico capturado en el bot칩n inferior "**HTTP(S) Traffic**" o una vista m치s agradable en el bot칩n verde "**Start HTTPTools**". Desde la segunda opci칩n, puedes **enviar** las **solicitudes capturadas** a **proxies** como Burp o Owasp ZAP.\
Para hacerlo, _enciende Burp -->_ _desactiva Intercept --> en MobSB HTTPTools selecciona la solicitud_ --> presiona "**Send to Fuzzer**" --> _selecciona la direcci칩n del proxy_ ([http://127.0.0.1:8080\\](http://127.0.0.1:8080)).

Una vez que termines el an치lisis din치mico con MobSF, puedes presionar en "**Start Web API Fuzzer**" para **fuzzear solicitudes http** y buscar vulnerabilidades.

{% hint style="info" %}
Despu칠s de realizar un an치lisis din치mico con MobSF, la configuraci칩n del proxy puede estar mal configurada y no podr치s arreglarla desde la GUI. Puedes arreglar la configuraci칩n del proxy haciendo:
```
adb shell settings put global http_proxy :0
```
{% endhint %}

### An치lisis Din치mico Asistido con Inspeckage

Puedes obtener la herramienta desde [**Inspeckage**](https://github.com/ac-pm/Inspeckage).\
Esta herramienta utiliza algunos **Hooks** para informarte **qu칠 est치 sucediendo en la aplicaci칩n** mientras realizas un **an치lisis din치mico**.

{% content-ref url="inspeckage-tutorial.md" %}
[inspeckage-tutorial.md](inspeckage-tutorial.md)
{% endcontent-ref %}

### [Yaazhini](https://www.vegabird.com/yaazhini/)

Esta es una **excelente herramienta para realizar an치lisis est치tico con una GUI**

![](<../../.gitbook/assets/image (527).png>)

### [Qark](https://github.com/linkedin/qark)

Esta herramienta est치 dise침ada para buscar varias **vulnerabilidades relacionadas con la seguridad en aplicaciones Android**, ya sea en **c칩digo fuente** o **APKs empaquetados**. La herramienta tambi칠n es **capaz de crear un APK "Prueba-de-Concepto" desplegable** y **comandos ADB**, para explotar algunas de las vulnerabilidades encontradas (Actividades expuestas, intents, tapjacking...). Al igual que con Drozer, no es necesario rootear el dispositivo de prueba.
```bash
pip3 install --user qark  # --user is only needed if not using a virtualenv
qark --apk path/to/my.apk
qark --java path/to/parent/java/folder
qark --java path/to/specific/java/file.java
```
### [**ReverseAPK**](https://github.com/1N3/ReverseAPK.git)

* Muestra todos los archivos extra칤dos para f치cil referencia
* Descompila autom치ticamente archivos APK a formato Java y Smali
* Analiza AndroidManifest.xml para vulnerabilidades comunes y comportamiento
* An치lisis est치tico del c칩digo fuente para vulnerabilidades comunes y comportamiento
* Informaci칩n del dispositivo
* Intents
* Ejecuci칩n de comandos
* Referencias SQLite
* Referencias de registro
* Proveedores de contenido
* Receptores de difusi칩n
* Referencias de servicios
* Referencias de archivos
* Referencias criptogr치ficas
* Secretos codificados
* URL's
* Conexiones de red
* Referencias SSL
* Referencias WebView
```
reverse-apk relative/path/to/APP.apk
```
### [SUPER Android Analyzer](https://github.com/SUPERAndroidAnalyzer/super)

SUPER es una aplicaci칩n de l칤nea de comandos que se puede usar en Windows, MacOS X y Linux, que analiza archivos _.apk_ en busca de vulnerabilidades. Lo hace descomprimiendo los APKs y aplicando una serie de reglas para detectar dichas vulnerabilidades.

Todas las reglas est치n centradas en un archivo `rules.json`, y cada empresa o probador podr칤a crear sus propias reglas para analizar lo que necesiten.

Descarga los 칰ltimos binarios desde la [p치gina de descarga](https://superanalyzer.rocks/download.html)
```
super-analyzer {apk_file}
```
### [StaCoAn](https://github.com/vincentcox/StaCoAn)

![](<../../.gitbook/assets/image (62).png>)

StaCoAn es una herramienta **crossplatform** que ayuda a desarrolladores, cazadores de recompensas por errores y hackers 칠ticos a realizar [an치lisis de c칩digo est치tico](https://en.wikipedia.org/wiki/Static\_program\_analysis) en aplicaciones m칩viles\*.

El concepto es que arrastres y sueltes tu archivo de aplicaci칩n m칩vil (un archivo .apk o .ipa) en la aplicaci칩n StaCoAn y esta generar치 un informe visual y port치til para ti. Puedes ajustar la configuraci칩n y las listas de palabras para obtener una experiencia personalizada.

Descargar[ 칰ltima versi칩n](https://github.com/vincentcox/StaCoAn/releases):
```
./stacoan
```
### [AndroBugs](https://github.com/AndroBugs/AndroBugs_Framework)

AndroBugs Framework es un sistema de an치lisis de vulnerabilidades de Android que ayuda a desarrolladores o hackers a encontrar posibles vulnerabilidades de seguridad en aplicaciones Android.\
[Lanzamientos para Windows](https://github.com/AndroBugs/AndroBugs_Framework/releases)
```
python androbugs.py -f [APK file]
androbugs.exe -f [APK file]
```
### [Androwarn](https://github.com/maaaaz/androwarn)

**Androwarn** es una herramienta cuyo objetivo principal es detectar y advertir al usuario sobre posibles comportamientos maliciosos desarrollados por una aplicaci칩n Android.

La detecci칩n se realiza mediante el **an치lisis est치tico** del bytecode Dalvik de la aplicaci칩n, representado como **Smali**, con la biblioteca [`androguard`](https://github.com/androguard/androguard).

Esta herramienta busca **comportamientos comunes de aplicaciones "malas"** como: Exfiltraci칩n de identificadores de telefon칤a, Intercepci칩n de flujos de audio/video, Modificaci칩n de datos PIM, Ejecuci칩n de c칩digo arbitrario...
```
python androwarn.py -i my_application_to_be_analyzed.apk -r html -v 3
```
### [Marco de MARA](https://github.com/xtiankisutsa/MARA_Framework)

![](<../../.gitbook/assets/image (81).png>)

**MARA** es un **Marco de Ingenier칤a Inversa y An치lisis de Aplicaciones M칩viles**. Es una herramienta que re칰ne herramientas com칰nmente utilizadas para la ingenier칤a inversa y an치lisis de aplicaciones m칩viles, para asistir en el pentesting de aplicaciones m칩viles contra las amenazas de seguridad m칩vil de OWASP. Su objetivo es facilitar y hacer m치s amigable esta tarea para desarrolladores de aplicaciones m칩viles y profesionales de la seguridad.

Es capaz de:

* Extraer c칩digo Java y Smali utilizando diferentes herramientas
* Analizar APKs usando: [smalisca](https://github.com/dorneanu/smalisca), [ClassyShark](https://github.com/google/android-classyshark), [androbugs](https://github.com/AndroBugs/AndroBugs_Framework), [androwarn](https://github.com/maaaaz/androwarn), [APKiD](https://github.com/rednaga/APKiD)
* Extraer informaci칩n privada del APK utilizando regexps.
* Analizar el Manifiesto.
* Analizar dominios encontrados utilizando: [pyssltest](https://github.com/moheshmohan/pyssltest), [testssl](https://github.com/drwetter/testssl.sh) y [whatweb](https://github.com/urbanadventurer/WhatWeb)
* Desofuscar APK v칤a [apk-deguard.com](http://www.apk-deguard.com)

### Koodous

칔til para detectar malware: [https://koodous.com/](https://koodous.com)

## Ofuscaci칩n/Desofuscaci칩n de c칩digo

Nota que dependiendo del servicio y configuraci칩n que uses para ofuscar el c칩digo, los secretos pueden o no quedar ofuscados.

### [ProGuard](https://en.wikipedia.org/wiki/ProGuard_(software))

**ProGuard** es una herramienta de l칤nea de comandos de c칩digo abierto que reduce, optimiza y ofusca c칩digo Java. Es capaz de optimizar bytecode as칤 como detectar y eliminar instrucciones no utilizadas. ProGuard es software libre y se distribuye bajo la Licencia P칰blica General de GNU, versi칩n 2.

ProGuard se distribuye como parte del Android SDK y se ejecuta al construir la aplicaci칩n en modo de lanzamiento.

De: [https://en.wikipedia.org/wiki/ProGuard_(software)](https://en.wikipedia.org/wiki/ProGuard_(software))

### [DexGuard](https://www.guardsquare.com/dexguard)

Encuentra una gu칤a paso a paso para desofuscar el apk en [https://blog.lexfo.fr/dexguard.html](https://blog.lexfo.fr/dexguard.html)

(De esa gu칤a) La 칰ltima vez que verificamos, el modo de operaci칩n de Dexguard era:

* cargar un recurso como un InputStream;
* alimentar el resultado a una clase que hereda de FilterInputStream para desencriptarlo;
* realizar alguna ofuscaci칩n in칰til para perder unos minutos de tiempo de un reversor;
* alimentar el resultado desencriptado a un ZipInputStream para obtener un archivo DEX;
* finalmente cargar el DEX resultante como un Recurso utilizando el m칠todo `loadDex`.

### [DeGuard](http://apk-deguard.com)

**DeGuard revierte el proceso de ofuscaci칩n realizado por herramientas de ofuscaci칩n de Android. Esto permite numerosos an치lisis de seguridad, incluyendo inspecci칩n de c칩digo y predicci칩n de bibliotecas.**

Puedes subir un APK ofuscado a su plataforma.

### [Simplify](https://github.com/CalebFenton/simplify)

Es un **desofuscador gen칠rico de android.** Simplify **ejecuta virtualmente una app** para entender su comportamiento y luego **intenta optimizar el c칩digo** para que se comporte de manera id칠ntica pero sea m치s f치cil de entender para un humano. Cada tipo de optimizaci칩n es simple y gen칠rico, por lo que no importa el tipo espec칤fico de ofuscaci칩n utilizado.

### [APKiD](https://github.com/rednaga/APKiD)

APKiD te da informaci칩n sobre **c칩mo se hizo un APK**. Identifica muchos **compiladores**, **empaquetadores**, **ofuscadores**, y otras cosas extra침as. Es [_PEiD_](https://www.aldeid.com/wiki/PEiD) para Android.

### Manual

[Lea este tutorial para aprender algunos trucos sobre **c칩mo revertir ofuscaci칩n personalizada**](manual-deobfuscation.md)

## Laboratorios

### [Androl4b](https://github.com/sh4hin/Androl4b)

AndroL4b es una m치quina virtual de seguridad de Android basada en ubuntu-mate que incluye la colecci칩n de los 칰ltimos marcos, tutoriales y laboratorios de diferentes geeks de seguridad e investigadores para ingenier칤a inversa y an치lisis de malware.

### OWASP

{% embed url="https://github.com/OWASP/owasp-mstg%0Ahttps://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06g-testing-network-communication" %}

### Repositorios Git

[https://github.com/riddhi-shree/nullCommunity/tree/master/Android](https://github.com/riddhi-shree/nullCommunity/tree/master/Android)\
[https://www.youtube.com/watch?v=PMKnPaGWxtg&feature=youtu.be&ab_channel=B3nacSec](https://www.youtube.com/watch?v=PMKnPaGWxtg&feature=youtu.be&ab_channel=B3nacSec)

## Referencias

Para m치s informaci칩n visite:

* [https://appsecwiki.com/#/](https://appsecwiki.com/#/) Es una gran lista de recursos
* [https://maddiestone.github.io/AndroidAppRE/](https://maddiestone.github.io/AndroidAppRE/) Curso r치pido de Android
* [https://manifestsecurity.com/android-application-security/](https://manifestsecurity.com/android-application-security/)
* [https://github.com/Ralireza/Android-Security-Teryaagh](https://github.com/Ralireza/Android-Security-Teryaagh)

## Para Probar

* [https://www.vegabird.com/yaazhini/](https://www.vegabird.com/yaazhini/)
* [https://github.com/abhi-r3v0/Adhrit](https://github.com/abhi-r3v0/Adhrit)

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

칔nase al servidor de [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) para comunicarse con hackers experimentados y cazadores de recompensas por errores.

**Perspectivas de Hacking**\
Interact칰e con contenido que profundiza en la emoci칩n y los desaf칤os del hacking.

**Noticias de Hacking en Tiempo Real**\
Mant칠ngase al d칤a con el mundo del hacking a trav칠s de noticias e informaci칩n en tiempo real.

**칔ltimos Anuncios**\
Mant칠ngase informado con los lanzamientos de nuevas recompensas por errores y actualizaciones cruciales de la plataforma.

**칔nase a nosotros en** [**Discord**](https://discord.com/invite/N3FrSbmwdy) y comience a colaborar con los mejores hackers hoy mismo.

<details>

<summary><strong>Aprenda hacking de AWS de cero a h칠roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si desea ver su **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** Consulte los [**PLANES DE SUSCRIPCI칍N**](https://github.com/sponsors/carlospolop)!
* Obtenga el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci칩n de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **칔nase al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s칤game** en **Twitter** 游냕 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparta sus trucos de hacking enviando PRs a los repositorios de github de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
