# Pentesting des applications Android

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Travaillez-vous dans une **entreprise de cybers√©curit√©** ? Voulez-vous voir votre **entreprise annonc√©e dans HackTricks** ? Ou voulez-vous avoir acc√®s √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFT**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**üí¨**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR au** [**repo hacktricks**](https://github.com/carlospolop/hacktricks) **et au** [**repo hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

**HackenProof est la plateforme des primes de bugs cryptographiques.**

**Obtenez des r√©compenses sans d√©lai**\
Les primes HackenProof ne sont lanc√©es que lorsque leurs clients d√©posent le budget de r√©compense. Vous recevrez la r√©compense apr√®s la v√©rification du bug.

**Acqu√©rez de l'exp√©rience en pentesting web3**\
Les protocoles blockchain et les contrats intelligents sont le nouvel Internet ! Ma√Ætrisez la s√©curit√© web3 d√®s ses d√©buts.

**Devenez la l√©gende du hacker web3**\
Gagnez des points de r√©putation avec chaque bug v√©rifi√© et conqu√©rez le sommet du classement hebdomadaire.

[**Inscrivez-vous sur HackenProof**](https://hackenproof.com/register) commencez √† gagner gr√¢ce √† vos piratages !

{% embed url="https://hackenproof.com/register" %}

## Bases des applications Android

Il est fortement recommand√© de commencer par lire cette page pour conna√Ætre les **parties les plus importantes li√©es √† la s√©curit√© Android et les composants les plus dangereux d'une application Android** :

{% content-ref url="android-applications-basics.md" %}
[android-applications-basics.md](android-applications-basics.md)
{% endcontent-ref %}

## ADB (Android Debug Bridge)

C'est l'outil principal dont vous avez besoin pour vous connecter √† un appareil Android (√©mul√© ou physique).\
Il vous permet de contr√¥ler votre appareil via **USB** ou **R√©seau** depuis un ordinateur, de **copier** des fichiers aller-retour, d'**installer** et de d√©sinstaller des applications, d'ex√©cuter des commandes **shell**, d'effectuer des **sauvegardes**, de lire des **logs** et plus encore.

Consultez la liste suivante des [**commandes ADB**](adb-commands.md) pour apprendre √† utiliser adb.

## Smali

Parfois, il est int√©ressant de **modifier le code de l'application** pour acc√©der √† des **informations cach√©es** (peut-√™tre des mots de passe bien obfusqu√©s ou des indicateurs). Ensuite, il peut √™tre int√©ressant de d√©compiler l'APK, de modifier le code et de le recompiler.\
[**Dans ce tutoriel** vous pouvez **apprendre comment d√©compiler un APK, modifier le code Smali et recompiler l'APK** avec la nouvelle fonctionnalit√©](smali-changes.md). Cela peut √™tre tr√®s utile comme **alternative pour plusieurs tests lors de l'analyse dynamique** qui vont √™tre pr√©sent√©s. Alors, **gardez toujours cette possibilit√© √† l'esprit**.

## Autres astuces int√©ressantes

* [Fausser votre emplacement dans le Play Store](spoofing-your-location-in-play-store.md)
* **T√©l√©charger des APK** : [https://apps.evozi.com/apk-downloader/](https://apps.evozi.com/apk-downloader/), [https://apkpure.com/es/](https://apkpure.com/es/), [https://www.apkmirror.com/](https://www.apkmirror.com), [https://apkcombo.com/es-es/apk-downloader/](https://apkcombo.com/es-es/apk-downloader/)
* Extraire l'APK de l'appareil :
```bash
adb shell pm list packages
com.android.insecurebankv2

adb shell pm path com.android.insecurebankv2
package:/data/app/com.android.insecurebankv2-Jnf8pNgwy3QA_U5f-n_4jQ==/base.apk

adb pull /data/app/com.android.insecurebankv2- Jnf8pNgwy3QA_U5f-n_4jQ==/base.apk
```
## Analyse statique

Tout d'abord, pour analyser un APK, vous devriez **jeter un coup d'≈ìil au code Java** en utilisant un d√©compilateur.\
Veuillez [**lire ici pour trouver des informations sur les diff√©rents d√©compilateurs disponibles**](apk-decompilers.md).

### Recherche d'informations int√©ressantes

En jetant simplement un coup d'≈ìil aux **cha√Ænes de caract√®res** de l'APK, vous pouvez rechercher des **mots de passe**, des **URL** ([https://github.com/ndelphit/apkurlgrep](https://github.com/ndelphit/apkurlgrep)), des cl√©s **API**, du **chiffrement**, des **UUID Bluetooth**, des **jetons** et tout ce qui est int√©ressant... recherchez m√™me des **backdoors** d'ex√©cution de code ou des backdoors d'authentification (identifiants administrateur cod√©s en dur dans l'application).

**Firebase**

Portez une attention particuli√®re aux **URL Firebase** et v√©rifiez si elles sont mal configur√©es. [Plus d'informations sur ce qu'est Firebase et comment l'exploiter ici.](../../network-services-pentesting/pentesting-web/buckets/firebase-database.md)

### Compr√©hension de base de l'application - Manifest.xml, strings.xml

En utilisant l'un des **d√©compilateurs** mentionn√©s [**ici**](apk-decompilers.md), vous pourrez lire le _Manifest.xml_. Vous pouvez √©galement **renommer** le fichier APK avec l'extension **.zip** et le **d√©compresser**.\
En lisant le **manifeste**, vous pouvez trouver des **vuln√©rabilit√©s** :

* Tout d'abord, v√©rifiez si **l'application peut √™tre d√©bogu√©e**. Un APK de production ne devrait pas l'√™tre (sinon d'autres pourront s'y connecter). Vous pouvez v√©rifier si une application peut √™tre d√©bogu√©e en recherchant dans le manifeste l'attribut `debuggable="true"` √† l'int√©rieur de la balise _\<application_ Exemple : `<application theme="@2131296387" debuggable="true"`
* [Apprenez ici](drozer-tutorial/#is-debuggeable) comment trouver des applications d√©boguables sur un t√©l√©phone et les exploiter.
* **Sauvegarde** : L'attribut **`android:allowBackup`** d√©finit si les donn√©es de l'application peuvent √™tre sauvegard√©es et restaur√©es par un utilisateur ayant activ√© le d√©bogage USB. Si le drapeau de sauvegarde est d√©fini sur true, cela permet √† un attaquant de sauvegarder les donn√©es de l'application via adb m√™me si l'appareil n'est pas root√©. Par cons√©quent, les applications qui g√®rent et stockent des informations sensibles telles que les d√©tails de carte, les mots de passe, etc. doivent avoir ce param√®tre explicitement d√©fini sur **false**, car par d√©faut il est d√©fini sur **true** pour √©viter de tels risques.
* `<application android:allowBackup="false"`
* **NetworkSecurity** : La s√©curit√© r√©seau de l'application peut remplacer les valeurs par d√©faut avec **`android:networkSecurityConfig="@xml/network_security_config"`**. Un fichier portant ce nom peut √™tre plac√© dans _**res/xml.**_ Ce fichier configurera des param√®tres de s√©curit√© importants tels que les √©pingles de certificat ou s'il autorise le trafic HTTP. Vous pouvez lire ici plus d'informations sur toutes les choses qui peuvent √™tre configur√©es, mais v√©rifiez cet exemple sur la configuration du trafic HTTP pour certains domaines :
* `<domain-config cleartextTrafficPermitted="true"> <domain includeSubdomains="true">formation-software.co.uk </domain></domain-config>`
* **Activit√©s export√©es** : V√©rifiez les activit√©s export√©es dans le manifeste car cela peut √™tre dangereux. Plus tard dans l'analyse dynamique, il sera expliqu√© comment [exploiter ce comportement](./#exploiting-exported-activities-authorisation-bypass).
* **Fournisseurs de contenu** : Si un fournisseur export√© est expos√©, vous pourriez avoir acc√®s/modifier des informations int√©ressantes. Dans l'analyse dynamique, [vous apprendrez comment les exploiter](./#exploiting-content-providers-accessing-and-manipulating-sensitive-information).
* V√©rifiez les configurations des **FileProviders** dans l'attribut `android:name="android.support.FILE_PROVIDER_PATHS"`. [Lisez ici pour en savoir plus sur les FileProviders](./#fileprovider).
* **Services expos√©s** : Selon ce que le service fait en interne, des vuln√©rabilit√©s pourraient √™tre exploit√©es. Dans l'analyse dynamique, [vous apprendrez comment les exploiter](./#exploiting-services).
* **Receveurs de diffusion** : [Vous apprendrez comment les exploiter √©ventuellement](./#exploiting-broadcast-receivers) lors de l'analyse dynamique.
* **Sch√©ma d'URL** : Lisez le code de l'activit√© g√©rant le sch√©ma et recherchez des vuln√©rabilit√©s dans la gestion de l'entr√©e de l'utilisateur. Plus d'informations sur [ce qu'est un sch√©ma d'URL ici](./#url-schemes).
* **minSdkVersion**, **targetSDKVersion**, **maxSdkVersion** : Ils indiquent les versions d'Android sur lesquelles l'application fonctionnera. Il est important de les garder √† l'esprit car du point de vue de la s√©curit√©, le support des anciennes versions permettra l'ex√©cution de versions vuln√©rables d'Android.

En lisant **resources.arsc/strings.xml**, vous pouvez trouver des informations int√©ressantes :

* Cl√©s API
* Sch√©mas personnalis√©s
* Autres informations int√©ressantes que les d√©veloppeurs enregistrent dans ce fichier

### Tapjacking

**Tapjacking** est une attaque o√π une **application malveillante** est lanc√©e et **se positionne au-dessus d'une application victime**. Une fois qu'elle obscurcit visiblement l'application victime, son interface utilisateur est con√ßue de mani√®re √† tromper l'utilisateur pour qu'il interagisse avec elle, tout en transmettant l'interaction √† l'application victime.\
En effet, cela **emp√™che l'utilisateur de savoir qu'il effectue r√©ellement des actions sur l'application victime**.

Pour d√©tecter les applications vuln√©rables √† cette attaque, vous devriez rechercher des **activit√©s export√©es** dans le manifeste Android (notez qu'une activit√© avec un intent-filter est automatiquement export√©e par d√©faut). Une fois que vous avez trouv√© les activit√©s export√©es, **v√©rifiez si elles n√©cessitent des autorisations**. Cela est d√ª au fait que la **application malveillante aura √©galement besoin de cette autorisation**.\
Enfin, il est important de v√©rifier le code pour d'√©ventuelles configurations de **`setFilterTouchesWhenObscured`**. Si elle est d√©finie sur **`true`**, un bouton peut √™tre automatiquement d√©sactiv√© s'il est obscurci :
```markup
<Button android:text="Button"
android:id="@+id/button1"
android:layout_width="wrap_content"
android:layout_height="wrap_content"
android:filterTouchesWhenObscured="true">
</Button>
```
Vous pouvez utiliser [**qark**](https://github.com/linkedin/qark) avec les param√®tres `--exploit-apk` --sdk-path `/Users/username/Library/Android/sdk` pour cr√©er une application malveillante afin de tester les vuln√©rabilit√©s potentielles de **Tapjacking**.\
Un projet d'exemple impl√©mentant ce type de fonctionnalit√© peut √™tre trouv√© dans [**FloatingWindowApp**](https://github.com/aminography/FloatingWindowApp).

La mitigation est relativement simple car le d√©veloppeur peut choisir de ne pas recevoir les √©v√©nements tactiles lorsqu'une vue est recouverte par une autre. Utilisez la [R√©f√©rence du d√©veloppeur Android](https://developer.android.com/reference/android/view/View#security):

> Parfois, il est essentiel qu'une application puisse v√©rifier qu'une action est effectu√©e avec la pleine connaissance et le consentement de l'utilisateur, comme accorder une demande d'autorisation, effectuer un achat ou cliquer sur une publicit√©. Malheureusement, une application malveillante pourrait essayer de tromper l'utilisateur en lui faisant effectuer ces actions, sans le savoir, en dissimulant l'objectif r√©el de la vue. Pour rem√©dier √† cela, le framework propose un m√©canisme de filtrage tactile qui peut √™tre utilis√© pour am√©liorer la s√©curit√© des vues qui fournissent un acc√®s √† des fonctionnalit√©s sensibles.
>
> Pour activer le filtrage tactile, appelez [`setFilterTouchesWhenObscured(boolean)`](https://developer.android.com/reference/android/view/View#setFilterTouchesWhenObscured%28boolean%29) ou d√©finissez l'attribut de mise en page android:filterTouchesWhenObscured sur true. Lorsqu'il est activ√©, le framework ignorera les touches re√ßues chaque fois que la fen√™tre de la vue est masqu√©e par une autre fen√™tre visible. Par cons√©quent, la vue ne recevra pas de touches chaque fois qu'un toast, une bo√Æte de dialogue ou une autre fen√™tre appara√Æt au-dessus de la fen√™tre de la vue.

### D√©tournement de t√¢che

Une **activit√©** avec le **`launchMode`** d√©fini sur **`singleTask` sans aucune `taskAffinity`** d√©finie est vuln√©rable au d√©tournement de t√¢che. Cela signifie qu'une **application** peut √™tre install√©e et si elle est lanc√©e avant l'application r√©elle, elle peut **d√©tourner la t√¢che de l'application r√©elle** (ainsi, l'utilisateur interagira avec l'**application malveillante en pensant qu'il utilise la vraie**).

Plus d'informations dans :

{% content-ref url="android-task-hijacking.md" %}
[android-task-hijacking.md](android-task-hijacking.md)
{% endcontent-ref %}

### Stockage de donn√©es non s√©curis√©

**Stockage interne**

Les fichiers **cr√©√©s** sur le **stockage interne** sont **accessibles** uniquement par l'**application**. Cette protection est mise en ≈ìuvre par Android et est suffisante pour la plupart des applications. Cependant, les d√©veloppeurs utilisent souvent `MODE_WORLD_READBALE` et `MODE_WORLD_WRITABLE` pour donner acc√®s √† ces fichiers √† une autre application, mais cela ne limite pas les autres applications (malveillantes) √† y acc√©der.\
Lors de l'**analyse statique**, v√©rifiez l'utilisation de ces **modes**, lors de l'**analyse dynamique**, v√©rifiez les **permissions** des fichiers cr√©√©s (certains d'entre eux peuvent √™tre lisibles/inscriptibles dans le monde entier).\
[Plus d'informations sur cette vuln√©rabilit√© et comment la corriger ici.](https://manifestsecurity.com/android-application-security-part-8/)

**Stockage externe**

Les fichiers cr√©√©s sur le **stockage externe**, tels que les cartes SD, sont **lisibles et inscriptibles √† l'√©chelle mondiale**. √âtant donn√© que le stockage externe peut √™tre supprim√© par l'utilisateur et √©galement modifi√© par n'importe quelle application, vous ne devez **pas stocker d'informations sensibles √† l'aide du stockage externe**.\
Comme pour les donn√©es provenant de toute source non fiable, vous devez **effectuer une validation des entr√©es** lors de la manipulation de **donn√©es provenant du stockage externe**. Nous vous recommandons vivement de ne pas stocker d'ex√©cutables ou de fichiers de classe sur le stockage externe avant le chargement dynamique. Si votre application r√©cup√®re des fichiers ex√©cutables √† partir du stockage externe, les fichiers doivent √™tre sign√©s et v√©rifi√©s cryptographiquement avant le chargement dynamique.\
Informations tir√©es [d'ici](https://manifestsecurity.com/android-application-security-part-8/).

Le stockage externe peut √™tre **acc√©d√©** via `/storage/emulated/0`, `/sdcard`, `/mnt/sdcard`

{% hint style="info" %}
√Ä partir d'Android 4.4 (**API 17**), la carte SD dispose d'une structure de r√©pertoire qui **limite l'acc√®s d'une application au r√©pertoire sp√©cifique √† cette application**. Cela emp√™che une application malveillante d'acc√©der en lecture ou en √©criture aux fichiers d'une autre application.
{% endhint %}

**Donn√©es sensibles stock√©es en clair**

* **Pr√©f√©rences partag√©es** : Android permet √† chaque application de sauvegarder facilement des fichiers XML dans le chemin `/data/data/<nomdupackage>/shared_prefs/` et il est parfois possible de trouver des informations sensibles en clair dans ce dossier.
* **Bases de donn√©es** : Android permet √† chaque application de sauvegarder facilement des bases de donn√©es SQLite dans le chemin `/data/data/<nomdupackage>/databases/` et il est parfois possible de trouver des informations sensibles en clair dans ce dossier.

### TLS cass√©

**Accepter tous les certificats**

Pour une raison quelconque, parfois les d√©veloppeurs acceptent tous les certificats, m√™me si, par exemple, le nom d'h√¥te ne correspond pas avec des lignes de code comme celle-ci :
```java
SSLSocketFactory sf = new cc(trustStore);
sf.setHostnameVerifier(SSLSocketFactory.ALLOW_ALL_HOSTNAME_VERIFIER);
```
Une bonne fa√ßon de tester cela est d'essayer de capturer le trafic en utilisant un proxy comme Burp sans autoriser Burp CA √† l'int√©rieur de l'appareil. Vous pouvez √©galement g√©n√©rer avec Burp un certificat pour un nom d'h√¥te diff√©rent et l'utiliser.

### Cryptographie d√©faillante

**Mauvais processus de gestion des cl√©s**

Certains d√©veloppeurs enregistrent des donn√©es sensibles dans le stockage local et les chiffrent avec une cl√© cod√©e en dur/pr√©visible dans le code. Cela ne devrait pas √™tre fait car une r√©tro-ing√©nierie pourrait permettre aux attaquants d'extraire les informations confidentielles.

**Utilisation d'algorithmes non s√©curis√©s et/ou obsol√®tes**

Les d√©veloppeurs ne devraient pas utiliser d'algorithmes obsol√®tes pour effectuer des v√©rifications d'autorisation, stocker ou envoyer des donn√©es. Certains de ces algorithmes sont : RC4, MD4, MD5, SHA1... Si des hachages sont utilis√©s pour stocker des mots de passe par exemple, des hachages r√©sistants √† la force brute devraient √™tre utilis√©s avec un sel.

### Autres v√©rifications

* Il est recommand√© d'**obfusquer l'APK** pour rendre plus difficile le travail de r√©tro-ing√©nierie des attaquants.
* Si l'application est sensible (comme les applications bancaires), elle devrait effectuer ses propres v√©rifications pour voir si le mobile est root√© et agir en cons√©quence.
* Si l'application est sensible (comme les applications bancaires), elle devrait v√©rifier si un √©mulateur est utilis√©.
* Si l'application est sensible (comme les applications bancaires), elle devrait v√©rifier son int√©grit√© avant de l'ex√©cuter pour v√©rifier si elle a √©t√© modifi√©e.
* Utilisez [**APKiD**](https://github.com/rednaga/APKiD) pour v√©rifier quel compilateur/packer/obfuscateur a √©t√© utilis√© pour construire l'APK.

### Application React Native

Lisez la page suivante pour apprendre comment acc√©der facilement au code JavaScript des applications React :

{% content-ref url="react-native-application.md" %}
[react-native-application.md](react-native-application.md)
{% endcontent-ref %}

### Applications Xamarin

Lisez la page suivante pour apprendre comment acc√©der facilement au code C# des applications Xamarin :

{% content-ref url="../xamarin-apps.md" %}
[xamarin-apps.md](../xamarin-apps.md)
{% endcontent-ref %}

### Applications Superpacked

Selon ce [**billet de blog**](https://clearbluejar.github.io/posts/desuperpacking-meta-superpacked-apks-with-github-actions/), Superpacked est un m√©ta-algorithme qui compresse le contenu d'une application dans un seul fichier. Le blog parle de la possibilit√© de cr√©er une application qui d√©compresse ce type d'applications... et d'une fa√ßon plus rapide qui consiste √† ex√©cuter l'application et √† r√©cup√©rer les fichiers d√©compress√©s du syst√®me de fichiers.

### Analyse statique automatis√©e du code

L'outil [**mariana-trench**](https://github.com/facebook/mariana-trench) est capable de trouver des vuln√©rabilit√©s en analysant le code de l'application. Cet outil contient une s√©rie de **sources connues** (qui indiquent √† l'outil les endroits o√π l'entr√©e est contr√¥l√©e par l'utilisateur), des **sinks** (qui indiquent √† l'outil les endroits dangereux o√π une entr√©e utilisateur malveillante pourrait causer des dommages) et des **r√®gles**. Ces r√®gles indiquent la combinaison de sources-sinks qui indique une vuln√©rabilit√©.

Avec cette connaissance, **mariana-trench examinera le code et trouvera les vuln√©rabilit√©s possibles**.

### Fuites de secrets

Une application peut contenir des secrets (cl√©s API, mots de passe, URL cach√©es, sous-domaines...) √† l'int√©rieur que vous pourriez √™tre en mesure de d√©couvrir. Vous pouvez utiliser un outil tel que [https://github.com/dwisiswant0/apkleaks](https://github.com/dwisiswant0/apkleaks)

### Contourner l'authentification biom√©trique

{% content-ref url="bypass-biometric-authentication-android.md" %}
[bypass-biometric-authentication-android.md](bypass-biometric-authentication-android.md)
{% endcontent-ref %}

### Autres fonctions int√©ressantes

* **Ex√©cution de code** : `Runtime.exec(), ProcessBuilder(), code natif:system()`
* **Envoi de SMS** : `sendTextMessage, sendMultipartTestMessage`
* **Fonctions natives** d√©clar√©es comme `native` : `public native, System.loadLibrary, System.load`
* [Lisez ceci pour apprendre **comment inverser les fonctions natives**](reversing-native-libraries.md)

### **Autres astuces**

{% content-ref url="content-protocol.md" %}
[content-protocol.md](content-protocol.md)
{% endcontent-ref %}

***

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

**HackenProof est la plateforme des primes de bugs cryptographiques.**

**Obtenez une r√©compense sans d√©lai**\
Les primes HackenProof ne sont lanc√©es que lorsque leurs clients d√©posent le budget de r√©compense. Vous recevrez la r√©compense apr√®s la v√©rification du bogue.

**Acqu√©rez de l'exp√©rience en pentest web3**\
Les protocoles blockchain et les contrats intelligents sont le nouvel Internet ! Ma√Ætrisez la s√©curit√© web3 √† ses d√©buts.

**Devenez la l√©gende du hacker web3**\
Gagnez des points de r√©putation avec chaque bogue v√©rifi√© et conqu√©rez le sommet du classement hebdomadaire.

[**Inscrivez-vous sur HackenProof**](https://hackenproof.com/register) et commencez √† gagner gr√¢ce √† vos hacks !

{% embed url="https://hackenproof.com/register" %}

***

## Analyse dynamique

> Tout d'abord, vous avez besoin d'un environnement o√π vous pouvez installer l'application et tout l'environnement (certificat Burp CA, Drozer et Frida principalement). Par cons√©quent, un appareil root√© (√©mul√© ou non) est extr√™mement recommand√©.

### Analyse dynamique en ligne

Vous pouvez cr√©er un **compte gratuit** sur : [https://appetize.io/](https://appetize.io). Cette plateforme vous permet de **t√©l√©charger** et **ex√©cuter** des APK, il est donc utile de voir comment un APK se comporte.

Vous pouvez m√™me **voir les journaux de votre application** sur le web et vous connecter via **adb**.

![](<../../.gitbook/assets/image (60).png>)

Gr√¢ce √† la connexion ADB, vous pouvez utiliser **Drozer** et **Frida** √† l'int√©rieur des √©mulateurs.

### Analyse dynamique locale

#### Utilisation d'un √©mulateur

* [**Android Studio**](https://developer.android.com/studio) (Vous pouvez cr√©er des appareils **x86** et **arm**, et selon [**ceci**](https://android-developers.googleblog.com/2020/03/run-arm-apps-on-android-emulator.html), les **derni√®res versions x86** prennent en charge les biblioth√®ques ARM sans avoir besoin d'un √©mulateur ARM lent).
* Apprenez √† le configurer sur cette page :

{% content-ref url="avd-android-virtual-device.md" %}
[avd-android-virtual-device.md](avd-android-virtual-device.md)
{% endcontent-ref %}

* [**Genymotion**](https://www.genymotion.com/fun-zone/) **(Version gratuite :** Personal Edition, vous devez cr√©er un compte. _Il est recommand√© de **t√©l√©charger** la version **AVEC**_ _**VirtualBox** pour √©viter les erreurs potentielles._)
* [**Nox**](https://es.bignox.com) (Gratuit, mais ne prend pas en charge Frida ou Drozer).

{% hint style="info" %}
Lors de la cr√©ation d'un nouvel √©mulateur sur n'importe quelle plateforme, rappelez-vous que plus l'√©cran est grand, plus l'√©mulateur sera lent. Choisissez donc de petits √©crans si possible.
{% endhint %}

Pour **installer les services Google** (comme AppStore) dans Genymotion, vous devez cliquer sur le bouton marqu√© en rouge sur l'image suivante :

![](<../../.gitbook/assets/image (200) (1).png>)

De plus, notez que dans la **configuration de la machine virtuelle Android dans Genymotion**, vous pouvez s√©lectionner le mode **Bridge Network** (ceci sera utile si vous devez vous connecter √† la machine virtuelle Android √† partir d'une autre machine virtuelle avec les outils).
#### Utiliser un appareil physique

Vous devez activer les options de **d√©bogage** et il serait bien si vous pouvez le **rooter** :

1. **Param√®tres**.
2. (√Ä partir d'Android 8.0) S√©lectionnez **Syst√®me**.
3. S√©lectionnez **√Ä propos du t√©l√©phone**.
4. Appuyez 7 fois sur **Num√©ro de build**.
5. Revenez en arri√®re et vous trouverez les **Options pour les d√©veloppeurs**.

> Une fois que vous avez install√© l'application, la premi√®re chose √† faire est de l'essayer et d'enqu√™ter sur ce qu'elle fait, comment elle fonctionne et de vous familiariser avec elle.\
> Je vous sugg√®re de **r√©aliser cette analyse dynamique initiale en utilisant l'analyse dynamique MobSF + pidcat**, afin de **comprendre comment fonctionne l'application** tandis que MobSF **capture** de nombreuses **donn√©es int√©ressantes** que vous pourrez examiner ult√©rieurement.

### Fuite de donn√©es involontaire

**Journalisation**

Souvent, les d√©veloppeurs laissent des informations de d√©bogage accessibles au public. Ainsi, toute application disposant de l'autorisation `READ_LOGS` peut **acc√©der √† ces journaux** et obtenir des informations sensibles.\
Lors de la navigation dans l'application, utilisez [**pidcat**](https://github.com/JakeWharton/pidcat)_(Recommand√©, il est plus facile √† utiliser et √† lire)_ ou [adb logcat](adb-commands.md#logcat) pour lire les journaux cr√©√©s et **rechercher des informations sensibles**.

{% hint style="warning" %}
Notez que **√† partir des versions ult√©rieures √† Android 4.0**, **les applications ne peuvent acc√©der qu'√† leurs propres journaux**. Les applications ne peuvent donc pas acc√©der aux journaux d'autres applications.\
Quoi qu'il en soit, il est toujours recommand√© de **ne pas enregistrer d'informations sensibles**.
{% endhint %}

**Mise en cache du presse-papiers**

Android fournit un framework bas√© sur le presse-papiers pour permettre la fonction de copier-coller dans les applications Android. Mais cela cr√©e un probl√®me s√©rieux lorsque certaines **autres applications** peuvent **acc√©der** au **presse-papiers** qui contient des donn√©es sensibles. La fonction de **copier-coller** devrait √™tre **d√©sactiv√©e** pour les parties **sensibles** de l'application. Par exemple, d√©sactivez la copie des d√©tails de la carte de cr√©dit.

**Journaux de plantage**

Si une application **plante** pendant son ex√©cution et qu'elle **enregistre des journaux** quelque part, ces journaux peuvent √™tre utiles √† un attaquant, notamment dans les cas o√π l'application Android ne peut pas √™tre r√©tro-ing√©nier√©e. Dans ce cas, √©vitez de cr√©er des journaux lorsque l'application plante et si les journaux sont envoy√©s via le r√©seau, assurez-vous qu'ils sont envoy√©s via un canal SSL.\
En tant que pentester, **essayez de jeter un coup d'≈ìil √† ces journaux**.

**Donn√©es d'analyse envoy√©es √† des tiers**

La plupart des applications utilisent d'autres services dans leur application, comme Google Adsense, mais parfois elles **laissent fuir des donn√©es sensibles** ou des donn√©es qui ne sont pas n√©cessaires √† envoyer √† ce service. Cela peut se produire parce que le d√©veloppeur n'a pas correctement impl√©ment√© la fonctionnalit√©. Vous pouvez **v√©rifier en interceptant le trafic** de l'application et voir si des donn√©es sensibles sont envoy√©es √† des tiers ou non.

### Bases de donn√©es SQLite

La plupart des applications utiliseront des **bases de donn√©es SQLite internes** pour enregistrer des informations. Lors du pentest, **examinez** les **bases de donn√©es** cr√©√©es, les noms des **tables** et des **colonnes** et toutes les **donn√©es** enregistr√©es, car vous pourriez trouver des **informations sensibles** (ce qui constituerait une vuln√©rabilit√©).\
Les bases de donn√©es doivent √™tre situ√©es dans `/data/data/nom.du.package/databases` comme `/data/data/com.mwr.example.sieve/databases`

Si la base de donn√©es enregistre des informations confidentielles et est **chiffr√©e**, mais que vous pouvez **trouver** le **mot de passe** √† l'int√©rieur de l'application, c'est toujours une **vuln√©rabilit√©**.

√ânum√©rez les tables en utilisant `.tables` et √©num√©rez les colonnes des tables en utilisant `.schema <nom_de_la_table>`

### Drozer (Exploiter les activit√©s, les fournisseurs de contenu et les services export√©s)

**Drozer** vous permet de **prendre le r√¥le d'une application Android** et d'interagir avec d'autres applications. Il peut faire **tout ce qu'une application install√©e peut faire**, comme utiliser le m√©canisme de communication inter-processus (IPC) d'Android et interagir avec le syst√®me d'exploitation sous-jacent. √Ä partir du [Guide Drozer](https://labs.mwrinfosecurity.com/assets/BlogFiles/mwri-drozer-user-guide-2015-03-23.pdf).\
Drozer est un outil utile pour **exploiter les activit√©s export√©es, les services export√©s et les fournisseurs de contenu**, comme vous le verrez dans les sections suivantes.

### Exploiter les activit√©s export√©es

[**Lisez ceci si vous voulez vous rappeler ce qu'est une activit√© Android.**](android-applications-basics.md#launcher-activity-and-other-activities)\
Rappelez-vous √©galement que le code d'une activit√© commence par la m√©thode `onCreate`.

**Contournement de l'autorisation**

Lorsqu'une activit√© est export√©e, vous pouvez invoquer son √©cran √† partir d'une application externe. Par cons√©quent, si une activit√© contenant des **informations sensibles** est **export√©e**, vous pourriez **contourner** les **m√©canismes d'authentification** pour y acc√©der.\
[**Apprenez comment exploiter les activit√©s export√©es avec Drozer.**](drozer-tutorial/#activities)

Vous pouvez √©galement d√©marrer une activit√© export√©e depuis adb :

* Le nom du package est com.example.demo
* Le nom de l'activit√© export√©e est com.example.test.MainActivity
```bash
adb shell am start -n com.example.demo/com.example.test.MainActivity
```
**REMARQUE**: MobSF d√©tectera comme malveillante l'utilisation de _**singleTask/singleInstance**_ en tant que `android:launchMode` dans une activit√©, mais en raison de [ceci](https://github.com/MobSF/Mobile-Security-Framework-MobSF/pull/750), cela semble √™tre dangereux uniquement sur les anciennes versions (versions d'API < 21).

{% hint style="info" %}
Notez qu'une contournement d'autorisation n'est pas toujours une vuln√©rabilit√©, cela d√©pend de la fa√ßon dont le contournement fonctionne et des informations expos√©es.
{% endhint %}

**Fuite d'informations sensibles**

**Les activit√©s peuvent √©galement renvoyer des r√©sultats**. Si vous parvenez √† trouver une activit√© export√©e et non prot√©g√©e appelant la m√©thode **`setResult`** et **renvoyant des informations sensibles**, il y a une fuite d'informations sensibles.

#### Tapjacking

Si le tapjacking n'est pas emp√™ch√©, vous pouvez abuser de l'activit√© export√©e pour faire en sorte que l'**utilisateur effectue des actions inattendues**. Pour plus d'informations sur [**ce qu'est le Tapjacking, suivez le lien**](./#tapjacking).

### Exploitation des fournisseurs de contenu - Acc√®s et manipulation d'informations sensibles

[**Lisez ceci si vous voulez vous rappeler ce qu'est un fournisseur de contenu.**](android-applications-basics.md#content-provider)\
Les fournisseurs de contenu sont essentiellement utilis√©s pour **partager des donn√©es**. Si une application dispose de fournisseurs de contenu disponibles, vous pourrez peut-√™tre **extraire des donn√©es sensibles** √† partir d'eux. Il est √©galement int√©ressant de tester les **injections SQL** et les **travers√©es de chemin** possibles, car elles pourraient √™tre vuln√©rables.\
[**Apprenez comment exploiter les fournisseurs de contenu avec Drozer.**](drozer-tutorial/#content-providers)

### **Exploitation des services**

[**Lisez ceci si vous voulez vous rappeler ce qu'est un service.**](android-applications-basics.md#services)\
Rappelez-vous que les actions d'un service commencent dans la m√©thode `onStartCommand`.

Un service est essentiellement quelque chose qui **peut recevoir des donn√©es**, les **traiter** et **renvoyer** (ou non) une r√©ponse. Par cons√©quent, si une application exporte certains services, vous devriez **v√©rifier** le **code** pour comprendre ce qu'il fait et le **tester** **dynamiquement** pour extraire des informations confidentielles, contourner les mesures d'authentification...\
[**Apprenez comment exploiter les services avec Drozer.**](drozer-tutorial/#services)

### **Exploitation des r√©cepteurs de diffusion**

[**Lisez ceci si vous voulez vous rappeler ce qu'est un r√©cepteur de diffusion.**](android-applications-basics.md#broadcast-receivers)\
Rappelez-vous que les actions d'un r√©cepteur de diffusion commencent dans la m√©thode `onReceive`.

Un r√©cepteur de diffusion attendra un type de message. Selon la fa√ßon dont le r√©cepteur g√®re le message, il pourrait √™tre vuln√©rable.\
[**Apprenez comment exploiter les r√©cepteurs de diffusion avec Drozer.**](./#exploiting-broadcast-receivers)

### **Exploitation des sch√©mas / liens profonds**

Vous pouvez rechercher des liens profonds manuellement, en utilisant des outils comme MobSF ou des scripts comme [celui-ci](https://github.com/ashleykinguk/FBLinkBuilder/blob/master/FBLinkBuilder.py).\
Vous pouvez **ouvrir** un **sch√©ma** d√©clar√© en utilisant **adb** ou un **navigateur**:

{% code overflow="wrap" %}
```bash
adb shell am start -a android.intent.action.VIEW -d "scheme://hostname/path?param=value" [your.package.name]
```
{% endcode %}

_Notez que vous pouvez **omettre le nom du package** et le mobile appellera automatiquement l'application qui devrait ouvrir ce lien._

{% code overflow="wrap" %}
```markup
<!-- Browser regular link -->
<a href="scheme://hostname/path?param=value">Click me</a>
<!-- fallback in your url you could try the intent url -->
<a href="intent://hostname#Intent;scheme=scheme;package=your.package.name;S.browser_fallback_url=http%3A%2F%2Fwww.example.com;end">with alternative</a>
```
{% endcode %}

**Code ex√©cut√©**

Pour trouver le **code qui sera ex√©cut√© dans l'application**, allez dans l'activit√© appel√©e par le lien profond et recherchez la fonction **`onNewIntent`**.

![](<../../.gitbook/assets/image (436) (1) (1) (1).png>)

**Informations sensibles**

Chaque fois que vous trouvez un lien profond, v√©rifiez qu'il ne re√ßoit pas de donn√©es sensibles (comme des mots de passe) via les param√®tres d'URL, car toute autre application pourrait **usurper le lien profond et voler ces donn√©es !**

**Param√®tres dans le chemin**

Vous devez √©galement v√©rifier si un lien profond utilise un param√®tre dans le chemin de l'URL, par exemple : `https://api.example.com/v1/users/{username}`, dans ce cas, vous pouvez forcer une travers√©e de chemin en acc√©dant √† quelque chose comme : `example://app/users?username=../../unwanted-endpoint%3fparam=value`.\
Notez que si vous trouvez les points d'extr√©mit√© corrects dans l'application, vous pourriez √™tre en mesure de provoquer une **redirection ouverte** (si une partie du chemin est utilis√©e comme nom de domaine), une **prise de contr√¥le de compte** (si vous pouvez modifier les d√©tails des utilisateurs sans jeton CSRF et que le point d'extr√©mit√© vuln√©rable utilise la m√©thode correcte) et toute autre vuln√©rabilit√©. Plus d'informations √† ce sujet [ici](http://dphoeniixx.com/2020/12/13-2/).

**Plus d'exemples**

Un [rapport int√©ressant de prime de bug](https://hackerone.com/reports/855618) sur les liens (_/.well-known/assetlinks.json_).

### Protection insuffisante de la couche de transport

* **Absence d'inspection de certificat :** L'application Android ne parvient pas √† v√©rifier l'identit√© du certificat qui lui est pr√©sent√©. La plupart des applications ignorent les avertissements et acceptent n'importe quel certificat auto-sign√© pr√©sent√©. Certaines applications passent plut√¥t le trafic par une connexion HTTP.
* **N√©gociation de poign√©e de main faible :** L'application et le serveur effectuent une poign√©e de main SSL/TLS, mais utilisent une suite de chiffrement non s√©curis√©e qui est vuln√©rable aux attaques de l'homme du milieu (MITM). Ainsi, tout attaquant peut facilement d√©crypter cette connexion.
* **Fuite d'informations de confidentialit√© :** La plupart du temps, il arrive que les applications effectuent une authentification via un canal s√©curis√©, mais que toutes les autres connexions se fassent via un canal non s√©curis√©. Cela n'ajoute pas de s√©curit√© √† l'application car les donn√©es sensibles restantes, telles que les cookies de session ou les donn√©es utilisateur, peuvent √™tre intercept√©es par un utilisateur malveillant.

Parmi les 3 sc√©narios pr√©sent√©s, nous allons discuter de **comment v√©rifier l'identit√© du certificat**. Les 2 autres sc√©narios d√©pendent de la **configuration TLS** du serveur et de l'envoi ou non de donn√©es non chiffr√©es par l'application. Le testeur de p√©n√©tration doit v√©rifier par lui-m√™me la configuration TLS du serveur ([ici](../../network-services-pentesting/pentesting-web/#ssl-tls-vulnerabilites)) et d√©tecter si des **informations confidentielles sont envoy√©es par un canal non chiffr√©/vuln√©rable**.\
Plus d'informations sur la d√©couverte et la correction de ce type de vuln√©rabilit√©s [**ici**](https://manifestsecurity.com/android-application-security-part-10/).

**√âpinglage SSL**

Par d√©faut, lors de l'√©tablissement d'une connexion SSL, le client (application Android) v√©rifie que le certificat du serveur a une cha√Æne de confiance v√©rifiable remontant √† un certificat de confiance (racine) et correspond au nom d'h√¥te demand√©. Cela pose un probl√®me d'**attaques de l'homme du milieu (MITM)**.\
Dans l'√©pinglage de certificat, une application Android contient elle-m√™me le certificat du serveur et ne transmet les donn√©es que si le m√™me certificat est pr√©sent√©.\
Il est recommand√© d'**appliquer l'√©pinglage SSL** pour les sites o√π des informations sensibles vont √™tre envoy√©es.

### Inspection du trafic HTTP

Tout d'abord, vous devez (devez) **installer le certificat** de l'**outil proxy** que vous allez utiliser, probablement Burp. Si vous n'installez pas le certificat CA de l'outil proxy, vous ne verrez probablement pas le trafic chiffr√© dans le proxy.\
**Veuillez,** [**lire ce guide pour apprendre comment installer un certificat CA personnalis√©**](android-burp-suite-settings.md)**.**

Pour les applications ciblant **API Level 24+**, il ne suffit pas d'installer le certificat CA de Burp sur l'appareil. Pour contourner cette nouvelle protection, vous devez modifier le fichier de configuration de la s√©curit√© r√©seau. Ainsi, vous pouvez modifier ce fichier pour autoriser votre certificat CA ou vous pouvez [**lire cette page pour un tutoriel sur la fa√ßon de forcer l'application √† accepter √† nouveau tous les certificats install√©s sur l'appareil**](make-apk-accept-ca-certificate.md).

**√âpinglage SSL**

Nous avons d√©j√† discut√© de ce qu'est l'√©pinglage SSL juste 2 paragraphes plus haut. Lorsqu'il est impl√©ment√© dans une application, vous devrez le contourner pour inspecter le trafic HTTPS ou vous ne le verrez pas.\
Voici quelques options que j'ai utilis√©es pour contourner cette protection :

* Modifier automatiquement l'**apk** pour contourner l'√©pinglage SSL avec [**apk-mitm**](https://github.com/shroudedcode/apk-mitm). Le meilleur avantage de cette option est que vous n'avez pas besoin de root pour contourner l'√©pinglage SSL, mais vous devrez supprimer l'application et r√©installer la nouvelle, et cela ne fonctionnera pas toujours.
* Vous pouvez utiliser **Frida** (discut√© ci-dessous) pour contourner cette protection. Voici un guide pour utiliser Burp+Frida+Genymotion : [https://spenkk.github.io/bugbounty/Configuring-Frida-with-Burp-and-GenyMotion-to-bypass-SSL-Pinning/](https://spenkk.github.io/bugbounty/Configuring-Frida-with-Burp-and-GenyMotion-to-bypass-SSL-Pinning/)
* Vous pouvez √©galement essayer de contourner automatiquement l'√©pinglage SSL en utilisant [**objection**](frida-tutorial/objection-tutorial.md)** :** `objection --gadget com.package.app explore --startup-command "android sslpinning disable"`
* Vous pouvez √©galement essayer de contourner automatiquement l'√©pinglage SSL en utilisant l'analyse dynamique de **MobSF** (expliqu√©e ci-dessous)
* Si vous pensez toujours qu'il y a du trafic que vous ne capturez pas, vous pouvez essayer de **rediriger le trafic vers Burp en utilisant iptables**. Lisez ce blog : [https://infosecwriteups.com/bypass-ssl-pinning-with-ip-forwarding-iptables-568171b52b62](https://infosecwriteups.com/bypass-ssl-pinning-with-ip-forwarding-iptables-568171b52b62)

**Vuln√©rabilit√©s Web courantes**

Notez qu'√† cette √©tape, vous devez rechercher des vuln√©rabilit√©s Web courantes. Beaucoup d'informations sur les vuln√©rabilit√©s Web peuvent √™tre trouv√©es dans ce livre, donc je ne vais pas les mentionner ici.

### Frida

Outil d'instrumentation dynamique pour les d√©veloppeurs, les reverse-engineers et les chercheurs en s√©curit√©. En savoir plus sur [www.frida.re](https://www.frida.re).\
**C'est incroyable, vous pouvez acc√©der √† une application en cours d'ex√©cution et accrocher des m√©thodes en temps r√©el pour changer le comportement, changer les valeurs, extraire des valeurs, ex√©cuter un code diff√©rent...**\
**Si vous voulez tester les applications Android, vous devez savoir comment utiliser Frida.**

**Apprenez √† utiliser Frida :** [**Tutoriel Frida**](frida-tutorial/)\
**Quelques "GUI" pour les actions avec Frida :** [**https://github.com/m0bilesecurity/RMS-Runtime-Mobile-Security**](https://github.com/m0bilesecurity/RMS-Runtime-Mobile-Security)\
**Quelques autres abstractions bas√©es sur Frida :** [**https://github.com/sensepost/objection**](https://github.com/sensepost/objection) **,** [**https://github.com/dpnishant/appmon**](https://github.com/dpnishant/appmon)\
**Vous pouvez trouver quelques scripts Frida impressionnants ici :** [**https://codeshare.frida.re/**](https://codeshare.frida.re)
### **Dump de m√©moire - Fridump**

V√©rifiez si l'application stocke des informations sensibles dans la m√©moire qu'elle ne devrait pas stocker, comme des mots de passe ou des mn√©moniques.

En utilisant [**Fridump3**](https://github.com/rootbsd/fridump3), vous pouvez effectuer un dump de la m√©moire de l'application avec :
```bash
# With PID
python3 fridump3.py -u <PID>

# With name
frida-ps -Uai
python3 fridump3.py -u "<Name>"
```
Cela va vider la m√©moire dans le dossier ./dump, et l√† vous pouvez utiliser grep avec quelque chose comme :

{% code overflow="wrap" %}
```bash
strings * | grep -E "^[a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+$"
```
{% endcode %}

### **Donn√©es sensibles dans le Keystore**

Dans Android, le Keystore est le meilleur endroit pour stocker des donn√©es sensibles, cependant, avec suffisamment de privil√®ges, il est toujours **possible d'y acc√©der**. Comme les applications ont tendance √† stocker ici des **donn√©es sensibles en texte clair**, les tests de p√©n√©tration doivent v√©rifier cela car un utilisateur root ou une personne ayant un acc√®s physique √† l'appareil pourrait voler ces donn√©es.

M√™me si une application stocke des donn√©es dans le keystore, les donn√©es doivent √™tre chiffr√©es.

Pour acc√©der aux donn√©es √† l'int√©rieur du keystore, vous pouvez utiliser ce script Frida : [https://github.com/WithSecureLabs/android-keystore-audit/blob/master/frida-scripts/tracer-cipher.js](https://github.com/WithSecureLabs/android-keystore-audit/blob/master/frida-scripts/tracer-cipher.js)
```bash
frida -U -f com.example.app -l frida-scripts/tracer-cipher.js
```
### **Analyseur d'application Android**

Cet outil peut vous aider √† g√©rer diff√©rents outils lors de l'analyse dynamique : [https://github.com/NotSoSecure/android\_application\_analyzer](https://github.com/NotSoSecure/android\_application\_analyzer)

### Injection d'intention

Cette vuln√©rabilit√© ressemble √† **Open Redirect dans la s√©curit√© web**. √âtant donn√© que la classe `Intent` est `Parcelable`, **les objets appartenant √† cette classe** peuvent √™tre **transmis** en tant que **donn√©es suppl√©mentaires** dans un autre objet `Intent`.\
De nombreux d√©veloppeurs utilisent cette **fonctionnalit√©** et cr√©ent des **composants proxy** (activit√©s, r√©cepteurs de diffusion et services) qui **prennent une intention int√©gr√©e et la transmettent √† des m√©thodes dangereuses** telles que `startActivity(...)`, `sendBroadcast(...)`, etc.\
C'est dangereux car **un attaquant peut forcer l'application √† lancer un composant non export√© qui ne peut pas √™tre lanc√© directement depuis une autre application**, ou √† accorder √† l'attaquant l'acc√®s √† ses fournisseurs de contenu. **`WebView`** change parfois √©galement une **URL d'une cha√Æne en un objet `Intent`**, en utilisant la m√©thode `Intent.parseUri(...)`, et la transmet √† `startActivity(...)`.

### Injections c√¥t√© client Android et autres

Vous connaissez probablement ce type de vuln√©rabilit√©s sur le Web. Vous devez √™tre particuli√®rement prudent avec ces vuln√©rabilit√©s dans une application Android :

* **Injection SQL :** Lorsque vous travaillez avec des requ√™tes dynamiques ou des fournisseurs de contenu, assurez-vous d'utiliser des requ√™tes param√©tr√©es.
* **Injection JavaScript (XSS) :** V√©rifiez que la prise en charge de JavaScript et des plugins est d√©sactiv√©e pour tous les WebViews (d√©sactiv√©e par d√©faut). [Plus d'informations ici](webview-attacks.md#javascript-enabled).
* **Inclusion de fichiers locaux :** V√©rifiez que l'acc√®s au syst√®me de fichiers est d√©sactiv√© pour tous les WebViews (activ√© par d√©faut) `(webview.getSettings().setAllowFileAccess(false);)`. [Plus d'informations ici](webview-attacks.md#javascript-enabled).
* **Cookies persistants** : Dans plusieurs cas, lorsque l'application Android termine la session, le cookie n'est pas r√©voqu√© ou il peut m√™me √™tre enregistr√© sur le disque.
* [**Drapeau de s√©curit√©** dans les cookies](../../pentesting-web/hacking-with-cookies/#cookies-flags)

***

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

**HackenProof est la plateforme des primes pour les bugs de cryptographie.**

**Obtenez une r√©compense sans d√©lai**\
Les primes HackenProof sont lanc√©es uniquement lorsque les clients d√©posent le budget de r√©compense. Vous recevrez la r√©compense apr√®s la v√©rification du bug.

**Acqu√©rez de l'exp√©rience en pentesting web3**\
Les protocoles blockchain et les contrats intelligents sont le nouvel Internet ! Ma√Ætrisez la s√©curit√© web3 √† ses d√©buts.

**Devenez une l√©gende du hacking web3**\
Gagnez des points de r√©putation avec chaque bug v√©rifi√© et conqu√©rez le sommet du classement hebdomadaire.

[**Inscrivez-vous sur HackenProof**](https://hackenproof.com/register) et commencez √† gagner gr√¢ce √† vos hacks !

{% embed url="https://hackenproof.com/register" %}

## Analyse automatique

### [MobSF](https://github.com/MobSF/Mobile-Security-Framework-MobSF)

**Analyse statique**

![](<../../.gitbook/assets/image (61).png>)

**√âvaluation des vuln√©rabilit√©s de l'application** √† l'aide d'une interface web conviviale. Vous pouvez √©galement effectuer une analyse dynamique (mais vous devez pr√©parer l'environnement).
```bash
docker pull opensecurity/mobile-security-framework-mobsf
docker run -it -p 8000:8000 opensecurity/mobile-security-framework-mobsf:latest
```
Notez que MobSF peut analyser les applications **Android** (apk), **IOS** (ipa) et **Windows** (apx) (_les applications Windows doivent √™tre analys√©es √† partir d'un MobSF install√© sur un h√¥te Windows_).\
De plus, si vous cr√©ez un fichier **ZIP** avec le code source d'une application **Android** ou **IOS** (allez dans le dossier racine de l'application, s√©lectionnez tout et cr√©ez un fichier ZIP), il pourra √©galement l'analyser.

MobSF vous permet √©galement de **comparer/diff√©rer** les analyses et d'int√©grer **VirusTotal** (vous devrez d√©finir votre cl√© API dans _MobSF/settings.py_ et l'activer : `VT_ENABLED = TRUE` `VT_API_KEY = <Votre cl√© API>` `VT_UPLOAD = TRUE`). Vous pouvez √©galement d√©finir `VT_UPLOAD` sur `False`, alors le **hash** sera **t√©l√©charg√©** au lieu du fichier.

### Analyse dynamique assist√©e avec MobSF

MobSF peut √©galement √™tre tr√®s utile pour l'**analyse dynamique** sur Android, mais dans ce cas, vous devrez installer MobSF et **genymotion** sur votre h√¥te (une machine virtuelle ou Docker ne fonctionnera pas). _Remarque : Vous devez **d'abord d√©marrer une machine virtuelle dans genymotion** et **ensuite MobSF**._\
L'analyseur dynamique de MobSF peut :

* **Extraire les donn√©es de l'application** (URL, journaux, presse-papiers, captures d'√©cran r√©alis√©es par vous, captures d'√©cran r√©alis√©es par "**Exported Activity Tester**", e-mails, bases de donn√©es SQLite, fichiers XML et autres fichiers cr√©√©s). Tout cela est fait automatiquement, sauf pour les captures d'√©cran, vous devez appuyer lorsque vous souhaitez une capture d'√©cran ou vous devez appuyer sur "**Exported Activity Tester**" pour obtenir des captures d'√©cran de toutes les activit√©s export√©es.
* Capturer le **trafic HTTPS**
* Utiliser **Frida** pour obtenir des **informations en temps r√©el**

√Ä partir des versions d'Android sup√©rieures √† 5, il d√©marrera automatiquement Frida et d√©finira les param√®tres **proxy** globaux pour capturer le trafic. Il ne capturera le trafic que de l'application test√©e.

**Frida**

Par d√©faut, il utilisera √©galement certains scripts Frida pour **contourner la v√©rification de l'authenticit√© SSL**, la **d√©tection de root** et la **d√©tection de d√©bogueur**, ainsi que pour **surveiller les API int√©ressantes**.\
MobSF peut √©galement **appeler des activit√©s export√©es**, capturer des **captures d'√©cran** et les **enregistrer** pour le rapport.

Pour **d√©marrer** les tests dynamiques, appuyez sur le bouton vert : "**Start Instrumentation**". Appuyez sur "**Frida Live Logs**" pour voir les journaux g√©n√©r√©s par les scripts Frida et sur "**Live API Monitor**" pour voir toutes les invocations des m√©thodes accroch√©es, les arguments pass√©s et les valeurs retourn√©es (cela appara√Ætra apr√®s avoir appuy√© sur "Start Instrumentation").\
MobSF vous permet √©galement de charger vos propres **scripts Frida** (pour envoyer les r√©sultats de vos scripts Frida √† MobSF, utilisez la fonction `send()`). Il dispose √©galement de **plusieurs scripts pr√©-√©crits** que vous pouvez charger (vous pouvez en ajouter d'autres dans `MobSF/DynamicAnalyzer/tools/frida_scripts/others/`), il vous suffit de les **s√©lectionner**, d'appuyer sur "**Load**" et d'appuyer sur "**Start Instrumentation**" (vous pourrez voir les journaux de ces scripts dans "**Frida Live Logs**").

![](<../../.gitbook/assets/image (215).png>)

De plus, vous disposez de certaines fonctionnalit√©s auxiliaires de Frida :

* **√ânum√©rer les classes charg√©es** : cela affichera toutes les classes charg√©es
* **Capturer les cha√Ænes de caract√®res** : cela affichera toutes les cha√Ænes de caract√®res captur√©es lors de l'utilisation de l'application (tr√®s bruyant)
* **Capturer les comparaisons de cha√Ænes de caract√®res** : cela pourrait √™tre tr√®s utile. Cela affichera les 2 cha√Ænes de caract√®res compar√©es et si le r√©sultat √©tait vrai ou faux.
* **√ânum√©rer les m√©thodes de classe** : indiquez le nom de la classe (comme "java.io.File") et cela affichera toutes les m√©thodes de la classe.
* **Rechercher un mod√®le de classe** : recherche de classes par motif
* **Tracer les m√©thodes de classe** : **tracer** une **classe enti√®re** (voir les entr√©es et sorties de toutes les m√©thodes de la classe). N'oubliez pas que par d√©faut, MobSF trace plusieurs m√©thodes int√©ressantes de l'API Android.

Une fois que vous avez s√©lectionn√© le module auxiliaire que vous souhaitez utiliser, vous devez appuyer sur "**Start Intrumentation**" et vous verrez toutes les sorties dans "**Frida Live Logs**".

**Shell**

Mobsf vous propose √©galement une interface de commande avec quelques commandes **adb**, des commandes **MobSF** et des commandes **shell** courantes en bas de la page d'analyse dynamique. Quelques commandes int√©ressantes :
```bash
help
shell ls
activities
exported_activities
services
receivers
```
**Outils HTTP**

Lorsque le trafic http est captur√©, vous pouvez voir une vue peu attrayante du trafic captur√© sur le bouton "**HTTP(S) Traffic**" en bas ou une vue plus agr√©able sur le bouton vert "**Start HTTPTools**". √Ä partir de la deuxi√®me option, vous pouvez **envoyer** les **requ√™tes captur√©es** vers des **proxies** tels que Burp ou Owasp ZAP.\
Pour ce faire, _allumez Burp -->_ _d√©sactivez Intercept --> dans MobSB HTTPTools, s√©lectionnez la requ√™te_ --> appuyez sur "**Send to Fuzzer**" --> _s√©lectionnez l'adresse du proxy_ ([http://127.0.0.1:8080\\](http://127.0.0.1:8080)).

Une fois que vous avez termin√© l'analyse dynamique avec MobSF, vous pouvez appuyer sur "**Start Web API Fuzzer**" pour **fuzzer les requ√™tes http** et rechercher des vuln√©rabilit√©s.

{% hint style="info" %}
Apr√®s avoir effectu√© une analyse dynamique avec MobSF, les param√®tres du proxy peuvent √™tre mal configur√©s et vous ne pourrez pas les corriger depuis l'interface graphique. Vous pouvez corriger les param√®tres du proxy en effectuant les √©tapes suivantes :
```
adb shell settings put global http_proxy :0
```
{% endhint %}

### Analyse dynamique assist√©e avec Inspeckage

Vous pouvez obtenir l'outil depuis [**Inspeckage**](https://github.com/ac-pm/Inspeckage).\
Cet outil utilise des **Hooks** pour vous informer de **ce qui se passe dans l'application** pendant que vous effectuez une **analyse dynamique**.

{% content-ref url="inspeckage-tutorial.md" %}
[inspeckage-tutorial.md](inspeckage-tutorial.md)
{% endcontent-ref %}

### [Yaazhini](https://www.vegabird.com/yaazhini/)

C'est un **excellent outil pour effectuer une analyse statique avec une interface graphique**

![](<../../.gitbook/assets/image (527).png>)

### [Qark](https://github.com/linkedin/qark)

Cet outil est con√ßu pour rechercher plusieurs **vuln√©rabilit√©s li√©es √† la s√©curit√© des applications Android**, que ce soit dans le **code source** ou dans les **APK empaquet√©s**. L'outil est √©galement **capable de cr√©er un APK d√©ployable "Proof-of-Concept"** et des **commandes ADB** pour exploiter certaines des vuln√©rabilit√©s trouv√©es (activit√©s expos√©es, intents, tapjacking...). Comme avec Drozer, il n'est pas n√©cessaire de rooter l'appareil de test.
```bash
pip3 install --user qark  # --user is only needed if not using a virtualenv
qark --apk path/to/my.apk
qark --java path/to/parent/java/folder
qark --java path/to/specific/java/file.java
```
### [**ReverseAPK**](https://github.com/1N3/ReverseAPK.git)

* Affiche tous les fichiers extraits pour une r√©f√©rence facile
* D√©compile automatiquement les fichiers APK au format Java et Smali
* Analyse AndroidManifest.xml pour les vuln√©rabilit√©s et comportements courants
* Analyse statique du code source pour les vuln√©rabilit√©s et comportements courants
* Informations sur l'appareil
* Intents
* Ex√©cution de commandes
* R√©f√©rences SQLite
* R√©f√©rences de journalisation
* Fournisseurs de contenu
* R√©cepteurs de diffusion
* R√©f√©rences de service
* R√©f√©rences de fichiers
* R√©f√©rences de cryptographie
* Secrets cod√©s en dur
* URL
* Connexions r√©seau
* R√©f√©rences SSL
* R√©f√©rences WebView
```
reverse-apk relative/path/to/APP.apk
```
### [SUPER Android Analyzer](https://github.com/SUPERAndroidAnalyzer/super)

SUPER est une application en ligne de commande qui peut √™tre utilis√©e sous Windows, MacOS X et Linux pour analyser les fichiers _.apk_ √† la recherche de vuln√©rabilit√©s. Elle le fait en d√©compressant les APK et en appliquant une s√©rie de r√®gles pour d√©tecter ces vuln√©rabilit√©s.

Toutes les r√®gles sont regroup√©es dans un fichier `rules.json`, et chaque entreprise ou testeur peut cr√©er ses propres r√®gles pour analyser ce dont il a besoin.

T√©l√©chargez les derniers binaires depuis la [page de t√©l√©chargement](https://superanalyzer.rocks/download.html)
```
super-analyzer {apk_file}
```
### [StaCoAn](https://github.com/vincentcox/StaCoAn)

![](<../../.gitbook/assets/image (62).png>)

StaCoAn est un outil **multiplateforme** qui aide les d√©veloppeurs, les chasseurs de primes et les hackers √©thiques √† effectuer une [analyse statique du code](https://en.wikipedia.org/wiki/Static\_program\_analysis) sur les applications mobiles\*.

Le concept est que vous faites glisser et d√©posez votre fichier d'application mobile (un fichier .apk ou .ipa) sur l'application StaCoAn et elle g√©n√©rera un rapport visuel et portable pour vous. Vous pouvez ajuster les param√®tres et les listes de mots pour obtenir une exp√©rience personnalis√©e.

T√©l√©chargez la [derni√®re version](https://github.com/vincentcox/StaCoAn/releases) :
```
./stacoan
```
### [AndroBugs](https://github.com/AndroBugs/AndroBugs\_Framework)

AndroBugs Framework est un syst√®me d'analyse de vuln√©rabilit√©s Android qui aide les d√©veloppeurs ou les hackers √† trouver des vuln√©rabilit√©s de s√©curit√© potentielles dans les applications Android.\
[Versions Windows](https://github.com/AndroBugs/AndroBugs\_Framework/releases)
```
python androbugs.py -f [APK file]
androbugs.exe -f [APK file]
```
### [Androwarn](https://github.com/maaaaz/androwarn)

**Androwarn** est un outil dont le principal objectif est de d√©tecter et avertir l'utilisateur des comportements potentiellement malveillants d√©velopp√©s par une application Android.

La d√©tection est effectu√©e par l'analyse statique du bytecode Dalvik de l'application, repr√©sent√© sous forme de **Smali**, avec la biblioth√®que [`androguard`](https://github.com/androguard/androguard).

Cet outil recherche les comportements courants des applications "mauvaises" tels que : l'exfiltration des identifiants de t√©l√©phonie, l'interception des flux audio/vid√©o, la modification des donn√©es PIM, l'ex√©cution de code arbitraire...
```
python androwarn.py -i my_application_to_be_analyzed.apk -r html -v 3
```
### [Cadre MARA](https://github.com/xtiankisutsa/MARA_Framework)

![](<../../.gitbook/assets/image (81).png>)

**MARA** est un **C**adre d'**A**nalyse et de **R**√©-ing√©nierie d'**A**pplications **M**obiles. C'est un outil qui regroupe des outils couramment utilis√©s pour la r√©-ing√©nierie et l'analyse d'applications mobiles, afin d'aider √† tester les applications mobiles contre les menaces de s√©curit√© mobiles OWASP. Son objectif est de rendre cette t√¢che plus facile et plus conviviale pour les d√©veloppeurs d'applications mobiles et les professionnels de la s√©curit√©.

Il est capable de :

* Extraire du code Java et Smali √† l'aide de diff√©rents outils
* Analyser les APK √† l'aide de : [smalisca](https://github.com/dorneanu/smalisca), [ClassyShark](https://github.com/google/android-classyshark), [androbugs](https://github.com/AndroBugs/AndroBugs_Framework), [androwarn](https://github.com/maaaaz/androwarn), [APKiD](https://github.com/rednaga/APKiD)
* Extraire des informations priv√©es de l'APK √† l'aide d'expressions r√©guli√®res.
* Analyser le Manifeste.
* Analyser les domaines trouv√©s √† l'aide de : [pyssltest](https://github.com/moheshmohan/pyssltest), [testssl](https://github.com/drwetter/testssl.sh) et [whatweb](https://github.com/urbanadventurer/WhatWeb)
* D√©obfusquer l'APK via [apk-deguard.com](http://www.apk-deguard.com)

### Koodous

Utile pour d√©tecter les logiciels malveillants : [https://koodous.com/](https://koodous.com)

## Obfuscation/D√©obfuscation du code

Notez que selon le service et la configuration que vous utilisez pour obfusquer le code. Les secrets peuvent √™tre obfusqu√©s ou non.

### [ProGuard](https://en.wikipedia.org/wiki/ProGuard\_\(software\))

**ProGuard** est un outil en ligne de commande open source qui r√©duit la taille, optimise et obfusque le code Java. Il est capable d'optimiser le bytecode ainsi que de d√©tecter et supprimer les instructions inutilis√©es. ProGuard est un logiciel gratuit distribu√© sous la licence publique g√©n√©rale GNU, version 2.

ProGuard est distribu√© dans le cadre du kit de d√©veloppement Android et s'ex√©cute lors de la construction de l'application en mode de publication.

√Ä partir de : [https://en.wikipedia.org/wiki/ProGuard\_(software)](https://en.wikipedia.org/wiki/ProGuard\_\(software\))

### [DexGuard](https://www.guardsquare.com/dexguard)

Trouvez un guide √©tape par √©tape pour d√©obfusquer l'APK sur [https://blog.lexfo.fr/dexguard.html](https://blog.lexfo.fr/dexguard.html)

(Dans ce guide) La derni√®re fois que nous avons v√©rifi√©, le mode de fonctionnement de Dexguard √©tait :

* charger une ressource en tant que InputStream ;
* alimenter le r√©sultat √† une classe h√©ritant de FilterInputStream pour le d√©crypter ;
* effectuer une obfuscation inutile pour perdre quelques minutes de temps d'un r√©verseur ;
* alimenter le r√©sultat d√©crypt√© √† un ZipInputStream pour obtenir un fichier DEX ;
* enfin, charger le DEX r√©sultant en tant que ressource en utilisant la m√©thode `loadDex`.

### [DeGuard](http://apk-deguard.com)

**DeGuard inverse le processus d'obfuscation effectu√© par les outils d'obfuscation Android. Cela permet de r√©aliser de nombreuses analyses de s√©curit√©, notamment l'inspection du code et la pr√©diction des biblioth√®ques.**

Vous pouvez t√©l√©charger un APK obfusqu√© sur leur plateforme.

### [Simplify](https://github.com/CalebFenton/simplify)

C'est un **d√©obfuscateur g√©n√©rique pour Android**. Simplify **ex√©cute virtuellement une application** pour comprendre son comportement, puis **essaie d'optimiser le code** pour qu'il se comporte de mani√®re identique mais soit plus facile √† comprendre pour un humain. Chaque type d'optimisation est simple et g√©n√©rique, il n'importe donc pas quel type sp√©cifique d'obfuscation est utilis√©.

### [APKiD](https://github.com/rednaga/APKiD)

APKiD vous donne des informations sur **comment un APK a √©t√© cr√©√©**. Il identifie de nombreux **compilateurs**, **packers**, **obfuscateurs** et autres choses √©tranges. C'est [_PEiD_](https://www.aldeid.com/wiki/PEiD) pour Android.

### Manuel

[Lisez ce tutoriel pour apprendre quelques astuces sur **comment inverser une obfuscation personnalis√©e**](manual-deobfuscation.md)

## Laboratoires

### [Androl4b](https://github.com/sh4hin/Androl4b)

AndroL4b est une machine virtuelle de s√©curit√© Android bas√©e sur Ubuntu-Mate qui comprend une collection des derniers frameworks, tutoriels et laboratoires de diff√©rents experts en s√©curit√© et chercheurs pour la r√©-ing√©nierie et l'analyse de logiciels malveillants.

### OWASP

{% embed url="https://github.com/OWASP/owasp-mstg%0Ahttps://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06g-testing-network-communication" %}

### D√©p√¥ts Git

[https://github.com/riddhi-shree/nullCommunity/tree/master/Android](https://github.com/riddhi-shree/nullCommunity/tree/master/Android)\
[https://www.youtube.com/watch?v=PMKnPaGWxtg\&feature=youtu.be\&ab\_channel=B3nacSec](https://www.youtube.com/watch?v=PMKnPaGWxtg\&feature=youtu.be\&ab\_channel=B3nacSec)

## R√©f√©rences

Pour plus d'informations, visitez :

* [https://appsecwiki.com/#/](https://appsecwiki.com/#/) C'est une excellente liste de ressources
* [https://maddiestone.github.io/AndroidAppRE/](https://maddiestone.github.io/AndroidAppRE/) Cours rapide sur Android
* [https://manifestsecurity.com/android-application-security/](https://manifestsecurity.com/android-application-security/)
* [https://github.com/Ralireza/Android-Security-Teryaagh](https://github.com/Ralireza/Android-Security-Teryaagh)

## √Ä tester

* [https://www.vegabird.com/yaazhini/](https://www.vegabird.com/yaazhini/)
* [https://github.com/abhi-r3v0/Adhrit](https://github.com/abhi-r3v0/Adhrit)

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

**HackenProof est la plateforme des primes de bugs cryptographiques.**

**Obtenez une r√©compense sans d√©lai**\
Les primes HackenProof sont lanc√©es uniquement lorsque leurs clients d√©posent le budget de r√©compense. Vous recevrez la r√©compense apr√®s la v√©rification du bogue.

**Acqu√©rez de l'exp√©rience en pentest web3**\
Les protocoles blockchain et les contrats intelligents sont le nouvel Internet ! Ma√Ætrisez la s√©curit√© web3 d√®s ses d√©buts.

**Devenez la l√©gende du pirate web3**\
Gagnez des points de r√©putation avec chaque bogue v√©rifi√© et conqu√©rez le sommet du classement hebdomadaire.

[**Inscrivez-vous sur HackenProof**](https://hackenproof.com/register) et commencez √† gagner gr√¢ce √† vos piratages !

{% embed url="https://hackenproof.com/register" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Vous travaillez dans une **entreprise de cybers√©curit√©** ? Vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ? ou souhaitez-vous avoir acc√®s √† la **derni√®re version du PEASS ou t√©l√©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez** le [**üí¨**](https://emojipedia.org/speech-balloon/) **groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PRs au** [**repo hacktricks**](https://github.com/carlospolop/hacktricks) **et au** [**repo hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
