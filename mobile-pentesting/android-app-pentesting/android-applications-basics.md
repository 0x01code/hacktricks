# Msingi wa Maombi ya Android

<details>

<summary><strong>Jifunze kuhusu kudukua AWS kutoka sifuri hadi shujaa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Mtaalam wa Timu Nyekundu ya AWS ya HackTricks)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako inatangazwa kwenye HackTricks** au **kupakua HackTricks kwa muundo wa PDF** Angalia [**MPANGO WA KUJIUNGA**](https://github.com/sponsors/carlospolop)!
* Pata [**swag rasmi ya PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**Familia ya PEASS**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa kipekee wa [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au [**kikundi cha telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Shiriki mbinu zako za kudukua kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

<figure><img src="/.gitbook/assets/image (675).png" alt=""><figcaption></figcaption></figure>

Pata udhaifu unaofaa zaidi ili uweze kuzirekebisha haraka. Intruder inafuatilia eneo lako la shambulio, inafanya uchunguzi wa vitisho wa kujitokeza, inapata masuala katika mfumo wako mzima wa teknolojia, kutoka kwa APIs hadi programu za wavuti na mifumo ya wingu. [**Jaribu bure**](https://www.intruder.io/?utm\_source=referral\&utm\_campaign=hacktricks) leo.

{% embed url="https://www.intruder.io/?utm_campaign=hacktricks&utm_source=referral" %}

***

## Mfano wa Usalama wa Android

**Kuna safu mbili:**

* **OS**, ambayo inaweka maombi yaliyosanikishwa kwa kujitenga.
* **Maombi yenyewe**, ambayo inaruhusu watengenezaji kuonyesha utendaji fulani na kusanidi uwezo wa maombi.

### Uteuzi wa UID

**Kila maombi hupewa Kitambulisho cha Mtumiaji maalum**. Hii hufanywa wakati wa usakinishaji wa programu ili **programu iweze kuingiliana tu na faili zilizomilikiwa na Kitambulisho chake cha Mtumiaji au faili zilizoshirikiwa**. Kwa hivyo, ni programu yenyewe, sehemu fulani za OS, na mtumiaji wa mizizi tu ndio wanaweza kupata data ya programu.

### Ushirikiano wa UID

**Maombi mawili yanaweza kusanidiwa kutumia UID sawa**. Hii inaweza kuwa na manufaa kwa kushiriki habari, lakini ikiwa moja wapo imeathiriwa, data ya maombi yote mawili itakuwa imeathiriwa. Ndio maana tabia hii inapendekezwa **isitumiwe**.\
**Ili kushiriki UID sawa, maombi lazima yatamke thamani sawa ya `android:sharedUserId` katika hati zao za maandishi.**

### Sanduku la Mchanga

**Sanduku la Mchanga la Maombi ya Android** inaruhusu kuendesha **kila maombi** kama **mchakato tofauti chini ya Kitambulisho cha Mtumiaji tofauti**. Kila mchakato una mashine yake ya kawaida, kwa hivyo nambari ya programu inaendesha kwa kujitenga na programu zingine.\
Kuanzia Android 5.0(L), **SELinux** inatekelezwa. Kimsingi, SELinux inazuia mwingiliano wa michakato yote na kisha hujenga sera za **kuruhusu tu mwingiliano unaotarajiwa kati yao**.

### Ruhusa

Unapoweka **programu na inauliza ruhusa**, programu inaomba ruhusa zilizosanidiwa katika vipengele vya **`uses-permission`** katika faili ya **AndroidManifest.xml**. Kipengele cha **uses-permission** kinabainisha jina la ruhusa inayohitajika ndani ya **sifa ya jina**. Pia ina sifa ya **maxSdkVersion** ambayo inazuia kuomba ruhusa kwenye toleo kubwa kuliko lile lililoelezwa.\
Kumbuka kuwa programu za Android hazihitaji kuomba ruhusa zote mwanzoni, pia zinaweza **kuomba ruhusa kwa njia ya kudumu** lakini ruhusa zote lazima **zitangazwe** katika **hati ya maandishi**.

Wakati programu inaonyesha utendaji, inaweza kuzuia **upatikanaji kwa programu tu ambazo zina ruhusa iliyotajwa**.\
Kipengele cha ruhusa kina sifa tatu:

* **Jina** la ruhusa
* Sifa ya **kikundi cha ruhusa**, ambayo inaruhusu kikundi cha ruhusa kinachohusiana.
* **Kiwango cha ulinzi** ambacho kinaonyesha jinsi ruhusa zinavyotolewa. Kuna aina nne:
* **Kawaida**: Inatumika wakati hakuna **tishio lililofahamika** kwa programu. Mtumiaji **hahitajiki kuidhinisha**.
* **Hatari**: Inaonyesha ruhusa inatoa programu inayoomba **upatikanaji ulioboreshwa**. **Watumiaji wanatakiwa kuidhinisha**.
* **Sahihi**: Ni **programu zilizosainiwa na cheti kama ile** inayotuma sehemu inayopewa ruhusa. Hii ni aina yenye nguvu zaidi ya ulinzi.
* **SahihiAuMfumo**: Ni **programu zilizosainiwa na cheti kama ile** inayotuma sehemu inayopewa ruhusa au **programu zinazoendesha na ufikiaji wa kiwango cha mfumo** zinaweza kupewa ruhusa.

## Maombi Yaliyosanikishwa Kabla

Maombi haya kwa ujumla hupatikana katika saraka za **`/system/app`** au **`/system/priv-app`** na baadhi yao ni **yaliyoboreshwa** (huenda hata usipate faili ya `classes.dex`). Maombi haya ni muhimu kuchunguza kwa sababu mara nyingi yanafanya kazi na **ruhusa nyingi sana** (kama mtumiaji wa mizizi).

* Yaliyotumwa na **AOSP** (Mradi wa Chanzo Wazi wa Android) **ROM**
* Yaliyotolewa na **mtengenezaji** wa kifaa
* Yaliyotolewa na **mtoa huduma wa simu** (ikiwa imeununua kutoka kwao)

## Kudukua

Ili kupata ufikiaji wa mizizi kwenye kifaa cha Android halisi, kwa ujumla unahitaji **kudukua** 1 au 2 **udhaifu** ambao kwa kawaida ni **maalum** kwa **kifaa** na **toleo**.\
Baada ya kudukua kufanikiwa, kawaida faili ya Linux `su` inakopiwaa kwenye eneo lililoelezwa katika mazingira ya PATH ya mtumiaji kama vile `/system/xbin`.

Baada ya faili ya su kuwekwa, programu nyingine ya Android hutumiwa kuwasiliana na faili ya `su` na **kutimiza maombi ya ufikiaji wa mizizi** kama vile **Superuser** na **SuperSU** (inapatikana kwenye duka la Google Play).

{% hint style="danger" %}
T
### **Dalvik & Smali**

Katika maendeleo ya Android, **Java au Kotlin** hutumiwa kuunda programu. Badala ya kutumia JVM kama katika programu za desktop, Android inakusanya nambari hii kuwa **Dalvik Executable (DEX) bytecode**. Awali, mashine ya kawaida ya Dalvik ilishughulikia bytecode hii, lakini sasa, Android Runtime (ART) inachukua nafasi yake katika toleo jipya la Android.

Kwa ajili ya uhandisi wa nyuma, **Smali** inakuwa muhimu. Ni toleo linaloweza kusomwa na binadamu la bytecode ya DEX, likifanya kazi kama lugha ya mkutano kwa kutafsiri nambari ya chanzo kuwa maagizo ya bytecode. Smali na baksmali hurejelea zana za mkutano na kuvunja mkutano katika muktadha huu.


***

<figure><img src="/.gitbook/assets/image (675).png" alt=""><figcaption></figcaption></figure>

Tafuta udhaifu unaofaa zaidi ili uweze kuyatatua haraka. Intruder inafuatilia eneo lako la shambulio, inafanya uchunguzi wa vitisho wa kujitokeza, inapata matatizo katika mfumo wako wa teknolojia mzima, kutoka kwa API hadi programu za wavuti na mifumo ya wingu. [**Jaribu bure**](https://www.intruder.io/?utm\_source=referral\&utm\_campaign=hacktricks) leo.

***

## Intents

Intents ni njia kuu ambayo programu za Android hutumia kuwasiliana kati ya sehemu zao au na programu nyingine. Vitu hivi vya ujumbe pia vinaweza kubeba data kati ya programu au sehemu, kama jinsi maombi ya GET/POST yanavyotumiwa katika mawasiliano ya HTTP.

Kwa hivyo, Intent ni **ujumbe unaopitishwa kati ya sehemu**. Intents **zinaweza kuwa zimeelekezwa** kwa sehemu au programu maalum, **au zinaweza kutumwa bila mpokeaji maalum**.\
Kwa urahisi, Intent inaweza kutumika:

* Kuanza Kitendo, kwa kawaida kufungua kiolesura cha mtumiaji kwa programu
* Kama matangazo ya kuwajulisha mfumo na programu za mabadiliko
* Kuanza, kuacha, na kuwasiliana na huduma ya nyuma
* Kupata data kupitia Watoaji wa Yaliyomo
* Kama wito wa nyuma kushughulikia matukio

Ikiwa ina udhaifu, **Intents inaweza kutumika kufanya aina mbalimbali za mashambulizi**.

### Intent-Filter

**Intent Filters** hufafanua **jinsi kitendo, huduma, au Mpokeaji wa Matangazo wanaweza kuingiliana na aina tofauti za Intents**. Kimsingi, hufafanua uwezo wa sehemu hizi, kama vile vitendo wanavyoweza kufanya au aina za matangazo wanayoweza kusindika. Mahali kuu pa kutangaza filters hizi ni ndani ya faili ya **AndroidManifest.xml**, ingawa kwa Mpokeaji wa Matangazo, kuandika filters hizo pia ni chaguo.

Intent Filters zimeundwa na vikundi, vitendo, na filters za data, na uwezekano wa kuongeza metadata ziada. Hii inaruhusu sehemu kushughulikia Intents maalum ambazo zinakidhi vigezo vilivyotangazwa.

Jambo muhimu kuhusu sehemu za Android (vitendo/huduma/watoaji wa yaliyomo/mpokeaji wa matangazo) ni uonekano wao au **hali ya umma**. Sehemu inachukuliwa kuwa ya umma na inaweza kuingiliana na programu nyingine ikiwa ina **`exported`** na thamani ya **`true`** au ikiwa Intent Filter imetangazwa kwa sehemu hiyo katika hati ya maelezo. Walakini, kuna njia ambayo watengenezaji wanaweza kudumisha sehemu hizi kuwa za faragha, kuhakikisha kuwa hazina mwingiliano na programu nyingine kwa bahati mbaya. Hii inafanikiwa kwa kuweka sifa ya **`exported`** kuwa **`false`** katika ufafanuzi wao wa hati ya maelezo.

Zaidi ya hayo, watengenezaji wana chaguo la kuhakikisha ufikiaji salama wa sehemu hizi kwa kuhitaji idhini maalum. Sifa ya **`permission`** inaweza kuwekwa ili kuhakikisha kuwa sehemu inaweza kufikiwa tu na programu zilizo na idhini iliyotengwa, kuongeza safu ya ziada ya usalama na udhibiti juu ya nani anaweza kuingiliana nayo.
```java
<activity android:name=".MyActivity" android:exported="false">
<!-- Intent filters go here -->
</activity>
```
### Nia Zisizo Dhahiri

Nia zinatengenezwa kwa kutumia kujenga kwa programu kwa kutumia kujenga kwa nia:
```java
Intent email = new Intent(Intent.ACTION_SEND, Uri.parse("mailto:"));
```
**Hatua** ya nia iliyotangazwa hapo awali ni **ACTION\_SEND** na **Extra** ni mailto **Uri** (Extra ni habari ya ziada ambayo nia inatarajia).

Nia hii inapaswa kutangazwa ndani ya hati ya maandishi kama ilivyo katika mfano ufuatao:
```xml
<activity android:name="ShareActivity">
<intent-filter>
<action android:name="android.intent.action.SEND" />
<category android:name="android.intent.category.DEFAULT" />
</intent-filter>
</activity>
```
Kichujio cha nia kinahitaji kulingana na **hatua**, **data** na **jamii** ili kupokea ujumbe.

Mchakato wa "Uamuzi wa Nia" unahakikisha ni programu gani inapaswa kupokea kila ujumbe. Mchakato huu unazingatia sifa ya **kipaumbele**, ambayo inaweza kuwekwa katika **tamko la kichujio cha nia**, na **ile iliyo na kipaumbele cha juu itachaguliwa**. Kipaumbele hiki kinaweza kuwekwa kati ya -1000 na 1000 na programu zinaweza kutumia thamani ya `SYSTEM_HIGH_PRIORITY`. Ikiwa **mgogoro** unatokea, dirisha la "choser" linaonekana ili **mtumiaji aweze kufanya uamuzi**.

### Nia Zilizowazi

Nia iliyowazi inabainisha jina la darasa inayolengwa:
```java
Intent downloadIntent = new (this, DownloadService.class):
```
Katika programu nyingine ili kupata ufikiaji wa nia iliyotangazwa hapo awali, unaweza kutumia:
```java
Intent intent = new Intent();
intent.setClassName("com.other.app", "com.other.app.ServiceName");
context.startService(intent);
```
### Pending Intents

Hizi huruhusu programu nyingine kuchukua hatua kwa niaba ya programu yako, kwa kutumia kitambulisho na ruhusa za programu yako. Ili kuunda Pending Intent, inapaswa kutajwa nia na hatua ya kutekeleza. Ikiwa nia iliyotajwa sio wazi (haina taja ni nia gani inaweza kuipiga), programu mbaya inaweza kutekeleza hatua iliyotajwa kwa niaba ya programu ya mwathirika. Zaidi ya hayo, ikiwa hatua haijatajwa, programu mbaya itaweza kufanya hatua yoyote kwa niaba ya mwathirika.

### Broadcast Intents

Tofauti na nia za awali, ambazo hupokelewa tu na programu moja, nia za utangazaji zinaweza kupokelewa na programu nyingi. Walakini, kuanzia toleo la API 14, ni **inawezekana kutaja programu ambayo inapaswa kupokea** ujumbe kwa kutumia Intent.set Package.

Kwa kuongezea, pia ni **inawezekana kutaja ruhusa wakati wa kutuma utangazaji**. Programu ya mpokeaji itahitaji kuwa na ruhusa hiyo.

Kuna **aina mbili** za Utangazaji: **Kawaida** (asynchronous) na **Imepangwa** (synchronous). **Mpangilio** unategemea **kipaumbele kilichowekwa ndani ya mpokeaji**. **Kila programu inaweza kusindika, kupeleka au kuacha Utangazaji.**

Inawezekana **kutuma** utangazaji kwa kutumia kazi `sendBroadcast(intent, receiverPermission)` kutoka darasa la `Context`. Unaweza pia kutumia kazi **`sendBroadcast`** kutoka **`LocalBroadCastManager`** inahakikisha **ujumbe haondoki kamwe kwenye programu**. Kwa kutumia hii, hata hautahitaji kuuza nje sehemu ya mpokeaji.

### Sticky Broadcasts

Aina hii ya Utangazaji **inaweza kupatikana muda mrefu baada ya kutumwa**. Hizi zilipitwa na wakati katika kiwango cha API 21 na **siyo zinashauriwa kutumika**. **Zinaruhusu programu yoyote kusoma data, lakini pia kuihariri.**

Ikiwa unapata kazi zinazojumuisha neno "sticky" kama vile **`sendStickyBroadcast`** au **`sendStickyBroadcastAsUser`**, **angalia athari yake na jaribu kuiondoa**.

## Viungo vya kina / Mfumo wa URL

Katika programu za Android, viungo vya kina hutumiwa kuanzisha hatua (Nia) moja kwa moja kupitia URL. Hii hufanywa kwa kutangaza mfumo maalum wa URL ndani ya shughuli. Wakati kifaa cha Android kinajaribu **kufikia URL na mfumo huu**, shughuli iliyotajwa ndani ya programu inazinduliwa.

Mfumo lazima utangazwe katika faili ya **`AndroidManifest.xml`**:
```xml
[...]
<activity android:name=".MyActivity">
<intent-filter>
<action android:name="android.intent.action.VIEW" />
<category android:name="android.intent.category.DEFAULT" />
<category android:name="android.intent.category.BROWSABLE" />
<data android:scheme="examplescheme" />
</intent-filter>
[...]
```
Mpango kutoka mfano uliopita ni `exampleapp://` (zingatia pia **`jamii BROWSABLE`**)

Kisha, katika uga wa data, unaweza kutoa maelezo ya **host** na **path**:
```xml
<data android:scheme="examplescheme"
android:host="example"
/>
```
Ili kuipata kutoka kwenye wavuti, ni muhimu kuweka kiungo kama ifuatavyo:
```xml
<a href="examplescheme://example/something">click here</a>
<a href="examplescheme://example/javascript://%250dalert(1)">click here</a>
```
Ili kupata **msimbo utakaotekelezwa kwenye Programu**, nenda kwenye shughuli iliyoitwa na kiungo cha kina na tafuta kazi ya **`onNewIntent`**.

Jifunze jinsi ya [kuita viungo vya kina bila kutumia kurasa za HTML](./#exploiting-schemes-deep-links).

## AIDL - Lugha ya Ufafanuzi wa Kiolesura cha Android

Lugha ya Ufafanuzi wa Kiolesura cha Android (AIDL) imeundwa kwa ajili ya kurahisisha mawasiliano kati ya mteja na huduma katika programu za Android kupitia mawasiliano kati ya michakato (IPC). Kwa kuwa kupata kumbukumbu ya mchakato mwingine moja kwa moja hairuhusiwi kwenye Android, AIDL inasaidia mchakato huo kwa kubadilisha vitu kuwa muundo unaoeleweka na mfumo wa uendeshaji, hivyo kurahisisha mawasiliano kati ya michakato tofauti.

### Dhana Kuu

- **Huduma Zilizounganishwa**: Huduma hizi hutumia AIDL kwa IPC, kuruhusu shughuli au sehemu kuunganisha huduma, kuomba na kupokea majibu. Njia ya `onBind` katika darasa la huduma ni muhimu kwa kuanzisha mwingiliano, na hivyo kuifanya eneo muhimu kwa ukaguzi wa usalama ili kutafuta udhaifu.

- **Mtumaji**: Kwa kufanya kazi kama huduma iliyounganishwa, Mtumaji hufanikisha IPC kwa kuzingatia usindikaji wa data kupitia njia ya `onBind`. Ni muhimu kukagua kwa karibu njia hii kwa ajili ya usindikaji hatari wa data au utekelezaji wa kazi nyeti.

- **Binder**: Ingawa matumizi moja kwa moja ya darasa la Binder ni nadra kutokana na uchakataji wa AIDL, ni muhimu kuelewa kuwa Binder hufanya kazi kama dereva wa kiwango cha kernel kurahisisha uhamishaji wa data kati ya nafasi za kumbukumbu za michakato tofauti. Kwa ufahamu zaidi, rasilimali inapatikana kwenye [https://www.youtube.com/watch?v=O-UHvFjxwZ8](https://www.youtube.com/watch?v=O-UHvFjxwZ8).

## Sehemu

Hizi ni pamoja na: **Shughuli, Huduma, Wapokeaji wa Matangazo na Watoaji.**

### Shughuli ya Kuzindua na shughuli nyingine

Katika programu za Android, **shughuli** ni kama skrini, zikionyesha sehemu tofauti za kiolesura cha mtumiaji wa programu. Programu inaweza kuwa na shughuli nyingi, kila moja ikionyesha skrini ya kipekee kwa mtumiaji.

**Shughuli ya kuzindua** ni lango kuu la programu, inayozinduliwa unapobonyeza alama ya programu. Imeelezwa katika faili ya maelezo ya programu na nia maalum za MAIN na LAUNCHER:
```markup
<activity android:name=".LauncherActivity">
<intent-filter>
<action android:name="android.intent.action.MAIN" />
<category android:name="android.intent.category.LAUNCHER" />
</intent-filter>
</activity>
```
Haitaji programu zote kuwa na shughuli ya kuanzisha, hasa zile bila kiolesura cha mtumiaji, kama huduma za nyuma.

Shughuli zinaweza kuwezeshwa kwa programu au michakato mingine kwa kuziweka kama "zilizosafirishwa" katika hati ya maandishi. Mipangilio hii inaruhusu programu nyingine kuanza shughuli hii:
```markdown
<service android:name=".ExampleExportedService" android:exported="true"/>
```
Hata hivyo, kufikia shughuli kutoka kwa programu nyingine sio hatari ya usalama kila wakati. Wasiwasi unatokea ikiwa data nyeti inashirikiwa kwa njia isiyofaa, ambayo inaweza kusababisha uvujaji wa habari.

Mzunguko wa maisha wa shughuli **unaanza na njia ya onCreate**, kuweka UI na kujiandaa kwa shughuli ya mwingiliano na mtumiaji.

### Darasa la Maombi

Katika maendeleo ya Android, programu ina chaguo la kuunda **darasa la kudumu** la [Application](https://developer.android.com/reference/android/app/Application), ingawa sio lazima. Wakati darasa kama hilo linapofafanuliwa, linakuwa darasa la kwanza kuanzishwa ndani ya programu. Njia ya **`attachBaseContext`**, ikiwa imeanzishwa katika darasa hili, inatekelezwa kabla ya njia ya **`onCreate`**. Hii inaruhusu kwa kuanzishwa mapema kabla ya programu yote kuanza.
```java
public class MyApp extends Application {
@Override
protected void attachBaseContext(Context base) {
super.attachBaseContext(base);
// Initialization code here
}

@Override
public void onCreate() {
super.onCreate();
// More initialization code
}
}
```
### Huduma

[Huduma](https://developer.android.com/guide/components/services) ni **shughuli za nyuma** zinazoweza kutekeleza kazi bila kiolesura cha mtumiaji. Kazi hizi zinaweza kuendelea kufanya kazi hata wakati watumiaji wanabadilisha programu tofauti, hivyo huduma ni muhimu kwa **shughuli za muda mrefu**.

Huduma ni za kubadilika; zinaweza kuanzishwa kwa njia mbalimbali, na **Intents** ikiwa njia kuu ya kuzianzisha kama sehemu ya kuingia ya programu. Mara huduma inapoanza kutumia njia ya `startService`, njia yake ya `onStart` inaanza na kuendelea kufanya kazi hadi njia ya `stopService` itakapotumiwa kuita huduma kwa uwazi. Vinginevyo, ikiwa jukumu la huduma linategemea uhusiano wa mteja uliopo, njia ya `bindService` hutumiwa kuunganisha mteja na huduma, na njia ya `onBind` hutumiwa kwa kupitisha data.

Matumizi ya kuvutia ya huduma ni pamoja na kucheza muziki nyuma au kupata data ya mtandao bila kuingilia mwingiliano wa mtumiaji na programu. Aidha, huduma zinaweza kuwa zinapatikana kwa michakato mingine kwenye kifaa kimoja kupitia **kuwezesha**. Hii sio tabia ya msingi na inahitaji usanidi wa wazi kwenye faili ya Android Manifest:
```xml
<service android:name=".ExampleExportedService" android:exported="true"/>
```
### Wapokeaji wa Matangazo

**Wapokeaji wa matangazo** hufanya kazi kama wasikilizaji katika mfumo wa ujumbe, kuruhusu programu nyingi kujibu ujumbe sawa kutoka kwa mfumo. Programu inaweza **kujiandikisha mpokeaji** kwa **njia mbili kuu**: kupitia **Mwongozo** wa programu au **kwa njia ya kudumu** ndani ya nambari ya programu kupitia API ya **`registerReceiver`**. Katika Mwongozo, matangazo hufunguliwa kwa kutumia ruhusa, wakati wapokeaji waliojiandikisha kwa njia ya kudumu pia wanaweza kubainisha ruhusa wakati wa usajili.

**Vichujio vya nia** ni muhimu katika njia zote za usajili, vikiamua ni matangazo gani yanayosababisha mpokeaji. Mara tu tangazo linalolingana linapotumwa, njia ya **`onReceive`** ya mpokeaji inaitwa, ikiruhusu programu kuchukua hatua kulingana na hilo, kama kurekebisha tabia kujibu arifa ya betri iliyopungua.

Matangazo yanaweza kuwa **yasiyo ya kusawazisha**, yakifika kwa wapokeaji wote bila mpangilio, au **yasawazishwa**, ambapo wapokeaji wanapokea tangazo kulingana na vipaumbele vilivyowekwa. Hata hivyo, ni muhimu kuzingatia hatari ya usalama, kwani programu yoyote inaweza kujipa kipaumbele ili kuvuruga tangazo.

Ili kuelewa utendaji wa mpokeaji, tafuta njia ya **`onReceive`** ndani ya darasa lake. Namna hii ya nambari inaweza kubadilisha Nia iliyopokelewa, ikionyesha umuhimu wa ukaguzi wa data na wapokeaji, hasa katika **Matangazo Yaliyopangwa**, ambayo yanaweza kubadilisha au kukataa Nia.

### Mtoaji wa Yaliyomo

**Watoaji wa Yaliyomo** ni muhimu kwa **kushiriki data iliyopangwa** kati ya programu, ikisisitiza umuhimu wa kutekeleza **ruhusa** ili kuhakikisha usalama wa data. Wao huruhusu programu kupata data kutoka vyanzo mbalimbali, ikiwa ni pamoja na maktaba za data, mfumo wa faili, au wavuti. Ruhusa maalum, kama vile **`readPermission`** na **`writePermission`**, ni muhimu kwa kudhibiti upatikanaji. Aidha, upatikanaji wa muda mfupi unaweza kutolewa kupitia mipangilio ya **`grantUriPermission`** katika mwongozo wa programu, ikichangia sifa kama vile `path`, `pathPrefix`, na `pathPattern` kwa udhibiti wa upatikanaji wa kina.

Uthibitishaji wa kuingia ni muhimu ili kuzuia udhaifu, kama vile SQL injection. Watoaji wa Yaliyomo hutoa msaada kwa shughuli za msingi: `insert()`, `update()`, `delete()`, na `query()`, kurahisisha mabadiliko ya data na kushiriki kati ya programu.

**FileProvider**, mtoaji maalum wa Yaliyomo, unazingatia kushiriki faili kwa usalama. Inatambulishwa katika mwongozo wa programu na sifa maalum za kudhibiti upatikanaji wa folda, zilizotambuliwa na `android:exported` na `android:resource` zinazoelekeza kwa mipangilio ya folda. Tahadhari inashauriwa wakati wa kushiriki saraka ili kuepuka kufichua data nyeti kwa bahati mbaya.

Mfano wa tangazo la mwongozo kwa FileProvider:
```xml
<provider android:name="androidx.core.content.FileProvider"
android:authorities="com.example.myapp.fileprovider"
android:grantUriPermissions="true"
android:exported="false">
<meta-data android:name="android.support.FILE_PROVIDER_PATHS"
android:resource="@xml/filepaths" />
</provider>
```
Na mfano wa kufafanua folda zilizoshirikiwa katika `filepaths.xml`:
```xml
<paths>
<files-path path="images/" name="myimages" />
</paths>
```
Kwa habari zaidi angalia:
- [Android Developers: Watoaji wa Yaliyomo](https://developer.android.com/guide/topics/providers/content-providers)
- [Android Developers: FileProvider](https://developer.android.com/training/secure-file-sharing/setup-sharing)

## WebViews

WebViews ni kama **vivinjari vidogo vya wavuti** ndani ya programu za Android, vikitoa maudhui kutoka kwenye wavuti au kutoka kwenye faili za ndani. Vinakabili hatari kama vivinjari vya kawaida, lakini kuna njia za **kupunguza hatari hizi** kupitia **vipimo maalum**.

Android inatoa aina mbili kuu za WebView:

- **WebViewClient** ni nzuri kwa HTML ya msingi lakini haishikilii kazi ya onyo la JavaScript, ikiaathiri jinsi mashambulizi ya XSS yanavyoweza kujaribiwa.
- **WebChromeClient** inafanya kazi zaidi kama uzoefu kamili wa kivinjari cha Chrome.

Jambo muhimu ni kwamba vivinjari vya WebView **havishiriki vidakuzi** na kivinjari kikuu cha kifaa.

Kwa kupakia maudhui, njia kama ````loadUrl````, ````loadData````, na ````loadDataWithBaseURL```` zinapatikana. Ni muhimu kuhakikisha kuwa URL au faili hizi ni **salama kutumia**. Vipimo vya usalama vinaweza kusimamiwa kupitia darasa la ````WebSettings````. Kwa mfano, kuzima JavaScript na ````setJavaScriptEnabled(false)```` kunaweza kuzuia mashambulizi ya XSS.

"Bridge" ya JavaScript inaruhusu vitu vya Java kuingiliana na JavaScript, ikihitaji njia zitambuliwe na ````@JavascriptInterface```` kwa usalama kutoka Android 4.2 na kuendelea.

Kuruhusu ufikiaji wa maudhui (````setAllowContentAccess(true)````) kunaruhusu WebViews kufikia Watoaji wa Yaliyomo, ambayo inaweza kuwa hatari isipokuwa URL za maudhui zimehakikiwa kuwa salama.

Kudhibiti ufikiaji wa faili:
- Kuzima ufikiaji wa faili (````setAllowFileAccess(false)````) kunapunguza ufikiaji wa mfumo wa faili, na ubaguzi kwa mali fulani, kuhakikisha zinatumika tu kwa maudhui yasiyo ya siri.

## Sehemu Zingine za Programu na Usimamizi wa Kifaa cha Simu

### **Kusainiwa Kwa Dijitali ya Programu**

- **Kusainiwa kwa dijitali** ni lazima kwa programu za Android, kuhakikisha kuwa zimeandikwa **kwa uhalisia** kabla ya kusakinishwa. Mchakato huu hutumia cheti kwa utambuzi wa programu na lazima ithibitishwe na meneja wa pakiti ya kifaa wakati wa kusakinisha. Programu zinaweza **kujisaini au kuthibitishwa na CA ya nje**, kuhakikisha kuwa hakuna ufikiaji usiohalali na kuhakikisha kuwa programu haijabadilishwa wakati inasafirishwa kwenye kifaa.

### **Uhakiki wa Programu kwa Usalama Ulioboreshwa**

- Kuanzia **Android 4.2**, kipengele kinachoitwa **Uhakiki wa Programu** kuruhusu watumiaji kuangalia usalama wa programu kabla ya kusakinisha. Mchakato huu wa **uhakiki** unaweza kuwaonya watumiaji dhidi ya programu zenye hatari, au hata kuzuia usakinishaji wa programu zenye nia mbaya, kuimarisha usalama wa mtumiaji.

### **Usimamizi wa Kifaa cha Simu (MDM)**

- **Suluhisho za MDM** hutoa **usimamizi na usalama** kwa vifaa vya simu kupitia **API ya Usimamizi wa Kifaa**. Inahitaji kusakinisha programu ya Android ili kusimamia na kuhakikisha usalama wa vifaa vya simu kwa ufanisi. Majukumu muhimu ni pamoja na **kuweka sera za nenosiri**, **kuagiza kusimbwa kwa uhifadhi**, na **kuruhusu kufuta data kwa mbali**, kuhakikisha udhibiti na usalama kamili juu ya vifaa vya simu.
```java
// Example of enforcing a password policy with MDM
DevicePolicyManager dpm = (DevicePolicyManager) getSystemService(Context.DEVICE_POLICY_SERVICE);
ComponentName adminComponent = new ComponentName(context, AdminReceiver.class);

if (dpm.isAdminActive(adminComponent)) {
// Set minimum password length
dpm.setPasswordMinimumLength(adminComponent, 8);
}
```
***

<figure><img src="/.gitbook/assets/image (675).png" alt=""><figcaption></figcaption></figure>

Tafuta udhaifu unaofaa zaidi ili uweze kuyatatua haraka. Intruder inafuatilia eneo lako la shambulio, inatekeleza uchunguzi wa vitisho wa kujitokeza, inapata matatizo katika mfumo wako mzima wa teknolojia, kutoka kwa APIs hadi programu za wavuti na mifumo ya wingu. [**Jaribu bure**](https://www.intruder.io/?utm\_source=referral\&utm\_campaign=hacktricks) leo.

{% embed url="https://www.intruder.io/?utm_campaign=hacktricks&utm_source=referral" %}

***


<details>

<summary><strong>Jifunze kuhusu kudukua AWS kutoka sifuri hadi shujaa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Mtaalam wa Timu Nyekundu ya AWS ya HackTricks)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako ikionekana katika HackTricks** au **kupakua HackTricks kwa muundo wa PDF** Angalia [**MPANGO WA KUJIUNGA**](https://github.com/sponsors/carlospolop)!
* Pata [**swag rasmi wa PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**The PEASS Family**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa [**NFTs**](https://opensea.io/collection/the-peass-family) ya kipekee
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au [**kikundi cha telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Shiriki mbinu zako za kudukua kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos za github.

</details>
