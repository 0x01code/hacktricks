# Tapjacking

<details>

<summary><strong>Aprenda hacking no AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ quer ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**material oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **Junte-se ao grupo** üí¨ [**Discord**](https://discord.gg/hRep4RUj7f) ou ao grupo [**telegram**](https://t.me/peass) ou **siga**-me no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios do GitHub** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## **Informa√ß√µes B√°sicas**

**Tapjacking** √© um ataque onde uma **aplica√ß√£o maliciosa** √© lan√ßada e **se posiciona em cima de uma aplica√ß√£o v√≠tima**. Uma vez que obscurece visualmente o app v√≠tima, sua interface de usu√°rio √© projetada de tal forma a enganar o usu√°rio para interagir com ela, enquanto passa a intera√ß√£o para o app v√≠tima.\
Na pr√°tica, est√° **cegando o usu√°rio para que ele n√£o perceba que est√° realmente realizando a√ß√µes no app v√≠tima**.

### Detec√ß√£o

Para detectar apps vulner√°veis a este ataque, voc√™ deve procurar por **atividades exportadas** no manifesto do Android (note que uma atividade com um intent-filter √© automaticamente exportada por padr√£o). Uma vez que voc√™ encontrou as atividades exportadas, **verifique se elas requerem alguma permiss√£o**. Isso porque a **aplica√ß√£o maliciosa tamb√©m precisar√° dessa permiss√£o**.

### Prote√ß√£o

#### Android 12 (API 31,32) e superiores

[**De acordo com esta fonte**](https://www.geeksforgeeks.org/tapjacking-in-android/)**,** ataques de tapjacking s√£o automaticamente prevenidos pelo Android a partir do Android 12 (API 31 & 32) em diante. Ent√£o, mesmo que a aplica√ß√£o seja vulner√°vel, voc√™ **n√£o ser√° capaz de explor√°-la**.

#### `filterTouchesWhenObscured`

Se **`android:filterTouchesWhenObscured`** estiver definido como **`true`**, a `View` n√£o receber√° toques sempre que a janela da view estiver obscurecida por outra janela vis√≠vel.

#### **`setFilterTouchesWhenObscured`**

O atributo **`setFilterTouchesWhenObscured`** definido como verdadeiro tamb√©m pode prevenir a explora√ß√£o desta vulnerabilidade se a vers√£o do Android for inferior.\
Se definido como **`true`**, por exemplo, um bot√£o pode ser automaticamente **desativado se estiver obscurecido**:
```markup
<Button android:text="Button"
android:id="@+id/button1"
android:layout_width="wrap_content"
android:layout_height="wrap_content"
android:filterTouchesWhenObscured="true">
</Button>
```
## Explora√ß√£o

### Tapjacking-ExportedActivity

A aplica√ß√£o **Android mais recente** que realiza um ataque de **Tapjacking** (invocando antes uma **atividade exportada** da aplica√ß√£o atacada) pode ser encontrada em [**https://github.com/carlospolop/Tapjacking-ExportedActivity**](https://github.com/carlospolop/Tapjacking-ExportedActivity).

Siga as **instru√ß√µes do README para us√°-lo**.

### FloatingWindowApp

Um projeto de exemplo implementando **FloatingWindowApp**, que pode ser usado para sobrepor outras atividades e realizar um ataque de clickjacking, pode ser encontrado em [**FloatingWindowApp**](https://github.com/aminography/FloatingWindowApp) (um pouco antigo, boa sorte ao construir o apk).

### Qark

{% hint style="danger" %}
Parece que este projeto agora est√° sem manuten√ß√£o e essa funcionalidade n√£o est√° funcionando corretamente mais.
{% endhint %}

Voc√™ pode usar [**qark**](https://github.com/linkedin/qark) com os par√¢metros `--exploit-apk` --sdk-path `/Users/username/Library/Android/sdk` para criar uma aplica√ß√£o maliciosa para testar poss√≠veis vulnerabilidades de **Tapjacking**.\

A mitiga√ß√£o √© relativamente simples, pois o desenvolvedor pode optar por n√£o receber eventos de toque quando uma visualiza√ß√£o est√° coberta por outra. Usando a [Refer√™ncia para Desenvolvedores Android](https://developer.android.com/reference/android/view/View#security):

> √Äs vezes, √© essencial que uma aplica√ß√£o possa verificar que uma a√ß√£o est√° sendo realizada com o conhecimento e consentimento total do usu√°rio, como conceder uma solicita√ß√£o de permiss√£o, fazer uma compra ou clicar em um an√∫ncio. Infelizmente, uma aplica√ß√£o maliciosa poderia tentar enganar o usu√°rio para realizar essas a√ß√µes, sem o seu conhecimento, ocultando o prop√≥sito pretendido da visualiza√ß√£o. Como rem√©dio, o framework oferece um mecanismo de filtragem de toque que pode ser usado para melhorar a seguran√ßa de visualiza√ß√µes que fornecem acesso a funcionalidades sens√≠veis.
>
> Para habilitar a filtragem de toque, chame [`setFilterTouchesWhenObscured(boolean)`](https://developer.android.com/reference/android/view/View#setFilterTouchesWhenObscured%28boolean%29) ou defina o atributo de layout android:filterTouchesWhenObscured como verdadeiro. Quando habilitado, o framework descartar√° toques que s√£o recebidos sempre que a janela da visualiza√ß√£o estiver obscurecida por outra janela vis√≠vel. Como resultado, a visualiza√ß√£o n√£o receber√° toques sempre que um toast, di√°logo ou outra janela aparecer acima da janela da visualiza√ß√£o.

<details>

<summary><strong>Aprenda hacking no AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ quiser ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**material oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **Junte-se ao grupo** üí¨ [**Discord**](https://discord.gg/hRep4RUj7f) ou ao grupo [**telegram**](https://t.me/peass) ou **siga**-me no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe suas dicas de hacking enviando PRs para os reposit√≥rios do GitHub** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
