# Tapjacking

<details>

<summary><strong>Aprenda hacking AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ quiser ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF**, verifique os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**swag oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe seus truques de hacking enviando PRs para os reposit√≥rios** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## **Informa√ß√µes B√°sicas**

**Tapjacking** √© um ataque em que um **aplicativo malicioso** √© lan√ßado e **se posiciona sobre um aplicativo da v√≠tima**. Uma vez que ele obscurece visualmente o aplicativo da v√≠tima, sua interface de usu√°rio √© projetada de forma a enganar o usu√°rio para interagir com ele, enquanto passa a intera√ß√£o para o aplicativo da v√≠tima.\
Na pr√°tica, ele **cega o usu√°rio, fazendo com que ele n√£o saiba que est√° realmente realizando a√ß√µes no aplicativo da v√≠tima**.

### Detec√ß√£o

Para detectar aplicativos vulner√°veis a esse ataque, voc√™ deve procurar por **atividades exportadas** no manifesto do Android (observe que uma atividade com um intent-filter √© automaticamente exportada por padr√£o). Depois de encontrar as atividades exportadas, **verifique se elas requerem alguma permiss√£o**. Isso ocorre porque o **aplicativo malicioso tamb√©m precisar√° dessa permiss√£o**.

### Prote√ß√£o

#### Android 12 (API 31,32) e superior

[**De acordo com esta fonte**](https://www.geeksforgeeks.org/tapjacking-in-android/)**,** os ataques de tapjacking s√£o automaticamente impedidos pelo Android a partir do Android 12 (API 31 e 30) e superiores. Portanto, mesmo que o aplicativo seja vulner√°vel, voc√™ **n√£o conseguir√° explor√°-lo**.

#### `filterTouchesWhenObscured`

Se **`android:filterTouchesWhenObscured`** for definido como **`true`**, a `View` n√£o receber√° toques sempre que a janela da visualiza√ß√£o estiver obscurecida por outra janela vis√≠vel.

#### **`setFilterTouchesWhenObscured`**

O atributo **`setFilterTouchesWhenObscured`** definido como true tamb√©m pode prevenir a explora√ß√£o dessa vulnerabilidade se a vers√£o do Android for mais antiga.\
Se definido como **`true`**, por exemplo, um bot√£o pode ser automaticamente **desativado se estiver obscurecido**:
```xml
<Button android:text="Button"
android:id="@+id/button1"
android:layout_width="wrap_content"
android:layout_height="wrap_content"
android:filterTouchesWhenObscured="true">
</Button>
```
## Explora√ß√£o

### Tapjacking-ExportedActivity

A aplica√ß√£o **Android mais recente** que realiza um ataque de Tapjacking (+ invocando antes de uma atividade exportada da aplica√ß√£o atacada) pode ser encontrada em: [**https://github.com/carlospolop/Tapjacking-ExportedActivity**](https://github.com/carlospolop/Tapjacking-ExportedActivity).

Siga as **instru√ß√µes do README para utiliz√°-la**.

### FloatingWindowApp

Um projeto de exemplo que implementa o **FloatingWindowApp**, o qual pode ser utilizado para colocar em cima de outras atividades para realizar um ataque de clickjacking, pode ser encontrado em [**FloatingWindowApp**](https://github.com/aminography/FloatingWindowApp) (um pouco antigo, boa sorte construindo o apk).

### Qark

{% hint style="danger" %}
Parece que este projeto n√£o est√° mais sendo mantido e esta funcionalidade n√£o est√° mais funcionando corretamente
{% endhint %}

Voc√™ pode usar o [**qark**](https://github.com/linkedin/qark) com os par√¢metros `--exploit-apk` --sdk-path `/Users/username/Library/Android/sdk` para criar uma aplica√ß√£o maliciosa para testar poss√≠veis vulnerabilidades de **Tapjacking**.

A mitiga√ß√£o √© relativamente simples, pois o desenvolvedor pode optar por n√£o receber eventos de toque quando uma visualiza√ß√£o √© coberta por outra. Utilizando a [Refer√™ncia do Desenvolvedor Android](https://developer.android.com/reference/android/view/View#security):

> √Äs vezes √© essencial que um aplicativo possa verificar que uma a√ß√£o est√° sendo realizada com pleno conhecimento e consentimento do usu√°rio, como conceder uma solicita√ß√£o de permiss√£o, fazer uma compra ou clicar em um an√∫ncio. Infelizmente, um aplicativo malicioso poderia tentar enganar o usu√°rio para realizar essas a√ß√µes, sem saber, ocultando o prop√≥sito pretendido da visualiza√ß√£o. Como rem√©dio, o framework oferece um mecanismo de filtragem de toque que pode ser usado para melhorar a seguran√ßa de visualiza√ß√µes que fornecem acesso a funcionalidades sens√≠veis.
>
> Para habilitar a filtragem de toque, chame [`setFilterTouchesWhenObscured(boolean)`](https://developer.android.com/reference/android/view/View#setFilterTouchesWhenObscured%28boolean%29) ou defina o atributo de layout android:filterTouchesWhenObscured como true. Quando habilitado, o framework descartar√° toques que forem recebidos sempre que a janela da visualiza√ß√£o estiver obscurecida por outra janela vis√≠vel. Como resultado, a visualiza√ß√£o n√£o receber√° toques sempre que um toast, di√°logo ou outra janela aparecer acima da janela da visualiza√ß√£o.
