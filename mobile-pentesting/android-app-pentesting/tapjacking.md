# Tapjacking

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks Cloud ☁️</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>🐦 Twitter 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 Youtube 🎥</strong></a></summary>

* 你在一个**网络安全公司**工作吗？你想在HackTricks中看到你的**公司广告**吗？或者你想获得**PEASS的最新版本或下载PDF格式的HackTricks**吗？请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 发现我们的独家[**NFTs**](https://opensea.io/collection/the-peass-family)收藏品[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* 获得[**官方PEASS和HackTricks周边产品**](https://peass.creator-spring.com)
* **加入**[**💬**](https://emojipedia.org/speech-balloon/) [**Discord群组**](https://discord.gg/hRep4RUj7f)或[**电报群组**](https://t.me/peass)，或者**关注**我在**Twitter**上的[**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**。**
* **通过向**[**hacktricks repo**](https://github.com/carlospolop/hacktricks) **和**[**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **提交PR来分享你的黑客技巧。**

</details>

## **基本信息**

**Tapjacking**是一种攻击，其中一个**恶意应用程序**被启动并**位于受害者应用程序的顶部**。一旦它明显遮挡了受害者应用程序，它的用户界面被设计成以一种欺骗用户与之交互的方式，同时将交互传递给受害者应用程序。\
实际上，它**使用户无法知道他们实际上是在对受害者应用程序执行操作**。

### 检测

为了检测受此攻击影响的应用程序，您应该在Android清单中搜索**导出的活动**（请注意，具有意图过滤器的活动默认情况下会自动导出）。一旦找到导出的活动，**检查它们是否需要任何权限**。这是因为**恶意应用程序也需要该权限**。

### 保护

#### Android 12 (API 31,32)及更高版本

[**根据此来源**](https://www.geeksforgeeks.org/tapjacking-in-android/)**，**从Android 12（API 31和30）及更高版本开始，Android会自动防止tapjacking攻击。因此，即使应用程序存在漏洞，您**也无法利用它**。

#### `filterTouchesWhenObscured`

如果将**`android:filterTouchesWhenObscured`**设置为**`true`**，当视图的窗口被另一个可见窗口遮挡时，该视图将不会接收触摸事件。

#### **`setFilterTouchesWhenObscured`**

如果将属性**`setFilterTouchesWhenObscured`**设置为true，并且Android版本较低，则还可以防止利用此漏洞。\
例如，如果被遮挡，按钮可以自动**禁用**：
```markup
<Button android:text="Button"
android:id="@+id/button1"
android:layout_width="wrap_content"
android:layout_height="wrap_content"
android:filterTouchesWhenObscured="true">
</Button>
```
## Exploitation

### Tapjacking-ExportedActivity

最近的一个执行Tapjacking攻击的Android应用程序（在攻击应用程序的导出活动之前调用）可以在[https://github.com/carlospolop/Tapjacking-ExportedActivity](https://github.com/carlospolop/Tapjacking-ExportedActivity)找到。

按照README中的说明使用它。

### FloatingWindowApp

一个实现FloatingWindowApp的示例项目，可以用来放在其他活动的上方执行点击劫持攻击，可以在[FloatingWindowApp](https://github.com/aminography/FloatingWindowApp)中找到（有点旧了，祝你构建apk好运）。

### Qark

{% hint style="danger" %}
看起来这个项目现在已经不再维护，这个功能也不再正常工作
{% endhint %}

您可以使用[qark](https://github.com/linkedin/qark)和`--exploit-apk` --sdk-path `/Users/username/Library/Android/sdk`参数创建一个恶意应用程序，以测试可能的Tapjacking漏洞。

缓解措施相对简单，开发人员可以选择在一个视图被另一个视图覆盖时不接收触摸事件。使用[Android开发者参考](https://developer.android.com/reference/android/view/View#security)：

> 有时，应用程序必须能够验证用户完全知情并同意执行的操作，例如授予权限请求、进行购买或点击广告。不幸的是，恶意应用程序可能会试图欺骗用户执行这些操作，而用户却不知情，通过隐藏视图的预期目的。作为补救措施，框架提供了一个触摸过滤机制，可用于提高提供对敏感功能的访问的视图的安全性。
>
> 要启用触摸过滤，请调用[`setFilterTouchesWhenObscured(boolean)`](https://developer.android.com/reference/android/view/View#setFilterTouchesWhenObscured%28boolean%29)或将android:filterTouchesWhenObscured布局属性设置为true。启用后，框架将在视图的窗口被另一个可见窗口遮挡时丢弃接收到的触摸。因此，当一个toast、对话框或其他窗口出现在视图的窗口上方时，视图将不会接收到触摸。

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks Cloud ☁️</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>🐦 Twitter 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 Youtube 🎥</strong></a></summary>

* 您在一家网络安全公司工作吗？您想在HackTricks中看到您的公司广告吗？或者您想获得PEASS的最新版本或下载PDF格式的HackTricks吗？请查看[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)！
* 发现我们的独家[NFTs](https://opensea.io/collection/the-peass-family)收藏品[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* 获得[**官方PEASS和HackTricks周边产品**](https://peass.creator-spring.com)
* **加入**[**💬**](https://emojipedia.org/speech-balloon/) [**Discord群组**](https://discord.gg/hRep4RUj7f)或[**电报群组**](https://t.me/peass)，或在**Twitter**上**关注**我[**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**。**
* **通过向**[**hacktricks repo**](https://github.com/carlospolop/hacktricks) **和**[**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **提交PR来分享您的黑客技巧。**

</details>
