# Tapjacking

<details>

<summary><strong>Impara l'hacking AWS da zero a eroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Esperto Red Team AWS di HackTricks)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se vuoi vedere la tua **azienda pubblicizzata in HackTricks** o **scaricare HackTricks in PDF** Controlla i [**PIANI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale di PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**La Famiglia PEASS**](https://opensea.io/collection/the-peass-family), la nostra collezione di [**NFT esclusivi**](https://opensea.io/collection/the-peass-family)
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR a** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}


## **Informazioni di Base**

**Tapjacking** √® un attacco in cui un'**applicazione malevola** viene avviata e si **posiziona sopra un'applicazione vittima**. Una volta che oscura visivamente l'app vittima, la sua interfaccia utente √® progettata in modo da ingannare l'utente affinch√© interagisca con essa, mentre passa l'interazione all'app vittima.\
Di fatto, **acceca l'utente dal sapere che sta effettivamente eseguendo azioni sull'app vittima**.

### Rilevamento

Per individuare le app vulnerabili a questo attacco, √® necessario cercare le **attivit√† esportate** nel manifesto Android (nota che un'attivit√† con un intent-filter √® automaticamente esportata per impostazione predefinita). Una volta trovate le attivit√† esportate, **verificare se richiedono qualche permesso**. Questo perch√© la **applicazione malevola avr√† bisogno anche di quel permesso**.

### Protezione

#### Android 12 (API 31,32) e superiori

[**Secondo questa fonte**](https://www.geeksforgeeks.org/tapjacking-in-android/)**,** gli attacchi di tapjacking sono automaticamente impediti da Android da Android 12 (API 31 e 30) in poi. Quindi, anche se l'applicazione √® vulnerabile, **non sar√† possibile sfruttarla**.

#### `filterTouchesWhenObscured`

Se **`android:filterTouchesWhenObscured`** √® impostato su **`true`**, la `View` non ricever√† tocchi ogni volta che la finestra della vista √® oscurata da un'altra finestra visibile.

#### **`setFilterTouchesWhenObscured`**

L'attributo **`setFilterTouchesWhenObscured`** impostato su true pu√≤ anche prevenire lo sfruttamento di questa vulnerabilit√† se la versione di Android √® inferiore.\
Se impostato su **`true`**, ad esempio, un pulsante pu√≤ essere automaticamente **disabilitato se √® oscurato**:
```xml
<Button android:text="Button"
android:id="@+id/button1"
android:layout_width="wrap_content"
android:layout_height="wrap_content"
android:filterTouchesWhenObscured="true">
</Button>
```
## Sfruttamento

### Tapjacking-ExportedActivity

La pi√π **recente applicazione Android** che esegue un attacco Tapjacking (+ invocando prima un'attivit√† esportata dell'applicazione attaccata) pu√≤ essere trovata in: [**https://github.com/carlospolop/Tapjacking-ExportedActivity**](https://github.com/carlospolop/Tapjacking-ExportedActivity).

Segui le **istruzioni del README per usarla**.

### FloatingWindowApp

Un progetto di esempio che implementa **FloatingWindowApp**, che pu√≤ essere utilizzato per sovrapporsi ad altre attivit√† per eseguire un attacco di clickjacking, pu√≤ essere trovato in [**FloatingWindowApp**](https://github.com/aminography/FloatingWindowApp) (un po' datato, buona fortuna a costruire l'apk).

### Qark

{% hint style="danger" %}
Sembra che questo progetto non sia pi√π mantenuto e questa funzionalit√† non funzioni pi√π correttamente
{% endhint %}

Puoi utilizzare [**qark**](https://github.com/linkedin/qark) con i parametri `--exploit-apk` --sdk-path `/Users/username/Library/Android/sdk` per creare un'applicazione dannosa per testare possibili vulnerabilit√† di **Tapjacking**.

La mitigazione √® relativamente semplice poich√© lo sviluppatore pu√≤ scegliere di non ricevere eventi touch quando una vista √® coperta da un'altra. Utilizzando il [Riferimento dello Sviluppatore Android](https://developer.android.com/reference/android/view/View#security):

> A volte √® essenziale che un'applicazione possa verificare che un'azione venga eseguita con la piena conoscenza e il consenso dell'utente, come concedere una richiesta di autorizzazione, effettuare un acquisto o fare clic su un annuncio. Purtroppo, un'applicazione dannosa potrebbe cercare di ingannare l'utente affinch√© esegua queste azioni, ignaro, nascondendo lo scopo previsto della vista. Come rimedio, il framework offre un meccanismo di filtraggio dei touch che pu√≤ essere utilizzato per migliorare la sicurezza delle viste che forniscono accesso a funzionalit√† sensibili.
>
> Per abilitare il filtraggio dei touch, chiamare [`setFilterTouchesWhenObscured(boolean)`](https://developer.android.com/reference/android/view/View#setFilterTouchesWhenObscured%28boolean%29) o impostare l'attributo di layout android:filterTouchesWhenObscured su true. Quando abilitato, il framework scarter√† i touch ricevuti ogni volta che la finestra della vista √® oscurata da un'altra finestra visibile. Di conseguenza, la vista non ricever√† touch ogni volta che compare una toast, una dialog o un'altra finestra sopra la finestra della vista.

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

<details>

<summary><strong>Impara l'hacking AWS da zero a eroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se vuoi vedere la tua **azienda pubblicizzata in HackTricks** o **scaricare HackTricks in PDF** Controlla i [**PIANI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**The PEASS Family**](https://opensea.io/collection/the-peass-family), la nostra collezione di esclusivi [**NFT**](https://opensea.io/collection/the-peass-family)
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR ai** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
