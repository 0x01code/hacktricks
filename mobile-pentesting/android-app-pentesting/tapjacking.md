# Tapjacking

<details>

<summary><strong>Aprende hacking en AWS desde cero hasta experto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** 춰Consulta los [**PLANES DE SUSCRIPCI칍N**](https://github.com/sponsors/carlospolop)!
* Obt칠n [**productos oficiales de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci칩n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s칤guenos** en **Twitter** 游냕 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## **Informaci칩n B치sica**

**Tapjacking** es un ataque donde una **aplicaci칩n maliciosa** se lanza y **se posiciona encima de una aplicaci칩n v칤ctima**. Una vez que oculta visualmente la aplicaci칩n v칤ctima, su interfaz de usuario est치 dise침ada de tal manera que enga침a al usuario para interactuar con ella, mientras pasa la interacci칩n a la aplicaci칩n v칤ctima.\
En efecto, **ciega al usuario para que no se d칠 cuenta de que realmente est치 realizando acciones en la aplicaci칩n v칤ctima**.

### Detecci칩n

Para detectar aplicaciones vulnerables a este ataque, debes buscar **actividades exportadas** en el manifiesto de Android (nota que una actividad con un intent-filter se exporta autom치ticamente por defecto). Una vez que hayas encontrado las actividades exportadas, **verifica si requieren alg칰n permiso**. Esto se debe a que la **aplicaci칩n maliciosa tambi칠n necesitar치 ese permiso**.

### Protecci칩n

#### Android 12 (API 31,32) y superior

[**Seg칰n esta fuente**](https://www.geeksforgeeks.org/tapjacking-in-android/)**,** los ataques de tapjacking son autom치ticamente prevenidos por Android desde Android 12 (API 31 y 30) y superiores. Por lo tanto, incluso si la aplicaci칩n es vulnerable, **no podr치s explotarla**.

#### `filterTouchesWhenObscured`

Si **`android:filterTouchesWhenObscured`** est치 configurado como **`true`**, la `View` no recibir치 toques cuando la ventana de la vista est칠 oculta por otra ventana visible.

#### **`setFilterTouchesWhenObscured`**

El atributo **`setFilterTouchesWhenObscured`** configurado como true tambi칠n puede prevenir la explotaci칩n de esta vulnerabilidad si la versi칩n de Android es m치s baja.\
Si se establece en **`true`**, por ejemplo, un bot칩n puede ser autom치ticamente **deshabilitado si est치 oculto**:
```xml
<Button android:text="Button"
android:id="@+id/button1"
android:layout_width="wrap_content"
android:layout_height="wrap_content"
android:filterTouchesWhenObscured="true">
</Button>
```
## Explotaci칩n

### Tapjacking-ExportedActivity

La aplicaci칩n **m치s reciente de Android** que realiza un ataque de Tapjacking (+ invocando antes una actividad exportada de la aplicaci칩n atacada) se puede encontrar en: [**https://github.com/carlospolop/Tapjacking-ExportedActivity**](https://github.com/carlospolop/Tapjacking-ExportedActivity).

Sigue las **instrucciones del README para usarla**.

### FloatingWindowApp

Un proyecto de ejemplo que implementa **FloatingWindowApp**, que se puede utilizar para colocar encima de otras actividades y realizar un ataque de clickjacking, se puede encontrar en [**FloatingWindowApp**](https://github.com/aminography/FloatingWindowApp) (un poco antiguo, buena suerte construyendo el apk).

### Qark

{% hint style="danger" %}
Parece que este proyecto ya no se mantiene y esta funcionalidad ya no funciona correctamente
{% endhint %}

Puedes usar [**qark**](https://github.com/linkedin/qark) con los par치metros `--exploit-apk` --sdk-path `/Users/username/Library/Android/sdk` para crear una aplicaci칩n maliciosa y probar posibles vulnerabilidades de **Tapjacking**.

La mitigaci칩n es relativamente simple ya que el desarrollador puede optar por no recibir eventos t치ctiles cuando una vista est치 cubierta por otra. Utilizando la [Referencia del Desarrollador de Android](https://developer.android.com/reference/android/view/View#security):

> A veces es esencial que una aplicaci칩n pueda verificar que una acci칩n se est치 realizando con pleno conocimiento y consentimiento del usuario, como otorgar una solicitud de permiso, realizar una compra o hacer clic en un anuncio. Desafortunadamente, una aplicaci칩n maliciosa podr칤a intentar enga침ar al usuario para que realice estas acciones, sin darse cuenta, ocultando el prop칩sito previsto de la vista. Como remedio, el framework ofrece un mecanismo de filtrado t치ctil que se puede utilizar para mejorar la seguridad de las vistas que proporcionan acceso a funcionalidades sensibles.
>
> Para habilitar el filtrado t치ctil, llama a [`setFilterTouchesWhenObscured(boolean)`](https://developer.android.com/reference/android/view/View#setFilterTouchesWhenObscured%28boolean%29) o establece el atributo de dise침o android:filterTouchesWhenObscured en true. Cuando est치 habilitado, el framework descartar치 los toques que se reciban siempre que la ventana de la vista est칠 oscurecida por otra ventana visible. Como resultado, la vista no recibir치 toques cada vez que aparezca una notificaci칩n, un di치logo u otra ventana encima de la ventana de la vista.
