# Tapjacking

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Expert en √©quipe rouge AWS de HackTricks)</strong></a><strong>!</strong></summary>

Autres fa√ßons de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

<figure><img src="/.gitbook/assets/WebSec_1500x400_10fps_21sn_lightoptimized_v2.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}


## **Informations de base**

**Tapjacking** est une attaque o√π une **application malveillante** est lanc√©e et **se positionne au-dessus d'une application victime**. Une fois qu'elle obscurcit visiblement l'application victime, son interface utilisateur est con√ßue de mani√®re √† tromper l'utilisateur pour interagir avec elle, tout en transmettant l'interaction √† l'application victime.\
En effet, cela **emp√™che l'utilisateur de savoir qu'il effectue r√©ellement des actions sur l'application victime**.

### D√©tection

Pour d√©tecter les applications vuln√©rables √† cette attaque, vous devez rechercher les **activit√©s export√©es** dans le manifeste Android (notez qu'une activit√© avec un filtre d'intention est automatiquement export√©e par d√©faut). Une fois que vous avez trouv√© les activit√©s export√©es, **v√©rifiez si elles n√©cessitent des autorisations**. Cela est n√©cessaire car la **application malveillante aura √©galement besoin de cette autorisation**.

### Protection

#### Android 12 (API 31,32) et sup√©rieur

[**Selon cette source**](https://www.geeksforgeeks.org/tapjacking-in-android/)**,** les attaques de tapjacking sont automatiquement emp√™ch√©es par Android √† partir d'Android 12 (API 31 et 30) et sup√©rieur. Ainsi, m√™me si l'application est vuln√©rable, vous **ne pourrez pas l'exploiter**.

#### `filterTouchesWhenObscured`

Si **`android:filterTouchesWhenObscured`** est d√©fini sur **`true`**, la `View` ne recevra pas de touches lorsque la fen√™tre de la vue est obscurcie par une autre fen√™tre visible.

#### **`setFilterTouchesWhenObscured`**

L'attribut **`setFilterTouchesWhenObscured`** d√©fini sur true peut √©galement emp√™cher l'exploitation de cette vuln√©rabilit√© si la version d'Android est inf√©rieure.\
S'il est d√©fini sur **`true`**, par exemple, un bouton peut √™tre automatiquement **d√©sactiv√© s'il est obscurci**:
```xml
<Button android:text="Button"
android:id="@+id/button1"
android:layout_width="wrap_content"
android:layout_height="wrap_content"
android:filterTouchesWhenObscured="true">
</Button>
```
## Exploitation

### Tapjacking-ExportedActivity

La plus **r√©cente application Android** effectuant une attaque Tapjacking (+ invoquant avant une activit√© export√©e de l'application attaqu√©e) peut √™tre trouv√©e sur : [**https://github.com/carlospolop/Tapjacking-ExportedActivity**](https://github.com/carlospolop/Tapjacking-ExportedActivity).

Suivez les instructions du **README pour l'utiliser**.

### FloatingWindowApp

Un projet d'exemple impl√©mentant **FloatingWindowApp**, qui peut √™tre utilis√© pour placer au-dessus d'autres activit√©s afin d'effectuer une attaque de clickjacking, peut √™tre trouv√© sur [**FloatingWindowApp**](https://github.com/aminography/FloatingWindowApp) (un peu ancien, bonne chance pour construire l'apk).

### Qark

{% hint style="danger" %}
Il semble que ce projet ne soit plus maintenu et que cette fonctionnalit√© ne fonctionne plus correctement
{% endhint %}

Vous pouvez utiliser [**qark**](https://github.com/linkedin/qark) avec les param√®tres `--exploit-apk` --sdk-path `/Users/username/Library/Android/sdk` pour cr√©er une application malveillante afin de tester d'√©ventuelles vuln√©rabilit√©s de **Tapjacking**.

La mitigation est relativement simple car le d√©veloppeur peut choisir de ne pas recevoir d'√©v√©nements tactiles lorsqu'une vue est recouverte par une autre. En utilisant la [R√©f√©rence du d√©veloppeur Android](https://developer.android.com/reference/android/view/View#security):

> Parfois, il est essentiel qu'une application puisse v√©rifier qu'une action est effectu√©e avec la pleine connaissance et le consentement de l'utilisateur, comme accorder une demande de permission, effectuer un achat ou cliquer sur une publicit√©. Malheureusement, une application malveillante pourrait essayer de tromper l'utilisateur en lui faisant effectuer ces actions, sans le savoir, en cachant le but pr√©vu de la vue. En guise de rem√®de, le framework offre un m√©canisme de filtrage tactile qui peut √™tre utilis√© pour am√©liorer la s√©curit√© des vues qui fournissent un acc√®s √† des fonctionnalit√©s sensibles.
>
> Pour activer le filtrage tactile, appelez [`setFilterTouchesWhenObscured(boolean)`](https://developer.android.com/reference/android/view/View#setFilterTouchesWhenObscured%28boolean%29) ou d√©finissez l'attribut de mise en page android:filterTouchesWhenObscured sur true. Lorsqu'il est activ√©, le framework rejettera les touches re√ßues chaque fois que la fen√™tre de la vue est obscurcie par une autre fen√™tre visible. Par cons√©quent, la vue ne recevra pas de touches chaque fois qu'un toast, une bo√Æte de dialogue ou une autre fen√™tre appara√Æt au-dessus de la fen√™tre de la vue.

<figure><img src="/.gitbook/assets/WebSec_1500x400_10fps_21sn_lightoptimized_v2.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

D'autres fa√ßons de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Rejoignez** üí¨ le groupe Discord](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** nous sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
