# Tapjacking

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>를 통해 AWS 해킹을 처음부터 전문가까지 배워보세요<strong>!</strong></summary>

HackTricks를 지원하는 다른 방법:

* **회사를 HackTricks에서 광고하거나 HackTricks를 PDF로 다운로드**하려면 [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)를 확인하세요!
* [**공식 PEASS & HackTricks 스웨그**](https://peass.creator-spring.com)를 얻으세요.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)를 발견하세요. 독점적인 [**NFTs**](https://opensea.io/collection/the-peass-family) 컬렉션입니다.
* 💬 [**Discord 그룹**](https://discord.gg/hRep4RUj7f) 또는 [**텔레그램 그룹**](https://t.me/peass)에 **참여**하거나 **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)을 **팔로우**하세요.
* **HackTricks**와 **HackTricks Cloud** github 저장소에 PR을 제출하여 **해킹 트릭을 공유**하세요.

</details>

## **기본 정보**

**Tapjacking**은 **악성 애플리케이션이 피해 애플리케이션 위에 위치**하여 실행되는 공격입니다. 피해 앱을 가려 사용자 인터페이스를 속이는 방식으로 사용자가 상호작용하도록 속이면서 실제로는 피해 앱에서 작업을 수행하게 만듭니다.\
사용자는 **피해 앱에서 작업을 수행하고 있다는 사실을 알지 못하게 됩니다**.

### 탐지

이 공격에 취약한 앱을 탐지하기 위해 안드로이드 매니페스트에서 **내보낸 액티비티**를 검색해야 합니다 (인텐트 필터가 있는 액티비티는 기본적으로 자동으로 내보내집니다). 내보낸 액티비티를 찾은 후 **해당 액티비티가 어떤 권한을 필요로 하는지 확인**해야 합니다. 이는 **악성 애플리케이션도 해당 권한이 필요하기 때문**입니다.

### 보호

#### Android 12 (API 31,32) 이상

[**이 소스에 따르면**](https://www.geeksforgeeks.org/tapjacking-in-android/)**,** Android 12 (API 31 및 30) 이상에서는 tapjacking 공격이 자동으로 방지됩니다. 따라서 취약한 애플리케이션도 **해당 취약점을 악용할 수 없습니다**.

#### `filterTouchesWhenObscured`

**`android:filterTouchesWhenObscured`**가 **`true`**로 설정되면, `View`는 다른 가시 창에 의해 가려질 때 터치를 받지 않습니다.

#### **`setFilterTouchesWhenObscured`**

Android 버전이 낮은 경우, **`setFilterTouchesWhenObscured`** 속성을 true로 설정하면 이 취약점의 악용을 방지할 수도 있습니다.\
예를 들어, 버튼이 가려지면 자동으로 **비활성화**될 수 있습니다.
```xml
<Button android:text="Button"
android:id="@+id/button1"
android:layout_width="wrap_content"
android:layout_height="wrap_content"
android:filterTouchesWhenObscured="true">
</Button>
```
## Exploitation

### Tapjacking-ExportedActivity

가장 최근의 안드로이드 애플리케이션인 Tapjacking 공격을 수행하는 애플리케이션은 [https://github.com/carlospolop/Tapjacking-ExportedActivity](https://github.com/carlospolop/Tapjacking-ExportedActivity)에서 찾을 수 있습니다.

사용 방법은 README 지침을 따르십시오.

### FloatingWindowApp

클릭재킹 공격을 수행하기 위해 다른 활동 위에 놓을 수 있는 FloatingWindowApp을 구현한 예제 프로젝트는 [FloatingWindowApp](https://github.com/aminography/FloatingWindowApp)에서 찾을 수 있습니다 (약간 오래되었으니 apk를 빌드하는 데 행운을 빕니다).

### Qark

{% hint style="danger" %}
이 프로젝트는 더 이상 유지되지 않고 이 기능이 제대로 작동하지 않는 것 같습니다.
{% endhint %}

`--exploit-apk` --sdk-path `/Users/username/Library/Android/sdk` 매개변수를 사용하여 악성 애플리케이션을 생성하여 가능한 Tapjacking 취약점을 테스트하기 위해 [qark](https://github.com/linkedin/qark)를 사용할 수 있습니다.

개발자는 다른 뷰에 의해 가려질 때 터치 이벤트를 받지 않도록 선택할 수 있으므로 완화 방법은 비교적 간단합니다. [Android 개발자 참조](https://developer.android.com/reference/android/view/View#security)를 사용하십시오.

> 사용자의 전체 동의와 함께 작업이 수행되고 있는지 확인해야 하는 경우(권한 요청, 구매 또는 광고 클릭 등)에는 의도한 뷰의 목적을 숨기는 악성 애플리케이션이 사용자를 속일 수 있습니다. 이를 해결하기 위해 프레임워크는 민감한 기능에 액세스하는 뷰의 보안을 향상시킬 수 있는 터치 필터링 메커니즘을 제공합니다.
>
> 터치 필터링을 활성화하려면 [`setFilterTouchesWhenObscured(boolean)`](https://developer.android.com/reference/android/view/View#setFilterTouchesWhenObscured%28boolean%29)를 호출하거나 android:filterTouchesWhenObscured 레이아웃 속성을 true로 설정하십시오. 활성화되면 프레임워크는 뷰의 창이 다른 가시적인 창에 의해 가려질 때마다 수신된 터치를 폐기합니다. 결과적으로 뷰는 토스트, 대화 상자 또는 다른 창이 뷰의 창 위에 나타날 때마다 터치를 받지 않습니다.

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>를 통해 제로에서 영웅까지 AWS 해킹을 배워보세요<strong>!</strong></summary>

HackTricks를 지원하는 다른 방법:

* HackTricks에서 **회사를 광고하거나 HackTricks를 PDF로 다운로드**하려면 [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)를 확인하세요!
* [**공식 PEASS & HackTricks 스웨그**](https://peass.creator-spring.com)를 얻으세요.
* 독점적인 [**NFTs**](https://opensea.io/collection/the-peass-family)인 [**The PEASS Family**](https://opensea.io/collection/the-peass-family)를 발견하세요.
* 💬 [**Discord 그룹**](https://discord.gg/hRep4RUj7f) 또는 [**텔레그램 그룹**](https://t.me/peass)에 **참여**하거나 **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)**를** 팔로우하세요.
* **HackTricks**와 **HackTricks Cloud** github 저장소에 PR을 제출하여 **자신의 해킹 기법을 공유**하세요.

</details>
