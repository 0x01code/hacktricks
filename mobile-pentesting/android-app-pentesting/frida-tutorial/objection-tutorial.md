# Mafunzo ya Objection

<details>

<summary><strong>Jifunze kuhusu kudukua AWS kutoka mwanzo hadi mtaalamu na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako ikionekana kwenye HackTricks** au **kupakua HackTricks kwa muundo wa PDF** Angalia [**MPANGO WA KUJIUNGA**](https://github.com/sponsors/carlospolop)!
* Pata [**swag rasmi wa PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**The PEASS Family**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa [**NFTs**](https://opensea.io/collection/the-peass-family) za kipekee
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au [**kikundi cha telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Shiriki mbinu zako za kudukua kwa kuwasilisha PRs kwenye** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos za github.

</details>

<img src="../../../.gitbook/assets/i3.png" alt="" data-size="original">

**Mshauri wa tuzo ya mdudu**: **jiandikishe** kwa **Intigriti**, jukwaa la tuzo za mdudu la malipo lililoanzishwa na wadukuzi, kwa wadukuzi! Jiunge nasi kwenye [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) leo, na anza kupata tuzo hadi **$100,000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

## **Utangulizi**

**objection - Uchunguzi wa Rununu wa Wakati wa Kutekelezwa**

**[Objection](https://github.com/sensepost/objection)** ni seti ya zana za uchunguzi wa rununu wa wakati wa kutekelezwa, inayotumia [Frida](https://www.frida.re). Iliundwa kusaidia tathmini ya programu za rununu na hali yao ya usalama bila hitaji la kifaa cha rununu kilichofungwa au kilichorootiwa.

**Angalizo:** Hii sio njia ya kudukua / kufungua kizuizi cha kifaa. Kwa kutumia `objection`, bado unakabiliwa na vizuizi vyote vilivyowekwa na sanduku la mchanga linalofaa.

### Muhtasari

**Lengo** la **objection** ni kuruhusu mtumiaji kuita **hatua kuu zinazotolewa na Frida**. Vinginevyo, mtumiaji atahitaji kuunda **script moja kwa kila programu** anayotaka kujaribu.

## Mafunzo

Kwa mafunzo haya, nitatumia APK ambayo unaweza kupakua hapa:

{% file src="../../../.gitbook/assets/app-release.zip" %}

Au kutoka kwenye [repo yake ya asili](https://github.com/asvid/FridaApp)(pakua app-release.apk)

### Usanidi
```bash
pip3 install objection
```
### Uunganisho

Fanya **unganisho la kawaida la ADB** na **anza** seva ya **frida** kwenye kifaa (na hakikisha kuwa frida inafanya kazi kwenye mteja na seva).

Ikiwa unatumia **kifaa kilichorooti**, ni lazima uchague programu unayotaka kujaribu ndani ya chaguo la _**--gadget**_. katika kesi hii:
```bash
frida-ps -Uai
objection --gadget asvid.github.io.fridaapp explore
```
### Hatua za Msingi

Haitakuorodheshwa katika mafunzo haya amri zote zinazowezekana za objections, bali tu zile ambazo nimeona kuwa ni muhimu zaidi.

#### Mazingira

Baadhi ya habari muhimu (kama vile nywila au njia) zinaweza kupatikana ndani ya mazingira.
```bash
env
```
![](<../../../.gitbook/assets/image (64).png>)

#### Taarifa za Frida
```bash
frida
```
![](<../../../.gitbook/assets/image (65).png>)

#### Pakia/Pakua
```bash
file download <remote path> [<local path>]
file upload <local path> [<remote path>]
```
#### Ingiza skripti ya frida
```bash
import <local path frida-script>
```
#### SSLPinning

SSLPinning ni mbinu ya usalama inayotumiwa katika maombi ya Android ili kuzuia mashambulizi ya kati (man-in-the-middle attacks) kwa kudhibiti uthibitisho wa cheti cha SSL. Kwa kawaida, maombi ya Android yanakubali cheti chochote cha SSL kilichosainiwa na mamlaka ya cheti (Certificate Authority). Hata hivyo, SSLPinning inaruhusu maombi kudhibiti cheti cha SSL kinachotumika na kuhakikisha kuwa ni cheti sahihi kinachotarajiwa.

Kwa kufanya hivyo, SSLPinning inazuia uwezekano wa mtu mwingine kuingilia kati mawasiliano kati ya maombi na seva kwa kutumia cheti bandia. Hii inasaidia kuzuia mashambulizi ya kati ambapo mshambuliaji anaweza kusoma, kubadilisha, au kuvuja data inayopitishwa kati ya maombi na seva.

Kuna njia mbili za kutekeleza SSLPinning katika maombi ya Android: pinning ya cheti (certificate pinning) na pinning ya umma (public key pinning). Katika pinning ya cheti, maombi linadhibiti cheti cha SSL kinachotumika na kuhakikisha kuwa ni cheti sahihi kinachotarajiwa. Katika pinning ya umma, maombi linadhibiti funguo za umma zinazohusiana na cheti cha SSL na kuhakikisha kuwa ni funguo sahihi zinazotarajiwa.

SSLPinning ni mbinu muhimu ya usalama katika maombi ya Android na inaweza kusaidia kuzuia mashambulizi ya kati na kuvuja kwa data.
```bash
android sslpinning disable #Attempts to disable SSL Pinning on Android devices.
```
#### Uchunguzi wa Mzizi

Root detection is a common security measure implemented in Android apps to detect if a device has been rooted. Rooting a device gives users privileged access to the operating system, which can pose a security risk for the app.

Uchunguzi wa mzizi ni hatua ya usalama inayotumiwa mara kwa mara katika programu za Android ili kugundua ikiwa kifaa kimefungwa mzizi. Kufunga mzizi kwenye kifaa kunampa mtumiaji ufikiaji wa hali ya juu kwenye mfumo wa uendeshaji, ambayo inaweza kuwa hatari kwa usalama wa programu.

There are various techniques used to detect root access, such as checking for the presence of known root files or binaries, checking the device's build properties, or using root detection libraries.

Kuna njia mbalimbali zinazotumiwa kugundua ufikiaji wa mzizi, kama vile kuangalia uwepo wa faili au programu-jalizi za mzizi zinazojulikana, kuangalia mali za ujenzi wa kifaa, au kutumia maktaba za uchunguzi wa mzizi.

To bypass root detection, an attacker can use tools like Frida or Objection to hook into the app's code and modify the root detection logic. By intercepting the root detection function calls, the attacker can manipulate the return values to make the app believe that the device is not rooted.

Ili kuepuka uchunguzi wa mzizi, mshambuliaji anaweza kutumia zana kama Frida au Objection kuingiza kwenye nambari ya programu na kubadilisha mantiki ya uchunguzi wa mzizi. Kwa kuvuruga wito wa kazi ya uchunguzi wa mzizi, mshambuliaji anaweza kubadilisha thamani ya kurudi ili kufanya programu iamini kwamba kifaa hakijafungwa mzizi.

It is important for developers to implement additional security measures to protect their apps from being compromised on rooted devices. This can include encrypting sensitive data, using code obfuscation techniques, or implementing server-side security checks.

Ni muhimu kwa watengenezaji kuweka hatua za ziada za usalama ili kulinda programu zao isidukuliwe kwenye vifaa vilivyofungwa mzizi. Hii inaweza kujumuisha kusimbua data nyeti, kutumia mbinu za kuficha nambari, au kutekeleza ukaguzi wa usalama upande wa seva.
```bash
android root disable  #Attempts to disable root detection on Android devices.
android root simulate #Attempts to simulate a rooted Android environment.
```
#### Amri ya Kutekeleza

Unapotumia Objection, unaweza kutumia amri ya `exec` kutekeleza amri za mfumo kwenye kifaa cha Android. Hii inaruhusu wewe kufanya vitendo mbalimbali kama vile kuangalia mazingira ya mfumo, kufanya mabadiliko ya muda, na kufanya uchunguzi wa kina wa kifaa.

Kwa mfano, unaweza kutumia amri ifuatayo kutekeleza amri ya `ls` kwenye kifaa cha Android:

```shell
objection> exec ls
```

Hii itakupa orodha ya faili na folda zilizopo kwenye kifaa cha Android.

Unaweza pia kutumia amri ya `exec` kutekeleza amri zingine za mfumo kama vile `ps`, `cat`, `chmod`, na zingine nyingi. Hii inakupa uwezo wa kufanya uchunguzi wa kina wa kifaa cha Android na kufanya mabadiliko muhimu kulingana na mahitaji yako.

Kumbuka kwamba matumizi mabaya ya amri ya `exec` yanaweza kuwa hatari na yanaweza kusababisha madhara kwenye kifaa cha Android. Hakikisha unatumia amri hii kwa uangalifu na kwa madhumuni ya kisheria tu.
```bash
android shell_exec whoami
```
#### Picha za Skrini
```bash
android ui screenshot /tmp/screenshot
android ui FLAG_SECURE false  #This may enable you to take screenshots using the hardware keys
```
### Uchambuzi Statisi Uliofanywa Kuwa wa Kudumu

Katika programu halisi tunapaswa kujua habari zote zilizogunduliwa katika sehemu hii kabla ya kutumia upinzani kwa msaada wa **uchambuzi statiki**. Hata hivyo, njia hii inaweza kukupa **kitu kipya** kwani hapa utakuwa na orodha kamili ya madarasa, njia, na vitu vilivyotolewa.

Hii pia ni muhimu ikiwa kwa njia fulani huwezi kupata nambari ya chanzo inayoweza kusomwa ya programu.

#### Orodha ya shughuli, wapokeaji, na huduma
```bash
android hooking list activities
```
![](<../../../.gitbook/assets/image (78).png>)

# Objection Tutorial

Objection is a runtime mobile exploration toolkit, powered by Frida. It allows you to perform various tasks on Android devices, such as:

- Bypassing SSL pinning
- Analyzing and manipulating method calls
- Modifying the behavior of an application
- Inspecting and modifying network requests
- Decrypting encrypted traffic
- And much more!

In this tutorial, we will cover the basics of using Objection for Android app pentesting.

## Installation

To install Objection, you need to have Python 3.x and pip installed on your system. Then, you can install Objection by running the following command:

```bash
pip install objection
```

## Starting Objection

Once Objection is installed, you can start it by running the following command:

```bash
objection
```

This will start the Objection console, where you can interact with the target Android device.

## Connecting to the Device

To connect to the target Android device, you can use the `android connect` command followed by the device's IP address:

```bash
android connect <device_ip>
```

Make sure that the target device has USB debugging enabled and is connected to your computer via USB.

## Exploring the Device

Once connected to the device, you can start exploring its applications and services using Objection's commands. For example, you can use the `android hooking list` command to list all the available hooks:

```bash
android hooking list
```

This will display a list of hooks that you can use to manipulate the behavior of the target application.

## Bypassing SSL Pinning

One common technique used in Android app pentesting is bypassing SSL pinning. Objection provides a command called `android sslpinning disable` that can be used to disable SSL pinning for a specific application:

```bash
android sslpinning disable <package_name>
```

Replace `<package_name>` with the package name of the target application.

## Modifying Method Calls

Objection allows you to modify the behavior of an application by hooking into its methods. You can use the `android hooking watch` command to hook a specific method and monitor its calls:

```bash
android hooking watch class_name method_name
```

Replace `class_name` and `method_name` with the name of the class and method you want to hook.

## Inspecting Network Requests

With Objection, you can inspect and modify network requests made by the target application. You can use the `android proxy start` command to start a proxy server and intercept the network traffic:

```bash
android proxy start
```

This will start the proxy server on the default port (1337). You can then configure your device to use the proxy server and start capturing the network requests.

## Conclusion

Objection is a powerful tool for Android app pentesting, allowing you to perform various tasks on Android devices. In this tutorial, we covered the basics of using Objection, including installation, connecting to the device, exploring applications and services, bypassing SSL pinning, modifying method calls, and inspecting network requests.
```bash
android hooking list services
android hooking list receivers
```
Frida itazindua kosa ikiwa hakuna kinachopatikana

#### Kupata shughuli ya sasa
```bash
android hooking get current_activity
```
![](<../../../.gitbook/assets/image (73) (1).png>)

#### Tafuta Madarasa

Anza kutafuta madarasa ndani ya programu yetu
```bash
android hooking search classes asvid.github.io.fridaapp
```
![](<../../../.gitbook/assets/image (69).png>)

#### Tafuta Njia za darasa

Sasa hebu tafuta njia zilizomo ndani ya darasa _MainActivity:_
```bash
android hooking search methods asvid.github.io.fridaapp MainActivity
```
![](<../../../.gitbook/assets/image (70) (1).png>)

#### Orodhesha Njia zilizotangazwa za darasa na vigezo vyao

Hebu tujue ni vigezo gani njia za darasa zinahitaji:
```bash
android hooking list class_methods asvid.github.io.fridaapp.MainActivity
```
![](<../../../.gitbook/assets/image (79).png>)

#### Orodhesha madarasa

Unaweza pia kuorodhesha madarasa yote yaliyopakiwa ndani ya programu ya sasa:
```bash
android hooking list classes #List all loaded classes, As the target application gets usedmore, this command will return more classes.
```
Hii ni muhimu sana ikiwa unataka **kuunganisha njia ya darasa na unajua tu jina la darasa**. Unaweza kutumia kazi hii ku **tafuta moduli inayomiliki darasa** na kisha kuunganisha njia yake.

### Kuunganisha kuwa rahisi

#### Kuunganisha (kuangalia) njia

Kutoka kwa [msimbo wa chanzo](https://github.com/asvid/FridaApp/blob/master/app/src/main/java/asvid/github/io/fridaapp/MainActivity.kt) wa programu tunajua kuwa **kazi** _**sum()**_ **kutoka** _**MainActivity**_ inaendeshwa **kila sekunde**. Hebu jaribu **kudump habari zote zinazowezekana** kila wakati kazi inaitwa (hoja, thamani ya kurudi na mfuatano wa nyuma):
```bash
android hooking watch class_method asvid.github.io.fridaapp.MainActivity.sum --dump-args --dump-backtrace --dump-return
```
![](<../../../.gitbook/assets/image (71).png>)

#### Kufunga (kuangalia) darasa zima

Kwa kweli, ninaona kuwa njia zote za darasa la MainActivity ni za kuvutia sana, hebu **funga** zote. Jihadhari, hii inaweza **kufanya programu kushindwa**.
```bash
android hooking watch class asvid.github.io.fridaapp.MainActivity --dump-args --dump-return
```
Ikiwa unacheza na programu wakati darasa linashikwa utaona wakati **kila kazi inaitwa**, **maagizo** yake na **thamani ya kurudi**.

![](<../../../.gitbook/assets/image (72).png>)

#### Kubadilisha thamani ya kurudi ya kazi ya boolean

Kutoka kwenye nambari ya chanzo unaweza kuona kuwa kazi _checkPin_ inapata _String_ kama hoja na inarudi _boolean_. Hebu tufanye kazi **irudi daima kuwa kweli**:

![](<../../../.gitbook/assets/image (74).png>)

Sasa, Ikiwa unandika chochote kwenye sanduku la maandishi kwa nambari ya PIN utaona kuwa chochote ni halali:

![](<../../../.gitbook/assets/image (77).png>)

### Mifano ya Darasa

Tafuta na chapisha **mifano hai ya darasa la Java** maalum, iliyoainishwa na jina kamili la darasa. Matokeo ni jaribio la kupata thamani ya herufi kwa pingamizi iliyogunduliwa ambayo kwa kawaida **ingekuwa na thamani za mali kwa kitu**.
```
android heap print_instances <class>
```
![](<../../../.gitbook/assets/image (80).png>)

### Keystore/Intents

Unaweza kucheza na keystore na intents kwa kutumia:
```bash
android keystore list
android intents launch_activity
android intent launch_service
```
#### Kumbukumbu

##### Pindua

```bash
# Dump the memory of the application
objection -g <package_name> explore
memory dump --dump-file <dump_file_path>
```

##### Maelezo

Kwa kutumia amri hii, unaweza kupindua kumbukumbu ya programu ya simu. Unahitaji kutoa jina la pakiti ya programu (<package_name>) na njia ya faili ya kumbukumbu ya kupindua (<dump_file_path>).
```bash
memory dump all <local destination> #Dump all memory
memory dump from_base <base_address> <size_to_dump> <local_destination> #Dump a part
```
#### Orodha
```bash
memory list modules
```
![](<../../../.gitbook/assets/image (66).png>)

Chini ya orodha unaweza kuona frida:

![](<../../../.gitbook/assets/image (67).png>)

Hebu tuangalie ni nini frida inaexport:

![](<../../../.gitbook/assets/image (68).png>)

#### Tafuta/Andika

Unaweza pia kutafuta na kuandika ndani ya kumbukumbu na objection:
```bash
memory search "<pattern eg: 41 41 41 ?? 41>" (--string) (--offsets-only)
memory write "<address>" "<pattern eg: 41 41 41 41>" (--string)
```
### SQLite

Unaweza kutumia amri `sqlite` kuwasiliana na hifadhidata za sqlite.

### Toka
```bash
exit
```
## Kile Ninachokosa katika Objection

* Njia za kufunga mara nyingi zinasababisha programu kushindwa kufanya kazi (hii pia ni kwa sababu ya Frida).
* Hauwezi kutumia mifano ya darasa kuita kazi za mfano. Na hauwezi kuunda mifano mpya ya darasa na kuitumia kuita kazi.
* Hakuna njia ya mkato (kama ile ya sslpinnin) ya kufunga njia za kawaida za kryptografia zinazotumiwa na programu ili kuona maandishi yaliyofichwa, maandishi wazi, funguo, IVs, na algorithm zinazotumiwa.

<img src="../../../.gitbook/assets/i3.png" alt="" data-size="original">

**Mshauri wa tuzo za mdudu**: **Jisajili** kwa **Intigriti**, jukwaa la tuzo za mdudu la malipo lililoanzishwa na wadukuzi, kwa wadukuzi! Jiunge nasi kwenye [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) leo, na anza kupata tuzo hadi **$100,000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

<details>

<summary><strong>Jifunze kuhusu kudukua AWS kutoka sifuri hadi shujaa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako inatangazwa kwenye HackTricks** au **kupakua HackTricks kwa muundo wa PDF** Angalia [**MPANGO WA KUJIUNGA**](https://github.com/sponsors/carlospolop)!
* Pata [**swag rasmi wa PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**The PEASS Family**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa [**NFTs**](https://opensea.io/collection/the-peass-family) za kipekee
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au [**kikundi cha telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Shiriki mbinu zako za kudukua kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
