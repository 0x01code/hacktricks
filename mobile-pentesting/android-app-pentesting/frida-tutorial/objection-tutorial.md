# Objectionチュートリアル

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks Cloud ☁️</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>🐦 Twitter 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 Youtube 🎥</strong></a></summary>

* **サイバーセキュリティ会社**で働いていますか？ **HackTricksで会社を宣伝**したいですか？または、**PEASSの最新バージョンにアクセスしたり、HackTricksをPDFでダウンロード**したいですか？[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を見つけてください。独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクションです。
* [**公式のPEASS＆HackTricks swag**](https://peass.creator-spring.com)を手に入れましょう。
* [**💬**](https://emojipedia.org/speech-balloon/) [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**telegramグループ**](https://t.me/peass)に**参加**するか、**Twitter**で**フォロー**してください[**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**。**
* **ハッキングのトリックを共有するには、[hacktricks repo](https://github.com/carlospolop/hacktricks)と[hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)**にPRを提出してください。

</details>

<img src="../../../.gitbook/assets/i3.png" alt="" data-size="original">

**バグバウンティのヒント**：ハッカーによって作成されたプレミアムの**バグバウンティプラットフォームであるIntigriti**に**サインアップ**してください！今すぐ[**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks)に参加して、最大**$100,000**のバウンティを獲得しましょう！

{% embed url="https://go.intigriti.com/hacktricks" %}

## **はじめに**

[![objection](https://github.com/sensepost/objection/raw/master/images/objection.png)](https://github.com/sensepost/objection)

**objection - ランタイムモバイルエクスプロレーション**

`objection`は、[Frida](https://www.frida.re)を搭載したランタイムモバイルエクスプロレーションツールキットです。このツールは、脱獄またはルート化されたモバイルデバイスの必要性なしに、モバイルアプリケーションとそのセキュリティポストを評価するのに役立つことを目的として構築されました。

**注意：**これはある種の脱獄/ルートバイパスではありません。`objection`を使用することで、対象となるサンドボックスによって課されるすべての制限に制約されます。

### 再開

**objection**の目標は、ユーザーが**Fridaが提供する主なアクションを呼び出すこと**です。**そうでない場合**、テストしたい**各アプリケーションごとに単一のスクリプトを作成する必要があります**。

## チュートリアル

このチュートリアルでは、ここからダウンロードできるAPKを使用します：

{% file src="../../../.gitbook/assets/app-release.zip" %}

または、[元のリポジトリ](https://github.com/asvid/FridaApp)からダウンロードしてください（app-release.apkをダウンロード）。

### インストール
```
pip3 install objection
```
### 接続

通常のADB接続を作成し、デバイスでfridaサーバーを起動します（クライアントとサーバーの両方でfridaが動作していることを確認します）。

ルート化されたデバイスを使用している場合、テストしたいアプリケーションを`--gadget`オプションで選択する必要があります。この場合は以下のようになります：
```
objection --gadget asvid.github.io.fridaapp explore
```
### 基本的なアクション

このチュートリアルでは、objectionの可能なすべてのコマンドをリストアップするわけではありません。代わりに、私がより有用と考えるコマンドのみを紹介します。

#### 環境

環境内には、パスワードやパスなどの興味深い情報が含まれている場合があります。
```
env
```
![](<../../../.gitbook/assets/image (64).png>)

#### Fridaの情報

Frida is a dynamic instrumentation toolkit for developers, reverse-engineers, and security researchers. It allows you to inject JavaScript code into native apps on Windows, macOS, Linux, iOS, and Android. With Frida, you can dynamically modify the behavior of an app, intercept function calls, and access sensitive data.

Fridaは、開発者、リバースエンジニア、セキュリティ研究者向けのダイナミックインストルメンテーションツールキットです。Windows、macOS、Linux、iOS、Android上のネイティブアプリにJavaScriptコードを注入することができます。Fridaを使用すると、アプリの動作を動的に変更したり、関数呼び出しを傍受したり、機密データにアクセスしたりすることができます。

#### Objection Information

Objection is a runtime mobile exploration toolkit powered by Frida. It allows you to perform various tasks on Android and iOS apps, such as bypassing SSL pinning, manipulating runtime behavior, and exploring the app's internal structure. Objection provides an interactive shell that allows you to interact with the app's runtime environment and perform actions like listing loaded classes, invoking methods, and inspecting objects.

Objectionは、Fridaによってパワードされたランタイムモバイルエクスプロレーションツールキットです。SSLピニングのバイパス、ランタイムの動作の操作、アプリの内部構造の調査など、AndroidとiOSアプリでさまざまなタスクを実行することができます。Objectionは、対話型シェルを提供し、アプリのランタイム環境と対話し、ロードされたクラスのリスト表示、メソッドの呼び出し、オブジェクトの検査などのアクションを実行することができます。

#### Objection Installation

To install Objection, you need to have Frida installed on your machine. Once you have Frida installed, you can install Objection using pip:

```plaintext
pip install objection
```

Objectionのインストール

Objectionをインストールするには、マシンにFridaがインストールされている必要があります。Fridaがインストールされている場合は、pipを使用してObjectionをインストールできます。

```plaintext
pip install objection
```

#### Objection Usage

To use Objection, you first need to start the Frida server on the target device. You can do this by running the following command:

```plaintext
frida-server -D
```

Once the Frida server is running, you can connect to the target device using Objection:

```plaintext
objection -g <device_ip>:<frida_server_port>
```

Objectionの使用方法

Objectionを使用するには、まず対象デバイスでFridaサーバーを起動する必要があります。次のコマンドを実行することでこれを行うことができます。

```plaintext
frida-server -D
```

Fridaサーバーが実行されている場合、Objectionを使用して対象デバイスに接続できます。

```plaintext
objection -g <device_ip>:<frida_server_port>
```

#### Objection Features

Objection provides a wide range of features to assist in mobile app pentesting. Some of the key features include:

- **SSL Pinning Bypass**: Objection can bypass SSL pinning in Android and iOS apps, allowing you to intercept and modify network traffic.
- **Runtime Manipulation**: Objection allows you to manipulate the runtime behavior of an app, such as modifying method return values or hooking methods to perform custom actions.
- **Code Injection**: Objection supports code injection, allowing you to inject custom code into an app's runtime environment.
- **Data Exploration**: Objection provides commands to explore an app's internal structure, such as listing loaded classes, invoking methods, and inspecting objects.
- **Automatic Hooking**: Objection can automatically hook methods in an app, making it easier to intercept function calls and modify their behavior.

Objectionの機能

Objectionは、モバイルアプリのペントestingを支援するさまざまな機能を提供しています。主な機能には以下があります。

- **SSLピニングバイパス**：ObjectionはAndroidとiOSアプリでSSLピニングをバイパスし、ネットワークトラフィックを傍受して変更することができます。
- **ランタイムの操作**：Objectionを使用すると、アプリのランタイム動作を操作することができます。たとえば、メソッドの返り値を変更したり、カスタムアクションを実行するためにメソッドをフックしたりすることができます。
- **コードインジェクション**：Objectionはコードインジェクションをサポートしており、カスタムコードをアプリのランタイム環境に注入することができます。
- **データの調査**：Objectionは、ロードされたクラスのリスト表示、メソッドの呼び出し、オブジェクトの検査など、アプリの内部構造を調査するためのコマンドを提供しています。
- **自動フック**：Objectionはアプリ内のメソッドを自動的にフックすることができ、関数呼び出しを傍受し、動作を変更することが容易になります。
```
frida
```
![](<../../../.gitbook/assets/image (65).png>)

#### アップロード/ダウンロード
```bash
file download <remote path> [<local path>]
file upload <local path> [<remote path>]
```
#### Fridaスクリプトのインポート

```javascript
const script = await Session.createScript(`
    // Your Frida script code here
`);
```

Fridaスクリプトをインポートするためのコードです。

```javascript
const script = await Session.createScript(`
    // ここにFridaスクリプトのコードを記述します
`);
```
```bash
import <local path frida-script>
```
#### SSLピニング

SSLPinningは、Androidアプリのセキュリティ機能の一つです。SSLピニングは、アプリが通信するサーバーの証明書を事前に指定し、その証明書以外のものを受け入れないようにします。これにより、中間者攻撃や証明書の偽造などのセキュリティリスクを軽減することができます。

SSLPinningをバイパスするためには、Fridaというツールを使用することができます。Fridaは、アプリのランタイムをダイナミックに変更することができる強力なツールです。ObjectionというFridaのプラグインを使用すると、簡単にSSLピニングをバイパスすることができます。

以下のコマンドを使用して、Objectionをインストールします。

```
pip install objection
```

Objectionを使用すると、アプリの実行中にSSLピニングをバイパスすることができます。以下のコマンドを使用して、Objectionを起動します。

```
objection explore
```

Objectionが起動したら、以下のコマンドを使用してSSLピニングをバイパスします。

```
android sslpinning disable
```

これにより、アプリがSSLピニングを無効化し、通信先のサーバーの証明書を検証しなくなります。ただし、SSLピニングをバイパスすることはセキュリティ上のリスクを伴うため、慎重に行う必要があります。

以上がSSLピニングについての簡単な説明と、Objectionを使用してSSLピニングをバイパスする方法です。
```bash
android sslpinning disable #Attempts to disable SSL Pinning on Android devices.
```
#### ルート検出

Root検出は、Androidアプリがルート化されたデバイス上で実行されているかどうかを検出するための技術です。ルート化されたデバイスでは、アプリが通常よりも高い特権を持つことができ、セキュリティ上のリスクが増加します。アプリ開発者は、ルート化されたデバイス上でアプリが実行されることを防ぐために、ルート検出メカニズムを実装することがあります。

Root検出は、さまざまな方法で実装することができます。一般的な手法には、ファイルの存在チェック、システムプロパティのチェック、バイナリの署名チェックなどがあります。これらの手法は、アプリがルート化されたデバイス上で実行されているかどうかを判断するために使用されます。

ルート検出は、アプリのセキュリティを向上させるために重要な役割を果たします。ルート化されたデバイス上でアプリが実行されることは、攻撃者にとっては便利な手段となります。したがって、アプリ開発者は、ルート検出メカニズムを実装することで、アプリのセキュリティを強化することが求められます。
```bash
android root disable  #Attempts to disable root detection on Android devices.
android root simulate #Attempts to simulate a rooted Android environment.
```
#### Execコマンド

The `exec` command in Objection allows you to execute arbitrary shell commands on the target Android device. This can be useful for performing various actions during a mobile penetration test.

To use the `exec` command, you need to have a Frida session established with the target application. Once you have a session, you can run the following command:

```
objection> exec <command>
```

Replace `<command>` with the shell command you want to execute. For example, if you want to list the files in the current directory, you can use the `ls` command:

```
objection> exec ls
```

The output of the command will be displayed in the Objection console.

It's important to note that the `exec` command runs the shell command on the target device, not on your local machine. This means that you can execute commands that are specific to the target device's operating system.

Be cautious when using the `exec` command, as executing certain commands can have unintended consequences or may be considered malicious. Always ensure that you have proper authorization and follow ethical guidelines when performing mobile penetration testing.
```bash
android shell_exec whoami
```
#### スクリーンショット

```html
<img src="https://example.com/screenshot1.png" alt="Screenshot 1">
<img src="https://example.com/screenshot2.png" alt="Screenshot 2">
```

#### スクリーンショット

```html
<img src="https://example.com/screenshot1.png" alt="スクリーンショット 1">
<img src="https://example.com/screenshot2.png" alt="スクリーンショット 2">
```
```bash
android ui screenshot /tmp/screenshot
android ui FLAG_SECURE false  #This may enable you to take screenshots using the hardware keys
```
### 静的解析を動的に行う

実際のアプリケーションでは、**静的解析**によってこの部分で発見された情報をすべて把握してから、objectionを使用する必要があります。とはいえ、ここではクラス、メソッド、およびエクスポートされたオブジェクトの完全なリストしか持っていないため、**新しい情報**が見つかるかもしれません。

また、アプリの**読みやすいソースコードを取得できない**場合にも役立ちます。

#### アクティビティ、レシーバー、およびサービスのリストを表示する
```
android hooking list activities
```
![](<../../../.gitbook/assets/image (78).png>)

# Objection Tutorial

Objection is a runtime mobile exploration toolkit, powered by Frida. It allows you to perform various tasks on Android devices, such as:

- Bypassing SSL pinning
- Interacting with the application's SQLite database
- Manipulating method return values
- Hooking and tampering with method calls
- Inspecting and modifying network requests
- Decrypting encrypted traffic
- And much more!

In this tutorial, we will cover the basics of using Objection to perform runtime analysis and manipulation of Android applications.

## Prerequisites

Before we begin, make sure you have the following:

- A rooted Android device or an emulator
- Frida Server installed on the device
- Objection installed on your local machine

## Installing Frida Server

To install Frida Server on your Android device, follow these steps:

1. Download the latest version of Frida Server from the official Frida releases page.
2. Transfer the downloaded file to your Android device.
3. Open a terminal and navigate to the directory where the Frida Server file is located.
4. Install the Frida Server APK by running the following command:

```plaintext
adb install frida-server-<version>.apk
```

5. Start the Frida Server by running the following command:

```plaintext
adb shell su -c "frida-server"
```

## Installing Objection

To install Objection on your local machine, follow these steps:

1. Install Node.js if you haven't already.
2. Open a terminal and run the following command to install Objection:

```plaintext
npm install -g objection
```

## Connecting to the Device

To connect Objection to your Android device, follow these steps:

1. Make sure the Frida Server is running on your device.
2. Connect your device to your local machine using a USB cable.
3. Open a terminal and run the following command to start the Objection console:

```plaintext
objection
```

4. Once the console is open, run the following command to connect to the device:

```plaintext
android connect
```

## Basic Usage

Now that you are connected to the device, you can start using Objection to perform various tasks. Here are some basic commands to get you started:

- `help`: Display the available commands and their descriptions.
- `ios`: Switch to iOS mode (if you have an iOS device connected).
- `exit`: Exit the Objection console.

## Conclusion

In this tutorial, we have learned how to install and use Objection for runtime analysis and manipulation of Android applications. Objection provides a powerful set of tools for mobile pentesting and can be used to perform a wide range of tasks. Experiment with the different features of Objection to discover its full potential. Happy hacking!
```
android hooking list services
android hooking list receivers
```
Fridaは、見つからない場合にエラーを発生させます。

#### 現在のアクティビティの取得
```
android hooking get current_activity
```
#### クラスの検索

アプリケーション内のクラスを検索しましょう。
```
android hooking search classes asvid.github.io.fridaapp
```
![](<../../../.gitbook/assets/image (69).png>)

#### クラスの検索方法

では、クラス_MainActivity_内のメソッドを抽出してみましょう。
```
android hooking search methods asvid.github.io.fridaapp MainActivity
```
![](<../../../.gitbook/assets/image (70) (1).png>)

#### クラスの宣言されたメソッドとそのパラメータの一覧

クラスのメソッドがどのようなパラメータを必要とするかを調べましょう：
```
android hooking list class_methods asvid.github.io.fridaapp.MainActivity
```
![](<../../../.gitbook/assets/image (79).png>)

#### クラスの一覧表示

現在のアプリケーション内でロードされたすべてのクラスを一覧表示することもできます。
```
android hooking list classes #List all loaded classes, As the target application gets usedmore, this command will return more classes.
```
これは、クラスのメソッドをフックしたいが、クラスの名前しか知らない場合に非常に便利です。この関数を使用して、クラスを所有するモジュールを検索し、そのメソッドをフックすることができます。

### フックは簡単です

#### メソッドのフック（監視）

アプリケーションの[ソースコード](https://github.com/asvid/FridaApp/blob/master/app/src/main/java/asvid/github/io/fridaapp/MainActivity.kt)から、_MainActivity_ の **_sum()_** 関数が **1秒ごとに実行**されていることがわかります。関数が呼び出されるたびに（引数、戻り値、バックトレースを含む）**可能な情報をすべてダンプ**してみましょう。
```
android hooking watch class_method asvid.github.io.fridaapp.MainActivity.sum --dump-args --dump-backtrace --dump-return
```
![](<../../../.gitbook/assets/image (71).png>)

#### クラス全体のフック（監視）

実際には、MainActivityクラスのすべてのメソッドが非常に興味深いと思いますので、**すべてのメソッドをフック**してみましょう。ただし、これはアプリケーションを**クラッシュ**させる可能性があるため、注意が必要です。
```
android hooking watch class asvid.github.io.fridaapp.MainActivity --dump-args --dump-return
```
アプリケーションを操作すると、クラスがフックされているときに、**各関数が呼び出される**タイミング、**引数**、および**戻り値**が表示されます。

![](<../../../.gitbook/assets/image (72).png>)

#### 関数の真偽値の返り値を変更する

ソースコードから、関数_checkPin_は引数として_String_を受け取り、_boolean_を返すことがわかります。関数を**常にtrueを返すように**します。

![](<../../../.gitbook/assets/image (74).png>)

これで、PINコードのテキストボックスに何かを入力すると、何でも有効であることがわかります。

![](<../../../.gitbook/assets/image (77).png>)

### クラスのインスタンス

特定のJavaクラスの**ライブインスタンス**を検索し、出力は通常、オブジェクトのプロパティ値を**含む発見されたobjectionの文字列値**を取得しようとした結果です。
```
android heap print_instances <class>
```
![](<../../../.gitbook/assets/image (80).png>)

### Keystore/Intents

キーストアとインテントを使用して遊ぶことができます。以下のコマンドを使用します。
```
android keystore list
android intents launch_activity
android intent launch_service
```
#### メモリ

##### ダンプ

```bash
# メモリダンプの作成
objection -g com.example.app explore
memory dump dump.bin
```

メモリダンプを作成するためのコマンドです。
```bash
memory dump all <local destination> #Dump all memory
memory dump from_base <base_address> <size_to_dump> <local_destination> #Dump a part
```
#### リスト
```
memory list modules
```
![](<../../../.gitbook/assets/image (66).png>)

リストの一番下にはfridaがあります：

![](<../../../.gitbook/assets/image (67).png>)

fridaがエクスポートしているものを確認しましょう：

![](<../../../.gitbook/assets/image (68).png>)

#### 検索/書き込み

objectionを使用してメモリ内で検索や書き込みもできます：
```
memory search "<pattern eg: 41 41 41 ?? 41>" (--string) (--offsets-only)
memory write "<address>" "<pattern eg: 41 41 41 41>" (--string)
```
### SQLite

SQLiteデータベースとのやり取りには、`sqlite`コマンドを使用できます。

### 終了
```
exit
```
## Objectionで欠けているもの

* フックメソッドはアプリケーションをクラッシュさせることがあります（これはFridaのせいでもあります）。
* クラスのインスタンスを使用してインスタンスの関数を呼び出すことはできません。また、新しいクラスのインスタンスを作成してそれらを使用して関数を呼び出すこともできません。
* アプリケーションで使用されている一般的な暗号化メソッドをフックして、暗号化されたテキスト、平文、キー、IV、および使用されているアルゴリズムを表示するためのショートカット（sslpinninのようなもの）はありません。



<img src="../../../.gitbook/assets/i3.png" alt="" data-size="original">

**バグバウンティのヒント**：ハッカーによって作成されたプレミアムのバグバウンティプラットフォームである**Intigriti**に**サインアップ**してください！今すぐ[**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks)に参加して、最大**$100,000**のバウンティを獲得しましょう！

{% embed url="https://go.intigriti.com/hacktricks" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks Cloud ☁️</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>🐦 Twitter 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 Youtube 🎥</strong></a></summary>

* **サイバーセキュリティ企業**で働いていますか？ **HackTricksで会社を宣伝**したいですか？または、**最新バージョンのPEASSを入手**したいですか？または、HackTricksをPDFでダウンロードしたいですか？[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を見つけてください。独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクションです。
* [**公式のPEASS＆HackTricksのグッズ**](https://peass.creator-spring.com)を手に入れましょう。
* [**💬**](https://emojipedia.org/speech-balloon/) [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**telegramグループ**](https://t.me/peass)に**参加**するか、**Twitter**で**フォロー**してください[**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**。**
* **ハッキングのトリックを共有するには、[hacktricksリポジトリ](https://github.com/carlospolop/hacktricks)と[hacktricks-cloudリポジトリ](https://github.com/carlospolop/hacktricks-cloud)にPRを提出してください**。

</details>
