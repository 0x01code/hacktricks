# Tutorial di Objection

<details>

<summary><strong>Impara l'hacking di AWS da zero a eroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Esperto Red Team AWS di HackTricks)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se vuoi vedere la tua **azienda pubblicizzata in HackTricks** o **scaricare HackTricks in PDF** Controlla i [**PIANI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale di PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**La Famiglia PEASS**](https://opensea.io/collection/the-peass-family), la nostra collezione di [**NFT esclusivi**](https://opensea.io/collection/the-peass-family)
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR a** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos di github.

</details>

<img src="../../../.gitbook/assets/i3.png" alt="" data-size="original">

**Suggerimento per il bug bounty**: **iscriviti** a **Intigriti**, una piattaforma premium per **bug bounty creata da hacker, per hacker**! Unisciti a noi su [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) oggi e inizia a guadagnare taglie fino a **$100,000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

## **Introduzione**

**objection - Esplorazione Mobile in Runtime**

[**Objection**](https://github.com/sensepost/objection) √® un toolkit di esplorazione mobile in runtime, alimentato da [Frida](https://www.frida.re). √à stato creato con l'obiettivo di aiutare a valutare le applicazioni mobili e la loro postura di sicurezza senza la necessit√† di un dispositivo mobile jailbroken o con permessi di root.

**Nota:** Questo non √® una forma di bypass di jailbreak / root. Utilizzando `objection`, sei comunque limitato da tutte le restrizioni imposte dal sandbox applicabile che stai affrontando.

### Riassunto

L'**obiettivo** di **objection** √® consentire all'utente di chiamare le **azioni principali offerte da Frida**. **Altrimenti**, l'utente dovr√† creare uno **script separato per ogni applicazione** che desidera testare.

## Tutorial

Per questo tutorial user√≤ l'APK che puoi scaricare qui:

{% file src="../../../.gitbook/assets/app-release.zip" %}

O dal suo [repository originale](https://github.com/asvid/FridaApp) (scarica app-release.apk)

### Installazione
```bash
pip3 install objection
```
### Connessione

Effettua una **connessione ADB regolare** e **avvia** il server **frida** sul dispositivo (e verifica che frida funzioni sia nel client che nel server).

Se stai utilizzando un **dispositivo con root**, √® necessario selezionare l'applicazione che desideri testare all'interno dell'opzione _**--gadget**_. in questo caso:
```bash
frida-ps -Uai
objection --gadget asvid.github.io.fridaapp explore
```
### Azioni di Base

Non tutti i comandi possibili di Objection verranno elencati in questo tutorial, solo quelli che ho trovato pi√π utili.

#### Ambiente

Alcune informazioni interessanti (come password o percorsi) potrebbero essere trovate all'interno dell'ambiente.
```bash
env
```
![](<../../../.gitbook/assets/image (220).png>)

#### Informazioni su Frida
```bash
frida
```
![](<../../../.gitbook/assets/image (1093).png>)

#### Caricamento/Scaricamento
```bash
file download <remote path> [<local path>]
file upload <local path> [<remote path>]
```
#### Importa lo script di frida
```bash
import <local path frida-script>
```
#### SSLPinning
```bash
android sslpinning disable #Attempts to disable SSL Pinning on Android devices.
```
#### Rilevamento del root
```bash
android root disable  #Attempts to disable root detection on Android devices.
android root simulate #Attempts to simulate a rooted Android environment.
```
#### Comando Exec
```bash
android shell_exec whoami
```
#### Schermate
```bash
android ui screenshot /tmp/screenshot
android ui FLAG_SECURE false  #This may enable you to take screenshots using the hardware keys
```
### Analisi statica resa dinamica

In un'applicazione reale dovremmo conoscere tutte le informazioni scoperte in questa parte prima di utilizzare objection grazie all'**analisi statica**. Comunque, in questo modo forse potrai vedere **qualcosa di nuovo** poich√© qui avrai solo un elenco completo di classi, metodi e oggetti esportati.

Questo √® anche utile se in qualche modo non riesci a ottenere del codice sorgente leggibile dell'applicazione.

#### Elenca attivit√†, ricevitori e servizi
```bash
android hooking list activities
```
![](<../../../.gitbook/assets/image (1016).png>)
```bash
android hooking list services
android hooking list receivers
```
Frida lancer√† un errore se nessuna attivit√† viene trovata

#### Ottenere l'attivit√† corrente
```bash
android hooking get current_activity
```
![](<../../../.gitbook/assets/image (813).png>)

#### Cerca Classi

Iniziamo a cercare le classi all'interno della nostra applicazione
```bash
android hooking search classes asvid.github.io.fridaapp
```
![](<../../../.gitbook/assets/image (507).png>)

#### Metodi di ricerca di una classe

Ora estraiamo i metodi all'interno della classe _MainActivity:_
```bash
android hooking search methods asvid.github.io.fridaapp MainActivity
```
![](<../../../.gitbook/assets/image (929).png>)

#### Elenco dei metodi dichiarati di una classe con i relativi parametri

Scopriamo di quali parametri hanno bisogno i metodi della classe:
```bash
android hooking list class_methods asvid.github.io.fridaapp.MainActivity
```
![](<../../../.gitbook/assets/image (299).png>)

#### Elenco delle classi

√à possibile anche elencare tutte le classi che sono state caricate all'interno dell'applicazione corrente:
```bash
android hooking list classes #List all loaded classes, As the target application gets usedmore, this command will return more classes.
```
Questo √® molto utile se vuoi **agganciare il metodo di una classe e conosci solo il nome della classe**. Potresti usare questa funzione per **cercare quale modulo possiede la classe** e poi agganciare il suo metodo.

### Facilit√† nell'agganciare

#### Agganciare (osservare) un metodo

Dal [codice sorgente](https://github.com/asvid/FridaApp/blob/master/app/src/main/java/asvid/github/io/fridaapp/MainActivity.kt) dell'applicazione sappiamo che la **funzione** _**sum()**_ **di** _**MainActivity**_ viene eseguita **ogni secondo**. Proviamo a **dumpare tutte le informazioni possibili** ogni volta che la funzione viene chiamata (argomenti, valore di ritorno e backtrace):
```bash
android hooking watch class_method asvid.github.io.fridaapp.MainActivity.sum --dump-args --dump-backtrace --dump-return
```
![](<../../../.gitbook/assets/image (1086).png>)

#### Hooking (watching) an entire class

In realt√† trovo tutti i metodi della classe MainActivity molto interessanti, vediamo **hookarli tutti**. Fai attenzione, questo potrebbe **far crashare** un'applicazione.
```bash
android hooking watch class asvid.github.io.fridaapp.MainActivity --dump-args --dump-return
```
Se giochi con l'applicazione mentre la classe √® agganciata, vedrai quando **viene chiamata ogni funzione**, i suoi **argomenti** e il **valore di ritorno**.

![](<../../../.gitbook/assets/image (861).png>)

#### Cambiare il valore di ritorno booleano di una funzione

Dal codice sorgente puoi vedere che la funzione _checkPin_ riceve una _Stringa_ come argomento e restituisce un _booleano_. Facciamo in modo che la funzione **restituisca sempre true**:

![](<../../../.gitbook/assets/image (883).png>)

Ora, se scrivi qualcosa nella casella di testo per il codice PIN, vedrai che qualsiasi cosa √® valida:

![](<../../../.gitbook/assets/image (228).png>)

### Istanze di classe

Cerca e stampa **istanze attive di una specifica classe Java**, specificata da un nome di classe completamente qualificato. Out √® il risultato di un tentativo di ottenere un valore di stringa per un'obiezione scoperta che tipicamente **contiene valori delle propriet√† per l'oggetto**.
```
android heap print_instances <class>
```
![](<../../../.gitbook/assets/image (1095).png>)

### Keystore/Intents

Puoi giocare con il keystore e gli intents usando:
```bash
android keystore list
android intents launch_activity
android intent launch_service
```
### Memoria

#### Dump
```bash
memory dump all <local destination> #Dump all memory
memory dump from_base <base_address> <size_to_dump> <local_destination> #Dump a part
```
#### Elenco
```bash
memory list modules
```
![](<../../../.gitbook/assets/image (286).png>)

In fondo alla lista puoi vedere frida:

![](<../../../.gitbook/assets/image (1097).png>)

Controlliamo cosa sta esportando frida:

![](<../../../.gitbook/assets/image (298).png>)

#### Ricerca/Scrittura

Puoi anche cercare e scrivere nella memoria con objection:
```bash
memory search "<pattern eg: 41 41 41 ?? 41>" (--string) (--offsets-only)
memory write "<address>" "<pattern eg: 41 41 41 41>" (--string)
```
### SQLite

Puoi utilizzare il comando `sqlite` per interagire con i database sqlite.

### Exit
```bash
exit
```
## Cosa manca in Objection

* I metodi di hooking a volte fanno crashare l'applicazione (questo √® anche a causa di Frida).
* Non √® possibile utilizzare le istanze delle classi per chiamare le funzioni dell'istanza. E non √® possibile creare nuove istanze di classi e usarle per chiamare funzioni.
* Non esiste una scorciatoia (come quella per sslpinnin) per hookare tutti i metodi crittografici comuni utilizzati dall'applicazione per vedere testo cifrato, testo in chiaro, chiavi, IV e algoritmi utilizzati.

<img src="../../../.gitbook/assets/i3.png" alt="" data-size="original">

**Suggerimento per bug bounty**: **iscriviti** a **Intigriti**, una piattaforma premium per **bug bounty creata da hacker, per hacker**! Unisciti a noi su [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) oggi e inizia a guadagnare taglie fino a **$100,000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

<details>

<summary><strong>Impara l'hacking di AWS da zero a eroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se vuoi vedere la tua **azienda pubblicizzata in HackTricks** o **scaricare HackTricks in PDF** Controlla i [**PIANI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**The PEASS Family**](https://opensea.io/collection/the-peass-family), la nostra collezione di esclusive [**NFT**](https://opensea.io/collection/the-peass-family)
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR ai** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
