# Tutoriel Objection

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Travaillez-vous dans une **entreprise de cybers√©curit√©** ? Voulez-vous voir votre **entreprise annonc√©e dans HackTricks** ? ou voulez-vous avoir acc√®s √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**üí¨**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR au [repo hacktricks](https://github.com/carlospolop/hacktricks) et au [repo hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>

<img src="../../../.gitbook/assets/i3.png" alt="" data-size="original">

**Astuce de prime de bug** : **inscrivez-vous** √† **Intigriti**, une plateforme de prime de bug premium cr√©√©e par des pirates, pour les pirates ! Rejoignez-nous sur [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) aujourd'hui et commencez √† gagner des primes allant jusqu'√† **100 000 $** !

{% embed url="https://go.intigriti.com/hacktricks" %}

## **Introduction**

[![objection](https://github.com/sensepost/objection/raw/master/images/objection.png)](https://github.com/sensepost/objection)

**objection - Exploration mobile en temps d'ex√©cution**

`objection` est une trousse d'exploration mobile en temps d'ex√©cution, aliment√©e par [Frida](https://www.frida.re). Elle a √©t√© construite dans le but d'aider √† √©valuer les applications mobiles et leur posture de s√©curit√© sans avoir besoin d'un appareil mobile jailbreak√© ou root√©.

**Note :** Il ne s'agit pas d'une forme de contournement de jailbreak / root. En utilisant `objection`, vous √™tes toujours limit√© par toutes les restrictions impos√©es par le bac √† sable applicable auquel vous √™tes confront√©.

### R√©sum√©

Le **but** d'**objection** est de permettre √† l'utilisateur d'appeler les **principales actions offertes par Frida**. **Sinon**, l'utilisateur devra cr√©er un **script unique pour chaque application** qu'il souhaite tester.

## Tutoriel

Pour ce tutoriel, je vais utiliser l'APK que vous pouvez t√©l√©charger ici :

{% file src="../../../.gitbook/assets/app-release.zip" %}

Ou depuis son [d√©p√¥t original](https://github.com/asvid/FridaApp)(t√©l√©chargez app-release.apk)

### Installation
```
pip3 install objection
```
### Connexion

√âtablissez une **connexion ADB r√©guli√®re** et **d√©marrez** le serveur **frida** sur l'appareil (et v√©rifiez que frida fonctionne √† la fois sur le client et le serveur).

Si vous utilisez un **appareil root√©**, il est n√©cessaire de s√©lectionner l'application que vous souhaitez tester dans l'option _**--gadget**_. Dans ce cas :
```
objection --gadget asvid.github.io.fridaapp explore
```
### Actions de base

Toutes les commandes possibles d'Objection ne seront pas r√©pertori√©es dans ce tutoriel, seulement celles que j'ai trouv√©es les plus utiles.

#### Environnement

Certaines informations int√©ressantes (comme les mots de passe ou les chemins d'acc√®s) peuvent √™tre trouv√©es dans l'environnement.
```
env
```
#### Informations sur Frida

Frida is a dynamic instrumentation tool that allows you to inject JavaScript or your own library into native apps on Windows, macOS, GNU/Linux, iOS, Android, and QNX. It supports a wide range of architectures, including ARM, x86, MIPS, and SPARC.

Frida est un outil d'instrumentation dynamique qui vous permet d'injecter du JavaScript ou votre propre biblioth√®que dans des applications natives sur Windows, macOS, GNU/Linux, iOS, Android et QNX. Il prend en charge une large gamme d'architectures, y compris ARM, x86, MIPS et SPARC. 

Objection is a runtime mobile exploration toolkit, powered by Frida. It was built with the aim of helping assess mobile applications and their security posture without the need for a jailbroken or rooted mobile device.

Objection est une bo√Æte √† outils d'exploration mobile en temps d'ex√©cution, aliment√©e par Frida. Elle a √©t√© construite dans le but d'aider √† √©valuer les applications mobiles et leur posture de s√©curit√© sans avoir besoin d'un appareil mobile jailbreak√© ou root√©.
```
frida
```
#### T√©l√©chargement/T√©l√©versement
```bash
file download <remote path> [<local path>]
file upload <local path> [<remote path>]
```
#### Importer le script frida
```bash
import <local path frida-script>
```
#### SSLPinning

#### SSLPinning

Le SSL Pinning est une technique de s√©curit√© qui consiste √† v√©rifier si le certificat SSL pr√©sent√© par le serveur correspond √† celui attendu par l'application. Cette technique est utilis√©e pour emp√™cher les attaques de type Man-in-the-Middle (MITM) qui pourraient compromettre la confidentialit√© et l'int√©grit√© des donn√©es √©chang√©es entre l'application et le serveur. 

Lorsque le SSL Pinning est activ√©, l'application ne fera confiance qu'aux certificats SSL sp√©cifiques qu'elle a √©t√© configur√©e pour accepter. Si un certificat SSL diff√©rent est pr√©sent√©, l'application refusera la connexion. 

Le SSL Pinning peut √™tre contourn√© en utilisant des outils tels que Frida pour intercepter et modifier les appels SSL. Cependant, cela n√©cessite des comp√©tences techniques avanc√©es et peut √™tre d√©tect√© par des m√©canismes de d√©tection de fraude.
```bash
android sslpinning disable #Attempts to disable SSL Pinning on Android devices.
```
#### D√©tection de root
```bash
android root disable  #Attempts to disable root detection on Android devices.
android root simulate #Attempts to simulate a rooted Android environment.
```
#### Commande Exec
```bash
android shell_exec whoami
```
#### Captures d'√©cran
```bash
android ui screenshot /tmp/screenshot
android ui FLAG_SECURE false  #This may enable you to take screenshots using the hardware keys
```
### Analyse statique rendue dynamique

Dans une application r√©elle, nous devrions conna√Ætre toutes les informations d√©couvertes dans cette partie avant d'utiliser objection gr√¢ce √† l'**analyse statique**. Quoi qu'il en soit, de cette fa√ßon, vous pouvez peut-√™tre voir **quelque chose de nouveau**, car vous aurez ici une liste compl√®te de classes, de m√©thodes et d'objets export√©s.

Cela est √©galement utile si, d'une mani√®re ou d'une autre, vous √™tes **incapable d'obtenir un code source lisible** de l'application.

#### Liste des activit√©s, des r√©cepteurs et des services
```
android hooking list activities
```
![](<../../../.gitbook/assets/image (78).png>)

Vous √™tes un hacker professionnel, traducteur et √©crivain. Vous √©crivez tout de mani√®re tr√®s claire et aussi concise que possible sans perdre d'informations.
```
android hooking list services
android hooking list receivers
```
Frida affichera une erreur si aucune activit√© n'est trouv√©e.

#### Obtenir l'activit√© en cours
```
android hooking get current_activity
```
#### Recherche de classes

Commen√ßons par chercher les classes √† l'int√©rieur de notre application.
```
android hooking search classes asvid.github.io.fridaapp
```
#### M√©thodes de recherche d'une classe

Maintenant, extrayons les m√©thodes √† l'int√©rieur de la classe _MainActivity:_
```
android hooking search methods asvid.github.io.fridaapp MainActivity
```
#### Liste des m√©thodes d√©clar√©es d'une classe avec leurs param√®tres

Voyons quels sont les param√®tres n√©cessaires pour les m√©thodes de la classe :
```
android hooking list class_methods asvid.github.io.fridaapp.MainActivity
```
#### Liste des classes

Vous pouvez √©galement lister toutes les classes qui ont √©t√© charg√©es dans l'application actuelle :
```
android hooking list classes #List all loaded classes, As the target application gets usedmore, this command will return more classes.
```
Ceci est tr√®s utile si vous voulez **accrocher la m√©thode d'une classe et que vous ne connaissez que le nom de la classe**. Vous pouvez utiliser cette fonction pour **rechercher quel module poss√®de la classe** et ensuite accrocher sa m√©thode.

### Accrocher √©tant facile

#### Accrocher (surveiller) une m√©thode

√Ä partir du [code source](https://github.com/asvid/FridaApp/blob/master/app/src/main/java/asvid/github/io/fridaapp/MainActivity.kt) de l'application, nous savons que la **fonction** _**sum()**_ **de** _**MainActivity**_ est ex√©cut√©e **toutes les secondes**. Essayons de **dumper toutes les informations possibles** √† chaque fois que la fonction est appel√©e (arguments, valeur de retour et backtrace):
```
android hooking watch class_method asvid.github.io.fridaapp.MainActivity.sum --dump-args --dump-backtrace --dump-return
```
#### Accrochage (surveillance) d'une classe enti√®re

En fait, je trouve tous les m√©thodes de la classe MainActivity vraiment int√©ressantes, accrochons-les toutes. Soyez prudent, cela pourrait faire **planter** une application.
```
android hooking watch class asvid.github.io.fridaapp.MainActivity --dump-args --dump-return
```
Si vous jouez avec l'application pendant que la classe est accroch√©e, vous verrez quand **chaque fonction est appel√©e**, ses **arguments** et la valeur de **retour**.

![](<../../../.gitbook/assets/image (72).png>)

#### Changer la valeur de retour bool√©enne d'une fonction

√Ä partir du code source, vous pouvez voir que la fonction _checkPin_ re√ßoit une cha√Æne de caract√®res en argument et renvoie un bool√©en. Faisons en sorte que la fonction **renvoie toujours vrai** :

![](<../../../.gitbook/assets/image (74).png>)

Maintenant, si vous √©crivez n'importe quoi dans la zone de texte pour le code PIN, vous verrez que tout est valide :

![](<../../../.gitbook/assets/image (77).png>)

### Instances de classe

Recherchez et imprimez les **instances en direct d'une classe Java sp√©cifique**, sp√©cifi√©e par un nom de classe enti√®rement qualifi√©. Out est le r√©sultat d'une tentative d'obtenir une valeur de cha√Æne pour une objection d√©couverte qui contiendrait g√©n√©ralement des valeurs de propri√©t√© pour l'objet.
```
android heap print_instances <class>
```
### Keystore/Intents

Vous pouvez jouer avec le keystore et les intents en utilisant:
```
android keystore list
android intents launch_activity
android intent launch_service
```
### M√©moire

#### Extraction
```bash
memory dump all <local destination> #Dump all memory
memory dump from_base <base_address> <size_to_dump> <local_destination> #Dump a part
```
#### Liste
```
memory list modules
```
![](<../../../.gitbook/assets/image (66).png>)

En bas de la liste, vous pouvez voir frida :

![](<../../../.gitbook/assets/image (67).png>)

Voyons ce que frida exporte :

![](<../../../.gitbook/assets/image (68).png>)

#### Recherche/√âcriture

Vous pouvez √©galement rechercher et √©crire dans la m√©moire avec objection :
```
memory search "<pattern eg: 41 41 41 ?? 41>" (--string) (--offsets-only)
memory write "<address>" "<pattern eg: 41 41 41 41>" (--string)
```
### SQLite

Vous pouvez utiliser la commande `sqlite` pour interagir avec les bases de donn√©es SQLite.

### Sortie
```
exit
```
## Ce qui manque dans Objection

* Les m√©thodes de hooking font parfois planter l'application (cela est √©galement d√ª √† Frida).
* Vous ne pouvez pas utiliser les instances des classes pour appeler les fonctions de l'instance. Et vous ne pouvez pas cr√©er de nouvelles instances de classes et les utiliser pour appeler des fonctions.
* Il n'y a pas de raccourci (comme celui pour sslpinnin) pour hooker toutes les m√©thodes de cryptographie courantes utilis√©es par l'application afin de voir le texte chiffr√©, le texte en clair, les cl√©s, les IV et les algorithmes utilis√©s.



<img src="../../../.gitbook/assets/i3.png" alt="" data-size="original">

**Astuce pour les chasseurs de bugs**: **inscrivez-vous** sur **Intigriti**, une plateforme de **chasse aux bugs premium cr√©√©e par des hackers, pour des hackers**! Rejoignez-nous sur [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) d√®s aujourd'hui et commencez √† gagner des primes allant jusqu'√† **100 000 $**!

{% embed url="https://go.intigriti.com/hacktricks" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Travaillez-vous dans une **entreprise de cybers√©curit√©**? Voulez-vous voir votre **entreprise annonc√©e dans HackTricks**? ou voulez-vous avoir acc√®s √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF**? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**üí¨**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR au repo [hacktricks](https://github.com/carlospolop/hacktricks) et [hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>
