# Objection チュートリアル

<details>

<summary><strong>htARTE（HackTricks AWS Red Team Expert）</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>を通じて、ゼロからヒーローまでAWSハッキングを学ぶ</strong></a><strong>！</strong></summary>

HackTricks をサポートする他の方法:

* **HackTricks で企業を宣伝したい** または **HackTricks をPDFでダウンロードしたい場合は** [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop) をチェックしてください！
* [**公式PEASS＆HackTricksスワッグ**](https://peass.creator-spring.com)を入手する
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な [**NFTs**](https://opensea.io/collection/the-peass-family) のコレクションを見つける
* **💬 [Discord グループ](https://discord.gg/hRep4RUj7f)** に参加するか、[telegram グループ](https://t.me/peass) に参加するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live) をフォローする
* **HackTricks** と **HackTricks Cloud** の github リポジトリに PR を提出して、**ハッキングテクニックを共有**してください。

</details>

<img src="../../../.gitbook/assets/i3.png" alt="" data-size="original">

**バグバウンティのヒント**: **Intigriti にサインアップ**してください。これは、**ハッカーによって作成されたプレミアムバグバウンティプラットフォーム**です！今すぐ [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) に参加して、最大 **$100,000** のバウンティを獲得しましょう！

{% embed url="https://go.intigriti.com/hacktricks" %}

## **はじめに**

**objection - ランタイムモバイルエクスプロレーション**

**[Objection](https://github.com/sensepost/objection)** は、[Frida](https://www.frida.re) によって動作するランタイムモバイルエクスプロレーションツールキットです。このツールは、脱獄またはルート化されたモバイルデバイスの必要性なしに、モバイルアプリケーションとそのセキュリティポリシーを評価するのを支援することを目的として構築されました。

**注意:** これはある種の脱獄/ルートバイパスではありません。`objection` を使用することで、対面している適用されるサンドボックスによって課せられるすべての制限に制約されます。

### 再開

**objection** の目標は、ユーザーが **Frida が提供する主要なアクションを呼び出すこと** です。**そうでない場合**、ユーザーは **テストしたいアプリケーションごとに単一のスクリプトを作成する必要があります**。

## チュートリアル

このチュートリアルでは、こちらからダウンロードできる APK を使用します:

{% file src="../../../.gitbook/assets/app-release.zip" %}

または、[元のリポジトリ](https://github.com/asvid/FridaApp) からダウンロードできます（app-release.apk をダウンロード）。

### インストール
```bash
pip3 install objection
```
### 接続

**通常のADB接続**を作成し、デバイスで**frida**サーバーを**起動**します（クライアントとサーバーの両方でfridaが動作していることを確認します）。

**root権限のあるデバイス**を使用している場合、テストしたいアプリケーションを_**--gadget**_オプション内で選択する必要があります。この場合は次のようにします：
```bash
frida-ps -Uai
objection --gadget asvid.github.io.fridaapp explore
```
### 基本的なアクション

このチュートリアルでは、objectionのすべての可能なコマンドがリストされるわけではありません。私がより便利だと考えるものだけが含まれています。

#### 環境

環境内には、パスワードやパスなどの興味深い情報が含まれている可能性があります。
```bash
env
```
#### Fridaの情報

Fridaは、動的なインストルメントツールキットであり、アプリケーションのランタイム動作を監視、操作するために使用されます。Fridaは、iOS、Android、Windows、macOS、Linuxなど、さまざまなプラットフォームで動作します。FridaはJavaScriptを使用してスクリプトを記述し、アプリケーションの動作を解析、変更することができます。Fridaは、アプリケーションのセキュリティ解析や逆向きエンジニアリングにおいて非常に強力なツールとして広く使用されています。
```bash
frida
```
![](<../../../.gitbook/assets/image (65).png>)

#### アップロード/ダウンロード
```bash
file download <remote path> [<local path>]
file upload <local path> [<remote path>]
```
#### Fridaスクリプトのインポート
```bash
import <local path frida-script>
```
#### SSLピニング
```bash
android sslpinning disable #Attempts to disable SSL Pinning on Android devices.
```
#### ルート検出
```bash
android root disable  #Attempts to disable root detection on Android devices.
android root simulate #Attempts to simulate a rooted Android environment.
```
#### Execコマンド
```bash
android shell_exec whoami
```
#### スクリーンショット
```bash
android ui screenshot /tmp/screenshot
android ui FLAG_SECURE false  #This may enable you to take screenshots using the hardware keys
```
### 静的解析を動的に行う

実際のアプリケーションでは、**静的解析**によってobjectionを使用する前にこの部分で発見されたすべての情報を知っておく必要があります。とにかく、ここではクラス、メソッド、エクスポートされたオブジェクトの完全なリストしか持っていないため、**新しい情報**が見られるかもしれません。

これはまた、アプリの**いくつかの読みやすいソースコードを取得できない**場合に役立ちます。

#### アクティビティ、レシーバ、およびサービスのリスト
```bash
android hooking list activities
```
![](<../../../.gitbook/assets/image (78).png>)
```bash
android hooking list services
android hooking list receivers
```
#### 現在のアクティビティの取得
```bash
android hooking get current_activity
```
![](<../../../.gitbook/assets/image (73) (1).png>)

#### クラスの検索

アプリケーション内のクラスを検索しましょう
```bash
android hooking search classes asvid.github.io.fridaapp
```
![](<../../../.gitbook/assets/image (69).png>)

#### クラスの検索方法

次に、_MainActivity:_ クラス内のメソッドを抽出します。
```bash
android hooking search methods asvid.github.io.fridaapp MainActivity
```
![](<../../../.gitbook/assets/image (70) (1).png>)

#### クラスの宣言されたメソッドとそのパラメーターのリスト

クラスのメソッドがどのようなパラメーターが必要かを把握しましょう：
```bash
android hooking list class_methods asvid.github.io.fridaapp.MainActivity
```
![](<../../../.gitbook/assets/image (79).png>)

#### クラスのリスト

現在のアプリケーション内でロードされたすべてのクラスをリストアップすることもできます：
```bash
android hooking list classes #List all loaded classes, As the target application gets usedmore, this command will return more classes.
```
これは、クラスのメソッドをフックしたいがクラスの名前しかわからない場合に非常に便利です。この関数を使用して、クラスを所有するモジュールを検索し、そのメソッドをフックできます。

### フックは簡単です

#### メソッドのフック（監視）

アプリケーションの[ソースコード](https://github.com/asvid/FridaApp/blob/master/app/src/main/java/asvid/github/io/fridaapp/MainActivity.kt)から、**_MainActivity_** の **_sum()_** 関数が **1秒ごと** に実行されていることがわかります。関数が呼び出されるたびに（引数、戻り値、およびバックトレースを含む）**すべての可能な情報をダンプ**してみましょう：
```bash
android hooking watch class_method asvid.github.io.fridaapp.MainActivity.sum --dump-args --dump-backtrace --dump-return
```
![](<../../../.gitbook/assets/image (71).png>)

#### クラス全体のフック（監視）

実際には、MainActivityクラスのすべてのメソッドが本当に興味深いと思います。**すべてをフック**してみましょう。アプリケーションが**クラッシュ**する可能性があるので注意してください。
```bash
android hooking watch class asvid.github.io.fridaapp.MainActivity --dump-args --dump-return
```
アプリケーションを操作すると、クラスがフックされているときに**各関数が呼び出されている**タイミング、**引数**、**戻り値**が表示されます。

![](<../../../.gitbook/assets/image (72).png>)

#### 関数の真偽値の返り値を変更する

ソースコードから、関数 _checkPin_ が _String_ を引数として受け取り、_boolean_ を返すことがわかります。関数を**常に true を返すように**変更しましょう：

![](<../../../.gitbook/assets/image (74).png>)

これで、PINコードのテキストボックスに何かを入力すると、何でも有効であることがわかります：

![](<../../../.gitbook/assets/image (77).png>)

### クラスのインスタンス

特定のJavaクラスの**ライブインスタンス**を検索して表示し、完全修飾クラス名で指定します。Out は、通常オブジェクトの**プロパティ値を含む発見されたObjectionの文字列値を取得しようとした結果**です。
```
android heap print_instances <class>
```
![](<../../../.gitbook/assets/image (80).png>)

### Keystore/Intents

次のように、keystoreとintentsを操作できます：
```bash
android keystore list
android intents launch_activity
android intent launch_service
```
### メモリ

#### ダンプ
```bash
memory dump all <local destination> #Dump all memory
memory dump from_base <base_address> <size_to_dump> <local_destination> #Dump a part
```
#### リスト
```bash
memory list modules
```
![](<../../../.gitbook/assets/image (66).png>)

リストの一番下にはfridaが表示されます：

![](<../../../.gitbook/assets/image (67).png>)

Fridaがエクスポートしているものをチェックしてみましょう：

![](<../../../.gitbook/assets/image (68).png>)

#### 検索/書き込み

Objectionを使用してメモリ内で検索や書き込みもできます：
```bash
memory search "<pattern eg: 41 41 41 ?? 41>" (--string) (--offsets-only)
memory write "<address>" "<pattern eg: 41 41 41 41>" (--string)
```
### SQLite

`sqlite`コマンドを使用してSQLiteデータベースとやり取りできます。

### Exit
```bash
exit
```
## Objection で欠けているもの

* フックメソッドは時々アプリケーションをクラッシュさせることがあります（これは Frida のせいでもあります）。
* クラスのインスタンスを使用してインスタンスの関数を呼び出すことはできません。また、新しいクラスのインスタンスを作成してそれらを使用して関数を呼び出すこともできません。
* アプリケーションで使用されている共通の暗号化メソッドすべてをフックして、暗号化されたテキスト、平文、キー、IV、および使用されているアルゴリズムを見るためのショートカット（sslpinnin のようなもの）はありません。

<img src="../../../.gitbook/assets/i3.png" alt="" data-size="original">

**バグバウンティのヒント**: **Intigriti** に **サインアップ** してください。これは、ハッカーによって作成されたプレミアム **バグバウンティプラットフォーム** です！[**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) で参加し、今日から最大 **$100,000** のバウンティを稼ぎましょう！

{% embed url="https://go.intigriti.com/hacktricks" %}

<details>

<summary><strong>**htARTE (HackTricks AWS Red Team Expert)** で **ゼロからヒーローまでの AWS ハッキングを学びましょう**！</strong></summary>

HackTricks をサポートする他の方法:

* **HackTricks で企業を宣伝したい**、または **PDF で HackTricks をダウンロードしたい** 場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop) をチェックしてください！
* [**公式 PEASS & HackTricks スワッグ**](https://peass.creator-spring.com) を手に入れる
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) を発見し、独占的な [**NFTs**](https://opensea.io/collection/the-peass-family) のコレクションを見つける
* 💬 [**Discord グループ**](https://discord.gg/hRep4RUj7f) に参加するか、[**telegram グループ**](https://t.me/peass) に参加するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live) をフォローする
* **HackTricks** と [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) の github リポジトリに PR を提出して、あなたのハッキングトリックを共有する

</details>
