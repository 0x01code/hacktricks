# Tutoriel Objection

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Expert en √©quipe rouge AWS de HackTricks)</strong></a><strong>!</strong></summary>

Autres fa√ßons de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts GitHub.

</details>

<img src="../../../.gitbook/assets/i3.png" alt="" data-size="original">

**Conseil de prime de bug** : **inscrivez-vous** sur **Intigriti**, une plateforme de prime de bug premium cr√©√©e par des pirates informatiques, pour les pirates informatiques ! Rejoignez-nous sur [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) aujourd'hui, et commencez √† gagner des primes allant jusqu'√† **100 000 $** !

{% embed url="https://go.intigriti.com/hacktricks" %}

## **Introduction**

**objection - Exploration mobile en temps d'ex√©cution**

**[Objection](https://github.com/sensepost/objection)** est une bo√Æte √† outils d'exploration mobile en temps d'ex√©cution, aliment√©e par [Frida](https://www.frida.re). Il a √©t√© construit dans le but d'aider √† √©valuer les applications mobiles et leur posture de s√©curit√© sans avoir besoin d'un appareil mobile jailbreak√© ou root√©.

**Remarque :** Il ne s'agit pas d'une forme de contournement de jailbreak / root. En utilisant `objection`, vous √™tes toujours limit√© par toutes les restrictions impos√©es par le bac √† sable applicable auquel vous √™tes confront√©.

### R√©sum√©

Le **but** d'**objection** est de permettre √† l'utilisateur d'appeler les **principales actions offertes par Frida**. **Sinon**, l'utilisateur devra cr√©er un **script unique pour chaque application** qu'il souhaite tester.

## Tutoriel

Pour ce tutoriel, je vais utiliser l'APK que vous pouvez t√©l√©charger ici :

{% file src="../../../.gitbook/assets/app-release.zip" %}

Ou depuis son [d√©p√¥t d'origine](https://github.com/asvid/FridaApp) (t√©l√©chargez app-release.apk)

### Installation
```bash
pip3 install objection
```
### Connexion

√âtablissez une **connexion ADB normale** et **d√©marrez** le serveur **frida** sur l'appareil (et v√©rifiez que frida fonctionne √† la fois sur le client et sur le serveur).

Si vous utilisez un **appareil root√©**, il est n√©cessaire de s√©lectionner l'application que vous souhaitez tester √† l'int√©rieur de l'option _**--gadget**_. dans ce cas :
```bash
frida-ps -Uai
objection --gadget asvid.github.io.fridaapp explore
```
### Actions de base

Toutes les commandes possibles d'objections ne seront pas r√©pertori√©es dans ce tutoriel, seulement celles que j'ai trouv√©es les plus utiles.

#### Environnement

Certaines informations int√©ressantes (comme des mots de passe ou des chemins d'acc√®s) pourraient √™tre trouv√©es dans l'environnement.
```bash
env
```
![](<../../../.gitbook/assets/image (64).png>)

#### Informations sur Frida
```bash
frida
```
![](<../../../.gitbook/assets/image (65).png>)

#### T√©l√©chargement/T√©l√©chargement
```bash
file download <remote path> [<local path>]
file upload <local path> [<remote path>]
```
#### Importer le script frida
```bash
import <local path frida-script>
```
#### SSLPinning

#### √âpinglage SSL
```bash
android sslpinning disable #Attempts to disable SSL Pinning on Android devices.
```
#### D√©tection de root
```bash
android root disable  #Attempts to disable root detection on Android devices.
android root simulate #Attempts to simulate a rooted Android environment.
```
#### Commande Exec
```bash
android shell_exec whoami
```
#### Captures d'√©cran
```bash
android ui screenshot /tmp/screenshot
android ui FLAG_SECURE false  #This may enable you to take screenshots using the hardware keys
```
### Analyse statique rendue dynamique

Dans une application r√©elle, nous devrions conna√Ætre toutes les informations d√©couvertes dans cette partie avant d'utiliser objection gr√¢ce √† l'**analyse statique**. Quoi qu'il en soit, de cette mani√®re, vous pouvez peut-√™tre voir **quelque chose de nouveau** car ici vous n'aurez qu'une liste compl√®te des classes, des m√©thodes et des objets export√©s.

Cela est √©galement utile si, d'une mani√®re ou d'une autre, vous √™tes **incapable d'obtenir un code source lisible** de l'application.

#### Liste des activit√©s, des r√©cepteurs et des services
```bash
android hooking list activities
```
![](<../../../.gitbook/assets/image (78).png>)
```bash
android hooking list services
android hooking list receivers
```
Frida lancera une erreur si aucun n'est trouv√©

#### Obtenir l'activit√© actuelle
```bash
android hooking get current_activity
```
![](<../../../.gitbook/assets/image (73) (1).png>)

#### Rechercher des classes

Commen√ßons √† rechercher des classes √† l'int√©rieur de notre application
```bash
android hooking search classes asvid.github.io.fridaapp
```
![](<../../../.gitbook/assets/image (69).png>)

#### Rechercher les m√©thodes d'une classe

Maintenant, extrayons les m√©thodes √† l'int√©rieur de la classe _MainActivity:_
```bash
android hooking search methods asvid.github.io.fridaapp MainActivity
```
![](<../../../.gitbook/assets/image (70) (1).png>)

#### Liste des m√©thodes d√©clar√©es d'une classe avec leurs param√®tres

D√©couvrons quels param√®tres les m√©thodes de la classe n√©cessitent :
```bash
android hooking list class_methods asvid.github.io.fridaapp.MainActivity
```
![](<../../../.gitbook/assets/image (79).png>)

#### Liste des classes

Vous pouvez √©galement lister toutes les classes qui ont √©t√© charg√©es dans l'application actuelle :
```bash
android hooking list classes #List all loaded classes, As the target application gets usedmore, this command will return more classes.
```
Ceci est tr√®s utile si vous voulez **accrocher la m√©thode d'une classe et que vous ne connaissez que le nom de la classe**. Vous pouvez utiliser cette fonction pour **rechercher quel module poss√®de la classe** et ensuite accrocher sa m√©thode.

### Accrocher √©tant facile

#### Accrocher (surveiller) une m√©thode

√Ä partir du [code source](https://github.com/asvid/FridaApp/blob/master/app/src/main/java/asvid/github/io/fridaapp/MainActivity.kt) de l'application, nous savons que la **fonction** _**sum()**_ **de** _**MainActivity**_ est ex√©cut√©e **toutes les secondes**. Essayons de **dumper toutes les informations possibles** √† chaque fois que la fonction est appel√©e (arguments, valeur de retour et backtrace):
```bash
android hooking watch class_method asvid.github.io.fridaapp.MainActivity.sum --dump-args --dump-backtrace --dump-return
```
![](<../../../.gitbook/assets/image (71).png>)

#### Accrocher (observer) une classe enti√®re

En fait, je trouve tous les m√©thodes de la classe MainActivity vraiment int√©ressantes, accrochons-les toutes. Soyez prudent, cela pourrait faire planter une application.
```bash
android hooking watch class asvid.github.io.fridaapp.MainActivity --dump-args --dump-return
```
Si vous jouez avec l'application pendant que la classe est accroch√©e, vous verrez quand **chaque fonction est appel√©e**, ses **arguments** et la **valeur de retour**.

![](<../../../.gitbook/assets/image (72).png>)

#### Changer la valeur de retour bool√©enne d'une fonction

√Ä partir du code source, vous pouvez voir que la fonction _checkPin_ re√ßoit une _String_ en argument et renvoie un _boolean_. Faisons en sorte que la fonction **renvoie toujours true** :

![](<../../../.gitbook/assets/image (74).png>)

Maintenant, si vous √©crivez quelque chose dans la zone de texte pour le code PIN, vous verrez que tout est valide :

![](<../../../.gitbook/assets/image (77).png>)

### Instances de classe

Recherchez et affichez **les instances en direct d'une classe Java sp√©cifique**, sp√©cifi√©e par un nom de classe enti√®rement qualifi√©. Out est le r√©sultat d'une tentative d'obtention d'une valeur de cha√Æne pour une objection d√©couverte qui contiendrait g√©n√©ralement **des valeurs de propri√©t√© pour l'objet**.
```
android heap print_instances <class>
```
![](<../../../.gitbook/assets/image (80).png>)

### Keystore/Intents

Vous pouvez jouer avec le keystore et les intents en utilisant :
```bash
android keystore list
android intents launch_activity
android intent launch_service
```
### M√©moire

#### Extraction
```bash
memory dump all <local destination> #Dump all memory
memory dump from_base <base_address> <size_to_dump> <local_destination> #Dump a part
```
#### Liste
```bash
memory list modules
```
![](<../../../.gitbook/assets/image (66).png>)

En bas de la liste, vous pouvez voir frida :

![](<../../../.gitbook/assets/image (67).png>)

V√©rifions ce que frida exporte :

![](<../../../.gitbook/assets/image (68).png>)

#### Recherche/√âcriture

Vous pouvez √©galement rechercher et √©crire dans la m√©moire avec objection :
```bash
memory search "<pattern eg: 41 41 41 ?? 41>" (--string) (--offsets-only)
memory write "<address>" "<pattern eg: 41 41 41 41>" (--string)
```
### SQLite

Vous pouvez utiliser la commande `sqlite` pour interagir avec les bases de donn√©es SQLite.

### Exit
```bash
exit
```
## Ce qui me manque dans Objection

* Les m√©thodes de hooking font parfois planter l'application (c'est aussi √† cause de Frida).
* Vous ne pouvez pas utiliser les instances des classes pour appeler les fonctions de l'instance. Et vous ne pouvez pas cr√©er de nouvelles instances de classes et les utiliser pour appeler des fonctions.
* Il n'y a pas de raccourci (comme celui pour sslpinnin) pour hooker toutes les m√©thodes de cryptographie courantes utilis√©es par l'application afin de voir le texte chiffr√©, le texte en clair, les cl√©s, les IV et les algorithmes utilis√©s.

<img src="../../../.gitbook/assets/i3.png" alt="" data-size="original">

**Conseil de prime de bug** : **inscrivez-vous** sur **Intigriti**, une plateforme de prime de bug premium cr√©√©e par des hackers, pour des hackers ! Rejoignez-nous sur [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) aujourd'hui, et commencez √† gagner des primes allant jusqu'√† **100 000 $**!

{% embed url="https://go.intigriti.com/hacktricks" %}

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres fa√ßons de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** nous sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
