# Objection Tutorial

<details>

<summary><strong>Lernen Sie AWS-Hacking von Grund auf mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks bewerben m√∂chten** oder **HackTricks als PDF herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merchandise**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github Repositories senden.

</details>

<img src="../../../.gitbook/assets/i3.png" alt="" data-size="original">

**Bug-Bounty-Tipp**: **Melden Sie sich an** f√ºr **Intigriti**, eine Premium-**Bug-Bounty-Plattform, die von Hackern f√ºr Hacker** entwickelt wurde! Treten Sie uns noch heute unter [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) bei und verdienen Sie Pr√§mien von bis zu **100.000 $**!

{% embed url="https://go.intigriti.com/hacktricks" %}

## **Einf√ºhrung**

**objection - Laufzeit-Mobilfunkerkundung**

**[Objection](https://github.com/sensepost/objection)** ist ein Toolkit zur Laufzeit-Mobilfunkerkundung, das von [Frida](https://www.frida.re) unterst√ºtzt wird. Es wurde mit dem Ziel entwickelt, mobile Anwendungen und ihre Sicherheitslage zu bewerten, ohne dass ein gejailbreaktes oder gerootetes Mobilger√§t erforderlich ist.

**Hinweis:** Dies ist keine Form von Jailbreak-/Root-Bypass. Durch die Verwendung von `objection` sind Sie immer noch durch alle Einschr√§nkungen eingeschr√§nkt, die von der entsprechenden Sandbox auferlegt werden.

### Zusammenfassung

Das **Ziel** von **objection** besteht darin, dem Benutzer das Aufrufen der **Hauptaktionen, die Frida bietet**, zu erm√∂glichen. **Andernfalls** m√ºsste der Benutzer f√ºr jede Anwendung, die er testen m√∂chte, ein **einziges Skript erstellen**.

## Tutorial

F√ºr dieses Tutorial verwende ich die APK, die Sie hier herunterladen k√∂nnen:

{% file src="../../../.gitbook/assets/app-release.zip" %}

Oder aus ihrem [urspr√ºnglichen Repository](https://github.com/asvid/FridaApp)(app-release.apk herunterladen)

### Installation
```bash
pip3 install objection
```
### Verbindung

Stellen Sie eine **normale ADB-Verbindung** her und starten Sie den **Frida-Server** auf dem Ger√§t (und √ºberpr√ºfen Sie, ob Frida sowohl auf dem Client als auch auf dem Server funktioniert).

Wenn Sie ein **gerootetes Ger√§t** verwenden, m√ºssen Sie die Anwendung, die Sie testen m√∂chten, in der Option _**--gadget**_ ausw√§hlen. In diesem Fall:
```bash
frida-ps -Uai
objection --gadget asvid.github.io.fridaapp explore
```
### Grundlegende Aktionen

Nicht alle m√∂glichen Befehle von Objection werden in diesem Tutorial aufgelistet, sondern nur diejenigen, die ich f√ºr n√ºtzlicher halte.

#### Umgebung

Einige interessante Informationen (wie Passw√∂rter oder Pfade) k√∂nnen in der Umgebung gefunden werden.
```bash
env
```
![](<../../../.gitbook/assets/image (64).png>)

#### Frida Informationen
```bash
frida
```
![](<../../../.gitbook/assets/image (65).png>)

#### Hochladen/Herunterladen
```bash
file download <remote path> [<local path>]
file upload <local path> [<remote path>]
```
#### Importiere Frida-Skript

```javascript
const script = await Session.createScript(`
// Frida script code here
`);
```

#### Load frida script into the target app

```javascript
await script.load();
```

#### Hook a function in the target app

```javascript
await script.exports.functionName();
```

#### Unload frida script from the target app

```javascript
await script.unload();
```

#### Importiere Frida-Skript

```javascript
const script = await Session.createScript(`
// Frida-Skript-Code hier
`);
```

#### Lade das Frida-Skript in die Ziel-App

```javascript
await script.load();
```

#### Hook eine Funktion in der Ziel-App

```javascript
await script.exports.functionName();
```

#### Entlade das Frida-Skript aus der Ziel-App

```javascript
await script.unload();
```
```bash
import <local path frida-script>
```
#### SSL-Pinning

SSL-Pinning ist eine Sicherheitsma√ünahme, die in mobilen Apps implementiert wird, um die √úberpr√ºfung des SSL-Zertifikats des Servers zu verst√§rken. Normalerweise √ºberpr√ºft eine App das SSL-Zertifikat des Servers, um sicherzustellen, dass die Verbindung sicher ist. SSL-Pinning geht jedoch einen Schritt weiter und erfordert, dass die App das Zertifikat des Servers vorab kennt und nur mit diesem Zertifikat kommuniziert.

Dieser Mechanismus erschwert es Angreifern, die Kommunikation zwischen der App und dem Server abzufangen und zu manipulieren. Wenn ein Angreifer versucht, eine Man-in-the-Middle-Attacke durchzuf√ºhren, indem er ein gef√§lschtes Zertifikat verwendet, wird die App die Verbindung ablehnen, da das Zertifikat nicht mit dem vorab bekannten Zertifikat √ºbereinstimmt.

SSLPinning kann die Sicherheit einer mobilen App erheblich verbessern, da es die Wahrscheinlichkeit von Angriffen wie SSL-Stripping und Man-in-the-Middle-Attacken verringert. Es ist jedoch wichtig zu beachten, dass SSL-Pinning nicht die einzige Sicherheitsma√ünahme ist, die in einer App implementiert werden sollte. Es sollte in Kombination mit anderen Sicherheitsmechanismen wie verschl√ºsselter Kommunikation und sicheren Speicherpraktiken verwendet werden, um eine umfassende Sicherheit zu gew√§hrleisten.
```bash
android sslpinning disable #Attempts to disable SSL Pinning on Android devices.
```
#### Root-Erkennung

Root-Erkennung ist ein wichtiger Aspekt bei der Sicherheitsbewertung von Android-Apps. Wenn ein Ger√§t "gerootet" ist, bedeutet dies, dass der Benutzer erweiterte Berechtigungen hat und auf Systemdateien und -funktionen zugreifen kann. Dies kann ein Sicherheitsrisiko darstellen, da b√∂sartige Apps m√∂glicherweise auf sensible Daten zugreifen oder das Ger√§t kompromittieren k√∂nnen.

Es gibt verschiedene Methoden, um zu √ºberpr√ºfen, ob ein Ger√§t "gerootet" ist. Einige g√§ngige Techniken umfassen die √úberpr√ºfung von Systemdateien, das √úberpr√ºfen von Root-Bin√§rdateien und das √úberpr√ºfen von Systemeigenschaften. Es ist wichtig, dass Entwickler diese Techniken in ihre Apps integrieren, um zu verhindern, dass sie auf "gerooteten" Ger√§ten ausgef√ºhrt werden.

Obwohl Root-Erkennungstechniken hilfreich sein k√∂nnen, ist es wichtig zu beachten, dass sie nicht immer zuverl√§ssig sind. Es gibt M√∂glichkeiten, Root-Erkennung zu umgehen oder zu maskieren, was bedeutet, dass eine App m√∂glicherweise nicht erkennt, dass ein Ger√§t "gerootet" ist. Daher sollten Entwickler auch andere Sicherheitsma√ünahmen implementieren, um ihre Apps zu sch√ºtzen.
```bash
android root disable  #Attempts to disable root detection on Android devices.
android root simulate #Attempts to simulate a rooted Android environment.
```
#### Exec-Befehl

The `exec` command in objection allows you to execute arbitrary commands within the context of the target application. This can be useful for various purposes, such as exploring the application's environment, interacting with the application's components, or performing actions that are not exposed through the application's user interface.

To use the `exec` command, you need to specify the command you want to execute as an argument. For example, to execute the `ls` command to list the files in the current directory, you can use the following command:

```
objection> exec ls
```

The output of the command will be displayed in the console. You can also capture the output and save it to a file by using the `>` operator followed by the file path. For example, to save the output of the `ls` command to a file named `files.txt`, you can use the following command:

```
objection> exec ls > files.txt
```

Keep in mind that the `exec` command runs the specified command within the context of the target application, so it may have limitations depending on the application's permissions and environment. Additionally, be cautious when executing commands that may have unintended consequences or impact the stability of the application.

#### Exec-Befehl

Der `exec`-Befehl in Objection erm√∂glicht es Ihnen, beliebige Befehle im Kontext der Zielanwendung auszuf√ºhren. Dies kann f√ºr verschiedene Zwecke n√ºtzlich sein, wie zum Beispiel das Erkunden der Umgebung der Anwendung, die Interaktion mit den Komponenten der Anwendung oder das Ausf√ºhren von Aktionen, die nicht √ºber die Benutzeroberfl√§che der Anwendung zug√§nglich sind.

Um den `exec`-Befehl zu verwenden, m√ºssen Sie den auszuf√ºhrenden Befehl als Argument angeben. Zum Beispiel k√∂nnen Sie den Befehl `ls` ausf√ºhren, um die Dateien im aktuellen Verzeichnis aufzulisten, indem Sie den folgenden Befehl verwenden:

```
objection> exec ls
```

Die Ausgabe des Befehls wird in der Konsole angezeigt. Sie k√∂nnen die Ausgabe auch erfassen und in einer Datei speichern, indem Sie den `>`-Operator gefolgt vom Dateipfad verwenden. Zum Beispiel k√∂nnen Sie die Ausgabe des `ls`-Befehls in einer Datei mit dem Namen `files.txt` speichern, indem Sie den folgenden Befehl verwenden:

```
objection> exec ls > files.txt
```

Beachten Sie, dass der `exec`-Befehl den angegebenen Befehl im Kontext der Zielanwendung ausf√ºhrt, daher kann er je nach den Berechtigungen und der Umgebung der Anwendung Einschr√§nkungen haben. Seien Sie au√üerdem vorsichtig beim Ausf√ºhren von Befehlen, die unbeabsichtigte Folgen haben k√∂nnten oder die Stabilit√§t der Anwendung beeintr√§chtigen k√∂nnten.
```bash
android shell_exec whoami
```
#### Screenshots

#### Bildschirmfotos
```bash
android ui screenshot /tmp/screenshot
android ui FLAG_SECURE false  #This may enable you to take screenshots using the hardware keys
```
### Statische Analyse wird dynamisch

In einer echten Anwendung sollten wir all diese Informationen aus diesem Teil kennen, bevor wir Objection verwenden, dank der **statischen Analyse**. Trotzdem k√∂nnen Sie auf diese Weise vielleicht **etwas Neues** sehen, da Sie hier nur eine vollst√§ndige Liste von Klassen, Methoden und exportierten Objekten haben werden.

Dies ist auch n√ºtzlich, wenn Sie aus irgendeinem Grund **keinen lesbaren Quellcode** der App erhalten k√∂nnen.

#### Aktivit√§ten, Empf√§nger und Dienste auflisten
```bash
android hooking list activities
```
![](<../../../.gitbook/assets/image (78).png>)
```bash
android hooking list services
android hooking list receivers
```
Frida wird einen Fehler anzeigen, wenn keiner gefunden wird.

#### Aktuelle Aktivit√§t abrufen
```bash
android hooking get current_activity
```
#### Klassen suchen

Beginnen wir damit, nach Klassen in unserer Anwendung zu suchen.
```bash
android hooking search classes asvid.github.io.fridaapp
```
![](<../../../.gitbook/assets/image (69).png>)

#### Suchmethoden einer Klasse suchen

Lassen Sie uns nun die Methoden innerhalb der Klasse _MainActivity_ extrahieren:
```bash
android hooking search methods asvid.github.io.fridaapp MainActivity
```
![](<../../../.gitbook/assets/image (70) (1).png>)

#### Liste deklarierter Methoden einer Klasse mit ihren Parametern

Lassen Sie uns herausfinden, welche Parameter die Methoden der Klasse ben√∂tigen:
```bash
android hooking list class_methods asvid.github.io.fridaapp.MainActivity
```
![](<../../../.gitbook/assets/image (79).png>)

#### Klassen auflisten

Sie k√∂nnen auch alle Klassen auflisten, die in der aktuellen Anwendung geladen wurden:
```bash
android hooking list classes #List all loaded classes, As the target application gets usedmore, this command will return more classes.
```
Dies ist sehr n√ºtzlich, wenn Sie die Methode einer Klasse "hooken" m√∂chten und nur den Namen der Klasse kennen. Sie k√∂nnen diese Funktion verwenden, um herauszufinden, welches Modul die Klasse besitzt, und dann ihre Methode "hooken".

### Das "Hooken" ist einfach

#### Eine Methode "hooken" (√ºberwachen)

Aus dem [Quellcode](https://github.com/asvid/FridaApp/blob/master/app/src/main/java/asvid/github/io/fridaapp/MainActivity.kt) der Anwendung wissen wir, dass die Funktion **sum()** von **MainActivity** **alle Sekunde** ausgef√ºhrt wird. Versuchen wir, jedes Mal, wenn die Funktion aufgerufen wird, alle m√∂glichen Informationen abzurufen (Argumente, R√ºckgabewert und Backtrace) zu speichern:
```bash
android hooking watch class_method asvid.github.io.fridaapp.MainActivity.sum --dump-args --dump-backtrace --dump-return
```
![](<../../../.gitbook/assets/image (71).png>)

#### Hooking (watching) an entire class

Eigentlich finde ich alle Methoden der Klasse MainActivity wirklich interessant, lassen Sie uns **sie alle hooken**. Seien Sie vorsichtig, dies k√∂nnte eine Anwendung **zum Absturz bringen**.
```bash
android hooking watch class asvid.github.io.fridaapp.MainActivity --dump-args --dump-return
```
Wenn Sie mit der Anwendung spielen, w√§hrend die Klasse gehookt ist, sehen Sie, wann **jede Funktion aufgerufen wird**, ihre **Argumente** und den **R√ºckgabewert**.

![](<../../../.gitbook/assets/image (72).png>)

#### √Ñndern des booleschen R√ºckgabewerts einer Funktion

Aus dem Quellcode geht hervor, dass die Funktion _checkPin_ ein _String_-Argument erh√§lt und einen _boolean_-Wert zur√ºckgibt. Lassen Sie die Funktion **immer true zur√ºckgeben**:

![](<../../../.gitbook/assets/image (74).png>)

Wenn Sie nun etwas in das Textfeld f√ºr den PIN-Code eingeben, sehen Sie, dass alles g√ºltig ist:

![](<../../../.gitbook/assets/image (77).png>)

### Klasseninstanzen

Suchen Sie nach und drucken Sie **lebende Instanzen einer bestimmten Java-Klasse** aus, die durch einen vollqualifizierten Klassennamen angegeben wird. Out ist das Ergebnis eines Versuchs, einen Zeichenfolgenwert f√ºr eine entdeckte Einwendung zu erhalten, der normalerweise **Eigenschaftswerte f√ºr das Objekt enth√§lt**.
```
android heap print_instances <class>
```
![](<../../../.gitbook/assets/image (80).png>)

### Keystore/Intents

Sie k√∂nnen mit dem Keystore und Intents spielen, indem Sie Folgendes verwenden:
```bash
android keystore list
android intents launch_activity
android intent launch_service
```
#### Speicher

##### Dump

Der Dump-Befehl erm√∂glicht es, den Speicherinhalt einer Anwendung abzurufen. Dies kann hilfreich sein, um sensible Informationen wie Passw√∂rter oder Schl√ºssel zu finden.

```shell
# Dump des Speicherinhalts einer Anwendung
objection explore --start com.example.app
android hooking watch class_method com.example.app.MainActivity onCreate
android hooking watch class_method com.example.app.MainActivity onDestroy
```

Der obige Code demonstriert, wie man den Speicherinhalt einer Anwendung mit dem Objection-Tool abruft. Durch das √úberwachen der `onCreate`- und `onDestroy`-Methoden der `MainActivity`-Klasse k√∂nnen wir den Speicherinhalt w√§hrend des Lebenszyklus der Anwendung √ºberwachen und m√∂gliche Lecks identifizieren.
```bash
memory dump all <local destination> #Dump all memory
memory dump from_base <base_address> <size_to_dump> <local_destination> #Dump a part
```
#### Liste
```bash
memory list modules
```
![](<../../../.gitbook/assets/image (66).png>)

Am Ende der Liste sehen Sie frida:

![](<../../../.gitbook/assets/image (67).png>)

Lassen Sie uns √ºberpr√ºfen, was frida exportiert:

![](<../../../.gitbook/assets/image (68).png>)

#### Suche/Schreiben

Sie k√∂nnen auch mit Objection im Speicher suchen und schreiben:
```bash
memory search "<pattern eg: 41 41 41 ?? 41>" (--string) (--offsets-only)
memory write "<address>" "<pattern eg: 41 41 41 41>" (--string)
```
### SQLite

Sie k√∂nnen den Befehl `sqlite` verwenden, um mit SQLite-Datenbanken zu interagieren.

### Beenden
```bash
exit
```
## Was mir bei Objection fehlt

* Die Hooking-Methoden f√ºhren manchmal zum Absturz der Anwendung (das liegt auch an Frida).
* Sie k√∂nnen die Instanzen der Klassen nicht verwenden, um Funktionen der Instanz aufzurufen. Und Sie k√∂nnen keine neuen Instanzen von Klassen erstellen und sie verwenden, um Funktionen aufzurufen.
* Es gibt keine Abk√ºrzung (wie die f√ºr sslpinnin), um alle von der Anwendung verwendeten g√§ngigen Kryptomethoden zu hooken, um verschl√ºsselten Text, Klartext, Schl√ºssel, IVs und verwendete Algorithmen zu sehen.

<img src="../../../.gitbook/assets/i3.png" alt="" data-size="original">

**Bug-Bounty-Tipp**: **Melden Sie sich an** bei **Intigriti**, einer Premium-**Bug-Bounty-Plattform, die von Hackern f√ºr Hacker erstellt wurde**! Treten Sie uns noch heute unter [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) bei und verdienen Sie Pr√§mien von bis zu **100.000 $**!

{% embed url="https://go.intigriti.com/hacktricks" %}

<details>

<summary><strong>Lernen Sie AWS-Hacking von Null auf Held mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks bewerben m√∂chten** oder **HackTricks als PDF herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merchandise**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositories senden.

</details>
