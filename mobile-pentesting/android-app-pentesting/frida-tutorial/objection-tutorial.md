# Objection Öğretici

<details>

<summary><strong>AWS hacklemeyi sıfırdan kahraman seviyesine öğrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Kırmızı Takım Uzmanı)</strong></a><strong>!</strong></summary>

HackTricks'i desteklemenin diğer yolları:

* **Şirketinizi HackTricks'te reklam vermek isterseniz** veya **HackTricks'i PDF olarak indirmek isterseniz** [**ABONELİK PLANLARINA**](https://github.com/sponsors/carlospolop) göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keşfedin, özel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın** veya **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)'u **takip edin**.
* **Hacking hilelerinizi paylaşarak** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına **PR göndererek** katkıda bulunun.

</details>

<img src="../../../.gitbook/assets/i3.png" alt="" data-size="original">

**Bounty ipucu**: **Intigriti'ye kaydolun**, hackerlar tarafından oluşturulan bir premium **bounty platformu**! Bugün [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) adresinde bize katılın ve **$100,000**'e kadar ödüller kazanmaya başlayın!

{% embed url="https://go.intigriti.com/hacktricks" %}

## **Giriş**

**objection - Çalışma Zamanı Mobil Keşif**

**[Objection](https://github.com/sensepost/objection)**, [Frida](https://www.frida.re) tarafından desteklenen bir çalışma zamanı mobil keşif aracıdır. Amacı, bir jailbreak veya rootlu mobil cihaz gerektirmeden mobil uygulamaları ve güvenlik durumlarını değerlendirmeye yardımcı olmaktır.

**Not:** Bu, bir tür jailbreak / root bypass değildir. `objection` kullanarak, karşılaştığınız geçerli kum havuzunun uyguladığı tüm kısıtlamalara hala tabisiniz.

### Özet

**objection**'ın amacı, kullanıcının **Frida'nın sunduğu ana eylemleri çağırmasına izin vermek**tir. Aksi takdirde, kullanıcının test etmek istediği her uygulama için **tek bir komut dosyası oluşturması gerekecektir**.

## Öğretici

Bu öğretici için buradan indirebileceğiniz APK'yi kullanacağım:

{% file src="../../../.gitbook/assets/app-release.zip" %}

Veya [orijinal deposundan](https://github.com/asvid/FridaApp) (app-release.apk'yi indirin)

### Kurulum
```bash
pip3 install objection
```
### Bağlantı

Bir **normal ADB bağlantısı** yapın ve cihazda **frida** sunucusunu **başlatın** (ve frida'nın hem istemci hem de sunucuda çalıştığını kontrol edin).

Eğer bir **rootlu cihaz** kullanıyorsanız, test etmek istediğiniz uygulamayı _**--gadget**_ seçeneği içinde belirtmeniz gerekmektedir. Bu durumda:
```bash
frida-ps -Uai
objection --gadget asvid.github.io.fridaapp explore
```
### Temel İşlemler

Bu öğreticide objections'ın tüm olası komutları listelenmeyecek, sadece daha kullanışlı bulduğum komutlar yer alacak.

#### Ortam

Ortam içinde (şifreler veya dosya yolları gibi) bazı ilginç bilgiler bulunabilir.
```bash
env
```
![](<../../../.gitbook/assets/image (64).png>)

#### Frida Bilgisi
```bash
frida
```
![](<../../../.gitbook/assets/image (65).png>)

#### Yükleme/İndirme
```bash
file download <remote path> [<local path>]
file upload <local path> [<remote path>]
```
#### Frida betiği içe aktar

```javascript
const { spawn } = require('child_process');
const fridaScriptPath = '/path/to/frida_script.js';

const runFridaScript = () => {
  const fridaProcess = spawn('frida', ['-U', '-f', 'com.example.app', '-l', fridaScriptPath]);

  fridaProcess.stdout.on('data', (data) => {
    console.log(`[+] ${data}`);
  });

  fridaProcess.stderr.on('data', (data) => {
    console.error(`[-] ${data}`);
  });

  fridaProcess.on('close', (code) => {
    console.log(`[*] Frida process exited with code ${code}`);
  });
};

runFridaScript();
```

Bu kod parçası, frida_script.js adlı bir frida betiğini kullanarak belirli bir Android uygulamasını hedef alır. `frida_script.js` dosyasının yolunu `fridaScriptPath` değişkenine ayarlayarak kullanabilirsiniz. Ardından `runFridaScript` fonksiyonunu çağırarak frida betiğini çalıştırabilirsiniz.

Frida betiği, `com.example.app` olarak belirtilen hedef uygulamayı hedef alır. Eğer farklı bir uygulama hedeflemek isterseniz, `-f` bayrağıyla hedef uygulamanın paket adını değiştirebilirsiniz.

Frida betiği çalıştırıldığında, `fridaProcess.stdout` ve `fridaProcess.stderr` olaylarına bağlı olarak çıktılar alınır. `fridaProcess.on('close')` olayı ise frida işleminin sonlandığında çalışır ve çıkış kodunu gösterir.
```bash
import <local path frida-script>
```
#### SSLPinning

SSLPinning, a.k.a. Certificate Pinning, is a security mechanism used in mobile applications to prevent Man-in-the-Middle (MitM) attacks. It ensures that the application only communicates with servers that possess a specific SSL certificate or public key.

In SSLPinning, the application includes a list of trusted certificates or public keys. During the SSL handshake process, the server presents its certificate to the client. The client then compares the presented certificate or public key with the ones in its trusted list. If there is a match, the connection proceeds; otherwise, it is terminated.

This technique protects against attacks where an attacker intercepts the communication between the client and the server and tries to replace the server's certificate with a malicious one. By enforcing SSLPinning, the application ensures that it only communicates with trusted servers, reducing the risk of data leakage and unauthorized access.

To bypass SSLPinning during a penetration test, you can use tools like Frida and Objection. These tools allow you to hook into the application's code and modify its behavior. By patching the SSLPinning checks, you can make the application accept any certificate or public key, enabling you to intercept and analyze the traffic.

However, it's important to note that bypassing SSLPinning is a risky action and should only be performed with proper authorization and for legitimate purposes. It's crucial to obtain the necessary permissions and follow ethical guidelines when conducting penetration testing.
```bash
android sslpinning disable #Attempts to disable SSL Pinning on Android devices.
```
#### Kök tespiti

Root tespiti, bir Android uygulamasının cihazın köklenmiş (root) olup olmadığını belirlemek için kullanılan bir tekniktir. Root erişimi, kullanıcının cihazın tam kontrolünü elde etmesine olanak sağlar ve bu da uygulamaların normalde erişemeyeceği sistem düzeyinde değişiklikler yapılmasına izin verir. Bu nedenle, birçok uygulama kök erişimine sahip cihazlarda çalışmayı engellemek için kök tespiti yöntemlerini kullanır.

Bir uygulamanın kök tespitini engellemek için çeşitli yöntemler vardır. Bunlar arasında köklenmiş dosyaların varlığını kontrol etmek, köklenmiş uygulamaların listesini kontrol etmek, köklenmiş süreçleri kontrol etmek ve köklenmiş kütüphaneleri kontrol etmek gibi teknikler bulunur. Bu tespit yöntemlerini atlatmak için kök tespitini engelleyen araçlar ve teknikler kullanılabilir.
```bash
android root disable  #Attempts to disable root detection on Android devices.
android root simulate #Attempts to simulate a rooted Android environment.
```
#### Exec Komutu

The `exec` command in Objection allows you to execute shell commands on the target Android device. This can be useful for various purposes, such as exploring the device's file system, running scripts, or interacting with the device's shell.

To use the `exec` command, you need to specify the command you want to execute as an argument. For example, to list the files in the current directory, you can use the following command:

```
objection> exec ls
```

You can also execute commands with arguments by enclosing them in quotes. For example, to display the contents of a specific file, you can use the following command:

```
objection> exec cat "/path/to/file.txt"
```

Keep in mind that the `exec` command runs the specified command on the target device, so be cautious when executing potentially harmful commands.

#### Exec Komutu

Objection'daki `exec` komutu, hedef Android cihazında kabuk komutlarını çalıştırmanıza olanak sağlar. Bu, cihazın dosya sistemini keşfetmek, betikleri çalıştırmak veya cihazın kabuğuyla etkileşimde bulunmak gibi çeşitli amaçlar için kullanışlı olabilir.

`exec` komutunu kullanmak için, çalıştırmak istediğiniz komutu bir argüman olarak belirtmeniz gerekmektedir. Örneğin, mevcut dizindeki dosyaları listelemek için aşağıdaki komutu kullanabilirsiniz:

```
objection> exec ls
```

Komutları argümanlarla birlikte de çalıştırabilirsiniz, bunları tırnak içine alarak belirtebilirsiniz. Örneğin, belirli bir dosyanın içeriğini görüntülemek için aşağıdaki komutu kullanabilirsiniz:

```
objection> exec cat "/path/to/file.txt"
```

`exec` komutunun belirtilen komutu hedef cihazda çalıştırdığını unutmayın, bu nedenle potansiyel olarak zararlı komutları çalıştırırken dikkatli olun.
```bash
android shell_exec whoami
```
#### Ekran Görüntüleri
```bash
android ui screenshot /tmp/screenshot
android ui FLAG_SECURE false  #This may enable you to take screenshots using the hardware keys
```
### Statik analiz dinamik hale getirildi

Gerçek bir uygulamada, objection kullanmadan önce bu bölümde keşfedilen tüm bilgilere sahip olmalıyız, çünkü **statik analiz** sayesinde. Neyse ki, bu şekilde sadece sınıfların, yöntemlerin ve dışa aktarılan nesnelerin tam bir listesine sahip olabilirsiniz, bu yüzden belki de **yeni bir şeyler görebilirsiniz**.

Bu ayrıca, uygulamanın bazı okunabilir kaynak kodlarını **elde edemiyorsanız** da kullanışlıdır.

#### Aktiviteleri, alıcıları ve hizmetleri listele
```bash
android hooking list activities
```
![](<../../../.gitbook/assets/image (78).png>)
```bash
android hooking list services
android hooking list receivers
```
Frida, bir tane bulunamazsa bir hata başlatacaktır.

#### Mevcut etkinliği alma
```bash
android hooking get current_activity
```
#### Sınıfları Arama

Uygulamamız içindeki sınıfları aramaya başlayalım.
```bash
android hooking search classes asvid.github.io.fridaapp
```
![](<../../../.gitbook/assets/image (69).png>)

#### Bir sınıfın arama yöntemleri

Şimdi _MainActivity_ sınıfının içindeki yöntemleri çıkaralım:
```bash
android hooking search methods asvid.github.io.fridaapp MainActivity
```
![](<../../../.gitbook/assets/image (70) (1).png>)

#### Bir sınıfın deklare edilmiş yöntemlerini ve parametrelerini listeleme

Sınıfın yöntemlerinin hangi parametrelere ihtiyaç duyduğunu bulalım:
```bash
android hooking list class_methods asvid.github.io.fridaapp.MainActivity
```
![](<../../../.gitbook/assets/image (79).png>)

#### Sınıfları Listele

Ayrıca, mevcut uygulama içinde yüklenen tüm sınıfları listeleyebilirsiniz:
```bash
android hooking list classes #List all loaded classes, As the target application gets usedmore, this command will return more classes.
```
Bu, bir sınıfın yöntemini kancalamak istediğinizde ve sadece sınıfın adını bildiğinizde çok kullanışlıdır. Bu işlevi kullanarak sınıfın sahip olduğu modülü arayabilir ve ardından yöntemini kancalayabilirsiniz.

### Kancalama kolay olduğunda

#### Bir yöntemi kancalamak (izlemek)

Uygulamanın [kaynak kodundan](https://github.com/asvid/FridaApp/blob/master/app/src/main/java/asvid/github/io/fridaapp/MainActivity.kt) biliyoruz ki **_MainActivity_**'den **_sum()_** adlı **fonksiyon** her saniye çalıştırılıyor. Her fonksiyon çağrıldığında (argümanlar, dönüş değeri ve geri izleme) tüm olası bilgileri dökemeyi deneyelim:
```bash
android hooking watch class_method asvid.github.io.fridaapp.MainActivity.sum --dump-args --dump-backtrace --dump-return
```
![](<../../../.gitbook/assets/image (71).png>)

#### Bir sınıfın tamamını kancalamak (izlemek)

Aslında, MainActivity sınıfının tüm yöntemlerini gerçekten ilginç buluyorum, hepsini **kancalayalım**. Dikkatli olun, bu bir uygulamayı **çökerte**bilir.
```bash
android hooking watch class asvid.github.io.fridaapp.MainActivity --dump-args --dump-return
```
Eğer sınıf bağlandığında uygulamayla oynarsanız, her bir fonksiyonun ne zaman çağrıldığını, argümanlarını ve dönüş değerini göreceksiniz.

![](<../../../.gitbook/assets/image (72).png>)

#### Bir fonksiyonun boolean dönüş değerini değiştirme

Kaynak kodundan görebileceğiniz gibi, _checkPin_ fonksiyonu bir _String_ alır ve bir _boolean_ döndürür. Fonksiyonu **her zaman true döndürecek şekilde** yapalım:

![](<../../../.gitbook/assets/image (74).png>)

Şimdi, PIN kodu için metin kutusuna herhangi bir şey yazarsanız, her şeyin geçerli olduğunu göreceksiniz:

![](<../../../.gitbook/assets/image (77).png>)

### Sınıf örnekleri

Belirli bir Java sınıfının canlı örneklerini, tam nitelikli bir sınıf adıyla belirtilen şekilde arayın ve yazdırın. Out, genellikle nesne için özellik değerlerini içeren bir keşfedilen itiraz için bir dize değeri elde etme girişiminin sonucudur.
```
android heap print_instances <class>
```
![](<../../../.gitbook/assets/image (80).png>)

### Keystore/Intents

Keystore ve intents ile oynayabilirsiniz. Bunun için kullanabileceğiniz yöntemler:
```bash
android keystore list
android intents launch_activity
android intent launch_service
```
#### Bellek

##### Döküm

Bir Android uygulamasının belleğini incelemek, uygulama hafızasında depolanan verilere erişmek için önemli bir adımdır. Bu, uygulamanın çalışma zamanında kullanılan değişkenler, nesneler ve diğer veriler hakkında bilgi edinmek için kullanışlı bir yöntemdir. Bellek dökümü, uygulamanın belleğindeki tüm verilerin bir görüntüsünü oluşturur.

Bellek dökümü almak için Objection aracını kullanabiliriz. Objection, Frida'nın bir parçasıdır ve Android uygulamalarının belleğini incelemek için kullanılan bir araçtır. Objection'ı kullanarak, uygulamanın belleğindeki verileri analiz edebilir ve potansiyel güvenlik açıklarını tespit edebiliriz.

Objection'ı kullanarak bellek dökümü almak için aşağıdaki adımları izleyebilirsiniz:

1. İlk olarak, hedef cihazda Objection'ı başlatın:

   ```bash
   objection -g com.example.app explore
   ```

2. Ardından, bellek dökümünü almak için aşağıdaki komutu kullanın:

   ```bash
   android memory dump
   ```

   Bu komut, hedef cihazın belleğini tarayacak ve bir bellek dökümü dosyası oluşturacaktır.

3. Bellek dökümü dosyasını analiz etmek için bir analiz aracı kullanabilirsiniz. Örneğin, Volatility veya Rekall gibi araçlar, bellek dökümü dosyasını incelemek ve içindeki verileri analiz etmek için kullanılabilir.

Bellek dökümü almak, uygulamanın belleğindeki verilere erişmek ve potansiyel güvenlik açıklarını tespit etmek için önemli bir adımdır. Bu yöntem, bir Android uygulamasının güvenlik değerlendirmesinde kullanılan etkili bir tekniktir.
```bash
memory dump all <local destination> #Dump all memory
memory dump from_base <base_address> <size_to_dump> <local_destination> #Dump a part
```
#### Liste
```bash
memory list modules
```
![](<../../../.gitbook/assets/image (66).png>)

Listede en altta frida'yı görebilirsiniz:

![](<../../../.gitbook/assets/image (67).png>)

Frida'nın neyi ihraç ettiğini kontrol edelim:

![](<../../../.gitbook/assets/image (68).png>)

#### Arama/Yazma

Objection ile bellek içinde arama yapabilir ve yazabilirsiniz:
```bash
memory search "<pattern eg: 41 41 41 ?? 41>" (--string) (--offsets-only)
memory write "<address>" "<pattern eg: 41 41 41 41>" (--string)
```
### SQLite

SQLite veritabanlarıyla etkileşimde bulunmak için `sqlite` komutunu kullanabilirsiniz.

### Çıkış
```bash
exit
```
## Objection'da Ne Eksik

* Hooking yöntemleri bazen uygulamayı çökertebilir (bu da Frida'nın bir sonucudur).
* Sınıfların örneklerini kullanarak örnek fonksiyonları çağıramazsınız. Ve sınıfların yeni örneklerini oluşturup onları kullanarak fonksiyonları çağıramazsınız.
* Uygulama tarafından kullanılan şifreli metni, düz metni, anahtarları, IV'leri ve algoritmaları görmek için uygulanan tüm ortak şifreleme yöntemlerini kancalamak için bir kısayol (sslpinnin için olduğu gibi) bulunmamaktadır.

<img src="../../../.gitbook/assets/i3.png" alt="" data-size="original">

**Bug bounty ipucu**: **Intigriti'ye kaydolun**, hackerlar tarafından oluşturulan bir premium **bug bounty platformuna**! Bugün [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) adresinde bize katılın ve **$100,000**'e kadar ödüller kazanmaya başlayın!

{% embed url="https://go.intigriti.com/hacktricks" %}

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sıfırdan kahramana kadar AWS hacklemeyi öğrenin<strong>!</strong></summary>

HackTricks'ı desteklemenin diğer yolları:

* **Şirketinizi HackTricks'te reklam vermek isterseniz** veya **HackTricks'i PDF olarak indirmek isterseniz** [**ABONELİK PLANLARINA**](https://github.com/sponsors/carlospolop) göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* Özel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluşan koleksiyonumuz olan [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'yi keşfedin
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın** veya bizi **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)**'da takip edin**.
* **Hacking hilelerinizi HackTricks** ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına **PR göndererek paylaşın**.

</details>
