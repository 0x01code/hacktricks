# Objection教程

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks云 ☁️</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>🐦 推特 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 Youtube 🎥</strong></a></summary>

* 你在一家**网络安全公司**工作吗？你想在HackTricks中看到你的**公司广告**吗？或者你想获得**PEASS的最新版本或下载HackTricks的PDF**吗？请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 发现我们的独家[**NFTs**](https://opensea.io/collection/the-peass-family)收藏品[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* 获取[**官方PEASS和HackTricks周边产品**](https://peass.creator-spring.com)
* **加入**[**💬**](https://emojipedia.org/speech-balloon/) [**Discord群组**](https://discord.gg/hRep4RUj7f)或[**电报群组**](https://t.me/peass)或**关注**我在**Twitter**上的[**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**。**
* **通过向[hacktricks repo](https://github.com/carlospolop/hacktricks)和[hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)提交PR来分享你的黑客技巧**。

</details>

<img src="../../../.gitbook/assets/i3.png" alt="" data-size="original">

**赏金猎人提示**：**注册**Intigriti，一个由黑客创建的高级**赏金猎人平台**！立即加入我们的[**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks)，开始赚取高达**$100,000**的赏金！

{% embed url="https://go.intigriti.com/hacktricks" %}

## **介绍**

[![objection](https://github.com/sensepost/objection/raw/master/images/objection.png)](https://github.com/sensepost/objection)

**objection - 运行时移动应用探索**

`objection`是一个运行时移动应用探索工具包，由[Frida](https://www.frida.re)提供支持。它的目标是在不需要越狱或获取root权限的移动设备上，帮助评估移动应用及其安全状况。

**注意：**这不是某种越狱/获取root权限的绕过方式。使用`objection`时，您仍然受到所面临的适用沙箱所施加的所有限制。

### 简介

**objection**的目标是让用户调用**Frida提供的主要操作**。否则，用户将需要为每个要测试的应用程序创建**单独的脚本**。

## 教程

在本教程中，我将使用您可以在此处下载的APK：

{% file src="../../../.gitbook/assets/app-release.zip" %}

或从其[原始存储库](https://github.com/asvid/FridaApp)下载app-release.apk

### 安装
```
pip3 install objection
```
### 连接

建立一个**常规的ADB连接**并在设备上**启动**frida服务器（并检查frida在客户端和服务器上是否正常工作）。

如果您使用的是**已root的设备**，则需要在_**--gadget**_选项中选择要测试的应用程序。在这种情况下：
```
objection --gadget asvid.github.io.fridaapp explore
```
### 基本操作

本教程不会列出所有可能的objection命令，只会列出我发现最有用的命令。

#### 环境

一些有趣的信息（如密码或路径）可能在环境中找到。
```
env
```
#### Frida 信息

Frida is a dynamic instrumentation toolkit for developers, reverse-engineers, and security researchers. It allows you to inject JavaScript code into native apps on Windows, macOS, Linux, iOS, Android, and QNX. With Frida, you can monitor and manipulate the behavior of the target app, intercept function calls, modify function arguments, and even bypass SSL pinning.

Frida 是一个供开发人员、逆向工程师和安全研究人员使用的动态插桩工具包。它允许你将 JavaScript 代码注入到 Windows、macOS、Linux、iOS、Android 和 QNX 上的原生应用程序中。使用 Frida，你可以监视和操纵目标应用程序的行为，拦截函数调用，修改函数参数，甚至绕过 SSL 锁定。

#### Objection Information

Objection is a runtime mobile exploration toolkit powered by Frida. It provides a variety of powerful features to assist in the analysis and manipulation of mobile apps. With Objection, you can perform tasks such as exploring the app's runtime state, bypassing SSL pinning, manipulating method return values, and even hooking into native functions.

Objection 是由 Frida 提供支持的运行时移动探索工具包。它提供了各种强大的功能，以帮助分析和操纵移动应用程序。使用 Objection，你可以执行诸如探索应用程序的运行时状态、绕过 SSL 锁定、操纵方法返回值，甚至钩入原生函数等任务。

#### Objection Installation

To install Objection, you need to have Node.js and npm installed on your system. Once you have them installed, you can use the following command to install Objection globally:

```plaintext
npm install -g objection
```

Objection 安装

要安装 Objection，你需要在系统上安装 Node.js 和 npm。安装完成后，你可以使用以下命令全局安装 Objection：

```plaintext
npm install -g objection
```

#### Objection Usage

Once Objection is installed, you can start using it by launching the objection command followed by the name of the app you want to analyze. For example, to analyze an Android app named `com.example.app`, you can use the following command:

```plaintext
objection explore com.example.app
```

Objection 使用

安装完成 Objection 后，你可以通过启动 objection 命令，后跟你想要分析的应用程序的名称，开始使用它。例如，要分析名为 `com.example.app` 的 Android 应用程序，你可以使用以下命令：

```plaintext
objection explore com.example.app
```
```
frida
```
![](<../../../.gitbook/assets/image (65).png>)

#### 上传/下载
```bash
file download <remote path> [<local path>]
file upload <local path> [<remote path>]
```
#### 导入 Frida 脚本

```javascript
const script = await Session.createScript(`
    // Your Frida script code here
`);
```

```javascript
const script = await Session.createScript(`
    // 在这里编写你的 Frida 脚本代码
`);
```
```bash
import <local path frida-script>
```
#### SSLPinning

SSLPinning是一种用于保护移动应用程序通信安全性的技术。它通过验证服务器的SSL证书来防止中间人攻击。在SSL握手期间，移动应用程序会检查服务器的证书是否与预期的证书匹配。如果不匹配，应用程序将拒绝连接。这种技术可以防止攻击者通过使用自签名证书或伪造证书来窃取敏感信息。

在移动应用程序渗透测试中，SSLPinning可能会成为一个挑战，因为它可以阻止我们使用中间人攻击工具来拦截和修改应用程序的通信。然而，我们可以使用Frida和Objection来绕过SSLPinning。

Objection是一个基于Frida的工具，它可以帮助我们在运行时修改应用程序的行为。通过使用Objection，我们可以绕过SSLPinning并拦截应用程序的网络通信。这使得我们能够查看和修改应用程序发送和接收的数据，以及执行其他与网络通信相关的操作。

要绕过SSLPinning，我们可以使用Objection的`sslpinning disable`命令。这将禁用应用程序对SSL证书的验证，从而允许我们进行中间人攻击。然后，我们可以使用Frida的JavaScript API来拦截和修改应用程序的网络请求。

以下是使用Objection绕过SSLPinning的示例命令：

```plaintext
objection -g com.example.app explore
```

```plaintext
android sslpinning disable
```

一旦我们成功绕过了SSLPinning，我们就可以使用其他工具来拦截和修改应用程序的通信，以便进行进一步的渗透测试和漏洞分析。
```bash
android sslpinning disable #Attempts to disable SSL Pinning on Android devices.
```
#### Root检测

Root检测是一种用于检测Android设备是否已经获取了root权限的技术。在移动应用程序渗透测试中，了解应用程序是否能够检测到设备是否已经被root是非常重要的。如果应用程序能够检测到设备已经被root，可能会采取一些安全措施来防止恶意行为。

以下是一些常见的Root检测技术：

- 检查系统文件：应用程序可以检查一些已知的系统文件是否存在，这些文件通常只有在设备已经被root时才会存在。
- 检查系统属性：应用程序可以检查一些已知的系统属性，如`ro.secure`和`ro.debuggable`，来判断设备是否已经被root。
- 检查已安装的应用程序：应用程序可以检查已安装的应用程序列表，以查找已知的root工具或应用程序。
- 检查su二进制文件：应用程序可以检查设备上是否存在`su`二进制文件，这是一个常用的root工具。

为了绕过Root检测，可以使用以下技术：

- 修改系统文件：可以修改一些已知的系统文件，以隐藏设备已经被root的迹象。
- 修改系统属性：可以修改一些已知的系统属性，以隐藏设备已经被root的迹象。
- 隐藏已安装的应用程序：可以隐藏已安装的root工具或应用程序，以避免被检测到。
- 隐藏su二进制文件：可以隐藏`su`二进制文件，以避免被检测到。

了解Root检测技术以及如何绕过这些检测是移动应用程序渗透测试中的重要一环。
```bash
android root disable  #Attempts to disable root detection on Android devices.
android root simulate #Attempts to simulate a rooted Android environment.
```
#### 执行命令

The `exec` command in Objection allows you to execute shell commands on the target Android device. This can be useful for various purposes, such as exploring the device's file system, running additional tools, or interacting with the device's shell.

To use the `exec` command, you need to specify the command you want to execute as an argument. For example, to list the files in the current directory, you can use the following command:

```
objection> exec ls
```

You can also execute commands with arguments by enclosing them in quotes. For example, to display the contents of a specific file, you can use the following command:

```
objection> exec cat "/path/to/file"
```

Keep in mind that the `exec` command runs the specified command on the target device, so be cautious when executing potentially harmful commands.

#### `exec`命令

Objection中的`exec`命令允许您在目标Android设备上执行shell命令。这对于各种目的非常有用，例如探索设备的文件系统、运行其他工具或与设备的shell进行交互。

要使用`exec`命令，您需要将要执行的命令作为参数指定。例如，要列出当前目录中的文件，可以使用以下命令：

```
objection> exec ls
```

您还可以通过将命令及其参数用引号括起来来执行带有参数的命令。例如，要显示特定文件的内容，可以使用以下命令：

```
objection> exec cat "/path/to/file"
```

请记住，`exec`命令在目标设备上运行指定的命令，因此在执行可能有害的命令时要小心。
```bash
android shell_exec whoami
```
#### 屏幕截图

```html
<img src="https://example.com/screenshot.png" alt="Screenshot" width="500"/>
```

#### 代码示例
```bash
android ui screenshot /tmp/screenshot
android ui FLAG_SECURE false  #This may enable you to take screenshots using the hardware keys
```
### 静态分析变为动态分析

在使用objection之前，我们应该通过**静态分析**了解本部分发现的所有信息。无论如何，通过这种方式，您可能会发现**一些新的东西**，因为您将获得一个完整的类、方法和导出对象列表。

如果您无法获取应用程序的可读源代码，这也是有用的。

#### 列出活动、接收器和服务
```
android hooking list activities
```
![](<../../../.gitbook/assets/image (78).png>)
```
android hooking list services
android hooking list receivers
```
如果找不到Frida，它将会报错

#### 获取当前活动
```
android hooking get current_activity
```
#### 搜索类

让我们开始查找应用程序中的类
```
android hooking search classes asvid.github.io.fridaapp
```
#### 搜索类的方法

现在让我们提取类_MainActivity_内的方法：
```
android hooking search methods asvid.github.io.fridaapp MainActivity
```
![](<../../../.gitbook/assets/image (70) (1).png>)

#### 列出类的声明方法及其参数

让我们找出类的方法需要哪些参数：
```
android hooking list class_methods asvid.github.io.fridaapp.MainActivity
```
![](<../../../.gitbook/assets/image (79).png>)

#### 列出类

您还可以列出当前应用程序中加载的所有类：
```
android hooking list classes #List all loaded classes, As the target application gets usedmore, this command will return more classes.
```
这对于想要**钩取一个类的方法，但只知道类名**的情况非常有用。您可以使用此函数来**搜索拥有该类的模块**，然后钩取其方法。

### 钩取非常简单

#### 钩取（监视）一个方法

从应用程序的[源代码](https://github.com/asvid/FridaApp/blob/master/app/src/main/java/asvid/github/io/fridaapp/MainActivity.kt)中，我们知道**MainActivity**中的**函数**_**sum()**_**每秒都在运行**。让我们尝试在每次调用该函数时**转储所有可能的信息**（参数、返回值和回溯）：
```
android hooking watch class_method asvid.github.io.fridaapp.MainActivity.sum --dump-args --dump-backtrace --dump-return
```
![](<../../../.gitbook/assets/image (71).png>)

#### 钩住（监视）整个类

实际上，我发现MainActivity类的所有方法都非常有趣，让我们**钩住它们**。请注意，这可能会导致应用程序**崩溃**。
```
android hooking watch class asvid.github.io.fridaapp.MainActivity --dump-args --dump-return
```
如果您在类被挂钩的情况下操作应用程序，您将看到每个函数被调用时的参数和返回值。

![](<../../../.gitbook/assets/image (72).png>)

#### 更改函数的布尔返回值

从源代码中可以看到，函数_checkPin_接收一个_String_作为参数，并返回一个_boolean_。让我们让这个函数**始终返回true**：

![](<../../../.gitbook/assets/image (74).png>)

现在，如果您在PIN码的文本框中输入任何内容，您将看到任何内容都是有效的：

![](<../../../.gitbook/assets/image (77).png>)

### 类实例

搜索并打印指定的Java类的**活动实例**，由完全限定的类名指定。输出是尝试获取发现的反对意见的字符串值的结果，该值通常**包含对象的属性值**。
```
android heap print_instances <class>
```
![](<../../../.gitbook/assets/image (80).png>)

### Keystore/Intents

您可以使用以下方法来操作密钥库和意图：
```
android keystore list
android intents launch_activity
android intent launch_service
```
#### 内存

##### 转储

在移动应用程序渗透测试中，转储内存是一种常用的技术，用于获取应用程序在运行时的内存快照。这对于分析应用程序的敏感数据、查找漏洞以及进行逆向工程非常有用。

Objection是一个强大的工具，可以帮助我们在Android应用程序中执行各种操作，包括转储内存。使用Objection的`memory dump`命令，我们可以将应用程序的内存转储到本地文件中进行后续分析。

要转储内存，首先需要连接到目标设备上的应用程序。使用Objection的`android connect`命令可以建立与目标设备的连接。然后，使用`memory dump`命令指定要转储的进程ID和输出文件的路径。

以下是转储内存的示例命令：

```plaintext
objection> android connect
objection> memory dump --pid <进程ID> --output <输出文件路径>
```

请注意，转储内存可能需要一些时间，具体取决于应用程序的大小和设备的性能。转储完成后，我们可以使用其他工具（如IDA Pro）来分析转储文件，以查找敏感数据或漏洞。

转储内存是一种强大的技术，但需要谨慎使用。在进行内存转储时，请确保遵守适用法律和道德准则，并获得适当的授权。
```bash
memory dump all <local destination> #Dump all memory
memory dump from_base <base_address> <size_to_dump> <local_destination> #Dump a part
```
#### 列表

---

#### Introduction

#### 介绍

---

#### What is Objection?

#### 什么是Objection？

---

#### Objection is a runtime mobile exploration toolkit, powered by Frida. It was built with the aim of helping assess mobile applications and their security posture without the need for a jailbroken or rooted device.

#### Objection是一个由Frida驱动的运行时移动探索工具包。它的目标是帮助评估移动应用程序及其安全状况，而无需越狱或获取root权限。

---

#### Features

#### 特点

---

#### Some of the features of Objection include:

#### Objection的一些特点包括：

---

- **Interact with the application's runtime state** - Objection allows you to interact with the runtime state of the application, such as inspecting and modifying objects, invoking methods, and more.

- **与应用程序的运行时状态进行交互** - Objection允许您与应用程序的运行时状态进行交互，例如检查和修改对象，调用方法等。

---

- **Explore the application's memory** - Objection provides commands to explore the application's memory, allowing you to search for specific strings, dump memory, and more.

- **探索应用程序的内存** - Objection提供了用于探索应用程序内存的命令，允许您搜索特定字符串，转储内存等。

---

- **Bypass SSL pinning** - Objection includes SSL pinning bypass techniques, allowing you to intercept and analyze network traffic.

- **绕过SSL pinning** - Objection包括绕过SSL pinning的技术，允许您拦截和分析网络流量。

---

- **Inspect and manipulate SQLite databases** - Objection provides commands to inspect and manipulate SQLite databases used by the application.

- **检查和操作SQLite数据库** - Objection提供了用于检查和操作应用程序使用的SQLite数据库的命令。

---

- **Explore the application's file system** - Objection allows you to explore the application's file system, view files, and even upload or download files.

- **探索应用程序的文件系统** - Objection允许您探索应用程序的文件系统，查看文件，甚至上传或下载文件。

---

- **Hook and manipulate method calls** - Objection allows you to hook and manipulate method calls in the application, enabling you to modify the behavior of the application.

- **钩子和操作方法调用** - Objection允许您在应用程序中钩子和操作方法调用，从而可以修改应用程序的行为。

---

#### Installation

#### 安装

---

#### To install Objection, you will need to have Node.js and npm (Node Package Manager) installed on your machine. You can download them from the official Node.js website.

#### 要安装Objection，您需要在计算机上安装Node.js和npm（Node Package Manager）。您可以从官方Node.js网站下载它们。

---

#### Once you have Node.js and npm installed, you can install Objection by running the following command:

#### 安装完Node.js和npm后，您可以通过运行以下命令来安装Objection：

---

```plaintext
$ npm install -g objection
```

```plaintext
$ npm install -g objection
```

---

#### Usage

#### 用法

---

#### To use Objection, you will need to have a mobile application installed on your device or emulator. You can either install the application from an APK file or use an already installed application.

#### 要使用Objection，您需要在设备或模拟器上安装一个移动应用程序。您可以从APK文件安装应用程序，也可以使用已安装的应用程序。

---

#### Once you have the application installed, you can start Objection by running the following command:

#### 安装应用程序后，您可以通过运行以下命令启动Objection：

---

```plaintext
$ objection
```

```plaintext
$ objection
```

---

#### This will start the Objection console, where you can interact with the application and explore its runtime state.

#### 这将启动Objection控制台，您可以在其中与应用程序进行交互并探索其运行时状态。

---

#### Conclusion

#### 结论

---

#### Objection is a powerful tool for mobile application pentesting. It provides a wide range of features that can help you assess the security of mobile applications and identify vulnerabilities. By using Objection, you can interact with the application's runtime state, explore its memory and file system, bypass SSL pinning, inspect and manipulate SQLite databases, and hook and manipulate method calls. With its user-friendly interface, Objection makes mobile application pentesting more accessible and efficient.

#### Objection是一款强大的移动应用程序渗透测试工具。它提供了各种功能，可以帮助您评估移动应用程序的安全性并识别漏洞。通过使用Objection，您可以与应用程序的运行时状态进行交互，探索其内存和文件系统，绕过SSL pinning，检查和操作SQLite数据库，以及钩子和操作方法调用。凭借其用户友好的界面，Objection使移动应用程序渗透测试更加易于使用和高效。
```
memory list modules
```
![](<../../../.gitbook/assets/image (66).png>)

在列表底部，您可以看到Frida：

![](<../../../.gitbook/assets/image (67).png>)

让我们来看看Frida导出了什么：

![](<../../../.gitbook/assets/image (68).png>)

#### 搜索/写入

您还可以使用Objection在内存中进行搜索和写入操作：
```
memory search "<pattern eg: 41 41 41 ?? 41>" (--string) (--offsets-only)
memory write "<address>" "<pattern eg: 41 41 41 41>" (--string)
```
### SQLite

您可以使用命令`sqlite`与SQLite数据库进行交互。

### 退出
```
exit
```
## 我在Objection中缺少的功能

* 钩子方法有时会导致应用程序崩溃（这也是由于Frida）。
* 无法使用类的实例来调用实例的函数。也无法创建新的类实例并使用它们来调用函数。
* 没有快捷方式（类似于sslpinning）来钩住应用程序使用的所有常见加密方法，以查看加密文本、明文、密钥、IV和算法。

<img src="../../../.gitbook/assets/i3.png" alt="" data-size="original">

**Bug赏金提示**：**注册**Intigriti，一个由黑客创建的高级**Bug赏金平台**！立即加入我们的[**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks)，开始赚取高达**$100,000**的赏金！

{% embed url="https://go.intigriti.com/hacktricks" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks云 ☁️</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>🐦 Twitter 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 Youtube 🎥</strong></a></summary>

* 你在一家**网络安全公司**工作吗？想要在HackTricks中**宣传你的公司**吗？或者你想要**获取最新版本的PEASS或下载PDF格式的HackTricks**吗？请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 发现我们的独家[NFT收藏品](https://opensea.io/collection/the-peass-family)——[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* 获取[**官方PEASS和HackTricks周边产品**](https://peass.creator-spring.com)
* **加入**[**💬**](https://emojipedia.org/speech-balloon/) [**Discord群组**](https://discord.gg/hRep4RUj7f)或[**电报群组**](https://t.me/peass)，或在**Twitter**上**关注**我[**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**。**
* **通过向[hacktricks repo](https://github.com/carlospolop/hacktricks)和[hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)提交PR来分享你的黑客技巧**。

</details>
