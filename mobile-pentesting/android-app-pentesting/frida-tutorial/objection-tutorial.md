# Tutorial de Objection

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* ¬øTrabajas en una **empresa de ciberseguridad**? ¬øQuieres ver tu **empresa anunciada en HackTricks**? ¬øO quieres tener acceso a la **√∫ltima versi√≥n de PEASS o descargar HackTricks en PDF**? ¬°Consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obt√©n el [**swag oficial de PEASS y HackTricks**](https://peass.creator-spring.com)
* **√önete al** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de Telegram**](https://t.me/peass) o **s√≠gueme** en **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Comparte tus trucos de hacking enviando PRs al** [**repositorio de hacktricks**](https://github.com/carlospolop/hacktricks) **y al** [**repositorio de hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

<img src="../../../.gitbook/assets/i3.png" alt="" data-size="original">

**Consejo de recompensa por errores**: ¬°**reg√≠strate** en **Intigriti**, una plataforma premium de **recompensas por errores creada por hackers, para hackers**! ¬°√önete a nosotros en [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) hoy mismo y comienza a ganar recompensas de hasta **$100,000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

## **Introducci√≥n**

[![objection](https://github.com/sensepost/objection/raw/master/images/objection.png)](https://github.com/sensepost/objection)

**objection - Exploraci√≥n en tiempo de ejecuci√≥n para dispositivos m√≥viles**

`objection` es un conjunto de herramientas de exploraci√≥n en tiempo de ejecuci√≥n para dispositivos m√≥viles, impulsado por [Frida](https://www.frida.re). Fue creado con el objetivo de ayudar a evaluar aplicaciones m√≥viles y su postura de seguridad sin la necesidad de un dispositivo m√≥vil con jailbreak o root.

**Nota:** Esto no es una forma de evitar el jailbreak / root. Al usar `objection`, a√∫n est√°s limitado por todas las restricciones impuestas por el sandbox correspondiente que est√©s enfrentando.

### Resumen

El **objetivo** de **objection** es permitir al usuario llamar a las **principales acciones que ofrece Frida**. De lo contrario, el usuario deber√° crear un **script √∫nico para cada aplicaci√≥n** que desee probar.

## Tutorial

Para este tutorial, voy a utilizar el APK que puedes descargar aqu√≠:

{% file src="../../../.gitbook/assets/app-release.zip" %}

O desde su [repositorio original](https://github.com/asvid/FridaApp)(descargar app-release.apk)

### Instalaci√≥n
```bash
pip3 install objection
```
### Conexi√≥n

Realiza una **conexi√≥n ADB regular** y **inicia** el servidor **frida** en el dispositivo (y verifica que frida est√© funcionando tanto en el cliente como en el servidor).

Si est√°s utilizando un dispositivo **rooteado**, es necesario seleccionar la aplicaci√≥n que deseas probar dentro de la opci√≥n _**--gadget**_. En este caso:
```bash
frida-ps -Uai
objection --gadget asvid.github.io.fridaapp explore
```
### Acciones b√°sicas

No se listar√°n todos los comandos posibles de Objection en este tutorial, solo los que he encontrado m√°s √∫tiles.

#### Entorno

Algunas informaciones interesantes (como contrase√±as o rutas) se pueden encontrar dentro del entorno.
```bash
env
```
![](<../../../.gitbook/assets/image (64).png>)

#### Informaci√≥n sobre Frida

Frida es una poderosa herramienta de manipulaci√≥n y an√°lisis din√°mico para aplicaciones m√≥viles. Permite a los pentesters y desarrolladores realizar pruebas de penetraci√≥n en aplicaciones Android de manera efectiva.

Frida se basa en la inyecci√≥n de c√≥digo en tiempo de ejecuci√≥n y proporciona una interfaz f√°cil de usar para interactuar con aplicaciones en ejecuci√≥n. Esto permite a los usuarios modificar el comportamiento de las aplicaciones, interceptar llamadas a funciones y acceder a datos sensibles en tiempo real.

Frida es compatible con una amplia gama de dispositivos y arquitecturas, lo que la convierte en una herramienta vers√°til para el pentesting de aplicaciones m√≥viles.

En este tutorial, aprenderemos a utilizar Objection, una extensi√≥n de Frida, para realizar pruebas de penetraci√≥n en aplicaciones Android. Objection proporciona una interfaz de l√≠nea de comandos f√°cil de usar y una API de Python para interactuar con aplicaciones en ejecuci√≥n.

¬°Comencemos!
```bash
frida
```
![](<../../../.gitbook/assets/image (65).png>)

#### Subir/Descargar
```bash
file download <remote path> [<local path>]
file upload <local path> [<remote path>]
```
#### Importar script de frida

```javascript
const objection = require("objection");
```

```javascript
const objection = require("objection");
```
```bash
import <local path frida-script>
```
#### SSLPinning

SSLPinning es una t√©cnica utilizada en aplicaciones m√≥viles para fortalecer la seguridad de las conexiones HTTPS. Normalmente, cuando una aplicaci√≥n se comunica con un servidor a trav√©s de HTTPS, conf√≠a en los certificados emitidos por las autoridades de certificaci√≥n (CA) para validar la autenticidad del servidor. Sin embargo, esto deja la conexi√≥n vulnerable a ataques de intermediarios, donde un atacante puede interceptar y leer el tr√°fico.

Con SSLPinning, la aplicaci√≥n m√≥vil almacena una copia del certificado del servidor en su c√≥digo o en su almacenamiento seguro. Durante la comunicaci√≥n HTTPS, la aplicaci√≥n compara el certificado del servidor con la copia almacenada para asegurarse de que coinciden. Si no coinciden, la conexi√≥n se considera insegura y se interrumpe.

Esta t√©cnica ayuda a prevenir ataques de intermediarios, ya que incluso si un atacante logra interceptar el tr√°fico, no podr√° falsificar el certificado del servidor. Sin embargo, tambi√©n puede dificultar el an√°lisis y la manipulaci√≥n del tr√°fico para fines de pentesting.
```bash
android sslpinning disable #Attempts to disable SSL Pinning on Android devices.
```
#### Detecci√≥n de root

Root detection is a common security measure implemented in many Android applications to prevent them from running on rooted devices. Rooted devices have elevated privileges, which can be exploited by malicious actors to bypass security controls and compromise the application's integrity.

La detecci√≥n de root es una medida de seguridad com√∫n implementada en muchas aplicaciones de Android para evitar que se ejecuten en dispositivos con root. Los dispositivos con root tienen privilegios elevados, que pueden ser explotados por actores maliciosos para eludir los controles de seguridad y comprometer la integridad de la aplicaci√≥n.

There are various techniques used to detect root access on an Android device. Some common methods include checking for the presence of known root files or directories, checking the device's build properties for signs of root access, and using native libraries to perform more advanced checks.

Existen diversas t√©cnicas utilizadas para detectar el acceso root en un dispositivo Android. Algunos m√©todos comunes incluyen verificar la presencia de archivos o directorios root conocidos, verificar las propiedades de compilaci√≥n del dispositivo en busca de indicios de acceso root y utilizar bibliotecas nativas para realizar comprobaciones m√°s avanzadas.

To bypass root detection, an attacker can use tools like Magisk or SuperSU to hide the root access from the application. These tools modify the device's system files and provide a "cloak" for the root access, making it difficult for the application to detect.

Para eludir la detecci√≥n de root, un atacante puede utilizar herramientas como Magisk o SuperSU para ocultar el acceso root de la aplicaci√≥n. Estas herramientas modifican los archivos del sistema del dispositivo y proporcionan un "disfraz" para el acceso root, lo que dificulta su detecci√≥n por parte de la aplicaci√≥n.

As a penetration tester, it is important to understand root detection techniques and how to bypass them. This knowledge can help identify potential vulnerabilities in the application's security controls and provide recommendations for improving its overall security posture.

Como pentester, es importante comprender las t√©cnicas de detecci√≥n de root y c√≥mo eludirlas. Este conocimiento puede ayudar a identificar posibles vulnerabilidades en los controles de seguridad de la aplicaci√≥n y proporcionar recomendaciones para mejorar su postura de seguridad general.
```bash
android root disable  #Attempts to disable root detection on Android devices.
android root simulate #Attempts to simulate a rooted Android environment.
```
#### Comando Exec

The `exec` command in Objection allows you to execute arbitrary commands on the target Android device. This can be useful for performing various actions during a mobile penetration test.

To use the `exec` command, you need to have a Frida session established with the target application. Once you have a session, you can run the `exec` command followed by the command you want to execute.

Here's the syntax for the `exec` command:

```
objection> exec <command>
```

For example, if you want to execute the `ls` command to list the files in the current directory, you would run:

```
objection> exec ls
```

The output of the command will be displayed in the Objection console.

Keep in mind that the `exec` command runs the command on the target device, so be cautious when executing commands that could have unintended consequences. It's always a good practice to thoroughly understand the command you are executing and its potential impact.

#### Comando Exec

El comando `exec` en Objection te permite ejecutar comandos arbitrarios en el dispositivo Android objetivo. Esto puede ser √∫til para realizar diversas acciones durante una prueba de penetraci√≥n m√≥vil.

Para usar el comando `exec`, debes tener una sesi√≥n de Frida establecida con la aplicaci√≥n objetivo. Una vez que tengas una sesi√≥n, puedes ejecutar el comando `exec` seguido del comando que deseas ejecutar.

Aqu√≠ est√° la sintaxis para el comando `exec`:

```
objection> exec <comando>
```

Por ejemplo, si deseas ejecutar el comando `ls` para listar los archivos en el directorio actual, ejecutar√≠as:

```
objection> exec ls
```

La salida del comando se mostrar√° en la consola de Objection.

Ten en cuenta que el comando `exec` ejecuta el comando en el dispositivo objetivo, as√≠ que ten cuidado al ejecutar comandos que puedan tener consecuencias no deseadas. Siempre es una buena pr√°ctica comprender completamente el comando que est√°s ejecutando y su impacto potencial.
```bash
android shell_exec whoami
```
#### Capturas de pantalla
```bash
android ui screenshot /tmp/screenshot
android ui FLAG_SECURE false  #This may enable you to take screenshots using the hardware keys
```
### An√°lisis est√°tico convertido en din√°mico

En una aplicaci√≥n real, deber√≠amos conocer toda la informaci√≥n descubierta en esta parte antes de usar objection gracias al **an√°lisis est√°tico**. De todos modos, de esta manera tal vez puedas ver **algo nuevo**, ya que aqu√≠ solo tendr√°s una lista completa de clases, m√©todos y objetos exportados.

Esto tambi√©n es √∫til si de alguna manera no puedes obtener alg√∫n c√≥digo fuente legible de la aplicaci√≥n.

#### Listar actividades, receptores y servicios
```
android hooking list activities
```
![](<../../../.gitbook/assets/image (78).png>)
```
android hooking list services
android hooking list receivers
```
Frida lanzar√° un error si no se encuentra ninguno

#### Obteniendo la actividad actual
```
android hooking get current_activity
```
#### Buscar Clases

Comencemos buscando clases dentro de nuestra aplicaci√≥n.
```
android hooking search classes asvid.github.io.fridaapp
```
![](<../../../.gitbook/assets/image (69).png>)

#### M√©todos de b√∫squeda de una clase

Ahora vamos a extraer los m√©todos dentro de la clase _MainActivity:_
```
android hooking search methods asvid.github.io.fridaapp MainActivity
```
![](<../../../.gitbook/assets/image (70) (1).png>)

#### Lista los m√©todos declarados de una clase con sus par√°metros

Vamos a averiguar qu√© par√°metros necesitan los m√©todos de la clase:
```
android hooking list class_methods asvid.github.io.fridaapp.MainActivity
```
![](<../../../.gitbook/assets/image (79).png>)

#### Listar clases

Tambi√©n puedes listar todas las clases que se cargaron dentro de la aplicaci√≥n actual:
```
android hooking list classes #List all loaded classes, As the target application gets usedmore, this command will return more classes.
```
Esto es muy √∫til si quieres **interceptar el m√©todo de una clase y solo conoces el nombre de la clase**. Puedes usar esta funci√≥n para **buscar qu√© m√≥dulo es due√±o de la clase** y luego interceptar su m√©todo.

### Interceptar es f√°cil

#### Interceptar (observar) un m√©todo

A partir del [c√≥digo fuente](https://github.com/asvid/FridaApp/blob/master/app/src/main/java/asvid/github/io/fridaapp/MainActivity.kt) de la aplicaci√≥n, sabemos que la **funci√≥n** _**sum()**_ **de** _**MainActivity**_ se ejecuta **cada segundo**. Intentemos **volcar toda la informaci√≥n posible** cada vez que se llama la funci√≥n (argumentos, valor de retorno y traza de ejecuci√≥n):
```
android hooking watch class_method asvid.github.io.fridaapp.MainActivity.sum --dump-args --dump-backtrace --dump-return
```
![](<../../../.gitbook/assets/image (71).png>)

#### Enganchando (observando) una clase completa

En realidad, encuentro todos los m√©todos de la clase MainActivity realmente interesantes, vamos a **engancharlos todos**. Ten cuidado, esto podr√≠a **crashear** una aplicaci√≥n.
```
android hooking watch class asvid.github.io.fridaapp.MainActivity --dump-args --dump-return
```
Si juegas con la aplicaci√≥n mientras la clase est√° enganchada, ver√°s cu√°ndo se llama a cada funci√≥n, sus argumentos y el valor de retorno.

![](<../../../.gitbook/assets/image (72).png>)

#### Cambiar el valor de retorno booleano de una funci√≥n

Desde el c√≥digo fuente, puedes ver que la funci√≥n _checkPin_ recibe un _String_ como argumento y devuelve un _booleano_. Hagamos que la funci√≥n **siempre devuelva verdadero**:

![](<../../../.gitbook/assets/image (74).png>)

Ahora, si escribes algo en el cuadro de texto para el c√≥digo PIN, ver√°s que cualquier cosa es v√°lida:

![](<../../../.gitbook/assets/image (77).png>)

### Instancias de clase

Busca e imprime **instancias en vivo de una clase Java espec√≠fica**, especificada por un nombre de clase completamente calificado. Out es el resultado de un intento de obtener un valor de cadena para una objeci√≥n descubierta que t√≠picamente **contendr√≠a valores de propiedad para el objeto**.
```
android heap print_instances <class>
```
![](<../../../.gitbook/assets/image (80).png>)

### Keystore/Intents

Puedes jugar con el keystore y los intents usando:
```
android keystore list
android intents launch_activity
android intent launch_service
```
#### Volcado

El volcado de memoria es una t√©cnica utilizada para extraer el contenido de la memoria de un dispositivo o aplicaci√≥n. Esto puede ser √∫til durante una prueba de penetraci√≥n para analizar y buscar informaci√≥n sensible o para comprender mejor c√≥mo funciona una aplicaci√≥n.

En el contexto de Android, el volcado de memoria se puede realizar utilizando herramientas como Objection. Objection es una herramienta de prueba de penetraci√≥n que utiliza Frida para manipular aplicaciones Android en tiempo de ejecuci√≥n.

Para realizar un volcado de memoria utilizando Objection, primero debemos conectar Objection a la aplicaci√≥n objetivo. Luego, podemos usar el comando `memory dump` para extraer el contenido de la memoria de la aplicaci√≥n.

```plaintext
$ objection -g com.example.app explore
     _     _         _   _
    | |   (_)       | | (_)
  __| | __ _  __ _  | |_ _  ___  _ __  ___
 / _` |/ _` |/ _` | | __| |/ _ \| '_ \/ __|
| (_| | (_| | (_| | | |_| | (_) | | | \__ \
 \__,_|\__,_|\__, |  \__|_|\___/|_| |_|___/
             __/ |
            |___/

        Runtime Mobile Exploration
        by: @leonjza from @sensepost

[tab] for command suggestions
Connected to com.example.app

com.example.app $ memory dump
[*] Dumping memory...
[*] Memory dumped successfully to: /data/local/tmp/objection_dump_20210101_123456.bin
```

Una vez que se completa el volcado de memoria, el contenido se guarda en un archivo binario en el dispositivo. Este archivo binario puede ser analizado posteriormente para buscar informaci√≥n sensible o realizar an√°lisis forenses.
```bash
memory dump all <local destination> #Dump all memory
memory dump from_base <base_address> <size_to_dump> <local_destination> #Dump a part
```
#### Lista
```
memory list modules
```
![](<../../../.gitbook/assets/image (66).png>)

En la parte inferior de la lista puedes ver frida:

![](<../../../.gitbook/assets/image (67).png>)

Veamos qu√© est√° exportando frida:

![](<../../../.gitbook/assets/image (68).png>)

#### B√∫squeda/Escritura

Tambi√©n puedes buscar y escribir en la memoria con objection:
```
memory search "<pattern eg: 41 41 41 ?? 41>" (--string) (--offsets-only)
memory write "<address>" "<pattern eg: 41 41 41 41>" (--string)
```
### SQLite

Puedes usar el comando `sqlite` para interactuar con bases de datos sqlite.

### Salir
```
exit
```
## Lo que echo de menos en Objection

* Los m√©todos de enganche a veces hacen que la aplicaci√≥n se bloquee (esto tambi√©n se debe a Frida).
* No puedes usar las instancias de las clases para llamar a funciones de la instancia. Y no puedes crear nuevas instancias de clases y usarlas para llamar a funciones.
* No hay un atajo (como el de sslpinnin) para enganchar todos los m√©todos de cifrado comunes que utiliza la aplicaci√≥n para ver texto cifrado, texto plano, claves, IV y algoritmos utilizados.

<img src="../../../.gitbook/assets/i3.png" alt="" data-size="original">

**Consejo para recompensas por errores**: **reg√≠strate** en **Intigriti**, una plataforma premium de **recompensas por errores creada por hackers, para hackers**. √önete a nosotros en [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) hoy mismo y comienza a ganar recompensas de hasta **$100,000**.

{% embed url="https://go.intigriti.com/hacktricks" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* ¬øTrabajas en una **empresa de ciberseguridad**? ¬øQuieres ver tu **empresa anunciada en HackTricks**? ¬øO quieres tener acceso a la **√∫ltima versi√≥n de PEASS o descargar HackTricks en PDF**? ¬°Consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obt√©n el [**merchandising oficial de PEASS y HackTricks**](https://peass.creator-spring.com)
* **√önete al** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de Telegram**](https://t.me/peass) o **s√≠gueme** en **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Comparte tus trucos de hacking enviando PR al** [**repositorio de hacktricks**](https://github.com/carlospolop/hacktricks) **y al** [**repositorio de hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
