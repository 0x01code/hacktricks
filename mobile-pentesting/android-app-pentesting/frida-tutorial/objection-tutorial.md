# Tutoriel Objection

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Travaillez-vous dans une **entreprise de cybers√©curit√©** ? Voulez-vous voir votre **entreprise annonc√©e dans HackTricks** ? ou voulez-vous avoir acc√®s √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFT**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**üí¨**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR au** [**repo hacktricks**](https://github.com/carlospolop/hacktricks) **et au** [**repo hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

<img src="../../../.gitbook/assets/i3.png" alt="" data-size="original">

**Astuce de bug bounty** : **inscrivez-vous** sur **Intigriti**, une plateforme premium de **bug bounty cr√©√©e par des hackers, pour des hackers** ! Rejoignez-nous sur [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) d√®s aujourd'hui et commencez √† gagner des primes allant jusqu'√† **100 000 $** !

{% embed url="https://go.intigriti.com/hacktricks" %}

## **Introduction**

[![objection](https://github.com/sensepost/objection/raw/master/images/objection.png)](https://github.com/sensepost/objection)

**objection - Exploration mobile en temps d'ex√©cution**

`objection` est une bo√Æte √† outils d'exploration mobile en temps d'ex√©cution, aliment√©e par [Frida](https://www.frida.re). Elle a √©t√© con√ßue dans le but d'aider √† √©valuer les applications mobiles et leur posture de s√©curit√© sans avoir besoin d'un appareil mobile jailbreak√© ou root√©.

**Note :** Il ne s'agit pas d'une forme de contournement de jailbreak / root. En utilisant `objection`, vous √™tes toujours limit√© par toutes les restrictions impos√©es par le sandbox applicable auquel vous √™tes confront√©.

### R√©sum√©

L'**objectif** d'**objection** est de permettre √† l'utilisateur d'appeler les **principales actions offertes par Frida**. **Sinon**, l'utilisateur devra cr√©er un **script unique pour chaque application** qu'il souhaite tester.

## Tutoriel

Pour ce tutoriel, je vais utiliser l'APK que vous pouvez t√©l√©charger ici :

{% file src="../../../.gitbook/assets/app-release.zip" %}

Ou depuis son [d√©p√¥t d'origine](https://github.com/asvid/FridaApp)(t√©l√©chargez app-release.apk)

### Installation
```bash
pip3 install objection
```
### Connexion

√âtablissez une **connexion ADB classique** et **d√©marrez** le serveur **frida** sur l'appareil (et v√©rifiez que frida fonctionne √† la fois sur le client et sur le serveur).

Si vous utilisez un **appareil root√©**, il est n√©cessaire de s√©lectionner l'application que vous souhaitez tester dans l'option _**--gadget**_. Dans ce cas :
```bash
frida-ps -Uai
objection --gadget asvid.github.io.fridaapp explore
```
### Actions de base

Toutes les commandes possibles d'Objection ne seront pas r√©pertori√©es dans ce tutoriel, seulement celles que j'ai trouv√©es les plus utiles.

#### Environnement

Certaines informations int√©ressantes (comme les mots de passe ou les chemins d'acc√®s) peuvent √™tre trouv√©es dans l'environnement.
```bash
env
```
![](<../../../.gitbook/assets/image (64).png>)

#### Informations sur Frida
```bash
frida
```
![](<../../../.gitbook/assets/image (65).png>)

#### T√©l√©chargement/T√©l√©versement
```bash
file download <remote path> [<local path>]
file upload <local path> [<remote path>]
```
#### Importer le script frida

```javascript
const { spawn } = require('child_process');
const frida = require('frida');

async function main() {
  const device = await frida.getUsbDevice();
  const pid = await device.spawn(['com.example.app']);
  const session = await device.attach(pid);
  const script = await session.createScript(`
    console.log('Hello, world!');
  `);
  await script.load();
  await device.resume(pid);
}

main().catch(console.error);
```

#### Importer le script frida

```javascript
const { spawn } = require('child_process');
const frida = require('frida');

async function main() {
  const device = await frida.getUsbDevice();
  const pid = await device.spawn(['com.example.app']);
  const session = await device.attach(pid);
  const script = await session.createScript(`
    console.log('Bonjour, le monde !');
  `);
  await script.load();
  await device.resume(pid);
}

main().catch(console.error);
```
```bash
import <local path frida-script>
```
#### SSLPinning

Le SSL pinning (√©pinglage SSL) est une technique utilis√©e pour renforcer la s√©curit√© des connexions SSL/TLS dans une application mobile. Il consiste √† v√©rifier l'empreinte digitale (ou le certificat) du serveur distant auquel l'application se connecte, afin de s'assurer qu'il s'agit bien du serveur attendu.

Dans le contexte du piratage d'applications Android, le SSL pinning peut poser un d√©fi lors de l'analyse de trafic r√©seau √† l'aide d'outils tels que Frida et Objection. Lorsque le SSL pinning est activ√©, l'application v√©rifie si le certificat du serveur correspond √† celui attendu. Si ce n'est pas le cas, l'application peut refuser la connexion ou afficher un avertissement √† l'utilisateur.

Pour contourner le SSL pinning lors du piratage d'une application Android, nous pouvons utiliser des techniques telles que l'injection de code avec Frida. En modifiant le comportement de l'application, nous pouvons d√©sactiver ou contourner la v√©rification du certificat SSL, permettant ainsi d'analyser le trafic r√©seau √† l'aide d'outils tels que Burp Suite ou Wireshark.

Il est important de noter que le contournement du SSL pinning est une pratique controvers√©e et peut √™tre consid√©r√©e comme une violation de la s√©curit√© de l'application. Il est donc essentiel de l'utiliser uniquement √† des fins de test de s√©curit√© l√©gitimes et avec l'autorisation appropri√©e.
```bash
android sslpinning disable #Attempts to disable SSL Pinning on Android devices.
```
#### D√©tection de root

La d√©tection de root est une technique couramment utilis√©e pour v√©rifier si un appareil Android est enracin√© (root√©). L'enracinement d'un appareil Android permet √† l'utilisateur d'obtenir un acc√®s privil√©gi√© et un contr√¥le total sur le syst√®me d'exploitation. Cependant, cela peut √©galement pr√©senter des risques de s√©curit√©, car les applications malveillantes peuvent exploiter les privil√®ges de root pour acc√©der √† des fonctionnalit√©s sensibles ou effectuer des actions ind√©sirables.

Les d√©veloppeurs d'applications peuvent impl√©menter des m√©canismes de d√©tection de root pour emp√™cher l'ex√©cution de leur application sur des appareils enracin√©s. Ces m√©canismes peuvent inclure la v√©rification de la pr√©sence de fichiers syst√®me sp√©cifiques, la recherche de signatures de superutilisateurs ou l'utilisation d'APIs de d√©tection de root.

Lors de l'√©valuation de la s√©curit√© d'une application Android, il est important de tester si elle peut √™tre ex√©cut√©e sur des appareils enracin√©s. Cela peut √™tre fait en utilisant des outils tels que Objection, qui permettent de contourner les m√©canismes de d√©tection de root et de tester la r√©sistance de l'application √† ce type d'attaque.

Objection est un outil de pentesting mobile qui utilise Frida, un framework d'instrumentation dynamique, pour contourner les m√©canismes de s√©curit√© des applications Android. Il permet aux testeurs de s√©curit√© d'interagir avec l'application en temps r√©el, d'analyser son comportement et de modifier son ex√©cution.

Pour contourner la d√©tection de root avec Objection, vous pouvez utiliser la commande `android root disable`. Cela d√©sactive les m√©canismes de d√©tection de root de l'application, ce qui permet de l'ex√©cuter sur des appareils enracin√©s. Cependant, il est important de noter que cela peut √©galement exposer l'application √† des risques de s√©curit√© suppl√©mentaires, car elle ne sera plus prot√©g√©e contre les actions malveillantes potentielles des applications enracin√©es.

Il est recommand√© de tester l'application sur des appareils enracin√©s uniquement dans un environnement contr√¥l√© et s√©curis√©, tel qu'un environnement de test ou un sandbox. Cela permet de minimiser les risques de s√©curit√© et de s'assurer que l'application fonctionne correctement sur des appareils enracin√©s sans compromettre la s√©curit√© des utilisateurs finaux.
```bash
android root disable  #Attempts to disable root detection on Android devices.
android root simulate #Attempts to simulate a rooted Android environment.
```
#### Ex√©cuter une commande

The `exec` command in Objection allows you to execute shell commands on the target Android device. This can be useful for performing various actions during a mobile penetration test.

To use the `exec` command, you need to have a Frida session established with the target application. Once you have a session, you can run shell commands by using the following syntax:

```
objection> exec <command>
```

Replace `<command>` with the shell command you want to execute. For example, if you want to list the files in the current directory, you can use the `ls` command:

```
objection> exec ls
```

The output of the command will be displayed in the Objection console. You can also redirect the output to a file by using the `>` operator. For example, to save the output of the `ls` command to a file named `files.txt`, you can use the following command:

```
objection> exec ls > files.txt
```

Keep in mind that the `exec` command runs the shell command on the target device, so be cautious when executing commands that may have unintended consequences.
```bash
android shell_exec whoami
```
#### Captures d'√©cran
```bash
android ui screenshot /tmp/screenshot
android ui FLAG_SECURE false  #This may enable you to take screenshots using the hardware keys
```
### Analyse statique rendue dynamique

Dans une application r√©elle, nous devrions conna√Ætre toutes les informations d√©couvertes dans cette partie avant d'utiliser objection gr√¢ce √† l'**analyse statique**. Quoi qu'il en soit, de cette mani√®re, vous pouvez peut-√™tre voir **quelque chose de nouveau**, car vous aurez uniquement une liste compl√®te des classes, des m√©thodes et des objets export√©s.

Cela est √©galement utile si, d'une mani√®re ou d'une autre, vous √™tes **incapable d'obtenir du code source lisible** de l'application.

#### Liste des activit√©s, des r√©cepteurs et des services
```
android hooking list activities
```
![](<../../../.gitbook/assets/image (78).png>)
```
android hooking list services
android hooking list receivers
```
Frida affichera une erreur si aucune activit√© n'est trouv√©e.

#### Obtenir l'activit√© en cours
```
android hooking get current_activity
```
#### Recherche de classes

Commen√ßons par rechercher les classes dans notre application.
```
android hooking search classes asvid.github.io.fridaapp
```
![](<../../../.gitbook/assets/image (69).png>)

#### Recherche des m√©thodes d'une classe

Maintenant, extrayons les m√©thodes √† l'int√©rieur de la classe _MainActivity:_
```
android hooking search methods asvid.github.io.fridaapp MainActivity
```
![](<../../../.gitbook/assets/image (70) (1).png>)

#### Liste des m√©thodes d√©clar√©es d'une classe avec leurs param√®tres

Voyons quels param√®tres les m√©thodes de la classe n√©cessitent :
```
android hooking list class_methods asvid.github.io.fridaapp.MainActivity
```
![](<../../../.gitbook/assets/image (79).png>)

#### Liste des classes

Vous pouvez √©galement r√©pertorier toutes les classes qui ont √©t√© charg√©es dans l'application actuelle :
```
android hooking list classes #List all loaded classes, As the target application gets usedmore, this command will return more classes.
```
Ceci est tr√®s utile si vous souhaitez **accrocher la m√©thode d'une classe et que vous ne connaissez que le nom de la classe**. Vous pouvez utiliser cette fonction pour **rechercher le module qui poss√®de la classe** puis accrocher sa m√©thode.

### Accrocher √©tant facile

#### Accrocher (surveiller) une m√©thode

√Ä partir du [code source](https://github.com/asvid/FridaApp/blob/master/app/src/main/java/asvid/github/io/fridaapp/MainActivity.kt) de l'application, nous savons que la **fonction** _**sum()**_ **de** _**MainActivity**_ est ex√©cut√©e **toutes les secondes**. Essayons de **dumper toutes les informations possibles** √† chaque fois que la fonction est appel√©e (arguments, valeur de retour et backtrace) :
```
android hooking watch class_method asvid.github.io.fridaapp.MainActivity.sum --dump-args --dump-backtrace --dump-return
```
![](<../../../.gitbook/assets/image (71).png>)

#### Accrocher (surveiller) une classe enti√®re

En fait, je trouve tous les m√©thodes de la classe MainActivity vraiment int√©ressantes, accrochons-les toutes. Soyez prudent, cela pourrait provoquer un **plantage** de l'application.
```
android hooking watch class asvid.github.io.fridaapp.MainActivity --dump-args --dump-return
```
Si vous jouez avec l'application pendant que la classe est accroch√©e, vous verrez quand **chaque fonction est appel√©e**, ses **arguments** et la valeur de **retour**.

![](<../../../.gitbook/assets/image (72).png>)

#### Changer la valeur de retour bool√©enne d'une fonction

√Ä partir du code source, vous pouvez voir que la fonction _checkPin_ re√ßoit une _String_ en argument et renvoie un _boolean_. Faisons en sorte que la fonction **renvoie toujours true** :

![](<../../../.gitbook/assets/image (74).png>)

Maintenant, si vous √©crivez quelque chose dans la zone de texte pour le code PIN, vous verrez que tout est valide :

![](<../../../.gitbook/assets/image (77).png>)

### Instances de classe

Recherchez et affichez les **instances en direct d'une classe Java sp√©cifique**, sp√©cifi√©e par un nom de classe enti√®rement qualifi√©. Out est le r√©sultat d'une tentative d'obtenir une valeur de cha√Æne pour une objection d√©couverte qui contiendrait g√©n√©ralement **les valeurs des propri√©t√©s de l'objet**.
```
android heap print_instances <class>
```
![](<../../../.gitbook/assets/image (80).png>)

### Keystore/Intents

Vous pouvez jouer avec le keystore et les intents en utilisant:
```
android keystore list
android intents launch_activity
android intent launch_service
```
#### Dump

La fonction `dump` de Frida permet de cr√©er une copie de la m√©moire d'une application Android. Cela peut √™tre utile pour analyser le contenu de la m√©moire, y compris les variables, les objets et les donn√©es sensibles.

Pour utiliser la fonction `dump`, vous devez d'abord vous connecter √† l'application cible √† l'aide de Frida. Une fois connect√©, vous pouvez ex√©cuter la commande `dump()` pour cr√©er une copie de la m√©moire.

Voici un exemple d'utilisation de la fonction `dump` :

```javascript
Java.perform(function () {
  var targetClass = Java.use('com.example.app.MainActivity');
  var targetInstance = targetClass.$new();

  // Appeler la fonction dump pour cr√©er une copie de la m√©moire
  targetInstance.dump();
});
```

Lorsque vous ex√©cutez cette commande, Frida cr√©era un fichier de dump contenant la m√©moire de l'application. Vous pouvez ensuite analyser ce fichier pour rechercher des informations sensibles ou des vuln√©rabilit√©s potentielles.

Il est important de noter que l'utilisation de la fonction `dump` peut √™tre consid√©r√©e comme intrusive et peut violer la vie priv√©e de l'utilisateur de l'application. Par cons√©quent, il est essentiel de respecter les lois et les r√©glementations en vigueur lors de l'utilisation de cette fonctionnalit√©.
```bash
memory dump all <local destination> #Dump all memory
memory dump from_base <base_address> <size_to_dump> <local_destination> #Dump a part
```
#### Liste
```
memory list modules
```
![](<../../../.gitbook/assets/image (66).png>)

En bas de la liste, vous pouvez voir frida :

![](<../../../.gitbook/assets/image (67).png>)

Voyons ce que frida exporte :

![](<../../../.gitbook/assets/image (68).png>)

#### Recherche/√âcriture

Vous pouvez √©galement rechercher et √©crire dans la m√©moire avec objection :
```
memory search "<pattern eg: 41 41 41 ?? 41>" (--string) (--offsets-only)
memory write "<address>" "<pattern eg: 41 41 41 41>" (--string)
```
### SQLite

Vous pouvez utiliser la commande `sqlite` pour interagir avec les bases de donn√©es SQLite.

### Sortie
```
exit
```
## Ce qui manque dans Objection

* Les m√©thodes de hooking font parfois planter l'application (cela est √©galement d√ª √† Frida).
* Vous ne pouvez pas utiliser les instances des classes pour appeler les fonctions de l'instance. Et vous ne pouvez pas cr√©er de nouvelles instances de classes et les utiliser pour appeler des fonctions.
* Il n'y a pas de raccourci (comme celui pour sslpinnin) pour hooker toutes les m√©thodes de chiffrement couramment utilis√©es par l'application afin de voir le texte chiffr√©, le texte en clair, les cl√©s, les IV et les algorithmes utilis√©s.

<img src="../../../.gitbook/assets/i3.png" alt="" data-size="original">

**Astuce pour les chasseurs de bugs** : **inscrivez-vous** sur **Intigriti**, une plateforme premium de **chasse aux bugs cr√©√©e par des hackers, pour des hackers** ! Rejoignez-nous sur [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) d√®s aujourd'hui et commencez √† gagner des primes allant jusqu'√† **100 000 $** !

{% embed url="https://go.intigriti.com/hacktricks" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Vous travaillez dans une **entreprise de cybers√©curit√©** ? Vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ? ou souhaitez-vous avoir acc√®s √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFT**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**üí¨**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR au** [**repo hacktricks**](https://github.com/carlospolop/hacktricks) **et au** [**repo hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
