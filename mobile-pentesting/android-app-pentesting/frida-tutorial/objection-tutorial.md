# Tutorial de Objection

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* ¬øTrabajas en una **empresa de ciberseguridad**? ¬øQuieres ver tu **empresa anunciada en HackTricks**? ¬øO quieres tener acceso a la **√∫ltima versi√≥n de PEASS o descargar HackTricks en PDF**? ¬°Consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n de exclusivos [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obt√©n el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* **√önete al** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠gueme** en **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Comparte tus trucos de hacking enviando PRs al [repositorio de hacktricks](https://github.com/carlospolop/hacktricks) y al [repositorio de hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>

<img src="../../../.gitbook/assets/i3.png" alt="" data-size="original">

**Consejo de recompensa por errores**: **reg√≠strate** en **Intigriti**, una plataforma premium de **recompensas por errores creada por hackers, para hackers**. ¬°√önete a nosotros en [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) hoy mismo y comienza a ganar recompensas de hasta **$100,000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

## **Introducci√≥n**

[![objection](https://github.com/sensepost/objection/raw/master/images/objection.png)](https://github.com/sensepost/objection)

**objection - Exploraci√≥n en tiempo de ejecuci√≥n de dispositivos m√≥viles**

`objection` es un kit de herramientas de exploraci√≥n en tiempo de ejecuci√≥n de dispositivos m√≥viles, impulsado por [Frida](https://www.frida.re). Fue construido con el objetivo de ayudar a evaluar las aplicaciones m√≥viles y su postura de seguridad sin la necesidad de un dispositivo m√≥vil con jailbreak o root.

**Nota:** Esto no es alguna forma de bypass de jailbreak/root. Al usar `objection`, todav√≠a est√°s limitado por todas las restricciones impuestas por el sandbox aplicable que est√°s enfrentando.

### Resumen

El **objetivo** de **objection** es permitir al usuario llamar a las **acciones principales que ofrece Frida**. **De lo contrario**, el usuario necesitar√° crear un **script √∫nico para cada aplicaci√≥n** que quiera probar.

## Tutorial

Para este tutorial voy a usar el APK que puedes descargar aqu√≠:

{% file src="../../../.gitbook/assets/app-release.zip" %}

O desde su [repositorio original](https://github.com/asvid/FridaApp)(descarga app-release.apk)

### Instalaci√≥n
```
pip3 install objection
```
### Conexi√≥n

Realice una **conexi√≥n ADB regular** y **inicie** el servidor **frida** en el dispositivo (y verifique que frida est√© funcionando tanto en el cliente como en el servidor).

Si est√° utilizando un dispositivo **rooteado**, es necesario seleccionar la aplicaci√≥n que desea probar dentro de la opci√≥n _**--gadget**_. En este caso:
```
objection --gadget asvid.github.io.fridaapp explore
```
### Acciones B√°sicas

No se listar√°n todos los comandos posibles de Objection en este tutorial, solo aquellos que he encontrado m√°s √∫tiles.

#### Entorno

Alguna informaci√≥n interesante (como contrase√±as o rutas) podr√≠a encontrarse dentro del entorno.
```
env
```
#### Informaci√≥n de Frida
```
frida
```
#### Subir/Descargar
```bash
file download <remote path> [<local path>]
file upload <local path> [<remote path>]
```
#### Importar script de frida
```bash
import <local path frida-script>
```
#### SSLPinning

El SSLPinning es una t√©cnica de seguridad utilizada en aplicaciones m√≥viles para evitar ataques Man-in-the-Middle (MitM) mediante la validaci√≥n de los certificados SSL/TLS del servidor. En lugar de confiar en la cadena de certificados del sistema operativo, la aplicaci√≥n m√≥vil conf√≠a en un conjunto espec√≠fico de certificados emitidos por el servidor. Esto hace que sea m√°s dif√≠cil para un atacante interceptar y leer el tr√°fico de red entre la aplicaci√≥n y el servidor. 

Objection proporciona una herramienta llamada `sslpinning disable` que permite deshabilitar el SSLPinning en una aplicaci√≥n m√≥vil. Esto puede ser √∫til para realizar pruebas de penetraci√≥n y encontrar vulnerabilidades en la aplicaci√≥n. Sin embargo, es importante tener en cuenta que deshabilitar el SSLPinning puede dejar la aplicaci√≥n vulnerable a ataques MitM.
```bash
android sslpinning disable #Attempts to disable SSL Pinning on Android devices.
```
#### Detecci√≥n de root
```bash
android root disable  #Attempts to disable root detection on Android devices.
android root simulate #Attempts to simulate a rooted Android environment.
```
#### Comando Exec
```bash
android shell_exec whoami
```
#### Capturas de pantalla
```bash
android ui screenshot /tmp/screenshot
android ui FLAG_SECURE false  #This may enable you to take screenshots using the hardware keys
```
### An√°lisis est√°tico convertido en din√°mico

En una aplicaci√≥n real deber√≠amos conocer toda la informaci√≥n descubierta en esta parte antes de usar objection gracias al **an√°lisis est√°tico**. De todas maneras, de esta manera quiz√°s puedas ver **algo nuevo** ya que aqu√≠ solo tendr√°s una lista completa de clases, m√©todos y objetos exportados.

Esto tambi√©n es √∫til si de alguna manera eres **incapaz de obtener alg√∫n c√≥digo fuente legible** de la aplicaci√≥n.

#### Listar actividades, receptores y servicios
```
android hooking list activities
```
![](<../../../.gitbook/assets/image (78).png>)

El objetivo de este tutorial es presentar Objection, una herramienta que utiliza Frida para realizar pruebas de penetraci√≥n en aplicaciones m√≥viles de Android. Objection nos permite interactuar con la aplicaci√≥n en tiempo de ejecuci√≥n, lo que nos permite manipular su comportamiento y analizar su seguridad. En este tutorial, cubriremos los siguientes temas:

- Instalaci√≥n de Objection
- Configuraci√≥n de un dispositivo Android para su uso con Objection
- Uso de Objection para realizar pruebas de penetraci√≥n en una aplicaci√≥n m√≥vil de Android

Antes de continuar con este tutorial, es importante tener conocimientos b√°sicos de Frida y c√≥mo funciona. Si no est√° familiarizado con Frida, le recomendamos que consulte nuestro tutorial de Frida antes de continuar.
```
android hooking list services
android hooking list receivers
```
Frida lanzar√° un error si no se encuentra ninguna.

#### Obteniendo la actividad actual
```
android hooking get current_activity
```
#### Buscar Clases

Comencemos buscando clases dentro de nuestra aplicaci√≥n.
```
android hooking search classes asvid.github.io.fridaapp
```
#### M√©todos de b√∫squeda de una clase

Ahora vamos a extraer los m√©todos dentro de la clase _MainActivity:_
```
android hooking search methods asvid.github.io.fridaapp MainActivity
```
#### Listar los m√©todos declarados de una clase con sus par√°metros

Veamos qu√© par√°metros necesitan los m√©todos de la clase:
```
android hooking list class_methods asvid.github.io.fridaapp.MainActivity
```
#### Listar clases

Tambi√©n puedes listar todas las clases que se cargaron dentro de la aplicaci√≥n actual:
```
android hooking list classes #List all loaded classes, As the target application gets usedmore, this command will return more classes.
```
Esto es muy √∫til si quieres **enganchar el m√©todo de una clase y solo conoces el nombre de la clase**. Puedes usar esta funci√≥n para **buscar qu√© m√≥dulo es due√±o de la clase** y luego enganchar su m√©todo.

### Enganchar es f√°cil

#### Enganchar (observar) un m√©todo

A partir del [c√≥digo fuente](https://github.com/asvid/FridaApp/blob/master/app/src/main/java/asvid/github/io/fridaapp/MainActivity.kt) de la aplicaci√≥n, sabemos que la **funci√≥n** _**sum()**_ **de** _**MainActivity**_ se ejecuta **cada segundo**. Intentemos **volcar toda la informaci√≥n posible** cada vez que se llama a la funci√≥n (argumentos, valor de retorno y backtrace):
```
android hooking watch class_method asvid.github.io.fridaapp.MainActivity.sum --dump-args --dump-backtrace --dump-return
```
#### Enganchando (observando) una clase completa

En realidad, encuentro todos los m√©todos de la clase MainActivity realmente interesantes, vamos a **engancharlos todos**. Ten cuidado, esto podr√≠a **hacer que la aplicaci√≥n se bloquee**.
```
android hooking watch class asvid.github.io.fridaapp.MainActivity --dump-args --dump-return
```
Si juegas con la aplicaci√≥n mientras la clase est√° enganchada, ver√°s cu√°ndo se llama a cada funci√≥n, sus argumentos y el valor de retorno.

![](<../../../.gitbook/assets/image (72).png>)

#### Cambiar el valor de retorno booleano de una funci√≥n

Desde el c√≥digo fuente, puedes ver que la funci√≥n _checkPin_ recibe un _String_ como argumento y devuelve un _boolean_. Hagamos que la funci√≥n **siempre devuelva verdadero**:

![](<../../../.gitbook/assets/image (74).png>)

Ahora, si escribes cualquier cosa en el cuadro de texto para el c√≥digo PIN, ver√°s que todo es v√°lido:

![](<../../../.gitbook/assets/image (77).png>)

### Instancias de clase

Busca e imprime **instancias en vivo de una clase Java espec√≠fica**, especificada por un nombre de clase completamente calificado. Out es el resultado de un intento de obtener un valor de cadena para una objeci√≥n descubierta que t√≠picamente **contendr√≠a valores de propiedad para el objeto**.
```
android heap print_instances <class>
```
### Keystore/Intents

Puedes jugar con el keystore y los intents usando:
```
android keystore list
android intents launch_activity
android intent launch_service
```
### Memoria

#### Volcado
```bash
memory dump all <local destination> #Dump all memory
memory dump from_base <base_address> <size_to_dump> <local_destination> #Dump a part
```
#### Lista
```
memory list modules
```
![](<../../../.gitbook/assets/image (66).png>)

En la parte inferior de la lista se puede ver frida:

![](<../../../.gitbook/assets/image (67).png>)

Veamos qu√© est√° exportando frida:

![](<../../../.gitbook/assets/image (68).png>)

#### Buscar/Escribir

Tambi√©n se puede buscar y escribir en la memoria con objection:
```
memory search "<pattern eg: 41 41 41 ?? 41>" (--string) (--offsets-only)
memory write "<address>" "<pattern eg: 41 41 41 41>" (--string)
```
### SQLite

Puedes usar el comando `sqlite` para interactuar con bases de datos SQLite.

### Salir
```
exit
```
## Lo que falta en Objection

* Los m√©todos de enganche a veces hacen que la aplicaci√≥n se bloquee (esto tambi√©n se debe a Frida).
* No se pueden utilizar las instancias de las clases para llamar a las funciones de la instancia. Y no se pueden crear nuevas instancias de clases y usarlas para llamar a funciones.
* No hay un atajo (como el de sslpinnin) para enganchar todos los m√©todos de cifrado comunes que utiliza la aplicaci√≥n para ver el texto cifrado, el texto plano, las claves, los IV y los algoritmos utilizados.



<img src="../../../.gitbook/assets/i3.png" alt="" data-size="original">

**Consejo de recompensa por errores**: **reg√≠strese** en **Intigriti**, una plataforma premium de **recompensas por errores creada por hackers, para hackers**! √önase a nosotros en [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) hoy mismo y comience a ganar recompensas de hasta **$100,000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* ¬øTrabaja en una **empresa de ciberseguridad**? ¬øQuiere ver su **empresa anunciada en HackTricks**? ¬øO quiere tener acceso a la **√∫ltima versi√≥n de PEASS o descargar HackTricks en PDF**? ¬°Consulte los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Descubra [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obtenga el [**swag oficial de PEASS y HackTricks**](https://peass.creator-spring.com)
* **√önase al** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠game** en **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Comparta sus trucos de hacking enviando PR al [repositorio de hacktricks](https://github.com/carlospolop/hacktricks) y al [repositorio de hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>
