# Tutorial de Objection

<details>

<summary><strong>Aprende hacking en AWS de cero a héroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF**, consulta los [**PLANES DE SUSCRIPCIÓN**](https://github.com/sponsors/carlospolop)!
* Consigue el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colección de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **Únete al** 💬 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **sígueme** en **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de GitHub de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

<img src="../../../.gitbook/assets/i3.png" alt="" data-size="original">

**Consejo para bug bounty**: **regístrate** en **Intigriti**, una plataforma premium de **bug bounty creada por hackers, para hackers**. Únete a nosotros en [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) hoy mismo, y comienza a ganar recompensas de hasta **$100,000**.

{% embed url="https://go.intigriti.com/hacktricks" %}

## **Introducción**

[![objection](https://github.com/sensepost/objection/raw/master/images/objection.png)](https://github.com/sensepost/objection)

**objection - Exploración Móvil en Tiempo de Ejecución**

`objection` es un kit de herramientas para la exploración móvil en tiempo de ejecución, impulsado por [Frida](https://www.frida.re). Fue creado con el objetivo de ayudar a evaluar aplicaciones móviles y su postura de seguridad sin la necesidad de un dispositivo móvil con jailbreak o root.

**Nota:** Esto no es una forma de eludir jailbreak / root. Al usar `objection`, todavía estás limitado por todas las restricciones impuestas por el sandbox aplicable al que te enfrentas.

### Resumen

El **objetivo** de **objection** es permitir al usuario llamar a las **acciones principales que ofrece Frida**. **De lo contrario**, el usuario necesitará crear un **script individual para cada aplicación** que quiera probar.

## Tutorial

Para este tutorial voy a usar el APK que puedes descargar aquí:

{% file src="../../../.gitbook/assets/app-release.zip" %}

O desde su [repositorio original](https://github.com/asvid/FridaApp) (descargar app-release.apk)

### Instalación
```bash
pip3 install objection
```
### Conexión

Establezca una **conexión ADB regular** y **inicie** el servidor **frida** en el dispositivo (y verifique que frida esté funcionando tanto en el cliente como en el servidor).

Si está utilizando un **dispositivo rooteado**, es necesario seleccionar la aplicación que desea probar dentro de la opción _**--gadget**_. en este caso:
```bash
frida-ps -Uai
objection --gadget asvid.github.io.fridaapp explore
```
### Acciones Básicas

No se van a listar todos los posibles comandos de objection en este tutorial, solo aquellos que he encontrado más útiles.

#### Entorno

Alguna información interesante (como contraseñas o rutas) podría encontrarse dentro del entorno.
```bash
env
```
#### Información de Frida
```bash
frida
```
#### Subida/Descarga
```bash
file download <remote path> [<local path>]
file upload <local path> [<remote path>]
```
#### Importar script de frida
```bash
import <local path frida-script>
```
#### SSLPinning
```bash
android sslpinning disable #Attempts to disable SSL Pinning on Android devices.
```
#### Detección de root
```bash
android root disable  #Attempts to disable root detection on Android devices.
android root simulate #Attempts to simulate a rooted Android environment.
```
#### Comando Exec
```bash
android shell_exec whoami
```
#### Capturas de pantalla
```bash
android ui screenshot /tmp/screenshot
android ui FLAG_SECURE false  #This may enable you to take screenshots using the hardware keys
```
### Análisis estático hecho dinámico

En una aplicación real deberíamos conocer toda la información descubierta en esta parte antes de usar objection gracias al **análisis estático**. De todos modos, quizás puedas ver **algo nuevo**, ya que aquí solo tendrás una lista completa de clases, métodos y objetos exportados.

Esto también es útil si de alguna manera **no puedes obtener algún código fuente legible** de la app.

#### Listar actividades, receptores y servicios
```
android hooking list activities
```
Como no se proporcionó texto en inglés para traducir, no puedo realizar la traducción solicitada. Si proporcionas el texto en inglés relevante, estaré encantado de ayudarte con la traducción al español.
```
android hooking list services
android hooking list receivers
```
Frida lanzará un error si no se encuentra ninguna

#### Obtener la actividad actual
```
android hooking get current_activity
```
![](<../../../.gitbook/assets/image (73) (1).png>)

#### Buscar Clases

Comencemos buscando clases dentro de nuestra aplicación
```
android hooking search classes asvid.github.io.fridaapp
```
![](<../../../.gitbook/assets/image (69).png>)

#### Buscar métodos de una clase

Ahora extraigamos los métodos dentro de la clase _MainActivity:_
```
android hooking search methods asvid.github.io.fridaapp MainActivity
```
![](<../../../.gitbook/assets/image (70) (1).png>)

#### Listar métodos declarados de una clase con sus parámetros

Vamos a determinar qué parámetros necesitan los métodos de la clase:
```
android hooking list class_methods asvid.github.io.fridaapp.MainActivity
```
![](<../../../.gitbook/assets/image (79).png>)

#### Listar clases

También puedes listar todas las clases que se cargaron dentro de la aplicación actual:
```
android hooking list classes #List all loaded classes, As the target application gets usedmore, this command will return more classes.
```
Esto es muy útil si quieres **enganchar el método de una clase y solo conoces el nombre de la clase**. Podrías usar esta función para **buscar qué módulo posee la clase** y luego enganchar su método.

### Enganchar siendo fácil

#### Enganchar (observar) un método

Desde el [código fuente](https://github.com/asvid/FridaApp/blob/master/app/src/main/java/asvid/github/io/fridaapp/MainActivity.kt) de la aplicación sabemos que la **función** _**sum()**_ **de** _**MainActivity**_ se ejecuta **cada segundo**. Intentemos **volcar toda la información posible** cada vez que se llama a la función (argumentos, valor de retorno y rastreo de pila):
```
android hooking watch class_method asvid.github.io.fridaapp.MainActivity.sum --dump-args --dump-backtrace --dump-return
```
![](<../../../.gitbook/assets/image (71).png>)

#### Haciendo hooking (monitoreo) de una clase completa

De hecho, encuentro todos los métodos de la clase MainActivity realmente interesantes, vamos a **hacerles hook a todos**. Ten cuidado, esto podría **hacer que una aplicación se cierre inesperadamente**.
```
android hooking watch class asvid.github.io.fridaapp.MainActivity --dump-args --dump-return
```
Si juegas con la aplicación mientras la clase está enganchada, verás cuándo **se llama a cada función**, sus **argumentos** y el valor de **retorno**.

![](<../../../.gitbook/assets/image (72).png>)

#### Cambiando el valor de retorno booleano de una función

Desde el código fuente puedes ver que la función _checkPin_ recibe un _String_ como argumento y devuelve un _boolean_. Hagamos que la función **siempre devuelva true**:

![](<../../../.gitbook/assets/image (74).png>)

Ahora, si escribes cualquier cosa en el cuadro de texto para el código PIN, verás que cualquier cosa es válida:

![](<../../../.gitbook/assets/image (77).png>)

### Instancias de clases

Busca e imprime **instancias activas de una clase Java específica**, especificada por un nombre de clase completamente calificado. Out es el resultado de un intento de obtener un valor de cadena para un objeto descubierto que típicamente **contendría valores de propiedad para el objeto**.
```
android heap print_instances <class>
```
![](<../../../.gitbook/assets/image (80).png>)

### Keystore/Intents

Puedes interactuar con el keystore y los intents utilizando:
```
android keystore list
android intents launch_activity
android intent launch_service
```
### Memoria

#### Volcado
```bash
memory dump all <local destination> #Dump all memory
memory dump from_base <base_address> <size_to_dump> <local_destination> #Dump a part
```
#### Lista
```
memory list modules
```
![](<../../../.gitbook/assets/image (66).png>)

En la parte inferior de la lista puedes ver frida:

![](<../../../.gitbook/assets/image (67).png>)

Veamos qué está exportando frida:

![](<../../../.gitbook/assets/image (68).png>)

#### Buscar/Escribir

También puedes buscar y escribir dentro de la memoria con objection:
```
memory search "<pattern eg: 41 41 41 ?? 41>" (--string) (--offsets-only)
memory write "<address>" "<pattern eg: 41 41 41 41>" (--string)
```
### SQLite

Puedes usar el comando `sqlite` para interactuar con bases de datos sqlite.

### Salir
```
exit
```
## Lo que echo en falta en Objection

* Los métodos de hooking a veces hacen que la aplicación se cierre (esto también se debe a Frida).
* No puedes usar las instancias de las clases para llamar a funciones de la instancia. Y no puedes crear nuevas instancias de clases y usarlas para llamar a funciones.
* No hay un atajo (como el que existe para sslpinnin) para enganchar todos los métodos criptográficos comunes que utiliza la aplicación para ver texto cifrado, texto plano, claves, IVs y algoritmos utilizados.

<img src="../../../.gitbook/assets/i3.png" alt="" data-size="original">

**Consejo para cazar bugs**: **regístrate** en **Intigriti**, una plataforma de caza de bugs premium creada por hackers, para hackers. ¡Únete a nosotros en [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) hoy mismo y comienza a ganar recompensas de hasta **$100,000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

<details>

<summary><strong>Aprende hacking en AWS de cero a héroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver a tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** consulta los [**PLANES DE SUSCRIPCIÓN**](https://github.com/sponsors/carlospolop)!
* Consigue el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colección de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **Únete al** 💬 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **sígueme** en **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de GitHub de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
