# Tutorial do Frida

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Voc√™ trabalha em uma **empresa de seguran√ßa cibern√©tica**? Voc√™ quer ver sua **empresa anunciada no HackTricks**? ou voc√™ quer ter acesso √† **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**? Verifique os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* **Junte-se ao** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para o** [**reposit√≥rio hacktricks**](https://github.com/carlospolop/hacktricks) **e** [**reposit√≥rio hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

<img src="../../../.gitbook/assets/i3.png" alt="" data-size="original">

**Dica de bug bounty**: **inscreva-se** no **Intigriti**, uma plataforma premium de **bug bounty criada por hackers, para hackers**! Junte-se a n√≥s em [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) hoje mesmo e comece a ganhar recompensas de at√© **$100.000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

## Instala√ß√£o

Instale as **ferramentas do frida**:
```bash
pip install frida-tools
pip install frida
```
**Baixe e instale** no Android o **servidor frida** ([Baixe a vers√£o mais recente](https://github.com/frida/frida/releases)).\
Um comando para reiniciar o adb no modo root, conectar-se a ele, fazer upload do frida-server, dar permiss√µes de execu√ß√£o e execut√°-lo em segundo plano:

{% code overflow="wrap" %}
```bash
adb root; adb connect localhost:6000; sleep 1; adb push frida-server /data/local/tmp/; adb shell "chmod 755 /data/local/tmp/frida-server"; adb shell "/data/local/tmp/frida-server &"
```
{% endcode %}

**Verifique** se est√° **funcionando**:
```bash
frida-ps -U #List packages and processes
frida-ps -U | grep -i <part_of_the_package_name> #Get all the package name
```
## Tutoriais

### [Tutorial 1](frida-tutorial-1.md)

**De**: [https://medium.com/infosec-adventures/introduction-to-frida-5a3f51595ca1](https://medium.com/infosec-adventures/introduction-to-frida-5a3f51595ca1)\
**APK**: [https://github.com/t0thkr1s/frida-demo/releases](https://github.com/t0thkr1s/frida-demo/releases)\
**C√≥digo-fonte**: [https://github.com/t0thkr1s/frida-demo](https://github.com/t0thkr1s/frida-demo)

Siga o [link para ler](frida-tutorial-1.md).

### [Tutorial 2](frida-tutorial-2.md)

**De**: [https://11x256.github.io/Frida-hooking-android-part-2/](https://11x256.github.io/Frida-hooking-android-part-2/) (Partes 2, 3 e 4)\
**APKs e C√≥digo-fonte**: [https://github.com/11x256/frida-android-examples](https://github.com/11x256/frida-android-examples)

Siga o [link para ler](frida-tutorial-2.md).

### [Tutorial 3](owaspuncrackable-1.md)

**De**: [https://joshspicer.com/android-frida-1](https://joshspicer.com/android-frida-1)\
**APK**: [https://github.com/OWASP/owasp-mstg/blob/master/Crackmes/Android/Level\_01/UnCrackable-Level1.apk](https://github.com/OWASP/owasp-mstg/blob/master/Crackmes/Android/Level\_01/UnCrackable-Level1.apk)

Siga o [link para ler](owaspuncrackable-1.md).\
**Voc√™ pode encontrar alguns scripts incr√≠veis do Frida aqui:** [**https://codeshare.frida.re/**](https://codeshare.frida.re)

## Exemplos R√°pidos

Aqui voc√™ pode encontrar as funcionalidades mais b√°sicas e interessantes do Frida para criar um script r√°pido:

### Chamando o Frida a partir da linha de comando
```bash
frida-ps -U

#Basic frida hooking
frida -l disableRoot.js -f owasp.mstg.uncrackable1

#Hooking before starting the app
frida -U --no-pause -l disableRoot.js -f owasp.mstg.uncrackable1
#The --no-pause and -f options allow the app to be spawned automatically,
#frozen so that the instrumentation can occur, and the automatically
#continue execution with our modified code.
```
### Script Python B√°sico

```python
import frida

# Attach to the target process
session = frida.attach("com.example.app")

# Define the JavaScript code to be injected
js_code = """
Java.perform(function () {
    // Intercept the target method
    var targetClass = Java.use("com.example.app.TargetClass");
    targetClass.targetMethod.implementation = function () {
        // Modify the behavior of the method
        console.log("Method intercepted!");
        return this.targetMethod();
    };
});
"""

# Create the script
script = session.create_script(js_code)

# Load the script into the target process
script.load()

# Detach from the target process
session.detach()
```

### Script Python B√°sico

```python
import frida

# Anexar ao processo alvo
session = frida.attach("com.example.app")

# Definir o c√≥digo JavaScript a ser injetado
js_code = """
Java.perform(function () {
    // Interceptar o m√©todo alvo
    var targetClass = Java.use("com.example.app.TargetClass");
    targetClass.targetMethod.implementation = function () {
        // Modificar o comportamento do m√©todo
        console.log("M√©todo interceptado!");
        return this.targetMethod();
    };
});
"""

# Criar o script
script = session.create_script(js_code)

# Carregar o script no processo alvo
script.load()

# Desanexar do processo alvo
session.detach()
```
```python
import frida, sys

jscode = open(sys.argv[0]).read()
process = frida.get_usb_device().attach('infosecadventures.fridademo')
script = process.create_script(jscode)
print('[ * ] Running Frida Demo application')
script.load()
sys.stdin.read()
```
### Hooking de fun√ß√µes sem par√¢metros

Fa√ßa o hook da fun√ß√£o `a()` da classe `sg.vantagepoint.a.c`
```javascript
Java.perform(function () {
;  rootcheck1.a.overload().implementation = function() {
rootcheck1.a.overload().implementation = function() {
send("sg.vantagepoint.a.c.a()Z   Root check 1 HIT!  su.exists()");
return false;
};
});
```
# Hook java `exit()`

Neste tutorial, vamos aprender como fazer um hook na fun√ß√£o `exit()` em um aplicativo Android usando o Frida. O Frida √© uma poderosa ferramenta de instrumenta√ß√£o e manipula√ß√£o de c√≥digo que nos permite modificar o comportamento de um aplicativo em tempo de execu√ß√£o.

## Pr√©-requisitos

Antes de come√ßar, certifique-se de ter o seguinte:

- Um dispositivo Android com acesso root ou um emulador Android configurado.
- O Frida instalado no seu dispositivo ou emulador Android.
- Um ambiente de desenvolvimento configurado para executar comandos adb.

## Passo 1: Conectando-se ao dispositivo

Conecte-se ao seu dispositivo Android usando o adb:

```bash
adb connect <IP_DO_DISPOSITIVO>:<PORTA>
```

## Passo 2: Iniciando o aplicativo de destino

Inicie o aplicativo de destino no dispositivo Android.

## Passo 3: Escrevendo o script Frida

Crie um novo arquivo chamado `hook_exit.js` e adicione o seguinte c√≥digo:

```javascript
Java.perform(function() {
  var System = Java.use('java.lang.System');
  var Runtime = Java.use('java.lang.Runtime');

  // Hooking System.exit()
  System.exit.implementation = function(code) {
    console.log('System.exit() called with code: ' + code);
    // Fa√ßa o que quiser aqui antes de sair do aplicativo
    // ...

    // Chame a implementa√ß√£o original de System.exit()
    this.exit(code);
  };

  // Hooking Runtime.exit()
  Runtime.exit.implementation = function(code) {
    console.log('Runtime.exit() called with code: ' + code);
    // Fa√ßa o que quiser aqui antes de sair do aplicativo
    // ...

    // Chame a implementa√ß√£o original de Runtime.exit()
    this.exit(code);
  };
});
```

## Passo 4: Executando o script Frida

Agora, execute o script Frida usando o seguinte comando:

```bash
frida -U -f <NOME_DO_PACOTE_DO_APLICATIVO> -l hook_exit.js --no-pause
```

Substitua `<NOME_DO_PACOTE_DO_APLICATIVO>` pelo nome do pacote do aplicativo que voc√™ deseja fazer o hook.

## Passo 5: Testando o hook

Agora, quando o aplicativo chamar a fun√ß√£o `exit()`, o nosso script Frida ser√° executado e exibir√° uma mensagem no console. Voc√™ pode adicionar qualquer l√≥gica adicional que desejar dentro do hook.

Lembre-se de que o Frida √© uma ferramenta poderosa e pode ser usada para fins maliciosos. Certifique-se de us√°-lo apenas para fins leg√≠timos, como testes de seguran√ßa e desenvolvimento de aplicativos.
```javascript
var sysexit = Java.use("java.lang.System");
sysexit.exit.overload("int").implementation = function(var_0) {
send("java.lang.System.exit(I)V  // We avoid exiting the application  :)");
};
```
# Tutorial Frida: Hook MainActivity `.onStart()` & `.onCreate()`

Neste tutorial, vamos aprender como usar o Frida para fazer hook nos m√©todos `.onStart()` e `.onCreate()` da classe MainActivity em um aplicativo Android.

## Pr√©-requisitos

Antes de come√ßar, certifique-se de ter o seguinte:

- Um dispositivo Android ou um emulador Android configurado.
- O Frida instalado no seu dispositivo ou emulador Android.
- Um ambiente de desenvolvimento configurado para executar comandos Frida.

## Passo 1: Identificar o nome do pacote e o nome da classe

Primeiro, precisamos identificar o nome do pacote e o nome da classe do aplicativo Android que queremos pentestar. Para fazer isso, podemos usar o comando `frida-ps -U` para listar os processos em execu√ß√£o no dispositivo ou emulador Android.

```bash
frida-ps -U
```

Anote o nome do pacote e o nome da classe do aplicativo Android que voc√™ deseja pentestar.

## Passo 2: Criar o script Frida

Agora, vamos criar um script Frida para fazer hook nos m√©todos `.onStart()` e `.onCreate()` da classe MainActivity. Crie um arquivo chamado `hook.js` e adicione o seguinte c√≥digo:

```javascript
Java.perform(function() {
    var MainActivity = Java.use('com.example.app.MainActivity');

    MainActivity.onStart.implementation = function() {
        console.log('Hooked MainActivity.onStart()');
        this.onStart();
    };

    MainActivity.onCreate.implementation = function() {
        console.log('Hooked MainActivity.onCreate()');
        this.onCreate();
    };
});
```

## Passo 3: Executar o script Frida

Agora, vamos executar o script Frida que criamos no passo anterior. Use o seguinte comando para executar o script:

```bash
frida -U -l hook.js -f <nome_do_pacote_do_aplicativo>
```

Substitua `<nome_do_pacote_do_aplicativo>` pelo nome do pacote do aplicativo Android que voc√™ anotou no Passo 1.

## Passo 4: Testar o hook

Ap√≥s executar o script Frida, abra o aplicativo Android que voc√™ est√° pentestando. Voc√™ ver√° mensagens de log indicando que os m√©todos `.onStart()` e `.onCreate()` da classe MainActivity foram hookados com sucesso.

Isso conclui o tutorial sobre como fazer hook nos m√©todos `.onStart()` e `.onCreate()` da classe MainActivity usando o Frida. Agora voc√™ pode explorar e modificar o comportamento desses m√©todos para fins de pentestagem.
```javascript
var mainactivity = Java.use("sg.vantagepoint.uncrackable1.MainActivity");
mainactivity.onStart.overload().implementation = function() {
send("MainActivity.onStart() HIT!!!");
var ret = this.onStart.overload().call(this);
};
mainactivity.onCreate.overload("android.os.Bundle").implementation = function(var_0) {
send("MainActivity.onCreate() HIT!!!");
var ret = this.onCreate.overload("android.os.Bundle").call(this,var_0);
};
```
# Hook android `.onCreate()`

Neste tutorial, vamos aprender como fazer hook no m√©todo `.onCreate()` de um aplicativo Android usando o Frida.

## Pr√©-requisitos

Certifique-se de ter o seguinte instalado em seu ambiente de desenvolvimento:

- Frida
- Android Studio
- Dispositivo Android ou emulador

## Passo 1: Configura√ß√£o do ambiente

Antes de come√ßar, certifique-se de ter configurado corretamente o ambiente de desenvolvimento Android e o Frida. Isso inclui a instala√ß√£o do Android Studio, a configura√ß√£o do dispositivo Android ou emulador e a instala√ß√£o do Frida no seu sistema.

## Passo 2: Crie um projeto Android

Crie um novo projeto Android no Android Studio ou use um projeto existente.

## Passo 3: Adicione o Frida ao projeto

Adicione o Frida ao projeto Android adicionando a depend√™ncia correta ao arquivo `build.gradle` do m√≥dulo do aplicativo.

```groovy
dependencies {
    implementation 'com.github.frida.frida:frida-android:14.2.18'
}
```

## Passo 4: Implemente o hook

Agora, vamos implementar o hook no m√©todo `.onCreate()` do aplicativo Android. Abra a classe principal do seu aplicativo e adicione o seguinte c√≥digo:

```java
import com.frida.Hooks;

public class MainActivity extends AppCompatActivity {

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);

        Hooks.onCreateHook();
    }
}
```

## Passo 5: Crie a classe de hooks

Crie uma nova classe chamada `Hooks` e adicione o seguinte c√≥digo:

```java
import android.util.Log;

public class Hooks {

    public static void onCreateHook() {
        Log.d("Frida", "Hooked .onCreate()");
        // Seu c√≥digo de hook aqui
    }
}
```

## Passo 6: Execute o aplicativo

Agora, execute o aplicativo no dispositivo Android ou emulador. O m√©todo `.onCreate()` ser√° hookado e voc√™ ver√° a mensagem "Hooked .onCreate()" no logcat.

## Conclus√£o

Neste tutorial, aprendemos como fazer hook no m√©todo `.onCreate()` de um aplicativo Android usando o Frida. Isso nos permite injetar c√≥digo personalizado e realizar v√°rias a√ß√µes durante a execu√ß√£o do aplicativo.
```javascript
var activity = Java.use("android.app.Activity");
activity.onCreate.overload("android.os.Bundle").implementation = function(var_0) {
send("Activity HIT!!!");
var ret = this.onCreate.overload("android.os.Bundle").call(this,var_0);
};
```
### Hooking de fun√ß√µes com par√¢metros e recuperando o valor

Hooking de uma fun√ß√£o de descriptografia. Imprimir a entrada, chamar a fun√ß√£o original para descriptografar a entrada e, por fim, imprimir os dados em texto simples:
```javascript
function getString(data){
var ret = "";
for (var i=0; i < data.length; i++){
ret += data[i].toString();
}
return ret
}
var aes_decrypt = Java.use("sg.vantagepoint.a.a");
aes_decrypt.a.overload("[B","[B").implementation = function(var_0,var_1) {
send("sg.vantagepoint.a.a.a([B[B)[B   doFinal(enc)  // AES/ECB/PKCS7Padding");
send("Key       : " + getString(var_0));
send("Encrypted : " + getString(var_1));
var ret = this.a.overload("[B","[B").call(this,var_0,var_1);
send("Decrypted : " + ret);

var flag = "";
for (var i=0; i < ret.length; i++){
flag += String.fromCharCode(ret[i]);
}
send("Decrypted flag: " + flag);
return ret; //[B
};
```
### Hooking de fun√ß√µes e chamando-as com nossa entrada

Fa√ßa o hook de uma fun√ß√£o que recebe uma string e chame-a com outra string (de [aqui](https://11x256.github.io/Frida-hooking-android-part-2/))
```javascript
var string_class = Java.use("java.lang.String"); // get a JS wrapper for java's String class

my_class.fun.overload("java.lang.String").implementation = function(x){ //hooking the new function
var my_string = string_class.$new("My TeSt String#####"); //creating a new String by using `new` operator
console.log("Original arg: " +x );
var ret =  this.fun(my_string); // calling the original function with the new String, and putting its return value in ret variable
console.log("Return value: "+ret);
return ret;
};
```
### Obtendo um objeto j√° criado de uma classe

Se voc√™ deseja extrair algum atributo de um objeto criado, voc√™ pode usar isso.

Neste exemplo, voc√™ ver√° como obter o objeto da classe my\_activity e como chamar a fun√ß√£o .secret() que imprimir√° um atributo privado do objeto:
```javascript
Java.choose("com.example.a11x256.frida_test.my_activity" , {
onMatch : function(instance){ //This function will be called for every instance found by frida
console.log("Found instance: "+instance);
console.log("Result of secret func: " + instance.secret());
},
onComplete:function(){}
});
```
<img src="../../../.gitbook/assets/i3.png" alt="" data-size="original">

**Dica de recompensa por bugs**: **inscreva-se** no **Intigriti**, uma plataforma premium de **recompensa por bugs criada por hackers, para hackers**! Junte-se a n√≥s em [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) hoje mesmo e comece a ganhar recompensas de at√© **$100.000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Voc√™ trabalha em uma **empresa de ciberseguran√ßa**? Gostaria de ver sua **empresa anunciada no HackTricks**? Ou gostaria de ter acesso √† **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**? Verifique os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* **Junte-se ao** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo Telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para o** [**reposit√≥rio hacktricks**](https://github.com/carlospolop/hacktricks) **e o** [**reposit√≥rio hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
