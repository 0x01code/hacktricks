# Tutorial de Frida

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* ¬øTrabajas en una **empresa de ciberseguridad**? ¬øQuieres ver tu **empresa anunciada en HackTricks**? ¬øO quieres tener acceso a la **√∫ltima versi√≥n de PEASS o descargar HackTricks en PDF**? ¬°Consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obt√©n el [**swag oficial de PEASS y HackTricks**](https://peass.creator-spring.com)
* **√önete al** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de Telegram**](https://t.me/peass) o **s√≠gueme** en **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Comparte tus trucos de hacking enviando PRs al** [**repositorio de hacktricks**](https://github.com/carlospolop/hacktricks) **y al** [**repositorio de hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

<figure><img src="../../../.gitbook/assets/i3.png" alt=""><figcaption></figcaption></figure>

**Consejo para bug bounty**: ¬°**reg√≠strate** en **Intigriti**, una plataforma premium de **bug bounty creada por hackers, para hackers**! √önete a nosotros en [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) hoy mismo y comienza a ganar recompensas de hasta **$100,000**.

{% embed url="https://go.intigriti.com/hacktricks" %}

## Instalaci√≥n

Instala las **herramientas de Frida**:
```bash
pip install frida-tools
pip install frida
```
**Descarga e instala** en el dispositivo Android el **servidor de Frida** ([Descarga la √∫ltima versi√≥n](https://github.com/frida/frida/releases)).\
Una l√≠nea de comando para reiniciar adb en modo root, conectarse a √©l, cargar frida-server, otorgar permisos de ejecuci√≥n y ejecutarlo en segundo plano:

{% code overflow="wrap" %}
```bash
adb root; adb connect localhost:6000; sleep 1; adb push frida-server /data/local/tmp/; adb shell "chmod 755 /data/local/tmp/frida-server"; adb shell "/data/local/tmp/frida-server &"
```
{% endcode %}

**Comprueba** si est√° **funcionando**:
```bash
frida-ps -U #List packages and processes
frida-ps -U | grep -i <part_of_the_package_name> #Get all the package name
```
## Tutoriales

### [Tutorial 1](frida-tutorial-1.md)

**Desde**: [https://medium.com/infosec-adventures/introduction-to-frida-5a3f51595ca1](https://medium.com/infosec-adventures/introduction-to-frida-5a3f51595ca1)\
**APK**: [https://github.com/t0thkr1s/frida-demo/releases](https://github.com/t0thkr1s/frida-demo/releases)\
**C√≥digo fuente**: [https://github.com/t0thkr1s/frida-demo](https://github.com/t0thkr1s/frida-demo)

Sigue el [enlace para leerlo](frida-tutorial-1.md).

### [Tutorial 2](frida-tutorial-2.md)

**Desde**: [https://11x256.github.io/Frida-hooking-android-part-2/](https://11x256.github.io/Frida-hooking-android-part-2/) (Partes 2, 3 y 4)\
**APKs y c√≥digo fuente**: [https://github.com/11x256/frida-android-examples](https://github.com/11x256/frida-android-examples)

Sigue el [enlace para leerlo](frida-tutorial-2.md).

### [Tutorial 3](owaspuncrackable-1.md)

**Desde**: [https://joshspicer.com/android-frida-1](https://joshspicer.com/android-frida-1)\
**APK**: [https://github.com/OWASP/owasp-mstg/blob/master/Crackmes/Android/Level\_01/UnCrackable-Level1.apk](https://github.com/OWASP/owasp-mstg/blob/master/Crackmes/Android/Level\_01/UnCrackable-Level1.apk)

Sigue el [enlace para leerlo](owaspuncrackable-1.md).\
**Puedes encontrar algunos scripts impresionantes de Frida aqu√≠:** [**https://codeshare.frida.re/**](https://codeshare.frida.re)

## Ejemplos r√°pidos

Aqu√≠ puedes encontrar las funcionalidades m√°s b√°sicas e interesantes de Frida para hacer un script r√°pido:

### Llamando a Frida desde la l√≠nea de comandos
```bash
frida-ps -U

#Basic frida hooking
frida -l disableRoot.js -f owasp.mstg.uncrackable1

#Hooking before starting the app
frida -U --no-pause -l disableRoot.js -f owasp.mstg.uncrackable1
#The --no-pause and -f options allow the app to be spawned automatically,
#frozen so that the instrumentation can occur, and the automatically
#continue execution with our modified code.
```
### Script b√°sico de Python

```python
import frida

# Attach to the target process
session = frida.attach("com.example.app")

# Define the JavaScript code to be injected
js_code = """
Java.perform(function () {
    // Find the target method
    var targetMethod = Java.use("com.example.app.TargetClass.targetMethod");

    // Hook the target method
    targetMethod.implementation = function () {
        // Print the arguments passed to the method
        console.log("Arguments: " + Array.prototype.slice.call(arguments));

        // Call the original method
        var result = this.targetMethod.apply(this, arguments);

        // Print the result of the method
        console.log("Result: " + result);

        // Modify the result if needed
        result += 100;

        // Return the modified result
        return result;
    };
});
"""

# Create the script
script = session.create_script(js_code)

# Load the script into the target process
script.load()

# Detach from the target process
session.detach()
```

Este es un script b√°sico de Python que utiliza la biblioteca Frida para realizar la inyecci√≥n de c√≥digo en una aplicaci√≥n de Android. El script se conecta al proceso de destino, define el c√≥digo JavaScript a inyectar y luego crea y carga el script en el proceso de destino. El c√≥digo JavaScript busca un m√©todo espec√≠fico en la clase de destino, lo engancha y realiza acciones como imprimir los argumentos pasados al m√©todo, llamar al m√©todo original y modificar el resultado si es necesario. Finalmente, el script se desconecta del proceso de destino.
```python
import frida, sys

jscode = open(sys.argv[0]).read()
process = frida.get_usb_device().attach('infosecadventures.fridademo')
script = process.create_script(jscode)
print('[ * ] Running Frida Demo application')
script.load()
sys.stdin.read()
```
### Enganchando funciones sin par√°metros

Engancha la funci√≥n `a()` de la clase `sg.vantagepoint.a.c`
```javascript
Java.perform(function () {
;  rootcheck1.a.overload().implementation = function() {
rootcheck1.a.overload().implementation = function() {
send("sg.vantagepoint.a.c.a()Z   Root check 1 HIT!  su.exists()");
return false;
};
});
```
# Hook java `exit()`

## Introduction

In this tutorial, we will learn how to hook the `exit()` method in a Java application using Frida. By hooking this method, we can intercept the application's exit calls and perform additional actions before the application terminates.

## Prerequisites

Before getting started, make sure you have the following:

- A rooted Android device or an emulator
- Frida installed on your machine
- Basic knowledge of JavaScript and Java

## Steps

Follow the steps below to hook the `exit()` method:

1. Launch the target application on your Android device or emulator.

2. Open a terminal and start the Frida server by running the following command:

   ```
   frida-server
   ```

3. Create a new JavaScript file, for example, `hook.js`, and add the following code:

   ```javascript
   Java.perform(function () {
       var System = Java.use('java.lang.System');
       var Runtime = Java.use('java.lang.Runtime');

       // Hook the exit() method of the System class
       System.exit.implementation = function (code) {
           console.log('Exit code: ' + code);

           // Perform additional actions here

           // Call the original exit() method
           this.exit(code);
       };

       // Hook the exit() method of the Runtime class
       Runtime.getRuntime().exit.implementation = function (code) {
           console.log('Exit code: ' + code);

           // Perform additional actions here

           // Call the original exit() method
           this.exit(code);
       };
   });
   ```

4. Save the `hook.js` file.

5. In the terminal, navigate to the directory where the `hook.js` file is located.

6. Run the following command to start the Frida CLI:

   ```
   frida -U -l hook.js -f <package_name>
   ```

   Replace `<package_name>` with the package name of the target application.

7. Wait for Frida to attach to the application.

8. Once attached, you should see the `Exit code: <code>` message in the terminal whenever the `exit()` method is called in the application. You can add your own additional actions inside the hook.

## Conclusion

By hooking the `exit()` method using Frida, we can intercept and modify the behavior of an Android application when it tries to exit. This technique can be useful for various purposes, such as debugging, analyzing application flow, or performing runtime modifications.
```javascript
var sysexit = Java.use("java.lang.System");
sysexit.exit.overload("int").implementation = function(var_0) {
send("java.lang.System.exit(I)V  // We avoid exiting the application  :)");
};
```
# Tutorial de Frida: Enganchando `.onStart()` y `.onCreate()` de MainActivity

En este tutorial, aprenderemos c√≥mo utilizar Frida para enganchar los m√©todos `.onStart()` y `.onCreate()` de la clase MainActivity en una aplicaci√≥n de Android. Esto nos permitir√° interceptar y modificar el comportamiento de estos m√©todos en tiempo de ejecuci√≥n.

## Requisitos previos

Antes de comenzar, aseg√∫rate de tener instalado lo siguiente:

- Frida Server en el dispositivo Android objetivo.
- Frida CLI en tu m√°quina local.

## Paso 1: Conectarse al dispositivo

Primero, debemos conectarnos al dispositivo Android objetivo utilizando Frida CLI. Ejecuta el siguiente comando en tu terminal:

```bash
frida-ps -U
```

Esto mostrar√° una lista de los procesos en ejecuci√≥n en el dispositivo. Aseg√∫rate de que la aplicaci√≥n que deseas pentestar est√© en la lista.

## Paso 2: Crear el script de Frida

A continuaci√≥n, crearemos un script de Frida para enganchar los m√©todos `.onStart()` y `.onCreate()` de la clase MainActivity. Crea un archivo llamado `hook.js` y pega el siguiente c√≥digo:

```javascript
Java.perform(function() {
  var MainActivity = Java.use('com.example.app.MainActivity');

  MainActivity.onStart.implementation = function() {
    console.log('M√©todo onStart() enganchado');
    // Agrega aqu√≠ tu c√≥digo personalizado
    this.onStart();
  };

  MainActivity.onCreate.implementation = function() {
    console.log('M√©todo onCreate() enganchado');
    // Agrega aqu√≠ tu c√≥digo personalizado
    this.onCreate();
  };
});
```

## Paso 3: Ejecutar el script de Frida

Ahora, ejecutaremos el script de Frida para enganchar los m√©todos `.onStart()` y `.onCreate()`. Ejecuta el siguiente comando en tu terminal:

```bash
frida -U -l hook.js -f com.example.app
```

Esto iniciar√° la aplicaci√≥n en el dispositivo y enganchar√° los m√©todos especificados. Ver√°s los mensajes de consola indicando que los m√©todos han sido enganchados con √©xito.

## Paso 4: Probar el enganche

Finalmente, prueba el enganche ejecutando la aplicaci√≥n en el dispositivo. Observa la consola de Frida para verificar que los mensajes de los m√©todos enganchados se impriman correctamente.

¬°Felicidades! Ahora has aprendido c√≥mo utilizar Frida para enganchar los m√©todos `.onStart()` y `.onCreate()` de la clase MainActivity en una aplicaci√≥n de Android. Esto te permitir√° interceptar y modificar el comportamiento de estos m√©todos durante la ejecuci√≥n de la aplicaci√≥n.
```javascript
var mainactivity = Java.use("sg.vantagepoint.uncrackable1.MainActivity");
mainactivity.onStart.overload().implementation = function() {
send("MainActivity.onStart() HIT!!!");
var ret = this.onStart.overload().call(this);
};
mainactivity.onCreate.overload("android.os.Bundle").implementation = function(var_0) {
send("MainActivity.onCreate() HIT!!!");
var ret = this.onCreate.overload("android.os.Bundle").call(this,var_0);
};
```
# Hook android `.onCreate()`

En este tutorial, aprender√°s c√≥mo realizar un hook en el m√©todo `.onCreate()` de una aplicaci√≥n Android utilizando Frida.

## Requisitos previos

- Un dispositivo Android rooteado o un emulador Android con acceso de root.
- Frida instalado en tu m√°quina local.
- Conocimientos b√°sicos de JavaScript.

## Pasos

1. Abre una terminal y ejecuta el siguiente comando para iniciar el servidor Frida en tu dispositivo Android:

   ```
   $ adb shell su -c "frida-server -D"
   ```

2. Aseg√∫rate de que el servidor Frida est√© en ejecuci√≥n en tu dispositivo Android.

3. En tu m√°quina local, crea un nuevo archivo JavaScript llamado `hook.js` y pega el siguiente c√≥digo:

   ```javascript
   Java.perform(function() {
       var targetClass = Java.use('com.example.app.MainActivity');
   
       targetClass.onCreate.implementation = function() {
           console.log('Hooked onCreate()');
   
           // Aqu√≠ puedes agregar tu propio c√≥digo para realizar acciones adicionales despu√©s de que se llame al m√©todo onCreate()
   
           // Llama al m√©todo onCreate() original
           this.onCreate();
       };
   });
   ```

4. En la misma terminal, ejecuta el siguiente comando para iniciar el script de Frida y realizar el hook en el m√©todo `.onCreate()`:

   ```
   $ frida -U -l hook.js -f com.example.app
   ```

   Aseg√∫rate de reemplazar `com.example.app` con el nombre del paquete de la aplicaci√≥n Android en la que deseas realizar el hook.

5. Ahora, cuando la aplicaci√≥n se inicie y se llame al m√©todo `.onCreate()`, ver√°s el mensaje "Hooked onCreate()" en la salida de la terminal.

¬°Felicidades! Has realizado con √©xito un hook en el m√©todo `.onCreate()` de una aplicaci√≥n Android utilizando Frida. Ahora puedes agregar tu propio c√≥digo para realizar acciones adicionales dentro del m√©todo hook.
```javascript
var activity = Java.use("android.app.Activity");
activity.onCreate.overload("android.os.Bundle").implementation = function(var_0) {
send("Activity HIT!!!");
var ret = this.onCreate.overload("android.os.Bundle").call(this,var_0);
};
```
### Enganchando funciones con par√°metros y recuperando el valor

Enganchando una funci√≥n de desencriptaci√≥n. Imprimir la entrada, llamar a la funci√≥n original para desencriptar la entrada y finalmente, imprimir los datos en texto plano:
```javascript
function getString(data){
var ret = "";
for (var i=0; i < data.length; i++){
ret += data[i].toString();
}
return ret
}
var aes_decrypt = Java.use("sg.vantagepoint.a.a");
aes_decrypt.a.overload("[B","[B").implementation = function(var_0,var_1) {
send("sg.vantagepoint.a.a.a([B[B)[B   doFinal(enc)  // AES/ECB/PKCS7Padding");
send("Key       : " + getString(var_0));
send("Encrypted : " + getString(var_1));
var ret = this.a.overload("[B","[B").call(this,var_0,var_1);
send("Decrypted : " + ret);

var flag = "";
for (var i=0; i < ret.length; i++){
flag += String.fromCharCode(ret[i]);
}
send("Decrypted flag: " + flag);
return ret; //[B
};
```
### Enganchando funciones y llam√°ndolas con nuestra entrada

Engancha una funci√≥n que recibe una cadena y ll√°mala con otra cadena (desde [aqu√≠](https://11x256.github.io/Frida-hooking-android-part-2/))
```javascript
var string_class = Java.use("java.lang.String"); // get a JS wrapper for java's String class

my_class.fun.overload("java.lang.String").implementation = function(x){ //hooking the new function
var my_string = string_class.$new("My TeSt String#####"); //creating a new String by using `new` operator
console.log("Original arg: " +x );
var ret =  this.fun(my_string); // calling the original function with the new String, and putting its return value in ret variable
console.log("Return value: "+ret);
return ret;
};
```
### Obteniendo un objeto ya creado de una clase

Si deseas extraer alg√∫n atributo de un objeto creado, puedes utilizar esto.

En este ejemplo, ver√°s c√≥mo obtener el objeto de la clase my\_activity y c√≥mo llamar a la funci√≥n .secret() que imprimir√° un atributo privado del objeto:
```javascript
Java.choose("com.example.a11x256.frida_test.my_activity" , {
onMatch : function(instance){ //This function will be called for every instance found by frida
console.log("Found instance: "+instance);
console.log("Result of secret func: " + instance.secret());
},
onComplete:function(){}
});
```
<figure><img src="../../../.gitbook/assets/i3.png" alt=""><figcaption></figcaption></figure>

**Consejo de recompensa por errores**: ¬°**reg√≠strate** en **Intigriti**, una plataforma premium de **recompensas por errores creada por hackers, para hackers**! ¬°√önete a nosotros en [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) hoy mismo y comienza a ganar recompensas de hasta **$100,000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* ¬øTrabajas en una **empresa de ciberseguridad**? ¬øQuieres ver tu **empresa anunciada en HackTricks**? ¬øO quieres tener acceso a la **√∫ltima versi√≥n de PEASS o descargar HackTricks en PDF**? ¬°Consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obt√©n el [**merchandising oficial de PEASS y HackTricks**](https://peass.creator-spring.com)
* **√önete al** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de Telegram**](https://t.me/peass) o **s√≠gueme** en **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Comparte tus trucos de hacking enviando PRs al** [**repositorio de hacktricks**](https://github.com/carlospolop/hacktricks) **y al** [**repositorio de hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
