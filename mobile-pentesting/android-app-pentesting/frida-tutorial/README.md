# Frida教程

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks云平台 ☁️</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>🐦 推特 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 Youtube 🎥</strong></a></summary>

* 你在一家**网络安全公司**工作吗？你想在HackTricks中看到你的**公司广告**吗？或者你想获得**PEASS的最新版本或下载HackTricks的PDF**吗？请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 发现我们的独家[**NFTs**](https://opensea.io/collection/the-peass-family)收藏品[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* 获取[**官方PEASS和HackTricks周边产品**](https://peass.creator-spring.com)
* **加入**[**💬**](https://emojipedia.org/speech-balloon/) [**Discord群组**](https://discord.gg/hRep4RUj7f) 或 [**telegram群组**](https://t.me/peass) 或 **关注**我在**Twitter**上的[**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**。**
* **通过向[hacktricks repo](https://github.com/carlospolop/hacktricks)和[hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)提交PR来分享你的黑客技巧**。

</details>

<img src="../../../.gitbook/assets/i3.png" alt="" data-size="original">

**赏金猎人提示**：**注册**Intigriti，一个由黑客创建的高级**赏金猎人平台**！立即加入我们的[**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks)，开始赚取高达**$100,000**的赏金！

{% embed url="https://go.intigriti.com/hacktricks" %}

## 安装

安装**frida工具**：
```bash
pip install frida-tools
pip install frida
```
**下载并安装** Android 上的 **Frida 服务器**（[下载最新版本](https://github.com/frida/frida/releases)）。\
一行命令以 root 模式重新启动 adb，连接到它，上传 frida-server，赋予执行权限并在后台运行：
```bash
adb root; adb connect localhost:6000; sleep 1; adb push frida-server /data/local/tmp/; adb shell "chmod 755 /data/local/tmp/frida-server"; adb shell "/data/local/tmp/frida-server &"
```
**检查**是否**正常工作**：
```bash
frida-ps -U #List packages and processes
frida-ps -U | grep -i <part_of_the_package_name> #Get all the package name
```
## 教程

### [教程 1](frida-tutorial-1.md)

**来源**: [https://medium.com/infosec-adventures/introduction-to-frida-5a3f51595ca1](https://medium.com/infosec-adventures/introduction-to-frida-5a3f51595ca1)\
**APK**: [https://github.com/t0thkr1s/frida-demo/releases](https://github.com/t0thkr1s/frida-demo/releases)\
**源代码**: [https://github.com/t0thkr1s/frida-demo](https://github.com/t0thkr1s/frida-demo)

点击[链接阅读](frida-tutorial-1.md)。

### [教程 2](frida-tutorial-2.md)

**来源**: [https://11x256.github.io/Frida-hooking-android-part-2/](https://11x256.github.io/Frida-hooking-android-part-2/) (第2、3和4部分)\
**APKs 和源代码**: [https://github.com/11x256/frida-android-examples](https://github.com/11x256/frida-android-examples)

点击[链接阅读](frida-tutorial-2.md)。

### [教程 3](owaspuncrackable-1.md)

**来源**: [https://joshspicer.com/android-frida-1](https://joshspicer.com/android-frida-1)\
**APK**: [https://github.com/OWASP/owasp-mstg/blob/master/Crackmes/Android/Level\_01/UnCrackable-Level1.apk](https://github.com/OWASP/owasp-mstg/blob/master/Crackmes/Android/Level\_01/UnCrackable-Level1.apk)

点击[链接阅读](owaspuncrackable-1.md)。\
**你可以在这里找到一些很棒的 Frida 脚本:** [**https://codeshare.frida.re/**](https://codeshare.frida.re)

## 快速示例

在这里，你可以找到 Frida 的更基本和有趣的功能，以便快速编写脚本：

### 从命令行调用 Frida
```bash
frida-ps -U

#Basic frida hooking
frida -l disableRoot.js -f owasp.mstg.uncrackable1

#Hooking before starting the app
frida -U --no-pause -l disableRoot.js -f owasp.mstg.uncrackable1
#The --no-pause and -f options allow the app to be spawned automatically,
#frozen so that the instrumentation can occur, and the automatically
#continue execution with our modified code.
```
### 基本的Python脚本

```python
import frida

# Attach to the target process
session = frida.attach("com.example.app")

# Define the JavaScript code to be injected
js_code = """
Java.perform(function () {
    // Hook the target method
    var targetClass = Java.use("com.example.app.TargetClass");
    targetClass.targetMethod.implementation = function () {
        // Modify the behavior of the target method
        console.log("Target method hooked!");
        // Call the original method
        this.targetMethod();
    };
});
"""

# Create a script from the JavaScript code
script = session.create_script(js_code)

# Load the script into the target process
script.load()

# Detach from the target process
session.detach()
```

### 基本的Python脚本

```python
import frida

# 连接到目标进程
session = frida.attach("com.example.app")

# 定义要注入的JavaScript代码
js_code = """
Java.perform(function () {
    // 钩住目标方法
    var targetClass = Java.use("com.example.app.TargetClass");
    targetClass.targetMethod.implementation = function () {
        // 修改目标方法的行为
        console.log("目标方法已钩住！");
        // 调用原始方法
        this.targetMethod();
    };
});
"""

# 从JavaScript代码创建脚本
script = session.create_script(js_code)

# 将脚本加载到目标进程中
script.load()

# 从目标进程中分离
session.detach()
```
```python
import frida, sys

jscode = open(sys.argv[0]).read()
process = frida.get_usb_device().attach('infosecadventures.fridademo')
script = process.create_script(jscode)
print('[ * ] Running Frida Demo application')
script.load()
sys.stdin.read()
```
### 没有参数的函数挂钩

挂钩类 `sg.vantagepoint.a.c` 的函数 `a()`
```javascript
Java.perform(function () {
;  rootcheck1.a.overload().implementation = function() {
rootcheck1.a.overload().implementation = function() {
send("sg.vantagepoint.a.c.a()Z   Root check 1 HIT!  su.exists()");
return false;
};
});
```
# Frida Tutorial: Hooking `exit()` in Java

In this tutorial, we will learn how to use Frida to hook the `exit()` function in Java. By hooking this function, we can intercept the program's exit and perform additional actions before the application terminates.

## Prerequisites

Before we begin, make sure you have the following:

- A rooted Android device or an emulator
- Frida installed on your machine
- Basic knowledge of Java and JavaScript

## Steps

1. Launch the target application on your Android device or emulator.

2. Open a terminal and start the Frida server by running the following command:

   ```bash
   frida-server
   ```

3. Create a new JavaScript file, for example `hook_exit.js`, and add the following code:

   ```javascript
   Java.perform(function() {
       var System = Java.use('java.lang.System');
       var Runtime = Java.use('java.lang.Runtime');

       // Hook the exit() function
       System.exit.overload('int').implementation = function(code) {
           console.log('Exit code: ' + code);

           // Perform additional actions here

           // Call the original exit() function
           this.exit(code);
       };
   });
   ```

4. Save the JavaScript file and use Frida to inject it into the target application by running the following command:

   ```bash
   frida -U -l hook_exit.js -f <package_name>
   ```

   Replace `<package_name>` with the package name of the target application.

5. You should see the output of the `console.log()` statement whenever the `exit()` function is called in the target application.

6. Customize the code inside the `implementation` block to perform your desired actions before the application exits.

That's it! You have successfully hooked the `exit()` function in Java using Frida. You can now intercept the program's exit and add your own logic or perform any necessary actions.
```javascript
var sysexit = Java.use("java.lang.System");
sysexit.exit.overload("int").implementation = function(var_0) {
send("java.lang.System.exit(I)V  // We avoid exiting the application  :)");
};
```
# Frida Tutorial: Hook MainActivity `.onStart()` & `.onCreate()`

In this tutorial, we will learn how to use Frida to hook the `.onStart()` and `.onCreate()` methods of the MainActivity class in an Android app.

## Prerequisites

Before we begin, make sure you have the following:

- A rooted Android device or an emulator
- Frida installed on your machine
- A basic understanding of JavaScript

## Step 1: Set Up the Environment

First, we need to set up the environment by installing the necessary tools. Follow these steps:

1. Install Frida on your machine by running the following command:

   ```
   $ pip install frida-tools
   ```

2. Install the Frida server on your Android device or emulator. You can download the server from the [Frida releases page](https://github.com/frida/frida/releases). Make sure to choose the correct version for your device.

3. Connect your Android device or emulator to your machine using a USB cable.

4. Start the Frida server on your Android device or emulator by running the following command:

   ```
   $ adb shell
   $ su
   $ cd /data/local/tmp
   $ ./frida-server
   ```

## Step 2: Write the Frida Script

Next, we will write a Frida script to hook the `.onStart()` and `.onCreate()` methods of the MainActivity class. Create a new file called `hook.js` and add the following code:

```javascript
Java.perform(function() {
  var MainActivity = Java.use('com.example.app.MainActivity');

  MainActivity.onStart.implementation = function() {
    console.log('onStart() hooked');
    this.onStart();
  };

  MainActivity.onCreate.implementation = function() {
    console.log('onCreate() hooked');
    this.onCreate();
  };
});
```

## Step 3: Hook the Methods

Now, we can use Frida to hook the methods. Follow these steps:

1. Compile the Frida script by running the following command:

   ```
   $ frida -c -o compiled_hook.js hook.js
   ```

2. Launch the target app on your Android device or emulator.

3. Attach Frida to the target app by running the following command:

   ```
   $ frida -U -l compiled_hook.js -f com.example.app
   ```

   Replace `com.example.app` with the package name of the target app.

4. You should see the output `onStart() hooked` and `onCreate() hooked` in the console, indicating that the methods have been successfully hooked.

## Conclusion

In this tutorial, we learned how to use Frida to hook the `.onStart()` and `.onCreate()` methods of the MainActivity class in an Android app. This technique can be useful for analyzing and modifying the behavior of Android apps during runtime.
```javascript
var mainactivity = Java.use("sg.vantagepoint.uncrackable1.MainActivity");
mainactivity.onStart.overload().implementation = function() {
send("MainActivity.onStart() HIT!!!");
var ret = this.onStart.overload().call(this);
};
mainactivity.onCreate.overload("android.os.Bundle").implementation = function(var_0) {
send("MainActivity.onCreate() HIT!!!");
var ret = this.onCreate.overload("android.os.Bundle").call(this,var_0);
};
```
# Frida Tutorial: Hook android `.onCreate()`

In this tutorial, we will learn how to hook the `.onCreate()` method in an Android application using Frida. By hooking this method, we can intercept and modify the behavior of the application during its initialization process.

## Prerequisites

Before we begin, make sure you have the following:

- An Android device or emulator
- Frida installed on your machine
- Basic knowledge of JavaScript and Android development

## Steps

1. Start by launching the target application on your Android device or emulator.

2. Open a terminal and navigate to the directory where you have Frida installed.

3. Use the following command to spawn a new Frida server process on the target device:

   ```
   frida-server -D
   ```

4. In a new terminal window, navigate to the directory where you have your Frida scripts.

5. Create a new JavaScript file, for example `hook_oncreate.js`, and open it in a text editor.

6. In the JavaScript file, write the following code to hook the `.onCreate()` method:

   ```javascript
   Java.perform(function() {
       var targetClass = Java.use('com.example.TargetClass');
       targetClass.onCreate.implementation = function() {
           console.log('Hooked .onCreate()');
           // Add your custom code here
           this.onCreate();
       };
   });
   ```

   Replace `com.example.TargetClass` with the actual package and class name of the target application.

7. Save the JavaScript file and return to the terminal.

8. Use the following command to inject the Frida script into the target application:

   ```
   frida -U -l hook_oncreate.js -f com.example.targetapp
   ```

   Replace `com.example.targetapp` with the actual package name of the target application.

9. If everything is set up correctly, you should see the message "Hooked .onCreate()" in the terminal.

10. Now, when the target application is launched, the `.onCreate()` method will be hooked, and your custom code will be executed alongside the original code.

## Conclusion

By hooking the `.onCreate()` method using Frida, you can gain control over the initialization process of an Android application and modify its behavior as desired. This technique can be useful for various purposes, such as bypassing security measures or analyzing the application's behavior.
```javascript
var activity = Java.use("android.app.Activity");
activity.onCreate.overload("android.os.Bundle").implementation = function(var_0) {
send("Activity HIT!!!");
var ret = this.onCreate.overload("android.os.Bundle").call(this,var_0);
};
```
### 使用参数钩取函数并检索值

钩取解密函数。打印输入，调用原始函数解密输入，最后打印明文数据：
```javascript
function getString(data){
var ret = "";
for (var i=0; i < data.length; i++){
ret += data[i].toString();
}
return ret
}
var aes_decrypt = Java.use("sg.vantagepoint.a.a");
aes_decrypt.a.overload("[B","[B").implementation = function(var_0,var_1) {
send("sg.vantagepoint.a.a.a([B[B)[B   doFinal(enc)  // AES/ECB/PKCS7Padding");
send("Key       : " + getString(var_0));
send("Encrypted : " + getString(var_1));
var ret = this.a.overload("[B","[B").call(this,var_0,var_1);
send("Decrypted : " + ret);

var flag = "";
for (var i=0; i < ret.length; i++){
flag += String.fromCharCode(ret[i]);
}
send("Decrypted flag: " + flag);
return ret; //[B
};
```
### 钩住函数并使用我们的输入调用它

钩住一个接收字符串的函数，并使用其他字符串调用它（来自[这里](https://11x256.github.io/Frida-hooking-android-part-2/)）
```javascript
var string_class = Java.use("java.lang.String"); // get a JS wrapper for java's String class

my_class.fun.overload("java.lang.String").implementation = function(x){ //hooking the new function
var my_string = string_class.$new("My TeSt String#####"); //creating a new String by using `new` operator
console.log("Original arg: " +x );
var ret =  this.fun(my_string); // calling the original function with the new String, and putting its return value in ret variable
console.log("Return value: "+ret);
return ret;
};
```
### 获取已创建的类的对象

如果您想提取已创建对象的某个属性，可以使用以下方法。

在此示例中，您将看到如何获取类my\_activity的对象，并调用函数.secret()，该函数将打印对象的私有属性：
```javascript
Java.choose("com.example.a11x256.frida_test.my_activity" , {
onMatch : function(instance){ //This function will be called for every instance found by frida
console.log("Found instance: "+instance);
console.log("Result of secret func: " + instance.secret());
},
onComplete:function(){}
});
```
<img src="../../../.gitbook/assets/i3.png" alt="" data-size="original">

**Bug赏金提示**：**注册**Intigriti，一个由黑客创建的高级**Bug赏金平台**！立即加入我们，开始赚取高达**$100,000**的赏金！

{% embed url="https://go.intigriti.com/hacktricks" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks云 ☁️</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>🐦 Twitter 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 Youtube 🎥</strong></a></summary>

* 你在**网络安全公司**工作吗？想要在HackTricks中**宣传你的公司**吗？或者想要**获取PEASS的最新版本或下载HackTricks的PDF**吗？请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 发现我们的独家[**NFTs**](https://opensea.io/collection/the-peass-family)收藏品[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* 获取[**官方PEASS和HackTricks周边产品**](https://peass.creator-spring.com)
* **加入**[**💬**](https://emojipedia.org/speech-balloon/) [**Discord群组**](https://discord.gg/hRep4RUj7f) 或 [**Telegram群组**](https://t.me/peass) 或 **关注**我在**Twitter**上的[**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**。**
* **通过向[hacktricks repo](https://github.com/carlospolop/hacktricks)和[hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)提交PR来分享你的黑客技巧**。

</details>
