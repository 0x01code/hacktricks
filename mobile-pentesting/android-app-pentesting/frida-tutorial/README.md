# Fridaチュートリアル

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks Cloud ☁️</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>🐦 Twitter 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 Youtube 🎥</strong></a></summary>

* **サイバーセキュリティ企業**で働いていますか？ **HackTricksで会社を宣伝**したいですか？または、**PEASSの最新バージョンにアクセスしたり、HackTricksをPDFでダウンロード**したいですか？[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を見つけてください。独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクションです。
* [**公式のPEASS＆HackTricksのグッズ**](https://peass.creator-spring.com)を手に入れましょう。
* [**💬**](https://emojipedia.org/speech-balloon/) [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**telegramグループ**](https://t.me/peass)に**参加**するか、**Twitter**で**フォロー**してください[**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**。**
* **ハッキングのトリックを共有するには、PRを** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **と** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **に提出してください。**

</details>

<figure><img src="../../../.gitbook/assets/i3.png" alt=""><figcaption></figcaption></figure>

**バグバウンティのヒント**：ハッカーによって作成されたプレミアムな**バグバウンティプラットフォームであるIntigritiに登録**してください！今すぐ[**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks)に参加して、最大**$100,000**のバウンティを獲得しましょう！

{% embed url="https://go.intigriti.com/hacktricks" %}

## インストール

**fridaツール**をインストールします：
```bash
pip install frida-tools
pip install frida
```
**frida server**をAndroidに**ダウンロードしてインストール**します（[最新リリースをダウンロード](https://github.com/frida/frida/releases)）。\
ルートモードでadbを再起動し、接続し、frida-serverをアップロードし、実行権限を与えてバックグラウンドで実行するためのワンライナー：

{% code overflow="wrap" %}
```bash
adb root; adb connect localhost:6000; sleep 1; adb push frida-server /data/local/tmp/; adb shell "chmod 755 /data/local/tmp/frida-server"; adb shell "/data/local/tmp/frida-server &"
```
{% endcode %}

**動作を確認する**：
```bash
frida-ps -U #List packages and processes
frida-ps -U | grep -i <part_of_the_package_name> #Get all the package name
```
## チュートリアル

### [チュートリアル1](frida-tutorial-1.md)

**元記事**: [https://medium.com/infosec-adventures/introduction-to-frida-5a3f51595ca1](https://medium.com/infosec-adventures/introduction-to-frida-5a3f51595ca1)\
**APK**: [https://github.com/t0thkr1s/frida-demo/releases](https://github.com/t0thkr1s/frida-demo/releases)\
**ソースコード**: [https://github.com/t0thkr1s/frida-demo](https://github.com/t0thkr1s/frida-demo)

[リンク](frida-tutorial-1.md)をクリックして読んでください。

### [チュートリアル2](frida-tutorial-2.md)

**元記事**: [https://11x256.github.io/Frida-hooking-android-part-2/](https://11x256.github.io/Frida-hooking-android-part-2/) (パート2、3、4)\
**APKとソースコード**: [https://github.com/11x256/frida-android-examples](https://github.com/11x256/frida-android-examples)

[リンク](frida-tutorial-2.md)をクリックして読んでください。

### [チュートリアル3](owaspuncrackable-1.md)

**元記事**: [https://joshspicer.com/android-frida-1](https://joshspicer.com/android-frida-1)\
**APK**: [https://github.com/OWASP/owasp-mstg/blob/master/Crackmes/Android/Level\_01/UnCrackable-Level1.apk](https://github.com/OWASP/owasp-mstg/blob/master/Crackmes/Android/Level\_01/UnCrackable-Level1.apk)

[リンク](owaspuncrackable-1.md)をクリックして読んでください。\
**ここで素晴らしいFridaスクリプトを見つけることができます:** [**https://codeshare.frida.re/**](https://codeshare.frida.re)

## 早い例

ここでは、Fridaの基本的で興味深い機能を使ったクイックスクリプトを見つけることができます。

### コマンドラインからFridaを呼び出す
```bash
frida-ps -U

#Basic frida hooking
frida -l disableRoot.js -f owasp.mstg.uncrackable1

#Hooking before starting the app
frida -U --no-pause -l disableRoot.js -f owasp.mstg.uncrackable1
#The --no-pause and -f options allow the app to be spawned automatically,
#frozen so that the instrumentation can occur, and the automatically
#continue execution with our modified code.
```
### 基本的なPythonスクリプト

```python
import frida

# Attach to the target process
session = frida.attach("com.example.app")

# Define the JavaScript code to be injected
js_code = """
Java.perform(function () {
    // Hook the target method
    var targetClass = Java.use("com.example.app.TargetClass");
    targetClass.targetMethod.implementation = function () {
        // Print the arguments passed to the method
        console.log("Arguments: " + Array.prototype.slice.call(arguments));
        
        // Call the original method
        var result = this.targetMethod.apply(this, arguments);
        
        // Print the result
        console.log("Result: " + result);
        
        // Modify the result
        result += 1;
        
        // Return the modified result
        return result;
    };
});
"""

# Create the script
script = session.create_script(js_code)

# Load the script into the target process
script.load()

# Detach from the target process
session.detach()
```

このスクリプトは、Fridaを使用してAndroidアプリのターゲットプロセスにアタッチし、JavaScriptコードをインジェクトする基本的なPythonスクリプトです。

```python
import frida

# ターゲットプロセスにアタッチする
session = frida.attach("com.example.app")

# インジェクトするJavaScriptコードを定義する
js_code = """
Java.perform(function () {
    // ターゲットメソッドをフックする
    var targetClass = Java.use("com.example.app.TargetClass");
    targetClass.targetMethod.implementation = function () {
        // メソッドに渡された引数を表示する
        console.log("Arguments: " + Array.prototype.slice.call(arguments));
        
        // オリジナルのメソッドを呼び出す
        var result = this.targetMethod.apply(this, arguments);
        
        // 結果を表示する
        console.log("Result: " + result);
        
        // 結果を変更する
        result += 1;
        
        // 変更された結果を返す
        return result;
    };
});
"""

# スクリプトを作成する
script = session.create_script(js_code)

# スクリプトをターゲットプロセスにロードする
script.load()

# ターゲットプロセスからデタッチする
session.detach()
```

このスクリプトでは、`frida`モジュールを使用してターゲットプロセスにアタッチし、`com.example.app`というパッケージ名のAndroidアプリをターゲットにしています。JavaScriptコードは、`Java.perform`関数内でターゲットメソッドをフックし、メソッドに渡された引数を表示し、オリジナルのメソッドを呼び出し、結果を表示します。さらに、結果を変更して変更された結果を返します。最後に、スクリプトをターゲットプロセスにロードし、ターゲットプロセスからデタッチします。
```python
import frida, sys

jscode = open(sys.argv[0]).read()
process = frida.get_usb_device().attach('infosecadventures.fridademo')
script = process.create_script(jscode)
print('[ * ] Running Frida Demo application')
script.load()
sys.stdin.read()
```
### パラメータのない関数のフック

クラス `sg.vantagepoint.a.c` の関数 `a()` をフックします。
```javascript
Java.perform(function () {
;  rootcheck1.a.overload().implementation = function() {
rootcheck1.a.overload().implementation = function() {
send("sg.vantagepoint.a.c.a()Z   Root check 1 HIT!  su.exists()");
return false;
};
});
```
# Frida Tutorial: Hooking `exit()` in Android Apps

In this tutorial, we will learn how to hook the `exit()` function in Java code using Frida. By hooking this function, we can intercept the app's exit process and perform additional actions or modifications.

## Prerequisites

Before we begin, make sure you have the following:

- An Android device or emulator with a rooted or jailbroken environment.
- Frida installed on your machine. You can find installation instructions [here](https://frida.re/docs/installation/).

## Step 1: Setting up the Environment

First, we need to set up the environment for Frida. Follow these steps:

1. Connect your Android device or start the emulator.
2. Open a terminal and run the following command to check if the device is connected:

   ```bash
   adb devices
   ```

   You should see your device listed.

3. Start the target app on your device or emulator.

## Step 2: Writing the Frida Script

Now, let's write the Frida script to hook the `exit()` function. Create a new file called `hook_exit.js` and add the following code:

```javascript
Java.perform(function() {
  var System = Java.use('java.lang.System');
  var Runtime = Java.use('java.lang.Runtime');

  // Hook System.exit()
  System.exit.implementation = function(code) {
    console.log('System.exit() called with code: ' + code);

    // Perform additional actions or modifications here

    // Call the original System.exit() function
    this.exit(code);
  };

  // Hook Runtime.exit()
  Runtime.exit.implementation = function(code) {
    console.log('Runtime.exit() called with code: ' + code);

    // Perform additional actions or modifications here

    // Call the original Runtime.exit() function
    this.exit(code);
  };
});
```

## Step 3: Running the Frida Script

To run the Frida script, follow these steps:

1. Open a terminal and navigate to the directory where you saved `hook_exit.js`.
2. Run the following command to start the Frida server:

   ```bash
   frida-server
   ```

3. Open another terminal and navigate to the same directory.
4. Run the following command to attach Frida to the target app:

   ```bash
   frida -U -l hook_exit.js <package_name>
   ```

   Replace `<package_name>` with the package name of the target app.

5. You should see the output of the `console.log()` statements whenever `System.exit()` or `Runtime.exit()` is called in the app.

## Conclusion

In this tutorial, we learned how to hook the `exit()` function in Java code using Frida. By intercepting this function, we can perform additional actions or modifications during the app's exit process. This technique can be useful for various purposes, such as debugging or analyzing the behavior of an app.
```javascript
var sysexit = Java.use("java.lang.System");
sysexit.exit.overload("int").implementation = function(var_0) {
send("java.lang.System.exit(I)V  // We avoid exiting the application  :)");
};
```
# Fridaを使用したAndroidアプリのペネトレーションテスト

このチュートリアルでは、Fridaを使用してAndroidアプリの`.onStart()`と`.onCreate()`メソッドをフックする方法について説明します。

## 前提条件

- Androidデバイスまたはエミュレータ
- Fridaがインストールされていること

## 手順

1. ターゲットとなるAndroidアプリをデバイスまたはエミュレータにインストールします。

2. Fridaスクリプトを作成します。以下のコードを使用して、`.onStart()`と`.onCreate()`メソッドをフックするスクリプトを作成します。

```javascript
Java.perform(function() {
    var MainActivity = Java.use('com.example.app.MainActivity');

    MainActivity.onStart.implementation = function() {
        console.log('Hooked MainActivity.onStart()');
        this.onStart();
    };

    MainActivity.onCreate.implementation = function() {
        console.log('Hooked MainActivity.onCreate()');
        this.onCreate();
    };
});
```

3. Fridaスクリプトを保存します。例えば、`hook.js`という名前で保存します。

4. Fridaコマンドを使用して、Androidアプリに対してFridaスクリプトを適用します。以下のコマンドを実行します。

```
frida -U -l hook.js -f com.example.app
```

5. Androidアプリを起動します。Fridaスクリプトが正常に適用されている場合、`.onStart()`と`.onCreate()`メソッドがフックされたことを示すログが表示されます。

```
[Android Emulator::com.example.app]-> Hooked MainActivity.onStart()
[Android Emulator::com.example.app]-> Hooked MainActivity.onCreate()
```

これで、Androidアプリの`.onStart()`と`.onCreate()`メソッドをフックすることができました。フックされたメソッド内で任意の操作を実行することができます。
```javascript
var mainactivity = Java.use("sg.vantagepoint.uncrackable1.MainActivity");
mainactivity.onStart.overload().implementation = function() {
send("MainActivity.onStart() HIT!!!");
var ret = this.onStart.overload().call(this);
};
mainactivity.onCreate.overload("android.os.Bundle").implementation = function(var_0) {
send("MainActivity.onCreate() HIT!!!");
var ret = this.onCreate.overload("android.os.Bundle").call(this,var_0);
};
```
# Fridaを使用したAndroidアプリの`.onCreate()`のフック

このチュートリアルでは、Fridaを使用してAndroidアプリの`.onCreate()`メソッドをフックする方法について説明します。`.onCreate()`メソッドは、アプリの起動時に呼び出される重要なメソッドです。このメソッドをフックすることで、アプリの動作を監視したり、カスタムコードを挿入したりすることができます。

## 前提条件

以下の前提条件を満たしていることを確認してください。

- Androidデバイスまたはエミュレータが利用可能であること
- Fridaがインストールされていること（[Fridaのインストール方法](https://frida.re/docs/installation/)を参照）
- Fridaサーバーがデバイスまたはエミュレータ上で実行されていること（[Fridaサーバーの実行方法](https://frida.re/docs/android/)を参照）

## 手順

1. ターゲットとなるAndroidアプリをデバイスまたはエミュレータにインストールします。

2. Fridaスクリプトを作成します。以下のコードを使用して、`.onCreate()`メソッドをフックするスクリプトを作成します。

```javascript
Java.perform(function() {
  var targetClass = Java.use('com.example.app.MainActivity');
  targetClass.onCreate.implementation = function() {
    console.log('onCreate() メソッドが呼び出されました');
    this.onCreate();
  };
});
```

3. Fridaスクリプトを保存します。例えば、`hook.js`という名前で保存します。

4. コマンドラインで以下のコマンドを実行して、Fridaスクリプトを実行します。

```bash
frida -U -f com.example.app -l hook.js --no-pause
```

5. アプリを起動すると、`.onCreate()`メソッドがフックされ、コンソールにメッセージが表示されます。

## 結論

Fridaを使用してAndroidアプリの`.onCreate()`メソッドをフックすることで、アプリの動作を監視したり、カスタムコードを挿入したりすることができます。このテクニックを利用することで、アプリのセキュリティやパフォーマンスの向上に役立つことがあります。
```javascript
var activity = Java.use("android.app.Activity");
activity.onCreate.overload("android.os.Bundle").implementation = function(var_0) {
send("Activity HIT!!!");
var ret = this.onCreate.overload("android.os.Bundle").call(this,var_0);
};
```
### パラメータを持つ関数のフックと値の取得

復号化関数のフック。入力を表示し、元の関数を呼び出して入力を復号化し、最後に平文データを表示します。
```javascript
function getString(data){
var ret = "";
for (var i=0; i < data.length; i++){
ret += data[i].toString();
}
return ret
}
var aes_decrypt = Java.use("sg.vantagepoint.a.a");
aes_decrypt.a.overload("[B","[B").implementation = function(var_0,var_1) {
send("sg.vantagepoint.a.a.a([B[B)[B   doFinal(enc)  // AES/ECB/PKCS7Padding");
send("Key       : " + getString(var_0));
send("Encrypted : " + getString(var_1));
var ret = this.a.overload("[B","[B").call(this,var_0,var_1);
send("Decrypted : " + ret);

var flag = "";
for (var i=0; i < ret.length; i++){
flag += String.fromCharCode(ret[i]);
}
send("Decrypted flag: " + flag);
return ret; //[B
};
```
### ファンクションのフックと入力を使用した呼び出し

関数をフックして、文字列を受け取り、他の文字列で呼び出します（[こちら](https://11x256.github.io/Frida-hooking-android-part-2/)から）。
```javascript
var string_class = Java.use("java.lang.String"); // get a JS wrapper for java's String class

my_class.fun.overload("java.lang.String").implementation = function(x){ //hooking the new function
var my_string = string_class.$new("My TeSt String#####"); //creating a new String by using `new` operator
console.log("Original arg: " +x );
var ret =  this.fun(my_string); // calling the original function with the new String, and putting its return value in ret variable
console.log("Return value: "+ret);
return ret;
};
```
### 既に作成されたクラスのオブジェクトを取得する

作成されたオブジェクトの属性を抽出したい場合は、これを使用することができます。

この例では、クラスmy\_activityのオブジェクトを取得し、オブジェクトのプライベート属性を表示する関数.secret()を呼び出す方法を示します。
```javascript
Java.choose("com.example.a11x256.frida_test.my_activity" , {
onMatch : function(instance){ //This function will be called for every instance found by frida
console.log("Found instance: "+instance);
console.log("Result of secret func: " + instance.secret());
},
onComplete:function(){}
});
```
## 他のFridaチュートリアル

* [https://github.com/DERE-ad2001/Frida-Labs](https://github.com/DERE-ad2001/Frida-Labs)



<figure><img src="../../../.gitbook/assets/i3.png" alt=""><figcaption></figcaption></figure>

**バグバウンティのヒント**: **Intigriti**に**サインアップ**してください。これはハッカーによって作成されたプレミアムな**バグバウンティプラットフォーム**です！今すぐ[**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks)に参加して、最大**$100,000**のバウンティを獲得しましょう！

{% embed url="https://go.intigriti.com/hacktricks" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks Cloud ☁️</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>🐦 Twitter 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 Youtube 🎥</strong></a></summary>

* **サイバーセキュリティ企業**で働いていますか？ **HackTricksで会社を宣伝**したいですか？または、**最新バージョンのPEASSを入手したり、HackTricksをPDFでダウンロード**したいですか？[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見しましょう。これは私たちの独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクションです。
* [**公式のPEASS＆HackTricksグッズ**](https://peass.creator-spring.com)を手に入れましょう。
* [**💬**](https://emojipedia.org/speech-balloon/) [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**telegramグループ**](https://t.me/peass)に**参加**するか、**Twitter**で私を**フォロー**してください[**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **ハッキングのトリックを共有するには、**[**hacktricks repo**](https://github.com/carlospolop/hacktricks) **および** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **にPRを提出してください。**

</details>
