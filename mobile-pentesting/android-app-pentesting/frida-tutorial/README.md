# Fridaチュートリアル

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks Cloud ☁️</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>🐦 Twitter 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 Youtube 🎥</strong></a></summary>

* **サイバーセキュリティ会社**で働いていますか？ **HackTricksで会社を宣伝**したいですか？または、**PEASSの最新バージョンにアクセスしたり、HackTricksをPDFでダウンロード**したいですか？[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を見つけてください。独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクションです。
* [**公式のPEASS＆HackTricksのグッズ**](https://peass.creator-spring.com)を手に入れましょう。
* [**💬**](https://emojipedia.org/speech-balloon/) [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**telegramグループ**](https://t.me/peass)に**参加**するか、**Twitter**で**フォロー**してください[**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**。**
* **ハッキングのトリックを共有するには、PRを** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **と** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **に提出してください。**

</details>

<img src="../../../.gitbook/assets/i3.png" alt="" data-size="original">

**バグバウンティのヒント**：ハッカーによって作成されたプレミアムな**バグバウンティプラットフォームであるIntigritiに登録**してください！今すぐ[**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks)に参加して、最大**$100,000**の報奨金を獲得しましょう！

{% embed url="https://go.intigriti.com/hacktricks" %}

## インストール

**fridaツール**をインストールします：
```bash
pip install frida-tools
pip install frida
```
**frida server**をAndroidに**ダウンロードしてインストール**します（[最新リリースをダウンロード](https://github.com/frida/frida/releases)）。\
ルートモードでadbを再起動し、接続し、frida-serverをアップロードし、実行権限を与えてバックグラウンドで実行するためのワンライナー：

{% code overflow="wrap" %}
```bash
adb root; adb connect localhost:6000; sleep 1; adb push frida-server /data/local/tmp/; adb shell "chmod 755 /data/local/tmp/frida-server"; adb shell "/data/local/tmp/frida-server &"
```
{% endcode %}

**動作を確認する**：
```bash
frida-ps -U #List packages and processes
frida-ps -U | grep -i <part_of_the_package_name> #Get all the package name
```
## チュートリアル

### [チュートリアル1](frida-tutorial-1.md)

**元記事**: [https://medium.com/infosec-adventures/introduction-to-frida-5a3f51595ca1](https://medium.com/infosec-adventures/introduction-to-frida-5a3f51595ca1)\
**APK**: [https://github.com/t0thkr1s/frida-demo/releases](https://github.com/t0thkr1s/frida-demo/releases)\
**ソースコード**: [https://github.com/t0thkr1s/frida-demo](https://github.com/t0thkr1s/frida-demo)

[リンク](frida-tutorial-1.md)をクリックして読んでください。

### [チュートリアル2](frida-tutorial-2.md)

**元記事**: [https://11x256.github.io/Frida-hooking-android-part-2/](https://11x256.github.io/Frida-hooking-android-part-2/) (パート2、3、4)\
**APKとソースコード**: [https://github.com/11x256/frida-android-examples](https://github.com/11x256/frida-android-examples)

[リンク](frida-tutorial-2.md)をクリックして読んでください。

### [チュートリアル3](owaspuncrackable-1.md)

**元記事**: [https://joshspicer.com/android-frida-1](https://joshspicer.com/android-frida-1)\
**APK**: [https://github.com/OWASP/owasp-mstg/blob/master/Crackmes/Android/Level\_01/UnCrackable-Level1.apk](https://github.com/OWASP/owasp-mstg/blob/master/Crackmes/Android/Level\_01/UnCrackable-Level1.apk)

[リンク](owaspuncrackable-1.md)をクリックして読んでください。\
**ここで素晴らしいFridaスクリプトを見つけることができます:** [**https://codeshare.frida.re/**](https://codeshare.frida.re)

## 早い例

ここでは、Fridaの基本的で興味深い機能を使ったクイックスクリプトを見つけることができます:

### コマンドラインからFridaを呼び出す
```bash
frida-ps -U

#Basic frida hooking
frida -l disableRoot.js -f owasp.mstg.uncrackable1

#Hooking before starting the app
frida -U --no-pause -l disableRoot.js -f owasp.mstg.uncrackable1
#The --no-pause and -f options allow the app to be spawned automatically,
#frozen so that the instrumentation can occur, and the automatically
#continue execution with our modified code.
```
### 基本的なPythonスクリプト

```python
import frida

# Attach to the target process
session = frida.attach("com.example.app")

# Define the JavaScript code to be injected
js_code = """
Java.perform(function () {
    // Hook the target method
    var targetClass = Java.use("com.example.app.TargetClass");
    targetClass.targetMethod.implementation = function () {
        // Print the arguments passed to the method
        console.log("Arguments: " + Array.prototype.slice.call(arguments));
        
        // Call the original method
        var result = this.targetMethod.apply(this, arguments);
        
        // Print the result of the method
        console.log("Result: " + result);
        
        // Modify the result if needed
        result += 100;
        
        // Return the modified result
        return result;
    };
});
"""

# Create the script
script = session.create_script(js_code)

# Load the script into the target process
script.load()

# Detach from the target process
session.detach()
```

このPythonスクリプトは、Fridaを使用してAndroidアプリのターゲットプロセスにアタッチし、JavaScriptコードを注入するものです。

```python
import frida

# ターゲットプロセスにアタッチする
session = frida.attach("com.example.app")

# 注入するJavaScriptコードを定義する
js_code = """
Java.perform(function () {
    // ターゲットメソッドをフックする
    var targetClass = Java.use("com.example.app.TargetClass");
    targetClass.targetMethod.implementation = function () {
        // メソッドに渡された引数を表示する
        console.log("Arguments: " + Array.prototype.slice.call(arguments));
        
        // オリジナルのメソッドを呼び出す
        var result = this.targetMethod.apply(this, arguments);
        
        // メソッドの結果を表示する
        console.log("Result: " + result);
        
        // 必要に応じて結果を変更する
        result += 100;
        
        // 変更された結果を返す
        return result;
    };
});
"""

# スクリプトを作成する
script = session.create_script(js_code)

# スクリプトをターゲットプロセスにロードする
script.load()

# ターゲットプロセスからデタッチする
session.detach()
```

このスクリプトでは、`com.example.app`というAndroidアプリのターゲットプロセスにアタッチし、`com.example.app.TargetClass`というクラスの`targetMethod`というメソッドをフックしています。フックされたメソッドは、引数を表示し、オリジナルのメソッドを呼び出し、結果を表示します。必要に応じて結果を変更し、変更された結果を返します。
```python
import frida, sys

jscode = open(sys.argv[0]).read()
process = frida.get_usb_device().attach('infosecadventures.fridademo')
script = process.create_script(jscode)
print('[ * ] Running Frida Demo application')
script.load()
sys.stdin.read()
```
### パラメータのない関数のフック

クラス `sg.vantagepoint.a.c` の関数 `a()` をフックします。
```javascript
Java.perform(function () {
;  rootcheck1.a.overload().implementation = function() {
rootcheck1.a.overload().implementation = function() {
send("sg.vantagepoint.a.c.a()Z   Root check 1 HIT!  su.exists()");
return false;
};
});
```
# Frida Tutorial: Hooking `exit()` in Android Apps

In this tutorial, we will learn how to hook the `exit()` function in Java code using Frida. By hooking this function, we can intercept and modify the behavior of an Android app when it tries to exit.

## Prerequisites

Before we begin, make sure you have the following:

- An Android device or emulator with a rooted or jailbroken environment.
- Frida installed on your machine. You can find installation instructions [here](https://frida.re/docs/installation/).

## Step 1: Setting up the Environment

First, we need to set up the environment for our Android app. Install the target app on your device or emulator.

## Step 2: Writing the Frida Script

Next, we will write a Frida script to hook the `exit()` function. Create a new file called `hook_exit.js` and add the following code:

```javascript
Java.perform(function() {
    var System = Java.use('java.lang.System');
    var Runtime = Java.use('java.lang.Runtime');

    // Hook the exit() function
    System.exit.overload('int').implementation = function(code) {
        console.log('Exit code: ' + code);

        // Modify the exit code
        var modifiedCode = 0;

        // Call the original exit() function with the modified code
        this.exit(modifiedCode);
    };
});
```

## Step 3: Running the Frida Script

Now, we will run the Frida script to hook the `exit()` function in our target app. Open a terminal and navigate to the directory where the `hook_exit.js` file is located.

Run the following command to start the Frida server:

```
frida-server
```

On your machine, run the following command to attach Frida to the target app:

```
frida -U -l hook_exit.js <package_name>
```

Replace `<package_name>` with the package name of the target app.

## Step 4: Testing the Hook

Launch the target app on your device or emulator. Perform an action that triggers the `exit()` function, such as pressing a button that exits the app.

Check the terminal where Frida is running. You should see the exit code printed, indicating that the `exit()` function was successfully hooked.

## Conclusion

In this tutorial, we learned how to hook the `exit()` function in Java code using Frida. By hooking this function, we can intercept and modify the behavior of an Android app when it tries to exit. This technique can be useful for various purposes, such as bypassing app termination or modifying the exit code.
```javascript
var sysexit = Java.use("java.lang.System");
sysexit.exit.overload("int").implementation = function(var_0) {
send("java.lang.System.exit(I)V  // We avoid exiting the application  :)");
};
```
# Frida Tutorial: Hook MainActivity `.onStart()` & `.onCreate()`

このチュートリアルでは、Fridaを使用してAndroidアプリのMainActivityの`.onStart()`と`.onCreate()`メソッドをフックする方法を学びます。

## 前提条件

- Fridaがインストールされていること
- Androidデバイスまたはエミュレータが利用可能であること

## ステップ1: Fridaスクリプトの作成

まず、Fridaスクリプトを作成します。以下のコードを使用して、MainActivityの`.onStart()`と`.onCreate()`メソッドをフックします。

```javascript
Java.perform(function() {
    var MainActivity = Java.use('com.example.app.MainActivity');

    MainActivity.onStart.implementation = function() {
        console.log('MainActivity.onStart()が呼び出されました');
        this.onStart();
    };

    MainActivity.onCreate.implementation = function() {
        console.log('MainActivity.onCreate()が呼び出されました');
        this.onCreate();
    };
});
```

## ステップ2: Fridaスクリプトの実行

次に、Fridaスクリプトを実行します。以下のコマンドを使用して、Fridaスクリプトを実行します。

```bash
frida -U -f com.example.app -l script.js --no-pause
```

- `-U`オプションは、USB接続されたAndroidデバイスをターゲットにすることを指定します。
- `-f`オプションは、ターゲットとなるアプリのパッケージ名を指定します。
- `-l`オプションは、実行するFridaスクリプトのパスを指定します。
- `--no-pause`オプションは、アプリの実行を一時停止しないことを指定します。

## ステップ3: フックされたメソッドの確認

アプリを起動すると、Fridaスクリプトによってフックされた`.onStart()`と`.onCreate()`メソッドが呼び出されるたびに、ログにメッセージが表示されます。

```
[Google Pixel::com.example.app]-> MainActivity.onStart()が呼び出されました
[Google Pixel::com.example.app]-> MainActivity.onCreate()が呼び出されました
```

これで、MainActivityの`.onStart()`と`.onCreate()`メソッドをフックすることができました。

## まとめ

このチュートリアルでは、Fridaを使用してAndroidアプリのMainActivityの`.onStart()`と`.onCreate()`メソッドをフックする方法を学びました。これにより、アプリの実行中に特定のメソッドが呼び出された際にカスタムコードを実行することができます。
```javascript
var mainactivity = Java.use("sg.vantagepoint.uncrackable1.MainActivity");
mainactivity.onStart.overload().implementation = function() {
send("MainActivity.onStart() HIT!!!");
var ret = this.onStart.overload().call(this);
};
mainactivity.onCreate.overload("android.os.Bundle").implementation = function(var_0) {
send("MainActivity.onCreate() HIT!!!");
var ret = this.onCreate.overload("android.os.Bundle").call(this,var_0);
};
```
# Fridaを使用したAndroidアプリの`.onCreate()`のフック

このチュートリアルでは、Fridaを使用してAndroidアプリの`.onCreate()`メソッドをフックする方法について説明します。`.onCreate()`メソッドは、アプリの起動時に呼び出される重要なメソッドです。

## 前提条件

以下のものが必要です:

- Androidデバイスまたはエミュレータ
- FridaをインストールしたPC

## 手順

1. まず、Fridaを使用してAndroidアプリに接続します。以下のコマンドを実行します。

   ```
   frida -U -f <アプリのパッケージ名> --no-pause
   ```

   例:

   ```
   frida -U -f com.example.myapp --no-pause
   ```

2. アプリが起動したら、Fridaコンソールが表示されます。次に、Javaスクリプトを使用して`.onCreate()`メソッドをフックします。以下のコードを入力します。

   ```javascript
   Java.perform(function() {
       var targetClass = Java.use('<クラスの完全修飾名>');
       targetClass.onCreate.implementation = function() {
           console.log('onCreate()がフックされました！');
           // 追加の処理をここに記述します
           this.onCreate();
       };
   });
   ```

   例:

   ```javascript
   Java.perform(function() {
       var targetClass = Java.use('com.example.myapp.MainActivity');
       targetClass.onCreate.implementation = function() {
           console.log('onCreate()がフックされました！');
           // 追加の処理をここに記述します
           this.onCreate();
       };
   });
   ```

3. フックが正常に設定されたら、アプリを再起動して`.onCreate()`メソッドがフックされるか確認します。Fridaコンソールに`onCreate()がフックされました！`というメッセージが表示されるはずです。

これで、Fridaを使用してAndroidアプリの`.onCreate()`メソッドをフックすることができました。フックされたメソッド内で追加の処理を行うことができます。
```javascript
var activity = Java.use("android.app.Activity");
activity.onCreate.overload("android.os.Bundle").implementation = function(var_0) {
send("Activity HIT!!!");
var ret = this.onCreate.overload("android.os.Bundle").call(this,var_0);
};
```
### パラメータを持つ関数のフックと値の取得

復号化関数のフック。入力を表示し、元の関数を呼び出して入力を復号化し、最後に平文データを表示します。
```javascript
function getString(data){
var ret = "";
for (var i=0; i < data.length; i++){
ret += data[i].toString();
}
return ret
}
var aes_decrypt = Java.use("sg.vantagepoint.a.a");
aes_decrypt.a.overload("[B","[B").implementation = function(var_0,var_1) {
send("sg.vantagepoint.a.a.a([B[B)[B   doFinal(enc)  // AES/ECB/PKCS7Padding");
send("Key       : " + getString(var_0));
send("Encrypted : " + getString(var_1));
var ret = this.a.overload("[B","[B").call(this,var_0,var_1);
send("Decrypted : " + ret);

var flag = "";
for (var i=0; i < ret.length; i++){
flag += String.fromCharCode(ret[i]);
}
send("Decrypted flag: " + flag);
return ret; //[B
};
```
### ファンクションのフックと入力を使用した呼び出し

関数をフックして、文字列を受け取り、他の文字列で呼び出します（[こちら](https://11x256.github.io/Frida-hooking-android-part-2/)から）。
```javascript
var string_class = Java.use("java.lang.String"); // get a JS wrapper for java's String class

my_class.fun.overload("java.lang.String").implementation = function(x){ //hooking the new function
var my_string = string_class.$new("My TeSt String#####"); //creating a new String by using `new` operator
console.log("Original arg: " +x );
var ret =  this.fun(my_string); // calling the original function with the new String, and putting its return value in ret variable
console.log("Return value: "+ret);
return ret;
};
```
### クラスの既に作成されたオブジェクトの取得

作成されたオブジェクトの属性を抽出したい場合は、これを使用することができます。

この例では、クラスmy\_activityのオブジェクトを取得し、オブジェクトのプライベート属性を表示する関数.secret()を呼び出す方法を示します。
```javascript
Java.choose("com.example.a11x256.frida_test.my_activity" , {
onMatch : function(instance){ //This function will be called for every instance found by frida
console.log("Found instance: "+instance);
console.log("Result of secret func: " + instance.secret());
},
onComplete:function(){}
});
```
<img src="../../../.gitbook/assets/i3.png" alt="" data-size="original">

**バグバウンティのヒント**: **Intigriti**に**サインアップ**してください。これは、ハッカーによって作成されたプレミアムな**バグバウンティプラットフォーム**です！今すぐ[**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks)に参加して、最大**$100,000**の報酬を獲得しましょう！

{% embed url="https://go.intigriti.com/hacktricks" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks Cloud ☁️</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>🐦 Twitter 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 Youtube 🎥</strong></a></summary>

* **サイバーセキュリティ企業**で働いていますか？ **HackTricksで会社を宣伝**したいですか？または、**最新バージョンのPEASSを入手したり、HackTricksをPDFでダウンロード**したいですか？[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を見つけてください。これは、私たちの独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクションです。
* [**公式のPEASS＆HackTricksグッズ**](https://peass.creator-spring.com)を手に入れましょう。
* [**💬**](https://emojipedia.org/speech-balloon/) [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**telegramグループ**](https://t.me/peass)に**参加**するか、**Twitter**で私を**フォロー**してください[**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**。**
* **ハッキングのトリックを共有するには、PRを** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **および** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **に提出してください。**

</details>
