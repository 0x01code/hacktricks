# Frida Öğretici 2

<details>

<summary><strong>AWS hacklemeyi sıfırdan kahraman seviyesine öğrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Kırmızı Takım Uzmanı)</strong></a><strong>!</strong></summary>

* Bir **cybersecurity şirketinde mi çalışıyorsunuz**? **Şirketinizi HackTricks'te reklamını görmek** ister misiniz? veya **PEASS'ın en son sürümüne veya HackTricks'i PDF olarak indirmek** ister misiniz? [**ABONELİK PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keşfedin, özel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonunu
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* [**💬**](https://emojipedia.org/speech-balloon/) [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın** veya **Twitter**'da takip edin 🐦[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Hacking hilelerinizi [hacktricks repo](https://github.com/carlospolop/hacktricks) ve [hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)'ya PR göndererek paylaşın**.

</details>

<figure><img src="https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L_2uGJGU7AVNRcqRvEi%2Fuploads%2FwdlXOpyZOVGNzyhOiiFK%2Fimage%20(1).png?alt=media&#x26;token=13f4d279-7d3f-47ce-a68e-35f9a906973f" alt=""><figcaption></figcaption></figure>

​Eğer **hacking kariyeri**ne ilgi duyuyorsanız ve hacklenemez olanı hacklemek istiyorsanız - **işe alıyoruz!** (_akıcı polonyaca yazılı ve konuşma becerisi gereklidir_).

{% embed url="https://www.stmcyber.com/careers" %}



**Bu, yazının bir özetidir**: [https://11x256.github.io/Frida-hooking-android-part-2/](https://11x256.github.io/Frida-hooking-android-part-2/) (Bölümler 2, 3 ve 4)\
**APK'lar ve Kaynak kodu**: [https://github.com/11x256/frida-android-examples](https://github.com/11x256/frida-android-examples)

Birinci bölüm çok kolaydır.

**Orijinal kodun bazı bölümleri çalışmaz ve burada değiştirilmiştir.**

## Bölüm 2

Burada, **aynı isme sahip 2 fonksiyonu** nasıl **hook edeceğinizi** görebilirsiniz, ancak parametreleri farklıdır.\
Ayrıca, **kendi parametrelerinizle bir fonksiyonu nasıl çağıracağınızı** öğreneceksiniz.\
Ve son olarak, bir sınıfın bir örneğini nasıl bulacağınızı ve onun bir fonksiyonu nasıl çağıracağınızı gösteren bir örnek vardır.
```javascript
//s2.js
console.log("Script loaded successfully ");
Java.perform(function x() {
console.log("Inside java perform function");
var my_class = Java.use("com.example.a11x256.frida_test.my_activity");
//Hook "fun" with parameters (int, int)
my_class.fun.overload("int", "int").implementation = function (x, y) { //hooking the old function
console.log("original call: fun(" + x + ", " + y + ")");
var ret_value = this.fun(2, 5);
return ret_value;
};
//Hook "fun" with paramater(String)
var string_class = Java.use("java.lang.String");
my_class.fun.overload("java.lang.String").implementation = function (x) { //hooking the new function
console.log("*")
//Create a new String and call the function with your input.
var my_string = string_class.$new("My TeSt String#####");
console.log("Original arg: " + x);
var ret = this.fun(my_string);
console.log("Return value: " + ret);
console.log("*")
return ret;
};
//Find an instance of the class and call "secret" function.
Java.choose("com.example.a11x256.frida_test.my_activity", {
onMatch: function (instance) {
console.log(tring, and the it has"Found instance: " + instance);
console.log("Result of secret func: " + instance.secret());
},
onComplete: function () { }
});
});
```
Görebilirsiniz ki bir String oluşturmak için önce _java.lang.String_ sınıfına referans verilmiş ve ardından içeriği bir String olarak olan bir _$new_ nesnesi oluşturulmuştur. Bu, bir sınıfın yeni bir nesnesini oluşturmanın doğru yoludur. Ancak, bu durumda `this.fun()` içine herhangi bir String geçebilirsiniz, örneğin: `this.fun("merhaba!")`

### Python
```python
//loader.py
import frida
import time

device = frida.get_usb_device()
pid = device.spawn(["com.example.a11x256.frida_test"])
device.resume(pid)
time.sleep(1) #Without it Java.perform silently fails
session = device.attach(pid)
script = session.create_script(open("s2.js").read())
script.load()

#prevent the python script from terminating
raw_input()
```

```
python loader.py
```
## Bölüm 3

### Python

Şimdi, Python aracılığıyla kanca takılan uygulamaya komut gönderme ve işlev çağırma işlemini nasıl yapacağınızı göreceksiniz:
```python
//loader.py
import time
import frida

def my_message_handler(message, payload):
print message
print payload


device = frida.get_usb_device()
pid = device.spawn(["com.example.a11x256.frida_test"])
device.resume(pid)
time.sleep(1)  # Without it Java.perform silently fails
session = device.attach(pid)
with open("s3.js") as f:
script = session.create_script(f.read())
script.on("message", my_message_handler)
script.load()

command = ""
while 1 == 1:
command = raw_input("Enter command:\n1: Exit\n2: Call secret function\n3: Hook Secret\nchoice:")
if command == "1":
break
elif command == "2":
script.exports.callsecretfunction()
elif command == "3":
script.exports.hooksecretfunction()
```
Komut "**1**" çıkış yapacak, komut "**2**" sınıfın bir örneğini bulacak ve özel fonksiyon olan _**secret()**_'ı çağıracak ve komut "**3**" fonksiyonu _**secret()**_'ı kancalayacak, böylece farklı bir dize döndürecek.

Sonra, "**2**"yi çağırırsanız **gerçek sırrı** alırsınız, ancak "**3**" ve ardından "**2**"yi çağırırsanız **sahte sırrı** alırsınız.

### JS
```javascript
console.log("Script loaded successfully ");
var instances_array = [];
function callSecretFun() {
Java.perform(function () {
if (instances_array.length == 0) { // if array is empty
Java.choose("com.example.a11x256.frida_test.my_activity", {
onMatch: function (instance) {
console.log("Found instance: " + instance);
instances_array.push(instance)
console.log("Result of secret func: " + instance.secret());
},
onComplete: function () { }

});
}
else {//else if the array has some values
console.log("Result of secret func: " + instances_array[0].secret());
}

});
}

function hookSecret() {
Java.perform(function () {
var my_class = Java.use("com.example.a11x256.frida_test.my_activity");
var string_class = Java.use("java.lang.String");
my_class.secret.overload().implementation = function(){
var my_string = string_class.$new("TE ENGANNNNEEE");
return my_string;
}
});
}
rpc.exports = {
callsecretfunction: callSecretFun,
hooksecretfunction: hookSecret
};
```
## Bölüm 4

Burada, JSON nesnelerini kullanarak **Python ve JS'nin etkileşimde bulunmasını** nasıl sağlayacağınızı göreceksiniz. JS, verileri python istemcisine göndermek için `send()` işlevini kullanırken, Python, verileri JS betiğine göndermek için `post()` işlevlerini kullanır. **JS, Python'dan bir yanıt alana kadar** yürütme işlemini engelleyecektir.

### Python
```python
//loader.py
import time
import frida

def my_message_handler(message, payload):
print message
print payload
if message["type"] == "send":
print message["payload"]
data = message["payload"].split(":")[1].strip()
print 'message:', message
data = data.decode("base64")
user, pw = data.split(":")
data = ("admin" + ":" + pw).encode("base64")
print "encoded data:", data
script.post({"my_data": data})  # send JSON object
print "Modified data sent"


device = frida.get_usb_device()
pid = device.spawn(["com.example.a11x256.frida_test"])
device.resume(pid)
time.sleep(1)
session = device.attach(pid)
with open("s4.js") as f:
script = session.create_script(f.read())
script.on("message", my_message_handler)  # register the message handler
script.load()
raw_input()
```
### JS

JavaScript (JS), dünyanın en popüler programlama dillerinden biridir. Web tarayıcılarında kullanılan bir betik dildir ve genellikle istemci tarafı web geliştirme için kullanılır. JS, dinamik ve esnek bir dil olarak bilinir ve birçok farklı platformda kullanılabilir.

JS, Android uygulamalarının pentestinginde de kullanılabilir. Bu, Frida adlı bir araç kullanılarak gerçekleştirilebilir. Frida, JS betiklerini çalıştırmak için kullanılan bir çerçevedir ve Android uygulamalarının çalışma zamanında değişiklik yapmaya olanak tanır.

Frida'yı kullanarak, Android uygulamalarının davranışını izleyebilir, değiştirebilir ve hatta tamamen kontrol edebilirsiniz. Bu, uygulamanın içindeki verileri çalmak, güvenlik açıklarını tespit etmek veya uygulamanın çalışmasını değiştirmek gibi birçok farklı senaryoda kullanılabilir.

Frida'yı kullanarak Android uygulamalarını pentest etmek için aşağıdaki adımları izleyebilirsiniz:

1. Frida'yı yükleyin ve yapılandırın.
2. Hedef Android cihazına veya emülatöre Frida'yı yükleyin.
3. Frida'nın JS API'sini kullanarak bir betik oluşturun.
4. Oluşturduğunuz betiği hedef uygulamaya enjekte edin.
5. Uygulamanın davranışını izleyin ve gerektiğinde değiştirin.

Frida, Android uygulamalarını pentest etmek için güçlü bir araçtır ve JS kullanarak uygulamaların içine derinlemesine nüfuz etmenizi sağlar. Bu, güvenlik açıklarını tespit etmek ve uygulamaları daha güvenli hale getirmek için önemli bir adımdır.
```javascript
console.log("Script loaded successfully ");
Java.perform(function () {
var tv_class = Java.use("android.widget.TextView");
tv_class.setText.overload('java.lang.CharSequence').implementation = function (x) {
var string_to_send = x.toString();
var string_to_recv = "";
send(string_to_send); // send data to python code
recv(function (received_json_object) {
string_to_recv = received_json_object.my_data;
}).wait(); //block execution till the message is received
console.log("Final string_to_recv: "+ string_to_recv)
return this.setText(string_to_recv);
}
});
```
Açıklayacağım yeni bir şey olmadığı için 5. bölümü açıklamayacağım. Ancak okumak isterseniz burada: [https://11x256.github.io/Frida-hooking-android-part-5/](https://11x256.github.io/Frida-hooking-android-part-5/)



<figure><img src="https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L_2uGJGU7AVNRcqRvEi%2Fuploads%2FwdlXOpyZOVGNzyhOiiFK%2Fimage%20(1).png?alt=media&#x26;token=13f4d279-7d3f-47ce-a68e-35f9a906973f" alt=""><figcaption></figcaption></figure>

Eğer **hacking kariyeri** ile ilgileniyorsanız ve hacklenemez olanı hacklemek istiyorsanız - **işe alıyoruz!** (_akıcı Lehçe yazılı ve sözlü gereklidir_).

{% embed url="https://www.stmcyber.com/careers" %}

<details>

<summary><strong>Sıfırdan kahraman olmak için AWS hackleme öğrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Bir **cybersecurity şirketinde** çalışıyor musunuz? **Şirketinizi HackTricks'te reklamını yapmak** veya **PEASS'ın en son sürümüne erişmek veya HackTricks'i PDF olarak indirmek** ister misiniz? [**ABONELİK PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) koleksiyonumuz olan özel [**NFT'leri**](https://opensea.io/collection/the-peass-family) keşfedin
* [**Resmi PEASS & HackTricks ürünlerini alın**](https://peass.creator-spring.com)
* [**💬**](https://emojipedia.org/speech-balloon/) [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın** veya **Twitter** 🐦[**@carlospolopm**](https://twitter.com/hacktricks_live)**'u takip edin**.
* **Hacking hilelerinizi [hacktricks repo](https://github.com/carlospolop/hacktricks) ve [hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)'ya PR göndererek paylaşın**.

</details>
