# Οδηγός Frida 2

<details>

<summary><strong>Μάθετε το χάκινγκ του AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Εργάζεστε σε μια **εταιρεία κυβερνοασφάλειας**; Θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks**; Ή θέλετε να έχετε πρόσβαση στην **τελευταία έκδοση του PEASS ή να κατεβάσετε το HackTricks σε μορφή PDF**; Ελέγξτε τα [**ΠΑΚΕΤΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Ανακαλύψτε την [**Οικογένεια PEASS**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* **Εγγραφείτε** στην [**💬**](https://emojipedia.org/speech-balloon/) [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** με στο **Twitter** 🐦[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Μοιραστείτε τα χάκινγκ κόλπα σας υποβάλλοντας PRs στο [αποθετήριο hacktricks](https://github.com/carlospolop/hacktricks) και [αποθετήριο hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>

<figure><img src="https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L_2uGJGU7AVNRcqRvEi%2Fuploads%2FwdlXOpyZOVGNzyhOiiFK%2Fimage%20(1).png?alt=media&#x26;token=13f4d279-7d3f-47ce-a68e-35f9a906973f" alt=""><figcaption></figcaption></figure>

​Αν σας ενδιαφέρει η **καριέρα του χάκινγκ** και να χακάρετε το αχάκατο - **προσλαμβάνουμε!** (_απαιτείται άπταιστη γραπτή και προφορική γνώση της πολωνικής_).

{% embed url="https://www.stmcyber.com/careers" %}



**Αυτό είναι ένα σύνοψη της ανάρτησης**: [https://11x256.github.io/Frida-hooking-android-part-2/](https://11x256.github.io/Frida-hooking-android-part-2/) (Μέρη 2, 3 & 4)\
**APKs και πηγαίος κώδικας**: [https://github.com/11x256/frida-android-examples](https://github.com/11x256/frida-android-examples)

Το μέρος 1 είναι πολύ εύκολο.

**Ορισμένα μέρη του αρχικού κώδικα δεν λειτουργούν και έχουν τροποποιηθεί εδώ.**

## Μέρος 2

Εδώ μπορείτε να δείτε ένα παράδειγμα πώς να **συνδέσετε 2 συναρτήσεις με το ίδιο όνομα** αλλά με διαφορετικές παραμέτρους.\
Επίσης, θα μάθετε πώς να **καλέσετε μια συνάρτηση με τις δικές σας παραμέτρους**.\
Και τέλος, υπάρχει ένα παράδειγμα πώς να **βρείτε μια παρουσία μιας κλάσης και να την καλέσετε να εκτελέσει μια συνάρτηση**.
```javascript
//s2.js
console.log("Script loaded successfully ");
Java.perform(function x() {
console.log("Inside java perform function");
var my_class = Java.use("com.example.a11x256.frida_test.my_activity");
//Hook "fun" with parameters (int, int)
my_class.fun.overload("int", "int").implementation = function (x, y) { //hooking the old function
console.log("original call: fun(" + x + ", " + y + ")");
var ret_value = this.fun(2, 5);
return ret_value;
};
//Hook "fun" with paramater(String)
var string_class = Java.use("java.lang.String");
my_class.fun.overload("java.lang.String").implementation = function (x) { //hooking the new function
console.log("*")
//Create a new String and call the function with your input.
var my_string = string_class.$new("My TeSt String#####");
console.log("Original arg: " + x);
var ret = this.fun(my_string);
console.log("Return value: " + ret);
console.log("*")
return ret;
};
//Find an instance of the class and call "secret" function.
Java.choose("com.example.a11x256.frida_test.my_activity", {
onMatch: function (instance) {
console.log(tring, and the it has"Found instance: " + instance);
console.log("Result of secret func: " + instance.secret());
},
onComplete: function () { }
});
});
```
Μπορείτε να δείτε ότι για να δημιουργήσετε ένα String πρώτα αναφέρεται η κλάση _java.lang.String_ και στη συνέχεια δημιουργείται ένα νέο αντικείμενο _$new_ αυτής της κλάσης με ένα String ως περιεχόμενο. Αυτός είναι ο σωστός τρόπος για να δημιουργήσετε ένα νέο αντικείμενο μιας κλάσης. Ωστόσο, σε αυτήν την περίπτωση, μπορείτε απλά να περάσετε στην `this.fun()` οποιοδήποτε String θέλετε, όπως: `this.fun("γεια σου!")`

### Python
```python
//loader.py
import frida
import time

device = frida.get_usb_device()
pid = device.spawn(["com.example.a11x256.frida_test"])
device.resume(pid)
time.sleep(1) #Without it Java.perform silently fails
session = device.attach(pid)
script = session.create_script(open("s2.js").read())
script.load()

#prevent the python script from terminating
raw_input()
```

```
python loader.py
```
## Μέρος 3

### Python

Τώρα θα δείτε πώς να στείλετε εντολές στην εφαρμογή που έχει υποκλειστεί μέσω Python για να καλέσετε μια συνάρτηση:
```python
//loader.py
import time
import frida

def my_message_handler(message, payload):
print message
print payload


device = frida.get_usb_device()
pid = device.spawn(["com.example.a11x256.frida_test"])
device.resume(pid)
time.sleep(1)  # Without it Java.perform silently fails
session = device.attach(pid)
with open("s3.js") as f:
script = session.create_script(f.read())
script.on("message", my_message_handler)
script.load()

command = ""
while 1 == 1:
command = raw_input("Enter command:\n1: Exit\n2: Call secret function\n3: Hook Secret\nchoice:")
if command == "1":
break
elif command == "2":
script.exports.callsecretfunction()
elif command == "3":
script.exports.hooksecretfunction()
```
Η εντολή "**1**" θα **τερματίσει** την εκτέλεση, η εντολή "**2**" θα βρει και θα καλέσει την **ιδιωτική συνάρτηση** _**secret()**_ και η εντολή "**3**" θα **συνδέσει** την συνάρτηση _**secret()**_ έτσι ώστε να **επιστρέφει** μια **διαφορετική συμβολοσειρά**.

Έτσι, αν καλέσετε την εντολή "**2**" θα λάβετε τον **πραγματικό μυστικό**, αλλά αν καλέσετε πρώτα την εντολή "**3**" και μετά την εντολή "**2**" θα λάβετε το **ψεύτικο μυστικό**.

### JS
```javascript
console.log("Script loaded successfully ");
var instances_array = [];
function callSecretFun() {
Java.perform(function () {
if (instances_array.length == 0) { // if array is empty
Java.choose("com.example.a11x256.frida_test.my_activity", {
onMatch: function (instance) {
console.log("Found instance: " + instance);
instances_array.push(instance)
console.log("Result of secret func: " + instance.secret());
},
onComplete: function () { }

});
}
else {//else if the array has some values
console.log("Result of secret func: " + instances_array[0].secret());
}

});
}

function hookSecret() {
Java.perform(function () {
var my_class = Java.use("com.example.a11x256.frida_test.my_activity");
var string_class = Java.use("java.lang.String");
my_class.secret.overload().implementation = function(){
var my_string = string_class.$new("TE ENGANNNNEEE");
return my_string;
}
});
}
rpc.exports = {
callsecretfunction: callSecretFun,
hooksecretfunction: hookSecret
};
```
## Μέρος 4

Εδώ θα δείτε πώς να κάνετε την **αλληλεπίδραση μεταξύ Python και JS** χρησιμοποιώντας αντικείμενα JSON. Το JS χρησιμοποιεί τη συνάρτηση `send()` για να στείλει δεδομένα στον πελάτη Python, και ο Python χρησιμοποιεί τις συναρτήσεις `post()` για να στείλει δεδομένα στον κώδικα JS. Το **JS θα αποκλείσει την εκτέλεση** μέχρι να λάβει μια απάντηση από τον Python.
```python
//loader.py
import time
import frida

def my_message_handler(message, payload):
print message
print payload
if message["type"] == "send":
print message["payload"]
data = message["payload"].split(":")[1].strip()
print 'message:', message
data = data.decode("base64")
user, pw = data.split(":")
data = ("admin" + ":" + pw).encode("base64")
print "encoded data:", data
script.post({"my_data": data})  # send JSON object
print "Modified data sent"


device = frida.get_usb_device()
pid = device.spawn(["com.example.a11x256.frida_test"])
device.resume(pid)
time.sleep(1)
session = device.attach(pid)
with open("s4.js") as f:
script = session.create_script(f.read())
script.on("message", my_message_handler)  # register the message handler
script.load()
raw_input()
```
### JS

Το JavaScript (JS) είναι μια γλώσσα προγραμματισμού που χρησιμοποιείται κυρίως για την ανάπτυξη διαδραστικών ιστοσελίδων. Είναι μια γλώσσα υψηλού επιπέδου και δυναμική, που επιτρέπει την επεξεργασία και την αλληλεπίδραση με τα στοιχεία της ιστοσελίδας. Ο κώδικας JS εκτελείται από τον πελάτη (π.χ. περιηγητής) και όχι από τον διακομιστή, κάνοντας τον ιδανικό για την προσθήκη δυναμικών λειτουργιών σε μια ιστοσελίδα.

Ο κώδικας JS μπορεί να εκτελεστεί σε πολλά περιβάλλοντα, συμπεριλαμβανομένων των περιηγητών, των εφαρμογών κινητών και των εξυπηρετητών. Με τη χρήση του Frida, μπορούμε να εκτελέσουμε κώδικα JS σε εφαρμογές Android και να παρακολουθήσουμε και να τροποποιήσουμε τη συμπεριφορά τους.

Ο Frida είναι ένα εργαλείο ανοιχτού κώδικα που παρέχει μια απλή διεπαφή για την εκτέλεση κώδικα JS σε εφαρμογές Android. Μπορεί να χρησιμοποιηθεί για την ανάλυση και την επίθεση σε εφαρμογές, καθώς και για την ανάπτυξη εργαλείων ασφαλείας. Με το Frida, μπορούμε να παρακολουθήσουμε και να τροποποιήσουμε την εκτέλεση του κώδικα των εφαρμογών Android, προσφέροντας μας πλήρη έλεγχο και δυνατότητες παρακολούθησης.
```javascript
console.log("Script loaded successfully ");
Java.perform(function () {
var tv_class = Java.use("android.widget.TextView");
tv_class.setText.overload('java.lang.CharSequence').implementation = function (x) {
var string_to_send = x.toString();
var string_to_recv = "";
send(string_to_send); // send data to python code
recv(function (received_json_object) {
string_to_recv = received_json_object.my_data;
}).wait(); //block execution till the message is received
console.log("Final string_to_recv: "+ string_to_recv)
return this.setText(string_to_recv);
}
});
```
Υπάρχει μια ενότητα 5 που δεν πρόκειται να εξηγήσω επειδή δεν υπάρχει κάτι νέο. Αλλά αν θέλετε να το διαβάσετε, είναι εδώ: [https://11x256.github.io/Frida-hooking-android-part-5/](https://11x256.github.io/Frida-hooking-android-part-5/)



<figure><img src="https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L_2uGJGU7AVNRcqRvEi%2Fuploads%2FwdlXOpyZOVGNzyhOiiFK%2Fimage%20(1).png?alt=media&#x26;token=13f4d279-7d3f-47ce-a68e-35f9a906973f" alt=""><figcaption></figcaption></figure>

Εάν ενδιαφέρεστε για μια **καριέρα στο χάκινγκ** και για να χακάρετε το αδύνατο - **προσλαμβάνουμε!** (_απαιτείται άπταιστη γραπτή και προφορική γνώση της πολωνικής_).

{% embed url="https://www.stmcyber.com/careers" %}

<details>

<summary><strong>Μάθετε το χάκινγκ του AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Εργάζεστε σε μια **εταιρεία κυβερνοασφάλειας**; Θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks**; Ή θέλετε να έχετε πρόσβαση στην **τελευταία έκδοση του PEASS ή να κατεβάσετε το HackTricks σε μορφή PDF**; Ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Ανακαλύψτε [**την Οικογένεια PEASS**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* **Εγγραφείτε στην** [**💬**](https://emojipedia.org/speech-balloon/) [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** με στο **Twitter** 🐦[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Μοιραστείτε τα χάκινγκ κόλπα σας υποβάλλοντας PRs στο [αποθετήριο hacktricks](https://github.com/carlospolop/hacktricks) και [αποθετήριο hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>
