# Webview-Angriffe

<details>

<summary><strong>Lernen Sie AWS-Hacking von Grund auf mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks bewerben m√∂chten** oder **HackTricks als PDF herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merchandise**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegramm-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositories senden.

</details>

## Vereinfachter Leitfaden zu WebView-Konfigurationen und Sicherheit

### √úbersicht √ºber WebView-Schwachstellen

Ein wesentlicher Aspekt der Android-Entwicklung besteht darin, WebViews korrekt zu behandeln. Dieser Leitfaden hebt wichtige Konfigurationen und Sicherheitspraktiken hervor, um Risiken im Zusammenhang mit der Verwendung von WebViews zu minimieren.

![Beispiel WebView](../../.gitbook/assets/image%20(718).png)

### **Dateizugriff in WebViews**

Standardm√§√üig erlauben WebViews den Dateizugriff. Diese Funktionalit√§t wird durch die Methode `setAllowFileAccess()` gesteuert, die seit Android API-Level 3 (Cupcake 1.5) verf√ºgbar ist. Anwendungen mit der Berechtigung **android.permission.READ_EXTERNAL_STORAGE** k√∂nnen Dateien aus externem Speicher lesen, indem sie das Datei-URL-Schema (`file://path/to/file`) verwenden.

#### **Veraltete Funktionen: Universeller und Dateizugriff von URLs**

- **Universeller Zugriff von Datei-URLs**: Diese veraltete Funktion erm√∂glichte Cross-Origin-Anfragen von Datei-URLs und stellte ein erhebliches Sicherheitsrisiko durch potenzielle XSS-Angriffe dar. Die Standardeinstellung ist f√ºr Apps, die auf Android Jelly Bean und neuer abzielen, deaktiviert (`false`).
- Verwenden Sie `getAllowUniversalAccessFromFileURLs()`, um diese Einstellung zu √ºberpr√ºfen.
- Verwenden Sie `setAllowUniversalAccessFromFileURLs(boolean)`, um diese Einstellung zu √§ndern.

- **Dateizugriff von Datei-URLs**: Diese Funktion, ebenfalls veraltet, kontrollierte den Zugriff auf Inhalte von anderen Datei-URL-Schemas. Wie der universelle Zugriff ist die Standardeinstellung aus Sicherheitsgr√ºnden deaktiviert.
- Verwenden Sie `getAllowFileAccessFromFileURLs()`, um zu √ºberpr√ºfen, und `setAllowFileAccessFromFileURLs(boolean)`, um festzulegen.

#### **Sicherer Dateiload**

Um den Dateisystemzugriff zu deaktivieren und dennoch auf Assets und Ressourcen zuzugreifen, wird die Methode `setAllowFileAccess()` verwendet. Ab Android R ist die Standardeinstellung `false`.
- √úberpr√ºfen Sie mit `getAllowFileAccess()`.
- Aktivieren oder deaktivieren Sie mit `setAllowFileAccess(boolean)`.

#### **WebViewAssetLoader**

Die Klasse **WebViewAssetLoader** ist der moderne Ansatz zum Laden lokaler Dateien. Sie verwendet http(s)-URLs zum Zugriff auf lokale Assets und Ressourcen und entspricht der Same-Origin-Richtlinie, wodurch die Verwaltung von CORS erleichtert wird.

### **JavaScript und Intent-Schema-Handling**

- **JavaScript**: Standardm√§√üig in WebViews deaktiviert, kann es √ºber `setJavaScriptEnabled()` aktiviert werden. Vorsicht ist geboten, da das Aktivieren von JavaScript ohne angemessene Sicherheitsvorkehrungen Sicherheitsl√ºcken einf√ºhren kann.

- **Intent-Schema**: WebViews k√∂nnen das `intent`-Schema verarbeiten, was potenziell zu Exploits f√ºhren kann, wenn es nicht sorgf√§ltig verwaltet wird. Ein Beispiel f√ºr eine Schwachstelle war ein freigelegter WebView-Parameter "support_url", der f√ºr die Ausf√ºhrung von Cross-Site-Scripting (XSS)-Angriffen ausgenutzt werden konnte.

![Verwundbare WebView](../../.gitbook/assets/image%20(719).png)

Beispiel f√ºr Ausnutzung mit adb:
```bash
adb.exe shell am start -n com.tmh.vulnwebview/.SupportWebView ‚Äìes support_url "https://example.com/xss.html"
```
### JavaScript Bridge

Eine Funktion wird von Android bereitgestellt, die es **JavaScript** in einem WebView erm√∂glicht, **native Android-App-Funktionen** aufzurufen. Dies wird durch die Verwendung der Methode `addJavascriptInterface` erreicht, die JavaScript mit nativen Android-Funktionalit√§ten integriert und als _WebView JavaScript Bridge_ bezeichnet wird. Vorsicht ist geboten, da diese Methode allen Seiten innerhalb des WebViews Zugriff auf das registrierte JavaScript Interface-Objekt erm√∂glicht und somit ein Sicherheitsrisiko besteht, wenn sensible Informationen √ºber diese Schnittstellen offengelegt werden.

### Wichtige √úberlegungen

- **√Ñu√üerste Vorsicht ist geboten** bei Apps, die auf Android-Versionen unter 4.2 abzielen, aufgrund einer Sicherheitsl√ºcke, die die Ausf√ºhrung von Remote-Code durch b√∂sartiges JavaScript erm√∂glicht, indem die Reflexion ausgenutzt wird.

#### Implementierung einer JavaScript Bridge

- **JavaScript-Schnittstellen** k√∂nnen mit nativem Code interagieren, wie in den Beispielen gezeigt, in denen eine Klassenmethode f√ºr JavaScript freigegeben wird:
```javascript
@JavascriptInterface
public String getSecret() {
return "SuperSecretPassword";
};
```
- JavaScript Bridge wird aktiviert, indem eine Schnittstelle zum WebView hinzugef√ºgt wird:
```javascript
webView.addJavascriptInterface(new JavascriptBridge(), "javascriptBridge");
webView.reload();
```
- Potenzielle Ausnutzung durch JavaScript, zum Beispiel √ºber einen XSS-Angriff, erm√∂glicht das Aufrufen von freigegebenen Java-Methoden:
```html
<script>alert(javascriptBridge.getSecret());</script>
```
- Um Risiken zu minimieren, **beschr√§nken Sie die Verwendung der JavaScript-Bridge** auf den mit der APK ausgelieferten Code und verhindern Sie das Laden von JavaScript aus externen Quellen. F√ºr √§ltere Ger√§te sollte das minimale API-Level auf 17 gesetzt werden.

### Reflektionsbasierte Remote Code Execution (RCE)

- Eine dokumentierte Methode erm√∂glicht die Erreichung von RCE durch Reflektion durch Ausf√ºhrung einer spezifischen Nutzlast. Die `@JavascriptInterface`-Annotation verhindert jedoch den unbefugten Zugriff auf Methoden und begrenzt somit die Angriffsfl√§che.

### Remote-Debugging

- **Remote-Debugging** ist mit den **Chrome Developer Tools** m√∂glich und erm√∂glicht die Interaktion und beliebige Ausf√ºhrung von JavaScript im WebView-Inhalt.

#### Aktivieren des Remote-Debuggings

- Das Remote-Debugging kann f√ºr alle WebViews in einer Anwendung aktiviert werden, indem:
```java
if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.KITKAT) {
WebView.setWebContentsDebuggingEnabled(true);
}
```
- Um das Debuggen bedingt auf der Debuggable-Eigenschaft der Anwendung zu aktivieren:
```java
if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.KITKAT) {
if (0 != (getApplicationInfo().flags & ApplicationInfo.FLAG_DEBUGGABLE))
{ WebView.setWebContentsDebuggingEnabled(true); }
}
```
## Exfiltration beliebiger Dateien

- Zeigt die Exfiltration beliebiger Dateien mithilfe eines XMLHttpRequest:
```javascript
var xhr = new XMLHttpRequest();
xhr.onreadystatechange = function() {
if (xhr.readyState == XMLHttpRequest.DONE) {
alert(xhr.responseText);
}
}
xhr.open('GET', 'file:///data/data/com.authenticationfailure.wheresmybrowser/databases/super_secret.db', true);
xhr.send(null);
```
## Referenzen
* [https://labs.integrity.pt/articles/review-android-webviews-fileaccess-attack-vectors/index.html](https://labs.integrity.pt/articles/review-android-webviews-fileaccess-attack-vectors/index.html)
* [https://github.com/authenticationfailure/WheresMyBrowser.Android](https://github.com/authenticationfailure/WheresMyBrowser.Android)
* [https://developer.android.com/reference/android/webkit/WebView](https://developer.android.com/reference/android/webkit/WebView)

<details>

<summary><strong>Lernen Sie AWS-Hacking von Null auf Held mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks bewerben m√∂chten** oder **HackTricks als PDF herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merchandise**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositories senden.

</details>
