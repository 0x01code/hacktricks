# Mashambulizi ya WebView

<details>

<summary><strong>Jifunze kuhusu kudukua AWS kutoka mwanzo hadi kuwa bingwa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako ikionekana kwenye HackTricks** au **kupakua HackTricks kwa muundo wa PDF** Angalia [**MPANGO WA KUJIUNGA**](https://github.com/sponsors/carlospolop)!
* Pata [**swag rasmi ya PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**The PEASS Family**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa [**NFTs**](https://opensea.io/collection/the-peass-family) za kipekee
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au [**kikundi cha telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Shiriki mbinu zako za kudukua kwa kuwasilisha PR kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos za github.

</details>

## Mwongozo Rahisi kuhusu Mipangilio na Usalama wa WebView

### Muhtasari wa Udhaifu wa WebView

Sehemu muhimu ya maendeleo ya Android inahusisha kushughulikia WebViews kwa usahihi. Mwongozo huu unasisitiza mipangilio muhimu na mazoea ya usalama ili kupunguza hatari zinazohusiana na matumizi ya WebView.

![Mfano wa WebView](../../.gitbook/assets/image%20(718).png)

### **Upatikanaji wa Faili katika WebViews**

Kwa chaguo-msingi, WebViews huruhusu upatikanaji wa faili. Utendaji huu unadhibitiwa na njia ya `setAllowFileAccess()`, inayopatikana tangu kiwango cha API ya Android 3 (Cupcake 1.5). Programu zilizo na ruhusa ya **android.permission.READ_EXTERNAL_STORAGE** zinaweza kusoma faili kutoka kwenye uhifadhi wa nje kwa kutumia mfumo wa URL ya faili (`file://path/to/file`).

#### **Vipengele Vilivyopitwa na Wakati: Upatikanaji wa Kila Aina Kutoka kwenye URL za Faili**

- **Upatikanaji wa Kila Aina Kutoka kwenye URL za Faili**: Kipengele hiki kilichopitwa na wakati kiliruhusu maombi kutoka kwenye URL za faili za asili, kwa kuweka hatari kubwa ya usalama kutokana na mashambulizi ya XSS. Mipangilio ya chaguo-msingi ni imelemazwa (`false`) kwa programu zinazolenga Android Jelly Bean na mpya zaidi.
- Ili kuangalia mipangilio hii, tumia `getAllowUniversalAccessFromFileURLs()`.
- Ili kubadilisha mipangilio hii, tumia `setAllowUniversalAccessFromFileURLs(boolean)`.

- **Upatikanaji wa Faili Kutoka kwenye URL za Faili**: Kipengele hiki pia kilichopitwa na wakati, kilidhibiti upatikanaji wa yaliyomo kutoka kwenye URL za mfumo wa faili nyingine. Kama upatikanaji wa kila aina, mipangilio yake ya chaguo-msingi ni imelemazwa kwa usalama bora.
- Tumia `getAllowFileAccessFromFileURLs()` kuangalia na `setAllowFileAccessFromFileURLs(boolean)` kuweka.

#### **Upakiaji Salama wa Faili**

Ili kulemaza upatikanaji wa mfumo wa faili wakati bado unapata mali na rasilimali, njia ya `setAllowFileAccess()` hutumiwa. Kuanzia Android R na zaidi, mipangilio ya chaguo-msingi ni `false`.
- Angalia na `getAllowFileAccess()`.
- Wezesha au lemesha kwa kutumia `setAllowFileAccess(boolean)`.

#### **WebViewAssetLoader**

Darasa la **WebViewAssetLoader** ni njia ya kisasa ya kupakia faili za ndani. Inatumia URL za http(s) kwa kupata mali na rasilimali za ndani, ikilingana na sera ya Same-Origin, hivyo kuwezesha usimamizi wa CORS.

### **Kushughulikia JavaScript na Schemes za Intent**

- **JavaScript**: Limelemazwa kwa chaguo-msingi katika WebViews, linaweza kuwezeshwa kupitia `setJavaScriptEnabled()`. Tahadhari inashauriwa kwani kuwezesha JavaScript bila ulinzi sahihi kunaweza kuleta udhaifu wa usalama.

- **Schemes za Intent**: WebViews zinaweza kushughulikia mpango wa `intent`, ambao unaweza kusababisha udanganyifu ikiwa hautasimamiwa kwa uangalifu. Mfano wa udhaifu ulihusisha parameter ya WebView iliyofichuliwa "support_url" ambayo inaweza kutumiwa kutekeleza mashambulizi ya cross-site scripting (XSS).

![WebView Inayoweza Kudukuliwa](../../.gitbook/assets/image%20(719).png)

Mfano wa kudukua kwa kutumia adb:
```bash
adb.exe shell am start -n com.tmh.vulnwebview/.SupportWebView ‚Äìes support_url "https://example.com/xss.html"
```
### Daraja la Javascript

Kuna kipengele kinachotolewa na Android kinachowezesha **JavaScript** katika WebView kuita **kazi za programu za asili za Android**. Hii inafanikishwa kwa kutumia njia ya `addJavascriptInterface`, ambayo inaunganisha JavaScript na utendaji wa asili wa Android, inayoitwa _Daraja la JavaScript la WebView_. Tahadhari inashauriwa kwani njia hii inaruhusu kurasa zote ndani ya WebView kupata kifaa cha Uunganisho wa JavaScript kilichosajiliwa, ikileta hatari ya usalama ikiwa habari nyeti itafichuliwa kupitia interface hizi.

### Mambo Muhimu ya Kuzingatia

- **Tahadhari kubwa inahitajika** kwa programu zinazolenga toleo la Android chini ya 4.2 kutokana na udhaifu unaoruhusu utekelezaji wa nambari kwa mbali kupitia JavaScript mbaya, ukichangamkia uchunguzi.

#### Kutekeleza Daraja la JavaScript

- **Vifaa vya JavaScript** vinaweza kuingiliana na nambari ya asili, kama inavyoonyeshwa katika mifano ambapo njia ya darasa inafichuliwa kwa JavaScript:
```javascript
@JavascriptInterface
public String getSecret() {
return "SuperSecretPassword";
};
```
- JavaScript Bridge inawezeshwa kwa kuongeza kiolesura kwenye WebView:
```javascript
webView.addJavascriptInterface(new JavascriptBridge(), "javascriptBridge");
webView.reload();
```
- Uwezekano wa kutumia JavaScript, kwa mfano, kupitia shambulio la XSS, inawezesha wito wa njia za Java zilizofichuliwa:
```html
<script>alert(javascriptBridge.getSecret());</script>
```
- Ili kupunguza hatari, **zuia matumizi ya daraja la JavaScript** kwa nambari iliyosafirishwa na APK na zuia kupakia JavaScript kutoka vyanzo vya mbali. Kwa vifaa vya zamani, weka kiwango cha chini cha API kuwa 17.

### Utekelezaji wa Kijijini wa Kanuni ya Mbali (RCE)

- Mbinu iliyodokumentiwa inaruhusu kufikia RCE kupitia uchunguzi kwa kutekeleza mzigo maalum. Walakini, alama ya `@JavascriptInterface` inazuia ufikiaji usioidhinishwa wa njia, ikipunguza eneo la shambulio.

### Uchunguzi wa Mbali

- **Uchunguzi wa mbali** unawezekana na **Zana za Watengenezaji wa Chrome**, kuruhusu mwingiliano na utekelezaji wa JavaScript usio na kikomo ndani ya yaliyomo ya WebView.

#### Kuwezesha Uchunguzi wa Mbali

- Uchunguzi wa mbali unaweza kuwezeshwa kwa WebViews zote ndani ya programu kwa:
```java
if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.KITKAT) {
WebView.setWebContentsDebuggingEnabled(true);
}
```
- Ili kuwezesha uchunguzi kwa msingi wa hali ya kufuatilia ya programu:
```java
if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.KITKAT) {
if (0 != (getApplicationInfo().flags & ApplicationInfo.FLAG_DEBUGGABLE))
{ WebView.setWebContentsDebuggingEnabled(true); }
}
```
## Kupora faili yoyote

- Inaonyesha jinsi ya kupora faili yoyote kwa kutumia XMLHttpRequest:
```javascript
var xhr = new XMLHttpRequest();
xhr.onreadystatechange = function() {
if (xhr.readyState == XMLHttpRequest.DONE) {
alert(xhr.responseText);
}
}
xhr.open('GET', 'file:///data/data/com.authenticationfailure.wheresmybrowser/databases/super_secret.db', true);
xhr.send(null);
```
## Marejeo
* [https://labs.integrity.pt/articles/review-android-webviews-fileaccess-attack-vectors/index.html](https://labs.integrity.pt/articles/review-android-webviews-fileaccess-attack-vectors/index.html)
* [https://github.com/authenticationfailure/WheresMyBrowser.Android](https://github.com/authenticationfailure/WheresMyBrowser.Android)
* [https://developer.android.com/reference/android/webkit/WebView](https://developer.android.com/reference/android/webkit/WebView)

<details>

<summary><strong>Jifunze kuhusu kudukua AWS kutoka sifuri hadi shujaa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako inatangazwa kwenye HackTricks** au **kupakua HackTricks kwa muundo wa PDF** Angalia [**MPANGO WA KUJIUNGA**](https://github.com/sponsors/carlospolop)!
* Pata [**swag rasmi ya PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**The PEASS Family**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa [**NFTs**](https://opensea.io/collection/the-peass-family) ya kipekee
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au [**kikundi cha telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Shiriki mbinu zako za kudukua kwa kuwasilisha PR kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
