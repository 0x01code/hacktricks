# Napadi na WebView

<details>

<summary><strong>Naučite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi načini podrške HackTricks-u:

* Ako želite da vidite **vašu kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvanični PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), našu kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridružite se** 💬 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

## Pojednostavljeni vodič o konfiguracijama i bezbednosti WebView-a

### Pregled ranjivosti WebView-a

Ključni aspekt Android razvoja uključuje pravilno rukovanje WebView-ima. Ovaj vodič ističe ključne konfiguracije i sigurnosne prakse za smanjenje rizika povezanih sa korišćenjem WebView-a.

![WebView Primer](../../.gitbook/assets/image%20(718).png)

### **Pristup fajlovima u WebView-ima**

Podrazumevano, WebView-ima je dozvoljen pristup fajlovima. Ova funkcionalnost se kontroliše putem metode `setAllowFileAccess()`, dostupne od Android API nivoa 3 (Cupcake 1.5). Aplikacije sa dozvolom **android.permission.READ_EXTERNAL_STORAGE** mogu čitati fajlove sa spoljnog skladišta koristeći URL šemu fajla (`file://putanja/do/fajla`).

#### **Zastarele funkcionalnosti: Univerzalni pristup i pristup fajlovima putem URL-ova**

- **Univerzalni pristup putem URL-ova fajlova**: Ova zastarela funkcionalnost je omogućavala zahteve sa različitih izvora putem URL-ova fajlova, što predstavlja značajan sigurnosni rizik zbog potencijalnih XSS napada. Podrazumevana postavka je onemogućena (`false`) za aplikacije koje ciljaju Android Jelly Bean i novije verzije.
- Da biste proverili ovu postavku, koristite `getAllowUniversalAccessFromFileURLs()`.
- Da biste promenili ovu postavku, koristite `setAllowUniversalAccessFromFileURLs(boolean)`.

- **Pristup fajlovima putem URL-ova fajlova**: Ova funkcionalnost, takođe zastarela, kontrolisala je pristup sadržaju sa drugih URL-ova fajlova. Kao i univerzalni pristup, podrazumevana postavka je onemogućena radi poboljšane sigurnosti.
- Koristite `getAllowFileAccessFromFileURLs()` za proveru i `setAllowFileAccessFromFileURLs(boolean)` za postavljanje.

#### **Bezbedno učitavanje fajlova**

Za onemogućavanje pristupa fajl sistemu, ali i dalje omogućavanje pristupa resursima i assetima, koristi se metoda `setAllowFileAccess()`. Sa Android R i novijim verzijama, podrazumevana postavka je `false`.
- Proverite sa `getAllowFileAccess()`.
- Omogućite ili onemogućite sa `setAllowFileAccess(boolean)`.

#### **WebViewAssetLoader**

Klasa **WebViewAssetLoader** je moderni pristup za učitavanje lokalnih fajlova. Koristi http(s) URL-ove za pristupanje lokalnim resursima i assetima, usklađujući se sa politikom istog porekla (Same-Origin policy), čime se olakšava upravljanje CORS-om.

### **Rukovanje JavaScript-om i Intent šemom**

- **JavaScript**: Podrazumevano onemogućen u WebView-ima, može se omogućiti putem `setJavaScriptEnabled()`. Savetuje se oprez prilikom omogućavanja JavaScript-a, jer bez odgovarajućih zaštita može dovesti do sigurnosnih ranjivosti.

- **Intent šema**: WebView-ovi mogu rukovati `intent` šemom, što potencijalno može dovesti do eksploatacije ako se ne upravlja pažljivo. Primer ranjivosti uključuje izloženi WebView parametar "support_url" koji može biti iskorišćen za izvršavanje XSS napada.

![Ranjivi WebView](../../.gitbook/assets/image%20(719).png)

Primer eksploatacije korišćenjem adb-a:
```bash
adb.exe shell am start -n com.tmh.vulnwebview/.SupportWebView –es support_url "https://example.com/xss.html"
```
### JavaScript most

Android pruža mogućnost da **JavaScript** u WebView-u poziva **nativne funkcije Android aplikacije**. Ovo se postiže korišćenjem metode `addJavascriptInterface`, koja integriše JavaScript sa nativnim Android funkcionalnostima, nazvanu _WebView JavaScript most_. Potrebna je opreznost jer ova metoda omogućava svim stranicama unutar WebView-a pristup registrovanom JavaScript interfejs objektu, što može predstavljati sigurnosni rizik ako ove interfejse otkrivaju osetljive informacije.

### Važne razmatranja

- **Potrebna je izuzetna opreznost** za aplikacije koje ciljaju Android verzije ispod 4.2 zbog ranjivosti koja omogućava izvršavanje udaljenog koda putem zlonamernog JavaScript-a, iskorišćavajući refleksiju.

#### Implementacija JavaScript mosta

- **JavaScript interfejsi** mogu da komuniciraju sa nativnim kodom, kao što je prikazano u primerima gde je metoda klase izložena JavaScript-u:
```javascript
@JavascriptInterface
public String getSecret() {
return "SuperSecretPassword";
};
```
- JavaScript Bridge je omogućen dodavanjem interfejsa WebView-u:
```javascript
webView.addJavascriptInterface(new JavascriptBridge(), "javascriptBridge");
webView.reload();
```
- Potencijalno iskorišćavanje putem JavaScript-a, na primer, putem XSS napada, omogućava pozivanje izloženih Java metoda:
```html
<script>alert(javascriptBridge.getSecret());</script>
```
- Da biste smanjili rizike, **ograničite upotrebu JavaScript mosta** na kod koji se isporučuje sa APK-om i sprečite učitavanje JavaScripta sa udaljenih izvora. Za starije uređaje, postavite minimalnu API verziju na 17.

### Refleksija zasnovana na udaljenom izvršavanju koda (RCE)

- Dokumentovana metoda omogućava postizanje RCE-a putem refleksije izvršavanjem određenog payloada. Međutim, `@JavascriptInterface` anotacija sprečava neovlašćeni pristup metodama, ograničavajući površinu napada.

### Udaljeno otklanjanje grešaka

- **Udaljeno otklanjanje grešaka** je moguće pomoću **Chrome Developer Tools**, omogućavajući interakciju i proizvoljno izvršavanje JavaScripta unutar WebView sadržaja.

#### Omogućavanje udaljenog otklanjanja grešaka

- Udaljeno otklanjanje grešaka može se omogućiti za sve WebView-ove unutar aplikacije putem:
```java
if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.KITKAT) {
WebView.setWebContentsDebuggingEnabled(true);
}
```
- Da biste uslovno omogućili debagovanje na osnovu stanja aplikacije koja se može debagovati:
```java
if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.KITKAT) {
if (0 != (getApplicationInfo().flags & ApplicationInfo.FLAG_DEBUGGABLE))
{ WebView.setWebContentsDebuggingEnabled(true); }
}
```
## Izvlačenje proizvoljnih fajlova

- Demonstrira izvlačenje proizvoljnih fajlova koristeći XMLHttpRequest:
```javascript
var xhr = new XMLHttpRequest();
xhr.onreadystatechange = function() {
if (xhr.readyState == XMLHttpRequest.DONE) {
alert(xhr.responseText);
}
}
xhr.open('GET', 'file:///data/data/com.authenticationfailure.wheresmybrowser/databases/super_secret.db', true);
xhr.send(null);
```
## Reference
* [https://labs.integrity.pt/articles/review-android-webviews-fileaccess-attack-vectors/index.html](https://labs.integrity.pt/articles/review-android-webviews-fileaccess-attack-vectors/index.html)
* [https://github.com/authenticationfailure/WheresMyBrowser.Android](https://github.com/authenticationfailure/WheresMyBrowser.Android)
* [https://developer.android.com/reference/android/webkit/WebView](https://developer.android.com/reference/android/webkit/WebView)

<details>

<summary><strong>Naučite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi načini podrške HackTricks-u:

* Ako želite da vidite **vašu kompaniju oglašenu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvanični PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), našu kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridružite se** 💬 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
