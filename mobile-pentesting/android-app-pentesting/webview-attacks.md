# WebView Saldırıları

<details>

<summary><strong>AWS hacklemeyi sıfırdan kahraman olmak için</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Kırmızı Takım Uzmanı)</strong></a><strong>öğrenin!</strong></summary>

HackTricks'i desteklemenin diğer yolları:

* Şirketinizi HackTricks'te **reklamınızı görmek** veya **HackTricks'i PDF olarak indirmek** için [**ABONELİK PLANLARI**](https://github.com/sponsors/carlospolop)'na göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* [**PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keşfedin, özel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın** veya **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)'u **takip edin**.
* Hacking hilelerinizi göndererek HackTricks ve HackTricks Cloud github depolarına PR göndererek **hacking hilelerinizi paylaşın**.

</details>

## WebView Yapılandırmaları ve Güvenlik Hakkında Basitleştirilmiş Kılavuz

### WebView Zafiyetlerinin Genel Bakışı

Android geliştirmenin kritik bir yönü, WebViews'ın doğru bir şekilde işlenmesini içerir. Bu kılavuz, WebView kullanımıyla ilişkili riskleri azaltmak için önemli yapılandırmaları ve güvenlik uygulamalarını vurgular.

![WebView Örneği](../../.gitbook/assets/image%20(718).png)

### **WebViews'da Dosya Erişimi**

Varsayılan olarak, WebViews dosya erişimine izin verir. Bu işlevsellik, Android API seviyesi 3'ten (Cupcake 1.5) beri mevcut olan `setAllowFileAccess()` yöntemi tarafından kontrol edilir. **android.permission.READ_EXTERNAL_STORAGE** iznine sahip uygulamalar, bir dosya URL şeması (`file://path/to/file`) kullanarak harici depolamadan dosyaları okuyabilir.

#### **Kullanımdan Kaldırılan Özellikler: Evrensel ve URL'lerden Dosya Erişimi**

- **URL'lerden Evrensel Erişim**: Bu kullanımdan kaldırılan özellik, dosya URL'lerinden kökenler arası isteklere izin veriyordu ve potansiyel XSS saldırıları nedeniyle önemli bir güvenlik riski oluşturuyordu. Android Jelly Bean ve daha yeni sürümlere hedeflenen uygulamalar için varsayılan ayar devre dışı bırakılmıştır (`false`).
- Bu ayarı kontrol etmek için `getAllowUniversalAccessFromFileURLs()` kullanın.
- Bu ayarı değiştirmek için `setAllowUniversalAccessFromFileURLs(boolean)` kullanın.

- **URL'lerden Dosya Erişimi**: Bu özellik de kullanımdan kaldırılmış olup, diğer dosya şema URL'lerinden içeriğe erişimi kontrol eder. Evrensel erişim gibi, varsayılan ayarı artırılmış güvenlik için devre dışıdır.
- Kontrol etmek için `getAllowFileAccessFromFileURLs()` kullanın ve `setAllowFileAccessFromFileURLs(boolean)` kullanarak ayarlayın.

#### **Güvenli Dosya Yükleme**

Varlıklara ve kaynaklara erişirken dosya sistemine erişimi devre dışı bırakmak için `setAllowFileAccess()` yöntemi kullanılır. Android R ve üstü sürümlerde varsayılan ayar `false` olarak ayarlanmıştır.
- `getAllowFileAccess()` ile kontrol edin.
- `setAllowFileAccess(boolean)` ile etkinleştirin veya devre dışı bırakın.

#### **WebViewAssetLoader**

**WebViewAssetLoader** sınıfı, yerel dosyaları yüklemek için modern bir yaklaşımdır. Aynı Köken politikasıyla uyumlu olması için http(s) URL'lerini kullanır ve bu şekilde CORS yönetimini kolaylaştırır.

### **JavaScript ve Intent Şema İşleme**

- **JavaScript**: WebViews'da varsayılan olarak devre dışıdır, `setJavaScriptEnabled()` aracılığıyla etkinleştirilebilir. JavaScript'i uygun güvenlik önlemleri olmadan etkinleştirmek, güvenlik açıklarına neden olabileceğinden dikkatli olunmalıdır.

- **Intent Şeması**: WebViews, `intent` şemasını işleyebilir ve dikkatli yönetilmezse saldırılara yol açabilir. Bir örnek zafiyet, kötüye kullanılabilecek bir açık WebView parametresi olan "support_url" içeriyordu ve bu parametre üzerinden kök site komut dosyası (XSS) saldırıları gerçekleştirilebilirdi.

![Zafiyetli WebView](../../.gitbook/assets/image%20(719).png)

adb kullanarak kötüye kullanma örneği:
```bash
adb.exe shell am start -n com.tmh.vulnwebview/.SupportWebView –es support_url "https://example.com/xss.html"
```
### Javascript Köprüsü

Android tarafından sağlanan bir özellik, WebView'deki **JavaScript'in** **yerel Android uygulama işlevlerini** çağırmasını sağlar. Bu, JavaScript'i yerel Android işlevleriyle entegre eden `addJavascriptInterface` yöntemi kullanılarak gerçekleştirilir ve _WebView JavaScript köprüsü_ olarak adlandırılır. Bu yöntem, kayıtlı JavaScript Arayüzü nesnesine WebView içindeki tüm sayfaların erişmesine izin verdiği için, hassas bilgilerin bu arayüzler aracılığıyla ifşa edilmesi durumunda güvenlik riski oluşturabilir.

### Önemli Düşünceler

- Android sürümü 4.2'nin altında hedeflenen uygulamalar için **aşırı dikkat** gereklidir, çünkü yansımayı kullanarak kötü niyetli JavaScript aracılığıyla uzaktan kod yürütme izni veren bir zayıflık bulunmaktadır.

#### Bir JavaScript Köprüsü Uygulama

- **JavaScript arayüzleri**, örneklerde gösterildiği gibi yerel kodla etkileşimde bulunabilir, burada bir sınıf yöntemi JavaScript'e açıklanmıştır:
```javascript
@JavascriptInterface
public String getSecret() {
return "SuperSecretPassword";
};
```
- JavaScript Köprüsü, WebView'e bir arayüz ekleyerek etkinleştirilir:
```javascript
webView.addJavascriptInterface(new JavascriptBridge(), "javascriptBridge");
webView.reload();
```
- Potansiyel olarak JavaScript aracılığıyla sömürülebilirlik, örneğin XSS saldırısı yoluyla, açığa çıkarılmış Java yöntemlerinin çağrılmasına olanak sağlar:
```html
<script>alert(javascriptBridge.getSecret());</script>
```
- Riskleri azaltmak için, JavaScript köprüsü kullanımını APK ile birlikte gönderilen kodla sınırlayın ve uzaktan JavaScript yüklemeyi engelleyin. Eski cihazlar için minimum API seviyesini 17 olarak ayarlayın.

### Yansıma Tabanlı Uzaktan Kod Yürütme (RCE)

- Belgeleme yöntemi, belirli bir yük ile yansıma yoluyla RCE elde etmeyi sağlar. Bununla birlikte, `@JavascriptInterface` işaretlemesi yetkisiz yöntem erişimini engeller ve saldırı yüzeyini sınırlar.

### Uzaktan Hata Ayıklama

- **Uzaktan hata ayıklama**, **Chrome Geliştirici Araçları** ile mümkündür ve WebView içeriği içinde etkileşim ve keyfi JavaScript yürütme sağlar.

#### Uzaktan Hata Ayıklamayı Etkinleştirme

- Uzaktan hata ayıklama, bir uygulama içindeki tüm WebView'ler için etkinleştirilebilir:
```java
if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.KITKAT) {
WebView.setWebContentsDebuggingEnabled(true);
}
```
- Uygulamanın hata ayıklanabilir durumuna bağlı olarak hata ayıklamayı koşullu olarak etkinleştirmek için:
```java
if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.KITKAT) {
if (0 != (getApplicationInfo().flags & ApplicationInfo.FLAG_DEBUGGABLE))
{ WebView.setWebContentsDebuggingEnabled(true); }
}
```
## Keyfi Dosyaları Sızdırma

- Bir XMLHttpRequest kullanarak keyfi dosyaların nasıl sızdırılacağını gösterir:
```javascript
var xhr = new XMLHttpRequest();
xhr.onreadystatechange = function() {
if (xhr.readyState == XMLHttpRequest.DONE) {
alert(xhr.responseText);
}
}
xhr.open('GET', 'file:///data/data/com.authenticationfailure.wheresmybrowser/databases/super_secret.db', true);
xhr.send(null);
```
## Referanslar
* [https://labs.integrity.pt/articles/review-android-webviews-fileaccess-attack-vectors/index.html](https://labs.integrity.pt/articles/review-android-webviews-fileaccess-attack-vectors/index.html)
* [https://github.com/authenticationfailure/WheresMyBrowser.Android](https://github.com/authenticationfailure/WheresMyBrowser.Android)
* [https://developer.android.com/reference/android/webkit/WebView](https://developer.android.com/reference/android/webkit/WebView)

<details>

<summary><strong>AWS hackleme konusunda sıfırdan kahramana dönüşmek için</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Kırmızı Takım Uzmanı)</strong></a><strong>'ı öğrenin!</strong></summary>

HackTricks'i desteklemenin diğer yolları:

* Şirketinizi HackTricks'te **reklamınızı görmek** veya HackTricks'i **PDF olarak indirmek** için [**ABONELİK PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* Özel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluşan koleksiyonumuz [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'i keşfedin
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın** veya bizi **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)**'da takip edin.**
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına **PR göndererek** paylaşın.

</details>
