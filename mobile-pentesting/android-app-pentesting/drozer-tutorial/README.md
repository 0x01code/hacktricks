# Drozer Tutorial

<details>

<summary><strong>AWS hacklemeyi sıfırdan kahramana öğrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Kırmızı Takım Uzmanı)</strong></a><strong>!</strong></summary>

HackTricks'i desteklemenin diğer yolları:

* **Şirketinizi HackTricks'te reklamını görmek isterseniz** veya **HackTricks'i PDF olarak indirmek isterseniz** [**ABONELİK PLANLARI**](https://github.com/sponsors/carlospolop)'na göz atın!
* [**Resmi PEASS & HackTricks ürünleri**](https://peass.creator-spring.com)'ni edinin
* [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keşfedin, özel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın** veya **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks\_live)'u **takip edin**.
* **Hacking hilelerinizi paylaşarak** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına **PR göndererek** paylaşın.

</details>

<img src="../../../.gitbook/assets/i3.png" alt="" data-size="original">

**Bir hata avı ipucu**: **Intigriti'ye kaydolun**, hackerlar tarafından oluşturulan bir premium **hata avı platformu**! Bugün [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks)'te bize katılın ve **$100,000**'e kadar ödüller kazanmaya başlayın!

{% embed url="https://go.intigriti.com/hacktricks" %}

## Test için APK'lar

* [Sieve](https://github.com/mwrlabs/drozer/releases/download/2.3.4/sieve.apk) (mrwlabs'tan)
* [DIVA](https://payatu.com/wp-content/uploads/2016/01/diva-beta.tar.gz)

**Bu öğreticinin bazı bölümleri** [**Drozer belgelendirme pdf**](https://labs.withsecure.com/content/dam/labs/docs/mwri-drozer-user-guide-2015-03-23.pdf)**'den alınmıştır.**

## Kurulum

Ana bilgisayarınıza Drozer Client kurun. [En son sürümlerini](https://github.com/mwrlabs/drozer/releases) indirin.

```bash
pip install drozer-2.4.4-py2-none-any.whl
pip install twisted
pip install service_identity
```

Drozer APK'sını [en son sürümlerden](https://github.com/mwrlabs/drozer/releases) indirin ve kurun. Şu anda [bu](https://github.com/mwrlabs/drozer/releases/download/2.3.4/drozer-agent-2.3.4.apk) sürümü mevcuttur.

```bash
adb install drozer.apk
```

### Sunucuyu Başlatma

Ajan, 31415 numaralı portta çalışıyor, Drozer İstemci ve Ajan arasında iletişimi sağlamak için [port yönlendirme](https://tr.wikipedia.org/wiki/Port\_y%C3%B6nlendirme) yapmamız gerekiyor, işte bunu yapmak için kullanılacak komut:

```bash
adb forward tcp:31415 tcp:31415
```

Son olarak, **uygulamayı başlatın** ve "**ON**" düğmesine basın.

![](<../../../.gitbook/assets/image (63).png>)

Ve ona bağlanın:

```bash
drozer console connect
```

## İlginç Komutlar

| **Komutlar**    | **Açıklama**                                                                                                                                                |
| --------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Help MODULE** | Seçilen modülün yardımını gösterir.                                                                                                                         |
| **list**        | Geçerli oturumda çalıştırılabilecek tüm drozer modüllerinin bir listesini gösterir. Bu, çalıştırmak için uygun izinlere sahip olmadığınız modülleri gizler. |
| **shell**       | Cihazda, Ajanın bağlamında etkileşimli bir Linux kabuğu başlatır.                                                                                           |
| **clean**       | Drozer tarafından Android cihazında depolanan geçici dosyaları kaldırır.                                                                                    |
| **load**        | Drozer komutlarını içeren bir dosyayı yükler ve sırayla çalıştırır.                                                                                         |
| **module**      | İnternetten ek drozer modüllerini bulur ve yükler.                                                                                                          |
| **unset**       | Drozer'ın başlattığı herhangi bir Linux kabuğuna geçtiği adlandırılmış bir değişkeni kaldırır.                                                              |
| **set**         | Drozer tarafından başlatılan herhangi bir Linux kabuğuna geçirilecek bir değişkende bir değer saklar.                                                       |
| **shell**       | Cihazda, Ajanın bağlamında etkileşimli bir Linux kabuğu başlatır.                                                                                           |
| **run MODULE**  | Bir drozer modülünü çalıştırır.                                                                                                                             |
| **exploit**     | Drozer, cihazda çalıştırılacak saldırıları oluşturabilir. `drozer exploit list`                                                                             |
| **payload**     | Saldırılar bir yük gerektirir. `drozer payload list`                                                                                                        |

### Paket

Paketin **adını** kısmi adla filtreleyerek bulun:

```bash
dz> run app.package.list -f sieve
com.mwr.example.sieve
```

**Paketin Temel Bilgileri**:

```bash
dz> run app.package.info -a com.mwr.example.sieve
Package: com.mwr.example.sieve
Process Name: com.mwr.example.sieve
Version: 1.0
Data Directory: /data/data/com.mwr.example.sieve
APK Path: /data/app/com.mwr.example.sieve-2.apk
UID: 10056
GID: [1028, 1015, 3003]
Shared Libraries: null
Shared User ID: null
Uses Permissions:
- android.permission.READ_EXTERNAL_STORAGE
- android.permission.WRITE_EXTERNAL_STORAGE
- android.permission.INTERNET
Defines Permissions:
- com.mwr.example.sieve.READ_KEYS
- com.mwr.example.sieve.WRITE_KEYS
```

**Manifest** dosyasını okuyun:

```shell
adb shell pm dump <package_name> | grep -A 1 "Package \[<package_name>\]"
```

Bu komut, belirli bir uygulamanın manifest dosyasını okumak için kullanılır. `<package_name>` yerine hedef uygulamanın paket adını yazmanız gerekmektedir. Bu komutu çalıştırdığınızda, uygulamanın manifest dosyasının içeriği görüntülenecektir. Manifest dosyası, uygulamanın özelliklerini, izinlerini ve bileşenlerini tanımlayan önemli bir dosyadır. Bu dosya, uygulama hakkında değerli bilgiler sağlayabilir ve güvenlik açıklarını tespit etmek için kullanılabilir.

```bash
run app.package.manifest jakhar.aseem.diva
```

**Paketin saldırı yüzeyi**:

```bash
dz> run app.package.attacksurface com.mwr.example.sieve
Attack Surface:
3 activities exported
0 broadcast receivers exported
2 content providers exported
2 services exported
is debuggable
```

* **Aktiviteler**: Belki bir aktivite başlatabilir ve başlatmayı engellemesi gereken bir tür yetkilendirme işlemini atlayabilirsiniz.
* **İçerik sağlayıcıları**: Belki de özel verilere erişebilir veya bazı zafiyetleri (SQL Injection veya Yol Geçişi) sömürebilirsiniz.
* **Servisler**:
* **hata ayıklanabilir mi**: [Daha fazla bilgi edinin](./#is-debuggeable)

### Aktiviteler

Bir dışa aktarılan aktivite bileşeninin "android:exported" değeri AndroidManifest.xml dosyasında **"true"** olarak ayarlanmıştır:

```markup
<activity android:name="com.my.app.Initial" android:exported="true">
</activity>
```

**İhraç edilen aktiviteleri listele**:

```bash
$ drozer console connect
$ run app.package.list -f <package_name>
$ run app.activity.list -f <package_name>
```

Bu komutlar, drozer konsoluna bağlanarak belirli bir paketin ihraç edilen aktivitelerini listeler. İlk olarak, `app.package.list` komutu kullanılarak hedef paketin adı belirtilir. Ardından, `app.activity.list` komutu kullanılarak paketin ihraç edilen aktiviteleri listelenir.

```bash
dz> run app.activity.info -a com.mwr.example.sieve
Package: com.mwr.example.sieve
com.mwr.example.sieve.FileSelectActivity
com.mwr.example.sieve.MainLoginActivity
com.mwr.example.sieve.PWList
```

**Aktiviteyi başlatma**:

Belki bir aktiviteyi başlatabilir ve başlatmayı engellemesi gereken bir tür yetkilendirmeyi atlayabilirsiniz.

{% code overflow="wrap" %}
```bash
dz> run app.activity.start --component com.mwr.example.sieve com.mwr.example.sieve.PWList
```
{% endcode %}

Ayrıca, **adb** üzerinden bir dışa aktarılmış etkinliği başlatabilirsiniz:

* Paket Adı com.example.demo
* Dışa aktarılmış Etkinlik Adı com.example.test.MainActivity

```bash
adb shell am start -n com.example.demo/com.example.test.MainActivity
```

### İçerik Sağlayıcılar

Bu gönderi burada olacak kadar büyük olduğu için **kendi sayfasında erişebilirsiniz** [**buradan**](exploiting-content-providers.md).

### Servisler

Bir dışa aktarılmış servis Manifest.xml içinde bildirilir:

{% code overflow="wrap" %}
```markup
<service android:name=".AuthService" android:exported="true" android:process=":remote"/>
```
{% endcode %}

Koddaki **check** için \*\*`handleMessage`\*\* fonksiyonunu **alacak** olan **mesajı** **kontrol edin**:

![](<../../../.gitbook/assets/image (194).png>)

#### Hizmet listesi

```bash
dz> run app.service.info -a com.mwr.example.sieve
Package: com.mwr.example.sieve
com.mwr.example.sieve.AuthService
Permission: null
com.mwr.example.sieve.CryptoService
Permission: null
```

#### Bir hizmetle **etkileşim** kurun

To interact with a service, you can use the `run` command in drozer. This command allows you to execute various actions on the target service.

Bir hizmetle etkileşim kurmak için drozer'da `run` komutunu kullanabilirsiniz. Bu komut, hedef hizmet üzerinde çeşitli eylemleri gerçekleştirmenizi sağlar.

The basic syntax for the `run` command is as follows:

`run <module> <action> [options]`

`run` komutunun temel sözdizimi aşağıdaki gibidir:

`run <modül> <eylem> [seçenekler]`

Here, `<module>` refers to the module you want to interact with, `<action>` refers to the action you want to perform, and `[options]` refers to any additional options or parameters required for the action.

Burada, `<modül>` etkileşimde bulunmak istediğiniz modülü, `<eylem>` yapmak istediğiniz eylemi ve `[seçenekler]` ise eylem için gereken herhangi ek seçenekleri veya parametreleri ifade eder.

For example, to interact with the `activity` module and launch an activity, you can use the following command:

Örneğin, `activity` modülüyle etkileşime geçmek ve bir etkinlik başlatmak için aşağıdaki komutu kullanabilirsiniz:

```
run app.activity.start --component <package_name>/<activity_name>
```

Replace `<package_name>` with the package name of the target app and `<activity_name>` with the name of the activity you want to launch.

`<package_name>`'i hedef uygulamanın paket adıyla ve `<activity_name>`'i başlatmak istediğiniz etkinliğin adıyla değiştirin.

You can explore the available modules and actions by using the `list` command:

`list` komutunu kullanarak mevcut modülleri ve eylemleri keşfedebilirsiniz.

```
run app.activity.list
```

This will display a list of activities available in the target app.

Bu, hedef uygulamada mevcut olan etkinliklerin bir listesini görüntüler.

By interacting with different modules and performing various actions, you can gain control over the target service and exploit any vulnerabilities that may exist.

Farklı modüllerle etkileşime geçerek ve çeşitli eylemler gerçekleştirerek, hedef hizmet üzerinde kontrol sağlayabilir ve var olabilecek herhangi bir güvenlik açığını sömürebilirsiniz.

```bash
app.service.send            Send a Message to a service, and display the reply
app.service.start           Start Service
app.service.stop            Stop Service
```

#### Örnek

`app.service.send` için **drozer** yardımına bir göz atın:

![](<../../../.gitbook/assets/image (196) (1).png>)

Dikkat edin, önce "_msg.what_" içindeki verileri, ardından "_msg.arg1_" ve "_msg.arg2_"'yi gönderiyorsunuz, **hangi bilginin kullanıldığını** ve nerede olduğunu kod içinde kontrol etmelisiniz.\
`--extra` seçeneğini kullanarak "\_msg.replyTo" tarafından yorumlanacak bir şey gönderebilir ve `--bundle-as-obj` kullanarak sağlanan ayrıntılarla bir nesne oluşturabilirsiniz.

Aşağıdaki örnekte:

* `what == 2354`
* `arg1 == 9234`
* `arg2 == 1`
* `replyTo == object(string com.mwr.example.sieve.PIN 1337)`

```bash
run app.service.send com.mwr.example.sieve com.mwr.example.sieve.AuthService --msg 2354 9234 1 --extra string com.mwr.example.sieve.PIN 1337 --bundle-as-obj
```

![](<../../../.gitbook/assets/image (195).png>)

### Yayın Alıcıları

**Android temel bilgiler bölümünde bir Yayın Alıcısı'nın ne olduğunu görebilirsiniz**.

Bu Yayın Alıcılarını keşfettikten sonra, **kodlarını kontrol etmelisiniz**. Alınan mesajları işleyecek olan **`onReceive`** fonksiyonuna özellikle dikkat etmelisiniz.

#### **Tüm** yayın alıcılarını tespit etmek

```bash
run app.broadcast.info #Detects all
```

#### Bir uygulamanın yayın alıcılarını kontrol etmek

Drozer, bir Android uygulamasının yayın alıcılarını kontrol etmek için kullanılabilir. Yayın alıcıları, uygulamanın belirli olayları dinlemesine ve yanıtlamasına izin veren bileşenlerdir. Bu, uygulamanın diğer uygulamalarla etkileşimde bulunmasına olanak tanır.

Drozer'ı kullanarak, bir uygulamanın yayın alıcılarını kontrol etmek için aşağıdaki adımları izleyebilirsiniz:

1. Drozer'ı başlatın ve hedef cihaza bağlanın.
2. `run app.package.broadcast` komutunu kullanarak, hedef uygulamanın yayın alıcılarını listeleyin.
3. Yayın alıcılarının listesini inceleyin ve uygulamanın hangi olayları dinlediğini ve nasıl yanıt verdiğini anlayın.

Bu bilgiler, uygulamanın güvenlik açıklarını tespit etmek ve potansiyel saldırı noktalarını belirlemek için kullanılabilir.

```bash
#Check one negative
run app.broadcast.info -a jakhar.aseem.diva
Package: jakhar.aseem.diva
No matching receivers.

# Check one positive
run app.broadcast.info -a com.google.android.youtube
Package: com.google.android.youtube
com.google.android.libraries.youtube.player.PlayerUiModule$LegacyMediaButtonIntentReceiver
Permission: null
com.google.android.apps.youtube.app.common.notification.GcmBroadcastReceiver
Permission: com.google.android.c2dm.permission.SEND
com.google.android.apps.youtube.app.PackageReplacedReceiver
Permission: null
com.google.android.libraries.youtube.account.AccountsChangedReceiver
Permission: null
com.google.android.apps.youtube.app.application.system.LocaleUpdatedReceiver
Permission: null
```

#### Yayın **Etkileşimleri**

Broadcast etkileşimleri, Android uygulamaları arasında veri paylaşımını sağlamak için kullanılan bir mekanizmadır. Bir uygulama, yayın göndererek diğer uygulamaların bu yayını dinlemesini sağlayabilir. Bu, uygulamalar arasında iletişim kurmanın etkili bir yoludur.

Drozer, yayın etkileşimlerini test etmek ve güvenlik açıklarını tespit etmek için kullanılan bir araçtır. Drozer, yayın gönderme ve yayını dinleme yeteneklerine sahiptir. Bu, bir uygulamanın yayınları nasıl işlediğini ve potansiyel güvenlik açıklarını belirlemek için kullanılabilir.

Bu bölümde, Drozer'ın yayın etkileşimlerini test etmek için nasıl kullanılacağını öğreneceksiniz. Bu, Android uygulamalarının yayın mekanizmalarını anlamak ve güvenlik açıklarını tespit etmek için önemli bir adımdır.

```bash
app.broadcast.info          Get information about broadcast receivers
app.broadcast.send          Send broadcast using an intent
app.broadcast.sniff         Register a broadcast receiver that can sniff particular intents
```

#### Bir mesaj gönder

Bu örnekte [FourGoats apk](https://github.com/linkedin/qark/blob/master/tests/goatdroid.apk) İçerik Sağlayıcısını istismar ederek, kullanıcıdan izin istemeden herhangi bir ücretli olmayan hedefe **keyfi bir SMS gönderebilirsiniz**.

![](<../../../.gitbook/assets/image (199).png>)

![](<../../../.gitbook/assets/image (197) (1).png>)

Kodu okursanız, "_phoneNumber_" ve "_message_" parametrelerinin İçerik Sağlayıcıya gönderilmesi gerektiğini göreceksiniz.

```bash
run app.broadcast.send --action org.owasp.goatdroid.fourgoats.SOCIAL_SMS --component org.owasp.goatdroid.fourgoats.broadcastreceivers SendSMSNowReceiver --extra string phoneNumber 123456789 --extra string message "Hello mate!"
```

### Hata ayıklanabilir mi?

Bir üretim APK'sı asla hata ayıklanabilir olmamalıdır.\
Bu, çalışan uygulamaya **Java hata ayıklayıcısını bağlayabileceğiniz**, çalışma zamanında inceleyebileceğiniz, kesme noktaları belirleyebileceğiniz, adım adım ilerleyebileceğiniz, değişken değerlerini toplayabileceğiniz ve hatta değiştirebileceğiniz anlamına gelir. [InfoSec institute'nin mükemmel bir makalesi](https://github.com/carlospolop/hacktricks/blob/tr/mobile-pentesting/android-app-pentesting/exploiting-a-debuggeable-application.md), uygulamanız hata ayıklanabilir olduğunda daha derine inmek ve çalışma zamanı kodu enjekte etmek hakkında bilgi vermektedir.

Bir uygulama hata ayıklanabilir olduğunda, Manifest dosyasında görünecektir:

```xml
<application theme="@2131296387" debuggable="true"
```

**Drozer** ile tüm hata ayıklanabilir uygulamaları bulabilirsiniz:

```bash
run app.package.debuggable
```

## Öğreticiler

* [https://resources.infosecinstitute.com/android-penetration-tools-walkthrough-series-drozer/#gref](https://resources.infosecinstitute.com/android-penetration-tools-walkthrough-series-drozer/#gref)
* [https://github.com/mgcfish/mobiletools/blob/master/\_posts/2016-08-01-Using-Drozer-for-application-security-assessments.md](https://github.com/mgcfish/mobiletools/blob/master/\_posts/2016-08-01-Using-Drozer-for-application-security-assessments.md)
* [https://www.hackingarticles.in/android-penetration-testing-drozer/](https://www.hackingarticles.in/android-penetration-testing-drozer/)
* [https://medium.com/@ashrafrizvi3006/how-to-test-android-application-security-using-drozer-edc002c5dcac](https://medium.com/@ashrafrizvi3006/how-to-test-android-application-security-using-drozer-edc002c5dcac)

## Daha fazla bilgi

* [https://blog.dixitaditya.com/android-pentesting-cheatsheet/](https://blog.dixitaditya.com/android-pentesting-cheatsheet/)

<img src="../../../.gitbook/assets/i3.png" alt="" data-size="original">

**Bug bounty ipucu**: **Intigriti'ye kaydolun**, hackerlar tarafından oluşturulan bir premium **bug bounty platformuna**! Bugün [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) adresine katılın ve **$100,000**'e kadar ödüller kazanmaya başlayın!

{% embed url="https://go.intigriti.com/hacktricks" %}

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sıfırdan kahramana kadar AWS hacklemeyi öğrenin<strong>!</strong></summary>

HackTricks'i desteklemenin diğer yolları:

* **Şirketinizi HackTricks'te reklamınızı görmek veya HackTricks'i PDF olarak indirmek için** [**ABONELİK PLANLARI**](https://github.com/sponsors/carlospolop)'na göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) koleksiyonumuzdaki özel [**NFT'leri**](https://opensea.io/collection/the-peass-family) keşfedin
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın** veya **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks\_live)**'u takip edin**.
* **Hacking hilelerinizi HackTricks ve HackTricks Cloud** github depolarına **PR göndererek paylaşın**.

</details>
