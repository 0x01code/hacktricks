<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks云 ☁️</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>🐦 推特 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 Youtube 🎥</strong></a></summary>

- 你在一家**网络安全公司**工作吗？你想在HackTricks中看到你的**公司广告**吗？或者你想获得**PEASS的最新版本或下载PDF格式的HackTricks**吗？请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！

- 发现我们的独家[**NFTs**](https://opensea.io/collection/the-peass-family)收藏品[**The PEASS Family**](https://opensea.io/collection/the-peass-family)

- 获得[**官方PEASS和HackTricks周边产品**](https://peass.creator-spring.com)

- **加入**[**💬**](https://emojipedia.org/speech-balloon/) [**Discord群组**](https://discord.gg/hRep4RUj7f)或[**电报群组**](https://t.me/peass)，或者**关注**我在**Twitter**上的[**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**。**

- **通过向[hacktricks repo](https://github.com/carlospolop/hacktricks)和[hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)提交PR来分享你的黑客技巧**。

</details>


**Adb通常位于：**
```bash
#Windows
C:\Users\<username>\AppData\Local\Android\sdk\platform-tools\adb.exe

#MacOS
/Users/<username>/Library/Android/sdk/platform-tools/adb
```
**从以下网址获取的信息：** [**http://adbshell.com/**](http://adbshell.com)

# 连接

## USB Connection

### Connect to a device via USB

Connect your device to the computer using a USB cable.

```bash
adb devices
```

### Connect to a device via TCP/IP

Connect your device to the same network as your computer.

```bash
adb tcpip <port>
```

### Connect to a device via Wi-Fi

Connect your device to the same Wi-Fi network as your computer.

```bash
adb connect <device-ip>
```

## Wireless Connection

### Enable wireless debugging

Enable wireless debugging on your device.

```bash
adb tcpip <port>
```

### Connect to a device via Wi-Fi

Connect your computer to the same Wi-Fi network as your device.

```bash
adb connect <device-ip>
```

## Disconnect

### Disconnect from a device

Disconnect from the device.

```bash
adb disconnect
```

### Disconnect from all devices

Disconnect from all devices.

```bash
adb disconnect <device-ip>
```
```
adb devices
```
这将列出已连接的设备；如果出现"_**未授权**_"，这意味着您需要**解锁**您的**手机**并**接受**连接。

这指示设备在端口5555上启动adb服务器：
```
adb tcpip 5555
```
连接到该IP和端口：
```
adb connect <IP>:<PORT>
```
如果在虚拟 Android 软件（如 Genymotion）中遇到以下错误：
```
adb server version (41) doesn't match this client (36); killing...
```
这是因为您正在尝试连接到不同版本的ADB服务器。只需尝试找到软件正在使用的adb二进制文件（转到`C:\Program Files\Genymobile\Genymotion`并搜索adb.exe）

## 多个设备

每当您发现**多个设备连接到您的计算机**时，您需要**指定要在哪个设备上**运行adb命令。
```bash
adb devices
List of devices attached
10.10.10.247:42135	offline
127.0.0.1:5555	device
```

```bash
adb -s 127.0.0.1:5555 shell
x86_64:/ # whoami
root
```
## 端口隧道

如果在安卓设备上，**adb** **端口**只能从**本地主机**访问，但是**你可以通过SSH访问**，你可以**转发端口5555**并通过adb连接：
```bash
ssh -i ssh_key username@10.10.10.10 -L 5555:127.0.0.1:5555 -p 2222
adb connect 127.0.0.1:5555
```
# 包管理器

## 安装/卸载

### adb install \[选项] \<路径>
```
adb install test.apk
```

```
adb install -l test.apk forward lock application
```

```
adb install -r test.apk replace existing application
```

```
adb install -t test.apk allow test packages
```

```
adb install -s test.apk install application on sdcard
```

```
adb install -d test.apk allow version code downgrade
```

```
adb install -p test.apk partial application install
```
### adb uninstall \[选项] \<包名>

该命令用于卸载指定的 Android 应用程序。

#### 选项

- `-k`：保留应用程序的数据和缓存目录。

#### 示例

```plaintext
adb uninstall com.example.app
```

该命令将卸载名为 `com.example.app` 的应用程序。
```
adb uninstall com.test.app
```

```
adb uninstall -k com.test.app Keep the data and cache directories around after package removal.
```
## 包

打印所有包，可选择只打印包名中包含\<FILTER>文本的包。

### adb shell pm list packages \[选项] \<FILTER-STR>
```
adb shell pm list packages <FILTER-STR>
```

```
adb shell pm list packages -f <FILTER-STR> #See their associated file.
```

```
adb shell pm list packages -d <FILTER-STR> #Filter to only show disabled packages.
```

```
adb shell pm list packages -e <FILTER-STR> #Filter to only show enabled packages.
```

```
adb shell pm list packages -s <FILTER-STR> #Filter to only show system packages.
```

```
adb shell pm list packages -3 <FILTER-STR> #Filter to only show third party packages.
```

```
adb shell pm list packages -i <FILTER-STR> #See the installer for the packages.
```

```
adb shell pm list packages -u <FILTER-STR> #Also include uninstalled packages.
```

```
adb shell pm list packages --user <USER_ID> <FILTER-STR> #The user space to query.
```
### adb shell pm path \<PACKAGE>

打印给定应用程序的APK路径。
```
adb shell pm path com.android.phone
```
### adb shell pm clear \<PACKAGE>

删除与一个应用程序相关的所有数据。
```
adb shell pm clear com.test.abc
```
# 文件管理器

### adb pull \<remote> \[local]

从模拟器/设备下载指定的文件到您的计算机。
```
adb pull /sdcard/demo.mp4 ./
```
### adb push \<本地路径> \<远程路径>

将指定的文件从您的计算机上传到模拟器/设备。
```
adb push test.apk /sdcard
```
# 屏幕截图/录屏

### adb shell screencap \<文件名>

对设备显示屏进行截图。
```
adb shell screencap /sdcard/screen.png
```
### adb shell screenrecord \[选项] \<文件名>

记录运行Android 4.4（API级别19）及更高版本的设备的显示屏。
```
adb shell screenrecord /sdcard/demo.mp4
adb shell screenrecord --size <WIDTHxHEIGHT>
adb shell screenrecord --bit-rate <RATE>
adb shell screenrecord --time-limit <TIME> #Sets the maximum recording time, in seconds. The default and maximum value is 180 (3 minutes).
adb shell screenrecord --rotate # Rotates 90 degrees
adb shell screenrecord --verbose
```
(press Ctrl-C to stop recording)

**您可以使用**_**adb pull**_**命令下载文件（图片和视频）**

# Shell

### adb shell

在设备内获取一个shell
```
adb shell
```
### adb shell \<CMD>

在设备内执行命令
```
adb shell ls
```
## pm

以下命令在shell中执行。
```bash
pm list packages #List installed packages
pm path <package name> #Get the path to the apk file of tha package
am start [<options>] #Start an activity. Whiout options you can see the help menu
am startservice [<options>] #Start a service. Whiout options you can see the help menu
am broadcast [<options>] #Send a broadcast. Whiout options you can see the help menu
input [text|keyevent] #Send keystrokes to device
```
# 进程

如果你想获取你的应用程序的进程PID，你可以执行以下命令：
```
adb shell ps
```
并搜索您的应用程序

或者您可以执行
```
adb shell pidof com.your.application
```
并且它将打印应用程序的PID

# 系统
```
adb root
```
重新启动具有root权限的adbd守护程序。然后，您必须重新连接到ADB服务器，这样您就可以成为root用户（如果可用）。
```
adb sideload <update.zip>
```
刷写/恢复 Android update.zip 包。

# 日志

## Logcat

要**过滤只有一个应用程序的消息**，获取应用程序的 PID，并使用 grep（linux/macos）或 findstr（windows）来过滤 logcat 的输出：
```
adb logcat | grep 4526
adb logcat | findstr 4526
```
### adb logcat \[选项] \[过滤规则]

`adb logcat` 命令用于查看 Android 设备上的系统日志。通过使用不同的选项和过滤规则，可以筛选和显示特定类型的日志信息。

#### 选项

- `-v <format>`: 指定日志的输出格式。可用的格式包括 `brief`（简洁）、`process`（进程）、`tag`（标签）、`thread`（线程）、`raw`（原始）等。
- `-d`: 仅显示当前日志缓冲区中的日志，并退出。
- `-f <filename>`: 将日志输出到指定的文件中。
- `-r <kbytes>`: 设置日志缓冲区的最大大小（以 KB 为单位）。
- `-n <count>`: 设置日志缓冲区的最大旋转次数。
- `-c`: 清除日志缓冲区中的所有日志。
- `-s <filter-spec>`: 仅显示与指定过滤规则匹配的日志。
- `-e <regex>`: 仅显示与指定正则表达式匹配的日志。
- `-m <count>`: 仅显示最近的指定数量的日志条目。

#### 过滤规则

过滤规则用于筛选显示特定类型的日志信息。可以使用以下过滤规则：

- `*:V`: 显示所有日志信息（verbose 级别及以上）。
- `*:D`: 显示调试信息及以上级别的日志。
- `*:I`: 显示信息级别及以上的日志。
- `*:W`: 显示警告级别及以上的日志。
- `*:E`: 显示错误级别及以上的日志。
- `*:F`: 显示致命错误级别及以上的日志。
- `*:S`: 仅显示静默（silent）级别的日志。

可以使用标签名或进程 ID 来指定特定的过滤规则。例如，`adb logcat -s MyApp` 将仅显示与标签为 "MyApp" 相关的日志信息。

更多详细信息，请参考 [adb logcat 文档](https://developer.android.com/studio/command-line/logcat)。
```
adb logcat
```
注意：按Ctrl-C停止监视器
```
adb logcat *:V lowest priority, filter to only show Verbose level
```

```
adb logcat *:D filter to only show Debug level
```

```
adb logcat *:I filter to only show Info level
```

```
adb logcat *:W filter to only show Warning level
```

```
adb logcat *:E filter to only show Error level
```

```
adb logcat *:F filter to only show Fatal level
```

```
adb logcat *:S Silent, highest priority, on which nothing is ever printed
```
### adb logcat -b \<缓冲区>

该命令用于查看指定缓冲区的日志。缓冲区可以是以下之一：

- main：主要缓冲区，包含应用程序的日志消息。
- system：系统缓冲区，包含系统级别的日志消息。
- events：事件缓冲区，包含系统事件的日志消息。
- radio：无线电缓冲区，包含与无线电通信相关的日志消息。

使用示例：

```bash
adb logcat -b main
adb logcat -b system
adb logcat -b events
adb logcat -b radio
```

请注意，需要具有足够的权限才能查看某些缓冲区的日志。
```
adb logcat -b radio View the buffer that contains radio/telephony related messages.
```

```
adb logcat -b event View the buffer containing events-related messages.
```

```
adb logcat -b main default
```

```
adb logcat -c Clears the entire log and exits.
```

```
adb logcat -d Dumps the log to the screen and exits.
```

```
adb logcat -f test.logs Writes log message output to test.logs .
```

```
adb logcat -g Prints the size of the specified log buffer and exits.
```

```
adb logcat -n <count> Sets the maximum number of rotated logs to <count>.
```
## dumpsys

转储系统数据

### adb shell dumpsys \[选项]
```
adb shell dumpsys
```
```
# adb shell dumpsys meminfo

使用此命令可以获取Android设备上运行的应用程序的内存信息。

## 语法

```
adb shell dumpsys meminfo [options] [package_name]
```

- `options`：可选参数，用于指定要获取的内存信息的详细程度。
- `package_name`：可选参数，用于指定要获取内存信息的应用程序包名。

## 示例

以下是一些常见的示例：

- 获取所有应用程序的内存信息：

```
adb shell dumpsys meminfo
```

- 获取特定应用程序的内存信息：

```
adb shell dumpsys meminfo com.example.app
```

## 输出解读

该命令的输出包含了应用程序的内存使用情况，包括总内存使用量、堆内存使用量、Native内存使用量等。可以根据需要选择不同的选项来获取更详细的内存信息。

```

使用`adb shell dumpsys meminfo`命令可以获取Android设备上运行的应用程序的内存信息。
```
adb shell dumpsys battery
```
注意事项：一台已启用开发者选项的移动设备，运行Android 5.0或更高版本。
```
adb shell dumpsys batterystats collects battery data from your device
```
注意：[Battery Historian](https://github.com/google/battery-historian) 将这些数据转换为 HTML 可视化。**步骤 1** _adb shell dumpsys batterystats > batterystats.txt_ **步骤 2** _python historian.py batterystats.txt > batterystats.html_
```
adb shell dumpsys batterystats --reset erases old collection data
```
adb shell dumpsys activity

# 备份

从adb备份安卓设备。
```bash
adb backup [-apk] [-shared] [-system] [-all] -f file.backup
# -apk -- Include APK from Third partie's applications
# -shared -- Include removable storage
# -system -- Include system Applciations
# -all -- Include all the applications

adb shell pm list packages -f -3      #List packages
adb backup -f myapp_backup.ab -apk com.myapp # backup on one device
adb restore myapp_backup.ab                  # restore to the same or any other device
```
如果你想检查备份的内容：
```bash
( printf "\x1f\x8b\x08\x00\x00\x00\x00\x00" ; tail -c +25 myapp_backup.ab ) |  tar xfvz -
```
<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks 云 ☁️</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>🐦 推特 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 Youtube 🎥</strong></a></summary>

- 你在一家**网络安全公司**工作吗？想要在 HackTricks 中**宣传你的公司**吗？或者你想要**获取最新版本的 PEASS 或下载 HackTricks 的 PDF**吗？请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！

- 发现我们的独家[**NFTs**](https://opensea.io/collection/the-peass-family)收藏品——[**The PEASS Family**](https://opensea.io/collection/the-peass-family)

- 获取[**官方 PEASS & HackTricks 商品**](https://peass.creator-spring.com)

- **加入** [**💬**](https://emojipedia.org/speech-balloon/) [**Discord 群组**](https://discord.gg/hRep4RUj7f) 或 [**Telegram 群组**](https://t.me/peass)，或者**关注**我在**推特**上的[**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**

- **通过向 [hacktricks 仓库](https://github.com/carlospolop/hacktricks) 和 [hacktricks-cloud 仓库](https://github.com/carlospolop/hacktricks-cloud) 提交 PR 来分享你的黑客技巧**。

</details>
