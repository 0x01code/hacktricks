```markdown
<details>

<summary><strong>Aprenda hacking no AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ quer ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**material oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **Junte-se ao grupo** üí¨ [**Discord**](https://discord.gg/hRep4RUj7f) ou ao grupo [**telegram**](https://t.me/peass) ou **siga**-me no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) no github.

</details>


O [`UIPasteboard`](https://developer.apple.com/documentation/uikit/uipasteboard) possibilita o compartilhamento de dados dentro de um aplicativo e de um aplicativo para outros aplicativos. Existem dois tipos de pasteboards:

* **pasteboard geral do sistema**: para compartilhar dados com **qualquer aplicativo**. Persistente por padr√£o ap√≥s reinicializa√ß√µes do dispositivo e desinstala√ß√µes de aplicativos (desde o iOS 10).
* **pasteboards personalizados / nomeados**: para compartilhar dados **com outro aplicativo** (que tenha o mesmo ID de equipe do aplicativo de origem) ou com o **pr√≥prio aplicativo** (eles est√£o dispon√≠veis apenas no processo que os cria). N√£o persistentes por padr√£o (desde o iOS 10), ou seja, existem apenas at√© que o aplicativo propriet√°rio (criador) seja fechado.

Algumas considera√ß√µes de seguran√ßa:

* Usu√°rios **n√£o podem conceder ou negar permiss√£o** para aplicativos lerem o **pasteboard**.
* Desde o iOS 9, aplicativos [n√£o podem acessar o pasteboard enquanto est√£o em segundo plano](https://forums.developer.apple.com/thread/13760), isso mitiga o monitoramento do pasteboard em segundo plano.
* [A Apple alerta sobre pasteboards nomeados persistentes](https://developer.apple.com/documentation/uikit/uipasteboard?language=objc) e **desencoraja seu uso**. Em vez disso, cont√™ineres compartilhados devem ser usados.
* A partir do iOS 10, h√° um novo recurso de Handoff chamado **Universal Clipboard** que √© ativado por padr√£o. Ele permite que o **conte√∫do do pasteboard geral seja automaticamente transferido entre dispositivos**. Este recurso pode ser desativado se o desenvolvedor assim escolher e tamb√©m √© poss√≠vel definir um tempo e data de expira√ß√£o para os dados copiados.

Portanto, √© importante **verificar se informa√ß√µes sens√≠veis n√£o est√£o sendo salvas dentro do pasteboard global**.\
Tamb√©m √© importante verificar se um **aplicativo n√£o est√° usando os dados do pasteboard global para realizar a√ß√µes**, pois um aplicativo malicioso poderia adulterar esses dados.

Um **aplicativo tamb√©m pode impedir que seus usu√°rios copiem dados sens√≠veis para a √°rea de transfer√™ncia** (o que √© recomendado).

## An√°lise Est√°tica

O **pasteboard geral do sistema** pode ser obtido usando [`generalPasteboard`](https://developer.apple.com/documentation/uikit/uipasteboard/1622106-generalpasteboard?language=objc), procure no c√≥digo-fonte ou no bin√°rio compilado por este m√©todo. O uso do pasteboard geral do sistema deve ser evitado ao lidar com dados sens√≠veis.

**Pasteboards personalizados** podem ser criados com [`pasteboardWithName:create:`](https://developer.apple.com/documentation/uikit/uipasteboard/1622074-pasteboardwithname?language=objc) ou [`pasteboardWithUniqueName`](https://developer.apple.com/documentation/uikit/uipasteboard/1622087-pasteboardwithuniquename?language=objc). Verifique se os pasteboards personalizados est√£o configurados para serem persistentes, pois isso est√° obsoleto desde o iOS 10. Em vez disso, um cont√™iner compartilhado deve ser usado.

## An√°lise Din√¢mica

Fa√ßa hook ou trace nos seguintes itens:

* `generalPasteboard` para o pasteboard geral do sistema.
* `pasteboardWithName:create:` e `pasteboardWithUniqueName` para pasteboards personalizados.

Voc√™ tamb√©m pode fazer hook ou trace no m√©todo obsoleto [`setPersistent:`](https://developer.apple.com/documentation/uikit/uipasteboard/1622096-setpersistent?language=objc) e verificar se ele est√° sendo chamado.

Ao **monitorar** os **pasteboards**, h√° v√°rios **detalhes** que podem ser **recuperados** dinamicamente:

* Obtenha o **nome do pasteboard** fazendo hook em `pasteboardWithName:create:` e inspecionando seus par√¢metros de entrada ou `pasteboardWithUniqueName` e inspecionando seu valor de retorno.
* Pegue o **primeiro item dispon√≠vel no pasteboard**: por exemplo, para strings use o m√©todo `string`. Ou use qualquer um dos outros m√©todos para os [tipos de dados padr√£o](https://developer.apple.com/documentation/uikit/uipasteboard?language=objc#1654275).
* Obtenha o **n√∫mero de itens** com `numberOfItems`.
* Verifique a **exist√™ncia de tipos de dados padr√£o** com os [m√©todos de conveni√™ncia](https://developer.apple.com/documentation/uikit/uipasteboard?language=objc#2107142), por exemplo, `hasImages`, `hasStrings`, `hasURLs` (a partir do iOS 10).
* Verifique **outros tipos de dados** (tipicamente UTIs) com [`containsPasteboardTypes:inItemSet:`](https://developer.apple.com/documentation/uikit/uipasteboard/1622100-containspasteboardtypes?language=objc). Voc√™ pode inspecionar tipos de dados mais concretos, como uma imagem como public.png e public.tiff ([UTIs](http://web.archive.org/web/20190616231857/https://developer.apple.com/documentation/mobilecoreservices/uttype)) ou para dados personalizados como com.mycompany.myapp.mytype. Lembre-se de que, neste caso, apenas os aplicativos que _declaram conhecimento_ do tipo s√£o capazes de entender os dados escritos no pasteboard. Recupere-os usando [`itemSetWithPasteboardTypes:`](https://developer.apple.com/documentation/uikit/uipasteboard/1622071-itemsetwithpasteboardtypes?language=objc) e definindo os UTIs correspondentes.
* Verifique itens exclu√≠dos ou com expira√ß√£o fazendo hook em `setItems:options:` e inspecionando suas op√ß√µes para `UIPasteboardOptionLocalOnly` ou `UIPasteboardOptionExpirationDate`.

Se estiver procurando apenas por strings, voc√™ pode querer usar o comando do **objection** `ios pasteboard monitor`:

> Faz hook na classe UIPasteboard do iOS e verifica o generalPasteboard a cada 5 segundos em busca de dados. Se novos dados forem encontrados, diferentes da verifica√ß√£o anterior, esses dados ser√£o exibidos na tela.

Voc√™ tamb√©m pode construir seu pr√≥prio monitor de pasteboard que monitora informa√ß√µes espec√≠ficas como visto acima.

Por exemplo, este script (inspirado no script por tr√°s do [monitor de pasteboard do objection](https://github.com/sensepost/objection/blob/b39ee53b5ba2e9a271797d2f3931d79c46dccfdb/agent/src/ios/pasteboard.ts)) l√™ os itens do pasteboard a cada 5 segundos, se houver algo novo, ele imprimir√°:
```
```javascript
const UIPasteboard = ObjC.classes.UIPasteboard;
const Pasteboard = UIPasteboard.generalPasteboard();
var items = "";
var count = Pasteboard.changeCount().toString();

setInterval(function () {
const currentCount = Pasteboard.changeCount().toString();
const currentItems = Pasteboard.items().toString();

if (currentCount === count) { return; }

items = currentItems;
count = currentCount;

console.log('[* Pasteboard changed] count: ' + count +
' hasStrings: ' + Pasteboard.hasStrings().toString() +
' hasURLs: ' + Pasteboard.hasURLs().toString() +
' hasImages: ' + Pasteboard.hasImages().toString());
console.log(items);

}, 1000 * 5);
```
# Refer√™ncias

{% embed url="https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06h-testing-platform-interaction#testing-object-persistence-mstg-platform-8" %}



<details>

<summary><strong>Aprenda hacking no AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ quer ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**material oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **Junte-se ao grupo** üí¨ [**Discord**](https://discord.gg/hRep4RUj7f) ou ao grupo [**telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios do GitHub** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
