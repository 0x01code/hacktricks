<details>

<summary><strong>Apprenez le hacking AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**merchandising officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm).
* **Partagez vos astuces de hacking en soumettant des PR aux d√©p√¥ts github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>


Le [`UIPasteboard`](https://developer.apple.com/documentation/uikit/uipasteboard) permet de partager des donn√©es au sein d'une application, et d'une application √† d'autres applications. Il existe deux types de presse-papiers :

* **presse-papier g√©n√©ral syst√®me** : pour partager des donn√©es avec **n'importe quelle application**. Persistant par d√©faut apr√®s les red√©marrages de l'appareil et les d√©sinstallations d'applications (depuis iOS 10).
* **presse-papiers personnalis√©s / nomm√©s** : pour partager des donn√©es **avec une autre application** (ayant le m√™me ID d'√©quipe que l'application d'origine) ou avec **l'application elle-m√™me** (ils ne sont disponibles que dans le processus qui les cr√©e). Non persistants par d√©faut (depuis iOS 10), c'est-√†-dire qu'ils n'existent que tant que l'application propri√©taire (cr√©atrice) est en cours d'ex√©cution.

Quelques consid√©rations de s√©curit√© :

* Les utilisateurs **ne peuvent pas accorder ou refuser la permission** aux applications de lire le **presse-papier**.
* Depuis iOS 9, les applications [ne peuvent pas acc√©der au presse-papier en arri√®re-plan](https://forums.developer.apple.com/thread/13760), cela att√©nue la surveillance du presse-papier en arri√®re-plan.
* [Apple met en garde contre les presse-papiers nomm√©s persistants](https://developer.apple.com/documentation/uikit/uipasteboard?language=objc) et **d√©conseille leur utilisation**. √Ä la place, des conteneurs partag√©s devraient √™tre utilis√©s.
* √Ä partir d'iOS 10, il y a une nouvelle fonctionnalit√© Handoff appel√©e **Presse-papier Universel** qui est activ√©e par d√©faut. Elle permet au **contenu du presse-papier g√©n√©ral de se transf√©rer automatiquement entre les appareils**. Cette fonctionnalit√© peut √™tre d√©sactiv√©e si le d√©veloppeur le souhaite et il est √©galement possible de d√©finir une date et une heure d'expiration pour les donn√©es copi√©es.

Il est donc important de **v√©rifier que les informations sensibles ne sont pas enregistr√©es dans le presse-papier global**.\
Il est √©galement important de v√©rifier qu'une **application n'utilise pas les donn√©es du presse-papier global pour effectuer des actions**, car une application malveillante pourrait alt√©rer ces donn√©es.

Une **application peut √©galement emp√™cher ses utilisateurs de copier des donn√©es sensibles dans le presse-papier** (ce qui est recommand√©).

## Analyse statique

Le **presse-papier g√©n√©ral syst√®me** peut √™tre obtenu en utilisant [`generalPasteboard`](https://developer.apple.com/documentation/uikit/uipasteboard/1622106-generalpasteboard?language=objc), recherchez cette m√©thode dans le code source ou le binaire compil√©. L'utilisation du presse-papier g√©n√©ral syst√®me devrait √™tre √©vit√©e lorsqu'il s'agit de donn√©es sensibles.

**Les presse-papiers personnalis√©s** peuvent √™tre cr√©√©s avec [`pasteboardWithName:create:`](https://developer.apple.com/documentation/uikit/uipasteboard/1622074-pasteboardwithname?language=objc) ou [`pasteboardWithUniqueName`](https://developer.apple.com/documentation/uikit/uipasteboard/1622087-pasteboardwithuniquename?language=objc). V√©rifiez si les presse-papiers personnalis√©s sont d√©finis pour √™tre persistants car cela est d√©pr√©ci√© depuis iOS 10. Un conteneur partag√© devrait √™tre utilis√© √† la place.

## Analyse dynamique

Accrochez ou tracez les √©l√©ments suivants :

* `generalPasteboard` pour le presse-papier g√©n√©ral syst√®me.
* `pasteboardWithName:create:` et `pasteboardWithUniqueName` pour les presse-papiers personnalis√©s.

Vous pouvez √©galement accrocher ou tracer la m√©thode d√©pr√©ci√©e [`setPersistent:`](https://developer.apple.com/documentation/uikit/uipasteboard/1622096-setpersistent?language=objc) et v√©rifier si elle est appel√©e.

Lors de la **surveillance** des **presse-papiers**, plusieurs **d√©tails** peuvent √™tre **r√©cup√©r√©s** de mani√®re dynamique :

* Obtenez le **nom du presse-papier** en accrochant `pasteboardWithName:create:` et en inspectant ses param√®tres d'entr√©e ou `pasteboardWithUniqueName` et en inspectant sa valeur de retour.
* Obtenez le **premier √©l√©ment disponible dans le presse-papier** : par exemple, pour les cha√Ænes de caract√®res, utilisez la m√©thode `string`. Ou utilisez n'importe quelle autre m√©thode pour les [types de donn√©es standards](https://developer.apple.com/documentation/uikit/uipasteboard?language=objc#1654275).
* Obtenez le **nombre d'√©l√©ments** avec `numberOfItems`.
* V√©rifiez l'**existence de types de donn√©es standards** avec les [m√©thodes de commodit√©](https://developer.apple.com/documentation/uikit/uipasteboard?language=objc#2107142), par exemple `hasImages`, `hasStrings`, `hasURLs` (√† partir d'iOS 10).
* V√©rifiez les **autres types de donn√©es** (typiquement des UTIs) avec [`containsPasteboardTypes:inItemSet:`](https://developer.apple.com/documentation/uikit/uipasteboard/1622100-containspasteboardtypes?language=objc). Vous pouvez inspecter des types de donn√©es plus concrets comme, par exemple, une image en tant que public.png et public.tiff ([UTIs](http://web.archive.org/web/20190616231857/https://developer.apple.com/documentation/mobilecoreservices/uttype)) ou pour des donn√©es personnalis√©es telles que com.mycompany.myapp.mytype. Rappelez-vous que, dans ce cas, seules les applications qui _d√©clarent conna√Ætre_ le type sont capables de comprendre les donn√©es √©crites dans le presse-papier. R√©cup√©rez-les en utilisant [`itemSetWithPasteboardTypes:`](https://developer.apple.com/documentation/uikit/uipasteboard/1622071-itemsetwithpasteboardtypes?language=objc) et en d√©finissant les UTIs correspondants.
* V√©rifiez les √©l√©ments exclus ou expirants en accrochant `setItems:options:` et en inspectant ses options pour `UIPasteboardOptionLocalOnly` ou `UIPasteboardOptionExpirationDate`.

Si vous ne cherchez que des cha√Ænes de caract√®res, vous pouvez utiliser la commande **objection** `ios pasteboard monitor` :

> Accroche la classe UIPasteboard d'iOS et sonde le generalPasteboard toutes les 5 secondes pour des donn√©es. Si de nouvelles donn√©es sont trouv√©es, diff√©rentes des donn√©es pr√©c√©dentes, ces donn√©es seront affich√©es √† l'√©cran.

Vous pouvez √©galement construire votre propre moniteur de presse-papier qui surveille des informations sp√©cifiques comme vu ci-dessus.

Par exemple, ce script (inspir√© du script derri√®re le moniteur de presse-papier d'[objection](https://github.com/sensepost/objection/blob/b39ee53b5ba2e9a271797d2f3931d79c46dccfdb/agent/src/ios/pasteboard.ts)) lit les √©l√©ments du presse-papier toutes les 5 secondes, s'il y a quelque chose de nouveau, il l'imprimera :
```javascript
const UIPasteboard = ObjC.classes.UIPasteboard;
const Pasteboard = UIPasteboard.generalPasteboard();
var items = "";
var count = Pasteboard.changeCount().toString();

setInterval(function () {
const currentCount = Pasteboard.changeCount().toString();
const currentItems = Pasteboard.items().toString();

if (currentCount === count) { return; }

items = currentItems;
count = currentCount;

console.log('[* Pasteboard changed] count: ' + count +
' hasStrings: ' + Pasteboard.hasStrings().toString() +
' hasURLs: ' + Pasteboard.hasURLs().toString() +
' hasImages: ' + Pasteboard.hasImages().toString());
console.log(items);

}, 1000 * 5);
```
# R√©f√©rences

{% embed url="https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06h-testing-platform-interaction#testing-object-persistence-mstg-platform-8" %}



<details>

<summary><strong>Apprenez le hacking AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**merchandising officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez**-moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de hacking en soumettant des PR aux d√©p√¥ts github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
