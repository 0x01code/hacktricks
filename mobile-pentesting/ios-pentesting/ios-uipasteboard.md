<details>

<summary><strong>Aprende hacking en AWS desde cero hasta experto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** Consulta los [**PLANES DE SUSCRIPCI칍N**](https://github.com/sponsors/carlospolop)!
* Obt칠n [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci칩n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s칤guenos** en **Twitter** 游냕 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Comparte tus trucos de hacking enviando PRs a los** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repositorios de github.

</details>

<figure><img src="/.gitbook/assets/WebSec_1500x400_10fps_21sn_lightoptimized_v2.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}


El intercambio de datos dentro y entre aplicaciones en dispositivos iOS se facilita mediante el mecanismo [`UIPasteboard`](https://developer.apple.com/documentation/uikit/uipasteboard), que se divide en dos categor칤as principales:

- **Portapapeles general en todo el sistema**: Se utiliza para compartir datos con **cualquier aplicaci칩n** y est치 dise침ado para persistir datos a trav칠s de reinicios de dispositivo y desinstalaciones de aplicaciones, una caracter칤stica disponible desde iOS 10.
- **Portapapeles personalizado / con nombre**: Estos son espec칤ficamente para compartir datos **dentro de una aplicaci칩n o con otra aplicaci칩n** que comparte el mismo ID de equipo, y no est치n dise침ados para persistir m치s all치 de la vida del proceso de la aplicaci칩n que los crea, siguiendo los cambios introducidos en iOS 10.

Las **consideraciones de seguridad** juegan un papel importante al utilizar los portapapeles. Por ejemplo:
- No hay un mecanismo para que los usuarios gestionen los permisos de la aplicaci칩n para acceder al **portapapeles**.
- Para mitigar el riesgo de monitoreo no autorizado en segundo plano del portapapeles, el acceso est치 restringido cuando la aplicaci칩n est치 en primer plano (desde iOS 9).
- Se desaconseja el uso de portapapeles con nombre persistentes a favor de contenedores compartidos debido a preocupaciones de privacidad.
- La funci칩n de **Portapapeles Universal** introducida con iOS 10, que permite compartir contenido entre dispositivos a trav칠s del portapapeles general, puede ser gestionada por los desarrolladores para establecer la caducidad de los datos y deshabilitar la transferencia autom치tica de contenido.

Es crucial asegurarse de que la **informaci칩n sensible no se almacene inadvertidamente** en el portapapeles general. Adem치s, las aplicaciones deben estar dise침adas para evitar el uso indebido de los datos del portapapeles general para acciones no deseadas, y se alienta a los desarrolladores a implementar medidas para evitar la copia de informaci칩n sensible en el portapapeles.

### An치lisis Est치tico

Para el an치lisis est치tico, busca en el c칩digo fuente o binario:
- `generalPasteboard` para identificar el uso del **portapapeles general en todo el sistema**.
- `pasteboardWithName:create:` y `pasteboardWithUniqueName` para crear **portapapeles personalizados**. Verifica si la persistencia est치 habilitada, aunque esto est치 obsoleto.

### An치lisis Din치mico

El an치lisis din치mico implica enganchar o rastrear m칠todos espec칤ficos:
- Monitorea `generalPasteboard` para el uso en todo el sistema.
- Rastrea `pasteboardWithName:create:` y `pasteboardWithUniqueName` para implementaciones personalizadas.
- Observa las llamadas de m칠todo `setPersistent:` obsoletas para verificar la configuraci칩n de persistencia.

Detalles clave a monitorear incluyen:
- **Nombres** y **contenidos** del portapapeles (por ejemplo, verificaci칩n de cadenas, URLs, im치genes).
- **N칰mero de elementos** y **tipos de datos** presentes, aprovechando comprobaciones de tipos de datos est치ndar y personalizados.
- **Opciones de caducidad y solo local** inspeccionando el m칠todo `setItems:options:`.

Un ejemplo de uso de herramienta de monitoreo es el **monitor de portapapeles de objection**, que consulta el portapapeles general cada 5 segundos en busca de cambios y muestra los nuevos datos.

Aqu칤 tienes un ejemplo de script JavaScript simple, inspirado en el enfoque de objection, para leer y registrar cambios en el portapapeles cada 5 segundos:
```javascript
const UIPasteboard = ObjC.classes.UIPasteboard;
const Pasteboard = UIPasteboard.generalPasteboard();
var items = "";
var count = Pasteboard.changeCount().toString();

setInterval(function () {
const currentCount = Pasteboard.changeCount().toString();
const currentItems = Pasteboard.items().toString();

if (currentCount === count) { return; }

items = currentItems;
count = currentCount;

console.log('[* Pasteboard changed] count: ' + count +
' hasStrings: ' + Pasteboard.hasStrings().toString() +
' hasURLs: ' + Pasteboard.hasURLs().toString() +
' hasImages: ' + Pasteboard.hasImages().toString());
console.log(items);

}, 1000 * 5);
```
## Referencias

* [https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06h-testing-platform-interaction#testing-object-persistence-mstg-platform-8](https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06h-testing-platform-interaction#testing-object-persistence-mstg-platform-8)
* [https://hackmd.io/@robihamanto/owasp-robi](https://hackmd.io/@robihamanto/owasp-robi)
* [https://mas.owasp.org/MASTG/tests/ios/MASVS-PLATFORM/MASTG-TEST-0073/](https://mas.owasp.org/MASTG/tests/ios/MASVS-PLATFORM/MASTG-TEST-0073/)

<figure><img src="/.gitbook/assets/WebSec_1500x400_10fps_21sn_lightoptimized_v2.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}


<details>

<summary><strong>Aprende hacking en AWS desde cero hasta experto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si deseas ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** Consulta los [**PLANES DE SUSCRIPCI칍N**](https://github.com/sponsors/carlospolop)!
* Obt칠n el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci칩n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s칤guenos** en **Twitter** 游냕 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
