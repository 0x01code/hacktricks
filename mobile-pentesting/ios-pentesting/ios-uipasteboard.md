<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>를 통해 AWS 해킹을 처음부터 전문가까지 배워보세요<strong>!</strong></summary>

HackTricks를 지원하는 다른 방법:

* **회사를 HackTricks에서 광고하거나 HackTricks를 PDF로 다운로드**하려면 [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)를 확인하세요!
* [**공식 PEASS & HackTricks 스웨그**](https://peass.creator-spring.com)를 얻으세요.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)를 발견하세요. 독점적인 [**NFTs**](https://opensea.io/collection/the-peass-family) 컬렉션입니다.
* 💬 [**Discord 그룹**](https://discord.gg/hRep4RUj7f) 또는 [**텔레그램 그룹**](https://t.me/peass)에 **참여**하거나 **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)**를** **팔로우**하세요.
* **Hacking 트릭을 공유하려면** [**HackTricks**](https://github.com/carlospolop/hacktricks)와 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github 저장소에 PR을 제출하세요.

</details>

iOS 기기에서 애플리케이션 간 및 애플리케이션 내에서 데이터 공유는 [`UIPasteboard`](https://developer.apple.com/documentation/uikit/uipasteboard) 메커니즘을 통해 이루어집니다. 이 메커니즘은 다음 두 가지 주요 범주로 나뉩니다:

- **시스템 전역 붙여넣기 보드**: 이는 **모든 애플리케이션**과 데이터를 공유하기 위해 사용되며, iOS 10부터 제공되는 장치 재시작 및 앱 제거 후에도 데이터를 유지할 수 있는 기능을 제공합니다.
- **사용자 정의 / 이름 지정 붙여넣기 보드**: 이는 **앱 내 또는 동일한 팀 ID를 공유하는 다른 앱과의 데이터 공유**를 위해 특별히 설계되었으며, iOS 10에서 도입된 변경 사항에 따라 생성한 애플리케이션 프로세스의 수명을 넘어서 유지되지 않습니다.

**보안 고려 사항**은 붙여넣기 보드를 사용할 때 중요한 역할을 합니다. 예를 들어:
- 사용자가 **붙여넣기 보드에 대한 앱 권한을 관리할 수 있는 메커니즘**이 없습니다.
- 붙여넣기 보드의 **배경 모니터링을 무단으로 방지**하기 위해 액세스는 애플리케이션이 포그라운드에 있을 때로 제한됩니다 (iOS 9부터).
- 개인 정보 보호 문제로 인해 **지속적인 이름 지정 붙여넣기 보드의 사용은 권장되지 않습니다**.
- iOS 10에서 도입된 **Universal Clipboard** 기능을 통해 일반 붙여넣기 보드를 통해 장치 간에 콘텐츠를 공유할 수 있으며, 개발자는 데이터 만료 및 자동 콘텐츠 전송 비활성화를 설정할 수 있습니다.

**민감한 정보가 실수로 저장되지 않도록**하는 것이 중요합니다. 또한 애플리케이션은 의도하지 않은 작업을 위해 전역 붙여넣기 보드 데이터의 오용을 방지하기 위해 설계되어야 하며, 개발자는 민감한 정보를 클립보드에 복사하는 것을 방지하기 위한 조치를 구현하는 것이 좋습니다.

### 정적 분석

정적 분석을 위해 소스 코드 또는 이진 파일에서 다음을 검색하세요:
- **systemwide general pasteboard**의 사용을 식별하기 위해 `generalPasteboard`를 검색합니다.
- **사용자 정의 붙여넣기 보드**를 생성하기 위해 `pasteboardWithName:create:` 및 `pasteboardWithUniqueName`을 검색합니다. 그러나 이는 폐기된 기능입니다.

### 동적 분석

동적 분석은 특정 메서드를 후킹하거나 추적하는 것을 포함합니다:
- 시스템 전역 사용을 위해 `generalPasteboard`를 모니터링합니다.
- 사용자 정의 구현을 위해 `pasteboardWithName:create:` 및 `pasteboardWithUniqueName`을 추적합니다.
- 지속성 설정을 확인하기 위해 폐기된 `setPersistent:` 메서드 호출을 관찰합니다.

모니터링해야 할 주요 세부 정보는 다음과 같습니다:
- **붙여넣기 보드 이름** 및 **콘텐츠** (예: 문자열, URL, 이미지 확인).
- 존재하는 **항목 수** 및 **데이터 유형**, 표준 및 사용자 정의 데이터 유형 확인을 활용합니다.
- `setItems:options:` 메서드를 검사하여 **만료 및 로컬 전용 옵션**을 확인합니다.

objection의 붙여넣기 보드 모니터와 같은 모니터링 도구 사용 예는 5초마다 generalPasteboard를 폴링하여 변경 사항을 출력합니다.

다음은 objection의 접근 방식에서 영감을 받은 간단한 JavaScript 스크립트 예제입니다. 5초마다 붙여넣기 보드에서 변경 사항을 읽고 로그에 기록합니다:
```javascript
const UIPasteboard = ObjC.classes.UIPasteboard;
const Pasteboard = UIPasteboard.generalPasteboard();
var items = "";
var count = Pasteboard.changeCount().toString();

setInterval(function () {
const currentCount = Pasteboard.changeCount().toString();
const currentItems = Pasteboard.items().toString();

if (currentCount === count) { return; }

items = currentItems;
count = currentCount;

console.log('[* Pasteboard changed] count: ' + count +
' hasStrings: ' + Pasteboard.hasStrings().toString() +
' hasURLs: ' + Pasteboard.hasURLs().toString() +
' hasImages: ' + Pasteboard.hasImages().toString());
console.log(items);

}, 1000 * 5);
```
## 참고 자료

* [https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06h-testing-platform-interaction#testing-object-persistence-mstg-platform-8](https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06h-testing-platform-interaction#testing-object-persistence-mstg-platform-8)
* [https://hackmd.io/@robihamanto/owasp-robi](https://hackmd.io/@robihamanto/owasp-robi)
* [https://mas.owasp.org/MASTG/tests/ios/MASVS-PLATFORM/MASTG-TEST-0073/](https://mas.owasp.org/MASTG/tests/ios/MASVS-PLATFORM/MASTG-TEST-0073/)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>를 통해 AWS 해킹을 처음부터 전문가까지 배워보세요<strong>!</strong></summary>

HackTricks를 지원하는 다른 방법:

* **회사를 HackTricks에서 광고하거나 HackTricks를 PDF로 다운로드**하려면 [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)를 확인하세요!
* [**공식 PEASS & HackTricks 스웨그**](https://peass.creator-spring.com)를 얻으세요.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)를 발견하세요. 독점적인 [**NFTs**](https://opensea.io/collection/the-peass-family) 컬렉션입니다.
* 💬 [**Discord 그룹**](https://discord.gg/hRep4RUj7f) 또는 [**텔레그램 그룹**](https://t.me/peass)에 **참여**하거나 **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)를 **팔로우**하세요.
* **HackTricks**와 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github 저장소에 PR을 제출하여 자신의 해킹 기법을 공유하세요.

</details>
