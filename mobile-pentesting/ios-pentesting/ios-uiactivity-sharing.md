<details>

<summary><strong>Apprenez le hacking AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**merchandising officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de hacking en soumettant des PR aux d√©p√¥ts github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>


# Partage UIActivity

√Ä partir d'iOS 6, il est possible pour les applications tierces de **partager des donn√©es (√©l√©ments)** via des m√©canismes sp√©cifiques [comme AirDrop, par exemple](https://developer.apple.com/library/archive/documentation/iPhone/Conceptual/iPhoneOSProgrammingGuide/Inter-AppCommunication/Inter-AppCommunication.html#//apple_ref/doc/uid/TP40007072-CH6-SW3). Du point de vue de l'utilisateur, cette fonctionnalit√© est la bien connue _feuille d'activit√© de partage_ accessible apr√®s avoir cliqu√© sur le bouton "Partager".

Une liste compl√®te des m√©canismes de partage int√©gr√©s disponibles peut √™tre trouv√©e dans [UIActivity.ActivityType](https://developer.apple.com/documentation/uikit/uiactivity/activitytype). Si jug√©s inappropri√©s pour l'application, les **d√©veloppeurs ont la possibilit√© d'exclure certains de ces m√©canismes de partage**.

## **Envoi d'√©l√©ments**

Lors du test du partage `UIActivity`, vous devriez porter une attention particuli√®re √† :

* les donn√©es (√©l√©ments) partag√©es,
* les activit√©s personnalis√©es,
* les types d'activit√©s exclus.

Le partage de donn√©es via `UIActivity` fonctionne en cr√©ant un `UIActivityViewController` et en lui passant les √©l√©ments souhait√©s (URLs, texte, une image) sur [`init(activityItems:applicationActivities:)`](https://developer.apple.com/documentation/uikit/uiactivityviewcontroller/1622019-init).

Si vous avez le code source, vous devriez examiner le `UIActivityViewController` :

* Inspectez les activit√©s pass√©es √† la m√©thode `init(activityItems:applicationActivities:)`.
* V√©rifiez s'il d√©finit des activit√©s personnalis√©es (√©galement pass√©es √† la m√©thode pr√©c√©dente).
* V√©rifiez les `excludedActivityTypes`, le cas √©ch√©ant.

Si vous n'avez que l'application compil√©e/install√©e, essayez de rechercher la m√©thode et la propri√©t√© pr√©c√©dentes, par exemple :
```bash
$ rabin2 -zq Telegram\ X.app/Telegram\ X | grep -i activityItems
0x1000df034 45 44 initWithActivityItems:applicationActivities:
```
## **R√©ception d'√©l√©ments**

Lors de la r√©ception d'√©l√©ments, vous devez v√©rifier :

* si l'application **d√©clare des _types de documents personnalis√©s_** en consultant les **UTIs Export√©s/Import√©s** (onglet "Info" du projet Xcode). La liste de tous les UTIs d√©clar√©s par le syst√®me (Uniform Type Identifiers) est disponible dans la [documentation archiv√©e d'Apple Developer](https://developer.apple.com/library/archive/documentation/Miscellaneous/Reference/UTIRef/Articles/System-DeclaredUniformTypeIdentifiers.html#//apple_ref/doc/uid/TP40009259).
* si l'application sp√©cifie des _types de documents qu'elle peut ouvrir_ en consultant les **Types de Documents** (onglet "Info" du projet Xcode). Si pr√©sents, ils se composent d'un nom et d'un ou plusieurs UTIs qui repr√©sentent le type de donn√©es (par exemple, "public.png" pour les fichiers PNG). iOS utilise cela pour d√©terminer si l'application est √©ligible pour ouvrir un document donn√© (sp√©cifier des UTIs Export√©s/Import√©s ne suffit pas).
* si l'application _v√©rifie correctement les donn√©es re√ßues_ en examinant l'impl√©mentation de [`application:openURL:options:`](https://developer.apple.com/documentation/uikit/uiapplicationdelegate/1623112-application?language=objc) (ou sa version obsol√®te [`UIApplicationDelegate application:openURL:sourceApplication:annotation:`](https://developer.apple.com/documentation/uikit/uiapplicationdelegate/1623073-application?language=objc)) dans le d√©l√©gu√© de l'application.

Sans avoir le code source, vous pouvez toujours examiner le fichier `Info.plist` et rechercher :

* `UTExportedTypeDeclarations`/`UTImportedTypeDeclarations` si l'application d√©clare des _types de documents personnalis√©s_ export√©s/import√©s.
* `CFBundleDocumentTypes` pour voir si l'application sp√©cifie des _types de documents qu'elle peut ouvrir_.

Une explication tr√®s compl√®te de l'utilisation de ces cl√©s peut √™tre trouv√©e [sur Stackoverflow](https://stackoverflow.com/questions/21937978/what-are-utimportedtypedeclarations-and-utexportedtypedeclarations-used-for-on-i) mais voici un r√©sum√© :

* `UTExportedTypeDeclarations` : Utilisez-les pour d√©finir **vos propres UTIs** que votre application veut enseigner au syst√®me sur lequel elle est install√©e. Un **UTI d√©crit un morceau de donn√©es** (_pas n√©cessairement des donn√©es situ√©es dans un fichier !_) et n√©cessite au moins un **identifiant** (`com.example.MyCoolDataType`). De plus, il peut avoir un **nom** (`My Cool Data Type`), une ou plusieurs **extensions** de nom de fichier (`.myCoolDataType`), un ou plusieurs **types MIME** (`x-application/my-cool-data-type`), un ou plusieurs **types de presse-papiers** (utilis√©s lors du transfert de donn√©es de ce type en utilisant copier\&coller), et un ou plusieurs **types OS h√©rit√©s**. G√©n√©ralement, vous voulez aussi que les UTIs se conforment √† des UTIs existants (par exemple, lorsque vous dites que votre UTI se conforme √† `public.data`, tout processus qui peut traiter des donn√©es g√©n√©riques peut √©galement traiter votre UTI).
* Exemple : Vous d√©finissez votre propre format de donn√©es de fichier propri√©taire et vous voulez que ce format de donn√©es soit √©galement connu des autres applications, plugins, extensions, etc.
* `UTImportedTypeDeclarations` : Vous utilisez `UTImportedTypeDeclarations` pour **enseigner au syst√®me des UTIs que vous voulez √™tre connus dans le syst√®me mais qui ne sont pas vos UTIs**.
* Exemple : Votre application est capable de lire le format de donn√©es propri√©taire d'une autre application, mais vous ne savez pas si cette application est m√™me install√©e sur le syst√®me.
* `CFBundleDocumentTypes` : Vous utilisez `CFBundleDocumentTypes` pour indiquer au syst√®me quels types de documents votre application est capable d'ouvrir. √Ä moins que vous **ne listiez √©galement vos UTIs ici**, ces UTIs ne sont pas associ√©s √† votre application dans le Finder et votre application n'appara√Ætra pas dans le menu `Ouvrir avec >`. \
La seule chose que vous devez toujours d√©finir pour un type de document est le r√¥le. Le **r√¥le** peut √™tre "**Viewer**" (vous pouvez afficher ce type de fichier mais vous ne pouvez pas le modifier), "**Editor**" (vous pouvez afficher et modifier ce type de fichier), "**None**" (il n'est pas sp√©cifi√© ce que vous pouvez faire avec ce fichier).
* Exemple : Vous voulez que votre **application soit associ√©e √† certains types de fichiers**, identifi√©s soit par extension, soit par type MIME, soit par identifiant UTI. **Si vous voulez que votre application soit associ√©e √† un type UTI, l'application doit soit importer soit exporter le type**, sinon le type peut ne pas √™tre connu du syst√®me et l'enregistrement √† un type UTI inconnu n'a tout simplement aucun effet.

## Test Dynamique

Pour les **activit√©s d'envoi**, vous pouvez :

* Intercepter la m√©thode que nous avons vue dans l'analyse statique ([`init(activityItems:applicationActivities:)`](https://developer.apple.com/documentation/uikit/uiactivityviewcontroller/1622019-init)) pour obtenir les `activityItems` et `applicationActivities`.
* D√©couvrir les activit√©s exclues en interceptant la propri√©t√© [`excludedActivityTypes`](https://developer.apple.com/documentation/uikit/uiactivityviewcontroller/1622009-excludedactivitytypes).

Pour la r√©ception d'√©l√©ments, vous pouvez :

* _Partager_ un fichier avec l'application depuis une autre application ou l'envoyer via AirDrop ou e-mail. Choisissez le fichier de mani√®re √† d√©clencher la bo√Æte de dialogue "Ouvrir avec..." (c'est-√†-dire qu'il n'y a pas d'application par d√©faut qui ouvrira le fichier, un PDF par exemple).
* Intercepter `application:openURL:options:` et toute autre m√©thode identifi√©e lors d'une analyse statique pr√©c√©dente.
* Observer le comportement de l'application.
* De plus, vous pourriez envoyer des fichiers sp√©cifiquement malform√©s et/ou utiliser une technique de fuzzing.

**Lisez comment** [**ici**](https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06h-testing-platform-interaction#dynamic-analysis-8)**.**


<details>

<summary><strong>Apprenez le hacking AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous voulez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**merchandising officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de hacking en soumettant des PR aux d√©p√¥ts github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
