<details>

<summary><strong>Aprende hacking en AWS de cero a héroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF**, consulta los [**PLANES DE SUSCRIPCIÓN**](https://github.com/sponsors/carlospolop)!
* Obtén el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colección de [**NFTs exclusivos**](https://opensea.io/collection/the-peass-family)
* **Únete al grupo de** 💬 [**Discord**](https://discord.gg/hRep4RUj7f) o al grupo de [**telegram**](https://t.me/peass) o **sigue** a **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de GitHub de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>


# Compartir UIActivity

A partir de iOS 6 es posible que aplicaciones de terceros **compartan datos (elementos)** a través de mecanismos específicos [como AirDrop, por ejemplo](https://developer.apple.com/library/archive/documentation/iPhone/Conceptual/iPhoneOSProgrammingGuide/Inter-AppCommunication/Inter-AppCommunication.html#//apple_ref/doc/uid/TP40007072-CH6-SW3). Desde la perspectiva del usuario, esta característica es la conocida hoja de actividad de compartir del sistema que aparece después de hacer clic en el botón "Compartir".

Una lista completa de los mecanismos de compartición integrados disponibles se puede encontrar en [UIActivity.ActivityType](https://developer.apple.com/documentation/uikit/uiactivity/activitytype). Si no se consideran apropiados para la aplicación, los **desarrolladores tienen la posibilidad de excluir algunos de estos mecanismos de compartición**.

## **Enviando Elementos**

Al probar la Compartición `UIActivity`, debes prestar especial atención a:

* los datos (elementos) que se están compartiendo,
* las actividades personalizadas,
* los tipos de actividad excluidos.

La compartición de datos a través de `UIActivity` funciona creando un `UIActivityViewController` y pasándole los elementos deseados (URLs, texto, una imagen) en [`init(activityItems:applicationActivities:)`](https://developer.apple.com/documentation/uikit/uiactivityviewcontroller/1622019-init).

Si tienes el código fuente, debes echar un vistazo al `UIActivityViewController`:

* Inspecciona las actividades pasadas al método `init(activityItems:applicationActivities:)`.
* Comprueba si define actividades personalizadas (también pasadas al método anterior).
* Verifica los `excludedActivityTypes`, si los hay.

Si solo tienes la aplicación compilada/instalada, intenta buscar el método y la propiedad anteriores, por ejemplo:
```bash
$ rabin2 -zq Telegram\ X.app/Telegram\ X | grep -i activityItems
0x1000df034 45 44 initWithActivityItems:applicationActivities:
```
## **Recepción de Elementos**

Al recibir elementos, debes verificar:

* si la aplicación **declara** _**tipos de documentos personalizados**_ mirando en **Exported/Imported UTIs** (pestaña "Info" del proyecto Xcode). La lista de todos los UTIs declarados por el sistema (Identificadores de Tipo Uniforme) se puede encontrar en la [documentación archivada de Apple Developer](https://developer.apple.com/library/archive/documentation/Miscellaneous/Reference/UTIRef/Articles/System-DeclaredUniformTypeIdentifiers.html#//apple_ref/doc/uid/TP40009259).
* si la aplicación especifica _**tipos de documentos que puede abrir**_ mirando en **Document Types** (pestaña "Info" del proyecto Xcode). Si están presentes, consisten en un nombre y uno o más UTIs que representan el tipo de datos (por ejemplo, "public.png" para archivos PNG). iOS utiliza esto para determinar si la aplicación es elegible para abrir un documento dado (especificar Exported/Imported UTIs no es suficiente).
* si la aplicación _**verifica adecuadamente los datos recibidos**_ mirando en la implementación de [`application:openURL:options:`](https://developer.apple.com/documentation/uikit/uiapplicationdelegate/1623112-application?language=objc) (o su versión obsoleta [`UIApplicationDelegate application:openURL:sourceApplication:annotation:`](https://developer.apple.com/documentation/uikit/uiapplicationdelegate/1623073-application?language=objc)) en el delegado de la aplicación.

Si no tienes el código fuente, aún puedes echar un vistazo al archivo `Info.plist` y buscar:

* `UTExportedTypeDeclarations`/`UTImportedTypeDeclarations` si la aplicación declara _tipos de documentos personalizados_ exportados/importados.
* `CFBundleDocumentTypes` para ver si la aplicación especifica _tipos de documentos que puede abrir_.

Una explicación muy completa sobre el uso de estas claves se puede encontrar [en Stackoverflow](https://stackoverflow.com/questions/21937978/what-are-utimportedtypedeclarations-and-utexportedtypedeclarations-used-for-on-i) pero aquí tienes un resumen:

* `UTExportedTypeDeclarations`: Úsalos para definir **tus propios UTIs** que tu aplicación quiere enseñar al sistema en el que está instalada. Un **UTI describe un fragmento de datos** (_¡no necesariamente datos ubicados dentro de un archivo!_) y requiere al menos un **identificador** (`com.example.MyCoolDataType`). Adicionalmente puede tener un **nombre** (`My Cool Data Type`), una o más extensiones de **archivo** (`.myCoolDataType`), uno o más **tipos MIME** (`x-application/my-cool-data-type`), uno o más **tipos de portapapeles** (usados cuando se transfieren datos de ese tipo usando copiar y pegar), y uno o más **tipos de sistema operativo antiguos**. Usualmente también quieres que los UTIs se conformen a UTIs existentes (por ejemplo, cuando dices que tu UTI se conforma a `public.data`, cualquier proceso que pueda tratar con datos genéricos también puede tratar con tu UTI).
* Ej.: Definiste tu propio formato de archivo de datos propietario y quieres que este formato de datos también sea conocido por otras aplicaciones, plugins, extensiones, etc.
* `UTImportedTypeDeclarations`: Usas `UTImportedTypeDeclarations` para **enseñar al sistema sobre UTIs que quieres que sean conocidos en el sistema pero que no son tus UTIs**.
* Ej.: Tu aplicación es capaz de leer el formato de datos propietario de otra aplicación, pero no sabes si esa aplicación está siquiera instalada en el sistema.
* `CFBundleDocumentTypes`: Usas `CFBundleDocumentTypes` para decirle al sistema qué tipos de documentos tu aplicación es capaz de abrir. A menos que **también listes tus UTIs aquí**, estos UTIs no se asocian con tu aplicación en Finder y tu aplicación no aparecerá en el menú `Abrir con >`. \
Lo único que siempre debes establecer para un tipo de documento es el rol. El **rol** puede ser "**Viewer**" (puedes mostrar ese tipo de archivo pero no puedes editarlo), "**Editor**" (puedes mostrar y editar ese tipo de archivo), "**None**" (no está especificado qué puedes hacer con ese archivo).
* Ej.: Quieres que tu **aplicación esté asociada con ciertos tipos de archivos**, identificados ya sea por extensión, por tipo MIME o por identificador UTI. **Si quieres que tu aplicación esté asociada con un tipo de UTI, la aplicación debe importar o exportar el tipo**, de lo contrario el tipo puede no ser conocido por el sistema y registrarse en un tipo de UTI desconocido simplemente no tiene efecto alguno.

## Pruebas Dinámicas

Para **actividades de envío** puedes:

* Enganchar el método que hemos visto en el análisis estático ([`init(activityItems:applicationActivities:)`](https://developer.apple.com/documentation/uikit/uiactivityviewcontroller/1622019-init)) para obtener los `activityItems` y `applicationActivities`.
* Descubrir las actividades excluidas enganchando la propiedad [`excludedActivityTypes`](https://developer.apple.com/documentation/uikit/uiactivityviewcontroller/1622009-excludedactivitytypes).

Para recibir elementos puedes:

* _Compartir_ un archivo con la aplicación desde otra aplicación o enviarlo a través de AirDrop o correo electrónico. Elige el archivo de tal manera que active el diálogo "Abrir con..." (es decir, no hay una aplicación predeterminada que abrirá el archivo, un PDF por ejemplo).
* Enganchar `application:openURL:options:` y cualquier otro método que se haya identificado en un análisis estático previo.
* Observar el comportamiento de la aplicación.
* Además, podrías enviar archivos malformados específicos y/o utilizar una técnica de fuzzing.

**Lee cómo** [**aquí**](https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06h-testing-platform-interaction#dynamic-analysis-8)**.**


<details>

<summary><strong>Aprende hacking en AWS de cero a héroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver a tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** consulta los [**PLANES DE SUSCRIPCIÓN**](https://github.com/sponsors/carlospolop)!
* Consigue el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colección de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **Únete al** 💬 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **sigue** a **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de GitHub** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
