<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)でゼロからヒーローまでのAWSハッキングを学ぶ</strong></summary>

HackTricksをサポートする他の方法:

* **HackTricksにあなたの会社を広告掲載したい場合**や**HackTricksをPDFでダウンロードしたい場合**は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください。
* [**公式PEASS & HackTricksグッズ**](https://peass.creator-spring.com)を入手する
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクションをチェックする
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)や[**telegramグループ**](https://t.me/peass)に**参加する**か、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)を**フォローする**。
* **HackTricks**と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のgithubリポジトリにPRを提出して、あなたのハッキングテクニックを共有する。

</details>


# UIActivity シェアリング

iOS 6から、サードパーティアプリは特定のメカニズム（例えばAirDropなど）を介して**データ（アイテム）を共有する**ことが可能です。ユーザーから見ると、これは"シェア"ボタンをクリックした後に表示されるよく知られたシステム全体の_シェアアクティビティシート_です。

利用可能な組み込みシェアリングメカニズムの完全なリストは、[UIActivity.ActivityType](https://developer.apple.com/documentation/uikit/uiactivity/activitytype)で見つけることができます。アプリに適切でないと判断された場合、**開発者はこれらのシェアリングメカニズムのいくつかを除外する可能性があります**。

## **アイテムの送信**

`UIActivity` シェアリングをテストする際には、特に以下に注意を払うべきです:

* 共有されるデータ（アイテム）,
* カスタムアクティビティ,
* 除外されるアクティビティタイプ。

`UIActivity`を介したデータ共有は、`UIActivityViewController`を作成し、[`init(activityItems:applicationActivities:)`](https://developer.apple.com/documentation/uikit/uiactivityviewcontroller/1622019-init)に望ましいアイテム（URL、テキスト、画像）を渡すことで機能します。

ソースコードを持っている場合は、`UIActivityViewController`を調べるべきです:

* `init(activityItems:applicationActivities:)`メソッドに渡されるアクティビティを検査する。
* カスタムアクティビティが定義されているか（前述のメソッドにも渡される）をチェックする。
* `excludedActivityTypes`があるかどうかを確認する。

コンパイル済み/インストール済みのアプリしか持っていない場合は、前述のメソッドとプロパティを探してみてください。例えば：
```bash
$ rabin2 -zq Telegram\ X.app/Telegram\ X | grep -i activityItems
0x1000df034 45 44 initWithActivityItems:applicationActivities:
```
## **アイテムの受信**

アイテムを受信する際には、以下を確認する必要があります：

* アプリが**カスタムドキュメントタイプ**を宣言しているかどうかは、**Exported/Imported UTIs**（Xcodeプロジェクトの"Info"タブ）を見て確認します。すべてのシステム宣言されたUTIs（Uniform Type Identifiers）のリストは、[アーカイブされたApple Developer Documentation](https://developer.apple.com/library/archive/documentation/Miscellaneous/Reference/UTIRef/Articles/System-DeclaredUniformTypeIdentifiers.html#//apple_ref/doc/uid/TP40009259)で見ることができます。
* アプリが開くことができる**ドキュメントタイプ**を指定しているかどうかは、**Document Types**（Xcodeプロジェクトの"Info"タブ）を見て確認します。存在する場合、それらは名前と一つ以上のUTIsで構成されており、データタイプを表します（例：PNGファイルの場合は"public.png"）。iOSはこれを使用して、アプリが特定のドキュメントを開く資格があるかどうかを判断します（Exported/Imported UTIsを指定するだけでは不十分です）。
* アプリが受け取ったデータを適切に**検証**しているかどうかは、アプリデリゲート内の[`application:openURL:options:`](https://developer.apple.com/documentation/uikit/uiapplicationdelegate/1623112-application?language=objc)（またはその非推奨バージョン[`UIApplicationDelegate application:openURL:sourceApplication:annotation:`](https://developer.apple.com/documentation/uikit/uiapplicationdelegate/1623073-application?language=objc)）の実装を見て確認します。

ソースコードがない場合でも、`Info.plist`ファイルを見て以下を検索できます：

* アプリがカスタムドキュメントタイプを宣言している場合は`UTExportedTypeDeclarations`/`UTImportedTypeDeclarations`。
* アプリが開くことができるドキュメントタイプを指定している場合は`CFBundleDocumentTypes`。

これらのキーの使用についての非常に完全な説明は[Stackoverflow](https://stackoverflow.com/questions/21937978/what-are-utimportedtypedeclarations-and-utexportedtypedeclarations-used-for-on-i)で見ることができますが、ここに要約があります：

* `UTExportedTypeDeclarations`：システムにインストールされているアプリが自分のUTIsを教えるために使用します。**UTIはデータの一部を記述します**（必ずしもファイル内にあるデータではありません！）最低限、**識別子**（`com.example.MyCoolDataType`）が必要です。さらに、**名前**（`My Cool Data Type`）、一つ以上のファイル名**拡張子**（`.myCoolDataType`）、一つ以上の**MIME** **タイプ**（`x-application/my-cool-data-type`）、一つ以上の**ペーストボード** **タイプ**（コピー＆ペーストを使用してその種類のデータを転送する際に使用される）、および一つ以上の**レガシーOSタイプ**があります。通常、既存のUTIsに準拠することも望まれます（例：あなたのUTIが`public.data`に準拠していると言うと、一般的なデータを扱うことができるプロセスは、あなたのUTIも扱うことができます）。
* 例：独自のプロプライエタリファイルデータフォーマットを定義し、このデータフォーマットを他のアプリ、プラグイン、拡張機能などにも知らせたい場合。
* `UTImportedTypeDeclarations`：システムにあなたのUTIsではないが、システムで知られているUTIsについて教えるために`UTImportedTypeDeclarations`を使用します。
* 例：あなたのアプリが他のアプリケーションのプロプライエタリデータフォーマットを読むことができるが、そのアプリケーションがシステムにインストールされているかどうかわからない場合。
* `CFBundleDocumentTypes`：システムにあなたのアプリが開くことができるドキュメントタイプを伝えるために`CFBundleDocumentTypes`を使用します。**ここにUTIsをリストしない限り**、これらのUTIsはアプリとFinderに関連付けられず、アプリは`Open With >`メニューに表示されません。\
ドキュメントタイプに常に設定する必要があるのは役割です。**役割**は"**Viewer**"（そのファイルタイプを表示できますが、編集はできません）、"**Editor**"（そのファイルタイプを表示して編集できます）、"**None**"（何をすることができるかは指定されていません）のいずれかです。
* 例：特定のファイルタイプにあなたの**アプリを関連付けたい**場合、拡張子、MIMEタイプ、またはUTI識別子で識別されます。**アプリをUTIタイプに関連付けたい場合、アプリはそのタイプをインポートまたはエクスポートする必要があります**。そうでないと、そのタイプはシステムに知られていない可能性があり、未知のUTIタイプに登録しても効果はありません。

## 動的テスト

**送信アクティビティ**については、以下の方法があります：

* 静的分析で見たメソッド（[`init(activityItems:applicationActivities:)`](https://developer.apple.com/documentation/uikit/uiactivityviewcontroller/1622019-init)）をフックして、`activityItems`と`applicationActivities`を取得します。
* [`excludedActivityTypes`プロパティ](https://developer.apple.com/documentation/uikit/uiactivityviewcontroller/1622009-excludedactivitytypes)をフックして、除外されたアクティビティを見つけます。

アイテムを受信するには、以下の方法があります：

* 別のアプリからファイルをアプリに_Share_するか、AirDropやメールで送信します。"Open with..."ダイアログがトリガーされるファイルを選択します（つまり、ファイルを開くデフォルトのアプリがない場合、例えばPDFなど）。
* `application:openURL:options:`および以前の静的分析で特定された他のメソッドをフックします。
* アプリの挙動を観察します。
* 加えて、特定の不正なファイルを送信したり、ファジング技術を使用することもできます。

**こちらで** [**読む**](https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06h-testing-platform-interaction#dynamic-analysis-8)**。**

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)で</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>AWSハッキングをゼロからヒーローまで学ぶ</strong></a><strong>！</strong></summary>

HackTricksをサポートする他の方法：

* **HackTricksにあなたの会社を広告したい**、または**HackTricksをPDFでダウンロードしたい**場合は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS & HackTricksグッズ**](https://peass.creator-spring.com)を入手してください。
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見してください。私たちの独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクションです。
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)や[**テレグラムグループ**](https://t.me/peass)に**参加する**か、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)で**フォロー**してください。
* **HackTricks**（https://github.com/carlospolop/hacktricks）および[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のgithubリポジトリにPRを提出して、あなたのハッキングのコツを共有してください。

</details>
