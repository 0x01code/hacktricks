# Compartilhamento de UIActivity iOS

<details>

<summary><strong>Aprenda hacking AWS do zero ao avan√ßado com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ deseja ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF** Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**swag oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-nos** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para os** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) reposit√≥rios do github.

</details>

# Compartilhamento de UIActivity Simplificado

A partir do iOS 6, aplicativos de terceiros foram habilitados para **compartilhar dados** como texto, URLs ou imagens usando mecanismos como o AirDrop, conforme descrito no [guia de Comunica√ß√£o entre Apps da Apple](https://developer.apple.com/library/archive/documentation/iPhone/Conceptual/iPhoneOSProgrammingGuide/Inter-AppCommunication/Inter-AppCommunication.html#//apple_ref/doc/uid/TP40007072-CH6-SW3). Essa funcionalidade se manifesta por meio de uma _folha de atividade de compartilhamento_ em todo o sistema que aparece ao interagir com o bot√£o "Compartilhar".

Uma enumera√ß√£o abrangente de todas as op√ß√µes de compartilhamento integradas est√° dispon√≠vel em [UIActivity.ActivityType](https://developer.apple.com/documentation/uikit/uiactivity/activitytype). Os desenvolvedores podem optar por excluir op√ß√µes de compartilhamento espec√≠ficas se as considerarem inadequadas para seu aplicativo.

## **Como Compartilhar Dados**

A aten√ß√£o deve ser direcionada para:

- A natureza dos dados sendo compartilhados.
- A inclus√£o de atividades personalizadas.
- A exclus√£o de certos tipos de atividades.

O compartilhamento √© facilitado por meio da instancia√ß√£o de um `UIActivityViewController`, para o qual os itens destinados ao compartilhamento s√£o passados. Isso √© alcan√ßado chamando:
```bash
$ rabin2 -zq Telegram\ X.app/Telegram\ X | grep -i activityItems
0x1000df034 45 44 initWithActivityItems:applicationActivities:
```
Desenvolvedores devem examinar o `UIActivityViewController` para as atividades e atividades personalizadas com as quais ele √© inicializado, bem como quaisquer `excludedActivityTypes` especificados.

## **Como Receber Dados**

Os seguintes aspectos s√£o cruciais ao receber dados:

- A declara√ß√£o de **tipos de documento personalizados**.
- A especifica√ß√£o dos **tipos de documento que o aplicativo pode abrir**.
- A verifica√ß√£o da **integridade dos dados recebidos**.

Sem acesso ao c√≥digo-fonte, ainda √© poss√≠vel inspecionar o `Info.plist` em busca de chaves como `UTExportedTypeDeclarations`, `UTImportedTypeDeclarations` e `CFBundleDocumentTypes` para entender os tipos de documentos que um aplicativo pode manipular e declarar.

Um guia sucinto sobre essas chaves est√° dispon√≠vel no [Stackoverflow](https://stackoverflow.com/questions/21937978/what-are-utimportedtypedeclarations-and-utexportedtypedeclarations-used-for-on-i), destacando a import√¢ncia de definir e importar UTIs para reconhecimento em todo o sistema e associar tipos de documentos ao seu aplicativo para integra√ß√£o na caixa de di√°logo "Abrir com".

## Abordagem de Teste Din√¢mico

Para testar **envio de atividades**, pode-se:

- Conectar-se ao m√©todo `init(activityItems:applicationActivities:)` para capturar os itens e atividades sendo compartilhados.
- Identificar atividades exclu√≠das interceptando a propriedade `excludedActivityTypes`.

Para **receber itens**, envolve:

- Compartilhar um arquivo com o aplicativo de outra fonte (por exemplo, AirDrop, e-mail) que solicita a caixa de di√°logo "Abrir com...".
- Conectar `application:openURL:options:` entre outros m√©todos identificados durante a an√°lise est√°tica para observar a resposta do aplicativo.
- Utilizar arquivos malformados ou t√©cnicas de fuzzing para avaliar a robustez do aplicativo.

## Refer√™ncias
* [https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06h-testing-platform-interaction](https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06h-testing-platform-interaction)

<details>

<summary><strong>Aprenda hacking AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras maneiras de apoiar o HackTricks:

* Se voc√™ deseja ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**swag oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-nos** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para os reposit√≥rios** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
