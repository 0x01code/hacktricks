<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks Cloud ☁️</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>🐦 Twitter 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 Youtube 🎥</strong></a></summary>

- **サイバーセキュリティ会社**で働いていますか？ **HackTricksで会社を宣伝**したいですか？または、**最新バージョンのPEASSにアクセスしたり、HackTricksをPDFでダウンロード**したいですか？[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！

- [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を見つけてください。独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクションです。

- [**公式のPEASS＆HackTricksのグッズ**](https://peass.creator-spring.com)を手に入れましょう。

- [**💬**](https://emojipedia.org/speech-balloon/) [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**telegramグループ**](https://t.me/peass)に**参加**するか、**Twitter**で**フォロー**してください[**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**。**

- **ハッキングのトリックを共有するには、[hacktricksリポジトリ](https://github.com/carlospolop/hacktricks)と[hacktricks-cloudリポジトリ](https://github.com/carlospolop/hacktricks-cloud)にPRを提出してください。**

</details>


# UIActivity Sharing

iOS 6以降、サードパーティのアプリは特定のメカニズム（例：AirDrop）を介してデータ（アイテム）を**共有**することができます。ユーザーの視点からは、「共有」ボタンをクリックした後に表示される、よく知られたシステム全体の「共有アクティビティシート」としてこの機能が現れます。

利用可能な組み込みの共有メカニズムの完全なリストは、[UIActivity.ActivityType](https://developer.apple.com/documentation/uikit/uiactivity/activitytype)で見つけることができます。アプリに適切でないと考えられない場合、**開発者はこれらの共有メカニズムのいくつかを除外することができます**。

## **アイテムの送信**

`UIActivity`共有をテストする際には、次の点に特に注意する必要があります。

* 共有されるデータ（アイテム）
* カスタムアクティビティ
* 除外されたアクティビティタイプ

`UIActivity`を介したデータの共有は、`UIActivityViewController`を作成し、[`init(activityItems:applicationActivities:)`](https://developer.apple.com/documentation/uikit/uiactivityviewcontroller/1622019-init)に望ましいアイテム（URL、テキスト、画像）を渡すことで機能します。

ソースコードがある場合は、`UIActivityViewController`を確認してください。

* `init(activityItems:applicationActivities:)`メソッドに渡されるアクティビティを調べます。
* カスタムアクティビティが定義されているかどうかを確認します（前のメソッドにも渡されます）。
* `excludedActivityTypes`があるかどうかを確認します。

コンパイル/インストールされたアプリしか持っていない場合は、前述のメソッドやプロパティを検索してみてください。例：
```bash
$ rabin2 -zq Telegram\ X.app/Telegram\ X | grep -i activityItems
0x1000df034 45 44 initWithActivityItems:applicationActivities:
```
## **アイテムの受信**

アイテムを受信する際には、以下の点を確認する必要があります：

* アプリが**カスタムドキュメントタイプ**を宣言しているかどうかを、Xcodeプロジェクトの「情報」タブから**エクスポート/インポートUTI**（Uniform Type Identifiers）を調べることで確認します。すべてのシステムで宣言されたUTIのリストは、[Apple Developer Documentationのアーカイブ](https://developer.apple.com/library/archive/documentation/Miscellaneous/Reference/UTIRef/Articles/System-DeclaredUniformTypeIdentifiers.html#//apple\_ref/doc/uid/TP40009259)で見つけることができます。
* アプリが開くことができる**ドキュメントタイプ**を指定しているかどうかを、Xcodeプロジェクトの「情報」タブの**ドキュメントタイプ**を調べることで確認します。存在する場合、名前とデータタイプを表す1つ以上のUTI（例：PNGファイルの場合は「public.png」）で構成されています。iOSはこれを使用して、アプリが特定のドキュメントを開くことができるかどうかを判断します（エクスポート/インポートUTIを指定するだけでは不十分です）。
* アプリが受信したデータを適切に**検証**しているかどうかを、アプリデリゲートの[`application:openURL:options:`](https://developer.apple.com/documentation/uikit/uiapplicationdelegate/1623112-application?language=objc)（またはその非推奨バージョンである[`UIApplicationDelegate application:openURL:sourceApplication:annotation:`](https://developer.apple.com/documentation/uikit/uiapplicationdelegate/1623073-application?language=objc)）の実装を調べることで確認します。

ソースコードを持っていない場合は、`Info.plist`ファイルを確認し、次の項目を検索します：

* アプリがエクスポート/インポートする**カスタムドキュメントタイプ**を宣言している場合は、`UTExportedTypeDeclarations`/`UTImportedTypeDeclarations`を確認します。
* アプリが開くことができる**ドキュメントタイプ**を指定している場合は、`CFBundleDocumentTypes`を確認します。

これらのキーの使用方法については、[Stackoverflow](https://stackoverflow.com/questions/21937978/what-are-utimportedtypedeclarations-and-utexportedtypedeclarations-used-for-on-i)で非常に詳細な説明がありますが、以下に要約を示します：

* `UTExportedTypeDeclarations`：システムにインストールされたシステムにアプリが教えたい**独自のUTI**を定義するために使用します。**UTIはデータの一部**（必ずしもファイル内にあるデータではありません！）を説明し、少なくとも**識別子**（`com.example.MyCoolDataType`）が必要です。さらに、**名前**（`My Cool Data Type`）、1つ以上のファイル名**拡張子**（`.myCoolDataType`）、1つ以上の**MIME** **タイプ**（`x-application/my-cool-data-type`）、1つ以上の**ペーストボード** **タイプ**（その種類のデータをコピー＆貼り付けで転送する際に使用）および1つ以上の**レガシーOSタイプ**を持つ場合もあります。通常、既存のUTIに準拠するようにUTIを設定することも望ましいです（たとえば、UTIが`public.data`に準拠すると宣言すると、一般的なデータを扱えるプロセスはUTIも扱えるようになります）。
* 例：独自のプロプライエタリファイルデータ形式を定義し、このデータ形式が他のアプリ、プラグイン、拡張機能などにも知られるようにしたい場合。
* `UTImportedTypeDeclarations`：`UTImportedTypeDeclarations`を使用して、システムに既知になってほしいが、自分のUTIではないUTIについてシステムに教えます。
* 例：アプリが他のアプリのプロプライエタリデータ形式を読み取ることができるが、そのアプリがシステムにインストールされているかどうかさえわからない場合。
* `CFBundleDocumentTypes`：`CFBundleDocumentTypes`を使用して、アプリが開くことができるドキュメントタイプをシステムに伝えます。**また、ここにUTIをリストアップしない限り**、これらのUTIはFinderでアプリと関連付けられず、アプリは「開く >」メニューに表示されません。\
ドキュメントタイプには常に**役割**を設定する必要があります。**役割**は「**Viewer**」（そのファイルタイプを表示できますが、編集はできません）、**Editor**（そのファイルタイプを表示および編集できます）、**None**（そのファイルに対して何をするかが指定されていない）のいずれかです。
* 例：特定のファイルタイプ（拡張子、MIMEタイプ、またはUTI識別子で識別される）とアプリを関連付けたい場合。**アプリをUTIタイプに関連付けたい場合、アプリはそのタイプをインポートまたはエクスポートする必要があります**。そうしないと、システムにそのタイプが知られていないため、未知のUTIタイプに登録しても何の効果もありません。

## 動的テスト

**アクティビティの送信**については、次のことができます：

* 静的解析で見たメソッド（[`init(activityItems:applicationActivities:)`](https://developer.apple.com/documentation/uikit/uiactivityviewcontroller/1622019-init)）をフックして、`activityItems`と`applicationActivities`を取得します。
* フックして除外されるアクティビティを特定するために、[`excludedActivityTypes`プロパティ](https://developer.apple.com/documentation/uikit/uiactivityviewcontroller/1622009-excludedactivitytypes)をフックします。

アイテムの受信については、次のことができます：

* 別のアプリからアプリにファイルを**共有**したり、AirDropやメールで送信したりします。ファイルを選択して、「開く...」ダイアログが表示されるようにします（つまり、ファイルを開くためのデフォルトのアプリがない場合、例えばPDFの場合）。
* `application:openURL:options:`や以前の静的解析で特定された他のメソッドをフックします。
* アプリの動作を観察します。
* さらに、特定の不正なファイルを送信したり、ファジング技術を使用したりすることができます。

詳細は[こちら](https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06h-testing-platform-interaction#dynamic-analysis-8)を参照してください。


<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks Cloud ☁️</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>🐦 Twitter 🐦</strong></a> - <a href="https://www.twitch.tv/h
