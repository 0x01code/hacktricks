<details>

<summary><strong>Aprenda hacking no AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ quer ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**material oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **Junte-se ao grupo** üí¨ [**Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) no github.

</details>


# Compartilhamento UIActivity

A partir do iOS 6, √© poss√≠vel para aplicativos de terceiros **compartilhar dados (itens)** atrav√©s de mecanismos espec√≠ficos [como o AirDrop, por exemplo](https://developer.apple.com/library/archive/documentation/iPhone/Conceptual/iPhoneOSProgrammingGuide/Inter-AppCommunication/Inter-AppCommunication.html#//apple_ref/doc/uid/TP40007072-CH6-SW3). Do ponto de vista do usu√°rio, essa funcionalidade √© a conhecida _folha de atividade de compartilhamento_ do sistema que aparece ap√≥s clicar no bot√£o "Compartilhar".

Uma lista completa dos mecanismos de compartilhamento integrados dispon√≠veis pode ser encontrada em [UIActivity.ActivityType](https://developer.apple.com/documentation/uikit/uiactivity/activitytype). Se n√£o considerados apropriados para o aplicativo, os **desenvolvedores t√™m a possibilidade de excluir alguns desses mecanismos de compartilhamento**.

## **Enviando Itens**

Ao testar o Compartilhamento `UIActivity`, voc√™ deve prestar aten√ß√£o especial a:

* os dados (itens) sendo compartilhados,
* as atividades personalizadas,
* os tipos de atividade exclu√≠dos.

O compartilhamento de dados via `UIActivity` funciona criando um `UIActivityViewController` e passando a ele os itens desejados (URLs, texto, uma imagem) em [`init(activityItems:applicationActivities:)`](https://developer.apple.com/documentation/uikit/uiactivityviewcontroller/1622019-init).

Se tiver o c√≥digo-fonte, voc√™ deve examinar o `UIActivityViewController`:

* Inspecione as atividades passadas para o m√©todo `init(activityItems:applicationActivities:)`.
* Verifique se ele define atividades personalizadas (tamb√©m sendo passadas para o m√©todo anterior).
* Verifique os `excludedActivityTypes`, se houver.

Se voc√™ s√≥ tem o aplicativo compilado/instalado, tente procurar pelo m√©todo e propriedade anteriores, por exemplo:
```bash
$ rabin2 -zq Telegram\ X.app/Telegram\ X | grep -i activityItems
0x1000df034 45 44 initWithActivityItems:applicationActivities:
```
## **Recebendo Itens**

Ao receber itens, voc√™ deve verificar:

* se o aplicativo **declara** _**tipos de documentos personalizados**_ ao olhar para **Exported/Imported UTIs** (aba "Info" do projeto Xcode). A lista de todos os UTIs declarados pelo sistema (Uniform Type Identifiers) pode ser encontrada na [documenta√ß√£o arquivada da Apple Developer](https://developer.apple.com/library/archive/documentation/Miscellaneous/Reference/UTIRef/Articles/System-DeclaredUniformTypeIdentifiers.html#//apple_ref/doc/uid/TP40009259).
* se o aplicativo especifica quaisquer _**tipos de documentos que ele pode abrir**_ ao olhar para **Document Types** (aba "Info" do projeto Xcode). Se presentes, eles consistem em um nome e um ou mais UTIs que representam o tipo de dado (por exemplo, "public.png" para arquivos PNG). O iOS usa isso para determinar se o aplicativo √© eleg√≠vel para abrir um determinado documento (especificar Exported/Imported UTIs n√£o √© suficiente).
* se o aplicativo verifica adequadamente os _**dados recebidos**_ ao olhar para a implementa√ß√£o de [`application:openURL:options:`](https://developer.apple.com/documentation/uikit/uiapplicationdelegate/1623112-application?language=objc) (ou sua vers√£o obsoleta [`UIApplicationDelegate application:openURL:sourceApplication:annotation:`](https://developer.apple.com/documentation/uikit/uiapplicationdelegate/1623073-application?language=objc)) no app delegate.

Se n√£o tiver o c√≥digo-fonte, voc√™ ainda pode olhar para o arquivo `Info.plist` e procurar por:

* `UTExportedTypeDeclarations`/`UTImportedTypeDeclarations` se o aplicativo declara _tipos de documentos personalizados_ exportados/importados.
* `CFBundleDocumentTypes` para ver se o aplicativo especifica quaisquer _tipos de documentos que ele pode abrir_.

Uma explica√ß√£o muito completa sobre o uso dessas chaves pode ser encontrada [no Stackoverflow](https://stackoverflow.com/questions/21937978/what-are-utimportedtypedeclarations-and-utexportedtypedeclarations-used-for-on-i), mas aqui est√° um resumo:

* `UTExportedTypeDeclarations`: Use-os para definir **seus pr√≥prios UTIs** que seu aplicativo deseja ensinar ao sistema onde est√° instalado. Um **UTI descreve um peda√ßo de dado** (_n√£o necessariamente dados localizados dentro de um arquivo!_) e requer pelo menos um **identificador** (`com.example.MyCoolDataType`). Adicionalmente, pode ter um **nome** (`My Cool Data Type`), uma ou mais extens√µes de nome de **arquivo** (`.myCoolDataType`), um ou mais **tipos MIME** (`x-application/my-cool-data-type`), um ou mais **tipos de prancheta** (usados ao transferir dados desse tipo usando copiar\&colar), e um ou mais **tipos de sistema operacional legado**. Geralmente, voc√™ tamb√©m quer que os UTIs estejam em conformidade com UTIs existentes (por exemplo, quando voc√™ diz que seu UTI est√° em conformidade com `public.data`, qualquer processo que possa lidar com dados gen√©ricos tamb√©m pode lidar com seu UTI).
* Exemplo: Voc√™ define seu pr√≥prio formato de dados de arquivo propriet√°rio e deseja que esse formato de dados tamb√©m seja conhecido por outros aplicativos, plugins, extens√µes e assim por diante.
* `UTImportedTypeDeclarations`: Voc√™ usa `UTImportedTypeDeclarations` para **ensinar o sistema sobre UTIs que voc√™ quer que sejam conhecidos no sistema, mas que n√£o s√£o seus UTIs**.
* Exemplo: Seu aplicativo √© capaz de ler o formato de dados propriet√°rio de outro aplicativo, mas voc√™ n√£o sabe se esse aplicativo est√° instalado no sistema.
* `CFBundleDocumentTypes`: Voc√™ usa `CFBundleDocumentTypes` para informar ao sistema quais tipos de documentos seu aplicativo √© capaz de abrir. A menos que voc√™ **tamb√©m liste seus UTIs aqui**, esses UTIs n√£o s√£o associados ao seu aplicativo no Finder e seu aplicativo n√£o aparecer√° no menu `Abrir Com >`. \
A √∫nica coisa que voc√™ sempre deve definir para um tipo de documento √© o papel. O **papel** pode ser "**Visualizador**" (voc√™ pode exibir esse tipo de arquivo, mas n√£o pode edit√°-lo), "**Editor**" (voc√™ pode exibir e editar esse tipo de arquivo), "**Nenhum**" (n√£o est√° especificado o que voc√™ pode fazer com esse arquivo).
* Exemplo: Voc√™ quer que seu **aplicativo seja associado a certos tipos de arquivos**, identificados por extens√£o, tipo MIME ou identificador UTI. **Se voc√™ quer que seu aplicativo seja associado a um tipo de UTI, o aplicativo deve importar ou exportar o tipo**, caso contr√°rio, o tipo pode n√£o ser conhecido pelo sistema e registrar um tipo de UTI desconhecido simplesmente n√£o tem efeito algum.

## Teste Din√¢mico

Para **atividades de envio**, voc√™ pode:

* Intercepte o m√©todo que vimos na an√°lise est√°tica ([`init(activityItems:applicationActivities:)`](https://developer.apple.com/documentation/uikit/uiactivityviewcontroller/1622019-init)) para obter os `activityItems` e `applicationActivities`.
* Descubra as atividades exclu√≠das interceptando a propriedade [`excludedActivityTypes`](https://developer.apple.com/documentation/uikit/uiactivityviewcontroller/1622009-excludedactivitytypes).

Para receber itens, voc√™ pode:

* _Compartilhar_ um arquivo com o aplicativo a partir de outro aplicativo ou envi√°-lo via AirDrop ou e-mail. Escolha o arquivo de forma que ele acione o di√°logo "Abrir com..." (ou seja, n√£o h√° um aplicativo padr√£o que abrir√° o arquivo, um PDF, por exemplo).
* Intercepte `application:openURL:options:` e quaisquer outros m√©todos que foram identificados em uma an√°lise est√°tica anterior.
* Observe o comportamento do aplicativo.
* Al√©m disso, voc√™ poderia enviar arquivos espec√≠ficos malformados e/ou usar uma t√©cnica de fuzzing.

**Leia como** [**aqui**](https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06h-testing-platform-interaction#dynamic-analysis-8)**.**


<details>

<summary><strong>Aprenda hacking no AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras maneiras de apoiar o HackTricks:

* Se voc√™ quer ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**merchandising oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **Junte-se ao grupo** üí¨ [**Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga** me no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe suas dicas de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) no github.

</details>
