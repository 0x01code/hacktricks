# Partage UIActivity

√Ä partir d'iOS 6, il est possible pour les applications tierces de **partager des donn√©es (√©l√©ments)** via des m√©canismes sp√©cifiques [comme AirDrop, par exemple](https://developer.apple.com/library/archive/documentation/iPhone/Conceptual/iPhoneOSProgrammingGuide/Inter-AppCommunication/Inter-AppCommunication.html#//apple\_ref/doc/uid/TP40007072-CH6-SW3). Du point de vue de l'utilisateur, cette fonctionnalit√© est la feuille d'activit√© de partage syst√®me bien connue qui appara√Æt apr√®s avoir cliqu√© sur le bouton "Partager".

Une liste compl√®te des m√©canismes de partage int√©gr√©s disponibles peut √™tre trouv√©e dans [UIActivity.ActivityType](https://developer.apple.com/documentation/uikit/uiactivity/activitytype). Si elle n'est pas consid√©r√©e comme appropri√©e pour l'application, les **d√©veloppeurs ont la possibilit√© d'exclure certains de ces m√©canismes de partage**.

## **Envoi d'√©l√©ments**

Lors du test de partage `UIActivity`, vous devez pr√™ter une attention particuli√®re √† :

* les donn√©es (√©l√©ments) partag√©es,
* les activit√©s personnalis√©es,
* les types d'activit√©s exclus.

Le partage de donn√©es via `UIActivity` fonctionne en cr√©ant un `UIActivityViewController` et en lui passant les √©l√©ments souhait√©s (URL, texte, une image) sur [`init(activityItems:applicationActivities:)`](https://developer.apple.com/documentation/uikit/uiactivityviewcontroller/1622019-init).

Si vous avez le code source, vous devriez jeter un coup d'≈ìil au `UIActivityViewController` :

* Inspectez les activit√©s pass√©es √† la m√©thode `init(activityItems:applicationActivities:)`.
* V√©rifiez s'il d√©finit des activit√©s personnalis√©es (√©galement pass√©es √† la m√©thode pr√©c√©dente).
* V√©rifiez les `excludedActivityTypes`, s'il y en a.

Si vous n'avez que l'application compil√©e/install√©e, essayez de rechercher la m√©thode et la propri√©t√© pr√©c√©dentes, par exemple :
```bash
$ rabin2 -zq Telegram\ X.app/Telegram\ X | grep -i activityItems
0x1000df034 45 44 initWithActivityItems:applicationActivities:
```
## **R√©ception d'√©l√©ments**

Lors de la r√©ception d'√©l√©ments, vous devez v√©rifier :

* si l'application **d√©clare des types de documents personnalis√©s** en regardant dans les **UTI export√©s/import√©s** ("Info" onglet du projet Xcode). La liste de tous les UTI d√©clar√©s par le syst√®me peut √™tre trouv√©e dans la [documentation archiv√©e des d√©veloppeurs Apple](https://developer.apple.com/library/archive/documentation/Miscellaneous/Reference/UTIRef/Articles/System-DeclaredUniformTypeIdentifiers.html#//apple\_ref/doc/uid/TP40009259).
* si l'application sp√©cifie des _**types de documents qu'elle peut ouvrir**_ en regardant dans les **Types de documents** ("Info" onglet du projet Xcode). S'ils sont pr√©sents, ils consistent en un nom et un ou plusieurs UTI qui repr√©sentent le type de donn√©es (par exemple, "public.png" pour les fichiers PNG). iOS utilise cela pour d√©terminer si l'application est √©ligible pour ouvrir un document donn√© (sp√©cifier les UTI export√©s/import√©s ne suffit pas).
* si l'application v√©rifie correctement les donn√©es re√ßues en regardant dans la mise en ≈ìuvre de [`application:openURL:options:`](https://developer.apple.com/documentation/uikit/uiapplicationdelegate/1623112-application?language=objc) (ou sa version obsol√®te [`UIApplicationDelegate application:openURL:sourceApplication:annotation:`](https://developer.apple.com/documentation/uikit/uiapplicationdelegate/1623073-application?language=objc)) dans le d√©l√©gu√© de l'application.

Si vous n'avez pas le code source, vous pouvez toujours regarder dans le fichier `Info.plist` et rechercher :

* `UTExportedTypeDeclarations`/`UTImportedTypeDeclarations` si l'application d√©clare des types de documents personnalis√©s export√©s/import√©s.
* `CFBundleDocumentTypes` pour voir si l'application sp√©cifie des types de documents qu'elle peut ouvrir.

Une explication tr√®s compl√®te sur l'utilisation de ces cl√©s peut √™tre trouv√©e [sur Stackoverflow](https://stackoverflow.com/questions/21937978/what-are-utimportedtypedeclarations-and-utexportedtypedeclarations-used-for-on-i), mais voici un r√©sum√© :

* `UTExportedTypeDeclarations` : Utilisez-les pour d√©finir **vos propres UTI** que votre application veut enseigner au syst√®me sur lequel elle est install√©e. Un **UTI d√©crit une pi√®ce de donn√©es** (_pas n√©cessairement des donn√©es situ√©es √† l'int√©rieur d'un fichier !_) et n√©cessite au moins un **identificateur** (`com.example.MyCoolDataType`). De plus, il peut avoir un **nom** (`My Cool Data Type`), une ou plusieurs **extensions de nom de fichier** (`.myCoolDataType`), un ou plusieurs **types MIME** (`x-application/my-cool-data-type`), un ou plusieurs **types de presse-papiers** (utilis√©s lors du transfert de donn√©es de ce type en utilisant copier-coller), et un ou plusieurs **types de syst√®me d'exploitation h√©rit√©s**. Habituellement, vous voulez √©galement que les UTI se conforment aux UTI existants (par exemple, lorsque vous dites que votre UTI se conforme √† `public.data`, tout processus qui peut traiter des donn√©es g√©n√©riques peut √©galement traiter votre UTI).
  * par exemple : Vous d√©finissez votre propre format de donn√©es de fichier propri√©taire et vous voulez que ce format de donn√©es soit √©galement connu des autres applications, plugins, extensions, etc.
* `UTImportedTypeDeclarations` : Vous utilisez `UTImportedTypeDeclarations` pour **enseigner au syst√®me des UTI que vous voulez qu'il connaisse dans le syst√®me mais qui ne sont pas vos UTI**.
  * par exemple : Votre application est capable de lire le format de donn√©es propri√©taire d'une autre application, mais vous ne savez pas si cette application est m√™me install√©e sur le syst√®me.
* `CFBundleDocumentTypes` : Vous utilisez `CFBundleDocumentTypes` pour indiquer au syst√®me les types de documents que votre application est capable d'ouvrir. √Ä moins que vous **ne listiez √©galement vos UTI ici**, ces UTI ne sont pas associ√©s √† votre application dans Finder et votre application n'appara√Ætra pas dans le menu `Ouvrir avec >`. \
La seule chose que vous devez toujours d√©finir pour un type de document est le r√¥le. Le **r√¥le** peut √™tre "**Viewer**" (vous pouvez afficher ce type de fichier mais vous ne pouvez pas l'√©diter), "**Editor**" (vous pouvez afficher et √©diter ce type de fichier), "**None**" (il n'est pas sp√©cifi√© ce que vous pouvez faire avec ce fichier).
  * par exemple : Vous voulez que votre **application soit associ√©e √† certains types de fichiers**, identifi√©s soit par extension, par type MIME, soit par identificateur UTI. **Si vous voulez que votre application soit associ√©e √† un type UTI, l'application doit soit importer, soit exporter le type**, sinon le type peut ne pas √™tre connu du syst√®me et l'enregistrement d'un type UTI inconnu n'a tout simplement aucun effet du tout.

## Test dynamique

Pour **envoyer des activit√©s**, vous pouvez :

* Accrocher la m√©thode que nous avons vue dans l'analyse statique ([`init(activityItems:applicationActivities:)`](https://developer.apple.com/documentation/uikit/uiactivityviewcontroller/1622019-init)) pour obtenir les `activityItems` et les `applicationActivities`.
* D√©couvrir les activit√©s exclues en accrochant la propri√©t√© [`excludedActivityTypes`](https://developer.apple.com/documentation/uikit/uiactivityviewcontroller/1622009-excludedactivitytypes).

Pour recevoir des √©l√©ments, vous pouvez :

* _Partager_ un fichier avec l'application depuis une autre application ou l'envoyer via AirDrop ou e-mail. Choisissez le fichier de sorte qu'il d√©clenche le dialogue "Ouvrir avec..." (c'est-√†-dire qu'il n'y a pas d'application par d√©faut qui ouvrira le fichier, un PDF par exemple).
* Accrocher `application:openURL:options:` et toutes les autres m√©thodes qui ont √©t√© identifi√©es dans une analyse statique pr√©c√©dente.
* Observer le comportement de l'application.
* En outre, vous pourriez envoyer des fichiers sp√©cifiques mal form√©s et/ou utiliser une technique de fuzzing.

**Lisez comment** [**ici**](https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06h-testing-platform-interaction#dynamic-analysis-8)**.**


<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

- Travaillez-vous dans une **entreprise de cybers√©curit√©** ? Voulez-vous voir votre **entreprise annonc√©e dans HackTricks** ? ou voulez-vous avoir acc√®s √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !

- D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)

- Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)

- **Rejoignez le** [**üí¨**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**

- **Partagez vos astuces de piratage en soumettant des PR au [repo hacktricks](https://github.com/carlospolop/hacktricks) et au [repo hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>
