# Compartir UIActivity de iOS

<details>

<summary><strong>Aprende a hackear AWS desde cero hasta convertirte en un experto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si deseas ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** Consulta los [**PLANES DE SUSCRIPCIÓN**](https://github.com/sponsors/carlospolop)!
* Obtén la [**oficial mercancía de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colección exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Únete al** 💬 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **sígueme** en **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

# Compartir UIActivity Simplificado

Desde iOS 6 en adelante, las aplicaciones de terceros han podido **compartir datos** como texto, URLs o imágenes utilizando mecanismos como AirDrop, como se describe en la [guía de Comunicación entre Aplicaciones de Apple](https://developer.apple.com/library/archive/documentation/iPhone/Conceptual/iPhoneOSProgrammingGuide/Inter-AppCommunication/Inter-AppCommunication.html#//apple_ref/doc/uid/TP40007072-CH6-SW3). Esta función se manifiesta a través de una _hoja de actividad de compartir_ a nivel del sistema que aparece al interactuar con el botón "Compartir".

Una enumeración completa de todas las opciones de compartir integradas está disponible en [UIActivity.ActivityType](https://developer.apple.com/documentation/uikit/uiactivity/activitytype). Los desarrolladores pueden optar por excluir opciones de compartir específicas si las consideran inadecuadas para su aplicación.

## **Cómo Compartir Datos**

La atención debe dirigirse a:

- La naturaleza de los datos que se comparten.
- La inclusión de actividades personalizadas.
- La exclusión de ciertos tipos de actividades.

El compartir se facilita mediante la instanciación de un `UIActivityViewController`, al cual se le pasan los elementos destinados a compartir. Esto se logra llamando a:
```bash
$ rabin2 -zq Telegram\ X.app/Telegram\ X | grep -i activityItems
0x1000df034 45 44 initWithActivityItems:applicationActivities:
```
Los desarrolladores deben examinar el `UIActivityViewController` para las actividades y actividades personalizadas con las que se inicializa, así como cualquier `excludedActivityTypes` especificado.

## **Cómo recibir datos**

Los siguientes aspectos son cruciales al recibir datos:

- La declaración de **tipos de documento personalizados**.
- La especificación de **tipos de documento que la aplicación puede abrir**.
- La verificación de la **integridad de los datos recibidos**.

Sin acceso al código fuente, aún se puede inspeccionar el `Info.plist` en busca de claves como `UTExportedTypeDeclarations`, `UTImportedTypeDeclarations` y `CFBundleDocumentTypes` para comprender los tipos de documentos que una aplicación puede manejar y declarar.

Una guía concisa sobre estas claves está disponible en [Stackoverflow](https://stackoverflow.com/questions/21937978/what-are-utimportedtypedeclarations-and-utexportedtypedeclarations-used-for-on-i), resaltando la importancia de definir e importar UTIs para el reconocimiento a nivel del sistema y asociar tipos de documentos con su aplicación para la integración en el diálogo "Abrir con".

## Enfoque de prueba dinámica

Para probar **actividades de envío**, se podría:

- Engancharse en el método `init(activityItems:applicationActivities:)` para capturar los elementos y actividades compartidos.
- Identificar actividades excluidas interceptando la propiedad `excludedActivityTypes`.

Para **recibir elementos**, implica:

- Compartir un archivo con la aplicación desde otra fuente (por ejemplo, AirDrop, correo electrónico) que solicite el diálogo "Abrir con...".
- Enganchar `application:openURL:options:` entre otros métodos identificados durante el análisis estático para observar la respuesta de la aplicación.
- Emplear archivos malformados o técnicas de fuzzing para evaluar la solidez de la aplicación.

## Referencias
* [https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06h-testing-platform-interaction](https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06h-testing-platform-interaction)

<details>

<summary><strong>Aprende a hackear AWS de cero a héroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si deseas ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** ¡Consulta los [**PLANES DE SUSCRIPCIÓN**](https://github.com/sponsors/carlospolop)!
* Obtén la [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colección exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Únete al** 💬 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **sígueme** en **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
