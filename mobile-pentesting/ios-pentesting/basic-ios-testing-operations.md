# Operaciones B√°sicas de Pruebas en iOS

<details>

<summary><strong>Aprende a hackear AWS de cero a h√©roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver a tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** revisa los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Consigue el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **sigue** a **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de GitHub** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Obtener el UDID de un dispositivo iOS

{% hint style="info" %}
Realiza estas acciones teniendo el dispositivo **conectado** al ordenador v√≠a **USB** y con el **dispositivo** **desbloqueado**.
{% endhint %}

El UDID es una secuencia √∫nica de 40 d√≠gitos de letras y n√∫meros para identificar un dispositivo iOS. Puedes encontrar el UDID de tu dispositivo iOS en macOS Catalina en adelante en la **aplicaci√≥n Finder**, ya que iTunes ya no est√° disponible en Catalina. Simplemente selecciona el dispositivo iOS conectado en Finder y **haz clic en la informaci√≥n debajo del nombre del dispositivo iOS** para iterar a trav√©s de ella. Adem√°s del UDID, puedes encontrar el n√∫mero de serie, IMEI y otra informaci√≥n √∫til.

![](<../../.gitbook/assets/image (471).png>)

Si est√°s utilizando una versi√≥n de macOS anterior a Catalina, puedes encontrar el [UDID de tu dispositivo iOS a trav√©s de iTunes](http://www.iclarified.com/52179/how-to-find-your-iphones-udid), seleccionando tu dispositivo y haciendo clic en "N√∫mero de serie" en la pesta√±a de resumen. Al hacer clic en esto iterar√°s a trav√©s de diferentes metadatos del dispositivo iOS incluyendo su UDID.

Tambi√©n es posible obtener el UDID a trav√©s de varias herramientas de l√≠nea de comandos en macOS mientras el dispositivo est√° conectado v√≠a USB:

*   Utilizando la herramienta [I/O Registry Explorer](https://developer.apple.com/library/archive/documentation/DeviceDrivers/Conceptual/IOKitFundamentals/TheRegistry/TheRegistry.html) `ioreg`:

```bash
$ ioreg -p IOUSB -l | grep "USB Serial"
|         "USB Serial Number" = "9e8ada44246cee813e2f8c1407520bf2f84849ec"
```
*   Utilizando [ideviceinstaller](https://github.com/libimobiledevice/ideviceinstaller) (tambi√©n disponible en Linux):

```bash
$ brew install ideviceinstaller
$ idevice_id -l
316f01bd160932d2bf2f95f1f142bc29b1c62dbc
```
*   Utilizando system\_profiler:

```bash
$ system_profiler SPUSBDataType | sed -n -e '/iPad/,/Serial/p;/iPhone/,/Serial/p;/iPod/,/Serial/p' | grep "Serial Number:"
2019-09-08 10:18:03.920 system_profiler[13251:1050356] SPUSBDevice: IOCreatePlugInInterfaceForService failed 0xe00002be
Serial Number: 64655621de6ef5e56a874d63f1e1bdd14f7103b1
```
*   Utilizando instruments:

```bash
$ instruments -s devices
```

## Accediendo a la Shell del Dispositivo

Despu√©s de hacer jailbreak al dispositivo deber√≠as haber instalado alg√∫n nuevo gestor de aplicaciones como **Cydia**.

### SSH

Para habilitar el acceso SSH a tu dispositivo iOS puedes instalar el **paquete OpenSSH**. Una vez instalado, puedes acceder a tu dispositivo v√≠a ssh ejecutando `ssh root@<direcci√≥n_ip_del_dispositivo>`, lo que te permitir√° iniciar sesi√≥n como usuario root:
```bash
$ ssh root@192.168.197.234
root@192.168.197.234's password:
iPhone:~ root#
```
Al acceder a tu dispositivo iOS v√≠a SSH, considera lo siguiente:

* Los **usuarios predeterminados son `root` y `mobile`**.
* La **contrase√±a** predeterminada para ambos es **`alpine`**.

> Recuerda cambiar la contrase√±a predeterminada para ambos usuarios `root` y `mobile`, ya que cualquiera en la misma red puede encontrar la direcci√≥n IP de tu dispositivo y conectarse a trav√©s de la conocida contrase√±a predeterminada, lo que les dar√° acceso root a tu dispositivo.

### **Conectar a un Dispositivo v√≠a SSH sobre USB**

Durante una prueba de caja negra real, puede que no haya una conexi√≥n Wi-Fi confiable disponible. En esta situaci√≥n, puedes usar usbmuxd para conectarte al servidor SSH de tu dispositivo a trav√©s de USB.

Conecta macOS a un dispositivo iOS instalando e iniciando iproxy:
```bash
$ brew install libimobiledevice
$ iproxy 2222 22
waiting for connection
```
El comando anterior mapea el puerto `22` en el dispositivo iOS al puerto `2222` en localhost. Tambi√©n puedes [hacer que iproxy se ejecute autom√°ticamente en segundo plano](https://iphonedevwiki.net/index.php/SSH\_Over\_USB) si no quieres ejecutar el binario cada vez que quieras usar SSH a trav√©s de USB.

Con el siguiente comando en una nueva ventana de terminal, puedes conectarte al dispositivo:
```bash
$ ssh -p 2222 root@localhost
root@localhost's password:
iPhone:~ root#
```
> Peque√±a nota sobre el USB de un iDevice: en un dispositivo iOS no se pueden realizar conexiones de datos despu√©s de 1 hora de estar en estado bloqueado, a menos que lo desbloquees nuevamente debido al Modo Restringido de USB, que se introdujo con iOS 11.4.1

### Aplicaci√≥n Shell en el Dispositivo

Aunque generalmente usar una **shell en el dispositivo** (emulador de terminal) puede ser muy tedioso en comparaci√≥n con una shell remota, puede ser √∫til para depuraci√≥n en caso de, por ejemplo, problemas de red o para verificar alguna configuraci√≥n. Por ejemplo, puedes instalar [NewTerm 2](https://repo.chariz.io/package/ws.hbang.newterm2/) a trav√©s de Cydia para este prop√≥sito (es compatible con iOS 6.0 hasta 12.1.2 en el momento de escribir esto).

Adem√°s, hay algunos jailbreaks que expl√≠citamente desactivan el SSH entrante _por razones de seguridad_. En esos casos, es muy conveniente tener una aplicaci√≥n shell en el dispositivo, que puedes usar para primero realizar un SSH fuera del dispositivo con un shell inverso, y luego conectar desde tu computadora anfitriona a √©l.

Abrir un shell inverso a trav√©s de SSH se puede hacer ejecutando el comando `ssh -R <remote_port>:localhost:22 <username>@<host_computer_ip>`.

En la aplicaci√≥n shell en el dispositivo ejecuta el siguiente comando y, cuando se te pida, introduce la contrase√±a del usuario `mstg` de la computadora anfitriona:
```bash
ssh -R 2222:localhost:22 mstg@192.168.197.235
```
En tu computadora anfitriona ejecuta el siguiente comando y, cuando se te pida, ingresa la contrase√±a del usuario `root` del dispositivo iOS:
```bash
$ ssh -p 2222 root@localhost
```
### **Contrase√±a Olvidada**

Si olvidas tu contrase√±a y quieres restablecerla al valor predeterminado **`alpine`**:

1. Edita el archivo `/private/etc/master.passwd` en tu dispositivo iOS con jailbreak utilizando un **terminal** en el dispositivo o aplicaciones como **Filza** o **iFile**
2. Encuentra las l√≠neas:

```bash
root:xxxxxxxxx:0:0::0:0:Administrador del Sistema:/var/root:/bin/sh
mobile:xxxxxxxxx:501:501::0:0:Usuario M√≥vil:/var/mobile:/bin/sh
```
3. Cambia `xxxxxxxxx` por `/smx7MYTQIi2M` (que es la contrase√±a hasheada `alpine`)
4. Guarda y sal de la edici√≥n

## Transferencia de Datos

### Copiando Archivos de Datos de Aplicaciones v√≠a SSH y SCP

Como sabemos ahora, los archivos de nuestra aplicaci√≥n se almacenan en el directorio de Datos. Ahora puedes simplemente archivar el directorio de Datos con `tar` y extraerlo del dispositivo con `scp`:
```bash
iPhone:~ root# tar czvf /tmp/data.tgz /private/var/mobile/Containers/Data/Application/8C8E7EB0-BC9B-435B-8EF8-8F5560EB0693
iPhone:~ root# exit
$ scp -P 2222 root@localhost:/tmp/data.tgz .
```
### Usando iFunbox

[**iFunbox**](https://www.i-funbox.com/en/page-download.html) es una aplicaci√≥n con interfaz gr√°fica que puede usarse para varias cosas (entre ellas subir y descargar archivos).\
Otra herramienta con interfaz gr√°fica para este prop√≥sito es [**iExplorer**](https://macroplant.com/iexplorer).

{% hint style="info" %}
A partir de la versi√≥n 8.4 de iOS, Apple ha **restringido el acceso de los gestores de terceros al sandbox de las aplicaciones**, por lo que herramientas como iFunbox e iExplorer ya no muestran ni recuperan archivos de las aplicaciones instaladas en el dispositivo si este no est√° jailbroken.
{% endhint %}

### Usando Objection

Cuando inicias objection (`objection --gadget com.apple.mobilesafari explorer`), encontrar√°s el prompt dentro del directorio Bundle.
```bash
org.owasp.MSTG on (iPhone: 10.3.3) [usb] # pwd print
Current directory: /var/containers/Bundle/Application/DABF849D-493E-464C-B66B-B8B6C53A4E76/org.owasp.MSTG.app
```
Utiliza el comando `env` para obtener los directorios de la app y navega al directorio Documents.
```bash
org.owasp.MSTG on (iPhone: 10.3.3) [usb] # cd /var/mobile/Containers/Data/Application/72C7AAFB-1D75-4FBA-9D83-D8B4A2D44133/Documents
/var/mobile/Containers/Data/Application/72C7AAFB-1D75-4FBA-9D83-D8B4A2D44133/Documents
```
Con el comando `file download <filename>` puedes descargar un archivo del dispositivo iOS a tu computadora anfitriona y analizarlo posteriormente.
```bash
org.owasp.MSTG on (iPhone: 10.3.3) [usb] # file download .com.apple.mobile_container_manager.metadata.plist
Downloading /var/mobile/Containers/Data/Application/72C7AAFB-1D75-4FBA-9D83-D8B4A2D44133/.com.apple.mobile_container_manager.metadata.plist to .com.apple.mobile_container_manager.metadata.plist
Streaming file from device...
Writing bytes to destination...
Successfully downloaded /var/mobile/Containers/Data/Application/72C7AAFB-1D75-4FBA-9D83-D8B4A2D44133/.com.apple.mobile_container_manager.metadata.plist to .com.apple.mobile_container_manager.metadata.plist
```
Tambi√©n puedes subir archivos al dispositivo iOS con `file upload <local_file_path>`.

## Obtenci√≥n y Extracci√≥n de Aplicaciones

### Obtener el Archivo IPA de un Enlace de Distribuci√≥n OTA

Durante el desarrollo, a veces se proporcionan aplicaciones a los probadores a trav√©s de la distribuci√≥n over-the-air (OTA). En esa situaci√≥n, recibir√°s un enlace de itms-services, como el siguiente:
```
itms-services://?action=download-manifest&url=https://s3-ap-southeast-1.amazonaws.com/test-uat/manifest.plist
```
Puedes usar la herramienta [ITMS services asset downloader](https://www.npmjs.com/package/itms-services) para descargar el IPA de una URL de distribuci√≥n OTA. Inst√°lalo a trav√©s de npm:
```bash
$ npm install -g itms-services
```
Guarde el archivo IPA localmente con el siguiente comando:
```bash
# itms-services -u "itms-services://?action=download-manifest&url=https://s3-ap-southeast-1.amazonaws.com/test-uat/manifest.plist" -o - > out.ipa
```
### Adquisici√≥n del Binario de la App

1. **Desde un IPA**:

Si tienes el IPA (probablemente incluyendo un binario de la app ya desencriptado), descompr√≠melo y estar√°s listo para continuar. El binario de la app se encuentra en el directorio principal del paquete (.app), por ejemplo, `Payload/Telegram X.app/Telegram X`. Consulta la siguiente subsecci√≥n para obtener detalles sobre la extracci√≥n de las listas de propiedades.

> En el Finder de macOS, los directorios .app se abren haciendo clic derecho y seleccionando "Mostrar contenido del paquete". En la terminal, puedes simplemente usar `cd` para entrar en ellos.
2. Desde un **dispositivo con Jailbreak**:

Si no tienes el IPA original, entonces necesitas un dispositivo con jailbreak donde **instalar√°s la app** (por ejemplo, a trav√©s de App Store). Una vez instalada, necesitas **extraer el binario de la app de la memoria y reconstruir el archivo IPA**. Debido a DRM, el archivo binario de la app est√° encriptado cuando se almacena en el dispositivo iOS, por lo que simplemente extraerlo del Bundle (ya sea a trav√©s de SSH u Objection) no ser√° suficiente para ingenier√≠a inversa (lee la siguiente secci√≥n).

### Desencriptaci√≥n (Manual)

A diferencia de una Aplicaci√≥n Android, el binario de una app iOS **solo puede ser desensamblado** y no decompilado.\
Cuando una aplicaci√≥n se env√≠a a la app store, Apple primero verifica la conducta de la app y antes de lanzarla a la app-store, **Apple encripta el binario usando** [**FairPlay**](https://developer.apple.com/streaming/fps/). As√≠ que el binario descargado de la app store est√° encriptado complicando las tareas de ingenier√≠a inversa.

Sin embargo, ten en cuenta que hay otros **software de terceros que se pueden usar para ofuscar** los binarios resultantes.

Para ejecutar el binario encriptado, el dispositivo necesita desencriptarlo en memoria. Entonces, es posible **volcar el binario desencriptado de la memoria**.

Primero, verifica si el binario est√° compilado con la bandera PIE (C√≥digo Independiente de la Posici√≥n):
```bash
otool -Vh Original_App #Check the last word of the last line of this code
Home:
Mach header
magic  cputype cpusubtype  caps    filetype ncmds sizeofcmds      flags
MH_MAGIC_64   X86_64        ALL  0x00     EXECUTE    47       6080   NOUNDEFS DYLDLINK TWOLEVEL PIE
```
Si est√° configurado, puedes usar el script [`change_macho_flags.py`](https://chromium.googlesource.com/chromium/src/+/49.0.2623.110/build/mac/change\_mach\_o\_flags.py) para eliminarlo con python2:
```bash
python change_mach_o_flags.py --no-pie Original_App
otool -Vh Hello_World
Hello_World:
Mach header
magic  cputype cpusubtype  caps    filetype ncmds sizeofcmds      flags
MH_MAGIC      ARM         V7  0x00     EXECUTE    22       2356   NOUNDEFS DYLDLINK TWOLEVEL MH_NO_HEAP_EXECUTION
```
Ahora que la bandera PIE no est√° establecida, el sistema operativo cargar√° el programa en una **ubicaci√≥n de inicio fija** cada vez. Para encontrar esta **ubicaci√≥n** puedes usar:
```bash
otool -l Original_App | grep -A 3 LC_SEGMENT | grep -A 1 __TEXT
segname __TEXT
vmaddr 0x00004000
```
Entonces, es necesario extraer el rango de memoria que necesita ser volcado:
```bash
otool -l Original_App | grep -A 4 LC_ENCRYPTION_INFO
cmd LC_ENCRYPTION_INFO
cmdsize 20
cryptoff 16384
cryptsize 17416192
cryptid 0
```
El valor de **`cryptoff`** indica la direcci√≥n inicial del contenido cifrado y **`cryptsize`** indica el tama√±o del contenido cifrado.

Por lo tanto, la `direcci√≥n de inicio` para volcar ser√° `vmaddr + cryptoff` y la `direcci√≥n final` ser√° `direcci√≥n de inicio + cryptsize`\
En este caso: `start_address = 0x4000 + 0x4000 = 0x8000` \_\_ y `end_address = 0x8000 + 0x109c000 = 0x10a4000`

Con esta informaci√≥n, solo es necesario ejecutar la aplicaci√≥n en el dispositivo con jailbreak, adjuntarse al proceso con gdb (`gdb -p <pid>`) y volcar la memoria:
```bash
dump memory dump.bin 0x8000 0x10a4000
```
¬°Felicidades! Has descifrado la secci√≥n encriptada en dump.bin. Ahora **transfiere este volcado a tu computadora y sobrescribe la secci√≥n encriptada con la descifrada**:
```bash
dd bs=1 seek=<starting_address> conv=notrunc if=dump.bin of=Original_App
```
Hay un paso m√°s por completar. La aplicaci√≥n todav√≠a **indica** en sus metadatos que est√° **encriptada**, pero **no lo est√°**. Entonces, al ejecutarse, el dispositivo intentar√° desencriptar la secci√≥n ya desencriptada y fallar√°.
Sin embargo, puedes usar herramientas como [**MachOView**](https://sourceforge.net/projects/machoview/) para cambiar esta informaci√≥n. Solo abre el binario y establece el **cryptid** en 0:

![](<../../.gitbook/assets/image (470).png>)

### Descifrado (Autom√°tico)

#### frida-ios-dump

Puedes usar herramientas como [**frida-ios-dump**](https://github.com/AloneMonkey/frida-ios-dump) para **eliminar autom√°ticamente la encriptaci√≥n de una app**.

Primero, aseg√∫rate de que la configuraci√≥n en **Frida-ios-dump** `dump.py` est√© establecida en localhost con el puerto 2222 cuando uses **iproxy**, o en la direcci√≥n IP real y puerto del dispositivo desde el cual quieres volcar el binario.

Ahora puedes usar la herramienta de forma segura para **enumerar** las **aplicaciones** **instaladas**:
```bash
$ python dump.py -l
PID  Name             Identifier
----  ---------------  -------------------------------------
860  Cydia            com.saurik.Cydia
1130  Settings         com.apple.Preferences
685  Mail             com.apple.mobilemail
834  Telegram         ph.telegra.Telegraph
-  Stocks           com.apple.stocks
...
```
y puedes **volcar** **uno** de los binarios listados:
```bash
$ python3 dump.py -u "root" -p "<PASSWORD>" ph.telegra.Telegraph

Start the target app ph.telegra.Telegraph
Dumping Telegram to /var/folders/qw/gz47_8_n6xx1c_lwq7pq5k040000gn/T
[frida-ios-dump]: HockeySDK.framework has been loaded.
[frida-ios-dump]: Load Postbox.framework success.
[frida-ios-dump]: libswiftContacts.dylib has been dlopen.
...
start dump /private/var/containers/Bundle/Application/14002D30-B113-4FDF-BD25-1BF740383149/Telegram.app/Frameworks/libswiftsimd.dylib
libswiftsimd.dylib.fid: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 343k/343k [00:00<00:00, 1.54MB/s]
start dump /private/var/containers/Bundle/Application/14002D30-B113-4FDF-BD25-1BF740383149/Telegram.app/Frameworks/libswiftCoreData.dylib
libswiftCoreData.dylib.fid: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 82.5k/82.5k [00:00<00:00, 477kB/s]
5.m4a: 80.9MB [00:14, 5.85MB/s]
0.00B [00:00, ?B/s]Generating "Telegram.ipa"
```
Despu√©s de esto, se crear√° el archivo `Telegram.ipa` en tu directorio actual. Puedes validar el √©xito del volcado eliminando la aplicaci√≥n y reinstal√°ndola (por ejemplo, usando [**ios-deploy**](https://github.com/ios-control/ios-deploy) `ios-deploy -b Telegram.ipa`). Ten en cuenta que esto solo funcionar√° en dispositivos con jailbreak, ya que de lo contrario la firma no ser√° v√°lida.

#### flexdecrypt

Para **obtener el archivo ipa** de una aplicaci√≥n instalada tambi√©n puedes usar la herramienta [**flexdecrypt**](https://github.com/JohnCoates/flexdecrypt) o un envoltorio de la herramienta llamado [**flexdump**](https://gist.github.com/defparam/71d67ee738341559c35c684d659d40ac)**.**\
En cualquier caso, necesitar√°s **instalar flexdecrypt en el dispositivo** ejecutando algo como:
```markup
wget https://github.com/JohnCoates/flexdecrypt/releases/download/1.1/flexdecrypt.deb
dpkg -i flexdecrypt.deb
rm flexdecrypt.deb
```
y para usar **flexdump**:
```bash
apt install zip unzip
wget https://gist.githubusercontent.com/defparam/71d67ee738341559c35c684d659d40ac/raw/30c7612262f1faf7871ba8e32fbe29c0f3ef9e27/flexdump -P /usr/local/bin; chmod +x /usr/local/bin/flexdump
flexdump list #List apps
flexdump dump Twitter.app #Create .ipa file from app
```
#### bagbak

Otro descifrador de aplicaciones basado en frida. Requiere dispositivo iOS con jailbreak y [frida.re](https://www.frida.re/)
```bash
bagbak --raw Chrome
```
#### r2flutch

[**r2flutch**](https://github.com/as0ler/r2flutch) es una herramienta que utiliza **radare** y **frida** para **descifrar** y **volcar aplicaciones de iOS**.

Consulta el **github** para m√°s informaci√≥n.

## Instalaci√≥n de Aplicaciones

Cuando instalas una aplicaci√≥n sin usar la App Store de Apple, esto se llama **sideloading**. Hay varias formas de sideloading que se describen a continuaci√≥n. En el dispositivo iOS, el proceso de instalaci√≥n real es manejado por el **daemon installd**, que **desempaquetar√°** e **instalar√°** la aplicaci√≥n. Para integrar servicios de aplicaciones o ser instaladas en un dispositivo iOS, todas las **aplicaciones deben estar firmadas con un certificado emitido por Apple**. Esto significa que la aplicaci√≥n solo puede ser instalada despu√©s de una verificaci√≥n exitosa de la firma de c√≥digo. Sin embargo, en un tel√©fono con jailbreak, puedes **eludir esta caracter√≠stica de seguridad con** [**AppSync**](http://repo.hackyouriphone.org/appsyncunified), un paquete disponible en la tienda Cydia. Contiene numerosas aplicaciones √∫tiles que aprovechan los privilegios de root proporcionados por el jailbreak para ejecutar funcionalidades avanzadas. **AppSync es un tweak que parchea installd**, permitiendo la instalaci√≥n de paquetes IPA con firma falsa.

Existen diferentes m√©todos para instalar un paquete IPA en un dispositivo iOS, que se describen en detalle a continuaci√≥n.

> Ten en cuenta que iTunes ya no est√° disponible en macOS Catalina. Si est√°s utilizando una versi√≥n anterior de macOS, iTunes sigue disponible pero desde iTunes 12.7 no es posible instalar aplicaciones.

#### Cydia Impactor

[Cydia Impactor](http://www.cydiaimpactor.com) fue originalmente creado para hacer jailbreak a iPhones, pero ha sido reescrito para firmar e instalar paquetes IPA en dispositivos iOS a trav√©s de sideloading (e incluso archivos APK en dispositivos Android). Cydia Impactor est√° disponible para Windows, macOS y Linux. Una [gu√≠a paso a paso y pasos para la resoluci√≥n de problemas est√°n disponibles en yalujailbreak.net](https://yalujailbreak.net/how-to-use-cydia-impactor/).

#### libimobiledevice

En Linux y tambi√©n en macOS, alternativamente puedes usar [libimobiledevice](https://www.libimobiledevice.org), una biblioteca de protocolo de software multiplataforma y un conjunto de herramientas para la comunicaci√≥n nativa con dispositivos iOS. Esto te permite instalar aplicaciones a trav√©s de una conexi√≥n USB ejecutando ideviceinstaller. La conexi√≥n se implementa con el daemon de multiplexaci√≥n USB [usbmuxd](https://www.theiphonewiki.com/wiki/Usbmux), que proporciona un t√∫nel TCP sobre USB.

El paquete para libimobiledevice estar√° disponible en tu gestor de paquetes de Linux. En macOS puedes instalar libimobiledevice a trav√©s de brew:
```bash
$ brew install libimobiledevice
$ brew install ideviceinstaller
```
Despu√©s de la instalaci√≥n, tienes varias nuevas herramientas de l√≠nea de comandos disponibles, como `ideviceinfo`, `ideviceinstaller` o `idevicedebug`.
```bash
# The following command will show detailed information about the iOS device connected via USB.
$ ideviceinfo
# The following command will install the IPA to your iOS device.
$ ideviceinstaller -i iGoat-Swift_v1.0-frida-codesigned.ipa
...
Install: Complete
# The following command will start the app in debug mode, by providing the bundle name. The bundle name can be found in the previous command after "Installing".
$ idevicedebug -d run OWASP.iGoat-Swift
```
#### ipainstaller

El IPA tambi√©n puede ser instalado directamente en el dispositivo iOS a trav√©s de la l√≠nea de comandos con [ipainstaller](https://github.com/autopear/ipainstaller). Despu√©s de copiar el archivo en el dispositivo, por ejemplo mediante scp, puedes ejecutar ipainstaller con el nombre del archivo IPA:
```bash
$ ipainstaller App_name.ipa
```
#### ios-deploy

En macOS tambi√©n puedes usar la herramienta **ios-deploy** para instalar aplicaciones de iOS desde la l√≠nea de comandos. Necesitar√°s descomprimir tu IPA ya que ios-deploy utiliza los paquetes de aplicaciones para instalar aplicaciones.
```bash
$ unzip Name.ipa
$ ios-deploy --bundle 'Payload/Name.app' -W -d -v
```
Despu√©s de que la app est√© instalada en el dispositivo iOS, puedes simplemente iniciarla a√±adiendo la bandera `-m` la cual iniciar√° directamente la depuraci√≥n sin instalar la app de nuevo.
```bash
$ ios-deploy --bundle 'Payload/Name.app' -W -d -v -m
```
#### Xcode

Tambi√©n es posible usar el IDE de Xcode para instalar aplicaciones iOS siguiendo estos pasos:

1. Iniciar Xcode
2. Seleccionar **Window/Devices and Simulators**
3. Seleccionar el dispositivo iOS conectado y hacer clic en el signo **+** en **Installed Apps**.

#### Permitir la instalaci√≥n de aplicaciones en un dispositivo que no es iPad

A veces, una aplicaci√≥n puede requerir ser utilizada en un dispositivo iPad. Si solo tienes dispositivos iPhone o iPod touch, entonces puedes forzar a la aplicaci√≥n a aceptar ser instalada y utilizada en estos tipos de dispositivos. Puedes hacer esto cambiando el valor de la propiedad **UIDeviceFamily** al valor **1** en el archivo **Info.plist**.
```markup
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>

<key>UIDeviceFamily</key>
<array>
<integer>1</integer>
</array>

</dict>
</plist>
```
Es importante se√±alar que cambiar este valor romper√° la firma original del archivo IPA, por lo que necesitar√°s volver a firmar el IPA, despu√©s de la actualizaci√≥n, para poder instalarlo en un dispositivo en el que no se haya desactivado la validaci√≥n de la firma.

Este bypass podr√≠a no funcionar si la aplicaci√≥n requiere capacidades espec√≠ficas de iPads modernos mientras que tu iPhone o iPod es un poco m√°s antiguo.

Los posibles valores para la propiedad [UIDeviceFamily](https://developer.apple.com/library/archive/documentation/General/Reference/InfoPlistKeyReference/Articles/iPhoneOSKeys.html#//apple_ref/doc/uid/TP40009252-SW11) se pueden encontrar en la documentaci√≥n de Apple Developer.

<details>

<summary><strong>Aprende hacking en AWS de cero a h√©roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Consigue el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **sigue** a **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de github de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
