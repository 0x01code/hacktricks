# iOS Grundlegende Testoperationen

<details>

<summary><strong>Lernen Sie AWS-Hacking von Null auf Held mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks bewerben m√∂chten** oder **HackTricks als PDF herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merchandise**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) Github-Repositories senden.

</details>

## **Zusammenfassung der Identifizierung und des Zugriffs auf iOS-Ger√§te**

### **Ermitteln der UDID eines iOS-Ger√§ts**

Um ein iOS-Ger√§t eindeutig zu identifizieren, wird eine 40-stellige Sequenz namens UDID verwendet. Unter macOS Catalina oder neuer kann dies in der **Finder-App** gefunden werden, da iTunes nicht mehr vorhanden ist. Das Ger√§t zeigt seine UDID zusammen mit anderen Informationen an, wenn die Details unter seinem Namen angeklickt werden, nachdem es √ºber USB verbunden und im Finder ausgew√§hlt wurde.

F√ºr Versionen von macOS vor Catalina erm√∂glicht iTunes die Ermittlung der UDID. Detaillierte Anweisungen finden Sie [hier](http://www.iclarified.com/52179/how-to-find-your-iphones-udid).

Befehlszeilentools bieten alternative Methoden zum Abrufen der UDID an:

* **Verwendung des I/O Registry Explorer-Tools `ioreg`:**
```bash
$ ioreg -p IOUSB -l | grep "USB Serial"
```
* **Verwendung von `ideviceinstaller` f√ºr macOS (und Linux):**
```bash
$ brew install ideviceinstaller
$ idevice_id -l
```
* **Verwendung von `system_profiler`:**
```bash
$ system_profiler SPUSBDataType | sed -n -e '/iPad/,/Serial/p;/iPhone/,/Serial/p;/iPod/,/Serial/p' | grep "Serial Number:"
```
* **Verwendung von `instruments`, um Ger√§te aufzulisten:**
```bash
$ instruments -s devices
```
### **Zugriff auf die Ger√§teshell**

Der **SSH-Zugriff** wird durch die Installation des **OpenSSH-Pakets** nach dem Jailbreak aktiviert, was Verbindungen √ºber `ssh root@<Ger√§te_IP-Adresse>` erm√∂glicht. Es ist wichtig, die Standardpassw√∂rter (`alpine`) f√ºr die Benutzer `root` und `mobile` zu √§ndern, um das Ger√§t abzusichern.

**SSH √ºber USB** wird erforderlich, wenn kein WLAN verf√ºgbar ist. Hierbei wird `iproxy` verwendet, um die Ger√§teports f√ºr SSH-Verbindungen zu mappen. Diese Konfiguration erm√∂glicht den SSH-Zugriff √ºber USB, indem folgender Befehl ausgef√ºhrt wird:
```bash
$ iproxy 2222 22
$ ssh -p 2222 root@localhost
```
**On-Device-Shell-Anwendungen**, wie NewTerm 2, erleichtern die direkte Ger√§teinteraktion und sind besonders n√ºtzlich f√ºr Fehlerbehebung. **Reverse SSH-Shells** k√∂nnen auch f√ºr den Remote-Zugriff vom Host-Computer aus eingerichtet werden.

### **Zur√ºcksetzen vergessener Passw√∂rter**

Um ein vergessenes Passwort auf den Standardwert (`alpine`) zur√ºckzusetzen, ist es erforderlich, die Datei `/private/etc/master.passwd` zu bearbeiten. Dabei wird der vorhandene Hash durch den Hash f√ºr `alpine` neben den Eintr√§gen f√ºr die Benutzer `root` und `mobile` ersetzt.

## **Daten√ºbertragungstechniken**

### **√úbertragung von App-Datendateien**

**Archivierung und Abruf √ºber SSH und SCP:** Es ist einfach, das Data-Verzeichnis der Anwendung mit `tar` zu archivieren und dann mit `scp` zu √ºbertragen. Der folgende Befehl archiviert das Data-Verzeichnis in eine .tgz-Datei, die dann vom Ger√§t abgerufen wird:
```bash
tar czvf /tmp/data.tgz /private/var/mobile/Containers/Data/Application/8C8E7EB0-BC9B-435B-8EF8-8F5560EB0693
exit
scp -P 2222 root@localhost:/tmp/data.tgz .
```
### **Grafische Benutzeroberfl√§chen-Tools**

**Verwendung von iFunbox und iExplorer:** Diese GUI-Tools sind n√ºtzlich f√ºr die Verwaltung von Dateien auf iOS-Ger√§ten. Ab iOS 8.4 hat Apple jedoch den Zugriff auf das Anwendungssandbox dieser Tools eingeschr√§nkt, es sei denn, das Ger√§t ist gejailbreakt.

### **Verwendung von Objection f√ºr die Dateiverwaltung**

**Interaktive Shell mit Objection:** Das Starten von Objection erm√∂glicht den Zugriff auf das Bundle-Verzeichnis einer App. Von hier aus k√∂nnen Sie zum Dokumentenverzeichnis der App navigieren und Dateien verwalten, einschlie√ülich des Herunter- und Hochladens von Dateien auf und von dem iOS-Ger√§t.
```bash
objection --gadget com.apple.mobilesafari explorer
cd /var/mobile/Containers/Data/Application/72C7AAFB-1D75-4FBA-9D83-D8B4A2D44133/Documents
file download <filename>
```
## **Erhalten und Extrahieren von Apps**

### **Erwerben der IPA-Datei**

**Over-The-Air (OTA) Vertriebslink:** Apps, die √ºber OTA zum Testen verteilt werden, k√∂nnen mithilfe des ITMS Services Asset Downloader-Tools heruntergeladen werden. Dieses Tool wird √ºber npm installiert und verwendet, um die IPA-Datei lokal zu speichern.
```bash
npm install -g itms-services
itms-services -u "itms-services://?action=download-manifest&url=https://s3-ap-southeast-1.amazonaws.com/test-uat/manifest.plist" -o - > out.ipa
```
### **Extrahieren der App-Bin√§rdatei**

1. **Aus einer IPA:** Entpacken Sie die IPA-Datei, um auf die entschl√ºsselte App-Bin√§rdatei zuzugreifen.
2. **Von einem gejailbreakten Ger√§t:** Installieren Sie die App und extrahieren Sie die entschl√ºsselte Bin√§rdatei aus dem Speicher.

### **Entschl√ºsselungsprozess**

**√úbersicht der manuellen Entschl√ºsselung:** iOS-App-Bin√§rdateien werden von Apple mit FairPlay verschl√ºsselt. Um sie zu reverse-engineeren, muss die entschl√ºsselte Bin√§rdatei aus dem Speicher extrahiert werden. Der Entschl√ºsselungsprozess umfasst das √úberpr√ºfen der PIE-Flagge, das Anpassen der Speicherflags, das Identifizieren des verschl√ºsselten Abschnitts und das Dumpen und Ersetzen dieses Abschnitts durch seine entschl√ºsselte Form.

**√úberpr√ºfen und √Ñndern der PIE-Flagge:**
```bash
otool -Vh Original_App
python change_macho_flags.py --no-pie Original_App
otool -Vh Hello_World
```
**Identifizierung des verschl√ºsselten Abschnitts und Speicherdump:**

Bestimmen Sie die Start- und Endadressen des verschl√ºsselten Abschnitts mit `otool` und dumpen Sie den Speicher des jailbroken Ger√§ts mit gdb.
```bash
otool -l Original_App | grep -A 4 LC_ENCRYPTION_INFO
dump memory dump.bin 0x8000 0x10a4000
```
**√úberschreiben des verschl√ºsselten Abschnitts:**

Ersetzen Sie den verschl√ºsselten Abschnitt in der Original-App-Bin√§rdatei durch den entschl√ºsselten Dump.
```bash
dd bs=1 seek=<starting_address> conv=notrunc if=dump.bin of=Original_App
```
**Abschlie√üende Entschl√ºsselung:** √Ñndern Sie die Metadaten der Bin√§rdatei mit Tools wie **MachOView**, um das Fehlen einer Verschl√ºsselung anzuzeigen, indem Sie `cryptid` auf 0 setzen.

### **Entschl√ºsselung (automatisch)**

#### **frida-ios-dump**
Das Tool [**frida-ios-dump**](https://github.com/AloneMonkey/frida-ios-dump) wird verwendet, um Apps automatisch von iOS-Ger√§ten zu entschl√ºsseln und zu extrahieren. Zun√§chst muss `dump.py` so konfiguriert werden, dass es eine Verbindung zum iOS-Ger√§t herstellt. Dies kann √ºber localhost auf Port 2222 √ºber **iproxy** oder direkt √ºber die IP-Adresse und den Port des Ger√§ts erfolgen.

Mit dem Befehl k√∂nnen die auf dem Ger√§t installierten Anwendungen aufgelistet werden:
```bash
$ python dump.py -l
```
Um eine bestimmte App wie Telegram zu dumpen, wird der folgende Befehl verwendet:
```bash
$ python3 dump.py -u "root" -p "<PASSWORD>" ph.telegra.Telegraph
```
Dieser Befehl initiiert das App-Dumpen und f√ºhrt zur Erstellung einer `Telegram.ipa`-Datei im aktuellen Verzeichnis. Dieser Vorgang ist f√ºr gejailbreakte Ger√§te geeignet, da nicht signierte oder gef√§lscht signierte Apps mithilfe von Tools wie [**ios-deploy**](https://github.com/ios-control/ios-deploy) erneut installiert werden k√∂nnen.

#### **flexdecrypt**
Das Tool [**flexdecrypt**](https://github.com/JohnCoates/flexdecrypt) erm√∂glicht zusammen mit seinem Wrapper [**flexdump**](https://gist.github.com/defparam/71d67ee738341559c35c684d659d40ac) das Extrahieren von IPA-Dateien aus installierten Anwendungen. Installationsbefehle f√ºr **flexdecrypt** auf dem Ger√§t beinhalten das Herunterladen und Installieren des `.deb`-Pakets. **flexdump** kann verwendet werden, um Apps aufzulisten und zu dumpen, wie in den folgenden Befehlen gezeigt:
```bash
apt install zip unzip
wget https://gist.githubusercontent.com/defparam/71d67ee738341559c35c684d659d40ac/raw/30c7612262f1faf7871ba8e32fbe29c0f3ef9e27/flexdump -P /usr/local/bin; chmod +x /usr/local/bin/flexdump
flexdump list
flexdump dump Twitter.app
```
#### **bagbak**
[**bagbak**](https://github.com/ChiChou/bagbak), ein weiteres auf Frida basierendes Tool, erfordert ein gejailbreaktes Ger√§t zur App-Entschl√ºsselung:
```bash
bagbak --raw Chrome
```
#### **r2flutch**
**r2flutch**, das sowohl radare als auch frida nutzt, dient zur Entschl√ºsselung und Dumping von Apps. Weitere Informationen finden Sie auf der [**GitHub-Seite**](https://github.com/as0ler/r2flutch).

### **Installation von Apps**

**Sideloading** bezieht sich auf die Installation von Anwendungen au√üerhalb des offiziellen App Stores. Dieser Vorgang wird vom **installd-Daemon** durchgef√ºhrt und erfordert, dass Apps mit einem von Apple ausgestellten Zertifikat signiert sind. Mit einem jailbroken Ger√§t kann dies durch **AppSync** umgangen werden, was die Installation von gef√§lscht signierten IPA-Paketen erm√∂glicht.

#### **Sideloading-Tools**

- **Cydia Impactor**: Ein Tool zum Signieren und Installieren von IPA-Dateien auf iOS und APK-Dateien auf Android. Anleitungen und Fehlerbehebung finden Sie auf [yalujailbreak.net](https://yalujailbreak.net/how-to-use-cydia-impactor/).

- **libimobiledevice**: Eine Bibliothek f√ºr Linux und macOS zur Kommunikation mit iOS-Ger√§ten. Installationsbefehle und Beispiele f√ºr die Verwendung von ideviceinstaller werden f√ºr die Installation von Apps √ºber USB bereitgestellt.

- **ipainstaller**: Dieses Befehlszeilentool erm√∂glicht die direkte Installation von Apps auf iOS-Ger√§ten.

- **ios-deploy**: F√ºr macOS-Benutzer installiert ios-deploy iOS-Apps √ºber die Befehlszeile. Das Entpacken der IPA-Datei und die Verwendung des `-m`-Flags f√ºr den direkten Start der App geh√∂ren zum Prozess.

- **Xcode**: Verwenden Sie Xcode, um Apps zu installieren, indem Sie zu **Window/Devices and Simulators** navigieren und die App zu **Installed Apps** hinzuf√ºgen.

#### **Installation von iPad-Anwendungen auf Nicht-iPad-Ger√§ten erm√∂glichen**
Um iPad-spezifische Anwendungen auf iPhone- oder iPod touch-Ger√§ten zu installieren, muss der Wert **UIDeviceFamily** in der **Info.plist**-Datei auf **1** ge√§ndert werden. Diese √Ñnderung erfordert jedoch das erneute Signieren der IPA-Datei aufgrund von Signaturvalidierungspr√ºfungen.

**Hinweis**: Diese Methode kann fehlschlagen, wenn die Anwendung Funktionen erfordert, die exklusiv f√ºr neuere iPad-Modelle reserviert sind, w√§hrend ein √§lteres iPhone oder iPod touch verwendet wird.



## Referenzen
* [https://mas.owasp.org/MASTG/iOS/0x06b-iOS-Security-Testing/](ttps://mas.owasp.org/MASTG/iOS/0x06b-iOS-Security-Testing/)
* [https://mas.owasp.org/MASTG/techniques/ios/MASTG-TECH-0052/](https://mas.owasp.org/MASTG/techniques/ios/MASTG-TECH-0052/)
* [https://mas.owasp.org/MASTG/techniques/ios/MASTG-TECH-0053/](https://mas.owasp.org/MASTG/techniques/ios/MASTG-TECH-0053/)
* [https://mas.owasp.org/MASTG/techniques/ios/MASTG-TECH-0054/](https://mas.owasp.org/MASTG/techniques/ios/MASTG-TECH-0054/)
* [https://mas.owasp.org/MASTG/techniques/ios/MASTG-TECH-0056/](https://mas.owasp.org/MASTG/techniques/ios/MASTG-TECH-0056/)

<details>

<summary><strong>Lernen Sie AWS-Hacking von Grund auf mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks bewerben m√∂chten** oder **HackTricks als PDF herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merchandise**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) Github-Repos senden.

</details>
