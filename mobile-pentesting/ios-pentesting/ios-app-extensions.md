# iOS рдРрдк рдПрдХреНрд╕рдЯреЗрдВрд╢рдиреНрд╕

<details>

<summary><strong>AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рд╢реБрд░реБрдЖрдд рд╕реЗ рд▓реЗрдХрд░ рдПрдХреНрд╕рдкрд░реНрдЯ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ**, рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рдПрдХреНрд╕рдХреНрд▓реВрд╕рд┐рд╡ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ [**telegram group**](https://t.me/peass) рдореЗрдВ рдпрд╛ **Twitter** рдкрд░ ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm) рдХреЛ **рдлреЙрд▓реЛ рдХрд░реЗрдВ**.
* **HackTricks** рдХреЗ [**github repos**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╢реЗрдпрд░ рдХрд░реЗрдВред

</details>

**рд╕рд╛рдордЧреНрд░реА рдХреЙрдкреА рдХреА рдЧрдИ** [**https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06h-testing-platform-interaction#app-extensions**](https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06h-testing-platform-interaction#app-extensions) рд╕реЗ

рдРрдк рдПрдХреНрд╕рдЯреЗрдВрд╢рдиреНрд╕ рдРрдкреНрд╕ рдХреЛ рдЕрдиреНрдп рдРрдкреНрд╕ рдпрд╛ рд╕рд┐рд╕реНрдЯрдо рдХреЗ рд╕рд╛рде рдЗрдВрдЯрд░реИрдХреНрдЯ рдХрд░рддреЗ рд╕рдордп рдпреВрдЬрд░реНрд╕ рдХреЛ рдХрд╕реНрдЯрдо рдлрдВрдХреНрд╢рдиреИрд▓рд┐рдЯреА рдФрд░ рдХрдВрдЯреЗрдВрдЯ рдкреНрд░рджрд╛рди рдХрд░рдиреЗ рджреЗрддреЗ рд╣реИрдВред рдХреБрдЫ рдЙрд▓реНрд▓реЗрдЦрдиреАрдп рд╣реИрдВ:

* **рдХрд╕реНрдЯрдо рдХреАрдмреЛрд░реНрдб**: iOS рд╕рд┐рд╕реНрдЯрдо рдХреАрдмреЛрд░реНрдб рдХреЛ рдХрд╕реНрдЯрдо рдХреАрдмреЛрд░реНрдб рд╕реЗ рдмрджрд▓ рджреЗрддрд╛ рд╣реИ рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рд╕рднреА рдРрдкреНрд╕ рдореЗрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред
* **рд╢реЗрдпрд░**: рдПрдХ рд╢реЗрдпрд░рд┐рдВрдЧ рд╡реЗрдмрд╕рд╛рдЗрдЯ рдкрд░ рдкреЛрд╕реНрдЯ рдХрд░реЗрдВ рдпрд╛ рджреВрд╕рд░реЛрдВ рдХреЗ рд╕рд╛рде рдХрдВрдЯреЗрдВрдЯ рд╢реЗрдпрд░ рдХрд░реЗрдВред
* **рдЯреБрдбреЗ**: рдЬрд┐рд╕реЗ **рд╡рд┐рдЬреЗрдЯреНрд╕** рднреА рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ, рд╡реЗ рдиреЛрдЯрд┐рдлрд┐рдХреЗрд╢рди рд╕реЗрдВрдЯрд░ рдХреЗ рдЯреБрдбреЗ рд╡реНрдпреВ рдореЗрдВ рдХрдВрдЯреЗрдВрдЯ рдкреНрд░рджрд╛рди рдХрд░рддреЗ рд╣реИрдВ рдпрд╛ рддреНрд╡рд░рд┐рдд рдХрд╛рд░реНрдп рдХрд░рддреЗ рд╣реИрдВред

рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдпреВрдЬрд░ _рд╣реЛрд╕реНрдЯ рдРрдк_ рдореЗрдВ рдЯреЗрдХреНрд╕реНрдЯ рд╕реЗрд▓реЗрдХреНрдЯ рдХрд░рддрд╛ рд╣реИ, "рд╢реЗрдпрд░" рдмрдЯрди рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░рддрд╛ рд╣реИ рдФрд░ рд╕реВрдЪреА рд╕реЗ рдПрдХ "рдРрдк" рдпрд╛ рдПрдХреНрд╢рди рдЪреБрдирддрд╛ рд╣реИред рдЗрд╕рд╕реЗ _рдХрдВрдЯреЗрдирд┐рдВрдЧ рдРрдк_ рдХрд╛ _рдРрдк рдПрдХреНрд╕рдЯреЗрдВрд╢рди_ рдЯреНрд░рд┐рдЧрд░ рд╣реЛрддрд╛ рд╣реИред рдРрдк рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдЕрдкрдирд╛ рд╡реНрдпреВ рд╣реЛрд╕реНрдЯ рдРрдк рдХреЗ рд╕рдВрджрд░реНрдн рдореЗрдВ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рддрд╛ рд╣реИ рдФрд░ рд╣реЛрд╕реНрдЯ рдРрдк рджреНрд╡рд╛рд░рд╛ рдкреНрд░рджрд╛рди рдХреА рдЧрдИ рдЖрдЗрдЯрдореНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ, рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ рдЪрдпрдирд┐рдд рдЯреЗрдХреНрд╕реНрдЯ, рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдХрд╛рд░реНрдп рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЗрд╕реЗ рдПрдХ рд╕реЛрд╢рд▓ рдиреЗрдЯрд╡рд░реНрдХ рдкрд░ рдкреЛрд╕реНрдЯ рдХрд░рдирд╛)ред рдЗрд╕ [Apple App Extension Programming Guide](https://developer.apple.com/library/archive/documentation/General/Conceptual/ExtensibilityPG/ExtensionOverview.html#//apple_ref/doc/uid/TP40014214-CH2-SW13) рд╕реЗ рд▓реА рдЧрдИ рдпрд╣ рддрд╕реНрд╡реАрд░ рдЗрд╕реЗ рдмрд╣реБрдд рдЕрдЪреНрдЫреЗ рд╕реЗ рд╕рд╛рд░рд╛рдВрд╢рд┐рдд рдХрд░рддреА рд╣реИ:

![](https://gblobscdn.gitbook.com/assets%2F-LH00RC4WVf3-6Ou4e0l%2F-Lf1APQHyCHdAvoJSvc_%2F-Lf1AQx9khfTwUwYuMti%2Fapp_extensions_communication.png?alt=media)

### **рд╕реБрд░рдХреНрд╖рд╛ рд╡рд┐рдЪрд╛рд░**

рд╕реБрд░рдХреНрд╖рд╛ рдХреА рджреГрд╖реНрдЯрд┐ рд╕реЗ рдпрд╣ рдзреНрдпрд╛рди рджреЗрдирд╛ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ рдХрд┐:

* рдПрдХ **рдРрдк рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХрднреА рднреА рдЕрдкрдиреЗ рдХрдВрдЯреЗрдирд┐рдВрдЧ рдРрдк рдХреЗ рд╕рд╛рде рд╕реАрдзреЗ рд╕рдВрд╡рд╛рдж рдирд╣реАрдВ рдХрд░рддрд╛** (рдЖрдорддреМрд░ рдкрд░, рдЬрдм рдРрдк рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдЪрд▓ рд░рд╣рд╛ рд╣реЛрддрд╛ рд╣реИ рддреЛ рдХрдВрдЯреЗрдирд┐рдВрдЧ рдРрдк рдЪрд▓ рдирд╣реАрдВ рд░рд╣рд╛ рд╣реЛрддрд╛)ред
* рдПрдХ **рдРрдк рдПрдХреНрд╕рдЯреЗрдВрд╢рди** рдФрд░ **рд╣реЛрд╕реНрдЯ рдРрдк** **рдЗрдВрдЯрд░-рдкреНрд░реЛрд╕реЗрд╕** рд╕рдВрдЪрд╛рд░ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ **рд╕рдВрд╡рд╛рдж рдХрд░рддреЗ рд╣реИрдВ**ред
* рдПрдХ **рдРрдк рдПрдХреНрд╕рдЯреЗрдВрд╢рди** рдХрд╛ рдХрдВрдЯреЗрдирд┐рдВрдЧ рдРрдк рдФрд░ **рд╣реЛрд╕реНрдЯ рдРрдк рдмрд┐рд▓рдХреБрд▓ рднреА рд╕рдВрд╡рд╛рдж рдирд╣реАрдВ рдХрд░рддреЗ**ред
* рдПрдХ **рдЯреБрдбреЗ** **рд╡рд┐рдЬреЗрдЯ** (рдФрд░ рдХреЛрдИ рдЕрдиреНрдп рдРрдк рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдкреНрд░рдХрд╛рд░ рдирд╣реАрдВ) `NSExtensionContext` рдХреНрд▓рд╛рд╕ рдХреЗ `openURL:completionHandler:` рдореЗрдердб рдХреЛ рдХреЙрд▓ рдХрд░рдХреЗ рд╕рд┐рд╕реНрдЯрдо рд╕реЗ рдЕрдкрдиреЗ рдХрдВрдЯреЗрдирд┐рдВрдЧ рдРрдк рдХреЛ рдЦреЛрд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд╣ рд╕рдХрддрд╛ рд╣реИред
* рдХреЛрдИ рднреА **рдРрдк рдПрдХреНрд╕рдЯреЗрдВрд╢рди** рдФрд░ рдЗрд╕рдХрд╛ **рдХрдВрдЯреЗрдирд┐рдВрдЧ рдРрдк** рдПрдХ рдирд┐рдЬреА рд░реВрдк рд╕реЗ рдкрд░рд┐рднрд╛рд╖рд┐рдд рд╕рд╛рдЭрд╛ рдХрдВрдЯреЗрдирд░ рдореЗрдВ **рд╕рд╛рдЭрд╛ рдбреЗрдЯрд╛ рддрдХ рдкрд╣реБрдВрдЪ рд╕рдХрддреЗ рд╣реИрдВ**ред
* рдРрдк рдПрдХреНрд╕рдЯреЗрдВрд╢рдиреНрд╕ **рдХреБрдЫ APIs рддрдХ рдкрд╣реБрдВрдЪ рдирд╣реАрдВ рд╕рдХрддреЗ**, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, HealthKitред
* рд╡реЗ **AirDrop рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдбреЗрдЯрд╛ рдкреНрд░рд╛рдкреНрдд рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ** рд▓реЗрдХрд┐рди рдбреЗрдЯрд╛ рднреЗрдЬ рд╕рдХрддреЗ рд╣реИрдВред
* **рдХреЛрдИ рд▓рдВрдмреЗ рд╕рдордп рддрдХ рдЪрд▓рдиреЗ рд╡рд╛рд▓реЗ рдмреИрдХрдЧреНрд░рд╛рдЙрдВрдб рдХрд╛рд░реНрдп** рдЕрдиреБрдорддрд┐ рдирд╣реАрдВ рд╣реИрдВ рд▓реЗрдХрд┐рди рдЕрдкрд▓реЛрдб рдпрд╛ рдбрд╛рдЙрдирд▓реЛрдб рд╢реБрд░реВ рдХрд┐рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВред
* рдРрдк рдПрдХреНрд╕рдЯреЗрдВрд╢рдиреНрд╕ **iOS рдбрд┐рд╡рд╛рдЗрд╕ рдкрд░ рдХреИрдорд░рд╛ рдпрд╛ рдорд╛рдЗрдХреНрд░реЛрдлреЛрди рддрдХ рдкрд╣реБрдВрдЪ рдирд╣реАрдВ рд╕рдХрддреЗ** (iMessage рдРрдк рдПрдХреНрд╕рдЯреЗрдВрд╢рдиреНрд╕ рдХреЛ рдЫреЛрдбрд╝рдХрд░)ред

### рд╕реНрдЯреИрдЯрд┐рдХ рд╡рд┐рд╢реНрд▓реЗрд╖рдг

#### **рдпрд╣ рдЬрд╛рдВрдЪрдирд╛ рдХрд┐ рдРрдк рдореЗрдВ рдРрдк рдПрдХреНрд╕рдЯреЗрдВрд╢рдиреНрд╕ рд╣реИрдВ рдпрд╛ рдирд╣реАрдВ**

рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдореВрд▓ рд╕реНрд░реЛрдд рдХреЛрдб рд╣реИ рддреЛ рдЖрдк Xcode (cmd+shift+f) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ `NSExtensionPointIdentifier` рдХреА рд╕рднреА рдШрдЯрдирд╛рдУрдВ рдХреА рдЦреЛрдЬ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдпрд╛ "Build Phases / Embed App extensions" рдореЗрдВ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ:

![](<../../.gitbook/assets/image (496).png>)

рд╡рд╣рд╛рдВ рдЖрдк `.appex` рдХреЗ рдмрд╛рдж рд╕рднреА рдПрдореНрдмреЗрдбреЗрдб рдРрдк рдПрдХреНрд╕рдЯреЗрдВрд╢рдиреНрд╕ рдХреЗ рдирд╛рдо рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ, рдЕрдм рдЖрдк рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдореЗрдВ рд╡реНрдпрдХреНрддрд┐рдЧрдд рдРрдк рдПрдХреНрд╕рдЯреЗрдВрд╢рдиреНрд╕ рдХреЛ рдиреЗрд╡рд┐рдЧреЗрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

рдпрджрд┐ рдореВрд▓ рд╕реНрд░реЛрдд рдХреЛрдб рдирд╣реАрдВ рд╣реИ:

рдРрдк рдмрдВрдбрд▓ (IPA рдпрд╛ рдЗрдВрд╕реНрдЯреЙрд▓реНрдб рдРрдк) рдХреЗ рдЕрдВрджрд░ рд╕рднреА рдлрд╛рдЗрд▓реЛрдВ рдореЗрдВ `NSExtensionPointIdentifier` рдХреЗ рд▓рд┐рдП Grep рдХрд░реЗрдВ:
```bash
$ grep -nr NSExtensionPointIdentifier Payload/Telegram\ X.app/
Binary file Payload/Telegram X.app//PlugIns/SiriIntents.appex/Info.plist matches
Binary file Payload/Telegram X.app//PlugIns/Share.appex/Info.plist matches
Binary file Payload/Telegram X.app//PlugIns/NotificationContent.appex/Info.plist matches
Binary file Payload/Telegram X.app//PlugIns/Widget.appex/Info.plist matches
Binary file Payload/Telegram X.app//Watch/Watch.app/PlugIns/Watch Extension.appex/Info.plist matches
```
рдЖрдк SSH рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рднреА рдкрд╣реБрдБрдЪ рд╕рдХрддреЗ рд╣реИрдВ, рдРрдк рдмрдВрдбрд▓ рдХреЛ рдвреВрдБрдв рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рд╕рднреА рдЕрдВрджрд░ рдХреЗ PlugIns рдХреА рд╕реВрдЪреА рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ (рд╡реЗ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рд╡рд╣рд╛рдБ рд░рдЦреЗ рдЬрд╛рддреЗ рд╣реИрдВ) рдпрд╛ рдЗрд╕реЗ objection рдХреЗ рд╕рд╛рде рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
ph.telegra.Telegraph on (iPhone: 11.1.2) [usb] # cd PlugIns
/var/containers/Bundle/Application/15E6A58F-1CA7-44A4-A9E0-6CA85B65FA35/
Telegram X.app/PlugIns

ph.telegra.Telegraph on (iPhone: 11.1.2) [usb] # ls
NSFileType      Perms  NSFileProtection    Read    Write     Name
------------  -------  ------------------  ------  -------   -------------------------
Directory         493  None                True    False     NotificationContent.appex
Directory         493  None                True    False     Widget.appex
Directory         493  None                True    False     Share.appex
Directory         493  None                True    False     SiriIntents.appex
```
рд╣рдо рдЕрдм рд╡рд╣реА рдЪрд╛рд░ рдРрдк рдПрдХреНрд╕рдЯреЗрдВрд╢рди рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рд╣рдордиреЗ Xcode рдореЗрдВ рдкрд╣рд▓реЗ рджреЗрдЦреЗ рдереЗред

#### **рд╕рдорд░реНрдерд┐рдд рдбреЗрдЯрд╛ рдкреНрд░рдХрд╛рд░реЛрдВ рдХрд╛ рдирд┐рд░реНрдзрд╛рд░рдг**

рдпрд╣ рд╣реЛрд╕реНрдЯ рдРрдкреНрд╕ рдХреЗ рд╕рд╛рде рд╕рд╛рдЭрд╛ рдХрд┐рдП рдЬрд╛ рд░рд╣реЗ рдбреЗрдЯрд╛ рдХреЗ рд▓рд┐рдП рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП Share рдпрд╛ Action Extensions рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ)ред рдЬрдм рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╣реЛрд╕реНрдЯ рдРрдк рдореЗрдВ рдХрд┐рд╕реА рдбреЗрдЯрд╛ рдкреНрд░рдХрд╛рд░ рдХрд╛ рдЪрдпрди рдХрд░рддрд╛ рд╣реИ рдФрд░ рдпрд╣ рдпрд╣рд╛рдВ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдбреЗрдЯрд╛ рдкреНрд░рдХрд╛рд░реЛрдВ рд╕реЗ рдореЗрд▓ рдЦрд╛рддрд╛ рд╣реИ, рддреЛ рд╣реЛрд╕реНрдЯ рдРрдк рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреА рдкреЗрд╢рдХрд╢ рдХрд░реЗрдЧрд╛ред `UIActivity` рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдбреЗрдЯрд╛ рд╕рд╛рдЭрд╛ рдХрд░рдиреЗ рдФрд░ рдпрд╣рд╛рдВ рдХреЗ рдЕрдВрддрд░ рдХреЛ рджреЗрдЦрдирд╛ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ рдЬрд╣рд╛рдВ рд╣рдореЗрдВ рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рдкреНрд░рдХрд╛рд░реЛрдВ рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рдирд╛ рдерд╛, UTIs рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рднреАред рдЗрд╕рдХреЗ рд▓рд┐рдП рдРрдк рдХреЛ рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реЛрддреА рд╣реИред рдХреЗрд╡рд▓ `UIActivity` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдбреЗрдЯрд╛ рд╕рд╛рдЭрд╛ рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИред

рдРрдк рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреА `Info.plist` рдлрд╝рд╛рдЗрд▓ рдХрд╛ рдирд┐рд░реАрдХреНрд╖рдг рдХрд░реЗрдВ рдФрд░ `NSExtensionActivationRule` рдХреЗ рд▓рд┐рдП рдЦреЛрдЬ рдХрд░реЗрдВред рд╡рд╣ рдХреБрдВрдЬреА рд╕рдорд░реНрдерд┐рдд рдбреЗрдЯрд╛ рдХреЛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рддреА рд╣реИ рдФрд░ рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рд╕рдорд░реНрдерд┐рдд рдЖрдЗрдЯрдореЛрдВ рдХреА рдЕрдзрд┐рдХрддрдо рд╕рдВрдЦреНрдпрд╛ рднреАред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП:
```markup
<key>NSExtensionAttributes</key>
<dict>
<key>NSExtensionActivationRule</key>
<dict>
<key>NSExtensionActivationSupportsImageWithMaxCount</key>
<integer>10</integer>
<key>NSExtensionActivationSupportsMovieWithMaxCount</key>
<integer>1</integer>
<key>NSExtensionActivationSupportsWebURLWithMaxCount</key>
<integer>1</integer>
</dict>
</dict>
```
рдХреЗрд╡рд▓ рдпрд╣рд╛рдБ рдкреНрд░рд╕реНрддреБрдд рдбреЗрдЯрд╛ рдкреНрд░рдХрд╛рд░ рдФрд░ рдЬрд┐рдирдХрд╛ `MaxCount` `0` рдирд╣реАрдВ рд╣реИ, рдЙрдиреНрд╣реЗрдВ рд╕рдорд░реНрдерди рджрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдПрдХ рддрдерд╛рдХрдерд┐рдд рдкреНрд░реЗрдбрд┐рдХреЗрдЯ рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЕрдзрд┐рдХ рдЬрдЯрд┐рд▓ рдлрд┐рд▓реНрдЯрд░рд┐рдВрдЧ рд╕рдВрднрд╡ рд╣реИ рдЬреЛ рджрд┐рдП рдЧрдП UTIs рдХрд╛ рдореВрд▓реНрдпрд╛рдВрдХрди рдХрд░реЗрдЧрд╛ред рдЗрд╕рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рд╡рд┐рд╕реНрддреГрдд рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рдХреГрдкрдпрд╛ [Apple App Extension Programming Guide](https://developer.apple.com/library/archive/documentation/General/Conceptual/ExtensibilityPG/ExtensionScenarios.html#//apple_ref/doc/uid/TP40014214-CH21-SW8) рджреЗрдЦреЗрдВред

**рдореБрдЦреНрдп рдРрдк рдХреЗ рд╕рд╛рде рдбреЗрдЯрд╛ рд╕рд╛рдЭрд╛ рдХрд░рдиреЗ рдХреА рдЬрд╛рдВрдЪ**

рдпрд╛рдж рд░рдЦреЗрдВ рдХрд┐ рдРрдк рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдФрд░ рдЙрдирдХреЗ рдореБрдЦреНрдп рдРрдкреНрд╕ рдХреЗ рдкрд╛рд╕ рдПрдХ рджреВрд╕рд░реЗ рдХреЗ рдХрдВрдЯреЗрдирд░реЛрдВ рддрдХ рд╕реАрдзреА рдкрд╣реБрдВрдЪ рдирд╣реАрдВ рд╣реЛрддреА рд╣реИред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдбреЗрдЯрд╛ рд╕рд╛рдЭрд╛ рдХрд░рдирд╛ рд╕рдХреНрд╖рдо рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдпрд╣ ["App Groups"](https://developer.apple.com/library/archive/documentation/Miscellaneous/Reference/EntitlementKeyReference/Chapters/EnablingAppSandbox.html#//apple_ref/doc/uid/TP40011195-CH4-SW19) рдФрд░ [`NSUserDefaults`](https://developer.apple.com/documentation/foundation/nsuserdefaults) API рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред [Apple App Extension Programming Guide](https://developer.apple.com/library/archive/documentation/General/Conceptual/ExtensibilityPG/ExtensionScenarios.html#//apple_ref/doc/uid/TP40014214-CH21-SW11) рд╕реЗ рдЗрд╕ рдЪрд┐рддреНрд░ рдХреЛ рджреЗрдЦреЗрдВ:

![](../../mobile-apps-pentesting/ios-pentesting/broken-reference)

рдЧрд╛рдЗрдб рдореЗрдВ рднреА рдЙрд▓реНрд▓реЗрдЦрд┐рдд рд╣реИ, рдпрджрд┐ рдРрдк рдПрдХреНрд╕рдЯреЗрдВрд╢рди `NSURLSession` рдХреНрд▓рд╛рд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкреГрд╖реНрдарднреВрдорд┐ рдЕрдкрд▓реЛрдб рдпрд╛ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░рддрд╛ рд╣реИ, рддреЛ рдРрдк рдХреЛ рдПрдХ рд╕рд╛рдЭрд╛ рдХрдВрдЯреЗрдирд░ рд╕реЗрдЯ рдЕрдк рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП, рддрд╛рдХрд┐ рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдФрд░ рдЙрд╕рдХреЗ рдореБрдЦреНрдп рдРрдк рджреЛрдиреЛрдВ рд╣реА рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдбреЗрдЯрд╛ рддрдХ рдкрд╣реБрдВрдЪ рд╕рдХреЗрдВред

**рдпрд╣ рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░рдирд╛ рдХрд┐ рдРрдк рдРрдк рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреЗ рдЙрдкрдпреЛрдЧ рдХреЛ рдкреНрд░рддрд┐рдмрдВрдзрд┐рдд рдХрд░рддрд╛ рд╣реИ рдпрд╛ рдирд╣реАрдВ**

рд╡рд┐рд╢рд┐рд╖реНрдЯ рдкреНрд░рдХрд╛рд░ рдХреЗ рдРрдк рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреЛ рдЕрд╕реНрд╡реАрдХрд╛рд░ рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИ, рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╡рд┐рдзрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ:

* [`application:shouldAllowExtensionPointIdentifier:`](https://developer.apple.com/documentation/uikit/uiapplicationdelegate/1623122-application?language=objc)

рд╣рд╛рд▓рд╛рдВрдХрд┐, рдпрд╣ рд╡рд░реНрддрдорд╛рди рдореЗрдВ рдХреЗрд╡рд▓ "рдХрд╕реНрдЯрдо рдХреАрдмреЛрд░реНрдб" рдРрдк рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреЗ рд▓рд┐рдП рд╕рдВрднрд╡ рд╣реИ (рдФрд░ рдЬрдм рдХреАрдмреЛрд░реНрдб рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдбреЗрдЯрд╛ рдХреЛ рд╕рдВрднрд╛рд▓рдиреЗ рд╡рд╛рд▓реЗ рдРрдкреНрд╕ рдХрд╛ рдкрд░реАрдХреНрд╖рдг рдХрд░рддреЗ рд╕рдордп рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП рдЬреИрд╕реЗ рдХрд┐ рдмреИрдВрдХрд┐рдВрдЧ рдРрдкреНрд╕)ред

### рдбрд╛рдпрдирд╛рдорд┐рдХ рд╡рд┐рд╢реНрд▓реЗрд╖рдг

рд╕реНрд░реЛрдд рдХреЛрдб рдХреЗ рдмрд┐рдирд╛ рдЬреНрдЮрд╛рди рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣рдо рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

* рд╕рд╛рдЭрд╛ рдХрд┐рдП рдЬрд╛ рд░рд╣реЗ рдЖрдЗрдЯрдореЛрдВ рдХрд╛ рдирд┐рд░реАрдХреНрд╖рдг рдХрд░рдирд╛
* рд╢рд╛рдорд┐рд▓ рдРрдк рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреА рдкрд╣рдЪрд╛рди рдХрд░рдирд╛

**рд╕рд╛рдЭрд╛ рдХрд┐рдП рдЬрд╛ рд░рд╣реЗ рдЖрдЗрдЯрдореЛрдВ рдХрд╛ рдирд┐рд░реАрдХреНрд╖рдг рдХрд░рдирд╛**

рдЗрд╕рдХреЗ рд▓рд┐рдП рд╣рдореЗрдВ рдбреЗрдЯрд╛ рдЙрддреНрдкрдиреНрди рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдРрдк рдореЗрдВ `NSExtensionContext - inputItems` рдХреЛ рд╣реБрдХ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред

рдкрд┐рдЫрд▓реЗ рдЙрджрд╛рд╣рд░рдг рдХреЗ рдЕрдиреБрд╕рд╛рд░ рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП рд╣рдо рдЕрдм рдПрдХ рдЯреЗрдХреНрд╕реНрдЯ рдлрд╛рдЗрд▓ рдкрд░ "Share" рдмрдЯрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗ (рдЬреЛ рдПрдХ рдЪреИрдЯ рд╕реЗ рдкреНрд░рд╛рдкреНрдд рд╣реБрдИ рдереА) рддрд╛рдХрд┐ рдЙрд╕рдХреЗ рд╕рд╛рде рдиреЛрдЯреНрд╕ рдРрдк рдореЗрдВ рдПрдХ рдиреЛрдЯ рдмрдирд╛рдпрд╛ рдЬрд╛ рд╕рдХреЗ:

![](<../../.gitbook/assets/image (497).png>)

рдпрджрд┐ рд╣рдо рдПрдХ рдЯреНрд░реЗрд╕ рдЪрд▓рд╛рддреЗ рд╣реИрдВ, рддреЛ рд╣рдореЗрдВ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЖрдЙрдЯрдкреБрдЯ рджрд┐рдЦрд╛рдИ рджреЗрдЧрд╛:
```bash
(0x1c06bb420) NSExtensionContext - inputItems
0x18284355c Foundation!-[NSExtension _itemProviderForPayload:extensionContext:]
0x1828447a4 Foundation!-[NSExtension _loadItemForPayload:contextIdentifier:completionHandler:]
0x182973224 Foundation!__NSXPCCONNECTION_IS_CALLING_OUT_TO_EXPORTED_OBJECT_S3__
0x182971968 Foundation!-[NSXPCConnection _decodeAndInvokeMessageWithEvent:flags:]
0x182748830 Foundation!message_handler
0x181ac27d0 libxpc.dylib!_xpc_connection_call_event_handler
0x181ac0168 libxpc.dylib!_xpc_connection_mach_event
...
RET: (
"<NSExtensionItem: 0x1c420a540> - userInfo:
{
NSExtensionItemAttachmentsKey =     (
"<NSItemProvider: 0x1c46b30e0> {types = (\n \"public.plain-text\",\n \"public.file-url\"\n)}"
);
}"
)
```
рд╣рдо рдпрд╣рд╛рдБ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐:

* рдпрд╣ XPC рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЕрдВрддрд░реНрдирд┐рд╣рд┐рдд рд░реВрдк рд╕реЗ рд╣реБрдЖ, рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рдпрд╣ `NSXPCConnection` рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рдЬреЛ `libxpc.dylib` рдлреНрд░реЗрдорд╡рд░реНрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред
* `NSItemProvider` рдореЗрдВ рд╢рд╛рдорд┐рд▓ UTIs `public.plain-text` рдФрд░ `public.file-url` рд╣реИрдВ, рдмрд╛рдж рд╡рд╛рд▓рд╛ `NSExtensionActivationRule` рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реИ рдЬреЛ [Telegram рдХреЗ "Share Extension" рдХреЗ `Info.plist`](https://github.com/TelegramMessenger/Telegram-iOS/blob/master/Telegram/Share/Info.plist) рд╕реЗ рд╣реИред

**рд╕рдВрд▓рдЧреНрди рдРрдк рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреА рдкрд╣рдЪрд╛рди рдХрд░рдирд╛**

рдЖрдк рдпрд╣ рднреА рдкрддрд╛ рд▓рдЧрд╛ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдХреМрди рд╕рд╛ рдРрдк рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдЖрдкрдХреЗ рдЕрдиреБрд░реЛрдзреЛрдВ рдФрд░ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреА рджреЗрдЦрднрд╛рд▓ рдХрд░ рд░рд╣рд╛ рд╣реИ, `NSExtension - _plugIn` рдХреЛ рд╣реБрдХ рдХрд░рдХреЗ:

рд╣рдо рдлрд┐рд░ рд╕реЗ рд╡рд╣реА рдЙрджрд╛рд╣рд░рдг рдЪрд▓рд╛рддреЗ рд╣реИрдВ:
```bash
(0x1c0370200) NSExtension - _plugIn
RET: <PKPlugin: 0x1163637f0 ph.telegra.Telegraph.Share(5.3) 5B6DE177-F09B-47DA-90CD-34D73121C785
1(2) /private/var/containers/Bundle/Application/15E6A58F-1CA7-44A4-A9E0-6CA85B65FA35
/Telegram X.app/PlugIns/Share.appex>

(0x1c0372300)  -[NSExtension _plugIn]
RET: <PKPlugin: 0x10bff7910 com.apple.mobilenotes.SharingExtension(1.5) 73E4F137-5184-4459-A70A-83
F90A1414DC 1(2) /private/var/containers/Bundle/Application/5E267B56-F104-41D0-835B-F1DAB9AE076D
/MobileNotes.app/PlugIns/com.apple.mobilenotes.SharingExtension.appex>
```
рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ, рджреЛ рдРрдк рдПрдХреНрд╕рдЯреЗрдВрд╢рди рд╢рд╛рдорд┐рд▓ рд╣реИрдВ:

* `Share.appex` рдЯреЗрдХреНрд╕реНрдЯ рдлрд╛рдЗрд▓ рднреЗрдЬ рд░рд╣рд╛ рд╣реИ (`public.plain-text` рдФрд░ `public.file-url`).
* `com.apple.mobilenotes.SharingExtension.appex` рдЬреЛ рдЯреЗрдХреНрд╕реНрдЯ рдлрд╛рдЗрд▓ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдЧрд╛ рдФрд░ рдЙрд╕реЗ рдкреНрд░реЛрд╕реЗрд╕ рдХрд░реЗрдЧрд╛ред

рдпрджрд┐ рдЖрдк XPC рдХреЗ рдЕрдВрддрд░реНрдЧрдд рдХреНрдпрд╛ рд╣реЛ рд░рд╣рд╛ рд╣реИ, рдЗрд╕рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдФрд░ рдЬрд╛рдирдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рддреЛ рд╣рдо "libxpc.dylib" рд╕реЗ рдЖрдВрддрд░рд┐рдХ рдХреЙрд▓реНрд╕ рдкрд░ рдирдЬрд░ рдбрд╛рд▓рдиреЗ рдХреА рд╕рд▓рд╛рд╣ рджреЗрддреЗ рд╣реИрдВред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП рдЖрдк [`frida-trace`](https://www.frida.re/docs/frida-trace/) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдлрд┐рд░ рдЖрдкрдХреЛ рдЬреЛ рдореЗрдердбреНрд╕ рдЕрдзрд┐рдХ рд░реЛрдЪрдХ рд▓рдЧреЗрдВ рдЙрдирдореЗрдВ рдЧрд╣рд░рд╛рдИ рд╕реЗ рдЬрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдЙрддреНрдкрдиреНрди рд╕реНрдЯрдмреНрд╕ рдХрд╛ рд╡рд┐рд╕реНрддрд╛рд░ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

###

<details>

<summary><strong>Learn AWS hacking from zero to hero with</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ**, рддреЛ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**official PEASS & HackTricks swag**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВред
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣ред
* ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**telegram group**](https://t.me/peass) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ **Twitter** рдкрд░ рдореБрдЭреЗ ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm) **рдХрд╛ рдкрд╛рд▓рди рдХрд░реЗрдВ**ред
* **HackTricks** рдХреЗ [**github repos**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВред

</details>
