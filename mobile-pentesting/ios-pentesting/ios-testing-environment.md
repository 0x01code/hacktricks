# Ambiente de Teste iOS

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Voc√™ trabalha em uma **empresa de seguran√ßa cibern√©tica**? Voc√™ quer ver sua **empresa anunciada no HackTricks**? Ou voc√™ quer ter acesso √† **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**? Verifique os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* **Junte-se ao** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para o** [**reposit√≥rio hacktricks**](https://github.com/carlospolop/hacktricks) **e** [**reposit√≥rio hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Programa de Desenvolvedor Apple

Uma **identidade de provisionamento** √© uma cole√ß√£o de chaves p√∫blicas e privadas associadas a uma conta de desenvolvedor da Apple. Para **assinar aplicativos**, voc√™ precisa pagar **99$/ano** para se registrar no **Programa de Desenvolvedor Apple** e obter sua identidade de provisionamento. Sem isso, voc√™ n√£o poder√° executar aplicativos a partir do c√≥digo-fonte em um dispositivo f√≠sico. Outra op√ß√£o √© usar um **dispositivo com jailbreak**.

A partir do Xcode 7.2, a Apple disponibilizou uma op√ß√£o para criar um **perfil de provisionamento de desenvolvimento iOS gratuito** que permite escrever e testar seu aplicativo em um iPhone real. V√° para _Xcode_ --> _Prefer√™ncias_ --> _Contas_ --> _+_ (Adicionar novo ID de Aplicativo com suas credenciais) --> _Clique no ID de Aplicativo criado_ --> _Gerenciar Certificados_ --> _+_ (Desenvolvimento Apple) --> _Conclu√≠do_\
\_\_Em seguida, para executar seu aplicativo no iPhone, voc√™ precisa primeiro **indicar ao iPhone que confie no computador**. Em seguida, voc√™ pode tentar **executar o aplicativo no celular a partir do Xcode**, mas um erro aparecer√°. Portanto, v√° para _Configura√ß√µes_ --> _Geral_ --> _Perfis e Gerenciamento de Dispositivos_ --> Selecione o perfil n√£o confi√°vel e clique em "**Confiar**".

Observe que **aplicativos assinados pelo mesmo certificado de assinatura podem compartilhar recursos de maneira segura, como itens de chaveiro**.

Os perfis de provisionamento s√£o armazenados dentro do telefone em **`/Library/MobileDevice/ProvisioningProfiles`**

## **Simulador**

{% hint style="info" %}
Observe que um **simulador n√£o √© o mesmo que um emulador**. O simulador apenas simula o comportamento do dispositivo e suas fun√ß√µes, mas n√£o as utiliza de fato.
{% endhint %}

O simulador do iOS SDK oferece uma _simula√ß√£o_ de alto n√≠vel de um dispositivo iOS. Mais importante, os bin√°rios do emulador s√£o compilados para c√≥digo x86 em vez de c√≥digo ARM. Os aplicativos compilados para um dispositivo real n√£o s√£o executados, tornando o simulador in√∫til para an√°lise de caixa preta e engenharia reversa.

### **Simulador**

A primeira coisa que voc√™ precisa saber √© que **realizar um pentest dentro de um simulador ser√° muito mais limitado do que faz√™-lo em um dispositivo com jailbreak**.

Todas as ferramentas necess√°rias para construir e dar suporte a um aplicativo iOS s√£o **oficialmente suportadas apenas no Mac OS**.\
A ferramenta de fato da Apple para criar/debbugar/instrumentar aplicativos iOS √© o **Xcode**. Ele pode ser usado para baixar outros componentes, como **simuladores** e diferentes **vers√µes do SDK** necess√°rias para construir e **testar** seu aplicativo.\
√â altamente recomendado **baixar** o Xcode da **loja de aplicativos oficial**. Outras vers√µes podem conter malware.

Os arquivos do simulador podem ser encontrados em `/Users/<username>/Library/Developer/CoreSimulator/Devices`

Para abrir o simulador, execute o Xcode e, em seguida, clique na guia _Xcode_ --> _Abrir ferramentas de desenvolvedor_ --> _Simulador_\
\_\_Na imagem a seguir, clicando em "iPod touch \[...]", voc√™ pode selecionar outro dispositivo para testar:

![](<../../.gitbook/assets/image (457).png>)

![](<../../.gitbook/assets/image (458).png>)

### Aplicativos no Simulador

Dentro de `/Users/<username>/Library/Developer/CoreSimulator/Devices`, voc√™ pode encontrar todos os **simuladores instalados**. Se voc√™ deseja acessar os arquivos de um aplicativo criado em um dos emuladores, pode ser dif√≠cil saber **em qual deles o aplicativo est√° instalado**. Uma maneira r√°pida de **encontrar o UID correto** √© executar o aplicativo no simulador e executar:
```bash
xcrun simctl list | grep Booted
iPhone 8 (BF5DA4F8-6BBE-4EA0-BA16-7E3AFD16C06C) (Booted)
```
Uma vez que voc√™ conhece o UID, os aplicativos instalados nele podem ser encontrados em `/Users/<username>/Library/Developer/CoreSimulator/Devices/{UID}/data/Containers/Data/Application`

No entanto, surpreendentemente, voc√™ n√£o encontrar√° o aplicativo aqui. Voc√™ precisa acessar `/Users/<username>/Library/Developer/Xcode/DerivedData/{Application}/Build/Products/Debug-iphonesimulator/`

E nesta pasta voc√™ pode **encontrar o pacote do aplicativo**.

## Emulador

Corellium √© o √∫nico emulador iOS dispon√≠vel publicamente. √â uma solu√ß√£o SaaS empresarial com um modelo de licen√ßa por usu√°rio e n√£o oferece nenhum teste gratuito.

## Jailbreaking

A Apple exige estritamente que o c√≥digo executado no iPhone seja **assinado por um certificado emitido pela Apple**. **Jailbreaking** √© o processo de **contornar ativamente essas restri√ß√µes** e outros controles de seguran√ßa implementados pelo sistema operacional. Portanto, uma vez que o dispositivo √© jailbroken, a **verifica√ß√£o de integridade**, que √© respons√°vel por verificar os aplicativos instalados, √© corrigida para ser **burlada**.

{% hint style="info" %}
Ao contr√°rio do Android, **voc√™ n√£o pode alternar para o "Modo de Desenvolvedor"** no iOS para executar c√≥digo n√£o assinado/n√£o confi√°vel no dispositivo.
{% endhint %}

### Compara√ß√£o com o Root no Android

O jailbreaking do iOS √© frequentemente **comparado ao root no Android**, mas o processo √© realmente bastante **diferente**. Para explicar a diferen√ßa, vamos primeiro revisar os conceitos de "root" e "flashing" no Android.

* **Root**: Isso geralmente envolve a instala√ß√£o do bin√°rio `su` no sistema ou a substitui√ß√£o de todo o sistema por uma ROM personalizada com root. N√£o s√£o necess√°rios exploits para obter acesso root, desde que o bootloader seja acess√≠vel.
* **Flashing de ROMs personalizadas**: Isso permite substituir o sistema operacional que est√° sendo executado no dispositivo depois de desbloquear o bootloader. O bootloader pode exigir um exploit para ser desbloqueado.

**Nos dispositivos iOS, √© imposs√≠vel fazer o flashing de uma ROM personalizada** porque o bootloader do iOS **permite apenas a inicializa√ß√£o e o flashing de imagens assinadas pela Apple**. √â por isso que mesmo **imagens oficiais do iOS n√£o podem ser instaladas se n√£o forem assinadas pela Apple, e isso torna downgrades do iOS poss√≠veis apenas enquanto a vers√£o anterior do iOS ainda estiver assinada**.

O objetivo do jailbreaking √© **desabilitar as prote√ß√µes do iOS** (principalmente os mecanismos de assinatura de c√≥digo da Apple) para que **c√≥digo n√£o assinado arbitr√°rio possa ser executado no dispositivo** (por exemplo, c√≥digo personalizado ou baixado de lojas de aplicativos alternativas como Cydia ou Sileo). A palavra "jailbreak" √© uma refer√™ncia coloquial a ferramentas que automatizam o processo de desabilita√ß√£o.

### Considera√ß√µes sobre o Jailbreaking

Jailbreak em um dispositivo iOS est√° se tornando cada vez mais **complicado** porque a Apple continua fortalecendo o sistema e corrigindo as vulnerabilidades exploradas. O jailbreak se tornou um procedimento muito sens√≠vel ao tempo porque a Apple para de assinar essas vers√µes vulner√°veis relativamente pouco tempo depois de lan√ßar uma corre√ß√£o (a menos que o jailbreak se beneficie de vulnerabilidades baseadas em hardware, como o [exploit limera1n](https://www.theiphonewiki.com/wiki/Limera1n) que afeta o BootROM do iPhone 4 e iPad 1). Isso significa que **voc√™ n√£o pode fazer o downgrade para uma vers√£o espec√≠fica do iOS assim que a Apple parar de assinar o firmware**.

Se voc√™ tiver um dispositivo jailbroken que usa para testes de seguran√ßa, **mantenha-o** como est√°, a menos que voc√™ tenha certeza de que pode fazer o jailbreak novamente ap√≥s atualizar para a vers√£o mais recente do iOS.

As atualiza√ß√µes do iOS s√£o baseadas em um processo de desafio-resposta (gerando os chamados blobs SHSH como resultado). O dispositivo permitir√° a instala√ß√£o do sistema operacional apenas se a resposta ao desafio for assinada pela Apple. Isso √© o que os pesquisadores chamam de "janela de assinatura" e √© a raz√£o pela qual **voc√™ n√£o pode simplesmente armazenar o pacote de firmware OTA que voc√™ baixou e carreg√°-lo no dispositivo sempre que quiser**. Durante atualiza√ß√µes menores do iOS, duas vers√µes podem ser assinadas pela Apple (a mais recente e a vers√£o anterior do iOS). Essa √© a √∫nica situa√ß√£o em que voc√™ pode fazer o downgrade do dispositivo iOS. Voc√™ pode **verificar a janela de assinatura atual e baixar o firmware OTA do** [**site IPSW Downloads**](https://ipsw.me).

{% hint style="danger" %}
**Atualizar o sistema operacional remove o efeito do jailbreak**.
{% endhint %}

### Tipos de Jailbreak

* **Jailbreaks tethered** n√£o persistem ap√≥s reinicializa√ß√µes, portanto, reaplicar o jailbreak requer que o dispositivo esteja conectado (tethered) a um computador durante cada reinicializa√ß√£o. O dispositivo pode nem reiniciar se o computador n√£o estiver conectado.
* **Jailbreaks semi-tethered** n√£o podem ser reaplicados a menos que o dispositivo esteja conectado a um computador durante a reinicializa√ß√£o. O dispositivo tamb√©m pode inicializar no modo n√£o jailbroken por conta pr√≥pria.
* **Jailbreaks semi-untethered** permitem que o dispositivo inicialize por conta pr√≥pria, mas os patches do kernel (ou modifica√ß√µes no espa√ßo do usu√°rio) para desabilitar a assinatura de c√≥digo n√£o s√£o aplicados automaticamente. O usu√°rio deve fazer o jailbreak novamente iniciando um aplicativo ou visitando um site (n√£o requer uma conex√£o com um computador, da√≠ o termo untethered).
* **Jailbreaks untethered** s√£o a escolha mais popular para os usu√°rios finais, pois precisam ser aplicados apenas uma vez, ap√≥s o qual o dispositivo ficar√° permanentemente jailbroken.

### Ferramentas de Jailbreak

Diferentes vers√µes do iOS requerem **t√©cnicas de jailbreak diferentes**. [Verifique se h√° um jailbreak p√∫blico dispon√≠vel para a sua vers√£o do iOS](https://canijailbreak.com). Cuidado com ferramentas falsas e spyware, que muitas vezes se escondem por tr√°s de nomes de dom√≠nio semelhantes ao nome do grupo/autor do jailbreak.

Exemplos de vers√µes:

* [Checkra1n](https://checkra.in/): Funciona em dispositivos com o chip A7 e mais recentes, como o iPhone 5S at√© o iPhone X.
* [Palera1n](https://palera.in/): Dispositivos Checkm8 (A8-A11) no iOS 15.0-16.5.
* [Unc0ver](https://checkra.in/): Funciona apenas para vers√µes do iOS at√© 14.8, pois a Apple corrigiu as falhas que permitiam a execu√ß√£o do Unc0ver.

A cena de jailbreak do iOS evolui t√£o rapidamente que fornecer instru√ß√µes atualizadas √© dif√≠cil. No entanto, podemos indicar algumas fontes que s√£o atualmente confi√°veis:

* [**Can I Jailbreak?**](https://canijailbreak.com)
* [**The iPhone Wiki**](https://www.theiphonewiki.com)
* [**Redmond Pie**](https://www.redmondpie.com)
* [**Reddit Jailbreak**](https://www.reddit.com/r/jailbreak/)
* [**https://checkra.in/**](https://checkra.in)

> Observe que qualquer modifica√ß√£o que voc√™ fizer em seu dispositivo √© por sua conta e risco. Embora o jailbreak seja geralmente seguro, as coisas podem dar errado e voc√™ pode acabar danificando seu dispositivo. Nenhuma outra parte, exceto voc√™ mesmo, pode ser responsabilizada por qualquer dano.
### Benef√≠cios

O efeito colateral mais importante do Jailbreaking √© que ele **remove qualquer sandboxing implementado pelo sistema operacional**. Portanto, qualquer **aplicativo no dispositivo pode ler qualquer arquivo** no sistema de arquivos, incluindo arquivos de outros aplicativos, cookies e chaveiro.

Um dispositivo com Jailbreak permite aos usu√°rios **instalar aplicativos n√£o aprovados** e aproveitar **mais APIs**, que de outra forma n√£o seriam acess√≠veis.

{% hint style="warning" %}
**N√£o √© recomendado fazer Jailbreak no dispositivo m√≥vel para usu√°rios comuns**
{% endhint %}

### **Ap√≥s o Jailbreak**

{% content-ref url="basic-ios-testing-operations.md" %}
[basic-ios-testing-operations.md](basic-ios-testing-operations.md)
{% endcontent-ref %}

### **Detec√ß√£o de Jailbreak**

**V√°rios aplicativos tentar√£o detectar se o dispositivo m√≥vel est√° com Jailbreak e, nesse caso, o aplicativo n√£o ser√° executado**

* Ap√≥s o Jailbreak de um iOS, **arquivos e pastas geralmente s√£o instalados**, que podem ser pesquisados para determinar se o dispositivo est√° com Jailbreak.
* Em um dispositivo com Jailbreak, os aplicativos obt√™m **acesso de leitura/escrita a novos arquivos** fora da sandbox.
* Algumas **chamadas de API** se comportar√£o de maneira diferente.
* A presen√ßa do servi√ßo **OpenSSH**
* Chamar `/bin/sh` retornar√° 1 em vez de 0

**Mais informa√ß√µes sobre como detectar Jailbreak** [**aqui**](https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/jailbreak-detection-methods/)**.**

Voc√™ pode tentar evitar essas detec√ß√µes usando o comando `ios jailbreak disable` do **objection**.

## **Burlando a Detec√ß√£o de Jailbreak**

* Voc√™ pode tentar evitar essas detec√ß√µes usando o comando `ios jailbreak disable` do **objection**.
* Voc√™ tamb√©m pode instalar a ferramenta **Liberty Lite** (https://ryleyangus.com/repo/). Depois de adicionar o reposit√≥rio, o aplicativo deve aparecer na guia 'Pesquisar'

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Voc√™ trabalha em uma **empresa de ciberseguran√ßa**? Gostaria de ver sua **empresa anunciada no HackTricks**? Ou gostaria de ter acesso √† **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**? Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* **Junte-se ao** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo Telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para o** [**reposit√≥rio hacktricks**](https://github.com/carlospolop/hacktricks) **e para o** [**reposit√≥rio hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
