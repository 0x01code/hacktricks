# iOS テスト環境

<details>

<summary><strong>htARTE（HackTricks AWS Red Team Expert）</strong>を使って、ゼロからヒーローまでAWSハッキングを学びましょう！</summary>

HackTricks をサポートする他の方法:

- **HackTricks で企業を宣伝したい**、または **HackTricks をPDFでダウンロードしたい**場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
- [**公式PEASS＆HackTricksスウォッグ**](https://peass.creator-spring.com)を入手する
- [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクションを見つける
- **💬 [Discordグループ](https://discord.gg/hRep4RUj7f)**に参加するか、[telegramグループ](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)をフォローする
- **ハッキングトリックを共有するために、PRを** [**HackTricks**](https://github.com/carlospolop/hacktricks) **と** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **のGitHubリポジトリに提出してください。**

</details>

## Apple Developer Program

**プロビジョニングID** は、Appleの開発者アカウントに関連付けられた公開鍵と秘密鍵のコレクションです。アプリに署名するためには、**Apple Developer Program** に登録するために **99ドル/年** を支払う必要があります。これがないと、ソースコードからアプリケーションを実行することができません。これを行う別の方法は、**jailbrokenデバイス** を使用することです。

Xcode 7.2から、**無料のiOS開発プロビジョニングプロファイル** を作成するオプションが提供されています。これにより、実際のiPhoneでアプリケーションを書き込んでテストすることができます。_Xcode_ --> _Preferences_ --> _Accounts_ --> _+_（新しいAppli IDを追加して資格情報を入力） --> _作成したApple IDをクリック_ --> _Manage Certificates_ --> _+_（Apple Development） --> _完了_\
\_\_その後、iPhoneでアプリケーションを実行するには、まず **iPhoneがコンピュータを信頼するように指定する必要があります。** その後、Xcodeからモバイルでアプリケーションを実行しようとするとエラーが表示されます。そのため、_Settings_ --> _General_ --> _Profiles and Device Management_ --> 未信頼のプロファイルを選択して "**Trust**" をクリックします。

**同じ署名証明書で署名されたアプリケーションは、キーチェーンアイテムなどのリソースを安全な方法で共有できます。**

プロビジョニングプロファイルは、**`/Library/MobileDevice/ProvisioningProfiles`** 内の電話に保存されます。

## **シミュレータ**

{% hint style="info" %}
**シミュレータはエミュレータと同じではありません**。シミュレータはデバイスの振る舞いと機能をシミュレートするだけで、実際に使用しません。
{% endhint %}

### **シミュレータ**

シミュレータ内でのペンテストを実行することは、**jailbrokenデバイス** で行うよりも制限が多いことを知っておく必要があります。

iOSアプリを構築およびサポートするために必要なすべてのツールは、**Mac OSでのみ公式にサポート**されています。\
AppleのiOSアプリケーションの作成/デバッグ/インストルメント化のための事実上のツールは **Xcode** です。これを使用して、アプリを構築および **テスト** するために必要な他のコンポーネント（**シミュレータ**や異なる **SDKバージョン**）をダウンロードできます。\
**公式のApp Store** から Xcode をダウンロードすることを強くお勧めします。他のバージョンにはマルウェアが含まれている可能性があります。

シミュレータファイルは `/Users/<username>/Library/Developer/CoreSimulator/Devices` にあります。

シミュレータを開くには、Xcodeを実行し、_Xcodeタブ_ --> _Open Developer tools_ --> _Simulator_ をクリックします。\
\_\_次の画像では、「iPod touch \[...]」をクリックして他のデバイスを選択できます:

![](<../../.gitbook/assets/image (457).png>)

![](<../../.gitbook/assets/image (458).png>)

### シミュレータ内のアプリケーション

`/Users/<username>/Library/Developer/CoreSimulator/Devices` 内には、**インストールされたシミュレータ** がすべて含まれています。エミュレータ内で作成されたアプリケーションのファイルにアクセスしたい場合、**どのエミュレータにアプリがインストールされているか** を知るのは難しいかもしれません。正しいUIDを見つけるための迅速な方法は、シミュレータでアプリを実行し、次のコマンドを実行することです:
```bash
xcrun simctl list | grep Booted
iPhone 8 (BF5DA4F8-6BBE-4EA0-BA16-7E3AFD16C06C) (Booted)
```
## UIDの取得後、それにインストールされたアプリは`/Users/<username>/Library/Developer/CoreSimulator/Devices/{UID}/data/Containers/Data/Application`に見つけることができます。

しかし、驚くべきことに、ここにアプリケーションが見つからない場合があります。`/Users/<username>/Library/Developer/Xcode/DerivedData/{Application}/Build/Products/Debug-iphonesimulator/`にアクセスする必要があります。

そして、このフォルダーで**アプリケーションのパッケージを見つけることができます。**

## エミュレータ

Corelliumは唯一の一般に利用可能なiOSエミュレータです。これはエンタープライズSaaSソリューションであり、ユーザーライセンスモデルを採用しており、トライアルライセンスは提供されていません。

## Jailbreaking

AppleはiPhoneで実行されるコードが**Appleによって発行された証明書で署名されていることを厳密に要求**しています。**Jailbreaking**は、OSによって設定されたその他のセキュリティコントロールや制限を**積極的に回避するプロセス**です。したがって、デバイスがJailbrokenされると、インストールされているアプリをチェックする**整合性チェック**がパッチされ、**バイパス**されます。

{% hint style="info" %}
Androidとは異なり、iOSでは**"開発者モード"に切り替えることはできません**。これにより、デバイスで未署名/信頼されていないコードを実行することはできません。
{% endhint %}

### AndroidのRoot化とiOSのJailbreaking

AndroidのRootingとiOSのJailbreakingは、しばしば比較されますが、基本的に異なるプロセスです。AndroidデバイスのRootingには、`su`バイナリの**インストール**や**ルート化されたカスタムROMでシステムを置換**することが含まれる場合があります。これには、ブートローダーがアンロックされている場合、必ずしもエクスプロイトが必要ではありません。**カスタムROMのフラッシュ**は、デバイスのOSを置き換え、ブートローダーをアンロックした後に行われ、時にはエクスプロイトが必要となります。

一方、iOSデバイスは、ブートローダーがAppleの署名されたイメージのみをブートするように制限されているため、カスタムROMをフラッシュすることはできません。**iOSのJailbreaking**は、Appleのコード署名保護をバイパスして未署名のコードを実行することを目指しており、Appleの継続的なセキュリティ強化によって複雑化されています。

### Jailbreakingの課題

Appleは脆弱性を迅速にパッチするため、iOSのJailbreakingはますます困難になっています。iOSの**ダウングレード**はリリース後一定期間のみ可能であり、Jailbreakingは時間的に制約のある問題となります。セキュリティテストに使用されるデバイスは、再度Jailbreakingが保証されるまで更新されるべきではありません。

iOSのアップデートは、Appleによって制御される**チャレンジ・レスポンスメカニズム**（SHSH blobs）によって行われ、Appleの署名されたレスポンスのみがインストールを許可します。このメカニズムは、「署名ウィンドウ」として知られ、OTAファームウェアパッケージを保存して後で使用する能力を制限します。[IPSW Downloadsウェブサイト](https://ipsw.me)は、現在の署名ウィンドウを確認するためのリソースです。

### Jailbreakの種類

- **Tethered jailbreaks**は、各再起動時にコンピューターに接続する必要があります。
- **Semi-tethered jailbreaks**は、コンピューターなしで非Jailbrokenモードにブートできます。
- **Semi-untethered jailbreaks**は、コンピューターを必要とせずに手動で再Jailbreakingする必要があります。
- **Untethered jailbreaks**は、再適用の必要なしに永続的なJailbreakソリューションを提供します。

### Jailbreakingツールとリソース

JailbreakingツールはiOSのバージョンやデバイスによって異なります。[Can I Jailbreak?](https://canijailbreak.com)、[The iPhone Wiki](https://www.theiphonewiki.com)、[Reddit Jailbreak](https://www.reddit.com/r/jailbreak/)などのリソースは最新情報を提供しています。例として：

- [A7-A11チップデバイス向けのCheckra1n](https://checkra.in/)
- [Checkm8デバイス（A8-A11）向けのPalera1n](https://palera.in/)（iOS 15.0-16.5）
- [iOSバージョン14.8までのUnc0ver](https://unc0ver.dev/)

デバイスの変更にはリスクが伴い、Jailbreakingは慎重にアプローチする必要があります。

### Jailbreakingの利点とリスク

Jailbreakingは、OSによる**サンドボックスの除去**を可能にし、アプリが全体のファイルシステムにアクセスできるようにします。この自由により、非承認のアプリのインストールやより多くのAPIへのアクセスが可能となります。ただし、一般ユーザーにとっては、潜在的なセキュリティリスクやデバイスの不安定性のため、Jailbreakingは**推奨されません**。

### **Jailbreaking後**

{% content-ref url="basic-ios-testing-operations.md" %}
[basic-ios-testing-operations.md](basic-ios-testing-operations.md)
{% endcontent-ref %}

### **Jailbreakの検出**

**いくつかのアプリケーションは、モバイルがJailbrokenされているかどうかを検出しようとします。その場合、アプリケーションは実行されません**

* iOSをJailbreakした後、通常**ファイルやフォルダーがインストール**されます。これらを検索してデバイスがJailbrokenされているかどうかを判断できます。
* Jailbrokenデバイスでは、アプリケーションがサンドボックス外の新しいファイルに**読み書きアクセス**を取得します。
* 一部の**APIコール**は**異なる動作**を示す場合があります。
* **OpenSSH**サービスの存在
* `/bin/sh`を呼び出すと、0ではなく**1が返されます**

**Jailbreakingの検出方法についての詳細は**[**こちら**](https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/jailbreak-detection-methods/)**。**

これらの検出を回避するために**objection**の`ios jailbreak disable`を使用できます。

## **Jailbreakの検出回避**

* これらの検出を回避するために**objection**の`ios jailbreak disable`を使用できます。
* ツール**Liberty Lite**（https://ryleyangus.com/repo/）をインストールすることもできます。リポジトリが追加されると、アプリは「検索」タブに表示されるはずです。

## 参考文献
* [https://mas.owasp.org/MASTG/iOS/0x06b-iOS-Security-Testing/](https://mas.owasp.org/MASTG/iOS/0x06b-iOS-Security-Testing/)
