# Ambiente de Teste iOS

<details>

<summary><strong>Aprenda hacking AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras maneiras de apoiar o HackTricks:

* Se voc√™ deseja ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF** Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Obtenha o [**swag oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-nos** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para o** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) reposit√≥rios do github.

</details>

## Programa de Desenvolvedor Apple

Uma **identidade de provisionamento** √© uma cole√ß√£o de chaves p√∫blicas e privadas associadas a uma conta de desenvolvedor da Apple. Para **assinar aplicativos**, voc√™ precisa pagar **99$/ano** para se registrar no **Programa de Desenvolvedor Apple** e obter sua identidade de provisionamento. Sem isso, voc√™ n√£o poder√° executar aplicativos a partir do c√≥digo-fonte em um dispositivo f√≠sico. Outra op√ß√£o para fazer isso √© usar um **dispositivo com jailbreak**.

A partir do Xcode 7.2, a Apple forneceu uma op√ß√£o para criar um **perfil de provisionamento de desenvolvimento iOS gratuito** que permite escrever e testar seu aplicativo em um iPhone real. V√° para _Xcode_ --> _Prefer√™ncias_ --> _Contas_ --> _+_ (Adicionar novo ID de Aplicativo com suas credenciais) --> _Clique no ID Apple criado_ --> _Gerenciar Certificados_ --> _+_ (Desenvolvimento Apple) --> _Conclu√≠do_\
\_\_Ent√£o, para executar seu aplicativo em seu iPhone, voc√™ precisa primeiro **indicar ao iPhone que confie no computador**. Em seguida, voc√™ pode tentar **executar o aplicativo no celular a partir do Xcode**, mas um erro aparecer√°. Portanto, v√° para _Ajustes_ --> _Geral_ --> _Perfis e Gerenciamento de Dispositivos_ --> Selecione o perfil n√£o confi√°vel e clique em "**Confiar**".

Observe que **aplicativos assinados pelo mesmo certificado de assinatura podem compartilhar recursos de maneira segura, como itens de chaveiro**.

Os perfis de provisionamento s√£o armazenados dentro do telefone em **`/Library/MobileDevice/ProvisioningProfiles`**

## **Simulador**

{% hint style="info" %}
Observe que um **simulador n√£o √© o mesmo que um emulador**. O simulador apenas simula o comportamento do dispositivo e fun√ß√µes, mas n√£o os utiliza de fato.
{% endhint %}

### **Simulador**

A primeira coisa que voc√™ precisa saber √© que **realizar um pentest dentro de um simulador ser√° muito mais limitado do que faz√™-lo em um dispositivo com jailbreak**.

Todas as ferramentas necess√°rias para construir e dar suporte a um aplicativo iOS s√£o **oficialmente suportadas apenas no Mac OS**.\
A ferramenta padr√£o da Apple para criar/depurar/instrumentar aplicativos iOS √© o **Xcode**. Ele pode ser usado para baixar outros componentes, como **simuladores** e diferentes **vers√µes de SDK** necess√°rias para construir e **testar** seu aplicativo.\
√â altamente recomend√°vel **baixar** o Xcode da **App Store oficial**. Outras vers√µes podem conter malware.

Os arquivos do simulador podem ser encontrados em `/Users/<username>/Library/Developer/CoreSimulator/Devices`

Para abrir o simulador, execute o Xcode, em seguida, clique na aba _Xcode_ --> _Abrir Ferramentas de Desenvolvedor_ --> _Simulador_\
\_\_Na imagem a seguir, clicando em "iPod touch \[...]" voc√™ pode selecionar outro dispositivo para testar:

![](<../../.gitbook/assets/image (270).png>)

![](<../../.gitbook/assets/image (520).png>)

### Aplicativos no Simulador

Dentro de `/Users/<username>/Library/Developer/CoreSimulator/Devices`, voc√™ pode encontrar todos os **simuladores instalados**. Se voc√™ deseja acessar os arquivos de um aplicativo criado dentro de um dos emuladores, pode ser dif√≠cil saber **em qual o aplicativo est√° instalado**. Uma maneira r√°pida de **encontrar o UID correto** √© executar o aplicativo no simulador e executar:
```bash
xcrun simctl list | grep Booted
iPhone 8 (BF5DA4F8-6BBE-4EA0-BA16-7E3AFD16C06C) (Booted)
```
Uma vez que voc√™ saiba o UID, os aplicativos instalados dentro dele podem ser encontrados em `/Users/<username>/Library/Developer/CoreSimulator/Devices/{UID}/data/Containers/Data/Application`

No entanto, surpreendentemente voc√™ n√£o encontrar√° o aplicativo aqui. Voc√™ precisa acessar `/Users/<username>/Library/Developer/Xcode/DerivedData/{Application}/Build/Products/Debug-iphonesimulator/`

E nesta pasta voc√™ pode **encontrar o pacote do aplicativo.**

## Emulador

Corellium √© o √∫nico emulador iOS publicamente dispon√≠vel. √â uma solu√ß√£o SaaS empresarial com um modelo de licen√ßa por usu√°rio e n√£o oferece nenhum teste gratuito.

## Jailbreak

A Apple exige estritamente que o c√≥digo em execu√ß√£o no iPhone deve ser **assinado por um certificado emitido pela Apple**. **Jailbreaking** √© o processo de **contornar ativamente tais restri√ß√µes** e outros controles de seguran√ßa implementados pelo sistema operacional. Portanto, uma vez que o dispositivo √© jailbroken, a **verifica√ß√£o de integridade** respons√°vel por verificar os aplicativos instalados √© contornada.

{% hint style="info" %}
Ao contr√°rio do Android, **voc√™ n√£o pode alternar para o "Modo Desenvolvedor"** no iOS para executar c√≥digo n√£o confi√°vel/n√£o assinado no dispositivo.
{% endhint %}

### Rooting no Android vs. Jailbreaking no iOS

Embora frequentemente comparados, **rooting** no Android e **jailbreaking** no iOS s√£o processos fundamentalmente diferentes. O rooting de dispositivos Android pode envolver **a instala√ß√£o do bin√°rio `su`** ou **a substitui√ß√£o do sistema por uma ROM personalizada com root**, o que n√£o necessariamente requer exploits se o bootloader estiver desbloqueado. **Flashing de ROMs personalizadas** substitui o sistema operacional do dispositivo ap√≥s desbloquear o bootloader, √†s vezes exigindo um exploit.

Por outro lado, dispositivos iOS n√£o podem fazer flash de ROMs personalizadas devido √† restri√ß√£o do bootloader de apenas inicializar imagens assinadas pela Apple. **Jailbreaking no iOS** visa contornar as prote√ß√µes de assinatura de c√≥digo da Apple para executar c√≥digo n√£o assinado, um processo complicado pelas cont√≠nuas melhorias de seguran√ßa da Apple.

### Desafios do Jailbreaking

Jailbreaking no iOS est√° se tornando cada vez mais dif√≠cil √† medida que a Apple corrige rapidamente as vulnerabilidades. **Rebaixar o iOS** √© poss√≠vel apenas por um tempo limitado ap√≥s um lan√ßamento, tornando o jailbreaking uma quest√£o sens√≠vel ao tempo. Dispositivos usados para testes de seguran√ßa n√£o devem ser atualizados a menos que o re-jailbreaking seja garantido.

As atualiza√ß√µes do iOS s√£o controladas por um **mecanismo de desafio-resposta** (blobs SHSH), permitindo a instala√ß√£o apenas para respostas assinadas pela Apple. Esse mecanismo, conhecido como "janela de assinatura", limita a capacidade de armazenar e posteriormente usar pacotes de firmware OTA. O site [IPSW Downloads](https://ipsw.me) √© um recurso para verificar as janelas de assinatura atuais.

### Variedades de Jailbreak

* **Jailbreaks tethered** exigem uma conex√£o com o computador para cada reinicializa√ß√£o.
* **Jailbreaks semi-tethered** permitem a inicializa√ß√£o no modo n√£o jailbroken sem um computador.
* **Jailbreaks semi-untethered** exigem re-jailbreaking manual sem a necessidade de um computador.
* **Jailbreaks untethered** oferecem uma solu√ß√£o de jailbreak permanente sem a necessidade de reaplica√ß√£o.

### Ferramentas e Recursos de Jailbreaking

As ferramentas de jailbreaking variam de acordo com a vers√£o do iOS e o dispositivo. Recursos como [Can I Jailbreak?](https://canijailbreak.com), [The iPhone Wiki](https://www.theiphonewiki.com) e [Reddit Jailbreak](https://www.reddit.com/r/jailbreak/) fornecem informa√ß√µes atualizadas. Exemplos incluem:

* [Checkra1n](https://checkra.in/) para dispositivos com chip A7-A11.
* [Palera1n](https://palera.in/) para dispositivos Checkm8 (A8-A11) no iOS 15.0-16.5.
* [Unc0ver](https://unc0ver.dev/) para vers√µes do iOS at√© 14.8.

Modificar seu dispositivo apresenta riscos, e o jailbreaking deve ser abordado com cautela.

### Benef√≠cios e Riscos do Jailbreaking

O jailbreaking **remove o isolamento imposto pelo sistema operacional**, permitindo que os aplicativos acessem todo o sistema de arquivos. Essa liberdade possibilita a instala√ß√£o de aplicativos n√£o aprovados e o acesso a mais APIs. No entanto, para usu√°rios comuns, o jailbreaking **n√£o √© recomendado** devido aos poss√≠veis riscos de seguran√ßa e instabilidade do dispositivo.

### **Ap√≥s o Jailbreaking**

{% content-ref url="basic-ios-testing-operations.md" %}
[basic-ios-testing-operations.md](basic-ios-testing-operations.md)
{% endcontent-ref %}

### **Detec√ß√£o de Jailbreak**

**V√°rias aplica√ß√µes tentar√£o detectar se o dispositivo m√≥vel est√° jailbroken e, nesse caso, o aplicativo n√£o ser√° executado**

* Ap√≥s o jailbreak de um iOS **arquivos e pastas geralmente s√£o instalados**, que podem ser pesquisados para determinar se o dispositivo est√° jailbroken.
* Em um dispositivo jailbroken, os aplicativos obt√™m **acesso de leitura/escrita a novos arquivos** fora do sandbox
* Algumas **chamadas de API** se **comportar√£o de forma diferente**
* A presen√ßa do servi√ßo **OpenSSH**
* Chamar `/bin/sh` ir√° **retornar 1** em vez de 0

**Mais informa√ß√µes sobre como detectar jailbreaking** [**aqui**](https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/jailbreak-detection-methods/)**.**

Voc√™ pode tentar evitar essas detec√ß√µes usando `ios jailbreak disable` do **objection**

## **Bypass de Detec√ß√£o de Jailbreak**

* Voc√™ pode tentar evitar essas detec√ß√µes usando `ios jailbreak disable` do **objection**
* Voc√™ tamb√©m pode instalar a ferramenta **Liberty Lite** (https://ryleyangus.com/repo/). Uma vez que o reposit√≥rio √© adicionado, o aplicativo deve aparecer na aba ‚ÄòPesquisar‚Äô

## Refer√™ncias

* [https://mas.owasp.org/MASTG/iOS/0x06b-iOS-Security-Testing/](https://mas.owasp.org/MASTG/iOS/0x06b-iOS-Security-Testing/)

<details>

<summary><strong>Aprenda hacking AWS do zero ao hero com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras maneiras de apoiar o HackTricks:

* Se voc√™ quiser ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF** Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Obtenha o [**swag oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-nos** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para o** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
