# Entorno de Pruebas iOS

<details>

<summary><strong>Aprende hacking en AWS de cero a héroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver a tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** consulta los [**PLANES DE SUSCRIPCIÓN**](https://github.com/sponsors/carlospolop)!
* Consigue el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colección de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **Únete al** 💬 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **sígueme** en **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de GitHub** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Programa de Desarrolladores de Apple

Una **identidad de aprovisionamiento** es una colección de claves públicas y privadas que están asociadas a una cuenta de desarrollador de Apple. Para **firmar aplicaciones** necesitas pagar **99$/año** para registrarte en el **Programa de Desarrolladores de Apple** y obtener tu identidad de aprovisionamiento. Sin esto no podrás ejecutar aplicaciones desde el código fuente en un dispositivo físico. Otra opción para hacer esto es usar un **dispositivo con jailbreak**.

A partir de Xcode 7.2, Apple ha proporcionado una opción para crear un **perfil de aprovisionamiento de desarrollo de iOS gratuito** que permite escribir y probar tu aplicación en un iPhone real. Ve a _Xcode_ --> _Preferencias_ --> _Cuentas_ --> _+_ (Añadir nuevo ID de Apple a tus credenciales) --> _Haz clic en el ID de Apple creado_ --> _Gestionar Certificados_ --> _+_ (Desarrollo de Apple) --> _Hecho_\
\_\_Luego, para ejecutar tu aplicación en tu iPhone primero necesitas **indicar al iPhone que confíe en la computadora.** Después, puedes intentar **ejecutar la aplicación en el móvil desde Xcode,** pero aparecerá un error. Así que ve a _Ajustes_ --> _General_ --> _Gestión de Perfiles y Dispositivos_ --> Selecciona el perfil no confiable y haz clic en "**Confiar**".

Ten en cuenta que **las aplicaciones firmadas por el mismo certificado de firma pueden compartir recursos de manera segura, como elementos del llavero**.

Los perfiles de aprovisionamiento se almacenan dentro del teléfono en **`/Library/MobileDevice/ProvisioningProfiles`**

## **Simulador**

{% hint style="info" %}
Ten en cuenta que un **simulador no es lo mismo que un emulador**. El simulador solo simula el comportamiento del dispositivo y sus funciones pero no las utiliza realmente.
{% endhint %}

**E**l simulador del SDK de iOS ofrece una _simulación_ de nivel superior de un dispositivo iOS. Lo más importante es que los binarios del emulador están compilados para código x86 en lugar de código ARM. Las aplicaciones compiladas para un dispositivo real no se ejecutan, lo que hace que el simulador sea inútil para análisis de caja negra e ingeniería inversa.

### **Simulador**

Lo primero que necesitas saber es que **realizar un pentest dentro de un simulador será mucho más limitado que hacerlo en un dispositivo con jailbreak**.

Todas las herramientas necesarias para construir y dar soporte a una aplicación iOS están **oficialmente soportadas solo en Mac OS**.\
La herramienta de facto de Apple para crear/depurar/instrumentar aplicaciones iOS es **Xcode**. Se puede utilizar para descargar otros componentes como **simuladores** y diferentes **versiones del SDK** necesarias para construir y **probar** tu aplicación.\
Es altamente recomendable **descargar** Xcode desde la **tienda oficial de aplicaciones**. Otras versiones pueden contener malware.

Los archivos del simulador se pueden encontrar en `/Users/<username>/Library/Developer/CoreSimulator/Devices`

Para abrir el simulador, ejecuta Xcode, luego presiona en la pestaña _Xcode_ --> _Herramientas de Desarrollador Abiertas_ --> _Simulador_\
\_\_En la siguiente imagen, haciendo clic en "iPod touch \[...]" puedes seleccionar otro dispositivo para probar:

![](<../../.gitbook/assets/image (457).png>)

![](<../../.gitbook/assets/image (458).png>)

### Aplicaciones en el Simulador

Dentro de `/Users/<username>/Library/Developer/CoreSimulator/Devices` puedes encontrar todos los **simuladores instalados**. Si quieres acceder a los archivos de una aplicación creada dentro de uno de los emuladores, puede ser difícil saber **en cuál de ellos está instalada la aplicación**. Una forma rápida de **encontrar el UID correcto** es ejecutar la aplicación en el simulador y ejecutar:
```bash
xcrun simctl list | grep Booted
iPhone 8 (BF5DA4F8-6BBE-4EA0-BA16-7E3AFD16C06C) (Booted)
```
Una vez que conozcas el UID, las aplicaciones instaladas dentro de él se pueden encontrar en `/Users/<username>/Library/Developer/CoreSimulator/Devices/{UID}/data/Containers/Data/Application`

Sin embargo, sorprendentemente no encontrarás la aplicación aquí. Necesitas acceder a `/Users/<username>/Library/Developer/Xcode/DerivedData/{Application}/Build/Products/Debug-iphonesimulator/`

Y en esta carpeta puedes **encontrar el paquete de la aplicación.**

## Emulador

Corellium es el único emulador de iOS disponible públicamente. Es una solución empresarial SaaS con un modelo de licencia por usuario y no ofrece ninguna licencia de prueba.

## Jailbreaking

Apple exige estrictamente que el código que se ejecuta en el iPhone debe estar **firmado por un certificado emitido por Apple**. **Jailbreaking** es el proceso de **eludir activamente dichas restricciones** y otros controles de seguridad establecidos por el sistema operativo. Por lo tanto, una vez que el dispositivo está con jailbreak, la **verificación de integridad** que es responsable de comprobar las aplicaciones que se instalan está parcheada para que se **evite**.

{% hint style="info" %}
A diferencia de Android, **no puedes cambiar a "Modo Desarrollador"** en iOS para ejecutar código no firmado/no confiable en el dispositivo.
{% endhint %}

### Comparación con Root en Android

El jailbreaking de iOS a menudo se **compara con el rooting de Android**, pero el proceso es en realidad bastante **diferente**. Para explicar la diferencia, primero revisaremos los conceptos de "rooting" y "flasheo" en Android.

* **Rooting**: Esto generalmente implica instalar el binario `su` en el sistema o reemplazar todo el sistema con una ROM personalizada con root. No se requieren exploits para obtener acceso root siempre que el bootloader sea accesible.
* **Flasheo de ROMs personalizadas**: Esto te permite reemplazar el sistema operativo que se ejecuta en el dispositivo después de desbloquear el bootloader. El bootloader puede requerir un exploit para desbloquearlo.

**En dispositivos iOS, flashear una ROM personalizada es imposible** porque el bootloader de iOS **solo permite que se inicien y flasheen imágenes firmadas por Apple**. Por eso incluso **las imágenes oficiales de iOS no se pueden instalar si no están firmadas por Apple, y hace que las degradaciones de iOS solo sean posibles mientras la versión anterior de iOS todavía esté firmada.**

El propósito del jailbreaking es **deshabilitar las protecciones de iOS** (los mecanismos de firma de código de Apple en particular) para que **cualquier código no firmado pueda ejecutarse en el dispositivo** (por ejemplo, código personalizado o descargado de tiendas de aplicaciones alternativas como Cydia o Sileo). La palabra "jailbreak" es una referencia coloquial a las herramientas todo en uno que automatizan el proceso de deshabilitación.

### Consideraciones sobre Jailbreaking

Hacer jailbreak a un dispositivo iOS se está volviendo más y más **complicado** porque Apple sigue reforzando el sistema y parcheando las vulnerabilidades explotadas. El jailbreaking se ha convertido en un procedimiento muy sensible al tiempo porque **Apple deja de firmar estas versiones vulnerables relativamente pronto después de lanzar una solución** (a menos que el jailbreak se beneficie de vulnerabilidades basadas en hardware, como el [exploit limera1n](https://www.theiphonewiki.com/wiki/Limera1n) que afecta al BootROM del iPhone 4 y iPad 1). Esto significa que **no puedes degradar a una versión específica de iOS una vez que Apple deja de firmar el firmware**.

Si tienes un dispositivo con jailbreak que usas para pruebas de seguridad, **consérvalo** tal como está a menos que estés 100% seguro de que puedes volver a hacer jailbreak después de actualizar a la última versión de iOS.

Las actualizaciones de iOS se basan en un proceso de desafío-respuesta (generando los llamados blobs SHSH como resultado). El dispositivo permitirá la instalación del sistema operativo solo si la respuesta al desafío está firmada por Apple. Esto es lo que los investigadores llaman una "ventana de firma", y es la razón por la que **no puedes simplemente almacenar el paquete de firmware OTA que descargaste y cargarlo en el dispositivo cuando quieras**. Durante las actualizaciones menores de iOS, dos versiones pueden estar firmadas por Apple (la más reciente y la versión anterior de iOS). Esta es la única situación en la que puedes degradar el dispositivo iOS. Puedes **verificar la ventana de firma actual y descargar el firmware OTA desde el sitio web de** [**IPSW Downloads**](https://ipsw.me).

{% hint style="danger" %}
**Actualizar el sistema operativo elimina el efecto del jailbreaking.**
{% endhint %}

### Tipos de Jailbreak

* Los **jailbreaks atados** no persisten a través de reinicios, por lo que se requiere volver a aplicar el jailbreak con el dispositivo conectado (atado) a una computadora durante cada reinicio. El dispositivo puede que ni siquiera reinicie si la computadora no está conectada.
* Los **jailbreaks semi-atados** no se pueden volver a aplicar a menos que el dispositivo esté conectado a una computadora durante el reinicio. El dispositivo también puede arrancar en modo no jailbreak por sí solo.
* Los **jailbreaks semi-desatados** permiten que el dispositivo arranque por sí solo, pero los parches del kernel (o las modificaciones en el espacio de usuario) para deshabilitar la firma de código no se aplican automáticamente. El usuario debe volver a hacer jailbreak al dispositivo iniciando una aplicación o visitando un sitio web (sin requerir una conexión a una computadora, de ahí el término desatado).
* Los **jailbreaks desatados** son la opción más popular para los usuarios finales porque solo necesitan aplicarse una vez, después de lo cual el dispositivo estará permanentemente con jailbreak.

### Herramientas de Jailbreaking

Diferentes versiones de iOS requieren **diferentes técnicas de jailbreaking**. [Determina si hay un jailbreak público disponible para tu versión de iOS](https://canijailbreak.com). Ten cuidado con las herramientas falsas y el spyware, que a menudo se esconden detrás de nombres de dominio similares al nombre del grupo/autor del jailbreak.

Ejemplos de versiones:

* [Checkra1n](https://checkra.in/): Funciona en dispositivos con el chip A7 y tan nuevos como el chip A11, por ejemplo, iPhone 5S hasta iPhone X.
* [Palera1n](https://palera.in/): Dispositivos Checkm8 (A8-A11) en iOS 15.0-16.5.
* [Unc0ver](https://checkra.in/): Solo funciona para versiones de iOS hasta 14.8, ya que Apple parcheó los problemas que permitían que Unc0ver se ejecutara

La escena del jailbreak de iOS evoluciona tan rápidamente que proporcionar instrucciones actualizadas es difícil. Sin embargo, podemos señalarte algunas fuentes que actualmente son confiables:

* [**¿Puedo hacer Jailbreak?**](https://canijailbreak.com)
* [**The iPhone Wiki**](https://www.theiphonewiki.com)
* [**Redmond Pie**](https://www.redmondpie.com)
* [**Reddit Jailbreak**](https://www.reddit.com/r/jailbreak/)
* [**https://checkra.in/**](https://checkra.in)

> Ten en cuenta que cualquier modificación que hagas en tu dispositivo es bajo tu propio riesgo. Aunque el jailbreaking suele ser seguro, las cosas pueden salir mal y puedes terminar inutilizando tu dispositivo. Ninguna otra parte excepto tú mismo puede ser considerada responsable de cualquier daño.

### Beneficios

El efecto secundario más importante del Jailbreaking es que **elimina cualquier aislamiento impuesto por el sistema operativo**. Por lo tanto, cualquier **aplicación en el dispositivo puede leer cualquier archivo** en el sistema de archivos, incluidos los archivos de otras aplicaciones, cookies y llavero.

Un dispositivo con jailbreak permite a los usuarios **instalar aplicaciones no aprobadas** y aprovechar **más APIs**, a las cuales de otro modo no se tendría acceso.

{% hint style="warning" %}
**No se recomienda hacer jailbreak al móvil para usuarios regulares**
{% endhint %}

### **Después del Jailbreaking**

{% content-ref url="basic-ios-testing-operations.md" %}
[basic-ios-testing-operations.md](basic-ios-testing-operations.md)
{% endcontent-ref %}

### **Detección de Jailbreak**

**Varias aplicaciones intentarán detectar si el móvil tiene jailbreak y en ese caso la aplicación no se ejecutará**

* Después de hacer jailbreak en un iOS **se instalan usualmente archivos y carpetas**, estos se pueden buscar para determinar si el dispositivo tiene jailbreak.
* En un dispositivo con jailbreak las aplicaciones obtienen **acceso de lectura/escritura a nuevos archivos** fuera del aislamiento
* Algunas **llamadas a API** se **comportarán de manera diferente**
* La presencia del servicio **OpenSSH**
* Llamar a `/bin/sh` **devolverá 1** en lugar de 0

**Más información sobre cómo detectar jailbreaking** [**aquí**](https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/jailbreak-detection-methods/)**.**

Puedes intentar evitar estas detecciones usando `ios jailbreak disable` de **objection**

## **Evasión de Detección de Jailbreak**

* Puedes intentar evitar estas detecciones usando `ios jailbreak disable` de **objection**
* También podrías instalar la herramienta **Liberty Lite** (https://ryleyangus.com/repo/). Una vez que se añade el repositorio, la aplicación debería aparecer en la pestaña ‘Buscar’

<details>

<summary><strong>Aprende hacking en AWS de cero a héroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver a tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** Consulta los [**PLANES DE SUSCRIPCIÓN**](https://github.com/sponsors/carlospolop)!
* Consigue el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colección de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **Únete al grupo de** 💬 [**Discord**](https://discord.gg/hRep4RUj7f) o al grupo de [**telegram**](https://t.me/peass) o **sígueme** en **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de GitHub de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
