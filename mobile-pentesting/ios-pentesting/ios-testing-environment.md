<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks Cloud ☁️</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>🐦 Twitter 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 Youtube 🎥</strong></a></summary>

- **サイバーセキュリティ会社**で働いていますか？ **HackTricksで会社を宣伝**したいですか？または、**最新バージョンのPEASSを入手したり、HackTricksをPDFでダウンロード**したいですか？[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！

- [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を見つけてください。独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクションです。

- [**公式のPEASS＆HackTricksのグッズ**](https://peass.creator-spring.com)を手に入れましょう。

- [**💬**](https://emojipedia.org/speech-balloon/) [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**telegramグループ**](https://t.me/peass)に**参加**するか、**Twitter**で**フォロー**してください[**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**。**

- **ハッキングのトリックを共有するには、[hacktricksリポジトリ](https://github.com/carlospolop/hacktricks)と[hacktricks-cloudリポジトリ](https://github.com/carlospolop/hacktricks-cloud)にPRを提出してください**。

</details>


# Apple Developer Program

**プロビジョニングID**は、Appleの開発者アカウントに関連付けられた公開鍵と秘密鍵のコレクションです。アプリに署名するためには、**Apple Developer Program**に登録して**99ドル/年**を支払い、プロビジョニングIDを取得する必要があります。これがないと、ソースコードからアプリケーションを物理デバイスで実行することはできません。別のオプションとして、**脱獄されたデバイス**を使用することもできます。

Xcode 7.2以降、Appleは**無料のiOS開発プロビジョニングプロファイル**の作成オプションを提供しています。これにより、実際のiPhoneでアプリケーションを書き込みテストすることができます。_Xcode_ --> _Preferences_ --> _Accounts_ --> _+_（新しいAppli IDを追加） --> _作成したApple IDをクリック_ --> _Manage Certificates_ --> _+_（Apple Development） --> _Done_に移動します。\
__次に、iPhoneでアプリケーションを実行するためには、まず**iPhoneがコンピュータを信頼するように指示する必要があります**。その後、Xcodeからモバイルでアプリケーションを実行しようとすることができますが、エラーが表示されます。そのため、_Settings_ --> _General_ --> _Profiles and Device Management_ --> 信頼されていないプロファイルを選択し、「**Trust**」をクリックします。

同じ署名証明書で署名されたアプリケーションは、キーチェーンアイテムなどのリソースを安全な方法で共有することができます。

プロビジョニングプロファイルは、電話内の**`/Library/MobileDevice/ProvisioningProfiles`**に保存されます。

# **シミュレータ**

{% hint style="info" %}
シミュレータは**エミュレータと同じではありません**。シミュレータはデバイスの振る舞いと機能をシミュレートしますが、実際には使用しません。
{% endhint %}

**iOS SDKシミュレータ**は、iOSデバイスのより高レベルな_シミュレーション_を提供します。最も重要なことは、エミュレータのバイナリはARMコードではなくx86コードにコンパイルされます。実際のデバイス向けにコンパイルされたアプリは実行されないため、シミュレータはブラックボックス分析やリバースエンジニアリングには役立ちません。

## **シミュレータ**

最初に知っておく必要があることは、**シミュレータ内でのペンテストは、脱獄されたデバイスで行うよりも制限が多い**ということです。

iOSアプリをビルドおよびサポートするために必要なすべてのツールは、**公式にはMac OSのみでサポートされています**。\
AppleのデファクトツールであるXcodeは、iOSアプリケーションの作成/デバッグ/インストゥルメンテーションに使用できます。他のコンポーネント（シミュレータやさまざまなSDKバージョンなど）をダウンロードすることもできます。\
**公式のアプリストア**からXcodeをダウンロードすることを強くお勧めします。他のバージョンにはマルウェアが含まれている可能性があります。

シミュレータのファイルは`/Users/<username>/Library/Developer/CoreSimulator/Devices`にあります。

シミュレータを開くには、Xcodeを実行し、_Xcodeタブ_を押して _Open Developer tools_ --> _Simulator_をクリックします。\
__次の画像で「iPod touch \[...]」をクリックすると、他のデバイスを選択できます。

![](<../../.gitbook/assets/image (457).png>)

![](<../../.gitbook/assets/image (458).png>)

## シミュレータ内のアプリケーション

`/Users/<username>/Library/Developer/CoreSimulator/Devices`内には、**インストールされたシミュレータ**がすべて表示されます。エミュレータの中に作成されたアプリケーションのファイルにアクセスしたい場合、**どのエミュレータにアプリがインストールされているか**を知るのは困難かもしれません。正しいUIDを見つけるためのクイックな方法は、シミュレータでアプリを実行し、次のコマンドを実行することです：
```bash
xcrun simctl list | grep Booted
iPhone 8 (BF5DA4F8-6BBE-4EA0-BA16-7E3AFD16C06C) (Booted)
```
UIDがわかったら、それにインストールされているアプリは`/Users/<username>/Library/Developer/CoreSimulator/Devices/{UID}/data/Containers/Data/Application`に見つけることができます。

しかし、驚くべきことに、ここにアプリは見つかりません。`/Users/<username>/Library/Developer/Xcode/DerivedData/{Application}/Build/Products/Debug-iphonesimulator/`にアクセスする必要があります。

そして、このフォルダには**アプリのパッケージが見つかります**。

# エミュレータ

Corelliumは唯一の一般公開されているiOSエミュレータです。これはパーユーザーライセンスモデルを採用したエンタープライズSaaSソリューションであり、トライアルライセンスは提供されていません。

# ジェイルブレイク

AppleはiPhoneで実行されるコードが**Appleによって発行された証明書で署名されている**ことを厳密に要求しています。**ジェイルブレイク**は、OSによって設定されたこれらの制限や他のセキュリティ制御を積極的に**回避するプロセス**です。したがって、デバイスがジェイルブレイクされると、インストールされるアプリをチェックする責任がある**整合性チェック**がパッチされ、**バイパス**されます。

{% hint style="info" %}
Androidとは異なり、iOSでは「デベロッパーモード」に切り替えて未署名/信頼できないコードをデバイス上で実行することはできません。
{% endhint %}

## AndroidのRootとの比較

iOSのジェイルブレイクは、しばしばAndroidのルート化と比較されますが、プロセスは実際にはかなり**異なります**。違いを説明するために、まずAndroidの「ルート化」と「フラッシング」の概念を見直してみましょう。

* **ルート化**: これは通常、システムに`su`バイナリをインストールするか、ルート化されたカスタムROMでシステム全体を置き換えることを含みます。ブートローダーにアクセスできる限り、ルートアクセスを取得するためにはエクスプロイトは必要ありません。
* **カスタムROMのフラッシュ**: ブートローダーをアンロックした後、デバイス上で実行されているOSを置き換えることができます。ブートローダーをアンロックするためにはエクスプロイトが必要な場合があります。

**iOSデバイスでは、カスタムROMのフラッシュは不可能**です。なぜなら、iOSブートローダーは**Appleによって署名されたイメージのみ**をブートおよびフラッシュすることを許可しているからです。これが、**Appleによって署名されていない場合、公式のiOSイメージもインストールできない**理由であり、iOSのダウングレードは前のiOSバージョンがまだ署名されている限りのみ可能です。

ジェイルブレイクの目的は、iOSの保護機能（特にAppleのコード署名メカニズム）を**無効にすること**です。これにより、デバイス上で**任意の未署名コードが実行**できるようになります（カスタムコードやCydiaやSileoなどの代替アプリストアからダウンロードしたコードなど）。"ジェイルブレイク"という言葉は、無効化プロセスを自動化するオールインワンツールを指す口語的な表現です。

## ジェイルブレイクの考慮事項

iOSデバイスのジェイルブレイクは、Appleがシステムを強化し、エクスプロイトされた脆弱性を修正するため、ますます**複雑**になっています。ジェイルブレイクは非常に時間的に敏感な手順になっており、Appleが脆弱なバージョンの署名を比較的早く停止するためです（iPhone 4とiPad 1のBootROMに影響を与える[limera1nエクスプロイト](https://www.theiphonewiki.com/wiki/Limera1n)などのハードウェアベースの脆弱性を利用する場合を除く）。これは、Appleがファームウェアの署名を停止した後、特定のiOSバージョンにダウングレードできないことを意味します。

セキュリティテストに使用するジェイルブレイクされたデバイスがある場合は、最新のiOSバージョンにアップグレードした後も再ジェイルブレイクできることが100％確実でない限り、そのままにしておいてください。

iOSのアップグレードは、チャレンジ-レスポンスプロセス（いわゆるSHSHブロブを生成するプロセス）に基づいています。デバイスは、チャレンジに対する応答がAppleによって署名されている場合にのみOSのインストールを許可します。これが研究者が「署名ウィンドウ」と呼ぶものであり、**ダウンロードしたOTAファームウェアパッケージを単純に保存してデバイスにロードすることはできません**。マイナーなiOSのアップグレードでは、2つのバージョンがAppleによって署名される場合があります（最新バージョンと前のiOSバージョン）。これは、iOSデバイスをダウングレードできる唯一の状況です。現在の署名ウィンドウを確認し、OTAファームウェアをダウンロードすることができます。[IPSW Downloadsのウェブサイト](https://ipsw.me)から。

{% hint style="danger" %}
**OSを更新すると、ジェイルブレイクの効果が失われます。**
{% endhint %}

## ジェイルブレイクの種類

* **テザリングジェイルブレイク**は、再起動時に持続しないため、ジェイルブレイクを再適用するにはデバイスをコンピュータに接続する（テザリング）必要があります。コンピュータが接続されていない場合、デバイスは再起動しない場合があります。
* **セミテザリングジェイルブレイク**は、再起動時にデバイスがコンピュータに接続されていない限り、再適用することはできません。デバイスは自分自身で非ジェイルブレイクモードで起動することもできます。
* **セミアンテザリングジェイルブレイク**は、デバイスが自動的に起動できますが、コード署名の無効化のためのカーネルパッチ（またはユーザーランドの変更）は自動的に適用されません。ユーザーは、アプリを起動したり、ウェブサイトを訪れたりすることでデバイスを再ジェイルブレイクする必要があります（コンピュータへの接続は必要ありません）。
* **アンテザリングジェイルブレイク**は、一度だけ適用する必要があるため、エンドユーザーの最も人気のある選択肢です。その後、デバイスは永久にジェイルブレイクされた状態になります。

## ジェイルブレイクツール

異なるiOSバージョンには、**異なるジェイルブレイク手法**が必要です。[iOSのバージョンに公開されているジェイルブレイクがあるかどうかを判断](https://canijailbreak.com)してください。ジェイルブレイクグループ/作者の名前と似たドメイン名の背後に隠れている偽のツールやスパイウェアに注意してください。

iOSのジェイルブレイクシーンは非常に急速に進化して
## **Jailbreakingの後**

{% content-ref url="basic-ios-testing-operations.md" %}
[basic-ios-testing-operations.md](basic-ios-testing-operations.md)
{% endcontent-ref %}

## **Jailbreakの検出**

**いくつかのアプリケーションは、モバイルがjailbrokenされているかどうかを検出し、その場合はアプリケーションを実行しないようにします**

* iOSをjailbreakすると、通常は**ファイルとフォルダがインストール**されます。これらを検索してデバイスがjailbrokenであるかどうかを判断することができます。
* jailbrokenデバイスでは、アプリケーションはサンドボックスの外に**新しいファイルへの読み書きアクセス**を取得します。
* 一部の**API呼び出し**は**異なる動作**を示す場合があります。
* **OpenSSH**サービスの存在
* `/bin/sh`を呼び出すと、0ではなく1が**返されます**

**Jailbreakingの検出方法の詳細は[こちら](https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/jailbreak-detection-methods/)を参照してください。**

`objection`の`ios jailbreak disable`を使用して、この検出を回避することもできます。

# **Jailbreak Detection Bypass**

`objection`の`ios jailbreak disable`を使用して、この検出を回避することもできます。

また、ツール**Liberty Lite**（https://ryleyangus.com/repo/）をインストールすることもできます。リポジトリが追加されると、アプリが「検索」タブに表示されるはずです。


<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks Cloud ☁️</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>🐦 Twitter 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 Youtube 🎥</strong></a></summary>

- **サイバーセキュリティ企業で働いていますか？ HackTricksであなたの会社を宣伝したいですか？または、PEASSの最新バージョンやHackTricksのPDFをダウンロードしたいですか？[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！**

- [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見しましょう、私たちの独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクション

- [**公式のPEASS＆HackTricksのスワッグ**](https://peass.creator-spring.com)を手に入れましょう

- **[💬](https://emojipedia.org/speech-balloon/) Discordグループ**に参加するか、[telegramグループ](https://t.me/peass)に参加するか、**Twitter**で私をフォローする[**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**

- **ハッキングのトリックを共有するには、[hacktricks repo](https://github.com/carlospolop/hacktricks)と[hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)にPRを提出してください。**

</details>
