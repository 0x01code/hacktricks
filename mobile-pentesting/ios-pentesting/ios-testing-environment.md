# Ambiente de Teste iOS

<details>

<summary><strong>Aprenda hacking no AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ quer ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**material oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **Junte-se ao grupo** üí¨ [**Discord**](https://discord.gg/hRep4RUj7f) ou ao grupo [**telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios do GitHub** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Programa de Desenvolvedor Apple

Uma **provisioning identity** √© um conjunto de chaves p√∫blicas e privadas associadas a uma conta de desenvolvedor Apple. Para **assinar apps**, √© necess√°rio pagar **99$/ano** para se registrar no **Programa de Desenvolvedor Apple** e obter sua provisioning identity. Sem isso, voc√™ n√£o poder√° executar aplicativos a partir do c√≥digo-fonte em um dispositivo f√≠sico. Outra op√ß√£o √© usar um **dispositivo jailbroken**.

A partir do Xcode 7.2, a Apple forneceu uma op√ß√£o para criar um **perfil de provisionamento de desenvolvimento iOS gratuito** que permite escrever e testar seu aplicativo em um iPhone real. V√° para _Xcode_ --> _Prefer√™ncias_ --> _Contas_ --> _+_ (Adicionar novo ID Apple √†s suas credenciais) --> _Clique no Apple ID criado_ --> _Gerenciar Certificados_ --> _+_ (Desenvolvimento Apple) --> _Conclu√≠do_\
\_\_Ent√£o, para executar seu aplicativo no iPhone, voc√™ precisa primeiro **indicar ao iPhone para confiar no computador.** Depois, voc√™ pode tentar **executar o aplicativo no celular a partir do Xcode,** mas um erro aparecer√°. Ent√£o v√° para _Ajustes_ --> _Geral_ --> _Gerenciamento de Perfis e Dispositivos_ --> Selecione o perfil n√£o confi√°vel e clique em "**Confiar**".

Note que **aplicativos assinados pelo mesmo certificado de assinatura podem compartilhar recursos de maneira segura, como itens do keychain**.

Os perfis de provisionamento s√£o armazenados dentro do telefone em **`/Library/MobileDevice/ProvisioningProfiles`**

## **Simulador**

{% hint style="info" %}
Note que um **simulador n√£o √© o mesmo que um emulador**. O simulador apenas simula o comportamento do dispositivo e fun√ß√µes, mas n√£o as utiliza de fato.
{% endhint %}

**O** simulador do SDK iOS oferece uma _simula√ß√£o_ de n√≠vel superior de um dispositivo iOS. O mais importante √© que os bin√°rios do emulador s√£o compilados para c√≥digo x86 em vez de c√≥digo ARM. Apps compilados para um dispositivo real n√£o funcionam, tornando o simulador in√∫til para an√°lise de caixa preta e engenharia reversa.

### **Simulador**

A primeira coisa que voc√™ precisa saber √© que **realizar um pentest dentro de um simulador ser√° muito mais limitado do que faz√™-lo em um dispositivo jailbroken**.

Todas as ferramentas necess√°rias para construir e dar suporte a um app iOS s√£o **oficialmente suportadas apenas no Mac OS**.\
A ferramenta de fato da Apple para criar/debugar/instrumentar aplicativos iOS √© o **Xcode**. Ele pode ser usado para baixar outros componentes como **simuladores** e diferentes **vers√µes do SDK** necess√°rias para construir e **testar** seu app.\
√â altamente recomend√°vel **baixar** o Xcode da **loja oficial de aplicativos**. Outras vers√µes podem conter malware.

Os arquivos do simulador podem ser encontrados em `/Users/<username>/Library/Developer/CoreSimulator/Devices`

Para abrir o simulador, execute o Xcode, depois pressione na aba _Xcode_ --> _Ferramentas do Desenvolvedor Abertas_ --> _Simulador_\
\_\_Na imagem a seguir, clicando em "iPod touch \[...]" voc√™ pode selecionar outro dispositivo para testar:

![](<../../.gitbook/assets/image (457).png>)

![](<../../.gitbook/assets/image (458).png>)

### Aplicativos no Simulador

Dentro de `/Users/<username>/Library/Developer/CoreSimulator/Devices`, voc√™ pode encontrar todos os **simuladores instalados**. Se voc√™ quiser acessar os arquivos de um aplicativo criado dentro de um dos emuladores, pode ser dif√≠cil saber **em qual deles o app est√° instalado**. Uma maneira r√°pida de **encontrar o UID correto** √© executar o app no simulador e executar:
```bash
xcrun simctl list | grep Booted
iPhone 8 (BF5DA4F8-6BBE-4EA0-BA16-7E3AFD16C06C) (Booted)
```
Uma vez que voc√™ conhece o UID, os aplicativos instalados dentro dele podem ser encontrados em `/Users/<username>/Library/Developer/CoreSimulator/Devices/{UID}/data/Containers/Data/Application`

No entanto, surpreendentemente, voc√™ n√£o encontrar√° o aplicativo aqui. Voc√™ precisa acessar `/Users/<username>/Library/Developer/Xcode/DerivedData/{Application}/Build/Products/Debug-iphonesimulator/`

E nesta pasta voc√™ pode **encontrar o pacote do aplicativo.**

## Emulador

Corellium √© o √∫nico emulador de iOS dispon√≠vel publicamente. √â uma solu√ß√£o empresarial SaaS com um modelo de licen√ßa por usu√°rio e n√£o oferece nenhuma licen√ßa de teste.

## Jailbreaking

A Apple exige estritamente que o c√≥digo executado no iPhone seja **assinado por um certificado emitido pela Apple**. **Jailbreaking** √© o processo de **contornar ativamente tais restri√ß√µes** e outros controles de seguran√ßa impostos pelo sistema operacional. Portanto, uma vez que o dispositivo est√° com jailbreak, a **verifica√ß√£o de integridade**, respons√°vel por checar os aplicativos sendo instalados, √© corrigida para ser **burlada**.

{% hint style="info" %}
Ao contr√°rio do Android, **voc√™ n√£o pode mudar para o "Modo Desenvolvedor"** no iOS para executar c√≥digo n√£o assinado/n√£o confi√°vel no dispositivo.
{% endhint %}

### Compara√ß√£o com Root no Android

O jailbreaking do iOS √© frequentemente **comparado ao root no Android**, mas o processo √© na verdade bastante **diferente**. Para explicar a diferen√ßa, primeiro revisaremos os conceitos de "rooting" e "flashing" no Android.

* **Rooting**: Isso normalmente envolve instalar o bin√°rio `su` no sistema ou substituir todo o sistema por uma ROM customizada com root. Exploits n√£o s√£o necess√°rios para obter acesso root, desde que o bootloader seja acess√≠vel.
* **Flashing de ROMs customizadas**: Isso permite substituir o sistema operacional que est√° rodando no dispositivo depois de desbloquear o bootloader. O bootloader pode exigir um exploit para ser desbloqueado.

**Nos dispositivos iOS, flashar uma ROM customizada √© imposs√≠vel** porque o bootloader do iOS **permite apenas imagens assinadas pela Apple** para serem iniciadas e flashadas. √â por isso que at√© mesmo **imagens oficiais do iOS n√£o podem ser instaladas se n√£o estiverem assinadas pela Apple, e isso torna os downgrades do iOS poss√≠veis apenas enquanto a vers√£o anterior do iOS ainda estiver assinada.**

O objetivo do jailbreaking √© **desativar as prote√ß√µes do iOS** (mecanismos de assinatura de c√≥digo da Apple, em particular) para que **c√≥digo arbitr√°rio n√£o assinado possa ser executado no dispositivo** (por exemplo, c√≥digo personalizado ou baixado de lojas de aplicativos alternativas, como Cydia ou Sileo). A palavra "jailbreak" √© uma refer√™ncia coloquial √†s ferramentas all-in-one que automatizam o processo de desativa√ß√£o.

### Considera√ß√µes sobre Jailbreaking

Fazer jailbreak em um dispositivo iOS est√° se tornando cada vez mais **complicado** porque a Apple continua refor√ßando o sistema e corrigindo as vulnerabilidades exploradas. Jailbreaking tornou-se um procedimento muito sens√≠vel ao tempo porque **a Apple para de assinar essas vers√µes vulner√°veis relativamente logo ap√≥s lan√ßar uma corre√ß√£o** (a menos que o jailbreak se beneficie de vulnerabilidades baseadas em hardware, como o [exploit limera1n](https://www.theiphonewiki.com/wiki/Limera1n) que afeta o BootROM do iPhone 4 e do iPad 1). Isso significa que **voc√™ n√£o pode fazer downgrade para uma vers√£o espec√≠fica do iOS uma vez que a Apple para de assinar o firmware**.

Se voc√™ tem um dispositivo com jailbreak que usa para testes de seguran√ßa, **mantenha-o** como est√°, a menos que voc√™ esteja 100% certo de que pode fazer jailbreak novamente ap√≥s atualizar para a vers√£o mais recente do iOS.

As atualiza√ß√µes do iOS s√£o baseadas em um processo de desafio-resposta (gerando os chamados blobs SHSH como resultado). O dispositivo permitir√° a instala√ß√£o do sistema operacional apenas se a resposta ao desafio for assinada pela Apple. Isso √© o que os pesquisadores chamam de "janela de assinatura", e √© a raz√£o **pela qual voc√™ n√£o pode simplesmente armazenar o pacote de firmware OTA que baixou e carreg√°-lo no dispositivo sempre que quiser**. Durante pequenas atualiza√ß√µes do iOS, duas vers√µes podem ser assinadas pela Apple (a mais recente e a vers√£o anterior do iOS). Esta √© a √∫nica situa√ß√£o em que voc√™ pode fazer downgrade do dispositivo iOS. Voc√™ pode **verificar a janela de assinatura atual e baixar o firmware OTA do site** [**IPSW Downloads**](https://ipsw.me).

{% hint style="danger" %}
**Atualizar o sistema operacional remove o efeito do jailbreaking.**
{% endhint %}

### Tipos de Jailbreak

* **Jailbreaks tethered** n√£o persistem ap√≥s reinicializa√ß√µes, ent√£o reaplicar o jailbreak requer que o dispositivo esteja conectado (tethered) a um computador durante cada reinicializa√ß√£o. O dispositivo pode nem reiniciar se o computador n√£o estiver conectado.
* **Jailbreaks semi-tethered** n√£o podem ser reaplicados a menos que o dispositivo esteja conectado a um computador durante a reinicializa√ß√£o. O dispositivo tamb√©m pode iniciar em modo n√£o jailbroken por conta pr√≥pria.
* **Jailbreaks semi-untethered** permitem que o dispositivo inicie por conta pr√≥pria, mas os patches do kernel (ou modifica√ß√µes no espa√ßo do usu√°rio) para desativar a assinatura de c√≥digo n√£o s√£o aplicados automaticamente. O usu√°rio deve fazer jailbreak novamente no dispositivo iniciando um aplicativo ou visitando um site (n√£o requerendo conex√£o com um computador, da√≠ o termo untethered).
* **Jailbreaks untethered** s√£o a escolha mais popular para os usu√°rios finais porque precisam ser aplicados apenas uma vez, ap√≥s o qual o dispositivo permanecer√° permanentemente com jailbreak.

### Ferramentas de Jailbreaking

Vers√µes diferentes do iOS requerem **t√©cnicas diferentes de jailbreaking**. [Determine se um jailbreak p√∫blico est√° dispon√≠vel para a sua vers√£o do iOS](https://canijailbreak.com). Cuidado com ferramentas falsas e spyware, que muitas vezes se escondem atr√°s de nomes de dom√≠nio semelhantes ao nome do grupo/autor do jailbreak.

Exemplos de vers√µes:

* [Checkra1n](https://checkra.in/): Funciona em dispositivos com o chip A7 e t√£o novos quanto o chip A11, por exemplo, iPhone 5S at√© iPhone X.
* [Palera1n](https://palera.in/): Dispositivos Checkm8 (A8-A11) no iOS 15.0-16.5.
* [Unc0ver](https://checkra.in/): Funciona apenas para vers√µes do iOS at√© 14.8, j√° que a Apple corrigiu os problemas que permitiam a execu√ß√£o do Unc0ver.

A cena do jailbreak do iOS evolui t√£o rapidamente que fornecer instru√ß√µes atualizadas √© dif√≠cil. No entanto, podemos indicar algumas fontes que atualmente s√£o confi√°veis:

* [**Can I Jailbreak?**](https://canijailbreak.com)
* [**The iPhone Wiki**](https://www.theiphonewiki.com)
* [**Redmond Pie**](https://www.redmondpie.com)
* [**Reddit Jailbreak**](https://www.reddit.com/r/jailbreak/)
* [**https://checkra.in/**](https://checkra.in)

> Observe que qualquer modifica√ß√£o que voc√™ fa√ßa em seu dispositivo √© por sua pr√≥pria conta e risco. Embora o jailbreaking seja geralmente seguro, as coisas podem dar errado e voc√™ pode acabar brickando seu dispositivo. Nenhuma outra parte, exceto voc√™ mesmo, pode ser responsabilizada por qualquer dano.

### Benef√≠cios

O efeito colateral mais importante do Jailbreaking √© que ele **remove qualquer sandboxing imposto pelo sistema operacional**. Portanto, qualquer **aplicativo no dispositivo pode ler qualquer arquivo** no sistema de arquivos, incluindo arquivos de outros aplicativos, cookies e keychain.

Um dispositivo com jailbreak permite que os usu√°rios **instalem aplicativos n√£o aprovados** e utilizem **mais APIs**, que de outra forma n√£o seriam acess√≠veis.

{% hint style="warning" %}
**N√£o √© recomendado fazer jailbreak no celular para usu√°rios regulares**
{% endhint %}

### **Ap√≥s o Jailbreaking**

{% content-ref url="basic-ios-testing-operations.md" %}
[basic-ios-testing-operations.md](basic-ios-testing-operations.md)
{% endcontent-ref %}

### **Detec√ß√£o de Jailbreak**

**V√°rios aplicativos tentar√£o detectar se o celular est√° com jailbreak e, nesse caso, o aplicativo n√£o funcionar√°**

* Ap√≥s o jailbreaking, **arquivos e pastas s√£o geralmente instalados**, estes podem ser pesquisados para determinar se o dispositivo est√° com jailbreak.
* Em um dispositivo com jailbreak, os aplicativos obt√™m **acesso de leitura/escrita a novos arquivos** fora da sandbox
* Algumas **chamadas de API** se **comportar√£o de maneira diferente**
* A presen√ßa do servi√ßo **OpenSSH**
* Chamar `/bin/sh` **retornar√° 1** em vez de 0

**Mais informa√ß√µes sobre como detectar jailbreaking** [**aqui**](https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/jailbreak-detection-methods/)**.**

Voc√™ pode tentar evitar essas detec√ß√µes usando o `ios jailbreak disable` do **objection**

## **Bypass de Detec√ß√£o de Jailbreak**

* Voc√™ pode tentar evitar essas detec√ß√µes usando o `ios jailbreak disable` do **objection**
* Voc√™ tamb√©m pode instalar a ferramenta **Liberty Lite** (https://ryleyangus.com/repo/). Uma vez adicionado o reposit√≥rio, o aplicativo deve aparecer na aba ‚ÄòSearch‚Äô

<details>

<summary><strong>Aprenda hacking no AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras maneiras de apoiar o HackTricks:

* Se voc√™ quiser ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**merchandising oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **Junte-se ao grupo** üí¨ [**Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe suas dicas de hacking enviando PRs para os reposit√≥rios do GitHub** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
