# Environnement de test iOS

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Travaillez-vous dans une **entreprise de cybers√©curit√©** ? Voulez-vous voir votre **entreprise annonc√©e dans HackTricks** ? Ou voulez-vous avoir acc√®s √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFT**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**üí¨**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR au** [**repo hacktricks**](https://github.com/carlospolop/hacktricks) **et au** [**repo hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Programme de d√©veloppement Apple

Une **identit√© de provisionnement** est une collection de cl√©s publiques et priv√©es associ√©es √† un compte d√©veloppeur Apple. Pour **signer des applications**, vous devez payer **99 $/an** pour vous inscrire au **Programme de d√©veloppement Apple** et obtenir votre identit√© de provisionnement. Sans cela, vous ne pourrez pas ex√©cuter les applications √† partir du code source sur un appareil physique. Une autre option consiste √† utiliser un **appareil jailbreak√©**.

√Ä partir de Xcode 7.2, Apple a fourni une option pour cr√©er un **profil de provisionnement de d√©veloppement iOS gratuit** qui permet d'√©crire et de tester votre application sur un v√©ritable iPhone. Allez dans _Xcode_ --> _Pr√©f√©rences_ --> _Comptes_ --> _+_ (Ajouter un nouvel identifiant Apple avec vos identifiants) --> _Cliquez sur l'identifiant Apple cr√©√©_ --> _G√©rer les certificats_ --> _+_ (D√©veloppement Apple) --> _Termin√©_\
\_\_Ensuite, pour ex√©cuter votre application sur votre iPhone, vous devez d'abord **indiquer √† l'iPhone de faire confiance √† l'ordinateur**. Ensuite, vous pouvez essayer d'**ex√©cuter l'application sur le mobile depuis Xcode**, mais une erreur appara√Ætra. Allez donc dans _R√©glages_ --> _G√©n√©ral_ --> _Profils et gestion des appareils_ --> S√©lectionnez le profil non approuv√© et cliquez sur "**Faire confiance**".

Notez que **les applications sign√©es par le m√™me certificat de signature peuvent partager des ressources de mani√®re s√©curis√©e, comme les √©l√©ments du trousseau**.

Les profils de provisionnement sont stock√©s dans le t√©l√©phone dans **`/Library/MobileDevice/ProvisioningProfiles`**

## **Simulateur**

{% hint style="info" %}
Notez qu'un **simulateur n'est pas la m√™me chose qu'un √©mulateur**. Le simulateur simule simplement le comportement de l'appareil et ses fonctions, mais ne les utilise pas r√©ellement.
{% endhint %}

Le simulateur iOS SDK offre une _simulation_ de niveau sup√©rieur d'un appareil iOS. Plus important encore, les binaires de l'√©mulateur sont compil√©s en code x86 au lieu de code ARM. Les applications compil√©es pour un v√©ritable appareil ne s'ex√©cutent pas, rendant le simulateur inutile pour l'analyse en bo√Æte noire et l'ing√©nierie inverse.

### **Simulateur**

La premi√®re chose que vous devez savoir, c'est que **r√©aliser un test de p√©n√©tration dans un simulateur sera beaucoup plus limit√© que de le faire sur un appareil jailbreak√©**.

Tous les outils n√©cessaires pour cr√©er et prendre en charge une application iOS sont **officiellement pris en charge uniquement sur Mac OS**.\
L'outil de facto d'Apple pour cr√©er/d√©boguer/instrumenter des applications iOS est **Xcode**. Il peut √™tre utilis√© pour t√©l√©charger d'autres composants tels que des **simulateurs** et diff√©rentes **versions de SDK** n√©cessaires pour cr√©er et **tester** votre application.\
Il est fortement recommand√© de **t√©l√©charger** Xcode depuis l'**App Store officiel**. D'autres versions pourraient contenir des logiciels malveillants.

Les fichiers du simulateur peuvent √™tre trouv√©s dans `/Users/<nom_utilisateur>/Library/Developer/CoreSimulator/Devices`

Pour ouvrir le simulateur, lancez Xcode, puis cliquez sur l'onglet _Xcode_ --> _Outils de d√©veloppement_ --> _Simulateur_\
\_\_Dans l'image suivante, en cliquant sur "iPod touch \[...]", vous pouvez s√©lectionner un autre appareil √† tester :

![](<../../.gitbook/assets/image (457).png>)

![](<../../.gitbook/assets/image (458).png>)

### Applications dans le simulateur

√Ä l'int√©rieur de `/Users/<nom_utilisateur>/Library/Developer/CoreSimulator/Devices`, vous pouvez trouver tous les **simulateurs install√©s**. Si vous souhaitez acc√©der aux fichiers d'une application cr√©√©e dans l'un des √©mulateurs, il peut √™tre difficile de savoir **dans lequel l'application est install√©e**. Une fa√ßon rapide de **trouver l'UID correct** est d'ex√©cuter l'application dans le simulateur et d'ex√©cuter :
```bash
xcrun simctl list | grep Booted
iPhone 8 (BF5DA4F8-6BBE-4EA0-BA16-7E3AFD16C06C) (Booted)
```
Une fois que vous connaissez l'UID, les applications install√©es peuvent √™tre trouv√©es dans `/Users/<username>/Library/Developer/CoreSimulator/Devices/{UID}/data/Containers/Data/Application`.

Cependant, √©tonnamment, vous ne trouverez pas l'application ici. Vous devez acc√©der √† `/Users/<username>/Library/Developer/Xcode/DerivedData/{Application}/Build/Products/Debug-iphonesimulator/`.

Et dans ce dossier, vous pouvez **trouver le package de l'application**.

## √âmulateur

Corellium est le seul √©mulateur iOS disponible publiquement. C'est une solution SaaS d'entreprise avec un mod√®le de licence par utilisateur et ne propose aucun essai gratuit.

## Jailbreak

Apple exige strictement que le code s'ex√©cutant sur l'iPhone soit **sign√© par un certificat d√©livr√© par Apple**. Le **jailbreak** est le processus de **contournement actif de ces restrictions** et d'autres contr√¥les de s√©curit√© mis en place par le syst√®me d'exploitation. Par cons√©quent, une fois que l'appareil est jailbreak√©, la **v√©rification d'int√©grit√©** charg√©e de v√©rifier les applications install√©es est patch√©e pour √™tre **contourn√©e**.

{% hint style="info" %}
Contrairement √† Android, **vous ne pouvez pas passer en "mode d√©veloppeur"** sur iOS pour ex√©cuter du code non sign√©/non fiable sur l'appareil.
{% endhint %}

### Comparaison avec le root sur Android

Le jailbreak iOS est souvent **compar√© au root sur Android**, mais le processus est en r√©alit√© assez **diff√©rent**. Pour expliquer la diff√©rence, nous allons d'abord passer en revue les concepts de "root" et de "flashing" sur Android.

* **Root**: Cela implique g√©n√©ralement l'installation du binaire `su` sur le syst√®me ou le remplacement de l'ensemble du syst√®me par une ROM personnalis√©e root√©e. Les exploits ne sont pas n√©cessaires pour obtenir un acc√®s root tant que le chargeur de d√©marrage est accessible.
* **Flashing de ROM personnalis√©e**: Cela vous permet de remplacer le syst√®me d'exploitation qui s'ex√©cute sur l'appareil apr√®s avoir d√©verrouill√© le chargeur de d√©marrage. Le chargeur de d√©marrage peut n√©cessiter un exploit pour √™tre d√©verrouill√©.

**Sur les appareils iOS, il est impossible de flasher une ROM personnalis√©e** car le chargeur de d√©marrage iOS **ne permet de d√©marrer et de flasher que des images sign√©es par Apple**. C'est pourquoi m√™me les **images iOS officielles ne peuvent pas √™tre install√©es si elles ne sont pas sign√©es par Apple, et cela rend les r√©trogradations iOS possibles uniquement tant que la version iOS pr√©c√©dente est toujours sign√©e**.

Le but du jailbreak est de **d√©sactiver les protections d'iOS** (en particulier les m√©canismes de signature de code d'Apple) afin que du **code non sign√© arbitraire puisse s'ex√©cuter sur l'appareil** (par exemple, du code personnalis√© ou t√©l√©charg√© √† partir de magasins d'applications alternatifs tels que Cydia ou Sileo). Le mot "jailbreak" est une r√©f√©rence famili√®re √† des outils tout-en-un qui automatisent le processus de d√©sactivation.

### Consid√©rations lors du jailbreak

Le jailbreak d'un appareil iOS devient de plus en plus **compliqu√©** car Apple renforce constamment le syst√®me et corrige les vuln√©rabilit√©s exploit√©es. Le jailbreak est devenu une proc√©dure tr√®s sensible au temps car **Apple cesse de signer ces versions vuln√©rables relativement peu de temps apr√®s la sortie d'une correction** (√† moins que le jailbreak ne b√©n√©ficie de vuln√©rabilit√©s bas√©es sur le mat√©riel, telles que l'exploit [limera1n](https://www.theiphonewiki.com/wiki/Limera1n) affectant le BootROM de l'iPhone 4 et de l'iPad 1). Cela signifie que **vous ne pouvez pas r√©trograder vers une version sp√©cifique d'iOS une fois qu'Apple cesse de signer le micrologiciel**.

Si vous avez un appareil jailbreak√© que vous utilisez pour des tests de s√©curit√©, **gardez-le** tel quel √† moins d'√™tre s√ªr √† 100% que vous pouvez le re-jailbreaker apr√®s la mise √† niveau vers la derni√®re version d'iOS.

Les mises √† niveau d'iOS sont bas√©es sur un processus de d√©fi-r√©ponse (g√©n√©rant les soi-disant blobs SHSH en r√©sultat). L'appareil n'autorisera l'installation du syst√®me d'exploitation que si la r√©ponse au d√©fi est sign√©e par Apple. C'est ce que les chercheurs appellent une "fen√™tre de signature", et c'est la raison pour laquelle **vous ne pouvez pas simplement stocker le package de micrologiciel OTA que vous avez t√©l√©charg√© et le charger sur l'appareil quand vous le souhaitez**. Lors de mises √† niveau mineures d'iOS, deux versions peuvent √™tre sign√©es par Apple (la plus r√©cente et la version iOS pr√©c√©dente). C'est la seule situation dans laquelle vous pouvez r√©trograder l'appareil iOS. Vous pouvez **v√©rifier la fen√™tre de signature actuelle et t√©l√©charger le micrologiciel OTA depuis le** [**site Web IPSW Downloads**](https://ipsw.me).

{% hint style="danger" %}
**La mise √† jour du syst√®me d'exploitation supprime l'effet du jailbreak.**
{% endhint %}

### Types de jailbreak

* Les **jailbreaks tethered** ne persistent pas apr√®s les red√©marrages, donc il faut connecter (tethered) l'appareil √† un ordinateur √† chaque red√©marrage pour r√©appliquer le jailbreak. L'appareil peut ne pas red√©marrer du tout si l'ordinateur n'est pas connect√©.
* Les **jailbreaks semi-tethered** ne peuvent pas √™tre r√©appliqu√©s √† moins que l'appareil ne soit connect√© √† un ordinateur lors du red√©marrage. L'appareil peut √©galement d√©marrer en mode non jailbreak√© de lui-m√™me.
* Les **jailbreaks semi-untethered** permettent √† l'appareil de d√©marrer de lui-m√™me, mais les correctifs du noyau (ou les modifications de l'espace utilisateur) pour d√©sactiver la signature du code ne sont pas appliqu√©s automatiquement. L'utilisateur doit r√©appliquer le jailbreak de l'appareil en lan√ßant une application ou en visitant un site web (sans n√©cessiter de connexion √† un ordinateur, d'o√π le terme untethered).
* Les **jailbreaks untethered** sont le choix le plus populaire pour les utilisateurs finaux car ils ne doivent √™tre appliqu√©s qu'une seule fois, apr√®s quoi l'appareil sera jailbreak√© en permanence.

### Outils de jailbreak

Diff√©rentes versions d'iOS n√©cessitent **diff√©rentes techniques de jailbreak**. [D√©terminez si un jailbreak public est disponible pour votre version d'iOS](https://canijailbreak.com). M√©fiez-vous des outils et des logiciels espions falsifi√©s, qui se cachent souvent derri√®re des noms de domaine similaires au nom du groupe/auteur de jailbreak.

Exemples de versions :

* [Checkra1n](https://checkra.in/) : Fonctionne sur les appareils √©quip√©s de la puce A7 et aussi r√©cents que la puce A11, par exemple l'iPhone 5S jusqu'√† l'iPhone X.
* [Palera1n](https://palera.in/) : Appareils Checkm8 (A8-A11) sous iOS 15.0-16.5.
* [Unc0ver](https://checkra.in/) : Fonctionne uniquement pour les versions d'iOS jusqu'√† 14.8, car Apple a corrig√© les probl√®mes qui permettaient √† Unc0ver de s'ex√©cuter.

La sc√®ne du jailbreak iOS √©volue si rapidement qu'il est difficile de fournir des instructions √† jour. Cependant, nous pouvons vous orienter vers certaines sources qui sont actuellement fiables :

* [**Can I Jailbreak?**](https://canijailbreak.com)
* [**The iPhone Wiki**](https://www.theiphonewiki.com)
* [**Redmond Pie**](https://www.redmondpie.com)
* [**Reddit Jailbreak**](https://www.reddit.com/r/jailbreak/)
* [**https://checkra.in/**](https://checkra.in)

> Notez que toute modification que vous apportez √† votre appareil se fait √† vos propres risques. Bien que le jailbreak soit g√©n√©ralement s√ªr, des probl√®mes peuvent survenir et vous risquez de rendre votre appareil inutilisable. Aucune autre partie que vous-m√™me ne peut √™tre tenue responsable de tout dommage.
### Avantages

L'effet secondaire le plus important du Jailbreaking est qu'il **supprime toute sandbox mise en place par le syst√®me d'exploitation**. Par cons√©quent, **toute application sur l'appareil peut lire n'importe quel fichier** sur le syst√®me de fichiers, y compris les fichiers des autres applications, les cookies et le trousseau.

Un appareil jailbreak√© permet aux utilisateurs d'**installer des applications non approuv√©es** et d'exploiter **plus d'API**, qui ne sont normalement pas accessibles.

{% hint style="warning" %}
**Il n'est pas recommand√© de jailbreaker le mobile pour les utilisateurs r√©guliers**
{% endhint %}

### **Apr√®s le Jailbreaking**

{% content-ref url="basic-ios-testing-operations.md" %}
[basic-ios-testing-operations.md](basic-ios-testing-operations.md)
{% endcontent-ref %}

### **D√©tection du Jailbreak**

**Plusieurs applications essaieront de d√©tecter si le mobile est jailbreak√© et, dans ce cas, l'application ne se lancera pas**

* Apr√®s le jailbreak d'un iOS, **des fichiers et des dossiers sont g√©n√©ralement install√©s**, qui peuvent √™tre recherch√©s pour d√©terminer si l'appareil est jailbreak√©.
* Sur un appareil jailbreak√©, les applications obtiennent un **acc√®s en lecture/√©criture √† de nouveaux fichiers** en dehors de la sandbox.
* Certains **appels d'API** se comporteront diff√©remment.
* La pr√©sence du service **OpenSSH**.
* L'appel √† `/bin/sh` renverra **1** au lieu de 0.

**Plus d'informations sur la fa√ßon de d√©tecter le jailbreak** [**ici**](https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/jailbreak-detection-methods/)**.**

Vous pouvez essayer d'√©viter ces d√©tections en utilisant la commande `ios jailbreak disable` de **objection**.

## **Contournement de la d√©tection du Jailbreak**

* Vous pouvez essayer d'√©viter ces d√©tections en utilisant la commande `ios jailbreak disable` de **objection**.
* Vous pouvez √©galement installer l'outil **Liberty Lite** (https://ryleyangus.com/repo/). Une fois le r√©f√©rentiel ajout√©, l'application devrait appara√Ætre dans l'onglet "Recherche".

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Vous travaillez dans une **entreprise de cybers√©curit√©** ? Vous voulez voir votre **entreprise annonc√©e dans HackTricks** ? ou voulez-vous avoir acc√®s √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**üí¨**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR au** [**repo hacktricks**](https://github.com/carlospolop/hacktricks) **et au** [**repo hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
