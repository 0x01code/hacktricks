# Ambiente di Testing iOS

<details>

<summary><strong>Impara l'hacking AWS da zero a eroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Esperto Red Team AWS di HackTricks)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se vuoi vedere la tua **azienda pubblicizzata su HackTricks** o **scaricare HackTricks in PDF** Controlla i [**PIANI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale di PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**La Famiglia PEASS**](https://opensea.io/collection/the-peass-family), la nostra collezione di [**NFT esclusivi**](https://opensea.io/collection/the-peass-family)
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR a** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos di github.

</details>

## Programma per Sviluppatori Apple

Un **identit√† di provisioning** √® una collezione di chiavi pubbliche e private associate a un account sviluppatore Apple. Per **firmare le app** √® necessario pagare **99$/anno** per registrarsi al **Programma per Sviluppatori Apple** per ottenere la tua identit√† di provisioning. Senza di essa non sar√† possibile eseguire le applicazioni dal codice sorgente su un dispositivo fisico. Un'altra opzione √® utilizzare un **dispositivo jailbroken**.

A partire da Xcode 7.2 Apple ha fornito un'opzione per creare un **profilo di provisioning di sviluppo iOS gratuito** che consente di scrivere e testare la tua applicazione su un vero iPhone. Vai su _Xcode_ --> _Preferenze_ --> _Account_ --> _+_ (Aggiungi nuovo ID App ai tuoi credenziali) --> _Fai clic sull'ID Apple creato_ --> _Gestisci Certificati_ --> _+_ (Sviluppo Apple) --> _Fatto_\
\_\_Quindi, per eseguire la tua applicazione sul tuo iPhone, devi prima **indicare all'iPhone di fidarsi del computer**. Quindi, puoi provare a **eseguire l'applicazione sul cellulare da Xcode**, ma apparir√† un errore. Quindi vai su _Impostazioni_ --> _Generale_ --> _Profili e Gestione Dispositivi_ --> Seleziona il profilo non attendibile e clicca su "**Fidati**".

Nota che **le applicazioni firmate dallo stesso certificato di firma possono condividere risorse in modo sicuro, come gli elementi del portachiavi**.

I profili di provisioning sono memorizzati all'interno del telefono in **`/Library/MobileDevice/ProvisioningProfiles`**

## **Simulatore**

{% hint style="info" %}
Nota che un **simulatore non √® la stessa cosa di un emulatore**. Il simulatore simula solo il comportamento del dispositivo e le funzioni ma non le utilizza effettivamente.
{% endhint %}

### **Simulatore**

La prima cosa che devi sapere √® che **effettuare un pentest all'interno di un simulatore sar√† molto pi√π limitato rispetto a farlo in un dispositivo jailbroken**.

Tutti gli strumenti necessari per creare e supportare un'app iOS sono **ufficialmente supportati solo su Mac OS**.\
Lo strumento di fatto di Apple per creare/debuggare/strumentare le applicazioni iOS √® **Xcode**. Pu√≤ essere utilizzato per scaricare altri componenti come **simulatori** e diverse **versioni SDK** richieste per compilare e **testare** la tua app.\
√à altamente consigliato **scaricare** Xcode dall'**App Store ufficiale**. Altre versioni potrebbero contenere malware.

I file del simulatore possono essere trovati in `/Users/<username>/Library/Developer/CoreSimulator/Devices`

Per aprire il simulatore, esegui Xcode, quindi premi sulla scheda _Xcode_ --> _Apri strumenti per sviluppatori_ --> _Simulatore_\
\_\_Nell'immagine seguente cliccando su "iPod touch \[...]" puoi selezionare un altro dispositivo su cui fare il test:

![](<../../.gitbook/assets/image (270).png>)

![](<../../.gitbook/assets/image (520).png>)

### Applicazioni nel Simulatore

All'interno di `/Users/<username>/Library/Developer/CoreSimulator/Devices` potresti trovare tutti i **simulatori installati**. Se desideri accedere ai file di un'applicazione creata all'interno di uno dei simulatori, potrebbe essere difficile sapere **in quale √® installata l'app**. Un modo rapido per **trovare l UID corretto** √® eseguire l'applicazione nel simulatore ed eseguire:
```bash
xcrun simctl list | grep Booted
iPhone 8 (BF5DA4F8-6BBE-4EA0-BA16-7E3AFD16C06C) (Booted)
```
Una volta che conosci l'UID le app installate al suo interno possono essere trovate in `/Users/<username>/Library/Developer/CoreSimulator/Devices/{UID}/data/Containers/Data/Application`

Tuttavia, sorprendentemente non troverai l'applicazione qui. √à necessario accedere a `/Users/<username>/Library/Developer/Xcode/DerivedData/{Application}/Build/Products/Debug-iphonesimulator/`

E in questa cartella puoi **trovare il pacchetto dell'applicazione.**

## Emulatore

Corellium √® l'unico emulatore iOS disponibile pubblicamente. Si tratta di una soluzione SaaS aziendale con un modello di licenza per utente e non offre alcuna licenza di prova.

## Jailbreak

Apple richiede rigorosamente che il codice in esecuzione sull'iPhone debba essere **firmato da un certificato rilasciato da Apple**. Il **jailbreaking** √® il processo di **aggirare attivamente tali restrizioni** e altri controlli di sicurezza messi in atto dal sistema operativo. Pertanto, una volta che il dispositivo √® stato jailbroken, il **controllo di integrit√†** responsabile del controllo delle app installate viene patchato in modo da essere **bypassato**.

{% hint style="info" %}
A differenza di Android, **non √® possibile passare alla "Modalit√† Sviluppatore"** in iOS per eseguire codice non firmato/non attendibile sul dispositivo.
{% endhint %}

### Rooting Android vs. Jailbreaking iOS

Sebbene spesso comparati, il **rooting** su Android e il **jailbreaking** su iOS sono processi fondamentalmente diversi. Il rooting dei dispositivi Android potrebbe coinvolgere **l'installazione del binario `su`** o **la sostituzione del sistema con una ROM personalizzata con root**, il che non richiede necessariamente exploit se il bootloader √® sbloccato. **Flashare ROM personalizzate** sostituisce il sistema operativo del dispositivo dopo lo sblocco del bootloader, talvolta richiedendo un exploit.

Al contrario, i dispositivi iOS non possono flashare ROM personalizzate a causa della restrizione del bootloader a immagini firmate da Apple. Il **jailbreaking di iOS** mira a aggirare le protezioni di firma del codice di Apple per eseguire codice non firmato, un processo complicato dagli continui miglioramenti della sicurezza di Apple.

### Sfide del Jailbreaking

Il jailbreaking di iOS √® sempre pi√π difficile poich√© Apple patcha rapidamente le vulnerabilit√†. Il **downgrade di iOS** √® possibile solo per un periodo limitato dopo un rilascio, rendendo il jailbreaking una questione legata al tempo. I dispositivi utilizzati per test di sicurezza non dovrebbero essere aggiornati a meno che non sia garantito un nuovo jailbreak.

Gli aggiornamenti di iOS sono controllati da un **meccanismo di sfida-risposta** (blob SHSH), che consente l'installazione solo per risposte firmate da Apple. Questo meccanismo, noto come "finestra di firma", limita la capacit√† di archiviare e utilizzare successivamente pacchetti firmware OTA. Il sito web [IPSW Downloads](https://ipsw.me) √® una risorsa per verificare le attuali finestre di firma.

### Varianti di Jailbreak

* I **jailbreak tethered** richiedono una connessione al computer per ogni riavvio.
* I **jailbreak semi-tethered** consentono di avviare la modalit√† non jailbroken senza un computer.
* I **jailbreak semi-untethered** richiedono un re-jailbreaking manuale senza la necessit√† di un computer.
* I **jailbreak untethered** offrono una soluzione di jailbreak permanente senza la necessit√† di riapplicazione.

### Strumenti e Risorse per il Jailbreaking

Gli strumenti di jailbreaking variano in base alla versione di iOS e al dispositivo. Risorse come [Can I Jailbreak?](https://canijailbreak.com), [The iPhone Wiki](https://www.theiphonewiki.com) e [Reddit Jailbreak](https://www.reddit.com/r/jailbreak/) forniscono informazioni aggiornate. Esempi includono:

* [Checkra1n](https://checkra.in/) per dispositivi con chip A7-A11.
* [Palera1n](https://palera.in/) per dispositivi Checkm8 (A8-A11) su iOS 15.0-16.5.
* [Unc0ver](https://unc0ver.dev/) per versioni di iOS fino a 14.8.

Modificare il proprio dispositivo comporta rischi e il jailbreaking dovrebbe essere affrontato con cautela.

### Benefici e Rischi del Jailbreaking

Il jailbreaking **rimuove il sandboxing imposto dal sistema operativo**, consentendo alle app di accedere all'intero filesystem. Questa libert√† consente l'installazione di app non approvate e l'accesso a pi√π API. Tuttavia, per gli utenti comuni, il jailbreaking **non √® raccomandato** a causa dei potenziali rischi per la sicurezza e dell'instabilit√† del dispositivo.

### **Dopo il Jailbreaking**

{% content-ref url="basic-ios-testing-operations.md" %}
[basic-ios-testing-operations.md](basic-ios-testing-operations.md)
{% endcontent-ref %}

### **Rilevamento del Jailbreak**

**Diverse applicazioni cercheranno di rilevare se il dispositivo mobile √® jailbroken e in tal caso l'applicazione non verr√† eseguita**

* Dopo il jailbreaking di un iOS **vengono solitamente installati file e cartelle**, che possono essere cercati per determinare se il dispositivo √® jailbroken.
* In un dispositivo jailbroken le applicazioni ottengono **accesso in lettura/scrittura a nuovi file** al di fuori del sandbox
* Alcune **chiamate API** si **comporteranno in modo diverso**
* La presenza del servizio **OpenSSH**
* Chiamare `/bin/sh` restituir√† 1 invece di 0

**Ulteriori informazioni su come rilevare il jailbreaking** [**qui**](https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/jailbreak-detection-methods/)**.**

Puoi provare a evitare questi rilevamenti utilizzando `ios jailbreak disable` di **objection**

## **Bypass del Rilevamento del Jailbreak**

* Puoi provare a evitare questi rilevamenti utilizzando `ios jailbreak disable` di **objection**
* Potresti anche installare lo strumento **Liberty Lite** (https://ryleyangus.com/repo/). Una volta aggiunto il repository, l'applicazione dovrebbe apparire nella scheda 'Cerca'

## Riferimenti

* [https://mas.owasp.org/MASTG/iOS/0x06b-iOS-Security-Testing/](https://mas.owasp.org/MASTG/iOS/0x06b-iOS-Security-Testing/)

<details>

<summary><strong>Impara l'hacking di AWS da zero a eroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se desideri vedere la tua **azienda pubblicizzata in HackTricks** o **scaricare HackTricks in PDF** Controlla i [**PIANI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**The PEASS Family**](https://opensea.io/collection/the-peass-family), la nostra collezione di esclusive [**NFT**](https://opensea.io/collection/the-peass-family)
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR ai** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
