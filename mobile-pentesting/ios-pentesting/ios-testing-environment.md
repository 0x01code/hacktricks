# iOS テスト環境

<details>

<summary><strong>htARTE（HackTricks AWS Red Team Expert）</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>でAWSハッキングをゼロからヒーローまで学ぶ</strong></a><strong>！</strong></summary>

HackTricks をサポートする他の方法:

- **HackTricks で企業を宣伝したい**または**HackTricksをPDFでダウンロードしたい**場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
- [**公式PEASS＆HackTricksスワッグ**](https://peass.creator-spring.com)を入手する
- [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFT**](https://opensea.io/collection/the-peass-family)コレクションを見つける
- **💬 [Discordグループ](https://discord.gg/hRep4RUj7f)**に参加するか、[telegramグループ](https://t.me/peass)に参加するか、**Twitter**で私をフォローする🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
- **ハッキングトリックを共有するには、PRを** [**HackTricks**](https://github.com/carlospolop/hacktricks) **および** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **のGitHubリポジトリに提出してください。**

</details>

## Apple Developer Program

**プロビジョニングID**は、Apple開発者アカウントに関連付けられた公開および秘密キーのコレクションです。アプリに署名するには、**Apple Developer Program** に登録するために **99ドル/年** を支払う必要があります。これがないと、ソースコードからアプリケーションを物理デバイスで実行することはできません。これを行う別の方法は、**jailbrokenデバイス**を使用することです。

Xcode 7.2から、**無料のiOS開発プロビジョニングプロファイル**を作成するオプションが提供されています。これにより、実際のiPhoneでアプリケーションを作成およびテストできます。_Xcode_ --> _Preferences_ --> _Accounts_ --> _+_（新しいAppli IDを追加して資格情報を入力） --> _作成したApple IDをクリック_ --> _Manage Certificates_ --> _+_（Apple Development） --> _完了_\
\_\_その後、iPhoneでアプリケーションを実行するには、まず**iPhoneがコンピュータを信頼するように指定する必要があります。** その後、Xcodeから**モバイルでアプリケーションを実行**しようとするとエラーが表示されます。そのため、_Settings_ --> _General_ --> _Profiles and Device Management_ --> 信頼できないプロファイルを選択して "**Trust**" をクリックします。

**同じ署名証明書で署名されたアプリケーションは、キーチェーンアイテムなどのリソースを安全な方法で共有できます。**

プロビジョニングプロファイルは、**`/Library/MobileDevice/ProvisioningProfiles`** 内に保存されます。

## **シミュレータ**

{% hint style="info" %}
**シミュレータはエミュレータと同じではありません**。シミュレータはデバイスの動作と機能をシミュレートしますが、実際には使用しません。
{% endhint %}

### **シミュレータ**

シミュレータ内での**ペンテストを実行することは、jailbrokenデバイスで行うよりも制限が多い**ことに注意してください。

iOSアプリを構築およびサポートするために必要なすべてのツールは、**公式にはMac OSのみでサポート**されています。\
AppleのiOSアプリケーションの作成/デバッグ/インストゥルメンテーションのための事実上のツールは **Xcode** です。これを使用して、アプリを構築および**テスト**するために必要な**シミュレータ**や異なる**SDKバージョン**などの他のコンポーネントをダウンロードできます。\
**公式のApp Store** から Xcode をダウンロードすることを強くお勧めします。他のバージョンにはマルウェアが含まれている可能性があります。

シミュレータファイルは `/Users/<username>/Library/Developer/CoreSimulator/Devices` にあります。

シミュレータを開くには、Xcodeを実行し、_Xcodeタブ_ --> _Open Developer tools_ --> _Simulator_ をクリックします。\
\_\_次の画像では、「iPod touch \[...]」をクリックして他のデバイスを選択できます:

![](<../../.gitbook/assets/image (457).png>)

![](<../../.gitbook/assets/image (458).png>)

### シミュレータ内のアプリケーション

`/Users/<username>/Library/Developer/CoreSimulator/Devices` 内には、**インストールされたシミュレータ**がすべて含まれています。エミュレータの中で作成されたアプリケーションのファイルにアクセスしたい場合、**どのエミュレータにアプリがインストールされているか**を知るのは難しいかもしれません。正しいUIDを見つけるための迅速な方法は、シミュレータでアプリを実行し、次のコマンドを実行することです:
```bash
xcrun simctl list | grep Booted
iPhone 8 (BF5DA4F8-6BBE-4EA0-BA16-7E3AFD16C06C) (Booted)
```
## UIDの取得後、それにインストールされたアプリは`/Users/<username>/Library/Developer/CoreSimulator/Devices/{UID}/data/Containers/Data/Application`に見つけることができます。

しかし、驚くべきことに、ここにアプリケーションが見つからない場合があります。`/Users/<username>/Library/Developer/Xcode/DerivedData/{Application}/Build/Products/Debug-iphonesimulator/`にアクセスする必要があります。

そして、このフォルダーで**アプリケーションのパッケージを見つけることができます。**

## エミュレータ

Corelliumは唯一の一般公開されているiOSエミュレータです。これはエンタープライズSaaSソリューションであり、ユーザーライセンスモデルを採用しており、トライアルライセンスは提供されていません。

## Jailbreaking

AppleはiPhoneで実行されるコードが**Appleによって発行された証明書で署名されていることを厳密に要求**しています。**Jailbreaking**は、OSによって設定されたその他のセキュリティコントロールや制限を**回避するプロセス**です。したがって、デバイスがjailbrokenされると、インストールされているアプリをチェックする**整合性チェック**がパッチされ、**バイパス**されます。

{% hint style="info" %}
Androidとは異なり、iOSでは"デベロッパーモード"に切り替えて未署名/信頼されていないコードをデバイスで実行することはできません。
{% endhint %}

### AndroidのRootingとiOSのJailbreaking

頻繁に比較されるAndroidの**rooting**とiOSの**jailbreaking**は基本的に異なるプロセスです。Androidデバイスのrootingには、`su`バイナリの**インストール**やルート化されたカスタムROMでシステムを**置換**することが含まれる場合がありますが、ブートローダーがアンロックされている場合は必ずしもエクスプロイトが必要ではありません。ブートローダーをアンロックした後、**カスタムROMをフラッシュ**することでデバイスのOSを置き換えることができ、時にはエクスプロイトが必要となります。

一方、iOSデバイスはブートローダーがAppleの署名されたイメージのみをブートするように制限されているため、カスタムROMをフラッシュすることはできません。**Jailbreaking iOS**は、Appleのコード署名保護をバイパスして未署名のコードを実行することを目指し、Appleの継続的なセキュリティ強化によって複雑化されたプロセスです。

### Jailbreakingの課題

Appleは脆弱性を迅速にパッチするため、iOSのJailbreakingはますます困難になっています。iOSの**ダウングレード**はリリース後一定期間のみ可能であり、Jailbreakingは時間的に制約のある問題となります。セキュリティテストに使用されるデバイスは、再度Jailbreakingが保証されるまで更新されないようにする必要があります。

iOSのアップデートは**チャレンジ・レスポンスメカニズム**（SHSH blobs）によって制御され、Appleの署名されたレスポンスのみインストールが許可されます。このメカニズムは、「署名ウィンドウ」として知られ、OTAファームウェアパッケージを保存して後で使用する能力を制限します。[IPSW Downloadsウェブサイト](https://ipsw.me)は、現在の署名ウィンドウを確認するためのリソースです。

### Jailbreakの種類

- **Tethered jailbreaks**は、各再起動時にコンピューターに接続する必要があります。
- **Semi-tethered jailbreaks**は、コンピューターなしで非jailbrokenモードにブートできます。
- **Semi-untethered jailbreaks**は、コンピューターを必要とせずに手動で再度jailbreakingする必要があります。
- **Untethered jailbreaks**は、再適用の必要なしに永続的なjailbreakソリューションを提供します。

### Jailbreakingツールとリソース

JailbreakingツールはiOSのバージョンやデバイスによって異なります。[Can I Jailbreak?](https://canijailbreak.com)、[The iPhone Wiki](https://www.theiphonewiki.com)、[Reddit Jailbreak](https://www.reddit.com/r/jailbreak/)などのリソースは最新情報を提供しています。例として：

- [Checkra1n](https://checkra.in/)はA7-A11チップデバイス向けです。
- [Palera1n](https://palera.in/)はCheckm8デバイス（A8-A11）向けで、iOS 15.0-16.5をサポートしています。
- [Unc0ver](https://unc0ver.dev/)はiOS 14.8までのバージョンをサポートしています。

デバイスを変更することにはリスクが伴いますので、Jailbreakingは慎重にアプローチする必要があります。

### Jailbreakingの利点とリスク

JailbreakingはOSによる**サンドボックス制限を解除**し、アプリが全体のファイルシステムにアクセスできるようにします。この自由により、非承認のアプリのインストールやより多くのAPIへのアクセスが可能となります。ただし、一般ユーザーにとっては、潜在的なセキュリティリスクやデバイスの不安定性のため、Jailbreakingは**推奨されません**。

### **Jailbreaking後**

{% content-ref url="basic-ios-testing-operations.md" %}
[basic-ios-testing-operations.md](basic-ios-testing-operations.md)
{% endcontent-ref %}

### **Jailbreakの検出**

**いくつかのアプリケーションは、モバイルがjailbrokenされているかどうかを検出しようとします。その場合、アプリケーションは実行されません**

* iOSをjailbreakした後、通常**ファイルやフォルダーがインストール**されます。これらを検索してデバイスがjailbrokenされているかどうかを判断できます。
* Jailbrokenデバイスでは、アプリケーションがサンドボックス外の新しいファイルに**読み書きアクセス**を取得します。
* 一部の**APIコール**は**異なる動作**を示す場合があります。
* **OpenSSH**サービスの存在
* `/bin/sh`を呼び出すと、0ではなく**1が返されます**

**Jailbreakingの検出方法についての詳細は**[**こちら**](https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/jailbreak-detection-methods/)**を参照してください。**

これらの検出を回避するために**objection**の`ios jailbreak disable`を使用することができます。

## **Jailbreakの検出回避**

* これらの検出を回避するために**objection**の`ios jailbreak disable`を使用することができます。
* ツール**Liberty Lite**（https://ryleyangus.com/repo/）をインストールすることもできます。リポジトリが追加されると、アプリは「検索」タブに表示されるはずです。

## 参考文献
* [https://mas.owasp.org/MASTG/iOS/0x06b-iOS-Security-Testing/](https://mas.owasp.org/MASTG/iOS/0x06b-iOS-Security-Testing/)
