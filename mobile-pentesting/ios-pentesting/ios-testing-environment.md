# Entorno de Pruebas de iOS

<details>

<summary><strong>Aprende a hackear AWS desde cero hasta convertirte en un experto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si deseas ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** 춰Consulta los [**PLANES DE SUSCRIPCI칍N**](https://github.com/sponsors/carlospolop)!
* Obt칠n el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci칩n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s칤guenos** en **Twitter** 游냕 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Programa de Desarrolladores de Apple

Una **identidad de aprovisionamiento** es una colecci칩n de claves p칰blicas y privadas asociadas a una cuenta de desarrollador de Apple. Para **firmar aplicaciones**, necesitas pagar **99$/a침o** para registrarte en el **Programa de Desarrolladores de Apple** y obtener tu identidad de aprovisionamiento. Sin esto, no podr치s ejecutar aplicaciones desde el c칩digo fuente en un dispositivo f칤sico. Otra opci칩n es usar un **dispositivo con jailbreak**.

A partir de Xcode 7.2, Apple ha proporcionado una opci칩n para crear un **perfil de aprovisionamiento de desarrollo de iOS gratuito** que permite escribir y probar tu aplicaci칩n en un iPhone real. Ve a _Xcode_ --> _Preferencias_ --> _Cuentas_ --> _+_ (Agregar nuevo ID de aplicaci칩n con tus credenciales) --> _Haz clic en el ID de Apple creado_ --> _Gestionar Certificados_ --> _+_ (Desarrollo de Apple) --> _Hecho_\
\_\_Luego, para ejecutar tu aplicaci칩n en tu iPhone, primero debes **indicar al iPhone que conf칤e en la computadora**. Luego, puedes intentar **ejecutar la aplicaci칩n en el m칩vil desde Xcode**, pero aparecer치 un error. Entonces ve a _Ajustes_ --> _General_ --> _Perfiles y Administraci칩n de Dispositivos_ --> Selecciona el perfil no confiable y haz clic en "**Confiar**".

Ten en cuenta que **las aplicaciones firmadas por el mismo certificado de firma pueden compartir recursos de manera segura, como elementos del llavero**.

Los perfiles de aprovisionamiento se almacenan dentro del tel칠fono en **`/Library/MobileDevice/ProvisioningProfiles`**

## **Simulador**

{% hint style="info" %}
Ten en cuenta que un **simulador no es lo mismo que un emulador**. El simulador solo simula el comportamiento del dispositivo y sus funciones, pero no las utiliza realmente.
{% endhint %}

### **Simulador**

Lo primero que debes saber es que **realizar una prueba de penetraci칩n dentro de un simulador ser치 mucho m치s limitado que hacerlo en un dispositivo con jailbreak**.

Todas las herramientas necesarias para construir y soportar una aplicaci칩n de iOS **solo son oficialmente compatibles en Mac OS**.\
La herramienta de facto de Apple para crear/depurar/instrumentar aplicaciones de iOS es **Xcode**. Se puede utilizar para descargar otros componentes como **simuladores** y diferentes **versiones de SDK** requeridas para construir y **probar** tu aplicaci칩n.\
Es altamente recomendable **descargar** Xcode desde la **tienda de aplicaciones oficial**. Otras versiones pueden contener malware.

Los archivos del simulador se pueden encontrar en `/Users/<nombredeusuario>/Library/Developer/CoreSimulator/Devices`

Para abrir el simulador, ejecuta Xcode, luego presiona en la pesta침a _Xcode_ --> _Abrir herramientas de desarrollador_ --> _Simulador_\
\_\_En la siguiente imagen, al hacer clic en "iPod touch \[...]" puedes seleccionar otro dispositivo para probar:

![](<../../.gitbook/assets/image (457).png>)

![](<../../.gitbook/assets/image (458).png>)

### Aplicaciones en el Simulador

Dentro de `/Users/<nombredeusuario>/Library/Developer/CoreSimulator/Devices` puedes encontrar todos los **simuladores instalados**. Si deseas acceder a los archivos de una aplicaci칩n creada dentro de uno de los emuladores, puede ser dif칤cil saber **en cu치l est치 instalada la app**. Una forma r치pida de **encontrar el UID correcto** es ejecutar la app en el simulador y ejecutar:
```bash
xcrun simctl list | grep Booted
iPhone 8 (BF5DA4F8-6BBE-4EA0-BA16-7E3AFD16C06C) (Booted)
```
Una vez que conozcas el UID, las aplicaciones instaladas dentro de 칠l se pueden encontrar en `/Users/<username>/Library/Developer/CoreSimulator/Devices/{UID}/data/Containers/Data/Application`

Sin embargo, sorprendentemente no encontrar치s la aplicaci칩n aqu칤. Necesitas acceder a `/Users/<username>/Library/Developer/Xcode/DerivedData/{Application}/Build/Products/Debug-iphonesimulator/`

Y en esta carpeta puedes **encontrar el paquete de la aplicaci칩n.**

## Emulador

Corellium es el 칰nico emulador de iOS disponible p칰blicamente. Es una soluci칩n empresarial SaaS con un modelo de licencia por usuario y no ofrece ninguna licencia de prueba.

## Jailbreak

Apple requiere estrictamente que el c칩digo que se ejecuta en el iPhone est칠 **firmado por un certificado emitido por Apple**. **Jailbreaking** es el proceso de **eludir activamente tales restricciones** y otros controles de seguridad establecidos por el sistema operativo. Por lo tanto, una vez que el dispositivo est치 jailbroken, la **verificaci칩n de integridad** que se encarga de verificar las aplicaciones instaladas se parchea para que sea **burlada**.

{% hint style="info" %}
A diferencia de Android, **no puedes cambiar a "Modo Desarrollador"** en iOS para ejecutar c칩digo no firmado/no confiable en el dispositivo.
{% endhint %}

### Rooting en Android vs. Jailbreaking en iOS

Aunque a menudo se comparan, el **rooting** en Android y el **jailbreaking** en iOS son procesos fundamentalmente diferentes. El rooting de dispositivos Android puede implicar **instalar el binario `su`** o **reemplazar el sistema con una ROM personalizada con root**, lo que no necesariamente requiere exploits si el cargador de arranque est치 desbloqueado. **Flashear ROMs personalizadas** reemplaza el sistema operativo del dispositivo despu칠s de desbloquear el cargador de arranque, a veces requiriendo un exploit.

Por el contrario, los dispositivos iOS no pueden flashear ROMs personalizadas debido a la restricci칩n del cargador de arranque de solo arrancar im치genes firmadas por Apple. **Jailbreaking en iOS** tiene como objetivo eludir las protecciones de firma de c칩digo de Apple para ejecutar c칩digo no firmado, un proceso complicado por las continuas mejoras de seguridad de Apple.

### Desaf칤os del Jailbreaking

Jailbreak en iOS es cada vez m치s dif칤cil a medida que Apple parchea r치pidamente las vulnerabilidades. **Revertir a una versi칩n anterior de iOS** solo es posible durante un tiempo limitado despu칠s de su lanzamiento, lo que hace que el jailbreaking sea un asunto sensible al tiempo. Los dispositivos utilizados para pruebas de seguridad no deben actualizarse a menos que se garantice la posibilidad de volver a hacer jailbreak.

Las actualizaciones de iOS est치n controladas por un **mecanismo de desaf칤o-respuesta** (blobs SHSH), permitiendo la instalaci칩n solo para respuestas firmadas por Apple. Este mecanismo, conocido como "ventana de firma", limita la capacidad de almacenar y luego usar paquetes de firmware OTA. El sitio web [IPSW Downloads](https://ipsw.me) es un recurso para verificar las ventanas de firma actuales.

### Variedades de Jailbreak

- Los **jailbreaks atados** requieren una conexi칩n a una computadora para cada reinicio.
- Los **jailbreaks semi-atados** permiten arrancar en modo no jailbroken sin una computadora.
- Los **jailbreaks semi-untethered** requieren hacer el jailbreak manualmente sin necesidad de una computadora.
- Los **jailbreaks untethered** ofrecen una soluci칩n de jailbreak permanente sin necesidad de volver a aplicarlo.

### Herramientas y Recursos de Jailbreaking

Las herramientas de jailbreaking var칤an seg칰n la versi칩n de iOS y el dispositivo. Recursos como [Can I Jailbreak?](https://canijailbreak.com), [The iPhone Wiki](https://www.theiphonewiki.com) y [Reddit Jailbreak](https://www.reddit.com/r/jailbreak/) proporcionan informaci칩n actualizada. Ejemplos incluyen:

- [Checkra1n](https://checkra.in/) para dispositivos con chips A7-A11.
- [Palera1n](https://palera.in/) para dispositivos Checkm8 (A8-A11) en iOS 15.0-16.5.
- [Unc0ver](https://unc0ver.dev/) para versiones de iOS hasta 14.8.

Modificar tu dispositivo conlleva riesgos, y el jailbreaking debe abordarse con precauci칩n.

### Beneficios y Riesgos del Jailbreaking

El jailbreaking **elimina el aislamiento impuesto por el sistema operativo**, permitiendo que las aplicaciones accedan a todo el sistema de archivos. Esta libertad permite la instalaci칩n de aplicaciones no aprobadas y el acceso a m치s APIs. Sin embargo, para usuarios regulares, no se recomienda el jailbreaking debido a posibles riesgos de seguridad e inestabilidad del dispositivo.

### **Despu칠s del Jailbreaking**

{% content-ref url="basic-ios-testing-operations.md" %}
[basic-ios-testing-operations.md](basic-ios-testing-operations.md)
{% endcontent-ref %}

### **Detecci칩n de Jailbreak**

**Varias aplicaciones intentar치n detectar si el m칩vil est치 jailbroken y, en ese caso, la aplicaci칩n no se ejecutar치**

* Despu칠s de hacer jailbreak en un iOS, **generalmente se instalan archivos y carpetas**, los cuales se pueden buscar para determinar si el dispositivo est치 jailbroken.
* En un dispositivo jailbroken, las aplicaciones obtienen **acceso de lectura/escritura a nuevos archivos** fuera del sandbox.
* Algunas **llamadas a API** se **comportar치n de manera diferente**.
* La presencia del servicio **OpenSSH**.
* Llamar a `/bin/sh` devolver치 un **1** en lugar de un 0.

**M치s informaci칩n sobre c칩mo detectar el jailbreaking** [**aqu칤**](https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/jailbreak-detection-methods/)**.**

Puedes intentar evitar estas detecciones usando `ios jailbreak disable` de **objection**

## **Bypass de Detecci칩n de Jailbreak**

* Puedes intentar evitar estas detecciones usando `ios jailbreak disable` de **objection**
* Tambi칠n podr칤as instalar la herramienta **Liberty Lite** (https://ryleyangus.com/repo/). Una vez que se a침ada el repositorio, la aplicaci칩n deber칤a aparecer en la pesta침a de 'B칰squeda'

## Referencias
* [https://mas.owasp.org/MASTG/iOS/0x06b-iOS-Security-Testing/](https://mas.owasp.org/MASTG/iOS/0x06b-iOS-Security-Testing/)

<details>

<summary><strong>Aprende hacking en AWS desde cero hasta experto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si deseas ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** 춰Consulta los [**PLANES DE SUSCRIPCI칍N**](https://github.com/sponsors/carlospolop)!
* Obt칠n la [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci칩n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s칤guenos** en **Twitter** 游냕 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
