# Extracción de Entitlements de la Aplicación Compilada

<details>

<summary><strong>Aprende hacking en AWS desde cero hasta experto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si deseas ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** ¡Consulta los [**PLANES DE SUSCRIPCIÓN**](https://github.com/sponsors/carlospolop)!
* Obtén [**productos oficiales de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colección exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Únete al** 💬 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **sígueme** en **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>


Resumen de la página [https://mas.owasp.org/MASTG/tests/ios/MASVS-PLATFORM/MASTG-TEST-0069/#review-entitlements-embedded-in-the-compiled-app-binary](https://mas.owasp.org/MASTG/tests/ios/MASVS-PLATFORM/MASTG-TEST-0069/#review-entitlements-embedded-in-the-compiled-app-binary)

### **Extracción de Entitlements y Archivos de Provisión Móvil**

Cuando se trata de un IPA de una aplicación o de una aplicación instalada en un dispositivo con jailbreak, puede que no sea posible encontrar archivos `.entitlements` o el archivo `embedded.mobileprovision` directamente. Sin embargo, las listas de propiedades de los entitlements aún pueden ser extraídas del binario de la aplicación, siguiendo los procedimientos descritos en el capítulo "Pruebas Básicas de Seguridad en iOS", en particular la sección "Adquisición del Binario de la Aplicación".

Incluso con binarios encriptados, se pueden emplear ciertos pasos para extraer estos archivos. Si estos pasos fallan, pueden ser necesarios herramientas como Clutch (si es compatible con la versión de iOS), frida-ios-dump, u utilidades similares para descifrar y extraer la aplicación.

#### **Extracción del Plist de Entitlements del Binario de la Aplicación**

Con el binario de la aplicación accesible en un ordenador, **binwalk** puede ser utilizado para extraer todos los archivos XML. El siguiente comando demuestra cómo hacerlo:
```bash
$ binwalk -e -y=xml ./Telegram\ X

DECIMAL       HEXADECIMAL     DESCRIPTION
--------------------------------------------------------------------------------
1430180       0x15D2A4        XML document, version: "1.0"
1458814       0x16427E        XML document, version: "1.0"
```
Alternativamente, **radare2** se puede utilizar para ejecutar silenciosamente un comando y salir, buscando todas las cadenas en el binario de la aplicación que contienen "PropertyList":
```bash
$ r2 -qc 'izz~PropertyList' ./Telegram\ X

0x0015d2a4 ascii <?xml version="1.0" encoding="UTF-8" standalone="yes"?>...
0x0016427d ascii H<?xml version="1.0" encoding="UTF-8"?>...
```
Ambos métodos, binwalk y radare2, permiten la extracción de archivos `plist`, con una inspección del primero (0x0015d2a4) revelando una recuperación exitosa del [archivo de permisos original de Telegram](https://github.com/peter-iakovlev/Telegram-iOS/blob/77ee5c4dabdd6eb5f1e2ff76219edf7e18b45c00/Telegram-iOS/Telegram-iOS-AppStoreLLC.entitlements).

Para binarios de aplicaciones accedidos en dispositivos con jailbreak (por ejemplo, a través de SSH), el comando **grep** con la bandera `-a, --text` se puede utilizar para tratar todos los archivos como texto ASCII:
```bash
$ grep -a -A 5 'PropertyList' /var/containers/Bundle/Application/...
```
Ajustar la bandera `-A num, --after-context=num` permite mostrar más o menos líneas. Este método es viable incluso para binarios de aplicaciones encriptadas y ha sido verificado en múltiples aplicaciones de la App Store. Las herramientas mencionadas anteriormente también pueden ser utilizadas en dispositivos iOS con jailbreak con propósitos similares.

**Nota**: No se recomienda el uso directo del comando `strings` para esta tarea debido a sus limitaciones para encontrar información relevante. En su lugar, se aconseja utilizar grep con la bandera `-a` en el binario o utilizar radare2 (`izz`)/rabin2 (`-zz`) para obtener resultados más efectivos.
