# iOS Universal Links


<details>

<summary><strong>Jifunze kuhusu kudukua AWS kutoka mwanzo hadi kuwa bingwa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako inatangazwa kwenye HackTricks** au **kupakua HackTricks kwa muundo wa PDF** Angalia [**MPANGO WA KUJIUNGA**](https://github.com/sponsors/carlospolop)!
* Pata [**swag rasmi ya PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**The PEASS Family**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa [**NFTs**](https://opensea.io/collection/the-peass-family) ya kipekee
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au [**kikundi cha telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Shiriki mbinu zako za kudukua kwa kuwasilisha PRs kwenye** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos za github.

</details>


## Utangulizi

Viungo vya kawaida hutoa uzoefu wa **kuhamisha moja kwa moja** kwa watumiaji kwa kufungua maudhui kwenye programu, bila haja ya kuhamishiwa kwa Safari. Viungo hivi ni **pekee** na salama, kwani haviwezi kudaiwa na programu nyingine. Hii inahakikishwa kwa kuweka faili ya JSON ya `apple-app-site-association` kwenye saraka ya mizizi ya wavuti, ikithibitisha kiunga kinachoweza kuthibitishwa kati ya wavuti na programu. Katika hali ambapo programu haijasanidiwa, Safari itachukua na kumwongoza mtumiaji kwenye ukurasa wa wavuti, ikiendeleza uwepo wa programu.

Kwa wataalamu wa uchunguzi wa kuingilia, faili ya `apple-app-site-association` ni ya kipekee kwani inaweza kufichua njia **nyeti**, ikiwa ni pamoja na zile zinazohusiana na vipengele visivyotolewa.

### **Uchambuzi wa Uhalali wa Kikoa Kinachohusishwa**

Wabunifu huruhusu Viungo vya Kawaida kwa kusanidi **Vikoa Vinavyohusiana** katika kichupo cha Uwezo cha Xcode au kwa kuchunguza faili ya `.entitlements`. Kila kikoa kinafungwa na `applinks:`. Kwa mfano, usanidi wa Telegram unaweza kuonekana kama ifuatavyo:
```xml
<key>com.apple.developer.associated-domains</key>
<array>
<string>applinks:telegram.me</string>
<string>applinks:t.me</string>
</array>
```
Kwa ufahamu kamili zaidi, tazama [Hati za Maendeleo ya Apple zilizohifadhiwa](https://developer.apple.com/library/archive/documentation/General/Conceptual/AppSearch/UniversalLinks.html#//apple_ref/doc/uid/TP40016308-CH12-SW2).

Ikiwa unafanya kazi na programu iliyopangwa, ruhusu zinaweza kuchimbwa kama ilivyoelezwa katika [mwongozo huu](extracting-entitlements-from-compiled-application.md).

### **Kupata Faili ya Apple App Site Association**

Faili ya `apple-app-site-association` inapaswa kupatikana kutoka kwenye seva kwa kutumia kikoa kilichotajwa katika ruhusu. Hakikisha faili inapatikana kupitia HTTPS moja kwa moja kwenye `https://<kikoa>/apple-app-site-association`. Zana kama [Apple App Site Association (AASA) Validator](https://branch.io/resources/aasa-validator/) inaweza kusaidia katika mchakato huu.

### **Kushughulikia Viungo vya Universal katika Programu**

Programu lazima iwekeze njia maalum za kushughulikia viungo vya universal kwa usahihi. Njia kuu ya kutafuta ni [`application:continueUserActivity:restorationHandler:`](https://developer.apple.com/documentation/uikit/uiapplicationdelegate/1623072-application). Ni muhimu kwamba mpango wa URL unaoshughulikiwa ni HTTP au HTTPS, kwani vinginevyo hautasaidiwa.

#### **Kuhalalisha Njia ya Kukabiliana na Data**

Wakati kiungo cha universal kinapofungua programu, kitu cha `NSUserActivity` kinapitishwa kwenye programu na URL. Kabla ya kusindika URL hii, ni muhimu kuhalalisha na kusafisha ili kuzuia hatari za usalama. Hapa kuna mfano katika Swift unaoonyesha mchakato huu:
```swift
func application(_ application: UIApplication, continue userActivity: NSUserActivity,
restorationHandler: @escaping ([UIUserActivityRestoring]?) -> Void) -> Bool {
// Check for web browsing activity and valid URL
if userActivity.activityType == NSUserActivityTypeBrowsingWeb, let url = userActivity.webpageURL {
application.open(url, options: [:], completionHandler: nil)
}

return true
}
```
URLs zinapaswa kuchambuliwa na kuthibitishwa kwa uangalifu, haswa ikiwa zina vigezo, ili kujilinda dhidi ya uwezekano wa udanganyifu au data iliyo na kasoro. API ya `NSURLComponents` ni muhimu kwa kusudi hili, kama inavyoonyeshwa hapa chini:
```swift
func application(_ application: UIApplication,
continue userActivity: NSUserActivity,
restorationHandler: @escaping ([Any]?) -> Void) -> Bool {
guard userActivity.activityType == NSUserActivityTypeBrowsingWeb,
let incomingURL = userActivity.webpageURL,
let components = NSURLComponents(url: incomingURL, resolvingAgainstBaseURL: true),
let path = components.path,
let params = components.queryItems else {
return false
}

if let albumName = params.first(where: { $0.name == "albumname" })?.value,
let photoIndex = params.first(where: { $0.name == "index" })?.value {
// Process the URL with album name and photo index

return true

} else {
// Handle invalid or missing parameters

return false
}
}
```
Kupitia **usanidinuru na uthibitisho wa bidii**, watengenezaji wanaweza kuhakikisha kuwa viungo vya kawaida vinaboresha uzoefu wa mtumiaji wakati wa kudumisha viwango vya usalama na faragha.


## Marejeo
* [https://mas.owasp.org/MASTG/tests/ios/MASVS-PLATFORM/MASTG-TEST-0070/#static-analysis](https://mas.owasp.org/MASTG/tests/ios/MASVS-PLATFORM/MASTG-TEST-0070/#static-analysis)
* [https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06h-testing-platform-interaction#testing-object-persistence-mstg-platform-8](https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06h-testing-platform-interaction#testing-object-persistence-mstg-platform-8)



<details>

<summary><strong>Jifunze kuhusu kudukua AWS kutoka sifuri hadi shujaa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako ikitangazwa kwenye HackTricks** au **kupakua HackTricks kwa muundo wa PDF** Angalia [**MPANGO WA KUJIUNGA**](https://github.com/sponsors/carlospolop)!
* Pata [**swag rasmi ya PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**The PEASS Family**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa [**NFTs**](https://opensea.io/collection/the-peass-family) za kipekee
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au [**kikundi cha telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Shiriki mbinu zako za kudukua kwa kuwasilisha PR kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos za github.

</details>
