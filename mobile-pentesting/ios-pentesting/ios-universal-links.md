# Viungo vya Kisasa vya iOS


<details>

<summary><strong>Jifunze AWS hacking kutoka sifuri hadi shujaa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Mtaalam wa Timu Nyekundu ya AWS ya HackTricks)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako ikitangazwa kwenye HackTricks** au **kupakua HackTricks kwa PDF** Angalia [**MIPANGO YA USAJILI**](https://github.com/sponsors/carlospolop)!
* Pata [**bidhaa rasmi za PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**Familia ya PEASS**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa [**NFTs**](https://opensea.io/collection/the-peass-family) ya kipekee
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au kikundi cha [**telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Shiriki mbinu zako za udukuzi kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos za github.

</details>


## Utangulizi

Viungo vya kisasa hutoa uzoefu wa **kuhamisha moja kwa moja** kwa watumiaji kwa kufungua moja kwa moja maudhui kwenye programu, bila haja ya kuhamishiwa kwa Safari. Viungo hivi ni **pekee** na salama, kwani haviwezi kudaiwa na programu nyingine. Hii inahakikishwa kwa kuwa na faili ya JSON ya `apple-app-site-association` kwenye saraka ya mizizi ya wavuti, kuanzisha kiungo kinachoweza kuthibitishwa kati ya wavuti na programu. Katika hali ambapo programu haijainstalled, Safari itachukua na kumwongoza mtumiaji kwenye ukurasa wa wavuti, ikiendeleza uwepo wa programu.

Kwa watafiti wa udukuzi, faili ya `apple-app-site-association` ni ya kipekee kwani inaweza kufunua njia **nyeti**, pengine zinazohusiana na vipengele visivyotolewa bado.

### **Kuchambua Uhalali wa Domain Zilizohusishwa**

Wabunifu huwezesha Viungo vya Kisasa kwa kusanidi **Domain Zilizohusishwa** katika kichupo cha Uwezo cha Xcode au kwa kuchunguza faili ya `.entitlements`. Kila kikoa kinaanzishwa na `applinks:`. Kwa mfano, usanidi wa Telegram unaweza kuonekana kama ifuatavyo:
```xml
<key>com.apple.developer.associated-domains</key>
<array>
<string>applinks:telegram.me</string>
<string>applinks:t.me</string>
</array>
```
Kwa ufahamu kamili zaidi, tazama [Hati za Maendeleo ya Apple zilizohifadhiwa](https://developer.apple.com/library/archive/documentation/General/Conceptual/AppSearch/UniversalLinks.html#//apple_ref/doc/uid/TP40016308-CH12-SW2).

Ikiwa unafanya kazi na programu iliyoundwa, ruhusu zinaweza kuchimbuliwa kama ilivyoelezwa katika [mwongozo huu](extracting-entitlements-from-compiled-application.md).

### **Kupata Faili ya Umoja wa Programu ya Apple**

Faili ya `apple-app-site-association` inapaswa kupatikana kutoka kwenye seva kwa kutumia uwanja ulioelezwa katika ruhusa. Hakikisha faili inapatikana kupitia HTTPS moja kwa moja kwa `https://<uwanja>/apple-app-site-association`. Zana kama [Mthibitishaji wa Umoja wa Programu ya Apple (AASA)](https://branch.io/resources/aasa-validator/) inaweza kusaidia katika mchakato huu.

### **Kushughulikia Viungo vya Umoja katika Programu**

Programu lazima iwekeze njia maalum za kushughulikia viungo vya umoja kwa usahihi. Njia kuu ya kutafuta ni [`application:continueUserActivity:restorationHandler:`](https://developer.apple.com/documentation/uikit/uiapplicationdelegate/1623072-application). Ni muhimu kwamba mpango wa URL ulioshughulikiwa ni HTTP au HTTPS, kwani vinginevyo hautasaidiwa.

#### **Kuthibitisha Njia ya Kukabiliana na Data**

Wakati kiungo cha umoja kinapofungua programu, kitu cha `NSUserActivity` kinapitishwa kwa programu pamoja na URL. Kabla ya kusindika URL hii, ni muhimu kuthibitisha na kuisafisha ili kuzuia hatari za usalama. Hapa kuna mfano katika Swift unaodhihirisha mchakato huo:
```swift
func application(_ application: UIApplication, continue userActivity: NSUserActivity,
restorationHandler: @escaping ([UIUserActivityRestoring]?) -> Void) -> Bool {
// Check for web browsing activity and valid URL
if userActivity.activityType == NSUserActivityTypeBrowsingWeb, let url = userActivity.webpageURL {
application.open(url, options: [:], completionHandler: nil)
}

return true
}
```
URLs inapaswa kuchambuliwa na kuthibitishwa kwa uangalifu, hasa ikiwa zina vigezo, ili kujilinda dhidi ya uwezekano wa kughushi au data iliyo na hitilafu. API ya `NSURLComponents` ni muhimu kwa kusudi hili, kama ilivyodhihirishwa hapa chini:
```swift
func application(_ application: UIApplication,
continue userActivity: NSUserActivity,
restorationHandler: @escaping ([Any]?) -> Void) -> Bool {
guard userActivity.activityType == NSUserActivityTypeBrowsingWeb,
let incomingURL = userActivity.webpageURL,
let components = NSURLComponents(url: incomingURL, resolvingAgainstBaseURL: true),
let path = components.path,
let params = components.queryItems else {
return false
}

if let albumName = params.first(where: { $0.name == "albumname" })?.value,
let photoIndex = params.first(where: { $0.name == "index" })?.value {
// Process the URL with album name and photo index

return true

} else {
// Handle invalid or missing parameters

return false
}
}
```
Kupitia **mipangilio na uthibitisho makini**, wabunifu wanaweza kuhakikisha kuwa viungo vya kipekee vinaboresha uzoefu wa mtumiaji wakati bado wanazingatia viwango vya usalama na faragha.


## Vifaa
* [GetUniversal.link](https://getuniversal.link/): Inasaidia kusahihisha upimaji na usimamizi wa Viungo vya Kipekee vya programu yako na faili ya AASA. Ingiza tu kikoa chako ili kuthibitisha uadilifu wa faili ya AASA au tumia dashibodi ya desturi kwa urahisi kujaribu tabia ya kiungo. Kifaa hiki pia husaidia kujua lini Apple itaorodhesha faili yako ya AASA ijayo.

## Marejeo
* [https://mas.owasp.org/MASTG/tests/ios/MASVS-PLATFORM/MASTG-TEST-0070/#static-analysis](https://mas.owasp.org/MASTG/tests/ios/MASVS-PLATFORM/MASTG-TEST-0070/#static-analysis)
* [https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06h-testing-platform-interaction#testing-object-persistence-mstg-platform-8](https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06h-testing-platform-interaction#testing-object-persistence-mstg-platform-8)



<details>

<summary><strong>Jifunze kuhusu kuvamia AWS kutoka sifuri hadi shujaa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako ikitangazwa kwenye HackTricks** au **kupakua HackTricks kwa PDF** Angalia [**MIPANGO YA KUJIUNGA**](https://github.com/sponsors/carlospolop)!
* Pata [**bidhaa rasmi za PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**Familia ya PEASS**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa [**NFTs**](https://opensea.io/collection/the-peass-family) ya kipekee
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au kikundi cha [**telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Shiriki mbinu zako za kuvamia kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos za github.

</details>
