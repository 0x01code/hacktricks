# Liens universels iOS


<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Expert en √©quipe rouge AWS de HackTricks)</strong></a><strong>!</strong></summary>

Autres fa√ßons de soutenir HackTricks:

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts GitHub.

</details>


## Introduction

Les liens universels offrent une exp√©rience de **redirection transparente** aux utilisateurs en ouvrant directement le contenu dans l'application, contournant ainsi le besoin de redirection vers Safari. Ces liens sont **uniques** et s√©curis√©s, car ils ne peuvent pas √™tre revendiqu√©s par d'autres applications. Cela est assur√© en h√©bergeant un fichier JSON `apple-app-site-association` dans le r√©pertoire racine du site Web, √©tablissant un lien v√©rifiable entre le site Web et l'application. Dans les cas o√π l'application n'est pas install√©e, Safari prendra le relais et dirigera l'utilisateur vers la page Web, maintenant ainsi la pr√©sence de l'application.

Pour les testeurs de p√©n√©tration, le fichier `apple-app-site-association` est d'un int√©r√™t particulier car il peut r√©v√©ler des **chemins sensibles**, potentiellement li√©s √† des fonctionnalit√©s non publi√©es.

### **Analyse de l'autorisation des domaines associ√©s**

Les d√©veloppeurs activent les liens universels en configurant les **Domaines associ√©s** dans l'onglet Capacit√©s de Xcode ou en inspectant le fichier `.entitlements`. Chaque domaine est pr√©fix√© par `applinks:`. Par exemple, la configuration de Telegram pourrait appara√Ætre comme suit:
```xml
<key>com.apple.developer.associated-domains</key>
<array>
<string>applinks:telegram.me</string>
<string>applinks:t.me</string>
</array>
```
Pour des informations plus compl√®tes, consultez la [Documentation archiv√©e des d√©veloppeurs Apple](https://developer.apple.com/library/archive/documentation/General/Conceptual/AppSearch/UniversalLinks.html#//apple_ref/doc/uid/TP40016308-CH12-SW2).

Si vous travaillez avec une application compil√©e, les autorisations peuvent √™tre extraites comme d√©crit dans [ce guide](extracting-entitlements-from-compiled-application.md).

### **R√©cup√©ration du fichier Apple App Site Association**

Le fichier `apple-app-site-association` doit √™tre r√©cup√©r√© depuis le serveur en utilisant les domaines sp√©cifi√©s dans les autorisations. Assurez-vous que le fichier est accessible via HTTPS directement √† `https://<domain>/apple-app-site-association`. Des outils comme le [Validateur de l'Apple App Site Association (AASA)](https://branch.io/resources/aasa-validator/) peuvent aider dans ce processus.

### **Gestion des Liens Universels dans l'Application**

L'application doit impl√©menter des m√©thodes sp√©cifiques pour g√©rer correctement les liens universels. La m√©thode principale √† rechercher est [`application:continueUserActivity:restorationHandler:`](https://developer.apple.com/documentation/uikit/uiapplicationdelegate/1623072-application). Il est crucial que le sch√©ma des URL trait√©es soit HTTP ou HTTPS, car les autres ne seront pas pris en charge.

#### **Validation de la M√©thode de Gestion des Donn√©es**

Lorsqu'un lien universel ouvre une application, un objet `NSUserActivity` est transmis √† l'application avec l'URL. Avant de traiter cette URL, il est essentiel de la valider et de la d√©sinfecter pour √©viter les risques de s√©curit√©. Voici un exemple en Swift qui illustre le processus :
```swift
func application(_ application: UIApplication, continue userActivity: NSUserActivity,
restorationHandler: @escaping ([UIUserActivityRestoring]?) -> Void) -> Bool {
// Check for web browsing activity and valid URL
if userActivity.activityType == NSUserActivityTypeBrowsingWeb, let url = userActivity.webpageURL {
application.open(url, options: [:], completionHandler: nil)
}

return true
}
```
Les URL doivent √™tre soigneusement analys√©es et valid√©es, surtout si elles incluent des param√®tres, pour se prot√©ger contre d'√©ventuelles usurpations ou donn√©es malform√©es. L'API `NSURLComponents` est utile √† cette fin, comme le montre l'exemple ci-dessous:
```swift
func application(_ application: UIApplication,
continue userActivity: NSUserActivity,
restorationHandler: @escaping ([Any]?) -> Void) -> Bool {
guard userActivity.activityType == NSUserActivityTypeBrowsingWeb,
let incomingURL = userActivity.webpageURL,
let components = NSURLComponents(url: incomingURL, resolvingAgainstBaseURL: true),
let path = components.path,
let params = components.queryItems else {
return false
}

if let albumName = params.first(where: { $0.name == "albumname" })?.value,
let photoIndex = params.first(where: { $0.name == "index" })?.value {
// Process the URL with album name and photo index

return true

} else {
// Handle invalid or missing parameters

return false
}
}
```
√Ä travers une **configuration et validation diligente**, les d√©veloppeurs peuvent s'assurer que les liens universels am√©liorent l'exp√©rience utilisateur tout en respectant les normes de s√©curit√© et de confidentialit√©.




## R√©f√©rences
* [https://mas.owasp.org/MASTG/tests/ios/MASVS-PLATFORM/MASTG-TEST-0070/#static-analysis](https://mas.owasp.org/MASTG/tests/ios/MASVS-PLATFORM/MASTG-TEST-0070/#static-analysis)
* [https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06h-testing-platform-interaction#testing-object-persistence-mstg-platform-8](https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06h-testing-platform-interaction#testing-object-persistence-mstg-platform-8)



<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Expert Red Team AWS HackTricks)</strong></a><strong>!</strong></summary>

Autres fa√ßons de soutenir HackTricks:

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
