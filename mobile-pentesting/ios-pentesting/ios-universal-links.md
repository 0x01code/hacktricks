# iOS Universal Bağlantıları


<details>

<summary><strong>AWS hacklemeyi sıfırdan kahramanla öğrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Kırmızı Takım Uzmanı)</strong></a><strong>!</strong></summary>

HackTricks'i desteklemenin diğer yolları:

* **Şirketinizi HackTricks'te reklam vermek** veya **HackTricks'i PDF olarak indirmek** için [**ABONELİK PLANLARI**](https://github.com/sponsors/carlospolop)'na göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keşfedin, özel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın** veya **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)'u **takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna **PR göndererek** paylaşın.

</details>


## Giriş

Evrensel bağlantılar, kullanıcılara Safari yönlendirmesi gereksinimini atlayarak içeriği doğrudan uygulamada açarak **kesintisiz bir yönlendirme** deneyimi sunar. Bu bağlantılar, diğer uygulamalar tarafından talep edilemez ve güvenlidir. Bu, `apple-app-site-association` JSON dosyasının web sitesinin kök dizininde barındırılmasıyla sağlanır ve web sitesi ile uygulama arasında doğrulanabilir bir bağlantı kurar. Uygulama yüklü olmadığı durumlarda, Safari kullanıcıyı web sayfasına yönlendirir ve uygulamanın varlığını sürdürür.

Sızma testçileri için `apple-app-site-association` dosyası özellikle ilgi çekicidir, çünkü bu dosya, yayınlanmamış özelliklerle ilgili olabilecek **duyarlı yolları** ortaya çıkarabilir.

### **İlişkili Alan Yetkisi'nin Analizi**

Geliştiriciler, Universal Bağlantıları Xcode'un Yetenekler sekmesinde **İlişkili Alanlar**'ı yapılandırarak veya `.entitlements` dosyasını inceleyerek etkinleştirir. Her alan `applinks:` ile önekiyle belirtilir. Örneğin, Telegram'ın yapılandırması aşağıdaki gibi görünebilir:
```xml
<key>com.apple.developer.associated-domains</key>
<array>
<string>applinks:telegram.me</string>
<string>applinks:t.me</string>
</array>
```
Daha kapsamlı bilgilere ulaşmak için [arşivlenmiş Apple Geliştirici Belgeleri](https://developer.apple.com/library/archive/documentation/General/Conceptual/AppSearch/UniversalLinks.html#//apple_ref/doc/uid/TP40016308-CH12-SW2)'ne başvurun.

Derlenmiş bir uygulama ile çalışılıyorsa, yetkilendirmeler [bu kılavuzda](extracting-entitlements-from-compiled-application.md) belirtildiği gibi çıkarılabilir.

### **Apple App Site Association Dosyasını Almak**

`apple-app-site-association` dosyası, yetkilendirmelerde belirtilen alan adları kullanılarak sunucudan alınmalıdır. Dosyanın `https://<alan_adı>/apple-app-site-association` adresinden doğrudan HTTPS üzerinden erişilebilir olduğundan emin olun. [Apple App Site Association (AASA) Validator](https://branch.io/resources/aasa-validator/) gibi araçlar bu süreçte yardımcı olabilir.

### **Uygulamada Universal Bağlantıları İşlemek**

Uygulama, universal bağlantıları doğru bir şekilde işlemek için belirli yöntemleri uygulamalıdır. Aranması gereken temel yöntem [`application:continueUserActivity:restorationHandler:`](https://developer.apple.com/documentation/uikit/uiapplicationdelegate/1623072-application) yöntemidir. İşlenen URL'lerin şemasının HTTP veya HTTPS olması önemlidir, diğerleri desteklenmeyecektir.

#### **Veri İşleyici Yöntemini Doğrulama**

Bir universal bağlantı bir uygulamayı açtığında, bir `NSUserActivity` nesnesi URL ile birlikte uygulamaya iletilir. Bu URL'yi işlemeye başlamadan önce, güvenlik risklerini önlemek için doğrulamak ve temizlemek önemlidir. İşlemi gösteren bir Swift örneği aşağıda verilmiştir:
```swift
func application(_ application: UIApplication, continue userActivity: NSUserActivity,
restorationHandler: @escaping ([UIUserActivityRestoring]?) -> Void) -> Bool {
// Check for web browsing activity and valid URL
if userActivity.activityType == NSUserActivityTypeBrowsingWeb, let url = userActivity.webpageURL {
application.open(url, options: [:], completionHandler: nil)
}

return true
}
```
URL'ler, özellikle parametre içeriyorsa, potansiyel sahte veya hatalı verilere karşı dikkatlice ayrıştırılmalı ve doğrulanmalıdır. Bu amaçla `NSURLComponents` API'si kullanışlıdır, aşağıda gösterildiği gibi:

```swift
guard let url = URL(string: "https://example.com/path?param=value") else {
    // Handle invalid URL
    return
}

guard let components = NSURLComponents(url: url, resolvingAgainstBaseURL: true) else {
    // Handle invalid URL components
    return
}

// Access individual components
if let scheme = components.scheme {
    print("Scheme: \(scheme)")
}

if let host = components.host {
    print("Host: \(host)")
}

if let path = components.path {
    print("Path: \(path)")
}

if let queryItems = components.queryItems {
    for item in queryItems {
        print("Parameter: \(item.name), Value: \(item.value ?? "")")
    }
}
```

Bu kod parçası, verilen URL'yi ayrıştırır ve bileşenlerine erişim sağlar. Böylece, URL'nin şeması, ana bilgisayarı, yolunu ve parametrelerini elde edebilirsiniz.
```swift
func application(_ application: UIApplication,
continue userActivity: NSUserActivity,
restorationHandler: @escaping ([Any]?) -> Void) -> Bool {
guard userActivity.activityType == NSUserActivityTypeBrowsingWeb,
let incomingURL = userActivity.webpageURL,
let components = NSURLComponents(url: incomingURL, resolvingAgainstBaseURL: true),
let path = components.path,
let params = components.queryItems else {
return false
}

if let albumName = params.first(where: { $0.name == "albumname" })?.value,
let photoIndex = params.first(where: { $0.name == "index" })?.value {
// Process the URL with album name and photo index

return true

} else {
// Handle invalid or missing parameters

return false
}
}
```
Geliştiriciler, evrensel bağlantıların kullanıcı deneyimini artırırken güvenlik ve gizlilik standartlarını korumak için **dikkatli yapılandırma ve doğrulama** yaparak sağlayabilirler.




## Referanslar
* [https://mas.owasp.org/MASTG/tests/ios/MASVS-PLATFORM/MASTG-TEST-0070/#static-analysis](https://mas.owasp.org/MASTG/tests/ios/MASVS-PLATFORM/MASTG-TEST-0070/#static-analysis)
* [https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06h-testing-platform-interaction#testing-object-persistence-mstg-platform-8](https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06h-testing-platform-interaction#testing-object-persistence-mstg-platform-8)



<details>

<summary><strong>AWS hacklemeyi sıfırdan kahraman olmak için öğrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks'i desteklemenin diğer yolları:

* **Şirketinizi HackTricks'te reklamınızı görmek veya HackTricks'i PDF olarak indirmek** için [**ABONELİK PLANLARI**](https://github.com/sponsors/carlospolop)'na göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) koleksiyonumuzu keşfedin, özel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family)
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın** veya **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)'u **takip edin**.
* **Hacking hilelerinizi HackTricks ve HackTricks Cloud** github depolarına **PR göndererek paylaşın**.

</details>
