# iOS Universal Links


<details>

<summary><strong>htARTE (HackTricks AWS Red Team 전문가)로부터 AWS 해킹을 처음부터 전문가까지 배우세요!</strong></summary>

HackTricks를 지원하는 다른 방법:

* **회사를 HackTricks에서 광고하거나 HackTricks를 PDF로 다운로드**하고 싶다면 [**구독 요금제**](https://github.com/sponsors/carlospolop)를 확인하세요!
* [**공식 PEASS & HackTricks 스왜그**](https://peass.creator-spring.com)를 구매하세요
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)를 발견하세요, 당사의 독점 [**NFTs**](https://opensea.io/collection/the-peass-family) 컬렉션
* **💬 [Discord 그룹](https://discord.gg/hRep4RUj7f)** 또는 [텔레그램 그룹](https://t.me/peass)에 **가입**하거나 **트위터** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)을 **팔로우**하세요.
* **해킹 트릭을 공유하려면 PR을 제출하여** [**HackTricks**](https://github.com/carlospolop/hacktricks) 및 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github 저장소에 기여하세요.

</details>


## 소개

Universal links는 사용자에게 앱에서 콘텐츠를 직접 열어주어 Safari 리디렉션 필요를 우회하여 **원활한 리디렉션** 경험을 제공합니다. 이러한 링크는 다른 앱에서 요청할 수 없도록 **고유하고 안전**하며, 웹사이트의 루트 디렉토리에 `apple-app-site-association` JSON 파일을 호스팅하여 웹사이트와 앱 간의 검증 가능한 링크를 설정함으로써 보장됩니다. 앱이 설치되지 않은 경우 Safari가 사용자를 웹페이지로 안내하여 앱의 존재를 유지합니다.

펜 테스터들에게는 `apple-app-site-association` 파일이 특히 흥미로울 수 있으며, 이 파일은 미발표 기능과 관련된 경로를 포함할 수 있는 **민감한 경로**를 드러낼 수 있습니다.

### **연결된 도메인 권한 분석**

개발자는 Xcode의 기능 탭에서 **연결된 도메인**을 구성하거나 `.entitlements` 파일을 검사하여 Universal Links를 활성화합니다. 각 도메인은 `applinks:`로 접두사가 붙습니다. 예를 들어, 텔레그램의 구성은 다음과 같이 나타날 수 있습니다:
```xml
<key>com.apple.developer.associated-domains</key>
<array>
<string>applinks:telegram.me</string>
<string>applinks:t.me</string>
</array>
```
### **Apple App 사이트 연합 협회 파일 검색**

`apple-app-site-association` 파일은 권한에 지정된 도메인을 사용하여 서버에서 검색되어야 합니다. 파일은 `https://<도메인>/apple-app-site-association`에서 직접 액세스할 수 있어야 합니다. [Apple App 사이트 협회 (AASA) Validator](https://branch.io/resources/aasa-validator/)와 같은 도구는이 프로세스를 지원할 수 있습니다.

### **앱에서 Universal 링크 처리**

앱은 Universal 링크를 올바르게 처리하기 위해 특정 메서드를 구현해야합니다. 찾아야 할 주요 메서드는 [`application:continueUserActivity:restorationHandler:`](https://developer.apple.com/documentation/uikit/uiapplicationdelegate/1623072-application)입니다. 처리해야 하는 URL의 scheme이 HTTP 또는 HTTPS 여야하며, 다른 scheme은 지원되지 않습니다.

#### **데이터 핸들러 메서드 유효성 검사**

Universal 링크가 앱을 열 때 `NSUserActivity` 객체가 URL과 함께 앱으로 전달됩니다. 이 URL을 처리하기 전에 보안 위험을 방지하기 위해 유효성을 검사하고 정리하는 것이 중요합니다. 다음은이 프로세스를 보여주는 Swift의 예시입니다:
```swift
func application(_ application: UIApplication, continue userActivity: NSUserActivity,
restorationHandler: @escaping ([UIUserActivityRestoring]?) -> Void) -> Bool {
// Check for web browsing activity and valid URL
if userActivity.activityType == NSUserActivityTypeBrowsingWeb, let url = userActivity.webpageURL {
application.open(url, options: [:], completionHandler: nil)
}

return true
}
```
URL은 특히 매개변수를 포함하는 경우 신중하게 구문 분석 및 유효성을 검사해야 하며 잠재적인 스푸핑 또는 잘못된 데이터에 대비해야 합니다. 이러한 목적으로 `NSURLComponents` API가 유용하며 아래에서 설명한 대로 사용할 수 있습니다:
```swift
func application(_ application: UIApplication,
continue userActivity: NSUserActivity,
restorationHandler: @escaping ([Any]?) -> Void) -> Bool {
guard userActivity.activityType == NSUserActivityTypeBrowsingWeb,
let incomingURL = userActivity.webpageURL,
let components = NSURLComponents(url: incomingURL, resolvingAgainstBaseURL: true),
let path = components.path,
let params = components.queryItems else {
return false
}

if let albumName = params.first(where: { $0.name == "albumname" })?.value,
let photoIndex = params.first(where: { $0.name == "index" })?.value {
// Process the URL with album name and photo index

return true

} else {
// Handle invalid or missing parameters

return false
}
}
```
**노력하는 구성 및 유효성 검사**를 통해, 개발자는 유니버설 링크가 사용자 경험을 향상시키는 동시에 보안 및 개인 정보 보호 기준을 유지할 수 있도록 할 수 있습니다.


## 도구
* [GetUniversal.link](https://getuniversal.link/): 앱의 유니버설 링크 및 AASA 파일의 테스트 및 관리를 간소화하는 데 도움이 됩니다. 도메인을 입력하여 AASA 파일 무결성을 확인하거나 링크 동작을 쉽게 테스트하기 위해 사용자 정의 대시보드를 사용할 수 있습니다. 또한 이 도구는 Apple이 다음으로 AASA 파일을 색인화할 때를 결정하는 데 도움을 줍니다.

## 참고 자료
* [https://mas.owasp.org/MASTG/tests/ios/MASVS-PLATFORM/MASTG-TEST-0070/#static-analysis](https://mas.owasp.org/MASTG/tests/ios/MASVS-PLATFORM/MASTG-TEST-0070/#static-analysis)
* [https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06h-testing-platform-interaction#testing-object-persistence-mstg-platform-8](https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06h-testing-platform-interaction#testing-object-persistence-mstg-platform-8)



<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>를 통해 제로부터 영웅이 될 때까지 AWS 해킹을 배우세요</summary>

HackTricks를 지원하는 다른 방법:

* **회사가 HackTricks를 광고하거나 PDF로 다운로드하고 싶다면** [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)를 확인하세요!
* [**공식 PEASS & HackTricks 스왜그**](https://peass.creator-spring.com)를 구매하세요
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)를 발견하세요, 당사의 독점 [**NFTs**](https://opensea.io/collection/the-peass-family) 컬렉션
* **💬 [디스코드 그룹](https://discord.gg/hRep4RUj7f)** 또는 [텔레그램 그룹](https://t.me/peass)에 **가입**하거나 **트위터** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)를 **팔로우**하세요.
* **HackTricks** 및 **HackTricks Cloud** 깃허브 저장소에 PR을 제출하여 **해킹 트릭을 공유**하세요.

</details>
