<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez**-moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux d√©p√¥ts github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>


Les liens universels permettent de **rediriger les utilisateurs directement** vers l'application sans passer par Safari pour la redirection.\
Les liens universels sont **uniques**, donc **ne peuvent pas √™tre revendiqu√©s par d'autres applications** car ils utilisent des liens HTTP(S) standards vers le **site web o√π le propri√©taire a t√©l√©charg√© un fichier pour s'assurer que le site web et l'application sont li√©s**.\
Comme ces liens utilisent des sch√©mas HTTP(S), lorsque l'**application n'est pas install√©e, Safari ouvrira le lien** redirigeant les utilisateurs vers la page. Cela permet aux **applications de communiquer avec l'application m√™me si elle n'est pas install√©e**.

Pour cr√©er des liens universels, il est n√©cessaire de **cr√©er un fichier JSON appel√© `apple-app-site-association`** avec les d√©tails. Ensuite, ce fichier doit √™tre **h√©berg√© dans le r√©pertoire racine de votre serveur web** (par exemple [https://google.com/apple-app-site-association](https://google.com/apple-app-site-association)).\
Pour le pentester, ce fichier est tr√®s int√©ressant car il **r√©v√®le des chemins**. Il peut m√™me r√©v√©ler des chemins de versions qui n'ont pas encore √©t√© publi√©es.

## **V√©rification de l'entitlement des domaines associ√©s**

Dans Xcode, allez dans l'onglet **Capacit√©s** et recherchez **Domaines associ√©s**. Vous pouvez √©galement inspecter le fichier `.entitlements` √† la recherche de `com.apple.developer.associated-domains`. Chacun des domaines doit √™tre pr√©fix√© par `applinks:`, comme `applinks:www.monwebsite.com`.

Voici un exemple du fichier `.entitlements` de Telegram :
```markup
<key>com.apple.developer.associated-domains</key>
<array>
<string>applinks:telegram.me</string>
<string>applinks:t.me</string>
</array>
```
Des informations plus d√©taill√©es sont disponibles dans la [Documentation Apple Developer archiv√©e](https://developer.apple.com/library/archive/documentation/General/Conceptual/AppSearch/UniversalLinks.html#//apple_ref/doc/uid/TP40016308-CH12-SW2).

Si vous disposez uniquement de l'application compil√©e, vous pouvez extraire les droits en suivant ce guide :

{% content-ref url="extracting-entitlements-from-compiled-application.md" %}
[extracting-entitlements-from-compiled-application.md](extracting-entitlements-from-compiled-application.md)
{% endcontent-ref %}

## **R√©cup√©ration du fichier Apple App Site Association**

Essayez de r√©cup√©rer le fichier `apple-app-site-association` depuis le serveur en utilisant les domaines associ√©s que vous avez obtenus √† l'√©tape pr√©c√©dente. Ce fichier doit √™tre accessible via HTTPS, sans aucune redirection, √† `https://<domain>/apple-app-site-association` ou `https://<domain>/.well-known/apple-app-site-association`.

Vous pouvez le r√©cup√©rer vous-m√™me avec votre navigateur ou utiliser le [validateur Apple App Site Association (AASA)](https://branch.io/resources/aasa-validator/).

## **V√©rification de la m√©thode de r√©ception de lien**

Pour recevoir des liens et les g√©rer de mani√®re appropri√©e, le d√©l√©gu√© de l'application doit impl√©menter [`application:continueUserActivity:restorationHandler:`](https://developer.apple.com/documentation/uikit/uiapplicationdelegate/1623072-application). Si vous avez le projet original, essayez de rechercher cette m√©thode.

Veuillez noter que si l'application utilise [`openURL:options:completionHandler:`](https://developer.apple.com/documentation/uikit/uiapplication/1648685-openurl?language=objc) pour ouvrir un lien universel vers le site web de l'application, le lien ne s'ouvrira pas dans l'application. Comme l'appel provient de l'application, il ne sera pas trait√© comme un lien universel.

* Le sch√©ma de l'URL `webpageURL` doit √™tre HTTP ou HTTPS (tout autre sch√©ma devrait lever une exception). La [propri√©t√© d'instance `scheme`](https://developer.apple.com/documentation/foundation/urlcomponents/1779624-scheme) de `URLComponents` / `NSURLComponents` peut √™tre utilis√©e pour v√©rifier cela.

## **V√©rification de la m√©thode de gestion des donn√©es**

Lorsque iOS ouvre une application √† la suite d'un lien universel, l'application re√ßoit un objet `NSUserActivity` avec une valeur `activityType` de `NSUserActivityTypeBrowsingWeb`. La propri√©t√© `webpageURL` de l'objet d'activit√© contient l'URL HTTP ou HTTPS que l'utilisateur acc√®de. L'exemple suivant en Swift v√©rifie exactement cela avant d'ouvrir l'URL :
```swift
func application(_ application: UIApplication, continue userActivity: NSUserActivity,
restorationHandler: @escaping ([UIUserActivityRestoring]?) -> Void) -> Bool {
// ...
if userActivity.activityType == NSUserActivityTypeBrowsingWeb, let url = userActivity.webpageURL {
application.open(url, options: [:], completionHandler: nil)
}

return true
}
```
En outre, n'oubliez pas que si l'URL comprend des param√®tres, ils ne doivent pas √™tre consid√©r√©s comme fiables avant d'√™tre soigneusement assainis et valid√©s (m√™me lorsqu'ils proviennent d'un domaine de confiance). Par exemple, ils pourraient avoir √©t√© falsifi√©s par un attaquant ou pourraient inclure des donn√©es malform√©es. Si c'est le cas, l'URL enti√®re et donc la demande de lien universel doivent √™tre rejet√©es.

L'API `NSURLComponents` peut √™tre utilis√©e pour analyser et manipuler les composants de l'URL. Cela peut √©galement faire partie de la m√©thode `application:continueUserActivity:restorationHandler:` elle-m√™me ou peut se produire dans une m√©thode s√©par√©e appel√©e √† partir de celle-ci. L'[exemple](https://developer.apple.com/documentation/uikit/core\_app/allowing\_apps\_and\_websites\_to\_link\_to\_your\_content/handling\_universal\_links#3001935) suivant illustre ceci :
```swift
func application(_ application: UIApplication,
continue userActivity: NSUserActivity,
restorationHandler: @escaping ([Any]?) -> Void) -> Bool {
guard userActivity.activityType == NSUserActivityTypeBrowsingWeb,
let incomingURL = userActivity.webpageURL,
let components = NSURLComponents(url: incomingURL, resolvingAgainstBaseURL: true),
let path = components.path,
let params = components.queryItems else {
return false
}

if let albumName = params.first(where: { $0.name == "albumname" })?.value,
let photoIndex = params.first(where: { $0.name == "index" })?.value {
// Interact with album name and photo index

return true

} else {
// Handle when album and/or album name or photo index missing

return false
}
}
```
# R√©f√©rences

{% embed url="https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06h-testing-platform-interaction#testing-object-persistence-mstg-platform-8" %}



<details>

<summary><strong>Apprenez le hacking AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**merchandising officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez**-moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de hacking en soumettant des PR aux d√©p√¥ts github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
