<details>

<summary><strong>Aprende hacking en AWS de cero a h√©roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF**, consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Obt√©n el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **sigue** a **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de github** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>


Los enlaces universales permiten **redirigir a los usuarios directamente** a la aplicaci√≥n sin pasar por Safari para la redirecci√≥n.\
Los enlaces universales son **√∫nicos**, por lo que **no pueden ser reclamados por otras aplicaciones** porque utilizan enlaces HTTP(S) est√°ndar al **sitio web donde el propietario ha subido un archivo para asegurarse de que el sitio web y la aplicaci√≥n est√°n relacionados**.\
Como estos enlaces utilizan esquemas HTTP(S), cuando la **aplicaci√≥n no est√° instalada, Safari abrir√° el enlace** redirigiendo a los usuarios a la p√°gina. Esto permite que **las aplicaciones se comuniquen con la aplicaci√≥n incluso si no est√° instalada**.

Para crear enlaces universales es necesario **crear un archivo JSON llamado `apple-app-site-association`** con los detalles. Luego, este archivo debe ser **alojado en el directorio ra√≠z de tu servidor web** (por ejemplo, [https://google.com/apple-app-site-association](https://google.com/apple-app-site-association)).\
Para el pentester, este archivo es muy interesante ya que **revela rutas**. Incluso podr√≠a estar revelando rutas de lanzamientos que a√∫n no se han publicado.

## ‚Äã**Verificando el Entitlement de Dominios Asociados**

En Xcode, ve a la pesta√±a **Capabilities** y busca **Associated Domains**. Tambi√©n puedes inspeccionar el archivo `.entitlements` buscando `com.apple.developer.associated-domains`. Cada uno de los dominios debe estar prefijado con `applinks:`, como `applinks:www.mywebsite.com`.

Aqu√≠ hay un ejemplo del archivo `.entitlements` de Telegram:
```markup
<key>com.apple.developer.associated-domains</key>
<array>
<string>applinks:telegram.me</string>
<string>applinks:t.me</string>
</array>
```
Puede encontrar informaci√≥n m√°s detallada en la [Documentaci√≥n para Desarrolladores de Apple archivada](https://developer.apple.com/library/archive/documentation/General/Conceptual/AppSearch/UniversalLinks.html#//apple_ref/doc/uid/TP40016308-CH12-SW2).

Si solo tiene la aplicaci√≥n compilada, puede extraer los entitlements siguiendo esta gu√≠a:

{% content-ref url="extracting-entitlements-from-compiled-application.md" %}
[extracting-entitlements-from-compiled-application.md](extracting-entitlements-from-compiled-application.md)
{% endcontent-ref %}

## **Recuperando el Archivo de Asociaci√≥n de Sitio de Apple**

Intente recuperar el archivo `apple-app-site-association` del servidor utilizando los dominios asociados que obtuvo en el paso anterior. Este archivo debe ser accesible v√≠a HTTPS, sin redirecciones, en `https://<dominio>/apple-app-site-association` o `https://<dominio>/.well-known/apple-app-site-association`.

Puede recuperarlo usted mismo con su navegador o usar el [Validador de Asociaci√≥n de Sitio de Apple (AASA)](https://branch.io/resources/aasa-validator/).

## **Verificando el M√©todo Receptor de Enlaces**

Para recibir enlaces y manejarlos adecuadamente, el delegado de la aplicaci√≥n debe implementar [`application:continueUserActivity:restorationHandler:`](https://developer.apple.com/documentation/uikit/uiapplicationdelegate/1623072-application). Si tiene el proyecto original, intente buscar este m√©todo.

Tenga en cuenta que si la aplicaci√≥n utiliza [`openURL:options:completionHandler:`](https://developer.apple.com/documentation/uikit/uiapplication/1648685-openurl?language=objc) para abrir un enlace universal al sitio web de la aplicaci√≥n, el enlace no se abrir√° en la aplicaci√≥n. Como la llamada se origina en la aplicaci√≥n, no se manejar√° como un enlace universal.

* El esquema de la `webpageURL` debe ser HTTP o HTTPS (cualquier otro esquema deber√≠a lanzar una excepci√≥n). La [propiedad de instancia `scheme`](https://developer.apple.com/documentation/foundation/urlcomponents/1779624-scheme) de `URLComponents` / `NSURLComponents` se puede usar para verificar esto.

## **Verificando el M√©todo de Manejo de Datos**

Cuando iOS abre una aplicaci√≥n como resultado de un enlace universal, la aplicaci√≥n recibe un objeto `NSUserActivity` con un valor de `activityType` de `NSUserActivityTypeBrowsingWeb`. La propiedad `webpageURL` del objeto de actividad contiene la URL HTTP o HTTPS que el usuario accede. El siguiente ejemplo en Swift verifica exactamente esto antes de abrir la URL:
```swift
func application(_ application: UIApplication, continue userActivity: NSUserActivity,
restorationHandler: @escaping ([UIUserActivityRestoring]?) -> Void) -> Bool {
// ...
if userActivity.activityType == NSUserActivityTypeBrowsingWeb, let url = userActivity.webpageURL {
application.open(url, options: [:], completionHandler: nil)
}

return true
}
```
Adem√°s, recuerde que si la URL incluye par√°metros, no se deben confiar en ellos antes de ser cuidadosamente saneados y validados (incluso cuando provienen de un dominio confiable). Por ejemplo, podr√≠an haber sido falsificados por un atacante o podr√≠an incluir datos malformados. Si ese es el caso, toda la URL y, por lo tanto, la solicitud de enlace universal debe ser descartada.

La API `NSURLComponents` se puede utilizar para analizar y manipular los componentes de la URL. Esto tambi√©n puede ser parte del m√©todo `application:continueUserActivity:restorationHandler:` en s√≠ o podr√≠a ocurrir en un m√©todo separado que se llama desde √©l. El siguiente [ejemplo](https://developer.apple.com/documentation/uikit/core\_app/allowing\_apps\_and\_websites\_to\_link\_to\_your\_content/handling\_universal\_links#3001935) demuestra esto:
```swift
func application(_ application: UIApplication,
continue userActivity: NSUserActivity,
restorationHandler: @escaping ([Any]?) -> Void) -> Bool {
guard userActivity.activityType == NSUserActivityTypeBrowsingWeb,
let incomingURL = userActivity.webpageURL,
let components = NSURLComponents(url: incomingURL, resolvingAgainstBaseURL: true),
let path = components.path,
let params = components.queryItems else {
return false
}

if let albumName = params.first(where: { $0.name == "albumname" })?.value,
let photoIndex = params.first(where: { $0.name == "index" })?.value {
// Interact with album name and photo index

return true

} else {
// Handle when album and/or album name or photo index missing

return false
}
}
```
# Referencias

{% embed url="https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06h-testing-platform-interaction#testing-object-persistence-mstg-platform-8" %}



<details>

<summary><strong>Aprende hacking en AWS de cero a h√©roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver a tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** revisa los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Consigue el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **sigue** a **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de github** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
