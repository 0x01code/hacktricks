# iOS Universal Links

<details>

<summary><strong>Lernen Sie AWS-Hacking von Null auf Held mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks beworben sehen m√∂chten** oder **HackTricks als PDF herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merch**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositories einreichen.

</details>

## Einf√ºhrung

Universal Links bieten Benutzern ein **nahtloses Umleitungs**-Erlebnis, indem sie Inhalte direkt in der App √∂ffnen und die Notwendigkeit einer Safari-Umleitung umgehen. Diese Links sind **eindeutig** und sicher, da sie nicht von anderen Apps beansprucht werden k√∂nnen. Dies wird durch das Hosting einer `apple-app-site-association` JSON-Datei im Stammverzeichnis der Website sichergestellt, wodurch eine √ºberpr√ºfbare Verbindung zwischen der Website und der App hergestellt wird. In F√§llen, in denen die App nicht installiert ist, √ºbernimmt Safari und leitet den Benutzer zur Webseite weiter, wobei die Pr√§senz der App erhalten bleibt.

F√ºr Penetrationstester ist die `apple-app-site-association`-Datei von besonderem Interesse, da sie m√∂glicherweise **sensible Pfade** offenlegt, die m√∂glicherweise mit unver√∂ffentlichten Funktionen zusammenh√§ngen.

### **Analyse der zugeordneten Domains-Berechtigung**

Entwickler aktivieren Universal Links, indem sie die **Associated Domains** im Capabilities-Tab von Xcode konfigurieren oder die `.entitlements`-Datei inspizieren. Jede Domain ist mit `applinks:` vorangestellt. Zum Beispiel k√∂nnte die Konfiguration von Telegram wie folgt aussehen:
```xml
<key>com.apple.developer.associated-domains</key>
<array>
<string>applinks:telegram.me</string>
<string>applinks:t.me</string>
</array>
```
F√ºr umfassendere Einblicke verweisen Sie auf die [archivierte Apple Developer-Dokumentation](https://developer.apple.com/library/archive/documentation/General/Conceptual/AppSearch/UniversalLinks.html#//apple_ref/doc/uid/TP40016308-CH12-SW2).

Wenn Sie mit einer kompilierten Anwendung arbeiten, k√∂nnen Berechtigungen gem√§√ü [diesem Leitfaden](extracting-entitlements-from-compiled-application.md) extrahiert werden.

### **Abrufen der Apple App Site Association-Datei**

Die `apple-app-site-association`-Datei sollte vom Server unter Verwendung der in den Berechtigungen angegebenen Domains abgerufen werden. Stellen Sie sicher, dass die Datei √ºber HTTPS direkt unter `https://<domain>/apple-app-site-association` erreichbar ist. Tools wie der [Apple App Site Association (AASA) Validator](https://branch.io/resources/aasa-validator/) k√∂nnen bei diesem Prozess helfen.

### **Behandlung von Universal Links in der App**

Die App muss spezifische Methoden implementieren, um Universal Links korrekt zu behandeln. Die Hauptmethode, nach der gesucht werden muss, ist [`application:continueUserActivity:restorationHandler:`](https://developer.apple.com/documentation/uikit/uiapplicationdelegate/1623072-application). Es ist entscheidend, dass das Schema der behandelten URLs HTTP oder HTTPS ist, da andere nicht unterst√ºtzt werden.

#### **Validierung der Datenhandlermethode**

Wenn ein Universal Link eine App √∂ffnet, wird der App ein `NSUserActivity`-Objekt mit der URL √ºbergeben. Bevor diese URL verarbeitet wird, ist es wichtig, sie zu validieren und zu bereinigen, um Sicherheitsrisiken zu vermeiden. Hier ist ein Beispiel in Swift, das den Prozess veranschaulicht:
```swift
func application(_ application: UIApplication, continue userActivity: NSUserActivity,
restorationHandler: @escaping ([UIUserActivityRestoring]?) -> Void) -> Bool {
// Check for web browsing activity and valid URL
if userActivity.activityType == NSUserActivityTypeBrowsingWeb, let url = userActivity.webpageURL {
application.open(url, options: [:], completionHandler: nil)
}

return true
}
```
URLs sollten sorgf√§ltig analysiert und validiert werden, insbesondere wenn sie Parameter enthalten, um sich gegen m√∂gliche Spoofing- oder fehlerhafte Daten zu sch√ºtzen. Die `NSURLComponents` API ist f√ºr diesen Zweck n√ºtzlich, wie unten dargestellt:
```swift
func application(_ application: UIApplication,
continue userActivity: NSUserActivity,
restorationHandler: @escaping ([Any]?) -> Void) -> Bool {
guard userActivity.activityType == NSUserActivityTypeBrowsingWeb,
let incomingURL = userActivity.webpageURL,
let components = NSURLComponents(url: incomingURL, resolvingAgainstBaseURL: true),
let path = components.path,
let params = components.queryItems else {
return false
}

if let albumName = params.first(where: { $0.name == "albumname" })?.value,
let photoIndex = params.first(where: { $0.name == "index" })?.value {
// Process the URL with album name and photo index

return true

} else {
// Handle invalid or missing parameters

return false
}
}
```
Durch **sorgf√§ltige Konfiguration und Validierung** k√∂nnen Entwickler sicherstellen, dass universelle Links die Benutzererfahrung verbessern, w√§hrend Sicherheits- und Datenschutzstandards eingehalten werden.


## Tools
* [GetUniversal.link](https://getuniversal.link/): Hilft dabei, das Testen und Verwalten der Universal Links und der AASA-Datei Ihrer App zu vereinfachen. Geben Sie einfach Ihre Domain ein, um die Integrit√§t der AASA-Datei zu √ºberpr√ºfen, oder verwenden Sie das benutzerdefinierte Dashboard, um das Linkverhalten einfach zu testen. Dieses Tool hilft Ihnen auch dabei festzustellen, wann Apple Ihre AASA-Datei das n√§chste Mal indizieren wird.

## References
* [https://mas.owasp.org/MASTG/tests/ios/MASVS-PLATFORM/MASTG-TEST-0070/#static-analysis](https://mas.owasp.org/MASTG/tests/ios/MASVS-PLATFORM/MASTG-TEST-0070/#static-analysis)
* [https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06h-testing-platform-interaction#testing-object-persistence-mstg-platform-8](https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06h-testing-platform-interaction#testing-object-persistence-mstg-platform-8)



<details>

<summary><strong>Erlernen Sie AWS-Hacking von Null auf Heldenniveau mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks beworben sehen m√∂chten** oder **HackTricks als PDF herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merch**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositories einreichen.

</details>
