# iOS Universal Links


<details>

<summary><strong>Aprenda hacking AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ quiser ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF** Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-nos** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para os** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) reposit√≥rios do github.

</details>


## Introdu√ß√£o

Os links universais oferecem uma experi√™ncia de **redirecionamento cont√≠nuo** aos usu√°rios, abrindo diretamente o conte√∫do no aplicativo, evitando a necessidade de redirecionamento pelo Safari. Esses links s√£o **√∫nicos** e seguros, pois n√£o podem ser reivindicados por outros aplicativos. Isso √© garantido hospedando um arquivo JSON `apple-app-site-association` no diret√≥rio raiz do site, estabelecendo um link verific√°vel entre o site e o aplicativo. Nos casos em que o aplicativo n√£o est√° instalado, o Safari assume e direciona o usu√°rio para a p√°gina da web, mantendo a presen√ßa do aplicativo.

Para testadores de penetra√ß√£o, o arquivo `apple-app-site-association` √© de particular interesse, pois pode revelar **caminhos sens√≠veis**, potencialmente incluindo aqueles relacionados a recursos n√£o lan√ßados.

### **Analisando a Entitlement de Dom√≠nios Associados**

Os desenvolvedores habilitam os Links Universais configurando os **Dom√≠nios Associados** na guia Capacidades do Xcode ou inspecionando o arquivo `.entitlements`. Cada dom√≠nio √© prefixado com `applinks:`. Por exemplo, a configura√ß√£o do Telegram pode aparecer da seguinte forma:
```xml
<key>com.apple.developer.associated-domains</key>
<array>
<string>applinks:telegram.me</string>
<string>applinks:t.me</string>
</array>
```
Para obter insights mais abrangentes, consulte a [Documenta√ß√£o Arquivada do Desenvolvedor da Apple](https://developer.apple.com/library/archive/documentation/General/Conceptual/AppSearch/UniversalLinks.html#//apple_ref/doc/uid/TP40016308-CH12-SW2).

Se estiver trabalhando com um aplicativo compilado, os direitos podem ser extra√≠dos conforme descrito neste [guia](extracting-entitlements-from-compiled-application.md).

### **Recuperando o Arquivo de Associa√ß√£o do Site do Aplicativo da Apple**

O arquivo `apple-app-site-association` deve ser recuperado do servidor usando os dom√≠nios especificados nos direitos. Certifique-se de que o arquivo seja acess√≠vel via HTTPS diretamente em `https://<dom√≠nio>/apple-app-site-association`. Ferramentas como o [Validador de Associa√ß√£o do Site do Aplicativo da Apple (AASA)](https://branch.io/resources/aasa-validator/) podem auxiliar nesse processo.

### **Manipulando Links Universais no Aplicativo**

O aplicativo deve implementar m√©todos espec√≠ficos para lidar corretamente com links universais. O m√©todo principal a ser procurado √© [`application:continueUserActivity:restorationHandler:`](https://developer.apple.com/documentation/uikit/uiapplicationdelegate/1623072-application). √â crucial que o esquema de URLs manipulados seja HTTP ou HTTPS, pois outros n√£o ser√£o suportados.

#### **Validando o M√©todo do Manipulador de Dados**

Quando um link universal abre um aplicativo, um objeto `NSUserActivity` √© passado para o aplicativo com o URL. Antes de processar este URL, √© essencial valid√°-lo e sanitiz√°-lo para evitar riscos de seguran√ßa. Aqui est√° um exemplo em Swift que demonstra o processo:
```swift
func application(_ application: UIApplication, continue userActivity: NSUserActivity,
restorationHandler: @escaping ([UIUserActivityRestoring]?) -> Void) -> Bool {
// Check for web browsing activity and valid URL
if userActivity.activityType == NSUserActivityTypeBrowsingWeb, let url = userActivity.webpageURL {
application.open(url, options: [:], completionHandler: nil)
}

return true
}
```
URLs devem ser cuidadosamente analisados e validados, especialmente se inclu√≠rem par√¢metros, para se proteger contra poss√≠veis falsifica√ß√µes ou dados malformados. A API `NSURLComponents` √© √∫til para esse fim, como demonstrado abaixo:
```swift
func application(_ application: UIApplication,
continue userActivity: NSUserActivity,
restorationHandler: @escaping ([Any]?) -> Void) -> Bool {
guard userActivity.activityType == NSUserActivityTypeBrowsingWeb,
let incomingURL = userActivity.webpageURL,
let components = NSURLComponents(url: incomingURL, resolvingAgainstBaseURL: true),
let path = components.path,
let params = components.queryItems else {
return false
}

if let albumName = params.first(where: { $0.name == "albumname" })?.value,
let photoIndex = params.first(where: { $0.name == "index" })?.value {
// Process the URL with album name and photo index

return true

} else {
// Handle invalid or missing parameters

return false
}
}
```
Atrav√©s da **configura√ß√£o e valida√ß√£o diligentes**, os desenvolvedores podem garantir que os links universais aprimorem a experi√™ncia do usu√°rio, mantendo os padr√µes de seguran√ßa e privacidade.


## Ferramentas
* [GetUniversal.link](https://getuniversal.link/): Ajuda a simplificar o teste e gerenciamento dos Links Universais e do arquivo AASA do seu aplicativo. Basta inserir seu dom√≠nio para verificar a integridade do arquivo AASA ou usar o painel personalizado para testar facilmente o comportamento do link. Essa ferramenta tamb√©m ajuda a determinar quando a Apple indexar√° seu arquivo AASA.

## Refer√™ncias
* [https://mas.owasp.org/MASTG/tests/ios/MASVS-PLATFORM/MASTG-TEST-0070/#static-analysis](https://mas.owasp.org/MASTG/tests/ios/MASVS-PLATFORM/MASTG-TEST-0070/#static-analysis)
* [https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06h-testing-platform-interaction#testing-object-persistence-mstg-platform-8](https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06h-testing-platform-interaction#testing-object-persistence-mstg-platform-8)



<details>

<summary><strong>Aprenda hacking AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras maneiras de apoiar o HackTricks:

* Se voc√™ deseja ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF**, verifique os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**swag oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-nos** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para os reposit√≥rios** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
