# iOS Universal Links

<details>

<summary><strong>Impara l'hacking AWS da zero a eroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Esperto Red Team AWS di HackTricks)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se vuoi vedere la tua **azienda pubblicizzata su HackTricks** o **scaricare HackTricks in PDF** Controlla i [**PIANI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale di PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**La Famiglia PEASS**](https://opensea.io/collection/the-peass-family), la nostra collezione di [**NFT esclusivi**](https://opensea.io/collection/the-peass-family)
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR a** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos di github.

</details>

## Introduzione

I collegamenti universali offrono un'esperienza di **redirezione senza soluzione di continuit√†** agli utenti aprendo direttamente i contenuti nell'app, evitando la necessit√† di redirezionamento tramite Safari. Questi collegamenti sono **unici** e sicuri, poich√© non possono essere rivendicati da altre app. Ci√≤ √® garantito ospitando un file JSON `apple-app-site-association` nella directory radice del sito web, stabilendo un collegamento verificabile tra il sito web e l'app. Nei casi in cui l'app non sia installata, Safari prender√† il controllo e indirizzer√† l'utente alla pagina web, mantenendo la presenza dell'app.

Per i tester di penetrazione, il file `apple-app-site-association` √® di particolare interesse in quanto potrebbe rivelare **percorsi sensibili**, potenzialmente inclusi quelli relativi a funzionalit√† non ancora rilasciate.

### **Analisi dell'Abilitazione dei Domini Associati**

Gli sviluppatori abilitano i Collegamenti Universali configurando i **Domini Associati** nella scheda Capacit√† di Xcode o ispezionando il file `.entitlements`. Ogni dominio √® preceduto da `applinks:`. Ad esempio, la configurazione di Telegram potrebbe apparire come segue:
```xml
<key>com.apple.developer.associated-domains</key>
<array>
<string>applinks:telegram.me</string>
<string>applinks:t.me</string>
</array>
```
Per approfondimenti pi√π completi, fare riferimento alla [Documentazione degli sviluppatori Apple archiviata](https://developer.apple.com/library/archive/documentation/General/Conceptual/AppSearch/UniversalLinks.html#//apple_ref/doc/uid/TP40016308-CH12-SW2).

Se si lavora con un'applicazione compilata, i diritti possono essere estratti come descritto in [questa guida](extracting-entitlements-from-compiled-application.md).

### **Recupero del file Apple App Site Association**

Il file `apple-app-site-association` deve essere recuperato dal server utilizzando i domini specificati nei diritti. Assicurarsi che il file sia accessibile tramite HTTPS direttamente su `https://<dominio>/apple-app-site-association`. Strumenti come il [Validatore dell'Apple App Site Association (AASA)](https://branch.io/resources/aasa-validator/) possono aiutare in questo processo.

### **Gestione dei collegamenti universali nell'app**

L'app deve implementare metodi specifici per gestire correttamente i collegamenti universali. Il metodo principale da cercare √® [`application:continueUserActivity:restorationHandler:`](https://developer.apple.com/documentation/uikit/uiapplicationdelegate/1623072-application). √à cruciale che lo schema degli URL gestiti sia HTTP o HTTPS, poich√© altri non saranno supportati.

#### **Convalida del metodo del gestore dei dati**

Quando un collegamento universale apre un'app, un oggetto `NSUserActivity` viene passato all'app con l'URL. Prima di elaborare questo URL, √® essenziale convalidarlo e sanificarlo per prevenire rischi per la sicurezza. Ecco un esempio in Swift che illustra il processo:
```swift
func application(_ application: UIApplication, continue userActivity: NSUserActivity,
restorationHandler: @escaping ([UIUserActivityRestoring]?) -> Void) -> Bool {
// Check for web browsing activity and valid URL
if userActivity.activityType == NSUserActivityTypeBrowsingWeb, let url = userActivity.webpageURL {
application.open(url, options: [:], completionHandler: nil)
}

return true
}
```
Gli URL dovrebbero essere attentamente analizzati e convalidati, specialmente se includono parametri, per proteggersi da possibili tentativi di spoofing o dati malformati. L'API `NSURLComponents` √® utile a questo scopo, come dimostrato di seguito:
```swift
func application(_ application: UIApplication,
continue userActivity: NSUserActivity,
restorationHandler: @escaping ([Any]?) -> Void) -> Bool {
guard userActivity.activityType == NSUserActivityTypeBrowsingWeb,
let incomingURL = userActivity.webpageURL,
let components = NSURLComponents(url: incomingURL, resolvingAgainstBaseURL: true),
let path = components.path,
let params = components.queryItems else {
return false
}

if let albumName = params.first(where: { $0.name == "albumname" })?.value,
let photoIndex = params.first(where: { $0.name == "index" })?.value {
// Process the URL with album name and photo index

return true

} else {
// Handle invalid or missing parameters

return false
}
}
```
Attraverso **una configurazione e una convalida diligenti**, gli sviluppatori possono garantire che i collegamenti universali migliorino l'esperienza dell'utente mantenendo gli standard di sicurezza e privacy.


## Strumenti
* [GetUniversal.link](https://getuniversal.link/): Aiuta a semplificare il testing e la gestione dei collegamenti universali e del file AASA dell'app. Basta inserire il proprio dominio per verificare l'integrit√† del file AASA o utilizzare il pannello personalizzato per testare facilmente il comportamento del collegamento. Questo strumento aiuta anche a determinare quando Apple indicizzer√† il prossimo file AASA.

## Riferimenti
* [https://mas.owasp.org/MASTG/tests/ios/MASVS-PLATFORM/MASTG-TEST-0070/#static-analysis](https://mas.owasp.org/MASTG/tests/ios/MASVS-PLATFORM/MASTG-TEST-0070/#static-analysis)
* [https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06h-testing-platform-interaction#testing-object-persistence-mstg-platform-8](https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06h-testing-platform-interaction#testing-object-persistence-mstg-platform-8)



<details>

<summary><strong>Impara l'hacking di AWS da zero a eroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se desideri vedere la tua **azienda pubblicizzata in HackTricks** o **scaricare HackTricks in PDF** Controlla i [**PIANI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale di PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**The PEASS Family**](https://opensea.io/collection/the-peass-family), la nostra collezione di [**NFT esclusivi**](https://opensea.io/collection/the-peass-family)
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR a** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
