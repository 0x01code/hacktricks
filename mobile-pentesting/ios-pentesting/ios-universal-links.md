# iOS Universal Links


<details>

<summary><strong>AWS hacklemeyi sıfırdan kahraman seviyesine öğrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> ile!</strong></summary>

HackTricks'ı desteklemenin diğer yolları:

* **Şirketinizi HackTricks'te reklamını görmek istiyorsanız** veya **HackTricks'i PDF olarak indirmek istiyorsanız** [**ABONELİK PLANLARI**](https://github.com/sponsors/carlospolop)'na göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family'yi**](https://opensea.io/collection/the-peass-family) keşfedin, özel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* **Katılın** 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) veya bizi **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)'da **takip edin**.
* **Hacking püf noktalarınızı paylaşarak PR'lar göndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına katkıda bulunun.

</details>


## Giriş

Universal linkler, kullanıcılara içeriği doğrudan uygulamada açarak Safari yönlendirmesi gereksinimini atlayarak **dikişsiz bir yönlendirme** deneyimi sunar. Bu linkler **benzersiz** ve güvenlidir, çünkü diğer uygulamalar tarafından talep edilemezler. Bu, `apple-app-site-association` JSON dosyasının web sitesinin kök dizininde barındırılmasıyla sağlanır, web sitesi ile uygulama arasında doğrulanabilir bir bağlantı kurulur. Uygulama yüklü değilse, Safari devralacak ve kullanıcıyı web sayfasına yönlendirecek, uygulamanın varlığını sürdürecektir.

Sızma testçileri için, `apple-app-site-association` dosyası özellikle ilgi çekicidir çünkü **duyarlı yolları** ortaya çıkarabilir, muhtemelen yayınlanmamış özelliklerle ilgili olanları içerebilir.

### **İlişkilendirilmiş Alanlar Yetkisi'nin Analizi**

Geliştiriciler, Universal Linkleri Xcode'un Yetenekler sekmesinde **İlişkilendirilmiş Alanlar**'ı yapılandırarak veya `.entitlements` dosyasını inceleyerek etkinleştirirler. Her alan `applinks:` ile başlar. Örneğin, Telegram'ın yapılandırması aşağıdaki gibi görünebilir:
```xml
<key>com.apple.developer.associated-domains</key>
<array>
<string>applinks:telegram.me</string>
<string>applinks:t.me</string>
</array>
```
Daha kapsamlı bilgiler için [arşivlenmiş Apple Geliştirici Belgelerine](https://developer.apple.com/library/archive/documentation/General/Conceptual/AppSearch/UniversalLinks.html#//apple_ref/doc/uid/TP40016308-CH12-SW2) başvurun.

Derlenmiş bir uygulama ile çalışılıyorsa, ayrıntılar [bu kılavuzda](extracting-entitlements-from-compiled-application.md) belirtildiği gibi çıkarılabilir.

### **Apple Uygulama Sitesi İlişkilendirme Dosyasını Almak**

`apple-app-site-association` dosyası, ayrıcalıklarda belirtilen alanları kullanarak sunucudan alınmalıdır. Dosyanın doğrudan `https://<domain>/apple-app-site-association` adresinden erişilebilir olduğundan emin olun. [Apple Uygulama Sitesi İlişkilendirme (AASA) Doğrulayıcı](https://branch.io/resources/aasa-validator/) gibi araçlar bu süreçte yardımcı olabilir.

### **Uygulamada Evrensel Bağlantıları İşleme**

Uygulama, evrensel bağlantıları doğru bir şekilde işlemek için belirli yöntemleri uygulamalıdır. Aranması gereken temel yöntem [`application:continueUserActivity:restorationHandler:`](https://developer.apple.com/documentation/uikit/uiapplicationdelegate/1623072-application) yöntemidir. İşlenen URL'lerin şemasının HTTP veya HTTPS olması önemlidir, diğerleri desteklenmeyecektir.

#### **Veri İşleyici Yönteminin Doğrulanması**

Evrensel bir bağlantı bir uygulamayı açtığında, bir `NSUserActivity` nesnesi URL ile birlikte uygulamaya iletilir. Bu URL'yi işlemeden önce, güvenlik risklerini önlemek için doğrulamak ve temizlemek önemlidir. İşte bu süreci gösteren Swift'te bir örnek:
```swift
func application(_ application: UIApplication, continue userActivity: NSUserActivity,
restorationHandler: @escaping ([UIUserActivityRestoring]?) -> Void) -> Bool {
// Check for web browsing activity and valid URL
if userActivity.activityType == NSUserActivityTypeBrowsingWeb, let url = userActivity.webpageURL {
application.open(url, options: [:], completionHandler: nil)
}

return true
}
```
URL'ler özellikle parametreler içeriyorsa dikkatlice ayrıştırılmalı ve doğrulanmalıdır, böylece potansiyel sahtecilik veya hatalı verilere karşı koruma sağlanır. Bu amaçla `NSURLComponents` API'si kullanışlıdır, aşağıda gösterildiği gibi:
```swift
func application(_ application: UIApplication,
continue userActivity: NSUserActivity,
restorationHandler: @escaping ([Any]?) -> Void) -> Bool {
guard userActivity.activityType == NSUserActivityTypeBrowsingWeb,
let incomingURL = userActivity.webpageURL,
let components = NSURLComponents(url: incomingURL, resolvingAgainstBaseURL: true),
let path = components.path,
let params = components.queryItems else {
return false
}

if let albumName = params.first(where: { $0.name == "albumname" })?.value,
let photoIndex = params.first(where: { $0.name == "index" })?.value {
// Process the URL with album name and photo index

return true

} else {
// Handle invalid or missing parameters

return false
}
}
```
**Dikkatli yapılandırma ve doğrulama** sayesinde geliştiriciler, evrensel bağlantıların kullanıcı deneyimini artırırken güvenlik ve gizlilik standartlarını koruyabileceğinden emin olabilirler.


## Araçlar
* [GetUniversal.link](https://getuniversal.link/): Uygulamanızın Evrensel Bağlantıları ve AASA dosyasının test edilmesini ve yönetilmesini kolaylaştırmaya yardımcı olur. AASA dosyasının bütünlüğünü doğrulamak için alan adınızı girin veya özel panoyu kullanarak bağlantı davranışını kolayca test etmek için özel panoyu kullanın. Bu araç ayrıca Apple'ın bir sonraki AASA dosyanızı ne zaman dizine ekleyeceğinizi belirlemenize yardımcı olur.

## Referanslar
* [https://mas.owasp.org/MASTG/tests/ios/MASVS-PLATFORM/MASTG-TEST-0070/#static-analysis](https://mas.owasp.org/MASTG/tests/ios/MASVS-PLATFORM/MASTG-TEST-0070/#static-analysis)
* [https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06h-testing-platform-interaction#testing-object-persistence-mstg-platform-8](https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06h-testing-platform-interaction#testing-object-persistence-mstg-platform-8)



<details>

<summary><strong>Sıfırdan kahraman olacak şekilde AWS hacklemeyi öğrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks'ı desteklemenin diğer yolları:

* **Şirketinizi HackTricks'te reklamını görmek istiyorsanız** veya **HackTricks'i PDF olarak indirmek istiyorsanız** [**ABONELİK PLANLARI**]'na (https://github.com/sponsors/carlospolop) göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) koleksiyonumuzu keşfedin, özel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family)
* **💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katılın veya bizi **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)** takip edin.**
* **Hacking püf noktalarınızı paylaşarak PR'lar göndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına katkıda bulunun.

</details>
