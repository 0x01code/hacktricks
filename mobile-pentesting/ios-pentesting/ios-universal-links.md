<details>

<summary><strong>Aprenda hacking no AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ quer ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**material oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **Junte-se ao grupo** üí¨ [**Discord**](https://discord.gg/hRep4RUj7f) ou ao grupo [**telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios github do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>


Links universais permitem **redirecionar usu√°rios diretamente** para o aplicativo sem passar pelo Safari para redirecionamento.\
Os links universais s√£o **√∫nicos**, ent√£o **n√£o podem ser reivindicados por outros aplicativos** porque usam links HTTP(S) padr√£o para o **site onde o propriet√°rio carregou um arquivo para garantir que o site e o aplicativo estejam relacionados**.\
Como esses links usam esquemas HTTP(S), quando o **aplicativo n√£o est√° instalado, o Safari abrir√° o link** redirecionando os usu√°rios para a p√°gina. Isso permite que **aplicativos se comuniquem com o aplicativo mesmo que ele n√£o esteja instalado**.

Para criar links universais √© necess√°rio **criar um arquivo JSON chamado `apple-app-site-association`** com os detalhes. Depois, este arquivo precisa ser **hospedado no diret√≥rio raiz do seu servidor web** (por exemplo, [https://google.com/apple-app-site-association](https://google.com/apple-app-site-association)).\
Para o pentester, este arquivo √© muito interessante, pois **revela caminhos**. Ele pode at√© estar revelando caminhos de lan√ßamentos que ainda n√£o foram publicados.

## ‚Äã**Verificando o Entitlement de Dom√≠nios Associados**

No Xcode, v√° para a aba **Capabilities** e procure por **Associated Domains**. Voc√™ tamb√©m pode inspecionar o arquivo `.entitlements` procurando por `com.apple.developer.associated-domains`. Cada um dos dom√≠nios deve ser prefixado com `applinks:`, como `applinks:www.meusite.com`.

Aqui est√° um exemplo do arquivo `.entitlements` do Telegram:
```markup
<key>com.apple.developer.associated-domains</key>
<array>
<string>applinks:telegram.me</string>
<string>applinks:t.me</string>
</array>
```
Informa√ß√µes mais detalhadas podem ser encontradas na [documenta√ß√£o arquivada da Apple Developer](https://developer.apple.com/library/archive/documentation/General/Conceptual/AppSearch/UniversalLinks.html#//apple_ref/doc/uid/TP40016308-CH12-SW2).

Se voc√™ possui apenas o aplicativo compilado, pode extrair os entitlements seguindo este guia:

{% content-ref url="extracting-entitlements-from-compiled-application.md" %}
[extracting-entitlements-from-compiled-application.md](extracting-entitlements-from-compiled-application.md)
{% endcontent-ref %}

## **Recuperando o Arquivo de Associa√ß√£o de Site da Apple**

Tente recuperar o arquivo `apple-app-site-association` do servidor usando os dom√≠nios associados que voc√™ obteve no passo anterior. Este arquivo precisa estar acess√≠vel via HTTPS, sem redirecionamentos, em `https://<dom√≠nio>/apple-app-site-association` ou `https://<dom√≠nio>/.well-known/apple-app-site-association`.

Voc√™ pode recuper√°-lo sozinho com seu navegador ou usar o [Validador de Associa√ß√£o de Site da Apple (AASA)](https://branch.io/resources/aasa-validator/).

## **Verificando o M√©todo Receptor de Link**

Para receber links e lidar com eles adequadamente, o delegado do aplicativo deve implementar [`application:continueUserActivity:restorationHandler:`](https://developer.apple.com/documentation/uikit/uiapplicationdelegate/1623072-application). Se voc√™ tem o projeto original, tente procurar por este m√©todo.

Observe que se o aplicativo usa [`openURL:options:completionHandler:`](https://developer.apple.com/documentation/uikit/uiapplication/1648685-openurl?language=objc) para abrir um link universal para o site do aplicativo, o link n√£o ser√° aberto no aplicativo. Como a chamada se origina do aplicativo, ela n√£o ser√° tratada como um link universal.

* O esquema da `webpageURL` deve ser HTTP ou HTTPS (qualquer outro esquema deve lan√ßar uma exce√ß√£o). A [propriedade de inst√¢ncia `scheme`](https://developer.apple.com/documentation/foundation/urlcomponents/1779624-scheme) de `URLComponents` / `NSURLComponents` pode ser usada para verificar isso.

## **Verificando o M√©todo de Manipula√ß√£o de Dados**

Quando o iOS abre um aplicativo como resultado de um link universal, o aplicativo recebe um objeto `NSUserActivity` com um valor `activityType` de `NSUserActivityTypeBrowsingWeb`. A propriedade `webpageURL` do objeto de atividade cont√©m o URL HTTP ou HTTPS que o usu√°rio acessa. O seguinte exemplo em Swift verifica exatamente isso antes de abrir o URL:
```swift
func application(_ application: UIApplication, continue userActivity: NSUserActivity,
restorationHandler: @escaping ([UIUserActivityRestoring]?) -> Void) -> Bool {
// ...
if userActivity.activityType == NSUserActivityTypeBrowsingWeb, let url = userActivity.webpageURL {
application.open(url, options: [:], completionHandler: nil)
}

return true
}
```
Al√©m disso, lembre-se de que se a URL incluir par√¢metros, eles n√£o devem ser confi√°veis antes de serem cuidadosamente higienizados e validados (mesmo vindo de dom√≠nio confi√°vel). Por exemplo, eles podem ter sido falsificados por um atacante ou podem incluir dados malformados. Se for esse o caso, toda a URL e, portanto, a solicita√ß√£o de link universal deve ser descartada.

A API `NSURLComponents` pode ser usada para analisar e manipular os componentes da URL. Isso tamb√©m pode ser parte do m√©todo `application:continueUserActivity:restorationHandler:` em si ou pode ocorrer em um m√©todo separado sendo chamado a partir dele. O seguinte [exemplo](https://developer.apple.com/documentation/uikit/core\_app/allowing\_apps\_and\_websites\_to\_link\_to\_your\_content/handling\_universal\_links#3001935) demonstra isso:
```swift
func application(_ application: UIApplication,
continue userActivity: NSUserActivity,
restorationHandler: @escaping ([Any]?) -> Void) -> Bool {
guard userActivity.activityType == NSUserActivityTypeBrowsingWeb,
let incomingURL = userActivity.webpageURL,
let components = NSURLComponents(url: incomingURL, resolvingAgainstBaseURL: true),
let path = components.path,
let params = components.queryItems else {
return false
}

if let albumName = params.first(where: { $0.name == "albumname" })?.value,
let photoIndex = params.first(where: { $0.name == "index" })?.value {
// Interact with album name and photo index

return true

} else {
// Handle when album and/or album name or photo index missing

return false
}
}
```
# Refer√™ncias

{% embed url="https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06h-testing-platform-interaction#testing-object-persistence-mstg-platform-8" %}



<details>

<summary><strong>Aprenda hacking no AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ quer ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**material oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **Junte-se ao grupo** üí¨ [**Discord**](https://discord.gg/hRep4RUj7f) ou ao grupo [**telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios do GitHub** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
