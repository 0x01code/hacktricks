# iOS Univerzalni linkovi


<details>

<summary><strong>Naučite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi načini podrške HackTricks-u:

* Ako želite da vidite svoju **kompaniju reklamiranu na HackTricks-u** ili da **preuzmete HackTricks u PDF formatu** proverite [**PLANOVE ZA PRIJATELJSTVO**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvanični PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**Porodicu PEASS**](https://opensea.io/collection/the-peass-family), našu kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridružite se** 💬 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>


## Uvod

Univerzalni linkovi pružaju **besprekorno preusmeravanje** korisnicima otvaranjem sadržaja direktno u aplikaciji, zaobilazeći potrebu za preusmeravanjem preko Safarija. Ovi linkovi su **jedinstveni** i bezbedni, jer ih druge aplikacije ne mogu koristiti. Ovo se obezbeđuje postavljanjem `apple-app-site-association` JSON fajla u korenski direktorijum veb sajta, uspostavljajući proverljivu vezu između veb sajta i aplikacije. U slučajevima kada aplikacija nije instalirana, Safari će preuzeti kontrolu i usmeriti korisnika na veb stranicu, održavajući prisustvo aplikacije.

Za testere penetracije, fajl `apple-app-site-association` je od posebnog interesa jer može otkriti **osetljive putanje**, potencijalno uključujući one koje se odnose na neobjavljene funkcije.

### **Analiza Entitlement-a Povezanih Domena**

Programeri omogućavaju Univerzalne linkove konfigurišući **Povezane Domena** u Xcode-ovom tabu Mogućnosti ili inspekcijom `.entitlements` fajla. Svaki domen je prefiksovan sa `applinks:`. Na primer, konfiguracija Telegram-a može izgledati ovako:
```xml
<key>com.apple.developer.associated-domains</key>
<array>
<string>applinks:telegram.me</string>
<string>applinks:t.me</string>
</array>
```
Za sveobuhvatnije uvide, pogledajte [arhiviranu Apple Developer dokumentaciju](https://developer.apple.com/library/archive/documentation/General/Conceptual/AppSearch/UniversalLinks.html#//apple_ref/doc/uid/TP40016308-CH12-SW2).

Ako radite sa kompajliranom aplikacijom, dozvole se mogu izvući kako je navedeno u [ovom vodiču](extracting-entitlements-from-compiled-application.md).

### **Dobijanje fajla Apple App Site Association**

Fajl `apple-app-site-association` treba dobiti sa servera koristeći domene navedene u dozvolama. Proverite da li je fajl dostupan putem HTTPS direktno na `https://<domen>/apple-app-site-association`. Alati poput [Apple App Site Association (AASA) Validator](https://branch.io/resources/aasa-validator/) mogu pomoći u ovom procesu.

### **Obrada univerzalnih linkova u aplikaciji**

Aplikacija mora implementirati specifične metode za pravilno rukovanje univerzalnim linkovima. Glavna metoda koju treba potražiti je [`application:continueUserActivity:restorationHandler:`](https://developer.apple.com/documentation/uikit/uiapplicationdelegate/1623072-application). Ključno je da šema URL-ova koje se obrađuju bude HTTP ili HTTPS, jer druge neće biti podržane.

#### **Validacija metode za rukovanje podacima**

Kada univerzalni link otvori aplikaciju, `NSUserActivity` objekat se prosleđuje aplikaciji sa URL-om. Pre obrade ovog URL-a, važno je validirati i dezinfikovati ga kako bi se sprečili sigurnosni rizici. Evo primera u Swift-u koji demonstrira proces:
```swift
func application(_ application: UIApplication, continue userActivity: NSUserActivity,
restorationHandler: @escaping ([UIUserActivityRestoring]?) -> Void) -> Bool {
// Check for web browsing activity and valid URL
if userActivity.activityType == NSUserActivityTypeBrowsingWeb, let url = userActivity.webpageURL {
application.open(url, options: [:], completionHandler: nil)
}

return true
}
```
URL-ovi treba pažljivo da se analiziraju i validiraju, posebno ako uključuju parametre, kako bi se zaštitili od potencijalnog falsifikovanja ili neispravnih podataka. `NSURLComponents` API je koristan u tu svrhu, kao što je prikazano ispod:
```swift
func application(_ application: UIApplication,
continue userActivity: NSUserActivity,
restorationHandler: @escaping ([Any]?) -> Void) -> Bool {
guard userActivity.activityType == NSUserActivityTypeBrowsingWeb,
let incomingURL = userActivity.webpageURL,
let components = NSURLComponents(url: incomingURL, resolvingAgainstBaseURL: true),
let path = components.path,
let params = components.queryItems else {
return false
}

if let albumName = params.first(where: { $0.name == "albumname" })?.value,
let photoIndex = params.first(where: { $0.name == "index" })?.value {
// Process the URL with album name and photo index

return true

} else {
// Handle invalid or missing parameters

return false
}
}
```
Kroz **pažljivu konfiguraciju i validaciju**, programeri mogu osigurati da univerzalni linkovi poboljšaju korisničko iskustvo, održavajući standarde bezbednosti i privatnosti.


## Alati
* [GetUniversal.link](https://getuniversal.link/): Pomaže u pojednostavljenju testiranja i upravljanja univerzalnim linkovima vaše aplikacije i AASA datotekom. Jednostavno unesite svoju domenu da biste proverili celovitost AASA datoteke ili koristite prilagođenu kontrolnu tablu da biste lako testirali ponašanje linka. Ovaj alat takođe vam pomaže da odredite kada će Apple sledeći put indeksirati vašu AASA datoteku.

## Reference
* [https://mas.owasp.org/MASTG/tests/ios/MASVS-PLATFORM/MASTG-TEST-0070/#static-analysis](https://mas.owasp.org/MASTG/tests/ios/MASVS-PLATFORM/MASTG-TEST-0070/#static-analysis)
* [https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06h-testing-platform-interaction#testing-object-persistence-mstg-platform-8](https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06h-testing-platform-interaction#testing-object-persistence-mstg-platform-8)



<details>

<summary><strong>Naučite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi načini podrške HackTricks-u:

* Ako želite da vidite **vašu kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** Proverite [**PLANOVE ZA PRIJAVU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvanični PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), našu kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridružite se** 💬 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
