# iOS的Burp Suite配置

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks云 ☁️</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>🐦 推特 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 YouTube 🎥</strong></a></summary>

* 你在一家**网络安全公司**工作吗？你想在HackTricks中看到你的**公司广告**吗？或者你想获得**PEASS的最新版本或下载PDF格式的HackTricks**吗？请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 发现我们的独家[NFTs](https://opensea.io/collection/the-peass-family)收藏品[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* 获取[**官方PEASS和HackTricks周边产品**](https://peass.creator-spring.com)
* **加入**[**💬**](https://emojipedia.org/speech-balloon/) [**Discord群组**](https://discord.gg/hRep4RUj7f)或[**电报群组**](https://t.me/peass)，或者**关注**我在**Twitter**上的[**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**。**
* **通过向**[**hacktricks repo**](https://github.com/carlospolop/hacktricks) **和**[**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **提交PR来分享你的黑客技巧。**

</details>

<figure><img src="../../.gitbook/assets/image (3) (1).png" alt=""><figcaption></figcaption></figure>

\
使用[**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks)可以轻松构建和**自动化工作流程**，使用全球**最先进**的社区工具。\
立即获取访问权限：

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## 在物理iOS设备上安装Burp证书

您可以安装[**Burp Mobile Assistant**](https://portswigger.net/burp/documentation/desktop/tools/mobile-assistant/installing) **来帮助安装Burp证书，配置代理并执行SSL Pinning。**\
或者您可以手动按照以下步骤操作：

* 在iPhone的**设置** --> **Wi-Fi** --> **点击网络** --> **代理**中将**Burp**配置为代理
* 访问`http://burp`并下载证书
* 访问**设置** --> **通用** --> **VPN和设备管理** --> 选择下载的配置文件并安装（将会要求输入您的代码）
* 访问**设置** --> **通用** --> **关于本机** --> **证书信任设置**并启用PortSwigger CA

### 通过本地主机设置拦截代理

设置Burp来代理您的流量非常简单。我们假设您的iOS设备和主机计算机都连接到允许客户端之间流量的Wi-Fi网络。如果不允许客户端之间的流量，您可以使用usbmuxd通过USB连接到Burp。

PortSwigger提供了一个很好的[教程，介绍如何设置iOS设备与Burp一起使用](https://support.portswigger.net/customer/portal/articles/1841108-configuring-an-ios-device-to-work-with-burp)以及[教程，介绍如何在iOS设备上安装Burp的CA证书](https://support.portswigger.net/customer/portal/articles/1841109-installing-burp-s-ca-certificate-in-an-ios-device)。

#### 在越狱设备上通过USB使用Burp

在进行动态分析时，使用SSH连接将我们的流量路由到在计算机上运行的Burp非常有趣。让我们开始吧：

首先，我们需要使用**iproxy**将iOS上的SSH连接可用于本地主机。
```bash
$ iproxy 2222 22
waiting for connection
```
下一步是将iOS设备上的8080端口进行远程端口转发，将其转发到我们计算机上的本地接口的8080端口。
```bash
ssh -R 8080:localhost:8080 root@localhost -p 2222
```
你现在应该能够在iOS设备上访问Burp。在iOS上打开Safari，转到**127.0.0.1:8080**，你应该能够看到Burp Suite页面。现在是[在iOS设备上安装Burp的CA证书](https://support.portswigger.net/customer/portal/articles/1841109-installing-burp-s-ca-certificate-in-an-ios-device)的好时机。

最后一步是在iOS设备上全局设置代理：

1. 进入**设置** -> **Wi-Fi**
2. 连接到_任意_ Wi-Fi（你可以随便连接到任何Wi-Fi，因为端口80和443的流量将通过USB路由，我们只是使用Wi-Fi的代理设置，以便设置全局代理）
3. 连接后，点击连接的Wi-Fi右侧的小蓝色图标
4. 通过选择**手动**来配置代理
5. 将127.0.0.1输入为**服务器**
6. 将8080输入为**端口**

### 完整的网络监控/嗅探

如果你需要**监控与HTTP通信不同的内容**，你可以使用**Wireshark**来嗅探所有设备流量。\
你可以通过[为你的iOS设备创建远程虚拟接口](https://stackoverflow.com/questions/9555403/capturing-mobile-phone-traffic-on-wireshark/33175819#33175819)来实时远程嗅探iOS上的所有流量。首先确保你的macOS主机计算机上已经**安装了Wireshark**。

1. 通过USB将你的iOS设备连接到macOS主机计算机。
2. 在开始嗅探之前，你需要知道你的iOS设备的**UDID**。在macOS上打开终端，并输入以下命令，填入你的iOS设备的UDID。
```bash
$ rvictl -s <UDID>
Starting device <UDID> [SUCCEEDED] with interface rvi0
```
1. 启动 **Wireshark** 并选择 "**rvi0**" 作为捕获接口。
2. 使用 Wireshark 中的捕获过滤器来过滤流量，以显示您想要监视的内容（例如，通过 IP 地址 192.168.1.1 发送/接收的所有 HTTP 流量）。
```
ip.addr == 192.168.1.1 && http
```
![](<../../.gitbook/assets/image (472).png>)

Wireshark的文档提供了许多[捕获过滤器](https://wiki.wireshark.org/CaptureFilters)的示例，这些示例应该能帮助您过滤流量以获取所需的信息。

## 在模拟器中安装Burp证书

* **导出Burp证书**

在_Proxy_ --> _Options_ --> _Export CA certificate_ --> _Certificate in DER format_

![](<../../.gitbook/assets/image (459).png>)

* **将证书拖放到**模拟器中
* **在模拟器中**转到_Settings_ --> _General_ --> _Profile_ --> _PortSwigger CA_，并**验证证书**
* **在模拟器中**转到_Settings_ --> _General_ --> _About_ --> _Certificate Trust Settings_，并**启用PortSwigger CA**

![](<../../.gitbook/assets/image (460).png>)

**恭喜，您已成功在iOS模拟器中配置了Burp CA证书**

{% hint style="info" %}
**iOS模拟器将使用MacOS的代理配置。**
{% endhint %}

### MacOS代理配置

配置Burp作为代理的步骤：

* 转到_System Preferences_ --> _Network_ --> _Advanced_
* 在_Proxies_选项卡中标记_Web Proxy (HTTP)_和_Secure Web Proxy (HTTPS)_
* 在两个选项中都配置_127.0.0.1:8080_

![](<../../.gitbook/assets/image (461).png>)

* 点击_**Ok**_，然后点击_**Apply**_

<figure><img src="../../.gitbook/assets/image (3) (1).png" alt=""><figcaption></figcaption></figure>

\
使用[**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks)可以轻松构建和**自动化工作流程**，使用全球**最先进**的社区工具。\
立即获取访问权限：

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks Cloud ☁️</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>🐦 Twitter 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 Youtube 🎥</strong></a></summary>

* 您在**网络安全公司**工作吗？您想在HackTricks中看到您的**公司广告**吗？或者您想获得最新版本的PEASS或下载PDF格式的HackTricks吗？请查看[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)！
* 发现我们的独家[NFTs](https://opensea.io/collection/the-peass-family)收藏品[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* 获取[**官方PEASS和HackTricks衣物**](https://peass.creator-spring.com)
* **加入**[**💬**](https://emojipedia.org/speech-balloon/) [**Discord群组**](https://discord.gg/hRep4RUj7f)或[**电报群组**](https://t.me/peass)，或在**Twitter**上**关注**我[**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**。**
* **通过向**[**hacktricks repo**](https://github.com/carlospolop/hacktricks) **和**[**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **提交PR来分享您的黑客技巧。**

</details>
