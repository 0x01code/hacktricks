# iOS Burp Suite 配置

<details>

<summary><strong>从零开始学习 AWS 黑客技术直到成为专家，通过</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS 红队专家)</strong></a><strong>！</strong></summary>

支持 HackTricks 的其他方式：

* 如果您想在 **HackTricks 中看到您的公司广告** 或 **下载 HackTricks 的 PDF**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取 [**官方 PEASS & HackTricks 商品**](https://peass.creator-spring.com)
* 发现 [**PEASS 家族**](https://opensea.io/collection/the-peass-family)，我们独家的 [**NFT 集合**](https://opensea.io/collection/the-peass-family)
* **加入** 💬 [**Discord 群组**](https://discord.gg/hRep4RUj7f) 或 [**telegram 群组**](https://t.me/peass) 或在 **Twitter** 🐦 上**关注**我 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github 仓库提交 PR 来分享您的黑客技巧。

</details>

<figure><img src="../../.gitbook/assets/image (3) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
使用 [**Trickest**](https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks) 轻松构建并 **自动化工作流程**，由世界上 **最先进的** 社区工具提供支持。\
立即获取访问权限：

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## 在实体 iOS 设备中安装 Burp 证书

您可以安装 [**Burp Mobile Assistant**](https://portswigger.net/burp/documentation/desktop/tools/mobile-assistant/installing) **以帮助安装 Burp 证书，配置代理并执行 SSL Pinning。**\
或者您可以手动按照以下步骤操作：

* 在 **设置** --> **Wifi** --> **点击网络** --> **代理** 中配置 **Burp** 作为 iPhone **代理**
* 访问 `http://burp` 并下载证书
* 访问 **设置** --> **通用** --> **VPN & 设备管理** --> 选择已下载的配置文件并安装（将要求您输入代码）
* 访问 **设置** --> **通用** --> **关于** --> **证书信任设置** 并启用 PortSwigger CA

### 通过 localhost 设置拦截代理

设置 Burp 以代理您的流量非常简单。我们假设您的 iOS 设备和主机计算机都连接到允许客户端到客户端流量的 Wi-Fi 网络。如果不允许客户端到客户端流量，您可以使用 usbmuxd 通过 USB 连接到 Burp。

PortSwigger 提供了一个很好的[教程，介绍如何设置 iOS 设备以使用 Burp](https://support.portswigger.net/customer/portal/articles/1841108-configuring-an-ios-device-to-work-with-burp) 和一个[教程，介绍如何在 iOS 设备中安装 Burp 的 CA 证书](https://support.portswigger.net/customer/portal/articles/1841109-installing-burp-s-ca-certificate-in-an-ios-device)。

#### 在越狱设备上通过 USB 使用 Burp

在进行动态分析时，使用 SSH 连接将我们的流量路由到在我们计算机上运行的 Burp 是很有趣的。让我们开始吧：

首先我们需要使用 **iproxy** 使 iOS 上的 SSH 在 localhost 上可用。
```bash
$ iproxy 2222 22
waiting for connection
```
下一步是在iOS设备上将8080端口进行远程端口转发到我们计算机上的localhost接口的8080端口。
```bash
ssh -R 8080:localhost:8080 root@localhost -p 2222
```
您现在应该能够在iOS设备上访问Burp了。在iOS上打开Safari，访问 **127.0.0.1:8080**，您应该能看到Burp Suite页面。这也是[安装Burp的CA证书](https://support.portswigger.net/customer/portal/articles/1841109-installing-burp-s-ca-certificate-in-an-ios-device)到您的iOS设备上的好时机。

最后一步是在您的iOS设备上全局设置代理：

1. 转到 **设置** -> **Wi-Fi**
2. 连接到 _任何_ Wi-Fi（您可以实际连接到任何Wi-Fi，因为端口80和443的流量将通过USB路由，因为我们只是使用Wi-Fi的代理设置，所以我们可以设置全局代理）
3. 连接后，点击连接Wi-Fi右侧的小蓝色图标
4. 选择 **手动** 来配置您的代理
5. 输入127.0.0.1作为 **服务器**
6. 输入8080作为 **端口**

### 全网络监控/嗅探

如果您需要**监控不同于HTTP通信的内容**，您可以使用**wireshark**嗅探设备的所有流量。\
您可以通过[创建一个远程虚拟接口](https://stackoverflow.com/questions/9555403/capturing-mobile-phone-traffic-on-wireshark/33175819#33175819)为您的iOS设备，在iOS上远程实时嗅探所有流量。首先确保您的macOS宿主计算机上**安装了** **Wireshark**。

1. 通过USB将您的iOS设备连接到macOS宿主计算机。
2. 在开始嗅探之前，您需要知道您iOS设备的**UDID**。在macOS上打开终端，并输入以下命令，填入您iOS设备的UDID。
```bash
$ rvictl -s <UDID>
Starting device <UDID> [SUCCEEDED] with interface rvi0
```
1. 启动 **Wireshark** 并选择 "**rvi0**" 作为捕获接口。
2. 在 Wireshark 中使用捕获过滤器过滤流量，以显示您想要监控的内容（例如，通过 IP 地址 192.168.1.1 发送/接收的所有 HTTP 流量）。
```
ip.addr == 192.168.1.1 && http
```
![](<../../.gitbook/assets/image (472).png>)

Wireshark 的文档提供了许多[捕获过滤器](https://wiki.wireshark.org/CaptureFilters)的示例，这些示例应该能帮助您过滤流量以获取您想要的信息。

## 在模拟器中安装 Burp 证书

* **导出 Burp 证书**

在 _Proxy_ --> _Options_ --> _Export CA certificate_ --> _Certificate in DER format_

![](<../../.gitbook/assets/image (459).png>)

* **拖放**证书到模拟器内部
* **在模拟器内部**，前往 _Settings_ --> _General_ --> _Profile_ --> _PortSwigger CA_，并**验证证书**
* **在模拟器内部**，前往 _Settings_ --> _General_ --> _About_ --> _Certificate Trust Settings_，并**启用 PortSwigger CA**

![](<../../.gitbook/assets/image (460).png>)

**恭喜，您已成功在 iOS 模拟器中配置了 Burp CA 证书**

{% hint style="info" %}
**iOS 模拟器将使用 MacOS 的代理配置。**
{% endhint %}

### MacOS 代理配置

配置 Burp 作为代理的步骤：

* 前往 _System Preferences_ --> _Network_ --> _Advanced_
* 在 _Proxies_ 标签页中勾选 _Web Proxy (HTTP)_ 和 _Secure Web Proxy (HTTPS)_
* 在两个选项中都配置 _127.0.0.1:8080_

![](<../../.gitbook/assets/image (461).png>)

* 点击 _**Ok**_ 然后点击 _**Apply**_

<figure><img src="../../.gitbook/assets/image (3) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
使用 [**Trickest**](https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks) 可以轻松构建并**自动化工作流程**，由世界上**最先进**的社区工具提供支持。\
立即获取访问权限：

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><strong>从零开始学习 AWS 黑客攻击直到成为专家，通过</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>！</strong></summary>

支持 HackTricks 的其他方式：

* 如果您想在 HackTricks 中看到您的**公司广告**或**下载 HackTricks 的 PDF**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取[**官方 PEASS & HackTricks 商品**](https://peass.creator-spring.com)
* 发现[**PEASS 家族**](https://opensea.io/collection/the-peass-family)，我们独家的 [**NFTs**](https://opensea.io/collection/the-peass-family) 收藏
* **加入** 💬 [**Discord 群组**](https://discord.gg/hRep4RUj7f) 或 [**telegram 群组**](https://t.me/peass) 或在 **Twitter** 🐦 上**关注**我 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **通过向 [**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github 仓库提交 PR 来分享您的黑客技巧。**

</details>
