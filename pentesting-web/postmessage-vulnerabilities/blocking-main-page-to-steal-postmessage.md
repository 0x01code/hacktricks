# Blockieren der Hauptseite, um postMessage zu stehlen

<details>

<summary><strong>Lernen Sie AWS-Hacking von Grund auf mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Arbeiten Sie in einem **Cybersicherheitsunternehmen**? M√∂chten Sie Ihr **Unternehmen in HackTricks bewerben**? Oder m√∂chten Sie Zugriff auf die **neueste Version von PEASS oder HackTricks im PDF-Format** haben? √úberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merchandise**](https://peass.creator-spring.com)
* **Treten Sie der** [**üí¨**](https://emojipedia.org/speech-balloon/) [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegramm-Gruppe**](https://t.me/peass) bei oder **folgen** Sie mir auf **Twitter** üê¶[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an das [hacktricks repo](https://github.com/carlospolop/hacktricks) und das [hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud) senden**.

</details>

## Gewinnen von RCs mit Iframes

Gem√§√ü diesem [**Terjanq-Bericht**](https://gist.github.com/terjanq/7c1a71b83db5e02253c218765f96a710) werden aus null Urspr√ºngen erstellte Blob-Dokumente aus Sicherheitsgr√ºnden isoliert, was bedeutet, dass die iframe-Seite ausgef√ºhrt wird, solange die Hauptseite besch√§ftigt ist.

Im Wesentlichen wird in dieser Herausforderung eine **isolierte iframe-Seite ausgef√ºhrt** und unmittelbar **danach**, wenn sie **geladen** ist, sendet die **√ºbergeordnete** Seite eine **postMessage** mit der **Flagge**.\
Diese postMessage-Kommunikation ist jedoch anf√§llig f√ºr XSS (die **iframe** kann JS-Code ausf√ºhren).

Das Ziel des Angreifers ist es daher, **die √ºbergeordnete Seite die iframe-Seite erstellen zu lassen**, aber **bevor** sie die sensiblen Daten (**Flagge**) sendet, sie **besch√§ftigt zu halten** und die **Payload an die iframe-Seite zu senden**. W√§hrend die **√ºbergeordnete Seite besch√§ftigt ist**, f√ºhrt die **iframe-Seite die Payload aus**, die JS-Code enth√§lt, der auf die **postMessage-Nachricht der √ºbergeordneten Seite lauscht und die Flagge preisgibt**.\
Schlie√ülich hat die iframe-Seite die Payload ausgef√ºhrt und die √ºbergeordnete Seite h√∂rt auf, besch√§ftigt zu sein, sodass sie die Flagge sendet und die Payload sie preisgibt.

Aber wie k√∂nnen Sie die √ºbergeordnete Seite **direkt nach der Erzeugung der iframe-Seite blockieren und nur w√§hrend des Wartens auf die Bereitschaft der iframe-Seite, die sensiblen Daten zu senden, besch√§ftigt halten**? Im Wesentlichen m√ºssen Sie eine **asynchrone Aktion** finden, die die √ºbergeordnete Seite **ausf√ºhrt**. In dieser Herausforderung hat die √ºbergeordnete Seite beispielsweise auf postMessages wie folgt geh√∂rt:
```javascript
window.addEventListener('message', (e) => {
if (e.data == 'blob loaded') {
$("#previewModal").modal();
}
});
```
Es war also m√∂glich, eine **gro√üe Ganzzahl in einer PostMessage zu senden**, die bei diesem Vergleich in einen String umgewandelt wird und dadurch einige Zeit in Anspruch nimmt:
```bash
const buffer = new Uint8Array(1e7);
win?.postMessage(buffer, '*', [buffer.buffer]);
```
Und um pr√§zise zu sein und diese **postmessage** genau **nach** der Erstellung des **iframes**, aber **vor** dem Zeitpunkt, an dem er bereit ist, Daten vom √ºbergeordneten Element zu empfangen, zu **senden**, m√ºssen Sie mit den Millisekunden eines `setTimeout` **spielen**.

<details>

<summary><strong>Lernen Sie AWS-Hacking von Null auf Held mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Arbeiten Sie in einem **Cybersicherheitsunternehmen**? M√∂chten Sie Ihr **Unternehmen in HackTricks bewerben**? Oder m√∂chten Sie Zugriff auf die **neueste Version von PEASS erhalten oder HackTricks als PDF herunterladen**? √úberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merch**](https://peass.creator-spring.com)
* **Treten Sie der** [**üí¨**](https://emojipedia.org/speech-balloon/) [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie mir auf **Twitter** üê¶[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an das [hacktricks repo](https://github.com/carlospolop/hacktricks) und das [hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)** einreichen.

</details>
