# Bloccare la pagina principale per rubare postmessage

<details>

<summary><strong>Impara l'hacking di AWS da zero a esperto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Lavori in una **azienda di sicurezza informatica**? Vuoi vedere la tua **azienda pubblicizzata in HackTricks**? O vuoi avere accesso all'**ultima versione di PEASS o scaricare HackTricks in PDF**? Controlla i [**PACCHETTI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Scopri [**The PEASS Family**](https://opensea.io/collection/the-peass-family), la nostra collezione di esclusive [**NFT**](https://opensea.io/collection/the-peass-family)
* Ottieni il [**merchandising ufficiale di PEASS & HackTricks**](https://peass.creator-spring.com)
* **Unisciti al** [**üí¨**](https://emojipedia.org/speech-balloon/) [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo Telegram**](https://t.me/peass) o **seguimi** su **Twitter** üê¶[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR al [repo hacktricks](https://github.com/carlospolop/hacktricks) e al [repo hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>

## Vincere RC con Iframes

Secondo questo [**articolo di Terjanq**](https://gist.github.com/terjanq/7c1a71b83db5e02253c218765f96a710) i blob dei documenti creati da origini nulle sono isolati per motivi di sicurezza, il che significa che se mantieni occupata la pagina principale, la pagina iframe verr√† eseguita.

In sostanza, in quella sfida viene eseguita un'**iframe isolata** e subito **dopo** che √® **caricata**, la **pagina principale** invia un **messaggio post** con la **flag**.\
Tuttavia, questa comunicazione postmessage √® **vulnerabile a XSS** (l'**iframe** pu√≤ eseguire codice JS).

Pertanto, l'obiettivo dell'attaccante √® **far s√¨ che il genitore crei l'iframe**, ma **prima** di farlo, far s√¨ che la **pagina genitore invii** i dati sensibili (**flag**) **mantenendola occupata** e inviando il **payload all'iframe**. Mentre il **genitore √® occupato**, l'**iframe esegue il payload** che sar√† un po' di codice JS che ascolter√† il **messaggio postmessage del genitore e ruber√† la flag**.\
Infine, l'iframe ha eseguito il payload e la pagina genitore smette di essere occupata, quindi invia la flag e il payload la ruba.

Ma come potresti far s√¨ che il genitore sia **occupato subito dopo aver generato l'iframe e solo mentre aspetta che l'iframe sia pronto per inviare i dati sensibili**? Fondamentalmente, devi trovare un'**azione asincrona** che il genitore possa **eseguire**. Ad esempio, in quella sfida il genitore stava **ascoltando** i **messaggi post** in questo modo:
```javascript
window.addEventListener('message', (e) => {
if (e.data == 'blob loaded') {
$("#previewModal").modal();
}
});
```
Quindi era possibile inviare un **grande intero in un postmessage** che verr√† **convertito in stringa** in quel confronto, il quale richieder√† del tempo:
```bash
const buffer = new Uint8Array(1e7);
win?.postMessage(buffer, '*', [buffer.buffer]);
```
E per essere precisi e **inviare** quel **postmessage** subito **dopo** che l'**iframe** viene creato ma **prima** che sia **pronto** per ricevere i dati dal genitore, sar√† necessario **giocare con i millisecondi di un `setTimeout`**.

<details>

<summary><strong>Impara l'hacking di AWS da zero a esperto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Lavori in una **azienda di sicurezza informatica**? Vuoi vedere la tua **azienda pubblicizzata in HackTricks**? o vuoi avere accesso all'**ultima versione di PEASS o scaricare HackTricks in PDF**? Controlla i [**PACCHETTI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Scopri [**The PEASS Family**](https://opensea.io/collection/the-peass-family), la nostra collezione di esclusive [**NFT**](https://opensea.io/collection/the-peass-family)
* Ottieni il [**merchandising ufficiale di PEASS & HackTricks**](https://peass.creator-spring.com)
* **Unisciti al** [**üí¨**](https://emojipedia.org/speech-balloon/) [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo Telegram**](https://t.me/peass) o **seguimi** su **Twitter** üê¶[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR al [repo hacktricks](https://github.com/carlospolop/hacktricks) e al [repo hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>
