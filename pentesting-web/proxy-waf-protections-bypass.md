# –û–±—Ö—ñ–¥ –ø—Ä–∞–≤–∏–ª ACL Nginx –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –º–∞–Ω—ñ–ø—É–ª—é–≤–∞–Ω–Ω—è —à–ª—è—Ö–æ–º <a href="#heading-pathname-manipulation-bypassing-reverse-proxies-and-load-balancers-security-rules" id="heading-pathname-manipulation-bypassing-reverse-proxies-and-load-balancers-security-rules"></a>

–¢–µ—Ö–Ω—ñ–∫–∏ [–∑ —Ü—å–æ–≥–æ –¥–æ—Å–ª—ñ–¥–∂–µ–Ω–Ω—è](https://rafa.hashnode.dev/exploiting-http-parsers-inconsistencies).

–ü—Ä–∏–∫–ª–∞–¥ –ø—Ä–∞–≤–∏–ª–∞ Nginx:
```plaintext
location = /admin {
deny all;
}

location = /admin/ {
deny all;
}
```
–©–æ–± –∑–∞–ø–æ–±—ñ–≥—Ç–∏ –æ–±—Ö—ñ–¥—É, Nginx –≤–∏–∫–æ–Ω—É—î –Ω–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—é —à–ª—è—Ö—É –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ–≤—ñ—Ä–∫–æ—é. –û–¥–Ω–∞–∫, —è–∫—â–æ —Å–µ—Ä–≤–µ—Ä backend –≤–∏–∫–æ–Ω—É—î —ñ–Ω—à—É –Ω–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—é (–≤–∏–¥–∞–ª—è—é—á–∏ —Å–∏–º–≤–æ–ª–∏, —è–∫—ñ –Ω–µ –≤–∏–¥–∞–ª—è—î nginx), —Ü–µ –º–æ–∂–µ –ø—Ä–∏–∑–≤–µ—Å—Ç–∏ –¥–æ –æ–±—Ö—ñ–¥—É —Ü—ñ—î—ó –∑–∞—Ö–∏—Å—Ç—É.

### **NodeJS - Express**

| –í–µ—Ä—Å—ñ—è Nginx | **–°–∏–º–≤–æ–ª–∏ –æ–±—Ö–æ–¥—É Node.js** |
| ------------- | ----------------------------- |
| 1.22.0        | `\xA0`                        |
| 1.21.6        | `\xA0`                        |
| 1.20.2        | `\xA0`, `\x09`, `\x0C`        |
| 1.18.0        | `\xA0`, `\x09`, `\x0C`        |
| 1.16.1        | `\xA0`, `\x09`, `\x0C`        |

### **Flask**

| –í–µ—Ä—Å—ñ—è Nginx | **–°–∏–º–≤–æ–ª–∏ –æ–±—Ö–æ–¥—É Flask**                                    |
| ------------- | -------------------------------------------------------------- |
| 1.22.0        | `\x85`, `\xA0`                                                 |
| 1.21.6        | `\x85`, `\xA0`                                                 |
| 1.20.2        | `\x85`, `\xA0`, `\x1F`, `\x1E`, `\x1D`, `\x1C`, `\x0C`, `\x0B` |
| 1.18.0        | `\x85`, `\xA0`, `\x1F`, `\x1E`, `\x1D`, `\x1C`, `\x0C`, `\x0B` |
| 1.16.1        | `\x85`, `\xA0`, `\x1F`, `\x1E`, `\x1D`, `\x1C`, `\x0C`, `\x0B` |

### **Spring Boot**

| –í–µ—Ä—Å—ñ—è Nginx | **–°–∏–º–≤–æ–ª–∏ –æ–±—Ö–æ–¥—É Spring Boot** |
| ------------- | --------------------------------- |
| 1.22.0        | `;`                               |
| 1.21.6        | `;`                               |
| 1.20.2        | `\x09`, `;`                       |
| 1.18.0        | `\x09`, `;`                       |
| 1.16.1        | `\x09`, `;`                       |

### **PHP-FPM**

–ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è Nginx FPM:
```plaintext
location = /admin.php {
deny all;
}

location ~ \.php$ {
include snippets/fastcgi-php.conf;
fastcgi_pass unix:/run/php/php8.1-fpm.sock;
}
```
Nginx –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∏–π –Ω–∞ –±–ª–æ–∫—É–≤–∞–Ω–Ω—è –¥–æ—Å—Ç—É–ø—É –¥–æ `/admin.php`, –∞–ª–µ –º–æ–∂–Ω–∞ –æ–±—ñ–π—Ç–∏ —Ü–µ, –∑–≤–µ—Ä–Ω—É–≤—à–∏—Å—å –¥–æ `/admin.php/index.php`.

### –Ø–∫ –∑–∞–ø–æ–±—ñ–≥—Ç–∏
```plaintext
location ~* ^/admin {
deny all;
}
```
## –û–±—Ö—ñ–¥ –ü—Ä–∞–≤–∏–ª Mod Security <a href="#heading-bypassing-aws-waf-acl" id="heading-bypassing-aws-waf-acl"></a>

### –ü–ª—É—Ç–∞–Ω–∏–Ω–∞ –®–ª—è—Ö—ñ–≤

[**–£ —Ü—å–æ–º—É –ø–æ—Å—Ç—ñ**](https://blog.sicuranext.com/modsecurity-path-confusion-bugs-bypass/) –ø–æ—è—Å–Ω–µ–Ω–æ, —â–æ ModSecurity v3 (–¥–æ –≤–µ—Ä—Å—ñ—ó 3.0.12), **–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–µ–∞–ª—ñ–∑—É–≤–∞–≤ –∑–º—ñ–Ω–Ω—É `REQUEST_FILENAME`**, —è–∫–∞ –ø–æ–≤–∏–Ω–Ω–∞ –±—É–ª–∞ –º—ñ—Å—Ç–∏—Ç–∏ –¥–æ—Å—Ç—É–ø–Ω–∏–π —à–ª—è—Ö (–¥–æ –ø–æ—á–∞—Ç–∫—É –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤). –¶–µ —Ç–æ–º—É, —â–æ –≤—ñ–Ω –≤–∏–∫–æ–Ω—É–≤–∞–≤ URL-–¥–µ–∫–æ–¥—É–≤–∞–Ω–Ω—è, —â–æ–± –æ—Ç—Ä–∏–º–∞—Ç–∏ —à–ª—è—Ö.\
–û—Ç–∂–µ, –∑–∞–ø–∏—Ç, –ø–æ–¥—ñ–±–Ω–∏–π –¥–æ `http://example.com/foo%3f';alert(1);foo=`, –≤ ModSecurity –ø—Ä–∏–ø—É—Å—Ç–∏—Ç—å, —â–æ —à–ª—è—Ö - —Ü–µ –ø—Ä–æ—Å—Ç–æ `/foo`, –æ—Å–∫—ñ–ª—å–∫–∏ `%3f` –ø–µ—Ä–µ—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –≤ `?`, –∑–∞–∫—ñ–Ω—á—É—é—á–∏ URL-—à–ª—è—Ö, –∞–ª–µ —Ñ–∞–∫—Ç–∏—á–Ω–æ —à–ª—è—Ö, —è–∫–∏–π –æ—Ç—Ä–∏–º–∞—î —Å–µ—Ä–≤–µ—Ä, –±—É–¥–µ `/foo%3f';alert(1);foo=`.

–ó–º—ñ–Ω–Ω—ñ `REQUEST_BASENAME` —Ç–∞ `PATH_INFO` —Ç–∞–∫–æ–∂ –±—É–ª–∏ –ø–æ—à–∫–æ–¥–∂–µ–Ω—ñ —Ü–∏–º –±–∞–≥–æ–º.

–©–æ—Å—å –ø–æ–¥—ñ–±–Ω–µ —Ç—Ä–∞–ø–∏–ª–æ—Å—è –≤ –≤–µ—Ä—Å—ñ—ó 2 Mod Security, —â–æ –¥–æ–∑–≤–æ–ª—è–ª–æ –æ–±—ñ–π—Ç–∏ –∑–∞—Ö–∏—Å—Ç, —è–∫–∏–π –∑–∞–ø–æ–±—ñ–≥–∞–≤ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º –æ—Ç—Ä–∏–º—É–≤–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ —Ñ–∞–π–ª—ñ–≤ –∑ –ø–µ–≤–Ω–∏–º–∏ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è–º–∏, –ø–æ–≤'—è–∑–∞–Ω–∏–º–∏ –∑ —Ä–µ–∑–µ—Ä–≤–Ω–∏–º–∏ –∫–æ–ø—ñ—è–º–∏ —Ñ–∞–π–ª—ñ–≤ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `.bak`), –ø—Ä–æ—Å—Ç–æ –Ω–∞–¥—Å–∏–ª–∞—é—á–∏ URL-–∫–æ–¥–æ–≤–∞–Ω–∏–π –∫—Ä–∞–ø–∫—É —É –≤–∏–≥–ª—è–¥—ñ `%2e`, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥: `https://example.com/backup%2ebak`.

## –û–±—Ö—ñ–¥ AWS WAF ACL <a href="#heading-bypassing-aws-waf-acl" id="heading-bypassing-aws-waf-acl"></a>

### –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∏–π –ó–∞–≥–æ–ª–æ–≤–æ–∫

[–£ —Ü—å–æ–º—É –¥–æ—Å–ª—ñ–¥–∂–µ–Ω–Ω—ñ](https://rafa.hashnode.dev/exploiting-http-parsers-inconsistencies) –∑–∞–∑–Ω–∞—á–µ–Ω–æ, —â–æ –±—É–ª–æ –º–æ–∂–ª–∏–≤–æ –æ–±—ñ–π—Ç–∏ –ø—Ä–∞–≤–∏–ª–∞ AWS WAF, –∑–∞—Å—Ç–æ—Å–æ–≤–∞–Ω—ñ –¥–æ HTTP-–∑–∞–≥–æ–ª–æ–≤–∫—ñ–≤, –Ω–∞–¥—Å–∏–ª–∞—é—á–∏ "–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∏–π" –∑–∞–≥–æ–ª–æ–≤–æ–∫, —è–∫–∏–π –Ω–µ –±—É–≤ –Ω–∞–ª–µ–∂–Ω–∏–º —á–∏–Ω–æ–º —Ä–æ–∑—ñ–±—Ä–∞–Ω–∏–π AWS, –∞–ª–µ –±—É–≤ —Ä–æ–∑—ñ–±—Ä–∞–Ω–∏–π —Å–µ—Ä–≤–µ—Ä–æ–º backend.

–ù–∞–ø—Ä–∏–∫–ª–∞–¥, –Ω–∞–¥—Å–∏–ª–∞—é—á–∏ –Ω–∞—Å—Ç—É–ø–Ω–∏–π –∑–∞–ø–∏—Ç –∑—ñ –≤–ø—Ä–æ–≤–∞–¥–∂–µ–Ω–Ω—è–º SQL-—ñ–Ω'—î–∫—Ü—ñ—ó —É –∑–∞–≥–æ–ª–æ–≤–∫—É X-Query:
```http
GET / HTTP/1.1\r\n
Host: target.com\r\n
X-Query: Value\r\n
\t' or '1'='1' -- \r\n
Connection: close\r\n
\r\n
```
–ë—É–ª–æ –º–æ–∂–ª–∏–≤–æ –æ–±—ñ–π—Ç–∏ AWS WAF, –æ—Å–∫—ñ–ª—å–∫–∏ –≤—ñ–Ω –Ω–µ —Ä–æ–∑—É–º—ñ–≤, —â–æ –Ω–∞—Å—Ç—É–ø–Ω–∏–π —Ä—è–¥–æ–∫ —î —á–∞—Å—Ç–∏–Ω–æ—é –∑–Ω–∞—á–µ–Ω–Ω—è –∑–∞–≥–æ–ª–æ–≤–∫–∞, —Ç–æ–¥—ñ —è–∫ —Å–µ—Ä–≤–µ—Ä NODEJS —Ü–µ —Ä–æ–∑—É–º—ñ–≤ (—Ü–µ –±—É–ª–æ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–æ).

## –ü–æ—Å–∏–ª–∞–Ω–Ω—è

* [https://rafa.hashnode.dev/exploiting-http-parsers-inconsistencies](https://rafa.hashnode.dev/exploiting-http-parsers-inconsistencies)
* [https://blog.sicuranext.com/modsecurity-path-confusion-bugs-bypass/](https://blog.sicuranext.com/modsecurity-path-confusion-bugs-bypass)

<details>

<summary><strong>–í–∏–≤—á–∞–π—Ç–µ —Ö–∞–∫—ñ–Ω–≥ AWS –≤—ñ–¥ –Ω—É–ª—è –¥–æ –≥–µ—Ä–æ—è –∑</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

–Ü–Ω—à—ñ —Å–ø–æ—Å–æ–±–∏ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ HackTricks:

* –Ø–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ —Å–≤–æ—é **–∫–æ–º–ø–∞–Ω—ñ—é —Ä–µ–∫–ª–∞–º–æ–≤–∞–Ω—É –≤ HackTricks** –∞–±–æ **–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ HackTricks —É PDF** –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ü–õ–ê–ù–ò –ü–Ü–î–ü–ò–°–ö–ò**](https://github.com/sponsors/carlospolop)!
* –û—Ç—Ä–∏–º–∞–π—Ç–µ [**–æ—Ñ—ñ—Ü—ñ–π–Ω–∏–π PEASS & HackTricks –º–µ—Ä—á**](https://peass.creator-spring.com)
* –í—ñ–¥–∫—Ä–∏–π—Ç–µ –¥–ª—è —Å–µ–±–µ [**–°—ñ–º'—é PEASS**](https://opensea.io/collection/the-peass-family), –Ω–∞—à—É –∫–æ–ª–µ–∫—Ü—ñ—é –µ–∫—Å–∫–ª—é–∑–∏–≤–Ω–∏—Ö [**NFT**](https://opensea.io/collection/the-peass-family)
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ Telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –Ω–∞–º–∏ –Ω–∞ **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **–ü–æ–¥—ñ–ª—ñ—Ç—å—Å—è —Å–≤–æ—ó–º–∏ —Ö–∞–∫–µ—Ä—Å—å–∫–∏–º–∏ —Ç—Ä—é–∫–∞–º–∏, –Ω–∞–¥—Å–∏–ª–∞–π—Ç–µ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) —Ç–∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤ GitHub.

</details>
