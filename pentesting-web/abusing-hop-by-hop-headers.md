# Intestazioni hop-by-hop

<details>

<summary><strong>Impara l'hacking di AWS da zero a esperto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Lavori in una **azienda di sicurezza informatica**? Vuoi vedere la tua **azienda pubblicizzata su HackTricks**? O vuoi avere accesso all'**ultima versione di PEASS o scaricare HackTricks in PDF**? Controlla i [**PACCHETTI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Scopri [**The PEASS Family**](https://opensea.io/collection/the-peass-family), la nostra collezione di [**NFT esclusivi**](https://opensea.io/collection/the-peass-family)
* Ottieni il [**merchandising ufficiale di PEASS & HackTricks**](https://peass.creator-spring.com)
* **Unisciti al** [**üí¨**](https://emojipedia.org/speech-balloon/) [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo Telegram**](https://t.me/peass) o **seguimi** su **Twitter** üê¶[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR al [repo hacktricks](https://github.com/carlospolop/hacktricks) e al [repo hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>

**Questo √® un riassunto del post [https://nathandavison.com/blog/abusing-http-hop-by-hop-request-headers](https://nathandavison.com/blog/abusing-http-hop-by-hop-request-headers)**

Le intestazioni hop-by-hop sono specifiche per una singola connessione di livello di trasporto, utilizzate principalmente in HTTP/1.1 per gestire i dati tra due nodi (come client-proxy o proxy-proxy) e non sono destinate ad essere inoltrate. Le intestazioni hop-by-hop standard includono `Keep-Alive`, `Transfer-Encoding`, `TE`, `Connection`, `Trailer`, `Upgrade`, `Proxy-Authorization` e `Proxy-Authenticate`, come definito in [RFC 2616](https://tools.ietf.org/html/rfc2616#section-13.5.1). Ulteriori intestazioni possono essere designate come hop-by-hop tramite l'intestazione `Connection`.

### Abuso delle intestazioni hop-by-hop
Una gestione impropria delle intestazioni hop-by-hop da parte dei proxy pu√≤ portare a problemi di sicurezza. Sebbene ci si aspetti che i proxy rimuovano queste intestazioni, non tutti lo fanno, creando potenziali vulnerabilit√†.

### Test per la gestione delle intestazioni hop-by-hop
La gestione delle intestazioni hop-by-hop pu√≤ essere testata osservando le modifiche nelle risposte del server quando specifiche intestazioni sono contrassegnate come hop-by-hop. Strumenti e script possono automatizzare questo processo, identificando come i proxy gestiscono queste intestazioni e potenzialmente scoprendo errori di configurazione o comportamenti dei proxy.

L'abuso delle intestazioni hop-by-hop pu√≤ portare a varie implicazioni di sicurezza. Di seguito sono riportati alcuni esempi che mostrano come queste intestazioni possono essere manipolate per potenziali attacchi:

### Eludere i controlli di sicurezza con `X-Forwarded-For`
Un attaccante pu√≤ manipolare l'intestazione `X-Forwarded-For` per eludere i controlli di accesso basati sull'indirizzo IP. Questa intestazione viene spesso utilizzata dai proxy per tracciare l'indirizzo IP di origine di un client. Tuttavia, se un proxy tratta questa intestazione come hop-by-hop e la inoltra senza una corretta convalida, un attaccante pu√≤ falsificare il proprio indirizzo IP.

**Scenario di attacco:**
1. L'attaccante invia una richiesta HTTP a un'applicazione web dietro un proxy, includendo un indirizzo IP falso nell'intestazione `X-Forwarded-For`.
2. L'attaccante include anche l'intestazione `Connection: close, X-Forwarded-For`, inducendo il proxy a trattare `X-Forwarded-For` come hop-by-hop.
3. Il proxy configurato in modo errato inoltra la richiesta all'applicazione web senza l'intestazione falsificata `X-Forwarded-For`.
4. L'applicazione web, non vedendo l'intestazione `X-Forwarded-For` originale, potrebbe considerare la richiesta come proveniente direttamente da un proxy attendibile, consentendo potenzialmente l'accesso non autorizzato.

### Avvelenamento della cache tramite l'iniezione di intestazioni hop-by-hop
Se un server di cache memorizza in modo errato i contenuti in base alle intestazioni hop-by-hop, un attaccante potrebbe iniettare intestazioni malevole per avvelenare la cache. Ci√≤ servirebbe contenuti errati o malevoli agli utenti che richiedono la stessa risorsa.

**Scenario di attacco:**
1. Un attaccante invia una richiesta a un'applicazione web con un'intestazione hop-by-hop che non dovrebbe essere memorizzata nella cache (ad esempio, `Connection: close, Cookie`).
2. Il server di cache configurato in modo errato non rimuove l'intestazione hop-by-hop e memorizza la risposta specifica per la sessione dell'attaccante.
3. Gli utenti futuri che richiedono la stessa risorsa ricevono la risposta memorizzata nella cache, che √® stata adattata per l'attaccante, potenzialmente portando a dirottamenti di sessione o esposizione di informazioni sensibili.

<details>

<summary><strong>Impara l'hacking di AWS da zero a esperto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Lavori in una **azienda di sicurezza informatica**? Vuoi vedere la tua **azienda pubblicizzata su HackTricks**? O vuoi avere accesso all'**ultima versione di PEASS o scaricare HackTricks in PDF**? Controlla i [**PACCHETTI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Scopri [**The PEASS Family**](https://opensea.io/collection/the-peass-family), la nostra collezione di [**NFT esclusivi**](https://opensea.io/collection/the-peass-family)
* Ottieni il [**merchandising ufficiale di PEASS & HackTricks**](https://peass.creator-spring.com)
* **Unisciti al** [**üí¨**](https://emojipedia.org/speech-balloon/) [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo Telegram**](https://t.me/peass) o **seguimi** su **Twitter** üê¶[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR al [repo hacktricks](https://github.com/carlospolop/hacktricks) e al [repo hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>
