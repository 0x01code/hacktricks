# Hop-by-Hop-Header

<details>

<summary><strong>Lernen Sie das Hacken von AWS von Null bis zum Experten mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Arbeiten Sie in einem **Cybersicherheitsunternehmen**? M√∂chten Sie Ihr **Unternehmen in HackTricks bewerben**? Oder m√∂chten Sie Zugriff auf die **neueste Version von PEASS oder HackTricks im PDF-Format** haben? √úberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* Holen Sie sich das [**offizielle PEASS & HackTricks Merchandise**](https://peass.creator-spring.com)
* **Treten Sie der** [**üí¨**](https://emojipedia.org/speech-balloon/) [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie mir auf **Twitter** üê¶[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an das [hacktricks repo](https://github.com/carlospolop/hacktricks) und [hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)** einreichen.

</details>

**Dies ist eine Zusammenfassung des Beitrags [https://nathandavison.com/blog/abusing-http-hop-by-hop-request-headers](https://nathandavison.com/blog/abusing-http-hop-by-hop-request-headers)**

Hop-by-Hop-Header sind spezifisch f√ºr eine einzelne Transportverbindung und werden haupts√§chlich in HTTP/1.1 verwendet, um Daten zwischen zwei Knoten (wie Client-Proxy oder Proxy-Proxy) zu verwalten und sind nicht zur Weiterleitung bestimmt. Standardm√§√üige Hop-by-Hop-Header umfassen `Keep-Alive`, `Transfer-Encoding`, `TE`, `Connection`, `Trailer`, `Upgrade`, `Proxy-Authorization` und `Proxy-Authenticate`, wie in [RFC 2616](https://tools.ietf.org/html/rfc2616#section-13.5.1) definiert. Zus√§tzliche Header k√∂nnen √ºber den `Connection`-Header als Hop-by-Hop gekennzeichnet werden.

### Missbrauch von Hop-by-Hop-Headern
Eine unsachgem√§√üe Verwaltung von Hop-by-Hop-Headern durch Proxies kann zu Sicherheitsproblemen f√ºhren. Obwohl erwartet wird, dass Proxies diese Header entfernen, tun dies nicht alle, was potenzielle Sicherheitsl√ºcken schafft.

### Testen der Behandlung von Hop-by-Hop-Headern
Die Behandlung von Hop-by-Hop-Headern kann getestet werden, indem √Ñnderungen in den Serverantworten beobachtet werden, wenn bestimmte Header als Hop-by-Hop markiert sind. Tools und Skripte k√∂nnen diesen Prozess automatisieren, um herauszufinden, wie Proxies diese Header verwalten und m√∂glicherweise Fehlkonfigurationen oder Proxy-Verhaltensweisen aufzudecken.

Der Missbrauch von Hop-by-Hop-Headern kann zu verschiedenen Sicherheitsimplikationen f√ºhren. Im Folgenden sind ein paar Beispiele aufgef√ºhrt, die zeigen, wie diese Header f√ºr potenzielle Angriffe manipuliert werden k√∂nnen:

### Umgehung von Sicherheitskontrollen mit `X-Forwarded-For`
Ein Angreifer kann den `X-Forwarded-For`-Header manipulieren, um IP-basierte Zugriffskontrollen zu umgehen. Dieser Header wird oft von Proxies verwendet, um die urspr√ºngliche IP-Adresse eines Clients zu verfolgen. Wenn ein Proxy diesen Header jedoch als Hop-by-Hop behandelt und ohne ordnungsgem√§√üe Validierung weiterleitet, kann ein Angreifer seine IP-Adresse f√§lschen.

**Angriffsszenario:**
1. Der Angreifer sendet eine HTTP-Anfrage an eine Webanwendung hinter einem Proxy und f√ºgt eine gef√§lschte IP-Adresse im `X-Forwarded-For`-Header ein.
2. Der Angreifer f√ºgt auch den Header `Connection: close, X-Forwarded-For` hinzu, um den Proxy dazu zu bringen, `X-Forwarded-For` als Hop-by-Hop zu behandeln.
3. Der fehlerhaft konfigurierte Proxy leitet die Anfrage an die Webanwendung weiter, ohne den gef√§lschten `X-Forwarded-For`-Header.
4. Die Webanwendung erkennt den urspr√ºnglichen `X-Forwarded-For`-Header nicht und k√∂nnte die Anfrage als direkt von einem vertrauensw√ºrdigen Proxy stammend betrachten, was potenziell unbefugten Zugriff erm√∂glicht.

### Cache-Vergiftung durch Hop-by-Hop-Header-Injektion
Wenn ein Cache-Server Inhalte basierend auf Hop-by-Hop-Headern falsch zwischenspeichert, kann ein Angreifer b√∂sartige Header einschleusen, um den Cache zu vergiften. Dadurch werden Benutzern, die dieselbe Ressource anfordern, falsche oder b√∂sartige Inhalte bereitgestellt.

**Angriffsszenario:**
1. Ein Angreifer sendet eine Anfrage an eine Webanwendung mit einem Hop-by-Hop-Header, der nicht zwischengespeichert werden sollte (z. B. `Connection: close, Cookie`).
2. Der schlecht konfigurierte Cache-Server entfernt den Hop-by-Hop-Header nicht und zwischenspeichert die Antwort spezifisch f√ºr die Sitzung des Angreifers.
3. Zuk√ºnftige Benutzer, die dieselbe Ressource anfordern, erhalten die zwischengespeicherte Antwort, die f√ºr den Angreifer angepasst wurde, was zu Sitzungsentf√ºhrung oder Offenlegung sensibler Informationen f√ºhren kann.

<details>

<summary><strong>Lernen Sie das Hacken von AWS von Null bis zum Experten mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Arbeiten Sie in einem **Cybersicherheitsunternehmen**? M√∂chten Sie Ihr **Unternehmen in HackTricks bewerben**? Oder m√∂chten Sie Zugriff auf die **neueste Version von PEASS oder HackTricks im PDF-Format** haben? √úberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* Holen Sie sich das [**offizielle PEASS & HackTricks Merchandise**](https://peass.creator-spring.com)
* **Treten Sie der** [**üí¨**](https://emojipedia.org/speech-balloon/) [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie mir auf **Twitter** üê¶[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an das [hacktricks repo](https://github.com/carlospolop/hacktricks) und [hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)** einreichen.

</details>
