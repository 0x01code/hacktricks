# Cabe√ßalhos hop-by-hop

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Voc√™ trabalha em uma **empresa de ciberseguran√ßa**? Gostaria de ver sua **empresa anunciada no HackTricks**? ou gostaria de ter acesso √† **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**? Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* **Junte-se ao** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para o [reposit√≥rio hacktricks](https://github.com/carlospolop/hacktricks) e [reposit√≥rio hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>

**Este √© um resumo do post [https://nathandavison.com/blog/abusing-http-hop-by-hop-request-headers](https://nathandavison.com/blog/abusing-http-hop-by-hop-request-headers)**

Os cabe√ßalhos hop-by-hop s√£o espec√≠ficos para uma √∫nica conex√£o de n√≠vel de transporte, usados principalmente no HTTP/1.1 para gerenciar dados entre dois n√≥s (como cliente-proxy ou proxy-proxy) e n√£o devem ser encaminhados. Os cabe√ßalhos hop-by-hop padr√£o incluem `Keep-Alive`, `Transfer-Encoding`, `TE`, `Connection`, `Trailer`, `Upgrade`, `Proxy-Authorization` e `Proxy-Authenticate`, conforme definido em [RFC 2616](https://tools.ietf.org/html/rfc2616#section-13.5.1). Cabe√ßalhos adicionais podem ser designados como hop-by-hop por meio do cabe√ßalho `Connection`.

### Abusando dos Cabe√ßalhos Hop-by-Hop
O gerenciamento inadequado dos cabe√ßalhos hop-by-hop por proxies pode levar a problemas de seguran√ßa. Embora seja esperado que os proxies removam esses cabe√ßalhos, nem todos o fazem, criando vulnerabilidades potenciais.

### Testando o Tratamento de Cabe√ßalhos Hop-by-Hop
O tratamento dos cabe√ßalhos hop-by-hop pode ser testado observando as altera√ß√µes nas respostas do servidor quando cabe√ßalhos espec√≠ficos s√£o marcados como hop-by-hop. Ferramentas e scripts podem automatizar esse processo, identificando como os proxies gerenciam esses cabe√ßalhos e potencialmente descobrindo configura√ß√µes incorretas ou comportamentos de proxy.

Abusar dos cabe√ßalhos hop-by-hop pode levar a v√°rias implica√ß√µes de seguran√ßa. Abaixo est√£o alguns exemplos demonstrando como esses cabe√ßalhos podem ser manipulados para poss√≠veis ataques:

### Bypass de Controles de Seguran√ßa com `X-Forwarded-For`
Um atacante pode manipular o cabe√ßalho `X-Forwarded-For` para contornar controles de acesso baseados em IP. Este cabe√ßalho √© frequentemente usado por proxies para rastrear o endere√ßo IP de origem de um cliente. No entanto, se um proxy tratar este cabe√ßalho como hop-by-hop e o encaminhar sem valida√ß√£o adequada, um atacante pode falsificar seu endere√ßo IP.

**Cen√°rio de Ataque:**
1. O atacante envia uma solicita√ß√£o HTTP para uma aplica√ß√£o web atr√°s de um proxy, incluindo um endere√ßo IP falso no cabe√ßalho `X-Forwarded-For`.
2. O atacante tamb√©m inclui o cabe√ßalho `Connection: close, X-Forwarded-For`, fazendo com que o proxy trate `X-Forwarded-For` como hop-by-hop.
3. O proxy mal configurado encaminha a solicita√ß√£o para a aplica√ß√£o web sem o cabe√ßalho falsificado `X-Forwarded-For`.
4. A aplica√ß√£o web, n√£o vendo o cabe√ßalho original `X-Forwarded-For`, pode considerar a solicita√ß√£o como vinda diretamente de um proxy confi√°vel, potencialmente permitindo acesso n√£o autorizado.

### Envenenamento de Cache via Inje√ß√£o de Cabe√ßalho Hop-by-Hop
Se um servidor de cache armazenar incorretamente conte√∫do com base em cabe√ßalhos hop-by-hop, um atacante poderia injetar cabe√ßalhos maliciosos para envenenar o cache. Isso serviria conte√∫do incorreto ou malicioso para usu√°rios que solicitam o mesmo recurso.

**Cen√°rio de Ataque:**
1. Um atacante envia uma solicita√ß√£o para uma aplica√ß√£o web com um cabe√ßalho hop-by-hop que n√£o deve ser armazenado em cache (por exemplo, `Connection: close, Cookie`).
2. O servidor de cache mal configurado n√£o remove o cabe√ßalho hop-by-hop e armazena a resposta espec√≠fica da sess√£o do atacante.
3. Futuros usu√°rios solicitando o mesmo recurso recebem a resposta em cache, que foi adaptada para o atacante, potencialmente levando a sequestro de sess√£o ou exposi√ß√£o de informa√ß√µes sens√≠veis. 

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Voc√™ trabalha em uma **empresa de ciberseguran√ßa**? Gostaria de ver sua **empresa anunciada no HackTricks**? ou gostaria de ter acesso √† **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**? Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* **Junte-se ao** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para o [reposit√≥rio hacktricks](https://github.com/carlospolop/hacktricks) e [reposit√≥rio hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>
