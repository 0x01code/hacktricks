<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдЕрдЧрд░ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@carlospolopm**](https://twitter.com/hacktricks_live)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, HackTricks** рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗред

</details>


# SAML Overview

**рд╕реБрд░рдХреНрд╖рд╛ рджрд╛рд╡рд╛ рдорд╛рд░реНрдХрдЕрдк рднрд╛рд╖рд╛ (SAML)** рдкрд╣рдЪрд╛рди рдкреНрд░рджрд╛рддрд╛рдУрдВ (IdP) рдХреЛ рд╕реЗрд╡рд╛ рдкреНрд░рджрд╛рддрд╛рдУрдВ (SP) рдХреЛ рдЕрдзрд┐рдХреГрддрддрд╛ рдкреНрд░рдорд╛рдг рдкрддреНрд░реЛрдВ рдХреЛ рднреЗрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рд╕реБрд╡рд┐рдзрд╛ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ, рдЬреЛ рдПрдХрд▓ рд╕рд╛рдЗрди-рдСрди (SSO) рдХреЛ рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рдмрдирд╛рддрд╛ рд╣реИред рдпрд╣ рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХрдИ рд╡реЗрдмрд╕рд╛рдЗрдЯреЛрдВ рдкрд░ рдПрдХ рд╣реА рд╕реЗрдЯ рдХреЗ рдкреНрд░рдорд╛рдг рдкрддреНрд░реЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рджреНрд╡рд╛рд░рд╛ рдХрдИ рд▓реЙрдЧрд┐рди рдХрд╛ рдкреНрд░рдмрдВрдзрди рд╕рд░рд▓ рдмрдирд╛рддрд╛ рд╣реИред рдпрд╣ IdPs рдФрд░ SPs рдХреЗ рдмреАрдЪ рдорд╛рдирдХреАрдХреГрдд рд╕рдВрдЪрд╛рд░ рдХреЗ рд▓рд┐рдП XML рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ, рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкрд╣рдЪрд╛рди рдХреА рдкреНрд░рдорд╛рдгрд┐рдХрддрд╛ рдХреЛ рд╕реЗрд╡рд╛ рдЕрдзрд┐рдХреГрддрддрд╛ рдХреЗ рд╕рд╛рде рдЬреЛрдбрд╝рддрд╛ рд╣реИред

## SAML рдФрд░ OAuth рдХреЗ рдмреАрдЪ рддреБрд▓рдирд╛

- **SAML** рдЙрджреНрдпрдореЛрдВ рдХреЛ SSO рд▓реЙрдЧрд┐рди рд╕реБрд░рдХреНрд╖рд╛ рдкрд░ рдЕрдзрд┐рдХ рдирд┐рдпрдВрддреНрд░рдг рдкреНрд░рджрд╛рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рддреИрдпрд╛рд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред
- **OAuth** рдореЛрдмрд╛рдЗрд▓ рдХреЗ рд▓рд┐рдП рдЕрдзрд┐рдХ рдЕрдиреБрдХреВрд▓рд┐рдд рд╣реЛрдиреЗ рдХреЗ рд▓рд┐рдП рдбрд┐рдЬрд╝рд╛рдЗрди рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, JSON рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ, рдФрд░ Google рдФрд░ Twitter рдЬреИрд╕реА рдХрдВрдкрдирд┐рдпреЛрдВ рдХреЗ рд╕рд╣рдпреЛрдЧ рд╕реЗ рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рд╣реИред

# SAML рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдлреНрд▓реЛ

**рдЕрдзрд┐рдХ рд╡рд┐рд╡рд░рдг рдХреЗ рд▓рд┐рдП [https://epi052.gitlab.io/notes-to-self/blog/2019-03-07-how-to-test-saml-a-methodology/](https://epi052.gitlab.io/notes-to-self/blog/2019-03-07-how-to-test-saml-a-methodology/) рд╕реЗ рдкреВрд░реА рдкреЛрд╕реНрдЯ рджреЗрдЦреЗрдВ**ред рдпрд╣ рдПрдХ рд╕рд╛рд░рд╛рдВрд╢ рд╣реИ:

SAML рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХрдИ рдЪрд░рдгреЛрдВ рдореЗрдВ рд╕рдореНрдорд┐рд▓рд┐рдд рд╣реИ, рдЬреИрд╕рд╛ рдХрд┐ рдпрд╣ рдЫрд╛рдпрд╛рдЪрд┐рддреНрд░ рдореЗрдВ рджрд┐рдЦрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ:

![https://epi052.gitlab.io/notes-to-self/img/saml/saml-flow.jpg](https://epi052.gitlab.io/notes-to-self/img/saml/saml-flow.jpg)

1. **рд╕рдВрд╕рд╛рдзрди рдкрд╣реБрдВрдЪ рдкреНрд░рдпрд╛рд╕**: рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕рдВрд░рдХреНрд╖рд┐рдд рд╕рдВрд╕рд╛рдзрди рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рддрд╛ рд╣реИред
2. **SAML рдЕрдиреБрд░реЛрдз рдЙрддреНрдкрдиреНрди рдХрд░рдирд╛**: SP рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдкрд╣рдЪрд╛рдирдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рдирд╣реАрдВ рд╣реИ рдФрд░ рдПрдХ SAML рдЕрдиреБрд░реЛрдз рдЙрддреНрдкрдиреНрди рдХрд░рддрд╛ рд╣реИред
3. **IdP рдкрд░ рдкреБрдирд░реНрдирд┐рд░реНрджреЗрд╢рд┐рдд рдХрд░реЗрдВ**: рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ IdP рдкрд░ рдкреБрдирд░реНрдирд┐рд░реНрджреЗрд╢рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ SAML рдЕрдиреБрд░реЛрдз рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╣реЛрддрд╛ рд╣реИред
4. **IdP рдЕрдиреБрд░реЛрдз рдкреНрд░рд╛рдкреНрдд рдХрд░рддрд╛ рд╣реИ**: IdP SAML рдЕрдиреБрд░реЛрдз рдкреНрд░рд╛рдкреНрдд рдХрд░рддрд╛ рд╣реИред
5. **IdP рдореЗрдВ рдкреНрд░рдорд╛рдгреАрдХрд░рдг**: IdP рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХрд╛ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХрд░рддрд╛ рд╣реИред
6. **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдорд╛рдиреНрдпрддрд╛**: IdP рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреА рд╡реИрдзрддрд╛ рдХреА рдорд╛рдиреНрдпрддрд╛ рдХрд░рддрд╛ рд╣реИ рддрд╛рдХрд┐ рдЕрдиреБрд░реЛрдзрд┐рдд рд╕рдВрд╕рд╛рдзрди рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд╣реЛред
7. **SAML рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдирд┐рд░реНрдорд╛рдг**: IdP рдЖрд╡рд╢реНрдпрдХ рджрд╛рд╡реЗ рд╕рдореЗрдд SAML рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдЙрддреНрдкрдиреНрди рдХрд░рддрд╛ рд╣реИред
8. **SP рдХреЗ ACS URL рдкрд░ рдкреБрдирд░реНрдирд┐рд░реНрджреЗрд╢рд┐рдд рдХрд░реЗрдВ**: рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ SP рдХреЗ Assertion Consumer Service (ACS) URL рдкрд░ рдкреБрдирд░реНрдирд┐рд░реНрджреЗрд╢рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред
9. **SAML рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдорд╛рдиреНрдпрддрд╛**: ACS SAML рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдХреА рдорд╛рдиреНрдпрддрд╛ рдХрд░рддрд╛ рд╣реИред
10. **рд╕рдВрд╕рд╛рдзрди рдкрд╣реБрдВрдЪ рджреА рдЧрдИ**: рдкреНрд░рд╛рд░рдВрдн рдореЗрдВ рдЕрдиреБрд░реЛрдзрд┐рдд рд╕рдВрд╕рд╛рдзрди рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреА рдЬрд╛рддреА рд╣реИред

# SAML рдЕрдиреБрд░реЛрдз рдЙрджрд╛рд╣рд░рдг

рдПрдХ рд╕реНрдерд┐рд░ рд╕рдВрд╕рд╛рдзрди рддрдХ рдкрд╣реБрдВрдЪ рдХреЗ рд▓рд┐рдП рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЕрдиреБрд░реЛрдз рдХрд░рддрд╛ рд╣реИ [https://shibdemo-sp1.test.edu/secure/](https://shibdemo-sp1.test.edu/secure/)ред SP рдкрд╣рдЪрд╛рди рдХреА рдХрдореА рдХреЛ рдкрд╣рдЪрд╛рдирддрд╛ рд╣реИ рдФрд░ рдПрдХ SAML рдЕрдиреБрд░реЛрдз рдЙрддреНрдкрдиреНрди рдХрд░рддрд╛ рд╣реИ:
```
GET /secure/ HTTP/1.1
Host: shibdemo-sp1.test.edu
...
```
рдпрд╣рд╛рдБ рд░реЙ SAML рдЕрдиреБрд░реЛрдз рдРрд╕рд╛ рджрд┐рдЦрддрд╛ рд╣реИ:
```xml
<?xml version="1.0"?>
<samlp:AuthnRequest ...
</samlp:AuthnRequest>
```
Key elements of this request include:
- **AssertionConsumerServiceURL**: рдпрд╣ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рддрд╛ рд╣реИ рдХрд┐ IdP рдХреЛ рдкреЛрд╕реНрдЯ-рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЗ рдмрд╛рдж SAML Response рдХрд╣рд╛рдВ рднреЗрдЬрдирд╛ рдЪрд╛рд╣рд┐рдПред
- **Destination**: рд░рд┐рдХреНрд╡реЗрд╕реНрдЯ рднреЗрдЬрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЙрд╕ IdP рдХрд╛ рдкрддрд╛ред
- **ProtocolBinding**: SAML рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рд╕рдВрджреЗрд╢реЛрдВ рдХреЗ рдкреНрд░реЗрд╖рдг рд╡рд┐рдзрд┐ рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рддрд╛ рд╣реИред
- **saml:Issuer**: рдЙрд╕ рд╕рдВрд╕реНрдерд╛ рдХреА рдкрд╣рдЪрд╛рди рдХрд░рддрд╛ рд╣реИ рдЬрд┐рд╕рдиреЗ рд░рд┐рдХреНрд╡реЗрд╕реНрдЯ рдкреНрд░рд╛рд░рдВрдн рдХреАред

SAML рд░рд┐рдХреНрд╡реЗрд╕реНрдЯ рдЬрдирд░реЗрд╢рди рдХреЗ рдмрд╛рдж, SP рдПрдХ **302 рд░реАрдбрд╛рдпрд░реЗрдХреНрдЯ** рдХреЗ рд╕рд╛рде рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рджреЗрддрд╛ рд╣реИ, рдЬреЛ рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдХреЛ IdP рдХреА рдУрд░ рдирд┐рд░реНрджреЗрд╢рд┐рдд рдХрд░рддрд╛ рд╣реИ рдФрд░ SAML рд░рд┐рдХреНрд╡реЗрд╕реНрдЯ рдХреЛ HTTP рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдХреЗ **Location** рд╣реЗрдбрд░ рдореЗрдВ рдПрдиреНрдХреЛрдб рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред **RelayState** рдкреИрд░рд╛рдореАрдЯрд░ рд▓реЗрди-рджреЗрди рдХреЗ рджреМрд░рд╛рди рд╕реНрдерд┐рддрд┐ рд╕реВрдЪрдирд╛ рдмрдирд╛рдП рд░рдЦрддрд╛ рд╣реИ, рдЗрд╕реЗ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ SP рдкрд╣рд▓реЗ рд╕рдВрд╕рд╛рдзрди рд░рд┐рдХреНрд╡реЗрд╕реНрдЯ рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд░рддреЗ рд╕рдордп SAML Response рдХреЛ рдкрд╣рдЪрд╛рдирддрд╛ рд╣реИред **SAMLRequest** рдкреИрд░рд╛рдореАрдЯрд░ рдПрдХ рд╕рдВрдкреАрдбрд╝рд┐рдд рдФрд░ рдПрдиреНрдХреЛрдб рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╕рдВрд╕реНрдХрд░рдг рд╣реИ рд░реЙ рдПрдХреНрд╕рдПрдордПрд▓ рд╕реНрдирд┐рдкреЗрдЯ рдХрд╛, рдбрд┐рдлреНрд▓реЗрдЯ рд╕рдВрдХреБрдЪрди рдФрд░ рдмреЗрд╕64 рдПрдиреНрдХреЛрдбрд┐рдВрдЧ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдПред


# SAML Response рдЙрджрд╛рд╣рд░рдг

рдЖрдк рдПрдХ [рдкреВрд░реНрдг SAML рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдпрд╣рд╛рдБ](https://epi052.gitlab.io/notes-to-self/blog/2019-03-07-how-to-test-saml-a-methodology/) рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВред рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдХреЗ рдореБрдЦреНрдп рдШрдЯрдХ рд╢рд╛рдорд┐рд▓ рд╣реИрдВ:

- **ds:Signature**: рдпрд╣ рдЦрдВрдб, рдПрдХ рдПрдХреНрд╕рдПрдордПрд▓ рд╕рд┐рдЧреНрдиреЗрдЪрд░, рджрд╛рд╡реЗрджрд╛рд░ рдХреА рдкреБрд╖реНрдЯрд┐ рдФрд░ рдореМрд▓рд┐рдХрддрд╛ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддрд╛ рд╣реИред рдЙрджрд╛рд╣рд░рдг рдореЗрдВ SAML рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рджреЛ `ds:Signature` рддрддреНрд╡ рд╣реИрдВ, рдПрдХ рд╕рдВрджреЗрд╢ рдХреЗ рд▓рд┐рдП рдФрд░ рджреВрд╕рд░рд╛ рджрд╛рд╡рд╛ рдХреЗ рд▓рд┐рдПред
- **saml:Assertion**: рдпрд╣ рднрд╛рдЧ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреА рдкрд╣рдЪрд╛рди рдФрд░ рд╕рдВрднрд╛рд╡рд┐рдд рдЕрдиреНрдп рдЧреБрдгреЛрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА рд░рдЦрддрд╛ рд╣реИред
- **saml:Subject**: рдпрд╣ рджрд╛рд╡реЗ рдореЗрдВ рдЙрдХреНрдд рд╕рднреА рд╡рдХреНрддрд╡реНрдпреЛрдВ рдХреЗ рдореБрдЦреНрдп рд╡рд┐рд╖рдп рдХреЛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рддрд╛ рд╣реИред
- **saml:StatusCode**: рдЙрддреНрддрд░ рдореЗрдВ рдСрдкрд░реЗрд╢рди рдХреА рд╕реНрдерд┐рддрд┐ рдХреЛ рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ рдХрд░рддрд╛ рд╣реИ рдЬрд┐рд╕рдХреЗ рд▓рд┐рдП рд░рд┐рдХреНрд╡реЗрд╕реНрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред
- **saml:Conditions**: рджрд╛рд╡реЗ рдХреА рд╡реИрдзрддрд╛ рдФрд░ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рд╕реЗрд╡рд╛ рдкреНрд░рджрд╛рддрд╛ рдЬреИрд╕реА рд╢рд░реНрддреЛрдВ рдХрд╛ рд╡рд┐рд╡рд░рдг рджреЗрддрд╛ рд╣реИред
- **saml:AuthnStatement**: рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ IdP рдиреЗ рджрд╛рд╡реЗ рдХреЗ рд╡рд┐рд╖рдп рдХрд╛ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХрд┐рдпрд╛ рд╣реИред
- **saml:AttributeStatement**: рджрд╛рд╡реЗ рдХреЗ рд╡рд┐рд╖рдп рдХрд╛ рд╡рд░реНрдгрди рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдЧреБрдгреЛрдВ рдХреЛ рд╢рд╛рдорд┐рд▓ рдХрд░рддрд╛ рд╣реИред

SAML Response рдХреЗ рдмрд╛рдж, рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рдПрдХ 302 рд░реАрдбрд╛рдпрд░реЗрдХреНрдЯ рд╢рд╛рдорд┐рд▓ рд╣реИред рдпрд╣ рд╕реЗрд╡рд╛ рдкреНрд░рджрд╛рддрд╛ рдХреЗ Assertion Consumer Service (ACS) URL рдХреЛ рдкреЛрд╕реНрдЯ рд░рд┐рдХреНрд╡реЗрд╕реНрдЯ рдореЗрдВ рд▓реЗ рдЬрд╛рддрд╛ рд╣реИред рдкреЛрд╕реНрдЯ рд░рд┐рдХреНрд╡реЗрд╕реНрдЯ рдореЗрдВ `RelayState` рдФрд░ `SAMLResponse` рдкреИрд░рд╛рдореАрдЯрд░ рд╢рд╛рдорд┐рд▓ рд╣реЛрддреЗ рд╣реИрдВред ACS рдХреЛ SAML Response рдХреЛ рдкреНрд░рд╕рдВрд╕реНрдХреГрдд рдХрд░рдиреЗ рдФрд░ рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреА рдЬрд┐рдореНрдореЗрджрд╛рд░реА рд╣реЛрддреА рд╣реИред

рдкреЛрд╕реНрдЯ рд░рд┐рдХреНрд╡реЗрд╕реНрдЯ рдкреНрд░рд╛рдкреНрдд рд╣реЛрдиреЗ рдФрд░ SAML Response рдХреА рдкреБрд╖реНрдЯрд┐ рд╣реЛрдиреЗ рдХреЗ рдмрд╛рдж, рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рджреНрд╡рд╛рд░рд╛ рдкрд╣рд▓реЗ рдЕрдиреБрд░реЛрдзрд┐рдд рд╕рдВрд░рдХреНрд╖рд┐рдд рд╕рдВрд╕рд╛рдзрди рддрдХ рдкрд╣реБрдВрдЪ рдорд┐рд▓рддреА рд╣реИред рдЗрд╕реЗ `/secure/` рдЕрдВрддреНрдпрд╕реНрдереА рдкрд░ `GET` рдЕрдиреБрд░реЛрдз рдФрд░ `200 OK` рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдХреЗ рд╕рд╛рде рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рд╕рдВрд╕рд╛рдзрди рддрдХ рд╕рдлрд▓ рдкрд╣реБрдВрдЪ рдорд┐рд▓рддреА рд╣реИред


# XML рд╕рд┐рдЧреНрдиреЗрдЪрд░

XML рд╕рд┐рдЧреНрдиреЗрдЪрд░ рдмрд╣реБрдореБрдЦреА рд╣реИрдВ, рдкреВрд░реЗ XML рдЯреНрд░реА рдпрд╛ рдЙрд╕рдХреЗ рднреАрддрд░ рд╡рд┐рд╢рд┐рд╖реНрдЯ рддрддреНрд╡реЛрдВ рдХреЛ рд╕рд╛рдЗрди рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рд░рдЦрддреЗ рд╣реИрдВред рдЗрдиреНрд╣реЗрдВ рдХрд┐рд╕реА рднреА XML рдСрдмреНрдЬреЗрдХреНрдЯ рдкрд░ рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдХреЗрд╡рд▓ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рддрддреНрд╡реЛрдВ рдкрд░ рдирд╣реАрдВред рдиреАрдЪреЗ XML рд╕рд┐рдЧреНрдиреЗрдЪрд░ рдХреЗ рдореБрдЦреНрдп рдкреНрд░рдХрд╛рд░ рджрд┐рдП рдЧрдП рд╣реИрдВ:

### XML рд╕рд┐рдЧреНрдиреЗрдЪрд░ рдХреА рдореВрд▓ рд╕рдВрд░рдЪрдирд╛
```xml
<Signature>
<SignedInfo>
<CanonicalizationMethod />
<SignatureMethod />
<Reference>
<Transforms />
<DigestMethod />
<DigestValue />
</Reference>
...
</SignedInfo>
<SignatureValue />
<KeyInfo />
<Object />
</Signature>
```
Each `Reference` element signifies a specific resource being signed, identifiable by the URI attribute.

### XML рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рдХреЗ рдкреНрд░рдХрд╛рд░

1. **Enveloped Signature**: рдЗрд╕ рдкреНрд░рдХрд╛рд░ рдХреЗ рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рдЙрд╕ рд╕рдВрд╕рд╛рдзрди рдХрд╛ рд╡рдВрд╢рдЬ рд╣реИ рдЬрд┐рд╕реЗ рдпрд╣ рд╕рд╛рдЗрди рдХрд░рддрд╛ рд╣реИ, рдЕрд░реНрдерд╛рдд рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рд╕рд╛рдЗрди рдХреА рдЧрдИ рд╕рд╛рдордЧреНрд░реА рдХреЗ рд╕рд╛рде рд╣реА XML рд╕рдВрд░рдЪрдирд╛ рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реИред

рдЙрджрд╛рд╣рд░рдг:
```xml
<samlp:Response ... ID="..." ... >
...
<ds:Signature>
<ds:SignedInfo>
...
<ds:Reference URI="#...">
...
</ds:Reference>
</ds:SignedInfo>
</ds:Signature>
...
</samlp:Response>
```

рдПрдХ enveloped рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рдореЗрдВ, `ds:Transform` рддрддреНрд╡ рдпрд╣ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдпрд╣ enveloped рд╣реИ рдЬрд┐рд╕рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ `enveloped-signature` рдПрд▓реНрдЧреЛрд░рд┐рдереНрдоред

2. **Enveloping Signature**: enveloped рд╣рд╕реНрддрд╛рдХреНрд╖рд░реЛрдВ рдХреЗ рд╡рд┐рдкрд░реАрдд, enveloping рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рд╕рд╛рдЗрди рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рд╕рдВрд╕рд╛рдзрди рдХреЛ рд▓рдкреЗрдЯрддреЗ рд╣реИрдВред

рдЙрджрд╛рд╣рд░рдг:
```xml
<ds:Signature>
<ds:SignedInfo>
...
<ds:Reference URI="#...">
...
</ds:Reference>
</ds:SignedInfo>
<samlp:Response ... ID="..." ... >
...
</samlp:Response>
</ds:Signature>
```

3. **Detached Signature**: рдпрд╣ рдкреНрд░рдХрд╛рд░ рд╕рд╛рдЗрди рдХреА рдЧрдИ рд╕рд╛рдордЧреНрд░реА рд╕реЗ рдЕрд▓рдЧ рд╣реИред рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рдФрд░ рд╕рд╛рдордЧреНрд░реА рдЕрд▓рдЧ-рдЕрд▓рдЧ рдореМрдЬреВрдж рд╣реИрдВ, рд▓реЗрдХрд┐рди рджреЛрдиреЛрдВ рдХреЗ рдмреАрдЪ рдПрдХ рд▓рд┐рдВрдХ рдмрдирд╛рдП рд░рдЦрд╛ рдЬрд╛рддрд╛ рд╣реИред

рдЙрджрд╛рд╣рд░рдг:
```xml
<samlp:Response ... ID="..." ... >
...
</samlp:Response>
<ds:Signature>
<ds:SignedInfo>
...
<ds:Reference URI="#...">
...
</ds:Reference>
</ds:SignedInfo>
</ds:Signature>
```

рд╕рдорд╛рдкреНрддрд┐ рдХреЗ рд░реВрдк рдореЗрдВ, XML рд╣рд╕реНрддрд╛рдХреНрд╖рд░ XML рджрд╕реНрддрд╛рд╡реЗрдЬреЛрдВ рдХреЛ рд╕реБрд░рдХреНрд╖рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд▓рдЪреАрд▓реЗ рддрд░реАрдХреЗ рдкреНрд░рджрд╛рди рдХрд░рддреЗ рд╣реИрдВ, рдкреНрд░рддреНрдпреЗрдХ рдкреНрд░рдХрд╛рд░ рдЕрд▓рдЧ-рдЕрд▓рдЧ рд╕рдВрд░рдЪрдирд╛рддреНрдордХ рдФрд░ рд╕реБрд░рдХреНрд╖рд╛ рдЖрд╡рд╢реНрдпрдХрддрд╛рдУрдВ рдХреА рд╕реЗрд╡рд╛ рдХрд░рддрд╛ рд╣реИред


## рд╕рдВрджрд░реНрдн
* [https://epi052.gitlab.io/notes-to-self/blog/2019-03-07-how-to-test-saml-a-methodology/](https://epi052.gitlab.io/notes-to-self/blog/2019-03-07-how-to-test-saml-a-methodology/)
