# Vuln√©rabilit√© de confusion de d√©pendance

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Expert en √©quipe rouge AWS de HackTricks)</strong></a><strong>!</strong></summary>

* Travaillez-vous dans une **entreprise de cybers√©curit√©**? Vous voulez voir votre **entreprise annonc√©e dans HackTricks**? ou voulez-vous avoir acc√®s √† la **derni√®re version du PEASS ou t√©l√©charger HackTricks en PDF**? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**üí¨**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR au [d√©p√¥t hacktricks](https://github.com/carlospolop/hacktricks) et [d√©p√¥t hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>

<figure><img src="/.gitbook/assets/WebSec_1500x400_10fps_21sn_lightoptimized_v2.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}


## Informations de base

En r√©sum√©, une vuln√©rabilit√© de confusion de d√©pendance se produit lorsqu'un projet utilise une biblioth√®que avec un nom **mal orthographi√©**, **inexistant** ou avec une **version non sp√©cifi√©e** et que le r√©f√©rentiel de d√©pendances utilis√© permet de **rassembler des versions mises √† jour √† partir de r√©f√©rentiels publics**.

* **Mal orthographi√©** : Importez **`reqests`** au lieu de `requests`
* **Inexistant** : Importez `company-logging`, une biblioth√®que interne qui **n'existe plus**
* **Version non sp√©cifi√©e** : Importez une biblioth√®que **interne existante** `company-requests`, mais le r√©f√©rentiel v√©rifie les **d√©p√¥ts publics** pour voir s'il existe des **versions sup√©rieures**.

## Exploitation

{% hint style="warning" %}
Dans tous les cas, l'attaquant a juste besoin de publier un **paquet malveillant avec le nom** des biblioth√®ques utilis√©es par l'entreprise victime.
{% endhint %}

### Mal orthographi√© & Inexistant

Si votre entreprise essaie d'**importer une biblioth√®que qui n'est pas interne**, il est tr√®s probable que le r√©f√©rentiel des biblioth√®ques la recherche dans les **d√©p√¥ts publics**. Si un attaquant l'a cr√©√©e, votre code et vos machines en cours d'ex√©cution seront tr√®s probablement compromis.

### Version non sp√©cifi√©e

Il est tr√®s courant que les d√©veloppeurs **ne sp√©cifient pas de version** de la biblioth√®que utilis√©e, ou sp√©cifient juste une **version majeure**. Ensuite, l'interpr√©teur essaiera de t√©l√©charger la **derni√®re version** r√©pondant √† ces exigences.\
Si la biblioth√®que est une **biblioth√®que externe connue** (comme `requests` en python), un **attaquant ne peut pas faire grand-chose**, car il ne pourra pas cr√©er une biblioth√®que appel√©e `requests` (√† moins qu'il ne soit l'auteur original).\
Cependant, si la biblioth√®que est **interne**, comme `requests-company` dans cet exemple, si le **r√©f√©rentiel de la biblioth√®que** permet de **v√©rifier √©galement les nouvelles versions de mani√®re externe**, il recherchera une version plus r√©cente disponible publiquement.\
Donc si un **attaquant sait** que l'entreprise utilise la biblioth√®que `requests-company` **version 1.0.1** (autorise les mises √† jour mineures), il peut **publier** la biblioth√®que `requests-company` **version 1.0.2** et l'entreprise **utilisera cette biblioth√®que √† la place** de la interne.

## Correction AWS

Cette vuln√©rabilit√© a √©t√© trouv√©e dans AWS **CodeArtifact** (lisez les [**d√©tails dans ce billet de blog**](https://zego.engineering/dependency-confusion-in-aws-codeartifact-86b9ff68963d)).\
AWS a corrig√© cela en permettant de sp√©cifier si une biblioth√®que est interne ou externe, pour √©viter de t√©l√©charger des d√©pendances internes √† partir de r√©f√©rentiels externes.

## Recherche de biblioth√®ques vuln√©rables

Dans le [**billet original sur la confusion de d√©pendance**](https://medium.com/@alex.birsan/dependency-confusion-4a5d60fec610), l'auteur a recherch√© des milliers de fichiers package.json expos√©s contenant les d√©pendances des projets JavaScript.

## R√©f√©rences

* [https://medium.com/@alex.birsan/dependency-confusion-4a5d60fec610](https://medium.com/@alex.birsan/dependency-confusion-4a5d60fec610)
* [https://zego.engineering/dependency-confusion-in-aws-codeartifact-86b9ff68963d](https://zego.engineering/dependency-confusion-in-aws-codeartifact-86b9ff68963d)

<figure><img src="/.gitbook/assets/WebSec_1500x400_10fps_21sn_lightoptimized_v2.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Expert en √©quipe rouge AWS de HackTricks)</strong></a><strong>!</strong></summary>

* Travaillez-vous dans une **entreprise de cybers√©curit√©**? Vous voulez voir votre **entreprise annonc√©e dans HackTricks**? ou voulez-vous avoir acc√®s √† la **derni√®re version du PEASS ou t√©l√©charger HackTricks en PDF**? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**üí¨**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR au [d√©p√¥t hacktricks](https://github.com/carlospolop/hacktricks) et [d√©p√¥t hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>
