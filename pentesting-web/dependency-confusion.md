# Confus√£o de Depend√™ncia

<details>

<summary><strong>Aprenda hacking AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Voc√™ trabalha em uma **empresa de ciberseguran√ßa**? Gostaria de ver sua **empresa anunciada no HackTricks**? ou gostaria de ter acesso √† **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**? Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* **Junte-se ao** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para o [reposit√≥rio hacktricks](https://github.com/carlospolop/hacktricks) e [reposit√≥rio hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>

<figure><img src="/.gitbook/assets/WebSec_1500x400_10fps_21sn_lightoptimized_v2.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}


## Informa√ß√µes B√°sicas

Em resumo, uma vulnerabilidade de confus√£o de depend√™ncia ocorre quando um projeto est√° usando uma biblioteca com um nome **com erro de digita√ß√£o**, **inexistente** ou com uma **vers√£o n√£o especificada** e o reposit√≥rio de depend√™ncias usado permite **reunir vers√µes atualizadas de reposit√≥rios p√∫blicos**.

* **Com erro de digita√ß√£o**: Importe **`reqests`** em vez de `requests`
* **Inexistente**: Importe `company-logging`, uma biblioteca interna que **n√£o existe mais**
* **Vers√£o n√£o especificada**: Importe uma biblioteca **interna existente** `company-requests`, mas o reposit√≥rio verifica **reposit√≥rios p√∫blicos** para ver se existem **vers√µes superiores**.

## Explora√ß√£o

{% hint style="warning" %}
Em todos os casos, o atacante s√≥ precisa publicar um **pacote malicioso com o nome** das bibliotecas usadas pela empresa v√≠tima.
{% endhint %}

### Com Erro de Digita√ß√£o & Inexistente

Se sua empresa est√° tentando **importar uma biblioteca que n√£o √© interna**, √© altamente prov√°vel que o reposit√≥rio de bibliotecas v√° procur√°-la em **reposit√≥rios p√∫blicos**. Se um atacante a criou, seu c√≥digo e m√°quinas em execu√ß√£o provavelmente ser√£o comprometidos.

### Vers√£o N√£o Especificada

√â muito comum os desenvolvedores **n√£o especificarem nenhuma vers√£o** da biblioteca usada, ou especificarem apenas uma **vers√£o principal**. Ent√£o, o interpretador tentar√° baixar a **√∫ltima vers√£o** que atenda a esses requisitos.\
Se a biblioteca for uma **biblioteca externa conhecida** (como `requests` em Python), um **atacante n√£o pode fazer muito**, pois n√£o poder√° criar uma biblioteca chamada `requests` (a menos que seja o autor original).\
No entanto, se a biblioteca for **interna**, como `requests-company` neste exemplo, se o **reposit√≥rio da biblioteca** permitir **verificar novas vers√µes tamb√©m externamente**, ele procurar√° por uma vers√£o mais recente dispon√≠vel publicamente.\
Portanto, se um **atacante souber** que a empresa est√° usando a biblioteca `requests-company` **vers√£o 1.0.1** (permite atualiza√ß√µes menores), ele pode **publicar** a biblioteca `requests-company` **vers√£o 1.0.2** e a empresa **usar√° essa biblioteca em vez da interna**.

## Corre√ß√£o AWS

Essa vulnerabilidade foi encontrada no AWS **CodeArtifact** (leia os [**detalhes neste post de blog**](https://zego.engineering/dependency-confusion-in-aws-codeartifact-86b9ff68963d)).\
A AWS corrigiu isso permitindo especificar se uma biblioteca √© interna ou externa, para evitar o download de depend√™ncias internas de reposit√≥rios externos.

## Encontrando Bibliotecas Vulner√°veis

No [**post original sobre confus√£o de depend√™ncia**](https://medium.com/@alex.birsan/dependency-confusion-4a5d60fec610) o autor procurou milhares de arquivos package.json expostos contendo as depend√™ncias de projetos JavaScript.

## Refer√™ncias

* [https://medium.com/@alex.birsan/dependency-confusion-4a5d60fec610](https://medium.com/@alex.birsan/dependency-confusion-4a5d60fec610)
* [https://zego.engineering/dependency-confusion-in-aws-codeartifact-86b9ff68963d](https://zego.engineering/dependency-confusion-in-aws-codeartifact-86b9ff68963d)

<figure><img src="/.gitbook/assets/WebSec_1500x400_10fps_21sn_lightoptimized_v2.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

<details>

<summary><strong>Aprenda hacking AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Voc√™ trabalha em uma **empresa de ciberseguran√ßa**? Gostaria de ver sua **empresa anunciada no HackTricks**? ou gostaria de ter acesso √† **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**? Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* **Junte-se ao** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para o [reposit√≥rio hacktricks](https://github.com/carlospolop/hacktricks) e [reposit√≥rio hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>
