# OAuth para tomar el control de una cuenta

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* ¬øTrabajas en una **empresa de ciberseguridad**? ¬øQuieres ver tu **empresa anunciada en HackTricks**? ¬øO quieres tener acceso a la **√∫ltima versi√≥n de PEASS o descargar HackTricks en PDF**? ¬°Consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n de exclusivos [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obt√©n el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* **√önete al** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠gueme** en **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Comparte tus trucos de hacking enviando PRs al** [**repositorio de hacktricks**](https://github.com/carlospolop/hacktricks) **y al** [**repositorio de hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Informaci√≥n b√°sica <a href="#d4a8" id="d4a8"></a>

Existen varias versiones de OAuth, puedes leer [https://oauth.net/2/](https://oauth.net/2/) para tener una comprensi√≥n b√°sica.

En este art√≠culo, nos centraremos en el flujo m√°s com√∫n que encontrar√°s hoy en d√≠a, que es el [tipo de concesi√≥n de c√≥digo de autorizaci√≥n OAuth 2.0](https://oauth.net/2/grant-types/authorization-code/). En esencia, OAuth proporciona a los desarrolladores un **mecanismo de autorizaci√≥n para permitir que una aplicaci√≥n acceda a datos o realice ciertas acciones en tu cuenta, desde otra aplicaci√≥n** (el servidor de autorizaci√≥n).

Por ejemplo, supongamos que el sitio web _**https://yourtweetreader.com**_ tiene una funcionalidad para **mostrar todos los tweets que has enviado**, incluyendo los tweets privados. Para hacer esto, se introduce OAuth 2.0. _https://yourtweetreader.com_ te pedir√° que **autorices su aplicaci√≥n de Twitter para acceder a todos tus tweets**. Una p√°gina de consentimiento aparecer√° en _https://twitter.com_ mostrando qu√© **permisos se est√°n solicitando** y qui√©n es el desarrollador que lo solicita. Una vez que autorices la solicitud, _https://yourtweetreader.com_ podr√° **acceder a tus tweets en tu nombre**.

Elementos importantes para entender en el contexto de OAuth 2.0:

* **propietario de recursos**: El `propietario de recursos` es el **usuario/entidad** que otorga acceso a su recurso protegido, como los tweets de su cuenta de Twitter. En este ejemplo, ser√≠as **t√∫**.
* **servidor de recursos**: El `servidor de recursos` es el **servidor que maneja las solicitudes autenticadas** despu√©s de que la aplicaci√≥n haya obtenido un `token de acceso` en nombre del `propietario de recursos`. En este ejemplo, ser√≠a **https://twitter.com**
* **aplicaci√≥n cliente**: La `aplicaci√≥n cliente` es la **aplicaci√≥n que solicita autorizaci√≥n** del `propietario de recursos`. En este ejemplo, ser√≠a **https://yourtweetreader.com**.
* **servidor de autorizaci√≥n**: El `servidor de autorizaci√≥n` es el **servidor que emite `tokens de acceso`** a la `aplicaci√≥n cliente` **despu√©s de autenticar con √©xito** al `propietario de recursos` y obtener autorizaci√≥n. En el ejemplo anterior, ser√≠a **https://twitter.com**
* **client\_id**: El `client_id` es el **identificador de la aplicaci√≥n**. Este es un identificador √∫nico p√∫blico, **no secreto**.
* **client\_secret:** El `client_secret` es un **secreto conocido solo por la aplicaci√≥n y el servidor de autorizaci√≥n**. Esto se utiliza para generar `access_tokens`
* **response\_type**: El `response_type` es un valor que detalla **qu√© tipo de token** se est√° solicitando, como `code`
* **scope**: El `scope` es el **nivel de acceso solicitado** que la `aplicaci√≥n cliente` est√° solicitando del `propietario de recursos`
* **redirect\_uri**: El `redirect_uri` es la **URL a la que se redirige al usuario despu√©s de que se complete la autorizaci√≥n**. Esto generalmente debe coincidir con la URL de redireccionamiento que has registrado previamente con el servicio.
* **state**: El par√°metro `state` puede **persistir datos entre la direcci√≥n del usuario al servidor de autorizaci√≥n y viceversa**. Es importante que este sea un valor √∫nico ya que sirve como un mecanismo de **protecci√≥n CSRF** si contiene un valor √∫nico o aleatorio por solicitud.
* **grant\_type**: El par√°metro `grant_type` explica **cu√°l es el tipo de concesi√≥n** y qu√© token se va a devolver.
* **code**: Este `code` es el c√≥digo de autorizaci√≥n recibido del `servidor de autorizaci√≥n` que estar√° en el par√°metro de cadena de consulta "code" en esta solicitud. Este c√≥digo se utiliza junto con el `client_id` y el `client_secret` por la aplicaci√≥n cliente para obtener un `access_token`.
* **access\_token**: El `access_token` es el **token que la aplicaci√≥n cliente utiliza para hacer solicitudes de API** en nombre del `propietario de recursos`.
* **refresh\_token**: El `refresh_token` permite a una aplicaci√≥n **obtener un nuevo `access_token` sin solicitar al usuario**

### Ejemplo real

Poniendo todo esto junto, esto es lo que parece un **flujo real de OAuth**:

1. Visitas [https://yourtweetreader.com](https://yourtweetreader.com) y haces clic en el bot√≥n "Integrar con Twitter".
2. [https://yourtweetreader.com](https://yourtweetreader.com) env√≠a una solicitud a [https://twitter.com](https://twitter.com) pidi√©ndote, el propietario de recursos, que autorices la aplicaci√≥n de Twitter de https://yourtweetreader.com a acceder a tus tweets. La solicitud se ver√° as√≠:
```
https://twitter.com/auth
 ?response_type=code
 &client_id=yourtweetreader_clientId
 &redirect_uri=https%3A%2F%2Fyourtweetreader.com%2Fcallback
 &scope=readTweets
 &state=kasodk9d1jd992k9klaskdh123
```
3\. Se le pedir√° que acepte una p√°gina de consentimiento:

![](https://miro.medium.com/max/1215/1\*y66EY3Fn2qn-NPI9nhZC7A.png)

4\. Una vez aceptado, Twitter enviar√° una solicitud de vuelta a la `redirect_uri` con los par√°metros `code` y `state`:
```
https://yourtweetreader.com?code=asd91j3jd91j92j1j9d1&state=kasodk9d1jd992k9klaskdh123
```
5\. Luego, [https://yourtweetreader.com](https://yourtweetreader.com) tomar√° ese `code`, y utilizando el `client_id` y `client_secret` de su aplicaci√≥n, realizar√° una solicitud desde el servidor para recuperar un `access_token` en su nombre, lo que les permitir√° acceder a los permisos a los que usted consinti√≥:
```
POST /oauth/access_token
Host: twitter.com
...{"client_id": "yourtweetreader_clientId", "client_secret": "yourtweetreader_clientSecret", "code": "asd91j3jd91j92j1j9d1", "grant_type": "authorization_code"}
```
6\. Finalmente, el flujo est√° completo y [https://yourtweetreader.com](https://yourtweetreader.com) har√° una llamada API a Twitter con tu `access_token` para acceder a tus Tweets.

## Hallazgos de Bug Bounty <a href="#323a" id="323a"></a>

¬°Ahora viene la parte interesante! Hay muchas cosas que pueden salir mal en una implementaci√≥n de OAuth, aqu√≠ est√°n las diferentes categor√≠as de bugs que veo con frecuencia:

### Configuraci√≥n d√©bil de `redirect_uri` <a href="#cc36" id="cc36"></a>

El `redirect_uri` es muy importante porque **datos sensibles, como el `code`, se agregan a esta URL** despu√©s de la autorizaci√≥n. Si el `redirect_uri` puede ser redirigido a un servidor **controlado por un atacante**, esto significa que el atacante potencialmente puede **tomar el control de la cuenta de una v√≠ctima** usando el `code` ellos mismos y obteniendo acceso a los datos de la v√≠ctima.

La forma en que esto se va a explotar va a variar seg√∫n el servidor de autorizaci√≥n. **Algunos** solo aceptar√°n la misma ruta exacta de `redirect_uri` especificada en la aplicaci√≥n cliente, pero algunos aceptar√°n cualquier cosa en el mismo dominio o subdirectorio de `redirect_uri`.

Dependiendo de la l√≥gica manejada por el servidor, hay una serie de t√©cnicas para evitar un `redirect_uri`. En una situaci√≥n en la que un `redirect_uri` es [https://yourtweetreader.com](https://yourtweetreader.com)/callback, estas incluyen:

* Redirecciones abiertas: [`https://yourtweetreader.com`](https://yourtweetreader.com)`/callback?redirectUrl=https://evil.com`
* Traversal de ruta: `https://yourtweetreader.com/callback/../redirect?url=https://evil.com`
* Regexes d√©biles de `redirect_uri`: `https://yourtweetreader.com.evil.com`
* Inyecci√≥n de HTML y robo de tokens a trav√©s del encabezado referer: `https://yourtweetreader.com/callback/home/attackerimg.jpg`

**Otros par√°metros** que pueden ser vulnerables a Redirecciones Abiertas son:

* **client_uri** - URL de la p√°gina de inicio de la aplicaci√≥n cliente
* **policy_uri** - URL que el cliente de la parte que conf√≠a en la aplicaci√≥n proporciona para que el usuario final pueda leer sobre c√≥mo se utilizar√°n sus datos de perfil.
* **tos_uri** - URL que el cliente de la parte que conf√≠a en la aplicaci√≥n proporciona para que el usuario final pueda leer sobre los t√©rminos de servicio de la parte que conf√≠a en la aplicaci√≥n.
* **initiate_login_uri** - URI que utiliza el esquema https que un tercero puede utilizar para iniciar una sesi√≥n de inicio de sesi√≥n por el RP. Tambi√©n debe usarse para la redirecci√≥n del lado del cliente.

Todos estos par√°metros son **opcionales seg√∫n las especificaciones de OAuth y OpenID** y no siempre son compatibles en un servidor en particular, por lo que siempre vale la pena identificar qu√© par√°metros son compatibles en tu servidor.

Si apuntas a un servidor OpenID, el punto de descubrimiento en \*\*`.well-known/openid-configuration`\*\* a veces contiene par√°metros como "_registration\_endpoint_", "_request\_uri\_parameter\_supported_" y "_require\_request\_uri\_registration_". Estos pueden ayudarte a encontrar el punto final de registro y otros valores de configuraci√≥n del servidor.

### XSS en la implementaci√≥n de redirecci√≥n <a href="#bda5" id="bda5"></a>

Como se menciona en este informe de bug bounty [https://blog.dixitaditya.com/2021/11/19/account-takeover-chain.html](https://blog.dixitaditya.com/2021/11/19/account-takeover-chain.html), es posible que la **URL de redirecci√≥n se refleje en la respuesta** del servidor despu√©s de que el usuario se autentique, siendo **vulnerable a XSS**. Carga √∫til posible para probar:
```
https://app.victim.com/login?redirectUrl=https://app.victim.com/dashboard</script><h1>test</h1>
```
### CSRF - Manejo inadecuado del par√°metro state <a href="#bda5" id="bda5"></a>

Muy a menudo, el par√°metro **`state` se omite completamente o se utiliza de manera incorrecta**. Si un par√°metro de estado es **inexistente** o un valor est√°tico que nunca cambia, es muy probable que el flujo de OAuth sea **vulnerable a CSRF**. A veces, incluso si hay un par√°metro `state`, la **aplicaci√≥n puede no validar el par√°metro** y un ataque funcionar√°. La forma de explotar esto ser√≠a pasar por el proceso de autorizaci√≥n en su propia cuenta y detenerse justo despu√©s de autorizar. Luego encontrar√° una solicitud como:
```
https://yourtweetreader.com?code=asd91j3jd91j92j1j9d1
```
Despu√©s de recibir esta solicitud, puedes **descartarla porque estos c√≥digos suelen ser de un solo uso**. Luego, puedes enviar esta URL a un **usuario conectado y se agregar√° tu cuenta a la de ellos**. Al principio, esto puede no parecer muy sensible ya que simplemente est√°s agregando tu cuenta a la cuenta de la v√≠ctima. Sin embargo, muchas implementaciones de OAuth son para fines de inicio de sesi√≥n, por lo que si puedes agregar tu cuenta de Google que se utiliza para iniciar sesi√≥n, podr√≠as potencialmente realizar una **Toma de control de cuenta** con un solo clic, ya que iniciar sesi√≥n con tu cuenta de Google te dar√≠a acceso a la cuenta de la v√≠ctima.

Puedes encontrar un **ejemplo** sobre esto en este [**writeup de CTF**](https://github.com/gr455/ctf-writeups/blob/master/hacktivity20/notes\_surfer.md) y en la **caja HTB llamada Oouch**.

Tambi√©n he visto que el par√°metro de estado se usa como un valor de redireccionamiento adicional varias veces. La aplicaci√≥n usar√° `redirect_uri` para la redirecci√≥n inicial, pero luego el par√°metro `state` como una segunda redirecci√≥n que podr√≠a contener el `code` dentro de los par√°metros de consulta o el encabezado de referencia.

Una cosa importante a tener en cuenta es que esto no solo se aplica a situaciones de inicio de sesi√≥n y toma de control de cuenta. He visto configuraciones incorrectas en:

* Integraciones de Slack que permiten a un atacante agregar su cuenta de Slack como destinatario de todas las notificaciones/mensajes
* Integraciones de Stripe que permiten a un atacante sobrescribir la informaci√≥n de pago y aceptar pagos de los clientes de la v√≠ctima
* Integraciones de PayPal que permiten a un atacante agregar su cuenta de PayPal a la cuenta de la v√≠ctima, lo que depositar√≠a dinero en la cuenta de PayPal del atacante

### Pre Toma de control de cuenta <a href="#ebe4" id="ebe4"></a>

Uno de los problemas m√°s comunes que veo es cuando las aplicaciones permiten "Iniciar sesi√≥n con X" pero tambi√©n con nombre de usuario/contrase√±a. Hay 2 formas diferentes de atacar esto:

1. Si la aplicaci√≥n **no requiere verificaci√≥n de correo electr√≥nico en la creaci√≥n de la cuenta**, intenta **crear una cuenta con la direcci√≥n de correo electr√≥nico de la v√≠ctima y una contrase√±a de atacante** antes de que la v√≠ctima se haya registrado. Si la **v√≠ctima** luego intenta registrarse o iniciar sesi√≥n **con un tercero**, como Google, es posible que la aplicaci√≥n haga una b√∫squeda, vea que el correo electr√≥nico ya est√° registrado, luego **vincule su cuenta de Google a la cuenta creada por el atacante**. Esto es una "**pre toma de control de cuenta**" donde un atacante tendr√° acceso a la cuenta de la v√≠ctima si la cre√≥ antes de que la v√≠ctima se registrara.
2. Si una **aplicaci√≥n OAuth no requiere verificaci√≥n de correo electr√≥nico**, intenta registrarte con esa aplicaci√≥n OAuth con la **direcci√≥n de correo electr√≥nico de la v√≠ctima**. El mismo problema que se mencion√≥ anteriormente podr√≠a existir, pero estar√≠as atac√°ndolo desde la otra direcci√≥n y obteniendo acceso a la cuenta de la v√≠ctima para una toma de control de cuenta.

### Divulgaci√≥n de secretos <a href="#e177" id="e177"></a>

Es muy importante reconocer **cu√°les de los muchos par√°metros de OAuth son secretos** y protegerlos. Por ejemplo, filtrar el `client_id` es perfectamente aceptable y necesario, pero filtrar el **`client_secret` es peligroso**. Si esto se filtra, el **atacante** puede potencialmente **abusar de la confianza e identidad de la aplicaci√≥n cliente de confianza para robar los `access_tokens` de los usuarios y la informaci√≥n/acceso privado para sus cuentas integradas**. Volviendo a nuestro ejemplo anterior, un problema que he visto es realizar este paso desde el cliente, en lugar del servidor:

_5._ [_https://yourtweetreader.com_](https://yourtweetreader.com) _luego tomar√° ese `code` y, utilizando el `client_id` y el `client_secret` de su aplicaci√≥n, har√° una solicitud desde el servidor para recuperar un `access_token` en tu nombre, lo que les permitir√° acceder a los permisos a los que has consentido._

**Si esto se hace desde el cliente, el `client_secret` se filtrar√° y los usuarios podr√°n generar `access_tokens` en nombre de la aplicaci√≥n**. Con algo de ingenier√≠a social, tambi√©n pueden **agregar m√°s alcances a la autorizaci√≥n de OAuth** y todo parecer√° leg√≠timo ya que la solicitud vendr√° de la aplicaci√≥n cliente de confianza.

### Fuerza bruta de secretos del cliente

Puedes intentar **atacar por fuerza bruta el client\_secret** de un proveedor de servicios con el proveedor de identidad para intentar robar cuentas.\
La solicitud para BF puede parecer similar a:
```
POST /token HTTP/1.1
content-type: application/x-www-form-urlencoded
host: 10.10.10.10:3000
content-length: 135
Connection: close

code=77515&redirect_uri=http%3A%2F%2F10.10.10.10%3A3000%2Fcallback&grant_type=authorization_code&client_id=public_client_id&client_secret=[bruteforce]
```
### Fuga de informaci√≥n del encabezado Referer + Estado

Una vez que el cliente tiene el **c√≥digo y el estado**, si se **refleja dentro del encabezado Referer** cuando navega a una p√°gina diferente, entonces es vulnerable.

### Token de acceso almacenado en el historial del navegador

Vaya al **historial del navegador y verifique si el token de acceso est√° guardado all√≠**.

### C√≥digo de autorizaci√≥n eterno

El **c√≥digo de autorizaci√≥n debe vivir solo por un tiempo para limitar la ventana de tiempo en la que un atacante puede robarlo y usarlo**.

### Token de autorizaci√≥n/actualizaci√≥n no vinculado al cliente

Si puede obtener el **c√≥digo de autorizaci√≥n y usarlo con un cliente diferente, entonces puede tomar el control de otras cuentas**.

### Rutas felices, XSS, Iframes y mensajes de publicaci√≥n para filtrar valores de c√≥digo y estado

### AWS Cognito <a href="#bda5" id="bda5"></a>

En este informe de recompensa por errores: [**https://security.lauritz-holtmann.de/advisories/flickr-account-takeover/**](https://security.lauritz-holtmann.de/advisories/flickr-account-takeover/) puede ver que el **token** que **AWS Cognito** devuelve al usuario puede tener **suficientes permisos para sobrescribir los datos del usuario**. Por lo tanto, si puede **cambiar el correo electr√≥nico del usuario por un correo electr√≥nico de usuario diferente**, podr√≠a **tomar el control** de otras cuentas.
```bash
# Read info of the user
aws cognito-idp get-user --region us-east-1 --access-token eyJraWQiOiJPVj[...]

# Change email address
aws cognito-idp update-user-attributes --region us-east-1 --access-token eyJraWQ[...] --user-attributes Name=email,Value=imaginary@flickr.com
{
    "CodeDeliveryDetailsList": [
        {
            "Destination": "i***@f***.com",
            "DeliveryMedium": "EMAIL",
            "AttributeName": "email"
        }
    ]
}
```
Para obtener informaci√≥n detallada sobre c√≥mo abusar de AWS Cognito, consulte:

{% embed url="https://cloud.hacktricks.xyz/pentesting-cloud/aws-pentesting/aws-unauthenticated-enum-access/aws-cognito-unauthenticated-enum" %}

### Par√°metros de SSRF <a href="#bda5" id="bda5"></a>

Uno de los URLs ocultos que puede pasar por alto es el **punto final de registro de cliente din√°mico**. Para autenticar con √©xito a los usuarios, los servidores OAuth necesitan conocer detalles sobre la aplicaci√≥n cliente, como el "client\_name", "client\_secret", "redirect\_uris", y as√≠ sucesivamente. Estos detalles pueden ser proporcionados a trav√©s de la configuraci√≥n local, pero los servidores de autorizaci√≥n OAuth tambi√©n pueden tener un **punto final de registro especial**. Este punto final normalmente se asigna a "/register" y acepta solicitudes POST con el siguiente formato:
```json
POST /connect/register HTTP/1.1
Content-Type: application/json
Host: server.example.com
Authorization: Bearer eyJhbGciOiJSUzI1NiJ9.eyJ ...

{
 "application_type": "web",
 "redirect_uris": ["https://client.example.org/callback"],
 "client_name": "My Example",
 "logo_uri": "https://client.example.org/logo.png",
 "subject_type": "pairwise",
 "sector_identifier_uri": "https://example.org/rdrct_uris.json",
 "token_endpoint_auth_method": "client_secret_basic",
 "jwks_uri": "https://client.example.org/public_keys.jwks",
 "contacts": ["ve7jtb@example.org"],
 "request_uris": ["https://client.example.org/rf.txt"]
}
```
Hay dos especificaciones que definen los par√°metros en esta solicitud: [RFC7591](https://tools.ietf.org/html/rfc7591) para OAuth y [Openid Connect Registration 1.0](https://openid.net/specs/openid-connect-registration-1\_0.html#rfc.section.3.1).

Como se puede ver aqu√≠, varios de estos valores se pasan a trav√©s de referencias URL y parecen ser posibles objetivos para [Server Side Request Forgery](https://portswigger.net/web-security/ssrf). Al mismo tiempo, la mayor√≠a de los servidores que hemos probado no resuelven estas URL inmediatamente cuando reciben una solicitud de registro. En su lugar, simplemente **guardan estos par√°metros y los usan m√°s tarde durante el flujo de autorizaci√≥n de OAuth**. En otras palabras, esto es m√°s como un SSRF de segundo orden, lo que hace que la detecci√≥n de caja negra sea m√°s dif√≠cil.

Los siguientes par√°metros son particularmente interesantes para los ataques SSRF:

* **logo\_uri** - URL que hace referencia a un **logotipo para la aplicaci√≥n del cliente**. **Despu√©s de registrar un cliente**, puedes intentar llamar al punto final de autorizaci√≥n de OAuth ("/authorize") usando tu nuevo "client\_id". Despu√©s del inicio de sesi√≥n, el servidor te pedir√° que apruebes la solicitud y **puede mostrar la imagen de "logo\_uri"**. Si el **servidor recupera la imagen por s√≠ mismo**, el SSRF deber√≠a ser desencadenado por este paso. Alternativamente, el servidor puede incluir el logotipo a trav√©s de una **etiqueta "\<img>" del lado del cliente**. Aunque esto no lleva a SSRF, puede llevar a **XSS si la URL no est√° escapada**.
*   **jwks\_uri** - URL para el conjunto de claves JSON del cliente \[JWK\]. Este conjunto de claves es necesario en el servidor para validar las solicitudes firmadas realizadas en el punto final del token cuando se usan JWT para la autenticaci√≥n del cliente \[RFC7523\]. Para probar la SSRF en este par√°metro, **registra una nueva aplicaci√≥n de cliente con un "jwks\_uri" malicioso**, realiza el proceso de autorizaci√≥n para **obtener un c√≥digo de autorizaci√≥n para cualquier usuario y luego recupera el punto final "/token"** con el siguiente cuerpo:

    `POST /oauth/token HTTP/1.1`\
    `...`\
    \`\`\
    `grant_type=authorization_code&code=n0esc3NRze7LTCu7iYzS6a5acc3f0ogp4&client_assertion_type=urn:ietf:params:oauth:client-assertion-type:jwt-bearer&client_assertion=eyJhbGci...`

    Si es vulnerable, el **servidor deber√≠a realizar una solicitud HTTP de servidor a servidor a la "jwks\_uri" suministrada** porque necesita esta clave para comprobar la validez del par√°metro "client\_assertion" en tu solicitud. Esto probablemente solo ser√° una vulnerabilidad de SSRF ciega, ya que el servidor espera una respuesta JSON adecuada.
* **sector\_identifier\_uri** - Esta URL hace referencia a un archivo con una sola **matriz JSON de valores de redirect\_uri**. Si es compatible, el servidor puede **recuperar este valor tan pronto como env√≠es la solicitud de registro din√°mico**. Si esto no se recupera inmediatamente, intenta realizar la autorizaci√≥n para este cliente en el servidor. Como necesita conocer los redirect\_uris para completar el flujo de autorizaci√≥n, esto obligar√° al servidor a hacer una solicitud a tu malintencionado sector\_identifier\_uri.
*   **request\_uris** - Una matriz de los **request\_uris permitidos para este cliente**. El par√°metro "request\_uri" puede ser compatible con el punto final de autorizaci√≥n para proporcionar una URL que contenga un JWT con la informaci√≥n de la solicitud (ver [https://openid.net/specs/openid-connect-core-1\_0.html#rfc.section.6.2](https://openid.net/specs/openid-connect-core-1\_0.html#rfc.section.6.2)).

    Incluso si el registro din√°mico del cliente no est√° habilitado, o requiere autenticaci√≥n, podemos intentar realizar SSRF en el punto final de autorizaci√≥n simplemente usando "request\_uri":\\

    `GET /authorize?response_type=code%20id_token&client_id=sclient1&request_uri=https://ybd1rc7ylpbqzygoahtjh6v0frlh96.burpcollaborator.net/request.jwt`

    Nota: no confundir este par√°metro con "redirect\_uri". El "redirect\_uri" se utiliza para la redirecci√≥n despu√©s de la autorizaci√≥n, mientras que **"request\_uri" se recupera por el servidor al inicio del proceso de autorizaci√≥n**.

    Al mismo tiempo, muchos servidores que hemos visto no permiten valores arbitrarios de "request\_uri": solo permiten URL en lista blanca que se registraron previamente durante el proceso de registro del cliente. Es por eso que necesitamos suministrar "request\_uris": "https://ybd1rc7ylpbqzygoahtjh6v0frlh96.burpcollaborator.net/request.jwt" de antemano.

## Condiciones de carrera de los proveedores de OAuth

Si la plataforma que est√°s probando es un proveedor de OAuth, [**lee esto para probar posibles condiciones de carrera**](race-condition.md).

## Referencias

* [**https://medium.com/a-bugz-life/the-wondeful-world-of-oauth-bug-bounty-edition-af3073b354c1**](https://medium.com/a-bugz-life/the-wondeful-world-of-oauth-bug-bounty-edition-af3073b354c1)
* [**https://portswigger.net/research/hidden-oauth-attack-vectors**](https://portswigger.net/research/hidden-oauth-attack-vectors)

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* ¬øTrabajas en una **empresa de ciberseguridad**? ¬øQuieres ver tu **empresa anunciada en HackTricks**? ¬øo quieres tener acceso a la **√∫ltima versi√≥n de PEASS o descargar HackTricks en PDF**? ¬°Consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos.
* Consigue el [**swag oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* **√önete al** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠gueme** en **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Comparte tus trucos de hacking enviando PR al** [**repositorio de hacktricks**](https://github.com/carlospolop/hacktricks) **y al** [**repositorio de hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
