# Çerez Atma

<details>

<summary><strong>AWS hackleme konusunda sıfırdan kahramana kadar öğrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Kırmızı Takım Uzmanı)</strong></a><strong>!</strong></summary>

HackTricks'ı desteklemenin diğer yolları:

* **Şirketinizi HackTricks'te reklam görmek istiyorsanız** veya **HackTricks'i PDF olarak indirmek istiyorsanız** [**ABONELİK PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks ürünlerini alın**](https://peass.creator-spring.com)
* [**PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keşfedin, özel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* **Katılın** 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) veya bizi **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks\_live)** takip edin**.
* **Hacking püf noktalarınızı göndererek HackTricks ve HackTricks Cloud github depolarına PR göndererek paylaşın.**

</details>

### Açıklama

Bir saldırgan, **bir şirketin alt alan adını veya alan adını kontrol edebilirse veya bir alt alanda XSS bulursa**, bu saldırıyı gerçekleştirebilir.

Çerezler Hakkında bölümünde belirtildiği gibi, bir **çerez bir alan adına ayarlandığında (belirtilerek) bu alan adında ve alt alanlarda kullanılacaktır.**

{% hint style="danger" %}
Bu nedenle, **bir saldırgan alan adına ve alt alanlara belirli bir çerez ayarlayabilecek** ve şöyle bir şey yapabilecektir: `document.cookie="session=1234; Path=/app/login; domain=.example.com"`
{% endhint %}

Bu tehlikeli olabilir çünkü saldırgan şunları yapabilir:

* **Kurbanın çerezini saldırganın hesabına sabitleyebilir**, böylece kullanıcı fark etmezse, **saldırganın hesabında işlemleri gerçekleştirecek** ve saldırgan bazı ilginç bilgiler elde edebilir (kullanıcının platformdaki arama geçmişini kontrol edin, kurban kredi kartını hesaba ekleyebilir...)
* Eğer **çerez girişten sonra değişmezse**, saldırgan sadece **bir çerezi sabitleyebilir (oturum sabitleme)**, kurbanın giriş yapmasını bekler ve ardından **o çerezi kullanarak kurban olarak giriş yapabilir**.
* Bazen, oturum çerezleri değişse bile, saldırgan önceki çerezi kullanabilir ve yeni olanı da alabilir.
* Eğer **çerez başlangıç değeri ayarlıyorsa** (örneğin, flask'ta **çerez** oturumun **CSRF belirteci**ni **ayarlayabilir** ve bu değer, kurban giriş yaptıktan sonra korunabilir), **saldırgan bu bilinen değeri ayarlayabilir ve ardından kötüye kullanabilir** (bu senaryoda, saldırgan daha sonra kullanıcıyı CSRF isteği yapmaya zorlayabilir çünkü CSRF belirtecini biliyor).
* Değeri ayarlamak gibi, saldırgan ayrıca sunucu tarafından oluşturulan kimlik doğrulama yapılmamış bir çerez alabilir, CSRF belirtecini alabilir ve bunu kullanabilir.

### Çerez Sırası

Bir tarayıcı, aynı adı taşıyan iki çerez aldığında **aynı kapsamı kısmen etkileyen** (alan adı, alt alanlar ve yol) **tarayıcı her iki çerezin değerini de gönderecektir**.

Tarayıcı, **en spesifik yolun kimde olduğuna veya hangisinin daha eski olduğuna bağlı olarak**, **önce çerezin değerini ayarlayacak ve ardından diğerinin değerini ayarlayacaktır** gibi: `Cookie: iduser=DahaSpesifikVeEskiÇerez; iduser=DahaAzSpesifik;`

Çoğu **web sitesi yalnızca ilk değeri kullanacaktır**. Dolayısıyla, bir saldırganın bir çerez ayarlamak istemesi durumunda, bunu başka birinin ayarlanmasından önce ayarlamak veya daha spesifik bir yol ile ayarlamak daha iyidir.

{% hint style="warning" %}
Dahası, **daha spesifik bir yol ile çerez ayarlayabilme yeteneği** çok ilginçtir çünkü **kurbanın çerezini belirli bir yolda kötü niyetli çerez ayarlanan yoldan önce göndermesini sağlayabilirsiniz**.
{% endhint %}

### Koruma Atlatma

Bu saldırıya karşı olası koruma, **web sunucusunun aynı ada sahip ancak farklı değerlere sahip iki çerezle gelen istekleri kabul etmemesi** olabilir.

Saldırganın, kurban zaten çerezi aldıktan sonra çerez ayarladığı senaryoyu atlatmak için, saldırgan bir **çerez taşmasına** neden olabilir ve ardından, **meşru çerez silindiğinde kötü niyetli olanı ayarlayabilir**.

{% content-ref url="cookie-jar-overflow.md" %}
[cookie-jar-overflow.md](cookie-jar-overflow.md)
{% endcontent-ref %}

Başka bir yararlı **atlatma** yöntemi, **çerezin adını URL kodlaması yapmaktır** çünkü bazı korumalar istekte aynı ada sahip 2 çerez kontrol eder ve sunucu çerezlerin adlarını çözer.

### Çerez Bombası

Bir Çerez Atma saldırısı aynı zamanda bir **Çerez Bombası** saldırısı gerçekleştirmek için de kullanılabilir:

{% content-ref url="cookie-bomb.md" %}
[cookie-bomb.md](cookie-bomb.md)
{% endcontent-ref %}

### Savunmalar

#### Çerez adında `__Host` öneki kullanın

* Bir çerez adında bu önek varsa, bu çerez adı yalnızca Güvenli olarak işaretlenmişse, güvenli bir kökenden gönderilmişse, bir Alan özelliği içermiyorsa ve Yol özelliği / olarak ayarlanmışsa, **Set-Cookie yönergesinde kabul edilecektir**
* **Bu, alt alanların bir çerezi kök alanına zorlamasını önler çünkü bu çerezler "alan kilidinde" olarak görülebilir**

### Referanslar

* [**@blueminimal**](https://twitter.com/blueminimal)
* [**https://speakerdeck.com/filedescriptor/the-cookie-monster-in-your-browsers**](https://speakerdeck.com/filedescriptor/the-cookie-monster-in-your-browsers)
* [**https://github.blog/2013-04-09-yummy-cookies-across-domains/**](https://github.blog/2013-04-09-yummy-cookies-across-domains/)
* [**Çerez Parçaları: Web Oturum Bütünlüğü Güvenlik Açıklarını Ortaya Çıkarma**](https://www.youtube.com/watch?v=F\_wAzF4a7Xg)

<details>

<summary><strong>AWS hackleme konusunda sıfırdan kahramana kadar öğrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Kırmızı Takım Uzmanı)</strong></a><strong>!</strong></summary>

HackTricks'ı desteklemenin diğer yolları:

* **Şirketinizi HackTricks'te reklam görmek istiyorsanız** veya **HackTricks'i PDF olarak indirmek istiyorsanız** [**ABONELİK PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks ürünlerini alın**](https://peass.creator-spring.com)
* [**PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keşfedin, özel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* **Katılın** 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) veya bizi **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks\_live)** takip edin**.
* **Hacking püf noktalarınızı göndererek HackTricks ve HackTricks Cloud github depolarına PR göndererek paylaşın.**

</details>
