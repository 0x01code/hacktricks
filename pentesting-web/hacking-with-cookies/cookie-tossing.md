<details>

<summary><strong>Lernen Sie AWS-Hacking von Null auf Held mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks bewerben m√∂chten** oder **HackTricks als PDF herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merchandise**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositories senden.

</details>


## Beschreibung

Wenn ein Angreifer eine **Subdomain oder die Domain eines Unternehmens kontrollieren kann oder eine XSS in einer Subdomain findet**, kann er diesen Angriff durchf√ºhren.

Wie im Abschnitt zum Hacking von Cookies angegeben, wird ein **Cookie, das f√ºr eine Domain festgelegt ist (mit Angabe der Domain), in der Domain und den Subdomains verwendet**.

{% hint style="danger" %}
Daher **kann ein Angreifer ein spezifisches Cookie f√ºr die Domain und Subdomains setzen, indem er etwas wie** `document.cookie="session=1234; Path=/app/login; domain=.example.com"` macht.
{% endhint %}

Dies kann gef√§hrlich sein, da der Angreifer m√∂glicherweise in der Lage ist:

* Das Cookie des Opfers auf das Konto des Angreifers **festzulegen**, sodass der Benutzer es m√∂glicherweise nicht bemerkt und **die Aktionen im Konto des Angreifers ausf√ºhrt**. Der Angreifer kann interessante Informationen erhalten (√ºberpr√ºfen Sie den Verlauf der Suchanfragen des Benutzers auf der Plattform, das Opfer kann seine Kreditkarte im Konto hinterlegen...).
* Wenn sich das **Cookie nach dem Login nicht √§ndert**, kann der Angreifer einfach ein Cookie **festlegen**, warten, bis das Opfer sich anmeldet, und dann dieses Cookie verwenden, um sich als das Opfer anzumelden.
* Wenn das **Cookie einen anf√§nglichen Wert festlegt** (wie in Flask, wo das **Cookie** den **CSRF-Token** der Sitzung festlegen kann und dieser Wert nach dem Login des Opfers beibehalten wird), kann der **Angreifer diesen bekannten Wert festlegen und dann missbrauchen** (in diesem Szenario kann der Angreifer den Benutzer dann dazu bringen, eine CSRF-Anfrage durchzuf√ºhren, da er den CSRF-Token kennt).

## Reihenfolge der Cookies

Wenn ein Browser zwei Cookies mit demselben Namen empf√§ngt, die **den gleichen Geltungsbereich** (Domain, Subdomains und Pfad) teilweise beeinflussen, sendet der **Browser beide Werte des Cookies**, wenn beide f√ºr die Anfrage g√ºltig sind.

Abh√§ngig davon, wer den **spezifischeren Pfad** hat oder welches das **√§ltere Cookie** ist, wird der Browser zuerst den Wert des Cookies setzen und dann den Wert des anderen wie folgt: `Cookie: iduser=MoreSpecificAndOldestCookie; iduser=LessSpecific;`

Die meisten **Websites verwenden nur den ersten Wert**. Wenn ein Angreifer also ein Cookie setzen m√∂chte, ist es besser, es zu setzen, bevor ein anderes gesetzt wird, oder es mit einem spezifischeren Pfad zu setzen.

{% hint style="warning" %}
Dar√ºber hinaus ist die F√§higkeit, ein Cookie in einem spezifischeren Pfad zu setzen, sehr interessant, da Sie den **Benutzer mit seinem Cookie arbeiten lassen k√∂nnen, au√üer in dem spezifischen Pfad, in dem das b√∂sartige Cookie zuerst gesendet wird**.
{% endhint %}

## Schutzumgehung

Ein m√∂glicher Schutz gegen diesen Angriff w√§re, dass der **Webserver keine Anfragen mit zwei Cookies mit demselben Namen, aber zwei verschiedenen Werten, akzeptiert**.

Um das Szenario zu umgehen, in dem der Angreifer ein Cookie setzt, nachdem dem Opfer bereits das Cookie gegeben wurde, k√∂nnte der Angreifer einen **Cookie-Overflow** verursachen und dann, sobald das **legitime Cookie gel√∂scht ist, das b√∂sartige Cookie setzen**.

{% content-ref url="cookie-jar-overflow.md" %}
[cookie-jar-overflow.md](cookie-jar-overflow.md)
{% endcontent-ref %}

Eine weitere n√ºtzliche **Umgehung** k√∂nnte darin bestehen, den Namen des Cookies **URL-codiert** anzugeben, da einige Schutzmechanismen nach 2 Cookies mit demselben Namen in einer Anfrage suchen und der Server dann die Namen der Cookies decodiert.

## Cookie-Bombe

Ein Cookie-Tossing-Angriff kann auch verwendet werden, um einen **Cookie-Bomben**-Angriff durchzuf√ºhren:

{% content-ref url="cookie-bomb.md" %}
[cookie-bomb.md](cookie-bomb.md)
{% endcontent-ref %}

## Verteidigung

### Verwenden Sie das Pr√§fix `__Host` im Cookie-Namen

* Wenn ein Cookie-Namen dieses Pr√§fix hat, wird es nur in einer Set-Cookie-Anweisung akzeptiert, wenn es als Secure markiert ist, von einem sicheren Ursprung gesendet wurde, keinen Domain-Attribut enth√§lt und das Pfad-Attribut auf / gesetzt ist.
* **Dies verhindert, dass Subdomains ein Cookie zur Apex-Domain erzwingen, da diese Cookies als "domain-locked" angesehen werden k√∂nnen**

## Referenzen

* [**@blueminimal**](https://twitter.com/blueminimal)
* [**https://speakerdeck.com/filedescriptor/the-cookie-monster-in-your-browsers**](https://speakerdeck.com/filedescriptor/the-cookie-monster-in-your-browsers)
* [**https://github.blog/2013-04-09-yummy-cookies-across-domains/**](https://github.blog/2013-04-09-yummy-cookies-across-domains/)


<details>

<summary><strong>Lernen Sie AWS-Hacking von Null auf Held mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks bewerben m√∂chten** oder **HackTricks als PDF herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merchandise**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositories senden.

</details>
