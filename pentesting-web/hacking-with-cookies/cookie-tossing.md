<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Expert de l'√©quipe rouge AWS de HackTricks)</strong></a><strong>!</strong></summary>

Autres fa√ßons de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFT**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts GitHub.

</details>


## Description

Si un attaquant peut **contr√¥ler un sous-domaine ou le domaine d'une entreprise ou trouve une XSS dans un sous-domaine**, il pourra effectuer cette attaque.

Comme indiqu√© dans la section de piratage des cookies, lorsqu'un **cookie est d√©fini pour un domaine (en le sp√©cifiant), il sera utilis√© dans le domaine et les sous-domaines.**

{% hint style="danger" %}
Par cons√©quent, **un attaquant pourra d√©finir pour le domaine et les sous-domaines un cookie sp√©cifique en faisant quelque chose comme** `document.cookie="session=1234; Path=/app/login; domain=.example.com"`
{% endhint %}

Cela peut √™tre dangereux car l'attaquant peut :

* **Fixer le cookie de la victime sur le compte de l'attaquant** donc si l'utilisateur ne le remarque pas, **il effectuera les actions dans le compte de l'attaquant** et l'attaquant peut obtenir des informations int√©ressantes (v√©rifier l'historique des recherches de l'utilisateur sur la plateforme, la victime peut enregistrer sa carte de cr√©dit dans le compte...)
* Si le **cookie ne change pas apr√®s la connexion**, l'attaquant peut simplement **fixer un cookie**, attendre que la victime se connecte, puis **utiliser ce cookie pour se connecter en tant que victime**.
* Si le **cookie d√©finit une valeur initiale** (comme dans Flask o√π le **cookie** peut **d√©finir** le **jeton CSRF** de la session et que cette valeur sera conserv√©e apr√®s la connexion de la victime), l'**attaquant peut d√©finir cette valeur connue puis l'exploiter** (dans ce sc√©nario, l'attaquant peut ensuite faire effectuer une requ√™te CSRF √† l'utilisateur car il conna√Æt le jeton CSRF).

## Ordre des cookies

Lorsqu'un navigateur re√ßoit deux cookies avec le m√™me nom **affectant partiellement le m√™me champ d'application** (domaine, sous-domaines et chemin), le **navigateur enverra les deux valeurs du cookie** lorsque les deux sont valides pour la requ√™te.

En fonction de qui a **le chemin le plus sp√©cifique** ou lequel est le **plus ancien**, le navigateur **d√©finira d'abord la valeur du cookie** puis la valeur de l'autre comme dans : `Cookie: iduser=CookiePlusSp√©cifiqueEtPlusAncien; iduser=MoinsSp√©cifique;`

La plupart des **sites Web n'utiliseront que la premi√®re valeur**. Ainsi, si un attaquant souhaite d√©finir un cookie, il est pr√©f√©rable de le d√©finir avant qu'un autre ne soit d√©fini ou de le d√©finir avec un chemin plus sp√©cifique.

{% hint style="warning" %}
De plus, la capacit√© √† **d√©finir un cookie dans un chemin plus sp√©cifique** est tr√®s int√©ressante car vous pourrez faire en sorte que la **victime travaille avec son cookie sauf dans le chemin sp√©cifique o√π le cookie malveillant d√©fini sera envoy√© en premier**.
{% endhint %}

## Contourner la protection

Une protection possible contre cette attaque serait que le **serveur Web n'accepte pas les requ√™tes avec deux cookies portant le m√™me nom mais deux valeurs diff√©rentes**.

Pour contourner le sc√©nario o√π l'attaquant d√©finit un cookie apr√®s que la victime ait d√©j√† re√ßu le cookie, l'attaquant pourrait provoquer un **d√©bordement de cookie** et ensuite, une fois que le **cookie l√©gitime est supprim√©, d√©finir le malveillant**.

{% content-ref url="cookie-jar-overflow.md" %}
[cookie-jar-overflow.md](cookie-jar-overflow.md)
{% endcontent-ref %}

Un autre **contournement** utile pourrait √™tre de **coder en URL le nom du cookie** car certaines protections v√©rifient la pr√©sence de 2 cookies portant le m√™me nom dans une requ√™te et ensuite le serveur d√©coderait les noms des cookies.

## Bombe √† cookies

Une attaque de Cookie Tossing peut √©galement √™tre utilis√©e pour effectuer une attaque de **Bombe √† cookies** :

{% content-ref url="cookie-bomb.md" %}
[cookie-bomb.md](cookie-bomb.md)
{% endcontent-ref %}

## D√©fense**s**

### **Utiliser le pr√©fixe `__Host` dans le nom du cookie**

* Si un nom de cookie a ce pr√©fixe, il **ne sera accept√© que** dans une directive Set-Cookie s'il est marqu√© Secure, a √©t√© envoy√© depuis une origine s√©curis√©e, n'inclut pas d'attribut Domain, et a l'attribut Path d√©fini sur /
* **Cela emp√™che les sous-domaines de forcer un cookie sur le domaine principal car ces cookies peuvent √™tre consid√©r√©s comme "verrouill√©s sur le domaine"**

## R√©f√©rences

* [**@blueminimal**](https://twitter.com/blueminimal)
* [**https://speakerdeck.com/filedescriptor/the-cookie-monster-in-your-browsers**](https://speakerdeck.com/filedescriptor/the-cookie-monster-in-your-browsers)
* [**https://github.blog/2013-04-09-yummy-cookies-across-domains/**](https://github.blog/2013-04-09-yummy-cookies-across-domains/)


<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Expert de l'√©quipe rouge AWS de HackTricks)</strong></a><strong>!</strong></summary>

Autres fa√ßons de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFT**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts GitHub.

</details>
