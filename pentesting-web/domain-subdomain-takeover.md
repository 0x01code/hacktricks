# Dom√≠nio/Subdom√≠nio takeover

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Voc√™ trabalha em uma **empresa de ciberseguran√ßa**? Voc√™ quer ver sua **empresa anunciada no HackTricks**? ou voc√™ quer ter acesso √† **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**? Verifique os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* **Junte-se ao** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para o** [**reposit√≥rio hacktricks**](https://github.com/carlospolop/hacktricks) **e** [**reposit√≥rio hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

<figure><img src="../.gitbook/assets/image (3) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
Use [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) para construir e **automatizar fluxos de trabalho** com as ferramentas comunit√°rias mais avan√ßadas do mundo.\
Obtenha acesso hoje:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## Dom√≠nio takeover

Se voc√™ descobrir algum dom√≠nio (dominio.tld) que est√° **sendo usado por algum servi√ßo dentro do escopo**, mas a **empresa** perdeu a **propriedade** dele, voc√™ pode tentar **registr√°-lo** (se for barato o suficiente) e informar a empresa. Se este dom√≠nio estiver recebendo alguma **informa√ß√£o sens√≠vel** como um cookie de sess√£o via par√¢metro **GET** ou no cabe√ßalho **Referer**, isso √© com certeza uma **vulnerabilidade**.

### Subdom√≠nio takeover

Um subdom√≠nio da empresa est√° apontando para um **servi√ßo de terceiros com um nome n√£o registrado**. Se voc√™ pode **criar** uma **conta** neste **servi√ßo de terceiros** e **registrar** o **nome** que est√° sendo usado, voc√™ pode realizar o subdom√≠nio takeover.

Existem v√°rias ferramentas com dicion√°rios para verificar poss√≠veis takeovers:

* [https://github.com/EdOverflow/can-i-take-over-xyz](https://github.com/EdOverflow/can-i-take-over-xyz)
* [https://github.com/blacklanternsecurity/bbot](https://github.com/blacklanternsecurity/bbot)
* [https://github.com/punk-security/dnsReaper](https://github.com/punk-security/dnsReaper)
* [https://github.com/haccer/subjack](https://github.com/haccer/subjack)
* [https://github.com/anshumanbh/tko-sub](https://github.com/anshumanbh/tko-subs)
* [https://github.com/ArifulProtik/sub-domain-takeover](https://github.com/ArifulProtik/sub-domain-takeover)
* [https://github.com/SaadAhmedx/Subdomain-Takeover](https://github.com/SaadAhmedx/Subdomain-Takeover)
* [https://github.com/Ice3man543/SubOver](https://github.com/Ice3man543/SubOver)
* [https://github.com/m4ll0k/takeover](https://github.com/m4ll0k/takeover)
* [https://github.com/antichown/subdomain-takeover](https://github.com/antichown/subdomain-takeover)
* [https://github.com/musana/mx-takeover](https://github.com/musana/mx-takeover)

#### Verificando subdom√≠nios suscet√≠veis a sequestro com [BBOT](https://github.com/blacklanternsecurity/bbot):

As verifica√ß√µes de subdom√≠nio takeover est√£o inclu√≠das na enumera√ß√£o padr√£o de subdom√≠nios do BBOT. As assinaturas s√£o obtidas diretamente de [https://github.com/EdOverflow/can-i-take-over-xyz](https://github.com/EdOverflow/can-i-take-over-xyz).
```bash
bbot -t evilcorp.com -f subdomain-enum
```
### Gera√ß√£o de Subdom√≠nio Takeover via DNS Wildcard

Quando um wildcard DNS √© usado em um dom√≠nio, qualquer subdom√≠nio solicitado desse dom√≠nio que n√£o tenha um endere√ßo diferente explicitamente ser√° **resolvido para as mesmas informa√ß√µes**. Isso pode ser um endere√ßo IP A, um CNAME...

Por exemplo, se `*.testing.com` estiver configurado como wildcard para `1.1.1.1`. Ent√£o, `not-existent.testing.com` estar√° apontando para `1.1.1.1`.

No entanto, se em vez de apontar para um endere√ßo IP, o administrador do sistema apontar para um **servi√ßo de terceiros via CNAME**, como um **subdom√≠nio do GitHub**, por exemplo (`sohomdatta1.github.io`). Um atacante poderia **criar sua pr√≥pria p√°gina de terceiros** (no caso do GitHub) e dizer que `something.testing.com` est√° apontando para l√°. Porque o **wildcard CNAME** concordar√°, o atacante ser√° capaz de **gerar subdom√≠nios arbitr√°rios para o dom√≠nio da v√≠tima apontando para suas p√°ginas**.

Voc√™ pode encontrar um exemplo dessa vulnerabilidade no write-up do CTF: [https://ctf.zeyu2001.com/2022/nitectf-2022/undocumented-js-api](https://ctf.zeyu2001.com/2022/nitectf-2022/undocumented-js-api)

## Explorando um Subdom√≠nio Takeover

**Esta informa√ß√£o foi copiada de** [**https://0xpatrik.com/subdomain-takeover/**](https://0xpatrik.com/subdomain-takeover/)

Recentemente, eu [escrevi](https://0xpatrik.com/subdomain-takeover-basics/) sobre os conceitos b√°sicos de subdom√≠nio takeover. Embora o conceito seja agora geralmente bem compreendido, notei que as pessoas geralmente t√™m dificuldade em entender os riscos que o subdom√≠nio takeover traz para a mesa. Neste post, vou aprofundar e cobrir os riscos mais not√°veis do _subdom√≠nio takeover_ na minha perspectiva.

_Observa√ß√£o: Alguns riscos s√£o mitigados implicitamente pelo provedor de nuvem. Por exemplo, quando o subdom√≠nio takeover √© poss√≠vel no Amazon CloudFront, n√£o h√° como configurar registros TXT para contornar as verifica√ß√µes SPF. O post, portanto, tem como objetivo fornecer riscos gerais de subdom√≠nio takeover. No entanto, a maioria deles se aplica tamb√©m aos provedores de nuvem._

### Transpar√™ncia para um Navegador <a href="#transparencytoabrowser" id="transparencytoabrowser"></a>

Para come√ßar, vamos analisar a resolu√ß√£o DNS quando o CNAME est√° envolvido:

![Resolu√ß√£o DNS](https://0xpatrik.com/content/images/2018/05/resolution-2.png)

Observe que a etapa #7 solicita _sub.example.com_ em vez de _anotherdomain.com_. Isso ocorre porque o navegador da web n√£o tem conhecimento de que _anotherdomain.com_ sequer existe. Mesmo que o registro CNAME seja usado, a barra de URL do navegador ainda cont√©m _sub.example.com_. Isso √© a **transpar√™ncia** para o navegador. Se voc√™ pensar sobre isso, o navegador deposita toda a confian√ßa no resolvedor DNS para fornecer informa√ß√µes precisas sobre o dom√≠nio. Simplificando, o subdom√≠nio takeover √© um spoofing DNS para um dom√≠nio espec√≠fico em toda a Internet. Por qu√™? Porque qualquer navegador que execute a resolu√ß√£o DNS no dom√≠nio afetado recebe um conjunto de registros A definido por um atacante. O navegador ent√£o mostra alegremente o que √© recebido deste servidor (pensando que √© leg√≠timo).

Um dom√≠nio desse tipo √© perfeito para phishing. Os atacantes frequentemente usam [_typosquatting_](https://en.wikipedia.org/wiki/Typosquatting) ou os chamados [_Doppelganger domains_](https://en.wikipedia.org/wiki/Doppelg%C3%A4nger) para imitar o dom√≠nio/site leg√≠timo para fins de phishing. Depois que um atacante assume o controle de um nome de dom√≠nio leg√≠timo, √© quase imposs√≠vel para um usu√°rio comum dizer se o conte√∫do no dom√≠nio √© fornecido por uma parte leg√≠tima ou por um atacante. Vamos pegar como exemplo um banco aleat√≥rio. Se um dos subdom√≠nios do banco for vulner√°vel ao subdom√≠nio takeover, um atacante pode criar um formul√°rio HTML que imita o formul√°rio de login do sistema de internet banking do banco. Em seguida, um atacante pode executar uma campanha de spear phishing ou phishing em massa pedindo aos usu√°rios que fa√ßam login e alterem suas senhas. Nesta etapa, as senhas s√£o capturadas por um atacante que est√° no controle do dom√≠nio em quest√£o. A URL fornecida no e-mail de phishing √© um subdom√≠nio leg√≠timo de um banco. Portanto, os usu√°rios n√£o t√™m conhecimento de algo malicioso acontecendo. Filtros de spam e outras medidas de seguran√ßa tamb√©m s√£o menos propensos a identificar o e-mail como spam ou malicioso porque ele cont√©m nomes de dom√≠nio com maior confian√ßa.

De fato, o pr√≥prio nome de dom√≠nio desempenha um papel significativo em uma campanha bem-sucedida. Ter um subdom√≠nio de 5¬∫ n√≠vel vulner√°vel ao subdom√≠nio takeover √© muito menos _"leg√≠timo"_ do que ter um subdom√≠nio de 2¬∫ n√≠vel com um nome de subdom√≠nio amig√°vel. Vi v√°rios casos de subdom√≠nios perfeitos para phishing, incluindo:

* _purchases.SOMETHING.com_
* _www.SOMETHING.com_
* _online.SOMETHING.com_
* _shop.SOMETHING.com_

Todos eles vulner√°veis ao subdom√≠nio takeover. Todos eles eram grandes marcas. Falando sobre phishing perfeito?

No entanto, campanhas recentes de phishing hospedam conte√∫do em dom√≠nios com nomes de dom√≠nio longos que incluem o nome da marca (veja o exemplo da [Apple](https://www.phishtank.com/target_search.php?target_id=183&valid=y&active=All&Search=Search)). Tendo um certificado SSL v√°lido (mais sobre isso abaixo), palavra-chave no nome de dom√≠nio e um site que imita o site da marca-alvo, as pessoas tendem a cair nesses ataques. Pense nas chances com um subdom√≠nio leg√≠timo dessa marca.

<figure><img src="../.gitbook/assets/image (3) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
Use [**Trickest**](https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks) para criar e **automatizar fluxos de trabalho** com facilidade, usando as ferramentas comunit√°rias mais avan√ßadas do mundo.\
Acesse hoje mesmo:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

### Certificados SSL <a href="#sslcertificates" id="sslcertificates"></a>

O ataque acima pode ser aprimorado gerando um certificado SSL v√°lido. Autoridades de certifica√ß√£o como [_Let's Encrypt_](https://letsencrypt.org/) permitem a verifica√ß√£o autom√°tica da propriedade do dom√≠nio por meio da verifica√ß√£o de conte√∫do:

![Fluxo do Let's Encrypt](https://0xpatrik.com/content/images/2018/05/letsencrypt.png)

Isso significa que, se houver um conte√∫do espec√≠fico colocado em um caminho de URL espec√≠fico, o Let's Encrypt aprovar√° a emiss√£o de um certificado para um determinado dom√≠nio. Como um atacante tem controle total sobre o conte√∫do do dom√≠nio que √© vulner√°vel ao subdom√≠nio takeover, essa verifica√ß√£o pode ser feita em quest√£o de minutos. Portanto, os atacantes tamb√©m s√£o capazes de gerar um certificado SSL para esse dom√≠nio, o que reduz ainda mais a suspeita de um ataque de phishing.
### Roubo de Cookies <a href="#roubodecookies" id="roubodecookies"></a>

Isso est√° intimamente relacionado √† transpar√™ncia do navegador, mas tem consequ√™ncias diferentes. O navegador da web implementa muitas pol√≠ticas de seguran√ßa para evitar que sites maliciosos causem danos. Isso inclui coisas como [Pol√≠tica de mesma origem](https://en.wikipedia.org/wiki/Same-origin\_policy). Uma das principais responsabilidades de seguran√ßa de um navegador √© proteger os cookies salvos. Por qu√™? Embora o HTTP seja um protocolo sem estado, os cookies s√£o usados para rastrear sess√µes. Por conveni√™ncia, os usu√°rios costumam salvar cookies por um longo per√≠odo para evitar fazer login toda vez. Esses cookies, portanto, atuam como um token de login que √© apresentado ao servidor da web e o usu√°rio √© identificado. Ataques como [_Roubo de sess√£o_](https://en.wikipedia.org/wiki/Session\_hijacking) naturalmente evolu√≠ram a partir desse conceito.

O navegador automaticamente apresenta os cookies armazenados com cada solicita√ß√£o ao dom√≠nio que os emitiu. H√° uma exce√ß√£o para isso, na qual os cookies podem ser compartilhados entre subdom√≠nios ([leia aqui](https://tools.ietf.org/html/rfc6265#section-8.6), observe tamb√©m a se√ß√£o 8.7). Isso geralmente acontece quando o site usa um sistema de [login √∫nico](https://en.wikipedia.org/wiki/Single\_sign-on) (SSO) baseado em cookies. Usando o SSO, um usu√°rio pode fazer login usando um subdom√≠nio e compartilhar o mesmo token de sess√£o em uma ampla variedade de subdom√≠nios. A sintaxe para definir um cookie regular √© a seguinte:
```
HTTP/1.1 200 OK
Set-Cookie: name=value
```
Se este cookie for emitido pelo servidor web que reside em _example.com_, apenas este servidor poder√° acessar este cookie posteriormente. No entanto, o cookie pode ser emitido para um dom√≠nio curinga (pelos motivos explicados acima) da seguinte maneira:
```
HTTP/1.1 200 OK
Set-Cookie: name=value; domain=example.com
```
O cookie ser√° inclu√≠do em solicita√ß√µes HTTP para _example.com_, mas tamb√©m para qualquer outro subdom√≠nio, como _subdominio.example.com_. Esse comportamento cria a possibilidade de ataques de alta gravidade usando subdom√≠nio takeover. Suponha que um determinado dom√≠nio esteja usando cookies de sess√£o para dom√≠nio curinga. Se houver um subdom√≠nio vulner√°vel ao subdom√≠nio takeover, a √∫nica coisa necess√°ria para obter o token de sess√£o do usu√°rio √© engan√°-lo para visitar o subdom√≠nio vulner√°vel. O cookie de sess√£o √© automaticamente enviado com a solicita√ß√£o HTTP.

O navegador tamb√©m implementa mecanismos de seguran√ßa adicionais para cookies:

* **Cookie HttpOnly** - Por padr√£o, os cookies podem ser acessados pelo c√≥digo JavaScript em execu√ß√£o no contexto do site que criou os cookies. O JavaScript pode ler, atualizar e excluir os cookies. A flag _HttpOnly_ (definida pelo servidor web) indica que o cookie em quest√£o n√£o pode ser acessado pelo c√≥digo JavaScript. A √∫nica maneira de obt√™-lo √© por meio de cabe√ßalhos de solicita√ß√£o e resposta HTTP.
* **Cookie seguro** - Quando o cookie tem a flag _Secure_ definida pelo servidor web, ele s√≥ pode ser comunicado de volta ao servidor web se o HTTPS for usado.

Se o dom√≠nio for vulner√°vel ao subdom√≠nio takeover, um invasor pode obter cookies emitidos por esse dom√≠nio no passado apenas enganando os usu√°rios para visitar esse site. As flags HttpOnly e Secure n√£o ajudam, pois o cookie n√£o est√° sendo acessado usando JavaScript e o certificado SSL pode ser facilmente gerado para o dom√≠nio tomado.

O roubo de cookies usando takeover foi explicado em um relat√≥rio de recompensa por bugs [report](https://hackerone.com/reports/172137) por Arne Swinnen. O relat√≥rio explica o problema com um dos subdom√≠nios da _Ubiquiti Networks_ (_ping.ubnt.com_). Este subdom√≠nio estava vulner√°vel ao subdom√≠nio takeover, apontando para uma distribui√ß√£o n√£o reclamada do AWS CloudFront. Como a Ubiquiti Networks est√° usando SSO com cookies de sess√£o curinga, todos os usu√°rios que visitam _ping.ubnt.com_ podem ter seus cookies de sess√£o roubados. Mesmo que este dom√≠nio esteja apontando para o AWS CloudFront, as configura√ß√µes de distribui√ß√£o do CloudFront permitem o registro de cookies com cada solicita√ß√£o. Portanto, o cen√°rio de extra√ß√£o de cookies de sess√£o √© totalmente poss√≠vel, mesmo com subdom√≠nios apontando para o AWS CloudFront. Em 2017, Arne tamb√©m demonstrou um vetor de ataque semelhante contra o sistema SSO da [Uber](https://www.arneswinnen.net/2017/06/authentication-bypass-on-ubers-sso-via-subdomain-takeover/).

O comportamento explicado acima n√£o se limita a cookies. Como os scripts JavaScript t√™m controle total sobre os sites em que s√£o executados, ter a capacidade de substituir esses scripts no site leg√≠timo pode levar a consequ√™ncias catastr√≥ficas. Suponha que o site esteja usando c√≥digo JavaScript de um provedor externo usando a tag _script_ e o atributo _src_. Quando o dom√≠nio do provedor externo expira, o navegador falha silenciosamente, ou seja, n√£o aciona nenhum alerta vis√≠vel para usu√°rios regulares. Se o c√≥digo externo n√£o estiver fazendo algo importante (por exemplo, sendo usado apenas para rastreamento), esse provedor externo pode permanecer no site por um per√≠odo prolongado. Um invasor pode assumir esse dom√≠nio expirado, corresponder ao caminho URL do c√≥digo JavaScript fornecido e, assim, obter controle sobre cada visitante que acessa o site original.

No entanto, h√° uma maneira de proteger a integridade dos arquivos JavaScript em um navegador. A _Integridade de Subrecursos_ [foi proposta](https://www.w3.org/TR/2016/REC-SRI-20160623/) como um mecanismo para incluir um hash criptogr√°fico como um atributo _integrity_ na tag _script_ em HTML5. Quando o hash criptogr√°fico fornecido n√£o corresponde ao arquivo baixado, o navegador se recusa a execut√°-lo.

### E-mails <a href="#emails" id="emails"></a>

Quando o subdom√≠nio takeover do CNAME √© poss√≠vel, os registros MX tamb√©m podem ser configurados por um invasor para um servidor web arbitr√°rio. Isso permite receber e-mails em um subdom√≠nio leg√≠timo de uma determinada marca - especialmente √∫til novamente em ataques de phishing (spear phishing) onde a intera√ß√£o entre o invasor e a v√≠tima √© necess√°ria. Os invasores geralmente falsificam o cabe√ßalho `Return-Path` para receber uma resposta ao e-mail. Com registros MX corretos, esse problema √© contornado.

Por outro lado, tamb√©m √© poss√≠vel enviar e-mails. Embora seja trivial falsificar o cabe√ßalho `From` para incluir qualquer endere√ßo de e-mail, os filtros SPF geralmente verificam o cabe√ßalho `Return-Path` e os hosts permitidos para envio de e-mails para o dom√≠nio. O SPF armazena a configura√ß√£o em registros TXT do DNS. Com o subdom√≠nio takeover, os registros TXT tamb√©m est√£o sob o controle do invasor - as verifica√ß√µes SPF podem ser facilmente passadas.

_Como mencionei no in√≠cio, essas t√°ticas geralmente n√£o funcionam com a maioria dos provedores de nuvem, pois voc√™ n√£o tem controle direto sobre a zona DNS._

### Riscos de Ordem Superior <a href="#higherorderrisks" id="higherorderrisks"></a>

O conceito de subdom√≠nio takeover pode ser naturalmente estendido para registros NS: se o dom√≠nio base de pelo menos um registro NS estiver dispon√≠vel para registro, o nome de dom√≠nio de origem estar√° vulner√°vel ao subdom√≠nio takeover.

Um dos problemas no subdom√≠nio takeover usando registro NS √© que o nome de dom√≠nio de origem geralmente possui v√°rios registros NS. M√∫ltiplos registros NS s√£o usados para redund√¢ncia e balanceamento de carga. O servidor de nomes √© escolhido aleatoriamente antes da resolu√ß√£o DNS. Suponha que o dom√≠nio _sub.example.com_ tenha dois registros NS: _ns.vulnerable.com_ e _ns.nonvulnerable.com_. Se um invasor assumir o controle do _ns.vulnerable.com_, a situa√ß√£o do ponto de vista do usu√°rio que consulta _sub.example.com_ √© a seguinte:

1. Como existem dois servidores de nomes, um √© escolhido aleatoriamente. Isso significa que a probabilidade de consultar um servidor de nomes controlado por um invasor √© de 50%.
2. Se o resolvedor DNS do usu√°rio escolher _ns.nonvulnerable.com_ (servidor de nomes leg√≠timo), o resultado correto ser√° retornado e provavelmente ser√° armazenado em cache em algum lugar entre 6 e 24 horas.
3. Se o resolvedor DNS do usu√°rio escolher _ns.vulnerable.com_ (servidor de nomes de propriedade de um invasor), um invasor pode fornecer um resultado falso que tamb√©m ser√° armazenado em cache. Como um invasor controla o servidor de nomes, ela pode definir o TTL para esse resultado espec√≠fico, por exemplo, uma semana.

O processo acima √© repetido toda vez que a entrada de cache expira. Quando um invasor escolhe usar um TTL com valor alto, o resultado falso permanecer√° no cache DNS durante esse per√≠odo. Durante esse tempo, todas as solicita√ß√µes para _sub.example.com_ usar√£o o resultado DNS falso armazenado em cache por um invasor. Essa ideia √© ainda amplificada quando os resolvedores DNS p√∫blicos (por exemplo, Google DNS) s√£o usados. Nesse caso, os resolvedores p√∫blicos provavelmente armazenar√£o em cache os resultados falsos, o que significa que todos os usu√°rios que usam o mesmo resolvedor DNS obter√£o resultados falsos at√© que o cache seja revogado.

Al√©m do controle sobre o nome de dom√≠nio de origem, tamb√©m √© obtido controle sobre todos os dom√≠nios de n√≠vel superior do nome de dom√≠nio de origem. Isso ocorre porque possuir um nome de dom√≠nio can√¥nico do registro NS significa possuir a zona DNS completa do nome de dom√≠nio de origem.

Em 2016, Matthew Bryant [demonstrou](https://thehackerblog.com/the-international-incident-gaining-control-of-a-int-domain-name-with-dns-trickery/index.html) um subdom√≠nio takeover usando registro NS em _maris.int_. O dom√≠nio de n√≠vel superior .INT √© um TLD especial e apenas algumas poucas dom√≠nios o utilizam. Bryant mostrou que, mesmo que o registro de tais nomes de dom√≠nio seja aprovado exclusivamente pela IANA, os servidores de nomes podem ser definidos para dom√≠nios arbitr√°rios. Como um dos servidores de nomes do _maris.int_ estava dispon√≠vel para registro (_cobalt.aliis.be_), o subdom√≠nio takeover foi poss√≠vel mesmo nesse TLD restrito.

Matthew tamb√©m [demonstrou](https://thehackerblog.com/the-io-error-taking-control-of-all-io-domains-with-a-targeted-registration/index.html) um ataque de gravidade ainda maior, onde ele foi capaz de obter controle sobre o servidor de nomes do dom√≠nio de n√≠vel superior .IO. Obter controle sobre o .IO significa controlar as respostas para todos os dom√≠nios .IO. Nesse caso, um dos servidores de nomes do .IO era _ns-a1.io_, que estava dispon√≠vel para registro. Ao registrar _ns-a1.io_, Bryant foi capaz de receber consultas DNS e controlar suas respostas para todos os dom√≠nios .IO.
### Mitiga√ß√£o <a href="#mitiga√ß√£o" id="mitiga√ß√£o"></a>

As estrat√©gias de mitiga√ß√£o para dom√≠nios j√° vulner√°veis a subdomain takeover s√£o bastante simples:

* **Remova o registro DNS afetado** - A solu√ß√£o mais simples √© remover o registro afetado da zona DNS. Esse passo √© geralmente utilizado quando a organiza√ß√£o conclui que o nome de dom√≠nio de origem afetado n√£o √© mais necess√°rio.
* **Reivindique o nome de dom√≠nio** - Isso significa registrar o recurso em um provedor de nuvem espec√≠fico ou, no caso de um dom√≠nio regular da Internet, recomprar o dom√≠nio expirado.

Para evitar subdomain takeover no futuro, as organiza√ß√µes devem alterar o processo de cria√ß√£o e destrui√ß√£o de recursos em sua infraestrutura. No caso da cria√ß√£o de recursos, a cria√ß√£o do registro DNS deve ser a _√∫ltima etapa_ desse processo. Essa condi√ß√£o impede que o registro DNS aponte para um dom√≠nio inexistente em qualquer momento. Para a destrui√ß√£o de recursos, ocorre o oposto: o registro DNS precisa ser removido como a _primeira etapa_ desse processo. Ferramentas como [aquatone](https://github.com/michenriksen/aquatone) incluem verifica√ß√µes para subdomain takeover. Essas verifica√ß√µes devem ser realizadas periodicamente por uma equipe de seguran√ßa da organiza√ß√£o para verificar se n√£o h√° dom√≠nios vulner√°veis. Os processos de coleta centralizada de nomes de dom√≠nio expostos geralmente n√£o s√£o eficientes dentro das organiza√ß√µes (devido a equipes globais, etc.) e o monitoramento externo geralmente √© a melhor op√ß√£o.

A mitiga√ß√£o para provedores de nuvem tamb√©m deve ser considerada. Os servi√ßos em nuvem n√£o verificam a propriedade do dom√≠nio. A raz√£o para isso √© principalmente a conveni√™ncia. O provedor de nuvem n√£o introduz nenhuma vulnerabilidade ao n√£o verificar a propriedade de um nome de dom√≠nio de origem. Portanto, cabe ao usu√°rio monitorar seus registros DNS. Outro motivo √© que, quando um recurso em nuvem √© removido, o usu√°rio geralmente n√£o √© mais cliente desse servi√ßo. A pergunta que os provedores de nuvem fazem √©: Por que dever√≠amos nos importar?

Provedores como [GitLab](https://about.gitlab.com/2018/02/05/gitlab-pages-custom-domain-validation/) perceberam que o subdomain takeover √© um problema e implementaram um mecanismo de verifica√ß√£o de dom√≠nio.

_Alumas partes deste post s√£o trechos da minha_ [_Tese de Mestrado_](https://is.muni.cz/th/byrdn/Thesis.pdf).

At√© a pr√≥xima!

[Patrik](https://twitter.com/0xpatrik)

<figure><img src="../.gitbook/assets/image (3) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
Use [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) para criar e **automatizar fluxos de trabalho** com facilidade, utilizando as ferramentas comunit√°rias mais avan√ßadas do mundo.\
Acesse hoje mesmo:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Voc√™ trabalha em uma **empresa de ciberseguran√ßa**? Gostaria de ver sua **empresa anunciada no HackTricks**? Ou gostaria de ter acesso √† **vers√£o mais recente do PEASS ou baixar o HackTricks em PDF**? Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Descubra [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* **Junte-se ao** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo Telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para o** [**reposit√≥rio hacktricks**](https://github.com/carlospolop/hacktricks) **e para o** [**reposit√≥rio hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
