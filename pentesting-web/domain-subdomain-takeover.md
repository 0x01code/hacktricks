# Domain/Subdomain takeover

<details>

<summary><strong>Aprenda hacking no AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ quer ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**material oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **Junte-se ao grupo** üí¨ [**Discord**](https://discord.gg/hRep4RUj7f) ou ao grupo [**telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe suas dicas de hacking enviando PRs para os reposit√≥rios github do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
Use [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) para construir e **automatizar fluxos de trabalho** com as ferramentas comunit√°rias **mais avan√ßadas** do mundo.\
Obtenha Acesso Hoje:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## Domain takeover

Se voc√™ descobrir algum dom√≠nio (domain.tld) que est√° **sendo usado por algum servi√ßo dentro do escopo** mas a **empresa** perdeu a **propriedade** dele, voc√™ pode tentar **registrar** (se for barato o suficiente) e informar a empresa. Se este dom√≠nio estiver recebendo alguma **informa√ß√£o sens√≠vel** como um cookie de sess√£o via par√¢metro **GET** ou no cabe√ßalho **Referer**, isso √© certamente uma **vulnerabilidade**.

### Subdomain takeover

Um subdom√≠nio da empresa est√° apontando para um **servi√ßo terceirizado com um nome n√£o registrado**. Se voc√™ puder **criar** uma **conta** neste **servi√ßo terceirizado** e **registrar** o **nome** em uso, voc√™ pode realizar a tomada de subdom√≠nio.

Existem v√°rias ferramentas com dicion√°rios para verificar poss√≠veis tomadas:

* [https://github.com/EdOverflow/can-i-take-over-xyz](https://github.com/EdOverflow/can-i-take-over-xyz)
* [https://github.com/blacklanternsecurity/bbot](https://github.com/blacklanternsecurity/bbot)
* [https://github.com/punk-security/dnsReaper](https://github.com/punk-security/dnsReaper)
* [https://github.com/haccer/subjack](https://github.com/haccer/subjack)
* [https://github.com/anshumanbh/tko-sub](https://github.com/anshumanbh/tko-subs)
* [https://github.com/ArifulProtik/sub-domain-takeover](https://github.com/ArifulProtik/sub-domain-takeover)
* [https://github.com/SaadAhmedx/Subdomain-Takeover](https://github.com/SaadAhmedx/Subdomain-Takeover)
* [https://github.com/Ice3man543/SubOver](https://github.com/Ice3man543/SubOver)
* [https://github.com/m4ll0k/takeover](https://github.com/m4ll0k/takeover)
* [https://github.com/antichown/subdomain-takeover](https://github.com/antichown/subdomain-takeover)
* [https://github.com/musana/mx-takeover](https://github.com/musana/mx-takeover)

#### Scanning for Hijackable Subdomains with [BBOT](https://github.com/blacklanternsecurity/bbot):

Verifica√ß√µes de takeover de subdom√≠nio est√£o inclu√≠das na enumera√ß√£o padr√£o de subdom√≠nios do BBOT. Assinaturas s√£o retiradas diretamente de [https://github.com/EdOverflow/can-i-take-over-xyz](https://github.com/EdOverflow/can-i-take-over-xyz).
```bash
bbot -t evilcorp.com -f subdomain-enum
```
### Gera√ß√£o de Subdomain Takeover via DNS Wildcard

Quando o DNS wildcard √© utilizado em um dom√≠nio, qualquer subdom√≠nio solicitado desse dom√≠nio que n√£o tenha um endere√ßo explicitamente diferente ser√° **resolvido para a mesma informa√ß√£o**. Isso pode ser um endere√ßo IP A, um CNAME...

Por exemplo, se `*.testing.com` est√° com wildcard para `1.1.1.1`. Ent√£o, `not-existent.testing.com` estar√° apontando para `1.1.1.1`.

No entanto, se em vez de apontar para um endere√ßo IP, o sysadmin apont√°-lo para um **servi√ßo de terceiros via CNAME**, como um **subdom√≠nio do github** por exemplo (`sohomdatta1.github.io`). Um atacante poderia **criar sua pr√≥pria p√°gina de terceiros** (no Github neste caso) e dizer que `something.testing.com` est√° apontando para l√°. Porque, o **CNAME wildcard** concordar√° e o atacante ser√° capaz de **gerar subdom√≠nios arbitr√°rios para o dom√≠nio da v√≠tima apontando para suas p√°ginas**.

Voc√™ pode encontrar um exemplo desta vulnerabilidade no write-up do CTF: [https://ctf.zeyu2001.com/2022/nitectf-2022/undocumented-js-api](https://ctf.zeyu2001.com/2022/nitectf-2022/undocumented-js-api)

## Explorando um Subdomain Takeover

**Esta informa√ß√£o foi copiada de** [**https://0xpatrik.com/subdomain-takeover/**](https://0xpatrik.com/subdomain-takeover/)

Recentemente, eu [escrevi](https://0xpatrik.com/subdomain-takeover-basics/) sobre os conceitos b√°sicos de subdomain takeover. Embora o conceito agora seja geralmente bem compreendido, notei que as pessoas geralmente t√™m dificuldade em entender os riscos que o subdomain takeover traz √† mesa. Neste post, eu exploro em profundidade e cubro os riscos mais not√°veis de _subdomain takeover_ do meu ponto de vista.

_Nota: Alguns riscos s√£o mitigados implicitamente pelo provedor de nuvem. Por exemplo, quando o subdomain takeover √© poss√≠vel no Amazon CloudFront, n√£o h√° como configurar registros TXT para contornar verifica√ß√µes de SPF. O post, portanto, visa fornecer riscos sobre subdomain takeover em geral. No entanto, a maioria deles se aplica a provedores de nuvem tamb√©m._

### Transpar√™ncia Para um Navegador <a href="#transparencytoabrowser" id="transparencytoabrowser"></a>

Para come√ßar, vamos olhar para a resolu√ß√£o de DNS onde o CNAME est√° envolvido:

![Resolu√ß√£o de DNS](https://0xpatrik.com/content/images/2018/05/resolution-2.png)

Note que a etapa #7 solicita _sub.example.com_ em vez de _anotherdomain.com_. Isso ocorre porque o navegador da web n√£o est√° ciente de que _anotherdomain.com_ sequer existe. Mesmo que o registro CNAME seja usado, a barra de URL no navegador ainda cont√©m _sub.example.com_. Esta √© a **transpar√™ncia** para o navegador. Se voc√™ pensar sobre isso, o navegador coloca toda a confian√ßa no resolvedor de DNS para fornecer informa√ß√µes precisas sobre o dom√≠nio. Simplificando, subdomain takeover √© um spoofing de DNS para um dom√≠nio particular em toda a Internet. Por qu√™? Porque qualquer navegador que realize a resolu√ß√£o de DNS no dom√≠nio afetado recebe um registro A definido por um atacante. O navegador ent√£o exibe alegremente o que quer que seja recebido deste servidor (pensando que √© leg√≠timo).

Um dom√≠nio como esse cria um cen√°rio perfeito para phishing. Atacantes frequentemente usam [_typosquatting_](https://en.wikipedia.org/wiki/Typosquatting) ou os chamados [_Doppelganger domains_](https://en.wikipedia.org/wiki/Doppelg%C3%A4nger) para imitar o dom√≠nio/site leg√≠timo para fins de phishing. Depois que um atacante assume o controle de um nome de dom√≠nio leg√≠timo, √© quase imposs√≠vel para um usu√°rio comum dizer se o conte√∫do no dom√≠nio √© fornecido por uma parte leg√≠tima ou um atacante. Vamos pegar, por exemplo, um banco aleat√≥rio. Se um dos subdom√≠nios do banco for vulner√°vel a subdomain takeover, um atacante pode criar um formul√°rio HTML que imita o formul√°rio de login do sistema de internet banking do banco. Ent√£o, um atacante pode executar uma campanha de spear phishing ou phishing em massa pedindo aos usu√°rios para fazerem login e mudarem suas senhas. Neste est√°gio, as senhas s√£o capturadas por um atacante que est√° no controle do dom√≠nio em quest√£o. O URL fornecido no e-mail de phishing √© um subdom√≠nio leg√≠timo de um banco. Portanto, os usu√°rios n√£o est√£o cientes de algo malicioso acontecendo. Filtros de spam e outras medidas de seguran√ßa tamb√©m s√£o menos propensos a acionar o e-mail como spam ou malicioso porque ele cont√©m nomes de dom√≠nio com maior confian√ßa.

De fato, o pr√≥prio nome de dom√≠nio desempenha um papel significativo em uma campanha bem-sucedida. Ter um subdom√≠nio de 5¬∫ n√≠vel vulner√°vel a subdomain takeover √© muito menos _"leg√≠timo"_ do que ter um subdom√≠nio de 2¬∫ n√≠vel com um nome de subdom√≠nio amig√°vel. Eu vi v√°rias inst√¢ncias de subdom√≠nios perfeitos para phishing, incluindo:

* _purchases.SOMETHING.com_
* _www.SOMETHING.com_
* _online.SOMETHING.com_
* _shop.SOMETHING.com_

Todos eles vulner√°veis a subdomain takeover. Todos eles eram grandes marcas. Falando sobre phishing perfeito?

No entanto, campanhas recentes de phishing hospedam conte√∫do em dom√≠nios com nomes de dom√≠nio longos que incluem o nome da marca (veja [exemplo da Apple](https://www.phishtank.com/target\_search.php?target\_id=183\&valid=y\&active=All\&Search=Search)). Tendo um certificado SSL v√°lido (mais sobre isso abaixo), palavra-chave no nome do dom√≠nio e site que imita o site da marca alvo, as pessoas tendem a cair nesses ataques. Pense nas chances com um subdom√≠nio leg√≠timo desta marca.

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
Use [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) para construir e **automatizar fluxos de trabalho** facilmente, alimentados pelas ferramentas comunit√°rias **mais avan√ßadas** do mundo.\
Obtenha Acesso Hoje:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

### Certificados SSL <a href="#sslcertificates" id="sslcertificates"></a>

O ataque acima pode ser aprimorado pela gera√ß√£o de um certificado SSL v√°lido. Autoridades certificadoras como [_Let's Encrypt_](https://letsencrypt.org/) permitem a verifica√ß√£o autom√°tica da propriedade do dom√≠nio pela verifica√ß√£o de conte√∫do:

![Fluxo Let's Encrypt](https://0xpatrik.com/content/images/2018/05/letsencrypt.png)

Ou seja, se houver um conte√∫do espec√≠fico colocado em um caminho de URL espec√≠fico, Let's Encrypt aprovar√° a emiss√£o de um certificado para um determinado dom√≠nio. Como um atacante tem controle total sobre o conte√∫do do dom√≠nio que √© vulner√°vel a subdomain takeover, essa verifica√ß√£o pode ser feita em quest√£o de minutos. Portanto, os atacantes tamb√©m s√£o capazes de gerar um certificado SSL para tal dom√≠nio, o que apenas diminui a suspeita de um ataque de phishing.

### Roubo de Cookies <a href="#cookiestealing" id="cookiestealing"></a>

Isso anda de m√£os dadas com a transpar√™ncia do navegador, mas tem consequ√™ncias diferentes. O navegador da web implementa muitas pol√≠ticas de seguran√ßa para impedir que sites maliciosos causem danos. Isso inclui coisas como [Pol√≠tica de mesma origem](https://en.wikipedia.org/wiki/Same-origin\_policy). Uma das principais responsabilidades de seguran√ßa de um navegador √© proteger os cookies salvos. Por qu√™? Enquanto o HTTP √© um protocolo sem estado, os cookies s√£o usados para rastrear sess√µes. Para conveni√™ncia, os usu√°rios frequentemente salvam cookies por um per√≠odo prolongado para evitar fazer login todas as vezes. Esses cookies, portanto, agem como um token de login que √© apresentado ao servidor web e o usu√°rio √© identificado. Ataques como [_Sequestro de sess√£o_](https://en.wikipedia.org/wiki/Session\_hijacking) evolu√≠ram naturalmente desse conceito.

O navegador automaticamente apresenta os cookies armazenados com cada solicita√ß√£o ao dom√≠nio que os emitiu. H√° uma exce√ß√£o a isso, tal que os cookies podem ser compartilhados entre subdom√≠nios ([leia aqui](https://tools.ietf.org/html/rfc6265#section-8.6), tamb√©m observe a se√ß√£o 8.7). Isso geralmente acontece quando o site usa um sistema de [Single sign-on](https://en.wikipedia.org/wiki/Single\_sign-on) (SSO) baseado em cookies. Usando SSO, um usu√°rio pode fazer login usando um subdom√≠nio e compartilhar o mesmo token de sess√£o em uma ampla gama de subdom√≠nios. A sintaxe para definir um cookie regular √© a seguinte:
```
HTTP/1.1 200 OK
Set-Cookie: name=value
```
Se este cookie for emitido por um servidor web residente em _example.com_, apenas este servidor poder√° acessar este cookie posteriormente. No entanto, o cookie pode ser emitido para um dom√≠nio curinga (pelos motivos explicados acima) da seguinte maneira:
```
HTTP/1.1 200 OK
Set-Cookie: name=value; domain=example.com
```
```markdown
O cookie ser√° inclu√≠do em solicita√ß√µes HTTP para _example.com_, mas tamb√©m para qualquer outro subdom√≠nio, como _subdomain.example.com_. Esse comportamento cria a possibilidade de ataques de alta gravidade usando subdomain takeover. Suponha que um dom√≠nio espec√≠fico esteja usando cookies de sess√£o para dom√≠nio curinga. Se houver um subdom√≠nio vulner√°vel a subdomain takeover, a √∫nica coisa necess√°ria para coletar o token de sess√£o do usu√°rio √© induzi-lo a visitar o subdom√≠nio vulner√°vel. O cookie de sess√£o √© automaticamente enviado com a solicita√ß√£o HTTP.

O navegador tamb√©m implementa mecanismos de seguran√ßa adicionais para cookies:

* **HttpOnly cookie** ‚Äî Cookies podem, por padr√£o, ser acessados por c√≥digo Javascript executado no contexto do site que criou os cookies. Javascript pode ler, atualizar e deletar os cookies. A flag _HttpOnly_ do cookie (definida pelo servidor web) indica que o cookie espec√≠fico n√£o pode ser acessado por c√≥digo Javascript. A √∫nica maneira de obt√™-lo √© atrav√©s dos cabe√ßalhos de solicita√ß√£o e resposta HTTP.
* **Secure cookie** ‚Äî Quando o cookie tem a flag _Secure_ definida pelo servidor web, ele s√≥ pode ser comunicado de volta ao servidor web se HTTPS for usado.

Se o dom√≠nio for vulner√°vel a subdomain takeover, um atacante pode coletar cookies emitidos por esse dom√≠nio no passado apenas induzindo usu√°rios a visitar esse site. As flags HttpOnly e Secure n√£o ajudam, pois o cookie n√£o est√° sendo acessado usando Javascript e o certificado SSL pode ser facilmente gerado para o dom√≠nio tomado.

O roubo de cookies usando takeover foi explicado no [relat√≥rio](https://hackerone.com/reports/172137) de bug bounty por Arne Swinnen. O relat√≥rio explica o problema com um dos subdom√≠nios da _Ubiquiti Networks_ (_ping.ubnt.com_). Esse subdom√≠nio estava vulner√°vel a subdomain takeover, apontando para uma distribui√ß√£o AWS CloudFront n√£o reivindicada. Como a Ubiquiti Networks est√° usando SSO com cookies de sess√£o curinga, todos os usu√°rios que visitassem _ping.ubnt.com_ poderiam ter seus cookies de sess√£o roubados. Embora este dom√≠nio aponte para AWS CloudFront, as configura√ß√µes de distribui√ß√£o do CloudFront permitem registrar cookies com cada solicita√ß√£o. Portanto, o cen√°rio de extra√ß√£o de cookies de sess√£o √© totalmente poss√≠vel mesmo com subdom√≠nios apontando para AWS CloudFront. Em 2017, Arne tamb√©m demonstrou um vetor de ataque semelhante contra [o sistema SSO da Uber](https://www.arneswinnen.net/2017/06/authentication-bypass-on-ubers-sso-via-subdomain-takeover/).

O comportamento explicado acima n√£o se limita a cookies. Como os scripts Javascript t√™m controle total sobre os sites em que s√£o executados, ter a capacidade de substituir tais scripts em um site leg√≠timo pode levar a consequ√™ncias catastr√≥ficas. Suponha que o site esteja usando c√≥digo Javascript de um provedor externo usando a tag _script_ e o atributo _src_. Quando o dom√≠nio do provedor externo expira, o navegador falha silenciosamente, ou seja, n√£o aciona nenhum alerta vis√≠vel para usu√°rios comuns. Se o c√≥digo externo n√£o estiver fazendo nada importante (por exemplo, √© usado apenas para rastreamento), tal provedor externo pode permanecer no site por um per√≠odo prolongado. Um atacante pode assumir esse dom√≠nio expirado, combinar o caminho da URL do c√≥digo Javascript fornecido e, assim, ganhar controle sobre cada visitante que visita o site original.

No entanto, h√° uma maneira de proteger a integridade dos arquivos Javascript no navegador. _Subresource Integrity_ [foi proposto](https://www.w3.org/TR/2016/REC-SRI-20160623/) como um mecanismo para incluir hash criptogr√°fico como um atributo _integrity_ √† tag _script_ em HTML5. Quando o hash criptogr√°fico fornecido n√£o corresponde ao arquivo baixado, o navegador se recusa a execut√°-lo.

### E-mails <a href="#emails" id="emails"></a>

Quando o subdomain takeover de CNAME √© poss√≠vel, os registros MX tamb√©m podem ser configurados por um atacante para um servidor web arbitr√°rio. Isso permite receber e-mails para um subdom√≠nio leg√≠timo de alguma marca - particularmente √∫til novamente em ataques de phishing (spear) onde a intera√ß√£o entre um atacante e a v√≠tima √© necess√°ria. Os atacantes geralmente falsificam o cabe√ßalho `Return-Path` para receber uma resposta ao e-mail. Com os registros MX corretos, esse problema √© contornado.

Por outro lado, tamb√©m √© poss√≠vel enviar e-mails. Embora seja trivial falsificar o cabe√ßalho `From` para incluir qualquer endere√ßo de e-mail, os filtros SPF geralmente verificam o cabe√ßalho `Return-Path` e os hosts permitidos para envio de e-mails para o dom√≠nio. O SPF armazena a configura√ß√£o em registros DNS TXT. Com subdomain takeover, os registros TXT tamb√©m est√£o sob controle do atacante - as verifica√ß√µes de SPF podem ser facilmente aprovadas.

_Como notei no in√≠cio, essas t√°ticas geralmente n√£o funcionam com a maioria dos provedores de nuvem, pois voc√™ n√£o tem controle direto sobre a zona DNS._

### Riscos de Ordem Superior <a href="#higherorderrisks" id="higherorderrisks"></a>

O conceito de subdomain takeover pode ser naturalmente estendido para registros NS: Se o dom√≠nio base de pelo menos um registro NS estiver dispon√≠vel para registro, o nome de dom√≠nio de origem est√° vulner√°vel a subdomain takeover.

Um dos problemas no subdomain takeover usando registro NS √© que o nome de dom√≠nio de origem geralmente tem v√°rios registros NS. V√°rios registros NS s√£o usados para redund√¢ncia e balanceamento de carga. O servidor de nomes √© escolhido aleatoriamente antes da resolu√ß√£o DNS. Suponha que o dom√≠nio _sub.example.com_ tenha dois registros NS: _ns.vulnerable.com_ e _ns.nonvulnerable.com_. Se um atacante assumir o _ns.vulnerable.com_, a situa√ß√£o do ponto de vista do usu√°rio que consulta _sub.example.com_ √© a seguinte:

1. Como existem dois servidores de nomes, um √© escolhido aleatoriamente. Isso significa que a probabilidade de consultar o servidor de nomes controlado por um atacante √© de 50%.
2. Se o resolvedor DNS do usu√°rio escolher _ns.nonvulnerable.com_ (servidor de nomes leg√≠timo), o resultado correto √© retornado e provavelmente sendo armazenado em cache em algum lugar entre 6 e 24 horas.
3. Se o resolvedor DNS do usu√°rio escolher _ns.vulnerable.com_ (servidor de nomes de propriedade de um atacante), um atacante pode fornecer um resultado falso que tamb√©m ser√° armazenado em cache. Como um atacante est√° no controle do servidor de nomes, ela pode definir o TTL para esse resultado espec√≠fico ser, por exemplo, uma semana.

O processo acima √© repetido toda vez que a entrada de cache expira. Quando um atacante opta por usar TTL com valor alto, o resultado falso permanecer√° no cache DNS por esse per√≠odo. Durante esse tempo, todas as solicita√ß√µes para _sub.example.com_ usar√£o o resultado DNS falso armazenado em cache por um atacante. Essa ideia √© ainda amplificada quando resolvedores DNS p√∫blicos (por exemplo, Google DNS) s√£o usados. Nesse caso, os resolvedores p√∫blicos provavelmente armazenar√£o os resultados falsos, o que significa que todos os usu√°rios que usam o mesmo resolvedor DNS obter√£o resultados falsos at√© que o cache seja revogado.

Al√©m do controle sobre o nome de dom√≠nio de origem, o controle sobre todos os dom√≠nios de n√≠vel superior do nome de dom√≠nio de origem tamb√©m √© obtido. Isso porque possuir um nome de dom√≠nio can√¥nico de registro NS significa possuir a zona DNS completa do nome de dom√≠nio de origem.

Em 2016, Matthew Bryant [demonstrou](https://thehackerblog.com/the-international-incident-gaining-control-of-a-int-domain-name-with-dns-trickery/index.html) um subdomain takeover usando registro NS em _maris.int_. O dom√≠nio de n√≠vel superior .INT √© um TLD especial, e apenas um punhado de dom√≠nios o utilizam. Bryant mostrou que, embora o registro de tais nomes de dom√≠nio seja aprovado exclusivamente pela IANA, os servidores de nomes podem ser configurados para dom√≠nios arbitr√°rios. Como um dos servidores de nomes de _maris.int_ estava dispon√≠vel para registro (_cobalt.aliis.be_), o subdomain takeover foi poss√≠vel at√© mesmo neste TLD restrito.

Matthew tamb√©m [demonstrou](https://thehackerblog.com/the-io-error-taking-control-of-all-io-domains-with-a-targeted-registration/index.html) um ataque de gravidade ainda maior, onde ele conseguiu assumir o controle sobre o servidor de nomes do dom√≠nio de n√≠vel superior .IO. Controlar .IO significa controlar as respostas para todos os nomes de dom√≠nio .IO. Neste caso, um dos servidores de nomes de .IO era _ns-a1.io_, que estava dispon√≠vel para registro. Ao registrar _ns-a1.io_, Bryant conseguiu receber consultas DNS e controlar suas respostas para todos os dom√≠nios .IO.

### Mitiga√ß√£o <a href="#mitigation" id="mitigation"></a>

As estrat√©gias de mitiga√ß√£o para nomes de dom√≠nio j√° vulner√°veis a subdomain takeover s√£o bastante diretas:

* **Remover o registro DNS afetado** ‚Äî A solu√ß√£o mais simples √© remover o registro afetado da zona DNS. Este passo √© geralmente usado se a organiza√ß√£o conclui que o nome de dom√≠nio de origem afetado n√£o √© mais necess√°rio.
* **Reivindicar o nome de dom√≠nio** ‚Äî Isso significa registrar o recurso em um provedor de nuvem espec√≠fico ou, no caso de um dom√≠nio regular da Internet, recomprar o dom√≠nio expirado.

Para prevenir subdomain takeover no futuro, as organiza√ß√µes devem mudar o processo de cria√ß√£o e destrui√ß√£o de recursos em sua infraestrutura. No caso da cria√ß√£o de recursos, a cria√ß√£o do registro DNS deve ser o _√∫ltimo passo_ desse processo. Essa condi√ß√£o impede que o registro DNS aponte para um dom√≠nio inexistente em qualquer momento. Para a destrui√ß√£o de recursos, o oposto √© verdadeiro: o registro DNS precisa ser removido como o _primeiro passo_ nesse processo. Ferramentas como [aquatone](https://github.com/michenriksen/aquatone) incluem verifica√ß√µes para subdomain takeover. As verifica√ß√µes devem ser realizadas periodicamente por uma equipe de seguran√ßa de uma organiza√ß√£o para verificar que n√£o h√° dom√≠nios vulner√°veis. Processos para coleta central de nomes de dom√≠nio expostos s√£o frequentemente ineficientes dentro das organiza√ß√µes (devido a equipes globais, etc.) e o monitoramento externo geralmente √© a melhor op√ß√£o.

A estrat√©gia de mitiga√ß√£o para provedores de nuvem tamb√©m deve ser considerada. Os servi√ßos de nuvem n√£o est√£o verificando a propriedade do dom√≠nio. A raz√£o por tr√°s disso √© principalmente a conveni√™ncia. O provedor de nuvem n√£o est√° introduzindo nenhuma vulnerabilidade ao n√£o verificar a propriedade de um nome de dom√≠nio de origem. Portanto, cabe ao usu√°rio monitorar seus registros DNS. Outra raz√£o √© que, quando um recurso de nuvem √© removido, o usu√°rio geralmente n√£o √© mais um cliente desse servi√ßo. A pergunta que os provedores de nuvem ent√£o se fazem √©: Por que dever√≠amos nos importar?

Provedores como [GitLab](https://about.gitlab.com/2018/02/05/gitlab-pages-custom-domain-validation/) perceberam que subdomain takeover √© um problema e implementaram um mecanismo de verifica√ß√£o de dom√≠nio.

_Algumas partes deste post s√£o trechos da minha_ [_Tese de Mestrado_](https://is.muni.cz/th/byrdn/Thesis.pdf).

At√© a pr√≥xima!

[Patrik](https://twitter.com/0xpatrik)

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
Use [**Trickest**](https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks) para construir e **automatizar fluxos de trabalho** com facilidade, alimentados pelas **ferramentas comunit√°rias mais avan√ßadas** do mundo.\
Obtenha Acesso Hoje:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><strong>Aprenda hacking AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras maneiras de apoiar o HackTricks:

* Se voc√™ quiser ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**merchandising oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **Junte-se ao grupo** üí¨ [**Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga**-me no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe suas dicas de hacking enviando PRs para os reposit√≥rios github do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
```
