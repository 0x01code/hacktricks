# Preuzimanje domena/poddomena

<details>

<summary><strong>Naučite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi načini podrške HackTricks-u:

* Ako želite da vidite **vašu kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**PLANOVE ZA PRETPLATU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvanični PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), našu kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridružite se** 💬 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
Koristite [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) da lako izgradite i **automatizujete radne tokove** uz pomoć najnaprednijih alata zajednice.\
Dobijte pristup danas:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## Preuzimanje domena

Ako otkrijete neki domen (domen.tld) koji **koristi neka usluga unutar opsega**, ali **kompanija** je **izgubila vlasništvo** nad njim, možete pokušati da ga **registrujete** (ako je dovoljno jeftin) i obavestite kompaniju. Ako ovaj domen prima neke **osetljive informacije** kao što je kolačić sesije putem **GET** parametra ili u zaglavlju **Referer**, to je sigurno **ranjivost**.

### Preuzimanje poddomena

Poddomen kompanije pokazuje na **uslugu treće strane sa neimenovanim imenom**. Ako možete **kreirati** nalog na ovoj **usluzi treće strane** i **registrujete** ime koje se koristi, možete izvršiti preuzimanje poddomena.

Postoji nekoliko alata sa rečnicima za proveru mogućih preuzimanja:

* [https://github.com/EdOverflow/can-i-take-over-xyz](https://github.com/EdOverflow/can-i-take-over-xyz)
* [https://github.com/blacklanternsecurity/bbot](https://github.com/blacklanternsecurity/bbot)
* [https://github.com/punk-security/dnsReaper](https://github.com/punk-security/dnsReaper)
* [https://github.com/haccer/subjack](https://github.com/haccer/subjack)
* [https://github.com/anshumanbh/tko-sub](https://github.com/anshumanbh/tko-subs)
* [https://github.com/ArifulProtik/sub-domain-takeover](https://github.com/ArifulProtik/sub-domain-takeover)
* [https://github.com/SaadAhmedx/Subdomain-Takeover](https://github.com/SaadAhmedx/Subdomain-Takeover)
* [https://github.com/Ice3man543/SubOver](https://github.com/Ice3man543/SubOver)
* [https://github.com/m4ll0k/takeover](https://github.com/m4ll0k/takeover)
* [https://github.com/antichown/subdomain-takeover](https://github.com/antichown/subdomain-takeover)
* [https://github.com/musana/mx-takeover](https://github.com/musana/mx-takeover)

#### Skeniranje za preuzimanje poddomena sa [BBOT](https://github.com/blacklanternsecurity/bbot):

Provere preuzimanja poddomena su uključene u podrazumevanoj enumeraciji poddomena BBOT-a. Potpisi se direktno preuzimaju sa [https://github.com/EdOverflow/can-i-take-over-xyz](https://github.com/EdOverflow/can-i-take-over-xyz).
```bash
bbot -t evilcorp.com -f subdomain-enum
```
### Generisanje preuzimanja poddomena putem DNS wildcard-a

Kada se DNS wildcard koristi u domenu, svaki zahtevani poddomen tog domena koji nema eksplicitno drugu adresu će biti **rešen na iste informacije**. To može biti IP adresa A, CNAME...

Na primer, ako je `*.testing.com` wildcardovan na `1.1.1.1`. Onda će `not-existent.testing.com` pokazivati na `1.1.1.1`.

Međutim, ako umesto da pokazuje na IP adresu, sistem administrator usmeri na **uslugu treće strane putem CNAME-a**, kao što je na primer **github poddomen** (`sohomdatta1.github.io`). Napadač bi mogao **kreirati svoju sopstvenu stranicu treće strane** (u ovom slučaju na Github-u) i reći da `something.testing.com` pokazuje tamo. Zbog toga što **CNAME wildcard** to dozvoljava, napadač će biti u mogućnosti da **generiše proizvoljne poddomene za domen žrtve koji pokazuju na njegove stranice**.

Primer ove ranjivosti možete pronaći u CTF write-up-u: [https://ctf.zeyu2001.com/2022/nitectf-2022/undocumented-js-api](https://ctf.zeyu2001.com/2022/nitectf-2022/undocumented-js-api)

## Iskorišćavanje preuzimanja poddomena

Preuzimanje poddomena je suštinski DNS spoofing za određeni domen širom interneta, što omogućava napadačima da postave A zapise za domen, što dovodi do prikazivanja sadržaja sa servera napadača u pregledačima. Ova **transparentnost** u pregledačima čini domene podložnim fišing napadima. Napadači mogu koristiti [_typosquatting_](https://en.wikipedia.org/wiki/Typosquatting) ili [_Doppelganger domene_](https://en.wikipedia.org/wiki/Doppelg%C3%A4nger) u tu svrhu. Posebno su ranjivi domeni u kojima URL u fišing emailu izgleda legitimno, obmanjujući korisnike i izbegavajući spam filtere zbog inherentnog poverenja u domen.

Pogledajte ovaj [post za dodatne detalje](https://0xpatrik.com/subdomain-takeover/)

### **SSL sertifikati**
SSL sertifikati, ako ih napadači generišu putem usluga kao što je [_Let's Encrypt_](https://letsencrypt.org/), doprinose legitimnosti ovih lažnih domena, čineći fišing napade ubedljivijim.

### **Sigurnost kolačića i transparentnost pregledača**
Transparentnost pregledača se odnosi i na sigurnost kolačića, koju regulišu politike poput [Politike istog porekla](https://en.wikipedia.org/wiki/Same-origin_policy). Kolačići, često korišćeni za upravljanje sesijama i čuvanje tokena za prijavu, mogu biti iskorišćeni putem preuzimanja poddomena. Napadači mogu **prikupiti sesijske kolačiće** jednostavno usmeravajući korisnike na kompromitovani poddomen, ugrožavajući podatke i privatnost korisnika.

### **Emailovi i preuzimanje poddomena**
Još jedan aspekt preuzimanja poddomena uključuje email usluge. Napadači mogu manipulisati **MX zapisima** kako bi primili ili poslali emailove sa legitimnog poddomena, povećavajući efikasnost fišing napada.

### **Rizici višeg reda**
Dodatni rizici uključuju **preuzimanje NS zapisa**. Ako napadač preuzme kontrolu nad jednim NS zapisom domena, mogu potencijalno usmeriti deo saobraćaja na server pod njihovom kontrolom. Ovaj rizik se povećava ako napadač postavi visok **TTL (Vreme života)** za DNS zapise, produžavajući trajanje napada.

### Ranjivost CNAME zapisa
Napadači mogu iskoristiti neiskorišćene CNAME zapise koji pokazuju na eksterne usluge koje više nisu u upotrebi ili su isključene. To im omogućava da kreiraju stranicu pod pouzdanim domenom, što dodatno olakšava fišing ili distribuciju malvera.

### **Strategije ublažavanja**
Strategije ublažavanja uključuju:
1. **Uklanjanje ranjivih DNS zapisa** - Ovo je efikasno ako poddomen više nije potreban.
2. **Preuzimanje imena domena** - Registracija resursa kod odgovarajućeg pružaoca usluga u oblaku ili ponovna kupovina isteklog domena.
3. **Redovno praćenje ranjivosti** - Alati poput [aquatone](https://github.com/michenriksen/aquatone) mogu pomoći u identifikaciji podložnih domena. Organizacije takođe treba da pregledaju svoje procese upravljanja infrastrukturom, obezbeđujući da kreiranje DNS zapisa bude poslednji korak u kreiranju resursa i prvi korak u uništavanju resursa.

Za pružaoce usluga u oblaku, važno je verifikovati vlasništvo domena kako bi se sprečilo preuzimanje poddomena. Neki, poput [GitLab-a](https://about.gitlab.com/2018/02/05/gitlab-pages-custom-domain-validation/), su prepoznali ovaj problem i implementirali mehanizme za verifikaciju domena.

## Reference
* [https://0xpatrik.com/subdomain-takeover/](https://0xpatrik.com/subdomain-takeover/)

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
Koristite [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) da lako izgradite i **automatizujete radne tokove** uz pomoć najnaprednijih alata zajednice na svetu.\
Pristupite danas:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><strong>Naučite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi načini podrške HackTricks-u:

* Ako želite da vidite **vašu kompaniju reklamiranu u HackTricks-u** ili **preuzmete HackTricks u PDF formatu**, proverite [**PLANOVE ZA PRIJAVU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvanični PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), našu kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridružite se** 💬 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
