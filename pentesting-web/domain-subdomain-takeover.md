# Dom√≠nio/Subdom√≠nio takeover

<details>

<summary><strong>Aprenda hacking AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras maneiras de apoiar o HackTricks:

* Se voc√™ quiser ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF** Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**swag oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-nos** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para os** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) reposit√≥rios do github.

</details>

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
Use [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) para construir e **automatizar fluxos de trabalho** facilmente com as **ferramentas comunit√°rias mais avan√ßadas do mundo**.\
Acesse hoje:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## Dom√≠nio takeover

Se voc√™ descobrir que algum dom√≠nio (dom√≠nio.tld) est√° **sendo usado por algum servi√ßo dentro do escopo** mas a **empresa** perdeu a **propriedade** dele, voc√™ pode tentar **registr√°-lo** (se for barato o suficiente) e informar a empresa. Se este dom√≠nio estiver recebendo alguma **informa√ß√£o sens√≠vel** como um cookie de sess√£o via par√¢metro **GET** ou no cabe√ßalho **Referer**, isso √© com certeza uma **vulnerabilidade**.

### Subdom√≠nio takeover

Um subdom√≠nio da empresa est√° apontando para um **servi√ßo de terceiros com um nome n√£o registrado**. Se voc√™ puder **criar** uma **conta** neste **servi√ßo de terceiros** e **registrar** o **nome** em uso, voc√™ pode realizar o subdom√≠nio takeover.

Existem v√°rias ferramentas com dicion√°rios para verificar poss√≠veis takeovers:

* [https://github.com/EdOverflow/can-i-take-over-xyz](https://github.com/EdOverflow/can-i-take-over-xyz)
* [https://github.com/blacklanternsecurity/bbot](https://github.com/blacklanternsecurity/bbot)
* [https://github.com/punk-security/dnsReaper](https://github.com/punk-security/dnsReaper)
* [https://github.com/haccer/subjack](https://github.com/haccer/subjack)
* [https://github.com/anshumanbh/tko-sub](https://github.com/anshumanbh/tko-subs)
* [https://github.com/ArifulProtik/sub-domain-takeover](https://github.com/ArifulProtik/sub-domain-takeover)
* [https://github.com/SaadAhmedx/Subdomain-Takeover](https://github.com/SaadAhmedx/Subdomain-Takeover)
* [https://github.com/Ice3man543/SubOver](https://github.com/Ice3man543/SubOver)
* [https://github.com/m4ll0k/takeover](https://github.com/m4ll0k/takeover)
* [https://github.com/antichown/subdomain-takeover](https://github.com/antichown/subdomain-takeover)
* [https://github.com/musana/mx-takeover](https://github.com/musana/mx-takeover)
* [https://github.com/PentestPad/subzy](https://github.com/PentestPad/subzy)

#### Verifica√ß√£o de Subdom√≠nios Suscet√≠veis a Sequestro com [BBOT](https://github.com/blacklanternsecurity/bbot):

As verifica√ß√µes de subdom√≠nio takeover est√£o inclu√≠das na enumera√ß√£o padr√£o de subdom√≠nios do BBOT. As assinaturas s√£o retiradas diretamente de [https://github.com/EdOverflow/can-i-take-over-xyz](https://github.com/EdOverflow/can-i-take-over-xyz).
```bash
bbot -t evilcorp.com -f subdomain-enum
```
### Gera√ß√£o de Subdom√≠nio Takeover via DNS Wildcard

Quando um wildcard DNS √© usado em um dom√≠nio, qualquer subdom√≠nio solicitado desse dom√≠nio que n√£o tenha um endere√ßo diferente explicitamente ser√° **resolvido para as mesmas informa√ß√µes**. Isso pode ser um endere√ßo IP A, um CNAME...

Por exemplo, se `*.testing.com` for wildcarded para `1.1.1.1`. Ent√£o, `not-existent.testing.com` estar√° apontando para `1.1.1.1`.

No entanto, se em vez de apontar para um endere√ßo IP, o administrador de sistema apontar para um **servi√ßo de terceiros via CNAME**, como um **subdom√≠nio do github** por exemplo (`sohomdatta1.github.io`). Um atacante poderia **criar sua pr√≥pria p√°gina de terceiros** (no Github neste caso) e dizer que `something.testing.com` est√° apontando para l√°. Porque, o **wildcard CNAME** concordar√° e o atacante ser√° capaz de **gerar subdom√≠nios arbitr√°rios para o dom√≠nio da v√≠tima apontando para suas p√°ginas**.

Voc√™ pode encontrar um exemplo dessa vulnerabilidade no CTF write-up: [https://ctf.zeyu2001.com/2022/nitectf-2022/undocumented-js-api](https://ctf.zeyu2001.com/2022/nitectf-2022/undocumented-js-api)

## Explorando um subdom√≠nio takeover

Subdom√≠nio takeover √© essencialmente um spoofing DNS para um dom√≠nio espec√≠fico em toda a internet, permitindo que atacantes configurem registros A para um dom√≠nio, levando os navegadores a exibir conte√∫do do servidor do atacante. Essa **transpar√™ncia** nos navegadores torna os dom√≠nios propensos a phishing. Os atacantes podem empregar [_typosquatting_](https://en.wikipedia.org/wiki/Typosquatting) ou [_Doppelganger domains_](https://en.wikipedia.org/wiki/Doppelg%C3%A4nger) para esse fim. Especialmente vulner√°veis s√£o os dom√≠nios onde a URL em um e-mail de phishing parece leg√≠tima, enganando os usu√°rios e evitando filtros de spam devido √† confian√ßa inerente do dom√≠nio.

Confira este [post para mais detalhes](https://0xpatrik.com/subdomain-takeover/)

### **Certificados SSL**

Certificados SSL, se gerados por atacantes via servi√ßos como [_Let's Encrypt_](https://letsencrypt.org/), aumentam a legitimidade desses dom√≠nios falsos, tornando os ataques de phishing mais convincentes.

### **Seguran√ßa de Cookies e Transpar√™ncia do Navegador**

A transpar√™ncia do navegador tamb√©m se estende √† seguran√ßa dos cookies, governada por pol√≠ticas como a [Pol√≠tica da mesma origem](https://en.wikipedia.org/wiki/Same-origin\_policy). Cookies, frequentemente usados para gerenciar sess√µes e armazenar tokens de login, podem ser explorados por meio de subdom√≠nio takeover. Os atacantes podem **coletar cookies de sess√£o** simplesmente direcionando os usu√°rios para um subdom√≠nio comprometido, colocando em risco os dados e a privacidade do usu√°rio.

### **E-mails e Subdom√≠nio Takeover**

Outro aspecto do subdom√≠nio takeover envolve servi√ßos de e-mail. Os atacantes podem manipular **registros MX** para receber ou enviar e-mails de um subdom√≠nio leg√≠timo, aumentando a efic√°cia dos ataques de phishing.

### **Riscos de Ordem Superior**

Outros riscos incluem **takeover de registros NS**. Se um atacante ganhar controle sobre um registro NS de um dom√≠nio, eles podem potencialmente direcionar uma parte do tr√°fego para um servidor sob seu controle. Esse risco √© ampliado se o atacante definir um alto **TTL (Time to Live)** para registros DNS, prolongando a dura√ß√£o do ataque.

### Vulnerabilidade de Registro CNAME

Os atacantes podem explorar registros CNAME n√£o reclamados apontando para servi√ßos externos que n√£o s√£o mais usados ou foram desativados. Isso lhes permite criar uma p√°gina sob o dom√≠nio confi√°vel, facilitando ainda mais o phishing ou a distribui√ß√£o de malware.

### **Estrat√©gias de Mitiga√ß√£o**

As estrat√©gias de mitiga√ß√£o incluem:

1. **Remover registros DNS vulner√°veis** - Isso √© eficaz se o subdom√≠nio n√£o for mais necess√°rio.
2. **Reivindicar o nome de dom√≠nio** - Registrar o recurso com o provedor de nuvem respectivo ou recomprar um dom√≠nio expirado.
3. **Monitoramento regular de vulnerabilidades** - Ferramentas como [aquatone](https://github.com/michenriksen/aquatone) podem ajudar a identificar dom√≠nios suscet√≠veis. As organiza√ß√µes tamb√©m devem revisar seus processos de gerenciamento de infraestrutura, garantindo que a cria√ß√£o de registros DNS seja a etapa final na cria√ß√£o de recursos e a primeira etapa na destrui√ß√£o de recursos.

Para provedores de nuvem, verificar a propriedade do dom√≠nio √© crucial para evitar subdom√≠nio takeovers. Alguns, como [GitLab](https://about.gitlab.com/2018/02/05/gitlab-pages-custom-domain-validation/), reconheceram esse problema e implementaram mecanismos de verifica√ß√£o de dom√≠nio.

## Refer√™ncias

* [https://0xpatrik.com/subdomain-takeover/](https://0xpatrik.com/subdomain-takeover/)

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
Use [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) para construir e **automatizar fluxos de trabalho** facilmente com as ferramentas comunit√°rias mais avan√ßadas do mundo.\
Tenha Acesso Hoje:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><strong>Aprenda hacking AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras maneiras de apoiar o HackTricks:

* Se voc√™ deseja ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF** Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**swag oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-nos** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para o** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
