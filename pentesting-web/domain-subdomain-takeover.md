# Toma de control de dominio/subdominio

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* ¬øTrabajas en una **empresa de ciberseguridad**? ¬øQuieres ver tu **empresa anunciada en HackTricks**? ¬øO quieres tener acceso a la **√∫ltima versi√≥n de PEASS o descargar HackTricks en PDF**? ¬°Consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obt√©n el [**swag oficial de PEASS y HackTricks**](https://peass.creator-spring.com)
* **√önete al** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de Telegram**](https://t.me/peass) o **s√≠gueme** en **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Comparte tus trucos de hacking enviando PRs al** [**repositorio de hacktricks**](https://github.com/carlospolop/hacktricks) **y al** [**repositorio de hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

<figure><img src="/.gitbook/assets/image (3).png" alt=""><figcaption></figcaption></figure>

\
Utiliza [**Trickest**](https://trickest.io/) para construir y **automatizar flujos de trabajo** con las herramientas comunitarias m√°s avanzadas del mundo.\
Obt√©n acceso hoy mismo:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## Toma de control de dominio

Si descubres que alg√∫n dominio (dominio.tld) est√° siendo utilizado por alg√∫n servicio dentro del alcance, pero la **empresa** ha **perdido la propiedad** del mismo, puedes intentar **registrarlo** (si es lo suficientemente barato) y notificar a la empresa. Si este dominio est√° recibiendo alguna **informaci√≥n sensible**, como una cookie de sesi√≥n a trav√©s de un par√°metro **GET** o en la cabecera **Referer**, esto es sin duda una **vulnerabilidad**.

### Toma de control de subdominio

Un subdominio de la empresa apunta a un **servicio de terceros con un nombre no registrado**. Si puedes **crear** una **cuenta** en este **servicio de terceros** y **registras** el **nombre** que est√° en uso, puedes llevar a cabo la toma de control del subdominio.

Existen varias herramientas con diccionarios para verificar posibles tomas de control:

* [https://github.com/EdOverflow/can-i-take-over-xyz](https://github.com/EdOverflow/can-i-take-over-xyz)
* [https://github.com/blacklanternsecurity/bbot](https://github.com/blacklanternsecurity/bbot)
* [https://github.com/punk-security/dnsReaper](https://github.com/punk-security/dnsReaper)
* [https://github.com/haccer/subjack](https://github.com/haccer/subjack)
* [https://github.com/anshumanbh/tko-sub](https://github.com/anshumanbh/tko-subs)
* [https://github.com/ArifulProtik/sub-domain-takeover](https://github.com/ArifulProtik/sub-domain-takeover)
* [https://github.com/SaadAhmedx/Subdomain-Takeover](https://github.com/SaadAhmedx/Subdomain-Takeover)
* [https://github.com/Ice3man543/SubOver](https://github.com/Ice3man543/SubOver)
* [https://github.com/m4ll0k/takeover](https://github.com/m4ll0k/takeover)
* [https://github.com/antichown/subdomain-takeover](https://github.com/antichown/subdomain-takeover)
* [https://github.com/musana/mx-takeover](https://github.com/musana/mx-takeover)

#### Escaneo de subdominios secuestrables con [BBOT](https://github.com/blacklanternsecurity/bbot):
Las comprobaciones de toma de control de subdominios est√°n incluidas en la enumeraci√≥n de subdominios predeterminada de BBOT. Las firmas se obtienen directamente de [https://github.com/EdOverflow/can-i-take-over-xyz](https://github.com/EdOverflow/can-i-take-over-xyz).
~~~bash
bbot -t evilcorp.com -f subdomain-enum
~~~

### Generaci√≥n de toma de control de subdominio mediante DNS Wildcard

Cuando se utiliza un comod√≠n DNS en un dominio, cualquier subdominio solicitado de ese dominio que no tenga una direcci√≥n diferente expl√≠citamente se **resolver√° con la misma informaci√≥n**. Esto puede ser una direcci√≥n IP A, un CNAME...

Por ejemplo, si `*.testing.com` est√° comodinado a `1.1.1.1`. Entonces, `not-existent.testing.com` apuntar√° a `1.1.1.1`.

Sin embargo, si en lugar de apuntar a una direcci√≥n IP, el administrador del sistema lo apunta a un **servicio de terceros a trav√©s de CNAME**, como un **subdominio de GitHub**, por ejemplo (`sohomdatta1.github.io`). Un atacante podr√≠a **crear su propia p√°gina de terceros** (en este caso, en GitHub) y decir que `something.testing.com` apunta all√≠. Debido a que el **comod√≠n CNAME** lo permite, el atacante podr√° **generar subdominios arbitrarios para el dominio de la v√≠ctima que apunten a sus p√°ginas**.

Puedes encontrar un ejemplo de esta vulnerabilidad en el informe de CTF: [https://ctf.zeyu2001.com/2022/nitectf-2022/undocumented-js-api](https://ctf.zeyu2001.com/2022/nitectf-2022/undocumented-js-api)
## Explotando una toma de control de subdominio

**Esta informaci√≥n fue copiada de** [**https://0xpatrik.com/subdomain-takeover/**](https://0xpatrik.com/subdomain-takeover/)

Recientemente, [escrib√≠](https://0xpatrik.com/subdomain-takeover-basics/) sobre los conceptos b√°sicos de la toma de control de subdominios. Aunque el concepto ahora se comprende en general, not√© que las personas suelen tener dificultades para entender los riesgos que implica la toma de control de subdominios. En esta publicaci√≥n, profundizo y cubro los riesgos m√°s notables de la _toma de control de subdominios_ desde mi perspectiva.

_Nota: Algunos riesgos se mitigan impl√≠citamente por el proveedor de la nube. Por ejemplo, cuando es posible la toma de control de subdominios en Amazon CloudFront, no hay forma de configurar registros TXT para omitir las comprobaciones SPF. Por lo tanto, el objetivo de esta publicaci√≥n es proporcionar riesgos sobre la toma de control de subdominios en general. Sin embargo, la mayor√≠a de estos tambi√©n se aplican a los proveedores de la nube._

### Transparencia para un navegador <a href="#transparenciaparanavegador" id="transparenciaparanavegador"></a>

Para empezar, veamos la resoluci√≥n DNS cuando est√° involucrado un CNAME:

![Resoluci√≥n DNS](https://0xpatrik.com/content/images/2018/05/resolution-2.png)

Ten en cuenta que el paso #7 solicita _sub.example.com_ en lugar de _anotherdomain.com_. Esto se debe a que el navegador web no sabe que _anotherdomain.com_ existe. Aunque se utiliza el registro CNAME, la barra de URL del navegador a√∫n contiene _sub.example.com_. Esta es la **transparencia** para el navegador. Si lo piensas, el navegador conf√≠a en el resolutor DNS para proporcionar informaci√≥n precisa sobre el dominio. Simplificando, la toma de control de subdominios es un envenenamiento DNS para un dominio en particular en Internet. ¬øPor qu√©? Porque cualquier navegador que realice la resoluci√≥n DNS en el dominio afectado recibe un conjunto de registros A establecido por un atacante. El navegador luego muestra felizmente lo que recibe de este servidor (pensando que es leg√≠timo).

Un dominio as√≠ es perfecto para un escenario de phishing. Los atacantes suelen utilizar [_typosquatting_](https://en.wikipedia.org/wiki/Typosquatting) o los llamados [_dominios Doppelganger_](https://en.wikipedia.org/wiki/Doppelg%C3%A4nger) para imitar el dominio/sitio web leg√≠timo con fines de phishing. Despu√©s de que un atacante se apodera de un nombre de dominio leg√≠timo, es casi imposible para un usuario regular saber si el contenido del dominio es proporcionado por una parte leg√≠tima o por un atacante. Tomemos, por ejemplo, un banco al azar. Si uno de los subdominios del banco es vulnerable a la toma de control de subdominios, un atacante puede crear un formulario HTML que imite el formulario de inicio de sesi√≥n del sistema de banca en l√≠nea del banco. Luego, un atacante puede ejecutar una campa√±a de spear phishing o phishing masivo pidiendo a los usuarios que inicien sesi√≥n y cambien sus contrase√±as. En esta etapa, las contrase√±as son capturadas por un atacante que tiene el control del dominio en cuesti√≥n. La URL proporcionada en el correo electr√≥nico de phishing es un subdominio leg√≠timo de un banco. Por lo tanto, los usuarios no son conscientes de que algo malicioso est√° sucediendo. Los filtros de spam y otras medidas de seguridad tambi√©n tienen menos probabilidades de detectar el correo electr√≥nico como spam o malicioso porque contiene nombres de dominio con mayor confianza.

De hecho, el nombre de dominio en s√≠ juega un papel importante en una campa√±a exitosa. Tener un subdominio de quinto nivel vulnerable a la toma de control de subdominios es mucho menos _"leg√≠timo"_ que tener un subdominio de segundo nivel con un nombre de subdominio amigable. Vi varios casos de subdominios perfectos para phishing, incluyendo:

* _purchases.SOMETHING.com_
* _www.SOMETHING.com_
* _online.SOMETHING.com_
* _shop.SOMETHING.com_

Todos ellos son vulnerables a la toma de control de subdominios. Todos ellos eran grandes marcas. ¬øHablando de phishing perfecto?

Sin embargo, las campa√±as de phishing recientes alojan contenido en dominios con nombres de dominio largos que incluyen el nombre de la marca (ver ejemplo de [Apple](https://www.phishtank.com/target\_search.php?target\_id=183\&valid=y\&active=All\&Search=Search)). Al tener un certificado SSL v√°lido (m√°s sobre eso a continuaci√≥n), una palabra clave en el nombre de dominio y un sitio web que imita el sitio web de la marca objetivo, las personas tienden a caer en estos ataques. Piensa en las posibilidades con un subdominio leg√≠timo de esta marca.

<figure><img src="/.gitbook/assets/image (3).png" alt=""><figcaption></figcaption></figure>

\
Usa [**Trickest**](https://trickest.io/) para construir y **automatizar flujos de trabajo** f√°cilmente con las herramientas comunitarias m√°s avanzadas del mundo.\
Obt√©n acceso hoy mismo:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

### Certificados SSL <a href="#certificadosssl" id="certificadosssl"></a>

El ataque anterior puede mejorarse generando un certificado SSL v√°lido. Las autoridades de certificaci√≥n como [_Let's Encrypt_](https://letsencrypt.org/) permiten la verificaci√≥n autom√°tica de la propiedad del dominio mediante la verificaci√≥n de contenido:

![Flujo de Let's Encrypt](https://0xpatrik.com/content/images/2018/05/letsencrypt.png)

Es decir, si hay un contenido espec√≠fico ubicado en una ruta de URL espec√≠fica, Let's Encrypt aprobar√° la emisi√≥n de un certificado para un determinado dominio. Dado que un atacante tiene control total sobre el contenido del dominio que es vulnerable a la toma de control de subdominios, esta verificaci√≥n se puede hacer en cuesti√≥n de minutos. Por lo tanto, los atacantes tambi√©n pueden generar un certificado SSL para dicho dominio, lo que reduce la sospecha de un ataque de phishing.

### Robo de cookies <a href="#robodecookies" id="robodecookies"></a>

Esto va de la mano con la transparencia del navegador pero tiene consecuencias diferentes. El navegador web implementa muchas pol√≠ticas de seguridad para evitar que los sitios web maliciosos causen da√±o. Esto incluye cosas como la [pol√≠tica de mismo origen](https://en.wikipedia.org/wiki/Same-origin\_policy). Una de las principales responsabilidades de seguridad de un navegador es proteger las cookies guardadas. ¬øPor qu√©? Si bien HTTP es un protocolo sin estado, las cookies se utilizan para realizar un seguimiento de las sesiones. Por conveniencia, los usuarios suelen guardar las cookies durante un per√≠odo prolongado para evitar iniciar sesi√≥n cada vez. Estas cookies, por lo tanto, act√∫an como un token de inicio de sesi√≥n que se presenta al servidor web y se identifica al usuario. Los ataques como el [_secuestro de sesi√≥n_](https://en.wikipedia.org/wiki/Session\_hijacking) evolucionaron naturalmente a partir de este concepto.

El navegador presenta autom√°ticamente las cookies almacenadas con cada solicitud al dominio que las emiti√≥. Existe una excepci√≥n a esto, de modo que las cookies pueden compartirse entre subdominios ([leer aqu√≠](https://tools.ietf.org/html/rfc6265#section-8.6), tambi√©n observa la secci√≥n 8.7). Esto suele ocurrir cuando el sitio web utiliza un sistema de inicio de sesi√≥n √∫nico basado en cookies ([SSO](https://en.wikipedia.org/wiki/Single\_sign-on)). Con SSO, un usuario puede iniciar sesi√≥n utilizando un subdominio y compartir el mismo token de sesi√≥n en una amplia gama de subdominios. La sintaxis para establecer una cookie regular es la siguiente:
```
HTTP/1.1 200 OK
Set-Cookie: name=value
```
Si esta cookie es emitida por un servidor web que reside en _example.com_, solo este servidor puede acceder a esta cookie m√°s adelante. Sin embargo, la cookie puede ser emitida para un dominio comod√≠n (por las razones explicadas anteriormente) de la siguiente manera:
```
HTTP/1.1 200 OK
Set-Cookie: name=value; domain=example.com
```
La cookie se incluir√° en las solicitudes HTTP a _example.com_, pero tambi√©n a cualquier otro subdominio como _subdominio.example.com_. Este comportamiento crea la posibilidad de ataques de alta gravedad utilizando la toma de subdominios. Supongamos que un dominio en particular est√° utilizando cookies de sesi√≥n para un dominio comod√≠n. Si hay un subdominio vulnerable a la toma de subdominios, lo √∫nico necesario para recopilar el token de sesi√≥n del usuario es enga√±arlo para que visite el subdominio vulnerable. La cookie de sesi√≥n se env√≠a autom√°ticamente con la solicitud HTTP.

El navegador tambi√©n implementa mecanismos de seguridad adicionales para las cookies:

* **Cookie HttpOnly** - Las cookies, por defecto, pueden ser accedidas por el c√≥digo Javascript que se ejecuta en el contexto del sitio web que cre√≥ las cookies. Javascript puede leer, actualizar y eliminar las cookies. La bandera de cookie _HttpOnly_ (establecida por el servidor web) indica que la cookie en particular no puede ser accedida por el c√≥digo Javascript. La √∫nica forma de obtenerla es a trav√©s de las cabeceras de solicitud y respuesta HTTP.
* **Cookie segura** - Cuando la cookie tiene la bandera _Secure_ establecida por el servidor web, solo puede ser comunicada de vuelta al servidor web si se utiliza HTTPS.

Si el dominio es vulnerable a la toma de subdominios, un atacante puede recopilar cookies emitidas por ese dominio en el pasado simplemente enga√±ando a los usuarios para que visiten ese sitio web. Las banderas HttpOnly y Secure no ayudan, ya que la cookie no se est√° accediendo mediante Javascript y el certificado SSL se puede generar f√°cilmente para el dominio tomado.

El robo de cookies utilizando la toma de subdominios fue explicado en un informe de recompensa por errores [aqu√≠](https://hackerone.com/reports/172137) por Arne Swinnen. El informe explica el problema con uno de los subdominios de _Ubiquiti Networks_ (_ping.ubnt.com_). Este subdominio era vulnerable a la toma de subdominios, apuntando a una distribuci√≥n no reclamada de AWS CloudFront. Dado que Ubiquiti Networks utiliza SSO con cookies de sesi√≥n comod√≠n, todos los usuarios que visiten _ping.ubnt.com_ podr√≠an tener sus cookies de sesi√≥n robadas. Aunque este dominio apunta a AWS CloudFront, la configuraci√≥n de la distribuci√≥n de CloudFront permite registrar cookies con cada solicitud. Por lo tanto, el escenario de extracci√≥n de cookies de sesi√≥n es completamente posible incluso con subdominios que apuntan a AWS CloudFront. En 2017, Arne tambi√©n demostr√≥ un vector de ataque similar contra el sistema SSO de [Uber](https://www.arneswinnen.net/2017/06/authentication-bypass-on-ubers-sso-via-subdomain-takeover/).

El comportamiento explicado anteriormente no se limita a las cookies. Dado que los scripts de Javascript tienen control total sobre los sitios web en los que se ejecutan, tener la capacidad de reemplazar dichos scripts en el sitio web leg√≠timo podr√≠a tener consecuencias catastr√≥ficas. Supongamos que un sitio web est√° utilizando c√≥digo Javascript de un proveedor externo utilizando la etiqueta _script_ y el atributo _src_. Cuando el dominio del proveedor externo caduca, el navegador falla silenciosamente, es decir, no activa ninguna alerta visible para los usuarios regulares. Si el c√≥digo externo no realiza ninguna tarea importante (por ejemplo, se utiliza solo para rastrear), dicho proveedor externo puede permanecer en el sitio web durante un per√≠odo prolongado. Un atacante puede tomar el control de este dominio caducado, coincidir con la ruta de URL del c√≥digo Javascript proporcionado y as√≠ obtener el control sobre cada visitante que visite el sitio web original.

Sin embargo, hay una forma de proteger la integridad de los archivos de Javascript en un navegador. _Subresource Integrity_ [fue propuesto](https://www.w3.org/TR/2016/REC-SRI-20160623/) como un mecanismo para incluir un hash criptogr√°fico como atributo _integrity_ en la etiqueta _script_ en HTML5. Cuando el hash criptogr√°fico proporcionado no coincide con el archivo descargado, el navegador se niega a ejecutarlo.

### Correos electr√≥nicos <a href="#emails" id="emails"></a>

Cuando es posible la toma de subdominios CNAME, los registros MX tambi√©n pueden configurarse por parte de un atacante en un servidor web arbitrario. Esto permite recibir correos electr√≥nicos en un subdominio leg√≠timo de una marca, lo cual es particularmente √∫til en ataques de (spear) phishing donde se requiere interacci√≥n entre el atacante y la v√≠ctima. Los atacantes suelen falsificar la cabecera `Return-Path` para recibir una respuesta al correo electr√≥nico. Con los registros MX correctos, se evita este problema.

Por otro lado, tambi√©n es posible enviar correos electr√≥nicos. Aunque es trivial falsificar la cabecera `From` para incluir cualquier direcci√≥n de correo electr√≥nico, los filtros SPF suelen verificar la cabecera `Return-Path` y los hosts permitidos para enviar correos electr√≥nicos para el dominio. SPF almacena la configuraci√≥n en registros TXT de DNS. Con la toma de subdominios, los registros TXT tambi√©n est√°n bajo el control del atacante, por lo que las verificaciones SPF se pueden pasar f√°cilmente.

_Como mencion√© al principio, estas t√°cticas generalmente no funcionan con la mayor√≠a de los proveedores de servicios en la nube, ya que no se tiene control directo sobre la zona DNS._

### Riesgos de orden superior <a href="#higherorderrisks" id="higherorderrisks"></a>

El concepto de toma de subdominios se puede extender naturalmente a los registros NS: si el dominio base de al menos un registro NS est√° disponible para su registro, el nombre de dominio de origen es vulnerable a la toma de subdominios.

Uno de los problemas en la toma de subdominios utilizando registros NS es que el nombre de dominio de origen generalmente tiene m√∫ltiples registros NS. Se utilizan m√∫ltiples registros NS para redundancia y equilibrio de carga. El servidor de nombres se elige al azar antes de la resoluci√≥n DNS. Supongamos que el dominio _sub.example.com_ tiene dos registros NS: _ns.vulnerable.com_ y _ns.nonvulnerable.com_. Si un atacante toma el control de _ns.vulnerable.com_, la situaci√≥n desde la perspectiva del usuario que consulta _sub.example.com_ es la siguiente:

1. Dado que hay dos servidores de nombres, se elige uno al azar. Esto significa que la probabilidad de consultar un servidor de nombres controlado por un atacante es del 50%.
2. Si el resolutor DNS del usuario elige _ns.nonvulnerable.com_ (servidor de nombres leg√≠timo), se devuelve el resultado correcto y es probable que se almacene en cach√© en alg√∫n lugar entre 6 y 24 horas.
3. Si el resolutor DNS del usuario elige _ns.vulnerable.com_ (servidor de nombres propiedad de un atacante), un atacante puede proporcionar un resultado falso que tambi√©n se almacenar√° en cach√©. Dado que el atacante tiene el control del servidor de nombres, puede establecer el TTL para este resultado en particular, por ejemplo, una semana.

El proceso anterior se repite cada vez que caduca la entrada de cach√©. Cuando un atacante elige utilizar un TTL con un valor alto, el resultado falso permanecer√° en la cach√© DNS durante ese per√≠odo. Durante este tiempo, todas las solicitudes a _sub.example.com_ utilizar√°n el resultado DNS falso almacenado en cach√© por el atacante. Esta idea se amplifica a√∫n m√°s cuando se utilizan resolutores DNS p√∫blicos (por ejemplo, Google DNS). En este caso, es probable que los resolutores p√∫blicos almacenen en cach√© los resultados falsos, lo que significa que todos los usuarios que utilicen el mismo resolutor DNS obtendr√°n resultados falsos hasta que se revoque la cach√©.

Adem√°s del control sobre el nombre de dominio de origen, tambi√©n se obtiene el control sobre todos los dominios de nivel superior del nombre de dominio de origen. Esto se debe a que ser due√±o de un nombre de dominio can√≥nico de un registro NS significa ser due√±o de la zona DNS completa del nombre de dominio de origen.

En 2016, Matthew Bryant [demostr√≥](https://thehackerblog.com/the-international-incident-gaining-control-of-a-int-domain-name-with-dns-trickery/index.html) una toma de subdominios utilizando un registro NS en _maris.int_. El dominio de nivel superior .INT es un TLD especial y solo unos pocos dominios lo utilizan. Bryant mostr√≥ que aunque el registro de dichos nombres de dominio est√° aprobado exclusivamente por IANA, los servidores de nombres se pueden configurar en dominios arbitrarios. Dado que uno de los servidores de nombres de _maris.int_ estaba disponible para su registro (_cobalt.aliis.be_), fue posible la toma de subdominios incluso en este TLD restringido.

Matthew tambi√©n [demostr√≥](https://thehackerblog.com/the-io-error-taking-control-of-all-io-domains-with-a-targeted-registration/index.html) un ataque de mayor gravedad donde pudo obtener el control sobre el servidor de nombres del dominio de nivel superior .IO. Obtener el control sobre .IO significa controlar las respuestas para todos los nombres de dominio .IO. En este caso, uno de los servidores de nombres de .IO era _ns-a1.io_, que estaba disponible para su registro. Al registrar _ns-a1.io_, Bryant pudo recibir consultas DNS y controlar sus respuestas para todos los dominios .IO.
### Mitigaci√≥n <a href="#mitigaci√≥n" id="mitigaci√≥n"></a>

Las estrategias de mitigaci√≥n para los nombres de dominio que ya son vulnerables a la toma de subdominios son bastante sencillas:

* **Eliminar el registro DNS afectado** - La soluci√≥n m√°s simple es eliminar el registro afectado de la zona DNS. Este paso se suele utilizar si la organizaci√≥n concluye que el nombre de dominio fuente afectado ya no es necesario.
* **Reclamar el nombre de dominio** - Esto significa registrar el recurso en un proveedor de nube en particular o, en el caso de un dominio de Internet regular, volver a comprar el dominio caducado.

Para prevenir la toma de subdominios en el futuro, las organizaciones deben cambiar el proceso de creaci√≥n y destrucci√≥n de recursos en su infraestructura. En el caso de la creaci√≥n de recursos, la creaci√≥n del registro DNS debe ser el _√∫ltimo paso_ de este proceso. Esta condici√≥n evita que el registro DNS apunte a un dominio que no existe en ning√∫n momento. Para la destrucci√≥n de recursos, se aplica lo contrario: el registro DNS debe eliminarse como el _primer paso_ en este proceso. Herramientas como [aquatone](https://github.com/michenriksen/aquatone) incluyen comprobaciones de toma de subdominios. Estas comprobaciones deben realizarse peri√≥dicamente por parte del equipo de seguridad de una organizaci√≥n para verificar que no haya dominios vulnerables. Los procesos de recopilaci√≥n centralizada de nombres de dominio expuestos a menudo no son eficientes dentro de las organizaciones (debido a equipos globales, etc.) y, por lo general, la monitorizaci√≥n externa es la mejor opci√≥n.

Tambi√©n se debe considerar la estrategia de mitigaci√≥n para los proveedores de servicios en la nube. Los servicios en la nube no verifican la propiedad del dominio. La raz√≥n detr√°s de esto es principalmente la comodidad. El proveedor de la nube no introduce ninguna vulnerabilidad al no verificar la propiedad de un nombre de dominio fuente. Por lo tanto, depende del usuario supervisar sus registros DNS. Otra raz√≥n es que cuando se elimina un recurso en la nube, el usuario generalmente deja de ser cliente de ese servicio. Entonces, la pregunta que se hacen los proveedores de servicios en la nube es: ¬øPor qu√© deber√≠amos preocuparnos?

Proveedores como [GitLab](https://about.gitlab.com/2018/02/05/gitlab-pages-custom-domain-validation/) se dieron cuenta de que la toma de subdominios es un problema e implementaron un mecanismo de verificaci√≥n de dominio.

_Algunas partes de esta publicaci√≥n son extractos de mi_ [_Tesis de Maestr√≠a_](https://is.muni.cz/th/byrdn/Thesis.pdf).

¬°Hasta la pr√≥xima!

[Patrik](https://twitter.com/0xpatrik)

<figure><img src="/.gitbook/assets/image (3).png" alt=""><figcaption></figcaption></figure>

\
Utiliza [**Trickest**](https://trickest.io/) para construir y **automatizar flujos de trabajo** con las herramientas comunitarias m√°s avanzadas del mundo.\
Obt√©n acceso hoy mismo:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* ¬øTrabajas en una **empresa de ciberseguridad**? ¬øQuieres que tu **empresa sea anunciada en HackTricks**? ¬øO quieres tener acceso a la **√∫ltima versi√≥n de PEASS o descargar HackTricks en PDF**? ¬°Consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obt√©n el [**merchandising oficial de PEASS y HackTricks**](https://peass.creator-spring.com)
* **√önete al** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de Telegram**](https://t.me/peass) o **s√≠gueme** en **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Comparte tus trucos de hacking enviando PRs al** [**repositorio de hacktricks**](https://github.com/carlospolop/hacktricks) **y al** [**repositorio de hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
