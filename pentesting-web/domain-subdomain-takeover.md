# Prise de contr√¥le de domaine/sous-domaine

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Travaillez-vous dans une **entreprise de cybers√©curit√©** ? Voulez-vous voir votre **entreprise annonc√©e dans HackTricks** ? ou voulez-vous avoir acc√®s √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**üí¨**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR au** [**repo hacktricks**](https://github.com/carlospolop/hacktricks) **et au** [**repo hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

![](<../.gitbook/assets/image (9) (1) (2).png>)

\
Utilisez [**Trickest**](https://trickest.io/) pour cr√©er et **automatiser des workflows** aliment√©s par les outils communautaires les plus avanc√©s au monde.\
Obtenez l'acc√®s aujourd'hui :

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## Prise de contr√¥le de domaine

Si vous d√©couvrez un domaine (domaine.tld) qui est **utilis√© par un service dans le cadre** mais que l'**entreprise** a **perdu la propri√©t√©** de celui-ci, vous pouvez essayer de **l'enregistrer** (si c'est assez bon march√©) et informer l'entreprise. Si ce domaine re√ßoit des **informations sensibles** telles qu'un cookie de session via un **param√®tre GET** ou dans l'en-t√™te **Referer**, cela constitue une **vuln√©rabilit√©**.

### Prise de contr√¥le de sous-domaine

Un sous-domaine de l'entreprise pointe vers un **service tiers avec un nom non enregistr√©**. Si vous pouvez **cr√©er** un **compte** dans ce **service tiers** et **enregistrer** le **nom** en cours d'utilisation, vous pouvez effectuer la prise de contr√¥le de sous-domaine.

Il existe plusieurs outils avec des dictionnaires pour v√©rifier les prises de contr√¥le possibles :

* [https://github.com/EdOverflow/can-i-take-over-xyz](https://github.com/EdOverflow/can-i-take-over-xyz)
* [https://github.com/blacklanternsecurity/bbot](https://github.com/blacklanternsecurity/bbot)
* [https://github.com/punk-security/dnsReaper](https://github.com/punk-security/dnsReaper)
* [https://github.com/haccer/subjack](https://github.com/haccer/subjack)
* [https://github.com/anshumanbh/tko-sub](https://github.com/anshumanbh/tko-subs)
* [https://github.com/ArifulProt
```
HTTP/1.1 200 OK
Set-Cookie: name=value
```
Si ce cookie est √©mis par un serveur web r√©sidant sur _example.com_, seul ce serveur peut y acc√©der ult√©rieurement. Cependant, le cookie peut √™tre √©mis pour un domaine g√©n√©rique (pour les raisons expliqu√©es ci-dessus) de la mani√®re suivante :
```
HTTP/1.1 200 OK
Set-Cookie: name=value; domain=example.com
```
Le cookie sera inclus dans les requ√™tes HTTP vers _example.com_ mais √©galement vers tout autre sous-domaine tel que _subdomain.example.com_. Ce comportement cr√©e une possibilit√© d'attaques de gravit√© √©lev√©e en utilisant la prise en charge de sous-domaine. Supposons qu'un domaine particulier utilise des cookies de session pour un domaine g√©n√©rique. S'il y a un sous-domaine vuln√©rable √† la prise en charge de sous-domaine, la seule chose √† faire pour recueillir le jeton de session de l'utilisateur est de le tromper en visitant le sous-domaine vuln√©rable. Le cookie de session est automatiquement envoy√© avec la requ√™te HTTP.

Le navigateur impl√©mente √©galement des m√©canismes de s√©curit√© suppl√©mentaires pour les cookies :

* **Cookie HttpOnly** - Les cookies peuvent par d√©faut √™tre accessibles par le code Javascript s'ex√©cutant dans le contexte du site Web qui a cr√©√© les cookies. Javascript peut lire, mettre √† jour et supprimer les cookies. Le drapeau de cookie _HttpOnly_ (d√©fini par le serveur Web) indique que le cookie particulier ne peut pas √™tre acc√©d√© par le code Javascript. La seule fa√ßon de l'obtenir est par le biais des en-t√™tes de requ√™te et de r√©ponse HTTP.
* **Cookie s√©curis√©** - Lorsque le cookie a le drapeau _Secure_ d√©fini par le serveur Web, il peut √™tre communiqu√© de nouveau au serveur Web uniquement si HTTPS est utilis√©.

Si le domaine est vuln√©rable √† la prise en charge de sous-domaine, un attaquant peut recueillir des cookies √©mis par ce domaine dans le pass√© en trompant les utilisateurs pour qu'ils visitent ce site Web. Les drapeaux HttpOnly et Secure ne sont pas utiles car le cookie n'est pas acc√©d√© √† l'aide de Javascript et le certificat SSL peut √™tre facilement g√©n√©r√© pour le domaine pris.

Le vol de cookies en utilisant la prise en charge a √©t√© expliqu√© dans le rapport de prime de bogues [report](https://hackerone.com/reports/172137) par Arne Swinnen. Le rapport explique le probl√®me avec l'un des sous-domaines de _Ubiquiti Networks_ (_ping.ubnt.com_). Ce sous-domaine √©tait vuln√©rable √† la prise en charge de sous-domaine, pointant vers une distribution AWS CloudFront non r√©clam√©e. √âtant donn√© qu'Ubiquiti Networks utilise SSO avec des cookies de session g√©n√©riques, tous les utilisateurs visitant _ping.ubnt.com_ pourraient avoir leurs cookies de session vol√©s. M√™me si ce domaine pointe vers AWS CloudFront, les param√®tres de distribution de CloudFront permettent de journaliser les cookies avec chaque requ√™te. Par cons√©quent, le sc√©nario d'extraction de cookies de session est enti√®rement possible m√™me avec des sous-domaines pointant vers AWS CloudFront. En 2017, Arne a √©galement d√©montr√© un vecteur d'attaque similaire contre le syst√®me SSO d'[Uber](https://www.arneswinnen.net/2017/06/authentication-bypass-on-ubers-sso-via-subdomain-takeover/).

Le comportement expliqu√© ci-dessus ne se limite pas aux cookies. √âtant donn√© que les scripts Javascript ont un contr√¥le total sur les sites Web sur lesquels ils sont ex√©cut√©s, la capacit√© de remplacer de tels scripts sur le site Web l√©gitime pourrait entra√Æner des cons√©quences catastrophiques. Supposons que le site Web utilise du code Javascript provenant du fournisseur externe √† l'aide de la balise _script_ et de l'attribut _src_. Lorsque le domaine du fournisseur externe expire, le navigateur √©choue silencieusement, c'est-√†-dire qu'il ne d√©clenche pas d'alertes visibles pour les utilisateurs r√©guliers. Si le code externe ne fait rien d'important (par exemple, il est utilis√© uniquement pour le suivi), un tel fournisseur externe peut rester sur le site Web pendant une p√©riode prolong√©e. Un attaquant peut prendre le contr√¥le de ce domaine expir√©, faire correspondre le chemin d'URL du code Javascript fourni et ainsi prendre le contr√¥le de chaque visiteur qui visite le site Web d'origine.

Il existe cependant un moyen de prot√©ger l'int√©grit√© des fichiers Javascript dans un navigateur. _Subresource Integrity_ [a √©t√© propos√©](https://www.w3.org/TR/2016/REC-SRI-20160623/) comme m√©canisme pour inclure le hachage cryptographique en tant qu'attribut _integrity_ √† la balise _script_ dans HTML5. Lorsque le hachage cryptographique fourni ne correspond pas au fichier de t√©l√©chargement, le navigateur refuse de l'ex√©cuter.

### E-mails <a href="#emails" id="emails"></a>

Lorsque la prise en charge de sous-domaine CNAME est possible, des enregistrements MX peuvent √©galement √™tre configur√©s par un attaquant vers un serveur Web arbitraire. Cela permet de recevoir des e-mails sur un sous-domaine l√©gitime d'une certaine marque - particuli√®rement utile √† nouveau dans les attaques de (spear) phishing o√π l'interaction entre un attaquant et une victime est n√©cessaire. Les attaquants falsifient g√©n√©ralement l'en-t√™te `Return-Path` pour recevoir
