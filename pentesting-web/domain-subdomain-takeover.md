# Domain/Subdomain takeover

{% hint style="success" %}
Μάθετε & εξασκηθείτε στο AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Μάθετε & εξασκηθείτε στο GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Υποστήριξη HackTricks</summary>

* Ελέγξτε τα [**σχέδια συνδρομής**](https://github.com/sponsors/carlospolop)!
* **Εγγραφείτε στην** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε κόλπα hacking υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

<figure><img src="../.gitbook/assets/image (48).png" alt=""><figcaption></figcaption></figure>

\
Χρησιμοποιήστε [**Trickest**](https://trickest.com/?utm_source=hacktricks&utm_medium=text&utm_campaign=ppc&utm_term=trickest&utm_content=domain-subdomain-takeover) για να δημιουργήσετε και να **αυτοματοποιήσετε ροές εργασίας** που υποστηρίζονται από τα **πιο προηγμένα** εργαλεία της κοινότητας.\
Αποκτήστε πρόσβαση σήμερα:

{% embed url="https://trickest.com/?utm_source=hacktricks&utm_medium=banner&utm_campaign=ppc&utm_content=domain-subdomain-takeover" %}

## Domain takeover

Αν ανακαλύψετε κάποιο domain (domain.tld) που **χρησιμοποιείται από κάποια υπηρεσία εντός του πεδίου** αλλά η **εταιρεία** έχει **χάσει την ιδιοκτησία** του, μπορείτε να προσπαθήσετε να το **καταχωρήσετε** (αν είναι αρκετά φθηνό) και να ενημερώσετε την εταιρεία. Αν αυτό το domain λαμβάνει κάποια **ευαίσθητη πληροφορία** όπως ένα cookie συνεδρίας μέσω **GET** παραμέτρου ή στην **Referer** κεφαλίδα, αυτό είναι σίγουρα μια **ευπάθεια**.

### Subdomain takeover

Ένα subdomain της εταιρείας δείχνει σε μια **υπηρεσία τρίτου μέρους με όνομα που δεν είναι καταχωρημένο**. Αν μπορείτε να **δημιουργήσετε** έναν **λογαριασμό** σε αυτή την **υπηρεσία τρίτου μέρους** και να **καταχωρήσετε** το **όνομα** που είναι σε χρήση, μπορείτε να εκτελέσετε την ανάληψη του subdomain.

Υπάρχουν διάφορα εργαλεία με λεξικά για να ελέγξετε πιθανές αναλήψεις:

* [https://github.com/EdOverflow/can-i-take-over-xyz](https://github.com/EdOverflow/can-i-take-over-xyz)
* [https://github.com/blacklanternsecurity/bbot](https://github.com/blacklanternsecurity/bbot)
* [https://github.com/punk-security/dnsReaper](https://github.com/punk-security/dnsReaper)
* [https://github.com/haccer/subjack](https://github.com/haccer/subjack)
* [https://github.com/anshumanbh/tko-sub](https://github.com/anshumanbh/tko-subs)
* [https://github.com/ArifulProtik/sub-domain-takeover](https://github.com/ArifulProtik/sub-domain-takeover)
* [https://github.com/SaadAhmedx/Subdomain-Takeover](https://github.com/SaadAhmedx/Subdomain-Takeover)
* [https://github.com/Ice3man543/SubOver](https://github.com/Ice3man543/SubOver)
* [https://github.com/m4ll0k/takeover](https://github.com/m4ll0k/takeover)
* [https://github.com/antichown/subdomain-takeover](https://github.com/antichown/subdomain-takeover)
* [https://github.com/musana/mx-takeover](https://github.com/musana/mx-takeover)
* [https://github.com/PentestPad/subzy](https://github.com/PentestPad/subzy)

#### Σάρωση για Hijackable Subdomains με [BBOT](https://github.com/blacklanternsecurity/bbot):

Οι έλεγχοι ανάληψης subdomain περιλαμβάνονται στην προεπιλεγμένη αρίθμηση subdomain του BBOT. Οι υπογραφές αντλούνται απευθείας από [https://github.com/EdOverflow/can-i-take-over-xyz](https://github.com/EdOverflow/can-i-take-over-xyz).
```bash
bbot -t evilcorp.com -f subdomain-enum
```
### Υποτομέας Takeover μέσω Wildcard DNS

Όταν χρησιμοποιείται wildcard DNS σε έναν τομέα, οποιοσδήποτε ζητούμενος υποτομέας αυτού του τομέα που δεν έχει διαφορετική διεύθυνση ρητά θα **επιλύεται στην ίδια πληροφορία**. Αυτό θα μπορούσε να είναι μια διεύθυνση IP A, ένα CNAME...

Για παράδειγμα, αν το `*.testing.com` είναι wildcarded στο `1.1.1.1`. Τότε, το `not-existent.testing.com` θα δείχνει στο `1.1.1.1`.

Ωστόσο, αν αντί να δείχνει σε μια διεύθυνση IP, ο διαχειριστής συστήματος το δείξει σε μια **υπηρεσία τρίτου μέρους μέσω CNAME**, όπως ένα **subdomain github** για παράδειγμα (`sohomdatta1.github.io`). Ένας επιτιθέμενος θα μπορούσε να **δημιουργήσει τη δική του σελίδα τρίτου μέρους** (στο GitHub σε αυτή την περίπτωση) και να πει ότι το `something.testing.com` δείχνει εκεί. Επειδή, το **CNAME wildcard** θα συμφωνήσει, ο επιτιθέμενος θα είναι σε θέση να **δημιουργήσει αυθαίρετους υποτομείς για τον τομέα του θύματος που δείχνουν στις σελίδες του**.

Μπορείτε να βρείτε ένα παράδειγμα αυτής της ευπάθειας στην αναφορά CTF: [https://ctf.zeyu2001.com/2022/nitectf-2022/undocumented-js-api](https://ctf.zeyu2001.com/2022/nitectf-2022/undocumented-js-api)

## Εκμετάλλευση ενός υποτομέα takeover

Η εκμετάλλευση υποτομέα takeover είναι ουσιαστικά spoofing DNS για έναν συγκεκριμένο τομέα στο διαδίκτυο, επιτρέποντας στους επιτιθέμενους να ορίσουν A records για έναν τομέα, οδηγώντας τους περιηγητές να εμφανίζουν περιεχόμενο από τον διακομιστή του επιτιθέμενου. Αυτή η **διαφάνεια** στους περιηγητές καθιστά τους τομείς επιρρεπείς σε phishing. Οι επιτιθέμενοι μπορεί να χρησιμοποιήσουν [_typosquatting_](https://en.wikipedia.org/wiki/Typosquatting) ή [_Doppelganger domains_](https://en.wikipedia.org/wiki/Doppelg%C3%A4nger) για αυτόν τον σκοπό. Ιδιαίτερα ευάλωτοι είναι οι τομείς όπου το URL σε ένα phishing email φαίνεται νόμιμο, παραπλανώντας τους χρήστες και αποφεύγοντας τα φίλτρα spam λόγω της εγγενής εμπιστοσύνης του τομέα.

Δείτε αυτή την [ανάρτηση για περισσότερες λεπτομέρειες](https://0xpatrik.com/subdomain-takeover/)

### **Πιστοποιητικά SSL**

Τα πιστοποιητικά SSL, αν παραχθούν από επιτιθέμενους μέσω υπηρεσιών όπως [_Let's Encrypt_](https://letsencrypt.org/), προσθέτουν στην νομιμότητα αυτών των ψεύτικων τομέων, καθιστώντας τις επιθέσεις phishing πιο πειστικές.

### **Ασφάλεια Cookies και Διαφάνεια Περιηγητών**

Η διαφάνεια των περιηγητών επεκτείνεται επίσης στην ασφάλεια των cookies, που διέπεται από πολιτικές όπως η [Same-origin policy](https://en.wikipedia.org/wiki/Same-origin_policy). Τα cookies, που χρησιμοποιούνται συχνά για τη διαχείριση συνεδριών και την αποθήκευση tokens σύνδεσης, μπορούν να εκμεταλλευτούν μέσω υποτομέα takeover. Οι επιτιθέμενοι μπορούν να **συγκεντρώσουν cookies συνεδρίας** απλά κατευθύνοντας τους χρήστες σε έναν συμβιβασμένο υποτομέα, θέτοντας σε κίνδυνο τα δεδομένα και την ιδιωτικότητα των χρηστών.

### **Emails και Υποτομέας Takeover**

Μια άλλη πτυχή του υποτομέα takeover περιλαμβάνει τις υπηρεσίες email. Οι επιτιθέμενοι μπορούν να χειριστούν **MX records** για να λαμβάνουν ή να στέλνουν emails από έναν νόμιμο υποτομέα, ενισχύοντας την αποτελεσματικότητα των επιθέσεων phishing.

### **Κίνδυνοι Υψηλότερης Τάξης**

Περαιτέρω κίνδυνοι περιλαμβάνουν **NS record takeover**. Αν ένας επιτιθέμενος αποκτήσει έλεγχο σε ένα NS record ενός τομέα, μπορεί δυνητικά να κατευθύνει ένα μέρος της κίνησης σε έναν διακομιστή υπό τον έλεγχό του. Αυτός ο κίνδυνος ενισχύεται αν ο επιτιθέμενος ορίσει έναν υψηλό **TTL (Time to Live)** για τα DNS records, παρατείνοντας τη διάρκεια της επίθεσης.

### Ευπάθεια CNAME Record

Οι επιτιθέμενοι μπορεί να εκμεταλλευτούν μη διεκδικούμενα CNAME records που δείχνουν σε εξωτερικές υπηρεσίες που δεν χρησιμοποιούνται πλέον ή έχουν αποσυρθεί. Αυτό τους επιτρέπει να δημιουργήσουν μια σελίδα υπό τον αξιόπιστο τομέα, διευκολύνοντας περαιτέρω το phishing ή τη διανομή κακόβουλου λογισμικού.

### **Στρατηγικές Μείωσης Κινδύνου**

Οι στρατηγικές μείωσης κινδύνου περιλαμβάνουν:

1. **Αφαίρεση ευάλωτων DNS records** - Αυτό είναι αποτελεσματικό αν ο υποτομέας δεν απαιτείται πλέον.
2. **Διεκδίκηση του ονόματος τομέα** - Καταχώρηση του πόρου με τον αντίστοιχο πάροχο cloud ή επαναγορά ενός ληγμένου τομέα.
3. **Τακτική παρακολούθηση για ευπάθειες** - Εργαλεία όπως το [aquatone](https://github.com/michenriksen/aquatone) μπορούν να βοηθήσουν στην αναγνώριση ευάλωτων τομέων. Οι οργανισμοί θα πρέπει επίσης να αναθεωρήσουν τις διαδικασίες διαχείρισης υποδομών τους, διασφαλίζοντας ότι η δημιουργία DNS records είναι το τελευταίο βήμα στη δημιουργία πόρων και το πρώτο βήμα στην καταστροφή πόρων.

Για τους παρόχους cloud, η επαλήθευση της ιδιοκτησίας του τομέα είναι κρίσιμη για την αποτροπή υποτομέα takeovers. Ορισμένοι, όπως [GitLab](https://about.gitlab.com/2018/02/05/gitlab-pages-custom-domain-validation/), έχουν αναγνωρίσει αυτό το ζήτημα και έχουν εφαρμόσει μηχανισμούς επαλήθευσης τομέα.

## Αναφορές

* [https://0xpatrik.com/subdomain-takeover/](https://0xpatrik.com/subdomain-takeover/)

<figure><img src="../.gitbook/assets/image (48).png" alt=""><figcaption></figcaption></figure>

\
Χρησιμοποιήστε [**Trickest**](https://trickest.com/?utm_source=hacktricks&utm_medium=text&utm_campaign=ppc&utm_term=trickest&utm_content=domain-subdomain-takeover) για να δημιουργήσετε και να ** αυτοματοποιήσετε ροές εργασίας** που υποστηρίζονται από τα **πιο προηγμένα** εργαλεία της κοινότητας.\
Αποκτήστε πρόσβαση σήμερα:

{% embed url="https://trickest.com/?utm_source=hacktricks&utm_medium=banner&utm_campaign=ppc&utm_content=domain-subdomain-takeover" %}

{% hint style="success" %}
Μάθετε & εξασκηθείτε στο AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Μάθετε & εξασκηθείτε στο GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Υποστήριξη HackTricks</summary>

* Ελέγξτε τα [**σχέδια συνδρομής**](https://github.com/sponsors/carlospolop)!
* **Εγγραφείτε στην** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Μοιραστείτε κόλπα hacking υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
