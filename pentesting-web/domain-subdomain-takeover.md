# Domain/Subdomain √úbernahme

<details>

<summary><strong>Erlernen Sie AWS-Hacking von Grund auf mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks beworben sehen m√∂chten** oder **HackTricks im PDF-Format herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merchandise**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositories einreichen.

</details>

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
Verwenden Sie [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks), um m√ºhelos **Workflows zu erstellen und zu automatisieren**, die von den weltweit **fortschrittlichsten Community-Tools** unterst√ºtzt werden.\
Heute Zugriff erhalten:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## Domain-√úbernahme

Wenn Sie eine Domain (domain.tld) entdecken, die **von einem Dienst innerhalb des Geltungsbereichs verwendet wird**, aber das **Unternehmen** die **Eigent√ºmerschaft** daran verloren hat, k√∂nnen Sie versuchen, sie zu **registrieren** (wenn sie billig genug ist) und dem Unternehmen Bescheid geben. Wenn √ºber diese Domain **sensible Informationen** wie ein Sitzungscookie √ºber **GET**-Parameter oder im **Referer**-Header empfangen werden, handelt es sich mit Sicherheit um eine **Schwachstelle**.

### Subdomain-√úbernahme

Eine Subdomain des Unternehmens verweist auf einen **Drittanbieterdienst mit einem nicht registrierten Namen**. Wenn Sie ein **Konto** in diesem **Drittanbieterdienst erstellen** und den **verwendeten Namen registrieren** k√∂nnen, k√∂nnen Sie die Subdomain-√úbernahme durchf√ºhren.

Es gibt mehrere Tools mit W√∂rterb√ºchern, um m√∂gliche √úbernahmen zu √ºberpr√ºfen:

* [https://github.com/EdOverflow/can-i-take-over-xyz](https://github.com/EdOverflow/can-i-take-over-xyz)
* [https://github.com/blacklanternsecurity/bbot](https://github.com/blacklanternsecurity/bbot)
* [https://github.com/punk-security/dnsReaper](https://github.com/punk-security/dnsReaper)
* [https://github.com/haccer/subjack](https://github.com/haccer/subjack)
* [https://github.com/anshumanbh/tko-sub](https://github.com/anshumanbh/tko-subs)
* [https://github.com/ArifulProtik/sub-domain-takeover](https://github.com/ArifulProtik/sub-domain-takeover)
* [https://github.com/SaadAhmedx/Subdomain-Takeover](https://github.com/SaadAhmedx/Subdomain-Takeover)
* [https://github.com/Ice3man543/SubOver](https://github.com/Ice3man543/SubOver)
* [https://github.com/m4ll0k/takeover](https://github.com/m4ll0k/takeover)
* [https://github.com/antichown/subdomain-takeover](https://github.com/antichown/subdomain-takeover)
* [https://github.com/musana/mx-takeover](https://github.com/musana/mx-takeover)
* [https://github.com/PentestPad/subzy](https://github.com/PentestPad/subzy)

#### Scannen nach √ºbernehmbaren Subdomains mit [BBOT](https://github.com/blacklanternsecurity/bbot):

Subdomain-√úbernahmepr√ºfungen sind in der Standard-Subdomain-Enumeration von BBOT enthalten. Signaturen werden direkt von [https://github.com/EdOverflow/can-i-take-over-xyz](https://github.com/EdOverflow/can-i-take-over-xyz) abgerufen.
```bash
bbot -t evilcorp.com -f subdomain-enum
```
### Subdomain Takeover Generation via DNS Wildcard

Wenn ein DNS-Wildcard in einer Domain verwendet wird, wird jeder angeforderte Subdomain dieser Domain, der nicht explizit eine andere Adresse hat, **auf die gleichen Informationen aufgel√∂st**. Dies k√∂nnte eine A-IP-Adresse, ein CNAME...

Zum Beispiel, wenn `*.testing.com` auf `1.1.1.1` wildgekennzeichnet ist. Dann wird `not-existent.testing.com` auf `1.1.1.1` zeigen.

Wenn jedoch anstelle einer IP-Adresse der Sysadmin es auf einen **Drittanbieterdienst √ºber CNAME** zeigt, wie z.B. ein **Github-Subdomain** (`sohomdatta1.github.io`). Ein Angreifer k√∂nnte **seine eigene Drittanbieterseite** (in diesem Fall auf Github) erstellen und behaupten, dass `something.testing.com` dorthin zeigt. Da das **CNAME-Wildcard** zustimmt, wird der Angreifer in der Lage sein, **beliebige Subdomains f√ºr die Domain des Opfers zu generieren, die auf seine Seiten zeigen**.

Ein Beispiel f√ºr diese Schwachstelle finden Sie im CTF-Bericht: [https://ctf.zeyu2001.com/2022/nitectf-2022/undocumented-js-api](https://ctf.zeyu2001.com/2022/nitectf-2022/undocumented-js-api)

## Ausnutzen eines Subdomain Takeovers

Ein Subdomain Takeover ist im Wesentlichen ein DNS-Spoofing f√ºr eine spezifische Domain im gesamten Internet, das es Angreifern erm√∂glicht, A-Records f√ºr eine Domain festzulegen, was dazu f√ºhrt, dass Browser Inhalte vom Server des Angreifers anzeigen. Diese **Transparenz** in Browsern macht Domains anf√§llig f√ºr Phishing. Angreifer k√∂nnen [_Typosquatting_](https://en.wikipedia.org/wiki/Typosquatting) oder [_Doppelg√§nger-Domains_](https://en.wikipedia.org/wiki/Doppelg%C3%A4nger) f√ºr diesen Zweck nutzen. Besonders anf√§llig sind Domains, bei denen die URL in einer Phishing-E-Mail legitim erscheint, Benutzer t√§uscht und Spamfilter aufgrund des inh√§renten Vertrauens der Domain umgeht.

Weitere Details finden Sie in diesem [Beitrag](https://0xpatrik.com/subdomain-takeover/)

### **SSL-Zertifikate**
SSL-Zertifikate, die von Angreifern √ºber Dienste wie [_Let's Encrypt_](https://letsencrypt.org/) generiert werden, tragen zur Legitimit√§t dieser gef√§lschten Domains bei und machen Phishing-Angriffe √ºberzeugender.

### **Cookie-Sicherheit und Browser-Transparenz**
Die Browser-Transparenz erstreckt sich auch auf die Cookie-Sicherheit, die durch Richtlinien wie die [Same-origin policy](https://en.wikipedia.org/wiki/Same-origin_policy) geregelt wird. Cookies, die h√§ufig zur Verwaltung von Sitzungen und Speicherung von Anmeldetoken verwendet werden, k√∂nnen durch Subdomain Takeover ausgenutzt werden. Angreifer k√∂nnen **Sitzungscookies sammeln**, indem sie Benutzer einfach auf eine kompromittierte Subdomain umleiten, wodurch Benutzerdaten und Privatsph√§re gef√§hrdet werden.

### **E-Mails und Subdomain Takeover**
Ein weiterer Aspekt des Subdomain Takeovers betrifft E-Mail-Dienste. Angreifer k√∂nnen **MX-Records** manipulieren, um E-Mails von einer legitimen Subdomain zu empfangen oder zu senden, was die Wirksamkeit von Phishing-Angriffen erh√∂ht.

### **Risiken h√∂herer Ordnung**
Weitere Risiken umfassen **NS-Record Takeover**. Wenn ein Angreifer die Kontrolle √ºber einen NS-Record einer Domain erlangt, kann er potenziell einen Teil des Datenverkehrs zu einem Server unter seiner Kontrolle leiten. Dieses Risiko wird verst√§rkt, wenn der Angreifer eine hohe **TTL (Time to Live)** f√ºr DNS-Eintr√§ge festlegt, wodurch die Dauer des Angriffs verl√§ngert wird.

### CNAME-Record-Schwachstelle
Angreifer k√∂nnten ungenutzte CNAME-Records ausnutzen, die auf externe Dienste verweisen, die nicht mehr verwendet werden oder au√üer Betrieb genommen wurden. Dies erm√∂glicht es ihnen, eine Seite unter der vertrauensw√ºrdigen Domain zu erstellen, was Phishing oder die Verteilung von Malware weiter erleichtert.

### **Strategien zur Risikominderung**
Strategien zur Risikominderung umfassen:
1. **Entfernen von anf√§lligen DNS-Eintr√§gen** - Dies ist wirksam, wenn die Subdomain nicht mehr ben√∂tigt wird.
2. **Beanspruchung des Domainnamens** - Registrierung der Ressource beim jeweiligen Cloud-Anbieter oder erneutes Kaufen einer abgelaufenen Domain.
3. **Regelm√§√üige √úberwachung auf Schwachstellen** - Tools wie [aquatone](https://github.com/michenriksen/aquatone) k√∂nnen anf√§llige Domains identifizieren. Organisationen sollten auch ihre Infrastrukturverwaltungsprozesse √ºberpr√ºfen, um sicherzustellen, dass die Erstellung von DNS-Eintr√§gen der letzte Schritt bei der Ressourcenerstellung und der erste Schritt bei der Ressourcenzerst√∂rung ist.

F√ºr Cloud-Anbieter ist die √úberpr√ºfung des Domainbesitzes entscheidend, um Subdomain Takeovers zu verhindern. Einige, wie [GitLab](https://about.gitlab.com/2018/02/05/gitlab-pages-custom-domain-validation/), haben dieses Problem erkannt und Mechanismen zur Domain√ºberpr√ºfung implementiert.

## Referenzen
* [https://0xpatrik.com/subdomain-takeover/](https://0xpatrik.com/subdomain-takeover/)

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
Verwenden Sie [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks), um mithilfe der weltweit **fortschrittlichsten Community-Tools** einfach **Workflows zu erstellen und zu automatisieren**.\
Erhalten Sie noch heute Zugriff:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><strong>Erlernen Sie AWS-Hacking von Grund auf mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks beworben sehen m√∂chten** oder **HackTricks als PDF herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merchandise**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) Github-Repositories einreichen.

</details>
