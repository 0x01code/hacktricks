# Przejęcie domeny/poddomeny

<details>

<summary><strong>Dowiedz się, jak hakować AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeśli chcesz zobaczyć swoją **firmę reklamowaną w HackTricks** lub **pobrać HackTricks w formacie PDF**, sprawdź [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Zdobądź [**oficjalne gadżety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzinę PEASS**](https://opensea.io/collection/the-peass-family), naszą kolekcję ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Dołącz do** 💬 [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **śledź** nas na **Twitterze** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel się swoimi sztuczkami hakerskimi, przesyłając PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
Użyj [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks), aby łatwo tworzyć i **automatyzować przepływy pracy** przy użyciu najbardziej zaawansowanych narzędzi społecznościowych na świecie.\
Otrzymaj dostęp już dziś:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## Przejęcie domeny

Jeśli odkryjesz jakąś domenę (domena.tld), która jest **używana przez pewną usługę w zakresie** ale **firma** utraciła **własność** nad nią, możesz spróbować ją **zarejestrować** (jeśli jest wystarczająco tania) i poinformować o tym firmę. Jeśli ta domena otrzymuje jakieś **wrażliwe informacje**, takie jak ciasteczko sesji za pomocą parametru **GET** lub w nagłówku **Referer**, jest to z pewnością **luka w zabezpieczeniach**.

### Przejęcie poddomeny

Poddomena firmy wskazuje na **usługę zewnętrzną o niezarejestrowanej nazwie**. Jeśli możesz **utworzyć** konto w tej **usłudze zewnętrznej** i **zarejestrować** używaną **nazwę**, możesz przeprowadzić przejęcie poddomeny.

Istnieje kilka narzędzi z słownikami, które można sprawdzić pod kątem możliwych przejęć:

* [https://github.com/EdOverflow/can-i-take-over-xyz](https://github.com/EdOverflow/can-i-take-over-xyz)
* [https://github.com/blacklanternsecurity/bbot](https://github.com/blacklanternsecurity/bbot)
* [https://github.com/punk-security/dnsReaper](https://github.com/punk-security/dnsReaper)
* [https://github.com/haccer/subjack](https://github.com/haccer/subjack)
* [https://github.com/anshumanbh/tko-sub](https://github.com/anshumanbh/tko-subs)
* [https://github.com/ArifulProtik/sub-domain-takeover](https://github.com/ArifulProtik/sub-domain-takeover)
* [https://github.com/SaadAhmedx/Subdomain-Takeover](https://github.com/SaadAhmedx/Subdomain-Takeover)
* [https://github.com/Ice3man543/SubOver](https://github.com/Ice3man543/SubOver)
* [https://github.com/m4ll0k/takeover](https://github.com/m4ll0k/takeover)
* [https://github.com/antichown/subdomain-takeover](https://github.com/antichown/subdomain-takeover)
* [https://github.com/musana/mx-takeover](https://github.com/musana/mx-takeover)

#### Skanowanie podatnych na przejęcie poddomen za pomocą [BBOT](https://github.com/blacklanternsecurity/bbot):

Sprawdzanie podatności na przejęcie poddomen jest uwzględnione w domyślnym wyliczaniu poddomen BBOT. Sygnatury są pobierane bezpośrednio z [https://github.com/EdOverflow/can-i-take-over-xyz](https://github.com/EdOverflow/can-i-take-over-xyz).
```bash
bbot -t evilcorp.com -f subdomain-enum
```
### Generowanie przejęcia subdomeny za pomocą DNS Wildcard

Kiedy w domenie używany jest DNS wildcard, każda żądana subdomena tej domeny, która nie ma innych jawnie określonych adresów, będzie **rozwiązana do tych samych informacji**. Może to być adres IP typu A, CNAME...

Na przykład, jeśli `*.testing.com` jest ustawione jako wildcard na `1.1.1.1`. Wtedy `not-existent.testing.com` będzie wskazywać na `1.1.1.1`.

Jednak jeśli zamiast wskazywać na adres IP, administrator systemu wskazuje na **usługę zewnętrzną za pomocą CNAME**, na przykład **subdomenę na GitHubie** (`sohomdatta1.github.io`). Atakujący może **utworzyć swoją własną stronę zewnętrzną** (w tym przypadku na GitHubie) i stwierdzić, że `something.testing.com` wskazuje tam. Ponieważ **wildcard CNAME** się zgodzi, atakujący będzie mógł **generować dowolne subdomeny dla domeny ofiary, wskazujące na swoje strony**.

Przykład tej podatności można znaleźć w opisie CTF: [https://ctf.zeyu2001.com/2022/nitectf-2022/undocumented-js-api](https://ctf.zeyu2001.com/2022/nitectf-2022/undocumented-js-api)

## Wykorzystywanie przejęcia subdomeny

Przejęcie subdomeny to w zasadzie podrobienie DNS dla konkretnej domeny w całym internecie, umożliwiające atakującym ustawienie rekordów A dla domeny, co powoduje wyświetlanie treści z serwera atakującego w przeglądarkach. Ta **transparentność** w przeglądarkach sprawia, że domeny są podatne na phishing. Atakujący mogą wykorzystać [_typosquatting_](https://en.wikipedia.org/wiki/Typosquatting) lub [_Doppelganger domains_](https://en.wikipedia.org/wiki/Doppelg%C3%A4nger) w tym celu. Szczególnie narażone są domeny, w których adres URL w wiadomości phishingowej wydaje się prawidłowy, wprowadzając w błąd użytkowników i unikając filtrów antyspamowych ze względu na inherentne zaufanie do domeny.

Sprawdź ten [post dla dalszych szczegółów](https://0xpatrik.com/subdomain-takeover/)

### **Certyfikaty SSL**
Certyfikaty SSL, jeśli generowane przez atakujących za pomocą usług takich jak [_Let's Encrypt_](https://letsencrypt.org/), dodają wiarygodność tym fałszywym domenom, sprawiając, że ataki phishingowe są bardziej przekonujące.

### **Bezpieczeństwo plików cookie i transparentność przeglądarki**
Transparentność przeglądarki dotyczy również bezpieczeństwa plików cookie, które są regulowane przez zasady takie jak [Same-origin policy](https://en.wikipedia.org/wiki/Same-origin_policy). Pliki cookie, często używane do zarządzania sesjami i przechowywania tokenów logowania, mogą być wykorzystane przez przejęcie subdomeny. Atakujący mogą **zbierać pliki cookie sesji** po prostu kierując użytkowników na skompromitowaną subdomenę, narażając dane użytkowników i prywatność.

### **E-maile i przejęcie subdomeny**
Innym aspektem przejęcia subdomeny są usługi pocztowe. Atakujący mogą manipulować **rekordami MX**, aby odbierać lub wysyłać e-maile z prawidłowej subdomeny, zwiększając skuteczność ataków phishingowych.

### **Wyższe ryzyko**
Dodatkowe ryzyko obejmuje przejęcie rekordu **NS**. Jeśli atakujący uzyska kontrolę nad jednym rekordem NS domeny, może kierować część ruchu do serwera znajdującego się pod jego kontrolą. To ryzyko wzrasta, jeśli atakujący ustawia wysokie **TTL (Time to Live)** dla rekordów DNS, przedłużając czas trwania ataku.

### Podatność rekordu CNAME
Atakujący mogą wykorzystać nieużywane rekordy CNAME wskazujące na zewnętrzne usługi, które nie są już używane lub zostały wycofane. Pozwala to im utworzyć stronę pod zaufaną domeną, ułatwiając phishing lub rozpowszechnianie złośliwego oprogramowania.

### **Strategie łagodzenia**
Strategie łagodzenia obejmują:
1. **Usunięcie podatnych rekordów DNS** - Jest to skuteczne, jeśli subdomena nie jest już potrzebna.
2. **Zarejestrowanie nazwy domeny** - Zarejestrowanie zasobu u odpowiedniego dostawcy chmury lub ponowne zakupienie wygasłej domeny.
3. **Regularne monitorowanie podatności** - Narzędzia takie jak [aquatone](https://github.com/michenriksen/aquatone) mogą pomóc w identyfikacji podatnych domen. Organizacje powinny również przeglądać swoje procesy zarządzania infrastrukturą, zapewniając, że tworzenie rekordów DNS jest ostatnim krokiem w tworzeniu zasobów i pierwszym krokiem w ich usuwaniu.

Dla dostawców chmury istotne jest zweryfikowanie własności domeny w celu zapobieżenia przejęciu subdomeny. Niektóre z nich, takie jak [GitLab](https://about.gitlab.com/2018/02/05/gitlab-pages-custom-domain-validation/), rozpoznają ten problem i wdrożyły mechanizmy weryfikacji domeny.

## Odwołania
* [https://0xpatrik.com/subdomain-takeover/](https://0xpatrik.com/subdomain-takeover/)

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
Użyj [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks), aby łatwo tworzyć i **automatyzować zadania** przy użyciu najbardziej zaawansowanych narzędzi społecznościowych na świecie.\
Zdobądź dostęp już dziś:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><strong>Naucz się hakować AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeśli chcesz zobaczyć **reklamę swojej firmy w HackTricks** lub **pobrać HackTricks w formacie PDF**, sprawdź [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Zdobądź [**oficjalne gadżety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzinę PEASS**](https://opensea.io/collection/the-peass-family), naszą kolekcję ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Dołącz do** 💬 [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **śledź** nas na **Twitterze** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel się swoimi trikami hakerskimi, przesyłając PR do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
