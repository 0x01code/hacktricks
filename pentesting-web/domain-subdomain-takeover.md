# Prise de contr√¥le de domaine/sous-domaine

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Travaillez-vous dans une **entreprise de cybers√©curit√©** ? Voulez-vous voir votre **entreprise annonc√©e dans HackTricks** ? ou voulez-vous avoir acc√®s √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFT**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**üí¨**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR au** [**repo hacktricks**](https://github.com/carlospolop/hacktricks) **et au** [**repo hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

<figure><img src="/.gitbook/assets/image (3).png" alt=""><figcaption></figcaption></figure>

\
Utilisez [**Trickest**](https://trickest.io/) pour cr√©er et **automatiser facilement des flux de travail** aliment√©s par les outils communautaires les plus avanc√©s au monde.\
Acc√©dez d√®s aujourd'hui :

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## Prise de contr√¥le de domaine

Si vous d√©couvrez un domaine (domaine.tld) qui est **utilis√© par un service dans le p√©rim√®tre** mais que l'**entreprise** en a **perdu la propri√©t√©**, vous pouvez essayer de le **enregistrer** (si c'est suffisamment bon march√©) et informer l'entreprise. Si ce domaine re√ßoit des **informations sensibles** telles qu'un cookie de session via un param√®tre **GET** ou dans l'en-t√™te **Referer**, il s'agit certainement d'une **vuln√©rabilit√©**.

### Prise de contr√¥le de sous-domaine

Un sous-domaine de l'entreprise pointe vers un **service tiers avec un nom non enregistr√©**. Si vous pouvez **cr√©er** un **compte** dans ce **service tiers** et **enregistrer** le **nom** en cours d'utilisation, vous pouvez effectuer la prise de contr√¥le du sous-domaine.

Il existe plusieurs outils avec des dictionnaires pour v√©rifier les prises de contr√¥le possibles :

* [https://github.com/EdOverflow/can-i-take-over-xyz](https://github.com/EdOverflow/can-i-take-over-xyz)
* [https://github.com/blacklanternsecurity/bbot](https://github.com/blacklanternsecurity/bbot)
* [https://github.com/punk-security/dnsReaper](https://github.com/punk-security/dnsReaper)
* [https://github.com/haccer/subjack](https://github.com/haccer/subjack)
* [https://github.com/anshumanbh/tko-sub](https://github.com/anshumanbh/tko-subs)
* [https://github.com/ArifulProtik/sub-domain-takeover](https://github.com/ArifulProtik/sub-domain-takeover)
* [https://github.com/SaadAhmedx/Subdomain-Takeover](https://github.com/SaadAhmedx/Subdomain-Takeover)
* [https://github.com/Ice3man543/SubOver](https://github.com/Ice3man543/SubOver)
* [https://github.com/m4ll0k/takeover](https://github.com/m4ll0k/takeover)
* [https://github.com/antichown/subdomain-takeover](https://github.com/antichown/subdomain-takeover)
* [https://github.com/musana/mx-takeover](https://github.com/musana/mx-takeover)

#### Analyse des sous-domaines pouvant √™tre pirat√©s avec [BBOT](https://github.com/blacklanternsecurity/bbot) :
Les v√©rifications de prise de contr√¥le de sous-domaine sont incluses dans l'√©num√©ration des sous-domaines par d√©faut de BBOT. Les signatures sont extraites directement de [https://github.com/EdOverflow/can-i-take-over-xyz](https://github.com/EdOverflow/can-i-take-over-xyz).
~~~bash
bbot -t evilcorp.com -f subdomain-enum
~~~

### G√©n√©ration de prise de contr√¥le de sous-domaine via DNS Wildcard

Lorsque le DNS wildcard est utilis√© dans un domaine, tout sous-domaine demand√© de ce domaine qui n'a pas explicitement une adresse diff√©rente sera **r√©solu avec les m√™mes informations**. Cela peut √™tre une adresse IP A, un CNAME...

Par exemple, si `*.testing.com` est un wildcard pour `1.1.1.1`. Alors, `not-existent.testing.com` pointera vers `1.1.1.1`.

Cependant, si au lieu de pointer vers une adresse IP, l'administrateur syst√®me le pointe vers un **service tiers via CNAME**, comme un **sous-domaine github** par exemple (`sohomdatta1.github.io`). Un attaquant pourrait **cr√©er sa propre page tiers** (dans ce cas-ci, sur Github) et dire que `something.testing.com` pointe l√†-bas. Parce que le **wildcard CNAME** sera d'accord, l'attaquant pourra **g√©n√©rer des sous-domaines arbitraires pour le domaine de la victime pointant vers ses pages**.

Vous pouvez trouver un exemple de cette vuln√©rabilit√© dans le write-up du CTF : [https://ctf.zeyu2001.com/2022/nitectf-2022/undocumented-js-api](https://ctf.zeyu2001.com/2022/nitectf-2022/undocumented-js-api)
## Exploiter une prise de contr√¥le de sous-domaine

**Ces informations ont √©t√© copi√©es depuis** [**https://0xpatrik.com/subdomain-takeover/**](https://0xpatrik.com/subdomain-takeover/)

R√©cemment, j'ai [√©crit](https://0xpatrik.com/subdomain-takeover-basics/) sur les bases de la prise de contr√¥le de sous-domaine. Bien que le concept soit maintenant g√©n√©ralement bien compris, j'ai remarqu√© que les gens ont souvent du mal √† comprendre les risques que la prise de contr√¥le de sous-domaine pr√©sente. Dans cet article, je vais approfondir et couvrir les risques les plus importants de la _prise de contr√¥le de sous-domaine_ selon mon point de vue.

_Remarque : Certains risques sont att√©nu√©s implicitement par le fournisseur de cloud. Par exemple, lorsque la prise de contr√¥le de sous-domaine est possible sur Amazon CloudFront, il n'y a aucun moyen de configurer des enregistrements TXT pour contourner les v√©rifications SPF. L'article vise donc √† fournir des risques li√©s √† la prise de contr√¥le de sous-domaine en g√©n√©ral. N√©anmoins, la plupart de ces risques s'appliquent √©galement aux fournisseurs de cloud._

### Transparence pour un navigateur <a href="#transparencepourunnavigateur" id="transparencepourunnavigateur"></a>

Pour commencer, examinons la r√©solution DNS lorsqu'un CNAME est impliqu√© :

![R√©solution DNS](https://0xpatrik.com/content/images/2018/05/resolution-2.png)

Notez que l'√©tape n¬∞7 demande _sub.example.com_ plut√¥t que _anotherdomain.com_. C'est parce que le navigateur Web n'est pas conscient de l'existence de _anotherdomain.com_. M√™me si un enregistrement CNAME est utilis√©, la barre d'URL du navigateur contient toujours _sub.example.com_. C'est la **transparence** pour le navigateur. Si vous y r√©fl√©chissez, le navigateur place toute sa confiance dans le r√©solveur DNS pour fournir des informations pr√©cises sur le domaine. En simplifiant, la prise de contr√¥le de sous-domaine est un d√©tournement DNS pour un domaine particulier √† travers Internet. Pourquoi ? Parce que tout navigateur effectuant la r√©solution DNS sur le domaine affect√© re√ßoit un ensemble d'enregistrements A d√©finis par un attaquant. Le navigateur affiche ensuite joyeusement tout ce qui est re√ßu de ce serveur (en pensant que c'est l√©gitime).

Un tel domaine est un sc√©nario parfait pour le phishing. Les attaquants utilisent souvent le [_typosquatting_](https://en.wikipedia.org/wiki/Typosquatting) ou les soi-disant [_domaines Doppelganger_](https://en.wikipedia.org/wiki/Doppelg%C3%A4nger) pour imiter le domaine/site l√©gitime √† des fins de phishing. Apr√®s avoir pris le contr√¥le d'un nom de domaine l√©gitime, il est presque impossible pour un utilisateur r√©gulier de savoir si le contenu du domaine est fourni par une partie l√©gitime ou par un attaquant. Prenons par exemple une banque al√©atoire. Si l'un des sous-domaines de la banque est vuln√©rable √† la prise de contr√¥le de sous-domaine, un attaquant peut cr√©er un formulaire HTML qui imite le formulaire de connexion au syst√®me de banque en ligne de la banque. Ensuite, un attaquant peut mener une campagne de spear phishing ou de phishing de masse demandant aux utilisateurs de se connecter et de changer leurs mots de passe. √Ä ce stade, les mots de passe sont captur√©s par un attaquant qui contr√¥le le domaine en question. L'URL fournie dans l'e-mail de phishing est un sous-domaine l√©gitime d'une banque. Par cons√©quent, les utilisateurs ne sont pas conscients de ce qui se passe de malveillant. Les filtres anti-spam et autres mesures de s√©curit√© sont √©galement moins susceptibles de d√©clencher l'e-mail en tant que spam ou malveillant car il contient des noms de domaine ayant une plus grande confiance.

En effet, le nom de domaine lui-m√™me joue un r√¥le important dans une campagne r√©ussie. Avoir un sous-domaine de 5e niveau vuln√©rable √† la prise de contr√¥le de sous-domaine est beaucoup moins _"l√©gitime"_ que d'avoir un sous-domaine de 2e niveau avec un nom de sous-domaine convivial. J'ai vu plusieurs exemples de sous-domaines parfaits pour le phishing, notamment :

* _purchases.SOMETHING.com_
* _www.SOMETHING.com_
* _online.SOMETHING.com_
* _shop.SOMETHING.com_

Tous vuln√©rables √† la prise de contr√¥le de sous-domaine. Tous √©taient de grandes marques. Parler de phishing parfait ?

N√©anmoins, les r√©centes campagnes de phishing h√©bergent du contenu sur des domaines avec de longs noms de domaine qui incluent le nom de la marque (voir l'exemple d'[Apple](https://www.phishtank.com/target\_search.php?target\_id=183\&valid=y\&active=All\&Search=Search)). Avec un certificat SSL valide (voir ci-dessous), un mot-cl√© dans le nom de domaine et un site Web qui imite le site Web de la marque cibl√©e, les gens ont tendance √† tomber dans ces attaques. Pensez aux chances avec un sous-domaine l√©gitime de cette marque.

<figure><img src="/.gitbook/assets/image (3).png" alt=""><figcaption></figcaption></figure>

\
Utilisez [**Trickest**](https://trickest.io/) pour cr√©er facilement et **automatiser des flux de travail** aliment√©s par les outils communautaires les plus avanc√©s au monde.\
Acc√©dez d√®s aujourd'hui :

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

### Certificats SSL <a href="#certificatsssl" id="certificatsssl"></a>

L'attaque ci-dessus peut √™tre am√©lior√©e en g√©n√©rant un certificat SSL valide. Les autorit√©s de certification telles que [_Let's Encrypt_](https://letsencrypt.org/) permettent la v√©rification automatique de la propri√©t√© d'un domaine par la v√©rification du contenu :

![Flux Let's Encrypt](https://0xpatrik.com/content/images/2018/05/letsencrypt.png)

C'est-√†-dire que si un contenu sp√©cifique est plac√© sur un chemin d'URL sp√©cifique, Let's Encrypt approuvera la d√©livrance d'un certificat pour un domaine donn√©. √âtant donn√© qu'un attaquant a un contr√¥le total sur le contenu du domaine vuln√©rable √† la prise de contr√¥le de sous-domaine, cette v√©rification peut √™tre effectu√©e en quelques minutes. Par cons√©quent, les attaquants sont √©galement capables de g√©n√©rer un certificat SSL pour un tel domaine, ce qui ne fait que r√©duire les soup√ßons d'une attaque de phishing.

### Vol de cookies <a href="#voldescookies" id="voldescookies"></a>

Cela va de pair avec la transparence du navigateur mais a des cons√©quences diff√©rentes. Le navigateur Web met en ≈ìuvre de nombreuses politiques de s√©curit√© pour emp√™cher les sites Web malveillants de causer des dommages. Cela inclut des choses telles que la [politique de m√™me origine](https://en.wikipedia.org/wiki/Same-origin\_policy). L'une des principales responsabilit√©s de s√©curit√© d'un navigateur est de s√©curiser les cookies enregistr√©s. Pourquoi ? Bien que HTTP soit un protocole sans √©tat, les cookies sont utilis√©s pour suivre les sessions. Pour plus de commodit√©, les utilisateurs enregistrent souvent les cookies pendant une p√©riode prolong√©e pour √©viter de se connecter √† chaque fois. Ces cookies agissent donc comme un jeton de connexion qui est pr√©sent√© au serveur Web et l'utilisateur est identifi√©. Des attaques telles que le [_hijacking de session_](https://en.wikipedia.org/wiki/Session\_hijacking) ont naturellement √©volu√© √† partir de ce concept.

Le navigateur pr√©sente automatiquement les cookies stock√©s avec chaque demande au domaine qui les a √©mis. Il y a une exception √† cela, de sorte que les cookies peuvent √™tre partag√©s entre les sous-domaines ([lire ici](https://tools.ietf.org/html/rfc6265#section-8.6), remarquez √©galement la section 8.7). Cela se produit g√©n√©ralement lorsque le site Web utilise un syst√®me de [Single sign-on](https://en.wikipedia.org/wiki/Single\_sign-on) (SSO) bas√© sur les cookies. Avec SSO, un utilisateur peut se connecter en utilisant un sous-domaine et partager le m√™me jeton de session sur un large √©ventail de sous-domaines. La syntaxe pour d√©finir un cookie r√©gulier est la suivante :
```
HTTP/1.1 200 OK
Set-Cookie: name=value
```
Si ce cookie est √©mis par un serveur web r√©sidant sur _example.com_, seul ce serveur peut y acc√©der ult√©rieurement. Cependant, le cookie peut √™tre √©mis pour un domaine g√©n√©rique (pour les raisons expliqu√©es ci-dessus) de la mani√®re suivante :
```
HTTP/1.1 200 OK
Set-Cookie: name=value; domain=example.com
```
Le cookie sera inclus dans les requ√™tes HTTP vers _example.com_, mais aussi vers tout autre sous-domaine tel que _subdomain.example.com_. Ce comportement cr√©e une possibilit√© d'attaques de gravit√© √©lev√©e en utilisant la prise en charge de sous-domaine. Supposons qu'un domaine particulier utilise des cookies de session pour un domaine g√©n√©rique. S'il existe un sous-domaine vuln√©rable √† la prise en charge de sous-domaine, la seule chose √† faire pour collecter le jeton de session de l'utilisateur est de le tromper en visitant le sous-domaine vuln√©rable. Le cookie de session est automatiquement envoy√© avec la requ√™te HTTP.

Le navigateur met √©galement en ≈ìuvre des m√©canismes de s√©curit√© suppl√©mentaires pour les cookies :

* **Cookie HttpOnly** - Les cookies peuvent par d√©faut √™tre accessibles par le code JavaScript s'ex√©cutant dans le contexte du site Web qui a cr√©√© les cookies. JavaScript peut lire, mettre √† jour et supprimer les cookies. Le drapeau de cookie _HttpOnly_ (d√©fini par le serveur Web) indique que le cookie particulier ne peut pas √™tre acc√©d√© par le code JavaScript. La seule fa√ßon de l'obtenir est par le biais des en-t√™tes de requ√™te et de r√©ponse HTTP.
* **Cookie s√©curis√©** - Lorsque le cookie a le drapeau _Secure_ d√©fini par le serveur Web, il ne peut √™tre communiqu√© au serveur Web que si HTTPS est utilis√©.

Si le domaine est vuln√©rable √† la prise en charge de sous-domaine, un attaquant peut collecter les cookies √©mis par ce domaine dans le pass√© en trompant les utilisateurs pour qu'ils visitent ce site Web. Les drapeaux HttpOnly et Secure ne sont pas utiles car le cookie n'est pas acc√©d√© √† l'aide de JavaScript et un certificat SSL peut √™tre facilement g√©n√©r√© pour le domaine pris.

Le vol de cookies en utilisant la prise en charge a √©t√© expliqu√© dans un rapport de prime de bug [rapport](https://hackerone.com/reports/172137) par Arne Swinnen. Le rapport explique le probl√®me avec l'un des sous-domaines de _Ubiquiti Networks_ (_ping.ubnt.com_). Ce sous-domaine √©tait vuln√©rable √† la prise en charge de sous-domaine, pointant vers une distribution AWS CloudFront non r√©clam√©e. √âtant donn√© qu'Ubiquiti Networks utilise SSO avec des cookies de session g√©n√©riques, tous les utilisateurs visitant _ping.ubnt.com_ pouvaient voir leurs cookies de session vol√©s. M√™me si ce domaine pointe vers AWS CloudFront, les param√®tres de distribution de CloudFront permettent de journaliser les cookies avec chaque requ√™te. Par cons√©quent, le sc√©nario d'extraction des cookies de session est tout √† fait possible m√™me avec des sous-domaines pointant vers AWS CloudFront. En 2017, Arne a √©galement d√©montr√© une attaque similaire contre le syst√®me SSO d'[Uber](https://www.arneswinnen.net/2017/06/authentication-bypass-on-ubers-sso-via-subdomain-takeover/).

Le comportement expliqu√© ci-dessus ne se limite pas aux cookies. √âtant donn√© que les scripts JavaScript ont un contr√¥le total sur les sites Web sur lesquels ils s'ex√©cutent, la possibilit√© de remplacer de tels scripts sur le site l√©gitime peut entra√Æner des cons√©quences catastrophiques. Supposons que le site Web utilise du code JavaScript provenant d'un fournisseur externe √† l'aide de la balise _script_ et de l'attribut _src_. Lorsque le domaine du fournisseur externe expire, le navigateur √©choue silencieusement, c'est-√†-dire qu'il ne d√©clenche aucune alerte visible pour les utilisateurs r√©guliers. Si le code externe n'effectue aucune t√¢che importante (par exemple, il est utilis√© uniquement pour le suivi), ce fournisseur externe peut rester sur le site pendant une p√©riode prolong√©e. Un attaquant peut prendre le contr√¥le de ce domaine expir√©, faire correspondre le chemin d'URL du code JavaScript fourni et ainsi prendre le contr√¥le de chaque visiteur qui visite le site d'origine.

Cependant, il existe un moyen de prot√©ger l'int√©grit√© des fichiers JavaScript dans un navigateur. _Subresource Integrity_ [a √©t√© propos√©](https://www.w3.org/TR/2016/REC-SRI-20160623/) comme un m√©canisme pour inclure une empreinte cryptographique en tant qu'attribut _integrity_ dans la balise _script_ en HTML5. Lorsque l'empreinte cryptographique fournie ne correspond pas au fichier t√©l√©charg√©, le navigateur refuse de l'ex√©cuter.

### E-mails <a href="#emails" id="emails"></a>

Lorsqu'une prise en charge de sous-domaine CNAME est possible, les enregistrements MX peuvent √©galement √™tre configur√©s par un attaquant vers un serveur Web arbitraire. Cela permet de recevoir des e-mails sur un sous-domaine l√©gitime d'une marque, ce qui est particuli√®rement utile dans les attaques de phishing (cibl√©es) o√π une interaction entre un attaquant et une victime est n√©cessaire. Les attaquants falsifient g√©n√©ralement l'en-t√™te `Return-Path` pour recevoir une r√©ponse √† l'e-mail. Avec les enregistrements MX corrects, ce probl√®me est contourn√©.

D'autre part, l'envoi d'e-mails est √©galement possible. Bien qu'il soit trivial de falsifier l'en-t√™te `From` pour inclure n'importe quelle adresse e-mail, les filtres SPF v√©rifient g√©n√©ralement l'en-t√™te `Return-Path` et les h√¥tes autoris√©s √† envoyer des e-mails pour le domaine. SPF stocke la configuration dans les enregistrements DNS TXT. Avec la prise en charge de sous-domaine, les enregistrements TXT sont √©galement contr√¥l√©s par l'attaquant - les v√©rifications SPF peuvent √™tre facilement contourn√©es.

_Comme je l'ai not√© au d√©but, ces tactiques ne fonctionnent g√©n√©ralement pas avec la majorit√© des fournisseurs de cloud car vous n'avez pas un contr√¥le direct sur la zone DNS._

### Risques d'ordre sup√©rieur <a href="#higherorderrisks" id="higherorderrisks"></a>

Le concept de prise en charge de sous-domaine peut √™tre naturellement √©tendu aux enregistrements NS : si le domaine de base d'au moins un enregistrement NS est disponible √† l'enregistrement, le nom de domaine source est vuln√©rable √† la prise en charge de sous-domaine.

L'un des probl√®mes de la prise en charge de sous-domaine en utilisant l'enregistrement NS est que le nom de domaine source a g√©n√©ralement plusieurs enregistrements NS. Plusieurs enregistrements NS sont utilis√©s pour la redondance et l'√©quilibrage de charge. Le serveur de noms est choisi au hasard avant la r√©solution DNS. Supposons que le domaine _sub.example.com_ ait deux enregistrements NS : _ns.vulnerable.com_ et _ns.nonvulnerable.com_. Si un attaquant prend le contr√¥le du _ns.vulnerable.com_, la situation du point de vue de l'utilisateur qui interroge _sub.example.com_ est la suivante :

1. √âtant donn√© qu'il y a deux serveurs de noms, l'un est choisi au hasard. Cela signifie que la probabilit√© d'interroger un serveur de noms contr√¥l√© par un attaquant est de 50 %.
2. Si le r√©solveur DNS de l'utilisateur choisit _ns.nonvulnerable.com_ (serveur de noms l√©gitime), le r√©sultat correct est renvoy√© et est susceptible d'√™tre mis en cache quelque part entre 6 et 24 heures.
3. Si le r√©solveur DNS de l'utilisateur choisit _ns.vulnerable.com_ (serveur de noms d√©tenu par un attaquant), un attaquant peut fournir un faux r√©sultat qui sera √©galement mis en cache. √âtant donn√© qu'un attaquant contr√¥le le serveur de noms, elle peut d√©finir le TTL pour ce r√©sultat particulier, par exemple une semaine.

Le processus ci-dessus est r√©p√©t√© chaque fois que l'entr√©e du cache expire. Lorsqu'un attaquant choisit d'utiliser un TTL avec une valeur √©lev√©e, le faux r√©sultat restera dans le cache DNS pendant cette p√©riode. Pendant ce temps, toutes les requ√™tes vers _sub.example.com_ utiliseront le faux r√©sultat DNS mis en cache par un attaquant. Cette id√©e est encore amplifi√©e lorsque des r√©solveurs DNS publics (par exemple, Google DNS) sont utilis√©s. Dans ce cas, les r√©solveurs publics sont susceptibles de mettre en cache les faux r√©sultats, ce qui signifie que tous les utilisateurs utilisant le m√™me r√©solveur DNS obtiendront de faux r√©sultats jusqu'√† ce que le cache soit r√©voqu√©.

En plus du contr√¥le sur le nom de domaine source, le contr√¥le sur tous les domaines de niveau sup√©rieur du nom de domaine source est √©galement acquis. Cela est d√ª au fait que poss√©der un nom de domaine canonique de l'enregistrement NS signifie poss√©der la zone DNS compl√®te du nom de domaine source.

En 2016, Matthew Bryant a [d√©montr√©](https://thehackerblog.com/the-international-incident-gaining-control-of-a-int-domain-name-with-dns-trickery/index.html) une prise en charge de sous-domaine en utilisant l'enregistrement NS sur _maris.int_. Le domaine de premier niveau .INT est un TLD sp√©cial, et seuls quelques domaines l'utilisent. Bryant a montr√© que m√™me si l'enregistrement de tels noms de domaine est approuv√© exclusivement par l'IANA, les serveurs de noms peuvent √™tre d√©finis sur des domaines arbitraires. √âtant donn√© que l'un des serveurs de noms de _maris.int_ √©tait disponible √† l'enregistrement (_cobalt.aliis.be_), la prise en charge de sous-domaine √©tait possible
### Att√©nuation <a href="#mitigation" id="mitigation"></a>

Les strat√©gies d'att√©nuation pour les noms de domaine d√©j√† vuln√©rables √† une prise en charge de sous-domaine sont assez simples :

* **Supprimer l'enregistrement DNS affect√©** - La solution la plus simple consiste √† supprimer l'enregistrement affect√© de la zone DNS. Cette √©tape est g√©n√©ralement utilis√©e si l'organisation conclut que le nom de domaine source affect√© n'est plus n√©cessaire.
* **Revendiquer le nom de domaine** - Cela signifie enregistrer la ressource aupr√®s d'un fournisseur de cloud sp√©cifique ou, dans le cas d'un domaine Internet r√©gulier, racheter le domaine expir√©.

Pour √©viter une prise en charge de sous-domaine √† l'avenir, les organisations doivent modifier le processus de cr√©ation et de destruction des ressources de leur infrastructure. En cas de cr√©ation de ressources, la cr√©ation de l'enregistrement DNS doit √™tre la _derni√®re √©tape_ de ce processus. Cette condition emp√™che l'enregistrement DNS de pointer vers un domaine inexistant √† un moment donn√©. Pour la destruction des ressources, l'inverse est vrai : l'enregistrement DNS doit √™tre supprim√© en tant que _premi√®re √©tape_ de ce processus. Des outils tels que [aquatone](https://github.com/michenriksen/aquatone) incluent des v√©rifications de prise en charge de sous-domaine. Les v√©rifications doivent √™tre effectu√©es p√©riodiquement par une √©quipe de s√©curit√© d'une organisation pour v√©rifier l'absence de domaines vuln√©rables. Les processus de collecte centralis√©e des noms de domaine expos√©s ne sont souvent pas efficaces au sein des organisations (en raison des √©quipes mondiales, etc.) et la surveillance externe est g√©n√©ralement la meilleure solution.

La strat√©gie d'att√©nuation pour les fournisseurs de cloud doit √©galement √™tre prise en compte. Les services cloud ne v√©rifient pas la propri√©t√© du domaine. La raison en est principalement la commodit√©. Le fournisseur de cloud n'introduit aucune vuln√©rabilit√© en ne v√©rifiant pas la propri√©t√© d'un nom de domaine source. Il revient donc √† l'utilisateur de surveiller ses enregistrements DNS. Une autre raison est que lorsque la ressource cloud est supprim√©e, l'utilisateur n'est g√©n√©ralement plus client de ce service. Les fournisseurs de cloud se posent alors la question : pourquoi devrions-nous nous en soucier ?

Des fournisseurs tels que [GitLab](https://about.gitlab.com/2018/02/05/gitlab-pages-custom-domain-validation/) ont r√©alis√© que la prise en charge de sous-domaine est un probl√®me et ont mis en place un m√©canisme de v√©rification de domaine.

_Certaines parties de cet article sont extraites de ma_ [_th√®se de ma√Ætrise_](https://is.muni.cz/th/byrdn/Thesis.pdf).

√Ä la prochaine !

[Patrik](https://twitter.com/0xpatrik)

<figure><img src="/.gitbook/assets/image (3).png" alt=""><figcaption></figcaption></figure>

\
Utilisez [**Trickest**](https://trickest.io/) pour cr√©er et automatiser facilement des flux de travail aliment√©s par les outils communautaires les plus avanc√©s au monde.\
Acc√©dez d√®s aujourd'hui :

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Vous travaillez dans une **entreprise de cybers√©curit√©** ? Vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ? ou souhaitez-vous avoir acc√®s √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFT**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**üí¨**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR au** [**repo hacktricks**](https://github.com/carlospolop/hacktricks) **et au** [**repo hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
