# Κατάληψη Domain/Subdomain

<details>

<summary><strong>Μάθετε το χάκινγκ στο AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Ειδικός Ερυθρού Συνεργείου AWS του HackTricks)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι υποστήριξης του HackTricks:

* Αν θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**την Οικογένεια PEASS**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε** στην 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα τηλεγραφήματος**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε τα χάκινγκ κόλπα σας υποβάλλοντας PRs** στα [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
Χρησιμοποιήστε το [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) για να δημιουργήσετε εύκολα και να **αυτοματοποιήσετε ροές εργασίας** με τα πιο **προηγμένα εργαλεία κοινότητας** στον κόσμο.\
Αποκτήστε πρόσβαση σήμερα:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## Κατάληψη Domain

Αν ανακαλύψετε κάποιο domain (domain.tld) που **χρησιμοποιείται από κάποια υπηρεσία εντός του πεδίου εφαρμογής** αλλά η **εταιρεία** έχει **χάσει την ιδιοκτησία** του, μπορείτε να προσπαθήσετε να το **καταχωρίσετε** (αν είναι αρκετά φθηνό) και να ενημερώσετε την εταιρεία. Αν αυτό το domain λαμβάνει κάποιες **ευαίσθητες πληροφορίες** όπως ένα cookie συνεδρίας μέσω παραμέτρου **GET** ή στην κεφαλίδα **Referer**, τότε αυτό είναι σίγουρα μια **ευπάθεια**.

### Κατάληψη Subdomain

Ένα subdomain της εταιρείας δείχνει σε μια **υπηρεσία τρίτου μέρους με ένα όνομα που δεν έχει καταχωριστεί**. Αν μπορείτε να **δημιουργήσετε** ένα **λογαριασμό** σε αυτήν την **υπηρεσία τρίτου μέρους** και να **καταχωρίσετε** το **όνομα** που χρησιμοποιείται, τότε μπορείτε να πραγματοποιήσετε την κατάληψη του subdomain.

Υπάρχουν διάφορα εργαλεία με λεξικά για να ελέγξετε πιθανές καταλήψεις:

* [https://github.com/EdOverflow/can-i-take-over-xyz](https://github.com/EdOverflow/can-i-take-over-xyz)
* [https://github.com/blacklanternsecurity/bbot](https://github.com/blacklanternsecurity/bbot)
* [https://github.com/punk-security/dnsReaper](https://github.com/punk-security/dnsReaper)
* [https://github.com/haccer/subjack](https://github.com/haccer/subjack)
* [https://github.com/anshumanbh/tko-sub](https://github.com/anshumanbh/tko-subs)
* [https://github.com/ArifulProtik/sub-domain-takeover](https://github.com/ArifulProtik/sub-domain-takeover)
* [https://github.com/SaadAhmedx/Subdomain-Takeover](https://github.com/SaadAhmedx/Subdomain-Takeover)
* [https://github.com/Ice3man543/SubOver](https://github.com/Ice3man543/SubOver)
* [https://github.com/m4ll0k/takeover](https://github.com/m4ll0k/takeover)
* [https://github.com/antichown/subdomain-takeover](https://github.com/antichown/subdomain-takeover)
* [https://github.com/musana/mx-takeover](https://github.com/musana/mx-takeover)
* [https://github.com/PentestPad/subzy](https://github.com/PentestPad/subzy)

#### Σάρωση για Υποκλεπτόμενα Subdomains με το [BBOT](https://github.com/blacklanternsecurity/bbot):

Οι έλεγχοι κατάληψης subdomain περιλαμβάνονται στην προεπιλεγμένη απαρίθμηση subdomain του BBOT. Οι υπογραφές ανακτώνται απευθείας από το [https://github.com/EdOverflow/can-i-take-over-xyz](https://github.com/EdOverflow/can-i-take-over-xyz).
```bash
bbot -t evilcorp.com -f subdomain-enum
```
### Δημιουργία Κατάληψης Υποτομέα μέσω Αγριοχαρτογράφησης DNS

Όταν χρησιμοποιείται η αγριοχαρτογράφηση DNS σε έναν τομέα, οποιοδήποτε ζητούμενος υποτομέας αυτού του τομέα που δεν έχει ρητά διαφορετική διεύθυνση θα **επιλύεται στις ίδιες πληροφορίες**. Αυτό μπορεί να είναι μια διεύθυνση IP A, ένα CNAME...

Για παράδειγμα, αν `*.testing.com` είναι αγριοχαρτογραφημένο σε `1.1.1.1`. Τότε, το `not-existent.testing.com` θα δείχνει στο `1.1.1.1`.

Ωστόσο, αν αντί να δείχνει σε μια διεύθυνση IP, ο διαχειριστής το δείχνει σε ένα **υπηρεσία τρίτου μέσω CNAME**, όπως ένα **υποτομέα του github** για παράδειγμα (`sohomdatta1.github.io`). Ένας επιτιθέμενος θα μπορούσε να **δημιουργήσει τη δική του σελίδα τρίτου μέρους** (στο Github σε αυτήν την περίπτωση) και να δηλώσει ότι το `something.testing.com` δείχνει εκεί. Επειδή, το **CNAME αγριοχαρτογράφησης** θα συμφωνήσει, ο επιτιθέμενος θα μπορεί να **δημιουργήσει αυθαίρετους υποτομείς για τον τομέα του θύματος που δείχνουν στις σελίδες του**.

Μπορείτε να βρείτε ένα παράδειγμα αυτής της ευπάθειας στο CTF write-up: [https://ctf.zeyu2001.com/2022/nitectf-2022/undocumented-js-api](https://ctf.zeyu2001.com/2022/nitectf-2022/undocumented-js-api)

## Εκμετάλλευση μιας κατάληψης υποτομέα

Η κατάληψη υποτομέα είναι ουσιαστικά πλαστογράφηση DNS για έναν συγκεκριμένο τομέα σε Ͽλό το διαδίκτυο, επιτρέποντας στους επιτιθέμενους να ορίσουν εγγραφές A για έναν τομέα, οδηγώντας τους φυλλομετρητές να εμφανίζουν περιεχόμενο από τον διακομιστή του επιτιθέμενου. Αυτή η **διαφάνεια** στους φυλλομετρητές καθιστά τους τομείς ευάλωτους στο phishing. Οι επιτιθέμενοι μπορεί να χρησιμοποιήσουν [_typosquatting_](https://en.wikipedia.org/wiki/Typosquatting) ή [_Doppelganger domains_](https://en.wikipedia.org/wiki/Doppelg%C3%A4nger) για αυτόν τον σκοπό. Ειδικά ευάλωτοι είναι οι τομείς όπου η διεύθυνση URL σε ένα email phishing φαίνεται αξιόπιστη, παραπλανώντας τους χρήστες και αποφεύγοντας τα φίλτρα ανεπιθύμητων μηνυμάτων λόγω της εμπιστοσύνης του τομέα.

Ελέγξτε αυτήν την [ανάρτηση για περισσότερες λεπτομέρειες](https://0xpatrik.com/subdomain-takeover/)

### **Πιστοποιητικά SSL**

Τα πιστοποιητικά SSL, αν δημιουργηθούν από επιτιθέμενους μέσω υπηρεσιών όπως το [_Let's Encrypt_](https://letsencrypt.org/), προσθέτουν στην εγκυρότητα αυτών των ψευδών τομέων, κάνοντας τις επιθέσεις phishing πιο πειστικές.

### **Ασφάλεια Cookies και Διαφάνεια Φυλλομετρητή**

Η διαφάνεια του φυλλομετρητή επεκτείνεται επίσης στην ασφάλεια των cookies, που διέπεται από πολιτικές όπως η [Πολιτική Ίδιας Προέλευσης](https://en.wikipedia.org/wiki/Same-origin\_policy). Τα cookies, συχνά χρησιμοποιούμενα για τη διαχείριση συνεδριών και την αποθήκευση των τεκμηρίων σύνδεσης, μπορούν να εκμεταλλευτούνται μέσω κατάληψης υποτομέα. Οι επιτιθέμενοι μπορούν να **συλλέξουν cookies συνεδρίας** απλά καθοδηγώντας τους χρήστες σε έναν υποτομέα που έχει διαρραγεί, εκθέτοντας τα δεδομένα και την ιδιωτικότητα των χρηστών.

### **Emails και Κατάληψη Υποτομέα**

Ένα άλλο κομμάτι της κατάληψης υποτομέα αφορά τις υπηρεσίες email. Οι επιτιθέμενοι μπορούν να διαμορφώσουν **εγγραφές MX** για να λαμβάνουν ή να στέλνουν emails από ένα νόμιμο υποτομέα, ενισχύοντας την αποτελεσματικότητα των επιθέσεων phishing.

### **Υψηλότεροι Κίνδυνοι**

Περαιτέρω κίνδυνοι περιλαμβάνουν την **κατάληψη εγγραφών NS**. Αν ένας επιτιθέμενος αποκτήσει έλεγχο επάνω σε μια εγγραφή NS ενός τομέα, μπορεί δυνητικά να κατευθύνει ένα μέρος της κίνησης σε έναν διακομιστή υπό τον έλεγχό του. Αυτός ο κίνδυνος ενισχύεται εάν ο επιτιθέμενος ορίσει ένα υψηλό **TTL (Χρόνος Ζωής)** για τις εγγραφές DNS, παρατείνοντας τη διάρκεια της επίθεσης.

### Ευπάθεια Εγγραφής CNAME

Οι επιτιθέμενοι μπορεί να εκμεταλλευτούν ανεκμετάλλευτες εγγραφές CNAME που δείχνουν σε εξωτερικές υπηρεσίες που δεν χρησιμοποιούνται πλέον ή έχουν αποσυρθεί. Αυτό τους επιτρέπει να δημιουργήσουν μια σελίδα υπό τον αξιόπιστο τομέα, διευκολύνοντας περαιτέρω το phishing ή τη διανομή κακόβουλου λογισμικού.

### **Στρατηγικές Αντιμετώπισης**

Οι στρατηγικές αντιμετώπισης περιλαμβάνουν:

1. **Αφαίρεση ευάλωτων εγγραφών DNS** - Αυτό είναι αποτελεσματικό εάν ο υποτομέας δεν απαιτείται πλέον.
2. **Δήλωση του ονόματος του τομέα** - Εγγραφή του πόρου με τον αντίστοιχο πάροχο cloud ή επαναλήψη αγοράς ενός ληγμένου τομέα.
3. **Τακτική παρακολούθηση για ευπάθειες** - Εργαλεία όπως το [aquatone](https://github.com/michenriksen/aquatone) μπορούν να βοηθήσουν στον εντοπισμό ευάλωτων τομέων. Οι οργανισμοί πρέπει επίσης να αναθεωρήσουν τις διαδικασίες διαχείρισης υποδομής τους, εξασφαλίζοντας ότι η δημιουργία εγγραφών DNS είναι το τελευταίο βήμα στη δημιουργία πόρου και το πρώτο βήμα στην καταστροφή του πόρου.

Για τους παρόχους cloud, η επαλήθευση της ιδιοκτησίας του τομέα είναι κρίσιμη για την πρόληψη καταλήψεων υποτομέων. Κάποιοι, όπως η [GitLab](https://about.gitlab.com/2018/02/05/gitlab-pages-custom-domain-validation/), έχουν αναγνωρίσει αυτό το θέμα και έχουν εφαρμόσει μηχανισμούς επαλήθευσης του τομέα.

## Αναφορές

* [https://0xpatrik.com/subdomain-takeover/](https://0xpatrik.com/subdomain-takeover/)

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
Χρησιμοποιήστε το [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) για εύκολη δημιουργία και **αυτοματοποίηση ροών εργασίας** με τα πιο προηγμένα εργαλεία της κοινότητας.\
Αποκτήστε πρόσβαση σήμερα:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner
