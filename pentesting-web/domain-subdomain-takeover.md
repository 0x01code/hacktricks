# Toma de control de dominio/subdominio

<details>

<summary><strong>Aprende hacking en AWS de cero a h칠roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Experto en Equipos Rojos de AWS de HackTricks)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si deseas ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** 춰Consulta los [**PLANES DE SUSCRIPCI칍N**](https://github.com/sponsors/carlospolop)!
* Obt칠n la [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci칩n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s칤guenos** en **Twitter** 游냕 [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

<figure><img src="../.gitbook/assets/image (48).png" alt=""><figcaption></figcaption></figure>

\
Utiliza [**Trickest**](https://trickest.com/?utm_source=hacktricks&utm_medium=text&utm_campaign=ppc&utm_term=trickest&utm_content=domain-subdomain-takeover) para construir y **automatizar flujos de trabajo** f치cilmente con las herramientas comunitarias **m치s avanzadas** del mundo.\
춰Accede hoy mismo:

{% embed url="https://trickest.com/?utm_source=hacktricks&utm_medium=banner&utm_campaign=ppc&utm_content=domain-subdomain-takeover" %}

## Toma de control de dominio

Si descubres un dominio (dominio.tld) que **est치 siendo utilizado por alg칰n servicio dentro del alcance** pero la **empresa** ha **perdido la propiedad** del mismo, puedes intentar **registrarlo** (si es lo suficientemente barato) y notificar a la empresa. Si este dominio est치 recibiendo alguna **informaci칩n sensible** como una cookie de sesi칩n a trav칠s de un par치metro **GET** o en la cabecera **Referer**, esto es sin duda una **vulnerabilidad**.

### Toma de control de subdominio

Un subdominio de la empresa apunta a un **servicio de terceros con un nombre no registrado**. Si puedes **crear** una **cuenta** en este **servicio de terceros** y **registras** el **nombre** que se est치 utilizando, puedes llevar a cabo la toma de control del subdominio.

Existen varias herramientas con diccionarios para verificar posibles tomas de control:

* [https://github.com/EdOverflow/can-i-take-over-xyz](https://github.com/EdOverflow/can-i-take-over-xyz)
* [https://github.com/blacklanternsecurity/bbot](https://github.com/blacklanternsecurity/bbot)
* [https://github.com/punk-security/dnsReaper](https://github.com/punk-security/dnsReaper)
* [https://github.com/haccer/subjack](https://github.com/haccer/subjack)
* [https://github.com/anshumanbh/tko-sub](https://github.com/anshumanbh/tko-subs)
* [https://github.com/ArifulProtik/sub-domain-takeover](https://github.com/ArifulProtik/sub-domain-takeover)
* [https://github.com/SaadAhmedx/Subdomain-Takeover](https://github.com/SaadAhmedx/Subdomain-Takeover)
* [https://github.com/Ice3man543/SubOver](https://github.com/Ice3man543/SubOver)
* [https://github.com/m4ll0k/takeover](https://github.com/m4ll0k/takeover)
* [https://github.com/antichown/subdomain-takeover](https://github.com/antichown/subdomain-takeover)
* [https://github.com/musana/mx-takeover](https://github.com/musana/mx-takeover)
* [https://github.com/PentestPad/subzy](https://github.com/PentestPad/subzy)

#### Escaneo de subdominios secuestrables con [BBOT](https://github.com/blacklanternsecurity/bbot):

Las comprobaciones de toma de control de subdominios est치n incluidas en la enumeraci칩n de subdominios predeterminada de BBOT. Las firmas se extraen directamente de [https://github.com/EdOverflow/can-i-take-over-xyz](https://github.com/EdOverflow/can-i-take-over-xyz).
```bash
bbot -t evilcorp.com -f subdomain-enum
```
### Generaci칩n de Subdominio Takeover a trav칠s de DNS Wildcard

Cuando se utiliza un comod칤n DNS en un dominio, cualquier subdominio solicitado de ese dominio que no tenga una direcci칩n diferente expl칤citamente ser치 **resuelto a la misma informaci칩n**. Esto podr칤a ser una direcci칩n IP A, un CNAME...

Por ejemplo, si `*.testing.com` est치 comodinado a `1.1.1.1`. Entonces, `not-existent.testing.com` apuntar치 a `1.1.1.1`.

Sin embargo, si en lugar de apuntar a una direcci칩n IP, el administrador de sistemas lo apunta a un **servicio de terceros a trav칠s de un CNAME**, como un **subdominio de github** por ejemplo (`sohomdatta1.github.io`). Un atacante podr칤a **crear su propia p치gina de terceros** (en Github en este caso) y decir que `something.testing.com` est치 apuntando all칤. Debido a que el **comod칤n CNAME** lo permite, el atacante podr치 **generar subdominios arbitrarios para el dominio de la v칤ctima apuntando a sus p치ginas**.

Puedes encontrar un ejemplo de esta vulnerabilidad en el write-up de CTF: [https://ctf.zeyu2001.com/2022/nitectf-2022/undocumented-js-api](https://ctf.zeyu2001.com/2022/nitectf-2022/undocumented-js-api)

## Explotando un subdominio takeover

El subdominio takeover es esencialmente un spoofing DNS para un dominio espec칤fico en Internet, lo que permite a los atacantes establecer registros A para un dominio, haciendo que los navegadores muestren contenido desde el servidor del atacante. Esta **transparencia** en los navegadores hace que los dominios sean propensos a phishing. Los atacantes pueden emplear [_typosquatting_](https://en.wikipedia.org/wiki/Typosquatting) o [_Doppelganger domains_](https://en.wikipedia.org/wiki/Doppelg%C3%A4nger) con este prop칩sito. Especialmente vulnerables son los dominios donde la URL en un correo electr칩nico de phishing parece leg칤tima, enga침ando a los usuarios y evadiendo los filtros de spam debido a la confianza inherente del dominio.

Consulta este [post para m치s detalles](https://0xpatrik.com/subdomain-takeover/)

### **Certificados SSL**

Los certificados SSL, si son generados por atacantes a trav칠s de servicios como [_Let's Encrypt_](https://letsencrypt.org/), a침aden legitimidad a estos dominios falsos, haciendo que los ataques de phishing sean m치s convincentes.

### **Seguridad de Cookies y Transparencia del Navegador**

La transparencia del navegador tambi칠n se extiende a la seguridad de las cookies, gobernada por pol칤ticas como la [pol칤tica de mismo origen](https://es.wikipedia.org/wiki/Pol%C3%ADtica_del_mismo_origen). Las cookies, a menudo utilizadas para gestionar sesiones y almacenar tokens de inicio de sesi칩n, pueden ser explotadas a trav칠s de un subdominio takeover. Los atacantes pueden **recopilar cookies de sesi칩n** simplemente dirigiendo a los usuarios a un subdominio comprometido, poniendo en peligro los datos y la privacidad del usuario.

### **Correos Electr칩nicos y Subdominio Takeover**

Otro aspecto del subdominio takeover implica servicios de correo electr칩nico. Los atacantes pueden manipular los **registros MX** para recibir o enviar correos electr칩nicos desde un subdominio leg칤timo, mejorando la eficacia de los ataques de phishing.

### **Riesgos de Orden Superior**

Otros riesgos incluyen el **takeover de registros NS**. Si un atacante obtiene control sobre un registro NS de un dominio, potencialmente puede dirigir una parte del tr치fico a un servidor bajo su control. Este riesgo se amplifica si el atacante establece un alto **TTL (Tiempo de Vida)** para los registros DNS, prolongando la duraci칩n del ataque.

### Vulnerabilidad de Registro CNAME

Los atacantes pueden explotar registros CNAME no reclamados que apuntan a servicios externos que ya no se utilizan o han sido desactivados. Esto les permite crear una p치gina bajo el dominio de confianza, facilitando a칰n m치s el phishing o la distribuci칩n de malware.

### **Estrategias de Mitigaci칩n**

Las estrategias de mitigaci칩n incluyen:

1. **Eliminar registros DNS vulnerables** - Esto es efectivo si el subdominio ya no es necesario.
2. **Reclamar el nombre de dominio** - Registrar el recurso con el proveedor de la nube respectivo o recomprar un dominio caducado.
3. **Monitoreo regular de vulnerabilidades** - Herramientas como [aquatone](https://github.com/michenriksen/aquatone) pueden ayudar a identificar dominios susceptibles. Las organizaciones tambi칠n deben revisar sus procesos de gesti칩n de infraestructura, asegurando que la creaci칩n de registros DNS sea el 칰ltimo paso en la creaci칩n de recursos y el primer paso en la destrucci칩n de recursos.

Para los proveedores de nube, verificar la propiedad del dominio es crucial para prevenir subdominio takeovers. Algunos, como [GitLab](https://about.gitlab.com/2018/02/05/gitlab-pages-custom-domain-validation/), han reconocido este problema e implementado mecanismos de verificaci칩n de dominio.

## Referencias

* [https://0xpatrik.com/subdomain-takeover/](https://0xpatrik.com/subdomain-takeover/)

<figure><img src="../.gitbook/assets/image (48).png" alt=""><figcaption></figcaption></figure>

\
Utiliza [**Trickest**](https://trickest.com/?utm_source=hacktricks&utm_medium=text&utm_campaign=ppc&utm_term=trickest&utm_content=domain-subdomain-takeover) para construir y **automatizar flujos de trabajo** f치cilmente con las herramientas comunitarias m치s avanzadas del mundo.\
Accede hoy mismo:

{% embed url="https://trickest.com/?utm_source=hacktricks&utm_medium=banner&utm_campaign=ppc&utm_content=domain-subdomain-takeover" %}

<details>

<summary><strong>Aprende hacking en AWS desde cero hasta experto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si deseas ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** 춰Consulta los [**PLANES DE SUSCRIPCI칍N**](https://github.com/sponsors/carlospolop)!
* Obt칠n el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci칩n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s칤guenos** en **Twitter** 游냕 [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
