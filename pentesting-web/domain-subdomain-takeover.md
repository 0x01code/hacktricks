# Prise de contr√¥le de domaine/sous-domaine

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**merchandising officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux d√©p√¥ts github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
Utilisez [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) pour construire et **automatiser des workflows** gr√¢ce aux outils communautaires **les plus avanc√©s**.\
Acc√©dez-y d√®s aujourd'hui :

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## Prise de contr√¥le de domaine

Si vous d√©couvrez un domaine (domain.tld) qui est **utilis√© par un service dans le p√©rim√®tre** mais que l'**entreprise** a **perdu la propri√©t√©** de celui-ci, vous pouvez essayer de le **enregistrer** (si le prix est raisonnable) et informer l'entreprise. Si ce domaine re√ßoit des **informations sensibles** comme un cookie de session via un param√®tre **GET** ou dans l'en-t√™te **Referer**, c'est assur√©ment une **vuln√©rabilit√©**.

### Prise de contr√¥le de sous-domaine

Un sous-domaine de l'entreprise pointe vers un **service tiers avec un nom non enregistr√©**. Si vous pouvez **cr√©er** un **compte** dans ce **service tiers** et **enregistrer** le **nom** en usage, vous pouvez r√©aliser la prise de contr√¥le du sous-domaine.

Il existe plusieurs outils avec des dictionnaires pour v√©rifier les prises de contr√¥le possibles :

* [https://github.com/EdOverflow/can-i-take-over-xyz](https://github.com/EdOverflow/can-i-take-over-xyz)
* [https://github.com/blacklanternsecurity/bbot](https://github.com/blacklanternsecurity/bbot)
* [https://github.com/punk-security/dnsReaper](https://github.com/punk-security/dnsReaper)
* [https://github.com/haccer/subjack](https://github.com/haccer/subjack)
* [https://github.com/anshumanbh/tko-sub](https://github.com/anshumanbh/tko-subs)
* [https://github.com/ArifulProtik/sub-domain-takeover](https://github.com/ArifulProtik/sub-domain-takeover)
* [https://github.com/SaadAhmedx/Subdomain-Takeover](https://github.com/SaadAhmedx/Subdomain-Takeover)
* [https://github.com/Ice3man543/SubOver](https://github.com/Ice3man543/SubOver)
* [https://github.com/m4ll0k/takeover](https://github.com/m4ll0k/takeover)
* [https://github.com/antichown/subdomain-takeover](https://github.com/antichown/subdomain-takeover)
* [https://github.com/musana/mx-takeover](https://github.com/musana/mx-takeover)

#### Analyse des sous-domaines susceptibles d'√™tre d√©tourn√©s avec [BBOT](https://github.com/blacklanternsecurity/bbot) :

Les v√©rifications de prise de contr√¥le de sous-domaine sont incluses dans l'√©num√©ration par d√©faut des sous-domaines de BBOT. Les signatures sont directement extraites de [https://github.com/EdOverflow/can-i-take-over-xyz](https://github.com/EdOverflow/can-i-take-over-xyz).
```bash
bbot -t evilcorp.com -f subdomain-enum
```
### Prise de contr√¥le de sous-domaine via DNS Wildcard

Lorsqu'un DNS wildcard est utilis√© dans un domaine, tout sous-domaine demand√© de ce domaine qui n'a pas d'adresse explicitement diff√©rente sera **r√©solu avec les m√™mes informations**. Cela pourrait √™tre une adresse IP A, un CNAME...

Par exemple, si `*.testing.com` est redirig√© par wildcard vers `1.1.1.1`. Alors, `not-existent.testing.com` pointera vers `1.1.1.1`.

Cependant, si au lieu de pointer vers une adresse IP, le sysadmin le redirige vers un **service tiers via CNAME**, comme un **sous-domaine github** par exemple (`sohomdatta1.github.io`). Un attaquant pourrait **cr√©er sa propre page tierce** (sur Github dans ce cas) et dire que `something.testing.com` pointe l√†-bas. Parce que, le **CNAME wildcard** sera d'accord, l'attaquant pourra **g√©n√©rer des sous-domaines arbitraires pour le domaine de la victime pointant vers ses pages**.

Vous pouvez trouver un exemple de cette vuln√©rabilit√© dans le compte-rendu du CTF : [https://ctf.zeyu2001.com/2022/nitectf-2022/undocumented-js-api](https://ctf.zeyu2001.com/2022/nitectf-2022/undocumented-js-api)

## Exploiter une prise de contr√¥le de sous-domaine

**Cette information a √©t√© copi√©e de** [**https://0xpatrik.com/subdomain-takeover/**](https://0xpatrik.com/subdomain-takeover/)

R√©cemment, j'ai [√©crit](https://0xpatrik.com/subdomain-takeover-basics/) sur les bases de la prise de contr√¥le de sous-domaine. Bien que le concept soit maintenant g√©n√©ralement bien compris, j'ai remarqu√© que les gens ont g√©n√©ralement du mal √† saisir les risques que cela repr√©sente. Dans cet article, je vais en profondeur et couvre les risques les plus notables de _prise de contr√¥le de sous-domaine_ de mon point de vue.

_Note : Certains risques sont att√©nu√©s implicitement par le fournisseur de cloud. Par exemple, lorsque la prise de contr√¥le de sous-domaine est possible sur Amazon CloudFront, il n'y a aucun moyen de configurer des enregistrements TXT pour contourner les v√©rifications SPF. L'article vise donc √† fournir des risques sur la prise de contr√¥le de sous-domaine en g√©n√©ral. N√©anmoins, la plupart de ces risques s'appliquent √©galement aux fournisseurs de cloud._

### Transparence pour un navigateur <a href="#transparencytoabrowser" id="transparencytoabrowser"></a>

Pour commencer, examinons la r√©solution DNS o√π CNAME est impliqu√© :

![R√©solution DNS](https://0xpatrik.com/content/images/2018/05/resolution-2.png)

Notez que l'√©tape #7 demande _sub.example.com_ plut√¥t que _anotherdomain.com_. C'est parce que le navigateur web n'est pas conscient que _anotherdomain.com_ existe m√™me. M√™me si l'enregistrement CNAME est utilis√©, la barre d'URL dans le navigateur contient toujours _sub.example.com_. C'est la **transparence** pour le navigateur. Si vous y pensez, le navigateur fait enti√®rement confiance au r√©solveur DNS pour fournir des informations pr√©cises sur le domaine. Simplifi√©, la prise de contr√¥le de sous-domaine est un spoofing DNS pour un domaine particulier sur Internet. Pourquoi ? Parce que tout navigateur effectuant la r√©solution DNS sur le domaine affect√© re√ßoit un enregistrement A d√©fini par un attaquant. Le navigateur affiche alors joyeusement tout ce qui est re√ßu de ce serveur (pensant que c'est l√©gitime).

Un tel domaine constitue un sc√©nario parfait pour le phishing. Les attaquants utilisent souvent le [_typosquatting_](https://en.wikipedia.org/wiki/Typosquatting) ou les soi-disant [_Doppelganger domains_](https://en.wikipedia.org/wiki/Doppelg%C3%A4nger) pour imiter le domaine/site web l√©gitime √† des fins de phishing. Apr√®s qu'un attaquant a pris le contr√¥le d'un nom de domaine l√©gitime, il est presque impossible pour un utilisateur r√©gulier de dire si le contenu sur le domaine est fourni par une partie l√©gitime ou un attaquant. Prenons par exemple une banque al√©atoire. Si l'un des sous-domaines de la banque est vuln√©rable √† la prise de contr√¥le de sous-domaine, un attaquant peut cr√©er un formulaire HTML qui imite le formulaire de connexion au syst√®me de banque en ligne de la banque. Ensuite, un attaquant peut lancer une campagne de phishing cibl√©e ou de masse demandant aux utilisateurs de se connecter et de changer leurs mots de passe. √Ä ce stade, les mots de passe sont captur√©s par un attaquant qui contr√¥le le domaine en question. L'URL fournie dans l'e-mail de phishing est un sous-domaine l√©gitime d'une banque. Par cons√©quent, les utilisateurs ne sont pas conscients de quelque chose de malveillant. Les filtres anti-spam et autres mesures de s√©curit√© sont √©galement moins susceptibles de d√©clencher l'e-mail comme spam ou malveillant car il contient des noms de domaine de confiance plus √©lev√©e.

En effet, le nom de domaine lui-m√™me joue un r√¥le significatif dans une campagne r√©ussie. Avoir un sous-domaine de 5√®me niveau vuln√©rable √† la prise de contr√¥le de sous-domaine est beaucoup moins _"l√©gitime"_ qu'avoir un sous-domaine de 2√®me niveau avec un nom de sous-domaine convivial. J'ai vu plusieurs exemples de sous-domaines parfaits pour le phishing, y compris :

* _purchases.SOMETHING.com_
* _www.SOMETHING.com_
* _online.SOMETHING.com_
* _shop.SOMETHING.com_

Tous vuln√©rables √† la prise de contr√¥le de sous-domaine. Tous √©taient de grandes marques. Parler de phishing parfait ?

N√©anmoins, les campagnes de phishing r√©centes h√©bergent du contenu sur des domaines avec de longs noms de domaine qui incluent le nom de la marque (voir [exemple Apple](https://www.phishtank.com/target\_search.php?target\_id=183\&valid=y\&active=All\&Search=Search)). Ayant un certificat SSL valide (plus √† ce sujet ci-dessous), un mot-cl√© dans le nom de domaine et un site web qui imite le site web de la marque cibl√©e, les gens ont tendance √† tomber dans ces attaques. Pensez aux chances avec un sous-domaine l√©gitime de cette marque.

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
Utilisez [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) pour construire et **automatiser des workflows** aliment√©s par les outils communautaires **les plus avanc√©s**.\
Obtenez l'acc√®s aujourd'hui :

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

### Certificats SSL <a href="#sslcertificates" id="sslcertificates"></a>

L'attaque ci-dessus peut √™tre renforc√©e en g√©n√©rant un certificat SSL valide. Des autorit√©s de certification telles que [_Let's Encrypt_](https://letsencrypt.org/) permettent la v√©rification automatique de la propri√©t√© d'un domaine par v√©rification de contenu :

![Flux Let's Encrypt](https://0xpatrik.com/content/images/2018/05/letsencrypt.png)

C'est-√†-dire, s'il y a un contenu sp√©cifique plac√© sur un chemin d'URL sp√©cifique, Let's Encrypt approuvera l'√©mission d'un certificat pour un domaine donn√©. Puisqu'un attaquant a un contr√¥le total sur le contenu du domaine qui est vuln√©rable √† la prise de contr√¥le de sous-domaine, cette v√©rification peut √™tre effectu√©e en quelques minutes. Par cons√©quent, les attaquants sont √©galement capables de g√©n√©rer un certificat SSL pour un tel domaine, ce qui ne fait que diminuer les soup√ßons d'une attaque de phishing.

### Vol de cookies <a href="#cookiestealing" id="cookiestealing"></a>

Cela va de pair avec la transparence du navigateur mais a des cons√©quences diff√©rentes. Le navigateur web impl√©mente de nombreuses politiques de s√©curit√© pour emp√™cher les sites web malveillants de causer des dommages. Cela inclut des choses telles que la [politique de m√™me origine](https://en.wikipedia.org/wiki/Same-origin\_policy). L'une des principales responsabilit√©s de s√©curit√© d'un navigateur est de s√©curiser les cookies enregistr√©s. Pourquoi ? Alors que HTTP est un protocole sans √©tat, les cookies sont utilis√©s pour suivre les sessions. Pour plus de commodit√©, les utilisateurs enregistrent souvent des cookies pour une p√©riode prolong√©e pour √©viter de se connecter √† chaque fois. Ces cookies agissent donc comme un jeton de connexion qui est pr√©sent√© au serveur web et l'utilisateur est identifi√©. Des attaques telles que le [_d√©tournement de session_](https://en.wikipedia.org/wiki/Session\_hijacking) ont naturellement √©volu√© √† partir de ce concept.

Le navigateur pr√©sente automatiquement les cookies enregistr√©s √† chaque requ√™te au domaine qui les a √©mis. Il existe une exception √† cela, √† savoir que les cookies pourraient √™tre partag√©s entre sous-domaines ([lire ici](https://tools.ietf.org/html/rfc6265#section-8.6), notez √©galement la section 8.7). Cela se produit g√©n√©ralement lorsque le site web utilise un syst√®me de [Single sign-on](https://en.wikipedia.org/wiki/Single\_sign-on) (SSO) bas√© sur des cookies. En utilisant SSO, un utilisateur peut se connecter en utilisant un sous-domaine et partager le m√™me jeton de session sur une large gamme de sous-domaines. La syntaxe pour d√©finir un cookie r√©gulier est la suivante :
```
HTTP/1.1 200 OK
Set-Cookie: name=value
```
Si ce cookie est √©mis par un serveur web r√©sidant sur _example.com_, seul ce serveur peut acc√©der √† ce cookie ult√©rieurement. Cependant, le cookie peut √™tre √©mis pour un domaine g√©n√©rique (pour les raisons expliqu√©es ci-dessus) de la mani√®re suivante :
```
HTTP/1.1 200 OK
Set-Cookie: name=value; domain=example.com
```
```markdown
Le cookie sera inclus dans les requ√™tes HTTP vers _example.com_ mais aussi vers tout autre sous-domaine tel que _subdomain.example.com_. Ce comportement cr√©e une possibilit√© d'attaques de haute gravit√© utilisant la prise de contr√¥le de sous-domaine. Supposons qu'un domaine particulier utilise des cookies de session pour un domaine g√©n√©rique. S'il y a un sous-domaine vuln√©rable √† la prise de contr√¥le de sous-domaine, la seule chose n√©cessaire pour recueillir le jeton de session de l'utilisateur est de le tromper pour qu'il visite le sous-domaine vuln√©rable. Le cookie de session est automatiquement envoy√© avec la requ√™te HTTP.

Le navigateur impl√©mente √©galement des m√©canismes de s√©curit√© suppl√©mentaires pour les cookies :

* **Cookie HttpOnly** ‚Äî Par d√©faut, les cookies peuvent √™tre acc√©d√©s par le code Javascript ex√©cut√© dans le contexte du site web qui a cr√©√© les cookies. Javascript peut lire, mettre √† jour et supprimer les cookies. Le drapeau de cookie _HttpOnly_ (d√©fini par le serveur web) indique que le cookie particulier ne peut pas √™tre acc√©d√© par le code Javascript. La seule fa√ßon de l'obtenir est √† travers les en-t√™tes de requ√™te et de r√©ponse HTTP.
* **Cookie Secure** ‚Äî Lorsque le cookie a le drapeau _Secure_ d√©fini par le serveur web, il ne peut √™tre communiqu√© au serveur web que si HTTPS est utilis√©.

Si le domaine est vuln√©rable √† la prise de contr√¥le de sous-domaine, un attaquant peut recueillir des cookies √©mis par ce domaine dans le pass√© simplement en trompant les utilisateurs pour qu'ils visitent ce site web. Les drapeaux HttpOnly et Secure n'aident pas puisque le cookie n'est pas acc√©d√© en utilisant Javascript et un certificat SSL peut √™tre facilement g√©n√©r√© pour le domaine pris.

Le vol de cookies utilisant la prise de contr√¥le a √©t√© expliqu√© dans le [rapport](https://hackerone.com/reports/172137) de bug bounty par Arne Swinnen. Le rapport explique le probl√®me avec l'un des sous-domaines de _Ubiquiti Networks_ (_ping.ubnt.com_). Ce sous-domaine √©tait vuln√©rable √† la prise de contr√¥le de sous-domaine, pointant vers une distribution AWS CloudFront non r√©clam√©e. Puisque Ubiquiti Networks utilise SSO avec des cookies de session g√©n√©riques, tous les utilisateurs visitant _ping.ubnt.com_ pourraient se faire voler leurs cookies de session. M√™me si ce domaine pointe vers AWS CloudFront, les param√®tres de distribution CloudFront permettent de consigner les cookies avec chaque requ√™te. Par cons√©quent, le sc√©nario d'extraction de cookies de session est enti√®rement possible m√™me avec des sous-domaines pointant vers AWS CloudFront. En 2017, Arne a √©galement d√©montr√© un vecteur d'attaque similaire contre [le syst√®me SSO d'Uber](https://www.arneswinnen.net/2017/06/authentication-bypass-on-ubers-sso-via-subdomain-takeover/).

Le comportement expliqu√© ci-dessus n'est pas limit√© aux cookies. Puisque les scripts Javascript ont un contr√¥le total sur les sites web sur lesquels ils sont ex√©cut√©s, avoir la capacit√© de remplacer de tels scripts sur le site web l√©gitime pourrait conduire √† des cons√©quences catastrophiques. Supposons que le site web utilise du code Javascript d'un fournisseur externe en utilisant la balise _script_ et l'attribut _src_. Lorsque le domaine du fournisseur externe expire, le navigateur √©choue silencieusement, c'est-√†-dire qu'il ne d√©clenche aucune alerte visible pour les utilisateurs r√©guliers. Si le code externe ne fait rien d'important (par exemple, il est utilis√© uniquement pour le suivi), un tel fournisseur externe pourrait rester sur le site web pendant une p√©riode prolong√©e. Un attaquant peut prendre le contr√¥le de ce domaine expir√©, correspondre au chemin URL du code Javascript fourni et ainsi prendre le contr√¥le de chaque visiteur qui visite le site web original.

Cependant, il existe un moyen de prot√©ger l'int√©grit√© des fichiers Javascript dans un navigateur. _Subresource Integrity_ [a √©t√© propos√©](https://www.w3.org/TR/2016/REC-SRI-20160623/) comme m√©canisme pour inclure une empreinte cryptographique en tant qu'attribut _integrity_ √† la balise _script_ dans HTML5. Lorsque l'empreinte cryptographique fournie ne correspond pas au fichier t√©l√©charg√©, le navigateur refuse de l'ex√©cuter.

### E-mails <a href="#emails" id="emails"></a>

Lorsqu'une prise de contr√¥le de sous-domaine CNAME est possible, les enregistrements MX peuvent √©galement √™tre configur√©s par un attaquant vers un serveur web arbitraire. Cela permet de recevoir des e-mails vers un sous-domaine l√©gitime d'une marque - particuli√®rement utile encore une fois dans les attaques de (spear) phishing o√π une interaction entre un attaquant et une victime est n√©cessaire. Les attaquants usurpent g√©n√©ralement l'en-t√™te `Return-Path` pour recevoir une r√©ponse √† l'e-mail. Avec les bons enregistrements MX, ce probl√®me est contourn√©.

D'autre part, l'envoi d'e-mails est √©galement possible. Bien qu'il soit trivial de falsifier l'en-t√™te `From` pour inclure n'importe quelle adresse e-mail, les filtres SPF v√©rifient g√©n√©ralement l'en-t√™te `Return-Path` et les h√¥tes autoris√©s √† envoyer des mails pour le domaine. SPF stocke la configuration dans les enregistrements DNS TXT. Avec la prise de contr√¥le de sous-domaine, les enregistrements TXT sont √©galement sous le contr√¥le de l'attaquant - les v√©rifications SPF peuvent √™tre facilement contourn√©es.

_Comme je l'ai not√© au d√©but, ces tactiques ne fonctionnent g√©n√©ralement pas avec la majorit√© des fournisseurs de cloud puisque vous n'avez pas de contr√¥le direct sur la zone DNS._

### Risques de Haut Niveau <a href="#higherorderrisks" id="higherorderrisks"></a>

Le concept de prise de contr√¥le de sous-domaine peut √™tre naturellement √©tendu aux enregistrements NS : Si le domaine de base d'au moins un enregistrement NS est disponible √† l'enregistrement, le nom de domaine source est vuln√©rable √† la prise de contr√¥le de sous-domaine.

L'un des probl√®mes de la prise de contr√¥le de sous-domaine utilisant un enregistrement NS est que le nom de domaine source a g√©n√©ralement plusieurs enregistrements NS. Plusieurs enregistrements NS sont utilis√©s pour la redondance et l'√©quilibrage de charge. Le serveur de noms est choisi al√©atoirement avant la r√©solution DNS. Supposons que le domaine _sub.example.com_ ait deux enregistrements NS : _ns.vulnerable.com_ et _ns.nonvulnerable.com_. Si un attaquant prend le contr√¥le de _ns.vulnerable.com_, la situation du point de vue de l'utilisateur qui interroge _sub.example.com_ se pr√©sente comme suit :

1. Puisqu'il y a deux serveurs de noms, l'un est choisi al√©atoirement. Cela signifie que la probabilit√© d'interroger le serveur de noms contr√¥l√© par un attaquant est de 50%.
2. Si le r√©solveur DNS de l'utilisateur choisit _ns.nonvulnerable.com_ (serveur de noms l√©gitime), le r√©sultat correct est retourn√© et probablement mis en cache quelque part entre 6 et 24 heures.
3. Si le r√©solveur DNS de l'utilisateur choisit _ns.vulnerable.com_ (serveur de noms poss√©d√© par un attaquant), un attaquant peut fournir un faux r√©sultat qui sera √©galement mis en cache. Puisque l'attaquant contr√¥le le serveur de noms, elle peut d√©finir le TTL pour ce r√©sultat particulier √† √™tre par exemple une semaine.

Le processus ci-dessus est r√©p√©t√© chaque fois que l'entr√©e de cache expire. Lorsqu'un attaquant choisit d'utiliser un TTL avec une valeur √©lev√©e, le faux r√©sultat restera dans le cache DNS pour cette p√©riode. Pendant ce temps, toutes les requ√™tes vers _sub.example.com_ utiliseront le faux r√©sultat DNS mis en cache par un attaquant. Cette id√©e est encore amplifi√©e lorsque des r√©solveurs DNS publics (par exemple, Google DNS) sont utilis√©s. Dans ce cas, les r√©solveurs publics sont susceptibles de mettre en cache les faux r√©sultats, ce qui signifie que tous les utilisateurs utilisant le m√™me r√©solveur DNS obtiendront des faux r√©sultats jusqu'√† ce que le cache soit r√©voqu√©.

En plus du contr√¥le sur le nom de domaine source, le contr√¥le sur tous les domaines de niveau sup√©rieur du nom de domaine source est √©galement acquis. C'est parce que poss√©der un nom de domaine canonique d'un enregistrement NS signifie poss√©der la zone DNS compl√®te du nom de domaine source.

En 2016, Matthew Bryant [a d√©montr√©](https://thehackerblog.com/the-international-incident-gaining-control-of-a-int-domain-name-with-dns-trickery/index.html) une prise de contr√¥le de sous-domaine utilisant un enregistrement NS sur _maris.int_. Le domaine de premier niveau .INT est un TLD sp√©cial, et seulement une poign√©e de domaines l'utilisent. Bryant a montr√© que m√™me si l'enregistrement de tels noms de domaine est approuv√© exclusivement par l'IANA, les serveurs de noms peuvent √™tre d√©finis vers des domaines arbitraires. Puisque l'un des serveurs de noms de _maris.int_ √©tait disponible √† l'enregistrement (_cobalt.aliis.be_), la prise de contr√¥le de sous-domaine √©tait possible m√™me sur ce TLD restreint.

Matthew a √©galement [d√©montr√©](https://thehackerblog.com/the-io-error-taking-control-of-all-io-domains-with-a-targeted-registration/index.html) une attaque de gravit√© encore plus √©lev√©e o√π il a pu prendre le contr√¥le du serveur de noms du domaine de premier niveau .IO. Contr√¥ler .IO signifie contr√¥ler les r√©ponses pour tous les noms de domaine .IO. Dans ce cas, l'un des serveurs de noms de .IO √©tait _ns-a1.io_ qui √©tait disponible √† l'enregistrement. En enregistrant _ns-a1.io_, Bryant a pu recevoir des requ√™tes DNS et contr√¥ler leurs r√©ponses pour tous les domaines .IO.

### Att√©nuation <a href="#mitigation" id="mitigation"></a>

Les strat√©gies d'att√©nuation pour les noms de domaine d√©j√† vuln√©rables √† la prise de contr√¥le de sous-domaine sont plut√¥t simples :

* **Supprimer l'enregistrement DNS affect√©** ‚Äî La solution la plus simple est de supprimer l'enregistrement affect√© de la zone DNS. Cette √©tape est g√©n√©ralement utilis√©e si l'organisation conclut que le nom de domaine source affect√© n'est plus n√©cessaire.
* **R√©clamer le nom de domaine** ‚Äî Cela signifie enregistrer la ressource chez le fournisseur de cloud particulier ou, dans le cas d'un domaine Internet r√©gulier, racheter le domaine expir√©.

Pour pr√©venir la prise de contr√¥le de sous-domaine √† l'avenir, les organisations devraient changer le processus de cr√©ation et de destruction des ressources dans leur infrastructure. Dans le cas de la cr√©ation de ressource, la cr√©ation de l'enregistrement DNS doit √™tre la _derni√®re √©tape_ de ce processus. Cette condition emp√™che l'enregistrement DNS de pointer vers un domaine non existant √† tout moment. Pour la destruction de la ressource, l'oppos√© est vrai : l'enregistrement DNS doit √™tre supprim√© comme la _premi√®re √©tape_ de ce processus. Des outils tels que [aquatone](https://github.com/michenriksen/aquatone) incluent des v√©rifications pour la prise de contr√¥le de sous-domaine. Les v√©rifications devraient √™tre effectu√©es p√©riodiquement par une √©quipe de s√©curit√© d'une organisation pour v√©rifier qu'il n'y a pas de domaines vuln√©rables. Les processus de collecte centralis√©e des noms de domaine expos√©s ne sont souvent pas efficaces au sein des organisations (en raison des √©quipes mondiales, etc.) et la surveillance externe est g√©n√©ralement la meilleure solution.

La strat√©gie d'att√©nuation pour les fournisseurs de cloud devrait √©galement √™tre consid√©r√©e. Les services cloud ne v√©rifient pas la propri√©t√© du domaine. La raison derri√®re cela est principalement la commodit√©. Le fournisseur de cloud n'introduit pas de vuln√©rabilit√© en ne v√©rifiant pas la propri√©t√© d'un nom de domaine source. Il appartient donc √† l'utilisateur de surveiller ses enregistrements DNS. Une autre raison est que, lorsque la ressource cloud est supprim√©e, l'utilisateur n'est g√©n√©ralement plus un client de ce service. La question que se posent alors les fournisseurs de cloud est : Pourquoi devrions-nous m√™me nous en soucier ?

Des fournisseurs tels que [GitLab](https://about.gitlab.com/2018/02/05/gitlab-pages-custom-domain-validation/) ont r√©alis√© que la prise de contr√¥le de sous-domaine est un probl√®me et ont mis en place un m√©canisme de v√©rification de domaine.

_Certaines parties de ce post sont des extraits de ma_ [_Th√®se de Master_](https://is.muni.cz/th/byrdn/Thesis.pdf).

√Ä la prochaine !

[Patrik](https://twitter.com/0xpatrik)

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
Utilisez [**Trickest**](https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks) pour construire et **automatiser des workflows** aliment√©s par les outils communautaires **les plus avanc√©s** au monde.\
Obtenez l'acc√®s aujourd'hui :

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><strong>Apprenez le hacking AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF** Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**merchandising officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de hacking en soumettant des PR aux repos github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
```
