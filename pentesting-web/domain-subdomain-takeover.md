# Domain/Subdomain √úbernahme

<details>

<summary><strong>Lernen Sie AWS-Hacking von Grund auf mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks bewerben m√∂chten** oder **HackTricks als PDF herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merchandise**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositories senden.

</details>

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
Verwenden Sie [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks), um Workflows einfach zu erstellen und zu automatisieren, die von den fortschrittlichsten Community-Tools der Welt unterst√ºtzt werden.\
Erhalten Sie noch heute Zugriff:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## Domain-√úbernahme

Wenn Sie eine Domain (domain.tld) entdecken, die von einem Dienst innerhalb des Geltungsbereichs verwendet wird, aber das **Unternehmen** die **Eigent√ºmerschaft** daran **verloren** hat, k√∂nnen Sie versuchen, sie zu **registrieren** (wenn sie billig genug ist) und dem Unternehmen Bescheid zu geben. Wenn √ºber diese Domain sensible Informationen wie ein Sitzungscookie √ºber den **GET**-Parameter oder im **Referer**-Header √ºbertragen werden, handelt es sich hierbei definitiv um eine **Sicherheitsl√ºcke**.

### Subdomain-√úbernahme

Eine Subdomain des Unternehmens verweist auf einen **Drittanbieterdienst mit einem nicht registrierten Namen**. Wenn Sie ein Konto in diesem Drittanbieterdienst **erstellen** und den **verwendeten Namen** registrieren k√∂nnen, k√∂nnen Sie die Subdomain √ºbernehmen.

Es gibt mehrere Tools mit W√∂rterb√ºchern, um m√∂gliche √úbernahmen zu √ºberpr√ºfen:

* [https://github.com/EdOverflow/can-i-take-over-xyz](https://github.com/EdOverflow/can-i-take-over-xyz)
* [https://github.com/blacklanternsecurity/bbot](https://github.com/blacklanternsecurity/bbot)
* [https://github.com/punk-security/dnsReaper](https://github.com/punk-security/dnsReaper)
* [https://github.com/haccer/subjack](https://github.com/haccer/subjack)
* [https://github.com/anshumanbh/tko-sub](https://github.com/anshumanbh/tko-subs)
* [https://github.com/ArifulProtik/sub-domain-takeover](https://github.com/ArifulProtik/sub-domain-takeover)
* [https://github.com/SaadAhmedx/Subdomain-Takeover](https://github.com/SaadAhmedx/Subdomain-Takeover)
* [https://github.com/Ice3man543/SubOver](https://github.com/Ice3man543/SubOver)
* [https://github.com/m4ll0k/takeover](https://github.com/m4ll0k/takeover)
* [https://github.com/antichown/subdomain-takeover](https://github.com/antichown/subdomain-takeover)
* [https://github.com/musana/mx-takeover](https://github.com/musana/mx-takeover)

#### Scannen nach √ºbernehmbaren Subdomains mit [BBOT](https://github.com/blacklanternsecurity/bbot):

Subdomain-√úbernahmen werden in der standardm√§√üigen Subdomain-Enumeration von BBOT √ºberpr√ºft. Die Signaturen werden direkt von [https://github.com/EdOverflow/can-i-take-over-xyz](https://github.com/EdOverflow/can-i-take-over-xyz) abgerufen.
```bash
bbot -t evilcorp.com -f subdomain-enum
```
### Generierung einer Subdomain-√úbernahme √ºber DNS-Wildcard

Wenn eine DNS-Wildcard in einer Domain verwendet wird, wird jede angeforderte Subdomain dieser Domain, f√ºr die keine andere Adresse explizit angegeben ist, auf die **gleichen Informationen aufgel√∂st**. Dies kann eine A-IP-Adresse, ein CNAME usw. sein.

Beispielsweise wird `*.testing.com` auf `1.1.1.1` wildgecardet. Dann wird `not-existent.testing.com` auf `1.1.1.1` zeigen.

Wenn jedoch anstelle einer IP-Adresse der Sysadmin es auf einen **Drittanbieterdienst √ºber CNAME** zeigt, wie z.B. eine **Github-Subdomain** (`sohomdatta1.github.io`). Ein Angreifer k√∂nnte seine eigene Drittanbieterseite (in diesem Fall auf Github) erstellen und behaupten, dass `something.testing.com` dorthin zeigt. Da die **CNAME-Wildcard** zustimmt, wird der Angreifer in der Lage sein, **beliebige Subdomains f√ºr die Domain des Opfers zu generieren, die auf seine Seiten zeigen**.

Ein Beispiel f√ºr diese Schwachstelle finden Sie im CTF-Write-up: [https://ctf.zeyu2001.com/2022/nitectf-2022/undocumented-js-api](https://ctf.zeyu2001.com/2022/nitectf-2022/undocumented-js-api)

## Ausnutzung einer Subdomain-√úbernahme

Eine Subdomain-√úbernahme ist im Wesentlichen DNS-Spoofing f√ºr eine bestimmte Domain im Internet, das Angreifern erm√∂glicht, A-Records f√ºr eine Domain festzulegen, sodass Browser Inhalte vom Server des Angreifers anzeigen. Diese **Transparenz** in Browsern macht Domains anf√§llig f√ºr Phishing. Angreifer k√∂nnen hierf√ºr [_Typosquatting_](https://de.wikipedia.org/wiki/Typosquatting) oder [_Doppelg√§nger-Domains_](https://de.wikipedia.org/wiki/Doppelg%C3%A4nger) verwenden. Besonders gef√§hrdet sind Domains, bei denen die URL in einer Phishing-E-Mail legitim erscheint und Benutzer t√§uscht sowie Spamfilter aufgrund des inh√§renten Vertrauens der Domain umgeht.

Weitere Details finden Sie in diesem [Beitrag](https://0xpatrik.com/subdomain-takeover/).

### **SSL-Zertifikate**
SSL-Zertifikate, die von Angreifern √ºber Dienste wie [_Let's Encrypt_](https://letsencrypt.org/) generiert werden, erh√∂hen die Legitimit√§t dieser gef√§lschten Domains und machen Phishing-Angriffe √ºberzeugender.

### **Cookie-Sicherheit und Browser-Transparenz**
Die Browser-Transparenz erstreckt sich auch auf die Cookie-Sicherheit, die durch Richtlinien wie die [Same-Origin-Richtlinie](https://de.wikipedia.org/wiki/Same-Origin-Policy) geregelt wird. Cookies, die h√§ufig zur Verwaltung von Sitzungen und zur Speicherung von Anmeldeinformationen verwendet werden, k√∂nnen durch Subdomain-√úbernahme ausgenutzt werden. Angreifer k√∂nnen **Sitzungscookies sammeln**, indem sie Benutzer einfach auf eine kompromittierte Subdomain leiten und so Benutzerdaten und Privatsph√§re gef√§hrden.

### **E-Mails und Subdomain-√úbernahme**
Ein weiterer Aspekt der Subdomain-√úbernahme betrifft E-Mail-Dienste. Angreifer k√∂nnen **MX-Records** manipulieren, um E-Mails von einer legitimen Subdomain zu empfangen oder zu senden und so die Effektivit√§t von Phishing-Angriffen erh√∂hen.

### **Risiken h√∂herer Ordnung**
Weitere Risiken umfassen die **√úbernahme von NS-Records**. Wenn ein Angreifer die Kontrolle √ºber einen NS-Record einer Domain erlangt, kann er potenziell einen Teil des Datenverkehrs auf einen Server unter seiner Kontrolle umleiten. Dieses Risiko wird verst√§rkt, wenn der Angreifer eine hohe **TTL (Time to Live)** f√ºr DNS-Records festlegt und so die Dauer des Angriffs verl√§ngert.

### Schwachstelle bei CNAME-Records
Angreifer k√∂nnen ungenutzte CNAME-Records ausnutzen, die auf nicht mehr verwendete oder au√üer Betrieb genommene externe Dienste verweisen. Dadurch k√∂nnen sie eine Seite unter der vertrauensw√ºrdigen Domain erstellen und so Phishing oder die Verteilung von Malware erleichtern.

### **Strategien zur Risikominderung**
Strategien zur Risikominderung umfassen:
1. **Entfernen gef√§hrdeter DNS-Records** - Dies ist wirksam, wenn die Subdomain nicht mehr ben√∂tigt wird.
2. **Registrierung des Domainnamens** - Registrierung der Ressource beim entsprechenden Cloud-Anbieter oder erneuter Kauf einer abgelaufenen Domain.
3. **Regelm√§√üige √úberwachung auf Schwachstellen** - Tools wie [aquatone](https://github.com/michenriksen/aquatone) k√∂nnen anf√§llige Domains identifizieren. Organisationen sollten auch ihre Infrastrukturverwaltungsprozesse √ºberpr√ºfen und sicherstellen, dass die Erstellung von DNS-Records der letzte Schritt bei der Ressourcenerstellung und der erste Schritt bei der Ressourcenzerst√∂rung ist.

F√ºr Cloud-Anbieter ist die √úberpr√ºfung des Domainbesitzes entscheidend, um Subdomain-√úbernahmen zu verhindern. Einige Anbieter wie [GitLab](https://about.gitlab.com/2018/02/05/gitlab-pages-custom-domain-validation/) haben dieses Problem erkannt und Mechanismen zur Domain-Verifizierung implementiert.

## Referenzen
* [https://0xpatrik.com/subdomain-takeover/](https://0xpatrik.com/subdomain-takeover/)

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
Verwenden Sie [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks), um Workflows einfach zu erstellen und zu automatisieren, die von den fortschrittlichsten Community-Tools der Welt unterst√ºtzt werden.\
Erhalten Sie noch heute Zugriff:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><strong>Lernen Sie das Hacken von AWS von Grund auf mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Weitere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks bewerben m√∂chten** oder **HackTricks als PDF herunterladen** m√∂chten, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merchandise**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegramm-Gruppe**](https://t.me/peass) bei oder folgen Sie uns auf **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **GitHub-Repositories senden**.

</details>
