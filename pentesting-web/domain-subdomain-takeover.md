# Prise de contr√¥le de domaine/sous-domaine

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Expert en √©quipe rouge AWS de HackTricks)</strong></a><strong>!</strong></summary>

Autres fa√ßons de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts GitHub.

</details>

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
Utilisez [**Trickest**](https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks) pour construire et **automatiser des workflows** facilement aliment√©s par les outils communautaires les plus avanc√©s au monde.\
Acc√©dez d√®s aujourd'hui :

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## Prise de contr√¥le de domaine

Si vous d√©couvrez un domaine (domaine.tld) qui est **utilis√© par un service dans le p√©rim√®tre** mais que **l'entreprise** en a **perdu la propri√©t√©**, vous pouvez essayer de **l'enregistrer** (si le prix est abordable) et informer l'entreprise. Si ce domaine re√ßoit des **informations sensibles** comme un cookie de session via un param√®tre **GET** ou dans l'en-t√™te **Referer**, il s'agit certainement d'une **vuln√©rabilit√©**.

### Prise de contr√¥le de sous-domaine

Un sous-domaine de l'entreprise pointe vers un **service tiers avec un nom non enregistr√©**. Si vous pouvez **cr√©er** un **compte** dans ce **service tiers** et **enregistrer** le **nom** en cours d'utilisation, vous pouvez effectuer la prise de contr√¥le du sous-domaine.

Il existe plusieurs outils avec des dictionnaires pour v√©rifier les prises de contr√¥le possibles :

* [https://github.com/EdOverflow/can-i-take-over-xyz](https://github.com/EdOverflow/can-i-take-over-xyz)
* [https://github.com/blacklanternsecurity/bbot](https://github.com/blacklanternsecurity/bbot)
* [https://github.com/punk-security/dnsReaper](https://github.com/punk-security/dnsReaper)
* [https://github.com/haccer/subjack](https://github.com/haccer/subjack)
* [https://github.com/anshumanbh/tko-sub](https://github.com/anshumanbh/tko-subs)
* [https://github.com/ArifulProtik/sub-domain-takeover](https://github.com/ArifulProtik/sub-domain-takeover)
* [https://github.com/SaadAhmedx/Subdomain-Takeover](https://github.com/SaadAhmedx/Subdomain-Takeover)
* [https://github.com/Ice3man543/SubOver](https://github.com/Ice3man543/SubOver)
* [https://github.com/m4ll0k/takeover](https://github.com/m4ll0k/takeover)
* [https://github.com/antichown/subdomain-takeover](https://github.com/antichown/subdomain-takeover)
* [https://github.com/musana/mx-takeover](https://github.com/musana/mx-takeover)

#### Analyse des sous-domaines piratables avec [BBOT](https://github.com/blacklanternsecurity/bbot) :

Les v√©rifications de prise de contr√¥le de sous-domaine sont incluses dans l'√©num√©ration de sous-domaine par d√©faut de BBOT. Les signatures sont directement extraites de [https://github.com/EdOverflow/can-i-take-over-xyz](https://github.com/EdOverflow/can-i-take-over-xyz).
```bash
bbot -t evilcorp.com -f subdomain-enum
```
### G√©n√©ration de prise de contr√¥le de sous-domaine via DNS Wildcard

Lorsqu'un wildcard DNS est utilis√© dans un domaine, tout sous-domaine demand√© de ce domaine qui n'a pas explicitement une adresse diff√©rente sera **r√©solu avec les m√™mes informations**. Cela pourrait √™tre une adresse IP A, un CNAME...

Par exemple, si `*.testing.com` est wildcard√© vers `1.1.1.1`. Alors, `not-existent.testing.com` pointera vers `1.1.1.1`.

Cependant, si au lieu de pointer vers une adresse IP, l'administrateur syst√®me le pointe vers un **service tiers via CNAME**, comme un **sous-domaine github** par exemple (`sohomdatta1.github.io`). Un attaquant pourrait **cr√©er sa propre page tierce** (dans ce cas-ci, sur Github) et dire que `something.testing.com` pointe l√†-bas. Parce que le **wildcard CNAME** le permettra, l'attaquant pourra **g√©n√©rer des sous-domaines arbitraires pour le domaine de la victime pointant vers ses pages**.

Vous pouvez trouver un exemple de cette vuln√©rabilit√© dans le write-up CTF : [https://ctf.zeyu2001.com/2022/nitectf-2022/undocumented-js-api](https://ctf.zeyu2001.com/2022/nitectf-2022/undocumented-js-api)

## Exploitation d'une prise de contr√¥le de sous-domaine

La prise de contr√¥le de sous-domaine est essentiellement du spoofing DNS pour un domaine sp√©cifique √† travers Internet, permettant aux attaquants de d√©finir des enregistrements A pour un domaine, amenant les navigateurs √† afficher le contenu du serveur de l'attaquant. Cette **transparence** dans les navigateurs rend les domaines vuln√©rables au phishing. Les attaquants peuvent utiliser le [_typosquatting_](https://en.wikipedia.org/wiki/Typosquatting) ou les [_domaines Doppelganger_](https://en.wikipedia.org/wiki/Doppelg%C3%A4nger) √† cette fin. Sont particuli√®rement vuln√©rables les domaines o√π l'URL dans un e-mail de phishing semble l√©gitime, trompant les utilisateurs et contournant les filtres anti-spam en raison de la confiance inh√©rente au domaine.

Consultez ce [post pour plus de d√©tails](https://0xpatrik.com/subdomain-takeover/)

### **Certificats SSL**
Les certificats SSL, s'ils sont g√©n√©r√©s par des attaquants via des services comme [_Let's Encrypt_](https://letsencrypt.org/), ajoutent √† la l√©gitimit√© de ces faux domaines, rendant les attaques de phishing plus convaincantes.

### **S√©curit√© des cookies et transparence du navigateur**
La transparence du navigateur s'√©tend √©galement √† la s√©curit√© des cookies, r√©gie par des politiques comme la [politique Same-origin](https://en.wikipedia.org/wiki/Same-origin_policy). Les cookies, souvent utilis√©s pour g√©rer les sessions et stocker des jetons de connexion, peuvent √™tre exploit√©s via une prise de contr√¥le de sous-domaine. Les attaquants peuvent **collecter des cookies de session** simplement en redirigeant les utilisateurs vers un sous-domaine compromis, mettant en danger les donn√©es et la vie priv√©e des utilisateurs.

### **E-mails et prise de contr√¥le de sous-domaine**
Un autre aspect de la prise de contr√¥le de sous-domaine concerne les services e-mail. Les attaquants peuvent manipuler les **enregistrements MX** pour recevoir ou envoyer des e-mails √† partir d'un sous-domaine l√©gitime, am√©liorant l'efficacit√© des attaques de phishing.

### **Risques d'ordre sup√©rieur**
D'autres risques incluent la **prise de contr√¥le des enregistrements NS**. Si un attaquant prend le contr√¥le d'un enregistrement NS d'un domaine, il peut potentiellement diriger une partie du trafic vers un serveur sous son contr√¥le. Ce risque est amplifi√© si l'attaquant d√©finit un **TTL (Time to Live)** √©lev√© pour les enregistrements DNS, prolongeant la dur√©e de l'attaque.

### Vuln√©rabilit√© de l'enregistrement CNAME
Les attaquants peuvent exploiter des enregistrements CNAME non r√©clam√©s pointant vers des services externes qui ne sont plus utilis√©s ou ont √©t√© d√©sactiv√©s. Cela leur permet de cr√©er une page sous le domaine de confiance, facilitant davantage le phishing ou la distribution de logiciels malveillants.

### **Strat√©gies d'att√©nuation**
Les strat√©gies d'att√©nuation incluent :
1. **Supprimer les enregistrements DNS vuln√©rables** - C'est efficace si le sous-domaine n'est plus n√©cessaire.
2. **R√©clamer le nom de domaine** - Enregistrer la ressource aupr√®s du fournisseur cloud respectif ou racheter un domaine expir√©.
3. **Surveillance r√©guli√®re des vuln√©rabilit√©s** - Des outils comme [aquatone](https://github.com/michenriksen/aquatone) peuvent aider √† identifier les domaines susceptibles. Les organisations devraient √©galement r√©viser leurs processus de gestion de l'infrastructure, en s'assurant que la cr√©ation d'enregistrements DNS est la derni√®re √©tape dans la cr√©ation de ressources et la premi√®re √©tape dans la destruction de ressources.

Pour les fournisseurs cloud, v√©rifier la propri√©t√© du domaine est crucial pour pr√©venir les prises de contr√¥le de sous-domaine. Certains, comme [GitLab](https://about.gitlab.com/2018/02/05/gitlab-pages-custom-domain-validation/), ont reconnu ce probl√®me et mis en place des m√©canismes de v√©rification de domaine.

## R√©f√©rences
* [https://0xpatrik.com/subdomain-takeover/](https://0xpatrik.com/subdomain-takeover/)

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
Utilisez [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) pour construire et **automatiser facilement des workflows** aliment√©s par les outils communautaires les plus avanc√©s au monde.\
Acc√©dez d√®s aujourd'hui :

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

D'autres fa√ßons de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Rejoignez** üí¨ le [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
