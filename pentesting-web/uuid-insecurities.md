# UUID安全漏洞

<details>

<summary><strong>从零开始学习AWS黑客技术，成为专家</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE（HackTricks AWS红队专家）</strong></a><strong>！</strong></summary>

支持HackTricks的其他方式：

* 如果您想看到您的**公司在HackTricks中做广告**或**下载PDF格式的HackTricks**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)!
* 获取[**官方PEASS & HackTricks周边产品**](https://peass.creator-spring.com)
* 探索[**PEASS家族**](https://opensea.io/collection/the-peass-family)，我们的独家[**NFTs**](https://opensea.io/collection/the-peass-family)
* **加入** 💬 [**Discord群组**](https://discord.gg/hRep4RUj7f) 或 [**电报群组**](https://t.me/peass) 或在**Twitter**上关注我们 🐦 [**@carlospolopm**](https://twitter.com/hacktricks\_live)**。**
* 通过向[**HackTricks**](https://github.com/carlospolop/hacktricks)和[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github仓库提交PR来分享您的黑客技巧。

</details>

## 基本信息

通用唯一标识符（UUID）是**用于在计算机系统中唯一标识信息的128位数字**。在需要无需中央协调的唯一标识符的应用程序中，UUID是必不可少的。它们通常用作数据库键，并且可以指代各种元素，如文档和会话。

UUID设计为**唯一且难以猜测**。它们以特定格式结构化，分为五组，表示为32个十六进制数字。有不同版本的UUID，每个版本用于不同的目的：

* **UUID v1**基于时间，包含时间戳、时钟序列和节点ID（MAC地址），但可能会暴露系统信息。
* **UUID v2**类似于v1，但包括用于本地域的修改（不常用）。
* **UUID v3和v5**使用来自命名空间和名称的哈希值生成UUID，v3使用MD5，v5使用SHA-1。
* **UUID v4**几乎完全随机生成，提供高度匿名性，但存在轻微重复风险。

{% hint style="success" %}
请注意，UUID的版本和子版本通常出现在UUID内的相同位置。例如：\
12345678 - abcd - 1a56 - a539 - 103755193864\
xxxxxxxx  - xxxx - Mxxx - Nxxx - xxxxxxxxxxxx

* **M的位置**表示UUID的**版本**。在上面的示例中，它是UUID v**1**。
* **N的位置**表示UUID的变体。
{% endhint %}

## 三明治攻击

"三明治攻击"是一种特定类型的攻击，**利用UUID v1在Web应用程序中生成的可预测性**，特别是在诸如密码重置之类的功能中。UUID v1基于时间、时钟序列和节点的MAC地址生成，如果攻击者可以获取一些接近时间生成的UUID，则可能会使其有些可预测性。

### 示例

想象一个Web应用程序使用UUID v1生成密码重置链接。以下是攻击者可能利用此漏洞获取未经授权访问的方式：

1. **初始设置**：

* 攻击者控制两个电子邮件账户：\`attacker1@acme.com\`和\`attacker2@acme.com\`。
* 目标的电子邮件账户是\`victim@acme.com\`。

2. **执行**：

* 攻击者触发其第一个账户（\`attacker1@acme.com\`）的密码重置，并收到一个带有UUID的密码重置链接，例如\`99874128-7592-11e9-8201-bb2f15014a14\`。
* 紧接着，攻击者触发受害者账户（\`victim@acme.com\`）的密码重置，然后迅速触发第二个攻击者控制的账户（\`attacker2@acme.com\`）的密码重置。
* 攻击者收到第二个账户的重置链接，带有UUID，例如\`998796b4-7592-11e9-8201-bb2f15014a14\`。

3. **分析**：

* 攻击者现在有两个接近时间生成的UUID（\`99874128\`和\`998796b4\`）。鉴于基于时间的UUID的顺序性，受害者账户的UUID可能位于这两个值之间。

4. **暴力破解攻击**：

* 攻击者使用工具生成这两个值之间的UUID，并通过尝试访问密码重置链接（例如\`https://www.acme.com/reset/\<generated-UUID>\`）来测试每个生成的UUID。
* 如果Web应用程序没有充分限制速率或阻止此类尝试，攻击者可以快速测试范围内的所有可能UUID。

5. **获取访问权限**：

* 一旦发现受害者密码重置链接的正确UUID，攻击者可以重置受害者的密码并未经授权访问其账户。

### 工具

* 您可以使用工具[**https://github.com/Lupin-Holmes/sandwich**](https://github.com/Lupin-Holmes/sandwich)自动执行三明治攻击。
* 您可以使用Burp Suite的扩展[**UUID Detector**](https://portswigger.net/bappstore/65f32f209a72480ea5f1a0dac4f38248)检测这种类型的UUID。

## 参考资料

* [https://versprite.com/blog/universally-unique-identifiers/](https://versprite.com/blog/universally-unique-identifiers/)
