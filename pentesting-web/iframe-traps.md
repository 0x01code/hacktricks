# Trampas de Iframe

<details>

<summary><strong>Aprende hacking en AWS de cero a héroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Experto en Equipos Rojos de AWS de HackTricks)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si deseas ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** Consulta los [**PLANES DE SUSCRIPCIÓN**](https://github.com/sponsors/carlospolop)!
* Obtén la [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colección exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Únete al** 💬 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **síguenos** en **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Comparte tus trucos de hacking enviando PRs a los** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repositorios de github.

</details>

## Información Básica

Esta forma de abusar de XSS a través de iframes para robar información del usuario que se desplaza por la página web fue publicada originalmente en estos 2 posts de trustedsec.com: [**aquí**](https://trustedsec.com/blog/persisting-xss-with-iframe-traps) **y** [**aquí**](https://trustedsec.com/blog/js-tap-weaponizing-javascript-for-red-teams).

El ataque comienza en una página vulnerable a XSS donde es posible hacer que las **víctimas no abandonen el XSS** haciéndolas **navegar dentro de un iframe** que ocupa toda la aplicación web.

El ataque XSS básicamente cargará la página web en un iframe en el 100% de la pantalla. Por lo tanto, la víctima **no notará que está dentro de un iframe**. Entonces, si la víctima navega en la página haciendo clic en enlaces dentro del iframe (dentro de la web), estará **navegando dentro del iframe** con el JS arbitrario cargado robando información de esta navegación.

Además, para hacerlo más realista, es posible usar algunos **escuchadores** para verificar cuándo un iframe cambia la ubicación de la página, y actualizar la URL del navegador con esas ubicaciones para que el usuario piense que está moviéndose entre páginas usando el navegador.

<figure><img src="../.gitbook/assets/image (1248).png" alt=""><figcaption><p><a href="https://www.trustedsec.com/wp-content/uploads/2022/04/regEvents.png">https://www.trustedsec.com/wp-content/uploads/2022/04/regEvents.png</a></p></figcaption></figure>

<figure><img src="../.gitbook/assets/image (1249).png" alt=""><figcaption><p><a href="https://www.trustedsec.com/wp-content/uploads/2022/04/fakeAddress-1.png">https://www.trustedsec.com/wp-content/uploads/2022/04/fakeAddress-1.png</a></p></figcaption></figure>

Además, es posible usar escuchadores para robar información sensible, no solo de las otras páginas que la víctima está visitando, sino también de los datos utilizados para **rellenar formularios** y enviarlos (¿credenciales?) o para **robar el almacenamiento local**...

Por supuesto, las principales limitaciones son que una **víctima que cierre la pestaña o introduzca otra URL en el navegador escapará del iframe**. Otra forma de hacer esto sería **actualizar la página**, sin embargo, esto podría ser parcialmente **prevenido** al deshabilitar el menú contextual del clic derecho cada vez que se carga una nueva página dentro del iframe o al notar cuando el mouse del usuario abandona el iframe, potencialmente para hacer clic en el botón de recarga del navegador y en este caso la URL del navegador se actualiza con la URL original vulnerable a XSS, por lo que si el usuario la recarga, volverá a ser envenenado (nota que esto no es muy sigiloso).
