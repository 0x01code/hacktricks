# Inje√ß√£o Unicode

<details>

<summary><strong>Aprenda hacking no AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ quer ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF** Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**material oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o de [**NFTs exclusivos**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao grupo** üí¨ [**Discord**](https://discord.gg/hRep4RUj7f) ou ao grupo [**telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios github do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Introdu√ß√£o

Dependendo de como o back-end/front-end se comporta ao **receber caracteres unicode estranhos**, um atacante pode ser capaz de **burlar prote√ß√µes e injetar caracteres arbitr√°rios** que podem ser usados para **explorar vulnerabilidades de inje√ß√£o** como XSS ou SQLi.

## Normaliza√ß√£o Unicode

A normaliza√ß√£o Unicode ocorre quando **caracteres unicode s√£o normalizados para caracteres ascii**.

Um cen√°rio comum desse tipo de vulnerabilidade ocorre quando o sistema est√° **modificando** de alguma forma a **entrada** do usu√°rio **depois de t√™-la verificado**. Por exemplo, em alguns idiomas, uma simples chamada para tornar a **entrada em mai√∫sculas ou min√∫sculas** pode normalizar a entrada fornecida e o **unicode ser√° transformado em ASCII**, gerando novos caracteres.\
Para mais informa√ß√µes, confira:

{% content-ref url="unicode-normalization.md" %}
[unicode-normalization.md](unicode-normalization.md)
{% endcontent-ref %}

## `\u` para `%`

Caracteres Unicode geralmente s√£o representados com o prefixo **`\u`**. Por exemplo, o caractere `„±ã` √© `\u3c4b`([verifique aqui](https://unicode-explorer.com/c/3c4B)). Se um back-end **transforma** o prefixo **`\u` em `%`**, a string resultante ser√° `%3c4b`, que decodificado por URL √©: **`<4b`**. E, como voc√™ pode ver, um caractere **`<` √© injetado**.\
Voc√™ pode usar essa t√©cnica para **injetar qualquer tipo de caractere** se o back-end for vulner√°vel.\
Confira [https://unicode-explorer.com/](https://unicode-explorer.com/) para encontrar os caracteres que voc√™ precisa.

Esta vulnerabilidade na verdade vem de uma vulnerabilidade que um pesquisador encontrou, para uma explica√ß√£o mais aprofundada confira [https://www.youtube.com/watch?v=aUsAHb0E7Cg](https://www.youtube.com/watch?v=aUsAHb0E7Cg)

## Inje√ß√£o de Emoji

Back-ends √†s vezes se comportam de maneira estranha quando **recebem emojis**. Foi o que aconteceu [**neste relato**](https://medium.com/@fpatrik/how-i-found-an-xss-vulnerability-via-using-emojis-7ad72de49209) onde o pesquisador conseguiu realizar um XSS com um payload como: `üíãimg src=x onerror=alert(document.domain)//üíõ`

Neste caso, o erro foi que o servidor, ap√≥s remover os caracteres maliciosos, **converteu a string UTF-8 de Windows-1252 para UTF-8** (basicamente a codifica√ß√£o de entrada e a convers√£o de codifica√ß√£o n√£o coincidiam). Ent√£o isso n√£o gerou um < apropriado, apenas um unicode estranho: `‚Äπ`\
``Ent√£o eles pegaram essa sa√≠da e **converteram novamente agora de UTF-8 para ASCII**. Isso **normalizou** o `‚Äπ` para `<` e assim o exploit p√¥de funcionar naquele sistema.\
Foi o que aconteceu:
```php
<?php

$str = isset($_GET["str"]) ? htmlspecialchars($_GET["str"]) : "";

$str = iconv("Windows-1252", "UTF-8", $str);
$str = iconv("UTF-8", "ASCII//TRANSLIT", $str);

echo "String: " . $str;
```
Listas de emojis:

* [https://github.com/iorch/jakaton_feminicidios/blob/master/data/emojis.csv](https://github.com/iorch/jakaton_feminicidios/blob/master/data/emojis.csv)
* [https://unicode.org/emoji/charts-14.0/full-emoji-list.html](https://unicode.org/emoji/charts-14.0/full-emoji-list.html)

<details>

<summary><strong>Aprenda hacking no AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ quer ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**material oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **Junte-se ao grupo** üí¨ [**Discord**](https://discord.gg/hRep4RUj7f) ou ao grupo [**telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios github** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
