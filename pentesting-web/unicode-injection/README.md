# Inje√ß√£o de Unicode

<details>

<summary><strong>Aprenda hacking AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras maneiras de apoiar o HackTricks:

* Se voc√™ quiser ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF** Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**swag oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-nos** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## Introdu√ß√£o

Dependendo de como o back-end/front-end se comporta quando ele **recebe caracteres unicode estranhos**, um atacante pode ser capaz de **burlar prote√ß√µes e injetar caracteres arbitr√°rios** que poderiam ser usados para **abuso de vulnerabilidades de inje√ß√£o** como XSS ou SQLi.

## Normaliza√ß√£o Unicode

A normaliza√ß√£o Unicode ocorre quando **caracteres unicode s√£o normalizados para caracteres ascii**.

Um cen√°rio comum desse tipo de vulnerabilidade ocorre quando o sistema est√° **modificando** de alguma forma a **entrada** do usu√°rio **ap√≥s t√™-la verificado**. Por exemplo, em alguns idiomas, uma simples chamada para **tornar a entrada mai√∫scula ou min√∫scula** poderia normalizar a entrada fornecida e o **unicode ser√° transformado em ASCII** gerando novos caracteres.\
Para mais informa√ß√µes, consulte:

{% content-ref url="unicode-normalization.md" %}
[unicode-normalization.md](unicode-normalization.md)
{% endcontent-ref %}

## `\u` para `%`

Os caracteres Unicode s√£o geralmente representados com o prefixo **`\u`**. Por exemplo, o caractere `„±ã` √© `\u3c4b`([verifique aqui](https://unicode-explorer.com/c/3c4B)). Se um back-end **transforma** o prefixo **`\u` em `%`**, a string resultante ser√° `%3c4b`, que decodificado de URL √©: **`<4b`**. E, como voc√™ pode ver, um **`<` char √© injetado**.\
Voc√™ pode usar essa t√©cnica para **injetar qualquer tipo de caractere** se o back-end for vulner√°vel.\
Verifique [https://unicode-explorer.com/](https://unicode-explorer.com/) para encontrar os caracteres de que voc√™ precisa.

Essa vulnerabilidade na verdade vem de uma vulnerabilidade que um pesquisador encontrou, para uma explica√ß√£o mais detalhada, confira [https://www.youtube.com/watch?v=aUsAHb0E7Cg](https://www.youtube.com/watch?v=aUsAHb0E7Cg)

## Inje√ß√£o de Emoji

Os back-ends √†s vezes se comportam de forma estranha quando eles **recebem emojis**. Foi o que aconteceu neste [**relat√≥rio**](https://medium.com/@fpatrik/how-i-found-an-xss-vulnerability-via-using-emojis-7ad72de49209) onde o pesquisador conseguiu obter um XSS com um payload como: `üíãimg src=x onerror=alert(document.domain)//üíõ`

Neste caso, o erro foi que o servidor, ap√≥s remover os caracteres maliciosos, **converteu a string UTF-8 de Windows-1252 para UTF-8** (basicamente a codifica√ß√£o de entrada e a convers√£o da codifica√ß√£o n√£o correspondiam). Ent√£o isso n√£o d√° um < apropriado, apenas um unicode estranho: `‚Äπ`\
``Ent√£o eles pegaram essa sa√≠da e **converteram novamente agora de UTF-8 para ASCII**. Isso **normalizou** o `‚Äπ` para `<` e √© assim que a explora√ß√£o poderia funcionar nesse sistema.\
Isso √© o que aconteceu:
```php
<?php

$str = isset($_GET["str"]) ? htmlspecialchars($_GET["str"]) : "";

$str = iconv("Windows-1252", "UTF-8", $str);
$str = iconv("UTF-8", "ASCII//TRANSLIT", $str);

echo "String: " . $str;
```
Listas de emojis:

* [https://github.com/iorch/jakaton\_feminicidios/blob/master/data/emojis.csv](https://github.com/iorch/jakaton\_feminicidios/blob/master/data/emojis.csv)
* [https://unicode.org/emoji/charts-14.0/full-emoji-list.html](https://unicode.org/emoji/charts-14.0/full-emoji-list.html)

<details>

<summary><strong>Aprenda hacking AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ deseja ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF** Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**swag oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-nos** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para os** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) reposit√≥rios do github.

</details>
