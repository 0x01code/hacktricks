# Normalizzazione Unicode

<details>

<summary><strong>Impara l'hacking di AWS da zero a esperto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se vuoi vedere la tua **azienda pubblicizzata su HackTricks** o **scaricare HackTricks in PDF** Controlla i [**PACCHETTI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale di PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**The PEASS Family**](https://opensea.io/collection/the-peass-family), la nostra collezione di [**NFT esclusivi**](https://opensea.io/collection/the-peass-family)
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo Telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR a** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

**Questo √® un riassunto di: [https://appcheck-ng.com/unicode-normalization-vulnerabilities-the-special-k-polyglot/](https://appcheck-ng.com/unicode-normalization-vulnerabilities-the-special-k-polyglot/)**. Dai un'occhiata per ulteriori dettagli (immagini prese da l√¨).


## Comprensione di Unicode e Normalizzazione

La normalizzazione Unicode √® un processo che garantisce che diverse rappresentazioni binarie dei caratteri siano standardizzate allo stesso valore binario. Questo processo √® cruciale nel trattare le stringhe nella programmazione e nell'elaborazione dei dati. Lo standard Unicode definisce due tipi di equivalenza dei caratteri:

1. **Equivalenza canonica**: I caratteri sono considerati equivalenti in modo canonico se hanno la stessa apparenza e significato quando vengono stampati o visualizzati.
2. **Equivalenza di compatibilit√†**: Una forma pi√π debole di equivalenza in cui i caratteri possono rappresentare lo stesso carattere astratto ma possono essere visualizzati in modo diverso.

Ci sono **quattro algoritmi di normalizzazione Unicode**: NFC, NFD, NFKC e NFKD. Ogni algoritmo utilizza tecniche di normalizzazione canonica e di compatibilit√† in modo diverso. Per una comprensione pi√π approfondita, puoi esplorare queste tecniche su [Unicode.org](https://unicode.org/).

### Punti chiave sulla codifica Unicode

La comprensione della codifica Unicode √® fondamentale, soprattutto quando si affrontano problemi di interoperabilit√† tra diversi sistemi o linguaggi. Ecco i punti principali:

- **Punti codice e caratteri**: In Unicode, ogni carattere o simbolo viene assegnato un valore numerico noto come "punto codice".
- **Rappresentazione in byte**: Il punto codice (o carattere) √® rappresentato da uno o pi√π byte in memoria. Ad esempio, i caratteri LATIN-1 (comuni nei paesi di lingua inglese) vengono rappresentati utilizzando un byte. Tuttavia, le lingue con un set di caratteri pi√π ampio hanno bisogno di pi√π byte per la rappresentazione.
- **Codifica**: Questo termine si riferisce al modo in cui i caratteri vengono trasformati in una serie di byte. UTF-8 √® uno standard di codifica diffuso in cui i caratteri ASCII vengono rappresentati utilizzando un byte e fino a quattro byte per gli altri caratteri.
- **Elaborazione dei dati**: I sistemi che elaborano dati devono essere consapevoli della codifica utilizzata per convertire correttamente il flusso di byte in caratteri.
- **Varianti di UTF**: Oltre a UTF-8, esistono altri standard di codifica come UTF-16 (che utilizza un minimo di 2 byte, fino a 4) e UTF-32 (che utilizza 4 byte per tutti i caratteri).

√à fondamentale comprendere questi concetti per gestire ed attenuare efficacemente i potenziali problemi derivanti dalla complessit√† di Unicode e dai suoi vari metodi di codifica.


Un esempio di come Unicode normalizza due byte diversi che rappresentano lo stesso carattere:
```python
unicodedata.normalize("NFKD","chloe\u0301") == unicodedata.normalize("NFKD", "chlo\u00e9")
```
**Un elenco di caratteri equivalenti Unicode pu√≤ essere trovato qui:** [https://appcheck-ng.com/wp-content/uploads/unicode\_normalization.html](https://appcheck-ng.com/wp-content/uploads/unicode\_normalization.html) e [https://0xacb.com/normalization\_table](https://0xacb.com/normalization\_table)

### Scoperta

Se riesci a trovare all'interno di un'applicazione web un valore che viene ripetuto, puoi provare a inviare **'KELVIN SIGN' (U+0212A)** che **viene normalizzato come "K"** (puoi inviarlo come `%e2%84%aa`). **Se viene ripetuta la lettera "K"**, allora viene eseguita una qualche forma di **normalizzazione Unicode**.

Altro **esempio**: `%F0%9D%95%83%E2%85%87%F0%9D%99%A4%F0%9D%93%83%E2%85%88%F0%9D%94%B0%F0%9D%94%A5%F0%9D%99%96%F0%9D%93%83` dopo la **normalizzazione Unicode** diventa `Leonishan`.

## **Esempi di vulnerabilit√†**

### **Bypass del filtro di SQL Injection**

Immagina una pagina web che utilizza il carattere `'` per creare query SQL con l'input dell'utente. Questa pagina web, come misura di sicurezza, **elimina** tutte le occorrenze del carattere **`'`** dall'input dell'utente, ma **dopo questa eliminazione** e **prima della creazione** della query, **normalizza** l'input dell'utente utilizzando **Unicode**.

Quindi, un utente malintenzionato potrebbe inserire un carattere Unicode diverso equivalente a `' (0x27)` come `%ef%bc%87`, quando l'input viene normalizzato, viene creato un singolo apice e si presenta una **vulnerabilit√† di SQL Injection**:

![https://appcheck-ng.com/unicode-normalization-vulnerabilities-the-special-k-polyglot/](<../../.gitbook/assets/image (157) (1).png>)

**Alcuni interessanti caratteri Unicode**

* `o` -- %e1%b4%bc
* `r` -- %e1%b4%bf
* `1` -- %c2%b9
* `=` -- %e2%81%bc
* `/` -- %ef%bc%8f
* `-`-- %ef%b9%a3
* `#`-- %ef%b9%9f
* `*`-- %ef%b9%a1
* `'` -- %ef%bc%87
* `"` -- %ef%bc%82
* `|` -- %ef%bd%9c
```
' or 1=1-- -
%ef%bc%87+%e1%b4%bc%e1%b4%bf+%c2%b9%e2%81%bc%c2%b9%ef%b9%a3%ef%b9%a3+%ef%b9%a3

" or 1=1-- -
%ef%bc%82+%e1%b4%bc%e1%b4%bf+%c2%b9%e2%81%bc%c2%b9%ef%b9%a3%ef%b9%a3+%ef%b9%a3

' || 1==1//
%ef%bc%87+%ef%bd%9c%ef%bd%9c+%c2%b9%e2%81%bc%e2%81%bc%c2%b9%ef%bc%8f%ef%bc%8f

" || 1==1//
%ef%bc%82+%ef%bd%9c%ef%bd%9c+%c2%b9%e2%81%bc%e2%81%bc%c2%b9%ef%bc%8f%ef%bc%8f
```
#### Modello sqlmap

{% embed url="https://github.com/carlospolop/sqlmap_to_unicode_template" %}

### XSS (Cross Site Scripting)

√à possibile utilizzare uno dei seguenti caratteri per ingannare l'applicazione web ed eseguire un attacco XSS:

![https://appcheck-ng.com/unicode-normalization-vulnerabilities-the-special-k-polyglot/](<../../.gitbook/assets/image (312) (1).png>)

Si noti che ad esempio il primo carattere Unicode proposto pu√≤ essere inviato come: `%e2%89%ae` o come `%u226e`

![https://appcheck-ng.com/unicode-normalization-vulnerabilities-the-special-k-polyglot/](<../../.gitbook/assets/image (215) (1).png>)

### Fuzzing Regexes

Quando il backend **verifica l'input dell'utente con una regex**, potrebbe essere possibile che l'**input** venga **normalizzato** per la **regex** ma **non** per dove viene **utilizzato**. Ad esempio, in un Open Redirect o SSRF la regex potrebbe **normalizzare l'URL inviato** ma poi **accedere ad esso cos√¨ com'√®**.

Lo strumento [**recollapse**](https://github.com/0xacb/recollapse) permette di **generare variazioni dell'input** per fuzzare il backend. Per ulteriori informazioni consulta il **github** e questo [**post**](https://0xacb.com/2022/11/21/recollapse/).


## Riferimenti
* [**https://labs.spotify.com/2013/06/18/creative-usernames/**](https://labs.spotify.com/2013/06/18/creative-usernames/)
* [**https://security.stackexchange.com/questions/48879/why-does-directory-traversal-attack-c0af-work**](https://security.stackexchange.com/questions/48879/why-does-directory-traversal-attack-c0af-work)
* [**https://jlajara.gitlab.io/posts/2020/02/19/Bypass\_WAF\_Unicode.html**](https://jlajara.gitlab.io/posts/2020/02/19/Bypass\_WAF\_Unicode.html)

<details>

<summary><strong>Impara l'hacking di AWS da zero a eroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se vuoi vedere la tua **azienda pubblicizzata in HackTricks** o **scaricare HackTricks in PDF** controlla i [**PACCHETTI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale di PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**The PEASS Family**](https://opensea.io/collection/the-peass-family), la nostra collezione di esclusive [**NFT**](https://opensea.io/collection/the-peass-family)
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo Telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR ai repository github di** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
