# Normalisation Unicode

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**merchandising officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux d√©p√¥ts github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Contexte

La normalisation garantit que deux cha√Ænes qui peuvent utiliser une repr√©sentation binaire diff√©rente pour leurs caract√®res aient la m√™me valeur binaire apr√®s normalisation.

Il existe deux types globaux d'√©quivalence entre les caract√®res, l'¬´ **√âquivalence Canonique** ¬ª et l'¬´ **√âquivalence de Compatibilit√©** ¬ª :\
Les caract√®res **√âquivalents Canoniques** sont suppos√©s avoir la m√™me apparence et le m√™me sens lorsqu'ils sont imprim√©s ou affich√©s. L'**√âquivalence de Compatibilit√©** est une √©quivalence plus faible, dans le sens o√π deux valeurs peuvent repr√©senter le m√™me caract√®re abstrait mais peuvent √™tre affich√©es diff√©remment. Il existe **4 algorithmes de Normalisation** d√©finis par la norme **Unicode** ; **NFC, NFD, NFKD et NFKD**, chacun applique les techniques de normalisation Canonique et de Compatibilit√© de mani√®re diff√©rente. Vous pouvez en lire plus sur les diff√©rentes techniques sur Unicode.org.

### Codage Unicode

Bien que Unicode ait √©t√© en partie con√ßu pour r√©soudre les probl√®mes d'interop√©rabilit√©, l'√©volution de la norme, la n√©cessit√© de prendre en charge les syst√®mes h√©rit√©s et les diff√©rentes m√©thodes de codage peuvent encore poser un d√©fi.\
Avant de nous plonger dans les attaques Unicode, voici les points principaux √† comprendre sur Unicode :

* Chaque caract√®re ou symbole est mapp√© √† une valeur num√©rique appel√©e ¬´ point de code ¬ª.
* La valeur du point de code (et donc le caract√®re lui-m√™me) est repr√©sent√©e par 1 ou plusieurs octets en m√©moire. Les caract√®res LATIN-1, comme ceux utilis√©s dans les pays anglophones, peuvent √™tre repr√©sent√©s en utilisant 1 octet. D'autres langues ont plus de caract√®res et ont besoin de plus d'octets pour repr√©senter tous les diff√©rents points de code (aussi parce qu'ils ne peuvent pas utiliser ceux d√©j√† pris par LATIN-1).
* Le terme ¬´ codage ¬ª d√©signe la m√©thode selon laquelle les caract√®res sont repr√©sent√©s sous forme de s√©rie d'octets. La norme de codage la plus courante est UTF-8, avec ce sch√©ma de codage, les caract√®res ASCII peuvent √™tre repr√©sent√©s en utilisant 1 octet ou jusqu'√† 4 octets pour d'autres caract√®res.
* Lorsqu'un syst√®me traite des donn√©es, il doit conna√Ætre le codage utilis√© pour convertir le flux d'octets en caract√®res.
* Bien que UTF-8 soit le plus courant, il existe des normes de codage similaires nomm√©es UTF-16 et UTF-32, la diff√©rence entre chacune est le nombre d'octets utilis√©s pour repr√©senter chaque caract√®re. Par exemple, UTF-16 utilise un minimum de 2 octets (mais jusqu'√† 4) et UTF-32 utilise 4 octets pour tous les caract√®res.

Un exemple de la fa√ßon dont Unicode normalise deux octets diff√©rents repr√©sentant le m√™me caract√®re :

![](<../../.gitbook/assets/image (156).png>)

**Une liste de caract√®res Unicode √©quivalents peut √™tre trouv√©e ici :** [https://appcheck-ng.com/wp-content/uploads/unicode\_normalization.html](https://appcheck-ng.com/wp-content/uploads/unicode\_normalization.html) et [https://0xacb.com/normalization\_table](https://0xacb.com/normalization\_table)

### D√©couverte

Si vous trouvez dans une application web une valeur qui est renvoy√©e, vous pourriez essayer d'envoyer le **'SIGNE KELVIN' (U+0212A)** qui se **normalise en "K"** (vous pouvez l'envoyer comme `%e2%84%aa`). **Si un "K" est renvoy√©**, alors, une sorte de **normalisation Unicode** est effectu√©e.

Autre **exemple** : `%F0%9D%95%83%E2%85%87%F0%9D%99%A4%F0%9D%93%83%E2%85%88%F0%9D%94%B0%F0%9D%94%A5%F0%9D%99%96%F0%9D%93%83` apr√®s **unicode** est `Leonishan`.

## **Exemples Vuln√©rables**

### **Contournement de filtre d'injection SQL**

Imaginez une page web qui utilise le caract√®re `'` pour cr√©er des requ√™tes SQL avec l'entr√©e de l'utilisateur. Cette page, comme mesure de s√©curit√©, **supprime** toutes les occurrences du caract√®re **`'`** de l'entr√©e de l'utilisateur, mais **apr√®s cette suppression** et **avant la cr√©ation** de la requ√™te, elle **normalise** en utilisant **Unicode** l'entr√©e de l'utilisateur.

Alors, un utilisateur malveillant pourrait ins√©rer un caract√®re Unicode diff√©rent √©quivalent √† `' (0x27)` comme `%ef%bc%87`, lorsque l'entr√©e est normalis√©e, une apostrophe est cr√©√©e et une vuln√©rabilit√© **SQLInjection** appara√Æt :

![](<../../.gitbook/assets/image (157) (1).png>)

**Quelques caract√®res Unicode int√©ressants**

* `o` -- %e1%b4%bc
* `r` -- %e1%b4%bf
* `1` -- %c2%b9
* `=` -- %e2%81%bc
* `/` -- %ef%bc%8f
* `-`-- %ef%b9%a3
* `#`-- %ef%b9%9f
* `*`-- %ef%b9%a1
* `'` -- %ef%bc%87
* `"` -- %ef%bc%82
* `|` -- %ef%bd%9c
```
' or 1=1-- -
%ef%bc%87+%e1%b4%bc%e1%b4%bf+%c2%b9%e2%81%bc%c2%b9%ef%b9%a3%ef%b9%a3+%ef%b9%a3

" or 1=1-- -
%ef%bc%82+%e1%b4%bc%e1%b4%bf+%c2%b9%e2%81%bc%c2%b9%ef%b9%a3%ef%b9%a3+%ef%b9%a3

' || 1==1//
%ef%bc%87+%ef%bd%9c%ef%bd%9c+%c2%b9%e2%81%bc%e2%81%bc%c2%b9%ef%bc%8f%ef%bc%8f

" || 1==1//
%ef%bc%82+%ef%bd%9c%ef%bd%9c+%c2%b9%e2%81%bc%e2%81%bc%c2%b9%ef%bc%8f%ef%bc%8f
```
#### Mod√®le sqlmap

{% embed url="https://github.com/carlospolop/sqlmap_to_unicode_template" %}

### XSS (Cross Site Scripting)

Vous pourriez utiliser l'un des caract√®res suivants pour tromper l'application web et exploiter un XSS :

![](<../../.gitbook/assets/image (312) (1).png>)

Remarquez que par exemple le premier caract√®re Unicode propos√© peut √™tre envoy√© comme : `%e2%89%ae` ou comme `%u226e`

![](<../../.gitbook/assets/image (215) (1).png>)

### Fuzzing de Regex

Lorsque le backend **v√©rifie l'entr√©e utilisateur avec une regex**, il est possible que l'**entr√©e** soit **normalis√©e** pour la **regex** mais **pas** pour l'endroit o√π elle est **utilis√©e**. Par exemple, dans une redirection ouverte ou SSRF, la regex pourrait **normaliser l'URL envoy√©e** mais ensuite **y acc√©der telle quelle**.

L'outil [**recollapse**](https://github.com/0xacb/recollapse) permet de **g√©n√©rer des variations de l'entr√©e** pour tester le backend. Pour plus d'informations, consultez le **github** et ce [**post**](https://0xacb.com/2022/11/21/recollapse/).

## R√©f√©rences

**Toutes les informations de cette page ont √©t√© prises de :** [**https://appcheck-ng.com/unicode-normalization-vulnerabilities-the-special-k-polyglot/#**](https://appcheck-ng.com/unicode-normalization-vulnerabilities-the-special-k-polyglot/)

**Autres r√©f√©rences :**

* [**https://labs.spotify.com/2013/06/18/creative-usernames/**](https://labs.spotify.com/2013/06/18/creative-usernames/)
* [**https://security.stackexchange.com/questions/48879/why-does-directory-traversal-attack-c0af-work**](https://security.stackexchange.com/questions/48879/why-does-directory-traversal-attack-c0af-work)
* [**https://jlajara.gitlab.io/posts/2020/02/19/Bypass\_WAF\_Unicode.html**](https://jlajara.gitlab.io/posts/2020/02/19/Bypass\_WAF\_Unicode.html)

<details>

<summary><strong>Apprenez le hacking AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**merchandising officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez**-moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de hacking en soumettant des PR aux d√©p√¥ts github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
