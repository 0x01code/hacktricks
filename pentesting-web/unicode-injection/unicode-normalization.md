# 유니코드 정규화

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>를 통해 AWS 해킹을 처음부터 전문가까지 배워보세요<strong>!</strong></summary>

HackTricks를 지원하는 다른 방법:

* **회사를 HackTricks에서 광고하거나 HackTricks를 PDF로 다운로드**하려면 [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)를 확인하세요!
* [**공식 PEASS & HackTricks 스웨그**](https://peass.creator-spring.com)를 얻으세요.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)를 발견하세요. 독점적인 [**NFTs**](https://opensea.io/collection/the-peass-family) 컬렉션입니다.
* 💬 [**Discord 그룹**](https://discord.gg/hRep4RUj7f) 또는 [**텔레그램 그룹**](https://t.me/peass)에 **참여**하거나 **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)을 **팔로우**하세요.
* **Hacking 트릭을 공유하려면 PR을** [**HackTricks**](https://github.com/carlospolop/hacktricks) **및** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **github 저장소에 제출**하세요.

</details>

**이것은 [https://appcheck-ng.com/unicode-normalization-vulnerabilities-the-special-k-polyglot/](https://appcheck-ng.com/unicode-normalization-vulnerabilities-the-special-k-polyglot/)의 요약입니다.** 자세한 내용은 확인해보세요 (이미지는 해당 사이트에서 가져온 것입니다).


## 유니코드와 정규화 이해하기

유니코드 정규화는 문자의 다른 이진 표현을 동일한 이진 값으로 표준화하는 과정입니다. 이 과정은 프로그래밍 및 데이터 처리에서 문자열을 다룰 때 중요합니다. 유니코드 표준은 두 가지 유형의 문자 동등성을 정의합니다:

1. **정규 동등성**: 문자가 인쇄되거나 표시될 때 동일한 모양과 의미를 가지면 정규적으로 동등한 것으로 간주됩니다.
2. **호환 동등성**: 더 약한 동등성 형태로, 문자는 동일한 추상적인 문자를 나타낼 수 있지만 다르게 표시될 수 있습니다.

**네 가지 유니코드 정규화 알고리즘**이 있습니다: NFC, NFD, NFKC 및 NFKD. 각 알고리즘은 정규 및 호환 정규화 기술을 다르게 사용합니다. 더 깊이 이해하려면 [Unicode.org](https://unicode.org/)에서 이러한 기술을 탐색할 수 있습니다.

### 유니코드 인코딩에 대한 주요 사항

특히 다른 시스템이나 언어 간의 상호 운용성 문제를 다룰 때 유니코드 인코딩을 이해하는 것이 중요합니다. 다음은 주요 사항입니다:

- **코드 포인트 및 문자**: 유니코드에서 각 문자 또는 기호에는 "코드 포인트"라고 하는 숫자 값이 할당됩니다.
- **바이트 표현**: 코드 포인트(또는 문자)는 메모리에서 하나 이상의 바이트로 표현됩니다. 예를 들어, 영어권에서 일반적인 LATIN-1 문자는 하나의 바이트를 사용하여 표현됩니다. 그러나 더 많은 문자 집합을 가진 언어는 표현에 더 많은 바이트가 필요합니다.
- **인코딩**: 이 용어는 문자가 일련의 바이트로 변환되는 방식을 나타냅니다. UTF-8은 ASCII 문자를 하나의 바이트로 표현하고 다른 문자에는 최대 네 개의 바이트를 사용하는 일반적인 인코딩 표준입니다.
- **데이터 처리**: 데이터를 처리하는 시스템은 바이트 스트림을 올바르게 문자로 변환하기 위해 사용된 인코딩을 알아야 합니다.
- **UTF의 변형**: UTF-8 외에도 UTF-16(최소 2바이트에서 최대 4바이트 사용) 및 UTF-32(모든 문자에 4바이트 사용)와 같은 다른 인코딩 표준이 있습니다.

이러한 개념을 이해하는 것은 유니코드의 복잡성과 다양한 인코딩 방법에서 발생할 수 있는 잠재적인 문제를 효과적으로 처리하고 완화하기 위해 중요합니다.


두 개의 다른 바이트로 동일한 문자를 표현하는 유니코드 정규화의 예시:
```python
unicodedata.normalize("NFKD","chloe\u0301") == unicodedata.normalize("NFKD", "chlo\u00e9")
```
**유니코드 동등한 문자 목록은 여기에서 찾을 수 있습니다:** [https://appcheck-ng.com/wp-content/uploads/unicode\_normalization.html](https://appcheck-ng.com/wp-content/uploads/unicode\_normalization.html) 및 [https://0xacb.com/normalization\_table](https://0xacb.com/normalization\_table)

### 발견하기

웹 앱 내에서 되돌려지는 값이 있는 경우, **'KELVIN SIGN' (U+0212A)**를 보낼 수 있습니다. 이는 **"K"로 정규화**됩니다 ( `%e2%84%aa`로 보낼 수 있습니다). **"K"가 되돌려진다면**, 어떤 종류의 **유니코드 정규화**가 수행 중입니다.

다른 **예시**: `%F0%9D%95%83%E2%85%87%F0%9D%99%A4%F0%9D%93%83%E2%85%88%F0%9D%94%B0%F0%9D%94%A5%F0%9D%99%96%F0%9D%93%83`는 **유니코드** 후에 `Leonishan`이 됩니다.

## **취약한 예시**

### **SQL Injection 필터 우회**

사용자 입력으로 SQL 쿼리를 생성하기 위해 문자 `'`를 사용하는 웹 페이지를 상상해보십시오. 이 웹은 보안 조치로 사용자 입력에서 문자 `'`의 모든 발생을 **삭제**하지만, **해당 삭제 후**에 **쿼리 생성** 전에 사용자 입력을 **유니코드로 정규화**합니다.

그런 다음, 악의적인 사용자는 `' (0x27)`와 동등한 다른 유니코드 문자를 `%ef%bc%87`와 같이 삽입할 수 있습니다. 입력이 정규화되면 작은따옴표가 생성되고 **SQL Injection 취약점**이 나타납니다:

![https://appcheck-ng.com/unicode-normalization-vulnerabilities-the-special-k-polyglot/](<../../.gitbook/assets/image (157) (1).png>)

**일부 흥미로운 유니코드 문자**

* `o` -- %e1%b4%bc
* `r` -- %e1%b4%bf
* `1` -- %c2%b9
* `=` -- %e2%81%bc
* `/` -- %ef%bc%8f
* `-`-- %ef%b9%a3
* `#`-- %ef%b9%9f
* `*`-- %ef%b9%a1
* `'` -- %ef%bc%87
* `"` -- %ef%bc%82
* `|` -- %ef%bd%9c
```
' or 1=1-- -
%ef%bc%87+%e1%b4%bc%e1%b4%bf+%c2%b9%e2%81%bc%c2%b9%ef%b9%a3%ef%b9%a3+%ef%b9%a3

" or 1=1-- -
%ef%bc%82+%e1%b4%bc%e1%b4%bf+%c2%b9%e2%81%bc%c2%b9%ef%b9%a3%ef%b9%a3+%ef%b9%a3

' || 1==1//
%ef%bc%87+%ef%bd%9c%ef%bd%9c+%c2%b9%e2%81%bc%e2%81%bc%c2%b9%ef%bc%8f%ef%bc%8f

" || 1==1//
%ef%bc%82+%ef%bd%9c%ef%bd%9c+%c2%b9%e2%81%bc%e2%81%bc%c2%b9%ef%bc%8f%ef%bc%8f
```
#### sqlmap 템플릿

{% embed url="https://github.com/carlospolop/sqlmap_to_unicode_template" %}

### XSS (크로스 사이트 스크립팅)

다음 문자 중 하나를 사용하여 웹 애플리케이션을 속이고 XSS를 악용할 수 있습니다:

![https://appcheck-ng.com/unicode-normalization-vulnerabilities-the-special-k-polyglot/](<../../.gitbook/assets/image (312) (1).png>)

예를 들어, 제안된 첫 번째 유니코드 문자는 `%e2%89%ae` 또는 `%u226e`로 전송될 수 있습니다.

![https://appcheck-ng.com/unicode-normalization-vulnerabilities-the-special-k-polyglot/](<../../.gitbook/assets/image (215) (1).png>)

### 정규식 퍼징

백엔드에서 **정규식으로 사용자 입력을 확인**하는 경우, **입력**이 **정규식을 위해 정규화**되지만 **사용되는 곳에서는 정규화되지 않을 수 있습니다**. 예를 들어, Open Redirect 또는 SSRF에서 정규식은 **전송된 URL을 정규화**하지만 **원래 그대로 접근**할 수 있습니다.

도구 [**recollapse**](https://github.com/0xacb/recollapse)는 백엔드를 퍼징하기 위해 입력의 변형을 생성할 수 있습니다. 자세한 정보는 **github**와 이 [**포스트**](https://0xacb.com/2022/11/21/recollapse/)를 확인하세요.


## 참고 자료
* [**https://labs.spotify.com/2013/06/18/creative-usernames/**](https://labs.spotify.com/2013/06/18/creative-usernames/)
* [**https://security.stackexchange.com/questions/48879/why-does-directory-traversal-attack-c0af-work**](https://security.stackexchange.com/questions/48879/why-does-directory-traversal-attack-c0af-work)
* [**https://jlajara.gitlab.io/posts/2020/02/19/Bypass\_WAF\_Unicode.html**](https://jlajara.gitlab.io/posts/2020/02/19/Bypass\_WAF\_Unicode.html)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>를 통해 AWS 해킹을 처음부터 전문가까지 배워보세요<strong>!</strong></summary>

HackTricks를 지원하는 다른 방법:

* **회사를 HackTricks에서 광고하거나 HackTricks를 PDF로 다운로드**하려면 [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)를 확인하세요!
* [**공식 PEASS & HackTricks 스웨그**](https://peass.creator-spring.com)를 얻으세요.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)를 발견하세요. 독점적인 [**NFTs**](https://opensea.io/collection/the-peass-family) 컬렉션입니다.
* 💬 [**Discord 그룹**](https://discord.gg/hRep4RUj7f) 또는 [**텔레그램 그룹**](https://t.me/peass)에 **참여**하거나 **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)**를** 팔로우하세요.
* **HackTricks**와 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github 저장소에 PR을 제출하여 여러분의 해킹 기법을 공유하세요.

</details>
