# Unicode-Normalisierung

<details>

<summary><strong>Lernen Sie AWS-Hacking von Grund auf mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks bewerben m√∂chten** oder **HackTricks als PDF herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merchandise**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) Github-Repositories senden.

</details>

**Dies ist eine Zusammenfassung von: [https://appcheck-ng.com/unicode-normalization-vulnerabilities-the-special-k-polyglot/](https://appcheck-ng.com/unicode-normalization-vulnerabilities-the-special-k-polyglot/)**. Weitere Details finden Sie dort (Bilder von dort √ºbernommen).


## Verst√§ndnis von Unicode und Normalisierung

Die Unicode-Normalisierung ist ein Prozess, der sicherstellt, dass verschiedene bin√§re Darstellungen von Zeichen auf den gleichen bin√§ren Wert standardisiert werden. Dieser Prozess ist entscheidend beim Umgang mit Zeichenketten in der Programmierung und Datenverarbeitung. Der Unicode-Standard definiert zwei Arten von Zeichen√§quivalenz:

1. **Kanonische √Ñquivalenz**: Zeichen gelten als kanonisch √§quivalent, wenn sie das gleiche Aussehen und die gleiche Bedeutung haben, wenn sie gedruckt oder angezeigt werden.
2. **Kompatibilit√§ts√§quivalenz**: Eine schw√§chere Form der √Ñquivalenz, bei der Zeichen dasselbe abstrakte Zeichen darstellen k√∂nnen, aber unterschiedlich angezeigt werden k√∂nnen.

Es gibt **vier Unicode-Normalisierungsalgorithmen**: NFC, NFD, NFKC und NFKD. Jeder Algorithmus verwendet kanonische und kompatible Normalisierungstechniken auf unterschiedliche Weise. F√ºr ein tieferes Verst√§ndnis k√∂nnen Sie diese Techniken auf [Unicode.org](https://unicode.org/) erkunden.

### Schl√ºsselpunkte zur Unicode-Kodierung

Das Verst√§ndnis der Unicode-Kodierung ist entscheidend, insbesondere beim Umgang mit Interoperabilit√§tsproblemen zwischen verschiedenen Systemen oder Sprachen. Hier sind die wichtigsten Punkte:

- **Codepunkte und Zeichen**: In Unicode wird jedem Zeichen oder Symbol ein numerischer Wert zugewiesen, der als "Codepunkt" bezeichnet wird.
- **Byte-Repr√§sentation**: Der Codepunkt (oder das Zeichen) wird durch ein oder mehrere Bytes im Speicher repr√§sentiert. Zum Beispiel werden LATIN-1-Zeichen (√ºblich in englischsprachigen L√§ndern) mit einem Byte dargestellt. Sprachen mit einem gr√∂√üeren Zeichensatz ben√∂tigen jedoch mehr Bytes zur Darstellung.
- **Kodierung**: Dieser Begriff bezieht sich darauf, wie Zeichen in eine Folge von Bytes umgewandelt werden. UTF-8 ist ein verbreiteter Kodierungsstandard, bei dem ASCII-Zeichen mit einem Byte und bis zu vier Bytes f√ºr andere Zeichen dargestellt werden.
- **Datenverarbeitung**: Systeme, die Daten verarbeiten, m√ºssen sich der verwendeten Kodierung bewusst sein, um den Byte-Stream korrekt in Zeichen umzuwandeln.
- **Varianten von UTF**: Neben UTF-8 gibt es andere Kodierungsstandards wie UTF-16 (mit mindestens 2 Bytes, bis zu 4) und UTF-32 (mit 4 Bytes f√ºr alle Zeichen).

Es ist wichtig, diese Konzepte zu verstehen, um potenzielle Probleme im Umgang mit der Komplexit√§t von Unicode und seinen verschiedenen Kodierungsmethoden effektiv zu behandeln und zu mindern.


Ein Beispiel daf√ºr, wie Unicode zwei verschiedene Bytes normalisiert, die dasselbe Zeichen darstellen:
```python
unicodedata.normalize("NFKD","chloe\u0301") == unicodedata.normalize("NFKD", "chlo\u00e9")
```
**Eine Liste √§quivalenter Unicode-Zeichen finden Sie hier:** [https://appcheck-ng.com/wp-content/uploads/unicode\_normalization.html](https://appcheck-ng.com/wp-content/uploads/unicode\_normalization.html) und [https://0xacb.com/normalization\_table](https://0xacb.com/normalization\_table)

### Entdeckung

Wenn Sie in einer Webanwendung einen Wert finden, der zur√ºckgegeben wird, k√∂nnten Sie versuchen, das **'KELVIN-ZEICHEN' (U+0212A)** zu senden, das sich zu "K" normalisiert (Sie k√∂nnen es als `%e2%84%aa` senden). **Wenn ein "K" zur√ºckgegeben wird**, wird eine Art von **Unicode-Normalisierung** durchgef√ºhrt.

Ein anderes **Beispiel**: `%F0%9D%95%83%E2%85%87%F0%9D%99%A4%F0%9D%93%83%E2%85%88%F0%9D%94%B0%F0%9D%94%A5%F0%9D%99%96%F0%9D%93%83` nach der **Unicode**-Normalisierung ergibt `Leonishan`.

## **Beispiele f√ºr verwundbare Anwendungen**

### **Bypass der SQL-Injection-Filter**

Stellen Sie sich eine Webseite vor, die das Zeichen `'` verwendet, um SQL-Abfragen mit der Benutzereingabe zu erstellen. Diese Webseite l√∂scht als Sicherheitsma√ünahme alle Vorkommen des Zeichens **`'`** aus der Benutzereingabe, aber **nach dieser L√∂schung** und **vor der Erstellung** der Abfrage **normalisiert** sie die Benutzereingabe mit **Unicode**.

Dann k√∂nnte ein b√∂sartiger Benutzer ein anderes Unicode-Zeichen einf√ºgen, das dem Zeichen `' (0x27)` entspricht, z.B. `%ef%bc%87`. Wenn die Eingabe normalisiert wird, wird ein einfaches Anf√ºhrungszeichen erstellt und es entsteht eine **SQL-Injection-Schwachstelle**:

![https://appcheck-ng.com/unicode-normalization-vulnerabilities-the-special-k-polyglot/](<../../.gitbook/assets/image (157) (1).png>)

**Einige interessante Unicode-Zeichen**

* `o` -- %e1%b4%bc
* `r` -- %e1%b4%bf
* `1` -- %c2%b9
* `=` -- %e2%81%bc
* `/` -- %ef%bc%8f
* `-`-- %ef%b9%a3
* `#`-- %ef%b9%9f
* `*`-- %ef%b9%a1
* `'` -- %ef%bc%87
* `"` -- %ef%bc%82
* `|` -- %ef%bd%9c
```
' or 1=1-- -
%ef%bc%87+%e1%b4%bc%e1%b4%bf+%c2%b9%e2%81%bc%c2%b9%ef%b9%a3%ef%b9%a3+%ef%b9%a3

" or 1=1-- -
%ef%bc%82+%e1%b4%bc%e1%b4%bf+%c2%b9%e2%81%bc%c2%b9%ef%b9%a3%ef%b9%a3+%ef%b9%a3

' || 1==1//
%ef%bc%87+%ef%bd%9c%ef%bd%9c+%c2%b9%e2%81%bc%e2%81%bc%c2%b9%ef%bc%8f%ef%bc%8f

" || 1==1//
%ef%bc%82+%ef%bd%9c%ef%bd%9c+%c2%b9%e2%81%bc%e2%81%bc%c2%b9%ef%bc%8f%ef%bc%8f
```
#### sqlmap Vorlage

{% embed url="https://github.com/carlospolop/sqlmap_to_unicode_template" %}

### XSS (Cross-Site Scripting)

Sie k√∂nnen eines der folgenden Zeichen verwenden, um die Webanwendung zu t√§uschen und eine XSS-Attacke durchzuf√ºhren:

![https://appcheck-ng.com/unicode-normalization-vulnerabilities-the-special-k-polyglot/](<../../.gitbook/assets/image (312) (1).png>)

Beachten Sie, dass zum Beispiel das vorgeschlagene erste Unicode-Zeichen als `%e2%89%ae` oder als `%u226e` gesendet werden kann.

![https://appcheck-ng.com/unicode-normalization-vulnerabilities-the-special-k-polyglot/](<../../.gitbook/assets/image (215) (1).png>)

### Fuzzing Regexes

Wenn das Backend **Benutzereingaben mit einem Regex √ºberpr√ºft**, ist es m√∂glicherweise m√∂glich, dass die **Eingabe** f√ºr den **Regex normalisiert** wird, aber **nicht** f√ºr den Ort, an dem sie **verwendet** wird. Zum Beispiel k√∂nnte in einer Open Redirect- oder SSRF-Schwachstelle der Regex die gesendete URL **normalisieren**, aber dann **unver√§ndert darauf zugreifen**.

Das Tool [**recollapse**](https://github.com/0xacb/recollapse) erm√∂glicht es, **Variationen der Eingabe** zu generieren, um das Backend zu fuzzing. Weitere Informationen finden Sie auf **GitHub** und in diesem [**Beitrag**](https://0xacb.com/2022/11/21/recollapse/).


## Referenzen
* [**https://labs.spotify.com/2013/06/18/creative-usernames/**](https://labs.spotify.com/2013/06/18/creative-usernames/)
* [**https://security.stackexchange.com/questions/48879/why-does-directory-traversal-attack-c0af-work**](https://security.stackexchange.com/questions/48879/why-does-directory-traversal-attack-c0af-work)
* [**https://jlajara.gitlab.io/posts/2020/02/19/Bypass\_WAF\_Unicode.html**](https://jlajara.gitlab.io/posts/2020/02/19/Bypass\_WAF\_Unicode.html)

<details>

<summary><strong>Lernen Sie AWS-Hacking von Grund auf mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks bewerben m√∂chten** oder **HackTricks als PDF herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merchandise**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder folgen Sie uns auf **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositories senden.

</details>
