# Normalizzazione Unicode

<details>

<summary><strong>Impara l'hacking su AWS da zero a eroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se vuoi vedere la tua **azienda pubblicizzata su HackTricks** o **scaricare HackTricks in PDF** Controlla i [**PIANI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale di PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**La Famiglia PEASS**](https://opensea.io/collection/the-peass-family), la nostra collezione di [**NFT esclusivi**](https://opensea.io/collection/the-peass-family)
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR a** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos di github.

</details>

### [WhiteIntel](https://whiteintel.io)

<figure><img src="../../.gitbook/assets/image (1227).png" alt=""><figcaption></figcaption></figure>

[**WhiteIntel**](https://whiteintel.io) √® un motore di ricerca alimentato dal **dark web** che offre funzionalit√† **gratuite** per verificare se un'azienda o i suoi clienti sono stati **compromessi** da **malware ruba-informazioni**.

Il loro obiettivo principale di WhiteIntel √® combattere i takeover di account e gli attacchi ransomware derivanti da malware che rubano informazioni.

Puoi visitare il loro sito web e provare il loro motore **gratuitamente** su:

{% embed url="https://whiteintel.io" %}

***

**Questo √® un riassunto di:** [**https://appcheck-ng.com/unicode-normalization-vulnerabilities-the-special-k-polyglot/**](https://appcheck-ng.com/unicode-normalization-vulnerabilities-the-special-k-polyglot/). Dai un'occhiata per ulteriori dettagli (immagini prese da l√¨).

## Comprensione di Unicode e Normalizzazione

La normalizzazione Unicode √® un processo che garantisce che rappresentazioni binarie diverse dei caratteri siano standardizzate allo stesso valore binario. Questo processo √® cruciale nel trattare le stringhe nella programmazione e nell'elaborazione dei dati. Lo standard Unicode definisce due tipi di equivalenza dei caratteri:

1. **Equivalenza Canonica**: I caratteri sono considerati canonica equivalenti se hanno la stessa apparenza e significato quando stampati o visualizzati.
2. **Equivalenza di Compatibilit√†**: Una forma pi√π debole di equivalenza in cui i caratteri possono rappresentare lo stesso carattere astratto ma possono essere visualizzati in modo diverso.

Ci sono **quattro algoritmi di normalizzazione Unicode**: NFC, NFD, NFKC e NFKD. Ciascun algoritmo utilizza tecniche di normalizzazione canonica e di compatibilit√† in modo diverso. Per una comprensione pi√π approfondita, puoi esplorare queste tecniche su [Unicode.org](https://unicode.org/).

### Punti Chiave sull'Encoding Unicode

Comprendere l'encoding Unicode √® fondamentale, specialmente quando si affrontano problemi di interoperabilit√† tra sistemi o linguaggi diversi. Ecco i principali punti:

* **Punti Codice e Caratteri**: In Unicode, ogni carattere o simbolo √® assegnato un valore numerico noto come "punto codice".
* **Rappresentazione in Byte**: Il punto codice (o carattere) √® rappresentato da uno o pi√π byte in memoria. Ad esempio, i caratteri LATIN-1 (comuni nei paesi di lingua inglese) sono rappresentati utilizzando un byte. Tuttavia, le lingue con un insieme pi√π ampio di caratteri necessitano di pi√π byte per la rappresentazione.
* **Encoding**: Questo termine si riferisce a come i caratteri vengono trasformati in una serie di byte. UTF-8 √® uno standard di encoding diffuso in cui i caratteri ASCII sono rappresentati utilizzando un byte e fino a quattro byte per altri caratteri.
* **Elaborazione dei Dati**: I sistemi che elaborano i dati devono essere consapevoli dell'encoding utilizzato per convertire correttamente il flusso di byte in caratteri.
* **Varianti di UTF**: Oltre a UTF-8, ci sono altri standard di encoding come UTF-16 (utilizzando un minimo di 2 byte, fino a 4) e UTF-32 (utilizzando 4 byte per tutti i caratteri).

√à cruciale comprendere questi concetti per gestire ed attenuare efficacemente i potenziali problemi derivanti dalla complessit√† di Unicode e dai suoi vari metodi di encoding.

Un esempio di come Unicode normalizza due byte diversi che rappresentano lo stesso carattere:
```python
unicodedata.normalize("NFKD","chloe\u0301") == unicodedata.normalize("NFKD", "chlo\u00e9")
```
**Un elenco dei caratteri equivalenti Unicode pu√≤ essere trovato qui:** [https://appcheck-ng.com/wp-content/uploads/unicode\_normalization.html](https://appcheck-ng.com/wp-content/uploads/unicode\_normalization.html) e [https://0xacb.com/normalization\_table](https://0xacb.com/normalization\_table)

### Scoperta

Se riesci a trovare all'interno di un'app web un valore che viene ripetuto, potresti provare a inviare il **'SIMBOLO KELVIN' (U+0212A)** che si **normalizza a "K"** (puoi inviarlo come `%e2%84%aa`). **Se viene ripetuto un "K"**, allora, viene eseguita qualche forma di **normalizzazione Unicode**.

Altro **esempio**: `%F0%9D%95%83%E2%85%87%F0%9D%99%A4%F0%9D%93%83%E2%85%88%F0%9D%94%B0%F0%9D%94%A5%F0%9D%99%96%F0%9D%93%83` dopo la **normalizzazione Unicode** diventa `Leonishan`.

## **Esempi di Vulnerabilit√†**

### **Bypass del filtro di SQL Injection**

Immagina una pagina web che utilizza il carattere `'` per creare query SQL con l'input dell'utente. Questa pagina web, come misura di sicurezza, **elimina** tutte le occorrenze del carattere **`'`** dall'input dell'utente, ma **dopo tale eliminazione** e **prima della creazione** della query, **normalizza** utilizzando **Unicode** l'input dell'utente.

Quindi, un utente malintenzionato potrebbe inserire un diverso carattere Unicode equivalente a `' (0x27)` come `%ef%bc%87`, quando l'input viene normalizzato, viene creato un singolo apice e appare una **vulnerabilit√† di SQL Injection**:

![https://appcheck-ng.com/unicode-normalization-vulnerabilities-the-special-k-polyglot/](<../../.gitbook/assets/image (702).png>)

**Alcuni interessanti caratteri Unicode**

* `o` -- %e1%b4%bc
* `r` -- %e1%b4%bf
* `1` -- %c2%b9
* `=` -- %e2%81%bc
* `/` -- %ef%bc%8f
* `-`-- %ef%b9%a3
* `#`-- %ef%b9%9f
* `*`-- %ef%b9%a1
* `'` -- %ef%bc%87
* `"` -- %ef%bc%82
* `|` -- %ef%bd%9c
```
' or 1=1-- -
%ef%bc%87+%e1%b4%bc%e1%b4%bf+%c2%b9%e2%81%bc%c2%b9%ef%b9%a3%ef%b9%a3+%ef%b9%a3

" or 1=1-- -
%ef%bc%82+%e1%b4%bc%e1%b4%bf+%c2%b9%e2%81%bc%c2%b9%ef%b9%a3%ef%b9%a3+%ef%b9%a3

' || 1==1//
%ef%bc%87+%ef%bd%9c%ef%bd%9c+%c2%b9%e2%81%bc%e2%81%bc%c2%b9%ef%bc%8f%ef%bc%8f

" || 1==1//
%ef%bc%82+%ef%bd%9c%ef%bd%9c+%c2%b9%e2%81%bc%e2%81%bc%c2%b9%ef%bc%8f%ef%bc%8f
```
#### Modello sqlmap

{% embed url="https://github.com/carlospolop/sqlmap_to_unicode_template" %}

### XSS (Cross Site Scripting)

Potresti utilizzare uno dei seguenti caratteri per ingannare l'applicazione web ed sfruttare una XSS:

![https://appcheck-ng.com/unicode-normalization-vulnerabilities-the-special-k-polyglot/](<../../.gitbook/assets/image (312) (2).png>)

Nota che ad esempio il primo carattere Unicode proposto pu√≤ essere inviato come: `%e2%89%ae` o come `%u226e`

![https://appcheck-ng.com/unicode-normalization-vulnerabilities-the-special-k-polyglot/](<../../.gitbook/assets/image (215) (1) (1).png>)

### Fuzzing Regexes

Quando il backend sta **controllando l'input dell'utente con una regex**, potrebbe essere possibile che l'**input** venga **normalizzato** per la **regex** ma **non** per dove viene **utilizzato**. Ad esempio, in un Open Redirect o SSRF la regex potrebbe **normalizzare l'URL inviato** ma poi **accedervi cos√¨ com'√®**.

Lo strumento [**recollapse**](https://github.com/0xacb/recollapse) permette di **generare variazioni dell'input** per fuzzare il backend. Per ulteriori informazioni controlla il **github** e questo [**post**](https://0xacb.com/2022/11/21/recollapse/).

## Riferimenti

* [**https://labs.spotify.com/2013/06/18/creative-usernames/**](https://labs.spotify.com/2013/06/18/creative-usernames/)
* [**https://security.stackexchange.com/questions/48879/why-does-directory-traversal-attack-c0af-work**](https://security.stackexchange.com/questions/48879/why-does-directory-traversal-attack-c0af-work)
* [**https://jlajara.gitlab.io/posts/2020/02/19/Bypass\_WAF\_Unicode.html**](https://jlajara.gitlab.io/posts/2020/02/19/Bypass\_WAF\_Unicode.html)

### [WhiteIntel](https://whiteintel.io)

<figure><img src="../../.gitbook/assets/image (1227).png" alt=""><figcaption></figcaption></figure>

[**WhiteIntel**](https://whiteintel.io) √® un motore di ricerca alimentato dal **dark web** che offre funzionalit√† **gratuite** per verificare se un'azienda o i suoi clienti sono stati **compromessi** da **malware stealer**.

Il loro obiettivo principale √® combattere i takeover degli account e gli attacchi ransomware derivanti da malware che rubano informazioni.

Puoi controllare il loro sito web e provare il loro motore **gratuitamente** su:

{% embed url="https://whiteintel.io" %}

<details>

<summary><strong>Impara l'hacking AWS da zero a eroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se vuoi vedere la tua **azienda pubblicizzata in HackTricks** o **scaricare HackTricks in PDF** Controlla i [**PIANI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**The PEASS Family**](https://opensea.io/collection/the-peass-family), la nostra collezione di esclusivi [**NFT**](https://opensea.io/collection/the-peass-family)
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR ai** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
