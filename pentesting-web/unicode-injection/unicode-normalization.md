## Normalizaci√≥n Unicode

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* ¬øTrabajas en una **empresa de ciberseguridad**? ¬øQuieres ver tu **empresa anunciada en HackTricks**? ¬øO quieres tener acceso a la **√∫ltima versi√≥n de PEASS o descargar HackTricks en PDF**? ¬°Consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Consigue el [**swag oficial de PEASS y HackTricks**](https://peass.creator-spring.com)
* **√önete al** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠gueme** en **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Comparte tus trucos de hacking enviando PR al** [**repositorio de hacktricks**](https://github.com/carlospolop/hacktricks) **y al** [**repositorio de hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Antecedentes

La normalizaci√≥n asegura que dos cadenas que pueden usar una representaci√≥n binaria diferente para sus caracteres tengan el mismo valor binario despu√©s de la normalizaci√≥n.

Hay dos tipos generales de equivalencia entre caracteres, "Equivalencia can√≥nica" y "Equivalencia de compatibilidad":\
Los caracteres "Equivalente can√≥nico" se supone que tienen la misma apariencia y significado cuando se imprimen o muestran. La "Equivalencia de compatibilidad" es una equivalencia m√°s d√©bil, en el sentido de que dos valores pueden representar el mismo car√°cter abstracto pero pueden mostrarse de manera diferente. Hay 4 algoritmos de normalizaci√≥n definidos por el est√°ndar Unicode; NFC, NFD, NFKD y NFKD, cada uno aplica t√©cnicas de normalizaci√≥n can√≥nicas y de compatibilidad de manera diferente. Puedes leer m√°s sobre las diferentes t√©cnicas en Unicode.org.

### Codificaci√≥n Unicode

Aunque Unicode fue dise√±ado en parte para resolver problemas de interoperabilidad, la evoluci√≥n del est√°ndar, la necesidad de admitir sistemas heredados y diferentes m√©todos de codificaci√≥n a√∫n pueden plantear un desaf√≠o.\
Antes de adentrarnos en los ataques Unicode, estos son los puntos principales que debes entender sobre Unicode:

* Cada car√°cter o s√≠mbolo se asigna a un valor num√©rico que se denomina "punto de c√≥digo".
* El valor del punto de c√≥digo (y, por lo tanto, el car√°cter en s√≠) se representa mediante 1 o m√°s bytes en memoria. Los caracteres LATIN-1 como los utilizados en los pa√≠ses de habla inglesa se pueden representar utilizando 1 byte. Otros idiomas tienen m√°s caracteres y necesitan m√°s bytes para representar todos los diferentes puntos de c√≥digo (tambi√©n porque no pueden usar los ya tomados por LATIN-1).
* El t√©rmino "codificaci√≥n" significa el m√©todo en el que los caracteres se representan como una serie de bytes. El est√°ndar de codificaci√≥n m√°s com√∫n es UTF-8, utilizando este esquema de codificaci√≥n, los caracteres ASCII se pueden representar utilizando 1 byte o hasta 4 bytes para otros caracteres.
* Cuando un sistema procesa datos, necesita conocer la codificaci√≥n utilizada para convertir el flujo de bytes en caracteres.
* Aunque UTF-8 es el m√°s com√∫n, hay est√°ndares de codificaci√≥n similares llamados UTF-16 y UTF-32, la diferencia entre cada uno es el n√∫mero de bytes utilizados para representar cada car√°cter. es decir, UTF-16 utiliza un m√≠nimo de 2 bytes (pero hasta 4) y UTF-32 utiliza 4 bytes para todos los caracteres.

Un ejemplo de c√≥mo Unicode normaliza dos bytes diferentes que representan el mismo car√°cter:

![](<../../.gitbook/assets/image (156).png>)

**Aqu√≠ puedes encontrar una lista de caracteres equivalentes Unicode:** [https://appcheck-ng.com/wp-content/uploads/unicode\_normalization.html](https://appcheck-ng.com/wp-content/uploads/unicode\_normalization.html) y [https://0xacb.com/normalization\_table](https://0xacb.com/normalization\_table)

### Descubrimiento

Si puedes encontrar dentro de una aplicaci√≥n web un valor que se est√° reenviando, podr√≠as intentar enviar **'KELVIN SIGN' (U+0212A)** que se **normaliza a "K"** (puedes enviarlo como `%e2%84%aa`). **Si se devuelve un "K"**, entonces, se est√° realizando alg√∫n tipo de **normalizaci√≥n Unicode**.

Otro **ejemplo**: `%F0%9D%95%83%E2%85%87%F0%9D%99%A4%F0%9D%93%83%E2%85%88%F0%9D%94%B0%F0%9D%94%A5%F0%9D%99%96%F0%9D%93%83` despu√©s de **Unicode** es `Leonishan`.

## Ejemplos vulnerables

### Bypass de filtro de inyecci√≥n SQL

Imagina una p√°gina web que est√° usando el car√°cter `'` para crear consultas SQL con la entrada del usuario. Esta web, como medida de seguridad, **elimina** todas las ocurrencias del car√°cter **`'`** de la entrada del usuario, pero **despu√©s de esa eliminaci√≥n** y **antes de la creaci√≥n** de la consulta, **normaliza** usando **Unicode** la entrada del usuario.

Entonces, un usuario malintencionado podr√≠a insertar un car√°cter Unicode diferente equivalente a `' (0x27)` como `%ef%bc%87` , cuando la entrada se normaliza, se crea una comilla simple y aparece una **vulnerabilidad de SQLInjection**:

![](<../../.gitbook/assets/image (157) (1).png>)

**Algunos caracteres Unicode interesantes**

* `o` -- %e1%b4%bc
* `r` -- %e1%b4%bf
* `1` -- %c2%b9
* `=` -- %e2%81%bc
* `/` -- %ef%bc%8f
* `-`-- %ef%b9%a3
* `#`-- %ef%b9%9f
* `*`-- %ef%b9%a1
* `'` -- %ef%bc%87
* `"` -- %ef%bc%82
* `|` -- %ef%bd%9c
```
' or 1=1-- -
%ef%bc%87+%e1%b4%bc%e1%b4%bf+%c2%b9%e2%81%bc%c2%b9%ef%b9%a3%ef%b9%a3+%ef%b9%a3

" or 1=1-- -
%ef%bc%82+%e1%b4%bc%e1%b4%bf+%c2%b9%e2%81%bc%c2%b9%ef%b9%a3%ef%b9%a3+%ef%b9%a3

' || 1==1//
%ef%bc%87+%ef%bd%9c%ef%bd%9c+%c2%b9%e2%81%bc%e2%81%bc%c2%b9%ef%bc%8f%ef%bc%8f

" || 1==1//
%ef%bc%82+%ef%bd%9c%ef%bd%9c+%c2%b9%e2%81%bc%e2%81%bc%c2%b9%ef%bc%8f%ef%bc%8f
```
#### Plantilla sqlmap

{% embed url="https://github.com/carlospolop/sqlmap_to_unicode_template" %}

### XSS (Cross Site Scripting)

Se pueden utilizar uno de los siguientes caracteres para enga√±ar a la aplicaci√≥n web y explotar una XSS:

![](<../../.gitbook/assets/image (312) (1).png>)

Observe que, por ejemplo, el primer car√°cter Unicode propuesto se puede enviar como: `%e2%89%ae` o como `%u226e`

![](<../../.gitbook/assets/image (215) (1).png>)

### Fuzzing Regexes

Cuando el backend est√° **verificando la entrada del usuario con una expresi√≥n regular**, es posible que la **entrada** se est√© **normalizando** para la **expresi√≥n regular** pero **no** para donde se est√° **utilizando**. Por ejemplo, en una redirecci√≥n abierta o SSRF, la expresi√≥n regular podr√≠a estar **normalizando la URL enviada** pero luego **accediendo a ella tal cual**.

La herramienta [**recollapse**](https://github.com/0xacb/recollapse) permite **generar variaciones de la entrada** para probar el backend. Para obtener m√°s informaci√≥n, consulte el **github** y este [**post**](https://0xacb.com/2022/11/21/recollapse/).

## Referencias

**Toda la informaci√≥n de esta p√°gina fue tomada de:** [**https://appcheck-ng.com/unicode-normalization-vulnerabilities-the-special-k-polyglot/#**](https://appcheck-ng.com/unicode-normalization-vulnerabilities-the-special-k-polyglot/)

**Otras referencias:**

* [**https://labs.spotify.com/2013/06/18/creative-usernames/**](https://labs.spotify.com/2013/06/18/creative-usernames/)
* [**https://security.stackexchange.com/questions/48879/why-does-directory-traversal-attack-c0af-work**](https://security.stackexchange.com/questions/48879/why-does-directory-traversal-attack-c0af-work)
* [**https://jlajara.gitlab.io/posts/2020/02/19/Bypass\_WAF\_Unicode.html**](https://jlajara.gitlab.io/posts/2020/02/19/Bypass\_WAF\_Unicode.html)

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* ¬øTrabajas en una **empresa de ciberseguridad**? ¬øQuieres ver tu **empresa anunciada en HackTricks**? ¬øO quieres tener acceso a la **√∫ltima versi√≥n de PEASS o descargar HackTricks en PDF**? ¬°Consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n de exclusivos [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obt√©n el [**swag oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* **√önete al** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠gueme** en **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Comparte tus trucos de hacking enviando PRs al** [**repositorio de hacktricks**](https://github.com/carlospolop/hacktricks) **y al** [**repositorio de hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
