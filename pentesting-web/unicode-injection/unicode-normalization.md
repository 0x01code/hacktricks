# Normaliza√ß√£o Unicode

<details>

<summary><strong>Aprenda hacking na AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras maneiras de apoiar o HackTricks:

* Se voc√™ deseja ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF** Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-nos** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para o** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) reposit√≥rios do github.

</details>

### [WhiteIntel](https://whiteintel.io)

<figure><img src="../../.gitbook/assets/image (1227).png" alt=""><figcaption></figcaption></figure>

[**WhiteIntel**](https://whiteintel.io) √© um mecanismo de busca alimentado pela **dark web** que oferece funcionalidades **gratuitas** para verificar se uma empresa ou seus clientes foram **comprometidos** por **malwares ladr√µes**.

O principal objetivo do WhiteIntel √© combater a apropria√ß√£o de contas e ataques de ransomware resultantes de malwares que roubam informa√ß√µes.

Voc√™ pode verificar o site deles e experimentar o mecanismo de busca gratuitamente em:

{% embed url="https://whiteintel.io" %}

***

**Este √© um resumo de:** [**https://appcheck-ng.com/unicode-normalization-vulnerabilities-the-special-k-polyglot/**](https://appcheck-ng.com/unicode-normalization-vulnerabilities-the-special-k-polyglot/). Confira para mais detalhes (imagens retiradas de l√°).

## Compreens√£o do Unicode e Normaliza√ß√£o

A normaliza√ß√£o Unicode √© um processo que garante que diferentes representa√ß√µes bin√°rias de caracteres sejam padronizadas para o mesmo valor bin√°rio. Esse processo √© crucial ao lidar com strings em programa√ß√£o e processamento de dados. O padr√£o Unicode define dois tipos de equival√™ncia de caracteres:

1. **Equival√™ncia Can√¥nica**: Os caracteres s√£o considerados equivalentes canonicamente se tiverem a mesma apar√™ncia e significado quando impressos ou exibidos.
2. **Equival√™ncia de Compatibilidade**: Uma forma mais fraca de equival√™ncia onde os caracteres podem representar o mesmo caractere abstrato, mas podem ser exibidos de forma diferente.

Existem **quatro algoritmos de normaliza√ß√£o Unicode**: NFC, NFD, NFKC e NFKD. Cada algoritmo emprega t√©cnicas de normaliza√ß√£o can√¥nica e de compatibilidade de maneiras diferentes. Para uma compreens√£o mais aprofundada, voc√™ pode explorar essas t√©cnicas em [Unicode.org](https://unicode.org/).

### Pontos-chave sobre Codifica√ß√£o Unicode

Compreender a codifica√ß√£o Unicode √© fundamental, especialmente ao lidar com problemas de interoperabilidade entre diferentes sistemas ou idiomas. Aqui est√£o os principais pontos:

* **Pontos de C√≥digo e Caracteres**: No Unicode, cada caractere ou s√≠mbolo √© atribu√≠do um valor num√©rico conhecido como "ponto de c√≥digo".
* **Representa√ß√£o em Bytes**: O ponto de c√≥digo (ou caractere) √© representado por um ou mais bytes na mem√≥ria. Por exemplo, os caracteres LATIN-1 (comuns em pa√≠ses de l√≠ngua inglesa) s√£o representados usando um byte. No entanto, idiomas com um conjunto maior de caracteres precisam de mais bytes para representa√ß√£o.
* **Codifica√ß√£o**: Este termo refere-se a como os caracteres s√£o transformados em uma s√©rie de bytes. UTF-8 √© um padr√£o de codifica√ß√£o prevalente onde os caracteres ASCII s√£o representados usando um byte e at√© quatro bytes para outros caracteres.
* **Processamento de Dados**: Sistemas que processam dados devem estar cientes da codifica√ß√£o usada para converter corretamente o fluxo de bytes em caracteres.
* **Variantes do UTF**: Al√©m do UTF-8, existem outros padr√µes de codifica√ß√£o como UTF-16 (usando um m√≠nimo de 2 bytes, at√© 4) e UTF-32 (usando 4 bytes para todos os caracteres).

√â crucial compreender esses conceitos para lidar efetivamente e mitigar problemas potenciais decorrentes da complexidade do Unicode e de seus diversos m√©todos de codifica√ß√£o.

Um exemplo de como o Unicode normaliza dois bytes diferentes representando o mesmo caractere:
```python
unicodedata.normalize("NFKD","chloe\u0301") == unicodedata.normalize("NFKD", "chlo\u00e9")
```
**Uma lista de caracteres equivalentes Unicode pode ser encontrada aqui:** [https://appcheck-ng.com/wp-content/uploads/unicode\_normalization.html](https://appcheck-ng.com/wp-content/uploads/unicode\_normalization.html) e [https://0xacb.com/normalization\_table](https://0xacb.com/normalization\_table)

### Descoberta

Se voc√™ encontrar em um aplicativo da web um valor que est√° sendo ecoado de volta, voc√™ pode tentar enviar o **'SINAL DE KELVIN' (U+0212A)** que **se normaliza para "K"** (voc√™ pode envi√°-lo como `%e2%84%aa`). **Se um "K" for ecoado de volta**, ent√£o algum tipo de **normaliza√ß√£o Unicode** est√° sendo realizada.

Outro **exemplo**: `%F0%9D%95%83%E2%85%87%F0%9D%99%A4%F0%9D%93%83%E2%85%88%F0%9D%94%B0%F0%9D%94%A5%F0%9D%99%96%F0%9D%93%83` ap√≥s a **unicode** √© `Leonishan`.

## **Exemplos Vulner√°veis**

### **Burla de filtro de Inje√ß√£o de SQL**

Imagine uma p√°gina da web que est√° usando o caractere `'` para criar consultas SQL com a entrada do usu√°rio. Esta p√°gina da web, como medida de seguran√ßa, **deleta** todas as ocorr√™ncias do caractere **`'`** da entrada do usu√°rio, mas **ap√≥s essa exclus√£o** e **antes da cria√ß√£o** da consulta, ela **normaliza** usando **Unicode** a entrada do usu√°rio.

Ent√£o, um usu√°rio malicioso poderia inserir um caractere Unicode diferente equivalente a `' (0x27)` como `%ef%bc%87`, quando a entrada √© normalizada, uma aspa simples √© criada e uma **vulnerabilidade de Inje√ß√£o de SQL** aparece:

![https://appcheck-ng.com/unicode-normalization-vulnerabilities-the-special-k-polyglot/](<../../.gitbook/assets/image (702).png>)

**Alguns caracteres Unicode interessantes**

* `o` -- %e1%b4%bc
* `r` -- %e1%b4%bf
* `1` -- %c2%b9
* `=` -- %e2%81%bc
* `/` -- %ef%bc%8f
* `-`-- %ef%b9%a3
* `#`-- %ef%b9%9f
* `*`-- %ef%b9%a1
* `'` -- %ef%bc%87
* `"` -- %ef%bc%82
* `|` -- %ef%bd%9c
```
' or 1=1-- -
%ef%bc%87+%e1%b4%bc%e1%b4%bf+%c2%b9%e2%81%bc%c2%b9%ef%b9%a3%ef%b9%a3+%ef%b9%a3

" or 1=1-- -
%ef%bc%82+%e1%b4%bc%e1%b4%bf+%c2%b9%e2%81%bc%c2%b9%ef%b9%a3%ef%b9%a3+%ef%b9%a3

' || 1==1//
%ef%bc%87+%ef%bd%9c%ef%bd%9c+%c2%b9%e2%81%bc%e2%81%bc%c2%b9%ef%bc%8f%ef%bc%8f

" || 1==1//
%ef%bc%82+%ef%bd%9c%ef%bd%9c+%c2%b9%e2%81%bc%e2%81%bc%c2%b9%ef%bc%8f%ef%bc%8f
```
#### Modelo sqlmap

{% embed url="https://github.com/carlospolop/sqlmap_to_unicode_template" %}

### XSS (Cross Site Scripting)

Voc√™ poderia usar um dos seguintes caracteres para enganar o aplicativo da web e explorar um XSS:

![https://appcheck-ng.com/unicode-normalization-vulnerabilities-the-special-k-polyglot/](<../../.gitbook/assets/image (312) (2).png>)

Observe que, por exemplo, o primeiro caractere Unicode proposto pode ser enviado como: `%e2%89%ae` ou como `%u226e`

![https://appcheck-ng.com/unicode-normalization-vulnerabilities-the-special-k-polyglot/](<../../.gitbook/assets/image (215) (1) (1).png>)

### Fuzzing de Regexes

Quando o backend est√° **verificando a entrada do usu√°rio com um regex**, pode ser poss√≠vel que a **entrada** esteja sendo **normalizada** para o **regex** mas **n√£o** para onde est√° sendo **usada**. Por exemplo, em um Redirecionamento Aberto ou SSRF o regex pode estar **normalizando o URL enviado** mas ent√£o **acessando-o como est√°**.

A ferramenta [**recollapse**](https://github.com/0xacb/recollapse) permite **gerar varia√ß√µes da entrada** para fuzzar o backend. Para mais informa√ß√µes, verifique o **github** e este [**post**](https://0xacb.com/2022/11/21/recollapse/).

## Refer√™ncias

* [**https://labs.spotify.com/2013/06/18/creative-usernames/**](https://labs.spotify.com/2013/06/18/creative-usernames/)
* [**https://security.stackexchange.com/questions/48879/why-does-directory-traversal-attack-c0af-work**](https://security.stackexchange.com/questions/48879/why-does-directory-traversal-attack-c0af-work)
* [**https://jlajara.gitlab.io/posts/2020/02/19/Bypass\_WAF\_Unicode.html**](https://jlajara.gitlab.io/posts/2020/02/19/Bypass\_WAF\_Unicode.html)

### [WhiteIntel](https://whiteintel.io)

<figure><img src="../../.gitbook/assets/image (1227).png" alt=""><figcaption></figcaption></figure>

[**WhiteIntel**](https://whiteintel.io) √© um mecanismo de busca alimentado pela **dark web** que oferece funcionalidades **gratuitas** para verificar se uma empresa ou seus clientes foram **comprometidos** por **malwares de roubo**.

O principal objetivo do WhiteIntel √© combater tomadas de contas e ataques de ransomware resultantes de malwares que roubam informa√ß√µes.

Voc√™ pode verificar o site deles e experimentar o mecanismo de busca de forma **gratuita** em:

{% embed url="https://whiteintel.io" %}

<details>

<summary><strong>Aprenda hacking AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras maneiras de apoiar o HackTricks:

* Se voc√™ deseja ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF**, verifique os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**swag oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou nos siga no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
