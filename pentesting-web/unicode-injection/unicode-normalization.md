# Normalizaci칩n Unicode

<details>

<summary><strong>Aprende hacking en AWS desde cero hasta experto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si deseas ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** 춰Consulta los [**PLANES DE SUSCRIPCI칍N**](https://github.com/sponsors/carlospolop)!
* Obt칠n [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci칩n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s칤guenos** en **Twitter** 游냕 [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

### [WhiteIntel](https://whiteintel.io)

<figure><img src="/.gitbook/assets/image (1224).png" alt=""><figcaption></figcaption></figure>

[**WhiteIntel**](https://whiteintel.io) es un motor de b칰squeda impulsado por la **dark web** que ofrece funcionalidades **gratuitas** para verificar si una empresa o sus clientes han sido **comprometidos** por **malwares robadores**.

El objetivo principal de WhiteIntel es combatir los secuestros de cuentas y los ataques de ransomware resultantes de malwares que roban informaci칩n.

Puedes visitar su sitio web y probar su motor de forma **gratuita** en:

{% embed url="https://whiteintel.io" %}

---

**Este es un resumen de:** [**https://appcheck-ng.com/unicode-normalization-vulnerabilities-the-special-k-polyglot/**](https://appcheck-ng.com/unicode-normalization-vulnerabilities-the-special-k-polyglot/). Consulta para m치s detalles (im치genes tomadas de all칤).

## Comprendiendo Unicode y Normalizaci칩n

La normalizaci칩n Unicode es un proceso que asegura que las diferentes representaciones binarias de los caracteres se estandaricen al mismo valor binario. Este proceso es crucial al tratar con cadenas en programaci칩n y procesamiento de datos. El est치ndar Unicode define dos tipos de equivalencia de caracteres:

1. **Equivalencia Can칩nica**: Los caracteres se consideran equivalente can칩nicamente si tienen la misma apariencia y significado al ser impresos o mostrados.
2. **Equivalencia de Compatibilidad**: Una forma m치s d칠bil de equivalencia donde los caracteres pueden representar el mismo car치cter abstracto pero mostrarse de manera diferente.

Existen **cuatro algoritmos de normalizaci칩n Unicode**: NFC, NFD, NFKC y NFKD. Cada algoritmo emplea t칠cnicas de normalizaci칩n can칩nica y de compatibilidad de manera diferente. Para una comprensi칩n m치s profunda, puedes explorar estas t칠cnicas en [Unicode.org](https://unicode.org/).

### Puntos Clave sobre la Codificaci칩n Unicode

Comprender la codificaci칩n Unicode es fundamental, especialmente al tratar problemas de interoperabilidad entre diferentes sistemas o lenguajes. Aqu칤 est치n los puntos principales:

* **Puntos de C칩digo y Caracteres**: En Unicode, a cada car치cter o s칤mbolo se le asigna un valor num칠rico conocido como "punto de c칩digo".
* **Representaci칩n en Bytes**: El punto de c칩digo (o car치cter) se representa por uno o m치s bytes en memoria. Por ejemplo, los caracteres LATIN-1 (comunes en pa칤ses de habla inglesa) se representan usando un byte. Sin embargo, los idiomas con un conjunto m치s amplio de caracteres necesitan m치s bytes para la representaci칩n.
* **Codificaci칩n**: Este t칠rmino se refiere a c칩mo los caracteres se transforman en una serie de bytes. UTF-8 es un est치ndar de codificaci칩n prevalente donde los caracteres ASCII se representan usando un byte, y hasta cuatro bytes para otros caracteres.
* **Procesamiento de Datos**: Los sistemas que procesan datos deben ser conscientes de la codificaci칩n utilizada para convertir correctamente el flujo de bytes en caracteres.
* **Variantes de UTF**: Adem치s de UTF-8, existen otros est치ndares de codificaci칩n como UTF-16 (usando un m칤nimo de 2 bytes, hasta 4) y UTF-32 (usando 4 bytes para todos los caracteres).

Es crucial comprender estos conceptos para manejar y mitigar eficazmente los problemas potenciales derivados de la complejidad de Unicode y sus diversos m칠todos de codificaci칩n.

Un ejemplo de c칩mo Unicode normaliza dos bytes diferentes que representan el mismo car치cter:
```python
unicodedata.normalize("NFKD","chloe\u0301") == unicodedata.normalize("NFKD", "chlo\u00e9")
```
**Una lista de caracteres equivalentes Unicode se puede encontrar aqu칤:** [https://appcheck-ng.com/wp-content/uploads/unicode\_normalization.html](https://appcheck-ng.com/wp-content/uploads/unicode\_normalization.html) y [https://0xacb.com/normalization\_table](https://0xacb.com/normalization\_table)

### Descubrimiento

Si encuentras dentro de una aplicaci칩n web un valor que se est치 devolviendo, podr칤as intentar enviar **'KELVIN SIGN' (U+0212A)** que se **normaliza a "K"** (puedes enviarlo como `%e2%84%aa`). **Si se devuelve un "K"**, entonces se est치 realizando alg칰n tipo de **normalizaci칩n Unicode**.

Otro **ejemplo**: `%F0%9D%95%83%E2%85%87%F0%9D%99%A4%F0%9D%93%83%E2%85%88%F0%9D%94%B0%F0%9D%94%A5%F0%9D%99%96%F0%9D%93%83` despu칠s de la **normalizaci칩n Unicode** es `Leonishan`.

## **Ejemplos Vulnerables**

### **Burla del filtro de Inyecci칩n SQL**

Imagina una p치gina web que est치 utilizando el car치cter `'` para crear consultas SQL con la entrada del usuario. Esta web, como medida de seguridad, **elimina** todas las ocurrencias del car치cter **`'`** de la entrada del usuario, pero **despu칠s de esa eliminaci칩n** y **antes de la creaci칩n** de la consulta, **normaliza** utilizando **Unicode** la entrada del usuario.

Entonces, un usuario malintencionado podr칤a insertar un car치cter Unicode diferente equivalente a `' (0x27)` como `%ef%bc%87`, cuando la entrada se normaliza, se crea una comilla simple y aparece una **vulnerabilidad de Inyecci칩n SQL**:

![https://appcheck-ng.com/unicode-normalization-vulnerabilities-the-special-k-polyglot/](<../../.gitbook/assets/image (699).png>)

**Algunos caracteres Unicode interesantes**

* `o` -- %e1%b4%bc
* `r` -- %e1%b4%bf
* `1` -- %c2%b9
* `=` -- %e2%81%bc
* `/` -- %ef%bc%8f
* `-`-- %ef%b9%a3
* `#`-- %ef%b9%9f
* `*`-- %ef%b9%a1
* `'` -- %ef%bc%87
* `"` -- %ef%bc%82
* `|` -- %ef%bd%9c
```
' or 1=1-- -
%ef%bc%87+%e1%b4%bc%e1%b4%bf+%c2%b9%e2%81%bc%c2%b9%ef%b9%a3%ef%b9%a3+%ef%b9%a3

" or 1=1-- -
%ef%bc%82+%e1%b4%bc%e1%b4%bf+%c2%b9%e2%81%bc%c2%b9%ef%b9%a3%ef%b9%a3+%ef%b9%a3

' || 1==1//
%ef%bc%87+%ef%bd%9c%ef%bd%9c+%c2%b9%e2%81%bc%e2%81%bc%c2%b9%ef%bc%8f%ef%bc%8f

" || 1==1//
%ef%bc%82+%ef%bd%9c%ef%bd%9c+%c2%b9%e2%81%bc%e2%81%bc%c2%b9%ef%bc%8f%ef%bc%8f
```
#### Plantilla sqlmap

{% embed url="https://github.com/carlospolop/sqlmap_to_unicode_template" %}

### XSS (Cross Site Scripting)

Podr칤as usar uno de los siguientes caracteres para enga침ar a la aplicaci칩n web y explotar un XSS:

![https://appcheck-ng.com/unicode-normalization-vulnerabilities-the-special-k-polyglot/](<../../.gitbook/assets/image (312) (2).png>)

Ten en cuenta que, por ejemplo, el primer car치cter Unicode propuesto puede ser enviado como: `%e2%89%ae` o como `%u226e`

![https://appcheck-ng.com/unicode-normalization-vulnerabilities-the-special-k-polyglot/](<../../.gitbook/assets/image (215) (1) (1).png>)

### Fuzzing de Regexes

Cuando el backend est치 **verificando la entrada del usuario con una regex**, podr칤a ser posible que la **entrada** se est칠 **normalizando** para la **regex** pero **no** para donde se est치 **utilizando**. Por ejemplo, en una Redirecci칩n Abierta o SSRF la regex podr칤a estar **normalizando la URL enviada** pero luego **accedi칠ndola tal cual**.

La herramienta [**recollapse**](https://github.com/0xacb/recollapse) permite **generar variaciones de la entrada** para fuzzear el backend. Para m치s informaci칩n, revisa el **github** y este [**post**](https://0xacb.com/2022/11/21/recollapse/).

## Referencias

* [**https://labs.spotify.com/2013/06/18/creative-usernames/**](https://labs.spotify.com/2013/06/18/creative-usernames/)
* [**https://security.stackexchange.com/questions/48879/why-does-directory-traversal-attack-c0af-work**](https://security.stackexchange.com/questions/48879/why-does-directory-traversal-attack-c0af-work)
* [**https://jlajara.gitlab.io/posts/2020/02/19/Bypass\_WAF\_Unicode.html**](https://jlajara.gitlab.io/posts/2020/02/19/Bypass\_WAF\_Unicode.html)

### [WhiteIntel](https://whiteintel.io)

<figure><img src="/.gitbook/assets/image (1224).png" alt=""><figcaption></figcaption></figure>

[**WhiteIntel**](https://whiteintel.io) es un motor de b칰squeda alimentado por la **dark web** que ofrece funcionalidades **gratuitas** para verificar si una empresa o sus clientes han sido **comprometidos** por **malwares de robo**.

El objetivo principal de WhiteIntel es combatir los secuestros de cuentas y los ataques de ransomware resultantes de malwares que roban informaci칩n.

Puedes visitar su sitio web y probar su motor de forma **gratuita** en:

{% embed url="https://whiteintel.io" %}

<details>

<summary><strong>Aprende hacking en AWS desde cero hasta experto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si deseas ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** 춰Consulta los [**PLANES DE SUSCRIPCI칍N**](https://github.com/sponsors/carlospolop)!
* Obt칠n el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci칩n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s칤guenos** en **Twitter** 游냕 [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
