# Κανονικοποίηση Unicode

<details>

<summary><strong>Μάθετε το χάκινγκ του AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι υποστήριξης του HackTricks:

* Εάν θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**The PEASS Family**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε στη** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στη [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Μοιραστείτε τα χάκινγκ κόλπα σας υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>

**Αυτό είναι ένα περίληψη από: [https://appcheck-ng.com/unicode-normalization-vulnerabilities-the-special-k-polyglot/](https://appcheck-ng.com/unicode-normalization-vulnerabilities-the-special-k-polyglot/)**. Ελέγξτε το για περισσότερες λεπτομέρειες (εικόνες που έχουν ληφθεί από εκεί).

## Κατανόηση του Unicode και της Κανονικοποίησης

Η κανονικοποίηση Unicode είναι ένας διαδικασία που εξασφαλίζει ότι διάφορες δυαδικές αναπαραστάσεις χαρακτήρων κανονικοποιούνται στην ίδια δυαδική τιμή. Αυτή η διαδικασία είναι κρίσιμη για την αντιμετώπιση συμβολοσειρών στον προγραμματισμό και την επεξεργασία δεδομένων. Ο πρότυπος Unicode καθορίζει δύο τύπους ισοδυναμίας χαρακτήρων:

1. **Κανονική Ισοδυναμία**: Οι χαρακτήρες θεωρούνται κανονικά ισοδύναμοι εάν έχουν την ίδια εμφάνιση και σημασία όταν εκτυπώνονται ή εμφανίζονται.
2. **Συμβατή Ισοδυναμία**: Μια ασθενέστερη μορφή ισοδυναμίας όπου οι χαρακτήρες μπορεί να αναπαριστούν τον ίδιο αφηρημένο χαρακτήρα, αλλά να εμφανίζονται διαφορετικά.

Υπάρχουν **τέσσερις αλγόριθμοι κανονικοποίησης Unicode**: NFC, NFD, NFKC και NFKD. Κάθε αλγόριθμος χρησιμοποιεί διαφορετικές τεχνικές κανονικοποίησης κανονικής και συμβατής ισοδυναμίας. Για μια πιο λεπτομερή κατανόηση, μπορείτε να εξερευνήσετε αυτές τις τεχνικές στο [Unicode.org](https://unicode.org/).

### Κύρια Σημεία για την Κωδικοποίηση Unicode

Η κατανόηση της κωδικοποίησης Unicode είναι κρίσιμη, ειδικά όταν αντιμετωπίζονται θέματα αλληλεπίδρασης μεταξύ διαφορετικών συστημάτων ή γλωσσών. Οι κύριες πτυχές είναι οι εξής:

- **Σημεία Κώδικα και Χαρακτήρες**: Στο Unicode, κάθε χαρακτήρας ή σύμβολο αντιστοιχίζεται σε μια αριθμητική τιμή που ονομάζεται "σημείο κώδικα".
- **Αναπαράσταση σε Bytes**: Το σημείο κώδικα (ή ο χαρακτήρας) αναπαρίσταται από ένα ή περισσότερα bytes στη μνήμη. Για παράδειγμα, οι χαρακτήρες LATIN-1 (συνηθισμένοι σε αγγλόφωνες χώρες) αναπαρίστανται χρησιμοποιώντας ένα byte. Ωστόσο, οι γλώσσες με μεγαλύτερο σύνολο χαρακτήρων χρειάζονται περισσότερα bytes για την αναπαράσταση.
- **Κωδικοποίηση**: Αυτός ο όρος αναφέρεται στον τρόπο με τον οποίο οι χαρακτήρες μετατρέπονται σε μια σειρά bytes. Το UTF-8 είναι ένα διαδεδομένο πρότυπο κωδικοποίησης όπου οι χαρακτήρες ASCII αναπαρίστανται χρησιμοποιώντας ένα byte και έως τέσσερα bytes για άλλους χαρακτήρες.
- **Επεξεργασία Δεδομένων**: Τα συστήματα που επεξεργάζονται δεδομένα πρέπει να γνωρίζουν την κωδικοποίηση που χρησιμοποιείται για να μετατρέψουν σωστά τη ροή bytes σε χαρακτήρες.
- **Παραλλαγές του UTF**: Εκτός από το UTF-8, υπάρχουν και άλλα πρότυπα κωδικοποίησης όπως το UTF-16 (χρησιμοποιώντας τουλάχιστον 2 bytes, έως 4) και το UTF-32 (χρησιμοποιώντας 4 bytes για όλους τους χαρακτήρες).

Είναι κρίσιμο να κατανοήσετε αυτές τις έννοιες για να αντιμετωπίσετε και να αντιμετωπίσετε αποτελεσματικά πιθανά προβλήματα που προκύπτουν από την πολυπλοκότητα του Unicode και τις διάφορες μεθόδους κωδικοποίησής του. 

Ένα παράδειγμα που δείχνει πώς η κανονικοποίηση Unicode κανονικοποιεί δύο διαφορετικά bytes που αναπαριστούν τον ίδιο χαρακτήρα:
```python
unicodedata.normalize("NFKD","chloe\u0301") == unicodedata.normalize("NFKD", "chlo\u00e9")
```
**Μια λίστα με ισοδύναμους χαρακτήρες Unicode μπορεί να βρεθεί εδώ:** [https://appcheck-ng.com/wp-content/uploads/unicode\_normalization.html](https://appcheck-ng.com/wp-content/uploads/unicode\_normalization.html) και [https://0xacb.com/normalization\_table](https://0xacb.com/normalization\_table)

### Ανακάλυψη

Αν μπορείτε να βρείτε μέσα σε μια εφαρμογή ιστού μια τιμή που επιστρέφεται, μπορείτε να δοκιμάσετε να στείλετε τον **'ΣΥΜΒΟΛΟ ΚΕΛΒΙΝ' (U+0212A)** το οποίο **κανονικοποιείται σε "K"** (μπορείτε να το στείλετε ως `%e2%84%aa`). **Αν επιστρέφεται ένα "K"**, τότε γίνεται κάποιου είδους **κανονικοποίηση Unicode**.

Άλλο **παράδειγμα**: `%F0%9D%95%83%E2%85%87%F0%9D%99%A4%F0%9D%93%83%E2%85%88%F0%9D%94%B0%F0%9D%94%A5%F0%9D%99%96%F0%9D%93%83` μετά την **κανονικοποίηση Unicode** γίνεται `Leonishan`.

## **Ευάλωτα παραδείγματα**

### **Παράκαμψη φίλτρου SQL Injection**

Φανταστείτε μια ιστοσελίδα που χρησιμοποιεί τον χαρακτήρα `'` για να δημιουργήσει ερωτήματα SQL με την είσοδο του χρήστη. Αυτή η ιστοσελίδα, ως μέτρο ασφαλείας, **διαγράφει** όλες τις εμφανίσεις του χαρακτήρα **`'`** από την είσοδο του χρήστη, αλλά **μετά τη διαγραφή αυτής** και **πριν τη δημιουργία** του ερωτήματος, **κανονικοποιεί** χρησιμοποιώντας **Unicode** την είσοδο του χρήστη.

Έτσι, ένας κακόβουλος χρήστης μπορεί να εισάγει έναν διαφορετικό ισοδύναμο χαρακτήρα Unicode με το `' (0x27)` όπως `%ef%bc%87`, όταν η είσοδος κανονικοποιηθεί, δημιουργείται ένα μονό εισαγωγικό και εμφανίζεται μια **ευπάθεια SQLInjection**:

![https://appcheck-ng.com/unicode-normalization-vulnerabilities-the-special-k-polyglot/](<../../.gitbook/assets/image (157) (1).png>)

**Ορισμένοι ενδιαφέροντες χαρακτήρες Unicode**

* `o` -- %e1%b4%bc
* `r` -- %e1%b4%bf
* `1` -- %c2%b9
* `=` -- %e2%81%bc
* `/` -- %ef%bc%8f
* `-`-- %ef%b9%a3
* `#`-- %ef%b9%9f
* `*`-- %ef%b9%a1
* `'` -- %ef%bc%87
* `"` -- %ef%bc%82
* `|` -- %ef%bd%9c
```
' or 1=1-- -
%ef%bc%87+%e1%b4%bc%e1%b4%bf+%c2%b9%e2%81%bc%c2%b9%ef%b9%a3%ef%b9%a3+%ef%b9%a3

" or 1=1-- -
%ef%bc%82+%e1%b4%bc%e1%b4%bf+%c2%b9%e2%81%bc%c2%b9%ef%b9%a3%ef%b9%a3+%ef%b9%a3

' || 1==1//
%ef%bc%87+%ef%bd%9c%ef%bd%9c+%c2%b9%e2%81%bc%e2%81%bc%c2%b9%ef%bc%8f%ef%bc%8f

" || 1==1//
%ef%bc%82+%ef%bd%9c%ef%bd%9c+%c2%b9%e2%81%bc%e2%81%bc%c2%b9%ef%bc%8f%ef%bc%8f
```
#### Πρότυπο sqlmap

{% embed url="https://github.com/carlospolop/sqlmap_to_unicode_template" %}

### XSS (Cross Site Scripting)

Μπορείτε να χρησιμοποιήσετε έναν από τους παρακάτω χαρακτήρες για να εξαπατήσετε την εφαρμογή ιστού και να εκμεταλλευτείτε μια ευπάθεια XSS:

![https://appcheck-ng.com/unicode-normalization-vulnerabilities-the-special-k-polyglot/](<../../.gitbook/assets/image (312) (1).png>)

Παρατηρήστε ότι, για παράδειγμα, ο πρώτος προτεινόμενος Unicode χαρακτήρας μπορεί να αποσταλεί ως: `%e2%89%ae` ή ως `%u226e`

![https://appcheck-ng.com/unicode-normalization-vulnerabilities-the-special-k-polyglot/](<../../.gitbook/assets/image (215) (1).png>)

### Fuzzing Regexes

Όταν το **backend ελέγχει την είσοδο του χρήστη με ένα regex**, είναι πιθανό να γίνεται **κανονικοποίηση** της **εισόδου** για το **regex** αλλά όχι για το σημείο όπου χρησιμοποιείται. Για παράδειγμα, σε ένα Open Redirect ή SSRF το regex μπορεί να κανονικοποιεί το απεσταλμένο URL αλλά στη συνέχεια να το προσπελαύνει ως έχει.

Το εργαλείο [**recollapse**](https://github.com/0xacb/recollapse) επιτρέπει να **δημιουργήσετε παραλλαγές της εισόδου** για να εκτελέσετε fuzzing στο backend. Για περισσότερες πληροφορίες, ελέγξτε το **github** και αυτήν την [**ανάρτηση**](https://0xacb.com/2022/11/21/recollapse/).


## Αναφορές
* [**https://labs.spotify.com/2013/06/18/creative-usernames/**](https://labs.spotify.com/2013/06/18/creative-usernames/)
* [**https://security.stackexchange.com/questions/48879/why-does-directory-traversal-attack-c0af-work**](https://security.stackexchange.com/questions/48879/why-does-directory-traversal-attack-c0af-work)
* [**https://jlajara.gitlab.io/posts/2020/02/19/Bypass\_WAF\_Unicode.html**](https://jlajara.gitlab.io/posts/2020/02/19/Bypass\_WAF\_Unicode.html)

<details>

<summary><strong>Μάθετε το hacking του AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι για να υποστηρίξετε το HackTricks:

* Εάν θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**The PEASS Family**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε στη** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Μοιραστείτε τα κόλπα σας για το hacking υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>
