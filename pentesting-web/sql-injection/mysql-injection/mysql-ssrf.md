# MySQL File priv to SSRF/RCE

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Expert en √©quipe rouge AWS de HackTricks)</strong></a><strong>!</strong></summary>

Autres fa√ßons de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFT**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts GitHub.

</details>

**Il s'agit d'un r√©sum√© des techniques MySQL/MariaDB/Percona provenant de [https://ibreak.software/2020/06/using-sql-injection-to-perform-ssrf-xspa-attacks/](https://ibreak.software/2020/06/using-sql-injection-to-perform-ssrf-xspa-attacks/)**.

### Demande de falsification c√¥t√© serveur (SSRF) via les fonctions SQL

Dans l'exploration de l'exfiltration de donn√©es hors bande SQL, la fonction `LOAD_FILE()` est couramment utilis√©e pour initier des requ√™tes r√©seau. Cependant, cette fonction est limit√©e par le syst√®me d'exploitation sur lequel elle op√®re et les configurations de d√©marrage de la base de donn√©es.

La variable globale `secure_file_priv`, si elle n'est pas d√©finie, est par d√©faut `/var/lib/mysql-files/`, limitant l'acc√®s aux fichiers √† ce r√©pertoire √† moins d'√™tre d√©finie comme une cha√Æne vide (`""`). Ce r√©glage n√©cessite des modifications dans le fichier de configuration de la base de donn√©es ou les param√®tres de d√©marrage.

√âtant donn√© que `secure_file_priv` est d√©sactiv√© (`""`), et en supposant que les autorisations de fichier et `file_priv` n√©cessaires sont accord√©es, les fichiers en dehors du r√©pertoire d√©sign√© peuvent √™tre lus. Cependant, la capacit√© de ces fonctions √† effectuer des appels r√©seau d√©pend fortement du syst√®me d'exploitation. Sur les syst√®mes Windows, les appels r√©seau aux chemins UNC sont possibles en raison de la compr√©hension par le syst√®me d'exploitation des conventions de d√©nomination UNC, ce qui peut potentiellement conduire √† l'exfiltration des hachages NTLMv2.

Cette m√©thode SSRF est limit√©e au port TCP 445 et ne permet pas la modification du num√©ro de port, bien qu'elle puisse √™tre utilis√©e pour acc√©der √† des partages avec des privil√®ges de lecture complets et, comme d√©montr√© dans des recherches ant√©rieures, pour voler des hachages en vue d'une exploitation ult√©rieure.

### Ex√©cution de code √† distance (RCE) via les fonctions d√©finies par l'utilisateur (UDF)

Les bases de donn√©es MySQL offrent l'utilisation de fonctions d√©finies par l'utilisateur (UDF) √† partir de fichiers de biblioth√®que externes. Si ces biblioth√®ques sont accessibles dans des r√©pertoires sp√©cifiques ou dans le `$PATH` du syst√®me, elles peuvent √™tre invoqu√©es depuis MySQL.

Cette technique permet l'ex√©cution de requ√™tes r√©seau/HTTP via une UDF, √† condition que plusieurs conditions soient remplies, notamment l'acc√®s en √©criture au `@@plugin_dir`, `file_priv` d√©fini sur `Y`, et `secure_file_priv` d√©sactiv√©.

Par exemple, la biblioth√®que `lib_mysqludf_sys` ou d'autres biblioth√®ques UDF permettant des requ√™tes HTTP peuvent √™tre charg√©es pour effectuer une SSRF. Les biblioth√®ques doivent √™tre transf√©r√©es sur le serveur, ce qui peut √™tre r√©alis√© en encodant en hexad√©cimal ou en base64 le contenu de la biblioth√®que, puis en l'√©crivant dans le r√©pertoire appropri√©.

Le processus varie si le `@@plugin_dir` n'est pas inscriptible, en particulier pour les versions MySQL sup√©rieures √† `v5.0.67`. Dans de tels cas, des chemins alternatifs inscriptibles doivent √™tre utilis√©s.

L'automatisation de ces processus peut √™tre facilit√©e par des outils tels que SQLMap, qui prend en charge l'injection UDF, et pour les injections SQL aveugles, la redirection de sortie ou les techniques de trafic de requ√™tes DNS peuvent √™tre utilis√©es.

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Expert en √©quipe rouge AWS de HackTricks)</strong></a><strong>!</strong></summary>

Autres fa√ßons de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFT**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts GitHub.

</details>
